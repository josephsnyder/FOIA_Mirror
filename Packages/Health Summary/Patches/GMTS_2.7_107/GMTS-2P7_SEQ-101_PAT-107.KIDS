Released GMTS*2.7*107 SEQ #101
Extracted from mail message
**KIDS**:GMTS*2.7*107^

**INSTALL NAME**
GMTS*2.7*107
"BLD",9383,0)
GMTS*2.7*107^HEALTH SUMMARY^0^3130805^y
"BLD",9383,4,0)
^9.64PA^^
"BLD",9383,6.3)
3
"BLD",9383,"ABPKG")
n
"BLD",9383,"KRN",0)
^9.67PA^779.2^20
"BLD",9383,"KRN",.4,0)
.4
"BLD",9383,"KRN",.401,0)
.401
"BLD",9383,"KRN",.402,0)
.402
"BLD",9383,"KRN",.403,0)
.403
"BLD",9383,"KRN",.5,0)
.5
"BLD",9383,"KRN",.84,0)
.84
"BLD",9383,"KRN",3.6,0)
3.6
"BLD",9383,"KRN",3.8,0)
3.8
"BLD",9383,"KRN",9.2,0)
9.2
"BLD",9383,"KRN",9.8,0)
9.8
"BLD",9383,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",9383,"KRN",9.8,"NM",1,0)
GMTSVS^^0^B51081616
"BLD",9383,"KRN",9.8,"NM",2,0)
GMTSVSD^^0^B59713312
"BLD",9383,"KRN",9.8,"NM",3,0)
GMTSVSS^^0^B45201579
"BLD",9383,"KRN",9.8,"NM",4,0)
GMTSOBE^^0^B54063238
"BLD",9383,"KRN",9.8,"NM",5,0)
GMTSPN2^^0^B47494120
"BLD",9383,"KRN",9.8,"NM","B","GMTSOBE",4)
 
"BLD",9383,"KRN",9.8,"NM","B","GMTSPN2",5)
 
"BLD",9383,"KRN",9.8,"NM","B","GMTSVS",1)
 
"BLD",9383,"KRN",9.8,"NM","B","GMTSVSD",2)
 
"BLD",9383,"KRN",9.8,"NM","B","GMTSVSS",3)
 
"BLD",9383,"KRN",19,0)
19
"BLD",9383,"KRN",19.1,0)
19.1
"BLD",9383,"KRN",101,0)
101
"BLD",9383,"KRN",409.61,0)
409.61
"BLD",9383,"KRN",771,0)
771
"BLD",9383,"KRN",779.2,0)
779.2
"BLD",9383,"KRN",870,0)
870
"BLD",9383,"KRN",8989.51,0)
8989.51
"BLD",9383,"KRN",8989.52,0)
8989.52
"BLD",9383,"KRN",8994,0)
8994
"BLD",9383,"KRN","B",.4,.4)
 
"BLD",9383,"KRN","B",.401,.401)
 
"BLD",9383,"KRN","B",.402,.402)
 
"BLD",9383,"KRN","B",.403,.403)
 
"BLD",9383,"KRN","B",.5,.5)
 
"BLD",9383,"KRN","B",.84,.84)
 
"BLD",9383,"KRN","B",3.6,3.6)
 
"BLD",9383,"KRN","B",3.8,3.8)
 
"BLD",9383,"KRN","B",9.2,9.2)
 
"BLD",9383,"KRN","B",9.8,9.8)
 
"BLD",9383,"KRN","B",19,19)
 
"BLD",9383,"KRN","B",19.1,19.1)
 
"BLD",9383,"KRN","B",101,101)
 
"BLD",9383,"KRN","B",409.61,409.61)
 
"BLD",9383,"KRN","B",771,771)
 
"BLD",9383,"KRN","B",779.2,779.2)
 
"BLD",9383,"KRN","B",870,870)
 
"BLD",9383,"KRN","B",8989.51,8989.51)
 
"BLD",9383,"KRN","B",8989.52,8989.52)
 
"BLD",9383,"KRN","B",8994,8994)
 
"BLD",9383,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",9383,"QUES",0)
^9.62^^
"BLD",9383,"REQB",0)
^9.611^3^2
"BLD",9383,"REQB",1,0)
GMTS*2.7*78^1
"BLD",9383,"REQB",3,0)
GMTS*2.7*89^1
"BLD",9383,"REQB","B","GMTS*2.7*78",1)
 
"BLD",9383,"REQB","B","GMTS*2.7*89",3)
 
"MBREQ")
0
"PKG",229,-1)
1^1
"PKG",229,0)
HEALTH SUMMARY^GMTS^Integrated Health Summary Tools
"PKG",229,20,0)
^9.402P^^
"PKG",229,22,0)
^9.49I^1^1
"PKG",229,22,1,0)
2.7^2951020^2960805
"PKG",229,22,1,"PAH",1,0)
107^3130805
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")
 
"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","GMTSOBE")
0^4^B54063238^B41728577
"RTN","GMTSOBE",1,0)
GMTSOBE ; SLC/KER - HS Object - Export            ; 05/22/2008
"RTN","GMTSOBE",2,0)
 ;;2.7;Health Summary;**89,107**;Oct 20, 1995;Build 3
"RTN","GMTSOBE",3,0)
 ;                    
"RTN","GMTSOBE",4,0)
 ; External References
"RTN","GMTSOBE",5,0)
 ;
"RTN","GMTSOBE",6,0)
 ;   DBIA 10096  ^%ZOSF("DEL" 
"RTN","GMTSOBE",7,0)
 ;   DBIA  2056  $$GET1^DIQ (file #200 and 4.3)
"RTN","GMTSOBE",8,0)
 ;   DBIA 10112  $$SITE^VASITE
"RTN","GMTSOBE",9,0)
 ;   DBIA 10103  $$DOW^XLFDT
"RTN","GMTSOBE",10,0)
 ;   DBIA 10103  $$DT^XLFDT
"RTN","GMTSOBE",11,0)
 ;   DBIA 10103  $$FMTE^XLFDT
"RTN","GMTSOBE",12,0)
 ;   DBIA 10103  $$NOW^XLFDT
"RTN","GMTSOBE",13,0)
 ;   DBIA 10104  $$UP^XLFSTR
"RTN","GMTSOBE",14,0)
 ;   DBIA 10070  ^XMD
"RTN","GMTSOBE",15,0)
 ;                        
"RTN","GMTSOBE",16,0)
EN ; Main Entry Point to Export a HS Object
"RTN","GMTSOBE",17,0)
 N %Z,GMTS,GMTSCP,GMTSD,GMTSDM,GMTSDT,GMTSDW,GMTSEX,GMTSFRM,GMTSHD
"RTN","GMTSOBE",18,0)
 N GMTSI,GMTSN,GMTSNC,GMTSND,GMTSNN,GMTSNX,GMTSO,GMTSON,GMTSOND
"RTN","GMTSOBE",19,0)
 N GMTSQIT,GMTSRT,GMTSRTN,GMTSSX,GMTST,GMTSTMP,GMTSTN,GMTSTN0
"RTN","GMTSOBE",20,0)
 N GMTSTNAT,GMTSTNT,GMTSTNV,GMTSTR,GMTSTT,GMTSTXT,GMTSUSR,GMTSX
"RTN","GMTSOBE",21,0)
 N X,XCNP,XMDUZ,XMSCR,XMSUB,XMTEXT,XMY,XMZ,Y I +($G(DUZ))=0 W !!," User not defined" Q
"RTN","GMTSOBE",22,0)
 S GMTSUSR=$$GET1^DIQ(200,(+($G(DUZ))_","),.01) I '$L(GMTSUSR) W !!," Invalid User" Q
"RTN","GMTSOBE",23,0)
 S X=$$OBJ^GMTSOBL Q:+X'>0  S GMTSFRM=$P($$SITE^VASITE,"^",2),GMTSO=+X,GMTSOND=$G(^GMT(142.5,+GMTSO,0))
"RTN","GMTSOBE",24,0)
 S GMTSON=$P(GMTSOND,"^",1),GMTST=+($P(GMTSOND,"^",3)) Q:GMTST=0
"RTN","GMTSOBE",25,0)
 S GMTSTN0=$G(^GMT(142,+GMTST,0)),GMTSTNT=$G(^GMT(142,+GMTST,"T"))
"RTN","GMTSOBE",26,0)
 S GMTSTNV=$G(^GMT(142,+GMTST,"VA")),GMTSTN=$P(GMTSTN0,"^",1) Q:'$L(GMTSTN)
"RTN","GMTSOBE",27,0)
 S GMTSTT=$P(GMTSTNT,"^",1) S:'$L(GMTSTT)&($L(GMTSTN)) GMTSTT=$$EN2^GMTSUMX(GMTSTN)
"RTN","GMTSOBE",28,0)
 I GMTSTN="GMTS HS ADHOC OPTION" D  Q
"RTN","GMTSOBE",29,0)
 . W !," Can not export a Health Summary Object using GMTS HS ADHOC OPTION",!," (Adhoc) Health Summary Type."
"RTN","GMTSOBE",30,0)
 S GMTSTNAT=+GMTSTNV I GMTSTNAT>0 D  Q
"RTN","GMTSOBE",31,0)
 . W !," Can not export a Health Summary Object using a nationally released",!," Remote Data View Health Summary Type."
"RTN","GMTSOBE",32,0)
 ;p.107 added error msg for local components and components with selected Items
"RTN","GMTSOBE",33,0)
 N GMTSCDA,GMTSCERR,GMTSERR S (GMTSCDA,GMTSCERR,GMTSERR)=0
"RTN","GMTSOBE",34,0)
 F  S GMTSCDA=$O(^GMT(142,GMTST,1,GMTSCDA)) Q:'GMTSCDA  D
"RTN","GMTSOBE",35,0)
 .I $P($G(^GMT(142,GMTST,1,GMTSCDA,0)),U,2)>1000 S GMTSCERR=1,GMTSCERR("LOC",$P($G(^GMT(142,GMTST,1,GMTSCDA,0)),U,2))=1
"RTN","GMTSOBE",36,0)
 .I $O(^GMT(142,GMTST,1,GMTSCDA,0)) S GMTSCERR=1,GMTSCERR("SEL",$P($G(^GMT(142,GMTST,1,GMTSCDA,0)),U,2))=1
"RTN","GMTSOBE",37,0)
 I GMTSCERR W ! D  W !!,"Object NOT Exported!!",!!,"Press any key...." N X R X:DTIME Q
"RTN","GMTSOBE",38,0)
 .I $O(GMTSCERR("LOC",0)) D
"RTN","GMTSOBE",39,0)
 ..W !!,"Cannot export a Health Summary Object using a Health Summary Type",!,"that contains Local Health Summary Components",!
"RTN","GMTSOBE",40,0)
 ..S GMTSERR=0 F  S GMTSERR=$O(GMTSCERR("LOC",GMTSERR)) Q:'GMTSERR  D
"RTN","GMTSOBE",41,0)
 ...W !,"Health Summary Type "_$P($G(^GMT(142,GMTST,0)),U)_" contains Local Health Summary",!,"Component "_$P($G(^GMT(142.1,GMTSERR,0)),U)
"RTN","GMTSOBE",42,0)
 .I $O(GMTSCERR("SEL",0)) D
"RTN","GMTSOBE",43,0)
 ..W !!,"Cannot export a Health Summary Object using a Health Summary Type",!,"that contains Health Summary Components with Selected Items",!
"RTN","GMTSOBE",44,0)
 ..S GMTSERR=0 F  S GMTSERR=$O(GMTSCERR("SEL",GMTSERR)) Q:'GMTSERR  D
"RTN","GMTSOBE",45,0)
 ...W !,"Health Summary Type "_$P($G(^GMT(142,GMTST,0)),U)_" contains Health Summary Component ",!,$P($G(^GMT(142.1,GMTSERR,0)),U)_" with Selected Items"
"RTN","GMTSOBE",46,0)
 S GMTSRTN="GMTSOBX" D INIT,TYPE,OBJ,MAIL
"RTN","GMTSOBE",47,0)
 K ^TMP($J,"GMTSOBXM")
"RTN","GMTSOBE",48,0)
 Q
"RTN","GMTSOBE",49,0)
INIT ; Initialize Export Routine
"RTN","GMTSOBE",50,0)
 Q:'$L(GMTSON)  Q:'$L(GMTSFRM)  Q:'$L(GMTSUSR)
"RTN","GMTSOBE",51,0)
 W !!," Exporting Object Routine - ",GMTSRTN D CRTN(GMTSRTN)
"RTN","GMTSOBE",52,0)
 N GMTST,GMTSI
"RTN","GMTSOBE",53,0)
 K ^TMP($J,"GMTSOBXM")
"RTN","GMTSOBE",54,0)
 S GMTST=$$CREATED D TL(GMTST)
"RTN","GMTSOBE",55,0)
 D BL D:$L($G(GMTSON)) TL((" Object:  "_GMTSON))
"RTN","GMTSOBE",56,0)
 D:$L($G(GMTSFRM)) TL((" From:    "_GMTSFRM))
"RTN","GMTSOBE",57,0)
 D:$L($G(GMTSUSR)) TL((" Sender:  "_GMTSUSR))
"RTN","GMTSOBE",58,0)
 D:$L($G(GMTSON))!($L($G(GMTSFRM)))!($L($G(GMTSUSR))) BL
"RTN","GMTSOBE",59,0)
 D TL(" 1) Use Packman to unpack the routine GMTSOBX contained in this message."),BL
"RTN","GMTSOBE",60,0)
 D TL(" 2) Use the following Option to install the Health Summary Object")
"RTN","GMTSOBE",61,0)
 D TL("    contained in this message."),BL
"RTN","GMTSOBE",62,0)
 D TL("      GMTS OBJ IMPORT/INSTALL")
"RTN","GMTSOBE",63,0)
 D TL("        Import/Install a Health Summary Object"),BL
"RTN","GMTSOBE",64,0)
 D TL("    or run the routine INS^GMTSOBJ"),BL
"RTN","GMTSOBE",65,0)
 D TL("$END TXT")
"RTN","GMTSOBE",66,0)
 D TL(("$ROU "_GMTSRTN))
"RTN","GMTSOBE",67,0)
 D TL((GMTSRTN_" ; CIO/SLC - HS Exported Object          ; "_$P($$FMTE^XLFDT($$NOW^XLFDT,"5Z"),"@",1)))
"RTN","GMTSOBE",68,0)
 D TL((" ;;"_$$VER_";Health Summary;;Oct 20, 1995")),S
"RTN","GMTSOBE",69,0)
 D:$L($G(GMTSON)) TL((" ; Object:  "_GMTSON))
"RTN","GMTSOBE",70,0)
 D:$L($G(GMTSFRM)) TL((" ; From:    "_GMTSFRM))
"RTN","GMTSOBE",71,0)
 D:$L($G(GMTSUSR)) TL((" ; Sender:  "_GMTSUSR)) D S,Q
"RTN","GMTSOBE",72,0)
 Q
"RTN","GMTSOBE",73,0)
 ;                         
"RTN","GMTSOBE",74,0)
TYPE ; Export Health Summary Type
"RTN","GMTSOBE",75,0)
 ;   This will not export:
"RTN","GMTSOBE",76,0)
 ;     National Health Summary Types
"RTN","GMTSOBE",77,0)
 ;     Local Components
"RTN","GMTSOBE",78,0)
 ;     Components with Selected Items
"RTN","GMTSOBE",79,0)
 N GMTSCP,GMTSHD,GMTSNC,GMTSND,GMTSNN,GMTSRT,GMTSTMP,GMTSTR
"RTN","GMTSOBE",80,0)
 N GMTSNX,GMTSSX,GMTSD
"RTN","GMTSOBE",81,0)
 D TL(("TYPE ; Health Summary Type"))
"RTN","GMTSOBE",82,0)
 I +($G(^GMT(142,+GMTST,"VA")))>0 D Q Q
"RTN","GMTSOBE",83,0)
 D TL((" ;"_GMTSTN)),TL((" ;"_GMTSTT))
"RTN","GMTSOBE",84,0)
 S GMTSTMP=$G(^GMT(142,+($G(GMTST)),0)),GMTSTMP=GMTSTN,$P(GMTSTMP,"^",2)="",$P(GMTSTMP,"^",5)=""
"RTN","GMTSOBE",85,0)
 D TL((" ;0;"_GMTSTMP))
"RTN","GMTSOBE",86,0)
 S GMTSRT="^GMT(142,"_+($G(GMTST))_","
"RTN","GMTSOBE",87,0)
 S GMTSNN="^GMT(142,"_+($G(GMTST))_",1)"
"RTN","GMTSOBE",88,0)
 S GMTSNC="^GMT(142,"_+($G(GMTST))_",1," S GMTSTR=1
"RTN","GMTSOBE",89,0)
 F  S GMTSNN=$Q(@GMTSNN) Q:GMTSNN=""!(GMTSNN'[GMTSNC)  D
"RTN","GMTSOBE",90,0)
 . S GMTSTR=$P($P(GMTSNN,GMTSRT,2),")",1)
"RTN","GMTSOBE",91,0)
 . S:$P(GMTSTR,",",3)="1" GMTSD(+($P(GMTSTR,",",2)))="" Q:$P(GMTSTR,",",3)="1"
"RTN","GMTSOBE",92,0)
 . S GMTSNX=$Q(@GMTSNN),GMTSSX=$P($P(GMTSNX,GMTSRT,2),")",1)
"RTN","GMTSOBE",93,0)
 . S:$P(GMTSSX,",",3)="1" GMTSD(+($P(GMTSSX,",",2)))="" Q:$P(GMTSSX,",",3)="1"
"RTN","GMTSOBE",94,0)
 . S GMTSND=@GMTSNN I GMTSTR="1,0" D TL((" ;"_GMTSTR_";"_GMTSND)) Q
"RTN","GMTSOBE",95,0)
 . S GMTSCP=+($P(GMTSND,"^",2)) Q:+GMTSCP>1000
"RTN","GMTSOBE",96,0)
 . S GMTSHD=$P($G(^GMT(142.1,+GMTSCP,0)),"^",9)
"RTN","GMTSOBE",97,0)
 . S:$P(GMTSND,"^",5)="" $P(GMTSND,"^",5)=GMTSHD
"RTN","GMTSOBE",98,0)
 . S:+($P(GMTSTR,",",2))=0 GMTSND=""
"RTN","GMTSOBE",99,0)
 . I +($P(GMTSTR,",",2))=0,+($P(GMTSTR,",",4))>0,$D(GMTSD(+($P(GMTSTR,",",4)))) Q
"RTN","GMTSOBE",100,0)
 . D TL((" ;"_GMTSTR_";"_GMTSND))
"RTN","GMTSOBE",101,0)
 D TL((" ;99;"_$H)) D:$L(GMTSTT) TL((" ;""T"";"_GMTSTT)) D Q
"RTN","GMTSOBE",102,0)
 Q
"RTN","GMTSOBE",103,0)
 ;                         
"RTN","GMTSOBE",104,0)
OBJ ; Export an Object
"RTN","GMTSOBE",105,0)
 N GMTSNC,GMTSND,GMTSNN,GMTSRT,GMTSTMP,GMTSTR
"RTN","GMTSOBE",106,0)
 D TL(("OBJ ; Health Summary Object")),TL((" ;"_GMTSON))
"RTN","GMTSOBE",107,0)
 S GMTSTMP=$G(^GMT(142.5,+GMTSO,0)),$P(GMTSTMP,"^",3)="",$P(GMTSTMP,"^",17)="",$P(GMTSTMP,"^",18)="",$P(GMTSTMP,"^",19)=""
"RTN","GMTSOBE",108,0)
 D TL((" ;0;"_GMTSTMP)) S GMTSRT="^GMT(142.5,"_+($G(GMTSO))_","
"RTN","GMTSOBE",109,0)
 S GMTSTMP=$G(^GMT(142.5,+GMTSO,2)) D TL((" ;2;"_GMTSTMP))
"RTN","GMTSOBE",110,0)
 S GMTSNN="^GMT(142.5,"_+($G(GMTSO))_",1)",GMTSNC="^GMT(142.5,"_+($G(GMTSO))_",1,"
"RTN","GMTSOBE",111,0)
 F  S GMTSNN=$Q(@GMTSNN) Q:GMTSNN=""!(GMTSNN'[GMTSNC)  D
"RTN","GMTSOBE",112,0)
 . S GMTSTR=$P($P(GMTSNN,GMTSRT,2),")",1),GMTSND=@GMTSNN D TL((" ;"_GMTSTR_";"_GMTSND))
"RTN","GMTSOBE",113,0)
 D Q,TL(("$END ROU "_GMTSRTN))
"RTN","GMTSOBE",114,0)
 Q
"RTN","GMTSOBE",115,0)
 ;                   
"RTN","GMTSOBE",116,0)
 ; Message
"RTN","GMTSOBE",117,0)
Q ;   Quit Line
"RTN","GMTSOBE",118,0)
 D TL(" Q") Q
"RTN","GMTSOBE",119,0)
S ;   Spacer/Comment Line
"RTN","GMTSOBE",120,0)
 D TL(" ;                   ") Q
"RTN","GMTSOBE",121,0)
BL ;   Blank Line
"RTN","GMTSOBE",122,0)
 D TL(" ") Q
"RTN","GMTSOBE",123,0)
TL(X) ;   Text Line
"RTN","GMTSOBE",124,0)
 N GMTS S GMTS=+($G(^TMP($J,"GMTSOBXM",0))),GMTS=GMTS+1
"RTN","GMTSOBE",125,0)
 S ^TMP($J,"GMTSOBXM",GMTS,0)=$G(X),^TMP($J,"GMTSOBXM",0)=GMTS
"RTN","GMTSOBE",126,0)
 Q
"RTN","GMTSOBE",127,0)
 ;                   
"RTN","GMTSOBE",128,0)
 ; Mailman Support
"RTN","GMTSOBE",129,0)
MAIL ;   Send Object via Mailman
"RTN","GMTSOBE",130,0)
 N %Z,XCNP,XMSCR,XMDUZ,XMY,XMZ,XMSUB,XMY,XMTEXT,XMDUZ,GMTSN,GMTSQIT Q:'$D(^TMP($J,"GMTSOBXM"))
"RTN","GMTSOBE",131,0)
 S XMDUZ=+($G(DUZ)) S:+XMDUZ=0 GMTSQIT=1 S GMTSN=$$XMY S:'$L(GMTSN) GMTSQIT=1 S:$L(GMTSN) XMY(GMTSN)=""
"RTN","GMTSOBE",132,0)
 S XMSUB=$$XMSUB S:'$L(XMSUB) GMTSQIT=1 S XMTEXT="^TMP("_$J_",""GMTSOBXM""," Q:+($G(GMTSQIT))>0
"RTN","GMTSOBE",133,0)
 D:+($G(GMTSQIT))'>0 ^XMD I +($G(XMZ))>0 H 1 W !,"   Message [",+($G(XMZ)),"] sent"
"RTN","GMTSOBE",134,0)
 K %Z,XCNP,XMSCR,XMDUZ,XMY,XMZ,XMSUB,XMY,XMTEXT,XMDUZ,^TMP($J,"GMTSOBXM")
"RTN","GMTSOBE",135,0)
 Q
"RTN","GMTSOBE",136,0)
XMY(X) ;   Get Addressee
"RTN","GMTSOBE",137,0)
 S X=$$GET1^DIQ(200,(+($G(DUZ))_","),.01) Q X
"RTN","GMTSOBE",138,0)
XMSUB(X) ;   Get Subject
"RTN","GMTSOBE",139,0)
 N GMTSON S GMTSON=$P($G(^GMT(142.5,+($G(GMTSO)),0)),"^",1)
"RTN","GMTSOBE",140,0)
 S X="Exported Health Summary Object" S:$L(GMTSON) X=$E(("Export HS Obj: "_GMTSON),1,65)
"RTN","GMTSOBE",141,0)
 Q X
"RTN","GMTSOBE",142,0)
DOM(X) ;   Domain
"RTN","GMTSOBE",143,0)
 S X=$$GET1^DIQ(4.3,"1,",.01) Q X
"RTN","GMTSOBE",144,0)
DOW(X) ;   Day of Week
"RTN","GMTSOBE",145,0)
 S X=$$DT^XLFDT,X=$$DOW^XLFDT(X),X=$$UP^XLFSTR(X) Q X
"RTN","GMTSOBE",146,0)
NOW(X) ;   Now
"RTN","GMTSOBE",147,0)
 N GMTSD,GMTST S X=$$NOW^XLFDT,X=$$FMTE^XLFDT(X,"5Z"),GMTSD=$P(X,"@",1)
"RTN","GMTSOBE",148,0)
 S GMTST=$P($P(X,"@",2),":",1,2),X=GMTSD S:$L(GMTST) X=GMTSD_" at "_GMTST
"RTN","GMTSOBE",149,0)
 Q X
"RTN","GMTSOBE",150,0)
 ;                     
"RTN","GMTSOBE",151,0)
 ; Miscellaneous
"RTN","GMTSOBE",152,0)
CRTN(X) ;   Clear Routine
"RTN","GMTSOBE",153,0)
 S X=$G(X) Q:'$L(X)  Q:$L(X)>8  Q:$$ROK(X)=0  X ^%ZOSF("DEL") Q
"RTN","GMTSOBE",154,0)
VER(X) ;   Health Summary Version
"RTN","GMTSOBE",155,0)
 N GMTSEX,GMTSTXT S X="GMTS",GMTSEX="S GMTSTXT=$T(+2^"_X_")" X GMTSEX S X=$P(GMTSTXT,";",3) Q X
"RTN","GMTSOBE",156,0)
ROK(X) ;   Routine is OK
"RTN","GMTSOBE",157,0)
 S X=$G(X) Q:'$L(X) 0
"RTN","GMTSOBE",158,0)
 N GMTSEX,GMTSTXT S GMTSEX="S GMTSTXT=$T(+1^"_X_")" X GMTSEX Q:'$L(GMTSTXT) 0 Q 1
"RTN","GMTSOBE",159,0)
CREATED(X) ;   Created Text
"RTN","GMTSOBE",160,0)
 N GMTST,GMTSN,GMTSDM,GMTSDW,GMTSDT S GMTST="$TXT",GMTSN=$$XMY S:$L(GMTSN) GMTST=GMTST_" Created by "_GMTSN
"RTN","GMTSOBE",161,0)
 S GMTSDM=$$DOM S:$L(GMTSDM) GMTST=GMTST_" at "_GMTSDM S GMTSDW=$$DOW S:$L(GMTSDW) GMTST=GMTST_" on "_GMTSDW
"RTN","GMTSOBE",162,0)
 S GMTSDT=$$NOW S:$L(GMTSDT) GMTST=GMTST_", "_GMTSDT S X=GMTST
"RTN","GMTSOBE",163,0)
 Q X
"RTN","GMTSPN2")
0^5^B47494120^B44633772
"RTN","GMTSPN2",1,0)
GMTSPN2 ; SLC/KER - Progress Note Signatures           ; 8/1/06 4:24pm
"RTN","GMTSPN2",2,0)
 ;;2.7;Health Summary;**45,47,49,82,107**;Oct 20, 1995;Build 3
"RTN","GMTSPN2",3,0)
 Q
"RTN","GMTSPN2",4,0)
 ;                          
"RTN","GMTSPN2",5,0)
 ; External References
"RTN","GMTSPN2",6,0)
 ;   DBIA 10011  ^DIWP
"RTN","GMTSPN2",7,0)
 ;   DBIA  2056  $$GET1^DIQ
"RTN","GMTSPN2",8,0)
 ;   DBIA 10060  ^VA(200, .137
"RTN","GMTSPN2",9,0)
 ;   DBIA 10060  ^VA(200, .138
"RTN","GMTSPN2",10,0)
 ;   DBIA 4081   ^TIU(8925, 1606
"RTN","GMTSPN2",11,0)
 ;   DBIA 4081   ^TIU(8925, 1613
"RTN","GMTSPN2",12,0)
 ;                     
"RTN","GMTSPN2",13,0)
WS(X,I) ; Write Signatures 
"RTN","GMTSPN2",14,0)
 Q:$D(GMTSQIT)  N GMTSDIC,GMTSIEN,GMTSA,GMTSG S GMTSDIC=$G(X),GMTSIEN=$G(I)
"RTN","GMTSPN2",15,0)
 Q:'$L(GMTSIEN)  Q:$E($P(GMTSDIC,$J,1),1,11)'="^TMP(""TIU"","  Q:'$D(@($P(GMTSDIC,",",1,($L(GMTSDIC,",")-1))_")"))
"RTN","GMTSPN2",16,0)
 Q:'$D(@(GMTSDIC_GMTSIEN_")"))  S GMTSDIC=GMTSDIC_GMTSIEN_","
"RTN","GMTSPN2",17,0)
 D UNS,SOC,SIG,UNC,COC,COS,EXT
"RTN","GMTSPN2",18,0)
 Q
"RTN","GMTSPN2",19,0)
UNS ; Unsigned/Draft Copy
"RTN","GMTSPN2",20,0)
 Q:$D(GMTSQIT)  N GMTST S GMTST=$G(@(GMTSDIC_"1501,""I"")"))
"RTN","GMTSPN2",21,0)
 I GMTST=""&($$GET1^DIQ(8925,GMTSIEN,1613,"I")="S") S GMTST=$$GET1^DIQ(8925,GMTSIEN,1606,"I") ; p.107 do not mark as unsigned if document has administrative closure date
"RTN","GMTSPN2",22,0)
 D:GMTST="" UNSIG
"RTN","GMTSPN2",23,0)
 Q
"RTN","GMTSPN2",24,0)
SOC ;   Signed on Chart
"RTN","GMTSPN2",25,0)
 Q:$D(GMTSQIT)  N GMTSP,GMTSB S GMTSP=$G(PN("SCHART"))
"RTN","GMTSPN2",26,0)
 S GMTSB=$G(PN("SCHARTBY")) Q:'$L(GMTSP)  Q:'$L(GMTSB)
"RTN","GMTSPN2",27,0)
 D BL Q:$D(GMTSQIT)  D BY(GMTSP,"",GMTSB) Q:$D(GMTSQIT)
"RTN","GMTSPN2",28,0)
 Q
"RTN","GMTSPN2",29,0)
SIG ;   Signature Block, Name, Title and Date
"RTN","GMTSPN2",30,0)
 Q:$D(GMTSQIT)  N GMTSA,GMTSG,GMTSE,GMTST,GMTSD,GMTSP,GMTSB
"RTN","GMTSPN2",31,0)
 S GMTSP="Signed by:",GMTSE=$G(@(GMTSDIC_"1505,""I"")"))
"RTN","GMTSPN2",32,0)
 S GMTSB=$G(PN("SIGBLK")) Q:'$L(GMTSB)  S GMTST=$G(PN("STITLE"))
"RTN","GMTSPN2",33,0)
 S GMTSD=$G(PN("SIGDT")),GMTSA=$$GET1^DIQ(200,+($G(SIGNEDBY)),.137)
"RTN","GMTSPN2",34,0)
 S GMTSG=$$GET1^DIQ(200,+($G(SIGNEDBY)),.138) D BL Q:$D(GMTSQIT)
"RTN","GMTSPN2",35,0)
 D BY(GMTSP,GMTSE,GMTSB) Q:$D(GMTSQIT)  D SB(GMTST,GMTSD) Q:$D(GMTSQIT)
"RTN","GMTSPN2",36,0)
 D PG(GMTSA,GMTSG) Q:$D(GMTSQIT)
"RTN","GMTSPN2",37,0)
 Q
"RTN","GMTSPN2",38,0)
UNC ;   Uncosigned - Requires Cosignature
"RTN","GMTSPN2",39,0)
 Q:$D(GMTSQIT)  N GMTSP,GMTSB
"RTN","GMTSPN2",40,0)
 S GMTSP=$G(@(GMTSDIC_".05,""E"")")) Q:GMTSP'="UNCOSIGNED"
"RTN","GMTSPN2",41,0)
 Q:$E($G(GMTSTIUC),1)["D"&('CONEED)  D BL Q:$D(GMTSQIT)
"RTN","GMTSPN2",42,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !?27,"** REQUIRES COSIGNATURE **"
"RTN","GMTSPN2",43,0)
 Q
"RTN","GMTSPN2",44,0)
COC ;   Cosigned on Chart
"RTN","GMTSPN2",45,0)
 Q:$D(GMTSQIT)  N GMTSP,GMTSB
"RTN","GMTSPN2",46,0)
 S GMTSP=$G(PN("COCHART")),GMTSB=$G(PN("COCHARTBY")) Q:'$L(GMTSP)  Q:'$L(GMTSB)
"RTN","GMTSPN2",47,0)
 Q:$E($G(GMTSTIUC),1)["D"&('CONEED)  D BL Q:$D(GMTSQIT)  D BY(GMTSP,"",GMTSB)
"RTN","GMTSPN2",48,0)
 Q
"RTN","GMTSPN2",49,0)
COS ;   Co-Signature Block, Name, Title and Date
"RTN","GMTSPN2",50,0)
 Q:$D(GMTSQIT)  N GMTSA,GMTSG,GMTSE,GMTST,GMTSD,GMTSP,GMTSB
"RTN","GMTSPN2",51,0)
 S GMTSP="Cosigned by:",GMTSE=$G(@(GMTSDIC_"1511,""I"")")),GMTSB=$G(PN("COBLK")) Q:'$L(GMTSB)
"RTN","GMTSPN2",52,0)
 S GMTST=$G(PN("COTITLE")),GMTSD=$G(PN("COSDT"))
"RTN","GMTSPN2",53,0)
 S GMTSA=$$GET1^DIQ(200,+($G(COSGEDBY)),.137),GMTSG=$$GET1^DIQ(200,+($G(COSGEDBY)),.138)
"RTN","GMTSPN2",54,0)
 Q:$E($G(GMTSTIUC),1)["D"&('CONEED)  D BL Q:$D(GMTSQIT)
"RTN","GMTSPN2",55,0)
 D BY(GMTSP,GMTSE,GMTSB) Q:$D(GMTSQIT)  D SB(GMTST,GMTSD) Q:$D(GMTSQIT)
"RTN","GMTSPN2",56,0)
 D PG(GMTSA,GMTSG)
"RTN","GMTSPN2",57,0)
 Q
"RTN","GMTSPN2",58,0)
EXT ;   Extra Signatures
"RTN","GMTSPN2",59,0)
 ;     Receipt Acknowledged by:
"RTN","GMTSPN2",60,0)
 Q:$D(GMTSQIT)  I +$O(@(GMTSDIC_"""EXTRASGNR"",0)")) D  Q:$D(GMTSQIT)
"RTN","GMTSPN2",61,0)
 . D BL Q:$D(GMTSQIT)  D BY("Receipt Acknowledged by:","","")
"RTN","GMTSPN2",62,0)
 ;     Extra Signature Block, Name, Title and Date
"RTN","GMTSPN2",63,0)
 N GMTSXTRA S GMTSXTRA=0
"RTN","GMTSPN2",64,0)
 F  S GMTSXTRA=+$O(@(GMTSDIC_"""EXTRASGNR"","_GMTSXTRA_")")) Q:+GMTSXTRA'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPN2",65,0)
 . N GMTSA,GMTSG,GMTSE,GMTST,GMTSD,GMTSP,GMTSB,GMTSI,GMTSC
"RTN","GMTSPN2",66,0)
 . S GMTSC=+($G(@(GMTSDIC_"""EXTRASGNR"","_GMTSXTRA_",""DATE"")")))
"RTN","GMTSPN2",67,0)
 . I GMTSC'>0 W ?27,"* AWAITING SIGNATURE *" D BL Q
"RTN","GMTSPN2",68,0)
 . S GMTSP="",GMTSE="/es/",GMTSB=$G(@(GMTSDIC_"""EXTRASGNR"","_GMTSXTRA_",""NAME"")")) Q:'$L(GMTSB)
"RTN","GMTSPN2",69,0)
 . S GMTST=$G(@(GMTSDIC_"""EXTRASGNR"","_GMTSXTRA_",""TITLE"")"))
"RTN","GMTSPN2",70,0)
 . S GMTSD=$$EDT^GMTSU(GMTSC),GMTSI=+($G(@(GMTSDIC_"""EXTRASGNR"","_GMTSXTRA_",""EXTRA"")")))
"RTN","GMTSPN2",71,0)
 . S GMTSA=$$GET1^DIQ(200,+($G(GMTSI)),.137),GMTSG=$$GET1^DIQ(200,+($G(GMTSI)),.138)
"RTN","GMTSPN2",72,0)
 . I +($G(GMTSXTRA))>1 D BL Q:$D(GMTSQIT)  D BL Q:$D(GMTSQIT)
"RTN","GMTSPN2",73,0)
 . D BY(GMTSP,GMTSE,GMTSB) Q:$D(GMTSQIT)
"RTN","GMTSPN2",74,0)
 . D SB(GMTST,GMTSD) Q:$D(GMTSQIT)  D PG(GMTSA,GMTSG) Q:$D(GMTSQIT)
"RTN","GMTSPN2",75,0)
 Q
"RTN","GMTSPN2",76,0)
 ;                      
"RTN","GMTSPN2",77,0)
UNSIG ; Unsigned Note
"RTN","GMTSPN2",78,0)
 N GMTS,GMTS1,GMTS2,GMTST,GMTSB S GMTST="<  THE ABOVE NOTE IS UNSIGNED  >",GMTS=""
"RTN","GMTSPN2",79,0)
 S $P(GMTS," ",((79-$L(GMTST))\2)\2)=" ",$P(GMTS1," ",((79-$L(GMTST))\2)\2)=" "
"RTN","GMTSPN2",80,0)
 S GMTS2=GMTS_GMTS1,GMTS1=GMTS1_GMTS,GMTSB=GMTS1_GMTST_GMTS2
"RTN","GMTSPN2",81,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ! D CKP^GMTSUP Q:$D(GMTSQIT)  W !,GMTSB
"RTN","GMTSPN2",82,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"- DRAFT COPY * DRAFT COPY * DRAFT COPY * DRAFT COPY * DRAFT COPY * DRAFT COPY -"
"RTN","GMTSPN2",83,0)
 Q
"RTN","GMTSPN2",84,0)
 ;                        
"RTN","GMTSPN2",85,0)
 ; Warnings
"RTN","GMTSPN2",86,0)
WARN1 ;   Beginning of Note
"RTN","GMTSPN2",87,0)
 N GMTSD,GMTSW S GMTSW=1,GMTSD=0 D DEL1,RETR1 D:GMTSD BL Q
"RTN","GMTSPN2",88,0)
WARN2 ;   End of Note
"RTN","GMTSPN2",89,0)
 N GMTSD,GMTSW S GMTSW=2,GMTSD=0 D DEL2,RETR2 Q
"RTN","GMTSPN2",90,0)
DEL1 ;     Deleted Note (begin)
"RTN","GMTSPN2",91,0)
 Q:($G(STATUS)'="DELETED")&($G(PN("STATUS"))'="DELETED")
"RTN","GMTSPN2",92,0)
 N GMTST,GMTST2 S GMTST="<  THE FOLLOWING ENTRY HAS BEEN DELETED >",GMTST2="<<<<< DELETED  *  DELETED  *  DELETED  *  DELETED  *  DELETED  *  DELETED >>>>>" D WARN3 Q
"RTN","GMTSPN2",93,0)
DEL2 ;     Deleted Note (end)
"RTN","GMTSPN2",94,0)
 Q:($G(STATUS)'="DELETED")&($G(PN("STATUS"))'="DELETED")
"RTN","GMTSPN2",95,0)
 N GMTST,GMTST2 S GMTST="<  THE ABOVE ENTRY HAS BEEN DELETED >",GMTST2="<<<<< DELETED  *  DELETED  *  DELETED  *  DELETED  *  DELETED  *  DELETED >>>>>" D WARN3 Q
"RTN","GMTSPN2",96,0)
RETR1 ;     Retracted Note (begin)
"RTN","GMTSPN2",97,0)
 Q:($G(STATUS)'="RETRACTED")&($G(PN("STATUS"))'="RETRACTED")
"RTN","GMTSPN2",98,0)
 N GMTST,GMTST2 S GMTST="<  THE FOLLOWING ENTRY HAS BEEN RETRACTED >",GMTST2="<<<<<< RETRACTED  *  RETRACTED  *  RETRACTED  *  RETRACTED  *  RETRACTED >>>>>>" D WARN3 Q
"RTN","GMTSPN2",99,0)
RETR2 ;     Retracted Note (end)
"RTN","GMTSPN2",100,0)
 Q:($G(STATUS)'="RETRACTED")&($G(PN("STATUS"))'="RETRACTED")
"RTN","GMTSPN2",101,0)
 N GMTST,GMTST2 S GMTST="<  THE ABOVE ENTRY HAS BEEN RETRACTED >",GMTST2="<<<<<< RETRACTED  *  RETRACTED  *  RETRACTED  *  RETRACTED  *  RETRACTED >>>>>>" D WARN3 Q
"RTN","GMTSPN2",102,0)
WARN3 ;   Warning Display (display)
"RTN","GMTSPN2",103,0)
 N GMTS,GMTS1,GMTS2,GMTSB S GMTS="",GMTST=$G(GMTST),GMTST2=$G(GMTST2) Q:'$L(GMTST)  Q:'$L(GMTST2)
"RTN","GMTSPN2",104,0)
 S $P(GMTS,"<",((79-$L(GMTST))\2)\2)="<"
"RTN","GMTSPN2",105,0)
 S $P(GMTS1,"<",((79-$L(GMTST))\2)\2)="<",GMTS1=GMTS_GMTS1,GMTS=""
"RTN","GMTSPN2",106,0)
 S $P(GMTS,">",((79-$L(GMTST))\2)\2)=">"
"RTN","GMTSPN2",107,0)
 S $P(GMTS2,">",((79-$L(GMTST))\2)\2)=">",GMTS2=GMTS2_GMTS,GMTS=""
"RTN","GMTSPN2",108,0)
 S GMTSB=GMTS1_GMTST_GMTS2 F  Q:$L(GMTSB)'<$L(GMTST2)  S GMTSB=GMTSB_">"
"RTN","GMTSPN2",109,0)
 I +($G(GMTSW))=2 D BL Q:$D(GMTSQIT)
"RTN","GMTSPN2",110,0)
 I +($G(GMTSW))=1 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,GMTSB
"RTN","GMTSPN2",111,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,GMTST2 S:$D(GMTSD) GMTSD=1
"RTN","GMTSPN2",112,0)
 I +($G(GMTSW))=2 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,GMTSB
"RTN","GMTSPN2",113,0)
 Q
"RTN","GMTSPN2",114,0)
 ;                   
"RTN","GMTSPN2",115,0)
 ; Miscelaneous
"RTN","GMTSPN2",116,0)
BY(GMTSH,GMTSE,GMTSN) ; Signed by
"RTN","GMTSPN2",117,0)
 S GMTSH=$$TRIM($G(GMTSH)),GMTSE=$G(GMTSE),GMTSN=$G(GMTSN) Q:'$L((GMTSH_GMTSN))
"RTN","GMTSPN2",118,0)
 S:$L(GMTSH) GMTSH=GMTSH_"  " S GMTSE=$S(GMTSE="E":"/es/  ",GMTSE["/es/":"/es/  ",1:"") S:GMTSN="."&(GMTSH[" by:") GMTSH=$P(GMTSH," by:",1)_".",GMTSN="" S:GMTSN="." GMTSN=""
"RTN","GMTSPN2",119,0)
 I $L($$TRIM(GMTSH)) D CKP^GMTSUP Q:$D(GMTSQIT)  W !,$J("",(27-$L(GMTSH))),GMTSH
"RTN","GMTSPN2",120,0)
 W ?27,GMTSE,GMTSN
"RTN","GMTSPN2",121,0)
 Q
"RTN","GMTSPN2",122,0)
SB(GMTSB,GMTSD) ; Signature Block
"RTN","GMTSPN2",123,0)
 K ^UTILITY($J,"W") N X,DIWT,DIWL,DIWR,DIWF,GMTSI
"RTN","GMTSPN2",124,0)
 S (X,GMTSB)=$G(GMTSB),GMTSD=$G(GMTSD) Q:'$L((GMTSB_GMTSD))
"RTN","GMTSPN2",125,0)
 S GMTSI=1,DIWL=0,DIWF="C51" D ^DIWP S GMTSB=$$TRIM($G(^UTILITY($J,"W",0,1,0))) K:'$L(GMTSB) ^UTILITY($J,"W")
"RTN","GMTSPN2",126,0)
 I $L(GMTSD),'$L(GMTSB) K ^UTILITY($J,"W") D CKP^GMTSUP Q:$D(GMTSQIT)  W !,?27,GMTSD Q
"RTN","GMTSPN2",127,0)
 Q:'$L(GMTSB)  D CKP^GMTSUP K:$D(GMTSQIT) ^UTILITY($J,"W") Q:$D(GMTSQIT)  W !,?27,GMTSB,!,?27,GMTSD
"RTN","GMTSPN2",128,0)
 K ^UTILITY($J,"W")
"RTN","GMTSPN2",129,0)
 Q
"RTN","GMTSPN2",130,0)
PG(GMTSA,GMTSD) ; Pagers
"RTN","GMTSPN2",131,0)
 N GMTS S GMTS=0,GMTSA=$G(GMTSA),GMTSD=$G(GMTSD) Q:'$L((GMTSA_GMTSD))  Q:(+GMTSA+GMTSD)'>0
"RTN","GMTSPN2",132,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ! I $L(GMTSA),+GMTSA>0 D  Q:$D(GMTSQIT)
"RTN","GMTSPN2",133,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !?34,"Analog Pager:  ",GMTSA S GMTS=1
"RTN","GMTSPN2",134,0)
 I $L(GMTSD),+GMTSD>0 D  Q:$D(GMTSQIT)
"RTN","GMTSPN2",135,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !?33,"Digital Pager:  ",GMTSD S GMTS=1
"RTN","GMTSPN2",136,0)
 Q
"RTN","GMTSPN2",137,0)
BL ;   Blank Line
"RTN","GMTSPN2",138,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ! Q
"RTN","GMTSPN2",139,0)
TRIM(X) ;   Trim Spaces from String
"RTN","GMTSPN2",140,0)
 S X=$G(X) F  Q:$E(X,1)'=" "  S X=$E(X,2,$L(X))
"RTN","GMTSPN2",141,0)
 F  Q:$E(X,$L(X))'=" "  S X=$E(X,1,($L(X)-1))
"RTN","GMTSPN2",142,0)
 Q X
"RTN","GMTSVS")
0^1^B51081616^B40018918
"RTN","GMTSVS",1,0)
GMTSVS ; SLC/KER - Vital Signs Component          ; 02/27/2002
"RTN","GMTSVS",2,0)
 ;;2.7;Health Summary;**8,20,28,35,49,78,107**;Oct 20, 1995;Build 3
"RTN","GMTSVS",3,0)
 ;                          
"RTN","GMTSVS",4,0)
 ; External References
"RTN","GMTSVS",5,0)
 ;   DBIA  4791  EN1^GMVHS
"RTN","GMTSVS",6,0)
 ;   DBIA 10141  $$VERSION^XPDUTL
"RTN","GMTSVS",7,0)
 ;                    
"RTN","GMTSVS",8,0)
 ; Health Summary patch GMTS*2.7*35 will require 
"RTN","GMTSVS",9,0)
 ; Vitals version 4.0, patch GMRV*4.0*7
"RTN","GMTSVS",10,0)
 ;                          
"RTN","GMTSVS",11,0)
OUTPAT ; Outpatient Vital Signs Main Control
"RTN","GMTSVS",12,0)
 N GMRVSTR
"RTN","GMTSVS",13,0)
 S CNTR=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:100)
"RTN","GMTSVS",14,0)
 K ^UTILITY($J,"GMRVD"),ARRAY
"RTN","GMTSVS",15,0)
 S T1=GMTSEND,T2=GMTSBEG,END=0,TN=0,LF=0
"RTN","GMTSVS",16,0)
 S GMRVSTR="T"_";"_"P"_";"_"R"_";"_"BP"_";"_"HT"_";"_"WT"_";"_"CVP"_";"_"PO2"_";"_"CG"_";"_"PN"
"RTN","GMTSVS",17,0)
 S GMRVSTR(0)=T2_"^"_T1_"^"_CNTR_"^"_1
"RTN","GMTSVS",18,0)
 S GMRVSTR("LT")="^C^" ;Set to only get Vital Sign for Clinics
"RTN","GMTSVS",19,0)
 ;D EN1^GMRVUT0
"RTN","GMTSVS",20,0)
 D EN1^GMVHS
"RTN","GMTSVS",21,0)
 ; If no data, display message and get
"RTN","GMTSVS",22,0)
 ; most recent inpatient measurements
"RTN","GMTSVS",23,0)
 I '$D(^UTILITY($J,"GMRVD")) D  Q
"RTN","GMTSVS",24,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W "*** No Outpatient measurements ***",!!
"RTN","GMTSVS",25,0)
 . S CNTR=1 D ENVS
"RTN","GMTSVS",26,0)
 D FIRST,SECOND:GMTSVMVR>3,THIRD:GMTSVMVR>3,KILLVS Q  ;p.107 moved pain to a third line and changed 99 to "Unable to respond"
"RTN","GMTSVS",27,0)
 ;                          
"RTN","GMTSVS",28,0)
ENVS ; Set up for Vitals Extraction Routine
"RTN","GMTSVS",29,0)
 S CNTR=$S(+($G(CNTR))>0:+($G(CNTR)),+($G(CNTR))'>0&(+($G(GMTSNDM))>0):+($G(GMTSNDM)),1:100)
"RTN","GMTSVS",30,0)
 K ^UTILITY($J,"GMRVD"),ARRAY,GMRVSTR("LT")
"RTN","GMTSVS",31,0)
 S T1=GMTSEND,T2=GMTSBEG,END=0,TN=0,LF=0
"RTN","GMTSVS",32,0)
 S GMRVSTR="T"_";"_"P"_";"_"R"_";"_"BP"_";"_"HT"_";"_"WT"_";"_"CVP"_";"_"PO2"_";"_"CG"_";"_"PN"
"RTN","GMTSVS",33,0)
 S GMRVSTR(0)=T2_"^"_T1_"^"_CNTR_"^"_1
"RTN","GMTSVS",34,0)
 ;D EN1^GMRVUT0 I '$D(^UTILITY($J,"GMRVD")) D KILLVS Q
"RTN","GMTSVS",35,0)
 D EN1^GMVHS I '$D(^UTILITY($J,"GMRVD")) D KILLVS Q
"RTN","GMTSVS",36,0)
 D FIRST,SECOND:GMTSVMVR>3,THIRD:GMTSVMVR>3,KILLVS Q  ;p.107 moved pain to a third line and changed 99 to "Unable to respond"
"RTN","GMTSVS",37,0)
 ;                          
"RTN","GMTSVS",38,0)
FIRST ; First Set of Vitals
"RTN","GMTSVS",39,0)
 ;  1     2      3     4   5     6       7         8
"RTN","GMTSVS",40,0)
 ; Date^Temp()^Pulse^Respt^BP^Height()^Weight()^Control
"RTN","GMTSVS",41,0)
 N GMW,GMTSCCNT,GMTSCTL S CNTR("HOLDER")=CNTR S GMTSVMVR=$$VERSION^XPDUTL("GMRV")
"RTN","GMTSVS",42,0)
 I GMTSVMVR'>3 D  Q:$D(GMTSQIT)
"RTN","GMTSVS",43,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W "Measurement DT",?20,"TEMP",?29,"PULSE",?36,"RESP",?45,"BP",?55,"HT",?68,"WT",!
"RTN","GMTSVS",44,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?20,"F(C)",?55,"IN(CM)",?68,"LB(KG)",!
"RTN","GMTSVS",45,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?20,"----",?29,"-----",?36,"----",?45,"--",?55,"------",?68,"------",!!
"RTN","GMTSVS",46,0)
 I GMTSVMVR>3 D  Q:$D(GMTSQIT)
"RTN","GMTSVS",47,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W "Measurement DT",?18,"TEMP",?30,"PULSE",?36,"RESP",?41,"BP",?53,"HT",?63,"WT",!
"RTN","GMTSVS",48,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?18,"F(C)",?53,"IN(CM)",?63,"LB(KG)[BMI]",!
"RTN","GMTSVS",49,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W ?18,"----",?30,"-----",?36,"----",?41,"--",?53,"------",?63,"-----------",!!
"RTN","GMTSVS",50,0)
 S GMTSCCNT=0,GMT="" F  S GMT=$O(^UTILITY($J,"GMRVD",GMT)) Q:GMT<0!(GMT="")!(END=1)  D FLOOP,FWRT
"RTN","GMTSVS",51,0)
 W:GMTSCCNT=0 "No data",!
"RTN","GMTSVS",52,0)
 Q
"RTN","GMTSVS",53,0)
FLOOP ;   Loop through first set of vitals by date
"RTN","GMTSVS",54,0)
 S (GMTSCTL,GMTSVT)=""
"RTN","GMTSVS",55,0)
 F  S GMTSVT=$O(^UTILITY($J,"GMRVD",GMT,GMTSVT)) Q:GMTSVT=""  S IEN=$O(^UTILITY($J,"GMRVD",GMT,GMTSVT,0)) D FFMT
"RTN","GMTSVS",56,0)
 Q
"RTN","GMTSVS",57,0)
FFMT ;   Extract and format first set of vitals
"RTN","GMTSVS",58,0)
 S GMTSVS=^UTILITY($J,"GMRVD",GMT,GMTSVT,IEN),X=$P(GMTSVS,U,1) D REGDT4^GMTSU S TDT=X
"RTN","GMTSVS",59,0)
 S X=$P(GMTSVS,U,1) D MTIM^GMTSU S TI=X S TDT=TDT_" "_TI,$P(ARRAY,U,1)=TDT
"RTN","GMTSVS",60,0)
 S GMTAB=$S(GMTSVT="T":2,GMTSVT="P":3,GMTSVT="R":4,GMTSVT="BP":5,GMTSVT="HT":6,GMTSVT="WT":7,1:0)
"RTN","GMTSVS",61,0)
 I GMTAB="2" S $P(ARRAY,U,GMTAB)=$$FN($P(GMTSVS,U,8),1)_"("_$$FN($P(GMTSVS,U,13),1)_")"
"RTN","GMTSVS",62,0)
 I GMTAB="6" S $P(ARRAY,U,GMTAB)=$$FN($P(GMTSVS,U,8),1)_"("_$$FN($P(GMTSVS,U,13),0)_")"
"RTN","GMTSVS",63,0)
 I GMTAB="7" S $P(ARRAY,U,GMTAB)=$$FN($P(GMTSVS,U,8),0)_"("_$$FN($P(GMTSVS,U,13),1)_")"
"RTN","GMTSVS",64,0)
 I "^2^7^"[GMTAB,$P(GMTSVS,U,8)?1A.E S $P(ARRAY,U,GMTAB)=$P(GMTSVS,U,8)
"RTN","GMTSVS",65,0)
 I GMTAB=6,$P(GMTSVS,U,8)?1A.E S $P(ARRAY,U,GMTAB)=$E($P(GMTSVS,U,8),1,9)
"RTN","GMTSVS",66,0)
 I "^2^6^7^"'[GMTAB S $P(ARRAY,U,GMTAB)=$P(GMTSVS,U,8)
"RTN","GMTSVS",67,0)
 I GMTAB=3,$P(ARRAY,U,GMTAB)?1A.E S $P(ARRAY,U,GMTAB)=$E($P(ARRAY,U,GMTAB),1,5)
"RTN","GMTSVS",68,0)
 I GMTAB=4,$P(ARRAY,U,GMTAB)?1A.E S $P(ARRAY,U,GMTAB)=$E($P(ARRAY,U,GMTAB),1,4)
"RTN","GMTSVS",69,0)
 ;I "^3^4^5^"[GMTAB,$P(ARRAY,U,GMTAB)?1A.E S $P(ARRAY,U,GMTAB)=$E($P(ARRAY,U,GMTAB),1,7)
"RTN","GMTSVS",70,0)
 I GMTAB=7,$P(GMTSVS,U,14)]"" S $P(ARRAY,U,GMTAB)=$P(ARRAY,U,GMTAB)_"["_$P(GMTSVS,U,14)_"]"
"RTN","GMTSVS",71,0)
 S:GMTAB>1 GMTSCTL=GMTSCTL_$P(ARRAY,U,GMTAB),$P(ARRAY,U,8)=GMTSCTL
"RTN","GMTSVS",72,0)
 Q
"RTN","GMTSVS",73,0)
FWRT ;   Write first set of vitals by date
"RTN","GMTSVS",74,0)
 Q:$P($G(ARRAY),U,8)=""  S GMTSCCNT=$G(GMTSCCNT)+1
"RTN","GMTSVS",75,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSVS",76,0)
 I GMTSVMVR'>3 W $P(ARRAY,U,1),?18,$P(ARRAY,U,2),?30,$P(ARRAY,U,3),?37,$P(ARRAY,U,4),?42,$P(ARRAY,U,5),?54,$P(ARRAY,U,6),?67,$P(ARRAY,U,7),!
"RTN","GMTSVS",77,0)
 I GMTSVMVR>3 W $P(ARRAY,U,1),?18,$P(ARRAY,U,2),?30,$P(ARRAY,U,3),?36,$P(ARRAY,U,4),?41,$P(ARRAY,U,5),?53,$P(ARRAY,U,6),?63,$P(ARRAY,U,7),!
"RTN","GMTSVS",78,0)
 S CNTR=CNTR-1 I CNTR=0 S END=1
"RTN","GMTSVS",79,0)
 K ARRAY
"RTN","GMTSVS",80,0)
 Q
"RTN","GMTSVS",81,0)
 ;                          
"RTN","GMTSVS",82,0)
SECOND ; Second Set of Vitals
"RTN","GMTSVS",83,0)
 ;  1    2   3     4       5
"RTN","GMTSVS",84,0)
 ; Date^CVP^POx^Cir/Gir^Control
"RTN","GMTSVS",85,0)
 N GMW,GMTSCCNT,GMTSCTL S (GMTSCCNT,END)=0,CNTR=CNTR("HOLDER")
"RTN","GMTSVS",86,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSVS",87,0)
 W !,"Measurement DT",?18,"CVP",?32,"POx",?45,"CG"
"RTN","GMTSVS",88,0)
 W !,?18,"CMH20(MMHG)",?32,"(L/MIN)(%)",?45,"IN(CM)",!,?18,"-----------",?32,"----------",?45,"------",!!
"RTN","GMTSVS",89,0)
 S GMT="" F  S GMT=$O(^UTILITY($J,"GMRVD",GMT)) Q:GMT<0!(GMT="")!(END=1)  D SLOOP,SWRT
"RTN","GMTSVS",90,0)
 W:GMTSCCNT=0 "No data",!
"RTN","GMTSVS",91,0)
 Q
"RTN","GMTSVS",92,0)
SLOOP ;   Loop through second set of vitals by date
"RTN","GMTSVS",93,0)
 S (GMTSCTL,GMTSVT)="" F  S GMTSVT=$O(^UTILITY($J,"GMRVD",GMT,GMTSVT)) Q:GMTSVT=""  S IEN=$O(^UTILITY($J,"GMRVD",GMT,GMTSVT,0)) D SFMT
"RTN","GMTSVS",94,0)
 Q
"RTN","GMTSVS",95,0)
SFMT ;   Extract and format second set of vitals
"RTN","GMTSVS",96,0)
 S GMTSVS=^UTILITY($J,"GMRVD",GMT,GMTSVT,IEN)
"RTN","GMTSVS",97,0)
 S X=$P(GMTSVS,U,1) D REGDT4^GMTSU S TDT=X S X=$P(GMTSVS,U,1) D MTIM^GMTSU S TI=X S TDT=TDT_" "_TI,$P(ARRAY,U,1)=TDT
"RTN","GMTSVS",98,0)
 S GMTAB=$S(GMTSVT="CVP":2,GMTSVT="PO2":3,GMTSVT="CG":4,1:0)
"RTN","GMTSVS",99,0)
 S $P(ARRAY,U,GMTAB)=$P(GMTSVS,U,8)
"RTN","GMTSVS",100,0)
 I GMTAB=2 S $P(ARRAY,U,GMTAB)=$P(ARRAY,U,GMTAB)_$S($P(ARRAY,U,GMTAB)?1A.E:"",1:"("_$P(GMTSVS,U,13)_")")
"RTN","GMTSVS",101,0)
 I GMTAB=3 S $P(ARRAY,U,GMTAB)=$P(ARRAY,U,GMTAB)_$S($P(ARRAY,U,GMTAB)?1A.E:"",($P($G(GMTSVS),U,15)="")&($P($G(GMTSVS),U,16)=""):"",1:"("_$P(GMTSVS,U,15)_")("_$P(GMTSVS,U,16)_")")
"RTN","GMTSVS",102,0)
 I GMTAB=4 S $P(ARRAY,U,GMTAB)=$P(ARRAY,U,GMTAB)_$S($P(ARRAY,U,GMTAB)?1A.E:"",1:"("_$$FN($P(GMTSVS,U,13),0)_")"_$S($P(GMTSVS,U,17)]"":"["_$P(GMTSVS,U,17)_"]",1:""))
"RTN","GMTSVS",103,0)
 S:GMTAB>1 GMTSCTL=$G(GMTSCTL)_$P($G(ARRAY),U,GMTAB),$P(ARRAY,U,5)=GMTSCTL
"RTN","GMTSVS",104,0)
 Q
"RTN","GMTSVS",105,0)
SWRT ;   Write second set of vitals by date
"RTN","GMTSVS",106,0)
 Q:$P($G(ARRAY),U,5)=""
"RTN","GMTSVS",107,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSVS",108,0)
 I GMTSNPG=1 D
"RTN","GMTSVS",109,0)
 . W !,"Measurement DT",?18,"CVP",?34,"POx",?46,"CG"
"RTN","GMTSVS",110,0)
 . W !,?18,"CMH20(MMHG)",?32,"(L/MIN)(%)",?45,"IN(CM)",!,?18,"-----------",?32,"----------",?45,"------",!!
"RTN","GMTSVS",111,0)
 S GMTSCCNT=$G(GMTSCCNT)+1
"RTN","GMTSVS",112,0)
 W $P(ARRAY,U,1),?18,$P(ARRAY,U,2),?32,$P(ARRAY,U,3),?45,$P(ARRAY,U,4),!
"RTN","GMTSVS",113,0)
 S CNTR=CNTR-1 I CNTR=0 S END=1
"RTN","GMTSVS",114,0)
 K ARRAY
"RTN","GMTSVS",115,0)
 Q
"RTN","GMTSVS",116,0)
THIRD ; Third Set of Vitals 
"RTN","GMTSVS",117,0)
 ;p.107 moved pain to a third line and changed 99 to "Unable to respond"
"RTN","GMTSVS",118,0)
 ;  1     2     3
"RTN","GMTSVS",119,0)
 ; Date^Pain^Control
"RTN","GMTSVS",120,0)
 N GMW,GMTSCCNT,GMTSCTL S (GMTSCCNT,END)=0,CNTR=CNTR("HOLDER")
"RTN","GMTSVS",121,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSVS",122,0)
 W !,"Measurement DT",?18,"Pain"
"RTN","GMTSVS",123,0)
 W !,?18,"----",!!
"RTN","GMTSVS",124,0)
 S GMT="" F  S GMT=$O(^UTILITY($J,"GMRVD",GMT)) Q:GMT<0!(GMT="")!(END=1)  D TLOOP,TWRT
"RTN","GMTSVS",125,0)
 W:GMTSCCNT=0 "No data",!
"RTN","GMTSVS",126,0)
 Q
"RTN","GMTSVS",127,0)
TLOOP ; Loop through third set of vitals by date
"RTN","GMTSVS",128,0)
 S (GMTSCTL,GMTSVT)="" F  S GMTSVT=$O(^UTILITY($J,"GMRVD",GMT,GMTSVT)) Q:GMTSVT=""  S IEN=$O(^UTILITY($J,"GMRVD",GMT,GMTSVT,0)) D TFMT
"RTN","GMTSVS",129,0)
 Q
"RTN","GMTSVS",130,0)
TFMT ; Extract and format third set of vitals
"RTN","GMTSVS",131,0)
 S GMTSVS=^UTILITY($J,"GMRVD",GMT,GMTSVT,IEN)
"RTN","GMTSVS",132,0)
 S X=$P(GMTSVS,U,1) D REGDT4^GMTSU S TDT=X S X=$P(GMTSVS,U,1) D MTIM^GMTSU S TI=X S TDT=TDT_" "_TI,$P(ARRAY,U,1)=TDT
"RTN","GMTSVS",133,0)
 S GMTAB=$S(GMTSVT="PN":2,1:0)
"RTN","GMTSVS",134,0)
 S $P(ARRAY,U,GMTAB)=$P(GMTSVS,U,8)
"RTN","GMTSVS",135,0)
 I GMTAB=2 D
"RTN","GMTSVS",136,0)
 .S $P(ARRAY,U,GMTAB)=$S($L($P(ARRAY,U,GMTAB))&(+($P(ARRAY,U,GMTAB))=0):$P(ARRAY,U,GMTAB),$L($P(ARRAY,U,GMTAB))&(+($P(ARRAY,U,GMTAB))'=99):$$FN($P(ARRAY,U,GMTAB),0),$L($P(ARRAY,U,GMTAB))&(+($P(ARRAY,U,GMTAB))=99):"Unable to Respond",1:"")
"RTN","GMTSVS",137,0)
 S:GMTAB>1 GMTSCTL=$G(GMTSCTL)_$P($G(ARRAY),U,GMTAB),$P(ARRAY,U,3)=GMTSCTL
"RTN","GMTSVS",138,0)
 Q
"RTN","GMTSVS",139,0)
TWRT ; Write third set of vitals by date
"RTN","GMTSVS",140,0)
 Q:$P($G(ARRAY),U,3)=""
"RTN","GMTSVS",141,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSVS",142,0)
 I GMTSNPG=1 D
"RTN","GMTSVS",143,0)
 . W !,"Measurement DT",?18,"Pain"
"RTN","GMTSVS",144,0)
 . W !,?18,"----",!!
"RTN","GMTSVS",145,0)
 S GMTSCCNT=$G(GMTSCCNT)+1
"RTN","GMTSVS",146,0)
 W $P(ARRAY,U,1),?18,$P(ARRAY,U,2),!
"RTN","GMTSVS",147,0)
 S CNTR=CNTR-1 I CNTR=0 S END=1
"RTN","GMTSVS",148,0)
 K ARRAY
"RTN","GMTSVS",149,0)
 Q
"RTN","GMTSVS",150,0)
 ;
"RTN","GMTSVS",151,0)
KILLVS ; Kill Variables
"RTN","GMTSVS",152,0)
 K CNTR,T1,T2,TDT,TI,END,TN,IEN,LF,GMTSVMVR,GMTSVS,GMTSVT,GMT,ARRAY,GMTAB,X
"RTN","GMTSVS",153,0)
 K ^UTILITY($J,"GMRVD")
"RTN","GMTSVS",154,0)
 Q
"RTN","GMTSVS",155,0)
FN(X,Y) ; Format Number 
"RTN","GMTSVS",156,0)
 N VAL S VAL=+($G(X)),Y=$G(Y) Q:+Y'=Y X
"RTN","GMTSVS",157,0)
 S X=$FN(VAL,"",Y) Q X
"RTN","GMTSVSD")
0^2^B59713312^B58460028
"RTN","GMTSVSD",1,0)
GMTSVSD ; SLC/KER - Vital Signs (Detailed)           ; 01/06/2003
"RTN","GMTSVSD",2,0)
 ;;2.7;Health Summary;**35,49,58,78,107**;Oct 20, 1995;Build 3
"RTN","GMTSVSD",3,0)
 ;                          
"RTN","GMTSVSD",4,0)
 ; External References
"RTN","GMTSVSD",5,0)
 ;   DBIA  4791  EN1^GMVHS
"RTN","GMTSVSD",6,0)
 ;   DBIA 10141  $$VERSION^XPDUTL
"RTN","GMTSVSD",7,0)
 ;   DBIA 10103  $$NOW^XLFDT
"RTN","GMTSVSD",8,0)
 ;                    
"RTN","GMTSVSD",9,0)
 ; Health Summary patch GMTS*2.7*35 will require 
"RTN","GMTSVSD",10,0)
 ; Vitals version 4.0, patch GMRV*4.0*7
"RTN","GMTSVSD",11,0)
 ;                     
"RTN","GMTSVSD",12,0)
 Q
"RTN","GMTSVSD",13,0)
EN ; Detailed Vital Signs main control
"RTN","GMTSVSD",14,0)
 N GMRVSTR,GMTSC1,GMTSC2,GMTSC3,GMTSC4,GMTSCNT,GMTSCD,GMTSCHR,GMTSCI
"RTN","GMTSVSD",15,0)
 N GMTSCW1,GMTSCW2,GMTSCW3,GMTSCW4,GMTSCW5,GMTSLN,GMTSMEAS,GMTSMAX
"RTN","GMTSVSD",16,0)
 N GMTSN,GMTSOK,GMTSP,GMTSPSN,GMTSQ,GMTSREM,GMTSROV,GMTST,GMTSTO,GMTSV
"RTN","GMTSVSD",17,0)
 N GMTSVCT,GMTSVD,GMTSVI,GMTSVSD,GMTSVSDT,GMTSVT,X,Y,GMTSLM,GMTSLML
"RTN","GMTSVSD",18,0)
 S GMTSLM=0 S:$D(VALM("BM"))&($G(VALM("LINES"))>0) GMTSLM=1
"RTN","GMTSVSD",19,0)
 S GMTSLML=9999999009 S:GMTSLM GMTSLML=+($G(VALM("LINES")))
"RTN","GMTSVSD",20,0)
 S GMTSLO=+($G(GMTSLO)) S:GMTSLO=0 GMTSLO=3 S GMTSLPG=+($G(GMTSLPG)),GMTSDTM=$G(GMTSDTM) S:'$L(GMTSDTM) GMTSDTM=$$DTM
"RTN","GMTSVSD",21,0)
 S:'$D(GMTSTITL)!('$L($G(GMTSTITL))) GMTSTITL="VITALS DETAILED DISPLAY" K ^TMP("GMTSVSD",$J),^UTILITY($J,"GMRVD")
"RTN","GMTSVSD",22,0)
 S (GMTSVCT,GMTSMAX)=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:1)
"RTN","GMTSVSD",23,0)
 S GMRVSTR("LT")="^C^"
"RTN","GMTSVSD",24,0)
 D GET D:$D(^UTILITY($J,"GMRVD")) ST K GMRVSTR("LT")
"RTN","GMTSVSD",25,0)
 D GET D:$D(^UTILITY($J,"GMRVD")) ST K ^UTILITY($J,"GMRVD")
"RTN","GMTSVSD",26,0)
 S GMTSCW1=0,GMTSCW2=18,GMTSCW3=36,GMTSCW4=53,GMTSCW5=+($G(IOM))-2
"RTN","GMTSVSD",27,0)
 S:GMTSCW5'>49 GMTSCW5=78
"RTN","GMTSVSD",28,0)
 I '$D(^TMP("GMTSVSD",$J)) Q
"RTN","GMTSVSD",29,0)
 D REM,OUT
"RTN","GMTSVSD",30,0)
 Q
"RTN","GMTSVSD",31,0)
 ;                
"RTN","GMTSVSD",32,0)
GET ; Get Data
"RTN","GMTSVSD",33,0)
 K ^UTILITY($J,"GMRVD") N GMTSMAX
"RTN","GMTSVSD",34,0)
 S GMTSMAX=$S(+($G(GMTSVCT))>0:+($G(GMTSVCT)),1:1) S GMTSMAX=GMTSMAX*100
"RTN","GMTSVSD",35,0)
 S GMRVSTR="T"_";"_"P"_";"_"R"_";"_"BP"_";"_"HT"_";"_"WT"_";"_"CVP"_";"_"PO2"_";"_"CG"_";"_"PN"
"RTN","GMTSVSD",36,0)
 S GMRVSTR(0)=$G(GMTSBEG)_"^"_$G(GMTSEND)_"^"_$G(GMTSMAX)_"^"_1
"RTN","GMTSVSD",37,0)
 ;D EN1^GMRVUT0 S GMTSMAX=+($G(GMTSVCT))
"RTN","GMTSVSD",38,0)
 D EN1^GMVHS S GMTSMAX=+($G(GMTSVCT))
"RTN","GMTSVSD",39,0)
 Q
"RTN","GMTSVSD",40,0)
NOD ;   No Data Found
"RTN","GMTSVSD",41,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG=1 HDR
"RTN","GMTSVSD",42,0)
 W "*** No vital measurements ***",! S GMTSMAX=1 Q
"RTN","GMTSVSD",43,0)
REM ;   Remove Excess Data
"RTN","GMTSVSD",44,0)
 N GMTSMAX S GMTSMAX=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:1)
"RTN","GMTSVSD",45,0)
 N GMTSVD,GMTSVT,GMTSVI,GMTST
"RTN","GMTSVSD",46,0)
 S GMTSVD=0 F  S GMTSVD=$O(^TMP("GMTSVSD",$J,GMTSVD)) Q:+GMTSVD=0  D
"RTN","GMTSVSD",47,0)
 . S GMTSVT="" F  S GMTSVT=$O(^TMP("GMTSVSD",$J,GMTSVD,GMTSVT)) Q:GMTSVT=""  D
"RTN","GMTSVSD",48,0)
 . . S GMTSVI=0 F  S GMTSVI=$O(^TMP("GMTSVSD",$J,GMTSVD,GMTSVT,GMTSVI)) Q:+GMTSVI=0  D
"RTN","GMTSVSD",49,0)
 . . . I +($G(GMTST(GMTSVT)))>(GMTSMAX-1) K ^TMP("GMTSVSD",$J,GMTSVD,GMTSVT,GMTSVI) Q
"RTN","GMTSVSD",50,0)
 . . . S GMTST(GMTSVT)=+($G(GMTST(GMTSVT)))+1
"RTN","GMTSVSD",51,0)
 Q
"RTN","GMTSVSD",52,0)
 ;                
"RTN","GMTSVSD",53,0)
OUT ; Output Data
"RTN","GMTSVSD",54,0)
 D HDR Q:$D(GMTSQIT)  N GMTSVD,GMTSVT,GMTSVSDT,GMTSVSD,GMTSVI,GMTSCNT S GMTSCNT=0
"RTN","GMTSVSD",55,0)
 S GMTSVD=0 F  S GMTSVD=$O(^TMP("GMTSVSD",$J,GMTSVD)) Q:GMTSVD<1!(GMTSVD="")  D
"RTN","GMTSVSD",56,0)
 . S GMTSVT="" F  S GMTSVT=$O(^TMP("GMTSVSD",$J,GMTSVD,GMTSVT)) Q:GMTSVT=""  D
"RTN","GMTSVSD",57,0)
 . . S GMTSVI=0 F  S GMTSVI=$O(^TMP("GMTSVSD",$J,GMTSVD,GMTSVT,GMTSVI)) Q:+GMTSVI=0  D
"RTN","GMTSVSD",58,0)
 . . . S GMTSVSD=$G(^TMP("GMTSVSD",$J,GMTSVD,GMTSVT,GMTSVI)) Q:'$L(GMTSVSD)  S GMTSVSDT=$P(GMTSVSD,"^",1) Q:'$L(GMTSVSDT)  Q:+GMTSVSDT'>0  D ADD
"RTN","GMTSVSD",59,0)
 . I +($O(^TMP("GMTSVSD",$J,GMTSVD)))'=GMTSVD D WRL
"RTN","GMTSVSD",60,0)
 I GMTSCNT=0 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG=1 HDR W "No data",!
"RTN","GMTSVSD",61,0)
 Q
"RTN","GMTSVSD",62,0)
ADD ;   Add to Output Array
"RTN","GMTSVSD",63,0)
 N GMTST,GMTSTO,GMTSV,GMTSQ S GMTST=$G(GMTSVT) Q:'$L(GMTST)
"RTN","GMTSVSD",64,0)
 S GMTSTO=$$VO(GMTST) Q:GMTSTO'>0  S GMTST=$$VT(GMTST) Q:'$L(GMTST)
"RTN","GMTSVSD",65,0)
 S GMTSV=$$VM(GMTSVT,GMTSVSD)
"RTN","GMTSVSD",66,0)
 S GMTSQ=$$VQ(GMTSVSD),GMTSROV(GMTSTO)=GMTST_"^"_GMTSV_"^"_GMTSQ,GMTSCNT=+($G(GMTSCNT))+1,GMTSROV("DT")=$$EDT^GMTSU(GMTSVSDT)
"RTN","GMTSVSD",67,0)
 Q
"RTN","GMTSVSD",68,0)
WRL ;   Write Line from Array
"RTN","GMTSVSD",69,0)
 N GMTSCI,GMTSCD,GMTSC1,GMTSC2,GMTSC3,GMTSC4
"RTN","GMTSVSD",70,0)
 S (GMTSCD,GMTSC1)=$G(GMTSROV("DT")) I '$L(GMTSC1) K GMTSROV Q
"RTN","GMTSVSD",71,0)
 S GMTSCI=0 F  S GMTSCI=$O(GMTSROV(GMTSCI)) Q:+GMTSCI=0  Q:$D(GMTSQIT)  D  Q:$D(GMTSQIT)
"RTN","GMTSVSD",72,0)
 . S GMTSC2=$G(GMTSROV(GMTSCI)),GMTSC3=$P(GMTSC2,"^",2),GMTSC4=$P(GMTSC2,"^",3),GMTSC2=$P(GMTSC2,"^",1)
"RTN","GMTSVSD",73,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSVSD",74,0)
 . I +($G(GMTSLM))>0 S:+($$LMP)>0 GMTSC1=GMTSCD
"RTN","GMTSVSD",75,0)
 . I GMTSNPG'=1 W GMTSC1,?GMTSCW2,GMTSC2,?GMTSCW3,GMTSC3 D QUAL
"RTN","GMTSVSD",76,0)
 . I GMTSNPG=1 S GMTSC1=GMTSCD D HDR W GMTSC1,?GMTSCW2,GMTSC2,?GMTSCW3,GMTSC3 D QUAL
"RTN","GMTSVSD",77,0)
 . S GMTSC1="   ""        ""  "
"RTN","GMTSVSD",78,0)
 . Q:$D(GMTSQIT)
"RTN","GMTSVSD",79,0)
 K GMTSROV
"RTN","GMTSVSD",80,0)
 Q
"RTN","GMTSVSD",81,0)
LMP(X) ;
"RTN","GMTSVSD",82,0)
 Q:+($G(GMTSLML))'>0 0
"RTN","GMTSVSD",83,0)
 N GMTSP,GMTSD S GMTSP=$Y,GMTSD=0 S:GMTSP#GMTSLML=0 GMTSD=1 S X=GMTSD Q X
"RTN","GMTSVSD",84,0)
QUAL ;   Write Vital Qualifiers
"RTN","GMTSVSD",85,0)
 N GMTSOK,GMTSLN,GMTSTO,GMTSREM,GMTSPSN,GMTSCHR S GMTSLN=GMTSCW5-GMTSCW4
"RTN","GMTSVSD",86,0)
 I $L(GMTSC4)'>(GMTSLN-1) D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG=1 HDR W ?GMTSCW4,GMTSC4,! Q
"RTN","GMTSVSD",87,0)
 S GMTSREM=GMTSC4 F  Q:$D(GMTSQIT)  D QPARSE Q:$D(GMTSQIT)  Q:'$L(GMTSREM)
"RTN","GMTSVSD",88,0)
 Q
"RTN","GMTSVSD",89,0)
QPARSE ;     Parse Qualifier (wrap)
"RTN","GMTSVSD",90,0)
 I $L(GMTSREM)'>(GMTSLN-1) D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG=1 HDR W ?GMTSCW4,GMTSREM,! S GMTSREM="" Q
"RTN","GMTSVSD",91,0)
 S GMTSOK=0 F GMTSPSN=GMTSLN:-1:0 Q:+GMTSOK=1  D  Q:+GMTSOK=1
"RTN","GMTSVSD",92,0)
 . I $E(GMTSREM,GMTSPSN)=" " S GMTSCHR=" ",GMTSOK=1 Q
"RTN","GMTSVSD",93,0)
 . I $E(GMTSREM,GMTSPSN)="," S GMTSCHR=",",GMTSOK=1 Q
"RTN","GMTSVSD",94,0)
 . I $E(GMTSREM,GMTSPSN)="/"!($E(GMTSREM,GMTSPSN)="-")!($E(GMTSREM,GMTSPSN)=")") S GMTSCHR=$E(GMTSREM,GMTSPSN),GMTSOK=1 Q
"RTN","GMTSVSD",95,0)
 I GMTSCHR=" " D  Q:$D(GMTSQIT)
"RTN","GMTSVSD",96,0)
 . S GMTSTO=$E(GMTSREM,1,(GMTSPSN-1)),GMTSREM=$E(GMTSREM,(GMTSPSN+1),$L(GMTSREM)),GMTSREM=$$TRIM(GMTSREM) D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG=1 HDR W ?GMTSCW4,$G(GMTSTO),!
"RTN","GMTSVSD",97,0)
 I GMTSCHR="/"!(GMTSCHR=",")!(GMTSCHR="-")!(GMTSCHR=")") D  Q:$D(GMTSQIT)
"RTN","GMTSVSD",98,0)
 . S GMTSTO=$E(GMTSREM,1,(GMTSPSN)),GMTSREM=$E(GMTSREM,(GMTSPSN+1),$L(GMTSREM)),GMTSREM=$$TRIM(GMTSREM) D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG=1 HDR W ?GMTSCW4,$G(GMTSTO),!
"RTN","GMTSVSD",99,0)
 Q
"RTN","GMTSVSD",100,0)
 ;                
"RTN","GMTSVSD",101,0)
 ; Miscellaneous
"RTN","GMTSVSD",102,0)
FM(X) ;   Format Vitals Measurement
"RTN","GMTSVSD",103,0)
 S X=$$TRIM($G(X)) Q:+X'=X X
"RTN","GMTSVSD",104,0)
 S:X["." X=$FN(X,"",2) Q X
"RTN","GMTSVSD",105,0)
TRIM(X) ;   Trim Blank Spaces
"RTN","GMTSVSD",106,0)
 F  Q:$E(X,1)'=" "  S X=$E(X,2,$L(X))
"RTN","GMTSVSD",107,0)
 F  Q:$E(X,$L(X))'=" "  S X=$E(X,1,($L(X)-1))
"RTN","GMTSVSD",108,0)
 Q X
"RTN","GMTSVSD",109,0)
VO(X) ;   Vital Array Order
"RTN","GMTSVSD",110,0)
 S X=$G(X) Q:X="T" 1 Q:X="P" 2 Q:X="R" 3 Q:X="BP" 4 Q:X="HT" 5 Q:X="WT" 6 Q:X="CG" 7 Q:X="PN" 8 Q:X="CVP" 9 Q:X="PO2" 10 Q ""
"RTN","GMTSVSD",111,0)
VT(X) ;   Vital Type
"RTN","GMTSVSD",112,0)
 S X=$G(X) Q:X="BP" "BP" Q:X="T" "Temp F (C)" Q:X="R" "Respir" Q:X="P" "Pulse" Q:X="HT" "Ht in (cm)"
"RTN","GMTSVSD",113,0)
 Q:X="WT" "Wt lbs (kg)[BMI]" Q:X="CVP" "CVP cm H2O(mm HG)" Q:X="PO2" "POx (L/Min)(%)" Q:X="CG" "C/G in (cm)" Q:X="PN" "Pain" Q ""
"RTN","GMTSVSD",114,0)
VM(X,Y) ;   Vital Type Measurement
"RTN","GMTSVSD",115,0)
 N GMTSMEAS,GMTSID S GMTSMEAS="",(GMTSID,X)=$G(X) Q:"^BP^T^R^P^HT^WT^CVP^PO2^CG^PN^"'[("^"_X_"^") ""
"RTN","GMTSVSD",116,0)
 S Y=$G(Y) Q:'$L(Y) ""
"RTN","GMTSVSD",117,0)
 ;     If data for T, Ht or Wt piece 8 and 13 else  piece 8
"RTN","GMTSVSD",118,0)
 I X="T"!(X="HT")!(X="WT") S GMTSMEAS=$S($P(Y,"^",8)?1A.E:$P(Y,"^",8),1:$P(Y,"^",8)_" ("_$P(Y,"^",13)_")")
"RTN","GMTSVSD",119,0)
 E  S GMTSMEAS=$P(Y,"^",8)
"RTN","GMTSVSD",120,0)
 ;     WT - Weight and BMI (piece 14)
"RTN","GMTSVSD",121,0)
 I X="WT",$L($P(Y,"^",14)) S GMTSMEAS=GMTSMEAS_"["_$P(Y,"^",14)_"]"
"RTN","GMTSVSD",122,0)
 ;     CVP - Central Venous Pressure/CG - Circum/Girth
"RTN","GMTSVSD",123,0)
 I X="CVP"!(X="CG") S GMTSMEAS=$P(Y,"^",8) S:$L($P(Y,"^",13)) GMTSMEAS=GMTSMEAS_" ("_$P(Y,"^",13)_")"
"RTN","GMTSVSD",124,0)
 ;     POx - Pulse Oximetry
"RTN","GMTSVSD",125,0)
 I X="PO2" S GMTSMEAS=$P(Y,"^",8) S:$L($P(Y,"^",15))!($L($P(Y,"^",16))) GMTSMEAS=GMTSMEAS_" ("_$P(Y,"^",15)_")("_$P(Y,"^",16)_")"
"RTN","GMTSVSD",126,0)
 ;     PN - Pain
"RTN","GMTSVSD",127,0)
 S:X="PN" GMTSMEAS=$P(Y,"^",8) S:X="PN"&(GMTSMEAS=99) GMTSMEAS="Unable to Respond" ;p.107 changed from "No Response" to "Unable to Respond"
"RTN","GMTSVSD",128,0)
 S X=GMTSMEAS Q X
"RTN","GMTSVSD",129,0)
VQ(X) ;   Vital Qualifiers
"RTN","GMTSVSD",130,0)
 S X=$G(X),X=$P(X,"^",17) S:$L(X) X=$$AQ(X) Q X
"RTN","GMTSVSD",131,0)
HDR ;   Header
"RTN","GMTSVSD",132,0)
 N GMTSLN D CKP^GMTSUP Q:$D(GMTSQIT)  G:GMTSNPG=1 HDR
"RTN","GMTSVSD",133,0)
 W "Date",?GMTSCW2,"Vital",?GMTSCW3,"Measurement",?GMTSCW4,"Qualifiers"
"RTN","GMTSVSD",134,0)
 W:'$D(GMTSOBJ)!($D(GMTSOBJ)&($D(GMTSOBJ("UNDERLINE")))) !
"RTN","GMTSVSD",135,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  G:GMTSNPG=1 HDR
"RTN","GMTSVSD",136,0)
 W:'$D(GMTSOBJ)!($D(GMTSOBJ)&($D(GMTSOBJ("UNDERLINE")))) $$LN((GMTSCW2-2)) W ?GMTSCW2
"RTN","GMTSVSD",137,0)
 W:'$D(GMTSOBJ)!($D(GMTSOBJ)&($D(GMTSOBJ("UNDERLINE")))) $$LN((GMTSCW3-(GMTSCW2+2))) W ?GMTSCW3
"RTN","GMTSVSD",138,0)
 W:'$D(GMTSOBJ)!($D(GMTSOBJ)&($D(GMTSOBJ("UNDERLINE")))) $$LN((GMTSCW4-(GMTSCW3+2))) W ?GMTSCW4
"RTN","GMTSVSD",139,0)
 W:'$D(GMTSOBJ)!($D(GMTSOBJ)&($D(GMTSOBJ("UNDERLINE")))) $$LN((GMTSCW5-(GMTSCW4+2)))
"RTN","GMTSVSD",140,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  G:GMTSNPG=1 HDR W !
"RTN","GMTSVSD",141,0)
 ;
"RTN","GMTSVSD",142,0)
 S GMTSNPG=0 Q
"RTN","GMTSVSD",143,0)
ST ;   Save in ^TMP Global
"RTN","GMTSVSD",144,0)
 Q:'$D(^UTILITY($J,"GMRVD"))  M ^TMP("GMTSVSD",$J)=^UTILITY($J,"GMRVD") Q
"RTN","GMTSVSD",145,0)
AQ(X) ;   All Qualifiers Field
"RTN","GMTSVSD",146,0)
 S X=$G(X) F  Q:X'[";"  S X=$P(X,";",1)_", "_$P(X,";",2,299)
"RTN","GMTSVSD",147,0)
 S X=$$MC(X) Q X
"RTN","GMTSVSD",148,0)
MC(X) ;   Mix Case for Qualifiers
"RTN","GMTSVSD",149,0)
 N GMTSP S X=$TR($G(X),"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz") F GMTSP=1:1:$L(X) D
"RTN","GMTSVSD",150,0)
 . S:GMTSP=1 X=$TR($E(X,GMTSP),"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")_$E(X,(GMTSP+1),$L(X)) Q:GMTSP=1
"RTN","GMTSVSD",151,0)
 . S:" /-,"[$E(X,(GMTSP-1)) X=$E(X,1,(GMTSP-1))_$TR($E(X,GMTSP),"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")_$E(X,(GMTSP+1),$L(X))
"RTN","GMTSVSD",152,0)
 Q X
"RTN","GMTSVSD",153,0)
DTM(X) ;   Current Date and Time
"RTN","GMTSVSD",154,0)
 S X=$$NOW^XLFDT D REGDTM4^GMTSU Q X
"RTN","GMTSVSD",155,0)
FN(X,Y) ;   Format Number 
"RTN","GMTSVSD",156,0)
 N GMTSV S X=$G(X),GMTSV=+($G(X)),Y=$G(Y) S:+Y=Y X=$FN(GMTSV,"",+Y) Q X
"RTN","GMTSVSD",157,0)
LN(X) ;   Dashed Line
"RTN","GMTSVSD",158,0)
 S X=+($G(X)) Q:X=0 "" N GMTSLN S GMTSLN="",$P(GMTSLN,"-",X)="-" S X=GMTSLN Q X
"RTN","GMTSVSD",159,0)
EDT(X) ; External Date and Time
"RTN","GMTSVSD",160,0)
 S X=$G(X) Q:'$L(X) ""
"RTN","GMTSVSD",161,0)
 D REGDTM4^GMTSU Q X
"RTN","GMTSVSS")
0^3^B45201579^B43514605
"RTN","GMTSVSS",1,0)
GMTSVSS ; SLC/KER - Selected Vital Signs           ; 02/27/2002
"RTN","GMTSVSS",2,0)
 ;;2.7;Health Summary;**8,20,28,35,49,78,107**;Oct 20, 1995;Build 3
"RTN","GMTSVSS",3,0)
 ;                          
"RTN","GMTSVSS",4,0)
 ; External References
"RTN","GMTSVSS",5,0)
 ;   DBIA  4791  EN1^GMVHS
"RTN","GMTSVSS",6,0)
 ;   DBIA 10141  $$VERSION^XPDUTL
"RTN","GMTSVSS",7,0)
 ;   DBIA 10015  EN^DIQ1
"RTN","GMTSVSS",8,0)
 ;   DBIA 10022  %XY^%RCR
"RTN","GMTSVSS",9,0)
 ;                    
"RTN","GMTSVSS",10,0)
 ; Health Summary patch GMTS*2.7*35 will require 
"RTN","GMTSVSS",11,0)
 ; Vitals version 4.0, patch GMRV*4.0*7
"RTN","GMTSVSS",12,0)
 ;                          
"RTN","GMTSVSS",13,0)
OUTPAT ; Outpatient Select Vitals Signs Main control
"RTN","GMTSVSS",14,0)
 N CNT,COL,COLL,HDR,GMTSDA,GMTSDT,GMTSF,GMTSI,GMW,GMRVSTR,LOOP,MAX,ROW,WIDTH
"RTN","GMTSVSS",15,0)
 K ^UTILITY($J,"GMRVD") S MAX=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:100)
"RTN","GMTSVSS",16,0)
 S GMTSI=0 F  S GMTSI=$O(GMTSEG(GMTSEGN,120.51,GMTSI)) Q:GMTSI'>0  S GMTSDA=GMTSEG(GMTSEGN,120.51,GMTSI) D BLDSTR
"RTN","GMTSVSS",17,0)
 Q:'$D(GMRVSTR)
"RTN","GMTSVSS",18,0)
 S GMRVSTR(0)=GMTSBEG_U_GMTSEND_U_MAX_U_1
"RTN","GMTSVSS",19,0)
 ;   Set to only get Vital Sign for Clinics
"RTN","GMTSVSS",20,0)
 S GMRVSTR("LT")="^C^"
"RTN","GMTSVSS",21,0)
 ;D BLDHDR,EN1^GMRVUT0
"RTN","GMTSVSS",22,0)
 D BLDHDR,EN1^GMVHS
"RTN","GMTSVSS",23,0)
 ;   If no data, display most recent inpatient measurements
"RTN","GMTSVSS",24,0)
 I '$D(^UTILITY($J,"GMRVD")) D  Q
"RTN","GMTSVSS",25,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W "*** No Outpatient measurements ***",!!
"RTN","GMTSVSS",26,0)
 . S MAX=1 D ENVS
"RTN","GMTSVSS",27,0)
 S ROW=1 D NXTROW
"RTN","GMTSVSS",28,0)
 D WRTHDR,WRTHDR1
"RTN","GMTSVSS",29,0)
 S GMTSDT="" F GMTSF=1:1:MAX S GMTSDT=$O(^UTILITY($J,"GMRVD",GMTSDT)) Q:GMTSDT'>0  D WRT Q:$D(GMTSQIT)  D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSVSS",30,0)
 I $O(COL(ROW)) F ROW=2:1 Q:'$D(COL(ROW))!($D(GMTSQIT))  D
"RTN","GMTSVSS",31,0)
 . D NXTROW
"RTN","GMTSVSS",32,0)
 . W !! D WRTHDR,WRTHDR1
"RTN","GMTSVSS",33,0)
 . S GMTSDT="" F GMTSF=1:1:MAX S GMTSDT=$O(^UTILITY($J,"GMRVD",GMTSDT)) Q:GMTSDT'>0  D WRT Q:$D(GMTSQIT)  D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSVSS",34,0)
 K ^UTILITY($J,"GMRVD"),GMTSVMVR
"RTN","GMTSVSS",35,0)
 Q
"RTN","GMTSVSS",36,0)
ENVS ; Set up for extraction routine
"RTN","GMTSVSS",37,0)
 N CNT,COL,COLL,HDR,HDR1,GMTSDA,GMTSDT,GMTSF,GMTSI,GMW,LOOP,ROW,WIDTH
"RTN","GMTSVSS",38,0)
 K ^UTILITY($J,"GMRVD"),GMRVSTR("LT")
"RTN","GMTSVSS",39,0)
 S MAX=$S(+($G(MAX))>0:MAX,+($G(MAX))'>0&(+($G(GMTSNDM))>0):+($G(GMTSNDM)),1:100)
"RTN","GMTSVSS",40,0)
 S GMTSI=0 F  S GMTSI=$O(GMTSEG(GMTSEGN,120.51,GMTSI)) Q:GMTSI'>0  S GMTSDA=GMTSEG(GMTSEGN,120.51,GMTSI) D BLDSTR
"RTN","GMTSVSS",41,0)
 Q:'$D(GMRVSTR)
"RTN","GMTSVSS",42,0)
 S GMRVSTR(0)=GMTSBEG_U_GMTSEND_U_MAX_U_1
"RTN","GMTSVSS",43,0)
 ;D BLDHDR,EN1^GMRVUT0
"RTN","GMTSVSS",44,0)
 D BLDHDR,EN1^GMVHS
"RTN","GMTSVSS",45,0)
 I '$D(^UTILITY($J,"GMRVD")) Q
"RTN","GMTSVSS",46,0)
 S ROW=1 D NXTROW
"RTN","GMTSVSS",47,0)
 D WRTHDR,WRTHDR1
"RTN","GMTSVSS",48,0)
 S GMTSDT="" F GMTSF=1:1:MAX S GMTSDT=$O(^UTILITY($J,"GMRVD",GMTSDT)) Q:GMTSDT'>0  D WRT Q:$D(GMTSQIT)  D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSVSS",49,0)
 I $O(COL(ROW)) F ROW=2:1 Q:'$D(COL(ROW))!($D(GMTSQIT))  D
"RTN","GMTSVSS",50,0)
 . D NXTROW
"RTN","GMTSVSS",51,0)
 . W !! D WRTHDR,WRTHDR1
"RTN","GMTSVSS",52,0)
 . S GMTSDT="" F GMTSF=1:1:MAX S GMTSDT=$O(^UTILITY($J,"GMRVD",GMTSDT)) Q:GMTSDT'>0  D WRT Q:$D(GMTSQIT)  D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSVSS",53,0)
 K ^UTILITY($J,"GMRVD"),GMTSVMVR
"RTN","GMTSVSS",54,0)
 Q
"RTN","GMTSVSS",55,0)
BLDSTR ; Builds GMRVSTR string for extract call
"RTN","GMTSVSS",56,0)
 N DA,DIC,DIQ,DR,VIT
"RTN","GMTSVSS",57,0)
 S GMTSVMVR=+$$VERSION^XPDUTL("GMRV")
"RTN","GMTSVSS",58,0)
 S DIQ="VIT(",DIQ(0)="E",DIC=120.51,DR="1",DA=GMTSDA
"RTN","GMTSVSS",59,0)
 D EN^DIQ1 S VIT=VIT(120.51,DA,1,"E")
"RTN","GMTSVSS",60,0)
 S GMRVSTR=$S($D(GMRVSTR):GMRVSTR_";"_VIT,1:VIT)
"RTN","GMTSVSS",61,0)
 Q
"RTN","GMTSVSS",62,0)
BLDHDR ; Builds the HDR array
"RTN","GMTSVSS",63,0)
 N ABB,GMTSI S COL=18
"RTN","GMTSVSS",64,0)
 F GMTSI=1:1:$L(GMRVSTR,";") D
"RTN","GMTSVSS",65,0)
 . S (HDR(GMTSI-1),ABB)=$P(GMRVSTR,";",GMTSI)
"RTN","GMTSVSS",66,0)
 . S HDR(GMTSI-1)=HDR(GMTSI-1)_U
"RTN","GMTSVSS",67,0)
 . S HDR(GMTSI-1)=HDR(GMTSI-1)_$S(ABB="BP":"BP",ABB="PN":"PAIN",ABB="HT":"HEIGHT",ABB="WT":"WEIGHT",ABB="P":"PULSE",ABB="R":"RESP",ABB="T":"TEMP",ABB="PO2":"POx",1:ABB)
"RTN","GMTSVSS",68,0)
 . ;p.107 added "PN" and set to 18 to accomodate "Unable to Respond"
"RTN","GMTSVSS",69,0)
 . S WIDTH=HDR(GMTSI-1)
"RTN","GMTSVSS",70,0)
 . S WIDTH=$S($P(WIDTH,U)="T":13,$P(WIDTH,U)="P":8,$P(WIDTH,U)="R":12,$P(WIDTH,U)="WT":20,$P(WIDTH,U)="CG":34,$P(WIDTH,U)="CVP":16,$P(WIDTH,U)="HT":13,$P(WIDTH,U)="PO2":13,$P(WIDTH,U)="PN":18,1:12)
"RTN","GMTSVSS",71,0)
 . S COLL=$P(COL,U,GMTSI)+WIDTH
"RTN","GMTSVSS",72,0)
 . S COL=COL_U
"RTN","GMTSVSS",73,0)
 . S COL=COL_COLL
"RTN","GMTSVSS",74,0)
 . S HDR(GMTSI-1)=HDR(GMTSI-1)_U_COLL_U_WIDTH
"RTN","GMTSVSS",75,0)
 S ROW=1,COL(ROW)=18,COLL=18,CNT=0
"RTN","GMTSVSS",76,0)
 F LOOP=0:1 Q:'$D(HDR(LOOP))  D
"RTN","GMTSVSS",77,0)
 . I $P(HDR(LOOP),U,4)+COLL'>80 D  Q
"RTN","GMTSVSS",78,0)
 . . S COLL=$P(HDR(LOOP),U,4)+COLL
"RTN","GMTSVSS",79,0)
 . . S COL(ROW)=COL(ROW)_U_COLL
"RTN","GMTSVSS",80,0)
 . . S HDR1(ROW,CNT)=HDR(LOOP)
"RTN","GMTSVSS",81,0)
 . . S CNT=CNT+1
"RTN","GMTSVSS",82,0)
 . . K HDR(LOOP)
"RTN","GMTSVSS",83,0)
 . S ROW=ROW+1,COL(ROW)=18,COLL=18,CNT=0
"RTN","GMTSVSS",84,0)
 . S COLL=$P(HDR(LOOP),U,4)+COLL
"RTN","GMTSVSS",85,0)
 . S COL(ROW)=COL(ROW)_U_COLL
"RTN","GMTSVSS",86,0)
 . S HDR1(ROW,CNT)=HDR(LOOP)
"RTN","GMTSVSS",87,0)
 . S CNT=CNT+1
"RTN","GMTSVSS",88,0)
 . K HDR(LOOP)
"RTN","GMTSVSS",89,0)
 Q
"RTN","GMTSVSS",90,0)
WRTHDR ; Writes Header
"RTN","GMTSVSS",91,0)
 N GMI
"RTN","GMTSVSS",92,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Measurement DT"
"RTN","GMTSVSS",93,0)
 I GMTSVMVR'>3 F GMI=0:1:5 D CKP^GMTSUP Q:'$D(HDR(GMI))!($D(GMTSQIT))  D
"RTN","GMTSVSS",94,0)
 . W ?$P(COL,U,GMI+1),$P(HDR(GMI),U,2)
"RTN","GMTSVSS",95,0)
 I GMTSVMVR>3 S GMI="" F  S GMI=$O(HDR(GMI)) Q:(GMI="")  Q:('$D(HDR(GMI)))!($D(GMTSQIT))  D CKP^GMTSUP D
"RTN","GMTSVSS",96,0)
 . W ?$P(COL,U,GMI+1),$P(HDR(GMI),U,2)
"RTN","GMTSVSS",97,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !
"RTN","GMTSVSS",98,0)
 Q
"RTN","GMTSVSS",99,0)
WRTHDR1 ; Writes 2nd line of header
"RTN","GMTSVSS",100,0)
 N GMI
"RTN","GMTSVSS",101,0)
 I GMTSVMVR'>3 F GMI=0:1:5 D CKP^GMTSUP Q:'$D(HDR(GMI))!($D(GMTSQIT))  D
"RTN","GMTSVSS",102,0)
 . I $P(HDR(GMI),U)="HT" W ?$P(COL,U,GMI+1),"IN(CM)"
"RTN","GMTSVSS",103,0)
 . I $P(HDR(GMI),U)="WT" W ?$P(COL,U,GMI+1),"LB(KG)"
"RTN","GMTSVSS",104,0)
 . I $P(HDR(GMI),U)="T" W ?$P(COL,U,GMI+1),"F(C)"
"RTN","GMTSVSS",105,0)
 I GMTSVMVR>3 S GMI="" F  S GMI=$O(HDR(GMI)) Q:(GMI="")  Q:('$D(HDR(GMI)))!($D(GMTSQIT))  D CKP^GMTSUP D
"RTN","GMTSVSS",106,0)
 . I $P(HDR(GMI),U)="HT" W ?$P(COL,U,GMI+1),"IN(CM)"
"RTN","GMTSVSS",107,0)
 . I $P(HDR(GMI),U)="WT" W ?$P(COL,U,GMI+1),"LB(KG)[BMI]"
"RTN","GMTSVSS",108,0)
 . I $P(HDR(GMI),U)="T" W ?$P(COL,U,GMI+1),"F(C)"
"RTN","GMTSVSS",109,0)
 . I $P(HDR(GMI),U)="CVP" W ?$P(COL,U,GMI+1),"CMH20(MMHG)"
"RTN","GMTSVSS",110,0)
 . I $P(HDR(GMI),U)="PO2" W ?$P(COL,U,GMI+1),"(L/MIN)(%)"
"RTN","GMTSVSS",111,0)
 . I $P(HDR(GMI),U)="CG" W ?$P(COL,U,GMI+1),"IN(CM)"
"RTN","GMTSVSS",112,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !!
"RTN","GMTSVSS",113,0)
 Q
"RTN","GMTSVSS",114,0)
WRT ; Writes vitals record for one observation time
"RTN","GMTSVSS",115,0)
 N GMLEN,GMTSBMI,GMTSI,GMTSVAL,GMTDT,GMTSVI,GMTSVT,GMTSMET,GMTSPERC,GMTSLMIN,GMTSQUAL,IEN,X
"RTN","GMTSVSS",116,0)
 S GMTSVI="",X=9999999-GMTSDT D REGDTM4^GMTSU S GMTDT=X
"RTN","GMTSVSS",117,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG WRTHDR,WRTHDR1 W GMTDT
"RTN","GMTSVSS",118,0)
 I GMTSVMVR'>3 F GMTSI=0:1:5 S GMTSVI=$O(HDR(GMTSVI)) Q:GMTSVI=""!($D(GMTSQIT))  D
"RTN","GMTSVSS",119,0)
 . S GMTSVT=$P(HDR(GMTSVI),U),IEN=$O(^UTILITY($J,"GMRVD",GMTSDT,GMTSVT,0))
"RTN","GMTSVSS",120,0)
 . I +IEN D CKP^GMTSUP Q:$D(GMTSQIT)  D
"RTN","GMTSVSS",121,0)
 . . S GMTSVAL=$P(^UTILITY($J,"GMRVD",GMTSDT,GMTSVT,+IEN),U,8)
"RTN","GMTSVSS",122,0)
 . . W ?$P(COL,U,GMTSI+1),GMTSVAL
"RTN","GMTSVSS",123,0)
 . . S GMTSMET=$P(^UTILITY($J,"GMRVD",GMTSDT,GMTSVT,+IEN),U,13) I GMTSMET'="" W "("_$P(^(+IEN),U,13)_")"
"RTN","GMTSVSS",124,0)
 . . Q
"RTN","GMTSVSS",125,0)
 . Q
"RTN","GMTSVSS",126,0)
 I GMTSVMVR>3 F GMTSI=0:1 S GMTSVI=$O(HDR(GMTSVI)) Q:GMTSVI=""!($D(GMTSQIT))  D
"RTN","GMTSVSS",127,0)
 . S GMTSVT=$P(HDR(GMTSVI),U),IEN=$O(^UTILITY($J,"GMRVD",GMTSDT,GMTSVT,0))
"RTN","GMTSVSS",128,0)
 . I +IEN D CKP^GMTSUP Q:$D(GMTSQIT)  D
"RTN","GMTSVSS",129,0)
 . . S GMTSVAL=$P(^UTILITY($J,"GMRVD",GMTSDT,GMTSVT,+IEN),U,8)
"RTN","GMTSVSS",130,0)
 . . S:GMTSVT="PN"&(GMTSVAL=99) GMTSVAL="Unable to Respond" ;p.107 changed from "No Response" to "Unable to Respond"
"RTN","GMTSVSS",131,0)
 . . S:GMTSVT="P"&(GMTSVAL?1A.E) GMTSVAL=$E(GMTSVAL,1,7)
"RTN","GMTSVSS",132,0)
 . . W ?$P(COL,U,GMTSI+1),GMTSVAL
"RTN","GMTSVSS",133,0)
 . . S GMTSMET=$P(^UTILITY($J,"GMRVD",GMTSDT,GMTSVT,+IEN),U,13,17)
"RTN","GMTSVSS",134,0)
 . . S GMTSLMIN=$P(GMTSMET,U,3),GMTSPERC=$P(GMTSMET,U,4)
"RTN","GMTSVSS",135,0)
 . . S GMTSQUAL=$P(GMTSMET,U,5) S:GMTSQUAL]"" GMTSQUAL=$E(GMTSQUAL,1,15)
"RTN","GMTSVSS",136,0)
 . . S GMTSBMI=$P(GMTSMET,U,2),GMTSMET=$P(GMTSMET,U,1)
"RTN","GMTSVSS",137,0)
 . . I GMTSMET'="" W "("_GMTSMET_")" ;   centigrade/kilos/centimeters
"RTN","GMTSVSS",138,0)
 . . I GMTSBMI'="" W "["_GMTSBMI_"]" ;   body mass index
"RTN","GMTSVSS",139,0)
 . . I GMTSLMIN'=""!(GMTSPERC'="") W "["_GMTSLMIN_"]["_GMTSPERC_"]" ; [liters/min supplemental O2][% supplemental O2]
"RTN","GMTSVSS",140,0)
 . . I GMTSVT="CG",GMTSQUAL]"" W "["_GMTSQUAL_"]" ;   qualifiers
"RTN","GMTSVSS",141,0)
 . . Q
"RTN","GMTSVSS",142,0)
 . Q
"RTN","GMTSVSS",143,0)
 Q
"RTN","GMTSVSS",144,0)
NXTROW ; Get the Next Row of Vital Signs
"RTN","GMTSVSS",145,0)
 Q:$G(ROW)'>0  K HDR S %X="HDR1(ROW,",%Y="HDR(" D %XY^%RCR
"RTN","GMTSVSS",146,0)
 S COL=COL(ROW) K %X,%Y
"RTN","GMTSVSS",147,0)
 Q
"VER")
8.0^22.0
"BLD",9383,6)
^101
**END**
**END**
