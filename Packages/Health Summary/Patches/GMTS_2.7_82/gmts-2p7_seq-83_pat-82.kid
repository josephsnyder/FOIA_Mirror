Released GMTS*2.7*82 SEQ #83
Extracted from mail message
**KIDS**:GMTS*2.7*82^

**INSTALL NAME**
GMTS*2.7*82
"BLD",6801,0)
GMTS*2.7*82^HEALTH SUMMARY^0^3080820^y
"BLD",6801,1,0)
^^1^1^3080115^
"BLD",6801,1,1,0)
This patch will correct multiple problems in the Health Summary package.
"BLD",6801,4,0)
^9.64PA^^0
"BLD",6801,6)
7^
"BLD",6801,6.3)
21
"BLD",6801,"INID")
^n
"BLD",6801,"INIT")
EN^GMTSP82
"BLD",6801,"KRN",0)
^9.67PA^8989.52^19
"BLD",6801,"KRN",.4,0)
.4
"BLD",6801,"KRN",.401,0)
.401
"BLD",6801,"KRN",.402,0)
.402
"BLD",6801,"KRN",.402,"NM",0)
^9.68A^^
"BLD",6801,"KRN",.403,0)
.403
"BLD",6801,"KRN",.5,0)
.5
"BLD",6801,"KRN",.84,0)
.84
"BLD",6801,"KRN",3.6,0)
3.6
"BLD",6801,"KRN",3.8,0)
3.8
"BLD",6801,"KRN",9.2,0)
9.2
"BLD",6801,"KRN",9.8,0)
9.8
"BLD",6801,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",6801,"KRN",9.8,"NM",1,0)
GMTSPXFP^^0^B19095007
"BLD",6801,"KRN",9.8,"NM",2,0)
GMTSPN2^^0^B44633772
"BLD",6801,"KRN",9.8,"NM",3,0)
GMTSPXHR^^0^B16949930
"BLD",6801,"KRN",9.8,"NM","B","GMTSPN2",2)

"BLD",6801,"KRN",9.8,"NM","B","GMTSPXFP",1)

"BLD",6801,"KRN",9.8,"NM","B","GMTSPXHR",3)

"BLD",6801,"KRN",19,0)
19
"BLD",6801,"KRN",19.1,0)
19.1
"BLD",6801,"KRN",101,0)
101
"BLD",6801,"KRN",409.61,0)
409.61
"BLD",6801,"KRN",771,0)
771
"BLD",6801,"KRN",870,0)
870
"BLD",6801,"KRN",8989.51,0)
8989.51
"BLD",6801,"KRN",8989.52,0)
8989.52
"BLD",6801,"KRN",8994,0)
8994
"BLD",6801,"KRN","B",.4,.4)

"BLD",6801,"KRN","B",.401,.401)

"BLD",6801,"KRN","B",.402,.402)

"BLD",6801,"KRN","B",.403,.403)

"BLD",6801,"KRN","B",.5,.5)

"BLD",6801,"KRN","B",.84,.84)

"BLD",6801,"KRN","B",3.6,3.6)

"BLD",6801,"KRN","B",3.8,3.8)

"BLD",6801,"KRN","B",9.2,9.2)

"BLD",6801,"KRN","B",9.8,9.8)

"BLD",6801,"KRN","B",19,19)

"BLD",6801,"KRN","B",19.1,19.1)

"BLD",6801,"KRN","B",101,101)

"BLD",6801,"KRN","B",409.61,409.61)

"BLD",6801,"KRN","B",771,771)

"BLD",6801,"KRN","B",870,870)

"BLD",6801,"KRN","B",8989.51,8989.51)

"BLD",6801,"KRN","B",8989.52,8989.52)

"BLD",6801,"KRN","B",8994,8994)

"BLD",6801,"QUES",0)
^9.62^^
"BLD",6801,"REQB",0)
^9.611^4^4
"BLD",6801,"REQB",1,0)
GMTS*2.7*49^1
"BLD",6801,"REQB",2,0)
GMTS*2.7*69^1
"BLD",6801,"REQB",3,0)
GMTS*2.7*75^1
"BLD",6801,"REQB",4,0)
PX*1.0*185^1
"BLD",6801,"REQB","B","GMTS*2.7*49",1)

"BLD",6801,"REQB","B","GMTS*2.7*69",2)

"BLD",6801,"REQB","B","GMTS*2.7*75",3)

"BLD",6801,"REQB","B","PX*1.0*185",4)

"INIT")
EN^GMTSP82
"MBREQ")
0
"PKG",240,-1)
1^1
"PKG",240,0)
HEALTH SUMMARY^GMTS^Integrated Health Summary Tools
"PKG",240,22,0)
^9.49I^1^1
"PKG",240,22,1,0)
2.7^2951020^2960313
"PKG",240,22,1,"PAH",1,0)
82^3080820^520645587
"PKG",240,22,1,"PAH",1,1,0)
^^1^1^3080820
"PKG",240,22,1,"PAH",1,1,1,0)
This patch will correct multiple problems in the Health Summary package.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","GMTSP82")
0^^B6696847^n/a
"RTN","GMTSP82",1,0)
GMTSP82 ;BP CHY20/RJT - GMTS*2.7*82 POST INIT: ; 2/22/07 1:56pm
"RTN","GMTSP82",2,0)
 ;;2.7;HEALTH SUMMARY;**82**;Oct 20, 1995;Build 21
"RTN","GMTSP82",3,0)
 Q
"RTN","GMTSP82",4,0)
EN ;UPDATES DESCRIPTION OF HEALTH FACTOR COMPONENT IN ^GMT(142.1) AND CORRECTS A SPELLING MISTAKE IN THE CLINICAL REMINDERS SUMMARY DESCRIPTION
"RTN","GMTSP82",5,0)
 N GMTSIEN,GMTSHS D BMES^XPDUTL("Updating the Health Summary component description file")
"RTN","GMTSP82",6,0)
 S GMTSHS=$$FIND1^DIC(9.4,"","X","HEALTH SUMMARY","B","") I +GMTSHS=0 W !,"Health Summary package not found!  Aborting file updates...",! G END
"RTN","GMTSP82",7,0)
 S GMTSIEN=$$FIND1^DIC(9.49,","_GMTSHS_",","X","2.7","B","") I +GMTSIEN=0 W !,"Health Summary version 2.7 not found!  Aborting file updates...",! G END
"RTN","GMTSP82",8,0)
 K ^TMP($J,"WP")
"RTN","GMTSP82",9,0)
 I $$PATCH^XPDUTL("GMTS*2.7*82")=0 D
"RTN","GMTSP82",10,0)
 . S ^TMP($J,"WP",1,0)=""
"RTN","GMTSP82",11,0)
 . S ^TMP($J,"WP",2,0)="Note: Health Factors have a DISPLAY ON HEALTH SUMMARY "
"RTN","GMTSP82",12,0)
 . S ^TMP($J,"WP",3,0)="option that determines whether or not they will show on a Health Summary "
"RTN","GMTSP82",13,0)
 . S ^TMP($J,"WP",4,0)="report."
"RTN","GMTSP82",14,0)
 . S GMTSIEN=$$FIND1^DIC(142.1,"","X","PCE HEALTH FACTORS ALL","B","") G:+GMTSIEN=0 2
"RTN","GMTSP82",15,0)
 . D WP^DIE(142.1,GMTSIEN_",",3.5,"AK","^TMP($J,""WP"")")
"RTN","GMTSP82",16,0)
2 . S GMTSIEN=$$FIND1^DIC(142.1,"","X","PCE HEALTH FACTORS SELECTED","B","") G:+GMTSIEN=0 3
"RTN","GMTSP82",17,0)
 . D WP^DIE(142.1,GMTSIEN_",",3.5,"AK","^TMP($J,""WP"")")
"RTN","GMTSP82",18,0)
3 K ^TMP($J,"WP")
"RTN","GMTSP82",19,0)
 S ^TMP($J,"WP",1,0)="This component is similar to PCE CLINICAL REMINDERS DUE except that it "
"RTN","GMTSP82",20,0)
 S ^TMP($J,"WP",2,0)="shows all reminders, not just those that are due. The information will "
"RTN","GMTSP82",21,0)
 S ^TMP($J,"WP",3,0)="include the NEXT due date, or N/A, and the LAST DATE. N/A reminders "
"RTN","GMTSP82",22,0)
 S ^TMP($J,"WP",4,0)="will be displayed unless the IGNORE ON N/A field is set."
"RTN","GMTSP82",23,0)
 S GMTSIEN=$$FIND1^DIC(142.1,"","X","CLINICAL REMINDERS SUMMARY","B","") G:+GMTSIEN=0 END
"RTN","GMTSP82",24,0)
 D WP^DIE(142.1,GMTSIEN_",",3.5,"K","^TMP($J,""WP"")")
"RTN","GMTSP82",25,0)
END K ^TMP($J,"WP")
"RTN","GMTSP82",26,0)
 D BMES^XPDUTL("Update Complete")
"RTN","GMTSP82",27,0)
 Q
"RTN","GMTSPN2")
0^2^B44633772^B46788667
"RTN","GMTSPN2",1,0)
GMTSPN2 ; SLC/KER - Progress Note Signatures           ; 8/1/06 4:24pm
"RTN","GMTSPN2",2,0)
 ;;2.7;Health Summary;**45,47,49,82**;Oct 20, 1995;Build 21
"RTN","GMTSPN2",3,0)
 Q
"RTN","GMTSPN2",4,0)
 ;                          
"RTN","GMTSPN2",5,0)
 ; External References
"RTN","GMTSPN2",6,0)
 ;   DBIA 10011  ^DIWP
"RTN","GMTSPN2",7,0)
 ;   DBIA  2056  $$GET1^DIQ
"RTN","GMTSPN2",8,0)
 ;   DBIA 10060  ^VA(200, .137
"RTN","GMTSPN2",9,0)
 ;   DBIA 10060  ^VA(200, .138
"RTN","GMTSPN2",10,0)
 ;                     
"RTN","GMTSPN2",11,0)
WS(X,I) ; Write Signatures 
"RTN","GMTSPN2",12,0)
 Q:$D(GMTSQIT)  N GMTSDIC,GMTSIEN,GMTSA,GMTSG S GMTSDIC=$G(X),GMTSIEN=$G(I)
"RTN","GMTSPN2",13,0)
 Q:'$L(GMTSIEN)  Q:$E($P(GMTSDIC,$J,1),1,11)'="^TMP(""TIU"","  Q:'$D(@($P(GMTSDIC,",",1,($L(GMTSDIC,",")-1))_")"))
"RTN","GMTSPN2",14,0)
 Q:'$D(@(GMTSDIC_GMTSIEN_")"))  S GMTSDIC=GMTSDIC_GMTSIEN_","
"RTN","GMTSPN2",15,0)
 D UNS,SOC,SIG,UNC,COC,COS,EXT
"RTN","GMTSPN2",16,0)
 Q
"RTN","GMTSPN2",17,0)
UNS ;   Unsigned/Draft Copy
"RTN","GMTSPN2",18,0)
 Q:$D(GMTSQIT)  N GMTST S GMTST=$G(@(GMTSDIC_"1501,""I"")")) D:GMTST="" UNSIG
"RTN","GMTSPN2",19,0)
 Q
"RTN","GMTSPN2",20,0)
SOC ;   Signed on Chart
"RTN","GMTSPN2",21,0)
 Q:$D(GMTSQIT)  N GMTSP,GMTSB S GMTSP=$G(PN("SCHART"))
"RTN","GMTSPN2",22,0)
 S GMTSB=$G(PN("SCHARTBY")) Q:'$L(GMTSP)  Q:'$L(GMTSB)
"RTN","GMTSPN2",23,0)
 D BL Q:$D(GMTSQIT)  D BY(GMTSP,"",GMTSB) Q:$D(GMTSQIT)
"RTN","GMTSPN2",24,0)
 Q
"RTN","GMTSPN2",25,0)
SIG ;   Signature Block, Name, Title and Date
"RTN","GMTSPN2",26,0)
 Q:$D(GMTSQIT)  N GMTSA,GMTSG,GMTSE,GMTST,GMTSD,GMTSP,GMTSB
"RTN","GMTSPN2",27,0)
 S GMTSP="Signed by:",GMTSE=$G(@(GMTSDIC_"1505,""I"")"))
"RTN","GMTSPN2",28,0)
 S GMTSB=$G(PN("SIGBLK")) Q:'$L(GMTSB)  S GMTST=$G(PN("STITLE"))
"RTN","GMTSPN2",29,0)
 S GMTSD=$G(PN("SIGDT")),GMTSA=$$GET1^DIQ(200,+($G(SIGNEDBY)),.137)
"RTN","GMTSPN2",30,0)
 S GMTSG=$$GET1^DIQ(200,+($G(SIGNEDBY)),.138) D BL Q:$D(GMTSQIT)
"RTN","GMTSPN2",31,0)
 D BY(GMTSP,GMTSE,GMTSB) Q:$D(GMTSQIT)  D SB(GMTST,GMTSD) Q:$D(GMTSQIT)
"RTN","GMTSPN2",32,0)
 D PG(GMTSA,GMTSG) Q:$D(GMTSQIT)
"RTN","GMTSPN2",33,0)
 Q
"RTN","GMTSPN2",34,0)
UNC ;   Uncosigned - Requires Cosignature
"RTN","GMTSPN2",35,0)
 Q:$D(GMTSQIT)  N GMTSP,GMTSB
"RTN","GMTSPN2",36,0)
 S GMTSP=$G(@(GMTSDIC_".05,""E"")")) Q:GMTSP'="UNCOSIGNED"
"RTN","GMTSPN2",37,0)
 Q:$E($G(GMTSTIUC),1)["D"&('CONEED)  D BL Q:$D(GMTSQIT)
"RTN","GMTSPN2",38,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !?27,"** REQUIRES COSIGNATURE **"
"RTN","GMTSPN2",39,0)
 Q
"RTN","GMTSPN2",40,0)
COC ;   Cosigned on Chart
"RTN","GMTSPN2",41,0)
 Q:$D(GMTSQIT)  N GMTSP,GMTSB
"RTN","GMTSPN2",42,0)
 S GMTSP=$G(PN("COCHART")),GMTSB=$G(PN("COCHARTBY")) Q:'$L(GMTSP)  Q:'$L(GMTSB)
"RTN","GMTSPN2",43,0)
 Q:$E($G(GMTSTIUC),1)["D"&('CONEED)  D BL Q:$D(GMTSQIT)  D BY(GMTSP,"",GMTSB)
"RTN","GMTSPN2",44,0)
 Q
"RTN","GMTSPN2",45,0)
COS ;   Co-Signature Block, Name, Title and Date
"RTN","GMTSPN2",46,0)
 Q:$D(GMTSQIT)  N GMTSA,GMTSG,GMTSE,GMTST,GMTSD,GMTSP,GMTSB
"RTN","GMTSPN2",47,0)
 S GMTSP="Cosigned by:",GMTSE=$G(@(GMTSDIC_"1511,""I"")")),GMTSB=$G(PN("COBLK")) Q:'$L(GMTSB)
"RTN","GMTSPN2",48,0)
 S GMTST=$G(PN("COTITLE")),GMTSD=$G(PN("COSDT"))
"RTN","GMTSPN2",49,0)
 S GMTSA=$$GET1^DIQ(200,+($G(COSGEDBY)),.137),GMTSG=$$GET1^DIQ(200,+($G(COSGEDBY)),.138)
"RTN","GMTSPN2",50,0)
 Q:$E($G(GMTSTIUC),1)["D"&('CONEED)  D BL Q:$D(GMTSQIT)
"RTN","GMTSPN2",51,0)
 D BY(GMTSP,GMTSE,GMTSB) Q:$D(GMTSQIT)  D SB(GMTST,GMTSD) Q:$D(GMTSQIT)
"RTN","GMTSPN2",52,0)
 D PG(GMTSA,GMTSG)
"RTN","GMTSPN2",53,0)
 Q
"RTN","GMTSPN2",54,0)
EXT ;   Extra Signatures
"RTN","GMTSPN2",55,0)
 ;     Receipt Acknowledged by:
"RTN","GMTSPN2",56,0)
 Q:$D(GMTSQIT)  I +$O(@(GMTSDIC_"""EXTRASGNR"",0)")) D  Q:$D(GMTSQIT)
"RTN","GMTSPN2",57,0)
 . D BL Q:$D(GMTSQIT)  D BY("Receipt Acknowledged by:","","")
"RTN","GMTSPN2",58,0)
 ;     Extra Signature Block, Name, Title and Date
"RTN","GMTSPN2",59,0)
 N GMTSXTRA S GMTSXTRA=0
"RTN","GMTSPN2",60,0)
 F  S GMTSXTRA=+$O(@(GMTSDIC_"""EXTRASGNR"","_GMTSXTRA_")")) Q:+GMTSXTRA'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPN2",61,0)
 . N GMTSA,GMTSG,GMTSE,GMTST,GMTSD,GMTSP,GMTSB,GMTSI,GMTSC
"RTN","GMTSPN2",62,0)
 . S GMTSC=+($G(@(GMTSDIC_"""EXTRASGNR"","_GMTSXTRA_",""DATE"")")))
"RTN","GMTSPN2",63,0)
 . I GMTSC'>0 W ?27,"* AWAITING SIGNATURE *" D BL Q
"RTN","GMTSPN2",64,0)
 . S GMTSP="",GMTSE="/es/",GMTSB=$G(@(GMTSDIC_"""EXTRASGNR"","_GMTSXTRA_",""NAME"")")) Q:'$L(GMTSB)
"RTN","GMTSPN2",65,0)
 . S GMTST=$G(@(GMTSDIC_"""EXTRASGNR"","_GMTSXTRA_",""TITLE"")"))
"RTN","GMTSPN2",66,0)
 . S GMTSD=$$EDT^GMTSU(GMTSC),GMTSI=+($G(@(GMTSDIC_"""EXTRASGNR"","_GMTSXTRA_",""EXTRA"")")))
"RTN","GMTSPN2",67,0)
 . S GMTSA=$$GET1^DIQ(200,+($G(GMTSI)),.137),GMTSG=$$GET1^DIQ(200,+($G(GMTSI)),.138)
"RTN","GMTSPN2",68,0)
 . I +($G(GMTSXTRA))>1 D BL Q:$D(GMTSQIT)  D BL Q:$D(GMTSQIT)
"RTN","GMTSPN2",69,0)
 . D BY(GMTSP,GMTSE,GMTSB) Q:$D(GMTSQIT)
"RTN","GMTSPN2",70,0)
 . D SB(GMTST,GMTSD) Q:$D(GMTSQIT)  D PG(GMTSA,GMTSG) Q:$D(GMTSQIT)
"RTN","GMTSPN2",71,0)
 Q
"RTN","GMTSPN2",72,0)
 ;                      
"RTN","GMTSPN2",73,0)
UNSIG ; Unsigned Note
"RTN","GMTSPN2",74,0)
 N GMTS,GMTS1,GMTS2,GMTST,GMTSB S GMTST="<  THE ABOVE NOTE IS UNSIGNED  >",GMTS=""
"RTN","GMTSPN2",75,0)
 S $P(GMTS," ",((79-$L(GMTST))\2)\2)=" ",$P(GMTS1," ",((79-$L(GMTST))\2)\2)=" "
"RTN","GMTSPN2",76,0)
 S GMTS2=GMTS_GMTS1,GMTS1=GMTS1_GMTS,GMTSB=GMTS1_GMTST_GMTS2
"RTN","GMTSPN2",77,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ! D CKP^GMTSUP Q:$D(GMTSQIT)  W !,GMTSB
"RTN","GMTSPN2",78,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"- DRAFT COPY * DRAFT COPY * DRAFT COPY * DRAFT COPY * DRAFT COPY * DRAFT COPY -"
"RTN","GMTSPN2",79,0)
 Q
"RTN","GMTSPN2",80,0)
 ;                        
"RTN","GMTSPN2",81,0)
 ; Warnings
"RTN","GMTSPN2",82,0)
WARN1 ;   Beginning of Note
"RTN","GMTSPN2",83,0)
 N GMTSD,GMTSW S GMTSW=1,GMTSD=0 D DEL1,RETR1 D:GMTSD BL Q
"RTN","GMTSPN2",84,0)
WARN2 ;   End of Note
"RTN","GMTSPN2",85,0)
 N GMTSD,GMTSW S GMTSW=2,GMTSD=0 D DEL2,RETR2 Q
"RTN","GMTSPN2",86,0)
DEL1 ;     Deleted Note (begin)
"RTN","GMTSPN2",87,0)
 Q:($G(STATUS)'="DELETED")&($G(PN("STATUS"))'="DELETED")
"RTN","GMTSPN2",88,0)
 N GMTST,GMTST2 S GMTST="<  THE FOLLOWING ENTRY HAS BEEN DELETED >",GMTST2="<<<<< DELETED  *  DELETED  *  DELETED  *  DELETED  *  DELETED  *  DELETED >>>>>" D WARN3 Q
"RTN","GMTSPN2",89,0)
DEL2 ;     Deleted Note (end)
"RTN","GMTSPN2",90,0)
 Q:($G(STATUS)'="DELETED")&($G(PN("STATUS"))'="DELETED")
"RTN","GMTSPN2",91,0)
 N GMTST,GMTST2 S GMTST="<  THE ABOVE ENTRY HAS BEEN DELETED >",GMTST2="<<<<< DELETED  *  DELETED  *  DELETED  *  DELETED  *  DELETED  *  DELETED >>>>>" D WARN3 Q
"RTN","GMTSPN2",92,0)
RETR1 ;     Retracted Note (begin)
"RTN","GMTSPN2",93,0)
 Q:($G(STATUS)'="RETRACTED")&($G(PN("STATUS"))'="RETRACTED")
"RTN","GMTSPN2",94,0)
 N GMTST,GMTST2 S GMTST="<  THE FOLLOWING ENTRY HAS BEEN RETRACTED >",GMTST2="<<<<<< RETRACTED  *  RETRACTED  *  RETRACTED  *  RETRACTED  *  RETRACTED >>>>>>" D WARN3 Q
"RTN","GMTSPN2",95,0)
RETR2 ;     Retracted Note (end)
"RTN","GMTSPN2",96,0)
 Q:($G(STATUS)'="RETRACTED")&($G(PN("STATUS"))'="RETRACTED")
"RTN","GMTSPN2",97,0)
 N GMTST,GMTST2 S GMTST="<  THE ABOVE ENTRY HAS BEEN RETRACTED >",GMTST2="<<<<<< RETRACTED  *  RETRACTED  *  RETRACTED  *  RETRACTED  *  RETRACTED >>>>>>" D WARN3 Q
"RTN","GMTSPN2",98,0)
WARN3 ;   Warning Display (display)
"RTN","GMTSPN2",99,0)
 N GMTS,GMTS1,GMTS2,GMTSB S GMTS="",GMTST=$G(GMTST),GMTST2=$G(GMTST2) Q:'$L(GMTST)  Q:'$L(GMTST2)
"RTN","GMTSPN2",100,0)
 S $P(GMTS,"<",((79-$L(GMTST))\2)\2)="<"
"RTN","GMTSPN2",101,0)
 S $P(GMTS1,"<",((79-$L(GMTST))\2)\2)="<",GMTS1=GMTS_GMTS1,GMTS=""
"RTN","GMTSPN2",102,0)
 S $P(GMTS,">",((79-$L(GMTST))\2)\2)=">"
"RTN","GMTSPN2",103,0)
 S $P(GMTS2,">",((79-$L(GMTST))\2)\2)=">",GMTS2=GMTS2_GMTS,GMTS=""
"RTN","GMTSPN2",104,0)
 S GMTSB=GMTS1_GMTST_GMTS2 F  Q:$L(GMTSB)'<$L(GMTST2)  S GMTSB=GMTSB_">"
"RTN","GMTSPN2",105,0)
 I +($G(GMTSW))=2 D BL Q:$D(GMTSQIT)
"RTN","GMTSPN2",106,0)
 I +($G(GMTSW))=1 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,GMTSB
"RTN","GMTSPN2",107,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,GMTST2 S:$D(GMTSD) GMTSD=1
"RTN","GMTSPN2",108,0)
 I +($G(GMTSW))=2 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,GMTSB
"RTN","GMTSPN2",109,0)
 Q
"RTN","GMTSPN2",110,0)
 ;                   
"RTN","GMTSPN2",111,0)
 ; Miscelaneous
"RTN","GMTSPN2",112,0)
BY(GMTSH,GMTSE,GMTSN) ; Signed by
"RTN","GMTSPN2",113,0)
 S GMTSH=$$TRIM($G(GMTSH)),GMTSE=$G(GMTSE),GMTSN=$G(GMTSN) Q:'$L((GMTSH_GMTSN))
"RTN","GMTSPN2",114,0)
 S:$L(GMTSH) GMTSH=GMTSH_"  " S GMTSE=$S(GMTSE="E":"/es/  ",GMTSE["/es/":"/es/  ",1:"") S:GMTSN="."&(GMTSH[" by:") GMTSH=$P(GMTSH," by:",1)_".",GMTSN="" S:GMTSN="." GMTSN=""
"RTN","GMTSPN2",115,0)
 I $L($$TRIM(GMTSH)) D CKP^GMTSUP Q:$D(GMTSQIT)  W !,$J("",(27-$L(GMTSH))),GMTSH
"RTN","GMTSPN2",116,0)
 W ?27,GMTSE,GMTSN
"RTN","GMTSPN2",117,0)
 Q
"RTN","GMTSPN2",118,0)
SB(GMTSB,GMTSD) ; Signature Block
"RTN","GMTSPN2",119,0)
 K ^UTILITY($J,"W") N X,DIWT,DIWL,DIWR,DIWF,GMTSI
"RTN","GMTSPN2",120,0)
 S (X,GMTSB)=$G(GMTSB),GMTSD=$G(GMTSD) Q:'$L((GMTSB_GMTSD))
"RTN","GMTSPN2",121,0)
 S GMTSI=1,DIWL=0,DIWF="C51" D ^DIWP S GMTSB=$$TRIM($G(^UTILITY($J,"W",0,1,0))) K:'$L(GMTSB) ^UTILITY($J,"W")
"RTN","GMTSPN2",122,0)
 I $L(GMTSD),'$L(GMTSB) K ^UTILITY($J,"W") D CKP^GMTSUP Q:$D(GMTSQIT)  W !,?27,GMTSD Q
"RTN","GMTSPN2",123,0)
 Q:'$L(GMTSB)  D CKP^GMTSUP K:$D(GMTSQIT) ^UTILITY($J,"W") Q:$D(GMTSQIT)  W !,?27,GMTSB,!,?27,GMTSD
"RTN","GMTSPN2",124,0)
 K ^UTILITY($J,"W")
"RTN","GMTSPN2",125,0)
 Q
"RTN","GMTSPN2",126,0)
PG(GMTSA,GMTSD) ; Pagers
"RTN","GMTSPN2",127,0)
 N GMTS S GMTS=0,GMTSA=$G(GMTSA),GMTSD=$G(GMTSD) Q:'$L((GMTSA_GMTSD))  Q:(+GMTSA+GMTSD)'>0
"RTN","GMTSPN2",128,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ! I $L(GMTSA),+GMTSA>0 D  Q:$D(GMTSQIT)
"RTN","GMTSPN2",129,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !?34,"Analog Pager:  ",GMTSA S GMTS=1
"RTN","GMTSPN2",130,0)
 I $L(GMTSD),+GMTSD>0 D  Q:$D(GMTSQIT)
"RTN","GMTSPN2",131,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  W !?33,"Digital Pager:  ",GMTSD S GMTS=1
"RTN","GMTSPN2",132,0)
 Q
"RTN","GMTSPN2",133,0)
BL ;   Blank Line
"RTN","GMTSPN2",134,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ! Q
"RTN","GMTSPN2",135,0)
TRIM(X) ;   Trim Spaces from String
"RTN","GMTSPN2",136,0)
 S X=$G(X) F  Q:$E(X,1)'=" "  S X=$E(X,2,$L(X))
"RTN","GMTSPN2",137,0)
 F  Q:$E(X,$L(X))'=" "  S X=$E(X,1,($L(X)-1))
"RTN","GMTSPN2",138,0)
 Q X
"RTN","GMTSPXFP")
0^1^B19095007^B16431441
"RTN","GMTSPXFP",1,0)
GMTSPXFP ; SLC/SBW,KER - PCE Health Factors Component ; 2/22/07 1:52pm
"RTN","GMTSPXFP",2,0)
 ;;2.7;Health Summary;**8,10,28,56,58,62,69,82**;Oct 20, 1995;Build 21
"RTN","GMTSPXFP",3,0)
 ;
"RTN","GMTSPXFP",4,0)
 ; External References
"RTN","GMTSPXFP",5,0)
 ;   DBIA   1243  HF^PXRHS07
"RTN","GMTSPXFP",6,0)
 ;   DBIA   4295  $$GET1^DIQ  (file #9999999.64, .01)
"RTN","GMTSPXFP",7,0)
 ;   DBIA   4295  $$GET1^DIQ  (file #9999999.64, .03)
"RTN","GMTSPXFP",8,0)
 ;   DBIA   4295  $$GET1^DIQ  (file #9999999.64, .08)
"RTN","GMTSPXFP",9,0)
 ;   DBIA   4295  $$GET1^DIQ  (file #9999999.64), .1)
"RTN","GMTSPXFP",10,0)
 ;   DBIA   4295  ^AUTTHF("AC")
"RTN","GMTSPXFP",11,0)
 ;   DBIA  10011  ^DIWP
"RTN","GMTSPXFP",12,0)
 ;                    
"RTN","GMTSPXFP",13,0)
HFSEL ; Health Factors Selected
"RTN","GMTSPXFP",14,0)
 N HFSEG,GMTSFC,GMW,GMTSHFO Q:$O(GMTSEG(GMTSEGN,9999999.64,0))'>0
"RTN","GMTSPXFP",15,0)
 S GMTSFC=0,GMW=0 K ^TMP("PXF",$J),^TMP("GMTSPXO",$J)
"RTN","GMTSPXFP",16,0)
 F  S GMTSFC=$O(GMTSEG(GMTSEGN,9999999.64,GMTSFC)) Q:'GMTSFC  D
"RTN","GMTSPXFP",17,0)
 . S HFSEG(GMTSEG(GMTSEGN,9999999.64,GMTSFC))=""
"RTN","GMTSPXFP",18,0)
 K ^TMP("PXF",$J) D HF^PXRHS07(DFN,GMTSEND,GMTSBEG,GMTSNDM,.HFSEG)
"RTN","GMTSPXFP",19,0)
 Q:'$D(^TMP("PXF",$J))  D REORD D CKP^GMTSUP Q:$D(GMTSQIT)  D SELECT
"RTN","GMTSPXFP",20,0)
 Q
"RTN","GMTSPXFP",21,0)
REORD ; Re-Order Selected Health Factors
"RTN","GMTSPXFP",22,0)
 N GMTSI,GMTSHFI,GMTSCAT,GMTSHFT,GMTSMCAT,GMTSHF,GMTSHFC K GMTSHFO
"RTN","GMTSPXFP",23,0)
 S GMTSI=0 F  S GMTSI=$O(GMTSEG(GMTSEGN,9999999.64,GMTSI)) Q:+GMTSI=0  D
"RTN","GMTSPXFP",24,0)
 . S GMTSHFI=$G(GMTSEG(GMTSEGN,9999999.64,GMTSI))
"RTN","GMTSPXFP",25,0)
 . S GMTSCAT=$$GET1^DIQ(9999999.64,(GMTSHFI_","),.03)
"RTN","GMTSPXFP",26,0)
 . S GMTSHFT=$$GET1^DIQ(9999999.64,(GMTSHFI_","),.1,"I") Q:'$L(GMTSHFT)
"RTN","GMTSPXFP",27,0)
 . I GMTSHFT="C" D  Q
"RTN","GMTSPXFP",28,0)
 . . N GMTSCAT,GMTSMCAT S GMTSMCAT=GMTSHFI N GMTSHFI
"RTN","GMTSPXFP",29,0)
 . . S GMTSCAT=$$GET1^DIQ(9999999.64,(GMTSMCAT_","),.01) Q:'$L(GMTSCAT)
"RTN","GMTSPXFP",30,0)
 . . S GMTSHFI=0 F  S GMTSHFI=$O(^AUTTHF("AC",+GMTSMCAT,GMTSHFI)) Q:+GMTSHFI=0  D
"RTN","GMTSPXFP",31,0)
 . . . S GMTSHF=$$GET1^DIQ(9999999.64,(GMTSHFI_","),.01) Q:'$L(GMTSHF)
"RTN","GMTSPXFP",32,0)
 . . . S GMTSHFC=+($O(^TMP("GMTSPXO",$J," "),-1))+1,^TMP("GMTSPXO",$J,GMTSHFC,GMTSCAT,GMTSHF)=""
"RTN","GMTSPXFP",33,0)
 . Q:'$L(GMTSCAT)  S GMTSHF=$$GET1^DIQ(9999999.64,(GMTSHFI_","),.01) Q:'$L(GMTSHF)
"RTN","GMTSPXFP",34,0)
 . S GMTSHFC=+($O(^TMP("GMTSPXO",$J," "),-1))+1,^TMP("GMTSPXO",$J,GMTSHFC,GMTSCAT,GMTSHF)=""
"RTN","GMTSPXFP",35,0)
 Q
"RTN","GMTSPXFP",36,0)
HFACT ; Control Health Factor retrieval and display
"RTN","GMTSPXFP",37,0)
 K ^TMP("PXF",$J) D HF^PXRHS07(DFN,GMTSEND,GMTSBEG,GMTSNDM) Q:'$D(^TMP("PXF",$J))
"RTN","GMTSPXFP",38,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D HFMAIN
"RTN","GMTSPXFP",39,0)
 Q
"RTN","GMTSPXFP",40,0)
HFMAIN ; Display Health Factors
"RTN","GMTSPXFP",41,0)
 N GMHFC,GMHF,GMDT,GMIFN,GMN0,GMW,X,GMTSDAT,HF,LEVEL,PHFC,COMMENT,GMICL,GMTAB,GMTSLN,GMTSFRST S GMHFC="",GMW=0,GMTSFRST=0
"RTN","GMTSPXFP",42,0)
 F  S GMHFC=$O(^TMP("PXF",$J,GMHFC)) Q:GMHFC=""  D  Q:$D(GMTSQIT)
"RTN","GMTSPXFP",43,0)
 . S GMHF="" F  S GMHF=$O(^TMP("PXF",$J,GMHFC,GMHF)) Q:GMHF=""  D  Q:$D(GMTSQIT)
"RTN","GMTSPXFP",44,0)
 . . D BYDT
"RTN","GMTSPXFP",45,0)
 K ^TMP("PXF",$J),^TMP("GMTSPXO",$J) W:GMTSFRST=0 " No data available",!
"RTN","GMTSPXFP",46,0)
 Q
"RTN","GMTSPXFP",47,0)
SELECT ; Display Selected Health Factors
"RTN","GMTSPXFP",48,0)
 N GMO,GMHFC,GMHF,GMDT,GMIFN,GMN0,GMW,X,GMTSDAT,HF,LEVEL,PHFC,COMMENT,GMICL,GMTAB,GMTSLN,GMTSFRST S GMHFC="",GMW=0,PHFC="",GMTSFRST=0
"RTN","GMTSPXFP",49,0)
 S GMO=0 F  S GMO=$O(^TMP("GMTSPXO",$J,GMO)) Q:+GMO=0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXFP",50,0)
 . S GMHFC="" F  S GMHFC=$O(^TMP("GMTSPXO",$J,GMO,GMHFC)) Q:'$L(GMHFC)  D  Q:$D(GMTSQIT)
"RTN","GMTSPXFP",51,0)
 . . S GMHF="" F  S GMHF=$O(^TMP("GMTSPXO",$J,GMO,GMHFC,GMHF)) Q:'$L(GMHF)  D  Q:$D(GMTSQIT)
"RTN","GMTSPXFP",52,0)
 . . . D BYDT
"RTN","GMTSPXFP",53,0)
 K ^TMP("PXF",$J),^TMP("GMTSPXO",$J) W:GMTSFRST=0 " No Data Available",!
"RTN","GMTSPXFP",54,0)
 Q
"RTN","GMTSPXFP",55,0)
BYDT ; Display Health Factors by Date
"RTN","GMTSPXFP",56,0)
 N GMDT,GMIFN S GMDT=0 F  S GMDT=$O(^TMP("PXF",$J,GMHFC,GMHF,GMDT)) Q:GMDT'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXFP",57,0)
 . S GMIFN=0 F  S GMIFN=$O(^TMP("PXF",$J,GMHFC,GMHF,GMDT,GMIFN)) Q:GMIFN'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXFP",58,0)
 . . D HFDSP Q:$D(GMTSQIT)
"RTN","GMTSPXFP",59,0)
 Q
"RTN","GMTSPXFP",60,0)
HDR ; Display Header
"RTN","GMTSPXFP",61,0)
 N GMTSRN Q:$D(GMTSOBJ)  Q:$D(GMTSQIT)
"RTN","GMTSPXFP",62,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Category",!
"RTN","GMTSPXFP",63,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W "  Health Factor ",?50,"Visit Date",! W:GMTSFRST=1 !
"RTN","GMTSPXFP",64,0)
 Q
"RTN","GMTSPXFP",65,0)
HFDSP ; Display Data
"RTN","GMTSPXFP",66,0)
 N GMTSRN,GMTSIEN
"RTN","GMTSPXFP",67,0)
 ;VMP/RJT -- HD67936 -- HEALTH FACTORS 'DISPLAY ON HEALTH SUMMARY' PARAMETER CHECK
"RTN","GMTSPXFP",68,0)
 S GMTSIEN=$$FIND1^DIC(9999999.64,"","X",GMHF,"B",""),GMTSRN=$$GET1^DIQ(9999999.64,GMTSIEN,.08,"I")
"RTN","GMTSPXFP",69,0)
 Q:GMTSRN'="Y"
"RTN","GMTSPXFP",70,0)
 I GMTSFRST=0 D HDR S GMTSFRST=1
"RTN","GMTSPXFP",71,0)
 S GMN0=$G(^TMP("PXF",$J,GMHFC,GMHF,GMDT,GMIFN,0))
"RTN","GMTSPXFP",72,0)
 Q:GMN0']""
"RTN","GMTSPXFP",73,0)
 S X=$P(GMN0,U,2) D REGDT4^GMTSU S GMTSDAT=X
"RTN","GMTSPXFP",74,0)
 S HF=$P(GMN0,U),LEVEL=$P(GMN0,U,4)
"RTN","GMTSPXFP",75,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HDR D
"RTN","GMTSPXFP",76,0)
 . I GMHFC'=$G(PHFC)!GMTSNPG D
"RTN","GMTSPXFP",77,0)
 . . I '$D(GMTSOBJ),$G(PHFC)="",'GMTSNPG W ! D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPXFP",78,0)
 . . W GMHFC,! S PHFC=GMHFC
"RTN","GMTSPXFP",79,0)
 . S GMW=1
"RTN","GMTSPXFP",80,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPXFP",81,0)
 W ?2,HF
"RTN","GMTSPXFP",82,0)
 W:LEVEL]"" " (",LEVEL,")"
"RTN","GMTSPXFP",83,0)
 W ?50,GMTSDAT,!
"RTN","GMTSPXFP",84,0)
 S COMMENT="",COMMENT=$P(^TMP("PXF",$J,GMHFC,GMHF,GMDT,GMIFN,"COM"),U)
"RTN","GMTSPXFP",85,0)
 I COMMENT]"" S GMICL=13,GMTAB=2 D FORMAT I $D(^UTILITY($J,"W")) D CKP^GMTSUP Q:$D(GMTSQIT)  D
"RTN","GMTSPXFP",86,0)
 . F GMTSLN=1:1:^UTILITY($J,"W",DIWL) D LINE Q:$D(GMTSQIT)
"RTN","GMTSPXFP",87,0)
 Q
"RTN","GMTSPXFP",88,0)
FORMAT ; Format Line
"RTN","GMTSPXFP",89,0)
 N DIWR,DIWF,X
"RTN","GMTSPXFP",90,0)
 S DIWL=3,DIWR=80-(GMICL+GMTAB)
"RTN","GMTSPXFP",91,0)
 K ^UTILITY($J,"W")
"RTN","GMTSPXFP",92,0)
 S X=COMMENT D ^DIWP
"RTN","GMTSPXFP",93,0)
 Q
"RTN","GMTSPXFP",94,0)
LINE ; Write Line
"RTN","GMTSPXFP",95,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?13,^UTILITY($J,"W",DIWL,GMTSLN,0),!
"RTN","GMTSPXFP",96,0)
 Q
"RTN","GMTSPXHR")
0^3^B16949930^B16312728
"RTN","GMTSPXHR",1,0)
GMTSPXHR ; SLC/SBW,KER - PCE Clinical Reminders/Maint ; 06/15/2005
"RTN","GMTSPXHR",2,0)
 ;;2.7;Health Summary;**8,22,23,28,34,56,63,75,82**;Oct 20, 1995;Build 21
"RTN","GMTSPXHR",3,0)
 ;
"RTN","GMTSPXHR",4,0)
 ; External References
"RTN","GMTSPXHR",5,0)
 ;   DBIA  2182  MAIN^PXRM
"RTN","GMTSPXHR",6,0)
 ;                       
"RTN","GMTSPXHR",7,0)
MAIN ; Entry Point for Clinical Reminders
"RTN","GMTSPXHR",8,0)
 N CM,GMFLAG,HVET,HVDISP
"RTN","GMTSPXHR",9,0)
 S (HVET,CM)=0
"RTN","GMTSPXHR",10,0)
 I GMTSEGH["CR" S GMFLAG=0
"RTN","GMTSPXHR",11,0)
 I GMTSEGH["CRS" S GMFLAG=1
"RTN","GMTSPXHR",12,0)
 I GMTSEGH["CM" S GMFLAG=5,CM=1
"RTN","GMTSPXHR",13,0)
 I GMTSEGH["CMB" S GMFLAG=4,CM=1
"RTN","GMTSPXHR",14,0)
 I GMTSEGH["MHVD" S HVET=1,CM=1,HVDISP=11
"RTN","GMTSPXHR",15,0)
 I GMTSEGH["MHVS" S HVET=1,CM=1,HVDISP=10
"RTN","GMTSPXHR",16,0)
 Q:+$G(GMTSAGE)'>0!($G(SEX)="")!($G(DFN)'>0)
"RTN","GMTSPXHR",17,0)
 I HVET=1 D HVET Q
"RTN","GMTSPXHR",18,0)
 Q:$O(GMTSEG(GMTSEGN,811.9,0))'>0
"RTN","GMTSPXHR",19,0)
 N GMCR,GMFIRST,CRSEG,GMDISP
"RTN","GMTSPXHR",20,0)
 S GMCR=0,GMFIRST=1
"RTN","GMTSPXHR",21,0)
 F  S GMCR=$O(GMTSEG(GMTSEGN,811.9,GMCR)) Q:'GMCR  D  Q:$D(GMTSQIT)
"RTN","GMTSPXHR",22,0)
 . S CRSEG=GMTSEG(GMTSEGN,811.9,GMCR)
"RTN","GMTSPXHR",23,0)
 . K ^TMP("PXRHM",$J),^TMP("PXRM",$J)
"RTN","GMTSPXHR",24,0)
 . D MAIN^PXRM(DFN,CRSEG,+$G(GMFLAG),1)
"RTN","GMTSPXHR",25,0)
 . D:+$D(^TMP("PXRHM",$J)) GETCR
"RTN","GMTSPXHR",26,0)
 I +$G(GMDISP)'>0 D CKP^GMTSUP Q:$D(GMTSQIT)  W "Selected Clinical Reminders not due.",!
"RTN","GMTSPXHR",27,0)
 K ^TMP("PXRHM",$J),^TMP("PXRM",$J)
"RTN","GMTSPXHR",28,0)
 Q
"RTN","GMTSPXHR",29,0)
 ;
"RTN","GMTSPXHR",30,0)
HVET ;
"RTN","GMTSPXHR",31,0)
 N GMFIRST
"RTN","GMTSPXHR",32,0)
 K ^TMP("PXRHM",$J),^TMP("PXRMHV",$J)
"RTN","GMTSPXHR",33,0)
 S GMFIRST=1
"RTN","GMTSPXHR",34,0)
 D HS^PXRMHVET(DFN,HVDISP)
"RTN","GMTSPXHR",35,0)
 D:+$D(^TMP("PXRMHV",$J)) GETCRH
"RTN","GMTSPXHR",36,0)
 I +$G(GMDISP)'>0 D CKP^GMTSUP Q:$D(GMTSQIT)  W "No Patient Reminders found.",!
"RTN","GMTSPXHR",37,0)
 K ^TMP("PXRHM",$J),^TMP("PXRMHV",$J)
"RTN","GMTSPXHR",38,0)
 Q
"RTN","GMTSPXHR",39,0)
 ;
"RTN","GMTSPXHR",40,0)
GETCR ; Get reminders that were returned
"RTN","GMTSPXHR",41,0)
 N ITEM,GMDT,GMN0,X,GMTSDAT,GMTSDUE,GMREM
"RTN","GMTSPXHR",42,0)
 I HVET=1 D GETCRH
"RTN","GMTSPXHR",43,0)
 S ITEM=0
"RTN","GMTSPXHR",44,0)
 F  S ITEM=$O(^TMP("PXRHM",$J,ITEM)) Q:ITEM'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXHR",45,0)
 . S GMREM=""
"RTN","GMTSPXHR",46,0)
 . F  S GMREM=$O(^TMP("PXRHM",$J,ITEM,GMREM)) Q:GMREM=""  D CRDISP Q:$D(GMTSQIT)
"RTN","GMTSPXHR",47,0)
 Q
"RTN","GMTSPXHR",48,0)
 ;
"RTN","GMTSPXHR",49,0)
GETCRH ; Get Reminders that were returned for MyHealtheVet
"RTN","GMTSPXHR",50,0)
 N ITEM,GMDT,GMN0,X,GMTSDAT,GMTSDUE,GMREM,GMSTATUS
"RTN","GMTSPXHR",51,0)
 S GMSTATUS=""
"RTN","GMTSPXHR",52,0)
 F  S GMSTATUS=$O(^TMP("PXRMHV",$J,GMSTATUS)) Q:GMSTATUS=""  D  Q:$D(GMTSQIT)
"RTN","GMTSPXHR",53,0)
 .S GMREM="" F  S GMREM=$O(^TMP("PXRMHV",$J,GMSTATUS,GMREM)) Q:GMREM=""  D  Q:$D(GMTSQIT)
"RTN","GMTSPXHR",54,0)
 ..S ITEM=0 F  S ITEM=$O(^TMP("PXRMHV",$J,GMSTATUS,GMREM,ITEM)) Q:ITEM'>0  D CRDISP Q:$D(GMTSQIT)
"RTN","GMTSPXHR",55,0)
 Q
"RTN","GMTSPXHR",56,0)
 ;
"RTN","GMTSPXHR",57,0)
CRDISP ; Display reminder data
"RTN","GMTSPXHR",58,0)
 N DUECOL,HIST,LASTCOL,STATUS,STATCOL,TYPE
"RTN","GMTSPXHR",59,0)
 I HVET=0 S GMN0=$G(^TMP("PXRHM",$J,ITEM,GMREM))
"RTN","GMTSPXHR",60,0)
 I HVET=1 S GMN0=$G(^TMP("PXRMHV",$J,GMSTATUS,GMREM,ITEM))
"RTN","GMTSPXHR",61,0)
 Q:GMN0']""
"RTN","GMTSPXHR",62,0)
 S STATUS=$P(GMN0,U,1)
"RTN","GMTSPXHR",63,0)
 S X=$P(GMN0,U,2) D REGDT4^GMTSU S GMTSDUE=X
"RTN","GMTSPXHR",64,0)
 S X=$P(GMN0,U,3) D REGDT4^GMTSU S GMTSDAT=X
"RTN","GMTSPXHR",65,0)
 S TYPE=$P(GMN0,U,4)
"RTN","GMTSPXHR",66,0)
 I TYPE["E" S HIST="(hist)"
"RTN","GMTSPXHR",67,0)
 I TYPE["X" S HIST="(exp)"
"RTN","GMTSPXHR",68,0)
 S GMDISP=1
"RTN","GMTSPXHR",69,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPXHR",70,0)
 I '$D(GMTSOBJ("COMPONENT HEADER")),$D(GMTSOBJ("REPORT HEADER")),GMFIRST=1 W !!
"RTN","GMTSPXHR",71,0)
 I GMTSNPG D HDR,CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPXHR",72,0)
         I GMTSNPG D HDR
"RTN","GMTSPXHR",73,0)
         I GMFIRST W ?36,"--STATUS--",?47,"--DUE DATE--",?61,"--LAST DONE--",! S GMFIRST=0
"RTN","GMTSPXHR",74,0)
 S STATCOL=41-($L(STATUS)/2)
"RTN","GMTSPXHR",75,0)
 S DUECOL=53-($L(GMTSDUE)/2)
"RTN","GMTSPXHR",76,0)
 S LASTCOL=67-($L(GMTSDAT)/2)
"RTN","GMTSPXHR",77,0)
 W GMREM,?STATCOL,STATUS,?DUECOL,GMTSDUE,?LASTCOL,GMTSDAT,?73,$G(HIST),!
"RTN","GMTSPXHR",78,0)
 I 'CM Q
"RTN","GMTSPXHR",79,0)
 ;   Display activity data on reminder
"RTN","GMTSPXHR",80,0)
 I HVET=1 D HVETCM Q
"RTN","GMTSPXHR",81,0)
 ;;commented out the following because I believe it is outdated
"RTN","GMTSPXHR",82,0)
 ;S GMDT=0
"RTN","GMTSPXHR",83,0)
 ;F  S GMDT=$O(^TMP("PXRHM",$J,ITEM,GMREM,GMDT)) Q:+GMDT'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXHR",84,0)
 ;. S GMN0=$G(^TMP("PXRHM",$J,ITEM,GMREM,GMDT))
"RTN","GMTSPXHR",85,0)
 ;. Q:GMN0']""
"RTN","GMTSPXHR",86,0)
 ;. I $P(GMN0,U,2) S X=$P(GMN0,U,2) D REGDT4^GMTSU S GMTSDAT=X
"RTN","GMTSPXHR",87,0)
 ;. D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPXHR",88,0)
 ;. I GMTSNPG D HDR
"RTN","GMTSPXHR",89,0)
 ;. W ?5,$P(GMN0,U)," on record - ",$G(GMTSDAT),", ",$P(GMN0,U,3),!
"RTN","GMTSPXHR",90,0)
 ;;   Display maintenance criteria for reminder
"RTN","GMTSPXHR",91,0)
 S GMDT=0
"RTN","GMTSPXHR",92,0)
 F  S GMDT=$O(^TMP("PXRHM",$J,ITEM,GMREM,"TXT",GMDT)) Q:+GMDT'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXHR",93,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPXHR",94,0)
 . I GMTSNPG D HDR
"RTN","GMTSPXHR",95,0)
 . W ?5,$G(^TMP("PXRHM",$J,ITEM,GMREM,"TXT",GMDT)),!
"RTN","GMTSPXHR",96,0)
 W !
"RTN","GMTSPXHR",97,0)
 Q
"RTN","GMTSPXHR",98,0)
HVETCM ;
"RTN","GMTSPXHR",99,0)
 ;   Display maintenance criteria for reminder
"RTN","GMTSPXHR",100,0)
 S GMDT=0
"RTN","GMTSPXHR",101,0)
 F  S GMDT=$O(^TMP("PXRMHV",$J,GMSTATUS,GMREM,ITEM,"TXT",GMDT)) Q:+GMDT'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXHR",102,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPXHR",103,0)
 . I GMTSNPG D HDR
"RTN","GMTSPXHR",104,0)
 . W ?5,$G(^TMP("PXRMHV",$J,GMSTATUS,GMREM,ITEM,"TXT",GMDT)),!
"RTN","GMTSPXHR",105,0)
 W !
"RTN","GMTSPXHR",106,0)
 Q
"RTN","GMTSPXHR",107,0)
 ;
"RTN","GMTSPXHR",108,0)
HDR ; Component Header
"RTN","GMTSPXHR",109,0)
 Q:'$D(GMTSOBJ("COMPONENT HEADER"))
"RTN","GMTSPXHR",110,0)
 N GMREC S GMREC=0
"RTN","GMTSPXHR",111,0)
 F  S GMREC=$O(^TMP("PXRM",$J,"DISC",GMREC)) Q:+GMREC'>0  D  Q:$D(GMTSQIT)
"RTN","GMTSPXHR",112,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPXHR",113,0)
 . W ?1,$G(^TMP("PXRM",$J,"DISC",GMREC)),!
"RTN","GMTSPXHR",114,0)
 W !
"RTN","GMTSPXHR",115,0)
 Q
"VER")
8.0^22.0
"BLD",6801,6)
^83
**END**
**END**
