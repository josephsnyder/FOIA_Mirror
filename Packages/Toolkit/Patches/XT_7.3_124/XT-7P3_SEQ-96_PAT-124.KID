Released XT*7.3*124 SEQ #96
Extracted from mail message
**KIDS**:XT*7.3*124^

**INSTALL NAME**
XT*7.3*124
"BLD",2767,0)
XT*7.3*124^TOOLKIT^0^3100225^y
"BLD",2767,1,0)
^^3^3^3100225^
"BLD",2767,1,1,0)
E-MAIL REGARDING FILE 15 ADDS NOT SHOWING PSUEDO-SSN 
"BLD",2767,1,2,0)
Refer to patch XT*7.3*124 in the FORUM Patch Module for a
"BLD",2767,1,3,0)
complete description.
"BLD",2767,4,0)
^9.64PA^^
"BLD",2767,6)
4^
"BLD",2767,6.3)
8
"BLD",2767,"ABNS",0)
^9.66A^^
"BLD",2767,"ABPKG")
n^n^
"BLD",2767,"INID")
^
"BLD",2767,"INIT")

"BLD",2767,"KRN",0)
^9.67PA^779.2^20
"BLD",2767,"KRN",.4,0)
.4
"BLD",2767,"KRN",.401,0)
.401
"BLD",2767,"KRN",.402,0)
.402
"BLD",2767,"KRN",.403,0)
.403
"BLD",2767,"KRN",.5,0)
.5
"BLD",2767,"KRN",.84,0)
.84
"BLD",2767,"KRN",3.6,0)
3.6
"BLD",2767,"KRN",3.8,0)
3.8
"BLD",2767,"KRN",9.2,0)
9.2
"BLD",2767,"KRN",9.8,0)
9.8
"BLD",2767,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",2767,"KRN",9.8,"NM",1,0)
XDRDADDS^^0^B14008801
"BLD",2767,"KRN",9.8,"NM",2,0)
XDRMADD^^0^B43074040
"BLD",2767,"KRN",9.8,"NM","B","XDRDADDS",1)

"BLD",2767,"KRN",9.8,"NM","B","XDRMADD",2)

"BLD",2767,"KRN",19,0)
19
"BLD",2767,"KRN",19.1,0)
19.1
"BLD",2767,"KRN",101,0)
101
"BLD",2767,"KRN",409.61,0)
409.61
"BLD",2767,"KRN",771,0)
771
"BLD",2767,"KRN",779.2,0)
779.2
"BLD",2767,"KRN",870,0)
870
"BLD",2767,"KRN",8989.51,0)
8989.51
"BLD",2767,"KRN",8989.52,0)
8989.52
"BLD",2767,"KRN",8994,0)
8994
"BLD",2767,"KRN",8994,"NM",0)
^9.68A^1^1
"BLD",2767,"KRN",8994,"NM",1,0)
XDR ADD POTENTIAL PATIENT DUP^^0
"BLD",2767,"KRN",8994,"NM","B","XDR ADD POTENTIAL PATIENT DUP",1)

"BLD",2767,"KRN","B",.4,.4)

"BLD",2767,"KRN","B",.401,.401)

"BLD",2767,"KRN","B",.402,.402)

"BLD",2767,"KRN","B",.403,.403)

"BLD",2767,"KRN","B",.5,.5)

"BLD",2767,"KRN","B",.84,.84)

"BLD",2767,"KRN","B",3.6,3.6)

"BLD",2767,"KRN","B",3.8,3.8)

"BLD",2767,"KRN","B",9.2,9.2)

"BLD",2767,"KRN","B",9.8,9.8)

"BLD",2767,"KRN","B",19,19)

"BLD",2767,"KRN","B",19.1,19.1)

"BLD",2767,"KRN","B",101,101)

"BLD",2767,"KRN","B",409.61,409.61)

"BLD",2767,"KRN","B",771,771)

"BLD",2767,"KRN","B",779.2,779.2)

"BLD",2767,"KRN","B",870,870)

"BLD",2767,"KRN","B",8989.51,8989.51)

"BLD",2767,"KRN","B",8989.52,8989.52)

"BLD",2767,"KRN","B",8994,8994)

"BLD",2767,"QUES",0)
^9.62^^
"BLD",2767,"REQB",0)
^9.611^1^1
"BLD",2767,"REQB",1,0)
XT*7.3*113^2
"BLD",2767,"REQB","B","XT*7.3*113",1)

"KRN",8994,267,-1)
0^1
"KRN",8994,267,0)
XDR ADD POTENTIAL PATIENT DUP^ADD^XDRDADDS^1^A^0^^1^1^1^0
"KRN",8994,267,1,0)
^8994.01^5^5^3080707^^
"KRN",8994,267,1,1,0)
Add a record to the VistA DUPLICATE RECORD file (#15), or find an existing
"KRN",8994,267,1,2,0)
record for the pair of potential duplicates passed to the RPC. This was
"KRN",8994,267,1,3,0)
written to allow MPI to add potential duplicate patients to the file, when
"KRN",8994,267,1,4,0)
potential duplicates are detected by the Person Service Identity
"KRN",8994,267,1,5,0)
Management (PSIM) probabilistic search.
"KRN",8994,267,2,0)
^8994.02A^6^3
"KRN",8994,267,2,1,0)
FILE NUMBER^1^20^1^2
"KRN",8994,267,2,1,1,0)
^8994.021^3^3^3080707^^^^
"KRN",8994,267,2,1,1,1,0)
File number for the file to which the potential duplicate records belong. 
"KRN",8994,267,2,1,1,2,0)
For example, if the two potential duplicate entries are on the PATIENT 
"KRN",8994,267,2,1,1,3,0)
file, this value is set to 2.
"KRN",8994,267,2,5,0)
TO_IEN^1^14^1^4
"KRN",8994,267,2,5,1,0)
^8994.021^2^2^3080707^^
"KRN",8994,267,2,5,1,1,0)
Internal Entry Number (IEN) of one of the potential duplicate records. 
"KRN",8994,267,2,5,1,2,0)
For example, this could be a DFN from the PATIENT file (file #2).
"KRN",8994,267,2,6,0)
FROM_IEN^1^14^1^3
"KRN",8994,267,2,6,1,0)
^8994.021^2^2^3080707^^
"KRN",8994,267,2,6,1,1,0)
Internal Entry Number (IEN) of one of the potential duplicate records. 
"KRN",8994,267,2,6,1,2,0)
For example, this could be a DFN from the PATIENT file (file #2).
"KRN",8994,267,2,"B","FILE NUMBER",1)

"KRN",8994,267,2,"B","FROM_IEN",6)

"KRN",8994,267,2,"B","TO_IEN",5)

"KRN",8994,267,2,"PARAMSEQ",2,1)

"KRN",8994,267,2,"PARAMSEQ",3,6)

"KRN",8994,267,2,"PARAMSEQ",4,5)

"KRN",8994,267,3,0)
^8994.03^4^4^3080707^^
"KRN",8994,267,3,1,0)
RETURN =IEN from file 15 DUPLICATE RECORD FILE# - If no errors occur, and 
"KRN",8994,267,3,2,0)
if either an existing record is found, or a new record is added.
"KRN",8994,267,3,3,0)
  
"KRN",8994,267,3,4,0)
RETURN = -1^Error Message - if any errors occur
"MBREQ")
0
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"PKG",189,-1)
1^1
"PKG",189,0)
TOOLKIT^XT^PROGRAMMERS OPTIONS, MULTI. TERM LOOKUP
"PKG",189,20,0)
^9.402P^^
"PKG",189,22,0)
^9.49I^1^1
"PKG",189,22,1,0)
7.3^2950403^2960208
"PKG",189,22,1,"PAH",1,0)
124^3100225^12555
"PKG",189,22,1,"PAH",1,1,0)
^^3^3^3100225
"PKG",189,22,1,"PAH",1,1,1,0)
E-MAIL REGARDING FILE 15 ADDS NOT SHOWING PSUEDO-SSN 
"PKG",189,22,1,"PAH",1,1,2,0)
Refer to patch XT*7.3*124 in the FORUM Patch Module for a
"PKG",189,22,1,"PAH",1,1,3,0)
complete description.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","XDRDADDS")
0^1^B14008801^B13998263
"RTN","XDRDADDS",1,0)
XDRDADDS ;SF-IRMFO/TKW -  SILENT API TO ADD POTENTIAL DUPLICATE PAIR TO FILE 15 ;9/22/08  11:27
"RTN","XDRDADDS",2,0)
 ;;7.3;TOOLKIT;**113,124**;Apr 25, 1995;Build 8
"RTN","XDRDADDS",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified
"RTN","XDRDADDS",4,0)
ADD(XDRSLT,XDRFL,XDRFR,XDRTO) ; Add a pair to the DUPLICATE RECORD file (#15)
"RTN","XDRDADDS",5,0)
 ; Called from REMOTE PROCEDURE - XDR ADD POTENTIAL PATIENT DUPS
"RTN","XDRDADDS",6,0)
 ;  XDRSLT = OUTPUT results.
"RTN","XDRDADDS",7,0)
 ;    set to DFN in file 15 if add was successful, -1^ERRMSG if error
"RTN","XDRDADDS",8,0)
 ;  XDRFL = File number where duplicate records reside. If not passed, defaults to PATIENT file.
"RTN","XDRDADDS",9,0)
 ;  XDRFR = From entry IEN (DFN if PATIENT file entry)
"RTN","XDRDADDS",10,0)
 ;  XDRTO = To entry IEN (DFN if PATIENT file entry)
"RTN","XDRDADDS",11,0)
 ;  
"RTN","XDRDADDS",12,0)
 K XDRSLT
"RTN","XDRDADDS",13,0)
 N XDRGBL,XDRPN1,XDRPN2,XDRI,XDRREC1,XDRREC2,XDRFDA,XDRIEN,XDRPN1,XDRPN2
"RTN","XDRDADDS",14,0)
 N XDRSSN1,XDRSSN2,X,X1,X2,X3,I
"RTN","XDRDADDS",15,0)
 ; Default file is PATIENT file.
"RTN","XDRDADDS",16,0)
 S XDRFL=+$G(XDRFL)
"RTN","XDRDADDS",17,0)
 S:'XDRFL XDRFL=2
"RTN","XDRDADDS",18,0)
 S XDRGBL=$G(^DIC(XDRFL,0,"GL"))
"RTN","XDRDADDS",19,0)
 I (XDRGBL="")!($G(^VA(15.1,XDRFL,0))="") D  Q
"RTN","XDRDADDS",20,0)
 . S XDRSLT="-1^File number parameter missing or invalid" Q
"RTN","XDRDADDS",21,0)
 ; Check IENs to make sure they're valid
"RTN","XDRDADDS",22,0)
 S XDRFR=+$G(XDRFR),XDRTO=+$G(XDRTO)
"RTN","XDRDADDS",23,0)
 S XDRPN1=$P($G(@(XDRGBL_XDRFR_",0)")),U)
"RTN","XDRDADDS",24,0)
 I XDRPN1="" D  Q
"RTN","XDRDADDS",25,0)
 . S XDRSLT="-1^First IEN input parameter invalid" Q
"RTN","XDRDADDS",26,0)
 S XDRPN2=$P($G(@(XDRGBL_XDRTO_",0)")),U)
"RTN","XDRDADDS",27,0)
 I XDRPN2="" D  Q
"RTN","XDRDADDS",28,0)
 . S XDRSLT="-1^Second IEN input parameter invalid" Q
"RTN","XDRDADDS",29,0)
 ; If From and To Record pair are already on the Duplicate Record File save IEN and quit.
"RTN","XDRDADDS",30,0)
 S XDRSLT=0
"RTN","XDRDADDS",31,0)
 S XDRREC1=XDRFR_";"_$P(XDRGBL,U,2)
"RTN","XDRDADDS",32,0)
 S XDRREC2=XDRTO_";"_$P(XDRGBL,U,2)
"RTN","XDRDADDS",33,0)
 S X1=XDRREC1_U_XDRREC2,X2=XDRREC2_U_XDRREC1
"RTN","XDRDADDS",34,0)
 F I=0:0 S I=$O(^VA(15,"B",XDRREC1,I)) Q:I'>0  D  Q:XDRSLT
"RTN","XDRDADDS",35,0)
 . S X3=$P($G(^VA(15,I,0)),U,1,2)
"RTN","XDRDADDS",36,0)
 . I X3'=X1,X3'=X2 Q
"RTN","XDRDADDS",37,0)
 . S XDRSLT=I
"RTN","XDRDADDS",38,0)
 . Q
"RTN","XDRDADDS",39,0)
 Q:XDRSLT
"RTN","XDRDADDS",40,0)
 ; If patients, get SSN
"RTN","XDRDADDS",41,0)
 S (XDRSSN1,XDRSSN2)=""
"RTN","XDRDADDS",42,0)
 I XDRFL=2 D
"RTN","XDRDADDS",43,0)
 . S X=$$GET1^DIQ(2,XDRFR_",",.09) S:X]"" XDRSSN1=$E(X,1,3)_"-"_$E(X,4,5)_"-"_$E(X,6,10)
"RTN","XDRDADDS",44,0)
 . S X=$$GET1^DIQ(2,XDRTO_",",.09) S:X]"" XDRSSN2=$E(X,1,3)_"-"_$E(X,4,5)_"-"_$E(X,6,10)
"RTN","XDRDADDS",45,0)
 . Q
"RTN","XDRDADDS",46,0)
 ; Add new record to DUPLICATE RECORD file.
"RTN","XDRDADDS",47,0)
 K XDRFDA,XDRIEN
"RTN","XDRDADDS",48,0)
 S XDRFDA(15,"+1,",.01)=XDRREC1
"RTN","XDRDADDS",49,0)
 S XDRFDA(15,"+1,",.02)=XDRREC2
"RTN","XDRDADDS",50,0)
 S XDRFDA(15,"+1,",.03)="P"
"RTN","XDRDADDS",51,0)
 S XDRFDA(15,"+1,",.06)=DT
"RTN","XDRDADDS",52,0)
 S XDRFDA(15,"+1,",.09)=.5
"RTN","XDRDADDS",53,0)
 F I=.15,.16,.17,.18,.19 S XDRFDA(15,"+1,",I)=0
"RTN","XDRDADDS",54,0)
 D UPDATE^DIE("","XDRFDA","XDRIEN")
"RTN","XDRDADDS",55,0)
 S I=+$O(XDRIEN(0)),I=$G(XDRIEN(I))
"RTN","XDRDADDS",56,0)
 I 'I D  Q
"RTN","XDRDADDS",57,0)
 . S XDRSLT="-1^Error adding record to DUPLICATE RECORD file" Q
"RTN","XDRDADDS",58,0)
 S XDRSLT=I
"RTN","XDRDADDS",59,0)
 ; Send a notice to the DUPLICATE MANAGER MAIL GROUP if the
"RTN","XDRDADDS",60,0)
 ; SEND NEW DUP REC EMAIL field is not set to 1 (suppress). (XT*7.3*113)
"RTN","XDRDADDS",61,0)
 S X=$$GET1^DIQ(15.1,XDRFL_",",99,"I")
"RTN","XDRDADDS",62,0)
 Q:X=1
"RTN","XDRDADDS",63,0)
 D SENDMSG(XDRFL,XDRFR,XDRPN1,XDRSSN1,XDRTO,XDRPN2,XDRSSN2,XDRSLT)
"RTN","XDRDADDS",64,0)
 Q
"RTN","XDRDADDS",65,0)
 ;
"RTN","XDRDADDS",66,0)
SENDMSG(XDRFL,XDRFR,XDRPN1,XDRSSN1,XDRTO,XDRPN2,XDRSSN2,XDRNEWR) ; Send email message
"RTN","XDRDADDS",67,0)
 N XDRGRP,XDRGRPN,XMY,XMTEXT,XMSUB,XMDUZ,XMDUN,XMZ,X,R
"RTN","XDRDADDS",68,0)
 ; Find DUPLICATE MANAGER MAIL GROUP on DUPLICATE RESOLUTION file.
"RTN","XDRDADDS",69,0)
 S XDRGRP=$$GET1^DIQ(15.1,"2,",.11,"I")
"RTN","XDRDADDS",70,0)
 S XDRGRPN=""
"RTN","XDRDADDS",71,0)
 S:XDRGRP>0 XDRGRPN=$$GET1^DIQ(3.8,XDRGRP,.01)
"RTN","XDRDADDS",72,0)
 I XDRGRPN]"" S XMY("G."_XDRGRPN)=""
"RTN","XDRDADDS",73,0)
 E  S XMY(.5)="" ;If no mail grp found, send msg to postmaster
"RTN","XDRDADDS",74,0)
 S X="PATIENT" S:XDRFL'=2 X=$P($G(^DIC(XDRFL,0)),U)
"RTN","XDRDADDS",75,0)
 ; Build mail message
"RTN","XDRDADDS",76,0)
 S R(1)="The following two "_X_" records have been found to be potential duplicates"
"RTN","XDRDADDS",77,0)
 S R(2)="by the MPI matching algorithm. These records have been added to the local"
"RTN","XDRDADDS",78,0)
 S R(3)="DUPLICATE RECORD file and assigned record number "_XDRNEWR_"."
"RTN","XDRDADDS",79,0)
 S R(4)="Please review these records to verify whether they are duplicates"
"RTN","XDRDADDS",80,0)
 S R(5)="and if so merge using the DUPLICATE RECORD MERGE software."
"RTN","XDRDADDS",81,0)
 S R(6)=""
"RTN","XDRDADDS",82,0)
 S R(7)="  "_X_" 1: "_XDRPN1_"  "_XDRSSN1_"  (IEN #"_XDRFR_")"
"RTN","XDRDADDS",83,0)
 S R(8)="  "_X_" 2: "_XDRPN2_"  "_XDRSSN2_"  (IEN #"_XDRTO_")"
"RTN","XDRDADDS",84,0)
 S XMTEXT="R(",XMSUB="Potential Duplicate "_X_" records found by MPI",XMDUZ=.5
"RTN","XDRDADDS",85,0)
 D ^XMD
"RTN","XDRDADDS",86,0)
 Q
"RTN","XDRDADDS",87,0)
 ;
"RTN","XDRDADDS",88,0)
 ;
"RTN","XDRMADD")
0^2^B43074040^B42800986
"RTN","XDRMADD",1,0)
XDRMADD ;SF-IRMFO/IHS/OHPRD/JCM,JLI,REM -  USER CREATED VERIFIED DUPLICATE PAIR ENTRY ;8/28/08  18:25
"RTN","XDRMADD",2,0)
 ;;7.3;TOOLKIT;**23,113,124**;Apr 25, 1995;Build 8
"RTN","XDRMADD",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","XDRMADD",4,0)
 ;;
"RTN","XDRMADD",5,0)
 N XDRFL,XDRCNTR
"RTN","XDRMADD",6,0)
 S XDRCNTR=0
"RTN","XDRMADD",7,0)
START ;
"RTN","XDRMADD",8,0)
 N XDRADFLG,XDRNOPT
"RTN","XDRMADD",9,0)
 K DIC
"RTN","XDRMADD",10,0)
 ; XT*7.3*113 - Setting of XDRNOPT flag, and checking for XDRFL'=2
"RTN","XDRMADD",11,0)
 ;   in this routine and in SCORE entry point, prevent option
"RTN","XDRMADD",12,0)
 ;   from using the duplicate record checking code on the PATIENT file.
"RTN","XDRMADD",13,0)
 ;   DUPLICATE RECORD entries can be added, but no checking is done.
"RTN","XDRMADD",14,0)
 S (XDRQFLG,XDRADFLG,XDRNOPT)=0
"RTN","XDRMADD",15,0)
 I '$D(XDRFL) D
"RTN","XDRMADD",16,0)
 . S DIC("A")="Add entries from which File: " D FILE^XDRDQUE Q:XDRQFLG  ;XT*7.3*124 stop UNDEF if Y=-1
"RTN","XDRMADD",17,0)
 . I XDRFL=2 W "* No potential duplicate threshold % check will be calculated for PATIENTS"
"RTN","XDRMADD",18,0)
 . Q
"RTN","XDRMADD",19,0)
 G:XDRQFLG END
"RTN","XDRMADD",20,0)
 D:XDRFL'=2
"RTN","XDRMADD",21,0)
 . S XDRDTYPE=$P(XDRD(0),U,5)
"RTN","XDRMADD",22,0)
 . Q:XDRDTYPE]""
"RTN","XDRMADD",23,0)
 . ;REM -8/20/96 when XDRDTYPE is null set it to basic.
"RTN","XDRMADD",24,0)
 . S $P(^VA(15.1,XDRFL,0),U,5)="b",XDRDTYPE="b"
"RTN","XDRMADD",25,0)
 . Q
"RTN","XDRMADD",26,0)
 S XDRGL=^DIC(XDRFL,0,"GL")
"RTN","XDRMADD",27,0)
 D:XDRCNTR>0  G:XDRQFLG END
"RTN","XDRMADD",28,0)
 . W ! K DIR S DIR(0)="Y",DIR("A")="Do you want to ADD another pair (Y/N)"
"RTN","XDRMADD",29,0)
 . D ^DIR K DIR S:$D(DIRUT)!('Y) XDRQFLG=1
"RTN","XDRMADD",30,0)
 . Q
"RTN","XDRMADD",31,0)
 S XDRCNTR=XDRCNTR+1
"RTN","XDRMADD",32,0)
 ; Skip duplicate record checking for patients
"RTN","XDRMADD",33,0)
 I XDRFL=2 D
"RTN","XDRMADD",34,0)
 . S (XDRDSCOR("MAX"),XDRDSCOR("PDT%"),XDRD("DUPSCORE"),XDRMADD("DUPSCORE%"))=0
"RTN","XDRMADD",35,0)
 . S XDRADFLG=1
"RTN","XDRMADD",36,0)
 I XDRFL'=2 D BYPASS G:XDRQFLG END
"RTN","XDRMADD",37,0)
 D LKUP G:XDRQFLG END
"RTN","XDRMADD",38,0)
 D CHECK G:XDRQFLG<0 START
"RTN","XDRMADD",39,0)
 I XDRFL'=2 D
"RTN","XDRMADD",40,0)
 . D ^XDRDSCOR S:XDRADFLG XDRDSCOR("PDT%")=0 ;REM -8/23/96 to bypass PDT%
"RTN","XDRMADD",41,0)
 . S XDRD("NOADD")="" D ^XDRDUP
"RTN","XDRMADD",42,0)
 . Q
"RTN","XDRMADD",43,0)
 K XDRDTYPE
"RTN","XDRMADD",44,0)
 D SCORE
"RTN","XDRMADD",45,0)
 I XDRFL'=2,XDRMADD("DUPSCORE%")<XDRDSCOR("PDT%") D  G START ; JLI 4/11/96
"RTN","XDRMADD",46,0)
 . W !!,$C(7),"This pair of patients has a duplicate percentage of only ",XDRMADD("DUPSCORE%"),"% which"
"RTN","XDRMADD",47,0)
 . W !,"is less than the minimal percentage for potential duplicates (",XDRDSCOR("PDT%"),"%)."
"RTN","XDRMADD",48,0)
 . W !!?30,"Patients not added!!!",!!
"RTN","XDRMADD",49,0)
 S XDRDA=+XDRDFLG I XDRDA'>0 D ADD
"RTN","XDRMADD",50,0)
 G:XDRQFLG START
"RTN","XDRMADD",51,0)
 D SHOW^XDRDPICK ; D MERGE ; CHANGED TO CURRENT VERIF METHOD, NOT MERGE 4/11/96  JLI
"RTN","XDRMADD",52,0)
 G START ; ADDED 4/11/96 JLI
"RTN","XDRMADD",53,0)
END D EOJ
"RTN","XDRMADD",54,0)
 Q
"RTN","XDRMADD",55,0)
 ;
"RTN","XDRMADD",56,0)
LKUP ;Looks up the records to add.
"RTN","XDRMADD",57,0)
 K XDRCD,XDRCD2
"RTN","XDRMADD",58,0)
 S DIC=XDRGL,DIC(0)="QEAM"
"RTN","XDRMADD",59,0)
 S DIC("S")="I '$D(^VA(15,""AFR"",$P(XDRGL,U,2),Y))"
"RTN","XDRMADD",60,0)
 S DIC("A")="Select "_$P(^DIC(XDRFL,0),U,1)_": "
"RTN","XDRMADD",61,0)
 D ^DIC K DIC,DA
"RTN","XDRMADD",62,0)
 I $D(DIRUT)!(Y=-1) S XDRQFLG=1 G LKUPX
"RTN","XDRMADD",63,0)
 S XDRCD=+Y
"RTN","XDRMADD",64,0)
LKUP2 S DIC=XDRGL,DIC(0)="QEAM"
"RTN","XDRMADD",65,0)
 S DIC("S")="I '$D(^VA(15,""AFR"",$P(XDRGL,U,2),Y))"
"RTN","XDRMADD",66,0)
 S DIC("A")="    Another  "_$P(^DIC(XDRFL,0),U,1)_": "
"RTN","XDRMADD",67,0)
 D ^DIC K DIC,DA
"RTN","XDRMADD",68,0)
 G:$D(DIRUT)!(Y=-1) LKUP
"RTN","XDRMADD",69,0)
 S XDRCD2=+Y
"RTN","XDRMADD",70,0)
 I XDRCD=XDRCD2 W !!,"Please do not try and merge the same patients together.",!! K XDRCD2 G LKUP2
"RTN","XDRMADD",71,0)
 S XDRMADD("REC1")=$S(XDRCD<XDRCD2:XDRCD,1:XDRCD2)
"RTN","XDRMADD",72,0)
 S XDRMADD("REC2")=$S(XDRMADD("REC1")=XDRCD:XDRCD2,1:XDRCD)
"RTN","XDRMADD",73,0)
 S XDRCD=XDRMADD("REC1"),XDRCD2=XDRMADD("REC2")
"RTN","XDRMADD",74,0)
 W !!,"You will be adding the following pair of records to the duplicate record file:",!
"RTN","XDRMADD",75,0)
 W !?5,"RECORD1:  ",$P(@(XDRGL_XDRCD_",0)"),U)
"RTN","XDRMADD",76,0)
 W !?5,"RECORD2:  ",$P(@(XDRGL_XDRCD2_",0)"),U)
"RTN","XDRMADD",77,0)
 W !! K DIR S DIR(0)="E" D ^DIR K DIR I $D(DIRUT) S XDRQFLG=1 Q
"RTN","XDRMADD",78,0)
 W "  Ok, continuing, hold on ...",!
"RTN","XDRMADD",79,0)
 ;W !!,"Hit return to continue " R XDRMADD("ANS"):DTIME W "  Okay, continuing, hold on ...",!
"RTN","XDRMADD",80,0)
LKUPX Q
"RTN","XDRMADD",81,0)
 ;
"RTN","XDRMADD",82,0)
CHECK ;
"RTN","XDRMADD",83,0)
 S XDRDFLG=0 F XDRDI="APOT","ANOT","AVDUP" I $D(^VA(15,XDRDI,$P(XDRGL,U,2),XDRCD_U_XDRCD2))!($D(^VA(15,XDRDI,$P(XDRGL,U,2),XDRCD2_U_XDRCD))) S XDRDFLG=-1 I XDRDI="APOT" D
"RTN","XDRMADD",84,0)
 . I $D(^VA(15,XDRDI,$P(XDRGL,U,2),XDRCD_U_XDRCD2)) S XDRDFLG=$O(^(XDRCD_U_XDRCD2,0)) Q
"RTN","XDRMADD",85,0)
 . S XDRDFLG=$O(^VA(15,XDRDI,$P(XDRGL,U,2),XDRCD2_U_XDRCD,0))
"RTN","XDRMADD",86,0)
 I XDRDFLG W !!,"They are already entered in Duplicate Record file.",!!
"RTN","XDRMADD",87,0)
 K XDRDI
"RTN","XDRMADD",88,0)
 Q
"RTN","XDRMADD",89,0)
 ;
"RTN","XDRMADD",90,0)
SCORE ;
"RTN","XDRMADD",91,0)
 I XDRFL'=2 D
"RTN","XDRMADD",92,0)
 . S XDRMADD("DUPSCORE%")=$S($G(XDRDSCOR("MAX"))=0:0,1:(XDRD("DUPSCORE")/XDRDSCOR("MAX")))
"RTN","XDRMADD",93,0)
 . S XDRMADD("DUPSCORE%")=$J(XDRMADD("DUPSCORE%"),1,2)
"RTN","XDRMADD",94,0)
 . S XDRMADD("DUPSCORE%")=$S(XDRMADD("DUPSCORE%")<0:0,XDRMADD("DUPSCORE%")<1:$E(XDRMADD("DUPSCORE%"),3,4),1:100)
"RTN","XDRMADD",95,0)
 . Q
"RTN","XDRMADD",96,0)
 S XDRDFR=$S(XDRCD<XDRCD2:XDRCD,1:XDRCD2)
"RTN","XDRMADD",97,0)
 S XDRDTO=$S(XDRDFR=XDRCD:XDRCD2,1:XDRCD)
"RTN","XDRMADD",98,0)
 S XDRMADD("STATUS")="X"
"RTN","XDRMADD",99,0)
 Q
"RTN","XDRMADD",100,0)
 ;
"RTN","XDRMADD",101,0)
ADD ;
"RTN","XDRMADD",102,0)
 ;ADD TO DUPLICATE RECORD FILE
"RTN","XDRMADD",103,0)
 S XDRMAINI="MERGE" D ^XDRMAINI ;LAB/OHPRD ADDED THIS
"RTN","XDRMADD",104,0)
 S DIC="^VA(15,",DIC(0)="L",X=XDRDFR_";"_$P(XDRGL,U,2),DLAYGO=15
"RTN","XDRMADD",105,0)
 S XDRMADDX=XDRDTO_";"_$P(XDRGL,U,2)
"RTN","XDRMADD",106,0)
 S DIC("DR")=".02////^S X=XDRMADDX"_";.03////"_XDRMADD("STATUS")
"RTN","XDRMADD",107,0)
 ;S DIC("DR")=DIC("DR")_";.04//2" ;REM -10/2/96 this will be asked in XDRRMRG!
"RTN","XDRMADD",108,0)
 S DIC("DR")=DIC("DR")_";.03///P"_";.06////"_DT_";.09////"_DUZ
"RTN","XDRMADD",109,0)
 S DIC("DR")=DIC("DR")_";.15////"_XDRDSCOR("MAX")_";.17////"_XDRDSCOR("PDT%")_";.18////"_XDRD("DUPSCORE")_";.19////"_XDRMADD("DUPSCORE%")
"RTN","XDRMADD",110,0)
 S:$D(XDRDSCOR("VDT%")) DIC("DR")=DIC("DR")_";.16////"_XDRDSCOR("VDT%")
"RTN","XDRMADD",111,0)
 D
"RTN","XDRMADD",112,0)
 . N I,X1,X2,X3
"RTN","XDRMADD",113,0)
 . S X1=X_U_XDRMADDX,X2=XDRMADDX_U_X
"RTN","XDRMADD",114,0)
 . F I=0:0 S I=$O(^VA(15,"B",X,I)) Q:I'>0  S X3=$P($G(^VA(15,I,0)),U,1,2) I X3=X1!(X3=X2) K X Q
"RTN","XDRMADD",115,0)
 S Y=-1 I $D(X) D FILE^DICN
"RTN","XDRMADD",116,0)
 K DIC,DR,X,DLAYGO
"RTN","XDRMADD",117,0)
 I Y'>0 S XDRQFLG=1 K XDRCD,XDRCD2 G ADDX
"RTN","XDRMADD",118,0)
 S DIE="^VA(15,",(XDRDA,XDRMPDA,DA)=+Y ; ADDED XDRDA TO LIST 4/11/96 JLI
"RTN","XDRMADD",119,0)
 F XDRMORD=0:0 S XDRMORD=$O(XDRDTEST(XDRMORD)) Q:'XDRMORD  S DR="2101///"_$P(XDRDTEST(XDRMORD),U,1),DR(2,15.02101)=".02////"_XDRDUP("TEST SCORE",XDRMORD) D ^DIE K DR
"RTN","XDRMADD",120,0)
ADDX K DIE,DR,DA,XDRMORD,XDRMADDX,XDRDUP("TEST SCORE")
"RTN","XDRMADD",121,0)
 Q
"RTN","XDRMADD",122,0)
 ;
"RTN","XDRMADD",123,0)
MERGE Q  ;
"RTN","XDRMADD",124,0)
 S XDRMPAIR=XDRDFR_"^"_XDRDTO,XDRM("NOVERIFY")=""
"RTN","XDRMADD",125,0)
 D EN^XDRMAIN
"RTN","XDRMADD",126,0)
MERGEX K XDRM
"RTN","XDRMADD",127,0)
 Q
"RTN","XDRMADD",128,0)
 ;
"RTN","XDRMADD",129,0)
BYPASS ;REM -8/20/96 Add record directly into file 15, bypass threshold.
"RTN","XDRMADD",130,0)
 N X,XDRKEY
"RTN","XDRMADD",131,0)
 S (X,XDRKEY)=0 F  S X=$O(^VA(200,DUZ,51,"B",X)) Q:X'>0!(XDRKEY)  D
"RTN","XDRMADD",132,0)
 .I $$GET1^DIQ(19.1,X,.01)="XDRMGR" S XDRKEY=1 Q
"RTN","XDRMADD",133,0)
 Q:'XDRKEY
"RTN","XDRMADD",134,0)
 S DIR(0)="Y",DIR("A")="Do you want to bypass the potential duplicate threshold % check (Y/N)"
"RTN","XDRMADD",135,0)
 S DIR("??")="^W !!,""This will add the pair of records to the Duplicate Record file without checking the potential duplicate threshold %."""
"RTN","XDRMADD",136,0)
 D ^DIR K DIR S XDRADFLG=Y I $D(DTOUT)!($D(DUOUT)) S XDRQFLG=1 Q
"RTN","XDRMADD",137,0)
 I 'XDRADFLG W !!,*7,"Potential duplicate threshold % will NOT be bypassed!",!
"RTN","XDRMADD",138,0)
 I XDRADFLG D
"RTN","XDRMADD",139,0)
 .W !!,"This will add the pair of records directly into the Duplicate Record file."
"RTN","XDRMADD",140,0)
 .S DIR(0)="YO",DIR("A")="Are you sure you want to continue",DIR("B")="NO"
"RTN","XDRMADD",141,0)
 .D ^DIR K DIR S XDRADFLG=Y W ! I $D(DIRUT) S XDRQFLG=1 Q
"RTN","XDRMADD",142,0)
 .I 'XDRADFLG W *7,!!,"Potential duplicate threshold % will NOT be bypassed!",!
"RTN","XDRMADD",143,0)
 Q
"RTN","XDRMADD",144,0)
 ;
"RTN","XDRMADD",145,0)
EOJ ;
"RTN","XDRMADD",146,0)
 K XDRMADD,XDRMORD,XDRDFR,XDRDTO,X,Y,XDRCD,XDRCD2,XDRD,XDRFL,XDRGL
"RTN","XDRMADD",147,0)
 K XDRFL,XDRMPAIR,XDRMPDA,XDRQFLG,XDRDSCOR,XDRDTEST
"RTN","XDRMADD",148,0)
 Q
"VER")
8.0^22.0
"BLD",2767,6)
^96
**END**
**END**
