Released XT*7.3*108 SEQ #93
Extracted from mail message
**KIDS**:XT*7.3*108^

**INSTALL NAME**
XT*7.3*108
"BLD",1108,0)
XT*7.3*108^TOOLKIT^0^3081212^y
"BLD",1108,1,0)
^^2^2^3081212^^
"BLD",1108,1,1,0)
For a full description, please see the National Patch Module for complete
"BLD",1108,1,2,0)
instructions on this patch, XT*7.3*108.
"BLD",1108,4,0)
^9.64PA^^
"BLD",1108,6.3)
3
"BLD",1108,"ABPKG")
n
"BLD",1108,"KRN",0)
^9.67PA^779.2^20
"BLD",1108,"KRN",.4,0)
.4
"BLD",1108,"KRN",.401,0)
.401
"BLD",1108,"KRN",.402,0)
.402
"BLD",1108,"KRN",.403,0)
.403
"BLD",1108,"KRN",.5,0)
.5
"BLD",1108,"KRN",.84,0)
.84
"BLD",1108,"KRN",3.6,0)
3.6
"BLD",1108,"KRN",3.8,0)
3.8
"BLD",1108,"KRN",9.2,0)
9.2
"BLD",1108,"KRN",9.8,0)
9.8
"BLD",1108,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",1108,"KRN",9.8,"NM",1,0)
XTID^^0^B3927853
"BLD",1108,"KRN",9.8,"NM",2,0)
XTID1^^0^B29516503
"BLD",1108,"KRN",9.8,"NM","B","XTID",1)

"BLD",1108,"KRN",9.8,"NM","B","XTID1",2)

"BLD",1108,"KRN",19,0)
19
"BLD",1108,"KRN",19.1,0)
19.1
"BLD",1108,"KRN",101,0)
101
"BLD",1108,"KRN",409.61,0)
409.61
"BLD",1108,"KRN",771,0)
771
"BLD",1108,"KRN",779.2,0)
779.2
"BLD",1108,"KRN",870,0)
870
"BLD",1108,"KRN",8989.51,0)
8989.51
"BLD",1108,"KRN",8989.52,0)
8989.52
"BLD",1108,"KRN",8994,0)
8994
"BLD",1108,"KRN","B",.4,.4)

"BLD",1108,"KRN","B",.401,.401)

"BLD",1108,"KRN","B",.402,.402)

"BLD",1108,"KRN","B",.403,.403)

"BLD",1108,"KRN","B",.5,.5)

"BLD",1108,"KRN","B",.84,.84)

"BLD",1108,"KRN","B",3.6,3.6)

"BLD",1108,"KRN","B",3.8,3.8)

"BLD",1108,"KRN","B",9.2,9.2)

"BLD",1108,"KRN","B",9.8,9.8)

"BLD",1108,"KRN","B",19,19)

"BLD",1108,"KRN","B",19.1,19.1)

"BLD",1108,"KRN","B",101,101)

"BLD",1108,"KRN","B",409.61,409.61)

"BLD",1108,"KRN","B",771,771)

"BLD",1108,"KRN","B",779.2,779.2)

"BLD",1108,"KRN","B",870,870)

"BLD",1108,"KRN","B",8989.51,8989.51)

"BLD",1108,"KRN","B",8989.52,8989.52)

"BLD",1108,"KRN","B",8994,8994)

"BLD",1108,"QUES",0)
^9.62^^
"BLD",1108,"REQB",0)
^9.611^^
"MBREQ")
0
"PKG",6,-1)
1^1
"PKG",6,0)
TOOLKIT^XT^PROGRAMMERS OPTIONS, MULTI. TERM LOOKUP^
"PKG",6,20,0)
^9.402P^^0
"PKG",6,22,0)
^9.49I^1^1
"PKG",6,22,1,0)
7.3^3040428^2970513^2
"PKG",6,22,1,"PAH",1,0)
108^3081212
"PKG",6,22,1,"PAH",1,1,0)
^^2^2^3081212
"PKG",6,22,1,"PAH",1,1,1,0)
For a full description, please see the National Patch Module for complete
"PKG",6,22,1,"PAH",1,1,2,0)
instructions on this patch, XT*7.3*108.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","XTID")
0^1^B3927853^B3782395
"RTN","XTID",1,0)
XTID    ;OAKCIOFO/JLG - API set for VUID-Term/Concepts in VistA ;08/18/2008 15:12
"RTN","XTID",2,0)
 ;;7.3;TOOLKIT;**93,108**;Apr 25, 1995;Build 3
"RTN","XTID",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified
"RTN","XTID",4,0)
 Q
"RTN","XTID",5,0)
 ;  API set for VUID Term/Concepts in VistA
"RTN","XTID",6,0)
 ; supported by IA # 4631
"RTN","XTID",7,0)
 ; official definition of API set can be viewed online
"RTN","XTID",8,0)
 ; in the VistA Document Library website
"RTN","XTID",9,0)
GETVUID(TFILE,TFIELD,TIREF) ;
"RTN","XTID",10,0)
 ;Function: Returns the VHA unique id (VUID) for a given term 
"RTN","XTID",11,0)
 ;  reference, TIREF.  TIREF is represented differently based 
"RTN","XTID",12,0)
 ;  in its context--the combined value of TFILE and TFIELD
"RTN","XTID",13,0)
 ; 
"RTN","XTID",14,0)
 ;Input:
"RTN","XTID",15,0)
 ; TFILE =  VistA file # where term is defined.
"RTN","XTID",16,0)
 ; (req)
"RTN","XTID",17,0)
 ; TFIELD = field #, in TFILE where term is defined.
"RTN","XTID",18,0)
 ; (opt)    When defined, it must be of type SET OF CODES.
"RTN","XTID",19,0)
 ;          When not defined, TFILE represents a "table" of terms
"RTN","XTID",20,0)
 ; TIREF =  term reference, as internal reference value.
"RTN","XTID",21,0)
 ; (req)    When TFIELD is defined (SET OF CODES), TIREF is the 
"RTN","XTID",22,0)
 ;          internal value used in the set of codes.
"RTN","XTID",23,0)
 ;          When TFIELD is not defined, TIREF is the IEN of the term
"RTN","XTID",24,0)
 ;          in TFILE.
"RTN","XTID",25,0)
 ; 
"RTN","XTID",26,0)
 ;Returns:  Returns the VHA unique id (VUID) as a number for
"RTN","XTID",27,0)
 ;  a given term reference.  On error, it returns  
"RTN","XTID",28,0)
 ;  "0^<error message>" 
"RTN","XTID",29,0)
 ;  
"RTN","XTID",30,0)
 G GETVUID^XTID1
"RTN","XTID",31,0)
 ;
"RTN","XTID",32,0)
SETVUID(TFILE,TFIELD,TIREF,TVUID) ;
"RTN","XTID",33,0)
 ;Function: Assigns (stores) a VHA unique id (VUID) to a given term
"RTN","XTID",34,0)
 ;  reference, TIREF.  TIREF is represented differently based in its 
"RTN","XTID",35,0)
 ;  context--the combined value of TFILE and TFIELD.
"RTN","XTID",36,0)
 ;  
"RTN","XTID",37,0)
 ;Input:
"RTN","XTID",38,0)
 ; TFILE =  VistA file # where term is defined.
"RTN","XTID",39,0)
 ; (req)
"RTN","XTID",40,0)
 ; TFIELD = field #, in TFILE where term is defined.
"RTN","XTID",41,0)
 ; (opt)    When defined, it must be of type SET OF CODES.
"RTN","XTID",42,0)
 ;          When not defined, TFILE represents a "table" of terms
"RTN","XTID",43,0)
 ; TIREF =  term reference, as internal reference value.
"RTN","XTID",44,0)
 ; (req)    When TFIELD is defined (SET OF CODES), TIREF is the 
"RTN","XTID",45,0)
 ;          internal value used in the set of codes.
"RTN","XTID",46,0)
 ;          When TFIELD is not defined, TIREF is the IEN of the term
"RTN","XTID",47,0)
 ;          in TFILE.
"RTN","XTID",48,0)
 ; TVUID =  The VUID number to assign to term reference.
"RTN","XTID",49,0)
 ; (req)
"RTN","XTID",50,0)
 ; 
"RTN","XTID",51,0)
 ;Returns:  Returns indication of operation as
"RTN","XTID",52,0)
 ;  1 for successful; or 
"RTN","XTID",53,0)
 ;  "0^<error message>" for unsuccessful
"RTN","XTID",54,0)
 ;           
"RTN","XTID",55,0)
 ;Modifies: updates or creates new entry in file 8985.1 or 
"RTN","XTID",56,0)
 ;          updates TFILE file
"RTN","XTID",57,0)
 ;  
"RTN","XTID",58,0)
 G SETVUID^XTID1
"RTN","XTID",59,0)
 ;
"RTN","XTID",60,0)
GETSTAT(TFILE,TFIELD,TIREF,TDATE) ;
"RTN","XTID",61,0)
 ;Function: Returns the status information for the given term (TIREF)
"RTN","XTID",62,0)
 ;  and date (TDATE). TIREF is represented differently based in its 
"RTN","XTID",63,0)
 ;  context--the combined value of TFILE and TFIELD
"RTN","XTID",64,0)
 ;  
"RTN","XTID",65,0)
 ;Input:
"RTN","XTID",66,0)
 ; TFILE =  VistA file # where term is defined.
"RTN","XTID",67,0)
 ; (req)
"RTN","XTID",68,0)
 ; TFIELD = field #, in TFILE where term is defined.
"RTN","XTID",69,0)
 ; (opt)    When defined, it must be of type SET OF CODES.
"RTN","XTID",70,0)
 ;          When not defined, TFILE represents a "table" of terms
"RTN","XTID",71,0)
 ; TIREF =  term reference, as internal reference value.
"RTN","XTID",72,0)
 ; (req)    When TFIELD is defined (SET OF CODES), TIREF is the 
"RTN","XTID",73,0)
 ;          internal value used in the set of codes.
"RTN","XTID",74,0)
 ;          When TFIELD is not defined, TIREF is the IEN of the term
"RTN","XTID",75,0)
 ;          in TFILE.
"RTN","XTID",76,0)
 ; TDATE =  FileMan date/time, defaults to NOW.
"RTN","XTID",77,0)
 ; (opt)
"RTN","XTID",78,0)
 ; 
"RTN","XTID",79,0)
 ;Returns:  Returns the status representation for a given 
"RTN","XTID",80,0)
 ;  term reference as
"RTN","XTID",81,0)
 ;  "<internal value>^<FileMan effective date/time>^<external value>"
"RTN","XTID",82,0)
 ;          where value is a set of codes (0:INACTIVE,1:ACTIVE).  
"RTN","XTID",83,0)
 ;          On error, it returns  
"RTN","XTID",84,0)
 ;  "^<error message>" 
"RTN","XTID",85,0)
 ;  
"RTN","XTID",86,0)
 G GETSTAT^XTID1
"RTN","XTID",87,0)
 ;
"RTN","XTID",88,0)
SETSTAT(TFILE,TFIELD,TIREF,TSTAT,TDATE) ;
"RTN","XTID",89,0)
 ;Function: Assigns (stores) status information (TSTAT and TDATE) 
"RTN","XTID",90,0)
 ;  to the given term reference, TIREF. TIREF is represented 
"RTN","XTID",91,0)
 ;  differently based in its context--the combined value of 
"RTN","XTID",92,0)
 ;  TFILE and TFIELD.
"RTN","XTID",93,0)
 ;  
"RTN","XTID",94,0)
 ;Input:
"RTN","XTID",95,0)
 ; TFILE =  VistA file # where term is defined.
"RTN","XTID",96,0)
 ; (req)
"RTN","XTID",97,0)
 ; TFIELD = field #, in TFILE where term is defined.
"RTN","XTID",98,0)
 ; (opt)    When defined, it must be of type SET OF CODES.
"RTN","XTID",99,0)
 ;          When not defined, TFILE represents a "table" of terms
"RTN","XTID",100,0)
 ; TIREF =  term reference, as internal reference value.
"RTN","XTID",101,0)
 ; (req)    When TFIELD is defined (SET OF CODES), TIREF is the 
"RTN","XTID",102,0)
 ;          internal value used in the set of codes.
"RTN","XTID",103,0)
 ;          When TFIELD is not defined, TIREF is the IEN of the term
"RTN","XTID",104,0)
 ;          in TFILE.
"RTN","XTID",105,0)
 ; TSTAT =  The status to assign (0 or 1).
"RTN","XTID",106,0)
 ; (req)    TSTAT is a set of codes (0:INACTIVE, 1:ACTIVE)
"RTN","XTID",107,0)
 ; 
"RTN","XTID",108,0)
 ; TDATE =  FileMan date/time, defaults to NOW.
"RTN","XTID",109,0)
 ; (opt)
"RTN","XTID",110,0)
 ;
"RTN","XTID",111,0)
 ;Returns:  Returns indication of operation
"RTN","XTID",112,0)
 ;  1:successful or or 
"RTN","XTID",113,0)
 ;  "0^<error message>" for unsuccessful
"RTN","XTID",114,0)
 ; 
"RTN","XTID",115,0)
 ;Modifies: updates entry in file 8985.1 or TFILE file
"RTN","XTID",116,0)
 ;  
"RTN","XTID",117,0)
 G SETSTAT^XTID1
"RTN","XTID",118,0)
 ;
"RTN","XTID",119,0)
GETMASTR(TFILE,TFIELD,TIREF) ;
"RTN","XTID",120,0)
 ;Function: Returns the MASTER VUID flag for a given term 
"RTN","XTID",121,0)
 ;  reference, TIREF.  TIREF is represented differently based 
"RTN","XTID",122,0)
 ;  in its context--the combined value of TFILE and TFIELD
"RTN","XTID",123,0)
 ; 
"RTN","XTID",124,0)
 ;Input:
"RTN","XTID",125,0)
 ; TFILE =  VistA file # where term is defined.
"RTN","XTID",126,0)
 ; (req)
"RTN","XTID",127,0)
 ; TFIELD = field #, in TFILE where term is defined.
"RTN","XTID",128,0)
 ; (opt)    When defined, it must be of type SET OF CODES.
"RTN","XTID",129,0)
 ;          When not defined, TFILE represents a "table" of terms
"RTN","XTID",130,0)
 ; TIREF =  term reference, as internal reference value.
"RTN","XTID",131,0)
 ; (req)    When TFIELD is defined (SET OF CODES), TIREF is the 
"RTN","XTID",132,0)
 ;          internal value used in the set of codes.
"RTN","XTID",133,0)
 ;          When TFIELD is not defined, TIREF is the IEN of the term
"RTN","XTID",134,0)
 ;          in TFILE.
"RTN","XTID",135,0)
 ; 
"RTN","XTID",136,0)
 ;Returns:  Returns the MASTER VUID value (set of codes: 0,1)
"RTN","XTID",137,0)
 ;          On error, it returns  
"RTN","XTID",138,0)
 ;  "^<error message>" 
"RTN","XTID",139,0)
 ;  
"RTN","XTID",140,0)
 G GETMASTR^XTID1
"RTN","XTID",141,0)
 ;
"RTN","XTID",142,0)
SETMASTR(TFILE,TFIELD,TIREF,TMASTER) ;
"RTN","XTID",143,0)
 ;Function: Assigns the MASTER VUID flag to a given term
"RTN","XTID",144,0)
 ;  reference, TIREF.  TIREF is represented differently based in its 
"RTN","XTID",145,0)
 ;  context--the combined value of TFILE and TFIELD.
"RTN","XTID",146,0)
 ;  
"RTN","XTID",147,0)
 ;Input:
"RTN","XTID",148,0)
 ; TFILE =  VistA file # where term is defined.
"RTN","XTID",149,0)
 ; (req)
"RTN","XTID",150,0)
 ; TFIELD = field #, in TFILE where term is defined.
"RTN","XTID",151,0)
 ; (opt)    When defined, it must be of type SET OF CODES.
"RTN","XTID",152,0)
 ;          When not defined, TFILE represents a "table" of terms
"RTN","XTID",153,0)
 ; TIREF =  term reference, as internal reference value.
"RTN","XTID",154,0)
 ; (req)    When TFIELD is defined (SET OF CODES), TIREF is the 
"RTN","XTID",155,0)
 ;          internal value used in the set of codes.
"RTN","XTID",156,0)
 ;          When TFIELD is not defined, TIREF is the IEN of the term
"RTN","XTID",157,0)
 ;          in TFILE.
"RTN","XTID",158,0)
 ; TMASTER =  The MASTER VUID flag value to assign to term reference.
"RTN","XTID",159,0)
 ; (req)
"RTN","XTID",160,0)
 ; 
"RTN","XTID",161,0)
 ;Returns:  Returns indication of operation as
"RTN","XTID",162,0)
 ;  1 for successful; or 
"RTN","XTID",163,0)
 ;  "0^<error message>" for unsuccessful
"RTN","XTID",164,0)
 ;           
"RTN","XTID",165,0)
 ;Modifies: updates entry in file 8985.1 or TFILE file
"RTN","XTID",166,0)
 ;  
"RTN","XTID",167,0)
 G SETMASTR^XTID1
"RTN","XTID",168,0)
 ;
"RTN","XTID",169,0)
GETIREF(TFILE,TFIELD,TVUID,TARRAY,TMASTER) ;
"RTN","XTID",170,0)
 ;Function: Returns a list of Terms' internal references (IREF) for 
"RTN","XTID",171,0)
 ;  a given  VUID (TVUID).  A term's file (TFILE) and field limit 
"RTN","XTID",172,0)
 ;  the size of the list to those terms found in a given file/field.  
"RTN","XTID",173,0)
 ;  TIREF is represented differently based in its context--the 
"RTN","XTID",174,0)
 ;  combined value of TFILE and TFIELD.
"RTN","XTID",175,0)
 ;  
"RTN","XTID",176,0)
 ;Input:
"RTN","XTID",177,0)
 ; TFILE =  VistA file # where term is defined.
"RTN","XTID",178,0)
 ; (opt)
"RTN","XTID",179,0)
 ; TFIELD = field #, in TFILE where term is defined.
"RTN","XTID",180,0)
 ; (opt)    When defined, it must be of type SET OF CODES.
"RTN","XTID",181,0)
 ;          When not defined, TFILE represents a "table" of terms
"RTN","XTID",182,0)
 ; TVUID =  term's VHA unique id.
"RTN","XTID",183,0)
 ; (req)    
"RTN","XTID",184,0)
 ; 
"RTN","XTID",185,0)
 ;Output:
"RTN","XTID",186,0)
 ; TARRAY =  name of local or global array that will contain the 
"RTN","XTID",187,0)
 ; (opt)    list of terms as
"RTN","XTID",188,0)
 ; 
"RTN","XTID",189,0)
 ;       ARRAY(TFILE,TFIELD,TIREF)= status
"RTN","XTID",190,0)
 ;           on error it returns
"RTN","XTID",191,0)
 ;       ARRAY("ERROR")="<error message>"
"RTN","XTID",192,0)
 ;          
"RTN","XTID",193,0)
 G GETIREF^XTID1
"RTN","XTID",194,0)
 ;
"RTN","XTID",195,0)
SCREEN(TFILE,TFIELD,TIREF,TDATE,TCACHE) ;
"RTN","XTID",196,0)
 ;Function: Returns the screening condition for the given term (TIREF) 
"RTN","XTID",197,0)
 ;  and date (TDATE).  TIREF is represented differently based in its 
"RTN","XTID",198,0)
 ;  context--the combined value of TFILE and TFIELD.
"RTN","XTID",199,0)
 ;  
"RTN","XTID",200,0)
 ;Input:
"RTN","XTID",201,0)
 ; TFILE =  VistA file # where term is defined.
"RTN","XTID",202,0)
 ; (req)
"RTN","XTID",203,0)
 ; TFIELD = field #, in TFILE where term is defined.
"RTN","XTID",204,0)
 ; (opt)    When defined, it must be of type SET OF CODES.
"RTN","XTID",205,0)
 ;          When not defined, TFILE represents a "table" of terms
"RTN","XTID",206,0)
 ; TIREF =  term reference, as internal reference value.
"RTN","XTID",207,0)
 ; (req)    When TFIELD is defined (SET OF CODES), TIREF is the 
"RTN","XTID",208,0)
 ;          internal value used in the set of codes.
"RTN","XTID",209,0)
 ;          When TFIELD is not defined, TIREF is the IEN of the term
"RTN","XTID",210,0)
 ;          in TFILE.
"RTN","XTID",211,0)
 ; TDATE =  FileMan date/time, defaults to NOW.
"RTN","XTID",212,0)
 ; (opt)
"RTN","XTID",213,0)
 ; TCACHE = A local variable passed by reference.  It must be KILLed
"RTN","XTID",214,0)
 ; (opt)    before initiating each search query (e.g. before calling
"RTN","XTID",215,0)
 ;          the ^DIC).  Using this parameter speeds up the search
"RTN","XTID",216,0)
 ;          (especially in big files).
"RTN","XTID",217,0)
 ;          
"RTN","XTID",218,0)
 ;    Note: This parameter keeps internal values between calls to the
"RTN","XTID",219,0)
 ;          screen logic.  Do not make any assumptions regarding its
"RTN","XTID",220,0)
 ;          value and do not use it in your code!
"RTN","XTID",221,0)
 ; 
"RTN","XTID",222,0)
 ;Returns:  0 (i.e. don't screen) if the term is/was active or 
"RTN","XTID",223,0)
 ;          1 if the term is/was inactive (i.e. screen).
"RTN","XTID",224,0)
 ;          
"RTN","XTID",225,0)
 G SCREEN^XTID1
"RTN","XTID",226,0)
 ;
"RTN","XTID1")
0^2^B29516503^B27860493
"RTN","XTID1",1,0)
XTID1 ;OAKCIOFO/JLG - Implementation of API set in XTID ;12/12/2008 15:12
"RTN","XTID1",2,0)
 ;;7.3;TOOLKIT;**93,108**;Apr 25, 1995;Build 3
"RTN","XTID1",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified
"RTN","XTID1",4,0)
 ; Reference to $$SCREEN^HDISVF01 supported by IA #4640
"RTN","XTID1",5,0)
 Q
"RTN","XTID1",6,0)
GETVUID ;
"RTN","XTID1",7,0)
 ; called from GETVUID^XTID(TFILE,TFIELD,TIREF)
"RTN","XTID1",8,0)
 N CTX,TERM,VUID
"RTN","XTID1",9,0)
 S TFILE=+$G(TFILE),TFIELD=+$G(TFIELD),TIREF=$G(TIREF)
"RTN","XTID1",10,0)
 S:'TFIELD TFIELD=.01
"RTN","XTID1",11,0)
 D CONTEXT^XTIDCTX(TFILE,TFIELD,.CTX)
"RTN","XTID1",12,0)
 Q:'$D(CTX) "0^invalid combination of FILE/FIELD"
"RTN","XTID1",13,0)
 D FINDTERM^XTIDCTX(.CTX,TIREF,.TERM)
"RTN","XTID1",14,0)
 Q:'$D(TERM) "0^TERM IREF doesn't exist in this FILE/FIELD context"
"RTN","XTID1",15,0)
 S VUID=$$GETVUID^XTIDTERM(.TERM)
"RTN","XTID1",16,0)
 Q:'$G(VUID) "0^TERM index did not contain VUID value"
"RTN","XTID1",17,0)
 Q VUID
"RTN","XTID1",18,0)
 ;
"RTN","XTID1",19,0)
GETSTAT ;
"RTN","XTID1",20,0)
 ; called from GETSTAT^XTID(TFILE,TFIELD,TIREF,TDATE)
"RTN","XTID1",21,0)
 N CTX,STATUS,TERM
"RTN","XTID1",22,0)
 S TFILE=+$G(TFILE),TFIELD=+$G(TFIELD),TIREF=$G(TIREF)
"RTN","XTID1",23,0)
 S:'$G(TDATE) TDATE=$$NOW^XLFDT
"RTN","XTID1",24,0)
 S:'TFIELD TFIELD=.01
"RTN","XTID1",25,0)
 D CONTEXT^XTIDCTX(TFILE,TFIELD,.CTX)
"RTN","XTID1",26,0)
 Q:'$D(CTX) "^invalid combination of FILE/FIELD"
"RTN","XTID1",27,0)
 D FINDTERM^XTIDCTX(.CTX,TIREF,.TERM)
"RTN","XTID1",28,0)
 Q:'$D(TERM) "^TERM IREF doesn't exist in this FILE/FIELD context"
"RTN","XTID1",29,0)
 S STATUS=""
"RTN","XTID1",30,0)
 S STATUS=$$GETSTAT^XTIDTERM(.TERM,TDATE)
"RTN","XTID1",31,0)
 Q:STATUS']"" ""
"RTN","XTID1",32,0)
 Q STATUS
"RTN","XTID1",33,0)
 ;
"RTN","XTID1",34,0)
GETMASTR ;
"RTN","XTID1",35,0)
 ; called from GETMASTR^XTID(TFILE,TFIELD,TIREF)
"RTN","XTID1",36,0)
 N CTX,TERM,MASTR
"RTN","XTID1",37,0)
 S TFILE=+$G(TFILE),TFIELD=+$G(TFIELD),TIREF=$G(TIREF)
"RTN","XTID1",38,0)
 S:'TFIELD TFIELD=.01
"RTN","XTID1",39,0)
 D CONTEXT^XTIDCTX(TFILE,TFIELD,.CTX)
"RTN","XTID1",40,0)
 Q:'$D(CTX) "0^invalid combination of FILE/FIELD"
"RTN","XTID1",41,0)
 D FINDTERM^XTIDCTX(.CTX,TIREF,.TERM)
"RTN","XTID1",42,0)
 Q:'$D(TERM) "0^TERM IREF doesn't exist in this FILE/FIELD context"
"RTN","XTID1",43,0)
 S MASTR=""
"RTN","XTID1",44,0)
 S MASTR=$$GETMASTR^XTIDTERM(.TERM)
"RTN","XTID1",45,0)
 Q:MASTR']"" ""
"RTN","XTID1",46,0)
 Q MASTR
"RTN","XTID1",47,0)
 ;
"RTN","XTID1",48,0)
SETVUID ;
"RTN","XTID1",49,0)
 ; called from SETVUID^XTID(TFILE,TFIELD,TIREF,TVUID)
"RTN","XTID1",50,0)
 N CTX,TERM,SUCCESS,OLDVUID
"RTN","XTID1",51,0)
 S TFILE=+$G(TFILE),TFIELD=+$G(TFIELD),TIREF=$G(TIREF),TVUID=$G(TVUID)
"RTN","XTID1",52,0)
 S:'TFIELD TFIELD=.01
"RTN","XTID1",53,0)
 S SUCCESS=0
"RTN","XTID1",54,0)
 D CONTEXT^XTIDCTX(TFILE,TFIELD,.CTX)
"RTN","XTID1",55,0)
 Q:'$D(CTX) "0^invalid combination of FILE/FIELD"
"RTN","XTID1",56,0)
 Q:'$$VALIDREF^XTIDCTX(.CTX,TIREF) "0^TERM IREF doesn't exist in this FILE/FIELD context"
"RTN","XTID1",57,0)
 D FINDTERM^XTIDCTX(.CTX,TIREF,.TERM)
"RTN","XTID1",58,0)
 ;
"RTN","XTID1",59,0)
 ; create new term index entry in "set of codes" not in "tables"
"RTN","XTID1",60,0)
 I '$D(TERM) S SUCCESS=$$NEWTERM^XTIDCTX(.CTX,TIREF,TVUID) Q SUCCESS
"RTN","XTID1",61,0)
 ;
"RTN","XTID1",62,0)
 ; TERM exists
"RTN","XTID1",63,0)
 ; existing entries with empty VUID-related data
"RTN","XTID1",64,0)
 ; determine existing value of VUID
"RTN","XTID1",65,0)
 S OLDVUID=$$GETVUID^XTIDTERM(.TERM)
"RTN","XTID1",66,0)
 I OLDVUID S SUCCESS=$$RPLVUID(OLDVUID,TVUID) Q SUCCESS
"RTN","XTID1",67,0)
 ; 'OLDVUID
"RTN","XTID1",68,0)
 ; set VUID for the first time for existing entry
"RTN","XTID1",69,0)
 S SUCCESS=$$NEWVUID()
"RTN","XTID1",70,0)
 Q SUCCESS
"RTN","XTID1",71,0)
 ;
"RTN","XTID1",72,0)
SETSTAT ;
"RTN","XTID1",73,0)
 ; called from SETSTAT^XTID(TFILE,TFIELD,TIREF,TSTAT,TDATE)
"RTN","XTID1",74,0)
 N CTX,TERM
"RTN","XTID1",75,0)
 S TFILE=+$G(TFILE),TFIELD=+$G(TFIELD),TIREF=$G(TIREF),TSTAT=+$G(TSTAT)
"RTN","XTID1",76,0)
 S:'$G(TDATE) TDATE=$$NOW^XLFDT
"RTN","XTID1",77,0)
 S:'TFIELD TFIELD=.01
"RTN","XTID1",78,0)
 D CONTEXT^XTIDCTX(TFILE,TFIELD,.CTX)
"RTN","XTID1",79,0)
 Q:'$D(CTX) "0^invalid combination of FILE/FIELD"
"RTN","XTID1",80,0)
 D FINDTERM^XTIDCTX(.CTX,TIREF,.TERM)
"RTN","XTID1",81,0)
 Q:'$D(TERM) "0^TERM IREF doesn't exist in this FILE/FIELD context"
"RTN","XTID1",82,0)
 Q:'$$GETVUID^XTIDTERM(.TERM) "0^VUID value must exist before setting STATUS info"
"RTN","XTID1",83,0)
 Q:'$$SETSTAT^XTIDTERM(.TERM,TSTAT,TDATE) "0^unable to set status for the term index"
"RTN","XTID1",84,0)
 Q 1
"RTN","XTID1",85,0)
 ;
"RTN","XTID1",86,0)
SETMASTR ;
"RTN","XTID1",87,0)
 ; called from SETMASTR^XTID(TFILE,TFIELD,TIREF,TMASTER)
"RTN","XTID1",88,0)
 ; constraint: only one entry could be master for given
"RTN","XTID1",89,0)
 ; reference term, must check success after setting master
"RTN","XTID1",90,0)
 N CTX,TERM,NEWMASTR
"RTN","XTID1",91,0)
 S TFILE=+$G(TFILE),TFIELD=+$G(TFIELD),TIREF=$G(TIREF)
"RTN","XTID1",92,0)
 S TMASTER=+$G(TMASTER)
"RTN","XTID1",93,0)
 S:'TFIELD TFIELD=.01
"RTN","XTID1",94,0)
 D CONTEXT^XTIDCTX(TFILE,TFIELD,.CTX)
"RTN","XTID1",95,0)
 Q:'$D(CTX) "0^invalid combination of FILE/FIELD"
"RTN","XTID1",96,0)
 D FINDTERM^XTIDCTX(.CTX,TIREF,.TERM)
"RTN","XTID1",97,0)
 Q:'$D(TERM) "0^TERM IREF doesn't exist in this FILE/FIELD context"
"RTN","XTID1",98,0)
 Q:'$$GETVUID^XTIDTERM(.TERM) "0^VUID value must exist before setting master flag"
"RTN","XTID1",99,0)
 Q:'$$SETMASTR^XTIDTERM(.TERM,TMASTER) "0^unable to set master flag for the term index"
"RTN","XTID1",100,0)
 ; check success based on constraint
"RTN","XTID1",101,0)
 S NEWMASTR=$$GETMASTR^XTID(TFILE,TFIELD,TIREF)
"RTN","XTID1",102,0)
 Q:NEWMASTR'=TMASTER "0^pre-existing master entry"
"RTN","XTID1",103,0)
 Q 1
"RTN","XTID1",104,0)
 ;
"RTN","XTID1",105,0)
GETIREF ; 
"RTN","XTID1",106,0)
 ; called from GETIREF^XTID(TFILE,TFIELD,TVUID,TARRAY,TMASTER)
"RTN","XTID1",107,0)
 N CTX,TERM
"RTN","XTID1",108,0)
 S TFILE=+$G(TFILE),TFIELD=$G(TFIELD),TVUID=$G(TVUID)
"RTN","XTID1",109,0)
 S TMASTER=+$G(TMASTER)
"RTN","XTID1",110,0)
 Q:$G(TARRAY)']""
"RTN","XTID1",111,0)
 D CONTEXT^XTIDCTX(TFILE,TFIELD,.CTX)
"RTN","XTID1",112,0)
 I '$D(CTX) S @TARRAY@("ERROR")="invalid FILE/FIELD combination" Q
"RTN","XTID1",113,0)
 S @TARRAY=0
"RTN","XTID1",114,0)
 D SRCHTRMS^XTIDCTX(.CTX,TVUID,TARRAY,TMASTER)
"RTN","XTID1",115,0)
 Q
"RTN","XTID1",116,0)
 ;
"RTN","XTID1",117,0)
SCREEN ;
"RTN","XTID1",118,0)
 ; called from SCREEN^XTID(TFILE,TFIELD,TIREF,TDATE,TCACHE)
"RTN","XTID1",119,0)
 N ACTIVE,CACHED,SCREEN,STATUS
"RTN","XTID1",120,0)
 S:'$G(TDATE) TDATE=$$NOW^XLFDT
"RTN","XTID1",121,0)
 S TFILE=+$G(TFILE),CACHED=$D(TCACHE(TFILE)) ; cache at file level
"RTN","XTID1",122,0)
 ; screen based on HDI API, use cached value on subsequent calls for same file
"RTN","XTID1",123,0)
 I 'CACHED  D
"RTN","XTID1",124,0)
 . S SCREEN=$$SCREEN^HDISVF01(TFILE,+$G(TFIELD),TDATE)
"RTN","XTID1",125,0)
 . S TCACHE(TFILE)=SCREEN
"RTN","XTID1",126,0)
 E  S SCREEN=TCACHE(TFILE)
"RTN","XTID1",127,0)
 Q:'SCREEN SCREEN
"RTN","XTID1",128,0)
 ; screen based on status in XTID API
"RTN","XTID1",129,0)
 S STATUS=$$GETSTAT^XTID(TFILE,+$G(TFIELD),$G(TIREF),TDATE)
"RTN","XTID1",130,0)
 S ACTIVE=$P(STATUS,"^",1)
"RTN","XTID1",131,0)
 S SCREEN=$SELECT(ACTIVE:0,1:1)
"RTN","XTID1",132,0)
 Q SCREEN
"RTN","XTID1",133,0)
 ;
"RTN","XTID1",134,0)
RPLVUID(OLDV,NEWV) ;
"RTN","XTID1",135,0)
 ; called from SETVUID(TFILE,TFIELD,TIREF,TVUID)
"RTN","XTID1",136,0)
 ; existing TERM index entry with VUID value
"RTN","XTID1",137,0)
 N SUCCESS S SUCCESS=1
"RTN","XTID1",138,0)
 I OLDV=NEWV Q SUCCESS
"RTN","XTID1",139,0)
 ; replace existing VUID value
"RTN","XTID1",140,0)
 I '$$SETVUID^XTIDTERM(.TERM,NEWV) D  Q SUCCESS
"RTN","XTID1",141,0)
 . S SUCCESS="0^unable to replace VUID value to existing term entry" Q
"RTN","XTID1",142,0)
 ;
"RTN","XTID1",143,0)
 Q SUCCESS
"RTN","XTID1",144,0)
 ;
"RTN","XTID1",145,0)
NEWVUID() ;
"RTN","XTID1",146,0)
 ; called from SETVUID(TFILE,TFIELD,TIREF,TVUID)
"RTN","XTID1",147,0)
 ; set VUID value to existing TERM entry
"RTN","XTID1",148,0)
 ; for the first time
"RTN","XTID1",149,0)
 N MASTER,SUCCESS
"RTN","XTID1",150,0)
 S SUCCESS=1,MASTER=1
"RTN","XTID1",151,0)
 I '$$SETVUID^XTIDTERM(.TERM,TVUID) D  Q SUCCESS
"RTN","XTID1",152,0)
 . S SUCCESS="0^unable to add VUID value to existing term entry"
"RTN","XTID1",153,0)
 ;
"RTN","XTID1",154,0)
 ; set master=1 default, will be overridden if duplicate master
"RTN","XTID1",155,0)
 I '$$SETMASTR^XTIDTERM(.TERM,MASTER) D  Q SUCCESS
"RTN","XTID1",156,0)
 . S SUCCESS="0^unable to add MASTER VUID value to existing term entry"
"RTN","XTID1",157,0)
 ;
"RTN","XTID1",158,0)
 Q SUCCESS
"RTN","XTID1",159,0)
 ;
"VER")
8.0^22.0
"BLD",1108,6)
^93
**END**
**END**
