Released XU*8*499 SEQ #407
Extracted from mail message
**KIDS**:XU*8.0*499^

**INSTALL NAME**
XU*8.0*499
"BLD",1093,0)
XU*8.0*499^KERNEL^0^3081014^y^^
"BLD",1093,1,0)
^^2^2^3080529^
"BLD",1093,1,1,0)
Please refer to the Description in the FORUM Patch Module for details.
"BLD",1093,1,2,0)
XU*8*499  Get Client IP when connecting via SSH.
"BLD",1093,4,0)
^9.64PA^8989.3^1
"BLD",1093,4,8989.3,0)
8989.3
"BLD",1093,4,8989.3,2,0)
^9.641^8989.3^1
"BLD",1093,4,8989.3,2,8989.3,0)
KERNEL SYSTEM PARAMETERS  (File-top level)
"BLD",1093,4,8989.3,2,8989.3,1,0)
^9.6411^250^1
"BLD",1093,4,8989.3,2,8989.3,1,250,0)
PEER SYSTEMS
"BLD",1093,4,8989.3,222)
y^y^p^^^^n^^n
"BLD",1093,4,8989.3,224)

"BLD",1093,4,"APDD",8989.3,8989.3)

"BLD",1093,4,"APDD",8989.3,8989.3,250)

"BLD",1093,4,"B",8989.3,8989.3)

"BLD",1093,6.3)
14
"BLD",1093,"INID")
^y
"BLD",1093,"INIT")
POST^XU8P499
"BLD",1093,"KRN",0)
^9.67PA^779.2^20
"BLD",1093,"KRN",.4,0)
.4
"BLD",1093,"KRN",.401,0)
.401
"BLD",1093,"KRN",.402,0)
.402
"BLD",1093,"KRN",.403,0)
.403
"BLD",1093,"KRN",.403,"NM",0)
^9.68A^1^1
"BLD",1093,"KRN",.403,"NM",1,0)
XUSITEPARM    FILE #8989.3^8989.3^0
"BLD",1093,"KRN",.403,"NM","B","XUSITEPARM    FILE #8989.3",1)

"BLD",1093,"KRN",.5,0)
.5
"BLD",1093,"KRN",.84,0)
.84
"BLD",1093,"KRN",3.6,0)
3.6
"BLD",1093,"KRN",3.8,0)
3.8
"BLD",1093,"KRN",9.2,0)
9.2
"BLD",1093,"KRN",9.8,0)
9.8
"BLD",1093,"KRN",9.8,"NM",0)
^9.68A^14^13
"BLD",1093,"KRN",9.8,"NM",1,0)
ZIS4ONT^^0^B29872561
"BLD",1093,"KRN",9.8,"NM",2,0)
ZIS4GTM^^0^B20384143
"BLD",1093,"KRN",9.8,"NM",3,0)
ZTEDIT2^^0^B16339351
"BLD",1093,"KRN",9.8,"NM",4,0)
ZIS^^0^B20827574
"BLD",1093,"KRN",9.8,"NM",5,0)
ZIS1^^0^B26102976
"BLD",1093,"KRN",9.8,"NM",7,0)
ZIS3^^0^B14236085
"BLD",1093,"KRN",9.8,"NM",8,0)
ZIS5^^0^B13269875
"BLD",1093,"KRN",9.8,"NM",9,0)
ZISFONT^^0^B9782391
"BLD",1093,"KRN",9.8,"NM",10,0)
ZISFGTM^^0^B8623260
"BLD",1093,"KRN",9.8,"NM",11,0)
ZOSVONT^^0^B22340698
"BLD",1093,"KRN",9.8,"NM",12,0)
XUSRB4^^0^B15887142
"BLD",1093,"KRN",9.8,"NM",13,0)
ZOSVGTM^^0^B14876188
"BLD",1093,"KRN",9.8,"NM",14,0)
ZOSVGUX^^0^B33819105
"BLD",1093,"KRN",9.8,"NM","B","XUSRB4",12)

"BLD",1093,"KRN",9.8,"NM","B","ZIS",4)

"BLD",1093,"KRN",9.8,"NM","B","ZIS1",5)

"BLD",1093,"KRN",9.8,"NM","B","ZIS3",7)

"BLD",1093,"KRN",9.8,"NM","B","ZIS4GTM",2)

"BLD",1093,"KRN",9.8,"NM","B","ZIS4ONT",1)

"BLD",1093,"KRN",9.8,"NM","B","ZIS5",8)

"BLD",1093,"KRN",9.8,"NM","B","ZISFGTM",10)

"BLD",1093,"KRN",9.8,"NM","B","ZISFONT",9)

"BLD",1093,"KRN",9.8,"NM","B","ZOSVGTM",13)

"BLD",1093,"KRN",9.8,"NM","B","ZOSVGUX",14)

"BLD",1093,"KRN",9.8,"NM","B","ZOSVONT",11)

"BLD",1093,"KRN",9.8,"NM","B","ZTEDIT2",3)

"BLD",1093,"KRN",19,0)
19
"BLD",1093,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",1093,"KRN",19,"NM",1,0)
XUSERWHERE^^0
"BLD",1093,"KRN",19,"NM","B","XUSERWHERE",1)

"BLD",1093,"KRN",19.1,0)
19.1
"BLD",1093,"KRN",101,0)
101
"BLD",1093,"KRN",409.61,0)
409.61
"BLD",1093,"KRN",771,0)
771
"BLD",1093,"KRN",779.2,0)
779.2
"BLD",1093,"KRN",870,0)
870
"BLD",1093,"KRN",8989.51,0)
8989.51
"BLD",1093,"KRN",8989.52,0)
8989.52
"BLD",1093,"KRN",8994,0)
8994
"BLD",1093,"KRN","B",.4,.4)

"BLD",1093,"KRN","B",.401,.401)

"BLD",1093,"KRN","B",.402,.402)

"BLD",1093,"KRN","B",.403,.403)

"BLD",1093,"KRN","B",.5,.5)

"BLD",1093,"KRN","B",.84,.84)

"BLD",1093,"KRN","B",3.6,3.6)

"BLD",1093,"KRN","B",3.8,3.8)

"BLD",1093,"KRN","B",9.2,9.2)

"BLD",1093,"KRN","B",9.8,9.8)

"BLD",1093,"KRN","B",19,19)

"BLD",1093,"KRN","B",19.1,19.1)

"BLD",1093,"KRN","B",101,101)

"BLD",1093,"KRN","B",409.61,409.61)

"BLD",1093,"KRN","B",771,771)

"BLD",1093,"KRN","B",779.2,779.2)

"BLD",1093,"KRN","B",870,870)

"BLD",1093,"KRN","B",8989.51,8989.51)

"BLD",1093,"KRN","B",8989.52,8989.52)

"BLD",1093,"KRN","B",8994,8994)

"BLD",1093,"QDEF")
^^^^YES
"BLD",1093,"QUES",0)
^9.62^^
"FIA",8989.3)
KERNEL SYSTEM PARAMETERS
"FIA",8989.3,0)
^XTV(8989.3,
"FIA",8989.3,0,0)
8989.3P
"FIA",8989.3,0,1)
y^y^p^^^^n^^n
"FIA",8989.3,0,10)

"FIA",8989.3,0,11)

"FIA",8989.3,0,"RLRO")

"FIA",8989.3,0,"VR")
8.0^XU
"FIA",8989.3,8989.3)
1
"FIA",8989.3,8989.3,250)

"INIT")
POST^XU8P499
"KRN",.403,12,-1)
0^1
"KRN",.403,12,0)
XUSITEPARM^^^^2941116^^^8989.3^0^0^1
"KRN",.403,12,40,0)
^.4031I^5^5
"KRN",.403,12,40,1,0)
1^^1,1^2
"KRN",.403,12,40,1,1)
Page 1
"KRN",.403,12,40,1,40,0)
^.4032IP^52^2
"KRN",.403,12,40,1,40,51,0)
XUSITEPARM 0^1^1,1^d
"KRN",.403,12,40,1,40,52,0)
XUSITEPARM 1^2^2,1^e
"KRN",.403,12,40,2,0)
3^^1,1^4^2
"KRN",.403,12,40,2,1)
Page 3
"KRN",.403,12,40,2,40,0)
^.4032IP^53^2
"KRN",.403,12,40,2,40,51,0)
XUSITEPARM 0^1^1,1^d
"KRN",.403,12,40,2,40,53,0)
XUSITEPARM 3^2^4,1^e
"KRN",.403,12,40,3,0)
2^^1,1^3^1
"KRN",.403,12,40,3,1)
Page 2
"KRN",.403,12,40,3,40,0)
^.4032IP^56^4
"KRN",.403,12,40,3,40,51,0)
XUSITEPARM 0^1^1,1^d
"KRN",.403,12,40,3,40,54,0)
XUSITEPARM 2^2^4,1^e
"KRN",.403,12,40,3,40,55,0)
XUSITEPARM 2.1^3^5,12^e
"KRN",.403,12,40,3,40,55,2)
4^^^^
"KRN",.403,12,40,3,40,56,0)
XUSITEPARM 2.2^4^12,12^e
"KRN",.403,12,40,3,40,56,2)
4
"KRN",.403,12,40,4,0)
4^^1,1^5^3
"KRN",.403,12,40,4,1)
Page 4
"KRN",.403,12,40,4,40,0)
^.4032IP^61^6
"KRN",.403,12,40,4,40,51,0)
XUSITEPARM 0^1^1,1^d
"KRN",.403,12,40,4,40,57,0)
XUSITEPARM 4^2^4,1^e
"KRN",.403,12,40,4,40,58,0)
XUSITEPARM 4.1^3^8,4^e
"KRN",.403,12,40,4,40,58,2)
4
"KRN",.403,12,40,4,40,59,0)
XUSITEPARM 4.2^4^8,43^e
"KRN",.403,12,40,4,40,59,2)
4
"KRN",.403,12,40,4,40,60,0)
XUSITEPARM 4.4^6^13,43^e
"KRN",.403,12,40,4,40,60,2)
4
"KRN",.403,12,40,4,40,61,0)
XUSITEPARM 4.3^5^13,4^e
"KRN",.403,12,40,4,40,61,2)
4
"KRN",.403,12,40,5,0)
5^^1,1^1^4
"KRN",.403,12,40,5,1)
Page 5
"KRN",.403,12,40,5,40,0)
^.4032IP^181^2
"KRN",.403,12,40,5,40,51,0)
XUSITEPARM 0^1^1,1^d
"KRN",.403,12,40,5,40,181,0)
XUSITEPARM 5^2^4,1^e
"KRN",.404,51,0)
XUSITEPARM 0^8989.3^
"KRN",.404,51,40,0)
^.4044I^3^2
"KRN",.404,51,40,2,0)
2^Kernel Site Parameter edit^1
"KRN",.404,51,40,2,2)
^^1,24^1
"KRN",.404,51,40,3,0)
1^DOMAIN^3
"KRN",.404,51,40,3,1)
.01
"KRN",.404,51,40,3,2)
2,20^42^2,13
"KRN",.404,52,0)
XUSITEPARM 1^8989.3
"KRN",.404,52,40,0)
^.4044I^20^18
"KRN",.404,52,40,1,0)
1^DEFAULT # OF ATTEMPTS^3
"KRN",.404,52,40,1,1)
202
"KRN",.404,52,40,1,2)
3,31^3^3,8
"KRN",.404,52,40,1,3)
5
"KRN",.404,52,40,2,0)
3^DEFAULT LOCK-OUT TIME^3
"KRN",.404,52,40,2,1)
203
"KRN",.404,52,40,2,2)
4,31^4^4,8
"KRN",.404,52,40,2,3)
30
"KRN",.404,52,40,3,0)
4^DEFAULT MULTIPLE SIGN-ON^3
"KRN",.404,52,40,3,1)
204
"KRN",.404,52,40,3,2)
5,31^8^5,5
"KRN",.404,52,40,3,3)
YES
"KRN",.404,52,40,3,11)
D EN^DDIOL("If you select 'Only one IP' be sure to put a value into the MULTIPLE SIGN-ON LIMIT field so users can sign-on at least once.")
"KRN",.404,52,40,4,0)
15^ASK DEVICE TYPE AT SIGN-ON^3
"KRN",.404,52,40,4,1)
205
"KRN",.404,52,40,4,2)
12,69^3^12,41
"KRN",.404,52,40,4,3)
ASK
"KRN",.404,52,40,5,0)
6^DEFAULT AUTO-MENU^3
"KRN",.404,52,40,5,1)
206
"KRN",.404,52,40,5,2)
6,31^3^6,12
"KRN",.404,52,40,5,3)
NO
"KRN",.404,52,40,6,0)
9^DEFAULT TYPE-AHEAD^3
"KRN",.404,52,40,6,1)
209
"KRN",.404,52,40,6,2)
8,31^3^8,11
"KRN",.404,52,40,6,3)
YES
"KRN",.404,52,40,7,0)
10^DEFAULT TIMED-READ (SECONDS)^3
"KRN",.404,52,40,7,1)
210
"KRN",.404,52,40,7,2)
9,31^5^9,1
"KRN",.404,52,40,7,3)
300
"KRN",.404,52,40,8,0)
12^BYPASS DEVICE LOCK-OUT^3
"KRN",.404,52,40,8,1)
211
"KRN",.404,52,40,8,2)
11,31^3^11,7
"KRN",.404,52,40,9,0)
14^LIFETIME OF VERIFY CODE^3
"KRN",.404,52,40,9,1)
214
"KRN",.404,52,40,9,2)
12,31^3^12,6
"KRN",.404,52,40,9,3)
90
"KRN",.404,52,40,11,0)
8^DEFAULT LANGUAGE^3
"KRN",.404,52,40,11,1)
207
"KRN",.404,52,40,11,2)
7,31^10^7,13
"KRN",.404,52,40,12,0)
16^DEFAULT INSTITUTION^3
"KRN",.404,52,40,12,1)
217
"KRN",.404,52,40,12,2)
13,31^30^13,10
"KRN",.404,52,40,13,0)
17^AUTO-GENERATE ACCESS CODES^3
"KRN",.404,52,40,13,1)
11
"KRN",.404,52,40,13,2)
14,31^3^14,3
"KRN",.404,52,40,14,0)
2^AGENCY CODE^3
"KRN",.404,52,40,14,1)
9
"KRN",.404,52,40,14,2)
3,66^9^3,53
"KRN",.404,52,40,14,3)
VA
"KRN",.404,52,40,16,0)
7^DEFAULT AUTO SIGN-ON^3
"KRN",.404,52,40,16,1)
218
"KRN",.404,52,40,16,2)
6,66^8^6,44
"KRN",.404,52,40,17,0)
11^BROKER TIMEOUT^3
"KRN",.404,52,40,17,1)
230
"KRN",.404,52,40,17,2)
9,66^5^9,50
"KRN",.404,52,40,17,3)
180
"KRN",.404,52,40,18,0)
5^MULTIPLE SIGN-ON LIMIT^3
"KRN",.404,52,40,18,1)
219
"KRN",.404,52,40,18,2)
5,66^3^5,42
"KRN",.404,52,40,19,0)
18^AUTO-GENERATE VERIFY CODES^3
"KRN",.404,52,40,19,1)
11.2
"KRN",.404,52,40,19,2)
15,31^3^15,3
"KRN",.404,52,40,20,0)
13^CCOW TOKEN TIMEOUT^3
"KRN",.404,52,40,20,1)
30.1
"KRN",.404,52,40,20,2)
11,66^5^11,46
"KRN",.404,53,0)
XUSITEPARM 3^8989.3
"KRN",.404,53,40,0)
^.4044I^9^8
"KRN",.404,53,40,1,0)
1^MAX SPOOL LINES PER USER^3
"KRN",.404,53,40,1,1)
31.1
"KRN",.404,53,40,1,2)
1,31^7^1,5
"KRN",.404,53,40,2,0)
2^MAX SPOOL DOCUMENTS PER USER^3
"KRN",.404,53,40,2,1)
31.2
"KRN",.404,53,40,2,2)
2,31^3^2,1
"KRN",.404,53,40,3,0)
3^MAX SPOOL DOCUMENT LIFE-SPAN^3
"KRN",.404,53,40,3,1)
31.3
"KRN",.404,53,40,3,2)
3,31^3^3,1
"KRN",.404,53,40,5,0)
8^NEW PERSON IDENTIFIERS^3
"KRN",.404,53,40,5,1)
21
"KRN",.404,53,40,5,2)
14,4^65^13,1
"KRN",.404,53,40,6,0)
5^DEFAULT DIRECTORY FOR HFS^3
"KRN",.404,53,40,6,1)
320
"KRN",.404,53,40,6,2)
7,28^50^7,1
"KRN",.404,53,40,6,4)
1
"KRN",.404,53,40,7,0)
7^DNS IP^3
"KRN",.404,53,40,7,1)
51
"KRN",.404,53,40,7,2)
11,9^60^11,1
"KRN",.404,53,40,7,4)
1
"KRN",.404,53,40,8,0)
4^MIXED OS^3
"KRN",.404,53,40,8,1)
.05
"KRN",.404,53,40,8,2)
6,28^9^6,18
"KRN",.404,53,40,8,3)
No
"KRN",.404,53,40,8,12)
D UNED^DDSUTL(6,,,$S($$GET^DDSVAL(8989.3,1,.05):0,1:1)),REQ^DDSUTL(6,,,$$GET^DDSVAL(8989.3,1,.05))
"KRN",.404,53,40,8,13)
I '$$GET^DDSVAL(8989.3,1,.05) D PUT^DDSVAL(DIE,.DA,320.2,"",,"I")
"KRN",.404,53,40,9,0)
6^SECONDARY HFS DIRECTORY^3
"KRN",.404,53,40,9,1)
320.2
"KRN",.404,53,40,9,2)
8,28^49^8,3
"KRN",.404,53,40,9,4)
0
"KRN",.404,53,40,9,11)
D UNED^DDSUTL(6,,,$S($$GET^DDSVAL(8989.3,1,.05):0,1:1))
"KRN",.404,54,0)
XUSITEPARM 2^8989.3
"KRN",.404,54,40,0)
^.4044I^3^3
"KRN",.404,54,40,1,0)
1^Vol Set      Max Sign-ons       Log RT?^1
"KRN",.404,54,40,1,2)
^^1,12^1
"KRN",.404,54,40,2,0)
2^ROUTINE MONITORING^3
"KRN",.404,54,40,2,1)
9.8
"KRN",.404,54,40,2,2)
8,22^8^8,2
"KRN",.404,54,40,3,0)
3^Routine Namespace's^1
"KRN",.404,54,40,3,2)
^^9,12^1
"KRN",.404,55,0)
XUSITEPARM 2.1^8989.304
"KRN",.404,55,40,0)
^.4044I^3^3
"KRN",.404,55,40,1,0)
1^^3
"KRN",.404,55,40,1,1)
.01
"KRN",.404,55,40,1,2)
1,1^9
"KRN",.404,55,40,2,0)
2^^3
"KRN",.404,55,40,2,1)
2
"KRN",.404,55,40,2,2)
1,14^4
"KRN",.404,55,40,3,0)
3^^3
"KRN",.404,55,40,3,1)
6
"KRN",.404,55,40,3,2)
1,33^3
"KRN",.404,56,0)
XUSITEPARM 2.2^8989.309
"KRN",.404,56,40,0)
^.4044I^1^1
"KRN",.404,56,40,1,0)
1^^3
"KRN",.404,56,40,1,1)
.01
"KRN",.404,56,40,1,2)
2,5^8
"KRN",.404,57,0)
XUSITEPARM 4^8989.3
"KRN",.404,57,40,0)
^.4044I^8^8
"KRN",.404,57,40,1,0)
1^OPTION AUDIT^3
"KRN",.404,57,40,1,1)
19
"KRN",.404,57,40,1,2)
1,15^24^1,1
"KRN",.404,57,40,2,0)
2^INITIATE AUDIT^3
"KRN",.404,57,40,2,1)
19.4
"KRN",.404,57,40,2,2)
2,20^17^2,4
"KRN",.404,57,40,3,0)
3^TERMINATE AUDIT^3
"KRN",.404,57,40,3,1)
19.5
"KRN",.404,57,40,3,2)
2,60^17^2,43
"KRN",.404,57,40,4,0)
4^Option to audit^1
"KRN",.404,57,40,4,2)
^^4,4^1
"KRN",.404,57,40,5,0)
5^Namespace to audit^1
"KRN",.404,57,40,5,2)
^^4,43^1
"KRN",.404,57,40,6,0)
6^User to audit^1
"KRN",.404,57,40,6,2)
^^9,4^1
"KRN",.404,57,40,7,0)
7^Device to audit^1
"KRN",.404,57,40,7,2)
^^9,43
"KRN",.404,57,40,8,0)
8^FAILED ACCESS ATTEMPTS^3
"KRN",.404,57,40,8,1)
212.5
"KRN",.404,57,40,8,2)
1,67^8^1,43
"KRN",.404,58,0)
XUSITEPARM 4.1^8989.36
"KRN",.404,58,40,0)
^.4044I^1^1
"KRN",.404,58,40,1,0)
1^^3
"KRN",.404,58,40,1,1)
.01
"KRN",.404,58,40,1,2)
1,1^30
"KRN",.404,59,0)
XUSITEPARM 4.2^8989.35
"KRN",.404,59,40,0)
^.4044I^1^1
"KRN",.404,59,40,1,0)
1^^3
"KRN",.404,59,40,1,1)
.01
"KRN",.404,59,40,1,2)
1,1^5
"KRN",.404,60,0)
XUSITEPARM 4.4^8989.33
"KRN",.404,60,40,0)
^.4044I^1^1
"KRN",.404,60,40,1,0)
1^^3
"KRN",.404,60,40,1,1)
.01
"KRN",.404,60,40,1,2)
1,1^20
"KRN",.404,61,0)
XUSITEPARM 4.3^8989.34
"KRN",.404,61,40,0)
^.4044I^1^1
"KRN",.404,61,40,1,0)
1^^3
"KRN",.404,61,40,1,1)
.01
"KRN",.404,61,40,1,2)
1,1^30
"KRN",.404,181,0)
XUSITEPARM 5^8989.3
"KRN",.404,181,40,0)
^.4044I^3^3
"KRN",.404,181,40,1,0)
1^IRM MAIL GROUP^3
"KRN",.404,181,40,1,1)
.02
"KRN",.404,181,40,1,2)
1,27^50^1,11
"KRN",.404,181,40,2,0)
2^AFTER HOURS MAIL GROUP^3
"KRN",.404,181,40,2,1)
.03
"KRN",.404,181,40,2,2)
3,27^50^3,3
"KRN",.404,181,40,3,0)
3^LOG RESOURCE USAGE?^3
"KRN",.404,181,40,3,1)
300
"KRN",.404,181,40,3,2)
5,27^3^5,6
"KRN",19,140,-1)
0^1
"KRN",19,140,0)
XUSERWHERE^Where am I?^^A^^^^^^^^^y^1^^
"KRN",19,140,1,0)
^^2^2^3081009^
"KRN",19,140,1,1,0)
This option shows a user their environment.
"KRN",19,140,1,2,0)
Changed from showing IO("ZIO") to IO("IP").
"KRN",19,140,20)
D GETENV^%ZOSV W !!,"UCI: ",$P(Y,U),"  VOLUME SET: ",$P(Y,U,2) W:$P(Y,U,3)]"" "  NODE: ",$P(Y,U,3) W !," DEVICE: ",$I,$S($D(IO("IP")):"  ("_IO("IP")_")",1:"")
"KRN",19,140,"U")
WHERE AM I?
"MBREQ")
0
"ORD",8,.403)
.403;8;;;EDEOUT^DIFROMSO(.403,DA,"",XPDA);FPRE^DIFROMSI(.403,"",XPDA);EPRE^DIFROMSI(.403,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.403,DA,"",XPDA);DEL^DIFROMSK(.403,"",%)
"ORD",8,.403,0)
FORM
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",3,-1)
1^1
"PKG",3,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",3,20,0)
^9.402P^^0
"PKG",3,22,0)
^9.49I^1^1
"PKG",3,22,1,0)
8.0^3080616^3080616^6
"PKG",3,22,1,"PAH",1,0)
499^3081014
"PKG",3,22,1,"PAH",1,1,0)
^^2^2^3081014
"PKG",3,22,1,"PAH",1,1,1,0)
Please refer to the Description in the FORUM Patch Module for details.
"PKG",3,22,1,"PAH",1,1,2,0)
XU*8*499  Get Client IP when connecting via SSH.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
14
"RTN","XU8P499")
0^^B213938^n/a
"RTN","XU8P499",1,0)
XU8P499 ;ISF/RWF - Patch XU*8*499 Post-init ;09/15/08  12:14
"RTN","XU8P499",2,0)
 ;;8.0;KERNEL;**499**;Jul 10, 1995;Build 14
"RTN","XU8P499",3,0)
 Q
"RTN","XU8P499",4,0)
 ;
"RTN","XU8P499",5,0)
POST ;
"RTN","XU8P499",6,0)
 I '$D(^XTV(8989.3,1,"PEER")) S ^XTV(8989.3,1,"PEER")="127.0.0.1"
"RTN","XU8P499",7,0)
 X ^%ZOSF("EON")
"RTN","XU8P499",8,0)
 W ! D RELOAD^ZTMGRSET W !
"RTN","XU8P499",9,0)
 X ^%ZOSF("EOFF")
"RTN","XU8P499",10,0)
 Q
"RTN","XUSRB4")
0^12^B15887142^B12816308
"RTN","XUSRB4",1,0)
XUSRB4 ;ISF/RWF - Build a temporary sign-on token ;09/15/08  14:23
"RTN","XUSRB4",2,0)
 ;;8.0;KERNEL;**150,337,395,419,437,499**;Jul 10, 1995;Build 14
"RTN","XUSRB4",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified
"RTN","XUSRB4",4,0)
 Q
"RTN","XUSRB4",5,0)
 ;
"RTN","XUSRB4",6,0)
ASH(RET) ;rpc. Auto Signon Handle
"RTN","XUSRB4",7,0)
 N HDL
"RTN","XUSRB4",8,0)
 S HDL=$$HANDLE("XWBAS",1),RET="~1"_HDL
"RTN","XUSRB4",9,0)
 ;Now place user info in it.
"RTN","XUSRB4",10,0)
 D TOK(HDL)
"RTN","XUSRB4",11,0)
 Q
"RTN","XUSRB4",12,0)
 ;
"RTN","XUSRB4",13,0)
CCOW(RET) ;rpc. CCOW Auto Signon Handle
"RTN","XUSRB4",14,0)
 N HDL,HDL2,X
"RTN","XUSRB4",15,0)
 S RET(0)="NO PROXY USER",RET(1)="ERROR"
"RTN","XUSRB4",16,0)
 I $$USERTYPE^XUSAP(DUZ,"APPLICATION PROXY") Q  ;No Proxy
"RTN","XUSRB4",17,0)
 I $$USERTYPE^XUSAP(DUZ,"CONNECTOR PROXY") Q  ;No Proxy
"RTN","XUSRB4",18,0)
 S X=$$ACTIVE^XUSER(DUZ) I 'X S RET(0)=X Q  ;User must be active
"RTN","XUSRB4",19,0)
 S HDL=$$HANDLE("XWBCCW",1)
"RTN","XUSRB4",20,0)
 ;Return RET(0) the CCOW token, RET(1) the domain name and the Station #
"RTN","XUSRB4",21,0)
 S RET(0)="~2"_$$LOW^XLFSTR(HDL),RET(1)=$G(^XMB("NETNAME"))_"^"_$$STA^XUAF4(DUZ(2))
"RTN","XUSRB4",22,0)
 ;Now place user info in it.
"RTN","XUSRB4",23,0)
 D TOK(HDL)
"RTN","XUSRB4",24,0)
 S ^XUTL("XQ",$J,"HDL")=HDL ;Save handle with job
"RTN","XUSRB4",25,0)
 Q
"RTN","XUSRB4",26,0)
 ;
"RTN","XUSRB4",27,0)
HANDLE(NS,LT) ;Return a unique handle into ^XTMP (ef. sup)
"RTN","XUSRB4",28,0)
 ;NS is the namespace, LT is the Handle Lifetime in days
"RTN","XUSRB4",29,0)
 N %H,A,J,HL
"RTN","XUSRB4",30,0)
 I $G(NS)="" Q "" ;Return null if no namespace
"RTN","XUSRB4",31,0)
 S LT=$G(LT,1) S:LT>7 LT=7 ;Default to 1
"RTN","XUSRB4",32,0)
 S %H=$H,J=NS_($J#2048)_"-"_(%H#7*86400+$P(%H,",",2))_"_",A=$R(10)
"RTN","XUSRB4",33,0)
 F  S HL=J_A,A=A+1 L +^XTMP(HL):1 I $T Q:'$D(^XTMP(HL))  L -^XTMP(HL)
"RTN","XUSRB4",34,0)
 S ^XTMP(HL,0)=$$HTFM^XLFDT(%H+LT)_"^"_$$DT^XLFDT()
"RTN","XUSRB4",35,0)
 L -^XTMP(HL)
"RTN","XUSRB4",36,0)
 Q HL
"RTN","XUSRB4",37,0)
 ;
"RTN","XUSRB4",38,0)
TOK(H) ;Store a Token
"RTN","XUSRB4",39,0)
 ;H is handle into XTMP
"RTN","XUSRB4",40,0)
 N J,T,R,%
"RTN","XUSRB4",41,0)
 S T=$$H3^%ZTM($H)
"RTN","XUSRB4",42,0)
 S R=$J_"|"_T_"|"_$G(DUZ)_"|"_H
"RTN","XUSRB4",43,0)
 S ^XTMP(H,"D",0)="|"_$$ENCRYP^XUSRB1(R)_"|"
"RTN","XUSRB4",44,0)
 S ^XTMP(H,"D2")=$G(DUZ(2))
"RTN","XUSRB4",45,0)
 S %=$G(IO("IP")) I $L(%),%'?1.3N1P1.3N1P1.3N1P1.3N S %=$P($$ADDRESS^XLFNSLK(%),",")
"RTN","XUSRB4",46,0)
 S ^XTMP(H,"D3")=%
"RTN","XUSRB4",47,0)
 S ^XTMP(H,"CLNM")=$G(IO("CLNM"))
"RTN","XUSRB4",48,0)
 S ^XTMP(H,"JOB",$J)=$G(IO("IP"))
"RTN","XUSRB4",49,0)
 S ^XTMP(H,"STATUS")="0^New",^("CNT")=0
"RTN","XUSRB4",50,0)
 Q
"RTN","XUSRB4",51,0)
 ;
"RTN","XUSRB4",52,0)
CHKASH(HL) ;rpc. Check a Auto Signon Handle
"RTN","XUSRB4",53,0)
 N HDL,RET,FDA,IEN S HDL=$E(HL,3,999)
"RTN","XUSRB4",54,0)
 S RET=$$CHECK(HDL)
"RTN","XUSRB4",55,0)
 I RET>0 D
"RTN","XUSRB4",56,0)
 . S DUZ("ASH")=1,IEN=DUZ_","
"RTN","XUSRB4",57,0)
 . I $$GET1^DIQ(200,IEN,7,"I") S FDA(200,DUZ_",",7)=0 D FILE^DIE("K","FDA") ;rwf 403
"RTN","XUSRB4",58,0)
 K ^XTMP(HDL) ;Token only good for one try.
"RTN","XUSRB4",59,0)
 Q RET
"RTN","XUSRB4",60,0)
 ;
"RTN","XUSRB4",61,0)
CHKCCOW(HL) ;rpc. Check a CCOW Auto Signon Handle
"RTN","XUSRB4",62,0)
 N HDL,RET,T
"RTN","XUSRB4",63,0)
 S HDL=$$UP^XLFSTR($E(HL,3,999)),T=$P($G(^XTV(8989.3,1,30),5400),U)
"RTN","XUSRB4",64,0)
 S RET=$$CHECK(HDL,T)
"RTN","XUSRB4",65,0)
 I RET>0 D
"RTN","XUSRB4",66,0)
 . ;This CCOW Token good for more that one try.
"RTN","XUSRB4",67,0)
 . S ^XTMP(HDL,"JOB",$J)=$G(IO("IP"))
"RTN","XUSRB4",68,0)
 . S ^XTMP(HDL,"STATUS")=(^XTMP(HDL,"STATUS")+1)_"^Active"
"RTN","XUSRB4",69,0)
 . S ^XUTL("XQ",$J,"HDL")=HDL ;Save handle with job
"RTN","XUSRB4",70,0)
 . S DUZ("CCOW")=1 ;Flag a CCOW sign-on.
"RTN","XUSRB4",71,0)
 Q RET
"RTN","XUSRB4",72,0)
 ;
"RTN","XUSRB4",73,0)
CHECK(HL,TOUT) ;Check a Token
"RTN","XUSRB4",74,0)
 N %,J,D,L,M,S,T,CLNM
"RTN","XUSRB4",75,0)
 S S=$G(^XTMP(HL,0)) I '$L(S) Q "0^Bad Handle"
"RTN","XUSRB4",76,0)
 S S=$G(^XTMP(HL,"D",0)) I '$L(S) Q "0^Bad Handle" ;Now have real token
"RTN","XUSRB4",77,0)
 I $E(S)'="|" Q "0^Bad Token"
"RTN","XUSRB4",78,0)
 S S=$$DECRYP^XUSRB1($E(S,2,$L(S)-1)) I S="" Q "0^Bad Token"
"RTN","XUSRB4",79,0)
 S J=$P(S,"|"),T=$P(S,"|",2),D=$P(S,"|",3),M=$P(S,"|",4)
"RTN","XUSRB4",80,0)
 ;Check token time
"RTN","XUSRB4",81,0)
 S %=$$H3^%ZTM($H),TOUT=$G(TOUT,20)
"RTN","XUSRB4",82,0)
 I T+TOUT<% Q "0^Token Expired" ;Token good for TOUT or 20 seconds
"RTN","XUSRB4",83,0)
 ;Check job
"RTN","XUSRB4",84,0)
 ;Check that token has handle
"RTN","XUSRB4",85,0)
 I M'=HL Q "0^Bad Token"
"RTN","XUSRB4",86,0)
 ;Check User
"RTN","XUSRB4",87,0)
 I $G(^VA(200,D,0))="" Q "0^Bad User"
"RTN","XUSRB4",88,0)
 ;Do IP check
"RTN","XUSRB4",89,0)
 S %=$G(IO("IP")),T=0,CLNM=""
"RTN","XUSRB4",90,0)
 I $L(%),%'?1.3N1P1.3N1P1.3N1P1.3N S CLNM=%,%=$P($$ADDRESS^XLFNSLK(%),",")
"RTN","XUSRB4",91,0)
 S CLNM=$S($L($G(IO("CLNM"))):IO("CLNM"),$L(CLNM):CLNM,1:"") ;p499
"RTN","XUSRB4",92,0)
 I $L($G(^XTMP(HL,"D3"))),^XTMP(HL,"D3")=% S T=1
"RTN","XUSRB4",93,0)
 I 'T,$L(CLNM),$G(^XTMP(HL,"CLNM"))=IO("CLNM") S T=1
"RTN","XUSRB4",94,0)
 I 'T Q "0^Different IP" ;p499
"RTN","XUSRB4",95,0)
 I $D(^XTMP(HL,"D2")),D>0 S DUZ(2)=^XTMP(HL,"D2")
"RTN","XUSRB4",96,0)
 D USER^XUS(D)
"RTN","XUSRB4",97,0)
 Q D
"RTN","XUSRB4",98,0)
 ;
"RTN","XUSRB4",99,0)
 ;
"RTN","XUSRB4",100,0)
CCOWPC(RET) ;Return ap
"RTN","XUSRB4",101,0)
 N I,XU4
"RTN","XUSRB4",102,0)
 S RET(0)="" I '$$BROKER^XWBLIB Q
"RTN","XUSRB4",103,0)
 D GETLST^XPAR(.XU4,"SYS","XUS CCOW VAULT PARAM","Q")
"RTN","XUSRB4",104,0)
 F I=0,1 S RET(I)=$P($G(XU4(I+1)),"^",2,99)
"RTN","XUSRB4",105,0)
 Q
"RTN","XUSRB4",106,0)
 ;
"RTN","XUSRB4",107,0)
 ;p500
"RTN","XUSRB4",108,0)
CCOWIP(RET,CLIENTIP) ;rpc. CCOW Auto Signon Handle for middle tiered application servers
"RTN","XUSRB4",109,0)
 N %
"RTN","XUSRB4",110,0)
 S %=$G(IO("IP")) ; save original
"RTN","XUSRB4",111,0)
 ; get actual ip address instead of localhost address if possible
"RTN","XUSRB4",112,0)
 S IO("IP")=$S($G(CLIENTIP)="127.0.0.1":%,$G(CLIENTIP)="":%,1:$G(CLIENTIP))
"RTN","XUSRB4",113,0)
 D CCOW(.RET)
"RTN","XUSRB4",114,0)
 S IO("IP")=% ; revert to original
"RTN","XUSRB4",115,0)
 Q
"RTN","XUSRB4",116,0)
 ;
"RTN","ZIS")
0^4^B20827574^B20530056
"RTN","ZIS",1,0)
%ZIS ;SFISC/AC,RWF -- DEVICE HANDLER ;07/17/08  11:50
"RTN","ZIS",2,0)
 ;;8.0;KERNEL;**18,23,69,112,199,191,275,363,440,499**;JUL 10, 1995;Build 14
"RTN","ZIS",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified
"RTN","ZIS",4,0)
 N %ZISOS,%ZISV
"RTN","ZIS",5,0)
 S U="^",%ZISOS=$G(^%ZOSF("OS")),%ZISV=$G(^%ZOSF("VOL"))
"RTN","ZIS",6,0)
 ;Check SPOOLER special case first
"RTN","ZIS",7,0)
INIT I $D(ZTQUEUED),$G(IOT)="SPL",$D(IO)#2,$D(IO(0))#2,IO]"",IO=IO(0),$D(IO(1,IO))#2,%ZISOS["VAX DSM"!(%ZISOS["M/VX"),$G(IOP)[ION!(IOP[IO) K %ZIS,%IS,IOP Q
"RTN","ZIS",8,0)
 ;
"RTN","ZIS",9,0)
 I '$D(%ZIS),$D(%IS) M %ZIS=%IS
"RTN","ZIS",10,0)
 S:'($D(%ZIS)#2) %ZIS="M" M %IS=%ZIS ;update %IS for now
"RTN","ZIS",11,0)
 I '$D(^XUTL("XQ",$J,"MIXED OS")) S ^XUTL("XQ",$J,"MIXED OS")=$$PRI^%ZOSV
"RTN","ZIS",12,0)
 S %ZIS("PRI")=$G(^XUTL("XQ",$J,"MIXED OS"),1)
"RTN","ZIS",13,0)
 ;
"RTN","ZIS",14,0)
 I $D(ZTQUEUED) D  I '$D(IOP) S POP=1 G EXIT^%ZIS1
"RTN","ZIS",15,0)
 .I $D(ZTIO)#2,ZTIO="" S:%IS'[0 %IS=%IS_"0",%ZIS=%ZIS_"0"
"RTN","ZIS",16,0)
 I '$D(ZTQUEUED),%IS["T",$P($G(IOP),";")="Q" S POP=1 G EXIT^%ZIS1
"RTN","ZIS",17,0)
 N %,%A,%E,%H,%I,%X,%XX,%Y,%Z,%Z1,%Z2,%Z9,%Z90,%Z91,%Z95,%ZISB,%ZTIME,%ZTYPE
"RTN","ZIS",18,0)
 N %ZHFN,%ZISOLD,%ZTOUT,%ZISDTIM,DTOUT,DUOUT
"RTN","ZIS",19,0)
 S %ZISDTIM=$G(DTIME,300)
"RTN","ZIS",20,0)
 ;Save symbols to restore if don't open a device
"RTN","ZIS",21,0)
 D SYMBOL^%ZISUTL(0,$NA(%ZISOLD))
"RTN","ZIS",22,0)
A D CLEAN ;(p363) K IO("CLOSE"),IO("HFSIO")
"RTN","ZIS",23,0)
 K IO("P"),IO("Q"),IO("S"),IO("T")
"RTN","ZIS",24,0)
K2 D K2^%ZIS1
"RTN","ZIS",25,0)
 S %ZISB=%ZIS'["N",(%E,%H,POP)=0,%Y="" S:'$D(IO(0)) IO(0)=$I
"RTN","ZIS",26,0)
 I %ZISOS["VAX DSM",$I["SYS$INPUT:.;" S:%ZIS'[0 %IS=%IS_"0",%ZIS=%ZIS_"0"
"RTN","ZIS",27,0)
 ;I %IS["T"&(%IS["0") S (%H,%E)=0 G ^%ZIS1
"RTN","ZIS",28,0)
 I $D(IOP),IOP=$I!(IOP="HOME")!(0[IOP),$D(^XUTL("XQ",$J,"IO")) D HOME K %IS,%Y,%ZIS,%ZISB,%ZISV,IOP Q
"RTN","ZIS",29,0)
 ;Don't worry about HOME if %ZIS[0
"RTN","ZIS",30,0)
 D:%ZIS'[0 GETHOME G EXIT^%ZIS1:POP,^%ZIS1 ;Jump to next part
"RTN","ZIS",31,0)
 ;
"RTN","ZIS",32,0)
GETHOME I $D(IO("HOME")),$P(IO("HOME"),"^",2)=IO(0) S (%E,%H)=+IO("HOME") Q
"RTN","ZIS",33,0)
 I $D(^XUTL("XQ",$J,"IOS")),$D(^("IO")),IO(0)=^("IO") S (%E,%H)=^("IOS") Q
"RTN","ZIS",34,0)
 ;CALL LINEPORT CODE HERE---
"RTN","ZIS",35,0)
 S %=$$LINEPORT^%ZISUTL I % S (%E,%H)=% Q
"RTN","ZIS",36,0)
 S %ZISVT=$I D VTLKUP I '%E S %ZISVT=$I D VIRTUAL
"RTN","ZIS",37,0)
 I %ZISVT=""!(%E'>0) I %IS'[0 O IO(0)::0 I $T U IO(0) W !,"HOME DEVICE ("_$I_") DOES NOT EXIST IN THE DEVICE FILE",!,"PLEASE CONTACT YOUR SYSTEM MANAGER!",*7
"RTN","ZIS",38,0)
 S %H=%E S:'%H&(%IS'[0) POP=1 S:(%H>0)&('$D(IO("HOME"))) IO("HOME")=%H_"^"_$I
"RTN","ZIS",39,0)
 Q
"RTN","ZIS",40,0)
VIRTUAL ;See if a Virtual Terminal (LAT, TELNET)
"RTN","ZIS",41,0)
 ;Change the MSM check for telnet to work with v4.4
"RTN","ZIS",42,0)
 I %ZISOS["MSM" X "I $P($ZV,""Version "",2)'<3 S %ZISVT=$ZDE(+%ZISVT) I %ZISVT?.E1""~""4.5N.E S %ZISVT=""TELNET"""
"RTN","ZIS",43,0)
 F %ZISI=$L(%ZISVT):-1:0 D:$D(^%ZIS(1,"C",%ZISVT))  Q:$S('%E:0,'$D(^%ZIS(1,%E,"TYPE")):0,^("TYPE")="VTRM":1,1:0)  S %ZISVT=$E(%ZISVT,1,%ZISI)
"RTN","ZIS",44,0)
 .D VTLKUP Q:$S('%E:0,'$D(^%ZIS(1,%E,"TYPE")):0,^("TYPE")="VTRM":1,1:0)
"RTN","ZIS",45,0)
 .S %X=0 F %ZISX=%ZISV,"" Q:%X>0  S %X=0 F  S %E=+$O(^%ZIS(1,"CPU",%ZISX_"."_%ZISVT,%X)) S %X=%E Q:%E'>0  I $G(^%ZIS(1,+%E,"TYPE"))="VTRM" Q
"RTN","ZIS",46,0)
 Q
"RTN","ZIS",47,0)
VTLKUP F %ZISX=%ZISV,"" S %E=+$O(^%ZIS(1,"G","SYS."_%ZISX_"."_%ZISVT,0)) Q:%E  S %E=+$O(^%ZIS(1,"CPU",%ZISX_"."_%ZISVT,0)) Q:%E
"RTN","ZIS",48,0)
 Q
"RTN","ZIS",49,0)
 ;
"RTN","ZIS",50,0)
CURRENT N POP,%ZIS,%IS,%E,%H
"RTN","ZIS",51,0)
 S FF="#",SL=24,BS="*8",RM=80,(SUB,XY)="",%IS=0,%ZISOS=$G(^%ZOSF("OS")),%ZISV=$G(^("VOL")),POP=0
"RTN","ZIS",52,0)
 D GETHOME K %E,%IS,%ZISI,%ZISOS,%ZISV,%ZISVT,%ZISX Q:POP
"RTN","ZIS",53,0)
 I $D(^%ZIS(1,%H,"SUBTYPE")) S SUB=+^("SUBTYPE") K %H
"RTN","ZIS",54,0)
 I $D(SUB),SUB,$D(^%ZIS(2,SUB,1)) S SUB=$S($D(^(0)):$P(^(0),"^"),1:""),FF=$P(^(1),"^",2),SL=$P(^(1),"^",3),BS=$P(^(1),"^",4),XY=$P(^(1),"^",5),RM=+^(1)
"RTN","ZIS",55,0)
 E  S SUB=""
"RTN","ZIS",56,0)
 I $D(^%ZOSF("RM")) N X S X=RM X ^("RM") K %A
"RTN","ZIS",57,0)
 Q
"RTN","ZIS",58,0)
HOME ;Entry point to establish IO* variables for home device.
"RTN","ZIS",59,0)
 D CLEAN ;(p363)
"RTN","ZIS",60,0)
 N X I '$D(^XUTL("XQ",$J,"IO")) S IOP="HOME" D ^%ZIS Q
"RTN","ZIS",61,0)
 D RESETVAR
"RTN","ZIS",62,0)
 I '$D(IO("C")),$G(IOM),IO=$I,$D(IO(1,IO)),$D(^%ZOSF("RM")) S X=+IOM X ^("RM")
"RTN","ZIS",63,0)
 Q
"RTN","ZIS",64,0)
 ;IO("Q") is checked by many routines after a call to ^%ZISC, so only clean on call to %ZIS.
"RTN","ZIS",65,0)
CLEAN ;Cleanup env. Called from %ZISC also.
"RTN","ZIS",66,0)
 I $G(IOT)'="SPL" K IO("DOC"),IO("SPOOL") ;(p440)
"RTN","ZIS",67,0)
 I $G(IOT)'="HFS" K IO("HFSIO") ;p440
"RTN","ZIS",68,0)
 S (IOPAR,IOUPAR)=""
"RTN","ZIS",69,0)
 Q
"RTN","ZIS",70,0)
 ;
"RTN","ZIS",71,0)
RESETVAR ;Reset home IO* variables.
"RTN","ZIS",72,0)
 I '$D(^XUTL("XQ",$J,"IO")) Q
"RTN","ZIS",73,0)
 N %
"RTN","ZIS",74,0)
 F %="IO","IOBS","IOF","IOM","ION","IOS","IOSL","IOST","IOST(0)","IOT","IOXY","IOPAR","IOUPAR" I $D(^XUTL("XQ",$J,%))#2 S @%=^(%)
"RTN","ZIS",75,0)
 F %="IO(""IP"")","IO(""CLNM"")","IO(""DOC"")","IO(""HFSIO"")","IO(""SPOOL"")" I $D(^XUTL("XQ",$J,%))#2 S @%=^(%)
"RTN","ZIS",76,0)
 S POP=0,IO(0)=IO
"RTN","ZIS",77,0)
 Q
"RTN","ZIS",78,0)
SAVEVAR ;Save home IO* variables, called from XUS1,%ZTMS3
"RTN","ZIS",79,0)
 N %
"RTN","ZIS",80,0)
 F %="IO","IOBS","IOF","IOM","ION","IOS","IOSL","IOST","IOST(0)","IOT","IOXY","IOPAR","IOUPAR" I $D(@%) S ^XUTL("XQ",$J,%)=@%
"RTN","ZIS",81,0)
 F %="IO(""IP"")","IO(""CLNM"")","IO(""DOC"")","IO(""HFSIO"")","IO(""SPOOL"")" I $D(@%) S ^XUTL("XQ",$J,%)=@%
"RTN","ZIS",82,0)
 Q
"RTN","ZIS",83,0)
ZISLPC Q  ;No longer called in Kernel v8.
"RTN","ZIS",84,0)
 ;
"RTN","ZIS",85,0)
HLP1 G EN1^%ZIS7
"RTN","ZIS",86,0)
HLP2 N %E,%H,%X,%ZISV,X S %ZISV=$S($D(^%ZOSF("VOL")):^("VOL"),1:"") G EN2^%ZIS7
"RTN","ZIS",87,0)
 ;
"RTN","ZIS",88,0)
REWIND(IO2,IOT,IOPAR) ;Rewind Device
"RTN","ZIS",89,0)
 N %,X,Y,$ES,$ET S $ET="D REWERR^%ZIS Q 0"
"RTN","ZIS",90,0)
 S %=$I
"RTN","ZIS",91,0)
 I '($D(IO2)#2)!'$D(IOT)!'$D(IOPAR) Q 0
"RTN","ZIS",92,0)
 I "MT^SDP^HFS"'[IOT Q 0
"RTN","ZIS",93,0)
 S @("Y=$$REW"_IOT_"^%ZIS4(IO2,IOPAR)")
"RTN","ZIS",94,0)
 U %
"RTN","ZIS",95,0)
 Q Y
"RTN","ZIS",96,0)
REWERR ;Error encountered
"RTN","ZIS",97,0)
 S IO("ERROR")=$EC
"RTN","ZIS",98,0)
 S $EC="",$ET="Q:$ES>1  S $EC="""" Q 0" S $EC=",U1,"
"RTN","ZIS",99,0)
 Q 0
"RTN","ZIS",100,0)
 ;
"RTN","ZIS1")
0^5^B26102976^B24679317
"RTN","ZIS1",1,0)
%ZIS1 ;SFISC/AC,RWF -- DEVICE HANDLER (DEVICE INPUT) ;07/17/08  13:21
"RTN","ZIS1",2,0)
 ;;8.0;KERNEL;**18,49,69,104,112,199,391,440,499**;JUL 10, 1995;Build 14
"RTN","ZIS1",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified
"RTN","ZIS1",4,0)
MAIN ;Called from %ZIS with a GOTO
"RTN","ZIS1",5,0)
 ;Check for "ASK DEVICE"
"RTN","ZIS1",6,0)
 I '$D(IOP),$D(^%ZIS(1,%E,0)),'$P(^(0),"^",3) S %A=%H,%Z=^(0) D L2^%ZIS2 G EXIT
"RTN","ZIS1",7,0)
L1 ;Main Loop
"RTN","ZIS1",8,0)
 I '$D(IOP),$D(IO("Q")),POP D AQUE^%ZIS3 K:%=2 IO("Q") S:%=2 %ZISB=$S(%IS'["N":2,1:0) I %=-1 S POP=1 G EXIT
"RTN","ZIS1",9,0)
 S %E=%H,POP=0,%IS=%ZIS ;Reset %IS from %ZIS
"RTN","ZIS1",10,0)
 I %IS'["Q",$D(XQNOGO) S POP=1 W:'$D(IOP) !,$C(7),"OUTPUT IS NEVER ALLOWED FOR THIS OPTION" G EXIT
"RTN","ZIS1",11,0)
 D IOP:$D(IOP),R:'$D(IOP)
"RTN","ZIS1",12,0)
 G EXIT:$D(DTOUT)!$D(DUOUT)!(POP&$D(IOP)),L1:POP&'$D(IOP)
"RTN","ZIS1",13,0)
 D LKUP I %A'>0 S POP=1 D:'$D(DUOUT) MSG1 K DUOUT
"RTN","ZIS1",14,0)
 I %A>0,'$D(^%ZIS(1,%A,0)) D MSG1 K %ZISIOS S POP=1
"RTN","ZIS1",15,0)
 I POP G EXIT:$D(IOP),L1:'$D(IOP)
"RTN","ZIS1",16,0)
 S %E=%A,%Z1=^%ZIS(1,%A,1),%Z=$G(^(0)) ;Set naked for screen
"RTN","ZIS1",17,0)
 I $D(%ZIS("S")) N Y S Y=%E D XS^ZISX S:'$T POP=1 G G:POP ;Screen Code
"RTN","ZIS1",18,0)
 W:'$D(IOP)&($P(%Z,"^",2)'=$I)&($P(%Z1,"^")]"") "  ",$P(%Z1,"^")
"RTN","ZIS1",19,0)
 D L2^%ZIS2 ;Call
"RTN","ZIS1",20,0)
G G L1:POP&'$D(IOP)&'($D(DTOUT)!$D(DUOUT)) ;Didn't get it
"RTN","ZIS1",21,0)
 ;
"RTN","ZIS1",22,0)
EXIT ;
"RTN","ZIS1",23,0)
 I POP G EX2 ;Did not get the device.
"RTN","ZIS1",24,0)
 ;For type[TRM reset $X & $Y
"RTN","ZIS1",25,0)
 I %ZTYPE["TRM",IO]"",$D(IO(1,IO)) U IO S:'(IO=IO(0)&'$D(IO("S"))&'$D(ZTQUEUED)) $X=0,$Y=0
"RTN","ZIS1",26,0)
 ;Do count of number of times device opened.  Field 51.
"RTN","ZIS1",27,0)
 I $L($G(IO)),$D(IO(1,IO))#2,$G(%ZISIOS) D
"RTN","ZIS1",28,0)
 . S $P(^(5),"^",1)=$P($G(^%ZIS(1,%ZISIOS,5)),"^",1)+1
"RTN","ZIS1",29,0)
 I %ZIS["H" S IO(0)=IO,IO("HOME")=%ZISIOS_"^"_IO ;Make home device
"RTN","ZIS1",30,0)
 I '$D(IO("Q")),$D(%ZISLOCK) S ^XUTL("XQ",$J,"lock",%ZISIOS)=%ZISLOCK
"RTN","ZIS1",31,0)
 I $D(IO)#2,IO]"",$D(IO(1,IO))#2,$D(%Z1),$P(%Z1,"^",11) S IO(1,IO,"NOFF")=1
"RTN","ZIS1",32,0)
EX2 ;
"RTN","ZIS1",33,0)
 I %IS'[0,$G(IO(0))]"" U IO(0) ;Make sure return with home active
"RTN","ZIS1",34,0)
 G SETVAR:'POP!(%IS["T"),KILVAR
"RTN","ZIS1",35,0)
 ;
"RTN","ZIS1",36,0)
IOP ;Request with IOP set
"RTN","ZIS1",37,0)
 S (%ZISVT,%X)=IOP S:%X'?1.UNP %X=$$UP(%X) I %X'="Q" D SETQ Q
"RTN","ZIS1",38,0)
 S %IS=%IS_%X K IOP W %X D SETQ
"RTN","ZIS1",39,0)
 Q
"RTN","ZIS1",40,0)
 ;Get ready to ask user for device
"RTN","ZIS1",41,0)
R I %IS["Q",$D(XQNOGO) W !,$C(7),"AT THIS TIME, OUTPUT MUST BE QUEUED"
"RTN","ZIS1",42,0)
 S %A=$S($D(%IS("B")):%IS("B"),1:"HOME") ;Setup default
"RTN","ZIS1",43,0)
 I %IS["P",%A="HOME",$D(^%ZIS(1,%E,99)),$D(^%ZIS(1,+^(99),0)) S %A=$P(^(0),"^",1)
"RTN","ZIS1",44,0)
RD W !,$S($D(%IS("A")):%IS("A"),1:"DEVICE: ") W:%A]"" %A,"// " D SBR S:%X="" %X=%A S %ZISVT=%X
"RTN","ZIS1",45,0)
 I %X?2"?".E D EN2^%ZIS7 G R
"RTN","ZIS1",46,0)
 I %X?1"?".E D EN1^%ZIS7 G R
"RTN","ZIS1",47,0)
 I $D(DTOUT)!$D(DUOUT)!(%X'?.ANP)!($L($P(%X,";"))>31) S:%IS["T" IO="" S POP=1 Q
"RTN","ZIS1",48,0)
 S:%X'?1.UNP %X=$$UP(%X) D SETQ G R:$T
"RTN","ZIS1",49,0)
 Q
"RTN","ZIS1",50,0)
SETQ S %Y=$P(%X,";",2,9),%X=$P(%X,";",1) S:$L(";"_%Y,";/")=2 IO("P")=$P(";"_%Y,";/",2)
"RTN","ZIS1",51,0)
 I %IS["Q",%X="Q" S %X=%Y,%ZISVT=$P(%ZISVT,";",2,9),%ZISB=0,IO("Q")=1,%IS("A")="DEVICE: " S:$D(IOP) %Y=$P(%X,";",2,9),%X=$P(%X,";",1)
"RTN","ZIS1",52,0)
 I $T,'$D(IOP) W "UEUE TO PRINT ON" Q  ; Return $T value
"RTN","ZIS1",53,0)
 Q
"RTN","ZIS1",54,0)
LKUP ;Lookup device name
"RTN","ZIS1",55,0)
 S %ZISMY=$P(%ZISVT,";",2,999),%ZISVT=$P(%ZISVT,";")
"RTN","ZIS1",56,0)
 I %X="H" W:'$D(IOP) "ome" S %X=0
"RTN","ZIS1",57,0)
 I 0[%X!(%X="HOME")!(%X=$I) S %A=%H Q
"RTN","ZIS1",58,0)
 I $E(%ZISVT)="`",$D(IOP) S %A=+$E(%ZISVT,2,999) I $D(^%ZIS(1,%A,0))#2 Q
"RTN","ZIS1",59,0)
 S %A=0 I "P"[%X Q:$D(IOP)&('$D(^%ZIS(1,%E,99)))  I $D(^%ZIS(1,%E,99)) S %A=+^(99) Q
"RTN","ZIS1",60,0)
 I %X=" ",$D(DUZ)#2,$D(^DISV(+DUZ,"^%ZIS(1,")) S %A=^("^%ZIS(1,") Q
"RTN","ZIS1",61,0)
 S %A=+$O(^%ZIS(1,"B",%ZISVT,0)) Q:%A>0  ;mixed case lookup
"RTN","ZIS1",62,0)
 I %X'=%ZISVT S %A=+$O(^%ZIS(1,"B",%X,0)) Q:%A>0  ;uppercase lookup
"RTN","ZIS1",63,0)
 D VTLKUP^%ZIS S %A=%E Q:%A>0  ;mixed case lookup
"RTN","ZIS1",64,0)
 I %X'=%ZISVT S %ZISVT=%X D VTLKUP^%ZIS S %A=%E Q:%A>0  ;uppercase lookup
"RTN","ZIS1",65,0)
 N %XX,%YY S %XX=%X D 1^%ZIS5 S %A=+%YY
"RTN","ZIS1",66,0)
 Q
"RTN","ZIS1",67,0)
SBR ;Read Sub-routine
"RTN","ZIS1",68,0)
 K DTOUT,DUOUT R %X:%ZISDTIM E  W $C(7) S DTOUT=1 Q
"RTN","ZIS1",69,0)
 S:%X="."!(%X="^") DUOUT=1,%X=""
"RTN","ZIS1",70,0)
 Q
"RTN","ZIS1",71,0)
 ;LC S %X=$$UP(%X) Q
"RTN","ZIS1",72,0)
 ;
"RTN","ZIS1",73,0)
LOW(%) Q $TR(%,"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz")
"RTN","ZIS1",74,0)
UP(%) Q $TR(%,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","ZIS1",75,0)
 ;
"RTN","ZIS1",76,0)
 ;Call/Return % = 1 (yes), 2 (no) -1 (^)
"RTN","ZIS1",77,0)
YN W "? ",$P("Yes// ^No// ",U,%)
"RTN","ZIS1",78,0)
RYN R %X:%ZISDTIM E  S DTOUT=1,%X=U W $C(7)
"RTN","ZIS1",79,0)
 S:%X]""!'% %=$A(%X),%=$S(%=89:1,%=121:1,%=78:2,%=110:2,%=94:-1,1:0)
"RTN","ZIS1",80,0)
 I '%,%X'?."?" W $C(7),"??",!?4,"ANSWER 'Yes' OR 'No': " G RYN
"RTN","ZIS1",81,0)
 W:$X>73 ! W $P("  (Yes)^  (No)",U,%)
"RTN","ZIS1",82,0)
 Q
"RTN","ZIS1",83,0)
MSG1 I '$D(IOP) W ?20,$C(7),"  [DEVICE DOES NOT EXIST]"
"RTN","ZIS1",84,0)
 Q
"RTN","ZIS1",85,0)
SETVAR ;Come here to setup the variables for the selected device
"RTN","ZIS1",86,0)
 S:$D(IO)[0 IO="" G KILVAR:%IS["T"&(IO="")
"RTN","ZIS1",87,0)
 I $G(%Z)="" S ION="Unknown device",POP=1 G KILVAR
"RTN","ZIS1",88,0)
 S:IO'=IO(0)&($D(DUZ)#2) ^DISV(+DUZ,"^%ZIS(1,")=%E
"RTN","ZIS1",89,0)
 S ION=$P(%Z,"^",1),IOM=+%Z91,IOF=$P(%Z91,"^",2),IOSL=$P(%Z91,"^",3),IOBS=$P(%Z91,"^",4),IOXY=$P(%Z91,"^",5)
"RTN","ZIS1",90,0)
 I IOSL>65530 S IOSL=65530 ;Cache rolls $Y at 65535
"RTN","ZIS1",91,0)
 S IOT=%ZTYPE,IOST(0)=%ZISIOST(0),IOST=%ZISIOST,IOPAR=%ZISOPAR,IOUPAR=%ZISUPAR,IOHG=%ZISHG
"RTN","ZIS1",92,0)
 S:IOF="" IOF="#" ;See that IOF has something
"RTN","ZIS1",93,0)
 I $D(IO("Q")),'$D(%ZIS("afn")) K IO("HFSIO") ;Let TM build it at run time.
"RTN","ZIS1",94,0)
 K IOCPU S:$D(%ZISCPU) IOCPU=%ZISCPU
"RTN","ZIS1",95,0)
 G KIL
"RTN","ZIS1",96,0)
 ;
"RTN","ZIS1",97,0)
KILVAR ;Come here to restore the calling variables
"RTN","ZIS1",98,0)
 D SYMBOL^%ZISUTL(1,"%ZISOLD")
"RTN","ZIS1",99,0)
 S:'$L($G(IOF)) IOF="#" S:'$D(IOST(0)) IOST(0)=0
"RTN","ZIS1",100,0)
 ;See that all standard variables are defined
"RTN","ZIS1",101,0)
 F %I="IO","ION","IOM","IOBS","IOSL","IOST" S:$D(@%I)[0 @%I=""
"RTN","ZIS1",102,0)
 K IO("HFSIO"),IO("OPEN") I $D(%ZISCPU) S:'$D(IOCPU) IOCPU=%ZISCPU
"RTN","ZIS1",103,0)
KIL ;Final exit cleanup
"RTN","ZIS1",104,0)
 S:'POP IOS=%ZISIOS I POP K:%IS'["T" %ZISIOS I %IS["T" K IOS S:$D(%ZISIOS) IOS=%ZISIOS
"RTN","ZIS1",105,0)
 S:%IS["T" IO("T")=1 K %ZIS,%IS,%A,%E,%H,%ZISOS,%ZISV,IOP
"RTN","ZIS1",106,0)
K2 K %I,%X,%Y,%Z,%Z1,%Z91,%Z95,%ZTYPE,%ZTIME
"RTN","ZIS1",107,0)
 K %ZISCHK,%ZISCPU,%ZISI,%ZISR,%ZISVT,%ZISB,%ZISX,ZISI,%ZISHGL,%ZISHP,%ZISIO,%ZISIOS,%ZISIOM
"RTN","ZIS1",108,0)
 K %ZISIOF,%ZISIOSL,%ZISIOBS,%ZISIOST,%ZISIOST(0),%ZISTO,%ZISTP,%ZISHG,%ZISSIO,%ZISOPEN,%ZISOPAR,%ZISUPAR
"RTN","ZIS1",109,0)
 K %ZISMY,%ZISQUIT,%ZISLOCK
"RTN","ZIS1",110,0)
 Q
"RTN","ZIS3")
0^7^B14236085^B13908684
"RTN","ZIS3",1,0)
%ZIS3 ;SFISC/AC,RWF -- DEVICE HANDLER(DEVICE TYPES & PARAMETERS) ;07/17/08  14:56
"RTN","ZIS3",2,0)
 ;;8.0;KERNEL;**18,36,69,104,391,440,499**;JUL 10, 1995;Build 14
"RTN","ZIS3",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified
"RTN","ZIS3",4,0)
 ;Call with a Go from ^%ZIS2
"RTN","ZIS3",5,0)
 I %ZIS'["T",$G(^%ZIS(1,+%E,"POX"))]"" D XPOX^ZISX(%E) ;Pre-Open
"RTN","ZIS3",6,0)
 I $D(%ZISQUIT) S POP=1 K %ZISQUIT
"RTN","ZIS3",7,0)
 S %ZISCHK=1
"RTN","ZIS3",8,0)
 ;I 'POP&(%ZISB)&(%ZTYPE'="RES")&(%ZTYPE'="OTH")&(%ZTYPE'="SDP")&(IO'["::") D DEVOK
"RTN","ZIS3",9,0)
 ;See if need to lock.
"RTN","ZIS3",10,0)
 K %ZISLOCK
"RTN","ZIS3",11,0)
 I %ZIS'["T",+$G(^%ZIS(1,+%E,"GBL")) S %ZISLOCK=$NA(^%ZIS("lock",IO))
"RTN","ZIS3",12,0)
 ;
"RTN","ZIS3",13,0)
 I 'POP G TRM:(%ZTYPE["TRM"),@(%ZTYPE_"^%ZIS6") ;Jump to next part
"RTN","ZIS3",14,0)
 ;
"RTN","ZIS3",15,0)
Q ;%ZIS6 Returns here
"RTN","ZIS3",16,0)
 ;See if need to un-lock.
"RTN","ZIS3",17,0)
 I $D(%ZISUOUT) K %ZISUOUT,%ZISHP,%ZISHPOP Q
"RTN","ZIS3",18,0)
 I $D(%ZISHPOP)&$S(IO="":1,1:'$D(IO(1,IO))) D HGBSY^%ZIS2 Q
"RTN","ZIS3",19,0)
 I POP S:%ZIS'["T" IO="" I $D(%ZISHG(0)),%ZIS'["D",'$D(%ZISHPOP) G HUNT^%ZIS2
"RTN","ZIS3",20,0)
 Q  ;Return to %ZIS1
"RTN","ZIS3",21,0)
 ;
"RTN","ZIS3",22,0)
VTRM ;Virtual terminal type
"RTN","ZIS3",23,0)
TRM ;D OPEN^%ZIS4:'POP&(%ZISB&(%ZIS'["T")),MARGN:'POP,SETPAR:'POP ;Terminal type
"RTN","ZIS3",24,0)
 D MARGN:'POP,SETPAR:'POP ;Terminal type// TEST CHANGE
"RTN","ZIS3",25,0)
 I 'POP,%ZIS'["T",%ZISB=1,'$D(IOP),IO'=IO(0),'$D(IO("Q")),%ZIS["Q" D AQUE
"RTN","ZIS3",26,0)
 D W("")
"RTN","ZIS3",27,0)
 I '$D(IO("Q")),'POP,%ZISB,%ZIS'["T" D O^%ZIS4
"RTN","ZIS3",28,0)
 G Q
"RTN","ZIS3",29,0)
DEVOK N X,Y,X1 ;Not sure this is needed
"RTN","ZIS3",30,0)
 S X=IO,X1=%ZTYPE
"RTN","ZIS3",31,0)
 D DEVOK^%ZOSV I Y=-99!(Y=0)!(Y=$J) Q
"RTN","ZIS3",32,0)
 I Y>0 S POP=1 D:('$D(%ZISHG(0))!(%IS["D")) W($C(7)_"[Device Unavailable]") Q
"RTN","ZIS3",33,0)
 I Y=-1 S IO="",POP=1 D:('$D(ZISHG(0))!(%IS["D")) W($C(7)_"[Device does not Exist or Unavailable]") Q
"RTN","ZIS3",34,0)
 Q
"RTN","ZIS3",35,0)
 ;
"RTN","ZIS3",36,0)
MARGN ;Get the margin and page length
"RTN","ZIS3",37,0)
 S %A=$P(%Y,";",1)
"RTN","ZIS3",38,0)
 I %A?1A.ANP D SUBIEN(.%A,1) I $D(^%ZIS(2,%A,1)) K %Z91 D ST(1) S %Y=$P(%Y,";",2,9),%ZISMY=$P(%ZISMY,";",2,9) G MARGN
"RTN","ZIS3",39,0)
 I %A>3 S $P(%Z91,"^")=$S(%A>255:255,1:+%A)
"RTN","ZIS3",40,0)
 I $P(%Y,";",2) S $P(%Z91,"^",3)=+$S($P(%Y,";",2)>65534:65534,1:$P(%Y,";",2)) ;Cache fix for $Y#65535 wrap
"RTN","ZIS3",41,0)
 ;
"RTN","ZIS3",42,0)
ALTP I '$D(IO("P")) Q:%A>3  G ASKMAR:%ZTYPE["TRM" Q
"RTN","ZIS3",43,0)
 S %X=$F(IO("P"),"M") I %X S %A=+$E(IO("P"),%X,99),$P(%Z91,"^")=$S(%A>255:255,1:%A)
"RTN","ZIS3",44,0)
 S %X=$F(IO("P"),"L") I %X S $P(%Z91,"^",3)=+$E(IO("P"),%X,99)
"RTN","ZIS3",45,0)
 Q:%A>3!(%ZTYPE'["TRM")
"RTN","ZIS3",46,0)
ASKMAR I %IS["M",'$D(IOP),$S(%E=%H:+$P(%Z,"^",3),1:1),$P(%Z,"^",4) W "    Right Margin: " W:$P(%Z91,"^")]"" +%Z91,"// "
"RTN","ZIS3",47,0)
 E  Q
"RTN","ZIS3",48,0)
 D SBR^%ZIS1 I '$D(DTOUT)&'$D(DUOUT) S:%X=""&($P(%Z91,"^")]"") %X=+%Z91 G ASKMAR:%X'?1.N S $P(%Z91,"^")=$S(%X>255:255,1:%X) Q
"RTN","ZIS3",49,0)
 S POP=1 I %ZISB&(%ZTYPE["TRM") D C Q
"RTN","ZIS3",50,0)
 Q
"RTN","ZIS3",51,0)
 ;
"RTN","ZIS3",52,0)
W(%) ;Write text
"RTN","ZIS3",53,0)
 Q:$D(IOP)
"RTN","ZIS3",54,0)
 W !,%
"RTN","ZIS3",55,0)
 Q
"RTN","ZIS3",56,0)
 ;
"RTN","ZIS3",57,0)
C ;Close open device
"RTN","ZIS3",58,0)
 I IO'=$G(IO(0)),$D(IO(1,IO)) C IO K IO(1,IO)
"RTN","ZIS3",59,0)
 Q
"RTN","ZIS3",60,0)
 ;
"RTN","ZIS3",61,0)
SETPAR S:$L(%ZISOPAR)&($E(%ZISOPAR)'="(") %ZISOPAR="("_%ZISOPAR_")"
"RTN","ZIS3",62,0)
 Q
"RTN","ZIS3",63,0)
AQUE ;Ask about Queueing
"RTN","ZIS3",64,0)
 W ! S %=$S($D(IO("Q")):1,1:2)
"RTN","ZIS3",65,0)
 I $D(IO("Q")) W !,"Previously, you have selected queueing."
"RTN","ZIS3",66,0)
 W !,"Do you "_$S($D(IO("Q")):"STILL ",1:"")_"want your output QUEUED"
"RTN","ZIS3",67,0)
 D YN^%ZIS1 G AQUE:%=0 Q:$D(IO("Q"))
"RTN","ZIS3",68,0)
 I %=-1 S POP=1,%ZISHPOP=1,%ZISUOUT=1 D C Q
"RTN","ZIS3",69,0)
 I %=1 S IO("Q")=1 D C Q
"RTN","ZIS3",70,0)
 ;I %=2 K IO("Q")
"RTN","ZIS3",71,0)
 Q
"RTN","ZIS3",72,0)
ST(%ZISTP) ;
"RTN","ZIS3",73,0)
 S %ZISIOST(0)=%A,%ZISIOST=$P($G(^%ZIS(2,%A,0)),"^")
"RTN","ZIS3",74,0)
 S:'$D(%Z91) %Z91=$P($G(^%ZIS(2,%A,1),"132^#^60^$C(8)"),"^",1,4),$P(%Z91,"^",5)=$G(^("XY"))
"RTN","ZIS3",75,0)
 Q:%ZISTP
"RTN","ZIS3",76,0)
STP N %B ;%E is a pointer to the Device file
"RTN","ZIS3",77,0)
 S %B=$G(^%ZIS(1,%E,91))
"RTN","ZIS3",78,0)
 S:$P(%B,"^")]"" $P(%Z91,"^")=+%B S:$P(%B,"^",3)]"" $P(%Z91,"^",3)=$P(%B,"^",3) ;S $P(%Z91,"^",5)=$G(^%ZIS(2,%ZISIOST(0),"XY"))
"RTN","ZIS3",79,0)
 Q
"RTN","ZIS3",80,0)
SUBIEN(%1,%) ;Return Subtype ien. %1 is call by Ref.
"RTN","ZIS3",81,0)
 N %XX,%YY
"RTN","ZIS3",82,0)
 I $D(^%ZIS(2,"B",%1))>9 S %1=+$O(^%ZIS(2,"B",%1,0)) Q
"RTN","ZIS3",83,0)
 I '$G(%) S X="" Q
"RTN","ZIS3",84,0)
 S %XX=%1 D 2^%ZIS5 S %1=+%YY
"RTN","ZIS3",85,0)
 Q
"RTN","ZIS3",86,0)
SUBTYPE(%A) ;Called from %ZISH
"RTN","ZIS3",87,0)
 N %ZISIOST,%Z91
"RTN","ZIS3",88,0)
 S:$G(%A)="" %A="P-OTHER"
"RTN","ZIS3",89,0)
 D SUBIEN(.%A),ST(1)
"RTN","ZIS3",90,0)
 S IOM=$P(%Z91,U,1),IOF=$P(%Z91,U,2),IOSL=$P(%Z91,U,3),IOST=%ZISIOST,IOST(0)=%ZISIOST(0),IOBS="$C(8)"
"RTN","ZIS3",91,0)
 S:IOST="" IOST="P-OTHER",IOST(0)=0
"RTN","ZIS3",92,0)
 Q
"RTN","ZIS4GTM")
0^2^B20384143^B19862476
"RTN","ZIS4GTM",1,0)
%ZIS4 ;ISF/RWF,DW - DEVICE HANDLER SPECIFIC CODE (GT.M for Unix/VMS) ;05/29/2008
"RTN","ZIS4GTM",2,0)
 ;;8.0;KERNEL;**275,425,440,499**;Jul 10, 1995;Build 14
"RTN","ZIS4GTM",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified
"RTN","ZIS4GTM",4,0)
OPEN ;From %ZIS3 for TRM
"RTN","ZIS4GTM",5,0)
 G OPN2:$D(IO(1,IO))
"RTN","ZIS4GTM",6,0)
 S POP=0 D OP1 G NOPEN:'$D(IO(1,IO))
"RTN","ZIS4GTM",7,0)
OPN2 ;
"RTN","ZIS4GTM",8,0)
 I $D(%ZISHP),'$D(IOP) W !,*7," Routing to device "_$P(^%ZIS(1,%E,0),"^",1)_$S($D(^(1)):" "_$P(^(1),"^",1)_" ",1:"")
"RTN","ZIS4GTM",9,0)
 Q
"RTN","ZIS4GTM",10,0)
NOPEN I %IS'["D",$D(%ZISHP)!(%ZISHG]"") S POP=1 Q
"RTN","ZIS4GTM",11,0)
 I '$D(IOP) W *7,"  [BUSY]" W "  ...  RETRY" S %=2,U="^" D YN^%ZIS1 G OPEN:%=1
"RTN","ZIS4GTM",12,0)
 S POP=1 Q
"RTN","ZIS4GTM",13,0)
 Q
"RTN","ZIS4GTM",14,0)
 ;Why no open paraneters???
"RTN","ZIS4GTM",15,0)
OP1 N $ET S $ET="G OPNERR^%ZIS4"
"RTN","ZIS4GTM",16,0)
 I $D(%ZISLOCK) L +@%ZISLOCK:5 E  S POP=1 Q
"RTN","ZIS4GTM",17,0)
 O IO::%ZISTO S:$T IO(1,IO)="" S:'$T POP=1
"RTN","ZIS4GTM",18,0)
 Q
"RTN","ZIS4GTM",19,0)
OPNERR ;Open Error
"RTN","ZIS4GTM",20,0)
 S POP=1,IO("LASTERR")=$G(IO("ERROR")),IO("ERROR")=$$EC^%ZOSV,$EC=""
"RTN","ZIS4GTM",21,0)
 Q
"RTN","ZIS4GTM",22,0)
 ;
"RTN","ZIS4GTM",23,0)
O ;From %ZIS6 for all types.
"RTN","ZIS4GTM",24,0)
 D:%IS["L" ZIO
"RTN","ZIS4GTM",25,0)
 I $D(IO("S")),$D(^%ZIS(2,IO("S"),10)),^(10)]"" U IO(0) D X10^ZISX ;Open Printer Port
"RTN","ZIS4GTM",26,0)
OPAR I $D(IOP),%ZTYPE="HFS",$D(%IS("HFSIO")),$D(%IS("IOPAR")),%IS("HFSIO")]"" S IO=%IS("HFSIO"),%ZISOPAR=%IS("IOPAR")
"RTN","ZIS4GTM",27,0)
 I %ZTYPE="CHAN" D TCPIP Q:POP  G OXECUTE^%ZIS6
"RTN","ZIS4GTM",28,0)
 S %A=%ZISOPAR_$S(%ZISOPAR["):":"",1:":"_%ZISTO)
"RTN","ZIS4GTM",29,0)
 N % S %(IO)="",%=$P($P($NA(%(IO)),"(",2),")")
"RTN","ZIS4GTM",30,0)
 S %A=%_$E(":",%A]"")_%A
"RTN","ZIS4GTM",31,0)
 D O1 I POP D  Q
"RTN","ZIS4GTM",32,0)
 .I %ZTYPE="HFS",'$D(IOP),$G(IO("ERROR"))["file not found" W !,?5,*7,"[File Not Found]" Q
"RTN","ZIS4GTM",33,0)
 .W:'$D(IOP) !,?5,*7,"[DEVICE IS BUSY]" Q
"RTN","ZIS4GTM",34,0)
 ;S IO(1,IO)="" U IO S:'(IO=IO(0)&'$D(IO("S"))&'$D(ZTQUEUED)) $X=0,$Y=0 I %ZTYPE["TRM" U IO:(WIDTH=+%Z91)
"RTN","ZIS4GTM",35,0)
 U IO S $X=0,$Y=0 I %ZTYPE["TRM" U IO:(WIDTH=+%Z91)
"RTN","ZIS4GTM",36,0)
 I %ZISUPAR]"" S %A1=""""_IO_""":"_%ZISUPAR U @%A1
"RTN","ZIS4GTM",37,0)
 ;U:%IS'[0 IO(0)
"RTN","ZIS4GTM",38,0)
 G OXECUTE^%ZIS6
"RTN","ZIS4GTM",39,0)
 ;
"RTN","ZIS4GTM",40,0)
O1 N $ES,$ET S $ET="G OPNERR^%ZIS4"
"RTN","ZIS4GTM",41,0)
 I $D(%ZISLOCK) L +@%ZISLOCK:5 E  S POP=1 Q
"RTN","ZIS4GTM",42,0)
 O @%A S:'$T&(%A?.E1":".N) POP=1 S:'POP IO(1,IO)=""
"RTN","ZIS4GTM",43,0)
 S IO("ERROR")="" Q
"RTN","ZIS4GTM",44,0)
 ;
"RTN","ZIS4GTM",45,0)
 ;Need to find out how to get IP address
"RTN","ZIS4GTM",46,0)
ZIO N %,%1 S (%,%1)=$ZIO
"RTN","ZIS4GTM",47,0)
 I $ZV["VMS",%["_TNA" D
"RTN","ZIS4GTM",48,0)
 . S (%,%1)=$ZGETDVI($I,"TT_ACCPORNAM")
"RTN","ZIS4GTM",49,0)
 . S %=$S(%["Host:":$P($P(%,"Host: ",2)," ")_":"_$P(%,"Port: ",2),1:%) S:%[" " %=$TR(%," ")
"RTN","ZIS4GTM",50,0)
 I $ZV'["VMS" D
"RTN","ZIS4GTM",51,0)
 . S (%,%1)=$ZTRNLNM("REMOTEHOST") S:$L(%) %1="Host:"_% S:'$L(%) %=$ZIO
"RTN","ZIS4GTM",52,0)
 . S:%1'["Host" %1=$ZTRNLNM("SSH_CLIENT") S:$L(%1) %1="Host:"_$P(%1," ")
"RTN","ZIS4GTM",53,0)
 S IO("ZIO")=% S:(%1["Host:")&'$D(IO("IP")) IO("IP")=$P(%1,":",2)
"RTN","ZIS4GTM",54,0)
 Q
"RTN","ZIS4GTM",55,0)
 ;
"RTN","ZIS4GTM",56,0)
TCPIP ;For TCP/IP devices, should use ^%ZISTCP
"RTN","ZIS4GTM",57,0)
 N %S
"RTN","ZIS4GTM",58,0)
 S %ZISTO=$G(%ZISTO,3)
"RTN","ZIS4GTM",59,0)
 S %A="IO:"_$S($E(%ZISOPAR)="(":"",1:"(")_%ZISOPAR_$S($E(%ZISOPAR,$L(%ZISOPAR))=")":"",1:")")_":%ZISTO:""SOCKET"""
"RTN","ZIS4GTM",60,0)
 ;U $P W !,"%A=",%A
"RTN","ZIS4GTM",61,0)
 O @%A I '$T S POP=1 Q  ;D O1 ;Do the open.
"RTN","ZIS4GTM",62,0)
 U IO:(WIDTH=512:NOWRAP:EXCEPT="G OPNERR^%ZIS4") S %S=$KEY
"RTN","ZIS4GTM",63,0)
 U $P ;W !,"$KEY=",%S
"RTN","ZIS4GTM",64,0)
 Q
"RTN","ZIS4GTM",65,0)
 ;
"RTN","ZIS4GTM",66,0)
SPOOL ;%ZDA=pointer to ^XMB(3.51, %ZFN=spool file name.
"RTN","ZIS4GTM",67,0)
 I $D(ZISDA) W:'$D(IOP) !?5,*7,"You may not Spool the printing of a Spool document" G N
"RTN","ZIS4GTM",68,0)
 I $D(DUZ)[0 W:'$D(IOP) !,"Must be a valid user." G N
"RTN","ZIS4GTM",69,0)
R S %ZY=-1 D NEWDOC^ZISPL1 G N:%ZY'>0
"RTN","ZIS4GTM",70,0)
 S %ZDA=+%ZY,%ZFN=$P(%ZY(0),U,2),IO("DOC")=$P(%ZY(0),U,1) G OK:$D(IO("Q"))
"RTN","ZIS4GTM",71,0)
 G:'%ZISB OK I '$P(%ZY,"^",3),$L(%ZFN) O %ZFN:(append:nowrap):2 G DOC
"RTN","ZIS4GTM",72,0)
 S %ZFN=IO_"SPOOL_no_"_%ZDA_".TMP" D SPL2 G:%ZFN']"" N S $P(^XMB(3.51,%ZDA,0),U,2)=%ZFN,^XMB(3.51,"C",%ZFN,%ZDA)=""
"RTN","ZIS4GTM",73,0)
DOC S IO=%ZFN,IO("SPOOL")=%ZDA,^XUTL("XQ",$J,"SPOOL")=%ZDA,IOF="#"
"RTN","ZIS4GTM",74,0)
 I $D(^%ZIS(1,%ZISIOS,1)),$P(^(1),"^",8),$O(^("SPL",0)) S ^XUTL("XQ",$J,"ADSPL")=%ZISIOS,ZISPLAD=%ZISIOS
"RTN","ZIS4GTM",75,0)
OK K %ZDA,%ZFN Q
"RTN","ZIS4GTM",76,0)
N K %ZDA,%ZFN,IO("DOC") S POP=1 Q
"RTN","ZIS4GTM",77,0)
 ;
"RTN","ZIS4GTM",78,0)
SPL2 ;Open for write
"RTN","ZIS4GTM",79,0)
 O %ZFN:(newversion:noreadonly:nowrap:exception="G SPL4"):2 G:$ZA<0 SPL4 S IO(1,%ZFN)="" Q
"RTN","ZIS4GTM",80,0)
 ;
"RTN","ZIS4GTM",81,0)
SPL3 ;Open for Read
"RTN","ZIS4GTM",82,0)
 O %ZFN:(readonly:exception="G SPL4"):2 S:'$T ZISPLQ=1 G:'$T SPL4 S IO(1,%ZFN)="" Q
"RTN","ZIS4GTM",83,0)
SPL4 W:'$D(IOP)&'$D(ZTQUEUED) !?5,*7,"Couldn't open the spool file." S %ZFN="" Q
"RTN","ZIS4GTM",84,0)
 ;
"RTN","ZIS4GTM",85,0)
CLOSE ;Close out the spool
"RTN","ZIS4GTM",86,0)
 N %,%1,%Z1,%ZFN,%ZS,%ZDA,XS,%Y,%X
"RTN","ZIS4GTM",87,0)
 I $L(IO) C IO K IO(1,IO)
"RTN","ZIS4GTM",88,0)
 D FILE^ZISPL1 I %ZDA'>0 K ZISPLAD Q
"RTN","ZIS4GTM",89,0)
 S %ZFN=$P(%ZS,"^",2) D SPL3 Q:%ZFN']""  S %ZCR=$C(13),%Y=""
"RTN","ZIS4GTM",90,0)
 S %Z1=+$G(^XTV(8989.3,1,"SPL")),%=0
"RTN","ZIS4GTM",91,0)
 U %ZFN F  R %X#255:5 Q:$ZEOF  S %2=%X D CL2 Q:%Z1<%
"RTN","ZIS4GTM",92,0)
SPLEX C %ZFN:(DELETE) K:%ZFN]"" IO(1,%ZFN) D CLOSE^ZISPL1 K %Y,%X,%1,%ZFN Q
"RTN","ZIS4GTM",93,0)
 ;
"RTN","ZIS4GTM",94,0)
CL2 S %=%+1 I %Z1<% S ^XMBS(3.519,XS,2,%,0)="*** INCOMPLETE REPORT  -- SPOOL DOCUMENT LINE LIMIT EXCEEDED ***",$P(^XMB(3.51,%ZDA,0),"^",11)=1 Q
"RTN","ZIS4GTM",95,0)
 I %2[$C(12) S ^XMBS(3.519,XS,2,%,0)="|TOP|" Q
"RTN","ZIS4GTM",96,0)
 S ^XMBS(3.519,XS,2,%,0)=%2 Q
"RTN","ZIS4GTM",97,0)
 ;
"RTN","ZIS4GTM",98,0)
HFS G HFS^%ZISF
"RTN","ZIS4GTM",99,0)
REWMT(IO,IOPAR) ;Rewind Magtape
"RTN","ZIS4GTM",100,0)
 S X="REWERR^%ZIS4",@^%ZOSF("TRAP")
"RTN","ZIS4GTM",101,0)
 U IO W *5
"RTN","ZIS4GTM",102,0)
 Q 1
"RTN","ZIS4GTM",103,0)
REWSDP(IO,IOPAR) ;Rewind SDP
"RTN","ZIS4GTM",104,0)
 G REW1
"RTN","ZIS4GTM",105,0)
REWHFS(IO,IOPAR) ;Rewind Host File.
"RTN","ZIS4GTM",106,0)
REW1 S X="REWERR^%ZIS4",@^%ZOSF("TRAP")
"RTN","ZIS4GTM",107,0)
 U IO:(REWIND)
"RTN","ZIS4GTM",108,0)
 Q 1
"RTN","ZIS4GTM",109,0)
REWERR ;Error encountered
"RTN","ZIS4GTM",110,0)
 Q 0
"RTN","ZIS4ONT")
0^1^B29872561^B27677822
"RTN","ZIS4ONT",1,0)
%ZIS4 ;SFISC/RWF,AC - DEVICE HANDLER SPOOL SPECIFIC CODE (Cache) ;10/14/08  14:27
"RTN","ZIS4ONT",2,0)
 ;;8.0;KERNEL;**34,59,69,191,278,293,440,499**;Jul 10, 1995;Build 14
"RTN","ZIS4ONT",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified
"RTN","ZIS4ONT",4,0)
 ;
"RTN","ZIS4ONT",5,0)
OPEN ;Called for TRM devices
"RTN","ZIS4ONT",6,0)
 G OPN2:$D(IO(1,IO))
"RTN","ZIS4ONT",7,0)
 S POP=0 D OP1 G NOPEN:'$D(IO(1,IO))
"RTN","ZIS4ONT",8,0)
OPN2 ;
"RTN","ZIS4ONT",9,0)
 I $D(%ZISHP),'$D(IOP) W !,$C(7)_" Routing to device "_$P(^%ZIS(1,%E,0),"^",1)_$S($D(^(1)):" "_$P(^(1),"^",1)_" ",1:"")
"RTN","ZIS4ONT",10,0)
 Q
"RTN","ZIS4ONT",11,0)
NOPEN ;
"RTN","ZIS4ONT",12,0)
 I %IS'["D",$D(%ZISHP)!(%ZISHG]"") S POP=1 Q
"RTN","ZIS4ONT",13,0)
 I '$D(IOP) W $C(7)_"  [BUSY]" W "  ...  RETRY" S %=2,U="^" D YN^%ZIS1 G OPEN:%=1
"RTN","ZIS4ONT",14,0)
 S POP=1 Q
"RTN","ZIS4ONT",15,0)
 Q
"RTN","ZIS4ONT",16,0)
OP1 N $ET S $ET="G OPNERR^%ZIS4"
"RTN","ZIS4ONT",17,0)
 I $D(%ZISLOCK) L +@%ZISLOCK:5 E  S POP=1 Q
"RTN","ZIS4ONT",18,0)
 O IO::%ZISTO S:$T IO(1,IO)="" S:'$T POP=1
"RTN","ZIS4ONT",19,0)
 Q
"RTN","ZIS4ONT",20,0)
OPNERR S POP=1,IO("LASTERR")=$G(IO("ERROR")),IO("ERROR")=$ZE,$EC=""
"RTN","ZIS4ONT",21,0)
 Q
"RTN","ZIS4ONT",22,0)
 ;
"RTN","ZIS4ONT",23,0)
O ;Gets called for all devices
"RTN","ZIS4ONT",24,0)
 N X,%A1
"RTN","ZIS4ONT",25,0)
 D:%ZIS["L" ZIO
"RTN","ZIS4ONT",26,0)
 I $D(IO("S")),$D(^%ZIS(2,IO("S"),10)),^(10)]"" U IO(0) D X10^ZISX ;Open Printer port
"RTN","ZIS4ONT",27,0)
OPAR I $D(IOP),%ZTYPE="HFS",$D(%ZIS("HFSIO")),$D(%ZIS("IOPAR")),%ZIS("HFSIO")]"" S IO=%ZIS("HFSIO"),%ZISOPAR=%ZIS("IOPAR")
"RTN","ZIS4ONT",28,0)
 S %A=$S($L(%ZISOPAR):%ZISOPAR,%ZTYPE'["TRM":"",$E(%ZISIOST,1)="C":"("_+%Z91_":""C"")",$E(%ZISIOST,1,2)="PK":"("_+%Z91_":""P"")",1:+%Z91)
"RTN","ZIS4ONT",29,0)
 S %A=%A_$S(%A["):":"",%ZTYPE["OTH"&($P(%ZTIME,"^",3)="n"):"",1:":"_%ZISTO),%A=""""_IO_""""_$E(":",%A]"")_%A
"RTN","ZIS4ONT",30,0)
 D O1 I POP W:'$D(IOP) !,?5,$C(7)_"[Device is BUSY]" Q
"RTN","ZIS4ONT",31,0)
 ;I %ZTYPE="HFS" U IO S X=IO,IO=IO_";"_$P($ZIO,";",2),IO(1,IO)="" K IO(1,X)
"RTN","ZIS4ONT",32,0)
 U IO S $X=0,$Y=0
"RTN","ZIS4ONT",33,0)
 I $L(%ZISUPAR) S %A1=""""_IO_""":"_%ZISUPAR U @%A1
"RTN","ZIS4ONT",34,0)
 ;U:%IS'[0 IO(0)
"RTN","ZIS4ONT",35,0)
 G OXECUTE^%ZIS6
"RTN","ZIS4ONT",36,0)
 ;
"RTN","ZIS4ONT",37,0)
O1 N $ET S $ET="G OPNERR^%ZIS4"
"RTN","ZIS4ONT",38,0)
 I $D(%ZISLOCK) L +@%ZISLOCK:5 E  S POP=1 Q
"RTN","ZIS4ONT",39,0)
 O @%A S:'$T&(%A?.E1":".N) POP=1 S:'POP IO(1,IO)=""
"RTN","ZIS4ONT",40,0)
 S IO("ERROR")=""
"RTN","ZIS4ONT",41,0)
 Q
"RTN","ZIS4ONT",42,0)
 ;Version 3 used ip/port, Version 4 has ip:port|xx
"RTN","ZIS4ONT",43,0)
ZIO N %,%1 S %=$ZIO,%1=$$VERSION^%ZOSV
"RTN","ZIS4ONT",44,0)
 S IO("ZIO")=$S(%1<4:$I,1:$ZIO),%1=$S(%["/":"/",1:":")
"RTN","ZIS4ONT",45,0)
 I $D(IO("IP")) Q  ;p499
"RTN","ZIS4ONT",46,0)
 ;Drop prefix
"RTN","ZIS4ONT",47,0)
 S:%["|TNT|" %=$E(%,6,999) S:%["|TNA|" %=$E(%,6,999)
"RTN","ZIS4ONT",48,0)
 ;Get IP name or number
"RTN","ZIS4ONT",49,0)
 S:$P(%,%1)["." IO("IP")=$P(%,%1)
"RTN","ZIS4ONT",50,0)
 I $$OS^%ZOSV="VMS",$G(IO("IP"))="" S IO("IP")=$P($ZF("TRNLNM","SYS$REM_NODE"),":") ;For SSH, p499
"RTN","ZIS4ONT",51,0)
 S:'$L(IO("ZIO")) IO("ZIO")=$G(IO("IP"))
"RTN","ZIS4ONT",52,0)
 I $L($G(IO("IP"))),IO("IP")'?1.3N1P1.3N1P1.3N1P1.3N S IO("IP")=$P($ZU(54,13,IO("IP")),",") ;p499
"RTN","ZIS4ONT",53,0)
 Q
"RTN","ZIS4ONT",54,0)
 ;
"RTN","ZIS4ONT",55,0)
SPOOL ;%ZDA=pointer to ^XMB(3.51, %ZFN=spool file Num/Name.
"RTN","ZIS4ONT",56,0)
 N %ZOS S %ZOS=$$OS^%ZOSV
"RTN","ZIS4ONT",57,0)
 I '$D(^XMB(3.51,0)) W:'$D(IOP) !?5,"The spooler files are not setup in this account." G NO
"RTN","ZIS4ONT",58,0)
 I $D(ZISDA) W:'$D(IOP) !?5,$C(7)_"You may not Spool the printing of a Spool document" G NO
"RTN","ZIS4ONT",59,0)
 I $D(DUZ)[0 W:'$D(IOP) !,"Must be a valid user." G NO
"RTN","ZIS4ONT",60,0)
 ;Get entry in Spool Doc file
"RTN","ZIS4ONT",61,0)
R S %ZY=-1 D NEWDOC^ZISPL1:$D(DUZ)=11 G NO:%ZY'>0 S %ZDA=+%ZY,%ZFN=$P(%ZY(0),U,2),IO("DOC")=$P(%ZY(0),U,1) G OK:$D(IO("Q"))
"RTN","ZIS4ONT",62,0)
 G:'%ZISB OK I '$P(%ZY,"^",3),%ZFN]"" D SPL3 G NO:%ZFN<0,DOC
"RTN","ZIS4ONT",63,0)
 I %ZOS="NT" D  G:%ZFN>255 NO
"RTN","ZIS4ONT",64,0)
 . F %ZFN=1:1:260 I '$D(^XMB(3.51,"C",%ZFN))!$D(^(%ZFN,%ZDA)) Q:%ZFN<256  W:'$D(IOP) $C(7)_"  DELETE SOME OTHER DOCUMENT!" Q
"RTN","ZIS4ONT",65,0)
 . Q:%ZFN>255  D SPL2 S $P(^XMB(3.51,%ZDA,0),U,2)=%ZFN,^XMB(3.51,"C",%ZFN,%ZDA)=""
"RTN","ZIS4ONT",66,0)
 I %ZOS="VMS" D  G:%ZFN=-1 NO
"RTN","ZIS4ONT",67,0)
 . S %ZFN=IO_"SPOOL_no_"_%ZDA_".TMP" D SPL2 Q:%ZFN=-1  S $P(^XMB(3.51,%ZDA,0),U,2)=%ZFN,^XMB(3.51,"C",%ZFN,%ZDA)="",IO=%ZFN
"RTN","ZIS4ONT",68,0)
DOC S IO("SPOOL")=%ZDA,^XUTL("XQ",$J,"SPOOL")=%ZDA
"RTN","ZIS4ONT",69,0)
 I $D(^%ZIS(1,%ZISIOS,1)),$P(^(1),"^",8),$O(^("SPL",0)) S ^XUTL("XQ",$J,"ADSPL")=%ZISIOS,ZISPLAD=%ZISIOS
"RTN","ZIS4ONT",70,0)
OK K %ZDA,%ZFN Q
"RTN","ZIS4ONT",71,0)
NO K %ZDA,%ZFN,IO("DOC") S POP=1 Q
"RTN","ZIS4ONT",72,0)
 ;
"RTN","ZIS4ONT",73,0)
SPL2 I %ZOS="NT" O IO:(%ZFN:0) S IO(1,IO)="",^SPOOL(0,IO("DOC"),%ZFN)="",^SPOOL(%ZFN,0)=IO("DOC")_"{"_$H Q
"RTN","ZIS4ONT",74,0)
 ;VMS
"RTN","ZIS4ONT",75,0)
 O %ZFN:("WNS"):2 G:'$T SPL4 S IO(1,%ZFN)="" Q
"RTN","ZIS4ONT",76,0)
 ;
"RTN","ZIS4ONT",77,0)
SPL3 I %ZOS="NT" G SPL4:'$D(^SPOOL(%ZFN,2147483647)) O IO:(%ZFN:$P(^(2147483647),"{",3)):1 S:'$T ZISPLQ=1 K ^(2147483647) S IO(1,IO)="" Q
"RTN","ZIS4ONT",78,0)
 ;VMS
"RTN","ZIS4ONT",79,0)
 N $ETRAP S $ETRAP="S $EC="""" G SPL4^%ZIS4"
"RTN","ZIS4ONT",80,0)
 O %ZFN:"RV":1 S:'$T ZISPLQ=1 G:$ZA<0!('$T) SPL4 S IO(1,%ZFN)="" Q
"RTN","ZIS4ONT",81,0)
 ;
"RTN","ZIS4ONT",82,0)
SPL4 W:'$D(IOP) !,"Spool file already open" S %ZFN=-1 Q
"RTN","ZIS4ONT",83,0)
 ;
"RTN","ZIS4ONT",84,0)
CLOSE N %ZOS,%Z1,%ZCR,%2,%3,%X,%Y,ZTSK,%ZFN S %ZOS=$$OS^%ZOSV
"RTN","ZIS4ONT",85,0)
 I %ZOS="NT",IO=2,$D(IO(1,IO)) K IO(1,IO) C IO
"RTN","ZIS4ONT",86,0)
 I %ZOS="VMS",IO]"",$D(IO(1,IO)) U IO S %ZFN=$ZIO C IO K IO(1,IO)
"RTN","ZIS4ONT",87,0)
 ;See that ZTSK is set so we will move to the global now.
"RTN","ZIS4ONT",88,0)
 S ZTSK=$G(ZTSK,1) D FILE^ZISPL1 I %ZDA'>0 K ZISPLAD Q
"RTN","ZIS4ONT",89,0)
 G:%ZOS="VMS" CLVMS
"RTN","ZIS4ONT",90,0)
 S %ZFN=$P(%ZS,"^",2),%ZCR=$C(13),%Y="",%=0,%3=$P(^SPOOL(%ZFN,2147483647),"{",3)
"RTN","ZIS4ONT",91,0)
 S %Z1=+$G(^XTV(8989.3,1,"SPL"))
"RTN","ZIS4ONT",92,0)
 F %2=1:1:%3 Q:'$D(^SPOOL(%ZFN,%2))  S %X=^SPOOL(%ZFN,%2) D
"RTN","ZIS4ONT",93,0)
 . I %Z1<% D LIMIT S %2=%3 Q
"RTN","ZIS4ONT",94,0)
 . I %X[$C(13,12) D:$L($P(%X,$C(13))) ADD($P(%X,$C(13))) D ADD("|TOP|") Q
"RTN","ZIS4ONT",95,0)
 . D ADD($P(%X,$C(13),1))
"RTN","ZIS4ONT",96,0)
 K ^SPOOL(%ZFN),^SPOOL(0,$P(%ZS,U,1)),%Y,%X,%1,%2,%3 D CLOSE^ZISPL1
"RTN","ZIS4ONT",97,0)
 Q
"RTN","ZIS4ONT",98,0)
ADD(L) S %=%+1,^XMBS(3.519,XS,2,%,0)=L
"RTN","ZIS4ONT",99,0)
 Q
"RTN","ZIS4ONT",100,0)
LIMIT D ADD("*** INCOMPLETE REPORT  -- SPOOL DOCUMENT LINE LIMIT EXCEEDED ***") S $P(^XMB(3.51,%ZDA,0),"^",11)=1
"RTN","ZIS4ONT",101,0)
 Q
"RTN","ZIS4ONT",102,0)
CLVMS ;Close for Cache VMS
"RTN","ZIS4ONT",103,0)
 N $ES,$ET S $ET="D:$EC'[""ENDOF"" ^%ZTER,UNWIND^%ZTER S $EC="""" D SPLEX^%ZIS4,UNWIND^%ZTER"
"RTN","ZIS4ONT",104,0)
 S %ZA=$ZU(68,40,1) ;Work like DSM
"RTN","ZIS4ONT",105,0)
 ;%ZFN Could be set at the top
"RTN","ZIS4ONT",106,0)
 S %ZFN=$S($G(%ZFN)]"":%ZFN,1:$P(%ZS,"^",2)) D SPL3 Q:%ZFN']""  U %ZFN S %ZCR=$C(13),%Y=""
"RTN","ZIS4ONT",107,0)
 S %Z1=+$G(^XTV(8989.3,1,"SPL")),%=0
"RTN","ZIS4ONT",108,0)
 F  R %X#255:5 Q:$ZEOF<0  D  G:%Z1<% SPLEX
"RTN","ZIS4ONT",109,0)
 . I %Z1<% D LIMIT Q
"RTN","ZIS4ONT",110,0)
 . I %X[$C(12) D  Q
"RTN","ZIS4ONT",111,0)
 . . S %Y=$P(%X,$C(12)) D:$L(%Y) ADD(%Y),ADD("|TOP|")
"RTN","ZIS4ONT",112,0)
 . . S %Y=$P(%X,$C(12),2) D:$L(%Y) ADD(%Y)
"RTN","ZIS4ONT",113,0)
 . . Q
"RTN","ZIS4ONT",114,0)
 . D ADD(%X)
"RTN","ZIS4ONT",115,0)
 . Q
"RTN","ZIS4ONT",116,0)
SPLEX C %ZFN:"D" K:%ZFN]"" IO(1,%ZFN) D CLOSE^ZISPL1 K %Y,%X,%1,%ZFN Q
"RTN","ZIS4ONT",117,0)
 ;
"RTN","ZIS4ONT",118,0)
 ;
"RTN","ZIS4ONT",119,0)
HFS G HFS^%ZISF
"RTN","ZIS4ONT",120,0)
REWMT(IO2,IOPAR) ;Rewind Magtape
"RTN","ZIS4ONT",121,0)
 N $ETRAP S $ET="G REWERR^%ZIS4"
"RTN","ZIS4ONT",122,0)
 U IO2 W *5
"RTN","ZIS4ONT",123,0)
 Q 1
"RTN","ZIS4ONT",124,0)
REWSDP(IO2,IOPAR) ;Rewind SDP
"RTN","ZIS4ONT",125,0)
 G REW1
"RTN","ZIS4ONT",126,0)
REWHFS(IO2,IOPAR) ;Rewind Host File.
"RTN","ZIS4ONT",127,0)
REW1 ;ZIS set % to the current $I so need to update % if = IO
"RTN","ZIS4ONT",128,0)
 N NIO,OP,$ETRAP
"RTN","ZIS4ONT",129,0)
 S $ET="G REWERR^%ZIS4"
"RTN","ZIS4ONT",130,0)
 C IO2 ;You do a rewind to read the file.
"RTN","ZIS4ONT",131,0)
 S OP=$S($ZV["VMS":"RV",1:"RS")
"RTN","ZIS4ONT",132,0)
 O IO2:(OP):1 S IO(1,IO2)=""
"RTN","ZIS4ONT",133,0)
 Q 1
"RTN","ZIS4ONT",134,0)
REWERR ;Error encountered
"RTN","ZIS4ONT",135,0)
 S IO("ERROR")=$EC,$ECODE=""
"RTN","ZIS4ONT",136,0)
 Q 0
"RTN","ZIS5")
0^8^B13269875^B13100730
"RTN","ZIS5",1,0)
%ZIS5 ;SFISC/STAFF --DEVICE LOOK-UP ;07/17/08  13:44
"RTN","ZIS5",2,0)
 ;;8.0;KERNEL;**18,24,69,499**;JUL 10, 1995;Build 14
"RTN","ZIS5",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified
"RTN","ZIS5",4,0)
 ;Does a DIC like lookup. %XX,%YY are call in/out parameters
"RTN","ZIS5",5,0)
 N %DO,%DIY,%DD,%DIX
"RTN","ZIS5",6,0)
 S U="^",%DO="" K DUOUT
"RTN","ZIS5",7,0)
 I $D(^%ZIS(%ZISDFN,0)) S %DO=^(0)
"RTN","ZIS5",8,0)
A G:%ZIS(0)'["A" X I $D(%ZIS("A")) S %DD=%ZIS("A") G B
"RTN","ZIS5",9,0)
 S %DD="Select "_$P(%DO,U,1)_": "
"RTN","ZIS5",10,0)
B I $D(%ZIS("B")),%ZIS("B")]"" S %YY=%ZIS("B"),%XX=$O(^%ZIS(%ZISDFN,%D,%YY)),%DIY=$S($F(%XX,%YY)-1=$L(%YY):%XX,$D(^%ZIS(%ZISDFN,%YY,0)):$P(^(0),U,1),1:%YY) W %DD,%DIY,"// " R %XX:%ZISDTIM G G:%XX]"" S %XX=%DIY G G
"RTN","ZIS5",11,0)
 W !,%DD R %XX:%ZISDTIM
"RTN","ZIS5",12,0)
G G NO:'$T,NO:%XX["^" G:%XX?.N&(+%XX=%XX) NUM I %XX'?.ANP!($L(%XX)>30) W:%ZIS(0)["Q" *7," ??" G A
"RTN","ZIS5",13,0)
X I %XX=" ",$D(DUZ)#2,$D(^DISV(+DUZ,"^%ZIS("_%ZISDFN_",")) S %YY=+^("^%ZIS("_%ZISDFN_",") D S G:'$T NO G GOT
"RTN","ZIS5",14,0)
F G NO:%XX="" K %DS S %DS=0,%DS(0)=1,%DIX=%XX,%DIY=0
"RTN","ZIS5",15,0)
 I $D(^%ZIS(%ZISDFN,%D,%XX)) G T1
"RTN","ZIS5",16,0)
TRY S %DIX=$O(^%ZIS(%ZISDFN,%D,%DIX)) G:$P(%DIX,%XX,1)'=""!(%DIX="") T2 S %DIY=0
"RTN","ZIS5",17,0)
T1 S %DIY=$O(^%ZIS(%ZISDFN,%D,%DIX,+%DIY)) G:%DIY'>0 TRY S %YY=+%DIY D S G:'$T T1
"RTN","ZIS5",18,0)
 I %DS,'(%DS#10) D LST G NO:%XX=U,ADD:%YY<0,GOT:%YY>0
"RTN","ZIS5",19,0)
 S %DS=%DS+1,%DS(%DS)=%DIY G T1
"RTN","ZIS5",20,0)
LSYN ;
"RTN","ZIS5",21,0)
S I $D(^%ZIS(%ZISDFN,%YY,0)) G S1
"RTN","ZIS5",22,0)
 Q
"RTN","ZIS5",23,0)
S1 G S2:%ZISDFN'=1!(%D'="LSYN") I $P(^%ZIS(1,%YY,0),U,9)=%ZISV!($P(^(0),U,9)="") G S2
"RTN","ZIS5",24,0)
 Q
"RTN","ZIS5",25,0)
S2 N Y S Y=%YY D:$D(%ZIS("S")) XS^ZISX Q
"RTN","ZIS5",26,0)
T2 G:'%DS NO S %DIY="" D LST G NO:%XX=U,ADD:%YY<1,GOT
"RTN","ZIS5",27,0)
LST I %DS=1,'$D(%ZISLST) S %YY=%DS(1) Q
"RTN","ZIS5",28,0)
 S %YY=-1 Q:%ZIS(0)'["E"  W !
"RTN","ZIS5",29,0)
 F %DZ=%DS(0):1:%DS W !,$J(%DZ,2)," ",$P(^%ZIS(%ZISDFN,%DS(%DZ),0),U,1) D:%ZISDFN=1  I $D(%ZIS("W")),$D(^(0)) W "  " D XW^ZISX
"RTN","ZIS5",30,0)
 . ;Show Location
"RTN","ZIS5",31,0)
 . S %=$G(^(1)) W:$X+$L($P(%,U))>74 !?75-$L(X) W "   "_$P(%,U)
"RTN","ZIS5",32,0)
L1 W:%DIY !,"Type '^' to Stop, or" W !,"Choose 1" W:%DS>1 "-",%DS
"RTN","ZIS5",33,0)
 R "> ",%YY:%ZISDTIM S %ZISLST=1 I %YY="",%DIY S %DS(0)=%DS+1,%YY=0 W ! Q
"RTN","ZIS5",34,0)
 I %YY=U!(%YY="") S %YY=-1,DUOUT=1 S:%YY=U %XX=U Q
"RTN","ZIS5",35,0)
 I +%YY'=%YY!(%YY<1)!(%YY>%DS) W:%ZIS(0)["Q" *7," ??" G L1
"RTN","ZIS5",36,0)
 S %YY=%DS(%YY) Q
"RTN","ZIS5",37,0)
GOT S %DZ=^%ZIS(%ZISDFN,+%YY,0)
"RTN","ZIS5",38,0)
 W:%ZIS(0)["E" "  ",$P(%DZ,U,1)
"RTN","ZIS5",39,0)
R I %ZIS(0)'["F" S:$S($D(DUZ)#2:$S(DUZ:1,1:0),1:0) ^DISV(DUZ,"^%ZIS("_%ZISDFN_",")=+%YY
"RTN","ZIS5",40,0)
 I %ZIS(0)["Z" S %YY(0)=^%ZIS(%ZISDFN,+%YY,0)
"RTN","ZIS5",41,0)
Q K %ZISDFN,%DO,%DD,%DIX,%DIY,%DZ Q
"RTN","ZIS5",42,0)
ADD ;can't add to files
"RTN","ZIS5",43,0)
NO S %YY=-1 G Q
"RTN","ZIS5",44,0)
NUM I $D(^%ZIS(%ZISDFN,%XX)) S %YY=%XX D S I $T G GOT
"RTN","ZIS5",45,0)
 G F
"RTN","ZIS5",46,0)
 ;
"RTN","ZIS5",47,0)
1 ;Entry point for Device lookup
"RTN","ZIS5",48,0)
 N %D,%DS,%ZISDFN
"RTN","ZIS5",49,0)
 F %D="B","LSYN" S %ZISDFN=1,%ZIS(0)=$S($D(IOP):"M",1:"EMQ") D %ZIS5 Q:(%YY>0)!$D(DUOUT)
"RTN","ZIS5",50,0)
 Q
"RTN","ZIS5",51,0)
2 ;Entry point for Terminal type lookup
"RTN","ZIS5",52,0)
 N %D,%DS,%ZISDFN
"RTN","ZIS5",53,0)
 S %D="B",%ZISDFN=2,%ZIS(0)=$S($D(IOP):"M",1:"EMQ") D %ZIS5
"RTN","ZIS5",54,0)
 Q
"RTN","ZIS5",55,0)
 ;
"RTN","ZIS5",56,0)
LD1 S %E=0,%Y=0 D LCPU:"PD"[$E(%X) S %E=0 W !
"RTN","ZIS5",57,0)
L S %E=$S("PD"[$E(%X):$O(^UTILITY("ZIS",$J,"DEVLST","B",%E)),1:$O(^%ZIS(1,"B",%E))) G:%E="" RESTART S %A=+$O(^(%E,0))
"RTN","ZIS5",58,0)
 G L:'$D(^%ZIS(1,%A,0)),L:$P(^(0),"^",2)=46,L:$P(^(0),"^",2)=63 I $D(%ZIS("S")) N Y S Y=%A D XS^ZISX G L:'$T
"RTN","ZIS5",59,0)
 I "AP"[$E(%X) G L:$P($G(^%ZIS(2,+$G(^%ZIS(1,%A,"SUBTYPE")),0)),U)'?1"P".E
"RTN","ZIS5",60,0)
 W $J($P(^%ZIS(1,%A,0),"^",1),9) W:$D(^(1)) " ",$P(^(1),"^",1) I $D(^(90)),^(90) W " ** OUT OF SERVICE"
"RTN","ZIS5",61,0)
 W ?39 I $X>40 W ! S %Y=%Y+1 I %Y>20 R "'^' TO STOP: ",%Y:%ZISDTIM,! G RESTART:%Y?1P S %Y=0
"RTN","ZIS5",62,0)
 G L
"RTN","ZIS5",63,0)
 ;
"RTN","ZIS5",64,0)
LCPU S %A=%ZISV
"RTN","ZIS5",65,0)
LC1 S %A=$O(^%ZIS(1,"CPU",%A)) Q:$P(%A,".")'=%ZISV  S %E=0
"RTN","ZIS5",66,0)
LC2 S %E=+$O(^%ZIS(1,"CPU",%A,%E)) G LC1:%E'>0,LC1:'$D(^%ZIS(1,%E,0)) S ^UTILITY("ZIS",$J,"DEVLST","B",$P(^(0),"^",1),%E)="" G LC2
"RTN","ZIS5",67,0)
RESTART S:$D(%H) %E=+%H K %X,^UTILITY("ZIS",$J,"DEVLST") Q
"RTN","ZISFGTM")
0^10^B8623260^B9168627
"RTN","ZISFGTM",1,0)
%ZISF ;SFISC/AC - HOST FILES FOR GT.M on Unix/VMS  ;9/3/08  09:48
"RTN","ZISFGTM",2,0)
 ;;8.0;KERNEL;**275,499**;Jul 10, 1995;Build 14
"RTN","ZISFGTM",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified
"RTN","ZISFGTM",4,0)
HFS ;Host File Server
"RTN","ZISFGTM",5,0)
 ;Calling parameters in %ZIS override Device file.
"RTN","ZISFGTM",6,0)
 Q:$D(IOP)&$D(%IS("HFSIO"))&$D(%IS("IOPAR"))
"RTN","ZISFGTM",7,0)
 N %
"RTN","ZISFGTM",8,0)
 ;Get file name, in %X.
"RTN","ZISFGTM",9,0)
 I $D(%ZIS("HFSNAME")) S IO=%ZIS("HFSNAME"),%X=IO ;
"RTN","ZISFGTM",10,0)
 E  D ASKHFS
"RTN","ZISFGTM",11,0)
 ;Mode or actual parameters
"RTN","ZISFGTM",12,0)
H S:$D(%ZIS("HFSMODE")) %ZISOPAR=$$MODE(%ZIS("HFSMODE"))
"RTN","ZISFGTM",13,0)
H1 I $D(IO("Q"))!(%IS["Z") S IO("HFSIO")=""
"RTN","ZISFGTM",14,0)
 S:$L(%X) %ZIS("afn")=1
"RTN","ZISFGTM",15,0)
 S IO=$S(%X]"":%X,1:IO),IO=$$CHKNM(IO) ;See that we have a directory
"RTN","ZISFGTM",16,0)
 S:$D(IO("HFSIO")) IO("HFSIO")=IO
"RTN","ZISFGTM",17,0)
 I '$D(IOP)&$D(%ZIS("HFSNAME")) S %="    HOST FILE TO USE:  "_%ZIS("HFSNAME") W:$X+$L(%)>75 ! W %,!
"RTN","ZISFGTM",18,0)
 ;Check Ask Parameters
"RTN","ZISFGTM",19,0)
 D ASKPAR^%ZIS6,SETPAR^%ZIS3
"RTN","ZISFGTM",20,0)
 ;Check Ask IO Mode
"RTN","ZISFGTM",21,0)
HFSIOO I '$D(IOP),%ZTYPE="HFS",'$D(%ZIS("HFSMODE")),'$P(^%ZIS(1,%E,0),"^",4),%ZISOPAR="",$D(^%ZIS(1,%E,1)),$P(^(1),"^",6) D
"RTN","ZISFGTM",22,0)
 . W:$X>19 ! W ?20,"INPUT/OUTPUT OPERATION: R//"
"RTN","ZISFGTM",23,0)
 Q:'$T  D SBR^%ZIS1 I $D(DTOUT)!$D(DFOUT)!$D(DUOUT) S POP=1 Q
"RTN","ZISFGTM",24,0)
 S:%X="" %X="R" S %X=$$UP^%ZIS1(%X)
"RTN","ZISFGTM",25,0)
 D HOPT:%X="?"!'$$CHECK(%X),HOPT1:%X="??" G HFSIOO:%X="?"!'$$CHECK(%X)
"RTN","ZISFGTM",26,0)
 S:%X]"" %ZISOPAR=$$MODE(%X)
"RTN","ZISFGTM",27,0)
 Q
"RTN","ZISFGTM",28,0)
 ;
"RTN","ZISFGTM",29,0)
CHECK(X) ;Check that we have valid option
"RTN","ZISFGTM",30,0)
 N Y,%
"RTN","ZISFGTM",31,0)
 Q:(X["R")&(X["W") 0 ;Can't have both
"RTN","ZISFGTM",32,0)
 S Y=1 I $L($TR(X,"ANRW")) S Y=0
"RTN","ZISFGTM",33,0)
 Q Y
"RTN","ZISFGTM",34,0)
 ;
"RTN","ZISFGTM",35,0)
ASKHFS ;---Ask host file name here---
"RTN","ZISFGTM",36,0)
 I $D(%IS("B","HFS"))#2,%IS("B","HFS")]"" D
"RTN","ZISFGTM",37,0)
 .S IO=%IS("B","HFS") ;Set default host file name
"RTN","ZISFGTM",38,0)
 S %X='$P($G(^%ZIS(1,%E,1)),"^",5)
"RTN","ZISFGTM",39,0)
 S:'%X %X=""
"RTN","ZISFGTM",40,0)
 I $D(IOP)!%X!$D(%ZIS("HFSNAME")) S %X="" Q
"RTN","ZISFGTM",41,0)
ASKAGN W !,"HOST FILE NAME: "_IO_"//" D SBR^%ZIS1
"RTN","ZISFGTM",42,0)
 I %X?1."?".E W !,"ENTER HOST FILE NAME" G ASKAGN
"RTN","ZISFGTM",43,0)
 S:$D(DTOUT)!$D(DUOUT) POP=1
"RTN","ZISFGTM",44,0)
 Q
"RTN","ZISFGTM",45,0)
 ;
"RTN","ZISFGTM",46,0)
CHKNM(H) ;Check the HFS name
"RTN","ZISFGTM",47,0)
 N N S N=H
"RTN","ZISFGTM",48,0)
 I $ZV["VMS" D
"RTN","ZISFGTM",49,0)
 . I (H'[":")&(H'["[") S N=$$DEFDIR^%ZISH("")_H
"RTN","ZISFGTM",50,0)
 E  D
"RTN","ZISFGTM",51,0)
 . I (H'["/") S N=$$DEFDIR^%ZISH("")_H
"RTN","ZISFGTM",52,0)
 Q N
"RTN","ZISFGTM",53,0)
 ;
"RTN","ZISFGTM",54,0)
MODE(X) ;Return %ZISOPAR in Y.
"RTN","ZISFGTM",55,0)
 N Y
"RTN","ZISFGTM",56,0)
 S Y=$S((X="N")!(X="W"):"(NEWVERSION:NOREADONLY:VARIABLE)",X="A":"(APPEND:NOREADONLY:VARIABLE)",1:"(READONLY:VARIABLE)")
"RTN","ZISFGTM",57,0)
 Q Y
"RTN","ZISFGTM",58,0)
 ;
"RTN","ZISFGTM",59,0)
HOPT W !,"You may enter a code that represents one of",!,"the following host file input/ouput operation:"
"RTN","ZISFGTM",60,0)
 W !?16,"R = READ ACCESS",!?16,"W = WRITE ACCESS",!?16,"N = NEWVERSION",!?16,"A = APPEND"
"RTN","ZISFGTM",61,0)
 Q
"RTN","ZISFGTM",62,0)
 ;
"RTN","ZISFGTM",63,0)
HOPT1 S %ZISI=$O(^DIC(9.2,"B","XUHFSPARAM-GUX",0)) Q:'%ZISI  Q:'$D(^DIC(9.2,+%ZISI,0))  Q:$P(^(0),"^",1)'="XUHFSPARAM-GUX"
"RTN","ZISFGTM",64,0)
 Q:$D(^DIC(9.2,+%ZISI,1))'>9  F %X=0:0 S %X=$O(^DIC(9.2,+%ZISI,1,%X)) Q:%X'>0  I $D(^(%X,0)) W !,^(0)
"RTN","ZISFGTM",65,0)
 W ! S %X="??"
"RTN","ZISFGTM",66,0)
 Q
"RTN","ZISFONT")
0^9^B9782391^B9426543
"RTN","ZISFONT",1,0)
%ZISF ;SFISC/AC - HOST FILES FOR Cache on NT & VMS ;07/17/08  14:57
"RTN","ZISFONT",2,0)
 ;;8.0;KERNEL;**34,191,271,385,499**;Jul 10, 1995;Build 14
"RTN","ZISFONT",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified
"RTN","ZISFONT",4,0)
HFS ;Host File Server
"RTN","ZISFONT",5,0)
 ;Calling parameters in %ZIS override Device file.
"RTN","ZISFONT",6,0)
 Q:$D(IOP)&$D(%ZIS("HFSIO"))&$D(%ZIS("IOPAR"))
"RTN","ZISFONT",7,0)
 N %
"RTN","ZISFONT",8,0)
 ;Get file name
"RTN","ZISFONT",9,0)
 I $D(%ZIS("HFSNAME")) S IO=%ZIS("HFSNAME"),%X=IO
"RTN","ZISFONT",10,0)
 E  D ASKHFS ;Return name in %X
"RTN","ZISFONT",11,0)
 ;Mode or actual parameters
"RTN","ZISFONT",12,0)
H S:$D(%ZIS("HFSMODE")) %ZISOPAR=$$MODE(%ZIS("HFSMODE"))
"RTN","ZISFONT",13,0)
H1 I $D(IO("Q"))!(%ZIS["Z") S IO("HFSIO")=""
"RTN","ZISFONT",14,0)
 S:$L(%X) %ZIS("afn")=1
"RTN","ZISFONT",15,0)
 S IO=$S($L(%X):%X,1:IO),IO=$$CHKNM(IO) ;See that we have a directory
"RTN","ZISFONT",16,0)
 S:$D(IO("HFSIO")) IO("HFSIO")=IO
"RTN","ZISFONT",17,0)
 I '$D(IOP)&$D(%ZIS("HFSNAME")) S %="    HOST FILE USED:  "_%ZIS("HFSNAME") W:$X+$L(%)>75 ! W %,!
"RTN","ZISFONT",18,0)
 ;Check Ask Parameters
"RTN","ZISFONT",19,0)
 D ASKPAR^%ZIS6,SETPAR^%ZIS3
"RTN","ZISFONT",20,0)
 ;Check Ask IO Mode
"RTN","ZISFONT",21,0)
HFSIOO I '$D(IOP),%ZTYPE="HFS",'$D(%ZIS("HFSMODE")),'$P(^%ZIS(1,%E,0),"^",4),%ZISOPAR="",$P($G(^%ZIS(1,%E,1)),"^",6) D
"RTN","ZISFONT",22,0)
 . W:$X>19 ! W ?20,"INPUT/OUTPUT OPERATION: R//"
"RTN","ZISFONT",23,0)
 Q:'$T  D SBR^%ZIS1 I $D(DTOUT)!$D(DFOUT)!$D(DUOUT) S POP=1 Q
"RTN","ZISFONT",24,0)
 S:%X="" %X="R" S %X=$$UP^%ZIS1(%X)
"RTN","ZISFONT",25,0)
 D HOPT:%X="?"!'$$CHECK(%X),HOPT1:%X="??" G HFSIOO:%X="?"!'$$CHECK(%X)
"RTN","ZISFONT",26,0)
 S:%X]"" %ZISOPAR="("_$$MODE(%X)_")"
"RTN","ZISFONT",27,0)
 Q
"RTN","ZISFONT",28,0)
 ;
"RTN","ZISFONT",29,0)
CHECK(X) ;Check that we have valid option
"RTN","ZISFONT",30,0)
 N Y,%
"RTN","ZISFONT",31,0)
 Q:(X["R")&(X["W") 0 ;Can't have both
"RTN","ZISFONT",32,0)
 S Y=1 I $L($TR(X,"ANRW")) S Y=0
"RTN","ZISFONT",33,0)
 Q Y
"RTN","ZISFONT",34,0)
 ;
"RTN","ZISFONT",35,0)
ASKHFS ;---Ask host file name here---
"RTN","ZISFONT",36,0)
 I $D(%ZIS("B","HFS"))#2,%ZIS("B","HFS")]"" D
"RTN","ZISFONT",37,0)
 .S IO=%ZIS("B","HFS") ;Set default host file name
"RTN","ZISFONT",38,0)
 S %X='$P($G(^%ZIS(1,%E,1)),"^",5)
"RTN","ZISFONT",39,0)
 S:'%X %X=""
"RTN","ZISFONT",40,0)
 I $D(IOP)!%X!$D(%ZIS("HFSNAME")) S %X="" Q
"RTN","ZISFONT",41,0)
ASKAGN W !,"HOST FILE NAME: "_IO_"//" D SBR^%ZIS1
"RTN","ZISFONT",42,0)
 I %X?1."?".E W !,"ENTER HOST FILE NAME" G ASKAGN
"RTN","ZISFONT",43,0)
 S:$D(DTOUT)!$D(DUOUT) POP=1
"RTN","ZISFONT",44,0)
 Q
"RTN","ZISFONT",45,0)
CHKNM(H)        ;Check the HFS name
"RTN","ZISFONT",46,0)
 N N,%OS S N=H,%OS=$ZV
"RTN","ZISFONT",47,0)
 I %OS["VMS",(H'[":")&(H'["[") S N=$$DEFDIR^%ZISH("")_H ;VMS - disk:[directory]file
"RTN","ZISFONT",48,0)
 I %OS["Windows",(H'["\")&(H'[":") S N=$$DEFDIR^%ZISH("")_H ;NT - C:\DIR\FILE
"RTN","ZISFONT",49,0)
 I %OS["UNIX",(H'["/") S N=$$DEFDIR^%ZISH("")_H ;UNIX/Linux - ./file or /mnt/dir/file
"RTN","ZISFONT",50,0)
 Q N
"RTN","ZISFONT",51,0)
 ;
"RTN","ZISFONT",52,0)
MODE(X) ;Return value for %ZISOPAR.
"RTN","ZISFONT",53,0)
 ;For VMS only, The H is for read SHARE. Going back to READ Stream mode.
"RTN","ZISFONT",54,0)
 N Y,Q S Q=$C(34)
"RTN","ZISFONT",55,0)
 I $ZV["VMS" S Y=$S(X="N":"NWS",X="W":"NWS",X="A":"AWS",1:"RHS")
"RTN","ZISFONT",56,0)
 E  S Y=$S(X="N":"NWS",X="W":"NWS",X="A":"AWS",1:"RS")
"RTN","ZISFONT",57,0)
 Q $S($L(Y):Q_Y_Q,1:Y)
"RTN","ZISFONT",58,0)
 ;
"RTN","ZISFONT",59,0)
HOPT W !,"You may enter a code that represents one of",!,"the following host file input/ouput operation:"
"RTN","ZISFONT",60,0)
 W !?16,"R = READ ACCESS",!?16,"W = WRITE ACCESS",!?16,"N = NEWVERSION",!?16,"A = APPEND"
"RTN","ZISFONT",61,0)
 Q
"RTN","ZISFONT",62,0)
 ;
"RTN","ZISFONT",63,0)
HOPT1 S %ZISI=$O(^DIC(9.2,"B","XUHFSPARAM-MVX",0)) Q:'%ZISI  Q:'$D(^DIC(9.2,+%ZISI,0))  Q:$P(^(0),"^",1)'="XUHFSPARAM-MVX"
"RTN","ZISFONT",64,0)
 Q:$D(^DIC(9.2,+%ZISI,1))'>9  F %X=0:0 S %X=$O(^DIC(9.2,+%ZISI,1,%X)) Q:%X'>0  I $D(^(%X,0)) W !,^(0)
"RTN","ZISFONT",65,0)
 W ! S %X="??"
"RTN","ZISFONT",66,0)
 Q
"RTN","ZOSVGTM")
0^13^B14876188^B14594340
"RTN","ZOSVGTM",1,0)
%ZOSV ;ISF/STAFF - View commands & special functions (GT.M). ;09/15/08  14:45
"RTN","ZOSVGTM",2,0)
 ;;8.0;KERNEL;**275,425,499**;Jul 10, 1995;Build 14
"RTN","ZOSVGTM",3,0)
 ; for GT.M for VMS, version 4.3
"RTN","ZOSVGTM",4,0)
 ;
"RTN","ZOSVGTM",5,0)
ACTJ() ; # active jobs
"RTN","ZOSVGTM",6,0)
 ;Keep active count in global
"RTN","ZOSVGTM",7,0)
 Q $G(^XUTL("XUSYS","CNT"))
"RTN","ZOSVGTM",8,0)
 ;Long way that would work
"RTN","ZOSVGTM",9,0)
 ;N %IMAGE S %IMAGE=$ZGETJPI($J,"IMAGNAME")
"RTN","ZOSVGTM",10,0)
 ;N Y S Y=0
"RTN","ZOSVGTM",11,0)
 ;N %PID S %PID=0
"RTN","ZOSVGTM",12,0)
 ;F  S %PID=$ZPID(%PID) Q:'%PID  I $ZGETJPI(%PID,"IMAGNAME")=%IMAGE S Y=Y+1
"RTN","ZOSVGTM",13,0)
 ;Q Y
"RTN","ZOSVGTM",14,0)
 ;
"RTN","ZOSVGTM",15,0)
AVJ() ; # available jobs, Limit is in the OS.
"RTN","ZOSVGTM",16,0)
 N V,J
"RTN","ZOSVGTM",17,0)
 S V=^%ZOSF("VOL"),J=$O(^XTV(8989.3,1,4,"B",V,0)),J=$P($G(^XTV(8989.3,1,4,J,0),"^^1000"),"^",3)
"RTN","ZOSVGTM",18,0)
 Q J-$$ACTJ ;Use signon Max
"RTN","ZOSVGTM",19,0)
 ;
"RTN","ZOSVGTM",20,0)
PASSALL ;
"RTN","ZOSVGTM",21,0)
 U $I:(PASTHRU) Q
"RTN","ZOSVGTM",22,0)
NOPASS ;
"RTN","ZOSVGTM",23,0)
 U $I:(NOPASTHRU) Q
"RTN","ZOSVGTM",24,0)
 ;
"RTN","ZOSVGTM",25,0)
GETPEER() ;Get the IP address of a connection peer
"RTN","ZOSVGTM",26,0)
 N PEER
"RTN","ZOSVGTM",27,0)
 S PEER=$ZTRNLNM("VISTA$IP")
"RTN","ZOSVGTM",28,0)
 I $G(^XTV(8989.3,1,"PEER"))[PEER S PEER="" ;p499
"RTN","ZOSVGTM",29,0)
 Q $S($L(PEER):PEER,$L($G(IO("GTM-IP"))):IO("GTM-IP"),1:"")
"RTN","ZOSVGTM",30,0)
 ;
"RTN","ZOSVGTM",31,0)
PRGMODE ;
"RTN","ZOSVGTM",32,0)
 N X,XUCI,XUSLNT
"RTN","ZOSVGTM",33,0)
 W ! S ZTPAC=$P($G(^VA(200,+DUZ,.1)),"^",5),XUVOL=^%ZOSF("VOL")
"RTN","ZOSVGTM",34,0)
 S X="" X ^%ZOSF("EOFF") R:ZTPAC]"" !,"PAC: ",X:60 D LC^XUS X ^%ZOSF("EON") I X'=ZTPAC W "??",$C(7) Q
"RTN","ZOSVGTM",35,0)
 N XMB,XMTEXT,XMY S XMB="XUPROGMODE",XMB(1)=DUZ,XMB(2)=$I D ^XMB:$L($T(^XMB)) D BYE^XUSCLEAN K ZTPAC,X,XMB
"RTN","ZOSVGTM",36,0)
 D UCI S XUCI=Y D PRGM^ZUA
"RTN","ZOSVGTM",37,0)
 F  BREAK
"RTN","ZOSVGTM",38,0)
 HALT
"RTN","ZOSVGTM",39,0)
 ;
"RTN","ZOSVGTM",40,0)
PROGMODE() ; In Application mode
"RTN","ZOSVGTM",41,0)
 Q 0 ; This was used to control UCI switching, has no meaning in GT.M
"RTN","ZOSVGTM",42,0)
 ;
"RTN","ZOSVGTM",43,0)
UCI ;
"RTN","ZOSVGTM",44,0)
 S Y="VAH,"_^%ZOSF("VOL") Q
"RTN","ZOSVGTM",45,0)
 ;
"RTN","ZOSVGTM",46,0)
UCICHECK(X) ;
"RTN","ZOSVGTM",47,0)
 Q 1
"RTN","ZOSVGTM",48,0)
 ;
"RTN","ZOSVGTM",49,0)
TEMP() ; Return path to temp directory
"RTN","ZOSVGTM",50,0)
 ;N %TEMP S %TEMP=$P($$RTNDIR," "),%TEMP=$P(%TEMP,"/",1,$L(%TEMP,"/")-2)_"/t/"
"RTN","ZOSVGTM",51,0)
 Q $G(^%ZOSF("TMP"),$G(^XTV(8989.3,1,"DEV"),"USER$:[TEMP]"))
"RTN","ZOSVGTM",52,0)
 ;
"RTN","ZOSVGTM",53,0)
JOBPAR ;is job X valid on system, return UCI in Y.
"RTN","ZOSVGTM",54,0)
 N $ES,$ET,J S $ET="Q:$ES>0  S Y="""" G JOBPX^%ZOSV"
"RTN","ZOSVGTM",55,0)
 S Y=""
"RTN","ZOSVGTM",56,0)
 S J=$ZGETJPI(X,"PRI")
"RTN","ZOSVGTM",57,0)
 I $L(J) S Y=$P(^%ZOSF("PROD"),",")
"RTN","ZOSVGTM",58,0)
JOBPX S $EC=""
"RTN","ZOSVGTM",59,0)
 Q
"RTN","ZOSVGTM",60,0)
 ;
"RTN","ZOSVGTM",61,0)
SHARELIC(TYPE) ;Used by Cache implementations
"RTN","ZOSVGTM",62,0)
 Q
"RTN","ZOSVGTM",63,0)
 ;
"RTN","ZOSVGTM",64,0)
PRIORITY ;The VA has this disabled in general.
"RTN","ZOSVGTM",65,0)
 Q
"RTN","ZOSVGTM",66,0)
 ;
"RTN","ZOSVGTM",67,0)
PRIINQ() ;
"RTN","ZOSVGTM",68,0)
 N PRI S PRI=$ZGETJPI($J,"PRI")
"RTN","ZOSVGTM",69,0)
 Q $S(PRI=0:1,PRI=1:3,PRI=2:5,PRI=3:7,PRI=4:9,1:10)
"RTN","ZOSVGTM",70,0)
 ;
"RTN","ZOSVGTM",71,0)
BAUD S X="UNKNOWN" Q
"RTN","ZOSVGTM",72,0)
 ;
"RTN","ZOSVGTM",73,0)
LGR() Q $R ; Last global reference ($REFERENCE)
"RTN","ZOSVGTM",74,0)
 ;
"RTN","ZOSVGTM",75,0)
EC() ; Error Code: returning $ZS in format more like $ZE from DSM
"RTN","ZOSVGTM",76,0)
 N %ZE
"RTN","ZOSVGTM",77,0)
 I $ZS="" Q ""
"RTN","ZOSVGTM",78,0)
 S %ZE=$P($ZS,",",2)_","_$P($ZS,",",4)_","_$P($ZS,",")_",-"_$P($ZS,",",3)
"RTN","ZOSVGTM",79,0)
 Q %ZE
"RTN","ZOSVGTM",80,0)
 ;
"RTN","ZOSVGTM",81,0)
DOLRO ;SAVE ENTIRE SYMBOL TABLE IN LOCATION SPECIFIED BY X
"RTN","ZOSVGTM",82,0)
 ;S Y="%" F  S Y=$O(@Y) Q:Y=""  D
"RTN","ZOSVGTM",83,0)
 ;. I $D(@Y)#2 S @(X_"Y)="_Y)
"RTN","ZOSVGTM",84,0)
 ;. I $D(@Y)>9 S %X=Y_"(",%Y=X_"Y," D %XY^%RCR
"RTN","ZOSVGTM",85,0)
 S Y="%" F  M:$D(@Y) @(X_"Y)="_Y) S Y=$O(@Y) Q:Y=""
"RTN","ZOSVGTM",86,0)
 Q
"RTN","ZOSVGTM",87,0)
 ;
"RTN","ZOSVGTM",88,0)
ORDER ;SAVE PART OF SYMBOL TABLE IN LOCATION SPECIFIED BY X
"RTN","ZOSVGTM",89,0)
 N %
"RTN","ZOSVGTM",90,0)
 S (Y,%)=$P(Y,"*",1) ;I $D(@Y)=0 F  S Y=$O(@Y) Q:Y=""!(Y[Y1)
"RTN","ZOSVGTM",91,0)
 Q:Y=""
"RTN","ZOSVGTM",92,0)
 ;S %=$D(@Y) S:%#2 @(X_"Y)="_Y) I %>9 S %X=Y_"(",%Y=X_"Y," D %XY^%RCR
"RTN","ZOSVGTM",93,0)
 ;F  S Y=$O(@Y) Q:Y=""!(Y'[Y1)  S %=$D(@Y) S:%#2 @(X_"Y)="_Y) I %>9 S %X=Y_"(",%Y=X_"Y," D %XY^%RCR
"RTN","ZOSVGTM",94,0)
 F  M:$D(@Y) @(X_"Y)="_Y) S Y=$O(@Y) Q:Y=""!(Y'[%)
"RTN","ZOSVGTM",95,0)
 Q
"RTN","ZOSVGTM",96,0)
 ;
"RTN","ZOSVGTM",97,0)
PARSIZ ;
"RTN","ZOSVGTM",98,0)
 S X=3 Q
"RTN","ZOSVGTM",99,0)
 ;
"RTN","ZOSVGTM",100,0)
NOLOG ;
"RTN","ZOSVGTM",101,0)
 S Y=0 Q
"RTN","ZOSVGTM",102,0)
 ;
"RTN","ZOSVGTM",103,0)
GETENV ;Get environment Return Y='UCI^VOL^NODE^BOX LOOKUP'
"RTN","ZOSVGTM",104,0)
 N %V,%HOST S %HOST=$ZGETSYI("NODENAME"),%V=^%ZOSF("PROD")
"RTN","ZOSVGTM",105,0)
 S Y=$TR(%V,",","^")_"^"_%HOST_"^"_$P(%V,",",2)_":"_%HOST
"RTN","ZOSVGTM",106,0)
 Q
"RTN","ZOSVGTM",107,0)
 ;
"RTN","ZOSVGTM",108,0)
VERSION(X) ;return OS version, X=1 - return OS
"RTN","ZOSVGTM",109,0)
 Q $S($G(X):$P($ZV," V"),1:+$P($ZV," V",2))
"RTN","ZOSVGTM",110,0)
 ;
"RTN","ZOSVGTM",111,0)
OS() ;
"RTN","ZOSVGTM",112,0)
 Q "VMS"
"RTN","ZOSVGTM",113,0)
 ;
"RTN","ZOSVGTM",114,0)
RTNDIR() ;primary routine source directory
"RTN","ZOSVGTM",115,0)
 ;Assume dat1$:[gtm.o]/src=(dat1$:[gtm.r]),gtm$dist
"RTN","ZOSVGTM",116,0)
 N % S %=$P($ZRO,",")
"RTN","ZOSVGTM",117,0)
 I %["/SRC" S %=$P($P($P(%,"(",2),")",1),",")
"RTN","ZOSVGTM",118,0)
 Q %
"RTN","ZOSVGTM",119,0)
 ;
"RTN","ZOSVGTM",120,0)
SETNM(X) ;Set name, Trap dup's, Fall into SETENV
"RTN","ZOSVGTM",121,0)
 N $ETRAP S $ETRAP="S $ECODE="""" Q"
"RTN","ZOSVGTM",122,0)
 ;
"RTN","ZOSVGTM",123,0)
SETENV ;Set environment X='PROCESS NAME^ '
"RTN","ZOSVGTM",124,0)
 ;workaround for GT.M
"RTN","ZOSVGTM",125,0)
 S ^XUTL("XUSYS",$J,0)=$H,^("NM")=X,^("PID")=$$FUNC^%DH($J)
"RTN","ZOSVGTM",126,0)
 Q
"RTN","ZOSVGTM",127,0)
 ;
"RTN","ZOSVGTM",128,0)
SID() ;System ID
"RTN","ZOSVGTM",129,0)
 N J1,T S T="~"
"RTN","ZOSVGTM",130,0)
 S J1(1)=$ZROUTINES
"RTN","ZOSVGTM",131,0)
 S J1(2)=$ZGBLDIR
"RTN","ZOSVGTM",132,0)
 Q "1~"_J1(1)_T_J1(2)
"RTN","ZOSVGTM",133,0)
 ;
"RTN","ZOSVGTM",134,0)
PRI() ;Check if a mixed OS enviroment.
"RTN","ZOSVGTM",135,0)
 ;Default return 1 unless we are on the secondary OS.
"RTN","ZOSVGTM",136,0)
 ;Only Cache on a VMS/Linux mix is supported now.
"RTN","ZOSVGTM",137,0)
 Q 1
"RTN","ZOSVGTM",138,0)
 ;
"RTN","ZOSVGTM",139,0)
T0 ; start RT clock
"RTN","ZOSVGTM",140,0)
 Q
"RTN","ZOSVGTM",141,0)
 ;
"RTN","ZOSVGTM",142,0)
T1 ; store RT datum, Obsolete
"RTN","ZOSVGTM",143,0)
 Q
"RTN","ZOSVGTM",144,0)
 ;
"RTN","ZOSVGTM",145,0)
 ;Code moved to %ZOSVKR, Comment out if needed.
"RTN","ZOSVGTM",146,0)
LOGRSRC(OPT,TYPE,STATUS) ;record resource usage in ^XTMP("KMPR"
"RTN","ZOSVGTM",147,0)
 Q:'$G(^%ZTSCH("LOGRSRC"))  ; quit if RUM not turned on.
"RTN","ZOSVGTM",148,0)
 ; call to RUM routine.
"RTN","ZOSVGTM",149,0)
 D RU^%ZOSVKR($G(OPT),$G(TYPE),$G(STATUS))
"RTN","ZOSVGTM",150,0)
 Q
"RTN","ZOSVGTM",151,0)
 ;
"RTN","ZOSVGTM",152,0)
SETTRM(X) ;Turn on specified terminators.
"RTN","ZOSVGTM",153,0)
 U $I:TERM=X
"RTN","ZOSVGTM",154,0)
 Q 1
"RTN","ZOSVGTM",155,0)
 ;
"RTN","ZOSVGTM",156,0)
DEVOK ;
"RTN","ZOSVGTM",157,0)
 ;INPUT:  X=Device $I, X1=IOT -- X1 needed for resources
"RTN","ZOSVGTM",158,0)
 ;OUTPUT: Y=0 if available, Y=job # if owned
"RTN","ZOSVGTM",159,0)
 ; Y=-1 if device does not exists.
"RTN","ZOSVGTM",160,0)
 ; return Y=0 if not owned, Y=$J of owning job, Y=999 if dev cycling
"RTN","ZOSVGTM",161,0)
 ;
"RTN","ZOSVGTM",162,0)
 S Y=0,X1=$G(X1) Q:(X1="HFS")!(X1="MT")!(X1="CHAN")
"RTN","ZOSVGTM",163,0)
 I X1="RES" G RESOK^%ZIS6
"RTN","ZOSVGTM",164,0)
 S Y=0
"RTN","ZOSVGTM",165,0)
 Q  ;Let ZIS deal with it.
"RTN","ZOSVGTM",166,0)
 ;
"RTN","ZOSVGTM",167,0)
 Q
"RTN","ZOSVGTM",168,0)
LPC(X) ;ZCRC(X)
"RTN","ZOSVGTM",169,0)
 N R,I
"RTN","ZOSVGTM",170,0)
 S R=$ZBITSTR(8,0)
"RTN","ZOSVGTM",171,0)
 F I=1:1:$L(X) S R=$ZBITXOR(R,$C(0)_$E(X,I))
"RTN","ZOSVGTM",172,0)
 Q $A(R,2)
"RTN","ZOSVGUX")
0^14^B33819105^B36401450
"RTN","ZOSVGUX",1,0)
%ZOSV ;SFISC/AC,PUG/TOAD,HOU/DHW - View commands & special functions. ;09/15/08  16:41
"RTN","ZOSVGUX",2,0)
 ;;8.0;KERNEL;**275,425,499**;Jul 10, 1995;Build 14
"RTN","ZOSVGUX",3,0)
 ;
"RTN","ZOSVGUX",4,0)
ACTJ() ; # active jobs
"RTN","ZOSVGUX",5,0)
 I $G(^XUTL("XUSYS","CNT")) Q $G(^XUTL("XUSYS","CNT"))
"RTN","ZOSVGUX",6,0)
 ;This would also work
"RTN","ZOSVGUX",7,0)
 N %I,%FILE,Y
"RTN","ZOSVGUX",8,0)
 S %FILE=$$TEMP_"zosv_actj_"_$J_".tmp"
"RTN","ZOSVGUX",9,0)
 ZSYSTEM "ps cef -C mumps|wc>"_%FILE
"RTN","ZOSVGUX",10,0)
 S %I=$I
"RTN","ZOSVGUX",11,0)
 O %FILE
"RTN","ZOSVGUX",12,0)
 U %FILE R Y:99 U %I
"RTN","ZOSVGUX",13,0)
 C %FILE:DELETE
"RTN","ZOSVGUX",14,0)
 F  Q:$E(Y)'=" "  S $E(Y)=""
"RTN","ZOSVGUX",15,0)
 S Y=Y-1,^XUTL("XUSYS","CNT")=Y
"RTN","ZOSVGUX",16,0)
 Q Y
"RTN","ZOSVGUX",17,0)
 ;
"RTN","ZOSVGUX",18,0)
AVJ() ; # available jobs, Limit is in the OS.
"RTN","ZOSVGUX",19,0)
 N V,J
"RTN","ZOSVGUX",20,0)
 S V=^%ZOSF("VOL"),J=$O(^XTV(8989.3,1,4,"B",V,0)),J=$P($G(^XTV(8989.3,1,4,J,0),"^^1000"),"^",3)
"RTN","ZOSVGUX",21,0)
 Q J-$$ACTJ ;Use signon Max
"RTN","ZOSVGUX",22,0)
 ;
"RTN","ZOSVGUX",23,0)
RTNDIR() ; primary routine source directory
"RTN","ZOSVGUX",24,0)
 ;Assume /home/xxx/o(/home/xxx/r /home/xxx/w) /home/gtm()
"RTN","ZOSVGUX",25,0)
 Q $P($S($ZRO["(":$P($P($ZRO,"(",2),")"),1:$ZRO)," ")_"/"
"RTN","ZOSVGUX",26,0)
 ;
"RTN","ZOSVGUX",27,0)
TEMP() ; Return path to temp directory
"RTN","ZOSVGUX",28,0)
 ;N %TEMP S %TEMP=$P($$RTNDIR," "),%TEMP=$P(%TEMP,"/",1,$L(%TEMP,"/")-2)_"/t/"
"RTN","ZOSVGUX",29,0)
 Q $G(^%ZOSF("TMP"),$G(^XTV(8989.3,1,"DEV"),"/tmp/"))
"RTN","ZOSVGUX",30,0)
 ;
"RTN","ZOSVGUX",31,0)
PASSALL ;
"RTN","ZOSVGUX",32,0)
 U $I:(NOESCAPE:NOTERMINATOR:PASTHRU) Q
"RTN","ZOSVGUX",33,0)
NOPASS ;
"RTN","ZOSVGUX",34,0)
 U $I:(ESCAPE:TERMINATOR="":NOPASTHRU) Q
"RTN","ZOSVGUX",35,0)
 ;
"RTN","ZOSVGUX",36,0)
GETPEER() ;Get the IP address of a connection peer
"RTN","ZOSVGUX",37,0)
 N PEER
"RTN","ZOSVGUX",38,0)
 S PEER=$P($ZTRNLNM("SSH_CLIENT")," ") S:PEER="" PEER=$ZTRNLNM("REMOTEHOST")
"RTN","ZOSVGUX",39,0)
 S PEER=$S($L(PEER):PEER,$L($G(IO("IP"))):IO("IP"),$L($G(IO("GTM-IP"))):IO("GTM-IP"),1:"")
"RTN","ZOSVGUX",40,0)
 I $G(^XTV(8989.3,1,"PEER"))[PEER S PEER="" ;p499
"RTN","ZOSVGUX",41,0)
 Q PEER
"RTN","ZOSVGUX",42,0)
 ;
"RTN","ZOSVGUX",43,0)
PRGMODE ;Drop into direct mode
"RTN","ZOSVGUX",44,0)
 N X,XUCI,XUSLNT
"RTN","ZOSVGUX",45,0)
 W ! S ZTPAC=$P($G(^VA(200,+DUZ,.1)),"^",5),XUVOL=^%ZOSF("VOL")
"RTN","ZOSVGUX",46,0)
 S X="" X ^%ZOSF("EOFF") R:ZTPAC]"" !,"PAC: ",X:60 D LC^XUS X ^%ZOSF("EON") I X'=ZTPAC W "??",$C(7) Q
"RTN","ZOSVGUX",47,0)
 N XMB,XMTEXT,XMY S XMB="XUPROGMODE",XMB(1)=DUZ,XMB(2)=$I D ^XMB:$L($T(^XMB)) D BYE^XUSCLEAN K ZTPAC,X,XMB
"RTN","ZOSVGUX",48,0)
 D UCI S XUCI=Y D PRGM^ZUA
"RTN","ZOSVGUX",49,0)
 F  BREAK
"RTN","ZOSVGUX",50,0)
 HALT
"RTN","ZOSVGUX",51,0)
 ;
"RTN","ZOSVGUX",52,0)
PROGMODE() ; In Application mode
"RTN","ZOSVGUX",53,0)
 Q 0 ; This was used to control UCI switching, has no meaning in GT.M
"RTN","ZOSVGUX",54,0)
 ;
"RTN","ZOSVGUX",55,0)
UCI ;
"RTN","ZOSVGUX",56,0)
 S Y=^%ZOSF("PROD") Q
"RTN","ZOSVGUX",57,0)
 ;
"RTN","ZOSVGUX",58,0)
UCICHECK(X) ;
"RTN","ZOSVGUX",59,0)
 Q X
"RTN","ZOSVGUX",60,0)
 ;
"RTN","ZOSVGUX",61,0)
JOBPAR ; <=====
"RTN","ZOSVGUX",62,0)
 N %FILE,%I S %FILE=$$PWD^%ZISH_"zosv_jobpar_"_$J_".tmp"
"RTN","ZOSVGUX",63,0)
 ZSYSTEM "ps c -p "_X_"|tail -1>"_%FILE
"RTN","ZOSVGUX",64,0)
 S %I=$I
"RTN","ZOSVGUX",65,0)
 O %FILE
"RTN","ZOSVGUX",66,0)
 U %FILE R Y:99 U %I
"RTN","ZOSVGUX",67,0)
 C %FILE:DELETE
"RTN","ZOSVGUX",68,0)
 F  Q:$E(Y)'=" "  S $E(Y)=""
"RTN","ZOSVGUX",69,0)
 I +Y=X,$E(Y,$L(Y)-4,$L(Y))="mumps" S Y=^%ZOSF("PROD")
"RTN","ZOSVGUX",70,0)
 E  S Y=""
"RTN","ZOSVGUX",71,0)
 Q
"RTN","ZOSVGUX",72,0)
 ;
"RTN","ZOSVGUX",73,0)
SHARELIC(TYPE) ;Used by Cache implementations
"RTN","ZOSVGUX",74,0)
 Q
"RTN","ZOSVGUX",75,0)
 ;
"RTN","ZOSVGUX",76,0)
PRIORITY ;
"RTN","ZOSVGUX",77,0)
 K Y ; VA has this disabled in general.
"RTN","ZOSVGUX",78,0)
 Q
"RTN","ZOSVGUX",79,0)
 ;
"RTN","ZOSVGUX",80,0)
PRIINQ() ;
"RTN","ZOSVGUX",81,0)
 Q 5 ; for now, we're always middle of the road
"RTN","ZOSVGUX",82,0)
 ;
"RTN","ZOSVGUX",83,0)
BAUD S X="UNKNOWN"
"RTN","ZOSVGUX",84,0)
 Q
"RTN","ZOSVGUX",85,0)
 ;
"RTN","ZOSVGUX",86,0)
LGR() ; Last global reference ($REFERENCE)
"RTN","ZOSVGUX",87,0)
 Q $R
"RTN","ZOSVGUX",88,0)
 ;
"RTN","ZOSVGUX",89,0)
EC() ; Error Code: returning $ZS in format more like $ZE from DSM
"RTN","ZOSVGUX",90,0)
 N %ZE
"RTN","ZOSVGUX",91,0)
 I $ZS="" S %ZE=""
"RTN","ZOSVGUX",92,0)
 S %ZE=$P($ZS,",",2)_","_$P($ZS,",",4)_","_$P($ZS,",")_",-"_$P($ZS,",",3)
"RTN","ZOSVGUX",93,0)
 Q %ZE
"RTN","ZOSVGUX",94,0)
 ;
"RTN","ZOSVGUX",95,0)
DOLRO ;SAVE ENTIRE SYMBOL TABLE IN LOCATION SPECIFIED BY X
"RTN","ZOSVGUX",96,0)
 ;S Y="%" F  S Y=$O(@Y) Q:Y=""  D
"RTN","ZOSVGUX",97,0)
 ;. I $D(@Y)#2 S @(X_"Y)="_Y)
"RTN","ZOSVGUX",98,0)
 ;. I $D(@Y)>9 S %X=Y_"(",%Y=X_"Y," D %XY^%RCR
"RTN","ZOSVGUX",99,0)
 S Y="%" F  M:$D(@Y) @(X_"Y)="_Y) S Y=$O(@Y) Q:Y=""
"RTN","ZOSVGUX",100,0)
 Q
"RTN","ZOSVGUX",101,0)
 ;
"RTN","ZOSVGUX",102,0)
ORDER ;SAVE PART OF SYMBOL TABLE IN LOCATION SPECIFIED BY X
"RTN","ZOSVGUX",103,0)
 N %
"RTN","ZOSVGUX",104,0)
 S (Y,%)=$P(Y,"*",1) ;I $D(@Y)=0 F  S Y=$O(@Y) Q:Y=""!(Y[Y1)
"RTN","ZOSVGUX",105,0)
 Q:Y=""
"RTN","ZOSVGUX",106,0)
 ;S %=$D(@Y) S:%#2 @(X_"Y)="_Y) I %>9 S %X=Y_"(",%Y=X_"Y," D %XY^%RCR
"RTN","ZOSVGUX",107,0)
 ;F  S Y=$O(@Y) Q:Y=""!(Y'[Y1)  S %=$D(@Y) S:%#2 @(X_"Y)="_Y) I %>9 S %X=Y_"(",%Y=X_"Y," D %XY^%RCR
"RTN","ZOSVGUX",108,0)
 F  M:$D(@Y) @(X_"Y)="_Y) S Y=$O(@Y) Q:Y=""!(Y'[%)
"RTN","ZOSVGUX",109,0)
 Q
"RTN","ZOSVGUX",110,0)
 ;
"RTN","ZOSVGUX",111,0)
PARSIZ ;
"RTN","ZOSVGUX",112,0)
 S X=3 Q
"RTN","ZOSVGUX",113,0)
 ;
"RTN","ZOSVGUX",114,0)
NOLOG ;
"RTN","ZOSVGUX",115,0)
 S Y=0 Q
"RTN","ZOSVGUX",116,0)
 ;
"RTN","ZOSVGUX",117,0)
GETENV ;Get environment Return Y='UCI^VOL^NODE^BOX LOOKUP'
"RTN","ZOSVGUX",118,0)
 N %HOST,%V S %V=^%ZOSF("PROD"),%HOST=$$RETURN("hostname -s")
"RTN","ZOSVGUX",119,0)
 S Y=$TR(%V,",","^")_"^"_%HOST_"^"_$P(%V,",",2)_":"_%HOST
"RTN","ZOSVGUX",120,0)
 Q
"RTN","ZOSVGUX",121,0)
 ;
"RTN","ZOSVGUX",122,0)
VERSION(X) ;return OS version, X=1 - return OS
"RTN","ZOSVGUX",123,0)
 Q $S($G(X):$P($ZV," V"),1:+$P($ZV," V",2))
"RTN","ZOSVGUX",124,0)
 ;
"RTN","ZOSVGUX",125,0)
OS() ;
"RTN","ZOSVGUX",126,0)
 Q "UNIX"
"RTN","ZOSVGUX",127,0)
 ;
"RTN","ZOSVGUX",128,0)
SETNM(X) ;Set name, Trap dup's, Fall into SETENV
"RTN","ZOSVGUX",129,0)
 N $ETRAP S $ETRAP="S $ECODE="""" Q"
"RTN","ZOSVGUX",130,0)
SETENV ;Set environment X='PROCESS NAME^ '
"RTN","ZOSVGUX",131,0)
 S ^XUTL("XUSYS",$J,0)=$H,^("NM")=X ; workaround
"RTN","ZOSVGUX",132,0)
 Q
"RTN","ZOSVGUX",133,0)
 ;
"RTN","ZOSVGUX",134,0)
SID() ;System ID
"RTN","ZOSVGUX",135,0)
 N J1,T S T="~"
"RTN","ZOSVGUX",136,0)
 S J1(1)=$ZROUTINES,J1(1)=$P(J1(1)," ")
"RTN","ZOSVGUX",137,0)
 S J1(2)=$ZGBLDIR
"RTN","ZOSVGUX",138,0)
 Q "1~"_J1(1)_T_J1(2)
"RTN","ZOSVGUX",139,0)
 ;
"RTN","ZOSVGUX",140,0)
PRI() ;Check if a mixed OS enviroment.
"RTN","ZOSVGUX",141,0)
 ;Default return 1 unless we are on the secondary OS.
"RTN","ZOSVGUX",142,0)
 ;Only Cache on a VMS/Linux mix is supported now.
"RTN","ZOSVGUX",143,0)
 Q 1
"RTN","ZOSVGUX",144,0)
 ;
"RTN","ZOSVGUX",145,0)
T0 ; start RT clock
"RTN","ZOSVGUX",146,0)
 Q  ; we don't have $ZH on GT.M
"RTN","ZOSVGUX",147,0)
 ;
"RTN","ZOSVGUX",148,0)
T1 ; store RT datum w/ZHDIF
"RTN","ZOSVGUX",149,0)
 Q  ; we don't have $ZH on GT.M
"RTN","ZOSVGUX",150,0)
 ;
"RTN","ZOSVGUX",151,0)
ZHDIF ;Display dif of two $ZH's
"RTN","ZOSVGUX",152,0)
 W !," ET=",$J(($P(%ZH1,",")-$P(%ZH0,",")*86400)+($P(%ZH1,",",2)-$P(%ZH0,",",2)),6,2)
"RTN","ZOSVGUX",153,0)
 Q
"RTN","ZOSVGUX",154,0)
 ;
"RTN","ZOSVGUX",155,0)
 ;Code moved to %ZOSVKR, Comment out if needed.
"RTN","ZOSVGUX",156,0)
LOGRSRC(OPT,TYPE,STATUS) ;record resource usage in ^XTMP("KMPR"
"RTN","ZOSVGUX",157,0)
 Q:'$G(^%ZTSCH("LOGRSRC"))  ; quit if RUM not turned on.
"RTN","ZOSVGUX",158,0)
 ; call to RUM routine.
"RTN","ZOSVGUX",159,0)
 D RU^%ZOSVKR($G(OPT),$G(TYPE),$G(STATUS))
"RTN","ZOSVGUX",160,0)
 Q
"RTN","ZOSVGUX",161,0)
 ;
"RTN","ZOSVGUX",162,0)
SETTRM(X) ;Turn on specified terminators.
"RTN","ZOSVGUX",163,0)
 U $I:(TERMINATOR=X)
"RTN","ZOSVGUX",164,0)
 Q 1
"RTN","ZOSVGUX",165,0)
 ;
"RTN","ZOSVGUX",166,0)
DEVOK ;
"RTN","ZOSVGUX",167,0)
 ;use lsof (list open files)
"RTN","ZOSVGUX",168,0)
 ; given a device name in X
"RTN","ZOSVGUX",169,0)
 ;INPUT:  X=Device $I, X1=IOT -- X1 needed for resources
"RTN","ZOSVGUX",170,0)
 ;OUTPUT: Y=0 if available, Y=job # if owned
"RTN","ZOSVGUX",171,0)
 ; Y=-1 if device does not exists.
"RTN","ZOSVGUX",172,0)
 ; return Y=0 if not owned, Y=$J of owning job, Y=999 if dev cycling
"RTN","ZOSVGUX",173,0)
 ;
"RTN","ZOSVGUX",174,0)
 I $G(X1)="RES" G RESOK^%ZIS6
"RTN","ZOSVGUX",175,0)
 S Y=0
"RTN","ZOSVGUX",176,0)
 Q  ;Let ZIS deal with it.
"RTN","ZOSVGUX",177,0)
 ;
"RTN","ZOSVGUX",178,0)
 N %FILE S %FILE=$$TEMP_"zosv_devok_"_$J_".tmp"
"RTN","ZOSVGUX",179,0)
 ZSYSTEM "/usr/sbin/lsof -F Pc "_X_" >"_%FILE
"RTN","ZOSVGUX",180,0)
 N %I,%X,%Y S %I=$I
"RTN","ZOSVGUX",181,0)
 O %FILE U %FILE
"RTN","ZOSVGUX",182,0)
 F %Y=0:1 R %X:99 Q:%X=""  Q:%X["lsof: status error"  D
"RTN","ZOSVGUX",183,0)
 . S %Y(%Y\2,$S($E(%X)="p":"PID",$E(%X)="c":"CMD",1:"?"))=$E(%X,2,$L(%X))
"RTN","ZOSVGUX",184,0)
 U %I
"RTN","ZOSVGUX",185,0)
 C %FILE:(DELETE)
"RTN","ZOSVGUX",186,0)
 I %X["lsof: status error" S Y=-1 Q
"RTN","ZOSVGUX",187,0)
 S %X="",Y=0
"RTN","ZOSVGUX",188,0)
 F  S %X=$O(%Y(%X)) Q:%X=""  I %Y(%X,"CMD")="mumps" S Y=%Y(%X,"PID") Q
"RTN","ZOSVGUX",189,0)
 Q
"RTN","ZOSVGUX",190,0)
 ;
"RTN","ZOSVGUX",191,0)
DEVOPN ;List of Devices opened.  Linux only
"RTN","ZOSVGUX",192,0)
 ;Returns variable Y. Y=Devices owned separated by a comma
"RTN","ZOSVGUX",193,0)
 N %I,%X,%Y
"RTN","ZOSVGUX",194,0)
 ZSHOW "D":%Y
"RTN","ZOSVGUX",195,0)
 S %I=0,Y="",%X=""
"RTN","ZOSVGUX",196,0)
 F  S %I=$O(%Y("D",%I)) Q:'%I  S Y=Y_%X_$P(%Y("D",%I)," "),%X=","
"RTN","ZOSVGUX",197,0)
 Q
"RTN","ZOSVGUX",198,0)
 ;
"RTN","ZOSVGUX",199,0)
RETURN(%COMMAND) ; ** Private Entry Point: execute a shell command & return the resulting value **
"RTN","ZOSVGUX",200,0)
 ; %COMMAND is the string value of the Linux command
"RTN","ZOSVGUX",201,0)
 N %VALUE S %VALUE="" ; value to return
"RTN","ZOSVGUX",202,0)
 N %FILE S %FILE=$$TEMP_"RET"_$J_".txt" ; temporary results file
"RTN","ZOSVGUX",203,0)
 ZSYSTEM %COMMAND_" > "_%FILE ; execute command & save result
"RTN","ZOSVGUX",204,0)
 O %FILE:(REWIND) U %FILE R:'$ZEOF %VALUE:99 C %FILE:(DELETE) ; fetch value & delete file
"RTN","ZOSVGUX",205,0)
 ;
"RTN","ZOSVGUX",206,0)
 QUIT %VALUE ; return value
"RTN","ZOSVGUX",207,0)
 ;
"RTN","ZOSVGUX",208,0)
 ;
"RTN","ZOSVGUX",209,0)
STRIPCR(%DIRECT) ; ** Private Entry Point: strip extraneous CR from end of lines of all
"RTN","ZOSVGUX",210,0)
 ; routines in %DIRECTORY Linux directory
"RTN","ZOSVGUX",211,0)
 ;
"RTN","ZOSVGUX",212,0)
 ZSYSTEM "perl -pi -e 's/\r\n$/\n/' "_%DIRECT_"[A-K]*.m"
"RTN","ZOSVGUX",213,0)
 ZSYSTEM "perl -pi -e 's/\r\n$/\n/' "_%DIRECT_"[L-S]*.m"
"RTN","ZOSVGUX",214,0)
 ZSYSTEM "perl -pi -e 's/\r\n$/\n/' "_%DIRECT_"[T-z]*.m"
"RTN","ZOSVGUX",215,0)
 ZSYSTEM "perl -pi -e 's/\r\n$/\n/' "_%DIRECT_"[_]*.m"
"RTN","ZOSVGUX",216,0)
 Q
"RTN","ZOSVGUX",217,0)
 ;
"RTN","ZOSVONT")
0^11^B22340698^B22002850
"RTN","ZOSVONT",1,0)
%ZOSV ;SFISC/AC - $View commands for Open M for NT.  ;09/15/08  12:12
"RTN","ZOSVONT",2,0)
 ;;8.0;KERNEL;**34,94,107,118,136,215,293,284,385,425,440,499**;Jul 10, 1995;Build 14
"RTN","ZOSVONT",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified
"RTN","ZOSVONT",4,0)
ACTJ() ;# Active jobs
"RTN","ZOSVONT",5,0)
 N %,V,Y S V=$$VERSION()
"RTN","ZOSVONT",6,0)
 I V<5 D  Q Y
"RTN","ZOSVONT",7,0)
 . S %=0 F Y=0:1 S %=$ZJOB(%) Q:%=""
"RTN","ZOSVONT",8,0)
 S Y=$system.License.LUConsumed() ;Cache 5 up
"RTN","ZOSVONT",9,0)
 Q Y
"RTN","ZOSVONT",10,0)
AVJ() ;# available jobs
"RTN","ZOSVONT",11,0)
 N %,AVJ,V,ZOSV,$ET
"RTN","ZOSVONT",12,0)
 S V=+$$VERSION()
"RTN","ZOSVONT",13,0)
 ;Cache 3 and 4
"RTN","ZOSVONT",14,0)
 ;maxpid: from %SS
"RTN","ZOSVONT",15,0)
 I V<5 D  Q AVJ
"RTN","ZOSVONT",16,0)
 . N PORT,T,X,MAXPID,LMFLIM
"RTN","ZOSVONT",17,0)
 . S $ET="",MAXPID=$V($ZU(40,2,118),-2,4)
"RTN","ZOSVONT",18,0)
 . X "S ZOSV=$ZU(5),%=$ZU(5,""%SYS"") S LMFLIM=$$inquire^LMFCLI,%=$ZU(5,ZOSV)" ;Get the license info
"RTN","ZOSVONT",19,0)
 . ;Add together the enterprise and division licenses avaliable
"RTN","ZOSVONT",20,0)
 . S X=$P(LMFLIM,";",2)+$P($P(LMFLIM,"|",2),";",2)
"RTN","ZOSVONT",21,0)
 . S T=+LMFLIM+$P(LMFLIM,"|",2) ;Check the license total
"RTN","ZOSVONT",22,0)
 . S AVJ=$S(T<MAXPID:X,1:MAXPID-$$ACTJ) ;Return the smaller of license or pid
"RTN","ZOSVONT",23,0)
 ;To get available jobs from Cache 5.0 up
"RTN","ZOSVONT",24,0)
 I V'<5 D  Q AVJ
"RTN","ZOSVONT",25,0)
 . X "S AVJ=$system.License.LUAvailable()"
"RTN","ZOSVONT",26,0)
 ;Return fixed value not known version
"RTN","ZOSVONT",27,0)
 Q 15
"RTN","ZOSVONT",28,0)
 ;
"RTN","ZOSVONT",29,0)
PRIINQ() ;
"RTN","ZOSVONT",30,0)
 Q 8
"RTN","ZOSVONT",31,0)
 ;
"RTN","ZOSVONT",32,0)
UCI ;Current UCI,VOL
"RTN","ZOSVONT",33,0)
 S Y=$ZU(5)_","_^%ZOSF("VOL") Q
"RTN","ZOSVONT",34,0)
 ;
"RTN","ZOSVONT",35,0)
UCICHECK(X) ;Check if valid namespace (UCI)
"RTN","ZOSVONT",36,0)
 N Y,%
"RTN","ZOSVONT",37,0)
 S %=$P(X,",",1),Y=0 I $ZU(90,10,%) S Y=%
"RTN","ZOSVONT",38,0)
 Q Y
"RTN","ZOSVONT",39,0)
 ;
"RTN","ZOSVONT",40,0)
GETPEER() ;Get the PEER tcp/ip address
"RTN","ZOSVONT",41,0)
 N PEER,NL,$ET S NL="",PEER="",$ET="S $EC=NL Q NL"
"RTN","ZOSVONT",42,0)
 I $$OS="VMS" S PEER=$ZF("TRNLNM","VISTA$IP")
"RTN","ZOSVONT",43,0)
 I '$L(PEER) S PEER=$ZU(111,0) S:$L(PEER) PEER=$A(PEER,1)_"."_$A(PEER,2)_"."_$A(PEER,3)_"."_$A(PEER,4)
"RTN","ZOSVONT",44,0)
 I $G(^XTV(8989.3,1,"PEER"))[PEER S PEER="" ;p499
"RTN","ZOSVONT",45,0)
 Q PEER
"RTN","ZOSVONT",46,0)
 ;
"RTN","ZOSVONT",47,0)
SHARELIC(TYPE) ;See if can share a C/S license
"RTN","ZOSVONT",48,0)
 ;Per Sandy Waal 10/18/2003: With Cache 5.0, your telnet and IP connections are now handled properly.
"RTN","ZOSVONT",49,0)
 ;N %,%N,%2,UID,%V,$ET S $ET="S $EC="""" Q",%V=$$VERSION()
"RTN","ZOSVONT",50,0)
 ;I %V'<5 Q
"RTN","ZOSVONT",51,0)
 ;Type is 1 for C/S and 0 for Telnet
"RTN","ZOSVONT",52,0)
 ;I %V<3.1 X:TYPE "S %N=$ZU(5),%2=$ZU(5,""%SYS""),%2=$$GetLic^LMFCLI,%N=$ZU(5,%N)" Q
"RTN","ZOSVONT",53,0)
 ;I %V<5 S:TYPE %=$$GetCSLic^%LICENSE S:'TYPE %=$$ShareLic^%LICENSE
"RTN","ZOSVONT",54,0)
 ;S $EC=""
"RTN","ZOSVONT",55,0)
 Q
"RTN","ZOSVONT",56,0)
 ;
"RTN","ZOSVONT",57,0)
JOBPAR ;See if X points to a valid Job. Return its UCI.
"RTN","ZOSVONT",58,0)
 N NL,$ET S Y="",NL="",$ET="S $EC=NL Q"
"RTN","ZOSVONT",59,0)
 I $D(^$JOB(X)) S Y=$V(-1,X),Y=$P(Y,"^",14)_","_^%ZOSF("VOL")
"RTN","ZOSVONT",60,0)
 Q
"RTN","ZOSVONT",61,0)
 ;
"RTN","ZOSVONT",62,0)
NOLOG ;4096 is switch 12 - sign on inhibited.
"RTN","ZOSVONT",63,0)
 S Y="$V(0,-2,4)\4096#2" Q
"RTN","ZOSVONT",64,0)
 ;
"RTN","ZOSVONT",65,0)
PROGMODE() ;Check if in PROG mode
"RTN","ZOSVONT",66,0)
 Q $ZJOB#2
"RTN","ZOSVONT",67,0)
 ;
"RTN","ZOSVONT",68,0)
PRGMODE ;
"RTN","ZOSVONT",69,0)
 N X,XMB,XQZ,XUCI,XUSLNT,XUVOL,Y,ZTPAC
"RTN","ZOSVONT",70,0)
 W ! S ZTPAC=$S('$D(^VA(200,+DUZ,.1)):"",1:$P(^(.1),U,5)),XUVOL=^%ZOSF("VOL")
"RTN","ZOSVONT",71,0)
 S X="" X ^%ZOSF("EOFF") R:ZTPAC]"" !,"PAC: ",X:60 D LC^XUS X ^%ZOSF("EON") I X'=ZTPAC W "??"_$C(7) Q
"RTN","ZOSVONT",72,0)
 S XMB="XUPROGMODE",XMB(1)=DUZ,XMB(2)=$I D ^XMB:$L($T(^XMB)) D BYE^XUSCLEAN K ZTPAC,X,XMB
"RTN","ZOSVONT",73,0)
 D UCI S XUCI=Y,XQZ="PRGM^ZUA[MGR]",XUSLNT=1 D DO^%XUCI D ^%PMODE U $I:(:"+B+C+R") S $ZT="" Q
"RTN","ZOSVONT",74,0)
 Q
"RTN","ZOSVONT",75,0)
LGR() ;Last Global ref.
"RTN","ZOSVONT",76,0)
 N $ET,NL S NL="",$ET="S $EC=NL Q NL"
"RTN","ZOSVONT",77,0)
 Q $ZR
"RTN","ZOSVONT",78,0)
 ;
"RTN","ZOSVONT",79,0)
EC() ;Error code
"RTN","ZOSVONT",80,0)
 Q $ZE
"RTN","ZOSVONT",81,0)
 ;
"RTN","ZOSVONT",82,0)
DOLRO ;SAVE ENTIRE SYMBOL TABLE IN LOCATION SPECIFIED BY X
"RTN","ZOSVONT",83,0)
 ;S Y="%" F  S Y=$O(@Y) Q:Y=""  D
"RTN","ZOSVONT",84,0)
 ;. I $D(@Y)#2 S @(X_"Y)="_Y)
"RTN","ZOSVONT",85,0)
 ;. I $D(@Y)>9 S %X=Y_"(",%Y=X_"Y," D %XY^%RCR
"RTN","ZOSVONT",86,0)
 S Y="%" F  M:$D(@Y) @(X_"Y)="_Y) S Y=$O(@Y) Q:Y=""
"RTN","ZOSVONT",87,0)
 Q
"RTN","ZOSVONT",88,0)
 ;
"RTN","ZOSVONT",89,0)
ORDER ;SAVE PART OF SYMBOL TABLE IN LOCATION SPECIFIED BY X
"RTN","ZOSVONT",90,0)
 N %
"RTN","ZOSVONT",91,0)
 S (Y,%)=$P(Y,"*",1) ;I $D(@Y)=0 F  S Y=$O(@Y) Q:Y=""!(Y[Y1)
"RTN","ZOSVONT",92,0)
 Q:Y=""
"RTN","ZOSVONT",93,0)
 ;S %=$D(@Y) S:%#2 @(X_"Y)="_Y) I %>9 S %X=Y_"(",%Y=X_"Y," D %XY^%RCR
"RTN","ZOSVONT",94,0)
 ;F  S Y=$O(@Y) Q:Y=""!(Y'[Y1)  S %=$D(@Y) S:%#2 @(X_"Y)="_Y) I %>9 S %X=Y_"(",%Y=X_"Y," D %XY^%RCR
"RTN","ZOSVONT",95,0)
 F  M:$D(@Y) @(X_"Y)="_Y) S Y=$O(@Y) Q:Y=""!(Y'[%)
"RTN","ZOSVONT",96,0)
 Q
"RTN","ZOSVONT",97,0)
 ;
"RTN","ZOSVONT",98,0)
PARSIZ ;Old and not used.
"RTN","ZOSVONT",99,0)
 S X=3
"RTN","ZOSVONT",100,0)
 Q
"RTN","ZOSVONT",101,0)
 ;
"RTN","ZOSVONT",102,0)
DEVOPN ;List of Devices opened, Not used
"RTN","ZOSVONT",103,0)
 ;Returns variable Y. Y=Devices owned separated by a comma
"RTN","ZOSVONT",104,0)
 Q
"RTN","ZOSVONT",105,0)
 ;
"RTN","ZOSVONT",106,0)
DEVOK ;
"RTN","ZOSVONT",107,0)
 S Y=0,X1=$G(X1) Q:X=2  Q:(X1="HFS")!(X1="SPL")!(X1="MT")!(X1="CHAN")  ;Quit w/ OK for HFS, Spool, MT, TCP/IP
"RTN","ZOSVONT",108,0)
 G:X1="RES" RESOK^%ZIS6
"RTN","ZOSVONT",109,0)
 N $ET S $ET="D OPNERR Q"
"RTN","ZOSVONT",110,0)
 O X::$S($D(%ZISTO):%ZISTO,1:0) E  S Y=999 Q  ;G NOPN
"RTN","ZOSVONT",111,0)
 S Y=0 I '$D(%ZISCHK)!($G(%ZIS)["T") C X Q
"RTN","ZOSVONT",112,0)
 S:X]"" IO(1,X)="" Q
"RTN","ZOSVONT",113,0)
 Q
"RTN","ZOSVONT",114,0)
 ;
"RTN","ZOSVONT",115,0)
OPNERR S $EC="",Y=-1 Q
"RTN","ZOSVONT",116,0)
 ;
"RTN","ZOSVONT",117,0)
GETENV ;Get environment  (UCI^VOL^NODE^BOX:VOLUME)
"RTN","ZOSVONT",118,0)
 N %,%1 S %=$$VERSION,%1=$ZU(86),%1=$S(%<3.1:$P(%1,"*",3),1:$P(%1,"*",2))
"RTN","ZOSVONT",119,0)
 D UCI S Y=$P(Y,",")_"^"_^%ZOSF("VOL")_"^"_$ZU(110)_"^"_^%ZOSF("VOL")_":"_%1
"RTN","ZOSVONT",120,0)
 Q
"RTN","ZOSVONT",121,0)
VERSION(X) ;return Cache version, X=1 - return full name
"RTN","ZOSVONT",122,0)
 Q $S($G(X):$P($ZV,")")_")",1:$P($P($ZV,") ",2),"("))
"RTN","ZOSVONT",123,0)
 ;
"RTN","ZOSVONT",124,0)
OS() ;Return the OS NT, VMS, Unix
"RTN","ZOSVONT",125,0)
 Q $S($ZV["VMS":"VMS",$ZV["UNIX":"UNIX",$ZV["Linux":"UNIX",$ZV["Windows":"NT",$ZV["NT":"NT",1:"UNK")
"RTN","ZOSVONT",126,0)
 ;
"RTN","ZOSVONT",127,0)
SETNM(X) ;Set name, Fall into SETENV
"RTN","ZOSVONT",128,0)
SETENV ;Set environment
"RTN","ZOSVONT",129,0)
 N Q,$ET,$ES S $ET="S $EC="""" Q"
"RTN","ZOSVONT",130,0)
 I $$OS="VMS" S Q=$ZF("SETPRN",$E(X,1,15))
"RTN","ZOSVONT",131,0)
 Q
"RTN","ZOSVONT",132,0)
 ;
"RTN","ZOSVONT",133,0)
SID() ;System ID Ver 1
"RTN","ZOSVONT",134,0)
 N %1,%2,%3,%4,%5,T S T="~"
"RTN","ZOSVONT",135,0)
 S %1=$ZU(5) ;namespace
"RTN","ZOSVONT",136,0)
 S %2=$ZU(12,"") ;directory
"RTN","ZOSVONT",137,0)
 I '$L(%2),$$VERSION'<5.2 S %2=$$defdir^%SYS.GLO(%1) ;remote directory
"RTN","ZOSVONT",138,0)
 S %3=$G(^XTV(8989.3,1,"SID")),%4=$P(%3,"^",4),%5=$P(%3,"^",5)
"RTN","ZOSVONT",139,0)
 I $L(%4),$L(%5),%2[%4 S %2=$P(%2,%4)_%5_$P(%2,%4,2,9)
"RTN","ZOSVONT",140,0)
 S %3=%1_T_%2 ;namespace~directory
"RTN","ZOSVONT",141,0)
 Q "1~"_%3
"RTN","ZOSVONT",142,0)
 ;
"RTN","ZOSVONT",143,0)
PRI() ;Check if a mixed OS enviroment.
"RTN","ZOSVONT",144,0)
 ;Default return 1 unless we are on the secondary OS.
"RTN","ZOSVONT",145,0)
 ;Only Cache on a VMS(1)/Linux or NT(2) mix is supported now.
"RTN","ZOSVONT",146,0)
 N % S %=1
"RTN","ZOSVONT",147,0)
 I $P(^XTV(8989.3,1,0),"^",5),$$OS'="VMS" S %=2
"RTN","ZOSVONT",148,0)
 Q %
"RTN","ZOSVONT",149,0)
 ;
"RTN","ZOSVONT",150,0)
HFSREW(IO,IOPAR) ;Rewind Host File.
"RTN","ZOSVONT",151,0)
 S $ZT="HFSRWERR"
"RTN","ZOSVONT",152,0)
 C IO O @(""""_IO_""""_$S(IOPAR]"":":"_IOPAR_":1",1:":1")) I '$T Q 0
"RTN","ZOSVONT",153,0)
 Q 1
"RTN","ZOSVONT",154,0)
HFSRWERR ;Error encountered
"RTN","ZOSVONT",155,0)
 Q 0
"RTN","ZOSVONT",156,0)
LOGRSRC(OPT,TYPE,STATUS) ;record resource usage in ^XTMP("KMPR"
"RTN","ZOSVONT",157,0)
 Q:'$G(^%ZTSCH("LOGRSRC"))  ; quit if RUM not turned on.
"RTN","ZOSVONT",158,0)
 ; call to RUM routine.
"RTN","ZOSVONT",159,0)
 D RU^%ZOSVKR($G(OPT),$G(TYPE),$G(STATUS))
"RTN","ZOSVONT",160,0)
 Q
"RTN","ZOSVONT",161,0)
SETTRM(X) ;Turn on specified terminators.
"RTN","ZOSVONT",162,0)
 U $I:(:"+T":X)
"RTN","ZOSVONT",163,0)
 Q 1
"RTN","ZOSVONT",164,0)
 ;
"RTN","ZOSVONT",165,0)
T0 ; start RT clock, obsolete
"RTN","ZOSVONT",166,0)
 ;S XRT0=$H
"RTN","ZOSVONT",167,0)
 Q
"RTN","ZOSVONT",168,0)
T1 ; store RT datum, obsolete
"RTN","ZOSVONT",169,0)
 ;S ^%ZRTL(3,XRTL,+$H,XRTN,$P($H,",",2))=XRT0 K XRT0
"RTN","ZOSVONT",170,0)
 Q
"RTN","ZTEDIT2")
0^3^B16339351^B16132418
"RTN","ZTEDIT2",1,0)
ZTEDIT2 ;SF/RWF - VA EDITOR ;09/03/2008
"RTN","ZTEDIT2",2,0)
 ;;8.0;KERNEL;**9,16,120,499**;Jul 10, 1995;Build 14
"RTN","ZTEDIT2",3,0)
 F %I=1:1 S %A=$T(%+%I),%T=$P(%A," ",1),%B=$P(%A," ",2,256) Q:%T="END"  I $L(%T) S ^%Z(%T)=%B
"RTN","ZTEDIT2",4,0)
 G ^ZTEDIT3
"RTN","ZTEDIT2",5,0)
 Q
"RTN","ZTEDIT2",6,0)
% ;
"RTN","ZTEDIT2",7,0)
ACTION R !,"Action: ",%X:%9 S %X=$S(%X?1".".E:$E(%X,2),1:$E(%X)),%NX=$S(%X="":1,"BCRSV"[%X:"A"_$A(%X),"bcrsv"[%X:"A"_($A(%X)-32),%X="?":"?A",1:"what2")
"RTN","ZTEDIT2",8,0)
A66 S %NX="A661",%Y=0 F %=1:1 S %X=$T(+%) Q:%X=""  S %Y=%Y+2+$L(%X) I $L(%X)>245 W !,"Line '+",%,"' is longer than 245"
"RTN","ZTEDIT2",9,0)
A661 S %NX="A99" W ?20,"Routine is ",%Y," Bytes in size."
"RTN","ZTEDIT2",10,0)
A67 X ^%Z("A671") W !,?20,"Checksum is ",%Y S %NX="A99"
"RTN","ZTEDIT2",11,0)
A671 S %Y=0 F %=1,3:1 S %1=$T(+%),%3=$F(%1," ") Q:'%3  S %3=$S($E(%1,%3)'=";":$L(%1),$E(%1,%3+1)=";":$L(%1),1:%3-2) F %2=1:1:%3 S %Y=$A(%1,%2)*%2+%Y
"RTN","ZTEDIT2",12,0)
A83 X ^%Z("MV1"),^%Z("A99")
"RTN","ZTEDIT2",13,0)
A82 X ^%Z("MV100"),^%Z("A99")
"RTN","ZTEDIT2",14,0)
A86 W !,"%Z editor version ",^%Z("VR") X ^%Z("A99")
"RTN","ZTEDIT2",15,0)
A99 S %NX="ACTION"
"RTN","ZTEDIT2",16,0)
JOIN S %NX=1 W "oin line: " X ^%Z("GTAG") Q:%T=""  S %LS=%L,%TG=%T,%T=%D_"+"_(%E+1) X ^%Z("TAG") S %NX=$S(%L="":"what",1:"JO2")
"RTN","ZTEDIT2",17,0)
JO2 W:%X'=%TG " ",%TG S %NX=1,%X=$L(%LS)+$L(%L)>245 W:%X " ... too long" I '%X ZR @%T,@%TG ZI %LS_%L W !,%LS_%L
"RTN","ZTEDIT2",18,0)
SEARCH S %NX=1 R "earch for: ",%R:%9 Q:%R=""  X ^%Z("SELALL") S %NX=$S(%POP:"what",1:"S55")
"RTN","ZTEDIT2",19,0)
S55 S %NX=1,%T=$S(%C:%B_"+"_%C,1:%B) F %A=%A:1:%I S %L=$T(+%A) S:$P(%L," ")]"" %T=$P($P(%L," "),"("),%C=0,%B=$P(%T,"(") W:%L[%R !,%T,?6," ",$P(%L," ",2,999),! S %C=%C+1,%T=%B_"+"_%C
"RTN","ZTEDIT2",20,0)
GTAG W:$D(%TG) %TG,"//" R %X:%9 X ^%Z("GT2"):%X="*" S %L="",%T=$S(%X?1.P:"",%X]"":%X,$D(%TG):%TG,1:"") S:%T="" %NX=1 Q:%T=""  X ^%Z("TAG") S:%T]"" %TG=%T
"RTN","ZTEDIT2",21,0)
GT2 S %D="",%E=0 F %I=1:1 S %L=$T(+%I),%E=%E+1 Q:%L=""  S:$P(%L," ")]"" %D=$P($P(%L," "),"("),%E=0 S %X=$S(%E:%D_"+"_%E,1:%D)
"RTN","ZTEDIT2",22,0)
GT3 X ^%Z("GT2") S %NX="EDIT"
"RTN","ZTEDIT2",23,0)
TAG S:%T?1"""""+".N %T=$E(%T,3,9) S %L="",%D=$P(%T,"+",1),%E=$P(%T,"+",2) Q:%D'?1.8AN&(%D'?1"%".AN)&(%D]"")!(%E'?.N)  S:%D="" %D=$P($P($T(+1)," "),"("),%E=%E-1 X ^("TAG2")
"RTN","ZTEDIT2",24,0)
TAG2 S %T=%D,%I=%E,%E=-1 F %I=0:1:%I S %E=%E+1,%T=$S(%E>0:%D_"+"_%E,1:%D),@("%L=$T("_%T_")") I $P(%L," ",1)]"" S %D=$P($P(%L," "),"("),%E=0,%T=%D
"RTN","ZTEDIT2",25,0)
SELECT S %POP=1 W " from line: " X ^%Z("GTAG") Q:%L=""  S %ST=%T,%B=%D,%C=%E X ^%Z("SEL3") S %A=%I W " to line: " X ^%Z("GTAG") Q:%L=""  X ^%Z("SEL3") S %POP=%A>%I
"RTN","ZTEDIT2",26,0)
SELALL S %POP=1 R " from line: BEG=> ",%T:%9 S:%T="" %T="+1" X ^%Z("TAG") Q:%L=""  S %B=%D,%C=%E X ^%Z("SEL3") S %A=%I R " to line: END=> ",%T:%9 S (%D,%E)="" X ^%Z("TAG"):%T]"" S %POP=%L=""&(%T]"") Q:%POP  X ^%Z("SEL3") S %POP=%A>%I
"RTN","ZTEDIT2",27,0)
SEL3 F %I=1:1 S %L=$T(+%I) Q:%L=""  I $P($P(%L," "),"(")=%D,%D]"" S %I=%I+%E Q
"RTN","ZTEDIT2",28,0)
LN1 S:$P(%L," ")[$C(9) %L=$P(%L,$C(9))_" "_$P(%L,$C(9),2,99) S %T=$P($P(%L," "),"("),%POP=$P(%L," ",2)']"" I '%POP,%T'?.N,%T'?1A.7AN,%T'?1"%".7AN S %POP=1
"RTN","ZTEDIT2",29,0)
LOCAL S %NX="what" S:%X'="*" %LCL=$E(%X,2,99) Q:'$D(%LCL)  Q:'$D(@%LCL)#2  S %T="*"_%LCL,%L=@%LCL X ^%Z("EDITLINE") S @%LCL=%L,%NX=1
"RTN","ZTEDIT2",30,0)
TERM S %NX=1 X ^%Z("TERM1"),^%Z("TERM2"),^%Z("TERM3")
"RTN","ZTEDIT2",31,0)
TERM1 S %S=$O(^%ZIS(2,"B","C-VT100",0)),%S=$G(^VA(200,+$G(DUZ),1.2),%S) I %S'>0 W !,"Terminal Type not found."
"RTN","ZTEDIT2",32,0)
TERM2 W !,"TERMINAL TYPE: ",$S(%S'>0:"",$D(^%ZIS(2,%S,0)):$P(^(0),"^",1)_"//",1:"") R %X:999 Q:%X=""  S %S=$S($D(^%ZIS(2,"B",%X)):$O(^(%X,0)),1:0)
"RTN","ZTEDIT2",33,0)
TERM3 Q:%S<1  S %ST=$P(^%ZIS(2,%S,0),"^",1),%=^(1),%RM=%-1,%SL=$P(%,"^",3)-4,XY=$G(^("XY")),DX=0,DY=%SL,X=%RM+1,IOT=$G(IOT,"TRM") X ^%ZOSF("RM") X XY W !!!
"RTN","ZTEDIT2",34,0)
MODE W " mode change" S:XY]"" %XY=XY S %NX=1,XY=$S(XY]"":"",1:$S($D(%XY):%XY,1:"")) W !,$S(XY="":"replace-with",1:"line editor"),!
"RTN","ZTEDIT2",35,0)
END ;
"VER")
8.0^22.0
"^DD",8989.3,8989.3,250,0)
PEER SYSTEMS^F^^PEER;1^K:$L(X)>245!($L(X)<7)!'(X?1.(1.3N1"."1.3N1"."1.3N1"."1.3N.1",")) X
"^DD",8989.3,8989.3,250,3)
Enter a list of IP addresses separated by commas.
"^DD",8989.3,8989.3,250,21,0)
^^3^3^3080915^
"^DD",8989.3,8989.3,250,21,1,0)
This field holds a list of IP addresses that the GETPEER function will 
"^DD",8989.3,8989.3,250,21,2,0)
not pass back from the API. 
"^DD",8989.3,8989.3,250,21,3,0)
It is set to 127.0.0.1 by default.
"^DD",8989.3,8989.3,250,"DT")
3080915
"BLD",1093,6)
^407
**END**
**END**
