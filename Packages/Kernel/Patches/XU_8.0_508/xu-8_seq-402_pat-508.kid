Released XU*8*508 SEQ #402
Extracted from mail message
**KIDS**:XU*8.0*508^

**INSTALL NAME**
XU*8.0*508
"BLD",1101,0)
XU*8.0*508^KERNEL^0^3080709^y
"BLD",1101,1,0)
^^2^2^3080709^
"BLD",1101,1,1,0)
Kernel patch XU*8.0*508; Error on the 'Option Access by User'.
"BLD",1101,1,2,0)
Please refer to the Description in Forum Patch Module for details.
"BLD",1101,4,0)
^9.64PA^^
"BLD",1101,6.3)
1
"BLD",1101,"ABPKG")
n
"BLD",1101,"INID")
^
"BLD",1101,"INIT")

"BLD",1101,"KRN",0)
^9.67PA^779.2^20
"BLD",1101,"KRN",.4,0)
.4
"BLD",1101,"KRN",.401,0)
.401
"BLD",1101,"KRN",.402,0)
.402
"BLD",1101,"KRN",.403,0)
.403
"BLD",1101,"KRN",.5,0)
.5
"BLD",1101,"KRN",.84,0)
.84
"BLD",1101,"KRN",3.6,0)
3.6
"BLD",1101,"KRN",3.8,0)
3.8
"BLD",1101,"KRN",9.2,0)
9.2
"BLD",1101,"KRN",9.8,0)
9.8
"BLD",1101,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",1101,"KRN",9.8,"NM",1,0)
XQ55^^0^B31130845
"BLD",1101,"KRN",9.8,"NM","B","XQ55",1)

"BLD",1101,"KRN",19,0)
19
"BLD",1101,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",1101,"KRN",19,"NM",1,0)
XUINTEG^^1^
"BLD",1101,"KRN",19,"NM","B","XUINTEG",1)

"BLD",1101,"KRN",19.1,0)
19.1
"BLD",1101,"KRN",101,0)
101
"BLD",1101,"KRN",409.61,0)
409.61
"BLD",1101,"KRN",771,0)
771
"BLD",1101,"KRN",779.2,0)
779.2
"BLD",1101,"KRN",870,0)
870
"BLD",1101,"KRN",8989.51,0)
8989.51
"BLD",1101,"KRN",8989.52,0)
8989.52
"BLD",1101,"KRN",8994,0)
8994
"BLD",1101,"KRN","B",.4,.4)

"BLD",1101,"KRN","B",.401,.401)

"BLD",1101,"KRN","B",.402,.402)

"BLD",1101,"KRN","B",.403,.403)

"BLD",1101,"KRN","B",.5,.5)

"BLD",1101,"KRN","B",.84,.84)

"BLD",1101,"KRN","B",3.6,3.6)

"BLD",1101,"KRN","B",3.8,3.8)

"BLD",1101,"KRN","B",9.2,9.2)

"BLD",1101,"KRN","B",9.8,9.8)

"BLD",1101,"KRN","B",19,19)

"BLD",1101,"KRN","B",19.1,19.1)

"BLD",1101,"KRN","B",101,101)

"BLD",1101,"KRN","B",409.61,409.61)

"BLD",1101,"KRN","B",771,771)

"BLD",1101,"KRN","B",779.2,779.2)

"BLD",1101,"KRN","B",870,870)

"BLD",1101,"KRN","B",8989.51,8989.51)

"BLD",1101,"KRN","B",8989.52,8989.52)

"BLD",1101,"KRN","B",8994,8994)

"BLD",1101,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",1101,"QUES",0)
^9.62^^
"BLD",1101,"REQB",0)
^9.611^1^1
"BLD",1101,"REQB",1,0)
XU*8.0*483^1
"BLD",1101,"REQB","B","XU*8.0*483",1)

"KRN",19,1389,-1)
1^1
"KRN",19,1389,0)
XUINTEG
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",3,-1)
1^1
"PKG",3,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",3,20,0)
^9.402P^^0
"PKG",3,22,0)
^9.49I^1^1
"PKG",3,22,1,0)
8.0^3080616^3080616^6
"PKG",3,22,1,"PAH",1,0)
508^3080709
"PKG",3,22,1,"PAH",1,1,0)
^^2^2^3080709
"PKG",3,22,1,"PAH",1,1,1,0)
Kernel patch XU*8.0*508; Error on the 'Option Access by User'.
"PKG",3,22,1,"PAH",1,1,2,0)
Please refer to the Description in Forum Patch Module for details.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","XQ55")
0^1^B31130845^B31081771
"RTN","XQ55",1,0)
XQ55 ; SEA/AMF,MJM,JLI - SEARCH FOR USERS ACCESS TO AN OPTION;
"RTN","XQ55",2,0)
 ;;8.0;KERNEL;**140,342,483,508**;Jul 10, 1995;Build 1
"RTN","XQ55",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified
"RTN","XQ55",4,0)
INIT ;
"RTN","XQ55",5,0)
 S XQDSH="-------------------------------------------------------------------------------"
"RTN","XQ55",6,0)
 D ^XQDATE S XQDT=%Y
"RTN","XQ55",7,0)
OPT W ! S DIC=19,DIC(0)="AEQM" D ^DIC G:Y=-1 OUT S XQOPT=+Y
"RTN","XQ55",8,0)
MPAT W !!,"Show menu paths" S %=2 D YN^DICN G:%<0 OUT S XQMP=2-% I '% W !!,"If you answer 'YES', the listing will include the menu path(s) each user has",!,"to access the specified option." G MPAT
"RTN","XQ55",9,0)
 K ^TMP($J),XQR,XQP
"RTN","XQ55",10,0)
 S K=^DIC(19,XQOPT,0),XQHDR="Access to '"_$P(K,U,2)_"'  ["_$P(K,U,1)_"]",XQSCD=0,XQCOM=0,XQNOPRNT=0
"RTN","XQ55",11,0)
LOOP1 S K=XQOPT,(L,X(0))=0,XQD=K K XQR,XQA,XQK,XQRV S XQR(K)="" I '$L($P(^DIC(19,K,0),U,3)) D TREE1
"RTN","XQ55",12,0)
 G LOOP2
"RTN","XQ55",13,0)
 Q
"RTN","XQ55",14,0)
TREE S X(L)=$O(^DIC(19,"AD",XQD,X(L))) Q:X(L)'>0  S K=X(L) G:$D(XQR(K)) TREE S XQR(K)=""
"RTN","XQ55",15,0)
TREE1 ;
"RTN","XQ55",16,0)
 S Y(0)=^DIC(19,K,0) G:$L($P(Y(0),U,3)) TREE S:$L($P(Y(0),U,6)) XQK(L)=$P(Y(0),U,6) S XQA(L)=K I $P(Y(0),U,16) S XQRV(L)=^DIC(19,K,3)
"RTN","XQ55",17,0)
 D SETGLO S L=L+1,X(L)=0,(XQD,XQD(L))=K D TREE
"RTN","XQ55",18,0)
 Q:L=1  K XQR(XQD(L)) S L=L-1 K XQA(L),XQK(L),XQRV(L) S XQD=XQD(L) G TREE
"RTN","XQ55",19,0)
 Q
"RTN","XQ55",20,0)
SETGLO ;
"RTN","XQ55",21,0)
 S XQK="" F I=L:-1:0 I $D(XQK(I)),$L(XQK(I)) S XQK=XQK_XQK(I)_","
"RTN","XQ55",22,0)
 S XQRV="" F I=L:-1:0 I $D(XQRV(I)),$L(XQRV(I)) S XQRV=XQRV_XQRV(I)_","
"RTN","XQ55",23,0)
 S XQA="" F I=L:-1:1 I $D(XQA(I)) S XQA=XQA_XQA(I)_","
"RTN","XQ55",24,0)
 S XQA=XQA_XQOPT,J=0 S:$D(^TMP($J,K,0)) J=^(0) S J=J+1,^(0)=J,^TMP($J,K,J)=XQK_U_XQA_U_XQRV
"RTN","XQ55",25,0)
 Q
"RTN","XQ55",26,0)
LOOP2 ;
"RTN","XQ55",27,0)
 S XQPA(0)=0,XQP=0 F  S XQP=$O(^TMP($J,XQP)) Q:XQP=""  S XQN=^TMP($J,XQP,0) S XQPS="AP" D USERS S XQPS="AD" D USERS
"RTN","XQ55",28,0)
 D USERS1 I XQNOPRNT G MUS ; 080115 - add in options from the common menu
"RTN","XQ55",29,0)
 G LOOP3
"RTN","XQ55",30,0)
USERS ;
"RTN","XQ55",31,0)
 S XQU=0 F  S XQU=$O(^VA(200,XQPS,XQP,XQU)) Q:XQU'>0  I $D(^VA(200,XQU,.1)),+$$ACTIVE^XUSER(XQU) D EACHU
"RTN","XQ55",32,0)
 Q
"RTN","XQ55",33,0)
USERS1 ; 080115 code added to handle options on the COMMON (XUCOMMAND) menu
"RTN","XQ55",34,0)
 N XUCOMMON
"RTN","XQ55",35,0)
 S XUCOMMON=$O(^DIC(19,"B","XUCOMMAND",0))
"RTN","XQ55",36,0)
 S XQP=0 F  S XQP=$O(^TMP($J,XQP)) Q:XQP=""  S XQN=^TMP($J,XQP,0) F J=1:1:XQN Q:'$D(^TMP($J,XQP,J))  I $P($P(^TMP($J,XQP,J),U,2),",")=XUCOMMON D
"RTN","XQ55",37,0)
 . D  Q:'Y
"RTN","XQ55",38,0)
 . . W !,"***"
"RTN","XQ55",39,0)
 . . W !,"*** This option is available from the 'SYSTEM COMMAND OPTIONS'  ***"
"RTN","XQ55",40,0)
 . . W !,"*** (XUCOMMAND) menu available to all active users unless       ***"
"RTN","XQ55",41,0)
 . . W !,"*** protected by a KEY - DO YOU REALLY WANT THE ENTIRE LIST     ***"
"RTN","XQ55",42,0)
 . . W !,"*** OF THESE USERS???                                           ***",!
"RTN","XQ55",43,0)
 . . N DIR S DIR(0)="Y" D ^DIR S:'Y XQNOPRNT=1 Q:'Y
"RTN","XQ55",44,0)
 . . Q
"RTN","XQ55",45,0)
 . S XQU=0,XQPS="(C)" F  S XQU=$O(^VA(200,XQU)) Q:XQU'>0  I $D(^VA(200,XQU,.1)),+$$ACTIVE^XUSER(XQU),$$KEYCHECK() S II=1 D SETU
"RTN","XQ55",46,0)
 Q
"RTN","XQ55",47,0)
 ;
"RTN","XQ55",48,0)
EACHU ;
"RTN","XQ55",49,0)
 S II=1
"RTN","XQ55",50,0)
 F J=1:1:XQN Q:'$D(^TMP($J,XQP,J))  I $$KEYCHECK() D SETU ; 080115
"RTN","XQ55",51,0)
 Q
"RTN","XQ55",52,0)
 ;
"RTN","XQ55",53,0)
KEYCHECK() ; 080115 extracted common code
"RTN","XQ55",54,0)
 ; returns 1 if user has access to the option, 0 if the user does not have access
"RTN","XQ55",55,0)
 S XQK=$P(^TMP($J,XQP,J),U,1),XX=$L(XQK,",")-1,XQGO=1
"RTN","XQ55",56,0)
 I XX F X=1:1:XX S Y=$P(XQK,",",X) I Y'="",('$D(^XUSEC(Y,XQU))) S XQGO=0
"RTN","XQ55",57,0)
 S XQK=$P(^TMP($J,XQP,J),U,3),XX=$L(XQK,",")-1
"RTN","XQ55",58,0)
 I XX F X=1:1:XX S Y=$P(XQK,",",X) I Y'="",($D(^XUSEC(Y,XQU))) S XQGO=0
"RTN","XQ55",59,0)
 Q XQGO
"RTN","XQ55",60,0)
 ;
"RTN","XQ55",61,0)
SETU ;
"RTN","XQ55",62,0)
 S XQPA=$P(^TMP($J,XQP,J),U,2)
"RTN","XQ55",63,0)
 I '$D(XQPA(XQPA)) S I=XQPA(0)+1,XQPA(0)=I,XQPA(0,I)=XQPA,XQPA(XQPA)=I
"RTN","XQ55",64,0)
 S XQPA=XQPA(XQPA) S:XQPS="AD" XQPA=XQPA_"(S)",XQSCD=1 S:XQPS="(C)" XQPA=XQPA_"(C)",XQCOM=1 ; 080115
"RTN","XQ55",65,0)
 S I=$P(^VA(200,XQU,0),U,1)_U_XQU S:$D(^TMP($J,0,I)) II=$O(^TMP($J,0,I,"A"),-1)+1 S ^TMP($J,0,I,II)=XQPA
"RTN","XQ55",66,0)
 Q
"RTN","XQ55",67,0)
LOOP3 ;
"RTN","XQ55",68,0)
 I $O(^TMP($J,0,0))="" W !!,"** NO USERS CAN ACCESS THIS OPTION **" G OUT
"RTN","XQ55",69,0)
 S %ZIS="MFQ" D ^%ZIS G OUT:POP I $D(IO("Q")) K IO("Q") S ZTRTN="DQ^XQ55",ZTDESC="OPTION ACCESS BY USER",ZTSAVE("XQ*")="",ZTSAVE("^TMP($J,")="" D ^%ZTLOAD K ZTSK,ZTRTN,ZTSAVE,ZTDESC G OUT
"RTN","XQ55",70,0)
 ;
"RTN","XQ55",71,0)
DQ ;Entry point for queued job
"RTN","XQ55",72,0)
 U IO
"RTN","XQ55",73,0)
 S:'XQMP XQPA(0)=-4 S XQPG=0,XQUI=0 D NEWPG G:XQUI MUS
"RTN","XQ55",74,0)
 S XQU=0 F  S XQU=$O(^TMP($J,0,XQU)) Q:XQU=""  D PRTU G:XQUI MUS
"RTN","XQ55",75,0)
 D:XQMP MENUPAT G MUS
"RTN","XQ55",76,0)
NEWPG ;
"RTN","XQ55",77,0)
 S X="" I XQPG,$E(IOST,1)="C" D CON S XQUI=(X="^") Q:XQUI
"RTN","XQ55",78,0)
 D HDR Q
"RTN","XQ55",79,0)
CON ;
"RTN","XQ55",80,0)
 W !!,"Press return to continue or '^' to escape " R X:DTIME S:'$T X=U
"RTN","XQ55",81,0)
 Q
"RTN","XQ55",82,0)
HDR ;
"RTN","XQ55",83,0)
 W @IOF S XQPG=XQPG+1
"RTN","XQ55",84,0)
 W "Page ",XQPG,?62,XQDT,!! S XQTAB=(76-$L(XQHDR))/2 W ?XQTAB,XQHDR
"RTN","XQ55",85,0)
 W !!,"USER NAME",?27,"LAST ON",?37,"PRIMARY MENU" W:XQMP ?63,"PATH(S)"
"RTN","XQ55",86,0)
 W !,$E(XQDSH,1,25),?27,$E(XQDSH,1,8),?37,$E(XQDSH,1,$S(XQMP:24,1:40)) W:XQMP ?63,$E(XQDSH,1,14)
"RTN","XQ55",87,0)
 Q
"RTN","XQ55",88,0)
PRTU ;
"RTN","XQ55",89,0)
 I $Y>(IOSL-XQPA(0)-8) D:XQMP MENUPAT D NEWPG Q:XQUI
"RTN","XQ55",90,0)
 S J=$P(XQU,U,2),K="" S:$D(^VA(200,J,1.1)) K=$P(^(1.1),"^") S:$L(K) K=$E(K,4,5)_"/"_$E(K,6,7)_"/"_$E(K,2,3) W !,$E($P(XQU,U,1),1,27),?27,K
"RTN","XQ55",91,0)
 I $D(^VA(200,J,201)) S K=+^(201) I K>0,$D(^DIC(19,K,0)) W ?37,$E($P(^(0),U,1),1,24)
"RTN","XQ55",92,0)
 I XQMP D
"RTN","XQ55",93,0)
 .W ?63,""
"RTN","XQ55",94,0)
 .S JJ=$O(^TMP($J,0,XQU,"A"),-1)
"RTN","XQ55",95,0)
 .F II=1:1:JJ W $G(^TMP($J,0,XQU,II)) I II'=JJ W ","
"RTN","XQ55",96,0)
 I 'XQMP D
"RTN","XQ55",97,0)
 .S II=0 F  S II=$O(^TMP($J,0,XQU,II)) Q:II'>0  D
"RTN","XQ55",98,0)
 ..I ^TMP($J,0,XQU,II)["(S)" W "  (Secondary menu)" S II="A"
"RTN","XQ55",99,0)
 Q
"RTN","XQ55",100,0)
MENUPAT ;
"RTN","XQ55",101,0)
 W !!,$E(XQDSH,1,27),"     MENU PATH(S)     ",$E(XQDSH,1,29),!
"RTN","XQ55",102,0)
 F I=1:1:XQPA(0) S K=XQPA(0,I) W !,I,".",?4 F N=1:1 Q:'$L($P(K,",",N))  W:N>1 " ... " W $P(^DIC(19,$P(K,",",N),0),U,1)
"RTN","XQ55",103,0)
 I XQSCD W !,"(S) - secondary menu pathway"
"RTN","XQ55",104,0)
 I XQCOM W !,"(C) - SYSTEM COMMAND OPTIONS (XUCOMMAND) menu pathway"
"RTN","XQ55",105,0)
 Q
"RTN","XQ55",106,0)
MUS G:X="^" OUT I $G(XQPG),$E(IOST,1)="C" W !!,"Press return when finished viewing " R X:DTIME W @IOF G OUT
"RTN","XQ55",107,0)
 I $D(ZTSK) K ^%ZTSK(ZTSK)
"RTN","XQ55",108,0)
OUT ;
"RTN","XQ55",109,0)
 D ^%ZISC
"RTN","XQ55",110,0)
KILL K XQDT,XQGO,XQN,XQP,XQR,XQRV,XQOPT,XQPA,XQUI,XQSCD,XQDSH,XQU,N,K,J,X,XQA,XQD,XQHDR,XQK,XQP,XQPS,XQMP,XQPG,XX
"RTN","XQ55",111,0)
 K DIC,I,II,JJ,L,POP,Y,XQNOPRNT I $D(ZTQUEUED),$D(ZTSK),ZTSK>0 K ^%ZTSK(ZTSK)
"RTN","XQ55",112,0)
 Q
"VER")
8.0^22.0
"BLD",1101,6)
^402
**END**
**END**
