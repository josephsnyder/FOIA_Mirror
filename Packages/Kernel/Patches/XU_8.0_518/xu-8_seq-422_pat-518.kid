KIDS Distribution saved on Nov 03, 2010@09:18:14
XU 518
**KIDS**:XU*8.0*518^

**INSTALL NAME**
XU*8.0*518
"BLD",1182,0)
XU*8.0*518^KERNEL^0^3090108^y
"BLD",1182,1,0)
^^2^2^3081125^
"BLD",1182,1,1,0)
Please refer to the Description in the FORUM Patch Module for details.
"BLD",1182,1,2,0)
XU*8*518    Several small fixes.
"BLD",1182,4,0)
^9.64PA^3.51^3
"BLD",1182,4,3.2,0)
3.2
"BLD",1182,4,3.2,2,0)
^9.641^3.2^1
"BLD",1182,4,3.2,2,3.2,0)
TERMINAL TYPE  (File-top level)
"BLD",1182,4,3.2,2,3.2,1,0)
^9.6411^3^1
"BLD",1182,4,3.2,2,3.2,1,3,0)
PAGE LENGTH
"BLD",1182,4,3.2,222)
y^n^p^^^^n^^n
"BLD",1182,4,3.2,224)

"BLD",1182,4,3.5,0)
3.5
"BLD",1182,4,3.5,2,0)
^9.641^3.5^1
"BLD",1182,4,3.5,2,3.5,0)
DEVICE  (File-top level)
"BLD",1182,4,3.5,2,3.5,1,0)
^9.6411^11^1
"BLD",1182,4,3.5,2,3.5,1,11,0)
PAGE LENGTH
"BLD",1182,4,3.5,222)
y^n^p^^^^n^^n
"BLD",1182,4,3.5,224)

"BLD",1182,4,3.51,0)
3.51
"BLD",1182,4,3.51,2,0)
^9.641^3.51^1
"BLD",1182,4,3.51,2,3.51,0)
SPOOL DOCUMENT  (File-top level)
"BLD",1182,4,3.51,2,3.51,1,0)
^9.6411^7^1
"BLD",1182,4,3.51,2,3.51,1,7,0)
PAGE ATTRIBUTES
"BLD",1182,4,3.51,222)
y^n^p^^^^n^^n
"BLD",1182,4,3.51,224)

"BLD",1182,4,"APDD",3.2,3.2)

"BLD",1182,4,"APDD",3.2,3.2,3)

"BLD",1182,4,"APDD",3.5,3.5)

"BLD",1182,4,"APDD",3.5,3.5,11)

"BLD",1182,4,"APDD",3.51,3.51)

"BLD",1182,4,"APDD",3.51,3.51,7)

"BLD",1182,4,"B",3.2,3.2)

"BLD",1182,4,"B",3.5,3.5)

"BLD",1182,4,"B",3.51,3.51)

"BLD",1182,6)
^422
"BLD",1182,6.3)
8
"BLD",1182,"INID")
^y
"BLD",1182,"INIT")
POST^XU8P518
"BLD",1182,"KRN",0)
^9.67PA^9002226^21
"BLD",1182,"KRN",.4,0)
.4
"BLD",1182,"KRN",.4,"NM",0)
^9.68A^1^1
"BLD",1182,"KRN",.4,"NM",1,0)
XU-ZISPL-USER    FILE #3.51^3.51^0
"BLD",1182,"KRN",.4,"NM","B","XU-ZISPL-USER    FILE #3.51",1)

"BLD",1182,"KRN",.401,0)
.401
"BLD",1182,"KRN",.402,0)
.402
"BLD",1182,"KRN",.403,0)
.403
"BLD",1182,"KRN",.5,0)
.5
"BLD",1182,"KRN",.84,0)
.84
"BLD",1182,"KRN",3.6,0)
3.6
"BLD",1182,"KRN",3.8,0)
3.8
"BLD",1182,"KRN",9.2,0)
9.2
"BLD",1182,"KRN",9.8,0)
9.8
"BLD",1182,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",1182,"KRN",9.8,"NM",1,0)
ZIS1^^0^B26104414
"BLD",1182,"KRN",9.8,"NM",2,0)
ZISHONT^^0^B59942519
"BLD",1182,"KRN",9.8,"NM",3,0)
ZTMKU^^0^B31252774
"BLD",1182,"KRN",9.8,"NM",4,0)
ZIS5^^0^B13408571
"BLD",1182,"KRN",9.8,"NM","B","ZIS1",1)

"BLD",1182,"KRN",9.8,"NM","B","ZIS5",4)

"BLD",1182,"KRN",9.8,"NM","B","ZISHONT",2)

"BLD",1182,"KRN",9.8,"NM","B","ZTMKU",3)

"BLD",1182,"KRN",19,0)
19
"BLD",1182,"KRN",19.1,0)
19.1
"BLD",1182,"KRN",101,0)
101
"BLD",1182,"KRN",409.61,0)
409.61
"BLD",1182,"KRN",771,0)
771
"BLD",1182,"KRN",779.2,0)
779.2
"BLD",1182,"KRN",870,0)
870
"BLD",1182,"KRN",8989.51,0)
8989.51
"BLD",1182,"KRN",8989.52,0)
8989.52
"BLD",1182,"KRN",8994,0)
8994
"BLD",1182,"KRN",9002226,0)
9002226
"BLD",1182,"KRN","B",.4,.4)

"BLD",1182,"KRN","B",.401,.401)

"BLD",1182,"KRN","B",.402,.402)

"BLD",1182,"KRN","B",.403,.403)

"BLD",1182,"KRN","B",.5,.5)

"BLD",1182,"KRN","B",.84,.84)

"BLD",1182,"KRN","B",3.6,3.6)

"BLD",1182,"KRN","B",3.8,3.8)

"BLD",1182,"KRN","B",9.2,9.2)

"BLD",1182,"KRN","B",9.8,9.8)

"BLD",1182,"KRN","B",19,19)

"BLD",1182,"KRN","B",19.1,19.1)

"BLD",1182,"KRN","B",101,101)

"BLD",1182,"KRN","B",409.61,409.61)

"BLD",1182,"KRN","B",771,771)

"BLD",1182,"KRN","B",779.2,779.2)

"BLD",1182,"KRN","B",870,870)

"BLD",1182,"KRN","B",8989.51,8989.51)

"BLD",1182,"KRN","B",8989.52,8989.52)

"BLD",1182,"KRN","B",8994,8994)

"BLD",1182,"KRN","B",9002226,9002226)

"BLD",1182,"QDEF")
^^^^YES
"BLD",1182,"QUES",0)
^9.62^^
"BLD",1182,"REQB",0)
^9.611^2^2
"BLD",1182,"REQB",1,0)
XU*8.0*355^2
"BLD",1182,"REQB",2,0)
XU*8.0*499^2
"BLD",1182,"REQB","B","XU*8.0*355",1)

"BLD",1182,"REQB","B","XU*8.0*499",2)

"FIA",3.2)
TERMINAL TYPE
"FIA",3.2,0)
^%ZIS(2,
"FIA",3.2,0,0)
3.2I
"FIA",3.2,0,1)
y^n^p^^^^n^^n
"FIA",3.2,0,10)

"FIA",3.2,0,11)

"FIA",3.2,0,"RLRO")

"FIA",3.2,0,"VR")
8.0^XU
"FIA",3.2,3.2)
1
"FIA",3.2,3.2,3)

"FIA",3.5)
DEVICE
"FIA",3.5,0)
^%ZIS(1,
"FIA",3.5,0,0)
3.5Is
"FIA",3.5,0,1)
y^n^p^^^^n^^n
"FIA",3.5,0,10)

"FIA",3.5,0,11)

"FIA",3.5,0,"RLRO")

"FIA",3.5,0,"VR")
8.0^XU
"FIA",3.5,3.5)
1
"FIA",3.5,3.5,11)

"FIA",3.51)
SPOOL DOCUMENT
"FIA",3.51,0)
^XMB(3.51,
"FIA",3.51,0,0)
3.51sI
"FIA",3.51,0,1)
y^n^p^^^^n^^n
"FIA",3.51,0,10)

"FIA",3.51,0,11)

"FIA",3.51,0,"RLRO")

"FIA",3.51,0,"VR")
8.0^XU
"FIA",3.51,3.51)
1
"FIA",3.51,3.51,7)

"INIT")
POST^XU8P518
"KRN",.4,18,-1)
0^1
"KRN",.4,18,0)
XU-ZISPL-USER^3081216.0837^^3.51^^@^3081216
"KRN",.4,18,"DCL","3.51^.01")
!
"KRN",.4,18,"DCL","3.51^8")
&
"KRN",.4,18,"DXS",1,9.2)
S DIP(1)=$S($D(^XMB(3.51,D0,2,D1,0)):^(0),1:"") S X=$P(DIP(1),U,6),DIP(2)=$G(X) S X="CNT"
"KRN",.4,18,"F",1)
4;L30;"USER NAME";S1;N~.01;"DOCUMENT NAME";C3;L40~2;C44;L8~8;"LINES";C54~7;"SIZE";C64~
"KRN",.4,18,"F",2)
S DIP(2)=$S($D(^XMB(3.51,D0,0)):^(0),1:""),X=DT S X=X,DIP(1)=$G(X) S X=$P(DIP(2),U,6),Y=X,X=DIP(1),X=X,X1=X,X2=Y,X="" D:X2 ^%DTC:X1 W X K DIP;"AGE";C76;R4;Z;"TODAY-(STARTED)"~
"KRN",.4,18,"F",3)
21,X DXS(1,9.2) S X1=DIP(2) S:X]""&(X?.ANP)&(X1'[U)&(X1'["$C(94)") DIPA($E(X,1,30))=X1 S X="" W X K DIP;C10;X;Z;"SETPARAM(COPIES PRINTED,"CNT")"~
"KRN",.4,18,"F",4)
21,S X="CNT",X=$S(X=""!(X'?.ANP):"",$D(DIPA($E(X,1,30))):DIPA($E(X,1,30)),1:"") W X K DIP;"";Z;"PARAM("CNT")"~
"KRN",.4,18,"F",5)
21,W $S(DIPA("CNT")>1:" copies",1:" copy")_" printed on ";X;"";Z;"W $S(DIPA("CNT")>1:" copies",1:" copy")_" printed on ""~21,.01;X;""~21," at ";X;""~
"KRN",.4,18,"F",6)
21,4;X;""~
"KRN",.4,18,"H")
SPOOL DOCUMENT LIST
"KRN",.4,18,"ROUOLD")
XUCT02
"MBREQ")
0
"ORD",5,.4)
.4;5;;;EDEOUT^DIFROMSO(.4,DA,"",XPDA);FPRE^DIFROMSI(.4,"",XPDA);EPRE^DIFROMSI(.4,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.4,DA,"",XPDA);DEL^DIFROMSK(.4,"",%)
"ORD",5,.4,0)
PRINT TEMPLATE
"PKG",3,-1)
1^1
"PKG",3,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",3,20,0)
^9.402P^^0
"PKG",3,22,0)
^9.49I^1^1
"PKG",3,22,1,0)
8.0^3080616^3080616^6
"PKG",3,22,1,"PAH",1,0)
518^3090108
"PKG",3,22,1,"PAH",1,1,0)
^^2^2^3090108
"PKG",3,22,1,"PAH",1,1,1,0)
Please refer to the Description in the FORUM Patch Module for details.
"PKG",3,22,1,"PAH",1,1,2,0)
XU*8*518    Several small fixes.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","XU8P518")
0^^B27219^n/a
"RTN","XU8P518",1,0)
XU8P518 ;ISF/RWF - POST-INIT ;11/26/08  14:14
"RTN","XU8P518",2,0)
 ;;8.0;KERNEL;**518**;Apr 25, 1995;Build 8
"RTN","XU8P518",3,0)
 Q
"RTN","XU8P518",4,0)
 ;
"RTN","XU8P518",5,0)
POST ;POST-INIT for XU*8*518
"RTN","XU8P518",6,0)
 D RELOAD^ZTMGRSET
"RTN","XU8P518",7,0)
 Q
"RTN","ZIS1")
0^1^B26104414^B26102976
"RTN","ZIS1",1,0)
%ZIS1 ;SFISC/AC,RWF -- DEVICE HANDLER (DEVICE INPUT) ;12/02/08  09:37
"RTN","ZIS1",2,0)
 ;;8.0;KERNEL;**18,49,69,104,112,199,391,440,499,518**;JUL 10, 1995;Build 8
"RTN","ZIS1",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified
"RTN","ZIS1",4,0)
MAIN ;Called from %ZIS with a GOTO
"RTN","ZIS1",5,0)
 ;Check for "ASK DEVICE"
"RTN","ZIS1",6,0)
 I '$D(IOP),$D(^%ZIS(1,%E,0)),'$P(^(0),"^",3) S %A=%H,%Z=^(0) D L2^%ZIS2 G EXIT
"RTN","ZIS1",7,0)
L1 ;Main Loop
"RTN","ZIS1",8,0)
 I '$D(IOP),$D(IO("Q")),POP D AQUE^%ZIS3 K:%=2 IO("Q") S:%=2 %ZISB=$S(%IS'["N":2,1:0) I %=-1 S POP=1 G EXIT
"RTN","ZIS1",9,0)
 S %E=%H,POP=0,%IS=%ZIS ;Reset %IS from %ZIS
"RTN","ZIS1",10,0)
 I %IS'["Q",$D(XQNOGO) S POP=1 W:'$D(IOP) !,$C(7),"OUTPUT IS NEVER ALLOWED FOR THIS OPTION" G EXIT
"RTN","ZIS1",11,0)
 D IOP:$D(IOP),R:'$D(IOP)
"RTN","ZIS1",12,0)
 G EXIT:$D(DTOUT)!$D(DUOUT)!(POP&$D(IOP)),L1:POP&'$D(IOP)
"RTN","ZIS1",13,0)
 D LKUP I %A'>0 S POP=1 D:'$D(DUOUT) MSG1 K DUOUT
"RTN","ZIS1",14,0)
 I %A>0,'$D(^%ZIS(1,%A,0)) D MSG1 K %ZISIOS S POP=1
"RTN","ZIS1",15,0)
 I POP G EXIT:$D(IOP),L1:'$D(IOP)
"RTN","ZIS1",16,0)
 S %E=%A,%Z1=$G(^%ZIS(1,%A,1)),%Z=^(0) ;Set naked for screen
"RTN","ZIS1",17,0)
 I $D(%ZIS("S")) N Y S Y=%E D XS^ZISX S:'$T POP=1 G G:POP ;Screen Code
"RTN","ZIS1",18,0)
 W:'$D(IOP)&($P(%Z,"^",2)'=$I)&($P(%Z1,"^")]"") "  ",$P(%Z1,"^")
"RTN","ZIS1",19,0)
 D L2^%ZIS2 ;Call
"RTN","ZIS1",20,0)
G G L1:POP&'$D(IOP)&'($D(DTOUT)!$D(DUOUT)) ;Didn't get it
"RTN","ZIS1",21,0)
 ;
"RTN","ZIS1",22,0)
EXIT ;
"RTN","ZIS1",23,0)
 I POP G EX2 ;Did not get the device.
"RTN","ZIS1",24,0)
 ;For type[TRM reset $X & $Y
"RTN","ZIS1",25,0)
 I %ZTYPE["TRM",IO]"",$D(IO(1,IO)) U IO S:'(IO=IO(0)&'$D(IO("S"))&'$D(ZTQUEUED)) $X=0,$Y=0
"RTN","ZIS1",26,0)
 ;Do count of number of times device opened.  Field 51.
"RTN","ZIS1",27,0)
 I $L($G(IO)),$D(IO(1,IO))#2,$G(%ZISIOS) D
"RTN","ZIS1",28,0)
 . S $P(^(5),"^",1)=$P($G(^%ZIS(1,%ZISIOS,5)),"^",1)+1
"RTN","ZIS1",29,0)
 I %ZIS["H" S IO(0)=IO,IO("HOME")=%ZISIOS_"^"_IO ;Make home device
"RTN","ZIS1",30,0)
 I '$D(IO("Q")),$D(%ZISLOCK) S ^XUTL("XQ",$J,"lock",%ZISIOS)=%ZISLOCK
"RTN","ZIS1",31,0)
 I $D(IO)#2,IO]"",$D(IO(1,IO))#2,$D(%Z1),$P(%Z1,"^",11) S IO(1,IO,"NOFF")=1
"RTN","ZIS1",32,0)
EX2 ;
"RTN","ZIS1",33,0)
 I %IS'[0,$G(IO(0))]"" U IO(0) ;Make sure return with home active
"RTN","ZIS1",34,0)
 G SETVAR:'POP!(%IS["T"),KILVAR
"RTN","ZIS1",35,0)
 ;
"RTN","ZIS1",36,0)
IOP ;Request with IOP set
"RTN","ZIS1",37,0)
 S (%ZISVT,%X)=IOP S:%X'?1.UNP %X=$$UP(%X) I %X'="Q" D SETQ Q
"RTN","ZIS1",38,0)
 S %IS=%IS_%X K IOP W %X D SETQ
"RTN","ZIS1",39,0)
 Q
"RTN","ZIS1",40,0)
 ;Get ready to ask user for device
"RTN","ZIS1",41,0)
R I %IS["Q",$D(XQNOGO) W !,$C(7),"AT THIS TIME, OUTPUT MUST BE QUEUED"
"RTN","ZIS1",42,0)
 S %A=$S($D(%IS("B")):%IS("B"),1:"HOME") ;Setup default
"RTN","ZIS1",43,0)
 I %IS["P",%A="HOME",$D(^%ZIS(1,%E,99)),$D(^%ZIS(1,+^(99),0)) S %A=$P(^(0),"^",1)
"RTN","ZIS1",44,0)
RD W !,$S($D(%IS("A")):%IS("A"),1:"DEVICE: ") W:%A]"" %A,"// " D SBR S:%X="" %X=%A S %ZISVT=%X
"RTN","ZIS1",45,0)
 I %X?2"?".E D EN2^%ZIS7 G R
"RTN","ZIS1",46,0)
 I %X?1"?".E D EN1^%ZIS7 G R
"RTN","ZIS1",47,0)
 I $D(DTOUT)!$D(DUOUT)!(%X'?.ANP)!($L($P(%X,";"))>31) S:%IS["T" IO="" S POP=1 Q
"RTN","ZIS1",48,0)
 S:%X'?1.UNP %X=$$UP(%X) D SETQ G R:$T
"RTN","ZIS1",49,0)
 Q
"RTN","ZIS1",50,0)
SETQ S %Y=$P(%X,";",2,9),%X=$P(%X,";",1) S:$L(";"_%Y,";/")=2 IO("P")=$P(";"_%Y,";/",2)
"RTN","ZIS1",51,0)
 I %IS["Q",%X="Q" S %X=%Y,%ZISVT=$P(%ZISVT,";",2,9),%ZISB=0,IO("Q")=1,%IS("A")="DEVICE: " S:$D(IOP) %Y=$P(%X,";",2,9),%X=$P(%X,";",1)
"RTN","ZIS1",52,0)
 I $T,'$D(IOP) W "UEUE TO PRINT ON" Q  ; Return $T value
"RTN","ZIS1",53,0)
 Q
"RTN","ZIS1",54,0)
LKUP ;Lookup device name
"RTN","ZIS1",55,0)
 S %ZISMY=$P(%ZISVT,";",2,999),%ZISVT=$P(%ZISVT,";")
"RTN","ZIS1",56,0)
 I %X="H" W:'$D(IOP) "ome" S %X=0
"RTN","ZIS1",57,0)
 I 0[%X!(%X="HOME")!(%X=$I) S %A=%H Q
"RTN","ZIS1",58,0)
 I $E(%ZISVT)="`",$D(IOP) S %A=+$E(%ZISVT,2,999) I $D(^%ZIS(1,%A,0))#2 Q
"RTN","ZIS1",59,0)
 S %A=0 I "P"[%X Q:$D(IOP)&('$D(^%ZIS(1,%E,99)))  I $D(^%ZIS(1,%E,99)) S %A=+^(99) Q
"RTN","ZIS1",60,0)
 I %X=" ",$D(DUZ)#2,$D(^DISV(+DUZ,"^%ZIS(1,")) S %A=^("^%ZIS(1,") Q
"RTN","ZIS1",61,0)
 S %A=+$O(^%ZIS(1,"B",%ZISVT,0)) Q:%A>0  ;mixed case lookup
"RTN","ZIS1",62,0)
 I %X'=%ZISVT S %A=+$O(^%ZIS(1,"B",%X,0)) Q:%A>0  ;uppercase lookup
"RTN","ZIS1",63,0)
 D VTLKUP^%ZIS S %A=%E Q:%A>0  ;mixed case lookup
"RTN","ZIS1",64,0)
 I %X'=%ZISVT S %ZISVT=%X D VTLKUP^%ZIS S %A=%E Q:%A>0  ;uppercase lookup
"RTN","ZIS1",65,0)
 N %XX,%YY S %XX=%X D 1^%ZIS5 S %A=+%YY
"RTN","ZIS1",66,0)
 Q
"RTN","ZIS1",67,0)
SBR ;Read Sub-routine
"RTN","ZIS1",68,0)
 K DTOUT,DUOUT R %X:%ZISDTIM E  W $C(7) S DTOUT=1 Q
"RTN","ZIS1",69,0)
 S:%X="."!(%X="^") DUOUT=1,%X=""
"RTN","ZIS1",70,0)
 Q
"RTN","ZIS1",71,0)
 ;LC S %X=$$UP(%X) Q
"RTN","ZIS1",72,0)
 ;
"RTN","ZIS1",73,0)
LOW(%) Q $TR(%,"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz")
"RTN","ZIS1",74,0)
UP(%) Q $TR(%,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","ZIS1",75,0)
 ;
"RTN","ZIS1",76,0)
 ;Call/Return % = 1 (yes), 2 (no) -1 (^)
"RTN","ZIS1",77,0)
YN W "? ",$P("Yes// ^No// ",U,%)
"RTN","ZIS1",78,0)
RYN R %X:%ZISDTIM E  S DTOUT=1,%X=U W $C(7)
"RTN","ZIS1",79,0)
 S:%X]""!'% %=$A(%X),%=$S(%=89:1,%=121:1,%=78:2,%=110:2,%=94:-1,1:0)
"RTN","ZIS1",80,0)
 I '%,%X'?."?" W $C(7),"??",!?4,"ANSWER 'Yes' OR 'No': " G RYN
"RTN","ZIS1",81,0)
 W:$X>73 ! W $P("  (Yes)^  (No)",U,%)
"RTN","ZIS1",82,0)
 Q
"RTN","ZIS1",83,0)
MSG1 I '$D(IOP) W ?20,$C(7),"  [DEVICE DOES NOT EXIST]"
"RTN","ZIS1",84,0)
 Q
"RTN","ZIS1",85,0)
SETVAR ;Come here to setup the variables for the selected device
"RTN","ZIS1",86,0)
 S:$D(IO)[0 IO="" G KILVAR:%IS["T"&(IO="")
"RTN","ZIS1",87,0)
 I $G(%Z)="" S ION="Unknown device",POP=1 G KILVAR
"RTN","ZIS1",88,0)
 S:IO'=IO(0)&($D(DUZ)#2) ^DISV(+DUZ,"^%ZIS(1,")=%E
"RTN","ZIS1",89,0)
 S ION=$P(%Z,"^",1),IOM=+%Z91,IOF=$P(%Z91,"^",2),IOSL=$P(%Z91,"^",3),IOBS=$P(%Z91,"^",4),IOXY=$P(%Z91,"^",5)
"RTN","ZIS1",90,0)
 I IOSL>65534 S IOSL=65534 ;Cache rolls $Y at 65535
"RTN","ZIS1",91,0)
 S IOT=%ZTYPE,IOST(0)=%ZISIOST(0),IOST=%ZISIOST,IOPAR=%ZISOPAR,IOUPAR=%ZISUPAR,IOHG=%ZISHG
"RTN","ZIS1",92,0)
 S:IOF="" IOF="#" ;See that IOF has something
"RTN","ZIS1",93,0)
 I $D(IO("Q")),'$D(%ZIS("afn")) K IO("HFSIO") ;Let TM build it at run time.
"RTN","ZIS1",94,0)
 K IOCPU S:$D(%ZISCPU) IOCPU=%ZISCPU
"RTN","ZIS1",95,0)
 G KIL
"RTN","ZIS1",96,0)
 ;
"RTN","ZIS1",97,0)
KILVAR ;Come here to restore the calling variables
"RTN","ZIS1",98,0)
 D SYMBOL^%ZISUTL(1,"%ZISOLD")
"RTN","ZIS1",99,0)
 S:'$L($G(IOF)) IOF="#" S:'$D(IOST(0)) IOST(0)=0
"RTN","ZIS1",100,0)
 ;See that all standard variables are defined
"RTN","ZIS1",101,0)
 F %I="IO","ION","IOM","IOBS","IOSL","IOST" S:$D(@%I)[0 @%I=""
"RTN","ZIS1",102,0)
 K IO("HFSIO"),IO("OPEN") I $D(%ZISCPU) S:'$D(IOCPU) IOCPU=%ZISCPU
"RTN","ZIS1",103,0)
KIL ;Final exit cleanup
"RTN","ZIS1",104,0)
 S:'POP IOS=%ZISIOS I POP K:%IS'["T" %ZISIOS I %IS["T" K IOS S:$D(%ZISIOS) IOS=%ZISIOS
"RTN","ZIS1",105,0)
 S:%IS["T" IO("T")=1 K %ZIS,%IS,%A,%E,%H,%ZISOS,%ZISV,IOP
"RTN","ZIS1",106,0)
K2 K %I,%X,%Y,%Z,%Z1,%Z91,%Z95,%ZTYPE,%ZTIME
"RTN","ZIS1",107,0)
 K %ZISCHK,%ZISCPU,%ZISI,%ZISR,%ZISVT,%ZISB,%ZISX,ZISI,%ZISHGL,%ZISHP,%ZISIO,%ZISIOS,%ZISIOM
"RTN","ZIS1",108,0)
 K %ZISIOF,%ZISIOSL,%ZISIOBS,%ZISIOST,%ZISIOST(0),%ZISTO,%ZISTP,%ZISHG,%ZISSIO,%ZISOPEN,%ZISOPAR,%ZISUPAR
"RTN","ZIS1",109,0)
 K %ZISMY,%ZISQUIT,%ZISLOCK
"RTN","ZIS1",110,0)
 Q
"RTN","ZIS5")
0^4^B13408571^B13269875
"RTN","ZIS5",1,0)
%ZIS5 ;SFISC/STAFF --DEVICE LOOK-UP ;12/16/08  08:44
"RTN","ZIS5",2,0)
 ;;8.0;KERNEL;**18,24,69,499,518**;JUL 10, 1995;Build 8
"RTN","ZIS5",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified
"RTN","ZIS5",4,0)
 ;Does a DIC like lookup. %XX,%YY are call in/out parameters
"RTN","ZIS5",5,0)
 N %DO,%DIY,%DD,%DIX
"RTN","ZIS5",6,0)
 S U="^",%DO="" K DUOUT
"RTN","ZIS5",7,0)
 I $D(^%ZIS(%ZISDFN,0)) S %DO=^(0)
"RTN","ZIS5",8,0)
A G:%ZIS(0)'["A" X I $D(%ZIS("A")) S %DD=%ZIS("A") G B
"RTN","ZIS5",9,0)
 S %DD="Select "_$P(%DO,U,1)_": "
"RTN","ZIS5",10,0)
B I $D(%ZIS("B")),%ZIS("B")]"" S %YY=%ZIS("B"),%XX=$O(^%ZIS(%ZISDFN,%D,%YY)),%DIY=$S($F(%XX,%YY)-1=$L(%YY):%XX,$D(^%ZIS(%ZISDFN,%YY,0)):$P(^(0),U,1),1:%YY) W %DD,%DIY,"// " R %XX:%ZISDTIM G G:%XX]"" S %XX=%DIY G G
"RTN","ZIS5",11,0)
 W !,%DD R %XX:%ZISDTIM
"RTN","ZIS5",12,0)
G G NO:'$T,NO:%XX["^" G:%XX?.N&(+%XX=%XX) NUM I %XX'?.ANP!($L(%XX)>30) W:%ZIS(0)["Q" *7," ??" G A
"RTN","ZIS5",13,0)
X I %XX=" ",$D(DUZ)#2,$D(^DISV(+DUZ,"^%ZIS("_%ZISDFN_",")) S %YY=+^("^%ZIS("_%ZISDFN_",") D S G:'$T NO G GOT
"RTN","ZIS5",14,0)
F G NO:%XX="" K %DS S %DS=0,%DS(0)=1,%DIX=%XX,%DIY=0
"RTN","ZIS5",15,0)
 I $D(^%ZIS(%ZISDFN,%D,%XX)) G T1
"RTN","ZIS5",16,0)
TRY S %DIX=$O(^%ZIS(%ZISDFN,%D,%DIX)) G:$P(%DIX,%XX,1)'=""!(%DIX="") T2 S %DIY=0
"RTN","ZIS5",17,0)
T1 S %DIY=$O(^%ZIS(%ZISDFN,%D,%DIX,+%DIY)) G:%DIY'>0 TRY S %YY=+%DIY D S G:'$T T1
"RTN","ZIS5",18,0)
 I %DS,'(%DS#10) D LST G NO:%XX=U,ADD:%YY<0,GOT:%YY>0
"RTN","ZIS5",19,0)
 S %DS=%DS+1,%DS(%DS)=%DIY G T1
"RTN","ZIS5",20,0)
LSYN ;
"RTN","ZIS5",21,0)
S I $D(^%ZIS(%ZISDFN,%YY,0)) G S1
"RTN","ZIS5",22,0)
 Q
"RTN","ZIS5",23,0)
S1 G S2:%ZISDFN'=1!(%D'="LSYN") I $P(^%ZIS(1,%YY,0),U,9)=%ZISV!($P(^(0),U,9)="") G S2
"RTN","ZIS5",24,0)
 Q
"RTN","ZIS5",25,0)
S2 N Y S Y=%YY D:$D(%ZIS("S")) XS^ZISX Q
"RTN","ZIS5",26,0)
T2 G:'%DS NO S %DIY="" D LST G NO:%XX=U,ADD:%YY<1,GOT
"RTN","ZIS5",27,0)
LST I %DS=1,'$D(%ZISLST) S %YY=%DS(1) Q
"RTN","ZIS5",28,0)
 S %YY=-1 Q:%ZIS(0)'["E"  W !
"RTN","ZIS5",29,0)
 F %DZ=%DS(0):1:%DS W !,$J(%DZ,2)," ",$P(^%ZIS(%ZISDFN,%DS(%DZ),0),U,1) D:%ZISDFN=1  I $D(%ZIS("W")),$D(^(0)) W "  " D XW^ZISX
"RTN","ZIS5",30,0)
 . ;Show Location
"RTN","ZIS5",31,0)
 . S %=$G(^(1)) W:$X+$L($P(%,U))>74 !?75-$L(X) W "   "_$P(%,U)
"RTN","ZIS5",32,0)
L1 W:%DIY !,"Type '^' to Stop, or" W !,"Choose 1" W:%DS>1 "-",%DS
"RTN","ZIS5",33,0)
 R "> ",%YY:%ZISDTIM S %ZISLST=1 I %YY="",%DIY S %DS(0)=%DS+1,%YY=0 W ! Q
"RTN","ZIS5",34,0)
 I %YY=U!(%YY="") S %YY=-1,DUOUT=1 S:%YY=U %XX=U Q
"RTN","ZIS5",35,0)
 I +%YY'=%YY!(%YY<1)!(%YY>%DS) W:%ZIS(0)["Q" *7," ??" G L1
"RTN","ZIS5",36,0)
 S %YY=%DS(%YY) Q
"RTN","ZIS5",37,0)
GOT S %DZ=^%ZIS(%ZISDFN,+%YY,0)
"RTN","ZIS5",38,0)
 W:%ZIS(0)["E" "  ",$P(%DZ,U,1)
"RTN","ZIS5",39,0)
R I %ZIS(0)'["F" S:$S($D(DUZ)#2:$S(DUZ:1,1:0),1:0) ^DISV(DUZ,"^%ZIS("_%ZISDFN_",")=+%YY
"RTN","ZIS5",40,0)
 I %ZIS(0)["Z" S %YY(0)=^%ZIS(%ZISDFN,+%YY,0)
"RTN","ZIS5",41,0)
Q K %ZISDFN,%DO,%DD,%DIX,%DIY,%DZ Q
"RTN","ZIS5",42,0)
ADD ;can't add to files
"RTN","ZIS5",43,0)
NO S %YY=-1 G Q
"RTN","ZIS5",44,0)
NUM I $D(^%ZIS(%ZISDFN,%XX)) S %YY=%XX D S I $T G GOT
"RTN","ZIS5",45,0)
 G F
"RTN","ZIS5",46,0)
 ;
"RTN","ZIS5",47,0)
1 ;Entry point for Device lookup
"RTN","ZIS5",48,0)
 N %D,%DS,%ZISDFN,%ZISLST ;p518
"RTN","ZIS5",49,0)
 F %D="B","LSYN" S %ZISDFN=1,%ZIS(0)=$S($D(IOP):"M",1:"EMQ") D %ZIS5 Q:(%YY>0)!$D(DUOUT)
"RTN","ZIS5",50,0)
 Q
"RTN","ZIS5",51,0)
2 ;Entry point for Terminal type lookup
"RTN","ZIS5",52,0)
 N %D,%DS,%ZISDFN,%ZISLST ;p518
"RTN","ZIS5",53,0)
 S %D="B",%ZISDFN=2,%ZIS(0)=$S($D(IOP):"M",1:"EMQ") D %ZIS5
"RTN","ZIS5",54,0)
 Q
"RTN","ZIS5",55,0)
 ;
"RTN","ZIS5",56,0)
LD1 S %E=0,%Y=0 D LCPU:"PD"[$E(%X) S %E=0 W !
"RTN","ZIS5",57,0)
L S %E=$S("PD"[$E(%X):$O(^UTILITY("ZIS",$J,"DEVLST","B",%E)),1:$O(^%ZIS(1,"B",%E))) G:%E="" RESTART S %A=+$O(^(%E,0))
"RTN","ZIS5",58,0)
 G L:'$D(^%ZIS(1,%A,0)),L:$P(^(0),"^",2)=46,L:$P(^(0),"^",2)=63 I $D(%ZIS("S")) N Y S Y=%A D XS^ZISX G L:'$T
"RTN","ZIS5",59,0)
 I "AP"[$E(%X) G L:$P($G(^%ZIS(2,+$G(^%ZIS(1,%A,"SUBTYPE")),0)),U)'?1"P".E
"RTN","ZIS5",60,0)
 W $J($P(^%ZIS(1,%A,0),"^",1),9) W:$D(^(1)) " ",$P(^(1),"^",1) I $D(^(90)),^(90) W " ** OUT OF SERVICE"
"RTN","ZIS5",61,0)
 W ?39 I $X>40 W ! S %Y=%Y+1 I %Y>20 R "'^' TO STOP: ",%Y:%ZISDTIM,! G RESTART:%Y?1P S %Y=0
"RTN","ZIS5",62,0)
 G L
"RTN","ZIS5",63,0)
 ;
"RTN","ZIS5",64,0)
LCPU S %A=%ZISV
"RTN","ZIS5",65,0)
LC1 S %A=$O(^%ZIS(1,"CPU",%A)) Q:$P(%A,".")'=%ZISV  S %E=0
"RTN","ZIS5",66,0)
LC2 S %E=+$O(^%ZIS(1,"CPU",%A,%E)) G LC1:%E'>0,LC1:'$D(^%ZIS(1,%E,0)) S ^UTILITY("ZIS",$J,"DEVLST","B",$P(^(0),"^",1),%E)="" G LC2
"RTN","ZIS5",67,0)
RESTART S:$D(%H) %E=+%H K %X,^UTILITY("ZIS",$J,"DEVLST") Q
"RTN","ZISHONT")
0^2^B59942519^B60012686
"RTN","ZISHONT",1,0)
%ZISH ;IHS/PR,SFISC/AC - Host File Control for Cache for VMS/NT/UNIX ;11/25/08  14:31
"RTN","ZISHONT",2,0)
 ;;8.0;KERNEL;**34,65,84,104,191,306,385,440,518**;JUL 10, 1995;Build 8
"RTN","ZISHONT",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified
"RTN","ZISHONT",4,0)
 ;
"RTN","ZISHONT",5,0)
OPEN(X1,X2,X3,X4,X5,X6)    ;SR. Open Host File
"RTN","ZISHONT",6,0)
 ;X1=handle name
"RTN","ZISHONT",7,0)
 ;X2=directory name \dir\
"RTN","ZISHONT",8,0)
 ;X3=file name
"RTN","ZISHONT",9,0)
 ;X4=file access mode e.g.: W for write, R for read, A for append.
"RTN","ZISHONT",10,0)
 ;X5=Max record size for a new file, X6=Subtype
"RTN","ZISHONT",11,0)
 N %,%1,%2,%I,%ZOS,%T,%ZA,%ZISHIO,$ET
"RTN","ZISHONT",12,0)
 S $ET="D OPNERR^%ZISH"
"RTN","ZISHONT",13,0)
 S U="^",%I=$I,%T=0,POP=0,X2=$$DEFDIR($G(X2)),%ZOS=$$OS^%ZOSV M %ZISHIO=IO
"RTN","ZISHONT",14,0)
 I %ZOS'="VMS" S %1=$S(X4["A":"AW",X4["W":"WN",1:"R")_$S(X4["B":"U",1:"S") ;NT & Unix
"RTN","ZISHONT",15,0)
 I %ZOS="VMS" S %1=$S(X4["A":"AW",X4["W":"WN",1:"RH")_$S(X4["B":"U",1:"S")
"RTN","ZISHONT",16,0)
 ;The next line eliminates the <ENDOFFILE> error for sequential files for the current process.
"RTN","ZISHONT",17,0)
 S %ZA=$ZUTIL(68,40,1) ;Work like DSM
"RTN","ZISHONT",18,0)
 S %=X2_X3 O %:(%1):2 I '$T S POP=1 Q
"RTN","ZISHONT",19,0)
 ;U % S %ZA=$ZA ;Comment out, $ZA is for READ status
"RTN","ZISHONT",20,0)
 ;I %ZA=-1 U:%I]"" %I C % S POP=1 Q
"RTN","ZISHONT",21,0)
 S IO=%,IO(1,IO)="",IOT="HFS",IOM=80,IOSL=60,POP=0 D SUBTYPE^%ZIS3($G(X6,"P-OTHER"))
"RTN","ZISHONT",22,0)
 I $G(X1)]"" D SAVDEV^%ZISUTL(X1)
"RTN","ZISHONT",23,0)
 U $S(%I]"":%I,1:$P)
"RTN","ZISHONT",24,0)
 Q
"RTN","ZISHONT",25,0)
 ;
"RTN","ZISHONT",26,0)
OPNERR ;Handle open error
"RTN","ZISHONT",27,0)
 S POP=1,$ECODE=""
"RTN","ZISHONT",28,0)
 U:$P]"" $P
"RTN","ZISHONT",29,0)
 Q
"RTN","ZISHONT",30,0)
 ;
"RTN","ZISHONT",31,0)
CLOSE(X) ;SR. Close HFS device not opened by %ZIS.
"RTN","ZISHONT",32,0)
 ;X=HANDLE NAME
"RTN","ZISHONT",33,0)
 ;IO=Device
"RTN","ZISHONT",34,0)
 N %
"RTN","ZISHONT",35,0)
 I $G(IO)]"" C IO K IO(1,IO)
"RTN","ZISHONT",36,0)
 I $G(X)]"" D RMDEV^%ZISUTL(X)
"RTN","ZISHONT",37,0)
 ;Only reset home if one setup.
"RTN","ZISHONT",38,0)
 I $D(IO("HOME"))!$D(^XUTL("XQ",$J,"IOS")) D HOME^%ZIS
"RTN","ZISHONT",39,0)
 Q
"RTN","ZISHONT",40,0)
 ;
"RTN","ZISHONT",41,0)
OPENERR ;
"RTN","ZISHONT",42,0)
 Q 0
"RTN","ZISHONT",43,0)
 ;
"RTN","ZISHONT",44,0)
DEL(%ZX1,%ZX2) ;ef,SR. Del files, return 1 if deleted all requested.
"RTN","ZISHONT",45,0)
 ;S Y=$$DEL^%ZISH("dir path",$NA(array))
"RTN","ZISHONT",46,0)
 ; will invoke an OS command to delete file(s)
"RTN","ZISHONT",47,0)
 ; UNIX: rm -f filespec[ ...]
"RTN","ZISHONT",48,0)
 ; VMS: del filespec[,...]
"RTN","ZISHONT",49,0)
 N %ZARG,%ZXDEL,%ZOS,%ZDELIM,%ZCOMND,%ZLIST
"RTN","ZISHONT",50,0)
 S %ZARG="",%ZXDEL=1
"RTN","ZISHONT",51,0)
 S %ZX1=$$DEFDIR($G(%ZX1))
"RTN","ZISHONT",52,0)
 S %ZOS=$$OS^%ZOSV
"RTN","ZISHONT",53,0)
 S %ZDELIM=$S(%ZOS="UNIX":" ",1:",")
"RTN","ZISHONT",54,0)
 S %ZCOMND=$S(%ZOS="UNIX":"rm -f ",1:"del ")
"RTN","ZISHONT",55,0)
 D
"RTN","ZISHONT",56,0)
 . N $ETRAP,$ESTACK S $ETRAP="D DELERR^%ZISH"
"RTN","ZISHONT",57,0)
 . N %,%ZI,%ZISH,%ZX,%ZFOUND S %ZISH=""
"RTN","ZISHONT",58,0)
 . F %ZI=1:1 S %ZISH=$O(@%ZX2@(%ZISH)) Q:%ZISH=""  D
"RTN","ZISHONT",59,0)
 . . N $ETRAP,$ESTACK S $ETRAP="D DELERR^%ZISH"
"RTN","ZISHONT",60,0)
 . . I %ZISH["*" S %ZXDEL=0 Q  ; Wild card not allowed.
"RTN","ZISHONT",61,0)
 . . S %ZX=$S(%ZISH[%ZX1:%ZISH,1:%ZX1_%ZISH) ; prepend directory path
"RTN","ZISHONT",62,0)
 . . I %ZOS="VMS",%ZX'[";" S %ZX=%ZX_";*"
"RTN","ZISHONT",63,0)
 . . S %ZFOUND=$ZSEARCH(%ZX)]""  ; File exists
"RTN","ZISHONT",64,0)
 . . S:%ZFOUND %ZARG=$S(%ZARG="":%ZX,1:%ZARG_%ZDELIM_%ZX) ; join files
"RTN","ZISHONT",65,0)
 . . I $L(%ZARG)>2000 S %=$ZF(-1,%ZCOMND_%ZARG),%ZARG="" H 1 ; delete files at a time
"RTN","ZISHONT",66,0)
 . ;
"RTN","ZISHONT",67,0)
 . I $L(%ZARG) S %=$ZF(-1,%ZCOMND_%ZARG) ; delete remaining files
"RTN","ZISHONT",68,0)
 ;
"RTN","ZISHONT",69,0)
 I %ZXDEL S %ZXDEL='$$LIST(%ZX1,%ZX2,"%ZLIST")
"RTN","ZISHONT",70,0)
 Q %ZXDEL
"RTN","ZISHONT",71,0)
 ;
"RTN","ZISHONT",72,0)
DELERR ;Trap any $ETRAP error, unwind and return.
"RTN","ZISHONT",73,0)
 S $ETRAP="D UNWIND^%ZTER"
"RTN","ZISHONT",74,0)
 S %ZXDEL=0,%ZARG=""
"RTN","ZISHONT",75,0)
 D UNWIND^%ZTER
"RTN","ZISHONT",76,0)
 Q
"RTN","ZISHONT",77,0)
 ;
"RTN","ZISHONT",78,0)
DEL1(%ZX3) ;ef,SR. Delete one file
"RTN","ZISHONT",79,0)
 N %ZI1,%ZI2
"RTN","ZISHONT",80,0)
 D SPLIT(%ZX3,.%ZI1,.%ZI2) S %ZI2(%ZI2)=""
"RTN","ZISHONT",81,0)
 Q $$DEL(%ZI1,$NA(%ZI2))
"RTN","ZISHONT",82,0)
 ;
"RTN","ZISHONT",83,0)
SPLIT(%I,%O1,%O2) ;Split to path,file
"RTN","ZISHONT",84,0)
 N %ZOS,%D,D S %ZOS=$$OS^%ZOSV
"RTN","ZISHONT",85,0)
 I %ZOS["VMS" D  Q
"RTN","ZISHONT",86,0)
 . S D=$S(%I["]":"]",1:":")
"RTN","ZISHONT",87,0)
 . S %O1=$P(%I,D,1)_D,%O2=$P(%I,D,2)
"RTN","ZISHONT",88,0)
 . Q
"RTN","ZISHONT",89,0)
 S %D=$S(%ZOS="UNIX":"/",%ZOS="NT":"\",1:""),%O1="",%O2="" Q:%D=""
"RTN","ZISHONT",90,0)
 S D=$L(%I,%D),%O1=$P(%I,%D,1,D-1),%O2=$P(%I,%D,D)
"RTN","ZISHONT",91,0)
 Q
"RTN","ZISHONT",92,0)
 ;
"RTN","ZISHONT",93,0)
FEXIST(%PATH,%FL) ;Check if files exsist.
"RTN","ZISHONT",94,0)
 ;S Y=$$DTEST("/usr/var",$NA(array))
"RTN","ZISHONT",95,0)
 N %ZISH,%ZISHY
"RTN","ZISHONT",96,0)
 S %ZISH=$$LIST(%PATH,%FL,"%ZISHY")
"RTN","ZISHONT",97,0)
 Q %ZISH
"RTN","ZISHONT",98,0)
 ;
"RTN","ZISHONT",99,0)
LIST(%ZX1,%ZX2,%ZX3) ;ef,SR. Create a local array holding file names
"RTN","ZISHONT",100,0)
 ;S Y=$$LIST^%ZISH("\dir\",$NA(array),$NA(return array)) Return 1 if found anything
"RTN","ZISHONT",101,0)
 ;
"RTN","ZISHONT",102,0)
 N %ZISH,%ZISHN,%ZX,%ZISHY,%ZY,%ZOS
"RTN","ZISHONT",103,0)
 S %ZX1=$$DEFDIR($G(%ZX1)),%ZOS=$$OS^%ZOSV
"RTN","ZISHONT",104,0)
 ;S %ZX1=$$TRNLNM(%ZX1)
"RTN","ZISHONT",105,0)
 ;Get fls to act on
"RTN","ZISHONT",106,0)
 S %ZISH="" F  S %ZISH=$O(@%ZX2@(%ZISH)) Q:%ZISH=""  D
"RTN","ZISHONT",107,0)
 . S %ZISHY=$P(%ZISH,"*")
"RTN","ZISHONT",108,0)
 . I %ZOS="VMS",%ZISH'["." S %ZISH=%ZISH_".*" ;Allways upper
"RTN","ZISHONT",109,0)
 . ;NT, display case, ignore for lookup
"RTN","ZISHONT",110,0)
 . S %ZX=%ZX1_%ZISH
"RTN","ZISHONT",111,0)
 . F %ZISHN=0:1 D  Q:(%ZX="")
"RTN","ZISHONT",112,0)
 . . S %ZX=$ZSEARCH($S(%ZISHN:"",1:%ZX))
"RTN","ZISHONT",113,0)
 . . ;Q:(%ZX="")!($$UP^XLFSTR(%ZX)'[%ZISHY)!(%ZX?.E1.2".")
"RTN","ZISHONT",114,0)
 . . Q:(%ZX="")!(%ZX?.E1.2".")
"RTN","ZISHONT",115,0)
 . . I %ZOS="VMS" S %ZX=$P(%ZX,"]",2),@%ZX3@(%ZX)=""
"RTN","ZISHONT",116,0)
 . . I %ZOS="NT" S %ZY=$P(%ZX,"\",$L(%ZX,"\")),@%ZX3@(%ZY)=""
"RTN","ZISHONT",117,0)
 . . I %ZOS="UNIX" S %ZY=$P(%ZX,"/",$L(%ZX,"/")) Q:%ZX'[%ZISHY  S @%ZX3@(%ZY)=""
"RTN","ZISHONT",118,0)
 . . Q
"RTN","ZISHONT",119,0)
 Q $O(@%ZX3@(""))]""
"RTN","ZISHONT",120,0)
 ;
"RTN","ZISHONT",121,0)
MV(X1,X2,Y1,Y2) ;ef,SR. Rename a fl
"RTN","ZISHONT",122,0)
 ;S Y=$$MV^ZOSHDOS("\dir\","fl","\dir\","fl")
"RTN","ZISHONT",123,0)
 ;Unix use mv, NT/VMS use COPY and DEL
"RTN","ZISHONT",124,0)
 N %,X,Y,%ZOS,%ZISHX S %ZOS=$$OS^%ZOSV
"RTN","ZISHONT",125,0)
 S X1=$$DEFDIR($G(X1)),Y1=$$DEFDIR($G(Y1))
"RTN","ZISHONT",126,0)
 S X=$ZSEARCH(X1_X2),Y=Y1_Y2 ;move X to Y
"RTN","ZISHONT",127,0)
 I X="" Q 0
"RTN","ZISHONT",128,0)
 S %=$ZF(-1,$S(%ZOS="UNIX":"mv ",1:"copy ")_X_" "_Y) ;Use NT/VMS copy
"RTN","ZISHONT",129,0)
 I %ZOS'="UNIX" D
"RTN","ZISHONT",130,0)
 . S X2=$P(X,X1,2),%ZISHX(X2)=""
"RTN","ZISHONT",131,0)
 . S Y=$$DEL^%ZISH(X1,$NA(%ZISHX))
"RTN","ZISHONT",132,0)
 Q 1
"RTN","ZISHONT",133,0)
 ;
"RTN","ZISHONT",134,0)
PWD() ;ef,SR. Print working directory
"RTN","ZISHONT",135,0)
 N Y,%ZOS
"RTN","ZISHONT",136,0)
 S Y=$$DEFDIR(""),%ZOS=$$OS^%ZOSV
"RTN","ZISHONT",137,0)
 I Y="" S Y=$ZSEARCH("*")
"RTN","ZISHONT",138,0)
 Q $S(%ZOS["VMS":Y,1:$P(Y,".",1))
"RTN","ZISHONT",139,0)
 ;
"RTN","ZISHONT",140,0)
TRNLNM(PATH) ;ef. Expand logical path
"RTN","ZISHONT",141,0)
 N %ZOS,P1,P2
"RTN","ZISHONT",142,0)
 S %ZOS=$$OS^%ZOSV,PATH=$G(PATH)
"RTN","ZISHONT",143,0)
 I %ZOS="VMS" D  Q PATH
"RTN","ZISHONT",144,0)
 . S P1=PATH_$S(PATH[":":"*.*",1:":*.*")
"RTN","ZISHONT",145,0)
 . S P2=$ZSEARCH(P1)
"RTN","ZISHONT",146,0)
 . S:$L(P2) PATH=$S(P2["]":$P(P2,"]",1,$L(P2,"]")-1)_"]",1:$P(P2,":",1)_":")
"RTN","ZISHONT",147,0)
 . Q
"RTN","ZISHONT",148,0)
 I %ZOS="NT" D  Q PATH
"RTN","ZISHONT",149,0)
 . S P1=PATH_$S($E(PATH,$L(PATH))'="\":"\*",1:"*"),P2=$ZSEARCH(P1)
"RTN","ZISHONT",150,0)
 . S:$L(P2) PATH=$P(P2,"\",1,$L(P2,"\")-1)_"\"
"RTN","ZISHONT",151,0)
 . Q
"RTN","ZISHONT",152,0)
 ;Unix Cache $ZSEARCH uses % around an environment variable
"RTN","ZISHONT",153,0)
 I %ZOS="UNIX" D  Q PATH
"RTN","ZISHONT",154,0)
 . S P1=PATH_$S($E(PATH,$L(PATH))'="/":"/*",1:"*"),P2=$ZSEARCH(P1)
"RTN","ZISHONT",155,0)
 . S:$L(P2) PATH=$P(P2,"/",1,$L(P2,"/")-1)_"/"
"RTN","ZISHONT",156,0)
 . Q
"RTN","ZISHONT",157,0)
 Q PATH
"RTN","ZISHONT",158,0)
 ;
"RTN","ZISHONT",159,0)
DEFDIR(DF) ;ef. Default Dir and frmt
"RTN","ZISHONT",160,0)
 ;Need to handle NT, VMS and Linux
"RTN","ZISHONT",161,0)
 N %ZOS,P1,P2 S %ZOS=$$OS^%ZOSV,DF=$G(DF)
"RTN","ZISHONT",162,0)
 Q:DF="." "" ;Special way to get current dir.
"RTN","ZISHONT",163,0)
 S:DF="" DF=$G(^XTV(8989.3,1,"DEV")),DF=$P(DF,"^",$S($$PRI^%ZOSV<2:1,1:2))
"RTN","ZISHONT",164,0)
 Q:DF="" ""
"RTN","ZISHONT",165,0)
 ;Check syntax, VMS needs disk:[dir] or logical:
"RTN","ZISHONT",166,0)
 I %ZOS="VMS" D
"RTN","ZISHONT",167,0)
 . I DF[":" S P1=$P(DF,":")_":",P2=$P(DF,":",2)
"RTN","ZISHONT",168,0)
 . E  S P1="",P2=DF
"RTN","ZISHONT",169,0)
 . I P1="",P2["$" S P1=P2,P2=""  ;Could be a logical
"RTN","ZISHONT",170,0)
 . I $L(P2) S:P2'["[" P2="["_P2 S:P2'["]" P2=P2_"]"
"RTN","ZISHONT",171,0)
 . S DF=P1_P2 S:DF'[":" DF=DF_":"
"RTN","ZISHONT",172,0)
 . Q
"RTN","ZISHONT",173,0)
 ;Check syntax, Unix needs /mnt/fl, ./fl, ~/fl %HOME%/fl
"RTN","ZISHONT",174,0)
 I %ZOS="UNIX" D
"RTN","ZISHONT",175,0)
 . S DF=$TR(DF,"\","/")
"RTN","ZISHONT",176,0)
 . S:$E(DF,$L(DF))'="/" DF=DF_"/"
"RTN","ZISHONT",177,0)
 . Q
"RTN","ZISHONT",178,0)
 ;Check syntax, NT needs c:\dir\
"RTN","ZISHONT",179,0)
 I %ZOS="NT" D
"RTN","ZISHONT",180,0)
 . N P1,P2
"RTN","ZISHONT",181,0)
 . I DF[":" S P1=$P(DF,":")_":",P2=$P(DF,":",2)
"RTN","ZISHONT",182,0)
 . E  S P1="",P2=DF
"RTN","ZISHONT",183,0)
 . S P2=$TR(P2,"/","\")
"RTN","ZISHONT",184,0)
 . I $L(P2) S:".\"'[$E(P2,1) P2="\"_P2 S:$E(P2,$L(P2))'="\" P2=P2_"\"
"RTN","ZISHONT",185,0)
 . S DF=P1_P2
"RTN","ZISHONT",186,0)
 . Q
"RTN","ZISHONT",187,0)
 S DF=$$TRNLNM(DF) ;Resolve logicals
"RTN","ZISHONT",188,0)
 Q DF
"RTN","ZISHONT",189,0)
 ;
"RTN","ZISHONT",190,0)
FL(X) ;Fl len
"RTN","ZISHONT",191,0)
 N ZOSHP1,ZOSHP2
"RTN","ZISHONT",192,0)
 S ZOSHP1=$P(X,"."),ZOSHP2=$P(X,".",2)
"RTN","ZISHONT",193,0)
 I $L(ZOSHP1)>8 S X=4 Q
"RTN","ZISHONT",194,0)
 I $L(ZOSHP2)>3 S X=4 Q
"RTN","ZISHONT",195,0)
 Q
"RTN","ZISHONT",196,0)
 ;
"RTN","ZISHONT",197,0)
STATUS() ;ef,SR. Return EOF status
"RTN","ZISHONT",198,0)
 U $I
"RTN","ZISHONT",199,0)
 Q $$EOF($ZEOF)
"RTN","ZISHONT",200,0)
 ;
"RTN","ZISHONT",201,0)
EOF(X) ;Eof flag, pass in $ZEOF
"RTN","ZISHONT",202,0)
 Q (X=-1)
"RTN","ZISHONT",203,0)
 ;
"RTN","ZISHONT",204,0)
MAKEREF(HF,IX,OVF) ;Internal call to rebuild global ref.
"RTN","ZISHONT",205,0)
 ;Return %ZISHF,%ZISHO,%ZISHI,%ZISUB
"RTN","ZISHONT",206,0)
 N I,F,MX
"RTN","ZISHONT",207,0)
 S OVF=$G(OVF,"%ZISHOF")
"RTN","ZISHONT",208,0)
 S %ZISHI=$QS(HF,IX),MX=$QL(HF) ;
"RTN","ZISHONT",209,0)
 S F=$NA(@HF,IX-1) ;Get first part
"RTN","ZISHONT",210,0)
 I IX=1 S %ZISHF=F_"(%ZISHI" ;Build root, IX=1
"RTN","ZISHONT",211,0)
 I IX>1 S %ZISHF=$E(F,1,$L(F)-1)_",%ZISHI" ;Build root
"RTN","ZISHONT",212,0)
 S %ZISHO=%ZISHF_","_OVF_",%OVFCNT)" ;Make overflow
"RTN","ZISHONT",213,0)
 F I=IX+1:1:MX S %ZISHF=%ZISHF_",%ZISUB("_I_")",%ZISUB(I)=$QS(HF,I)
"RTN","ZISHONT",214,0)
 S %ZISHF=%ZISHF_")"
"RTN","ZISHONT",215,0)
 Q
"RTN","ZISHONT",216,0)
 ;
"RTN","ZISHONT",217,0)
READNXT(REC) ;Read any sized record into array. %ZB has terminator
"RTN","ZISHONT",218,0)
 N %,I,X,$ES,$ET S REC="",$ET="D READNX^%ZISH Q"
"RTN","ZISHONT",219,0)
 U IO R X:5 S %ZB=$A($ZB),REC=$E(X,1,255)
"RTN","ZISHONT",220,0)
 Q:$L(X)<256
"RTN","ZISHONT",221,0)
 S %=256 F I=1:1 Q:$L(X)<%  S REC(I)=$E(X,%,%+254),%=%+255
"RTN","ZISHONT",222,0)
 Q
"RTN","ZISHONT",223,0)
READNX ;Check for EOF
"RTN","ZISHONT",224,0)
 I $ZE["ENDOFFILE" S %ZA=-1
"RTN","ZISHONT",225,0)
 S $EC=""
"RTN","ZISHONT",226,0)
 Q
"RTN","ZISHONT",227,0)
 ;
"RTN","ZISHONT",228,0)
FTG(%ZX1,%ZX2,%ZX3,%ZX4,%ZX5) ;ef,SR. Unload contents of host file into global
"RTN","ZISHONT",229,0)
 ;p1=hostf file directory
"RTN","ZISHONT",230,0)
 ;p2=host file name
"RTN","ZISHONT",231,0)
 ;p3= $NAME REFERENCE INCLUDING STARTING SUBSCRIPT
"RTN","ZISHONT",232,0)
 ;p4=INCREMENT SUBSCRIPT
"RTN","ZISHONT",233,0)
 ;p5=Overflow subscript, defaults to "OVF"
"RTN","ZISHONT",234,0)
 N %ZA,%ZB,%ZC,X,%OVFCNT,%ZISHF,%ZISHO,POP,%ZISUB,$ES,$ET
"RTN","ZISHONT",235,0)
 N I,%ZISH,%ZISH1,%ZISHI,%ZISHL,%ZISHOF,%ZISHOX,%ZISHS,%ZX,%ZISHY
"RTN","ZISHONT",236,0)
 S %ZX1=$$DEFDIR($G(%ZX1)),%ZISHOF=$G(%ZX5,"OVF")
"RTN","ZISHONT",237,0)
 D MAKEREF(%ZX3,%ZX4,"%ZISHOF")
"RTN","ZISHONT",238,0)
 D OPEN^%ZISH(,%ZX1,%ZX2,"R")
"RTN","ZISHONT",239,0)
 I POP Q 0
"RTN","ZISHONT",240,0)
 S %ZC=1,%ZA=0,$ET="S %ZC=0,%ZA=-1,$EC="""" Q"
"RTN","ZISHONT",241,0)
 U IO F  K %XX D READNXT(.%XX) Q:$$EOF($ZEOF)!%ZA  D
"RTN","ZISHONT",242,0)
 . S @%ZISHF=%XX
"RTN","ZISHONT",243,0)
 . I $D(%XX)>2 F %OVFCNT=1:1 Q:'$D(%XX(%OVFCNT))  S @%ZISHO=%XX(%OVFCNT)
"RTN","ZISHONT",244,0)
 . S %ZISHI=%ZISHI+1
"RTN","ZISHONT",245,0)
 . Q
"RTN","ZISHONT",246,0)
 D CLOSE() ;Normal exit
"RTN","ZISHONT",247,0)
 Q %ZC
"RTN","ZISHONT",248,0)
 ;
"RTN","ZISHONT",249,0)
GTF(%ZX1,%ZX2,%ZX3,%ZX4) ;ef,SR. Load contents of global to host file.
"RTN","ZISHONT",250,0)
 ;p1=$NAME of global reference
"RTN","ZISHONT",251,0)
 ;p2=incrementing subscript
"RTN","ZISHONT",252,0)
 ;p3=host file directory
"RTN","ZISHONT",253,0)
 ;p4=host file name
"RTN","ZISHONT",254,0)
 N %ZISHY,%ZISHOX
"RTN","ZISHONT",255,0)
 S %ZISHY=$$MGTF(%ZX1,%ZX2,%ZX3,%ZX4,"W")
"RTN","ZISHONT",256,0)
 Q %ZISHY
"RTN","ZISHONT",257,0)
 ;
"RTN","ZISHONT",258,0)
GATF(%ZX1,%ZX2,%ZX3,%ZX4) ;ef,SR. Append to host file.
"RTN","ZISHONT",259,0)
 ;
"RTN","ZISHONT",260,0)
 ;p1=$NAME of global reference
"RTN","ZISHONT",261,0)
 ;p2=incrementing subscript
"RTN","ZISHONT",262,0)
 ;p3=host file directory
"RTN","ZISHONT",263,0)
 ;p4=host file name
"RTN","ZISHONT",264,0)
 N %ZISHY
"RTN","ZISHONT",265,0)
 S %ZISHY=$$MGTF(%ZX1,%ZX2,%ZX3,%ZX4,"A")
"RTN","ZISHONT",266,0)
 Q %ZISHY
"RTN","ZISHONT",267,0)
 ;
"RTN","ZISHONT",268,0)
MGTF(%ZX1,%ZX2,%ZX3,%ZX4,%ZX5) ;
"RTN","ZISHONT",269,0)
 ;p1=$NAME of global reference
"RTN","ZISHONT",270,0)
 ;p2=incrementing subscript
"RTN","ZISHONT",271,0)
 ;p3=host file directory
"RTN","ZISHONT",272,0)
 ;p4=host file name
"RTN","ZISHONT",273,0)
 N %ZISH,%ZISH1,%ZISHI,%ZISHL,%ZISHS,%ZISHOX,IO,%ZX,Y,%ZC
"RTN","ZISHONT",274,0)
 D MAKEREF(%ZX1,%ZX2)
"RTN","ZISHONT",275,0)
 D OPEN^%ZISH(,$G(%ZX3),%ZX4,%ZX5) ;Default dir set in open
"RTN","ZISHONT",276,0)
 I POP Q 0
"RTN","ZISHONT",277,0)
 N $ETRAP S $ETRAP="S $EC="""" D CLOSE^%ZISH() Q 0"
"RTN","ZISHONT",278,0)
 F  Q:'($D(@%ZISHF)#2)  S %ZX=@%ZISHF,%ZISHI=%ZISHI+1 U IO W %ZX,!
"RTN","ZISHONT",279,0)
 D CLOSE()
"RTN","ZISHONT",280,0)
 Q 1
"RTN","ZISHONT",281,0)
 ;
"RTN","ZTMKU")
0^3^B31252774^B20082059
"RTN","ZTMKU",1,0)
ZTMKU ;SEA/RDS-Taskman: Option, ZTMWAIT/RUN/STOP ;01/05/09  16:07
"RTN","ZTMKU",2,0)
 ;;8.0;KERNEL;**118,127,275,355,518**;Jul 10, 1995;Build 8
"RTN","ZTMKU",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","ZTMKU",4,0)
MENU ;
"RTN","ZTMKU",5,0)
 N DIR,DTOUT,DUOUT
"RTN","ZTMKU",6,0)
 D TABLE ;Show taskman
"RTN","ZTMKU",7,0)
 S DTIME=$G(DTIME,300),DIR(0)="N^1:4",DIR("A",.1)=""
"RTN","ZTMKU",8,0)
 S DIR("A",1)=" 1. Remove from WAIT state.(RUN)",DIR("A",2)=" 2. Managers Update.",DIR("A",3)=" 3. Put into WAIT state."
"RTN","ZTMKU",9,0)
 S DIR("A",4)=" 4. STOP Taskman."
"RTN","ZTMKU",10,0)
 S DIR("A",99)="",DIR("A")="Select Option" D ^DIR
"RTN","ZTMKU",11,0)
 G RUN:Y=1,UPDATE:Y=2,WAIT:Y=3,STOP:Y=4
"RTN","ZTMKU",12,0)
 Q
"RTN","ZTMKU",13,0)
 ;
"RTN","ZTMKU",14,0)
RUN ;Remove Task Managers From WAIT State
"RTN","ZTMKU",15,0)
 D WS(0,"MGR"),WS(0,"SUB") K ^%ZTSCH("STOP") W !,"TaskMan removed from 'WAIT STATE'.",!
"RTN","ZTMKU",16,0)
 Q
"RTN","ZTMKU",17,0)
 ;
"RTN","ZTMKU",18,0)
UPDATE ;Have Managers Do an parameter Update
"RTN","ZTMKU",19,0)
 K ^%ZTSCH("UPDATE")
"RTN","ZTMKU",20,0)
 W !,"Managers will update parameters.",!
"RTN","ZTMKU",21,0)
 Q
"RTN","ZTMKU",22,0)
 ;
"RTN","ZTMKU",23,0)
WAIT ;Put Task Managers In WAIT State
"RTN","ZTMKU",24,0)
 D WS(1,"MGR") W !,"TaskMan now in 'WAIT STATE'",$C(7)
"RTN","ZTMKU",25,0)
 D QSUB
"RTN","ZTMKU",26,0)
 Q
"RTN","ZTMKU",27,0)
 ;
"RTN","ZTMKU",28,0)
STOP ;Shut Down Task Managers
"RTN","ZTMKU",29,0)
 N ZTX,ND,J
"RTN","ZTMKU",30,0)
 F  R !!,"Are you sure you want to stop TaskMan? NO// ",ZTX:$S($D(DTIME)#2:DTIME,1:60) S ZTX=$$UP(ZTX) Q:'$T!("^YES^NO"[ZTX)  W:ZTX'["?" $C(7) W !,"Answer YES to shut down all Task Managers on current the volume set."
"RTN","ZTMKU",31,0)
 I "^NO"[ZTX W !,"TaskMan NOT shut down." Q
"RTN","ZTMKU",32,0)
 W !,"Shutting down TaskMan." D GROUP("SMAN(NODE)")
"RTN","ZTMKU",33,0)
 D QSUB,ASKACT
"RTN","ZTMKU",34,0)
 Q
"RTN","ZTMKU",35,0)
 ;
"RTN","ZTMKU",36,0)
SSUB(NODE) ;Stop sub-managers
"RTN","ZTMKU",37,0)
 D SS(1,"SUB",NODE)
"RTN","ZTMKU",38,0)
 Q
"RTN","ZTMKU",39,0)
SMAN(NODE) ;stop managers
"RTN","ZTMKU",40,0)
 D SS(1,"MGR",NODE)
"RTN","ZTMKU",41,0)
 Q
"RTN","ZTMKU",42,0)
 ;
"RTN","ZTMKU",43,0)
SS(MD,GR,NODE) ;Set/clear STOP nodes.
"RTN","ZTMKU",44,0)
 S GR=$G(GR,"MGR") S:"MGR_SUB_"'[GR GR="MGR"
"RTN","ZTMKU",45,0)
 I MD=1 S ^%ZTSCH("STOP",GR,NODE)=$H D WS(0,GR)
"RTN","ZTMKU",46,0)
 I MD=0 K ^%ZTSCH("STOP",GR,NODE)
"RTN","ZTMKU",47,0)
 Q
"RTN","ZTMKU",48,0)
 ;
"RTN","ZTMKU",49,0)
WS(MD,GR) ;Set/Clear Wait state
"RTN","ZTMKU",50,0)
 S GR=$G(GR,"MGR") S:"MGR_SUB_"'[GR GR="MGR"
"RTN","ZTMKU",51,0)
 I MD=1 S ^%ZTSCH("WAIT",GR)=$H ;set wait state
"RTN","ZTMKU",52,0)
 I MD=0 K ^%ZTSCH("WAIT",GR) ;Clear wait
"RTN","ZTMKU",53,0)
 Q
"RTN","ZTMKU",54,0)
 ;
"RTN","ZTMKU",55,0)
GROUP(CALL) ;Do CALL for each node, use NODE as the parameter
"RTN","ZTMKU",56,0)
 N J,ND,NODE
"RTN","ZTMKU",57,0)
 ;Get the Managers
"RTN","ZTMKU",58,0)
 F J=0:0 S J=$O(^%ZTSCH("STATUS",J)) Q:J=""  S ND=$G(^(J)),NODE=$P(ND,"^",3) D @CALL
"RTN","ZTMKU",59,0)
 ;Get any remote Sub-Managers
"RTN","ZTMKU",60,0)
 S NODE="" F  S NODE=$O(^%ZTSCH("SUB",NODE)) Q:NODE=""  D @CALL
"RTN","ZTMKU",61,0)
 Q
"RTN","ZTMKU",62,0)
 ;
"RTN","ZTMKU",63,0)
OPT(MD) ;Disable/Enable option prosessing
"RTN","ZTMKU",64,0)
 I MD=1 S ^%ZTSCH("NO-OPTION")=""
"RTN","ZTMKU",65,0)
 I MD=0 K ^%ZTSCH("NO-OPTION")
"RTN","ZTMKU",66,0)
 Q
"RTN","ZTMKU",67,0)
 ;
"RTN","ZTMKU",68,0)
ASKACT ;Ask if active Tasks should be signaled to stop.
"RTN","ZTMKU",69,0)
 N ZTX,ND
"RTN","ZTMKU",70,0)
 F  R !!,"Should active jobs be signaled to stop? NO// ",ZTX:$G(DTIME,60) S ZTX=$$UP(ZTX) Q:'$T!("^YES^NO"[ZTX)  W:ZTX'["?" $C(7) W !,"Answer YES to set the STOP flag for active tasks.",!,"Tasks need to call $$S^%ZTLOAD to get the signal."
"RTN","ZTMKU",71,0)
 I "^NO"[ZTX W !,"Tasks NOT signaled to shut down." Q
"RTN","ZTMKU",72,0)
 W !!,"Signaling active Tasks to STOP."
"RTN","ZTMKU",73,0)
 D STPACT W !,"Done."
"RTN","ZTMKU",74,0)
 Q
"RTN","ZTMKU",75,0)
 ;
"RTN","ZTMKU",76,0)
STPACT ;Set the STOP flag for all ACTIVE Tasks.
"RTN","ZTMKU",77,0)
 N ZTI,ZT2
"RTN","ZTMKU",78,0)
 S ZTI=0
"RTN","ZTMKU",79,0)
 F  S ZTI=$O(^%ZTSCH("TASK",ZTI)) Q:'ZTI  S ZT2=$$ASKSTOP^%ZTLOAD(ZTI) W !,"TASK: ",ZTI," Stop status: ",ZT2
"RTN","ZTMKU",80,0)
 Q
"RTN","ZTMKU",81,0)
 ;
"RTN","ZTMKU",82,0)
QSUB N ZTX,ND
"RTN","ZTMKU",83,0)
 F  R !!,"Should active submanagers shut down after finishing their current tasks? NO// ",ZTX:$S($D(DTIME)#2:DTIME,1:60) Q:'$T!("^"[ZTX)!("YESyesNOno"[ZTX)  W:ZTX'["?" $C(7) W !,"Please answer YES or NO."
"RTN","ZTMKU",84,0)
 D:"YESyes"[ZTX&(ZTX]"") GROUP("SSUB(NODE)") W !,"Okay!",!
"RTN","ZTMKU",85,0)
 Q
"RTN","ZTMKU",86,0)
 ;
"RTN","ZTMKU",87,0)
QUERY ;Query Status Of A Task Manager
"RTN","ZTMKU",88,0)
 Q:$D(%ZTX)[0  Q:%ZTX=""  S %ZTY=0
"RTN","ZTMKU",89,0)
 I $D(^%ZTSCH("STATUS",%ZTX))#2 S %ZTY=^%ZTSCH("STATUS",%ZTX)
"RTN","ZTMKU",90,0)
 K %ZTX Q
"RTN","ZTMKU",91,0)
 ;
"RTN","ZTMKU",92,0)
NODES ;Return Task Manager Status Nodes
"RTN","ZTMKU",93,0)
 S %ZTX="" F %ZTY=0:0 S %ZTX=$O(^%ZTSCH("STATUS",%ZTX)) Q:%ZTX=""  S %ZTY=%ZTY+1,%ZTY(%ZTY)=%ZTX
"RTN","ZTMKU",94,0)
 K %ZTX Q
"RTN","ZTMKU",95,0)
 ;
"RTN","ZTMKU",96,0)
LIVE ;Return Whether A Task Manager Is Live
"RTN","ZTMKU",97,0)
 Q:$D(%ZTX)[0  Q:%ZTX=""  S %ZTY=0,U="^",%ZTX1=$H,%ZTX2=$P(%ZTX,U)
"RTN","ZTMKU",98,0)
 S %ZTX3=%ZTX1-%ZTX2*86400+$P(%ZTX1,",",2)-$P(%ZTX2,",",2)
"RTN","ZTMKU",99,0)
 I %ZTX3'<0 S %ZTY=$S($D(^%ZTSCH("RUN"))[0&(%ZTX'["WAIT"):0,%ZTX3<30:1,%ZTX3<120&(%ZTX["PAUSE"):1,1:0)
"RTN","ZTMKU",100,0)
 K %ZTX,%ZTX1,%ZTX2,%ZTX3 Q
"RTN","ZTMKU",101,0)
 ;
"RTN","ZTMKU",102,0)
TABLE ;Display Task Manager Table
"RTN","ZTMKU",103,0)
 W !,"JOB NUMBER",?15,"STATUS",?25,"DESCRIPTION",?55,"LAST UPDATED",?75,"LIVE"
"RTN","ZTMKU",104,0)
 W !,"----------",?15,"------",?25,"-----------",?55,"------------",?75,"----"
"RTN","ZTMKU",105,0)
 D NODES S %ZTZ=%ZTY,%ZTZ1=0,U="^",%H=$H D YMD^%DTC S DT=X
"RTN","ZTMKU",106,0)
 F %ZTI=1:1:%ZTZ S %ZTX=%ZTY(%ZTI) D QUERY I %ZTY'=0 W !,%ZTY(%ZTI),?15,$P(%ZTY,U,2),?25,$P(%ZTY,U,3),?55 S %ZTT=$P(%ZTY,U) D T S %ZTX=%ZTY D LIVE W ?75,$S(%ZTY:"YES",1:"NO") I %ZTY S %ZTZ1=%ZTZ1+1
"RTN","ZTMKU",107,0)
 W !?6,"Total:",$J(%ZTZ,3),!?6,"Live :",$J(%ZTZ1,3)
"RTN","ZTMKU",108,0)
 K %ZTI,%ZTT,%ZTY,%ZTZ Q
"RTN","ZTMKU",109,0)
 ;
"RTN","ZTMKU",110,0)
CLEAN ;Cleanup Status Node
"RTN","ZTMKU",111,0)
 K ^%ZTSCH("STATUS") W !,"Done!",! Q
"RTN","ZTMKU",112,0)
PURGE ;Purge the TASK list of running tasks.
"RTN","ZTMKU",113,0)
 N TSK S TSK=0
"RTN","ZTMKU",114,0)
 F  S TSK=$O(^%ZTSCH("TASK",TSK)) Q:TSK'>0  I '$D(^%ZTSCH("TASK",TSK,"P")) K ^%ZTSCH("TASK",TSK)
"RTN","ZTMKU",115,0)
 W !,"Done!",! Q
"RTN","ZTMKU",116,0)
 ;
"RTN","ZTMKU",117,0)
ZTM ;Return Number Of Live Task Managers
"RTN","ZTMKU",118,0)
 N %ZTI,%ZTZ,%ZTZ1
"RTN","ZTMKU",119,0)
 D NODES S %ZTZ=%ZTY,%ZTZ1=0 F %ZTI=1:1:%ZTZ S %ZTX=%ZTY(%ZTI) D QUERY I %ZTY'=0 S %ZTX=%ZTY D LIVE I %ZTY S %ZTZ1=%ZTZ1+1
"RTN","ZTMKU",120,0)
 S %ZTY=%ZTZ1 Q
"RTN","ZTMKU",121,0)
 ;
"RTN","ZTMKU",122,0)
UP(X) ;Convert to Uppercase
"RTN","ZTMKU",123,0)
 Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","ZTMKU",124,0)
 ;
"RTN","ZTMKU",125,0)
T ;Print Informal-format Conversion Of $H-format Date ; Input: %ZTT, DT.
"RTN","ZTMKU",126,0)
 S %H=%ZTT D 7^%DTC W $S(DT=X:"TODAY",DT+1=X:"TOMORROW",1:$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3))_" AT " S X=$P(%ZTT,",",2)\60,%H=X\60 W $E(%H+100,2,3)_":"_$E(X#60+100,2,3)
"RTN","ZTMKU",127,0)
 K %,%D,%H,%M,%Y,X Q  ; Output: %ZTT, DT.
"RTN","ZTMKU",128,0)
 ;
"VER")
8.0^22.0
"^DD",3.2,3.2,3,0)
PAGE LENGTH^RNJ5,0^^1;3^K:+X'=X!(X>65534)!(X<3)!(X?.E1"."1.N) X
"^DD",3.2,3.2,3,3)
Type a number between 3 and 65534, 0 Decimal Digits
"^DD",3.2,3.2,3,21,0)
^^1^1^3041221^
"^DD",3.2,3.2,3,21,1,0)
This is the number of usable lines on the output device.
"^DD",3.2,3.2,3,"DT")
3081125
"^DD",3.5,3.5,11,0)
PAGE LENGTH^NJ5,0^^91;3^K:+X'=X!(X>65534)!(X<3)!(X?.E1"."1.N) X
"^DD",3.5,3.5,11,3)
Type a number between 3 and 65534, 0 Decimal Digits
"^DD",3.5,3.5,11,21,0)
^^8^8^3041221^
"^DD",3.5,3.5,11,21,1,0)
This field, if it has data, will override the Page Length field value
"^DD",3.5,3.5,11,21,2,0)
from the Terminal type file.
"^DD",3.5,3.5,11,21,3,0)
Leave this field blank unless you are sure that you need to have a
"^DD",3.5,3.5,11,21,4,0)
different Page Length than what is in the terminal type file.
"^DD",3.5,3.5,11,21,5,0)
 
"^DD",3.5,3.5,11,21,6,0)
If this is a CRT then this is the number of lines which can
"^DD",3.5,3.5,11,21,7,0)
be displayed on the screen, otherwise, for printers, it is
"^DD",3.5,3.5,11,21,8,0)
the number of print lines per page.
"^DD",3.5,3.5,11,"DT")
3081125
"^DD",3.51,3.51,7,0)
PAGE ATTRIBUTES^F^^0;8^K:$L(X)>9!($L(X)<3)!'(X?1.3N1";"1.5N) X
"^DD",3.51,3.51,7,3)
Answer must be 3-9 characters in length
"^DD",3.51,3.51,7,21,0)
^^3^3^3081216^^^^
"^DD",3.51,3.51,7,21,1,0)
This field holds the device parameters which were established by the
"^DD",3.51,3.51,7,21,2,0)
initial device handler call.  These parameters are retained and use
"^DD",3.51,3.51,7,21,3,0)
when the job is spooled and when the spool document is printed.
"^DD",3.51,3.51,7,"DT")
3081216
**END**
**END**
