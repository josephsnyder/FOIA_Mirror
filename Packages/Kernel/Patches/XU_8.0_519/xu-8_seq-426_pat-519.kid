KIDS Distribution saved on Nov 03, 2010@09:21:35
XU 426
**KIDS**:XU*8.0*519^

**INSTALL NAME**
XU*8.0*519
"BLD",1211,0)
XU*8.0*519^KERNEL^0^3090605^y
"BLD",1211,1,0)
^^2^2^3090128^
"BLD",1211,1,1,0)
Kernel patch XU*8.0*519; Modify PRINT LOCAL NPI REPORTS. Please refer
"BLD",1211,1,2,0)
to the Description in Forum Patch Module for details.
"BLD",1211,4,0)
^9.64PA^^
"BLD",1211,6)
^426
"BLD",1211,6.3)
2
"BLD",1211,"ABPKG")
n
"BLD",1211,"KRN",0)
^9.67PA^9002226^21
"BLD",1211,"KRN",.4,0)
.4
"BLD",1211,"KRN",.401,0)
.401
"BLD",1211,"KRN",.402,0)
.402
"BLD",1211,"KRN",.403,0)
.403
"BLD",1211,"KRN",.5,0)
.5
"BLD",1211,"KRN",.84,0)
.84
"BLD",1211,"KRN",3.6,0)
3.6
"BLD",1211,"KRN",3.8,0)
3.8
"BLD",1211,"KRN",9.2,0)
9.2
"BLD",1211,"KRN",9.8,0)
9.8
"BLD",1211,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",1211,"KRN",9.8,"NM",1,0)
XUSNPIE2^^0^B86877139
"BLD",1211,"KRN",9.8,"NM","B","XUSNPIE2",1)

"BLD",1211,"KRN",19,0)
19
"BLD",1211,"KRN",19.1,0)
19.1
"BLD",1211,"KRN",101,0)
101
"BLD",1211,"KRN",409.61,0)
409.61
"BLD",1211,"KRN",771,0)
771
"BLD",1211,"KRN",779.2,0)
779.2
"BLD",1211,"KRN",870,0)
870
"BLD",1211,"KRN",8989.51,0)
8989.51
"BLD",1211,"KRN",8989.52,0)
8989.52
"BLD",1211,"KRN",8994,0)
8994
"BLD",1211,"KRN",9002226,0)
9002226
"BLD",1211,"KRN",9002226,"NM",0)
^9.68A^^
"BLD",1211,"KRN","B",.4,.4)

"BLD",1211,"KRN","B",.401,.401)

"BLD",1211,"KRN","B",.402,.402)

"BLD",1211,"KRN","B",.403,.403)

"BLD",1211,"KRN","B",.5,.5)

"BLD",1211,"KRN","B",.84,.84)

"BLD",1211,"KRN","B",3.6,3.6)

"BLD",1211,"KRN","B",3.8,3.8)

"BLD",1211,"KRN","B",9.2,9.2)

"BLD",1211,"KRN","B",9.8,9.8)

"BLD",1211,"KRN","B",19,19)

"BLD",1211,"KRN","B",19.1,19.1)

"BLD",1211,"KRN","B",101,101)

"BLD",1211,"KRN","B",409.61,409.61)

"BLD",1211,"KRN","B",771,771)

"BLD",1211,"KRN","B",779.2,779.2)

"BLD",1211,"KRN","B",870,870)

"BLD",1211,"KRN","B",8989.51,8989.51)

"BLD",1211,"KRN","B",8989.52,8989.52)

"BLD",1211,"KRN","B",8994,8994)

"BLD",1211,"KRN","B",9002226,9002226)

"BLD",1211,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",1211,"QUES",0)
^9.62^^
"BLD",1211,"REQB",0)
^9.611^1^1
"BLD",1211,"REQB",1,0)
XU*8.0*480^1
"BLD",1211,"REQB","B","XU*8.0*480",1)

"MBREQ")
0
"PKG",3,-1)
1^1
"PKG",3,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",3,20,0)
^9.402P^^0
"PKG",3,22,0)
^9.49I^1^1
"PKG",3,22,1,0)
8.0^3090423^3080616^6
"PKG",3,22,1,"PAH",1,0)
519^3090605
"PKG",3,22,1,"PAH",1,1,0)
^^2^2^3090605
"PKG",3,22,1,"PAH",1,1,1,0)
Kernel patch XU*8.0*519; Modify PRINT LOCAL NPI REPORTS. Please refer
"PKG",3,22,1,"PAH",1,1,2,0)
to the Description in Forum Patch Module for details.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","XUSNPIE2")
0^1^B86877139^B76313807
"RTN","XUSNPIE2",1,0)
XUSNPIE2 ;FO-OAKLAND/JLI - DATA ENTRY FOR INITIAL NPI VALUES ;6/5/09
"RTN","XUSNPIE2",2,0)
 ;;8.0;KERNEL;**410,435,454,462,480,519**;Jul 10, 1995;Build 2
"RTN","XUSNPIE2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified
"RTN","XUSNPIE2",4,0)
 Q
"RTN","XUSNPIE2",5,0)
 ;
"RTN","XUSNPIE2",6,0)
PRINTOPT ;
"RTN","XUSNPIE2",7,0)
 N DIR,%ZIS,ION,OPTION,PRNTFRMT,XUSDIV,XUSSORT,XUSRESO,Y,ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTSK,XUSER
"RTN","XUSNPIE2",8,0)
 K IO("Q")
"RTN","XUSNPIE2",9,0)
 W !,"Select one of the following:",!!,?11,"1",?21,"All providers",!,?11,"2",?21,"All providers without NPI numbers",!
"RTN","XUSNPIE2",10,0)
 S DIR(0)="N^1:2",DIR("A")="Select a report option",DIR("B")="1" D ^DIR K DIR Q:Y'>0  S OPTION=+Y
"RTN","XUSNPIE2",11,0)
 S XUSRESO="" D  Q:XUSRESO=""
"RTN","XUSNPIE2",12,0)
 . S DIR(0)="S^P:Providers who are not residents;R:Residents only;B:Both"
"RTN","XUSNPIE2",13,0)
 . S DIR("B")="P",DIR("A")="Selection: "
"RTN","XUSNPIE2",14,0)
 . D ^DIR K DIR Q:"PRB"'[Y
"RTN","XUSNPIE2",15,0)
 . S XUSRESO=Y Q
"RTN","XUSNPIE2",16,0)
 ; Change of XU*8*519 #1 (add 3 lines of code below)
"RTN","XUSNPIE2",17,0)
 W !!,"Select one of the following:",!!,?11,"1",?21,"ACTIVE users only",!,?11,"2",?21,"ACTIVE and DISUSERed users",!
"RTN","XUSNPIE2",18,0)
 S DIR(0)="N^1:2",DIR("A")="Select a report option",DIR("B")="1" D ^DIR K DIR Q:Y'>0  S XUSER=+Y
"RTN","XUSNPIE2",19,0)
 ; End XU*8*519 #1
"RTN","XUSNPIE2",20,0)
 ; 
"RTN","XUSNPIE2",21,0)
 S DIR(0)="Y",DIR("B")="NO",DIR("A")="Sort by DIVISION" D ^DIR K DIR Q:Y="^"  S XUSDIV=+Y
"RTN","XUSNPIE2",22,0)
 S PRNTFRMT=1
"RTN","XUSNPIE2",23,0)
 I XUSDIV S DIR(0)="N^1:2",DIR("A")="Output type (1=Printed text or 2=^-delimited)" D ^DIR K DIR Q:Y'>0  S PRNTFRMT=Y
"RTN","XUSNPIE2",24,0)
 S DIR(0)="Y",DIR("B")="YES",DIR("A")="Sort by SERVICE/SECTION"_$S(XUSDIV>0:" (as well)",1:"") D ^DIR K DIR Q:Y="^"  S XUSSORT=+Y
"RTN","XUSNPIE2",25,0)
 W !!,">>> Report processing time is approximately 10 minutes."
"RTN","XUSNPIE2",26,0)
 W !,"    Recommend text output be queued to a network printer."
"RTN","XUSNPIE2",27,0)
 W !
"RTN","XUSNPIE2",28,0)
 S %ZIS="MQ" D ^%ZIS Q:POP
"RTN","XUSNPIE2",29,0)
 I $D(IO("Q")) D  Q
"RTN","XUSNPIE2",30,0)
 . S ZTSAVE("OPTION")="",ZTSAVE("XUSSORT")="",ZTSAVE("XUSDIV")="",ZTSAVE("PRNTFRMT")="",ZTSAVE("XUSRESO")="",ZTSAVE("XUSER")=""
"RTN","XUSNPIE2",31,0)
 . S ZTIO=ION,ZTRTN="DQ^XUSNPIE2",ZTDESC="NPI PRINT JOB FOR OPTION "_OPTION
"RTN","XUSNPIE2",32,0)
 . D ^%ZTLOAD W:$D(ZTSK) !,"Queued as Task "_ZTSK D HOME^%ZIS Q
"RTN","XUSNPIE2",33,0)
 ;
"RTN","XUSNPIE2",34,0)
DQ ; entry point for queued print job
"RTN","XUSNPIE2",35,0)
 U IO D PRNTPROV(OPTION,XUSSORT,XUSDIV,PRNTFRMT,XUSRESO,XUSER)
"RTN","XUSNPIE2",36,0)
 U IO D ^%ZISC
"RTN","XUSNPIE2",37,0)
 Q
"RTN","XUSNPIE2",38,0)
 ;
"RTN","XUSNPIE2",39,0)
PRNTPROV(OPTION,XUSSORT,XUSDIV,PRNTFRMT,XUSRESO,XUSER) ;
"RTN","XUSNPIE2",40,0)
 ; PRINT PROVIDER INFO
"RTN","XUSNPIE2",41,0)
 ;
"RTN","XUSNPIE2",42,0)
 ; OPTION   SPECIFIES TYPE OF PRINT - 1=ALL PROVIDERS, 2=NEEDS NPI ONLY
"RTN","XUSNPIE2",43,0)
 ; XUSSORT  INDICATES WHETHER SORTED BY SERVICE/SECTION
"RTN","XUSNPIE2",44,0)
 ; XUSDIV   INDICATES WHETHER SORTED BY DIVISION
"RTN","XUSNPIE2",45,0)
 ; PRNTFRMT INDICATES TYPE OF OUTPUT, PRINTED OR ^-DELIMITED
"RTN","XUSNPIE2",46,0)
 ;
"RTN","XUSNPIE2",47,0)
 ; ZEXCEPT: IOSL    - KERNEL VARIABLE
"RTN","XUSNPIE2",48,0)
 S XUSER=$G(XUSER) ;add p 519
"RTN","XUSNPIE2",49,0)
 N PAGENUM,LINENUM,PROVNAME,TAXDESCR,TAXONOMY,SERVSECT,DIRUT,DTOUT
"RTN","XUSNPIE2",50,0)
 N GLOBLOC,IEN,NPI,DATETIME,GLOBVALU,NCOUNT,GLOBLOC1,XUSDIVNM,CNTTOTAL,CNTNONE,CNTEXMPT,CNTDONE,MULTDIV,MULTDIVC,XUSDIS
"RTN","XUSNPIE2",51,0)
 S CNTTOTAL=0,CNTNONE=0,CNTEXMPT=0,CNTDONE=0,XUSDIS=""
"RTN","XUSNPIE2",52,0)
 S PAGENUM=0,LINENUM=0
"RTN","XUSNPIE2",53,0)
 S DATETIME=$$NOW^XLFDT()
"RTN","XUSNPIE2",54,0)
 S GLOBLOC1=$$GETDATA(OPTION,XUSSORT,XUSDIV,XUSRESO,XUSER)
"RTN","XUSNPIE2",55,0)
 I PRNTFRMT'=1 W !,"PROVIDER_NAME^LAST4^IEN^NPI^TAXONOMY_CODE^TAXONOMY DESCRIPTION"_$S(XUSDIV:"^DIVISION",1:"")_$S(XUSSORT:"^SERVICE/SECTION",1:"")
"RTN","XUSNPIE2",56,0)
 S GLOBLOC=GLOBLOC1,XUSDIVNM="" F  S XUSDIVNM=$O(@GLOBLOC1@(XUSDIVNM)) Q:XUSDIVNM=""  D  Q:$D(DIRUT)!$D(DTOUT)
"RTN","XUSNPIE2",57,0)
 . S SERVSECT="" F  S SERVSECT=$O(@GLOBLOC1@(XUSDIVNM,SERVSECT)) Q:SERVSECT=""  S GLOBLOC=$NA(@GLOBLOC1@(XUSDIVNM,SERVSECT)) D  Q:$D(DIRUT)!$D(DTOUT)
"RTN","XUSNPIE2",58,0)
 . . I PRNTFRMT=1 D HEADER(OPTION,DATETIME,.PAGENUM,.LINENUM,XUSDIV,XUSDIVNM,XUSSORT,SERVSECT,XUSRESO,XUSER) Q:$D(DIRUT)!$D(DTOUT)
"RTN","XUSNPIE2",59,0)
 . . S PROVNAME="" F  S PROVNAME=$O(@GLOBLOC@(PROVNAME)) Q:PROVNAME=""  Q:$D(DIRUT)!$D(DTOUT)  S IEN=0 F  S IEN=$O(@GLOBLOC@(PROVNAME,IEN)) Q:IEN'>0  D  Q:$D(DIRUT)!$D(DTOUT)
"RTN","XUSNPIE2",60,0)
 . . . S NCOUNT=0
"RTN","XUSNPIE2",61,0)
 . . . S TAXDESCR="" F  S TAXDESCR=$O(@GLOBLOC@(PROVNAME,IEN,TAXDESCR)) Q:TAXDESCR=""  S GLOBVALU=@GLOBLOC@(PROVNAME,IEN,TAXDESCR) D
"RTN","XUSNPIE2",62,0)
 . . . . S NPI=$P(GLOBVALU,U,3),TAXONOMY=$P(GLOBVALU,U,4),XUSDIS=$P(GLOBVALU,U,6)
"RTN","XUSNPIE2",63,0)
 . . . . I PRNTFRMT=1 S NCOUNT=NCOUNT+1 W:NCOUNT=1 !,PROVNAME,?33,$$ALIGNRGT(IEN,11),?49,NPI,?65,XUSDIS W !,?6,TAXONOMY,"  ",TAXDESCR
"RTN","XUSNPIE2",64,0)
 . . . . I PRNTFRMT'=1 W !,PROVNAME_U_$E($$GET1^DIQ(200,IEN_",",9),6,9)_U_IEN_U_NPI_U_TAXONOMY_U_TAXDESCR_$S(XUSDIV:U_XUSDIVNM,1:"")_$S(XUSSORT:U_SERVSECT,1:"")
"RTN","XUSNPIE2",65,0)
 . . . . Q
"RTN","XUSNPIE2",66,0)
 . . . I PRNTFRMT=1 S LINENUM=LINENUM+NCOUNT+1 I LINENUM>(IOSL-4) D HEADER(OPTION,DATETIME,.PAGENUM,.LINENUM,XUSDIV,XUSDIVNM,XUSSORT,SERVSECT,XUSRESO,XUSER) Q:$D(DIRUT)!$D(DTOUT)
"RTN","XUSNPIE2",67,0)
 . . . Q
"RTN","XUSNPIE2",68,0)
 . . Q
"RTN","XUSNPIE2",69,0)
 . Q
"RTN","XUSNPIE2",70,0)
 I '($D(DIRUT)!$D(DTOUT)),PRNTFRMT=1 D
"RTN","XUSNPIE2",71,0)
 . S PROVNAME="" I $O(@GLOBLOC@(PROVNAME))="" W !,?20,"* * * N O  D A T A  F O U N D * * *",!! I 1
"RTN","XUSNPIE2",72,0)
 . E  D
"RTN","XUSNPIE2",73,0)
 . . N TOTTYP S TOTTYP=$S(XUSRESO="R":"Residents",1:"Billable Providers")
"RTN","XUSNPIE2",74,0)
 . . W !!,"Total "_TOTTYP_":",?43,CNTTOTAL,!,TOTTYP_" with an NPI:",?43,CNTDONE,!,"EXEMPT "_TOTTYP_":",?43,CNTEXMPT,!,TOTTYP_" Still Needing an NPI:",?43,CNTNONE
"RTN","XUSNPIE2",75,0)
 . . I $G(MULTDIV)>0 W !!,MULTDIV," Providers were repeated a total of ",MULTDIVC," times",!," due to listing under multiple divisions"
"RTN","XUSNPIE2",76,0)
 . . Q
"RTN","XUSNPIE2",77,0)
 . W !!,?27,"*** End of Report ***"
"RTN","XUSNPIE2",78,0)
 . Q
"RTN","XUSNPIE2",79,0)
 Q
"RTN","XUSNPIE2",80,0)
 ;
"RTN","XUSNPIE2",81,0)
HEADER(OPTION,DATETIME,PAGNOREF,LINNOREF,XUSDIV,XUSDIVNM,XUSSORT,SERVSECT,XUSRESO,XUSER) ;
"RTN","XUSNPIE2",82,0)
 ; ZEXCEPT: IOF,IOST  KERNEL IO VARIABLES
"RTN","XUSNPIE2",83,0)
 ; ZEXCEPT: DIRUT,DTOUT  NEWED IN CALLING PRNTPROV - INDICATE QUIT TO PRNTPROV
"RTN","XUSNPIE2",84,0)
 N TEMPVAL,DIR,X,Y
"RTN","XUSNPIE2",85,0)
 S PAGNOREF=PAGNOREF+1
"RTN","XUSNPIE2",86,0)
 S XUSER=$G(XUSER) ; add p 519
"RTN","XUSNPIE2",87,0)
 ; Don't page feed on the first page
"RTN","XUSNPIE2",88,0)
 IF PAGNOREF>1 I $E(IOST,1,2)="C-" S DIR(0)="E" D ^DIR I 'Y S DIRUT=1 Q
"RTN","XUSNPIE2",89,0)
 IF PAGNOREF>1 W @IOF
"RTN","XUSNPIE2",90,0)
 W:$E(IOST,1,2)'="C-" !
"RTN","XUSNPIE2",91,0)
 W "Active Provider Report ("_$S(XUSRESO="P":"no residents)",XUSRESO="R":"residents only)",1:"includes residents)")
"RTN","XUSNPIE2",92,0)
 W ?48,$$FMTE^XLFDT(DATETIME),"  Page: ",PAGNOREF
"RTN","XUSNPIE2",93,0)
 W !,"Report Option: Provider List    Active ",$S(XUSER=2:"and Disuser ",1:""),"Providers",$S(OPTION=2:" Without NPI Numbers",1:"")
"RTN","XUSNPIE2",94,0)
 W !!,"Provider Name",?39,"IEN",?49,$S(OPTION'=2:"NPI",1:""),?65,$S(XUSER=2:"Disuser",1:"")
"RTN","XUSNPIE2",95,0)
 W !,"      Taxonomy"
"RTN","XUSNPIE2",96,0)
 W !,"--------------------------------------------------------------------------------"
"RTN","XUSNPIE2",97,0)
 S LINNOREF=6
"RTN","XUSNPIE2",98,0)
 I XUSDIV W !,"DIVISION: ",XUSDIVNM,"   " S LINNOREF=LINNOREF+1
"RTN","XUSNPIE2",99,0)
 I XUSSORT W:'XUSDIV ! W "SERVICE/SECTION: ",SERVSECT S:'XUSDIV LINNOREF=LINNOREF+1
"RTN","XUSNPIE2",100,0)
 Q
"RTN","XUSNPIE2",101,0)
 ;
"RTN","XUSNPIE2",102,0)
GETDATA(OPTION,XUSSORT,XUSDIV,XUSRESO,XUSER) ; get data for reports for providers
"RTN","XUSNPIE2",103,0)
 N NPI,PROVNAME,TAXDESCR,TAXONOMY,XUSDEFLT,XUSDIVCN,XUSDIVN,XUSDIVNM,XUSGLOB,XUSACTV,XUSSKIP
"RTN","XUSNPIE2",104,0)
 N XUSIEN,XUSSERVC,XUSVAL,CNTCLEAN,X,XUSDIS
"RTN","XUSNPIE2",105,0)
 S XUSRESO=$G(XUSRESO)
"RTN","XUSNPIE2",106,0)
 S XUSER=$G(XUSER) I XUSER="" S XUSER=1 ;add p 519 - active users only reported
"RTN","XUSNPIE2",107,0)
 S XUSDIS="" ; p 519
"RTN","XUSNPIE2",108,0)
 ; ZEXCEPT: CNTTOTAL,CNTNONE,CNTEXMPT,CNTDONE - NEWed and initialized in PRNTPROV or killed based on CNTCLEAN
"RTN","XUSNPIE2",109,0)
 S CNTCLEAN=0 I '$D(CNTTOTAL) S CNTCLEAN=1
"RTN","XUSNPIE2",110,0)
 S XUSGLOB=$NA(^TMP($J,"XUSNPIPRNT")) K @XUSGLOB
"RTN","XUSNPIE2",111,0)
 I 'XUSDIV S XUSDIVNM(1)=" ",XUSDEFLT=" "
"RTN","XUSNPIE2",112,0)
 I XUSDIV S XUSDEFLT=$$NS^XUAF4($$KSP^XUPARAM("INST")),XUSDEFLT=$P(XUSDEFLT,U)
"RTN","XUSNPIE2",113,0)
 I 'XUSSORT S XUSSERVC=" "
"RTN","XUSNPIE2",114,0)
 F XUSIEN=0:0 S XUSIEN=$O(^VA(200,XUSIEN)) Q:XUSIEN'>0  D
"RTN","XUSNPIE2",115,0)
 . ; Don't report TERMINATED
"RTN","XUSNPIE2",116,0)
 . S XUSACTV=$$ACTIVE^XUSER(XUSIEN)
"RTN","XUSNPIE2",117,0)
 . I XUSACTV=""!($P(XUSACTV,U,2)="TERMINATED") Q  ;p 519
"RTN","XUSNPIE2",118,0)
 . I XUSER=1,$P(XUSACTV,U)=0 Q  ;p 519
"RTN","XUSNPIE2",119,0)
 . S XUSDIS="" I $P(XUSACTV,U,2)="DISUSER" S XUSDIS="Yes" ;p 519
"RTN","XUSNPIE2",120,0)
 . ; Don't report users with null NPI ENTRY STATUS
"RTN","XUSNPIE2",121,0)
 . S XUSVAL=$$CHEKNPI^XUSNPIED(XUSIEN),XUSVAL=$$NPISTATS^XUSNPIED(XUSIEN)
"RTN","XUSNPIE2",122,0)
 . Q:XUSVAL=""
"RTN","XUSNPIE2",123,0)
 . S PROVNAME=$$GET1^DIQ(200,XUSIEN_",",.01),NPI=$$GETNPI^XUSNPIED(XUSIEN),TAXONOMY=$$GETTAXON^XUSNPIED(XUSIEN,.TAXDESCR) I TAXONOMY=-1 S TAXONOMY=" ",TAXDESCR=" "
"RTN","XUSNPIE2",124,0)
 . ; Determine whether provider is a resident for local reports.
"RTN","XUSNPIE2",125,0)
 . I OPTION'=3,XUSRESO'="B" S XUSSKIP=0 D  Q:XUSSKIP
"RTN","XUSNPIE2",126,0)
 . . I XUSRESO="R",TAXONOMY'="390200000X" S XUSSKIP=1 Q
"RTN","XUSNPIE2",127,0)
 . . I XUSRESO="P",TAXONOMY="390200000X" S XUSSKIP=1
"RTN","XUSNPIE2",128,0)
 . . Q
"RTN","XUSNPIE2",129,0)
 . I NPI="",$$EXMPTNPI^XUSNPIED(XUSIEN) S NPI="EXEMPTED  "
"RTN","XUSNPIE2",130,0)
 . S CNTTOTAL=$G(CNTTOTAL)+1 S:NPI="" CNTNONE=$G(CNTNONE)+1 S:NPI="EXEMPTED  " CNTEXMPT=$G(CNTEXMPT)+1 S:NPI?10N CNTDONE=$G(CNTDONE)+1
"RTN","XUSNPIE2",131,0)
 . I '((XUSVAL="N")!(OPTION'=2)) Q
"RTN","XUSNPIE2",132,0)
 . I XUSSORT S XUSSERVC=$$GET1^DIQ(200,XUSIEN_",",29) I XUSSERVC="" S XUSSERVC=" "
"RTN","XUSNPIE2",133,0)
 . I XUSDIV D
"RTN","XUSNPIE2",134,0)
 . . K XUSDIVNM S XUSDIVCN=0,XUSDIVNM(1)=XUSDEFLT
"RTN","XUSNPIE2",135,0)
 . . F XUSDIVN=0:0 S XUSDIVN=$O(^VA(200,XUSIEN,2,XUSDIVN)) Q:XUSDIVN'>0  S XUSDIVCN=XUSDIVCN+1,XUSDIVNM(XUSDIVCN)=$$GET1^DIQ(200.02,XUSDIVN_","_XUSIEN_",",.01)
"RTN","XUSNPIE2",136,0)
 . . I XUSDIVCN>1 S MULTDIV=$G(MULTDIV)+1,MULTDIVC=$G(MULTDIVC)+XUSDIVCN-1
"RTN","XUSNPIE2",137,0)
 . . Q
"RTN","XUSNPIE2",138,0)
 . F XUSDIVN=0:0 S XUSDIVN=$O(XUSDIVNM(XUSDIVN)) Q:XUSDIVN'>0  D
"RTN","XUSNPIE2",139,0)
 . . S X=PROVNAME_U_XUSIEN_U_NPI_U_TAXONOMY_U_TAXDESCR I XUSDIS="Yes" S X=X_U_XUSDIS  ;p 519 add piece #6 on X
"RTN","XUSNPIE2",140,0)
 . . S @XUSGLOB@(XUSDIVNM(XUSDIVN),XUSSERVC,PROVNAME,XUSIEN,TAXDESCR)=X
"RTN","XUSNPIE2",141,0)
 . . Q 
"RTN","XUSNPIE2",142,0)
 . Q
"RTN","XUSNPIE2",143,0)
 I CNTCLEAN K CNTTOTAL,CNTNONE,CNTEXMPT,CNTDONE
"RTN","XUSNPIE2",144,0)
 Q XUSGLOB
"RTN","XUSNPIE2",145,0)
 ;
"RTN","XUSNPIE2",146,0)
ALIGNRGT(TEXT,WIDTH) ; align text right in a specified width
"RTN","XUSNPIE2",147,0)
 N RESULT
"RTN","XUSNPIE2",148,0)
 S $P(RESULT," ",WIDTH)=" ",RESULT=RESULT_TEXT,RESULT=$E(RESULT,$L(RESULT)-WIDTH+1,$L(RESULT))
"RTN","XUSNPIE2",149,0)
 Q RESULT
"RTN","XUSNPIE2",150,0)
 ;
"RTN","XUSNPIE2",151,0)
CHKOLD1(IEN) ; check for earlier value, and activate if present
"RTN","XUSNPIE2",152,0)
 N IEN1,STATUS,NPI,DATE,XUFDA
"RTN","XUSNPIE2",153,0)
 S IEN1=$O(^VA(200,IEN,"NPISTATUS"," "),-1) I IEN1>0 D  I STATUS=0 D CHKOLD1(IEN)
"RTN","XUSNPIE2",154,0)
 . S STATUS=^VA(200,IEN,"NPISTATUS",IEN1,0),NPI=$P(STATUS,U,3),DATE=$P(STATUS,U),STATUS=$P(STATUS,U,2)
"RTN","XUSNPIE2",155,0)
 . I STATUS=0 D DELETNPI(IEN,IEN1,DATE) Q  ; entry making it INACTIVE - remove it
"RTN","XUSNPIE2",156,0)
 . I STATUS=1 D SET^XUSNPIE1(IEN,NPI)
"RTN","XUSNPIE2",157,0)
 . Q
"RTN","XUSNPIE2",158,0)
 Q
"RTN","XUSNPIE2",159,0)
 ;
"RTN","XUSNPIE2",160,0)
DELETNPI(IEN,OIEN,ODATEVAL) ;
"RTN","XUSNPIE2",161,0)
 N XUFDA
"RTN","XUSNPIE2",162,0)
 I $D(ODATEVAL) S XUFDA(200.042,OIEN_","_IEN_",",.01)="@" D FILE^DIE("","XUFDA")
"RTN","XUSNPIE2",163,0)
 I $O(^VA(200,IEN,"NPISTATUS",0))>0 Q
"RTN","XUSNPIE2",164,0)
 N XUFDA
"RTN","XUSNPIE2",165,0)
 I $$GET1^DIQ(200,IEN_",",41.99) S XUFDA(200,IEN_",",41.99)="@"
"RTN","XUSNPIE2",166,0)
 I $$GET1^DIQ(200,IEN_",",41.98)'="" S XUFDA(200,IEN_",",41.98)="@"
"RTN","XUSNPIE2",167,0)
 I $D(XUFDA) D FILE^DIE("","XUFDA")
"RTN","XUSNPIE2",168,0)
 Q
"RTN","XUSNPIE2",169,0)
 ;
"RTN","XUSNPIE2",170,0)
CLERXMPT ; edit entry indicating whether a provider is exempt from needing an NPI
"RTN","XUSNPIE2",171,0)
 N DIC,DIR,FDA,IEN,Y
"RTN","XUSNPIE2",172,0)
 W ! S DIC="^VA(200,",DIC(0)="AEQ" S DIC("A")="select Provider: " D ^DIC Q:Y'>0  S IEN=+Y
"RTN","XUSNPIE2",173,0)
 I $$HASNPI^XUSNPIED(IEN) W !,"This Provider already has an NPI value.  Nothing to do." Q
"RTN","XUSNPIE2",174,0)
 I '$$CHEKNPI^XUSNPIED(IEN),'$$EXMPTNPI^XUSNPIED(IEN) W !,"This Provider does not appear to need an NPI or Exemption." Q
"RTN","XUSNPIE2",175,0)
 I $$EXMPTNPI^XUSNPIED(IEN) D  Q  ; currently marked as Exempt
"RTN","XUSNPIE2",176,0)
 . S DIR(0)="Y",DIR("A")="Provider is currently EXEMPT from needing an NPI, set to NEEDS an NPI (Y/N)" D ^DIR I 'Y Q
"RTN","XUSNPIE2",177,0)
 . S FDA(200,IEN_",",41.98)="N" D FILE^DIE("","FDA")
"RTN","XUSNPIE2",178,0)
 . W !,$S($$NEEDSNPI^XUSNPIED(IEN):"File updated",1:"Ecountered a problem updating file, status NOT set to NEEDS an NPI")
"RTN","XUSNPIE2",179,0)
 . Q
"RTN","XUSNPIE2",180,0)
 ; check to make sure provider should be exempt
"RTN","XUSNPIE2",181,0)
 S DIR(0)="Y",DIR("A")="Confirm that Provider should be Exempt from needing an NPI (Y/N)" D ^DIR I 'Y Q
"RTN","XUSNPIE2",182,0)
 ; and update file to show as exempt
"RTN","XUSNPIE2",183,0)
 S FDA(200,IEN_",",41.98)="E" D FILE^DIE("","FDA")
"RTN","XUSNPIE2",184,0)
 W !,$S($$EXMPTNPI^XUSNPIED(IEN):"File updated",1:"Ecountered a problem updating file, status NOT set to EXEMPT")
"RTN","XUSNPIE2",185,0)
 Q
"VER")
8.0^22.0
**END**
**END**
