Released XU*8*510 SEQ #404
Extracted from mail message
**KIDS**:XU*8.0*510^

**INSTALL NAME**
XU*8.0*510
"BLD",1105,0)
XU*8.0*510^KERNEL^0^3080818^y^^
"BLD",1105,1,0)
^^2^2^3080813^^^
"BLD",1105,1,1,0)
Please see the patch description on FORUM, in the National Patch Module.
"BLD",1105,1,2,0)

"BLD",1105,4,0)
^9.64PA^200^1
"BLD",1105,4,200,0)
200
"BLD",1105,4,200,2,0)
^9.641^200.196^1
"BLD",1105,4,200,2,200.196,0)
ALLOWABLE NEW MENU PREFIX  (sub-file)
"BLD",1105,4,200,2,200.196,1,0)
^9.6411^.01^1
"BLD",1105,4,200,2,200.196,1,.01,0)
ALLOWABLE NEW MENU PREFIX
"BLD",1105,4,200,222)
y^y^p^^^^n^^n
"BLD",1105,4,200,224)

"BLD",1105,4,"APDD",200,200.196)

"BLD",1105,4,"APDD",200,200.196,.01)

"BLD",1105,4,"B",200,200)

"BLD",1105,6)
3^
"BLD",1105,6.3)
6
"BLD",1105,"KRN",0)
^9.67PA^779.2^20
"BLD",1105,"KRN",.4,0)
.4
"BLD",1105,"KRN",.401,0)
.401
"BLD",1105,"KRN",.402,0)
.402
"BLD",1105,"KRN",.403,0)
.403
"BLD",1105,"KRN",.5,0)
.5
"BLD",1105,"KRN",.84,0)
.84
"BLD",1105,"KRN",3.6,0)
3.6
"BLD",1105,"KRN",3.8,0)
3.8
"BLD",1105,"KRN",9.2,0)
9.2
"BLD",1105,"KRN",9.8,0)
9.8
"BLD",1105,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",1105,"KRN",9.8,"NM",1,0)
XQSMDFM^^0^B20840169
"BLD",1105,"KRN",9.8,"NM",2,0)
XQSMD4^^0^B43228635
"BLD",1105,"KRN",9.8,"NM","B","XQSMD4",2)

"BLD",1105,"KRN",9.8,"NM","B","XQSMDFM",1)

"BLD",1105,"KRN",19,0)
19
"BLD",1105,"KRN",19.1,0)
19.1
"BLD",1105,"KRN",101,0)
101
"BLD",1105,"KRN",409.61,0)
409.61
"BLD",1105,"KRN",771,0)
771
"BLD",1105,"KRN",779.2,0)
779.2
"BLD",1105,"KRN",870,0)
870
"BLD",1105,"KRN",8989.51,0)
8989.51
"BLD",1105,"KRN",8989.52,0)
8989.52
"BLD",1105,"KRN",8994,0)
8994
"BLD",1105,"KRN","B",.4,.4)

"BLD",1105,"KRN","B",.401,.401)

"BLD",1105,"KRN","B",.402,.402)

"BLD",1105,"KRN","B",.403,.403)

"BLD",1105,"KRN","B",.5,.5)

"BLD",1105,"KRN","B",.84,.84)

"BLD",1105,"KRN","B",3.6,3.6)

"BLD",1105,"KRN","B",3.8,3.8)

"BLD",1105,"KRN","B",9.2,9.2)

"BLD",1105,"KRN","B",9.8,9.8)

"BLD",1105,"KRN","B",19,19)

"BLD",1105,"KRN","B",19.1,19.1)

"BLD",1105,"KRN","B",101,101)

"BLD",1105,"KRN","B",409.61,409.61)

"BLD",1105,"KRN","B",771,771)

"BLD",1105,"KRN","B",779.2,779.2)

"BLD",1105,"KRN","B",870,870)

"BLD",1105,"KRN","B",8989.51,8989.51)

"BLD",1105,"KRN","B",8989.52,8989.52)

"BLD",1105,"KRN","B",8994,8994)

"BLD",1105,"QUES",0)
^9.62^^
"FIA",200)
NEW PERSON
"FIA",200,0)
^VA(200,
"FIA",200,0,0)
200I
"FIA",200,0,1)
y^y^p^^^^n^^n
"FIA",200,0,10)

"FIA",200,0,11)

"FIA",200,0,"RLRO")

"FIA",200,0,"VR")
8.0^XU
"FIA",200,200)
1
"FIA",200,200,19.6)

"FIA",200,200.196)
1
"FIA",200,200.196,.01)

"MBREQ")
0
"PKG",3,-1)
1^1
"PKG",3,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",3,20,0)
^9.402P^^0
"PKG",3,22,0)
^9.49I^1^1
"PKG",3,22,1,0)
8.0^3080616^3080616^6
"PKG",3,22,1,"PAH",1,0)
510^3080818
"PKG",3,22,1,"PAH",1,1,0)
^^2^2^3080818
"PKG",3,22,1,"PAH",1,1,1,0)
Please see the patch description on FORUM, in the National Patch Module.
"PKG",3,22,1,"PAH",1,1,2,0)

"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","XQSMD4")
0^2^B43228635^B17234528
"RTN","XQSMD4",1,0)
XQSMD4 ; SEA/MJM,JLI - Edit a user's options ;01/25/2008
"RTN","XQSMD4",2,0)
 ;;8.0;KERNEL;**510**;Jul 10, 1995;Build 6
"RTN","XQSMD4",3,0)
 ; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","XQSMD4",4,0)
 ; Option: XQSMD BUILD MENU
"RTN","XQSMD4",5,0)
BUILD ;
"RTN","XQSMD4",6,0)
 N XQNMSP,XQOPT
"RTN","XQSMD4",7,0)
 I '$D(^VA(200,DUZ,19.5,"B")) W !!?7,$C(7),"You haven't been delegated any options with which to build a menu." Q
"RTN","XQSMD4",8,0)
 D NAMESP(.XQNMSP) Q:'$D(XQNMSP)
"RTN","XQSMD4",9,0)
 D ASKOPT(.XQOPT,"M") Q:'$D(XQOPT)
"RTN","XQSMD4",10,0)
 I XQOPT("NEW") D NEW(.XQOPT) Q
"RTN","XQSMD4",11,0)
 D OLD(.XQOPT)
"RTN","XQSMD4",12,0)
 Q
"RTN","XQSMD4",13,0)
ASKOPT(XQOPT,XQTYPE) ;
"RTN","XQSMD4",14,0)
 N XQOPNM
"RTN","XQSMD4",15,0)
 D ASKNAME(.XQOPNM,.XQNMSP,XQTYPE) Q:'$D(XQOPNM)
"RTN","XQSMD4",16,0)
 D ADDFIND(XQOPNM,.XQOPT) Q:'$D(XQOPT)
"RTN","XQSMD4",17,0)
 Q
"RTN","XQSMD4",18,0)
ADDFIND(X,XQOPT) ;
"RTN","XQSMD4",19,0)
 N DIC,Y,DLAYGO
"RTN","XQSMD4",20,0)
 S DIC(0)="MLE",DIC=19,DLAYGO=19
"RTN","XQSMD4",21,0)
 D ^DIC Q:Y<0
"RTN","XQSMD4",22,0)
 S XQOPT("NAME")=$P(Y,U,2)
"RTN","XQSMD4",23,0)
 S XQOPT("IEN")=+Y
"RTN","XQSMD4",24,0)
 S XQOPT("NEW")=$P(Y,U,3)
"RTN","XQSMD4",25,0)
 Q
"RTN","XQSMD4",26,0)
NEW(XQOPT) ;
"RTN","XQSMD4",27,0)
 N DIE,DA,DIC,DR,DLAYGO,X,Y
"RTN","XQSMD4",28,0)
 S DIE=19,DR="1;3.5;4///M;",DA=XQOPT("IEN") D ^DIE ; Enter as new option and force type to be menu
"RTN","XQSMD4",29,0)
 S DIC="^VA(200,DUZ,19.5,",X=XQOPT("NAME"),DIC(0)="MLX",DA(1)=DUZ,DLAYGO=200 D ^DIC Q:Y'>0
"RTN","XQSMD4",30,0)
 D EDIT(.XQOPT)
"RTN","XQSMD4",31,0)
 Q
"RTN","XQSMD4",32,0)
OLD(XQOPT) ;
"RTN","XQSMD4",33,0)
 I $P(^DIC(19,XQOPT("IEN"),0),U,4)'="M" W !,$C(7),"This option already exists but is not a MENU." Q
"RTN","XQSMD4",34,0)
 I '$D(^VA(200,DUZ,19.5,XQOPT("IEN"),0)) W !,$C(7),"This option already exists but is not included in your delegated options.",!,"Choose another option name or get this option delegated to yourself." Q
"RTN","XQSMD4",35,0)
 D EDIT(.XQOPT)
"RTN","XQSMD4",36,0)
 Q
"RTN","XQSMD4",37,0)
EDIT(XQOPT) ;
"RTN","XQSMD4",38,0)
 N XQOUT
"RTN","XQSMD4",39,0)
 W !!,"You may only include options that have been delegated as items to you.",!
"RTN","XQSMD4",40,0)
 S XQOUT=0
"RTN","XQSMD4",41,0)
 F  D  Q:XQOUT
"RTN","XQSMD4",42,0)
 . N DIC,X,Y,XQITEM,XQITEMNM
"RTN","XQSMD4",43,0)
 . I $D(^DIC(19,XQOPT("IEN"),10,"B")) D SHOWITEM
"RTN","XQSMD4",44,0)
 . S DIC("A")="Select Menu Item: "
"RTN","XQSMD4",45,0)
 . S DIC("S")="I +Y'="_XQOPT("IEN") ; Don't select the option as a menu item
"RTN","XQSMD4",46,0)
 . S DIC(0)="AEQMZ"
"RTN","XQSMD4",47,0)
 . S DIC="^VA(200,DUZ,19.5,"
"RTN","XQSMD4",48,0)
 . D ^DIC I Y<0 S XQOUT=1 Q
"RTN","XQSMD4",49,0)
 . S XQITEM("IEN")=+Y ; Menu Item IEN
"RTN","XQSMD4",50,0)
 . S XQITEM("NAME")=Y(0,0) ; Menu Item Name
"RTN","XQSMD4",51,0)
 . I $D(^DIC(19,XQOPT("IEN"),10,"B",XQITEM("IEN"))) D  Q
"RTN","XQSMD4",52,0)
 . . N DIK,DA ; If already there, remove it from menu
"RTN","XQSMD4",53,0)
 . . S DIK="^DIC(19,"_XQOPT("IEN")_",10,",DA(1)=XQOPT("IEN"),DA=$O(^DIC(19,XQOPT("IEN"),10,"B",XQITEM("IEN"),0)) D ^DIK
"RTN","XQSMD4",54,0)
 . . W !,$C(7),"Menu item ",XQITEM("NAME")," deleted from menu."
"RTN","XQSMD4",55,0)
 . . I '$D(^DIC(19,XQOPT("IEN"),10,"B")) D
"RTN","XQSMD4",56,0)
 . . . W !,"This menu contains no menu items."
"RTN","XQSMD4",57,0)
 . . . W !,"It will be deleted if you don't add a menu item."
"RTN","XQSMD4",58,0)
 . . W !
"RTN","XQSMD4",59,0)
 . N X,Y,DIC,DLAYGO,DA,D0
"RTN","XQSMD4",60,0)
 . S X=XQITEM("NAME")
"RTN","XQSMD4",61,0)
 . S DIC(0)="EQML"
"RTN","XQSMD4",62,0)
 . S DLAYGO=19,(D0,DA(1))=XQOPT("IEN")
"RTN","XQSMD4",63,0)
 . S DIC="^DIC(19,"_XQOPT("IEN")_",10,"
"RTN","XQSMD4",64,0)
 . D ^DIC I Y<0 W ! Q
"RTN","XQSMD4",65,0)
 . N DIE,DR,DA
"RTN","XQSMD4",66,0)
 . S DR="2:3;" ; Set SYNONYM and DISPLAY ORDER
"RTN","XQSMD4",67,0)
 . S DIE=DIC,DA=+Y,DA(1)=XQOPT("IEN") D ^DIE
"RTN","XQSMD4",68,0)
 . W !
"RTN","XQSMD4",69,0)
 Q:$O(^DIC(19,XQOPT("IEN"),10,0))
"RTN","XQSMD4",70,0)
 I $D(^VA(200,"AP",XQOPT("IEN"))),'$G(XQOPT("NEW")) D  Q
"RTN","XQSMD4",71,0)
 . D NODEL(.XQOPT)
"RTN","XQSMD4",72,0)
 . W !,"These users now have a Primary Menu with no menu items!",$C(7)
"RTN","XQSMD4",73,0)
 . W !,"Recommend you add some menu items to it."
"RTN","XQSMD4",74,0)
 D DELETE(.XQOPT)
"RTN","XQSMD4",75,0)
 W !!?7,$C(7),"Empty menu removed from option file and your delegated options.",!
"RTN","XQSMD4",76,0)
 Q
"RTN","XQSMD4",77,0)
SHOWITEM ;
"RTN","XQSMD4",78,0)
 N I,XQREC,XQREC0
"RTN","XQSMD4",79,0)
 W !,"This menu contains the following menu items. You may add a new menu item."
"RTN","XQSMD4",80,0)
 W !,"If you select an existing menu item, it will be deleted from the menu.",!
"RTN","XQSMD4",81,0)
 S I=0
"RTN","XQSMD4",82,0)
 F  S I=$O(^DIC(19,XQOPT("IEN"),10,I)) Q:'I  S XQREC=^(I,0) D
"RTN","XQSMD4",83,0)
 . S XQREC0=^DIC(19,+XQREC,0)
"RTN","XQSMD4",84,0)
 . W !,?3,$P(XQREC0,U),?40,$P(XQREC,U,2),?46,$P(XQREC0,U,2)
"RTN","XQSMD4",85,0)
 W !
"RTN","XQSMD4",86,0)
 Q
"RTN","XQSMD4",87,0)
NODEL(XQOPT) ; called by ^XQSMDFM, too
"RTN","XQSMD4",88,0)
 N I
"RTN","XQSMD4",89,0)
 W !!,"This option is used as a Primary Menu for:"
"RTN","XQSMD4",90,0)
 S I=0
"RTN","XQSMD4",91,0)
 F  S I=$O(^VA(200,"AP",XQOPT("IEN"),I)) Q:'I  W !?10,$P(^VA(200,I,0),U)
"RTN","XQSMD4",92,0)
 W !,"Can't delete it while it is used as a primary menu."
"RTN","XQSMD4",93,0)
 Q
"RTN","XQSMD4",94,0)
DELETE(XQOPT) ; called by ^XQSMDFM, too
"RTN","XQSMD4",95,0)
 N DIK,DA
"RTN","XQSMD4",96,0)
 I $G(XQOPT("NEW")) D
"RTN","XQSMD4",97,0)
 . S DIK="^VA(200,DUZ,19.5,",DA(1)=DUZ,DA=XQOPT("IEN") D ^DIK
"RTN","XQSMD4",98,0)
 E  D
"RTN","XQSMD4",99,0)
 . N XQJ
"RTN","XQSMD4",100,0)
 . S XQJ=0
"RTN","XQSMD4",101,0)
 . ; Delete option from all menus
"RTN","XQSMD4",102,0)
 . F  S XQJ=$O(^DIC(19,"AD",XQOPT("IEN"),XQJ)) Q:'XQJ  S DA=$O(^(XQJ,0)),DA(1)=XQJ,DIK="^DIC(19,DA(1),10," D ^DIK
"RTN","XQSMD4",103,0)
 . ; Delete option as a secondary menu option for all users
"RTN","XQSMD4",104,0)
 . F  S XQJ=$O(^VA(200,"AD",XQOPT("IEN"),XQJ)) Q:'XQJ  S DA=$O(^(XQJ,0)),DA(1)=XQJ,DIK="^VA(200,DA(1),203," D ^DIK
"RTN","XQSMD4",105,0)
 . ; Delete option as delegated option for all users
"RTN","XQSMD4",106,0)
 . F  S XQJ=$O(^VA(200,XQJ)) Q:'XQJ  I $D(^(XQJ,19.5,"B",XQOPT("IEN"))) S DA=XQOPT("IEN"),DA(1)=XQJ,DIK="^VA(200,DA(1),19.5," D ^DIK
"RTN","XQSMD4",107,0)
 S DIK="^DIC(19,",DA=XQOPT("IEN") D ^DIK ; Delete option
"RTN","XQSMD4",108,0)
 Q
"RTN","XQSMD4",109,0)
NAMESP(XQNMSP) ; Check for available namespaces. Called by ^XQSMDFM, too.
"RTN","XQSMD4",110,0)
 N I
"RTN","XQSMD4",111,0)
 S I=0
"RTN","XQSMD4",112,0)
 F  S I=$O(^VA(200,DUZ,19.6,"B",I)) Q:I=""  S XQNMSP=$G(XQNMSP)+1,XQNMSP(I)=""
"RTN","XQSMD4",113,0)
 I $D(XQNMSP) D HLPNAME Q
"RTN","XQSMD4",114,0)
 I $D(^VA(200,DUZ,19.6)) K ^(19.6)
"RTN","XQSMD4",115,0)
 W !!?7,$C(7),"No namespace(s) have been set up for you to build new menus.",!?7,"Contact your computer service representative."
"RTN","XQSMD4",116,0)
 Q
"RTN","XQSMD4",117,0)
HLPNAME ;
"RTN","XQSMD4",118,0)
 N I
"RTN","XQSMD4",119,0)
 W !?7,"The options you build or edit must begin with ",$S(XQNMSP>1:"one of ",1:""),!?7,"the following namespace",$S(XQNMSP>1:"(s)",1:"")," and be no more than 30 characters long:",!
"RTN","XQSMD4",120,0)
 S I=""
"RTN","XQSMD4",121,0)
 F  S I=$O(XQNMSP(I)) Q:I=""  W !?35,$S($E(I,1)="A":I,1:I_"Z")
"RTN","XQSMD4",122,0)
 W !
"RTN","XQSMD4",123,0)
 Q:"^P^I^E^M^"'[(U_$G(XQTYPE)_U)
"RTN","XQSMD4",124,0)
 N I,XQM,XQREC
"RTN","XQSMD4",125,0)
 S I=0
"RTN","XQSMD4",126,0)
 F  S I=$O(^VA(200,DUZ,19.5,"B",I)) Q:'I  D
"RTN","XQSMD4",127,0)
 . S XQREC=$G(^DIC(19,I,0)) Q:$P(XQREC,U,4)'=XQTYPE
"RTN","XQSMD4",128,0)
 . S XQM($P(XQREC,U))=$P(XQREC,U,2)
"RTN","XQSMD4",129,0)
 I '$D(XQM) W !?7,"You have no existing delegated "_$$TYPE(XQTYPE)_" options. You may enter a new one." Q
"RTN","XQSMD4",130,0)
 W !,"The following are your existing delegated "_$$TYPE(XQTYPE)_" options:"
"RTN","XQSMD4",131,0)
 F  S I=$O(XQM(I)) Q:I=""  W !,I,?40,XQM(I)
"RTN","XQSMD4",132,0)
 Q
"RTN","XQSMD4",133,0)
TYPE(XQT) ;
"RTN","XQSMD4",134,0)
 Q $S(XQT="P":"Print",XQT="I":"Inquire",XQT="E":"Edit",1:"Menu")
"RTN","XQSMD4",135,0)
ASKNAME(XQOPNM,XQNMSP,XQTYPE)  ;Check for a valid option names.
"RTN","XQSMD4",136,0)
 ;Called by ^XQSMDFM, too.
"RTN","XQSMD4",137,0)
 ;XU*8*428 also allows for local namespaces, e.g., A5A, AFS, etc.
"RTN","XQSMD4",138,0)
 F  D  Q:$D(DIRUT)!$D(XQOPNM)
"RTN","XQSMD4",139,0)
 . N DIR,X,Y
"RTN","XQSMD4",140,0)
 . S DIR("A")="Option Name"
"RTN","XQSMD4",141,0)
 . S DIR("PRE")="D CHKNAME^XQSMD4"
"RTN","XQSMD4",142,0)
 . S DIR("?")="^D HLPNAME^XQSMD4"
"RTN","XQSMD4",143,0)
 . S DIR(0)="F^3:30"
"RTN","XQSMD4",144,0)
 . D ^DIR Q:$D(DIRUT)
"RTN","XQSMD4",145,0)
 . S XQOPNM=Y
"RTN","XQSMD4",146,0)
 Q
"RTN","XQSMD4",147,0)
CHKNAME ;
"RTN","XQSMD4",148,0)
 I $D(DTOUT)!(X[U)!(X["?") Q
"RTN","XQSMD4",149,0)
 I X="" S X=U Q
"RTN","XQSMD4",150,0)
 N I
"RTN","XQSMD4",151,0)
 S I=""
"RTN","XQSMD4",152,0)
 F  S I=$O(XQNMSP(I)) Q:I=""  Q:$E(I,1)="A"&($E(X,1,$L(I))=I)  Q:$E(X,1,$L(I))=I&($E(X,$L(I)+1)="Z")
"RTN","XQSMD4",153,0)
 Q:I'=""
"RTN","XQSMD4",154,0)
 W $C(7),!!?7,$E(X,1,4),"* is not a valid namespace for you.",!
"RTN","XQSMD4",155,0)
 K X
"RTN","XQSMD4",156,0)
 Q
"RTN","XQSMDFM")
0^1^B20840169^B27672564
"RTN","XQSMDFM",1,0)
XQSMDFM ;ISC-SF(SEA)/JLI,MJM - PERMIT USER TO BUILD LIMITED FM OPTIONS ;01/25/2008
"RTN","XQSMDFM",2,0)
 ;;8.0;KERNEL;**510**;Jul 10, 1995;Build 6
"RTN","XQSMDFM",3,0)
 ; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","XQSMDFM",4,0)
 ; Option: XQSMD LIMITED FM OPTIONS
"RTN","XQSMDFM",5,0)
RULES ;
"RTN","XQSMDFM",6,0)
 N XQNMSP,XQTYPE
"RTN","XQSMDFM",7,0)
 D NAMESP^XQSMD4(.XQNMSP) Q:'$D(XQNMSP)  ; User must have namespace to use.
"RTN","XQSMDFM",8,0)
 D ASKTYPE(.XQTYPE) Q:'$D(XQTYPE)
"RTN","XQSMDFM",9,0)
 D @XQTYPE
"RTN","XQSMDFM",10,0)
 Q
"RTN","XQSMDFM",11,0)
ASKTYPE(XQTYPE) ;
"RTN","XQSMDFM",12,0)
 W !,"The option types that may be built are P(rint), E(dit), and I(nquire),"
"RTN","XQSMDFM",13,0)
 W !,"and you must have template(s) ready to be included in the option."
"RTN","XQSMDFM",14,0)
 W !,"You may also enter D(elete) to delete an option."
"RTN","XQSMDFM",15,0)
 N DIR,X,Y,DIRUT
"RTN","XQSMDFM",16,0)
 S DIR("A")="Select Option Type"
"RTN","XQSMDFM",17,0)
 S DIR(0)="S^E:Edit"
"RTN","XQSMDFM",18,0)
 S DIR(0)=DIR(0)_";P:Print"
"RTN","XQSMDFM",19,0)
 S DIR(0)=DIR(0)_";I:Inquire"
"RTN","XQSMDFM",20,0)
 S DIR(0)=DIR(0)_";D:Delete"
"RTN","XQSMDFM",21,0)
 D ^DIR Q:$D(DIRUT)
"RTN","XQSMDFM",22,0)
 S XQTYPE=Y
"RTN","XQSMDFM",23,0)
 Q
"RTN","XQSMDFM",24,0)
D ; Delete
"RTN","XQSMDFM",25,0)
 N DIC,X,Y,XQOPT
"RTN","XQSMDFM",26,0)
 S DIC("A")="Select Option to Delete: "
"RTN","XQSMDFM",27,0)
 S DIC(0)="AEQMZ"
"RTN","XQSMDFM",28,0)
 S DIC="^VA(200,DUZ,19.5,"
"RTN","XQSMDFM",29,0)
 D ^DIC Q:Y<0
"RTN","XQSMDFM",30,0)
 S XQOPT("IEN")=+Y ; Option IEN
"RTN","XQSMDFM",31,0)
 S XQOPT("NAME")=Y(0,0) ; Option Name
"RTN","XQSMDFM",32,0)
 I $D(^VA(200,"AP",XQOPT("IEN"))) D NODEL^XQSMD4(.XQOPT) Q
"RTN","XQSMDFM",33,0)
 N DIR,X,Y,DIRUT
"RTN","XQSMDFM",34,0)
 S DIR("A")="Do you really want to delete "_XQOPT("NAME")
"RTN","XQSMDFM",35,0)
 S DIR("B")="No"
"RTN","XQSMDFM",36,0)
 S DIR(0)="Y"
"RTN","XQSMDFM",37,0)
 D ^DIR Q:'Y
"RTN","XQSMDFM",38,0)
 D DELETE^XQSMD4(.XQOPT)
"RTN","XQSMDFM",39,0)
 Q
"RTN","XQSMDFM",40,0)
E ; Edit
"RTN","XQSMDFM",41,0)
 N XQTMPLE,DIR,X,Y,DIRUT,DR
"RTN","XQSMDFM",42,0)
 D ASKTMPL("Edit","^DIE(",.XQTMPLE) Q:'$D(XQTMPLE)
"RTN","XQSMDFM",43,0)
 S DIR(0)="Y"
"RTN","XQSMDFM",44,0)
 S DIR("A")="Should the user be allowed to ADD a new "_XQTMPLE("FNAME")_" file entry"
"RTN","XQSMDFM",45,0)
 S DIR("B")="No"
"RTN","XQSMDFM",46,0)
 D ^DIR Q:$D(DIRUT)
"RTN","XQSMDFM",47,0)
 S XQTMPLE("ADD")=Y
"RTN","XQSMDFM",48,0)
 S DR="1;3.5;4///E;30///"_XQTMPLE("FGLOB")_";31///AEMQ"_$S(XQTMPLE("ADD"):"L",1:"")_";50///"_XQTMPLE("FGLOB")_";51///["_XQTMPLE("NAME")_"];"
"RTN","XQSMDFM",49,0)
 D CRE8OPT(DR)
"RTN","XQSMDFM",50,0)
 Q
"RTN","XQSMDFM",51,0)
I ; Inquire
"RTN","XQSMDFM",52,0)
 N XQTMPLP,DR
"RTN","XQSMDFM",53,0)
 D ASKTMPL("Print","^DIPT(",.XQTMPLP,1) Q:'$D(XQTMPLP)
"RTN","XQSMDFM",54,0)
 S DR="1;3.5;4///I;30///"_XQTMPLP("FGLOB")_";31///AEMQ;80///"_XQTMPLP("FGLOB")_";"
"RTN","XQSMDFM",55,0)
 I $D(XQTMPLP("NAME")) S DR=DR_"63///["_XQTMPLP("NAME")_"];"
"RTN","XQSMDFM",56,0)
 D CRE8OPT(DR)
"RTN","XQSMDFM",57,0)
 Q
"RTN","XQSMDFM",58,0)
P ; Print
"RTN","XQSMDFM",59,0)
 N XQTMPLP,XQTMPLS,DR
"RTN","XQSMDFM",60,0)
 D ASKTMPL("Sort","^DIBT(",.XQTMPLS) Q:'$D(XQTMPLS)
"RTN","XQSMDFM",61,0)
 S XQTMPLP("FNUM")=XQTMPLS("FNUM"),XQTMPLP("FNAME")=XQTMPLS("FNAME"),XQTMPLP("FGLOB")=XQTMPLS("FGLOB")
"RTN","XQSMDFM",62,0)
 D ASKTMPL("Print","^DIPT(",.XQTMPLP) Q:'$D(XQTMPLP)
"RTN","XQSMDFM",63,0)
 S DR="1;3.5;4///P;60///"_XQTMPLP("FGLOB")_";62///0;63///["_XQTMPLP("NAME")_"];64///["_XQTMPLS("NAME")_"];"
"RTN","XQSMDFM",64,0)
 D CRE8OPT(DR)
"RTN","XQSMDFM",65,0)
 Q
"RTN","XQSMDFM",66,0)
ASKTMPL(XQADJ,XQFILE,XQTMPL,XQOPTNL) ;
"RTN","XQSMDFM",67,0)
 N DIC,X,Y,DTOUT,DUOUT
"RTN","XQSMDFM",68,0)
 I '$D(XQTMPL("FNUM")) D ASKFILE(.XQTMPL) Q:'$D(XQTMPL("FNUM"))
"RTN","XQSMDFM",69,0)
 S DIC("A")="Select "_XQADJ_" Template"_$S($G(XQOPTNL):" (Optional)",1:"")_": "
"RTN","XQSMDFM",70,0)
 S DIC("S")="I $P(^(0),U,4)="_XQTMPL("FNUM")
"RTN","XQSMDFM",71,0)
 S DIC(0)="AEQMZ"
"RTN","XQSMDFM",72,0)
 S DIC=XQFILE
"RTN","XQSMDFM",73,0)
 D ^DIC I Y<0 D  Q
"RTN","XQSMDFM",74,0)
 . I '$G(XQOPTNL) K XQTMPL Q
"RTN","XQSMDFM",75,0)
 . I $D(DUOUT)!$D(DTOUT) K XQTMPL
"RTN","XQSMDFM",76,0)
 S XQTMPL("NAME")=Y(0,0) ; Template Name
"RTN","XQSMDFM",77,0)
 ;S XQTMPL("FNUM")=$P(Y(0),U,4) ; File Number
"RTN","XQSMDFM",78,0)
 ;S XQTMPL("FNAME")=$P(^DIC(XQTMPL("FNUM"),0),U) ; File Name
"RTN","XQSMDFM",79,0)
 Q
"RTN","XQSMDFM",80,0)
ASKFILE(XQTMPL) ;
"RTN","XQSMDFM",81,0)
 N DIC,X,Y
"RTN","XQSMDFM",82,0)
 S DIC=1
"RTN","XQSMDFM",83,0)
 S DIC(0)="AEQM"
"RTN","XQSMDFM",84,0)
 S DIC("S")="I $$ACCESS^XQSMDFM(+Y)"
"RTN","XQSMDFM",85,0)
 D ^DIC Q:Y<0
"RTN","XQSMDFM",86,0)
 S XQTMPL("FNUM")=+Y
"RTN","XQSMDFM",87,0)
 S XQTMPL("FNAME")=$P(Y,U,2)
"RTN","XQSMDFM",88,0)
 S XQTMPL("FGLOB")=$P(^DIC(XQTMPL("FNUM"),0,"GL"),U,2)
"RTN","XQSMDFM",89,0)
 Q
"RTN","XQSMDFM",90,0)
CRE8OPT(DR) ;
"RTN","XQSMDFM",91,0)
 N DIE,DA,XQOPT,DIC,DLAYGO,X
"RTN","XQSMDFM",92,0)
AGAIN ;
"RTN","XQSMDFM",93,0)
 D ASKOPT^XQSMD4(.XQOPT,XQTYPE) Q:'$D(XQOPT)
"RTN","XQSMDFM",94,0)
 I 'XQOPT("NEW") I '$$SURE K XQOPT G AGAIN
"RTN","XQSMDFM",95,0)
 S DIE=19,DA=XQOPT("IEN") D ^DIE
"RTN","XQSMDFM",96,0)
 S DIC="^VA(200,DUZ,19.5,",X=XQOPT("NAME"),DIC(0)="MLX",DA(1)=DUZ,DLAYGO=200 D ^DIC
"RTN","XQSMDFM",97,0)
 Q
"RTN","XQSMDFM",98,0)
SURE() ;
"RTN","XQSMDFM",99,0)
 N DIR,X,Y,XQT
"RTN","XQSMDFM",100,0)
 S XQT=$P(^DIC(19,XQOPT("IEN"),0),U,4)
"RTN","XQSMDFM",101,0)
 W !,"This is an existing "_$$TYPE^XQSMD4(XQT)_" option."
"RTN","XQSMDFM",102,0)
 I '$D(^VA(200,DUZ,19.5,XQOPT("IEN"),0)) W !,$C(7),"It is not included in your delegated options." Q 0
"RTN","XQSMDFM",103,0)
 I XQT'=XQTYPE W !,"It may not be changed to a different type of option." Q 0
"RTN","XQSMDFM",104,0)
 S DIR("A")="Are you sure you wish to change it?"
"RTN","XQSMDFM",105,0)
 S DIR("B")="No"
"RTN","XQSMDFM",106,0)
 D ^DIR
"RTN","XQSMDFM",107,0)
 Q Y
"RTN","XQSMDFM",108,0)
ACCESS(XQFNUM) ; See if user has file access
"RTN","XQSMDFM",109,0)
 N XQYZ,XQNODE,XQPIECE
"RTN","XQSMDFM",110,0)
 I XQTYPE="E" S XQNODE="WR",XQPIECE=6
"RTN","XQSMDFM",111,0)
 E  S XQNODE="RD",XQPIECE=5
"RTN","XQSMDFM",112,0)
 S XQYZ=$G(^DIC(XQFNUM,0,XQNODE)) Q:XQYZ="" 1
"RTN","XQSMDFM",113,0)
 I $D(^VA(200,"AFOF")) Q $P($G(^VA(200,DUZ,"FOF",XQFNUM,0)),U,XQPIECE)>0
"RTN","XQSMDFM",114,0)
 ;If Part 3 hasn't been run, check old style FM access codes
"RTN","XQSMDFM",115,0)
 N XQACC,XQFMA,I
"RTN","XQSMDFM",116,0)
 S XQACC=0
"RTN","XQSMDFM",117,0)
 S XQFMA=$P(^VA(200,DUZ,0),U,4) Q:XQFMA="" 0
"RTN","XQSMDFM",118,0)
 F I=1:1:$L(XQFMA) I XQYZ[$E(XQFMA,I) S XQACC=1 Q
"RTN","XQSMDFM",119,0)
 Q XQACC
"UP",200,200.196,-1)
200^19.6
"UP",200,200.196,0)
200.196
"VER")
8.0^22.0
"^DD",200,200,19.6,0)
ALLOWABLE NEW MENU PREFIX^200.196A^^19.6;0
"^DD",200,200,19.6,21,0)
^.001^3^3^3080204^^^^
"^DD",200,200,19.6,21,1,0)
This subfile holds the set of namespaces available to this user in
"^DD",200,200,19.6,21,2,0)
the creation of menus with delegated options.
"^DD",200,200,19.6,21,3,0)

"^DD",200,200.196,0)
ALLOWABLE NEW MENU PREFIX SUB-FIELD^^.01^1
"^DD",200,200.196,0,"NM","ALLOWABLE NEW MENU PREFIX")

"^DD",200,200.196,.01,0)
ALLOWABLE NEW MENU PREFIX^MF^^0;1^K:$L(X)>4!($L(X)<2)!'(X?1U1UN.UN) X
"^DD",200,200.196,.01,1,0)
^.1
"^DD",200,200.196,.01,1,1,0)
200.196^B
"^DD",200,200.196,.01,1,1,1)
S ^VA(200,DA(1),19.6,"B",$E(X,1,30),DA)=""
"^DD",200,200.196,.01,1,1,2)
K ^VA(200,DA(1),19.6,"B",$E(X,1,30),DA)
"^DD",200,200.196,.01,3)
Enter locally assigned name space, e.g. AFS (preferred), or a package namespace, e.g. LR, to which the user must add a Z, e.g. LRZ.
"^DD",200,200.196,.01,21,0)
^.001^6^6^3080204^^^^
"^DD",200,200.196,.01,21,1,0)
This menu prefix, used by the delegate to create local options,
"^DD",200,200.196,.01,21,2,0)
can be in one of two forms: An assigned local namespace beginning
"^DD",200,200.196,.01,21,3,0)
with the letter "A", such as A6A (preferred), or a package namespace,
"^DD",200,200.196,.01,21,4,0)
such as LR to which the user must add the letter "Z", .e.g. LRZ,
"^DD",200,200.196,.01,21,5,0)
(discouraged) to avoid conflict with national releases.
"^DD",200,200.196,.01,21,6,0)

"^DD",200,200.196,.01,"DT")
3080204
"BLD",1105,6)
^404
**END**
**END**
