Released XU*8*480 SEQ #398
Extracted from mail message
**KIDS**:XU*8.0*480^

**INSTALL NAME**
XU*8.0*480
"BLD",7024,0)
XU*8.0*480^KERNEL^0^3080606^y
"BLD",7024,1,0)
^^1^1^3080603^^
"BLD",7024,1,1,0)
Please see FORUM patch module for details.
"BLD",7024,4,0)
^9.64PA^200^1
"BLD",7024,4,200,0)
200
"BLD",7024,4,200,2,0)
^9.641^200^1
"BLD",7024,4,200,2,200,0)
NEW PERSON  (File-top level)
"BLD",7024,4,200,2,200,1,0)
^9.6411^41.97^1
"BLD",7024,4,200,2,200,1,41.97,0)
AUTHORIZE RELEASE OF NPI
"BLD",7024,4,200,222)
y^y^p^^^^n^^n
"BLD",7024,4,200,224)
 
"BLD",7024,4,"APDD",200,200)
 
"BLD",7024,4,"APDD",200,200,41.97)
 
"BLD",7024,4,"B",200,200)
 
"BLD",7024,6)
17^
"BLD",7024,6.3)
38
"BLD",7024,"ABPKG")
n
"BLD",7024,"INID")
^n
"BLD",7024,"INIT")
POST^XU8P480
"BLD",7024,"KRN",0)
^9.67PA^8989.52^19
"BLD",7024,"KRN",.4,0)
.4
"BLD",7024,"KRN",.4,"NM",0)
^9.68A^^0
"BLD",7024,"KRN",.401,0)
.401
"BLD",7024,"KRN",.402,0)
.402
"BLD",7024,"KRN",.403,0)
.403
"BLD",7024,"KRN",.5,0)
.5
"BLD",7024,"KRN",.84,0)
.84
"BLD",7024,"KRN",3.6,0)
3.6
"BLD",7024,"KRN",3.8,0)
3.8
"BLD",7024,"KRN",9.2,0)
9.2
"BLD",7024,"KRN",9.8,0)
9.8
"BLD",7024,"KRN",9.8,"NM",0)
^9.68A^8^8
"BLD",7024,"KRN",9.8,"NM",1,0)
XUSNPI^^0^B63514631
"BLD",7024,"KRN",9.8,"NM",2,0)
XUSERNEW^^0^B24383535
"BLD",7024,"KRN",9.8,"NM",3,0)
XUSNPIED^^0^B24968351
"BLD",7024,"KRN",9.8,"NM",4,0)
XUSNPIE1^^0^B15300096
"BLD",7024,"KRN",9.8,"NM",5,0)
XUSNPIE2^^0^B76313807
"BLD",7024,"KRN",9.8,"NM",6,0)
XUSNPI1^^0^B51240975
"BLD",7024,"KRN",9.8,"NM",7,0)
XUSNPIE3^^0^B53683748
"BLD",7024,"KRN",9.8,"NM",8,0)
XUSNPIDA^^0^B46153609
"BLD",7024,"KRN",9.8,"NM","B","XUSERNEW",2)
 
"BLD",7024,"KRN",9.8,"NM","B","XUSNPI",1)
 
"BLD",7024,"KRN",9.8,"NM","B","XUSNPI1",6)
 
"BLD",7024,"KRN",9.8,"NM","B","XUSNPIDA",8)
 
"BLD",7024,"KRN",9.8,"NM","B","XUSNPIE1",4)
 
"BLD",7024,"KRN",9.8,"NM","B","XUSNPIE2",5)
 
"BLD",7024,"KRN",9.8,"NM","B","XUSNPIE3",7)
 
"BLD",7024,"KRN",9.8,"NM","B","XUSNPIED",3)
 
"BLD",7024,"KRN",19,0)
19
"BLD",7024,"KRN",19,"NM",0)
^9.68A^^0
"BLD",7024,"KRN",19.1,0)
19.1
"BLD",7024,"KRN",19.1,"NM",0)
^9.68A^2^1
"BLD",7024,"KRN",19.1,"NM",2,0)
XUSNPIMTL^^0
"BLD",7024,"KRN",19.1,"NM","B","XUSNPIMTL",2)

"BLD",7024,"KRN",101,0)
101
"BLD",7024,"KRN",409.61,0)
409.61
"BLD",7024,"KRN",771,0)
771
"BLD",7024,"KRN",870,0)
870
"BLD",7024,"KRN",8989.51,0)
8989.51
"BLD",7024,"KRN",8989.52,0)
8989.52
"BLD",7024,"KRN",8994,0)
8994
"BLD",7024,"KRN","B",.4,.4)
 
"BLD",7024,"KRN","B",.401,.401)
 
"BLD",7024,"KRN","B",.402,.402)
 
"BLD",7024,"KRN","B",.403,.403)
 
"BLD",7024,"KRN","B",.5,.5)
 
"BLD",7024,"KRN","B",.84,.84)
 
"BLD",7024,"KRN","B",3.6,3.6)
 
"BLD",7024,"KRN","B",3.8,3.8)
 
"BLD",7024,"KRN","B",9.2,9.2)
 
"BLD",7024,"KRN","B",9.8,9.8)
 
"BLD",7024,"KRN","B",19,19)
 
"BLD",7024,"KRN","B",19.1,19.1)
 
"BLD",7024,"KRN","B",101,101)
 
"BLD",7024,"KRN","B",409.61,409.61)
 
"BLD",7024,"KRN","B",771,771)
 
"BLD",7024,"KRN","B",870,870)
 
"BLD",7024,"KRN","B",8989.51,8989.51)
 
"BLD",7024,"KRN","B",8989.52,8989.52)
 
"BLD",7024,"KRN","B",8994,8994)
 
"BLD",7024,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",7024,"QUES",0)
^9.62^^
"FIA",200)
NEW PERSON
"FIA",200,0)
^VA(200,
"FIA",200,0,0)
200Is
"FIA",200,0,1)
y^y^p^^^^n^^n
"FIA",200,0,10)

"FIA",200,0,11)
 
"FIA",200,0,"RLRO")

"FIA",200,0,"VR")
8.0^XU
"FIA",200,200)
1
"FIA",200,200,41.97)
 
"INIT")
POST^XU8P480
"KRN",19.1,743,-1)
0^2
"KRN",19.1,743,0)
XUSNPIMTL^Access Option XUS NPI MENU^l^n^0
"KRN",19.1,743,1,0)
^^4^4^3080328^
"KRN",19.1,743,1,1,0)
People who hold this security key will be allowed to access the NPI
"KRN",19.1,743,1,2,0)
(National Provider ID) Menu option (XUS NPI MENU). This is normally 
"KRN",19.1,743,1,3,0)
assigned to the Local NPI Maintenance Team Leader, the person with 
"KRN",19.1,743,1,4,0)
authority to assign/edit VA Provider NPIs.
"MBREQ")
0
"ORD",3,19.1)
19.1;3;1;;KEY^XPDTA1;;;KEYF2^XPDIA1;;KEYDEL^XPDIA1
"ORD",3,19.1,0)
SECURITY KEY
"PKG",173,-1)
1^1
"PKG",173,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",173,22,0)
^9.49I^1^1
"PKG",173,22,1,0)
8.0^2950703^2951015^1
"PKG",173,22,1,"PAH",1,0)
480^3080606^520665222
"PKG",173,22,1,"PAH",1,1,0)
^^1^1^3080606
"PKG",173,22,1,"PAH",1,1,1,0)
Please see FORUM patch module for details.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
9
"RTN","XU8P480")
0^^B11948008^n/a
"RTN","XU8P480",1,0)
XU8P480 ;OAK_TKW - POST-INSTALL ROUTINE FOR XU*8*480 ;6/6/08  13:21
"RTN","XU8P480",2,0)
 ;;8.0;KERNEL;**480**; July 10, 1995;Build 38
"RTN","XU8P480",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified
"RTN","XU8P480",4,0)
POST ; run post-init routine
"RTN","XU8P480",5,0)
 ; Assign security key XUSNPIMTL to users with XUS NPI MENU option
"RTN","XU8P480",6,0)
 N XUSIEN,XUSSIEN,XUSOIEN,XUSXREF,CNT,X,Y
"RTN","XU8P480",7,0)
 K ^TMP("DIERR",$J)
"RTN","XU8P480",8,0)
 D MES^XPDUTL("Assigning new security key XUSNPIMTL to users with XUS NPI MENU option...")
"RTN","XU8P480",9,0)
 ; Find IEN of security key XUSNPIMTL and option XUS NPI MENU
"RTN","XU8P480",10,0)
 S XUSSIEN=$$FIND1^DIC(19.1,,"QX","XUSNPIMTL","B")
"RTN","XU8P480",11,0)
 I 'XUSSIEN!($D(^TMP("DIERR",$J))) D  Q
"RTN","XU8P480",12,0)
 . D MES^XPDUTL("  **Security Key 'XUSNPIMTL' is not on your system")
"RTN","XU8P480",13,0)
 . D POST2 Q
"RTN","XU8P480",14,0)
 S XUSOIEN=$$FIND1^DIC(19,,"QX","XUS NPI MENU","B")
"RTN","XU8P480",15,0)
 I 'XUSOIEN!($D(^TMP("DIERR",$J))) D  Q
"RTN","XU8P480",16,0)
 . D MES^XPDUTL("  **OPTION 'XUS NPI MENU' is not on your system")
"RTN","XU8P480",17,0)
 . D POST2 Q
"RTN","XU8P480",18,0)
 ; Build list of users who hold the menu option 
"RTN","XU8P480",19,0)
 K ^TMP($J,"XU8P480")
"RTN","XU8P480",20,0)
 F XUSXREF="AD","AP" D
"RTN","XU8P480",21,0)
 . F XUSIEN=0:0 S XUSIEN=$O(^VA(200,XUSXREF,XUSOIEN,XUSIEN)) Q:'XUSIEN  D
"RTN","XU8P480",22,0)
 . . Q:'$D(^VA(200,XUSIEN,.1))
"RTN","XU8P480",23,0)
 . . Q:'$$ACTIVE^XUSER(XUSIEN)
"RTN","XU8P480",24,0)
 . . S ^TMP($J,"XU8P480",XUSIEN)=""
"RTN","XU8P480",25,0)
 . . Q
"RTN","XU8P480",26,0)
 . Q
"RTN","XU8P480",27,0)
 I '$D(^TMP($J,"XU8P480")) D  Q
"RTN","XU8P480",28,0)
 . D MES^XPDUTL("  *No users were found with access to the XUS NPI MENU option.")
"RTN","XU8P480",29,0)
 . D MES^XPDUTL("  *Key 'XUSNPIMTL' was not assigned to any users.")
"RTN","XU8P480",30,0)
 . D POST2 Q
"RTN","XU8P480",31,0)
 ; Assign the key XUSNPIMTL to the users
"RTN","XU8P480",32,0)
 N DIC,DA,DINUM
"RTN","XU8P480",33,0)
 F XUSIEN=0:0 S XUSIEN=$O(^TMP($J,"XU8P480",XUSIEN)) Q:'XUSIEN  D
"RTN","XU8P480",34,0)
 . Q:$D(^VA(200,XUSIEN,51,XUSSIEN))
"RTN","XU8P480",35,0)
 . S DIC(0)="NLX",DIC("P")="200.051PA",DIC="^VA(200,XUSIEN,51,",DA(1)=XUSIEN
"RTN","XU8P480",36,0)
 . S X=XUSSIEN,DINUM=X D FILE^DICN
"RTN","XU8P480",37,0)
 . I Y>0 D MES^XPDUTL("  Key assigned to "_$P(^VA(200,XUSIEN,0),"^"))
"RTN","XU8P480",38,0)
 . Q
"RTN","XU8P480",39,0)
 K ^TMP($J,"XU8P480")
"RTN","XU8P480",40,0)
POST2 ; Initialize new field 41.97 AUTHORIZES RELEASE OF NPI to 1 (Yes)
"RTN","XU8P480",41,0)
 ; on all provider entries in file 200
"RTN","XU8P480",42,0)
 D BMES^XPDUTL("Initializing AUTHORIZE RELEASE OF NPI field to 1 (Yes)...")
"RTN","XU8P480",43,0)
 N XUSAUTH
"RTN","XU8P480",44,0)
 S CNT=0
"RTN","XU8P480",45,0)
 F XUSIEN=0:0 S XUSIEN=$O(^VA(200,XUSIEN)) Q:'XUSIEN  D
"RTN","XU8P480",46,0)
 . ; Only update providers who have an NPI field.
"RTN","XU8P480",47,0)
 . S X=$G(^VA(200,XUSIEN,"NPI"))
"RTN","XU8P480",48,0)
 . S XUSAUTH=$P(X,"^",3)
"RTN","XU8P480",49,0)
 . I $P(X,U)="",$O(^VA(200,XUSIEN,"NPISTATUS",0))'>0 D  Q
"RTN","XU8P480",50,0)
 . . Q:XUSAUTH=""
"RTN","XU8P480",51,0)
 . . S $P(^VA(200,XUSIEN,"NPI"),"^",3)=""
"RTN","XU8P480",52,0)
 . . Q
"RTN","XU8P480",53,0)
 . Q:XUSAUTH=1
"RTN","XU8P480",54,0)
 . S $P(^VA(200,XUSIEN,"NPI"),"^",3)=1
"RTN","XU8P480",55,0)
 . S CNT=CNT+1
"RTN","XU8P480",56,0)
 . Q
"RTN","XU8P480",57,0)
 D MES^XPDUTL("  AUTHORIZE RELEASE OF NPI field was set on "_CNT_" providers")
"RTN","XU8P480",58,0)
 ; Rebuild list of taxonomy values for providers normally assigned NPIs.
"RTN","XU8P480",59,0)
 D BMES^XPDUTL("Rebuilding temporary list of taxonomy values for providers who are")
"RTN","XU8P480",60,0)
 D MES^XPDUTL(" normally assigned NPIs...")
"RTN","XU8P480",61,0)
 K ^XTMP("NPIVALS")
"RTN","XU8P480",62,0)
 S X=$$CHKGLOB^XUSNPIDA()
"RTN","XU8P480",63,0)
 ; Add key XUSNPIMTL to the option XUS NPI MENU
"RTN","XU8P480",64,0)
 N XUSMIEN,XUSFDA,XUSIEN
"RTN","XU8P480",65,0)
 S XUSMIEN=$$LKOPT^XPDMENU("XUS NPI MENU")
"RTN","XU8P480",66,0)
 I 'XUSMIEN D BMES^XPDUTL("****WARNING - Menu Option XUS NPI MENU is not on your system!!! *****") Q
"RTN","XU8P480",67,0)
 K XUSFDA
"RTN","XU8P480",68,0)
 S XUSFDA(19,XUSMIEN_",",3)="XUSNPIMTL"
"RTN","XU8P480",69,0)
 D FILE^DIE("","XUSFDA")
"RTN","XU8P480",70,0)
 K XUSFDA
"RTN","XU8P480",71,0)
 ; Remove menu option that was added during testing. The AUTHORIZE USE OF NPI flag was
"RTN","XU8P480",72,0)
 ; discontinued before patch XU*8*480 was released.
"RTN","XU8P480",73,0)
 ; 
"RTN","XU8P480",74,0)
 ; QUIT if option to edit AUTHORIZE USE OF NPI does not exist on this system.
"RTN","XU8P480",75,0)
 S XUSIEN=$$FIND1^DIC(19,"","QX","XUS NPI EDIT AUTH TO RELEASE","B")
"RTN","XU8P480",76,0)
 Q:'XUSIEN
"RTN","XU8P480",77,0)
 ; Quit if option to edit AUTHORIZE USE OF NPI is not on the main NPI menu.
"RTN","XU8P480",78,0)
 S X=$$FIND1^DIC(19.01,","_XUSMIEN_",","","XUS NPI EDIT AUTH TO RELEASE")
"RTN","XU8P480",79,0)
 ; Delete the option to edit AUTHORIZE USE OF NPI from main menu, then delete the option.
"RTN","XU8P480",80,0)
 I X D
"RTN","XU8P480",81,0)
 . S XUSFDA(19.01,X_","_XUSMIEN_",",.01)="@"
"RTN","XU8P480",82,0)
 . D FILE^DIE("","XUSFDA")
"RTN","XU8P480",83,0)
 . Q
"RTN","XU8P480",84,0)
 Q:'XUSIEN
"RTN","XU8P480",85,0)
 K XUSFDA
"RTN","XU8P480",86,0)
 S XUSFDA(19,XUSIEN_",",.01)="@"
"RTN","XU8P480",87,0)
 D FILE^DIE("","XUSFDA")
"RTN","XU8P480",88,0)
 Q
"RTN","XU8P480",89,0)
 ;
"RTN","XU8P480",90,0)
 ;
"RTN","XUSERNEW")
0^2^B24383535^B22745531
"RTN","XUSERNEW",1,0)
XUSERNEW ;SF/RWF - ADD NEW USER ;5/13/08  17:19
"RTN","XUSERNEW",2,0)
 ;;8.0;KERNEL;**16,49,134,208,157,313,351,419,467,480**;Jul 10, 1995;Build 38
"RTN","XUSERNEW",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified
"RTN","XUSERNEW",4,0)
 ;In the call to NEW^XM for new users the variable XMZ must be undef.
"RTN","XUSERNEW",5,0)
 ;on a reactivation XMZ should be set to the current max message number.
"RTN","XUSERNEW",6,0)
EN ;Add
"RTN","XUSERNEW",7,0)
 N Y,XUN,DR,DIE,DA,DTOUT,DIWF,XMDT,XMM,XMZ
"RTN","XUSERNEW",8,0)
 S Y=$$ADD("","",1) G EXIT:Y'>0,RE:$P(Y,U,3)'=1
"RTN","XUSERNEW",9,0)
 S XUN=+Y ;XU USER ADD called in $$ADD
"RTN","XUSERNEW",10,0)
 S DR="["_$$GET^XUPARAM("XUNEW USER","N")_"]"
"RTN","XUSERNEW",11,0)
 S DIE=200,DA=XUN D XUDIE^XUS5 G:$D(DTOUT) EXIT
"RTN","XUSERNEW",12,0)
 I $$GET1^DIQ(200,XUN_",",11,"I")="" W !,"Without a VERIFY code the user will not be able to sign-on!",$C(7),!
"RTN","XUSERNEW",13,0)
 S Y=XUN K XMZ D NEW^XM K XMDT,XMM,XMZ
"RTN","XUSERNEW",14,0)
 ;ACCESS LETTER, Also see XUSERBLK
"RTN","XUSERNEW",15,0)
 W ! D LETTER(XUN,1)
"RTN","XUSERNEW",16,0)
 K DIR,DIWF,XUTEXT
"RTN","XUSERNEW",17,0)
 ;
"RTN","XUSERNEW",18,0)
 ;Fall in from above, called from REACT
"RTN","XUSERNEW",19,0)
KEYS N DIR,XQHOLD,XQKEY,XQDA,XQAL,XQ6,XQFL
"RTN","XUSERNEW",20,0)
 S DIR(0)="Y",DIR("B")="NO",DIR("A")="Do you wish to allocate security keys" D ^DIR G:$D(DIRUT) EXIT
"RTN","XUSERNEW",21,0)
 I Y=1 S XQHOLD(XUN)="",XQKEY(0)=0,XQDA=0,XQAL=1,XQ6="",XQFL="" D KEY^XQ6
"RTN","XUSERNEW",22,0)
 ;
"RTN","XUSERNEW",23,0)
 ;Check on adding this user to user groups
"RTN","XUSERNEW",24,0)
 I $P(^VA(200,XUN,0),U,3)'="" D  ;Must have access code & mailbox
"RTN","XUSERNEW",25,0)
 .N DIR,Y
"RTN","XUSERNEW",26,0)
 .S DIR(0)="Y",DIR("B")="NO",DIR("A")="Do you wish to add this user to mail groups" D ^DIR Q:$D(DIRUT)
"RTN","XUSERNEW",27,0)
 .I Y=1 D ENLOCAL1^XMVGRP(XUN)
"RTN","XUSERNEW",28,0)
 .K XMDUN,XMDUZ,XMV
"RTN","XUSERNEW",29,0)
 .Q
"RTN","XUSERNEW",30,0)
 ;
"RTN","XUSERNEW",31,0)
EXIT K D0,DA,DDER,DDSFILE,DIE,DIC,DIR,DI,DICR,DIG,DIH,DISYS,DIU,DIV,DIWT,DLAYGO,DR,DQ,K,I,X,X1,XQHOLD,XQKEY,XUN,XUSOLD,XMB,XMZ,Y,Z,XQ6,XQFL,DTOUT
"RTN","XUSERNEW",32,0)
 Q
"RTN","XUSERNEW",33,0)
 ;
"RTN","XUSERNEW",34,0)
RE ;Jump from new user to reactivate
"RTN","XUSERNEW",35,0)
 S XUN=+Y,DIR("A")="This isn't a new user, Want to reactivate?",DIR(0)="Y",DIR("B")="NO"
"RTN","XUSERNEW",36,0)
 D ^DIR
"RTN","XUSERNEW",37,0)
 G EXIT:$D(DIRUT)!(Y'=1),RE2
"RTN","XUSERNEW",38,0)
 ;Reactivate a user
"RTN","XUSERNEW",39,0)
REACT ;SEA/WDE-REACTIVATE A USER
"RTN","XUSERNEW",40,0)
 N XUN,XUSOLD,DIE,DIC,DA,DR,FDA
"RTN","XUSERNEW",41,0)
 S XUN=+$$LOOKUP^XUSER G EXIT:XUN<0
"RTN","XUSERNEW",42,0)
RE2 S XUSOLD=^VA(200,XUN,0)
"RTN","XUSERNEW",43,0)
 S FDA(200,XUN_",",9.2)="@" ;Clear the Termination date
"RTN","XUSERNEW",44,0)
 D UPDATE^DIE("E","FDA")
"RTN","XUSERNEW",45,0)
 ;Show the screanman form
"RTN","XUSERNEW",46,0)
 S DIE=200,DR="["_$$GET^XUPARAM("XUREACT USER","N")_"]",DA=XUN
"RTN","XUSERNEW",47,0)
 D XUDIE^XUS5 G:$D(DTOUT) EXIT
"RTN","XUSERNEW",48,0)
 I $P(^VA(200,XUN,0),U,3)="" W !!,"No ACCESS CODE has been entered.",$C(7),!
"RTN","XUSERNEW",49,0)
 I $P(^VA(200,XUN,0),U,11)>0,$P(^(0),U,11)'>DT W !!,"User is still TERMINATED.",$C(7),!
"RTN","XUSERNEW",50,0)
 I $$GET1^DIQ(200,XUN_",",11,"I")="" W !,"Without a VERIFY code the user will not be able to sign-on!",$C(7),!
"RTN","XUSERNEW",51,0)
 N DIR
"RTN","XUSERNEW",52,0)
 S DIR(0)="Y",DIR("A")="Deny access to old mail messages",DIR("B")="NO",DIR("?")="Enter a 'YES' to restrict access to old mail messages."
"RTN","XUSERNEW",53,0)
 D ^DIR G:$D(DIRUT) EXIT
"RTN","XUSERNEW",54,0)
 K XMZ S:Y=1 XMZ=+$P(^XMB(3.9,0),"^",3) S Y=XUN D NEW^XM K XMDT,XMM,XMZ
"RTN","XUSERNEW",55,0)
 D REACT^XQ84(XUN) ;See if this user's menu trees need to be rebuilt
"RTN","XUSERNEW",56,0)
 G KEYS
"RTN","XUSERNEW",57,0)
 Q
"RTN","XUSERNEW",58,0)
 ;
"RTN","XUSERNEW",59,0)
ADD(NP1,KEYS,NONC) ;Common point to do DIC call for adding a new person.
"RTN","XUSERNEW",60,0)
 ;NP1 will be added to the default or what comes from the NPI field or the KSP.
"RTN","XUSERNEW",61,0)
 ;KEYS is a list of Keys to give the new person
"RTN","XUSERNEW",62,0)
 N DA,DR,DLAYGO,XUITNAME,XUS1,XUS2,DIC,DIE,DIK,NP2,Y
"RTN","XUSERNEW",63,0)
 I $G(^XTV(8989.3,1,"NPI"))]"" X ^("NPI") S NP2=DR
"RTN","XUSERNEW",64,0)
 S:'$D(NP2) NP2="1;"_$S($D(^XUSEC("XUSPF200",DUZ)):9,1:"9R~")_";4;41.99"
"RTN","XUSERNEW",65,0)
 ;";41.99" is for adding National Provider Identifier
"RTN","XUSERNEW",66,0)
 S DIC="^VA(200,",DIC(0)="AELMQ",DLAYGO=200,DIC("A")="Enter NEW PERSON's name (Family,Given Middle Suffix): ",DIC("DR")="",XUITNAME=1
"RTN","XUSERNEW",67,0)
 D ^DIC S XUS1=Y G AX:(Y'>0)!($P(Y,U,3)'>0)
"RTN","XUSERNEW",68,0)
 S DA=+$G(^VA(200,+XUS1,3.1)) I DA,'$G(NONC) D
"RTN","XUSERNEW",69,0)
 . W !,"Name components."
"RTN","XUSERNEW",70,0)
 . S DIE="^VA(20,",DR="1;2;3;5"
"RTN","XUSERNEW",71,0)
 . L +^VA(20,DA,0):60 D ^DIE L -^VA(20,DA,0)
"RTN","XUSERNEW",72,0)
 . I $D(Y)!$D(DTOUT) S DA=+XUS1,XUS1=-1
"RTN","XUSERNEW",73,0)
 . E  S $P(XUS1,U,2)=$P(^VA(200,+XUS1,0),U)
"RTN","XUSERNEW",74,0)
 D:XUS1>0
"RTN","XUSERNEW",75,0)
 . W !,"Now for the Identifiers."
"RTN","XUSERNEW",76,0)
 . S DA=+XUS1,DIE="^VA(200,",DR=NP2_$S($D(NP1):";"_NP1,1:""),DIE("NO^")="OUTOK"
"RTN","XUSERNEW",77,0)
 . L +^VA(200,DA,0):60 D ^DIE L -^VA(200,DA,0)
"RTN","XUSERNEW",78,0)
 . S:$D(Y)!$D(DTOUT) XUS1=-1
"RTN","XUSERNEW",79,0)
 I XUS1<0 D  S XUS1=-1
"RTN","XUSERNEW",80,0)
 . W !?5,"<'",$P(^VA(200,DA,0),U),"' DELETED>"
"RTN","XUSERNEW",81,0)
 . S DIK="^VA(200," D ^DIK
"RTN","XUSERNEW",82,0)
 . Q:$P($G(^DIC(3,0)),U)'="USER"!'$D(^DD(3,0))
"RTN","XUSERNEW",83,0)
 . S DIK="^DIC(3,",XUS1=$P($G(^DIC(3,DA,0)),U,16) D ^DIK
"RTN","XUSERNEW",84,0)
 . Q:'XUS1!($P($G(^DIC(16,0)),U)'="PERSON")!'$D(^DD(16,0))
"RTN","XUSERNEW",85,0)
 . S DIK="^DIC(16,",DA=XUS1 D ^DIK
"RTN","XUSERNEW",86,0)
 N XUSNPI S XUSNPI=$P($G(^VA(200,DA,"NPI")),"^")
"RTN","XUSERNEW",87,0)
 I XUS1>0,+XUSNPI>0 D
"RTN","XUSERNEW",88,0)
 . S XUSNPI=$$ADDNPI^XUSNPI("Individual_ID",DA,XUSNPI,$$NOW^XLFDT(),1) ;add NPI to multiple
"RTN","XUSERNEW",89,0)
 . ; Initialize field 41.97 to 1 (YES)
"RTN","XUSERNEW",90,0)
 . Q:+XUSNPI'>0
"RTN","XUSERNEW",91,0)
 . N DIE,DR,DA S DIE="^VA(200,",DA=+XUS1,DR="41.97////1" D ^DIE
"RTN","XUSERNEW",92,0)
 . Q
"RTN","XUSERNEW",93,0)
 I XUS1>0,$D(KEYS) F XUS2=1:1 S Y=$P(KEYS,",",XUS2) Q:'$L(Y)  D
"RTN","XUSERNEW",94,0)
 . S %=$$ADD^XQKEY(XUS1,Y) I '% W !,"Key '",Y,"' not allocated"
"RTN","XUSERNEW",95,0)
 I XUS1>0 D CALL^XUSERP(+XUS1,1) ;XQOR add
"RTN","XUSERNEW",96,0)
AX Q XUS1
"RTN","XUSERNEW",97,0)
 ;
"RTN","XUSERNEW",98,0)
REPRINT ;Reprint letter
"RTN","XUSERNEW",99,0)
 S DA=+$$LOOKUP^XUSER G EXIT:DA'>0
"RTN","XUSERNEW",100,0)
 D LETTER(DA)
"RTN","XUSERNEW",101,0)
 G EXIT
"RTN","XUSERNEW",102,0)
 ;
"RTN","XUSERNEW",103,0)
LETTER(XUN,ASK) ;Print access letter
"RTN","XUSERNEW",104,0)
 Q:'$G(XUN)
"RTN","XUSERNEW",105,0)
 N DIWF,FR,TO,BY,DIR,XUTEXT
"RTN","XUSERNEW",106,0)
 S XUTEXT=$$GET^XUPARAM("XUSER COMPUTER ACCOUNT","N"),XUTEXT=$O(^DIC(9.2,"B",XUTEXT,0))
"RTN","XUSERNEW",107,0)
 S DIR(0)="Y",DIR("A")="Print User Account Access Letter"
"RTN","XUSERNEW",108,0)
 I XUTEXT>0 S Y=1 D:$G(ASK) ^DIR I Y=1 D
"RTN","XUSERNEW",109,0)
 . S (XUU,XUU2)="________",DIWF="^DIC(9.2,XUTEXT,1,",DIWF(1)=200,FR=XUN,TO=XUN,BY="NUMBER" D EN2^DIWF
"RTN","XUSERNEW",110,0)
 . Q
"RTN","XUSERNEW",111,0)
 Q
"RTN","XUSNPI")
0^1^B63514631^B57042546
"RTN","XUSNPI",1,0)
XUSNPI ;OAK_BP/BDT - NATIONAL PROVIDER IDENTIFIER ;6/3/08  13:51
"RTN","XUSNPI",2,0)
 ;;8.0;KERNEL;**410,416,480**; July 10, 1995;Build 38
"RTN","XUSNPI",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified
"RTN","XUSNPI",4,0)
ADDNPI(XUSQI,XUSIEN,XUSNPI,XUSDATE,XUSTATUS) ;
"RTN","XUSNPI",5,0)
 ;;==============================================================
"RTN","XUSNPI",6,0)
 ;; Update the Effective Date, Status & NPI trio.
"RTN","XUSNPI",7,0)
 ;; XUSQI   : Qualified Identifier, Required. For examble: Individual_ID Or Organization_ID
"RTN","XUSNPI",8,0)
 ;; XUSIEN  : Internal Entry Number. Required.
"RTN","XUSNPI",9,0)
 ;; XUSNPI  : National Provider Identifier. Required.
"RTN","XUSNPI",10,0)
 ;; XUSDATE : Active Date. Required.
"RTN","XUSNPI",11,0)
 ;; 
"RTN","XUSNPI",12,0)
 ;; If successful, return XUSRTN = IEN of new 42 sub-file entry.
"RTN","XUSNPI",13,0)
 ;; Else return XUSRTN = "-1^ErrorMessage".
"RTN","XUSNPI",14,0)
 ;; =============================================================
"RTN","XUSNPI",15,0)
 ;
"RTN","XUSNPI",16,0)
 ; Check valid inputs.
"RTN","XUSNPI",17,0)
 N XUSROOT,XUSFNB
"RTN","XUSNPI",18,0)
 S XUSROOT=$$GET^XPAR("PKG.KERNEL","XUSNPI QUALIFIED IDENTIFIER",XUSQI)
"RTN","XUSNPI",19,0)
 I $E(XUSROOT)'="^" S XUSROOT="^"_XUSROOT
"RTN","XUSNPI",20,0)
 I XUSROOT="^" Q "-1^Invalid Qualified Identifier"
"RTN","XUSNPI",21,0)
 I $$GLCK(XUSROOT)'>0 Q "-1^Invalid Qualified Identifier"
"RTN","XUSNPI",22,0)
 S XUSFNB=+$P(XUSROOT,"(",2)
"RTN","XUSNPI",23,0)
 I 'XUSFNB Q "-1^No File #"
"RTN","XUSNPI",24,0)
 S XUSFNB=XUSFNB_".42"
"RTN","XUSNPI",25,0)
 I $G(XUSIEN)'>0 Q "-1^Invalid IEN"
"RTN","XUSNPI",26,0)
 ;I (XUSIEN?.N)=0 Q "-1^Invalid IEN"
"RTN","XUSNPI",27,0)
 I ((XUSIEN?.N)!(XUSIEN?.N1"."1N.N))=0 Q "-1^Invalid IEN"
"RTN","XUSNPI",28,0)
 N XUIENCK S XUIENCK=XUSROOT_XUSIEN_","_0_")" I '$D(@XUIENCK) Q "-1^Invalid IEN"
"RTN","XUSNPI",29,0)
 I '$$CHKDGT(XUSNPI) Q "-1^Invalid NPI"
"RTN","XUSNPI",30,0)
 I '$$CHKDT(XUSQI,XUSIEN,XUSDATE) Q "-1^Invalid Effective Date"
"RTN","XUSNPI",31,0)
 I $G(XUSTATUS)="" S XUSTATUS=1
"RTN","XUSNPI",32,0)
 I (XUSTATUS'=0),(XUSTATUS'=1) Q "-1^Invalid Status"
"RTN","XUSNPI",33,0)
 N CHNPI S CHNPI=$$CHKDGT^XUSNPIE1(XUSNPI,XUSIEN,XUSQI) ; check if NPI is being used.
"RTN","XUSNPI",34,0)
 I CHNPI'=1 Q "-1^The NPI is being used."
"RTN","XUSNPI",35,0)
 ;
"RTN","XUSNPI",36,0)
 ;------------------------------------------------------------------
"RTN","XUSNPI",37,0)
 N ZZ,XUSRTN,ERRMSG,XUSX S ERRMSG=""
"RTN","XUSNPI",38,0)
 S XUSX=XUSROOT_XUSIEN_","_"""NPISTATUS"""_")"
"RTN","XUSNPI",39,0)
 ; Update Effective Date #42 multiple fields 
"RTN","XUSNPI",40,0)
 S XUSFNB=$P(XUSROOT,"(",2)
"RTN","XUSNPI",41,0)
 S XUSFNB=+$P(XUSFNB,",") I XUSFNB S XUSFNB=XUSFNB_".042"
"RTN","XUSNPI",42,0)
 S ZZ(1,XUSFNB,"+2,"_XUSIEN_",",.01)=XUSDATE
"RTN","XUSNPI",43,0)
 S ZZ(1,XUSFNB,"+2,"_XUSIEN_",",.02)=XUSTATUS
"RTN","XUSNPI",44,0)
 S ZZ(1,XUSFNB,"+2,"_XUSIEN_",",.03)=XUSNPI
"RTN","XUSNPI",45,0)
 D UPDATE^DIE("","ZZ(1)",,ERRMSG)
"RTN","XUSNPI",46,0)
 I $L(ERRMSG) Q "-1^"_$G(ERRMSG)
"RTN","XUSNPI",47,0)
 S XUSX=XUSROOT_XUSIEN_","_"""NPISTATUS"""_","_"""B"""_","_XUSDATE_","_"""A"""_")"
"RTN","XUSNPI",48,0)
 S XUSRTN=$O(@XUSX,-1)
"RTN","XUSNPI",49,0)
 I '+XUSRTN Q "-1^No entry add"
"RTN","XUSNPI",50,0)
 Q XUSRTN
"RTN","XUSNPI",51,0)
 ;
"RTN","XUSNPI",52,0)
NPI(XUSQI,XUSIEN,XUSDATE) ; Retrieve the NPI value for a qualified identifier entity.
"RTN","XUSNPI",53,0)
 ;;==============================================================
"RTN","XUSNPI",54,0)
 ;; XUSQI   : Qualified Identifier, Required. For examble: Individual_ID Or Organization_ID
"RTN","XUSNPI",55,0)
 ;; XUSIEN  : Internal Entry Number of file #4 or #200. Required.
"RTN","XUSNPI",56,0)
 ;; XUSDATE : Active Date. Not Required. Default: 'Today'.
"RTN","XUSNPI",57,0)
 ;; 
"RTN","XUSNPI",58,0)
 ;; If current NPI exists, return XUSRTN = 'NPI^EffectiveDate^Status'
"RTN","XUSNPI",59,0)
 ;; If invalid XUSQI or XUSIEN, return '-1^ErrorMessage'
"RTN","XUSNPI",60,0)
 ;; Else return 0
"RTN","XUSNPI",61,0)
 ;; =============================================================
"RTN","XUSNPI",62,0)
 ; check valid inputs
"RTN","XUSNPI",63,0)
 I $G(XUSIEN)'>0 Q "-1^Invalid IEN"
"RTN","XUSNPI",64,0)
 ;I (XUSIEN?.N)=0 Q "-1^Invalid IEN"
"RTN","XUSNPI",65,0)
 I ((XUSIEN?.N)!(XUSIEN?.N1"."1N.N))=0 Q "-1^Invalid IEN"
"RTN","XUSNPI",66,0)
 I $G(XUSDATE)="" S XUSDATE=$$NOW^XLFDT
"RTN","XUSNPI",67,0)
 N X,Y,%DT S %DT="T",X=XUSDATE D ^%DT I Y'=XUSDATE Q "-1^Invalid Effective Date"
"RTN","XUSNPI",68,0)
 ;-----------------------------------
"RTN","XUSNPI",69,0)
 N XUSDA,XUSI,XUSRTN,XUSROOT,XUSX,XUSTAT S (XUSDA,XUSRTN)="",XUSTAT="Inactive"
"RTN","XUSNPI",70,0)
 ; get global from Parameter file base on Qualified Identifier.
"RTN","XUSNPI",71,0)
 S XUSROOT=$$GET^XPAR("PKG.KERNEL","XUSNPI QUALIFIED IDENTIFIER",XUSQI)
"RTN","XUSNPI",72,0)
 I $E(XUSROOT)'="^" S XUSROOT="^"_XUSROOT
"RTN","XUSNPI",73,0)
 I XUSROOT="^" Q "-1^Invalid Qualified Identifier"
"RTN","XUSNPI",74,0)
 N XUIENCK S XUIENCK=XUSROOT_XUSIEN_","_0_")" I '$D(@XUIENCK) Q "-1^Invalid IEN"
"RTN","XUSNPI",75,0)
 I $$GLCK(XUSROOT)'>0 Q "-1^Invalid Qualified Identifier"
"RTN","XUSNPI",76,0)
 S XUSROOT=XUSROOT_XUSIEN_","_"""NPISTATUS"""
"RTN","XUSNPI",77,0)
 S XUSX=XUSROOT_")" I '$D(@XUSX) Q "-1^No NPI found"
"RTN","XUSNPI",78,0)
 S XUSI=0 F  S XUSI=$O(@(XUSROOT_","_"""B"""_","_XUSI_")")) Q:XUSI>XUSDATE!'XUSI
"RTN","XUSNPI",79,0)
 I 'XUSI S XUSX=XUSROOT_","_"""B"""_","_"""A"""_")",XUSDA=$O(@XUSX,-1)
"RTN","XUSNPI",80,0)
 I XUSI>XUSDATE S XUSX=XUSROOT_","_"""B"""_","_XUSI_")",XUSDA=$O(@(XUSX),-1)
"RTN","XUSNPI",81,0)
 I XUSDA="" Q 0
"RTN","XUSNPI",82,0)
 S XUSDA=XUSROOT_","_"""B"""_","_XUSDA_","_"""A"""_")",XUSDA=$O(@XUSDA,-1)
"RTN","XUSNPI",83,0)
 S XUSRTN=XUSROOT_","_XUSDA_","_0_")"
"RTN","XUSNPI",84,0)
 I '$D(@XUSRTN) Q "-1^Invalid IEN"
"RTN","XUSNPI",85,0)
 I $P($G(@XUSRTN),"^",2)=1 S XUSTAT="Active"
"RTN","XUSNPI",86,0)
 Q $P($G(@XUSRTN),"^",3)_"^"_$P($G(@XUSRTN),"^",1)_"^"_XUSTAT
"RTN","XUSNPI",87,0)
 ;       
"RTN","XUSNPI",88,0)
QI(XUSNPI) ; Retrieve the ALL qualified indentifier entity for an NPI value.
"RTN","XUSNPI",89,0)
 ;;================================================
"RTN","XUSNPI",90,0)
 ;; XUSNPI  : National Provider Identifier. Required
"RTN","XUSNPI",91,0)
 ;; 
"RTN","XUSNPI",92,0)
 ;; If qualified identified entity exists, return
"RTN","XUSNPI",93,0)
 ;; 'QualifiedIdentifier^IEN^EffectiveDate^Status;'
"RTN","XUSNPI",94,0)
 ;; If more than one records found, they are separated by ";"
"RTN","XUSNPI",95,0)
 ;; Else return 0        
"RTN","XUSNPI",96,0)
 ;;================================================
"RTN","XUSNPI",97,0)
 ; check valid NPI
"RTN","XUSNPI",98,0)
 I '$$CHKDGT(XUSNPI) Q "0^Invalid NPI"
"RTN","XUSNPI",99,0)
 N ZZ
"RTN","XUSNPI",100,0)
 D GETLST^XPAR(.ZZ,"PKG.KERNEL","XUSNPI QUALIFIED IDENTIFIER")
"RTN","XUSNPI",101,0)
 I ZZ'>0 Q 0
"RTN","XUSNPI",102,0)
 N XUSI,XUSIEN,XUSROOT,XUSQT,XUSX,XUSRTN,XUSRTN1 S (XUSQT,XUSRTN)=0,XUSRTN1=""
"RTN","XUSNPI",103,0)
 S XUSI=0 F  S XUSI=$O(ZZ(XUSI)) Q:'XUSI  D
"RTN","XUSNPI",104,0)
 . S XUSROOT=$P(ZZ(XUSI),"^",2),XUSROOT="^"_XUSROOT
"RTN","XUSNPI",105,0)
 . I $$GLCK(XUSROOT)'>0 Q  ;check valid global root
"RTN","XUSNPI",106,0)
 . I $E(XUSNPI,1,1)=0 S XUSNPI=""""_XUSNPI_""""
"RTN","XUSNPI",107,0)
 . S XUSX=XUSROOT_"""NPI42"""_","_XUSNPI_")" Q:'$D(@XUSX)
"RTN","XUSNPI",108,0)
 . S XUSIEN=0 F  S XUSX=XUSROOT_"""NPI42"""_","_XUSNPI_","_XUSIEN_")",XUSIEN=$O(@XUSX) Q:XUSIEN'>0  D
"RTN","XUSNPI",109,0)
 . . S XUSRTN=$$SRCHNPI(XUSROOT,XUSIEN,XUSNPI)
"RTN","XUSNPI",110,0)
 . . I +XUSRTN S XUSRTN1=XUSRTN1_$P(ZZ(XUSI),"^")_"^"_XUSRTN_";",XUSQT=XUSQT+1
"RTN","XUSNPI",111,0)
 I XUSRTN1="" S XUSRTN1=0
"RTN","XUSNPI",112,0)
 Q XUSRTN1
"RTN","XUSNPI",113,0)
 ;
"RTN","XUSNPI",114,0)
GLCK(XUSROOT) ; check valid global root
"RTN","XUSNPI",115,0)
 N XUFNB,ZZ
"RTN","XUSNPI",116,0)
 I $G(XUSROOT)="" Q 0
"RTN","XUSNPI",117,0)
 S XUFNB=$P(XUSROOT,"(",2),XUFNB=$P(XUFNB,",")
"RTN","XUSNPI",118,0)
 D FILE^DID(XUFNB,"","GLOBAL NAME","ZZ")
"RTN","XUSNPI",119,0)
 Q (XUSROOT=$G(ZZ("GLOBAL NAME")))
"RTN","XUSNPI",120,0)
 ;
"RTN","XUSNPI",121,0)
SRCHNPI(XUSROOT,XUSIEN,XUSNPI) ;
"RTN","XUSNPI",122,0)
 I $G(XUSIEN)'>0 Q 0
"RTN","XUSNPI",123,0)
 I (XUSIEN?.N)=0 Q 0
"RTN","XUSNPI",124,0)
 N XUSX,XUSRTN S XUSRTN=0
"RTN","XUSNPI",125,0)
 I $E(XUSNPI,1,1)=0 S XUSNPI=""""_XUSNPI_""""
"RTN","XUSNPI",126,0)
 S XUSX=XUSROOT_XUSIEN_","_"""NPISTATUS"""_","_"""C"""_","_XUSNPI_")"
"RTN","XUSNPI",127,0)
 I '$D(@XUSX) Q 0
"RTN","XUSNPI",128,0)
 S XUSX=XUSROOT_XUSIEN_","_"""NPISTATUS"""_","_"""C"""_","_XUSNPI_","_"""A"""_")"
"RTN","XUSNPI",129,0)
 S XUSRTN=$O(@XUSX,-1)
"RTN","XUSNPI",130,0)
 I '+XUSRTN Q 0
"RTN","XUSNPI",131,0)
 S XUSX=XUSROOT_XUSIEN_","_"""NPISTATUS"""_","_XUSRTN_","_0_")"
"RTN","XUSNPI",132,0)
 I '$D(@XUSX) Q 0
"RTN","XUSNPI",133,0)
 S XUSRTN=$G(@XUSX) I XUSRTN S XUSRTN=XUSIEN_"^"_$P(XUSRTN,"^")_"^"_$P(XUSRTN,"^",2)
"RTN","XUSNPI",134,0)
 I $P(XUSRTN,"^",3)=1 S $P(XUSRTN,"^",3)="Active"
"RTN","XUSNPI",135,0)
 I $P(XUSRTN,"^",3)=0 S $P(XUSRTN,"^",3)="Inactive"
"RTN","XUSNPI",136,0)
 Q XUSRTN
"RTN","XUSNPI",137,0)
 ;
"RTN","XUSNPI",138,0)
CHKDGT(XUSNPI) ;
"RTN","XUSNPI",139,0)
 ;  Function to validate the format of an NPI number.  It checks the
"RTN","XUSNPI",140,0)
 ;  length of the number, whether the NPI is numeric, and whether
"RTN","XUSNPI",141,0)
 ;  the check digit is valid.
"RTN","XUSNPI",142,0)
 ;
"RTN","XUSNPI",143,0)
 ;  Input parameter:
"RTN","XUSNPI",144,0)
 ;    NPI - 10-digit NPI number to validate.
"RTN","XUSNPI",145,0)
 ;
"RTN","XUSNPI",146,0)
 ;  Output parameter:
"RTN","XUSNPI",147,0)
 ;    Boolean value indicating whether the NPI has a valid format
"RTN","XUSNPI",148,0)
 ;
"RTN","XUSNPI",149,0)
 ;  NPI must be 10 digits long.
"RTN","XUSNPI",150,0)
 I XUSNPI'?10N Q 0
"RTN","XUSNPI",151,0)
 Q $E(XUSNPI,10)=$$CKDIGIT($E(XUSNPI,1,9))
"RTN","XUSNPI",152,0)
 ;
"RTN","XUSNPI",153,0)
CKDIGIT(XUSNPI) ;
"RTN","XUSNPI",154,0)
 ;  Function to calculate and return the check digit of an NPI.
"RTN","XUSNPI",155,0)
 ;  The check digit is calculated using the Luhn Formula for
"RTN","XUSNPI",156,0)
 ;  Modulus 10 "double-add-double" Check Digit.  A value of 24 is
"RTN","XUSNPI",157,0)
 ;  added to the total to account for the implied USA (80840) prefix.
"RTN","XUSNPI",158,0)
 ;
"RTN","XUSNPI",159,0)
 N XUSCTOT,XUSCN,XUSCDIG,XUSI
"RTN","XUSNPI",160,0)
 S XUSCTOT=24
"RTN","XUSNPI",161,0)
 F XUSI=9:-2:1 S XUSCN=2*$E(XUSNPI,XUSI),XUSCTOT=XUSCTOT+$E(XUSCN)+$E(XUSCN,2)+$E(XUSNPI,XUSI-1)
"RTN","XUSNPI",162,0)
 S XUSCDIG=150-XUSCTOT
"RTN","XUSNPI",163,0)
 Q $E(XUSCDIG,$L(XUSCDIG))
"RTN","XUSNPI",164,0)
 ;
"RTN","XUSNPI",165,0)
CHKDT(XUSQI,XUSIEN,XUSDATE) ; Check Date
"RTN","XUSNPI",166,0)
 ;;============================================================================
"RTN","XUSNPI",167,0)
 ;;  XUSQI   : Qualified Identifier. Required. For examble: "Individual_ID"
"RTN","XUSNPI",168,0)
 ;;  XUSIEN  : Internal Entry Number. Required.
"RTN","XUSNPI",169,0)
 ;;  XUSDATE : The Effective Date value to test. Must be FM date. Required. 
"RTN","XUSNPI",170,0)
 ;;  
"RTN","XUSNPI",171,0)
 ;;  If input passes date comparison, return 1.
"RTN","XUSNPI",172,0)
 ;;  Else return 0.
"RTN","XUSNPI",173,0)
 ;;============================================================================
"RTN","XUSNPI",174,0)
 ; 
"RTN","XUSNPI",175,0)
 I $G(XUSIEN)'>0 Q "0^Invalid IEN."
"RTN","XUSNPI",176,0)
 ;I (XUSIEN?.N)=0 Q "0^Invalid IEN."
"RTN","XUSNPI",177,0)
 I ((XUSIEN?.N)!(XUSIEN?.N1"."1N.N))=0 Q "-1^Invalid IEN"
"RTN","XUSNPI",178,0)
 N X,Y,%DT S %DT="T",X=$G(XUSDATE) D ^%DT I Y'=XUSDATE Q "0^Invalid Effective Date. Must be FM Date/Time."
"RTN","XUSNPI",179,0)
 ;-----------------------------------
"RTN","XUSNPI",180,0)
 N XUSROOT,XUSDA
"RTN","XUSNPI",181,0)
 N XUSCRDT S XUSCRDT=$$NOW^XLFDT I XUSDATE>XUSCRDT Q 0
"RTN","XUSNPI",182,0)
 ; get global from Parameter file base on Qualified Identifier.
"RTN","XUSNPI",183,0)
 S XUSROOT=$$GET^XPAR("PKG.KERNEL","XUSNPI QUALIFIED IDENTIFIER",XUSQI)
"RTN","XUSNPI",184,0)
 I $E(XUSROOT)'="^" S XUSROOT="^"_XUSROOT
"RTN","XUSNPI",185,0)
 I XUSROOT="^" Q "0^Invalid Qualified Identifier."
"RTN","XUSNPI",186,0)
 I $$GLCK(XUSROOT)'>0 Q "-1^Invalid Qualified Identifier"
"RTN","XUSNPI",187,0)
 N XUIENCK S XUIENCK=XUSROOT_XUSIEN_","_0_")" I $D(@XUIENCK)'>0 Q "0^Invalid IEN."
"RTN","XUSNPI",188,0)
 S XUSROOT=XUSROOT_XUSIEN_","_"""NPISTATUS"""_","_"""B"""_","_"""A"""_")",XUSDA=$O(@XUSROOT,-1)
"RTN","XUSNPI",189,0)
 Q (XUSDATE'<XUSDA)
"RTN","XUSNPI",190,0)
 ;
"RTN","XUSNPI",191,0)
GETRLNPI(XUSIEN) ; Return field indicating blanket release of NPI
"RTN","XUSNPI",192,0)
 ;; XUSIEN  : Internal Entry Number of person in file 200. Required
"RTN","XUSNPI",193,0)
 ;; Output: -1^error message or contents of AUTHORIZE RELEASE OF NPI field.
"RTN","XUSNPI",194,0)
 S XUSIEN=+$G(XUSIEN) I $G(^VA(200,XUSIEN,0))="" Q "-1^Invalid IEN"
"RTN","XUSNPI",195,0)
 N X
"RTN","XUSNPI",196,0)
 S X=$$NPI^XUSNPI("Individual_ID",XUSIEN)
"RTN","XUSNPI",197,0)
 I (X'>0)!($P(X,U,3)'="Active") Q "-1^User has no active NPI"
"RTN","XUSNPI",198,0)
 S X=$P($G(^VA(200,XUSIEN,"NPI")),U,3)
"RTN","XUSNPI",199,0)
 S:X="" X=0
"RTN","XUSNPI",200,0)
 Q X
"RTN","XUSNPI",201,0)
 ;
"RTN","XUSNPI1")
0^6^B51240975^n/a
"RTN","XUSNPI1",1,0)
XUSNPI1 ; OAK/TKW - NATIONAL PROVIDER IDENTIFIER UTILITIES ;6/6/08  11:27
"RTN","XUSNPI1",2,0)
 ;;8.0;KERNEL;**480**; July 10, 1995;Build 38
"RTN","XUSNPI1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified
"RTN","XUSNPI1",4,0)
NPIUSED(XUSNPI,XUSQID,XUSQIL,XUSIEN,XUSRSLT,XUSFLAG) ; Evaluate cases where an NPI is already in use
"RTN","XUSNPI1",5,0)
 ;   and return an error or warning. Called from routines that allow an NPI to be assigned
"RTN","XUSNPI1",6,0)
 ;   to either an INSTITUTION (file 4) or a NEW PERSON (file 200).
"RTN","XUSNPI1",7,0)
 ; XUSNPI = the NPI
"RTN","XUSNPI1",8,0)
 ; XUSQID = the qualified identifier for the file being edited (ex. "Individual_ID")
"RTN","XUSNPI1",9,0)
 ; XUSQIL = the delimited list of entities already using that NPI. This is output
"RTN","XUSNPI1",10,0)
 ;    from $$QI^XUSNPI, in the format:
"RTN","XUSNPI1",11,0)
 ;  Qualified_Identifier^IEN^Effective_date/time^Active/Inactive;
"RTN","XUSNPI1",12,0)
 ;    (Qualified_Identifier=(ex. "Individual_ID")
"RTN","XUSNPI1",13,0)
 ;     IEN=the IEN of the entity who owns the NPI.
"RTN","XUSNPI1",14,0)
 ;    If there are multiple entities who own the NPI, there will
"RTN","XUSNPI1",15,0)
 ;    be multiple entries in XUSQIL, delimited by ";".)
"RTN","XUSNPI1",16,0)
 ; XUSIEN = IEN of entry to which NPI is being assigned
"RTN","XUSNPI1",17,0)
 ; XUSRSLT = an output array returned if an error or warning message is generated.
"RTN","XUSNPI1",18,0)
 ; XUSFLAG = If set to 1, indicates that routine is being called from an input transform.
"RTN","XUSNPI1",19,0)
 ;           If set to 2, indicates we're checking the current NPI prior to delete/replace
"RTN","XUSNPI1",20,0)
 ;           If set to 3, indicates we're checking a new NPI (Either ADD or REPLACE).
"RTN","XUSNPI1",21,0)
 ;
"RTN","XUSNPI1",22,0)
 ; The function will return:
"RTN","XUSNPI1",23,0)
 ;   0 - No Error
"RTN","XUSNPI1",24,0)
 ;   1 - Error
"RTN","XUSNPI1",25,0)
 ;   2 - Warning
"RTN","XUSNPI1",26,0)
 ;   
"RTN","XUSNPI1",27,0)
 N XUSGLOB,XUSERR,XUSWARN,XUSFILE,XUSCNT,XUSFILI,XUSNEWPT,ZZ,X,I
"RTN","XUSNPI1",28,0)
 N XUSOU,XUSOAI,XUSOIEN,XUSOQID,XUSOPT
"RTN","XUSNPI1",29,0)
 K XUSRSLT
"RTN","XUSNPI1",30,0)
 ; If NPI is not already in use, quit 0 (no error)
"RTN","XUSNPI1",31,0)
 I XUSQIL=0 Q 0
"RTN","XUSNPI1",32,0)
 ; If NPI is malformed, quit 1 (error)
"RTN","XUSNPI1",33,0)
 I +XUSQIL=0,$P(XUSQIL,U,2)="Invalid NPI" D  Q 1
"RTN","XUSNPI1",34,0)
 . S XUSRSLT(1)="NPI values have a specific structure to validate them..."
"RTN","XUSNPI1",35,0)
 . S XUSRSLT(2)="The Checksum for this entry is not valid"
"RTN","XUSNPI1",36,0)
 . Q
"RTN","XUSNPI1",37,0)
 D GETLST^XPAR(.ZZ,"PKG.KERNEL","XUSNPI QUALIFIED IDENTIFIER")
"RTN","XUSNPI1",38,0)
 S ZZ=""
"RTN","XUSNPI1",39,0)
 F  S ZZ=$O(ZZ(ZZ)) Q:ZZ'>0  I $P(ZZ(ZZ),U)=XUSQID Q
"RTN","XUSNPI1",40,0)
 I ZZ'>0 S XUSRSLT(1)="Invalid 'Qualified Identifier' Input Parameter "_XUSQID_" passed." Q 1
"RTN","XUSNPI1",41,0)
 S XUSFLAG=+$G(XUSFLAG)
"RTN","XUSNPI1",42,0)
 S XUSIEN=+$G(XUSIEN)
"RTN","XUSNPI1",43,0)
 ; If user being updated is NON-VA Provider, get their Provider Type and file name
"RTN","XUSNPI1",44,0)
 S XUSNEWPT=0,XUSFILI=""
"RTN","XUSNPI1",45,0)
 ; Read through list of entities that already own the NPI
"RTN","XUSNPI1",46,0)
 S (XUSERR,XUSWARN,XUSCNT)=0
"RTN","XUSNPI1",47,0)
 F I=1:1 S XUSOU=$P(XUSQIL,";",I) Q:XUSOU=""!(XUSERR)  D
"RTN","XUSNPI1",48,0)
 . ; Get Qualified Identifier, IEN and Active/Inactive flag for other entity who owns the NPI
"RTN","XUSNPI1",49,0)
 . S XUSOQID=$P(XUSOU,U)
"RTN","XUSNPI1",50,0)
 . S XUSOIEN=+$P(XUSOU,U,2)
"RTN","XUSNPI1",51,0)
 . S XUSOAI=$P(XUSOU,U,4)
"RTN","XUSNPI1",52,0)
 . ; Find Qualified Identifier of file that already owns the NPI in the list of valid QIs
"RTN","XUSNPI1",53,0)
 . S ZZ="" F  S ZZ=$O(ZZ(ZZ)) Q:ZZ'>0  I $P(ZZ(ZZ),U)=XUSOQID Q
"RTN","XUSNPI1",54,0)
 . I ZZ'>0 D  Q
"RTN","XUSNPI1",55,0)
 . . S XUSERR=1
"RTN","XUSNPI1",56,0)
 . . S XUSRSLT(1)="Invalid Qualified Identifier "_XUSOQID_" returned from $$QI^XUSNPI" Q
"RTN","XUSNPI1",57,0)
 . ; Get global reference for file that owns NPI
"RTN","XUSNPI1",58,0)
 . S XUSGLOB="^"_$P(ZZ(ZZ),U,2)
"RTN","XUSNPI1",59,0)
 . ; If called from the input transform, and an entity is trying to enter an NPI they
"RTN","XUSNPI1",60,0)
 . ;    have previously held, it's not an error, unless NPI is inactive.
"RTN","XUSNPI1",61,0)
 . I XUSFLAG=1,XUSQID=XUSOQID,XUSIEN=XUSOIEN,XUSOAI'="Inactive" Q
"RTN","XUSNPI1",62,0)
 . ; Put provider type information into XUSOPT to generate error/warning
"RTN","XUSNPI1",63,0)
 . S XUSOPT=0
"RTN","XUSNPI1",64,0)
 . I XUSFLAG'=1 D
"RTN","XUSNPI1",65,0)
 . . I XUSOQID="Individual_ID" S XUSOPT="2^"
"RTN","XUSNPI1",66,0)
 . . I XUSOQID="Organization_ID" S XUSOPT="1^"
"RTN","XUSNPI1",67,0)
 . . I XUSOQID="Non_VA_Provider_ID" S XUSOPT=$$GETPT(XUSOIEN)
"RTN","XUSNPI1",68,0)
 . . Q
"RTN","XUSNPI1",69,0)
 . ; If editing a VA Provider, and a non-VA Provider has same current NPI, build both the
"RTN","XUSNPI1",70,0)
 . ; warning a user sees prior to replacing or deleting the current NPI, and the warning
"RTN","XUSNPI1",71,0)
 . ; the user will see after replacing the NPI.
"RTN","XUSNPI1",72,0)
 . I XUSFLAG=2 D  Q
"RTN","XUSNPI1",73,0)
 . . Q:XUSOQID'="Non_VA_Provider_ID"
"RTN","XUSNPI1",74,0)
 . . D MSGOLD(XUSNPI,XUSGLOB,XUSOIEN,.XUSCNT,XUSOPT,XUSOAI,.XUSRSLT)
"RTN","XUSNPI1",75,0)
 . . S XUSWARN=1
"RTN","XUSNPI1",76,0)
 . . Q
"RTN","XUSNPI1",77,0)
 . ; If an entity in the same file owns the NPI, it's an error.
"RTN","XUSNPI1",78,0)
 . I $P(XUSOU,U)=XUSQID D  Q
"RTN","XUSNPI1",79,0)
 . . D:XUSFLAG'=1 MSGNEW(XUSNPI,XUSGLOB,XUSOIEN,.XUSCNT,.XUSRSLT,XUSOPT)
"RTN","XUSNPI1",80,0)
 . . S XUSERR=1 Q
"RTN","XUSNPI1",81,0)
 . ; If an entity in the INSTITUTION file (#4) already owns the NPI, it's an error.
"RTN","XUSNPI1",82,0)
 . I $P(XUSOU,U)="Organization_ID" D  Q
"RTN","XUSNPI1",83,0)
 . . D:XUSFLAG'=1 MSGNEW(XUSNPI,XUSGLOB,XUSOIEN,.XUSCNT,.XUSRSLT,XUSOPT)
"RTN","XUSNPI1",84,0)
 . . S XUSERR=1 Q
"RTN","XUSNPI1",85,0)
 . ; If new entry being edited is a VA INSTITUTION and any other entity owns the NPI, it's an error
"RTN","XUSNPI1",86,0)
 . I XUSQID="Organization_ID" D  Q
"RTN","XUSNPI1",87,0)
 . . D:XUSFLAG'=1 MSGNEW(XUSNPI,XUSGLOB,XUSOIEN,.XUSCNT,.XUSRSLT,XUSOPT)
"RTN","XUSNPI1",88,0)
 . . S XUSERR=1 Q
"RTN","XUSNPI1",89,0)
 . ; Providers in file 200 or 355.93 can share an NPI. If NPI in file 355.93 is Active,
"RTN","XUSNPI1",90,0)
 . ; issue a warning, if inactive, issue an error
"RTN","XUSNPI1",91,0)
 . I XUSFLAG'=1 D MSGNEW(XUSNPI,XUSGLOB,XUSOIEN,.XUSCNT,.XUSRSLT,XUSOPT,XUSOAI)
"RTN","XUSNPI1",92,0)
 . I XUSOAI="Inactive" S XUSERR=1 Q
"RTN","XUSNPI1",93,0)
 . S XUSWARN=1
"RTN","XUSNPI1",94,0)
 . Q
"RTN","XUSNPI1",95,0)
 I XUSERR Q 1
"RTN","XUSNPI1",96,0)
 I XUSWARN Q 2
"RTN","XUSNPI1",97,0)
 Q 0
"RTN","XUSNPI1",98,0)
 ;
"RTN","XUSNPI1",99,0)
GETPT(XUSIEN) ; Get provider type for entry in IB NON/OTHER VA BILLING PROVIDER file
"RTN","XUSNPI1",100,0)
 N PT
"RTN","XUSNPI1",101,0)
 S PT=+$$GET1^DIQ(355.93,XUSIEN_",",.02,"I")
"RTN","XUSNPI1",102,0)
 ; Null provider type returned as 3.
"RTN","XUSNPI1",103,0)
 I PT=1 S PT="1^the FACILITY/GROUP provider "
"RTN","XUSNPI1",104,0)
 E  I PT=2 S PT="2^the INDIVIDUAL provider "
"RTN","XUSNPI1",105,0)
 E  S PT="3^"
"RTN","XUSNPI1",106,0)
 K ^TMP("DIERR",$J)
"RTN","XUSNPI1",107,0)
 Q PT
"RTN","XUSNPI1",108,0)
 ;
"RTN","XUSNPI1",109,0)
GETPER(XUSOWNKY) ; Return names of people who own the security key IB PROVIDER EDIT
"RTN","XUSNPI1",110,0)
 N XUSIEN,X
"RTN","XUSNPI1",111,0)
 F XUSIEN=0:0 S XUSIEN=$O(^XUSEC("IB PROVIDER EDIT",XUSIEN)) Q:'XUSIEN  D
"RTN","XUSNPI1",112,0)
 . Q:$G(^VA(200,XUSIEN,0))=""
"RTN","XUSNPI1",113,0)
 . ; Don't return TERMINATED or DISUSERed users
"RTN","XUSNPI1",114,0)
 . S X=$$ACTIVE^XUSER(XUSIEN)
"RTN","XUSNPI1",115,0)
 . I X=""!($P(X,U)=0) Q
"RTN","XUSNPI1",116,0)
 . ; Put users IENs into output array
"RTN","XUSNPI1",117,0)
 . S XUSOWNKY(XUSIEN)="" Q
"RTN","XUSNPI1",118,0)
 Q
"RTN","XUSNPI1",119,0)
 ;
"RTN","XUSNPI1",120,0)
MSGOLD(XUSNPI,XUSGLOB,XUSIEN,XUSCNT,XUSOPT,XUSOAI,XUSRSLT) ;
"RTN","XUSNPI1",121,0)
 ; Generate warning message to display prior to REPLACE/DELETE NPI prompt, when the current 
"RTN","XUSNPI1",122,0)
 ; NPI is also used by a non-va provider
"RTN","XUSNPI1",123,0)
 N XUSFILE,XUSOWNKY,I,J,X
"RTN","XUSNPI1",124,0)
 S XUSFILE=$P(@(XUSGLOB_"0)"),U)
"RTN","XUSNPI1",125,0)
 S X=""
"RTN","XUSNPI1",126,0)
 S:$G(XUSOPT) X=$P(XUSOPT,U,2)
"RTN","XUSNPI1",127,0)
 S XUSCNT=XUSCNT+1,XUSRSLT(XUSCNT)="The NPI of "_XUSNPI_" is also associated with "_X
"RTN","XUSNPI1",128,0)
 S XUSCNT=XUSCNT+1,XUSRSLT(XUSCNT)=$P(@(XUSGLOB_XUSIEN_",0)"),U)
"RTN","XUSNPI1",129,0)
 I XUSOAI="Inactive" S XUSRSLT(XUSCNT)=XUSRSLT(XUSCNT)_" as INACTIVE"
"RTN","XUSNPI1",130,0)
 S XUSRSLT(XUSCNT)=XUSRSLT(XUSCNT)_" in the "_XUSFILE_" file."
"RTN","XUSNPI1",131,0)
 S XUSCNT=XUSCNT+2
"RTN","XUSNPI1",132,0)
 ; Generate warning message to display after REPLACE NPI, when the current NPI 
"RTN","XUSNPI1",133,0)
 ; is also used by a non-va provider
"RTN","XUSNPI1",134,0)
 ;
"RTN","XUSNPI1",135,0)
 S I=$O(XUSRSLT("X",999999999999),-1)
"RTN","XUSNPI1",136,0)
 S XUSRSLT("X",I+1)="Warning: NPI "_XUSNPI_" is also associated with provider "_$P(@(XUSGLOB_XUSIEN_",0)"),U)_"."
"RTN","XUSNPI1",137,0)
 S XUSRSLT("X",I+2)=""
"RTN","XUSNPI1",138,0)
 S XUSRSLT("X",I+3)="A Mailman message has been sent to holders of the ""IB PROVIDER EDIT"""
"RTN","XUSNPI1",139,0)
 S XUSRSLT("X",I+4)="security key."
"RTN","XUSNPI1",140,0)
 S I=$O(XUSRSLT("XMSG",999999999999),-1)
"RTN","XUSNPI1",141,0)
 S XUSRSLT("XMSG",I+1,0)="The NPI "_XUSNPI_" was ^ for ^ in"
"RTN","XUSNPI1",142,0)
 S XUSRSLT("XMSG",I+2,0)="the NEW PERSON file. The NPI "_XUSNPI_" is also associated with"
"RTN","XUSNPI1",143,0)
 S XUSRSLT("XMSG",I+3,0)=$P(@(XUSGLOB_XUSIEN_",0)"),U)_" in the "_XUSFILE_" file."
"RTN","XUSNPI1",144,0)
 S XUSRSLT("XMSG",I+4,0)=" "
"RTN","XUSNPI1",145,0)
 S XUSRSLT("XMSG",I+5,0)="The same change may need to be made to the "_XUSFILE
"RTN","XUSNPI1",146,0)
 S XUSRSLT("XMSG",I+6,0)="using the PROVIDER ID MAINTENANCE option."
"RTN","XUSNPI1",147,0)
 ; Get names of persons to notify
"RTN","XUSNPI1",148,0)
 D GETPER(.XUSOWNKY)
"RTN","XUSNPI1",149,0)
 S I=$O(XUSRSLT("XRCPT",999999999999),-1)
"RTN","XUSNPI1",150,0)
 F J=0:0 S J=$O(XUSOWNKY(J)) Q:'J  S I=I+1,XUSRSLT("XRCPT",I)=J
"RTN","XUSNPI1",151,0)
 Q
"RTN","XUSNPI1",152,0)
 ;
"RTN","XUSNPI1",153,0)
MSGNEW(XUSNPI,XUSGLOB,XUSIEN,XUSCNT,XUSRSLT,XUSOPT,XUSOAI) ;
"RTN","XUSNPI1",154,0)
 ; Generate error or warning message when new NPI is in use.
"RTN","XUSNPI1",155,0)
 N XUSFILE,X
"RTN","XUSNPI1",156,0)
 S XUSFILE=$P(@(XUSGLOB_"0)"),U)
"RTN","XUSNPI1",157,0)
 S X=""
"RTN","XUSNPI1",158,0)
 S:$G(XUSOPT) X=$P(XUSOPT,U,2)
"RTN","XUSNPI1",159,0)
 I $G(XUSOAI)="" D  Q
"RTN","XUSNPI1",160,0)
 . S XUSRSLT(XUSCNT+1)="The NPI of "_XUSNPI_" is now, or was in the past, associated with"
"RTN","XUSNPI1",161,0)
 . S XUSRSLT(XUSCNT+2)=X_$P(@(XUSGLOB_XUSIEN_",0)"),U)_" in the "_XUSFILE_" file."
"RTN","XUSNPI1",162,0)
 . S XUSCNT=XUSCNT+2
"RTN","XUSNPI1",163,0)
 . Q
"RTN","XUSNPI1",164,0)
 S XUSRSLT(XUSCNT+1)="The NPI of "_XUSNPI_" is also associated with "_X
"RTN","XUSNPI1",165,0)
 S XUSRSLT(XUSCNT+2)=$P(@(XUSGLOB_XUSIEN_",0)"),U)_" in the "_XUSFILE_" file."
"RTN","XUSNPI1",166,0)
 S XUSCNT=XUSCNT+2
"RTN","XUSNPI1",167,0)
 I XUSOAI="Inactive" D  Q
"RTN","XUSNPI1",168,0)
 . S XUSCNT=XUSCNT+1,XUSRSLT(XUSCNT)="This NPI is INACTIVE and may not be used."
"RTN","XUSNPI1",169,0)
 . Q
"RTN","XUSNPI1",170,0)
 Q
"RTN","XUSNPI1",171,0)
 ;
"RTN","XUSNPI1",172,0)
 ;
"RTN","XUSNPIDA")
0^8^B46153609^B45442635
"RTN","XUSNPIDA",1,0)
XUSNPIDA ;FO-OAKLAND/JLI - SPECIFIED TAXONOMY VALUES FOR NPI RECIPIENTS ;4/8/08  18:18
"RTN","XUSNPIDA",2,0)
 ;;8.0;KERNEL;**420,410,480**;Jul 10, 1995;Build 38
"RTN","XUSNPIDA",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified
"RTN","XUSNPIDA",4,0)
 Q
"RTN","XUSNPIDA",5,0)
 ;
"RTN","XUSNPIDA",6,0)
CHKGLOB() ;  returns global location of TAXONOMY values also rebuilds if they are missing
"RTN","XUSNPIDA",7,0)
 N I,STR,XUGLOB
"RTN","XUSNPIDA",8,0)
 S XUGLOB=$NA(^XTMP("NPIVALS"))
"RTN","XUSNPIDA",9,0)
 ; check for ;;; is to permit sites to add a ; to exclude some values not used at site
"RTN","XUSNPIDA",10,0)
 I '$D(@XUGLOB) F I=1:1 S STR=$T(@("VALUES+"_I_"^XUSNPIDA")) I STR'[";;;" S STR=$P(STR,";;",2) Q:STR=""  S @XUGLOB@(STR)=""
"RTN","XUSNPIDA",11,0)
 S @XUGLOB@(0)=$$FMADD^XLFDT(DT,15)
"RTN","XUSNPIDA",12,0)
 Q XUGLOB
"RTN","XUSNPIDA",13,0)
 ;
"RTN","XUSNPIDA",14,0)
VALUES ;
"RTN","XUSNPIDA",15,0)
 ;;101Y00000X
"RTN","XUSNPIDA",16,0)
 ;;101YA0400X
"RTN","XUSNPIDA",17,0)
 ;;101YM0800X
"RTN","XUSNPIDA",18,0)
 ;;101YP1600X
"RTN","XUSNPIDA",19,0)
 ;;101YP2500X
"RTN","XUSNPIDA",20,0)
 ;;101YS0200X
"RTN","XUSNPIDA",21,0)
 ;;103G00000X
"RTN","XUSNPIDA",22,0)
 ;;103GC0700X
"RTN","XUSNPIDA",23,0)
 ;;103T00000X
"RTN","XUSNPIDA",24,0)
 ;;103TA0400X
"RTN","XUSNPIDA",25,0)
 ;;103TA0700X
"RTN","XUSNPIDA",26,0)
 ;;103TB0200X
"RTN","XUSNPIDA",27,0)
 ;;103TC0700X
"RTN","XUSNPIDA",28,0)
 ;;103TC1900X
"RTN","XUSNPIDA",29,0)
 ;;103TC2200X
"RTN","XUSNPIDA",30,0)
 ;;103TE1000X
"RTN","XUSNPIDA",31,0)
 ;;103TE1100X
"RTN","XUSNPIDA",32,0)
 ;;103TF0000X
"RTN","XUSNPIDA",33,0)
 ;;103TF0200X
"RTN","XUSNPIDA",34,0)
 ;;103TH0100X
"RTN","XUSNPIDA",35,0)
 ;;103TM1700X
"RTN","XUSNPIDA",36,0)
 ;;103TM1800X
"RTN","XUSNPIDA",37,0)
 ;;103TP0814X
"RTN","XUSNPIDA",38,0)
 ;;103TP2700X
"RTN","XUSNPIDA",39,0)
 ;;103TP2701X
"RTN","XUSNPIDA",40,0)
 ;;103TR0400X
"RTN","XUSNPIDA",41,0)
 ;;103TS0200X
"RTN","XUSNPIDA",42,0)
 ;;103TW0100X
"RTN","XUSNPIDA",43,0)
 ;;104100000X
"RTN","XUSNPIDA",44,0)
 ;;1041C0700X
"RTN","XUSNPIDA",45,0)
 ;;1041S0200X
"RTN","XUSNPIDA",46,0)
 ;;111N00000X
"RTN","XUSNPIDA",47,0)
 ;;111NI0900X
"RTN","XUSNPIDA",48,0)
 ;;111NN0400X
"RTN","XUSNPIDA",49,0)
 ;;111NN1001X
"RTN","XUSNPIDA",50,0)
 ;;111NR0200X
"RTN","XUSNPIDA",51,0)
 ;;111NS0005X
"RTN","XUSNPIDA",52,0)
 ;;111NT0100X
"RTN","XUSNPIDA",53,0)
 ;;111NX0100X
"RTN","XUSNPIDA",54,0)
 ;;111NX0800X
"RTN","XUSNPIDA",55,0)
 ;;122300000X
"RTN","XUSNPIDA",56,0)
 ;;1223D0001X
"RTN","XUSNPIDA",57,0)
 ;;1223E0200X
"RTN","XUSNPIDA",58,0)
 ;;1223G0001X
"RTN","XUSNPIDA",59,0)
 ;;1223P0106X
"RTN","XUSNPIDA",60,0)
 ;;1223P0221X
"RTN","XUSNPIDA",61,0)
 ;;1223P0300X
"RTN","XUSNPIDA",62,0)
 ;;1223P0700X
"RTN","XUSNPIDA",63,0)
 ;;1223S0112X
"RTN","XUSNPIDA",64,0)
 ;;1223X0008X
"RTN","XUSNPIDA",65,0)
 ;;1223X0400X
"RTN","XUSNPIDA",66,0)
 ;;133V00000X
"RTN","XUSNPIDA",67,0)
 ;;133VN1004X
"RTN","XUSNPIDA",68,0)
 ;;133VN1005X
"RTN","XUSNPIDA",69,0)
 ;;133VN1006X
"RTN","XUSNPIDA",70,0)
 ;;152W00000X
"RTN","XUSNPIDA",71,0)
 ;;152WC0802X
"RTN","XUSNPIDA",72,0)
 ;;152WL0500X
"RTN","XUSNPIDA",73,0)
 ;;152WP0200X
"RTN","XUSNPIDA",74,0)
 ;;152WS0006X
"RTN","XUSNPIDA",75,0)
 ;;152WV0400X
"RTN","XUSNPIDA",76,0)
 ;;152WX0102X
"RTN","XUSNPIDA",77,0)
 ;;170100000X
"RTN","XUSNPIDA",78,0)
 ;;183500000X
"RTN","XUSNPIDA",79,0)
 ;;1835G0000X
"RTN","XUSNPIDA",80,0)
 ;;1835N0905X
"RTN","XUSNPIDA",81,0)
 ;;1835N1003X
"RTN","XUSNPIDA",82,0)
 ;;1835P1200X
"RTN","XUSNPIDA",83,0)
 ;;1835P1300X
"RTN","XUSNPIDA",84,0)
 ;;204C00000X
"RTN","XUSNPIDA",85,0)
 ;;204D00000X
"RTN","XUSNPIDA",86,0)
 ;;204E00000X
"RTN","XUSNPIDA",87,0)
 ;;204F00000X
"RTN","XUSNPIDA",88,0)
 ;;207K00000X
"RTN","XUSNPIDA",89,0)
 ;;207KA0200X
"RTN","XUSNPIDA",90,0)
 ;;207KI0005X
"RTN","XUSNPIDA",91,0)
 ;;207L00000X
"RTN","XUSNPIDA",92,0)
 ;;207LA0401X
"RTN","XUSNPIDA",93,0)
 ;;207LC0200X
"RTN","XUSNPIDA",94,0)
 ;;207LP2900X
"RTN","XUSNPIDA",95,0)
 ;;207N00000X
"RTN","XUSNPIDA",96,0)
 ;;207ND0101X
"RTN","XUSNPIDA",97,0)
 ;;207ND0900X
"RTN","XUSNPIDA",98,0)
 ;;207NI0002X
"RTN","XUSNPIDA",99,0)
 ;;207NP0225X
"RTN","XUSNPIDA",100,0)
 ;;207NS0135X
"RTN","XUSNPIDA",101,0)
 ;;207P00000X
"RTN","XUSNPIDA",102,0)
 ;;207PE0004X
"RTN","XUSNPIDA",103,0)
 ;;207PE0005X
"RTN","XUSNPIDA",104,0)
 ;;207PP0204X
"RTN","XUSNPIDA",105,0)
 ;;207PS0010X
"RTN","XUSNPIDA",106,0)
 ;;207PT0002X
"RTN","XUSNPIDA",107,0)
 ;;207Q00000X
"RTN","XUSNPIDA",108,0)
 ;;207QA0000X
"RTN","XUSNPIDA",109,0)
 ;;207QA0401X
"RTN","XUSNPIDA",110,0)
 ;;207QA0505X
"RTN","XUSNPIDA",111,0)
 ;;207QG0300X
"RTN","XUSNPIDA",112,0)
 ;;207QS0010X
"RTN","XUSNPIDA",113,0)
 ;;207R00000X
"RTN","XUSNPIDA",114,0)
 ;;207RA0000X
"RTN","XUSNPIDA",115,0)
 ;;207RA0201X
"RTN","XUSNPIDA",116,0)
 ;;207RA0401X
"RTN","XUSNPIDA",117,0)
 ;;207RC0000X
"RTN","XUSNPIDA",118,0)
 ;;207RC0001X
"RTN","XUSNPIDA",119,0)
 ;;207RC0200X
"RTN","XUSNPIDA",120,0)
 ;;207RE0101X
"RTN","XUSNPIDA",121,0)
 ;;207RG0100X
"RTN","XUSNPIDA",122,0)
 ;;207RG0300X
"RTN","XUSNPIDA",123,0)
 ;;207RH0000X
"RTN","XUSNPIDA",124,0)
 ;;207RH0003X
"RTN","XUSNPIDA",125,0)
 ;;207RI0001X
"RTN","XUSNPIDA",126,0)
 ;;207RI0008X
"RTN","XUSNPIDA",127,0)
 ;;207RI0011X
"RTN","XUSNPIDA",128,0)
 ;;207RI0200X
"RTN","XUSNPIDA",129,0)
 ;;207RM1200X
"RTN","XUSNPIDA",130,0)
 ;;207RN0300X
"RTN","XUSNPIDA",131,0)
 ;;207RP1001X
"RTN","XUSNPIDA",132,0)
 ;;207RR0500X
"RTN","XUSNPIDA",133,0)
 ;;207RS0010X
"RTN","XUSNPIDA",134,0)
 ;;207RX0202X
"RTN","XUSNPIDA",135,0)
 ;;207SC0300X
"RTN","XUSNPIDA",136,0)
 ;;207SG0201X
"RTN","XUSNPIDA",137,0)
 ;;207SG0202X
"RTN","XUSNPIDA",138,0)
 ;;207SG0203X
"RTN","XUSNPIDA",139,0)
 ;;207SG0205X
"RTN","XUSNPIDA",140,0)
 ;;207SM0001X
"RTN","XUSNPIDA",141,0)
 ;;207T00000X
"RTN","XUSNPIDA",142,0)
 ;;207U00000X
"RTN","XUSNPIDA",143,0)
 ;;207UN0901X
"RTN","XUSNPIDA",144,0)
 ;;207UN0902X
"RTN","XUSNPIDA",145,0)
 ;;207UN0903X
"RTN","XUSNPIDA",146,0)
 ;;207V00000X
"RTN","XUSNPIDA",147,0)
 ;;207VC0200X
"RTN","XUSNPIDA",148,0)
 ;;207VE0102X
"RTN","XUSNPIDA",149,0)
 ;;207VG0400X
"RTN","XUSNPIDA",150,0)
 ;;207VM0101X
"RTN","XUSNPIDA",151,0)
 ;;207VX0000X
"RTN","XUSNPIDA",152,0)
 ;;207VX0201X
"RTN","XUSNPIDA",153,0)
 ;;207W00000X
"RTN","XUSNPIDA",154,0)
 ;;207X00000X
"RTN","XUSNPIDA",155,0)
 ;;207XS0106X
"RTN","XUSNPIDA",156,0)
 ;;207XS0114X
"RTN","XUSNPIDA",157,0)
 ;;207XS0117X
"RTN","XUSNPIDA",158,0)
 ;;207XX0004X
"RTN","XUSNPIDA",159,0)
 ;;207XX0005X
"RTN","XUSNPIDA",160,0)
 ;;207XX0801X
"RTN","XUSNPIDA",161,0)
 ;;207Y00000X
"RTN","XUSNPIDA",162,0)
 ;;207YP0228X
"RTN","XUSNPIDA",163,0)
 ;;207YS0123X
"RTN","XUSNPIDA",164,0)
 ;;207YX0007X
"RTN","XUSNPIDA",165,0)
 ;;207YX0602X
"RTN","XUSNPIDA",166,0)
 ;;207YX0901X
"RTN","XUSNPIDA",167,0)
 ;;207YX0905X
"RTN","XUSNPIDA",168,0)
 ;;207ZB0001X
"RTN","XUSNPIDA",169,0)
 ;;207ZC0500X
"RTN","XUSNPIDA",170,0)
 ;;207ZD0900X
"RTN","XUSNPIDA",171,0)
 ;;207ZF0201X
"RTN","XUSNPIDA",172,0)
 ;;207ZH0000X
"RTN","XUSNPIDA",173,0)
 ;;207ZI0100X
"RTN","XUSNPIDA",174,0)
 ;;207ZM0300X
"RTN","XUSNPIDA",175,0)
 ;;207ZN0500X
"RTN","XUSNPIDA",176,0)
 ;;207ZP0007X
"RTN","XUSNPIDA",177,0)
 ;;207ZP0101X
"RTN","XUSNPIDA",178,0)
 ;;207ZP0102X
"RTN","XUSNPIDA",179,0)
 ;;207ZP0104X
"RTN","XUSNPIDA",180,0)
 ;;207ZP0105X
"RTN","XUSNPIDA",181,0)
 ;;207ZP0213X
"RTN","XUSNPIDA",182,0)
 ;;208000000X
"RTN","XUSNPIDA",183,0)
 ;;2080A0000X
"RTN","XUSNPIDA",184,0)
 ;;2080I0007X
"RTN","XUSNPIDA",185,0)
 ;;2080N0001X
"RTN","XUSNPIDA",186,0)
 ;;2080P0006X
"RTN","XUSNPIDA",187,0)
 ;;2080P0008X
"RTN","XUSNPIDA",188,0)
 ;;2080P0201X
"RTN","XUSNPIDA",189,0)
 ;;2080P0202X
"RTN","XUSNPIDA",190,0)
 ;;2080P0203X
"RTN","XUSNPIDA",191,0)
 ;;2080P0204X
"RTN","XUSNPIDA",192,0)
 ;;2080P0205X
"RTN","XUSNPIDA",193,0)
 ;;2080P0206X
"RTN","XUSNPIDA",194,0)
 ;;2080P0207X
"RTN","XUSNPIDA",195,0)
 ;;2080P0208X
"RTN","XUSNPIDA",196,0)
 ;;2080P0210X
"RTN","XUSNPIDA",197,0)
 ;;2080P0214X
"RTN","XUSNPIDA",198,0)
 ;;2080P0216X
"RTN","XUSNPIDA",199,0)
 ;;2080S0010X
"RTN","XUSNPIDA",200,0)
 ;;2080T0002X
"RTN","XUSNPIDA",201,0)
 ;;208100000X
"RTN","XUSNPIDA",202,0)
 ;;2081P0004X
"RTN","XUSNPIDA",203,0)
 ;;2081P0010X
"RTN","XUSNPIDA",204,0)
 ;;2081P2900X
"RTN","XUSNPIDA",205,0)
 ;;2081S0010X
"RTN","XUSNPIDA",206,0)
 ;;208200000X
"RTN","XUSNPIDA",207,0)
 ;;2082S0099X
"RTN","XUSNPIDA",208,0)
 ;;2082S0105X
"RTN","XUSNPIDA",209,0)
 ;;2083A0100X
"RTN","XUSNPIDA",210,0)
 ;;2083P0011X
"RTN","XUSNPIDA",211,0)
 ;;2083P0500X
"RTN","XUSNPIDA",212,0)
 ;;2083P0901X
"RTN","XUSNPIDA",213,0)
 ;;2083S0010X
"RTN","XUSNPIDA",214,0)
 ;;2083T0002X
"RTN","XUSNPIDA",215,0)
 ;;2083X0100X
"RTN","XUSNPIDA",216,0)
 ;;2084A0401X
"RTN","XUSNPIDA",217,0)
 ;;2084F0202X
"RTN","XUSNPIDA",218,0)
 ;;2084N0400X
"RTN","XUSNPIDA",219,0)
 ;;2084N0402X
"RTN","XUSNPIDA",220,0)
 ;;2084N0600X
"RTN","XUSNPIDA",221,0)
 ;;2084P0005X
"RTN","XUSNPIDA",222,0)
 ;;2084P0800X
"RTN","XUSNPIDA",223,0)
 ;;2084P0802X
"RTN","XUSNPIDA",224,0)
 ;;2084P0804X
"RTN","XUSNPIDA",225,0)
 ;;2084P0805X
"RTN","XUSNPIDA",226,0)
 ;;2084P2900X
"RTN","XUSNPIDA",227,0)
 ;;2084S0010X
"RTN","XUSNPIDA",228,0)
 ;;2084V0102X
"RTN","XUSNPIDA",229,0)
 ;;2085B0100X
"RTN","XUSNPIDA",230,0)
 ;;2085N0700X
"RTN","XUSNPIDA",231,0)
 ;;2085N0904X
"RTN","XUSNPIDA",232,0)
 ;;2085P0229X
"RTN","XUSNPIDA",233,0)
 ;;2085R0001X
"RTN","XUSNPIDA",234,0)
 ;;2085R0202X
"RTN","XUSNPIDA",235,0)
 ;;2085R0203X
"RTN","XUSNPIDA",236,0)
 ;;2085R0204X
"RTN","XUSNPIDA",237,0)
 ;;2085R0205X
"RTN","XUSNPIDA",238,0)
 ;;2085U0001X
"RTN","XUSNPIDA",239,0)
 ;;208600000X
"RTN","XUSNPIDA",240,0)
 ;;2086S0102X
"RTN","XUSNPIDA",241,0)
 ;;2086S0105X
"RTN","XUSNPIDA",242,0)
 ;;2086S0120X
"RTN","XUSNPIDA",243,0)
 ;;2086S0122X
"RTN","XUSNPIDA",244,0)
 ;;2086S0127X
"RTN","XUSNPIDA",245,0)
 ;;2086S0129X
"RTN","XUSNPIDA",246,0)
 ;;2086X0206X
"RTN","XUSNPIDA",247,0)
 ;;208800000X
"RTN","XUSNPIDA",248,0)
 ;;208C00000X
"RTN","XUSNPIDA",249,0)
 ;;208D00000X
"RTN","XUSNPIDA",250,0)
 ;;208G00000X
"RTN","XUSNPIDA",251,0)
 ;;208M00000X
"RTN","XUSNPIDA",252,0)
 ;;208U00000X
"RTN","XUSNPIDA",253,0)
 ;;208VP0000X
"RTN","XUSNPIDA",254,0)
 ;;208VP0014X
"RTN","XUSNPIDA",255,0)
 ;;209800000X
"RTN","XUSNPIDA",256,0)
 ;;213E00000X
"RTN","XUSNPIDA",257,0)
 ;;213EG0000X
"RTN","XUSNPIDA",258,0)
 ;;213EP0504X
"RTN","XUSNPIDA",259,0)
 ;;213EP1101X
"RTN","XUSNPIDA",260,0)
 ;;213ER0200X
"RTN","XUSNPIDA",261,0)
 ;;213ES0000X
"RTN","XUSNPIDA",262,0)
 ;;213ES0103X
"RTN","XUSNPIDA",263,0)
 ;;213ES0131X
"RTN","XUSNPIDA",264,0)
 ;;225100000X
"RTN","XUSNPIDA",265,0)
 ;;2251C2600X
"RTN","XUSNPIDA",266,0)
 ;;2251E1200X
"RTN","XUSNPIDA",267,0)
 ;;2251E1300X
"RTN","XUSNPIDA",268,0)
 ;;2251G0304X
"RTN","XUSNPIDA",269,0)
 ;;2251H1200X
"RTN","XUSNPIDA",270,0)
 ;;2251H1300X
"RTN","XUSNPIDA",271,0)
 ;;2251N0400X
"RTN","XUSNPIDA",272,0)
 ;;2251P0200X
"RTN","XUSNPIDA",273,0)
 ;;2251S0007X
"RTN","XUSNPIDA",274,0)
 ;;2251X0800X
"RTN","XUSNPIDA",275,0)
 ;;225X00000X
"RTN","XUSNPIDA",276,0)
 ;;225XE1200X
"RTN","XUSNPIDA",277,0)
 ;;225XH1200X
"RTN","XUSNPIDA",278,0)
 ;;225XH1300X
"RTN","XUSNPIDA",279,0)
 ;;225XN1300X
"RTN","XUSNPIDA",280,0)
 ;;225XP0200X
"RTN","XUSNPIDA",281,0)
 ;;225XR0403X
"RTN","XUSNPIDA",282,0)
 ;;231H00000X
"RTN","XUSNPIDA",283,0)
 ;;231HA2400X
"RTN","XUSNPIDA",284,0)
 ;;231HA2500X
"RTN","XUSNPIDA",285,0)
 ;;237600000X
"RTN","XUSNPIDA",286,0)
 ;;363A00000X
"RTN","XUSNPIDA",287,0)
 ;;363AM0700X
"RTN","XUSNPIDA",288,0)
 ;;363AS0400X
"RTN","XUSNPIDA",289,0)
 ;;363L00000X
"RTN","XUSNPIDA",290,0)
 ;;363LA2100X
"RTN","XUSNPIDA",291,0)
 ;;363LA2200X
"RTN","XUSNPIDA",292,0)
 ;;363LC0200X
"RTN","XUSNPIDA",293,0)
 ;;363LC1500X
"RTN","XUSNPIDA",294,0)
 ;;363LF0000X
"RTN","XUSNPIDA",295,0)
 ;;363LG0600X
"RTN","XUSNPIDA",296,0)
 ;;363LN0000X
"RTN","XUSNPIDA",297,0)
 ;;363LN0005X
"RTN","XUSNPIDA",298,0)
 ;;363LP0200X
"RTN","XUSNPIDA",299,0)
 ;;363LP0222X
"RTN","XUSNPIDA",300,0)
 ;;363LP0808X
"RTN","XUSNPIDA",301,0)
 ;;363LP1700X
"RTN","XUSNPIDA",302,0)
 ;;363LP2300X
"RTN","XUSNPIDA",303,0)
 ;;363LS0200X
"RTN","XUSNPIDA",304,0)
 ;;363LW0102X
"RTN","XUSNPIDA",305,0)
 ;;363LX0001X
"RTN","XUSNPIDA",306,0)
 ;;363LX0106X
"RTN","XUSNPIDA",307,0)
 ;;364S00000X
"RTN","XUSNPIDA",308,0)
 ;;364SA2100X
"RTN","XUSNPIDA",309,0)
 ;;364SA2200X
"RTN","XUSNPIDA",310,0)
 ;;364SC0200X
"RTN","XUSNPIDA",311,0)
 ;;364SC1501X
"RTN","XUSNPIDA",312,0)
 ;;364SC2300X
"RTN","XUSNPIDA",313,0)
 ;;364SE0003X
"RTN","XUSNPIDA",314,0)
 ;;364SE1400X
"RTN","XUSNPIDA",315,0)
 ;;364SF0001X
"RTN","XUSNPIDA",316,0)
 ;;364SG0600X
"RTN","XUSNPIDA",317,0)
 ;;364SH0200X
"RTN","XUSNPIDA",318,0)
 ;;364SH1100X
"RTN","XUSNPIDA",319,0)
 ;;364SI0800X
"RTN","XUSNPIDA",320,0)
 ;;364SL0600X
"RTN","XUSNPIDA",321,0)
 ;;364SM0705X
"RTN","XUSNPIDA",322,0)
 ;;364SN0000X
"RTN","XUSNPIDA",323,0)
 ;;364SN0800X
"RTN","XUSNPIDA",324,0)
 ;;364SP0200X
"RTN","XUSNPIDA",325,0)
 ;;364SP0807X
"RTN","XUSNPIDA",326,0)
 ;;364SP0808X
"RTN","XUSNPIDA",327,0)
 ;;364SP0809X
"RTN","XUSNPIDA",328,0)
 ;;364SP0810X
"RTN","XUSNPIDA",329,0)
 ;;364SP0811X
"RTN","XUSNPIDA",330,0)
 ;;364SP0812X
"RTN","XUSNPIDA",331,0)
 ;;364SP0813X
"RTN","XUSNPIDA",332,0)
 ;;364SP1700X
"RTN","XUSNPIDA",333,0)
 ;;364SP2800X
"RTN","XUSNPIDA",334,0)
 ;;364SR0400X
"RTN","XUSNPIDA",335,0)
 ;;364SS0200X
"RTN","XUSNPIDA",336,0)
 ;;364ST0500X
"RTN","XUSNPIDA",337,0)
 ;;364SW0102X
"RTN","XUSNPIDA",338,0)
 ;;364SX0106X
"RTN","XUSNPIDA",339,0)
 ;;364SX0200X
"RTN","XUSNPIDA",340,0)
 ;;364SX0204X
"RTN","XUSNPIDA",341,0)
 ;;367500000X
"RTN","XUSNPIDA",342,0)
 ;;367A00000X
"RTN","XUSNPIDA",343,0)
 ;;367H00000X
"RTN","XUSNPIDA",344,0)
 ;;390200000X
"RTN","XUSNPIDA",345,0)
 ;;
"RTN","XUSNPIE1")
0^4^B15300096^B72625613
"RTN","XUSNPIE1",1,0)
XUSNPIE1 ;FO-OAKLAND/JLI - NATIONAL PROVIDER IDENTIFIER DATA CAPTURE ;5/13/08  17:32
"RTN","XUSNPIE1",2,0)
 ;;8.0;KERNEL;**420,410,435,454,462,480**; July 10, 1995;Build 38
"RTN","XUSNPIE1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified
"RTN","XUSNPIE1",4,0)
 Q
"RTN","XUSNPIE1",5,0)
 ;
"RTN","XUSNPIE1",6,0)
SET(XUSIEN,XUSNPI) ;
"RTN","XUSNPIE1",7,0)
 ; set value for NPI related fields (#41.97-41.99) in file #200
"RTN","XUSNPIE1",8,0)
 N XUSFDA,XUSIENS,X
"RTN","XUSNPIE1",9,0)
 S X=$G(^VA(200,XUSIEN,"NPI"))
"RTN","XUSNPIE1",10,0)
 S XUSIENS=XUSIEN_","
"RTN","XUSNPIE1",11,0)
 S XUSFDA(200,XUSIENS,41.99)=XUSNPI
"RTN","XUSNPIE1",12,0)
 S XUSFDA(200,XUSIENS,41.98)="D"
"RTN","XUSNPIE1",13,0)
 S XUSFDA(200,XUSIENS,41.97)=1
"RTN","XUSNPIE1",14,0)
 D FILE^DIE("","XUSFDA")
"RTN","XUSNPIE1",15,0)
 Q
"RTN","XUSNPIE1",16,0)
 ;
"RTN","XUSNPIE1",17,0)
SET1(XUSIEN,XUSNPI) ;
"RTN","XUSNPIE1",18,0)
 ; set value for NPI field (#41.99) in file #4
"RTN","XUSNPIE1",19,0)
 N OLDNPI S OLDNPI=$P($G(^DIC(4,XUSIEN,"NPI")),"^")
"RTN","XUSNPIE1",20,0)
 I OLDNPI K ^DIC(4,"ANPI",OLDNPI,XUSIEN)
"RTN","XUSNPIE1",21,0)
 S ^DIC(4,XUSIEN,"NPI")=XUSNPI,^DIC(4,"ANPI",XUSNPI,XUSIEN)=""
"RTN","XUSNPIE1",22,0)
 Q
"RTN","XUSNPIE1",23,0)
 ;
"RTN","XUSNPIE1",24,0)
SIGNON ; .ACT - run at user sign-on display message if NEEDS AN NPI
"RTN","XUSNPIE1",25,0)
 N XVAL,DATETIME,OPT,XVALTIME
"RTN","XUSNPIE1",26,0)
 I $$CHEKNPI^XUSNPIED(DUZ) W !!,"To enter your NPI value enter  NPI  at a menu prompt to jump to the",!,"edit option.",! H 1
"RTN","XUSNPIE1",27,0)
 ; following to insure CBO List is scheduled to run on first day of month
"RTN","XUSNPIE1",28,0)
 S XVALTIME=$E(DT,6,7) I '((XVALTIME="01")!(XVALTIME="15")) Q
"RTN","XUSNPIE1",29,0)
 S XVAL=+$E($$NOW^XLFDT(),6,10) I XVAL>(XVALTIME_".19"),XVAL<(XVALTIME_".1958") D  ; 7 PM TO 7:58 PM ON 1ST OF MONTH
"RTN","XUSNPIE1",30,0)
 . S OPT=$$FIND1^DIC(19.2,"","","XUS NPI CBO LIST") I OPT'>0 L +^TMP("XUS NPI CBO LOCK"):0 Q:'$T  D CBOQUEUE L -^TMP("XUS NPI CBO LOCK") Q
"RTN","XUSNPIE1",31,0)
 . S DATETIME=$$GET1^DIQ(19.2,OPT_",",2)
"RTN","XUSNPIE1",32,0)
 . I DATETIME'=$$FMTE^XLFDT(DT_".2") L +^DIC(19.2,OPT):0 Q:'$T  D SETQUEUE(OPT,DT_".2") L -^DIC(19.2,OPT) Q
"RTN","XUSNPIE1",33,0)
 . I '$$GET1^DIQ(19.2,OPT_",",99.1) L +^DIC(19.2,OPT):0 Q:'$T  D  L -^DIC(19.2,OPT)
"RTN","XUSNPIE1",34,0)
 . . D SETQUEUE(OPT,"@")
"RTN","XUSNPIE1",35,0)
 . . D SETQUEUE(OPT,DT_".2")
"RTN","XUSNPIE1",36,0)
 . . Q
"RTN","XUSNPIE1",37,0)
 . Q
"RTN","XUSNPIE1",38,0)
 Q
"RTN","XUSNPIE1",39,0)
 ;
"RTN","XUSNPIE1",40,0)
SETQUEUE(OPT,VALUE) ;
"RTN","XUSNPIE1",41,0)
 N FDA S FDA(19.2,OPT_",",2)=VALUE D FILE^DIE("","FDA")
"RTN","XUSNPIE1",42,0)
 Q
"RTN","XUSNPIE1",43,0)
 ;
"RTN","XUSNPIE1",44,0)
POSTINIT ;
"RTN","XUSNPIE1",45,0)
 N XUGLOB,XUUSER,XIEN,X,ZTDESC,ZTDTH,ZTIO,ZTRTN
"RTN","XUSNPIE1",46,0)
 ;S XIEN=$$FIND1^DIC(19,"","","XUCOMMAND") I XIEN>0,$$FIND1^DIC(19.01,","_XIEN_",","","XUS NPI PROVIDER SELF ENTRY")'>0 S X=$$ADD^XPDMENU("XUCOMMAND","XUS NPI PROVIDER SELF ENTRY","NPI","")
"RTN","XUSNPIE1",47,0)
 ;S XIEN=$$FIND1^DIC(19,"","","XU USER SIGN-ON") I XIEN>0,$$FIND1^DIC(19.01,","_XIEN_",","","XUS NPI SIGNON CHECK")'>0 S X=$$ADD^XPDMENU("XU USER SIGN-ON","XUS NPI SIGNON CHECK","","")
"RTN","XUSNPIE1",48,0)
 ; get global containing Taxonomy values
"RTN","XUSNPIE1",49,0)
 S XUGLOB=$$CHKGLOB^XUSNPIED()
"RTN","XUSNPIE1",50,0)
 ; go through file 200 and ma
"RTN","XUSNPIE1",51,0)
 S XUUSER=0 F  S XUUSER=$O(^VA(200,XUUSER)) Q:XUUSER'>0  I $$ACTIVE^XUSER(XUUSER) D DOUSER^XUSNPIED(XUUSER,XUGLOB)
"RTN","XUSNPIE1",52,0)
 ; and send CBO a starting point list
"RTN","XUSNPIE1",53,0)
 ;S ZTIO="",ZTDTH=$$NOW^XLFDT(),ZTRTN="CBOLIST^XUSNPIED",ZTDESC="XUS NPI CBOLIST MESSAGE GENERATION" D ^%ZTLOAD
"RTN","XUSNPIE1",54,0)
 ; set up to generate CBO list monthly
"RTN","XUSNPIE1",55,0)
 D CBOQUEUE
"RTN","XUSNPIE1",56,0)
 Q
"RTN","XUSNPIE1",57,0)
 ;
"RTN","XUSNPIE1",58,0)
CBOQUEUE ;
"RTN","XUSNPIE1",59,0)
 N FDA,XUSVAL
"RTN","XUSNPIE1",60,0)
 ; check for already queued
"RTN","XUSNPIE1",61,0)
 S XUSVAL=$$FIND1^DIC(19.2,"","","XUS NPI CBO LIST") I XUSVAL>0 D  Q
"RTN","XUSNPIE1",62,0)
 . S FDA(19.2,XUSVAL_",",2)=$$SETDATE()
"RTN","XUSNPIE1",63,0)
 . S FDA(19.2,XUSVAL_",",6)="1M(1@2000,15@2000)"
"RTN","XUSNPIE1",64,0)
 . N ZTQUEUED S ZTQUEUED=1 D FILE^DIE("","FDA") K ZTQUEUED
"RTN","XUSNPIE1",65,0)
 . Q
"RTN","XUSNPIE1",66,0)
 ; no set up queued job
"RTN","XUSNPIE1",67,0)
 S XUSVAL=$$FIND1^DIC(19,"","","XUS NPI CBO LIST") Q:XUSVAL'>0  S FDA(19.2,"+1,",.01)=XUSVAL
"RTN","XUSNPIE1",68,0)
 S FDA(19.2,"+1,",2)=$$SETDATE()
"RTN","XUSNPIE1",69,0)
 S FDA(19.2,"+1,",6)="1M(1@2000,15@2000)"
"RTN","XUSNPIE1",70,0)
 N ZTQUEUED S ZTQUEUED=1 D UPDATE^DIE("","FDA") K ZTQUEUED
"RTN","XUSNPIE1",71,0)
 Q
"RTN","XUSNPIE1",72,0)
 ;
"RTN","XUSNPIE1",73,0)
SETDATE() ;
"RTN","XUSNPIE1",74,0)
 Q $S($E($$NOW^XLFDT(),6,10)<1.2:DT,$E($$NOW^XLFDT(),6,10)<15.2:$E(DT,1,5)_"15",$E(DT,4,5)>11:(($E(DT,1,3)+1)_"0101"),1:($E(DT,1,5)+1)_"01")_".2"
"RTN","XUSNPIE1",75,0)
 ;
"RTN","XUSNPIE1",76,0)
CHKOLD1(IEN) ;
"RTN","XUSNPIE1",77,0)
 D CHKOLD1^XUSNPIE2(IEN)
"RTN","XUSNPIE1",78,0)
 Q
"RTN","XUSNPIE1",79,0)
 ;
"RTN","XUSNPIE1",80,0)
CLERXMPT ;
"RTN","XUSNPIE1",81,0)
 D CLERXMPT^XUSNPIE2
"RTN","XUSNPIE1",82,0)
 Q
"RTN","XUSNPIE1",83,0)
 ;
"RTN","XUSNPIE1",84,0)
CHKDGT(XUSNPI,XUSDA,XUSQI) ; INPUT TRANSFORM
"RTN","XUSNPIE1",85,0)
 N XUS S XUS=$$CHKDGT^XUSNPI(XUSNPI)
"RTN","XUSNPIE1",86,0)
 I XUS'>0 Q 0
"RTN","XUSNPIE1",87,0)
 N XUSQIK S XUSQIK=$$QI^XUSNPI(XUSNPI) I XUSQIK=0 Q 1
"RTN","XUSNPIE1",88,0)
 ; Check whether NPI is already being used. If so, issue error or warning.
"RTN","XUSNPIE1",89,0)
 N NPIUSED,XUSRSLT
"RTN","XUSNPIE1",90,0)
 S NPIUSED=$$NPIUSED^XUSNPI1(XUSNPI,XUSQI,XUSQIK,XUSDA,.XUSRSLT,1)
"RTN","XUSNPIE1",91,0)
 ; If an error was encountered, quit 0.
"RTN","XUSNPIE1",92,0)
 I NPIUSED=1 Q 0
"RTN","XUSNPIE1",93,0)
 ; If a warning was encountered, quit 1 (Person on file 200 and 355.93 can share NPI)
"RTN","XUSNPIE1",94,0)
 I NPIUSED=2 Q 1
"RTN","XUSNPIE1",95,0)
 ; If current provider previously had this NPI, make sure the NPI being added is the most
"RTN","XUSNPIE1",96,0)
 ; current one in the EFFECTIVE DATE/TIME multiple (history).
"RTN","XUSNPIE1",97,0)
 N XUSROOT S XUSROOT=$$GET^XPAR("PKG.KERNEL","XUSNPI QUALIFIED IDENTIFIER",XUSQI)
"RTN","XUSNPIE1",98,0)
 I $E(XUSROOT)'="^" S XUSROOT="^"_XUSROOT
"RTN","XUSNPIE1",99,0)
 N XUS1 S XUS1=XUSROOT_XUSDA_","_"""NPISTATUS"""_","_"""A"""_")"
"RTN","XUSNPIE1",100,0)
 N XUS2 S XUS2=$O(@XUS1,-1) I XUS2'>0 Q 1
"RTN","XUSNPIE1",101,0)
 S XUS1=XUSROOT_XUSDA_","_"""NPISTATUS"""_","_XUS2_","_0_")"
"RTN","XUSNPIE1",102,0)
 S XUS2=$G(@XUS1) I $P(XUS2,"^",3)=XUSNPI Q 1
"RTN","XUSNPIE1",103,0)
 Q 0
"RTN","XUSNPIE2")
0^5^B76313807^B64209058
"RTN","XUSNPIE2",1,0)
XUSNPIE2 ;FO-OAKLAND/JLI - DATA ENTRY FOR INITIAL NPI VALUES ;5/13/08  17:41
"RTN","XUSNPIE2",2,0)
 ;;8.0;KERNEL;**410,435,454,462,480**;Jul 10, 1995;Build 38
"RTN","XUSNPIE2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified
"RTN","XUSNPIE2",4,0)
 Q
"RTN","XUSNPIE2",5,0)
 ;
"RTN","XUSNPIE2",6,0)
PRINTOPT ;
"RTN","XUSNPIE2",7,0)
 N DIR,%ZIS,ION,OPTION,PRNTFRMT,XUSDIV,XUSSORT,XUSRESO,Y,ZTDESC,ZTIO,ZTRTN,ZTSAVE,ZTSK
"RTN","XUSNPIE2",8,0)
 K IO("Q")
"RTN","XUSNPIE2",9,0)
 W !,"Select one of the following:",!!,?11,"1",?21,"All providers",!,?11,"2",?21,"All providers without NPI numbers",!
"RTN","XUSNPIE2",10,0)
 S DIR(0)="N^1:2",DIR("A")="Select a report option",DIR("B")="1" D ^DIR K DIR Q:Y'>0  S OPTION=+Y
"RTN","XUSNPIE2",11,0)
 S XUSRESO="" D  Q:XUSRESO=""
"RTN","XUSNPIE2",12,0)
 . S DIR(0)="S^P:Providers who are not residents;R:Residents only;B:Both"
"RTN","XUSNPIE2",13,0)
 . S DIR("B")="P",DIR("A")="Selection: "
"RTN","XUSNPIE2",14,0)
 . D ^DIR K DIR Q:"PRB"'[Y
"RTN","XUSNPIE2",15,0)
 . S XUSRESO=Y Q
"RTN","XUSNPIE2",16,0)
 S DIR(0)="Y",DIR("B")="NO",DIR("A")="Sort by DIVISION" D ^DIR K DIR Q:Y="^"  S XUSDIV=+Y
"RTN","XUSNPIE2",17,0)
 S PRNTFRMT=1
"RTN","XUSNPIE2",18,0)
 I XUSDIV S DIR(0)="N^1:2",DIR("A")="Output type (1=Printed text or 2=^-delimited)" D ^DIR K DIR Q:Y'>0  S PRNTFRMT=Y
"RTN","XUSNPIE2",19,0)
 S DIR(0)="Y",DIR("B")="YES",DIR("A")="Sort by SERVICE/SECTION"_$S(XUSDIV>0:" (as well)",1:"") D ^DIR K DIR Q:Y="^"  S XUSSORT=+Y
"RTN","XUSNPIE2",20,0)
 W !!,">>> Report processing time is approximately 10 minutes."
"RTN","XUSNPIE2",21,0)
 W !,"    Recommend text output be queued to a network printer."
"RTN","XUSNPIE2",22,0)
 W !
"RTN","XUSNPIE2",23,0)
 S %ZIS="MQ" D ^%ZIS Q:POP
"RTN","XUSNPIE2",24,0)
 I $D(IO("Q")) D  Q
"RTN","XUSNPIE2",25,0)
 . S ZTSAVE("OPTION")="",ZTSAVE("XUSSORT")="",ZTSAVE("XUSDIV")="",ZTSAVE("PRNTFRMT")="",ZTSAVE("XUSRESO")=""
"RTN","XUSNPIE2",26,0)
 . S ZTIO=ION,ZTRTN="DQ^XUSNPIE2",ZTDESC="NPI PRINT JOB FOR OPTION "_OPTION
"RTN","XUSNPIE2",27,0)
 . D ^%ZTLOAD W:$D(ZTSK) !,"Queued as Task "_ZTSK D HOME^%ZIS Q
"RTN","XUSNPIE2",28,0)
 ;
"RTN","XUSNPIE2",29,0)
DQ ; entry point for queued print job
"RTN","XUSNPIE2",30,0)
 U IO D PRNTPROV(OPTION,XUSSORT,XUSDIV,PRNTFRMT,XUSRESO)
"RTN","XUSNPIE2",31,0)
 U IO D ^%ZISC
"RTN","XUSNPIE2",32,0)
 Q
"RTN","XUSNPIE2",33,0)
 ;
"RTN","XUSNPIE2",34,0)
PRNTPROV(OPTION,XUSSORT,XUSDIV,PRNTFRMT,XUSRESO) ;
"RTN","XUSNPIE2",35,0)
 ; PRINT PROVIDER INFO
"RTN","XUSNPIE2",36,0)
 ;
"RTN","XUSNPIE2",37,0)
 ; OPTION   SPECIFIES TYPE OF PRINT - 1=ALL PROVIDERS, 2=NEEDS NPI ONLY
"RTN","XUSNPIE2",38,0)
 ; XUSSORT  INDICATES WHETHER SORTED BY SERVICE/SECTION
"RTN","XUSNPIE2",39,0)
 ; XUSDIV   INDICATES WHETHER SORTED BY DIVISION
"RTN","XUSNPIE2",40,0)
 ; PRNTFRMT INDICATES TYPE OF OUTPUT, PRINTED OR ^-DELIMITED
"RTN","XUSNPIE2",41,0)
 ;
"RTN","XUSNPIE2",42,0)
 ; ZEXCEPT: IOSL    - KERNEL VARIABLE
"RTN","XUSNPIE2",43,0)
 N PAGENUM,LINENUM,PROVNAME,TAXDESCR,TAXONOMY,SERVSECT,DIRUT,DTOUT
"RTN","XUSNPIE2",44,0)
 N GLOBLOC,IEN,NPI,DATETIME,GLOBVALU,NCOUNT,GLOBLOC1,XUSDIVNM,CNTTOTAL,CNTNONE,CNTEXMPT,CNTDONE,MULTDIV,MULTDIVC
"RTN","XUSNPIE2",45,0)
 S CNTTOTAL=0,CNTNONE=0,CNTEXMPT=0,CNTDONE=0
"RTN","XUSNPIE2",46,0)
 S PAGENUM=0,LINENUM=0
"RTN","XUSNPIE2",47,0)
 S DATETIME=$$NOW^XLFDT()
"RTN","XUSNPIE2",48,0)
 S GLOBLOC1=$$GETDATA(OPTION,XUSSORT,XUSDIV,XUSRESO)
"RTN","XUSNPIE2",49,0)
 I PRNTFRMT'=1 W !,"PROVIDER_NAME^LAST4^IEN^NPI^TAXONOMY_CODE^TAXONOMY DESCRIPTION"_$S(XUSDIV:"^DIVISION",1:"")_$S(XUSSORT:"^SERVICE/SECTION",1:"")
"RTN","XUSNPIE2",50,0)
 S GLOBLOC=GLOBLOC1,XUSDIVNM="" F  S XUSDIVNM=$O(@GLOBLOC1@(XUSDIVNM)) Q:XUSDIVNM=""  D  Q:$D(DIRUT)!$D(DTOUT)
"RTN","XUSNPIE2",51,0)
 . S SERVSECT="" F  S SERVSECT=$O(@GLOBLOC1@(XUSDIVNM,SERVSECT)) Q:SERVSECT=""  S GLOBLOC=$NA(@GLOBLOC1@(XUSDIVNM,SERVSECT)) D  Q:$D(DIRUT)!$D(DTOUT)
"RTN","XUSNPIE2",52,0)
 . . I PRNTFRMT=1 D HEADER(OPTION,DATETIME,.PAGENUM,.LINENUM,XUSDIV,XUSDIVNM,XUSSORT,SERVSECT,XUSRESO) Q:$D(DIRUT)!$D(DTOUT)
"RTN","XUSNPIE2",53,0)
 . . S PROVNAME="" F  S PROVNAME=$O(@GLOBLOC@(PROVNAME)) Q:PROVNAME=""  Q:$D(DIRUT)!$D(DTOUT)  S IEN=0 F  S IEN=$O(@GLOBLOC@(PROVNAME,IEN)) Q:IEN'>0  D  Q:$D(DIRUT)!$D(DTOUT)
"RTN","XUSNPIE2",54,0)
 . . . S NCOUNT=0
"RTN","XUSNPIE2",55,0)
 . . . S TAXDESCR="" F  S TAXDESCR=$O(@GLOBLOC@(PROVNAME,IEN,TAXDESCR)) Q:TAXDESCR=""  S GLOBVALU=@GLOBLOC@(PROVNAME,IEN,TAXDESCR) D
"RTN","XUSNPIE2",56,0)
 . . . . S NPI=$P(GLOBVALU,U,3),TAXONOMY=$P(GLOBVALU,U,4)
"RTN","XUSNPIE2",57,0)
 . . . . I PRNTFRMT=1 S NCOUNT=NCOUNT+1 W:NCOUNT=1 !,PROVNAME,?33,$$ALIGNRGT(IEN,11),?49,NPI W !,?6,TAXONOMY,"  ",TAXDESCR
"RTN","XUSNPIE2",58,0)
 . . . . I PRNTFRMT'=1 W !,PROVNAME_U_$E($$GET1^DIQ(200,IEN_",",9),6,9)_U_IEN_U_NPI_U_TAXONOMY_U_TAXDESCR_$S(XUSDIV:U_XUSDIVNM,1:"")_$S(XUSSORT:U_SERVSECT,1:"")
"RTN","XUSNPIE2",59,0)
 . . . . Q
"RTN","XUSNPIE2",60,0)
 . . . I PRNTFRMT=1 S LINENUM=LINENUM+NCOUNT+1 I LINENUM>(IOSL-4) D HEADER(OPTION,DATETIME,.PAGENUM,.LINENUM,XUSDIV,XUSDIVNM,XUSSORT,SERVSECT,XUSRESO) Q:$D(DIRUT)!$D(DTOUT)
"RTN","XUSNPIE2",61,0)
 . . . Q
"RTN","XUSNPIE2",62,0)
 . . Q
"RTN","XUSNPIE2",63,0)
 . Q
"RTN","XUSNPIE2",64,0)
 I '($D(DIRUT)!$D(DTOUT)),PRNTFRMT=1 D
"RTN","XUSNPIE2",65,0)
 . S PROVNAME="" I $O(@GLOBLOC@(PROVNAME))="" W !,?20,"* * * N O  D A T A  F O U N D * * *",!! I 1
"RTN","XUSNPIE2",66,0)
 . E  D
"RTN","XUSNPIE2",67,0)
 . . N TOTTYP S TOTTYP=$S(XUSRESO="R":"Residents",1:"Billable Providers")
"RTN","XUSNPIE2",68,0)
 . . W !!,"Total "_TOTTYP_":",?43,CNTTOTAL,!,TOTTYP_" with an NPI:",?43,CNTDONE,!,"EXEMPT "_TOTTYP_":",?43,CNTEXMPT,!,TOTTYP_" Still Needing an NPI:",?43,CNTNONE
"RTN","XUSNPIE2",69,0)
 . . I $G(MULTDIV)>0 W !!,MULTDIV," Providers were repeated a total of ",MULTDIVC," times",!," due to listing under multiple divisions"
"RTN","XUSNPIE2",70,0)
 . . Q
"RTN","XUSNPIE2",71,0)
 . W !!,?27,"*** End of Report ***"
"RTN","XUSNPIE2",72,0)
 . Q
"RTN","XUSNPIE2",73,0)
 Q
"RTN","XUSNPIE2",74,0)
 ;
"RTN","XUSNPIE2",75,0)
HEADER(OPTION,DATETIME,PAGNOREF,LINNOREF,XUSDIV,XUSDIVNM,XUSSORT,SERVSECT,XUSRESO) ;
"RTN","XUSNPIE2",76,0)
 ; ZEXCEPT: IOF,IOST  KERNEL IO VARIABLES
"RTN","XUSNPIE2",77,0)
 ; ZEXCEPT: DIRUT,DTOUT  NEWED IN CALLING PRNTPROV - INDICATE QUIT TO PRNTPROV
"RTN","XUSNPIE2",78,0)
 N TEMPVAL,DIR,X,Y
"RTN","XUSNPIE2",79,0)
 S PAGNOREF=PAGNOREF+1
"RTN","XUSNPIE2",80,0)
 ; Don't page feed on the first page
"RTN","XUSNPIE2",81,0)
 IF PAGNOREF>1 I $E(IOST,1,2)="C-" S DIR(0)="E" D ^DIR I 'Y S DIRUT=1 Q
"RTN","XUSNPIE2",82,0)
 IF PAGNOREF>1 W @IOF
"RTN","XUSNPIE2",83,0)
 W:$E(IOST,1,2)'="C-" !
"RTN","XUSNPIE2",84,0)
 W "Active Provider Report ("_$S(XUSRESO="P":"no residents)",XUSRESO="R":"residents only)",1:"includes residents)")
"RTN","XUSNPIE2",85,0)
 W ?48,$$FMTE^XLFDT(DATETIME),"  Page: ",PAGNOREF
"RTN","XUSNPIE2",86,0)
 W !," Report Option: Provider List       Active Providers",$S(OPTION=2:" Without NPI Numbers",1:"")
"RTN","XUSNPIE2",87,0)
 W !!,"Provider Name",?39,"IEN",?49,$S(OPTION'=2:"NPI",1:"")
"RTN","XUSNPIE2",88,0)
 W !,"      Taxonomy"
"RTN","XUSNPIE2",89,0)
 W !,"--------------------------------------------------------------------------------"
"RTN","XUSNPIE2",90,0)
 S LINNOREF=6
"RTN","XUSNPIE2",91,0)
 I XUSDIV W !,"DIVISION: ",XUSDIVNM,"   " S LINNOREF=LINNOREF+1
"RTN","XUSNPIE2",92,0)
 I XUSSORT W:'XUSDIV ! W "SERVICE/SECTION: ",SERVSECT S:'XUSDIV LINNOREF=LINNOREF+1
"RTN","XUSNPIE2",93,0)
 Q
"RTN","XUSNPIE2",94,0)
 ;
"RTN","XUSNPIE2",95,0)
GETDATA(OPTION,XUSSORT,XUSDIV,XUSRESO) ; get data for reports for providers
"RTN","XUSNPIE2",96,0)
 N NPI,PROVNAME,TAXDESCR,TAXONOMY,XUSDEFLT,XUSDIVCN,XUSDIVN,XUSDIVNM,XUSGLOB,XUSACTV,XUSSKIP
"RTN","XUSNPIE2",97,0)
 N XUSIEN,XUSSERVC,XUSVAL,CNTCLEAN,X
"RTN","XUSNPIE2",98,0)
 S XUSRESO=$G(XUSRESO)
"RTN","XUSNPIE2",99,0)
 ; ZEXCEPT: CNTTOTAL,CNTNONE,CNTEXMPT,CNTDONE - NEWed and initialized in PRNTPROV or killed based on CNTCLEAN
"RTN","XUSNPIE2",100,0)
 S CNTCLEAN=0 I '$D(CNTTOTAL) S CNTCLEAN=1
"RTN","XUSNPIE2",101,0)
 S XUSGLOB=$NA(^TMP($J,"XUSNPIPRNT")) K @XUSGLOB
"RTN","XUSNPIE2",102,0)
 I 'XUSDIV S XUSDIVNM(1)=" ",XUSDEFLT=" "
"RTN","XUSNPIE2",103,0)
 I XUSDIV S XUSDEFLT=$$NS^XUAF4($$KSP^XUPARAM("INST")),XUSDEFLT=$P(XUSDEFLT,U)
"RTN","XUSNPIE2",104,0)
 I 'XUSSORT S XUSSERVC=" "
"RTN","XUSNPIE2",105,0)
 F XUSIEN=0:0 S XUSIEN=$O(^VA(200,XUSIEN)) Q:XUSIEN'>0  D
"RTN","XUSNPIE2",106,0)
 . ; Don't report TERMINATED or DISUSERed users
"RTN","XUSNPIE2",107,0)
 . S XUSACTV=$$ACTIVE^XUSER(XUSIEN)
"RTN","XUSNPIE2",108,0)
 . I XUSACTV=""!($P(XUSACTV,U)=0) Q
"RTN","XUSNPIE2",109,0)
 . ; Don't report users with null NPI ENTRY STATUS
"RTN","XUSNPIE2",110,0)
 . S XUSVAL=$$CHEKNPI^XUSNPIED(XUSIEN),XUSVAL=$$NPISTATS^XUSNPIED(XUSIEN)
"RTN","XUSNPIE2",111,0)
 . Q:XUSVAL=""
"RTN","XUSNPIE2",112,0)
 . S PROVNAME=$$GET1^DIQ(200,XUSIEN_",",.01),NPI=$$GETNPI^XUSNPIED(XUSIEN),TAXONOMY=$$GETTAXON^XUSNPIED(XUSIEN,.TAXDESCR) I TAXONOMY=-1 S TAXONOMY=" ",TAXDESCR=" "
"RTN","XUSNPIE2",113,0)
 . ; Determine whether provider is a resident for local reports.
"RTN","XUSNPIE2",114,0)
 . I OPTION'=3,XUSRESO'="B" S XUSSKIP=0 D  Q:XUSSKIP
"RTN","XUSNPIE2",115,0)
 . . I XUSRESO="R",TAXONOMY'="390200000X" S XUSSKIP=1 Q
"RTN","XUSNPIE2",116,0)
 . . I XUSRESO="P",TAXONOMY="390200000X" S XUSSKIP=1
"RTN","XUSNPIE2",117,0)
 . . Q
"RTN","XUSNPIE2",118,0)
 . I NPI="",$$EXMPTNPI^XUSNPIED(XUSIEN) S NPI="EXEMPTED  "
"RTN","XUSNPIE2",119,0)
 . S CNTTOTAL=$G(CNTTOTAL)+1 S:NPI="" CNTNONE=$G(CNTNONE)+1 S:NPI="EXEMPTED  " CNTEXMPT=$G(CNTEXMPT)+1 S:NPI?10N CNTDONE=$G(CNTDONE)+1
"RTN","XUSNPIE2",120,0)
 . I '((XUSVAL="N")!(OPTION'=2)) Q
"RTN","XUSNPIE2",121,0)
 . I XUSSORT S XUSSERVC=$$GET1^DIQ(200,XUSIEN_",",29) I XUSSERVC="" S XUSSERVC=" "
"RTN","XUSNPIE2",122,0)
 . I XUSDIV D
"RTN","XUSNPIE2",123,0)
 . . K XUSDIVNM S XUSDIVCN=0,XUSDIVNM(1)=XUSDEFLT
"RTN","XUSNPIE2",124,0)
 . . F XUSDIVN=0:0 S XUSDIVN=$O(^VA(200,XUSIEN,2,XUSDIVN)) Q:XUSDIVN'>0  S XUSDIVCN=XUSDIVCN+1,XUSDIVNM(XUSDIVCN)=$$GET1^DIQ(200.02,XUSDIVN_","_XUSIEN_",",.01)
"RTN","XUSNPIE2",125,0)
 . . I XUSDIVCN>1 S MULTDIV=$G(MULTDIV)+1,MULTDIVC=$G(MULTDIVC)+XUSDIVCN-1
"RTN","XUSNPIE2",126,0)
 . . Q
"RTN","XUSNPIE2",127,0)
 . F XUSDIVN=0:0 S XUSDIVN=$O(XUSDIVNM(XUSDIVN)) Q:XUSDIVN'>0  D
"RTN","XUSNPIE2",128,0)
 . . S X=PROVNAME_U_XUSIEN_U_NPI_U_TAXONOMY_U_TAXDESCR
"RTN","XUSNPIE2",129,0)
 . . S @XUSGLOB@(XUSDIVNM(XUSDIVN),XUSSERVC,PROVNAME,XUSIEN,TAXDESCR)=X
"RTN","XUSNPIE2",130,0)
 . . Q 
"RTN","XUSNPIE2",131,0)
 . Q
"RTN","XUSNPIE2",132,0)
 I CNTCLEAN K CNTTOTAL,CNTNONE,CNTEXMPT,CNTDONE
"RTN","XUSNPIE2",133,0)
 Q XUSGLOB
"RTN","XUSNPIE2",134,0)
 ;
"RTN","XUSNPIE2",135,0)
ALIGNRGT(TEXT,WIDTH) ; align text right in a specified width
"RTN","XUSNPIE2",136,0)
 N RESULT
"RTN","XUSNPIE2",137,0)
 S $P(RESULT," ",WIDTH)=" ",RESULT=RESULT_TEXT,RESULT=$E(RESULT,$L(RESULT)-WIDTH+1,$L(RESULT))
"RTN","XUSNPIE2",138,0)
 Q RESULT
"RTN","XUSNPIE2",139,0)
 ;
"RTN","XUSNPIE2",140,0)
CHKOLD1(IEN) ; check for earlier value, and activate if present
"RTN","XUSNPIE2",141,0)
 N IEN1,STATUS,NPI,DATE,XUFDA
"RTN","XUSNPIE2",142,0)
 S IEN1=$O(^VA(200,IEN,"NPISTATUS"," "),-1) I IEN1>0 D  I STATUS=0 D CHKOLD1(IEN)
"RTN","XUSNPIE2",143,0)
 . S STATUS=^VA(200,IEN,"NPISTATUS",IEN1,0),NPI=$P(STATUS,U,3),DATE=$P(STATUS,U),STATUS=$P(STATUS,U,2)
"RTN","XUSNPIE2",144,0)
 . I STATUS=0 D DELETNPI(IEN,IEN1,DATE) Q  ; entry making it INACTIVE - remove it
"RTN","XUSNPIE2",145,0)
 . I STATUS=1 D SET^XUSNPIE1(IEN,NPI)
"RTN","XUSNPIE2",146,0)
 . Q
"RTN","XUSNPIE2",147,0)
 Q
"RTN","XUSNPIE2",148,0)
 ;
"RTN","XUSNPIE2",149,0)
DELETNPI(IEN,OIEN,ODATEVAL) ;
"RTN","XUSNPIE2",150,0)
 N XUFDA
"RTN","XUSNPIE2",151,0)
 I $D(ODATEVAL) S XUFDA(200.042,OIEN_","_IEN_",",.01)="@" D FILE^DIE("","XUFDA")
"RTN","XUSNPIE2",152,0)
 I $O(^VA(200,IEN,"NPISTATUS",0))>0 Q
"RTN","XUSNPIE2",153,0)
 N XUFDA
"RTN","XUSNPIE2",154,0)
 I $$GET1^DIQ(200,IEN_",",41.99) S XUFDA(200,IEN_",",41.99)="@"
"RTN","XUSNPIE2",155,0)
 I $$GET1^DIQ(200,IEN_",",41.98)'="" S XUFDA(200,IEN_",",41.98)="@"
"RTN","XUSNPIE2",156,0)
 I $D(XUFDA) D FILE^DIE("","XUFDA")
"RTN","XUSNPIE2",157,0)
 Q
"RTN","XUSNPIE2",158,0)
 ;
"RTN","XUSNPIE2",159,0)
CLERXMPT ; edit entry indicating whether a provider is exempt from needing an NPI
"RTN","XUSNPIE2",160,0)
 N DIC,DIR,FDA,IEN,Y
"RTN","XUSNPIE2",161,0)
 W ! S DIC="^VA(200,",DIC(0)="AEQ" S DIC("A")="select Provider: " D ^DIC Q:Y'>0  S IEN=+Y
"RTN","XUSNPIE2",162,0)
 I $$HASNPI^XUSNPIED(IEN) W !,"This Provider already has an NPI value.  Nothing to do." Q
"RTN","XUSNPIE2",163,0)
 I '$$CHEKNPI^XUSNPIED(IEN),'$$EXMPTNPI^XUSNPIED(IEN) W !,"This Provider does not appear to need an NPI or Exemption." Q
"RTN","XUSNPIE2",164,0)
 I $$EXMPTNPI^XUSNPIED(IEN) D  Q  ; currently marked as Exempt
"RTN","XUSNPIE2",165,0)
 . S DIR(0)="Y",DIR("A")="Provider is currently EXEMPT from needing an NPI, set to NEEDS an NPI (Y/N)" D ^DIR I 'Y Q
"RTN","XUSNPIE2",166,0)
 . S FDA(200,IEN_",",41.98)="N" D FILE^DIE("","FDA")
"RTN","XUSNPIE2",167,0)
 . W !,$S($$NEEDSNPI^XUSNPIED(IEN):"File updated",1:"Ecountered a problem updating file, status NOT set to NEEDS an NPI")
"RTN","XUSNPIE2",168,0)
 . Q
"RTN","XUSNPIE2",169,0)
 ; check to make sure provider should be exempt
"RTN","XUSNPIE2",170,0)
 S DIR(0)="Y",DIR("A")="Confirm that Provider should be Exempt from needing an NPI (Y/N)" D ^DIR I 'Y Q
"RTN","XUSNPIE2",171,0)
 ; and update file to show as exempt
"RTN","XUSNPIE2",172,0)
 S FDA(200,IEN_",",41.98)="E" D FILE^DIE("","FDA")
"RTN","XUSNPIE2",173,0)
 W !,$S($$EXMPTNPI^XUSNPIED(IEN):"File updated",1:"Ecountered a problem updating file, status NOT set to EXEMPT")
"RTN","XUSNPIE2",174,0)
 Q
"RTN","XUSNPIE3")
0^7^B53683748^n/a
"RTN","XUSNPIE3",1,0)
XUSNPIE3 ;FO-OAKLAND/JLI - NATIONAL PROVIDER IDENTIFIER DATA CAPTURE ;4/8/08  18:18
"RTN","XUSNPIE3",2,0)
 ;;8.0;KERNEL;**480**; July 10, 1995;Build 38
"RTN","XUSNPIE3",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified
"RTN","XUSNPIE3",4,0)
 ;
"RTN","XUSNPIE3",5,0)
 Q
"RTN","XUSNPIE3",6,0)
 ;
"RTN","XUSNPIE3",7,0)
EDITNPI(IEN) ; main entry of NPI value
"RTN","XUSNPIE3",8,0)
 ; IEN is the internal entry number in file 200 for the provider
"RTN","XUSNPIE3",9,0)
 ;
"RTN","XUSNPIE3",10,0)
 N DATEVAL,DESCRIP,DONE,NPIVAL1,NPIVAL2,PROVNAME,I,XX,X,Y,CURRNPI,XUSFLAG
"RTN","XUSNPIE3",11,0)
 N ODATEVAL,OIEN,OLDNPI,XUSNONED,DIR,ADDNPI,DELETNPI,NOOLDNPI,XUSQI,NPIUSEDX,XUSRSLT
"RTN","XUSNPIE3",12,0)
 S ADDNPI=1,DELETNPI=2,NOOLDNPI=0
"RTN","XUSNPIE3",13,0)
 S PROVNAME=$$GET1^DIQ(200,IEN_",",.01)
"RTN","XUSNPIE3",14,0)
 ;I $$ACTIVE^XUSER(IEN) W !,"This user isn't currently active" Q
"RTN","XUSNPIE3",15,0)
 I $$GETTAXON^XUSNPIED(IEN,.DESCRIP)=-1 W !,"This user doesn't have a Taxonomy Code indicating a need for an NPI." S XUSNONED=1 ; but don't quit on that
"RTN","XUSNPIE3",16,0)
 I $$NPISTATS^XUSNPIED(IEN)="D" S XUSNONED=1
"RTN","XUSNPIE3",17,0)
 I $$NPISTATS^XUSNPIED(IEN)="E" W !,"This provider has been indicated as being EXEMPT from needing an NPI value.",!,"   Use Exempt option to remove it first" Q
"RTN","XUSNPIE3",18,0)
 ; OLDNPI indicates what user wants to do with the current NPI
"RTN","XUSNPIE3",19,0)
 ; OLDNPI=0 - User has no current NPI, or user asks to delete current NPI and it's valid
"RTN","XUSNPIE3",20,0)
 ; OLDNPI=1 - User asked to Replace current NPI
"RTN","XUSNPIE3",21,0)
 ; OLDNPI=2 - User asked to delete current NPI, and it was entered in error.
"RTN","XUSNPIE3",22,0)
 ; OLDNPI="NOEDITNPI" - User doesn't want to change current NPI in any way.
"RTN","XUSNPIE3",23,0)
 S OLDNPI=NOOLDNPI
"RTN","XUSNPIE3",24,0)
 ; Initialize flag indicating that current NPI is in use
"RTN","XUSNPIE3",25,0)
 S NPIUSEDX=0
"RTN","XUSNPIE3",26,0)
 ; If user already has an NPI, ask them what they want to do with it.
"RTN","XUSNPIE3",27,0)
 I $$NPISTATS^XUSNPIED(IEN)="D" D  Q:OLDNPI=NOOLDNPI  ; Quit if no NPI, or delete Valid NPI
"RTN","XUSNPIE3",28,0)
 . N I,X,DIR
"RTN","XUSNPIE3",29,0)
 . S CURRNPI=$$GET1^DIQ(200,IEN_",",41.99) I CURRNPI="" Q
"RTN","XUSNPIE3",30,0)
 . S OIEN=$$SRCHNPI^XUSNPI("^VA(200,",IEN,CURRNPI)
"RTN","XUSNPIE3",31,0)
 . I OIEN>0 S ODATEVAL=$P(OIEN,U,2),OIEN=$O(^VA(200,IEN,"NPISTATUS","C",CURRNPI,"A"),-1)
"RTN","XUSNPIE3",32,0)
 . I '$D(ODATEVAL) S OLDNPI=2 ; can't find entry in multiple, delete entry at top
"RTN","XUSNPIE3",33,0)
 . W !,"This provider already has an NPI value (",CURRNPI,") entered."
"RTN","XUSNPIE3",34,0)
 . ; Check whether current NPI is already being used. If so, issue a warning.
"RTN","XUSNPIE3",35,0)
 . S NPIUSEDX=$$CHKNPIU(CURRNPI,IEN,2,.XUSRSLT)
"RTN","XUSNPIE3",36,0)
 . S DIR(0)="SO^D:Delete;R:Replace"
"RTN","XUSNPIE3",37,0)
 . S DIR("A")="Do you want to (D)elete or (R)eplace this NPI value?"
"RTN","XUSNPIE3",38,0)
 . S DIR("?")="Enter D or R, ^ to quit or <Enter> to continue without editing NPI"
"RTN","XUSNPIE3",39,0)
 . S DIR("?",1)="If this NPI was entered for the incorrect individual, or is no longer valid"
"RTN","XUSNPIE3",40,0)
 . S DIR("?",2)="for this individual, enter DELETE. Otherwise, the NPI can be Replaced."
"RTN","XUSNPIE3",41,0)
 . S DIR("?",3)=""
"RTN","XUSNPIE3",42,0)
 . D ^DIR K DIR
"RTN","XUSNPIE3",43,0)
 . Q:$D(DTOUT)
"RTN","XUSNPIE3",44,0)
 . ; If user enters null, set OLDNPI to "NOEDITNPI" to indicate no change to NPI
"RTN","XUSNPIE3",45,0)
 . S:Y="" OLDNPI="NOEDITNPI"
"RTN","XUSNPIE3",46,0)
 . I Y'="D",Y'="R" Q
"RTN","XUSNPIE3",47,0)
 . I Y="R" S OLDNPI=ADDNPI Q
"RTN","XUSNPIE3",48,0)
 . ; Process request to DELETE NPI.
"RTN","XUSNPIE3",49,0)
 . S DIR(0)="S^V:VALID;E:ERROR",DIR("A",1)="Was the original NPI (V)alid for this provider",DIR("A")="or was it entered in (E)rror?",DIR("?")="Enter either V or E or ^ to quit with out editing"
"RTN","XUSNPIE3",50,0)
 . S DIR("?",1)="If the NPI value was entered for the incorrect individual, respond E,",DIR("?",2)="otherwise enter V"
"RTN","XUSNPIE3",51,0)
 . D ^DIR K DIR
"RTN","XUSNPIE3",52,0)
 . Q:"EV"'[Y
"RTN","XUSNPIE3",53,0)
 . ; Process DELETE NPI that was Valid for this provider
"RTN","XUSNPIE3",54,0)
 . I Y="V" D   S OLDNPI=NOOLDNPI Q
"RTN","XUSNPIE3",55,0)
 . . S Y=$$ADDNPI^XUSNPI("Individual_ID",IEN,CURRNPI,$$NOW^XLFDT(),0)
"RTN","XUSNPIE3",56,0)
 . . W !,$S(Y>-1:"Entry has been marked inactive.",1:$P(Y,U,2)),!
"RTN","XUSNPIE3",57,0)
 . . Q:+Y=-1
"RTN","XUSNPIE3",58,0)
 . . N XUFDA
"RTN","XUSNPIE3",59,0)
 . . S XUFDA(200,IEN_",",41.98)="@",XUFDA(200,IEN_",",41.99)="@"
"RTN","XUSNPIE3",60,0)
 . . D FILE^DIE("","XUFDA") S Y=$$CHEKNPI^XUSNPIED(IEN)
"RTN","XUSNPIE3",61,0)
 . . I NPIUSEDX D WARNING("D",PROVNAME,.XUSRSLT)
"RTN","XUSNPIE3",62,0)
 . . Q
"RTN","XUSNPIE3",63,0)
 . S OLDNPI=DELETNPI
"RTN","XUSNPIE3",64,0)
 . Q
"RTN","XUSNPIE3",65,0)
 ; If user doesn't want to edit current NPI, quit.
"RTN","XUSNPIE3",66,0)
 Q:OLDNPI="NOEDITNPI"
"RTN","XUSNPIE3",67,0)
 ; If user is not a provider, and has no NPI, let them know.
"RTN","XUSNPIE3",68,0)
 I $$CHEKNPI^XUSNPIED(IEN)=0,OLDNPI=0 W !,"Need for an NPI value isn't indicated - but you can enter an NPI",$C(7)
"RTN","XUSNPIE3",69,0)
 I IEN'=DUZ D
"RTN","XUSNPIE3",70,0)
 . W !,"Provider: ",PROVNAME,"   ","XXX-XX-"_$E($$GET1^DIQ(200,IEN_",",9),6,9),"   DOB: "
"RTN","XUSNPIE3",71,0)
 . S XX=$P($G(^VA(200,IEN,1)),U,3) S:XX'="" XX=$$DATE10^XUSNPIED(XX) W XX Q
"RTN","XUSNPIE3",72,0)
 ; Initialize DONE to 0. It will be set to 1 if a new NPI is entered.
"RTN","XUSNPIE3",73,0)
 S DONE=0
"RTN","XUSNPIE3",74,0)
 ; Allow user to add a new or replacement NPI.
"RTN","XUSNPIE3",75,0)
 I OLDNPI'=DELETNPI F  R !,"Enter NPI (10 digits): ",NPIVAL1:DTIME Q:'$T  Q:NPIVAL1=""  Q:NPIVAL1=U  D  Q:DONE
"RTN","XUSNPIE3",76,0)
 . I NPIVAL1'?10N D  Q
"RTN","XUSNPIE3",77,0)
 . . W !,$C(7),"Enter a 10 digit National Provider Identifier which is obtained ",!,"from 'https://nppes.cms.hhs.gov/NPPES/Welcome.do'"
"RTN","XUSNPIE3",78,0)
 . . Q:$$PROD^XUPROD()  W ! K DIR S DIR(0)="Y",DIR("A")="Do you want to generate a test NPI value" D ^DIR Q:'Y
"RTN","XUSNPIE3",79,0)
 . . R !,"Enter a nine (9) digit number as the base: ",Y:DTIME Q:Y'?9N
"RTN","XUSNPIE3",80,0)
 . . W !,"The complete NPI value is: ",Y_$$CKDIGIT^XUSNPI(Y),!
"RTN","XUSNPIE3",81,0)
 . . Q
"RTN","XUSNPIE3",82,0)
 . S NPIUSED=$$CHKNPIU(NPIVAL1,IEN,3)
"RTN","XUSNPIE3",83,0)
 . ; Quit if error
"RTN","XUSNPIE3",84,0)
 . Q:NPIUSED=1
"RTN","XUSNPIE3",85,0)
 . ; If warning, see whether they want to continue
"RTN","XUSNPIE3",86,0)
 . I NPIUSED=2 D  Q:Y'="Y"
"RTN","XUSNPIE3",87,0)
 . . K DIR,Y,X
"RTN","XUSNPIE3",88,0)
 . . S DIR(0)="SA^Y:yes;N:no",DIR("B")="N"
"RTN","XUSNPIE3",89,0)
 . . S DIR("A")="Do you still want to add this NPI to Provider "_PROVNAME_"? "
"RTN","XUSNPIE3",90,0)
 . . S DIR("?")="If you answer YES, make sure both the non-VA and VA Provider are the same person."
"RTN","XUSNPIE3",91,0)
 . . S DIR("?",1)="A provider can serve as both a VA and a non-VA provider."
"RTN","XUSNPIE3",92,0)
 . . S DIR("?",2)="That is the only case where the same NPI can be assigned to a person"
"RTN","XUSNPIE3",93,0)
 . . S DIR("?",3)="in both the VA and the non-VA provider files."
"RTN","XUSNPIE3",94,0)
 . . S DIR("?",4)=" "
"RTN","XUSNPIE3",95,0)
 . . D ^DIR W !
"RTN","XUSNPIE3",96,0)
 . . K DIR,X Q
"RTN","XUSNPIE3",97,0)
 . R !,"Please re-enter NPI  : ",NPIVAL2:DTIME Q:'$T  I NPIVAL1'=NPIVAL2 W !,"Values do not match!" Q
"RTN","XUSNPIE3",98,0)
 . S DONE=1
"RTN","XUSNPIE3",99,0)
 . Q
"RTN","XUSNPIE3",100,0)
 ; User asked to DELETE where NPI was entered in error.
"RTN","XUSNPIE3",101,0)
 I OLDNPI=DELETNPI D
"RTN","XUSNPIE3",102,0)
 . I $D(ODATEVAL) D  S Y=$$CHEKNPI^XUSNPIED(IEN) Q
"RTN","XUSNPIE3",103,0)
 . . N DIR S DIR(0)="Y",DIR("A")="Confirm that you want to **DELETE** this incorrectly entered NPI",DIR("B")="NO" D ^DIR Q:'Y
"RTN","XUSNPIE3",104,0)
 . . D DELETNPI^XUSNPIE2(IEN,OIEN,ODATEVAL)
"RTN","XUSNPIE3",105,0)
 . . D CHKOLD1^XUSNPIE2(IEN) ; check for earlier value, and activate if present
"RTN","XUSNPIE3",106,0)
 . . W !,"Entry was DELETED..."
"RTN","XUSNPIE3",107,0)
 . . I NPIUSEDX D WARNING("D",PROVNAME,.XUSRSLT)
"RTN","XUSNPIE3",108,0)
 . . Q
"RTN","XUSNPIE3",109,0)
 . D DELETNPI^XUSNPIE2(IEN) ; clean up where no entry in multiple
"RTN","XUSNPIE3",110,0)
 . W !,"Entry was DELETED..."
"RTN","XUSNPIE3",111,0)
 . Q
"RTN","XUSNPIE3",112,0)
 ; DONE will be set to 1 if a new or replacement NPI was entered by the user.
"RTN","XUSNPIE3",113,0)
 I 'DONE Q
"RTN","XUSNPIE3",114,0)
 ;N DIR S DIR("A")="Enter the date the provider was issued this number from CMS: ",DIR(0)="D^:"_$$NOW^XLFDT() D ^DIR Q:Y'>0  S DATEVAL=+Y
"RTN","XUSNPIE3",115,0)
 S DATEVAL=$$NOW^XLFDT()
"RTN","XUSNPIE3",116,0)
 ; mark previous NPI value as inactive
"RTN","XUSNPIE3",117,0)
 I OLDNPI=ADDNPI S DONE=$$ADDNPI^XUSNPI("Individual_ID",IEN,CURRNPI,DATEVAL,0) ; set status to INACTIVE
"RTN","XUSNPIE3",118,0)
 S DONE=$$ADDNPI^XUSNPI("Individual_ID",IEN,NPIVAL1,DATEVAL)
"RTN","XUSNPIE3",119,0)
 I +DONE=-1 D  Q 
"RTN","XUSNPIE3",120,0)
 . W !,"Problem writing that value into the database! --  It was **NOT** recorded."
"RTN","XUSNPIE3",121,0)
 . W !,$P(DONE,U,2) Q
"RTN","XUSNPIE3",122,0)
 W !!,"For provider ",PROVNAME," "_$S('$D(XUSNONED):"(who requires an NPI), ",1:"")_"the NPI ",NPIVAL1,!,"was saved to VistA successfully."
"RTN","XUSNPIE3",123,0)
 ; If old NPI was in use by a non-VA provider, issue additional warning.
"RTN","XUSNPIE3",124,0)
 I NPIUSEDX D WARNING("C",PROVNAME,.XUSRSLT,NPIVAL1)
"RTN","XUSNPIE3",125,0)
 D EDRLNPI^XUSNPIED(IEN)
"RTN","XUSNPIE3",126,0)
 Q
"RTN","XUSNPIE3",127,0)
 ;
"RTN","XUSNPIE3",128,0)
CHKNPIU(XUSNPI,XUSIEN,XUSFLAG,XUSRSLT) ; Return error or warning if current or new NPI is in use
"RTN","XUSNPIE3",129,0)
 N XUSQI,NPIUSED,I
"RTN","XUSNPIE3",130,0)
 S XUSQI=$$QI^XUSNPI(XUSNPI)
"RTN","XUSNPIE3",131,0)
 K XUSRSLT
"RTN","XUSNPIE3",132,0)
 S NPIUSED=$$NPIUSED^XUSNPI1(XUSNPI,"Individual_ID",XUSQI,XUSIEN,.XUSRSLT,XUSFLAG)
"RTN","XUSNPIE3",133,0)
 ; Display error or warning
"RTN","XUSNPIE3",134,0)
 I NPIUSED>0 D
"RTN","XUSNPIE3",135,0)
 . W !!
"RTN","XUSNPIE3",136,0)
 . F I=0:0 S I=$O(XUSRSLT(I)) Q:'I  D
"RTN","XUSNPIE3",137,0)
 . . W XUSRSLT(I),!
"RTN","XUSNPIE3",138,0)
 . . K XUSRSLT(I) Q
"RTN","XUSNPIE3",139,0)
 . Q
"RTN","XUSNPIE3",140,0)
 Q NPIUSED
"RTN","XUSNPIE3",141,0)
 ;
"RTN","XUSNPIE3",142,0)
WARNING(XUSTYPE,PROVNAME,XUSRSLT,XUSNNPI) ; If old NPI was in use by a non-VA provider, issue warning after REPLACE/DELETE
"RTN","XUSNPIE3",143,0)
 ; XUSTYPE = Flag indicating whether NPI was Deleted or Changed
"RTN","XUSNPIE3",144,0)
 ; PROVNAME = Name of provider whose NPI was changed/deleted
"RTN","XUSNPIE3",145,0)
 ; XUSRSLT = text of warning message
"RTN","XUSNPIE3",146,0)
 ; XUSNNPI = New NPI (if NPI was changed)
"RTN","XUSNPIE3",147,0)
 N I,X
"RTN","XUSNPIE3",148,0)
 ; If NPI was replaced, XUSNNPI contains the new NPI
"RTN","XUSNPIE3",149,0)
 S XUSNNPI=+$G(XUSNNPI)
"RTN","XUSNPIE3",150,0)
 ; Display the warning message
"RTN","XUSNPIE3",151,0)
 W !!
"RTN","XUSNPIE3",152,0)
 F I=0:0 S I=$O(XUSRSLT("X",I)) Q:'I  W XUSRSLT("X",I),!
"RTN","XUSNPIE3",153,0)
 ; Insert values into the mail message text
"RTN","XUSNPIE3",154,0)
 F I=0:0 S I=$O(XUSRSLT("XMSG",I)) Q:'I  S X=XUSRSLT("XMSG",I,0) I X[U D
"RTN","XUSNPIE3",155,0)
 . I $G(XUSTYPE)="D" S X=$P(X,U)_"deleted"_$P(X,U,2)_$G(PROVNAME)_$P(X,U,3)
"RTN","XUSNPIE3",156,0)
 . E  S X=$P(X,U)_"changed to "_XUSNNPI_$P(X,U,2)_$G(PROVNAME)_$P(X,U,3)
"RTN","XUSNPIE3",157,0)
 . S XUSRSLT("XMSG",I,0)=X
"RTN","XUSNPIE3",158,0)
 . Q
"RTN","XUSNPIE3",159,0)
 ; Send the mail message
"RTN","XUSNPIE3",160,0)
 D SNDMSG(DUZ,XUSTYPE,.XUSRSLT)
"RTN","XUSNPIE3",161,0)
 Q
"RTN","XUSNPIE3",162,0)
 ;
"RTN","XUSNPIE3",163,0)
SNDMSG(XMDUZ,XUSTYPE,XUSRSLT) ;Sends msg when NPI is changed/deleted.
"RTN","XUSNPIE3",164,0)
 ; XUSTYPE = flag indicating NPI was Deleted or Changed
"RTN","XUSNPIE3",165,0)
 ; XUSRSLT = array containing the message text and the recipients
"RTN","XUSNPIE3",166,0)
 N XMTEXT,XMSUB,XMMG,I,X
"RTN","XUSNPIE3",167,0)
 S X=$S($G(XUSTYPE)="D":"deleted",1:"changed")
"RTN","XUSNPIE3",168,0)
 S XMSUB="An NPI Number shared by a VA and Non-VA provider was "_X
"RTN","XUSNPIE3",169,0)
 S XMTEXT="XUSRSLT(""XMSG"","
"RTN","XUSNPIE3",170,0)
 F I=0:0 S I=$O(XUSRSLT("XRCPT",I)) Q:'I  S XMY(XUSRSLT("XRCPT",I))=""
"RTN","XUSNPIE3",171,0)
 D ^XMD
"RTN","XUSNPIE3",172,0)
 I $D(XMMG) W !,XMMG,!
"RTN","XUSNPIE3",173,0)
 Q
"RTN","XUSNPIE3",174,0)
 ;
"RTN","XUSNPIE3",175,0)
 ;
"RTN","XUSNPIED")
0^3^B24968351^B23954469
"RTN","XUSNPIED",1,0)
XUSNPIED ;FO-OAKLAND/JLI - DATA ENTRY FOR INITIAL NPI VALUES ;6/3/08  17:19
"RTN","XUSNPIED",2,0)
 ;;8.0;KERNEL;**420,410,435,480**;Jul 10, 1995;Build 38
"RTN","XUSNPIED",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified
"RTN","XUSNPIED",4,0)
 Q
"RTN","XUSNPIED",5,0)
 ;
"RTN","XUSNPIED",6,0)
SIGNON ; run at user sign-on to display message if NPI value is needed.
"RTN","XUSNPIED",7,0)
 D SIGNON^XUSNPIE1
"RTN","XUSNPIED",8,0)
 Q
"RTN","XUSNPIED",9,0)
 ;
"RTN","XUSNPIED",10,0)
CLEREDIT ; Input editing of NPI value for clerical staff - ask provider
"RTN","XUSNPIED",11,0)
 N IEN,DIC,PROVNAME,DATEVAL,DESCRIP,DONE,IENS,NPIVAL1,NPIVAL2,Y,XX
"RTN","XUSNPIED",12,0)
 F  W ! S DIC="^VA(200,",DIC(0)="AEQ" S DIC("A")="Select Provider: " D ^DIC Q:Y'>0  S IEN=+Y D EDITNPI(IEN)
"RTN","XUSNPIED",13,0)
 Q
"RTN","XUSNPIED",14,0)
 ;
"RTN","XUSNPIED",15,0)
USEREDIT ; Entry point for provider to enter own data
"RTN","XUSNPIED",16,0)
 I $$NPISTATS(DUZ)="" W !,$C(7),"Please see your local NPI facilitator to add the NPI",! H 3 Q
"RTN","XUSNPIED",17,0)
 D EDITNPI(DUZ)
"RTN","XUSNPIED",18,0)
 Q
"RTN","XUSNPIED",19,0)
 ;
"RTN","XUSNPIED",20,0)
EDITNPI(IEN) ;
"RTN","XUSNPIED",21,0)
 D EDITNPI^XUSNPIE3(IEN)
"RTN","XUSNPIED",22,0)
 Q
"RTN","XUSNPIED",23,0)
 ;
"RTN","XUSNPIED",24,0)
EDRLNPI(IEN) ; Edit AUTHORIZES RELEASE OF NPI field
"RTN","XUSNPIED",25,0)
 ; NOTE: *** This field is no longer being used, and should always be set to YES 05/13/08 tkw***
"RTN","XUSNPIED",26,0)
 Q:$P($G(^VA(200,+$G(IEN),"NPI")),U,3)=1
"RTN","XUSNPIED",27,0)
 N DIE,DR,DA S DIE="^VA(200,",DA=IEN,DR="41.97////1" D ^DIE
"RTN","XUSNPIED",28,0)
 Q
"RTN","XUSNPIED",29,0)
 ; 
"RTN","XUSNPIED",30,0)
CLERXMPT ;
"RTN","XUSNPIED",31,0)
 D CLERXMPT^XUSNPIE1
"RTN","XUSNPIED",32,0)
 Q
"RTN","XUSNPIED",33,0)
 ;
"RTN","XUSNPIED",34,0)
CHKGLOB() ; returns global location of TAXONOMY values also rebuilds if they are missing
"RTN","XUSNPIED",35,0)
 Q $$CHKGLOB^XUSNPIDA()
"RTN","XUSNPIED",36,0)
 ;
"RTN","XUSNPIED",37,0)
DOUSER(XUUSER,XUGLOB) ; check user for needing an NPI status value
"RTN","XUSNPIED",38,0)
 N PCLASS,XUDONE,PVAL,CODE,NPISTATS,XUVALUE,D0,EXPIRATN,I,NPIFLD,NPISUBFL
"RTN","XUSNPIED",39,0)
 S NPISTATS=41.98,NPISUBFL=200.042,NPIFLD=.03
"RTN","XUSNPIED",40,0)
 I $$GET1^DIQ(200,XUUSER_",",NPISTATS)'="" Q  ; user is already flagged
"RTN","XUSNPIED",41,0)
 S PCLASS=0,XUDONE=0 F  S PCLASS=$O(^VA(200,XUUSER,"USC1",PCLASS)) Q:PCLASS'>0  S D0=^(PCLASS,0) D  Q:XUDONE
"RTN","XUSNPIED",42,0)
 . S EXPIRATN=$P(D0,U,3)>0 I EXPIRATN Q
"RTN","XUSNPIED",43,0)
 . S PVAL=$P(D0,U),CODE=$$GET1^DIQ(8932.1,PVAL_",",6) I CODE'="",$D(@XUGLOB@(CODE)) D  S XUDONE=1 Q
"RTN","XUSNPIED",44,0)
 . . S XUVALUE="N" N NPIVAL F I=1:1 S NPIVAL=$$GET1^DIQ(NPISUBFL,I_","_XUUSER_",",NPIFLD) Q:NPIVAL=""  S XUVALUE="D" Q
"RTN","XUSNPIED",45,0)
 . . N XUFDA S XUFDA(200,XUUSER_",",NPISTATS)=XUVALUE
"RTN","XUSNPIED",46,0)
 . . D FILE^DIE("","XUFDA")
"RTN","XUSNPIED",47,0)
 . . Q
"RTN","XUSNPIED",48,0)
 . Q
"RTN","XUSNPIED",49,0)
 Q
"RTN","XUSNPIED",50,0)
 ;
"RTN","XUSNPIED",51,0)
CBOLIST ; list ^ delimited output to CBO exchange mail group.
"RTN","XUSNPIED",52,0)
 N DATE,DOMAIN,ADDRESS,STATNAME,COUNT,GLOBLOC,GLOBOUT
"RTN","XUSNPIED",53,0)
 N IEN,NPI,PROVNAME,TAXDESCR,TAXONOMY,STATION,STATUS,OPTION
"RTN","XUSNPIED",54,0)
 I '$$PROD^XUPROD() Q  ; messages from production systems only
"RTN","XUSNPIED",55,0)
 S DATE=(1700+$E(DT,1,3))_"-"_$E(DT,4,5)_"-"_$E(DT,6,7)
"RTN","XUSNPIED",56,0)
 S DOMAIN=$G(^XTV(8989.3,1,0)),DOMAIN=$P(DOMAIN,U)
"RTN","XUSNPIED",57,0)
 S STATION=$$NS^XUAF4($$KSP^XUPARAM("INST"))
"RTN","XUSNPIED",58,0)
 S ADDRESS=$P(STATION,U) ;$$GET1^DIQ(4.2,DOMAIN_",",.01)
"RTN","XUSNPIED",59,0)
 S STATION=$P(STATION,U,2) ;$$GET1^DIQ(4.2,DOMAIN_",",5.5)
"RTN","XUSNPIED",60,0)
 S OPTION=3
"RTN","XUSNPIED",61,0)
 S GLOBLOC=$$GETDATA(OPTION,0,0) ; get most of data into location specified by GLOBLOC
"RTN","XUSNPIED",62,0)
 S COUNT=0,GLOBOUT=$NA(^TMP($J,"XUSNPIOUT")) K @GLOBOUT
"RTN","XUSNPIED",63,0)
 S COUNT=1,@GLOBOUT@(COUNT)="--START"
"RTN","XUSNPIED",64,0)
 S GLOBLOC=$NA(@GLOBLOC@(" "," "))
"RTN","XUSNPIED",65,0)
 S PROVNAME="" F  S PROVNAME=$O(@GLOBLOC@(PROVNAME)) Q:PROVNAME=""  S IEN=0 F  S IEN=$O(@GLOBLOC@(PROVNAME,IEN)) Q:IEN'>0  D
"RTN","XUSNPIED",66,0)
 . S TAXDESCR="" F  S TAXDESCR=$O(@GLOBLOC@(PROVNAME,IEN,TAXDESCR)) Q:TAXDESCR=""  S TAXONOMY=$P(^(TAXDESCR),U,4),NPI=$P(^(TAXDESCR),U,3) D
"RTN","XUSNPIED",67,0)
 . . S STATUS=$$NPISTATS(IEN)
"RTN","XUSNPIED",68,0)
 . . S COUNT=COUNT+1,@GLOBOUT@(COUNT)=PROVNAME_U_STATION_U_NPI_U_TAXONOMY_U_TAXDESCR_U_DATE_U_STATUS
"RTN","XUSNPIED",69,0)
 . . Q
"RTN","XUSNPIED",70,0)
 . Q
"RTN","XUSNPIED",71,0)
 S COUNT=COUNT+1,@GLOBOUT@(COUNT)="--END"
"RTN","XUSNPIED",72,0)
 ; and generate mail message
"RTN","XUSNPIED",73,0)
 N XMTEXT,XMDUZ,XMY,XMSUB
"RTN","XUSNPIED",74,0)
 S XMTEXT=$E(GLOBOUT,1,$L(GLOBOUT)-1)_",",XMDUZ=0.5,XMY("VHACONPINPF@VA.GOV")=""
"RTN","XUSNPIED",75,0)
 S XMSUB="NPI LIST "_DATE_" FOR "_ADDRESS_" ("_STATION_")"
"RTN","XUSNPIED",76,0)
 D ^XMD
"RTN","XUSNPIED",77,0)
 Q
"RTN","XUSNPIED",78,0)
 ;
"RTN","XUSNPIED",79,0)
PRINTOPT ;
"RTN","XUSNPIED",80,0)
 D PRINTOPT^XUSNPIE2
"RTN","XUSNPIED",81,0)
 Q
"RTN","XUSNPIED",82,0)
GETDATA(OPTION,XUSSORT,XUSDIV) ; get data for reports for providers
"RTN","XUSNPIED",83,0)
 Q $$GETDATA^XUSNPIE2(OPTION,XUSSORT,XUSDIV)
"RTN","XUSNPIED",84,0)
 ;
"RTN","XUSNPIED",85,0)
CHEKNPI(IEN) ; returns whether status is Needs, will check and update if not set
"RTN","XUSNPIED",86,0)
 N VALUE,FDA
"RTN","XUSNPIED",87,0)
 S VALUE=$E($$GET1^DIQ(200,IEN_",",41.98))
"RTN","XUSNPIED",88,0)
 I VALUE="N" S FDA(200,IEN_",",41.98)="" D FILE^DIE("","FDA") S VALUE="" ; XU*8*435 JLI
"RTN","XUSNPIED",89,0)
 I VALUE="",$$CHKTAXON(IEN) K FDA S FDA(200,IEN_",",41.98)="N" D FILE^DIE("","FDA") S VALUE="N"
"RTN","XUSNPIED",90,0)
 Q VALUE="N"
"RTN","XUSNPIED",91,0)
 ;
"RTN","XUSNPIED",92,0)
NEEDSNPI(IEN) ; returns whether current status is N
"RTN","XUSNPIED",93,0)
 Q $$NPISTATS(IEN)="N"
"RTN","XUSNPIED",94,0)
 ;
"RTN","XUSNPIED",95,0)
HASNPI(IEN) ; returns whether current status is D (Done)
"RTN","XUSNPIED",96,0)
 Q $$NPISTATS(IEN)="D"
"RTN","XUSNPIED",97,0)
 ;
"RTN","XUSNPIED",98,0)
EXMPTNPI(IEN) ; returns whether current status is E (Exempt)
"RTN","XUSNPIED",99,0)
 Q $$NPISTATS(IEN)="E"
"RTN","XUSNPIED",100,0)
 ;
"RTN","XUSNPIED",101,0)
NPISTATS(IEN) ; returns one letter status indicator
"RTN","XUSNPIED",102,0)
 N VAL
"RTN","XUSNPIED",103,0)
 S VAL=$E($$GET1^DIQ(200,IEN_",",41.98))
"RTN","XUSNPIED",104,0)
 I (VAL="")!(VAL="N") S VAL=$$CHEKNPI(IEN)
"RTN","XUSNPIED",105,0)
 Q $E($$GET1^DIQ(200,IEN_",",41.98))
"RTN","XUSNPIED",106,0)
 ;
"RTN","XUSNPIED",107,0)
GETNPI(IEN) ; returns current NPI value
"RTN","XUSNPIED",108,0)
 Q $$GET1^DIQ(200,IEN_",",41.99)
"RTN","XUSNPIED",109,0)
 ;
"RTN","XUSNPIED",110,0)
GETTAXON(IEN,DESCRREF) ; returns Taxonomy value (X12) and sets description in DESCRREF, otherwise -1
"RTN","XUSNPIED",111,0)
 N I,POINTER,TAXON
"RTN","XUSNPIED",112,0)
 S TAXON=-1,DESCRREF=" "
"RTN","XUSNPIED",113,0)
 ;F I=0:0 S I=$O(^VA(200,IEN,"USC1",I)) Q:I'>0  I $P(^(I,0),U,3)'>0 S POINTER=+^(0) S TAXON=$$GET1^DIQ(8932.1,POINTER_",",6),DESCRREF=$$GET1^DIQ(8932.1,POINTER_",",1) Q
"RTN","XUSNPIED",114,0)
 S POINTER=+$$GET^XUA4A72(IEN) I POINTER>0 S TAXON=$$GET1^DIQ(8932.1,POINTER_",",6),DESCRREF=$$GET1^DIQ(8932.1,POINTER_",",1) ; XU*8*435 make sure active on today
"RTN","XUSNPIED",115,0)
 I TAXON="" S TAXON=-1,DESCRREF=" "
"RTN","XUSNPIED",116,0)
 Q TAXON
"RTN","XUSNPIED",117,0)
 ;
"RTN","XUSNPIED",118,0)
CHKTAXON(IEN,TAXONOMY) ; checks whether taxonomy value (X12) is in list of billable otherwise 0-1
"RTN","XUSNPIED",119,0)
 N DESCRIP,XUSGLOB
"RTN","XUSNPIED",120,0)
 I $G(TAXONOMY)="" S TAXONOMY=$$GETTAXON(IEN,.DESCRIP)
"RTN","XUSNPIED",121,0)
 S XUSGLOB=$$CHKGLOB()
"RTN","XUSNPIED",122,0)
 Q $D(@XUSGLOB@(TAXONOMY))
"RTN","XUSNPIED",123,0)
 ;
"RTN","XUSNPIED",124,0)
DATE10(DATE) ; returns date in mm/dd/yyyyy format
"RTN","XUSNPIED",125,0)
 Q $E(DATE,4,5)_"/"_$E(DATE,6,7)_"/"_(1700+$E(DATE,1,3))
"RTN","XUSNPIED",126,0)
 ;
"RTN","XUSNPIED",127,0)
POSTINIT ; runs post init
"RTN","XUSNPIED",128,0)
 D POSTINIT^XUSNPIE1
"RTN","XUSNPIED",129,0)
 Q
"RTN","XUSNPIED",130,0)
 ;
"RTN","XUSNPIED",131,0)
CBOQUEUE ; queues CBO List to run on first day of month
"RTN","XUSNPIED",132,0)
 D CBOQUEUE^XUSNPIE1
"RTN","XUSNPIED",133,0)
 Q
"RTN","XUSNPIED",134,0)
ALIGNRGT(TEXT,WIDTH) ; align text right in a specified width
"RTN","XUSNPIED",135,0)
 Q $$ALIGNRGT^XUSNPIE2(TEXT,WIDTH)
"VER")
8.0^22.0
"^DD",200,200,41.97,0)
AUTHORIZE RELEASE OF NPI^S^1:Yes;^NPI;3^Q
"^DD",200,200,41.97,3)
Answer 1 (Yes) to authorize blanket release of NPI to non-VA entities for business purposes only.
"^DD",200,200,41.97,21,0)
^^7^7^3080514^
"^DD",200,200,41.97,21,1,0)
Answer 1 (Yes) if this disclosure of an individual practitioner's NPI is 
"^DD",200,200,41.97,21,2,0)
to a non-VA health care provider or its agent to support, or in 
"^DD",200,200,41.97,21,3,0)
anticipation of supporting, the submission of health care reimbursement 
"^DD",200,200,41.97,21,4,0)
claims by non-VA health care providers or their agents (ex., display of 
"^DD",200,200,41.97,21,5,0)
FEE Basis authorizations). Per Routine Use Amendment #18 to the Privacy 
"^DD",200,200,41.97,21,6,0)
Act of 1974 this disclosure can be made without requiring consent 
"^DD",200,200,41.97,21,7,0)
(Blanket Authority) from the practitioner.
"^DD",200,200,41.97,23,0)
^^6^6^3080603^
"^DD",200,200,41.97,23,1,0)
Per Routine Use Amendment #18 to the Privacy Act of 1974 this disclosure 
"^DD",200,200,41.97,23,2,0)
can now be made without requiring authorization from the practitioner. 
"^DD",200,200,41.97,23,3,0)
This field needs to remain on File 200 because applications are using it. 
"^DD",200,200,41.97,23,4,0)
For VA practitioners who have an NPI in The Revenue Program Billing and 
"^DD",200,200,41.97,23,5,0)
Collections Records VA (114VA16), the field will be set 1 (Yes). For 
"^DD",200,200,41.97,23,6,0)
other users, the field will be null.
"^DD",200,200,41.97,"DT")
3080603
"BLD",7024,6)
^398
**END**
**END**
