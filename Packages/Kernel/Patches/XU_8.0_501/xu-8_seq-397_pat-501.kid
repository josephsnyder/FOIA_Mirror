Released XU*8*501 SEQ #397
Extracted from mail message
**KIDS**:XU*8.0*501^

**INSTALL NAME**
XU*8.0*501
"BLD",1087,0)
XU*8.0*501^KERNEL^0^3080501^y
"BLD",1087,1,0)
^^1^1^3080501^
"BLD",1087,1,1,0)
See the patch description on Forum.
"BLD",1087,4,0)
^9.64PA^^
"BLD",1087,6.3)
1
"BLD",1087,"KRN",0)
^9.67PA^779.2^20
"BLD",1087,"KRN",.4,0)
.4
"BLD",1087,"KRN",.401,0)
.401
"BLD",1087,"KRN",.402,0)
.402
"BLD",1087,"KRN",.403,0)
.403
"BLD",1087,"KRN",.5,0)
.5
"BLD",1087,"KRN",.84,0)
.84
"BLD",1087,"KRN",3.6,0)
3.6
"BLD",1087,"KRN",3.8,0)
3.8
"BLD",1087,"KRN",9.2,0)
9.2
"BLD",1087,"KRN",9.8,0)
9.8
"BLD",1087,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",1087,"KRN",9.8,"NM",1,0)
XQ3^^0^B23354453
"BLD",1087,"KRN",9.8,"NM","B","XQ3",1)

"BLD",1087,"KRN",19,0)
19
"BLD",1087,"KRN",19.1,0)
19.1
"BLD",1087,"KRN",101,0)
101
"BLD",1087,"KRN",409.61,0)
409.61
"BLD",1087,"KRN",771,0)
771
"BLD",1087,"KRN",779.2,0)
779.2
"BLD",1087,"KRN",870,0)
870
"BLD",1087,"KRN",8989.51,0)
8989.51
"BLD",1087,"KRN",8989.52,0)
8989.52
"BLD",1087,"KRN",8994,0)
8994
"BLD",1087,"KRN","B",.4,.4)

"BLD",1087,"KRN","B",.401,.401)

"BLD",1087,"KRN","B",.402,.402)

"BLD",1087,"KRN","B",.403,.403)

"BLD",1087,"KRN","B",.5,.5)

"BLD",1087,"KRN","B",.84,.84)

"BLD",1087,"KRN","B",3.6,3.6)

"BLD",1087,"KRN","B",3.8,3.8)

"BLD",1087,"KRN","B",9.2,9.2)

"BLD",1087,"KRN","B",9.8,9.8)

"BLD",1087,"KRN","B",19,19)

"BLD",1087,"KRN","B",19.1,19.1)

"BLD",1087,"KRN","B",101,101)

"BLD",1087,"KRN","B",409.61,409.61)

"BLD",1087,"KRN","B",771,771)

"BLD",1087,"KRN","B",779.2,779.2)

"BLD",1087,"KRN","B",870,870)

"BLD",1087,"KRN","B",8989.51,8989.51)

"BLD",1087,"KRN","B",8989.52,8989.52)

"BLD",1087,"KRN","B",8994,8994)

"BLD",1087,"QUES",0)
^9.62^^
"MBREQ")
0
"PKG",3,-1)
1^1
"PKG",3,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",3,20,0)
^9.402P^^0
"PKG",3,22,0)
^9.49I^1^1
"PKG",3,22,1,0)
8.0^3051215^2970507^.5
"PKG",3,22,1,"PAH",1,0)
501^3080501
"PKG",3,22,1,"PAH",1,1,0)
^^1^1^3080501
"PKG",3,22,1,"PAH",1,1,1,0)
See the patch description on Forum.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","XQ3")
0^1^B23354453^B17424105
"RTN","XQ3",1,0)
XQ3 ;LL/THM,SF/GJL,SEA/JLI - CLEANUP DANGLING POINTERS IN OPTION OR HELP FRAME FILES ;04/30/08  17:06
"RTN","XQ3",2,0)
 ;;8.0;KERNEL;**80,501**;Jul 10, 1995;Build 1
"RTN","XQ3",3,0)
 Q
"RTN","XQ3",4,0)
ENASK ;Ask to fix up dirty OPTION/HELP FRAME File
"RTN","XQ3",5,0)
 N IX,XUT,J,K,XQFL,X
"RTN","XQ3",6,0)
 I '$D(%) W !,$C(7),"ENTRY MUST BE WITH THE VARIABLE '%' SET TO INDICATE DESIRED FILE.",$C(7),! Q
"RTN","XQ3",7,0)
 S XQFL=$S(%=1:"OPTION",%=2:"PROTOCOL",1:"HELP FRAME")
"RTN","XQ3",8,0)
 W !,"Do you want to remove any 'Dangling Pointers' from your ",XQFL," File?  Y// " R X:$S($D(DTIME):DTIME,1:300) I '$T Q
"RTN","XQ3",9,0)
 W ! I X="" S X="Y"
"RTN","XQ3",10,0)
 I X["?" G SYNTAX
"RTN","XQ3",11,0)
 I X["^" S X="^" Q
"RTN","XQ3",12,0)
STRIP I X'="",X'?1A.E S X=$E(X,2,256) G STRIP
"RTN","XQ3",13,0)
 S X=$E(X,1) I X="" G SYNTAX
"RTN","XQ3",14,0)
 I "Nn"[X S X="N" Q
"RTN","XQ3",15,0)
 I "Yy"[X W !,"PLEASE WAIT while I check this out . . . " G REMOVE
"RTN","XQ3",16,0)
SYNTAX W ! I X'["?" W ?11,"I'm sorry, but I don't understand your answer. Please"
"RTN","XQ3",17,0)
 W !,"Enter: YES (or press the RETURN key) if you want me to remove from"
"RTN","XQ3",18,0)
 W !,?11,"your ",XQFL," File any pointers left over from incompletely"
"RTN","XQ3",19,0)
 W !,?11,"deleted ",XQFL,". If such pointers do exist and are not"
"RTN","XQ3",20,0)
 W !,?11,"removed, the ",XQFL," File (i.e. the menus) could become"
"RTN","XQ3",21,0)
 W !,?11,"messed up by an INIT."
"RTN","XQ3",22,0)
 W !!,"Enter:  NO or ^ to continue on without effecting the ",XQFL," File."
"RTN","XQ3",23,0)
 W ! G ENASK
"RTN","XQ3",24,0)
REMOVE D:%=1 OPFIX D:%=2 PFIX D:'% HFFIX W !,"Your ",XQFL," File is OK " I 'XUT W "(no bad pointers)."
"RTN","XQ3",25,0)
 E  W "now (",XUT," pointer" W:XUT>1 "s" W " fixed)."
"RTN","XQ3",26,0)
 W ! S X="Y"
"RTN","XQ3",27,0)
 Q
"RTN","XQ3",28,0)
OPFIX ;Kill any dangling pointers in the OPTION File (#19)
"RTN","XQ3",29,0)
 N %,IX,J,XQ3
"RTN","XQ3",30,0)
 S (IX,XUT)=0 ;XUT=Total Deletions
"RTN","XQ3",31,0)
 F  S IX=$O(^DIC(19,IX)) Q:'IX  W:'(IX#100) ". " S (XQ3,J)=0 D L2 ;Loop through Options
"RTN","XQ3",32,0)
 D NPF
"RTN","XQ3",33,0)
 Q
"RTN","XQ3",34,0)
L2 ;One Option
"RTN","XQ3",35,0)
 I '$D(^DIC(19,IX,10,0)) Q  ;Not a Menu
"RTN","XQ3",36,0)
 K ^DIC(19,IX,10,"B") ;Rebuild "B" X-ref
"RTN","XQ3",37,0)
 F  S J=$O(^DIC(19,IX,10,J)) Q:'J  D ITEM ;Loop through menu items
"RTN","XQ3",38,0)
 S (K,J)=0 F  S J=$O(^DIC(19,IX,10,J)) Q:J'>0  S K=J ;K=Last item
"RTN","XQ3",39,0)
 S J=^DIC(19,IX,10,0),^(0)=$P(J,"^",1,2)_"^"_K_"^"_XQ3 ;fix counters
"RTN","XQ3",40,0)
 Q
"RTN","XQ3",41,0)
 ;
"RTN","XQ3",42,0)
ITEM ;One Menu item
"RTN","XQ3",43,0)
 N DA,DIK
"RTN","XQ3",44,0)
 S K=+^DIC(19,IX,10,J,0)
"RTN","XQ3",45,0)
 I $D(^DIC(19,K,0)) S XQ3=XQ3+1,^DIC(19,IX,10,"B",K,J)="" Q  ;Y=No. of items
"RTN","XQ3",46,0)
 W !,"Option ",$P(^DIC(19,IX,0),U,1)," points to missing option ",K
"RTN","XQ3",47,0)
 ;S XUT=XUT+1 K ^DIC(19,IX,10,J) ;Kill invalid menu item
"RTN","XQ3",48,0)
 S XUT=XUT+1,DIK="^DIC(19,DA(1),10,",DA=J,DA(1)=IX D ^DIK ;Trigger Menu-rebuild
"RTN","XQ3",49,0)
 Q
"RTN","XQ3",50,0)
 ;
"RTN","XQ3",51,0)
NPF ;Fix the New Person File Option Pointers
"RTN","XQ3",52,0)
 N IX,I2,J,P,DIK,DIE,DR,DA,XUT
"RTN","XQ3",53,0)
 S (XUT,IX)=0
"RTN","XQ3",54,0)
 F  S IX=$O(^VA(200,IX)) Q:'IX  D
"RTN","XQ3",55,0)
 . S P=+$G(^VA(200,IX,201))
"RTN","XQ3",56,0)
 . I P,'$D(^DIC(19,P,0)) D
"RTN","XQ3",57,0)
 . . W !,"User: ",$P(^VA(200,IX,0),U),", Primary Menu points to missing option ",P
"RTN","XQ3",58,0)
 . . S XUT=XUT+1,DIE="^VA(200,",DA=IX,DR="201///@" D ^DIE
"RTN","XQ3",59,0)
 . . Q
"RTN","XQ3",60,0)
 . S I2=0
"RTN","XQ3",61,0)
 . F  S I2=$O(^VA(200,IX,203,I2)) Q:'I2  D
"RTN","XQ3",62,0)
 . . S P=+$G(^VA(200,IX,203,I2,0))
"RTN","XQ3",63,0)
 . . I P,'$D(^DIC(19,P,0)) D
"RTN","XQ3",64,0)
 . . . W !,"User: ",$P(^VA(200,IX,0),U),", Secondary Menu points to missing option ",P
"RTN","XQ3",65,0)
 . . . S XUT=XUT+1,DIK="^VA(200,DA(1),203,",DA=I2,DA(1)=IX D ^DIK
"RTN","XQ3",66,0)
 . . . Q
"RTN","XQ3",67,0)
 . . Q
"RTN","XQ3",68,0)
 . Q
"RTN","XQ3",69,0)
 I XUT W !,"Menu pointers fixed."
"RTN","XQ3",70,0)
 Q
"RTN","XQ3",71,0)
HFFIX ; Fix dangling pointers on help frame file
"RTN","XQ3",72,0)
 N %
"RTN","XQ3",73,0)
 S (XUT,IX)=0 F  S IX=$O(^DIC(9.2,IX)) Q:IX'>0  I $D(^(IX,2)) D HF1,HF2,HF3
"RTN","XQ3",74,0)
 Q
"RTN","XQ3",75,0)
HF1 S (Y,J)=0 F  S J=$O(^DIC(9.2,IX,2,J)) Q:J'>0  I $D(^(J,0)) S K=$P(^(0),U,2),Y=Y+1 I $L(K),'$D(^DIC(9.2,K)) S Y=Y-1,XUT=XUT+1 K ^DIC(9.2,IX,2,J,0)
"RTN","XQ3",76,0)
 Q
"RTN","XQ3",77,0)
HF2 S (K,J)=0 F  S J=$O(^DIC(9.2,IX,2,J)) Q:J'>0  S K=J
"RTN","XQ3",78,0)
 S J=^DIC(9.2,IX,2,0),^(0)=$P(J,U,1,2)_U_K_U_Y
"RTN","XQ3",79,0)
 Q
"RTN","XQ3",80,0)
HF3 S K=":" F  S K=$O(^DIC(9.2,IX,2,K)) Q:K=""  S J=-1 F  S J=$O(^DIC(9.2,IX,2,K,J)) Q:J=""  D HF4
"RTN","XQ3",81,0)
 Q
"RTN","XQ3",82,0)
HF4 S JJ=0 F  S JJ=$O(^DIC(9.2,IX,2,K,J,JJ)) Q:JJ'>0  I '$D(^DIC(9.2,IX,2,JJ,0)) K ^DIC(9.2,IX,2,K,J,JJ)
"RTN","XQ3",83,0)
 Q
"RTN","XQ3",84,0)
PFIX ;Kill any dangling pointers in the PROTOCOL File (#101)
"RTN","XQ3",85,0)
 N %
"RTN","XQ3",86,0)
 S (IX,XUT)=0 ;XUT=Total Deletions
"RTN","XQ3",87,0)
P1 S IX=$O(^ORD(101,IX)) I IX>0 S (Y,J)=0 G P2 ;Loop through protocols
"RTN","XQ3",88,0)
 Q
"RTN","XQ3",89,0)
P2 S J=$O(^ORD(101,IX,10,J)) I J>0 G PITEM ;Loop through items
"RTN","XQ3",90,0)
 I '$D(^ORD(101,IX,10,0)) G P1
"RTN","XQ3",91,0)
 S (K,J)=0 F L=1:1 S J=$O(^ORD(101,IX,10,J)) Q:J'>0  S K=J ;K=Last item
"RTN","XQ3",92,0)
 S J=^ORD(101,IX,10,0),^(0)=$P(J,"^",1,2)_"^"_K_"^"_Y ;fix counters
"RTN","XQ3",93,0)
 G PXREFS
"RTN","XQ3",94,0)
PITEM S K=+^ORD(101,IX,10,J,0) I $D(^ORD(101,K,0)) S Y=Y+1 G P2 ;Y=No. of items
"RTN","XQ3",95,0)
 W !,"Protocol ",$P(^ORD(101,IX,0),U,1)," points to missing protocol ",K
"RTN","XQ3",96,0)
 ;S XUT=XUT+1 K ^ORD(101,IX,10,J) ;Kill invalid menu item
"RTN","XQ3",97,0)
 S XUT=XUT+1,DIK="^ORD(101,IX,10,",DA=J,DA(1)=IX D ^DIK ;Delete invalid menu item
"RTN","XQ3",98,0)
 G P2
"RTN","XQ3",99,0)
PXREFS S K=":"
"RTN","XQ3",100,0)
P3 S K=$O(^ORD(101,IX,10,K)) I K="" G P1 ;Loop through cross references
"RTN","XQ3",101,0)
 S L=-1
"RTN","XQ3",102,0)
P4 S L=$O(^ORD(101,IX,10,K,L)) I L="" G P3
"RTN","XQ3",103,0)
 S J=0
"RTN","XQ3",104,0)
P5 S J=$O(^ORD(101,IX,10,K,L,J)) I J'>0 G P4
"RTN","XQ3",105,0)
 I '$D(^ORD(101,IX,10,J,0)) G PKILLXR ;kill xref to invalid item
"RTN","XQ3",106,0)
P6 S M=^ORD(101,IX,10,J,0) I (M=L)!(M[L_"^") G P5
"RTN","XQ3",107,0)
PKILLXR K ^ORD(101,IX,10,K,L,J) I $O(^ORD(101,IX,10,K,L,-1))="" K ^ORD(101,IX,10,K,L)
"RTN","XQ3",108,0)
 G P5
"VER")
8.0^22.0
"BLD",1087,6)
^397
**END**
**END**
