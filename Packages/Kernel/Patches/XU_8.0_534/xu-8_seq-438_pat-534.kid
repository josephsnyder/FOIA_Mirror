Released XU*8*534 SEQ #438
Extracted from mail message
**KIDS**:XU*8.0*534^

**INSTALL NAME**
XU*8.0*534
"BLD",1255,0)
XU*8.0*534^KERNEL^0^3091216^y
"BLD",1255,1,0)
^^2^2^3090910^
"BLD",1255,1,1,0)
Please refer to the Description in the FORUM Patch Module for details.
"BLD",1255,1,2,0)
XU*8*534 Taskman Cleanup.
"BLD",1255,4,0)
^9.64PA^3.5^3
"BLD",1255,4,3.5,0)
3.5
"BLD",1255,4,3.5,2,0)
^9.641^3.5^1
"BLD",1255,4,3.5,2,3.5,0)
DEVICE  (File-top level)
"BLD",1255,4,3.5,2,3.5,1,0)
^9.6411^3^1
"BLD",1255,4,3.5,2,3.5,1,3,0)
SUBTYPE
"BLD",1255,4,3.5,222)
y^n^p^^^^n^^n
"BLD",1255,4,3.5,224)

"BLD",1255,4,14.5,0)
14.5
"BLD",1255,4,14.5,2,0)
^9.641^14.5^1
"BLD",1255,4,14.5,2,14.5,0)
VOLUME SET  (File-top level)
"BLD",1255,4,14.5,2,14.5,1,0)
^9.6411^10^1
"BLD",1255,4,14.5,2,14.5,1,10,0)
RE-QUEUES BEFORE UN-SCHEDULE
"BLD",1255,4,14.5,222)
y^n^p^^^^n^^n
"BLD",1255,4,14.5,224)

"BLD",1255,4,200,0)
200
"BLD",1255,4,200,2,0)
^9.641^200^1
"BLD",1255,4,200,2,200,0)
NEW PERSON  (File-top level)
"BLD",1255,4,200,2,200,1,0)
^9.6411^53.3^1
"BLD",1255,4,200,2,200,1,53.3,0)
VA#
"BLD",1255,4,200,222)
y^n^p^^^^n^^n
"BLD",1255,4,200,224)

"BLD",1255,4,"APDD",3.5,3.5)

"BLD",1255,4,"APDD",3.5,3.5,3)

"BLD",1255,4,"APDD",14.5,14.5)

"BLD",1255,4,"APDD",14.5,14.5,10)

"BLD",1255,4,"APDD",200,200)

"BLD",1255,4,"APDD",200,200,53.3)

"BLD",1255,4,"B",3.5,3.5)

"BLD",1255,4,"B",14.5,14.5)

"BLD",1255,4,"B",200,200)

"BLD",1255,6.3)
6
"BLD",1255,"KRN",0)
^9.67PA^9002226^21
"BLD",1255,"KRN",.4,0)
.4
"BLD",1255,"KRN",.401,0)
.401
"BLD",1255,"KRN",.402,0)
.402
"BLD",1255,"KRN",.403,0)
.403
"BLD",1255,"KRN",.5,0)
.5
"BLD",1255,"KRN",.84,0)
.84
"BLD",1255,"KRN",3.6,0)
3.6
"BLD",1255,"KRN",3.8,0)
3.8
"BLD",1255,"KRN",9.2,0)
9.2
"BLD",1255,"KRN",9.8,0)
9.8
"BLD",1255,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",1255,"KRN",9.8,"NM",1,0)
XUTMHR^^0^B29133359
"BLD",1255,"KRN",9.8,"NM",2,0)
XUSER2^^0^B13847196
"BLD",1255,"KRN",9.8,"NM","B","XUSER2",2)

"BLD",1255,"KRN",9.8,"NM","B","XUTMHR",1)

"BLD",1255,"KRN",19,0)
19
"BLD",1255,"KRN",19.1,0)
19.1
"BLD",1255,"KRN",101,0)
101
"BLD",1255,"KRN",409.61,0)
409.61
"BLD",1255,"KRN",771,0)
771
"BLD",1255,"KRN",779.2,0)
779.2
"BLD",1255,"KRN",870,0)
870
"BLD",1255,"KRN",8989.51,0)
8989.51
"BLD",1255,"KRN",8989.52,0)
8989.52
"BLD",1255,"KRN",8994,0)
8994
"BLD",1255,"KRN",9002226,0)
9002226
"BLD",1255,"KRN","B",.4,.4)

"BLD",1255,"KRN","B",.401,.401)

"BLD",1255,"KRN","B",.402,.402)

"BLD",1255,"KRN","B",.403,.403)

"BLD",1255,"KRN","B",.5,.5)

"BLD",1255,"KRN","B",.84,.84)

"BLD",1255,"KRN","B",3.6,3.6)

"BLD",1255,"KRN","B",3.8,3.8)

"BLD",1255,"KRN","B",9.2,9.2)

"BLD",1255,"KRN","B",9.8,9.8)

"BLD",1255,"KRN","B",19,19)

"BLD",1255,"KRN","B",19.1,19.1)

"BLD",1255,"KRN","B",101,101)

"BLD",1255,"KRN","B",409.61,409.61)

"BLD",1255,"KRN","B",771,771)

"BLD",1255,"KRN","B",779.2,779.2)

"BLD",1255,"KRN","B",870,870)

"BLD",1255,"KRN","B",8989.51,8989.51)

"BLD",1255,"KRN","B",8989.52,8989.52)

"BLD",1255,"KRN","B",8994,8994)

"BLD",1255,"KRN","B",9002226,9002226)

"BLD",1255,"QUES",0)
^9.62^^
"BLD",1255,"REQB",0)
^9.611^2^2
"BLD",1255,"REQB",1,0)
XU*8.0*446^0
"BLD",1255,"REQB",2,0)
XU*8.0*344^0
"BLD",1255,"REQB","B","XU*8.0*344",2)

"BLD",1255,"REQB","B","XU*8.0*446",1)

"FIA",3.5)
DEVICE
"FIA",3.5,0)
^%ZIS(1,
"FIA",3.5,0,0)
3.5Is
"FIA",3.5,0,1)
y^n^p^^^^n^^n
"FIA",3.5,0,10)

"FIA",3.5,0,11)

"FIA",3.5,0,"RLRO")

"FIA",3.5,0,"VR")
8.0^XU
"FIA",3.5,3.5)
1
"FIA",3.5,3.5,3)

"FIA",14.5)
VOLUME SET
"FIA",14.5,0)
^%ZIS(14.5,
"FIA",14.5,0,0)
14.5
"FIA",14.5,0,1)
y^n^p^^^^n^^n
"FIA",14.5,0,10)

"FIA",14.5,0,11)

"FIA",14.5,0,"RLRO")

"FIA",14.5,0,"VR")
8.0^XU
"FIA",14.5,14.5)
1
"FIA",14.5,14.5,10)

"FIA",200)
NEW PERSON
"FIA",200,0)
^VA(200,
"FIA",200,0,0)
200I
"FIA",200,0,1)
y^n^p^^^^n^^n
"FIA",200,0,10)

"FIA",200,0,11)

"FIA",200,0,"RLRO")

"FIA",200,0,"VR")
8.0^XU
"FIA",200,200)
1
"FIA",200,200,53.3)

"MBREQ")
0
"PKG",3,-1)
1^1
"PKG",3,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",3,20,0)
^9.402P^^0
"PKG",3,22,0)
^9.49I^1^1
"PKG",3,22,1,0)
8.0^3090706^3090706^6
"PKG",3,22,1,"PAH",1,0)
534^3091216
"PKG",3,22,1,"PAH",1,1,0)
^^2^2^3091216
"PKG",3,22,1,"PAH",1,1,1,0)
Please refer to the Description in the FORUM Patch Module for details.
"PKG",3,22,1,"PAH",1,1,2,0)
XU*8*534 Taskman Cleanup.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","XUSER2")
0^2^B13847196^B11587344
"RTN","XUSER2",1,0)
XUSER2 ;ISF/RWF - New Person File Utilities ;11/04/09  14:28
"RTN","XUSER2",2,0)
 ;;8.0;KERNEL;**267,251,344,534**;Jul 10, 1995;Build 6
"RTN","XUSER2",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","XUSER2",4,0)
 Q
"RTN","XUSER2",5,0)
VALDEA(X,F) ;Check for a valid DEA#
"RTN","XUSER2",6,0)
 ;Returns 0 for NOT Valid, 1 for Valid
"RTN","XUSER2",7,0)
 ;F = 1 for Facility DEA check.
"RTN","XUSER2",8,0)
 I $D(X) K:$L(X)>9!($L(X)<9)!'(X?2U7N) X
"RTN","XUSER2",9,0)
 S F=$G(F)
"RTN","XUSER2",10,0)
 I $D(X),'F,$D(DA),$D(^VA(200,"PS1",X)),$O(^(X,0))'=DA D EN^DDIOL($C(7)_"CAN'T FILE: DUPLICATE DEA NUMBER") K X
"RTN","XUSER2",11,0)
 I $D(X),'F,$D(DA),$E(X,2)'=$E($P(^VA(200,DA,0),"^")) D EN^DDIOL($C(7)_"WARNING: DEA# FORMAT MISMATCH -- CHECK SECOND LETTER")
"RTN","XUSER2",12,0)
 I $D(X),'$$DEANUM(X) D EN^DDIOL($C(7)_"CAN'T FILE: DEA# FORMAT MISMATCH -- NUMERIC ALGORITHM FAILED") K X
"RTN","XUSER2",13,0)
 Q $D(X)
"RTN","XUSER2",14,0)
 ;
"RTN","XUSER2",15,0)
DEANUM(X) ;Check DEA # part
"RTN","XUSER2",16,0)
 N VA1,VA2
"RTN","XUSER2",17,0)
 S VA1=$E(X,3)+$E(X,5)+$E(X,7)+(2*($E(X,4)+$E(X,6)+$E(X,8)))
"RTN","XUSER2",18,0)
 S VA1=VA1#10,VA2=$E(X,9)
"RTN","XUSER2",19,0)
 Q VA1=VA2
"RTN","XUSER2",20,0)
 ;
"RTN","XUSER2",21,0)
VANUM ;Check that the VA# is not Active for anybody else. Called from ^DD(200,53.3,0)
"RTN","XUSER2",22,0)
 ;Needs DA, DT and X
"RTN","XUSER2",23,0)
 Q:'$D(X)!'$D(DA)
"RTN","XUSER2",24,0)
 N %
"RTN","XUSER2",25,0)
 I $D(^VA(200,"PS2",X)) D
"RTN","XUSER2",26,0)
 . S %=0
"RTN","XUSER2",27,0)
 . F  S %=$O(^VA(200,"PS2",X,%)) Q:'%  I %'=DA,$S('$P($G(^VA(200,%,"PS")),"^",4):1,1:$P(^("PS"),"^",4)'<DT) K X Q
"RTN","XUSER2",28,0)
 . Q
"RTN","XUSER2",29,0)
 I '$D(X) D EN^DDIOL($C(7)_"That VA# is in active use.  ","","!,?5")
"RTN","XUSER2",30,0)
 Q
"RTN","XUSER2",31,0)
 ;
"RTN","XUSER2",32,0)
REQ(XUV,XUFLAG) ;Called from forms:
"RTN","XUSER2",33,0)
 ; XUEXISTING USER, XUNEW USER, XUREACT USER, XU-CLINICAL TRAINEE
"RTN","XUSER2",34,0)
 ;from the:
"RTN","XUSER2",35,0)
 ; - Form-level pre-action
"RTN","XUSER2",36,0)
 ; - Post action on change for "Is this person a Clinical Trainee?"
"RTN","XUSER2",37,0)
 ;In:
"RTN","XUSER2",38,0)
 ; XUV = 1 if user is a clinical trainee; 0 otherwise
"RTN","XUSER2",39,0)
 ;          If XUV is not passed, its value is obtained from the
"RTN","XUSER2",40,0)
 ;          CLINICAL CORE TRAINEE(#12.6).
"RTN","XUSER2",41,0)
 ; XUFLAG = 1 if called from the XU-CLINICAL TRAINEE form;
"RTN","XUSER2",42,0)
 ;          otherwise, called from the other forms
"RTN","XUSER2",43,0)
 ;
"RTN","XUSER2",44,0)
 N BLOCK,PAGE,FIELD,F126
"RTN","XUSER2",45,0)
 ; BLOCK = Block
"RTN","XUSER2",46,0)
 ; PAGE = Page number
"RTN","XUSER2",47,0)
 ; FIELD = Field number
"RTN","XUSER2",48,0)
 I $G(XUFLAG) S BLOCK="XU-CLINICAL TRAINEE 1",PAGE=1
"RTN","XUSER2",49,0)
 E  D
"RTN","XUSER2",50,0)
 . S BLOCK="XUEXISTING USER TRAINEE"
"RTN","XUSER2",51,0)
 . S PAGE=5
"RTN","XUSER2",52,0)
 ;
"RTN","XUSER2",53,0)
 I $G(XUV)="" D  ;Value not Passed get current value
"RTN","XUSER2",54,0)
 . N ZERR
"RTN","XUSER2",55,0)
 . S XUV=$$GET^DDSVAL(200,DA,"CLINICAL CORE TRAINEE",.ZERR,"I")
"RTN","XUSER2",56,0)
 . S XUV=$S(XUV="N":0,XUV="":0,1:1)
"RTN","XUSER2",57,0)
 S F126=XUV
"RTN","XUSER2",58,0)
 ;
"RTN","XUSER2",59,0)
 ;CURRENT DEGREE LEVEL 12.1
"RTN","XUSER2",60,0)
 ;PROGRAM OF STUDY 12.2
"RTN","XUSER2",61,0)
 ;LAST TRAINING MONTH & YEAR 12.3
"RTN","XUSER2",62,0)
 ;VHA TRAINING FACILITY 12.4
"RTN","XUSER2",63,0)
 ;DATE HL7 TRAINEE RECORD BUILT 12.5
"RTN","XUSER2",64,0)
 ;CLINICAL CORE TRAINEE 12.6
"RTN","XUSER2",65,0)
 ;DATE NO LONGER TRAINEE 12.7
"RTN","XUSER2",66,0)
 ;START OF TRAINING 12.8
"RTN","XUSER2",67,0)
 ;
"RTN","XUSER2",68,0)
 I F126 D  Q  ;Logic for when field 12.6 equals YES or Null
"RTN","XUSER2",69,0)
 . N FIELD
"RTN","XUSER2",70,0)
 . ;Make fields required
"RTN","XUSER2",71,0)
 . F FIELD="12.2F","12.4F" D REQ^DDSUTL(FIELD,BLOCK,PAGE,1)
"RTN","XUSER2",72,0)
 . ;Delete value in field 12.7 & make it uneditable
"RTN","XUSER2",73,0)
 . S FIELD=12.7 D PUT^DDSVAL(200,DA,FIELD,"@","","I")
"RTN","XUSER2",74,0)
 . S FIELD="12.7F" D UNED^DDSUTL(FIELD,BLOCK,PAGE,1)
"RTN","XUSER2",75,0)
 . D REQ^DDSUTL(FIELD,BLOCK,PAGE,0)
"RTN","XUSER2",76,0)
 . ;Make the following fields editable
"RTN","XUSER2",77,0)
 . F FIELD="12.1F","12.2F","12.3F","12.4F","12.8F" D UNED^DDSUTL(FIELD,BLOCK,PAGE,0)
"RTN","XUSER2",78,0)
 . Q
"RTN","XUSER2",79,0)
 I 'F126 D  Q  ;Logic for when field 12.6 equals NO
"RTN","XUSER2",80,0)
 . N FIELD,ZERR,F122,F127
"RTN","XUSER2",81,0)
 . S F122=$$GET^DDSVAL(200,DA,12.2,.ZERR,"I")
"RTN","XUSER2",82,0)
 . S F127=$$GET^DDSVAL(200,DA,12.7,.ZERR,"I")
"RTN","XUSER2",83,0)
 . I F122="" D  Q  ;Not a trainee, probably a mistake
"RTN","XUSER2",84,0)
 .. ;Make fields not required
"RTN","XUSER2",85,0)
 .. F FIELD="12.2F","12.4F" D REQ^DDSUTL(FIELD,BLOCK,PAGE,0)
"RTN","XUSER2",86,0)
 .. ;Make field uneditable
"RTN","XUSER2",87,0)
 .. F FIELD="12.1F","12.2F","12.3F","12.4F","12.7F","12.8F" D UNED^DDSUTL(FIELD,BLOCK,PAGE,1)
"RTN","XUSER2",88,0)
 .. Q
"RTN","XUSER2",89,0)
 . I F122]"",F127]"" Q
"RTN","XUSER2",90,0)
 . ;Make fields not required
"RTN","XUSER2",91,0)
 . F FIELD="12.2F","12.4F" D REQ^DDSUTL(FIELD,BLOCK,PAGE,0)
"RTN","XUSER2",92,0)
 . ;Make the following field required & editable
"RTN","XUSER2",93,0)
 . S FIELD="12.7F" D REQ^DDSUTL(FIELD,BLOCK,PAGE,1)
"RTN","XUSER2",94,0)
 . S FIELD="12.7F" D UNED^DDSUTL(FIELD,BLOCK,PAGE,0)
"RTN","XUSER2",95,0)
 . ;Don't allow editing of the following fields
"RTN","XUSER2",96,0)
 . F FIELD="12.1F","12.2F","12.3F","12.4F","12.8F" D UNED^DDSUTL(FIELD,BLOCK,PAGE,1)
"RTN","XUSER2",97,0)
 . Q
"RTN","XUSER2",98,0)
 Q
"RTN","XUTMHR")
0^1^B29133359^B19817174
"RTN","XUTMHR",1,0)
XUTMHR ;ISF/RWF - Taskman Hourly checkup routine. ;12/16/09  13:32
"RTN","XUTMHR",2,0)
 ;;8.0;KERNEL;**446,534**;Jul 10, 1995;Build 6
"RTN","XUTMHR",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","XUTMHR",4,0)
 Q
"RTN","XUTMHR",5,0)
 ;
"RTN","XUTMHR",6,0)
HOUR ;Work to do each hour
"RTN","XUTMHR",7,0)
 D SCAN ;Look for scheduled task that have dropped there schedule.
"RTN","XUTMHR",8,0)
 D DEVREJ() ;Check for tasks re-scheduled for unavaliable device.
"RTN","XUTMHR",9,0)
 Q
"RTN","XUTMHR",10,0)
 ;
"RTN","XUTMHR",11,0)
SCAN ;Scan the Scheduled Tasks file.  Merge with XUTMCS sometime.
"RTN","XUTMHR",12,0)
 N D0,OLD,NOW,X,X1,X2,Z0,Z4,Z5,TK
"RTN","XUTMHR",13,0)
 ;Make NOW 10 minute in the past
"RTN","XUTMHR",14,0)
 S U="^",D0=0,NOW=$$HTFM^XLFDT($$HADD^XLFDT($H,,,-10)),OLD=$$HTFM^XLFDT($H-1)
"RTN","XUTMHR",15,0)
 F  S D0=$O(^DIC(19.2,D0)) Q:'D0  D  L -^DIC(19.2,D0)
"RTN","XUTMHR",16,0)
 . L +^DIC(19.2,D0):2 I '$T Q
"RTN","XUTMHR",17,0)
 . S X=$G(^DIC(19.2,D0,0)),X1=+$G(^(1)) ;X1 is the task #.
"RTN","XUTMHR",18,0)
 . ;Check that the Option still exists.
"RTN","XUTMHR",19,0)
 . I '($D(^DIC(19,+X,0))#2) D REMOVE(D0) Q
"RTN","XUTMHR",20,0)
 . I $P(X,U,2)="" Q  ;No Scheduled time.
"RTN","XUTMHR",21,0)
 . ;Lock the Task
"RTN","XUTMHR",22,0)
 . L +^%ZTSK(X1):5 I $T D  L -^%ZTSK(X1)
"RTN","XUTMHR",23,0)
 . . ;I $P(X,U,9)["S" Q  ;Start-up.
"RTN","XUTMHR",24,0)
 . . I $P(X,U,2)>NOW,$D(^%ZTSK(X1)) Q  ;Scheduled for future
"RTN","XUTMHR",25,0)
 . . I X1,'$D(^%ZTSK(X1)) D FIX(D0,X) Q  ;%ZTSK entry missing
"RTN","XUTMHR",26,0)
 . . S TK=$G(^%ZTSK(X1,0))
"RTN","XUTMHR",27,0)
 . . I $P(X,U,2)>OLD,$L($P(X,U,6)) D FIX(D0,X,$P(TK,U,3)) Q  ;
"RTN","XUTMHR",28,0)
 . . Q
"RTN","XUTMHR",29,0)
 . Q
"RTN","XUTMHR",30,0)
 S ZTREQ="@"
"RTN","XUTMHR",31,0)
 Q
"RTN","XUTMHR",32,0)
 ;
"RTN","XUTMHR",33,0)
FIX(DA,X,USER) ;Reschedule
"RTN","XUTMHR",34,0)
 N FDA,IEN,Y,DUZ
"RTN","XUTMHR",35,0)
 S Y=$$APFIND^XUSAP("TASKMAN,PROXY USER")
"RTN","XUTMHR",36,0)
 S DUZ=$S($G(USER):USER,Y>0:Y,1:.5)
"RTN","XUTMHR",37,0)
 S Y=$$SCH^XLFDT($P(X,U,6),$P(X,U,2),1),IEN=DA_"," Q:'Y
"RTN","XUTMHR",38,0)
 S FDA(19.2,IEN,2)=Y
"RTN","XUTMHR",39,0)
 D FILE^DIE("K","FDA")
"RTN","XUTMHR",40,0)
 Q
"RTN","XUTMHR",41,0)
 ;
"RTN","XUTMHR",42,0)
REMOVE(DA) ;Remove if pointed to option is missing
"RTN","XUTMHR",43,0)
 N DIK
"RTN","XUTMHR",44,0)
 S DIK="^DIC(19.2," D ^DIK
"RTN","XUTMHR",45,0)
 Q
"RTN","XUTMHR",46,0)
 ;
"RTN","XUTMHR",47,0)
DEVREJ(SKIP) ;Rejected Device cleanup
"RTN","XUTMHR",48,0)
 N ZTSK,ZTDTH,CNT,VOL,Y,TRY,X,Z,XMB,XMY
"RTN","XUTMHR",49,0)
 D GETENV^%ZOSV S VOL=$P(Y,U,2),Y=$O(^%ZIS(14.5,"B",VOL,0)) Q:'Y
"RTN","XUTMHR",50,0)
 S TRY=$P(^%ZIS(14.5,Y,0),U,12),SKIP=$G(SKIP) Q:'TRY
"RTN","XUTMHR",51,0)
 S ZTDTH=0
"RTN","XUTMHR",52,0)
 F  S ZTDTH=$O(^%ZTSCH(ZTDTH)),ZTSK=0 Q:'ZTDTH  F  S ZTSK=$O(^%ZTSCH(ZTDTH,ZTSK)) Q:'ZTSK  D
"RTN","XUTMHR",53,0)
 . L +^%ZTSK(ZTSK,0):5 Q:'$T  ;Catch next time.
"RTN","XUTMHR",54,0)
 . Q:'$D(^%ZTSK(ZTSK,0))
"RTN","XUTMHR",55,0)
 . S Z=^%ZTSK(ZTSK,0),Y=$G(^%ZTSK(ZTSK,.2)),X=$P(Y,U,8)
"RTN","XUTMHR",56,0)
 . I X>TRY D UNSCH(ZTSK,$P(Z,U,3),$P(Y,U),SKIP)
"RTN","XUTMHR",57,0)
 . L -^%ZTSK(ZTSK)
"RTN","XUTMHR",58,0)
 . Q
"RTN","XUTMHR",59,0)
 Q
"RTN","XUTMHR",60,0)
 ;
"RTN","XUTMHR",61,0)
UNSCH(ZTSK,DZ,DEV,SKIP) ;Unschedule Task and send alert
"RTN","XUTMHR",62,0)
 N XQA,XQAMSG,XQADATA,XQAROU
"RTN","XUTMHR",63,0)
 D DQ^%ZTLOAD
"RTN","XUTMHR",64,0)
 S XQA(DZ)="",XQAMSG="Your task #"_ZTSK_" unscheduled, could not get device "_DEV,XQADATA=ZTSK,XQAROU="XQA^XUTMUTL"
"RTN","XUTMHR",65,0)
 I 'SKIP D SETUP^XQALERT Q
"RTN","XUTMHR",66,0)
 W !,XQAMSG
"RTN","XUTMHR",67,0)
 Q
"RTN","XUTMHR",68,0)
 ;
"RTN","XUTMHR",69,0)
EN(ZTQPARAM) ;So can job it to run.
"RTN","XUTMHR",70,0)
 ;
"RTN","XUTMHR",71,0)
SNAP ;Snapshot ZTMON data into the TASKMAN SNAPSHOT file.
"RTN","XUTMHR",72,0)
 S U="^"
"RTN","XUTMHR",73,0)
 N ZT1,ZT2,ZT3,ZT4,ZT5,ZTC,ZTC2,FDA,IEN,NOWH3,ZTQ1,ZTQ2
"RTN","XUTMHR",74,0)
 S ZTQPARAM=$G(ZTQPARAM,"60,60") ;Default run for 60 minutes, snap every minute
"RTN","XUTMHR",75,0)
 S ZTQ1=+ZTQPARAM*60 ;Convert minutes to seconds.
"RTN","XUTMHR",76,0)
 S:ZTQ1>480 ZTQ1=480 ;Max 8 hours
"RTN","XUTMHR",77,0)
 S ZTQ2=+$P(ZTQPARAM,",",2)
"RTN","XUTMHR",78,0)
 S ZTQ2=$S(ZTQ2<2:2,ZTQ2>ZTQ1:ZTQ1,1:ZTQ2) ;See in bounds
"RTN","XUTMHR",79,0)
 ;
"RTN","XUTMHR",80,0)
 F  D SN2 S ZTQ1=ZTQ1-ZTQ2 Q:'ZTQ1  H ZTQ2
"RTN","XUTMHR",81,0)
 Q
"RTN","XUTMHR",82,0)
 ;
"RTN","XUTMHR",83,0)
SN2 ;Do the snapshot
"RTN","XUTMHR",84,0)
 K IEN,FDA,%,R2,R3,SI,I2,I3
"RTN","XUTMHR",85,0)
 S IEN="+1,",NOWH3=$$H3^%ZTM($H)
"RTN","XUTMHR",86,0)
 S FDA(14.72,IEN,.01)=$$NOW^XLFDT
"RTN","XUTMHR",87,0)
 S FDA(14.72,IEN,2)=$$TM^ZTLOAD
"RTN","XUTMHR",88,0)
 S ZT1="",ZT2=0,SI=101,R2=14.72101
"RTN","XUTMHR",89,0)
 ;Get the Manager status data
"RTN","XUTMHR",90,0)
 F  S ZT1=$O(^%ZTSCH("STATUS",ZT1)) Q:ZT1=""  S X=^(ZT1) D
"RTN","XUTMHR",91,0)
 . S ZT2=ZT2+1,I2="+"_SI_","_IEN,SI=SI+1
"RTN","XUTMHR",92,0)
 . S FDA(R2,I2,.01)=ZT1,FDA(R2,I2,2)=$P(X,U),FDA(R2,I2,3)=$P(X,U,2)
"RTN","XUTMHR",93,0)
 . S FDA(R2,I2,4)=$P(X,U,3),FDA(R2,I2,5)=$P(X,U,4)
"RTN","XUTMHR",94,0)
 . Q
"RTN","XUTMHR",95,0)
 S FDA(14.72,IEN,3)=ZT2
"RTN","XUTMHR",96,0)
 ;Check and get the LOAD Balance data
"RTN","XUTMHR",97,0)
 S %=$G(^%ZTSCH("LOAD")),FDA(14.72,IEN,4)=$P(%,U),FDA(14.72,IEN,5)=$P(%,U,2)
"RTN","XUTMHR",98,0)
 ;S ZT1=$O(^%ZTSCH(1)),FDA(14.72,IEN,8)=$$LATE(ZT1,NOWH3)
"RTN","XUTMHR",99,0)
 S ZT1=1,ZT2=0,ZT3=0,ZTC=0,ZTC2=0,ZT5=0
"RTN","XUTMHR",100,0)
 ;Look at the task schedule list
"RTN","XUTMHR",101,0)
 ;ZT3 late amount, ZT5 is current time late, ZTC2 is count of late tasks.
"RTN","XUTMHR",102,0)
 F  S ZT1=$O(^%ZTSCH(ZT1)),ZT2=0 Q:'ZT1  S ZT5=$$LATE(ZT1,NOWH3) S:'ZT3 ZT3=ZT5 D
"RTN","XUTMHR",103,0)
 . F  S ZT2=$O(^%ZTSCH(ZT1,ZT2)) Q:'ZT2  S ZTC=ZTC+1 S:ZT5 ZTC2=ZTC2+1
"RTN","XUTMHR",104,0)
 S FDA(14.72,IEN,7)=ZTC,FDA(14.72,IEN,8)=ZT3,FDA(14.72,IEN,9)=ZTC2
"RTN","XUTMHR",105,0)
 ;Look at the IO list
"RTN","XUTMHR",106,0)
 S ZT1="",ZTC=0
"RTN","XUTMHR",107,0)
 F  S ZT1=$O(^%ZTSCH("IO",ZT1)) Q:ZT1=""  S:$O(^%ZTSCH("IO",ZT1,0)) ZTC=ZTC+1
"RTN","XUTMHR",108,0)
 S FDA(14.72,IEN,10)=ZTC
"RTN","XUTMHR",109,0)
 S ZT1="",ZT2=0,ZT3=0,ZT4=0,ZTC=0
"RTN","XUTMHR",110,0)
 F  S ZT1=$O(^%ZTSCH("IO",ZT1)),ZT2=0 Q:'ZT1  F  S ZT2=$O(^%ZTSCH("IO",ZT1,ZT2)),ZT3=0 Q:'ZT2  S:'ZT4 ZT4=ZT2 F  S ZT3=$O(^%ZTSCH("IO",ZT1,ZT2,ZT3)) Q:ZT3=""  S ZTC=ZTC+1
"RTN","XUTMHR",111,0)
 S FDA(14.72,IEN,11)=ZTC,FDA(14.72,IEN,12)=ZT4
"RTN","XUTMHR",112,0)
 ;Look at the JOB list
"RTN","XUTMHR",113,0)
 S ZT1=0,ZT2=0,ZT3=0,ZTC=0
"RTN","XUTMHR",114,0)
 F  S ZT1=$O(^%ZTSCH("JOB",ZT1)),ZT2=0 Q:'ZT1  F  S ZT2=$O(^%ZTSCH("JOB",ZT1,ZT2)) Q:'ZT2  S ZTC=ZTC+1
"RTN","XUTMHR",115,0)
 ;Look at the C list
"RTN","XUTMHR",116,0)
 S ZT1="",ZT2=0,ZT3=0
"RTN","XUTMHR",117,0)
 F  S ZT1=$O(^%ZTSCH("C",ZT1)),ZT2=0 Q:ZT1=""  F  S ZT2=$O(^%ZTSCH("C",ZT1,ZT2)),ZT3=0 Q:ZT2=""  F  S ZT3=$O(^%ZTSCH("C",ZT1,ZT2,ZT3)) Q:ZT3=""  S ZTC=ZTC+1
"RTN","XUTMHR",118,0)
 S FDA(14.72,IEN,15)=ZTC
"RTN","XUTMHR",119,0)
 S FDA(14.72,IEN,16)=$$LATE($O(^%ZTSCH("JOB",1)),NOWH3)
"RTN","XUTMHR",120,0)
 ;Look at the running Task list
"RTN","XUTMHR",121,0)
 S ZT1=0,ZT2=0,ZT3=0,ZTC=0
"RTN","XUTMHR",122,0)
 F  S ZT1=$O(^%ZTSCH("TASK",ZT1)) Q:'ZT1  S ZTC=ZTC+1
"RTN","XUTMHR",123,0)
 S FDA(14.72,IEN,20)=ZTC
"RTN","XUTMHR",124,0)
 ;Look at the SUB-Managers
"RTN","XUTMHR",125,0)
 S ZT1=0,ZT2=0,ZT3=0,ZTC=0,R3=14.72201,SI=201
"RTN","XUTMHR",126,0)
 F  S ZT1=$O(^%ZTSCH("SUB",ZT1)),ZT2=0 Q:'$L(ZT1)  F  S ZT2=$O(^%ZTSCH("SUB",ZT1,ZT2)) Q:'ZT2  S X=^(ZT2) D
"RTN","XUTMHR",127,0)
 . S ZTC=ZTC+1,I3="+"_SI_","_IEN,SI=SI+1
"RTN","XUTMHR",128,0)
 . S FDA(R3,I3,.01)=ZT2,FDA(R3,I3,2)=$P(X,U),FDA(R3,I3,3)=$P(X,U,2),FDA(R3,I3,4)=$P(X,U,3),FDA(R3,I3,5)=ZT1
"RTN","XUTMHR",129,0)
 . Q
"RTN","XUTMHR",130,0)
 S FDA(14.72,IEN,19)=ZTC
"RTN","XUTMHR",131,0)
 S FDA(14.72,IEN,22)=$$ACTJ^%ZOSV() ;Total jobs
"RTN","XUTMHR",132,0)
 ;Now save the data.
"RTN","XUTMHR",133,0)
 L +^%ZIS(14.72,0):10 D UPDATE^DIE("S","FDA") L -^%ZIS(14.72,0)
"RTN","XUTMHR",134,0)
 I $D(^TMP("DIERR",$J)) D ^%ZTER
"RTN","XUTMHR",135,0)
 Q
"RTN","XUTMHR",136,0)
 ;
"RTN","XUTMHR",137,0)
LATE(T1,NOW) ;Return if a H3 time is Late
"RTN","XUTMHR",138,0)
 S:T1["," T1=$$H3^%ZTM(T1)
"RTN","XUTMHR",139,0)
 Q $S(T1<1:0,T1<NOW:NOW-T1,1:0)
"VER")
8.0^22.0
"^DD",3.5,3.5,3,0)
SUBTYPE^RP3.2'^%ZIS(2,^SUBTYPE;1^Q
"^DD",3.5,3.5,3,1,0)
^.1^^0
"^DD",3.5,3.5,3,21,0)
^^3^3^2920518^^^^
"^DD",3.5,3.5,3,21,1,0)
This field tells what type of terminal is on a terminal port.
"^DD",3.5,3.5,3,21,2,0)
It has a great impact on whether the proper terminal control codes
"^DD",3.5,3.5,3,21,3,0)
get sent to the terminal.
"^DD",3.5,3.5,3,"DT")
3091104
"^DD",14.5,14.5,10,0)
RE-QUEUES BEFORE UN-SCHEDULE^NJ5,0^^0;12^K:+X'=X!(X>99999)!(X<6)!(X?.E1"."1N.N) X
"^DD",14.5,14.5,10,3)
Type a number between 6 and 99999, the number of re-queue times.
"^DD",14.5,14.5,10,21,0)
^^5^5^3090910^
"^DD",14.5,14.5,10,21,1,0)
This field holds the number of times that a task to a HFS or SPOOL device 
"^DD",14.5,14.5,10,21,2,0)
will be re-queued for a 5 minute delay before it is un-scheduled.
"^DD",14.5,14.5,10,21,3,0)
The routine XUTMHR does this work once an hour.  It will send an alert to
"^DD",14.5,14.5,10,21,4,0)
the user that queued the task.
"^DD",14.5,14.5,10,21,5,0)
A value of 12 would be an hour and 288 would be a day.
"^DD",14.5,14.5,10,"DT")
3090910
"^DD",200,200,53.3,0)
VA#^FX^^PS;3^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>10!($L(X)<3) X D VANUM^XUSER2
"^DD",200,200,53.3,1,0)
^.1^^-1
"^DD",200,200,53.3,1,1,0)
200^PS2
"^DD",200,200,53.3,1,1,1)
S ^VA(200,"PS2",$E(X,1,30),DA)=""
"^DD",200,200,53.3,1,1,2)
K ^VA(200,"PS2",$E(X,1,30),DA)
"^DD",200,200,53.3,1,1,3)
Lookup providers by their VA number
"^DD",200,200,53.3,1,1,"%D",0)
^^1^1^2931208^^
"^DD",200,200,53.3,1,1,"%D",1,0)
This was 'APS2' before. Also used to stop duplicate numbers.
"^DD",200,200,53.3,1,1,"DT")
2930924
"^DD",200,200,53.3,3)
Enter the VA number 3 to 10 characters.
"^DD",200,200,53.3,4)
D EN^DDIOL("Enter the VA number.  VA number must be unique among active providers.",,"!,?5")
"^DD",200,200,53.3,20,0)
^.3LA^1^1
"^DD",200,200,53.3,20,1,0)
PS
"^DD",200,200,53.3,20,2,0)
PSO
"^DD",200,200,53.3,21,0)
^^2^2^3021210^
"^DD",200,200,53.3,21,1,0)
This field is used to enter the VA number.
"^DD",200,200,53.3,21,2,0)
The VA number must be unique.
"^DD",200,200,53.3,"DT")
3091008
"BLD",1255,6)
^438
**END**
**END**
