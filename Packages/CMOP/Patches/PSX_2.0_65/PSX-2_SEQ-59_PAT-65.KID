Released PSX*2*65 SEQ #59
Extracted from mail message
**KIDS**:PSX*2.0*65^

**INSTALL NAME**
PSX*2.0*65
"BLD",7389,0)
PSX*2.0*65^CMOP^0^3090513^y
"BLD",7389,1,0)
^^405^405^3080623^
"BLD",7389,1,1,0)
This patch has enhancements which extend the capabilities of the Veterans 
"BLD",7389,1,2,0)
Health Information Systems and Technology Architecture (VistA) electronic 
"BLD",7389,1,3,0)
pharmacy (ePharmacy) billing system.  Below is a list of all the 
"BLD",7389,1,4,0)
applications involved in this project along with their patch number:
"BLD",7389,1,5,0)
 
"BLD",7389,1,6,0)
   APPLICATION/VERSION                                  PATCH
"BLD",7389,1,7,0)
   --------------------------------------------------------------
"BLD",7389,1,8,0)
   CONSOLIDATED MAIL OUTPATIENT PHARMACY (CMOP) V. 2.0  PSX*2*65
"BLD",7389,1,9,0)
   PHARMACY DATA MANAGEMENT (PDM) V. 1.0                PSS*1*131
"BLD",7389,1,10,0)
   OUTPATIENT PHARMACY (OP) V. 7.0                      PSO*7*289
"BLD",7389,1,11,0)
   INTEGRATED BILLING (IB) V. 2.0                       IB*2*384
"BLD",7389,1,12,0)
   ELECTRONIC CLAIMS MANAGEMENT ENGINE (ECME) V. 1.0    BPS*1*7
"BLD",7389,1,13,0)
 
"BLD",7389,1,14,0)
The last three patches (PSO*7*289, IB*2*384 and BPS*1*7) will be released 
"BLD",7389,1,15,0)
in the Kernel Installation and Distribution System (KIDS) multi-build 
"BLD",7389,1,16,0)
distribution BPS PSO IB BUNDLE 3.0.  Patches PSX*2*65 and PSS*1*131 will 
"BLD",7389,1,17,0)
be released as stand-alone patches.  Since there is an implementation 
"BLD",7389,1,18,0)
dependency between the multi-build distribution and the stand-alone 
"BLD",7389,1,19,0)
patches, PSX*2*65 and PSS*1*131 must be installed prior to the 
"BLD",7389,1,20,0)
installation of the multi-build.  For more specific instructions please 
"BLD",7389,1,21,0)
refer to the installation steps provided in each of the patches.
"BLD",7389,1,22,0)
 
"BLD",7389,1,23,0)
All sites should install these patches regardless of whether or not they 
"BLD",7389,1,24,0)
have been activated for ePharmacy by the Central Business Office (CBO).  
"BLD",7389,1,25,0)
After the installation of these patches, the activation status of the 
"BLD",7389,1,26,0)
site will not be impacted.  As before, activation of the ePharmacy 
"BLD",7389,1,27,0)
product will require instructions provided by the CBO.  Sites are not to 
"BLD",7389,1,28,0)
activate unless instructed specifically by the CBO.
"BLD",7389,1,29,0)
 
"BLD",7389,1,30,0)
This patch modifies the CMOP v2.0 application as described
"BLD",7389,1,31,0)
below:
"BLD",7389,1,32,0)
 
"BLD",7389,1,33,0)
 
"BLD",7389,1,34,0)
1.      A modification was made to allow for CMOP Suspense Date Rx's 
"BLD",7389,1,35,0)
picked up after midnight to be sent to ECME appropriately. When the CMOP 
"BLD",7389,1,36,0)
transmission starts, all Rx's in the suspense file are evaluated to see 
"BLD",7389,1,37,0)
if they should be submitted to ECME first and if so are submitted. Then 
"BLD",7389,1,38,0)
the system re-evaluates the suspense file to pull the latest list of Rx's 
"BLD",7389,1,39,0)
to send to CMOP using the current date and time. When the CMOP evaluation 
"BLD",7389,1,40,0)
runs past midnight, any Rx's with the suspense dates changed to that day 
"BLD",7389,1,41,0)
are sent to CMOP. However, since the ECME submission ran before midnight, 
"BLD",7389,1,42,0)
those Rx's would not have been sent. This modification will re-check the 
"BLD",7389,1,43,0)
Rx's in suspense for the new date after the CMOP transmission completes 
"BLD",7389,1,44,0)
in order to pick up Rx's that need to be sent to ECME after midnight.
"BLD",7389,1,45,0)
 
"BLD",7389,1,46,0)
2.      New functionality was added to prevent prescriptions from being 
"BLD",7389,1,47,0)
filled/sent to CMOP when a host processing error occurs when a claim is 
"BLD",7389,1,48,0)
submitted through ECME. The host processing errors are identified by 
"BLD",7389,1,49,0)
reject codes M6, M8, NN, and 99. The following conditions apply when this 
"BLD",7389,1,50,0)
scenario occurs.
"BLD",7389,1,51,0)
a.      The transmission of the Rx/fill will be delayed 1 day in hopes 
"BLD",7389,1,52,0)
that the host processing issues will be resolved.
"BLD",7389,1,53,0)
b.      An activity log entry will be defined to state the date/time 
"BLD",7389,1,54,0)
along with a comment stating that the Rx/fill was left in suspense hold 
"BLD",7389,1,55,0)
due to a host processing error.
"BLD",7389,1,56,0)
c.      This added functionality does not include the Pull Early from 
"BLD",7389,1,57,0)
Suspense function.
"BLD",7389,1,58,0)
 
"BLD",7389,1,59,0)
3.      New functionality was added to the Print from Suspense File [PSO 
"BLD",7389,1,60,0)
PNDLBL] option to prevent prescriptions from being pulled early from 
"BLD",7389,1,61,0)
suspense until 3/4 of the days supply of the Rx/fill has elapsed.
"BLD",7389,1,62,0)
 
"BLD",7389,1,63,0)
4.      The 'CMOP/ECME Activity Report' [BPS RPT CMOP/ECME ACTIVITY] has 
"BLD",7389,1,64,0)
been modified. 
"BLD",7389,1,65,0)
a.      The CMOP-STATUS column will display 'D' for Dispense or 'T' for 
"BLD",7389,1,66,0)
Transmit instead of partially spelling out the status.
"BLD",7389,1,67,0)
b.      A prompt will be added to select detailed or summary 
"BLD",7389,1,68,0)
information.  Detailed information will reflect what is currently 
"BLD",7389,1,69,0)
displayed.  Summary information will shorten the batch header section of 
"BLD",7389,1,70,0)
the report.
"BLD",7389,1,71,0)
c.      A prompt will be added to select a list of patients (or ^ALL).  
"BLD",7389,1,72,0)
Only patients on the list will be included in the detail.
"BLD",7389,1,73,0)
d.      The division prompt will be modified to be consistent with other 
"BLD",7389,1,74,0)
ECME options, i.e., the selection prompt will show 'A ALL DIVISIONS' 
"BLD",7389,1,75,0)
first, 'S SELECT DIVISIONS' second, and will roll into particular 
"BLD",7389,1,76,0)
divisions if the user selects an 'S'.
"BLD",7389,1,77,0)
e.      A prompt will be added to select released, unreleased, or all 
"BLD",7389,1,78,0)
prescriptions.
"BLD",7389,1,79,0)
f.      Detailed reports will only display information from batches that 
"BLD",7389,1,80,0)
have ECME Rxs.
"BLD",7389,1,81,0)
g.      Header information will be centered. 
"BLD",7389,1,82,0)
5.
"BLD",7389,1,83,0)
 
"BLD",7389,1,84,0)
 
"BLD",7389,1,85,0)
 
"BLD",7389,1,86,0)
 
"BLD",7389,1,87,0)
This patch addresses the following New Service Request (NSR):
"BLD",7389,1,88,0)
-------------------------------------------------------------
"BLD",7389,1,89,0)
There is no NSR associated with this patch.
"BLD",7389,1,90,0)
 
"BLD",7389,1,91,0)
 
"BLD",7389,1,92,0)
This patch addresses the following Remedy Ticket(s):
"BLD",7389,1,93,0)
----------------------------------------------------
"BLD",7389,1,94,0)
There is no Remedy Tickets associated with this patch.
"BLD",7389,1,95,0)
 
"BLD",7389,1,96,0)
 
"BLD",7389,1,97,0)
 
"BLD",7389,1,98,0)
Overview of Remedy Ticket(s):
"BLD",7389,1,99,0)
-----------------------------
"BLD",7389,1,100,0)
 
"BLD",7389,1,101,0)
 
"BLD",7389,1,102,0)
 
"BLD",7389,1,103,0)
Components Sent With Patch
"BLD",7389,1,104,0)
--------------------------
"BLD",7389,1,105,0)
The following is a list of files included in this patch:
"BLD",7389,1,106,0)
 
"BLD",7389,1,107,0)
                                          UP    SEND  DATA
"BLD",7389,1,108,0)
                                          DATE  SEC.  COMES  SITE   RSLV
"BLD",7389,1,109,0)
FILE #        NAME                        DD    CODE  W/FILE DATA   PTS
"BLD",7389,1,110,0)
-----------------------------------------------------------------------
"BLD",7389,1,111,0)
 
"BLD",7389,1,112,0)
 
"BLD",7389,1,113,0)
The following is a list of files deleted in this patch:
"BLD",7389,1,114,0)
 
"BLD",7389,1,115,0)
FILE #        NAME
"BLD",7389,1,116,0)
-------------------------------------
"BLD",7389,1,117,0)
 
"BLD",7389,1,118,0)
 
"BLD",7389,1,119,0)
The following is a list of sub-files and related fields deleted in this 
"BLD",7389,1,120,0)
patch:
"BLD",7389,1,121,0)
 
"BLD",7389,1,122,0)
Subfile Name (Number)                 File Name (Number)
"BLD",7389,1,123,0)
  Field Name (Number)
"BLD",7389,1,124,0)
---------------------                 ---------------------
"BLD",7389,1,125,0)
 
"BLD",7389,1,126,0)
 
"BLD",7389,1,127,0)
The following is a list of fields included in this patch:
"BLD",7389,1,128,0)
 
"BLD",7389,1,129,0)
Field Name (Number)                   File Name (Number)
"BLD",7389,1,130,0)
                                      Subfile Name (Number)
"BLD",7389,1,131,0)
-------------------                   ------------------
"BLD",7389,1,132,0)
CERTIFICATION IEN (902.23)            BPS TRANSACTIONS (9002313.59)
"BLD",7389,1,133,0)
 
"BLD",7389,1,134,0)
 
"BLD",7389,1,135,0)
The following is a list of fields deleted in this patch:
"BLD",7389,1,136,0)
 
"BLD",7389,1,137,0)
Field Name (Number)                   File Name (Number)
"BLD",7389,1,138,0)
                                      Subfile Name (Number)
"BLD",7389,1,139,0)
-------------------                   ------------------
"BLD",7389,1,140,0)
 
"BLD",7389,1,141,0)
 
"BLD",7389,1,142,0)
The following is a list of print templates deleted in this patch:
"BLD",7389,1,143,0)
 
"BLD",7389,1,144,0)
Template Name               File Name (Number)
"BLD",7389,1,145,0)
-------------               ------------------
"BLD",7389,1,146,0)
 
"BLD",7389,1,147,0)
 
"BLD",7389,1,148,0)
The following is a list of sort templates deleted in this patch:
"BLD",7389,1,149,0)
 
"BLD",7389,1,150,0)
Template Name                File Name (Number)
"BLD",7389,1,151,0)
-------------                ------------------
"BLD",7389,1,152,0)
 
"BLD",7389,1,153,0)
 
"BLD",7389,1,154,0)
The following is a list of list templates included in this patch:
"BLD",7389,1,155,0)
 
"BLD",7389,1,156,0)
Template Name
"BLD",7389,1,157,0)
-------------
"BLD",7389,1,158,0)
 
"BLD",7389,1,159,0)
 
"BLD",7389,1,160,0)
The following is a list of options included in this patch:
"BLD",7389,1,161,0)
 
"BLD",7389,1,162,0)
Option Name                  Type               New/Modified
"BLD",7389,1,163,0)
-----------                  ----               ------------
"BLD",7389,1,164,0)
 
"BLD",7389,1,165,0)
 
"BLD",7389,1,166,0)
The following is a list of protocols included in this patch:
"BLD",7389,1,167,0)
 
"BLD",7389,1,168,0)
Protocol Name
"BLD",7389,1,169,0)
-----------
"BLD",7389,1,170,0)
 
"BLD",7389,1,171,0)
 
"BLD",7389,1,172,0)
The following is a list of forms deleted in this patch:
"BLD",7389,1,173,0)
 
"BLD",7389,1,174,0)
Template Name               File Name (Number)
"BLD",7389,1,175,0)
-------------               ------------------
"BLD",7389,1,176,0)
 
"BLD",7389,1,177,0)
 
"BLD",7389,1,178,0)
 
"BLD",7389,1,179,0)
Documentation Retrieval:
"BLD",7389,1,180,0)
========================
"BLD",7389,1,181,0)
Sites may retrieve documentation in one of the following ways:
"BLD",7389,1,182,0)
 
"BLD",7389,1,183,0)
 1.  The preferred method is to FTP the files from 
"BLD",7389,1,184,0)
     download.vista.med.va.gov, which will transmit the files from the
"BLD",7389,1,185,0)
     first available FTP server.
"BLD",7389,1,186,0)
 
"BLD",7389,1,187,0)
 2.  Sites may also elect to retrieve documentation directly from a 
"BLD",7389,1,188,0)
     specific server as follows:
"BLD",7389,1,189,0)
 
"BLD",7389,1,190,0)
     Albany          ftp.fo-albany.med.va.gov
"BLD",7389,1,191,0)
     Hines           ftp.fo-hines.med.va.gov
"BLD",7389,1,192,0)
     Salt Lake City  ftp.fo-slc.med.va.gov
"BLD",7389,1,193,0)
 
"BLD",7389,1,194,0)
 3.  Documentation can also be retrieved from the VistA Documentation 
"BLD",7389,1,195,0)
     Library (VDL) on the Internet at the following address,
"BLD",7389,1,196,0)
     http://www.va.gov/vdl.
"BLD",7389,1,197,0)
 
"BLD",7389,1,198,0)
The documentation distribution includes:
"BLD",7389,1,199,0)
 
"BLD",7389,1,200,0)
    FILE NAME                             DESCRIPTION
"BLD",7389,1,201,0)
    
"BLD",7389,1,202,0)
    ---------------------------------------------------------------------
"BLD",7389,1,203,0)
 
"BLD",7389,1,204,0)
 
"BLD",7389,1,205,0)
 
"BLD",7389,1,206,0)
 
"BLD",7389,1,207,0)
Test Sites:
"BLD",7389,1,208,0)
===========
"BLD",7389,1,209,0)
 
"BLD",7389,1,210,0)
 
"BLD",7389,1,211,0)
 
"BLD",7389,1,212,0)
 
"BLD",7389,1,213,0)
       ================INSTALLATION INSTRUCTIONS =================
"BLD",7389,1,214,0)
 
"BLD",7389,1,215,0)
To avoid disruptions, these patches should be installed when users are 
"BLD",7389,1,216,0)
not on the system and during non-peak hours.  Of particular concern would 
"BLD",7389,1,217,0)
be the items below.
"BLD",7389,1,218,0)
 
"BLD",7389,1,219,0)
    1.  Do not install the patch when ECME claims are being generated
"BLD",7389,1,220,0)
        by the BPS Nightly Background Job option [BPS NIGHTLY
"BLD",7389,1,221,0)
        BACKGROUND JOB].  Wait for this job to finish or complete the
"BLD",7389,1,222,0)
        installation before this job starts.
"BLD",7389,1,223,0)
    2.  Do not install the patch when prescriptions are being 
"BLD",7389,1,224,0)
        transmitted to CMOP.  Wait for the CMOP transmission to finish 
"BLD",7389,1,225,0)
        or complete the installation before the transmission starts.  
"BLD",7389,1,226,0)
        Check with Pharmacy Service or your pharmacy Automated Data
"BLD",7389,1,227,0)
        Processing Application Coordinator (ADPAC) to find out when
"BLD",7389,1,228,0)
        CMOP transmissions occur.
"BLD",7389,1,229,0)
    3.  In addition, note that you will be prompted to disable the
"BLD",7389,1,230,0)
        following options during the installation:
"BLD",7389,1,231,0)
 
"BLD",7389,1,232,0)
 
"BLD",7389,1,233,0)
 
"BLD",7389,1,234,0)
 
"BLD",7389,1,235,0)
Install Time - Approximately 30 minutes
"BLD",7389,1,236,0)
 
"BLD",7389,1,237,0)
 
"BLD",7389,1,238,0)
 
"BLD",7389,1,239,0)
1.  OBTAIN PATCHES
"BLD",7389,1,240,0)
    --------------
"BLD",7389,1,241,0)
    Patches PSX*2*65 and PSS*1*131 will be sent to your system upon
"BLD",7389,1,242,0)
    release from the National Patch Module.
"BLD",7389,1,243,0)
 
"BLD",7389,1,244,0)
    Obtain the host file BPS_1_7_PSO_IB.KID, which contains the following
"BLD",7389,1,245,0)
    three patch installs:
"BLD",7389,1,246,0)
 
"BLD",7389,1,247,0)
        BPS*1.0*7
"BLD",7389,1,248,0)
        PSO*7.0*289
"BLD",7389,1,249,0)
        IB*2.0*384
"BLD",7389,1,250,0)
 
"BLD",7389,1,251,0)
     Sites can retrieve VistA software from the following FTP addresses.
"BLD",7389,1,252,0)
     The preferred method is to FTP the files from:
"BLD",7389,1,253,0)
 
"BLD",7389,1,254,0)
                    download.vista.med.va.gov
"BLD",7389,1,255,0)
 
"BLD",7389,1,256,0)
     This will transmit the files from the first available FTP server.
"BLD",7389,1,257,0)
     Sites may also elect to retrieve software directly from a specific
"BLD",7389,1,258,0)
     server as follows:
"BLD",7389,1,259,0)
 
"BLD",7389,1,260,0)
       Albany                  ftp.fo-albany.med.va.gov
"BLD",7389,1,261,0)
       Hines                   ftp.fo-hines.med.va.gov
"BLD",7389,1,262,0)
       Salt Lake City          ftp.fo-slc.med.va.gov
"BLD",7389,1,263,0)
 
"BLD",7389,1,264,0)
     The BPS_1_7_PSO_IB.KID host file is located in the anonymous.software
"BLD",7389,1,265,0)
     directory.  Use ASCII Mode when downloading the file.
"BLD",7389,1,266,0)
 
"BLD",7389,1,267,0)
2.  LOAD TRANSPORT GLOBAL FOR STAND-ALONE PATCHES
"BLD",7389,1,268,0)
    ---------------------------------------------
"BLD",7389,1,269,0)
    For patches PSX*2*65 and PSS*1*131, choose the PackMan message
"BLD",7389,1,270,0)
    containing each of these patches and invoke the INSTALL/CHECK MESSAGE
"BLD",7389,1,271,0)
    PackMan option.
"BLD",7389,1,272,0)
 
"BLD",7389,1,273,0)
3.  START UP KIDS
"BLD",7389,1,274,0)
    -------------
"BLD",7389,1,275,0)
    Start up the Kernel Installation and Distribution System Menu option
"BLD",7389,1,276,0)
    [XPD MAIN]:
"BLD",7389,1,277,0)
 
"BLD",7389,1,278,0)
         Edits and Distribution ...
"BLD",7389,1,279,0)
         Utilities ...
"BLD",7389,1,280,0)
         Installation ...
"BLD",7389,1,281,0)
 
"BLD",7389,1,282,0)
    Select Kernel Installation & Distribution System Option: INStallation
"BLD",7389,1,283,0)
                                                             ---
"BLD",7389,1,284,0)
         Load a Distribution
"BLD",7389,1,285,0)
         Print Transport Global
"BLD",7389,1,286,0)
         Compare Transport Global to Current System
"BLD",7389,1,287,0)
         Verify Checksums in Transport Global
"BLD",7389,1,288,0)
         Install Package(s)
"BLD",7389,1,289,0)
         Restart Install of Package(s)
"BLD",7389,1,290,0)
         Unload a Distribution
"BLD",7389,1,291,0)
         Backup a Transport Global
"BLD",7389,1,292,0)
 
"BLD",7389,1,293,0)
    Select Installation Option:
"BLD",7389,1,294,0)
 
"BLD",7389,1,295,0)
4.  RUN OPTIONAL INSTALLATION OPTIONS FOR STAND-ALONE PATCHES
"BLD",7389,1,296,0)
    ---------------------------------------------------------
"BLD",7389,1,297,0)
    From the Installation menu, you may select to use the following
"BLD",7389,1,298,0)
    options (when prompted for the INSTALL NAME, enter each of the
"BLD",7389,1,299,0)
    stand-alone patches (PSX*2.0*65 and PSS*1.0*131)):
"BLD",7389,1,300,0)
 
"BLD",7389,1,301,0)
    a.  Backup a Transport Global - This option will create a backup
"BLD",7389,1,302,0)
        message of any routines exported with this patch.  It will not
"BLD",7389,1,303,0)
        backup any other changes such as Database Definitions (DD's) or
"BLD",7389,1,304,0)
        templates.
"BLD",7389,1,305,0)
    b.  Compare Transport Global to Current System - This option will
"BLD",7389,1,306,0)
        allow you to view all changes that will be made when this patch
"BLD",7389,1,307,0)
        is installed.  It compares all components of this patch
"BLD",7389,1,308,0)
        (routines, DD's, templates, etc.).
"BLD",7389,1,309,0)
    c.  Verify Checksums in Transport Global - This option will allow
"BLD",7389,1,310,0)
        you to ensure the integrity of the routines that are in the
"BLD",7389,1,311,0)
        transport global.
"BLD",7389,1,312,0)
 
"BLD",7389,1,313,0)
5.  INSTALL STAND-ALONE PATCHES
"BLD",7389,1,314,0)
    ---------------------------
"BLD",7389,1,315,0)
    This is the step to start the installation of this KIDS patch.  This
"BLD",7389,1,316,0)
    will need to be run for each of the stand-alone patches (PSX*2*65 and
"BLD",7389,1,317,0)
    PSS*1*131).
"BLD",7389,1,318,0)
 
"BLD",7389,1,319,0)
    a.  Choose the Install Package(s) option to start the patch
"BLD",7389,1,320,0)
        install.
"BLD",7389,1,321,0)
    b.  When prompted for the "Select INSTALL NAME:", enter the patch
"BLD",7389,1,322,0)
        name.
"BLD",7389,1,323,0)
    c.  When prompted "Want KIDS to INHIBIT LOGONs during the install?
"BLD",7389,1,324,0)
        YES//" answer NO.
"BLD",7389,1,325,0)
    d.  When prompted "Want to DISABLE Scheduled Options, Menu
"BLD",7389,1,326,0)
        Options, and Protocols? YES//" answer NO.
"BLD",7389,1,327,0)
    e.  When prompted, "Device: Home//" respond with the correct device.
"BLD",7389,1,328,0)
 
"BLD",7389,1,329,0)
6.  LOAD TRANSPORT GLOBAL FOR MULTI-BUILD
"BLD",7389,1,330,0)
    -------------------------------------
"BLD",7389,1,331,0)
    After the installation of the stand-alone patches is complete, return
"BLD",7389,1,332,0)
    to the Installation menu.
"BLD",7389,1,333,0)
 
"BLD",7389,1,334,0)
    From the Installation menu, select the Load a Distribution option.
"BLD",7389,1,335,0)
 
"BLD",7389,1,336,0)
    When prompted for "Enter a Host File:", enter the full directory path
"BLD",7389,1,337,0)
    where you saved the host file BPS_1_7_PSO_IB.KID (e.g.,
"BLD",7389,1,338,0)
    SYS$SYSDEVICE:[ANONYMOUS]BPS_1_7_PSO_IB.KID).
"BLD",7389,1,339,0)
 
"BLD",7389,1,340,0)
    When prompted for "OK to continue with Load? NO//", enter "YES."
"BLD",7389,1,341,0)
 
"BLD",7389,1,342,0)
    The following will display:
"BLD",7389,1,343,0)
 
"BLD",7389,1,344,0)
      Loading Distribution...
"BLD",7389,1,345,0)
 
"BLD",7389,1,346,0)
        BPS PSO IB BUNDLE 3.0
"BLD",7389,1,347,0)
        BPS*1.0*7
"BLD",7389,1,348,0)
        PSO*7.0*289
"BLD",7389,1,349,0)
        IB*2.0*384
"BLD",7389,1,350,0)
      Use INSTALL NAME: BPS PSO IB BUNDLE 3.0 to install this
"BLD",7389,1,351,0)
      Distribution.
"BLD",7389,1,352,0)
 
"BLD",7389,1,353,0)
7.  RUN OPTIONAL INSTALLATION OPTIONS FOR MULTI-BUILD
"BLD",7389,1,354,0)
    -------------------------------------------------
"BLD",7389,1,355,0)
    From the Installation menu, you may select to use the following
"BLD",7389,1,356,0)
    options (when prompted for the INSTALL NAME, enter
"BLD",7389,1,357,0)
    BPS PSO IB BUNDLE 3.0):
"BLD",7389,1,358,0)
 
"BLD",7389,1,359,0)
    a.  Backup a Transport Global - This option will create a backup
"BLD",7389,1,360,0)
        message of any routines exported with this patch.  It will not
"BLD",7389,1,361,0)
        backup any other changes such as DD's or templates.
"BLD",7389,1,362,0)
    b.  Compare Transport Global to Current System - This option will
"BLD",7389,1,363,0)
        allow you to view all changes that will be made when this patch
"BLD",7389,1,364,0)
        is installed.  It compares all components of this patch
"BLD",7389,1,365,0)
        (routines, DD's, templates, etc.).
"BLD",7389,1,366,0)
    c.  Verify Checksums in Transport Global - This option will allow
"BLD",7389,1,367,0)
        you to ensure the integrity of the routines that are in the
"BLD",7389,1,368,0)
        transport global.
"BLD",7389,1,369,0)
 
"BLD",7389,1,370,0)
8.  INSTALL MULTI-BUILD
"BLD",7389,1,371,0)
    -------------------
"BLD",7389,1,372,0)
    This is the step to start the installation of this KIDS patch.  This
"BLD",7389,1,373,0)
    will need to be run for the BPS PSO IB BUNDLE 3.0.
"BLD",7389,1,374,0)
    
"BLD",7389,1,375,0)
    a.  Choose the Install Package(s) option to start the patch
"BLD",7389,1,376,0)
        install.
"BLD",7389,1,377,0)
    b.  When prompted for the "Select INSTALL NAME:", enter BPS PSO IB
"BLD",7389,1,378,0)
        BUNDLE 3.0.
"BLD",7389,1,379,0)
    c.  For the BPS*1*7 patch, when prompted "Want KIDS to Rebuild Menu
"BLD",7389,1,380,0)
        Trees Upon Completion of Install? YES//"  enter YES unless your
"BLD",7389,1,381,0)
        system does this in a nightly TaskMan process.
"BLD",7389,1,382,0)
    d.  For the PSO*7*289 patch, when prompted "Want KIDS to Rebuild Menu
"BLD",7389,1,383,0)
        Trees Upon Completion of Install? YES//"  enter YES unless your
"BLD",7389,1,384,0)
        system does this in a nightly TaskMan process.
"BLD",7389,1,385,0)
    e.  When prompted "Want KIDS to INHIBIT LOGONs during the
"BLD",7389,1,386,0)
        install? YES//"  enter NO.
"BLD",7389,1,387,0)
    f.  When prompted "Want to DISABLE Scheduled Options, Menu Options,
"BLD",7389,1,388,0)
        and Protocols? YES//"  enter YES.
"BLD",7389,1,389,0)
    g.  When prompted "Enter options you wish to mark as 'Out Of
"BLD",7389,1,390,0)
        Order':"  enter the following options:
"BLD",7389,1,391,0)
 
"BLD",7389,1,392,0)
    h.  When prompted "Enter protocols you wish to mark as 'Out Of
"BLD",7389,1,393,0)
        Order':"  enter <return>.
"BLD",7389,1,394,0)
    i.  When prompted "Delay Install (Minutes):  (0-60): 0//"  enter an
"BLD",7389,1,395,0)
        appropriate number of minutes to delay the installation in 
"BLD",7389,1,396,0)
        order to give users enough time to exit the disabled options
"BLD",7389,1,397,0)
        before the installation starts.
"BLD",7389,1,398,0)
    j.  When prompted "Device: Home//"  respond with the correct device.
"BLD",7389,1,399,0)
 
"BLD",7389,1,400,0)
 
"BLD",7389,1,401,0)
 
"BLD",7389,1,402,0)
The BPS post-install routine delivered with BPS*1*7 will do the tasks
"BLD",7389,1,403,0)
listed below.  This post-install will be tasked and may take several
"BLD",7389,1,404,0)
hours to run.  The post-install routine BPS01P7 is being left on the 
"BLD",7389,1,405,0)
system after the install.  They will be deleted with a future patch.
"BLD",7389,4,0)
^9.64PA^^
"BLD",7389,6)
9^
"BLD",7389,6.3)
31
"BLD",7389,"KRN",0)
^9.67PA^8989.52^19
"BLD",7389,"KRN",.4,0)
.4
"BLD",7389,"KRN",.401,0)
.401
"BLD",7389,"KRN",.402,0)
.402
"BLD",7389,"KRN",.403,0)
.403
"BLD",7389,"KRN",.5,0)
.5
"BLD",7389,"KRN",.84,0)
.84
"BLD",7389,"KRN",3.6,0)
3.6
"BLD",7389,"KRN",3.8,0)
3.8
"BLD",7389,"KRN",9.2,0)
9.2
"BLD",7389,"KRN",9.8,0)
9.8
"BLD",7389,"KRN",9.8,"NM",0)
^9.68A^6^6
"BLD",7389,"KRN",9.8,"NM",1,0)
PSXRPPL^^0^B63013526
"BLD",7389,"KRN",9.8,"NM",2,0)
PSXRPPL1^^0^B52609779
"BLD",7389,"KRN",9.8,"NM",3,0)
PSXBPSUT^^0^B5782836
"BLD",7389,"KRN",9.8,"NM",4,0)
PSXBPSRP^^0^B78524997
"BLD",7389,"KRN",9.8,"NM",5,0)
PSXBPSR1^^0^B14975439
"BLD",7389,"KRN",9.8,"NM",6,0)
PSXRPPL2^^0^B46802908
"BLD",7389,"KRN",9.8,"NM","B","PSXBPSR1",5)

"BLD",7389,"KRN",9.8,"NM","B","PSXBPSRP",4)

"BLD",7389,"KRN",9.8,"NM","B","PSXBPSUT",3)

"BLD",7389,"KRN",9.8,"NM","B","PSXRPPL",1)

"BLD",7389,"KRN",9.8,"NM","B","PSXRPPL1",2)

"BLD",7389,"KRN",9.8,"NM","B","PSXRPPL2",6)

"BLD",7389,"KRN",19,0)
19
"BLD",7389,"KRN",19.1,0)
19.1
"BLD",7389,"KRN",101,0)
101
"BLD",7389,"KRN",409.61,0)
409.61
"BLD",7389,"KRN",771,0)
771
"BLD",7389,"KRN",870,0)
870
"BLD",7389,"KRN",8989.51,0)
8989.51
"BLD",7389,"KRN",8989.52,0)
8989.52
"BLD",7389,"KRN",8994,0)
8994
"BLD",7389,"KRN","B",.4,.4)

"BLD",7389,"KRN","B",.401,.401)

"BLD",7389,"KRN","B",.402,.402)

"BLD",7389,"KRN","B",.403,.403)

"BLD",7389,"KRN","B",.5,.5)

"BLD",7389,"KRN","B",.84,.84)

"BLD",7389,"KRN","B",3.6,3.6)

"BLD",7389,"KRN","B",3.8,3.8)

"BLD",7389,"KRN","B",9.2,9.2)

"BLD",7389,"KRN","B",9.8,9.8)

"BLD",7389,"KRN","B",19,19)

"BLD",7389,"KRN","B",19.1,19.1)

"BLD",7389,"KRN","B",101,101)

"BLD",7389,"KRN","B",409.61,409.61)

"BLD",7389,"KRN","B",771,771)

"BLD",7389,"KRN","B",870,870)

"BLD",7389,"KRN","B",8989.51,8989.51)

"BLD",7389,"KRN","B",8989.52,8989.52)

"BLD",7389,"KRN","B",8994,8994)

"BLD",7389,"QUES",0)
^9.62^^
"BLD",7389,"REQB",0)
^9.611^2^2
"BLD",7389,"REQB",1,0)
PSX*2.0*66^2
"BLD",7389,"REQB",2,0)
PSX*2.0*63^2
"BLD",7389,"REQB","B","PSX*2.0*63",2)

"BLD",7389,"REQB","B","PSX*2.0*66",1)

"MBREQ")
0
"PKG",519,-1)
1^1
"PKG",519,0)
CMOP^PSX^Consolidated Mail Outpatient Pharmacy
"PKG",519,22,0)
^9.49I^1^1
"PKG",519,22,1,0)
2.0^2970411^2970412^1
"PKG",519,22,1,"PAH",1,0)
65^3090513^520665224
"PKG",519,22,1,"PAH",1,1,0)
^^405^405^3090513
"PKG",519,22,1,"PAH",1,1,1,0)
This patch has enhancements which extend the capabilities of the Veterans 
"PKG",519,22,1,"PAH",1,1,2,0)
Health Information Systems and Technology Architecture (VistA) electronic 
"PKG",519,22,1,"PAH",1,1,3,0)
pharmacy (ePharmacy) billing system.  Below is a list of all the 
"PKG",519,22,1,"PAH",1,1,4,0)
applications involved in this project along with their patch number:
"PKG",519,22,1,"PAH",1,1,5,0)
 
"PKG",519,22,1,"PAH",1,1,6,0)
   APPLICATION/VERSION                                  PATCH
"PKG",519,22,1,"PAH",1,1,7,0)
   --------------------------------------------------------------
"PKG",519,22,1,"PAH",1,1,8,0)
   CONSOLIDATED MAIL OUTPATIENT PHARMACY (CMOP) V. 2.0  PSX*2*65
"PKG",519,22,1,"PAH",1,1,9,0)
   PHARMACY DATA MANAGEMENT (PDM) V. 1.0                PSS*1*131
"PKG",519,22,1,"PAH",1,1,10,0)
   OUTPATIENT PHARMACY (OP) V. 7.0                      PSO*7*289
"PKG",519,22,1,"PAH",1,1,11,0)
   INTEGRATED BILLING (IB) V. 2.0                       IB*2*384
"PKG",519,22,1,"PAH",1,1,12,0)
   ELECTRONIC CLAIMS MANAGEMENT ENGINE (ECME) V. 1.0    BPS*1*7
"PKG",519,22,1,"PAH",1,1,13,0)
 
"PKG",519,22,1,"PAH",1,1,14,0)
The last three patches (PSO*7*289, IB*2*384 and BPS*1*7) will be released 
"PKG",519,22,1,"PAH",1,1,15,0)
in the Kernel Installation and Distribution System (KIDS) multi-build 
"PKG",519,22,1,"PAH",1,1,16,0)
distribution BPS PSO IB BUNDLE 3.0.  Patches PSX*2*65 and PSS*1*131 will 
"PKG",519,22,1,"PAH",1,1,17,0)
be released as stand-alone patches.  Since there is an implementation 
"PKG",519,22,1,"PAH",1,1,18,0)
dependency between the multi-build distribution and the stand-alone 
"PKG",519,22,1,"PAH",1,1,19,0)
patches, PSX*2*65 and PSS*1*131 must be installed prior to the 
"PKG",519,22,1,"PAH",1,1,20,0)
installation of the multi-build.  For more specific instructions please 
"PKG",519,22,1,"PAH",1,1,21,0)
refer to the installation steps provided in each of the patches.
"PKG",519,22,1,"PAH",1,1,22,0)
 
"PKG",519,22,1,"PAH",1,1,23,0)
All sites should install these patches regardless of whether or not they 
"PKG",519,22,1,"PAH",1,1,24,0)
have been activated for ePharmacy by the Central Business Office (CBO).  
"PKG",519,22,1,"PAH",1,1,25,0)
After the installation of these patches, the activation status of the 
"PKG",519,22,1,"PAH",1,1,26,0)
site will not be impacted.  As before, activation of the ePharmacy 
"PKG",519,22,1,"PAH",1,1,27,0)
product will require instructions provided by the CBO.  Sites are not to 
"PKG",519,22,1,"PAH",1,1,28,0)
activate unless instructed specifically by the CBO.
"PKG",519,22,1,"PAH",1,1,29,0)
 
"PKG",519,22,1,"PAH",1,1,30,0)
This patch modifies the CMOP v2.0 application as described
"PKG",519,22,1,"PAH",1,1,31,0)
below:
"PKG",519,22,1,"PAH",1,1,32,0)
 
"PKG",519,22,1,"PAH",1,1,33,0)
 
"PKG",519,22,1,"PAH",1,1,34,0)
1.      A modification was made to allow for CMOP Suspense Date Rx's 
"PKG",519,22,1,"PAH",1,1,35,0)
picked up after midnight to be sent to ECME appropriately. When the CMOP 
"PKG",519,22,1,"PAH",1,1,36,0)
transmission starts, all Rx's in the suspense file are evaluated to see 
"PKG",519,22,1,"PAH",1,1,37,0)
if they should be submitted to ECME first and if so are submitted. Then 
"PKG",519,22,1,"PAH",1,1,38,0)
the system re-evaluates the suspense file to pull the latest list of Rx's 
"PKG",519,22,1,"PAH",1,1,39,0)
to send to CMOP using the current date and time. When the CMOP evaluation 
"PKG",519,22,1,"PAH",1,1,40,0)
runs past midnight, any Rx's with the suspense dates changed to that day 
"PKG",519,22,1,"PAH",1,1,41,0)
are sent to CMOP. However, since the ECME submission ran before midnight, 
"PKG",519,22,1,"PAH",1,1,42,0)
those Rx's would not have been sent. This modification will re-check the 
"PKG",519,22,1,"PAH",1,1,43,0)
Rx's in suspense for the new date after the CMOP transmission completes 
"PKG",519,22,1,"PAH",1,1,44,0)
in order to pick up Rx's that need to be sent to ECME after midnight.
"PKG",519,22,1,"PAH",1,1,45,0)
 
"PKG",519,22,1,"PAH",1,1,46,0)
2.      New functionality was added to prevent prescriptions from being 
"PKG",519,22,1,"PAH",1,1,47,0)
filled/sent to CMOP when a host processing error occurs when a claim is 
"PKG",519,22,1,"PAH",1,1,48,0)
submitted through ECME. The host processing errors are identified by 
"PKG",519,22,1,"PAH",1,1,49,0)
reject codes M6, M8, NN, and 99. The following conditions apply when this 
"PKG",519,22,1,"PAH",1,1,50,0)
scenario occurs.
"PKG",519,22,1,"PAH",1,1,51,0)
a.      The transmission of the Rx/fill will be delayed 1 day in hopes 
"PKG",519,22,1,"PAH",1,1,52,0)
that the host processing issues will be resolved.
"PKG",519,22,1,"PAH",1,1,53,0)
b.      An activity log entry will be defined to state the date/time 
"PKG",519,22,1,"PAH",1,1,54,0)
along with a comment stating that the Rx/fill was left in suspense hold 
"PKG",519,22,1,"PAH",1,1,55,0)
due to a host processing error.
"PKG",519,22,1,"PAH",1,1,56,0)
c.      This added functionality does not include the Pull Early from 
"PKG",519,22,1,"PAH",1,1,57,0)
Suspense function.
"PKG",519,22,1,"PAH",1,1,58,0)
 
"PKG",519,22,1,"PAH",1,1,59,0)
3.      New functionality was added to the Print from Suspense File [PSO 
"PKG",519,22,1,"PAH",1,1,60,0)
PNDLBL] option to prevent prescriptions from being pulled early from 
"PKG",519,22,1,"PAH",1,1,61,0)
suspense until 3/4 of the days supply of the Rx/fill has elapsed.
"PKG",519,22,1,"PAH",1,1,62,0)
 
"PKG",519,22,1,"PAH",1,1,63,0)
4.      The 'CMOP/ECME Activity Report' [BPS RPT CMOP/ECME ACTIVITY] has 
"PKG",519,22,1,"PAH",1,1,64,0)
been modified. 
"PKG",519,22,1,"PAH",1,1,65,0)
a.      The CMOP-STATUS column will display 'D' for Dispense or 'T' for 
"PKG",519,22,1,"PAH",1,1,66,0)
Transmit instead of partially spelling out the status.
"PKG",519,22,1,"PAH",1,1,67,0)
b.      A prompt will be added to select detailed or summary 
"PKG",519,22,1,"PAH",1,1,68,0)
information.  Detailed information will reflect what is currently 
"PKG",519,22,1,"PAH",1,1,69,0)
displayed.  Summary information will shorten the batch header section of 
"PKG",519,22,1,"PAH",1,1,70,0)
the report.
"PKG",519,22,1,"PAH",1,1,71,0)
c.      A prompt will be added to select a list of patients (or ^ALL).  
"PKG",519,22,1,"PAH",1,1,72,0)
Only patients on the list will be included in the detail.
"PKG",519,22,1,"PAH",1,1,73,0)
d.      The division prompt will be modified to be consistent with other 
"PKG",519,22,1,"PAH",1,1,74,0)
ECME options, i.e., the selection prompt will show 'A ALL DIVISIONS' 
"PKG",519,22,1,"PAH",1,1,75,0)
first, 'S SELECT DIVISIONS' second, and will roll into particular 
"PKG",519,22,1,"PAH",1,1,76,0)
divisions if the user selects an 'S'.
"PKG",519,22,1,"PAH",1,1,77,0)
e.      A prompt will be added to select released, unreleased, or all 
"PKG",519,22,1,"PAH",1,1,78,0)
prescriptions.
"PKG",519,22,1,"PAH",1,1,79,0)
f.      Detailed reports will only display information from batches that 
"PKG",519,22,1,"PAH",1,1,80,0)
have ECME Rxs.
"PKG",519,22,1,"PAH",1,1,81,0)
g.      Header information will be centered. 
"PKG",519,22,1,"PAH",1,1,82,0)
5.
"PKG",519,22,1,"PAH",1,1,83,0)
 
"PKG",519,22,1,"PAH",1,1,84,0)
 
"PKG",519,22,1,"PAH",1,1,85,0)
 
"PKG",519,22,1,"PAH",1,1,86,0)
 
"PKG",519,22,1,"PAH",1,1,87,0)
This patch addresses the following New Service Request (NSR):
"PKG",519,22,1,"PAH",1,1,88,0)
-------------------------------------------------------------
"PKG",519,22,1,"PAH",1,1,89,0)
There is no NSR associated with this patch.
"PKG",519,22,1,"PAH",1,1,90,0)
 
"PKG",519,22,1,"PAH",1,1,91,0)
 
"PKG",519,22,1,"PAH",1,1,92,0)
This patch addresses the following Remedy Ticket(s):
"PKG",519,22,1,"PAH",1,1,93,0)
----------------------------------------------------
"PKG",519,22,1,"PAH",1,1,94,0)
There is no Remedy Tickets associated with this patch.
"PKG",519,22,1,"PAH",1,1,95,0)
 
"PKG",519,22,1,"PAH",1,1,96,0)
 
"PKG",519,22,1,"PAH",1,1,97,0)
 
"PKG",519,22,1,"PAH",1,1,98,0)
Overview of Remedy Ticket(s):
"PKG",519,22,1,"PAH",1,1,99,0)
-----------------------------
"PKG",519,22,1,"PAH",1,1,100,0)
 
"PKG",519,22,1,"PAH",1,1,101,0)
 
"PKG",519,22,1,"PAH",1,1,102,0)
 
"PKG",519,22,1,"PAH",1,1,103,0)
Components Sent With Patch
"PKG",519,22,1,"PAH",1,1,104,0)
--------------------------
"PKG",519,22,1,"PAH",1,1,105,0)
The following is a list of files included in this patch:
"PKG",519,22,1,"PAH",1,1,106,0)
 
"PKG",519,22,1,"PAH",1,1,107,0)
                                          UP    SEND  DATA
"PKG",519,22,1,"PAH",1,1,108,0)
                                          DATE  SEC.  COMES  SITE   RSLV
"PKG",519,22,1,"PAH",1,1,109,0)
FILE #        NAME                        DD    CODE  W/FILE DATA   PTS
"PKG",519,22,1,"PAH",1,1,110,0)
-----------------------------------------------------------------------
"PKG",519,22,1,"PAH",1,1,111,0)
 
"PKG",519,22,1,"PAH",1,1,112,0)
 
"PKG",519,22,1,"PAH",1,1,113,0)
The following is a list of files deleted in this patch:
"PKG",519,22,1,"PAH",1,1,114,0)
 
"PKG",519,22,1,"PAH",1,1,115,0)
FILE #        NAME
"PKG",519,22,1,"PAH",1,1,116,0)
-------------------------------------
"PKG",519,22,1,"PAH",1,1,117,0)
 
"PKG",519,22,1,"PAH",1,1,118,0)
 
"PKG",519,22,1,"PAH",1,1,119,0)
The following is a list of sub-files and related fields deleted in this 
"PKG",519,22,1,"PAH",1,1,120,0)
patch:
"PKG",519,22,1,"PAH",1,1,121,0)
 
"PKG",519,22,1,"PAH",1,1,122,0)
Subfile Name (Number)                 File Name (Number)
"PKG",519,22,1,"PAH",1,1,123,0)
  Field Name (Number)
"PKG",519,22,1,"PAH",1,1,124,0)
---------------------                 ---------------------
"PKG",519,22,1,"PAH",1,1,125,0)
 
"PKG",519,22,1,"PAH",1,1,126,0)
 
"PKG",519,22,1,"PAH",1,1,127,0)
The following is a list of fields included in this patch:
"PKG",519,22,1,"PAH",1,1,128,0)
 
"PKG",519,22,1,"PAH",1,1,129,0)
Field Name (Number)                   File Name (Number)
"PKG",519,22,1,"PAH",1,1,130,0)
                                      Subfile Name (Number)
"PKG",519,22,1,"PAH",1,1,131,0)
-------------------                   ------------------
"PKG",519,22,1,"PAH",1,1,132,0)
CERTIFICATION IEN (902.23)            BPS TRANSACTIONS (9002313.59)
"PKG",519,22,1,"PAH",1,1,133,0)
 
"PKG",519,22,1,"PAH",1,1,134,0)
 
"PKG",519,22,1,"PAH",1,1,135,0)
The following is a list of fields deleted in this patch:
"PKG",519,22,1,"PAH",1,1,136,0)
 
"PKG",519,22,1,"PAH",1,1,137,0)
Field Name (Number)                   File Name (Number)
"PKG",519,22,1,"PAH",1,1,138,0)
                                      Subfile Name (Number)
"PKG",519,22,1,"PAH",1,1,139,0)
-------------------                   ------------------
"PKG",519,22,1,"PAH",1,1,140,0)
 
"PKG",519,22,1,"PAH",1,1,141,0)
 
"PKG",519,22,1,"PAH",1,1,142,0)
The following is a list of print templates deleted in this patch:
"PKG",519,22,1,"PAH",1,1,143,0)
 
"PKG",519,22,1,"PAH",1,1,144,0)
Template Name               File Name (Number)
"PKG",519,22,1,"PAH",1,1,145,0)
-------------               ------------------
"PKG",519,22,1,"PAH",1,1,146,0)
 
"PKG",519,22,1,"PAH",1,1,147,0)
 
"PKG",519,22,1,"PAH",1,1,148,0)
The following is a list of sort templates deleted in this patch:
"PKG",519,22,1,"PAH",1,1,149,0)
 
"PKG",519,22,1,"PAH",1,1,150,0)
Template Name                File Name (Number)
"PKG",519,22,1,"PAH",1,1,151,0)
-------------                ------------------
"PKG",519,22,1,"PAH",1,1,152,0)
 
"PKG",519,22,1,"PAH",1,1,153,0)
 
"PKG",519,22,1,"PAH",1,1,154,0)
The following is a list of list templates included in this patch:
"PKG",519,22,1,"PAH",1,1,155,0)
 
"PKG",519,22,1,"PAH",1,1,156,0)
Template Name
"PKG",519,22,1,"PAH",1,1,157,0)
-------------
"PKG",519,22,1,"PAH",1,1,158,0)
 
"PKG",519,22,1,"PAH",1,1,159,0)
 
"PKG",519,22,1,"PAH",1,1,160,0)
The following is a list of options included in this patch:
"PKG",519,22,1,"PAH",1,1,161,0)
 
"PKG",519,22,1,"PAH",1,1,162,0)
Option Name                  Type               New/Modified
"PKG",519,22,1,"PAH",1,1,163,0)
-----------                  ----               ------------
"PKG",519,22,1,"PAH",1,1,164,0)
 
"PKG",519,22,1,"PAH",1,1,165,0)
 
"PKG",519,22,1,"PAH",1,1,166,0)
The following is a list of protocols included in this patch:
"PKG",519,22,1,"PAH",1,1,167,0)
 
"PKG",519,22,1,"PAH",1,1,168,0)
Protocol Name
"PKG",519,22,1,"PAH",1,1,169,0)
-----------
"PKG",519,22,1,"PAH",1,1,170,0)
 
"PKG",519,22,1,"PAH",1,1,171,0)
 
"PKG",519,22,1,"PAH",1,1,172,0)
The following is a list of forms deleted in this patch:
"PKG",519,22,1,"PAH",1,1,173,0)
 
"PKG",519,22,1,"PAH",1,1,174,0)
Template Name               File Name (Number)
"PKG",519,22,1,"PAH",1,1,175,0)
-------------               ------------------
"PKG",519,22,1,"PAH",1,1,176,0)
 
"PKG",519,22,1,"PAH",1,1,177,0)
 
"PKG",519,22,1,"PAH",1,1,178,0)
 
"PKG",519,22,1,"PAH",1,1,179,0)
Documentation Retrieval:
"PKG",519,22,1,"PAH",1,1,180,0)
========================
"PKG",519,22,1,"PAH",1,1,181,0)
Sites may retrieve documentation in one of the following ways:
"PKG",519,22,1,"PAH",1,1,182,0)
 
"PKG",519,22,1,"PAH",1,1,183,0)
 1.  The preferred method is to FTP the files from 
"PKG",519,22,1,"PAH",1,1,184,0)
     download.vista.med.va.gov, which will transmit the files from the
"PKG",519,22,1,"PAH",1,1,185,0)
     first available FTP server.
"PKG",519,22,1,"PAH",1,1,186,0)
 
"PKG",519,22,1,"PAH",1,1,187,0)
 2.  Sites may also elect to retrieve documentation directly from a 
"PKG",519,22,1,"PAH",1,1,188,0)
     specific server as follows:
"PKG",519,22,1,"PAH",1,1,189,0)
 
"PKG",519,22,1,"PAH",1,1,190,0)
     Albany          ftp.fo-albany.med.va.gov
"PKG",519,22,1,"PAH",1,1,191,0)
     Hines           ftp.fo-hines.med.va.gov
"PKG",519,22,1,"PAH",1,1,192,0)
     Salt Lake City  ftp.fo-slc.med.va.gov
"PKG",519,22,1,"PAH",1,1,193,0)
 
"PKG",519,22,1,"PAH",1,1,194,0)
 3.  Documentation can also be retrieved from the VistA Documentation 
"PKG",519,22,1,"PAH",1,1,195,0)
     Library (VDL) on the Internet at the following address,
"PKG",519,22,1,"PAH",1,1,196,0)
     http://www.va.gov/vdl.
"PKG",519,22,1,"PAH",1,1,197,0)
 
"PKG",519,22,1,"PAH",1,1,198,0)
The documentation distribution includes:
"PKG",519,22,1,"PAH",1,1,199,0)
 
"PKG",519,22,1,"PAH",1,1,200,0)
    FILE NAME                             DESCRIPTION
"PKG",519,22,1,"PAH",1,1,201,0)
    
"PKG",519,22,1,"PAH",1,1,202,0)
    ---------------------------------------------------------------------
"PKG",519,22,1,"PAH",1,1,203,0)
 
"PKG",519,22,1,"PAH",1,1,204,0)
 
"PKG",519,22,1,"PAH",1,1,205,0)
 
"PKG",519,22,1,"PAH",1,1,206,0)
 
"PKG",519,22,1,"PAH",1,1,207,0)
Test Sites:
"PKG",519,22,1,"PAH",1,1,208,0)
===========
"PKG",519,22,1,"PAH",1,1,209,0)
 
"PKG",519,22,1,"PAH",1,1,210,0)
 
"PKG",519,22,1,"PAH",1,1,211,0)
 
"PKG",519,22,1,"PAH",1,1,212,0)
 
"PKG",519,22,1,"PAH",1,1,213,0)
       ================INSTALLATION INSTRUCTIONS =================
"PKG",519,22,1,"PAH",1,1,214,0)
 
"PKG",519,22,1,"PAH",1,1,215,0)
To avoid disruptions, these patches should be installed when users are 
"PKG",519,22,1,"PAH",1,1,216,0)
not on the system and during non-peak hours.  Of particular concern would 
"PKG",519,22,1,"PAH",1,1,217,0)
be the items below.
"PKG",519,22,1,"PAH",1,1,218,0)
 
"PKG",519,22,1,"PAH",1,1,219,0)
    1.  Do not install the patch when ECME claims are being generated
"PKG",519,22,1,"PAH",1,1,220,0)
        by the BPS Nightly Background Job option [BPS NIGHTLY
"PKG",519,22,1,"PAH",1,1,221,0)
        BACKGROUND JOB].  Wait for this job to finish or complete the
"PKG",519,22,1,"PAH",1,1,222,0)
        installation before this job starts.
"PKG",519,22,1,"PAH",1,1,223,0)
    2.  Do not install the patch when prescriptions are being 
"PKG",519,22,1,"PAH",1,1,224,0)
        transmitted to CMOP.  Wait for the CMOP transmission to finish 
"PKG",519,22,1,"PAH",1,1,225,0)
        or complete the installation before the transmission starts.  
"PKG",519,22,1,"PAH",1,1,226,0)
        Check with Pharmacy Service or your pharmacy Automated Data
"PKG",519,22,1,"PAH",1,1,227,0)
        Processing Application Coordinator (ADPAC) to find out when
"PKG",519,22,1,"PAH",1,1,228,0)
        CMOP transmissions occur.
"PKG",519,22,1,"PAH",1,1,229,0)
    3.  In addition, note that you will be prompted to disable the
"PKG",519,22,1,"PAH",1,1,230,0)
        following options during the installation:
"PKG",519,22,1,"PAH",1,1,231,0)
 
"PKG",519,22,1,"PAH",1,1,232,0)
 
"PKG",519,22,1,"PAH",1,1,233,0)
 
"PKG",519,22,1,"PAH",1,1,234,0)
 
"PKG",519,22,1,"PAH",1,1,235,0)
Install Time - Approximately 30 minutes
"PKG",519,22,1,"PAH",1,1,236,0)
 
"PKG",519,22,1,"PAH",1,1,237,0)
 
"PKG",519,22,1,"PAH",1,1,238,0)
 
"PKG",519,22,1,"PAH",1,1,239,0)
1.  OBTAIN PATCHES
"PKG",519,22,1,"PAH",1,1,240,0)
    --------------
"PKG",519,22,1,"PAH",1,1,241,0)
    Patches PSX*2*65 and PSS*1*131 will be sent to your system upon
"PKG",519,22,1,"PAH",1,1,242,0)
    release from the National Patch Module.
"PKG",519,22,1,"PAH",1,1,243,0)
 
"PKG",519,22,1,"PAH",1,1,244,0)
    Obtain the host file BPS_1_7_PSO_IB.KID, which contains the following
"PKG",519,22,1,"PAH",1,1,245,0)
    three patch installs:
"PKG",519,22,1,"PAH",1,1,246,0)
 
"PKG",519,22,1,"PAH",1,1,247,0)
        BPS*1.0*7
"PKG",519,22,1,"PAH",1,1,248,0)
        PSO*7.0*289
"PKG",519,22,1,"PAH",1,1,249,0)
        IB*2.0*384
"PKG",519,22,1,"PAH",1,1,250,0)
 
"PKG",519,22,1,"PAH",1,1,251,0)
     Sites can retrieve VistA software from the following FTP addresses.
"PKG",519,22,1,"PAH",1,1,252,0)
     The preferred method is to FTP the files from:
"PKG",519,22,1,"PAH",1,1,253,0)
 
"PKG",519,22,1,"PAH",1,1,254,0)
                    download.vista.med.va.gov
"PKG",519,22,1,"PAH",1,1,255,0)
 
"PKG",519,22,1,"PAH",1,1,256,0)
     This will transmit the files from the first available FTP server.
"PKG",519,22,1,"PAH",1,1,257,0)
     Sites may also elect to retrieve software directly from a specific
"PKG",519,22,1,"PAH",1,1,258,0)
     server as follows:
"PKG",519,22,1,"PAH",1,1,259,0)
 
"PKG",519,22,1,"PAH",1,1,260,0)
       Albany                  ftp.fo-albany.med.va.gov
"PKG",519,22,1,"PAH",1,1,261,0)
       Hines                   ftp.fo-hines.med.va.gov
"PKG",519,22,1,"PAH",1,1,262,0)
       Salt Lake City          ftp.fo-slc.med.va.gov
"PKG",519,22,1,"PAH",1,1,263,0)
 
"PKG",519,22,1,"PAH",1,1,264,0)
     The BPS_1_7_PSO_IB.KID host file is located in the anonymous.software
"PKG",519,22,1,"PAH",1,1,265,0)
     directory.  Use ASCII Mode when downloading the file.
"PKG",519,22,1,"PAH",1,1,266,0)
 
"PKG",519,22,1,"PAH",1,1,267,0)
2.  LOAD TRANSPORT GLOBAL FOR STAND-ALONE PATCHES
"PKG",519,22,1,"PAH",1,1,268,0)
    ---------------------------------------------
"PKG",519,22,1,"PAH",1,1,269,0)
    For patches PSX*2*65 and PSS*1*131, choose the PackMan message
"PKG",519,22,1,"PAH",1,1,270,0)
    containing each of these patches and invoke the INSTALL/CHECK MESSAGE
"PKG",519,22,1,"PAH",1,1,271,0)
    PackMan option.
"PKG",519,22,1,"PAH",1,1,272,0)
 
"PKG",519,22,1,"PAH",1,1,273,0)
3.  START UP KIDS
"PKG",519,22,1,"PAH",1,1,274,0)
    -------------
"PKG",519,22,1,"PAH",1,1,275,0)
    Start up the Kernel Installation and Distribution System Menu option
"PKG",519,22,1,"PAH",1,1,276,0)
    [XPD MAIN]:
"PKG",519,22,1,"PAH",1,1,277,0)
 
"PKG",519,22,1,"PAH",1,1,278,0)
         Edits and Distribution ...
"PKG",519,22,1,"PAH",1,1,279,0)
         Utilities ...
"PKG",519,22,1,"PAH",1,1,280,0)
         Installation ...
"PKG",519,22,1,"PAH",1,1,281,0)
 
"PKG",519,22,1,"PAH",1,1,282,0)
    Select Kernel Installation & Distribution System Option: INStallation
"PKG",519,22,1,"PAH",1,1,283,0)
                                                             ---
"PKG",519,22,1,"PAH",1,1,284,0)
         Load a Distribution
"PKG",519,22,1,"PAH",1,1,285,0)
         Print Transport Global
"PKG",519,22,1,"PAH",1,1,286,0)
         Compare Transport Global to Current System
"PKG",519,22,1,"PAH",1,1,287,0)
         Verify Checksums in Transport Global
"PKG",519,22,1,"PAH",1,1,288,0)
         Install Package(s)
"PKG",519,22,1,"PAH",1,1,289,0)
         Restart Install of Package(s)
"PKG",519,22,1,"PAH",1,1,290,0)
         Unload a Distribution
"PKG",519,22,1,"PAH",1,1,291,0)
         Backup a Transport Global
"PKG",519,22,1,"PAH",1,1,292,0)
 
"PKG",519,22,1,"PAH",1,1,293,0)
    Select Installation Option:
"PKG",519,22,1,"PAH",1,1,294,0)
 
"PKG",519,22,1,"PAH",1,1,295,0)
4.  RUN OPTIONAL INSTALLATION OPTIONS FOR STAND-ALONE PATCHES
"PKG",519,22,1,"PAH",1,1,296,0)
    ---------------------------------------------------------
"PKG",519,22,1,"PAH",1,1,297,0)
    From the Installation menu, you may select to use the following
"PKG",519,22,1,"PAH",1,1,298,0)
    options (when prompted for the INSTALL NAME, enter each of the
"PKG",519,22,1,"PAH",1,1,299,0)
    stand-alone patches (PSX*2.0*65 and PSS*1.0*131)):
"PKG",519,22,1,"PAH",1,1,300,0)
 
"PKG",519,22,1,"PAH",1,1,301,0)
    a.  Backup a Transport Global - This option will create a backup
"PKG",519,22,1,"PAH",1,1,302,0)
        message of any routines exported with this patch.  It will not
"PKG",519,22,1,"PAH",1,1,303,0)
        backup any other changes such as Database Definitions (DD's) or
"PKG",519,22,1,"PAH",1,1,304,0)
        templates.
"PKG",519,22,1,"PAH",1,1,305,0)
    b.  Compare Transport Global to Current System - This option will
"PKG",519,22,1,"PAH",1,1,306,0)
        allow you to view all changes that will be made when this patch
"PKG",519,22,1,"PAH",1,1,307,0)
        is installed.  It compares all components of this patch
"PKG",519,22,1,"PAH",1,1,308,0)
        (routines, DD's, templates, etc.).
"PKG",519,22,1,"PAH",1,1,309,0)
    c.  Verify Checksums in Transport Global - This option will allow
"PKG",519,22,1,"PAH",1,1,310,0)
        you to ensure the integrity of the routines that are in the
"PKG",519,22,1,"PAH",1,1,311,0)
        transport global.
"PKG",519,22,1,"PAH",1,1,312,0)
 
"PKG",519,22,1,"PAH",1,1,313,0)
5.  INSTALL STAND-ALONE PATCHES
"PKG",519,22,1,"PAH",1,1,314,0)
    ---------------------------
"PKG",519,22,1,"PAH",1,1,315,0)
    This is the step to start the installation of this KIDS patch.  This
"PKG",519,22,1,"PAH",1,1,316,0)
    will need to be run for each of the stand-alone patches (PSX*2*65 and
"PKG",519,22,1,"PAH",1,1,317,0)
    PSS*1*131).
"PKG",519,22,1,"PAH",1,1,318,0)
 
"PKG",519,22,1,"PAH",1,1,319,0)
    a.  Choose the Install Package(s) option to start the patch
"PKG",519,22,1,"PAH",1,1,320,0)
        install.
"PKG",519,22,1,"PAH",1,1,321,0)
    b.  When prompted for the "Select INSTALL NAME:", enter the patch
"PKG",519,22,1,"PAH",1,1,322,0)
        name.
"PKG",519,22,1,"PAH",1,1,323,0)
    c.  When prompted "Want KIDS to INHIBIT LOGONs during the install?
"PKG",519,22,1,"PAH",1,1,324,0)
        YES//" answer NO.
"PKG",519,22,1,"PAH",1,1,325,0)
    d.  When prompted "Want to DISABLE Scheduled Options, Menu
"PKG",519,22,1,"PAH",1,1,326,0)
        Options, and Protocols? YES//" answer NO.
"PKG",519,22,1,"PAH",1,1,327,0)
    e.  When prompted, "Device: Home//" respond with the correct device.
"PKG",519,22,1,"PAH",1,1,328,0)
 
"PKG",519,22,1,"PAH",1,1,329,0)
6.  LOAD TRANSPORT GLOBAL FOR MULTI-BUILD
"PKG",519,22,1,"PAH",1,1,330,0)
    -------------------------------------
"PKG",519,22,1,"PAH",1,1,331,0)
    After the installation of the stand-alone patches is complete, return
"PKG",519,22,1,"PAH",1,1,332,0)
    to the Installation menu.
"PKG",519,22,1,"PAH",1,1,333,0)
 
"PKG",519,22,1,"PAH",1,1,334,0)
    From the Installation menu, select the Load a Distribution option.
"PKG",519,22,1,"PAH",1,1,335,0)
 
"PKG",519,22,1,"PAH",1,1,336,0)
    When prompted for "Enter a Host File:", enter the full directory path
"PKG",519,22,1,"PAH",1,1,337,0)
    where you saved the host file BPS_1_7_PSO_IB.KID (e.g.,
"PKG",519,22,1,"PAH",1,1,338,0)
    SYS$SYSDEVICE:[ANONYMOUS]BPS_1_7_PSO_IB.KID).
"PKG",519,22,1,"PAH",1,1,339,0)
 
"PKG",519,22,1,"PAH",1,1,340,0)
    When prompted for "OK to continue with Load? NO//", enter "YES."
"PKG",519,22,1,"PAH",1,1,341,0)
 
"PKG",519,22,1,"PAH",1,1,342,0)
    The following will display:
"PKG",519,22,1,"PAH",1,1,343,0)
 
"PKG",519,22,1,"PAH",1,1,344,0)
      Loading Distribution...
"PKG",519,22,1,"PAH",1,1,345,0)
 
"PKG",519,22,1,"PAH",1,1,346,0)
        BPS PSO IB BUNDLE 3.0
"PKG",519,22,1,"PAH",1,1,347,0)
        BPS*1.0*7
"PKG",519,22,1,"PAH",1,1,348,0)
        PSO*7.0*289
"PKG",519,22,1,"PAH",1,1,349,0)
        IB*2.0*384
"PKG",519,22,1,"PAH",1,1,350,0)
      Use INSTALL NAME: BPS PSO IB BUNDLE 3.0 to install this
"PKG",519,22,1,"PAH",1,1,351,0)
      Distribution.
"PKG",519,22,1,"PAH",1,1,352,0)
 
"PKG",519,22,1,"PAH",1,1,353,0)
7.  RUN OPTIONAL INSTALLATION OPTIONS FOR MULTI-BUILD
"PKG",519,22,1,"PAH",1,1,354,0)
    -------------------------------------------------
"PKG",519,22,1,"PAH",1,1,355,0)
    From the Installation menu, you may select to use the following
"PKG",519,22,1,"PAH",1,1,356,0)
    options (when prompted for the INSTALL NAME, enter
"PKG",519,22,1,"PAH",1,1,357,0)
    BPS PSO IB BUNDLE 3.0):
"PKG",519,22,1,"PAH",1,1,358,0)
 
"PKG",519,22,1,"PAH",1,1,359,0)
    a.  Backup a Transport Global - This option will create a backup
"PKG",519,22,1,"PAH",1,1,360,0)
        message of any routines exported with this patch.  It will not
"PKG",519,22,1,"PAH",1,1,361,0)
        backup any other changes such as DD's or templates.
"PKG",519,22,1,"PAH",1,1,362,0)
    b.  Compare Transport Global to Current System - This option will
"PKG",519,22,1,"PAH",1,1,363,0)
        allow you to view all changes that will be made when this patch
"PKG",519,22,1,"PAH",1,1,364,0)
        is installed.  It compares all components of this patch
"PKG",519,22,1,"PAH",1,1,365,0)
        (routines, DD's, templates, etc.).
"PKG",519,22,1,"PAH",1,1,366,0)
    c.  Verify Checksums in Transport Global - This option will allow
"PKG",519,22,1,"PAH",1,1,367,0)
        you to ensure the integrity of the routines that are in the
"PKG",519,22,1,"PAH",1,1,368,0)
        transport global.
"PKG",519,22,1,"PAH",1,1,369,0)
 
"PKG",519,22,1,"PAH",1,1,370,0)
8.  INSTALL MULTI-BUILD
"PKG",519,22,1,"PAH",1,1,371,0)
    -------------------
"PKG",519,22,1,"PAH",1,1,372,0)
    This is the step to start the installation of this KIDS patch.  This
"PKG",519,22,1,"PAH",1,1,373,0)
    will need to be run for the BPS PSO IB BUNDLE 3.0.
"PKG",519,22,1,"PAH",1,1,374,0)
    
"PKG",519,22,1,"PAH",1,1,375,0)
    a.  Choose the Install Package(s) option to start the patch
"PKG",519,22,1,"PAH",1,1,376,0)
        install.
"PKG",519,22,1,"PAH",1,1,377,0)
    b.  When prompted for the "Select INSTALL NAME:", enter BPS PSO IB
"PKG",519,22,1,"PAH",1,1,378,0)
        BUNDLE 3.0.
"PKG",519,22,1,"PAH",1,1,379,0)
    c.  For the BPS*1*7 patch, when prompted "Want KIDS to Rebuild Menu
"PKG",519,22,1,"PAH",1,1,380,0)
        Trees Upon Completion of Install? YES//"  enter YES unless your
"PKG",519,22,1,"PAH",1,1,381,0)
        system does this in a nightly TaskMan process.
"PKG",519,22,1,"PAH",1,1,382,0)
    d.  For the PSO*7*289 patch, when prompted "Want KIDS to Rebuild Menu
"PKG",519,22,1,"PAH",1,1,383,0)
        Trees Upon Completion of Install? YES//"  enter YES unless your
"PKG",519,22,1,"PAH",1,1,384,0)
        system does this in a nightly TaskMan process.
"PKG",519,22,1,"PAH",1,1,385,0)
    e.  When prompted "Want KIDS to INHIBIT LOGONs during the
"PKG",519,22,1,"PAH",1,1,386,0)
        install? YES//"  enter NO.
"PKG",519,22,1,"PAH",1,1,387,0)
    f.  When prompted "Want to DISABLE Scheduled Options, Menu Options,
"PKG",519,22,1,"PAH",1,1,388,0)
        and Protocols? YES//"  enter YES.
"PKG",519,22,1,"PAH",1,1,389,0)
    g.  When prompted "Enter options you wish to mark as 'Out Of
"PKG",519,22,1,"PAH",1,1,390,0)
        Order':"  enter the following options:
"PKG",519,22,1,"PAH",1,1,391,0)
 
"PKG",519,22,1,"PAH",1,1,392,0)
    h.  When prompted "Enter protocols you wish to mark as 'Out Of
"PKG",519,22,1,"PAH",1,1,393,0)
        Order':"  enter <return>.
"PKG",519,22,1,"PAH",1,1,394,0)
    i.  When prompted "Delay Install (Minutes):  (0-60): 0//"  enter an
"PKG",519,22,1,"PAH",1,1,395,0)
        appropriate number of minutes to delay the installation in 
"PKG",519,22,1,"PAH",1,1,396,0)
        order to give users enough time to exit the disabled options
"PKG",519,22,1,"PAH",1,1,397,0)
        before the installation starts.
"PKG",519,22,1,"PAH",1,1,398,0)
    j.  When prompted "Device: Home//"  respond with the correct device.
"PKG",519,22,1,"PAH",1,1,399,0)
 
"PKG",519,22,1,"PAH",1,1,400,0)
 
"PKG",519,22,1,"PAH",1,1,401,0)
 
"PKG",519,22,1,"PAH",1,1,402,0)
The BPS post-install routine delivered with BPS*1*7 will do the tasks
"PKG",519,22,1,"PAH",1,1,403,0)
listed below.  This post-install will be tasked and may take several
"PKG",519,22,1,"PAH",1,1,404,0)
hours to run.  The post-install routine BPS01P7 is being left on the 
"PKG",519,22,1,"PAH",1,1,405,0)
system after the install.  They will be deleted with a future patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","PSXBPSR1")
0^5^B14975439^n/a
"RTN","PSXBPSR1",1,0)
PSXBPSR1 ;BHAM ISC/MFR - CMOP/ECME ACTIVITY REPORT - continuation ;09/01/2006
"RTN","PSXBPSR1",2,0)
 ;;2.0;CMOP;**65**;11 Apr 97;Build 31
"RTN","PSXBPSR1",3,0)
 ;External reference to ^PSRX( supported by IA #1221
"RTN","PSXBPSR1",4,0)
 ;External reference to ^PS(59 supported by IA #1976
"RTN","PSXBPSR1",5,0)
 ;External reference to ^PSOBPSUT supported by IA #4701
"RTN","PSXBPSR1",6,0)
 ;External reference to ^BPSUTIL supported by IA #4410
"RTN","PSXBPSR1",7,0)
 ;External reference to ^IBNCPDPI supported by IA #4729
"RTN","PSXBPSR1",8,0)
 ; 
"RTN","PSXBPSR1",9,0)
 ;
"RTN","PSXBPSR1",10,0)
 ; Enter Date Range
"RTN","PSXBPSR1",11,0)
 ;
"RTN","PSXBPSR1",12,0)
 ; Return Value -> P1^P2
"RTN","PSXBPSR1",13,0)
 ; 
"RTN","PSXBPSR1",14,0)
 ;           where P1 = From Date
"RTN","PSXBPSR1",15,0)
 ;                    = ^ Exit
"RTN","PSXBPSR1",16,0)
 ;                 P2 = To Date
"RTN","PSXBPSR1",17,0)
 ;                    = blank for Exit
"RTN","PSXBPSR1",18,0)
 ;                 
"RTN","PSXBPSR1",19,0)
SELDATE() N DIR,DIRUT,DTOUT,DUOUT,VAL,X,Y
"RTN","PSXBPSR1",20,0)
 S VAL=""
"RTN","PSXBPSR1",21,0)
 S DIR(0)="DA^^W:Y'=U "" (""_$$FMTE^XLFDT(Y)_"")"""
"RTN","PSXBPSR1",22,0)
 S DIR("A")="ENTER BEGINNING TRANSMISSION DATE: "
"RTN","PSXBPSR1",23,0)
 D ^DIR
"RTN","PSXBPSR1",24,0)
 ;
"RTN","PSXBPSR1",25,0)
 ;Check for "^", timeout, or blank entry
"RTN","PSXBPSR1",26,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(X)="") S VAL="^"
"RTN","PSXBPSR1",27,0)
 ;
"RTN","PSXBPSR1",28,0)
 I VAL="" D
"RTN","PSXBPSR1",29,0)
 .S $P(VAL,U)=Y
"RTN","PSXBPSR1",30,0)
 .S DIR(0)="DA^"_VAL_"^W:Y'=U "" (""_$$FMTE^XLFDT(Y)_"")"""
"RTN","PSXBPSR1",31,0)
 .S DIR("A")="ENTER ENDING TRANSMISSION DATE: "
"RTN","PSXBPSR1",32,0)
 .D ^DIR
"RTN","PSXBPSR1",33,0)
 .;
"RTN","PSXBPSR1",34,0)
 .;Check for "^", timeout, or blank entry
"RTN","PSXBPSR1",35,0)
 .I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(X)="") S VAL="^" Q
"RTN","PSXBPSR1",36,0)
 .;
"RTN","PSXBPSR1",37,0)
 .;Define Entry
"RTN","PSXBPSR1",38,0)
 .S $P(VAL,U,2)=Y
"RTN","PSXBPSR1",39,0)
 ;
"RTN","PSXBPSR1",40,0)
 Q VAL
"RTN","PSXBPSR1",41,0)
 ;
"RTN","PSXBPSR1",42,0)
 ;Select Divisions
"RTN","PSXBPSR1",43,0)
 ;
"RTN","PSXBPSR1",44,0)
 ; Returns Arrays -> DIVNM("names of divisions") = selection number
"RTN","PSXBPSR1",45,0)
 ;                   DIVDA("iens of divisions") = name of division
"RTN","PSXBPSR1",46,0)
SELDIV N DIR,DIV,DIVX,DIRUT,DUOUT,DTOUT,I,X,Y
"RTN","PSXBPSR1",47,0)
 W !!,"SELECTION OF DIVISION(S)",!
"RTN","PSXBPSR1",48,0)
 S DIV="" F I=1:1 S DIV=$O(^PS(59,"B",DIV)) Q:DIV=""  S DIVNM(I)=DIV,DIVNM(DIV)=I,DIVDA=$O(^PS(59,"B",DIV,0)),DIVNM(I,"I")=DIVDA
"RTN","PSXBPSR1",49,0)
 S I=I-1
"RTN","PSXBPSR1",50,0)
 K DIR S DIR(0)="S^A:ALL DIVISIONS;S:SELECT DIVISIONS"
"RTN","PSXBPSR1",51,0)
 ;
"RTN","PSXBPSR1",52,0)
 D ^DIR
"RTN","PSXBPSR1",53,0)
 ;
"RTN","PSXBPSR1",54,0)
 ;Check for "^", timeout, or blank entry
"RTN","PSXBPSR1",55,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(Y)="^") K DIVNM Q
"RTN","PSXBPSR1",56,0)
 ;
"RTN","PSXBPSR1",57,0)
 ;All Divisions
"RTN","PSXBPSR1",58,0)
 I Y="A" D ALL Q
"RTN","PSXBPSR1",59,0)
 ;
"RTN","PSXBPSR1",60,0)
 ;Select Divisions
"RTN","PSXBPSR1",61,0)
 I Y="S" D SELECT(I),ALL
"RTN","PSXBPSR1",62,0)
 Q
"RTN","PSXBPSR1",63,0)
 ;
"RTN","PSXBPSR1",64,0)
 ;Select which divisions to display
"RTN","PSXBPSR1",65,0)
SELECT(I) N C,DIR,DIVX,DIRUT,DUOUT,DTOUT,X,Y
"RTN","PSXBPSR1",66,0)
 F C=1:1:I S DIR("A",C)=C_"    "_DIVNM(C)
"RTN","PSXBPSR1",67,0)
 S DIR(0)="LO^1:"_I,DIR("A")="Select Division(s) "
"RTN","PSXBPSR1",68,0)
 D ^DIR
"RTN","PSXBPSR1",69,0)
 ;
"RTN","PSXBPSR1",70,0)
 ;Check for "^", timeout, or blank entry
"RTN","PSXBPSR1",71,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(Y)="^")!('+Y) K DIVNM Q
"RTN","PSXBPSR1",72,0)
 ;
"RTN","PSXBPSR1",73,0)
 M DIVX=DIVNM K DIVNM
"RTN","PSXBPSR1",74,0)
 F I=1:1 S X=$P(Y,",",I) Q:'X  M DIVNM(X)=DIVX(X) S DIVNM=DIVX(X),DIVNM(DIVNM)=X
"RTN","PSXBPSR1",75,0)
 Q
"RTN","PSXBPSR1",76,0)
 ;
"RTN","PSXBPSR1",77,0)
SELTYPE() ; set Summary or Detail report type
"RTN","PSXBPSR1",78,0)
 N DIR
"RTN","PSXBPSR1",79,0)
 S DIR(0)="S^S:Summary;D:Detail"
"RTN","PSXBPSR1",80,0)
 S DIR("A")="Display (S)ummary or (D)etail format"
"RTN","PSXBPSR1",81,0)
 S DIR("B")="Detail"
"RTN","PSXBPSR1",82,0)
 D ^DIR
"RTN","PSXBPSR1",83,0)
 Q $S($G(Y)="S":Y,$G(Y)="D":Y,1:"^")
"RTN","PSXBPSR1",84,0)
 ;;
"RTN","PSXBPSR1",85,0)
SELPATS(ARRAY) ; select Patient(s)
"RTN","PSXBPSR1",86,0)
 N X,Y,DIC,RESULT
"RTN","PSXBPSR1",87,0)
 W !,"You may select a single or multiple PATIENTS,"
"RTN","PSXBPSR1",88,0)
 W !,"or enter ^ALL to select all PATIENTS."
"RTN","PSXBPSR1",89,0)
 S RESULT=0
"RTN","PSXBPSR1",90,0)
 S Y=0
"RTN","PSXBPSR1",91,0)
 S DIC="^DPT("
"RTN","PSXBPSR1",92,0)
 S DIC(0)="AEM"
"RTN","PSXBPSR1",93,0)
 F  Q:Y=-1  D
"RTN","PSXBPSR1",94,0)
 .D ^DIC
"RTN","PSXBPSR1",95,0)
 .S Y=$P(Y,"^")
"RTN","PSXBPSR1",96,0)
 .S ARRAY(Y)=X
"RTN","PSXBPSR1",97,0)
 .S:Y>0 RESULT=1
"RTN","PSXBPSR1",98,0)
 S:ARRAY(-1)="^ALL" RESULT=1
"RTN","PSXBPSR1",99,0)
 Q RESULT
"RTN","PSXBPSR1",100,0)
 ;;
"RTN","PSXBPSR1",101,0)
 ;Display selected divisions
"RTN","PSXBPSR1",102,0)
ALL N DA,DIR,DIV,DIRUT,DUOUT,DTOUT,X,Y
"RTN","PSXBPSR1",103,0)
 Q:'$D(DIVNM)
"RTN","PSXBPSR1",104,0)
 W !!,"You have selected:",! S DIV=0 F  S DIV=$O(DIVNM(DIV)) Q:'DIV  W !,DIV,?5,DIVNM(DIV)
"RTN","PSXBPSR1",105,0)
 S DIR(0)="Y",DIR("A")="Is this correct",DIR("B")="YES" D ^DIR
"RTN","PSXBPSR1",106,0)
 K DIR
"RTN","PSXBPSR1",107,0)
 I Y=1 S DIV=0 F  S DIV=$O(DIVNM(DIV)) Q:'DIV  S DA=DIVNM(DIV,"I"),DIVDA(DA)=DIVNM(DIV) K DIVNM(DIV)
"RTN","PSXBPSR1",108,0)
 ;
"RTN","PSXBPSR1",109,0)
 ;Check for "^", timeout, or non-yes entry
"RTN","PSXBPSR1",110,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(Y)'=1) K DIVNM
"RTN","PSXBPSR1",111,0)
 Q
"RTN","PSXBPSR1",112,0)
 ;
"RTN","PSXBPSR1",113,0)
 ; Include Rxs - (R)ELEASED or (N)OT RELEASED or (A)LL
"RTN","PSXBPSR1",114,0)
 ;
"RTN","PSXBPSR1",115,0)
 ;    Input Variable -> DFLT = 3 NOT RELEASED
"RTN","PSXBPSR1",116,0)
 ;                             2 RELEASED
"RTN","PSXBPSR1",117,0)
 ;                             1 ALL
"RTN","PSXBPSR1",118,0)
 ;                          
"RTN","PSXBPSR1",119,0)
 ;    Return Value ->   3 = NOT RELEASED
"RTN","PSXBPSR1",120,0)
 ;                      2 = RELEASED
"RTN","PSXBPSR1",121,0)
 ;                      1 = ALL
"RTN","PSXBPSR1",122,0)
 ;                      ^ = Exit
"RTN","PSXBPSR1",123,0)
 ;
"RTN","PSXBPSR1",124,0)
SELRLNRL(DFLT) N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","PSXBPSR1",125,0)
 S DFLT=$S($G(DFLT)=1:"ALL",$G(DFLT)=3:"NOT RELEASED",1:"RELEASED")
"RTN","PSXBPSR1",126,0)
 S DIR(0)="S^R:RELEASED;N:NOT RELEASED;A:ALL"
"RTN","PSXBPSR1",127,0)
 S DIR("A")="Include Rxs - (R)ELEASED or (N)OT RELEASED or (A)LL",DIR("B")=DFLT
"RTN","PSXBPSR1",128,0)
 D ^DIR
"RTN","PSXBPSR1",129,0)
 ;
"RTN","PSXBPSR1",130,0)
 ;Check for "^", timeout, or blank entry
"RTN","PSXBPSR1",131,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(X)="") S Y="^"
"RTN","PSXBPSR1",132,0)
 ;
"RTN","PSXBPSR1",133,0)
 S Y=$S(Y="A":1,Y="R":2,Y="N":3,1:Y)
"RTN","PSXBPSR1",134,0)
 ;
"RTN","PSXBPSR1",135,0)
 Q Y
"RTN","PSXBPSRP")
0^4^B78524997^B75301229
"RTN","PSXBPSRP",1,0)
PSXBPSRP ;BHAM ISC/MFR - CMOP/ECME ACTIVITY REPORT ;09/01/2006
"RTN","PSXBPSRP",2,0)
 ;;2.0;CMOP;**63,65**;11 Apr 97;Build 31
"RTN","PSXBPSRP",3,0)
 ;External reference to ^PSRX( supported by IA #1221
"RTN","PSXBPSRP",4,0)
 ;External reference to ^PSOBPSUT supported by IA #4701
"RTN","PSXBPSRP",5,0)
 ;External reference to ^BPSUTIL supported by IA #4410
"RTN","PSXBPSRP",6,0)
 ;External reference to ^IBNCPDPI supported by IA #4729
"RTN","PSXBPSRP",7,0)
 ; 
"RTN","PSXBPSRP",8,0)
EN ; Entry Point
"RTN","PSXBPSRP",9,0)
 N %,%ZIS,EXCEL,STDT,TERM,ENDT,DIVDA,DIVNM,DTOUT,I,LINE,POP,VA,VAERR
"RTN","PSXBPSRP",10,0)
 N TYPE,PATS
"RTN","PSXBPSRP",11,0)
 N X,Y,ZTDESC,ZTIO,ZTQUEUED,ZTREQ,ZTRTN,ZTSAVE,ZTSK
"RTN","PSXBPSRP",12,0)
 ;
"RTN","PSXBPSRP",13,0)
BDT ; - Prompt to select Date Range (Return: Start Date^End Date) 
"RTN","PSXBPSRP",14,0)
 S X=$$SELDATE() I X="^" S POP=1 G EXIT
"RTN","PSXBPSRP",15,0)
 S STDT=$P(X,U),ENDT=$P(X,U,2)
"RTN","PSXBPSRP",16,0)
 ;
"RTN","PSXBPSRP",17,0)
TYPE ; - Get (S)ummary or (D)etailed report type
"RTN","PSXBPSRP",18,0)
 S TYPE=$$SELTYPE() I TYPE="^" S POP=1 G EXIT
"RTN","PSXBPSRP",19,0)
 ;
"RTN","PSXBPSRP",20,0)
PATS ; - Get Patient array
"RTN","PSXBPSRP",21,0)
 I $$SELPATS(.PATS)'=1 S POP=1 G EXIT
"RTN","PSXBPSRP",22,0)
 ;
"RTN","PSXBPSRP",23,0)
DIV ; - Get Division(s) (Return: DIVDA and DIVNM arrays)
"RTN","PSXBPSRP",24,0)
 D SELDIV I '$D(DIVNM) S POP=1 G EXIT
"RTN","PSXBPSRP",25,0)
 ;
"RTN","PSXBPSRP",26,0)
SELREL ; - Get release, unreleased or all
"RTN","PSXBPSRP",27,0)
 N RLNRALL S RLNRALL="",RLNRALL=$$SELRLNRL^PSXBPSR1(.RLNRALL) G EXIT:RLNRALL="^"
"RTN","PSXBPSRP",28,0)
 ;
"RTN","PSXBPSRP",29,0)
EXC ;- Prompt for Excel Capture
"RTN","PSXBPSRP",30,0)
 S EXCEL=$$EXCEL^PSXBPSUT() I EXCEL="^" S POP=1 G EXIT
"RTN","PSXBPSRP",31,0)
 ;
"RTN","PSXBPSRP",32,0)
DEV ; - Prompt for Device
"RTN","PSXBPSRP",33,0)
 W !! S %ZIS="MQ",%ZIS("A")="Select Printer: ",%ZIS("B")=""
"RTN","PSXBPSRP",34,0)
 D ^%ZIS I POP S POP=1 G EXIT
"RTN","PSXBPSRP",35,0)
 S TERM=$S($E($G(IOST),1,2)="C-":1,1:0)
"RTN","PSXBPSRP",36,0)
 I '$D(IO("Q")) G START
"RTN","PSXBPSRP",37,0)
 ;
"RTN","PSXBPSRP",38,0)
QUE ; - Process queue device
"RTN","PSXBPSRP",39,0)
 S ZTSAVE("*")=""
"RTN","PSXBPSRP",40,0)
 S ZTRTN="START^PSXBPSRP"
"RTN","PSXBPSRP",41,0)
 S ZTDESC="CMOP/ECME Activity Report"
"RTN","PSXBPSRP",42,0)
 D ^%ZTLOAD
"RTN","PSXBPSRP",43,0)
 W !,$S($D(ZTSK):"REQUEST QUEUED TASK="_ZTSK,1:"REQUEST CANCELLED")
"RTN","PSXBPSRP",44,0)
 D HOME^%ZIS
"RTN","PSXBPSRP",45,0)
 S TERM=$S($E($G(IOST),1,2)="C-":1,1:0)
"RTN","PSXBPSRP",46,0)
 G EXIT
"RTN","PSXBPSRP",47,0)
 ;
"RTN","PSXBPSRP",48,0)
 ;Report Processing Tag
"RTN","PSXBPSRP",49,0)
 ;
"RTN","PSXBPSRP",50,0)
START N BPFND,STDTE,ENDTE,LINE,POP,Y
"RTN","PSXBPSRP",51,0)
 S BPFND=0,LINE="W ! F I=1:1:80 W ""="""
"RTN","PSXBPSRP",52,0)
 U IO
"RTN","PSXBPSRP",53,0)
 ;
"RTN","PSXBPSRP",54,0)
 ;Excel Display - Print Header Record
"RTN","PSXBPSRP",55,0)
 I EXCEL D PLINEX
"RTN","PSXBPSRP",56,0)
 ;
"RTN","PSXBPSRP",57,0)
 S Y=STDT X ^DD("DD") S STDTE=Y
"RTN","PSXBPSRP",58,0)
 S Y=ENDT X ^DD("DD") S ENDTE=Y
"RTN","PSXBPSRP",59,0)
 ;
"RTN","PSXBPSRP",60,0)
 ;Loop through divisions and display
"RTN","PSXBPSRP",61,0)
 S DIVDA=0 F  S DIVDA=$O(DIVDA(DIVDA)) Q:DIVDA'>0  D ONEDIV(.BPFND,STDTE,ENDTE,.PATS) Q:$G(POP)
"RTN","PSXBPSRP",62,0)
 ;
"RTN","PSXBPSRP",63,0)
 ;Make sure a record was printed
"RTN","PSXBPSRP",64,0)
 I '$G(POP),BPFND=0 D
"RTN","PSXBPSRP",65,0)
 .I 'EXCEL D TITLE
"RTN","PSXBPSRP",66,0)
 .W !,"NO DATA FOUND FOR CHOSEN PARAMETERS"
"RTN","PSXBPSRP",67,0)
 .I TERM,'EXCEL D PAUSE2
"RTN","PSXBPSRP",68,0)
 ;
"RTN","PSXBPSRP",69,0)
 I '$G(POP),'EXCEL S POP=2
"RTN","PSXBPSRP",70,0)
 G EXIT
"RTN","PSXBPSRP",71,0)
 ;
"RTN","PSXBPSRP",72,0)
ONEDIV(BPFND,STDTE,ENDTE,PATS) ; - Display information for one division
"RTN","PSXBPSRP",73,0)
 N %,PSXDT,TRX,PS,Y,BATCHES,EPHFL
"RTN","PSXBPSRP",74,0)
 S PSXDT=STDT-.1
"RTN","PSXBPSRP",75,0)
 I TYPE="D" S EPHFL=1
"RTN","PSXBPSRP",76,0)
 F  S PSXDT=$O(^PSX(550.2,"D",PSXDT)) Q:'PSXDT!(PSXDT>(ENDT+.24))  D  Q:$G(POP)
"RTN","PSXBPSRP",77,0)
 .S (PS,TRX)=0 F  S TRX=$O(^PSX(550.2,"D",PSXDT,TRX)) Q:'TRX  D  Q:$G(POP)
"RTN","PSXBPSRP",78,0)
 . . N TEMP,DATA
"RTN","PSXBPSRP",79,0)
 . . D GETS^DIQ(550.2,TRX,".01;1;2;3;5;6;7;8;9;10;13;14","","TEMP")
"RTN","PSXBPSRP",80,0)
 . . M DATA=TEMP(550.2,TRX_",")
"RTN","PSXBPSRP",81,0)
 . . I $G(DATA(.01))="" Q
"RTN","PSXBPSRP",82,0)
 ..I '$D(DIVNM(DATA(2))) Q
"RTN","PSXBPSRP",83,0)
 ..I DATA(2)'=DIVDA(DIVDA) Q
"RTN","PSXBPSRP",84,0)
 ..I TYPE="S" S EPHFL=$$CHKEPH(TRX)
"RTN","PSXBPSRP",85,0)
 ..Q:'EPHFL
"RTN","PSXBPSRP",86,0)
 ..;
"RTN","PSXBPSRP",87,0)
 ..;Set flag that at least one record was found
"RTN","PSXBPSRP",88,0)
 ..S BPFND=1
"RTN","PSXBPSRP",89,0)
 ..;
"RTN","PSXBPSRP",90,0)
 ..;Display Transmission Information - Normal Display Only
"RTN","PSXBPSRP",91,0)
 ..I 'EXCEL D HEAD1
"RTN","PSXBPSRP",92,0)
 ..;
"RTN","PSXBPSRP",93,0)
 ..;Display Records in Normal Format
"RTN","PSXBPSRP",94,0)
 ..I 'EXCEL D  Q
"RTN","PSXBPSRP",95,0)
 ...S PS=$$PDET(TRX,.PATS) Q:$G(POP)
"RTN","PSXBPSRP",96,0)
 ...I 'PS D CHKP(3) Q:$G(POP)  D NDAT
"RTN","PSXBPSRP",97,0)
 ...I TERM,'EXCEL D PAUSE Q:$G(POP)
"RTN","PSXBPSRP",98,0)
 ..;
"RTN","PSXBPSRP",99,0)
 ..;Display Records in Excel Format
"RTN","PSXBPSRP",100,0)
 ..D PDETEX(TRX,.PATS)
"RTN","PSXBPSRP",101,0)
 Q
"RTN","PSXBPSRP",102,0)
 ;
"RTN","PSXBPSRP",103,0)
CHKEPH(TRX) ;check batch for ePharmacy Rx's
"RTN","PSXBPSRP",104,0)
 N DATA,SEQ,RX,RFL,RELDAT,EPHARM,EDFN
"RTN","PSXBPSRP",105,0)
 S (EPHARM,SEQ)=0 F  S SEQ=$O(^PSX(550.2,TRX,15,SEQ)) Q:SEQ=""!(EPHARM)  D  Q:EPHARM
"RTN","PSXBPSRP",106,0)
 . Q:'$D(^PSX(550.2,TRX,15,SEQ,0))
"RTN","PSXBPSRP",107,0)
 . S DATA=^PSX(550.2,TRX,15,SEQ,0),RX=$P(DATA,"^",1),RFL=$P(DATA,"^",2),EDFN=$P(DATA,"^",3)
"RTN","PSXBPSRP",108,0)
 . Q:$$GOODPAT(EDFN,.PATS)=0
"RTN","PSXBPSRP",109,0)
 . I RFL=0 S RELDAT=$$GET1^DIQ(52,RX,31,"I")
"RTN","PSXBPSRP",110,0)
 . I RFL>0 S RELDAT=$$GET1^DIQ(52.1,RFL_","_RX,17,"I")
"RTN","PSXBPSRP",111,0)
 . Q:RLNRALL=2&(RELDAT="")
"RTN","PSXBPSRP",112,0)
 . Q:RLNRALL=3&(RELDAT'="")
"RTN","PSXBPSRP",113,0)
 . I $$STATUS^PSOBPSUT(RX,RFL)'="" S EPHARM=1
"RTN","PSXBPSRP",114,0)
 Q EPHARM
"RTN","PSXBPSRP",115,0)
 ;
"RTN","PSXBPSRP",116,0)
HEAD1 ;
"RTN","PSXBPSRP",117,0)
 D TITLE
"RTN","PSXBPSRP",118,0)
 I $G(TYPE)="D" D
"RTN","PSXBPSRP",119,0)
 .W !!,?7,"TRANSMISSION:",?35,DATA(.01)
"RTN","PSXBPSRP",120,0)
 .W !,?7,"STATUS:",?35,DATA(1)
"RTN","PSXBPSRP",121,0)
 .W !,?7,"DIVISION:",?35,DATA(2)
"RTN","PSXBPSRP",122,0)
 .W !,?7,"CMOP SYSTEM:",?35,DATA(3)
"RTN","PSXBPSRP",123,0)
 .W !,?7,"TRANSMISSION DATE/TIME:",?35,DATA(5)
"RTN","PSXBPSRP",124,0)
 .I DATA(6) W !,?7,"CREATED DATE/TIME:",?35,DATA(6)
"RTN","PSXBPSRP",125,0)
 .I DATA(7) W !,?7,"RECEIVED DATE/TIME:",?35,DATA(7)
"RTN","PSXBPSRP",126,0)
 .I DATA(8) W !,?7,"RETRANSMISSION #:",?35,DATA(8)
"RTN","PSXBPSRP",127,0)
 .I DATA(9) W !,?7,"ORIGINAL TRANS.:",?35,DATA(9)
"RTN","PSXBPSRP",128,0)
 .I DATA(10) W !,?7,"CLOSED DATE/TIME:",?35,DATA(10)
"RTN","PSXBPSRP",129,0)
 .W !,?7,"TOTAL PATIENTS:",?35,DATA(13)
"RTN","PSXBPSRP",130,0)
 .W !,?7,"TOTAL RXS:",?35,DATA(14)
"RTN","PSXBPSRP",131,0)
 E  D
"RTN","PSXBPSRP",132,0)
 .W !
"RTN","PSXBPSRP",133,0)
 .W $$RJ^XLFSTR("TRANSMISSION:",15),$$RJ^XLFSTR(DATA(.01),3)
"RTN","PSXBPSRP",134,0)
 .W $$RJ^XLFSTR("TRANSMISSION DATE/TIME: ",35),DATA(5)
"RTN","PSXBPSRP",135,0)
 .W !
"RTN","PSXBPSRP",136,0)
 .W $$RJ^XLFSTR("TOTAL PATIENTS:",15),$$RJ^XLFSTR(DATA(13),3)
"RTN","PSXBPSRP",137,0)
 .W $$RJ^XLFSTR("TOTAL RXS: ",35),DATA(14)
"RTN","PSXBPSRP",138,0)
 .W !
"RTN","PSXBPSRP",139,0)
 Q
"RTN","PSXBPSRP",140,0)
 ;Display Record(s) - Normal Format
"RTN","PSXBPSRP",141,0)
PDET(TRX,PATS) N BIEN,DFN,RFL,M,N,NDCR,NDCS,RXS,PS,RDT,RXI,VA
"RTN","PSXBPSRP",142,0)
 D PLINE
"RTN","PSXBPSRP",143,0)
 S (PS,RXS)=0 F  S RXS=$O(^PSX(550.2,TRX,15,RXS)) Q:'RXS  D  Q:$G(POP)
"RTN","PSXBPSRP",144,0)
 .S RXI=+$$GET1^DIQ(550.215,RXS_","_TRX,".01","I")
"RTN","PSXBPSRP",145,0)
 .S RFL=+$$GET1^DIQ(550.215,RXS_","_TRX,".02","I")
"RTN","PSXBPSRP",146,0)
 .S DFN=+$$GET1^DIQ(550.215,RXS_","_TRX,".03","I")
"RTN","PSXBPSRP",147,0)
 .Q:$$GOODPAT(DFN,.PATS)=0
"RTN","PSXBPSRP",148,0)
 .Q:$$STATUS^PSOBPSUT(RXI,RFL)=""
"RTN","PSXBPSRP",149,0)
 .D CHKP(2) Q:$G(POP)
"RTN","PSXBPSRP",150,0)
 .I RFL=0 S RELDAT=$$GET1^DIQ(52,RXI,31,"I")
"RTN","PSXBPSRP",151,0)
 .I RFL>0 S RELDAT=$$GET1^DIQ(52.1,RFL_","_RXI,17,"I")
"RTN","PSXBPSRP",152,0)
 .Q:RLNRALL=2&(RELDAT="")
"RTN","PSXBPSRP",153,0)
 .Q:RLNRALL=3&(RELDAT'="")
"RTN","PSXBPSRP",154,0)
 .S PS=1 D PID^VADPT
"RTN","PSXBPSRP",155,0)
 .S BIEN=RXI_"."_$E($TR($J("",4-$L(RFL))," ","0")_RFL,1,4)_1
"RTN","PSXBPSRP",156,0)
 .S RDT=$S(RFL=0:$$GET1^DIQ(52,RXI,31,"I"),1:$$GET1^DIQ(52.1,RFL_","_RXI_",",17,"I"))
"RTN","PSXBPSRP",157,0)
 .W !,$E($$GET1^DIQ(2,DFN,.01),1,14)_" ("_$G(VA("BID"))_")"
"RTN","PSXBPSRP",158,0)
 .W ?22,RXI_"/"_$$GET1^DIQ(52,RXI,.01)_$S($G(^PSRX(RXI,"IB")):"$",1:"")_$$ECME^PSOBPSUT(RXI)_"/"_RFL
"RTN","PSXBPSRP",159,0)
 .S (NDCS,NDCR)="",(M,N)=0
"RTN","PSXBPSRP",160,0)
 .F  S M=$O(^PSRX(RXI,4,M)) Q:'M  S N=^(M,0) I $P(N,"^",3)=RFL S NDCR=$P(N,"^",8),NDCS=$P(N,"^",9)
"RTN","PSXBPSRP",161,0)
 .W ?45,$E(NDCS,1,13),?59,$E(NDCR,1,13),?73,$S(RDT:"D",1:"T")
"RTN","PSXBPSRP",162,0)
 .W !,?3,$E($$GET1^DIQ(52,RXI,6),1,18),?22,$E($$BPSPLN^BPSUTIL(RXI,RFL),1,15)
"RTN","PSXBPSRP",163,0)
 .W ?38,$E($$STATUS^PSOBPSUT(RXI,RFL),1,7),?48,$P($$BILLINFO^IBNCPDPI(RXI,RFL),"^",1)
"RTN","PSXBPSRP",164,0)
 .W ?58,$S(RDT:$E(RDT,4,5)_"/"_$E(RDT,6,7)_"/"_$E(RDT,2,3),1:"")
"RTN","PSXBPSRP",165,0)
 Q PS
"RTN","PSXBPSRP",166,0)
 ;
"RTN","PSXBPSRP",167,0)
 ;Display Record(s) - Excel Format
"RTN","PSXBPSRP",168,0)
PDETEX(TRX,PATS) N BIEN,DFN,RFL,M,N,NDCR,NDCS,RXS,PS,RDT,RXI,VA
"RTN","PSXBPSRP",169,0)
 S RXS=0 F  S RXS=$O(^PSX(550.2,TRX,15,RXS)) Q:'RXS  D
"RTN","PSXBPSRP",170,0)
 .S RXI=+$$GET1^DIQ(550.215,RXS_","_TRX,".01","I")
"RTN","PSXBPSRP",171,0)
 .S RFL=+$$GET1^DIQ(550.215,RXS_","_TRX,".02","I")
"RTN","PSXBPSRP",172,0)
 .S DFN=+$$GET1^DIQ(550.215,RXS_","_TRX,".03","I")
"RTN","PSXBPSRP",173,0)
 .Q:$$GOODPAT(DFN,.PATS)=0
"RTN","PSXBPSRP",174,0)
 .Q:$$STATUS^PSOBPSUT(RXI,RFL)=""
"RTN","PSXBPSRP",175,0)
 .I RFL=0 S RELDAT=$$GET1^DIQ(52,RXI,31,"I")
"RTN","PSXBPSRP",176,0)
 .I RFL>0 S RELDAT=$$GET1^DIQ(52.1,RFL_","_RXI,17,"I")
"RTN","PSXBPSRP",177,0)
 .Q:RLNRALL=2&(RELDAT="")
"RTN","PSXBPSRP",178,0)
 .Q:RLNRALL=3&(RELDAT'="")
"RTN","PSXBPSRP",179,0)
 .S PS=1 D PID^VADPT
"RTN","PSXBPSRP",180,0)
 .S BIEN=RXI_"."_$E($TR($J("",4-$L(RFL))," ","0")_RFL,1,4)_1
"RTN","PSXBPSRP",181,0)
 .S RDT=$S(RFL=0:$$GET1^DIQ(52,RXI,31,"I"),1:$$GET1^DIQ(52.1,RFL_","_RXI_",",17,"I"))
"RTN","PSXBPSRP",182,0)
 .W !,DATA(.01),U  ;Transmission
"RTN","PSXBPSRP",183,0)
 .W DATA(1),U  ;Status
"RTN","PSXBPSRP",184,0)
 .W DATA(2),U  ;Division
"RTN","PSXBPSRP",185,0)
 .W DATA(3),U  ;CMOP System
"RTN","PSXBPSRP",186,0)
 .W DATA(5),U  ;Transmission Date/Time
"RTN","PSXBPSRP",187,0)
 .W $E($$GET1^DIQ(2,DFN,.01),1,14),U  ;Name
"RTN","PSXBPSRP",188,0)
 .W "("_$G(VA("BID"))_")",U  ;Pt.ID
"RTN","PSXBPSRP",189,0)
 .W RXI,U                             ;ECME#
"RTN","PSXBPSRP",190,0)
 .W $$GET1^DIQ(52,RXI,.01)_$S($G(^PSRX(RXI,"IB")):"$",1:"")_$$ECME^PSOBPSUT(RXI),U  ;RX#
"RTN","PSXBPSRP",191,0)
 .W RFL,U                     ;RFL#
"RTN","PSXBPSRP",192,0)
 .N NDCS,NDCR,M,N S (NDCS,NDCR)="",(M,N)=0
"RTN","PSXBPSRP",193,0)
 .F  S M=$O(^PSRX(RXI,4,M)) Q:'M  S N=^(M,0) I $P(N,"^",3)=RFL S NDCR=$P(N,"^",8),NDCS=$P(N,"^",9)
"RTN","PSXBPSRP",194,0)
 .W $E(NDCS,1,13),U          ;NDC SENT
"RTN","PSXBPSRP",195,0)
 .W $E(NDCR,1,13),U          ;NDC RECVD
"RTN","PSXBPSRP",196,0)
 .W $S(RDT:"D",1:"T"),U      ;CMOP-STAT
"RTN","PSXBPSRP",197,0)
 .W $E($$GET1^DIQ(52,RXI,6),1,18),U  ;DRUG
"RTN","PSXBPSRP",198,0)
 .W $$BPSPLN^BPSUTIL(RXI,RFL),U ;INSURANCE
"RTN","PSXBPSRP",199,0)
 .W $E($$STATUS^PSOBPSUT(RXI,RFL),1,7),U  ;PAY-STAT
"RTN","PSXBPSRP",200,0)
 .W $P($$BILLINFO^IBNCPDPI(RXI,RFL),"^"),U  ;BILL#
"RTN","PSXBPSRP",201,0)
 .W $S(RDT:$E(RDT,4,5)_"/"_$E(RDT,6,7)_"/"_$E(RDT,2,3),1:"")  ;REL-DATE
"RTN","PSXBPSRP",202,0)
 Q
"RTN","PSXBPSRP",203,0)
 ;
"RTN","PSXBPSRP",204,0)
 ;- Check Selected Patient Array
"RTN","PSXBPSRP",205,0)
GOODPAT(DFN,PATS) ;
"RTN","PSXBPSRP",206,0)
 I $G(PATS(-1))="^ALL" Q 1
"RTN","PSXBPSRP",207,0)
 I $G(PATS(DFN))'="" Q 1
"RTN","PSXBPSRP",208,0)
 Q 0
"RTN","PSXBPSRP",209,0)
 ;
"RTN","PSXBPSRP",210,0)
 ;- Display Header - Normal
"RTN","PSXBPSRP",211,0)
PLINE W !,"NAME",?22,"ECME#/RX#/FL#",?45,"NDC SENT",?59,"NDC RECVD",?71,"CMOP-STAT"
"RTN","PSXBPSRP",212,0)
 W !,"   DRUG",?22,"INSURANCE",?38,"PAY-STAT",?48,"BILL#",?58,"REL-DATE"
"RTN","PSXBPSRP",213,0)
 X LINE
"RTN","PSXBPSRP",214,0)
 Q
"RTN","PSXBPSRP",215,0)
 ;
"RTN","PSXBPSRP",216,0)
 ;- Display Header - Excel
"RTN","PSXBPSRP",217,0)
PLINEX W !,"TRANSMISSION",U,"STATUS",U,"DIVISION",U,"CMOP SYSTEM",U,"TRANSMISSION DATE/TIME",U
"RTN","PSXBPSRP",218,0)
 W "NAME",U,"Pt.ID",U,"ECME#",U,"RX#",U,"FL#",U,"NDC SENT",U,"NDC RECVD",U,"CMOP-STAT",U
"RTN","PSXBPSRP",219,0)
 W "DRUG",U,"INSURANCE",U,"PAY-STAT",U,"BILL#",U,"REL-DATE"
"RTN","PSXBPSRP",220,0)
 Q
"RTN","PSXBPSRP",221,0)
 ;
"RTN","PSXBPSRP",222,0)
EXIT I '$G(POP) D PAUSE2
"RTN","PSXBPSRP",223,0)
 I $D(ZTQUEUED) S ZTREQ="@" Q
"RTN","PSXBPSRP",224,0)
 I $G(POP)'=1 D ^%ZISC
"RTN","PSXBPSRP",225,0)
 Q
"RTN","PSXBPSRP",226,0)
 ;
"RTN","PSXBPSRP",227,0)
 ;- Print message if no billable prescriptions
"RTN","PSXBPSRP",228,0)
NDAT W !!,"********* BATCH HAS NO ECME BILLABLE PRESCRIPTIONS *******",!
"RTN","PSXBPSRP",229,0)
 Q
"RTN","PSXBPSRP",230,0)
 ;
"RTN","PSXBPSRP",231,0)
TITLE W @IOF
"RTN","PSXBPSRP",232,0)
 W $$CJ^XLFSTR("CMOP/ECME ACTIVITY REPORT "_$S($G(BPFND)=1:"for "_$E(DIVDA(DIVDA),1,24),1:""),80)
"RTN","PSXBPSRP",233,0)
 W $$CJ^XLFSTR("For "_STDTE_"  thru  "_$P(ENDTE,"@")_"     Printed: "_$$FMTE^XLFDT($$NOW^XLFDT()),80)
"RTN","PSXBPSRP",234,0)
 X LINE
"RTN","PSXBPSRP",235,0)
 Q
"RTN","PSXBPSRP",236,0)
 ;
"RTN","PSXBPSRP",237,0)
CHKP(BPLINES) Q:$G(EXCEL)
"RTN","PSXBPSRP",238,0)
 S BPLINES=BPLINES+1
"RTN","PSXBPSRP",239,0)
 I $G(TERM) S BPLINES=BPLINES+2
"RTN","PSXBPSRP",240,0)
 I $Y>(IOSL-BPLINES) D:$G(TERM) PAUSE Q:$G(POP)  D TITLE,PLINE Q
"RTN","PSXBPSRP",241,0)
 Q
"RTN","PSXBPSRP",242,0)
 ;                
"RTN","PSXBPSRP",243,0)
SELDATE() Q $$SELDATE^PSXBPSR1()
"RTN","PSXBPSRP",244,0)
 ;
"RTN","PSXBPSRP",245,0)
SELDIV D SELDIV^PSXBPSR1 Q
"RTN","PSXBPSRP",246,0)
 ;
"RTN","PSXBPSRP",247,0)
SELECT(I) D SELECT^PSXBPSR1(I) Q
"RTN","PSXBPSRP",248,0)
 ;
"RTN","PSXBPSRP",249,0)
SELTYPE() Q $$SELTYPE^PSXBPSR1()
"RTN","PSXBPSRP",250,0)
 ;
"RTN","PSXBPSRP",251,0)
SELPATS(ARRAY) Q $$SELPATS^PSXBPSR1(.ARRAY)
"RTN","PSXBPSRP",252,0)
 ;
"RTN","PSXBPSRP",253,0)
 ;Display selected divisions
"RTN","PSXBPSRP",254,0)
ALL D ALL^PSXBPSR1 Q
"RTN","PSXBPSRP",255,0)
 ;
"RTN","PSXBPSRP",256,0)
 ;Screen Pause 2
"RTN","PSXBPSRP",257,0)
PAUSE2 Q:'$G(TERM)
"RTN","PSXBPSRP",258,0)
 N X
"RTN","PSXBPSRP",259,0)
 U IO(0) W !!,"Press RETURN to continue:"
"RTN","PSXBPSRP",260,0)
 R X:$G(DTIME)
"RTN","PSXBPSRP",261,0)
 U IO
"RTN","PSXBPSRP",262,0)
 Q
"RTN","PSXBPSRP",263,0)
 ;
"RTN","PSXBPSRP",264,0)
 ;Screen Pause 1
"RTN","PSXBPSRP",265,0)
 ;
"RTN","PSXBPSRP",266,0)
 ; Return variable - BPQ = 0 Continue
"RTN","PSXBPSRP",267,0)
 ;                         2 Quit
"RTN","PSXBPSRP",268,0)
PAUSE N X
"RTN","PSXBPSRP",269,0)
 U IO(0) W !!,"Press RETURN to continue, '^' to exit:"
"RTN","PSXBPSRP",270,0)
 R X:$G(DTIME) S:'$T X="^" S:X["^" POP=2
"RTN","PSXBPSRP",271,0)
 U IO
"RTN","PSXBPSRP",272,0)
 Q
"RTN","PSXBPSUT")
0^3^B5782836^B5692316
"RTN","PSXBPSUT",1,0)
PSXBPSUT ;BIR/MFR - BPS (ECME) Utilities ;13 Mar 2002  10:31 AM
"RTN","PSXBPSUT",2,0)
 ;;2.0;CMOP;**48,63,65**;11 Apr 97;Build 31
"RTN","PSXBPSUT",3,0)
 ;Reference to ^PS(52.5, supported by DBIA #1978
"RTN","PSXBPSUT",4,0)
 ;Reference to ^PSOSULB1 supported by DBIA #2478
"RTN","PSXBPSUT",5,0)
 ;
"RTN","PSXBPSUT",6,0)
XMIT(REC) ; Checks if the prescription will be transmitted to CMOP or not
"RTN","PSXBPSUT",7,0)
 ; Input:  REC  - Pointer to SUSPENSE file (#52.5)
"RTN","PSXBPSUT",8,0)
 ; Output: XMIT - 0 - NO  /  1 - YES 
"RTN","PSXBPSUT",9,0)
 N VADM,DFN,RX,PSXOK
"RTN","PSXBPSUT",10,0)
 I '$D(^PS(52.5,REC,0)) Q 0
"RTN","PSXBPSUT",11,0)
 I $P(^PS(52.5,REC,0),"^",7)="" Q 0
"RTN","PSXBPSUT",12,0)
 S RX=$P($G(^PS(52.5,REC,0)),"^",1) I RX="" Q 0
"RTN","PSXBPSUT",13,0)
 S DFN=$$GET1^DIQ(52,RX,2,"I") D DEM^VADPT I $G(VADM(6))'="" Q 0
"RTN","PSXBPSUT",14,0)
 I ($P(^PS(52.5,REC,0),"^",3)'=DFN) Q 0
"RTN","PSXBPSUT",15,0)
 S PSXOK=0 D CHKDATA^PSXMISC1 I PSXOK Q 0
"RTN","PSXBPSUT",16,0)
 Q 1
"RTN","PSXBPSUT",17,0)
 ;
"RTN","PSXBPSUT",18,0)
EXCEL() ; - Returns whether to capture data for Excel report.
"RTN","PSXBPSUT",19,0)
 ; Output: EXCEL = 1 - YES (capture data) / 0 - NO (DO NOT capture data)
"RTN","PSXBPSUT",20,0)
 ;
"RTN","PSXBPSUT",21,0)
 N EXCEL,DIR,DIRUT,DTOUT,DUOUT,DIROUT,Y
"RTN","PSXBPSUT",22,0)
 ;
"RTN","PSXBPSUT",23,0)
 S DIR(0)="Y",DIR("B")="NO",DIR("T")=DTIME W !
"RTN","PSXBPSUT",24,0)
 S DIR("A")="Do you want to capture report data for an Excel document"
"RTN","PSXBPSUT",25,0)
 S DIR("?")="^D HEXC^PSXBPSUT"
"RTN","PSXBPSUT",26,0)
 D ^DIR K DIR I $D(DIRUT)!$D(DTOUT)!$D(DUOUT)!$D(DIROUT) Q "^"
"RTN","PSXBPSUT",27,0)
 K DIROUT,DTOUT,DUOUT,DIRUT
"RTN","PSXBPSUT",28,0)
 S EXCEL=0 I Y S EXCEL=1
"RTN","PSXBPSUT",29,0)
 ;
"RTN","PSXBPSUT",30,0)
 ;Display Excel display message
"RTN","PSXBPSUT",31,0)
 I EXCEL=1 D EXMSG
"RTN","PSXBPSUT",32,0)
 ;
"RTN","PSXBPSUT",33,0)
 Q EXCEL
"RTN","PSXBPSUT",34,0)
 ;
"RTN","PSXBPSUT",35,0)
HEXC ; - 'Do you want to capture data...' prompt
"RTN","PSXBPSUT",36,0)
 W !!,"      Enter:  'Y'    -  To capture detail report data to transfer"
"RTN","PSXBPSUT",37,0)
 W !,"                        to an Excel document"
"RTN","PSXBPSUT",38,0)
 W !,"              '<CR>' -  To skip this option"
"RTN","PSXBPSUT",39,0)
 W !,"              '^'    -  To quit this option"
"RTN","PSXBPSUT",40,0)
 Q
"RTN","PSXBPSUT",41,0)
 ;
"RTN","PSXBPSUT",42,0)
 ;Display the message about capturing to an Excel file format
"RTN","PSXBPSUT",43,0)
 ; 
"RTN","PSXBPSUT",44,0)
EXMSG ;
"RTN","PSXBPSUT",45,0)
 W !!?5,"Before continuing, please set up your terminal to capture the"
"RTN","PSXBPSUT",46,0)
 W !?5,"detail report data. On some terminals, this can  be  done  by"
"RTN","PSXBPSUT",47,0)
 W !?5,"clicking  on the 'Tools' menu above, then click  on  'Capture"
"RTN","PSXBPSUT",48,0)
 W !?5,"Incoming  Data' to save to  Desktop. This  report  may take a"
"RTN","PSXBPSUT",49,0)
 W !?5,"while to run."
"RTN","PSXBPSUT",50,0)
 W !!?5,"Note: To avoid  undesired  wrapping of the data  saved to the"
"RTN","PSXBPSUT",51,0)
 W !?5,"      file, please enter '0;256;999' at the 'DEVICE:' prompt.",!
"RTN","PSXBPSUT",52,0)
 Q
"RTN","PSXBPSUT",53,0)
 ;
"RTN","PSXRPPL")
0^1^B63013526^B67673391
"RTN","PSXRPPL",1,0)
PSXRPPL ;BIR/WPB,BAB-Gathers data for the CMOP Transmission ;13 Mar 2002  10:31 AM
"RTN","PSXRPPL",2,0)
 ;;2.0;CMOP;**3,23,33,28,40,42,41,48,62,58,66,65**;11 Apr 97;Build 31
"RTN","PSXRPPL",3,0)
 ;Reference to ^PS(52.5,  supported by DBIA #1978
"RTN","PSXRPPL",4,0)
 ;Reference to ^PSRX(     supported by DBIA #1977
"RTN","PSXRPPL",5,0)
 ;Reference to ^PSOHLSN1  supported by DBIA #2385
"RTN","PSXRPPL",6,0)
 ;Reference to ^PSORXL    supported by DBIA #1969
"RTN","PSXRPPL",7,0)
 ;Reference to ^PSOLSET   supported by DBIA #1973
"RTN","PSXRPPL",8,0)
 ;Reference to %ZIS(1     supported by DBIA #290
"RTN","PSXRPPL",9,0)
 ;Reference to %ZIS(2     supported by DBIA #2247
"RTN","PSXRPPL",10,0)
 ;Reference to ^PSSLOCK   supported by DBIA #2789
"RTN","PSXRPPL",11,0)
 ;Reference to ^XTMP("ORLK-" supported by DBIA #4001
"RTN","PSXRPPL",12,0)
 ;Reference to ^PSOBPSUT supported by DBIA #4701
"RTN","PSXRPPL",13,0)
 ;Reference to ^PSOREJUT supported by DBIA #4706
"RTN","PSXRPPL",14,0)
 ;Reference to ^BPSUTIL supported by DBIA #4410
"RTN","PSXRPPL",15,0)
 ;Reference to ^PSOREJU3 supported by DBIA #5186
"RTN","PSXRPPL",16,0)
 ;
"RTN","PSXRPPL",17,0)
 ;Called from PSXRSUS -Builds ^PSX(550.2,,15,"C" , and returns to PSXRSUS or PSXRTRAN
"RTN","PSXRPPL",18,0)
 ;
"RTN","PSXRPPL",19,0)
SDT K ^TMP($J,"PSX"),^TMP($J,"PSXDFN"),^TMP("PSXEPHNB",$J),ZCNT,PSXBAT D:$D(XRTL) T0^%ZOSV
"RTN","PSXRPPL",20,0)
 S PSXTDIV=PSOSITE,PSXTYP=$S(+$G(PSXCS):"C",1:"N")
"RTN","PSXRPPL",21,0)
 ;
"RTN","PSXRPPL",22,0)
 ; - Submitting prescriptions to ECME (Electronic Claims Mgmt Engine) - 3rd pary
"RTN","PSXRPPL",23,0)
 I $$ECMEON^BPSUTIL(PSXTDIV),$$CMOPON^BPSUTIL(PSXTDIV) D
"RTN","PSXRPPL",24,0)
 . N BPSCNT S BPSCNT=$$SBTECME^PSXRPPL1(PSXTYP,PSXTDIV,PRTDT,PSXDTRG)
"RTN","PSXRPPL",25,0)
 . ; - Wait 15 seconds per prescription sent to ECME (max of 2 hours)
"RTN","PSXRPPL",26,0)
 . I BPSCNT>0 H 60+$S((BPSCNT*15)>7200:7200,1:(BPSCNT*15))
"RTN","PSXRPPL",27,0)
 ;
"RTN","PSXRPPL",28,0)
 ; - Transmitting prescription to CMOP (up to THROUGH DATE)
"RTN","PSXRPPL",29,0)
 K ^TMP("PSXEPHIN",$J)
"RTN","PSXRPPL",30,0)
 S SDT=0 F  S SDT=$O(^PS(52.5,"CMP","Q",PSXTYP,PSXTDIV,SDT)) S XDFN=0 Q:(SDT>PRTDT)!(SDT'>0)  D
"RTN","PSXRPPL",31,0)
 . F  S XDFN=$O(^PS(52.5,"CMP","Q",PSXTYP,PSXTDIV,SDT,XDFN)) S REC=0 Q:(XDFN'>0)!(XDFN="")  D
"RTN","PSXRPPL",32,0)
 . . F  S REC=$O(^PS(52.5,"CMP","Q",PSXTYP,PSXTDIV,SDT,XDFN,REC)) Q:(REC'>0)!(REC="")  D
"RTN","PSXRPPL",33,0)
 . . . D GETDATA D:$G(RXN) PSOUL^PSSLOCK(RXN),OERRLOCK(RXN)
"RTN","PSXRPPL",34,0)
 ;
"RTN","PSXRPPL",35,0)
 ; - Pulling prescriptions ahead (parameter in OUTPATIENT SITE file #59)
"RTN","PSXRPPL",36,0)
 I $G(PSXBAT),'$G(PSXRTRAN) D CHKDFN^PSXRPPL2(PRTDT)
"RTN","PSXRPPL",37,0)
 I $G(PSXBAT),'$G(PSXRTRAN) D CHKDFN
"RTN","PSXRPPL",38,0)
 ;
"RTN","PSXRPPL",39,0)
 ; - Sends a Mailman message if there were transmission problems with the 3rd Party Payer
"RTN","PSXRPPL",40,0)
 I $D(^TMP("PSXEPHIN",$J)) D ^PSXBPSMS K ^TMP("PSXEPHIN",$J),^TMP("PSXEPHNB",$J)
"RTN","PSXRPPL",41,0)
 ;
"RTN","PSXRPPL",42,0)
EXIT ;   
"RTN","PSXRPPL",43,0)
 K SDT,DFN,REC,RXNUM,PSXOK,FILNUM,REF,PNAME,CNAME,DIE,DR,NDFN,%,CNT,COM,DTTM,FILL,JJ,PRTDT,PSXDIV,XDFN,NFLAG,CIND,XDFN
"RTN","PSXRPPL",44,0)
 K CHKDT,DAYS,DRUG,DRUGCHK,NM,OPDT,PHARCLK,PHY,PSTAT,PTRA,PTRB,QTY,REL,RXERR,RXF,SFN,PSXDGST,PSXMC,PSXMDT
"RTN","PSXRPPL",45,0)
 S:$D(XRT0) XRTN=$T(+0) D:$D(XRT0) T1^%ZOSV
"RTN","PSXRPPL",46,0)
 K ^TMP("PSXEPHIN",$J),^TMP("PSXEPHNB",$J)
"RTN","PSXRPPL",47,0)
 Q
"RTN","PSXRPPL",48,0)
GETDATA ;Screens rxs and builds data
"RTN","PSXRPPL",49,0)
 ;PSXOK=1:NOT CMOP DRUG OR DO NOT MAIL,2:TRADENAME,3:WINDOW,4:PRINTED,5:NOT SUSPENDED
"RTN","PSXRPPL",50,0)
 ;PSXOK=6:ALREADY RELEASED,7:DIFFERENT DIVISION,8:BAD DATA IN 52.5
"RTN","PSXRPPL",51,0)
 ;9:CS Mismatch,10:DEA 1 or 2
"RTN","PSXRPPL",52,0)
 I '$D(^PS(52.5,REC,0)) K ^PS(52.5,"AQ",SDT,XDFN,REC),^PS(52.5,"CMP","Q",PSXTYP,PSXTDIV,SDT,XDFN,REC) Q
"RTN","PSXRPPL",53,0)
 I $P(^PS(52.5,REC,0),"^",7)="" K ^PS(52.5,"AQ",SDT,XDFN,REC),^PS(52.5,"CMP","Q",PSXTYP,PSXTDIV,SDT,XDFN,REC) Q
"RTN","PSXRPPL",54,0)
 I ($P(^PS(52.5,REC,0),"^",3)'=XDFN) K ^PS(52.5,"AQ",SDT,XDFN,REC),^PS(52.5,"CMP","Q",PSXTYP,PSXTDIV,SDT,XDFN,REC) Q
"RTN","PSXRPPL",55,0)
 N DFN S DFN=XDFN D DEM^VADPT
"RTN","PSXRPPL",56,0)
 I $G(VADM(6))'="" D DELETE K VADM Q
"RTN","PSXRPPL",57,0)
 S PSXOK=0,NFLAG=0
"RTN","PSXRPPL",58,0)
 S RXN=$P($G(^PS(52.5,REC,0)),"^",1) I RXN="" S PSXOK=8 Q
"RTN","PSXRPPL",59,0)
 S RFL=+$$GET1^DIQ(52.5,REC,9,"I")
"RTN","PSXRPPL",60,0)
 I '$D(^TMP($J,"PSXBAI",DFN)) D
"RTN","PSXRPPL",61,0)
 .S PSXGOOD=$$ADDROK^PSXMISC1(RXN)
"RTN","PSXRPPL",62,0)
 .I 'PSXGOOD S PSXFIRST=1 D  I 'PSXFIRST S PSXOK=8
"RTN","PSXRPPL",63,0)
 ..D CHKACT^PSXMISC1(RXN)
"RTN","PSXRPPL",64,0)
 I PSXOK=8 K RXN Q
"RTN","PSXRPPL",65,0)
 ;
"RTN","PSXRPPL",66,0)
 N EPHQT S EPHQT=0
"RTN","PSXRPPL",67,0)
 I $$PATCH^XPDUTL("PSO*7.0*148") D EPHARM^PSXRPPL2 I EPHQT Q
"RTN","PSXRPPL",68,0)
 D CHKDATA^PSXMISC1
"RTN","PSXRPPL",69,0)
SET Q:(PSXOK=7)!(PSXOK=8)!(PSXOK=9)
"RTN","PSXRPPL",70,0)
 S PNAME=$G(VADM(1))
"RTN","PSXRPPL",71,0)
 I ($G(PSXCSRX)=1)&($G(PSXCS)=1) S ^XTMP("PSXCS",PSOSITE,DT,RXN)=""
"RTN","PSXRPPL",72,0)
 I (PSXOK=0)&(PSXFLAG=1) S ^TMP($J,"PSXDFN",XDFN)="",NFLAG=4 D DQUE,RX550215 Q
"RTN","PSXRPPL",73,0)
 I (PSXOK=0)&(PSXFLAG=2) D RX550215 Q
"RTN","PSXRPPL",74,0)
 I (PSXOK>0)&(PSXOK<7)!(PSXOK=10) D DELETE Q
"RTN","PSXRPPL",75,0)
 Q
"RTN","PSXRPPL",76,0)
 ;
"RTN","PSXRPPL",77,0)
DELETE ; deletes the CMOP STATUS field in PS(52.5, reindex 'AC' x-ref
"RTN","PSXRPPL",78,0)
 L +^PS(52.5,REC):600 Q:'$T
"RTN","PSXRPPL",79,0)
 N DR,DIE,DA S DIE="^PS(52.5,",DA=REC,DR="3///@" D ^DIE
"RTN","PSXRPPL",80,0)
 S ^PS(52.5,"AC",$P(^PS(52.5,REC,0),"^",3),$P(^PS(52.5,REC,0),"^",2),REC)=""
"RTN","PSXRPPL",81,0)
 L -^PS(52.5,REC)
"RTN","PSXRPPL",82,0)
 Q
"RTN","PSXRPPL",83,0)
 ;the rest of the sub-routines go through the ^PSX(550.2,,15,"C"
"RTN","PSXRPPL",84,0)
 ;global and checks for RXs within the days ahead range and
"RTN","PSXRPPL",85,0)
 ;builds the ^PSX(550.2,PSXBAT,
"RTN","PSXRPPL",86,0)
CHKDFN ; use the patient 'C' index under RX multiple in file 550.2 to GET dfn to gather Patients' future RXs
"RTN","PSXRPPL",87,0)
 I '$D(^PSX(550.2,PSXBAT,15,"C")) Q
"RTN","PSXRPPL",88,0)
 S PSXPTNM="" F  S PSXPTNM=$O(^PSX(550.2,PSXBAT,15,"C",PSXPTNM)) Q:PSXPTNM=""  D
"RTN","PSXRPPL",89,0)
 . S XDFN=0 F  S XDFN=$O(^PSX(550.2,PSXBAT,"15","C",PSXPTNM,XDFN)) Q:(XDFN'>0)  D
"RTN","PSXRPPL",90,0)
 . . S SDT=PRTDT F  S SDT=$O(^PS(52.5,"CMP","Q",PSXTYP,PSXTDIV,SDT)),NDFN=0 Q:(SDT>PSXDTRG)!(SDT="")  D
"RTN","PSXRPPL",91,0)
 . . . F  S NDFN=$O(^PS(52.5,"CMP","Q",PSXTYP,PSXTDIV,SDT,NDFN)),REC=0 Q:NDFN'>0  I NDFN=XDFN D
"RTN","PSXRPPL",92,0)
 . . . . F  S REC=$O(^PS(52.5,"CMP","Q",PSXTYP,PSXTDIV,SDT,NDFN,REC)) Q:REC'>0  D
"RTN","PSXRPPL",93,0)
 . . . . . D GETDATA D:$G(RXN) PSOUL^PSSLOCK(RXN),OERRLOCK(RXN)
"RTN","PSXRPPL",94,0)
 Q
"RTN","PSXRPPL",95,0)
BEGIN ; Select print device
"RTN","PSXRPPL",96,0)
 I '$D(PSOPAR) D ^PSOLSET
"RTN","PSXRPPL",97,0)
 I $D(PSOLAP),($G(PSOLAP)'=ION) S PSLION=PSOLAP G PROFILE
"RTN","PSXRPPL",98,0)
 W ! S %ZIS("A")="PRINTER 'LABEL' DEVICE:  ",%ZIS("B")="",%ZIS="MQN" D ^%ZIS S PSLION=ION G:POP EXIT
"RTN","PSXRPPL",99,0)
 I $G(IOST)["C-" W !,"You must select a printer!",! G BEGIN
"RTN","PSXRPPL",100,0)
 F J=0,1 S @("PSOBAR"_J)="" I $D(^%ZIS(2,^%ZIS(1,IOS,"SUBTYPE"),"BAR"_J)) S @("PSOBAR"_J)=^("BAR"_J)
"RTN","PSXRPPL",101,0)
 S PSOBARS=PSOBAR1]""&(PSOBAR0]"")&$P(PSOPAR,"^",19)
"RTN","PSXRPPL",102,0)
 K PSOION,J D ^%ZISC I $D(IO("Q")) K IO("Q")
"RTN","PSXRPPL",103,0)
PROFILE I $D(PSOPROP),($G(PSOPROP)'=ION) Q
"RTN","PSXRPPL",104,0)
 I $P(PSOPAR,"^",8) S %ZIS="MNQ",%ZIS("A")="Select PROFILE PRINTER: " D ^%ZIS K %ZIS,IO("Q"),IOP G:POP EXIT S PSOPROP=ION D ^%ZISC
"RTN","PSXRPPL",105,0)
 I $G(PSOPROP)=ION W !,"You must select a printer!",! G PROFILE
"RTN","PSXRPPL",106,0)
 Q
"RTN","PSXRPPL",107,0)
PRT ; w auto error trapping
"RTN","PSXRPPL",108,0)
 D NOW^%DTC S DTTM=% K %
"RTN","PSXRPPL",109,0)
 S NM="" F  S NM=$O(^PSX(550.2,PSXBAT,15,"C",NM)) Q:NM=""  D DFN,PPL ;gather patient RXs, print patient RXs
"RTN","PSXRPPL",110,0)
 S DIK="^PSX(550.2,",DA=PSXBAT D ^DIK K PSXBAT
"RTN","PSXRPPL",111,0)
 K CHKDT,CIND,DAYS,DRUG,DRUGCHK,NFLAG,NM,ORD,PDT,PHARCLK,PHY,PSTAT,PTRA,PTRB,QTY,REL,RXERR,RXF,SFN,SIG,SITE,SUS,SUSPT
"RTN","PSXRPPL",112,0)
 Q
"RTN","PSXRPPL",113,0)
DFN S DFN=0,NFLAG=2
"RTN","PSXRPPL",114,0)
 F  S DFN=$O(^PSX(550.2,PSXBAT,15,"C",NM,DFN)),RXN=0 Q:(DFN="")!(DFN'>0)  D
"RTN","PSXRPPL",115,0)
 .F  S RXN=$O(^PSX(550.2,PSXBAT,15,"C",NM,DFN,RXN)),RXF="" Q:(RXN="")!(RXN'>0)  D
"RTN","PSXRPPL",116,0)
 ..F  S RXF=$O(^PSX(550.2,PSXBAT,15,"C",NM,DFN,RXN,RXF)) Q:RXF=""  D BLD
"RTN","PSXRPPL",117,0)
 Q
"RTN","PSXRPPL",118,0)
BLD ;
"RTN","PSXRPPL",119,0)
 S BATRXDA=$O(^PSX(550.2,PSXBAT,15,"B",RXN,0)) D NOW^%DTC S DTTM=%
"RTN","PSXRPPL",120,0)
 S REC=$P(^PSX(550.2,PSXBAT,15,BATRXDA,0),U,5),SUS=$O(^PS(52.5,"B",RXN,0))
"RTN","PSXRPPL",121,0)
 I SUS=REC,+SUS'=0 I 1 ;rx still valid in suspense
"RTN","PSXRPPL",122,0)
 E  D  Q  ;rx gone
"RTN","PSXRPPL",123,0)
 . N DA,DIK S DIK=550.2,DA(1)=PSXBAT,DA=BATRXDA
"RTN","PSXRPPL",124,0)
 . D ^DIK
"RTN","PSXRPPL",125,0)
 S PSOSU(DFN,SUS)=RXN,RXCNTR=$G(RXCNTR)+1,NFLAG=2
"RTN","PSXRPPL",126,0)
 S $P(^PSRX(RXN,0),U,15)=0,$P(^PSRX(RXN,"STA"),U,1)=0
"RTN","PSXRPPL",127,0)
 K % S COM="CMOP Suspense Label "_$S($G(^PS(52.5,SUS,"P"))=0:"Printed",$G(^PS(52.5,SUS,"P"))="":"Printed",1:"Reprinted")_$S($G(^PSRX(RXN,"TYPE"))>0:" (PARTIAL)",1:"")
"RTN","PSXRPPL",128,0)
 D EN^PSOHLSN1(RXN,"SC","ZU",COM)
"RTN","PSXRPPL",129,0)
 S DA=SUS D DQUE K DA
"RTN","PSXRPPL",130,0)
ACTLOG F JJ=0:0 S JJ=$O(^PSRX(RXN,"A",JJ)) Q:'JJ  S CNT=JJ
"RTN","PSXRPPL",131,0)
 S RFCNT=0 F RF=0:0 S RF=$O(^PSRX(RXN,1,RF)) Q:'RF  S RFCNT=$S(RF<6:RF,1:RF+1)
"RTN","PSXRPPL",132,0)
 S CNT=CNT+1,^PSRX(RXN,"A",0)="^52.3DA^"_CNT_"^"_CNT
"RTN","PSXRPPL",133,0)
LOCK L +^PSRX(RXN):600 G:'$T LOCK
"RTN","PSXRPPL",134,0)
 S ^PSRX(RXN,"A",CNT,0)=DTTM_"^S^"_DUZ_"^"_RFCNT_"^"_COM L -^PSRX(RXN)
"RTN","PSXRPPL",135,0)
 K CNT,COM,RFCNT,%,JJ,RF,Y,RXCNTR
"RTN","PSXRPPL",136,0)
 Q
"RTN","PSXRPPL",137,0)
PPL K PPL,PPL1 S ORD="" F  S ORD=$O(PSOSU(ORD)) Q:(ORD="")!(ORD'>0)  D PPL1
"RTN","PSXRPPL",138,0)
 Q
"RTN","PSXRPPL",139,0)
PPL1 ; print patient labels
"RTN","PSXRPPL",140,0)
 F SFN=0:0 S SFN=$O(PSOSU(ORD,SFN)) Q:'SFN  D
"RTN","PSXRPPL",141,0)
 . S:$L($G(PPL))<240 PPL=$P(PSOSU(ORD,SFN),"^")_","_$G(PPL)
"RTN","PSXRPPL",142,0)
 . S:$L($G(PPL))>239 PPL1=$P(PSOSU(ORD,SFN),"^")_","_$G(PPL1)
"RTN","PSXRPPL",143,0)
 . S DFN=$P(^PS(52.5,SFN,0),"^",3)
"RTN","PSXRPPL",144,0)
 S SUSPT=1,PSNP=$S($P(PSOPAR,"^",8):1,1:0) S:$D(PSOPROP) PFIO=PSOPROP
"RTN","PSXRPPL",145,0)
 D QLBL^PSORXL
"RTN","PSXRPPL",146,0)
 I $D(PPL1) S PSNP=0,PPL=PPL1 D QLBL^PSORXL
"RTN","PSXRPPL",147,0)
 K PPL,PPL1,PSOSU(ORD)
"RTN","PSXRPPL",148,0)
 Q
"RTN","PSXRPPL",149,0)
DQUE ; sets the CMOP indicator field, and printed field in 52.5
"RTN","PSXRPPL",150,0)
 L +^PS(52.5,REC):600 G:'$T DQUE
"RTN","PSXRPPL",151,0)
 I NFLAG=4 D
"RTN","PSXRPPL",152,0)
 . S DA=REC,DIE="^PS(52.5,",DR="3////L;4////"_DT D ^DIE K DIE,DA,DR L -^PS(52.5,REC)  ; the rest moved into PSXRTR
"RTN","PSXRPPL",153,0)
 S CIND=$S(NFLAG=1:"X",NFLAG=2:"P",NFLAG=3:"@",1:0)
"RTN","PSXRPPL",154,0)
 I $G(NFLAG)'=2 D
"RTN","PSXRPPL",155,0)
 .S DA=REC,DIE="^PS(52.5,",DR="3////"_CIND_";4////"_DT
"RTN","PSXRPPL",156,0)
 .D ^DIE K DIE,DA,DR
"RTN","PSXRPPL",157,0)
 .S ^PS(52.5,REC,"P")=1,^PS(52.5,"ADL",DT,REC)=""
"RTN","PSXRPPL",158,0)
 I $G(NFLAG)=2 D  ;print label cycle
"RTN","PSXRPPL",159,0)
 . S DA=REC,DIE="^PS(52.5,",DR="3////"_CIND_";4////"_DTTM_";5////"_DUZ_";7////"_RXCNTR
"RTN","PSXRPPL",160,0)
 . D ^DIE K DIE,DA,DR
"RTN","PSXRPPL",161,0)
 . S ^PS(52.5,REC,"P")=1,^PS(52.5,"ADL",$E($P(^PS(52.5,REC,0),"^",8),1,7),REC)=""
"RTN","PSXRPPL",162,0)
 L -^PS(52.5,REC)
"RTN","PSXRPPL",163,0)
 I $G(NFLAG)=2 D EN^PSOHLSN1(RXN,"SC","ZU","CMOP Suspense Label Printed")
"RTN","PSXRPPL",164,0)
 Q
"RTN","PSXRPPL",165,0)
RX550215 ; put RX into RX multiple TRANS 550.215 for PSXBAT
"RTN","PSXRPPL",166,0)
 I '$G(PSXBAT) D BATCH^PSXRSYU ; first time through create batch, & return PSXBAT
"RTN","PSXRPPL",167,0)
 K DD,DO,DIC,DA,DR,D0
"RTN","PSXRPPL",168,0)
 S:'$D(^PSX(550.2,PSXBAT,15,0)) ^PSX(550.2,PSXBAT,15,0)="^550.215P^^"
"RTN","PSXRPPL",169,0)
 S X=RXN,DA(1)=PSXBAT
"RTN","PSXRPPL",170,0)
 S DIC="^PSX(550.2,"_PSXBAT_",15,",DIC("DR")=".02////^S X=RXF;.03////^S X=DFN;.05////^S X=REC",DIC(0)="ZF"
"RTN","PSXRPPL",171,0)
 D FILE^DICN
"RTN","PSXRPPL",172,0)
 S PSXRXTDA=+Y ;RX DA within PSXBAT 'T'ransmission
"RTN","PSXRPPL",173,0)
 K DD,DO,DIC,DA,DR,D0
"RTN","PSXRPPL",174,0)
 Q
"RTN","PSXRPPL",175,0)
OERRLOCK(RXN) ; set XTMP for OERR/CPRS order locking
"RTN","PSXRPPL",176,0)
 I $G(PSXBAT),$G(RXN),$G(PSXRXTDA) I 1
"RTN","PSXRPPL",177,0)
 E  Q
"RTN","PSXRPPL",178,0)
 I $P(^PSX(550.2,PSXBAT,15,PSXRXTDA,0),U,1)'=RXN Q
"RTN","PSXRPPL",179,0)
RXNSET ; set ^XTMP("ORLK-"_ORDER per IA 4001 needs RXN
"RTN","PSXRPPL",180,0)
 Q:'$G(RXN)
"RTN","PSXRPPL",181,0)
 N ORD,NOW,NOW1 S ORD=+$P($G(^PSRX(+$G(RXN),"OR1")),"^",2)
"RTN","PSXRPPL",182,0)
 Q:'ORD
"RTN","PSXRPPL",183,0)
 S NOW=$$NOW^XLFDT,NOW1=$$FMADD^XLFDT(NOW,1)
"RTN","PSXRPPL",184,0)
 S ^XTMP("ORLK-"_+ORD,0)=NOW1_U_NOW_"^CPRS/CMOP RX/Order Lock",^(1)=DUZ_U_$J
"RTN","PSXRPPL",185,0)
 Q
"RTN","PSXRPPL",186,0)
RXNCLEAR ; needs RXN
"RTN","PSXRPPL",187,0)
 Q:'$G(RXN)
"RTN","PSXRPPL",188,0)
 N ORD S ORD=+$P($G(^PSRX(+$G(RXN),"OR1")),"^",2) Q:'ORD
"RTN","PSXRPPL",189,0)
 I $D(^XTMP("ORLK-"_ORD,0)),^(0)["CPRS/CMOP" K ^XTMP("ORLK-"_ORD)
"RTN","PSXRPPL",190,0)
 Q
"RTN","PSXRPPL1")
0^2^B52609779^B48850294
"RTN","PSXRPPL1",1,0)
PSXRPPL1 ;BIR/WPB-Resets Suspense to Print/Transmit ;[ 10/02/97  3:13 PM ]
"RTN","PSXRPPL1",2,0)
 ;;2.0;CMOP;**3,48,62,66,65**;11 Apr 97;Build 31
"RTN","PSXRPPL1",3,0)
 ;Reference to ^PSRX( supported by DBIA #1977
"RTN","PSXRPPL1",4,0)
 ;Reference to File #59  supported by DBIA #1976
"RTN","PSXRPPL1",5,0)
 ;Reference to PSOSURST  supported by DBIA #1970
"RTN","PSXRPPL1",6,0)
 ;Reference to ^PS(52.5, supported by DBIA #1978
"RTN","PSXRPPL1",7,0)
 ;Reference to ^BPSUTIL  supported by DBIA #4410
"RTN","PSXRPPL1",8,0)
 ;Reference to ^PSSLOCK  supported by DBIA #2789
"RTN","PSXRPPL1",9,0)
 ;Reference to ^PSOBPSUT supported by DBIA #4701
"RTN","PSXRPPL1",10,0)
 ;Reference to ^PSOBPSU1 supported by DBIA #4702
"RTN","PSXRPPL1",11,0)
 ;Reference to ^PSOREJUT supported by DBIA #4706
"RTN","PSXRPPL1",12,0)
 ;Reference to ^PSOREJU3 supported by DBIA #5186
"RTN","PSXRPPL1",13,0)
 ;Reference to ^PSOBPSU2 supported by DBIA #4970
"RTN","PSXRPPL1",14,0)
 ;Reference to ^PSOSULB1 supported by DBIA #2478
"RTN","PSXRPPL1",15,0)
 ;
"RTN","PSXRPPL1",16,0)
 ;This routine will reset the Queued flags and the printed flags in
"RTN","PSXRPPL1",17,0)
 ;PS(52.5 to 'Queued' and 'Printed' respectively and either retransmits
"RTN","PSXRPPL1",18,0)
 ;the data to the CMOP or prints the labels.
"RTN","PSXRPPL1",19,0)
START ;initializes local variables
"RTN","PSXRPPL1",20,0)
 I '$D(^XUSEC("PSXCMOPMGR",DUZ)) W !,"You are not authorized to use this option!" Q
"RTN","PSXRPPL1",21,0)
 I '$D(^XUSEC("PSX XMIT",DUZ)) W !,"You are not authorized to use this option!" Q
"RTN","PSXRPPL1",22,0)
 S SWITCH=0
"RTN","PSXRPPL1",23,0)
 K ^TMP($J,"PSX")
"RTN","PSXRPPL1",24,0)
QRY ;initial message and option menu
"RTN","PSXRPPL1",25,0)
 W !
"RTN","PSXRPPL1",26,0)
 S DIR(0)="NAO^1:3:0",DIR("A")="Select (1, 2, 3):  ",DIR("A",1)="  1 - Reset CMOP Batches for Transmission"
"RTN","PSXRPPL1",27,0)
 S DIR("A",2)="  2 - Reprint CMOP Batches",DIR("A",4)="  3 - Standard Reprint Batches from Suspense"
"RTN","PSXRPPL1",28,0)
 S DIR("?")="Enter a number between 1 and 3.",DIR("??")=$S($G(PSXVER):"^D HELP^PSXSRP",1:"^D MSG2^PSXRHLP") D ^DIR K DIR G:(Y<0)!($D(DIRUT)) EXIT S REPLY=Y K Y,X
"RTN","PSXRPPL1",29,0)
 I REPLY=1 S (PSXTRANS,PSXFLAG,SWITCH)=1 G:$G(PSXVER) ^PSXSRST G:'$G(PSXVER) BEGIN
"RTN","PSXRPPL1",30,0)
 I REPLY=2 S (PSXTRANS,PSXFLAG,SWITCH)=2 G:$G(PSXVER) ^PSXSRST G:'$G(PSXVER) BEGIN
"RTN","PSXRPPL1",31,0)
 I REPLY=3 S PSXFLG=1 G START^PSOSURST
"RTN","PSXRPPL1",32,0)
 K REPLY
"RTN","PSXRPPL1",33,0)
 Q
"RTN","PSXRPPL1",34,0)
BEGIN ;confirms CMOP processing, if Yes, checks for active site and status
"RTN","PSXRPPL1",35,0)
 ;in the CMOP System file, if not an active site or the system status
"RTN","PSXRPPL1",36,0)
 ;is not stopped the routine exits and processing stops
"RTN","PSXRPPL1",37,0)
 W !
"RTN","PSXRPPL1",38,0)
 S DIR(0)="Y",DIR("B")="NO",DIR("A")="Are you sure you want to continue",DIR("?",1)="No - Exits."
"RTN","PSXRPPL1",39,0)
 S DIR("?")=$S(SWITCH=1:"Yes - Transmits data to the CMOP.",SWITCH=2:"Yes - Prints labels.",1:0) D ^DIR K DIR G:(Y=0)!($D(DIRUT)) EXIT K Y
"RTN","PSXRPPL1",40,0)
 S STATUS=$P($G(^PSX(550,+PSXSYS,0)),"^",3) I STATUS'="H" W !,"There is another job in process, please try again later." G EXIT
"RTN","PSXRPPL1",41,0)
ASK ;gets date for the resets
"RTN","PSXRPPL1",42,0)
 K BEGDATE,ENDDATE W !!,?10,$S($G(SWITCH)=1:"RESET and TRANSMIT CMOP DATA",$G(SWITCH)=2:"RESET and REPRINT CMOP LABELS",1:""),!!!,"**** Date Selection ****",!!
"RTN","PSXRPPL1",43,0)
ASK1 I SWITCH=1 S %DT="AEX",%DT("A")="   BEGIN DATE:  " D ^%DT K %DT,%DT("A") G:Y<0 EXIT S PRTDT=Y
"RTN","PSXRPPL1",44,0)
 I SWITCH=2 S %DT="AEX",%DT("A")="   BEGIN DATE:  " D ^%DT K %DT,%DT("A") G:Y<0 EXIT S PRTDT=Y
"RTN","PSXRPPL1",45,0)
 W !! S %DT="AEX",%DT("A")="   ENDING DATE:  " D ^%DT Q:Y<0  S PSXDTRG=Y K %DT,%DT("A")
"RTN","PSXRPPL1",46,0)
 I $G(PRTDT)>$G(PSXDTRG) W !,"Begin Date must be before Ending Date!" G ASK1
"RTN","PSXRPPL1",47,0)
 I '$O(^PS(52.5,"AP",PRTDT-1))!($O(^(0))>PSXDTRG) W !!,$S(SWITCH=1:"Nothing to Transmit.",SWITCH=2:"Nothing to Reprint.",1:0) G EXIT
"RTN","PSXRPPL1",48,0)
 D SDT S PSXERFLG=0
"RTN","PSXRPPL1",49,0)
 I SWITCH=1 D PSXTRANS Q
"RTN","PSXRPPL1",50,0)
 I SWITCH=2 D PRINT Q
"RTN","PSXRPPL1",51,0)
 S PSXSTAT="H" D PSXSTAT^PSXRSYU
"RTN","PSXRPPL1",52,0)
 G EXIT
"RTN","PSXRPPL1",53,0)
PSXTRANS ;
"RTN","PSXRPPL1",54,0)
 W !!
"RTN","PSXRPPL1",55,0)
 S DIR(0)="Y",DIR("B")="YES",DIR("A")="DO YOU WISH TO TRANSMIT TO THE CMOP NOW",DIR("?",1)="No - Exits the option.",DIR("?")="Yes - Transmits to the CMOP." D ^DIR K DIR Q:(Y=0)!($D(DIRUT))  K Y
"RTN","PSXRPPL1",56,0)
 S PSXSTAT="T" D PSXSTAT^PSXRSYU,ASK^PSXRSUS
"RTN","PSXRPPL1",57,0)
 Q
"RTN","PSXRPPL1",58,0)
PRINT ;
"RTN","PSXRPPL1",59,0)
 W !!
"RTN","PSXRPPL1",60,0)
 S DIR(0)="Y",DIR("B")="YES",DIR("A")="DO YOU WISH REPRINT CMOP LABELS NOW",DIR("?",1)="No - Exits the option.",DIR("?")="Yes - Reprints CMOP labels." D ^DIR K DIR Q:(Y=0)!($D(DIRUT))  K Y
"RTN","PSXRPPL1",61,0)
 S PSXSTAT="T" D PSXSTAT^PSXRSYU,ASK^PSXRSUS
"RTN","PSXRPPL1",62,0)
 Q
"RTN","PSXRPPL1",63,0)
SDT ;the following subroutines go through the PS(52.5 global and pull the
"RTN","PSXRPPL1",64,0)
 ;data needed to reset the Queued/Printed nodes
"RTN","PSXRPPL1",65,0)
 S SDT=PRTDT-1 F  S SDT=$O(^PS(52.5,"AP",SDT)),DFN=0 Q:(SDT>PSXDTRG)!(SDT="")  D DFN
"RTN","PSXRPPL1",66,0)
 Q
"RTN","PSXRPPL1",67,0)
DFN ;
"RTN","PSXRPPL1",68,0)
 F  S DFN=$O(^PS(52.5,"AP",SDT,DFN)),REC=0 Q:(DFN="")!(DFN'>0)  D REC
"RTN","PSXRPPL1",69,0)
 Q
"RTN","PSXRPPL1",70,0)
REC ;
"RTN","PSXRPPL1",71,0)
 F  S REC=$O(^PS(52.5,"AP",SDT,DFN,REC)) Q:(REC'>0)!(REC="")  D:$G(^PS(52.5,REC,0)) CHECK
"RTN","PSXRPPL1",72,0)
 K ZDIV
"RTN","PSXRPPL1",73,0)
 Q
"RTN","PSXRPPL1",74,0)
CHECK ;
"RTN","PSXRPPL1",75,0)
 S STAT=$P($G(^PS(52.5,REC,0)),U,7),PRINT=$G(^PS(52.5,REC,"P")),PSXPTR=$P($G(^PS(52.5,REC,0)),U,1)
"RTN","PSXRPPL1",76,0)
 S RXF="" F XXF=0:0 S XXF=$O(^PSRX(PSXPTR,1,XXF)) Q:XXF'>0  S RXF=XXF
"RTN","PSXRPPL1",77,0)
 S ZDIV=$S($G(RXF)>0:$P($G(^PSRX(PSXPTR,1,RXF,0)),U,9),1:$P($G(^PSRX(PSXPTR,2)),U,9)) I $G(ZDIV)'=$G(PSOSITE) Q
"RTN","PSXRPPL1",78,0)
 S:RXF'="" GONE=$P($G(^PSRX(PSXPTR,1,RXF,0)),U,18)
"RTN","PSXRPPL1",79,0)
 S:RXF="" GONE=$P($G(^PSRX(PSXPTR,2)),U,13)
"RTN","PSXRPPL1",80,0)
 I (STAT="P")&(PRINT=1)&($G(GONE)="") D RESET
"RTN","PSXRPPL1",81,0)
 K GONE,RXF,XXF
"RTN","PSXRPPL1",82,0)
 Q
"RTN","PSXRPPL1",83,0)
RESET ;resets the Queued/Printed flags to Queued and not Printed
"RTN","PSXRPPL1",84,0)
 L +^PS(52.5,REC):DTIME Q:'$T
"RTN","PSXRPPL1",85,0)
 S DIE="^PS(52.5,",DA=REC,DR="2////2;3////Q" D ^DIE L -^PS(52.5,REC) K DIE,DR,DA
"RTN","PSXRPPL1",86,0)
 S:$G(PSXVER) $P(^PSRX(PSXPTR,"STA"),U,1)=5 S:'$G(PSXVER) $P(^PSRX(PSXPTR,0),U,15)=5 K ^PS(52.5,"AC",DFN,SDT,REC)
"RTN","PSXRPPL1",87,0)
 Q
"RTN","PSXRPPL1",88,0)
PRTERR ; auto error trap for prt cmop local
"RTN","PSXRPPL1",89,0)
 S XXERR=$$EC^%ZOSV
"RTN","PSXRPPL1",90,0)
 S PSXDIVNM=$$GET1^DIQ(59,PSOSITE,.01)
"RTN","PSXRPPL1",91,0)
 ;save an image of the transient file 550.1 for 2 days
"RTN","PSXRPPL1",92,0)
 D NOW^%DTC S DTTM=%
"RTN","PSXRPPL1",93,0)
 S X=$$FMADD^XLFDT(DT,+2) S ^XTMP("PSXERR "_DTTM,0)=X_U_DT_U_"CMOP "_XXERR
"RTN","PSXRPPL1",94,0)
 M ^XTMP("PSXERR "_DTTM,550.1)=^PSX(550.1)
"RTN","PSXRPPL1",95,0)
 S XMSUB="CMOP Error "_PSXDIVNM_" "_$$GET1^DIQ(550.2,+$G(PSXBAT),.01)
"RTN","PSXRPPL1",96,0)
 D GRP1^PSXNOTE
"RTN","PSXRPPL1",97,0)
 ;S XMY(DUZ)=""
"RTN","PSXRPPL1",98,0)
 S XMTEXT="TEXT("
"RTN","PSXRPPL1",99,0)
 S TEXT(1,0)=$S($G(PSXCS):"",1:"NON-")_"CS CMOP Print Local encountered the following error. Please investigate"
"RTN","PSXRPPL1",100,0)
 S TEXT(2,0)="Division:         "_PSXDIVNM
"RTN","PSXRPPL1",101,0)
 S TEXT(3,0)="Type/Batch        "_$S($G(PSXCS):"CS",1:"NON-CS")_" / "_$$GET1^DIQ(550.2,$G(PSXBAT),.01)
"RTN","PSXRPPL1",102,0)
 S TEXT(4,0)="Error:            "_XXERR
"RTN","PSXRPPL1",103,0)
 S TEXT(5,0)="This batch has been set to closed."
"RTN","PSXRPPL1",104,0)
 S TEXT(6,0)="Call NVS to investigate which prescriptions have been printed and which are yet to print."
"RTN","PSXRPPL1",105,0)
 S TEXT(7,0)="A copy of file 550.1 can be found in ^XTMP(""PSXERR "_DTTM_""")"
"RTN","PSXRPPL1",106,0)
 D ^%ZTER
"RTN","PSXRPPL1",107,0)
 D ^XMD
"RTN","PSXRPPL1",108,0)
 I $G(PSXBAT) D
"RTN","PSXRPPL1",109,0)
 . N DA,DIE,DR S DIE="^PSX(550.2,",DA=PSXBAT,DR="1////4"
"RTN","PSXRPPL1",110,0)
 . D ^DIE
"RTN","PSXRPPL1",111,0)
 G UNWIND^%ZTER
"RTN","PSXRPPL1",112,0)
 ;
"RTN","PSXRPPL1",113,0)
SBTECME(PSXTP,PSXDV,THRDT,PULLDT) ; - Sumitting prescriptions to EMCE (3rd Party Billing)
"RTN","PSXRPPL1",114,0)
 ;Input: PSXTP  - Type of prescriptions "C" - Controlled Subs / "N" Non-Controlled Subs
"RTN","PSXRPPL1",115,0)
 ;       PSXDV  - Pointer to DIVSION file (#59)
"RTN","PSXRPPL1",116,0)
 ;       THRDT  - T+N when scheduling the THROUGH DATE to run CMOP Transmission
"RTN","PSXRPPL1",117,0)
 ;       PULLDT - T+N+PULL DAYS parameter in the DIVISION file (#59)
"RTN","PSXRPPL1",118,0)
 ;Output:SBTECME- Number of prescriptions submitted to ECME
"RTN","PSXRPPL1",119,0)
 N RX,RFL,SBTECME,PSOLRX,RESP,SDT,XDFN,REC,PSOLRX,DOS
"RTN","PSXRPPL1",120,0)
 I '$$ECMEON^BPSUTIL(PSXDV)!'$$CMOPON^BPSUTIL(PSXDV) Q
"RTN","PSXRPPL1",121,0)
 S (SDT,SBTECME)=0 K ^TMP("PSXEPHDFN",$J)
"RTN","PSXRPPL1",122,0)
 F  S SDT=$O(^PS(52.5,"CMP","Q",PSXTP,PSXDV,SDT)) S XDFN=0 Q:(SDT>PULLDT)!(SDT'>0)  D
"RTN","PSXRPPL1",123,0)
 . F  S XDFN=$O(^PS(52.5,"CMP","Q",PSXTP,PSXDV,SDT,XDFN)) S REC=0 Q:(XDFN'>0)!(XDFN="")  D
"RTN","PSXRPPL1",124,0)
 . . F  S REC=$O(^PS(52.5,"CMP","Q",PSXTP,PSXDV,SDT,XDFN,REC)) Q:(REC'>0)!(REC="")  D
"RTN","PSXRPPL1",125,0)
 . . . S (PSOLRX,RX)=+$$GET1^DIQ(52.5,REC,.01,"I") I 'RX Q
"RTN","PSXRPPL1",126,0)
 . . . S RFL=$$GET1^DIQ(52.5,REC,9,"I") I RFL="" S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSXRPPL1",127,0)
 . . . I $$XMIT^PSXBPSUT(REC) D
"RTN","PSXRPPL1",128,0)
 . . . . I SDT>THRDT,'$D(^TMP("PSXEPHDFN",$J,XDFN)) Q
"RTN","PSXRPPL1",129,0)
 . . . . I $$PATCH^XPDUTL("PSO*7.0*148") D
"RTN","PSXRPPL1",130,0)
 . . . . . I $$RETRX^PSOBPSUT(RX,RFL),SDT>DT Q
"RTN","PSXRPPL1",131,0)
 . . . . . I $$DOUBLE(RX,RFL) Q
"RTN","PSXRPPL1",132,0)
 . . . . . I $$FIND^PSOREJUT(RX,RFL,,"79,88") Q
"RTN","PSXRPPL1",133,0)
 . . . . . I '$$RETRX^PSOBPSUT(RX,RFL),'$$ECMESTAT^PSXRPPL2(RX,RFL) Q
"RTN","PSXRPPL1",134,0)
 . . . . . I $$PATCH^XPDUTL("PSO*7.0*289") Q:'$$DUR^PSXRPPL2(RX,RFL)  ;ePharm Host error hold
"RTN","PSXRPPL1",135,0)
 . . . . . I $$PATCH^XPDUTL("PSO*7.0*289"),$$STATUS^PSOBPSUT(RX,RFL-1)'="" Q:'$$DSH^PSXRPPL2(REC)  ;ePharm 3/4 days supply
"RTN","PSXRPPL1",136,0)
 . . . . . S DOS=$$RXFLDT^PSOBPSUT(RX,RFL) I DOS>DT S DOS=DT
"RTN","PSXRPPL1",137,0)
 . . . . . D ECMESND^PSOBPSU1(RX,RFL,DOS,"PC",,1,,,,.RESP)
"RTN","PSXRPPL1",138,0)
 . . . . . I $$PATCH^XPDUTL("PSO*7.0*287"),$$TRISTA^PSOREJU3(RXN,RFL,.RESP,"PC") S ^TMP("PSXEPHNB",$J,RX,RFL)=$G(RESP)
"RTN","PSXRPPL1",139,0)
 . . . . . I $D(RESP),'RESP S SBTECME=SBTECME+1
"RTN","PSXRPPL1",140,0)
 . . . . . S ^TMP("PSXEPHDFN",$J,XDFN)=""
"RTN","PSXRPPL1",141,0)
 . . . D PSOUL^PSSLOCK(PSOLRX)
"RTN","PSXRPPL1",142,0)
 K ^TMP("PSXEPHDFN",$J)
"RTN","PSXRPPL1",143,0)
 Q SBTECME
"RTN","PSXRPPL1",144,0)
 ;
"RTN","PSXRPPL1",145,0)
DOUBLE(RX,RFL) ; Checks if previous fill is still being worked on by CMOP
"RTN","PSXRPPL1",146,0)
 ;Input: (r) RX  - Prescription IEN
"RTN","PSXRPPL1",147,0)
 ;       (r) RFL - Fill number
"RTN","PSXRPPL1",148,0)
 ;Output:    0 - Previous fill not with CMOP / 1 - CMOP working on previous fill
"RTN","PSXRPPL1",149,0)
 N CMP,DOUBLE,STS
"RTN","PSXRPPL1",150,0)
 ; 
"RTN","PSXRPPL1",151,0)
 I 'RFL!'$D(^PSRX(RX,4)) Q 0
"RTN","PSXRPPL1",152,0)
 I $$STATUS^PSOBPSUT(RX,RFL-1)="" Q 0
"RTN","PSXRPPL1",153,0)
 S DOUBLE=0,CMP=999
"RTN","PSXRPPL1",154,0)
 F  S CMP=$O(^PSRX(RX,4,CMP),-1) Q:'CMP  D  I DOUBLE Q
"RTN","PSXRPPL1",155,0)
 . I $$GET1^DIQ(52.01,CMP_","_RX,2,"I")'=(RFL-1) Q
"RTN","PSXRPPL1",156,0)
 . S STS=$$GET1^DIQ(52.01,CMP_","_RX,3,"I")
"RTN","PSXRPPL1",157,0)
 . I STS=0!(STS=2) S DOUBLE=1
"RTN","PSXRPPL1",158,0)
 Q DOUBLE
"RTN","PSXRPPL1",159,0)
 ;
"RTN","PSXRPPL1",160,0)
EXIT ;
"RTN","PSXRPPL1",161,0)
 K DFN,PSXDAYS,PSXDTRG,SWITCH,STAT,PRINT,PSXTRANS,REC,REPLY,SDT,X,X1,X2,Y,ANSWER,STATUS,PSXFLAG,PSXPTR,PSXSTAT
"RTN","PSXRPPL1",162,0)
 K DIR,DIRUT,DTOUT,DUOUT,DIROUT
"RTN","PSXRPPL1",163,0)
 Q
"RTN","PSXRPPL2")
0^6^B46802908^n/a
"RTN","PSXRPPL2",1,0)
PSXRPPL2 ;BIR/WPB - Print From Suspense Utilities ;06/10/08
"RTN","PSXRPPL2",2,0)
 ;;2.0;CMOP;**65**;11 Apr 97;Build 31
"RTN","PSXRPPL2",3,0)
 ;Reference to ^PSRX( supported by DBIA #1977
"RTN","PSXRPPL2",4,0)
 ;Reference to ^PS(52.5, supported by DBIA #1978
"RTN","PSXRPPL2",5,0)
 ;Reference to ^PSSLOCK  supported by DBIA #2789
"RTN","PSXRPPL2",6,0)
 ;Reference to ^PSOBPSUT supported by DBIA #4701
"RTN","PSXRPPL2",7,0)
 ;Reference to ^PSOBPSU1 supported by DBIA #4702
"RTN","PSXRPPL2",8,0)
 ;Reference to ^PSOBPSU2 supported by DBIA #4970
"RTN","PSXRPPL2",9,0)
 ;Reference to ^PSOREJUT supported by DBIA #4706
"RTN","PSXRPPL2",10,0)
 ;Reference to ^PSOREJU3 supported by DBIA #5186
"RTN","PSXRPPL2",11,0)
 ;Reference to $$DEA^IBNCPDP controlled subscription by IA 4299
"RTN","PSXRPPL2",12,0)
 ;Reference to CHANGE^PSOSUCH1 suppored by DBIA #5427
"RTN","PSXRPPL2",13,0)
 ;
"RTN","PSXRPPL2",14,0)
CHKDFN(THRDT) ; use the patient 'C' index under RX multiple in file 550.2 to GET dfn to gather Patients' future RXs
"RTN","PSXRPPL2",15,0)
 ;Input: THRDT - THROUGH DATE to run CMOP transmission
"RTN","PSXRPPL2",16,0)
 ;
"RTN","PSXRPPL2",17,0)
 I '$D(^PSX(550.2,PSXBAT,15,"C")) Q
"RTN","PSXRPPL2",18,0)
 S (SBTECME)=0 K ^TMP("PSXEPHDFN",$J)
"RTN","PSXRPPL2",19,0)
 S PSXPTNM="" F  S PSXPTNM=$O(^PSX(550.2,PSXBAT,15,"C",PSXPTNM)) Q:PSXPTNM=""  D
"RTN","PSXRPPL2",20,0)
 . S XDFN=0 F  S XDFN=$O(^PSX(550.2,PSXBAT,"15","C",PSXPTNM,XDFN)) Q:(XDFN'>0)  D
"RTN","PSXRPPL2",21,0)
 . . S SDT=PRTDT F  S SDT=$O(^PS(52.5,"CMP","Q",PSXTYP,PSXTDIV,SDT)),NDFN=0 Q:(SDT>PSXDTRG)!(SDT="")  D
"RTN","PSXRPPL2",22,0)
 . . . F  S NDFN=$O(^PS(52.5,"CMP","Q",PSXTYP,PSXTDIV,SDT,NDFN)),REC=0 Q:NDFN'>0  I NDFN=XDFN D
"RTN","PSXRPPL2",23,0)
 . . . . F  S REC=$O(^PS(52.5,"CMP","Q",PSXTYP,PSXTDIV,SDT,NDFN,REC)) Q:REC'>0  D
"RTN","PSXRPPL2",24,0)
 . . . . . S (PSOLRX,RX)=+$$GET1^DIQ(52.5,REC,.01,"I") I 'RX Q
"RTN","PSXRPPL2",25,0)
 . . . . . S RFL=$$GET1^DIQ(52.5,REC,9,"I") I RFL="" S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSXRPPL2",26,0)
 . . . . . I $$XMIT^PSXBPSUT(REC) D
"RTN","PSXRPPL2",27,0)
 . . . . . . I SDT>THRDT,'$D(^TMP("PSXEPHDFN",$J,XDFN)) Q
"RTN","PSXRPPL2",28,0)
 . . . . . . I $$PATCH^XPDUTL("PSO*7.0*148") D
"RTN","PSXRPPL2",29,0)
 . . . . . . . I $$RETRX^PSOBPSUT(RX,RFL),SDT>DT Q
"RTN","PSXRPPL2",30,0)
 . . . . . . . I $$DOUBLE^PSXRPPL1(RX,RFL) Q
"RTN","PSXRPPL2",31,0)
 . . . . . . . I $$FIND^PSOREJUT(RX,RFL,,"79,88") Q
"RTN","PSXRPPL2",32,0)
 . . . . . . . I '$$RETRX^PSOBPSUT(RX,RFL),'$$ECMESTAT(RX,RFL) Q
"RTN","PSXRPPL2",33,0)
 . . . . . . . I $$PATCH^XPDUTL("PSO*7.0*289"),'$$DUR(RX,RFL),'$$DSH(REC) Q
"RTN","PSXRPPL2",34,0)
 . . . . . . . S DOS=$$RXFLDT^PSOBPSUT(RX,RFL) I DOS>DT S DOS=DT
"RTN","PSXRPPL2",35,0)
 . . . . . . . D ECMESND^PSOBPSU1(RX,RFL,DOS,"PC",,1,,,,.RESP)
"RTN","PSXRPPL2",36,0)
 . . . . . . . I $$PATCH^XPDUTL("PSO*7.0*287"),$$TRISTA^PSOREJU3(RXN,RFL,.RESP,"PC") S ^TMP("PSXEPHNB",$J,RX,RFL)=$G(RESP)
"RTN","PSXRPPL2",37,0)
 . . . . . . . I $D(RESP),'RESP S SBTECME=SBTECME+1
"RTN","PSXRPPL2",38,0)
 . . . . .  . .S ^TMP("PSXEPHDFN",$J,XDFN)=""
"RTN","PSXRPPL2",39,0)
 . . . . . D PSOUL^PSSLOCK(PSOLRX)
"RTN","PSXRPPL2",40,0)
 K ^TMP("PSXEPHDFN",$J)
"RTN","PSXRPPL2",41,0)
 I SBTECME>0 H 60+$S((SBTECME*15)>7200:7200,1:(SBTECME*15))
"RTN","PSXRPPL2",42,0)
 Q
"RTN","PSXRPPL2",43,0)
 ;
"RTN","PSXRPPL2",44,0)
EPHARM ; - ePharmacy checks for third party billing
"RTN","PSXRPPL2",45,0)
 I $$DOUBLE^PSXRPPL1(RXN,RFL) S EPHQT=1 Q
"RTN","PSXRPPL2",46,0)
 I $$RETRX^PSOBPSUT(RXN,RFL),SDT>DT S EPHQT=1 Q
"RTN","PSXRPPL2",47,0)
 I $$FIND^PSOREJUT(RXN,RFL,,"79,88") S EPHQT=1 Q
"RTN","PSXRPPL2",48,0)
 I $$PATCH^XPDUTL("PSO*7.0*287"),$$TRISTA^PSOREJU3(RXN,RFL,.RESP,"PC") D EPH Q
"RTN","PSXRPPL2",49,0)
 I $$PATCH^XPDUTL("PSO*7.0*287"),$D(^TMP("PSXEPHNB",$J,RXN,RFL)) D EPH Q
"RTN","PSXRPPL2",50,0)
 I $$STATUS^PSOBPSUT(RXN,RFL)="IN PROGRESS" D EPH Q
"RTN","PSXRPPL2",51,0)
 I $$PATCH^XPDUTL("PSO*7.0*289"),'$$DSH(REC) S EPHQT=1 Q
"RTN","PSXRPPL2",52,0)
 I $$PATCH^XPDUTL("PSO*7.0*289"),'$$DUR(RXN,RFL) D EPH Q
"RTN","PSXRPPL2",53,0)
 Q
"RTN","PSXRPPL2",54,0)
 ;
"RTN","PSXRPPL2",55,0)
EPH ; - Store Rx not xmitted to CMOP in XTMP file for MailMan message.
"RTN","PSXRPPL2",56,0)
 S ^TMP("PSXEPHIN",$J,$$RXSITE^PSOBPSUT(RXN),RXN)=RFL,EPHQT=1
"RTN","PSXRPPL2",57,0)
 Q
"RTN","PSXRPPL2",58,0)
 ;
"RTN","PSXRPPL2",59,0)
 ;Description:
"RTN","PSXRPPL2",60,0)
 ;This function checks the Rx's ECME Status to determine if it's acceptable to resubmit
"RTN","PSXRPPL2",61,0)
 ;based on reject codes associated with a previous submission. If Rx was rejected with
"RTN","PSXRPPL2",62,0)
 ;host reject errors, and no other rejects exist, then it's OK to resubmit to ECME.
"RTN","PSXRPPL2",63,0)
 ;Input: RX = Prescription file #52 IEN
"RTN","PSXRPPL2",64,0)
 ; RFL = Refill number
"RTN","PSXRPPL2",65,0)
 ;Returns: 1 = OK to resubmit
"RTN","PSXRPPL2",66,0)
 ;0 = Don't resubmit
"RTN","PSXRPPL2",67,0)
ECMESTAT(RX,RFL) ;
"RTN","PSXRPPL2",68,0)
 I '$$PATCH^XPDUTL("PSO*7.0*148") Q 0
"RTN","PSXRPPL2",69,0)
 N STATUS
"RTN","PSXRPPL2",70,0)
 S STATUS=$$STATUS^PSOBPSUT(RX,RFL)
"RTN","PSXRPPL2",71,0)
 ; Never submitted before, OK to resubmit
"RTN","PSXRPPL2",72,0)
 I STATUS="" Q 1
"RTN","PSXRPPL2",73,0)
 ; If status other than E REJECTED, don't resubmit
"RTN","PSXRPPL2",74,0)
 I STATUS'="E REJECTED" Q 0
"RTN","PSXRPPL2",75,0)
 ; If only host rejects, quit with 1. Otherwise quit with 0
"RTN","PSXRPPL2",76,0)
 Q $$HOSTREJ(RX,RFL,0)
"RTN","PSXRPPL2",77,0)
 ;
"RTN","PSXRPPL2",78,0)
 ;Description: 
"RTN","PSXRPPL2",79,0)
 ;This function determines whether the RX SUSPENSE has a DAYS SUPPLY HOLD
"RTN","PSXRPPL2",80,0)
 ;condition.
"RTN","PSXRPPL2",81,0)
 ;Input: REC = Pointer to Suspense file (#52.5)
"RTN","PSXRPPL2",82,0)
 ;Returns: 1 or 0
"RTN","PSXRPPL2",83,0)
 ;1 (one) if  of days supply has elapsed.
"RTN","PSXRPPL2",84,0)
 ;0 (zero) is returned if  of days supply has not elapsed. 
"RTN","PSXRPPL2",85,0)
 ;
"RTN","PSXRPPL2",86,0)
DSH(REC) ;ePharmacy API to check for 3/4 days supply hold
"RTN","PSXRPPL2",87,0)
 N PSINSUR,PSARR,SHDT,DSHOLD,DSHDT,PS0,COMM,DIE,DA,DR,RXIEN,RFL,DAYSSUP,LSTFIL,PTDFN,IBINS,DRG
"RTN","PSXRPPL2",88,0)
 N DEA,DEAOK,ICD,SFN,SDT
"RTN","PSXRPPL2",89,0)
 S DSHOLD=1,PS0=^PS(52.5,REC,0),RXIEN=$P(PS0,U,1),RFL=$P(PS0,U,13)
"RTN","PSXRPPL2",90,0)
 S LSTFIL=$$LSTRFL^PSOBPSU1(RXIEN),PTDFN=$$GET1^DIQ(52,RXIEN,"2","I")
"RTN","PSXRPPL2",91,0)
 S IBSTAT=$$INSUR^IBBAPI(PTDFN,,"E",.IBINS,"1"),DRG=$$GET1^DIQ(52,RXIEN,"6","I")
"RTN","PSXRPPL2",92,0)
 S (ICD,DEA)="",DEA=$$GET1^DIQ(50,DRG,3)
"RTN","PSXRPPL2",93,0)
 I $D(^PSRX(RXIEN,"ICD",1,0)) S ICD=^PSRX(RXIEN,"ICD",1,0)
"RTN","PSXRPPL2",94,0)
 ;
"RTN","PSXRPPL2",95,0)
 ; Don't hold Rx where the previous fill was not ebillable
"RTN","PSXRPPL2",96,0)
 I $$STATUS^BPSOSRX(RXIEN,LSTFIL-1)="" Q DSHOLD
"RTN","PSXRPPL2",97,0)
 ; Don't hold when the Rx has SC/EI flagged
"RTN","PSXRPPL2",98,0)
 I ICD[1 Q DSHOLD
"RTN","PSXRPPL2",99,0)
 ; Don't hold rx if DEA special Handling code is non billable (i.e. has M or 0 (zero) or I, S, N, and/or 9)) without an E
"RTN","PSXRPPL2",100,0)
 S DEAOK=$$DEA^IBNCPDP(DEA) I 'DEAOK Q DSHOLD
"RTN","PSXRPPL2",101,0)
 ; Don't hold for zero fill renewals
"RTN","PSXRPPL2",102,0)
 I 'LSTFIL,$$GET1^DIQ(52,RXIEN_",","PRIOR FILL DATE",,,)="" Q DSHOLD
"RTN","PSXRPPL2",103,0)
 ; Don't hold if no insurance
"RTN","PSXRPPL2",104,0)
 I 'IBSTAT!(IBSTAT=-1) Q DSHOLD
"RTN","PSXRPPL2",105,0)
 ;
"RTN","PSXRPPL2",106,0)
 S DSHDT=$$DSHDT(RXIEN) ; 3/4 of days supply date
"RTN","PSXRPPL2",107,0)
 I DSHDT>DT S DSHOLD=0 D
"RTN","PSXRPPL2",108,0)
 . I DSHDT'=$P(PS0,U,14) D  ; Update Suspense Hold Date and Activity Log
"RTN","PSXRPPL2",109,0)
 . . S COMM="3/4 of Days Supply SUSPENSE HOLD until "_$$FMTE^XLFDT(DSHDT,"2D")_"."
"RTN","PSXRPPL2",110,0)
 . . S DAYSSUP=$$LFDS(RXIEN)
"RTN","PSXRPPL2",111,0)
 . . D RXACT^PSOBPSU2(RXIEN,RFL,COMM,"S",+$G(DUZ)) ; Update Activity Log
"RTN","PSXRPPL2",112,0)
 . . S DR="10///^S X=DSHDT",DIE="^PS(52.5,",DA=REC D ^DIE ; File Suspense Hold Date
"RTN","PSXRPPL2",113,0)
 . . N DA,DIE,DR,PSOX,SFN,INDT,DEAD,RXREC,SUB,XOK,OLD
"RTN","PSXRPPL2",114,0)
 . . S DA=REC,DIE="^PS(52.5,",DR=".02///"_DSHDT D ^DIE
"RTN","PSXRPPL2",115,0)
 . . S SFN=REC,DEAD=0,INDT=DSHDT D CHANGE^PSOSUCH1(RXIEN,RFL)
"RTN","PSXRPPL2",116,0)
 Q DSHOLD
"RTN","PSXRPPL2",117,0)
 ;
"RTN","PSXRPPL2",118,0)
 ;Description: ePharmacy
"RTN","PSXRPPL2",119,0)
 ;This function determines the date that 3/4 of the days supply for the
"RTN","PSXRPPL2",120,0)
 ;last refill will occur.
"RTN","PSXRPPL2",121,0)
 ;Input: RXIEN = Prescription file #52 IEN
"RTN","PSXRPPL2",122,0)
 ;Returns: DATE/TIME value
"RTN","PSXRPPL2",123,0)
DSHDT(RXIEN) ;
"RTN","PSXRPPL2",124,0)
 N RXFIL,FILLDT,DAYSSUP,DSH34
"RTN","PSXRPPL2",125,0)
 I '$D(^PSRX(RXIEN,0)) Q -1
"RTN","PSXRPPL2",126,0)
 ;S RXFIL=$$LSTRFL^PSOBPSU1(RXIEN) ; Last Refill
"RTN","PSXRPPL2",127,0)
 S FILLDT=$$LDPFDT(RXIEN) ; Last Dispensed Date or Prior Fill Date for renewal
"RTN","PSXRPPL2",128,0)
 S DAYSSUP=$$LFDS(RXIEN) ; Days Supply of Last Refill
"RTN","PSXRPPL2",129,0)
 S DSH34=DAYSSUP*.75 ; 3/4 of Days Supply
"RTN","PSXRPPL2",130,0)
 Q $$FMADD^XLFDT(FILLDT,DSH34) ; Return today plus 3/4 of Days Supply date
"RTN","PSXRPPL2",131,0)
 ;
"RTN","PSXRPPL2",132,0)
 ;Description:
"RTN","PSXRPPL2",133,0)
 ;This function returns the DAYS SUPPLY for the Latest Fill for a Prescription
"RTN","PSXRPPL2",134,0)
 ;Input: RXIEN = Prescription file #52 IEN
"RTN","PSXRPPL2",135,0)
 ;Returns: DAYS SUPPLY for the latest fill or -1 if RXIEN is not valid
"RTN","PSXRPPL2",136,0)
LFDS(RXIEN) ;
"RTN","PSXRPPL2",137,0)
 N RXFIL
"RTN","PSXRPPL2",138,0)
 Q:'$D(^PSRX(RXIEN)) -1
"RTN","PSXRPPL2",139,0)
 S RXFIL=$$LSTRFL^PSOBPSU1(RXIEN)
"RTN","PSXRPPL2",140,0)
 Q $S(RXFIL=0:$P(^PSRX(RXIEN,0),U,8),1:$P(^PSRX(RXIEN,1,RXFIL,0),U,10))
"RTN","PSXRPPL2",141,0)
 ;
"RTN","PSXRPPL2",142,0)
LDPFDT(RXIEN) ; Returns PRIOR FILL DATE if renewal otherwise LAST DISPENSED DATE or -1 if not valid
"RTN","PSXRPPL2",143,0)
 Q $S('$D(^PSRX(RXIEN)):-1,$$PRFDT(RXIEN):$$PRFDT(RXIEN),1:$$LDT(RXIEN))
"RTN","PSXRPPL2",144,0)
 ;
"RTN","PSXRPPL2",145,0)
PRFDT(RXIEN) ; Returns PRIOR FILL DATE in internal format
"RTN","PSXRPPL2",146,0)
 Q $$GET1^DIQ(52,RXIEN_",","PRIOR FILL DATE","I",,)
"RTN","PSXRPPL2",147,0)
 ;
"RTN","PSXRPPL2",148,0)
LDT(RXIEN) ; Returns LAST DISPENSED DATE in internal format
"RTN","PSXRPPL2",149,0)
 Q $$GET1^DIQ(52,RXIEN_",","LAST DISPENSED DATE","I",,)
"RTN","PSXRPPL2",150,0)
 ;
"RTN","PSXRPPL2",151,0)
 ;Description: ePharmacy API to check for host errors.
"RTN","PSXRPPL2",152,0)
 ;Input: RX = Prescription file #52 IEN
"RTN","PSXRPPL2",153,0)
 ; RFL = Refill number
"RTN","PSXRPPL2",154,0)
 ;Returns: A value of 0 (zero) will be returned when reject codes M6, M8,
"RTN","PSXRPPL2",155,0)
 ;NN, and 99 are present OR if on susp hold which means the prescription should not 
"RTN","PSXRPPL2",156,0)
 ;be sent to CMOP. Otherwise, a value of 1(one) will be returned.
"RTN","PSXRPPL2",157,0)
DUR(RX,RFL) ;
"RTN","PSXRPPL2",158,0)
 N REJ,IDX,TXT,CODE,SHOLD,SHCODE,SHDT
"RTN","PSXRPPL2",159,0)
 S SHOLD=1,IDX=""
"RTN","PSXRPPL2",160,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSXRPPL2",161,0)
 S SHDT=$$SHDT(RX,RFL) ; Get suspense hold date for rx/refill
"RTN","PSXRPPL2",162,0)
 ; Add one day to compare to prevent from running just after midnight problem.
"RTN","PSXRPPL2",163,0)
 I SHDT>$$FMADD^XLFDT(DT,1) Q 0 ; Quit with 0 since still on hold
"RTN","PSXRPPL2",164,0)
 ; If a host reject exists and no previous Susp Hold Date or log entry,
"RTN","PSXRPPL2",165,0)
 ; create the log entry and hold rx/fill.
"RTN","PSXRPPL2",166,0)
 I $$HOSTREJ(RX,RFL,1),SHDT="" S SHOLD=0 D SHDTLOG(RX,RFL)
"RTN","PSXRPPL2",167,0)
 Q SHOLD
"RTN","PSXRPPL2",168,0)
 ;
"RTN","PSXRPPL2",169,0)
 ;Description: ePharmacy
"RTN","PSXRPPL2",170,0)
 ;This subroutine checks an RX/FILL for Host Reject Errors returned
"RTN","PSXRPPL2",171,0)
 ;from previous ECME submissions. The host reject errors checked are M6, M8, NN, and 99.
"RTN","PSXRPPL2",172,0)
 ;Note that host reject errors do not pass to the pharmacy reject worklist so it's necessary
"RTN","PSXRPPL2",173,0)
 ;to check ECME for these type errors.
"RTN","PSXRPPL2",174,0)
 ;Input: 
"RTN","PSXRPPL2",175,0)
 ; RX = Prescription File IEN
"RTN","PSXRPPL2",176,0)
 ; RFL = Refill
"RTN","PSXRPPL2",177,0)
 ; ONE = Either 1 or 0 - Defaults to 1
"RTN","PSXRPPL2",178,0)
 ; If 1, At least ONE reject code associated with the RX/FILL must 
"RTN","PSXRPPL2",179,0)
 ;   match either M6, M8, NN, or 99.
"RTN","PSXRPPL2",180,0)
 ; If 0, ALL reject codes must match either M6, M8, NN, or 99
"RTN","PSXRPPL2",181,0)
 ;Return: 
"RTN","PSXRPPL2",182,0)
 ; RETV = 1 OR 0
"RTN","PSXRPPL2",183,0)
 ; 1 = host reject exists based on ONE parameter
"RTN","PSXRPPL2",184,0)
 ; 0 = no host rejects exists based on ONE parameter
"RTN","PSXRPPL2",185,0)
HOSTREJ(RX,RFL,ONE) ;
"RTN","PSXRPPL2",186,0)
 N REJ,IDX,TXT,CODE,HRCODE,HRQUIT,RETV
"RTN","PSXRPPL2",187,0)
 S IDX="",(RETV,HRQUIT)=0
"RTN","PSXRPPL2",188,0)
 I ONE="" S ONE=1
"RTN","PSXRPPL2",189,0)
 D DUR1^BPSNCPD3(RX,RFL,.REJ) ; Get reject list from last submission
"RTN","PSXRPPL2",190,0)
 F  S IDX=$O(REJ(IDX)) Q:IDX=""  D  Q:HRQUIT
"RTN","PSXRPPL2",191,0)
 . S TXT=$G(REJ(IDX,"REJ CODE LST"))
"RTN","PSXRPPL2",192,0)
 . F I=1:1:$L(TXT,",") S CODE=$P(TXT,",",I) D  Q:HRQUIT
"RTN","PSXRPPL2",193,0)
 . . F HRCODE="M6","M8","NN",99 D  Q:HRQUIT
"RTN","PSXRPPL2",194,0)
 . . . I CODE=HRCODE S RETV=1 I ONE S HRQUIT=1 Q
"RTN","PSXRPPL2",195,0)
 . . . I CODE'=HRCODE,RETV=1 S RETV=0,HRQUIT=1 Q
"RTN","PSXRPPL2",196,0)
 Q RETV
"RTN","PSXRPPL2",197,0)
 ;
"RTN","PSXRPPL2",198,0)
 ;Description: This subroutine sets the EPHARMACY SUSPENSE HOLD DATE field
"RTN","PSXRPPL2",199,0)
 ;for the rx or refill to tomorrow and adds an entry to the SUSPENSE Activity Log.
"RTN","PSXRPPL2",200,0)
 ;Input: RX = Prescription File IEN
"RTN","PSXRPPL2",201,0)
 ; RFL = Refill
"RTN","PSXRPPL2",202,0)
SHDTLOG(RX,RFL) ;
"RTN","PSXRPPL2",203,0)
 N DA,DIE,DR,COMM,SHDT
"RTN","PSXRPPL2",204,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSXRPPL2",205,0)
 S SHDT=$$FMADD^XLFDT(DT,1)
"RTN","PSXRPPL2",206,0)
 S COMM="SUSPENSE HOLD until "_$$FMTE^XLFDT(SHDT,"2D")_" due to host reject error."
"RTN","PSXRPPL2",207,0)
 I RFL=0 S DA=RX,DIE="^PSRX(",DR="86///"_SHDT D ^DIE
"RTN","PSXRPPL2",208,0)
 E  S DA=RFL,DA(1)=RX,DIE="^PSRX("_DA(1)_",1,",DR="86///"_SHDT D ^DIE
"RTN","PSXRPPL2",209,0)
 D RXACT^PSOBPSU2(RX,RFL,COMM,"S",+$G(DUZ)) ; Create Activity Log entry
"RTN","PSXRPPL2",210,0)
 Q
"RTN","PSXRPPL2",211,0)
 ;
"RTN","PSXRPPL2",212,0)
 ;Description: This function returns the EPHARMACY SUSPENSE HOLD DATE field
"RTN","PSXRPPL2",213,0)
 ;for the rx or refill
"RTN","PSXRPPL2",214,0)
 ;Input: RX = Prescription File IEN
"RTN","PSXRPPL2",215,0)
 ; RFL = Refill
"RTN","PSXRPPL2",216,0)
SHDT(RX,RFL) ;
"RTN","PSXRPPL2",217,0)
 N FILE,IENS
"RTN","PSXRPPL2",218,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSXRPPL2",219,0)
 S FILE=$S(RFL=0:52,1:52.1),IENS=$S(RFL=0:RX_",",1:RFL_","_RX_",")
"RTN","PSXRPPL2",220,0)
 Q $$GET1^DIQ(FILE,IENS,86,"I")
"RTN","PSXRPPL2",221,0)
 ;
"VER")
8.0^22.0
"BLD",7389,6)
^59
**END**
**END**
