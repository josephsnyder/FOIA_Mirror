Released RG*1*53 SEQ #50
Extracted from mail message
**KIDS**:RG*1.0*53^

**INSTALL NAME**
RG*1.0*53
"BLD",2577,0)
RG*1.0*53^CLINICAL INFO RESOURCE NETWORK^0^3080125^y
"BLD",2577,1,0)
^^4^4^3071220^
"BLD",2577,1,1,0)
 
"BLD",2577,1,2,0)
FAILED RPC RESULTS IN 'PLEASE CHECK BACK LATER' MESSAGE
"BLD",2577,1,3,0)
Refer to patch RG*1*53 in the FORUM Patch Module for a complete
"BLD",2577,1,4,0)
description.
"BLD",2577,4,0)
^9.64PA^^
"BLD",2577,6.3)
2
"BLD",2577,"ABNS",0)
^9.66A^^
"BLD",2577,"ABPKG")
^^
"BLD",2577,"INIT")
RGP53PST
"BLD",2577,"KRN",0)
^9.67PA^8989.52^19
"BLD",2577,"KRN",.4,0)
.4
"BLD",2577,"KRN",.401,0)
.401
"BLD",2577,"KRN",.402,0)
.402
"BLD",2577,"KRN",.403,0)
.403
"BLD",2577,"KRN",.5,0)
.5
"BLD",2577,"KRN",.84,0)
.84
"BLD",2577,"KRN",3.6,0)
3.6
"BLD",2577,"KRN",3.8,0)
3.8
"BLD",2577,"KRN",9.2,0)
9.2
"BLD",2577,"KRN",9.8,0)
9.8
"BLD",2577,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",2577,"KRN",9.8,"NM",1,0)
RGPVMPI^^0^B18263878
"BLD",2577,"KRN",9.8,"NM",2,0)
RGPVREJ^^0^B16940995
"BLD",2577,"KRN",9.8,"NM",3,0)
RGP53PST^^0^B1795800
"BLD",2577,"KRN",9.8,"NM",4,0)
RGEX06^^0^B8799992
"BLD",2577,"KRN",9.8,"NM",5,0)
RGEX07^^0^B4862923
"BLD",2577,"KRN",9.8,"NM","B","RGEX06",4)

"BLD",2577,"KRN",9.8,"NM","B","RGEX07",5)

"BLD",2577,"KRN",9.8,"NM","B","RGP53PST",3)

"BLD",2577,"KRN",9.8,"NM","B","RGPVMPI",1)

"BLD",2577,"KRN",9.8,"NM","B","RGPVREJ",2)

"BLD",2577,"KRN",19,0)
19
"BLD",2577,"KRN",19.1,0)
19.1
"BLD",2577,"KRN",101,0)
101
"BLD",2577,"KRN",409.61,0)
409.61
"BLD",2577,"KRN",771,0)
771
"BLD",2577,"KRN",870,0)
870
"BLD",2577,"KRN",8989.51,0)
8989.51
"BLD",2577,"KRN",8989.52,0)
8989.52
"BLD",2577,"KRN",8994,0)
8994
"BLD",2577,"KRN","B",.4,.4)

"BLD",2577,"KRN","B",.401,.401)

"BLD",2577,"KRN","B",.402,.402)

"BLD",2577,"KRN","B",.403,.403)

"BLD",2577,"KRN","B",.5,.5)

"BLD",2577,"KRN","B",.84,.84)

"BLD",2577,"KRN","B",3.6,3.6)

"BLD",2577,"KRN","B",3.8,3.8)

"BLD",2577,"KRN","B",9.2,9.2)

"BLD",2577,"KRN","B",9.8,9.8)

"BLD",2577,"KRN","B",19,19)

"BLD",2577,"KRN","B",19.1,19.1)

"BLD",2577,"KRN","B",101,101)

"BLD",2577,"KRN","B",409.61,409.61)

"BLD",2577,"KRN","B",771,771)

"BLD",2577,"KRN","B",870,870)

"BLD",2577,"KRN","B",8989.51,8989.51)

"BLD",2577,"KRN","B",8989.52,8989.52)

"BLD",2577,"KRN","B",8994,8994)

"BLD",2577,"QDEF")
^^^^^^^^^^YES
"BLD",2577,"QUES",0)
^9.62^^
"BLD",2577,"REQB",0)
^9.611^3^3
"BLD",2577,"REQB",1,0)
RG*1.0*47^2
"BLD",2577,"REQB",2,0)
RG*1.0*48^2
"BLD",2577,"REQB",3,0)
RG*1.0*44^2
"BLD",2577,"REQB","B","RG*1.0*44",3)

"BLD",2577,"REQB","B","RG*1.0*47",1)

"BLD",2577,"REQB","B","RG*1.0*48",2)

"INIT")
RGP53PST
"MBREQ")
0
"PKG",272,-1)
1^1
"PKG",272,0)
CLINICAL INFO RESOURCE NETWORK^RG^CIRN
"PKG",272,20,0)
^9.402P^^0
"PKG",272,22,0)
^9.49I^1^1
"PKG",272,22,1,0)
1.0^2990430^2990601^12555
"PKG",272,22,1,"PAH",1,0)
53^3080125
"PKG",272,22,1,"PAH",1,1,0)
^^4^4^3080125
"PKG",272,22,1,"PAH",1,1,1,0)
 
"PKG",272,22,1,"PAH",1,1,2,0)
FAILED RPC RESULTS IN 'PLEASE CHECK BACK LATER' MESSAGE
"PKG",272,22,1,"PAH",1,1,3,0)
Refer to patch RG*1*53 in the FORUM Patch Module for a complete
"PKG",272,22,1,"PAH",1,1,4,0)
description.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","RGEX06")
0^4^B8799992^B8462958
"RTN","RGEX06",1,0)
RGEX06 ;BIR/PTD-LIST MANAGER ROUTINE FOR REMOTE MPI PRIMARY VIEW PDAT ;5/17/07
"RTN","RGEX06",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**48,53**;30 Apr 99;Build 2
"RTN","RGEX06",3,0)
 ;
"RTN","RGEX06",4,0)
 ;Reference to ^XWB2HL7 supported by IA #3144
"RTN","RGEX06",5,0)
 ;Reference to ^XWBDRPC supported by IA #3149
"RTN","RGEX06",6,0)
 ;
"RTN","RGEX06",7,0)
EN(ICN) ;Entry point calling List Template for primary view PDAT display
"RTN","RGEX06",8,0)
 D EN^VALM("RG EXCPT PV MPI PDAT")
"RTN","RGEX06",9,0)
 Q
"RTN","RGEX06",10,0)
 ;
"RTN","RGEX06",11,0)
HDR ; -- header code
"RTN","RGEX06",12,0)
 S VALMHDR(1)="MPI PRIMARY VIEW PATIENT DATA DISPLAY"
"RTN","RGEX06",13,0)
 Q
"RTN","RGEX06",14,0)
 ;
"RTN","RGEX06",15,0)
INIT ;Display the MPI Primary View Patient Data (PDAT)
"RTN","RGEX06",16,0)
 K ^TMP("RGEXC6",$J)
"RTN","RGEX06",17,0)
 K @VALMAR
"RTN","RGEX06",18,0)
 I '$D(ICN) G EXIT
"RTN","RGEX06",19,0)
 S LIN=1,X=0,STR="",TXT=""
"RTN","RGEX06",20,0)
 I '$D(^XTMP("RGPVMPI"_ICN,"DATA")) S TXT=" - No MPI Primary View data exists for this patient." D ADDTMP
"RTN","RGEX06",21,0)
 N STATUS,R,RETURN,RESULT,RET
"RTN","RGEX06",22,0)
 I $D(^XTMP("RGPVMPI"_ICN,"DATA")) S RETURN(0)=$P(^XTMP("RGPVMPI"_ICN,"DATA"),"^") D
"RTN","RGEX06",23,0)
 .D RPCCHK^XWB2HL7(.RESULT,RETURN(0)) I +RESULT(0)=1 D
"RTN","RGEX06",24,0)
 ..;Retrieve the data
"RTN","RGEX06",25,0)
 ..D RTNDATA^XWBDRPC(.RET,RETURN(0)) D
"RTN","RGEX06",26,0)
 ...I $G(RET(0))<0 S TXT="No Data Returned Due To: "_$P(RET(0),"^",2,99) S STR=$$SETSTR^VALM1(TXT,STR,1,80) D ADDTMP Q
"RTN","RGEX06",27,0)
 ...I $G(RET)'="",$D(@RET) S GLO=RET F  S GLO=$Q(@GLO) Q:$QS(GLO,1)'=$J  S TXT=@GLO S STR=$$SETSTR^VALM1(TXT,STR,1,80) D ADDTMP
"RTN","RGEX06",28,0)
 ...S R="" F  S R=$O(RET(R)) Q:R=""  S TXT=RET(R) S STR=$$SETSTR^VALM1(TXT,STR,1,80) D ADDTMP
"RTN","RGEX06",29,0)
 K GLO,L,R,SL
"RTN","RGEX06",30,0)
 S VALMCNT=LIN-1
"RTN","RGEX06",31,0)
 Q
"RTN","RGEX06",32,0)
 ;
"RTN","RGEX06",33,0)
ADDTMP ;Set string into the array.
"RTN","RGEX06",34,0)
 S ^TMP("RGEXC6",$J,LIN,0)=STR
"RTN","RGEX06",35,0)
 S ^TMP("RGEXC6",$J,"IDX",LIN,LIN)=""
"RTN","RGEX06",36,0)
 S LIN=LIN+1,STR=""
"RTN","RGEX06",37,0)
 Q
"RTN","RGEX06",38,0)
 ;
"RTN","RGEX06",39,0)
HELP ; -- help code
"RTN","RGEX06",40,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","RGEX06",41,0)
 Q
"RTN","RGEX06",42,0)
 ;
"RTN","RGEX06",43,0)
EXIT ; -- exit code
"RTN","RGEX06",44,0)
 S VALMBCK=""
"RTN","RGEX06",45,0)
 K ^TMP("RGEXC6",$J),GLO,L,LIN,R,RESULT,RET,RETURN,SL,STATUS,STR,TXT,X
"RTN","RGEX06",46,0)
 S VALMBCK="R"
"RTN","RGEX06",47,0)
 Q
"RTN","RGEX06",48,0)
 ;
"RTN","RGEX06",49,0)
EXPND ; -- expand code
"RTN","RGEX06",50,0)
 Q
"RTN","RGEX06",51,0)
 ;
"RTN","RGEX06",52,0)
SAPV(ICN) ;Print stand alone Primary View display
"RTN","RGEX06",53,0)
 I '$D(^XTMP("RGPVMPI"_ICN,"DATA")) W !," - No MPI Primary View data exists for this patient." Q
"RTN","RGEX06",54,0)
 N STATUS,R,RETURN,RESULT,RET
"RTN","RGEX06",55,0)
 I $D(^XTMP("RGPVMPI"_ICN,"DATA")) S RETURN(0)=$P(^XTMP("RGPVMPI"_ICN,"DATA"),"^") D
"RTN","RGEX06",56,0)
 .D RPCCHK^XWB2HL7(.RESULT,RETURN(0)) I +RESULT(0)=1 D
"RTN","RGEX06",57,0)
 ..;Retrieve the data
"RTN","RGEX06",58,0)
 ..D RTNDATA^XWBDRPC(.RET,RETURN(0)) D
"RTN","RGEX06",59,0)
 ...I $D(RET(0)) I RET(0)<0 W !!,"No data returned due to: "_$P(RET(0),"^",2) Q
"RTN","RGEX06",60,0)
 ...I $G(RET)'="",$D(@RET) S GLO=RET F  S GLO=$Q(@GLO) Q:$QS(GLO,1)'=$J  S TXT=@GLO W !,TXT I $Y>22 S DIR(0)="E" D ^DIR K DIR W @IOF S $Y=1
"RTN","RGEX06",61,0)
 ...S R="" F  S R=$O(RET(R)) Q:R=""  W !,RET(R) I $Y>22 S DIR(0)="E" D ^DIR K DIR Q:'Y  W @IOF S $Y=1
"RTN","RGEX06",62,0)
 Q
"RTN","RGEX06",63,0)
 ;
"RTN","RGEX07")
0^5^B4862923^B4853896
"RTN","RGEX07",1,0)
RGEX07 ;BIR/PTD-LIST MANAGER ROUTINE FOR REMOTE PRIMARY VIEW DISPLAY ;10/17/06
"RTN","RGEX07",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**44,53**;30 Apr 99;Build 2
"RTN","RGEX07",3,0)
 ;
"RTN","RGEX07",4,0)
 ;Reference to ^XWB2HL7 supported by IA #3144
"RTN","RGEX07",5,0)
 ;Reference to ^XWBDRPC supported by IA #3149
"RTN","RGEX07",6,0)
 ;
"RTN","RGEX07",7,0)
EN(ICN,EXCDT) ;Entry point calling List Template for primary view reject display
"RTN","RGEX07",8,0)
 D EN^VALM("RG EXCPT PV REJECT RDISPLAY")
"RTN","RGEX07",9,0)
 Q
"RTN","RGEX07",10,0)
 ;
"RTN","RGEX07",11,0)
HDR ; -- header code
"RTN","RGEX07",12,0)
 S VALMHDR(1)="MPI PRIMARY VIEW REJECT DISPLAY"
"RTN","RGEX07",13,0)
 Q
"RTN","RGEX07",14,0)
 ;
"RTN","RGEX07",15,0)
INIT ;Display the MPI Primary View Rejected Data Report
"RTN","RGEX07",16,0)
 K ^TMP("RGEXC7",$J)
"RTN","RGEX07",17,0)
 K @VALMAR
"RTN","RGEX07",18,0)
 I '$D(ICN) G EXIT
"RTN","RGEX07",19,0)
 I '$D(EXCDT) G EXIT
"RTN","RGEX07",20,0)
 S LIN=1,X=0,STR="",TXT=""
"RTN","RGEX07",21,0)
 I '$D(^XTMP("RGPVREJ"_ICN,EXCDT)) S TXT=" - No Primary View Reject data exists for this patient/exception date." D ADDTMP
"RTN","RGEX07",22,0)
 N STATUS,R,RETURN,RESULT,RET
"RTN","RGEX07",23,0)
 I $D(^XTMP("RGPVREJ"_ICN,EXCDT)) S RETURN(0)=$P(^XTMP("RGPVREJ"_ICN,EXCDT),"^") D
"RTN","RGEX07",24,0)
 .D RPCCHK^XWB2HL7(.RESULT,RETURN(0)) I +RESULT(0)=1 D
"RTN","RGEX07",25,0)
 ..;Retrieve the data
"RTN","RGEX07",26,0)
 ..D RTNDATA^XWBDRPC(.RET,RETURN(0)) D
"RTN","RGEX07",27,0)
 ...I $G(RET(0))<0 S TXT="No Data Returned Due To: "_$P(RET(0),"^",2,99) S STR=$$SETSTR^VALM1(TXT,STR,2,78) D ADDTMP Q
"RTN","RGEX07",28,0)
 ...I $G(RET)'="",$D(@RET) S GLO=RET F  S GLO=$Q(@GLO) Q:$QS(GLO,1)'=$J  S TXT=@GLO S STR=$$SETSTR^VALM1(TXT,STR,2,78) D ADDTMP
"RTN","RGEX07",29,0)
 ...S R="" F  S R=$O(RET(R)) Q:R=""  S TXT=RET(R) S STR=$$SETSTR^VALM1(TXT,STR,2,78) D ADDTMP
"RTN","RGEX07",30,0)
 K GLO,L,R,SL
"RTN","RGEX07",31,0)
 S VALMCNT=LIN-1
"RTN","RGEX07",32,0)
 Q
"RTN","RGEX07",33,0)
 ;
"RTN","RGEX07",34,0)
ADDTMP ;Set string into the array.
"RTN","RGEX07",35,0)
 S ^TMP("RGEXC7",$J,LIN,0)=STR
"RTN","RGEX07",36,0)
 S ^TMP("RGEXC7",$J,"IDX",LIN,LIN)=""
"RTN","RGEX07",37,0)
 S LIN=LIN+1,STR=""
"RTN","RGEX07",38,0)
 Q
"RTN","RGEX07",39,0)
 ;
"RTN","RGEX07",40,0)
HELP ; -- help code
"RTN","RGEX07",41,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","RGEX07",42,0)
 Q
"RTN","RGEX07",43,0)
 ;
"RTN","RGEX07",44,0)
EXIT ; -- exit code
"RTN","RGEX07",45,0)
 S VALMBCK=""
"RTN","RGEX07",46,0)
 K ^TMP("RGEXC7",$J),GLO,L,LIN,R,RESULT,RET,RETURN,SL,STATUS,STR,TXT,X
"RTN","RGEX07",47,0)
 S VALMBCK="R"
"RTN","RGEX07",48,0)
 Q
"RTN","RGEX07",49,0)
 ;
"RTN","RGEX07",50,0)
EXPND ; -- expand code
"RTN","RGEX07",51,0)
 Q
"RTN","RGEX07",52,0)
 ;
"RTN","RGP53PST")
0^3^B1795800^n/a
"RTN","RGP53PST",1,0)
RGP53PST ;BIR/PTD-RG*1*53 PATCH POST-INIT ROUTINE ;12/19/07
"RTN","RGP53PST",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**53**;30 Apr 99;Build 2
"RTN","RGP53PST",3,0)
 ;
"RTN","RGP53PST",4,0)
EN ;Delete the Primary View Reject Exceptions Query Global
"RTN","RGP53PST",5,0)
 I $D(^XTMP("RGPVREJ")) D
"RTN","RGP53PST",6,0)
 .K ^XTMP("RGPVREJ")
"RTN","RGP53PST",7,0)
 .D BMES^XPDUTL(" Primary View Reject exception query global ^XTMP('RGPVREJ') deleted.")
"RTN","RGP53PST",8,0)
 .D MES^XPDUTL(" This data will be placed in ^XTMP('RGPVREJ_ICN') in the future.")
"RTN","RGP53PST",9,0)
 ;
"RTN","RGP53PST",10,0)
 ;Delete the Primary View Display Query Global
"RTN","RGP53PST",11,0)
 I $D(^XTMP("RGPVMPI")) D
"RTN","RGP53PST",12,0)
 .K ^XTMP("RGPVMPI")
"RTN","RGP53PST",13,0)
 .D BMES^XPDUTL(" Primary View Display query global ^XTMP('RGPVMPI') deleted.")
"RTN","RGP53PST",14,0)
 .D MES^XPDUTL(" This data will be placed in ^XTMP('RGPVMPI_ICN') in the future.")
"RTN","RGP53PST",15,0)
 D BMES^XPDUTL(" Post-install routine completed successfully.")
"RTN","RGP53PST",16,0)
 Q
"RTN","RGP53PST",17,0)
 ;
"RTN","RGPVMPI")
0^1^B18263878^B17890972
"RTN","RGPVMPI",1,0)
RGPVMPI ;BIR/PTD-REMOTE PRIMARY VIEW DISPLAY FROM MPI ;5/17/07
"RTN","RGPVMPI",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**48,53**;30 Apr 99;Build 2
"RTN","RGPVMPI",3,0)
 ;
"RTN","RGPVMPI",4,0)
 ;Reference to EN1^XWB2HL7 supported by IA #3144
"RTN","RGPVMPI",5,0)
 ;Reference to RPCCHK^XWB2HL7 supported by IA #3144
"RTN","RGPVMPI",6,0)
 ;
"RTN","RGPVMPI",7,0)
INTRO ;Display purpose of option
"RTN","RGPVMPI",8,0)
 W @IOF S SAPV=1 ;from stand alone option, not EH
"RTN","RGPVMPI",9,0)
 W !,"This option sends a remote request for data to the Master Patient"
"RTN","RGPVMPI",10,0)
 W !,"Index, using a Remote Procedure Call (RPC).  When the RPC returns"
"RTN","RGPVMPI",11,0)
 W !,"the information, you can review Primary View data as it currently"
"RTN","RGPVMPI",12,0)
 W !,"exists on the MPI Patient Data Inquiry (PDAT) report."
"RTN","RGPVMPI",13,0)
 ;
"RTN","RGPVMPI",14,0)
 W !!,"Choose the patient for whom Primary View data is to be requested."
"RTN","RGPVMPI",15,0)
 W !,"The selected patient must have an Integration Control Number (ICN)."
"RTN","RGPVMPI",16,0)
 W !,"You can select by Patient Name, Social Security Number, or ICN.",!
"RTN","RGPVMPI",17,0)
 ;
"RTN","RGPVMPI",18,0)
ASK ;Ask For Patient
"RTN","RGPVMPI",19,0)
 S DFN="",RGICN="" K DTOUT,DUOUT
"RTN","RGPVMPI",20,0)
 S DIC="^DPT(",DIC(0)="QEAM",DIC("A")="Select PATIENT: ",D="SSN^AICN^B^BS^BS5"
"RTN","RGPVMPI",21,0)
 D MIX^DIC1 K DIC,D
"RTN","RGPVMPI",22,0)
 I Y<0 G EXIT
"RTN","RGPVMPI",23,0)
 S DFN=+Y
"RTN","RGPVMPI",24,0)
 S RGICN=+$$GETICN^MPIF001(DFN) I RGICN<1 W !,"There is no Integration Control Number for this patient." G ASK
"RTN","RGPVMPI",25,0)
 ;
"RTN","RGPVMPI",26,0)
SEND ;Send a remote query to the MPI for Primary View PDAT
"RTN","RGPVMPI",27,0)
 ;Entry point from Exception Handler; DATA should be defined.
"RTN","RGPVMPI",28,0)
 S (QFLG,QUIT)=0 N RETURN,RESULT,SNTDT
"RTN","RGPVMPI",29,0)
 I SAPV=0 D  I QUIT=1 G EXIT
"RTN","RGPVMPI",30,0)
 .I DATA="" W !,"No Exception Data available." S QUIT=1 Q
"RTN","RGPVMPI",31,0)
 .S RGICN=$P(DATA,"^",6) I RGICN="" W !,"No ICN defined." S QUIT=1 Q
"RTN","RGPVMPI",32,0)
 .S VALMBCK=""
"RTN","RGPVMPI",33,0)
 .D FULL^VALM1
"RTN","RGPVMPI",34,0)
NOQ ;No previous query exists for this ICN
"RTN","RGPVMPI",35,0)
 I '$D(^XTMP("RGPVMPI"_RGICN)) D RPC G DISP
"RTN","RGPVMPI",36,0)
 ;
"RTN","RGPVMPI",37,0)
OLDQ ;Query previously sent for this ICN
"RTN","RGPVMPI",38,0)
 I $D(^XTMP("RGPVMPI"_RGICN)) D
"RTN","RGPVMPI",39,0)
 .S SNTDT=$$FMTE^XLFDT($P(^XTMP("RGPVMPI"_RGICN,"DATA"),"^",2))
"RTN","RGPVMPI",40,0)
 .W !,"A query was last sent for this ICN on "_SNTDT
"RTN","RGPVMPI",41,0)
 .;Has data returned for query?
"RTN","RGPVMPI",42,0)
 .S RETURN(0)=$P(^XTMP("RGPVMPI"_RGICN,"DATA"),"^")
"RTN","RGPVMPI",43,0)
 .D RPCCHK^XWB2HL7(.RESULT,RETURN(0))
"RTN","RGPVMPI",44,0)
 .;Data has NOT returned
"RTN","RGPVMPI",45,0)
 .I +RESULT(0)'=1 D FAIL  Q  ;**53
"RTN","RGPVMPI",46,0)
 .I +RESULT(0)=1 D  ;Data has returned
"RTN","RGPVMPI",47,0)
 ..S DIR("A")="Do you wish to view the existing query data now? ",DIR(0)="YA"
"RTN","RGPVMPI",48,0)
 ..S DIR("?")="Enter YES to review the existing data; enter NO to send a new query"
"RTN","RGPVMPI",49,0)
 ..S DIR("B")="YES" D ^DIR K DIR I $D(DIRUT) S QUIT=1 Q  ;up-arrowed out
"RTN","RGPVMPI",50,0)
 ..I Y>0 K DIR Q  ;yes, use existing query
"RTN","RGPVMPI",51,0)
 ..I Y=0 D  Q  ;no, don't use existing, send new query
"RTN","RGPVMPI",52,0)
 ...K ^XTMP("RGPVMPI"_RGICN)
"RTN","RGPVMPI",53,0)
 ...D RPC
"RTN","RGPVMPI",54,0)
 ...K DIR
"RTN","RGPVMPI",55,0)
 ;
"RTN","RGPVMPI",56,0)
DISP ;Display Primary View Data
"RTN","RGPVMPI",57,0)
 I QUIT'=1 D  I QFLG G EXIT
"RTN","RGPVMPI",58,0)
 .I SAPV=1 D  Q:QFLG  ;Stand alone PV display
"RTN","RGPVMPI",59,0)
 ..W !,"(Be sure HISTORY is enabled to capture data!)"
"RTN","RGPVMPI",60,0)
 ..S DIR(0)="E" W ! D ^DIR K DIR I 'Y S QFLG=1 Q
"RTN","RGPVMPI",61,0)
 ..W !,@IOF D SAPV^RGEX06(RGICN)
"RTN","RGPVMPI",62,0)
 .I SAPV=0 D EN^RGEX06(RGICN) ;Exception Handler PV display
"RTN","RGPVMPI",63,0)
 ;
"RTN","RGPVMPI",64,0)
EXIT ;Kill variables and quit
"RTN","RGPVMPI",65,0)
 K CNT,D,DFN,DIC,DIR,DIRUT,DTOUT,DUOUT,QFLG,QUIT,RGICN,SAPV,X,Y
"RTN","RGPVMPI",66,0)
 Q
"RTN","RGPVMPI",67,0)
 ;
"RTN","RGPVMPI",68,0)
RPC ;Send the Remote Query
"RTN","RGPVMPI",69,0)
 W !!,"Sending a Remote Query to the Master Patient Index."
"RTN","RGPVMPI",70,0)
 W !,"This will take some time; please be patient."
"RTN","RGPVMPI",71,0)
 D EN1^XWB2HL7(.RETURN,"200M","RG PRIMARY VIEW FROM MPI",1,RGICN) I RETURN(0)'="" D  Q
"RTN","RGPVMPI",72,0)
 .S ^XTMP("RGPVMPI"_RGICN,0)=$$FMADD^XLFDT(DT,2)_"^"_DT_"^"_"PRIMARY VIEW MPI PDAT"
"RTN","RGPVMPI",73,0)
 .S ^XTMP("RGPVMPI"_RGICN,"DATA")=RETURN(0)_"^"_$$NOW^XLFDT
"RTN","RGPVMPI",74,0)
 .;Has data returned for this query?
"RTN","RGPVMPI",75,0)
 .S CNT=0 F  S CNT=CNT+1 D RPCCHK^XWB2HL7(.RESULT,RETURN(0)) Q:RESULT(0)  H 2 I CNT>15 Q  ;result(0)=status of handle
"RTN","RGPVMPI",76,0)
 .I +RESULT(0)=1 W !,"Query data has returned from the MPI and is available for review."
"RTN","RGPVMPI",77,0)
 .I +RESULT(0)'=1 D FAIL  ;**53
"RTN","RGPVMPI",78,0)
 W !!,"Problem with Query: ",RETURN(0)_"^"_$G(RETURN(1))
"RTN","RGPVMPI",79,0)
 S QUIT=1
"RTN","RGPVMPI",80,0)
 I SAPV=0 D PAUSE^VALM1
"RTN","RGPVMPI",81,0)
 Q
"RTN","RGPVMPI",82,0)
 ;
"RTN","RGPVMPI",83,0)
FAIL ;Status of RPC call - unsuccessful after 30 seconds ;**53
"RTN","RGPVMPI",84,0)
 W !,"Your query request has NOT returned data from the MPI after trying for"
"RTN","RGPVMPI",85,0)
 W !,"30 seconds. This could be due to network issues. Please try again later."
"RTN","RGPVMPI",86,0)
 K ^XTMP("RGPVMPI"_RGICN)
"RTN","RGPVMPI",87,0)
 S QUIT=1
"RTN","RGPVMPI",88,0)
 I SAPV=0 D PAUSE^VALM1
"RTN","RGPVMPI",89,0)
 Q
"RTN","RGPVMPI",90,0)
 ;
"RTN","RGPVREJ")
0^2^B16940995^B16898530
"RTN","RGPVREJ",1,0)
RGPVREJ ;BIR/PTD-REMOTE PRIMARY VIEW REJECT (PATIENT) ;10/8/06
"RTN","RGPVREJ",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**44,47,53**;30 Apr 99;Build 2
"RTN","RGPVREJ",3,0)
 ;
"RTN","RGPVREJ",4,0)
 ;Reference to ^XWB2HL7 supported by IA #3144
"RTN","RGPVREJ",5,0)
 ;Reference to ^XWBDRPC supported by IA #3149
"RTN","RGPVREJ",6,0)
 ;
"RTN","RGPVREJ",7,0)
REJ ;Option only available for Primary View Reject exceptions
"RTN","RGPVREJ",8,0)
 ;From within the Exception Handler, for selection, DATA should be defined.
"RTN","RGPVREJ",9,0)
 N RGBDT,RGICN,RGSITE,PTEN,PELV
"RTN","RGPVREJ",10,0)
 I DATA="" W !,"No Exception Data available." Q
"RTN","RGPVREJ",11,0)
 S PTEN=$P(DATA,"^",10) ;IEN IN 991.1
"RTN","RGPVREJ",12,0)
 S PELV=$P(DATA,"^",11) ;IEN IN 991.12
"RTN","RGPVREJ",13,0)
 I $P($G(^RGHL7(991.1,PTEN,1,PELV,0)),"^",3)'=234 S VALMSG="Action is ONLY for PRIMARY VIEW REJECT exceptions!" Q
"RTN","RGPVREJ",14,0)
 I $P($G(^RGHL7(991.1,PTEN,1,PELV,0)),"^",5)=1 S VALMSG="Exception has been PROCESSED; no longer active." Q
"RTN","RGPVREJ",15,0)
 S RGSITE=$P($$SITE^VASITE(),"^",3) I RGSITE="" W !,"No Site Data defined." Q
"RTN","RGPVREJ",16,0)
 S RGICN=$P(DATA,"^",6) I RGICN="" W !,"No ICN defined." Q
"RTN","RGPVREJ",17,0)
 S RGBDT=$P(DATA,"^",3) I RGBDT="" W !,"No Exception Date defined." Q
"RTN","RGPVREJ",18,0)
 S X=RGBDT D ^%DT S RGBDT=Y ;convert Exception Date from external format to internal
"RTN","RGPVREJ",19,0)
 ;
"RTN","RGPVREJ",20,0)
 S VALMBCK="",QUIT=0
"RTN","RGPVREJ",21,0)
 D FULL^VALM1
"RTN","RGPVREJ",22,0)
SEND ;Send a remote query to the MPI for Primary View Reject report
"RTN","RGPVREJ",23,0)
 N RETURN,RESULT,RGEDT,SNTDT
"RTN","RGPVREJ",24,0)
 S RGEDT=$$DT^XLFDT ;End date for report internal format
"RTN","RGPVREJ",25,0)
NOQ ;No previous query exists for this ICN/exception date
"RTN","RGPVREJ",26,0)
 I '$D(^XTMP("RGPVREJ"_RGICN,RGBDT)) D RPC G DISP
"RTN","RGPVREJ",27,0)
 ;
"RTN","RGPVREJ",28,0)
OLDQ ;Query already sent for this ICN/ exception date
"RTN","RGPVREJ",29,0)
 I $D(^XTMP("RGPVREJ"_RGICN,RGBDT)) D
"RTN","RGPVREJ",30,0)
 .S SNTDT=$$FMTE^XLFDT($P(^XTMP("RGPVREJ"_RGICN,RGBDT),"^",2))
"RTN","RGPVREJ",31,0)
 .W !?3,"A query was last sent for this ICN/Exception Date on "_SNTDT
"RTN","RGPVREJ",32,0)
 .S X=$P(SNTDT,"@") D ^%DT S SNTDT=Y ;convert to internal, strip time
"RTN","RGPVREJ",33,0)
 .;Has data returned for existing query?
"RTN","RGPVREJ",34,0)
 .S RETURN(0)=$P(^XTMP("RGPVREJ"_RGICN,RGBDT),"^")
"RTN","RGPVREJ",35,0)
 .D RPCCHK^XWB2HL7(.RESULT,RETURN(0)) I +RESULT(0)=1 D  Q  ;Data has returned
"RTN","RGPVREJ",36,0)
 ..I RGEDT=SNTDT D  ;query was sent 'today', want to use that one?
"RTN","RGPVREJ",37,0)
 ...S DIR("A")="   Do you wish to review that existing query data now? ",DIR(0)="YA"
"RTN","RGPVREJ",38,0)
 ...S DIR("?")="     Enter YES to review the existing query; NO to send a new query"
"RTN","RGPVREJ",39,0)
 ...S DIR("B")="YES" D ^DIR K DIR I $D(DIRUT) S QUIT=1 Q  ;up-arrowed out
"RTN","RGPVREJ",40,0)
 ...I Y>0 K DIR Q  ;yes, use existing query
"RTN","RGPVREJ",41,0)
 ...I Y=0 D  Q  ;no, don't use existing, send new query
"RTN","RGPVREJ",42,0)
 ....K ^XTMP("RGPVREJ"_RGICN,RGBDT)
"RTN","RGPVREJ",43,0)
 ....D RPC
"RTN","RGPVREJ",44,0)
 ....K DIR
"RTN","RGPVREJ",45,0)
 ....;
"RTN","RGPVREJ",46,0)
 ..I RGEDT'=SNTDT D  ;query was NOT sent 'today', data may be old, send new query
"RTN","RGPVREJ",47,0)
 ...W !?3,"Previous Query data may be obsolete."
"RTN","RGPVREJ",48,0)
 ...K ^XTMP("RGPVREJ"_RGICN,RGBDT)
"RTN","RGPVREJ",49,0)
 ...D RPC
"RTN","RGPVREJ",50,0)
 .;Data for existing query has NOT returned  **47
"RTN","RGPVREJ",51,0)
 .I +RESULT(0)'=1 D FAIL  ;**53
"RTN","RGPVREJ",52,0)
 ;
"RTN","RGPVREJ",53,0)
DISP ;Display Primary View Reject Data
"RTN","RGPVREJ",54,0)
 I QUIT'=1 D EN^RGEX07(RGICN,RGBDT)
"RTN","RGPVREJ",55,0)
EXIT ;Kill variables and quit
"RTN","RGPVREJ",56,0)
 K CNT,DIR,DIRUT,QUIT,X,Y
"RTN","RGPVREJ",57,0)
 Q
"RTN","RGPVREJ",58,0)
 ;
"RTN","RGPVREJ",59,0)
RPC ;Send the Remote Query
"RTN","RGPVREJ",60,0)
 W !?3,"Sending a Remote Query to the Master Patient Index."
"RTN","RGPVREJ",61,0)
 W !?3,"This will take some time; please be patient."
"RTN","RGPVREJ",62,0)
 D EN1^XWB2HL7(.RETURN,"200M","RG PRIMARY VIEW REJECT",1,RGSITE,RGICN,RGBDT,RGEDT) I RETURN(0)'="" D  Q
"RTN","RGPVREJ",63,0)
 .S ^XTMP("RGPVREJ"_RGICN,0)=$$FMADD^XLFDT(DT,2)_"^"_DT_"^"_"PRIMARY VIEW REJECT"
"RTN","RGPVREJ",64,0)
 .S ^XTMP("RGPVREJ"_RGICN,RGBDT)=RETURN(0)_"^"_$$NOW^XLFDT
"RTN","RGPVREJ",65,0)
 .;Has data returned for this query?
"RTN","RGPVREJ",66,0)
 .S CNT=0 F  S CNT=CNT+1 D RPCCHK^XWB2HL7(.RESULT,RETURN(0)) Q:RESULT(0)  H 2 I CNT>15 Q  ;result(0)=status of handle
"RTN","RGPVREJ",67,0)
 .I +RESULT(0)=1 W !?3,"Query data has returned from the MPI and is available for review."
"RTN","RGPVREJ",68,0)
 .I +RESULT(0)'=1 D FAIL  ;**53
"RTN","RGPVREJ",69,0)
 W !!?3,"Problem with Query: ",RETURN(0)_"^"_$G(RETURN(1))
"RTN","RGPVREJ",70,0)
 S QUIT=1
"RTN","RGPVREJ",71,0)
 D PAUSE^VALM1
"RTN","RGPVREJ",72,0)
 Q
"RTN","RGPVREJ",73,0)
 ;
"RTN","RGPVREJ",74,0)
FAIL ;Status of RPC call - unsuccessful after 30 seconds ;**53
"RTN","RGPVREJ",75,0)
 W !?3,"Your query request has NOT returned data from the MPI after trying for"
"RTN","RGPVREJ",76,0)
 W !?3,"30 seconds. This could be due to network issues. Please try again later."
"RTN","RGPVREJ",77,0)
 K ^XTMP("RGPVREJ"_RGICN,RGBDT)
"RTN","RGPVREJ",78,0)
 S QUIT=1
"RTN","RGPVREJ",79,0)
 D PAUSE^VALM1
"RTN","RGPVREJ",80,0)
 Q
"RTN","RGPVREJ",81,0)
 ;
"VER")
8.0^22.0
"BLD",2577,6)
^50
**END**
**END**
