Released RG*1*57 SEQ #56
Extracted from mail message
**KIDS**:RG*1.0*57^

**INSTALL NAME**
RG*1.0*57
"BLD",2797,0)
RG*1.0*57^CLINICAL INFO RESOURCE NETWORK^0^3100409^y
"BLD",2797,1,0)
^^3^3^3100311^
"BLD",2797,1,1,0)
REMOVE POTENTIAL MATCHES RETURNED EXCEPTION REFERENCES
"BLD",2797,1,2,0)
Refer to patch RG*1*57 in the FORUM Patch Module for a complete
"BLD",2797,1,3,0)
description.
"BLD",2797,4,0)
^9.64PA^^
"BLD",2797,6.3)
2
"BLD",2797,"ABNS",0)
^9.66A^^
"BLD",2797,"ABPKG")
n^n^
"BLD",2797,"INID")
^y
"BLD",2797,"INIT")
RGP57PST
"BLD",2797,"KRN",0)
^9.67PA^779.2^20
"BLD",2797,"KRN",.4,0)
.4
"BLD",2797,"KRN",.401,0)
.401
"BLD",2797,"KRN",.402,0)
.402
"BLD",2797,"KRN",.403,0)
.403
"BLD",2797,"KRN",.5,0)
.5
"BLD",2797,"KRN",.84,0)
.84
"BLD",2797,"KRN",3.6,0)
3.6
"BLD",2797,"KRN",3.8,0)
3.8
"BLD",2797,"KRN",9.2,0)
9.2
"BLD",2797,"KRN",9.8,0)
9.8
"BLD",2797,"KRN",9.8,"NM",0)
^9.68A^8^8
"BLD",2797,"KRN",9.8,"NM",1,0)
RGEX01^^0^B22714339
"BLD",2797,"KRN",9.8,"NM",2,0)
RGEXHND1^^0^B37400054
"BLD",2797,"KRN",9.8,"NM",3,0)
RGHLLOG^^0^B24264633
"BLD",2797,"KRN",9.8,"NM",4,0)
RGMTETOT^^0^B13022179
"BLD",2797,"KRN",9.8,"NM",5,0)
RGRSUTIL^^0^B11788298
"BLD",2797,"KRN",9.8,"NM",6,0)
RGSYSTAT^^0^B9266591
"BLD",2797,"KRN",9.8,"NM",7,0)
RGEX03^^0^B81177461
"BLD",2797,"KRN",9.8,"NM",8,0)
RGP57PST^^0^B5113070
"BLD",2797,"KRN",9.8,"NM","B","RGEX01",1)

"BLD",2797,"KRN",9.8,"NM","B","RGEX03",7)

"BLD",2797,"KRN",9.8,"NM","B","RGEXHND1",2)

"BLD",2797,"KRN",9.8,"NM","B","RGHLLOG",3)

"BLD",2797,"KRN",9.8,"NM","B","RGMTETOT",4)

"BLD",2797,"KRN",9.8,"NM","B","RGP57PST",8)

"BLD",2797,"KRN",9.8,"NM","B","RGRSUTIL",5)

"BLD",2797,"KRN",9.8,"NM","B","RGSYSTAT",6)

"BLD",2797,"KRN",19,0)
19
"BLD",2797,"KRN",19.1,0)
19.1
"BLD",2797,"KRN",101,0)
101
"BLD",2797,"KRN",101,"NM",0)
^9.68A^24^24
"BLD",2797,"KRN",101,"NM",1,0)
RG EXCPT POT MATCH^^1^
"BLD",2797,"KRN",101,"NM",2,0)
RG EXCPT ACTION MENU^^0
"BLD",2797,"KRN",101,"NM",3,0)
RG EXCPT BLANK1^^0
"BLD",2797,"KRN",101,"NM",4,0)
RG EXCPT DATE SORT^^0
"BLD",2797,"KRN",101,"NM",5,0)
RG EXCPT DISPLAY ONLY QUERY^^0
"BLD",2797,"KRN",101,"NM",6,0)
RG EXCPT EDIT NOTE^^0
"BLD",2797,"KRN",101,"NM",7,0)
RG EXCPT EDIT PATIENT DATA^^0
"BLD",2797,"KRN",101,"NM",8,0)
RG EXCPT HINQ INQUIRY^^0
"BLD",2797,"KRN",101,"NM",9,0)
RG EXCPT MAIN MENU^^0
"BLD",2797,"KRN",101,"NM",10,0)
RG EXCPT MPI/PD DATA^^0
"BLD",2797,"KRN",101,"NM",11,0)
RG EXCPT PATIENT AUDIT^^0
"BLD",2797,"KRN",101,"NM",12,0)
RG EXCPT PATIENT INQUIRY^^0
"BLD",2797,"KRN",101,"NM",13,0)
RG EXCPT PATIENT SORT^^0
"BLD",2797,"KRN",101,"NM",14,0)
RG EXCPT PDAT MENU^^0
"BLD",2797,"KRN",101,"NM",15,0)
RG EXCPT PV MPI PDAT^^0
"BLD",2797,"KRN",101,"NM",16,0)
RG EXCPT PV REJECT^^0
"BLD",2797,"KRN",101,"NM",17,0)
RG EXCPT RCHK^^0
"BLD",2797,"KRN",101,"NM",18,0)
RG EXCPT RDISP^^0
"BLD",2797,"KRN",101,"NM",19,0)
RG EXCPT RSEND^^0
"BLD",2797,"KRN",101,"NM",20,0)
RG EXCPT SELECT^^0
"BLD",2797,"KRN",101,"NM",21,0)
RG EXCPT SELECT TYPE^^0
"BLD",2797,"KRN",101,"NM",22,0)
RG EXCPT TYPE SORT^^0
"BLD",2797,"KRN",101,"NM",23,0)
RG EXCPT UPDATE STATUS^^0
"BLD",2797,"KRN",101,"NM",24,0)
RG EXCPT BLANK2^^0
"BLD",2797,"KRN",101,"NM","B","RG EXCPT ACTION MENU",2)

"BLD",2797,"KRN",101,"NM","B","RG EXCPT BLANK1",3)

"BLD",2797,"KRN",101,"NM","B","RG EXCPT BLANK2",24)

"BLD",2797,"KRN",101,"NM","B","RG EXCPT DATE SORT",4)

"BLD",2797,"KRN",101,"NM","B","RG EXCPT DISPLAY ONLY QUERY",5)

"BLD",2797,"KRN",101,"NM","B","RG EXCPT EDIT NOTE",6)

"BLD",2797,"KRN",101,"NM","B","RG EXCPT EDIT PATIENT DATA",7)

"BLD",2797,"KRN",101,"NM","B","RG EXCPT HINQ INQUIRY",8)

"BLD",2797,"KRN",101,"NM","B","RG EXCPT MAIN MENU",9)

"BLD",2797,"KRN",101,"NM","B","RG EXCPT MPI/PD DATA",10)

"BLD",2797,"KRN",101,"NM","B","RG EXCPT PATIENT AUDIT",11)

"BLD",2797,"KRN",101,"NM","B","RG EXCPT PATIENT INQUIRY",12)

"BLD",2797,"KRN",101,"NM","B","RG EXCPT PATIENT SORT",13)

"BLD",2797,"KRN",101,"NM","B","RG EXCPT PDAT MENU",14)

"BLD",2797,"KRN",101,"NM","B","RG EXCPT POT MATCH",1)

"BLD",2797,"KRN",101,"NM","B","RG EXCPT PV MPI PDAT",15)

"BLD",2797,"KRN",101,"NM","B","RG EXCPT PV REJECT",16)

"BLD",2797,"KRN",101,"NM","B","RG EXCPT RCHK",17)

"BLD",2797,"KRN",101,"NM","B","RG EXCPT RDISP",18)

"BLD",2797,"KRN",101,"NM","B","RG EXCPT RSEND",19)

"BLD",2797,"KRN",101,"NM","B","RG EXCPT SELECT",20)

"BLD",2797,"KRN",101,"NM","B","RG EXCPT SELECT TYPE",21)

"BLD",2797,"KRN",101,"NM","B","RG EXCPT TYPE SORT",22)

"BLD",2797,"KRN",101,"NM","B","RG EXCPT UPDATE STATUS",23)

"BLD",2797,"KRN",409.61,0)
409.61
"BLD",2797,"KRN",771,0)
771
"BLD",2797,"KRN",779.2,0)
779.2
"BLD",2797,"KRN",870,0)
870
"BLD",2797,"KRN",8989.51,0)
8989.51
"BLD",2797,"KRN",8989.52,0)
8989.52
"BLD",2797,"KRN",8994,0)
8994
"BLD",2797,"KRN","B",.4,.4)

"BLD",2797,"KRN","B",.401,.401)

"BLD",2797,"KRN","B",.402,.402)

"BLD",2797,"KRN","B",.403,.403)

"BLD",2797,"KRN","B",.5,.5)

"BLD",2797,"KRN","B",.84,.84)

"BLD",2797,"KRN","B",3.6,3.6)

"BLD",2797,"KRN","B",3.8,3.8)

"BLD",2797,"KRN","B",9.2,9.2)

"BLD",2797,"KRN","B",9.8,9.8)

"BLD",2797,"KRN","B",19,19)

"BLD",2797,"KRN","B",19.1,19.1)

"BLD",2797,"KRN","B",101,101)

"BLD",2797,"KRN","B",409.61,409.61)

"BLD",2797,"KRN","B",771,771)

"BLD",2797,"KRN","B",779.2,779.2)

"BLD",2797,"KRN","B",870,870)

"BLD",2797,"KRN","B",8989.51,8989.51)

"BLD",2797,"KRN","B",8989.52,8989.52)

"BLD",2797,"KRN","B",8994,8994)

"BLD",2797,"QDEF")
^^^^^^^^^^YES
"BLD",2797,"QUES",0)
^9.62^^
"BLD",2797,"REQB",0)
^9.611^2^2
"BLD",2797,"REQB",1,0)
RG*1.0*52^2
"BLD",2797,"REQB",2,0)
RG*1.0*54^2
"BLD",2797,"REQB","B","RG*1.0*52",1)

"BLD",2797,"REQB","B","RG*1.0*54",2)

"INIT")
RGP57PST
"KRN",101,1692,-1)
0^9
"KRN",101,1692,0)
RG EXCPT MAIN MENU^MPI/PD EXCEPTION MENU^^M^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1692,1,0)
^101.06^2^2^3010719^^^^
"KRN",101,1692,1,1,0)
This protocol serves as the main menu of exception handling options
"KRN",101,1692,1,2,0)
under the MPI/PD Exception Handling option [RG EXCEPTION HANDLING].
"KRN",101,1692,4)
40^4
"KRN",101,1692,10,0)
^101.01PA^7^7
"KRN",101,1692,10,3,0)
1693^SE^15^^^Select Exception
"KRN",101,1692,10,3,"^")
RG EXCPT SELECT
"KRN",101,1692,10,4,0)
1699^ST^10^^^Sort by Exception Type
"KRN",101,1692,10,4,"^")
RG EXCPT TYPE SORT
"KRN",101,1692,10,5,0)
1700^SD^5^^^Sort Exceptions by Date
"KRN",101,1692,10,5,"^")
RG EXCPT DATE SORT
"KRN",101,1692,10,6,0)
1701^SN^7^^^Sort by Patient Name
"KRN",101,1692,10,6,"^")
RG EXCPT PATIENT SORT
"KRN",101,1692,10,7,0)
1702^VT^12^^^View Selected Exception Type
"KRN",101,1692,10,7,"^")
RG EXCPT SELECT TYPE
"KRN",101,1692,26)
D SHOW^VALM
"KRN",101,1692,28)
Select Action:
"KRN",101,1692,99)
61369,29365
"KRN",101,1693,-1)
0^20
"KRN",101,1693,0)
RG EXCPT SELECT^Select Exception^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1693,1,0)
^101.06^3^3^3010719^^^^
"KRN",101,1693,1,1,0)
This protocol allows the user to select an exception for processing
"KRN",101,1693,1,2,0)
from the MPI/PD Exceptions screen in the MPI/PD Exception Handling
"KRN",101,1693,1,3,0)
option [RG EXCEPTION HANDLING].
"KRN",101,1693,20)
D SELECT^RGEXHND1
"KRN",101,1693,99)
61369,29365
"KRN",101,1694,-1)
0^2
"KRN",101,1694,0)
RG EXCPT ACTION MENU^MPI/PD EXCEPTION HANDLING^^M^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1694,1,0)
^101.06^4^4^3100310^^^^
"KRN",101,1694,1,1,0)
This protocol serves as the action menu and allows several
"KRN",101,1694,1,2,0)
actions to be taken for a patient selected from the MPI/PD
"KRN",101,1694,1,3,0)
Exception Menu [RG EXCPT MAIN MENU].  This is activated through
"KRN",101,1694,1,4,0)
the MPI/PD Exception Handling option [RG EXCEPTION HANDLING].
"KRN",101,1694,4)
26^4
"KRN",101,1694,10,0)
^101.01PAI^16^15
"KRN",101,1694,10,3,0)
1695^UPD^90^^^Update to Processed
"KRN",101,1694,10,3,"^")
RG EXCPT UPDATE STATUS
"KRN",101,1694,10,4,0)
1696^DO^50^^^MPI Display Only Qry
"KRN",101,1694,10,4,"^")
RG EXCPT DISPLAY ONLY QUERY
"KRN",101,1694,10,6,0)
1698^ED^70^^^Edit Patient Data
"KRN",101,1694,10,6,"^")
RG EXCPT EDIT PATIENT DATA
"KRN",101,1694,10,7,0)
1703^PI^20^^^Patient Inquiry
"KRN",101,1694,10,7,"^")
RG EXCPT PATIENT INQUIRY
"KRN",101,1694,10,8,0)
1704^AUD^10^^^Patient Audit
"KRN",101,1694,10,8,"^")
RG EXCPT PATIENT AUDIT
"KRN",101,1694,10,9,0)
1705^HI^30^^^Hinq Inquiry
"KRN",101,1694,10,9,"^")
RG EXCPT HINQ INQUIRY
"KRN",101,1694,10,10,0)
1806^DI^100^^^MPI/PD Data Inquiry
"KRN",101,1694,10,10,"^")
RG EXCPT MPI/PD DATA
"KRN",101,1694,10,11,0)
1846^NT^110^^^Edit Note
"KRN",101,1694,10,11,"^")
RG EXCPT EDIT NOTE
"KRN",101,1694,10,13,0)
2098^PVR^80^^^View PV Rej Detail
"KRN",101,1694,10,13,"^")
RG EXCPT PV REJECT
"KRN",101,1694,10,14,0)
2103^^40^
"KRN",101,1694,10,14,"^")
RG EXCPT BLANK1
"KRN",101,1694,10,15,0)
2117^PR^120^^^MPI Primary View
"KRN",101,1694,10,15,"^")
RG EXCPT PV MPI PDAT
"KRN",101,1694,10,16,0)
2179^^85^
"KRN",101,1694,10,16,"^")
RG EXCPT BLANK2
"KRN",101,1694,20)

"KRN",101,1694,26)
D SHOW^VALM
"KRN",101,1694,28)
Select Action:
"KRN",101,1694,99)
61795,48488
"KRN",101,1695,-1)
0^23
"KRN",101,1695,0)
RG EXCPT UPDATE STATUS^Update Status to Processed^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1695,1,0)
^101.06^3^3^3010719^^^^
"KRN",101,1695,1,1,0)
This protocol allows the user to update the exception status 
"KRN",101,1695,1,2,0)
to PROCESSED from the MPI/PD Exception Handling option [RG 
"KRN",101,1695,1,3,0)
EXCEPTION HANDLING].
"KRN",101,1695,2,0)
^101.02A^^0
"KRN",101,1695,4)
^^^
"KRN",101,1695,20)
D UPD^RGEX03
"KRN",101,1695,99)
61369,29365
"KRN",101,1696,-1)
0^5
"KRN",101,1696,0)
RG EXCPT DISPLAY ONLY QUERY^Display Only Query to MPI^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1696,1,0)
^101.06^2^2^3010719^^^^
"KRN",101,1696,1,1,0)
This protocol allows the user to perform a Display Only Query to the MPI
"KRN",101,1696,1,2,0)
from the MPI/PD Exception Handling option [RG EXCEPTION HANDLING].
"KRN",101,1696,20)
D DISP^RGEX03
"KRN",101,1696,99)
61369,29365
"KRN",101,1698,-1)
0^7
"KRN",101,1698,0)
RG EXCPT EDIT PATIENT DATA^Edit Patient Data^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1698,1,0)
^101.06^2^2^3010719^^^^
"KRN",101,1698,1,1,0)
This protocol allows the user to edit patient data from the 
"KRN",101,1698,1,2,0)
MPI/PD Exception Handling option [RG EXCEPTION HANDLING].
"KRN",101,1698,20)
D LOAD^RGEX03
"KRN",101,1698,99)
61369,29365
"KRN",101,1699,-1)
0^22
"KRN",101,1699,0)
RG EXCPT TYPE SORT^Sort by Exception Type^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1699,1,0)
^101.06^2^2^3010719^^^^
"KRN",101,1699,1,1,0)
This protocol allows the user to sort exceptions by type in the
"KRN",101,1699,1,2,0)
MPI/PD Exception Handling option [RG EXCEPTION HANDLING].
"KRN",101,1699,20)
S RGSORT="ST" D SORT^RGEX01
"KRN",101,1699,99)
61369,29365
"KRN",101,1700,-1)
0^4
"KRN",101,1700,0)
RG EXCPT DATE SORT^Sort by Exception Date^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1700,1,0)
^101.06^2^2^3010719^^^^
"KRN",101,1700,1,1,0)
This protocol allows the user to sort exceptions by date in the
"KRN",101,1700,1,2,0)
MPI/PD Exception Handling option [RG EXCEPTION HANDLING].
"KRN",101,1700,20)
S RGSORT="SD" D SORT^RGEX01
"KRN",101,1700,99)
61369,29365
"KRN",101,1701,-1)
0^13
"KRN",101,1701,0)
RG EXCPT PATIENT SORT^Sort by Patient ^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1701,1,0)
^101.06^2^2^3010719^^^^
"KRN",101,1701,1,1,0)
This protocol allows the user to sort exceptions by patient in
"KRN",101,1701,1,2,0)
the MPI/PD Exception Handling option [RG EXCEPTION HANDLING].
"KRN",101,1701,20)
S RGSORT="SN" D SORT^RGEX01
"KRN",101,1701,99)
61369,29365
"KRN",101,1702,-1)
0^21
"KRN",101,1702,0)
RG EXCPT SELECT TYPE^View Selected Exception Type^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1702,1,0)
^101.06^4^4^3010719^^^^
"KRN",101,1702,1,1,0)
This protocol allows the user to select an exception type to 
"KRN",101,1702,1,2,0)
view, all others will be filtered out, for exception processing
"KRN",101,1702,1,3,0)
from the MPI/PD Exceptions screen in the MPI/PD Exception Handling
"KRN",101,1702,1,4,0)
option [RG EXCEPTION HANDLING].
"KRN",101,1702,20)
S RGSORT="VT" D SORT^RGEX01
"KRN",101,1702,27)

"KRN",101,1702,99)
61369,29365
"KRN",101,1703,-1)
0^12
"KRN",101,1703,0)
RG EXCPT PATIENT INQUIRY^Patient Inquiry^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1703,1,0)
^101.06^2^2^3061108^^^^
"KRN",101,1703,1,1,0)
This protocol allows the user to do a Patient Inquiry from the 
"KRN",101,1703,1,2,0)
MPI/PD Exception Handling option [RG EXCEPTION HANDLING].
"KRN",101,1703,20)
D INQ^RGEX03
"KRN",101,1703,99)
61369,29365
"KRN",101,1704,-1)
0^11
"KRN",101,1704,0)
RG EXCPT PATIENT AUDIT^Patient Audit^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1704,1,0)
^101.06^2^2^3010719^^^^
"KRN",101,1704,1,1,0)
This protocol allows the user to audit the changes made in the
"KRN",101,1704,1,2,0)
MPI/PD Exception Handling option [RG EXCEPTION HANDLING].
"KRN",101,1704,20)
D PA^RGEX03
"KRN",101,1704,99)
61369,29365
"KRN",101,1705,-1)
0^8
"KRN",101,1705,0)
RG EXCPT HINQ INQUIRY^Hinq Inquiry^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1705,1,0)
^101.06^3^3^3010719^^^^
"KRN",101,1705,1,1,0)
This protocol allows the user to do a HINQ Inquiry for a 
"KRN",101,1705,1,2,0)
selected patient in the MPI/PD Exception Handling option 
"KRN",101,1705,1,3,0)
[RG EXCEPTION HANDLING].
"KRN",101,1705,20)
D HI^RGEX03
"KRN",101,1705,99)
61369,29365
"KRN",101,1806,-1)
0^10
"KRN",101,1806,0)
RG EXCPT MPI/PD DATA^MPI/PD Data Inquiry^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1806,1,0)
^101.06^2^2^3011022^^^^
"KRN",101,1806,1,1,0)
This protocol displays Master Patient Index/Patient Demographics 
"KRN",101,1806,1,2,0)
(MPI/PD) information for the selected patient.
"KRN",101,1806,2,0)
^101.02A^2^1
"KRN",101,1806,2,2,0)
DI
"KRN",101,1806,2,"B","DI",2)

"KRN",101,1806,20)
D PDAT^RGEX03
"KRN",101,1806,99)
61369,29365
"KRN",101,1842,-1)
0^19
"KRN",101,1842,0)
RG EXCPT RSEND^Send Remote Patient Data Query^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1842,1,0)
^^2^2^3011016^
"KRN",101,1842,1,1,0)
This protocol allows the user to send a remote patient data query to
"KRN",101,1842,1,2,0)
treating facility sites.
"KRN",101,1842,20)
D RSEND^RGEX04
"KRN",101,1842,99)
61369,29365
"KRN",101,1843,-1)
0^17
"KRN",101,1843,0)
RG EXCPT RCHK^Check Remote Patient Data Query^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1843,1,0)
^^2^2^3011016^
"KRN",101,1843,1,1,0)
This protocol allows the user to check the status of a remote patient data
"KRN",101,1843,1,2,0)
query.
"KRN",101,1843,20)
D RCHK^RGEX04
"KRN",101,1843,99)
61369,29365
"KRN",101,1844,-1)
0^18
"KRN",101,1844,0)
RG EXCPT RDISP^Display Patient Data Query^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1844,1,0)
^^2^2^3011016^
"KRN",101,1844,1,1,0)
This protocol allows the user to check the status of a remote patient data
"KRN",101,1844,1,2,0)
query.
"KRN",101,1844,20)
D RDISP^RGEX04
"KRN",101,1844,99)
61369,29365
"KRN",101,1845,-1)
0^14
"KRN",101,1845,0)
RG EXCPT PDAT MENU^MPI/PD PATIENT DATA ACTION MENU^^M^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1845,1,0)
^^2^2^3011016^
"KRN",101,1845,1,1,0)
This protocol serves as the action menu for the MPI/PD Exception Handling
"KRN",101,1845,1,2,0)
Patient Data Query actions.
"KRN",101,1845,4)
40
"KRN",101,1845,10,0)
^101.01PAI^3^3
"KRN",101,1845,10,1,0)
1842^SND^5^^^Send Remote Query
"KRN",101,1845,10,1,"^")
RG EXCPT RSEND
"KRN",101,1845,10,2,0)
1843^CHK^10^^^Check Remote Query
"KRN",101,1845,10,2,"^")
RG EXCPT RCHK
"KRN",101,1845,10,3,0)
1844^DSP^15^^^Display Query Data
"KRN",101,1845,10,3,"^")
RG EXCPT RDISP
"KRN",101,1845,26)
D SHOW^VALM
"KRN",101,1845,28)
Select Action:
"KRN",101,1845,99)
61369,29365
"KRN",101,1846,-1)
0^6
"KRN",101,1846,0)
RG EXCPT EDIT NOTE^Edit Notes^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,1846,1,0)
^^1^1^3011030^
"KRN",101,1846,1,1,0)
This protocol allows the user to add/edit notes to the exception.
"KRN",101,1846,20)
D EDTNOT^RGEX03
"KRN",101,1846,99)
61369,29365
"KRN",101,2098,-1)
0^16
"KRN",101,2098,0)
RG EXCPT PV REJECT^Primary View Reject^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,2098,1,0)
^101.06^8^8^3070226^^^^
"KRN",101,2098,1,1,0)
This action allows the review of remote data from the Master Patient 
"KRN",101,2098,1,2,0)
Index (MPI).  When patient identity information is edited locally and 
"KRN",101,2098,1,3,0)
sent to the MPI, it is compared to the Primary View data and must also 
"KRN",101,2098,1,4,0)
pass specific data business rules before updating the MPI.  If the local 
"KRN",101,2098,1,5,0)
data fails, either because the Authority Score was not high enough (in 
"KRN",101,2098,1,6,0)
comparison to Primary View) or it failed a business rule, it is 
"KRN",101,2098,1,7,0)
rejected.  This protocol allows the local facility to review the reason 
"KRN",101,2098,1,8,0)
for the rejected data.
"KRN",101,2098,20)
D REJ^RGEX03
"KRN",101,2098,99)
61369,29365
"KRN",101,2103,-1)
0^3
"KRN",101,2103,0)
RG EXCPT BLANK1^^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,2103,1,0)
^^2^2^3061116^
"KRN",101,2103,1,1,0)
The purpose of this protocol entry is to control menu alignment.
"KRN",101,2103,1,2,0)
It contains no ITEM TEXT or MNEMONIC, as it is only a placeholder.
"KRN",101,2117,-1)
0^15
"KRN",101,2117,0)
RG EXCPT PV MPI PDAT^MPI Primary View^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,2117,1,0)
^101.06^5^5^3070516^^^
"KRN",101,2117,1,1,0)
This action allows the review of remote data from the Master Patient 
"KRN",101,2117,1,2,0)
Index (MPI).  For a selected patient, the Remote Procedure Call returns 
"KRN",101,2117,1,3,0)
the Primary View data as it currently exists on the MPI Patient Data 
"KRN",101,2117,1,4,0)
Inquiry (PDAT) report.  This protocol allows the local facility to review 
"KRN",101,2117,1,5,0)
the Primary View data.
"KRN",101,2117,20)
D MPIPV^RGEX03
"KRN",101,2117,99)
61369,29365
"KRN",101,2179,-1)
0^24
"KRN",101,2179,0)
RG EXCPT BLANK2^^^A^^^^^^^^CLINICAL INFO RESOURCE NETWORK
"KRN",101,2179,1,0)
^^2^2^3100310^
"KRN",101,2179,1,1,0)
The purpose of this protocol entry is to control menu alignment.  It 
"KRN",101,2179,1,2,0)
contains no ITEM TEXT or MNEMONIC, as it is only a placeholder.
"KRN",101,2180,-1)
1^1
"KRN",101,2180,0)
RG EXCPT POT MATCH
"MBREQ")
0
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"PKG",272,-1)
1^1
"PKG",272,0)
CLINICAL INFO RESOURCE NETWORK^RG^CIRN
"PKG",272,20,0)
^9.402P^^0
"PKG",272,22,0)
^9.49I^1^1
"PKG",272,22,1,0)
1.0^2990430^2990601^12555
"PKG",272,22,1,"PAH",1,0)
57^3100409
"PKG",272,22,1,"PAH",1,1,0)
^^3^3^3100409
"PKG",272,22,1,"PAH",1,1,1,0)
REMOVE POTENTIAL MATCHES RETURNED EXCEPTION REFERENCES
"PKG",272,22,1,"PAH",1,1,2,0)
Refer to patch RG*1*57 in the FORUM Patch Module for a complete
"PKG",272,22,1,"PAH",1,1,3,0)
description.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
8
"RTN","RGEX01")
0^1^B22714339^B26588821
"RTN","RGEX01",1,0)
RGEX01 ;BAY/ALS-LIST MANAGER FOR MPI/PD EXCEPTIONS ;10/07/99
"RTN","RGEX01",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**3,12,19,23,43,45,47,48,52,57**;30 Apr 99;Build 2
"RTN","RGEX01",3,0)
 ;
"RTN","RGEX01",4,0)
 ;Reference to MAIN^VAFCPDAT supported by IA #3299
"RTN","RGEX01",5,0)
EN ; -- main entry point for RG EXCPT SUMMARY
"RTN","RGEX01",6,0)
 N STDT,ENDDT,PRGSTAT,XFLAG,NOW,%,X,%H,%I,INDT,RUN,INDTT
"RTN","RGEX01",7,0)
 S XFLAG=0 D NOW^%DTC S NOW=%
"RTN","RGEX01",8,0)
 S STDT=$P($G(^RGSITE(991.8,1,"EXCPRG")),"^",1),INDT=STDT
"RTN","RGEX01",9,0)
 I $D(STDT) S STDT=$$FMTE^XLFDT(STDT,1)
"RTN","RGEX01",10,0)
 S PRGSTAT=$P($G(^RGSITE(991.8,1,"EXCPRG")),"^",3)
"RTN","RGEX01",11,0)
 ;status shows 'running' but lock shows 'not running';**47
"RTN","RGEX01",12,0)
 I PRGSTAT="R" D
"RTN","RGEX01",13,0)
 .L +^RGHL7(991.1,"RG PURGE EXCEPTION"):0 I $T D  ;can get lock
"RTN","RGEX01",14,0)
 ..L +^RGSITE(991.8):10
"RTN","RGEX01",15,0)
 ..S DIE="^RGSITE(991.8,",DA=1,DR="42///@"
"RTN","RGEX01",16,0)
 ..D ^DIE K DA,DIE,DR ;delete old status
"RTN","RGEX01",17,0)
 ..L -^RGSITE(991.8)
"RTN","RGEX01",18,0)
 ..S PRGSTAT=""
"RTN","RGEX01",19,0)
 .L -^RGHL7(991.1,"RG PURGE EXCEPTION")
"RTN","RGEX01",20,0)
 I PRGSTAT="" D
"RTN","RGEX01",21,0)
 . W $C(7)
"RTN","RGEX01",22,0)
 . W !!,"The MPI/PD Exception Purge process has not been run."
"RTN","RGEX01",23,0)
 . ;**48 NO LONGER A CHOICE
"RTN","RGEX01",24,0)
 . W !!,"The MPI/PD Exception Purge process will now run."
"RTN","RGEX01",25,0)
 . W !,"Please come back to this option in five minutes."
"RTN","RGEX01",26,0)
 . W !!,"Please contact IRM to schedule the MPI/PD EXCEPTION PURGE"
"RTN","RGEX01",27,0)
 . W !,"[RG EXCEPTION PURGE] option via TaskMan with a frequency of once an hour."
"RTN","RGEX01",28,0)
 . S XFLAG=1 D QUEPRG
"RTN","RGEX01",29,0)
 L +^RGHL7(991.1,"RG PURGE EXCEPTION"):0 I '$T W $C(7),!!,"The MPI/PD Exception Purge process is currently running.",!,"Please try this option again in five minutes." S XFLAG=1 G EXIT
"RTN","RGEX01",30,0)
 L -^RGHL7(991.1,"RG PURGE EXCEPTION")
"RTN","RGEX01",31,0)
 S RUN=0
"RTN","RGEX01",32,0)
 I $G(PRGSTAT)="C" D
"RTN","RGEX01",33,0)
 . I $P(INDT,".")<$P(NOW,".") S RUN=1 ;RAN A PREVIOUS DAY
"RTN","RGEX01",34,0)
 . I $P(INDT,".")=$P(NOW,".") D
"RTN","RGEX01",35,0)
 .. S INDTT=$E($P(INDT,".",2),1,4),INDTT=INDTT+101
"RTN","RGEX01",36,0)
 .. I INDTT<$E($P(NOW,".",2),1,4) S RUN=1
"RTN","RGEX01",37,0)
 . Q:RUN=0
"RTN","RGEX01",38,0)
 . ;** if job ran more than 1 hour ago, run it now.
"RTN","RGEX01",39,0)
 . W !!,"The MPI/PD Exception Purge process last ran "_STDT_"."
"RTN","RGEX01",40,0)
 . W !!,"The MPI/PD Exception Purge process will now run."
"RTN","RGEX01",41,0)
 . W !,"Please come back to this option in five minutes."
"RTN","RGEX01",42,0)
 . W !!,"Please contact IRM to verify that the MPI/PD EXCEPTION PURGE "
"RTN","RGEX01",43,0)
 . W !,"[RG EXCEPTION PURGE] option is scheduled to run via TaskMan"
"RTN","RGEX01",44,0)
 . W !,"with a frequency of once an hour."
"RTN","RGEX01",45,0)
 . S XFLAG=1 D QUEPRG
"RTN","RGEX01",46,0)
 I XFLAG=1 G EXIT
"RTN","RGEX01",47,0)
 K RGANS
"RTN","RGEX01",48,0)
 D WAIT^DICD
"RTN","RGEX01",49,0)
 D EN^VALM("RG EXCPT SUMMARY")
"RTN","RGEX01",50,0)
 Q
"RTN","RGEX01",51,0)
 ;
"RTN","RGEX01",52,0)
HDR ; -- header code
"RTN","RGEX01",53,0)
 S VALMHDR(1)="MPI/PD Exception Handling"
"RTN","RGEX01",54,0)
 S VALMHDR(2)=""
"RTN","RGEX01",55,0)
 Q
"RTN","RGEX01",56,0)
 ;
"RTN","RGEX01",57,0)
INIT ; -- init variables and list array
"RTN","RGEX01",58,0)
 I '$D(RGSORT) S RGSORT="SD"
"RTN","RGEX01",59,0)
 K @VALMAR
"RTN","RGEX01",60,0)
 I RGSORT="SD" D DTLIST^RGEXHND1
"RTN","RGEX01",61,0)
 E  I RGSORT="ST" D EXCLST^RGEXHND1
"RTN","RGEX01",62,0)
 E  I RGSORT="SN" D PATLST^RGEXHND1
"RTN","RGEX01",63,0)
 E  I RGSORT="VT" D SELTYP^RGEXHND1
"RTN","RGEX01",64,0)
 Q
"RTN","RGEX01",65,0)
 ;
"RTN","RGEX01",66,0)
SORT ;
"RTN","RGEX01",67,0)
 D INIT
"RTN","RGEX01",68,0)
 S VALMBCK="R"
"RTN","RGEX01",69,0)
 Q
"RTN","RGEX01",70,0)
HELP ; -- help code
"RTN","RGEX01",71,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","RGEX01",72,0)
 Q
"RTN","RGEX01",73,0)
HLPPRG ;
"RTN","RGEX01",74,0)
 W !,"Enter Y(YES) to run the MPI/PD Exception Purge process now."
"RTN","RGEX01",75,0)
 W !!,"Enter N(NO) to go directly into the MPI/PD Exception Handling option."
"RTN","RGEX01",76,0)
 Q
"RTN","RGEX01",77,0)
 ;
"RTN","RGEX01",78,0)
EXIT ; -- exit code
"RTN","RGEX01",79,0)
 K VADM,RGDFN,RGNM,RGSORT,RGSSN,STAT,STRING,NDX,NM,IEN,IEN2,X,DATA,CNT,EXCTYPE,ETYPE,^TMP("RGEXC",$J),^TMP("RGEX01",$J)
"RTN","RGEX01",80,0)
 Q
"RTN","RGEX01",81,0)
QUEPRG S ZTRTN="MAIN^RGEVPRG",ZTDESC="PURGE ZZ*, OVER 30 DAY AND DUPLICATE RECORDS FROM THE CIRN HL7 EXCEPTION LOG FILE"
"RTN","RGEX01",82,0)
 D NOW^%DTC
"RTN","RGEX01",83,0)
 S ZTIO="",ZTDTH=%
"RTN","RGEX01",84,0)
 I $D(DUZ) S ZTSAVE("DUZ")=DUZ
"RTN","RGEX01",85,0)
 D ^%ZTLOAD
"RTN","RGEX01",86,0)
 D HOME^%ZIS K IO("Q")
"RTN","RGEX01",87,0)
 K ZTDESC,ZTDTH,ZTIO,ZTQUEUED,ZTREQ,ZTRTN,ZTSAVE,ZTSK,%
"RTN","RGEX01",88,0)
 Q
"RTN","RGEX01",89,0)
 ;
"RTN","RGEX01",90,0)
EXPND ; -- expand code
"RTN","RGEX01",91,0)
 Q
"RTN","RGEX01",92,0)
 ;
"RTN","RGEX01",93,0)
CUREX() ;**57 MPIC_1893 The CUREX module is obsolete and is no longer being called.
"RTN","RGEX01",94,0)
 ;Are there any patients in the CIRN HL7 EXCEPTION LOG file (#991.1)
"RTN","RGEX01",95,0)
 ;that are NOT PROCESSED for specific exception types?
"RTN","RGEX01",96,0)
 ;     Return RGEX:
"RTN","RGEX01",97,0)
 ;If RGEX=3 both unprocessed and Primary View Reject exceptions exist
"RTN","RGEX01",98,0)
 ;If RGEX=2 only Primary View Reject exceptions exist
"RTN","RGEX01",99,0)
 ;If RGEX=1 only unprocessed exceptions exist
"RTN","RGEX01",100,0)
 ;If RGEX=0 no unprocessed exceptions exist
"RTN","RGEX01",101,0)
 ;
"RTN","RGEX01",102,0)
 ;N EXCTYP,RG1,RG2,RGEX
"RTN","RGEX01",103,0)
 ;S EXCTYP="",(RG1,RG2,RGEX)=0
"RTN","RGEX01",104,0)
 ;F  S EXCTYP=$O(^RGHL7(991.1,"ASTAT","0",EXCTYP)) Q:'EXCTYP  D
"RTN","RGEX01",105,0)
 ;.I (EXCTYP=234)!(EXCTYP=218) S RG1=1 ;**52 MPIC_772 remove 215, 216 & 217
"RTN","RGEX01",106,0)
 ;.I (EXCTYP=234) S RG2=1 ;Primary View Reject
"RTN","RGEX01",107,0)
 ;I (RG1=1),(RG2=1) S RGEX=3 ;Send both messages
"RTN","RGEX01",108,0)
 ;I (RG1=1),(RG2=0) S RGEX=1 ;Only unresolved exceptions exist
"RTN","RGEX01",109,0)
 ;I (RG1=0),(RG2=1) S RGEX=2 ;Only Primary View Reject exceptions exist
"RTN","RGEX01",110,0)
 S RGEX=0 Q RGEX
"RTN","RGEX01",111,0)
 ;
"RTN","RGEX01",112,0)
PROC ; For a given patient, set exceptions STATUS to PROCESSED.
"RTN","RGEX01",113,0)
 ;**52 The PROC module is obsolete and is no longer being called.
"RTN","RGEX01",114,0)
 ; DFN must be defined
"RTN","RGEX01",115,0)
 ;Q:'$D(DFN)
"RTN","RGEX01",116,0)
 ;S EXCTYP=""
"RTN","RGEX01",117,0)
 ;S HOME=$$SITE^VASITE()
"RTN","RGEX01",118,0)
 ;F  S EXCTYP=$O(^RGHL7(991.1,"ADFN",EXCTYP)) Q:'EXCTYP  D
"RTN","RGEX01",119,0)
 ;. S RGDFN="",ICN=""
"RTN","RGEX01",120,0)
 ;. F  S RGDFN=$O(^RGHL7(991.1,"ADFN",EXCTYP,RGDFN)) Q:'RGDFN  D
"RTN","RGEX01",121,0)
 ;.. I DFN=RGDFN D
"RTN","RGEX01",122,0)
 ;... S ICN=+$$GETICN^MPIF001(DFN)
"RTN","RGEX01",123,0)
 ;... ;Only set to PROCESSED if patient has national ICN.
"RTN","RGEX01",124,0)
 ;... I $E(ICN,1,3)'=$E($P(HOME,"^",3),1,3)&(ICN>0) D
"RTN","RGEX01",125,0)
 ;.... ;Exclude Death exceptions (215-217); they must be processed manually.
"RTN","RGEX01",126,0)
 ;.... ;Exclude 218 Potential Matches Returned exception **43
"RTN","RGEX01",127,0)
 ;.... I (EXCTYP>218)!(EXCTYP<215) D
"RTN","RGEX01",128,0)
 ;..... S IEN=0
"RTN","RGEX01",129,0)
 ;..... F  S IEN=$O(^RGHL7(991.1,"ADFN",EXCTYP,RGDFN,IEN)) Q:'IEN  D
"RTN","RGEX01",130,0)
 ;...... S IEN2=0
"RTN","RGEX01",131,0)
 ;...... F  S IEN2=$O(^RGHL7(991.1,"ADFN",EXCTYP,RGDFN,IEN,IEN2)) Q:'IEN2  D
"RTN","RGEX01",132,0)
 ;....... L +^RGHL7(991.1,IEN):10
"RTN","RGEX01",133,0)
 ;....... S DA(1)=IEN,DA=IEN2,DR="6///"_1,DIE="^RGHL7(991.1,"_DA(1)_",1,"
"RTN","RGEX01",134,0)
 ;....... D ^DIE K DIE,DA,DR
"RTN","RGEX01",135,0)
 ;....... L -^RGHL7(991.1,IEN)
"RTN","RGEX01",136,0)
 ;K IEN,IEN2,RGDFN,EXCTYP,ICN
"RTN","RGEX01",137,0)
 Q
"RTN","RGEX01",138,0)
PDAT ;
"RTN","RGEX01",139,0)
 K DIRUT
"RTN","RGEX01",140,0)
 W !,"This report prints MPI/PD Data for a selected patient.  The"
"RTN","RGEX01",141,0)
 W !,"information displayed includes the Integration Control Number"
"RTN","RGEX01",142,0)
 W !,"(ICN), patient identity information, and Treating Facility list."
"RTN","RGEX01",143,0)
 W !!,"The information is pulled from the Patient (#2) file and the"
"RTN","RGEX01",144,0)
 W !,"Treating Facility List (#391.91) file."
"RTN","RGEX01",145,0)
 ;
"RTN","RGEX01",146,0)
ASK ;Ask for PATIENT
"RTN","RGEX01",147,0)
 I $D(DIRUT) G QUIT
"RTN","RGEX01",148,0)
 W !!,"Patient lookup can be done by Patient Name/SSN or by ICN.",!
"RTN","RGEX01",149,0)
 N DFN,ICN
"RTN","RGEX01",150,0)
 S DIC="^DPT(",DIC(0)="QEAM",DIC("A")="Select PATIENT: ",D="SSN^AICN^B^BS^BS5"
"RTN","RGEX01",151,0)
 D MIX^DIC1 K DIC
"RTN","RGEX01",152,0)
 G:Y<0 QUIT
"RTN","RGEX01",153,0)
 S DFN=+Y
"RTN","RGEX01",154,0)
 D MAIN^VAFCPDAT
"RTN","RGEX01",155,0)
 G ASK
"RTN","RGEX01",156,0)
 Q
"RTN","RGEX01",157,0)
QUIT ;
"RTN","RGEX01",158,0)
 K DFN,ICN,D,Y,HOME
"RTN","RGEX03")
0^7^B81177461^B81303188
"RTN","RGEX03",1,0)
RGEX03 ;BAY/ALS-LIST MANAGER FOR MPI/PD EXCEPTIONS ;10/13/99
"RTN","RGEX03",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**3,12,19,23,27,30,38,39,43,44,48,54,57**;30 Apr 99;Build 2
"RTN","RGEX03",3,0)
 ;
"RTN","RGEX03",4,0)
 ;Reference to START^VAFCPDAT supported by IA #3299
"RTN","RGEX03",5,0)
 ;Reference to ^DIA(2 supported by IA #2097
"RTN","RGEX03",6,0)
 ;Reference to ^DPT( supported by IA #2969
"RTN","RGEX03",7,0)
 ;Reference to HINQ^DG10 supported by IA #2076
"RTN","RGEX03",8,0)
 ;Reference to CIRNEXC^MPIFQ0 supported by IA #2942
"RTN","RGEX03",9,0)
 ;Reference to VTQ^MPIFSAQ supported by IA #2941
"RTN","RGEX03",10,0)
 ;Reference to NOTICE^DGSEC4 and PTSEC^DGSEC4 supported by IA#3027
"RTN","RGEX03",11,0)
 ;Reference to POT^MPIFDUP supported by IA #4464;**57 MPIC_1893 call obsolete; removed PMR
"RTN","RGEX03",12,0)
 ;Reference to $$NCEDIT^DPTNAME supported by private IA #4116
"RTN","RGEX03",13,0)
 ;
"RTN","RGEX03",14,0)
EN(DATA) ; -- main entry point for RG EXCPT ACTION
"RTN","RGEX03",15,0)
 D EN^VALM("RG EXCPT ACTION")
"RTN","RGEX03",16,0)
 Q
"RTN","RGEX03",17,0)
HDR ; -- header code
"RTN","RGEX03",18,0)
 S VALMHDR(1)="MPI/PD EXCEPTION HANDLING ACTIONS.",VALMHDR(2)=""
"RTN","RGEX03",19,0)
 Q
"RTN","RGEX03",20,0)
INIT ; -- init variables and list array
"RTN","RGEX03",21,0)
 K ^TMP("RGEXC2",$J)
"RTN","RGEX03",22,0)
 K @VALMAR
"RTN","RGEX03",23,0)
 I DATA="" Q
"RTN","RGEX03",24,0)
 S STR="",LIN=1,STATUS="",NAME="",DOB="",SSN="",DFN="",CHKSM="" ;**44
"RTN","RGEX03",25,0)
 S NAME=$P(DATA,"^",1),DOB=$P(DATA,"^",8),SSN=$P(DATA,"^",2)
"RTN","RGEX03",26,0)
 S DFN=$P(DATA,"^",5),CHKSM=$P($G(^DPT(DFN,"MPI")),"^",2) ;**44
"RTN","RGEX03",27,0)
 S STR=$$SETSTR^VALM1("Name:",STR,6,6),STR=$$SETSTR^VALM1(NAME,STR,14,30) D ADDTMP
"RTN","RGEX03",28,0)
 S STR=$$SETSTR^VALM1(" SSN:",STR,6,6),STR=$$SETSTR^VALM1(SSN,STR,14,12) D ADDTMP
"RTN","RGEX03",29,0)
 S STR=$$SETSTR^VALM1(" DOB:",STR,6,6),STR=$$SETSTR^VALM1(DOB,STR,14,20) D ADDTMP
"RTN","RGEX03",30,0)
 S STR=$$SETSTR^VALM1(" DFN:",STR,6,6),STR=$$SETSTR^VALM1(DFN,STR,14,12) D ADDTMP ;**44
"RTN","RGEX03",31,0)
 S STR=$$SETSTR^VALM1(" ICN:",STR,6,6),ICN="" S ICN=$P(DATA,"^",6) I ICN<0 S ICN=""
"RTN","RGEX03",32,0)
 S STR=$$SETSTR^VALM1(ICN_($S(CHKSM="":"",1:"V"_CHKSM)),STR,14,20) D ADDTMP ;**44
"RTN","RGEX03",33,0)
 S STR=$$SETSTR^VALM1("Date of Death:",STR,6,20),STR=$$SETSTR^VALM1($P(DATA,"^",13),STR,26,20) D ADDTMP
"RTN","RGEX03",34,0)
 S STR=$$SETSTR^VALM1("Exception Type:",STR,6,20),STR=$$SETSTR^VALM1($P(DATA,"^",4),STR,26,50) D ADDTMP
"RTN","RGEX03",35,0)
 S STR=$$SETSTR^VALM1("Exception Date:",STR,6,20),STR=$$SETSTR^VALM1($P(DATA,"^",3),STR,26,30) D ADDTMP
"RTN","RGEX03",36,0)
 S STATUS=$P(DATA,"^",9)
"RTN","RGEX03",37,0)
 I STATUS<1 S STATUS="NOT PROCESSED"
"RTN","RGEX03",38,0)
 E  S STATUS="PROCESSED"
"RTN","RGEX03",39,0)
 S STR=$$SETSTR^VALM1("Exception Status:",STR,6,20),STR=$$SETSTR^VALM1(STATUS,STR,26,15) D ADDTMP
"RTN","RGEX03",40,0)
 ;Added Exception Text to Exception Handler, patch 39
"RTN","RGEX03",41,0)
 N IEN,IEN2,X K ^UTILITY($J,"W") S IEN=$P(DATA,"^",10),IEN2=$P(DATA,"^",11)
"RTN","RGEX03",42,0)
 I IEN'=""!(IEN2'="") D
"RTN","RGEX03",43,0)
 .S EXCTEXT=$P($G(^RGHL7(991.1,IEN,1,IEN2,10)),"^",1) Q:EXCTEXT=""
"RTN","RGEX03",44,0)
 .S STR=$$SETSTR^VALM1("Exception Text:",STR,6,20)
"RTN","RGEX03",45,0)
 .S X=EXCTEXT,DIWL=1,DIWR=50,DIWF="|" D ^DIWP
"RTN","RGEX03",46,0)
 .F N=1:1:$P($G(^UTILITY($J,"W",1)),1) D  Q:'N
"RTN","RGEX03",47,0)
 ..S STR=$$SETSTR^VALM1(^UTILITY($J,"W",1,(N),0),STR,26,76)
"RTN","RGEX03",48,0)
 ..D ADDTMP
"RTN","RGEX03",49,0)
ADDNOTE ;Display Exception Notes, Word Processing field
"RTN","RGEX03",50,0)
 S STR=$$SETSTR^VALM1("Exception Notes:",STR,6,20) D ADDTMP
"RTN","RGEX03",51,0)
 N IEN,IEN2,IENS,N,NOTE
"RTN","RGEX03",52,0)
 S IEN=$P(DATA,"^",10),IEN2=$P(DATA,"^",11),IENS=IEN2_","_IEN_",",N=$$GET1^DIQ(991.12,IENS,11,"","NT")
"RTN","RGEX03",53,0)
 S L=0 F  S L=$O(NT(L)) Q:'L  S NOTE=NT(L),STR=$$SETSTR^VALM1(NOTE,STR,6,74) D ADDTMP
"RTN","RGEX03",54,0)
 S VALMCNT=LIN-1,DFN=$P(DATA,"^",5),VAFCDFN=DFN
"RTN","RGEX03",55,0)
 K L,NT
"RTN","RGEX03",56,0)
 Q
"RTN","RGEX03",57,0)
ADDTMP ;
"RTN","RGEX03",58,0)
 S ^TMP("RGEXC2",$J,LIN,0)=STR,^TMP("RGEXC2",$J,"IDX",LIN,LIN)="",LIN=LIN+1,STR=""
"RTN","RGEX03",59,0)
 Q
"RTN","RGEX03",60,0)
UPD ;
"RTN","RGEX03",61,0)
 N PROCDT,%,X,%I,%H
"RTN","RGEX03",62,0)
 W !,"This option updates the exception status to PROCESSED.",!,"After it is processed it will not be listed in the summary."
"RTN","RGEX03",63,0)
 S DIR("A")="Are you sure you want to change the status? ",DIR(0)="YA",DIR("B")="YES"
"RTN","RGEX03",64,0)
 D ^DIR Q:$D(DIRUT)  I Y>0 D
"RTN","RGEX03",65,0)
 .;**48 populating the date/time marked as processed and who marked it as processed
"RTN","RGEX03",66,0)
 .D NOW^%DTC S PROCDT=%
"RTN","RGEX03",67,0)
 .S IEN="",IEN2="",IEN=$P(DATA,"^",10),IEN2=$P(DATA,"^",11) L +^RGHL7(991.1,IEN):10
"RTN","RGEX03",68,0)
 .S DA(1)=IEN,DA=IEN2,DR="6///"_1_";7///"_PROCDT_";8////"_$G(DUZ),DIE="^RGHL7(991.1,"_DA(1)_",1," D ^DIE K DIE,DA,DR ;**57,MPIC_2024
"RTN","RGEX03",69,0)
 .L -^RGHL7(991.1,IEN) S $P(DATA,"^",9)=1
"RTN","RGEX03",70,0)
 .D INIT
"RTN","RGEX03",71,0)
 K DIR,DIRUT S VALMBCK="R"
"RTN","RGEX03",72,0)
 Q
"RTN","RGEX03",73,0)
PA ;Patient Audit
"RTN","RGEX03",74,0)
 S PDFN=DFN
"RTN","RGEX03",75,0)
 I '$O(^DIA(2,"B",VAFCDFN,0)) S VALMSG="This patient has no audit data available.",VALMBCK="" G PAQ
"RTN","RGEX03",76,0)
 N IEN S DFN=VAFCDFN,QFLG=1 D FULL^VALM1 D:$T(ASK2^RGMTAUD)]"" ASK2^RGMTAUD S VALMBCK="R"
"RTN","RGEX03",77,0)
 S DFN=PDFN K QFLG,PDFN
"RTN","RGEX03",78,0)
PAQ Q
"RTN","RGEX03",79,0)
HI ;Hinq Inquiry
"RTN","RGEX03",80,0)
 S VALMBCK="" D HINQ^DG10 D PAUSE^VALM1 S VALMBCK="R"
"RTN","RGEX03",81,0)
 Q
"RTN","RGEX03",82,0)
DISP ; Display Only Query
"RTN","RGEX03",83,0)
 S VALMBCK="" D FULL^VALM1
"RTN","RGEX03",84,0)
 S MPIVAR("DFN")=DFN,MPIVAR("SSN")=SSN,MPIVAR("NM")=NAME,MPIVAR("DOB")=$P($P(DATA,"^",7),".",1)
"RTN","RGEX03",85,0)
 D VTQ^MPIFSAQ(.MPIVAR) D PAUSE^VALM1
"RTN","RGEX03",86,0)
 S VALMBCK="R" K MPIVAR
"RTN","RGEX03",87,0)
 Q
"RTN","RGEX03",88,0)
 ;
"RTN","RGEX03",89,0)
POT ;Potential Match on MPI, Query MPI, resolve duplicate if needed. **43;**57 MPIC_1893 OBSOLETE; remove PMR
"RTN","RGEX03",90,0)
 ;D POT^MPIFDUP
"RTN","RGEX03",91,0)
 ;D INIT S VALMBCK="R" K PROCESS
"RTN","RGEX03",92,0)
 Q
"RTN","RGEX03",93,0)
 ;
"RTN","RGEX03",94,0)
REJ ;Primary View Reject. **44 Added entry point
"RTN","RGEX03",95,0)
 D REJ^RGPVREJ
"RTN","RGEX03",96,0)
 D INIT S VALMBCK="R"
"RTN","RGEX03",97,0)
 Q
"RTN","RGEX03",98,0)
 ;
"RTN","RGEX03",99,0)
MPIPV ;MPI Primary View PDAT. **48 Added entry point
"RTN","RGEX03",100,0)
 S SAPV=0 ;from EH, not stand alone option
"RTN","RGEX03",101,0)
 D SEND^RGPVMPI
"RTN","RGEX03",102,0)
 D INIT S VALMBCK="R"
"RTN","RGEX03",103,0)
 Q
"RTN","RGEX03",104,0)
 ;
"RTN","RGEX03",105,0)
LOAD ; Edit Patient Data, if patient's eligibility is verified - check for DG ELIGIBILITY key for user
"RTN","RGEX03",106,0)
 S VALMBCK="",DATAOLD=""
"RTN","RGEX03",107,0)
 D FULL^VALM1 D ELIG^VADPT
"RTN","RGEX03",108,0)
 I $P(VAEL(8),"^",1)="V" D
"RTN","RGEX03",109,0)
 .I '$D(^XUSEC("DG ELIGIBILITY",DUZ)) D
"RTN","RGEX03",110,0)
 ..W !!,"Eligibility has been verified for this patient.",!!,"You do not have access to edit the Name, Date of ",!,"Birth or Social Security Number for this patient."
"RTN","RGEX03",111,0)
 ..D PAUSE^VALM1 S VALMBCK="R"
"RTN","RGEX03",112,0)
 .E  D SENS
"RTN","RGEX03",113,0)
 E  D SENS
"RTN","RGEX03",114,0)
 Q
"RTN","RGEX03",115,0)
SENS ; check for patient sensitivity and user security
"RTN","RGEX03",116,0)
 N RESULT,RGSEN
"RTN","RGEX03",117,0)
 D PTSEC^DGSEC4(.RESULT,DFN,0,"RG EXCEPTION HANDLING^MPI/PD Exception Handling")
"RTN","RGEX03",118,0)
 I RESULT(1)=-1 W !!,"Access denied: Required parameters not defined" D PAUSE^VALM1 S VALMBCK="R" Q
"RTN","RGEX03",119,0)
 I RESULT(1)>0 W !!?15,"***PATIENT MARKED SENSITIVE***"
"RTN","RGEX03",120,0)
 I RESULT(1)=3 W !!?15,"Access not allowed on your own PATIENT (#2) file entry" D PAUSE^VALM1 S VALMBCK="R" Q
"RTN","RGEX03",121,0)
 I RESULT(1)=4 W !!?15,"Access denied: Your SSN is not defined" D PAUSE^VALM1 S VALMBCK="R" Q
"RTN","RGEX03",122,0)
 I RESULT(1)<3 D
"RTN","RGEX03",123,0)
 .I RESULT(1)=1 D NOTICE^DGSEC4(.RGSEN,DFN,"RG EXCEPTION HANDLING^MPI/PD Exception Handling",2)
"RTN","RGEX03",124,0)
 .I RESULT(1)=2 D NOTICE^DGSEC4(.RGSEN,DFN,"RG EXCEPTION HANDLING^MPI/PD Exception Handling",3)
"RTN","RGEX03",125,0)
 D EDIT
"RTN","RGEX03",126,0)
 Q
"RTN","RGEX03",127,0)
EDIT ; edit patient data
"RTN","RGEX03",128,0)
 S ACCESS=0
"RTN","RGEX03",129,0)
 D REC
"RTN","RGEX03",130,0)
 Q:ACCESS=0
"RTN","RGEX03",131,0)
 S DIE="^DPT(",DA=DFN,DR=".01///^S X=$$NCEDIT^DPTNAME(DA);.03//^S X=DOB;.09//^S X=SSN"
"RTN","RGEX03",132,0)
 L +^DPT(DFN):10 D ^DIE K DIE,DA,DR L -^DPT(DFN)
"RTN","RGEX03",133,0)
 S DATAOLD=DATA
"RTN","RGEX03",134,0)
 D DEATH
"RTN","RGEX03",135,0)
 D DEM^VADPT
"RTN","RGEX03",136,0)
 S DATA=VADM(1)_"^"_$P($G(VADM(2)),"^",1)_"^"_$P(DATAOLD,"^",3)_"^"_$P(DATAOLD,"^",4)_"^"_DFN_"^"_$P(DATAOLD,"^",6)_"^"
"RTN","RGEX03",137,0)
 S DATA=DATA_$G(VADM(3))_"^"_$P(DATAOLD,"^",9)_"^"_$P(DATAOLD,"^",10)_"^"_$P(DATAOLD,"^",11)_"^"_$P(DATAOLD,"^",12)_"^"_$P($G(VADM(6)),"^",2)
"RTN","RGEX03",138,0)
 D INIT
"RTN","RGEX03",139,0)
 S VALMBCK="R"
"RTN","RGEX03",140,0)
 K DGNEW,DATAOLD,VAEL,ACCESS,DGNPSSN
"RTN","RGEX03",141,0)
QUIT Q
"RTN","RGEX03",142,0)
REC ; Check if user is attempting to access own record
"RTN","RGEX03",143,0)
 ; check for security key
"RTN","RGEX03",144,0)
 I $D(^XUSEC("DG RECORD ACCESS",+DUZ)) S ACCESS=1 Q
"RTN","RGEX03",145,0)
 S DGNPSSN=$$GET1^DIQ(200,+DUZ_",",9,"I","","DGNPERR")
"RTN","RGEX03",146,0)
 I 'DGNPSSN D  Q
"RTN","RGEX03",147,0)
 .W !!,"Your SSN is missing from the NEW PERSON file.",!,"Contact your ADP Coordinator."
"RTN","RGEX03",148,0)
 .D PAUSE^VALM1 S VALMBCK="R"
"RTN","RGEX03",149,0)
 I DGNPSSN=SSN D  Q
"RTN","RGEX03",150,0)
 .W !!,"Security regulations prohibit computer access to your",!,"own medical record."
"RTN","RGEX03",151,0)
 .D PAUSE^VALM1 S VALMBCK="R"
"RTN","RGEX03",152,0)
 E  S ACCESS=1
"RTN","RGEX03",153,0)
 Q
"RTN","RGEX03",154,0)
DEATH ; Check for access to edit date of death
"RTN","RGEX03",155,0)
 I $D(^XUSEC("DG DETAIL",+DUZ)) D
"RTN","RGEX03",156,0)
 .K VADM,DIE,DA,DR
"RTN","RGEX03",157,0)
 .S (DOD1,DOD2,SRS)=""
"RTN","RGEX03",158,0)
 .D DEM^VADPT
"RTN","RGEX03",159,0)
 .S DOD1=$P($G(VADM(6)),"^",2) ;DOD original value
"RTN","RGEX03",160,0)
 .S DIC="2",DA=DFN,DR=".353",DIQ(0)="E" D EN^DIQ1 ;**54
"RTN","RGEX03",161,0)
 .S SRS=$G(^UTILITY("DIQ1",$J,2,DA,.353,"E")) ;source of notification original value
"RTN","RGEX03",162,0)
 .S DIE="^DPT(",DA=DFN,DR=".351//^S X=DOD1" D DIEC ;ask DOD, prompt with original value
"RTN","RGEX03",163,0)
 .;was a change made to DOD?
"RTN","RGEX03",164,0)
 .D DEM^VADPT
"RTN","RGEX03",165,0)
 .S DOD2=$P($G(VADM(6)),"^",2) D  ;DOD value after DIE call
"RTN","RGEX03",166,0)
 ..I DOD1="",DOD2="" Q  ;original and added DOD both null; don't prompt for .353
"RTN","RGEX03",167,0)
 ..I DOD1'="",DOD2="" S DIE="^DPT(",DA=DFN,DR=".353////@" D DIEC Q  ;DOD now null - deleted; remove source field
"RTN","RGEX03",168,0)
 ..;Else DOD added or changed; so prompt for source
"RTN","RGEX03",169,0)
 ..I (DOD1=""&DOD2'="")!(DOD1'=DOD2) D
"RTN","RGEX03",170,0)
 ...S DIE="^DPT(",DA=DFN,DR=".353//^S X=SRS" D DIEC Q
"RTN","RGEX03",171,0)
 E  W !!,"You do not have the proper security to edit date of death." D PAUSE^VALM1 D INIT S VALMBCK="R"
"RTN","RGEX03",172,0)
 K VADM,DIE,DA,DR,DOD1,DOD2,SRS,X,Y
"RTN","RGEX03",173,0)
 Q
"RTN","RGEX03",174,0)
 ;
"RTN","RGEX03",175,0)
DIEC ;Do the ^DIE call from the DEATH module
"RTN","RGEX03",176,0)
 L +^DPT(DFN):10
"RTN","RGEX03",177,0)
 D ^DIE
"RTN","RGEX03",178,0)
 L -^DPT(DFN)
"RTN","RGEX03",179,0)
 Q
"RTN","RGEX03",180,0)
 ;
"RTN","RGEX03",181,0)
INQ ; Patient Inquiry
"RTN","RGEX03",182,0)
 S VALMBCK=""
"RTN","RGEX03",183,0)
 D FULL^VALM1 D EN^DGRPD D PAUSE^VALM1 D CLEAN^VALM10 D INIT
"RTN","RGEX03",184,0)
 S VALMBCK="R"
"RTN","RGEX03",185,0)
 Q
"RTN","RGEX03",186,0)
EDTNOT ; Edit Exception Notes
"RTN","RGEX03",187,0)
 S IEN=$P(DATA,"^",10),IEN2=$P(DATA,"^",11)
"RTN","RGEX03",188,0)
 L +^RGHL7(991.1,IEN):10 S DIE="^RGHL7(991.1,"_IEN_",1,",DA(1)=IEN,DA=IEN2,DR="11" D ^DIE L -^RGHL7(991.1,IEN)
"RTN","RGEX03",189,0)
 K DIE,DA,DR,IEN,IEN2
"RTN","RGEX03",190,0)
 D INIT
"RTN","RGEX03",191,0)
 S VALMBCK="R"
"RTN","RGEX03",192,0)
 Q
"RTN","RGEX03",193,0)
PDAT S VALMBCK="",PICN="",PSSN=""
"RTN","RGEX03",194,0)
 I $D(SSN) S PSSN=SSN
"RTN","RGEX03",195,0)
 S ARRAY="^TMP(""RGXHFS"","_$J_")",TYPE="I",REP=1,RGXDIR=$$GET^XPAR("SYS","RGX HFS SCRATCH"),RGXFILE="RGX"_DUZ_".DAT"
"RTN","RGEX03",196,0)
 S IOM=132,IOSL=99999,IOST="P-DUMMY",IOF=""""""
"RTN","RGEX03",197,0)
 D OPEN^%ZISH("RGX",RGXDIR,RGXFILE,"W") Q:POP
"RTN","RGEX03",198,0)
 U IO
"RTN","RGEX03",199,0)
 I ICN'="" S PICN=ICN D START^VAFCPDAT
"RTN","RGEX03",200,0)
 N RGXDEL
"RTN","RGEX03",201,0)
 D CLOSE^%ZISH("RGX")
"RTN","RGEX03",202,0)
 K ^TMP("RGPDAT",$J)
"RTN","RGEX03",203,0)
 S RGXDEL(RGXFILE)="",X=$$FTG^%ZISH(RGXDIR,RGXFILE,$NAME(^TMP("RGPDAT",$J,1)),3),X=$$DEL^%ZISH(RGXDIR,$NA(RGXDEL))
"RTN","RGEX03",204,0)
 I $D(^TMP("RGPDAT",$J)) D EN^RGEX04
"RTN","RGEX03",205,0)
 S ICN=PICN,SSN=PSSN
"RTN","RGEX03",206,0)
 D INIT
"RTN","RGEX03",207,0)
 S VALMBCK="R" K PICN,PSSN,ARRAY,REP,RGXDIR,RGXFILE,TYPE
"RTN","RGEX03",208,0)
 Q
"RTN","RGEX03",209,0)
GETEX(RETURN,DFN) ; Get array of pending exceptions for a patient
"RTN","RGEX03",210,0)
 K RETURN
"RTN","RGEX03",211,0)
 S CNT=0,RETURN(0)="0^No Pending Exceptions",TYP=""
"RTN","RGEX03",212,0)
 I 'DFN S RETURN(0)="-1^DFN not passed" G QGET
"RTN","RGEX03",213,0)
 F  S TYP=$O(^RGHL7(991.1,"ADFN",TYP)) Q:'TYP  D
"RTN","RGEX03",214,0)
 .I $D(^RGHL7(991.1,"ADFN",TYP,DFN)) D
"RTN","RGEX03",215,0)
 ..S IEN="" F  S IEN=$O(^RGHL7(991.1,"ADFN",TYP,DFN,IEN)) Q:'IEN  D
"RTN","RGEX03",216,0)
 ...S IEN2="",ETYP="" F  S IEN2=$O(^RGHL7(991.1,"ADFN",TYP,DFN,IEN,IEN2)) Q:'IEN2  D
"RTN","RGEX03",217,0)
 ....I $P(^RGHL7(991.1,IEN,1,IEN2,0),"^",5)<1 D
"RTN","RGEX03",218,0)
 .....S CNT=CNT+1,ETYP=$P(^RGHL7(991.11,TYP,10),"^",1)
"RTN","RGEX03",219,0)
 .....S RETURN(CNT)=ETYP_"^"_IEN_"^"_IEN2
"RTN","RGEX03",220,0)
 I CNT>0 S RETURN(0)=CNT_"^Pending Exception(s)"
"RTN","RGEX03",221,0)
QGET ;
"RTN","RGEX03",222,0)
 K TYP,ETYP,IEN,IEN2,CNT
"RTN","RGEX03",223,0)
 Q
"RTN","RGEX03",224,0)
HELP ; -- help code
"RTN","RGEX03",225,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","RGEX03",226,0)
 Q
"RTN","RGEX03",227,0)
EXIT ; -- exit code
"RTN","RGEX03",228,0)
 S VALMBCK="" K ^TMP("RGEXC2",$J),CHKSM,DFN,DIR,EXCTEXT,IEN,IEN2,NAME,DOB,SSN,LIN,STATUS,STR,VAFCDFN,X,Y
"RTN","RGEX03",229,0)
 S VALMBCK="R",RGBG=1
"RTN","RGEX03",230,0)
 Q
"RTN","RGEX03",231,0)
EXPND ; -- expand code
"RTN","RGEX03",232,0)
 Q
"RTN","RGEXHND1")
0^2^B37400054^B37317689
"RTN","RGEXHND1",1,0)
RGEXHND1 ;BAY/ALS-MPI/PD EXCEPTION HANDLING UTILITY ;10/08/99
"RTN","RGEXHND1",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**3,12,19,23,43,45,52,57**;30 Apr 99;Build 2
"RTN","RGEXHND1",3,0)
DTLIST ;List exceptions by date
"RTN","RGEXHND1",4,0)
 K ^TMP("RGEXC",$J)
"RTN","RGEXHND1",5,0)
 I '$D(RGBG) S VALMBG=1
"RTN","RGEXHND1",6,0)
 ;**45 list exception 234 first regardless of date - Primary View Reject
"RTN","RGEXHND1",7,0)
 S EXCDT="",EXCTYP=234,(CNT,IEN)=0
"RTN","RGEXHND1",8,0)
 F  S IEN=$O(^RGHL7(991.1,"ASTAT","0",EXCTYP,IEN)) Q:'IEN  D
"RTN","RGEXHND1",9,0)
 .S IEN2=0
"RTN","RGEXHND1",10,0)
 .F  S IEN2=$O(^RGHL7(991.1,"ASTAT","0",EXCTYP,IEN,IEN2)) Q:'IEN2  D
"RTN","RGEXHND1",11,0)
 ..S EXCDT=$P(^RGHL7(991.1,IEN,0),"^",3)
"RTN","RGEXHND1",12,0)
 ..D ADDREC
"RTN","RGEXHND1",13,0)
 ;**57 MPIC_1893 Only exception type 234 remains, rest are obsolete
"RTN","RGEXHND1",14,0)
 ;S EXCDT="",EXCTYP=""
"RTN","RGEXHND1",15,0)
 ;F  S EXCDT=$O(^RGHL7(991.1,"AD",EXCDT)) Q:'EXCDT  D
"RTN","RGEXHND1",16,0)
 ;. S IEN=0
"RTN","RGEXHND1",17,0)
 ;. F  S IEN=$O(^RGHL7(991.1,"AD",EXCDT,IEN)) Q:'IEN  D
"RTN","RGEXHND1",18,0)
 ;.. S NUM="" S NUM=$P($G(^RGHL7(991.1,IEN,1,0)),"^",4) Q:NUM<1  D
"RTN","RGEXHND1",19,0)
 ;... S IEN2=0
"RTN","RGEXHND1",20,0)
 ;... F  S IEN2=$O(^RGHL7(991.1,IEN,1,IEN2)) Q:'IEN2  D
"RTN","RGEXHND1",21,0)
 ;.... S EXCTYP=$P(^RGHL7(991.1,IEN,1,IEN2,0),"^",3)
"RTN","RGEXHND1",22,0)
 ;....;don't include 234 below; those were done first (above).
"RTN","RGEXHND1",23,0)
 ;.... I EXCTYP=218 D ADDREC  ;**45;**52 MPIC_772 remove 215, 216 & 217
"RTN","RGEXHND1",24,0)
 K I,NUM,EXCDT,EXCTYP,RGBG
"RTN","RGEXHND1",25,0)
 IF CNT<1 D NDATA
"RTN","RGEXHND1",26,0)
 Q
"RTN","RGEXHND1",27,0)
 ;
"RTN","RGEXHND1",28,0)
NDATA ; There is no data matching the criteria
"RTN","RGEXHND1",29,0)
 S CNT=CNT+1,STRING=""
"RTN","RGEXHND1",30,0)
 S STRING=$$SETSTR^VALM1("There were no exceptions found.",STRING,5,35)
"RTN","RGEXHND1",31,0)
 S ^TMP("RGEXC",$J,CNT,0)=STRING
"RTN","RGEXHND1",32,0)
 S ^TMP("RGEXC",$J,"IDX",CNT,CNT)=""
"RTN","RGEXHND1",33,0)
 S VALMCNT=CNT
"RTN","RGEXHND1",34,0)
 Q
"RTN","RGEXHND1",35,0)
EXCLST ;List exceptions by type
"RTN","RGEXHND1",36,0)
 K ^TMP("RGEXC",$J)
"RTN","RGEXHND1",37,0)
 S CNT=0,EXCDT="",EXCTYP=""
"RTN","RGEXHND1",38,0)
 I '$D(RGBG) S VALMBG=1
"RTN","RGEXHND1",39,0)
 F  S EXCTYP=$O(^RGHL7(991.1,"AC",EXCTYP)) Q:'EXCTYP  D
"RTN","RGEXHND1",40,0)
 . I EXCTYP=234 D  ;**45;**52 MPIC_772 remove 215, 216 & 217;**57 MPIC_1893 remove 218
"RTN","RGEXHND1",41,0)
 .. S IEN=0
"RTN","RGEXHND1",42,0)
 .. F  S IEN=$O(^RGHL7(991.1,"AC",EXCTYP,IEN)) Q:'IEN  D
"RTN","RGEXHND1",43,0)
 ... S NUM="" S NUM=$P($G(^RGHL7(991.1,IEN,1,0)),"^",4) Q:NUM<1  D
"RTN","RGEXHND1",44,0)
 .... S IEN2=0
"RTN","RGEXHND1",45,0)
 .... F  S IEN2=$O(^RGHL7(991.1,"AC",EXCTYP,IEN,IEN2)) Q:'IEN2  D
"RTN","RGEXHND1",46,0)
 ..... S EXCDT=$P($G(^RGHL7(991.1,IEN,0)),"^",3) Q:'EXCDT
"RTN","RGEXHND1",47,0)
 ..... D ADDREC
"RTN","RGEXHND1",48,0)
 IF CNT<1 D NDATA
"RTN","RGEXHND1",49,0)
 K RGBG
"RTN","RGEXHND1",50,0)
 Q
"RTN","RGEXHND1",51,0)
PATLST ;List exceptions by patient
"RTN","RGEXHND1",52,0)
 K ^TMP("RGEXC",$J),^TMP("RGEX01",$J)
"RTN","RGEXHND1",53,0)
 S CNT=0,EXCDT="",EXCTYP="",NDX=0,NAME=""
"RTN","RGEXHND1",54,0)
 I '$D(RGBG) S VALMBG=1
"RTN","RGEXHND1",55,0)
 F  S EXCTYP=$O(^RGHL7(991.1,"ADFN",EXCTYP)) Q:'EXCTYP  D
"RTN","RGEXHND1",56,0)
 . I EXCTYP=234 D  ;**45;**52 MPIC_772 remove 215, 216 & 217;**57 MPIC_1893 remove 218
"RTN","RGEXHND1",57,0)
 .. S DFN=""
"RTN","RGEXHND1",58,0)
 .. F  S DFN=$O(^RGHL7(991.1,"ADFN",EXCTYP,DFN)) Q:'DFN  D
"RTN","RGEXHND1",59,0)
 ... S IEN=0
"RTN","RGEXHND1",60,0)
 ... F  S IEN=$O(^RGHL7(991.1,"ADFN",EXCTYP,DFN,IEN)) Q:'IEN  D
"RTN","RGEXHND1",61,0)
 .... S IEN2=0
"RTN","RGEXHND1",62,0)
 .... F  S IEN2=$O(^RGHL7(991.1,"ADFN",EXCTYP,DFN,IEN,IEN2)) Q:'IEN2  D
"RTN","RGEXHND1",63,0)
 ..... S EXCDT=$P($G(^RGHL7(991.1,IEN,0)),"^",3) Q:'EXCDT
"RTN","RGEXHND1",64,0)
 ..... D DEM^VADPT S NAME=VADM(1) Q:NAME=""
"RTN","RGEXHND1",65,0)
 ..... S NDX=NDX+1
"RTN","RGEXHND1",66,0)
 ..... S ^TMP("RGEX01",$J,NAME,NDX)=$G(VADM(1))_"^"_IEN_"^"_IEN2_"^"_EXCTYP_"^"_EXCDT
"RTN","RGEXHND1",67,0)
 D PATTMP
"RTN","RGEXHND1",68,0)
 IF CNT<1 D NDATA
"RTN","RGEXHND1",69,0)
 K DFN,RGBG
"RTN","RGEXHND1",70,0)
 Q
"RTN","RGEXHND1",71,0)
PATTMP ;
"RTN","RGEXHND1",72,0)
 S NM=""
"RTN","RGEXHND1",73,0)
 F  S NM=$O(^TMP("RGEX01",$J,NM)) Q:NM=""  D
"RTN","RGEXHND1",74,0)
 . S NDX=0
"RTN","RGEXHND1",75,0)
 . F  S NDX=$O(^TMP("RGEX01",$J,NM,NDX)) Q:'NDX  D
"RTN","RGEXHND1",76,0)
 .. S IEN=$P(^TMP("RGEX01",$J,NM,NDX),"^",2)
"RTN","RGEXHND1",77,0)
 .. S IEN2=$P(^TMP("RGEX01",$J,NM,NDX),"^",3)
"RTN","RGEXHND1",78,0)
 .. S EXCTYP=$P(^TMP("RGEX01",$J,NM,NDX),"^",4)
"RTN","RGEXHND1",79,0)
 .. S EXCDT=$P(^TMP("RGEX01",$J,NM,NDX),"^",5)
"RTN","RGEXHND1",80,0)
 .. D ADDREC
"RTN","RGEXHND1",81,0)
 K NDX,NM,NAME
"RTN","RGEXHND1",82,0)
 Q
"RTN","RGEXHND1",83,0)
SELTYP ; List all exceptions of type selected by user
"RTN","RGEXHND1",84,0)
 S EXCTYPE="",FLAG=0,ETYPE=""
"RTN","RGEXHND1",85,0)
 I '$D(RGBG) S VALMBG=1
"RTN","RGEXHND1",86,0)
 K DIR,Y,DIC
"RTN","RGEXHND1",87,0)
 S DIR("A")="Enter an exception type to view: ",DIR("B")=234 ;**57 MPIC_1893 Only exception type 234 remains, rest are obsolete
"RTN","RGEXHND1",88,0)
 S DIR(0)="SAM^234:Primary View Reject" ;**43;**45;**52 MPIC_772 remove 215, 216 & 217 ;**57 MPIC_1893 remove 218
"RTN","RGEXHND1",89,0)
 S DIR("?")="^D HLPSEL^RGEXHND1"
"RTN","RGEXHND1",90,0)
 D ^DIR
"RTN","RGEXHND1",91,0)
 I Y<1 S RGSORT="SD" D SORT^RGEX01  Q
"RTN","RGEXHND1",92,0)
 Q:$D(DUOUT)!$D(DTOUT)
"RTN","RGEXHND1",93,0)
 S EXCTYPE=+Y,ETYPE=$P(^RGHL7(991.11,EXCTYPE,10),"^",1)
"RTN","RGEXHND1",94,0)
 I EXCTYPE=234 S FLAG=1 ;**43;**45;**52 MPIC_772 remove 215, 216 & 217 ;**57 MPIC_1893 remove 218
"RTN","RGEXHND1",95,0)
 I FLAG=1 D ADDSEL
"RTN","RGEXHND1",96,0)
 E  I FLAG=0 D
"RTN","RGEXHND1",97,0)
 . W !,"Not a valid selection."
"RTN","RGEXHND1",98,0)
 . D SELTYP
"RTN","RGEXHND1",99,0)
 K FLAG,Y,DIR,DIC,DTOUT,DUOUT,RGBG
"RTN","RGEXHND1",100,0)
 Q
"RTN","RGEXHND1",101,0)
ADDSEL ;called by SELTYP
"RTN","RGEXHND1",102,0)
 K ^TMP("RGEXC",$J)
"RTN","RGEXHND1",103,0)
 S CNT=0,EXCDT="",EXCTYP=""
"RTN","RGEXHND1",104,0)
 F  S EXCTYP=$O(^RGHL7(991.1,"AC",EXCTYP)) Q:'EXCTYP  D
"RTN","RGEXHND1",105,0)
 . I EXCTYP=EXCTYPE D
"RTN","RGEXHND1",106,0)
 .. S IEN=0
"RTN","RGEXHND1",107,0)
 .. F  S IEN=$O(^RGHL7(991.1,"AC",EXCTYP,IEN)) Q:'IEN  D
"RTN","RGEXHND1",108,0)
 ... S IEN2=0
"RTN","RGEXHND1",109,0)
 ... F  S IEN2=$O(^RGHL7(991.1,"AC",EXCTYP,IEN,IEN2)) Q:'IEN2  D
"RTN","RGEXHND1",110,0)
 .... S EXCDT=$P($G(^RGHL7(991.1,IEN,0)),"^",3) Q:'EXCDT  ;**43
"RTN","RGEXHND1",111,0)
 .... D ADDREC
"RTN","RGEXHND1",112,0)
 I CNT<1 D
"RTN","RGEXHND1",113,0)
 . W !,"There are no "_ETYPE
"RTN","RGEXHND1",114,0)
 . W !,"exceptions that need processing."
"RTN","RGEXHND1",115,0)
 . D SELTYP
"RTN","RGEXHND1",116,0)
 Q
"RTN","RGEXHND1",117,0)
HLPSEL ;
"RTN","RGEXHND1",118,0)
 D FULL^VALM1
"RTN","RGEXHND1",119,0)
 ;W !,"The following exception types are handled by this option:"
"RTN","RGEXHND1",120,0)
 ;W !,"Primary View Reject",?50,"(234)"
"RTN","RGEXHND1",121,0)
 S VALMBCK="R"
"RTN","RGEXHND1",122,0)
 Q
"RTN","RGEXHND1",123,0)
ADDREC ;
"RTN","RGEXHND1",124,0)
 S ETEXT="",RGDFN="",ICN="",RGNM="",STAT="",DOD=""
"RTN","RGEXHND1",125,0)
 S ETEXT=$P($G(^RGHL7(991.11,EXCTYP,10)),"^",1)
"RTN","RGEXHND1",126,0)
 S RGDFN=$P(^RGHL7(991.1,IEN,1,IEN2,0),"^",4) Q:'RGDFN
"RTN","RGEXHND1",127,0)
 S STAT=$P($G(^RGHL7(991.1,IEN,1,IEN2,0)),"^",5)
"RTN","RGEXHND1",128,0)
 S ICN=+$$GETICN^MPIF001(RGDFN)
"RTN","RGEXHND1",129,0)
 S HOME=$$SITE^VASITE()
"RTN","RGEXHND1",130,0)
 I (STAT<1)!(STAT="") D
"RTN","RGEXHND1",131,0)
 .;Only list exceptions that are Not Processed
"RTN","RGEXHND1",132,0)
 .; only list patients with local ICN, or for exception 234 ;**52 MPIC_772 remove 215, 216 & 217;**57 MPIC_1893 remove 218
"RTN","RGEXHND1",133,0)
 . I $E(ICN,1,3)=$E($P(HOME,"^",3),1,3)!(ICN<0)!(EXCTYP=234) D  ;**43,**45,**52,**57
"RTN","RGEXHND1",134,0)
 .. S DFN=RGDFN D DEM^VADPT
"RTN","RGEXHND1",135,0)
 .. S RGNM=VADM(1)
"RTN","RGEXHND1",136,0)
 .. S RGSSN=$P($G(VADM(2)),"^",1)
"RTN","RGEXHND1",137,0)
 .. S DOB=$G(VADM(3)) I DOB="" S DOB="^"
"RTN","RGEXHND1",138,0)
 .. S DOD=$P($P($G(VADM(6)),"^",2),"@",1)
"RTN","RGEXHND1",139,0)
 .. S EXDATE=$P($$FMTE^XLFDT(EXCDT,2),"@",1)
"RTN","RGEXHND1",140,0)
 .. S CNT=CNT+1
"RTN","RGEXHND1",141,0)
 .. S STRING=""
"RTN","RGEXHND1",142,0)
 .. I ICN<0 S ICN=""
"RTN","RGEXHND1",143,0)
 .. S STRING=$$SETSTR^VALM1(CNT,STRING,1,4)
"RTN","RGEXHND1",144,0)
 .. S STRING=$$SETSTR^VALM1($E(RGNM,1,22),STRING,6,21)
"RTN","RGEXHND1",145,0)
 .. S STRING=$$SETSTR^VALM1(RGSSN,STRING,28,10)
"RTN","RGEXHND1",146,0)
 .. S STRING=$$SETSTR^VALM1(EXDATE,STRING,39,8)
"RTN","RGEXHND1",147,0)
 .. S STRING=$$SETSTR^VALM1(ETEXT,STRING,49,32)
"RTN","RGEXHND1",148,0)
 .. S ^TMP("RGEXC",$J,CNT,0)=STRING
"RTN","RGEXHND1",149,0)
 .. S ^TMP("RGEXC",$J,"IDX",CNT,CNT)=""
"RTN","RGEXHND1",150,0)
 .. S ^TMP("RGEXC",$J,CNT,"DATA")=RGNM_"^"_RGSSN_"^"_$P($$FMTE^XLFDT(EXCDT),"@",1)_"^"_ETEXT_"^"_DFN_"^"_ICN_"^"_DOB_"^"_STAT_"^"_IEN_"^"_IEN2_"^"_CNT_"^"_DOD
"RTN","RGEXHND1",151,0)
 S VALMCNT=CNT
"RTN","RGEXHND1",152,0)
 K RGDFN,RGNM,RGSSN,EXDATE,ETEXT,ICN,DOB,STAT,VADM,HOME,STRING,DOD
"RTN","RGEXHND1",153,0)
 Q
"RTN","RGEXHND1",154,0)
SELECT ;
"RTN","RGEXHND1",155,0)
 I $G(STRING)["no exceptions found" D SORT^RGEX01  Q
"RTN","RGEXHND1",156,0)
 N VALMY
"RTN","RGEXHND1",157,0)
 D EN^VALM2(XQORNOD(0),"OS")
"RTN","RGEXHND1",158,0)
 I '$D(VALMY) Q
"RTN","RGEXHND1",159,0)
 S VALMCNT=CNT
"RTN","RGEXHND1",160,0)
 S DATA="",CNT=""
"RTN","RGEXHND1",161,0)
 S CNT=$O(VALMY(0))
"RTN","RGEXHND1",162,0)
 S DATA=$G(^TMP("RGEXC",$J,CNT,"DATA"))
"RTN","RGEXHND1",163,0)
 I '$D(DATA) S CNT=0 Q
"RTN","RGEXHND1",164,0)
 D CLEAN^VALM10
"RTN","RGEXHND1",165,0)
 D EN^RGEX03(DATA)
"RTN","RGEXHND1",166,0)
 I RGSORT="VT" D
"RTN","RGEXHND1",167,0)
 . K @VALMAR
"RTN","RGEXHND1",168,0)
 . D ADDSEL
"RTN","RGEXHND1",169,0)
 E  I RGSORT'="VT" D SORT^RGEX01
"RTN","RGEXHND1",170,0)
 ;
"RTN","RGEXHND1",171,0)
 Q
"RTN","RGEXHND1",172,0)
QUIT ;
"RTN","RGHLLOG")
0^3^B24264633^B23997530
"RTN","RGHLLOG",1,0)
RGHLLOG ;CAIRO/DKM-LOG MESSAGE PROCESSING INFO ;09/04/98
"RTN","RGHLLOG",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**1,3,11,13,18,19,25,45,52,57**;30 Apr 99;Build 2
"RTN","RGHLLOG",3,0)
 ;
"RTN","RGHLLOG",4,0)
 ;Reference to ^HLMA("C" supported by IA #3244
"RTN","RGHLLOG",5,0)
 ;=================================================================
"RTN","RGHLLOG",6,0)
 ; Log information about message processing and exceptions
"RTN","RGHLLOG",7,0)
 ; in CIRN HL7 Exception Log file.
"RTN","RGHLLOG",8,0)
 ;=================================================================
"RTN","RGHLLOG",9,0)
 ; Start time for run log
"RTN","RGHLLOG",10,0)
START(RGMSG,RGDC,RGPARAM) ;
"RTN","RGHLLOG",11,0)
 ;This entry point starts the log process in the CIRN HL7 EXCEPTION LOG
"RTN","RGHLLOG",12,0)
 ;file (#991.1), if the (#6) MINIMAL EXCEPTION LOGGING? field in
"RTN","RGHLLOG",13,0)
 ;File #990.8 is set to 0.
"RTN","RGHLLOG",14,0)
 ; Input: Required
"RTN","RGHLLOG",15,0)
 ;   RGMSG - IEN of message entry in File #773, usually HLMTIEN
"RTN","RGHLLOG",16,0)
 ;        Optional
"RTN","RGHLLOG",17,0)
 ;   RGDC - Event Class, associated with an entry in File #
"RTN","RGHLLOG",18,0)
 ;   RGPARAM - reprocessing routine
"RTN","RGHLLOG",19,0)
 S U="^"
"RTN","RGHLLOG",20,0)
 K RGLOG
"RTN","RGHLLOG",21,0)
 S RGLOG(3)=$G(RGMSG),RGLOG(5)=$G(RGDC),RGLOG(4)=$G(RGPARAM),RGLOG(1)=$$NOW^XLFDT
"RTN","RGHLLOG",22,0)
 I '$P(^RGSITE("COR",1,0),U,8) S RGLOG=$$CREATE
"RTN","RGHLLOG",23,0)
 Q
"RTN","RGHLLOG",24,0)
 ; Create a log entry
"RTN","RGHLLOG",25,0)
CREATE() Q:$G(RGLOG) RGLOG
"RTN","RGHLLOG",26,0)
 L +^RGHL7(991.1,0):10
"RTN","RGHLLOG",27,0)
 S RGLOG=$O(^RGHL7(991.1,$C(32)),-1)+1
"RTN","RGHLLOG",28,0)
 S:$G(RGLOG(1))="" RGLOG(1)=$$NOW^XLFDT
"RTN","RGHLLOG",29,0)
 S RGLOG(3)=$S($G(RGLOG(3))=0:0,$G(HL("MID"))="":"",1:$$IEN773($G(HL("MID"))))
"RTN","RGHLLOG",30,0)
 S (DA,X)=RGLOG,DIC="^RGHL7(991.1,",DIC(0)="L",DLAYGO=991.1,DIC("DR")="1///"_$G(RGLOG(1))_";3////"_$G(RGLOG(3))_";5///"_$G(RGLOG(5))_";4////"_$G(RGLOG(4)) K DD,DO D FILE^DICN K DIC,DA,X,DLAYGO
"RTN","RGHLLOG",31,0)
 L -^RGHL7(991.1,0)
"RTN","RGHLLOG",32,0)
 Q RGLOG
"RTN","RGHLLOG",33,0)
 ; Log time run completed
"RTN","RGHLLOG",34,0)
STOP(RGQUIT) ;
"RTN","RGHLLOG",35,0)
 ;This entry point completes the logging process
"RTN","RGHLLOG",36,0)
 ; Input: required
"RTN","RGHLLOG",37,0)
 ;    RGQUIT - 0 for success and 1 for failure
"RTN","RGHLLOG",38,0)
 ;
"RTN","RGHLLOG",39,0)
 Q:'$G(RGLOG)
"RTN","RGHLLOG",40,0)
 L +^RGHL7(991.1,RGLOG):10
"RTN","RGHLLOG",41,0)
 S DIE="^RGHL7(991.1,",DR="1.5///NOW;1.6///^S X=$G(RGQUIT)",DA=RGLOG D ^DIE K DIE,DA,DR
"RTN","RGHLLOG",42,0)
 L -^RGHL7(991.1,RGLOG)
"RTN","RGHLLOG",43,0)
 K RGLOG,RGQUIT,X,Y,DIC,DIE
"RTN","RGHLLOG",44,0)
 Q
"RTN","RGHLLOG",45,0)
 ; Log unclassified exception (old entry point)
"RTN","RGHLLOG",46,0)
ERR(RGERR,RGSEV) ;
"RTN","RGHLLOG",47,0)
 D EXC(18,RGERR)
"RTN","RGHLLOG",48,0)
 S RGQUIT=$G(RGQUIT)!$G(RGSEV)
"RTN","RGHLLOG",49,0)
 Q
"RTN","RGHLLOG",50,0)
 ; Log an exception
"RTN","RGHLLOG",51,0)
EXC(RGEXC,RGERR,RGDFN,MSGID,STATNUM) ;
"RTN","RGHLLOG",52,0)
 ;This entry point logs exceptions in the CIRN HL7 EXCEPTION LOG
"RTN","RGHLLOG",53,0)
 ;file (#991.1)
"RTN","RGHLLOG",54,0)
 ; Input: Required
"RTN","RGHLLOG",55,0)
 ;   RGEXC - Exception type in File #991.11
"RTN","RGHLLOG",56,0)
 ;   RGERR - Supplemental text
"RTN","RGHLLOG",57,0)
 ;        Optional
"RTN","RGHLLOG",58,0)
 ;   RGDFN - IEN in the PATIENT file (#2)
"RTN","RGHLLOG",59,0)
 ;   MSGID - message id of the HL7 message where the exception was encountered (optional)
"RTN","RGHLLOG",60,0)
 ;   STATNUM - station # of site that encountered the error (optional) - if not defined then the local site is assumed, using $$SITE^VASITE
"RTN","RGHLLOG",61,0)
 ;
"RTN","RGHLLOG",62,0)
 I (RGEXC=215)!(RGEXC=216)!(RGEXC=217) Q  ;**52 until MPIFBT3 call eliminates these exception types
"RTN","RGHLLOG",63,0)
 ;I (RGEXC=215)!(RGEXC=216)!(RGEXC=217) Q  ;**52 until MPIFBT3 call eliminates these exception types;**57 done in MPIF*1*52
"RTN","RGHLLOG",64,0)
 I $L($G(HL("MID"))) Q:$$INVEXC(HL("MID"))  ; is the exception valid?
"RTN","RGHLLOG",65,0)
 N RGI,RGZ
"RTN","RGHLLOG",66,0)
 S U="^"
"RTN","RGHLLOG",67,0)
 S:RGEXC[U RGERR=$P(RGEXC,U,2,999),RGEXC=+RGEXC
"RTN","RGHLLOG",68,0)
 S:RGEXC'=+RGEXC RGERR=RGEXC,RGEXC=18
"RTN","RGHLLOG",69,0)
 S:'$D(^RGHL7(991.11,RGEXC)) RGEXC=18
"RTN","RGHLLOG",70,0)
 L +^RGHL7(991.11,RGEXC):10
"RTN","RGHLLOG",71,0)
 S RGZ=$G(^RGHL7(991.11,RGEXC,0))
"RTN","RGHLLOG",72,0)
 S:$L(RGZ) $P(^RGHL7(991.11,RGEXC,0),U,5)=$P(RGZ,U,5)+1
"RTN","RGHLLOG",73,0)
 S:$P(RGZ,U,2)>1 RGQUIT=1
"RTN","RGHLLOG",74,0)
 L -^RGHL7(991.11,RGEXC)
"RTN","RGHLLOG",75,0)
 S RGLOG=$$CREATE
"RTN","RGHLLOG",76,0)
 L +^RGHL7(991.1,RGLOG):10
"RTN","RGHLLOG",77,0)
 S RGI=$O(^RGHL7(991.1,RGLOG,1,$C(32)),-1)+1
"RTN","RGHLLOG",78,0)
 S RGERR=$E($G(RGERR),1,250)
"RTN","RGHLLOG",79,0)
 S DIC="^RGHL7(991.1,"_RGLOG_",1,"
"RTN","RGHLLOG",80,0)
 S X=RGI,DA(1)=RGLOG,DIC(0)="FL",DLAYGO=991.12,DIC("P")=$P(^DD(991.1,2,0),"^",2)
"RTN","RGHLLOG",81,0)
 D ^DIC
"RTN","RGHLLOG",82,0)
 S DIE=DIC
"RTN","RGHLLOG",83,0)
 K DIC,DA,DR,DLAYGO
"RTN","RGHLLOG",84,0)
 S STAT=0
"RTN","RGHLLOG",85,0)
 S DIC="3.8",DIC(0)="Z",X="MPIF EXCEPTIONS" D ^DIC K DIC
"RTN","RGHLLOG",86,0)
 S RGMG=$P($G(Y),"^",1)
"RTN","RGHLLOG",87,0)
 I $P(^RGHL7(991.11,RGEXC,0),U,4)=RGMG S STAT=1
"RTN","RGHLLOG",88,0)
 S DA(1)=RGLOG,DA=RGI,DR="2///"_$G(RGEXC)_";3///"_$S($G(RGDFN):"`"_RGDFN,1:"")_";6///"_$G(STAT)_";10///"_$G(RGERR)
"RTN","RGHLLOG",89,0)
 D ^DIE K DIE,DA,DR
"RTN","RGHLLOG",90,0)
 L -^RGHL7(991.1,RGLOG)
"RTN","RGHLLOG",91,0)
 S RGI=$P(RGZ,U,3),RGZ=$P(RGZ,U,4)
"RTN","RGHLLOG",92,0)
 ;
"RTN","RGHLLOG",93,0)
 ;If the action type is for the MPI Exception Handler, send exception to the handler and quit
"RTN","RGHLLOG",94,0)
 I (RGI=3) D SENDMPI^RGHLLOG1($G(RGEXC),$G(RGERR),$G(RGDFN),$G(MSGID),$G(STATNUM)) Q
"RTN","RGHLLOG",95,0)
 ;
"RTN","RGHLLOG",96,0)
 Q:'RGI!'RGZ
"RTN","RGHLLOG",97,0)
 ;quit and don't send messages for exception types that are now being
"RTN","RGHLLOG",98,0)
 ;handled through the MPI/PD Exception Handling option.
"RTN","RGHLLOG",99,0)
 Q:RGEXC=234  ;**52 MPIC_772 remove 215, 216 & 217;**57 MPIC_1893 remove 218
"RTN","RGHLLOG",100,0)
 S DIC="^XMB(3.8,",DIC(0)="NZ",X="`"_RGZ D ^DIC K DIC Q:+Y<1  S RGZ=$P(Y,U,2) K Y
"RTN","RGHLLOG",101,0)
 Q:RGZ=""!$P($G(^RGSITE("COR",1,0)),U,7)
"RTN","RGHLLOG",102,0)
 S RGERR=$$SHORT(RGEXC,RGERR),RGZ="G."_RGZ
"RTN","RGHLLOG",103,0)
 I RGI=2 D ALERT^RGRSUTL2(RGERR,RGZ) Q
"RTN","RGHLLOG",104,0)
 D MAIL^RGRSUTL2(RGERR,RGZ,"MPI/PD Exception: "_$$SHORT(RGEXC),"MPI/PD exception notification")
"RTN","RGHLLOG",105,0)
 Q
"RTN","RGHLLOG",106,0)
 ;
"RTN","RGHLLOG",107,0)
INVEXC(RGMID) ; determine if this exception needs to be sent to MPI/PD
"RTN","RGHLLOG",108,0)
 ; personnel via FORUM. Return 1 to avoid messaging to FORUM, else 0.
"RTN","RGHLLOG",109,0)
 ; IA#:3244 is applied in this functionality
"RTN","RGHLLOG",110,0)
 N RGFLG,RGIEN S RGFLG=1
"RTN","RGHLLOG",111,0)
 S RGIEN=$$IEN773(RGMID) Q:'RGIEN RGFLG
"RTN","RGHLLOG",112,0)
 S RGIEN("SND")=$$GET1^DIQ(773,RGIEN_",",13)
"RTN","RGHLLOG",113,0)
 S RGIEN("REC")=$$GET1^DIQ(773,RGIEN_",",14)
"RTN","RGHLLOG",114,0)
 ; check the sending application (fld:13, 0;11) & the receiving
"RTN","RGHLLOG",115,0)
 ; application (fld:14, 0;12) to see if they are related to the MPI/PD
"RTN","RGHLLOG",116,0)
 ; project.
"RTN","RGHLLOG",117,0)
 I RGIEN("SND")]""!(RGIEN("REC")]"") D  Q RGFLG
"RTN","RGHLLOG",118,0)
 .S RGFLG=$$APP(RGIEN("SND")) Q:'RGFLG
"RTN","RGHLLOG",119,0)
 .S RGFLG=$$APP(RGIEN("REC"))
"RTN","RGHLLOG",120,0)
 .Q
"RTN","RGHLLOG",121,0)
 ; Only if the sending/receiving applications cannot be determined from
"RTN","RGHLLOG",122,0)
 ; the data in their respective fields, do I check the MSH multiple for
"RTN","RGHLLOG",123,0)
 ; the MSH segment. I identify the sending/receiving application from
"RTN","RGHLLOG",124,0)
 ; this segment. 
"RTN","RGHLLOG",125,0)
 E  D
"RTN","RGHLLOG",126,0)
 .N RG,RG1,RGMSH,RGFS
"RTN","RGHLLOG",127,0)
 .D GETS^DIQ(773,RGIEN_",",200,,"RGMSH") ;check MSH mult for snd/rec app
"RTN","RGHLLOG",128,0)
 .Q:'($D(RGMSH)\10)  ; no data in "MSH" multiple for file 773
"RTN","RGHLLOG",129,0)
 .S RGIEN=RGIEN_",",RG="RGMSH(773,"""_RGIEN_""","_200_")"
"RTN","RGHLLOG",130,0)
 .S RG1=0 F  S RG1=$O(@RG@(RG1)) Q:RG1'>0  D  Q:$E($G(@RG@(RG1)),1,3)="MSH"
"RTN","RGHLLOG",131,0)
 ..I $E($G(@RG@(RG1)),1,3)="MSH" D
"RTN","RGHLLOG",132,0)
 ...S RG(0)=$G(@RG@(RG1)),RGFS=$E(RG(0),4)
"RTN","RGHLLOG",133,0)
 ...S:$P(RG(0),RGFS,3)]"" RGFLG=$$APP($P(RG(0),RGFS,3)) Q:'RGFLG
"RTN","RGHLLOG",134,0)
 ...S:$P(RG(0),RGFS,5)]"" RGFLG=$$APP($P(RG(0),RGFS,5))
"RTN","RGHLLOG",135,0)
 ...Q
"RTN","RGHLLOG",136,0)
 ..Q
"RTN","RGHLLOG",137,0)
 .Q
"RTN","RGHLLOG",138,0)
 Q RGFLG
"RTN","RGHLLOG",139,0)
APP(X) ; check if the sending/receiving application is relevant to the
"RTN","RGHLLOG",140,0)
 ; MPI/PD team.  Returns 1 if a non-relevant namespace, else 0
"RTN","RGHLLOG",141,0)
 I $E(X,1,2)="RG"!($E(X,1,2)="VA")!($E(X,1,3)="MPI") Q 0
"RTN","RGHLLOG",142,0)
 Q 1
"RTN","RGHLLOG",143,0)
 ;
"RTN","RGHLLOG",144,0)
IEN773(RGMID) ; find the ien of the record in the HL7 MESSAGE ADMINISTRATION
"RTN","RGHLLOG",145,0)
 ; (#773) file based on the Message ID.  Input: Message ID
"RTN","RGHLLOG",146,0)
 ; Output: null, no record in 773, else 773 record ien.  IA#: 3244
"RTN","RGHLLOG",147,0)
 Q:$G(RGMID)="" ""
"RTN","RGHLLOG",148,0)
 Q $O(^HLMA("C",RGMID,0))
"RTN","RGHLLOG",149,0)
 ;
"RTN","RGHLLOG",150,0)
SHORT(RGEXC,RGTXT) ;
"RTN","RGHLLOG",151,0)
 ; Retrieve short text description of exception
"RTN","RGHLLOG",152,0)
 Q $G(^RGHL7(991.11,+RGEXC,10))_$S($G(RGTXT)="":"",1:": "_RGTXT)
"RTN","RGHLLOG",153,0)
 ;
"RTN","RGMTETOT")
0^4^B13022179^B27906188
"RTN","RGMTETOT",1,0)
RGMTETOT ;BIR/CML-Compile Totals for Site Exceptions ;11/15/01
"RTN","RGMTETOT",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**20,30,43,45,52,57**;30 Apr 99;Build 2
"RTN","RGMTETOT",3,0)
 ;
"RTN","RGMTETOT",4,0)
 ;Reference to ^DPT("AICNL" supported by IA #2070
"RTN","RGMTETOT",5,0)
 ;
"RTN","RGMTETOT",6,0)
 ;Variable RGHLMQ cannot be killed in this routine, it is needed for the remote query
"RTN","RGMTETOT",7,0)
 ;
"RTN","RGMTETOT",8,0)
 ;**57 MPIC_1893; Patch removed references to exception 218, Potential Matches Returned.
"RTN","RGMTETOT",9,0)
 ;Therefore, deleted the PURGE, SETTMP, and DELDUP modules.
"RTN","RGMTETOT",10,0)
 ;
"RTN","RGMTETOT",11,0)
 ;Use this routine to compile totals of a site's exceptions in file #991.1
"RTN","RGMTETOT",12,0)
 S DUMP=0 G START
"RTN","RGMTETOT",13,0)
 ;
"RTN","RGMTETOT",14,0)
DUMP1 ;Use this call to dump all data in ascii format for table
"RTN","RGMTETOT",15,0)
 S DUMP=1 G START
"RTN","RGMTETOT",16,0)
 ;
"RTN","RGMTETOT",17,0)
DUMP2 ;Use this call to dump data in ascii format for table - just for exceptions sites have to deal with
"RTN","RGMTETOT",18,0)
 S DUMP=2
"RTN","RGMTETOT",19,0)
 ;
"RTN","RGMTETOT",20,0)
START ;
"RTN","RGMTETOT",21,0)
 K TYPEARR,^XTMP("RGMT","HLMQETOT")
"RTN","RGMTETOT",22,0)
 S ^XTMP("RGMT",0)=$$FMADD^XLFDT(DT,30)_"^"_$$NOW^XLFDT_"^MPI/PD Maintenance Data"
"RTN","RGMTETOT",23,0)
 ;create type array from file 991.11
"RTN","RGMTETOT",24,0)
 S TYPE=233 F  S TYPE=$O(^RGHL7(991.11,TYPE)) Q:'TYPE  S TYPEARR(TYPE)=0 ;**52 MPIC_772 remove 215, 216, & 217;**57 MPIC_1893 remove 218 reference
"RTN","RGMTETOT",25,0)
 ;
"RTN","RGMTETOT",26,0)
 ;start loop
"RTN","RGMTETOT",27,0)
 S TYPE=233 F  S TYPE=$O(^RGHL7(991.1,"AC",TYPE)) Q:'TYPE  D  ;**52 MPIC_772 remove 215, 216 & 217
"RTN","RGMTETOT",28,0)
 .S IEN1=0 F  S IEN1=$O(^RGHL7(991.1,"AC",TYPE,IEN1)) Q:'IEN1  D
"RTN","RGMTETOT",29,0)
 ..S IEN2=0 F  S IEN2=$O(^RGHL7(991.1,"AC",TYPE,IEN1,IEN2)) Q:'IEN2  D
"RTN","RGMTETOT",30,0)
 ...I '$D(^RGHL7(991.1,IEN1,1,IEN2,0)) Q
"RTN","RGMTETOT",31,0)
 ...S STAT=$P(^RGHL7(991.1,IEN1,1,IEN2,0),"^",5) I STAT<1 S TYPEARR(TYPE)=TYPEARR(TYPE)+1
"RTN","RGMTETOT",32,0)
 ;
"RTN","RGMTETOT",33,0)
PRT ;
"RTN","RGMTETOT",34,0)
 S GRAND=0
"RTN","RGMTETOT",35,0)
 S SITENM=$P($$SITE^VASITE(),"^",2),$P(LN,"-",81)=""
"RTN","RGMTETOT",36,0)
 D NOW^%DTC S RUNDT=$$FMTE^XLFDT($E(%,1,12))
"RTN","RGMTETOT",37,0)
 ;
"RTN","RGMTETOT",38,0)
PRT0 I 'DUMP D
"RTN","RGMTETOT",39,0)
 .W !!,"Exception Totals for ",SITENM
"RTN","RGMTETOT",40,0)
 .W !,"Printed ",RUNDT,!,LN
"RTN","RGMTETOT",41,0)
 .S TYPE=0 F  S TYPE=$O(TYPEARR(TYPE)) Q:'TYPE  I +TYPEARR(TYPE) D
"RTN","RGMTETOT",42,0)
 ..S GRAND=GRAND+TYPEARR(TYPE)
"RTN","RGMTETOT",43,0)
 ..W !!,"TYPE: ",TYPE,?12,$P($T(@TYPE),";;",2),?67,"TOTAL = ",$J(TYPEARR(TYPE),4)
"RTN","RGMTETOT",44,0)
 ..W !,"DESCRIPTION:"
"RTN","RGMTETOT",45,0)
 ..S TXT=0 F  S TXT=$O(^RGHL7(991.11,TYPE,99,TXT)) Q:'TXT  W !,^RGHL7(991.11,TYPE,99,TXT,0)
"RTN","RGMTETOT",46,0)
 .W !!?56,"TOTAL EXCEPTIONS: ",$J(GRAND,5)
"RTN","RGMTETOT",47,0)
 ;
"RTN","RGMTETOT",48,0)
PRT1 I DUMP=1 D
"RTN","RGMTETOT",49,0)
 .W !!,"At this point it is necessary for you to increase the right margin."
"RTN","RGMTETOT",50,0)
 .W !,"At the DEVICE prompt enter=> ;255"
"RTN","RGMTETOT",51,0)
 .W ! D ^%ZIS I POP W !,"DOWNLOAD ABORTED!" Q
"RTN","RGMTETOT",52,0)
 .W !!,"Data string=Site;Run Date;Date CIRN Installed;Exceptions 234" ;**52 MPIC_772 remove 215, 216 & 217;**57 MPIC_1893 remove 218
"RTN","RGMTETOT",53,0)
 .S STR=SITENM_";"_RUNDT_";"
"RTN","RGMTETOT",54,0)
 .S TYPE=0 F  S TYPE=$O(TYPEARR(TYPE)) Q:'TYPE  D
"RTN","RGMTETOT",55,0)
 ..S STR=STR_";"_TYPEARR(TYPE)
"RTN","RGMTETOT",56,0)
 .W !!,STR
"RTN","RGMTETOT",57,0)
 ;
"RTN","RGMTETOT",58,0)
PRT2 I DUMP=2 D
"RTN","RGMTETOT",59,0)
 .S ICN=0,LOCCNT=0 F  S ICN=$O(^DPT("AICNL",1,ICN)) Q:'ICN  S LOCCNT=LOCCNT+1
"RTN","RGMTETOT",60,0)
 .S SITEIEN=+$$SITE^VASITE(),STANUM=$P($$SITE^VASITE(),"^",3)
"RTN","RGMTETOT",61,0)
 .I '$D(RGHLMQ) W !!,"Data string:"
"RTN","RGMTETOT",62,0)
 .I '$D(RGHLMQ) W !,"Site;Sta#;;;LocICNs,234" ;**52 MPIC_772 remove 215, 216 & 217;**57 MPIC_1893 remove 218
"RTN","RGMTETOT",63,0)
 .S STR=SITENM_";"_STANUM_";;;"_LOCCNT
"RTN","RGMTETOT",64,0)
 .F TYPE=234 S STR=STR_";;"_TYPEARR(TYPE) ;**52 MPIC_772 remove 215, 216 & 217;**57 MPIC_1893 remove 218
"RTN","RGMTETOT",65,0)
 .I '$D(RGHLMQ) W !!,STR
"RTN","RGMTETOT",66,0)
 .I $D(RGHLMQ) S ^XTMP("RGMT","HLMQETOT",STANUM,1)=STR
"RTN","RGMTETOT",67,0)
 ;
"RTN","RGMTETOT",68,0)
QUIT ;
"RTN","RGMTETOT",69,0)
 K %,CIRNIEN,CNT,DA,DIK,DUMP,DUPCNT,EXCDT,GRAND,ICN,IEN,IEN1,IEN2,LN,LOCCNT,OLDDT,OLDNODE,PTNM
"RTN","RGMTETOT",70,0)
 K RGDFN,RUNDT,SITEIEN,SITENM,STANUM,STAT,STR,TXT,TYPE,XCNT,HOME,DFN,RCNT,VADM
"RTN","RGMTETOT",71,0)
 K ^XTMP("RGMT","ETOT")
"RTN","RGMTETOT",72,0)
 Q
"RTN","RGMTETOT",73,0)
 ;
"RTN","RGMTETOT",74,0)
234 ;;(Primary View Reject)
"RTN","RGP57PST")
0^8^B5113070^n/a
"RTN","RGP57PST",1,0)
RGP57PST ;BIR/PTD-POST-INIT TO RETIRE #218 EXCEPTIONS ;3/9/10
"RTN","RGP57PST",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**57**;30 Apr 99;Build 2
"RTN","RGP57PST",3,0)
 ;
"RTN","RGP57PST",4,0)
 ;Loop through the CIRN HL7 EXCEPTION LOG (#991.1) file.
"RTN","RGP57PST",5,0)
 ;Find exceptions with EXCEPTION STATUS of NOT PROCESSED ("0").
"RTN","RGP57PST",6,0)
 ;Get the TYPE which is a pointer to the CIRN HL7 EXCEPTION
"RTN","RGP57PST",7,0)
 ;TYPE (#991.11) file.  If the TYPE is 218 (Potential Matches
"RTN","RGP57PST",8,0)
 ;Returned),mark the EXCEPTION STATUS to PROCESSED ("1").
"RTN","RGP57PST",9,0)
 ;Exception type 218 is obsolete.
"RTN","RGP57PST",10,0)
 ;
"RTN","RGP57PST",11,0)
EXLOG ;
"RTN","RGP57PST",12,0)
 ;If patch RG*1.0*57 has previously been installed, quit post-init.
"RTN","RGP57PST",13,0)
 I $$PATCH^XPDUTL("RG*1.0*57") D BMES^XPDUTL(" Post-install previously ran; no need to reprocess file 991.1 again.") Q
"RTN","RGP57PST",14,0)
 ;Else continue with post-init.
"RTN","RGP57PST",15,0)
 ;
"RTN","RGP57PST",16,0)
 D BMES^XPDUTL(" The post-init routine will retire Potential Matches Returned (218)")
"RTN","RGP57PST",17,0)
 D MES^XPDUTL(" exceptions in the CIRN HL7 EXCEPTION LOG (#991.1) file.")
"RTN","RGP57PST",18,0)
 ;
"RTN","RGP57PST",19,0)
 N COUNT,DA,DIC,DIE,DR,EXNUM,EXCTYP,LOGIEN,X,Y,ZNODE
"RTN","RGP57PST",20,0)
 S (LOGIEN,COUNT)=0
"RTN","RGP57PST",21,0)
 F  S LOGIEN=$O(^RGHL7(991.1,LOGIEN)) Q:'LOGIEN  D
"RTN","RGP57PST",22,0)
 .S EXNUM=0
"RTN","RGP57PST",23,0)
 .F  S EXNUM=$O(^RGHL7(991.1,LOGIEN,1,EXNUM)) Q:'EXNUM  S ZNODE=$G(^(EXNUM,0)) I $P(ZNODE,"^",5)'=1 D  ;Quit if EXCEPTION STATUS (#6) equals 1 for PROCESSED
"RTN","RGP57PST",24,0)
 ..S EXCTYP=$P(ZNODE,"^",3) ;Get exception TYPE
"RTN","RGP57PST",25,0)
 ..I EXCTYP=218 D  ;If TYPE is 218 - Potential Matches Returned DO
"RTN","RGP57PST",26,0)
 ...; 
"RTN","RGP57PST",27,0)
DIE ...;Update the EXCEPTION STATUS (#6) field to '1' - PROCESSED.
"RTN","RGP57PST",28,0)
 ...S DA(1)=LOGIEN,DA=EXNUM,DR="6///"_1
"RTN","RGP57PST",29,0)
 ...S DIE="^RGHL7(991.1,"_DA(1)_",1,"
"RTN","RGP57PST",30,0)
 ...L +^RGHL7(991.1,LOGIEN):10
"RTN","RGP57PST",31,0)
 ...D ^DIE K DA,DIE,DR
"RTN","RGP57PST",32,0)
 ...L -^RGHL7(991.1,LOGIEN)
"RTN","RGP57PST",33,0)
 ...S COUNT=COUNT+1
"RTN","RGP57PST",34,0)
 ;
"RTN","RGP57PST",35,0)
 D BMES^XPDUTL(" A total of "_COUNT_" Potential Matches Returned exceptions were retired.")
"RTN","RGP57PST",36,0)
 D MES^XPDUTL(" Post-install routine completed successfully.")
"RTN","RGP57PST",37,0)
 Q
"RTN","RGRSUTIL")
0^5^B11788298^B14283785
"RTN","RGRSUTIL",1,0)
RGRSUTIL ;ALB/RJS-MPI/PD UTILITIES ;03/12/96
"RTN","RGRSUTIL",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**1,3,19,45,57**;30 Apr 99;Build 2
"RTN","RGRSUTIL",3,0)
EXCEPT ;Members of the RG CIRN DEMOGRAPHIC ISSUES Mail Group are
"RTN","RGRSUTIL",4,0)
 ;notified upon login if there are unresolved Primary View
"RTN","RGRSUTIL",5,0)
 ;Reject exceptions for review in the MPI/PD Exception
"RTN","RGRSUTIL",6,0)
 ;Handler ;**57 MPIC_1893 Only exception type 234 remains
"RTN","RGRSUTIL",7,0)
 ;
"RTN","RGRSUTIL",8,0)
 ;Is user a member of this mail group?
"RTN","RGRSUTIL",9,0)
 S RGCDI=$$FIND1^DIC(3.8,,,"RG CIRN DEMOGRAPHIC ISSUES")
"RTN","RGRSUTIL",10,0)
 I RGCDI="" G END
"RTN","RGRSUTIL",11,0)
 S XMDUZ=DUZ,Y=RGCDI D CHK^XMA21 I '$T G END
"RTN","RGRSUTIL",12,0)
 ;User is a member.
"RTN","RGRSUTIL",13,0)
 I $O(^RGHL7(991.1,"ASTAT","0",234,0)) D
"RTN","RGRSUTIL",14,0)
 .D SET^XUS1A("!  <<------------------------------------------------------------------------>>")
"RTN","RGRSUTIL",15,0)
 .D SET^XUS1A("!  << You have Primary View Reject exceptions that need to be reviewed using >>")
"RTN","RGRSUTIL",16,0)
 .D SET^XUS1A("!  << the MPI/PD Exception Handling Option on the Message Exception Menu.    >>")
"RTN","RGRSUTIL",17,0)
 .D SET^XUS1A("!  <<------------------------------------------------------------------------>>")
"RTN","RGRSUTIL",18,0)
END K RGCDI,XMDUZ,Y
"RTN","RGRSUTIL",19,0)
 Q
"RTN","RGRSUTIL",20,0)
 ;
"RTN","RGRSUTIL",21,0)
SEG(SEGMENT,PIECE,CODE) ;Return segment from RGDC array and kill node
"RTN","RGRSUTIL",22,0)
 N RGNODE,RGDATA,RGDONE,RGC K RGDONE
"RTN","RGRSUTIL",23,0)
 I '$D(RGC) S RGC=$E(HL("ECH"))
"RTN","RGRSUTIL",24,0)
 S RGNODE=0
"RTN","RGRSUTIL",25,0)
 F  S RGNODE=$O(RGDC(RGNODE)) Q:RGNODE=""!($D(RGDONE))  D
"RTN","RGRSUTIL",26,0)
 .S RGDATA=RGDC(RGNODE)
"RTN","RGRSUTIL",27,0)
 .I ($P(RGDATA,HL("FS"),1)=SEGMENT)&($P($P(RGDATA,HL("FS"),PIECE),RGC,1)=CODE) S RGDONE=1 K RGDC(RGNODE)
"RTN","RGRSUTIL",28,0)
 Q:$D(RGDONE) $G(RGDATA)
"RTN","RGRSUTIL",29,0)
 Q ""
"RTN","RGRSUTIL",30,0)
SEG1(SEGMENT,PIECE,CODE) ;Return segment from RGDC array 
"RTN","RGRSUTIL",31,0)
 N RGNODE,RGDATA,RGDONE,RGC K RGDONE
"RTN","RGRSUTIL",32,0)
 I '$D(RGC) S RGC=$E(HL("ECH"))
"RTN","RGRSUTIL",33,0)
 S RGNODE=0
"RTN","RGRSUTIL",34,0)
 F  S RGNODE=$O(RGDC(RGNODE)) Q:RGNODE=""!($D(RGDONE))  D
"RTN","RGRSUTIL",35,0)
 .S RGDATA=RGDC(RGNODE)
"RTN","RGRSUTIL",36,0)
 .I ($P(RGDATA,HL("FS"),1)=SEGMENT)&($P($P(RGDATA,HL("FS"),PIECE),RGC,1)=CODE) S RGDONE=1
"RTN","RGRSUTIL",37,0)
 Q:$D(RGDONE) $G(RGDATA)
"RTN","RGRSUTIL",38,0)
 Q ""
"RTN","RGRSUTIL",39,0)
ERROR(CODE) ;**THIS ENTRY POINT IS NO LONGER USED**
"RTN","RGRSUTIL",40,0)
 Q ""
"RTN","RGRSUTIL",41,0)
INITIZE ;Initialize RGDC array with incoming message
"RTN","RGRSUTIL",42,0)
 N I,J,X
"RTN","RGRSUTIL",43,0)
 F I=1:1 X HLNEXT Q:HLQUIT'>0  S RGDC(I)=HLNODE,J=0  F  S J=$O(HLNODE(J)) Q:'J  S RGDC(I,J)=HLNODE(J)
"RTN","RGRSUTIL",44,0)
 Q
"RTN","RGRSUTIL",45,0)
SSNDFN(SSN) ;Input ssn output DFN
"RTN","RGRSUTIL",46,0)
 N DFN
"RTN","RGRSUTIL",47,0)
 Q:$G(SSN)="" -1
"RTN","RGRSUTIL",48,0)
 S DFN=$O(^DPT("SSN",+SSN,0))
"RTN","RGRSUTIL",49,0)
 Q:$L(DFN) DFN
"RTN","RGRSUTIL",50,0)
 S DFN=$O(^DPT("SSN",SSN,0))
"RTN","RGRSUTIL",51,0)
 Q:$L(DFN) DFN
"RTN","RGRSUTIL",52,0)
 Q -1
"RTN","RGRSUTIL",53,0)
 ;
"RTN","RGRSUTIL",54,0)
LINE() ; Return a dashed line.       
"RTN","RGRSUTIL",55,0)
 Q $TR($J("",80)," ","-")
"RTN","RGRSUTIL",56,0)
 ;
"RTN","RGRSUTIL",57,0)
PAUSE() ; Pause for CRT output.
"RTN","RGRSUTIL",58,0)
 ;  Input:   IOST, IOSL
"RTN","RGRSUTIL",59,0)
 ;  Output:  0  --  Continue to display output
"RTN","RGRSUTIL",60,0)
 ;           1  --  Quit
"RTN","RGRSUTIL",61,0)
 Q:$E(IOST,1,2)'["C-" 0
"RTN","RGRSUTIL",62,0)
 N DIR,DIRUT,DTOUT,DUOUT,RGJ
"RTN","RGRSUTIL",63,0)
 F RGJ=$Y:1:(IOSL-4) W !
"RTN","RGRSUTIL",64,0)
 S DIR(0)="E" D ^DIR
"RTN","RGRSUTIL",65,0)
 Q $D(DIRUT)!($D(DUOUT))
"RTN","RGRSUTIL",66,0)
 ;
"RTN","RGRSUTIL",67,0)
DIAG(X) ; Return a string for diagnoses.
"RTN","RGRSUTIL",68,0)
 ;  Input:   X  -  Code for type of diagnosis (Primary, etc.)
"RTN","RGRSUTIL",69,0)
 ;  Output:  Descriptive string, i.e., "Primary", etc.
"RTN","RGRSUTIL",70,0)
 Q $S($G(X)="":"Unknown",X="A":"Additional",X="P":"Primary",X="S":"Secondary",X="T":"Tertiary",1:"Unknown")
"RTN","RGRSUTIL",71,0)
 ;
"RTN","RGRSUTIL",72,0)
ORD(X) ; Return a string for orders.
"RTN","RGRSUTIL",73,0)
 ;  Input:   X  -  Code for type of order (Lab, etc.)
"RTN","RGRSUTIL",74,0)
 ;  Output:  Descriptive string, i.e., "Lab", etc.
"RTN","RGRSUTIL",75,0)
 Q $S($G(X)="":"Unknown",X="L":"Lab",X="R":"Radiology",1:"Unknown")
"RTN","RGRSUTIL",76,0)
 ;
"RTN","RGRSUTIL",77,0)
UPDTFLD(FILE,FLD,ANS1,ANS2) ; Returns the correct field answer
"RTN","RGRSUTIL",78,0)
 ;DLR - Added to prevent the overwriting the last four in ZIP with null
"RTN","RGRSUTIL",79,0)
 ; input:  FILE  - file number (ex. 2 PATIENT)
"RTN","RGRSUTIL",80,0)
 ;         FLD  -  field number (ex. .1112 ZIP+4)
"RTN","RGRSUTIL",81,0)
 ;         ANS1 -  existing field value
"RTN","RGRSUTIL",82,0)
 ;         ANS2 -  incoming value
"RTN","RGRSUTIL",83,0)
 I (FILE=2)&(FLD=.1112) I $E(ANS1,1,5)=$E(ANS2,1,5),($L(ANS2)=5) Q ANS1
"RTN","RGRSUTIL",84,0)
 Q ANS2
"RTN","RGRSUTIL",85,0)
 ;
"RTN","RGRSUTIL",86,0)
SSNINT(SSN) ;
"RTN","RGRSUTIL",87,0)
 Q:$G(SSN)="" ""
"RTN","RGRSUTIL",88,0)
 Q $TRANSLATE(SSN,"-","")
"RTN","RGRSUTIL",89,0)
 ;
"RTN","RGRSUTIL",90,0)
ACTION ;Entry action for Primary View Reject exceptions
"RTN","RGRSUTIL",91,0)
 I $O(^RGHL7(991.1,"ASTAT","0",234,0)) D
"RTN","RGRSUTIL",92,0)
 .W !!,"  <<------------------------------------------------------------------------>>"
"RTN","RGRSUTIL",93,0)
 .W !,"  << You have Primary View Reject exceptions that need to be reviewed using >>"
"RTN","RGRSUTIL",94,0)
 .W !,"  << the MPI/PD Exception Handling Option on the Message Exception Menu.    >>"
"RTN","RGRSUTIL",95,0)
 .W !,"  <<------------------------------------------------------------------------>>"
"RTN","RGRSUTIL",96,0)
 Q
"RTN","RGRSUTIL",97,0)
 ;
"RTN","RGSYSTAT")
0^6^B9266591^B9080377
"RTN","RGSYSTAT",1,0)
RGSYSTAT ;BAY/ALS-MPI/PD STATUS DISPLAY ;01/05/01
"RTN","RGSYSTAT",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**16,19,23,25,20,43,45,52,57**;30 Apr 99;Build 2
"RTN","RGSYSTAT",3,0)
 ;
"RTN","RGSYSTAT",4,0)
 ;Reference to ^DGCN(391.98,"AST" supported by IA #3303
"RTN","RGSYSTAT",5,0)
 ;Reference to ^DGCN(391.984 supported by IA #3304
"RTN","RGSYSTAT",6,0)
 ;Reference to ^MPIF(984.9 supported by IA #3298
"RTN","RGSYSTAT",7,0)
 ;Reference to OPTSTAT^XUTMOPT supported by IA #1472
"RTN","RGSYSTAT",8,0)
 ;Reference to ^DPT("ACMORS", ^DPT("AICN", and ^DPT("AICNL" supported by IA #2070
"RTN","RGSYSTAT",9,0)
 ;Reference to ^VAT(391.71 supported by IA #3422
"RTN","RGSYSTAT",10,0)
EN ;
"RTN","RGSYSTAT",11,0)
 ; Count exceptions on hand
"RTN","RGSYSTAT",12,0)
EXC ;
"RTN","RGSYSTAT",13,0)
 W @IOF,"Exception Handler Entries:",!,"--------------------------"
"RTN","RGSYSTAT",14,0)
 S CNT=0,EXCTYP="",NTYP="",TOTL=0,PCNT=0
"RTN","RGSYSTAT",15,0)
 N STAT,DFN,ICN
"RTN","RGSYSTAT",16,0)
 S HOME=$$SITE^VASITE()
"RTN","RGSYSTAT",17,0)
 F  S EXCTYP=$O(^RGHL7(991.1,"AC",EXCTYP)) Q:'EXCTYP  D
"RTN","RGSYSTAT",18,0)
 . I EXCTYP=234 D  ;**45;**52 MPIC_772 remove 215, 216, 217 & 227;**57 MPIC_1893 remove 218
"RTN","RGSYSTAT",19,0)
 .. I (EXCTYP'=NTYP)&(CNT>0) D
"RTN","RGSYSTAT",20,0)
 ... S ETEXT=$P($G(^RGHL7(991.11,NTYP,10)),"^",1)
"RTN","RGSYSTAT",21,0)
 ... W !,$E(ETEXT,1,47),?55,$J(CNT,6) S TOTL=TOTL+CNT,CNT=0
"RTN","RGSYSTAT",22,0)
 .. S IEN=0,NTYP=EXCTYP
"RTN","RGSYSTAT",23,0)
 .. F  S IEN=$O(^RGHL7(991.1,"AC",EXCTYP,IEN)) Q:'IEN  D
"RTN","RGSYSTAT",24,0)
 ... S IEN2=0
"RTN","RGSYSTAT",25,0)
 ... F  S IEN2=$O(^RGHL7(991.1,"AC",EXCTYP,IEN,IEN2)) Q:'IEN2  D
"RTN","RGSYSTAT",26,0)
 .... S STAT=$P(^RGHL7(991.1,IEN,1,IEN2,0),"^",5) I STAT<1 D
"RTN","RGSYSTAT",27,0)
 ..... S DFN=$P(^RGHL7(991.1,IEN,1,IEN2,0),"^",4) Q:'DFN
"RTN","RGSYSTAT",28,0)
 ..... S ^XTMP("RGEXC",0)=$$FMADD^XLFDT(DT,2)_"^"_DT_"^"_"MPI/PD Status Display"
"RTN","RGSYSTAT",29,0)
 ..... S ^XTMP("RGEXC",DFN)=DFN
"RTN","RGSYSTAT",30,0)
 ..... S ICN=+$$GETICN^MPIF001(DFN)
"RTN","RGSYSTAT",31,0)
 ..... I $E(ICN,1,3)=$E($P(HOME,"^",3),1,3)!(ICN<0)!(EXCTYP=234) D  ;**43;**45;**52 MPIC_772 remove 215, 216 & 217;**57 MPIC_1893 remove 218
"RTN","RGSYSTAT",32,0)
 ...... S CNT=CNT+1
"RTN","RGSYSTAT",33,0)
 I CNT>0 D
"RTN","RGSYSTAT",34,0)
 .S ETEXT=$P($G(^RGHL7(991.11,NTYP,10)),"^",1)
"RTN","RGSYSTAT",35,0)
 .W !,$E(ETEXT,1,47),?55,$J(CNT,6) S TOTL=TOTL+CNT
"RTN","RGSYSTAT",36,0)
 I TOTL=0 W !,"There are no entries in the Exception Handler."
"RTN","RGSYSTAT",37,0)
 I TOTL>0 D
"RTN","RGSYSTAT",38,0)
 . W !!,"Total number of exceptions: ",?55,$J(TOTL,6)
"RTN","RGSYSTAT",39,0)
 . S PDFN=""
"RTN","RGSYSTAT",40,0)
 . F  S PDFN=$O(^XTMP("RGEXC",PDFN)) Q:'PDFN  D
"RTN","RGSYSTAT",41,0)
 .. S PCNT=PCNT+1
"RTN","RGSYSTAT",42,0)
 . W !,"Total unique patient exceptions: ",?55,$J(PCNT,6)
"RTN","RGSYSTAT",43,0)
 S STDT=$P($G(^RGSITE(991.8,1,"EXCPRG")),"^",1)
"RTN","RGSYSTAT",44,0)
 I $D(^RGSITE(991.8,1,"EXCPRG")) D
"RTN","RGSYSTAT",45,0)
 . S STDT=$$FMTE^XLFDT(STDT,1)
"RTN","RGSYSTAT",46,0)
 . W !!,"The MPI/PD Exception Purge process last ran "_STDT_"."
"RTN","RGSYSTAT",47,0)
 K CNT,EXCTYP,NTYP,ETEXT,TOTL,IEN,IEN2,HOME,PCNT,^XTMP("RGEXC"),PDFN,STDT
"RTN","RGSYSTAT",48,0)
 I $Y>21 D QUIT Q:X="^"
"RTN","RGSYSTAT",49,0)
PDR ;Count entries in Patient Data Review ;**52 Obsolete data removed from report.
"RTN","RGSYSTAT",50,0)
 ;W !!,"Patient Data Review Entries:",!,"----------------------------"
"RTN","RGSYSTAT",51,0)
 ;S CNT=0,PDRTYP="",NTYP="",TOTL=0
"RTN","RGSYSTAT",52,0)
 ;F  S PDRTYP=$O(^DGCN(391.98,"AST",PDRTYP)) Q:'PDRTYP  D
"RTN","RGSYSTAT",53,0)
 ;. I (PDRTYP'=NTYP)&(CNT>0) D
"RTN","RGSYSTAT",54,0)
 ;.. S DIC="^DGCN(391.984,",DR=".01",DA=NTYP,DIQ(0)="E",DIQ="RGPDR"
"RTN","RGSYSTAT",55,0)
 ;.. D EN^DIQ1 K DIC,DA,DR,DIQ
"RTN","RGSYSTAT",56,0)
 ;.. S PTEXT=$G(RGPDR(391.984,NTYP,.01,"E"))
"RTN","RGSYSTAT",57,0)
 ;.. W !,$E(PTEXT,1,47),?55,$J(CNT,6) S TOTL=TOTL+CNT,CNT=0
"RTN","RGSYSTAT",58,0)
 ;. I (PDRTYP=1)!(PDRTYP=2)!(PDRTYP=5) D
"RTN","RGSYSTAT",59,0)
 ;.. S IEN=0,NTYP=PDRTYP
"RTN","RGSYSTAT",60,0)
 ;.. F  S IEN=$O(^DGCN(391.98,"AST",PDRTYP,IEN)) Q:'IEN  D
"RTN","RGSYSTAT",61,0)
 ;... S CNT=CNT+1
"RTN","RGSYSTAT",62,0)
 ;I CNT>0 D
"RTN","RGSYSTAT",63,0)
 ;. S DIC="^DGCN(391.984,",DR=".01",DA=NTYP,DIQ(0)="E",DIQ="RGPDR"
"RTN","RGSYSTAT",64,0)
 ;. D EN^DIQ1 K DIC,DA,DR,DIQ
"RTN","RGSYSTAT",65,0)
 ;. S PTEXT=$G(RGPDR(391.984,NTYP,.01,"E"))
"RTN","RGSYSTAT",66,0)
 ;.W !,$E(PTEXT,1,47),?55,$J(CNT,6) S TOTL=TOTL+CNT
"RTN","RGSYSTAT",67,0)
 ;I TOTL=0 W !,"There are no entries in Patient Data Review."
"RTN","RGSYSTAT",68,0)
 ;K CNT,PDRTYP,NTYP,TOTL,IEN,PTEXT,RGPDR
"RTN","RGSYSTAT",69,0)
 ;Q
"RTN","RGSYSTAT",70,0)
 ;I $Y>20 D QUIT Q:X="^"
"RTN","RGSYSTAT",71,0)
 ;
"RTN","RGSYSTAT",72,0)
CMOR ;CMOR Requests Status ;**52 Obsolete data removed from report.
"RTN","RGSYSTAT",73,0)
 ;W !!,"CMOR Requests Status:",!,"---------------------"
"RTN","RGSYSTAT",74,0)
 ;S CNT=0,STAT="",NSTAT="",TOTL=0
"RTN","RGSYSTAT",75,0)
 ;F  S STAT=$O(^MPIF(984.9,"AC",STAT)) Q:'STAT  D
"RTN","RGSYSTAT",76,0)
 ;. I (STAT'=NSTAT)&(CNT>0) D
"RTN","RGSYSTAT",77,0)
 ;.. S TEXT=$$EXTERNAL^DILFD(984.9,.06,,NSTAT)
"RTN","RGSYSTAT",78,0)
 ;.. W !,$E(TEXT,1,47),?55,$J(CNT,6) S TOTL=TOTL+CNT,CNT=0
"RTN","RGSYSTAT",79,0)
 ;. S IEN=0,NSTAT=STAT
"RTN","RGSYSTAT",80,0)
 ;. F  S IEN=$O(^MPIF(984.9,"AC",STAT,IEN)) Q:'IEN  D
"RTN","RGSYSTAT",81,0)
 ;.. S CNT=CNT+1 S TOTL=TOTL+CNT
"RTN","RGSYSTAT",82,0)
 ;I CNT>0 S TEXT=$$EXTERNAL^DILFD(984.9,.06,,NSTAT) W !,$E(TEXT,1,47),?55,$J(CNT,6) S TOTL=TOTL+CNT,CNT=0
"RTN","RGSYSTAT",83,0)
 ;I TOTL=0 W !,"There are no outstanding CMOR Requests."
"RTN","RGSYSTAT",84,0)
 ;K CNT,STAT,NSTAT,TEXT,TOTL,IEN
"RTN","RGSYSTAT",85,0)
 ;I $Y>20 D QUIT Q:X="^"
"RTN","RGSYSTAT",86,0)
 ;
"RTN","RGSYSTAT",87,0)
 S HOME=$P($$SITE^VASITE(),"^",3)
"RTN","RGSYSTAT",88,0)
 S ICN=0,CNT=0
"RTN","RGSYSTAT",89,0)
 F  S ICN=$O(^DPT("AICN",ICN)) Q:'ICN  D
"RTN","RGSYSTAT",90,0)
 .Q:$E(ICN,1,3)=HOME
"RTN","RGSYSTAT",91,0)
 .S CNT=CNT+1
"RTN","RGSYSTAT",92,0)
 W !!,"Current total number of National ICNs = ",CNT
"RTN","RGSYSTAT",93,0)
 S ICN=0,CNT=0
"RTN","RGSYSTAT",94,0)
 F  S ICN=$O(^DPT("AICNL",1,ICN)) Q:'ICN  S CNT=CNT+1
"RTN","RGSYSTAT",95,0)
 W !,"Current total number of Local ICNs = ",CNT
"RTN","RGSYSTAT",96,0)
 K CNT,DFN,ICN
"RTN","RGSYSTAT",97,0)
 Q
"RTN","RGSYSTAT",98,0)
QUIT S DIR(0)="E" D  D ^DIR K DIR
"RTN","RGSYSTAT",99,0)
 .S SS=21-$Y F JJ=1:1:SS W !
"RTN","RGSYSTAT",100,0)
 S $Y=0
"RTN","RGSYSTAT",101,0)
 K JJ,SS
"RTN","RGSYSTAT",102,0)
 Q
"VER")
8.0^22.0
"BLD",2797,6)
^56
**END**
**END**
