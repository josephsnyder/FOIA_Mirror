EMERGENCY Released RG*1*54 SEQ #54
Extracted from mail message
**KIDS**:RG*1.0*54^

**INSTALL NAME**
RG*1.0*54
"BLD",2650,0)
RG*1.0*54^CLINICAL INFO RESOURCE NETWORK^0^3091028^y
"BLD",2650,1,0)
^^4^4^3081026^
"BLD",2650,1,1,0)
 
"BLD",2650,1,2,0)
DELETION OF PSEUDO SSN REASON
"BLD",2650,1,3,0)
Refer to patch RG*1*54 in the FORUM Patch Module for a complete
"BLD",2650,1,4,0)
description.
"BLD",2650,4,0)
^9.64PA^^
"BLD",2650,6.3)
4
"BLD",2650,"ABNS",0)
^9.66A^^
"BLD",2650,"ABPKG")
n^y^G.CIRN DEV@DEVCRN.FO-ALBANY.MED.VA.GOV
"BLD",2650,"KRN",0)
^9.67PA^8989.52^19
"BLD",2650,"KRN",.4,0)
.4
"BLD",2650,"KRN",.401,0)
.401
"BLD",2650,"KRN",.402,0)
.402
"BLD",2650,"KRN",.403,0)
.403
"BLD",2650,"KRN",.5,0)
.5
"BLD",2650,"KRN",.84,0)
.84
"BLD",2650,"KRN",3.6,0)
3.6
"BLD",2650,"KRN",3.8,0)
3.8
"BLD",2650,"KRN",9.2,0)
9.2
"BLD",2650,"KRN",9.8,0)
9.8
"BLD",2650,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",2650,"KRN",9.8,"NM",1,0)
RGADTP2^^0^B53164737
"BLD",2650,"KRN",9.8,"NM",2,0)
RGEX03^^0^B81303188
"BLD",2650,"KRN",9.8,"NM","B","RGADTP2",1)

"BLD",2650,"KRN",9.8,"NM","B","RGEX03",2)

"BLD",2650,"KRN",19,0)
19
"BLD",2650,"KRN",19.1,0)
19.1
"BLD",2650,"KRN",101,0)
101
"BLD",2650,"KRN",409.61,0)
409.61
"BLD",2650,"KRN",771,0)
771
"BLD",2650,"KRN",870,0)
870
"BLD",2650,"KRN",8989.51,0)
8989.51
"BLD",2650,"KRN",8989.52,0)
8989.52
"BLD",2650,"KRN",8994,0)
8994
"BLD",2650,"KRN","B",.4,.4)

"BLD",2650,"KRN","B",.401,.401)

"BLD",2650,"KRN","B",.402,.402)

"BLD",2650,"KRN","B",.403,.403)

"BLD",2650,"KRN","B",.5,.5)

"BLD",2650,"KRN","B",.84,.84)

"BLD",2650,"KRN","B",3.6,3.6)

"BLD",2650,"KRN","B",3.8,3.8)

"BLD",2650,"KRN","B",9.2,9.2)

"BLD",2650,"KRN","B",9.8,9.8)

"BLD",2650,"KRN","B",19,19)

"BLD",2650,"KRN","B",19.1,19.1)

"BLD",2650,"KRN","B",101,101)

"BLD",2650,"KRN","B",409.61,409.61)

"BLD",2650,"KRN","B",771,771)

"BLD",2650,"KRN","B",870,870)

"BLD",2650,"KRN","B",8989.51,8989.51)

"BLD",2650,"KRN","B",8989.52,8989.52)

"BLD",2650,"KRN","B",8994,8994)

"BLD",2650,"QDEF")
^^^^^^^^^^YES
"BLD",2650,"QUES",0)
^9.62^^
"BLD",2650,"REQB",0)
^9.611^2^2
"BLD",2650,"REQB",1,0)
RG*1.0*52^2
"BLD",2650,"REQB",2,0)
RG*1.0*48^2
"BLD",2650,"REQB","B","RG*1.0*48",2)

"BLD",2650,"REQB","B","RG*1.0*52",1)

"MBREQ")
0
"PKG",272,-1)
1^1
"PKG",272,0)
CLINICAL INFO RESOURCE NETWORK^RG^CIRN
"PKG",272,20,0)
^9.402P^^0
"PKG",272,22,0)
^9.49I^1^1
"PKG",272,22,1,0)
1.0^2990430^2990601^12555
"PKG",272,22,1,"PAH",1,0)
54^3091028^12555
"PKG",272,22,1,"PAH",1,1,0)
^^4^4^3091028
"PKG",272,22,1,"PAH",1,1,1,0)
 
"PKG",272,22,1,"PAH",1,1,2,0)
DELETION OF PSEUDO SSN REASON
"PKG",272,22,1,"PAH",1,1,3,0)
Refer to patch RG*1*54 in the FORUM Patch Module for a complete
"PKG",272,22,1,"PAH",1,1,4,0)
description.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","RGADTP2")
0^1^B53164737^B48194022
"RTN","RGADTP2",1,0)
RGADTP2 ;BIR/DLR-ADT PROCESSOR TO RETRIGGER A08 or A04 MESSAGES WITH AL/AL (COMMIT/APPLICATION) ACKNOWLEDGEMENTS - CONTINUED ;10/30/02  10:04
"RTN","RGADTP2",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**27,20,45,44,47,48,49,52,54**;30 Apr 99;Build 4
"RTN","RGADTP2",3,0)
DBIA ;
"RTN","RGADTP2",4,0)
 ;Reference to $$ADD^VAFCEHU1 supported by IA #2753
"RTN","RGADTP2",5,0)
 ;Reference to EDIT^VAFCPTED supported by IA #2784
"RTN","RGADTP2",6,0)
 Q
"RTN","RGADTP2",7,0)
PROCIN(ARRAY,RGLOCAL,RGER,DFN,HL) ;
"RTN","RGADTP2",8,0)
 N RGRSDFN,OTHSITE,NODE,ICN,CMORIEN,CMOR,CMORDISP,SENSTVTY,RMTDOD,LOCDOD,VAFCA,VAFCA08,HERE,BOGUS,ARAY,REP
"RTN","RGADTP2",9,0)
 S REP=$E(HL("ECH"),2)
"RTN","RGADTP2",10,0)
 S HERE=$P($$SITE^VASITE,"^",3)
"RTN","RGADTP2",11,0)
 ;if sending site is your site quit
"RTN","RGADTP2",12,0)
 Q:$G(ARRAY("MPISSITE"))=$G(HERE)
"RTN","RGADTP2",13,0)
 S ARRAY(.097)=$P($$NOW^XLFDT,".")
"RTN","RGADTP2",14,0)
 I $G(ARRAY("ICN"))'="" D
"RTN","RGADTP2",15,0)
 .S RGRSDFN=$$GETDFN^MPIF001(+ARRAY("ICN")) I +RGRSDFN<1 S RGER=RGRSDFN_" ICN#"_$G(ARRAY("ICN")) Q  ;quit and return error msg
"RTN","RGADTP2",16,0)
 .S OTHSITE=ARRAY("SENDING SITE") ;**40 REMOVED THE PLUS TO KEEP SUFFIX ON STATION# & CHANGED THE SITE TO BE SENDING SITE INSTEAD OF AUTHORITATIVE SOURCE
"RTN","RGADTP2",17,0)
 I $G(RGRSDFN)="" S RGRSDFN=$G(DFN)
"RTN","RGADTP2",18,0)
 I $G(RGRSDFN)="" S RGER="-1^DFN not defined"
"RTN","RGADTP2",19,0)
 Q:$G(RGER)
"RTN","RGADTP2",20,0)
 I $G(OTHSITE)="" S OTHSITE=""
"RTN","RGADTP2",21,0)
 S NODE=$$MPINODE^MPIFAPI(RGRSDFN)
"RTN","RGADTP2",22,0)
 S ICN=$P(NODE,"^")
"RTN","RGADTP2",23,0)
 S CMORIEN=$P(NODE,"^",3)
"RTN","RGADTP2",24,0)
 S CMOR=$$NS^XUAF4(CMORIEN)
"RTN","RGADTP2",25,0)
 S CMORDISP=$P(CMOR,"^",1)
"RTN","RGADTP2",26,0)
 S CMOR=$P(CMOR,"^",2)
"RTN","RGADTP2",27,0)
 ;
"RTN","RGADTP2",28,0)
 ;If patient is Sensitive at other site but not here send bulletin
"RTN","RGADTP2",29,0)
 I $G(ARRAY("SENSITIVITY"))'="" S SENSTVTY=$G(ARRAY("SENSITIVITY")) D
"RTN","RGADTP2",30,0)
 .N NAME S NAME=ARRAY("NAME")
"RTN","RGADTP2",31,0)
 .I '$$SENSTIVE^RGRSENS(RGRSDFN),SENSTVTY D
"RTN","RGADTP2",32,0)
 ..S ARAY("SSN")=ARRAY("SSN"),ARAY("SENDING SITE")=ARRAY("SENDING SITE")
"RTN","RGADTP2",33,0)
 ..S ARAY("SENSITIVITY USER")=ARRAY("SENSITIVITY USER"),ARAY("SENSITIVITY DATE")=ARRAY("SENSITIVITY DATE")
"RTN","RGADTP2",34,0)
 ..D SENSTIVE^RGRSBUL1(RGRSDFN,"ARAY",NAME)
"RTN","RGADTP2",35,0)
 ;
"RTN","RGADTP2",36,0)
 ;MPIC_772 - **52; Commented out Remote Date of Death Indicated section.
"RTN","RGADTP2",37,0)
 ;If patient has DATE OF DEATH (DOD) at remote site send bulletin
"RTN","RGADTP2",38,0)
 ;Ignore time if present with date.
"RTN","RGADTP2",39,0)
 ;S RMTDOD=$G(ARRAY("MPIDOD")),RMTDOD=$P(RMTDOD,".")
"RTN","RGADTP2",40,0)
 ;S DFN=RGRSDFN D DEM^VADPT
"RTN","RGADTP2",41,0)
 ;S LOCDOD=$P($P(VADM(6),"^"),".")
"RTN","RGADTP2",42,0)
 ;If there is a remote DOD but no local DOD  OR if remote DOD is different from local DOD, send bulletin
"RTN","RGADTP2",43,0)
 ;I RMTDOD D
"RTN","RGADTP2",44,0)
 ;.N NAME S NAME=ARRAY("NAME"),ARAY("SSN")=ARRAY("SSN"),ARAY("SENDING SITE")=ARRAY("SENDING SITE")
"RTN","RGADTP2",45,0)
 ;.D RMTDOD^RGRSBUL1(RGRSDFN,"ARAY",NAME,RMTDOD,LOCDOD)
"RTN","RGADTP2",46,0)
 ;K VADM
"RTN","RGADTP2",47,0)
 ;
"RTN","RGADTP2",48,0)
NOTLOC I 'RGLOCAL D
"RTN","RGADTP2",49,0)
 .;if sending site is not the CMOR AND NOT THE MPI - log update into PDR if differences exist **45 ADDED MPI
"RTN","RGADTP2",50,0)
 .I (OTHSITE)'=(CMOR)&(OTHSITE'="200M") D  Q
"RTN","RGADTP2",51,0)
 ..S VAFCA=$P($$NOW^XLFDT,".")_"^"_$$NOW^XLFDT_"^"_$G(ARRAY("SENDING SITE"))_"^"_RGRSDFN
"RTN","RGADTP2",52,0)
 ..S ARRAY(.01)=$$FREE^RGRSPARS(ARRAY("NAME")),ARRAY(.03)=$$FREE^RGRSPARS($G(ARRAY("MPIDOB")))
"RTN","RGADTP2",53,0)
 ..S ARRAY(.09)=$$FREE^RGRSPARS($G(ARRAY("SSN"))),ARRAY(.02)=$$SEX^RGRSPARS($G(ARRAY("SEX")))
"RTN","RGADTP2",54,0)
 ..S ARRAY(.2403)=$$FREE^RGRSPARS($G(ARRAY("MMN"))),ARRAY(991.01)=$P($G(ARRAY("ICN")),"V")
"RTN","RGADTP2",55,0)
 ..N ARAY M ARAY(2)=ARRAY
"RTN","RGADTP2",56,0)
 ..S VAFCA08=1  ;S BOGUS=$$ADD^VAFCEHU1(VAFCA,"ARAY") comment out by RG*1*49
"RTN","RGADTP2",57,0)
 .;if sending site is the CMOR OR MPI - synchronize data **45 ADDED MPI AND SSNV TO UPDATED FIELDS
"RTN","RGADTP2",58,0)
 .I (OTHSITE)=(CMOR)!(OTHSITE="200M") D
"RTN","RGADTP2",59,0)
 ..;**44 is there an outstanding edit in the ADT/HL7 PIVOT file for this patient for an identity element
"RTN","RGADTP2",60,0)
 ..S RGER=$$CHKPVT^RGADTP3(.ARRAY) Q:+RGER<0
"RTN","RGADTP2",61,0)
 ..N DR,ARAY2 S RGER=""
"RTN","RGADTP2",62,0)
 ..D DIFF^RGADTP3(.ARRAY,RGRSDFN,.DR,.ARRAY) ;**47
"RTN","RGADTP2",63,0)
 ..I DR'="" D
"RTN","RGADTP2",64,0)
 ...S VAFCA08=1,ARAY(2,.01)=ARRAY("NAME"),ARAY(2,.03)=$G(ARRAY("MPIDOB"))
"RTN","RGADTP2",65,0)
 ...I ARRAY("SSN")'="" S ARAY(2,.09)=$G(ARRAY("SSN")) ;**45 only set SSN to update if it isn't null
"RTN","RGADTP2",66,0)
 ...S ARAY(2,.02)=$G(ARRAY("SEX")),ARAY(2,.2403)=$G(ARRAY("MMN")),ARAY(2,994)=$G(ARRAY("MBI"))
"RTN","RGADTP2",67,0)
 ...;**48 ONLY SET SSN VERIFICATION STATUS AND PSEUDO SSN REASON IF SSN UPDATE WAS SUCCESSFUL
"RTN","RGADTP2",68,0)
 ...I $D(ARRAY("ALIAS")) M ARAY(2,1)=ARRAY("ALIAS") ;**48 ADD ALIAS TO MIX
"RTN","RGADTP2",69,0)
 ...D EDIT^VAFCPTED(RGRSDFN,"ARAY(2)",DR)
"RTN","RGADTP2",70,0)
 ...;check to see if edits were successful, if not set RGER="why it failed"
"RTN","RGADTP2",71,0)
 ...N NAME,SSN,PDOB,SEX,MMN,OLDNAME,OLDHLNAM,OLDMMN,OLDHLMMN,HLNAME,HLMMN,SSNV,MBI
"RTN","RGADTP2",72,0)
 ...S NAME=$$GET1^DIQ(2,+RGRSDFN_",",.01,"I"),PDOB=$$GET1^DIQ(2,+RGRSDFN_",",.03,"I")
"RTN","RGADTP2",73,0)
 ...S SSN=$$GET1^DIQ(2,+RGRSDFN_",",.09,"I"),SEX=$$GET1^DIQ(2,+RGRSDFN_",",.02,"I")
"RTN","RGADTP2",74,0)
 ...S MMN=$$GET1^DIQ(2,+RGRSDFN_",",.2403,"I"),MBI=$$GET1^DIQ(2,+RGRSDFN_",",994,"I")
"RTN","RGADTP2",75,0)
 ...D STDNAME^XLFNAME(.NAME,"F",.OLDNAME) S HLNAME=ARRAY("NAME") D STDNAME^XLFNAME(.HLNAME,"F",.OLDHLNAM)
"RTN","RGADTP2",76,0)
 ...I NAME'=$G(HLNAME) S RGER=$S($G(RGER)'="":$G(RGER)_REP,1:"-1^")_"Name field failure"
"RTN","RGADTP2",77,0)
 ...I PDOB'=$G(ARRAY("MPIDOB")) S RGER=$S($G(RGER)'="":$G(RGER)_REP,1:"-1^")_"DOB field failure"
"RTN","RGADTP2",78,0)
 ...;**48
"RTN","RGADTP2",79,0)
 ...I SSN["P" D
"RTN","RGADTP2",80,0)
 ....;if pseudo SSN reason field has been added to the DD then attempt to set it
"RTN","RGADTP2",81,0)
 ....N PS,ERROR,LABEL D FIELD^DID(2,.0906,"","LABEL","LABEL","ERROR") I '$D(ERROR("DIERR"))&$D(LABEL("LABEL")) D
"RTN","RGADTP2",82,0)
 .....S ARAY2(2,.0906)=$G(ARRAY(.0906)),DR=".0906;" D EDIT^VAFCPTED(RGRSDFN,"ARAY2(2)",DR)
"RTN","RGADTP2",83,0)
 .....S PS=$$GET1^DIQ(2,+RGRSDFN_",",.0906,"I")
"RTN","RGADTP2",84,0)
 .....I PS=""&(ARAY2(2,.0906)="@") Q
"RTN","RGADTP2",85,0)
 .....I PS'=ARAY2(2,.0906) S RGER=$S($G(RGER)'="":$G(RGER)_REP,1:"-1^")_"Pseudo SSN Reason field failure"
"RTN","RGADTP2",86,0)
 .....I PS=ARAY2(2,.0906) D
"RTN","RGADTP2",87,0)
 ......K ARAY2 N ERROR,LABEL D FIELD^DID(2,.0907,"","LABEL","LABEL","ERROR") I '$D(ERROR("DIERR"))&$D(LABEL("LABEL")) D
"RTN","RGADTP2",88,0)
 ......S ARAY2(2,.0907)=$G(ARRAY(.0907)),DR=".0907;" D EDIT^VAFCPTED(RGRSDFN,"ARAY2(2)",DR)
"RTN","RGADTP2",89,0)
 ......S SSNV=$$GET1^DIQ(2,+RGRSDFN_",",.0907,"I")
"RTN","RGADTP2",90,0)
 ......S:$G(ARRAY(.0907))="@" ARRAY(.0907)="" I SSNV'=$G(ARRAY(.0907)) S RGER=$S($G(RGER)'="":$G(RGER)_REP,1:"-1^")_"SSN VERIFICATION field failure"
"RTN","RGADTP2",91,0)
 ...I $G(ARRAY("SSN"))'="",$G(ARRAY("SSN"))'="@",SSN'=$G(ARRAY("SSN")) D
"RTN","RGADTP2",92,0)
 ....;**54 mpic_1556 added array("ssn")'="@"
"RTN","RGADTP2",93,0)
 ....I $G(ARRAY("SSN"))="P",SSN["P" Q  ;**47 NEEDED TO CREATE PSEUDO AND DID
"RTN","RGADTP2",94,0)
 ....S RGER=$S($G(RGER)'="":$G(RGER)_REP,1:"-1^")_"SSN field failure" ;**45 only check if SSN is sent isn't null
"RTN","RGADTP2",95,0)
 ...I SSN=$G(ARRAY("SSN")) D
"RTN","RGADTP2",96,0)
 ....;if SSN VERIFICATION STATUS field has been added to the DD then attempt to set it
"RTN","RGADTP2",97,0)
 ....K ARAY2 N ERROR,LABEL D FIELD^DID(2,.0907,"","LABEL","LABEL","ERROR") I '$D(ERROR("DIERR"))&$D(LABEL("LABEL")) D
"RTN","RGADTP2",98,0)
 .....S ARAY2(2,.0907)=$G(ARRAY(.0907)) S DR=".0907;" D EDIT^VAFCPTED(RGRSDFN,"ARAY2(2)",DR)
"RTN","RGADTP2",99,0)
 .....S SSNV=$$GET1^DIQ(2,+RGRSDFN_",",.0907,"I")
"RTN","RGADTP2",100,0)
 .....S:$G(ARRAY(.0907))="@" ARRAY(.0907)="" I SSNV'=$G(ARRAY(.0907)) S RGER=$S($G(RGER)'="":$G(RGER)_REP,1:"-1^")_"SSN VERIFICATION field failure"
"RTN","RGADTP2",101,0)
 .....I SSNV'="" D
"RTN","RGADTP2",102,0)
 ......N PS,ERROR,LABEL D FIELD^DID(2,.0906,"","LABEL","LABEL","ERROR") I '$D(ERROR("DIERR"))&$D(LABEL("LABEL")) D
"RTN","RGADTP2",103,0)
 ......S ARAY2(2,.0906)=$G(ARRAY(.0906)) S DR=".0906;" D EDIT^VAFCPTED(RGRSDFN,"ARAY2(2)",DR)
"RTN","RGADTP2",104,0)
 ......S PS=$$GET1^DIQ(2,+RGRSDFN_",",.0906,"I")
"RTN","RGADTP2",105,0)
 ......I PS=""&(ARAY2(2,.0906)="@") Q
"RTN","RGADTP2",106,0)
 ......S RGER=$S($G(RGER)'="":$G(RGER)_REP,1:"-1^")_"Pseudo SSN Reason field failure"
"RTN","RGADTP2",107,0)
 ...;**54 Need to see if should delete pseudo ssn reason if SSN isn't a pseudo and there is a pseudo reason, delete it.
"RTN","RGADTP2",108,0)
 ...I SSN'["P" N PS,ERROR,LABEL D FIELD^DID(2,.0906,"","LABEL","LABEL","ERROR") I '$D(ERROR("DIERR"))&$D(LABEL("LABEL")) D
"RTN","RGADTP2",109,0)
 ....S PS=$$GET1^DIQ(2,+RGRSDFN_",",.0906,"I")
"RTN","RGADTP2",110,0)
 ....I PS'=""  S ARAY2(2,.0906)="@",DR=".0906;" D EDIT^VAFCPTED(RGRSDFN,"ARAY2(2)",DR)
"RTN","RGADTP2",111,0)
 ...I SEX'=$G(ARRAY("SEX")) S RGER=$S($G(RGER)'="":$G(RGER)_REP,1:"-1^")_"SEX field failure"
"RTN","RGADTP2",112,0)
 ...D STDNAME^XLFNAME(.MMN,"F",.OLDMMN) S HLMMN=ARRAY("MMN") D STDNAME^XLFNAME(.HLMMN,"F",.OLDHLMMN)
"RTN","RGADTP2",113,0)
 ...I MMN'=$G(HLMMN) S RGER=$S($G(RGER)'="":$G(RGER)_REP,1:"-1^")_"MOTHER'S MAIDEN NAME field failure"
"RTN","RGADTP2",114,0)
 ...;**REMOVED MBI FROM PATCH 45 PUT BACK IN **47
"RTN","RGADTP2",115,0)
 ...I MBI'=$G(ARRAY("MBI")) D
"RTN","RGADTP2",116,0)
 ....Q:MBI=""&($G(ARRAY("MBI"))="@")  ;**47 "" AND @ ARE THE SAME
"RTN","RGADTP2",117,0)
 ....S RGER=$S($G(RGER)'="":$G(RGER)_REP,1:"-1^")_"MULTIPLE BIRTH INDICATOR field failure"
"RTN","RGADTP2",118,0)
 ...;send the updated fields to the MPI to synch site with MPI
"RTN","RGADTP2",119,0)
 ...I HL("ETN")'="A31" S ZTSAVE("DFN")="",ZTRTN="MPISYN^RGADTPC",ZTDESC="Sending Synchronized Patient Data to MPI...",ZTIO="RG QUEUE",ZTDTH=$H D ^%ZTLOAD
"RTN","RGADTP2",120,0)
 ...;**45 ^ don't trigger A31 sync message if A31 was being processed-- ack to a31 will sync id elements on MPI
"RTN","RGADTP2",121,0)
 Q
"RTN","RGEX03")
0^2^B81303188^B69509022
"RTN","RGEX03",1,0)
RGEX03 ;BAY/ALS-LIST MANAGER FOR MPI/PD EXCEPTIONS ;10/13/99
"RTN","RGEX03",2,0)
 ;;1.0;CLINICAL INFO RESOURCE NETWORK;**3,12,19,23,27,30,38,39,43,44,48,54**;30 Apr 99;Build 4
"RTN","RGEX03",3,0)
 ;
"RTN","RGEX03",4,0)
 ;Reference to START^VAFCPDAT supported by IA #3299
"RTN","RGEX03",5,0)
 ;Reference to ^DIA(2 supported by IA #2097
"RTN","RGEX03",6,0)
 ;Reference to ^DPT( supported by IA #2969
"RTN","RGEX03",7,0)
 ;Reference to HINQ^DG10 supported by IA #2076
"RTN","RGEX03",8,0)
 ;Reference to CIRNEXC^MPIFQ0 supported by IA #2942
"RTN","RGEX03",9,0)
 ;Reference to VTQ^MPIFSAQ supported by IA #2941
"RTN","RGEX03",10,0)
 ;Reference to NOTICE^DGSEC4 and PTSEC^DGSEC4 supported by IA#3027
"RTN","RGEX03",11,0)
 ;Reference to POT^MPIFDUP supported by IA #4464
"RTN","RGEX03",12,0)
 ;Reference to $$NCEDIT^DPTNAME supported by private IA #4116
"RTN","RGEX03",13,0)
 ;
"RTN","RGEX03",14,0)
EN(DATA) ; -- main entry point for RG EXCPT ACTION
"RTN","RGEX03",15,0)
 D EN^VALM("RG EXCPT ACTION")
"RTN","RGEX03",16,0)
 Q
"RTN","RGEX03",17,0)
HDR ; -- header code
"RTN","RGEX03",18,0)
 S VALMHDR(1)="MPI/PD EXCEPTION HANDLING ACTIONS.",VALMHDR(2)=""
"RTN","RGEX03",19,0)
 Q
"RTN","RGEX03",20,0)
INIT ; -- init variables and list array
"RTN","RGEX03",21,0)
 K ^TMP("RGEXC2",$J)
"RTN","RGEX03",22,0)
 K @VALMAR
"RTN","RGEX03",23,0)
 I DATA="" Q
"RTN","RGEX03",24,0)
 S STR="",LIN=1,STATUS="",NAME="",DOB="",SSN="",DFN="",CHKSM="" ;**44
"RTN","RGEX03",25,0)
 S NAME=$P(DATA,"^",1),DOB=$P(DATA,"^",8),SSN=$P(DATA,"^",2)
"RTN","RGEX03",26,0)
 S DFN=$P(DATA,"^",5),CHKSM=$P($G(^DPT(DFN,"MPI")),"^",2) ;**44
"RTN","RGEX03",27,0)
 S STR=$$SETSTR^VALM1("Name:",STR,6,6),STR=$$SETSTR^VALM1(NAME,STR,14,30) D ADDTMP
"RTN","RGEX03",28,0)
 S STR=$$SETSTR^VALM1(" SSN:",STR,6,6),STR=$$SETSTR^VALM1(SSN,STR,14,12) D ADDTMP
"RTN","RGEX03",29,0)
 S STR=$$SETSTR^VALM1(" DOB:",STR,6,6),STR=$$SETSTR^VALM1(DOB,STR,14,20) D ADDTMP
"RTN","RGEX03",30,0)
 S STR=$$SETSTR^VALM1(" DFN:",STR,6,6),STR=$$SETSTR^VALM1(DFN,STR,14,12) D ADDTMP ;**44
"RTN","RGEX03",31,0)
 S STR=$$SETSTR^VALM1(" ICN:",STR,6,6),ICN="" S ICN=$P(DATA,"^",6) I ICN<0 S ICN=""
"RTN","RGEX03",32,0)
 S STR=$$SETSTR^VALM1(ICN_($S(CHKSM="":"",1:"V"_CHKSM)),STR,14,20) D ADDTMP ;**44
"RTN","RGEX03",33,0)
 S STR=$$SETSTR^VALM1("Date of Death:",STR,6,20),STR=$$SETSTR^VALM1($P(DATA,"^",13),STR,26,20) D ADDTMP
"RTN","RGEX03",34,0)
 S STR=$$SETSTR^VALM1("Exception Type:",STR,6,20),STR=$$SETSTR^VALM1($P(DATA,"^",4),STR,26,50) D ADDTMP
"RTN","RGEX03",35,0)
 S STR=$$SETSTR^VALM1("Exception Date:",STR,6,20),STR=$$SETSTR^VALM1($P(DATA,"^",3),STR,26,30) D ADDTMP
"RTN","RGEX03",36,0)
 S STATUS=$P(DATA,"^",9)
"RTN","RGEX03",37,0)
 I STATUS<1 S STATUS="NOT PROCESSED"
"RTN","RGEX03",38,0)
 E  S STATUS="PROCESSED"
"RTN","RGEX03",39,0)
 S STR=$$SETSTR^VALM1("Exception Status:",STR,6,20),STR=$$SETSTR^VALM1(STATUS,STR,26,15) D ADDTMP
"RTN","RGEX03",40,0)
 ;Added Exception Text to Exception Handler, patch 39
"RTN","RGEX03",41,0)
 N IEN,IEN2,X K ^UTILITY($J,"W") S IEN=$P(DATA,"^",10),IEN2=$P(DATA,"^",11)
"RTN","RGEX03",42,0)
 I IEN'=""!(IEN2'="") D
"RTN","RGEX03",43,0)
 .S EXCTEXT=$P($G(^RGHL7(991.1,IEN,1,IEN2,10)),"^",1) Q:EXCTEXT=""
"RTN","RGEX03",44,0)
 .S STR=$$SETSTR^VALM1("Exception Text:",STR,6,20)
"RTN","RGEX03",45,0)
 .S X=EXCTEXT,DIWL=1,DIWR=50,DIWF="|" D ^DIWP
"RTN","RGEX03",46,0)
 .F N=1:1:$P($G(^UTILITY($J,"W",1)),1) D  Q:'N
"RTN","RGEX03",47,0)
 ..S STR=$$SETSTR^VALM1(^UTILITY($J,"W",1,(N),0),STR,26,76)
"RTN","RGEX03",48,0)
 ..D ADDTMP
"RTN","RGEX03",49,0)
ADDNOTE ;Display Exception Notes, Word Processing field
"RTN","RGEX03",50,0)
 S STR=$$SETSTR^VALM1("Exception Notes:",STR,6,20) D ADDTMP
"RTN","RGEX03",51,0)
 N IEN,IEN2,IENS,N,NOTE
"RTN","RGEX03",52,0)
 S IEN=$P(DATA,"^",10),IEN2=$P(DATA,"^",11),IENS=IEN2_","_IEN_",",N=$$GET1^DIQ(991.12,IENS,11,"","NT")
"RTN","RGEX03",53,0)
 S L=0 F  S L=$O(NT(L)) Q:'L  S NOTE=NT(L),STR=$$SETSTR^VALM1(NOTE,STR,6,74) D ADDTMP
"RTN","RGEX03",54,0)
 S VALMCNT=LIN-1,DFN=$P(DATA,"^",5),VAFCDFN=DFN
"RTN","RGEX03",55,0)
 K L,NT
"RTN","RGEX03",56,0)
 Q
"RTN","RGEX03",57,0)
ADDTMP ;
"RTN","RGEX03",58,0)
 S ^TMP("RGEXC2",$J,LIN,0)=STR,^TMP("RGEXC2",$J,"IDX",LIN,LIN)="",LIN=LIN+1,STR=""
"RTN","RGEX03",59,0)
 Q
"RTN","RGEX03",60,0)
UPD ;
"RTN","RGEX03",61,0)
 N PROCDT,%,X,%I,%H
"RTN","RGEX03",62,0)
 W !,"This option updates the exception status to PROCESSED.",!,"After it is processed it will not be listed in the summary."
"RTN","RGEX03",63,0)
 S DIR("A")="Are you sure you want to change the status? ",DIR(0)="YA",DIR("B")="YES"
"RTN","RGEX03",64,0)
 D ^DIR Q:$D(DIRUT)  I Y>0 D
"RTN","RGEX03",65,0)
 .;**48 populating the date/time marked as processed and who marked it as processed
"RTN","RGEX03",66,0)
 .D NOW^%DTC S PROCDT=%
"RTN","RGEX03",67,0)
 .S IEN="",IEN2="",IEN=$P(DATA,"^",10),IEN2=$P(DATA,"^",11) L +^RGHL7(991.1,IEN):10
"RTN","RGEX03",68,0)
 .S DA(1)=IEN,DA=IEN2,DR="6///"_1_";7///"_PROCDT_";8///"_$G(DUZ),DIE="^RGHL7(991.1,"_DA(1)_",1," D ^DIE K DIE,DA,DR
"RTN","RGEX03",69,0)
 .L -^RGHL7(991.1,IEN) S $P(DATA,"^",9)=1
"RTN","RGEX03",70,0)
 .D INIT
"RTN","RGEX03",71,0)
 K DIR,DIRUT S VALMBCK="R"
"RTN","RGEX03",72,0)
 Q
"RTN","RGEX03",73,0)
PA ;Patient Audit
"RTN","RGEX03",74,0)
 S PDFN=DFN
"RTN","RGEX03",75,0)
 I '$O(^DIA(2,"B",VAFCDFN,0)) S VALMSG="This patient has no audit data available.",VALMBCK="" G PAQ
"RTN","RGEX03",76,0)
 N IEN S DFN=VAFCDFN,QFLG=1 D FULL^VALM1 D:$T(ASK2^RGMTAUD)]"" ASK2^RGMTAUD S VALMBCK="R"
"RTN","RGEX03",77,0)
 S DFN=PDFN K QFLG,PDFN
"RTN","RGEX03",78,0)
PAQ Q
"RTN","RGEX03",79,0)
HI ;Hinq Inquiry
"RTN","RGEX03",80,0)
 S VALMBCK="" D HINQ^DG10 D PAUSE^VALM1 S VALMBCK="R"
"RTN","RGEX03",81,0)
 Q
"RTN","RGEX03",82,0)
DISP ; Display Only Query
"RTN","RGEX03",83,0)
 S VALMBCK="" D FULL^VALM1
"RTN","RGEX03",84,0)
 S MPIVAR("DFN")=DFN,MPIVAR("SSN")=SSN,MPIVAR("NM")=NAME,MPIVAR("DOB")=$P($P(DATA,"^",7),".",1)
"RTN","RGEX03",85,0)
 D VTQ^MPIFSAQ(.MPIVAR) D PAUSE^VALM1
"RTN","RGEX03",86,0)
 S VALMBCK="R" K MPIVAR
"RTN","RGEX03",87,0)
 Q
"RTN","RGEX03",88,0)
 ;
"RTN","RGEX03",89,0)
POT ;Potential Match on MPI, Query MPI, resolve duplicate if needed. **43 Added this entry point
"RTN","RGEX03",90,0)
 D POT^MPIFDUP
"RTN","RGEX03",91,0)
 D INIT S VALMBCK="R" K PROCESS
"RTN","RGEX03",92,0)
 Q
"RTN","RGEX03",93,0)
 ;
"RTN","RGEX03",94,0)
REJ ;Primary View Reject. **44 Added entry point
"RTN","RGEX03",95,0)
 D REJ^RGPVREJ
"RTN","RGEX03",96,0)
 D INIT S VALMBCK="R"
"RTN","RGEX03",97,0)
 Q
"RTN","RGEX03",98,0)
 ;
"RTN","RGEX03",99,0)
MPIPV ;MPI Primary View PDAT. **48 Added entry point
"RTN","RGEX03",100,0)
 S SAPV=0 ;from EH, not stand alone option
"RTN","RGEX03",101,0)
 D SEND^RGPVMPI
"RTN","RGEX03",102,0)
 D INIT S VALMBCK="R"
"RTN","RGEX03",103,0)
 Q
"RTN","RGEX03",104,0)
 ;
"RTN","RGEX03",105,0)
LOAD ; Edit Patient Data, if patient's eligibility is verified - check for DG ELIGIBILITY key for user
"RTN","RGEX03",106,0)
 S VALMBCK="",DATAOLD=""
"RTN","RGEX03",107,0)
 D FULL^VALM1 D ELIG^VADPT
"RTN","RGEX03",108,0)
 I $P(VAEL(8),"^",1)="V" D
"RTN","RGEX03",109,0)
 .I '$D(^XUSEC("DG ELIGIBILITY",DUZ)) D
"RTN","RGEX03",110,0)
 ..W !!,"Eligibility has been verified for this patient.",!!,"You do not have access to edit the Name, Date of ",!,"Birth or Social Security Number for this patient."
"RTN","RGEX03",111,0)
 ..D PAUSE^VALM1 S VALMBCK="R"
"RTN","RGEX03",112,0)
 .E  D SENS
"RTN","RGEX03",113,0)
 E  D SENS
"RTN","RGEX03",114,0)
 Q
"RTN","RGEX03",115,0)
SENS ; check for patient sensitivity and user security
"RTN","RGEX03",116,0)
 N RESULT,RGSEN
"RTN","RGEX03",117,0)
 D PTSEC^DGSEC4(.RESULT,DFN,0,"RG EXCEPTION HANDLING^MPI/PD Exception Handling")
"RTN","RGEX03",118,0)
 I RESULT(1)=-1 W !!,"Access denied: Required parameters not defined" D PAUSE^VALM1 S VALMBCK="R" Q
"RTN","RGEX03",119,0)
 I RESULT(1)>0 W !!?15,"***PATIENT MARKED SENSITIVE***"
"RTN","RGEX03",120,0)
 I RESULT(1)=3 W !!?15,"Access not allowed on your own PATIENT (#2) file entry" D PAUSE^VALM1 S VALMBCK="R" Q
"RTN","RGEX03",121,0)
 I RESULT(1)=4 W !!?15,"Access denied: Your SSN is not defined" D PAUSE^VALM1 S VALMBCK="R" Q
"RTN","RGEX03",122,0)
 I RESULT(1)<3 D
"RTN","RGEX03",123,0)
 .I RESULT(1)=1 D NOTICE^DGSEC4(.RGSEN,DFN,"RG EXCEPTION HANDLING^MPI/PD Exception Handling",2)
"RTN","RGEX03",124,0)
 .I RESULT(1)=2 D NOTICE^DGSEC4(.RGSEN,DFN,"RG EXCEPTION HANDLING^MPI/PD Exception Handling",3)
"RTN","RGEX03",125,0)
 D EDIT
"RTN","RGEX03",126,0)
 Q
"RTN","RGEX03",127,0)
EDIT ; edit patient data
"RTN","RGEX03",128,0)
 S ACCESS=0
"RTN","RGEX03",129,0)
 D REC
"RTN","RGEX03",130,0)
 Q:ACCESS=0
"RTN","RGEX03",131,0)
 S DIE="^DPT(",DA=DFN,DR=".01///^S X=$$NCEDIT^DPTNAME(DA);.03//^S X=DOB;.09//^S X=SSN"
"RTN","RGEX03",132,0)
 L +^DPT(DFN):10 D ^DIE K DIE,DA,DR L -^DPT(DFN)
"RTN","RGEX03",133,0)
 S DATAOLD=DATA
"RTN","RGEX03",134,0)
 D DEATH
"RTN","RGEX03",135,0)
 D DEM^VADPT
"RTN","RGEX03",136,0)
 S DATA=VADM(1)_"^"_$P($G(VADM(2)),"^",1)_"^"_$P(DATAOLD,"^",3)_"^"_$P(DATAOLD,"^",4)_"^"_DFN_"^"_$P(DATAOLD,"^",6)_"^"
"RTN","RGEX03",137,0)
 S DATA=DATA_$G(VADM(3))_"^"_$P(DATAOLD,"^",9)_"^"_$P(DATAOLD,"^",10)_"^"_$P(DATAOLD,"^",11)_"^"_$P(DATAOLD,"^",12)_"^"_$P($G(VADM(6)),"^",2)
"RTN","RGEX03",138,0)
 D INIT
"RTN","RGEX03",139,0)
 S VALMBCK="R"
"RTN","RGEX03",140,0)
 K DGNEW,DATAOLD,VAEL,ACCESS,DGNPSSN
"RTN","RGEX03",141,0)
QUIT Q
"RTN","RGEX03",142,0)
REC ; Check if user is attempting to access own record
"RTN","RGEX03",143,0)
 ; check for security key
"RTN","RGEX03",144,0)
 I $D(^XUSEC("DG RECORD ACCESS",+DUZ)) S ACCESS=1 Q
"RTN","RGEX03",145,0)
 S DGNPSSN=$$GET1^DIQ(200,+DUZ_",",9,"I","","DGNPERR")
"RTN","RGEX03",146,0)
 I 'DGNPSSN D  Q
"RTN","RGEX03",147,0)
 .W !!,"Your SSN is missing from the NEW PERSON file.",!,"Contact your ADP Coordinator."
"RTN","RGEX03",148,0)
 .D PAUSE^VALM1 S VALMBCK="R"
"RTN","RGEX03",149,0)
 I DGNPSSN=SSN D  Q
"RTN","RGEX03",150,0)
 .W !!,"Security regulations prohibit computer access to your",!,"own medical record."
"RTN","RGEX03",151,0)
 .D PAUSE^VALM1 S VALMBCK="R"
"RTN","RGEX03",152,0)
 E  S ACCESS=1
"RTN","RGEX03",153,0)
 Q
"RTN","RGEX03",154,0)
DEATH ; Check for access to edit date of death
"RTN","RGEX03",155,0)
 I $D(^XUSEC("DG DETAIL",+DUZ)) D
"RTN","RGEX03",156,0)
 .K VADM,DIE,DA,DR
"RTN","RGEX03",157,0)
 .S (DOD1,DOD2,SRS)=""
"RTN","RGEX03",158,0)
 .D DEM^VADPT
"RTN","RGEX03",159,0)
 .S DOD1=$P($G(VADM(6)),"^",2) ;DOD original value
"RTN","RGEX03",160,0)
 .S DIC="2",DA=DFN,DR=".353",DIQ(0)="E" D EN^DIQ1 ;**54
"RTN","RGEX03",161,0)
 .S SRS=$G(^UTILITY("DIQ1",$J,2,DA,.353,"E")) ;source of notification original value
"RTN","RGEX03",162,0)
 .S DIE="^DPT(",DA=DFN,DR=".351//^S X=DOD1" D DIEC ;ask DOD, prompt with original value
"RTN","RGEX03",163,0)
 .;was a change made to DOD?
"RTN","RGEX03",164,0)
 .D DEM^VADPT
"RTN","RGEX03",165,0)
 .S DOD2=$P($G(VADM(6)),"^",2) D  ;DOD value after DIE call
"RTN","RGEX03",166,0)
 ..I DOD1="",DOD2="" Q  ;original and added DOD both null; don't prompt for .353
"RTN","RGEX03",167,0)
 ..I DOD1'="",DOD2="" S DIE="^DPT(",DA=DFN,DR=".353////@" D DIEC Q  ;DOD now null - deleted; remove source field
"RTN","RGEX03",168,0)
 ..;Else DOD added or changed; so prompt for source
"RTN","RGEX03",169,0)
 ..I (DOD1=""&DOD2'="")!(DOD1'=DOD2) D
"RTN","RGEX03",170,0)
 ...S DIE="^DPT(",DA=DFN,DR=".353//^S X=SRS" D DIEC Q
"RTN","RGEX03",171,0)
 E  W !!,"You do not have the proper security to edit date of death." D PAUSE^VALM1 D INIT S VALMBCK="R"
"RTN","RGEX03",172,0)
 K VADM,DIE,DA,DR,DOD1,DOD2,SRS,X,Y
"RTN","RGEX03",173,0)
 Q
"RTN","RGEX03",174,0)
 ;
"RTN","RGEX03",175,0)
DIEC ;Do the ^DIE call from the DEATH module
"RTN","RGEX03",176,0)
 L +^DPT(DFN):10
"RTN","RGEX03",177,0)
 D ^DIE
"RTN","RGEX03",178,0)
 L -^DPT(DFN)
"RTN","RGEX03",179,0)
 Q
"RTN","RGEX03",180,0)
 ;
"RTN","RGEX03",181,0)
INQ ; Patient Inquiry
"RTN","RGEX03",182,0)
 S VALMBCK=""
"RTN","RGEX03",183,0)
 D FULL^VALM1 D EN^DGRPD D PAUSE^VALM1 D CLEAN^VALM10 D INIT
"RTN","RGEX03",184,0)
 S VALMBCK="R"
"RTN","RGEX03",185,0)
 Q
"RTN","RGEX03",186,0)
EDTNOT ; Edit Exception Notes
"RTN","RGEX03",187,0)
 S IEN=$P(DATA,"^",10),IEN2=$P(DATA,"^",11)
"RTN","RGEX03",188,0)
 L +^RGHL7(991.1,IEN):10 S DIE="^RGHL7(991.1,"_IEN_",1,",DA(1)=IEN,DA=IEN2,DR="11" D ^DIE L -^RGHL7(991.1,IEN)
"RTN","RGEX03",189,0)
 K DIE,DA,DR,IEN,IEN2
"RTN","RGEX03",190,0)
 D INIT
"RTN","RGEX03",191,0)
 S VALMBCK="R"
"RTN","RGEX03",192,0)
 Q
"RTN","RGEX03",193,0)
PDAT S VALMBCK="",PICN="",PSSN=""
"RTN","RGEX03",194,0)
 I $D(SSN) S PSSN=SSN
"RTN","RGEX03",195,0)
 S ARRAY="^TMP(""RGXHFS"","_$J_")",TYPE="I",REP=1,RGXDIR=$$GET^XPAR("SYS","RGX HFS SCRATCH"),RGXFILE="RGX"_DUZ_".DAT"
"RTN","RGEX03",196,0)
 S IOM=132,IOSL=99999,IOST="P-DUMMY",IOF=""""""
"RTN","RGEX03",197,0)
 D OPEN^%ZISH("RGX",RGXDIR,RGXFILE,"W") Q:POP
"RTN","RGEX03",198,0)
 U IO
"RTN","RGEX03",199,0)
 I ICN'="" S PICN=ICN D START^VAFCPDAT
"RTN","RGEX03",200,0)
 N RGXDEL
"RTN","RGEX03",201,0)
 D CLOSE^%ZISH("RGX")
"RTN","RGEX03",202,0)
 K ^TMP("RGPDAT",$J)
"RTN","RGEX03",203,0)
 S RGXDEL(RGXFILE)="",X=$$FTG^%ZISH(RGXDIR,RGXFILE,$NAME(^TMP("RGPDAT",$J,1)),3),X=$$DEL^%ZISH(RGXDIR,$NA(RGXDEL))
"RTN","RGEX03",204,0)
 I $D(^TMP("RGPDAT",$J)) D EN^RGEX04
"RTN","RGEX03",205,0)
 S ICN=PICN,SSN=PSSN
"RTN","RGEX03",206,0)
 D INIT
"RTN","RGEX03",207,0)
 S VALMBCK="R" K PICN,PSSN,ARRAY,REP,RGXDIR,RGXFILE,TYPE
"RTN","RGEX03",208,0)
 Q
"RTN","RGEX03",209,0)
GETEX(RETURN,DFN) ; Get array of pending exceptions for a patient
"RTN","RGEX03",210,0)
 K RETURN
"RTN","RGEX03",211,0)
 S CNT=0,RETURN(0)="0^No Pending Exceptions",TYP=""
"RTN","RGEX03",212,0)
 I 'DFN S RETURN(0)="-1^DFN not passed" G QGET
"RTN","RGEX03",213,0)
 F  S TYP=$O(^RGHL7(991.1,"ADFN",TYP)) Q:'TYP  D
"RTN","RGEX03",214,0)
 .I $D(^RGHL7(991.1,"ADFN",TYP,DFN)) D
"RTN","RGEX03",215,0)
 ..S IEN="" F  S IEN=$O(^RGHL7(991.1,"ADFN",TYP,DFN,IEN)) Q:'IEN  D
"RTN","RGEX03",216,0)
 ...S IEN2="",ETYP="" F  S IEN2=$O(^RGHL7(991.1,"ADFN",TYP,DFN,IEN,IEN2)) Q:'IEN2  D
"RTN","RGEX03",217,0)
 ....I $P(^RGHL7(991.1,IEN,1,IEN2,0),"^",5)<1 D
"RTN","RGEX03",218,0)
 .....S CNT=CNT+1,ETYP=$P(^RGHL7(991.11,TYP,10),"^",1)
"RTN","RGEX03",219,0)
 .....S RETURN(CNT)=ETYP_"^"_IEN_"^"_IEN2
"RTN","RGEX03",220,0)
 I CNT>0 S RETURN(0)=CNT_"^Pending Exception(s)"
"RTN","RGEX03",221,0)
QGET ;
"RTN","RGEX03",222,0)
 K TYP,ETYP,IEN,IEN2,CNT
"RTN","RGEX03",223,0)
 Q
"RTN","RGEX03",224,0)
HELP ; -- help code
"RTN","RGEX03",225,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","RGEX03",226,0)
 Q
"RTN","RGEX03",227,0)
EXIT ; -- exit code
"RTN","RGEX03",228,0)
 S VALMBCK="" K ^TMP("RGEXC2",$J),CHKSM,DFN,DIR,EXCTEXT,IEN,IEN2,NAME,DOB,SSN,LIN,STATUS,STR,VAFCDFN,X,Y
"RTN","RGEX03",229,0)
 S VALMBCK="R",RGBG=1
"RTN","RGEX03",230,0)
 Q
"RTN","RGEX03",231,0)
EXPND ; -- expand code
"RTN","RGEX03",232,0)
 Q
"VER")
8.0^22.0
"BLD",2650,6)
^54
**END**
**END**
