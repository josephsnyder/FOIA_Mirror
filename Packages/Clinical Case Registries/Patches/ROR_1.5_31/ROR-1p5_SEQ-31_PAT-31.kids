Released ROR*1.5*31 SEQ #31
Extracted from mail message
**KIDS**:ROR*1.5*31^

**INSTALL NAME**
ROR*1.5*31
"BLD",10244,0)
ROR*1.5*31^CLINICAL CASE REGISTRIES^0^3171203^y
"BLD",10244,1,0)
^^2^2^3171019^^
"BLD",10244,1,1,0)
The description of this build can be found in the National Patch Module 
"BLD",10244,1,2,0)
under ROR*1.5*31.
"BLD",10244,4,0)
^9.64PA^799.51^5
"BLD",10244,4,798.1,0)
798.1
"BLD",10244,4,798.1,222)
n^n^f^^y^^y^o^n
"BLD",10244,4,798.1,224)
N ROR S ROR=$P(^(0),U) I ROR["VA MOVEMENT DISORDERS"!(ROR["VA ADRENAL ADENOMA")
"BLD",10244,4,798.2,0)
798.2
"BLD",10244,4,798.2,222)
n^n^f^^y^^y^o^n
"BLD",10244,4,798.2,224)
N ROR S ROR=$P(^(0),U) I ROR["VA MOVEMENT DISORDERS"!(ROR["VA ADRENAL ADENOMA")
"BLD",10244,4,798.5,0)
798.5
"BLD",10244,4,798.5,2,0)
^9.641^798.52^2
"BLD",10244,4,798.5,2,798.5,0)
ROR ICD SEARCH  (File-top level)
"BLD",10244,4,798.5,2,798.5,1,0)
^9.6411^^
"BLD",10244,4,798.5,2,798.52,0)
ICD PROCEDURE CODE  (sub-file)
"BLD",10244,4,798.5,2,798.52,1,0)
^9.6411^^
"BLD",10244,4,798.5,222)
y^n^p^^^^n^^n
"BLD",10244,4,798.5,224)

"BLD",10244,4,799.31,0)
799.31
"BLD",10244,4,799.31,222)
n^n^f^^n^^y^o^n
"BLD",10244,4,799.31,224)
N ROR S ROR=$P(^(0),U) I ROR="PACT"!(ROR="PCP")!(ROR="AGE_RANGE")
"BLD",10244,4,799.51,0)
799.51
"BLD",10244,4,799.51,222)
n^n^f^^y^^y^o^n
"BLD",10244,4,799.51,224)
N ROR S ROR=$P($G(^(0)),U) I ROR="SOFOSBUVIR/VELPATASVIR/VOXILAP"
"BLD",10244,4,"APDD",798.5,798.5)

"BLD",10244,4,"APDD",798.5,798.52)

"BLD",10244,4,"B",798.1,798.1)

"BLD",10244,4,"B",798.2,798.2)

"BLD",10244,4,"B",798.5,798.5)

"BLD",10244,4,"B",799.31,799.31)

"BLD",10244,4,"B",799.51,799.51)

"BLD",10244,6.3)
62
"BLD",10244,"ABPKG")
n
"BLD",10244,"INI")
PRE^RORP031
"BLD",10244,"INIT")
POST^RORP031
"BLD",10244,"KRN",0)
^9.67PA^779.2^20
"BLD",10244,"KRN",.4,0)
.4
"BLD",10244,"KRN",.4,"NM",0)
^9.68A^^
"BLD",10244,"KRN",.401,0)
.401
"BLD",10244,"KRN",.402,0)
.402
"BLD",10244,"KRN",.403,0)
.403
"BLD",10244,"KRN",.5,0)
.5
"BLD",10244,"KRN",.84,0)
.84
"BLD",10244,"KRN",.84,"NM",0)
^9.68A^49^49
"BLD",10244,"KRN",.84,"NM",1,0)
7981022.001^^0
"BLD",10244,"KRN",.84,"NM",1,99999999)
10000000198^3170522.144416
"BLD",10244,"KRN",.84,"NM",2,0)
7981022.002^^0
"BLD",10244,"KRN",.84,"NM",2,99999999)
10000000198^3170524.16162
"BLD",10244,"KRN",.84,"NM",3,0)
7981999.002^^0
"BLD",10244,"KRN",.84,"NM",3,99999999)
10000000198^3170619.155449
"BLD",10244,"KRN",.84,"NM",4,0)
7981997.001^^0
"BLD",10244,"KRN",.84,"NM",4,99999999)
10000000198^3170619.155449
"BLD",10244,"KRN",.84,"NM",5,0)
7981007.001^^0
"BLD",10244,"KRN",.84,"NM",5,99999999)
10000000199^3170620.132129
"BLD",10244,"KRN",.84,"NM",6,0)
7981020.002^^0
"BLD",10244,"KRN",.84,"NM",6,99999999)
10000000199^3170620.132129
"BLD",10244,"KRN",.84,"NM",7,0)
7981019.002^^0
"BLD",10244,"KRN",.84,"NM",7,99999999)
10000000199^3170620.132129
"BLD",10244,"KRN",.84,"NM",8,0)
7981018.002^^0
"BLD",10244,"KRN",.84,"NM",8,99999999)
10000000199^3170620.132129
"BLD",10244,"KRN",.84,"NM",9,0)
7981023.002^^0
"BLD",10244,"KRN",.84,"NM",9,99999999)
10000000199^3170621.160003
"BLD",10244,"KRN",.84,"NM",10,0)
7981021.002^^0
"BLD",10244,"KRN",.84,"NM",10,99999999)
10000000199^3170621.181615
"BLD",10244,"KRN",.84,"NM",11,0)
7981013.002^^0
"BLD",10244,"KRN",.84,"NM",11,99999999)
10000000198^3170622.105421
"BLD",10244,"KRN",.84,"NM",12,0)
7981024.002^^0
"BLD",10244,"KRN",.84,"NM",12,99999999)
10000000198^3170622.105421
"BLD",10244,"KRN",.84,"NM",13,0)
7981025.002^^0
"BLD",10244,"KRN",.84,"NM",13,99999999)
10000000198^3170622.105421
"BLD",10244,"KRN",.84,"NM",14,0)
7981011.001^^0
"BLD",10244,"KRN",.84,"NM",14,99999999)
10000000198^3170622.151731
"BLD",10244,"KRN",.84,"NM",15,0)
7981011.002^^0
"BLD",10244,"KRN",.84,"NM",15,99999999)
10000000198^3170622.151731
"BLD",10244,"KRN",.84,"NM",16,0)
7981025.001^^0
"BLD",10244,"KRN",.84,"NM",16,99999999)
10000000199^3170622.172333
"BLD",10244,"KRN",.84,"NM",17,0)
7981014.001^^0
"BLD",10244,"KRN",.84,"NM",17,99999999)
10000000199^3170623.095214
"BLD",10244,"KRN",.84,"NM",18,0)
7981014.002^^0
"BLD",10244,"KRN",.84,"NM",18,99999999)
10000000199^3170623.095214
"BLD",10244,"KRN",.84,"NM",19,0)
7981012.001^^0
"BLD",10244,"KRN",.84,"NM",19,99999999)
10000000199^3170623.120836
"BLD",10244,"KRN",.84,"NM",20,0)
7981012.002^^0
"BLD",10244,"KRN",.84,"NM",20,99999999)
10000000199^3170623.165251
"BLD",10244,"KRN",.84,"NM",21,0)
7981003.001^^0
"BLD",10244,"KRN",.84,"NM",21,99999999)
10000000199^3170626.104318
"BLD",10244,"KRN",.84,"NM",22,0)
7981024.001^^0
"BLD",10244,"KRN",.84,"NM",22,99999999)
10000000199^3170629.131657
"BLD",10244,"KRN",.84,"NM",23,0)
7981010.001^^0
"BLD",10244,"KRN",.84,"NM",23,99999999)
10000000198^3170630.151244
"BLD",10244,"KRN",.84,"NM",24,0)
7981010.002^^0
"BLD",10244,"KRN",.84,"NM",24,99999999)
10000000198^3170630.151244
"BLD",10244,"KRN",.84,"NM",25,0)
7981015.001^^0
"BLD",10244,"KRN",.84,"NM",25,99999999)
10000000198^3170706.084438
"BLD",10244,"KRN",.84,"NM",26,0)
7981015.002^^0
"BLD",10244,"KRN",.84,"NM",26,99999999)
10000000198^3170706.084438
"BLD",10244,"KRN",.84,"NM",27,0)
7981999.001^^0
"BLD",10244,"KRN",.84,"NM",28,0)
7981995.001^^0
"BLD",10244,"KRN",.84,"NM",29,0)
7981996.001^^0
"BLD",10244,"KRN",.84,"NM",30,0)
7981997.002^^0
"BLD",10244,"KRN",.84,"NM",31,0)
7981002.002^^0
"BLD",10244,"KRN",.84,"NM",32,0)
7981004.002^^0
"BLD",10244,"KRN",.84,"NM",33,0)
7981004.001^^0
"BLD",10244,"KRN",.84,"NM",34,0)
7981002.001^^0
"BLD",10244,"KRN",.84,"NM",35,0)
7981013.001^^0
"BLD",10244,"KRN",.84,"NM",36,0)
7981003.002^^0
"BLD",10244,"KRN",.84,"NM",37,0)
7981006.002^^0
"BLD",10244,"KRN",.84,"NM",38,0)
7981019.001^^0
"BLD",10244,"KRN",.84,"NM",39,0)
7981016.002^^0
"BLD",10244,"KRN",.84,"NM",40,0)
7981016.001^^0
"BLD",10244,"KRN",.84,"NM",41,0)
7981009.001^^0
"BLD",10244,"KRN",.84,"NM",42,0)
7981009.002^^0
"BLD",10244,"KRN",.84,"NM",43,0)
7981021.001^^0
"BLD",10244,"KRN",.84,"NM",44,0)
7981007.002^^0
"BLD",10244,"KRN",.84,"NM",45,0)
7981020.001^^0
"BLD",10244,"KRN",.84,"NM",46,0)
7981023.001^^0
"BLD",10244,"KRN",.84,"NM",47,0)
7981008.001^^0
"BLD",10244,"KRN",.84,"NM",48,0)
7981008.002^^0
"BLD",10244,"KRN",.84,"NM",49,0)
7981018.001^^0
"BLD",10244,"KRN",.84,"NM","B",7981002.001,34)

"BLD",10244,"KRN",.84,"NM","B",7981002.002,31)

"BLD",10244,"KRN",.84,"NM","B",7981003.001,21)

"BLD",10244,"KRN",.84,"NM","B",7981003.002,36)

"BLD",10244,"KRN",.84,"NM","B",7981004.001,33)

"BLD",10244,"KRN",.84,"NM","B",7981004.002,32)

"BLD",10244,"KRN",.84,"NM","B",7981006.002,37)

"BLD",10244,"KRN",.84,"NM","B",7981007.001,5)

"BLD",10244,"KRN",.84,"NM","B",7981007.002,44)

"BLD",10244,"KRN",.84,"NM","B",7981008.001,47)

"BLD",10244,"KRN",.84,"NM","B",7981008.002,48)

"BLD",10244,"KRN",.84,"NM","B",7981009.001,41)

"BLD",10244,"KRN",.84,"NM","B",7981009.002,42)

"BLD",10244,"KRN",.84,"NM","B",7981010.001,23)

"BLD",10244,"KRN",.84,"NM","B",7981010.002,24)

"BLD",10244,"KRN",.84,"NM","B",7981011.001,14)

"BLD",10244,"KRN",.84,"NM","B",7981011.002,15)

"BLD",10244,"KRN",.84,"NM","B",7981012.001,19)

"BLD",10244,"KRN",.84,"NM","B",7981012.002,20)

"BLD",10244,"KRN",.84,"NM","B",7981013.001,35)

"BLD",10244,"KRN",.84,"NM","B",7981013.002,11)

"BLD",10244,"KRN",.84,"NM","B",7981014.001,17)

"BLD",10244,"KRN",.84,"NM","B",7981014.002,18)

"BLD",10244,"KRN",.84,"NM","B",7981015.001,25)

"BLD",10244,"KRN",.84,"NM","B",7981015.002,26)

"BLD",10244,"KRN",.84,"NM","B",7981016.001,40)

"BLD",10244,"KRN",.84,"NM","B",7981016.002,39)

"BLD",10244,"KRN",.84,"NM","B",7981018.001,49)

"BLD",10244,"KRN",.84,"NM","B",7981018.002,8)

"BLD",10244,"KRN",.84,"NM","B",7981019.001,38)

"BLD",10244,"KRN",.84,"NM","B",7981019.002,7)

"BLD",10244,"KRN",.84,"NM","B",7981020.001,45)

"BLD",10244,"KRN",.84,"NM","B",7981020.002,6)

"BLD",10244,"KRN",.84,"NM","B",7981021.001,43)

"BLD",10244,"KRN",.84,"NM","B",7981021.002,10)

"BLD",10244,"KRN",.84,"NM","B",7981022.001,1)

"BLD",10244,"KRN",.84,"NM","B",7981022.002,2)

"BLD",10244,"KRN",.84,"NM","B",7981023.001,46)

"BLD",10244,"KRN",.84,"NM","B",7981023.002,9)

"BLD",10244,"KRN",.84,"NM","B",7981024.001,22)

"BLD",10244,"KRN",.84,"NM","B",7981024.002,12)

"BLD",10244,"KRN",.84,"NM","B",7981025.001,16)

"BLD",10244,"KRN",.84,"NM","B",7981025.002,13)

"BLD",10244,"KRN",.84,"NM","B",7981995.001,28)

"BLD",10244,"KRN",.84,"NM","B",7981996.001,29)

"BLD",10244,"KRN",.84,"NM","B",7981997.001,4)

"BLD",10244,"KRN",.84,"NM","B",7981997.002,30)

"BLD",10244,"KRN",.84,"NM","B",7981999.001,27)

"BLD",10244,"KRN",.84,"NM","B",7981999.002,3)

"BLD",10244,"KRN",3.6,0)
3.6
"BLD",10244,"KRN",3.8,0)
3.8
"BLD",10244,"KRN",9.2,0)
9.2
"BLD",10244,"KRN",9.8,0)
9.8
"BLD",10244,"KRN",9.8,"NM",0)
^9.68A^60^56
"BLD",10244,"KRN",9.8,"NM",1,0)
RORUTL02^^0^B58261524
"BLD",10244,"KRN",9.8,"NM",1,99999999)
10000000198^3170503.084811
"BLD",10244,"KRN",9.8,"NM",2,0)
RORX002^^0^B43221624
"BLD",10244,"KRN",9.8,"NM",2,99999999)
10000000198^3170503.084811
"BLD",10244,"KRN",9.8,"NM",3,0)
RORX003^^0^B41815764
"BLD",10244,"KRN",9.8,"NM",3,99999999)
10000000198^3170503.084811
"BLD",10244,"KRN",9.8,"NM",4,0)
RORX003A^^0^B54138636
"BLD",10244,"KRN",9.8,"NM",4,99999999)
10000000198^3170503.084811
"BLD",10244,"KRN",9.8,"NM",5,0)
RORXU002^^0^B167579102
"BLD",10244,"KRN",9.8,"NM",5,99999999)
10000000198^3170503.084811
"BLD",10244,"KRN",9.8,"NM",6,0)
RORXU006^^0^B51777169
"BLD",10244,"KRN",9.8,"NM",6,99999999)
10000000198^3170503.084811
"BLD",10244,"KRN",9.8,"NM",7,0)
RORX001^^0^B60961993
"BLD",10244,"KRN",9.8,"NM",7,99999999)
10000000198^3170505.095227
"BLD",10244,"KRN",9.8,"NM",8,0)
RORX004^^0^B37005998
"BLD",10244,"KRN",9.8,"NM",8,99999999)
10000000198^3170505.095227
"BLD",10244,"KRN",9.8,"NM",9,0)
RORX005^^0^B15238780
"BLD",10244,"KRN",9.8,"NM",9,99999999)
10000000198^3170505.095227
"BLD",10244,"KRN",9.8,"NM",10,0)
RORX005A^^0^B46197607
"BLD",10244,"KRN",9.8,"NM",10,99999999)
10000000198^3170505.095227
"BLD",10244,"KRN",9.8,"NM",11,0)
RORX005B^^0^B10714938
"BLD",10244,"KRN",9.8,"NM",11,99999999)
10000000198^3170505.095227
"BLD",10244,"KRN",9.8,"NM",12,0)
RORX005C^^0^B48722299
"BLD",10244,"KRN",9.8,"NM",12,99999999)
10000000198^3170505.095227
"BLD",10244,"KRN",9.8,"NM",13,0)
RORX006^^0^B13663817
"BLD",10244,"KRN",9.8,"NM",13,99999999)
10000000198^3170508.142115
"BLD",10244,"KRN",9.8,"NM",14,0)
RORX006A^^0^B41340951
"BLD",10244,"KRN",9.8,"NM",14,99999999)
10000000198^3170508.142115
"BLD",10244,"KRN",9.8,"NM",15,0)
RORX006C^^0^B25987651
"BLD",10244,"KRN",9.8,"NM",15,99999999)
10000000198^3170508.142115
"BLD",10244,"KRN",9.8,"NM",16,0)
RORX007^^0^B66066509
"BLD",10244,"KRN",9.8,"NM",16,99999999)
10000000198^3170509.095317
"BLD",10244,"KRN",9.8,"NM",17,0)
RORX007A^^0^B28732550
"BLD",10244,"KRN",9.8,"NM",17,99999999)
10000000198^3170509.095317
"BLD",10244,"KRN",9.8,"NM",18,0)
RORX008^^0^B14193423
"BLD",10244,"KRN",9.8,"NM",18,99999999)
10000000198^3170509.095317
"BLD",10244,"KRN",9.8,"NM",19,0)
RORX008A^^0^B54936763
"BLD",10244,"KRN",9.8,"NM",19,99999999)
10000000198^3170509.095317
"BLD",10244,"KRN",9.8,"NM",20,0)
RORX009^^0^B25826904
"BLD",10244,"KRN",9.8,"NM",20,99999999)
10000000198^3170509.095317
"BLD",10244,"KRN",9.8,"NM",21,0)
RORX009A^^0^B90917415
"BLD",10244,"KRN",9.8,"NM",21,99999999)
10000000198^3170509.095317
"BLD",10244,"KRN",9.8,"NM",22,0)
RORX009C^^0^B87202952
"BLD",10244,"KRN",9.8,"NM",22,99999999)
10000000198^3170509.095317
"BLD",10244,"KRN",9.8,"NM",23,0)
RORXU010^^0^B25087165
"BLD",10244,"KRN",9.8,"NM",23,99999999)
10000000198^3170511.0945
"BLD",10244,"KRN",9.8,"NM",24,0)
RORX011^^0^B104112495
"BLD",10244,"KRN",9.8,"NM",24,99999999)
10000000198^3170511.0945
"BLD",10244,"KRN",9.8,"NM",25,0)
RORX012^^0^B23138519
"BLD",10244,"KRN",9.8,"NM",25,99999999)
10000000198^3170511.0945
"BLD",10244,"KRN",9.8,"NM",26,0)
RORX012A^^0^B120421000
"BLD",10244,"KRN",9.8,"NM",26,99999999)
10000000198^3170511.0945
"BLD",10244,"KRN",9.8,"NM",27,0)
RORX013^^0^B12392289
"BLD",10244,"KRN",9.8,"NM",27,99999999)
10000000198^3170511.0945
"BLD",10244,"KRN",9.8,"NM",28,0)
RORX013A^^0^B88174933
"BLD",10244,"KRN",9.8,"NM",28,99999999)
10000000198^3170511.0945
"BLD",10244,"KRN",9.8,"NM",29,0)
RORX013C^^0^B19770411
"BLD",10244,"KRN",9.8,"NM",29,99999999)
10000000198^3170511.0945
"BLD",10244,"KRN",9.8,"NM",30,0)
RORX014^^0^B13414286
"BLD",10244,"KRN",9.8,"NM",30,99999999)
10000000198^3170516.101701
"BLD",10244,"KRN",9.8,"NM",31,0)
RORX014A^^0^B52467259
"BLD",10244,"KRN",9.8,"NM",31,99999999)
10000000198^3170516.101701
"BLD",10244,"KRN",9.8,"NM",32,0)
RORX015^^0^B18214274
"BLD",10244,"KRN",9.8,"NM",32,99999999)
10000000198^3170516.101701
"BLD",10244,"KRN",9.8,"NM",33,0)
RORX015A^^0^B98302910
"BLD",10244,"KRN",9.8,"NM",33,99999999)
10000000198^3170516.101701
"BLD",10244,"KRN",9.8,"NM",34,0)
RORX016^^0^B11086418
"BLD",10244,"KRN",9.8,"NM",34,99999999)
10000000198^3170516.101701
"BLD",10244,"KRN",9.8,"NM",35,0)
RORX016B^^0^B12089847
"BLD",10244,"KRN",9.8,"NM",35,99999999)
10000000198^3170516.101701
"BLD",10244,"KRN",9.8,"NM",36,0)
RORX016C^^0^B23020980
"BLD",10244,"KRN",9.8,"NM",36,99999999)
10000000198^3170516.101701
"BLD",10244,"KRN",9.8,"NM",37,0)
RORX018^^0^B166229893
"BLD",10244,"KRN",9.8,"NM",37,99999999)
10000000198^3170516.101701
"BLD",10244,"KRN",9.8,"NM",38,0)
RORX019^^0^B212873345
"BLD",10244,"KRN",9.8,"NM",38,99999999)
10000000198^3170516.101701
"BLD",10244,"KRN",9.8,"NM",39,0)
RORX020^^0^B78730803
"BLD",10244,"KRN",9.8,"NM",39,99999999)
10000000198^3170518.102948
"BLD",10244,"KRN",9.8,"NM",40,0)
RORX020A^^0^B59481878
"BLD",10244,"KRN",9.8,"NM",40,99999999)
10000000198^3170518.102948
"BLD",10244,"KRN",9.8,"NM",41,0)
RORX021^^0^B30013567
"BLD",10244,"KRN",9.8,"NM",41,99999999)
10000000198^3170518.102948
"BLD",10244,"KRN",9.8,"NM",42,0)
RORX021A^^0^B172044491
"BLD",10244,"KRN",9.8,"NM",42,99999999)
10000000198^3170518.102948
"BLD",10244,"KRN",9.8,"NM",43,0)
RORX022^^0^B21237172
"BLD",10244,"KRN",9.8,"NM",43,99999999)
10000000198^3170518.102948
"BLD",10244,"KRN",9.8,"NM",44,0)
RORX022A^^0^B176351270
"BLD",10244,"KRN",9.8,"NM",44,99999999)
10000000198^3170518.102948
"BLD",10244,"KRN",9.8,"NM",48,0)
RORX025^^0^B23252812
"BLD",10244,"KRN",9.8,"NM",48,99999999)
10000000198^3170518.102948
"BLD",10244,"KRN",9.8,"NM",49,0)
RORX023^^0^B10226863
"BLD",10244,"KRN",9.8,"NM",49,99999999)
10000000198^3170518.122141
"BLD",10244,"KRN",9.8,"NM",50,0)
RORX023A^^0^B138370750
"BLD",10244,"KRN",9.8,"NM",50,99999999)
10000000198^3170518.122141
"BLD",10244,"KRN",9.8,"NM",51,0)
RORX024^^0^B77292615
"BLD",10244,"KRN",9.8,"NM",51,99999999)
10000000198^3170518.122141
"BLD",10244,"KRN",9.8,"NM",52,0)
RORX024A^^0^B88883037
"BLD",10244,"KRN",9.8,"NM",52,99999999)
10000000198^3170518.122141
"BLD",10244,"KRN",9.8,"NM",54,0)
RORX015C^^0^B36664881
"BLD",10244,"KRN",9.8,"NM",54,99999999)
10000000198^3170705.11133
"BLD",10244,"KRN",9.8,"NM",55,0)
RORX010^^0^B75093403
"BLD",10244,"KRN",9.8,"NM",55,99999999)
10000000198^3170705.131259
"BLD",10244,"KRN",9.8,"NM",56,0)
RORX018A^^0^B2762309
"BLD",10244,"KRN",9.8,"NM",57,0)
RORUTL11^^0^B4071769
"BLD",10244,"KRN",9.8,"NM",58,0)
RORXU005^^0^B56314333
"BLD",10244,"KRN",9.8,"NM",59,0)
RORX016A^^0^B15495238
"BLD",10244,"KRN",9.8,"NM",60,0)
RORP031^^0^B128693330
"BLD",10244,"KRN",9.8,"NM","B","RORP031",60)

"BLD",10244,"KRN",9.8,"NM","B","RORUTL02",1)

"BLD",10244,"KRN",9.8,"NM","B","RORUTL11",57)

"BLD",10244,"KRN",9.8,"NM","B","RORX001",7)

"BLD",10244,"KRN",9.8,"NM","B","RORX002",2)

"BLD",10244,"KRN",9.8,"NM","B","RORX003",3)

"BLD",10244,"KRN",9.8,"NM","B","RORX003A",4)

"BLD",10244,"KRN",9.8,"NM","B","RORX004",8)

"BLD",10244,"KRN",9.8,"NM","B","RORX005",9)

"BLD",10244,"KRN",9.8,"NM","B","RORX005A",10)

"BLD",10244,"KRN",9.8,"NM","B","RORX005B",11)

"BLD",10244,"KRN",9.8,"NM","B","RORX005C",12)

"BLD",10244,"KRN",9.8,"NM","B","RORX006",13)

"BLD",10244,"KRN",9.8,"NM","B","RORX006A",14)

"BLD",10244,"KRN",9.8,"NM","B","RORX006C",15)

"BLD",10244,"KRN",9.8,"NM","B","RORX007",16)

"BLD",10244,"KRN",9.8,"NM","B","RORX007A",17)

"BLD",10244,"KRN",9.8,"NM","B","RORX008",18)

"BLD",10244,"KRN",9.8,"NM","B","RORX008A",19)

"BLD",10244,"KRN",9.8,"NM","B","RORX009",20)

"BLD",10244,"KRN",9.8,"NM","B","RORX009A",21)

"BLD",10244,"KRN",9.8,"NM","B","RORX009C",22)

"BLD",10244,"KRN",9.8,"NM","B","RORX010",55)

"BLD",10244,"KRN",9.8,"NM","B","RORX011",24)

"BLD",10244,"KRN",9.8,"NM","B","RORX012",25)

"BLD",10244,"KRN",9.8,"NM","B","RORX012A",26)

"BLD",10244,"KRN",9.8,"NM","B","RORX013",27)

"BLD",10244,"KRN",9.8,"NM","B","RORX013A",28)

"BLD",10244,"KRN",9.8,"NM","B","RORX013C",29)

"BLD",10244,"KRN",9.8,"NM","B","RORX014",30)

"BLD",10244,"KRN",9.8,"NM","B","RORX014A",31)

"BLD",10244,"KRN",9.8,"NM","B","RORX015",32)

"BLD",10244,"KRN",9.8,"NM","B","RORX015A",33)

"BLD",10244,"KRN",9.8,"NM","B","RORX015C",54)

"BLD",10244,"KRN",9.8,"NM","B","RORX016",34)

"BLD",10244,"KRN",9.8,"NM","B","RORX016A",59)

"BLD",10244,"KRN",9.8,"NM","B","RORX016B",35)

"BLD",10244,"KRN",9.8,"NM","B","RORX016C",36)

"BLD",10244,"KRN",9.8,"NM","B","RORX018",37)

"BLD",10244,"KRN",9.8,"NM","B","RORX018A",56)

"BLD",10244,"KRN",9.8,"NM","B","RORX019",38)

"BLD",10244,"KRN",9.8,"NM","B","RORX020",39)

"BLD",10244,"KRN",9.8,"NM","B","RORX020A",40)

"BLD",10244,"KRN",9.8,"NM","B","RORX021",41)

"BLD",10244,"KRN",9.8,"NM","B","RORX021A",42)

"BLD",10244,"KRN",9.8,"NM","B","RORX022",43)

"BLD",10244,"KRN",9.8,"NM","B","RORX022A",44)

"BLD",10244,"KRN",9.8,"NM","B","RORX023",49)

"BLD",10244,"KRN",9.8,"NM","B","RORX023A",50)

"BLD",10244,"KRN",9.8,"NM","B","RORX024",51)

"BLD",10244,"KRN",9.8,"NM","B","RORX024A",52)

"BLD",10244,"KRN",9.8,"NM","B","RORX025",48)

"BLD",10244,"KRN",9.8,"NM","B","RORXU002",5)

"BLD",10244,"KRN",9.8,"NM","B","RORXU005",58)

"BLD",10244,"KRN",9.8,"NM","B","RORXU006",6)

"BLD",10244,"KRN",9.8,"NM","B","RORXU010",23)

"BLD",10244,"KRN",19,0)
19
"BLD",10244,"KRN",19.1,0)
19.1
"BLD",10244,"KRN",101,0)
101
"BLD",10244,"KRN",409.61,0)
409.61
"BLD",10244,"KRN",771,0)
771
"BLD",10244,"KRN",779.2,0)
779.2
"BLD",10244,"KRN",870,0)
870
"BLD",10244,"KRN",8989.51,0)
8989.51
"BLD",10244,"KRN",8989.52,0)
8989.52
"BLD",10244,"KRN",8994,0)
8994
"BLD",10244,"KRN","B",.4,.4)

"BLD",10244,"KRN","B",.401,.401)

"BLD",10244,"KRN","B",.402,.402)

"BLD",10244,"KRN","B",.403,.403)

"BLD",10244,"KRN","B",.5,.5)

"BLD",10244,"KRN","B",.84,.84)

"BLD",10244,"KRN","B",3.6,3.6)

"BLD",10244,"KRN","B",3.8,3.8)

"BLD",10244,"KRN","B",9.2,9.2)

"BLD",10244,"KRN","B",9.8,9.8)

"BLD",10244,"KRN","B",19,19)

"BLD",10244,"KRN","B",19.1,19.1)

"BLD",10244,"KRN","B",101,101)

"BLD",10244,"KRN","B",409.61,409.61)

"BLD",10244,"KRN","B",771,771)

"BLD",10244,"KRN","B",779.2,779.2)

"BLD",10244,"KRN","B",870,870)

"BLD",10244,"KRN","B",8989.51,8989.51)

"BLD",10244,"KRN","B",8989.52,8989.52)

"BLD",10244,"KRN","B",8994,8994)

"BLD",10244,"PRE")
RORP031
"BLD",10244,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",10244,"QUES",0)
^9.62^5^5
"BLD",10244,"QUES",1,0)
POSQ1
"BLD",10244,"QUES",1,1)
N^0:10:0
"BLD",10244,"QUES",1,"A")
Maximum number of registry update subtasks
"BLD",10244,"QUES",1,"B")
5
"BLD",10244,"QUES",1,"M")
D BLD^DIALOG(7980000.009,,,"DIR(""?"")","S")
"BLD",10244,"QUES",2,0)
POSQ2
"BLD",10244,"QUES",2,1)
Y
"BLD",10244,"QUES",2,"A")
Suspend the post-install during the peak hours
"BLD",10244,"QUES",2,"B")
NO
"BLD",10244,"QUES",2,"M")
W ! D BLD^DIALOG(7980000.01,,,"DIR(""?"")","S")
"BLD",10244,"QUES",3,0)
POSQ3
"BLD",10244,"QUES",3,1)
D^::R
"BLD",10244,"QUES",3,"A")
Suspension start time
"BLD",10244,"QUES",3,"B")
7:00AM
"BLD",10244,"QUES",3,"M")
W ! D POSQ3^RORP024(.DIR)
"BLD",10244,"QUES",4,0)
POSQ4
"BLD",10244,"QUES",4,1)
D
"BLD",10244,"QUES",4,"A")
Suspension end time
"BLD",10244,"QUES",4,"B")
6:00PM
"BLD",10244,"QUES",4,"M")
W ! D POSQ4^RORP024(.DIR)
"BLD",10244,"QUES",5,0)
POSQ5
"BLD",10244,"QUES",5,1)
D^::FRX
"BLD",10244,"QUES",5,"A")
Date/Time to run the new registry initialize task
"BLD",10244,"QUES",5,"M")
D POSQ5^RORP024(.DIR)
"BLD",10244,"QUES",5,"Q")
The date/time entered must be at least 15 minutes in the future.
"BLD",10244,"QUES","B","POSQ1",1)

"BLD",10244,"QUES","B","POSQ2",2)

"BLD",10244,"QUES","B","POSQ3",3)

"BLD",10244,"QUES","B","POSQ4",4)

"BLD",10244,"QUES","B","POSQ5",5)

"BLD",10244,"REQB",0)
^9.611^10^2
"BLD",10244,"REQB",9,0)
ROR*1.5*30^1
"BLD",10244,"REQB",10,0)
PSN*4.0*530^1
"BLD",10244,"REQB","B","PSN*4.0*530",10)

"BLD",10244,"REQB","B","ROR*1.5*30",9)

"DATA",798.1,37,0)
VA MOVEMENT DISORDERS^^^Movement Disorders Registry^^1^^^^^0^^^1
"DATA",798.1,37,1,0)
^798.13^6^6
"DATA",798.1,37,1,1,0)
VA MOVEMENT DISORDERS PROBLEM
"DATA",798.1,37,1,2,0)
VA MOVEMENT DISORDERS PROBLEM (ICD10)
"DATA",798.1,37,1,3,0)
VA MOVEMENT DISORDERS PTF
"DATA",798.1,37,1,4,0)
VA MOVEMENT DISORDERS PTF (ICD10)
"DATA",798.1,37,1,5,0)
VA MOVEMENT DISORDERS VPOV
"DATA",798.1,37,1,6,0)
VA MOVEMENT DISORDERS VPOV (ICD10)
"DATA",798.1,37,6)
1
"DATA",798.1,37,9)
^^2^CCRAutoNotification@domain.ext
"DATA",798.1,37,11)
7
"DATA",798.1,37,18,0)
^798.118^2^2
"DATA",798.1,37,18,1,0)
ROR VA GENERIC ADMIN
"DATA",798.1,37,18,2,0)
ROR VA GENERIC USER
"DATA",798.1,37,19)
^
"DATA",798.1,37,21)
^^^
"DATA",798.1,37,27)
1,2,3,4,5,6,7,9,11,12,13,15,16,18,19,20,24,25
"DATA",798.1,38,0)
VA ADRENAL ADENOMA^^^Adrenal Adenoma Registry^^1^^^^^0^^^1
"DATA",798.1,38,1,0)
^798.13^6^6
"DATA",798.1,38,1,1,0)
VA ADRENAL ADENOMA PROBLEM
"DATA",798.1,38,1,2,0)
VA ADRENAL ADENOMA PROBLEM (ICD10)
"DATA",798.1,38,1,3,0)
VA ADRENAL ADENOMA PTF
"DATA",798.1,38,1,4,0)
VA ADRENAL ADENOMA PTF (ICD10)
"DATA",798.1,38,1,5,0)
VA ADRENAL ADENOMA VPOV
"DATA",798.1,38,1,6,0)
VA ADRENAL ADENOMA VPOV (ICD10)
"DATA",798.1,38,6)
1
"DATA",798.1,38,9)
^^2^CCRAutoNotification@domain.ext
"DATA",798.1,38,11)
7
"DATA",798.1,38,18,0)
^798.118^2^2
"DATA",798.1,38,18,1,0)
ROR VA GENERIC ADMIN
"DATA",798.1,38,18,2,0)
ROR VA GENERIC USER
"DATA",798.1,38,19)

"DATA",798.1,38,21)
^^^
"DATA",798.1,38,27)
1,2,3,4,5,6,7,9,11,12,13,15,16,18,19,20,24,25
"DATA",798.2,251,0)
VA MOVEMENT DISORDERS PROBLEM^9000011^ICD-9 code in problem list^1
"DATA",798.2,251,1)
+$D(^ROR(798.5,REGIEN,1,"B",+{I:DIAGNOSIS}))
"DATA",798.2,251,5)
1
"DATA",798.2,252,0)
VA MOVEMENT DISORDERS PROBLEM (ICD10)^9000011^ICD-10 code in problem list^1
"DATA",798.2,252,1)
+$D(^ROR(798.5,REGIEN,1,"B",+{I:DIAGNOSIS}))
"DATA",798.2,252,5)
30
"DATA",798.2,253,0)
VA MOVEMENT DISORDERS PTF^45^ICD-9 code in inpatient file^1
"DATA",798.2,253,1)
$$PTFRULE^RORUPD09(REGIEN)
"DATA",798.2,253,5)
1
"DATA",798.2,254,0)
VA MOVEMENT DISORDERS PTF (ICD10)^45^ICD-10 code in inpatient file^1
"DATA",798.2,254,1)
$$PTFRULE^RORUPD09(REGIEN)
"DATA",798.2,254,5)
30
"DATA",798.2,255,0)
VA MOVEMENT DISORDERS VPOV^9000010.07^ICD-9 code in outpatient file^1
"DATA",798.2,255,1)
+$D(^ROR(798.5,REGIEN,1,"B",+{I:POV}))
"DATA",798.2,255,5)
1
"DATA",798.2,256,0)
VA MOVEMENT DISORDERS VPOV (ICD10)^9000010.07^ICD-10 code in outpatient file^1
"DATA",798.2,256,1)
+$D(^ROR(798.5,REGIEN,1,"B",+{I:POV}))
"DATA",798.2,256,5)
30
"DATA",798.2,257,0)
VA ADRENAL ADENOMA PROBLEM^9000011^ICD-9 code in problem list^1
"DATA",798.2,257,1)
+$D(^ROR(798.5,REGIEN,1,"B",+{I:DIAGNOSIS}))
"DATA",798.2,257,5)
1
"DATA",798.2,258,0)
VA ADRENAL ADENOMA PROBLEM (ICD10)^9000011^ICD-10 code in problem list^1
"DATA",798.2,258,1)
+$D(^ROR(798.5,REGIEN,1,"B",+{I:DIAGNOSIS}))
"DATA",798.2,258,5)
30
"DATA",798.2,259,0)
VA ADRENAL ADENOMA PTF^45^ICD-9 code in inpatient file^1
"DATA",798.2,259,1)
$$PTFRULE^RORUPD09(REGIEN)
"DATA",798.2,259,5)
1
"DATA",798.2,260,0)
VA ADRENAL ADENOMA PTF (ICD10)^45^ICD-10 code in inpatient file^1
"DATA",798.2,260,1)
$$PTFRULE^RORUPD09(REGIEN)
"DATA",798.2,260,5)
30
"DATA",798.2,261,0)
VA ADRENAL ADENOMA VPOV^9000010.07^ICD-9 code in outpatient file^1
"DATA",798.2,261,1)
+$D(^ROR(798.5,REGIEN,1,"B",+{I:POV}))
"DATA",798.2,261,5)
1
"DATA",798.2,262,0)
VA ADRENAL ADENOMA VPOV (ICD10)^9000010.07^ICD-10 code in outpatient file^1
"DATA",798.2,262,1)
+$D(^ROR(798.5,REGIEN,1,"B",+{I:POV}))
"DATA",798.2,262,5)
30
"DATA",799.31,314,0)
AGE_RANGE
"DATA",799.31,315,0)
PACT
"DATA",799.31,316,0)
PCP
"DATA",799.51,56,0)
SOFOSBUVIR/VELPATASVIR/VOXILAP^1^28^5223^^^^^1
"FIA",798.1)
ROR REGISTRY PARAMETERS
"FIA",798.1,0)
^ROR(798.1,
"FIA",798.1,0,0)
798.1Is
"FIA",798.1,0,1)
n^n^f^^y^^y^o^n
"FIA",798.1,0,10)

"FIA",798.1,0,11)
N ROR S ROR=$P(^(0),U) I ROR["VA MOVEMENT DISORDERS"!(ROR["VA ADRENAL ADENOMA")
"FIA",798.1,0,"RLRO")

"FIA",798.1,0,"VR")
1.5^ROR
"FIA",798.1,798.1)
0
"FIA",798.1,798.11)
0
"FIA",798.1,798.112)
0
"FIA",798.1,798.114)
0
"FIA",798.1,798.118)
0
"FIA",798.1,798.12)
0
"FIA",798.1,798.122)
0
"FIA",798.1,798.128)
0
"FIA",798.1,798.129)
0
"FIA",798.1,798.13)
0
"FIA",798.1,798.15)
0
"FIA",798.2)
ROR SELECTION RULE
"FIA",798.2,0)
^ROR(798.2,
"FIA",798.2,0,0)
798.2I
"FIA",798.2,0,1)
n^n^f^^y^^y^o^n
"FIA",798.2,0,10)

"FIA",798.2,0,11)
N ROR S ROR=$P(^(0),U) I ROR["VA MOVEMENT DISORDERS"!(ROR["VA ADRENAL ADENOMA")
"FIA",798.2,0,"RLRO")

"FIA",798.2,0,"VR")
1.5^ROR
"FIA",798.2,798.2)
0
"FIA",798.2,798.25)
0
"FIA",798.2,798.26)
0
"FIA",798.5)
ROR ICD SEARCH
"FIA",798.5,0)
^ROR(798.5,
"FIA",798.5,0,0)
798.5P
"FIA",798.5,0,1)
y^n^f^^^^n^^n
"FIA",798.5,0,10)

"FIA",798.5,0,11)

"FIA",798.5,0,"RLRO")

"FIA",798.5,0,"VR")
1.5^ROR
"FIA",798.5,798.5)
0
"FIA",798.5,798.51)
0
"FIA",798.5,798.52)
0
"FIA",798.5,798.53)
0
"FIA",799.31)
ROR XML ITEM
"FIA",799.31,0)
^ROR(799.31,
"FIA",799.31,0,0)
799.31
"FIA",799.31,0,1)
n^n^f^^n^^y^o^n
"FIA",799.31,0,10)

"FIA",799.31,0,11)
N ROR S ROR=$P(^(0),U) I ROR="PACT"!(ROR="PCP")!(ROR="AGE_RANGE")
"FIA",799.31,0,"RLRO")

"FIA",799.31,0,"VR")
1.5^ROR
"FIA",799.31,799.31)
0
"FIA",799.51)
ROR GENERIC DRUG
"FIA",799.51,0)
^ROR(799.51,
"FIA",799.51,0,0)
799.51
"FIA",799.51,0,1)
n^n^f^^y^^y^o^n
"FIA",799.51,0,10)

"FIA",799.51,0,11)
N ROR S ROR=$P($G(^(0)),U) I ROR="SOFOSBUVIR/VELPATASVIR/VOXILAP"
"FIA",799.51,0,"RLRO")

"FIA",799.51,0,"VR")
1.5^ROR
"FIA",799.51,799.51)
0
"FRV1",798.2,"251,5",1)
ICD-9-CM
"FRV1",798.2,"251,5",1,"F")
;ICDS(
"FRV1",798.2,"252,5",1)
ICD-10-CM
"FRV1",798.2,"252,5",1,"F")
;ICDS(
"FRV1",798.2,"253,5",1)
ICD-9-CM
"FRV1",798.2,"253,5",1,"F")
;ICDS(
"FRV1",798.2,"254,5",1)
ICD-10-CM
"FRV1",798.2,"254,5",1,"F")
;ICDS(
"FRV1",798.2,"255,5",1)
ICD-9-CM
"FRV1",798.2,"255,5",1,"F")
;ICDS(
"FRV1",798.2,"256,5",1)
ICD-10-CM
"FRV1",798.2,"256,5",1,"F")
;ICDS(
"FRV1",798.2,"257,5",1)
ICD-9-CM
"FRV1",798.2,"257,5",1,"F")
;ICDS(
"FRV1",798.2,"258,5",1)
ICD-10-CM
"FRV1",798.2,"258,5",1,"F")
;ICDS(
"FRV1",798.2,"259,5",1)
ICD-9-CM
"FRV1",798.2,"259,5",1,"F")
;ICDS(
"FRV1",798.2,"260,5",1)
ICD-10-CM
"FRV1",798.2,"260,5",1,"F")
;ICDS(
"FRV1",798.2,"261,5",1)
ICD-9-CM
"FRV1",798.2,"261,5",1,"F")
;ICDS(
"FRV1",798.2,"262,5",1)
ICD-10-CM
"FRV1",798.2,"262,5",1,"F")
;ICDS(
"FRV1",799.51,"56,0",2)
VA HEPC
"FRV1",799.51,"56,0",2,"F")
;ROR(798.1,
"FRV1",799.51,"56,0",3)
Default (HepC)
"FRV1",799.51,"56,0",3,"F")
;ROR(799.1,
"FRV1",799.51,"56,0",4)
SOFOSBUVIR/VELPATASVIR/VOXILAPREVIR
"FRV1",799.51,"56,0",4,"F")
;PSNDF(50.6,
"FRV1K",799.51,"56,0",3)
KEY
"FRV1K",799.51,"56,0",3,1)
Drug Group
"FRV1K",799.51,"56,0",3,2)
VA HEPC
"FRV1K",799.51,"56,0",3,3)
99
"INI")
PRE^RORP031
"INIT")
POST^RORP031
"IX",798.1,798.1,"B",0)
798.1^B^Uniqueness Index for Key 'A' of File #798.1^R^^F^IR^I^798.1^^^^^LS
"IX",798.1,798.1,"B",1)
S ^ROR(798.1,"B",X,DA)=""
"IX",798.1,798.1,"B",2)
K ^ROR(798.1,"B",X,DA)
"IX",798.1,798.1,"B",2.5)
K ^ROR(798.1,"B")
"IX",798.1,798.1,"B",11.1,0)
^.114IA^1^1
"IX",798.1,798.1,"B",11.1,1,0)
1^F^798.1^.01^^1
"IX",798.1,798.11,"B",0)
798.11^B^Uniqueness Index for Key 'A' of Subfile #798.11^R^^F^IR^I^798.11^^^^^LS
"IX",798.1,798.11,"B",1)
S ^ROR(798.1,DA(1),3,"B",X,DA)=""
"IX",798.1,798.11,"B",2)
K ^ROR(798.1,DA(1),3,"B",X,DA)
"IX",798.1,798.11,"B",2.5)
K ^ROR(798.1,DA(1),3,"B")
"IX",798.1,798.11,"B",11.1,0)
^.114IA^1^1
"IX",798.1,798.11,"B",11.1,1,0)
1^F^798.11^.01^^1
"IX",798.1,798.118,"B",0)
798.118^B^Uniqueness Index for Key 'A' of Subfile #798.118^R^^F^IR^I^798.118^^^^^LS
"IX",798.1,798.118,"B",1)
S ^ROR(798.1,DA(1),18,"B",X,DA)=""
"IX",798.1,798.118,"B",2)
K ^ROR(798.1,DA(1),18,"B",X,DA)
"IX",798.1,798.118,"B",2.5)
K ^ROR(798.1,DA(1),18,"B")
"IX",798.1,798.118,"B",11.1,0)
^.114IA^1^1
"IX",798.1,798.118,"B",11.1,1,0)
1^F^798.118^.01^^1
"IX",798.1,798.122,"B",0)
798.122^B^Uniqueness Index for Key 'A' of Subfile #798.122^R^^F^IR^I^798.122^^^^^LS
"IX",798.1,798.122,"B",1)
S ^ROR(798.1,DA(1),22,"B",X,DA)=""
"IX",798.1,798.122,"B",2)
K ^ROR(798.1,DA(1),22,"B",X,DA)
"IX",798.1,798.122,"B",2.5)
K ^ROR(798.1,DA(1),22,"B")
"IX",798.1,798.122,"B",11.1,0)
^.114IA^1^1
"IX",798.1,798.122,"B",11.1,1,0)
1^F^798.122^.01^^1
"IX",798.1,798.128,"G",0)
798.128^G^Lab Group and Local Test Name^R^^R^IR^I^798.128^^^^^LS
"IX",798.1,798.128,"G",1)
S ^ROR(798.1,DA(1),28,"G",X(1),X(2),DA)=""
"IX",798.1,798.128,"G",2)
K ^ROR(798.1,DA(1),28,"G",X(1),X(2),DA)
"IX",798.1,798.128,"G",2.5)
K ^ROR(798.1,DA(1),28,"G")
"IX",798.1,798.128,"G",11.1,0)
^.114IA^3^2
"IX",798.1,798.128,"G",11.1,1,0)
1^F^798.128^.02^^1^F
"IX",798.1,798.128,"G",11.1,1,2)
 
"IX",798.1,798.128,"G",11.1,1,3)
 
"IX",798.1,798.128,"G",11.1,3,0)
2^F^798.128^.01^^2^F
"IX",798.1,798.128,"G",11.1,3,3)
 
"IX",798.1,798.129,"G",0)
798.129^G^Drug Group and Local Drug Name^R^^R^IR^I^798.129^^^^^LS
"IX",798.1,798.129,"G",1)
S ^ROR(798.1,DA(1),29,"G",X(1),X(2),DA)=""
"IX",798.1,798.129,"G",2)
K ^ROR(798.1,DA(1),29,"G",X(1),X(2),DA)
"IX",798.1,798.129,"G",2.5)
K ^ROR(798.1,DA(1),29,"G")
"IX",798.1,798.129,"G",11.1,0)
^.114IA^3^2
"IX",798.1,798.129,"G",11.1,1,0)
1^F^798.129^.02^^1^F
"IX",798.1,798.129,"G",11.1,1,3)
 
"IX",798.1,798.129,"G",11.1,3,0)
2^F^798.129^.01^^2^F
"IX",798.1,798.129,"G",11.1,3,3)
 
"IX",798.1,798.13,"B",0)
798.13^B^Uniqueness Index for Key 'A' of Subfile #798.13^R^^F^IR^I^798.13^^^^^LS
"IX",798.1,798.13,"B",1)
S ^ROR(798.1,DA(1),1,"B",X,DA)=""
"IX",798.1,798.13,"B",2)
K ^ROR(798.1,DA(1),1,"B",X,DA)
"IX",798.1,798.13,"B",2.5)
K ^ROR(798.1,DA(1),1,"B")
"IX",798.1,798.13,"B",11.1,0)
^.114IA^1^1
"IX",798.1,798.13,"B",11.1,1,0)
1^F^798.13^.01^^1
"IX",798.2,798.2,"B",0)
798.2^B^Uniqueness Index for the "A" Key of File #798.2^R^^F^IR^I^798.2^^^^^LS
"IX",798.2,798.2,"B",1)
S ^ROR(798.2,"B",X,DA)=""
"IX",798.2,798.2,"B",2)
K ^ROR(798.2,"B",X,DA)
"IX",798.2,798.2,"B",2.5)
K ^ROR(798.2,"B")
"IX",798.2,798.2,"B",11.1,0)
^.114IA^1^1
"IX",798.2,798.2,"B",11.1,1,0)
1^F^798.2^.01^^1
"IX",798.2,798.26,"B",0)
798.26^B^Uniqueness Index for the "A" Key of Subfile #798.26^R^^F^IR^I^798.26^^^^^LS
"IX",798.2,798.26,"B",1)
S ^ROR(798.2,DA(1),4,"B",X,DA)=""
"IX",798.2,798.26,"B",2)
K ^ROR(798.2,DA(1),4,"B",X,DA)
"IX",798.2,798.26,"B",2.5)
K ^ROR(798.2,DA(1),4,"B")
"IX",798.2,798.26,"B",11.1,0)
^.114IA^1^1
"IX",798.2,798.26,"B",11.1,1,0)
1^F^798.26^.01^^1
"IX",799.31,799.31,"B",0)
799.31^B^Uniqueness Index for Key 'A' of File #799.31^R^^F^IR^I^799.31^^^^^LS
"IX",799.31,799.31,"B",1)
S ^ROR(799.31,"B",X,DA)=""
"IX",799.31,799.31,"B",2)
K ^ROR(799.31,"B",X,DA)
"IX",799.31,799.31,"B",2.5)
K ^ROR(799.31,"B")
"IX",799.31,799.31,"B",11.1,0)
^.114IA^1^1
"IX",799.31,799.31,"B",11.1,1,0)
1^F^799.31^.01^^1
"IX",799.51,799.51,"ARDG",0)
799.51^ARDG^Registry & Drug Group^R^^R^IR^I^799.51^^^^^S
"IX",799.51,799.51,"ARDG",1)
S ^ROR(799.51,"ARDG",X(2),X(3),DA)=""
"IX",799.51,799.51,"ARDG",2)
K ^ROR(799.51,"ARDG",X(2),X(3),DA)
"IX",799.51,799.51,"ARDG",2.5)
K ^ROR(799.51,"ARDG")
"IX",799.51,799.51,"ARDG",11.1,0)
^.114IA^3^3
"IX",799.51,799.51,"ARDG",11.1,1,0)
1^F^799.51^.02^^^F
"IX",799.51,799.51,"ARDG",11.1,2,0)
3^F^799.51^.04^^2^F
"IX",799.51,799.51,"ARDG",11.1,3,0)
2^C^^^^1
"IX",799.51,799.51,"ARDG",11.1,3,1.5)
S X=$S(X(1)'="":X(1)_"#",1:"")
"IX",799.51,799.51,"KEY",0)
799.51^KEY^Registry, Drug Group, Generic Drug^R^^R^IR^I^799.51^^^^^LS
"IX",799.51,799.51,"KEY",1)
S ^ROR(799.51,"KEY",X(1),X(2),X(3),DA)=""
"IX",799.51,799.51,"KEY",2)
K ^ROR(799.51,"KEY",X(1),X(2),X(3),DA)
"IX",799.51,799.51,"KEY",2.5)
K ^ROR(799.51,"KEY")
"IX",799.51,799.51,"KEY",11.1,0)
^.114IA^3^3
"IX",799.51,799.51,"KEY",11.1,1,0)
1^F^799.51^.02^^1
"IX",799.51,799.51,"KEY",11.1,2,0)
2^F^799.51^.03^^2
"IX",799.51,799.51,"KEY",11.1,3,0)
3^F^799.51^.04^^3
"KEY",798.1,798.1,"A",0)
798.1^A^S^216
"KEY",798.1,798.1,"A",2,0)
^.312IA^1^1
"KEY",798.1,798.1,"A",2,1,0)
.01^798.1^1
"KEY",798.1,798.11,"A",0)
798.11^A^S^225
"KEY",798.1,798.11,"A",2,0)
^.312IA^1^1
"KEY",798.1,798.11,"A",2,1,0)
.01^798.11^1
"KEY",798.1,798.118,"A",0)
798.118^A^S^336
"KEY",798.1,798.118,"A",2,0)
^.312IA^1^1
"KEY",798.1,798.118,"A",2,1,0)
.01^798.118^1
"KEY",798.1,798.122,"A",0)
798.122^A^S^349
"KEY",798.1,798.122,"A",2,0)
^.312IA^1^1
"KEY",798.1,798.122,"A",2,1,0)
.01^798.122^1
"KEY",798.1,798.128,"G",0)
798.128^G^P^338
"KEY",798.1,798.128,"G",2,0)
^.312IA^2^2
"KEY",798.1,798.128,"G",2,1,0)
.02^798.128^1
"KEY",798.1,798.128,"G",2,2,0)
.01^798.128^2
"KEY",798.1,798.129,"G",0)
798.129^G^P^339
"KEY",798.1,798.129,"G",2,0)
^.312IA^2^2
"KEY",798.1,798.129,"G",2,1,0)
.02^798.129^1
"KEY",798.1,798.129,"G",2,2,0)
.01^798.129^2
"KEY",798.1,798.13,"A",0)
798.13^A^S^217
"KEY",798.1,798.13,"A",2,0)
^.312IA^1^1
"KEY",798.1,798.13,"A",2,1,0)
.01^798.13^1
"KEY",798.2,798.2,"A",0)
798.2^A^S^219
"KEY",798.2,798.2,"A",2,0)
^.312IA^1^1
"KEY",798.2,798.2,"A",2,1,0)
.01^798.2^1
"KEY",798.2,798.26,"A",0)
798.26^A^S^220
"KEY",798.2,798.26,"A",2,0)
^.312IA^1^1
"KEY",798.2,798.26,"A",2,1,0)
.01^798.26^1
"KEY",799.31,799.31,"A",0)
799.31^A^S^668
"KEY",799.31,799.31,"A",2,0)
^.312IA^1^1
"KEY",799.31,799.31,"A",2,1,0)
.01^799.31^1
"KEY",799.51,799.51,"A",0)
799.51^A^S^670
"KEY",799.51,799.51,"A",2,0)
^.312IA^3^3
"KEY",799.51,799.51,"A",2,1,0)
.02^799.51^1
"KEY",799.51,799.51,"A",2,2,0)
.03^799.51^2
"KEY",799.51,799.51,"A",2,3,0)
.04^799.51^3
"KEYPTR",798.1,798.1,"A")
798.1^B
"KEYPTR",798.1,798.11,"A")
798.11^B
"KEYPTR",798.1,798.118,"A")
798.118^B
"KEYPTR",798.1,798.122,"A")
798.122^B
"KEYPTR",798.1,798.128,"G")
798.128^G
"KEYPTR",798.1,798.129,"G")
798.129^G
"KEYPTR",798.1,798.13,"A")
798.13^B
"KEYPTR",798.2,798.2,"A")
798.2^B
"KEYPTR",798.2,798.26,"A")
798.26^B
"KEYPTR",799.31,799.31,"A")
799.31^B
"KEYPTR",799.51,799.51,"A")
799.51^KEY
"KRN",.84,1,-1)
0^22
"KRN",.84,1,0)
7981024.001^2^^CLINICAL CASE REGISTRIES^Hepatitis A Report (HTML)
"KRN",.84,1,2,0)
^^280^280^3170804^
"KRN",.84,1,2,1,0)
<?xml version="1.0"?>
"KRN",.84,1,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,1,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,1,2,4,0)
 
"KRN",.84,1,2,5,0)
<xsl:import  href="template://report/998/1"/>  <!-- Styles   -->
"KRN",.84,1,2,6,0)
<xsl:import  href="template://report/999/1"/>  <!-- Common   -->
"KRN",.84,1,2,7,0)
<xsl:include href="template://report/997/1"/>  <!-- Patients -->
"KRN",.84,1,2,8,0)
 
"KRN",.84,1,2,9,0)
<!-- Determine if vaccine parameters have been chosen for the report -->
"KRN",.84,1,2,10,0)
<xsl:variable name="D1" 
"KRN",.84,1,2,11,0)
select="/REPORT/PATIENTS/PATIENT/LABTESTS[1]/LTNAME"/>
"KRN",.84,1,2,12,0)
<xsl:variable name="D2" 
"KRN",.84,1,2,13,0)
select="/REPORT/PATIENTS/PATIENT/VACCINES/VACCINE[1]/VAC_NAME"/>
"KRN",.84,1,2,14,0)
<xsl:variable name="D3" select="REPORT/PARAMETERS/DATE_RANGE_7"/>
"KRN",.84,1,2,15,0)
 
"KRN",.84,1,2,16,0)
<!-- Determine if the ICN column is present on the report. -->  
"KRN",.84,1,2,17,0)
<xsl:variable name="icnyes" 
"KRN",.84,1,2,18,0)
select="count(/REPORT/HEADER/TBLDEF/COLUMN[@NAME='ICN']) &gt; 0"/>
"KRN",.84,1,2,19,0)
 
"KRN",.84,1,2,20,0)
<xsl:template match="/">
"KRN",.84,1,2,21,0)
  <html>
"KRN",.84,1,2,22,0)
    <head>
"KRN",.84,1,2,23,0)
      <title>Hepatitis A Report</title>
"KRN",.84,1,2,24,0)
      <xsl:call-template name="StyleSheet"/>
"KRN",.84,1,2,25,0)
    </head>
"KRN",.84,1,2,26,0)
    <body>
"KRN",.84,1,2,27,0)
      <h1>Hepatitis A Report</h1>
"KRN",.84,1,2,28,0)
      <xsl:call-template name="ReportHeader"/>
"KRN",.84,1,2,29,0)
      <div style="margin:10; color: red; font-weight: bold">
"KRN",.84,1,2,30,0)
 
"KRN",.84,1,2,31,0)
        <xsl:if test="$D3">
"KRN",.84,1,2,32,0)
          Lab tests used to calculate scores are identified by LOINC code.
"KRN",.84,1,2,33,0)
          If the values shown for test results appear unusual,
"KRN",.84,1,2,34,0)
          contact your local Lab ADPAC to verify that LOINC codes are set 
"KRN",.84,1,2,35,0)
up
"KRN",.84,1,2,36,0)
          correctly. The LOINC codes that are used are:
"KRN",.84,1,2,37,0)
          <br/>
"KRN",.84,1,2,38,0)
          <xsl:call-template name="ShowLOINCCodes"/>
"KRN",.84,1,2,39,0)
        </xsl:if>
"KRN",.84,1,2,40,0)
      </div>
"KRN",.84,1,2,41,0)
      <xsl:if test="count(/REPORT/PATIENTS/*) > 0">
"KRN",.84,1,2,42,0)
        <br />
"KRN",.84,1,2,43,0)
        <!-- The following line changed to fix page break issue in IE 7 
"KRN",.84,1,2,44,0)
-->
"KRN",.84,1,2,45,0)
        <div style="page-break-after:always; font-size:1; margin:0; 
"KRN",.84,1,2,46,0)
border:0">
"KRN",.84,1,2,47,0)
          <span style="visibility: hidden">-</span>
"KRN",.84,1,2,48,0)
        </div>
"KRN",.84,1,2,49,0)
        <div>
"KRN",.84,1,2,50,0)
          <xsl:call-template name="MakeScrollable">
"KRN",.84,1,2,51,0)
            <xsl:with-param name="condition" select="*[31]"/>
"KRN",.84,1,2,52,0)
          </xsl:call-template>
"KRN",.84,1,2,53,0)
          <xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,1,2,54,0)
        </div>
"KRN",.84,1,2,55,0)
      </xsl:if>
"KRN",.84,1,2,56,0)
    </body>
"KRN",.84,1,2,57,0)
  </html>
"KRN",.84,1,2,58,0)
</xsl:template>
"KRN",.84,1,2,59,0)
 
"KRN",.84,1,2,60,0)
<xsl:template name="ShowLOINCCodes">
"KRN",.84,1,2,61,0)
  <table cellpadding="5" cellspacing="0">
"KRN",.84,1,2,62,0)
    <thead>
"KRN",.84,1,2,63,0)
      <tr>
"KRN",.84,1,2,64,0)
        <th>LOINC Codes</th>
"KRN",.84,1,2,65,0)
      </tr>
"KRN",.84,1,2,66,0)
    </thead>
"KRN",.84,1,2,67,0)
    <tbody>
"KRN",.84,1,2,68,0)
      <xsl:for-each select="/REPORT/LOINC_CODES/CODE">
"KRN",.84,1,2,69,0)
        <tr>
"KRN",.84,1,2,70,0)
          <td class="aLeft">
"KRN",.84,1,2,71,0)
            <xsl:value-of select="@CODE"/>
"KRN",.84,1,2,72,0)
          </td>
"KRN",.84,1,2,73,0)
        </tr>
"KRN",.84,1,2,74,0)
      </xsl:for-each>
"KRN",.84,1,2,75,0)
    </tbody>
"KRN",.84,1,2,76,0)
  </table>
"KRN",.84,1,2,77,0)
</xsl:template>
"KRN",.84,1,2,78,0)
 
"KRN",.84,1,2,79,0)
<!--[ TABLE HEADERS ]-->
"KRN",.84,1,2,80,0)
 
"KRN",.84,1,2,81,0)
<xsl:template match="PARAMETERS/DATE_RANGE_6">
"KRN",.84,1,2,82,0)
  <xsl:if test="$D2">
"KRN",.84,1,2,83,0)
    <xsl:call-template name="DateRange">
"KRN",.84,1,2,84,0)
     <xsl:with-param name="title" select="'Vaccination'"/>
"KRN",.84,1,2,85,0)
    </xsl:call-template>
"KRN",.84,1,2,86,0)
  </xsl:if>
"KRN",.84,1,2,87,0)
</xsl:template>
"KRN",.84,1,2,88,0)
 
"KRN",.84,1,2,89,0)
<xsl:template match="PARAMETERS/DATE_RANGE_7">
"KRN",.84,1,2,90,0)
  <xsl:if test="$D1">
"KRN",.84,1,2,91,0)
    <xsl:call-template name="DateRange">
"KRN",.84,1,2,92,0)
     <xsl:with-param name="title" select="'Immunity'"/>
"KRN",.84,1,2,93,0)
    </xsl:call-template>
"KRN",.84,1,2,94,0)
  </xsl:if>
"KRN",.84,1,2,95,0)
</xsl:template>
"KRN",.84,1,2,96,0)
 
"KRN",.84,1,2,97,0)
<xsl:template match="HEADER/TBLDEF[@NAME='PATIENTS']/@HEADER">
"KRN",.84,1,2,98,0)
  <xsl:variable name="PTCOLS" select="../COLUMN[@NAME='PATIENTS']"/>
"KRN",.84,1,2,99,0)
  <xsl:variable name="VACLST" select="../COLUMN[@NAME='VACCINES']"/>
"KRN",.84,1,2,100,0)
  <xsl:variable name="IMMLST" select="../COLUMN[@NAME='LABTESTS']"/>
"KRN",.84,1,2,101,0)
  <xsl:variable name="ICNCOL" select="../COLUMN[@NAME='ICN']"/>
"KRN",.84,1,2,102,0)
 
"KRN",.84,1,2,103,0)
  <thead>
"KRN",.84,1,2,104,0)
    <tr>
"KRN",.84,1,2,105,0)
      <xsl:choose>
"KRN",.84,1,2,106,0)
        <xsl:when test="$AGE_YES or $DOB_YES">
"KRN",.84,1,2,107,0)
          <xsl:call-template name="ColumnHeader">
"KRN",.84,1,2,108,0)
            <xsl:with-param name="column" select="$PTCOLS"/>
"KRN",.84,1,2,109,0)
            <xsl:with-param name="title" select="' '"/>
"KRN",.84,1,2,110,0)
            <xsl:with-param name="width" select="'24%'"/>
"KRN",.84,1,2,111,0)
            <xsl:with-param name="colspan" select="5"/>
"KRN",.84,1,2,112,0)
          </xsl:call-template>
"KRN",.84,1,2,113,0)
        </xsl:when>
"KRN",.84,1,2,114,0)
        <xsl:otherwise>
"KRN",.84,1,2,115,0)
          <xsl:call-template name="ColumnHeader">
"KRN",.84,1,2,116,0)
            <xsl:with-param name="column" select="$PTCOLS"/>
"KRN",.84,1,2,117,0)
            <xsl:with-param name="title" select="' '"/>
"KRN",.84,1,2,118,0)
            <xsl:with-param name="width" select="'24%'"/>
"KRN",.84,1,2,119,0)
            <xsl:with-param name="colspan" select="4"/>
"KRN",.84,1,2,120,0)
          </xsl:call-template>
"KRN",.84,1,2,121,0)
        </xsl:otherwise>
"KRN",.84,1,2,122,0)
      </xsl:choose> 
"KRN",.84,1,2,123,0)
 
"KRN",.84,1,2,124,0)
      <xsl:if test="$D2">
"KRN",.84,1,2,125,0)
        <xsl:call-template name="ColumnHeader">
"KRN",.84,1,2,126,0)
          <xsl:with-param name="column" select="$VACLST"/>
"KRN",.84,1,2,127,0)
          <xsl:with-param name="title" select="'Vaccination'"/>
"KRN",.84,1,2,128,0)
          <xsl:with-param name="width" select="'24%'"/>
"KRN",.84,1,2,129,0)
          <xsl:with-param name="colspan" select="2"/>
"KRN",.84,1,2,130,0)
        </xsl:call-template>
"KRN",.84,1,2,131,0)
      </xsl:if>
"KRN",.84,1,2,132,0)
 
"KRN",.84,1,2,133,0)
      <xsl:if test="$D1">
"KRN",.84,1,2,134,0)
        <xsl:call-template name="ColumnHeader">
"KRN",.84,1,2,135,0)
          <xsl:with-param name="column" select="$IMMLST"/>
"KRN",.84,1,2,136,0)
          <xsl:with-param name="title" select="'Immunity'"/>
"KRN",.84,1,2,137,0)
          <xsl:with-param name="width" select="'24%'"/>
"KRN",.84,1,2,138,0)
          <xsl:with-param name="colspan" select="3"/>
"KRN",.84,1,2,139,0)
        </xsl:call-template>
"KRN",.84,1,2,140,0)
      </xsl:if>
"KRN",.84,1,2,141,0)
 
"KRN",.84,1,2,142,0)
      <xsl:if test="$icnyes or $PACT_YES or $PCP_YES">
"KRN",.84,1,2,143,0)
        <xsl:variable name="COLCOUNT" 
"KRN",.84,1,2,144,0)
select="number($icnyes)+number($PACT_YES)+number($PCP_YES)"/>
"KRN",.84,1,2,145,0)
        <xsl:call-template name="ColumnHeader">
"KRN",.84,1,2,146,0)
          <xsl:with-param name="column" select="$ICNCOL"/>
"KRN",.84,1,2,147,0)
          <xsl:with-param name="title" select="' '"/>
"KRN",.84,1,2,148,0)
          <xsl:with-param name="width" select="'15%'"/>
"KRN",.84,1,2,149,0)
          <xsl:with-param name="colspan" select="$COLCOUNT"/>
"KRN",.84,1,2,150,0)
        </xsl:call-template>
"KRN",.84,1,2,151,0)
      </xsl:if>
"KRN",.84,1,2,152,0)
    </tr>
"KRN",.84,1,2,153,0)
 
"KRN",.84,1,2,154,0)
    <tr>
"KRN",.84,1,2,155,0)
      <xsl:choose>
"KRN",.84,1,2,156,0)
        <xsl:when test="$AGE_YES or $DOB_YES">
"KRN",.84,1,2,157,0)
          <xsl:call-template name="BasicPatientHeader">
"KRN",.84,1,2,158,0)
            <xsl:with-param name="column" select="PATIENT"/>
"KRN",.84,1,2,159,0)
            <xsl:with-param name="colspan" select="5"/>
"KRN",.84,1,2,160,0)
          </xsl:call-template>
"KRN",.84,1,2,161,0)
        </xsl:when>
"KRN",.84,1,2,162,0)
        <xsl:otherwise>
"KRN",.84,1,2,163,0)
          <xsl:call-template name="BasicPatientHeader">
"KRN",.84,1,2,164,0)
            <xsl:with-param name="column" select="PATIENT"/>
"KRN",.84,1,2,165,0)
            <xsl:with-param name="colspan" select="4"/>
"KRN",.84,1,2,166,0)
          </xsl:call-template>
"KRN",.84,1,2,167,0)
        </xsl:otherwise>
"KRN",.84,1,2,168,0)
      </xsl:choose> 
"KRN",.84,1,2,169,0)
 
"KRN",.84,1,2,170,0)
      <xsl:if test="$D2">
"KRN",.84,1,2,171,0)
        <xsl:call-template name="ColumnHeader">
"KRN",.84,1,2,172,0)
          <xsl:with-param name="column" select="VAC_NAME"/>
"KRN",.84,1,2,173,0)
          <xsl:with-param name="title" select="'Name'"/>
"KRN",.84,1,2,174,0)
          <xsl:with-param name="width" select="'15%'"/>
"KRN",.84,1,2,175,0)
          <xsl:with-param name="colspan" select="1"/>
"KRN",.84,1,2,176,0)
        </xsl:call-template>
"KRN",.84,1,2,177,0)
        <xsl:call-template name="ColumnHeader">
"KRN",.84,1,2,178,0)
          <xsl:with-param name="column" select="VAC_DATE"/>
"KRN",.84,1,2,179,0)
          <xsl:with-param name="title" select="'Date'"/>
"KRN",.84,1,2,180,0)
          <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,1,2,181,0)
          <xsl:with-param name="colspan" select="1"/>
"KRN",.84,1,2,182,0)
        </xsl:call-template>
"KRN",.84,1,2,183,0)
      </xsl:if>
"KRN",.84,1,2,184,0)
 
"KRN",.84,1,2,185,0)
      <xsl:if test="$D1">
"KRN",.84,1,2,186,0)
        <xsl:call-template name="ColumnHeader">
"KRN",.84,1,2,187,0)
          <xsl:with-param name="column" select="LTNAME"/>
"KRN",.84,1,2,188,0)
          <xsl:with-param name="title" select="'Test Name'"/>
"KRN",.84,1,2,189,0)
          <xsl:with-param name="width" select="'15%'"/>
"KRN",.84,1,2,190,0)
          <xsl:with-param name="colspan" select="1"/>
"KRN",.84,1,2,191,0)
        </xsl:call-template>
"KRN",.84,1,2,192,0)
        <xsl:call-template name="ColumnHeader">
"KRN",.84,1,2,193,0)
          <xsl:with-param name="column" select="DATE"/>
"KRN",.84,1,2,194,0)
          <xsl:with-param name="title" select="'Test Date'"/>
"KRN",.84,1,2,195,0)
          <xsl:with-param name="width" select="'8%'"/>
"KRN",.84,1,2,196,0)
          <xsl:with-param name="colspan" select="1"/>
"KRN",.84,1,2,197,0)
        </xsl:call-template>
"KRN",.84,1,2,198,0)
        <xsl:call-template name="ColumnHeader">
"KRN",.84,1,2,199,0)
          <xsl:with-param name="column" select="RESULT"/>
"KRN",.84,1,2,200,0)
          <xsl:with-param name="title" select="'Result'"/>
"KRN",.84,1,2,201,0)
          <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,1,2,202,0)
          <xsl:with-param name="colspan" select="1"/>
"KRN",.84,1,2,203,0)
        </xsl:call-template>
"KRN",.84,1,2,204,0)
      </xsl:if>
"KRN",.84,1,2,205,0)
 
"KRN",.84,1,2,206,0)
      <xsl:if test="$icnyes">
"KRN",.84,1,2,207,0)
        <xsl:call-template name="ColumnHeader">
"KRN",.84,1,2,208,0)
          <xsl:with-param name="column" select="ICN"/>
"KRN",.84,1,2,209,0)
          <xsl:with-param name="title" select="'ICN'"/>
"KRN",.84,1,2,210,0)
          <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,1,2,211,0)
          <xsl:with-param name="colspan" select="1"/>
"KRN",.84,1,2,212,0)
        </xsl:call-template>
"KRN",.84,1,2,213,0)
      </xsl:if>
"KRN",.84,1,2,214,0)
      <xsl:if test="$PACT_YES">
"KRN",.84,1,2,215,0)
        <xsl:call-template name="ColumnHeader">
"KRN",.84,1,2,216,0)
          <xsl:with-param name="column" select="PACT"/>
"KRN",.84,1,2,217,0)
          <xsl:with-param name="title" select="'PACT'"/>
"KRN",.84,1,2,218,0)
          <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,1,2,219,0)
          <xsl:with-param name="colspan" select="1"/>
"KRN",.84,1,2,220,0)
        </xsl:call-template>
"KRN",.84,1,2,221,0)
      </xsl:if>
"KRN",.84,1,2,222,0)
      <xsl:if test="$PCP_YES">
"KRN",.84,1,2,223,0)
        <xsl:call-template name="ColumnHeader">
"KRN",.84,1,2,224,0)
          <xsl:with-param name="column" select="PCP"/>
"KRN",.84,1,2,225,0)
          <xsl:with-param name="title" select="'PCP'"/>
"KRN",.84,1,2,226,0)
          <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,1,2,227,0)
          <xsl:with-param name="colspan" select="1"/>
"KRN",.84,1,2,228,0)
        </xsl:call-template>
"KRN",.84,1,2,229,0)
      </xsl:if>
"KRN",.84,1,2,230,0)
    </tr>
"KRN",.84,1,2,231,0)
  </thead>
"KRN",.84,1,2,232,0)
</xsl:template>
"KRN",.84,1,2,233,0)
 
"KRN",.84,1,2,234,0)
<!--[ TABLE CELLS ]-->
"KRN",.84,1,2,235,0)
 
"KRN",.84,1,2,236,0)
<xsl:template match="PATIENT/VACCINES">
"KRN",.84,1,2,237,0)
  <td>
"KRN",.84,1,2,238,0)
    <xsl:for-each select="VACCINE">
"KRN",.84,1,2,239,0)
      <xsl:call-template name="CellValue">
"KRN",.84,1,2,240,0)
        <xsl:with-param name="value" select="VAC_NAME"/>
"KRN",.84,1,2,241,0)
        <xsl:with-param name="width" select="'9%'"/>
"KRN",.84,1,2,242,0)
      </xsl:call-template>
"KRN",.84,1,2,243,0)
      <br />
"KRN",.84,1,2,244,0)
    </xsl:for-each>
"KRN",.84,1,2,245,0)
  </td>
"KRN",.84,1,2,246,0)
  <td>
"KRN",.84,1,2,247,0)
    <xsl:for-each select="VACCINE">
"KRN",.84,1,2,248,0)
      <xsl:call-template name="CellValue">
"KRN",.84,1,2,249,0)
        <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,1,2,250,0)
        <xsl:with-param name="value" select="VAC_DATE"/>
"KRN",.84,1,2,251,0)
        <xsl:with-param name="width" select="'4%'"/>
"KRN",.84,1,2,252,0)
      </xsl:call-template>
"KRN",.84,1,2,253,0)
      <br />
"KRN",.84,1,2,254,0)
    </xsl:for-each>
"KRN",.84,1,2,255,0)
  </td>
"KRN",.84,1,2,256,0)
</xsl:template>
"KRN",.84,1,2,257,0)
 
"KRN",.84,1,2,258,0)
<xsl:template match="PATIENT/LABTESTS">
"KRN",.84,1,2,259,0)
  <td>
"KRN",.84,1,2,260,0)
    <xsl:call-template name="CellValue">
"KRN",.84,1,2,261,0)
      <xsl:with-param name="value" select="LTNAME"/>
"KRN",.84,1,2,262,0)
      <xsl:with-param name="width" select="'8%'"/>
"KRN",.84,1,2,263,0)
    </xsl:call-template>
"KRN",.84,1,2,264,0)
  </td>
"KRN",.84,1,2,265,0)
  <td>
"KRN",.84,1,2,266,0)
    <xsl:call-template name="CellValue">
"KRN",.84,1,2,267,0)
      <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,1,2,268,0)
      <xsl:with-param name="value" select="DATE"/>
"KRN",.84,1,2,269,0)
      <xsl:with-param name="width" select="'4%'"/>
"KRN",.84,1,2,270,0)
    </xsl:call-template>
"KRN",.84,1,2,271,0)
  </td>
"KRN",.84,1,2,272,0)
  <td>
"KRN",.84,1,2,273,0)
    <xsl:call-template name="CellValue">
"KRN",.84,1,2,274,0)
      <xsl:with-param name="value" select="RESULT"/>
"KRN",.84,1,2,275,0)
      <xsl:with-param name="width" select="'8%'"/>
"KRN",.84,1,2,276,0)
    </xsl:call-template>
"KRN",.84,1,2,277,0)
  </td>
"KRN",.84,1,2,278,0)
</xsl:template>
"KRN",.84,1,2,279,0)
 
"KRN",.84,1,2,280,0)
</xsl:stylesheet>
"KRN",.84,1,3,0)
^.845A
"KRN",.84,1,5,0)
^.841A
"KRN",.84,7981002.001,-1)
0^34
"KRN",.84,7981002.001,0)
7981002.001^2^^CLINICAL CASE REGISTRIES^Current Inpatient List (HTML)
"KRN",.84,7981002.001,2,0)
^^44^44^3170803^
"KRN",.84,7981002.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981002.001,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981002.001,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981002.001,2,4,0)
 
"KRN",.84,7981002.001,2,5,0)
<xsl:import  href="template://report/998/1"/>  <!-- Styles   -->
"KRN",.84,7981002.001,2,6,0)
<xsl:import  href="template://report/999/1"/>  <!-- Common   -->
"KRN",.84,7981002.001,2,7,0)
<xsl:include href="template://report/997/1"/>  <!-- Patients -->
"KRN",.84,7981002.001,2,8,0)
 
"KRN",.84,7981002.001,2,9,0)
<xsl:template match="/">
"KRN",.84,7981002.001,2,10,0)
<html>
"KRN",.84,7981002.001,2,11,0)
  <head>
"KRN",.84,7981002.001,2,12,0)
   <title>Current Inpatient List</title>
"KRN",.84,7981002.001,2,13,0)
   <xsl:call-template name="StyleSheet"/>
"KRN",.84,7981002.001,2,14,0)
  </head>
"KRN",.84,7981002.001,2,15,0)
  <body>
"KRN",.84,7981002.001,2,16,0)
   <h1>Current Inpatient List</h1>
"KRN",.84,7981002.001,2,17,0)
   <xsl:call-template name="ReportHeader"/>
"KRN",.84,7981002.001,2,18,0)
   <!-- The following line added to fix page break issue in IE 7 -->
"KRN",.84,7981002.001,2,19,0)
   <div style="page-break-after:always; font-size:1; margin:0; 
"KRN",.84,7981002.001,2,20,0)
border:0"><span style="visibility: hidden">-</span></div>
"KRN",.84,7981002.001,2,21,0)
   <div>
"KRN",.84,7981002.001,2,22,0)
    <xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981002.001,2,23,0)
   </div>
"KRN",.84,7981002.001,2,24,0)
  </body>
"KRN",.84,7981002.001,2,25,0)
</html>
"KRN",.84,7981002.001,2,26,0)
</xsl:template>
"KRN",.84,7981002.001,2,27,0)
 
"KRN",.84,7981002.001,2,28,0)
<!--[ COLUMN HEADERS ]--> 
"KRN",.84,7981002.001,2,29,0)
 
"KRN",.84,7981002.001,2,30,0)
<xsl:template match="COLUMN[@NAME='ROOM-BED']">
"KRN",.84,7981002.001,2,31,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981002.001,2,32,0)
  <xsl:with-param name="title" select="'Room-Bed'"/>
"KRN",.84,7981002.001,2,33,0)
  <xsl:with-param name="width" select="'15%'"/>
"KRN",.84,7981002.001,2,34,0)
</xsl:call-template>
"KRN",.84,7981002.001,2,35,0)
</xsl:template>
"KRN",.84,7981002.001,2,36,0)
 
"KRN",.84,7981002.001,2,37,0)
<xsl:template match="COLUMN[@NAME='WARD']">
"KRN",.84,7981002.001,2,38,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981002.001,2,39,0)
  <xsl:with-param name="title" select="'Ward'"/>
"KRN",.84,7981002.001,2,40,0)
  <xsl:with-param name="width" select="'15%'"/>
"KRN",.84,7981002.001,2,41,0)
</xsl:call-template>
"KRN",.84,7981002.001,2,42,0)
</xsl:template>
"KRN",.84,7981002.001,2,43,0)
 
"KRN",.84,7981002.001,2,44,0)
</xsl:stylesheet>
"KRN",.84,7981002.002,-1)
0^31
"KRN",.84,7981002.002,0)
7981002.002^2^^CLINICAL CASE REGISTRIES^Current Inpatient List (CSV)
"KRN",.84,7981002.002,2,0)
^^40^40^3170803^
"KRN",.84,7981002.002,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981002.002,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981002.002,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981002.002,2,4,0)
 
"KRN",.84,7981002.002,2,5,0)
<xsl:import href="template://report/999/2"/>  <!-- Common   -->
"KRN",.84,7981002.002,2,6,0)
 
"KRN",.84,7981002.002,2,7,0)
<xsl:template match="/">
"KRN",.84,7981002.002,2,8,0)
<xsl:text>Current Inpatient List</xsl:text>
"KRN",.84,7981002.002,2,9,0)
<xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981002.002,2,10,0)
</xsl:template>
"KRN",.84,7981002.002,2,11,0)
 
"KRN",.84,7981002.002,2,12,0)
<!--[ COLUMN HEADERS ]--> 
"KRN",.84,7981002.002,2,13,0)
 
"KRN",.84,7981002.002,2,14,0)
<xsl:template match="COLUMN[@NAME='DOB']">
"KRN",.84,7981002.002,2,15,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981002.002,2,16,0)
  <xsl:with-param name="title" select="'Date of Birth'"/>
"KRN",.84,7981002.002,2,17,0)
</xsl:call-template>
"KRN",.84,7981002.002,2,18,0)
</xsl:template>
"KRN",.84,7981002.002,2,19,0)
 
"KRN",.84,7981002.002,2,20,0)
<xsl:template match="COLUMN[@NAME='ROOM-BED']">
"KRN",.84,7981002.002,2,21,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981002.002,2,22,0)
  <xsl:with-param name="title" select="'Room-Bed'"/>
"KRN",.84,7981002.002,2,23,0)
</xsl:call-template>
"KRN",.84,7981002.002,2,24,0)
</xsl:template>
"KRN",.84,7981002.002,2,25,0)
 
"KRN",.84,7981002.002,2,26,0)
<xsl:template match="COLUMN[@NAME='WARD']">
"KRN",.84,7981002.002,2,27,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981002.002,2,28,0)
  <xsl:with-param name="title" select="'Ward'"/>
"KRN",.84,7981002.002,2,29,0)
</xsl:call-template>
"KRN",.84,7981002.002,2,30,0)
</xsl:template>
"KRN",.84,7981002.002,2,31,0)
 
"KRN",.84,7981002.002,2,32,0)
<!--[ CELL VALUES ]-->
"KRN",.84,7981002.002,2,33,0)
 
"KRN",.84,7981002.002,2,34,0)
<xsl:template match="PATIENT/DOB">
"KRN",.84,7981002.002,2,35,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981002.002,2,36,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981002.002,2,37,0)
</xsl:call-template>
"KRN",.84,7981002.002,2,38,0)
</xsl:template>
"KRN",.84,7981002.002,2,39,0)
 
"KRN",.84,7981002.002,2,40,0)
</xsl:stylesheet>
"KRN",.84,7981003.001,-1)
0^21
"KRN",.84,7981003.001,0)
7981003.001^2^^CLINICAL CASE REGISTRIES^General Utiliz. and Demogr. (HTML)
"KRN",.84,7981003.001,2,0)
^^315^315^3170804^
"KRN",.84,7981003.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981003.001,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981003.001,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981003.001,2,4,0)
 
"KRN",.84,7981003.001,2,5,0)
<xsl:import  href="template://report/998/1"/>  <!-- Styles   --> 
"KRN",.84,7981003.001,2,6,0)
<xsl:import  href="template://report/999/1"/>  <!-- Common   -->
"KRN",.84,7981003.001,2,7,0)
<xsl:include href="template://report/997/1"/>  <!-- Patients 
"KRN",.84,7981003.001,2,8,0)
-->            
"KRN",.84,7981003.001,2,9,0)
 
"KRN",.84,7981003.001,2,10,0)
<xsl:template match="/">
"KRN",.84,7981003.001,2,11,0)
<xsl:variable name="sum" select="/REPORT/SUMMARY"/>
"KRN",.84,7981003.001,2,12,0)
<xsl:variable name="wide_summaries" 
"KRN",.84,7981003.001,2,13,0)
     select="$sum/RISK_FACTORS|$sum/RACE_SUMMARY|$sum/ETHN_SUMMARY|
"KRN",.84,7981003.001,2,14,0)
             $sum/UTIL_CODES"/>
"KRN",.84,7981003.001,2,15,0)
<xsl:variable name="narrow_summaries" 
"KRN",.84,7981003.001,2,16,0)
     select="$sum/AGE_SUMMARY|$sum/SEX_SUMMARY|$sum/BIRTHSEX_SUMMARY|
"KRN",.84,7981003.001,2,17,0)
             $sum/DOB_SUMMARY|$sum/DOD_SUMMARY|
"KRN",.84,7981003.001,2,18,0)
             $sum/SELDT_SUMMARY|$sum/CONFDT_SUMMARY"/>
"KRN",.84,7981003.001,2,19,0)
<html>
"KRN",.84,7981003.001,2,20,0)
  <head>
"KRN",.84,7981003.001,2,21,0)
   <title>General Utilization and Demographics</title>
"KRN",.84,7981003.001,2,22,0)
   <xsl:call-template name="StyleSheet"/>
"KRN",.84,7981003.001,2,23,0)
  </head>
"KRN",.84,7981003.001,2,24,0)
  <body>
"KRN",.84,7981003.001,2,25,0)
   <h1>General Utilization and Demographics</h1>
"KRN",.84,7981003.001,2,26,0)
   <xsl:call-template name="ReportHeader"/>
"KRN",.84,7981003.001,2,27,0)
   <xsl:choose>
"KRN",.84,7981003.001,2,28,0)
    <xsl:when test="/REPORT/PATIENTS/*[1] or $sum/*[1]">
"KRN",.84,7981003.001,2,29,0)
     <!-- The following line added to fix page break issue in IE 7 -->
"KRN",.84,7981003.001,2,30,0)
     <div style="page-break-after:always; font-size:1; margin:0; 
"KRN",.84,7981003.001,2,31,0)
border:0"><span style="visibility: hidden">-</span></div>
"KRN",.84,7981003.001,2,32,0)
     <div>
"KRN",.84,7981003.001,2,33,0)
      <xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981003.001,2,34,0)
     </div>
"KRN",.84,7981003.001,2,35,0)
    </xsl:when>
"KRN",.84,7981003.001,2,36,0)
    <xsl:otherwise>
"KRN",.84,7981003.001,2,37,0)
     <xsl:call-template name="TableNoData"/>
"KRN",.84,7981003.001,2,38,0)
    </xsl:otherwise>
"KRN",.84,7981003.001,2,39,0)
   </xsl:choose>
"KRN",.84,7981003.001,2,40,0)
   <xsl:if test="$sum/*[1]">
"KRN",.84,7981003.001,2,41,0)
    <div class="reportSummary">
"KRN",.84,7981003.001,2,42,0)
     <xsl:if test="$wide_summaries">
"KRN",.84,7981003.001,2,43,0)
      <div style="float:left; width:68%; margin-right:1%">
"KRN",.84,7981003.001,2,44,0)
       <xsl:apply-templates select="$wide_summaries"/>
"KRN",.84,7981003.001,2,45,0)
      </div>
"KRN",.84,7981003.001,2,46,0)
     </xsl:if>
"KRN",.84,7981003.001,2,47,0)
     <xsl:if test="$narrow_summaries">
"KRN",.84,7981003.001,2,48,0)
      <div style="float:left; width:30%">
"KRN",.84,7981003.001,2,49,0)
       <xsl:apply-templates select="$narrow_summaries"/>
"KRN",.84,7981003.001,2,50,0)
      </div>
"KRN",.84,7981003.001,2,51,0)
     </xsl:if>
"KRN",.84,7981003.001,2,52,0)
    </div>
"KRN",.84,7981003.001,2,53,0)
   </xsl:if>
"KRN",.84,7981003.001,2,54,0)
  </body>
"KRN",.84,7981003.001,2,55,0)
</html>
"KRN",.84,7981003.001,2,56,0)
</xsl:template>
"KRN",.84,7981003.001,2,57,0)
 
"KRN",.84,7981003.001,2,58,0)
<!--[ UTILITIES ]-->
"KRN",.84,7981003.001,2,59,0)
 
"KRN",.84,7981003.001,2,60,0)
<xsl:template name="SummaryLine">
"KRN",.84,7981003.001,2,61,0)
<xsl:param name="line" select="."/>
"KRN",.84,7981003.001,2,62,0)
<td class="aLeft"><xsl:value-of select="$line"/></td>
"KRN",.84,7981003.001,2,63,0)
<td>
"KRN",.84,7981003.001,2,64,0)
  <xsl:value-of select="$line/@COUNT"/>
"KRN",.84,7981003.001,2,65,0)
  <xsl:if test="$line/@COUNT=''">&#160;</xsl:if>
"KRN",.84,7981003.001,2,66,0)
</td>
"KRN",.84,7981003.001,2,67,0)
</xsl:template>
"KRN",.84,7981003.001,2,68,0)
 
"KRN",.84,7981003.001,2,69,0)
<!--[ COLUMN HEADERS ]-->
"KRN",.84,7981003.001,2,70,0)
 
"KRN",.84,7981003.001,2,71,0)
<xsl:template match="COLUMN[@NAME='RISK']">
"KRN",.84,7981003.001,2,72,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981003.001,2,73,0)
  <xsl:with-param name="title" select="'Risk Factors'"/>
"KRN",.84,7981003.001,2,74,0)
  <xsl:with-param name="sort" select="''"/>
"KRN",.84,7981003.001,2,75,0)
</xsl:call-template>
"KRN",.84,7981003.001,2,76,0)
</xsl:template>
"KRN",.84,7981003.001,2,77,0)
 
"KRN",.84,7981003.001,2,78,0)
<xsl:template match="COLUMN[@NAME='UTIL']">
"KRN",.84,7981003.001,2,79,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981003.001,2,80,0)
  <xsl:with-param name="title" select="'Utilization'"/>
"KRN",.84,7981003.001,2,81,0)
  <xsl:with-param name="sort" select="''"/>
"KRN",.84,7981003.001,2,82,0)
</xsl:call-template>
"KRN",.84,7981003.001,2,83,0)
</xsl:template>
"KRN",.84,7981003.001,2,84,0)
 
"KRN",.84,7981003.001,2,85,0)
<!--[ SUMMARY TABLES ]--> 
"KRN",.84,7981003.001,2,86,0)
 
"KRN",.84,7981003.001,2,87,0)
<xsl:template match="SUMMARY/AGE_SUMMARY">
"KRN",.84,7981003.001,2,88,0)
<xsl:param name="summary" select="."/>
"KRN",.84,7981003.001,2,89,0)
<xsl:if test="$summary/*[1]">
"KRN",.84,7981003.001,2,90,0)
  <table cellpadding="3" cellspacing="0">
"KRN",.84,7981003.001,2,91,0)
   <caption>Age Summary</caption>
"KRN",.84,7981003.001,2,92,0)
   <thead>
"KRN",.84,7981003.001,2,93,0)
    <tr>
"KRN",.84,7981003.001,2,94,0)
     <th>Age</th>
"KRN",.84,7981003.001,2,95,0)
     <th width="30">Count<br/>(Value)</th>
"KRN",.84,7981003.001,2,96,0)
    </tr>
"KRN",.84,7981003.001,2,97,0)
   </thead>
"KRN",.84,7981003.001,2,98,0)
   <tbody>
"KRN",.84,7981003.001,2,99,0)
    <xsl:for-each select="$summary/AGE">
"KRN",.84,7981003.001,2,100,0)
    <tr><xsl:call-template name="SummaryLine"/></tr>
"KRN",.84,7981003.001,2,101,0)
    </xsl:for-each>
"KRN",.84,7981003.001,2,102,0)
   </tbody>
"KRN",.84,7981003.001,2,103,0)
  </table>
"KRN",.84,7981003.001,2,104,0)
</xsl:if>
"KRN",.84,7981003.001,2,105,0)
</xsl:template>
"KRN",.84,7981003.001,2,106,0)
 
"KRN",.84,7981003.001,2,107,0)
<xsl:template match="SUMMARY/CONFDT_SUMMARY">
"KRN",.84,7981003.001,2,108,0)
<xsl:param name="summary" select="."/>
"KRN",.84,7981003.001,2,109,0)
<xsl:if test="$summary/*[1]">
"KRN",.84,7981003.001,2,110,0)
  <table cellpadding="3" cellspacing="0">
"KRN",.84,7981003.001,2,111,0)
   <caption>Confirmation Date Summary</caption>
"KRN",.84,7981003.001,2,112,0)
   <thead>
"KRN",.84,7981003.001,2,113,0)
    <tr>
"KRN",.84,7981003.001,2,114,0)
     <th>Confirmation Date</th>
"KRN",.84,7981003.001,2,115,0)
     <th width="30">Count</th>
"KRN",.84,7981003.001,2,116,0)
    </tr>
"KRN",.84,7981003.001,2,117,0)
   </thead>
"KRN",.84,7981003.001,2,118,0)
   <tbody>
"KRN",.84,7981003.001,2,119,0)
    <xsl:for-each select="$summary/CONFDT">
"KRN",.84,7981003.001,2,120,0)
     <tr><xsl:call-template name="SummaryLine"/></tr>
"KRN",.84,7981003.001,2,121,0)
    </xsl:for-each>
"KRN",.84,7981003.001,2,122,0)
   </tbody>
"KRN",.84,7981003.001,2,123,0)
  </table>
"KRN",.84,7981003.001,2,124,0)
</xsl:if>
"KRN",.84,7981003.001,2,125,0)
</xsl:template>
"KRN",.84,7981003.001,2,126,0)
 
"KRN",.84,7981003.001,2,127,0)
<xsl:template match="SUMMARY/DOB_SUMMARY">
"KRN",.84,7981003.001,2,128,0)
<xsl:param name="summary" select="."/>
"KRN",.84,7981003.001,2,129,0)
<xsl:if test="$summary/*[1]">
"KRN",.84,7981003.001,2,130,0)
  <table cellpadding="3" cellspacing="0">
"KRN",.84,7981003.001,2,131,0)
   <caption>Date of Birth Summary</caption>
"KRN",.84,7981003.001,2,132,0)
   <thead>
"KRN",.84,7981003.001,2,133,0)
    <tr>
"KRN",.84,7981003.001,2,134,0)
     <th>Date of Birth</th>
"KRN",.84,7981003.001,2,135,0)
     <th width="30">Count</th>
"KRN",.84,7981003.001,2,136,0)
    </tr>
"KRN",.84,7981003.001,2,137,0)
   </thead>
"KRN",.84,7981003.001,2,138,0)
   <tbody>
"KRN",.84,7981003.001,2,139,0)
    <xsl:for-each select="$summary/DOB">
"KRN",.84,7981003.001,2,140,0)
     <tr><xsl:call-template name="SummaryLine"/></tr>
"KRN",.84,7981003.001,2,141,0)
    </xsl:for-each>
"KRN",.84,7981003.001,2,142,0)
   </tbody>
"KRN",.84,7981003.001,2,143,0)
  </table>
"KRN",.84,7981003.001,2,144,0)
</xsl:if>
"KRN",.84,7981003.001,2,145,0)
</xsl:template>
"KRN",.84,7981003.001,2,146,0)
 
"KRN",.84,7981003.001,2,147,0)
<xsl:template match="SUMMARY/DOD_SUMMARY">
"KRN",.84,7981003.001,2,148,0)
<xsl:param name="summary" select="."/>
"KRN",.84,7981003.001,2,149,0)
<xsl:if test="$summary/*[1]">
"KRN",.84,7981003.001,2,150,0)
  <table cellpadding="3" cellspacing="0">
"KRN",.84,7981003.001,2,151,0)
   <caption>Date of Death Summary</caption>
"KRN",.84,7981003.001,2,152,0)
   <thead>
"KRN",.84,7981003.001,2,153,0)
    <tr>
"KRN",.84,7981003.001,2,154,0)
     <th>Date of Death</th>
"KRN",.84,7981003.001,2,155,0)
     <th width="30">Count</th>
"KRN",.84,7981003.001,2,156,0)
    </tr>
"KRN",.84,7981003.001,2,157,0)
   </thead>
"KRN",.84,7981003.001,2,158,0)
   <tbody>
"KRN",.84,7981003.001,2,159,0)
    <xsl:for-each select="$summary/DOD">
"KRN",.84,7981003.001,2,160,0)
     <tr><xsl:call-template name="SummaryLine"/></tr>
"KRN",.84,7981003.001,2,161,0)
    </xsl:for-each>
"KRN",.84,7981003.001,2,162,0)
   </tbody>
"KRN",.84,7981003.001,2,163,0)
  </table>
"KRN",.84,7981003.001,2,164,0)
</xsl:if>
"KRN",.84,7981003.001,2,165,0)
</xsl:template>
"KRN",.84,7981003.001,2,166,0)
 
"KRN",.84,7981003.001,2,167,0)
<xsl:template match="SUMMARY/ETHN_SUMMARY">
"KRN",.84,7981003.001,2,168,0)
<xsl:param name="summary" select="."/>
"KRN",.84,7981003.001,2,169,0)
<xsl:if test="$summary/*[1]">
"KRN",.84,7981003.001,2,170,0)
  <table cellpadding="3" cellspacing="0">
"KRN",.84,7981003.001,2,171,0)
   <caption>Ethnicity Summary</caption>
"KRN",.84,7981003.001,2,172,0)
   <thead>
"KRN",.84,7981003.001,2,173,0)
    <tr>
"KRN",.84,7981003.001,2,174,0)
     <th>Ethnicity</th>
"KRN",.84,7981003.001,2,175,0)
     <th width="30">Count</th>
"KRN",.84,7981003.001,2,176,0)
    </tr>
"KRN",.84,7981003.001,2,177,0)
   </thead>
"KRN",.84,7981003.001,2,178,0)
   <tbody>
"KRN",.84,7981003.001,2,179,0)
    <xsl:for-each select="$summary/ETHN">
"KRN",.84,7981003.001,2,180,0)
     <tr><xsl:call-template name="SummaryLine"/></tr>
"KRN",.84,7981003.001,2,181,0)
    </xsl:for-each>
"KRN",.84,7981003.001,2,182,0)
   </tbody>
"KRN",.84,7981003.001,2,183,0)
  </table>
"KRN",.84,7981003.001,2,184,0)
</xsl:if>
"KRN",.84,7981003.001,2,185,0)
</xsl:template>
"KRN",.84,7981003.001,2,186,0)
 
"KRN",.84,7981003.001,2,187,0)
<xsl:template match="SUMMARY/RACE_SUMMARY">
"KRN",.84,7981003.001,2,188,0)
<xsl:param name="summary" select="."/>
"KRN",.84,7981003.001,2,189,0)
<xsl:if test="$summary/*[1]">
"KRN",.84,7981003.001,2,190,0)
  <table cellpadding="3" cellspacing="0">
"KRN",.84,7981003.001,2,191,0)
  <caption>Race Summary</caption>
"KRN",.84,7981003.001,2,192,0)
   <thead>
"KRN",.84,7981003.001,2,193,0)
    <tr>
"KRN",.84,7981003.001,2,194,0)
     <th>Race</th>
"KRN",.84,7981003.001,2,195,0)
     <th width="30">Count</th>
"KRN",.84,7981003.001,2,196,0)
    </tr>
"KRN",.84,7981003.001,2,197,0)
   </thead>
"KRN",.84,7981003.001,2,198,0)
   <tbody>
"KRN",.84,7981003.001,2,199,0)
    <xsl:for-each select="$summary/RACE">
"KRN",.84,7981003.001,2,200,0)
     <tr><xsl:call-template name="SummaryLine"/></tr>
"KRN",.84,7981003.001,2,201,0)
    </xsl:for-each>
"KRN",.84,7981003.001,2,202,0)
   </tbody>
"KRN",.84,7981003.001,2,203,0)
  </table>
"KRN",.84,7981003.001,2,204,0)
</xsl:if>
"KRN",.84,7981003.001,2,205,0)
</xsl:template>
"KRN",.84,7981003.001,2,206,0)
 
"KRN",.84,7981003.001,2,207,0)
<xsl:template match="SUMMARY/RISK_FACTORS">
"KRN",.84,7981003.001,2,208,0)
<xsl:param name="summary" select="."/>
"KRN",.84,7981003.001,2,209,0)
<xsl:if test="$summary/*[1]">
"KRN",.84,7981003.001,2,210,0)
  <table cellpadding="3" cellspacing="0">
"KRN",.84,7981003.001,2,211,0)
   <caption>Risk Factors</caption>
"KRN",.84,7981003.001,2,212,0)
   <thead>
"KRN",.84,7981003.001,2,213,0)
    <tr>
"KRN",.84,7981003.001,2,214,0)
     <th width="30">Code</th>
"KRN",.84,7981003.001,2,215,0)
     <th>Description</th>
"KRN",.84,7981003.001,2,216,0)
     <th width="30">Count</th>
"KRN",.84,7981003.001,2,217,0)
    </tr>
"KRN",.84,7981003.001,2,218,0)
   </thead>
"KRN",.84,7981003.001,2,219,0)
   <tbody>
"KRN",.84,7981003.001,2,220,0)
    <xsl:for-each select="$summary/RISK">
"KRN",.84,7981003.001,2,221,0)
     <tr>
"KRN",.84,7981003.001,2,222,0)
      <td align="center"><xsl:value-of select="@ID"/></td>
"KRN",.84,7981003.001,2,223,0)
      <xsl:call-template name="SummaryLine"/>
"KRN",.84,7981003.001,2,224,0)
     </tr>
"KRN",.84,7981003.001,2,225,0)
    </xsl:for-each>
"KRN",.84,7981003.001,2,226,0)
   </tbody>
"KRN",.84,7981003.001,2,227,0)
  </table>
"KRN",.84,7981003.001,2,228,0)
</xsl:if>
"KRN",.84,7981003.001,2,229,0)
</xsl:template>
"KRN",.84,7981003.001,2,230,0)
 
"KRN",.84,7981003.001,2,231,0)
<xsl:template match="SUMMARY/SELDT_SUMMARY">
"KRN",.84,7981003.001,2,232,0)
<xsl:param name="summary" select="."/>
"KRN",.84,7981003.001,2,233,0)
<xsl:if test="$summary/*[1]">
"KRN",.84,7981003.001,2,234,0)
  <table cellpadding="3" cellspacing="0">
"KRN",.84,7981003.001,2,235,0)
   <caption>Selection Date Summary</caption>
"KRN",.84,7981003.001,2,236,0)
   <thead>
"KRN",.84,7981003.001,2,237,0)
    <tr>
"KRN",.84,7981003.001,2,238,0)
     <th>Selection Date</th>
"KRN",.84,7981003.001,2,239,0)
     <th width="30">Count</th>
"KRN",.84,7981003.001,2,240,0)
    </tr>
"KRN",.84,7981003.001,2,241,0)
   </thead>
"KRN",.84,7981003.001,2,242,0)
   <tbody>
"KRN",.84,7981003.001,2,243,0)
    <xsl:for-each select="$summary/SELDT">
"KRN",.84,7981003.001,2,244,0)
     <tr><xsl:call-template name="SummaryLine"/></tr>
"KRN",.84,7981003.001,2,245,0)
   </xsl:for-each>
"KRN",.84,7981003.001,2,246,0)
   </tbody>
"KRN",.84,7981003.001,2,247,0)
  </table>
"KRN",.84,7981003.001,2,248,0)
</xsl:if>
"KRN",.84,7981003.001,2,249,0)
</xsl:template>
"KRN",.84,7981003.001,2,250,0)
 
"KRN",.84,7981003.001,2,251,0)
<xsl:template match="SUMMARY/BIRTHSEX_SUMMARY">
"KRN",.84,7981003.001,2,252,0)
<xsl:param name="summary" select="."/>
"KRN",.84,7981003.001,2,253,0)
<xsl:if test="$summary/*[1]">
"KRN",.84,7981003.001,2,254,0)
  <table cellpadding="3" cellspacing="0">
"KRN",.84,7981003.001,2,255,0)
   <caption>Birth Sex Summary</caption>
"KRN",.84,7981003.001,2,256,0)
   <thead>
"KRN",.84,7981003.001,2,257,0)
    <tr>
"KRN",.84,7981003.001,2,258,0)
     <th>Birth Sex</th>
"KRN",.84,7981003.001,2,259,0)
     <th width="30">Count</th>
"KRN",.84,7981003.001,2,260,0)
    </tr>
"KRN",.84,7981003.001,2,261,0)
   </thead>
"KRN",.84,7981003.001,2,262,0)
   <tbody>
"KRN",.84,7981003.001,2,263,0)
    <xsl:for-each select="$summary/BIRTHSEX">
"KRN",.84,7981003.001,2,264,0)
     <tr><xsl:call-template name="SummaryLine"/></tr>
"KRN",.84,7981003.001,2,265,0)
    </xsl:for-each>
"KRN",.84,7981003.001,2,266,0)
   </tbody>
"KRN",.84,7981003.001,2,267,0)
  </table>
"KRN",.84,7981003.001,2,268,0)
</xsl:if>
"KRN",.84,7981003.001,2,269,0)
</xsl:template>
"KRN",.84,7981003.001,2,270,0)
 
"KRN",.84,7981003.001,2,271,0)
<xsl:template match="SUMMARY/SEX_SUMMARY">
"KRN",.84,7981003.001,2,272,0)
<xsl:param name="summary" select="."/>
"KRN",.84,7981003.001,2,273,0)
<xsl:if test="$summary/*[1]">
"KRN",.84,7981003.001,2,274,0)
  <table cellpadding="3" cellspacing="0">
"KRN",.84,7981003.001,2,275,0)
   <caption>Birth Sex Summary</caption>
"KRN",.84,7981003.001,2,276,0)
   <thead>
"KRN",.84,7981003.001,2,277,0)
    <tr>
"KRN",.84,7981003.001,2,278,0)
     <th>Birth Sex</th>
"KRN",.84,7981003.001,2,279,0)
     <th width="30">Count</th>
"KRN",.84,7981003.001,2,280,0)
    </tr>
"KRN",.84,7981003.001,2,281,0)
   </thead>
"KRN",.84,7981003.001,2,282,0)
   <tbody>
"KRN",.84,7981003.001,2,283,0)
    <xsl:for-each select="$summary/SEX">
"KRN",.84,7981003.001,2,284,0)
     <tr><xsl:call-template name="SummaryLine"/></tr>
"KRN",.84,7981003.001,2,285,0)
    </xsl:for-each>
"KRN",.84,7981003.001,2,286,0)
   </tbody>
"KRN",.84,7981003.001,2,287,0)
  </table>
"KRN",.84,7981003.001,2,288,0)
</xsl:if>
"KRN",.84,7981003.001,2,289,0)
</xsl:template>
"KRN",.84,7981003.001,2,290,0)
 
"KRN",.84,7981003.001,2,291,0)
<xsl:template match="SUMMARY/UTIL_CODES">
"KRN",.84,7981003.001,2,292,0)
<xsl:param name="summary" select="."/>
"KRN",.84,7981003.001,2,293,0)
<xsl:if test="$summary/*[1]">
"KRN",.84,7981003.001,2,294,0)
  <table cellpadding="3" cellspacing="0">
"KRN",.84,7981003.001,2,295,0)
   <caption>Utilization</caption>
"KRN",.84,7981003.001,2,296,0)
   <thead>
"KRN",.84,7981003.001,2,297,0)
    <tr>
"KRN",.84,7981003.001,2,298,0)
     <th width="30">Code</th>
"KRN",.84,7981003.001,2,299,0)
     <th>Description</th>
"KRN",.84,7981003.001,2,300,0)
     <th width="30">Count</th>
"KRN",.84,7981003.001,2,301,0)
    </tr>
"KRN",.84,7981003.001,2,302,0)
   </thead>
"KRN",.84,7981003.001,2,303,0)
   <tbody>
"KRN",.84,7981003.001,2,304,0)
    <xsl:for-each select="$summary/UTIL">
"KRN",.84,7981003.001,2,305,0)
     <tr>
"KRN",.84,7981003.001,2,306,0)
      <td align="center"><xsl:value-of select="@ID"/></td>
"KRN",.84,7981003.001,2,307,0)
      <xsl:call-template name="SummaryLine"/>
"KRN",.84,7981003.001,2,308,0)
     </tr>
"KRN",.84,7981003.001,2,309,0)
    </xsl:for-each>
"KRN",.84,7981003.001,2,310,0)
   </tbody>
"KRN",.84,7981003.001,2,311,0)
  </table>
"KRN",.84,7981003.001,2,312,0)
</xsl:if>
"KRN",.84,7981003.001,2,313,0)
</xsl:template>
"KRN",.84,7981003.001,2,314,0)
 
"KRN",.84,7981003.001,2,315,0)
</xsl:stylesheet>
"KRN",.84,7981003.002,-1)
0^36
"KRN",.84,7981003.002,0)
7981003.002^2^^CLINICAL CASE REGISTRIES^General Utiliz. and Demogr. (CSV)
"KRN",.84,7981003.002,2,0)
^^198^198^3170804^
"KRN",.84,7981003.002,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981003.002,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981003.002,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981003.002,2,4,0)
 
"KRN",.84,7981003.002,2,5,0)
<xsl:import  href="template://report/999/2"/>  <!-- Common   -->
"KRN",.84,7981003.002,2,6,0)
<xsl:include href="template://report/997/2"/>  <!-- Patients -->
"KRN",.84,7981003.002,2,7,0)
 
"KRN",.84,7981003.002,2,8,0)
<xsl:template match="/">
"KRN",.84,7981003.002,2,9,0)
<xsl:text>General Utilization and Demographics (Patients)</xsl:text>
"KRN",.84,7981003.002,2,10,0)
<xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981003.002,2,11,0)
<!-- xsl:value-of select="$FILESWITCH"/ -->
"KRN",.84,7981003.002,2,12,0)
<xsl:text>General Utilization and Demographics (Summary)</xsl:text>
"KRN",.84,7981003.002,2,13,0)
<xsl:call-template name="ReportSummary"/>
"KRN",.84,7981003.002,2,14,0)
</xsl:template>
"KRN",.84,7981003.002,2,15,0)
 
"KRN",.84,7981003.002,2,16,0)
<!--[ UTILITIES ]-->
"KRN",.84,7981003.002,2,17,0)
 
"KRN",.84,7981003.002,2,18,0)
<xsl:template name="SummaryLine">
"KRN",.84,7981003.002,2,19,0)
<xsl:param name="line" select="."/>
"KRN",.84,7981003.002,2,20,0)
<xsl:value-of select="$line/@ID"/>
"KRN",.84,7981003.002,2,21,0)
<xsl:value-of select="$DELIMITER"/>
"KRN",.84,7981003.002,2,22,0)
<xsl:value-of select="$line"/>
"KRN",.84,7981003.002,2,23,0)
<xsl:value-of select="$DELIMITER"/>
"KRN",.84,7981003.002,2,24,0)
<xsl:value-of select="$line/@COUNT"/>
"KRN",.84,7981003.002,2,25,0)
<xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,26,0)
</xsl:template>
"KRN",.84,7981003.002,2,27,0)
 
"KRN",.84,7981003.002,2,28,0)
<!--[ COLUMN HEADERS ]-->
"KRN",.84,7981003.002,2,29,0)
 
"KRN",.84,7981003.002,2,30,0)
<xsl:template match="COLUMN[@NAME='RISK']">
"KRN",.84,7981003.002,2,31,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981003.002,2,32,0)
  <xsl:with-param name="title" select="'Risk Factors'"/>
"KRN",.84,7981003.002,2,33,0)
</xsl:call-template>
"KRN",.84,7981003.002,2,34,0)
</xsl:template>
"KRN",.84,7981003.002,2,35,0)
 
"KRN",.84,7981003.002,2,36,0)
<xsl:template match="COLUMN[@NAME='UTIL']">
"KRN",.84,7981003.002,2,37,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981003.002,2,38,0)
  <xsl:with-param name="title" select="'Utilization'"/>
"KRN",.84,7981003.002,2,39,0)
</xsl:call-template>
"KRN",.84,7981003.002,2,40,0)
</xsl:template>
"KRN",.84,7981003.002,2,41,0)
 
"KRN",.84,7981003.002,2,42,0)
<!--[ SUMMARY TABLES ]--> 
"KRN",.84,7981003.002,2,43,0)
 
"KRN",.84,7981003.002,2,44,0)
<xsl:template match="SUMMARY/AGE_SUMMARY">
"KRN",.84,7981003.002,2,45,0)
<xsl:param name="summary" select="."/>
"KRN",.84,7981003.002,2,46,0)
<xsl:if test="$summary/*[1]">
"KRN",.84,7981003.002,2,47,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,48,0)
  <xsl:text>[Age Summary]</xsl:text>
"KRN",.84,7981003.002,2,49,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,50,0)
  <xsl:text>,Age,Count (Value)</xsl:text>
"KRN",.84,7981003.002,2,51,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,52,0)
  <xsl:for-each select="$summary/AGE">
"KRN",.84,7981003.002,2,53,0)
   <xsl:call-template name="SummaryLine"/>
"KRN",.84,7981003.002,2,54,0)
  </xsl:for-each>
"KRN",.84,7981003.002,2,55,0)
</xsl:if>
"KRN",.84,7981003.002,2,56,0)
</xsl:template>
"KRN",.84,7981003.002,2,57,0)
 
"KRN",.84,7981003.002,2,58,0)
<xsl:template match="SUMMARY/CONFDT_SUMMARY">
"KRN",.84,7981003.002,2,59,0)
<xsl:param name="summary" select="."/>
"KRN",.84,7981003.002,2,60,0)
<xsl:if test="$summary/*[1]">
"KRN",.84,7981003.002,2,61,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,62,0)
  <xsl:text>[Confirmation Date Summary]</xsl:text>
"KRN",.84,7981003.002,2,63,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,64,0)
  <xsl:text>,Confirmation Date,Count</xsl:text>
"KRN",.84,7981003.002,2,65,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,66,0)
  <xsl:for-each select="$summary/CONFDT">
"KRN",.84,7981003.002,2,67,0)
   <xsl:call-template name="SummaryLine"/>
"KRN",.84,7981003.002,2,68,0)
  </xsl:for-each>
"KRN",.84,7981003.002,2,69,0)
</xsl:if>
"KRN",.84,7981003.002,2,70,0)
</xsl:template>
"KRN",.84,7981003.002,2,71,0)
 
"KRN",.84,7981003.002,2,72,0)
<xsl:template match="SUMMARY/DOB_SUMMARY">
"KRN",.84,7981003.002,2,73,0)
<xsl:param name="summary" select="."/>
"KRN",.84,7981003.002,2,74,0)
<xsl:if test="$summary/*[1]">
"KRN",.84,7981003.002,2,75,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,76,0)
  <xsl:text>[Date of Birth Summary]</xsl:text>
"KRN",.84,7981003.002,2,77,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,78,0)
  <xsl:text>,Date of Birth,Count</xsl:text>
"KRN",.84,7981003.002,2,79,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,80,0)
  <xsl:for-each select="$summary/DOB">
"KRN",.84,7981003.002,2,81,0)
   <xsl:call-template name="SummaryLine"/>
"KRN",.84,7981003.002,2,82,0)
  </xsl:for-each>
"KRN",.84,7981003.002,2,83,0)
</xsl:if>
"KRN",.84,7981003.002,2,84,0)
</xsl:template>
"KRN",.84,7981003.002,2,85,0)
 
"KRN",.84,7981003.002,2,86,0)
<xsl:template match="SUMMARY/DOD_SUMMARY">
"KRN",.84,7981003.002,2,87,0)
<xsl:param name="summary" select="."/>
"KRN",.84,7981003.002,2,88,0)
<xsl:if test="$summary/*[1]">
"KRN",.84,7981003.002,2,89,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,90,0)
  <xsl:text>[Date of Death Summary]</xsl:text>
"KRN",.84,7981003.002,2,91,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,92,0)
  <xsl:text>,Date of Death,Count</xsl:text>
"KRN",.84,7981003.002,2,93,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,94,0)
  <xsl:for-each select="$summary/DOD">
"KRN",.84,7981003.002,2,95,0)
   <xsl:call-template name="SummaryLine"/>
"KRN",.84,7981003.002,2,96,0)
  </xsl:for-each>
"KRN",.84,7981003.002,2,97,0)
</xsl:if>
"KRN",.84,7981003.002,2,98,0)
</xsl:template>
"KRN",.84,7981003.002,2,99,0)
 
"KRN",.84,7981003.002,2,100,0)
<xsl:template match="SUMMARY/ETHN_SUMMARY">
"KRN",.84,7981003.002,2,101,0)
<xsl:param name="summary" select="."/>
"KRN",.84,7981003.002,2,102,0)
<xsl:if test="$summary/*[1]">
"KRN",.84,7981003.002,2,103,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,104,0)
  <xsl:text>[Ethnicity Summary]</xsl:text>
"KRN",.84,7981003.002,2,105,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,106,0)
  <xsl:text>,Ethnicity,Count</xsl:text>
"KRN",.84,7981003.002,2,107,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,108,0)
  <xsl:for-each select="$summary/ETHN">
"KRN",.84,7981003.002,2,109,0)
   <xsl:call-template name="SummaryLine"/>
"KRN",.84,7981003.002,2,110,0)
  </xsl:for-each>
"KRN",.84,7981003.002,2,111,0)
</xsl:if>
"KRN",.84,7981003.002,2,112,0)
</xsl:template>
"KRN",.84,7981003.002,2,113,0)
 
"KRN",.84,7981003.002,2,114,0)
<xsl:template match="SUMMARY/RACE_SUMMARY">
"KRN",.84,7981003.002,2,115,0)
<xsl:param name="summary" select="."/>
"KRN",.84,7981003.002,2,116,0)
<xsl:if test="$summary/*[1]">
"KRN",.84,7981003.002,2,117,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,118,0)
  <xsl:text>[Race Summary]</xsl:text>
"KRN",.84,7981003.002,2,119,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,120,0)
  <xsl:text>,Race,Count</xsl:text>
"KRN",.84,7981003.002,2,121,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,122,0)
  <xsl:for-each select="$summary/RACE">
"KRN",.84,7981003.002,2,123,0)
   <xsl:call-template name="SummaryLine"/>
"KRN",.84,7981003.002,2,124,0)
  </xsl:for-each>
"KRN",.84,7981003.002,2,125,0)
</xsl:if>
"KRN",.84,7981003.002,2,126,0)
</xsl:template>
"KRN",.84,7981003.002,2,127,0)
 
"KRN",.84,7981003.002,2,128,0)
<xsl:template match="SUMMARY/RISK_FACTORS">
"KRN",.84,7981003.002,2,129,0)
<xsl:param name="summary" select="."/>
"KRN",.84,7981003.002,2,130,0)
<xsl:if test="$summary/*[1]">
"KRN",.84,7981003.002,2,131,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,132,0)
  <xsl:text>[Risk Factors]</xsl:text>
"KRN",.84,7981003.002,2,133,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,134,0)
  <xsl:text>Code,Description,Count</xsl:text>
"KRN",.84,7981003.002,2,135,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,136,0)
  <xsl:for-each select="$summary/RISK">
"KRN",.84,7981003.002,2,137,0)
   <xsl:call-template name="SummaryLine"/>
"KRN",.84,7981003.002,2,138,0)
  </xsl:for-each>
"KRN",.84,7981003.002,2,139,0)
</xsl:if>
"KRN",.84,7981003.002,2,140,0)
</xsl:template>
"KRN",.84,7981003.002,2,141,0)
 
"KRN",.84,7981003.002,2,142,0)
<xsl:template match="SUMMARY/SELDT_SUMMARY">
"KRN",.84,7981003.002,2,143,0)
<xsl:param name="summary" select="."/>
"KRN",.84,7981003.002,2,144,0)
<xsl:if test="$summary/*[1]">
"KRN",.84,7981003.002,2,145,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,146,0)
  <xsl:text>[Selection Date Summary]</xsl:text>
"KRN",.84,7981003.002,2,147,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,148,0)
  <xsl:text>,Selection Date,Count</xsl:text>
"KRN",.84,7981003.002,2,149,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,150,0)
  <xsl:for-each select="$summary/SELDT">
"KRN",.84,7981003.002,2,151,0)
   <xsl:call-template name="SummaryLine"/>
"KRN",.84,7981003.002,2,152,0)
  </xsl:for-each>
"KRN",.84,7981003.002,2,153,0)
</xsl:if>
"KRN",.84,7981003.002,2,154,0)
</xsl:template>
"KRN",.84,7981003.002,2,155,0)
 
"KRN",.84,7981003.002,2,156,0)
<xsl:template match="SUMMARY/BIRTHSEX_SUMMARY">
"KRN",.84,7981003.002,2,157,0)
<xsl:param name="summary" select="."/>
"KRN",.84,7981003.002,2,158,0)
<xsl:if test="$summary/*[1]">
"KRN",.84,7981003.002,2,159,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,160,0)
  <xsl:text>[Birth Sex Summary]</xsl:text>
"KRN",.84,7981003.002,2,161,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,162,0)
  <xsl:text>,Birth Sex,Count</xsl:text>
"KRN",.84,7981003.002,2,163,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,164,0)
  <xsl:for-each select="$summary/BIRTHSEX">
"KRN",.84,7981003.002,2,165,0)
   <xsl:call-template name="SummaryLine"/>
"KRN",.84,7981003.002,2,166,0)
  </xsl:for-each>
"KRN",.84,7981003.002,2,167,0)
</xsl:if>
"KRN",.84,7981003.002,2,168,0)
</xsl:template>
"KRN",.84,7981003.002,2,169,0)
 
"KRN",.84,7981003.002,2,170,0)
<xsl:template match="SUMMARY/SEX_SUMMARY">
"KRN",.84,7981003.002,2,171,0)
<xsl:param name="summary" select="."/>
"KRN",.84,7981003.002,2,172,0)
<xsl:if test="$summary/*[1]">
"KRN",.84,7981003.002,2,173,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,174,0)
  <xsl:text>[Birth Sex Summary]</xsl:text>
"KRN",.84,7981003.002,2,175,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,176,0)
  <xsl:text>,Birth Sex,Count</xsl:text>
"KRN",.84,7981003.002,2,177,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,178,0)
  <xsl:for-each select="$summary/SEX">
"KRN",.84,7981003.002,2,179,0)
   <xsl:call-template name="SummaryLine"/>
"KRN",.84,7981003.002,2,180,0)
  </xsl:for-each>
"KRN",.84,7981003.002,2,181,0)
</xsl:if>
"KRN",.84,7981003.002,2,182,0)
</xsl:template>
"KRN",.84,7981003.002,2,183,0)
 
"KRN",.84,7981003.002,2,184,0)
<xsl:template match="SUMMARY/UTIL_CODES">
"KRN",.84,7981003.002,2,185,0)
<xsl:param name="summary" select="."/>
"KRN",.84,7981003.002,2,186,0)
<xsl:if test="$summary/*[1]">
"KRN",.84,7981003.002,2,187,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,188,0)
  <xsl:text>[Utilization]</xsl:text>
"KRN",.84,7981003.002,2,189,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,190,0)
  <xsl:text>Code,Description,Count</xsl:text>
"KRN",.84,7981003.002,2,191,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981003.002,2,192,0)
  <xsl:for-each select="$summary/UTIL">
"KRN",.84,7981003.002,2,193,0)
   <xsl:call-template name="SummaryLine"/>
"KRN",.84,7981003.002,2,194,0)
  </xsl:for-each>
"KRN",.84,7981003.002,2,195,0)
</xsl:if>
"KRN",.84,7981003.002,2,196,0)
</xsl:template>
"KRN",.84,7981003.002,2,197,0)
 
"KRN",.84,7981003.002,2,198,0)
</xsl:stylesheet>
"KRN",.84,7981004.001,-1)
0^33
"KRN",.84,7981004.001,0)
7981004.001^2^^CLINICAL CASE REGISTRIES^Clinic Follow Up (HTML)
"KRN",.84,7981004.001,2,0)
^^57^57^3170802^
"KRN",.84,7981004.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981004.001,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981004.001,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981004.001,2,4,0)
 
"KRN",.84,7981004.001,2,5,0)
<xsl:import  href="template://report/998/1"/>  <!-- Styles   --> 
"KRN",.84,7981004.001,2,6,0)
<xsl:import  href="template://report/999/1"/>  <!-- Common   -->
"KRN",.84,7981004.001,2,7,0)
 
"KRN",.84,7981004.001,2,8,0)
<xsl:template match="/">
"KRN",.84,7981004.001,2,9,0)
<html>
"KRN",.84,7981004.001,2,10,0)
  <head>
"KRN",.84,7981004.001,2,11,0)
   <title>Clinic Follow Up</title>
"KRN",.84,7981004.001,2,12,0)
   <xsl:call-template name="StyleSheet"/>
"KRN",.84,7981004.001,2,13,0)
  </head>
"KRN",.84,7981004.001,2,14,0)
  <body>
"KRN",.84,7981004.001,2,15,0)
   <h1>Clinic Follow Up</h1>
"KRN",.84,7981004.001,2,16,0)
   <xsl:call-template name="ReportHeader"/>
"KRN",.84,7981004.001,2,17,0)
   <!-- The following line added to fix page break issue in IE 7 -->
"KRN",.84,7981004.001,2,18,0)
   <div style="page-break-after:always; font-size:1; margin:0; 
"KRN",.84,7981004.001,2,19,0)
border:0"><span style="visibility: hidden">-</span></div>
"KRN",.84,7981004.001,2,20,0)
   <div>
"KRN",.84,7981004.001,2,21,0)
    <xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981004.001,2,22,0)
   </div>
"KRN",.84,7981004.001,2,23,0)
  </body>
"KRN",.84,7981004.001,2,24,0)
</html>
"KRN",.84,7981004.001,2,25,0)
</xsl:template>
"KRN",.84,7981004.001,2,26,0)
 
"KRN",.84,7981004.001,2,27,0)
<!--[ COLUMN HEADERS ]-->
"KRN",.84,7981004.001,2,28,0)
 
"KRN",.84,7981004.001,2,29,0)
<xsl:template match="COLUMN[@NAME='LSNDT']">
"KRN",.84,7981004.001,2,30,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981004.001,2,31,0)
  <xsl:with-param name="title" select="'Last Seen Date'"/>
"KRN",.84,7981004.001,2,32,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981004.001,2,33,0)
</xsl:call-template>
"KRN",.84,7981004.001,2,34,0)
</xsl:template>
"KRN",.84,7981004.001,2,35,0)
 
"KRN",.84,7981004.001,2,36,0)
<xsl:template match="COLUMN[@NAME='SEEN']">
"KRN",.84,7981004.001,2,37,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981004.001,2,38,0)
  <xsl:with-param name="title" select="'Seen'"/>
"KRN",.84,7981004.001,2,39,0)
  <xsl:with-param name="width" select="'5%'"/>
"KRN",.84,7981004.001,2,40,0)
</xsl:call-template>
"KRN",.84,7981004.001,2,41,0)
</xsl:template>
"KRN",.84,7981004.001,2,42,0)
 
"KRN",.84,7981004.001,2,43,0)
<!--[ CELL VALUES ]-->
"KRN",.84,7981004.001,2,44,0)
 
"KRN",.84,7981004.001,2,45,0)
<xsl:template match="PATIENT/LSNDT">
"KRN",.84,7981004.001,2,46,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981004.001,2,47,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981004.001,2,48,0)
</xsl:call-template>
"KRN",.84,7981004.001,2,49,0)
</xsl:template>
"KRN",.84,7981004.001,2,50,0)
 
"KRN",.84,7981004.001,2,51,0)
<xsl:template match="PATIENT/SEEN">
"KRN",.84,7981004.001,2,52,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981004.001,2,53,0)
  <xsl:with-param name="yesno" select="1"/>
"KRN",.84,7981004.001,2,54,0)
</xsl:call-template>
"KRN",.84,7981004.001,2,55,0)
</xsl:template>
"KRN",.84,7981004.001,2,56,0)
 
"KRN",.84,7981004.001,2,57,0)
</xsl:stylesheet>
"KRN",.84,7981004.002,-1)
0^32
"KRN",.84,7981004.002,0)
7981004.002^2^^CLINICAL CASE REGISTRIES^Clinic Follow Up (CSV)
"KRN",.84,7981004.002,2,0)
^^52^52^3170802^
"KRN",.84,7981004.002,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981004.002,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981004.002,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981004.002,2,4,0)
 
"KRN",.84,7981004.002,2,5,0)
<xsl:import href="template://report/999/2"/>  <!-- Common   -->
"KRN",.84,7981004.002,2,6,0)
 
"KRN",.84,7981004.002,2,7,0)
<xsl:template match="/">
"KRN",.84,7981004.002,2,8,0)
<xsl:text>Clinic Follow Up</xsl:text>
"KRN",.84,7981004.002,2,9,0)
<xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981004.002,2,10,0)
</xsl:template>
"KRN",.84,7981004.002,2,11,0)
 
"KRN",.84,7981004.002,2,12,0)
<!--[ COLUMN HEADERS ]-->
"KRN",.84,7981004.002,2,13,0)
 
"KRN",.84,7981004.002,2,14,0)
<xsl:template match="COLUMN[@NAME='DOB']">
"KRN",.84,7981004.002,2,15,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981004.002,2,16,0)
  <xsl:with-param name="title" select="'Date of Birth'"/>
"KRN",.84,7981004.002,2,17,0)
</xsl:call-template>
"KRN",.84,7981004.002,2,18,0)
</xsl:template>
"KRN",.84,7981004.002,2,19,0)
 
"KRN",.84,7981004.002,2,20,0)
<xsl:template match="COLUMN[@NAME='LSNDT']">
"KRN",.84,7981004.002,2,21,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981004.002,2,22,0)
  <xsl:with-param name="title" select="'Last Seen Date'"/>
"KRN",.84,7981004.002,2,23,0)
</xsl:call-template>
"KRN",.84,7981004.002,2,24,0)
</xsl:template>
"KRN",.84,7981004.002,2,25,0)
 
"KRN",.84,7981004.002,2,26,0)
<xsl:template match="COLUMN[@NAME='SEEN']">
"KRN",.84,7981004.002,2,27,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981004.002,2,28,0)
  <xsl:with-param name="title" select="'Seen'"/>
"KRN",.84,7981004.002,2,29,0)
</xsl:call-template>
"KRN",.84,7981004.002,2,30,0)
</xsl:template>
"KRN",.84,7981004.002,2,31,0)
 
"KRN",.84,7981004.002,2,32,0)
<!--[ CELL VALUES ]-->
"KRN",.84,7981004.002,2,33,0)
 
"KRN",.84,7981004.002,2,34,0)
<xsl:template match="PATIENT/DOB">
"KRN",.84,7981004.002,2,35,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981004.002,2,36,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981004.002,2,37,0)
</xsl:call-template>
"KRN",.84,7981004.002,2,38,0)
</xsl:template>
"KRN",.84,7981004.002,2,39,0)
 
"KRN",.84,7981004.002,2,40,0)
<xsl:template match="PATIENT/LSNDT">
"KRN",.84,7981004.002,2,41,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981004.002,2,42,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981004.002,2,43,0)
</xsl:call-template>
"KRN",.84,7981004.002,2,44,0)
</xsl:template>
"KRN",.84,7981004.002,2,45,0)
 
"KRN",.84,7981004.002,2,46,0)
<xsl:template match="PATIENT/SEEN">
"KRN",.84,7981004.002,2,47,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981004.002,2,48,0)
  <xsl:with-param name="yesno" select="1"/>
"KRN",.84,7981004.002,2,49,0)
</xsl:call-template>
"KRN",.84,7981004.002,2,50,0)
</xsl:template>
"KRN",.84,7981004.002,2,51,0)
 
"KRN",.84,7981004.002,2,52,0)
</xsl:stylesheet>
"KRN",.84,7981004.002,3,0)
^.845A^^0
"KRN",.84,7981006.002,-1)
0^37
"KRN",.84,7981006.002,0)
7981006.002^2^^CLINICAL CASE REGISTRIES^Laboratory Utilization (CSV)
"KRN",.84,7981006.002,2,0)
^^66^66^3170808^
"KRN",.84,7981006.002,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981006.002,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981006.002,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981006.002,2,4,0)
 
"KRN",.84,7981006.002,2,5,0)
<xsl:import href="template://report/999/2"/>  <!-- Common   -->
"KRN",.84,7981006.002,2,6,0)
 
"KRN",.84,7981006.002,2,7,0)
<xsl:variable name="UTILIZATION_HEADER" select="'Laboratory 
"KRN",.84,7981006.002,2,8,0)
Utilization'"/>
"KRN",.84,7981006.002,2,9,0)
 
"KRN",.84,7981006.002,2,10,0)
<xsl:template match="/">
"KRN",.84,7981006.002,2,11,0)
<xsl:call-template name="UtilizationSection">
"KRN",.84,7981006.002,2,12,0)
  <xsl:with-param name="data" select="REPORT/RESULTS"/>
"KRN",.84,7981006.002,2,13,0)
  <xsl:with-param name="subttl" select="'Results'"/>
"KRN",.84,7981006.002,2,14,0)
</xsl:call-template>
"KRN",.84,7981006.002,2,15,0)
<xsl:call-template name="UtilizationSection">
"KRN",.84,7981006.002,2,16,0)
  <xsl:with-param name="data" select="REPORT/LABTESTS"/>
"KRN",.84,7981006.002,2,17,0)
  <xsl:with-param name="subttl" select="'Laboratory Tests'"/>
"KRN",.84,7981006.002,2,18,0)
</xsl:call-template>
"KRN",.84,7981006.002,2,19,0)
<xsl:call-template name="UtilizationSection">
"KRN",.84,7981006.002,2,20,0)
  <xsl:with-param name="data" select="REPORT/PATIENTS"/>
"KRN",.84,7981006.002,2,21,0)
  <xsl:with-param name="subttl" select="'Patients with Highest 
"KRN",.84,7981006.002,2,22,0)
Utilization'"/>
"KRN",.84,7981006.002,2,23,0)
</xsl:call-template>
"KRN",.84,7981006.002,2,24,0)
</xsl:template>
"KRN",.84,7981006.002,2,25,0)
 
"KRN",.84,7981006.002,2,26,0)
<!--[ COLUMN HEADERS ]-->
"KRN",.84,7981006.002,2,27,0)
 
"KRN",.84,7981006.002,2,28,0)
<xsl:template match="COLUMN[@NAME='MAXNP']">
"KRN",.84,7981006.002,2,29,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981006.002,2,30,0)
  <xsl:with-param name="title"
"KRN",.84,7981006.002,2,31,0)
       select="'Number of Patients with Max. Utilization'"/>
"KRN",.84,7981006.002,2,32,0)
</xsl:call-template>
"KRN",.84,7981006.002,2,33,0)
</xsl:template>
"KRN",.84,7981006.002,2,34,0)
 
"KRN",.84,7981006.002,2,35,0)
<xsl:template match="COLUMN[@NAME='MAXNRPP']">
"KRN",.84,7981006.002,2,36,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981006.002,2,37,0)
  <xsl:with-param name="title"
"KRN",.84,7981006.002,2,38,0)
       select="'Maximum Number of Results per Patient'"/>
"KRN",.84,7981006.002,2,39,0)
</xsl:call-template>
"KRN",.84,7981006.002,2,40,0)
</xsl:template>
"KRN",.84,7981006.002,2,41,0)
 
"KRN",.84,7981006.002,2,42,0)
<xsl:template match="COLUMN[@NAME='NDT']">
"KRN",.84,7981006.002,2,43,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981006.002,2,44,0)
  <xsl:with-param name="title" select="'Number of Different Tests'"/>
"KRN",.84,7981006.002,2,45,0)
</xsl:call-template>
"KRN",.84,7981006.002,2,46,0)
</xsl:template>
"KRN",.84,7981006.002,2,47,0)
 
"KRN",.84,7981006.002,2,48,0)
<xsl:template match="COLUMN[@NAME='NO']">
"KRN",.84,7981006.002,2,49,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981006.002,2,50,0)
  <xsl:with-param name="title" select="'Number of Orders'"/>
"KRN",.84,7981006.002,2,51,0)
</xsl:call-template>
"KRN",.84,7981006.002,2,52,0)
</xsl:template>
"KRN",.84,7981006.002,2,53,0)
 
"KRN",.84,7981006.002,2,54,0)
<xsl:template match="COLUMN[@NAME='NP']">
"KRN",.84,7981006.002,2,55,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981006.002,2,56,0)
  <xsl:with-param name="title" select="'Number of Patients'"/>
"KRN",.84,7981006.002,2,57,0)
</xsl:call-template>
"KRN",.84,7981006.002,2,58,0)
</xsl:template>
"KRN",.84,7981006.002,2,59,0)
 
"KRN",.84,7981006.002,2,60,0)
<xsl:template match="COLUMN[@NAME='NR']">
"KRN",.84,7981006.002,2,61,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981006.002,2,62,0)
  <xsl:with-param name="title" select="'Number of Results'"/>
"KRN",.84,7981006.002,2,63,0)
</xsl:call-template>
"KRN",.84,7981006.002,2,64,0)
</xsl:template>
"KRN",.84,7981006.002,2,65,0)
 
"KRN",.84,7981006.002,2,66,0)
</xsl:stylesheet>
"KRN",.84,7981007.001,-1)
0^5
"KRN",.84,7981007.001,0)
7981007.001^2^^CLINICAL CASE REGISTRIES^Radiology Utilization (HTML)
"KRN",.84,7981007.001,2,0)
^^126^126^3170811^
"KRN",.84,7981007.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981007.001,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981007.001,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981007.001,2,4,0)
 
"KRN",.84,7981007.001,2,5,0)
<xsl:import  href="template://report/998/1"/>  <!-- Styles   --> 
"KRN",.84,7981007.001,2,6,0)
<xsl:import  href="template://report/999/1"/>  <!-- Common   -->
"KRN",.84,7981007.001,2,7,0)
 
"KRN",.84,7981007.001,2,8,0)
<xsl:template match="/">
"KRN",.84,7981007.001,2,9,0)
<html>
"KRN",.84,7981007.001,2,10,0)
  <head>
"KRN",.84,7981007.001,2,11,0)
   <title>Radiology Utilization</title>
"KRN",.84,7981007.001,2,12,0)
   <xsl:call-template name="StyleSheet"/>
"KRN",.84,7981007.001,2,13,0)
  </head>
"KRN",.84,7981007.001,2,14,0)
  <body>
"KRN",.84,7981007.001,2,15,0)
   <h1>Radiology Utilization</h1>
"KRN",.84,7981007.001,2,16,0)
   <xsl:call-template name="ReportHeader"/>
"KRN",.84,7981007.001,2,17,0)
   <!-- The following line added to fix page break issue in IE 7 -->
"KRN",.84,7981007.001,2,18,0)
   <div style="page-break-after:always; font-size:1; margin:0; 
"KRN",.84,7981007.001,2,19,0)
border:0"><span style="visibility: hidden">-</span></div>
"KRN",.84,7981007.001,2,20,0)
   <div>
"KRN",.84,7981007.001,2,21,0)
    <xsl:call-template name="CategorySummary"/>
"KRN",.84,7981007.001,2,22,0)
    <xsl:apply-templates select="REPORT/PROCEDURES"/>
"KRN",.84,7981007.001,2,23,0)
    <xsl:apply-templates select="REPORT/PATIENTS"/>
"KRN",.84,7981007.001,2,24,0)
   </div>
"KRN",.84,7981007.001,2,25,0)
  </body>
"KRN",.84,7981007.001,2,26,0)
</html>
"KRN",.84,7981007.001,2,27,0)
</xsl:template>
"KRN",.84,7981007.001,2,28,0)
 
"KRN",.84,7981007.001,2,29,0)
<xsl:template match="REPORT/PATIENTS">
"KRN",.84,7981007.001,2,30,0)
<h3><xsl:call-template name="HUPatientsHeader"/> by number of 
"KRN",.84,7981007.001,2,31,0)
procedures</h3>
"KRN",.84,7981007.001,2,32,0)
<xsl:call-template name="DataGrid"/>
"KRN",.84,7981007.001,2,33,0)
</xsl:template>
"KRN",.84,7981007.001,2,34,0)
 
"KRN",.84,7981007.001,2,35,0)
<xsl:template match="REPORT/PROCEDURES">
"KRN",.84,7981007.001,2,36,0)
<xsl:variable name="minrpnum" select="/REPORT/PARAMETERS/MINRPNUM"/>
"KRN",.84,7981007.001,2,37,0)
<h3>
"KRN",.84,7981007.001,2,38,0)
  Procedures performed
"KRN",.84,7981007.001,2,39,0)
  <xsl:choose>
"KRN",.84,7981007.001,2,40,0)
   <xsl:when test="$minrpnum>1">
"KRN",.84,7981007.001,2,41,0)
    <xsl:value-of select="$minrpnum"/> times or more
"KRN",.84,7981007.001,2,42,0)
   </xsl:when>
"KRN",.84,7981007.001,2,43,0)
   <xsl:otherwise>at least once</xsl:otherwise>
"KRN",.84,7981007.001,2,44,0)
  </xsl:choose>
"KRN",.84,7981007.001,2,45,0)
</h3>
"KRN",.84,7981007.001,2,46,0)
<xsl:call-template name="DataGrid"/>
"KRN",.84,7981007.001,2,47,0)
</xsl:template>
"KRN",.84,7981007.001,2,48,0)
 
"KRN",.84,7981007.001,2,49,0)
<!--[ UTILITIES ]-->
"KRN",.84,7981007.001,2,50,0)
 
"KRN",.84,7981007.001,2,51,0)
<xsl:template name="CategorySummary">
"KRN",.84,7981007.001,2,52,0)
<table width="100%" cellpadding="5" cellspacing="0">
"KRN",.84,7981007.001,2,53,0)
  <thead>
"KRN",.84,7981007.001,2,54,0)
   <tr>
"KRN",.84,7981007.001,2,55,0)
    <th width="33%">Number of Patients</th>
"KRN",.84,7981007.001,2,56,0)
    <th width="33%">Number of Procedures</th>
"KRN",.84,7981007.001,2,57,0)
    <th width="33%">Number of Different Procedures</th>
"KRN",.84,7981007.001,2,58,0)
   </tr>
"KRN",.84,7981007.001,2,59,0)
  </thead>
"KRN",.84,7981007.001,2,60,0)
  <tbody>
"KRN",.84,7981007.001,2,61,0)
   <tr>
"KRN",.84,7981007.001,2,62,0)
    <td><xsl:value-of select="/REPORT/NP"/></td>
"KRN",.84,7981007.001,2,63,0)
    <td><xsl:value-of select="/REPORT/NPR"/></td>
"KRN",.84,7981007.001,2,64,0)
    <td><xsl:value-of select="/REPORT/NDP"/></td>
"KRN",.84,7981007.001,2,65,0)
   </tr>
"KRN",.84,7981007.001,2,66,0)
  </tbody>
"KRN",.84,7981007.001,2,67,0)
</table>
"KRN",.84,7981007.001,2,68,0)
</xsl:template>
"KRN",.84,7981007.001,2,69,0)
 
"KRN",.84,7981007.001,2,70,0)
<!--[ COLUMN HEADERS ]-->
"KRN",.84,7981007.001,2,71,0)
 
"KRN",.84,7981007.001,2,72,0)
<xsl:template match="COLUMN[@NAME='CPT']">
"KRN",.84,7981007.001,2,73,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981007.001,2,74,0)
  <xsl:with-param name="title" select="'CPT'"/>
"KRN",.84,7981007.001,2,75,0)
  <xsl:with-param name="width" select="'15%'"/>
"KRN",.84,7981007.001,2,76,0)
</xsl:call-template>
"KRN",.84,7981007.001,2,77,0)
</xsl:template>
"KRN",.84,7981007.001,2,78,0)
 
"KRN",.84,7981007.001,2,79,0)
<xsl:template match="COLUMN[@NAME='PATIENTS']">
"KRN",.84,7981007.001,2,80,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981007.001,2,81,0)
  <xsl:with-param name="title" select="'Number of Patients'"/>
"KRN",.84,7981007.001,2,82,0)
  <xsl:with-param name="sortmode" select="':DESC'"/>
"KRN",.84,7981007.001,2,83,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981007.001,2,84,0)
</xsl:call-template>
"KRN",.84,7981007.001,2,85,0)
</xsl:template>
"KRN",.84,7981007.001,2,86,0)
 
"KRN",.84,7981007.001,2,87,0)
<xsl:template match="COLUMN[@NAME='TOTAL']">
"KRN",.84,7981007.001,2,88,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981007.001,2,89,0)
  <xsl:with-param name="title" select="'Number of Procedures'"/>
"KRN",.84,7981007.001,2,90,0)
  <xsl:with-param name="sortmode" select="':DESC'"/>
"KRN",.84,7981007.001,2,91,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981007.001,2,92,0)
</xsl:call-template>
"KRN",.84,7981007.001,2,93,0)
</xsl:template>
"KRN",.84,7981007.001,2,94,0)
 
"KRN",.84,7981007.001,2,95,0)
<xsl:template match="COLUMN[@NAME='UNIQUE']">
"KRN",.84,7981007.001,2,96,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981007.001,2,97,0)
  <xsl:with-param name="title" select="'Number of Different Procedures'"/>
"KRN",.84,7981007.001,2,98,0)
  <xsl:with-param name="sortmode" select="':DESC'"/>
"KRN",.84,7981007.001,2,99,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981007.001,2,100,0)
</xsl:call-template>
"KRN",.84,7981007.001,2,101,0)
</xsl:template>
"KRN",.84,7981007.001,2,102,0)
 
"KRN",.84,7981007.001,2,103,0)
<!--[ REPORT PARAMETERS ]-->
"KRN",.84,7981007.001,2,104,0)
 
"KRN",.84,7981007.001,2,105,0)
<xsl:template match="PARAMETERS/MAXUTNUM">
"KRN",.84,7981007.001,2,106,0)
<tr>
"KRN",.84,7981007.001,2,107,0)
  <th scope="row">MaxUtil:&#160;</th>
"KRN",.84,7981007.001,2,108,0)
  <td>
"KRN",.84,7981007.001,2,109,0)
   <xsl:value-of select="."/>
"KRN",.84,7981007.001,2,110,0)
   (maximum number of patients with highest utilization to display)
"KRN",.84,7981007.001,2,111,0)
  </td>
"KRN",.84,7981007.001,2,112,0)
</tr>
"KRN",.84,7981007.001,2,113,0)
</xsl:template>
"KRN",.84,7981007.001,2,114,0)
 
"KRN",.84,7981007.001,2,115,0)
<xsl:template match="PARAMETERS/MINRPNUM">
"KRN",.84,7981007.001,2,116,0)
<tr>
"KRN",.84,7981007.001,2,117,0)
  <th scope="row">MinProc:&#160;</th>
"KRN",.84,7981007.001,2,118,0)
  <td>
"KRN",.84,7981007.001,2,119,0)
   <xsl:value-of select="."/>
"KRN",.84,7981007.001,2,120,0)
   (minimum number of times a procedure should be performed to be 
"KRN",.84,7981007.001,2,121,0)
included in the report)
"KRN",.84,7981007.001,2,122,0)
  </td>
"KRN",.84,7981007.001,2,123,0)
</tr>
"KRN",.84,7981007.001,2,124,0)
</xsl:template>
"KRN",.84,7981007.001,2,125,0)
 
"KRN",.84,7981007.001,2,126,0)
</xsl:stylesheet>
"KRN",.84,7981007.002,-1)
0^44
"KRN",.84,7981007.002,0)
7981007.002^2^^CLINICAL CASE REGISTRIES^Radiology Utilization (CSV)
"KRN",.84,7981007.002,2,0)
^^47^47^3170811^
"KRN",.84,7981007.002,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981007.002,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981007.002,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981007.002,2,4,0)
 
"KRN",.84,7981007.002,2,5,0)
<xsl:import href="template://report/999/2"/>  <!-- Common   -->
"KRN",.84,7981007.002,2,6,0)
 
"KRN",.84,7981007.002,2,7,0)
<xsl:variable name="UTILIZATION_HEADER" select="'Radiology Utilization'"/>
"KRN",.84,7981007.002,2,8,0)
 
"KRN",.84,7981007.002,2,9,0)
<xsl:template match="/">
"KRN",.84,7981007.002,2,10,0)
<xsl:call-template name="UtilizationSection">
"KRN",.84,7981007.002,2,11,0)
  <xsl:with-param name="data" select="REPORT/PROCEDURES"/>
"KRN",.84,7981007.002,2,12,0)
  <xsl:with-param name="subttl" select="'Procedures'"/>
"KRN",.84,7981007.002,2,13,0)
</xsl:call-template>
"KRN",.84,7981007.002,2,14,0)
<xsl:call-template name="UtilizationSection">
"KRN",.84,7981007.002,2,15,0)
  <xsl:with-param name="data" select="REPORT/PATIENTS"/>
"KRN",.84,7981007.002,2,16,0)
  <xsl:with-param name="subttl" select="'Patients with highest 
"KRN",.84,7981007.002,2,17,0)
utilization'"/>
"KRN",.84,7981007.002,2,18,0)
</xsl:call-template>
"KRN",.84,7981007.002,2,19,0)
</xsl:template>
"KRN",.84,7981007.002,2,20,0)
 
"KRN",.84,7981007.002,2,21,0)
<!--[ COLUMN HEADERS ]-->
"KRN",.84,7981007.002,2,22,0)
 
"KRN",.84,7981007.002,2,23,0)
<xsl:template match="COLUMN[@NAME='CPT']">
"KRN",.84,7981007.002,2,24,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981007.002,2,25,0)
  <xsl:with-param name="title" select="'CPT'"/>
"KRN",.84,7981007.002,2,26,0)
</xsl:call-template>
"KRN",.84,7981007.002,2,27,0)
</xsl:template>
"KRN",.84,7981007.002,2,28,0)
 
"KRN",.84,7981007.002,2,29,0)
<xsl:template match="COLUMN[@NAME='PATIENTS']">
"KRN",.84,7981007.002,2,30,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981007.002,2,31,0)
  <xsl:with-param name="title" select="'Number of Patients'"/>
"KRN",.84,7981007.002,2,32,0)
</xsl:call-template>
"KRN",.84,7981007.002,2,33,0)
</xsl:template>
"KRN",.84,7981007.002,2,34,0)
 
"KRN",.84,7981007.002,2,35,0)
<xsl:template match="COLUMN[@NAME='TOTAL']">
"KRN",.84,7981007.002,2,36,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981007.002,2,37,0)
  <xsl:with-param name="title" select="'Number of Procedures'"/>
"KRN",.84,7981007.002,2,38,0)
</xsl:call-template>
"KRN",.84,7981007.002,2,39,0)
</xsl:template>
"KRN",.84,7981007.002,2,40,0)
 
"KRN",.84,7981007.002,2,41,0)
<xsl:template match="COLUMN[@NAME='UNIQUE']">
"KRN",.84,7981007.002,2,42,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981007.002,2,43,0)
  <xsl:with-param name="title" select="'Number of Different Procedures'"/>
"KRN",.84,7981007.002,2,44,0)
</xsl:call-template>
"KRN",.84,7981007.002,2,45,0)
</xsl:template>
"KRN",.84,7981007.002,2,46,0)
 
"KRN",.84,7981007.002,2,47,0)
</xsl:stylesheet>
"KRN",.84,7981008.001,-1)
0^47
"KRN",.84,7981008.001,0)
7981008.001^2^^CLINICAL CASE REGISTRIES^VERA Reimbursement Report (HTML)
"KRN",.84,7981008.001,2,0)
^^119^119^3170815^
"KRN",.84,7981008.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981008.001,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981008.001,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981008.001,2,4,0)
 
"KRN",.84,7981008.001,2,5,0)
<xsl:import  href="template://report/998/1"/>  <!-- Styles   --> 
"KRN",.84,7981008.001,2,6,0)
<xsl:import  href="template://report/999/1"/>  <!-- Common   -->
"KRN",.84,7981008.001,2,7,0)
<xsl:import  href="template://report/996/1"/>  <!-- Pharmacy -->
"KRN",.84,7981008.001,2,8,0)
 
"KRN",.84,7981008.001,2,9,0)
<xsl:template match="/">
"KRN",.84,7981008.001,2,10,0)
<html>
"KRN",.84,7981008.001,2,11,0)
  <head>
"KRN",.84,7981008.001,2,12,0)
   <title>VERA Reimbursement Report</title>
"KRN",.84,7981008.001,2,13,0)
   <xsl:call-template name="StyleSheet"/>
"KRN",.84,7981008.001,2,14,0)
  </head>
"KRN",.84,7981008.001,2,15,0)
  <body>
"KRN",.84,7981008.001,2,16,0)
   <h1>VERA Reimbursement Report</h1>
"KRN",.84,7981008.001,2,17,0)
   <xsl:call-template name="ReportHeader"/>
"KRN",.84,7981008.001,2,18,0)
   <!-- The following line added to fix page break issue in IE 7 -->
"KRN",.84,7981008.001,2,19,0)
   <div style="page-break-after:always; font-size:1; margin:0; 
"KRN",.84,7981008.001,2,20,0)
border:0"><span style="visibility: hidden">-</span></div>
"KRN",.84,7981008.001,2,21,0)
   <div>
"KRN",.84,7981008.001,2,22,0)
    <xsl:call-template name="ReportSummary"/>
"KRN",.84,7981008.001,2,23,0)
    <xsl:apply-templates select="/REPORT/DRUGS"/>
"KRN",.84,7981008.001,2,24,0)
    <xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981008.001,2,25,0)
   </div>
"KRN",.84,7981008.001,2,26,0)
  </body>
"KRN",.84,7981008.001,2,27,0)
</html>
"KRN",.84,7981008.001,2,28,0)
</xsl:template>
"KRN",.84,7981008.001,2,29,0)
 
"KRN",.84,7981008.001,2,30,0)
<xsl:template match="REPORT/DRUGS">
"KRN",.84,7981008.001,2,31,0)
<h2>ARV Drugs</h2>
"KRN",.84,7981008.001,2,32,0)
<xsl:call-template name="DataGrid"/>
"KRN",.84,7981008.001,2,33,0)
</xsl:template>
"KRN",.84,7981008.001,2,34,0)
 
"KRN",.84,7981008.001,2,35,0)
<xsl:template match="REPORT/PATIENTS">
"KRN",.84,7981008.001,2,36,0)
<h2>Patients</h2>
"KRN",.84,7981008.001,2,37,0)
<xsl:call-template name="DataGrid"/>
"KRN",.84,7981008.001,2,38,0)
</xsl:template>
"KRN",.84,7981008.001,2,39,0)
 
"KRN",.84,7981008.001,2,40,0)
<!--[ TABLE HEADERS ]-->
"KRN",.84,7981008.001,2,41,0)
 
"KRN",.84,7981008.001,2,42,0)
<xsl:template match="COLUMN[@NAME='AIDSTAT']">
"KRN",.84,7981008.001,2,43,0)
<xsl:param name="rowspan" select="0"/>
"KRN",.84,7981008.001,2,44,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981008.001,2,45,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981008.001,2,46,0)
  <xsl:with-param name="title" select="'AIDS&#160;OI'"/>
"KRN",.84,7981008.001,2,47,0)
  <xsl:with-param name="width" select="'7%'"/>
"KRN",.84,7981008.001,2,48,0)
</xsl:call-template>
"KRN",.84,7981008.001,2,49,0)
</xsl:template>
"KRN",.84,7981008.001,2,50,0)
 
"KRN",.84,7981008.001,2,51,0)
<xsl:template match="COLUMN[@NAME='ARV']">
"KRN",.84,7981008.001,2,52,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981008.001,2,53,0)
  <xsl:with-param name="title" select="'ARV Drugs'"/>
"KRN",.84,7981008.001,2,54,0)
  <xsl:with-param name="width" select="'15%'"/>
"KRN",.84,7981008.001,2,55,0)
</xsl:call-template>
"KRN",.84,7981008.001,2,56,0)
</xsl:template>
"KRN",.84,7981008.001,2,57,0)
 
"KRN",.84,7981008.001,2,58,0)
<xsl:template match="COLUMN[@NAME='COMPLEX']">
"KRN",.84,7981008.001,2,59,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981008.001,2,60,0)
  <xsl:with-param name="title" select="'Complex Care'"/>
"KRN",.84,7981008.001,2,61,0)
  <xsl:with-param name="width" select="'15%'"/>
"KRN",.84,7981008.001,2,62,0)
</xsl:call-template>
"KRN",.84,7981008.001,2,63,0)
</xsl:template>
"KRN",.84,7981008.001,2,64,0)
 
"KRN",.84,7981008.001,2,65,0)
<xsl:template match="COLUMN[@NAME='NP']">
"KRN",.84,7981008.001,2,66,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981008.001,2,67,0)
  <xsl:with-param name="title" select="'Number of Patients'"/>
"KRN",.84,7981008.001,2,68,0)
  <xsl:with-param name="width" select="'15%'"/>
"KRN",.84,7981008.001,2,69,0)
</xsl:call-template>
"KRN",.84,7981008.001,2,70,0)
</xsl:template>
"KRN",.84,7981008.001,2,71,0)
 
"KRN",.84,7981008.001,2,72,0)
<xsl:template match="COLUMN[@NAME='NPAIDS']">
"KRN",.84,7981008.001,2,73,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981008.001,2,74,0)
  <xsl:with-param name="title" select="'Number of AIDS OI Patients'"/>
"KRN",.84,7981008.001,2,75,0)
  <xsl:with-param name="width" select="'15%'"/>
"KRN",.84,7981008.001,2,76,0)
</xsl:call-template>
"KRN",.84,7981008.001,2,77,0)
</xsl:template>
"KRN",.84,7981008.001,2,78,0)
 
"KRN",.84,7981008.001,2,79,0)
<xsl:template match="COLUMN[@NAME='NPHIV']">
"KRN",.84,7981008.001,2,80,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981008.001,2,81,0)
  <xsl:with-param name="title"
"KRN",.84,7981008.001,2,82,0)
                  select="'Number of HIV+ (no AIDS OI) Patients'"/>
"KRN",.84,7981008.001,2,83,0)
  <xsl:with-param name="width" select="'15%'"/>
"KRN",.84,7981008.001,2,84,0)
</xsl:call-template>
"KRN",.84,7981008.001,2,85,0)
</xsl:template>
"KRN",.84,7981008.001,2,86,0)
 
"KRN",.84,7981008.001,2,87,0)
<!--[ TABLE CELLS ]-->
"KRN",.84,7981008.001,2,88,0)
 
"KRN",.84,7981008.001,2,89,0)
<xsl:template match="PATIENT/ARV|PATIENT/COMPLEX|PATIENT/AIDSTAT">
"KRN",.84,7981008.001,2,90,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981008.001,2,91,0)
  <xsl:with-param name="yesno" select="1"/>
"KRN",.84,7981008.001,2,92,0)
</xsl:call-template>
"KRN",.84,7981008.001,2,93,0)
</xsl:template>
"KRN",.84,7981008.001,2,94,0)
 
"KRN",.84,7981008.001,2,95,0)
<!--[ UTILITIES ]-->
"KRN",.84,7981008.001,2,96,0)
 
"KRN",.84,7981008.001,2,97,0)
<xsl:template name="ReportSummary">
"KRN",.84,7981008.001,2,98,0)
<xsl:param name="summary" select="/REPORT/SUMMARY"/>
"KRN",.84,7981008.001,2,99,0)
<table width="100%" cellpadding="5" cellspacing="0">
"KRN",.84,7981008.001,2,100,0)
  <thead>
"KRN",.84,7981008.001,2,101,0)
   <tr>
"KRN",.84,7981008.001,2,102,0)
    <th width="25%">Number of Patients</th>
"KRN",.84,7981008.001,2,103,0)
    <th width="25%">Number of Basic Care Patients</th>
"KRN",.84,7981008.001,2,104,0)
    <th width="25%">Number of Complex Care Patients</th>
"KRN",.84,7981008.001,2,105,0)
    <th width="25%">Number of Patients Received ARV Drugs</th>
"KRN",.84,7981008.001,2,106,0)
   </tr>
"KRN",.84,7981008.001,2,107,0)
  </thead>
"KRN",.84,7981008.001,2,108,0)
  <tbody>
"KRN",.84,7981008.001,2,109,0)
   <tr>
"KRN",.84,7981008.001,2,110,0)
    <td><xsl:value-of select="$summary/NP"/></td>
"KRN",.84,7981008.001,2,111,0)
    <td><xsl:value-of select="$summary/NPBASIC"/></td>
"KRN",.84,7981008.001,2,112,0)
    <td><xsl:value-of select="$summary/NPCOMPLEX"/></td>
"KRN",.84,7981008.001,2,113,0)
    <td><xsl:value-of select="$summary/NPARV"/></td>
"KRN",.84,7981008.001,2,114,0)
   </tr>
"KRN",.84,7981008.001,2,115,0)
  </tbody>
"KRN",.84,7981008.001,2,116,0)
</table>
"KRN",.84,7981008.001,2,117,0)
</xsl:template>
"KRN",.84,7981008.001,2,118,0)
 
"KRN",.84,7981008.001,2,119,0)
</xsl:stylesheet>
"KRN",.84,7981008.002,-1)
0^48
"KRN",.84,7981008.002,0)
7981008.002^2^^CLINICAL CASE REGISTRIES^VERA Reimbursement Report (CSV)
"KRN",.84,7981008.002,2,0)
^^71^71^3170815^
"KRN",.84,7981008.002,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981008.002,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981008.002,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981008.002,2,4,0)
 
"KRN",.84,7981008.002,2,5,0)
<xsl:import href="template://report/999/2"/>  <!-- Common   -->
"KRN",.84,7981008.002,2,6,0)
 
"KRN",.84,7981008.002,2,7,0)
<xsl:template match="/">
"KRN",.84,7981008.002,2,8,0)
<xsl:apply-templates select="/REPORT/DRUGS"/>
"KRN",.84,7981008.002,2,9,0)
<xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981008.002,2,10,0)
</xsl:template>
"KRN",.84,7981008.002,2,11,0)
 
"KRN",.84,7981008.002,2,12,0)
<xsl:template match="REPORT/DRUGS">
"KRN",.84,7981008.002,2,13,0)
<xsl:text>VERA Reimbursement Report (ARV Drugs)</xsl:text>
"KRN",.84,7981008.002,2,14,0)
<xsl:call-template name="DataGrid"/>
"KRN",.84,7981008.002,2,15,0)
<!-- xsl:value-of select="$FILESWITCH"/ -->
"KRN",.84,7981008.002,2,16,0)
</xsl:template>
"KRN",.84,7981008.002,2,17,0)
 
"KRN",.84,7981008.002,2,18,0)
<xsl:template match="REPORT/PATIENTS">
"KRN",.84,7981008.002,2,19,0)
<xsl:text>VERA Reimbursement Report (Patients)</xsl:text>
"KRN",.84,7981008.002,2,20,0)
<xsl:call-template name="DataGrid"/>
"KRN",.84,7981008.002,2,21,0)
<!-- xsl:value-of select="$FILESWITCH"/ -->
"KRN",.84,7981008.002,2,22,0)
</xsl:template>
"KRN",.84,7981008.002,2,23,0)
 
"KRN",.84,7981008.002,2,24,0)
<!--[ TABLE HEADERS ]-->
"KRN",.84,7981008.002,2,25,0)
 
"KRN",.84,7981008.002,2,26,0)
<xsl:template match="COLUMN[@NAME='AIDSTAT']">
"KRN",.84,7981008.002,2,27,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981008.002,2,28,0)
  <xsl:with-param name="title" select="'AIDS OI'"/>
"KRN",.84,7981008.002,2,29,0)
</xsl:call-template>
"KRN",.84,7981008.002,2,30,0)
</xsl:template>
"KRN",.84,7981008.002,2,31,0)
 
"KRN",.84,7981008.002,2,32,0)
<xsl:template match="COLUMN[@NAME='ARV']">
"KRN",.84,7981008.002,2,33,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981008.002,2,34,0)
  <xsl:with-param name="title" select="'ARV Drugs'"/>
"KRN",.84,7981008.002,2,35,0)
</xsl:call-template>
"KRN",.84,7981008.002,2,36,0)
</xsl:template>
"KRN",.84,7981008.002,2,37,0)
 
"KRN",.84,7981008.002,2,38,0)
<xsl:template match="COLUMN[@NAME='COMPLEX']">
"KRN",.84,7981008.002,2,39,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981008.002,2,40,0)
  <xsl:with-param name="title" select="'Complex Care'"/>
"KRN",.84,7981008.002,2,41,0)
</xsl:call-template>
"KRN",.84,7981008.002,2,42,0)
</xsl:template>
"KRN",.84,7981008.002,2,43,0)
 
"KRN",.84,7981008.002,2,44,0)
<xsl:template match="COLUMN[@NAME='NP']">
"KRN",.84,7981008.002,2,45,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981008.002,2,46,0)
  <xsl:with-param name="title" select="'Number of Patients'"/>
"KRN",.84,7981008.002,2,47,0)
</xsl:call-template>
"KRN",.84,7981008.002,2,48,0)
</xsl:template>
"KRN",.84,7981008.002,2,49,0)
 
"KRN",.84,7981008.002,2,50,0)
<xsl:template match="COLUMN[@NAME='NPAIDS']">
"KRN",.84,7981008.002,2,51,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981008.002,2,52,0)
  <xsl:with-param name="title" select="'Number of AIDS OI Patients'"/>
"KRN",.84,7981008.002,2,53,0)
</xsl:call-template>
"KRN",.84,7981008.002,2,54,0)
</xsl:template>
"KRN",.84,7981008.002,2,55,0)
 
"KRN",.84,7981008.002,2,56,0)
<xsl:template match="COLUMN[@NAME='NPHIV']">
"KRN",.84,7981008.002,2,57,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981008.002,2,58,0)
  <xsl:with-param name="title"
"KRN",.84,7981008.002,2,59,0)
                  select="'Number of HIV+ (no AIDS OI) Patients'"/>
"KRN",.84,7981008.002,2,60,0)
</xsl:call-template>
"KRN",.84,7981008.002,2,61,0)
</xsl:template>
"KRN",.84,7981008.002,2,62,0)
 
"KRN",.84,7981008.002,2,63,0)
<!--[ TABLE CELLS ]-->
"KRN",.84,7981008.002,2,64,0)
 
"KRN",.84,7981008.002,2,65,0)
<xsl:template match="PATIENT/ARV|PATIENT/COMPLEX|PATIENT/AIDSTAT">
"KRN",.84,7981008.002,2,66,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981008.002,2,67,0)
  <xsl:with-param name="yesno" select="1"/>
"KRN",.84,7981008.002,2,68,0)
</xsl:call-template>
"KRN",.84,7981008.002,2,69,0)
</xsl:template>
"KRN",.84,7981008.002,2,70,0)
 
"KRN",.84,7981008.002,2,71,0)
</xsl:stylesheet>
"KRN",.84,7981009.001,-1)
0^41
"KRN",.84,7981009.001,0)
7981009.001^2^^CLINICAL CASE REGISTRIES^Pharmacy Prescription Utilization (HTML)
"KRN",.84,7981009.001,2,0)
^^228^228^3170810^
"KRN",.84,7981009.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981009.001,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981009.001,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981009.001,2,4,0)
 
"KRN",.84,7981009.001,2,5,0)
<xsl:import  href="template://report/998/1"/>  <!-- Styles   --> 
"KRN",.84,7981009.001,2,6,0)
<xsl:import  href="template://report/999/1"/>  <!-- Common   -->
"KRN",.84,7981009.001,2,7,0)
<xsl:import  href="template://report/996/1"/>  <!-- Pharmacy -->
"KRN",.84,7981009.001,2,8,0)
 
"KRN",.84,7981009.001,2,9,0)
<xsl:template match="/">
"KRN",.84,7981009.001,2,10,0)
<html>
"KRN",.84,7981009.001,2,11,0)
  <head>
"KRN",.84,7981009.001,2,12,0)
   <title>Pharmacy Prescription Utilization</title>
"KRN",.84,7981009.001,2,13,0)
   <xsl:call-template name="StyleSheet"/>
"KRN",.84,7981009.001,2,14,0)
  </head>
"KRN",.84,7981009.001,2,15,0)
  <body>
"KRN",.84,7981009.001,2,16,0)
   <h1>Pharmacy Prescription Utilization</h1>
"KRN",.84,7981009.001,2,17,0)
   <xsl:call-template name="ReportHeader"/>
"KRN",.84,7981009.001,2,18,0)
   <xsl:choose>
"KRN",.84,7981009.001,2,19,0)
    <xsl:when test="/REPORT/INPATIENTS/*[1]|/REPORT/OUTPATIENTS/*[1]">
"KRN",.84,7981009.001,2,20,0)
     <xsl:apply-templates select="/REPORT/OUTPATIENTS"/>
"KRN",.84,7981009.001,2,21,0)
     <xsl:apply-templates select="/REPORT/INPATIENTS"/>
"KRN",.84,7981009.001,2,22,0)
     <xsl:apply-templates select="/REPORT/SUMMARY"/>
"KRN",.84,7981009.001,2,23,0)
    </xsl:when>
"KRN",.84,7981009.001,2,24,0)
    <xsl:otherwise>
"KRN",.84,7981009.001,2,25,0)
     <xsl:call-template name="TableNoData"/>
"KRN",.84,7981009.001,2,26,0)
    </xsl:otherwise>
"KRN",.84,7981009.001,2,27,0)
   </xsl:choose>
"KRN",.84,7981009.001,2,28,0)
  </body>
"KRN",.84,7981009.001,2,29,0)
</html>
"KRN",.84,7981009.001,2,30,0)
</xsl:template>
"KRN",.84,7981009.001,2,31,0)
 
"KRN",.84,7981009.001,2,32,0)
<xsl:template match="REPORT/INPATIENTS">
"KRN",.84,7981009.001,2,33,0)
<!-- The following line added to fix page break issue in IE 7 -->
"KRN",.84,7981009.001,2,34,0)
<div style="page-break-after:always; font-size:1; margin:0; 
"KRN",.84,7981009.001,2,35,0)
border:0"><span style="visibility: hidden">-</span></div>
"KRN",.84,7981009.001,2,36,0)
<div>
"KRN",.84,7981009.001,2,37,0)
  <h2>Selected Inpatient Activity</h2>
"KRN",.84,7981009.001,2,38,0)
  <xsl:call-template name="InpatientSummary"/>
"KRN",.84,7981009.001,2,39,0)
  <xsl:apply-templates select="*"/>
"KRN",.84,7981009.001,2,40,0)
</div>
"KRN",.84,7981009.001,2,41,0)
</xsl:template>
"KRN",.84,7981009.001,2,42,0)
 
"KRN",.84,7981009.001,2,43,0)
<xsl:template match="REPORT/OUTPATIENTS">
"KRN",.84,7981009.001,2,44,0)
<!-- The following line added to fix page break issue in IE 7 -->
"KRN",.84,7981009.001,2,45,0)
<div style="page-break-after:always; font-size:1; margin:0; 
"KRN",.84,7981009.001,2,46,0)
border:0"><span style="visibility: hidden">-</span></div>
"KRN",.84,7981009.001,2,47,0)
<div>
"KRN",.84,7981009.001,2,48,0)
  <h2>Selected Outpatient Activity</h2>
"KRN",.84,7981009.001,2,49,0)
  <xsl:call-template name="OutpatientSummary"/>
"KRN",.84,7981009.001,2,50,0)
  <xsl:apply-templates select="*"/>
"KRN",.84,7981009.001,2,51,0)
</div>
"KRN",.84,7981009.001,2,52,0)
</xsl:template>
"KRN",.84,7981009.001,2,53,0)
 
"KRN",.84,7981009.001,2,54,0)
<xsl:template match="REPORT/SUMMARY/HU_NRX">
"KRN",.84,7981009.001,2,55,0)
<!-- The following line added to fix page break issue in IE 7 -->
"KRN",.84,7981009.001,2,56,0)
<div style="page-break-after:always; font-size:1; margin:0; 
"KRN",.84,7981009.001,2,57,0)
border:0"><span style="visibility: hidden">-</span></div>
"KRN",.84,7981009.001,2,58,0)
<div>
"KRN",.84,7981009.001,2,59,0)
  <h2>Highest Combined OP and IP Utilization Summary</h2>
"KRN",.84,7981009.001,2,60,0)
  <xsl:call-template name="DataGrid"/>
"KRN",.84,7981009.001,2,61,0)
</div>
"KRN",.84,7981009.001,2,62,0)
</xsl:template>
"KRN",.84,7981009.001,2,63,0)
 
"KRN",.84,7981009.001,2,64,0)
<xsl:template match="INPATIENTS/*">
"KRN",.84,7981009.001,2,65,0)
<xsl:variable name="name" select="name(.)"/>
"KRN",.84,7981009.001,2,66,0)
<xsl:choose>
"KRN",.84,7981009.001,2,67,0)
  <xsl:when test="$name='DOSES'">
"KRN",.84,7981009.001,2,68,0)
   <br clear="both"/>
"KRN",.84,7981009.001,2,69,0)
   <xsl:call-template name="DataGrid">
"KRN",.84,7981009.001,2,70,0)
    <xsl:with-param name="divstyle" select="'width:50%'"/>
"KRN",.84,7981009.001,2,71,0)
   </xsl:call-template>
"KRN",.84,7981009.001,2,72,0)
  </xsl:when>
"KRN",.84,7981009.001,2,73,0)
  <xsl:when test="$name='DRUGS_DOSES'">
"KRN",.84,7981009.001,2,74,0)
   <h3>Inpatient Medications</h3>
"KRN",.84,7981009.001,2,75,0)
   <xsl:call-template name="DataGrid"/>
"KRN",.84,7981009.001,2,76,0)
  </xsl:when>
"KRN",.84,7981009.001,2,77,0)
  <xsl:when test="$name='HU_DOSES'">
"KRN",.84,7981009.001,2,78,0)
   <h3><xsl:call-template name="HUPatientsHeader"/> by number of 
"KRN",.84,7981009.001,2,79,0)
doses</h3>
"KRN",.84,7981009.001,2,80,0)
   <xsl:call-template name="DataGrid"/>
"KRN",.84,7981009.001,2,81,0)
  </xsl:when>
"KRN",.84,7981009.001,2,82,0)
</xsl:choose>
"KRN",.84,7981009.001,2,83,0)
</xsl:template>
"KRN",.84,7981009.001,2,84,0)
 
"KRN",.84,7981009.001,2,85,0)
<xsl:template match="OUTPATIENTS/*">
"KRN",.84,7981009.001,2,86,0)
<xsl:variable name="name" select="name(.)"/>
"KRN",.84,7981009.001,2,87,0)
<xsl:choose>
"KRN",.84,7981009.001,2,88,0)
  <xsl:when test="$name='FILLS'">
"KRN",.84,7981009.001,2,89,0)
   <br clear="both"/>
"KRN",.84,7981009.001,2,90,0)
   <xsl:call-template name="DataGrid">
"KRN",.84,7981009.001,2,91,0)
    <xsl:with-param name="divstyle" select="'width:50%'"/>
"KRN",.84,7981009.001,2,92,0)
   </xsl:call-template>
"KRN",.84,7981009.001,2,93,0)
  </xsl:when>
"KRN",.84,7981009.001,2,94,0)
  <xsl:when test="$name='DRUGS_FILLS'">
"KRN",.84,7981009.001,2,95,0)
   <h3>Outpatient Medications</h3>
"KRN",.84,7981009.001,2,96,0)
   <xsl:call-template name="DataGrid"/>
"KRN",.84,7981009.001,2,97,0)
  </xsl:when>
"KRN",.84,7981009.001,2,98,0)
  <xsl:when test="$name='HU_FILLS'">
"KRN",.84,7981009.001,2,99,0)
   <h3><xsl:call-template name="HUPatientsHeader"/> by number of 
"KRN",.84,7981009.001,2,100,0)
fills</h3>
"KRN",.84,7981009.001,2,101,0)
   <xsl:call-template name="DataGrid"/>
"KRN",.84,7981009.001,2,102,0)
  </xsl:when>
"KRN",.84,7981009.001,2,103,0)
</xsl:choose>
"KRN",.84,7981009.001,2,104,0)
</xsl:template>
"KRN",.84,7981009.001,2,105,0)
 
"KRN",.84,7981009.001,2,106,0)
<!--[ UTILITIES ]-->
"KRN",.84,7981009.001,2,107,0)
 
"KRN",.84,7981009.001,2,108,0)
<xsl:template name="InpatientSummary">
"KRN",.84,7981009.001,2,109,0)
<xsl:variable name="IP" select="."/>
"KRN",.84,7981009.001,2,110,0)
<table width="100%" cellpadding="5" cellspacing="0">
"KRN",.84,7981009.001,2,111,0)
  <thead>
"KRN",.84,7981009.001,2,112,0)
   <tr>
"KRN",.84,7981009.001,2,113,0)
    <th width="33%">Number of Patients</th>
"KRN",.84,7981009.001,2,114,0)
    <th width="33%">Number of Doses</th>
"KRN",.84,7981009.001,2,115,0)
    <th width="33%">Number of Different Medications</th>
"KRN",.84,7981009.001,2,116,0)
   </tr>
"KRN",.84,7981009.001,2,117,0)
  </thead>
"KRN",.84,7981009.001,2,118,0)
  <tbody>
"KRN",.84,7981009.001,2,119,0)
   <tr>
"KRN",.84,7981009.001,2,120,0)
    <td><xsl:value-of select="$IP/NP"/></td>
"KRN",.84,7981009.001,2,121,0)
    <td><xsl:value-of select="$IP/IPNRX"/></td>
"KRN",.84,7981009.001,2,122,0)
    <td><xsl:value-of select="$IP/ND"/></td>
"KRN",.84,7981009.001,2,123,0)
   </tr>
"KRN",.84,7981009.001,2,124,0)
  </tbody>
"KRN",.84,7981009.001,2,125,0)
</table>
"KRN",.84,7981009.001,2,126,0)
</xsl:template>
"KRN",.84,7981009.001,2,127,0)
 
"KRN",.84,7981009.001,2,128,0)
<xsl:template name="OutpatientSummary">
"KRN",.84,7981009.001,2,129,0)
<xsl:variable name="OP" select="."/>
"KRN",.84,7981009.001,2,130,0)
<table width="100%" cellpadding="5" cellspacing="0">
"KRN",.84,7981009.001,2,131,0)
  <thead>
"KRN",.84,7981009.001,2,132,0)
   <tr>
"KRN",.84,7981009.001,2,133,0)
    <th width="33%">Number of Patients</th>
"KRN",.84,7981009.001,2,134,0)
    <th width="33%">Number of Fills</th>
"KRN",.84,7981009.001,2,135,0)
    <th width="33%">Number of Different Medications</th>
"KRN",.84,7981009.001,2,136,0)
   </tr>
"KRN",.84,7981009.001,2,137,0)
  </thead>
"KRN",.84,7981009.001,2,138,0)
  <tbody>
"KRN",.84,7981009.001,2,139,0)
   <tr>
"KRN",.84,7981009.001,2,140,0)
    <td><xsl:value-of select="$OP/NP"/></td>
"KRN",.84,7981009.001,2,141,0)
    <td><xsl:value-of select="$OP/OPNRX"/></td>
"KRN",.84,7981009.001,2,142,0)
    <td><xsl:value-of select="$OP/ND"/></td>
"KRN",.84,7981009.001,2,143,0)
   </tr>
"KRN",.84,7981009.001,2,144,0)
  </tbody>
"KRN",.84,7981009.001,2,145,0)
</table>
"KRN",.84,7981009.001,2,146,0)
</xsl:template>
"KRN",.84,7981009.001,2,147,0)
 
"KRN",.84,7981009.001,2,148,0)
<!--[ COLUMN HEADERS ]-->
"KRN",.84,7981009.001,2,149,0)
 
"KRN",.84,7981009.001,2,150,0)
<xsl:template match="COLUMN[@NAME='IPNRX']">
"KRN",.84,7981009.001,2,151,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981009.001,2,152,0)
  <xsl:with-param name="title" select="'Number of Doses'"/>
"KRN",.84,7981009.001,2,153,0)
  <xsl:with-param name="sortmode" select="':DESC'"/>
"KRN",.84,7981009.001,2,154,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981009.001,2,155,0)
</xsl:call-template> 
"KRN",.84,7981009.001,2,156,0)
</xsl:template>
"KRN",.84,7981009.001,2,157,0)
 
"KRN",.84,7981009.001,2,158,0)
<xsl:template match="COLUMN[@NAME='MAXNP']">
"KRN",.84,7981009.001,2,159,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981009.001,2,160,0)
  <xsl:with-param name="title"
"KRN",.84,7981009.001,2,161,0)
       select="'Number of Patients with Max. Utilization'"/>
"KRN",.84,7981009.001,2,162,0)
  <xsl:with-param name="sortmode" select="':DESC'"/>
"KRN",.84,7981009.001,2,163,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981009.001,2,164,0)
</xsl:call-template>
"KRN",.84,7981009.001,2,165,0)
</xsl:template>
"KRN",.84,7981009.001,2,166,0)
 
"KRN",.84,7981009.001,2,167,0)
<xsl:template match="COLUMN[@NAME='MAXNRPP']">
"KRN",.84,7981009.001,2,168,0)
<xsl:variable name="tblname" select="../@NAME"/>
"KRN",.84,7981009.001,2,169,0)
<xsl:variable name="title">
"KRN",.84,7981009.001,2,170,0)
  <xsl:text>Maximum Number of </xsl:text>
"KRN",.84,7981009.001,2,171,0)
  <xsl:choose>
"KRN",.84,7981009.001,2,172,0)
   <xsl:when test="contains($tblname,'DOSE')">Doses</xsl:when>
"KRN",.84,7981009.001,2,173,0)
  <xsl:when test="contains($tblname,'FILL')">Fills</xsl:when>
"KRN",.84,7981009.001,2,174,0)
   <xsl:otherwise>Doses/Fills</xsl:otherwise>
"KRN",.84,7981009.001,2,175,0)
  </xsl:choose>
"KRN",.84,7981009.001,2,176,0)
  <xsl:text> per Patient</xsl:text>
"KRN",.84,7981009.001,2,177,0)
</xsl:variable>
"KRN",.84,7981009.001,2,178,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981009.001,2,179,0)
  <xsl:with-param name="title" select="$title"/>
"KRN",.84,7981009.001,2,180,0)
  <xsl:with-param name="sortmode" select="':DESC'"/>
"KRN",.84,7981009.001,2,181,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981009.001,2,182,0)
</xsl:call-template>
"KRN",.84,7981009.001,2,183,0)
</xsl:template>
"KRN",.84,7981009.001,2,184,0)
 
"KRN",.84,7981009.001,2,185,0)
<xsl:template match="TBLDEF[contains(@NAME,'HU_')]/COLUMN[@NAME='NAME']">
"KRN",.84,7981009.001,2,186,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981009.001,2,187,0)
  <xsl:with-param name="title" select="'Patient Name'"/>
"KRN",.84,7981009.001,2,188,0)
</xsl:call-template>
"KRN",.84,7981009.001,2,189,0)
</xsl:template>
"KRN",.84,7981009.001,2,190,0)
 
"KRN",.84,7981009.001,2,191,0)
<xsl:template match="COLUMN[@NAME='ND']">
"KRN",.84,7981009.001,2,192,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981009.001,2,193,0)
  <xsl:with-param name="title" select="'Number of Different 
"KRN",.84,7981009.001,2,194,0)
Medications'"/>
"KRN",.84,7981009.001,2,195,0)
  <xsl:with-param name="sortmode" select="':DESC'"/>
"KRN",.84,7981009.001,2,196,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981009.001,2,197,0)
</xsl:call-template>
"KRN",.84,7981009.001,2,198,0)
</xsl:template>
"KRN",.84,7981009.001,2,199,0)
 
"KRN",.84,7981009.001,2,200,0)
<xsl:template match="COLUMN[@NAME='NP']">
"KRN",.84,7981009.001,2,201,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981009.001,2,202,0)
  <xsl:with-param name="title" select="'Number of Patients'"/>
"KRN",.84,7981009.001,2,203,0)
  <xsl:with-param name="sortmode" select="':DESC'"/>
"KRN",.84,7981009.001,2,204,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981009.001,2,205,0)
</xsl:call-template>
"KRN",.84,7981009.001,2,206,0)
</xsl:template>
"KRN",.84,7981009.001,2,207,0)
 
"KRN",.84,7981009.001,2,208,0)
<xsl:template match="COLUMN[@NAME='OPNRX']">
"KRN",.84,7981009.001,2,209,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981009.001,2,210,0)
  <xsl:with-param name="title" select="'Number of Fills'"/>
"KRN",.84,7981009.001,2,211,0)
  <xsl:with-param name="sortmode" select="':DESC'"/>
"KRN",.84,7981009.001,2,212,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981009.001,2,213,0)
</xsl:call-template> 
"KRN",.84,7981009.001,2,214,0)
</xsl:template>
"KRN",.84,7981009.001,2,215,0)
 
"KRN",.84,7981009.001,2,216,0)
<!--[ REPORT PARAMETERS ]-->
"KRN",.84,7981009.001,2,217,0)
 
"KRN",.84,7981009.001,2,218,0)
<xsl:template match="PARAMETERS/MAXUTNUM">
"KRN",.84,7981009.001,2,219,0)
<tr>
"KRN",.84,7981009.001,2,220,0)
  <th scope="row">MaxUtil:&#160;</th>
"KRN",.84,7981009.001,2,221,0)
  <td>
"KRN",.84,7981009.001,2,222,0)
   <xsl:value-of select="."/>
"KRN",.84,7981009.001,2,223,0)
   (maximum number of patients with highest utilization to display)
"KRN",.84,7981009.001,2,224,0)
 </td>
"KRN",.84,7981009.001,2,225,0)
</tr>
"KRN",.84,7981009.001,2,226,0)
</xsl:template>
"KRN",.84,7981009.001,2,227,0)
 
"KRN",.84,7981009.001,2,228,0)
</xsl:stylesheet>
"KRN",.84,7981009.002,-1)
0^42
"KRN",.84,7981009.002,0)
7981009.002^2^^CLINICAL CASE REGISTRIES^Pharmacy Prescription Utilization (CSV)
"KRN",.84,7981009.002,2,0)
^^97^97^3170810^
"KRN",.84,7981009.002,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981009.002,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981009.002,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981009.002,2,4,0)
 
"KRN",.84,7981009.002,2,5,0)
<xsl:import href="template://report/999/2"/>  <!-- Common   -->
"KRN",.84,7981009.002,2,6,0)
 
"KRN",.84,7981009.002,2,7,0)
<xsl:variable name="UTILIZATION_HEADER" select="'Pharmacy Prescription 
"KRN",.84,7981009.002,2,8,0)
Utilization'"/>
"KRN",.84,7981009.002,2,9,0)
 
"KRN",.84,7981009.002,2,10,0)
<xsl:template match="/">
"KRN",.84,7981009.002,2,11,0)
<xsl:call-template name="UtilizationSection">
"KRN",.84,7981009.002,2,12,0)
  <xsl:with-param name="subttl" select="'Fills'"/>
"KRN",.84,7981009.002,2,13,0)
  <xsl:with-param name="data" select="REPORT/OUTPATIENTS/FILLS"/>
"KRN",.84,7981009.002,2,14,0)
</xsl:call-template>
"KRN",.84,7981009.002,2,15,0)
<xsl:call-template name="UtilizationSection">
"KRN",.84,7981009.002,2,16,0)
  <xsl:with-param name="subttl" select="'Outpatient Medications'"/>
"KRN",.84,7981009.002,2,17,0)
  <xsl:with-param name="data" select="REPORT/OUTPATIENTS/DRUGS_FILLS"/>
"KRN",.84,7981009.002,2,18,0)
</xsl:call-template>
"KRN",.84,7981009.002,2,19,0)
<xsl:call-template name="UtilizationSection">
"KRN",.84,7981009.002,2,20,0)
  <xsl:with-param name="subttl"
"KRN",.84,7981009.002,2,21,0)
       select="'Patients with Highest Utilization of Fills'"/>
"KRN",.84,7981009.002,2,22,0)
  <xsl:with-param name="data" select="REPORT/OUTPATIENTS/HU_FILLS"/>
"KRN",.84,7981009.002,2,23,0)
</xsl:call-template>
"KRN",.84,7981009.002,2,24,0)
<xsl:call-template name="UtilizationSection">
"KRN",.84,7981009.002,2,25,0)
  <xsl:with-param name="subttl" select="'Doses'"/>
"KRN",.84,7981009.002,2,26,0)
  <xsl:with-param name="data" select="REPORT/INPATIENTS/DOSES"/>
"KRN",.84,7981009.002,2,27,0)
</xsl:call-template>
"KRN",.84,7981009.002,2,28,0)
<xsl:call-template name="UtilizationSection">
"KRN",.84,7981009.002,2,29,0)
  <xsl:with-param name="subttl" select="'Inpatient Medications'"/>
"KRN",.84,7981009.002,2,30,0)
  <xsl:with-param name="data" select="REPORT/INPATIENTS/DRUGS_DOSES"/>
"KRN",.84,7981009.002,2,31,0)
</xsl:call-template>
"KRN",.84,7981009.002,2,32,0)
<xsl:call-template name="UtilizationSection">
"KRN",.84,7981009.002,2,33,0)
  <xsl:with-param name="subttl"
"KRN",.84,7981009.002,2,34,0)
       select="'Patients with Highest Utilization of Doses'"/>
"KRN",.84,7981009.002,2,35,0)
  <xsl:with-param name="data" select="REPORT/INPATIENTS/HU_DOSES"/>
"KRN",.84,7981009.002,2,36,0)
</xsl:call-template>
"KRN",.84,7981009.002,2,37,0)
<xsl:call-template name="UtilizationSection">
"KRN",.84,7981009.002,2,38,0)
  <xsl:with-param name="subttl"
"KRN",.84,7981009.002,2,39,0)
       select="'Summary'"/>
"KRN",.84,7981009.002,2,40,0)
  <xsl:with-param name="data" select="REPORT/SUMMARY/HU_NRX"/>
"KRN",.84,7981009.002,2,41,0)
</xsl:call-template>
"KRN",.84,7981009.002,2,42,0)
</xsl:template>
"KRN",.84,7981009.002,2,43,0)
 
"KRN",.84,7981009.002,2,44,0)
<!--[ COLUMN HEADERS ]-->
"KRN",.84,7981009.002,2,45,0)
 
"KRN",.84,7981009.002,2,46,0)
<xsl:template match="COLUMN[@NAME='MAXNP']">
"KRN",.84,7981009.002,2,47,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981009.002,2,48,0)
  <xsl:with-param name="title"
"KRN",.84,7981009.002,2,49,0)
       select="'Number of Patients with Max. Utilization'"/>
"KRN",.84,7981009.002,2,50,0)
</xsl:call-template>
"KRN",.84,7981009.002,2,51,0)
</xsl:template>
"KRN",.84,7981009.002,2,52,0)
 
"KRN",.84,7981009.002,2,53,0)
<xsl:template match="TBLDEF[@NAME='DRUGS_DOSES']/COLUMN[@NAME='MAXNRPP']">
"KRN",.84,7981009.002,2,54,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981009.002,2,55,0)
  <xsl:with-param name="title"
"KRN",.84,7981009.002,2,56,0)
       select="'Maximum Number of Doses per Patient'"/>
"KRN",.84,7981009.002,2,57,0)
</xsl:call-template>
"KRN",.84,7981009.002,2,58,0)
</xsl:template>
"KRN",.84,7981009.002,2,59,0)
 
"KRN",.84,7981009.002,2,60,0)
<xsl:template match="TBLDEF[@NAME='DRUGS_FILLS']/COLUMN[@NAME='MAXNRPP']">
"KRN",.84,7981009.002,2,61,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981009.002,2,62,0)
  <xsl:with-param name="title"
"KRN",.84,7981009.002,2,63,0)
       select="'Maximum Number of Fills per Patient'"/>
"KRN",.84,7981009.002,2,64,0)
</xsl:call-template>
"KRN",.84,7981009.002,2,65,0)
</xsl:template>
"KRN",.84,7981009.002,2,66,0)
 
"KRN",.84,7981009.002,2,67,0)
<xsl:template match="TBLDEF[contains(@NAME,'HU_')]/COLUMN[@NAME='NAME']">
"KRN",.84,7981009.002,2,68,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981009.002,2,69,0)
  <xsl:with-param name="title" select="'Patient Name'"/>
"KRN",.84,7981009.002,2,70,0)
</xsl:call-template>
"KRN",.84,7981009.002,2,71,0)
</xsl:template>
"KRN",.84,7981009.002,2,72,0)
 
"KRN",.84,7981009.002,2,73,0)
<xsl:template match="COLUMN[@NAME='ND']">
"KRN",.84,7981009.002,2,74,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981009.002,2,75,0)
  <xsl:with-param name="title" select="'Number of Different Meds'"/>
"KRN",.84,7981009.002,2,76,0)
</xsl:call-template>
"KRN",.84,7981009.002,2,77,0)
</xsl:template>
"KRN",.84,7981009.002,2,78,0)
 
"KRN",.84,7981009.002,2,79,0)
<xsl:template match="COLUMN[@NAME='NP']">
"KRN",.84,7981009.002,2,80,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981009.002,2,81,0)
  <xsl:with-param name="title" select="'Number of Patients'"/>
"KRN",.84,7981009.002,2,82,0)
</xsl:call-template>
"KRN",.84,7981009.002,2,83,0)
</xsl:template>
"KRN",.84,7981009.002,2,84,0)
 
"KRN",.84,7981009.002,2,85,0)
<xsl:template match="COLUMN[@NAME='IPNRX']">
"KRN",.84,7981009.002,2,86,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981009.002,2,87,0)
  <xsl:with-param name="title" select="'Number of Doses'"/>
"KRN",.84,7981009.002,2,88,0)
</xsl:call-template> 
"KRN",.84,7981009.002,2,89,0)
</xsl:template>
"KRN",.84,7981009.002,2,90,0)
 
"KRN",.84,7981009.002,2,91,0)
<xsl:template match="COLUMN[@NAME='OPNRX']">
"KRN",.84,7981009.002,2,92,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981009.002,2,93,0)
  <xsl:with-param name="title" select="'Number of Fills'"/>
"KRN",.84,7981009.002,2,94,0)
</xsl:call-template> 
"KRN",.84,7981009.002,2,95,0)
</xsl:template>
"KRN",.84,7981009.002,2,96,0)
 
"KRN",.84,7981009.002,2,97,0)
</xsl:stylesheet>
"KRN",.84,7981010.001,-1)
0^23
"KRN",.84,7981010.001,0)
7981010.001^2^^CLINICAL CASE REGISTRIES^Registry Lab Tests by Range (HTML)
"KRN",.84,7981010.001,2,0)
^^104^104^3170811^
"KRN",.84,7981010.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981010.001,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981010.001,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981010.001,2,4,0)
 
"KRN",.84,7981010.001,2,5,0)
<xsl:import  href="template://report/998/1"/> <!-- Styles   -->
"KRN",.84,7981010.001,2,6,0)
<xsl:import  href="template://report/999/1"/> <!-- Common   -->
"KRN",.84,7981010.001,2,7,0)
<xsl:include href="template://report/997/1"/> <!-- Patients -->
"KRN",.84,7981010.001,2,8,0)
<xsl:include href="template://report/995/1"/> <!-- Lab Data -->
"KRN",.84,7981010.001,2,9,0)
 
"KRN",.84,7981010.001,2,10,0)
<xsl:template match="/">
"KRN",.84,7981010.001,2,11,0)
<html>
"KRN",.84,7981010.001,2,12,0)
  <head>
"KRN",.84,7981010.001,2,13,0)
   <title>Registry Lab Tests by Range</title>
"KRN",.84,7981010.001,2,14,0)
   <xsl:call-template name="StyleSheet"/>
"KRN",.84,7981010.001,2,15,0)
  </head>
"KRN",.84,7981010.001,2,16,0)
  <body>
"KRN",.84,7981010.001,2,17,0)
   <h1>Registry Lab Tests by Range</h1>
"KRN",.84,7981010.001,2,18,0)
   <xsl:call-template name="ReportHeader"/>
"KRN",.84,7981010.001,2,19,0)
   <xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981010.001,2,20,0)
  </body>
"KRN",.84,7981010.001,2,21,0)
</html>
"KRN",.84,7981010.001,2,22,0)
</xsl:template>
"KRN",.84,7981010.001,2,23,0)
 
"KRN",.84,7981010.001,2,24,0)
<xsl:template match="REPORT/PATIENTS">
"KRN",.84,7981010.001,2,25,0)
<!-- The following line added to fix page break issue in IE 7 -->
"KRN",.84,7981010.001,2,26,0)
<div style="page-break-after:always; font-size:1; margin:0; 
"KRN",.84,7981010.001,2,27,0)
border:0"><span style="visibility: hidden">-</span></div>
"KRN",.84,7981010.001,2,28,0)
<div>
"KRN",.84,7981010.001,2,29,0)
  <xsl:call-template name="DataGrid">
"KRN",.84,7981010.001,2,30,0)
   <xsl:with-param name="scroll" select="descendant::LT[31]"/>
"KRN",.84,7981010.001,2,31,0)
  </xsl:call-template>
"KRN",.84,7981010.001,2,32,0)
</div>
"KRN",.84,7981010.001,2,33,0)
</xsl:template>
"KRN",.84,7981010.001,2,34,0)
 
"KRN",.84,7981010.001,2,35,0)
<!--[ TABLE HEADER ]-->
"KRN",.84,7981010.001,2,36,0)
 
"KRN",.84,7981010.001,2,37,0)
<xsl:template match="TBLDEF[@NAME='PATIENTS']/@HEADER">
"KRN",.84,7981010.001,2,38,0)
<xsl:variable name="PTLRL" select="../COLUMN[@NAME='PTLRL']"/>
"KRN",.84,7981010.001,2,39,0)
<thead>
"KRN",.84,7981010.001,2,40,0)
  <tr>
"KRN",.84,7981010.001,2,41,0)
   <xsl:call-template name="BasicPatientHeader">
"KRN",.84,7981010.001,2,42,0)
    <xsl:with-param name="rowspan" select="2"/>
"KRN",.84,7981010.001,2,43,0)
    <xsl:with-param name="icnyes"  select="$ICN_YES"/>
"KRN",.84,7981010.001,2,44,0)
    <xsl:with-param name="pactyes" select="$PACT_YES"/>
"KRN",.84,7981010.001,2,45,0)
    <xsl:with-param name="pcpyes"  select="$PCP_YES"/>
"KRN",.84,7981010.001,2,46,0)
   </xsl:call-template>
"KRN",.84,7981010.001,2,47,0)
   <xsl:call-template name="ColumnHeader">
"KRN",.84,7981010.001,2,48,0)
    <xsl:with-param name="column" select="$PTLRL"/>
"KRN",.84,7981010.001,2,49,0)
    <xsl:with-param name="colspan" select="4"/>
"KRN",.84,7981010.001,2,50,0)
    <xsl:with-param name="title" select="'Laboratory 
"KRN",.84,7981010.001,2,51,0)
Tests'"/>                                  
"KRN",.84,7981010.001,2,52,0)
    <xsl:with-param name="sort" select="''"/>
"KRN",.84,7981010.001,2,53,0)
    <xsl:with-param name="width" select="'60%'"/>
"KRN",.84,7981010.001,2,54,0)
   </xsl:call-template>
"KRN",.84,7981010.001,2,55,0)
  </tr>
"KRN",.84,7981010.001,2,56,0)
  <tr>
"KRN",.84,7981010.001,2,57,0)
   <xsl:call-template name="BasicLRHeader">
"KRN",.84,7981010.001,2,58,0)
    <xsl:with-param name="group" select="1"/>
"KRN",.84,7981010.001,2,59,0)
   </xsl:call-template>
"KRN",.84,7981010.001,2,60,0)
  </tr>
"KRN",.84,7981010.001,2,61,0)
</thead>
"KRN",.84,7981010.001,2,62,0)
</xsl:template>
"KRN",.84,7981010.001,2,63,0)
 
"KRN",.84,7981010.001,2,64,0)
<!--[ TABLE CELLS ]-->
"KRN",.84,7981010.001,2,65,0)
 
"KRN",.84,7981010.001,2,66,0)
<xsl:template match="PATIENTS/PATIENT">
"KRN",.84,7981010.001,2,67,0)
<xsl:variable name="rowspan" select="count(PTLRL/LT)"/>
"KRN",.84,7981010.001,2,68,0)
<tr>
"KRN",.84,7981010.001,2,69,0)
  <xsl:call-template name="BasicPatientData">
"KRN",.84,7981010.001,2,70,0)
   <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981010.001,2,71,0)
   <xsl:with-param name="icnyes"  select="$ICN_YES"/>
"KRN",.84,7981010.001,2,72,0)
   <xsl:with-param name="pactyes" select="$PACT_YES"/>
"KRN",.84,7981010.001,2,73,0)
   <xsl:with-param name="pcpyes"  select="$PCP_YES"/>
"KRN",.84,7981010.001,2,74,0)
  </xsl:call-template>
"KRN",.84,7981010.001,2,75,0)
  <xsl:for-each select="PTLRL/LT[1]">
"KRN",.84,7981010.001,2,76,0)
   <xsl:call-template name="BasicLRData">
"KRN",.84,7981010.001,2,77,0)
    <xsl:with-param name="group" select="1"/>
"KRN",.84,7981010.001,2,78,0)
   </xsl:call-template>
"KRN",.84,7981010.001,2,79,0)
  </xsl:for-each>
"KRN",.84,7981010.001,2,80,0)
</tr>
"KRN",.84,7981010.001,2,81,0)
<xsl:for-each select="PTLRL/LT[position()>1]">
"KRN",.84,7981010.001,2,82,0)
  <tr>
"KRN",.84,7981010.001,2,83,0)
   <xsl:call-template name="BasicLRData">
"KRN",.84,7981010.001,2,84,0)
    <xsl:with-param name="group" select="1"/>
"KRN",.84,7981010.001,2,85,0)
   </xsl:call-template>
"KRN",.84,7981010.001,2,86,0)
  </tr>
"KRN",.84,7981010.001,2,87,0)
</xsl:for-each>
"KRN",.84,7981010.001,2,88,0)
</xsl:template>
"KRN",.84,7981010.001,2,89,0)
 
"KRN",.84,7981010.001,2,90,0)
<!--[ REPORT PARAMETERS ]-->
"KRN",.84,7981010.001,2,91,0)
<!-- 
"KRN",.84,7981010.001,2,92,0)
<xsl:template match="PARAMETERS/LRGRANGES">
"KRN",.84,7981010.001,2,93,0)
<tr>
"KRN",.84,7981010.001,2,94,0)
  <th scope="row">Lab Results:&#160;</th>
"KRN",.84,7981010.001,2,95,0)
  <td>
"KRN",.84,7981010.001,2,96,0)
   <xsl:for-each select="LRGRANGE">
"KRN",.84,7981010.001,2,97,0)
    <xsl:value-of select="."/><br/>
"KRN",.84,7981010.001,2,98,0)
   </xsl:for-each>
"KRN",.84,7981010.001,2,99,0)
  </td>
"KRN",.84,7981010.001,2,100,0)
</tr>
"KRN",.84,7981010.001,2,101,0)
</xsl:template>
"KRN",.84,7981010.001,2,102,0)
--> 
"KRN",.84,7981010.001,2,103,0)
 
"KRN",.84,7981010.001,2,104,0)
</xsl:stylesheet>
"KRN",.84,7981010.002,-1)
0^24
"KRN",.84,7981010.002,0)
7981010.002^2^^CLINICAL CASE REGISTRIES^Registry Lab Tests by Range (CSV)
"KRN",.84,7981010.002,2,0)
^^87^87^3170811^
"KRN",.84,7981010.002,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981010.002,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981010.002,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981010.002,2,4,0)
 
"KRN",.84,7981010.002,2,5,0)
<xsl:import href="template://report/999/2"/>  <!-- Common   -->
"KRN",.84,7981010.002,2,6,0)
 
"KRN",.84,7981010.002,2,7,0)
<xsl:template match="/">
"KRN",.84,7981010.002,2,8,0)
  <xsl:text>Registry Lab Tests by Range</xsl:text>
"KRN",.84,7981010.002,2,9,0)
  <xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981010.002,2,10,0)
</xsl:template>
"KRN",.84,7981010.002,2,11,0)
 
"KRN",.84,7981010.002,2,12,0)
<xsl:template match="PATIENTS/PATIENT">
"KRN",.84,7981010.002,2,13,0)
<xsl:variable name="ptname" select="NAME"/>
"KRN",.84,7981010.002,2,14,0)
<xsl:variable name="ssn"  select="LAST4"/>
"KRN",.84,7981010.002,2,15,0)
<xsl:variable name="age"  select="AGE"/>
"KRN",.84,7981010.002,2,16,0)
<xsl:variable name="dob"  select="DOB"/>
"KRN",.84,7981010.002,2,17,0)
<xsl:variable name="dod"  select="DOD"/>
"KRN",.84,7981010.002,2,18,0)
<xsl:variable name="icn"  select="ICN"/>
"KRN",.84,7981010.002,2,19,0)
<xsl:variable name="pact" select="PACT"/>
"KRN",.84,7981010.002,2,20,0)
<xsl:variable name="pcp"  select="PCP"/>
"KRN",.84,7981010.002,2,21,0)
<xsl:for-each select="PTLRL/LT">
"KRN",.84,7981010.002,2,22,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981010.002,2,23,0)
   <xsl:with-param name="value" select="$ptname"/>
"KRN",.84,7981010.002,2,24,0)
  </xsl:call-template>
"KRN",.84,7981010.002,2,25,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981010.002,2,26,0)
   <xsl:with-param name="value" select="$ssn"/>
"KRN",.84,7981010.002,2,27,0)
  </xsl:call-template>
"KRN",.84,7981010.002,2,28,0)
  <xsl:if test="$AGE_YES">
"KRN",.84,7981010.002,2,29,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981010.002,2,30,0)
    <xsl:with-param name="value" select="$age"/>
"KRN",.84,7981010.002,2,31,0)
   </xsl:call-template>
"KRN",.84,7981010.002,2,32,0)
  </xsl:if>
"KRN",.84,7981010.002,2,33,0)
  <xsl:if test="$DOB_YES">
"KRN",.84,7981010.002,2,34,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981010.002,2,35,0)
    <xsl:with-param name="value" select="$dob"/>
"KRN",.84,7981010.002,2,36,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981010.002,2,37,0)
   </xsl:call-template>
"KRN",.84,7981010.002,2,38,0)
  </xsl:if>
"KRN",.84,7981010.002,2,39,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981010.002,2,40,0)
   <xsl:with-param name="value" select="$dod"/>
"KRN",.84,7981010.002,2,41,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981010.002,2,42,0)
  </xsl:call-template>
"KRN",.84,7981010.002,2,43,0)
  <xsl:if test="$ICN_YES">
"KRN",.84,7981010.002,2,44,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981010.002,2,45,0)
    <xsl:with-param name="value" select="$icn"/>
"KRN",.84,7981010.002,2,46,0)
   </xsl:call-template>
"KRN",.84,7981010.002,2,47,0)
  </xsl:if>
"KRN",.84,7981010.002,2,48,0)
  <xsl:if test="$PACT_YES">
"KRN",.84,7981010.002,2,49,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981010.002,2,50,0)
    <xsl:with-param name="value" select="$pact"/>
"KRN",.84,7981010.002,2,51,0)
   </xsl:call-template>
"KRN",.84,7981010.002,2,52,0)
  </xsl:if>
"KRN",.84,7981010.002,2,53,0)
  <xsl:if test="$PCP_YES">
"KRN",.84,7981010.002,2,54,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981010.002,2,55,0)
    <xsl:with-param name="value" select="$pcp"/>
"KRN",.84,7981010.002,2,56,0)
   </xsl:call-template>
"KRN",.84,7981010.002,2,57,0)
  </xsl:if>
"KRN",.84,7981010.002,2,58,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981010.002,2,59,0)
   <xsl:with-param name="value" select="GROUP"/>
"KRN",.84,7981010.002,2,60,0)
  </xsl:call-template>
"KRN",.84,7981010.002,2,61,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981010.002,2,62,0)
   <xsl:with-param name="value" select="DATE"/>
"KRN",.84,7981010.002,2,63,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981010.002,2,64,0)
  </xsl:call-template>
"KRN",.84,7981010.002,2,65,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981010.002,2,66,0)
   <xsl:with-param name="value" select="NAME"/>
"KRN",.84,7981010.002,2,67,0)
  </xsl:call-template>
"KRN",.84,7981010.002,2,68,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981010.002,2,69,0)
   <xsl:with-param name="value" select="RESULT"/>
"KRN",.84,7981010.002,2,70,0)
  </xsl:call-template>
"KRN",.84,7981010.002,2,71,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981010.002,2,72,0)
</xsl:for-each>
"KRN",.84,7981010.002,2,73,0)
</xsl:template>
"KRN",.84,7981010.002,2,74,0)
 
"KRN",.84,7981010.002,2,75,0)
<xsl:template match="COLUMN[@NAME='GROUP']">
"KRN",.84,7981010.002,2,76,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981010.002,2,77,0)
  <xsl:with-param name="title" select="'Group'"/>
"KRN",.84,7981010.002,2,78,0)
</xsl:call-template>
"KRN",.84,7981010.002,2,79,0)
</xsl:template>
"KRN",.84,7981010.002,2,80,0)
 
"KRN",.84,7981010.002,2,81,0)
<xsl:template match="COLUMN[@NAME='RESULT']">
"KRN",.84,7981010.002,2,82,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981010.002,2,83,0)
  <xsl:with-param name="title" select="'Result'"/>
"KRN",.84,7981010.002,2,84,0)
</xsl:call-template>
"KRN",.84,7981010.002,2,85,0)
</xsl:template>
"KRN",.84,7981010.002,2,86,0)
 
"KRN",.84,7981010.002,2,87,0)
</xsl:stylesheet>
"KRN",.84,7981011.001,-1)
0^14
"KRN",.84,7981011.001,0)
7981011.001^2^^CLINICAL CASE REGISTRIES^Patient Medication History (HTML)
"KRN",.84,7981011.001,2,0)
^^202^202^3170809^
"KRN",.84,7981011.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981011.001,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981011.001,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981011.001,2,4,0)
 
"KRN",.84,7981011.001,2,5,0)
<xsl:import  href="template://report/998/1"/>  <!-- Styles   --> 
"KRN",.84,7981011.001,2,6,0)
<xsl:import  href="template://report/999/1"/>  <!-- Common   -->
"KRN",.84,7981011.001,2,7,0)
<xsl:import  href="template://report/997/1"/>  <!-- Patients -->
"KRN",.84,7981011.001,2,8,0)
<xsl:include href="template://report/996/1"/>  <!-- Pharmacy -->
"KRN",.84,7981011.001,2,9,0)
 
"KRN",.84,7981011.001,2,10,0)
<xsl:template match="/">
"KRN",.84,7981011.001,2,11,0)
<html>
"KRN",.84,7981011.001,2,12,0)
  <head>
"KRN",.84,7981011.001,2,13,0)
   <title>Patient Medication History</title>
"KRN",.84,7981011.001,2,14,0)
   <xsl:call-template name="StyleSheet"/>
"KRN",.84,7981011.001,2,15,0)
  </head>
"KRN",.84,7981011.001,2,16,0)
  <body>
"KRN",.84,7981011.001,2,17,0)
   <h1>Patient Medication History</h1>
"KRN",.84,7981011.001,2,18,0)
   <xsl:call-template name="ReportHeader"/> 
"KRN",.84,7981011.001,2,19,0)
   <xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981011.001,2,20,0)
  </body>
"KRN",.84,7981011.001,2,21,0)
</html>
"KRN",.84,7981011.001,2,22,0)
</xsl:template>
"KRN",.84,7981011.001,2,23,0)
 
"KRN",.84,7981011.001,2,24,0)
<xsl:template match="PATIENTS/PATIENT">
"KRN",.84,7981011.001,2,25,0)
<!-- The following line added to fix page break issue in IE 7 -->
"KRN",.84,7981011.001,2,26,0)
<div style="page-break-after:always; font-size:1; margin:0; 
"KRN",.84,7981011.001,2,27,0)
border:0"><span style="visibility: hidden">-</span></div>
"KRN",.84,7981011.001,2,28,0)
<div>
"KRN",.84,7981011.001,2,29,0)
  <h2><xsl:value-of select="NAME"/></h2>
"KRN",.84,7981011.001,2,30,0)
  <table width="70%" cellpadding="5" cellspacing="0">
"KRN",.84,7981011.001,2,31,0)
   <xsl:if test="$ICN_YES or $PACT_YES or $PCP_YES">
"KRN",.84,7981011.001,2,32,0)
    <xsl:attribute name="width">95%</xsl:attribute>
"KRN",.84,7981011.001,2,33,0)
   </xsl:if>
"KRN",.84,7981011.001,2,34,0)
   <thead>
"KRN",.84,7981011.001,2,35,0)
    <tr>
"KRN",.84,7981011.001,2,36,0)
     <xsl:call-template name="ColumnHeader">
"KRN",.84,7981011.001,2,37,0)
      <xsl:with-param name="sort" select="''"/>
"KRN",.84,7981011.001,2,38,0)
      <xsl:with-param name="title" select="'#'"/>
"KRN",.84,7981011.001,2,39,0)
      <xsl:with-param name="width" select="'4%'"/>
"KRN",.84,7981011.001,2,40,0)
     </xsl:call-template>
"KRN",.84,7981011.001,2,41,0)
     <xsl:call-template name="ColumnHeader">
"KRN",.84,7981011.001,2,42,0)
      <xsl:with-param name="sort" select="'PATIENTS=NAME'"/>
"KRN",.84,7981011.001,2,43,0)
      <xsl:with-param name="title" select="'Patient Name'"/>
"KRN",.84,7981011.001,2,44,0)
     </xsl:call-template>
"KRN",.84,7981011.001,2,45,0)
     <xsl:call-template name="ColumnHeader">
"KRN",.84,7981011.001,2,46,0)
      <xsl:with-param name="sort" select="'PATIENTS=LAST4'"/>
"KRN",.84,7981011.001,2,47,0)
      <xsl:with-param name="title" select="'SSN'"/>
"KRN",.84,7981011.001,2,48,0)
      <xsl:with-param name="width" select="'5%'"/>
"KRN",.84,7981011.001,2,49,0)
     </xsl:call-template>
"KRN",.84,7981011.001,2,50,0)
     <xsl:call-template name="ColumnHeader">
"KRN",.84,7981011.001,2,51,0)
      <xsl:with-param name="sort" select="'PATIENTS=DOB'"/>
"KRN",.84,7981011.001,2,52,0)
      <xsl:with-param name="title" select="'Date of Birth'"/>
"KRN",.84,7981011.001,2,53,0)
      <xsl:with-param name="width" select="'7%'"/>
"KRN",.84,7981011.001,2,54,0)
     </xsl:call-template>
"KRN",.84,7981011.001,2,55,0)
     <xsl:call-template name="ColumnHeader">
"KRN",.84,7981011.001,2,56,0)
      <xsl:with-param name="sort" select="'PATIENTS=AGE'"/>
"KRN",.84,7981011.001,2,57,0)
      <xsl:with-param name="title" select="'Age'"/>
"KRN",.84,7981011.001,2,58,0)
      <xsl:with-param name="width" select="'5%'"/>
"KRN",.84,7981011.001,2,59,0)
     </xsl:call-template>
"KRN",.84,7981011.001,2,60,0)
     <xsl:call-template name="ColumnHeader">
"KRN",.84,7981011.001,2,61,0)
      <xsl:with-param name="sort" select="'PATIENTS=DOD'"/>
"KRN",.84,7981011.001,2,62,0)
      <xsl:with-param name="title" select="'Date of Death'"/>
"KRN",.84,7981011.001,2,63,0)
      <xsl:with-param name="width" select="'7%'"/>
"KRN",.84,7981011.001,2,64,0)
     </xsl:call-template>
"KRN",.84,7981011.001,2,65,0)
     <xsl:if test="$ICN_YES">
"KRN",.84,7981011.001,2,66,0)
      <xsl:call-template name="ColumnHeader">
"KRN",.84,7981011.001,2,67,0)
       <xsl:with-param name="sort" select="'PATIENTS=ICN'"/>
"KRN",.84,7981011.001,2,68,0)
       <xsl:with-param name="title" select="'ICN'"/>
"KRN",.84,7981011.001,2,69,0)
       <xsl:with-param name="width" select="'14%'"/>
"KRN",.84,7981011.001,2,70,0)
      </xsl:call-template>
"KRN",.84,7981011.001,2,71,0)
     </xsl:if>
"KRN",.84,7981011.001,2,72,0)
     <xsl:if test="$PACT_YES">
"KRN",.84,7981011.001,2,73,0)
      <xsl:call-template name="ColumnHeader">
"KRN",.84,7981011.001,2,74,0)
       <xsl:with-param name="sort" select="'PATIENTS=PACT'"/>
"KRN",.84,7981011.001,2,75,0)
       <xsl:with-param name="title" select="'PACT'"/>
"KRN",.84,7981011.001,2,76,0)
       <xsl:with-param name="width" select="'12%'"/>
"KRN",.84,7981011.001,2,77,0)
      </xsl:call-template>
"KRN",.84,7981011.001,2,78,0)
     </xsl:if>
"KRN",.84,7981011.001,2,79,0)
     <xsl:if test="$PCP_YES">
"KRN",.84,7981011.001,2,80,0)
      <xsl:call-template name="ColumnHeader">
"KRN",.84,7981011.001,2,81,0)
       <xsl:with-param name="sort" select="'PATIENTS=PCP'"/>
"KRN",.84,7981011.001,2,82,0)
       <xsl:with-param name="title" select="'PCP'"/>
"KRN",.84,7981011.001,2,83,0)
       <xsl:with-param name="width" select="'14%'"/>
"KRN",.84,7981011.001,2,84,0)
      </xsl:call-template>
"KRN",.84,7981011.001,2,85,0)
     </xsl:if>
"KRN",.84,7981011.001,2,86,0)
    </tr>
"KRN",.84,7981011.001,2,87,0)
   </thead>
"KRN",.84,7981011.001,2,88,0)
   <tbody>
"KRN",.84,7981011.001,2,89,0)
    <tr>
"KRN",.84,7981011.001,2,90,0)
     <xsl:call-template name="TableCell">
"KRN",.84,7981011.001,2,91,0)
      <xsl:with-param name="value" select="position()"/>
"KRN",.84,7981011.001,2,92,0)
     </xsl:call-template>
"KRN",.84,7981011.001,2,93,0)
     <xsl:call-template name="TableCell">
"KRN",.84,7981011.001,2,94,0)
      <xsl:with-param name="value" select="NAME"/>
"KRN",.84,7981011.001,2,95,0)
      <xsl:with-param name="class" select="'aLeft'"/>
"KRN",.84,7981011.001,2,96,0)
     </xsl:call-template>
"KRN",.84,7981011.001,2,97,0)
     <xsl:call-template name="TableCell">
"KRN",.84,7981011.001,2,98,0)
      <xsl:with-param name="value" select="LAST4"/>
"KRN",.84,7981011.001,2,99,0)
     </xsl:call-template>
"KRN",.84,7981011.001,2,100,0)
     <xsl:call-template name="TableCell">
"KRN",.84,7981011.001,2,101,0)
      <xsl:with-param name="value" select="DOB"/>
"KRN",.84,7981011.001,2,102,0)
      <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981011.001,2,103,0)
     </xsl:call-template>
"KRN",.84,7981011.001,2,104,0)
     <xsl:call-template name="TableCell">
"KRN",.84,7981011.001,2,105,0)
      <xsl:with-param name="value" select="AGE"/>
"KRN",.84,7981011.001,2,106,0)
     </xsl:call-template>
"KRN",.84,7981011.001,2,107,0)
     <xsl:call-template name="TableCell">
"KRN",.84,7981011.001,2,108,0)
      <xsl:with-param name="value" select="DOD"/>
"KRN",.84,7981011.001,2,109,0)
      <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981011.001,2,110,0)
     </xsl:call-template>
"KRN",.84,7981011.001,2,111,0)
     <xsl:if test="$ICN_YES">
"KRN",.84,7981011.001,2,112,0)
      <xsl:call-template name="TableCell">
"KRN",.84,7981011.001,2,113,0)
       <xsl:with-param name="value" select="ICN"/>
"KRN",.84,7981011.001,2,114,0)
       <xsl:with-param name="class" select="'aLeft'"/>
"KRN",.84,7981011.001,2,115,0)
      </xsl:call-template>
"KRN",.84,7981011.001,2,116,0)
     </xsl:if>
"KRN",.84,7981011.001,2,117,0)
     <xsl:if test="$PACT_YES">
"KRN",.84,7981011.001,2,118,0)
      <xsl:call-template name="TableCell">
"KRN",.84,7981011.001,2,119,0)
       <xsl:with-param name="value" select="PACT"/>
"KRN",.84,7981011.001,2,120,0)
       <xsl:with-param name="class" select="'aLeft'"/>
"KRN",.84,7981011.001,2,121,0)
      </xsl:call-template>
"KRN",.84,7981011.001,2,122,0)
     </xsl:if>
"KRN",.84,7981011.001,2,123,0)
     <xsl:if test="$PCP_YES">
"KRN",.84,7981011.001,2,124,0)
      <xsl:call-template name="TableCell">
"KRN",.84,7981011.001,2,125,0)
       <xsl:with-param name="value" select="PCP"/>
"KRN",.84,7981011.001,2,126,0)
       <xsl:with-param name="class" select="'aLeft'"/>
"KRN",.84,7981011.001,2,127,0)
      </xsl:call-template>
"KRN",.84,7981011.001,2,128,0)
     </xsl:if>
"KRN",.84,7981011.001,2,129,0)
    </tr>
"KRN",.84,7981011.001,2,130,0)
   </tbody>
"KRN",.84,7981011.001,2,131,0)
  </table>
"KRN",.84,7981011.001,2,132,0)
  <h3>Drug History</h3>
"KRN",.84,7981011.001,2,133,0)
  <xsl:apply-templates select="PTRXL"/>
"KRN",.84,7981011.001,2,134,0)
</div>
"KRN",.84,7981011.001,2,135,0)
</xsl:template>
"KRN",.84,7981011.001,2,136,0)
 
"KRN",.84,7981011.001,2,137,0)
<!--[ TABLE HEADERS ]-->
"KRN",.84,7981011.001,2,138,0)
 
"KRN",.84,7981011.001,2,139,0)
<xsl:template match="COLUMN[@NAME='DATE']">
"KRN",.84,7981011.001,2,140,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981011.001,2,141,0)
  <xsl:with-param name="title" select="'Date'"/>
"KRN",.84,7981011.001,2,142,0)
  <xsl:with-param name="width" select="'5%'"/>
"KRN",.84,7981011.001,2,143,0)
</xsl:call-template>
"KRN",.84,7981011.001,2,144,0)
</xsl:template>
"KRN",.84,7981011.001,2,145,0)
 
"KRN",.84,7981011.001,2,146,0)
<xsl:template match="COLUMN[@NAME='DAYSPLY']">
"KRN",.84,7981011.001,2,147,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981011.001,2,148,0)
  <xsl:with-param name="title" select="'Days Supply'"/>
"KRN",.84,7981011.001,2,149,0)
  <xsl:with-param name="width" select="'7%'"/>
"KRN",.84,7981011.001,2,150,0)
</xsl:call-template>
"KRN",.84,7981011.001,2,151,0)
</xsl:template>
"KRN",.84,7981011.001,2,152,0)
 
"KRN",.84,7981011.001,2,153,0)
<xsl:template match="COLUMN[@NAME='FILLTYPE']">
"KRN",.84,7981011.001,2,154,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981011.001,2,155,0)
  <xsl:with-param name="title" select="'Fill Type'"/>
"KRN",.84,7981011.001,2,156,0)
  <xsl:with-param name="width" select="'5%'"/>
"KRN",.84,7981011.001,2,157,0)
</xsl:call-template>
"KRN",.84,7981011.001,2,158,0)
</xsl:template>
"KRN",.84,7981011.001,2,159,0)
 
"KRN",.84,7981011.001,2,160,0)
<xsl:template match="COLUMN[@NAME='REFILLS']">
"KRN",.84,7981011.001,2,161,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981011.001,2,162,0)
  <xsl:with-param name="title" select="'Refills Remaining'"/>
"KRN",.84,7981011.001,2,163,0)
  <xsl:with-param name="width" select="'7%'"/>
"KRN",.84,7981011.001,2,164,0)
</xsl:call-template>
"KRN",.84,7981011.001,2,165,0)
</xsl:template>
"KRN",.84,7981011.001,2,166,0)
 
"KRN",.84,7981011.001,2,167,0)
<xsl:template match="COLUMN[@NAME='GENERIC']">
"KRN",.84,7981011.001,2,168,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981011.001,2,169,0)
  <xsl:with-param name="title" select="'Generic Name'"/>
"KRN",.84,7981011.001,2,170,0)
</xsl:call-template>
"KRN",.84,7981011.001,2,171,0)
</xsl:template>
"KRN",.84,7981011.001,2,172,0)
 
"KRN",.84,7981011.001,2,173,0)
<xsl:template match="COLUMN[@NAME='ORDER']">
"KRN",.84,7981011.001,2,174,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981011.001,2,175,0)
  <xsl:with-param name="title" select="'Rx#'"/>
"KRN",.84,7981011.001,2,176,0)
  <xsl:with-param name="width" select="'5%'"/>
"KRN",.84,7981011.001,2,177,0)
  <xsl:with-param name="sort" select="'PTRXL=ORDER'"/>
"KRN",.84,7981011.001,2,178,0)
</xsl:call-template>
"KRN",.84,7981011.001,2,179,0)
</xsl:template>
"KRN",.84,7981011.001,2,180,0)
 
"KRN",.84,7981011.001,2,181,0)
<xsl:template match="COLUMN[@NAME='TYPE']">
"KRN",.84,7981011.001,2,182,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981011.001,2,183,0)
  <xsl:with-param name="title" select="'Type'"/>
"KRN",.84,7981011.001,2,184,0)
  <xsl:with-param name="width" select="'5%'"/>
"KRN",.84,7981011.001,2,185,0)
</xsl:call-template>
"KRN",.84,7981011.001,2,186,0)
</xsl:template>
"KRN",.84,7981011.001,2,187,0)
 
"KRN",.84,7981011.001,2,188,0)
<!--[ TABLE CELLS ]-->
"KRN",.84,7981011.001,2,189,0)
 
"KRN",.84,7981011.001,2,190,0)
<xsl:template match="DRUG/DATE">
"KRN",.84,7981011.001,2,191,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981011.001,2,192,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981011.001,2,193,0)
</xsl:call-template>
"KRN",.84,7981011.001,2,194,0)
</xsl:template>
"KRN",.84,7981011.001,2,195,0)
 
"KRN",.84,7981011.001,2,196,0)
<xsl:template match="DRUG/GENERIC">
"KRN",.84,7981011.001,2,197,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981011.001,2,198,0)
  <xsl:with-param name="class" select="'aLeft'"/>
"KRN",.84,7981011.001,2,199,0)
</xsl:call-template>
"KRN",.84,7981011.001,2,200,0)
</xsl:template>
"KRN",.84,7981011.001,2,201,0)
 
"KRN",.84,7981011.001,2,202,0)
</xsl:stylesheet>
"KRN",.84,7981011.002,-1)
0^15
"KRN",.84,7981011.002,0)
7981011.002^2^^CLINICAL CASE REGISTRIES^Patient Medication History (CSV)
"KRN",.84,7981011.002,2,0)
^^109^109^3170809^
"KRN",.84,7981011.002,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981011.002,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981011.002,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981011.002,2,4,0)
 
"KRN",.84,7981011.002,2,5,0)
<xsl:import  href="template://report/999/2"/>  <!-- Common   -->
"KRN",.84,7981011.002,2,6,0)
<xsl:include href="template://report/997/2"/>  <!-- Patients -->
"KRN",.84,7981011.002,2,7,0)
 
"KRN",.84,7981011.002,2,8,0)
<xsl:template match="/">
"KRN",.84,7981011.002,2,9,0)
<xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981011.002,2,10,0)
</xsl:template>
"KRN",.84,7981011.002,2,11,0)
 
"KRN",.84,7981011.002,2,12,0)
<xsl:template match="PATIENTS/PATIENT">
"KRN",.84,7981011.002,2,13,0)
<xsl:text>Patient Medication History</xsl:text>
"KRN",.84,7981011.002,2,14,0)
<xsl:value-of select="$CRLF"/>
"KRN",.84,7981011.002,2,15,0)
<xsl:text>Patient Name,SSN,Date of Birth,Age,Date of Death</xsl:text>
"KRN",.84,7981011.002,2,16,0)
<xsl:if test="$ICN_YES">,ICN</xsl:if>
"KRN",.84,7981011.002,2,17,0)
<xsl:if test="$PACT_YES">,PACT</xsl:if>
"KRN",.84,7981011.002,2,18,0)
<xsl:if test="$PCP_YES">,PCP</xsl:if>
"KRN",.84,7981011.002,2,19,0)
<xsl:value-of select="$CRLF"/>
"KRN",.84,7981011.002,2,20,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981011.002,2,21,0)
  <xsl:with-param name="value" select="NAME"/>
"KRN",.84,7981011.002,2,22,0)
</xsl:call-template>
"KRN",.84,7981011.002,2,23,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981011.002,2,24,0)
  <xsl:with-param name="value" select="LAST4"/>
"KRN",.84,7981011.002,2,25,0)
</xsl:call-template>
"KRN",.84,7981011.002,2,26,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981011.002,2,27,0)
  <xsl:with-param name="value" select="DOB"/>
"KRN",.84,7981011.002,2,28,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981011.002,2,29,0)
</xsl:call-template>
"KRN",.84,7981011.002,2,30,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981011.002,2,31,0)
  <xsl:with-param name="value" select="AGE"/>
"KRN",.84,7981011.002,2,32,0)
</xsl:call-template>
"KRN",.84,7981011.002,2,33,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981011.002,2,34,0)
  <xsl:with-param name="value" select="DOD"/>
"KRN",.84,7981011.002,2,35,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981011.002,2,36,0)
</xsl:call-template>
"KRN",.84,7981011.002,2,37,0)
<xsl:if test="$ICN_YES">
"KRN",.84,7981011.002,2,38,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981011.002,2,39,0)
    <xsl:with-param name="value" select="ICN"/>
"KRN",.84,7981011.002,2,40,0)
   </xsl:call-template>
"KRN",.84,7981011.002,2,41,0)
</xsl:if>
"KRN",.84,7981011.002,2,42,0)
<xsl:if test="$PACT_YES">
"KRN",.84,7981011.002,2,43,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981011.002,2,44,0)
    <xsl:with-param name="value" select="PACT"/>
"KRN",.84,7981011.002,2,45,0)
   </xsl:call-template>
"KRN",.84,7981011.002,2,46,0)
</xsl:if>
"KRN",.84,7981011.002,2,47,0)
<xsl:if test="$PCP_YES">
"KRN",.84,7981011.002,2,48,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981011.002,2,49,0)
    <xsl:with-param name="value" select="PCP"/>
"KRN",.84,7981011.002,2,50,0)
   </xsl:call-template>
"KRN",.84,7981011.002,2,51,0)
</xsl:if>
"KRN",.84,7981011.002,2,52,0)
<xsl:value-of select="$CRLF"/>
"KRN",.84,7981011.002,2,53,0)
<xsl:apply-templates select="PTRXL"/>
"KRN",.84,7981011.002,2,54,0)
<!-- xsl:value-of select="$FILESWITCH"/ -->
"KRN",.84,7981011.002,2,55,0)
</xsl:template>
"KRN",.84,7981011.002,2,56,0)
 
"KRN",.84,7981011.002,2,57,0)
<!--[ TABLE HEADERS ]-->
"KRN",.84,7981011.002,2,58,0)
 
"KRN",.84,7981011.002,2,59,0)
<xsl:template match="COLUMN[@NAME='DATE']">
"KRN",.84,7981011.002,2,60,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981011.002,2,61,0)
  <xsl:with-param name="title" select="'Date'"/>
"KRN",.84,7981011.002,2,62,0)
</xsl:call-template>
"KRN",.84,7981011.002,2,63,0)
</xsl:template>
"KRN",.84,7981011.002,2,64,0)
 
"KRN",.84,7981011.002,2,65,0)
<xsl:template match="COLUMN[@NAME='DAYSPLY']">
"KRN",.84,7981011.002,2,66,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981011.002,2,67,0)
  <xsl:with-param name="title" select="'Days Supply'"/>
"KRN",.84,7981011.002,2,68,0)
</xsl:call-template>
"KRN",.84,7981011.002,2,69,0)
</xsl:template>
"KRN",.84,7981011.002,2,70,0)
 
"KRN",.84,7981011.002,2,71,0)
<xsl:template match="COLUMN[@NAME='FILLTYPE']">
"KRN",.84,7981011.002,2,72,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981011.002,2,73,0)
  <xsl:with-param name="title" select="'Fill Type'"/>
"KRN",.84,7981011.002,2,74,0)
</xsl:call-template>
"KRN",.84,7981011.002,2,75,0)
</xsl:template>
"KRN",.84,7981011.002,2,76,0)
 
"KRN",.84,7981011.002,2,77,0)
<xsl:template match="COLUMN[@NAME='REFILLS']">
"KRN",.84,7981011.002,2,78,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981011.002,2,79,0)
  <xsl:with-param name="title" select="'Refills Remaining'"/>
"KRN",.84,7981011.002,2,80,0)
</xsl:call-template>
"KRN",.84,7981011.002,2,81,0)
</xsl:template>
"KRN",.84,7981011.002,2,82,0)
 
"KRN",.84,7981011.002,2,83,0)
<xsl:template match="COLUMN[@NAME='GENERIC']">
"KRN",.84,7981011.002,2,84,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981011.002,2,85,0)
  <xsl:with-param name="title" select="'Generic Name'"/>
"KRN",.84,7981011.002,2,86,0)
</xsl:call-template>
"KRN",.84,7981011.002,2,87,0)
</xsl:template>
"KRN",.84,7981011.002,2,88,0)
 
"KRN",.84,7981011.002,2,89,0)
<xsl:template match="COLUMN[@NAME='ORDER']">
"KRN",.84,7981011.002,2,90,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981011.002,2,91,0)
  <xsl:with-param name="title" select="'Rx#'"/>
"KRN",.84,7981011.002,2,92,0)
</xsl:call-template>
"KRN",.84,7981011.002,2,93,0)
</xsl:template>
"KRN",.84,7981011.002,2,94,0)
 
"KRN",.84,7981011.002,2,95,0)
<xsl:template match="COLUMN[@NAME='TYPE']">
"KRN",.84,7981011.002,2,96,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981011.002,2,97,0)
  <xsl:with-param name="title" select="'Type'"/>
"KRN",.84,7981011.002,2,98,0)
</xsl:call-template>
"KRN",.84,7981011.002,2,99,0)
</xsl:template>
"KRN",.84,7981011.002,2,100,0)
 
"KRN",.84,7981011.002,2,101,0)
<!--[ TABLE CELLS ]-->
"KRN",.84,7981011.002,2,102,0)
 
"KRN",.84,7981011.002,2,103,0)
<xsl:template match="DRUG/DATE">
"KRN",.84,7981011.002,2,104,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981011.002,2,105,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981011.002,2,106,0)
</xsl:call-template>
"KRN",.84,7981011.002,2,107,0)
</xsl:template>
"KRN",.84,7981011.002,2,108,0)
 
"KRN",.84,7981011.002,2,109,0)
</xsl:stylesheet>
"KRN",.84,7981012.001,-1)
0^19
"KRN",.84,7981012.001,0)
7981012.001^2^^CLINICAL CASE REGISTRIES^Combined Meds and Labs Report (HTML)
"KRN",.84,7981012.001,2,0)
^^485^485^3170802^
"KRN",.84,7981012.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981012.001,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981012.001,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981012.001,2,4,0)
 
"KRN",.84,7981012.001,2,5,0)
<xsl:import  href="template://report/998/1"/>  <!-- Styles   --> 
"KRN",.84,7981012.001,2,6,0)
<xsl:import  href="template://report/999/1"/>  <!-- Common   -->
"KRN",.84,7981012.001,2,7,0)
<xsl:import  href="template://report/997/1"/>  <!-- Patients -->
"KRN",.84,7981012.001,2,8,0)
<xsl:include href="template://report/996/1"/>  <!-- Pharmacy -->
"KRN",.84,7981012.001,2,9,0)
<xsl:include href="template://report/995/1"/>  <!-- Lab Data -->
"KRN",.84,7981012.001,2,10,0)
 
"KRN",.84,7981012.001,2,11,0)
<xsl:key name="patient-drug" match="/REPORT/DRUGS/DRUG"  use="@ID"/>
"KRN",.84,7981012.001,2,12,0)
<xsl:key name="patient-lt"   match="/REPORT/LABTESTS/LT" use="@ID"/>
"KRN",.84,7981012.001,2,13,0)
<xsl:key name="patient-both" 
"KRN",.84,7981012.001,2,14,0)
match="/REPORT/DRUGS/DRUG|/REPORT/LABTESTS/LT" use="@ID"/>
"KRN",.84,7981012.001,2,15,0)
 
"KRN",.84,7981012.001,2,16,0)
<!-- Determine if the Meds and/or Labs table is not empty. -->
"KRN",.84,7981012.001,2,17,0)
<xsl:variable name="D1" select="/REPORT/DRUGS/DRUG[1]"/>
"KRN",.84,7981012.001,2,18,0)
<xsl:variable name="L1" select="/REPORT/LABTESTS/LT[1]"/>
"KRN",.84,7981012.001,2,19,0)
 
"KRN",.84,7981012.001,2,20,0)
<!-- Determine if the Meds and/or Labs table is sorted by a patient data 
"KRN",.84,7981012.001,2,21,0)
field. -->
"KRN",.84,7981012.001,2,22,0)
<xsl:variable name="PTCOLS"   select="',AGE,DOB,DOD,LAST4,NAME,'"/>
"KRN",.84,7981012.001,2,23,0)
<xsl:variable name="PTSDRUGS" 
"KRN",.84,7981012.001,2,24,0)
select="contains($PTCOLS,concat(',',/REPORT/DRUGS/@SORT,','))"/>
"KRN",.84,7981012.001,2,25,0)
<xsl:variable name="PTSLABS"  
"KRN",.84,7981012.001,2,26,0)
select="contains($PTCOLS,concat(',',/REPORT/LABTESTS/@SORT,','))"/>
"KRN",.84,7981012.001,2,27,0)
 
"KRN",.84,7981012.001,2,28,0)
<xsl:template match="/">
"KRN",.84,7981012.001,2,29,0)
<html>
"KRN",.84,7981012.001,2,30,0)
  <head>
"KRN",.84,7981012.001,2,31,0)
   <title>Combined Meds and Labs Report</title>
"KRN",.84,7981012.001,2,32,0)
   <xsl:call-template name="StyleSheet"/>
"KRN",.84,7981012.001,2,33,0)
  </head>
"KRN",.84,7981012.001,2,34,0)
  <body>
"KRN",.84,7981012.001,2,35,0)
   <h1>Combined Meds and Labs Report</h1>
"KRN",.84,7981012.001,2,36,0)
   <xsl:call-template name="ReportHeader"/>
"KRN",.84,7981012.001,2,37,0)
   <xsl:choose>
"KRN",.84,7981012.001,2,38,0)
    <!-- 
"KRN",.84,7981012.001,2,39,0)
     If both Meds and Labs tables are not empty and at least one of them
"KRN",.84,7981012.001,2,40,0)
     is sorted by patient data field, then group the data by patients.
"KRN",.84,7981012.001,2,41,0)
    -->
"KRN",.84,7981012.001,2,42,0)
    <xsl:when test="$D1 and $L1 and ($PTSDRUGS or $PTSLABS)">
"KRN",.84,7981012.001,2,43,0)
     <xsl:call-template name="MedsAndLabs"/>
"KRN",.84,7981012.001,2,44,0)
    </xsl:when>
"KRN",.84,7981012.001,2,45,0)
    <!-- 
"KRN",.84,7981012.001,2,46,0)
     Otherwise, format available data using separate tables.
"KRN",.84,7981012.001,2,47,0)
    -->
"KRN",.84,7981012.001,2,48,0)
    <xsl:when test="$D1 or $L1 or /REPORT/PATIENTS/PATIENT[1]">
"KRN",.84,7981012.001,2,49,0)
     <xsl:apply-templates select="/REPORT/DRUGS"/>
"KRN",.84,7981012.001,2,50,0)
     <xsl:apply-templates select="/REPORT/LABTESTS"/>
"KRN",.84,7981012.001,2,51,0)
     <xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981012.001,2,52,0)
    </xsl:when>
"KRN",.84,7981012.001,2,53,0)
    <xsl:otherwise>
"KRN",.84,7981012.001,2,54,0)
     <xsl:call-template name="TableNoData"/>
"KRN",.84,7981012.001,2,55,0)
    </xsl:otherwise>
"KRN",.84,7981012.001,2,56,0)
   </xsl:choose>
"KRN",.84,7981012.001,2,57,0)
  </body>
"KRN",.84,7981012.001,2,58,0)
</html>
"KRN",.84,7981012.001,2,59,0)
</xsl:template>
"KRN",.84,7981012.001,2,60,0)
 
"KRN",.84,7981012.001,2,61,0)
<xsl:template name="MedsAndLabs">
"KRN",.84,7981012.001,2,62,0)
<xsl:variable name="SORT">
"KRN",.84,7981012.001,2,63,0)
  <xsl:choose>
"KRN",.84,7981012.001,2,64,0)
   <xsl:when test="$PTSDRUGS"><xsl:value-of 
"KRN",.84,7981012.001,2,65,0)
select="/REPORT/DRUGS/@SORT"/></xsl:when>
"KRN",.84,7981012.001,2,66,0)
   <xsl:when test="$PTSLABS"><xsl:value-of 
"KRN",.84,7981012.001,2,67,0)
select="/REPORT/LABTESTS/@SORT"/></xsl:when>
"KRN",.84,7981012.001,2,68,0)
   <xsl:otherwise>NAME</xsl:otherwise>
"KRN",.84,7981012.001,2,69,0)
  </xsl:choose>
"KRN",.84,7981012.001,2,70,0)
</xsl:variable>
"KRN",.84,7981012.001,2,71,0)
<xsl:variable name="SORTORD">
"KRN",.84,7981012.001,2,72,0)
  <xsl:choose>
"KRN",.84,7981012.001,2,73,0)
   <xsl:when test="($PTSDRUGS and boolean(/REPORT/DRUGS/@SORTDESC)) or 
"KRN",.84,7981012.001,2,74,0)
    ($PTSLABS and 
"KRN",.84,7981012.001,2,75,0)
boolean(/REPORT/LABTESTS/@SORTDESC))">descending</xsl:when>
"KRN",.84,7981012.001,2,76,0)
   <xsl:otherwise>ascending</xsl:otherwise>
"KRN",.84,7981012.001,2,77,0)
  </xsl:choose>
"KRN",.84,7981012.001,2,78,0)
</xsl:variable>
"KRN",.84,7981012.001,2,79,0)
<xsl:for-each 
"KRN",.84,7981012.001,2,80,0)
select="/REPORT//*[generate-id(.)=generate-id(key('patient-both',@ID))]">
"KRN",.84,7981012.001,2,81,0)
  <!--
"KRN",.84,7981012.001,2,82,0)
  <xsl:sort select="concat(*[name()=$SORT],' ')" order="{$SORTORD}"/>
"KRN",.84,7981012.001,2,83,0)
  <xsl:sort select="NAME"/>
"KRN",.84,7981012.001,2,84,0)
  -->
"KRN",.84,7981012.001,2,85,0)
  <xsl:sort select="concat(*[name()=$SORT],'&#10;',NAME)" 
"KRN",.84,7981012.001,2,86,0)
order="{$SORTORD}"/>
"KRN",.84,7981012.001,2,87,0)
  <!-- The following line added to fix page break issue in IE 7 -->
"KRN",.84,7981012.001,2,88,0)
  <div style="page-break-after:always; font-size:1; margin:0; 
"KRN",.84,7981012.001,2,89,0)
border:0"><span style="visibility: hidden">-</span></div>
"KRN",.84,7981012.001,2,90,0)
  <div>
"KRN",.84,7981012.001,2,91,0)
   <table style="width:100%" cellpadding="5" cellspacing="0">
"KRN",.84,7981012.001,2,92,0)
    <thead>
"KRN",.84,7981012.001,2,93,0)
     <tr>
"KRN",.84,7981012.001,2,94,0)
      <xsl:call-template name="ColumnHeader">
"KRN",.84,7981012.001,2,95,0)
       <xsl:with-param name="sort" select="''"/>
"KRN",.84,7981012.001,2,96,0)
       <xsl:with-param name="title" select="'#'"/>
"KRN",.84,7981012.001,2,97,0)
       <xsl:with-param name="width" select="'4%'"/>
"KRN",.84,7981012.001,2,98,0)
      </xsl:call-template>
"KRN",.84,7981012.001,2,99,0)
      <xsl:call-template name="ColumnHeader">
"KRN",.84,7981012.001,2,100,0)
       <xsl:with-param name="sort" 
"KRN",.84,7981012.001,2,101,0)
select="'DRUGS=NAME&amp;LABTESTS=NAME'"/>
"KRN",.84,7981012.001,2,102,0)
       <xsl:with-param name="title" select="'Patient Name'"/>
"KRN",.84,7981012.001,2,103,0)
      </xsl:call-template>
"KRN",.84,7981012.001,2,104,0)
      <xsl:call-template name="ColumnHeader">
"KRN",.84,7981012.001,2,105,0)
       <xsl:with-param name="sort" 
"KRN",.84,7981012.001,2,106,0)
select="'DRUGS=LAST4&amp;LABTESTS=LAST4'"/>
"KRN",.84,7981012.001,2,107,0)
       <xsl:with-param name="title" select="'SSN'"/>
"KRN",.84,7981012.001,2,108,0)
       <xsl:with-param name="width" select="'7%'"/>
"KRN",.84,7981012.001,2,109,0)
      </xsl:call-template>
"KRN",.84,7981012.001,2,110,0)
      <xsl:if test="$AGE_YES">
"KRN",.84,7981012.001,2,111,0)
       <xsl:call-template name="ColumnHeader">
"KRN",.84,7981012.001,2,112,0)
        <xsl:with-param name="sort" 
"KRN",.84,7981012.001,2,113,0)
select="'DRUGS=AGE&amp;LABTESTS=AGE'"/>
"KRN",.84,7981012.001,2,114,0)
        <xsl:with-param name="title" select="'Age'"/>
"KRN",.84,7981012.001,2,115,0)
        <xsl:with-param name="width" select="'4%'"/>
"KRN",.84,7981012.001,2,116,0)
       </xsl:call-template>
"KRN",.84,7981012.001,2,117,0)
      </xsl:if>
"KRN",.84,7981012.001,2,118,0)
      <xsl:if test="$DOB_YES">
"KRN",.84,7981012.001,2,119,0)
       <xsl:call-template name="ColumnHeader">
"KRN",.84,7981012.001,2,120,0)
        <xsl:with-param name="sort" 
"KRN",.84,7981012.001,2,121,0)
select="'DRUGS=DOB&amp;LABTESTS=DOB'"/>
"KRN",.84,7981012.001,2,122,0)
        <xsl:with-param name="title" select="'Date of Birth'"/>
"KRN",.84,7981012.001,2,123,0)
        <xsl:with-param name="width" select="'7%'"/>
"KRN",.84,7981012.001,2,124,0)
       </xsl:call-template>
"KRN",.84,7981012.001,2,125,0)
      </xsl:if>
"KRN",.84,7981012.001,2,126,0)
      <xsl:call-template name="ColumnHeader">
"KRN",.84,7981012.001,2,127,0)
       <xsl:with-param name="sort" select="'DRUGS=DOD&amp;LABTESTS=DOD'"/>
"KRN",.84,7981012.001,2,128,0)
      <xsl:with-param name="title" select="'Date of Death'"/>
"KRN",.84,7981012.001,2,129,0)
       <xsl:with-param name="width" select="'7%'"/>
"KRN",.84,7981012.001,2,130,0)
      </xsl:call-template>
"KRN",.84,7981012.001,2,131,0)
      <xsl:if test="$ICN_YES">
"KRN",.84,7981012.001,2,132,0)
       <xsl:call-template name="ColumnHeader">
"KRN",.84,7981012.001,2,133,0)
        <xsl:with-param name="sort" 
"KRN",.84,7981012.001,2,134,0)
select="'DRUGS=ICN&amp;LABTESTS=ICN'"/>
"KRN",.84,7981012.001,2,135,0)
        <xsl:with-param name="title" select="'ICN'"/>
"KRN",.84,7981012.001,2,136,0)
        <xsl:with-param name="width" select="'12%'"/>
"KRN",.84,7981012.001,2,137,0)
       </xsl:call-template>
"KRN",.84,7981012.001,2,138,0)
      </xsl:if>
"KRN",.84,7981012.001,2,139,0)
      <xsl:if test="$PACT_YES">
"KRN",.84,7981012.001,2,140,0)
       <xsl:call-template name="ColumnHeader">
"KRN",.84,7981012.001,2,141,0)
        <xsl:with-param name="sort" 
"KRN",.84,7981012.001,2,142,0)
select="'DRUGS=ICN&amp;LABTESTS=PACT'"/>
"KRN",.84,7981012.001,2,143,0)
        <xsl:with-param name="title" select="'PACT'"/>
"KRN",.84,7981012.001,2,144,0)
        <xsl:with-param name="width" select="'12%'"/>
"KRN",.84,7981012.001,2,145,0)
       </xsl:call-template>
"KRN",.84,7981012.001,2,146,0)
      </xsl:if>
"KRN",.84,7981012.001,2,147,0)
      <xsl:if test="$PCP_YES">
"KRN",.84,7981012.001,2,148,0)
       <xsl:call-template name="ColumnHeader">
"KRN",.84,7981012.001,2,149,0)
        <xsl:with-param name="sort" 
"KRN",.84,7981012.001,2,150,0)
select="'DRUGS=ICN&amp;LABTESTS=PCP'"/>
"KRN",.84,7981012.001,2,151,0)
        <xsl:with-param name="title" select="'PCP'"/>
"KRN",.84,7981012.001,2,152,0)
        <xsl:with-param name="width" select="'12%'"/>
"KRN",.84,7981012.001,2,153,0)
       </xsl:call-template>
"KRN",.84,7981012.001,2,154,0)
      </xsl:if>
"KRN",.84,7981012.001,2,155,0)
    </tr>
"KRN",.84,7981012.001,2,156,0)
    </thead>
"KRN",.84,7981012.001,2,157,0)
    <tr>
"KRN",.84,7981012.001,2,158,0)
     <xsl:call-template name="BasicPatientData">
"KRN",.84,7981012.001,2,159,0)
      <xsl:with-param name="seqnum"  select="1"/>
"KRN",.84,7981012.001,2,160,0)
      <xsl:with-param name="ageyes"  select="$AGE_YES"/>
"KRN",.84,7981012.001,2,161,0)
      <xsl:with-param name="dobyes"  select="$DOB_YES"/>
"KRN",.84,7981012.001,2,162,0)
      <xsl:with-param name="icnyes"  select="$ICN_YES"/>
"KRN",.84,7981012.001,2,163,0)
      <xsl:with-param name="pactyes" select="$PACT_YES"/>
"KRN",.84,7981012.001,2,164,0)
      <xsl:with-param name="pcpyes"  select="$PCP_YES"/>
"KRN",.84,7981012.001,2,165,0)
     </xsl:call-template>
"KRN",.84,7981012.001,2,166,0)
    </tr>
"KRN",.84,7981012.001,2,167,0)
   </table>
"KRN",.84,7981012.001,2,168,0)
   <br/>
"KRN",.84,7981012.001,2,169,0)
   <table cellpadding="5" cellspacing="0" style="float:left;width:43%;">
"KRN",.84,7981012.001,2,170,0)
    <thead>
"KRN",.84,7981012.001,2,171,0)
     <tr>
"KRN",.84,7981012.001,2,172,0)
      <xsl:call-template name="ColumnHeader">
"KRN",.84,7981012.001,2,173,0)
       <xsl:with-param name="colname" select="'RXNAME'"/>
"KRN",.84,7981012.001,2,174,0)
       <xsl:with-param name="sort" 
"KRN",.84,7981012.001,2,175,0)
select="'DRUGS=RXNAME:ASC&amp;LABTESTS=LTNAME:ASC'"/>
"KRN",.84,7981012.001,2,176,0)
       <xsl:with-param name="title" select="'Medication Name'"/>
"KRN",.84,7981012.001,2,177,0)
      </xsl:call-template>
"KRN",.84,7981012.001,2,178,0)
     </tr>
"KRN",.84,7981012.001,2,179,0)
    </thead>
"KRN",.84,7981012.001,2,180,0)
    <xsl:call-template name="DataGridFooter">
"KRN",.84,7981012.001,2,181,0)
     <xsl:with-param name="colspan" select="15"/>    <!-- Make bigger 
"KRN",.84,7981012.001,2,182,0)
than number of columns -->
"KRN",.84,7981012.001,2,183,0)
    </xsl:call-template>
"KRN",.84,7981012.001,2,184,0)
    <tbody>
"KRN",.84,7981012.001,2,185,0)
    <xsl:for-each select="key('patient-drug',@ID)">
"KRN",.84,7981012.001,2,186,0)
      <xsl:sort select="RXNAME"/>
"KRN",.84,7981012.001,2,187,0)
      <tr><xsl:call-template name="DrugData"/></tr>
"KRN",.84,7981012.001,2,188,0)
     </xsl:for-each>
"KRN",.84,7981012.001,2,189,0)
    </tbody>
"KRN",.84,7981012.001,2,190,0)
   </table>
"KRN",.84,7981012.001,2,191,0)
   <table cellpadding="5" cellspacing="0" style="float:right;width:55%;">
"KRN",.84,7981012.001,2,192,0)
    <thead>
"KRN",.84,7981012.001,2,193,0)
     <tr>
"KRN",.84,7981012.001,2,194,0)
      <xsl:call-template name="ColumnHeader">
"KRN",.84,7981012.001,2,195,0)
       <xsl:with-param name="sort" 
"KRN",.84,7981012.001,2,196,0)
select="'LABTESTS=DATE:DESC&amp;DRUGS=RXNAME:ASC'"/>
"KRN",.84,7981012.001,2,197,0)
       <xsl:with-param name="title" select="'Date'"/>    
"KRN",.84,7981012.001,2,198,0)
       <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981012.001,2,199,0)
      </xsl:call-template>
"KRN",.84,7981012.001,2,200,0)
      <xsl:call-template name="ColumnHeader">
"KRN",.84,7981012.001,2,201,0)
       <xsl:with-param name="sort" 
"KRN",.84,7981012.001,2,202,0)
select="'LABTESTS=LTNAME:ASC&amp;DRUGS=RXNAME:ASC'"/>
"KRN",.84,7981012.001,2,203,0)
       <xsl:with-param name="title" select="'Test Name'"/>    
"KRN",.84,7981012.001,2,204,0)
      </xsl:call-template>
"KRN",.84,7981012.001,2,205,0)
      <xsl:call-template name="ColumnHeader">
"KRN",.84,7981012.001,2,206,0)
       <xsl:with-param name="sort" 
"KRN",.84,7981012.001,2,207,0)
select="'LABTESTS=RESULT:ASC&amp;DRUGS=RXNAME:ASC'"/>
"KRN",.84,7981012.001,2,208,0)
       <xsl:with-param name="title" select="'Result'"/>
"KRN",.84,7981012.001,2,209,0)
       <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981012.001,2,210,0)
      </xsl:call-template>
"KRN",.84,7981012.001,2,211,0)
     </tr>
"KRN",.84,7981012.001,2,212,0)
    </thead>
"KRN",.84,7981012.001,2,213,0)
    <xsl:call-template name="DataGridFooter">
"KRN",.84,7981012.001,2,214,0)
     <xsl:with-param name="colspan" select="3"/>
"KRN",.84,7981012.001,2,215,0)
    </xsl:call-template>
"KRN",.84,7981012.001,2,216,0)
    <tbody>
"KRN",.84,7981012.001,2,217,0)
     <xsl:for-each select="key('patient-lt',@ID)">
"KRN",.84,7981012.001,2,218,0)
      <!--
"KRN",.84,7981012.001,2,219,0)
      <xsl:sort select="LTNAME"/>
"KRN",.84,7981012.001,2,220,0)
      <xsl:sort select="DATE" data-type="number"/>
"KRN",.84,7981012.001,2,221,0)
      -->
"KRN",.84,7981012.001,2,222,0)
      <xsl:sort select="concat(LTNAME,'&#10;',DATE)"/>
"KRN",.84,7981012.001,2,223,0)
      <tr>
"KRN",.84,7981012.001,2,224,0)
       <xsl:call-template name="BasicLRData">
"KRN",.84,7981012.001,2,225,0)
        <xsl:with-param name="name" select="LTNAME"/>
"KRN",.84,7981012.001,2,226,0)
       </xsl:call-template>
"KRN",.84,7981012.001,2,227,0)
      </tr>
"KRN",.84,7981012.001,2,228,0)
     </xsl:for-each>
"KRN",.84,7981012.001,2,229,0)
    </tbody>
"KRN",.84,7981012.001,2,230,0)
   </table>
"KRN",.84,7981012.001,2,231,0)
   <br clear="all"/><br/>
"KRN",.84,7981012.001,2,232,0)
  </div>
"KRN",.84,7981012.001,2,233,0)
</xsl:for-each>
"KRN",.84,7981012.001,2,234,0)
</xsl:template>
"KRN",.84,7981012.001,2,235,0)
 
"KRN",.84,7981012.001,2,236,0)
<!--[ TABLES ]-->
"KRN",.84,7981012.001,2,237,0)
 
"KRN",.84,7981012.001,2,238,0)
<xsl:template match="REPORT/DRUGS">
"KRN",.84,7981012.001,2,239,0)
<div style="page-break-before:always">
"KRN",.84,7981012.001,2,240,0)
  <h2>Medications</h2>
"KRN",.84,7981012.001,2,241,0)
  <xsl:choose>
"KRN",.84,7981012.001,2,242,0)
   <xsl:when test="$D1">
"KRN",.84,7981012.001,2,243,0)
    <xsl:variable name="SORT" select="/REPORT/DRUGS/@SORT"/>
"KRN",.84,7981012.001,2,244,0)
    <xsl:variable name="SORTORD">
"KRN",.84,7981012.001,2,245,0)
     <xsl:choose>
"KRN",.84,7981012.001,2,246,0)
      <xsl:when test="/REPORT/DRUGS/@SORTDESC">descending</xsl:when>
"KRN",.84,7981012.001,2,247,0)
      <xsl:otherwise>ascending</xsl:otherwise>
"KRN",.84,7981012.001,2,248,0)
     </xsl:choose>
"KRN",.84,7981012.001,2,249,0)
    </xsl:variable>
"KRN",.84,7981012.001,2,250,0)
    <div>
"KRN",.84,7981012.001,2,251,0)
     <xsl:call-template name="MakeScrollable">
"KRN",.84,7981012.001,2,252,0)
      <xsl:with-param name="condition" select="DRUG[31]"/>
"KRN",.84,7981012.001,2,253,0)
     </xsl:call-template>
"KRN",.84,7981012.001,2,254,0)
     <table class="dataGrid" cellpadding="5" cellspacing="0">
"KRN",.84,7981012.001,2,255,0)
      <thead>
"KRN",.84,7981012.001,2,256,0)
       <tr>
"KRN",.84,7981012.001,2,257,0)
        <xsl:call-template name="BasicPatientHeader">
"KRN",.84,7981012.001,2,258,0)
         <xsl:with-param name="tblname" select="'DRUGS'"/>
"KRN",.84,7981012.001,2,259,0)
         <xsl:with-param name="ageyes"  select="$AGE_YES"/>
"KRN",.84,7981012.001,2,260,0)
         <xsl:with-param name="dobyes"  select="$DOB_YES"/>
"KRN",.84,7981012.001,2,261,0)
         <xsl:with-param name="icnyes"  select="$ICN_YES"/>
"KRN",.84,7981012.001,2,262,0)
         <xsl:with-param name="pactyes" select="$PACT_YES"/>
"KRN",.84,7981012.001,2,263,0)
         <xsl:with-param name="pcpyes"  select="$PCP_YES"/>
"KRN",.84,7981012.001,2,264,0)
        </xsl:call-template>
"KRN",.84,7981012.001,2,265,0)
        <xsl:call-template name="ColumnHeader">
"KRN",.84,7981012.001,2,266,0)
         <xsl:with-param name="colname" select="'RXNAME'"/>
"KRN",.84,7981012.001,2,267,0)
         <xsl:with-param name="sort" select="'DRUGS=RXNAME'"/>
"KRN",.84,7981012.001,2,268,0)
         <xsl:with-param name="title" select="'Medication Name'"/>
"KRN",.84,7981012.001,2,269,0)
        </xsl:call-template>
"KRN",.84,7981012.001,2,270,0)
       </tr>
"KRN",.84,7981012.001,2,271,0)
      </thead>
"KRN",.84,7981012.001,2,272,0)
      <xsl:call-template name="DataGridFooter">
"KRN",.84,7981012.001,2,273,0)
       <xsl:with-param name="colspan" select="15"/>    <!-- Make bigger 
"KRN",.84,7981012.001,2,274,0)
than number of columns -->
"KRN",.84,7981012.001,2,275,0)
      </xsl:call-template>
"KRN",.84,7981012.001,2,276,0)
      <tbody>
"KRN",.84,7981012.001,2,277,0)
       <xsl:choose>
"KRN",.84,7981012.001,2,278,0)
        <xsl:when test="$PTSDRUGS">
"KRN",.84,7981012.001,2,279,0)
         <xsl:for-each 
"KRN",.84,7981012.001,2,280,0)
select="DRUG[generate-id(.)=generate-id(key('patient-drug',@ID))]">
"KRN",.84,7981012.001,2,281,0)
          <xsl:call-template name="PatientDrugData">
"KRN",.84,7981012.001,2,282,0)
           <xsl:with-param name="group" select="key('patient-drug',@ID)"/>
"KRN",.84,7981012.001,2,283,0)
          </xsl:call-template>
"KRN",.84,7981012.001,2,284,0)
         </xsl:for-each>
"KRN",.84,7981012.001,2,285,0)
        </xsl:when>
"KRN",.84,7981012.001,2,286,0)
        <xsl:otherwise> 
"KRN",.84,7981012.001,2,287,0)
         <xsl:for-each select="DRUG">
"KRN",.84,7981012.001,2,288,0)
          <!--
"KRN",.84,7981012.001,2,289,0)
          <xsl:sort select="concat(*[name()=$SORT],' ')" 
"KRN",.84,7981012.001,2,290,0)
order="{$SORTORD}"/>
"KRN",.84,7981012.001,2,291,0)
          <xsl:sort select="NAME"/>
"KRN",.84,7981012.001,2,292,0)
          -->
"KRN",.84,7981012.001,2,293,0)
          <xsl:sort select="concat(*[name()=$SORT],'&#10;',NAME)" 
"KRN",.84,7981012.001,2,294,0)
order="{$SORTORD}"/>
"KRN",.84,7981012.001,2,295,0)
          <tr>
"KRN",.84,7981012.001,2,296,0)
            <xsl:call-template name="BasicPatientData">
"KRN",.84,7981012.001,2,297,0)
             <xsl:with-param name="ageyes"  select="$AGE_YES"/>
"KRN",.84,7981012.001,2,298,0)
             <xsl:with-param name="dobyes"  select="$DOB_YES"/>
"KRN",.84,7981012.001,2,299,0)
             <xsl:with-param name="icnyes"  select="$ICN_YES"/>
"KRN",.84,7981012.001,2,300,0)
             <xsl:with-param name="pactyes" select="$PACT_YES"/>
"KRN",.84,7981012.001,2,301,0)
             <xsl:with-param name="pcpyes"  select="$PCP_YES"/>
"KRN",.84,7981012.001,2,302,0)
            </xsl:call-template>
"KRN",.84,7981012.001,2,303,0)
           <xsl:call-template name="DrugData"/>
"KRN",.84,7981012.001,2,304,0)
          </tr>
"KRN",.84,7981012.001,2,305,0)
         </xsl:for-each>
"KRN",.84,7981012.001,2,306,0)
        </xsl:otherwise>
"KRN",.84,7981012.001,2,307,0)
       </xsl:choose>
"KRN",.84,7981012.001,2,308,0)
      </tbody>
"KRN",.84,7981012.001,2,309,0)
     </table>
"KRN",.84,7981012.001,2,310,0)
    </div>
"KRN",.84,7981012.001,2,311,0)
   </xsl:when>
"KRN",.84,7981012.001,2,312,0)
   <xsl:otherwise>
"KRN",.84,7981012.001,2,313,0)
    <xsl:call-template name="TableNoData"/>
"KRN",.84,7981012.001,2,314,0)
   </xsl:otherwise>
"KRN",.84,7981012.001,2,315,0)
  </xsl:choose>
"KRN",.84,7981012.001,2,316,0)
</div>
"KRN",.84,7981012.001,2,317,0)
</xsl:template>
"KRN",.84,7981012.001,2,318,0)
 
"KRN",.84,7981012.001,2,319,0)
<xsl:template match="REPORT/LABTESTS">
"KRN",.84,7981012.001,2,320,0)
<div style="page-break-before:always">
"KRN",.84,7981012.001,2,321,0)
  <h2>Lab Results</h2>
"KRN",.84,7981012.001,2,322,0)
  <xsl:choose>
"KRN",.84,7981012.001,2,323,0)
   <xsl:when test="$L1">
"KRN",.84,7981012.001,2,324,0)
    <xsl:variable name="SORT" select="/REPORT/LABTESTS/@SORT"/>
"KRN",.84,7981012.001,2,325,0)
    <xsl:variable name="SORTORD">
"KRN",.84,7981012.001,2,326,0)
     <xsl:choose>
"KRN",.84,7981012.001,2,327,0)
      <xsl:when test="/REPORT/LABTESTS/@SORTDESC">descending</xsl:when>
"KRN",.84,7981012.001,2,328,0)
      <xsl:otherwise>ascending</xsl:otherwise>
"KRN",.84,7981012.001,2,329,0)
     </xsl:choose>
"KRN",.84,7981012.001,2,330,0)
    </xsl:variable>
"KRN",.84,7981012.001,2,331,0)
    <div>
"KRN",.84,7981012.001,2,332,0)
    <xsl:call-template name="MakeScrollable">
"KRN",.84,7981012.001,2,333,0)
     <xsl:with-param name="condition" select="LT[31]"/>
"KRN",.84,7981012.001,2,334,0)
    </xsl:call-template>
"KRN",.84,7981012.001,2,335,0)
     <table class="dataGrid" cellpadding="5" cellspacing="0">
"KRN",.84,7981012.001,2,336,0)
      <thead>
"KRN",.84,7981012.001,2,337,0)
       <tr>
"KRN",.84,7981012.001,2,338,0)
        <xsl:call-template name="BasicPatientHeader">
"KRN",.84,7981012.001,2,339,0)
         <xsl:with-param name="tblname" select="'LABTESTS'"/>
"KRN",.84,7981012.001,2,340,0)
         <xsl:with-param name="ageyes"  select="$AGE_YES"/>
"KRN",.84,7981012.001,2,341,0)
         <xsl:with-param name="dobyes"  select="$DOB_YES"/>
"KRN",.84,7981012.001,2,342,0)
         <xsl:with-param name="icnyes"  select="$ICN_YES"/>
"KRN",.84,7981012.001,2,343,0)
         <xsl:with-param name="pactyes" select="$PACT_YES"/>
"KRN",.84,7981012.001,2,344,0)
         <xsl:with-param name="pcpyes"  select="$PCP_YES"/>
"KRN",.84,7981012.001,2,345,0)
        </xsl:call-template>
"KRN",.84,7981012.001,2,346,0)
        <xsl:call-template name="BasicLRHeader">
"KRN",.84,7981012.001,2,347,0)
         <xsl:with-param name="colname" select="'LTNAME'"/>
"KRN",.84,7981012.001,2,348,0)
         <xsl:with-param name="tblname" select="'LABTESTS'"/>
"KRN",.84,7981012.001,2,349,0)
        </xsl:call-template>
"KRN",.84,7981012.001,2,350,0)
       </tr>
"KRN",.84,7981012.001,2,351,0)
      </thead>
"KRN",.84,7981012.001,2,352,0)
      <xsl:call-template name="DataGridFooter">
"KRN",.84,7981012.001,2,353,0)
       <xsl:with-param name="colspan" select="15"/>    <!-- Make bigger 
"KRN",.84,7981012.001,2,354,0)
than number of columns -->
"KRN",.84,7981012.001,2,355,0)
      </xsl:call-template>
"KRN",.84,7981012.001,2,356,0)
      <tbody>
"KRN",.84,7981012.001,2,357,0)
       <xsl:choose>
"KRN",.84,7981012.001,2,358,0)
        <xsl:when test="$PTSLABS">
"KRN",.84,7981012.001,2,359,0)
         <xsl:for-each 
"KRN",.84,7981012.001,2,360,0)
select="LT[generate-id(.)=generate-id(key('patient-lt',@ID))]">
"KRN",.84,7981012.001,2,361,0)
          <xsl:call-template name="PatientLabData">
"KRN",.84,7981012.001,2,362,0)
           <xsl:with-param name="group" select="key('patient-lt',@ID)"/>
"KRN",.84,7981012.001,2,363,0)
          </xsl:call-template>
"KRN",.84,7981012.001,2,364,0)
         </xsl:for-each>
"KRN",.84,7981012.001,2,365,0)
        </xsl:when>
"KRN",.84,7981012.001,2,366,0)
        <xsl:otherwise>
"KRN",.84,7981012.001,2,367,0)
         <xsl:for-each select="LT">
"KRN",.84,7981012.001,2,368,0)
          <!--
"KRN",.84,7981012.001,2,369,0)
          <xsl:sort select="concat(*[name()=$SORT],' ')" 
"KRN",.84,7981012.001,2,370,0)
order="{$SORTORD}"/>
"KRN",.84,7981012.001,2,371,0)
          <xsl:sort select="NAME"/>
"KRN",.84,7981012.001,2,372,0)
          -->
"KRN",.84,7981012.001,2,373,0)
          <xsl:sort select="concat(./*[name()=$SORT],'&#10;',NAME)" 
"KRN",.84,7981012.001,2,374,0)
order="{$SORTORD}"/>
"KRN",.84,7981012.001,2,375,0)
          <tr>
"KRN",.84,7981012.001,2,376,0)
           <xsl:call-template name="BasicPatientData">
"KRN",.84,7981012.001,2,377,0)
            <xsl:with-param name="ageyes"  select="$AGE_YES"/>
"KRN",.84,7981012.001,2,378,0)
            <xsl:with-param name="dobyes"  select="$DOB_YES"/>
"KRN",.84,7981012.001,2,379,0)
            <xsl:with-param name="icnyes"  select="$ICN_YES"/>
"KRN",.84,7981012.001,2,380,0)
            <xsl:with-param name="pactyes" select="$PACT_YES"/>
"KRN",.84,7981012.001,2,381,0)
            <xsl:with-param name="pcpyes"  select="$PCP_YES"/>
"KRN",.84,7981012.001,2,382,0)
           </xsl:call-template>
"KRN",.84,7981012.001,2,383,0)
           <xsl:call-template name="BasicLRData">
"KRN",.84,7981012.001,2,384,0)
            <xsl:with-param name="name" select="LTNAME"/>
"KRN",.84,7981012.001,2,385,0)
           </xsl:call-template>
"KRN",.84,7981012.001,2,386,0)
          </tr>
"KRN",.84,7981012.001,2,387,0)
         </xsl:for-each>
"KRN",.84,7981012.001,2,388,0)
        </xsl:otherwise>
"KRN",.84,7981012.001,2,389,0)
       </xsl:choose>
"KRN",.84,7981012.001,2,390,0)
      </tbody>
"KRN",.84,7981012.001,2,391,0)
     </table>
"KRN",.84,7981012.001,2,392,0)
    </div>
"KRN",.84,7981012.001,2,393,0)
   </xsl:when>
"KRN",.84,7981012.001,2,394,0)
   <xsl:otherwise>
"KRN",.84,7981012.001,2,395,0)
    <xsl:call-template name="TableNoData"/>
"KRN",.84,7981012.001,2,396,0)
   </xsl:otherwise>
"KRN",.84,7981012.001,2,397,0)
  </xsl:choose>
"KRN",.84,7981012.001,2,398,0)
</div>
"KRN",.84,7981012.001,2,399,0)
</xsl:template>
"KRN",.84,7981012.001,2,400,0)
 
"KRN",.84,7981012.001,2,401,0)
<xsl:template match="REPORT/PATIENTS">
"KRN",.84,7981012.001,2,402,0)
<div style="page-break-before:always">
"KRN",.84,7981012.001,2,403,0)
  <h2>Patients</h2>
"KRN",.84,7981012.001,2,404,0)
  <xsl:call-template name="DataGrid"/>
"KRN",.84,7981012.001,2,405,0)
</div>
"KRN",.84,7981012.001,2,406,0)
</xsl:template>
"KRN",.84,7981012.001,2,407,0)
 
"KRN",.84,7981012.001,2,408,0)
<!--[ UTILITIES ]-->
"KRN",.84,7981012.001,2,409,0)
 
"KRN",.84,7981012.001,2,410,0)
<xsl:template name="DrugData">
"KRN",.84,7981012.001,2,411,0)
<xsl:param name="rowspan" select="'1'"/>
"KRN",.84,7981012.001,2,412,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981012.001,2,413,0)
  <xsl:with-param name="value" select="RXNAME"/>
"KRN",.84,7981012.001,2,414,0)
  <xsl:with-param name="class" select="'aLeft'"/>
"KRN",.84,7981012.001,2,415,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981012.001,2,416,0)
</xsl:call-template>
"KRN",.84,7981012.001,2,417,0)
</xsl:template>
"KRN",.84,7981012.001,2,418,0)
 
"KRN",.84,7981012.001,2,419,0)
<xsl:template name="PatientDrugData">
"KRN",.84,7981012.001,2,420,0)
<xsl:param name="group"/>
"KRN",.84,7981012.001,2,421,0)
<xsl:param name="number" select="position()"/>
"KRN",.84,7981012.001,2,422,0)
<xsl:variable name="rowspan" select="count($group)"/>
"KRN",.84,7981012.001,2,423,0)
<xsl:for-each select="$group">
"KRN",.84,7981012.001,2,424,0)
  <tr>
"KRN",.84,7981012.001,2,425,0)
   <xsl:if test="position()=1">
"KRN",.84,7981012.001,2,426,0)
    <xsl:call-template name="BasicPatientData">
"KRN",.84,7981012.001,2,427,0)
     <xsl:with-param name="number"  select="$number"/>
"KRN",.84,7981012.001,2,428,0)
     <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981012.001,2,429,0)
     <xsl:with-param name="ageyes"  select="$AGE_YES"/>
"KRN",.84,7981012.001,2,430,0)
     <xsl:with-param name="dobyes"  select="$DOB_YES"/>
"KRN",.84,7981012.001,2,431,0)
     <xsl:with-param name="icnyes"  select="$ICN_YES"/>
"KRN",.84,7981012.001,2,432,0)
     <xsl:with-param name="pactyes" select="$PACT_YES"/>
"KRN",.84,7981012.001,2,433,0)
     <xsl:with-param name="pcpyes"  select="$PCP_YES"/>
"KRN",.84,7981012.001,2,434,0)
    </xsl:call-template>
"KRN",.84,7981012.001,2,435,0)
   </xsl:if>
"KRN",.84,7981012.001,2,436,0)
   <xsl:call-template name="DrugData"/>
"KRN",.84,7981012.001,2,437,0)
  </tr>
"KRN",.84,7981012.001,2,438,0)
</xsl:for-each>
"KRN",.84,7981012.001,2,439,0)
</xsl:template>
"KRN",.84,7981012.001,2,440,0)
 
"KRN",.84,7981012.001,2,441,0)
<xsl:template name="PatientLabData">
"KRN",.84,7981012.001,2,442,0)
<xsl:param name="group"/>
"KRN",.84,7981012.001,2,443,0)
<xsl:param name="number" select="position()"/>
"KRN",.84,7981012.001,2,444,0)
<xsl:variable name="rowspan" select="count($group)"/>
"KRN",.84,7981012.001,2,445,0)
<xsl:for-each select="$group">
"KRN",.84,7981012.001,2,446,0)
  <tr>
"KRN",.84,7981012.001,2,447,0)
   <xsl:if test="position()=1">
"KRN",.84,7981012.001,2,448,0)
    <xsl:call-template name="BasicPatientData">
"KRN",.84,7981012.001,2,449,0)
     <xsl:with-param name="number"  select="$number"/>
"KRN",.84,7981012.001,2,450,0)
     <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981012.001,2,451,0)
     <xsl:with-param name="ageyes"  select="$AGE_YES"/>
"KRN",.84,7981012.001,2,452,0)
     <xsl:with-param name="dobyes"  select="$DOB_YES"/>
"KRN",.84,7981012.001,2,453,0)
     <xsl:with-param name="icnyes"  select="$ICN_YES"/>
"KRN",.84,7981012.001,2,454,0)
     <xsl:with-param name="pactyes" select="$PACT_YES"/>
"KRN",.84,7981012.001,2,455,0)
     <xsl:with-param name="pcpyes"  select="$PCP_YES"/>
"KRN",.84,7981012.001,2,456,0)
    </xsl:call-template>
"KRN",.84,7981012.001,2,457,0)
   </xsl:if>
"KRN",.84,7981012.001,2,458,0)
   <xsl:call-template name="BasicLRData">
"KRN",.84,7981012.001,2,459,0)
    <xsl:with-param name="name" select="LTNAME"/>
"KRN",.84,7981012.001,2,460,0)
  </xsl:call-template>
"KRN",.84,7981012.001,2,461,0)
  </tr>
"KRN",.84,7981012.001,2,462,0)
</xsl:for-each>
"KRN",.84,7981012.001,2,463,0)
</xsl:template>
"KRN",.84,7981012.001,2,464,0)
 
"KRN",.84,7981012.001,2,465,0)
<!--[ REPORT PARAMETERS ]-->
"KRN",.84,7981012.001,2,466,0)
 
"KRN",.84,7981012.001,2,467,0)
<xsl:template match="PARAMETERS/DATE_RANGE">
"KRN",.84,7981012.001,2,468,0)
<xsl:call-template name="DateRange">
"KRN",.84,7981012.001,2,469,0)
  <xsl:with-param name="title" select="'Meds'"/>
"KRN",.84,7981012.001,2,470,0)
</xsl:call-template>
"KRN",.84,7981012.001,2,471,0)
</xsl:template>
"KRN",.84,7981012.001,2,472,0)
 
"KRN",.84,7981012.001,2,473,0)
<xsl:template match="PARAMETERS/DATE_RANGE_2">
"KRN",.84,7981012.001,2,474,0)
<xsl:call-template name="DateRange">
"KRN",.84,7981012.001,2,475,0)
  <xsl:with-param name="title" select="'Labs'"/>
"KRN",.84,7981012.001,2,476,0)
</xsl:call-template>
"KRN",.84,7981012.001,2,477,0)
</xsl:template>
"KRN",.84,7981012.001,2,478,0)
 
"KRN",.84,7981012.001,2,479,0)
<xsl:template match="PARAMETERS/DATE_RANGE_3">
"KRN",.84,7981012.001,2,480,0)
<xsl:call-template name="DateRange">
"KRN",.84,7981012.001,2,481,0)
  <xsl:with-param name="title" select="'Utilization'"/>
"KRN",.84,7981012.001,2,482,0)
</xsl:call-template>
"KRN",.84,7981012.001,2,483,0)
</xsl:template>
"KRN",.84,7981012.001,2,484,0)
 
"KRN",.84,7981012.001,2,485,0)
</xsl:stylesheet>
"KRN",.84,7981012.002,-1)
0^20
"KRN",.84,7981012.002,0)
7981012.002^2^^CLINICAL CASE REGISTRIES^Combined Meds and Labs Report (CSV)
"KRN",.84,7981012.002,2,0)
^^216^216^3170802^
"KRN",.84,7981012.002,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981012.002,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981012.002,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981012.002,2,4,0)
 
"KRN",.84,7981012.002,2,5,0)
<xsl:import  href="template://report/999/2"/>  <!-- Common   -->
"KRN",.84,7981012.002,2,6,0)
<xsl:include href="template://report/997/2"/>  <!-- Patients -->
"KRN",.84,7981012.002,2,7,0)
 
"KRN",.84,7981012.002,2,8,0)
<xsl:template match="/">
"KRN",.84,7981012.002,2,9,0)
<xsl:apply-templates select="REPORT/DRUGS"/>
"KRN",.84,7981012.002,2,10,0)
<xsl:apply-templates select="REPORT/LABTESTS"/>
"KRN",.84,7981012.002,2,11,0)
<xsl:apply-templates select="REPORT/PATIENTS"/>
"KRN",.84,7981012.002,2,12,0)
</xsl:template>
"KRN",.84,7981012.002,2,13,0)
 
"KRN",.84,7981012.002,2,14,0)
<xsl:template match="REPORT/DRUGS">
"KRN",.84,7981012.002,2,15,0)
<xsl:text>Combined Meds and Labs Report (Medications)</xsl:text>
"KRN",.84,7981012.002,2,16,0)
<xsl:value-of select="$CRLF"/>
"KRN",.84,7981012.002,2,17,0)
<xsl:text>Patient Name,SSN,</xsl:text>
"KRN",.84,7981012.002,2,18,0)
<xsl:if test="$AGE_YES">
"KRN",.84,7981012.002,2,19,0)
   <xsl:text>Age,</xsl:text>
"KRN",.84,7981012.002,2,20,0)
</xsl:if>
"KRN",.84,7981012.002,2,21,0)
<xsl:if test="$DOB_YES">
"KRN",.84,7981012.002,2,22,0)
   <xsl:text>Date of Birth,</xsl:text>
"KRN",.84,7981012.002,2,23,0)
</xsl:if>
"KRN",.84,7981012.002,2,24,0)
<xsl:text>Date of Death,Medication Name</xsl:text>
"KRN",.84,7981012.002,2,25,0)
<xsl:if test="$ICN_YES">
"KRN",.84,7981012.002,2,26,0)
   <xsl:text>,ICN</xsl:text>
"KRN",.84,7981012.002,2,27,0)
</xsl:if>
"KRN",.84,7981012.002,2,28,0)
<xsl:if test="$PACT_YES">
"KRN",.84,7981012.002,2,29,0)
   <xsl:text>,PACT</xsl:text>
"KRN",.84,7981012.002,2,30,0)
</xsl:if>
"KRN",.84,7981012.002,2,31,0)
<xsl:if test="$PCP_YES">
"KRN",.84,7981012.002,2,32,0)
   <xsl:text>,PCP</xsl:text>
"KRN",.84,7981012.002,2,33,0)
</xsl:if>
"KRN",.84,7981012.002,2,34,0)
<xsl:value-of select="$CRLF"/>
"KRN",.84,7981012.002,2,35,0)
<xsl:for-each select="DRUG">
"KRN",.84,7981012.002,2,36,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981012.002,2,37,0)
   <xsl:with-param name="value" select="NAME"/>
"KRN",.84,7981012.002,2,38,0)
  </xsl:call-template>
"KRN",.84,7981012.002,2,39,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981012.002,2,40,0)
   <xsl:with-param name="value" select="LAST4"/>
"KRN",.84,7981012.002,2,41,0)
  </xsl:call-template>
"KRN",.84,7981012.002,2,42,0)
  <xsl:if test="$AGE_YES">
"KRN",.84,7981012.002,2,43,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981012.002,2,44,0)
    <xsl:with-param name="value" select="AGE"/>
"KRN",.84,7981012.002,2,45,0)
   </xsl:call-template>
"KRN",.84,7981012.002,2,46,0)
  </xsl:if>
"KRN",.84,7981012.002,2,47,0)
  <xsl:if test="$DOB_YES">
"KRN",.84,7981012.002,2,48,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981012.002,2,49,0)
    <xsl:with-param name="value" select="DOB"/>
"KRN",.84,7981012.002,2,50,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981012.002,2,51,0)
   </xsl:call-template>
"KRN",.84,7981012.002,2,52,0)
  </xsl:if>
"KRN",.84,7981012.002,2,53,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981012.002,2,54,0)
   <xsl:with-param name="value" select="DOD"/>
"KRN",.84,7981012.002,2,55,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981012.002,2,56,0)
  </xsl:call-template>
"KRN",.84,7981012.002,2,57,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981012.002,2,58,0)
  <xsl:with-param name="value" select="RXNAME"/>
"KRN",.84,7981012.002,2,59,0)
  </xsl:call-template>
"KRN",.84,7981012.002,2,60,0)
  <xsl:if test="$ICN_YES">
"KRN",.84,7981012.002,2,61,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981012.002,2,62,0)
    <xsl:with-param name="value" select="ICN"/>
"KRN",.84,7981012.002,2,63,0)
   </xsl:call-template>
"KRN",.84,7981012.002,2,64,0)
  </xsl:if>
"KRN",.84,7981012.002,2,65,0)
  <xsl:if test="$PACT_YES">
"KRN",.84,7981012.002,2,66,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981012.002,2,67,0)
    <xsl:with-param name="value" select="PACT"/>
"KRN",.84,7981012.002,2,68,0)
   </xsl:call-template>
"KRN",.84,7981012.002,2,69,0)
  </xsl:if>
"KRN",.84,7981012.002,2,70,0)
  <xsl:if test="$PCP_YES">
"KRN",.84,7981012.002,2,71,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981012.002,2,72,0)
    <xsl:with-param name="value" select="PCP"/>
"KRN",.84,7981012.002,2,73,0)
   </xsl:call-template>
"KRN",.84,7981012.002,2,74,0)
  </xsl:if>
"KRN",.84,7981012.002,2,75,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981012.002,2,76,0)
</xsl:for-each>
"KRN",.84,7981012.002,2,77,0)
<!-- xsl:value-of select="$FILESWITCH"/ -->
"KRN",.84,7981012.002,2,78,0)
</xsl:template>
"KRN",.84,7981012.002,2,79,0)
 
"KRN",.84,7981012.002,2,80,0)
<xsl:template match="REPORT/LABTESTS">
"KRN",.84,7981012.002,2,81,0)
<xsl:text>Combined Meds and Labs Report (Lab Results)</xsl:text>
"KRN",.84,7981012.002,2,82,0)
<xsl:value-of select="$CRLF"/>
"KRN",.84,7981012.002,2,83,0)
<xsl:text>Patient Name,SSN,</xsl:text>
"KRN",.84,7981012.002,2,84,0)
<xsl:if test="$AGE_YES">
"KRN",.84,7981012.002,2,85,0)
   <xsl:text>Age,</xsl:text>
"KRN",.84,7981012.002,2,86,0)
</xsl:if>
"KRN",.84,7981012.002,2,87,0)
<xsl:if test="$DOB_YES">
"KRN",.84,7981012.002,2,88,0)
   <xsl:text>Date of Birth,</xsl:text>
"KRN",.84,7981012.002,2,89,0)
</xsl:if>
"KRN",.84,7981012.002,2,90,0)
<xsl:text>Date of Death,Date,Test Name,Result</xsl:text>
"KRN",.84,7981012.002,2,91,0)
<xsl:if test="$ICN_YES">
"KRN",.84,7981012.002,2,92,0)
   <xsl:text>,ICN</xsl:text>
"KRN",.84,7981012.002,2,93,0)
</xsl:if>
"KRN",.84,7981012.002,2,94,0)
<xsl:if test="$PACT_YES">
"KRN",.84,7981012.002,2,95,0)
   <xsl:text>,PACT</xsl:text>
"KRN",.84,7981012.002,2,96,0)
</xsl:if>
"KRN",.84,7981012.002,2,97,0)
<xsl:if test="$PCP_YES">
"KRN",.84,7981012.002,2,98,0)
   <xsl:text>,PCP</xsl:text>
"KRN",.84,7981012.002,2,99,0)
</xsl:if>
"KRN",.84,7981012.002,2,100,0)
<xsl:value-of select="$CRLF"/>
"KRN",.84,7981012.002,2,101,0)
<xsl:for-each select="LT">
"KRN",.84,7981012.002,2,102,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981012.002,2,103,0)
   <xsl:with-param name="value" select="NAME"/>
"KRN",.84,7981012.002,2,104,0)
  </xsl:call-template>
"KRN",.84,7981012.002,2,105,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981012.002,2,106,0)
   <xsl:with-param name="value" select="LAST4"/>
"KRN",.84,7981012.002,2,107,0)
  </xsl:call-template>
"KRN",.84,7981012.002,2,108,0)
  <xsl:if test="$AGE_YES">
"KRN",.84,7981012.002,2,109,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981012.002,2,110,0)
    <xsl:with-param name="value" select="AGE"/>
"KRN",.84,7981012.002,2,111,0)
   </xsl:call-template>
"KRN",.84,7981012.002,2,112,0)
  </xsl:if>
"KRN",.84,7981012.002,2,113,0)
  <xsl:if test="$DOB_YES">
"KRN",.84,7981012.002,2,114,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981012.002,2,115,0)
    <xsl:with-param name="value" select="DOB"/>
"KRN",.84,7981012.002,2,116,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981012.002,2,117,0)
   </xsl:call-template>
"KRN",.84,7981012.002,2,118,0)
  </xsl:if>
"KRN",.84,7981012.002,2,119,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981012.002,2,120,0)
   <xsl:with-param name="value" select="DOD"/>
"KRN",.84,7981012.002,2,121,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981012.002,2,122,0)
  </xsl:call-template>
"KRN",.84,7981012.002,2,123,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981012.002,2,124,0)
   <xsl:with-param name="value" select="DATE"/>
"KRN",.84,7981012.002,2,125,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981012.002,2,126,0)
  </xsl:call-template>
"KRN",.84,7981012.002,2,127,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981012.002,2,128,0)
   <xsl:with-param name="value" select="LTNAME"/>
"KRN",.84,7981012.002,2,129,0)
  </xsl:call-template>
"KRN",.84,7981012.002,2,130,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981012.002,2,131,0)
   <xsl:with-param name="value" select="RESULT"/>
"KRN",.84,7981012.002,2,132,0)
  </xsl:call-template>
"KRN",.84,7981012.002,2,133,0)
  <xsl:if test="$ICN_YES">
"KRN",.84,7981012.002,2,134,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981012.002,2,135,0)
    <xsl:with-param name="value" select="ICN"/>
"KRN",.84,7981012.002,2,136,0)
   </xsl:call-template>
"KRN",.84,7981012.002,2,137,0)
  </xsl:if>
"KRN",.84,7981012.002,2,138,0)
  <xsl:if test="$PACT_YES">
"KRN",.84,7981012.002,2,139,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981012.002,2,140,0)
    <xsl:with-param name="value" select="PACT"/>
"KRN",.84,7981012.002,2,141,0)
   </xsl:call-template>
"KRN",.84,7981012.002,2,142,0)
  </xsl:if>
"KRN",.84,7981012.002,2,143,0)
  <xsl:if test="$PCP_YES">
"KRN",.84,7981012.002,2,144,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981012.002,2,145,0)
    <xsl:with-param name="value" select="PCP"/>
"KRN",.84,7981012.002,2,146,0)
   </xsl:call-template>
"KRN",.84,7981012.002,2,147,0)
  </xsl:if>
"KRN",.84,7981012.002,2,148,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981012.002,2,149,0)
</xsl:for-each>
"KRN",.84,7981012.002,2,150,0)
<!-- xsl:value-of select="$FILESWITCH"/ -->
"KRN",.84,7981012.002,2,151,0)
</xsl:template>
"KRN",.84,7981012.002,2,152,0)
 
"KRN",.84,7981012.002,2,153,0)
<xsl:template match="REPORT/PATIENTS">
"KRN",.84,7981012.002,2,154,0)
<xsl:text>Combined Meds and Labs Report (Patients)</xsl:text>
"KRN",.84,7981012.002,2,155,0)
<xsl:value-of select="$CRLF"/>
"KRN",.84,7981012.002,2,156,0)
<xsl:text>Patient Name,SSN,</xsl:text>
"KRN",.84,7981012.002,2,157,0)
<xsl:if test="$AGE_YES">
"KRN",.84,7981012.002,2,158,0)
   <xsl:text>Age,</xsl:text>
"KRN",.84,7981012.002,2,159,0)
</xsl:if>
"KRN",.84,7981012.002,2,160,0)
<xsl:if test="$DOB_YES">
"KRN",.84,7981012.002,2,161,0)
   <xsl:text>Date of Birth,</xsl:text>
"KRN",.84,7981012.002,2,162,0)
</xsl:if>
"KRN",.84,7981012.002,2,163,0)
<xsl:text>Date of Death</xsl:text>
"KRN",.84,7981012.002,2,164,0)
<xsl:if test="$ICN_YES">
"KRN",.84,7981012.002,2,165,0)
   <xsl:text>,ICN</xsl:text>
"KRN",.84,7981012.002,2,166,0)
</xsl:if>
"KRN",.84,7981012.002,2,167,0)
<xsl:if test="$PACT_YES">
"KRN",.84,7981012.002,2,168,0)
   <xsl:text>,PACT</xsl:text>
"KRN",.84,7981012.002,2,169,0)
</xsl:if>
"KRN",.84,7981012.002,2,170,0)
<xsl:if test="$PCP_YES">
"KRN",.84,7981012.002,2,171,0)
   <xsl:text>,PCP</xsl:text>
"KRN",.84,7981012.002,2,172,0)
</xsl:if>
"KRN",.84,7981012.002,2,173,0)
<xsl:value-of select="$CRLF"/>
"KRN",.84,7981012.002,2,174,0)
<xsl:for-each select="PATIENT">
"KRN",.84,7981012.002,2,175,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981012.002,2,176,0)
   <xsl:with-param name="value" select="NAME"/>
"KRN",.84,7981012.002,2,177,0)
  </xsl:call-template>
"KRN",.84,7981012.002,2,178,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981012.002,2,179,0)
   <xsl:with-param name="value" select="LAST4"/>
"KRN",.84,7981012.002,2,180,0)
  </xsl:call-template>
"KRN",.84,7981012.002,2,181,0)
  <xsl:if test="$AGE_YES">
"KRN",.84,7981012.002,2,182,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981012.002,2,183,0)
    <xsl:with-param name="value" select="AGE"/>
"KRN",.84,7981012.002,2,184,0)
   </xsl:call-template>
"KRN",.84,7981012.002,2,185,0)
  </xsl:if>
"KRN",.84,7981012.002,2,186,0)
  <xsl:if test="$DOB_YES">
"KRN",.84,7981012.002,2,187,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981012.002,2,188,0)
    <xsl:with-param name="value" select="DOB"/>
"KRN",.84,7981012.002,2,189,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981012.002,2,190,0)
   </xsl:call-template>
"KRN",.84,7981012.002,2,191,0)
  </xsl:if>
"KRN",.84,7981012.002,2,192,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981012.002,2,193,0)
   <xsl:with-param name="value" select="DOD"/>
"KRN",.84,7981012.002,2,194,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981012.002,2,195,0)
  </xsl:call-template>
"KRN",.84,7981012.002,2,196,0)
  <xsl:if test="$ICN_YES">
"KRN",.84,7981012.002,2,197,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981012.002,2,198,0)
    <xsl:with-param name="value" select="ICN"/>
"KRN",.84,7981012.002,2,199,0)
   </xsl:call-template>
"KRN",.84,7981012.002,2,200,0)
  </xsl:if>
"KRN",.84,7981012.002,2,201,0)
  <xsl:if test="$PACT_YES">
"KRN",.84,7981012.002,2,202,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981012.002,2,203,0)
    <xsl:with-param name="value" select="PACT"/>
"KRN",.84,7981012.002,2,204,0)
   </xsl:call-template>
"KRN",.84,7981012.002,2,205,0)
  </xsl:if>
"KRN",.84,7981012.002,2,206,0)
  <xsl:if test="$PCP_YES">
"KRN",.84,7981012.002,2,207,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981012.002,2,208,0)
    <xsl:with-param name="value" select="PCP"/>
"KRN",.84,7981012.002,2,209,0)
   </xsl:call-template>
"KRN",.84,7981012.002,2,210,0)
  </xsl:if>
"KRN",.84,7981012.002,2,211,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981012.002,2,212,0)
</xsl:for-each>
"KRN",.84,7981012.002,2,213,0)
<!-- xsl:value-of select="$FILESWITCH"/ -->
"KRN",.84,7981012.002,2,214,0)
</xsl:template>
"KRN",.84,7981012.002,2,215,0)
 
"KRN",.84,7981012.002,2,216,0)
</xsl:stylesheet>
"KRN",.84,7981013.001,-1)
0^35
"KRN",.84,7981013.001,0)
7981013.001^2^^CLINICAL CASE REGISTRIES^Diagnoses (HTML)
"KRN",.84,7981013.001,2,0)
^^201^201^3170803^
"KRN",.84,7981013.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981013.001,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981013.001,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981013.001,2,4,0)
 
"KRN",.84,7981013.001,2,5,0)
<xsl:import  href="template://report/998/1"/>  <!-- Styles   --> 
"KRN",.84,7981013.001,2,6,0)
<xsl:import  href="template://report/999/1"/>  <!-- Common   -->
"KRN",.84,7981013.001,2,7,0)
 
"KRN",.84,7981013.001,2,8,0)
<xsl:template match="/">
"KRN",.84,7981013.001,2,9,0)
<html>
"KRN",.84,7981013.001,2,10,0)
  <head>
"KRN",.84,7981013.001,2,11,0)
   <title>Diagnoses</title>
"KRN",.84,7981013.001,2,12,0)
   <xsl:call-template name="StyleSheet"/>
"KRN",.84,7981013.001,2,13,0)
  </head>
"KRN",.84,7981013.001,2,14,0)
  <body>
"KRN",.84,7981013.001,2,15,0)
   <h1>Diagnoses</h1>
"KRN",.84,7981013.001,2,16,0)
   <xsl:call-template name="ReportHeader"/>
"KRN",.84,7981013.001,2,17,0)
   <!-- The following line added to fix page break issue in IE 7 -->
"KRN",.84,7981013.001,2,18,0)
   <div style="page-break-after:always; font-size:1; margin:0; 
"KRN",.84,7981013.001,2,19,0)
border:0"><span style="visibility: hidden">-</span></div>
"KRN",.84,7981013.001,2,20,0)
   <div>
"KRN",.84,7981013.001,2,21,0)
    <xsl:call-template name="ReportSummary"/>
"KRN",.84,7981013.001,2,22,0)
    <xsl:apply-templates select="/REPORT/ICDLST"/>
"KRN",.84,7981013.001,2,23,0)
   </div>
"KRN",.84,7981013.001,2,24,0)
   <xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981013.001,2,25,0)
  </body>
"KRN",.84,7981013.001,2,26,0)
</html>
"KRN",.84,7981013.001,2,27,0)
</xsl:template>
"KRN",.84,7981013.001,2,28,0)
 
"KRN",.84,7981013.001,2,29,0)
<xsl:template match="REPORT/ICDLST">
"KRN",.84,7981013.001,2,30,0)
<h2>ICD Codes</h2>
"KRN",.84,7981013.001,2,31,0)
<xsl:call-template name="DataGrid"/>
"KRN",.84,7981013.001,2,32,0)
</xsl:template>
"KRN",.84,7981013.001,2,33,0)
 
"KRN",.84,7981013.001,2,34,0)
<xsl:template match="REPORT/PATIENTS">
"KRN",.84,7981013.001,2,35,0)
<div style="page-break-before:always">
"KRN",.84,7981013.001,2,36,0)
  <h2>Patients</h2>
"KRN",.84,7981013.001,2,37,0)
  <xsl:call-template name="DataGrid">
"KRN",.84,7981013.001,2,38,0)
   <xsl:with-param name="scroll" select="descendant::ICD[31]"/>
"KRN",.84,7981013.001,2,39,0)
  </xsl:call-template>
"KRN",.84,7981013.001,2,40,0)
</div>
"KRN",.84,7981013.001,2,41,0)
<div class="reportSummary">
"KRN",.84,7981013.001,2,42,0)
  <div style="float:left; width:30%">
"KRN",.84,7981013.001,2,43,0)
   <table cellpadding="3" cellspacing="0">
"KRN",.84,7981013.001,2,44,0)
    <caption>Source</caption>
"KRN",.84,7981013.001,2,45,0)
    <thead>
"KRN",.84,7981013.001,2,46,0)
     <tr>
"KRN",.84,7981013.001,2,47,0)
      <th width="30">Code</th>
"KRN",.84,7981013.001,2,48,0)
      <th>Description</th>
"KRN",.84,7981013.001,2,49,0)
     </tr>
"KRN",.84,7981013.001,2,50,0)
    </thead>
"KRN",.84,7981013.001,2,51,0)
    <tbody>
"KRN",.84,7981013.001,2,52,0)
     <tr>
"KRN",.84,7981013.001,2,53,0)
      <td align="center">I</td>
"KRN",.84,7981013.001,2,54,0)
      <td class="aLeft">Inpatient file</td>
"KRN",.84,7981013.001,2,55,0)
     </tr>
"KRN",.84,7981013.001,2,56,0)
     <tr>
"KRN",.84,7981013.001,2,57,0)
      <td align="center">O</td>
"KRN",.84,7981013.001,2,58,0)
      <td class="aLeft">Outpatient file</td>
"KRN",.84,7981013.001,2,59,0)
     </tr>
"KRN",.84,7981013.001,2,60,0)
     <tr>
"KRN",.84,7981013.001,2,61,0)
      <td align="center">PB</td>
"KRN",.84,7981013.001,2,62,0)
      <td class="aLeft">Problem list</td>
"KRN",.84,7981013.001,2,63,0)
     </tr>
"KRN",.84,7981013.001,2,64,0)
    </tbody>
"KRN",.84,7981013.001,2,65,0)
   </table>
"KRN",.84,7981013.001,2,66,0)
  </div>
"KRN",.84,7981013.001,2,67,0)
</div>
"KRN",.84,7981013.001,2,68,0)
</xsl:template>
"KRN",.84,7981013.001,2,69,0)
 
"KRN",.84,7981013.001,2,70,0)
<!--[ TABLE HEADERS ]-->
"KRN",.84,7981013.001,2,71,0)
 
"KRN",.84,7981013.001,2,72,0)
<xsl:template match="HEADER/TBLDEF[@NAME='PATIENTS']/@HEADER">
"KRN",.84,7981013.001,2,73,0)
<xsl:variable name="PTICDL" select="../COLUMN[@NAME='PTICDL']"/>
"KRN",.84,7981013.001,2,74,0)
<thead>
"KRN",.84,7981013.001,2,75,0)
  <tr>
"KRN",.84,7981013.001,2,76,0)
   <xsl:apply-templates select="../COLUMN[@NAME!='PTICDL']">
"KRN",.84,7981013.001,2,77,0)
    <xsl:with-param name="rowspan" select="2"/>
"KRN",.84,7981013.001,2,78,0)
   </xsl:apply-templates>
"KRN",.84,7981013.001,2,79,0)
   <xsl:call-template name="ColumnHeader">
"KRN",.84,7981013.001,2,80,0)
    <xsl:with-param name="column" select="$PTICDL"/>
"KRN",.84,7981013.001,2,81,0)
    <xsl:with-param name="title" select="'ICD'"/>                 
"KRN",.84,7981013.001,2,82,0)
    <xsl:with-param name="sort" select="''"/>
"KRN",.84,7981013.001,2,83,0)
    <xsl:with-param name="width" select="'52%'"/>
"KRN",.84,7981013.001,2,84,0)
    <xsl:with-param name="colspan" select="4"/>
"KRN",.84,7981013.001,2,85,0)
   </xsl:call-template>
"KRN",.84,7981013.001,2,86,0)
  </tr>
"KRN",.84,7981013.001,2,87,0)
  <tr>
"KRN",.84,7981013.001,2,88,0)
   <xsl:apply-templates select="$PTICDL/*"/>
"KRN",.84,7981013.001,2,89,0)
  </tr>
"KRN",.84,7981013.001,2,90,0)
</thead>
"KRN",.84,7981013.001,2,91,0)
</xsl:template>
"KRN",.84,7981013.001,2,92,0)
 
"KRN",.84,7981013.001,2,93,0)
<xsl:template match="COLUMN[@NAME='CODE']">
"KRN",.84,7981013.001,2,94,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981013.001,2,95,0)
  <xsl:with-param name="title" select="'Code'"/>
"KRN",.84,7981013.001,2,96,0)
  <xsl:with-param name="width" select="'14%'"/>
"KRN",.84,7981013.001,2,97,0)
</xsl:call-template>
"KRN",.84,7981013.001,2,98,0)
</xsl:template>
"KRN",.84,7981013.001,2,99,0)
 
"KRN",.84,7981013.001,2,100,0)
<xsl:template match="COLUMN[@NAME='DATE']">
"KRN",.84,7981013.001,2,101,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981013.001,2,102,0)
  <xsl:with-param name="title" select="'Date'"/>
"KRN",.84,7981013.001,2,103,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981013.001,2,104,0)
</xsl:call-template>
"KRN",.84,7981013.001,2,105,0)
</xsl:template>
"KRN",.84,7981013.001,2,106,0)
 
"KRN",.84,7981013.001,2,107,0)
<xsl:template match="COLUMN[@NAME='DIAG']">
"KRN",.84,7981013.001,2,108,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981013.001,2,109,0)
  <xsl:with-param name="title" select="'Diagnosis'"/>
"KRN",.84,7981013.001,2,110,0)
</xsl:call-template>
"KRN",.84,7981013.001,2,111,0)
</xsl:template>
"KRN",.84,7981013.001,2,112,0)
 
"KRN",.84,7981013.001,2,113,0)
<xsl:template match="COLUMN[@NAME='NC']">
"KRN",.84,7981013.001,2,114,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981013.001,2,115,0)
  <xsl:with-param name="title" select="'Number of Codes'"/>
"KRN",.84,7981013.001,2,116,0)
  <xsl:with-param name="width" select="'15%'"/>
"KRN",.84,7981013.001,2,117,0)
</xsl:call-template>
"KRN",.84,7981013.001,2,118,0)
</xsl:template>
"KRN",.84,7981013.001,2,119,0)
 
"KRN",.84,7981013.001,2,120,0)
<xsl:template match="COLUMN[@NAME='NP']">
"KRN",.84,7981013.001,2,121,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981013.001,2,122,0)
  <xsl:with-param name="title" select="'Number of Patients'"/>
"KRN",.84,7981013.001,2,123,0)
  <xsl:with-param name="width" select="'15%'"/>
"KRN",.84,7981013.001,2,124,0)
</xsl:call-template>
"KRN",.84,7981013.001,2,125,0)
</xsl:template>
"KRN",.84,7981013.001,2,126,0)
 
"KRN",.84,7981013.001,2,127,0)
<xsl:template match="COLUMN[@NAME='SOURCE']">
"KRN",.84,7981013.001,2,128,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981013.001,2,129,0)
  <xsl:with-param name="title" select="'Source'"/>
"KRN",.84,7981013.001,2,130,0)
</xsl:call-template>
"KRN",.84,7981013.001,2,131,0)
</xsl:template>
"KRN",.84,7981013.001,2,132,0)
 
"KRN",.84,7981013.001,2,133,0)
<!--[ TABLE CELLS ]-->
"KRN",.84,7981013.001,2,134,0)
 
"KRN",.84,7981013.001,2,135,0)
<xsl:template match="PATIENTS/PATIENT">
"KRN",.84,7981013.001,2,136,0)
<xsl:variable name="rowspan" select="count(PTICDL/ICD)"/>
"KRN",.84,7981013.001,2,137,0)
<tr>
"KRN",.84,7981013.001,2,138,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981013.001,2,139,0)
   <xsl:with-param name="value" select="position()"/>
"KRN",.84,7981013.001,2,140,0)
   <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981013.001,2,141,0)
  </xsl:call-template>
"KRN",.84,7981013.001,2,142,0)
  <xsl:apply-templates select="*[name(.)!='PTICDL']">
"KRN",.84,7981013.001,2,143,0)
   <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981013.001,2,144,0)
  </xsl:apply-templates>
"KRN",.84,7981013.001,2,145,0)
  <xsl:for-each select="PTICDL/ICD[1]">
"KRN",.84,7981013.001,2,146,0)
   <xsl:call-template name="ICDData"/>
"KRN",.84,7981013.001,2,147,0)
  </xsl:for-each>
"KRN",.84,7981013.001,2,148,0)
</tr>
"KRN",.84,7981013.001,2,149,0)
<xsl:for-each select="PTICDL/ICD[position()>1]">
"KRN",.84,7981013.001,2,150,0)
  <tr>
"KRN",.84,7981013.001,2,151,0)
   <xsl:call-template name="ICDData"/>
"KRN",.84,7981013.001,2,152,0)
  </tr>
"KRN",.84,7981013.001,2,153,0)
</xsl:for-each>
"KRN",.84,7981013.001,2,154,0)
</xsl:template>
"KRN",.84,7981013.001,2,155,0)
 
"KRN",.84,7981013.001,2,156,0)
<xsl:template match="DIAG">
"KRN",.84,7981013.001,2,157,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981013.001,2,158,0)
  <xsl:with-param name="class" select="'aLeft'"/>
"KRN",.84,7981013.001,2,159,0)
</xsl:call-template>
"KRN",.84,7981013.001,2,160,0)
</xsl:template>
"KRN",.84,7981013.001,2,161,0)
 
"KRN",.84,7981013.001,2,162,0)
<!--[ UTILITIES ]-->
"KRN",.84,7981013.001,2,163,0)
 
"KRN",.84,7981013.001,2,164,0)
<xsl:template name="ICDData">
"KRN",.84,7981013.001,2,165,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981013.001,2,166,0)
  <xsl:with-param name="value" select="CODE"/>
"KRN",.84,7981013.001,2,167,0)
</xsl:call-template>
"KRN",.84,7981013.001,2,168,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981013.001,2,169,0)
  <xsl:with-param name="value" select="DIAG"/>
"KRN",.84,7981013.001,2,170,0)
  <xsl:with-param name="class" select="'aLeft'"/>
"KRN",.84,7981013.001,2,171,0)
</xsl:call-template>
"KRN",.84,7981013.001,2,172,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981013.001,2,173,0)
  <xsl:with-param name="value" select="DATE"/>
"KRN",.84,7981013.001,2,174,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981013.001,2,175,0)
</xsl:call-template>
"KRN",.84,7981013.001,2,176,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981013.001,2,177,0)
  <xsl:with-param name="value" select="SOURCE"/>
"KRN",.84,7981013.001,2,178,0)
</xsl:call-template>
"KRN",.84,7981013.001,2,179,0)
</xsl:template>
"KRN",.84,7981013.001,2,180,0)
 
"KRN",.84,7981013.001,2,181,0)
<xsl:template name="ReportSummary">
"KRN",.84,7981013.001,2,182,0)
<xsl:param name="summary" select="/REPORT/SUMMARY"/>
"KRN",.84,7981013.001,2,183,0)
<table width="100%" cellpadding="5" cellspacing="0">
"KRN",.84,7981013.001,2,184,0)
  <thead>
"KRN",.84,7981013.001,2,185,0)
   <tr>
"KRN",.84,7981013.001,2,186,0)
    <th width="33%">Number of Patients</th>
"KRN",.84,7981013.001,2,187,0)
    <th width="33%">Number of Codes</th>
"KRN",.84,7981013.001,2,188,0)
    <th width="33%">Number of Different Codes </th>
"KRN",.84,7981013.001,2,189,0)
   </tr>
"KRN",.84,7981013.001,2,190,0)
  </thead>
"KRN",.84,7981013.001,2,191,0)
  <tbody>
"KRN",.84,7981013.001,2,192,0)
   <tr>
"KRN",.84,7981013.001,2,193,0)
    <td><xsl:value-of select="$summary/NP"/></td>
"KRN",.84,7981013.001,2,194,0)
    <td><xsl:value-of select="$summary/NC"/></td>
"KRN",.84,7981013.001,2,195,0)
    <td><xsl:value-of select="$summary/NDC"/></td>
"KRN",.84,7981013.001,2,196,0)
   </tr>
"KRN",.84,7981013.001,2,197,0)
  </tbody>
"KRN",.84,7981013.001,2,198,0)
</table>
"KRN",.84,7981013.001,2,199,0)
</xsl:template>
"KRN",.84,7981013.001,2,200,0)
 
"KRN",.84,7981013.001,2,201,0)
</xsl:stylesheet>
"KRN",.84,7981013.002,-1)
0^11
"KRN",.84,7981013.002,0)
7981013.002^2^^CLINICAL CASE REGISTRIES^Diagnoses (CSV)
"KRN",.84,7981013.002,2,0)
^^125^125^3170803^
"KRN",.84,7981013.002,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981013.002,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981013.002,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981013.002,2,4,0)
 
"KRN",.84,7981013.002,2,5,0)
<xsl:import href="template://report/999/2"/>  <!-- Common -->
"KRN",.84,7981013.002,2,6,0)
 
"KRN",.84,7981013.002,2,7,0)
<xsl:template match="/">
"KRN",.84,7981013.002,2,8,0)
<xsl:apply-templates select="/REPORT/ICDLST"/>
"KRN",.84,7981013.002,2,9,0)
<xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981013.002,2,10,0)
</xsl:template>
"KRN",.84,7981013.002,2,11,0)
 
"KRN",.84,7981013.002,2,12,0)
<xsl:template match="REPORT/ICDLST">
"KRN",.84,7981013.002,2,13,0)
<xsl:text>Diagnoses (ICD Codes)</xsl:text>
"KRN",.84,7981013.002,2,14,0)
<xsl:call-template name="DataGrid"/>
"KRN",.84,7981013.002,2,15,0)
<!-- xsl:value-of select="$FILESWITCH"/ -->
"KRN",.84,7981013.002,2,16,0)
</xsl:template>
"KRN",.84,7981013.002,2,17,0)
 
"KRN",.84,7981013.002,2,18,0)
<xsl:template match="REPORT/PATIENTS">
"KRN",.84,7981013.002,2,19,0)
<xsl:text>Diagnoses (Patients)</xsl:text>
"KRN",.84,7981013.002,2,20,0)
<xsl:call-template name="DataGrid"/>
"KRN",.84,7981013.002,2,21,0)
<!-- xsl:value-of select="$FILESWITCH"/ -->
"KRN",.84,7981013.002,2,22,0)
</xsl:template>
"KRN",.84,7981013.002,2,23,0)
 
"KRN",.84,7981013.002,2,24,0)
<xsl:template match="PATIENTS/PATIENT">
"KRN",.84,7981013.002,2,25,0)
<xsl:variable name="ptname" select="NAME"/>
"KRN",.84,7981013.002,2,26,0)
<xsl:variable name="ssn" select="LAST4"/>
"KRN",.84,7981013.002,2,27,0)
<xsl:variable name="age" select="AGE"/>
"KRN",.84,7981013.002,2,28,0)
<xsl:variable name="dob" select="DOB"/>
"KRN",.84,7981013.002,2,29,0)
<xsl:variable name="dod" select="DOD"/>
"KRN",.84,7981013.002,2,30,0)
<xsl:variable name="icn" select="ICN"/>
"KRN",.84,7981013.002,2,31,0)
<xsl:variable name="pact" select="PACT"/>
"KRN",.84,7981013.002,2,32,0)
<xsl:variable name="pcp" select="PCP"/>
"KRN",.84,7981013.002,2,33,0)
<xsl:for-each select="PTICDL/ICD">
"KRN",.84,7981013.002,2,34,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981013.002,2,35,0)
   <xsl:with-param name="value" select="$ptname"/>
"KRN",.84,7981013.002,2,36,0)
  </xsl:call-template>
"KRN",.84,7981013.002,2,37,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981013.002,2,38,0)
   <xsl:with-param name="value" select="$ssn"/>
"KRN",.84,7981013.002,2,39,0)
  </xsl:call-template>
"KRN",.84,7981013.002,2,40,0)
  <xsl:if test="$AGE_YES">
"KRN",.84,7981013.002,2,41,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981013.002,2,42,0)
    <xsl:with-param name="value" select="$age"/>
"KRN",.84,7981013.002,2,43,0)
   </xsl:call-template>
"KRN",.84,7981013.002,2,44,0)
  </xsl:if>
"KRN",.84,7981013.002,2,45,0)
  <xsl:if test="$DOB_YES">
"KRN",.84,7981013.002,2,46,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981013.002,2,47,0)
    <xsl:with-param name="value" select="$dob"/>
"KRN",.84,7981013.002,2,48,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981013.002,2,49,0)
   </xsl:call-template>
"KRN",.84,7981013.002,2,50,0)
  </xsl:if>
"KRN",.84,7981013.002,2,51,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981013.002,2,52,0)
   <xsl:with-param name="value" select="$dod"/>
"KRN",.84,7981013.002,2,53,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981013.002,2,54,0)
  </xsl:call-template>
"KRN",.84,7981013.002,2,55,0)
  <xsl:if test="$ICN_YES">
"KRN",.84,7981013.002,2,56,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981013.002,2,57,0)
    <xsl:with-param name="value" select="$icn"/>
"KRN",.84,7981013.002,2,58,0)
   </xsl:call-template>
"KRN",.84,7981013.002,2,59,0)
  </xsl:if>
"KRN",.84,7981013.002,2,60,0)
  <xsl:if test="$PACT_YES">
"KRN",.84,7981013.002,2,61,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981013.002,2,62,0)
    <xsl:with-param name="value" select="$pact"/>
"KRN",.84,7981013.002,2,63,0)
   </xsl:call-template>
"KRN",.84,7981013.002,2,64,0)
  </xsl:if>
"KRN",.84,7981013.002,2,65,0)
  <xsl:if test="$PCP_YES">
"KRN",.84,7981013.002,2,66,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981013.002,2,67,0)
    <xsl:with-param name="value" select="$pcp"/>
"KRN",.84,7981013.002,2,68,0)
   </xsl:call-template>
"KRN",.84,7981013.002,2,69,0)
  </xsl:if>
"KRN",.84,7981013.002,2,70,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981013.002,2,71,0)
   <xsl:with-param name="value" select="CODE"/>
"KRN",.84,7981013.002,2,72,0)
  </xsl:call-template>
"KRN",.84,7981013.002,2,73,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981013.002,2,74,0)
   <xsl:with-param name="value" select="DIAG"/>
"KRN",.84,7981013.002,2,75,0)
  </xsl:call-template>
"KRN",.84,7981013.002,2,76,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981013.002,2,77,0)
   <xsl:with-param name="value" select="DATE"/>
"KRN",.84,7981013.002,2,78,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981013.002,2,79,0)
  </xsl:call-template>
"KRN",.84,7981013.002,2,80,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981013.002,2,81,0)
   <xsl:with-param name="value" select="SOURCE"/>
"KRN",.84,7981013.002,2,82,0)
  </xsl:call-template>
"KRN",.84,7981013.002,2,83,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981013.002,2,84,0)
</xsl:for-each>
"KRN",.84,7981013.002,2,85,0)
</xsl:template>
"KRN",.84,7981013.002,2,86,0)
 
"KRN",.84,7981013.002,2,87,0)
<!--[ TABLE HEADERS ]-->
"KRN",.84,7981013.002,2,88,0)
 
"KRN",.84,7981013.002,2,89,0)
<xsl:template match="COLUMN[@NAME='CODE']">
"KRN",.84,7981013.002,2,90,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981013.002,2,91,0)
  <xsl:with-param name="title" select="'Code'"/>
"KRN",.84,7981013.002,2,92,0)
</xsl:call-template>
"KRN",.84,7981013.002,2,93,0)
</xsl:template>
"KRN",.84,7981013.002,2,94,0)
 
"KRN",.84,7981013.002,2,95,0)
<xsl:template match="COLUMN[@NAME='DATE']">
"KRN",.84,7981013.002,2,96,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981013.002,2,97,0)
  <xsl:with-param name="title" select="'Date'"/>
"KRN",.84,7981013.002,2,98,0)
</xsl:call-template>
"KRN",.84,7981013.002,2,99,0)
</xsl:template>
"KRN",.84,7981013.002,2,100,0)
 
"KRN",.84,7981013.002,2,101,0)
<xsl:template match="COLUMN[@NAME='DIAG']">
"KRN",.84,7981013.002,2,102,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981013.002,2,103,0)
  <xsl:with-param name="title" select="'Diagnosis'"/>
"KRN",.84,7981013.002,2,104,0)
</xsl:call-template>
"KRN",.84,7981013.002,2,105,0)
</xsl:template>
"KRN",.84,7981013.002,2,106,0)
 
"KRN",.84,7981013.002,2,107,0)
<xsl:template match="COLUMN[@NAME='NC']">
"KRN",.84,7981013.002,2,108,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981013.002,2,109,0)
  <xsl:with-param name="title" select="'Number of Codes'"/>
"KRN",.84,7981013.002,2,110,0)
</xsl:call-template>
"KRN",.84,7981013.002,2,111,0)
</xsl:template>
"KRN",.84,7981013.002,2,112,0)
 
"KRN",.84,7981013.002,2,113,0)
<xsl:template match="COLUMN[@NAME='NP']">
"KRN",.84,7981013.002,2,114,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981013.002,2,115,0)
  <xsl:with-param name="title" select="'Number of Patients'"/>
"KRN",.84,7981013.002,2,116,0)
</xsl:call-template>
"KRN",.84,7981013.002,2,117,0)
</xsl:template>
"KRN",.84,7981013.002,2,118,0)
 
"KRN",.84,7981013.002,2,119,0)
<xsl:template match="COLUMN[@NAME='SOURCE']">
"KRN",.84,7981013.002,2,120,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981013.002,2,121,0)
  <xsl:with-param name="title" select="'Source'"/>
"KRN",.84,7981013.002,2,122,0)
</xsl:call-template>
"KRN",.84,7981013.002,2,123,0)
</xsl:template>
"KRN",.84,7981013.002,2,124,0)
 
"KRN",.84,7981013.002,2,125,0)
</xsl:stylesheet>
"KRN",.84,7981014.001,-1)
0^17
"KRN",.84,7981014.001,0)
7981014.001^2^^CLINICAL CASE REGISTRIES^Registry Medications Report (HTML)
"KRN",.84,7981014.001,2,0)
^^138^138^3170814^
"KRN",.84,7981014.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981014.001,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981014.001,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981014.001,2,4,0)
 
"KRN",.84,7981014.001,2,5,0)
<xsl:import  href="template://report/998/1"/>  <!-- Styles   --> 
"KRN",.84,7981014.001,2,6,0)
<xsl:import  href="template://report/999/1"/>  <!-- Common   -->
"KRN",.84,7981014.001,2,7,0)
<xsl:import  href="template://report/997/1"/>  <!-- Patients -->
"KRN",.84,7981014.001,2,8,0)
<xsl:include href="template://report/996/1"/>  <!-- Pharmacy -->
"KRN",.84,7981014.001,2,9,0)
 
"KRN",.84,7981014.001,2,10,0)
<xsl:variable name="complete" 
"KRN",.84,7981014.001,2,11,0)
select="/REPORT/PARAMETERS/OPTIONS/@COMPLETE"/>
"KRN",.84,7981014.001,2,12,0)
 
"KRN",.84,7981014.001,2,13,0)
<xsl:template match="/">
"KRN",.84,7981014.001,2,14,0)
<html>
"KRN",.84,7981014.001,2,15,0)
  <head>
"KRN",.84,7981014.001,2,16,0)
   <title>Registry Medications Report</title>
"KRN",.84,7981014.001,2,17,0)
   <xsl:call-template name="StyleSheet"/>
"KRN",.84,7981014.001,2,18,0)
   <style type="text/css">
"KRN",.84,7981014.001,2,19,0)
    td.DrugComb {
"KRN",.84,7981014.001,2,20,0)
     font-weight: bold;
"KRN",.84,7981014.001,2,21,0)
     text-align: left;
"KRN",.84,7981014.001,2,22,0)
     background-color: #EEEEEE;
"KRN",.84,7981014.001,2,23,0)
    }
"KRN",.84,7981014.001,2,24,0)
   </style>
"KRN",.84,7981014.001,2,25,0)
  </head>
"KRN",.84,7981014.001,2,26,0)
  <body>
"KRN",.84,7981014.001,2,27,0)
   <h1>Registry Medications Report</h1>
"KRN",.84,7981014.001,2,28,0)
   <xsl:call-template name="ReportHeader"/>
"KRN",.84,7981014.001,2,29,0)
   <!-- The following line added to fix page break issue in IE 7 -->
"KRN",.84,7981014.001,2,30,0)
   <div style="page-break-after:always; font-size:1; margin:0; 
"KRN",.84,7981014.001,2,31,0)
border:0"><span style="visibility: hidden">-</span></div>
"KRN",.84,7981014.001,2,32,0)
   <div>
"KRN",.84,7981014.001,2,33,0)
    <xsl:apply-templates select="/REPORT/RXCOMBLST"/>
"KRN",.84,7981014.001,2,34,0)
   </div>
"KRN",.84,7981014.001,2,35,0)
  </body>
"KRN",.84,7981014.001,2,36,0)
</html>
"KRN",.84,7981014.001,2,37,0)
</xsl:template>
"KRN",.84,7981014.001,2,38,0)
 
"KRN",.84,7981014.001,2,39,0)
<xsl:template match="RXCOMBLST">
"KRN",.84,7981014.001,2,40,0)
<xsl:call-template name="DataGrid">
"KRN",.84,7981014.001,2,41,0)
  <xsl:with-param name="scroll" select="*[31] or 
"KRN",.84,7981014.001,2,42,0)
descendant::PATIENT[31]"/>
"KRN",.84,7981014.001,2,43,0)
</xsl:call-template>
"KRN",.84,7981014.001,2,44,0)
</xsl:template>
"KRN",.84,7981014.001,2,45,0)
 
"KRN",.84,7981014.001,2,46,0)
<xsl:template match="HEADER/TBLDEF[@NAME='RXCOMBLST']/@HEADER">
"KRN",.84,7981014.001,2,47,0)
<thead>
"KRN",.84,7981014.001,2,48,0)
  <xsl:choose>
"KRN",.84,7981014.001,2,49,0)
   <xsl:when test="$complete">
"KRN",.84,7981014.001,2,50,0)
    <tr>
"KRN",.84,7981014.001,2,51,0)
     <xsl:call-template name="ColumnHeader">
"KRN",.84,7981014.001,2,52,0)
      <xsl:with-param name="title" select="'Number of Patients'"/>
"KRN",.84,7981014.001,2,53,0)
      <xsl:with-param name="rowspan" select="2"/>
"KRN",.84,7981014.001,2,54,0)
      <xsl:with-param name="sort" select="''"/>
"KRN",.84,7981014.001,2,55,0)
     </xsl:call-template>
"KRN",.84,7981014.001,2,56,0)
     <xsl:call-template name="ColumnHeader">
"KRN",.84,7981014.001,2,57,0)
      <xsl:with-param name="title" select="'Combination of Drugs'"/>
"KRN",.84,7981014.001,2,58,0)
      <xsl:with-param name="colspan" select="11"/>      <!-- Make larger 
"KRN",.84,7981014.001,2,59,0)
than number of columns -->
"KRN",.84,7981014.001,2,60,0)
      <xsl:with-param name="sort" select="''"/>
"KRN",.84,7981014.001,2,61,0)
     </xsl:call-template>
"KRN",.84,7981014.001,2,62,0)
    </tr>
"KRN",.84,7981014.001,2,63,0)
    <tr>
"KRN",.84,7981014.001,2,64,0)
     <xsl:call-template name="BasicPatientHeader">
"KRN",.84,7981014.001,2,65,0)
      <xsl:with-param name="seqnum"  select="0"/>
"KRN",.84,7981014.001,2,66,0)
      <xsl:with-param name="ageyes"  select="$AGE_YES"/>
"KRN",.84,7981014.001,2,67,0)
      <xsl:with-param name="dobyes"  select="$DOB_YES"/>
"KRN",.84,7981014.001,2,68,0)
      <xsl:with-param name="icnyes"  select="$ICN_YES"/>
"KRN",.84,7981014.001,2,69,0)
      <xsl:with-param name="pactyes" select="$PACT_YES"/>
"KRN",.84,7981014.001,2,70,0)
      <xsl:with-param name="pcpyes"  select="$PCP_YES"/>
"KRN",.84,7981014.001,2,71,0)
     </xsl:call-template>
"KRN",.84,7981014.001,2,72,0)
    </tr>
"KRN",.84,7981014.001,2,73,0)
   </xsl:when>
"KRN",.84,7981014.001,2,74,0)
   <xsl:otherwise>
"KRN",.84,7981014.001,2,75,0)
    <tr>
"KRN",.84,7981014.001,2,76,0)
     <xsl:call-template name="ColumnHeader">
"KRN",.84,7981014.001,2,77,0)
      <xsl:with-param name="title" select="'Number of Patients'"/>
"KRN",.84,7981014.001,2,78,0)
      <xsl:with-param name="sort" select="''"/>
"KRN",.84,7981014.001,2,79,0)
     </xsl:call-template>
"KRN",.84,7981014.001,2,80,0)
     <xsl:call-template name="ColumnHeader">
"KRN",.84,7981014.001,2,81,0)
      <xsl:with-param name="title" select="'Combination of Drugs'"/>
"KRN",.84,7981014.001,2,82,0)
      <xsl:with-param name="sort" select="''"/>
"KRN",.84,7981014.001,2,83,0)
     </xsl:call-template>
"KRN",.84,7981014.001,2,84,0)
    </tr>
"KRN",.84,7981014.001,2,85,0)
   </xsl:otherwise>
"KRN",.84,7981014.001,2,86,0)
  </xsl:choose>
"KRN",.84,7981014.001,2,87,0)
</thead>
"KRN",.84,7981014.001,2,88,0)
</xsl:template>
"KRN",.84,7981014.001,2,89,0)
 
"KRN",.84,7981014.001,2,90,0)
<xsl:template match="RXCOMBLST/RXCOMB">
"KRN",.84,7981014.001,2,91,0)
<xsl:choose>
"KRN",.84,7981014.001,2,92,0)
  <xsl:when test="$complete">
"KRN",.84,7981014.001,2,93,0)
   <xsl:variable name="rowspan" select="count(PATIENTS/PATIENT)+1"/>
"KRN",.84,7981014.001,2,94,0)
   <tr>
"KRN",.84,7981014.001,2,95,0)
    <xsl:call-template name="TableCell">
"KRN",.84,7981014.001,2,96,0)
     <xsl:with-param name="value" select="NP"/>
"KRN",.84,7981014.001,2,97,0)
     <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981014.001,2,98,0)
     <xsl:with-param name="width" select="'5%'"/>
"KRN",.84,7981014.001,2,99,0)
    </xsl:call-template>
"KRN",.84,7981014.001,2,100,0)
    <td class="DrugComb" colspan="11">      <!-- Make larger than number 
"KRN",.84,7981014.001,2,101,0)
of columns -->
"KRN",.84,7981014.001,2,102,0)
     <xsl:call-template name="DrugCombination"/>
"KRN",.84,7981014.001,2,103,0)
    </td>
"KRN",.84,7981014.001,2,104,0)
   </tr>
"KRN",.84,7981014.001,2,105,0)
   <xsl:for-each select="PATIENTS/PATIENT">
"KRN",.84,7981014.001,2,106,0)
    <tr>
"KRN",.84,7981014.001,2,107,0)
     <xsl:call-template name="BasicPatientData">
"KRN",.84,7981014.001,2,108,0)
      <xsl:with-param name="seqnum"  select="0"/>
"KRN",.84,7981014.001,2,109,0)
      <xsl:with-param name="ageyes"  select="$AGE_YES"/>
"KRN",.84,7981014.001,2,110,0)
      <xsl:with-param name="dobyes"  select="$DOB_YES"/>
"KRN",.84,7981014.001,2,111,0)
      <xsl:with-param name="icnyes"  select="$ICN_YES"/>
"KRN",.84,7981014.001,2,112,0)
      <xsl:with-param name="pactyes" select="$PACT_YES"/>
"KRN",.84,7981014.001,2,113,0)
      <xsl:with-param name="pcpyes"  select="$PCP_YES"/>
"KRN",.84,7981014.001,2,114,0)
     </xsl:call-template>
"KRN",.84,7981014.001,2,115,0)
    </tr>
"KRN",.84,7981014.001,2,116,0)
   </xsl:for-each>
"KRN",.84,7981014.001,2,117,0)
  </xsl:when>
"KRN",.84,7981014.001,2,118,0)
  <xsl:otherwise>
"KRN",.84,7981014.001,2,119,0)
   <tr>
"KRN",.84,7981014.001,2,120,0)
    <xsl:call-template name="TableCell">
"KRN",.84,7981014.001,2,121,0)
     <xsl:with-param name="value" select="NP"/>
"KRN",.84,7981014.001,2,122,0)
     <xsl:with-param name="width" select="'5%'"/>
"KRN",.84,7981014.001,2,123,0)
    </xsl:call-template>
"KRN",.84,7981014.001,2,124,0)
    <td class="aLeft">
"KRN",.84,7981014.001,2,125,0)
     <xsl:call-template name="DrugCombination"/>
"KRN",.84,7981014.001,2,126,0)
    </td>
"KRN",.84,7981014.001,2,127,0)
   </tr>
"KRN",.84,7981014.001,2,128,0)
  </xsl:otherwise>
"KRN",.84,7981014.001,2,129,0)
</xsl:choose>
"KRN",.84,7981014.001,2,130,0)
</xsl:template>
"KRN",.84,7981014.001,2,131,0)
 
"KRN",.84,7981014.001,2,132,0)
<xsl:template name="DrugCombination">
"KRN",.84,7981014.001,2,133,0)
<xsl:for-each select="DRUGS/NAME">
"KRN",.84,7981014.001,2,134,0)
  <xsl:if test="position()>1">; </xsl:if><xsl:value-of select="."/>
"KRN",.84,7981014.001,2,135,0)
</xsl:for-each>
"KRN",.84,7981014.001,2,136,0)
</xsl:template>
"KRN",.84,7981014.001,2,137,0)
 
"KRN",.84,7981014.001,2,138,0)
</xsl:stylesheet>
"KRN",.84,7981014.002,-1)
0^18
"KRN",.84,7981014.002,0)
7981014.002^2^^CLINICAL CASE REGISTRIES^Registry Medications Report (CSV)
"KRN",.84,7981014.002,2,0)
^^101^101^3170814^
"KRN",.84,7981014.002,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981014.002,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981014.002,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981014.002,2,4,0)
 
"KRN",.84,7981014.002,2,5,0)
<xsl:import href="template://report/999/2"/>  <!-- Common   -->
"KRN",.84,7981014.002,2,6,0)
  
"KRN",.84,7981014.002,2,7,0)
<xsl:variable name="complete" 
"KRN",.84,7981014.002,2,8,0)
select="/REPORT/PARAMETERS/OPTIONS/@COMPLETE"/>
"KRN",.84,7981014.002,2,9,0)
 
"KRN",.84,7981014.002,2,10,0)
<xsl:template match="/">
"KRN",.84,7981014.002,2,11,0)
<xsl:text>Registry Medications Report</xsl:text>
"KRN",.84,7981014.002,2,12,0)
<xsl:value-of select="$CRLF"/>
"KRN",.84,7981014.002,2,13,0)
<xsl:text>Number of Patients,Combination of Drugs</xsl:text>
"KRN",.84,7981014.002,2,14,0)
<xsl:if test="$complete">
"KRN",.84,7981014.002,2,15,0)
  <xsl:text>,Patient Name,SSN</xsl:text>
"KRN",.84,7981014.002,2,16,0)
  <xsl:if test="$AGE_YES">,Age</xsl:if>
"KRN",.84,7981014.002,2,17,0)
  <xsl:if test="$DOB_YES">,Date of Birth</xsl:if>
"KRN",.84,7981014.002,2,18,0)
  <xsl:text>,Date of Death</xsl:text>
"KRN",.84,7981014.002,2,19,0)
</xsl:if>
"KRN",.84,7981014.002,2,20,0)
<xsl:if test="$ICN_YES">,ICN</xsl:if>
"KRN",.84,7981014.002,2,21,0)
<xsl:if test="$PACT_YES">,PACT</xsl:if>
"KRN",.84,7981014.002,2,22,0)
<xsl:if test="$PCP_YES">,PCP</xsl:if>
"KRN",.84,7981014.002,2,23,0)
<xsl:value-of select="$CRLF"/>
"KRN",.84,7981014.002,2,24,0)
<xsl:apply-templates select="/REPORT/RXCOMBLST/RXCOMB"/>
"KRN",.84,7981014.002,2,25,0)
<xsl:if test="not(/REPORT/RXCOMBLST/RXCOMB[1])">
"KRN",.84,7981014.002,2,26,0)
  <xsl:call-template name="TableNoData"/>
"KRN",.84,7981014.002,2,27,0)
</xsl:if>
"KRN",.84,7981014.002,2,28,0)
</xsl:template>
"KRN",.84,7981014.002,2,29,0)
 
"KRN",.84,7981014.002,2,30,0)
<xsl:template match="RXCOMBLST/RXCOMB">
"KRN",.84,7981014.002,2,31,0)
<xsl:choose>
"KRN",.84,7981014.002,2,32,0)
  <xsl:when test="$complete">
"KRN",.84,7981014.002,2,33,0)
   <xsl:variable name="np" select="NP"/>
"KRN",.84,7981014.002,2,34,0)
   <xsl:variable name="drugs" select="DRUGS"/>
"KRN",.84,7981014.002,2,35,0)
   <xsl:for-each select="PATIENTS/PATIENT">
"KRN",.84,7981014.002,2,36,0)
    <xsl:call-template name="TableCell">
"KRN",.84,7981014.002,2,37,0)
     <xsl:with-param name="value" select="$np"/>
"KRN",.84,7981014.002,2,38,0)
    </xsl:call-template>
"KRN",.84,7981014.002,2,39,0)
    <xsl:call-template name="DrugCombination">
"KRN",.84,7981014.002,2,40,0)
     <xsl:with-param name="drugs" select="$drugs"/>
"KRN",.84,7981014.002,2,41,0)
    </xsl:call-template>
"KRN",.84,7981014.002,2,42,0)
    <xsl:call-template name="TableCell">
"KRN",.84,7981014.002,2,43,0)
     <xsl:with-param name="value" select="NAME"/>
"KRN",.84,7981014.002,2,44,0)
    </xsl:call-template>
"KRN",.84,7981014.002,2,45,0)
    <xsl:call-template name="TableCell">
"KRN",.84,7981014.002,2,46,0)
     <xsl:with-param name="value" select="LAST4"/>
"KRN",.84,7981014.002,2,47,0)
    </xsl:call-template>
"KRN",.84,7981014.002,2,48,0)
    <xsl:if test="$AGE_YES">
"KRN",.84,7981014.002,2,49,0)
     <xsl:call-template name="TableCell">
"KRN",.84,7981014.002,2,50,0)
      <xsl:with-param name="value" select="AGE"/>
"KRN",.84,7981014.002,2,51,0)
     </xsl:call-template>
"KRN",.84,7981014.002,2,52,0)
    </xsl:if>
"KRN",.84,7981014.002,2,53,0)
    <xsl:if test="$DOB_YES">
"KRN",.84,7981014.002,2,54,0)
     <xsl:call-template name="TableCell">
"KRN",.84,7981014.002,2,55,0)
      <xsl:with-param name="value" select="DOB"/>
"KRN",.84,7981014.002,2,56,0)
      <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981014.002,2,57,0)
     </xsl:call-template>
"KRN",.84,7981014.002,2,58,0)
    </xsl:if>
"KRN",.84,7981014.002,2,59,0)
    <xsl:call-template name="TableCell">
"KRN",.84,7981014.002,2,60,0)
     <xsl:with-param name="value" select="DOD"/>
"KRN",.84,7981014.002,2,61,0)
     <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981014.002,2,62,0)
    </xsl:call-template>
"KRN",.84,7981014.002,2,63,0)
    <xsl:if test="$ICN_YES">
"KRN",.84,7981014.002,2,64,0)
     <xsl:call-template name="TableCell">
"KRN",.84,7981014.002,2,65,0)
      <xsl:with-param name="value" select="ICN"/>
"KRN",.84,7981014.002,2,66,0)
     </xsl:call-template>
"KRN",.84,7981014.002,2,67,0)
    </xsl:if>
"KRN",.84,7981014.002,2,68,0)
    <xsl:if test="$PACT_YES">
"KRN",.84,7981014.002,2,69,0)
     <xsl:call-template name="TableCell">
"KRN",.84,7981014.002,2,70,0)
      <xsl:with-param name="value" select="PACT"/>
"KRN",.84,7981014.002,2,71,0)
     </xsl:call-template>
"KRN",.84,7981014.002,2,72,0)
    </xsl:if>
"KRN",.84,7981014.002,2,73,0)
    <xsl:if test="$PCP_YES">
"KRN",.84,7981014.002,2,74,0)
     <xsl:call-template name="TableCell">
"KRN",.84,7981014.002,2,75,0)
      <xsl:with-param name="value" select="PCP"/>
"KRN",.84,7981014.002,2,76,0)
     </xsl:call-template>
"KRN",.84,7981014.002,2,77,0)
    </xsl:if>
"KRN",.84,7981014.002,2,78,0)
    <xsl:value-of select="$CRLF"/>
"KRN",.84,7981014.002,2,79,0)
   </xsl:for-each>
"KRN",.84,7981014.002,2,80,0)
  </xsl:when>
"KRN",.84,7981014.002,2,81,0)
  <xsl:otherwise>
"KRN",.84,7981014.002,2,82,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981014.002,2,83,0)
    <xsl:with-param name="value" select="NP"/>
"KRN",.84,7981014.002,2,84,0)
   </xsl:call-template>
"KRN",.84,7981014.002,2,85,0)
   <xsl:call-template name="DrugCombination"/>
"KRN",.84,7981014.002,2,86,0)
   <xsl:value-of select="$CRLF"/>
"KRN",.84,7981014.002,2,87,0)
  </xsl:otherwise>
"KRN",.84,7981014.002,2,88,0)
</xsl:choose>
"KRN",.84,7981014.002,2,89,0)
</xsl:template>
"KRN",.84,7981014.002,2,90,0)
 
"KRN",.84,7981014.002,2,91,0)
<xsl:template name="DrugCombination">
"KRN",.84,7981014.002,2,92,0)
<xsl:param name="drugs" select="DRUGS"/>
"KRN",.84,7981014.002,2,93,0)
<xsl:text>&quot;</xsl:text>
"KRN",.84,7981014.002,2,94,0)
<xsl:for-each select="$drugs/NAME">
"KRN",.84,7981014.002,2,95,0)
  <xsl:if test="position()>1">; </xsl:if>
"KRN",.84,7981014.002,2,96,0)
  <xsl:call-template name="DoubleQuotes"/>
"KRN",.84,7981014.002,2,97,0)
</xsl:for-each>
"KRN",.84,7981014.002,2,98,0)
<xsl:text>&quot;,</xsl:text>
"KRN",.84,7981014.002,2,99,0)
</xsl:template>
"KRN",.84,7981014.002,2,100,0)
 
"KRN",.84,7981014.002,2,101,0)
</xsl:stylesheet>
"KRN",.84,7981015.001,-1)
0^25
"KRN",.84,7981015.001,0)
7981015.001^2^^CLINICAL CASE REGISTRIES^Procedures (HTML)
"KRN",.84,7981015.001,2,0)
^^368^368^3170810^
"KRN",.84,7981015.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981015.001,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981015.001,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981015.001,2,4,0)
 
"KRN",.84,7981015.001,2,5,0)
<xsl:import  href="template://report/998/1"/>  <!-- Styles   --> 
"KRN",.84,7981015.001,2,6,0)
<xsl:import  href="template://report/999/1"/>  <!-- Common   -->
"KRN",.84,7981015.001,2,7,0)
<xsl:include href="template://report/997/1"/>  <!-- Patients -->
"KRN",.84,7981015.001,2,8,0)
 
"KRN",.84,7981015.001,2,9,0)
<xsl:key name="patient-cpt" match="/REPORT/PROCEDURES/PROCEDURE" 
"KRN",.84,7981015.001,2,10,0)
use="@ID"/>
"KRN",.84,7981015.001,2,11,0)
 
"KRN",.84,7981015.001,2,12,0)
<xsl:template match="/">
"KRN",.84,7981015.001,2,13,0)
<html>
"KRN",.84,7981015.001,2,14,0)
  <head>
"KRN",.84,7981015.001,2,15,0)
   <title>Procedures</title>
"KRN",.84,7981015.001,2,16,0)
   <xsl:call-template name="StyleSheet"/>
"KRN",.84,7981015.001,2,17,0)
  </head>
"KRN",.84,7981015.001,2,18,0)
  <body>
"KRN",.84,7981015.001,2,19,0)
   <h1>Procedures</h1>
"KRN",.84,7981015.001,2,20,0)
   <xsl:call-template name="ReportHeader"/>
"KRN",.84,7981015.001,2,21,0)
   <xsl:choose>
"KRN",.84,7981015.001,2,22,0)
    <xsl:when test="/REPORT/SUMMARY/NP > 0">
"KRN",.84,7981015.001,2,23,0)
     <xsl:call-template name="ReportSummary"/>
"KRN",.84,7981015.001,2,24,0)
     <xsl:apply-templates select="/REPORT/PROCLST"/>
"KRN",.84,7981015.001,2,25,0)
     <xsl:apply-templates select="/REPORT/PROCEDURES"/>
"KRN",.84,7981015.001,2,26,0)
     <xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981015.001,2,27,0)
    </xsl:when>
"KRN",.84,7981015.001,2,28,0)
    <xsl:otherwise>
"KRN",.84,7981015.001,2,29,0)
     <xsl:call-template name="TableNoData"/>
"KRN",.84,7981015.001,2,30,0)
    </xsl:otherwise>
"KRN",.84,7981015.001,2,31,0)
   </xsl:choose>
"KRN",.84,7981015.001,2,32,0)
  </body>
"KRN",.84,7981015.001,2,33,0)
</html>
"KRN",.84,7981015.001,2,34,0)
</xsl:template>
"KRN",.84,7981015.001,2,35,0)
 
"KRN",.84,7981015.001,2,36,0)
<!--[ TABLES ]-->
"KRN",.84,7981015.001,2,37,0)
 
"KRN",.84,7981015.001,2,38,0)
<xsl:template match="REPORT/PROCEDURES">
"KRN",.84,7981015.001,2,39,0)
<!-- The following line added to fix page break issue in IE 7 -->
"KRN",.84,7981015.001,2,40,0)
<div style="page-break-after:always; font-size:1; margin:0; 
"KRN",.84,7981015.001,2,41,0)
border:0"><span style="visibility: hidden">-</span></div>
"KRN",.84,7981015.001,2,42,0)
<div>
"KRN",.84,7981015.001,2,43,0)
  <h2>Patients</h2>
"KRN",.84,7981015.001,2,44,0)
  <xsl:choose>
"KRN",.84,7981015.001,2,45,0)
   <xsl:when test="PROCEDURE[1]">
"KRN",.84,7981015.001,2,46,0)
    <div>
"KRN",.84,7981015.001,2,47,0)
     <xsl:call-template name="MakeScrollable">
"KRN",.84,7981015.001,2,48,0)
      <xsl:with-param name="condition" select="PROCEDURE[31]"/>
"KRN",.84,7981015.001,2,49,0)
     </xsl:call-template>
"KRN",.84,7981015.001,2,50,0)
     <table class="dataGrid" cellpadding="5" cellspacing="0">
"KRN",.84,7981015.001,2,51,0)
      <thead>
"KRN",.84,7981015.001,2,52,0)
       <tr>
"KRN",.84,7981015.001,2,53,0)
        <xsl:call-template name="BasicPatientHeader">
"KRN",.84,7981015.001,2,54,0)
         <xsl:with-param name="tblname" select="'PROCEDURES'"/>
"KRN",.84,7981015.001,2,55,0)
         <xsl:with-param name="ageyes"  select="$AGE_YES"/>
"KRN",.84,7981015.001,2,56,0)
         <xsl:with-param name="dobyes"  select="$DOB_YES"/>
"KRN",.84,7981015.001,2,57,0)
         <xsl:with-param name="icnyes"  select="$ICN_YES"/>
"KRN",.84,7981015.001,2,58,0)
         <xsl:with-param name="pactyes" select="$PACT_YES"/>
"KRN",.84,7981015.001,2,59,0)
         <xsl:with-param name="pcpyes"  select="$PCP_YES"/>
"KRN",.84,7981015.001,2,60,0)
        </xsl:call-template>
"KRN",.84,7981015.001,2,61,0)
        <xsl:call-template name="ProcHeader"/>
"KRN",.84,7981015.001,2,62,0)
       </tr>
"KRN",.84,7981015.001,2,63,0)
      </thead>
"KRN",.84,7981015.001,2,64,0)
      <xsl:call-template name="DataGridFooter">
"KRN",.84,7981015.001,2,65,0)
       <xsl:with-param name="colspan" select="15"/>    <!-- Make bigger 
"KRN",.84,7981015.001,2,66,0)
than number of columns -->
"KRN",.84,7981015.001,2,67,0)
      </xsl:call-template>
"KRN",.84,7981015.001,2,68,0)
      <tbody>
"KRN",.84,7981015.001,2,69,0)
       <xsl:choose>
"KRN",.84,7981015.001,2,70,0)
        <xsl:when 
"KRN",.84,7981015.001,2,71,0)
test="contains(',DOD,LAST4,NAME,',concat(',',@SORT,','))">
"KRN",.84,7981015.001,2,72,0)
         <xsl:for-each 
"KRN",.84,7981015.001,2,73,0)
select="PROCEDURE[generate-id(.)=generate-id(key('patient-cpt',@ID))]">
"KRN",.84,7981015.001,2,74,0)
          <xsl:call-template name="PatientProcData">
"KRN",.84,7981015.001,2,75,0)
           <xsl:with-param name="group" select="key('patient-cpt',@ID)"/>
"KRN",.84,7981015.001,2,76,0)
           <xsl:with-param name="ageyes"  select="$AGE_YES"/>
"KRN",.84,7981015.001,2,77,0)
           <xsl:with-param name="dobyes"  select="$DOB_YES"/>
"KRN",.84,7981015.001,2,78,0)
           <xsl:with-param name="icnyes"  select="$ICN_YES"/>
"KRN",.84,7981015.001,2,79,0)
           <xsl:with-param name="pactyes" select="$PACT_YES"/>
"KRN",.84,7981015.001,2,80,0)
           <xsl:with-param name="pcpyes"  select="$PCP_YES"/>
"KRN",.84,7981015.001,2,81,0)
          </xsl:call-template>
"KRN",.84,7981015.001,2,82,0)
         </xsl:for-each>
"KRN",.84,7981015.001,2,83,0)
        </xsl:when>
"KRN",.84,7981015.001,2,84,0)
        <xsl:otherwise> 
"KRN",.84,7981015.001,2,85,0)
         <xsl:for-each select="PROCEDURE">
"KRN",.84,7981015.001,2,86,0)
          <tr>
"KRN",.84,7981015.001,2,87,0)
           <xsl:call-template name="PatientData">
"KRN",.84,7981015.001,2,88,0)
             <xsl:with-param name="ageyes"  select="$AGE_YES"/>
"KRN",.84,7981015.001,2,89,0)
             <xsl:with-param name="dobyes"  select="$DOB_YES"/>
"KRN",.84,7981015.001,2,90,0)
             <xsl:with-param name="icnyes"  select="$ICN_YES"/>
"KRN",.84,7981015.001,2,91,0)
             <xsl:with-param name="pactyes" select="$PACT_YES"/>
"KRN",.84,7981015.001,2,92,0)
             <xsl:with-param name="pcpyes"  select="$PCP_YES"/>
"KRN",.84,7981015.001,2,93,0)
           </xsl:call-template>
"KRN",.84,7981015.001,2,94,0)
           <xsl:call-template name="ProcData"/>
"KRN",.84,7981015.001,2,95,0)
          </tr>
"KRN",.84,7981015.001,2,96,0)
         </xsl:for-each>
"KRN",.84,7981015.001,2,97,0)
        </xsl:otherwise>
"KRN",.84,7981015.001,2,98,0)
       </xsl:choose>
"KRN",.84,7981015.001,2,99,0)
      </tbody>
"KRN",.84,7981015.001,2,100,0)
     </table>
"KRN",.84,7981015.001,2,101,0)
    </div>
"KRN",.84,7981015.001,2,102,0)
    <div class="reportSummary">
"KRN",.84,7981015.001,2,103,0)
     <div style="float:left; width:30%">
"KRN",.84,7981015.001,2,104,0)
      <table cellpadding="3" cellspacing="0">
"KRN",.84,7981015.001,2,105,0)
       <caption>Source</caption>
"KRN",.84,7981015.001,2,106,0)
       <thead>
"KRN",.84,7981015.001,2,107,0)
        <tr>
"KRN",.84,7981015.001,2,108,0)
         <th width="30">Code</th>
"KRN",.84,7981015.001,2,109,0)
         <th>Description</th>
"KRN",.84,7981015.001,2,110,0)
        </tr>
"KRN",.84,7981015.001,2,111,0)
       </thead>
"KRN",.84,7981015.001,2,112,0)
       <tbody>
"KRN",.84,7981015.001,2,113,0)
        <tr>
"KRN",.84,7981015.001,2,114,0)
         <td align="center">I</td>
"KRN",.84,7981015.001,2,115,0)
         <td class="aLeft">Inpatient file</td>
"KRN",.84,7981015.001,2,116,0)
        </tr>
"KRN",.84,7981015.001,2,117,0)
        <tr>
"KRN",.84,7981015.001,2,118,0)
         <td align="center">O</td>
"KRN",.84,7981015.001,2,119,0)
         <td class="aLeft">Outpatient file</td>
"KRN",.84,7981015.001,2,120,0)
        </tr>
"KRN",.84,7981015.001,2,121,0)
       </tbody>
"KRN",.84,7981015.001,2,122,0)
      </table>
"KRN",.84,7981015.001,2,123,0)
     </div>
"KRN",.84,7981015.001,2,124,0)
    </div>
"KRN",.84,7981015.001,2,125,0)
   </xsl:when>
"KRN",.84,7981015.001,2,126,0)
   <xsl:otherwise>
"KRN",.84,7981015.001,2,127,0)
    <xsl:call-template name="TableNoData"/>
"KRN",.84,7981015.001,2,128,0)
   </xsl:otherwise>
"KRN",.84,7981015.001,2,129,0)
  </xsl:choose>
"KRN",.84,7981015.001,2,130,0)
</div>
"KRN",.84,7981015.001,2,131,0)
</xsl:template>
"KRN",.84,7981015.001,2,132,0)
 
"KRN",.84,7981015.001,2,133,0)
<xsl:template match="REPORT/PATIENTS">
"KRN",.84,7981015.001,2,134,0)
<!-- The following line added to fix page break issue in IE 7 -->
"KRN",.84,7981015.001,2,135,0)
<div style="page-break-after:always; font-size:1; margin:0; 
"KRN",.84,7981015.001,2,136,0)
border:0"><span style="visibility: hidden">-</span></div>
"KRN",.84,7981015.001,2,137,0)
<div>
"KRN",.84,7981015.001,2,138,0)
   <h2>Patients</h2>
"KRN",.84,7981015.001,2,139,0)
   <xsl:call-template name="DataGrid"/>
"KRN",.84,7981015.001,2,140,0)
</div>
"KRN",.84,7981015.001,2,141,0)
</xsl:template>
"KRN",.84,7981015.001,2,142,0)
 
"KRN",.84,7981015.001,2,143,0)
<xsl:template match="REPORT/PROCLST">
"KRN",.84,7981015.001,2,144,0)
<!-- The following line added to fix page break issue in IE 7 -->
"KRN",.84,7981015.001,2,145,0)
<div style="page-break-after:always; font-size:1; margin:0; 
"KRN",.84,7981015.001,2,146,0)
border:0"><span style="visibility: hidden">-</span></div>
"KRN",.84,7981015.001,2,147,0)
<div>
"KRN",.84,7981015.001,2,148,0)
  <h2>Procedure Codes</h2>
"KRN",.84,7981015.001,2,149,0)
   <xsl:call-template name="DataGrid"/>
"KRN",.84,7981015.001,2,150,0)
</div>
"KRN",.84,7981015.001,2,151,0)
</xsl:template>
"KRN",.84,7981015.001,2,152,0)
 
"KRN",.84,7981015.001,2,153,0)
<!--[ TABLE HEADERS ]-->
"KRN",.84,7981015.001,2,154,0)
 
"KRN",.84,7981015.001,2,155,0)
<xsl:template match="COLUMN[@NAME='DATE']">
"KRN",.84,7981015.001,2,156,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981015.001,2,157,0)
   <xsl:with-param name="title" select="'Date'"/>
"KRN",.84,7981015.001,2,158,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981015.001,2,159,0)
</xsl:call-template>
"KRN",.84,7981015.001,2,160,0)
</xsl:template>
"KRN",.84,7981015.001,2,161,0)
 
"KRN",.84,7981015.001,2,162,0)
<xsl:template match="COLUMN[@NAME='NC']">
"KRN",.84,7981015.001,2,163,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981015.001,2,164,0)
   <xsl:with-param name="title" select="'Number of Codes'"/>
"KRN",.84,7981015.001,2,165,0)
   <xsl:with-param name="width" select="'15%'"/>
"KRN",.84,7981015.001,2,166,0)
</xsl:call-template>
"KRN",.84,7981015.001,2,167,0)
</xsl:template>
"KRN",.84,7981015.001,2,168,0)
 
"KRN",.84,7981015.001,2,169,0)
<xsl:template match="COLUMN[@NAME='NP']">
"KRN",.84,7981015.001,2,170,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981015.001,2,171,0)
   <xsl:with-param name="title" select="'Number of Patients'"/>
"KRN",.84,7981015.001,2,172,0)
   <xsl:with-param name="width" select="'15%'"/>
"KRN",.84,7981015.001,2,173,0)
</xsl:call-template>
"KRN",.84,7981015.001,2,174,0)
</xsl:template>
"KRN",.84,7981015.001,2,175,0)
 
"KRN",.84,7981015.001,2,176,0)
<xsl:template match="COLUMN[@NAME='PROCNAME']">
"KRN",.84,7981015.001,2,177,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981015.001,2,178,0)
   <xsl:with-param name="title" select="'Procedure Name'"/>
"KRN",.84,7981015.001,2,179,0)
</xsl:call-template>
"KRN",.84,7981015.001,2,180,0)
</xsl:template>
"KRN",.84,7981015.001,2,181,0)
 
"KRN",.84,7981015.001,2,182,0)
<xsl:template match="COLUMN[@NAME='PROCODE']">
"KRN",.84,7981015.001,2,183,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981015.001,2,184,0)
   <xsl:with-param name="title" select="'Code'"/>
"KRN",.84,7981015.001,2,185,0)
   <xsl:with-param name="width" select="'5%'"/>
"KRN",.84,7981015.001,2,186,0)
</xsl:call-template>
"KRN",.84,7981015.001,2,187,0)
</xsl:template>
"KRN",.84,7981015.001,2,188,0)
 
"KRN",.84,7981015.001,2,189,0)
<xsl:template match="COLUMN[@NAME='SOURCE']">
"KRN",.84,7981015.001,2,190,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981015.001,2,191,0)
   <xsl:with-param name="title" select="'Source'"/>
"KRN",.84,7981015.001,2,192,0)
   <xsl:with-param name="width" select="'1%'"/>
"KRN",.84,7981015.001,2,193,0)
</xsl:call-template>
"KRN",.84,7981015.001,2,194,0)
</xsl:template>
"KRN",.84,7981015.001,2,195,0)
 
"KRN",.84,7981015.001,2,196,0)
<!--[ TABLE CELLS ]-->
"KRN",.84,7981015.001,2,197,0)
 
"KRN",.84,7981015.001,2,198,0)
<xsl:template match="PROCNAME">
"KRN",.84,7981015.001,2,199,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981015.001,2,200,0)
   <xsl:with-param name="class" select="'aLeft'"/>
"KRN",.84,7981015.001,2,201,0)
</xsl:call-template>
"KRN",.84,7981015.001,2,202,0)
</xsl:template>
"KRN",.84,7981015.001,2,203,0)
 
"KRN",.84,7981015.001,2,204,0)
<!--[ UTILITIES ]-->
"KRN",.84,7981015.001,2,205,0)
 
"KRN",.84,7981015.001,2,206,0)
<xsl:template name="PatientData">
"KRN",.84,7981015.001,2,207,0)
<xsl:param name="number" select="position()"/>
"KRN",.84,7981015.001,2,208,0)
<xsl:param name="ref"/>
"KRN",.84,7981015.001,2,209,0)
<xsl:param name="rowspan" select="1"/>
"KRN",.84,7981015.001,2,210,0)
<xsl:param name="ageyes"  select="''"/>
"KRN",.84,7981015.001,2,211,0)
<xsl:param name="dobyes"  select="''"/>
"KRN",.84,7981015.001,2,212,0)
<xsl:param name="icnyes"  select="''"/>
"KRN",.84,7981015.001,2,213,0)
<xsl:param name="pactyes" select="''"/>
"KRN",.84,7981015.001,2,214,0)
<xsl:param name="pcpyes"  select="''"/>
"KRN",.84,7981015.001,2,215,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981015.001,2,216,0)
   <xsl:with-param name="value" select="$number"/>
"KRN",.84,7981015.001,2,217,0)
   <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981015.001,2,218,0)
</xsl:call-template>
"KRN",.84,7981015.001,2,219,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981015.001,2,220,0)
   <xsl:with-param name="class" select="'aLeft'"/>
"KRN",.84,7981015.001,2,221,0)
   <xsl:with-param name="value" select="NAME"/>
"KRN",.84,7981015.001,2,222,0)
   <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981015.001,2,223,0)
</xsl:call-template>
"KRN",.84,7981015.001,2,224,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981015.001,2,225,0)
   <xsl:with-param name="value" select="LAST4"/>
"KRN",.84,7981015.001,2,226,0)
   <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981015.001,2,227,0)
</xsl:call-template>
"KRN",.84,7981015.001,2,228,0)
<xsl:if test="$ageyes">
"KRN",.84,7981015.001,2,229,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981015.001,2,230,0)
   <xsl:with-param name="value" select="AGE"/>
"KRN",.84,7981015.001,2,231,0)
   <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981015.001,2,232,0)
  </xsl:call-template>
"KRN",.84,7981015.001,2,233,0)
</xsl:if>
"KRN",.84,7981015.001,2,234,0)
<xsl:if test="$dobyes">
"KRN",.84,7981015.001,2,235,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981015.001,2,236,0)
   <xsl:with-param name="value" select="DOB"/>
"KRN",.84,7981015.001,2,237,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981015.001,2,238,0)
   <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981015.001,2,239,0)
  </xsl:call-template>
"KRN",.84,7981015.001,2,240,0)
</xsl:if>
"KRN",.84,7981015.001,2,241,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981015.001,2,242,0)
  <xsl:with-param name="value" select="DOD"/>
"KRN",.84,7981015.001,2,243,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981015.001,2,244,0)
   <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981015.001,2,245,0)
</xsl:call-template>
"KRN",.84,7981015.001,2,246,0)
<xsl:if test="$icnyes">
"KRN",.84,7981015.001,2,247,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981015.001,2,248,0)
    <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981015.001,2,249,0)
    <xsl:with-param name="value" select="ICN"/>
"KRN",.84,7981015.001,2,250,0)
    <xsl:with-param name="class" select="'aLeft'"/>
"KRN",.84,7981015.001,2,251,0)
   </xsl:call-template>
"KRN",.84,7981015.001,2,252,0)
</xsl:if>
"KRN",.84,7981015.001,2,253,0)
<xsl:if test="$pactyes">
"KRN",.84,7981015.001,2,254,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981015.001,2,255,0)
    <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981015.001,2,256,0)
    <xsl:with-param name="value" select="PACT"/>
"KRN",.84,7981015.001,2,257,0)
    <xsl:with-param name="class" select="'aLeft'"/>
"KRN",.84,7981015.001,2,258,0)
   </xsl:call-template>
"KRN",.84,7981015.001,2,259,0)
</xsl:if>
"KRN",.84,7981015.001,2,260,0)
<xsl:if test="$pcpyes">
"KRN",.84,7981015.001,2,261,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981015.001,2,262,0)
    <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981015.001,2,263,0)
    <xsl:with-param name="value" select="PCP"/>
"KRN",.84,7981015.001,2,264,0)
    <xsl:with-param name="class" select="'aLeft'"/>
"KRN",.84,7981015.001,2,265,0)
   </xsl:call-template>
"KRN",.84,7981015.001,2,266,0)
</xsl:if>
"KRN",.84,7981015.001,2,267,0)
</xsl:template>
"KRN",.84,7981015.001,2,268,0)
 
"KRN",.84,7981015.001,2,269,0)
<xsl:template name="PatientProcData">
"KRN",.84,7981015.001,2,270,0)
<xsl:param name="group"/>
"KRN",.84,7981015.001,2,271,0)
<xsl:param name="number" select="position()"/>
"KRN",.84,7981015.001,2,272,0)
<xsl:param name="ageyes"  select="''"/>
"KRN",.84,7981015.001,2,273,0)
<xsl:param name="dobyes"  select="''"/>
"KRN",.84,7981015.001,2,274,0)
<xsl:param name="icnyes"  select="''"/>
"KRN",.84,7981015.001,2,275,0)
<xsl:param name="pactyes" select="''"/>
"KRN",.84,7981015.001,2,276,0)
<xsl:param name="pcpyes"  select="''"/>
"KRN",.84,7981015.001,2,277,0)
<xsl:variable name="rowspan" select="count($group)"/>
"KRN",.84,7981015.001,2,278,0)
<xsl:for-each select="$group">
"KRN",.84,7981015.001,2,279,0)
   <xsl:sort select="PROCNAME"/>
"KRN",.84,7981015.001,2,280,0)
   <tr>
"KRN",.84,7981015.001,2,281,0)
    <xsl:if test="position()=1">
"KRN",.84,7981015.001,2,282,0)
     <xsl:call-template name="PatientData">
"KRN",.84,7981015.001,2,283,0)
      <xsl:with-param name="number"  select="$number"/>
"KRN",.84,7981015.001,2,284,0)
      <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981015.001,2,285,0)
      <xsl:with-param name="ageyes"  select="$ageyes"/>
"KRN",.84,7981015.001,2,286,0)
      <xsl:with-param name="dobyes"  select="$dobyes"/>
"KRN",.84,7981015.001,2,287,0)
      <xsl:with-param name="icnyes"  select="$icnyes"/>
"KRN",.84,7981015.001,2,288,0)
      <xsl:with-param name="pactyes" select="$pactyes"/>
"KRN",.84,7981015.001,2,289,0)
      <xsl:with-param name="pcpyes"  select="$pcpyes"/>
"KRN",.84,7981015.001,2,290,0)
     </xsl:call-template>
"KRN",.84,7981015.001,2,291,0)
    </xsl:if>
"KRN",.84,7981015.001,2,292,0)
    <xsl:call-template name="ProcData"/>
"KRN",.84,7981015.001,2,293,0)
   </tr>
"KRN",.84,7981015.001,2,294,0)
</xsl:for-each>
"KRN",.84,7981015.001,2,295,0)
</xsl:template>
"KRN",.84,7981015.001,2,296,0)
 
"KRN",.84,7981015.001,2,297,0)
<xsl:template name="ProcData">
"KRN",.84,7981015.001,2,298,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981015.001,2,299,0)
   <xsl:with-param name="value" select="PROCODE"/>
"KRN",.84,7981015.001,2,300,0)
</xsl:call-template>
"KRN",.84,7981015.001,2,301,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981015.001,2,302,0)
   <xsl:with-param name="value" select="PROCNAME"/>
"KRN",.84,7981015.001,2,303,0)
   <xsl:with-param name="class" select="'aLeft'"/>
"KRN",.84,7981015.001,2,304,0)
</xsl:call-template>
"KRN",.84,7981015.001,2,305,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981015.001,2,306,0)
   <xsl:with-param name="value" select="DATE"/>
"KRN",.84,7981015.001,2,307,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981015.001,2,308,0)
</xsl:call-template>
"KRN",.84,7981015.001,2,309,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981015.001,2,310,0)
   <xsl:with-param name="value" select="SOURCE"/>
"KRN",.84,7981015.001,2,311,0)
</xsl:call-template>
"KRN",.84,7981015.001,2,312,0)
</xsl:template>
"KRN",.84,7981015.001,2,313,0)
 
"KRN",.84,7981015.001,2,314,0)
<xsl:template name="ProcHeader">
"KRN",.84,7981015.001,2,315,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981015.001,2,316,0)
   <xsl:with-param name="colname" select="'PROCODE'"/>
"KRN",.84,7981015.001,2,317,0)
   <xsl:with-param name="sort" select="'PROCEDURES=PROCODE'"/>
"KRN",.84,7981015.001,2,318,0)
   <xsl:with-param name="title" select="'Code'"/>    
"KRN",.84,7981015.001,2,319,0)
   <xsl:with-param name="width" select="'8%'"/>
"KRN",.84,7981015.001,2,320,0)
</xsl:call-template>
"KRN",.84,7981015.001,2,321,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981015.001,2,322,0)
   <xsl:with-param name="colname" select="'PROCNAME'"/>
"KRN",.84,7981015.001,2,323,0)
   <xsl:with-param name="sort" select="'PROCEDURES=PROCNAME'"/>
"KRN",.84,7981015.001,2,324,0)
   <xsl:with-param name="title" select="'Procedure Name'"/>
"KRN",.84,7981015.001,2,325,0)
</xsl:call-template>
"KRN",.84,7981015.001,2,326,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981015.001,2,327,0)
   <xsl:with-param name="colname" select="'DATE'"/>
"KRN",.84,7981015.001,2,328,0)
   <xsl:with-param name="sort" select="'PROCEDURES=DATE'"/>
"KRN",.84,7981015.001,2,329,0)
   <xsl:with-param name="title" select="'Date'"/>    
"KRN",.84,7981015.001,2,330,0)
   <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981015.001,2,331,0)
</xsl:call-template>
"KRN",.84,7981015.001,2,332,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981015.001,2,333,0)
   <xsl:with-param name="colname" select="'SOURCE'"/>
"KRN",.84,7981015.001,2,334,0)
   <xsl:with-param name="sort" select="'PROCEDURES=SOURCE'"/>
"KRN",.84,7981015.001,2,335,0)
   <xsl:with-param name="title" select="'Source'"/>    
"KRN",.84,7981015.001,2,336,0)
   <xsl:with-param name="width" select="'1%'"/>
"KRN",.84,7981015.001,2,337,0)
</xsl:call-template>
"KRN",.84,7981015.001,2,338,0)
</xsl:template>
"KRN",.84,7981015.001,2,339,0)
 
"KRN",.84,7981015.001,2,340,0)
<xsl:template name="ReportSummary">
"KRN",.84,7981015.001,2,341,0)
<xsl:param name="summary" select="/REPORT/SUMMARY"/>
"KRN",.84,7981015.001,2,342,0)
<table width="100%" cellpadding="5" cellspacing="0">
"KRN",.84,7981015.001,2,343,0)
  <thead>
"KRN",.84,7981015.001,2,344,0)
   <tr>
"KRN",.84,7981015.001,2,345,0)
    <th width="33%">Number of Patients</th>
"KRN",.84,7981015.001,2,346,0)
    <th width="33%">Number of Codes</th>
"KRN",.84,7981015.001,2,347,0)
    <th width="33%">Number of Different Codes </th>
"KRN",.84,7981015.001,2,348,0)
   </tr>
"KRN",.84,7981015.001,2,349,0)
  </thead>
"KRN",.84,7981015.001,2,350,0)
  <tbody>
"KRN",.84,7981015.001,2,351,0)
   <tr>
"KRN",.84,7981015.001,2,352,0)
    <td><xsl:value-of select="$summary/NP"/></td>
"KRN",.84,7981015.001,2,353,0)
    <td><xsl:value-of select="$summary/NC"/></td>
"KRN",.84,7981015.001,2,354,0)
    <td><xsl:value-of select="$summary/NDC"/></td>
"KRN",.84,7981015.001,2,355,0)
   </tr>
"KRN",.84,7981015.001,2,356,0)
  </tbody>
"KRN",.84,7981015.001,2,357,0)
</table>
"KRN",.84,7981015.001,2,358,0)
</xsl:template>
"KRN",.84,7981015.001,2,359,0)
 
"KRN",.84,7981015.001,2,360,0)
<!--[ REPORT PARAMETERS ]-->
"KRN",.84,7981015.001,2,361,0)
 
"KRN",.84,7981015.001,2,362,0)
<xsl:template match="PARAMETERS/DATE_RANGE_3">
"KRN",.84,7981015.001,2,363,0)
<xsl:call-template name="DateRange">
"KRN",.84,7981015.001,2,364,0)
   <xsl:with-param name="title" select="'Utilization'"/>
"KRN",.84,7981015.001,2,365,0)
</xsl:call-template>
"KRN",.84,7981015.001,2,366,0)
</xsl:template>
"KRN",.84,7981015.001,2,367,0)
 
"KRN",.84,7981015.001,2,368,0)
</xsl:stylesheet>
"KRN",.84,7981015.002,-1)
0^26
"KRN",.84,7981015.002,0)
7981015.002^2^^CLINICAL CASE REGISTRIES^Procedures (CSV)
"KRN",.84,7981015.002,2,0)
^^122^122^3170810^
"KRN",.84,7981015.002,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981015.002,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981015.002,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981015.002,2,4,0)
 
"KRN",.84,7981015.002,2,5,0)
<xsl:import href="template://report/999/2"/>  <!-- Common   -->
"KRN",.84,7981015.002,2,6,0)
 
"KRN",.84,7981015.002,2,7,0)
<xsl:template match="/">
"KRN",.84,7981015.002,2,8,0)
<xsl:apply-templates select="/REPORT/PROCLST"/>
"KRN",.84,7981015.002,2,9,0)
<xsl:apply-templates select="/REPORT/PROCEDURES"/>
"KRN",.84,7981015.002,2,10,0)
<xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981015.002,2,11,0)
</xsl:template>
"KRN",.84,7981015.002,2,12,0)
 
"KRN",.84,7981015.002,2,13,0)
<xsl:template match="REPORT/PATIENTS">
"KRN",.84,7981015.002,2,14,0)
<xsl:text>Patients without procedures</xsl:text>
"KRN",.84,7981015.002,2,15,0)
<xsl:call-template name="DataGrid"/>
"KRN",.84,7981015.002,2,16,0)
<!-- xsl:value-of select="$FILESWITCH"/ -->
"KRN",.84,7981015.002,2,17,0)
</xsl:template>
"KRN",.84,7981015.002,2,18,0)
 
"KRN",.84,7981015.002,2,19,0)
<xsl:template match="REPORT/PROCEDURES">
"KRN",.84,7981015.002,2,20,0)
<xsl:text>Procedures (Patients)</xsl:text>
"KRN",.84,7981015.002,2,21,0)
<xsl:call-template name="DataGrid"/>
"KRN",.84,7981015.002,2,22,0)
<!-- xsl:value-of select="$FILESWITCH"/ -->
"KRN",.84,7981015.002,2,23,0)
</xsl:template>
"KRN",.84,7981015.002,2,24,0)
 
"KRN",.84,7981015.002,2,25,0)
<xsl:template match="REPORT/PROCLST">
"KRN",.84,7981015.002,2,26,0)
<xsl:text>Procedures (CPT and ICD codes)</xsl:text>
"KRN",.84,7981015.002,2,27,0)
<xsl:call-template name="DataGrid"/>
"KRN",.84,7981015.002,2,28,0)
<!-- xsl:value-of select="$FILESWITCH"/ -->
"KRN",.84,7981015.002,2,29,0)
</xsl:template>
"KRN",.84,7981015.002,2,30,0)
 
"KRN",.84,7981015.002,2,31,0)
<xsl:template match="PROCEDURES/PROCEDURE">
"KRN",.84,7981015.002,2,32,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981015.002,2,33,0)
   <xsl:with-param name="value" select="NAME"/>
"KRN",.84,7981015.002,2,34,0)
</xsl:call-template>
"KRN",.84,7981015.002,2,35,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981015.002,2,36,0)
   <xsl:with-param name="value" select="LAST4"/>
"KRN",.84,7981015.002,2,37,0)
</xsl:call-template>
"KRN",.84,7981015.002,2,38,0)
<xsl:if test="$AGE_YES">
"KRN",.84,7981015.002,2,39,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981015.002,2,40,0)
   <xsl:with-param name="value" select="AGE"/>
"KRN",.84,7981015.002,2,41,0)
  </xsl:call-template>
"KRN",.84,7981015.002,2,42,0)
</xsl:if>
"KRN",.84,7981015.002,2,43,0)
<xsl:if test="$DOB_YES">
"KRN",.84,7981015.002,2,44,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981015.002,2,45,0)
   <xsl:with-param name="value" select="DOB"/>
"KRN",.84,7981015.002,2,46,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981015.002,2,47,0)
  </xsl:call-template>
"KRN",.84,7981015.002,2,48,0)
</xsl:if>
"KRN",.84,7981015.002,2,49,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981015.002,2,50,0)
   <xsl:with-param name="value" select="DOD"/>
"KRN",.84,7981015.002,2,51,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981015.002,2,52,0)
</xsl:call-template>
"KRN",.84,7981015.002,2,53,0)
<xsl:if test="$ICN_YES">
"KRN",.84,7981015.002,2,54,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981015.002,2,55,0)
    <xsl:with-param name="value" select="ICN"/>
"KRN",.84,7981015.002,2,56,0)
   </xsl:call-template>
"KRN",.84,7981015.002,2,57,0)
</xsl:if>
"KRN",.84,7981015.002,2,58,0)
<xsl:if test="$PACT_YES">
"KRN",.84,7981015.002,2,59,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981015.002,2,60,0)
    <xsl:with-param name="value" select="PACT"/>
"KRN",.84,7981015.002,2,61,0)
   </xsl:call-template>
"KRN",.84,7981015.002,2,62,0)
</xsl:if>
"KRN",.84,7981015.002,2,63,0)
<xsl:if test="$PCP_YES">
"KRN",.84,7981015.002,2,64,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981015.002,2,65,0)
    <xsl:with-param name="value" select="PCP"/>
"KRN",.84,7981015.002,2,66,0)
   </xsl:call-template>
"KRN",.84,7981015.002,2,67,0)
</xsl:if>
"KRN",.84,7981015.002,2,68,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981015.002,2,69,0)
   <xsl:with-param name="value" select="PROCODE"/>
"KRN",.84,7981015.002,2,70,0)
</xsl:call-template>
"KRN",.84,7981015.002,2,71,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981015.002,2,72,0)
   <xsl:with-param name="value" select="PROCNAME"/>
"KRN",.84,7981015.002,2,73,0)
</xsl:call-template>
"KRN",.84,7981015.002,2,74,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981015.002,2,75,0)
   <xsl:with-param name="value" select="DATE"/>
"KRN",.84,7981015.002,2,76,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981015.002,2,77,0)
</xsl:call-template>
"KRN",.84,7981015.002,2,78,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981015.002,2,79,0)
   <xsl:with-param name="value" select="SOURCE"/>
"KRN",.84,7981015.002,2,80,0)
</xsl:call-template>
"KRN",.84,7981015.002,2,81,0)
<xsl:value-of select="$CRLF"/>
"KRN",.84,7981015.002,2,82,0)
</xsl:template>
"KRN",.84,7981015.002,2,83,0)
 
"KRN",.84,7981015.002,2,84,0)
<!--[ TABLE HEADERS ]-->
"KRN",.84,7981015.002,2,85,0)
 
"KRN",.84,7981015.002,2,86,0)
<xsl:template match="COLUMN[@NAME='DATE']">
"KRN",.84,7981015.002,2,87,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981015.002,2,88,0)
   <xsl:with-param name="title" select="'Date'"/>
"KRN",.84,7981015.002,2,89,0)
</xsl:call-template>
"KRN",.84,7981015.002,2,90,0)
</xsl:template>
"KRN",.84,7981015.002,2,91,0)
 
"KRN",.84,7981015.002,2,92,0)
<xsl:template match="COLUMN[@NAME='NC']">
"KRN",.84,7981015.002,2,93,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981015.002,2,94,0)
   <xsl:with-param name="title" select="'Number of Codes'"/>
"KRN",.84,7981015.002,2,95,0)
</xsl:call-template>
"KRN",.84,7981015.002,2,96,0)
</xsl:template>
"KRN",.84,7981015.002,2,97,0)
 
"KRN",.84,7981015.002,2,98,0)
<xsl:template match="COLUMN[@NAME='NP']">
"KRN",.84,7981015.002,2,99,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981015.002,2,100,0)
   <xsl:with-param name="title" select="'Number of Patients'"/>
"KRN",.84,7981015.002,2,101,0)
</xsl:call-template>
"KRN",.84,7981015.002,2,102,0)
</xsl:template>
"KRN",.84,7981015.002,2,103,0)
 
"KRN",.84,7981015.002,2,104,0)
<xsl:template match="COLUMN[@NAME='PROCODE']">
"KRN",.84,7981015.002,2,105,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981015.002,2,106,0)
   <xsl:with-param name="title" select="'Code'"/>
"KRN",.84,7981015.002,2,107,0)
</xsl:call-template>
"KRN",.84,7981015.002,2,108,0)
</xsl:template>
"KRN",.84,7981015.002,2,109,0)
 
"KRN",.84,7981015.002,2,110,0)
<xsl:template match="COLUMN[@NAME='PROCNAME']">
"KRN",.84,7981015.002,2,111,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981015.002,2,112,0)
   <xsl:with-param name="title" select="'Procedure Name'"/>
"KRN",.84,7981015.002,2,113,0)
</xsl:call-template>
"KRN",.84,7981015.002,2,114,0)
</xsl:template>
"KRN",.84,7981015.002,2,115,0)
 
"KRN",.84,7981015.002,2,116,0)
<xsl:template match="COLUMN[@NAME='SOURCE']">
"KRN",.84,7981015.002,2,117,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981015.002,2,118,0)
   <xsl:with-param name="title" select="'Source'"/>
"KRN",.84,7981015.002,2,119,0)
</xsl:call-template>
"KRN",.84,7981015.002,2,120,0)
</xsl:template>
"KRN",.84,7981015.002,2,121,0)
 
"KRN",.84,7981015.002,2,122,0)
</xsl:stylesheet>
"KRN",.84,7981016.001,-1)
0^40
"KRN",.84,7981016.001,0)
7981016.001^2^^CLINICAL CASE REGISTRIES^Outpatient Utilization (HTML)
"KRN",.84,7981016.001,2,0)
^.844^172^172^3100218^^
"KRN",.84,7981016.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981016.001,2,2,0)
<xsl:stylesheet version="1.0"
"KRN",.84,7981016.001,2,3,0)
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
"KRN",.84,7981016.001,2,4,0)
>
"KRN",.84,7981016.001,2,5,0)
 
"KRN",.84,7981016.001,2,6,0)
<xsl:import  href="template://report/998/1"/>  <!-- Styles   --> 
"KRN",.84,7981016.001,2,7,0)
<xsl:import  href="template://report/999/1"/>  <!-- Common   -->
"KRN",.84,7981016.001,2,8,0)
 
"KRN",.84,7981016.001,2,9,0)
<xsl:template match="/">
"KRN",.84,7981016.001,2,10,0)
 <html>
"KRN",.84,7981016.001,2,11,0)
  <head>
"KRN",.84,7981016.001,2,12,0)
   <title>Outpatient Utilization</title>
"KRN",.84,7981016.001,2,13,0)
   <xsl:call-template name="StyleSheet"/>
"KRN",.84,7981016.001,2,14,0)
  </head>
"KRN",.84,7981016.001,2,15,0)
  <body>
"KRN",.84,7981016.001,2,16,0)
   <h1>Outpatient Utilization</h1>
"KRN",.84,7981016.001,2,17,0)
   <xsl:call-template name="ReportHeader"/>
"KRN",.84,7981016.001,2,18,0)
   <xsl:choose>
"KRN",.84,7981016.001,2,19,0)
    <xsl:when test="REPORT/OUTPATIENTS">
"KRN",.84,7981016.001,2,20,0)
     <!-- The following line added to fix page break issue in IE 7 -->
"KRN",.84,7981016.001,2,21,0)
     <div style="page-break-after:always; font-size:1; margin:0; 
"KRN",.84,7981016.001,2,22,0)
border:0"><span style="visibility: hidden">-</span></div>
"KRN",.84,7981016.001,2,23,0)
     <div>
"KRN",.84,7981016.001,2,24,0)
      <xsl:call-template name="OutpatientSummary"/>
"KRN",.84,7981016.001,2,25,0)
      <xsl:apply-templates select="REPORT/OUTPATIENTS/*[@TABLE]"/>
"KRN",.84,7981016.001,2,26,0)
     </div>
"KRN",.84,7981016.001,2,27,0)
    </xsl:when>
"KRN",.84,7981016.001,2,28,0)
    <xsl:otherwise>
"KRN",.84,7981016.001,2,29,0)
     <xsl:call-template name="TableNoData"/>
"KRN",.84,7981016.001,2,30,0)
    </xsl:otherwise>
"KRN",.84,7981016.001,2,31,0)
   </xsl:choose>
"KRN",.84,7981016.001,2,32,0)
   <xsl:if test="REPORT/HIGHUTIL">
"KRN",.84,7981016.001,2,33,0)
     <!-- The following line added to fix page break issue in IE 7 -->
"KRN",.84,7981016.001,2,34,0)
     <div style="page-break-after:always; font-size:1; margin:0; 
"KRN",.84,7981016.001,2,35,0)
border:0"><span style="visibility: hidden">-</span></div>
"KRN",.84,7981016.001,2,36,0)
     <div>
"KRN",.84,7981016.001,2,37,0)
     <h2>Highest Utilization</h2>
"KRN",.84,7981016.001,2,38,0)
     <xsl:apply-templates select="REPORT/HIGHUTIL/*"/>
"KRN",.84,7981016.001,2,39,0)
    </div>
"KRN",.84,7981016.001,2,40,0)
   </xsl:if>
"KRN",.84,7981016.001,2,41,0)
  </body>
"KRN",.84,7981016.001,2,42,0)
 </html>
"KRN",.84,7981016.001,2,43,0)
</xsl:template>
"KRN",.84,7981016.001,2,44,0)
 
"KRN",.84,7981016.001,2,45,0)
<xsl:template match="HIGHUTIL/HU_STOPS">
"KRN",.84,7981016.001,2,46,0)
 <h3><xsl:call-template name="HUPatientsHeader"/> by number of stop codes</h3>
"KRN",.84,7981016.001,2,47,0)
 <xsl:call-template name="DataGrid"/>
"KRN",.84,7981016.001,2,48,0)
</xsl:template>
"KRN",.84,7981016.001,2,49,0)
 
"KRN",.84,7981016.001,2,50,0)
<xsl:template match="OUTPATIENTS/CLINICS">
"KRN",.84,7981016.001,2,51,0)
 <h3>Distribution of Utilization among Clinics</h3>
"KRN",.84,7981016.001,2,52,0)
 <xsl:call-template name="DataGrid"/>
"KRN",.84,7981016.001,2,53,0)
</xsl:template>
"KRN",.84,7981016.001,2,54,0)
 
"KRN",.84,7981016.001,2,55,0)
<xsl:template match="OUTPATIENTS/STOPS">
"KRN",.84,7981016.001,2,56,0)
 <br clear="both"/>
"KRN",.84,7981016.001,2,57,0)
 <xsl:call-template name="DataGrid">
"KRN",.84,7981016.001,2,58,0)
  <xsl:with-param name="divstyle" select="'width:50%'"/>
"KRN",.84,7981016.001,2,59,0)
 </xsl:call-template>
"KRN",.84,7981016.001,2,60,0)
</xsl:template>
"KRN",.84,7981016.001,2,61,0)
 
"KRN",.84,7981016.001,2,62,0)
<!--[ UTILITIES ]-->
"KRN",.84,7981016.001,2,63,0)
 
"KRN",.84,7981016.001,2,64,0)
<xsl:template name="OutpatientSummary">
"KRN",.84,7981016.001,2,65,0)
 <xsl:variable name="OP" select="/REPORT/OUTPATIENTS"/>
"KRN",.84,7981016.001,2,66,0)
 <xsl:text>
"KRN",.84,7981016.001,2,67,0)
  A total of 1.00 visit is given for outpatient activity on a given date.
"KRN",.84,7981016.001,2,68,0)
  A 'stop' is credited for each entry of a stop code, while a 'visit' is
"KRN",.84,7981016.001,2,69,0)
  split among each stop credited on a given date. Thus, a single visit with
"KRN",.84,7981016.001,2,70,0)
  two stop codes credited will show as 0.5 visit for each stop code. 
"KRN",.84,7981016.001,2,71,0)
 </xsl:text>
"KRN",.84,7981016.001,2,72,0)
 <br/>
"KRN",.84,7981016.001,2,73,0)
 <table width="100%" cellpadding="5" cellspacing="0">
"KRN",.84,7981016.001,2,74,0)
  <thead>
"KRN",.84,7981016.001,2,75,0)
   <tr>
"KRN",.84,7981016.001,2,76,0)
    <th width="33%">Number of Patients</th>
"KRN",.84,7981016.001,2,77,0)
    <th width="33%">Number of Visits</th>
"KRN",.84,7981016.001,2,78,0)
    <th width="33%">Number of Stops</th>
"KRN",.84,7981016.001,2,79,0)
   </tr>
"KRN",.84,7981016.001,2,80,0)
  </thead>
"KRN",.84,7981016.001,2,81,0)
  <tbody>
"KRN",.84,7981016.001,2,82,0)
   <tr>
"KRN",.84,7981016.001,2,83,0)
    <td><xsl:value-of select="$OP/NP"/></td>
"KRN",.84,7981016.001,2,84,0)
    <td><xsl:value-of select="$OP/NV"/></td>
"KRN",.84,7981016.001,2,85,0)
    <td><xsl:value-of select="$OP/NSC"/></td>
"KRN",.84,7981016.001,2,86,0)
   </tr>
"KRN",.84,7981016.001,2,87,0)
  </tbody>
"KRN",.84,7981016.001,2,88,0)
 </table>
"KRN",.84,7981016.001,2,89,0)
</xsl:template>
"KRN",.84,7981016.001,2,90,0)
 
"KRN",.84,7981016.001,2,91,0)
<!--[ COLUMN HEADERS ]-->
"KRN",.84,7981016.001,2,92,0)
 
"KRN",.84,7981016.001,2,93,0)
<xsl:template match="COLUMN[@NAME='NAME']">
"KRN",.84,7981016.001,2,94,0)
 <xsl:variable name="tblname" select="../@NAME"/>
"KRN",.84,7981016.001,2,95,0)
 <xsl:choose>
"KRN",.84,7981016.001,2,96,0)
  <xsl:when test="$tblname='CLINICS'">
"KRN",.84,7981016.001,2,97,0)
   <xsl:call-template name="ColumnHeader">
"KRN",.84,7981016.001,2,98,0)
    <xsl:with-param name="title" select="'Clinic'"/>
"KRN",.84,7981016.001,2,99,0)
   </xsl:call-template> 
"KRN",.84,7981016.001,2,100,0)
  </xsl:when>
"KRN",.84,7981016.001,2,101,0)
  <xsl:when test="contains($tblname,'HU_')">
"KRN",.84,7981016.001,2,102,0)
   <xsl:call-template name="ColumnHeader">
"KRN",.84,7981016.001,2,103,0)
    <xsl:with-param name="title" select="'Patient Name'"/>
"KRN",.84,7981016.001,2,104,0)
   </xsl:call-template> 
"KRN",.84,7981016.001,2,105,0)
  </xsl:when>
"KRN",.84,7981016.001,2,106,0)
  <xsl:otherwise>
"KRN",.84,7981016.001,2,107,0)
   <xsl:call-template name="ColumnHeader">
"KRN",.84,7981016.001,2,108,0)
    <xsl:with-param name="title" select="'Name'"/>
"KRN",.84,7981016.001,2,109,0)
   </xsl:call-template> 
"KRN",.84,7981016.001,2,110,0)
  </xsl:otherwise>
"KRN",.84,7981016.001,2,111,0)
 </xsl:choose>
"KRN",.84,7981016.001,2,112,0)
</xsl:template>
"KRN",.84,7981016.001,2,113,0)
 
"KRN",.84,7981016.001,2,114,0)
<xsl:template match="COLUMN[@NAME='NDS']">
"KRN",.84,7981016.001,2,115,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981016.001,2,116,0)
  <xsl:with-param name="title" select="'Number of Different Stops'"/>
"KRN",.84,7981016.001,2,117,0)
  <xsl:with-param name="sortmode" select="':DESC'"/>
"KRN",.84,7981016.001,2,118,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981016.001,2,119,0)
 </xsl:call-template>
"KRN",.84,7981016.001,2,120,0)
</xsl:template>
"KRN",.84,7981016.001,2,121,0)
 
"KRN",.84,7981016.001,2,122,0)
<xsl:template match="COLUMN[@NAME='NP']">
"KRN",.84,7981016.001,2,123,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981016.001,2,124,0)
  <xsl:with-param name="title" select="'Number of Patients'"/>
"KRN",.84,7981016.001,2,125,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981016.001,2,126,0)
 </xsl:call-template>
"KRN",.84,7981016.001,2,127,0)
</xsl:template>
"KRN",.84,7981016.001,2,128,0)
 
"KRN",.84,7981016.001,2,129,0)
<xsl:template match="COLUMN[@NAME='NSC']">
"KRN",.84,7981016.001,2,130,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981016.001,2,131,0)
  <xsl:with-param name="title" select="'Number of Stops'"/>
"KRN",.84,7981016.001,2,132,0)
  <xsl:with-param name="sortmode" select="':DESC'"/>
"KRN",.84,7981016.001,2,133,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981016.001,2,134,0)
 </xsl:call-template>
"KRN",.84,7981016.001,2,135,0)
</xsl:template>
"KRN",.84,7981016.001,2,136,0)
 
"KRN",.84,7981016.001,2,137,0)
<xsl:template match="COLUMN[@NAME='NV']">
"KRN",.84,7981016.001,2,138,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981016.001,2,139,0)
  <xsl:with-param name="title" select="'Number of Visits'"/>
"KRN",.84,7981016.001,2,140,0)
  <xsl:with-param name="sortmode" select="':DESC'"/>
"KRN",.84,7981016.001,2,141,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981016.001,2,142,0)
 </xsl:call-template>
"KRN",.84,7981016.001,2,143,0)
</xsl:template>
"KRN",.84,7981016.001,2,144,0)
 
"KRN",.84,7981016.001,2,145,0)
<xsl:template match="COLUMN[@NAME='STOP']">
"KRN",.84,7981016.001,2,146,0)
 <xsl:call-template name="ColumnHeader">
"KRN",.84,7981016.001,2,147,0)
  <xsl:with-param name="title" select="'Stop Code'"/>
"KRN",.84,7981016.001,2,148,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981016.001,2,149,0)
 </xsl:call-template>
"KRN",.84,7981016.001,2,150,0)
</xsl:template>
"KRN",.84,7981016.001,2,151,0)
 
"KRN",.84,7981016.001,2,152,0)
<!--[ CELL VALUES ]-->
"KRN",.84,7981016.001,2,153,0)
 
"KRN",.84,7981016.001,2,154,0)
<xsl:template match="NOBS/PATIENT/DATE">
"KRN",.84,7981016.001,2,155,0)
 <xsl:call-template name="TableCell">
"KRN",.84,7981016.001,2,156,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981016.001,2,157,0)
 </xsl:call-template>
"KRN",.84,7981016.001,2,158,0)
</xsl:template>
"KRN",.84,7981016.001,2,159,0)
 
"KRN",.84,7981016.001,2,160,0)
<!--[ REPORT PARAMETERS ]-->
"KRN",.84,7981016.001,2,161,0)
 
"KRN",.84,7981016.001,2,162,0)
<xsl:template match="PARAMETERS/MAXUTNUM">
"KRN",.84,7981016.001,2,163,0)
 <tr>
"KRN",.84,7981016.001,2,164,0)
  <th scope="row">MaxUtil:&#160;</th>
"KRN",.84,7981016.001,2,165,0)
  <td>
"KRN",.84,7981016.001,2,166,0)
   <xsl:value-of select="."/>
"KRN",.84,7981016.001,2,167,0)
   (maximum number of patients with highest utilization to display)
"KRN",.84,7981016.001,2,168,0)
  </td>
"KRN",.84,7981016.001,2,169,0)
 </tr>
"KRN",.84,7981016.001,2,170,0)
</xsl:template>
"KRN",.84,7981016.001,2,171,0)
 
"KRN",.84,7981016.001,2,172,0)
</xsl:stylesheet>
"KRN",.84,7981016.002,-1)
0^39
"KRN",.84,7981016.002,0)
7981016.002^2^^CLINICAL CASE REGISTRIES^Outpatient Utilization (CSV)
"KRN",.84,7981016.002,2,0)
^^88^88^3170809^
"KRN",.84,7981016.002,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981016.002,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981016.002,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981016.002,2,4,0)
 
"KRN",.84,7981016.002,2,5,0)
<xsl:import href="template://report/999/2"/>  <!-- Common   -->
"KRN",.84,7981016.002,2,6,0)
 
"KRN",.84,7981016.002,2,7,0)
<xsl:variable name="UTILIZATION_HEADER" select="'Outpatient 
"KRN",.84,7981016.002,2,8,0)
Utilization'"/>
"KRN",.84,7981016.002,2,9,0)
 
"KRN",.84,7981016.002,2,10,0)
<xsl:template match="/">
"KRN",.84,7981016.002,2,11,0)
<xsl:call-template name="UtilizationSection">
"KRN",.84,7981016.002,2,12,0)
  <xsl:with-param name="data" select="REPORT/OUTPATIENTS/STOPS"/>
"KRN",.84,7981016.002,2,13,0)
  <xsl:with-param name="subttl" select="'Stops'"/>
"KRN",.84,7981016.002,2,14,0)
</xsl:call-template>
"KRN",.84,7981016.002,2,15,0)
<xsl:call-template name="UtilizationSection">
"KRN",.84,7981016.002,2,16,0)
  <xsl:with-param name="data" select="REPORT/OUTPATIENTS/CLINICS"/>
"KRN",.84,7981016.002,2,17,0)
  <xsl:with-param name="subttl"
"KRN",.84,7981016.002,2,18,0)
       select="'Distribution of Utilization among Clinics'"/>
"KRN",.84,7981016.002,2,19,0)
</xsl:call-template>
"KRN",.84,7981016.002,2,20,0)
<xsl:call-template name="UtilizationSection">
"KRN",.84,7981016.002,2,21,0)
  <xsl:with-param name="data" select="REPORT/HIGHUTIL/HU_STOPS"/>
"KRN",.84,7981016.002,2,22,0)
  <xsl:with-param name="subttl" select="'Highest Utilization of Stop 
"KRN",.84,7981016.002,2,23,0)
Codes'"/>
"KRN",.84,7981016.002,2,24,0)
</xsl:call-template>
"KRN",.84,7981016.002,2,25,0)
</xsl:template>
"KRN",.84,7981016.002,2,26,0)
 
"KRN",.84,7981016.002,2,27,0)
<!--[ COLUMN HEADERS ]-->
"KRN",.84,7981016.002,2,28,0)
 
"KRN",.84,7981016.002,2,29,0)
<xsl:template match="COLUMN[@NAME='NAME']">
"KRN",.84,7981016.002,2,30,0)
<xsl:variable name="tblname" select="../@NAME"/>
"KRN",.84,7981016.002,2,31,0)
<xsl:choose>
"KRN",.84,7981016.002,2,32,0)
  <xsl:when test="$tblname='CLINICS'">
"KRN",.84,7981016.002,2,33,0)
   <xsl:call-template name="ColumnHeader">
"KRN",.84,7981016.002,2,34,0)
    <xsl:with-param name="title" select="'Clinic'"/>
"KRN",.84,7981016.002,2,35,0)
   </xsl:call-template> 
"KRN",.84,7981016.002,2,36,0)
  </xsl:when>
"KRN",.84,7981016.002,2,37,0)
  <xsl:when test="contains($tblname,'HU_')">
"KRN",.84,7981016.002,2,38,0)
   <xsl:call-template name="ColumnHeader">
"KRN",.84,7981016.002,2,39,0)
    <xsl:with-param name="title" select="'Patient Name'"/>
"KRN",.84,7981016.002,2,40,0)
   </xsl:call-template> 
"KRN",.84,7981016.002,2,41,0)
  </xsl:when>
"KRN",.84,7981016.002,2,42,0)
  <xsl:otherwise>
"KRN",.84,7981016.002,2,43,0)
   <xsl:call-template name="ColumnHeader">
"KRN",.84,7981016.002,2,44,0)
    <xsl:with-param name="title" select="'Name'"/>
"KRN",.84,7981016.002,2,45,0)
   </xsl:call-template> 
"KRN",.84,7981016.002,2,46,0)
  </xsl:otherwise>
"KRN",.84,7981016.002,2,47,0)
</xsl:choose>
"KRN",.84,7981016.002,2,48,0)
</xsl:template>
"KRN",.84,7981016.002,2,49,0)
 
"KRN",.84,7981016.002,2,50,0)
<xsl:template match="COLUMN[@NAME='NDS']">
"KRN",.84,7981016.002,2,51,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981016.002,2,52,0)
  <xsl:with-param name="title" select="'Number of Different Stops'"/>
"KRN",.84,7981016.002,2,53,0)
</xsl:call-template>
"KRN",.84,7981016.002,2,54,0)
</xsl:template>
"KRN",.84,7981016.002,2,55,0)
 
"KRN",.84,7981016.002,2,56,0)
<xsl:template match="COLUMN[@NAME='NP']">
"KRN",.84,7981016.002,2,57,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981016.002,2,58,0)
  <xsl:with-param name="title" select="'Number of Patients'"/>
"KRN",.84,7981016.002,2,59,0)
</xsl:call-template>
"KRN",.84,7981016.002,2,60,0)
</xsl:template>
"KRN",.84,7981016.002,2,61,0)
 
"KRN",.84,7981016.002,2,62,0)
<xsl:template match="COLUMN[@NAME='NSC']">
"KRN",.84,7981016.002,2,63,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981016.002,2,64,0)
  <xsl:with-param name="title" select="'Number of Stops'"/>
"KRN",.84,7981016.002,2,65,0)
</xsl:call-template>
"KRN",.84,7981016.002,2,66,0)
</xsl:template>
"KRN",.84,7981016.002,2,67,0)
 
"KRN",.84,7981016.002,2,68,0)
<xsl:template match="COLUMN[@NAME='NV']">
"KRN",.84,7981016.002,2,69,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981016.002,2,70,0)
  <xsl:with-param name="title" select="'Number of Visits'"/>
"KRN",.84,7981016.002,2,71,0)
</xsl:call-template>
"KRN",.84,7981016.002,2,72,0)
</xsl:template>
"KRN",.84,7981016.002,2,73,0)
 
"KRN",.84,7981016.002,2,74,0)
<xsl:template match="COLUMN[@NAME='STOP']">
"KRN",.84,7981016.002,2,75,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981016.002,2,76,0)
  <xsl:with-param name="title" select="'Stop Code'"/>
"KRN",.84,7981016.002,2,77,0)
</xsl:call-template>
"KRN",.84,7981016.002,2,78,0)
</xsl:template>
"KRN",.84,7981016.002,2,79,0)
 
"KRN",.84,7981016.002,2,80,0)
<!--[ CELL VALUES ]-->
"KRN",.84,7981016.002,2,81,0)
 
"KRN",.84,7981016.002,2,82,0)
<xsl:template match="NOBS/PATIENT/DATE">
"KRN",.84,7981016.002,2,83,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981016.002,2,84,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981016.002,2,85,0)
</xsl:call-template>
"KRN",.84,7981016.002,2,86,0)
</xsl:template>
"KRN",.84,7981016.002,2,87,0)
 
"KRN",.84,7981016.002,2,88,0)
</xsl:stylesheet>
"KRN",.84,7981018.001,-1)
0^49
"KRN",.84,7981018.001,0)
7981018.001^2^^CLINICAL CASE REGISTRIES^BMI Report by Range (HTML)
"KRN",.84,7981018.001,2,0)
^^133^133^3171015^
"KRN",.84,7981018.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981018.001,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981018.001,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981018.001,2,4,0)
 
"KRN",.84,7981018.001,2,5,0)
<xsl:import  href="template://report/998/1"/>  <!-- Styles   -->
"KRN",.84,7981018.001,2,6,0)
<xsl:import  href="template://report/999/1"/>  <!-- Common   -->
"KRN",.84,7981018.001,2,7,0)
<xsl:include href="template://report/997/1"/>  <!-- Patients --> 
"KRN",.84,7981018.001,2,8,0)
 
"KRN",.84,7981018.001,2,9,0)
<xsl:template match="/">
"KRN",.84,7981018.001,2,10,0)
<html>
"KRN",.84,7981018.001,2,11,0)
  <head>
"KRN",.84,7981018.001,2,12,0)
   <title>BMI by Range</title>
"KRN",.84,7981018.001,2,13,0)
   <xsl:call-template name="StyleSheet"/>
"KRN",.84,7981018.001,2,14,0)
  </head>
"KRN",.84,7981018.001,2,15,0)
  <body>
"KRN",.84,7981018.001,2,16,0)
   <h1>BMI by Range</h1>
"KRN",.84,7981018.001,2,17,0)
   <xsl:call-template name="ReportHeader"/>
"KRN",.84,7981018.001,2,18,0)
    <div style="margin:10; color: red; font-weight: bold">
"KRN",.84,7981018.001,2,19,0)
     *For this report, height values that are &lt;36 inches or &gt;96 
"KRN",.84,7981018.001,2,20,0)
inches are assumed to be erroneous and are ignored.
"KRN",.84,7981018.001,2,21,0)
    </div>
"KRN",.84,7981018.001,2,22,0)
   <xsl:call-template name="BMIReportSummary"/>
"KRN",.84,7981018.001,2,23,0)
   <xsl:if test="count(/REPORT/PATIENTS/*) > 0">
"KRN",.84,7981018.001,2,24,0)
     <br />
"KRN",.84,7981018.001,2,25,0)
     <!-- The following line changed to fix page break issue in IE 7 -->
"KRN",.84,7981018.001,2,26,0)
     <div style="page-break-after:always; font-size:1; margin:0; 
"KRN",.84,7981018.001,2,27,0)
border:0"><span style="visibility: hidden">-</span></div>
"KRN",.84,7981018.001,2,28,0)
     <div>
"KRN",.84,7981018.001,2,29,0)
       <xsl:call-template name="MakeScrollable">
"KRN",.84,7981018.001,2,30,0)
         <xsl:with-param name="condition" select="*[31]"/>
"KRN",.84,7981018.001,2,31,0)
       </xsl:call-template>
"KRN",.84,7981018.001,2,32,0)
       <xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981018.001,2,33,0)
   </div>
"KRN",.84,7981018.001,2,34,0)
   </xsl:if>
"KRN",.84,7981018.001,2,35,0)
  </body>
"KRN",.84,7981018.001,2,36,0)
</html>
"KRN",.84,7981018.001,2,37,0)
</xsl:template>
"KRN",.84,7981018.001,2,38,0)
 
"KRN",.84,7981018.001,2,39,0)
<xsl:template name="BMIReportSummary">
"KRN",.84,7981018.001,2,40,0)
<xsl:param name="summary" select="/REPORT/SUMMARY"/>
"KRN",.84,7981018.001,2,41,0)
<table width="45%" cellpadding="5" cellspacing="0">
"KRN",.84,7981018.001,2,42,0)
  <thead>
"KRN",.84,7981018.001,2,43,0)
   <tr>
"KRN",.84,7981018.001,2,44,0)
    <th width="33%">BMI Categories</th>
"KRN",.84,7981018.001,2,45,0)
    <th width="33%">BMI Values</th>
"KRN",.84,7981018.001,2,46,0)
    <th width="33%">Number of Patients</th>
"KRN",.84,7981018.001,2,47,0)
   </tr>
"KRN",.84,7981018.001,2,48,0)
  </thead>
"KRN",.84,7981018.001,2,49,0)
  <tbody>
"KRN",.84,7981018.001,2,50,0)
    <xsl:for-each select="/REPORT/SUMMARY/DATA">
"KRN",.84,7981018.001,2,51,0)
    <tr>
"KRN",.84,7981018.001,2,52,0)
      <td class="aLeft"><xsl:value-of select="./DESC"/></td>
"KRN",.84,7981018.001,2,53,0)
      <td><xsl:value-of select="./VALUES"/></td>
"KRN",.84,7981018.001,2,54,0)
      <td><xsl:value-of select="./NP"/></td>
"KRN",.84,7981018.001,2,55,0)
    </tr>
"KRN",.84,7981018.001,2,56,0)
   </xsl:for-each>
"KRN",.84,7981018.001,2,57,0)
  </tbody>
"KRN",.84,7981018.001,2,58,0)
</table>
"KRN",.84,7981018.001,2,59,0)
</xsl:template>
"KRN",.84,7981018.001,2,60,0)
 
"KRN",.84,7981018.001,2,61,0)
 
"KRN",.84,7981018.001,2,62,0)
<!--[ TABLE HEADERS ]-->
"KRN",.84,7981018.001,2,63,0)
 
"KRN",.84,7981018.001,2,64,0)
<xsl:template match="COLUMN[@NAME='VITAL']">
"KRN",.84,7981018.001,2,65,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981018.001,2,66,0)
  <xsl:with-param name="title" select="'Vital'"/>
"KRN",.84,7981018.001,2,67,0)
  <xsl:with-param name="sort" select="''"/>
"KRN",.84,7981018.001,2,68,0)
  <xsl:with-param name="width" select="'6%'"/>
"KRN",.84,7981018.001,2,69,0)
</xsl:call-template>
"KRN",.84,7981018.001,2,70,0)
</xsl:template>
"KRN",.84,7981018.001,2,71,0)
 
"KRN",.84,7981018.001,2,72,0)
<xsl:template match="COLUMN[@NAME='DATE']">
"KRN",.84,7981018.001,2,73,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981018.001,2,74,0)
  <xsl:with-param name="title" select="'Date'"/>
"KRN",.84,7981018.001,2,75,0)
  <xsl:with-param name="sort" select="''"/>
"KRN",.84,7981018.001,2,76,0)
  <xsl:with-param name="width" select="'8%'"/>
"KRN",.84,7981018.001,2,77,0)
</xsl:call-template>
"KRN",.84,7981018.001,2,78,0)
</xsl:template>
"KRN",.84,7981018.001,2,79,0)
 
"KRN",.84,7981018.001,2,80,0)
<xsl:template match="COLUMN[@NAME='RESULT']">
"KRN",.84,7981018.001,2,81,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981018.001,2,82,0)
  <xsl:with-param name="title" select="'Result'"/>
"KRN",.84,7981018.001,2,83,0)
  <xsl:with-param name="sort" select="''"/>
"KRN",.84,7981018.001,2,84,0)
  <xsl:with-param name="width" select="'4%'"/>
"KRN",.84,7981018.001,2,85,0)
</xsl:call-template>
"KRN",.84,7981018.001,2,86,0)
</xsl:template>
"KRN",.84,7981018.001,2,87,0)
 
"KRN",.84,7981018.001,2,88,0)
<xsl:template match="COLUMN[@NAME='BMI']">
"KRN",.84,7981018.001,2,89,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981018.001,2,90,0)
  <xsl:with-param name="sort" select="'PATIENTS=BMI'"/>
"KRN",.84,7981018.001,2,91,0)
  <xsl:with-param name="width" select="'6%'"/>
"KRN",.84,7981018.001,2,92,0)
</xsl:call-template>
"KRN",.84,7981018.001,2,93,0)
</xsl:template>
"KRN",.84,7981018.001,2,94,0)
 
"KRN",.84,7981018.001,2,95,0)
<!--[ TABLE CELLS ]-->
"KRN",.84,7981018.001,2,96,0)
 
"KRN",.84,7981018.001,2,97,0)
<xsl:template match="PATIENT/BMI">
"KRN",.84,7981018.001,2,98,0)
<xsl:param name="rowspan" select="0"/>
"KRN",.84,7981018.001,2,99,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981018.001,2,100,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981018.001,2,101,0)
</xsl:call-template>
"KRN",.84,7981018.001,2,102,0)
</xsl:template>
"KRN",.84,7981018.001,2,103,0)
 
"KRN",.84,7981018.001,2,104,0)
<xsl:template match="PATIENT/BMIDATA">
"KRN",.84,7981018.001,2,105,0)
<xsl:param name="rowspan" select="0"/>
"KRN",.84,7981018.001,2,106,0)
<td class="aLeft">
"KRN",.84,7981018.001,2,107,0)
   <xsl:text>Height</xsl:text><br/>  
"KRN",.84,7981018.001,2,108,0)
   <xsl:text>Weight</xsl:text>  
"KRN",.84,7981018.001,2,109,0)
 </td>
"KRN",.84,7981018.001,2,110,0)
<td>
"KRN",.84,7981018.001,2,111,0)
   <xsl:call-template name="CellValue">
"KRN",.84,7981018.001,2,112,0)
     <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981018.001,2,113,0)
     <xsl:with-param name="value" select="HEIGHT/DATE"/>
"KRN",.84,7981018.001,2,114,0)
     <xsl:with-param name="width" select="'4%'"/>
"KRN",.84,7981018.001,2,115,0)
 
"KRN",.84,7981018.001,2,116,0)
   </xsl:call-template><br/>
"KRN",.84,7981018.001,2,117,0)
   <xsl:call-template name="CellValue">
"KRN",.84,7981018.001,2,118,0)
     <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981018.001,2,119,0)
     <xsl:with-param name="value" select="WEIGHT/DATE"/>
"KRN",.84,7981018.001,2,120,0)
   </xsl:call-template>
"KRN",.84,7981018.001,2,121,0)
</td>
"KRN",.84,7981018.001,2,122,0)
<td class="aRight">
"KRN",.84,7981018.001,2,123,0)
   <xsl:call-template name="CellValue">
"KRN",.84,7981018.001,2,124,0)
     <xsl:with-param name="value" select="HEIGHT/RESULT"/>
"KRN",.84,7981018.001,2,125,0)
     <xsl:with-param name="width" select="'7%'"/>
"KRN",.84,7981018.001,2,126,0)
   </xsl:call-template><br/>
"KRN",.84,7981018.001,2,127,0)
   <xsl:call-template name="CellValue">
"KRN",.84,7981018.001,2,128,0)
     <xsl:with-param name="value" select="WEIGHT/RESULT"/>
"KRN",.84,7981018.001,2,129,0)
   </xsl:call-template>
"KRN",.84,7981018.001,2,130,0)
</td>
"KRN",.84,7981018.001,2,131,0)
</xsl:template>
"KRN",.84,7981018.001,2,132,0)
 
"KRN",.84,7981018.001,2,133,0)
</xsl:stylesheet>
"KRN",.84,7981018.002,-1)
0^8
"KRN",.84,7981018.002,0)
7981018.002^2^^CLINICAL CASE REGISTRIES^BMI Report by Range (CSV)
"KRN",.84,7981018.002,2,0)
^^112^112^3170802^
"KRN",.84,7981018.002,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981018.002,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981018.002,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981018.002,2,4,0)
 
"KRN",.84,7981018.002,2,5,0)
<xsl:import href="template://report/999/2"/>  <!-- Common -->
"KRN",.84,7981018.002,2,6,0)
 
"KRN",.84,7981018.002,2,7,0)
<xsl:template match="/">
"KRN",.84,7981018.002,2,8,0)
  <xsl:call-template name="BMIReportSummary"/>
"KRN",.84,7981018.002,2,9,0)
  <xsl:text>BMI by Range</xsl:text>
"KRN",.84,7981018.002,2,10,0)
  <xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981018.002,2,11,0)
</xsl:template>
"KRN",.84,7981018.002,2,12,0)
 
"KRN",.84,7981018.002,2,13,0)
<xsl:template name="BMIReportSummary">
"KRN",.84,7981018.002,2,14,0)
<xsl:param name="summary" select="/REPORT/SUMMARY"/>
"KRN",.84,7981018.002,2,15,0)
<xsl:text>BMI by Range (Summary)</xsl:text>
"KRN",.84,7981018.002,2,16,0)
<xsl:value-of select="$CRLF"/>
"KRN",.84,7981018.002,2,17,0)
<xsl:text>BMI Categories</xsl:text>
"KRN",.84,7981018.002,2,18,0)
<xsl:value-of select="$DELIMITER"/>
"KRN",.84,7981018.002,2,19,0)
<xsl:text>BMI Values</xsl:text>
"KRN",.84,7981018.002,2,20,0)
<xsl:value-of select="$DELIMITER"/>
"KRN",.84,7981018.002,2,21,0)
<xsl:text>Number of Patients</xsl:text>
"KRN",.84,7981018.002,2,22,0)
<xsl:value-of select="$CRLF"/>
"KRN",.84,7981018.002,2,23,0)
<xsl:for-each select="/REPORT/SUMMARY/DATA">
"KRN",.84,7981018.002,2,24,0)
   <xsl:value-of select="./DESC"/>
"KRN",.84,7981018.002,2,25,0)
   <xsl:value-of select="$DELIMITER"/>
"KRN",.84,7981018.002,2,26,0)
   <xsl:value-of select="./VALUES"/>
"KRN",.84,7981018.002,2,27,0)
   <xsl:value-of select="$DELIMITER"/>
"KRN",.84,7981018.002,2,28,0)
   <xsl:value-of select="./NP"/>
"KRN",.84,7981018.002,2,29,0)
   <xsl:value-of select="$CRLF"/>
"KRN",.84,7981018.002,2,30,0)
</xsl:for-each>
"KRN",.84,7981018.002,2,31,0)
<!-- xsl:value-of select="$FILESWITCH"/ -->
"KRN",.84,7981018.002,2,32,0)
</xsl:template>
"KRN",.84,7981018.002,2,33,0)
 
"KRN",.84,7981018.002,2,34,0)
<xsl:template match="COLUMN[@NAME='VITAL']">
"KRN",.84,7981018.002,2,35,0)
<xsl:value-of select="''"/>
"KRN",.84,7981018.002,2,36,0)
</xsl:template>
"KRN",.84,7981018.002,2,37,0)
 
"KRN",.84,7981018.002,2,38,0)
<xsl:template match="COLUMN[@NAME='DATE']">
"KRN",.84,7981018.002,2,39,0)
<xsl:value-of select="'Height Date'"/>
"KRN",.84,7981018.002,2,40,0)
<xsl:value-of select="$DELIMITER"/>
"KRN",.84,7981018.002,2,41,0)
<xsl:value-of select="'Height'"/>
"KRN",.84,7981018.002,2,42,0)
<xsl:value-of select="$DELIMITER"/>
"KRN",.84,7981018.002,2,43,0)
</xsl:template>
"KRN",.84,7981018.002,2,44,0)
 
"KRN",.84,7981018.002,2,45,0)
<xsl:template match="COLUMN[@NAME='RESULT']">
"KRN",.84,7981018.002,2,46,0)
<xsl:value-of select="'Weight Date'"/>
"KRN",.84,7981018.002,2,47,0)
<xsl:value-of select="$DELIMITER"/>  
"KRN",.84,7981018.002,2,48,0)
 <xsl:value-of select="'Weight'"/>
"KRN",.84,7981018.002,2,49,0)
<xsl:value-of select="$DELIMITER"/>
"KRN",.84,7981018.002,2,50,0)
</xsl:template>
"KRN",.84,7981018.002,2,51,0)
 
"KRN",.84,7981018.002,2,52,0)
<xsl:template match="PATIENTS/PATIENT">
"KRN",.84,7981018.002,2,53,0)
<xsl:variable name="ptname" select="NAME"/>
"KRN",.84,7981018.002,2,54,0)
<xsl:variable name="ssn" select="LAST4"/>
"KRN",.84,7981018.002,2,55,0)
<xsl:variable name="dod" select="DOD"/>
"KRN",.84,7981018.002,2,56,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981018.002,2,57,0)
   <xsl:with-param name="value" select="$ptname"/>
"KRN",.84,7981018.002,2,58,0)
</xsl:call-template>
"KRN",.84,7981018.002,2,59,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981018.002,2,60,0)
   <xsl:with-param name="value" select="$ssn"/>
"KRN",.84,7981018.002,2,61,0)
</xsl:call-template>
"KRN",.84,7981018.002,2,62,0)
<xsl:if test="$AGE_YES">
"KRN",.84,7981018.002,2,63,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981018.002,2,64,0)
     <xsl:with-param name="value" select="AGE"/>
"KRN",.84,7981018.002,2,65,0)
   </xsl:call-template>
"KRN",.84,7981018.002,2,66,0)
</xsl:if>
"KRN",.84,7981018.002,2,67,0)
<xsl:if test="$DOB_YES">
"KRN",.84,7981018.002,2,68,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981018.002,2,69,0)
     <xsl:with-param name="value" select="DOB"/>
"KRN",.84,7981018.002,2,70,0)
     <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981018.002,2,71,0)
   </xsl:call-template>
"KRN",.84,7981018.002,2,72,0)
</xsl:if>
"KRN",.84,7981018.002,2,73,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981018.002,2,74,0)
   <xsl:with-param name="value" select="$dod"/>
"KRN",.84,7981018.002,2,75,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981018.002,2,76,0)
</xsl:call-template>
"KRN",.84,7981018.002,2,77,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981018.002,2,78,0)
   <xsl:with-param name="value" select="BMIDATA/HEIGHT/DATE"/>
"KRN",.84,7981018.002,2,79,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981018.002,2,80,0)
</xsl:call-template>
"KRN",.84,7981018.002,2,81,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981018.002,2,82,0)
   <xsl:with-param name="value" select="BMIDATA/HEIGHT/RESULT"/>
"KRN",.84,7981018.002,2,83,0)
</xsl:call-template>
"KRN",.84,7981018.002,2,84,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981018.002,2,85,0)
   <xsl:with-param name="value" select="BMIDATA/WEIGHT/DATE"/>
"KRN",.84,7981018.002,2,86,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981018.002,2,87,0)
</xsl:call-template>
"KRN",.84,7981018.002,2,88,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981018.002,2,89,0)
   <xsl:with-param name="value" select="BMIDATA/WEIGHT/RESULT"/>
"KRN",.84,7981018.002,2,90,0)
</xsl:call-template>
"KRN",.84,7981018.002,2,91,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981018.002,2,92,0)
   <xsl:with-param name="value" select="BMI"/>
"KRN",.84,7981018.002,2,93,0)
</xsl:call-template>
"KRN",.84,7981018.002,2,94,0)
<xsl:if test="$ICN_YES">
"KRN",.84,7981018.002,2,95,0)
    <xsl:call-template name="TableCell">
"KRN",.84,7981018.002,2,96,0)
      <xsl:with-param name="value" select="ICN"/>
"KRN",.84,7981018.002,2,97,0)
    </xsl:call-template>
"KRN",.84,7981018.002,2,98,0)
</xsl:if>
"KRN",.84,7981018.002,2,99,0)
<xsl:if test="$PACT_YES">
"KRN",.84,7981018.002,2,100,0)
    <xsl:call-template name="TableCell">
"KRN",.84,7981018.002,2,101,0)
      <xsl:with-param name="value" select="PACT"/>
"KRN",.84,7981018.002,2,102,0)
    </xsl:call-template>
"KRN",.84,7981018.002,2,103,0)
</xsl:if>
"KRN",.84,7981018.002,2,104,0)
<xsl:if test="$PCP_YES">
"KRN",.84,7981018.002,2,105,0)
    <xsl:call-template name="TableCell">
"KRN",.84,7981018.002,2,106,0)
      <xsl:with-param name="value" select="PCP"/>
"KRN",.84,7981018.002,2,107,0)
    </xsl:call-template>
"KRN",.84,7981018.002,2,108,0)
</xsl:if>
"KRN",.84,7981018.002,2,109,0)
<xsl:value-of select="$CRLF"/>
"KRN",.84,7981018.002,2,110,0)
</xsl:template>
"KRN",.84,7981018.002,2,111,0)
 
"KRN",.84,7981018.002,2,112,0)
</xsl:stylesheet>
"KRN",.84,7981019.001,-1)
0^38
"KRN",.84,7981019.001,0)
7981019.001^2^^CLINICAL CASE REGISTRIES^Liver Report by Range (HTML)
"KRN",.84,7981019.001,2,0)
^^228^228^3170809^
"KRN",.84,7981019.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981019.001,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981019.001,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981019.001,2,4,0)
 
"KRN",.84,7981019.001,2,5,0)
<xsl:import  href="template://report/998/1"/>  <!-- Styles   -->
"KRN",.84,7981019.001,2,6,0)
<xsl:import  href="template://report/999/1"/>  <!-- Common   -->
"KRN",.84,7981019.001,2,7,0)
<xsl:include href="template://report/997/1"/>  <!-- Patients -->
"KRN",.84,7981019.001,2,8,0)
<xsl:include href="template://report/995/1"/>  <!-- Lab Data -->
"KRN",.84,7981019.001,2,9,0)
 
"KRN",.84,7981019.001,2,10,0)
<xsl:variable name="meldcnt" 
"KRN",.84,7981019.001,2,11,0)
select="count(/REPORT/HEADER/TBLDEF[@NAME='PATIENTS']/COLUMN[@NAME='MELD']
"KRN",.84,7981019.001,2,12,0)
)"/>
"KRN",.84,7981019.001,2,13,0)
<xsl:variable name="nacnt" 
"KRN",.84,7981019.001,2,14,0)
select="count(/REPORT/HEADER/TBLDEF[@NAME='PATIENTS']/COLUMN[@NAME='NA'])"
"KRN",.84,7981019.001,2,15,0)
/>
"KRN",.84,7981019.001,2,16,0)
<xsl:variable name="apricnt" 
"KRN",.84,7981019.001,2,17,0)
select="count(/REPORT/HEADER/TBLDEF[@NAME='PATIENTS']/COLUMN[@NAME='APRI']
"KRN",.84,7981019.001,2,18,0)
)"/>
"KRN",.84,7981019.001,2,19,0)
<xsl:variable name="fib4cnt" 
"KRN",.84,7981019.001,2,20,0)
select="count(/REPORT/HEADER/TBLDEF[@NAME='PATIENTS']/COLUMN[@NAME='FIB4']
"KRN",.84,7981019.001,2,21,0)
)"/>
"KRN",.84,7981019.001,2,22,0)
 
"KRN",.84,7981019.001,2,23,0)
<xsl:template match="/">
"KRN",.84,7981019.001,2,24,0)
<html>
"KRN",.84,7981019.001,2,25,0)
  <head>
"KRN",.84,7981019.001,2,26,0)
   <title>Liver Score by Range</title>
"KRN",.84,7981019.001,2,27,0)
  <xsl:call-template name="StyleSheet"/>
"KRN",.84,7981019.001,2,28,0)
  </head>
"KRN",.84,7981019.001,2,29,0)
  <body>
"KRN",.84,7981019.001,2,30,0)
   <h1>Liver Score by Range</h1>
"KRN",.84,7981019.001,2,31,0)
   <xsl:call-template name="ReportHeader"/>
"KRN",.84,7981019.001,2,32,0)
   <xsl:if test="count(/REPORT/PATIENTS/*) > 0">
"KRN",.84,7981019.001,2,33,0)
     <div style="margin:10; color: red; font-weight: bold">
"KRN",.84,7981019.001,2,34,0)
       Lab tests used to calculate scores are identified by LOINC code. 
"KRN",.84,7981019.001,2,35,0)
       If the values shown for test results appear unusual, contact your 
"KRN",.84,7981019.001,2,36,0)
local Lab ADPAC to verify that LOINC codes are set up 
"KRN",.84,7981019.001,2,37,0)
correctly. The LOINC codes that are used are:<br />
"KRN",.84,7981019.001,2,38,0)
       <br/>
"KRN",.84,7981019.001,2,39,0)
       <xsl:call-template name="ShowLOINCCodes"/>
"KRN",.84,7981019.001,2,40,0)
     </div>
"KRN",.84,7981019.001,2,41,0)
     <xsl:if test="$apricnt &gt; 0">
"KRN",.84,7981019.001,2,42,0)
       <div style="margin:10; color: red; font-weight: bold">
"KRN",.84,7981019.001,2,43,0)
         *For this report, the ULN AST entered by the user and used for 
"KRN",.84,7981019.001,2,44,0)
the APRI calculation is
"KRN",.84,7981019.001,2,45,0)
         <xsl:value-of select="/REPORT/PARAMETERS/ULNAST/@VALUES"/>
"KRN",.84,7981019.001,2,46,0)
       </div>
"KRN",.84,7981019.001,2,47,0)
     </xsl:if>
"KRN",.84,7981019.001,2,48,0)
     <xsl:if test="$meldcnt &gt; 0 or $nacnt &gt; 0">
"KRN",.84,7981019.001,2,49,0)
       <div style="margin:10; color: red; font-weight: bold">
"KRN",.84,7981019.001,2,50,0)
         *For this report, creatinine values &gt;12 mg/dL are assumed to 
"KRN",.84,7981019.001,2,51,0)
be 
"KRN",.84,7981019.001,2,52,0)
         erroneous and are ignored.  Sodium values &lt;100 or &gt;180 
"KRN",.84,7981019.001,2,53,0)
meq/L are also assumed to be erroneous and are ignored.
"KRN",.84,7981019.001,2,54,0)
       </div>
"KRN",.84,7981019.001,2,55,0)
     </xsl:if>
"KRN",.84,7981019.001,2,56,0)
     <br />
"KRN",.84,7981019.001,2,57,0)
     <!-- The following line changed to fix page break issue in IE 7 -->
"KRN",.84,7981019.001,2,58,0)
     <div style="page-break-after:always; font-size:1; margin:0; 
"KRN",.84,7981019.001,2,59,0)
border:0"><span style="visibility: hidden">-</span></div>
"KRN",.84,7981019.001,2,60,0)
     <div>
"KRN",.84,7981019.001,2,61,0)
       <xsl:call-template name="MakeScrollable">
"KRN",.84,7981019.001,2,62,0)
         <xsl:with-param name="condition" select="*[31]"/>
"KRN",.84,7981019.001,2,63,0)
       </xsl:call-template>
"KRN",.84,7981019.001,2,64,0)
       <xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981019.001,2,65,0)
     </div>
"KRN",.84,7981019.001,2,66,0)
     <xsl:call-template name="ExplainFormula"/>
"KRN",.84,7981019.001,2,67,0)
   </xsl:if>
"KRN",.84,7981019.001,2,68,0)
  </body>
"KRN",.84,7981019.001,2,69,0)
</html>
"KRN",.84,7981019.001,2,70,0)
</xsl:template>
"KRN",.84,7981019.001,2,71,0)
 
"KRN",.84,7981019.001,2,72,0)
<xsl:template name="ShowLOINCCodes">
"KRN",.84,7981019.001,2,73,0)
<xsl:param name="summary" select="/REPORT/LOINC_CODES"/>
"KRN",.84,7981019.001,2,74,0)
<table cellpadding="5" cellspacing="0">
"KRN",.84,7981019.001,2,75,0)
  <thead>
"KRN",.84,7981019.001,2,76,0)
   <tr>
"KRN",.84,7981019.001,2,77,0)
    <th>LOINC Codes</th>
"KRN",.84,7981019.001,2,78,0)
   </tr>
"KRN",.84,7981019.001,2,79,0)
  </thead>
"KRN",.84,7981019.001,2,80,0)
  <tbody>
"KRN",.84,7981019.001,2,81,0)
    <xsl:for-each select="/REPORT/LOINC_CODES/CODE">
"KRN",.84,7981019.001,2,82,0)
    <tr>
"KRN",.84,7981019.001,2,83,0)
      <td class="aLeft"><xsl:value-of select="@CODE"/></td>
"KRN",.84,7981019.001,2,84,0)
    </tr>
"KRN",.84,7981019.001,2,85,0)
   </xsl:for-each>
"KRN",.84,7981019.001,2,86,0)
  </tbody>
"KRN",.84,7981019.001,2,87,0)
</table>
"KRN",.84,7981019.001,2,88,0)
</xsl:template>
"KRN",.84,7981019.001,2,89,0)
 
"KRN",.84,7981019.001,2,90,0)
<xsl:template name="ExplainFormula">
"KRN",.84,7981019.001,2,91,0)
<br/>
"KRN",.84,7981019.001,2,92,0)
<div class="reportSummary">
"KRN",.84,7981019.001,2,93,0)
  <div style="float:left">
"KRN",.84,7981019.001,2,94,0)
   <table cellpadding="3" cellspacing="0">
"KRN",.84,7981019.001,2,95,0)
    <caption>Calculation Formulas</caption>
"KRN",.84,7981019.001,2,96,0)
    <thead>
"KRN",.84,7981019.001,2,97,0)
     <tr>
"KRN",.84,7981019.001,2,98,0)
      <th width="30">Description</th>
"KRN",.84,7981019.001,2,99,0)
      <th>Formula</th>
"KRN",.84,7981019.001,2,100,0)
     </tr>
"KRN",.84,7981019.001,2,101,0)
    </thead>
"KRN",.84,7981019.001,2,102,0)
    <tbody>
"KRN",.84,7981019.001,2,103,0)
     <xsl:if test="$apricnt &gt; 0">
"KRN",.84,7981019.001,2,104,0)
      <tr>
"KRN",.84,7981019.001,2,105,0)
       <td align="center">APRI (AST-to-Platelet ratio Index)</td>
"KRN",.84,7981019.001,2,106,0)
       <td class="aLeft"> ((AST/ULN AST)/Platelet) * 100
"KRN",.84,7981019.001,2,107,0)
       </td>
"KRN",.84,7981019.001,2,108,0)
      </tr>
"KRN",.84,7981019.001,2,109,0)
     </xsl:if>
"KRN",.84,7981019.001,2,110,0)
     <xsl:if test="$fib4cnt &gt; 0">
"KRN",.84,7981019.001,2,111,0)
      <tr>
"KRN",.84,7981019.001,2,112,0)
       <td align="center">FIB-4</td>
"KRN",.84,7981019.001,2,113,0)
       <td class="aLeft"> Age(in years) * AST/(Platelets * 
"KRN",.84,7981019.001,2,114,0)
ALT<sup>1/2</sup>)
"KRN",.84,7981019.001,2,115,0)
       </td>
"KRN",.84,7981019.001,2,116,0)
      </tr>
"KRN",.84,7981019.001,2,117,0)
     </xsl:if>
"KRN",.84,7981019.001,2,118,0)
     <xsl:if test="$nacnt &gt; 0 or $meldcnt &gt; 0">
"KRN",.84,7981019.001,2,119,0)
      <tr>
"KRN",.84,7981019.001,2,120,0)
       <td align="center">MELD</td>
"KRN",.84,7981019.001,2,121,0)
       <td class="aLeft"> (0.957*Ln(Serum Cr) + 0.378*Ln(Serum Bilirubin) 
"KRN",.84,7981019.001,2,122,0)
+ 1.120*Ln(INR) + 0.643) * 10<br/><br/>
"KRN",.84,7981019.001,2,123,0)
        <b>NOTES:</b>  Ln is 'natural log'<br/>
"KRN",.84,7981019.001,2,124,0)
      Lower limit of 1 for all variables with creatinine capped at 4
"KRN",.84,7981019.001,2,125,0)
       </td>
"KRN",.84,7981019.001,2,126,0)
      </tr>
"KRN",.84,7981019.001,2,127,0)
     </xsl:if>
"KRN",.84,7981019.001,2,128,0)
     <xsl:if test="$nacnt &gt; 0">
"KRN",.84,7981019.001,2,129,0)
    <tr>
"KRN",.84,7981019.001,2,130,0)
      <td align="center">MELD-Na</td>
"KRN",.84,7981019.001,2,131,0)
      <td class="aLeft">MELD calculation + 1.59 *(135 - Serum 
"KRN",.84,7981019.001,2,132,0)
Na)<br/><br/>
"KRN",.84,7981019.001,2,133,0)
       <b>NOTE:</b>  Mininum value for Serum Na is 120 mmol/L and the 
"KRN",.84,7981019.001,2,134,0)
maximum is 135 mmol/L      
"KRN",.84,7981019.001,2,135,0)
      </td>
"KRN",.84,7981019.001,2,136,0)
     </tr>
"KRN",.84,7981019.001,2,137,0)
     </xsl:if>
"KRN",.84,7981019.001,2,138,0)
    </tbody>
"KRN",.84,7981019.001,2,139,0)
   </table>
"KRN",.84,7981019.001,2,140,0)
  </div>
"KRN",.84,7981019.001,2,141,0)
</div>
"KRN",.84,7981019.001,2,142,0)
</xsl:template>
"KRN",.84,7981019.001,2,143,0)
 
"KRN",.84,7981019.001,2,144,0)
 
"KRN",.84,7981019.001,2,145,0)
<!--[ TABLE HEADERS ]-->
"KRN",.84,7981019.001,2,146,0)
 
"KRN",.84,7981019.001,2,147,0)
<xsl:template match="COLUMN[@NAME='TEST']">
"KRN",.84,7981019.001,2,148,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981019.001,2,149,0)
  <xsl:with-param name="title" select="'Test'"/>
"KRN",.84,7981019.001,2,150,0)
  <xsl:with-param name="sort" select="''"/>
"KRN",.84,7981019.001,2,151,0)
  <xsl:with-param name="width" select="'6%'"/>
"KRN",.84,7981019.001,2,152,0)
</xsl:call-template>
"KRN",.84,7981019.001,2,153,0)
</xsl:template>
"KRN",.84,7981019.001,2,154,0)
 
"KRN",.84,7981019.001,2,155,0)
<xsl:template match="COLUMN[@NAME='DATE']">
"KRN",.84,7981019.001,2,156,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981019.001,2,157,0)
  <xsl:with-param name="title" select="'Date'"/>
"KRN",.84,7981019.001,2,158,0)
  <xsl:with-param name="sort" select="''"/>
"KRN",.84,7981019.001,2,159,0)
  <xsl:with-param name="width" select="'8%'"/>
"KRN",.84,7981019.001,2,160,0)
</xsl:call-template>
"KRN",.84,7981019.001,2,161,0)
</xsl:template>
"KRN",.84,7981019.001,2,162,0)
 
"KRN",.84,7981019.001,2,163,0)
<xsl:template match="COLUMN[@NAME='RESULT']">
"KRN",.84,7981019.001,2,164,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981019.001,2,165,0)
  <xsl:with-param name="title" select="'Result'"/>
"KRN",.84,7981019.001,2,166,0)
  <xsl:with-param name="sort" select="''"/>
"KRN",.84,7981019.001,2,167,0)
  <xsl:with-param name="width" select="'4%'"/>
"KRN",.84,7981019.001,2,168,0)
</xsl:call-template>
"KRN",.84,7981019.001,2,169,0)
</xsl:template>
"KRN",.84,7981019.001,2,170,0)
 
"KRN",.84,7981019.001,2,171,0)
<xsl:template match="COLUMN[@NAME='MELD']">
"KRN",.84,7981019.001,2,172,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981019.001,2,173,0)
  <xsl:with-param name="sort" select="'PATIENTS=MELD'"/> 
"KRN",.84,7981019.001,2,174,0)
  <xsl:with-param name="width" select="'6%'"/>
"KRN",.84,7981019.001,2,175,0)
</xsl:call-template>
"KRN",.84,7981019.001,2,176,0)
</xsl:template>
"KRN",.84,7981019.001,2,177,0)
 
"KRN",.84,7981019.001,2,178,0)
<xsl:template match="COLUMN[@NAME='NA']">
"KRN",.84,7981019.001,2,179,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981019.001,2,180,0)
  <xsl:with-param name="title" select="'MELD-Na'"/>
"KRN",.84,7981019.001,2,181,0)
  <xsl:with-param name="sort" select="'PATIENTS=MELDNA'"/>
"KRN",.84,7981019.001,2,182,0)
  <xsl:with-param name="width" select="'8%'"/>
"KRN",.84,7981019.001,2,183,0)
</xsl:call-template>
"KRN",.84,7981019.001,2,184,0)
</xsl:template>
"KRN",.84,7981019.001,2,185,0)
 
"KRN",.84,7981019.001,2,186,0)
<!--[ TABLE CELLS ]-->
"KRN",.84,7981019.001,2,187,0)
 
"KRN",.84,7981019.001,2,188,0)
<xsl:template match="PATIENT/MELD">
"KRN",.84,7981019.001,2,189,0)
<xsl:param name="rowspan" select="0"/>
"KRN",.84,7981019.001,2,190,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981019.001,2,191,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981019.001,2,192,0)
</xsl:call-template>
"KRN",.84,7981019.001,2,193,0)
</xsl:template>
"KRN",.84,7981019.001,2,194,0)
 
"KRN",.84,7981019.001,2,195,0)
<xsl:template match="PATIENT/MELDNA">
"KRN",.84,7981019.001,2,196,0)
<xsl:param name="rowspan" select="0"/>
"KRN",.84,7981019.001,2,197,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981019.001,2,198,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981019.001,2,199,0)
</xsl:call-template>
"KRN",.84,7981019.001,2,200,0)
</xsl:template>
"KRN",.84,7981019.001,2,201,0)
 
"KRN",.84,7981019.001,2,202,0)
<xsl:template match="PATIENT/MELDDATA">
"KRN",.84,7981019.001,2,203,0)
<td class="aLeft">
"KRN",.84,7981019.001,2,204,0)
   <xsl:for-each select="TEST/TNAME">
"KRN",.84,7981019.001,2,205,0)
    <xsl:value-of select="."/><br/>
"KRN",.84,7981019.001,2,206,0)
   </xsl:for-each>
"KRN",.84,7981019.001,2,207,0)
</td>
"KRN",.84,7981019.001,2,208,0)
<td>
"KRN",.84,7981019.001,2,209,0)
   <xsl:for-each select="TEST/DATE">
"KRN",.84,7981019.001,2,210,0)
     <xsl:call-template name="CellValue">
"KRN",.84,7981019.001,2,211,0)
       <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981019.001,2,212,0)
       <xsl:with-param name="value" select="."/>
"KRN",.84,7981019.001,2,213,0)
       <xsl:with-param name="width" select="'6%'"/>
"KRN",.84,7981019.001,2,214,0)
     </xsl:call-template><br/>
"KRN",.84,7981019.001,2,215,0)
   </xsl:for-each>
"KRN",.84,7981019.001,2,216,0)
</td>
"KRN",.84,7981019.001,2,217,0)
<td class="aRight">
"KRN",.84,7981019.001,2,218,0)
   <xsl:for-each select="TEST/RESULT">
"KRN",.84,7981019.001,2,219,0)
     <xsl:call-template name="CellValue">
"KRN",.84,7981019.001,2,220,0)
       <xsl:with-param name="value" select="."/>
"KRN",.84,7981019.001,2,221,0)
       <xsl:with-param name="width" select="'6%'"/>
"KRN",.84,7981019.001,2,222,0)
     </xsl:call-template><br/>
"KRN",.84,7981019.001,2,223,0)
   </xsl:for-each>
"KRN",.84,7981019.001,2,224,0)
</td>
"KRN",.84,7981019.001,2,225,0)
 
"KRN",.84,7981019.001,2,226,0)
</xsl:template> 
"KRN",.84,7981019.001,2,227,0)
 
"KRN",.84,7981019.001,2,228,0)
</xsl:stylesheet>
"KRN",.84,7981019.002,-1)
0^7
"KRN",.84,7981019.002,0)
7981019.002^2^^CLINICAL CASE REGISTRIES^Liver Report by Range (CSV)
"KRN",.84,7981019.002,2,0)
^^111^111^3170809^
"KRN",.84,7981019.002,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981019.002,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981019.002,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981019.002,2,4,0)
 
"KRN",.84,7981019.002,2,5,0)
<xsl:import href="template://report/999/2"/>  <!-- Common -->
"KRN",.84,7981019.002,2,6,0)
 
"KRN",.84,7981019.002,2,7,0)
<xsl:template match="/">
"KRN",.84,7981019.002,2,8,0)
<xsl:text>Liver Score by Range</xsl:text>
"KRN",.84,7981019.002,2,9,0)
<xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981019.002,2,10,0)
</xsl:template>
"KRN",.84,7981019.002,2,11,0)
 
"KRN",.84,7981019.002,2,12,0)
<xsl:template match="PATIENTS/PATIENT">
"KRN",.84,7981019.002,2,13,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981019.002,2,14,0)
   <xsl:with-param name="value" select="NAME"/>
"KRN",.84,7981019.002,2,15,0)
</xsl:call-template>
"KRN",.84,7981019.002,2,16,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981019.002,2,17,0)
   <xsl:with-param name="value" select="LAST4"/>
"KRN",.84,7981019.002,2,18,0)
</xsl:call-template>
"KRN",.84,7981019.002,2,19,0)
<xsl:if test="$AGE_YES">
"KRN",.84,7981019.002,2,20,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981019.002,2,21,0)
     <xsl:with-param name="value" select="AGE"/>
"KRN",.84,7981019.002,2,22,0)
   </xsl:call-template>
"KRN",.84,7981019.002,2,23,0)
</xsl:if>
"KRN",.84,7981019.002,2,24,0)
<xsl:if test="$DOB_YES">
"KRN",.84,7981019.002,2,25,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981019.002,2,26,0)
     <xsl:with-param name="value" select="DOB"/>
"KRN",.84,7981019.002,2,27,0)
     <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981019.002,2,28,0)
   </xsl:call-template>
"KRN",.84,7981019.002,2,29,0)
</xsl:if>
"KRN",.84,7981019.002,2,30,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981019.002,2,31,0)
   <xsl:with-param name="value" select="DOD"/>
"KRN",.84,7981019.002,2,32,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981019.002,2,33,0)
</xsl:call-template>
"KRN",.84,7981019.002,2,34,0)
<xsl:for-each select="MELDDATA/TEST">
"KRN",.84,7981019.002,2,35,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981019.002,2,36,0)
    <xsl:with-param name="value" select="DATE"/>
"KRN",.84,7981019.002,2,37,0)
    <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981019.002,2,38,0)
  </xsl:call-template>
"KRN",.84,7981019.002,2,39,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981019.002,2,40,0)
    <xsl:with-param name="value" select="RESULT"/>
"KRN",.84,7981019.002,2,41,0)
  </xsl:call-template>
"KRN",.84,7981019.002,2,42,0)
</xsl:for-each>
"KRN",.84,7981019.002,2,43,0)
<xsl:if 
"KRN",.84,7981019.002,2,44,0)
test="count(/REPORT/HEADER/TBLDEF[@NAME='PATIENTS']/COLUMN[@NAME='MELD']) 
"KRN",.84,7981019.002,2,45,0)
> 0">
"KRN",.84,7981019.002,2,46,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981019.002,2,47,0)
    <xsl:with-param name="value" select="MELD"/>
"KRN",.84,7981019.002,2,48,0)
  </xsl:call-template>
"KRN",.84,7981019.002,2,49,0)
</xsl:if>
"KRN",.84,7981019.002,2,50,0)
<xsl:if 
"KRN",.84,7981019.002,2,51,0)
test="count(/REPORT/HEADER/TBLDEF[@NAME='PATIENTS']/COLUMN[@NAME='NA']) > 
"KRN",.84,7981019.002,2,52,0)
0">
"KRN",.84,7981019.002,2,53,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981019.002,2,54,0)
    <xsl:with-param name="value" select="MELDNA"/>
"KRN",.84,7981019.002,2,55,0)
  </xsl:call-template>
"KRN",.84,7981019.002,2,56,0)
</xsl:if>
"KRN",.84,7981019.002,2,57,0)
<xsl:if 
"KRN",.84,7981019.002,2,58,0)
test="count(/REPORT/HEADER/TBLDEF[@NAME='PATIENTS']/COLUMN[@NAME='APRI']) 
"KRN",.84,7981019.002,2,59,0)
> 0">
"KRN",.84,7981019.002,2,60,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981019.002,2,61,0)
    <xsl:with-param name="value" select="APRI"/>
"KRN",.84,7981019.002,2,62,0)
  </xsl:call-template>
"KRN",.84,7981019.002,2,63,0)
</xsl:if>
"KRN",.84,7981019.002,2,64,0)
<xsl:if 
"KRN",.84,7981019.002,2,65,0)
test="count(/REPORT/HEADER/TBLDEF[@NAME='PATIENTS']/COLUMN[@NAME='FIB4']) 
"KRN",.84,7981019.002,2,66,0)
> 0">
"KRN",.84,7981019.002,2,67,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981019.002,2,68,0)
    <xsl:with-param name="value" select="FIB4"/>
"KRN",.84,7981019.002,2,69,0)
  </xsl:call-template>
"KRN",.84,7981019.002,2,70,0)
</xsl:if>
"KRN",.84,7981019.002,2,71,0)
<xsl:if test="$ICN_YES">
"KRN",.84,7981019.002,2,72,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981019.002,2,73,0)
    <xsl:with-param name="value" select="ICN"/>
"KRN",.84,7981019.002,2,74,0)
  </xsl:call-template>
"KRN",.84,7981019.002,2,75,0)
</xsl:if>
"KRN",.84,7981019.002,2,76,0)
<xsl:if test="$PACT_YES">
"KRN",.84,7981019.002,2,77,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981019.002,2,78,0)
    <xsl:with-param name="value" select="PACT"/>
"KRN",.84,7981019.002,2,79,0)
  </xsl:call-template>
"KRN",.84,7981019.002,2,80,0)
</xsl:if>
"KRN",.84,7981019.002,2,81,0)
<xsl:if test="$PCP_YES">
"KRN",.84,7981019.002,2,82,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981019.002,2,83,0)
    <xsl:with-param name="value" select="PCP"/>
"KRN",.84,7981019.002,2,84,0)
  </xsl:call-template>
"KRN",.84,7981019.002,2,85,0)
</xsl:if>
"KRN",.84,7981019.002,2,86,0)
<xsl:value-of select="$CRLF"/>
"KRN",.84,7981019.002,2,87,0)
</xsl:template>
"KRN",.84,7981019.002,2,88,0)
 
"KRN",.84,7981019.002,2,89,0)
<xsl:template match="COLUMN[@NAME='TEST']">
"KRN",.84,7981019.002,2,90,0)
<xsl:for-each select="/REPORT/PATIENTS/PATIENT[1]/MELDDATA/TEST/TNAME">
"KRN",.84,7981019.002,2,91,0)
  <xsl:variable name="tname" select="."/>
"KRN",.84,7981019.002,2,92,0)
  <xsl:value-of select="concat($tname, ' Date', $DELIMITER)"/>
"KRN",.84,7981019.002,2,93,0)
  <xsl:value-of select="concat($tname, ' Result', $DELIMITER)"/>
"KRN",.84,7981019.002,2,94,0)
</xsl:for-each>
"KRN",.84,7981019.002,2,95,0)
</xsl:template>
"KRN",.84,7981019.002,2,96,0)
 
"KRN",.84,7981019.002,2,97,0)
<xsl:template match="COLUMN[@NAME='DATE']">
"KRN",.84,7981019.002,2,98,0)
<xsl:text></xsl:text>
"KRN",.84,7981019.002,2,99,0)
</xsl:template>
"KRN",.84,7981019.002,2,100,0)
 
"KRN",.84,7981019.002,2,101,0)
<xsl:template match="COLUMN[@NAME='RESULT']">
"KRN",.84,7981019.002,2,102,0)
<xsl:text></xsl:text>
"KRN",.84,7981019.002,2,103,0)
</xsl:template>
"KRN",.84,7981019.002,2,104,0)
 
"KRN",.84,7981019.002,2,105,0)
<xsl:template match="COLUMN[@NAME='NA']">
"KRN",.84,7981019.002,2,106,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981019.002,2,107,0)
  <xsl:with-param name="title" select="'MELD-Na'"/>
"KRN",.84,7981019.002,2,108,0)
</xsl:call-template>
"KRN",.84,7981019.002,2,109,0)
</xsl:template>
"KRN",.84,7981019.002,2,110,0)
 
"KRN",.84,7981019.002,2,111,0)
</xsl:stylesheet>
"KRN",.84,7981020.001,-1)
0^45
"KRN",.84,7981020.001,0)
7981020.001^2^^CLINICAL CASE REGISTRIES^Renal Function by Range (HTML)
"KRN",.84,7981020.001,2,0)
^^261^261^3170815^
"KRN",.84,7981020.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981020.001,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981020.001,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981020.001,2,4,0)
 
"KRN",.84,7981020.001,2,5,0)
<xsl:import  href="template://report/998/1"/>  <!-- Styles   -->
"KRN",.84,7981020.001,2,6,0)
<xsl:import  href="template://report/999/1"/>  <!-- Common   -->
"KRN",.84,7981020.001,2,7,0)
<xsl:include href="template://report/997/1"/>  <!-- Patients -->
"KRN",.84,7981020.001,2,8,0)
 
"KRN",.84,7981020.001,2,9,0)
<xsl:variable name="ckdcnt" 
"KRN",.84,7981020.001,2,10,0)
select="count(/REPORT/HEADER/TBLDEF[@NAME='PATIENTS']/COLUMN[@NAME='CKD'])
"KRN",.84,7981020.001,2,11,0)
"/> 
"KRN",.84,7981020.001,2,12,0)
<xsl:variable name="mdrdcnt" 
"KRN",.84,7981020.001,2,13,0)
select="count(/REPORT/HEADER/TBLDEF[@NAME='PATIENTS']/COLUMN[@NAME='MDRD']
"KRN",.84,7981020.001,2,14,0)
)"/> 
"KRN",.84,7981020.001,2,15,0)
 
"KRN",.84,7981020.001,2,16,0)
<xsl:template match="/">
"KRN",.84,7981020.001,2,17,0)
<html>
"KRN",.84,7981020.001,2,18,0)
  <head>
"KRN",.84,7981020.001,2,19,0)
   <title>Renal Function by Range</title>
"KRN",.84,7981020.001,2,20,0)
   <xsl:call-template name="StyleSheet"/>
"KRN",.84,7981020.001,2,21,0)
  </head>
"KRN",.84,7981020.001,2,22,0)
  <body>
"KRN",.84,7981020.001,2,23,0)
   <h1>Renal Function by Range</h1>
"KRN",.84,7981020.001,2,24,0)
   <xsl:call-template name="ReportHeader"/>
"KRN",.84,7981020.001,2,25,0)
   <xsl:if test="count(/REPORT/PATIENTS/*) > 0">
"KRN",.84,7981020.001,2,26,0)
    <div style="margin:10; color: red; font-weight: bold">
"KRN",.84,7981020.001,2,27,0)
       Lab tests used in calculations are identified by LOINC code. 
"KRN",.84,7981020.001,2,28,0)
       If the values shown for test results appear unusual, 
"KRN",.84,7981020.001,2,29,0)
contact your local Lab ADPAC to verify that LOINC codes are set up 
"KRN",.84,7981020.001,2,30,0)
correctly.  
"KRN",.84,7981020.001,2,31,0)
The LOINC codes that are used are:<br/>
"KRN",.84,7981020.001,2,32,0)
       <br/>
"KRN",.84,7981020.001,2,33,0)
       <xsl:call-template name="ShowLOINCCodes"/>
"KRN",.84,7981020.001,2,34,0)
    </div>
"KRN",.84,7981020.001,2,35,0)
    <div style="margin:10; color: red; font-weight: bold">
"KRN",.84,7981020.001,2,36,0)
       *For this report, creatinine values &gt;12 mg/dL are assumed to be 
"KRN",.84,7981020.001,2,37,0)
erroneous and are ignored.  Height values on the CrCL report that are
"KRN",.84,7981020.001,2,38,0)
&lt;36 inches or &gt;96 inches are also assumed to be erroneous and are 
"KRN",.84,7981020.001,2,39,0)
ignored.
"KRN",.84,7981020.001,2,40,0)
    </div>
"KRN",.84,7981020.001,2,41,0)
   </xsl:if>
"KRN",.84,7981020.001,2,42,0)
    <xsl:if test="$ckdcnt &gt; 0 or $mdrdcnt &gt; 0">
"KRN",.84,7981020.001,2,43,0)
     <xsl:call-template name="RenalReportSummary"/>
"KRN",.84,7981020.001,2,44,0)
    </xsl:if>
"KRN",.84,7981020.001,2,45,0)
   <xsl:if test="count(/REPORT/PATIENTS/*) > 0">
"KRN",.84,7981020.001,2,46,0)
     <br />
"KRN",.84,7981020.001,2,47,0)
     <!-- The following line added to fix page break issue in IE 7 -->
"KRN",.84,7981020.001,2,48,0)
     <div style="page-break-after:always; font-size:1; margin:0; 
"KRN",.84,7981020.001,2,49,0)
border:0"><span style="visibility: hidden">-</span></div>
"KRN",.84,7981020.001,2,50,0)
     <div>
"KRN",.84,7981020.001,2,51,0)
       <xsl:call-template name="MakeScrollable">
"KRN",.84,7981020.001,2,52,0)
         <xsl:with-param name="condition" select="*[31]"/>
"KRN",.84,7981020.001,2,53,0)
       </xsl:call-template>
"KRN",.84,7981020.001,2,54,0)
       <xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981020.001,2,55,0)
     </div>
"KRN",.84,7981020.001,2,56,0)
     <xsl:call-template name="ExplainFormula"/>
"KRN",.84,7981020.001,2,57,0)
   </xsl:if>
"KRN",.84,7981020.001,2,58,0)
  </body>
"KRN",.84,7981020.001,2,59,0)
</html>
"KRN",.84,7981020.001,2,60,0)
</xsl:template>
"KRN",.84,7981020.001,2,61,0)
 
"KRN",.84,7981020.001,2,62,0)
<xsl:template name="ShowLOINCCodes">
"KRN",.84,7981020.001,2,63,0)
<xsl:param name="summary" select="/REPORT/LOINC_CODES"/>
"KRN",.84,7981020.001,2,64,0)
<table cellpadding="5" cellspacing="0">
"KRN",.84,7981020.001,2,65,0)
  <thead>
"KRN",.84,7981020.001,2,66,0)
   <tr>
"KRN",.84,7981020.001,2,67,0)
    <th>LOINC Codes</th>
"KRN",.84,7981020.001,2,68,0)
   </tr>
"KRN",.84,7981020.001,2,69,0)
  </thead>
"KRN",.84,7981020.001,2,70,0)
  <tbody>
"KRN",.84,7981020.001,2,71,0)
    <xsl:for-each select="/REPORT/LOINC_CODES/CODE">
"KRN",.84,7981020.001,2,72,0)
    <tr>
"KRN",.84,7981020.001,2,73,0)
      <td class="aLeft"><xsl:value-of select="@CODE"/></td>
"KRN",.84,7981020.001,2,74,0)
    </tr>
"KRN",.84,7981020.001,2,75,0)
   </xsl:for-each>
"KRN",.84,7981020.001,2,76,0)
  </tbody>
"KRN",.84,7981020.001,2,77,0)
</table>
"KRN",.84,7981020.001,2,78,0)
</xsl:template>
"KRN",.84,7981020.001,2,79,0)
 
"KRN",.84,7981020.001,2,80,0)
<xsl:template name="RenalReportSummary">
"KRN",.84,7981020.001,2,81,0)
<xsl:param name="summary" select="/REPORT/SUMMARY"/>
"KRN",.84,7981020.001,2,82,0)
<table cellpadding="5" cellspacing="0">
"KRN",.84,7981020.001,2,83,0)
  <thead>
"KRN",.84,7981020.001,2,84,0)
   <tr>
"KRN",.84,7981020.001,2,85,0)
    <th>Chronic Kidney Disease Stages</th>
"KRN",.84,7981020.001,2,86,0)
    <th>GFR</th>
"KRN",.84,7981020.001,2,87,0)
    <xsl:if test="$mdrdcnt &gt; 0">
"KRN",.84,7981020.001,2,88,0)
      <th>Number of Patients<br/>by MDRD</th>
"KRN",.84,7981020.001,2,89,0)
    </xsl:if>
"KRN",.84,7981020.001,2,90,0)
    <xsl:if test="$ckdcnt &gt; 0">
"KRN",.84,7981020.001,2,91,0)
      <th>Number of Patients<br/>by CKD-EPI</th>
"KRN",.84,7981020.001,2,92,0)
    </xsl:if>
"KRN",.84,7981020.001,2,93,0)
   </tr>
"KRN",.84,7981020.001,2,94,0)
  </thead>
"KRN",.84,7981020.001,2,95,0)
  <tbody>
"KRN",.84,7981020.001,2,96,0)
    <xsl:for-each select="/REPORT/SUMMARY/DATA">
"KRN",.84,7981020.001,2,97,0)
    <tr>
"KRN",.84,7981020.001,2,98,0)
      <td class="aLeft"><xsl:value-of select="./DESC"/></td>
"KRN",.84,7981020.001,2,99,0)
      <td><xsl:value-of select="./VALUES"/><sup>2</sup></td>
"KRN",.84,7981020.001,2,100,0)
      <xsl:if test="$mdrdcnt &gt; 0">
"KRN",.84,7981020.001,2,101,0)
        <td><xsl:value-of select="./NPMDRD"/></td>
"KRN",.84,7981020.001,2,102,0)
      </xsl:if>
"KRN",.84,7981020.001,2,103,0)
      <xsl:if test="$ckdcnt &gt; 0">
"KRN",.84,7981020.001,2,104,0)
        <td><xsl:value-of select="./NPCKD"/></td>
"KRN",.84,7981020.001,2,105,0)
      </xsl:if>
"KRN",.84,7981020.001,2,106,0)
    </tr>
"KRN",.84,7981020.001,2,107,0)
   </xsl:for-each>
"KRN",.84,7981020.001,2,108,0)
  </tbody>
"KRN",.84,7981020.001,2,109,0)
</table>
"KRN",.84,7981020.001,2,110,0)
</xsl:template>
"KRN",.84,7981020.001,2,111,0)
 
"KRN",.84,7981020.001,2,112,0)
<xsl:template name="ExplainFormula">
"KRN",.84,7981020.001,2,113,0)
<br/>
"KRN",.84,7981020.001,2,114,0)
<div class="reportSummary">
"KRN",.84,7981020.001,2,115,0)
  <div style="float:left; width:80%">
"KRN",.84,7981020.001,2,116,0)
   <table cellpadding="3" cellspacing="0">
"KRN",.84,7981020.001,2,117,0)
    <caption>Calculation Formulas</caption>
"KRN",.84,7981020.001,2,118,0)
    <thead>
"KRN",.84,7981020.001,2,119,0)
     <tr>
"KRN",.84,7981020.001,2,120,0)
      <th width="60">Description</th>
"KRN",.84,7981020.001,2,121,0)
      <th>Formula</th>
"KRN",.84,7981020.001,2,122,0)
     </tr>
"KRN",.84,7981020.001,2,123,0)
    </thead>
"KRN",.84,7981020.001,2,124,0)
    <tbody>
"KRN",.84,7981020.001,2,125,0)
     <xsl:if 
"KRN",.84,7981020.001,2,126,0)
test="count(/REPORT/HEADER/TBLDEF[@NAME='PATIENTS']/COLUMN[@NAME='CRCL']) 
"KRN",.84,7981020.001,2,127,0)
> 0">
"KRN",.84,7981020.001,2,128,0)
     <tr>
"KRN",.84,7981020.001,2,129,0)
      <td align="center">Cockcroft-Gault</td>
"KRN",.84,7981020.001,2,130,0)
      <td class="aLeft"> (140-age) * ideal weight in kg (*.85 if 
"KRN",.84,7981020.001,2,131,0)
female)/(Cr*72)<br/><br/>
"KRN",.84,7981020.001,2,132,0)
       Ideal weight in kg calculated as:<br />
"KRN",.84,7981020.001,2,133,0)
       male = 51.65+(1.85*(height-60))<br/>
"KRN",.84,7981020.001,2,134,0)
       female = 48.67+(1.65*(height-60))
"KRN",.84,7981020.001,2,135,0)
      </td>
"KRN",.84,7981020.001,2,136,0)
     </tr>
"KRN",.84,7981020.001,2,137,0)
     </xsl:if>
"KRN",.84,7981020.001,2,138,0)
     <xsl:if test="$mdrdcnt &gt; 0">
"KRN",.84,7981020.001,2,139,0)
      <tr>
"KRN",.84,7981020.001,2,140,0)
       <td align="center">eGFR by MDRD</td>
"KRN",.84,7981020.001,2,141,0)
       <td class="aLeft"> 175 * (Cr<sup>-1.154</sup>) * 
"KRN",.84,7981020.001,2,142,0)
(age<sup>-.203</sup>) *1.212 (if Black) * .742 (if female)</td>
"KRN",.84,7981020.001,2,143,0)
      </tr>
"KRN",.84,7981020.001,2,144,0)
     </xsl:if>
"KRN",.84,7981020.001,2,145,0)
     <xsl:if test="$ckdcnt &gt; 0">
"KRN",.84,7981020.001,2,146,0)
      <tr>
"KRN",.84,7981020.001,2,147,0)
       <td align="center">eGFR by CKD-EPI</td>
"KRN",.84,7981020.001,2,148,0)
       <td class="aLeft"> 141 * min(Scr/k, 1)<sup>a</sup> * max(Scr/k, 
"KRN",.84,7981020.001,2,149,0)
1)<sup>-1.209</sup> * 0.993<sup>Age</sup> * 1.159 (if black) * 1.018 (if 
"KRN",.84,7981020.001,2,150,0)
female)</td>
"KRN",.84,7981020.001,2,151,0)
      </tr>
"KRN",.84,7981020.001,2,152,0)
     </xsl:if>
"KRN",.84,7981020.001,2,153,0)
    </tbody>
"KRN",.84,7981020.001,2,154,0)
   </table>
"KRN",.84,7981020.001,2,155,0)
  </div>
"KRN",.84,7981020.001,2,156,0)
</div>
"KRN",.84,7981020.001,2,157,0)
</xsl:template>
"KRN",.84,7981020.001,2,158,0)
 
"KRN",.84,7981020.001,2,159,0)
<!--[ TABLE HEADERS ]-->
"KRN",.84,7981020.001,2,160,0)
 
"KRN",.84,7981020.001,2,161,0)
<xsl:template match="COLUMN[@NAME='TEST']">
"KRN",.84,7981020.001,2,162,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981020.001,2,163,0)
  <xsl:with-param name="title" select="'Test'"/>
"KRN",.84,7981020.001,2,164,0)
  <xsl:with-param name="sort" select="''"/>
"KRN",.84,7981020.001,2,165,0)
  <xsl:with-param name="width" select="'6%'"/>
"KRN",.84,7981020.001,2,166,0)
</xsl:call-template>
"KRN",.84,7981020.001,2,167,0)
</xsl:template>
"KRN",.84,7981020.001,2,168,0)
 
"KRN",.84,7981020.001,2,169,0)
<xsl:template match="COLUMN[@NAME='DATE']">
"KRN",.84,7981020.001,2,170,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981020.001,2,171,0)
  <xsl:with-param name="title" select="'Date'"/>
"KRN",.84,7981020.001,2,172,0)
  <xsl:with-param name="sort" select="''"/>
"KRN",.84,7981020.001,2,173,0)
  <xsl:with-param name="width" select="'8%'"/>
"KRN",.84,7981020.001,2,174,0)
</xsl:call-template>
"KRN",.84,7981020.001,2,175,0)
</xsl:template>
"KRN",.84,7981020.001,2,176,0)
 
"KRN",.84,7981020.001,2,177,0)
<xsl:template match="COLUMN[@NAME='RESULT']">
"KRN",.84,7981020.001,2,178,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981020.001,2,179,0)
  <xsl:with-param name="title" select="'Result'"/>
"KRN",.84,7981020.001,2,180,0)
  <xsl:with-param name="sort" select="''"/>
"KRN",.84,7981020.001,2,181,0)
  <xsl:with-param name="width" select="'4%'"/>
"KRN",.84,7981020.001,2,182,0)
</xsl:call-template>
"KRN",.84,7981020.001,2,183,0)
</xsl:template>
"KRN",.84,7981020.001,2,184,0)
 
"KRN",.84,7981020.001,2,185,0)
<xsl:template match="COLUMN[@NAME='CRCL']">
"KRN",.84,7981020.001,2,186,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981020.001,2,187,0)
  <xsl:with-param name="title" select="'CrCL'"/>
"KRN",.84,7981020.001,2,188,0)
  <xsl:with-param name="sort" select="'PATIENTS=CRCL'"/>
"KRN",.84,7981020.001,2,189,0)
  <xsl:with-param name="width" select="'6%'"/>
"KRN",.84,7981020.001,2,190,0)
</xsl:call-template>
"KRN",.84,7981020.001,2,191,0)
</xsl:template>
"KRN",.84,7981020.001,2,192,0)
 
"KRN",.84,7981020.001,2,193,0)
<xsl:template match="COLUMN[@NAME='MDRD']">
"KRN",.84,7981020.001,2,194,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981020.001,2,195,0)
  <xsl:with-param name="title" select="'MDRD'"/>
"KRN",.84,7981020.001,2,196,0)
  <xsl:with-param name="sort" select="'PATIENTS=MDRD'"/>
"KRN",.84,7981020.001,2,197,0)
  <xsl:with-param name="width" select="'6%'"/>
"KRN",.84,7981020.001,2,198,0)
</xsl:call-template>
"KRN",.84,7981020.001,2,199,0)
</xsl:template>
"KRN",.84,7981020.001,2,200,0)
 
"KRN",.84,7981020.001,2,201,0)
<xsl:template match="COLUMN[@NAME='CKD']">
"KRN",.84,7981020.001,2,202,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981020.001,2,203,0)
  <xsl:with-param name="title" select="'CKD-EPI'"/>
"KRN",.84,7981020.001,2,204,0)
  <xsl:with-param name="sort" select="'PATIENTS=CKD'"/>
"KRN",.84,7981020.001,2,205,0)
  <xsl:with-param name="width" select="'6%'"/>
"KRN",.84,7981020.001,2,206,0)
</xsl:call-template>
"KRN",.84,7981020.001,2,207,0)
</xsl:template>
"KRN",.84,7981020.001,2,208,0)
 
"KRN",.84,7981020.001,2,209,0)
 <!--[ TABLE CELLS ]-->
"KRN",.84,7981020.001,2,210,0)
 
"KRN",.84,7981020.001,2,211,0)
<xsl:template match="PATIENT/CRCL">
"KRN",.84,7981020.001,2,212,0)
  <xsl:param name="rowspan" select="0"/>
"KRN",.84,7981020.001,2,213,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981020.001,2,214,0)
    <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981020.001,2,215,0)
  </xsl:call-template>
"KRN",.84,7981020.001,2,216,0)
</xsl:template>
"KRN",.84,7981020.001,2,217,0)
 
"KRN",.84,7981020.001,2,218,0)
<xsl:template match="PATIENT/EGFR">
"KRN",.84,7981020.001,2,219,0)
  <xsl:param name="rowspan" select="0"/>
"KRN",.84,7981020.001,2,220,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981020.001,2,221,0)
    <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981020.001,2,222,0)
  </xsl:call-template>
"KRN",.84,7981020.001,2,223,0)
</xsl:template>
"KRN",.84,7981020.001,2,224,0)
 
"KRN",.84,7981020.001,2,225,0)
<xsl:template match="PATIENT/RNLDATA">
"KRN",.84,7981020.001,2,226,0)
<xsl:variable name="CRCL" 
"KRN",.84,7981020.001,2,227,0)
select="count(/REPORT/HEADER/TBLDEF[@NAME='PATIENTS']/COLUMN[@NAME='CRCL']
"KRN",.84,7981020.001,2,228,0)
)"/>
"KRN",.84,7981020.001,2,229,0)
<td class="aLeft">
"KRN",.84,7981020.001,2,230,0)
   <xsl:text>Cr</xsl:text>
"KRN",.84,7981020.001,2,231,0)
   <xsl:if test="$CRCL>0">
"KRN",.84,7981020.001,2,232,0)
    <br/><xsl:text>Height</xsl:text>
"KRN",.84,7981020.001,2,233,0)
   </xsl:if>
"KRN",.84,7981020.001,2,234,0)
</td>
"KRN",.84,7981020.001,2,235,0)
<td>
"KRN",.84,7981020.001,2,236,0)
   <xsl:call-template name="CellValue">
"KRN",.84,7981020.001,2,237,0)
     <xsl:with-param name="value" select="TEST/DATE"/>
"KRN",.84,7981020.001,2,238,0)
     <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981020.001,2,239,0)
   </xsl:call-template>
"KRN",.84,7981020.001,2,240,0)
   <xsl:if test="$CRCL>0">
"KRN",.84,7981020.001,2,241,0)
     <br/>
"KRN",.84,7981020.001,2,242,0)
     <xsl:call-template name="CellValue">
"KRN",.84,7981020.001,2,243,0)
       <xsl:with-param name="value" select="HEIGHT/DATE"/>
"KRN",.84,7981020.001,2,244,0)
       <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981020.001,2,245,0)
     </xsl:call-template>
"KRN",.84,7981020.001,2,246,0)
   </xsl:if>
"KRN",.84,7981020.001,2,247,0)
</td>
"KRN",.84,7981020.001,2,248,0)
<td class="aRight">
"KRN",.84,7981020.001,2,249,0)
   <xsl:call-template name="CellValue">
"KRN",.84,7981020.001,2,250,0)
     <xsl:with-param name="value" select="TEST/RESULT"/>
"KRN",.84,7981020.001,2,251,0)
   </xsl:call-template>
"KRN",.84,7981020.001,2,252,0)
   <xsl:if test="$CRCL>0">
"KRN",.84,7981020.001,2,253,0)
     <br/>
"KRN",.84,7981020.001,2,254,0)
     <xsl:call-template name="CellValue">
"KRN",.84,7981020.001,2,255,0)
       <xsl:with-param name="value" select="HEIGHT/RESULT"/>
"KRN",.84,7981020.001,2,256,0)
     </xsl:call-template>
"KRN",.84,7981020.001,2,257,0)
   </xsl:if>
"KRN",.84,7981020.001,2,258,0)
</td>
"KRN",.84,7981020.001,2,259,0)
</xsl:template>
"KRN",.84,7981020.001,2,260,0)
 
"KRN",.84,7981020.001,2,261,0)
</xsl:stylesheet>
"KRN",.84,7981020.001,3,0)
^.845A
"KRN",.84,7981020.002,-1)
0^6
"KRN",.84,7981020.002,0)
7981020.002^2^^CLINICAL CASE REGISTRIES^Renal Function by Range (CSV)
"KRN",.84,7981020.002,2,0)
^^168^168^3170815^
"KRN",.84,7981020.002,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981020.002,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981020.002,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981020.002,2,4,0)
 
"KRN",.84,7981020.002,2,5,0)
<xsl:import href="template://report/999/2"/>  <!-- Common -->
"KRN",.84,7981020.002,2,6,0)
 
"KRN",.84,7981020.002,2,7,0)
<xsl:variable name="CRCLUSED" 
"KRN",.84,7981020.002,2,8,0)
select="count(/REPORT/HEADER/TBLDEF[@NAME='PATIENTS']/COLUMN[@NAME='CRCL']
"KRN",.84,7981020.002,2,9,0)
)"/>
"KRN",.84,7981020.002,2,10,0)
<xsl:variable name="CKDUSED"  
"KRN",.84,7981020.002,2,11,0)
select="count(/REPORT/HEADER/TBLDEF[@NAME='PATIENTS']/COLUMN[@NAME='CKD'])
"KRN",.84,7981020.002,2,12,0)
"/>
"KRN",.84,7981020.002,2,13,0)
<xsl:variable name="MDRDUSED" 
"KRN",.84,7981020.002,2,14,0)
select="count(/REPORT/HEADER/TBLDEF[@NAME='PATIENTS']/COLUMN[@NAME='MDRD']
"KRN",.84,7981020.002,2,15,0)
)"/>
"KRN",.84,7981020.002,2,16,0)
 
"KRN",.84,7981020.002,2,17,0)
<xsl:template match="/">
"KRN",.84,7981020.002,2,18,0)
  <xsl:if test="$CKDUSED &gt; 0 or $MDRDUSED &gt; 0">
"KRN",.84,7981020.002,2,19,0)
    <xsl:call-template name="RenalReportSummary"/>
"KRN",.84,7981020.002,2,20,0)
  </xsl:if>
"KRN",.84,7981020.002,2,21,0)
  <xsl:text>Renal Function by Range</xsl:text>
"KRN",.84,7981020.002,2,22,0)
  <xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981020.002,2,23,0)
</xsl:template>
"KRN",.84,7981020.002,2,24,0)
 
"KRN",.84,7981020.002,2,25,0)
<xsl:template name="RenalReportSummary">
"KRN",.84,7981020.002,2,26,0)
<xsl:param name="summary" select="/REPORT/SUMMARY"/>
"KRN",.84,7981020.002,2,27,0)
<xsl:text>Renal Function by Range (Summary)</xsl:text>
"KRN",.84,7981020.002,2,28,0)
<xsl:value-of select="$CRLF"/>
"KRN",.84,7981020.002,2,29,0)
<xsl:text>Chronic Kidney Disease Stages</xsl:text>
"KRN",.84,7981020.002,2,30,0)
<xsl:value-of select="$DELIMITER"/>
"KRN",.84,7981020.002,2,31,0)
<xsl:text>GFR</xsl:text>
"KRN",.84,7981020.002,2,32,0)
<xsl:if test="$MDRDUSED &gt; 0">
"KRN",.84,7981020.002,2,33,0)
   <xsl:value-of select="$DELIMITER"/>
"KRN",.84,7981020.002,2,34,0)
   <xsl:text>Number of Patients by MDRD</xsl:text>
"KRN",.84,7981020.002,2,35,0)
</xsl:if>
"KRN",.84,7981020.002,2,36,0)
<xsl:if test="$CKDUSED &gt; 0">
"KRN",.84,7981020.002,2,37,0)
   <xsl:value-of select="$DELIMITER"/>
"KRN",.84,7981020.002,2,38,0)
   <xsl:text>Number of Patients by CKD-EPI</xsl:text>
"KRN",.84,7981020.002,2,39,0)
</xsl:if>
"KRN",.84,7981020.002,2,40,0)
<xsl:value-of select="$CRLF"/>
"KRN",.84,7981020.002,2,41,0)
<xsl:for-each select="/REPORT/SUMMARY/DATA">
"KRN",.84,7981020.002,2,42,0)
   <xsl:value-of select="./DESC"/>
"KRN",.84,7981020.002,2,43,0)
   <xsl:value-of select="$DELIMITER"/>
"KRN",.84,7981020.002,2,44,0)
   <xsl:value-of select="./VALUES"/>
"KRN",.84,7981020.002,2,45,0)
   <xsl:text> sq</xsl:text>
"KRN",.84,7981020.002,2,46,0)
   <xsl:if test="$MDRDUSED &gt; 0">
"KRN",.84,7981020.002,2,47,0)
     <xsl:value-of select="$DELIMITER"/>
"KRN",.84,7981020.002,2,48,0)
     <xsl:value-of select="./NPMDRD"/>
"KRN",.84,7981020.002,2,49,0)
  </xsl:if>
"KRN",.84,7981020.002,2,50,0)
   <xsl:if test="$CKDUSED &gt; 0">
"KRN",.84,7981020.002,2,51,0)
     <xsl:value-of select="$DELIMITER"/>
"KRN",.84,7981020.002,2,52,0)
     <xsl:value-of select="./NPCKD"/>
"KRN",.84,7981020.002,2,53,0)
   </xsl:if>
"KRN",.84,7981020.002,2,54,0)
   <xsl:value-of select="$CRLF"/>
"KRN",.84,7981020.002,2,55,0)
</xsl:for-each>
"KRN",.84,7981020.002,2,56,0)
<!-- xsl:value-of select="$FILESWITCH"/ -->
"KRN",.84,7981020.002,2,57,0)
</xsl:template>
"KRN",.84,7981020.002,2,58,0)
 
"KRN",.84,7981020.002,2,59,0)
 <xsl:template match="COLUMN[@NAME='TEST']">
"KRN",.84,7981020.002,2,60,0)
  <xsl:value-of select="''"/>
"KRN",.84,7981020.002,2,61,0)
</xsl:template>
"KRN",.84,7981020.002,2,62,0)
 
"KRN",.84,7981020.002,2,63,0)
 <xsl:template match="COLUMN[@NAME='DATE']">
"KRN",.84,7981020.002,2,64,0)
  <xsl:value-of select="'Cr Date'"/>
"KRN",.84,7981020.002,2,65,0)
  <xsl:value-of select="$DELIMITER"/>
"KRN",.84,7981020.002,2,66,0)
  <xsl:value-of select="'Cr'"/>
"KRN",.84,7981020.002,2,67,0)
  <xsl:value-of select="$DELIMITER"/>
"KRN",.84,7981020.002,2,68,0)
</xsl:template>
"KRN",.84,7981020.002,2,69,0)
 
"KRN",.84,7981020.002,2,70,0)
 <xsl:template match="COLUMN[@NAME='RESULT']">
"KRN",.84,7981020.002,2,71,0)
  <xsl:if test="$CRCLUSED > 0">
"KRN",.84,7981020.002,2,72,0)
    <xsl:value-of select="'Height Date'"/>
"KRN",.84,7981020.002,2,73,0)
    <xsl:value-of select="$DELIMITER"/>
"KRN",.84,7981020.002,2,74,0)
    <xsl:value-of select="'Height'"/>
"KRN",.84,7981020.002,2,75,0)
    <xsl:value-of select="$DELIMITER"/>
"KRN",.84,7981020.002,2,76,0)
  </xsl:if>
"KRN",.84,7981020.002,2,77,0)
</xsl:template>
"KRN",.84,7981020.002,2,78,0)
 
"KRN",.84,7981020.002,2,79,0)
<xsl:template match="COLUMN[@NAME='CRCL']">
"KRN",.84,7981020.002,2,80,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981020.002,2,81,0)
  <xsl:with-param name="title" select="'CrCL'"/>
"KRN",.84,7981020.002,2,82,0)
</xsl:call-template>
"KRN",.84,7981020.002,2,83,0)
</xsl:template>
"KRN",.84,7981020.002,2,84,0)
 
"KRN",.84,7981020.002,2,85,0)
<xsl:template match="COLUMN[@NAME='MDRD']">
"KRN",.84,7981020.002,2,86,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981020.002,2,87,0)
  <xsl:with-param name="title" select="'MDRD'"/>
"KRN",.84,7981020.002,2,88,0)
</xsl:call-template>
"KRN",.84,7981020.002,2,89,0)
</xsl:template>
"KRN",.84,7981020.002,2,90,0)
 
"KRN",.84,7981020.002,2,91,0)
<xsl:template match="COLUMN[@NAME='CKD']">
"KRN",.84,7981020.002,2,92,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981020.002,2,93,0)
  <xsl:with-param name="title" select="'CKD-EPI'"/>
"KRN",.84,7981020.002,2,94,0)
</xsl:call-template>
"KRN",.84,7981020.002,2,95,0)
</xsl:template>
"KRN",.84,7981020.002,2,96,0)
 
"KRN",.84,7981020.002,2,97,0)
<xsl:template match="PATIENTS/PATIENT">
"KRN",.84,7981020.002,2,98,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981020.002,2,99,0)
   <xsl:with-param name="value" select="NAME"/>
"KRN",.84,7981020.002,2,100,0)
  </xsl:call-template>
"KRN",.84,7981020.002,2,101,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981020.002,2,102,0)
   <xsl:with-param name="value" select="LAST4"/>
"KRN",.84,7981020.002,2,103,0)
  </xsl:call-template>
"KRN",.84,7981020.002,2,104,0)
  <xsl:if test="$AGE_YES">
"KRN",.84,7981020.002,2,105,0)
    <xsl:call-template name="TableCell">
"KRN",.84,7981020.002,2,106,0)
      <xsl:with-param name="value" select="AGE"/>
"KRN",.84,7981020.002,2,107,0)
    </xsl:call-template>
"KRN",.84,7981020.002,2,108,0)
  </xsl:if>
"KRN",.84,7981020.002,2,109,0)
  <xsl:if test="$DOB_YES">
"KRN",.84,7981020.002,2,110,0)
    <xsl:call-template name="TableCell">
"KRN",.84,7981020.002,2,111,0)
      <xsl:with-param name="value" select="DOB"/>
"KRN",.84,7981020.002,2,112,0)
      <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981020.002,2,113,0)
    </xsl:call-template>
"KRN",.84,7981020.002,2,114,0)
  </xsl:if>
"KRN",.84,7981020.002,2,115,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981020.002,2,116,0)
   <xsl:with-param name="value" select="DOD"/>
"KRN",.84,7981020.002,2,117,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981020.002,2,118,0)
  </xsl:call-template>
"KRN",.84,7981020.002,2,119,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981020.002,2,120,0)
   <xsl:with-param name="value" select="RNLDATA/TEST/DATE"/>
"KRN",.84,7981020.002,2,121,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981020.002,2,122,0)
  </xsl:call-template>
"KRN",.84,7981020.002,2,123,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981020.002,2,124,0)
    <xsl:with-param name="value" select="RNLDATA/TEST/RESULT"/>
"KRN",.84,7981020.002,2,125,0)
  </xsl:call-template>
"KRN",.84,7981020.002,2,126,0)
  <xsl:if test="$CRCLUSED > 0">
"KRN",.84,7981020.002,2,127,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981020.002,2,128,0)
     <xsl:with-param name="value" select="RNLDATA/HEIGHT/DATE"/>
"KRN",.84,7981020.002,2,129,0)
     <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981020.002,2,130,0)
   </xsl:call-template>
"KRN",.84,7981020.002,2,131,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981020.002,2,132,0)
     <xsl:with-param name="value" select="RNLDATA/HEIGHT/RESULT"/>
"KRN",.84,7981020.002,2,133,0)
   </xsl:call-template>
"KRN",.84,7981020.002,2,134,0)
  </xsl:if>
"KRN",.84,7981020.002,2,135,0)
  <xsl:if test="$CRCLUSED > 0">
"KRN",.84,7981020.002,2,136,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981020.002,2,137,0)
     <xsl:with-param name="value" select="CRCL"/>
"KRN",.84,7981020.002,2,138,0)
    </xsl:call-template>
"KRN",.84,7981020.002,2,139,0)
  </xsl:if>
"KRN",.84,7981020.002,2,140,0)
  <xsl:if test="$MDRDUSED > 0">
"KRN",.84,7981020.002,2,141,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981020.002,2,142,0)
     <xsl:with-param name="value" select="MDRD"/>
"KRN",.84,7981020.002,2,143,0)
    </xsl:call-template>
"KRN",.84,7981020.002,2,144,0)
  </xsl:if>
"KRN",.84,7981020.002,2,145,0)
  <xsl:if test="$CKDUSED > 0">
"KRN",.84,7981020.002,2,146,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981020.002,2,147,0)
     <xsl:with-param name="value" select="CKD"/>
"KRN",.84,7981020.002,2,148,0)
    </xsl:call-template>
"KRN",.84,7981020.002,2,149,0)
  </xsl:if>
"KRN",.84,7981020.002,2,150,0)
  <xsl:if test="$ICN_YES">
"KRN",.84,7981020.002,2,151,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981020.002,2,152,0)
     <xsl:with-param name="value" select="ICN"/>
"KRN",.84,7981020.002,2,153,0)
    </xsl:call-template>
"KRN",.84,7981020.002,2,154,0)
  </xsl:if>
"KRN",.84,7981020.002,2,155,0)
  <xsl:if test="$PACT_YES">
"KRN",.84,7981020.002,2,156,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981020.002,2,157,0)
     <xsl:with-param name="value" select="PACT"/>
"KRN",.84,7981020.002,2,158,0)
    </xsl:call-template>
"KRN",.84,7981020.002,2,159,0)
  </xsl:if>
"KRN",.84,7981020.002,2,160,0)
  <xsl:if test="$PCP_YES">
"KRN",.84,7981020.002,2,161,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981020.002,2,162,0)
     <xsl:with-param name="value" select="PCP"/>
"KRN",.84,7981020.002,2,163,0)
    </xsl:call-template>
"KRN",.84,7981020.002,2,164,0)
  </xsl:if>
"KRN",.84,7981020.002,2,165,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981020.002,2,166,0)
</xsl:template>
"KRN",.84,7981020.002,2,167,0)
 
"KRN",.84,7981020.002,2,168,0)
</xsl:stylesheet>
"KRN",.84,7981021.001,-1)
0^43
"KRN",.84,7981021.001,0)
7981021.001^2^^CLINICAL CASE REGISTRIES^Potential DAA Candidates (HTML)
"KRN",.84,7981021.001,2,0)
^^93^93^3170810^
"KRN",.84,7981021.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981021.001,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981021.001,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981021.001,2,4,0)
  
"KRN",.84,7981021.001,2,5,0)
<xsl:import  href="template://report/998/1"/>  <!-- Styles   -->
"KRN",.84,7981021.001,2,6,0)
<xsl:import  href="template://report/999/1"/>  <!-- Common   -->
"KRN",.84,7981021.001,2,7,0)
<xsl:include href="template://report/997/1"/>  <!-- Patients -->
"KRN",.84,7981021.001,2,8,0)
  
"KRN",.84,7981021.001,2,9,0)
<xsl:template match="/">
"KRN",.84,7981021.001,2,10,0)
  <html>
"KRN",.84,7981021.001,2,11,0)
   <head>
"KRN",.84,7981021.001,2,12,0)
    <title>Potential DAA Candidates</title>
"KRN",.84,7981021.001,2,13,0)
    <xsl:call-template name="StyleSheet"/>
"KRN",.84,7981021.001,2,14,0)
   </head>
"KRN",.84,7981021.001,2,15,0)
   <body>
"KRN",.84,7981021.001,2,16,0)
    <h1>Potential DAA Candidates</h1>
"KRN",.84,7981021.001,2,17,0)
    <xsl:call-template name="ReportHeader"/>
"KRN",.84,7981021.001,2,18,0)
    <xsl:if test="/REPORT/PARAMETERS/TREATMENT_HISTORY/@EXP_DAYS != ''">
"KRN",.84,7981021.001,2,19,0)
       <div style="margin:10; color: red; font-weight: bold">
"KRN",.84,7981021.001,2,20,0)
        *For this report, patients with HCV antiviral treatment within 
"KRN",.84,7981021.001,2,21,0)
the last 
"KRN",.84,7981021.001,2,22,0)
 <xsl:value-of select="/REPORT/PARAMETERS/TREATMENT_HISTORY/@EXP_DAYS"/> 
"KRN",.84,7981021.001,2,23,0)
 days have been excluded.
"KRN",.84,7981021.001,2,24,0)
       </div>
"KRN",.84,7981021.001,2,25,0)
    </xsl:if>
"KRN",.84,7981021.001,2,26,0)
    <br />
"KRN",.84,7981021.001,2,27,0)
    <!-- The following line added to fix page break issue in IE 7 -->
"KRN",.84,7981021.001,2,28,0)
    <div style="page-break-after:always; font-size:1; margin:0; 
"KRN",.84,7981021.001,2,29,0)
border:0"><span style="visibility: hidden">-</span></div>
"KRN",.84,7981021.001,2,30,0)
    <div>
"KRN",.84,7981021.001,2,31,0)
       <xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981021.001,2,32,0)
    </div>
"KRN",.84,7981021.001,2,33,0)
   </body>
"KRN",.84,7981021.001,2,34,0)
  </html>
"KRN",.84,7981021.001,2,35,0)
</xsl:template>
"KRN",.84,7981021.001,2,36,0)
  
"KRN",.84,7981021.001,2,37,0)
 <!--[ TABLE HEADERS ]-->
"KRN",.84,7981021.001,2,38,0)
   
"KRN",.84,7981021.001,2,39,0)
 <xsl:template match="COLUMN[@NAME='HCV_DATE']">
"KRN",.84,7981021.001,2,40,0)
  <xsl:call-template name="ColumnHeader">
"KRN",.84,7981021.001,2,41,0)
   <xsl:with-param name="title" select="'Most Recent HCV RNA Date'"/>
"KRN",.84,7981021.001,2,42,0)
   <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981021.001,2,43,0)
  </xsl:call-template>
"KRN",.84,7981021.001,2,44,0)
</xsl:template>
"KRN",.84,7981021.001,2,45,0)
  
"KRN",.84,7981021.001,2,46,0)
 <xsl:template match="COLUMN[@NAME='HCV']">
"KRN",.84,7981021.001,2,47,0)
  <xsl:call-template name="ColumnHeader">
"KRN",.84,7981021.001,2,48,0)
   <xsl:with-param name="title" select="'Most Recent HCV RNA'"/>
"KRN",.84,7981021.001,2,49,0)
   <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981021.001,2,50,0)
  </xsl:call-template>
"KRN",.84,7981021.001,2,51,0)
</xsl:template>
"KRN",.84,7981021.001,2,52,0)
  
"KRN",.84,7981021.001,2,53,0)
 <xsl:template match="COLUMN[@NAME='GT']">
"KRN",.84,7981021.001,2,54,0)
  <xsl:call-template name="ColumnHeader">
"KRN",.84,7981021.001,2,55,0)
   <xsl:with-param name="title" select="'Most Recent GT'"/>
"KRN",.84,7981021.001,2,56,0)
   <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981021.001,2,57,0)
  </xsl:call-template>
"KRN",.84,7981021.001,2,58,0)
</xsl:template>
"KRN",.84,7981021.001,2,59,0)
  
"KRN",.84,7981021.001,2,60,0)
 <xsl:template match="COLUMN[@NAME='FILL_DATE']">
"KRN",.84,7981021.001,2,61,0)
  <xsl:call-template name="ColumnHeader">
"KRN",.84,7981021.001,2,62,0)
   <xsl:with-param name="title" select="'Most Recent Fill Date'"/>
"KRN",.84,7981021.001,2,63,0)
   <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981021.001,2,64,0)
</xsl:call-template>
"KRN",.84,7981021.001,2,65,0)
</xsl:template>
"KRN",.84,7981021.001,2,66,0)
  
"KRN",.84,7981021.001,2,67,0)
 <xsl:template match="COLUMN[@NAME='FILL_MED']">
"KRN",.84,7981021.001,2,68,0)
  <xsl:call-template name="ColumnHeader">
"KRN",.84,7981021.001,2,69,0)
   <xsl:with-param name="title" select="'Most Recent HCV Medication 
"KRN",.84,7981021.001,2,70,0)
Fill'"/>
"KRN",.84,7981021.001,2,71,0)
   <xsl:with-param name="width" select="'15%'"/>
"KRN",.84,7981021.001,2,72,0)
  </xsl:call-template>
"KRN",.84,7981021.001,2,73,0)
</xsl:template>
"KRN",.84,7981021.001,2,74,0)
  
"KRN",.84,7981021.001,2,75,0)
 <!--[ TABLE CELLS ]-->
"KRN",.84,7981021.001,2,76,0)
  
"KRN",.84,7981021.001,2,77,0)
 <xsl:template match="PATIENT/HCV_DATE">
"KRN",.84,7981021.001,2,78,0)
  <xsl:param name="rowspan" select="0"/>
"KRN",.84,7981021.001,2,79,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981021.001,2,80,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981021.001,2,81,0)
   <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981021.001,2,82,0)
  </xsl:call-template>
"KRN",.84,7981021.001,2,83,0)
</xsl:template>
"KRN",.84,7981021.001,2,84,0)
  
"KRN",.84,7981021.001,2,85,0)
 <xsl:template match="PATIENT/FILL_DATE">
"KRN",.84,7981021.001,2,86,0)
  <xsl:param name="rowspan" select="0"/>
"KRN",.84,7981021.001,2,87,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981021.001,2,88,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981021.001,2,89,0)
   <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981021.001,2,90,0)
  </xsl:call-template>
"KRN",.84,7981021.001,2,91,0)
</xsl:template>
"KRN",.84,7981021.001,2,92,0)
  
"KRN",.84,7981021.001,2,93,0)
</xsl:stylesheet>
"KRN",.84,7981021.002,-1)
0^10
"KRN",.84,7981021.002,0)
7981021.002^2^^CLINICAL CASE REGISTRIES^Potential DAA Candidates (CSV)
"KRN",.84,7981021.002,2,0)
^^102^102^3170810^
"KRN",.84,7981021.002,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981021.002,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981021.002,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981021.002,2,4,0)
 
"KRN",.84,7981021.002,2,5,0)
<xsl:import href="template://report/999/2"/>  <!-- Common -->
"KRN",.84,7981021.002,2,6,0)
 
"KRN",.84,7981021.002,2,7,0)
<xsl:template match="/">
"KRN",.84,7981021.002,2,8,0)
  <xsl:text>Potential DAA Candidates</xsl:text>
"KRN",.84,7981021.002,2,9,0)
  <xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981021.002,2,10,0)
</xsl:template>
"KRN",.84,7981021.002,2,11,0)
 
"KRN",.84,7981021.002,2,12,0)
<xsl:template match="COLUMN[@NAME='HCV_DATE']">
"KRN",.84,7981021.002,2,13,0)
  <xsl:value-of select="'Most Recent HCV RNA Date'"/>
"KRN",.84,7981021.002,2,14,0)
  <xsl:value-of select="$DELIMITER"/>
"KRN",.84,7981021.002,2,15,0)
</xsl:template>
"KRN",.84,7981021.002,2,16,0)
 
"KRN",.84,7981021.002,2,17,0)
<xsl:template match="COLUMN[@NAME='HCV']">
"KRN",.84,7981021.002,2,18,0)
  <xsl:value-of select="'Most Recent HCV RNA'"/>
"KRN",.84,7981021.002,2,19,0)
  <xsl:value-of select="$DELIMITER"/>
"KRN",.84,7981021.002,2,20,0)
</xsl:template>
"KRN",.84,7981021.002,2,21,0)
 
"KRN",.84,7981021.002,2,22,0)
<xsl:template match="COLUMN[@NAME='GT']">
"KRN",.84,7981021.002,2,23,0)
  <xsl:value-of select="'Most Recent GT'"/>
"KRN",.84,7981021.002,2,24,0)
  <xsl:value-of select="$DELIMITER"/>
"KRN",.84,7981021.002,2,25,0)
</xsl:template>
"KRN",.84,7981021.002,2,26,0)
 
"KRN",.84,7981021.002,2,27,0)
<xsl:template match="COLUMN[@NAME='FILL_DATE']">
"KRN",.84,7981021.002,2,28,0)
  <xsl:value-of select="'Most Recent Fill Date'"/>
"KRN",.84,7981021.002,2,29,0)
  <xsl:value-of select="$DELIMITER"/>
"KRN",.84,7981021.002,2,30,0)
</xsl:template>
"KRN",.84,7981021.002,2,31,0)
 
"KRN",.84,7981021.002,2,32,0)
<xsl:template match="COLUMN[@NAME='FILL_MED']">
"KRN",.84,7981021.002,2,33,0)
  <xsl:value-of select="'Most Recent HCV Medication Fill'"/>
"KRN",.84,7981021.002,2,34,0)
  <xsl:value-of select="$DELIMITER"/>
"KRN",.84,7981021.002,2,35,0)
</xsl:template>
"KRN",.84,7981021.002,2,36,0)
 
"KRN",.84,7981021.002,2,37,0)
<xsl:template match="COLUMN[@NAME='FIB4']">
"KRN",.84,7981021.002,2,38,0)
  <xsl:value-of select="'Fib4'"/>
"KRN",.84,7981021.002,2,39,0)
  <xsl:value-of select="$DELIMITER"/>
"KRN",.84,7981021.002,2,40,0)
</xsl:template>
"KRN",.84,7981021.002,2,41,0)
  
"KRN",.84,7981021.002,2,42,0)
<xsl:template match="PATIENTS/PATIENT">
"KRN",.84,7981021.002,2,43,0)
  <xsl:variable name="ptname" select="NAME"/>
"KRN",.84,7981021.002,2,44,0)
  <xsl:variable name="ssn" select="LAST4"/>
"KRN",.84,7981021.002,2,45,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981021.002,2,46,0)
   <xsl:with-param name="value" select="$ptname"/>
"KRN",.84,7981021.002,2,47,0)
  </xsl:call-template>
"KRN",.84,7981021.002,2,48,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981021.002,2,49,0)
   <xsl:with-param name="value" select="$ssn"/>
"KRN",.84,7981021.002,2,50,0)
  </xsl:call-template>
"KRN",.84,7981021.002,2,51,0)
  <xsl:if test="$AGE_YES">
"KRN",.84,7981021.002,2,52,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981021.002,2,53,0)
    <xsl:with-param name="value" select="AGE"/>
"KRN",.84,7981021.002,2,54,0)
   </xsl:call-template>
"KRN",.84,7981021.002,2,55,0)
  </xsl:if>
"KRN",.84,7981021.002,2,56,0)
  <xsl:if test="$DOB_YES">
"KRN",.84,7981021.002,2,57,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981021.002,2,58,0)
    <xsl:with-param name="value" select="DOB"/>
"KRN",.84,7981021.002,2,59,0)
    <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981021.002,2,60,0)
   </xsl:call-template>
"KRN",.84,7981021.002,2,61,0)
  </xsl:if>
"KRN",.84,7981021.002,2,62,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981021.002,2,63,0)
   <xsl:with-param name="value" select="HCV_DATE"/>
"KRN",.84,7981021.002,2,64,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981021.002,2,65,0)
  </xsl:call-template>
"KRN",.84,7981021.002,2,66,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981021.002,2,67,0)
   <xsl:with-param name="value" select="HCV"/>
"KRN",.84,7981021.002,2,68,0)
  </xsl:call-template>
"KRN",.84,7981021.002,2,69,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981021.002,2,70,0)
   <xsl:with-param name="value" select="GT"/>
"KRN",.84,7981021.002,2,71,0)
  </xsl:call-template>
"KRN",.84,7981021.002,2,72,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981021.002,2,73,0)
   <xsl:with-param name="value" select="FILL_DATE"/>
"KRN",.84,7981021.002,2,74,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981021.002,2,75,0)
  </xsl:call-template>
"KRN",.84,7981021.002,2,76,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981021.002,2,77,0)
   <xsl:with-param name="value" select="FILL_MED"/>
"KRN",.84,7981021.002,2,78,0)
  </xsl:call-template>
"KRN",.84,7981021.002,2,79,0)
  <xsl:if test="FIB4">
"KRN",.84,7981021.002,2,80,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981021.002,2,81,0)
   <xsl:with-param name="value" select="FIB4"/>
"KRN",.84,7981021.002,2,82,0)
  </xsl:call-template>
"KRN",.84,7981021.002,2,83,0)
  </xsl:if>
"KRN",.84,7981021.002,2,84,0)
  <xsl:if test="$ICN_YES">
"KRN",.84,7981021.002,2,85,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981021.002,2,86,0)
    <xsl:with-param name="value" select="ICN"/>
"KRN",.84,7981021.002,2,87,0)
   </xsl:call-template>
"KRN",.84,7981021.002,2,88,0)
  </xsl:if>
"KRN",.84,7981021.002,2,89,0)
  <xsl:if test="$PACT_YES">
"KRN",.84,7981021.002,2,90,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981021.002,2,91,0)
    <xsl:with-param name="value" select="PACT"/>
"KRN",.84,7981021.002,2,92,0)
   </xsl:call-template>
"KRN",.84,7981021.002,2,93,0)
  </xsl:if>
"KRN",.84,7981021.002,2,94,0)
  <xsl:if test="$PCP_YES">
"KRN",.84,7981021.002,2,95,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981021.002,2,96,0)
    <xsl:with-param name="value" select="PCP"/>
"KRN",.84,7981021.002,2,97,0)
   </xsl:call-template>
"KRN",.84,7981021.002,2,98,0)
  </xsl:if>
"KRN",.84,7981021.002,2,99,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981021.002,2,100,0)
</xsl:template>
"KRN",.84,7981021.002,2,101,0)
 
"KRN",.84,7981021.002,2,102,0)
</xsl:stylesheet>
"KRN",.84,7981022.001,-1)
0^1
"KRN",.84,7981022.001,0)
7981022.001^2^^CLINICAL CASE REGISTRIES^DAA Lab Monitoring (HTML)
"KRN",.84,7981022.001,2,0)
^^660^660^3170803^
"KRN",.84,7981022.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981022.001,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981022.001,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981022.001,2,4,0)
 
"KRN",.84,7981022.001,2,5,0)
<xsl:import  href="template://report/998/1"/> <!-- Styles   -->
"KRN",.84,7981022.001,2,6,0)
<xsl:import  href="template://report/999/1"/> <!-- Common   -->
"KRN",.84,7981022.001,2,7,0)
<xsl:include href="template://report/997/1"/> <!-- Patients -->
"KRN",.84,7981022.001,2,8,0)
<xsl:include href="template://report/996/1"/> <!-- Pharmacy -->
"KRN",.84,7981022.001,2,9,0)
<xsl:include href="template://report/995/1"/> <!-- Lab Data -->
"KRN",.84,7981022.001,2,10,0)
 
"KRN",.84,7981022.001,2,11,0)
<xsl:key name="patient-drug" match="/REPORT/DRUGS/DRUG"  use="@ID"/>
"KRN",.84,7981022.001,2,12,0)
<xsl:key name="patient-lt"   match="/REPORT/LABTESTS/LT" use="@ID"/>
"KRN",.84,7981022.001,2,13,0)
<xsl:key name="patient-both" 
"KRN",.84,7981022.001,2,14,0)
match="/REPORT/DRUGS/DRUG|/REPORT/LABTESTS/LT" use="@ID"/>
"KRN",.84,7981022.001,2,15,0)
 
"KRN",.84,7981022.001,2,16,0)
<!-- Determine if the Meds and/or Labs table is not empty. -->
"KRN",.84,7981022.001,2,17,0)
<xsl:variable name="D1" select="/REPORT/DRUGS/DRUG[1]"/>
"KRN",.84,7981022.001,2,18,0)
<xsl:variable name="L1" select="/REPORT/LABTESTS/LT[1]"/>
"KRN",.84,7981022.001,2,19,0)
 
"KRN",.84,7981022.001,2,20,0)
<!-- Determine if the Meds and/or Labs table is sorted by a patient data 
"KRN",.84,7981022.001,2,21,0)
field.-->
"KRN",.84,7981022.001,2,22,0)
<xsl:variable name="PTCOLS"   select="',AGE,DOB,LAST4,NAME,'"/>
"KRN",.84,7981022.001,2,23,0)
<xsl:variable name="PTSDRUGS" 
"KRN",.84,7981022.001,2,24,0)
select="contains($PTCOLS,concat(',',/REPORT/DRUGS/@SORT,','))"/>
"KRN",.84,7981022.001,2,25,0)
<xsl:variable name="PTSLABS"  
"KRN",.84,7981022.001,2,26,0)
select="contains($PTCOLS,concat(',',/REPORT/LABTESTS/@SORT,','))"/>
"KRN",.84,7981022.001,2,27,0)
 
"KRN",.84,7981022.001,2,28,0)
<xsl:template match="/">
"KRN",.84,7981022.001,2,29,0)
<html>
"KRN",.84,7981022.001,2,30,0)
  <head>
"KRN",.84,7981022.001,2,31,0)
   <title>DAA Lab Monitoring Report</title>
"KRN",.84,7981022.001,2,32,0)
   <xsl:call-template name="StyleSheet"/>
"KRN",.84,7981022.001,2,33,0)
  </head>
"KRN",.84,7981022.001,2,34,0)
  <body>
"KRN",.84,7981022.001,2,35,0)
   <h1>DAA Lab Monitoring Report </h1>
"KRN",.84,7981022.001,2,36,0)
   <xsl:call-template name="ReportHeader"/>
"KRN",.84,7981022.001,2,37,0)
   <xsl:choose>
"KRN",.84,7981022.001,2,38,0)
    <!-- 
"KRN",.84,7981022.001,2,39,0)
     If both Meds and Labs tables are not empty and at least one of them
"KRN",.84,7981022.001,2,40,0)
     is sorted by patient data field, then group the data by patients.
"KRN",.84,7981022.001,2,41,0)
    -->
"KRN",.84,7981022.001,2,42,0)
    <xsl:when test="$D1 and $L1 and ($PTSDRUGS or $PTSLABS)">
"KRN",.84,7981022.001,2,43,0)
     <xsl:call-template name="DAAMonitor"/>
"KRN",.84,7981022.001,2,44,0)
    </xsl:when>
"KRN",.84,7981022.001,2,45,0)
    <!-- 
"KRN",.84,7981022.001,2,46,0)
     Otherwise, format available data using separate tables.
"KRN",.84,7981022.001,2,47,0)
    -->
"KRN",.84,7981022.001,2,48,0)
    <xsl:when test="$D1 or $L1 or /REPORT/PATIENTS/PATIENT[1]">
"KRN",.84,7981022.001,2,49,0)
     <xsl:apply-templates select="/REPORT/DRUGS"/>
"KRN",.84,7981022.001,2,50,0)
     <xsl:apply-templates select="/REPORT/LABTESTS"/>
"KRN",.84,7981022.001,2,51,0)
     <xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981022.001,2,52,0)
    </xsl:when>
"KRN",.84,7981022.001,2,53,0)
    <xsl:otherwise>
"KRN",.84,7981022.001,2,54,0)
     <xsl:call-template name="TableNoData"/>
"KRN",.84,7981022.001,2,55,0)
    </xsl:otherwise>
"KRN",.84,7981022.001,2,56,0)
   </xsl:choose>
"KRN",.84,7981022.001,2,57,0)
  </body>
"KRN",.84,7981022.001,2,58,0)
</html>
"KRN",.84,7981022.001,2,59,0)
</xsl:template>
"KRN",.84,7981022.001,2,60,0)
 
"KRN",.84,7981022.001,2,61,0)
<xsl:template name="DAAMonitor">
"KRN",.84,7981022.001,2,62,0)
<xsl:variable name="SORT">
"KRN",.84,7981022.001,2,63,0)
  <xsl:choose>
"KRN",.84,7981022.001,2,64,0)
   <xsl:when test="$PTSDRUGS"><xsl:value-of 
"KRN",.84,7981022.001,2,65,0)
select="/REPORT/DRUGS/@SORT"/></xsl:when>
"KRN",.84,7981022.001,2,66,0)
   <xsl:when test="$PTSLABS"><xsl:value-of   
"KRN",.84,7981022.001,2,67,0)
select="/REPORT/LABTESTS/@SORT"/></xsl:when>
"KRN",.84,7981022.001,2,68,0)
   <xsl:otherwise>NAME</xsl:otherwise>
"KRN",.84,7981022.001,2,69,0)
  </xsl:choose>
"KRN",.84,7981022.001,2,70,0)
</xsl:variable>
"KRN",.84,7981022.001,2,71,0)
<xsl:variable name="SORTORD">
"KRN",.84,7981022.001,2,72,0)
  <xsl:choose>
"KRN",.84,7981022.001,2,73,0)
   <xsl:when test="($PTSDRUGS and boolean(/REPORT/DRUGS/@SORTDESC)) or 
"KRN",.84,7981022.001,2,74,0)
    ($PTSLABS and 
"KRN",.84,7981022.001,2,75,0)
boolean(/REPORT/LABTESTS/@SORTDESC))">descending</xsl:when>
"KRN",.84,7981022.001,2,76,0)
   <xsl:otherwise>ascending</xsl:otherwise>
"KRN",.84,7981022.001,2,77,0)
  </xsl:choose>
"KRN",.84,7981022.001,2,78,0)
</xsl:variable>
"KRN",.84,7981022.001,2,79,0)
<xsl:for-each 
"KRN",.84,7981022.001,2,80,0)
select="/REPORT//*[generate-id(.)=generate-id(key('patient-both',@ID))]">
"KRN",.84,7981022.001,2,81,0)
  <xsl:sort select="concat(*[name()=$SORT],'&#10;',NAME)" 
"KRN",.84,7981022.001,2,82,0)
order="{$SORTORD}"/>
"KRN",.84,7981022.001,2,83,0)
  <!-- The following line added to fix page break issue in IE 7 -->
"KRN",.84,7981022.001,2,84,0)
  <div style="page-break-after:always; font-size:1; 
"KRN",.84,7981022.001,2,85,0)
margin:0;border:0"><span style="visibility: hidden">-</span></div>
"KRN",.84,7981022.001,2,86,0)
  <div>
"KRN",.84,7981022.001,2,87,0)
   <table style="width:100%" cellpadding="5" cellspacing="0">
"KRN",.84,7981022.001,2,88,0)
    <thead>
"KRN",.84,7981022.001,2,89,0)
     <tr>
"KRN",.84,7981022.001,2,90,0)
      <xsl:call-template name="ColumnHeader">
"KRN",.84,7981022.001,2,91,0)
       <xsl:with-param name="sort" select="''"/>
"KRN",.84,7981022.001,2,92,0)
       <xsl:with-param name="title" select="'#'"/>
"KRN",.84,7981022.001,2,93,0)
       <xsl:with-param name="width" select="'4%'"/>
"KRN",.84,7981022.001,2,94,0)
      </xsl:call-template>
"KRN",.84,7981022.001,2,95,0)
      <xsl:call-template name="ColumnHeader">
"KRN",.84,7981022.001,2,96,0)
       <xsl:with-param name="sort" 
"KRN",.84,7981022.001,2,97,0)
select="'DRUGS=NAME&amp;LABTESTS=NAME'"/>
"KRN",.84,7981022.001,2,98,0)
       <xsl:with-param name="title" select="'Patient Name'"/>
"KRN",.84,7981022.001,2,99,0)
      </xsl:call-template>
"KRN",.84,7981022.001,2,100,0)
      <xsl:call-template name="ColumnHeader">
"KRN",.84,7981022.001,2,101,0)
       <xsl:with-param name="sort" 
"KRN",.84,7981022.001,2,102,0)
select="'DRUGS=LAST4&amp;LABTESTS=LAST4'"/>
"KRN",.84,7981022.001,2,103,0)
       <xsl:with-param name="title" select="'SSN'"/>
"KRN",.84,7981022.001,2,104,0)
       <xsl:with-param name="width" select="'4%'"/>
"KRN",.84,7981022.001,2,105,0)
      </xsl:call-template>
"KRN",.84,7981022.001,2,106,0)
      <xsl:if test="$AGE_YES">
"KRN",.84,7981022.001,2,107,0)
       <xsl:call-template name="ColumnHeader">
"KRN",.84,7981022.001,2,108,0)
        <xsl:with-param name="sort" 
"KRN",.84,7981022.001,2,109,0)
select="'DRUGS=AGE&amp;LABTESTS=AGE'"/>
"KRN",.84,7981022.001,2,110,0)
        <xsl:with-param name="title" select="'Age'"/>
"KRN",.84,7981022.001,2,111,0)
        <xsl:with-param name="width" select="'4%'"/>
"KRN",.84,7981022.001,2,112,0)
       </xsl:call-template>
"KRN",.84,7981022.001,2,113,0)
      </xsl:if>
"KRN",.84,7981022.001,2,114,0)
      <xsl:if test="$DOB_YES">
"KRN",.84,7981022.001,2,115,0)
       <xsl:call-template name="ColumnHeader">
"KRN",.84,7981022.001,2,116,0)
        <xsl:with-param name="sort" 
"KRN",.84,7981022.001,2,117,0)
select="'DRUGS=DOB&amp;LABTESTS=DOB'"/>
"KRN",.84,7981022.001,2,118,0)
        <xsl:with-param name="title" select="'Date of Birth'"/>
"KRN",.84,7981022.001,2,119,0)
        <xsl:with-param name="width" select="'7%'"/>
"KRN",.84,7981022.001,2,120,0)
       </xsl:call-template>
"KRN",.84,7981022.001,2,121,0)
      </xsl:if>
"KRN",.84,7981022.001,2,122,0)
      <xsl:if test="$ICN_YES">
"KRN",.84,7981022.001,2,123,0)
       <xsl:call-template name="ColumnHeader">
"KRN",.84,7981022.001,2,124,0)
        <xsl:with-param name="sort" 
"KRN",.84,7981022.001,2,125,0)
select="'DRUGS=ICN&amp;LABTESTS=ICN'"/>
"KRN",.84,7981022.001,2,126,0)
        <xsl:with-param name="title" select="'ICN'"/>
"KRN",.84,7981022.001,2,127,0)
        <xsl:with-param name="width" select="'13%'"/>
"KRN",.84,7981022.001,2,128,0)
       </xsl:call-template>
"KRN",.84,7981022.001,2,129,0)
      </xsl:if>
"KRN",.84,7981022.001,2,130,0)
      <xsl:if test="$PACT_YES">
"KRN",.84,7981022.001,2,131,0)
       <xsl:call-template name="ColumnHeader">
"KRN",.84,7981022.001,2,132,0)
        <xsl:with-param name="sort" 
"KRN",.84,7981022.001,2,133,0)
select="'DRUGS=PACT&amp;LABTESTS=PACT'"/>
"KRN",.84,7981022.001,2,134,0)
        <xsl:with-param name="title" select="'PACT'"/>
"KRN",.84,7981022.001,2,135,0)
        <xsl:with-param name="width" select="'16%'"/>
"KRN",.84,7981022.001,2,136,0)
       </xsl:call-template>
"KRN",.84,7981022.001,2,137,0)
      </xsl:if>
"KRN",.84,7981022.001,2,138,0)
      <xsl:if test="$PCP_YES">
"KRN",.84,7981022.001,2,139,0)
       <xsl:call-template name="ColumnHeader">
"KRN",.84,7981022.001,2,140,0)
        <xsl:with-param name="sort" 
"KRN",.84,7981022.001,2,141,0)
select="'DRUGS=PCP&amp;LABTESTS=PCP'"/>
"KRN",.84,7981022.001,2,142,0)
        <xsl:with-param name="title" select="'PCP'"/>
"KRN",.84,7981022.001,2,143,0)
        <xsl:with-param name="width" select="'18%'"/>
"KRN",.84,7981022.001,2,144,0)
       </xsl:call-template>
"KRN",.84,7981022.001,2,145,0)
      </xsl:if>
"KRN",.84,7981022.001,2,146,0)
     </tr>
"KRN",.84,7981022.001,2,147,0)
    </thead>
"KRN",.84,7981022.001,2,148,0)
    <tr>
"KRN",.84,7981022.001,2,149,0)
     <xsl:call-template name="BasicDAAPatientData">
"KRN",.84,7981022.001,2,150,0)
      <xsl:with-param name="seqnum"  select="1"/>
"KRN",.84,7981022.001,2,151,0)
      <xsl:with-param name="ageyes"  select="$AGE_YES"/>
"KRN",.84,7981022.001,2,152,0)
      <xsl:with-param name="dobyes"  select="$DOB_YES"/>
"KRN",.84,7981022.001,2,153,0)
      <xsl:with-param name="icnyes"  select="$ICN_YES"/>
"KRN",.84,7981022.001,2,154,0)
      <xsl:with-param name="pactyes" select="$PACT_YES"/>
"KRN",.84,7981022.001,2,155,0)
      <xsl:with-param name="pcpyes"  select="$PCP_YES"/>
"KRN",.84,7981022.001,2,156,0)
     </xsl:call-template>
"KRN",.84,7981022.001,2,157,0)
    </tr>
"KRN",.84,7981022.001,2,158,0)
   </table>
"KRN",.84,7981022.001,2,159,0)
   <br/>
"KRN",.84,7981022.001,2,160,0)
   <table cellpadding="5" cellspacing="0" style="leftpadding:25px; 
"KRN",.84,7981022.001,2,161,0)
width:80%;">
"KRN",.84,7981022.001,2,162,0)
    <thead>
"KRN",.84,7981022.001,2,163,0)
     <tr>
"KRN",.84,7981022.001,2,164,0)
      <xsl:call-template name="ColumnHeader">
"KRN",.84,7981022.001,2,165,0)
       <xsl:with-param name="colname" select="'DAA_FILL'"/>
"KRN",.84,7981022.001,2,166,0)
       <xsl:with-param name="sort" 
"KRN",.84,7981022.001,2,167,0)
select="'DRUGS=DAA_FILL:ASC&amp;LABTESTS=LTNAME:ASC'"/>
"KRN",.84,7981022.001,2,168,0)
       <xsl:with-param name="title" select="'DAA Start Date'"/>
"KRN",.84,7981022.001,2,169,0)
       <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981022.001,2,170,0)
      </xsl:call-template>
"KRN",.84,7981022.001,2,171,0)
      <xsl:call-template name="ColumnHeader">
"KRN",.84,7981022.001,2,172,0)
       <xsl:with-param name="colname" select="'RXNAME'"/>
"KRN",.84,7981022.001,2,173,0)
       <xsl:with-param name="sort" 
"KRN",.84,7981022.001,2,174,0)
select="'DRUGS=RXNAME:ASC&amp;LABTESTS=LTNAME:ASC'"/>
"KRN",.84,7981022.001,2,175,0)
       <xsl:with-param name="title" select="'Medication Name'"/>
"KRN",.84,7981022.001,2,176,0)
      </xsl:call-template>
"KRN",.84,7981022.001,2,177,0)
      <xsl:call-template name="ColumnHeader">
"KRN",.84,7981022.001,2,178,0)
       <xsl:with-param name="colname" select="'FILL_DATE'"/>
"KRN",.84,7981022.001,2,179,0)
       <xsl:with-param name="sort" 
"KRN",.84,7981022.001,2,180,0)
select="'DRUGS=FILL_DATE:ASC&amp;LABTESTS=LTNAME:ASC'"/>
"KRN",.84,7981022.001,2,181,0)
       <xsl:with-param name="title" select="'Fill Date'"/>
"KRN",.84,7981022.001,2,182,0)
       <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981022.001,2,183,0)
      </xsl:call-template>
"KRN",.84,7981022.001,2,184,0)
      <xsl:call-template name="ColumnHeader">
"KRN",.84,7981022.001,2,185,0)
       <xsl:with-param name="colname" select="'DAYSPLY'"/>
"KRN",.84,7981022.001,2,186,0)
      <xsl:with-param name="sort" 
"KRN",.84,7981022.001,2,187,0)
select="'DRUGS=DAYSPLY:ASC&amp;LABTESTS=LTNAME:ASC'"/>
"KRN",.84,7981022.001,2,188,0)
       <xsl:with-param name="title" select="'Days Supply'"/>
"KRN",.84,7981022.001,2,189,0)
      <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981022.001,2,190,0)
      </xsl:call-template>
"KRN",.84,7981022.001,2,191,0)
     </tr>
"KRN",.84,7981022.001,2,192,0)
    </thead>
"KRN",.84,7981022.001,2,193,0)
    <xsl:call-template name="DataGridFooter">
"KRN",.84,7981022.001,2,194,0)
     <xsl:with-param name="colspan" select="4"/>
"KRN",.84,7981022.001,2,195,0)
    </xsl:call-template>
"KRN",.84,7981022.001,2,196,0)
    <tbody>
"KRN",.84,7981022.001,2,197,0)
     <xsl:for-each select="key('patient-drug',@ID)">
"KRN",.84,7981022.001,2,198,0)
      <xsl:sort select="concat(RXNAME,'',FILL_DATE)"/>
"KRN",.84,7981022.001,2,199,0)
      <tr><xsl:call-template name="DAADrugData"/></tr>
"KRN",.84,7981022.001,2,200,0)
     </xsl:for-each>
"KRN",.84,7981022.001,2,201,0)
    </tbody>
"KRN",.84,7981022.001,2,202,0)
   </table>
"KRN",.84,7981022.001,2,203,0)
   <br />
"KRN",.84,7981022.001,2,204,0)
   <table cellpadding="5" cellspacing="0" style="leftpadding:25px; 
"KRN",.84,7981022.001,2,205,0)
width:80%;">
"KRN",.84,7981022.001,2,206,0)
    <thead>
"KRN",.84,7981022.001,2,207,0)
     <tr>
"KRN",.84,7981022.001,2,208,0)
      <xsl:call-template name="ColumnHeader">
"KRN",.84,7981022.001,2,209,0)
       <xsl:with-param name="sort" 
"KRN",.84,7981022.001,2,210,0)
select="'LABTESTS=DATE:DESC&amp;DRUGS=RXNAME:ASC'"/>
"KRN",.84,7981022.001,2,211,0)
       <xsl:with-param name="title" select="'Date'"/>    
"KRN",.84,7981022.001,2,212,0)
       <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981022.001,2,213,0)
      </xsl:call-template>
"KRN",.84,7981022.001,2,214,0)
      <xsl:call-template name="ColumnHeader">
"KRN",.84,7981022.001,2,215,0)
       <xsl:with-param name="sort" 
"KRN",.84,7981022.001,2,216,0)
select="'LABTESTS=LTNAME:ASC&amp;DRUGS=RXNAME:ASC'"/>
"KRN",.84,7981022.001,2,217,0)
       <xsl:with-param name="title" select="'Test Name'"/>    
"KRN",.84,7981022.001,2,218,0)
      </xsl:call-template>
"KRN",.84,7981022.001,2,219,0)
      <xsl:call-template name="ColumnHeader">
"KRN",.84,7981022.001,2,220,0)
       <xsl:with-param name="sort" 
"KRN",.84,7981022.001,2,221,0)
select="'LABTESTS=RESULT:ASC&amp;DRUGS=RXNAME:ASC'"/>
"KRN",.84,7981022.001,2,222,0)
       <xsl:with-param name="title" select="'Result'"/>
"KRN",.84,7981022.001,2,223,0)
       <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981022.001,2,224,0)
      </xsl:call-template>
"KRN",.84,7981022.001,2,225,0)
      <xsl:call-template name="ColumnHeader">
"KRN",.84,7981022.001,2,226,0)
       <xsl:with-param name="sort" 
"KRN",.84,7981022.001,2,227,0)
select="'LABTESTS=WKS_LAB:ASC&amp;DRUGS=RXNAME:ASC'"/>
"KRN",.84,7981022.001,2,228,0)
       <xsl:with-param name="title" select="'Weeks Since DAA Start'"/>
"KRN",.84,7981022.001,2,229,0)
       <xsl:with-param name="width" select="'25%'"/>
"KRN",.84,7981022.001,2,230,0)
      </xsl:call-template>
"KRN",.84,7981022.001,2,231,0)
     </tr>
"KRN",.84,7981022.001,2,232,0)
    </thead>
"KRN",.84,7981022.001,2,233,0)
    <xsl:call-template name="DataGridFooter">
"KRN",.84,7981022.001,2,234,0)
     <xsl:with-param name="colspan" select="4"/>
"KRN",.84,7981022.001,2,235,0)
  </xsl:call-template>
"KRN",.84,7981022.001,2,236,0)
    <tbody>
"KRN",.84,7981022.001,2,237,0)
     <xsl:for-each select="key('patient-lt',@ID)">
"KRN",.84,7981022.001,2,238,0)
      <xsl:sort select="concat(LTNAME,'&#10;',DATE)"/>
"KRN",.84,7981022.001,2,239,0)
      <tr>
"KRN",.84,7981022.001,2,240,0)
       <xsl:call-template name="BasicLRData">
"KRN",.84,7981022.001,2,241,0)
        <xsl:with-param name="name" select="LTNAME"/>
"KRN",.84,7981022.001,2,242,0)
       </xsl:call-template>
"KRN",.84,7981022.001,2,243,0)
      </tr>
"KRN",.84,7981022.001,2,244,0)
     </xsl:for-each>
"KRN",.84,7981022.001,2,245,0)
    </tbody>
"KRN",.84,7981022.001,2,246,0)
   </table>
"KRN",.84,7981022.001,2,247,0)
   <br clear="all"/><br/>
"KRN",.84,7981022.001,2,248,0)
  </div>
"KRN",.84,7981022.001,2,249,0)
</xsl:for-each>
"KRN",.84,7981022.001,2,250,0)
</xsl:template>
"KRN",.84,7981022.001,2,251,0)
 
"KRN",.84,7981022.001,2,252,0)
<!--[ TABLES ]-->
"KRN",.84,7981022.001,2,253,0)
 
"KRN",.84,7981022.001,2,254,0)
<xsl:template match="REPORT/DRUGS">
"KRN",.84,7981022.001,2,255,0)
<div style="page-break-before:always">
"KRN",.84,7981022.001,2,256,0)
  <h2>Medications</h2>
"KRN",.84,7981022.001,2,257,0)
  <xsl:choose>
"KRN",.84,7981022.001,2,258,0)
   <xsl:when test="$D1">
"KRN",.84,7981022.001,2,259,0)
    <xsl:variable name="SORT" select="/REPORT/DRUGS/@SORT"/>
"KRN",.84,7981022.001,2,260,0)
    <xsl:variable name="SORTORD">
"KRN",.84,7981022.001,2,261,0)
     <xsl:choose>
"KRN",.84,7981022.001,2,262,0)
      <xsl:when test="/REPORT/DRUGS/@SORTDESC">descending</xsl:when>
"KRN",.84,7981022.001,2,263,0)
      <xsl:otherwise>ascending</xsl:otherwise>
"KRN",.84,7981022.001,2,264,0)
     </xsl:choose>
"KRN",.84,7981022.001,2,265,0)
    </xsl:variable>
"KRN",.84,7981022.001,2,266,0)
    <div>
"KRN",.84,7981022.001,2,267,0)
     <xsl:call-template name="MakeScrollable">
"KRN",.84,7981022.001,2,268,0)
      <xsl:with-param name="condition" select="DRUG[31]"/>
"KRN",.84,7981022.001,2,269,0)
     </xsl:call-template>
"KRN",.84,7981022.001,2,270,0)
     <table class="dataGrid" cellpadding="5" cellspacing="0">
"KRN",.84,7981022.001,2,271,0)
      <thead>
"KRN",.84,7981022.001,2,272,0)
       <tr>
"KRN",.84,7981022.001,2,273,0)
        <xsl:call-template name="BasicDAAPatientHeader">
"KRN",.84,7981022.001,2,274,0)
         <xsl:with-param name="tblname" select="'DRUGS'"/>
"KRN",.84,7981022.001,2,275,0)
         <xsl:with-param name="ageyes"  select="$AGE_YES"/>
"KRN",.84,7981022.001,2,276,0)
         <xsl:with-param name="dobyes"  select="$DOB_YES"/>
"KRN",.84,7981022.001,2,277,0)
         <xsl:with-param name="icnyes"  select="$ICN_YES"/>
"KRN",.84,7981022.001,2,278,0)
         <xsl:with-param name="pactyes" select="$PACT_YES"/>
"KRN",.84,7981022.001,2,279,0)
         <xsl:with-param name="pcpyes"  select="$PCP_YES"/>
"KRN",.84,7981022.001,2,280,0)
        </xsl:call-template>
"KRN",.84,7981022.001,2,281,0)
        <xsl:call-template name="ColumnHeader">
"KRN",.84,7981022.001,2,282,0)
         <xsl:with-param name="colname" select="'DAA_FILL'"/>
"KRN",.84,7981022.001,2,283,0)
         <xsl:with-param name="sort" select="'DRUGS=DAA_FILL'"/>
"KRN",.84,7981022.001,2,284,0)
         <xsl:with-param name="title" select="'DAA Start Date'"/>
"KRN",.84,7981022.001,2,285,0)
         <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981022.001,2,286,0)
        </xsl:call-template>
"KRN",.84,7981022.001,2,287,0)
        <xsl:call-template name="ColumnHeader">
"KRN",.84,7981022.001,2,288,0)
         <xsl:with-param name="colname" select="'RXNAME'"/>
"KRN",.84,7981022.001,2,289,0)
         <xsl:with-param name="sort" select="'DRUGS=RXNAME'"/>
"KRN",.84,7981022.001,2,290,0)
         <xsl:with-param name="title" select="'Medication Name'"/>
"KRN",.84,7981022.001,2,291,0)
        </xsl:call-template>
"KRN",.84,7981022.001,2,292,0)
        <xsl:call-template name="ColumnHeader">
"KRN",.84,7981022.001,2,293,0)
         <xsl:with-param name="colname" select="'FILL_DATE'"/>
"KRN",.84,7981022.001,2,294,0)
         <xsl:with-param name="sort" select="'DRUGS=FILL_DATE'"/>
"KRN",.84,7981022.001,2,295,0)
         <xsl:with-param name="title" select="'Fill Date'"/>
"KRN",.84,7981022.001,2,296,0)
         <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981022.001,2,297,0)
        </xsl:call-template>
"KRN",.84,7981022.001,2,298,0)
        <xsl:call-template name="ColumnHeader">
"KRN",.84,7981022.001,2,299,0)
         <xsl:with-param name="colname" select="'DAYSPLY'"/>
"KRN",.84,7981022.001,2,300,0)
        <xsl:with-param name="sort" select="'DRUGS=DAYSPLY'"/>
"KRN",.84,7981022.001,2,301,0)
         <xsl:with-param name="title" select="'Days Supply'"/>
"KRN",.84,7981022.001,2,302,0)
         <xsl:with-param name="width" select="'7%'"/>
"KRN",.84,7981022.001,2,303,0)
        </xsl:call-template>
"KRN",.84,7981022.001,2,304,0)
       </tr>
"KRN",.84,7981022.001,2,305,0)
      </thead>
"KRN",.84,7981022.001,2,306,0)
      <xsl:call-template name="DataGridFooter">
"KRN",.84,7981022.001,2,307,0)
       <xsl:with-param name="colspan" select="15"/>    <!-- Make bigger 
"KRN",.84,7981022.001,2,308,0)
than number of columns -->
"KRN",.84,7981022.001,2,309,0)
      </xsl:call-template>
"KRN",.84,7981022.001,2,310,0)
      <tbody>
"KRN",.84,7981022.001,2,311,0)
       <xsl:choose>
"KRN",.84,7981022.001,2,312,0)
        <xsl:when test="$PTSDRUGS">
"KRN",.84,7981022.001,2,313,0)
         <xsl:for-each 
"KRN",.84,7981022.001,2,314,0)
select="DRUG[generate-id(.)=generate-id(key('patient-drug',@ID))]">
"KRN",.84,7981022.001,2,315,0)
          <xsl:call-template name="DAAPatientDrugData">
"KRN",.84,7981022.001,2,316,0)
           <xsl:with-param name="group" select="key('patient-drug',@ID)"/>
"KRN",.84,7981022.001,2,317,0)
          </xsl:call-template>
"KRN",.84,7981022.001,2,318,0)
         </xsl:for-each>
"KRN",.84,7981022.001,2,319,0)
        </xsl:when>
"KRN",.84,7981022.001,2,320,0)
        <xsl:otherwise> 
"KRN",.84,7981022.001,2,321,0)
         <xsl:for-each select="DRUG">
"KRN",.84,7981022.001,2,322,0)
          <!--xsl:sort select="concat(*[name()=$SORT],'&#10;',NAME)" 
"KRN",.84,7981022.001,2,323,0)
order="{$SORTORD}"/-->
"KRN",.84,7981022.001,2,324,0)
          <xsl:sort select="concat(NAME,'',RXNAME,'',FILL_DATE)"/>
"KRN",.84,7981022.001,2,325,0)
          <tr>
"KRN",.84,7981022.001,2,326,0)
           <xsl:call-template name="BasicDAAPatientData">
"KRN",.84,7981022.001,2,327,0)
             <xsl:with-param name="ageyes"  select="$AGE_YES"/>
"KRN",.84,7981022.001,2,328,0)
             <xsl:with-param name="dobyes"  select="$DOB_YES"/>
"KRN",.84,7981022.001,2,329,0)
             <xsl:with-param name="icnyes"  select="$ICN_YES"/>
"KRN",.84,7981022.001,2,330,0)
             <xsl:with-param name="pactyes" select="$PACT_YES"/>
"KRN",.84,7981022.001,2,331,0)
             <xsl:with-param name="pcpyes"  select="$PCP_YES"/>
"KRN",.84,7981022.001,2,332,0)
           </xsl:call-template>
"KRN",.84,7981022.001,2,333,0)
           <xsl:call-template name="DAADrugData"/>
"KRN",.84,7981022.001,2,334,0)
          </tr>
"KRN",.84,7981022.001,2,335,0)
         </xsl:for-each>
"KRN",.84,7981022.001,2,336,0)
        </xsl:otherwise>
"KRN",.84,7981022.001,2,337,0)
       </xsl:choose>
"KRN",.84,7981022.001,2,338,0)
      </tbody>
"KRN",.84,7981022.001,2,339,0)
     </table>
"KRN",.84,7981022.001,2,340,0)
    </div>
"KRN",.84,7981022.001,2,341,0)
   </xsl:when>
"KRN",.84,7981022.001,2,342,0)
   <xsl:otherwise>
"KRN",.84,7981022.001,2,343,0)
    <xsl:call-template name="TableNoData"/>
"KRN",.84,7981022.001,2,344,0)
   </xsl:otherwise>
"KRN",.84,7981022.001,2,345,0)
  </xsl:choose>
"KRN",.84,7981022.001,2,346,0)
</div>
"KRN",.84,7981022.001,2,347,0)
</xsl:template>
"KRN",.84,7981022.001,2,348,0)
 
"KRN",.84,7981022.001,2,349,0)
<xsl:template match="REPORT/LABTESTS">
"KRN",.84,7981022.001,2,350,0)
<div style="page-break-before:always">
"KRN",.84,7981022.001,2,351,0)
  <h2>Lab Results</h2>
"KRN",.84,7981022.001,2,352,0)
  <xsl:choose>
"KRN",.84,7981022.001,2,353,0)
   <xsl:when test="$L1">
"KRN",.84,7981022.001,2,354,0)
    <xsl:variable name="SORT" select="/REPORT/LABTESTS/@SORT"/>
"KRN",.84,7981022.001,2,355,0)
    <xsl:variable name="SORTORD">
"KRN",.84,7981022.001,2,356,0)
     <xsl:choose>
"KRN",.84,7981022.001,2,357,0)
      <xsl:when test="/REPORT/LABTESTS/@SORTDESC">descending</xsl:when>
"KRN",.84,7981022.001,2,358,0)
      <xsl:otherwise>ascending</xsl:otherwise>
"KRN",.84,7981022.001,2,359,0)
     </xsl:choose>
"KRN",.84,7981022.001,2,360,0)
    </xsl:variable>
"KRN",.84,7981022.001,2,361,0)
    <div>
"KRN",.84,7981022.001,2,362,0)
    <xsl:call-template name="MakeScrollable">
"KRN",.84,7981022.001,2,363,0)
     <xsl:with-param name="condition" select="LT[31]"/>
"KRN",.84,7981022.001,2,364,0)
    </xsl:call-template>
"KRN",.84,7981022.001,2,365,0)
     <table class="dataGrid" cellpadding="5" cellspacing="0">
"KRN",.84,7981022.001,2,366,0)
      <thead>
"KRN",.84,7981022.001,2,367,0)
       <tr>
"KRN",.84,7981022.001,2,368,0)
        <xsl:call-template name="BasicDAAPatientHeader">
"KRN",.84,7981022.001,2,369,0)
         <xsl:with-param name="tblname" select="'LABTESTS'"/>
"KRN",.84,7981022.001,2,370,0)
         <xsl:with-param name="ageyes"  select="$AGE_YES"/>
"KRN",.84,7981022.001,2,371,0)
         <xsl:with-param name="dobyes"  select="$DOB_YES"/>
"KRN",.84,7981022.001,2,372,0)
         <xsl:with-param name="icnyes"  select="$ICN_YES"/>
"KRN",.84,7981022.001,2,373,0)
         <xsl:with-param name="pactyes" select="$PACT_YES"/>
"KRN",.84,7981022.001,2,374,0)
         <xsl:with-param name="pcpyes"  select="$PCP_YES"/>
"KRN",.84,7981022.001,2,375,0)
        </xsl:call-template>
"KRN",.84,7981022.001,2,376,0)
        <xsl:call-template name="BasicLRHeader">
"KRN",.84,7981022.001,2,377,0)
         <xsl:with-param name="colname" select="'LTNAME'"/>
"KRN",.84,7981022.001,2,378,0)
         <xsl:with-param name="tblname" select="'LABTESTS'"/>
"KRN",.84,7981022.001,2,379,0)
        </xsl:call-template>
"KRN",.84,7981022.001,2,380,0)
        <xsl:call-template name="ColumnHeader">
"KRN",.84,7981022.001,2,381,0)
         <xsl:with-param name="colname" select="'WKS_LAB'"/>
"KRN",.84,7981022.001,2,382,0)
         <xsl:with-param name="sort" select="'LABTESTS=WKS_LAB'"/>
"KRN",.84,7981022.001,2,383,0)
         <xsl:with-param name="title" select="'Weeks Since DAA Start'"/>
"KRN",.84,7981022.001,2,384,0)
         <xsl:with-param name="width" select="'14%'"/>
"KRN",.84,7981022.001,2,385,0)
        </xsl:call-template>
"KRN",.84,7981022.001,2,386,0)
       </tr>
"KRN",.84,7981022.001,2,387,0)
      </thead>
"KRN",.84,7981022.001,2,388,0)
      <xsl:call-template name="DataGridFooter">
"KRN",.84,7981022.001,2,389,0)
       <xsl:with-param name="colspan" select="15"/>    <!-- Make bigger 
"KRN",.84,7981022.001,2,390,0)
than number of columns -->
"KRN",.84,7981022.001,2,391,0)
      </xsl:call-template>
"KRN",.84,7981022.001,2,392,0)
      <tbody>
"KRN",.84,7981022.001,2,393,0)
       <xsl:choose>
"KRN",.84,7981022.001,2,394,0)
        <xsl:when test="$PTSLABS">
"KRN",.84,7981022.001,2,395,0)
         <xsl:for-each 
"KRN",.84,7981022.001,2,396,0)
select="LT[generate-id(.)=generate-id(key('patient-lt',@ID))]">
"KRN",.84,7981022.001,2,397,0)
          <xsl:call-template name="DAAPatientLabData">
"KRN",.84,7981022.001,2,398,0)
           <xsl:with-param name="group" select="key('patient-lt',@ID)"/>
"KRN",.84,7981022.001,2,399,0)
          </xsl:call-template>
"KRN",.84,7981022.001,2,400,0)
         </xsl:for-each>
"KRN",.84,7981022.001,2,401,0)
        </xsl:when>
"KRN",.84,7981022.001,2,402,0)
        <xsl:otherwise>
"KRN",.84,7981022.001,2,403,0)
         <xsl:for-each select="LT">
"KRN",.84,7981022.001,2,404,0)
          <xsl:sort select="concat(./*[name()=$SORT],'&#10;',NAME)" 
"KRN",.84,7981022.001,2,405,0)
order="{$SORTORD}"/>
"KRN",.84,7981022.001,2,406,0)
          <tr>
"KRN",.84,7981022.001,2,407,0)
           <xsl:call-template name="BasicDAAPatientData">
"KRN",.84,7981022.001,2,408,0)
            <xsl:with-param name="ageyes"  select="$AGE_YES"/>
"KRN",.84,7981022.001,2,409,0)
            <xsl:with-param name="dobyes"  select="$DOB_YES"/>
"KRN",.84,7981022.001,2,410,0)
            <xsl:with-param name="icnyes"  select="$ICN_YES"/>
"KRN",.84,7981022.001,2,411,0)
            <xsl:with-param name="pactyes" select="$PACT_YES"/>
"KRN",.84,7981022.001,2,412,0)
            <xsl:with-param name="pcpyes"  select="$PCP_YES"/>
"KRN",.84,7981022.001,2,413,0)
           </xsl:call-template>
"KRN",.84,7981022.001,2,414,0)
           <xsl:call-template name="BasicLRData">
"KRN",.84,7981022.001,2,415,0)
            <xsl:with-param name="name" select="LTNAME"/>
"KRN",.84,7981022.001,2,416,0)
           </xsl:call-template>
"KRN",.84,7981022.001,2,417,0)
          </tr>
"KRN",.84,7981022.001,2,418,0)
         </xsl:for-each>
"KRN",.84,7981022.001,2,419,0)
        </xsl:otherwise>
"KRN",.84,7981022.001,2,420,0)
       </xsl:choose>
"KRN",.84,7981022.001,2,421,0)
      </tbody>
"KRN",.84,7981022.001,2,422,0)
     </table>
"KRN",.84,7981022.001,2,423,0)
    </div>
"KRN",.84,7981022.001,2,424,0)
   </xsl:when>
"KRN",.84,7981022.001,2,425,0)
   <xsl:otherwise>
"KRN",.84,7981022.001,2,426,0)
    <xsl:call-template name="TableNoData"/>
"KRN",.84,7981022.001,2,427,0)
   </xsl:otherwise>
"KRN",.84,7981022.001,2,428,0)
  </xsl:choose>
"KRN",.84,7981022.001,2,429,0)
</div>
"KRN",.84,7981022.001,2,430,0)
</xsl:template>
"KRN",.84,7981022.001,2,431,0)
 
"KRN",.84,7981022.001,2,432,0)
<xsl:template match="REPORT/PATIENTS">
"KRN",.84,7981022.001,2,433,0)
<div style="page-break-before:always">
"KRN",.84,7981022.001,2,434,0)
  <h2>Patients</h2>
"KRN",.84,7981022.001,2,435,0)
  <xsl:call-template name="DataGrid"/>
"KRN",.84,7981022.001,2,436,0)
</div>
"KRN",.84,7981022.001,2,437,0)
</xsl:template>
"KRN",.84,7981022.001,2,438,0)
 
"KRN",.84,7981022.001,2,439,0)
<!--[ UTILITIES ]-->
"KRN",.84,7981022.001,2,440,0)
 
"KRN",.84,7981022.001,2,441,0)
<xsl:template name="DAADrugData">
"KRN",.84,7981022.001,2,442,0)
<xsl:param name="rowspan" select="'1'"/>
"KRN",.84,7981022.001,2,443,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981022.001,2,444,0)
  <xsl:with-param name="value" select="DAA_FILL"/>
"KRN",.84,7981022.001,2,445,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981022.001,2,446,0)
</xsl:call-template>
"KRN",.84,7981022.001,2,447,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981022.001,2,448,0)
  <xsl:with-param name="value" select="RXNAME"/>
"KRN",.84,7981022.001,2,449,0)
  <xsl:with-param name="class" select="'aLeft'"/>
"KRN",.84,7981022.001,2,450,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981022.001,2,451,0)
</xsl:call-template>
"KRN",.84,7981022.001,2,452,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981022.001,2,453,0)
  <xsl:with-param name="value" select="FILL_DATE"/>
"KRN",.84,7981022.001,2,454,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981022.001,2,455,0)
</xsl:call-template>
"KRN",.84,7981022.001,2,456,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981022.001,2,457,0)
  <xsl:with-param name="value" select="DAYSPLY"/>
"KRN",.84,7981022.001,2,458,0)
</xsl:call-template>
"KRN",.84,7981022.001,2,459,0)
</xsl:template>
"KRN",.84,7981022.001,2,460,0)
 
"KRN",.84,7981022.001,2,461,0)
<xsl:template name="DAAPatientDrugData">
"KRN",.84,7981022.001,2,462,0)
<xsl:param name="group"/>
"KRN",.84,7981022.001,2,463,0)
<xsl:param name="number" select="position()"/>
"KRN",.84,7981022.001,2,464,0)
<xsl:variable name="rowspan" select="count($group)"/>
"KRN",.84,7981022.001,2,465,0)
<xsl:for-each select="$group">
"KRN",.84,7981022.001,2,466,0)
  <tr>
"KRN",.84,7981022.001,2,467,0)
   <xsl:if test="position()=1">
"KRN",.84,7981022.001,2,468,0)
    <xsl:call-template name="BasicDAAPatientData">
"KRN",.84,7981022.001,2,469,0)
     <xsl:with-param name="number"  select="$number"/>
"KRN",.84,7981022.001,2,470,0)
     <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981022.001,2,471,0)
     <xsl:with-param name="ageyes"  select="$AGE_YES"/>
"KRN",.84,7981022.001,2,472,0)
     <xsl:with-param name="dobyes"  select="$DOB_YES"/>
"KRN",.84,7981022.001,2,473,0)
     <xsl:with-param name="icnyes"  select="$ICN_YES"/>
"KRN",.84,7981022.001,2,474,0)
     <xsl:with-param name="pactyes" select="$PACT_YES"/>
"KRN",.84,7981022.001,2,475,0)
     <xsl:with-param name="pcpyes"  select="$PCP_YES"/>
"KRN",.84,7981022.001,2,476,0)
    </xsl:call-template>
"KRN",.84,7981022.001,2,477,0)
   </xsl:if>
"KRN",.84,7981022.001,2,478,0)
   <xsl:call-template name="DAADrugData"/>
"KRN",.84,7981022.001,2,479,0)
  </tr>
"KRN",.84,7981022.001,2,480,0)
</xsl:for-each>
"KRN",.84,7981022.001,2,481,0)
</xsl:template>
"KRN",.84,7981022.001,2,482,0)
 
"KRN",.84,7981022.001,2,483,0)
<xsl:template name="DAAPatientLabData">
"KRN",.84,7981022.001,2,484,0)
<xsl:param name="group"/>
"KRN",.84,7981022.001,2,485,0)
<xsl:param name="number" select="position()"/>
"KRN",.84,7981022.001,2,486,0)
<xsl:variable name="rowspan" select="count($group)"/>
"KRN",.84,7981022.001,2,487,0)
<xsl:for-each select="$group">
"KRN",.84,7981022.001,2,488,0)
  <tr>
"KRN",.84,7981022.001,2,489,0)
   <xsl:if test="position()=1">
"KRN",.84,7981022.001,2,490,0)
   <xsl:call-template name="BasicDAAPatientData">
"KRN",.84,7981022.001,2,491,0)
     <xsl:with-param name="number"  select="$number"/>
"KRN",.84,7981022.001,2,492,0)
     <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981022.001,2,493,0)
     <xsl:with-param name="ageyes"  select="$AGE_YES"/>
"KRN",.84,7981022.001,2,494,0)
     <xsl:with-param name="dobyes"  select="$DOB_YES"/>
"KRN",.84,7981022.001,2,495,0)
     <xsl:with-param name="icnyes"  select="$ICN_YES"/>
"KRN",.84,7981022.001,2,496,0)
     <xsl:with-param name="pactyes" select="$PACT_YES"/>
"KRN",.84,7981022.001,2,497,0)
     <xsl:with-param name="pcpyes"  select="$PCP_YES"/>
"KRN",.84,7981022.001,2,498,0)
    </xsl:call-template>
"KRN",.84,7981022.001,2,499,0)
   </xsl:if>
"KRN",.84,7981022.001,2,500,0)
   <xsl:call-template name="BasicLRData">
"KRN",.84,7981022.001,2,501,0)
    <xsl:with-param name="name" select="LTNAME"/>
"KRN",.84,7981022.001,2,502,0)
   </xsl:call-template>
"KRN",.84,7981022.001,2,503,0)
  </tr>
"KRN",.84,7981022.001,2,504,0)
</xsl:for-each>
"KRN",.84,7981022.001,2,505,0)
</xsl:template>
"KRN",.84,7981022.001,2,506,0)
 
"KRN",.84,7981022.001,2,507,0)
<!--[ REPORT PARAMETERS ]-->
"KRN",.84,7981022.001,2,508,0)
 
"KRN",.84,7981022.001,2,509,0)
<xsl:template match="PARAMETERS/DATE_RANGE_4">
"KRN",.84,7981022.001,2,510,0)
<xsl:call-template name="DateRange">
"KRN",.84,7981022.001,2,511,0)
  <xsl:with-param name="title" select="'DAA Start'"/>
"KRN",.84,7981022.001,2,512,0)
</xsl:call-template>
"KRN",.84,7981022.001,2,513,0)
<xsl:if test="../WEEKS_AFTER">
"KRN",.84,7981022.001,2,514,0)
  <tr>
"KRN",.84,7981022.001,2,515,0)
   <th scope="row">DAA Lab Options:&#160;</th>
"KRN",.84,7981022.001,2,516,0)
   <td>
"KRN",.84,7981022.001,2,517,0)
     <xsl:text>Include labs done </xsl:text>
"KRN",.84,7981022.001,2,518,0)
     <xsl:value-of select="../WEEKS_AFTER"/>
"KRN",.84,7981022.001,2,519,0)
     <xsl:text> weeks after the DAA start</xsl:text>
"KRN",.84,7981022.001,2,520,0)
     <xsl:if test="(../WEEKS_AFTER[1]/@MOST_RECENT='1')">
"KRN",.84,7981022.001,2,521,0)
       <br />
"KRN",.84,7981022.001,2,522,0)
       <xsl:text>Include two most recent prior to DAA start 
"KRN",.84,7981022.001,2,523,0)
date</xsl:text>
"KRN",.84,7981022.001,2,524,0)
     </xsl:if>
"KRN",.84,7981022.001,2,525,0)
   </td>
"KRN",.84,7981022.001,2,526,0)
  </tr>
"KRN",.84,7981022.001,2,527,0)
</xsl:if>
"KRN",.84,7981022.001,2,528,0)
</xsl:template>
"KRN",.84,7981022.001,2,529,0)
 
"KRN",.84,7981022.001,2,530,0)
<xsl:template name="BasicDAAPatientHeader">
"KRN",.84,7981022.001,2,531,0)
<xsl:param name="rowspan" select="1"/>
"KRN",.84,7981022.001,2,532,0)
<xsl:param name="seqnum"  select="1"/>
"KRN",.84,7981022.001,2,533,0)
<xsl:param name="tblname" select="'PATIENTS'"/>
"KRN",.84,7981022.001,2,534,0)
<xsl:param name="ageyes"  select="''"/>
"KRN",.84,7981022.001,2,535,0)
<xsl:param name="dobyes"  select="''"/>
"KRN",.84,7981022.001,2,536,0)
<xsl:param name="icnyes"  select="''"/>
"KRN",.84,7981022.001,2,537,0)
<xsl:param name="pactyes" select="''"/>
"KRN",.84,7981022.001,2,538,0)
<xsl:param name="pcpyes"  select="''"/>
"KRN",.84,7981022.001,2,539,0)
<xsl:if test="$seqnum">
"KRN",.84,7981022.001,2,540,0)
  <xsl:call-template name="ColumnHeader">
"KRN",.84,7981022.001,2,541,0)
   <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981022.001,2,542,0)
   <xsl:with-param name="sort" select="''"/>
"KRN",.84,7981022.001,2,543,0)
   <xsl:with-param name="title" select="'#'"/>
"KRN",.84,7981022.001,2,544,0)
   <xsl:with-param name="width" select="'4%'"/>
"KRN",.84,7981022.001,2,545,0)
  </xsl:call-template>
"KRN",.84,7981022.001,2,546,0)
</xsl:if>
"KRN",.84,7981022.001,2,547,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981022.001,2,548,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981022.001,2,549,0)
  <xsl:with-param name="sort" select="concat($tblname,'=NAME')"/>
"KRN",.84,7981022.001,2,550,0)
  <xsl:with-param name="title" select="'Patient Name'"/>
"KRN",.84,7981022.001,2,551,0)
</xsl:call-template>
"KRN",.84,7981022.001,2,552,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981022.001,2,553,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981022.001,2,554,0)
  <xsl:with-param name="sort" select="concat($tblname,'=LAST4')"/>
"KRN",.84,7981022.001,2,555,0)
  <xsl:with-param name="title" select="'SSN'"/>
"KRN",.84,7981022.001,2,556,0)
  <xsl:with-param name="width" select="'4%'"/>
"KRN",.84,7981022.001,2,557,0)
</xsl:call-template>
"KRN",.84,7981022.001,2,558,0)
<xsl:if test="$ageyes">
"KRN",.84,7981022.001,2,559,0)
   <xsl:call-template name="ColumnHeader">
"KRN",.84,7981022.001,2,560,0)
    <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981022.001,2,561,0)
    <xsl:with-param name="sort" select="concat($tblname,'=AGE')"/>
"KRN",.84,7981022.001,2,562,0)
    <xsl:with-param name="title" select="'Age'"/>
"KRN",.84,7981022.001,2,563,0)
    <xsl:with-param name="width" select="'4%'"/>
"KRN",.84,7981022.001,2,564,0)
   </xsl:call-template>
"KRN",.84,7981022.001,2,565,0)
</xsl:if>
"KRN",.84,7981022.001,2,566,0)
<xsl:if test="$dobyes">
"KRN",.84,7981022.001,2,567,0)
   <xsl:call-template name="ColumnHeader">
"KRN",.84,7981022.001,2,568,0)
    <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981022.001,2,569,0)
    <xsl:with-param name="sort" select="concat($tblname,'=DOB')"/>
"KRN",.84,7981022.001,2,570,0)
    <xsl:with-param name="title" select="'Date of Birth'"/>
"KRN",.84,7981022.001,2,571,0)
    <xsl:with-param name="width" select="'7%'"/>
"KRN",.84,7981022.001,2,572,0)
   </xsl:call-template>
"KRN",.84,7981022.001,2,573,0)
</xsl:if>
"KRN",.84,7981022.001,2,574,0)
<xsl:if test="$icnyes">
"KRN",.84,7981022.001,2,575,0)
   <xsl:call-template name="ColumnHeader">
"KRN",.84,7981022.001,2,576,0)
    <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981022.001,2,577,0)
    <xsl:with-param name="sort" select="concat($tblname,'=ICN')"/>
"KRN",.84,7981022.001,2,578,0)
    <xsl:with-param name="title" select="'ICN'"/>
"KRN",.84,7981022.001,2,579,0)
    <xsl:with-param name="width" select="'13%'"/>
"KRN",.84,7981022.001,2,580,0)
   </xsl:call-template>
"KRN",.84,7981022.001,2,581,0)
</xsl:if>
"KRN",.84,7981022.001,2,582,0)
<xsl:if test="$pactyes">
"KRN",.84,7981022.001,2,583,0)
   <xsl:call-template name="ColumnHeader">
"KRN",.84,7981022.001,2,584,0)
    <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981022.001,2,585,0)
    <xsl:with-param name="sort" select="concat($tblname,'=PACT')"/>
"KRN",.84,7981022.001,2,586,0)
    <xsl:with-param name="title" select="'PACT'"/>
"KRN",.84,7981022.001,2,587,0)
    <xsl:with-param name="width" select="'16%'"/>
"KRN",.84,7981022.001,2,588,0)
   </xsl:call-template>
"KRN",.84,7981022.001,2,589,0)
</xsl:if>
"KRN",.84,7981022.001,2,590,0)
<xsl:if test="$pcpyes">
"KRN",.84,7981022.001,2,591,0)
   <xsl:call-template name="ColumnHeader">
"KRN",.84,7981022.001,2,592,0)
    <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981022.001,2,593,0)
    <xsl:with-param name="sort" select="concat($tblname,'=PCP')"/>
"KRN",.84,7981022.001,2,594,0)
    <xsl:with-param name="title" select="'PCP'"/>
"KRN",.84,7981022.001,2,595,0)
    <xsl:with-param name="width" select="'18%'"/>
"KRN",.84,7981022.001,2,596,0)
   </xsl:call-template>
"KRN",.84,7981022.001,2,597,0)
</xsl:if>
"KRN",.84,7981022.001,2,598,0)
</xsl:template>
"KRN",.84,7981022.001,2,599,0)
 
"KRN",.84,7981022.001,2,600,0)
<xsl:template name="BasicDAAPatientData">
"KRN",.84,7981022.001,2,601,0)
<xsl:param name="rowspan" select="1"/>
"KRN",.84,7981022.001,2,602,0)
<xsl:param name="seqnum"  select="1"/>
"KRN",.84,7981022.001,2,603,0)
<xsl:param name="number"  select="position()"/>
"KRN",.84,7981022.001,2,604,0)
<xsl:param name="ageyes"  select="''"/>
"KRN",.84,7981022.001,2,605,0)
<xsl:param name="dobyes"  select="''"/>
"KRN",.84,7981022.001,2,606,0)
<xsl:param name="icnyes"  select="''"/>
"KRN",.84,7981022.001,2,607,0)
<xsl:param name="pactyes" select="''"/>
"KRN",.84,7981022.001,2,608,0)
<xsl:param name="pcpyes"  select="''"/>
"KRN",.84,7981022.001,2,609,0)
<xsl:if test="$seqnum">
"KRN",.84,7981022.001,2,610,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981022.001,2,611,0)
   <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981022.001,2,612,0)
   <xsl:with-param name="value" select="$number"/>
"KRN",.84,7981022.001,2,613,0)
  </xsl:call-template>
"KRN",.84,7981022.001,2,614,0)
</xsl:if>
"KRN",.84,7981022.001,2,615,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981022.001,2,616,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981022.001,2,617,0)
  <xsl:with-param name="value" select="NAME"/>
"KRN",.84,7981022.001,2,618,0)
  <xsl:with-param name="class" select="'aLeft'"/>
"KRN",.84,7981022.001,2,619,0)
</xsl:call-template>
"KRN",.84,7981022.001,2,620,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981022.001,2,621,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981022.001,2,622,0)
  <xsl:with-param name="value" select="LAST4"/>
"KRN",.84,7981022.001,2,623,0)
</xsl:call-template>
"KRN",.84,7981022.001,2,624,0)
<xsl:if test="$ageyes">
"KRN",.84,7981022.001,2,625,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981022.001,2,626,0)
   <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981022.001,2,627,0)
   <xsl:with-param name="value" select="AGE"/>
"KRN",.84,7981022.001,2,628,0)
  </xsl:call-template>
"KRN",.84,7981022.001,2,629,0)
</xsl:if>
"KRN",.84,7981022.001,2,630,0)
<xsl:if test="$dobyes">
"KRN",.84,7981022.001,2,631,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981022.001,2,632,0)
   <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981022.001,2,633,0)
   <xsl:with-param name="value" select="DOB"/>
"KRN",.84,7981022.001,2,634,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981022.001,2,635,0)
  </xsl:call-template>
"KRN",.84,7981022.001,2,636,0)
</xsl:if>
"KRN",.84,7981022.001,2,637,0)
<xsl:if test="$icnyes">
"KRN",.84,7981022.001,2,638,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981022.001,2,639,0)
   <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981022.001,2,640,0)
   <xsl:with-param name="value" select="ICN"/>
"KRN",.84,7981022.001,2,641,0)
   <xsl:with-param name="class" select="'aLeft'"/>
"KRN",.84,7981022.001,2,642,0)
  </xsl:call-template>
"KRN",.84,7981022.001,2,643,0)
</xsl:if>
"KRN",.84,7981022.001,2,644,0)
<xsl:if test="$pactyes">
"KRN",.84,7981022.001,2,645,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981022.001,2,646,0)
   <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981022.001,2,647,0)
   <xsl:with-param name="value" select="PACT"/>
"KRN",.84,7981022.001,2,648,0)
   <xsl:with-param name="class" select="'aLeft'"/>
"KRN",.84,7981022.001,2,649,0)
  </xsl:call-template>
"KRN",.84,7981022.001,2,650,0)
</xsl:if>
"KRN",.84,7981022.001,2,651,0)
<xsl:if test="$pcpyes">
"KRN",.84,7981022.001,2,652,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981022.001,2,653,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981022.001,2,654,0)
   <xsl:with-param name="value" select="PCP"/>
"KRN",.84,7981022.001,2,655,0)
   <xsl:with-param name="class" select="'aLeft'"/>
"KRN",.84,7981022.001,2,656,0)
  </xsl:call-template>
"KRN",.84,7981022.001,2,657,0)
</xsl:if>
"KRN",.84,7981022.001,2,658,0)
</xsl:template>
"KRN",.84,7981022.001,2,659,0)
 
"KRN",.84,7981022.001,2,660,0)
</xsl:stylesheet>
"KRN",.84,7981022.001,3,0)
^.845A^1^1
"KRN",.84,7981022.001,3,1,0)
  
"KRN",.84,7981022.002,-1)
0^2
"KRN",.84,7981022.002,0)
7981022.002^2^^CLINICAL CASE REGISTRIES^DAA Lab Monitoring (CSV)
"KRN",.84,7981022.002,2,0)
^^187^187^3170803^
"KRN",.84,7981022.002,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981022.002,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981022.002,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981022.002,2,4,0)
 
"KRN",.84,7981022.002,2,5,0)
<xsl:import  href="template://report/999/2"/>  <!-- Common   -->
"KRN",.84,7981022.002,2,6,0)
<xsl:include href="template://report/997/2"/>  <!-- Patients -->
"KRN",.84,7981022.002,2,7,0)
 
"KRN",.84,7981022.002,2,8,0)
<xsl:template match="/">
"KRN",.84,7981022.002,2,9,0)
<xsl:apply-templates select="REPORT/DRUGS"/>
"KRN",.84,7981022.002,2,10,0)
<xsl:apply-templates select="REPORT/LABTESTS"/>
"KRN",.84,7981022.002,2,11,0)
<xsl:apply-templates select="REPORT/PATIENTS"/>
"KRN",.84,7981022.002,2,12,0)
</xsl:template>
"KRN",.84,7981022.002,2,13,0)
 
"KRN",.84,7981022.002,2,14,0)
<xsl:template match="REPORT/DRUGS">
"KRN",.84,7981022.002,2,15,0)
<xsl:text>DAA Lab Monitoring Report (Medications)</xsl:text>
"KRN",.84,7981022.002,2,16,0)
<xsl:value-of select="$CRLF"/>
"KRN",.84,7981022.002,2,17,0)
<xsl:text>Patient Name,SSN,</xsl:text>
"KRN",.84,7981022.002,2,18,0)
<xsl:if test="$AGE_YES">Age,</xsl:if>
"KRN",.84,7981022.002,2,19,0)
<xsl:if test="$DOB_YES">Date of Birth,</xsl:if>
"KRN",.84,7981022.002,2,20,0)
<xsl:text>DAA Start Date,Medication Name,Fill Date,Days Supply</xsl:text>
"KRN",.84,7981022.002,2,21,0)
<xsl:if test="$ICN_YES">,ICN</xsl:if>
"KRN",.84,7981022.002,2,22,0)
<xsl:if test="$PACT_YES">,PACT</xsl:if>
"KRN",.84,7981022.002,2,23,0)
<xsl:if test="$PCP_YES">,PCP</xsl:if>
"KRN",.84,7981022.002,2,24,0)
<xsl:value-of select="$CRLF"/>
"KRN",.84,7981022.002,2,25,0)
<xsl:for-each select="DRUG">
"KRN",.84,7981022.002,2,26,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981022.002,2,27,0)
   <xsl:with-param name="value" select="NAME"/>
"KRN",.84,7981022.002,2,28,0)
  </xsl:call-template>
"KRN",.84,7981022.002,2,29,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981022.002,2,30,0)
   <xsl:with-param name="value" select="LAST4"/>
"KRN",.84,7981022.002,2,31,0)
  </xsl:call-template>
"KRN",.84,7981022.002,2,32,0)
  <xsl:if test="$AGE_YES">
"KRN",.84,7981022.002,2,33,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981022.002,2,34,0)
    <xsl:with-param name="value" select="AGE"/>
"KRN",.84,7981022.002,2,35,0)
   </xsl:call-template>
"KRN",.84,7981022.002,2,36,0)
  </xsl:if>
"KRN",.84,7981022.002,2,37,0)
  <xsl:if test="$DOB_YES">
"KRN",.84,7981022.002,2,38,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981022.002,2,39,0)
    <xsl:with-param name="value" select="DOB"/>
"KRN",.84,7981022.002,2,40,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981022.002,2,41,0)
   </xsl:call-template>
"KRN",.84,7981022.002,2,42,0)
  </xsl:if>
"KRN",.84,7981022.002,2,43,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981022.002,2,44,0)
   <xsl:with-param name="value" select="DAA_FILL"/>
"KRN",.84,7981022.002,2,45,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981022.002,2,46,0)
  </xsl:call-template>
"KRN",.84,7981022.002,2,47,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981022.002,2,48,0)
   <xsl:with-param name="value" select="RXNAME"/>
"KRN",.84,7981022.002,2,49,0)
  </xsl:call-template>
"KRN",.84,7981022.002,2,50,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981022.002,2,51,0)
   <xsl:with-param name="value" select="FILL_DATE"/>
"KRN",.84,7981022.002,2,52,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981022.002,2,53,0)
  </xsl:call-template>
"KRN",.84,7981022.002,2,54,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981022.002,2,55,0)
   <xsl:with-param name="value" select="DAYSPLY"/>
"KRN",.84,7981022.002,2,56,0)
  </xsl:call-template>
"KRN",.84,7981022.002,2,57,0)
  <xsl:if test="$ICN_YES">
"KRN",.84,7981022.002,2,58,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981022.002,2,59,0)
    <xsl:with-param name="value" select="ICN"/>
"KRN",.84,7981022.002,2,60,0)
   </xsl:call-template>
"KRN",.84,7981022.002,2,61,0)
  </xsl:if>
"KRN",.84,7981022.002,2,62,0)
  <xsl:if test="$PACT_YES">
"KRN",.84,7981022.002,2,63,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981022.002,2,64,0)
    <xsl:with-param name="value" select="PACT"/>
"KRN",.84,7981022.002,2,65,0)
   </xsl:call-template>
"KRN",.84,7981022.002,2,66,0)
  </xsl:if>
"KRN",.84,7981022.002,2,67,0)
  <xsl:if test="$PCP_YES">
"KRN",.84,7981022.002,2,68,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981022.002,2,69,0)
    <xsl:with-param name="value" select="PCP"/>
"KRN",.84,7981022.002,2,70,0)
   </xsl:call-template>
"KRN",.84,7981022.002,2,71,0)
  </xsl:if>
"KRN",.84,7981022.002,2,72,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981022.002,2,73,0)
</xsl:for-each>
"KRN",.84,7981022.002,2,74,0)
<!-- xsl:value-of select="$FILESWITCH"/ -->
"KRN",.84,7981022.002,2,75,0)
</xsl:template>
"KRN",.84,7981022.002,2,76,0)
 
"KRN",.84,7981022.002,2,77,0)
<xsl:template match="REPORT/LABTESTS">
"KRN",.84,7981022.002,2,78,0)
<xsl:text>DAA Lab Monitoring Report (Lab Results)</xsl:text>
"KRN",.84,7981022.002,2,79,0)
<xsl:value-of select="$CRLF"/>
"KRN",.84,7981022.002,2,80,0)
<xsl:text>Patient Name,SSN,</xsl:text>
"KRN",.84,7981022.002,2,81,0)
<xsl:if test="$AGE_YES">Age,</xsl:if>
"KRN",.84,7981022.002,2,82,0)
<xsl:if test="$DOB_YES">Date of Birth,</xsl:if>
"KRN",.84,7981022.002,2,83,0)
<xsl:text>Date,Test Name,Result,Weeks Since DAA Start</xsl:text>
"KRN",.84,7981022.002,2,84,0)
<xsl:if test="$ICN_YES">,ICN</xsl:if>
"KRN",.84,7981022.002,2,85,0)
<xsl:if test="$PACT_YES">,PACT</xsl:if>
"KRN",.84,7981022.002,2,86,0)
<xsl:if test="$PCP_YES">,PCP</xsl:if>
"KRN",.84,7981022.002,2,87,0)
<xsl:value-of select="$CRLF"/>
"KRN",.84,7981022.002,2,88,0)
<xsl:for-each select="LT">
"KRN",.84,7981022.002,2,89,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981022.002,2,90,0)
   <xsl:with-param name="value" select="NAME"/>
"KRN",.84,7981022.002,2,91,0)
  </xsl:call-template>
"KRN",.84,7981022.002,2,92,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981022.002,2,93,0)
   <xsl:with-param name="value" select="LAST4"/>
"KRN",.84,7981022.002,2,94,0)
  </xsl:call-template>
"KRN",.84,7981022.002,2,95,0)
  <xsl:if test="$AGE_YES">
"KRN",.84,7981022.002,2,96,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981022.002,2,97,0)
    <xsl:with-param name="value" select="AGE"/>
"KRN",.84,7981022.002,2,98,0)
   </xsl:call-template>
"KRN",.84,7981022.002,2,99,0)
  </xsl:if>
"KRN",.84,7981022.002,2,100,0)
  <xsl:if test="$DOB_YES">
"KRN",.84,7981022.002,2,101,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981022.002,2,102,0)
    <xsl:with-param name="value" select="DOB"/>
"KRN",.84,7981022.002,2,103,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981022.002,2,104,0)
   </xsl:call-template>
"KRN",.84,7981022.002,2,105,0)
  </xsl:if>
"KRN",.84,7981022.002,2,106,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981022.002,2,107,0)
   <xsl:with-param name="value" select="DATE"/>
"KRN",.84,7981022.002,2,108,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981022.002,2,109,0)
  </xsl:call-template>
"KRN",.84,7981022.002,2,110,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981022.002,2,111,0)
   <xsl:with-param name="value" select="LTNAME"/>
"KRN",.84,7981022.002,2,112,0)
  </xsl:call-template>
"KRN",.84,7981022.002,2,113,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981022.002,2,114,0)
   <xsl:with-param name="value" select="RESULT"/>
"KRN",.84,7981022.002,2,115,0)
  </xsl:call-template>
"KRN",.84,7981022.002,2,116,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981022.002,2,117,0)
   <xsl:with-param name="value" select="WKS_LAB"/>
"KRN",.84,7981022.002,2,118,0)
  </xsl:call-template>
"KRN",.84,7981022.002,2,119,0)
  <xsl:if test="$ICN_YES">
"KRN",.84,7981022.002,2,120,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981022.002,2,121,0)
    <xsl:with-param name="value" select="ICN"/>
"KRN",.84,7981022.002,2,122,0)
   </xsl:call-template>
"KRN",.84,7981022.002,2,123,0)
  </xsl:if>
"KRN",.84,7981022.002,2,124,0)
  <xsl:if test="$PACT_YES">
"KRN",.84,7981022.002,2,125,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981022.002,2,126,0)
    <xsl:with-param name="value" select="PACT"/>
"KRN",.84,7981022.002,2,127,0)
   </xsl:call-template>
"KRN",.84,7981022.002,2,128,0)
  </xsl:if>
"KRN",.84,7981022.002,2,129,0)
  <xsl:if test="$PCP_YES">
"KRN",.84,7981022.002,2,130,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981022.002,2,131,0)
    <xsl:with-param name="value" select="PCP"/>
"KRN",.84,7981022.002,2,132,0)
   </xsl:call-template>
"KRN",.84,7981022.002,2,133,0)
  </xsl:if>
"KRN",.84,7981022.002,2,134,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981022.002,2,135,0)
</xsl:for-each>
"KRN",.84,7981022.002,2,136,0)
<!-- xsl:value-of select="$FILESWITCH"/ -->
"KRN",.84,7981022.002,2,137,0)
</xsl:template>
"KRN",.84,7981022.002,2,138,0)
 
"KRN",.84,7981022.002,2,139,0)
<xsl:template match="REPORT/PATIENTS">
"KRN",.84,7981022.002,2,140,0)
<xsl:text>DAA Lab Monitoring Report (Patients)</xsl:text>
"KRN",.84,7981022.002,2,141,0)
<xsl:value-of select="$CRLF"/>
"KRN",.84,7981022.002,2,142,0)
<xsl:text>Patient Name,SSN</xsl:text>
"KRN",.84,7981022.002,2,143,0)
<xsl:if test="$AGE_YES">,Age</xsl:if>
"KRN",.84,7981022.002,2,144,0)
<xsl:if test="$DOB_YES">,Date of Birth</xsl:if>
"KRN",.84,7981022.002,2,145,0)
<xsl:if test="$ICN_YES">,ICN</xsl:if>
"KRN",.84,7981022.002,2,146,0)
<xsl:if test="$PACT_YES">,PACT</xsl:if>
"KRN",.84,7981022.002,2,147,0)
<xsl:if test="$PCP_YES">,PCP</xsl:if>
"KRN",.84,7981022.002,2,148,0)
<xsl:value-of select="$CRLF"/>
"KRN",.84,7981022.002,2,149,0)
<xsl:for-each select="PATIENT">
"KRN",.84,7981022.002,2,150,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981022.002,2,151,0)
   <xsl:with-param name="value" select="NAME"/>
"KRN",.84,7981022.002,2,152,0)
  </xsl:call-template>
"KRN",.84,7981022.002,2,153,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981022.002,2,154,0)
   <xsl:with-param name="value" select="LAST4"/>
"KRN",.84,7981022.002,2,155,0)
  </xsl:call-template>
"KRN",.84,7981022.002,2,156,0)
  <xsl:if test="$AGE_YES">
"KRN",.84,7981022.002,2,157,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981022.002,2,158,0)
    <xsl:with-param name="value" select="AGE"/>
"KRN",.84,7981022.002,2,159,0)
   </xsl:call-template>
"KRN",.84,7981022.002,2,160,0)
  </xsl:if>
"KRN",.84,7981022.002,2,161,0)
  <xsl:if test="$DOB_YES">
"KRN",.84,7981022.002,2,162,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981022.002,2,163,0)
    <xsl:with-param name="value" select="DOB"/>
"KRN",.84,7981022.002,2,164,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981022.002,2,165,0)
   </xsl:call-template>
"KRN",.84,7981022.002,2,166,0)
  </xsl:if>
"KRN",.84,7981022.002,2,167,0)
  <xsl:if test="$ICN_YES">
"KRN",.84,7981022.002,2,168,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981022.002,2,169,0)
    <xsl:with-param name="value" select="ICN"/>
"KRN",.84,7981022.002,2,170,0)
   </xsl:call-template>
"KRN",.84,7981022.002,2,171,0)
  </xsl:if>
"KRN",.84,7981022.002,2,172,0)
  <xsl:if test="$PACT_YES">
"KRN",.84,7981022.002,2,173,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981022.002,2,174,0)
    <xsl:with-param name="value" select="PACT"/>
"KRN",.84,7981022.002,2,175,0)
   </xsl:call-template>
"KRN",.84,7981022.002,2,176,0)
  </xsl:if>
"KRN",.84,7981022.002,2,177,0)
  <xsl:if test="$PCP_YES">
"KRN",.84,7981022.002,2,178,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981022.002,2,179,0)
    <xsl:with-param name="value" select="PCP"/>
"KRN",.84,7981022.002,2,180,0)
   </xsl:call-template>
"KRN",.84,7981022.002,2,181,0)
  </xsl:if>
"KRN",.84,7981022.002,2,182,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981022.002,2,183,0)
</xsl:for-each>
"KRN",.84,7981022.002,2,184,0)
<!-- xsl:value-of select="$FILESWITCH"/ -->
"KRN",.84,7981022.002,2,185,0)
</xsl:template>
"KRN",.84,7981022.002,2,186,0)
 
"KRN",.84,7981022.002,2,187,0)
</xsl:stylesheet>
"KRN",.84,7981023.001,-1)
0^46
"KRN",.84,7981023.001,0)
7981023.001^2^^CLINICAL CASE REGISTRIES^Sustained Virologic Response (HTML)
"KRN",.84,7981023.001,2,0)
^.844^77^77^3170815^^
"KRN",.84,7981023.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981023.001,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981023.001,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981023.001,2,4,0)
  
"KRN",.84,7981023.001,2,5,0)
<xsl:import  href="template://report/998/1"/>  <!-- Styles   -->
"KRN",.84,7981023.001,2,6,0)
<xsl:import  href="template://report/999/1"/>  <!-- Common   -->
"KRN",.84,7981023.001,2,7,0)
<xsl:include href="template://report/997/1"/>  <!-- Patients -->
"KRN",.84,7981023.001,2,8,0)
  
"KRN",.84,7981023.001,2,9,0)
<xsl:template match="/">
"KRN",.84,7981023.001,2,10,0)
<html>
"KRN",.84,7981023.001,2,11,0)
  <head>
"KRN",.84,7981023.001,2,12,0)
   <title>Sustained Virologic Response</title>
"KRN",.84,7981023.001,2,13,0)
   <xsl:call-template name="StyleSheet"/>
"KRN",.84,7981023.001,2,14,0)
  </head>
"KRN",.84,7981023.001,2,15,0)
  <body>
"KRN",.84,7981023.001,2,16,0)
   <h1>Sustained Virologic Response</h1>
"KRN",.84,7981023.001,2,17,0)
   <xsl:call-template name="ReportHeader"/>
"KRN",.84,7981023.001,2,18,0)
   <br />
"KRN",.84,7981023.001,2,19,0)
   <!-- The following line added to fix page break issue in IE 7 -->
"KRN",.84,7981023.001,2,20,0)
   <div style="page-break-after:always; font-size:1; margin:0; 
"KRN",.84,7981023.001,2,21,0)
border:0"><span style="visibility: hidden">-</span></div>
"KRN",.84,7981023.001,2,22,0)
   <div>
"KRN",.84,7981023.001,2,23,0)
      <xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981023.001,2,24,0)
   </div>
"KRN",.84,7981023.001,2,25,0)
  </body>
"KRN",.84,7981023.001,2,26,0)
</html>
"KRN",.84,7981023.001,2,27,0)
</xsl:template>
"KRN",.84,7981023.001,2,28,0)
  
"KRN",.84,7981023.001,2,29,0)
<!--[ TABLE HEADERS ]-->
"KRN",.84,7981023.001,2,30,0)
  
"KRN",.84,7981023.001,2,31,0)
<xsl:template match="COLUMN[@NAME='HCV_DATE']">
"KRN",.84,7981023.001,2,32,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981023.001,2,33,0)
  <xsl:with-param name="title" select="'Most Recent HCV RNA Date'"/>
"KRN",.84,7981023.001,2,34,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981023.001,2,35,0)
</xsl:call-template>
"KRN",.84,7981023.001,2,36,0)
</xsl:template>
"KRN",.84,7981023.001,2,37,0)
  
"KRN",.84,7981023.001,2,38,0)
<xsl:template match="COLUMN[@NAME='HCV']">
"KRN",.84,7981023.001,2,39,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981023.001,2,40,0)
  <xsl:with-param name="title" select="'Most Recent HCV RNA'"/>
"KRN",.84,7981023.001,2,41,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981023.001,2,42,0)
</xsl:call-template>
"KRN",.84,7981023.001,2,43,0)
</xsl:template>
"KRN",.84,7981023.001,2,44,0)
  
"KRN",.84,7981023.001,2,45,0)
<xsl:template match="COLUMN[@NAME='GT']">
"KRN",.84,7981023.001,2,46,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981023.001,2,47,0)
  <xsl:with-param name="title" select="'Most Recent GT'"/>
"KRN",.84,7981023.001,2,48,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981023.001,2,49,0)
</xsl:call-template>
"KRN",.84,7981023.001,2,50,0)
</xsl:template>
"KRN",.84,7981023.001,2,51,0)
  
"KRN",.84,7981023.001,2,52,0)
<xsl:template match="COLUMN[@NAME='LAST_TAKEN']">
"KRN",.84,7981023.001,2,53,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981023.001,2,54,0)
  <xsl:with-param name="title" select="'Treatment End Date'"/>
"KRN",.84,7981023.001,2,55,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981023.001,2,56,0)
</xsl:call-template>
"KRN",.84,7981023.001,2,57,0)
</xsl:template>
"KRN",.84,7981023.001,2,58,0)
  
"KRN",.84,7981023.001,2,59,0)
<!--[ TABLE CELLS ]-->
"KRN",.84,7981023.001,2,60,0)
  
"KRN",.84,7981023.001,2,61,0)
<xsl:template match="PATIENT/HCV_DATE">
"KRN",.84,7981023.001,2,62,0)
<xsl:param name="rowspan" select="0"/>
"KRN",.84,7981023.001,2,63,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981023.001,2,64,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981023.001,2,65,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981023.001,2,66,0)
</xsl:call-template>
"KRN",.84,7981023.001,2,67,0)
</xsl:template>
"KRN",.84,7981023.001,2,68,0)
  
"KRN",.84,7981023.001,2,69,0)
<xsl:template match="PATIENT/LAST_TAKEN">
"KRN",.84,7981023.001,2,70,0)
<xsl:param name="rowspan" select="0"/>
"KRN",.84,7981023.001,2,71,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981023.001,2,72,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981023.001,2,73,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981023.001,2,74,0)
</xsl:call-template>
"KRN",.84,7981023.001,2,75,0)
</xsl:template>
"KRN",.84,7981023.001,2,76,0)
  
"KRN",.84,7981023.001,2,77,0)
</xsl:stylesheet>
"KRN",.84,7981023.001,4,0)
^.847PA^^0
"KRN",.84,7981023.002,-1)
0^9
"KRN",.84,7981023.002,0)
7981023.002^2^^CLINICAL CASE REGISTRIES^Sustained Virologic Response (CSV)
"KRN",.84,7981023.002,2,0)
^^84^84^3170815^
"KRN",.84,7981023.002,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981023.002,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981023.002,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981023.002,2,4,0)
 
"KRN",.84,7981023.002,2,5,0)
<xsl:import href="template://report/999/2"/>  <!-- Common -->
"KRN",.84,7981023.002,2,6,0)
 
"KRN",.84,7981023.002,2,7,0)
<xsl:template match="/">
"KRN",.84,7981023.002,2,8,0)
  <xsl:text>Sustained Virologic Response</xsl:text>
"KRN",.84,7981023.002,2,9,0)
  <xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981023.002,2,10,0)
</xsl:template>
"KRN",.84,7981023.002,2,11,0)
  
"KRN",.84,7981023.002,2,12,0)
<xsl:template match="COLUMN[@NAME='HCV_DATE']">
"KRN",.84,7981023.002,2,13,0)
  <xsl:value-of select="'Most Recent HCV RNA Date'"/>
"KRN",.84,7981023.002,2,14,0)
  <xsl:value-of select="$DELIMITER"/>
"KRN",.84,7981023.002,2,15,0)
</xsl:template>
"KRN",.84,7981023.002,2,16,0)
  
"KRN",.84,7981023.002,2,17,0)
<xsl:template match="COLUMN[@NAME='HCV']">
"KRN",.84,7981023.002,2,18,0)
  <xsl:value-of select="'Most Recent HCV RNA'"/>
"KRN",.84,7981023.002,2,19,0)
  <xsl:value-of select="$DELIMITER"/>
"KRN",.84,7981023.002,2,20,0)
</xsl:template>
"KRN",.84,7981023.002,2,21,0)
  
"KRN",.84,7981023.002,2,22,0)
<xsl:template match="COLUMN[@NAME='GT']">
"KRN",.84,7981023.002,2,23,0)
  <xsl:value-of select="'Most Recent GT'"/>
"KRN",.84,7981023.002,2,24,0)
  <xsl:value-of select="$DELIMITER"/>
"KRN",.84,7981023.002,2,25,0)
</xsl:template>
"KRN",.84,7981023.002,2,26,0)
  
"KRN",.84,7981023.002,2,27,0)
<xsl:template match="COLUMN[@NAME='LAST_TAKEN']">
"KRN",.84,7981023.002,2,28,0)
  <xsl:value-of select="'Treatment End Date'"/>
"KRN",.84,7981023.002,2,29,0)
  <xsl:value-of select="$DELIMITER"/>
"KRN",.84,7981023.002,2,30,0)
</xsl:template>
"KRN",.84,7981023.002,2,31,0)
  
"KRN",.84,7981023.002,2,32,0)
<xsl:template match="PATIENTS/PATIENT">
"KRN",.84,7981023.002,2,33,0)
  <xsl:variable name="ptname" select="NAME"/>
"KRN",.84,7981023.002,2,34,0)
  <xsl:variable name="ssn" select="LAST4"/>
"KRN",.84,7981023.002,2,35,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981023.002,2,36,0)
    <xsl:with-param name="value" select="$ptname"/>
"KRN",.84,7981023.002,2,37,0)
  </xsl:call-template>
"KRN",.84,7981023.002,2,38,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981023.002,2,39,0)
   <xsl:with-param name="value" select="$ssn"/>
"KRN",.84,7981023.002,2,40,0)
  </xsl:call-template>
"KRN",.84,7981023.002,2,41,0)
  <xsl:if test="$AGE_YES">
"KRN",.84,7981023.002,2,42,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981023.002,2,43,0)
    <xsl:with-param name="value" select="AGE"/>
"KRN",.84,7981023.002,2,44,0)
   </xsl:call-template>
"KRN",.84,7981023.002,2,45,0)
  </xsl:if>
"KRN",.84,7981023.002,2,46,0)
  <xsl:if test="$DOB_YES">
"KRN",.84,7981023.002,2,47,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981023.002,2,48,0)
    <xsl:with-param name="value" select="DOB"/>
"KRN",.84,7981023.002,2,49,0)
    <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981023.002,2,50,0)
   </xsl:call-template>
"KRN",.84,7981023.002,2,51,0)
  </xsl:if>
"KRN",.84,7981023.002,2,52,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981023.002,2,53,0)
   <xsl:with-param name="value" select="HCV_DATE"/>
"KRN",.84,7981023.002,2,54,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981023.002,2,55,0)
  </xsl:call-template>
"KRN",.84,7981023.002,2,56,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981023.002,2,57,0)
   <xsl:with-param name="value" select="HCV"/>
"KRN",.84,7981023.002,2,58,0)
  </xsl:call-template>
"KRN",.84,7981023.002,2,59,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981023.002,2,60,0)
   <xsl:with-param name="value" select="GT"/>
"KRN",.84,7981023.002,2,61,0)
  </xsl:call-template>
"KRN",.84,7981023.002,2,62,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981023.002,2,63,0)
   <xsl:with-param name="value" select="LAST_TAKEN"/>
"KRN",.84,7981023.002,2,64,0)
   <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981023.002,2,65,0)
  </xsl:call-template>
"KRN",.84,7981023.002,2,66,0)
  <xsl:if test="$ICN_YES">
"KRN",.84,7981023.002,2,67,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981023.002,2,68,0)
    <xsl:with-param name="value" select="ICN"/>
"KRN",.84,7981023.002,2,69,0)
   </xsl:call-template>
"KRN",.84,7981023.002,2,70,0)
  </xsl:if>
"KRN",.84,7981023.002,2,71,0)
  <xsl:if test="$PACT_YES">
"KRN",.84,7981023.002,2,72,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981023.002,2,73,0)
    <xsl:with-param name="value" select="PACT"/>
"KRN",.84,7981023.002,2,74,0)
   </xsl:call-template>
"KRN",.84,7981023.002,2,75,0)
  </xsl:if>
"KRN",.84,7981023.002,2,76,0)
  <xsl:if test="$PCP_YES">
"KRN",.84,7981023.002,2,77,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981023.002,2,78,0)
    <xsl:with-param name="value" select="PCP"/>
"KRN",.84,7981023.002,2,79,0)
   </xsl:call-template>
"KRN",.84,7981023.002,2,80,0)
  </xsl:if>
"KRN",.84,7981023.002,2,81,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981023.002,2,82,0)
</xsl:template>  
"KRN",.84,7981023.002,2,83,0)
 
"KRN",.84,7981023.002,2,84,0)
</xsl:stylesheet>
"KRN",.84,7981024.002,-1)
0^12
"KRN",.84,7981024.002,0)
7981024.002^2^^CLINICAL CASE REGISTRIES^Hepatitis A Report (CSV)
"KRN",.84,7981024.002,2,0)
^^253^253^3170804^
"KRN",.84,7981024.002,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981024.002,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981024.002,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981024.002,2,4,0)
 
"KRN",.84,7981024.002,2,5,0)
<xsl:import href="template://report/999/2"/>  <!-- Common   -->
"KRN",.84,7981024.002,2,6,0)
 
"KRN",.84,7981024.002,2,7,0)
<xsl:variable name="D1" 
"KRN",.84,7981024.002,2,8,0)
select="/REPORT/PATIENTS/PATIENT/LABTESTS[1]/LTNAME"/>
"KRN",.84,7981024.002,2,9,0)
<xsl:variable name="D2" 
"KRN",.84,7981024.002,2,10,0)
select="/REPORT/PATIENTS/PATIENT/VACCINES/VACCINE[1]/VAC_NAME"/>
"KRN",.84,7981024.002,2,11,0)
 
"KRN",.84,7981024.002,2,12,0)
<xsl:template match="/">
"KRN",.84,7981024.002,2,13,0)
  <xsl:text>Hepatitis A report</xsl:text>
"KRN",.84,7981024.002,2,14,0)
  <xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981024.002,2,15,0)
</xsl:template>
"KRN",.84,7981024.002,2,16,0)
 
"KRN",.84,7981024.002,2,17,0)
<xsl:template match="PATIENTS/PATIENT">
"KRN",.84,7981024.002,2,18,0)
  <xsl:variable name="ptname" select="NAME"/>
"KRN",.84,7981024.002,2,19,0)
  <xsl:variable name="ssn"  select="LAST4"/>
"KRN",.84,7981024.002,2,20,0)
  <xsl:variable name="age"  select="AGE"/>
"KRN",.84,7981024.002,2,21,0)
  <xsl:variable name="dob"  select="DOB"/>
"KRN",.84,7981024.002,2,22,0)
  <xsl:variable name="dod"  select="DOD"/>
"KRN",.84,7981024.002,2,23,0)
  <xsl:variable name="icn"  select="ICN"/>
"KRN",.84,7981024.002,2,24,0)
  <xsl:variable name="pact" select="PACT"/>
"KRN",.84,7981024.002,2,25,0)
  <xsl:variable name="pcp"  select="PCP"/>
"KRN",.84,7981024.002,2,26,0)
  <xsl:variable name="ltname" select="LABTESTS/LTNAME"/>
"KRN",.84,7981024.002,2,27,0)
  <xsl:variable name="ltdate" select="LABTESTS/DATE"/>
"KRN",.84,7981024.002,2,28,0)
  <xsl:variable name="ltresult" select="LABTESTS/RESULT"/>
"KRN",.84,7981024.002,2,29,0)
 
"KRN",.84,7981024.002,2,30,0)
  <xsl:choose>
"KRN",.84,7981024.002,2,31,0)
    <xsl:when test="($D2 and $D1) or $D2">
"KRN",.84,7981024.002,2,32,0)
      <xsl:for-each select="VACCINES/VACCINE">
"KRN",.84,7981024.002,2,33,0)
        <xsl:call-template name="TableCell">
"KRN",.84,7981024.002,2,34,0)
          <xsl:with-param name="value" select="$ptname"/>
"KRN",.84,7981024.002,2,35,0)
        </xsl:call-template>
"KRN",.84,7981024.002,2,36,0)
        <xsl:call-template name="TableCell">
"KRN",.84,7981024.002,2,37,0)
          <xsl:with-param name="value" select="$ssn"/>
"KRN",.84,7981024.002,2,38,0)
        </xsl:call-template>
"KRN",.84,7981024.002,2,39,0)
        <xsl:if test="$AGE_YES">
"KRN",.84,7981024.002,2,40,0)
          <xsl:call-template name="TableCell">
"KRN",.84,7981024.002,2,41,0)
            <xsl:with-param name="value" select="$age"/>
"KRN",.84,7981024.002,2,42,0)
          </xsl:call-template>
"KRN",.84,7981024.002,2,43,0)
        </xsl:if>
"KRN",.84,7981024.002,2,44,0)
        <xsl:if test="$DOB_YES">
"KRN",.84,7981024.002,2,45,0)
          <xsl:call-template name="TableCell">
"KRN",.84,7981024.002,2,46,0)
            <xsl:with-param name="value" select="$dob"/>
"KRN",.84,7981024.002,2,47,0)
            <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981024.002,2,48,0)
          </xsl:call-template>
"KRN",.84,7981024.002,2,49,0)
        </xsl:if>
"KRN",.84,7981024.002,2,50,0)
        <xsl:call-template name="TableCell">
"KRN",.84,7981024.002,2,51,0)
          <xsl:with-param name="value" select="$dod"/>
"KRN",.84,7981024.002,2,52,0)
          <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981024.002,2,53,0)
        </xsl:call-template>
"KRN",.84,7981024.002,2,54,0)
 
"KRN",.84,7981024.002,2,55,0)
        <xsl:call-template name="TableCell">
"KRN",.84,7981024.002,2,56,0)
          <xsl:with-param name="value" select="VAC_NAME"/>
"KRN",.84,7981024.002,2,57,0)
        </xsl:call-template>
"KRN",.84,7981024.002,2,58,0)
        <xsl:call-template name="TableCell">
"KRN",.84,7981024.002,2,59,0)
          <xsl:with-param name="value" select="VAC_DATE"/>
"KRN",.84,7981024.002,2,60,0)
          <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981024.002,2,61,0)
        </xsl:call-template>
"KRN",.84,7981024.002,2,62,0)
 
"KRN",.84,7981024.002,2,63,0)
        <xsl:if test="$D1">
"KRN",.84,7981024.002,2,64,0)
          <xsl:call-template name="TableCell">
"KRN",.84,7981024.002,2,65,0)
            <xsl:with-param name="value" select="$ltname"/>
"KRN",.84,7981024.002,2,66,0)
          </xsl:call-template>
"KRN",.84,7981024.002,2,67,0)
          <xsl:call-template name="TableCell">
"KRN",.84,7981024.002,2,68,0)
            <xsl:with-param name="value" select="$ltdate"/>
"KRN",.84,7981024.002,2,69,0)
            <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981024.002,2,70,0)
          </xsl:call-template>
"KRN",.84,7981024.002,2,71,0)
          <xsl:call-template name="TableCell">
"KRN",.84,7981024.002,2,72,0)
            <xsl:with-param name="value" select="$ltresult"/>
"KRN",.84,7981024.002,2,73,0)
          </xsl:call-template>
"KRN",.84,7981024.002,2,74,0)
        </xsl:if>
"KRN",.84,7981024.002,2,75,0)
 
"KRN",.84,7981024.002,2,76,0)
        <xsl:if test="$ICN_YES">
"KRN",.84,7981024.002,2,77,0)
          <xsl:call-template name="TableCell">
"KRN",.84,7981024.002,2,78,0)
            <xsl:with-param name="value" select="$icn"/>
"KRN",.84,7981024.002,2,79,0)
          </xsl:call-template>
"KRN",.84,7981024.002,2,80,0)
        </xsl:if>
"KRN",.84,7981024.002,2,81,0)
        <xsl:if test="$PACT_YES">
"KRN",.84,7981024.002,2,82,0)
          <xsl:call-template name="TableCell">
"KRN",.84,7981024.002,2,83,0)
            <xsl:with-param name="value" select="$pact"/>
"KRN",.84,7981024.002,2,84,0)
          </xsl:call-template>
"KRN",.84,7981024.002,2,85,0)
        </xsl:if>
"KRN",.84,7981024.002,2,86,0)
        <xsl:if test="$PCP_YES">
"KRN",.84,7981024.002,2,87,0)
          <xsl:call-template name="TableCell">
"KRN",.84,7981024.002,2,88,0)
            <xsl:with-param name="value" select="$pcp"/>
"KRN",.84,7981024.002,2,89,0)
         </xsl:call-template>
"KRN",.84,7981024.002,2,90,0)
        </xsl:if>
"KRN",.84,7981024.002,2,91,0)
        <xsl:value-of select="$CRLF"/>
"KRN",.84,7981024.002,2,92,0)
      </xsl:for-each>
"KRN",.84,7981024.002,2,93,0)
    </xsl:when>
"KRN",.84,7981024.002,2,94,0)
 
"KRN",.84,7981024.002,2,95,0)
    <xsl:when test="$D1">
"KRN",.84,7981024.002,2,96,0)
      <xsl:for-each select="LABTESTS">
"KRN",.84,7981024.002,2,97,0)
        <xsl:call-template name="TableCell">
"KRN",.84,7981024.002,2,98,0)
          <xsl:with-param name="value" select="$ptname"/>
"KRN",.84,7981024.002,2,99,0)
        </xsl:call-template>
"KRN",.84,7981024.002,2,100,0)
        <xsl:call-template name="TableCell">
"KRN",.84,7981024.002,2,101,0)
          <xsl:with-param name="value" select="$ssn"/>
"KRN",.84,7981024.002,2,102,0)
        </xsl:call-template>
"KRN",.84,7981024.002,2,103,0)
        <xsl:if test="$AGE_YES">
"KRN",.84,7981024.002,2,104,0)
          <xsl:call-template name="TableCell">
"KRN",.84,7981024.002,2,105,0)
            <xsl:with-param name="value" select="$age"/>
"KRN",.84,7981024.002,2,106,0)
          </xsl:call-template>
"KRN",.84,7981024.002,2,107,0)
        </xsl:if>
"KRN",.84,7981024.002,2,108,0)
        <xsl:if test="$DOB_YES">
"KRN",.84,7981024.002,2,109,0)
          <xsl:call-template name="TableCell">
"KRN",.84,7981024.002,2,110,0)
            <xsl:with-param name="value" select="$dob"/>
"KRN",.84,7981024.002,2,111,0)
            <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981024.002,2,112,0)
          </xsl:call-template>
"KRN",.84,7981024.002,2,113,0)
        </xsl:if>
"KRN",.84,7981024.002,2,114,0)
        <xsl:call-template name="TableCell">
"KRN",.84,7981024.002,2,115,0)
          <xsl:with-param name="value" select="$dod"/>
"KRN",.84,7981024.002,2,116,0)
          <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981024.002,2,117,0)
        </xsl:call-template>
"KRN",.84,7981024.002,2,118,0)
        <xsl:call-template name="TableCell">
"KRN",.84,7981024.002,2,119,0)
          <xsl:with-param name="value" select="$ltname"/>
"KRN",.84,7981024.002,2,120,0)
        </xsl:call-template>
"KRN",.84,7981024.002,2,121,0)
        <xsl:call-template name="TableCell">
"KRN",.84,7981024.002,2,122,0)
          <xsl:with-param name="value" select="$ltdate"/>
"KRN",.84,7981024.002,2,123,0)
         <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981024.002,2,124,0)
        </xsl:call-template>
"KRN",.84,7981024.002,2,125,0)
        <xsl:call-template name="TableCell">
"KRN",.84,7981024.002,2,126,0)
          <xsl:with-param name="value" select="$ltresult"/>
"KRN",.84,7981024.002,2,127,0)
        </xsl:call-template>
"KRN",.84,7981024.002,2,128,0)
        <xsl:if test="$ICN_YES">
"KRN",.84,7981024.002,2,129,0)
          <xsl:call-template name="TableCell">
"KRN",.84,7981024.002,2,130,0)
            <xsl:with-param name="value" select="$icn"/>
"KRN",.84,7981024.002,2,131,0)
          </xsl:call-template>
"KRN",.84,7981024.002,2,132,0)
        </xsl:if>
"KRN",.84,7981024.002,2,133,0)
        <xsl:if test="$PACT_YES">
"KRN",.84,7981024.002,2,134,0)
          <xsl:call-template name="TableCell">
"KRN",.84,7981024.002,2,135,0)
            <xsl:with-param name="value" select="$pact"/>
"KRN",.84,7981024.002,2,136,0)
          </xsl:call-template>
"KRN",.84,7981024.002,2,137,0)
        </xsl:if>
"KRN",.84,7981024.002,2,138,0)
        <xsl:if test="$PCP_YES">
"KRN",.84,7981024.002,2,139,0)
          <xsl:call-template name="TableCell">
"KRN",.84,7981024.002,2,140,0)
            <xsl:with-param name="value" select="$pcp"/>
"KRN",.84,7981024.002,2,141,0)
          </xsl:call-template>
"KRN",.84,7981024.002,2,142,0)
        </xsl:if>
"KRN",.84,7981024.002,2,143,0)
        <xsl:value-of select="$CRLF"/>
"KRN",.84,7981024.002,2,144,0)
      </xsl:for-each>
"KRN",.84,7981024.002,2,145,0)
    </xsl:when>
"KRN",.84,7981024.002,2,146,0)
      
"KRN",.84,7981024.002,2,147,0)
    <xsl:otherwise>
"KRN",.84,7981024.002,2,148,0)
      <xsl:call-template name="TableCell">
"KRN",.84,7981024.002,2,149,0)
        <xsl:with-param name="value" select="$ptname"/>
"KRN",.84,7981024.002,2,150,0)
      </xsl:call-template>
"KRN",.84,7981024.002,2,151,0)
      <xsl:call-template name="TableCell">
"KRN",.84,7981024.002,2,152,0)
        <xsl:with-param name="value" select="$ssn"/>
"KRN",.84,7981024.002,2,153,0)
      </xsl:call-template>
"KRN",.84,7981024.002,2,154,0)
      <xsl:if test="$AGE_YES">
"KRN",.84,7981024.002,2,155,0)
        <xsl:call-template name="TableCell">
"KRN",.84,7981024.002,2,156,0)
          <xsl:with-param name="value" select="$age"/>
"KRN",.84,7981024.002,2,157,0)
        </xsl:call-template>
"KRN",.84,7981024.002,2,158,0)
      </xsl:if>
"KRN",.84,7981024.002,2,159,0)
      <xsl:if test="$DOB_YES">
"KRN",.84,7981024.002,2,160,0)
        <xsl:call-template name="TableCell">
"KRN",.84,7981024.002,2,161,0)
          <xsl:with-param name="value" select="$dob"/>
"KRN",.84,7981024.002,2,162,0)
          <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981024.002,2,163,0)
        </xsl:call-template>
"KRN",.84,7981024.002,2,164,0)
      </xsl:if>
"KRN",.84,7981024.002,2,165,0)
      <xsl:call-template name="TableCell">
"KRN",.84,7981024.002,2,166,0)
        <xsl:with-param name="value" select="$dod"/>
"KRN",.84,7981024.002,2,167,0)
        <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981024.002,2,168,0)
      </xsl:call-template>
"KRN",.84,7981024.002,2,169,0)
      <xsl:if test="$ICN_YES">
"KRN",.84,7981024.002,2,170,0)
        <xsl:call-template name="TableCell">
"KRN",.84,7981024.002,2,171,0)
          <xsl:with-param name="value" select="$icn"/>
"KRN",.84,7981024.002,2,172,0)
        </xsl:call-template>
"KRN",.84,7981024.002,2,173,0)
      </xsl:if>
"KRN",.84,7981024.002,2,174,0)
      <xsl:if test="$PACT_YES">
"KRN",.84,7981024.002,2,175,0)
        <xsl:call-template name="TableCell">
"KRN",.84,7981024.002,2,176,0)
          <xsl:with-param name="value" select="$pact"/>
"KRN",.84,7981024.002,2,177,0)
        </xsl:call-template>
"KRN",.84,7981024.002,2,178,0)
      </xsl:if>
"KRN",.84,7981024.002,2,179,0)
      <xsl:if test="$PCP_YES">
"KRN",.84,7981024.002,2,180,0)
        <xsl:call-template name="TableCell">
"KRN",.84,7981024.002,2,181,0)
          <xsl:with-param name="value" select="$pcp"/>
"KRN",.84,7981024.002,2,182,0)
        </xsl:call-template>
"KRN",.84,7981024.002,2,183,0)
      </xsl:if>
"KRN",.84,7981024.002,2,184,0)
      <xsl:value-of select="$CRLF"/>
"KRN",.84,7981024.002,2,185,0)
    </xsl:otherwise>
"KRN",.84,7981024.002,2,186,0)
  </xsl:choose>
"KRN",.84,7981024.002,2,187,0)
</xsl:template>
"KRN",.84,7981024.002,2,188,0)
 
"KRN",.84,7981024.002,2,189,0)
<xsl:template match="COLUMN[@NAME='VAC_NAME']">
"KRN",.84,7981024.002,2,190,0)
  <xsl:if test="$D2">
"KRN",.84,7981024.002,2,191,0)
   <xsl:call-template name="ColumnHeader">
"KRN",.84,7981024.002,2,192,0)
      <xsl:with-param name="title" select="'Vaccine Name'"/>
"KRN",.84,7981024.002,2,193,0)
    </xsl:call-template>
"KRN",.84,7981024.002,2,194,0)
  </xsl:if>
"KRN",.84,7981024.002,2,195,0)
</xsl:template>
"KRN",.84,7981024.002,2,196,0)
 
"KRN",.84,7981024.002,2,197,0)
<xsl:template match="COLUMN[@NAME='VAC_DATE']">
"KRN",.84,7981024.002,2,198,0)
  <xsl:if test="$D2">
"KRN",.84,7981024.002,2,199,0)
    <xsl:call-template name="ColumnHeader">
"KRN",.84,7981024.002,2,200,0)
      <xsl:with-param name="title" select="'Vaccine Date'"/>
"KRN",.84,7981024.002,2,201,0)
    </xsl:call-template>
"KRN",.84,7981024.002,2,202,0)
  </xsl:if>
"KRN",.84,7981024.002,2,203,0)
</xsl:template>
"KRN",.84,7981024.002,2,204,0)
 
"KRN",.84,7981024.002,2,205,0)
<xsl:template match="COLUMN[@NAME='LTNAME']">
"KRN",.84,7981024.002,2,206,0)
  <xsl:if test="$D1">
"KRN",.84,7981024.002,2,207,0)
    <xsl:call-template name="ColumnHeader">
"KRN",.84,7981024.002,2,208,0)
      <xsl:with-param name="title" select="'Test Name'"/>
"KRN",.84,7981024.002,2,209,0)
    </xsl:call-template>
"KRN",.84,7981024.002,2,210,0)
  </xsl:if>
"KRN",.84,7981024.002,2,211,0)
</xsl:template>
"KRN",.84,7981024.002,2,212,0)
 
"KRN",.84,7981024.002,2,213,0)
<xsl:template match="COLUMN[@NAME='DATE']">
"KRN",.84,7981024.002,2,214,0)
  <xsl:if test="$D1">
"KRN",.84,7981024.002,2,215,0)
    <xsl:call-template name="ColumnHeader">
"KRN",.84,7981024.002,2,216,0)
      <xsl:with-param name="title" select="'Test Date'"/>
"KRN",.84,7981024.002,2,217,0)
    </xsl:call-template>
"KRN",.84,7981024.002,2,218,0)
  </xsl:if>
"KRN",.84,7981024.002,2,219,0)
</xsl:template>
"KRN",.84,7981024.002,2,220,0)
 
"KRN",.84,7981024.002,2,221,0)
<xsl:template match="COLUMN[@NAME='RESULT']">
"KRN",.84,7981024.002,2,222,0)
  <xsl:if test="$D1">
"KRN",.84,7981024.002,2,223,0)
    <xsl:call-template name="ColumnHeader">
"KRN",.84,7981024.002,2,224,0)
      <xsl:with-param name="title" select="'Result'"/>
"KRN",.84,7981024.002,2,225,0)
    </xsl:call-template>
"KRN",.84,7981024.002,2,226,0)
  </xsl:if>
"KRN",.84,7981024.002,2,227,0)
</xsl:template>
"KRN",.84,7981024.002,2,228,0)
 
"KRN",.84,7981024.002,2,229,0)
<xsl:template match="COLUMN[@NAME='ICN']">
"KRN",.84,7981024.002,2,230,0)
  <xsl:if test="$ICN_YES">
"KRN",.84,7981024.002,2,231,0)
    <xsl:call-template name="ColumnHeader">
"KRN",.84,7981024.002,2,232,0)
      <xsl:with-param name="title" select="'ICN'"/>
"KRN",.84,7981024.002,2,233,0)
    </xsl:call-template>
"KRN",.84,7981024.002,2,234,0)
  </xsl:if>
"KRN",.84,7981024.002,2,235,0)
</xsl:template>
"KRN",.84,7981024.002,2,236,0)
 
"KRN",.84,7981024.002,2,237,0)
<xsl:template match="COLUMN[@NAME='PACT']">
"KRN",.84,7981024.002,2,238,0)
  <xsl:if test="$PACT_YES">
"KRN",.84,7981024.002,2,239,0)
    <xsl:call-template name="ColumnHeader">
"KRN",.84,7981024.002,2,240,0)
      <xsl:with-param name="title" select="'PACT'"/>
"KRN",.84,7981024.002,2,241,0)
    </xsl:call-template>
"KRN",.84,7981024.002,2,242,0)
  </xsl:if>
"KRN",.84,7981024.002,2,243,0)
</xsl:template>
"KRN",.84,7981024.002,2,244,0)
 
"KRN",.84,7981024.002,2,245,0)
<xsl:template match="COLUMN[@NAME='PCP']">
"KRN",.84,7981024.002,2,246,0)
  <xsl:if test="$PCP_YES">
"KRN",.84,7981024.002,2,247,0)
    <xsl:call-template name="ColumnHeader">
"KRN",.84,7981024.002,2,248,0)
      <xsl:with-param name="title" select="'PCP'"/>
"KRN",.84,7981024.002,2,249,0)
    </xsl:call-template>
"KRN",.84,7981024.002,2,250,0)
  </xsl:if>
"KRN",.84,7981024.002,2,251,0)
</xsl:template>
"KRN",.84,7981024.002,2,252,0)
 
"KRN",.84,7981024.002,2,253,0)
</xsl:stylesheet>
"KRN",.84,7981025.001,-1)
0^16
"KRN",.84,7981025.001,0)
7981025.001^2^^CLINICAL CASE REGISTRIES^Hepatitis B Report (HTML)
"KRN",.84,7981025.001,2,0)
^^276^276^3170804^
"KRN",.84,7981025.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981025.001,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981025.001,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981025.001,2,4,0)
 
"KRN",.84,7981025.001,2,5,0)
<xsl:import  href="template://report/998/1"/>  <!-- Styles   -->
"KRN",.84,7981025.001,2,6,0)
<xsl:import  href="template://report/999/1"/>  <!-- Common   -->
"KRN",.84,7981025.001,2,7,0)
<xsl:include href="template://report/997/1"/>  <!-- Patients -->
"KRN",.84,7981025.001,2,8,0)
 
"KRN",.84,7981025.001,2,9,0)
<!-- Determine if vaccine parameters have been chosen for the report -->
"KRN",.84,7981025.001,2,10,0)
<xsl:variable name="D1" 
"KRN",.84,7981025.001,2,11,0)
select="/REPORT/PATIENTS/PATIENT/LABTESTS[1]/LTNAME"/>
"KRN",.84,7981025.001,2,12,0)
<xsl:variable name="D2" 
"KRN",.84,7981025.001,2,13,0)
select="/REPORT/PATIENTS/PATIENT/VACCINES/VACCINE[1]/VAC_NAME"/>
"KRN",.84,7981025.001,2,14,0)
<xsl:variable name="D3" select="REPORT/PARAMETERS/DATE_RANGE_7"/>
"KRN",.84,7981025.001,2,15,0)
 
"KRN",.84,7981025.001,2,16,0)
<xsl:template match="/">
"KRN",.84,7981025.001,2,17,0)
  <html>
"KRN",.84,7981025.001,2,18,0)
    <head>
"KRN",.84,7981025.001,2,19,0)
      <title>Hepatitis B Report</title>
"KRN",.84,7981025.001,2,20,0)
      <xsl:call-template name="StyleSheet"/>
"KRN",.84,7981025.001,2,21,0)
    </head>
"KRN",.84,7981025.001,2,22,0)
    <body>
"KRN",.84,7981025.001,2,23,0)
      <h1>Hepatitis B Report</h1>
"KRN",.84,7981025.001,2,24,0)
      <xsl:call-template name="ReportHeader"/>
"KRN",.84,7981025.001,2,25,0)
      <div style="margin:10; color: red; font-weight: bold">
"KRN",.84,7981025.001,2,26,0)
 
"KRN",.84,7981025.001,2,27,0)
        <xsl:if test="$D3">
"KRN",.84,7981025.001,2,28,0)
          Lab tests used to calculate scores are identified by LOINC code.
"KRN",.84,7981025.001,2,29,0)
          If the values shown for test results appear unusual,
"KRN",.84,7981025.001,2,30,0)
          contact your local Lab ADPAC to verify that LOINC codes are set 
"KRN",.84,7981025.001,2,31,0)
up
"KRN",.84,7981025.001,2,32,0)
          correctly. The LOINC codes that are used are:
"KRN",.84,7981025.001,2,33,0)
          <br/>
"KRN",.84,7981025.001,2,34,0)
          <xsl:call-template name="ShowLOINCCodes"/>
"KRN",.84,7981025.001,2,35,0)
        </xsl:if>
"KRN",.84,7981025.001,2,36,0)
      </div>
"KRN",.84,7981025.001,2,37,0)
      <xsl:if test="count(/REPORT/PATIENTS/*) > 0">
"KRN",.84,7981025.001,2,38,0)
        <br />
"KRN",.84,7981025.001,2,39,0)
        <!-- The following line changed to fix page break issue in IE 7 
"KRN",.84,7981025.001,2,40,0)
-->
"KRN",.84,7981025.001,2,41,0)
        <div style="page-break-after:always; font-size:1; margin:0; 
"KRN",.84,7981025.001,2,42,0)
border:0">
"KRN",.84,7981025.001,2,43,0)
          <span style="visibility: hidden">-</span>
"KRN",.84,7981025.001,2,44,0)
        </div>
"KRN",.84,7981025.001,2,45,0)
        <div>
"KRN",.84,7981025.001,2,46,0)
          <xsl:call-template name="MakeScrollable">
"KRN",.84,7981025.001,2,47,0)
            <xsl:with-param name="condition" select="*[31]"/>
"KRN",.84,7981025.001,2,48,0)
          </xsl:call-template>
"KRN",.84,7981025.001,2,49,0)
          <xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981025.001,2,50,0)
        </div>
"KRN",.84,7981025.001,2,51,0)
      </xsl:if>
"KRN",.84,7981025.001,2,52,0)
    </body>
"KRN",.84,7981025.001,2,53,0)
  </html>
"KRN",.84,7981025.001,2,54,0)
</xsl:template>
"KRN",.84,7981025.001,2,55,0)
 
"KRN",.84,7981025.001,2,56,0)
<xsl:template name="ShowLOINCCodes">
"KRN",.84,7981025.001,2,57,0)
  <table cellpadding="5" cellspacing="0">
"KRN",.84,7981025.001,2,58,0)
    <thead>
"KRN",.84,7981025.001,2,59,0)
      <tr>
"KRN",.84,7981025.001,2,60,0)
        <th>LOINC Codes</th>
"KRN",.84,7981025.001,2,61,0)
      </tr>
"KRN",.84,7981025.001,2,62,0)
    </thead>
"KRN",.84,7981025.001,2,63,0)
    <tbody>
"KRN",.84,7981025.001,2,64,0)
      <xsl:for-each select="/REPORT/LOINC_CODES/CODE">
"KRN",.84,7981025.001,2,65,0)
        <tr>
"KRN",.84,7981025.001,2,66,0)
          <td class="aLeft">
"KRN",.84,7981025.001,2,67,0)
            <xsl:value-of select="@CODE"/>
"KRN",.84,7981025.001,2,68,0)
          </td>
"KRN",.84,7981025.001,2,69,0)
        </tr>
"KRN",.84,7981025.001,2,70,0)
      </xsl:for-each>
"KRN",.84,7981025.001,2,71,0)
    </tbody>
"KRN",.84,7981025.001,2,72,0)
  </table>
"KRN",.84,7981025.001,2,73,0)
</xsl:template>
"KRN",.84,7981025.001,2,74,0)
 
"KRN",.84,7981025.001,2,75,0)
<!--[ TABLE HEADERS ]-->
"KRN",.84,7981025.001,2,76,0)
 
"KRN",.84,7981025.001,2,77,0)
<xsl:template match="PARAMETERS/DATE_RANGE_6">
"KRN",.84,7981025.001,2,78,0)
  <xsl:if test="$D2">
"KRN",.84,7981025.001,2,79,0)
    <xsl:call-template name="DateRange">
"KRN",.84,7981025.001,2,80,0)
     <xsl:with-param name="title" select="'Vaccination'"/>
"KRN",.84,7981025.001,2,81,0)
    </xsl:call-template>
"KRN",.84,7981025.001,2,82,0)
  </xsl:if>
"KRN",.84,7981025.001,2,83,0)
</xsl:template>
"KRN",.84,7981025.001,2,84,0)
 
"KRN",.84,7981025.001,2,85,0)
<xsl:template match="PARAMETERS/DATE_RANGE_7">
"KRN",.84,7981025.001,2,86,0)
  <xsl:if test="$D1">
"KRN",.84,7981025.001,2,87,0)
    <xsl:call-template name="DateRange">
"KRN",.84,7981025.001,2,88,0)
     <xsl:with-param name="title" select="'Immunity'"/>
"KRN",.84,7981025.001,2,89,0)
    </xsl:call-template>
"KRN",.84,7981025.001,2,90,0)
  </xsl:if>
"KRN",.84,7981025.001,2,91,0)
</xsl:template>
"KRN",.84,7981025.001,2,92,0)
 
"KRN",.84,7981025.001,2,93,0)
<xsl:template match="HEADER/TBLDEF[@NAME='PATIENTS']/@HEADER">
"KRN",.84,7981025.001,2,94,0)
  <xsl:variable name="PTCOLS" select="../COLUMN[@NAME='PATIENTS']"/>
"KRN",.84,7981025.001,2,95,0)
  <xsl:variable name="VACLST" select="../COLUMN[@NAME='VACCINES']"/>
"KRN",.84,7981025.001,2,96,0)
  <xsl:variable name="IMMLST" select="../COLUMN[@NAME='LABTESTS']"/>
"KRN",.84,7981025.001,2,97,0)
  <xsl:variable name="ICNCOL" select="../COLUMN[@NAME='ICN']"/>
"KRN",.84,7981025.001,2,98,0)
 
"KRN",.84,7981025.001,2,99,0)
  <thead>
"KRN",.84,7981025.001,2,100,0)
    <tr>
"KRN",.84,7981025.001,2,101,0)
      <xsl:choose>
"KRN",.84,7981025.001,2,102,0)
        <xsl:when test="$AGE_YES or $DOB_YES">
"KRN",.84,7981025.001,2,103,0)
          <xsl:call-template name="ColumnHeader">
"KRN",.84,7981025.001,2,104,0)
            <xsl:with-param name="column" select="$PTCOLS"/>
"KRN",.84,7981025.001,2,105,0)
            <xsl:with-param name="title" select="' '"/>
"KRN",.84,7981025.001,2,106,0)
            <xsl:with-param name="width" select="'24%'"/>
"KRN",.84,7981025.001,2,107,0)
            <xsl:with-param name="colspan" select="5"/>
"KRN",.84,7981025.001,2,108,0)
          </xsl:call-template>
"KRN",.84,7981025.001,2,109,0)
        </xsl:when>
"KRN",.84,7981025.001,2,110,0)
        <xsl:otherwise>
"KRN",.84,7981025.001,2,111,0)
          <xsl:call-template name="ColumnHeader">
"KRN",.84,7981025.001,2,112,0)
            <xsl:with-param name="column" select="$PTCOLS"/>
"KRN",.84,7981025.001,2,113,0)
            <xsl:with-param name="title" select="' '"/>
"KRN",.84,7981025.001,2,114,0)
            <xsl:with-param name="width" select="'24%'"/>
"KRN",.84,7981025.001,2,115,0)
            <xsl:with-param name="colspan" select="4"/>
"KRN",.84,7981025.001,2,116,0)
          </xsl:call-template>
"KRN",.84,7981025.001,2,117,0)
        </xsl:otherwise>
"KRN",.84,7981025.001,2,118,0)
      </xsl:choose> 
"KRN",.84,7981025.001,2,119,0)
 
"KRN",.84,7981025.001,2,120,0)
      <xsl:if test="$D2">
"KRN",.84,7981025.001,2,121,0)
        <xsl:call-template name="ColumnHeader">
"KRN",.84,7981025.001,2,122,0)
          <xsl:with-param name="column" select="$VACLST"/>
"KRN",.84,7981025.001,2,123,0)
          <xsl:with-param name="title" select="'Vaccination'"/>
"KRN",.84,7981025.001,2,124,0)
          <xsl:with-param name="width" select="'24%'"/>
"KRN",.84,7981025.001,2,125,0)
          <xsl:with-param name="colspan" select="2"/>
"KRN",.84,7981025.001,2,126,0)
        </xsl:call-template>
"KRN",.84,7981025.001,2,127,0)
      </xsl:if>
"KRN",.84,7981025.001,2,128,0)
 
"KRN",.84,7981025.001,2,129,0)
      <xsl:if test="$D1">
"KRN",.84,7981025.001,2,130,0)
        <xsl:call-template name="ColumnHeader">
"KRN",.84,7981025.001,2,131,0)
          <xsl:with-param name="column" select="$IMMLST"/>
"KRN",.84,7981025.001,2,132,0)
          <xsl:with-param name="title" select="'Immunity'"/>
"KRN",.84,7981025.001,2,133,0)
          <xsl:with-param name="width" select="'24%'"/>
"KRN",.84,7981025.001,2,134,0)
          <xsl:with-param name="colspan" select="3"/>
"KRN",.84,7981025.001,2,135,0)
        </xsl:call-template>
"KRN",.84,7981025.001,2,136,0)
      </xsl:if>
"KRN",.84,7981025.001,2,137,0)
 
"KRN",.84,7981025.001,2,138,0)
      <xsl:if test="$ICN_YES or $PACT_YES or $PCP_YES">
"KRN",.84,7981025.001,2,139,0)
        <xsl:variable name="COLCOUNT" 
"KRN",.84,7981025.001,2,140,0)
select="number($ICN_YES)+number($PACT_YES)+number($PCP_YES)"/>
"KRN",.84,7981025.001,2,141,0)
        <xsl:call-template name="ColumnHeader">
"KRN",.84,7981025.001,2,142,0)
          <xsl:with-param name="column" select="$ICNCOL"/>
"KRN",.84,7981025.001,2,143,0)
          <xsl:with-param name="title" select="' '"/>
"KRN",.84,7981025.001,2,144,0)
          <xsl:with-param name="width" select="'15%'"/>
"KRN",.84,7981025.001,2,145,0)
          <xsl:with-param name="colspan" select="$COLCOUNT"/>
"KRN",.84,7981025.001,2,146,0)
        </xsl:call-template>
"KRN",.84,7981025.001,2,147,0)
      </xsl:if>
"KRN",.84,7981025.001,2,148,0)
    </tr>
"KRN",.84,7981025.001,2,149,0)
 
"KRN",.84,7981025.001,2,150,0)
    <tr>
"KRN",.84,7981025.001,2,151,0)
      <xsl:choose>
"KRN",.84,7981025.001,2,152,0)
        <xsl:when test="$AGE_YES or $DOB_YES">
"KRN",.84,7981025.001,2,153,0)
          <xsl:call-template name="BasicPatientHeader">
"KRN",.84,7981025.001,2,154,0)
            <xsl:with-param name="column" select="PATIENT"/>
"KRN",.84,7981025.001,2,155,0)
            <xsl:with-param name="colspan" select="5"/>
"KRN",.84,7981025.001,2,156,0)
          </xsl:call-template>
"KRN",.84,7981025.001,2,157,0)
        </xsl:when>
"KRN",.84,7981025.001,2,158,0)
        <xsl:otherwise>
"KRN",.84,7981025.001,2,159,0)
          <xsl:call-template name="BasicPatientHeader">
"KRN",.84,7981025.001,2,160,0)
            <xsl:with-param name="column" select="PATIENT"/>
"KRN",.84,7981025.001,2,161,0)
            <xsl:with-param name="colspan" select="4"/>
"KRN",.84,7981025.001,2,162,0)
          </xsl:call-template>
"KRN",.84,7981025.001,2,163,0)
        </xsl:otherwise>
"KRN",.84,7981025.001,2,164,0)
      </xsl:choose> 
"KRN",.84,7981025.001,2,165,0)
 
"KRN",.84,7981025.001,2,166,0)
      <xsl:if test="$D2">
"KRN",.84,7981025.001,2,167,0)
        <xsl:call-template name="ColumnHeader">
"KRN",.84,7981025.001,2,168,0)
          <xsl:with-param name="column" select="VAC_NAME"/>
"KRN",.84,7981025.001,2,169,0)
          <xsl:with-param name="title" select="'Name'"/>
"KRN",.84,7981025.001,2,170,0)
          <xsl:with-param name="width" select="'15%'"/>
"KRN",.84,7981025.001,2,171,0)
          <xsl:with-param name="colspan" select="1"/>
"KRN",.84,7981025.001,2,172,0)
        </xsl:call-template>
"KRN",.84,7981025.001,2,173,0)
        <xsl:call-template name="ColumnHeader">
"KRN",.84,7981025.001,2,174,0)
          <xsl:with-param name="column" select="VAC_DATE"/>
"KRN",.84,7981025.001,2,175,0)
          <xsl:with-param name="title" select="'Date'"/>
"KRN",.84,7981025.001,2,176,0)
          <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981025.001,2,177,0)
          <xsl:with-param name="colspan" select="1"/>
"KRN",.84,7981025.001,2,178,0)
        </xsl:call-template>
"KRN",.84,7981025.001,2,179,0)
      </xsl:if>
"KRN",.84,7981025.001,2,180,0)
 
"KRN",.84,7981025.001,2,181,0)
      <xsl:if test="$D1">
"KRN",.84,7981025.001,2,182,0)
        <xsl:call-template name="ColumnHeader">
"KRN",.84,7981025.001,2,183,0)
          <xsl:with-param name="column" select="LTNAME"/>
"KRN",.84,7981025.001,2,184,0)
          <xsl:with-param name="title" select="'Test Name'"/>
"KRN",.84,7981025.001,2,185,0)
          <xsl:with-param name="width" select="'15%'"/>
"KRN",.84,7981025.001,2,186,0)
          <xsl:with-param name="colspan" select="1"/>
"KRN",.84,7981025.001,2,187,0)
        </xsl:call-template>
"KRN",.84,7981025.001,2,188,0)
        <xsl:call-template name="ColumnHeader">
"KRN",.84,7981025.001,2,189,0)
          <xsl:with-param name="column" select="DATE"/>
"KRN",.84,7981025.001,2,190,0)
          <xsl:with-param name="title" select="'Test Date'"/>
"KRN",.84,7981025.001,2,191,0)
          <xsl:with-param name="width" select="'8%'"/>
"KRN",.84,7981025.001,2,192,0)
          <xsl:with-param name="colspan" select="1"/>
"KRN",.84,7981025.001,2,193,0)
        </xsl:call-template>
"KRN",.84,7981025.001,2,194,0)
        <xsl:call-template name="ColumnHeader">
"KRN",.84,7981025.001,2,195,0)
          <xsl:with-param name="column" select="RESULT"/>
"KRN",.84,7981025.001,2,196,0)
          <xsl:with-param name="title" select="'Result'"/>
"KRN",.84,7981025.001,2,197,0)
          <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981025.001,2,198,0)
          <xsl:with-param name="colspan" select="1"/>
"KRN",.84,7981025.001,2,199,0)
        </xsl:call-template>
"KRN",.84,7981025.001,2,200,0)
      </xsl:if>
"KRN",.84,7981025.001,2,201,0)
 
"KRN",.84,7981025.001,2,202,0)
      <xsl:if test="$ICN_YES ">
"KRN",.84,7981025.001,2,203,0)
        <xsl:call-template name="ColumnHeader">
"KRN",.84,7981025.001,2,204,0)
          <xsl:with-param name="column" select="ICN"/>
"KRN",.84,7981025.001,2,205,0)
          <xsl:with-param name="title" select="'ICN'"/>
"KRN",.84,7981025.001,2,206,0)
          <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981025.001,2,207,0)
          <xsl:with-param name="colspan" select="1"/>
"KRN",.84,7981025.001,2,208,0)
        </xsl:call-template>
"KRN",.84,7981025.001,2,209,0)
      </xsl:if>
"KRN",.84,7981025.001,2,210,0)
      <xsl:if test="$PACT_YES">
"KRN",.84,7981025.001,2,211,0)
        <xsl:call-template name="ColumnHeader">
"KRN",.84,7981025.001,2,212,0)
          <xsl:with-param name="column" select="PACT"/>
"KRN",.84,7981025.001,2,213,0)
          <xsl:with-param name="title" select="'PACT'"/>
"KRN",.84,7981025.001,2,214,0)
          <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981025.001,2,215,0)
          <xsl:with-param name="colspan" select="1"/>
"KRN",.84,7981025.001,2,216,0)
        </xsl:call-template>
"KRN",.84,7981025.001,2,217,0)
      </xsl:if>
"KRN",.84,7981025.001,2,218,0)
      <xsl:if test="$PCP_YES">
"KRN",.84,7981025.001,2,219,0)
        <xsl:call-template name="ColumnHeader">
"KRN",.84,7981025.001,2,220,0)
          <xsl:with-param name="column" select="PCP"/>
"KRN",.84,7981025.001,2,221,0)
          <xsl:with-param name="title" select="'PCP'"/>
"KRN",.84,7981025.001,2,222,0)
          <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981025.001,2,223,0)
          <xsl:with-param name="colspan" select="1"/>
"KRN",.84,7981025.001,2,224,0)
        </xsl:call-template>
"KRN",.84,7981025.001,2,225,0)
      </xsl:if>
"KRN",.84,7981025.001,2,226,0)
    </tr>
"KRN",.84,7981025.001,2,227,0)
  </thead>
"KRN",.84,7981025.001,2,228,0)
</xsl:template>
"KRN",.84,7981025.001,2,229,0)
 
"KRN",.84,7981025.001,2,230,0)
<!--[ TABLE CELLS ]-->
"KRN",.84,7981025.001,2,231,0)
 
"KRN",.84,7981025.001,2,232,0)
<xsl:template match="PATIENT/VACCINES">
"KRN",.84,7981025.001,2,233,0)
  <td>
"KRN",.84,7981025.001,2,234,0)
    <xsl:for-each select="VACCINE">
"KRN",.84,7981025.001,2,235,0)
      <xsl:call-template name="CellValue">
"KRN",.84,7981025.001,2,236,0)
        <xsl:with-param name="value" select="VAC_NAME"/>
"KRN",.84,7981025.001,2,237,0)
        <xsl:with-param name="width" select="'9%'"/>
"KRN",.84,7981025.001,2,238,0)
      </xsl:call-template>
"KRN",.84,7981025.001,2,239,0)
      <br />
"KRN",.84,7981025.001,2,240,0)
    </xsl:for-each>
"KRN",.84,7981025.001,2,241,0)
  </td>
"KRN",.84,7981025.001,2,242,0)
  <td>
"KRN",.84,7981025.001,2,243,0)
    <xsl:for-each select="VACCINE">
"KRN",.84,7981025.001,2,244,0)
      <xsl:call-template name="CellValue">
"KRN",.84,7981025.001,2,245,0)
        <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981025.001,2,246,0)
        <xsl:with-param name="value" select="VAC_DATE"/>
"KRN",.84,7981025.001,2,247,0)
        <xsl:with-param name="width" select="'4%'"/>
"KRN",.84,7981025.001,2,248,0)
      </xsl:call-template>
"KRN",.84,7981025.001,2,249,0)
      <br />
"KRN",.84,7981025.001,2,250,0)
    </xsl:for-each>
"KRN",.84,7981025.001,2,251,0)
  </td>
"KRN",.84,7981025.001,2,252,0)
</xsl:template>
"KRN",.84,7981025.001,2,253,0)
 
"KRN",.84,7981025.001,2,254,0)
<xsl:template match="PATIENT/LABTESTS">
"KRN",.84,7981025.001,2,255,0)
  <td>
"KRN",.84,7981025.001,2,256,0)
    <xsl:call-template name="CellValue">
"KRN",.84,7981025.001,2,257,0)
      <xsl:with-param name="value" select="LTNAME"/>
"KRN",.84,7981025.001,2,258,0)
      <xsl:with-param name="width" select="'8%'"/>
"KRN",.84,7981025.001,2,259,0)
    </xsl:call-template>
"KRN",.84,7981025.001,2,260,0)
  </td>
"KRN",.84,7981025.001,2,261,0)
  <td>
"KRN",.84,7981025.001,2,262,0)
    <xsl:call-template name="CellValue">
"KRN",.84,7981025.001,2,263,0)
      <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981025.001,2,264,0)
      <xsl:with-param name="value" select="DATE"/>
"KRN",.84,7981025.001,2,265,0)
      <xsl:with-param name="width" select="'4%'"/>
"KRN",.84,7981025.001,2,266,0)
    </xsl:call-template>
"KRN",.84,7981025.001,2,267,0)
  </td>
"KRN",.84,7981025.001,2,268,0)
  <td>
"KRN",.84,7981025.001,2,269,0)
    <xsl:call-template name="CellValue">
"KRN",.84,7981025.001,2,270,0)
      <xsl:with-param name="value" select="RESULT"/>
"KRN",.84,7981025.001,2,271,0)
      <xsl:with-param name="width" select="'8%'"/>
"KRN",.84,7981025.001,2,272,0)
    </xsl:call-template>
"KRN",.84,7981025.001,2,273,0)
  </td>
"KRN",.84,7981025.001,2,274,0)
</xsl:template>
"KRN",.84,7981025.001,2,275,0)
 
"KRN",.84,7981025.001,2,276,0)
</xsl:stylesheet>
"KRN",.84,7981025.002,-1)
0^13
"KRN",.84,7981025.002,0)
7981025.002^2^^CLINICAL CASE REGISTRIES^Hepatitis B Report (CSV)
"KRN",.84,7981025.002,2,0)
^^253^253^3170804^
"KRN",.84,7981025.002,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981025.002,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981025.002,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981025.002,2,4,0)
 
"KRN",.84,7981025.002,2,5,0)
<xsl:import href="template://report/999/2"/>  <!-- Common   -->
"KRN",.84,7981025.002,2,6,0)
 
"KRN",.84,7981025.002,2,7,0)
<xsl:variable name="D1" 
"KRN",.84,7981025.002,2,8,0)
select="/REPORT/PATIENTS/PATIENT/LABTESTS[1]/LTNAME"/>
"KRN",.84,7981025.002,2,9,0)
<xsl:variable name="D2" 
"KRN",.84,7981025.002,2,10,0)
select="/REPORT/PATIENTS/PATIENT/VACCINES/VACCINE[1]/VAC_NAME"/>
"KRN",.84,7981025.002,2,11,0)
 
"KRN",.84,7981025.002,2,12,0)
<xsl:template match="/">
"KRN",.84,7981025.002,2,13,0)
  <xsl:text>Hepatitis B report</xsl:text>
"KRN",.84,7981025.002,2,14,0)
  <xsl:apply-templates select="/REPORT/PATIENTS"/>
"KRN",.84,7981025.002,2,15,0)
</xsl:template>
"KRN",.84,7981025.002,2,16,0)
 
"KRN",.84,7981025.002,2,17,0)
<xsl:template match="PATIENTS/PATIENT">
"KRN",.84,7981025.002,2,18,0)
  <xsl:variable name="ptname" select="NAME"/>
"KRN",.84,7981025.002,2,19,0)
  <xsl:variable name="ssn"  select="LAST4"/>
"KRN",.84,7981025.002,2,20,0)
  <xsl:variable name="age"  select="AGE"/>
"KRN",.84,7981025.002,2,21,0)
  <xsl:variable name="dob"  select="DOB"/>
"KRN",.84,7981025.002,2,22,0)
  <xsl:variable name="dod"  select="DOD"/>
"KRN",.84,7981025.002,2,23,0)
  <xsl:variable name="icn"  select="ICN"/>
"KRN",.84,7981025.002,2,24,0)
  <xsl:variable name="pact" select="PACT"/>
"KRN",.84,7981025.002,2,25,0)
  <xsl:variable name="pcp"  select="PCP"/>
"KRN",.84,7981025.002,2,26,0)
  <xsl:variable name="ltname" select="LABTESTS/LTNAME"/>
"KRN",.84,7981025.002,2,27,0)
  <xsl:variable name="ltdate" select="LABTESTS/DATE"/>
"KRN",.84,7981025.002,2,28,0)
  <xsl:variable name="ltresult" select="LABTESTS/RESULT"/>
"KRN",.84,7981025.002,2,29,0)
 
"KRN",.84,7981025.002,2,30,0)
  <xsl:choose>
"KRN",.84,7981025.002,2,31,0)
    <xsl:when test="($D2 and $D1) or $D2">
"KRN",.84,7981025.002,2,32,0)
      <xsl:for-each select="VACCINES/VACCINE">
"KRN",.84,7981025.002,2,33,0)
        <xsl:call-template name="TableCell">
"KRN",.84,7981025.002,2,34,0)
          <xsl:with-param name="value" select="$ptname"/>
"KRN",.84,7981025.002,2,35,0)
        </xsl:call-template>
"KRN",.84,7981025.002,2,36,0)
        <xsl:call-template name="TableCell">
"KRN",.84,7981025.002,2,37,0)
          <xsl:with-param name="value" select="$ssn"/>
"KRN",.84,7981025.002,2,38,0)
        </xsl:call-template>
"KRN",.84,7981025.002,2,39,0)
        <xsl:if test="$AGE_YES">
"KRN",.84,7981025.002,2,40,0)
          <xsl:call-template name="TableCell">
"KRN",.84,7981025.002,2,41,0)
            <xsl:with-param name="value" select="$age"/>
"KRN",.84,7981025.002,2,42,0)
          </xsl:call-template>
"KRN",.84,7981025.002,2,43,0)
        </xsl:if>
"KRN",.84,7981025.002,2,44,0)
        <xsl:if test="$DOB_YES">
"KRN",.84,7981025.002,2,45,0)
          <xsl:call-template name="TableCell">
"KRN",.84,7981025.002,2,46,0)
            <xsl:with-param name="value" select="$dob"/>
"KRN",.84,7981025.002,2,47,0)
            <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981025.002,2,48,0)
          </xsl:call-template>
"KRN",.84,7981025.002,2,49,0)
        </xsl:if>
"KRN",.84,7981025.002,2,50,0)
        <xsl:call-template name="TableCell">
"KRN",.84,7981025.002,2,51,0)
          <xsl:with-param name="value" select="$dod"/>
"KRN",.84,7981025.002,2,52,0)
          <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981025.002,2,53,0)
        </xsl:call-template>
"KRN",.84,7981025.002,2,54,0)
 
"KRN",.84,7981025.002,2,55,0)
        <xsl:call-template name="TableCell">
"KRN",.84,7981025.002,2,56,0)
          <xsl:with-param name="value" select="VAC_NAME"/>
"KRN",.84,7981025.002,2,57,0)
        </xsl:call-template>
"KRN",.84,7981025.002,2,58,0)
        <xsl:call-template name="TableCell">
"KRN",.84,7981025.002,2,59,0)
          <xsl:with-param name="value" select="VAC_DATE"/>
"KRN",.84,7981025.002,2,60,0)
          <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981025.002,2,61,0)
        </xsl:call-template>
"KRN",.84,7981025.002,2,62,0)
 
"KRN",.84,7981025.002,2,63,0)
        <xsl:if test="$D1">
"KRN",.84,7981025.002,2,64,0)
          <xsl:call-template name="TableCell">
"KRN",.84,7981025.002,2,65,0)
            <xsl:with-param name="value" select="$ltname"/>
"KRN",.84,7981025.002,2,66,0)
          </xsl:call-template>
"KRN",.84,7981025.002,2,67,0)
          <xsl:call-template name="TableCell">
"KRN",.84,7981025.002,2,68,0)
            <xsl:with-param name="value" select="$ltdate"/>
"KRN",.84,7981025.002,2,69,0)
            <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981025.002,2,70,0)
          </xsl:call-template>
"KRN",.84,7981025.002,2,71,0)
          <xsl:call-template name="TableCell">
"KRN",.84,7981025.002,2,72,0)
            <xsl:with-param name="value" select="$ltresult"/>
"KRN",.84,7981025.002,2,73,0)
          </xsl:call-template>
"KRN",.84,7981025.002,2,74,0)
        </xsl:if>
"KRN",.84,7981025.002,2,75,0)
 
"KRN",.84,7981025.002,2,76,0)
        <xsl:if test="$ICN_YES">
"KRN",.84,7981025.002,2,77,0)
          <xsl:call-template name="TableCell">
"KRN",.84,7981025.002,2,78,0)
            <xsl:with-param name="value" select="$icn"/>
"KRN",.84,7981025.002,2,79,0)
          </xsl:call-template>
"KRN",.84,7981025.002,2,80,0)
        </xsl:if>
"KRN",.84,7981025.002,2,81,0)
        <xsl:if test="$PACT_YES">
"KRN",.84,7981025.002,2,82,0)
          <xsl:call-template name="TableCell">
"KRN",.84,7981025.002,2,83,0)
            <xsl:with-param name="value" select="$pact"/>
"KRN",.84,7981025.002,2,84,0)
          </xsl:call-template>
"KRN",.84,7981025.002,2,85,0)
        </xsl:if>
"KRN",.84,7981025.002,2,86,0)
        <xsl:if test="$PCP_YES">
"KRN",.84,7981025.002,2,87,0)
          <xsl:call-template name="TableCell">
"KRN",.84,7981025.002,2,88,0)
            <xsl:with-param name="value" select="$pcp"/>
"KRN",.84,7981025.002,2,89,0)
         </xsl:call-template>
"KRN",.84,7981025.002,2,90,0)
        </xsl:if>
"KRN",.84,7981025.002,2,91,0)
        <xsl:value-of select="$CRLF"/>
"KRN",.84,7981025.002,2,92,0)
      </xsl:for-each>
"KRN",.84,7981025.002,2,93,0)
    </xsl:when>
"KRN",.84,7981025.002,2,94,0)
 
"KRN",.84,7981025.002,2,95,0)
    <xsl:when test="$D1">
"KRN",.84,7981025.002,2,96,0)
      <xsl:for-each select="LABTESTS">
"KRN",.84,7981025.002,2,97,0)
        <xsl:call-template name="TableCell">
"KRN",.84,7981025.002,2,98,0)
          <xsl:with-param name="value" select="$ptname"/>
"KRN",.84,7981025.002,2,99,0)
        </xsl:call-template>
"KRN",.84,7981025.002,2,100,0)
        <xsl:call-template name="TableCell">
"KRN",.84,7981025.002,2,101,0)
          <xsl:with-param name="value" select="$ssn"/>
"KRN",.84,7981025.002,2,102,0)
        </xsl:call-template>
"KRN",.84,7981025.002,2,103,0)
        <xsl:if test="$AGE_YES">
"KRN",.84,7981025.002,2,104,0)
          <xsl:call-template name="TableCell">
"KRN",.84,7981025.002,2,105,0)
            <xsl:with-param name="value" select="$age"/>
"KRN",.84,7981025.002,2,106,0)
          </xsl:call-template>
"KRN",.84,7981025.002,2,107,0)
        </xsl:if>
"KRN",.84,7981025.002,2,108,0)
        <xsl:if test="$DOB_YES">
"KRN",.84,7981025.002,2,109,0)
          <xsl:call-template name="TableCell">
"KRN",.84,7981025.002,2,110,0)
            <xsl:with-param name="value" select="$dob"/>
"KRN",.84,7981025.002,2,111,0)
            <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981025.002,2,112,0)
          </xsl:call-template>
"KRN",.84,7981025.002,2,113,0)
        </xsl:if>
"KRN",.84,7981025.002,2,114,0)
        <xsl:call-template name="TableCell">
"KRN",.84,7981025.002,2,115,0)
          <xsl:with-param name="value" select="$dod"/>
"KRN",.84,7981025.002,2,116,0)
          <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981025.002,2,117,0)
        </xsl:call-template>
"KRN",.84,7981025.002,2,118,0)
        <xsl:call-template name="TableCell">
"KRN",.84,7981025.002,2,119,0)
          <xsl:with-param name="value" select="$ltname"/>
"KRN",.84,7981025.002,2,120,0)
        </xsl:call-template>
"KRN",.84,7981025.002,2,121,0)
        <xsl:call-template name="TableCell">
"KRN",.84,7981025.002,2,122,0)
          <xsl:with-param name="value" select="$ltdate"/>
"KRN",.84,7981025.002,2,123,0)
         <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981025.002,2,124,0)
        </xsl:call-template>
"KRN",.84,7981025.002,2,125,0)
        <xsl:call-template name="TableCell">
"KRN",.84,7981025.002,2,126,0)
          <xsl:with-param name="value" select="$ltresult"/>
"KRN",.84,7981025.002,2,127,0)
        </xsl:call-template>
"KRN",.84,7981025.002,2,128,0)
        <xsl:if test="$ICN_YES">
"KRN",.84,7981025.002,2,129,0)
          <xsl:call-template name="TableCell">
"KRN",.84,7981025.002,2,130,0)
            <xsl:with-param name="value" select="$icn"/>
"KRN",.84,7981025.002,2,131,0)
          </xsl:call-template>
"KRN",.84,7981025.002,2,132,0)
        </xsl:if>
"KRN",.84,7981025.002,2,133,0)
        <xsl:if test="$PACT_YES">
"KRN",.84,7981025.002,2,134,0)
          <xsl:call-template name="TableCell">
"KRN",.84,7981025.002,2,135,0)
            <xsl:with-param name="value" select="$pact"/>
"KRN",.84,7981025.002,2,136,0)
          </xsl:call-template>
"KRN",.84,7981025.002,2,137,0)
        </xsl:if>
"KRN",.84,7981025.002,2,138,0)
        <xsl:if test="$PCP_YES">
"KRN",.84,7981025.002,2,139,0)
          <xsl:call-template name="TableCell">
"KRN",.84,7981025.002,2,140,0)
            <xsl:with-param name="value" select="$pcp"/>
"KRN",.84,7981025.002,2,141,0)
          </xsl:call-template>
"KRN",.84,7981025.002,2,142,0)
        </xsl:if>
"KRN",.84,7981025.002,2,143,0)
        <xsl:value-of select="$CRLF"/>
"KRN",.84,7981025.002,2,144,0)
      </xsl:for-each>
"KRN",.84,7981025.002,2,145,0)
    </xsl:when>
"KRN",.84,7981025.002,2,146,0)
      
"KRN",.84,7981025.002,2,147,0)
    <xsl:otherwise>
"KRN",.84,7981025.002,2,148,0)
      <xsl:call-template name="TableCell">
"KRN",.84,7981025.002,2,149,0)
        <xsl:with-param name="value" select="$ptname"/>
"KRN",.84,7981025.002,2,150,0)
      </xsl:call-template>
"KRN",.84,7981025.002,2,151,0)
      <xsl:call-template name="TableCell">
"KRN",.84,7981025.002,2,152,0)
        <xsl:with-param name="value" select="$ssn"/>
"KRN",.84,7981025.002,2,153,0)
      </xsl:call-template>
"KRN",.84,7981025.002,2,154,0)
      <xsl:if test="$AGE_YES">
"KRN",.84,7981025.002,2,155,0)
        <xsl:call-template name="TableCell">
"KRN",.84,7981025.002,2,156,0)
          <xsl:with-param name="value" select="$age"/>
"KRN",.84,7981025.002,2,157,0)
        </xsl:call-template>
"KRN",.84,7981025.002,2,158,0)
      </xsl:if>
"KRN",.84,7981025.002,2,159,0)
      <xsl:if test="$DOB_YES">
"KRN",.84,7981025.002,2,160,0)
        <xsl:call-template name="TableCell">
"KRN",.84,7981025.002,2,161,0)
          <xsl:with-param name="value" select="$dob"/>
"KRN",.84,7981025.002,2,162,0)
          <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981025.002,2,163,0)
        </xsl:call-template>
"KRN",.84,7981025.002,2,164,0)
      </xsl:if>
"KRN",.84,7981025.002,2,165,0)
      <xsl:call-template name="TableCell">
"KRN",.84,7981025.002,2,166,0)
        <xsl:with-param name="value" select="$dod"/>
"KRN",.84,7981025.002,2,167,0)
        <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981025.002,2,168,0)
      </xsl:call-template>
"KRN",.84,7981025.002,2,169,0)
      <xsl:if test="$ICN_YES">
"KRN",.84,7981025.002,2,170,0)
        <xsl:call-template name="TableCell">
"KRN",.84,7981025.002,2,171,0)
          <xsl:with-param name="value" select="$icn"/>
"KRN",.84,7981025.002,2,172,0)
        </xsl:call-template>
"KRN",.84,7981025.002,2,173,0)
      </xsl:if>
"KRN",.84,7981025.002,2,174,0)
      <xsl:if test="$PACT_YES">
"KRN",.84,7981025.002,2,175,0)
        <xsl:call-template name="TableCell">
"KRN",.84,7981025.002,2,176,0)
          <xsl:with-param name="value" select="$pact"/>
"KRN",.84,7981025.002,2,177,0)
        </xsl:call-template>
"KRN",.84,7981025.002,2,178,0)
      </xsl:if>
"KRN",.84,7981025.002,2,179,0)
      <xsl:if test="$PCP_YES">
"KRN",.84,7981025.002,2,180,0)
        <xsl:call-template name="TableCell">
"KRN",.84,7981025.002,2,181,0)
          <xsl:with-param name="value" select="$pcp"/>
"KRN",.84,7981025.002,2,182,0)
        </xsl:call-template>
"KRN",.84,7981025.002,2,183,0)
      </xsl:if>
"KRN",.84,7981025.002,2,184,0)
      <xsl:value-of select="$CRLF"/>
"KRN",.84,7981025.002,2,185,0)
    </xsl:otherwise>
"KRN",.84,7981025.002,2,186,0)
  </xsl:choose>
"KRN",.84,7981025.002,2,187,0)
</xsl:template>
"KRN",.84,7981025.002,2,188,0)
 
"KRN",.84,7981025.002,2,189,0)
<xsl:template match="COLUMN[@NAME='VAC_NAME']">
"KRN",.84,7981025.002,2,190,0)
  <xsl:if test="$D2">
"KRN",.84,7981025.002,2,191,0)
   <xsl:call-template name="ColumnHeader">
"KRN",.84,7981025.002,2,192,0)
      <xsl:with-param name="title" select="'Vaccine Name'"/>
"KRN",.84,7981025.002,2,193,0)
    </xsl:call-template>
"KRN",.84,7981025.002,2,194,0)
  </xsl:if>
"KRN",.84,7981025.002,2,195,0)
</xsl:template>
"KRN",.84,7981025.002,2,196,0)
 
"KRN",.84,7981025.002,2,197,0)
<xsl:template match="COLUMN[@NAME='VAC_DATE']">
"KRN",.84,7981025.002,2,198,0)
  <xsl:if test="$D2">
"KRN",.84,7981025.002,2,199,0)
    <xsl:call-template name="ColumnHeader">
"KRN",.84,7981025.002,2,200,0)
      <xsl:with-param name="title" select="'Vaccine Date'"/>
"KRN",.84,7981025.002,2,201,0)
    </xsl:call-template>
"KRN",.84,7981025.002,2,202,0)
  </xsl:if>
"KRN",.84,7981025.002,2,203,0)
</xsl:template>
"KRN",.84,7981025.002,2,204,0)
 
"KRN",.84,7981025.002,2,205,0)
<xsl:template match="COLUMN[@NAME='LTNAME']">
"KRN",.84,7981025.002,2,206,0)
  <xsl:if test="$D1">
"KRN",.84,7981025.002,2,207,0)
    <xsl:call-template name="ColumnHeader">
"KRN",.84,7981025.002,2,208,0)
      <xsl:with-param name="title" select="'Test Name'"/>
"KRN",.84,7981025.002,2,209,0)
    </xsl:call-template>
"KRN",.84,7981025.002,2,210,0)
  </xsl:if>
"KRN",.84,7981025.002,2,211,0)
</xsl:template>
"KRN",.84,7981025.002,2,212,0)
 
"KRN",.84,7981025.002,2,213,0)
<xsl:template match="COLUMN[@NAME='DATE']">
"KRN",.84,7981025.002,2,214,0)
  <xsl:if test="$D1">
"KRN",.84,7981025.002,2,215,0)
    <xsl:call-template name="ColumnHeader">
"KRN",.84,7981025.002,2,216,0)
      <xsl:with-param name="title" select="'Test Date'"/>
"KRN",.84,7981025.002,2,217,0)
    </xsl:call-template>
"KRN",.84,7981025.002,2,218,0)
  </xsl:if>
"KRN",.84,7981025.002,2,219,0)
</xsl:template>
"KRN",.84,7981025.002,2,220,0)
 
"KRN",.84,7981025.002,2,221,0)
<xsl:template match="COLUMN[@NAME='RESULT']">
"KRN",.84,7981025.002,2,222,0)
  <xsl:if test="$D1">
"KRN",.84,7981025.002,2,223,0)
    <xsl:call-template name="ColumnHeader">
"KRN",.84,7981025.002,2,224,0)
      <xsl:with-param name="title" select="'Result'"/>
"KRN",.84,7981025.002,2,225,0)
    </xsl:call-template>
"KRN",.84,7981025.002,2,226,0)
  </xsl:if>
"KRN",.84,7981025.002,2,227,0)
</xsl:template>
"KRN",.84,7981025.002,2,228,0)
 
"KRN",.84,7981025.002,2,229,0)
<xsl:template match="COLUMN[@NAME='ICN']">
"KRN",.84,7981025.002,2,230,0)
  <xsl:if test="$ICN_YES">
"KRN",.84,7981025.002,2,231,0)
    <xsl:call-template name="ColumnHeader">
"KRN",.84,7981025.002,2,232,0)
      <xsl:with-param name="title" select="'ICN'"/>
"KRN",.84,7981025.002,2,233,0)
    </xsl:call-template>
"KRN",.84,7981025.002,2,234,0)
  </xsl:if>
"KRN",.84,7981025.002,2,235,0)
</xsl:template>
"KRN",.84,7981025.002,2,236,0)
 
"KRN",.84,7981025.002,2,237,0)
<xsl:template match="COLUMN[@NAME='PACT']">
"KRN",.84,7981025.002,2,238,0)
  <xsl:if test="$PACT_YES">
"KRN",.84,7981025.002,2,239,0)
    <xsl:call-template name="ColumnHeader">
"KRN",.84,7981025.002,2,240,0)
      <xsl:with-param name="title" select="'PACT'"/>
"KRN",.84,7981025.002,2,241,0)
    </xsl:call-template>
"KRN",.84,7981025.002,2,242,0)
  </xsl:if>
"KRN",.84,7981025.002,2,243,0)
</xsl:template>
"KRN",.84,7981025.002,2,244,0)
 
"KRN",.84,7981025.002,2,245,0)
<xsl:template match="COLUMN[@NAME='PCP']">
"KRN",.84,7981025.002,2,246,0)
  <xsl:if test="$PCP_YES">
"KRN",.84,7981025.002,2,247,0)
    <xsl:call-template name="ColumnHeader">
"KRN",.84,7981025.002,2,248,0)
      <xsl:with-param name="title" select="'PCP'"/>
"KRN",.84,7981025.002,2,249,0)
    </xsl:call-template>
"KRN",.84,7981025.002,2,250,0)
  </xsl:if>
"KRN",.84,7981025.002,2,251,0)
</xsl:template>
"KRN",.84,7981025.002,2,252,0)
 
"KRN",.84,7981025.002,2,253,0)
</xsl:stylesheet>
"KRN",.84,7981995.001,-1)
0^28
"KRN",.84,7981995.001,0)
7981995.001^2^^CLINICAL CASE REGISTRIES^Lab data templates (HTML)
"KRN",.84,7981995.001,2,0)
^^102^102^3170802^
"KRN",.84,7981995.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981995.001,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981995.001,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981995.001,2,4,0)
 
"KRN",.84,7981995.001,2,5,0)
<!-- Lab Data (995.1) -->
"KRN",.84,7981995.001,2,6,0)
 
"KRN",.84,7981995.001,2,7,0)
<!--[ UTILITIES ]-->
"KRN",.84,7981995.001,2,8,0)
 
"KRN",.84,7981995.001,2,9,0)
<xsl:template name="BasicLRHeader">
"KRN",.84,7981995.001,2,10,0)
<xsl:param name="colname" select="'NAME'"/>
"KRN",.84,7981995.001,2,11,0)
<xsl:param name="group" select="0"/>
"KRN",.84,7981995.001,2,12,0)
<xsl:param name="tblname" select="'PTLRL'"/>
"KRN",.84,7981995.001,2,13,0)
<xsl:if test="$group">
"KRN",.84,7981995.001,2,14,0)
  <xsl:call-template name="ColumnHeader">
"KRN",.84,7981995.001,2,15,0)
   <xsl:with-param name="sort" select="concat($tblname,'=GROUP')"/>
"KRN",.84,7981995.001,2,16,0)
   <xsl:with-param name="title" select="'Group'"/>
"KRN",.84,7981995.001,2,17,0)
   <xsl:with-param name="width" select="'15%'"/>
"KRN",.84,7981995.001,2,18,0)
  </xsl:call-template>
"KRN",.84,7981995.001,2,19,0)
</xsl:if>
"KRN",.84,7981995.001,2,20,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981995.001,2,21,0)
  <xsl:with-param name="sort" select="concat($tblname,'=DATE')"/>
"KRN",.84,7981995.001,2,22,0)
  <xsl:with-param name="title" select="'Date'"/>    
"KRN",.84,7981995.001,2,23,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981995.001,2,24,0)
</xsl:call-template>
"KRN",.84,7981995.001,2,25,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981995.001,2,26,0)
  <xsl:with-param name="sort" select="concat($tblname,'=',$colname)"/>
"KRN",.84,7981995.001,2,27,0)
  <xsl:with-param name="title" select="'Test Name'"/>    
"KRN",.84,7981995.001,2,28,0)
 </xsl:call-template>
"KRN",.84,7981995.001,2,29,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981995.001,2,30,0)
  <xsl:with-param name="sort" select="concat($tblname,'=RESULT')"/>
"KRN",.84,7981995.001,2,31,0)
  <xsl:with-param name="title" select="'Result'"/>
"KRN",.84,7981995.001,2,32,0)
  <xsl:with-param name="width" select="'10%'"/>
"KRN",.84,7981995.001,2,33,0)
</xsl:call-template>
"KRN",.84,7981995.001,2,34,0)
</xsl:template>
"KRN",.84,7981995.001,2,35,0)
 
"KRN",.84,7981995.001,2,36,0)
<xsl:template name="BasicLRData">
"KRN",.84,7981995.001,2,37,0)
<xsl:param name="group" select="0"/>
"KRN",.84,7981995.001,2,38,0)
<xsl:param name="name" select="NAME"/>
"KRN",.84,7981995.001,2,39,0)
<xsl:if test="$group">
"KRN",.84,7981995.001,2,40,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981995.001,2,41,0)
   <xsl:with-param name="value" select="GROUP"/>
"KRN",.84,7981995.001,2,42,0)
  </xsl:call-template>
"KRN",.84,7981995.001,2,43,0)
</xsl:if>
"KRN",.84,7981995.001,2,44,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981995.001,2,45,0)
  <xsl:with-param name="value" select="DATE"/>
"KRN",.84,7981995.001,2,46,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981995.001,2,47,0)
</xsl:call-template>
"KRN",.84,7981995.001,2,48,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981995.001,2,49,0)
  <xsl:with-param name="class" select="'aLeft'"/>
"KRN",.84,7981995.001,2,50,0)
  <xsl:with-param name="value" select="$name"/>
"KRN",.84,7981995.001,2,51,0)
</xsl:call-template>
"KRN",.84,7981995.001,2,52,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981995.001,2,53,0)
  <xsl:with-param name="value" select="RESULT"/>
"KRN",.84,7981995.001,2,54,0)
</xsl:call-template>
"KRN",.84,7981995.001,2,55,0)
<xsl:if test="count(./WKS_LAB)>0">
"KRN",.84,7981995.001,2,56,0)
   <xsl:call-template name="TableCell">
"KRN",.84,7981995.001,2,57,0)
    <xsl:with-param name="value" select="WKS_LAB"/>
"KRN",.84,7981995.001,2,58,0)
   </xsl:call-template>
"KRN",.84,7981995.001,2,59,0)
</xsl:if>
"KRN",.84,7981995.001,2,60,0)
</xsl:template>
"KRN",.84,7981995.001,2,61,0)
 
"KRN",.84,7981995.001,2,62,0)
<!--[ REPORT PARAMETERS ]-->
"KRN",.84,7981995.001,2,63,0)
 
"KRN",.84,7981995.001,2,64,0)
<xsl:template match="PARAMETERS/LABTESTS">
"KRN",.84,7981995.001,2,65,0)
<tr>
"KRN",.84,7981995.001,2,66,0)
  <th scope="row">Lab Tests:&#160;</th>
"KRN",.84,7981995.001,2,67,0)
  <td>
"KRN",.84,7981995.001,2,68,0)
   <xsl:if test="@DESCR">
"KRN",.84,7981995.001,2,69,0)
    <xsl:value-of select="@DESCR"/><br/>
"KRN",.84,7981995.001,2,70,0)
   </xsl:if>
"KRN",.84,7981995.001,2,71,0)
   <xsl:if test=".='ALL'">ALL</xsl:if>
"KRN",.84,7981995.001,2,72,0)
   <xsl:apply-templates select="LT[@LOW|@HIGH]">
"KRN",.84,7981995.001,2,73,0)
    <xsl:sort select="."/>
"KRN",.84,7981995.001,2,74,0)
   </xsl:apply-templates>
"KRN",.84,7981995.001,2,75,0)
   <xsl:apply-templates select="LT[not(@LOW|@HIGH)]">
"KRN",.84,7981995.001,2,76,0)
    <xsl:sort select="."/>
"KRN",.84,7981995.001,2,77,0)
   </xsl:apply-templates>
"KRN",.84,7981995.001,2,78,0)
  </td>
"KRN",.84,7981995.001,2,79,0)
</tr>
"KRN",.84,7981995.001,2,80,0)
</xsl:template>
"KRN",.84,7981995.001,2,81,0)
 
"KRN",.84,7981995.001,2,82,0)
<xsl:template match="PARAMETERS/LABTESTS/LT[@LOW|@HIGH]">
"KRN",.84,7981995.001,2,83,0)
<xsl:variable name="low" select="@LOW"/>
"KRN",.84,7981995.001,2,84,0)
<xsl:variable name="high" select="@HIGH"/>
"KRN",.84,7981995.001,2,85,0)
<xsl:value-of select="."/>
"KRN",.84,7981995.001,2,86,0)
<xsl:text> - results</xsl:text>
"KRN",.84,7981995.001,2,87,0)
<xsl:if test="$low">
"KRN",.84,7981995.001,2,88,0)
  <xsl:value-of select="concat(' not less than ',$low)"/>
"KRN",.84,7981995.001,2,89,0)
</xsl:if>
"KRN",.84,7981995.001,2,90,0)
<xsl:if test="$high">
"KRN",.84,7981995.001,2,91,0)
  <xsl:if test="$low"> and</xsl:if>
"KRN",.84,7981995.001,2,92,0)
  <xsl:value-of select="concat(' not greater than ',$high)"/>
"KRN",.84,7981995.001,2,93,0)
</xsl:if>
"KRN",.84,7981995.001,2,94,0)
<br/>
"KRN",.84,7981995.001,2,95,0)
</xsl:template>
"KRN",.84,7981995.001,2,96,0)
 
"KRN",.84,7981995.001,2,97,0)
<xsl:template match="PARAMETERS/LABTESTS/LT[not(@LOW|@HIGH)]">
"KRN",.84,7981995.001,2,98,0)
<xsl:if test="position()>1"><xsl:text>; </xsl:text></xsl:if>
"KRN",.84,7981995.001,2,99,0)
<xsl:value-of select="."/>
"KRN",.84,7981995.001,2,100,0)
</xsl:template>
"KRN",.84,7981995.001,2,101,0)
 
"KRN",.84,7981995.001,2,102,0)
</xsl:stylesheet>
"KRN",.84,7981996.001,-1)
0^29
"KRN",.84,7981996.001,0)
7981996.001^2^^CLINICAL CASE REGISTRIES^Pharmacy data templates (HTML)
"KRN",.84,7981996.001,2,0)
^^66^66^3170802^
"KRN",.84,7981996.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981996.001,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981996.001,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981996.001,2,4,0)
 
"KRN",.84,7981996.001,2,5,0)
<!-- Pharmacy (996.1) -->
"KRN",.84,7981996.001,2,6,0)
 
"KRN",.84,7981996.001,2,7,0)
<!--[ TABLE HEADERS ]-->
"KRN",.84,7981996.001,2,8,0)
 
"KRN",.84,7981996.001,2,9,0)
<xsl:template match="TBLDEF[starts-with(@NAME,'DRUGS') or 
"KRN",.84,7981996.001,2,10,0)
@NAME='PTRXL']/COLUMN[@NAME='NAME']">
"KRN",.84,7981996.001,2,11,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981996.001,2,12,0)
  <xsl:with-param name="title" select="'Drug Name'"/>
"KRN",.84,7981996.001,2,13,0)
</xsl:call-template>
"KRN",.84,7981996.001,2,14,0)
</xsl:template>
"KRN",.84,7981996.001,2,15,0)
 
"KRN",.84,7981996.001,2,16,0)
<!--[ PHARMACY REPORT PARAMETERS ]-->
"KRN",.84,7981996.001,2,17,0)
 
"KRN",.84,7981996.001,2,18,0)
<xsl:template match="PARAMETERS/DRUGS">
"KRN",.84,7981996.001,2,19,0)
<tr>
"KRN",.84,7981996.001,2,20,0)
  <th scope="row">Meds:&#160;</th>
"KRN",.84,7981996.001,2,21,0)
  <td>
"KRN",.84,7981996.001,2,22,0)
   <dl>
"KRN",.84,7981996.001,2,23,0)
    <xsl:if test="@DESCR!=''">
"KRN",.84,7981996.001,2,24,0)
     <dt><xsl:value-of select="@DESCR"/></dt>
"KRN",.84,7981996.001,2,25,0)
    </xsl:if>
"KRN",.84,7981996.001,2,26,0)
    <xsl:if test=".='ALL'"><dt>ALL</dt></xsl:if>
"KRN",.84,7981996.001,2,27,0)
    <xsl:apply-templates select="GROUP"/>
"KRN",.84,7981996.001,2,28,0)
   </dl>
"KRN",.84,7981996.001,2,29,0)
  </td>
"KRN",.84,7981996.001,2,30,0)
</tr>
"KRN",.84,7981996.001,2,31,0)
</xsl:template>
"KRN",.84,7981996.001,2,32,0)
 
"KRN",.84,7981996.001,2,33,0)
<xsl:template match="PARAMETERS/DRUGS/GROUP">
"KRN",.84,7981996.001,2,34,0)
<dt><b><xsl:value-of select="@NAME"/></b></dt>
"KRN",.84,7981996.001,2,35,0)
<dd><dl>
"KRN",.84,7981996.001,2,36,0)
  <xsl:if test="@DESCR!=''">
"KRN",.84,7981996.001,2,37,0)
   <dt><xsl:value-of select="@DESCR"/></dt>
"KRN",.84,7981996.001,2,38,0)
  </xsl:if>
"KRN",.84,7981996.001,2,39,0)
  <xsl:apply-templates select="*"/>
"KRN",.84,7981996.001,2,40,0)
</dl></dd>
"KRN",.84,7981996.001,2,41,0)
</xsl:template>
"KRN",.84,7981996.001,2,42,0)
 
"KRN",.84,7981996.001,2,43,0)
<xsl:template match="PARAMETERS/DRUGS/GROUP/FORMULATIONS">
"KRN",.84,7981996.001,2,44,0)
<dt><b>Individual Formulations</b></dt>
"KRN",.84,7981996.001,2,45,0)
<dd><xsl:call-template name="ParamsDrugList"/></dd>
"KRN",.84,7981996.001,2,46,0)
</xsl:template>
"KRN",.84,7981996.001,2,47,0)
 
"KRN",.84,7981996.001,2,48,0)
<xsl:template match="PARAMETERS/DRUGS/GROUP/GENERIC">
"KRN",.84,7981996.001,2,49,0)
<dt><b>Generic Names</b></dt>
"KRN",.84,7981996.001,2,50,0)
<dd><xsl:call-template name="ParamsDrugList"/></dd>
"KRN",.84,7981996.001,2,51,0)
</xsl:template>
"KRN",.84,7981996.001,2,52,0)
 
"KRN",.84,7981996.001,2,53,0)
<xsl:template match="PARAMETERS/DRUGS/GROUP/VARXCLS">
"KRN",.84,7981996.001,2,54,0)
<dt><b>VA Drug Classes</b></dt>
"KRN",.84,7981996.001,2,55,0)
<dd><xsl:call-template name="ParamsDrugList"/></dd>
"KRN",.84,7981996.001,2,56,0)
</xsl:template>
"KRN",.84,7981996.001,2,57,0)
 
"KRN",.84,7981996.001,2,58,0)
<xsl:template name="ParamsDrugList">
"KRN",.84,7981996.001,2,59,0)
<xsl:for-each select="*">
"KRN",.84,7981996.001,2,60,0)
  <xsl:sort select="."/>
"KRN",.84,7981996.001,2,61,0)
  <xsl:if test="position()>1"><xsl:text>; </xsl:text></xsl:if>
"KRN",.84,7981996.001,2,62,0)
  <xsl:value-of select="."/>
"KRN",.84,7981996.001,2,63,0)
</xsl:for-each>
"KRN",.84,7981996.001,2,64,0)
</xsl:template>
"KRN",.84,7981996.001,2,65,0)
 
"KRN",.84,7981996.001,2,66,0)
</xsl:stylesheet>
"KRN",.84,7981997.001,-1)
0^4
"KRN",.84,7981997.001,0)
7981997.001^2^^CLINICAL CASE REGISTRIES^Patient data templates (HTML)
"KRN",.84,7981997.001,2,0)
^^319^319^3170802^
"KRN",.84,7981997.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981997.001,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981997.001,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981997.001,2,4,0)
 
"KRN",.84,7981997.001,2,5,0)
<!-- Patients (997.1) -->
"KRN",.84,7981997.001,2,6,0)
 
"KRN",.84,7981997.001,2,7,0)
<!-- Determine if the Age, DOB, ICN, PACT or PCP column is present on the 
"KRN",.84,7981997.001,2,8,0)
report. -->  
"KRN",.84,7981997.001,2,9,0)
<xsl:variable name="AGE_YES"  
"KRN",.84,7981997.001,2,10,0)
select="count(/REPORT/HEADER/TBLDEF//COLUMN[@NAME='AGE']) &gt; 0"/>
"KRN",.84,7981997.001,2,11,0)
<xsl:variable name="DOB_YES"  
"KRN",.84,7981997.001,2,12,0)
select="count(/REPORT/HEADER/TBLDEF//COLUMN[@NAME='DOB']) &gt; 0"/>
"KRN",.84,7981997.001,2,13,0)
<xsl:variable name="ICN_YES"  
"KRN",.84,7981997.001,2,14,0)
select="count(/REPORT/HEADER/TBLDEF//COLUMN[@NAME='ICN']) &gt; 0"/>
"KRN",.84,7981997.001,2,15,0)
<xsl:variable name="PACT_YES" 
"KRN",.84,7981997.001,2,16,0)
select="count(/REPORT/HEADER/TBLDEF//COLUMN[@NAME='PACT']) &gt; 0"/>
"KRN",.84,7981997.001,2,17,0)
<xsl:variable name="PCP_YES"  
"KRN",.84,7981997.001,2,18,0)
select="count(/REPORT/HEADER/TBLDEF//COLUMN[@NAME='PCP']) &gt; 0"/>
"KRN",.84,7981997.001,2,19,0)
 
"KRN",.84,7981997.001,2,20,0)
<!--[ UTILITIES ]-->
"KRN",.84,7981997.001,2,21,0)
 
"KRN",.84,7981997.001,2,22,0)
<xsl:template name="BasicPatientHeader">
"KRN",.84,7981997.001,2,23,0)
<xsl:param name="rowspan" select="1"/>
"KRN",.84,7981997.001,2,24,0)
<xsl:param name="seqnum" select="1"/>
"KRN",.84,7981997.001,2,25,0)
<xsl:param name="tblname" select="'PATIENTS'"/>
"KRN",.84,7981997.001,2,26,0)
<xsl:param name="ageyes" select="''"/>
"KRN",.84,7981997.001,2,27,0)
<xsl:param name="dobyes" select="''"/>
"KRN",.84,7981997.001,2,28,0)
<xsl:param name="icnyes" select="''"/>
"KRN",.84,7981997.001,2,29,0)
<xsl:param name="pactyes" select="''"/>
"KRN",.84,7981997.001,2,30,0)
<xsl:param name="pcpyes" select="''"/>
"KRN",.84,7981997.001,2,31,0)
<xsl:if test="$seqnum">
"KRN",.84,7981997.001,2,32,0)
  <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,33,0)
   <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,34,0)
   <xsl:with-param name="sort" select="''"/>
"KRN",.84,7981997.001,2,35,0)
   <xsl:with-param name="title" select="'#'"/>
"KRN",.84,7981997.001,2,36,0)
   <xsl:with-param name="width" select="'4%'"/>
"KRN",.84,7981997.001,2,37,0)
  </xsl:call-template>
"KRN",.84,7981997.001,2,38,0)
</xsl:if>
"KRN",.84,7981997.001,2,39,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,40,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,41,0)
  <xsl:with-param name="sort" select="concat($tblname,'=NAME')"/>
"KRN",.84,7981997.001,2,42,0)
  <xsl:with-param name="title" select="'Patient Name'"/>
"KRN",.84,7981997.001,2,43,0)
</xsl:call-template>
"KRN",.84,7981997.001,2,44,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,45,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,46,0)
  <xsl:with-param name="sort" select="concat($tblname,'=LAST4')"/>
"KRN",.84,7981997.001,2,47,0)
  <xsl:with-param name="title" select="'SSN'"/>
"KRN",.84,7981997.001,2,48,0)
  <xsl:with-param name="width" select="'7%'"/>
"KRN",.84,7981997.001,2,49,0)
</xsl:call-template>
"KRN",.84,7981997.001,2,50,0)
<xsl:if test="$ageyes!='' or $AGE_YES">
"KRN",.84,7981997.001,2,51,0)
  <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,52,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,53,0)
  <xsl:with-param name="sort" select="concat($tblname,'=AGE')"/>
"KRN",.84,7981997.001,2,54,0)
  <xsl:with-param name="title" select="'Age'"/>
"KRN",.84,7981997.001,2,55,0)
  <xsl:with-param name="width" select="'4%'"/>
"KRN",.84,7981997.001,2,56,0)
  </xsl:call-template>
"KRN",.84,7981997.001,2,57,0)
</xsl:if>
"KRN",.84,7981997.001,2,58,0)
<xsl:if test="$dobyes!='' or $DOB_YES">
"KRN",.84,7981997.001,2,59,0)
  <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,60,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,61,0)
  <xsl:with-param name="sort" select="concat($tblname,'=DOB')"/>
"KRN",.84,7981997.001,2,62,0)
  <xsl:with-param name="title" select="'Date of Birth'"/>
"KRN",.84,7981997.001,2,63,0)
  <xsl:with-param name="width" select="'7%'"/>
"KRN",.84,7981997.001,2,64,0)
  </xsl:call-template>
"KRN",.84,7981997.001,2,65,0)
</xsl:if>
"KRN",.84,7981997.001,2,66,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,67,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,68,0)
  <xsl:with-param name="sort" select="concat($tblname,'=DOD')"/>
"KRN",.84,7981997.001,2,69,0)
  <xsl:with-param name="title" select="'Date of Death'"/>
"KRN",.84,7981997.001,2,70,0)
  <xsl:with-param name="width" select="'7%'"/>
"KRN",.84,7981997.001,2,71,0)
</xsl:call-template>
"KRN",.84,7981997.001,2,72,0)
<xsl:if test="$icnyes!=''">
"KRN",.84,7981997.001,2,73,0)
  <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,74,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,75,0)
  <xsl:with-param name="sort" select="concat($tblname,'=ICN')"/>
"KRN",.84,7981997.001,2,76,0)
  <xsl:with-param name="title" select="'ICN'"/>
"KRN",.84,7981997.001,2,77,0)
  <xsl:with-param name="width" select="'12%'"/>
"KRN",.84,7981997.001,2,78,0)
  </xsl:call-template>
"KRN",.84,7981997.001,2,79,0)
</xsl:if>
"KRN",.84,7981997.001,2,80,0)
<xsl:if test="$pactyes!=''">
"KRN",.84,7981997.001,2,81,0)
  <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,82,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,83,0)
  <xsl:with-param name="sort" select="concat($tblname,'=PACT')"/>
"KRN",.84,7981997.001,2,84,0)
  <xsl:with-param name="title" select="'PACT'"/>
"KRN",.84,7981997.001,2,85,0)
  <xsl:with-param name="width" select="'12%'"/>
"KRN",.84,7981997.001,2,86,0)
  </xsl:call-template>
"KRN",.84,7981997.001,2,87,0)
</xsl:if>
"KRN",.84,7981997.001,2,88,0)
<xsl:if test="$pcpyes!=''">
"KRN",.84,7981997.001,2,89,0)
  <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,90,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,91,0)
  <xsl:with-param name="sort" select="concat($tblname,'=PCP')"/>
"KRN",.84,7981997.001,2,92,0)
  <xsl:with-param name="title" select="'PCP'"/>
"KRN",.84,7981997.001,2,93,0)
  <xsl:with-param name="width" select="'12%'"/>
"KRN",.84,7981997.001,2,94,0)
  </xsl:call-template>
"KRN",.84,7981997.001,2,95,0)
</xsl:if>
"KRN",.84,7981997.001,2,96,0)
</xsl:template>
"KRN",.84,7981997.001,2,97,0)
 
"KRN",.84,7981997.001,2,98,0)
<xsl:template name="BasicPatientData">
"KRN",.84,7981997.001,2,99,0)
<xsl:param name="rowspan" select="1"/>
"KRN",.84,7981997.001,2,100,0)
<xsl:param name="seqnum" select="1"/>
"KRN",.84,7981997.001,2,101,0)
<xsl:param name="number" select="position()"/>
"KRN",.84,7981997.001,2,102,0)
<xsl:param name="ageyes" select="''"/>
"KRN",.84,7981997.001,2,103,0)
<xsl:param name="dobyes" select="''"/>
"KRN",.84,7981997.001,2,104,0)
<xsl:param name="icnyes" select="''"/>
"KRN",.84,7981997.001,2,105,0)
<xsl:param name="pactyes" select="''"/>
"KRN",.84,7981997.001,2,106,0)
<xsl:param name="pcpyes" select="''"/>
"KRN",.84,7981997.001,2,107,0)
<xsl:if test="$seqnum">
"KRN",.84,7981997.001,2,108,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981997.001,2,109,0)
   <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,110,0)
   <xsl:with-param name="value" select="$number"/>
"KRN",.84,7981997.001,2,111,0)
  </xsl:call-template>
"KRN",.84,7981997.001,2,112,0)
</xsl:if>
"KRN",.84,7981997.001,2,113,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981997.001,2,114,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,115,0)
  <xsl:with-param name="value" select="NAME"/>
"KRN",.84,7981997.001,2,116,0)
  <xsl:with-param name="class" select="'aLeft'"/>
"KRN",.84,7981997.001,2,117,0)
</xsl:call-template>
"KRN",.84,7981997.001,2,118,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981997.001,2,119,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,120,0)
  <xsl:with-param name="value" select="LAST4"/>
"KRN",.84,7981997.001,2,121,0)
</xsl:call-template>
"KRN",.84,7981997.001,2,122,0)
<xsl:if test="$ageyes!='' or $AGE_YES">
"KRN",.84,7981997.001,2,123,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981997.001,2,124,0)
   <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,125,0)
   <xsl:with-param name="value" select="AGE"/>
"KRN",.84,7981997.001,2,126,0)
  </xsl:call-template>
"KRN",.84,7981997.001,2,127,0)
</xsl:if>
"KRN",.84,7981997.001,2,128,0)
<xsl:if test="$dobyes!='' or $DOB_YES">
"KRN",.84,7981997.001,2,129,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981997.001,2,130,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,131,0)
  <xsl:with-param name="value" select="DOB"/>
"KRN",.84,7981997.001,2,132,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981997.001,2,133,0)
  </xsl:call-template>
"KRN",.84,7981997.001,2,134,0)
</xsl:if>
"KRN",.84,7981997.001,2,135,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981997.001,2,136,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,137,0)
  <xsl:with-param name="value" select="DOD"/>
"KRN",.84,7981997.001,2,138,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981997.001,2,139,0)
</xsl:call-template>
"KRN",.84,7981997.001,2,140,0)
<xsl:if test="$icnyes!=''">
"KRN",.84,7981997.001,2,141,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981997.001,2,142,0)
   <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,143,0)
   <xsl:with-param name="value" select="ICN"/>
"KRN",.84,7981997.001,2,144,0)
   <xsl:with-param name="class" select="'aLeft'"/>
"KRN",.84,7981997.001,2,145,0)
  </xsl:call-template>
"KRN",.84,7981997.001,2,146,0)
</xsl:if>
"KRN",.84,7981997.001,2,147,0)
<xsl:if test="$pactyes!=''">
"KRN",.84,7981997.001,2,148,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981997.001,2,149,0)
   <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,150,0)
   <xsl:with-param name="value" select="PACT"/>
"KRN",.84,7981997.001,2,151,0)
   <xsl:with-param name="class" select="'aLeft'"/>
"KRN",.84,7981997.001,2,152,0)
  </xsl:call-template>
"KRN",.84,7981997.001,2,153,0)
</xsl:if>
"KRN",.84,7981997.001,2,154,0)
<xsl:if test="$pcpyes!=''">
"KRN",.84,7981997.001,2,155,0)
  <xsl:call-template name="TableCell">
"KRN",.84,7981997.001,2,156,0)
   <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,157,0)
   <xsl:with-param name="value" select="PCP"/>
"KRN",.84,7981997.001,2,158,0)
   <xsl:with-param name="class" select="'aLeft'"/>
"KRN",.84,7981997.001,2,159,0)
  </xsl:call-template>
"KRN",.84,7981997.001,2,160,0)
</xsl:if>
"KRN",.84,7981997.001,2,161,0)
</xsl:template>
"KRN",.84,7981997.001,2,162,0)
 
"KRN",.84,7981997.001,2,163,0)
<!--[ PATIENT TABLE HEADINGS ]-->
"KRN",.84,7981997.001,2,164,0)
 
"KRN",.84,7981997.001,2,165,0)
<xsl:template match="COLUMN[@NAME='ADMDT']">
"KRN",.84,7981997.001,2,166,0)
<xsl:param name="rowspan" select="0"/>
"KRN",.84,7981997.001,2,167,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,168,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,169,0)
  <xsl:with-param name="title" select="'Admission Date'"/>
"KRN",.84,7981997.001,2,170,0)
  <xsl:with-param name="width" select="'7%'"/>
"KRN",.84,7981997.001,2,171,0)
</xsl:call-template>
"KRN",.84,7981997.001,2,172,0)
</xsl:template>
"KRN",.84,7981997.001,2,173,0)
 
"KRN",.84,7981997.001,2,174,0)
<xsl:template match="COLUMN[@NAME='AGE']">
"KRN",.84,7981997.001,2,175,0)
<xsl:param name="rowspan" select="0"/>
"KRN",.84,7981997.001,2,176,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,177,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,178,0)
  <xsl:with-param name="title" select="'Age'"/>                 
"KRN",.84,7981997.001,2,179,0)
  <xsl:with-param name="width" select="'5%'"/>
"KRN",.84,7981997.001,2,180,0)
</xsl:call-template>
"KRN",.84,7981997.001,2,181,0)
</xsl:template>
"KRN",.84,7981997.001,2,182,0)
 
"KRN",.84,7981997.001,2,183,0)
<xsl:template match="COLUMN[@NAME='CONFDT']">
"KRN",.84,7981997.001,2,184,0)
<xsl:param name="rowspan" select="0"/>
"KRN",.84,7981997.001,2,185,0)
  <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,186,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,187,0)
  <xsl:with-param name="title" select="'Confirmation Date'"/>
"KRN",.84,7981997.001,2,188,0)
  <xsl:with-param name="sort" select="'PATIENTS=CONFDT:DESC'"/>
"KRN",.84,7981997.001,2,189,0)
  <xsl:with-param name="width" select="'7%'"/>
"KRN",.84,7981997.001,2,190,0)
</xsl:call-template>
"KRN",.84,7981997.001,2,191,0)
</xsl:template>
"KRN",.84,7981997.001,2,192,0)
 
"KRN",.84,7981997.001,2,193,0)
<xsl:template match="COLUMN[@NAME='CSSN']">
"KRN",.84,7981997.001,2,194,0)
<xsl:param name="rowspan" select="0"/>
"KRN",.84,7981997.001,2,195,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,196,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,197,0)
  <xsl:with-param name="title" select="'Coded 
"KRN",.84,7981997.001,2,198,0)
SSN'"/>                      
"KRN",.84,7981997.001,2,199,0)
 </xsl:call-template>
"KRN",.84,7981997.001,2,200,0)
</xsl:template>
"KRN",.84,7981997.001,2,201,0)
 
"KRN",.84,7981997.001,2,202,0)
<xsl:template match="COLUMN[@NAME='DOB']">
"KRN",.84,7981997.001,2,203,0)
<xsl:param name="rowspan" select="0"/>
"KRN",.84,7981997.001,2,204,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,205,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,206,0)
  <xsl:with-param name="title" select="'Date of 
"KRN",.84,7981997.001,2,207,0)
Birth'"/>                  
"KRN",.84,7981997.001,2,208,0)
  <xsl:with-param name="width" select="'7%'"/>
"KRN",.84,7981997.001,2,209,0)
</xsl:call-template>
"KRN",.84,7981997.001,2,210,0)
</xsl:template>
"KRN",.84,7981997.001,2,211,0)
 
"KRN",.84,7981997.001,2,212,0)
<xsl:template match="COLUMN[@NAME='ENTDT']">
"KRN",.84,7981997.001,2,213,0)
<xsl:param name="rowspan" select="0"/>
"KRN",.84,7981997.001,2,214,0)
  <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,215,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,216,0)
   <xsl:with-param name="title" select="'Date Entered'"/>
"KRN",.84,7981997.001,2,217,0)
  <xsl:with-param name="sort" 
"KRN",.84,7981997.001,2,218,0)
select="'PATIENTS=ENTDT:DESC'"/>                      
"KRN",.84,7981997.001,2,219,0)
  <xsl:with-param name="width" select="'7%'"/>
"KRN",.84,7981997.001,2,220,0)
</xsl:call-template>
"KRN",.84,7981997.001,2,221,0)
</xsl:template>
"KRN",.84,7981997.001,2,222,0)
 
"KRN",.84,7981997.001,2,223,0)
<xsl:template match="COLUMN[@NAME='ETHN']">
"KRN",.84,7981997.001,2,224,0)
<xsl:param name="rowspan" select="0"/>
"KRN",.84,7981997.001,2,225,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,226,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,227,0)
  <xsl:with-param name="title" select="'Ethnicity'"/>
"KRN",.84,7981997.001,2,228,0)
  <xsl:with-param name="sort" select="''"/>
"KRN",.84,7981997.001,2,229,0)
</xsl:call-template>
"KRN",.84,7981997.001,2,230,0)
</xsl:template>
"KRN",.84,7981997.001,2,231,0)
 
"KRN",.84,7981997.001,2,232,0)
<xsl:template match="COLUMN[@NAME='RACE']">
"KRN",.84,7981997.001,2,233,0)
<xsl:param name="rowspan" select="0"/>
"KRN",.84,7981997.001,2,234,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,235,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,236,0)
  <xsl:with-param name="title" select="'Race'"/>
"KRN",.84,7981997.001,2,237,0)
  <xsl:with-param name="sort" select="''"/>
"KRN",.84,7981997.001,2,238,0)
</xsl:call-template>
"KRN",.84,7981997.001,2,239,0)
</xsl:template>
"KRN",.84,7981997.001,2,240,0)
 
"KRN",.84,7981997.001,2,241,0)
<xsl:template match="COLUMN[@NAME='SELDT']">
"KRN",.84,7981997.001,2,242,0)
<xsl:param name="rowspan" select="0"/>
"KRN",.84,7981997.001,2,243,0)
  <xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,244,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,245,0)
   <xsl:with-param name="title" select="'Selection Date'"/>
"KRN",.84,7981997.001,2,246,0)
  <xsl:with-param name="width" select="'7%'"/>
"KRN",.84,7981997.001,2,247,0)
</xsl:call-template>
"KRN",.84,7981997.001,2,248,0)
</xsl:template>
"KRN",.84,7981997.001,2,249,0)
 
"KRN",.84,7981997.001,2,250,0)
<xsl:template match="COLUMN[@NAME='SEX']">
"KRN",.84,7981997.001,2,251,0)
<xsl:param name="rowspan" select="0"/>
"KRN",.84,7981997.001,2,252,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,253,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,254,0)
  <xsl:with-param name="title" select="'Birth Sex'"/>                 
"KRN",.84,7981997.001,2,255,0)
  <xsl:with-param name="width" select="'5%'"/>
"KRN",.84,7981997.001,2,256,0)
</xsl:call-template>
"KRN",.84,7981997.001,2,257,0)
</xsl:template>
"KRN",.84,7981997.001,2,258,0)
 
"KRN",.84,7981997.001,2,259,0)
<xsl:template match="COLUMN[@NAME='BIRTHSEX']">
"KRN",.84,7981997.001,2,260,0)
<xsl:param name="rowspan" select="0"/>
"KRN",.84,7981997.001,2,261,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.001,2,262,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,263,0)
  <xsl:with-param name="title" select="'Birth Sex'"/>                 
"KRN",.84,7981997.001,2,264,0)
  <xsl:with-param name="width" select="'5%'"/>
"KRN",.84,7981997.001,2,265,0)
</xsl:call-template>
"KRN",.84,7981997.001,2,266,0)
</xsl:template>
"KRN",.84,7981997.001,2,267,0)
 
"KRN",.84,7981997.001,2,268,0)
<!--[ PATIENT TABLE CELLS ]-->
"KRN",.84,7981997.001,2,269,0)
 
"KRN",.84,7981997.001,2,270,0)
<xsl:template match="PATIENT/ADMDT">
"KRN",.84,7981997.001,2,271,0)
<xsl:param name="rowspan" select="0"/>
"KRN",.84,7981997.001,2,272,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981997.001,2,273,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981997.001,2,274,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,275,0)
</xsl:call-template>
"KRN",.84,7981997.001,2,276,0)
</xsl:template>
"KRN",.84,7981997.001,2,277,0)
 
"KRN",.84,7981997.001,2,278,0)
<xsl:template match="PATIENT/CONFDT">
"KRN",.84,7981997.001,2,279,0)
<xsl:param name="rowspan" select="0"/>
"KRN",.84,7981997.001,2,280,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981997.001,2,281,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981997.001,2,282,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,283,0)
</xsl:call-template>
"KRN",.84,7981997.001,2,284,0)
</xsl:template>
"KRN",.84,7981997.001,2,285,0)
 
"KRN",.84,7981997.001,2,286,0)
<xsl:template match="PATIENT/DOB">
"KRN",.84,7981997.001,2,287,0)
<xsl:param name="rowspan" select="0"/>
"KRN",.84,7981997.001,2,288,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981997.001,2,289,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981997.001,2,290,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,291,0)
</xsl:call-template>
"KRN",.84,7981997.001,2,292,0)
</xsl:template>
"KRN",.84,7981997.001,2,293,0)
 
"KRN",.84,7981997.001,2,294,0)
<xsl:template match="PATIENT/ENTDT">
"KRN",.84,7981997.001,2,295,0)
<xsl:param name="rowspan" select="0"/>
"KRN",.84,7981997.001,2,296,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981997.001,2,297,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981997.001,2,298,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,299,0)
</xsl:call-template>
"KRN",.84,7981997.001,2,300,0)
</xsl:template>
"KRN",.84,7981997.001,2,301,0)
 
"KRN",.84,7981997.001,2,302,0)
<xsl:template match="PATIENT/RACES">
"KRN",.84,7981997.001,2,303,0)
<td class="aLeft">
"KRN",.84,7981997.001,2,304,0)
  <xsl:for-each select="RACE">
"KRN",.84,7981997.001,2,305,0)
   <xsl:value-of select="."/>
"KRN",.84,7981997.001,2,306,0)
   <xsl:if test=".=''"><xsl:text>&#160;</xsl:text></xsl:if><br/>
"KRN",.84,7981997.001,2,307,0)
  </xsl:for-each>
"KRN",.84,7981997.001,2,308,0)
</td>
"KRN",.84,7981997.001,2,309,0)
</xsl:template>
"KRN",.84,7981997.001,2,310,0)
 
"KRN",.84,7981997.001,2,311,0)
<xsl:template match="PATIENT/SELDT">
"KRN",.84,7981997.001,2,312,0)
<xsl:param name="rowspan" select="0"/>
"KRN",.84,7981997.001,2,313,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981997.001,2,314,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981997.001,2,315,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981997.001,2,316,0)
</xsl:call-template>
"KRN",.84,7981997.001,2,317,0)
</xsl:template>
"KRN",.84,7981997.001,2,318,0)
 
"KRN",.84,7981997.001,2,319,0)
</xsl:stylesheet>
"KRN",.84,7981997.002,-1)
0^30
"KRN",.84,7981997.002,0)
7981997.002^2^^CLINICAL CASE REGISTRIES^Patient data templates (CSV)
"KRN",.84,7981997.002,2,0)
^^171^171^3170802^
"KRN",.84,7981997.002,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981997.002,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981997.002,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981997.002,2,4,0)
 
"KRN",.84,7981997.002,2,5,0)
<!-- Patients (997.2) -->
"KRN",.84,7981997.002,2,6,0)
 
"KRN",.84,7981997.002,2,7,0)
<!--[ UTILITIES ]-->
"KRN",.84,7981997.002,2,8,0)
 
"KRN",.84,7981997.002,2,9,0)
<xsl:template name="BasicPatientData">
"KRN",.84,7981997.002,2,10,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981997.002,2,11,0)
  <xsl:with-param name="value" select="../NAME"/>
"KRN",.84,7981997.002,2,12,0)
</xsl:call-template>
"KRN",.84,7981997.002,2,13,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981997.002,2,14,0)
  <xsl:with-param name="value" select="../LAST4"/>
"KRN",.84,7981997.002,2,15,0)
</xsl:call-template>
"KRN",.84,7981997.002,2,16,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981997.002,2,17,0)
  <xsl:with-param name="value" select="../DOD"/>
"KRN",.84,7981997.002,2,18,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981997.002,2,19,0)
</xsl:call-template>
"KRN",.84,7981997.002,2,20,0)
</xsl:template>
"KRN",.84,7981997.002,2,21,0)
 
"KRN",.84,7981997.002,2,22,0)
<!--[ PATIENT TABLE HEADINGS ]-->
"KRN",.84,7981997.002,2,23,0)
 
"KRN",.84,7981997.002,2,24,0)
<xsl:template match="COLUMN[@NAME='ADMDT']">
"KRN",.84,7981997.002,2,25,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.002,2,26,0)
  <xsl:with-param name="title" select="'Admission Date'"/>
"KRN",.84,7981997.002,2,27,0)
</xsl:call-template>
"KRN",.84,7981997.002,2,28,0)
</xsl:template>
"KRN",.84,7981997.002,2,29,0)
 
"KRN",.84,7981997.002,2,30,0)
<xsl:template match="COLUMN[@NAME='AGE']">
"KRN",.84,7981997.002,2,31,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.002,2,32,0)
  <xsl:with-param name="title" select="'Age'"/>                 
"KRN",.84,7981997.002,2,33,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,34,0)
</xsl:template>
"KRN",.84,7981997.002,2,35,0)
 
"KRN",.84,7981997.002,2,36,0)
<xsl:template match="COLUMN[@NAME='CONFDT']">
"KRN",.84,7981997.002,2,37,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.002,2,38,0)
  <xsl:with-param name="title" select="'Confirmation Date'"/>
"KRN",.84,7981997.002,2,39,0)
</xsl:call-template>
"KRN",.84,7981997.002,2,40,0)
</xsl:template>
"KRN",.84,7981997.002,2,41,0)
 
"KRN",.84,7981997.002,2,42,0)
<xsl:template match="COLUMN[@NAME='CSSN']">
"KRN",.84,7981997.002,2,43,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.002,2,44,0)
  <xsl:with-param name="title" select="'Coded 
"KRN",.84,7981997.002,2,45,0)
SSN'"/>                      
"KRN",.84,7981997.002,2,46,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,47,0)
</xsl:template>
"KRN",.84,7981997.002,2,48,0)
 
"KRN",.84,7981997.002,2,49,0)
<xsl:template match="COLUMN[@NAME='DOB']">
"KRN",.84,7981997.002,2,50,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.002,2,51,0)
  <xsl:with-param name="title" select="'Date of 
"KRN",.84,7981997.002,2,52,0)
Birth'"/>                  
"KRN",.84,7981997.002,2,53,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,54,0)
</xsl:template>
"KRN",.84,7981997.002,2,55,0)
 
"KRN",.84,7981997.002,2,56,0)
<xsl:template match="COLUMN[@NAME='ENTDT']">
"KRN",.84,7981997.002,2,57,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.002,2,58,0)
  <xsl:with-param name="title" select="'Date Entered'"/>
"KRN",.84,7981997.002,2,59,0)
</xsl:call-template>
"KRN",.84,7981997.002,2,60,0)
</xsl:template>
"KRN",.84,7981997.002,2,61,0)
 
"KRN",.84,7981997.002,2,62,0)
<xsl:template match="COLUMN[@NAME='ETHN']">
"KRN",.84,7981997.002,2,63,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.002,2,64,0)
  <xsl:with-param name="title" select="'Ethnicity'"/>
"KRN",.84,7981997.002,2,65,0)
</xsl:call-template>
"KRN",.84,7981997.002,2,66,0)
</xsl:template>
"KRN",.84,7981997.002,2,67,0)
 
"KRN",.84,7981997.002,2,68,0)
<xsl:template match="COLUMN[@NAME='PRIMELIG']">
"KRN",.84,7981997.002,2,69,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.002,2,70,0)
  <xsl:with-param name="title" select="'Primary Eligibility'"/>
"KRN",.84,7981997.002,2,71,0)
</xsl:call-template>
"KRN",.84,7981997.002,2,72,0)
</xsl:template>
"KRN",.84,7981997.002,2,73,0)
 
"KRN",.84,7981997.002,2,74,0)
<xsl:template match="COLUMN[@NAME='RACE']">
"KRN",.84,7981997.002,2,75,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.002,2,76,0)
  <xsl:with-param name="title" select="'Race'"/>
"KRN",.84,7981997.002,2,77,0)
</xsl:call-template>
"KRN",.84,7981997.002,2,78,0)
</xsl:template>
"KRN",.84,7981997.002,2,79,0)
 
"KRN",.84,7981997.002,2,80,0)
<xsl:template match="COLUMN[@NAME='SELDT']">
"KRN",.84,7981997.002,2,81,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.002,2,82,0)
  <xsl:with-param name="title" select="'Selection Date'"/>
"KRN",.84,7981997.002,2,83,0)
</xsl:call-template>
"KRN",.84,7981997.002,2,84,0)
</xsl:template>
"KRN",.84,7981997.002,2,85,0)
 
"KRN",.84,7981997.002,2,86,0)
<xsl:template match="COLUMN[@NAME='SELRULES']">
"KRN",.84,7981997.002,2,87,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.002,2,88,0)
  <xsl:with-param name="title" select="'Reasons'"/>
"KRN",.84,7981997.002,2,89,0)
</xsl:call-template>
"KRN",.84,7981997.002,2,90,0)
</xsl:template>
"KRN",.84,7981997.002,2,91,0)
 
"KRN",.84,7981997.002,2,92,0)
<xsl:template match="COLUMN[@NAME='FIRSTDIAG']">
"KRN",.84,7981997.002,2,93,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.002,2,94,0)
  <xsl:with-param name="title" select="'Diagnosed at this Facility'"/>
"KRN",.84,7981997.002,2,95,0)
</xsl:call-template>
"KRN",.84,7981997.002,2,96,0)
</xsl:template>
"KRN",.84,7981997.002,2,97,0)
 
"KRN",.84,7981997.002,2,98,0)
<xsl:template match="COLUMN[@NAME='BIRTHSEX']">
"KRN",.84,7981997.002,2,99,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.002,2,100,0)
  <xsl:with-param name="title" select="'Birth Sex'"/>                 
"KRN",.84,7981997.002,2,101,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,102,0)
</xsl:template>
"KRN",.84,7981997.002,2,103,0)
 
"KRN",.84,7981997.002,2,104,0)
 
"KRN",.84,7981997.002,2,105,0)
<xsl:template match="COLUMN[@NAME='SEX']">
"KRN",.84,7981997.002,2,106,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981997.002,2,107,0)
  <xsl:with-param name="title" select="'Birth Sex'"/>                 
"KRN",.84,7981997.002,2,108,0)
 </xsl:call-template>
"KRN",.84,7981997.002,2,109,0)
</xsl:template>
"KRN",.84,7981997.002,2,110,0)
 
"KRN",.84,7981997.002,2,111,0)
<!--[ PATIENT TABLE CELLS ]-->
"KRN",.84,7981997.002,2,112,0)
 
"KRN",.84,7981997.002,2,113,0)
<xsl:template match="PATIENT/ADMDT">
"KRN",.84,7981997.002,2,114,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981997.002,2,115,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981997.002,2,116,0)
</xsl:call-template>
"KRN",.84,7981997.002,2,117,0)
</xsl:template>
"KRN",.84,7981997.002,2,118,0)
 
"KRN",.84,7981997.002,2,119,0)
<xsl:template match="PATIENT/CONFDT">
"KRN",.84,7981997.002,2,120,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981997.002,2,121,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981997.002,2,122,0)
</xsl:call-template>
"KRN",.84,7981997.002,2,123,0)
</xsl:template>
"KRN",.84,7981997.002,2,124,0)
 
"KRN",.84,7981997.002,2,125,0)
<xsl:template match="PATIENT/DOB">
"KRN",.84,7981997.002,2,126,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981997.002,2,127,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981997.002,2,128,0)
</xsl:call-template>
"KRN",.84,7981997.002,2,129,0)
</xsl:template>
"KRN",.84,7981997.002,2,130,0)
 
"KRN",.84,7981997.002,2,131,0)
<xsl:template match="PATIENT/ENTDT">
"KRN",.84,7981997.002,2,132,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981997.002,2,133,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981997.002,2,134,0)
</xsl:call-template>
"KRN",.84,7981997.002,2,135,0)
</xsl:template>
"KRN",.84,7981997.002,2,136,0)
 
"KRN",.84,7981997.002,2,137,0)
<xsl:template match="PATIENT/RACES">
"KRN",.84,7981997.002,2,138,0)
<xsl:text>&quot;</xsl:text>
"KRN",.84,7981997.002,2,139,0)
<xsl:for-each select="RACE">
"KRN",.84,7981997.002,2,140,0)
  <xsl:if test="position()>1"><xsl:text>; </xsl:text></xsl:if>
"KRN",.84,7981997.002,2,141,0)
  <xsl:call-template name="DoubleQuotes"/>
"KRN",.84,7981997.002,2,142,0)
</xsl:for-each>
"KRN",.84,7981997.002,2,143,0)
<xsl:text>&quot;</xsl:text>
"KRN",.84,7981997.002,2,144,0)
<xsl:value-of select="$DELIMITER"/>
"KRN",.84,7981997.002,2,145,0)
</xsl:template>
"KRN",.84,7981997.002,2,146,0)
 
"KRN",.84,7981997.002,2,147,0)
<xsl:template match="PATIENT/SEEN">
"KRN",.84,7981997.002,2,148,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981997.002,2,149,0)
  <xsl:with-param name="yesno" select="1"/>
"KRN",.84,7981997.002,2,150,0)
</xsl:call-template>
"KRN",.84,7981997.002,2,151,0)
</xsl:template>
"KRN",.84,7981997.002,2,152,0)
 
"KRN",.84,7981997.002,2,153,0)
<xsl:template match="PATIENT/SELDT">
"KRN",.84,7981997.002,2,154,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981997.002,2,155,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981997.002,2,156,0)
</xsl:call-template>
"KRN",.84,7981997.002,2,157,0)
</xsl:template>
"KRN",.84,7981997.002,2,158,0)
 
"KRN",.84,7981997.002,2,159,0)
<xsl:template match="PATIENT/SELRULES">
"KRN",.84,7981997.002,2,160,0)
<xsl:text>&quot;</xsl:text>
"KRN",.84,7981997.002,2,161,0)
<xsl:for-each select="RULE">
"KRN",.84,7981997.002,2,162,0)
  <xsl:if test="position()>1"><xsl:text>; </xsl:text></xsl:if>
"KRN",.84,7981997.002,2,163,0)
  <xsl:call-template name="DoubleQuotes">
"KRN",.84,7981997.002,2,164,0)
   <xsl:with-param name="value" select="@DESCR"/>
"KRN",.84,7981997.002,2,165,0)
  </xsl:call-template>
"KRN",.84,7981997.002,2,166,0)
</xsl:for-each>
"KRN",.84,7981997.002,2,167,0)
<xsl:text>&quot;</xsl:text>
"KRN",.84,7981997.002,2,168,0)
<xsl:value-of select="$DELIMITER"/>
"KRN",.84,7981997.002,2,169,0)
</xsl:template>
"KRN",.84,7981997.002,2,170,0)
 
"KRN",.84,7981997.002,2,171,0)
</xsl:stylesheet>
"KRN",.84,7981999.001,-1)
0^27
"KRN",.84,7981999.001,0)
7981999.001^2^^CLINICAL CASE REGISTRIES^Common XSL templates (HTML)
"KRN",.84,7981999.001,2,0)
^^1025^1025^3170802^
"KRN",.84,7981999.001,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981999.001,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981999.001,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981999.001,2,4,0)
 
"KRN",.84,7981999.001,2,5,0)
<!-- Common (999.1) -->
"KRN",.84,7981999.001,2,6,0)
 
"KRN",.84,7981999.001,2,7,0)
<xsl:param name="REMOVE_URLS"/>
"KRN",.84,7981999.001,2,8,0)
 
"KRN",.84,7981999.001,2,9,0)
<xsl:output method="html" indent="yes" encoding="iso-8859-1"/>
"KRN",.84,7981999.001,2,10,0)
<xsl:strip-space elements="*"/>
"KRN",.84,7981999.001,2,11,0)
 
"KRN",.84,7981999.001,2,12,0)
<xsl:template match="REPORT/HEADER//*"></xsl:template>
"KRN",.84,7981999.001,2,13,0)
<xsl:template match="REPORT/PARAMETERS//*"></xsl:template>
"KRN",.84,7981999.001,2,14,0)
 
"KRN",.84,7981999.001,2,15,0)
<xsl:key name="TableDefs" match="/REPORT/HEADER/TBLDEF" use="@NAME"/>
"KRN",.84,7981999.001,2,16,0)
 
"KRN",.84,7981999.001,2,17,0)
<!--
"KRN",.84,7981999.001,2,18,0)
=========================================================================
"KRN",.84,7981999.001,2,19,0)
                                UTILITIES
"KRN",.84,7981999.001,2,20,0)
=========================================================================
"KRN",.84,7981999.001,2,21,0)
-->
"KRN",.84,7981999.001,2,22,0)
 
"KRN",.84,7981999.001,2,23,0)
<!-- Formats the value of table cell -->
"KRN",.84,7981999.001,2,24,0)
 
"KRN",.84,7981999.001,2,25,0)
<xsl:template name="CellValue">
"KRN",.84,7981999.001,2,26,0)
<xsl:param name="fmdt" select="0"/>
"KRN",.84,7981999.001,2,27,0)
<xsl:param name="value" select="."/>
"KRN",.84,7981999.001,2,28,0)
<xsl:param name="yesno" select="0"/>
"KRN",.84,7981999.001,2,29,0)
<xsl:choose>
"KRN",.84,7981999.001,2,30,0)
  <xsl:when test="string($value)=''">&#160;</xsl:when>
"KRN",.84,7981999.001,2,31,0)
  <xsl:when test="boolean($fmdt)">
"KRN",.84,7981999.001,2,32,0)
   <xsl:call-template name="DateTime">
"KRN",.84,7981999.001,2,33,0)
    <xsl:with-param name="dt" select="$value"/>
"KRN",.84,7981999.001,2,34,0)
   </xsl:call-template>
"KRN",.84,7981999.001,2,35,0)
  </xsl:when>
"KRN",.84,7981999.001,2,36,0)
  <xsl:when test="boolean($yesno)">
"KRN",.84,7981999.001,2,37,0)
   <xsl:choose>
"KRN",.84,7981999.001,2,38,0)
    <xsl:when test="$value!=0">Yes</xsl:when>
"KRN",.84,7981999.001,2,39,0)
    <xsl:otherwise>No</xsl:otherwise>
"KRN",.84,7981999.001,2,40,0)
   </xsl:choose>
"KRN",.84,7981999.001,2,41,0)
  </xsl:when>
"KRN",.84,7981999.001,2,42,0)
  <xsl:otherwise><xsl:value-of select="$value"/></xsl:otherwise>
"KRN",.84,7981999.001,2,43,0)
</xsl:choose>
"KRN",.84,7981999.001,2,44,0)
</xsl:template>
"KRN",.84,7981999.001,2,45,0)
 
"KRN",.84,7981999.001,2,46,0)
<!-- Converts the FileMan date/time in printable format -->
"KRN",.84,7981999.001,2,47,0)
 
"KRN",.84,7981999.001,2,48,0)
<xsl:template name="DateTime">
"KRN",.84,7981999.001,2,49,0)
<xsl:param name="dt" select="."/>
"KRN",.84,7981999.001,2,50,0)
<!--
"KRN",.84,7981999.001,2,51,0)
     Date (YYYMMDD)
"KRN",.84,7981999.001,2,52,0)
-->
"KRN",.84,7981999.001,2,53,0)
<xsl:variable name="date"
"KRN",.84,7981999.001,2,54,0)
               select="substring-before(concat($dt,'.'),'.')"/>
"KRN",.84,7981999.001,2,55,0)
<xsl:if test="$date!=''">
"KRN",.84,7981999.001,2,56,0)
  <xsl:choose>
"KRN",.84,7981999.001,2,57,0)
   <xsl:when test="string-length($date)=7">
"KRN",.84,7981999.001,2,58,0)
    <xsl:variable name="year"
"KRN",.84,7981999.001,2,59,0)
                  select="string(number(substring($date,1,3))+1700)"/>
"KRN",.84,7981999.001,2,60,0)
    <xsl:variable name="month" select="substring($date,4,2)"/>
"KRN",.84,7981999.001,2,61,0)
    <xsl:variable name="day" select="substring($date,6,2)"/>
"KRN",.84,7981999.001,2,62,0)
    <xsl:choose>
"KRN",.84,7981999.001,2,63,0)
     <xsl:when test="$day!='00'">
"KRN",.84,7981999.001,2,64,0)
      <xsl:value-of select="concat($month,'/',$day,'/',$year)"/>
"KRN",.84,7981999.001,2,65,0)
     </xsl:when>
"KRN",.84,7981999.001,2,66,0)
     <xsl:when test="$month!='00'">
"KRN",.84,7981999.001,2,67,0)
      <xsl:value-of select="concat($month,'/',$year)"/>
"KRN",.84,7981999.001,2,68,0)
     </xsl:when>
"KRN",.84,7981999.001,2,69,0)
     <xsl:otherwise><xsl:value-of select="$year"/></xsl:otherwise>
"KRN",.84,7981999.001,2,70,0)
    </xsl:choose>
"KRN",.84,7981999.001,2,71,0)
   </xsl:when>
"KRN",.84,7981999.001,2,72,0)
   <xsl:otherwise>{error}</xsl:otherwise>
"KRN",.84,7981999.001,2,73,0)
  </xsl:choose>
"KRN",.84,7981999.001,2,74,0)
  <!--
"KRN",.84,7981999.001,2,75,0)
      Time (HHMMSS)
"KRN",.84,7981999.001,2,76,0)
  -->
"KRN",.84,7981999.001,2,77,0)
  <xsl:variable name="time"
"KRN",.84,7981999.001,2,78,0)
                select="concat(substring-after($dt,'.'),'000000')"/>
"KRN",.84,7981999.001,2,79,0)
  <xsl:if test="number($time)>0">
"KRN",.84,7981999.001,2,80,0)
   <xsl:text>@</xsl:text>
"KRN",.84,7981999.001,2,81,0)
   <xsl:value-of select="substring($time,1,2)"/>
"KRN",.84,7981999.001,2,82,0)
   <xsl:text>:</xsl:text>
"KRN",.84,7981999.001,2,83,0)
   <xsl:value-of select="substring($time,3,2)"/>
"KRN",.84,7981999.001,2,84,0)
  </xsl:if>
"KRN",.84,7981999.001,2,85,0)
</xsl:if>
"KRN",.84,7981999.001,2,86,0)
</xsl:template>
"KRN",.84,7981999.001,2,87,0)
 
"KRN",.84,7981999.001,2,88,0)
<xsl:template name="HUPatientsHeader">
"KRN",.84,7981999.001,2,89,0)
<xsl:value-of select="/REPORT/PARAMETERS/MAXUTNUM"/>
"KRN",.84,7981999.001,2,90,0)
<xsl:text> patient(s) with highest utilization</xsl:text>
"KRN",.84,7981999.001,2,91,0)
</xsl:template>
"KRN",.84,7981999.001,2,92,0)
 
"KRN",.84,7981999.001,2,93,0)
<!-- Conditional hyperlink -->
"KRN",.84,7981999.001,2,94,0)
 
"KRN",.84,7981999.001,2,95,0)
<xsl:template name="HyperLink">
"KRN",.84,7981999.001,2,96,0)
<xsl:param name="href" select="''"/>
"KRN",.84,7981999.001,2,97,0)
<xsl:param name="keep" select="0"/>
"KRN",.84,7981999.001,2,98,0)
<xsl:param name="name" select="''"/>
"KRN",.84,7981999.001,2,99,0)
<xsl:param name="text" select="."/>
"KRN",.84,7981999.001,2,100,0)
<xsl:choose>
"KRN",.84,7981999.001,2,101,0)
  <xsl:when test="$text=''"><xsl:text>&#160;</xsl:text></xsl:when>
"KRN",.84,7981999.001,2,102,0)
  <xsl:when test="boolean($keep) or not($REMOVE_URLS)">
"KRN",.84,7981999.001,2,103,0)
   <a>
"KRN",.84,7981999.001,2,104,0)
    <xsl:if test="$name!=''">
"KRN",.84,7981999.001,2,105,0)
     <xsl:attribute name="name">
"KRN",.84,7981999.001,2,106,0)
      <xsl:value-of select="$name"/>
"KRN",.84,7981999.001,2,107,0)
     </xsl:attribute>
"KRN",.84,7981999.001,2,108,0)
    </xsl:if>
"KRN",.84,7981999.001,2,109,0)
    <xsl:if test="$href!=''">
"KRN",.84,7981999.001,2,110,0)
     <xsl:attribute name="href">
"KRN",.84,7981999.001,2,111,0)
      <xsl:value-of select="$href"/>
"KRN",.84,7981999.001,2,112,0)
     </xsl:attribute>
"KRN",.84,7981999.001,2,113,0)
    </xsl:if>
"KRN",.84,7981999.001,2,114,0)
    <xsl:value-of select="$text"/>
"KRN",.84,7981999.001,2,115,0)
   </a>
"KRN",.84,7981999.001,2,116,0)
  </xsl:when>
"KRN",.84,7981999.001,2,117,0)
  <xsl:otherwise><xsl:value-of select="$text"/></xsl:otherwise>
"KRN",.84,7981999.001,2,118,0)
</xsl:choose>
"KRN",.84,7981999.001,2,119,0)
</xsl:template>
"KRN",.84,7981999.001,2,120,0)
 
"KRN",.84,7981999.001,2,121,0)
<!-- Makes the parent container scrollable -->
"KRN",.84,7981999.001,2,122,0)
 
"KRN",.84,7981999.001,2,123,0)
<xsl:template name="MakeScrollable">
"KRN",.84,7981999.001,2,124,0)
<xsl:param name="condition" select="0"/>
"KRN",.84,7981999.001,2,125,0)
<xsl:choose>
"KRN",.84,7981999.001,2,126,0)
  <xsl:when test="$condition">
"KRN",.84,7981999.001,2,127,0)
   <xsl:attribute name="class">scrollableContainer</xsl:attribute>
"KRN",.84,7981999.001,2,128,0)
  </xsl:when>
"KRN",.84,7981999.001,2,129,0)
  <xsl:otherwise>
"KRN",.84,7981999.001,2,130,0)
   <xsl:attribute name="class">simpleContainer</xsl:attribute>
"KRN",.84,7981999.001,2,131,0)
  </xsl:otherwise>
"KRN",.84,7981999.001,2,132,0)
</xsl:choose>
"KRN",.84,7981999.001,2,133,0)
</xsl:template>
"KRN",.84,7981999.001,2,134,0)
 
"KRN",.84,7981999.001,2,135,0)
<!-- Outputs content of the multivalued report parameter -->
"KRN",.84,7981999.001,2,136,0)
 
"KRN",.84,7981999.001,2,137,0)
<xsl:template name="ParamsList">
"KRN",.84,7981999.001,2,138,0)
<xsl:param name="heading"/>
"KRN",.84,7981999.001,2,139,0)
<xsl:param name="list" select="."/>
"KRN",.84,7981999.001,2,140,0)
<tr>
"KRN",.84,7981999.001,2,141,0)
  <th scope="row">
"KRN",.84,7981999.001,2,142,0)
   <xsl:value-of select="concat($heading,':&#160;')"/>
"KRN",.84,7981999.001,2,143,0)
  </th>
"KRN",.84,7981999.001,2,144,0)
  <td>
"KRN",.84,7981999.001,2,145,0)
   <xsl:if test="$list/@DESCR">
"KRN",.84,7981999.001,2,146,0)
    <xsl:value-of select="$list/@DESCR"/><br/>
"KRN",.84,7981999.001,2,147,0)
   </xsl:if>
"KRN",.84,7981999.001,2,148,0)
   <xsl:if test="$list='ALL'">ALL</xsl:if>
"KRN",.84,7981999.001,2,149,0)
   <xsl:for-each select="$list/*">
"KRN",.84,7981999.001,2,150,0)
    <xsl:sort select="."/>
"KRN",.84,7981999.001,2,151,0)
    <xsl:if test="position()>1"><xsl:text>; </xsl:text></xsl:if>
"KRN",.84,7981999.001,2,152,0)
    <xsl:value-of select="."/>
"KRN",.84,7981999.001,2,153,0)
   </xsl:for-each>
"KRN",.84,7981999.001,2,154,0)
  </td>
"KRN",.84,7981999.001,2,155,0)
</tr>
"KRN",.84,7981999.001,2,156,0)
</xsl:template>
"KRN",.84,7981999.001,2,157,0)
 
"KRN",.84,7981999.001,2,158,0)
<!--
"KRN",.84,7981999.001,2,159,0)
Special processing for multivalued local fields to handle 
"KRN",.84,7981999.001,2,160,0)
pseudo local field  in the HIV_DX tag.
"KRN",.84,7981999.001,2,161,0)
-->
"KRN",.84,7981999.001,2,162,0)
 
"KRN",.84,7981999.001,2,163,0)
<xsl:template name="LocalList">
"KRN",.84,7981999.001,2,164,0)
<xsl:param name="firstitem"/>
"KRN",.84,7981999.001,2,165,0)
<xsl:param name="list" select="."/>
"KRN",.84,7981999.001,2,166,0)
<tr>
"KRN",.84,7981999.001,2,167,0)
  <th scope="row">
"KRN",.84,7981999.001,2,168,0)
   <xsl:text>Local Fields:&#160;</xsl:text>
"KRN",.84,7981999.001,2,169,0)
  </th>
"KRN",.84,7981999.001,2,170,0)
  <td>
"KRN",.84,7981999.001,2,171,0)
   <xsl:if test="$firstitem!=''">
"KRN",.84,7981999.001,2,172,0)
    <xsl:text>Diagnosed at this VA (</xsl:text>
"KRN",.84,7981999.001,2,173,0)
    <xsl:value-of select="$firstitem"/>
"KRN",.84,7981999.001,2,174,0)
    <xsl:text>); </xsl:text>
"KRN",.84,7981999.001,2,175,0)
   </xsl:if>
"KRN",.84,7981999.001,2,176,0)
   <xsl:for-each select="$list/*">
"KRN",.84,7981999.001,2,177,0)
    <xsl:sort select="."/>
"KRN",.84,7981999.001,2,178,0)
    <xsl:if test="position()>1"><xsl:text>; </xsl:text></xsl:if>
"KRN",.84,7981999.001,2,179,0)
    <xsl:value-of select="."/>
"KRN",.84,7981999.001,2,180,0)
   </xsl:for-each>
"KRN",.84,7981999.001,2,181,0)
  </td>
"KRN",.84,7981999.001,2,182,0)
</tr>
"KRN",.84,7981999.001,2,183,0)
</xsl:template>
"KRN",.84,7981999.001,2,184,0)
 
"KRN",.84,7981999.001,2,185,0)
 
"KRN",.84,7981999.001,2,186,0)
<!-- Outputs singular or plural form of the word -->
"KRN",.84,7981999.001,2,187,0)
 
"KRN",.84,7981999.001,2,188,0)
<xsl:template name="Plural">
"KRN",.84,7981999.001,2,189,0)
<xsl:param name="qnty" select="0"/>
"KRN",.84,7981999.001,2,190,0)
<xsl:param name="sq" select="0"/>
"KRN",.84,7981999.001,2,191,0)
<xsl:param name="word" select="."/>
"KRN",.84,7981999.001,2,192,0)
<xsl:if test="$sq=0">
"KRN",.84,7981999.001,2,193,0)
  <xsl:value-of select="$qnty"/><xsl:text>&#160;</xsl:text>
"KRN",.84,7981999.001,2,194,0)
</xsl:if>
"KRN",.84,7981999.001,2,195,0)
<xsl:choose>
"KRN",.84,7981999.001,2,196,0)
  <xsl:when test="$qnty=1">
"KRN",.84,7981999.001,2,197,0)
   <xsl:value-of select="substring-before($word,'^')"/>
"KRN",.84,7981999.001,2,198,0)
  </xsl:when>
"KRN",.84,7981999.001,2,199,0)
  <xsl:otherwise>
"KRN",.84,7981999.001,2,200,0)
   <xsl:value-of select="substring-after($word,'^')"/>
"KRN",.84,7981999.001,2,201,0)
  </xsl:otherwise>
"KRN",.84,7981999.001,2,202,0)
</xsl:choose>
"KRN",.84,7981999.001,2,203,0)
</xsl:template>
"KRN",.84,7981999.001,2,204,0)
 
"KRN",.84,7981999.001,2,205,0)
<!-- Formats basic information about the report -->
"KRN",.84,7981999.001,2,206,0)
 
"KRN",.84,7981999.001,2,207,0)
<xsl:template name="ReportInfo">
"KRN",.84,7981999.001,2,208,0)
<xsl:variable name="HDR" select="/REPORT/HEADER"/>
"KRN",.84,7981999.001,2,209,0)
<table cellpadding="0" cellspacing="0">
"KRN",.84,7981999.001,2,210,0)
  <tr>
"KRN",.84,7981999.001,2,211,0)
   <th scope="row">Report&#160;Created:&#160;</th>
"KRN",.84,7981999.001,2,212,0)
   <td>
"KRN",.84,7981999.001,2,213,0)
    <xsl:call-template name="DateTime">
"KRN",.84,7981999.001,2,214,0)
     <xsl:with-param name="dt" select="$HDR/DATE"/>
"KRN",.84,7981999.001,2,215,0)
    </xsl:call-template>
"KRN",.84,7981999.001,2,216,0)
   </td>
"KRN",.84,7981999.001,2,217,0)
  </tr>
"KRN",.84,7981999.001,2,218,0)
  <tr>
"KRN",.84,7981999.001,2,219,0)
   <th scope="row">Task&#160;Number:&#160;</th>
"KRN",.84,7981999.001,2,220,0)
   <td>
"KRN",.84,7981999.001,2,221,0)
    <xsl:call-template name="CellValue">
"KRN",.84,7981999.001,2,222,0)
     <xsl:with-param name="value" select="$HDR/TASK_NUMBER"/>
"KRN",.84,7981999.001,2,223,0)
    </xsl:call-template>
"KRN",.84,7981999.001,2,224,0)
   </td>
"KRN",.84,7981999.001,2,225,0)
  </tr>
"KRN",.84,7981999.001,2,226,0)
  <tr>
"KRN",.84,7981999.001,2,227,0)
   <th scope="row">Last&#160;Registry&#160;Update:&#160;</th>
"KRN",.84,7981999.001,2,228,0)
   <td>
"KRN",.84,7981999.001,2,229,0)
    <xsl:call-template name="DateTime">
"KRN",.84,7981999.001,2,230,0)
     <xsl:with-param name="dt" select="$HDR/UPDATED_UNTIL"/>
"KRN",.84,7981999.001,2,231,0)
    </xsl:call-template>
"KRN",.84,7981999.001,2,232,0)
   </td>
"KRN",.84,7981999.001,2,233,0)
  </tr>
"KRN",.84,7981999.001,2,234,0)
  <tr>
"KRN",.84,7981999.001,2,235,0)
   <th scope="row">Last&#160;Data&#160;Extraction:&#160;</th>
"KRN",.84,7981999.001,2,236,0)
   <td>
"KRN",.84,7981999.001,2,237,0)
    <xsl:call-template name="DateTime">
"KRN",.84,7981999.001,2,238,0)
     <xsl:with-param name="dt" select="$HDR/EXTRACTED_UNTIL"/>
"KRN",.84,7981999.001,2,239,0)
    </xsl:call-template>
"KRN",.84,7981999.001,2,240,0)
   </td>
"KRN",.84,7981999.001,2,241,0)
  </tr>
"KRN",.84,7981999.001,2,242,0)
</table>
"KRN",.84,7981999.001,2,243,0)
</xsl:template>
"KRN",.84,7981999.001,2,244,0)
 
"KRN",.84,7981999.001,2,245,0)
<!-- Default report summary -->
"KRN",.84,7981999.001,2,246,0)
 
"KRN",.84,7981999.001,2,247,0)
<xsl:template name="ReportSummary">
"KRN",.84,7981999.001,2,248,0)
<xsl:variable name="SUMMARY" select="/REPORT/SUMMARY"/>
"KRN",.84,7981999.001,2,249,0)
<xsl:if test="$SUMMARY/*[1]">
"KRN",.84,7981999.001,2,250,0)
  <div class="reportSummary">
"KRN",.84,7981999.001,2,251,0)
   <xsl:apply-templates select="$SUMMARY"/>
"KRN",.84,7981999.001,2,252,0)
  </div>
"KRN",.84,7981999.001,2,253,0)
</xsl:if>
"KRN",.84,7981999.001,2,254,0)
</xsl:template>
"KRN",.84,7981999.001,2,255,0)
 
"KRN",.84,7981999.001,2,256,0)
<!-- Indicator of an empty table -->
"KRN",.84,7981999.001,2,257,0)
 
"KRN",.84,7981999.001,2,258,0)
<xsl:template name="TableNoData">
"KRN",.84,7981999.001,2,259,0)
<table width="100%" cellpadding="5" cellspacing="0">
"KRN",.84,7981999.001,2,260,0)
   <tr><td>No data has been found.</td></tr>
"KRN",.84,7981999.001,2,261,0)
</table>
"KRN",.84,7981999.001,2,262,0)
</xsl:template>
"KRN",.84,7981999.001,2,263,0)
 
"KRN",.84,7981999.001,2,264,0)
<!--
"KRN",.84,7981999.001,2,265,0)
=========================================================================
"KRN",.84,7981999.001,2,266,0)
                              REPORT HEADER
"KRN",.84,7981999.001,2,267,0)
=========================================================================
"KRN",.84,7981999.001,2,268,0)
-->
"KRN",.84,7981999.001,2,269,0)
 
"KRN",.84,7981999.001,2,270,0)
<xsl:template name="ReportHeader">
"KRN",.84,7981999.001,2,271,0)
<xsl:variable name="mvplist" select="/REPORT/PARAMETERS/*[*[1]]"/>
"KRN",.84,7981999.001,2,272,0)
<xsl:variable name="notecnt" 
"KRN",.84,7981999.001,2,273,0)
select="count(/REPORT/HEADER/NOTES/AGE_BASE_DATE)"/>
"KRN",.84,7981999.001,2,274,0)
<div class="reportHeader">
"KRN",.84,7981999.001,2,275,0)
  <table width="100%" cellpadding="0" cellspacing="0">
"KRN",.84,7981999.001,2,276,0)
   <tr>
"KRN",.84,7981999.001,2,277,0)
    <td style="text-align:left">
"KRN",.84,7981999.001,2,278,0)
     <table cellpadding="0" cellspacing="0">
"KRN",.84,7981999.001,2,279,0)
      <xsl:apply-templates select="/REPORT/PARAMETERS/*[not(*[1])]"/>
"KRN",.84,7981999.001,2,280,0)
     </table>
"KRN",.84,7981999.001,2,281,0)
    </td>
"KRN",.84,7981999.001,2,282,0)
    <td style="text-align:right; padding-left:3%; width:10%">
"KRN",.84,7981999.001,2,283,0)
     <xsl:call-template name="ReportInfo"/>
"KRN",.84,7981999.001,2,284,0)
    </td>
"KRN",.84,7981999.001,2,285,0)
  </tr>
"KRN",.84,7981999.001,2,286,0)
  </table>
"KRN",.84,7981999.001,2,287,0)
  <xsl:if test="$mvplist[1]">
"KRN",.84,7981999.001,2,288,0)
   <table style="width:100%; margin-top:1%" cellpadding="0" 
"KRN",.84,7981999.001,2,289,0)
cellspacing="0">
"KRN",.84,7981999.001,2,290,0)
    <xsl:apply-templates select="$mvplist"/>
"KRN",.84,7981999.001,2,291,0)
   </table>
"KRN",.84,7981999.001,2,292,0)
  </xsl:if>
"KRN",.84,7981999.001,2,293,0)
  <xsl:if test="/REPORT//PATIENT[1]">
"KRN",.84,7981999.001,2,294,0)
   <xsl:variable name="explain" 
"KRN",.84,7981999.001,2,295,0)
select="count(/REPORT/HEADER/TBLDEF//COLUMN[@NAME='AGE']) &gt; 0"/>
"KRN",.84,7981999.001,2,296,0)
   <xsl:if test="$explain and $notecnt=0">
"KRN",.84,7981999.001,2,297,0)
     <xsl:variable name="rptdate" 
"KRN",.84,7981999.001,2,298,0)
select="substring-before(concat(/REPORT/HEADER/DATE,'.'),'.')"/>
"KRN",.84,7981999.001,2,299,0)
     <br/>
"KRN",.84,7981999.001,2,300,0)
     <b>Note:&#160; </b>Age of patients is calculated as of the date when 
"KRN",.84,7981999.001,2,301,0)
the report is run 
"KRN",.84,7981999.001,2,302,0)
     (<xsl:call-template name="DateTime">
"KRN",.84,7981999.001,2,303,0)
       <xsl:with-param name="dt" select="$rptdate"/>
"KRN",.84,7981999.001,2,304,0)
     </xsl:call-template>). If a patient died then the age is calculated 
"KRN",.84,7981999.001,2,305,0)
as of date of death.
"KRN",.84,7981999.001,2,306,0)
   </xsl:if>
"KRN",.84,7981999.001,2,307,0)
   <div style="margin:10; color: red; font-weight: bold">
"KRN",.84,7981999.001,2,308,0)
    This report contains confidential patient information and must be
"KRN",.84,7981999.001,2,309,0)
    handled in accordance with established policies.
"KRN",.84,7981999.001,2,310,0)
   </div>
"KRN",.84,7981999.001,2,311,0)
  </xsl:if>
"KRN",.84,7981999.001,2,312,0)
  <xsl:if test="$notecnt>0">
"KRN",.84,7981999.001,2,313,0)
   <dl style="text-align:left">
"KRN",.84,7981999.001,2,314,0)
    <xsl:choose>
"KRN",.84,7981999.001,2,315,0)
     <xsl:when test="$notecnt>1">
"KRN",.84,7981999.001,2,316,0)
      <xsl:for-each select="/REPORT/HEADER/NOTES/*">
"KRN",.84,7981999.001,2,317,0)
       <dt>Note #<xsl:value-of select="position()"/>:</dt>
"KRN",.84,7981999.001,2,318,0)
       <dd><xsl:apply-templates select="."/></dd>
"KRN",.84,7981999.001,2,319,0)
      </xsl:for-each>
"KRN",.84,7981999.001,2,320,0)
     </xsl:when>
"KRN",.84,7981999.001,2,321,0)
     <xsl:otherwise>
"KRN",.84,7981999.001,2,322,0)
      <dt>Note:</dt>
"KRN",.84,7981999.001,2,323,0)
      <dd><xsl:apply-templates select="/REPORT/HEADER/NOTES/*"/></dd>
"KRN",.84,7981999.001,2,324,0)
     </xsl:otherwise>
"KRN",.84,7981999.001,2,325,0)
    </xsl:choose>
"KRN",.84,7981999.001,2,326,0)
   </dl>
"KRN",.84,7981999.001,2,327,0)
  </xsl:if>
"KRN",.84,7981999.001,2,328,0)
</div>
"KRN",.84,7981999.001,2,329,0)
</xsl:template>
"KRN",.84,7981999.001,2,330,0)
 
"KRN",.84,7981999.001,2,331,0)
<xsl:template match="HEADER/NOTES/AGE">
"KRN",.84,7981999.001,2,332,0)
Age of patients is calculated as of the date when the report is run
"KRN",.84,7981999.001,2,333,0)
(<xsl:call-template name="DateTime"/>). If a patient died then the
"KRN",.84,7981999.001,2,334,0)
age is calculated as of date of death.
"KRN",.84,7981999.001,2,335,0)
</xsl:template>
"KRN",.84,7981999.001,2,336,0)
 
"KRN",.84,7981999.001,2,337,0)
<xsl:template match="HEADER/NOTES/AGE_BASE_DATE">
"KRN",.84,7981999.001,2,338,0)
Age of patients is calculated as of <xsl:call-template name="DateTime"/>,
"KRN",.84,7981999.001,2,339,0)
which is the middle of the report date range. If a patient was born after
"KRN",.84,7981999.001,2,340,0)
this date then the field will be empty. If a patient died before this
"KRN",.84,7981999.001,2,341,0)
date then the age is calculated as of date of death.
"KRN",.84,7981999.001,2,342,0)
</xsl:template>
"KRN",.84,7981999.001,2,343,0)
 
"KRN",.84,7981999.001,2,344,0)
<xsl:template match="PARAMETERS/CLINICS">
"KRN",.84,7981999.001,2,345,0)
<xsl:call-template name="ParamsList">
"KRN",.84,7981999.001,2,346,0)
  <xsl:with-param name="heading" select="'Clinics'"/>
"KRN",.84,7981999.001,2,347,0)
</xsl:call-template>
"KRN",.84,7981999.001,2,348,0)
</xsl:template>
"KRN",.84,7981999.001,2,349,0)
 
"KRN",.84,7981999.001,2,350,0)
<xsl:template match="PARAMETERS/CPTLST">
"KRN",.84,7981999.001,2,351,0)
<xsl:call-template name="ParamsList">
"KRN",.84,7981999.001,2,352,0)
  <xsl:with-param name="heading" select="'CPT'"/>
"KRN",.84,7981999.001,2,353,0)
</xsl:call-template>
"KRN",.84,7981999.001,2,354,0)
</xsl:template>
"KRN",.84,7981999.001,2,355,0)
 
"KRN",.84,7981999.001,2,356,0)
<xsl:template name="DateRange" match="PARAMETERS/DATE_RANGE">
"KRN",.84,7981999.001,2,357,0)
<xsl:param name="dtr" select="."/>
"KRN",.84,7981999.001,2,358,0)
<xsl:param name="title" select="''"/>
"KRN",.84,7981999.001,2,359,0)
<xsl:if test="($dtr/@START!='') and ($dtr/@END!='')">
"KRN",.84,7981999.001,2,360,0)
  <tr>
"KRN",.84,7981999.001,2,361,0)
   <th scope="row">
"KRN",.84,7981999.001,2,362,0)
    <xsl:if test="$title!=''">
"KRN",.84,7981999.001,2,363,0)
     <xsl:value-of select="concat($title,'&#160;')"/>
"KRN",.84,7981999.001,2,364,0)
    </xsl:if>
"KRN",.84,7981999.001,2,365,0)
    <xsl:text>Date&#160;Range:&#160;</xsl:text>
"KRN",.84,7981999.001,2,366,0)
   </th>
"KRN",.84,7981999.001,2,367,0)
   <td style="vertical-align:text-bottom">
"KRN",.84,7981999.001,2,368,0)
    <xsl:call-template name="DateTime">
"KRN",.84,7981999.001,2,369,0)
     <xsl:with-param name="dt" select="$dtr/@START"/>
"KRN",.84,7981999.001,2,370,0)
    </xsl:call-template>
"KRN",.84,7981999.001,2,371,0)
    <xsl:text>&#160;-&#160;</xsl:text>
"KRN",.84,7981999.001,2,372,0)
    <xsl:call-template name="DateTime">
"KRN",.84,7981999.001,2,373,0)
     <xsl:with-param name="dt" select="$dtr/@END"/>  
"KRN",.84,7981999.001,2,374,0)
    </xsl:call-template>
"KRN",.84,7981999.001,2,375,0)
   </td>
"KRN",.84,7981999.001,2,376,0)
  </tr>
"KRN",.84,7981999.001,2,377,0)
</xsl:if>
"KRN",.84,7981999.001,2,378,0)
</xsl:template>
"KRN",.84,7981999.001,2,379,0)
 
"KRN",.84,7981999.001,2,380,0)
<!-- 
"KRN",.84,7981999.001,2,381,0)
<xsl:template name="DateRange" match="PARAMETERS/DATE_RANGE">
"KRN",.84,7981999.001,2,382,0)
<xsl:param name="dtr" select="."/>
"KRN",.84,7981999.001,2,383,0)
<xsl:param name="title" select="''"/>
"KRN",.84,7981999.001,2,384,0)
<xsl:if test="$dtr/@START!=''">
"KRN",.84,7981999.001,2,385,0)
  <tr>
"KRN",.84,7981999.001,2,386,0)
   <th scope="row"><xsl:value-of select="$title"/> 
"KRN",.84,7981999.001,2,387,0)
Start&#160;Date:&#160;</th>
"KRN",.84,7981999.001,2,388,0)
   <td style="vertical-align:text-bottom">
"KRN",.84,7981999.001,2,389,0)
    <xsl:call-template name="DateTime">
"KRN",.84,7981999.001,2,390,0)
     <xsl:with-param name="dt" select="$dtr/@START"/>
"KRN",.84,7981999.001,2,391,0)
    </xsl:call-template>
"KRN",.84,7981999.001,2,392,0)
   </td>
"KRN",.84,7981999.001,2,393,0)
  </tr>
"KRN",.84,7981999.001,2,394,0)
</xsl:if>
"KRN",.84,7981999.001,2,395,0)
<xsl:if test="$dtr/@END!=''">
"KRN",.84,7981999.001,2,396,0)
  <tr>
"KRN",.84,7981999.001,2,397,0)
   <th scope="row"><xsl:value-of select="$title"/> 
"KRN",.84,7981999.001,2,398,0)
End&#160;Date:&#160;</th>
"KRN",.84,7981999.001,2,399,0)
   <td style="vertical-align:text-bottom">
"KRN",.84,7981999.001,2,400,0)
    <xsl:call-template name="DateTime">
"KRN",.84,7981999.001,2,401,0)
     <xsl:with-param name="dt" select="$dtr/@END"/>
"KRN",.84,7981999.001,2,402,0)
    </xsl:call-template>
"KRN",.84,7981999.001,2,403,0)
   </td>
"KRN",.84,7981999.001,2,404,0)
  </tr>
"KRN",.84,7981999.001,2,405,0)
</xsl:if>
"KRN",.84,7981999.001,2,406,0)
</xsl:template>
"KRN",.84,7981999.001,2,407,0)
-->
"KRN",.84,7981999.001,2,408,0)
 
"KRN",.84,7981999.001,2,409,0)
<xsl:template match="PARAMETERS/DIVISIONS">
"KRN",.84,7981999.001,2,410,0)
<xsl:call-template name="ParamsList">
"KRN",.84,7981999.001,2,411,0)
  <xsl:with-param name="heading" select="'Divisions'"/>
"KRN",.84,7981999.001,2,412,0)
</xsl:call-template>
"KRN",.84,7981999.001,2,413,0)
</xsl:template>
"KRN",.84,7981999.001,2,414,0)
 
"KRN",.84,7981999.001,2,415,0)
<xsl:template match="PARAMETERS/ICDLST">
"KRN",.84,7981999.001,2,416,0)
<tr>
"KRN",.84,7981999.001,2,417,0)
  <th scope="row">ICD:&#160;</th>
"KRN",.84,7981999.001,2,418,0)
  <td>
"KRN",.84,7981999.001,2,419,0)
   <dl>
"KRN",.84,7981999.001,2,420,0)
    <xsl:if test="@DESCR!=''">
"KRN",.84,7981999.001,2,421,0)
     <dt><xsl:value-of select="@DESCR"/></dt>
"KRN",.84,7981999.001,2,422,0)
    </xsl:if>
"KRN",.84,7981999.001,2,423,0)
    <xsl:if test=".='ALL'"><dt>ALL</dt></xsl:if>
"KRN",.84,7981999.001,2,424,0)
    <xsl:apply-templates select="GROUP"/>
"KRN",.84,7981999.001,2,425,0)
   </dl>
"KRN",.84,7981999.001,2,426,0)
  </td>
"KRN",.84,7981999.001,2,427,0)
</tr>
"KRN",.84,7981999.001,2,428,0)
</xsl:template>
"KRN",.84,7981999.001,2,429,0)
 
"KRN",.84,7981999.001,2,430,0)
<xsl:template match="PARAMETERS/ICDLST/GROUP">
"KRN",.84,7981999.001,2,431,0)
<dt><b><xsl:value-of select="@NAME"/></b></dt>
"KRN",.84,7981999.001,2,432,0)
<dd><dl>
"KRN",.84,7981999.001,2,433,0)
  <xsl:if test="@DESCR!=''">
"KRN",.84,7981999.001,2,434,0)
   <dt><xsl:value-of select="@DESCR"/></dt>
"KRN",.84,7981999.001,2,435,0)
  </xsl:if>
"KRN",.84,7981999.001,2,436,0)
   <table><tr><td width="80px">
"KRN",.84,7981999.001,2,437,0)
    <xsl:for-each select="ICD9">
"KRN",.84,7981999.001,2,438,0)
     <xsl:sort select="."/>
"KRN",.84,7981999.001,2,439,0)
     <xsl:if test="position()=1"><xsl:text>(ICD-9) </xsl:text></xsl:if>
"KRN",.84,7981999.001,2,440,0)
    </xsl:for-each>
"KRN",.84,7981999.001,2,441,0)
   </td>
"KRN",.84,7981999.001,2,442,0)
   <td>
"KRN",.84,7981999.001,2,443,0)
    <xsl:for-each select="ICD9">
"KRN",.84,7981999.001,2,444,0)
     <xsl:sort select="."/>
"KRN",.84,7981999.001,2,445,0)
     <xsl:if test="position()>1"><xsl:text>; </xsl:text></xsl:if>
"KRN",.84,7981999.001,2,446,0)
     <xsl:value-of select="."/>
"KRN",.84,7981999.001,2,447,0)
    </xsl:for-each>
"KRN",.84,7981999.001,2,448,0)
   </td></tr></table>
"KRN",.84,7981999.001,2,449,0)
   <table><tr><td width="80px">
"KRN",.84,7981999.001,2,450,0)
    <xsl:for-each select="ICD10">
"KRN",.84,7981999.001,2,451,0)
     <xsl:sort select="."/>
"KRN",.84,7981999.001,2,452,0)
     <xsl:if test="position()=1"><xsl:text>(ICD-10) </xsl:text></xsl:if>
"KRN",.84,7981999.001,2,453,0)
    </xsl:for-each>
"KRN",.84,7981999.001,2,454,0)
   </td>
"KRN",.84,7981999.001,2,455,0)
   <td>
"KRN",.84,7981999.001,2,456,0)
    <xsl:for-each select="ICD10">
"KRN",.84,7981999.001,2,457,0)
     <xsl:sort select="."/>
"KRN",.84,7981999.001,2,458,0)
     <xsl:if test="position()>1"><xsl:text>; </xsl:text></xsl:if>
"KRN",.84,7981999.001,2,459,0)
     <xsl:value-of select="."/>
"KRN",.84,7981999.001,2,460,0)
    </xsl:for-each>
"KRN",.84,7981999.001,2,461,0)
   </td></tr></table>
"KRN",.84,7981999.001,2,462,0)
</dl></dd>
"KRN",.84,7981999.001,2,463,0)
</xsl:template>
"KRN",.84,7981999.001,2,464,0)
 
"KRN",.84,7981999.001,2,465,0)
<xsl:template match="PARAMETERS/ICDFILT">
"KRN",.84,7981999.001,2,466,0)
<tr>
"KRN",.84,7981999.001,2,467,0)
  <th scope="row">Other Diagnoses:&#160;</th>
"KRN",.84,7981999.001,2,468,0)
  <td>
"KRN",.84,7981999.001,2,469,0)
   <dl>
"KRN",.84,7981999.001,2,470,0)
    <xsl:if test="@FILTER!=''">
"KRN",.84,7981999.001,2,471,0)
      <xsl:choose>
"KRN",.84,7981999.001,2,472,0)
        <xsl:when test="@FILTER='EXCLUDE'">
"KRN",.84,7981999.001,2,473,0)
          <dt><xsl:text>Exclude</xsl:text></dt>
"KRN",.84,7981999.001,2,474,0)
          <xsl:apply-templates select="GROUP"/>
"KRN",.84,7981999.001,2,475,0)
        </xsl:when>
"KRN",.84,7981999.001,2,476,0)
        <xsl:when test="@FILTER='INCLUDE'">
"KRN",.84,7981999.001,2,477,0)
          <dt><xsl:text>Include</xsl:text></dt>
"KRN",.84,7981999.001,2,478,0)
          <xsl:apply-templates select="GROUP"/>
"KRN",.84,7981999.001,2,479,0)
        </xsl:when>
"KRN",.84,7981999.001,2,480,0)
        <xsl:otherwise>
"KRN",.84,7981999.001,2,481,0)
          <dt><xsl:text>All</xsl:text></dt>
"KRN",.84,7981999.001,2,482,0)
        </xsl:otherwise>
"KRN",.84,7981999.001,2,483,0)
      </xsl:choose>
"KRN",.84,7981999.001,2,484,0)
    </xsl:if>
"KRN",.84,7981999.001,2,485,0)
   </dl>
"KRN",.84,7981999.001,2,486,0)
  </td>
"KRN",.84,7981999.001,2,487,0)
</tr>
"KRN",.84,7981999.001,2,488,0)
</xsl:template>
"KRN",.84,7981999.001,2,489,0)
 
"KRN",.84,7981999.001,2,490,0)
<xsl:template match="PARAMETERS/ICDFILT/GROUP">
"KRN",.84,7981999.001,2,491,0)
<dt><b><xsl:value-of select="@ID"/></b></dt>
"KRN",.84,7981999.001,2,492,0)
<dd><dl>
"KRN",.84,7981999.001,2,493,0)
   <table><tr><td width="80px">
"KRN",.84,7981999.001,2,494,0)
    <xsl:for-each select="ICD9">
"KRN",.84,7981999.001,2,495,0)
     <xsl:sort select="@ID"/>
"KRN",.84,7981999.001,2,496,0)
     <xsl:if test="position()=1"><xsl:text>(ICD-9) </xsl:text></xsl:if>
"KRN",.84,7981999.001,2,497,0)
    </xsl:for-each>
"KRN",.84,7981999.001,2,498,0)
   </td>
"KRN",.84,7981999.001,2,499,0)
   <td>
"KRN",.84,7981999.001,2,500,0)
    <xsl:for-each select="ICD9">
"KRN",.84,7981999.001,2,501,0)
     <xsl:sort select="@ID"/>
"KRN",.84,7981999.001,2,502,0)
     <xsl:if test="position()>1"><xsl:text>; </xsl:text></xsl:if>
"KRN",.84,7981999.001,2,503,0)
     <xsl:value-of select="@ID"/>
"KRN",.84,7981999.001,2,504,0)
    </xsl:for-each>
"KRN",.84,7981999.001,2,505,0)
   </td></tr></table>
"KRN",.84,7981999.001,2,506,0)
   <table><tr><td width="80px">
"KRN",.84,7981999.001,2,507,0)
    <xsl:for-each select="ICD10">
"KRN",.84,7981999.001,2,508,0)
     <xsl:sort select="@ID"/>
"KRN",.84,7981999.001,2,509,0)
     <xsl:if test="position()=1"><xsl:text>(ICD-10) </xsl:text></xsl:if>
"KRN",.84,7981999.001,2,510,0)
    </xsl:for-each>
"KRN",.84,7981999.001,2,511,0)
   </td>
"KRN",.84,7981999.001,2,512,0)
   <td>
"KRN",.84,7981999.001,2,513,0)
    <xsl:for-each select="ICD10">
"KRN",.84,7981999.001,2,514,0)
     <xsl:sort select="@ID"/>
"KRN",.84,7981999.001,2,515,0)
     <xsl:if test="position()>1"><xsl:text>; </xsl:text></xsl:if>
"KRN",.84,7981999.001,2,516,0)
     <xsl:value-of select="@ID"/>
"KRN",.84,7981999.001,2,517,0)
    </xsl:for-each>
"KRN",.84,7981999.001,2,518,0)
   </td></tr></table> 
"KRN",.84,7981999.001,2,519,0)
 </dl></dd>
"KRN",.84,7981999.001,2,520,0)
</xsl:template> 
"KRN",.84,7981999.001,2,521,0)
 
"KRN",.84,7981999.001,2,522,0)
<xsl:template match="PARAMETERS/LOCAL_FIELDS">
"KRN",.84,7981999.001,2,523,0)
<xsl:variable name="pseudo" select="/REPORT/PARAMETERS/HIV_DX" />
"KRN",.84,7981999.001,2,524,0)
<xsl:call-template name="LocalList">
"KRN",.84,7981999.001,2,525,0)
  <xsl:with-param name="firstitem" select="$pseudo"/>
"KRN",.84,7981999.001,2,526,0)
</xsl:call-template>
"KRN",.84,7981999.001,2,527,0)
</xsl:template>
"KRN",.84,7981999.001,2,528,0)
 
"KRN",.84,7981999.001,2,529,0)
<!-- Process the pseudo local field -->
"KRN",.84,7981999.001,2,530,0)
<xsl:template match="PARAMETERS/HIV_DX">
"KRN",.84,7981999.001,2,531,0)
<xsl:if test="count(/REPORT/PARAMETERS/LOCAL_FIELDS/*) &lt; 1">
"KRN",.84,7981999.001,2,532,0)
  <tr>
"KRN",.84,7981999.001,2,533,0)
   <th scope="row">
"KRN",.84,7981999.001,2,534,0)
    <xsl:text>Local Fields:&#160;</xsl:text>
"KRN",.84,7981999.001,2,535,0)
   </th>
"KRN",.84,7981999.001,2,536,0)
   <td>
"KRN",.84,7981999.001,2,537,0)
    <xsl:text>Diagnosed at this VA (</xsl:text>
"KRN",.84,7981999.001,2,538,0)
    <xsl:value-of select="."/>
"KRN",.84,7981999.001,2,539,0)
    <xsl:text>)</xsl:text>
"KRN",.84,7981999.001,2,540,0)
   </td>
"KRN",.84,7981999.001,2,541,0)
  </tr>
"KRN",.84,7981999.001,2,542,0)
</xsl:if>
"KRN",.84,7981999.001,2,543,0)
</xsl:template> 
"KRN",.84,7981999.001,2,544,0)
 
"KRN",.84,7981999.001,2,545,0)
<xsl:template match="PARAMETERS/OPTIONS">
"KRN",.84,7981999.001,2,546,0)
<xsl:choose>
"KRN",.84,7981999.001,2,547,0)
   <xsl:when test="@DAA_DRUGS">
"KRN",.84,7981999.001,2,548,0)
    <tr>
"KRN",.84,7981999.001,2,549,0)
     <th scope="row">DAA Prescriptions:&#160;</th>
"KRN",.84,7981999.001,2,550,0)
     <td>
"KRN",.84,7981999.001,2,551,0)
      <xsl:if test="@DAA_DRUGS='A'"><xsl:text>All 
"KRN",.84,7981999.001,2,552,0)
prescriptions</xsl:text></xsl:if>
"KRN",.84,7981999.001,2,553,0)
      <xsl:if test="@DAA_DRUGS='I'"><xsl:text>In-house 
"KRN",.84,7981999.001,2,554,0)
only</xsl:text></xsl:if>
"KRN",.84,7981999.001,2,555,0)
      <xsl:if test="@DAA_DRUGS='C'"><xsl:text>Choice 
"KRN",.84,7981999.001,2,556,0)
only</xsl:text></xsl:if>
"KRN",.84,7981999.001,2,557,0)
     </td>
"KRN",.84,7981999.001,2,558,0)
    </tr>
"KRN",.84,7981999.001,2,559,0)
   </xsl:when>
"KRN",.84,7981999.001,2,560,0)
   <xsl:otherwise>
"KRN",.84,7981999.001,2,561,0)
    <tr>
"KRN",.84,7981999.001,2,562,0)
      <th scope="row">Options:&#160;</th>
"KRN",.84,7981999.001,2,563,0)
      <td>
"KRN",.84,7981999.001,2,564,0)
        <xsl:if test="@COMPLETE='1' or @SUMMARY='1'">
"KRN",.84,7981999.001,2,565,0)
          <xsl:value-of select="."/>
"KRN",.84,7981999.001,2,566,0)
        </xsl:if> 
"KRN",.84,7981999.001,2,567,0)
        <xsl:if test="(@RECENT_FILLS='1' or @ALL_FILLS='1') and 
"KRN",.84,7981999.001,2,568,0)
(@COMPLETE='1' or @SUMMARY='1')">
"KRN",.84,7981999.001,2,569,0)
          <xsl:text>, </xsl:text>
"KRN",.84,7981999.001,2,570,0)
        </xsl:if>
"KRN",.84,7981999.001,2,571,0)
        <xsl:if test="@ALL_FILLS='1'"><xsl:text>All 
"KRN",.84,7981999.001,2,572,0)
fills</xsl:text></xsl:if>
"KRN",.84,7981999.001,2,573,0)
        <xsl:if test="@RECENT_FILLS='1'"><xsl:text>Most recent fill in 
"KRN",.84,7981999.001,2,574,0)
time period</xsl:text></xsl:if>
"KRN",.84,7981999.001,2,575,0)
      </td>
"KRN",.84,7981999.001,2,576,0)
    </tr>  
"KRN",.84,7981999.001,2,577,0)
    <xsl:if test="@MOST_RECENT='1'">
"KRN",.84,7981999.001,2,578,0)
     <tr>
"KRN",.84,7981999.001,2,579,0)
      <th scope="row">Lab Test Date:&#160;</th>
"KRN",.84,7981999.001,2,580,0)
      <td><xsl:text>Most Recent</xsl:text></td>
"KRN",.84,7981999.001,2,581,0)
     </tr>
"KRN",.84,7981999.001,2,582,0)
    </xsl:if>
"KRN",.84,7981999.001,2,583,0)
    <xsl:if test="@MAX_DATE='1'">
"KRN",.84,7981999.001,2,584,0)
     <tr>
"KRN",.84,7981999.001,2,585,0)
      <th scope="row">Lab Test Date:&#160;</th>
"KRN",.84,7981999.001,2,586,0)
      <td>
"KRN",.84,7981999.001,2,587,0)
       <xsl:text>As of </xsl:text>
"KRN",.84,7981999.001,2,588,0)
       <xsl:call-template name="DateTime">
"KRN",.84,7981999.001,2,589,0)
        <xsl:with-param name="dt" select="../MAX_DATE"/>
"KRN",.84,7981999.001,2,590,0)
       </xsl:call-template>
"KRN",.84,7981999.001,2,591,0)
      </td>
"KRN",.84,7981999.001,2,592,0)
     </tr>
"KRN",.84,7981999.001,2,593,0)
    </xsl:if>
"KRN",.84,7981999.001,2,594,0)
   </xsl:otherwise>
"KRN",.84,7981999.001,2,595,0)
</xsl:choose>
"KRN",.84,7981999.001,2,596,0)
</xsl:template>
"KRN",.84,7981999.001,2,597,0)
 
"KRN",.84,7981999.001,2,598,0)
<xsl:template match="PARAMETERS/OTHER_REGISTRIES">
"KRN",.84,7981999.001,2,599,0)
<xsl:call-template name="ParamsList">
"KRN",.84,7981999.001,2,600,0)
  <xsl:with-param name="heading" select="'Other Registries'"/>
"KRN",.84,7981999.001,2,601,0)
</xsl:call-template>
"KRN",.84,7981999.001,2,602,0)
</xsl:template>
"KRN",.84,7981999.001,2,603,0)
 
"KRN",.84,7981999.001,2,604,0)
<xsl:template match="PARAMETERS/PATIENTS">
"KRN",.84,7981999.001,2,605,0)
<tr>
"KRN",.84,7981999.001,2,606,0)
  <th scope="row">Patients:&#160;</th>
"KRN",.84,7981999.001,2,607,0)
  <td>
"KRN",.84,7981999.001,2,608,0)
    <xsl:value-of select="."/>
"KRN",.84,7981999.001,2,609,0)
    <xsl:if test="@CONFDT_AFTER!=''">
"KRN",.84,7981999.001,2,610,0)
      <xsl:text>&#160;</xsl:text>
"KRN",.84,7981999.001,2,611,0)
      <xsl:call-template name="DateTime">
"KRN",.84,7981999.001,2,612,0)
       <xsl:with-param name="dt" select="@CONFDT_AFTER"/>
"KRN",.84,7981999.001,2,613,0)
      </xsl:call-template>
"KRN",.84,7981999.001,2,614,0)
    </xsl:if>
"KRN",.84,7981999.001,2,615,0)
  </td>
"KRN",.84,7981999.001,2,616,0)
</tr>
"KRN",.84,7981999.001,2,617,0)
<xsl:if test="@OEF!=''">
"KRN",.84,7981999.001,2,618,0)
  <tr>
"KRN",.84,7981999.001,2,619,0)
   <th scope="row">OEF/OIF:&#160;</th>
"KRN",.84,7981999.001,2,620,0)
   <td>
"KRN",.84,7981999.001,2,621,0)
    <xsl:if test="@OEF='1'">
"KRN",.84,7981999.001,2,622,0)
      <xsl:text>Include only</xsl:text>
"KRN",.84,7981999.001,2,623,0)
    </xsl:if>
"KRN",.84,7981999.001,2,624,0)
    <xsl:if test="@OEF='-1'">
"KRN",.84,7981999.001,2,625,0)
      <xsl:text>Exclude</xsl:text>
"KRN",.84,7981999.001,2,626,0)
    </xsl:if>
"KRN",.84,7981999.001,2,627,0)
   </td>
"KRN",.84,7981999.001,2,628,0)
  </tr>
"KRN",.84,7981999.001,2,629,0)
</xsl:if>
"KRN",.84,7981999.001,2,630,0)
<tr>
"KRN",.84,7981999.001,2,631,0)
  <th scope="row">Birth Sex:&#160;</th>
"KRN",.84,7981999.001,2,632,0)
  <td>
"KRN",.84,7981999.001,2,633,0)
    <xsl:choose>
"KRN",.84,7981999.001,2,634,0)
     <xsl:when test="@SEX or @BIRTHSEX">
"KRN",.84,7981999.001,2,635,0)
      <xsl:if test="@SEX='F' or @BIRTHSEX='F'">
"KRN",.84,7981999.001,2,636,0)
       <xsl:text>Female only</xsl:text>
"KRN",.84,7981999.001,2,637,0)
      </xsl:if>
"KRN",.84,7981999.001,2,638,0)
      <xsl:if test="@SEX='M' or @BIRTHSEX='M'">
"KRN",.84,7981999.001,2,639,0)
       <xsl:text>Male only</xsl:text>
"KRN",.84,7981999.001,2,640,0)
      </xsl:if>
"KRN",.84,7981999.001,2,641,0)
     </xsl:when>
"KRN",.84,7981999.001,2,642,0)
     <xsl:otherwise>
"KRN",.84,7981999.001,2,643,0)
      <xsl:text>Both</xsl:text>
"KRN",.84,7981999.001,2,644,0)
     </xsl:otherwise>
"KRN",.84,7981999.001,2,645,0)
    </xsl:choose>
"KRN",.84,7981999.001,2,646,0)
  </td>
"KRN",.84,7981999.001,2,647,0)
</tr>
"KRN",.84,7981999.001,2,648,0)
<tr>
"KRN",.84,7981999.001,2,649,0)
  <th scope="row">Age Range:&#160;</th>
"KRN",.84,7981999.001,2,650,0)
  <td>
"KRN",.84,7981999.001,2,651,0)
    <xsl:choose>
"KRN",.84,7981999.001,2,652,0)
     <xsl:when test="../AGE_RANGE/@TYPE">
"KRN",.84,7981999.001,2,653,0)
      <xsl:if test="../AGE_RANGE/@TYPE='DOB'">
"KRN",.84,7981999.001,2,654,0)
        <xsl:text>Date of birth&#160;</xsl:text>
"KRN",.84,7981999.001,2,655,0)
        <xsl:call-template name="DateTime">
"KRN",.84,7981999.001,2,656,0)
          <xsl:with-param name="dt" select="../AGE_RANGE/@START"/>
"KRN",.84,7981999.001,2,657,0)
        </xsl:call-template>
"KRN",.84,7981999.001,2,658,0)
        <xsl:text>&#160;-&#160;</xsl:text>
"KRN",.84,7981999.001,2,659,0)
        <xsl:call-template name="DateTime">
"KRN",.84,7981999.001,2,660,0)
          <xsl:with-param name="dt" select="../AGE_RANGE/@END"/>  
"KRN",.84,7981999.001,2,661,0)
        </xsl:call-template>
"KRN",.84,7981999.001,2,662,0)
      </xsl:if>
"KRN",.84,7981999.001,2,663,0)
      <xsl:if test="../AGE_RANGE/@TYPE='AGE'">
"KRN",.84,7981999.001,2,664,0)
        <xsl:text>Age&#160;</xsl:text>
"KRN",.84,7981999.001,2,665,0)
        <xsl:value-of select="../AGE_RANGE/@START"/>
"KRN",.84,7981999.001,2,666,0)
        <xsl:text>&#160;-&#160;</xsl:text>
"KRN",.84,7981999.001,2,667,0)
        <xsl:value-of select="../AGE_RANGE/@END"/>
"KRN",.84,7981999.001,2,668,0)
      </xsl:if>
"KRN",.84,7981999.001,2,669,0)
     </xsl:when>
"KRN",.84,7981999.001,2,670,0)
     <xsl:otherwise>
"KRN",.84,7981999.001,2,671,0)
      <xsl:text>All</xsl:text>
"KRN",.84,7981999.001,2,672,0)
     </xsl:otherwise>
"KRN",.84,7981999.001,2,673,0)
    </xsl:choose>
"KRN",.84,7981999.001,2,674,0)
  </td>
"KRN",.84,7981999.001,2,675,0)
</tr>
"KRN",.84,7981999.001,2,676,0)
<xsl:if test="@SVR!=''">
"KRN",.84,7981999.001,2,677,0)
   <tr>
"KRN",.84,7981999.001,2,678,0)
    <th scope="row">SVR:&#160;</th>
"KRN",.84,7981999.001,2,679,0)
    <td>
"KRN",.84,7981999.001,2,680,0)
     <xsl:if test="@SVR='1'">
"KRN",.84,7981999.001,2,681,0)
       <xsl:text>SVR Only</xsl:text>
"KRN",.84,7981999.001,2,682,0)
     </xsl:if>
"KRN",.84,7981999.001,2,683,0)
     <xsl:if test="@SVR='0'">
"KRN",.84,7981999.001,2,684,0)
       <xsl:text>No SVR</xsl:text>
"KRN",.84,7981999.001,2,685,0)
     </xsl:if>
"KRN",.84,7981999.001,2,686,0)
     <xsl:if test="@SVR='-1'">
"KRN",.84,7981999.001,2,687,0)
       <xsl:text>All patients</xsl:text>
"KRN",.84,7981999.001,2,688,0)
     </xsl:if>
"KRN",.84,7981999.001,2,689,0)
    </td>
"KRN",.84,7981999.001,2,690,0)
   </tr>
"KRN",.84,7981999.001,2,691,0)
</xsl:if>
"KRN",.84,7981999.001,2,692,0)
</xsl:template>
"KRN",.84,7981999.001,2,693,0)
 
"KRN",.84,7981999.001,2,694,0)
<xsl:template match="PARAMETERS/REGNAME">
"KRN",.84,7981999.001,2,695,0)
<tr>
"KRN",.84,7981999.001,2,696,0)
  <th scope="row">Registry:&#160;</th>
"KRN",.84,7981999.001,2,697,0)
  <td><xsl:value-of select="."/></td>
"KRN",.84,7981999.001,2,698,0)
</tr>
"KRN",.84,7981999.001,2,699,0)
</xsl:template>
"KRN",.84,7981999.001,2,700,0)
 
"KRN",.84,7981999.001,2,701,0)
<xsl:template match="PARAMETERS/TASK_COMMENT">
"KRN",.84,7981999.001,2,702,0)
<tr>
"KRN",.84,7981999.001,2,703,0)
  <th scope="row">Comment:&#160;</th>
"KRN",.84,7981999.001,2,704,0)
  <td><xsl:value-of select="."/></td>
"KRN",.84,7981999.001,2,705,0)
</tr>
"KRN",.84,7981999.001,2,706,0)
</xsl:template>
"KRN",.84,7981999.001,2,707,0)
 
"KRN",.84,7981999.001,2,708,0)
<xsl:template match="PARAMETERS/UTIL_TYPES">
"KRN",.84,7981999.001,2,709,0)
<tr>
"KRN",.84,7981999.001,2,710,0)
  <th scope="row">Utilization:&#160;</th>
"KRN",.84,7981999.001,2,711,0)
  <td><xsl:value-of select="."/></td>
"KRN",.84,7981999.001,2,712,0)
</tr>
"KRN",.84,7981999.001,2,713,0)
</xsl:template>
"KRN",.84,7981999.001,2,714,0)
 
"KRN",.84,7981999.001,2,715,0)
<xsl:template match="PARAMETERS/LRGRANGES">
"KRN",.84,7981999.001,2,716,0)
<tr>
"KRN",.84,7981999.001,2,717,0)
  <th scope="row">Results:&#160;</th>
"KRN",.84,7981999.001,2,718,0)
  <td>
"KRN",.84,7981999.001,2,719,0)
   <xsl:for-each select="LRGRANGE">
"KRN",.84,7981999.001,2,720,0)
    <xsl:value-of select="."/><br/>
"KRN",.84,7981999.001,2,721,0)
   </xsl:for-each>
"KRN",.84,7981999.001,2,722,0)
  </td>
"KRN",.84,7981999.001,2,723,0)
</tr>
"KRN",.84,7981999.001,2,724,0)
</xsl:template>
"KRN",.84,7981999.001,2,725,0)
 
"KRN",.84,7981999.001,2,726,0)
<xsl:template match="PARAMETERS/DATE_RANGE_3">
"KRN",.84,7981999.001,2,727,0)
<xsl:call-template name="DateRange">
"KRN",.84,7981999.001,2,728,0)
  <xsl:with-param name="title" select="'Utilization'"/>
"KRN",.84,7981999.001,2,729,0)
</xsl:call-template>
"KRN",.84,7981999.001,2,730,0)
<xsl:if test="../TREATMENT_HISTORY">
"KRN",.84,7981999.001,2,731,0)
  <tr>
"KRN",.84,7981999.001,2,732,0)
   <th scope="row">Treatment History:&#160;</th>
"KRN",.84,7981999.001,2,733,0)
   <td>
"KRN",.84,7981999.001,2,734,0)
     <xsl:value-of select="../TREATMENT_HISTORY"/>
"KRN",.84,7981999.001,2,735,0)
   </td>
"KRN",.84,7981999.001,2,736,0)
  </tr>
"KRN",.84,7981999.001,2,737,0)
</xsl:if>
"KRN",.84,7981999.001,2,738,0)
</xsl:template>
"KRN",.84,7981999.001,2,739,0)
 
"KRN",.84,7981999.001,2,740,0)
  <xsl:template match="PARAMETERS/DATE_RANGE_5">
"KRN",.84,7981999.001,2,741,0)
   <xsl:call-template name="DateRange">
"KRN",.84,7981999.001,2,742,0)
    <xsl:with-param name="title" select="'Diagnosis'"/>
"KRN",.84,7981999.001,2,743,0)
   </xsl:call-template>
"KRN",.84,7981999.001,2,744,0)
  </xsl:template>
"KRN",.84,7981999.001,2,745,0)
 
"KRN",.84,7981999.001,2,746,0)
<!--
"KRN",.84,7981999.001,2,747,0)
=========================================================================
"KRN",.84,7981999.001,2,748,0)
                       DEFAULT DATA GRID TEMPLATES
"KRN",.84,7981999.001,2,749,0)
=========================================================================
"KRN",.84,7981999.001,2,750,0)
-->
"KRN",.84,7981999.001,2,751,0)
 
"KRN",.84,7981999.001,2,752,0)
<xsl:template name="DataGrid" match="*[@TABLE!='']">
"KRN",.84,7981999.001,2,753,0)
<xsl:param name="divstyle" select="''"/>
"KRN",.84,7981999.001,2,754,0)
<xsl:param name="scroll" select="*[31]"/>
"KRN",.84,7981999.001,2,755,0)
<xsl:variable name="tbldef" select="key('TableDefs',@TABLE)"/>
"KRN",.84,7981999.001,2,756,0)
<xsl:choose>
"KRN",.84,7981999.001,2,757,0)
  <xsl:when test="*[1]">
"KRN",.84,7981999.001,2,758,0)
   <div>
"KRN",.84,7981999.001,2,759,0)
    <xsl:if test="$divstyle!=''">
"KRN",.84,7981999.001,2,760,0)
     <xsl:attribute name="style">
"KRN",.84,7981999.001,2,761,0)
      <xsl:value-of select="$divstyle"/>
"KRN",.84,7981999.001,2,762,0)
     </xsl:attribute>
"KRN",.84,7981999.001,2,763,0)
    </xsl:if>
"KRN",.84,7981999.001,2,764,0)
    <xsl:call-template name="MakeScrollable">
"KRN",.84,7981999.001,2,765,0)
     <xsl:with-param name="condition" select="$scroll"/>
"KRN",.84,7981999.001,2,766,0)
    </xsl:call-template>
"KRN",.84,7981999.001,2,767,0)
    <table class="dataGrid" cellpadding="5" cellspacing="0">
"KRN",.84,7981999.001,2,768,0)
     <xsl:apply-templates select="$tbldef/@HEADER"/>
"KRN",.84,7981999.001,2,769,0)
     <xsl:apply-templates select="$tbldef/@FOOTER"/>
"KRN",.84,7981999.001,2,770,0)
     <tbody>
"KRN",.84,7981999.001,2,771,0)
      <xsl:apply-templates select="*">
"KRN",.84,7981999.001,2,772,0)
       <xsl:with-param name="seqnum"
"KRN",.84,7981999.001,2,773,0)
            select="count($tbldef/COLUMN[@NAME='#'])"/>
"KRN",.84,7981999.001,2,774,0)
      </xsl:apply-templates>
"KRN",.84,7981999.001,2,775,0)
     </tbody>
"KRN",.84,7981999.001,2,776,0)
    </table>
"KRN",.84,7981999.001,2,777,0)
   </div>
"KRN",.84,7981999.001,2,778,0)
  </xsl:when>
"KRN",.84,7981999.001,2,779,0)
  <xsl:otherwise>
"KRN",.84,7981999.001,2,780,0)
   <xsl:call-template name="TableNoData"/>
"KRN",.84,7981999.001,2,781,0)
  </xsl:otherwise>
"KRN",.84,7981999.001,2,782,0)
</xsl:choose>
"KRN",.84,7981999.001,2,783,0)
</xsl:template>
"KRN",.84,7981999.001,2,784,0)
 
"KRN",.84,7981999.001,2,785,0)
<!-- Default data grid header -->
"KRN",.84,7981999.001,2,786,0)
 
"KRN",.84,7981999.001,2,787,0)
<xsl:template match="HEADER/TBLDEF/@HEADER">
"KRN",.84,7981999.001,2,788,0)
<thead>
"KRN",.84,7981999.001,2,789,0)
  <tr><xsl:apply-templates select="../COLUMN"/></tr>
"KRN",.84,7981999.001,2,790,0)
</thead>
"KRN",.84,7981999.001,2,791,0)
</xsl:template>
"KRN",.84,7981999.001,2,792,0)
 
"KRN",.84,7981999.001,2,793,0)
<!-- Default column heading cell -->
"KRN",.84,7981999.001,2,794,0)
 
"KRN",.84,7981999.001,2,795,0)
<xsl:template name="ColumnHeader" match="HEADER/TBLDEF/COLUMN">
"KRN",.84,7981999.001,2,796,0)
<xsl:param name="column" select="."/>
"KRN",.84,7981999.001,2,797,0)
<xsl:param name="colname" select="$column/@NAME"/>
"KRN",.84,7981999.001,2,798,0)
<xsl:param name="sortmode"/>
"KRN",.84,7981999.001,2,799,0)
<xsl:param name="sort" 
"KRN",.84,7981999.001,2,800,0)
      select="concat($column/../@NAME,'=',$colname,$sortmode)"/>
"KRN",.84,7981999.001,2,801,0)
<xsl:param name="title" select="$colname"/>
"KRN",.84,7981999.001,2,802,0)
<xsl:param name="colspan" select="0"/>
"KRN",.84,7981999.001,2,803,0)
<xsl:param name="rowspan" select="0"/>
"KRN",.84,7981999.001,2,804,0)
<xsl:param name="style"/>
"KRN",.84,7981999.001,2,805,0)
<xsl:param name="width"/>
"KRN",.84,7981999.001,2,806,0)
<th scope="col">
"KRN",.84,7981999.001,2,807,0)
  <xsl:if test="$colspan>1">
"KRN",.84,7981999.001,2,808,0)
   <xsl:attribute name="colspan">
"KRN",.84,7981999.001,2,809,0)
    <xsl:value-of select="$colspan"/>
"KRN",.84,7981999.001,2,810,0)
   </xsl:attribute>
"KRN",.84,7981999.001,2,811,0)
  </xsl:if>
"KRN",.84,7981999.001,2,812,0)
  <xsl:if test="$rowspan>1">
"KRN",.84,7981999.001,2,813,0)
   <xsl:attribute name="rowspan">
"KRN",.84,7981999.001,2,814,0)
    <xsl:value-of select="$rowspan"/>
"KRN",.84,7981999.001,2,815,0)
   </xsl:attribute>
"KRN",.84,7981999.001,2,816,0)
  </xsl:if>
"KRN",.84,7981999.001,2,817,0)
  <xsl:if test="string($style)!=''">
"KRN",.84,7981999.001,2,818,0)
   <xsl:attribute name="style">
"KRN",.84,7981999.001,2,819,0)
    <xsl:value-of select="$style"/>
"KRN",.84,7981999.001,2,820,0)
   </xsl:attribute>
"KRN",.84,7981999.001,2,821,0)
  </xsl:if>
"KRN",.84,7981999.001,2,822,0)
  <xsl:if test="string($width)!=''">
"KRN",.84,7981999.001,2,823,0)
   <xsl:attribute name="width">
"KRN",.84,7981999.001,2,824,0)
    <xsl:value-of select="$width"/>
"KRN",.84,7981999.001,2,825,0)
   </xsl:attribute>
"KRN",.84,7981999.001,2,826,0)
  </xsl:if>
"KRN",.84,7981999.001,2,827,0)
  <xsl:choose>
"KRN",.84,7981999.001,2,828,0)
   <xsl:when test="$title=''">&#160;</xsl:when>
"KRN",.84,7981999.001,2,829,0)
   <xsl:when test="($sort!='') and not($REMOVE_URLS)">
"KRN",.84,7981999.001,2,830,0)
    <xsl:element name="a">
"KRN",.84,7981999.001,2,831,0)
     <xsl:attribute name="href">
"KRN",.84,7981999.001,2,832,0)
      <xsl:text>http://vista/report/sort?</xsl:text>
"KRN",.84,7981999.001,2,833,0)
      <xsl:value-of select="$sort"/>
"KRN",.84,7981999.001,2,834,0)
     </xsl:attribute>
"KRN",.84,7981999.001,2,835,0)
     <xsl:value-of select="$title"/>
"KRN",.84,7981999.001,2,836,0)
    </xsl:element>
"KRN",.84,7981999.001,2,837,0)
   </xsl:when>
"KRN",.84,7981999.001,2,838,0)
   <xsl:otherwise><xsl:value-of select="$title"/></xsl:otherwise>
"KRN",.84,7981999.001,2,839,0)
  </xsl:choose>
"KRN",.84,7981999.001,2,840,0)
</th>
"KRN",.84,7981999.001,2,841,0)
</xsl:template>
"KRN",.84,7981999.001,2,842,0)
 
"KRN",.84,7981999.001,2,843,0)
<!-- Default Footer -->
"KRN",.84,7981999.001,2,844,0)
 
"KRN",.84,7981999.001,2,845,0)
<xsl:template name="DataGridFooter" match="TBLDEF/@FOOTER">
"KRN",.84,7981999.001,2,846,0)
<xsl:param name="colspan"
"KRN",.84,7981999.001,2,847,0)
      select="count(..//COLUMN[not(child::COLUMN[1])])"/>
"KRN",.84,7981999.001,2,848,0)
<tfoot><tr><td>
"KRN",.84,7981999.001,2,849,0)
  <xsl:if test="$colspan>1">
"KRN",.84,7981999.001,2,850,0)
   <xsl:attribute name="colspan">
"KRN",.84,7981999.001,2,851,0)
    <xsl:value-of select="$colspan"/>
"KRN",.84,7981999.001,2,852,0)
   </xsl:attribute>
"KRN",.84,7981999.001,2,853,0)
  </xsl:if>
"KRN",.84,7981999.001,2,854,0)
  <xsl:text>&#160;</xsl:text>
"KRN",.84,7981999.001,2,855,0)
</td></tr></tfoot>
"KRN",.84,7981999.001,2,856,0)
</xsl:template>
"KRN",.84,7981999.001,2,857,0)
 
"KRN",.84,7981999.001,2,858,0)
<!-- Default data grid row -->
"KRN",.84,7981999.001,2,859,0)
 
"KRN",.84,7981999.001,2,860,0)
<xsl:template match="*[@TABLE!='']/*">
"KRN",.84,7981999.001,2,861,0)
<xsl:param name="seqnum" select="0"/>
"KRN",.84,7981999.001,2,862,0)
<tr>
"KRN",.84,7981999.001,2,863,0)
 <xsl:if test="$seqnum">
"KRN",.84,7981999.001,2,864,0)
   <td><xsl:value-of select="position()"/></td>
"KRN",.84,7981999.001,2,865,0)
  </xsl:if>
"KRN",.84,7981999.001,2,866,0)
  <xsl:apply-templates select="child::*"/>
"KRN",.84,7981999.001,2,867,0)
</tr>
"KRN",.84,7981999.001,2,868,0)
</xsl:template>
"KRN",.84,7981999.001,2,869,0)
 
"KRN",.84,7981999.001,2,870,0)
<!-- Data grid cell -->
"KRN",.84,7981999.001,2,871,0)
 
"KRN",.84,7981999.001,2,872,0)
<xsl:template name="TableCell" match="*[@TABLE!='']/*/*">
"KRN",.84,7981999.001,2,873,0)
<xsl:param name="class"/>
"KRN",.84,7981999.001,2,874,0)
<xsl:param name="colspan" select="0"/>
"KRN",.84,7981999.001,2,875,0)
<xsl:param name="fmdt" select="0"/>
"KRN",.84,7981999.001,2,876,0)
<xsl:param name="rowspan" select="0"/>
"KRN",.84,7981999.001,2,877,0)
<xsl:param name="style"/>
"KRN",.84,7981999.001,2,878,0)
<xsl:param name="value" select="."/>
"KRN",.84,7981999.001,2,879,0)
<xsl:param name="width"/>
"KRN",.84,7981999.001,2,880,0)
<xsl:param name="yesno" select="0"/>
"KRN",.84,7981999.001,2,881,0)
<td>
"KRN",.84,7981999.001,2,882,0)
  <xsl:if test="string($class)!=''">
"KRN",.84,7981999.001,2,883,0)
   <xsl:attribute name="class">
"KRN",.84,7981999.001,2,884,0)
    <xsl:value-of select="$class"/>
"KRN",.84,7981999.001,2,885,0)
   </xsl:attribute>
"KRN",.84,7981999.001,2,886,0)
  </xsl:if>
"KRN",.84,7981999.001,2,887,0)
  <xsl:if test="$colspan>1">
"KRN",.84,7981999.001,2,888,0)
   <xsl:attribute name="colspan">
"KRN",.84,7981999.001,2,889,0)
    <xsl:value-of select="$colspan"/>
"KRN",.84,7981999.001,2,890,0)
   </xsl:attribute>
"KRN",.84,7981999.001,2,891,0)
  </xsl:if>
"KRN",.84,7981999.001,2,892,0)
  <xsl:if test="$rowspan>1">
"KRN",.84,7981999.001,2,893,0)
   <xsl:attribute name="rowspan">
"KRN",.84,7981999.001,2,894,0)
    <xsl:value-of select="$rowspan"/>
"KRN",.84,7981999.001,2,895,0)
   </xsl:attribute>
"KRN",.84,7981999.001,2,896,0)
  </xsl:if>
"KRN",.84,7981999.001,2,897,0)
  <xsl:if test="string($style)!=''">
"KRN",.84,7981999.001,2,898,0)
   <xsl:attribute name="style">
"KRN",.84,7981999.001,2,899,0)
    <xsl:value-of select="$style"/>
"KRN",.84,7981999.001,2,900,0)
   </xsl:attribute>
"KRN",.84,7981999.001,2,901,0)
  </xsl:if>
"KRN",.84,7981999.001,2,902,0)
  <xsl:if test="string($width)!=''">
"KRN",.84,7981999.001,2,903,0)
   <xsl:attribute name="width">
"KRN",.84,7981999.001,2,904,0)
    <xsl:value-of select="$width"/>
"KRN",.84,7981999.001,2,905,0)
   </xsl:attribute>
"KRN",.84,7981999.001,2,906,0)
  </xsl:if>
"KRN",.84,7981999.001,2,907,0)
  <xsl:choose>
"KRN",.84,7981999.001,2,908,0)
   <xsl:when test="string($value)=''">&#160;</xsl:when>
"KRN",.84,7981999.001,2,909,0)
   <xsl:when test="boolean($fmdt)">
"KRN",.84,7981999.001,2,910,0)
    <xsl:call-template name="DateTime">
"KRN",.84,7981999.001,2,911,0)
     <xsl:with-param name="dt" select="$value"/>
"KRN",.84,7981999.001,2,912,0)
    </xsl:call-template>
"KRN",.84,7981999.001,2,913,0)
   </xsl:when>
"KRN",.84,7981999.001,2,914,0)
   <xsl:when test="boolean($yesno)">
"KRN",.84,7981999.001,2,915,0)
    <xsl:choose>
"KRN",.84,7981999.001,2,916,0)
     <xsl:when test="$value!=0">Yes</xsl:when>
"KRN",.84,7981999.001,2,917,0)
     <xsl:otherwise>No</xsl:otherwise>
"KRN",.84,7981999.001,2,918,0)
    </xsl:choose>
"KRN",.84,7981999.001,2,919,0)
   </xsl:when>
"KRN",.84,7981999.001,2,920,0)
   <xsl:otherwise><xsl:value-of select="$value"/></xsl:otherwise>
"KRN",.84,7981999.001,2,921,0)
  </xsl:choose>
"KRN",.84,7981999.001,2,922,0)
</td>
"KRN",.84,7981999.001,2,923,0)
</xsl:template>
"KRN",.84,7981999.001,2,924,0)
 
"KRN",.84,7981999.001,2,925,0)
<!-- Default column headings -->
"KRN",.84,7981999.001,2,926,0)
 
"KRN",.84,7981999.001,2,927,0)
<xsl:template match="TBLDEF/COLUMN[@NAME='#']">
"KRN",.84,7981999.001,2,928,0)
<xsl:param name="rowspan" select="0"/>
"KRN",.84,7981999.001,2,929,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981999.001,2,930,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981999.001,2,931,0)
  <xsl:with-param name="sort" select="''"/>
"KRN",.84,7981999.001,2,932,0)
  <xsl:with-param name="width" select="'4%'"/>
"KRN",.84,7981999.001,2,933,0)
</xsl:call-template>
"KRN",.84,7981999.001,2,934,0)
</xsl:template>
"KRN",.84,7981999.001,2,935,0)
 
"KRN",.84,7981999.001,2,936,0)
<xsl:template 
"KRN",.84,7981999.001,2,937,0)
match="COLUMN[@NAME='DATE']">                                    
"KRN",.84,7981999.001,2,938,0)
 <xsl:param name="rowspan" select="0"/>
"KRN",.84,7981999.001,2,939,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981999.001,2,940,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981999.001,2,941,0)
  <xsl:with-param name="title" 
"KRN",.84,7981999.001,2,942,0)
select="'Date'"/>                               
"KRN",.84,7981999.001,2,943,0)
  <xsl:with-param name="width" select="'15%'"/>
"KRN",.84,7981999.001,2,944,0)
</xsl:call-template>
"KRN",.84,7981999.001,2,945,0)
</xsl:template>
"KRN",.84,7981999.001,2,946,0)
 
"KRN",.84,7981999.001,2,947,0)
<xsl:template match="COLUMN[@NAME='DOD']">
"KRN",.84,7981999.001,2,948,0)
<xsl:param name="rowspan" select="0"/>
"KRN",.84,7981999.001,2,949,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981999.001,2,950,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981999.001,2,951,0)
  <xsl:with-param name="title" select="'Date of Death'"/>
"KRN",.84,7981999.001,2,952,0)
  <xsl:with-param name="width" select="'7%'"/>
"KRN",.84,7981999.001,2,953,0)
</xsl:call-template>
"KRN",.84,7981999.001,2,954,0)
</xsl:template>
"KRN",.84,7981999.001,2,955,0)
 
"KRN",.84,7981999.001,2,956,0)
<xsl:template match="COLUMN[@NAME='LAST4']">
"KRN",.84,7981999.001,2,957,0)
<xsl:param name="rowspan" select="0"/>
"KRN",.84,7981999.001,2,958,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981999.001,2,959,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981999.001,2,960,0)
  <xsl:with-param name="title" select="'SSN'"/>
"KRN",.84,7981999.001,2,961,0)
  <xsl:with-param name="width" select="'7%'"/>
"KRN",.84,7981999.001,2,962,0)
</xsl:call-template>
"KRN",.84,7981999.001,2,963,0)
</xsl:template>
"KRN",.84,7981999.001,2,964,0)
 
"KRN",.84,7981999.001,2,965,0)
<xsl:template match="COLUMN[@NAME='AGE']">
"KRN",.84,7981999.001,2,966,0)
<xsl:param name="rowspan" select="0"/>
"KRN",.84,7981999.001,2,967,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981999.001,2,968,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981999.001,2,969,0)
  <xsl:with-param name="title" select="'Age'"/>
"KRN",.84,7981999.001,2,970,0)
  <xsl:with-param name="width" select="'5%'"/>
"KRN",.84,7981999.001,2,971,0)
</xsl:call-template>
"KRN",.84,7981999.001,2,972,0)
</xsl:template>
"KRN",.84,7981999.001,2,973,0)
 
"KRN",.84,7981999.001,2,974,0)
<xsl:template match="COLUMN[@NAME='DOB']">
"KRN",.84,7981999.001,2,975,0)
<xsl:param name="rowspan" select="0"/>
"KRN",.84,7981999.001,2,976,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981999.001,2,977,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981999.001,2,978,0)
  <xsl:with-param name="title" select="'Date of Birth'"/>
"KRN",.84,7981999.001,2,979,0)
  <xsl:with-param name="width" select="'7%'"/>
"KRN",.84,7981999.001,2,980,0)
</xsl:call-template>
"KRN",.84,7981999.001,2,981,0)
</xsl:template>
"KRN",.84,7981999.001,2,982,0)
 
"KRN",.84,7981999.001,2,983,0)
<xsl:template match="COLUMN[@NAME='NAME']">
"KRN",.84,7981999.001,2,984,0)
<xsl:param name="rowspan" select="0"/>
"KRN",.84,7981999.001,2,985,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981999.001,2,986,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981999.001,2,987,0)
  <xsl:with-param name="title" select="'Name'"/>
"KRN",.84,7981999.001,2,988,0)
</xsl:call-template>
"KRN",.84,7981999.001,2,989,0)
</xsl:template>
"KRN",.84,7981999.001,2,990,0)
 
"KRN",.84,7981999.001,2,991,0)
<xsl:template match="TBLDEF[@NAME='PATIENTS']/COLUMN[@NAME='NAME']">
"KRN",.84,7981999.001,2,992,0)
<xsl:param name="rowspan" select="0"/>
"KRN",.84,7981999.001,2,993,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981999.001,2,994,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981999.001,2,995,0)
  <xsl:with-param name="title" select="'Patient Name'"/>
"KRN",.84,7981999.001,2,996,0)
</xsl:call-template>
"KRN",.84,7981999.001,2,997,0)
</xsl:template>
"KRN",.84,7981999.001,2,998,0)
 
"KRN",.84,7981999.001,2,999,0)
<!-- Default cells -->
"KRN",.84,7981999.001,2,1000,0)
 
"KRN",.84,7981999.001,2,1001,0)
<xsl:template match="PATIENT/DOD">
"KRN",.84,7981999.001,2,1002,0)
<xsl:param name="rowspan" select="0"/>
"KRN",.84,7981999.001,2,1003,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981999.001,2,1004,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981999.001,2,1005,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981999.001,2,1006,0)
</xsl:call-template>
"KRN",.84,7981999.001,2,1007,0)
</xsl:template>
"KRN",.84,7981999.001,2,1008,0)
 
"KRN",.84,7981999.001,2,1009,0)
<xsl:template match="PATIENT/DOB">
"KRN",.84,7981999.001,2,1010,0)
<xsl:param name="rowspan" select="0"/>
"KRN",.84,7981999.001,2,1011,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981999.001,2,1012,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981999.001,2,1013,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981999.001,2,1014,0)
</xsl:call-template>
"KRN",.84,7981999.001,2,1015,0)
</xsl:template>
"KRN",.84,7981999.001,2,1016,0)
 
"KRN",.84,7981999.001,2,1017,0)
<xsl:template match="*[@TABLE!='']/*/NAME">
"KRN",.84,7981999.001,2,1018,0)
<xsl:param name="rowspan" select="0"/>
"KRN",.84,7981999.001,2,1019,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981999.001,2,1020,0)
  <xsl:with-param name="class" select="'aLeft'"/>
"KRN",.84,7981999.001,2,1021,0)
  <xsl:with-param name="rowspan" select="$rowspan"/>
"KRN",.84,7981999.001,2,1022,0)
</xsl:call-template>
"KRN",.84,7981999.001,2,1023,0)
</xsl:template>
"KRN",.84,7981999.001,2,1024,0)
 
"KRN",.84,7981999.001,2,1025,0)
</xsl:stylesheet>
"KRN",.84,7981999.001,3,0)
^.845A
"KRN",.84,7981999.002,-1)
0^3
"KRN",.84,7981999.002,0)
7981999.002^2^^CLINICAL CASE REGISTRIES^Common XSL templates (CSV)
"KRN",.84,7981999.002,2,0)
^^283^283^3170802^
"KRN",.84,7981999.002,2,1,0)
<?xml version="1.0"?>
"KRN",.84,7981999.002,2,2,0)
<xsl:stylesheet version="1.0" 
"KRN",.84,7981999.002,2,3,0)
xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
"KRN",.84,7981999.002,2,4,0)
 
"KRN",.84,7981999.002,2,5,0)
<!-- Common (999.2) -->
"KRN",.84,7981999.002,2,6,0)
 
"KRN",.84,7981999.002,2,7,0)
<xsl:output method="text" encoding="iso-8859-1"/>
"KRN",.84,7981999.002,2,8,0)
<xsl:strip-space elements="*"/>
"KRN",.84,7981999.002,2,9,0)
 
"KRN",.84,7981999.002,2,10,0)
<xsl:variable name="CRLF"><xsl:text>&#13;&#10;</xsl:text></xsl:variable>
"KRN",.84,7981999.002,2,11,0)
<xsl:variable name="DELIMITER"><xsl:text>,</xsl:text></xsl:variable>
"KRN",.84,7981999.002,2,12,0)
<!-- xsl:variable 
"KRN",.84,7981999.002,2,13,0)
name="FILESWITCH"><xsl:text>&#127;</xsl:text></xsl:variable -->
"KRN",.84,7981999.002,2,14,0)
 
"KRN",.84,7981999.002,2,15,0)
<!-- Determine if the Age, DOB, ICN, PACT or PCP column is present on the 
"KRN",.84,7981999.002,2,16,0)
report. -->  
"KRN",.84,7981999.002,2,17,0)
<xsl:variable name="AGE_YES"  
"KRN",.84,7981999.002,2,18,0)
select="count(/REPORT/HEADER/TBLDEF//COLUMN[@NAME='AGE']) &gt; 0"/>
"KRN",.84,7981999.002,2,19,0)
<xsl:variable name="DOB_YES"  
"KRN",.84,7981999.002,2,20,0)
select="count(/REPORT/HEADER/TBLDEF//COLUMN[@NAME='DOB']) &gt; 0"/>
"KRN",.84,7981999.002,2,21,0)
<xsl:variable name="ICN_YES"  
"KRN",.84,7981999.002,2,22,0)
select="count(/REPORT/HEADER/TBLDEF//COLUMN[@NAME='ICN']) &gt; 0"/>
"KRN",.84,7981999.002,2,23,0)
<xsl:variable name="PACT_YES" 
"KRN",.84,7981999.002,2,24,0)
select="count(/REPORT/HEADER/TBLDEF//COLUMN[@NAME='PACT']) &gt; 0"/>
"KRN",.84,7981999.002,2,25,0)
<xsl:variable name="PCP_YES"  
"KRN",.84,7981999.002,2,26,0)
select="count(/REPORT/HEADER/TBLDEF//COLUMN[@NAME='PCP']) &gt; 0"/>
"KRN",.84,7981999.002,2,27,0)
 
"KRN",.84,7981999.002,2,28,0)
<xsl:key name="TableDefs" match="/REPORT/HEADER/TBLDEF" use="@NAME"/>
"KRN",.84,7981999.002,2,29,0)
 
"KRN",.84,7981999.002,2,30,0)
<xsl:template match="REPORT/HEADER//*"></xsl:template>
"KRN",.84,7981999.002,2,31,0)
<xsl:template match="REPORT/PARAMETERS//*"></xsl:template>
"KRN",.84,7981999.002,2,32,0)
 
"KRN",.84,7981999.002,2,33,0)
<!--
"KRN",.84,7981999.002,2,34,0)
=========================================================================
"KRN",.84,7981999.002,2,35,0)
                                UTILITIES
"KRN",.84,7981999.002,2,36,0)
=========================================================================
"KRN",.84,7981999.002,2,37,0)
-->
"KRN",.84,7981999.002,2,38,0)
 
"KRN",.84,7981999.002,2,39,0)
<!-- Converts the FileMan date/time in printable format -->
"KRN",.84,7981999.002,2,40,0)
 
"KRN",.84,7981999.002,2,41,0)
<xsl:template name="DateTime">
"KRN",.84,7981999.002,2,42,0)
<xsl:param name="dt"/>
"KRN",.84,7981999.002,2,43,0)
<!--
"KRN",.84,7981999.002,2,44,0)
     Date (YYYMMDD)
"KRN",.84,7981999.002,2,45,0)
-->
"KRN",.84,7981999.002,2,46,0)
<xsl:variable name="date"
"KRN",.84,7981999.002,2,47,0)
               select="substring-before(concat($dt,'.'),'.')"/>
"KRN",.84,7981999.002,2,48,0)
<xsl:if test="$date!=''">
"KRN",.84,7981999.002,2,49,0)
  <xsl:choose>
"KRN",.84,7981999.002,2,50,0)
   <xsl:when test="string-length($date)=7">
"KRN",.84,7981999.002,2,51,0)
    <xsl:variable name="year" 
"KRN",.84,7981999.002,2,52,0)
                  select="string(number(substring($date,1,3))+1700)"/>
"KRN",.84,7981999.002,2,53,0)
    <xsl:variable name="month" select="substring($date,4,2)"/>
"KRN",.84,7981999.002,2,54,0)
    <xsl:variable name="day" select="substring($date,6,2)"/>
"KRN",.84,7981999.002,2,55,0)
    <xsl:choose>
"KRN",.84,7981999.002,2,56,0)
     <xsl:when test="$day!='00'">
"KRN",.84,7981999.002,2,57,0)
      <xsl:value-of select="concat($month,'/',$day,'/',$year)"/>
"KRN",.84,7981999.002,2,58,0)
     </xsl:when>
"KRN",.84,7981999.002,2,59,0)
     <xsl:when test="$month!='00'">
"KRN",.84,7981999.002,2,60,0)
      <xsl:value-of select="concat($month,'/',$year)"/>
"KRN",.84,7981999.002,2,61,0)
     </xsl:when>
"KRN",.84,7981999.002,2,62,0)
     <xsl:otherwise><xsl:value-of select="$year"/></xsl:otherwise>
"KRN",.84,7981999.002,2,63,0)
    </xsl:choose>
"KRN",.84,7981999.002,2,64,0)
   </xsl:when>
"KRN",.84,7981999.002,2,65,0)
   <xsl:otherwise>{error}</xsl:otherwise>
"KRN",.84,7981999.002,2,66,0)
  </xsl:choose>
"KRN",.84,7981999.002,2,67,0)
  <!--
"KRN",.84,7981999.002,2,68,0)
      Time (HHMMSS)
"KRN",.84,7981999.002,2,69,0)
  -->
"KRN",.84,7981999.002,2,70,0)
  <xsl:variable name="time"
"KRN",.84,7981999.002,2,71,0)
                select="concat(substring-after($dt,'.'),'000000')"/>
"KRN",.84,7981999.002,2,72,0)
  <xsl:if test="number($time)>0">
"KRN",.84,7981999.002,2,73,0)
   <xsl:text> </xsl:text>
"KRN",.84,7981999.002,2,74,0)
   <xsl:value-of select="substring($time,1,2)"/>
"KRN",.84,7981999.002,2,75,0)
   <xsl:text>:</xsl:text>
"KRN",.84,7981999.002,2,76,0)
   <xsl:value-of select="substring($time,3,2)"/>
"KRN",.84,7981999.002,2,77,0)
  </xsl:if>
"KRN",.84,7981999.002,2,78,0)
</xsl:if>
"KRN",.84,7981999.002,2,79,0)
</xsl:template>
"KRN",.84,7981999.002,2,80,0)
 
"KRN",.84,7981999.002,2,81,0)
<!-- Doubles the double quotes in the provided string -->
"KRN",.84,7981999.002,2,82,0)
 
"KRN",.84,7981999.002,2,83,0)
<xsl:template name="DoubleQuotes">
"KRN",.84,7981999.002,2,84,0)
<xsl:param name="value" select="."/>
"KRN",.84,7981999.002,2,85,0)
<xsl:choose>
"KRN",.84,7981999.002,2,86,0)
  <xsl:when test="contains($value,'&quot;')">
"KRN",.84,7981999.002,2,87,0)
   <xsl:value-of select="substring-before($value,'&quot;')"/>
"KRN",.84,7981999.002,2,88,0)
   <xsl:text>&quot;&quot;</xsl:text>
"KRN",.84,7981999.002,2,89,0)
   <xsl:call-template name="DoubleQuotes">
"KRN",.84,7981999.002,2,90,0)
    <xsl:with-param name="value" 
"KRN",.84,7981999.002,2,91,0)
                    select="substring-after($value,'&quot;')"/>
"KRN",.84,7981999.002,2,92,0)
   </xsl:call-template>
"KRN",.84,7981999.002,2,93,0)
  </xsl:when>
"KRN",.84,7981999.002,2,94,0)
  <xsl:otherwise><xsl:value-of select="$value"/></xsl:otherwise>
"KRN",.84,7981999.002,2,95,0)
</xsl:choose>
"KRN",.84,7981999.002,2,96,0)
</xsl:template>
"KRN",.84,7981999.002,2,97,0)
 
"KRN",.84,7981999.002,2,98,0)
<!-- Quotes the string if it contains commas or double quotes -->
"KRN",.84,7981999.002,2,99,0)
 
"KRN",.84,7981999.002,2,100,0)
<xsl:template name="Quote">
"KRN",.84,7981999.002,2,101,0)
<xsl:param name="value" select="."/>
"KRN",.84,7981999.002,2,102,0)
<xsl:choose>
"KRN",.84,7981999.002,2,103,0)
  <xsl:when test="contains($value,'&quot;')">
"KRN",.84,7981999.002,2,104,0)
   <xsl:text>&quot;</xsl:text>
"KRN",.84,7981999.002,2,105,0)
  <xsl:call-template name="DoubleQuotes">
"KRN",.84,7981999.002,2,106,0)
    <xsl:with-param name="value" select="$value"/>
"KRN",.84,7981999.002,2,107,0)
   </xsl:call-template>
"KRN",.84,7981999.002,2,108,0)
   <xsl:text>&quot;</xsl:text>
"KRN",.84,7981999.002,2,109,0)
  </xsl:when>
"KRN",.84,7981999.002,2,110,0)
  <xsl:when test="contains($value,$DELIMITER)">
"KRN",.84,7981999.002,2,111,0)
   <xsl:text>&quot;</xsl:text>
"KRN",.84,7981999.002,2,112,0)
   <xsl:value-of select="$value"/>
"KRN",.84,7981999.002,2,113,0)
   <xsl:text>&quot;</xsl:text>
"KRN",.84,7981999.002,2,114,0)
  </xsl:when>
"KRN",.84,7981999.002,2,115,0)
  <xsl:otherwise><xsl:value-of select="$value"/></xsl:otherwise>
"KRN",.84,7981999.002,2,116,0)
</xsl:choose>
"KRN",.84,7981999.002,2,117,0)
</xsl:template> 
"KRN",.84,7981999.002,2,118,0)
 
"KRN",.84,7981999.002,2,119,0)
<!-- Default report summary -->
"KRN",.84,7981999.002,2,120,0)
 
"KRN",.84,7981999.002,2,121,0)
<xsl:template name="ReportSummary">
"KRN",.84,7981999.002,2,122,0)
<xsl:variable name="SUMMARY" select="/REPORT/SUMMARY"/>
"KRN",.84,7981999.002,2,123,0)
<xsl:if test="$SUMMARY/*[1]">
"KRN",.84,7981999.002,2,124,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981999.002,2,125,0)
  <xsl:apply-templates select="$SUMMARY"/>
"KRN",.84,7981999.002,2,126,0)
</xsl:if>
"KRN",.84,7981999.002,2,127,0)
</xsl:template>
"KRN",.84,7981999.002,2,128,0)
 
"KRN",.84,7981999.002,2,129,0)
<!-- Empty table indicator -->
"KRN",.84,7981999.002,2,130,0)
 
"KRN",.84,7981999.002,2,131,0)
<xsl:template name="TableNoData">
"KRN",.84,7981999.002,2,132,0)
<xsl:text>No data has been found.</xsl:text>
"KRN",.84,7981999.002,2,133,0)
<xsl:value-of select="$CRLF"/>
"KRN",.84,7981999.002,2,134,0)
</xsl:template>
"KRN",.84,7981999.002,2,135,0)
 
"KRN",.84,7981999.002,2,136,0)
<!-- Format the section of a utilization report -->
"KRN",.84,7981999.002,2,137,0)
 
"KRN",.84,7981999.002,2,138,0)
<xsl:template name="UtilizationSection">
"KRN",.84,7981999.002,2,139,0)
<xsl:param name="data"/>
"KRN",.84,7981999.002,2,140,0)
<xsl:param name="subttl"/>
"KRN",.84,7981999.002,2,141,0)
<xsl:variable name="table" select="$data/@TABLE"/>
"KRN",.84,7981999.002,2,142,0)
<xsl:if test="$data/*[1]">
"KRN",.84,7981999.002,2,143,0)
  <xsl:value-of select="$UTILIZATION_HEADER"/>
"KRN",.84,7981999.002,2,144,0)
  <xsl:value-of select="concat(' (',$subttl,')')"/>
"KRN",.84,7981999.002,2,145,0)
  <xsl:value-of select="$CRLF"/>
"KRN",.84,7981999.002,2,146,0)
  <xsl:apply-templates select="$data"/>
"KRN",.84,7981999.002,2,147,0)
  <!-- xsl:value-of select="$FILESWITCH"/ -->
"KRN",.84,7981999.002,2,148,0)
</xsl:if>
"KRN",.84,7981999.002,2,149,0)
 
"KRN",.84,7981999.002,2,150,0)
</xsl:template>
"KRN",.84,7981999.002,2,151,0)
 
"KRN",.84,7981999.002,2,152,0)
<!--
"KRN",.84,7981999.002,2,153,0)
=========================================================================
"KRN",.84,7981999.002,2,154,0)
                       DEFAULT DATA GRID TEMPLATES
"KRN",.84,7981999.002,2,155,0)
=========================================================================
"KRN",.84,7981999.002,2,156,0)
-->
"KRN",.84,7981999.002,2,157,0)
 
"KRN",.84,7981999.002,2,158,0)
<xsl:template name="DataGrid" match="*[@TABLE!='']">
"KRN",.84,7981999.002,2,159,0)
<xsl:variable name="tbldef" select="key('TableDefs',@TABLE)"/>
"KRN",.84,7981999.002,2,160,0)
<xsl:value-of select="$CRLF"/>
"KRN",.84,7981999.002,2,161,0)
<xsl:choose>
"KRN",.84,7981999.002,2,162,0)
  <xsl:when test="*[1]">
"KRN",.84,7981999.002,2,163,0)
   <xsl:apply-templates select="$tbldef/@HEADER"/>
"KRN",.84,7981999.002,2,164,0)
   <xsl:apply-templates select="*"/>
"KRN",.84,7981999.002,2,165,0)
  </xsl:when>
"KRN",.84,7981999.002,2,166,0)
  <xsl:otherwise>
"KRN",.84,7981999.002,2,167,0)
   <xsl:call-template name="TableNoData"/>
"KRN",.84,7981999.002,2,168,0)
  </xsl:otherwise>
"KRN",.84,7981999.002,2,169,0)
</xsl:choose>
"KRN",.84,7981999.002,2,170,0)
</xsl:template>
"KRN",.84,7981999.002,2,171,0)
 
"KRN",.84,7981999.002,2,172,0)
<!-- Default data grid header -->
"KRN",.84,7981999.002,2,173,0)
 
"KRN",.84,7981999.002,2,174,0)
<xsl:template match="HEADER/TBLDEF/@HEADER">
"KRN",.84,7981999.002,2,175,0)
<xsl:apply-templates select="..//COLUMN[not(child::COLUMN[1])]"/>
"KRN",.84,7981999.002,2,176,0)
<xsl:value-of select="$CRLF"/>
"KRN",.84,7981999.002,2,177,0)
</xsl:template>
"KRN",.84,7981999.002,2,178,0)
 
"KRN",.84,7981999.002,2,179,0)
<!-- Default column heading cell -->
"KRN",.84,7981999.002,2,180,0)
 
"KRN",.84,7981999.002,2,181,0)
<xsl:template name="ColumnHeader" match="HEADER/TBLDEF/COLUMN">
"KRN",.84,7981999.002,2,182,0)
<xsl:param name="column" select="."/>
"KRN",.84,7981999.002,2,183,0)
<xsl:param name="title" select="$column/@NAME"/>
"KRN",.84,7981999.002,2,184,0)
<xsl:if test="$title!='#'">
"KRN",.84,7981999.002,2,185,0)
  <xsl:call-template name="Quote">
"KRN",.84,7981999.002,2,186,0)
   <xsl:with-param name="value" select="$title"/>
"KRN",.84,7981999.002,2,187,0)
  </xsl:call-template>
"KRN",.84,7981999.002,2,188,0)
  <xsl:value-of select="$DELIMITER"/>
"KRN",.84,7981999.002,2,189,0)
</xsl:if>
"KRN",.84,7981999.002,2,190,0)
</xsl:template>
"KRN",.84,7981999.002,2,191,0)
 
"KRN",.84,7981999.002,2,192,0)
<!-- Default data grid row -->
"KRN",.84,7981999.002,2,193,0)
 
"KRN",.84,7981999.002,2,194,0)
<xsl:template match="*[@TABLE!='']/*">
"KRN",.84,7981999.002,2,195,0)
<xsl:param name="seqnum" select="0"/>
"KRN",.84,7981999.002,2,196,0)
<xsl:if test="$seqnum">
"KRN",.84,7981999.002,2,197,0)
  <xsl:value-of select="position()"/>
"KRN",.84,7981999.002,2,198,0)
  <xsl:value-of select="$DELIMITER"/>
"KRN",.84,7981999.002,2,199,0)
</xsl:if>
"KRN",.84,7981999.002,2,200,0)
<xsl:apply-templates select="child::*"/>
"KRN",.84,7981999.002,2,201,0)
<xsl:value-of select="$CRLF"/>
"KRN",.84,7981999.002,2,202,0)
</xsl:template>
"KRN",.84,7981999.002,2,203,0)
 
"KRN",.84,7981999.002,2,204,0)
<!-- Data grid cell -->
"KRN",.84,7981999.002,2,205,0)
 
"KRN",.84,7981999.002,2,206,0)
<xsl:template name="TableCell" match="*[@TABLE!='']/*/*">
"KRN",.84,7981999.002,2,207,0)
<xsl:param name="fmdt" select="0"/>
"KRN",.84,7981999.002,2,208,0)
<xsl:param name="value" select="."/>
"KRN",.84,7981999.002,2,209,0)
<xsl:param name="yesno" select="0"/>
"KRN",.84,7981999.002,2,210,0)
<xsl:choose>
"KRN",.84,7981999.002,2,211,0)
  <xsl:when test="boolean($fmdt)">
"KRN",.84,7981999.002,2,212,0)
   <xsl:call-template name="DateTime">
"KRN",.84,7981999.002,2,213,0)
    <xsl:with-param name="dt" select="$value"/>
"KRN",.84,7981999.002,2,214,0)
   </xsl:call-template>
"KRN",.84,7981999.002,2,215,0)
  </xsl:when>
"KRN",.84,7981999.002,2,216,0)
  <xsl:when test="boolean($yesno)">
"KRN",.84,7981999.002,2,217,0)
   <xsl:choose>
"KRN",.84,7981999.002,2,218,0)
    <xsl:when test="$value!=0">Yes</xsl:when>
"KRN",.84,7981999.002,2,219,0)
    <xsl:otherwise>No</xsl:otherwise>
"KRN",.84,7981999.002,2,220,0)
   </xsl:choose>
"KRN",.84,7981999.002,2,221,0)
  </xsl:when>
"KRN",.84,7981999.002,2,222,0)
  <xsl:otherwise>
"KRN",.84,7981999.002,2,223,0)
   <xsl:call-template name="Quote">
"KRN",.84,7981999.002,2,224,0)
    <xsl:with-param name="value" select="$value"/>
"KRN",.84,7981999.002,2,225,0)
   </xsl:call-template>
"KRN",.84,7981999.002,2,226,0)
  </xsl:otherwise>
"KRN",.84,7981999.002,2,227,0)
</xsl:choose>
"KRN",.84,7981999.002,2,228,0)
<xsl:value-of select="$DELIMITER"/>
"KRN",.84,7981999.002,2,229,0)
</xsl:template>
"KRN",.84,7981999.002,2,230,0)
 
"KRN",.84,7981999.002,2,231,0)
<!-- Default column headers -->
"KRN",.84,7981999.002,2,232,0)
 
"KRN",.84,7981999.002,2,233,0)
<xsl:template match="COLUMN[@NAME='DATE']">
"KRN",.84,7981999.002,2,234,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981999.002,2,235,0)
  <xsl:with-param name="title" select="'Date'"/>
"KRN",.84,7981999.002,2,236,0)
</xsl:call-template>
"KRN",.84,7981999.002,2,237,0)
</xsl:template>
"KRN",.84,7981999.002,2,238,0)
 
"KRN",.84,7981999.002,2,239,0)
<xsl:template match="COLUMN[@NAME='DOB']">
"KRN",.84,7981999.002,2,240,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981999.002,2,241,0)
  <xsl:with-param name="title" select="'Date of Birth'"/>
"KRN",.84,7981999.002,2,242,0)
</xsl:call-template>
"KRN",.84,7981999.002,2,243,0)
</xsl:template>
"KRN",.84,7981999.002,2,244,0)
 
"KRN",.84,7981999.002,2,245,0)
<xsl:template match="COLUMN[@NAME='DOD']">
"KRN",.84,7981999.002,2,246,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981999.002,2,247,0)
  <xsl:with-param name="title" select="'Date of Death'"/>
"KRN",.84,7981999.002,2,248,0)
</xsl:call-template>
"KRN",.84,7981999.002,2,249,0)
</xsl:template>
"KRN",.84,7981999.002,2,250,0)
 
"KRN",.84,7981999.002,2,251,0)
<xsl:template match="COLUMN[@NAME='LAST4']">
"KRN",.84,7981999.002,2,252,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981999.002,2,253,0)
  <xsl:with-param name="title" select="'SSN'"/>
"KRN",.84,7981999.002,2,254,0)
</xsl:call-template>
"KRN",.84,7981999.002,2,255,0)
</xsl:template>
"KRN",.84,7981999.002,2,256,0)
 
"KRN",.84,7981999.002,2,257,0)
<xsl:template match="COLUMN[@NAME='NAME']">
"KRN",.84,7981999.002,2,258,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981999.002,2,259,0)
  <xsl:with-param name="title" select="'Name'"/>
"KRN",.84,7981999.002,2,260,0)
</xsl:call-template>
"KRN",.84,7981999.002,2,261,0)
</xsl:template>
"KRN",.84,7981999.002,2,262,0)
 
"KRN",.84,7981999.002,2,263,0)
<xsl:template match="TBLDEF[@NAME='PATIENTS']/COLUMN[@NAME='NAME']">
"KRN",.84,7981999.002,2,264,0)
<xsl:call-template name="ColumnHeader">
"KRN",.84,7981999.002,2,265,0)
  <xsl:with-param name="title" select="'Patient Name'"/>
"KRN",.84,7981999.002,2,266,0)
</xsl:call-template>
"KRN",.84,7981999.002,2,267,0)
</xsl:template>
"KRN",.84,7981999.002,2,268,0)
 
"KRN",.84,7981999.002,2,269,0)
<!-- Default cells -->
"KRN",.84,7981999.002,2,270,0)
 
"KRN",.84,7981999.002,2,271,0)
<xsl:template match="PATIENT/DOB">
"KRN",.84,7981999.002,2,272,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981999.002,2,273,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981999.002,2,274,0)
</xsl:call-template>
"KRN",.84,7981999.002,2,275,0)
</xsl:template>
"KRN",.84,7981999.002,2,276,0)
 
"KRN",.84,7981999.002,2,277,0)
<xsl:template match="PATIENT/DOD">
"KRN",.84,7981999.002,2,278,0)
<xsl:call-template name="TableCell">
"KRN",.84,7981999.002,2,279,0)
  <xsl:with-param name="fmdt" select="1"/>
"KRN",.84,7981999.002,2,280,0)
</xsl:call-template>
"KRN",.84,7981999.002,2,281,0)
</xsl:template>
"KRN",.84,7981999.002,2,282,0)
 
"KRN",.84,7981999.002,2,283,0)
</xsl:stylesheet>
"MBREQ")
0
"ORD",9,.84)
.84;9;;;EDEOUT^DIFROMSO(.84,DA,"",XPDA);FPRE^DIFROMSI(.84,"",XPDA);EPRE^DIFROMSI(.84,DA,"",XPDA,"",OLDA);;EPOST^DIFROMSI(.84,DA,"",XPDA);DEL^DIFROMSK(.84,"",%)
"ORD",9,.84,0)
DIALOG
"PGL",798.1,9,1,13)
PROTOCOL^*P101'X^ORD(101,^9;1^Q:$$VAEDT^RORDD(798.1,$G(DA))  S DIC("S")="S D=$G(^(0)) I $E($P(D,U),1,3)=""ROR"",$P(D,U,4)=""E""" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"PGL",798.1,21,1,21.01)
AUTOMATIC BACKPULL^*P799.6'^RORDATA(799.6,^21;1^S DIC("S")="I $P($G(^(0)),U,2)=1" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"PGL",798.128,0,2,.02)
LAB GROUP^R*P799.1'X^ROR(799.1,^0;2^S DIC("S")="S D=$G(^(0)) I $P(D,U,2)=3,$P(D,U,3)="_DA(1) D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"PGL",798.129,0,2,.02)
DRUG GROUP^R*P799.1'X^ROR(799.1,^0;2^S DIC("S")="S D=$G(^(0)) I $P(D,U,2)=4,$P(D,U,3)="_DA(1) D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"PGL",798.2,5,1,7)
CODING SYSTEM^*P80.4'^ICDS(^5;1^S DIC("S")="I $$FILE^ICDEX(+Y)=80!($$FILE^ICDEX(+Y)=80.1)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"PGL",799.51,0,2,.02)
REGISTRY^RP798.1'X^ROR(798.1,^0;2^Q:$$VAEDT^RORDD(799.51,$G(DA))
"PGL",799.51,0,3,.03)
DRUG GROUP^R*P799.1'X^ROR(799.1,^0;3^Q:$$VAEDT^RORDD(799.51,$G(DA))  S Y=$P($G(^ROR(799.51,DA,0)),U,2),DIC("S")="S D=$G(^(0)) I $P(D,U,2)=4"_$S(Y>0:",$P(D,U,3)="_Y,1:"") D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"PGL",799.51,0,4,.04)
VA GENERIC^RP50.6'X^PSNDF(50.6,^0;4^Q:$$VAEDT^RORDD(799.51,$G(DA))
"PKG",556,-1)
1^1
"PKG",556,0)
CLINICAL CASE REGISTRIES^ROR^CLINICAL CASE REGISTRIES
"PKG",556,20,0)
^9.402P^^
"PKG",556,22,0)
^9.49I^1^1
"PKG",556,22,1,0)
1.5^3060208^3060310^66481
"PKG",556,22,1,"PAH",1,0)
31^3171203^101120
"PKG",556,22,1,"PAH",1,1,0)
^^2^2^3171203
"PKG",556,22,1,"PAH",1,1,1,0)
The description of this build can be found in the National Patch Module 
"PKG",556,22,1,"PAH",1,1,2,0)
under ROR*1.5*31.
"PRE")
RORP031
"QUES","POSQ1",0)
N^0:10:0
"QUES","POSQ1","A")
Maximum number of registry update subtasks
"QUES","POSQ1","B")
5
"QUES","POSQ1","M")
D BLD^DIALOG(7980000.009,,,"DIR(""?"")","S")
"QUES","POSQ2",0)
Y
"QUES","POSQ2","A")
Suspend the post-install during the peak hours
"QUES","POSQ2","B")
NO
"QUES","POSQ2","M")
W ! D BLD^DIALOG(7980000.01,,,"DIR(""?"")","S")
"QUES","POSQ3",0)
D^::R
"QUES","POSQ3","A")
Suspension start time
"QUES","POSQ3","B")
7:00AM
"QUES","POSQ3","M")
W ! D POSQ3^RORP024(.DIR)
"QUES","POSQ4",0)
D
"QUES","POSQ4","A")
Suspension end time
"QUES","POSQ4","B")
6:00PM
"QUES","POSQ4","M")
W ! D POSQ4^RORP024(.DIR)
"QUES","POSQ5",0)
D^::FRX
"QUES","POSQ5","?")
The date/time entered must be at least 15 minutes in the future.
"QUES","POSQ5","A")
Date/Time to run the new registry initialize task
"QUES","POSQ5","M")
D POSQ5^RORP024(.DIR)
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
56
"RTN","RORP031")
0^60^B128693330^n/a
"RTN","RORP031",1,0)
RORP031 ;ALB/TK  ENV CK, PRE and POST INSTALL - PATCH 31 ; 04 Aug 2015  6:28 PM
"RTN","RORP031",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**31**;Feb 17, 2006;Build 62
"RTN","RORP031",3,0)
 ;
"RTN","RORP031",4,0)
 ;*****************************************************************************
"RTN","RORP031",5,0)
 ;*****************************************************************************
"RTN","RORP031",6,0)
 ;                       --- ROUTINE MODIFICATION LOG ---
"RTN","RORP031",7,0)
 ;  
"RTN","RORP031",8,0)
 ;PKG/PATCH    DATE       DEVELOPER    MODIFICATION
"RTN","RORP031",9,0)
 ;-----------  ---------  -----------  ----------------------------------------
"RTN","RORP031",10,0)
 ;ROR*1.5*31   MAY 2017   M FERRARESE  Added routine for env check, pre/post
"RTN","RORP031",11,0)
 ;                                     install          
"RTN","RORP031",12,0)
 ;******************************************************************************
"RTN","RORP031",13,0)
 ;******************************************************************************
"RTN","RORP031",14,0)
 ; 
"RTN","RORP031",15,0)
 ; SUPPORTED CALLS:
"RTN","RORP031",16,0)
 ;  RTN^%ZTLOAD   #10063
"RTN","RORP031",17,0)
 ;  STAT^%ZTLOAD  #10063
"RTN","RORP031",18,0)
 ;  BMES^XPDUTL   #10141
"RTN","RORP031",19,0)
 ;  OWNSKEY^XUSRB #3277 (supported)  
"RTN","RORP031",20,0)
 ;  MES^XPDUTL    #10141
"RTN","RORP031",21,0)
 ;  BLD^DIALOG    #2050
"RTN","RORP031",22,0)
 ;  UPDATE^DIE    #2053
"RTN","RORP031",23,0)
 ;  FMADD^XLFDT   #10103
"RTN","RORP031",24,0)
 ;  NOW^XLFDT     #10103
"RTN","RORP031",25,0)
 ;  FMTE^XLFDT    #10103
"RTN","RORP031",26,0)
 ;  ADD^XPAR      #2263
"RTN","RORP031",27,0)
 ;  DEL^XPAR      #2263
"RTN","RORP031",28,0)
 ;  CLEAN^DILF    #2054
"RTN","RORP031",29,0)
 ;
"RTN","RORP031",30,0)
ENV ;  Environment check
"RTN","RORP031",31,0)
 S XPDNOQUE=1 ; disable queuing
"RTN","RORP031",32,0)
 Q
"RTN","RORP031",33,0)
 ;
"RTN","RORP031",34,0)
PRE ; Patch pre-install
"RTN","RORP031",35,0)
 ; CHECK FOR ROR VA IRM KEY, ABORT IF USER DOES NOT POSSESS
"RTN","RORP031",36,0)
 N RORKEYOK
"RTN","RORP031",37,0)
 D BMES^XPDUTL("Verifying installing user has the ROR VA IRM security key")
"RTN","RORP031",38,0)
 D OWNSKEY^XUSRB(.RORKEYOK,"ROR VA IRM",DUZ)
"RTN","RORP031",39,0)
 I '$G(RORKEYOK(0)) D  Q
"RTN","RORP031",40,0)
 . S XPDABORT=1
"RTN","RORP031",41,0)
 . D BMES^XPDUTL("****** INSTALL ABORTED!!! ******")
"RTN","RORP031",42,0)
 . D BMES^XPDUTL("This patch can only be installed by a user who is assigned the ROR VA IRM key")
"RTN","RORP031",43,0)
 . D BMES^XPDUTL("Restart the installation again once the appropriate key has been assigned")
"RTN","RORP031",44,0)
 D BMES^XPDUTL("  User has the ROR VA IRM key - OK to install")
"RTN","RORP031",45,0)
 ;Q
"RTN","RORP031",46,0)
 ;
"RTN","RORP031",47,0)
 N RC,ZTSK,RORBUF,RORMES
"RTN","RORP031",48,0)
 ; Check for ROR INITIALIZE task running
"RTN","RORP031",49,0)
 D BMES^XPDUTL("   *** Checking to be sure ROR INITIALIZE task is not already running")
"RTN","RORP031",50,0)
 S RC=0
"RTN","RORP031",51,0)
 D RTN^%ZTLOAD("RORSET02","RORBUF")
"RTN","RORP031",52,0)
 S ZTSK="" F  S ZTSK=$O(RORBUF(ZTSK)) Q:ZTSK=""  D  I $G(ZTSK(1))=2 S RC=-1 Q
"RTN","RORP031",53,0)
 . D STAT^%ZTLOAD
"RTN","RORP031",54,0)
 ;--- Display error message if option is running
"RTN","RORP031",55,0)
 I RC<0  D  S XPDABORT=2 Q
"RTN","RORP031",56,0)
 . K RORMES
"RTN","RORP031",57,0)
 . D BMES^XPDUTL($$MSG^RORERR20(RC,,XPDNM))
"RTN","RORP031",58,0)
 . D BMES^XPDUTL("")
"RTN","RORP031",59,0)
 . S RORMES(1)="   >> ROR INITIALIZE task is already running.  Task # is "_ZTSK
"RTN","RORP031",60,0)
 . S RORMES(2)="      This task must complete or be terminated before the install can continue"
"RTN","RORP031",61,0)
 . S RORMES(3)="      Restart this patch install when this task is not running"
"RTN","RORP031",62,0)
 . S RORMES(4)=" "
"RTN","RORP031",63,0)
 . D MES^XPDUTL(.RORMES)
"RTN","RORP031",64,0)
 S RORPARM("DEVELOPER")=1
"RTN","RORP031",65,0)
 N RORI,REGIEN,RORREG,Z,X,Y,DIR
"RTN","RORP031",66,0)
 K ^XTMP("ROR_NO_INIT")  ; Will contain any pre-initialized registries not to be reinitialized
"RTN","RORP031",67,0)
 D XTMPHDR^RORUTL01("ROR_NO_INIT",7,"CCR REGISTRIES NOT TO BE RE-INITIALIZED")
"RTN","RORP031",68,0)
 F RORI=1:1 S RORREG=$P($P($T(@("NEWREG+"_RORI_"^RORP031")),";;",2),U) Q:RORREG=""  D  Q:$G(XPDABORT)
"RTN","RORP031",69,0)
 . S REGIEN=$$REGIEN^RORUTL02(RORREG)
"RTN","RORP031",70,0)
 . Q:REGIEN'>0  ; new registry doesn't yet exist
"RTN","RORP031",71,0)
 . ; Check if registry is already initiated (has a value in HDT field)
"RTN","RORP031",72,0)
 . S Z=$$GET1^DIQ(798.1,REGIEN_",",21.05,"I")
"RTN","RORP031",73,0)
 . I Z'="" D  Q
"RTN","RORP031",74,0)
 .. S DIR(0)="YA",DIR("A",1)="  >> New registry "_RORREG_"(ien #"_REGIEN_") has already completed initialization"
"RTN","RORP031",75,0)
 .. S DIR("A")="Do you want to rerun its initialization?: ",DIR("B")="NO"
"RTN","RORP031",76,0)
 .. W ! D ^DIR K DIR W !
"RTN","RORP031",77,0)
 .. I Y<0 S XPDABORT=2 K ^XTMP("ROR_NO_INIT") D BMES^XPDUTL("INSTALL ABORTED") Q
"RTN","RORP031",78,0)
 .. I Y'=1 S ^XTMP("ROR_NO_INIT",REGIEN)=""
"RTN","RORP031",79,0)
 Q
"RTN","RORP031",80,0)
 ;
"RTN","RORP031",81,0)
POST ; Patch post-install
"RTN","RORP031",82,0)
 N CT,RORI,RORREG,REGIEN,Z
"RTN","RORP031",83,0)
 N RORPARM
"RTN","RORP031",84,0)
 S RORPARM("DEVELOPER")=1
"RTN","RORP031",85,0)
 D BMES^XPDUTL("POST INSTALL START")
"RTN","RORP031",86,0)
 ;
"RTN","RORP031",87,0)
 D BMES^XPDUTL(">> Adding new AGE_RANGE panel to reports")
"RTN","RORP031",88,0)
 D UPDPANEL,UP799P1
"RTN","RORP031",89,0)
 D BMES^XPDUTL("   >> Step complete")
"RTN","RORP031",90,0)
 ;
"RTN","RORP031",91,0)
 D BMES^XPDUTL(">> Checking VA GENERIC drug file...")
"RTN","RORP031",92,0)
 D GENDRG
"RTN","RORP031",93,0)
 ;
"RTN","RORP031",94,0)
 D BMES^XPDUTL(">> Adding CPT and ICD-9 procedures to ROR ICD SEARCH file for new registries")
"RTN","RORP031",95,0)
 D UPDPROC
"RTN","RORP031",96,0)
 D BMES^XPDUTL("   >> Step complete")
"RTN","RORP031",97,0)
 ;
"RTN","RORP031",98,0)
 D BMES^XPDUTL(">> Updating List Items for new registries")
"RTN","RORP031",99,0)
 D UPDLIST
"RTN","RORP031",100,0)
 D BMES^XPDUTL("    >> Step complete")
"RTN","RORP031",101,0)
 ;
"RTN","RORP031",102,0)
 D BMES^XPDUTL(">> Initiating background job to set up registries added with this patch")
"RTN","RORP031",103,0)
 N RORKIDS,RORERR,CT,DIERR
"RTN","RORP031",104,0)
 S RORKIDS=1
"RTN","RORP031",105,0)
 F RORI=1:1 S RORREG=$P($P($T(@("NEWREG+"_RORI_"^RORP031")),";;",2),U) Q:RORREG=""  D
"RTN","RORP031",106,0)
 . S REGIEN=$$REGIEN^RORUTL02(RORREG)
"RTN","RORP031",107,0)
 . Q:REGIEN'>0
"RTN","RORP031",108,0)
 . I $D(^XTMP("ROR_NO_INIT",REGIEN)) D  Q
"RTN","RORP031",109,0)
 .. S RORERR(1)="   It appears new registry "_RORREG_"(ien #"_REGIEN_") has already been initialized"
"RTN","RORP031",110,0)
 .. S RORERR(2)="   You have chosen not to re-initialize this registry"
"RTN","RORP031",111,0)
 .. S RORERR(3)=" "
"RTN","RORP031",112,0)
 .. D MES^XPDUTL(.RORERR)
"RTN","RORP031",113,0)
 .. K RORERR
"RTN","RORP031",114,0)
 . ;
"RTN","RORP031",115,0)
 . K RORFDA,RORMSG,RORERR
"RTN","RORP031",116,0)
 . S RORFDA(798.1,REGIEN_",",1)=2850101
"RTN","RORP031",117,0)
 . S RORFDA(798.1,REGIEN_",",19.1)=""
"RTN","RORP031",118,0)
 . S RORFDA(798.1,REGIEN_",",21.05)=""
"RTN","RORP031",119,0)
 . D UPDATE^DIE(,"RORFDA",,"RORMSG")
"RTN","RORP031",120,0)
 . I $D(DIERR) D
"RTN","RORP031",121,0)
 .. K RORERR
"RTN","RORP031",122,0)
 .. M RORERR=RORMSG
"RTN","RORP031",123,0)
 .. D DBS^RORERR("RORMSG",-112,,,798.1,REGIEN)
"RTN","RORP031",124,0)
 .. M RORMSG=RORERR
"RTN","RORP031",125,0)
 .. K RORERR
"RTN","RORP031",126,0)
 .. S RORERR(1)="     New registry "_RORREG_"(ien #"_REGIEN_") encountered the following error"
"RTN","RORP031",127,0)
 .. S RORERR(2)="     and may not initialize correctly.  Please report this error to your CCR contact:"
"RTN","RORP031",128,0)
 .. S RORERR(3)=""
"RTN","RORP031",129,0)
 .. S Z=0,CT=3 F  S Z=$O(RORMSG("DIERR",1,"TEXT",Z)) Q:'Z  S CT=CT+1,RORERR(CT)=$J("",10)_$G(RORMSG("DIERR",1,"TEXT",Z))
"RTN","RORP031",130,0)
 .. S CT=CT+1,RORERR(CT)=" "
"RTN","RORP031",131,0)
 .. D MES^XPDUTL(.RORERR)
"RTN","RORP031",132,0)
 D ^RORSET02
"RTN","RORP031",133,0)
 K ^XTMP("ROR_NO_INIT")
"RTN","RORP031",134,0)
 D BMES^XPDUTL("   >> Step complete")
"RTN","RORP031",135,0)
 ;
"RTN","RORP031",136,0)
 D CLEAN^DILF
"RTN","RORP031",137,0)
 D BMES^XPDUTL("POST INSTALL COMPLETE")
"RTN","RORP031",138,0)
 Q
"RTN","RORP031",139,0)
 ;
"RTN","RORP031",140,0)
NEWREG ; List of new registries to initialize
"RTN","RORP031",141,0)
 ;;VA MOVEMENT DISORDERS
"RTN","RORP031",142,0)
 ;;VA ADRENAL ADENOMA
"RTN","RORP031",143,0)
 ;;
"RTN","RORP031",144,0)
 ;
"RTN","RORP031",145,0)
UPDPROC ; Adds ICD dx/procedure codes and CPT codes to the new registries in ROR ICD file
"RTN","RORP031",146,0)
 ; Delete if already there
"RTN","RORP031",147,0)
 N CT,I1,DA,DIK,X,Y,Z,RORDATA,RORFDA,RORI,RORPROC,RORREG,RORIEN,RORFDA1
"RTN","RORP031",148,0)
 F RORI="MOVEMENT DISORDERS","ADRENAL ADENOMA" S DIC="^ROR(798.5,",X="VA "_RORI,DIC(0)="" D ^DIC I Y>0 D
"RTN","RORP031",149,0)
 . S DIK="^ROR(798.5,",DA=+Y D ^DIK
"RTN","RORP031",150,0)
 F RORI=1:1 S RORDATA=$P($T(ICDPROC+RORI),";;",2) Q:RORDATA=""  D
"RTN","RORP031",151,0)
 . S RORREG=$P(RORDATA,U)
"RTN","RORP031",152,0)
 . I RORREG'="" D  Q
"RTN","RORP031",153,0)
 .. ; add new registry top level entry
"RTN","RORP031",154,0)
 .. D:$D(RORFDA) ADD7985(.RORFDA,RORIEN,$P($G(^ROR(798.1,+$G(RORIEN),0)),U)) ;Store 'previous registry' if RORFDA exists
"RTN","RORP031",155,0)
 .. K RORFDA1
"RTN","RORP031",156,0)
 .. S RORFDA1(798.5,"+1,",.01)=RORREG,RORIEN="",CT=0
"RTN","RORP031",157,0)
 .. D ADD7985(.RORFDA1,.RORIEN,RORREG)
"RTN","RORP031",158,0)
 .. S Z=+$O(RORIEN(0)),Z=$G(RORIEN(Z))
"RTN","RORP031",159,0)
 .. K RORIEN,RORFDA1 S RORIEN=Z
"RTN","RORP031",160,0)
 . I $P(RORDATA,U,2)'="" D  Q  ; Add ICD-codes to the entry
"RTN","RORP031",161,0)
 .. S RORPROC=$P(RORDATA,U,2)
"RTN","RORP031",162,0)
 .. F I1=1:1:$L(RORPROC,",") S X=$P(RORPROC,",",I1) I X'="" S CT=CT+1,RORFDA(798.52,"+"_CT_","_RORIEN_",",.01)=X
"RTN","RORP031",163,0)
 . I $P(RORDATA,U,3)'="" D  Q  ; Add ICPT codes to the entry
"RTN","RORP031",164,0)
 .. S RORPROC=$P(RORDATA,U,3)
"RTN","RORP031",165,0)
 .. F I1=1:1:$L(RORPROC,",") S X=$P(RORPROC,",",I1) I X'="" S CT=CT+1,RORFDA(798.53,"+"_CT_","_RORIEN_",",.01)=X
"RTN","RORP031",166,0)
 . I $P(RORDATA,U,4)'="" D  Q  ; Add ICD diagnosis codes to the entry
"RTN","RORP031",167,0)
 .. S RORPROC=$P(RORDATA,U,4)
"RTN","RORP031",168,0)
 .. F I1=1:1:$L(RORPROC,",") S X=$P(RORPROC,",",I1) I X'="" S CT=CT+1,RORFDA(798.51,"+"_CT_","_RORIEN_",",.01)=X
"RTN","RORP031",169,0)
 .. ;
"RTN","RORP031",170,0)
 I $D(RORFDA) D ADD7985(.RORFDA,RORIEN,RORREG)
"RTN","RORP031",171,0)
 D CLEAN^DILF
"RTN","RORP031",172,0)
 Q
"RTN","RORP031",173,0)
 ;
"RTN","RORP031",174,0)
ADD7985(RORFDA,RORIEN,RORREG) ; Adds procedures to the entries in the files
"RTN","RORP031",175,0)
 N RORMSG,DIERR
"RTN","RORP031",176,0)
 D UPDATE^DIE("E","RORFDA","RORIEN","RORMSG")
"RTN","RORP031",177,0)
 I $G(DIERR) D
"RTN","RORP031",178,0)
 . N Z,CT,RORERR
"RTN","RORP031",179,0)
 . M RORERR=RORMSG
"RTN","RORP031",180,0)
 . D DBS^RORERR("RORMSG",-112,,,798.5,RORREG)
"RTN","RORP031",181,0)
 . M RORMSG=RORERR
"RTN","RORP031",182,0)
 . K RORERR
"RTN","RORP031",183,0)
 . S RORERR(1)="     Adding procedures for new registry "_RORREG_" encountered the"
"RTN","RORP031",184,0)
 . S RORERR(2)="     following error.  Please report this error to your CCR contact:"
"RTN","RORP031",185,0)
 . S RORERR(3)=""
"RTN","RORP031",186,0)
 . S Z=0,CT=3 F  S Z=$O(RORMSG("DIERR",1,"TEXT",Z)) Q:'Z  S CT=CT+1,RORERR(CT)=$J("",10)_$G(RORMSG("DIERR",1,"TEXT",Z))
"RTN","RORP031",187,0)
 . S CT=CT+1,RORERR(CT)=" "
"RTN","RORP031",188,0)
 . D MES^XPDUTL(.RORERR)
"RTN","RORP031",189,0)
 Q
"RTN","RORP031",190,0)
 ;
"RTN","RORP031",191,0)
ICDPROC ; Registry name^PTF ICD Procedure codes, separated by commas^PTF CPT codes, separated by commas^ ICD DIAGNOSIS codes
"RTN","RORP031",192,0)
 ;;VA MOVEMENT DISORDERS
"RTN","RORP031",193,0)
 ;;^^^G20.,G21.0,G21.11,G21.19,G21.2,G21.3,G21.4,G21.8,G21.9,G23.0,G23.1,G23.2,G23.8,G23.9,G24.01,G24.02,G24.09,G24.1,G24.2,G24.3,G24.4,G24.5,G24.8,G24.9
"RTN","RORP031",194,0)
 ;;^^^G25.0,G25.1,G25.2,G25.3,G25.4,G25.5,G25.61,G25.69,G25.70,G25.71,G25.79,G25.81,G25.82,G25.83,G25.89,G25.9,G26.,G31.83,G10.,K11.7
"RTN","RORP031",195,0)
 ;;^^^331.82,332.0,332.1,333.0,333.1,333.4,333.5,333.6,333.72,333.7,333.79,333.85,333.94,334.3,781.0,781.2,781.3,527.7,333.81,333.82,333.83,333.2,333.90,333.91,333.3,307.20,307.22,307.23
"RTN","RORP031",196,0)
 ;;VA ADRENAL ADENOMA
"RTN","RORP031",197,0)
 ;;^^^225.3,227.0,255.8,255.9,D35.00,D35.01,D35.02,E27.0,E27.8,E27.9
"RTN","RORP031",198,0)
 Q
"RTN","RORP031",199,0)
 ;   
"RTN","RORP031",200,0)
 ; Sets the DIR array from the post-install question #3 (suspension start time)
"RTN","RORP031",201,0)
POSQ3(DIR) ;
"RTN","RORP031",202,0)
 K:$G(XPDQUES("POSQ2"))'=1 DIR
"RTN","RORP031",203,0)
 Q:'$D(DIR)
"RTN","RORP031",204,0)
 D BLD^DIALOG(7980000.011,,,"DIR(""?"")","S")
"RTN","RORP031",205,0)
 Q
"RTN","RORP031",206,0)
 ;
"RTN","RORP031",207,0)
 ; Update ROR LIST ITEM file (#799.1) for new registries
"RTN","RORP031",208,0)
UPDLIST  ;
"RTN","RORP031",209,0)
 N RORI,RORI1,RORREG,RORDATA,REGIEN,Z,CT,DIERR,RORFDA,RORMSG,RORERR
"RTN","RORP031",210,0)
 F RORI=1:1 S RORREG=$P($P($T(@("NEWREG+"_RORI_"^RORP031")),";;",2),U) Q:RORREG=""  D
"RTN","RORP031",211,0)
 . S REGIEN=$$REGIEN^RORUTL02(RORREG)
"RTN","RORP031",212,0)
 . I REGIEN>0 D
"RTN","RORP031",213,0)
 .. F RORI1=1:1 S RORDATA=$P($T(@("LISTITEM+"_RORI1_"^RORP031")),";;",2) Q:RORDATA=""  D
"RTN","RORP031",214,0)
 ... Q:$D(^ROR(799.1,"KEY",+$P(RORDATA,U,2),REGIEN,+$P(RORDATA,U,3)))  ; Entry already exists
"RTN","RORP031",215,0)
 ... K RORFDA,RORMSG,RORERR,DIERR
"RTN","RORP031",216,0)
 ... S RORFDA(799.1,"?+1,",.01)=$P(RORDATA,U)
"RTN","RORP031",217,0)
 ... S RORFDA(799.1,"?+1,",.02)=$P(RORDATA,U,2)
"RTN","RORP031",218,0)
 ... S RORFDA(799.1,"?+1,",.03)=REGIEN
"RTN","RORP031",219,0)
 ... S RORFDA(799.1,"?+1,",.04)=$P(RORDATA,U,3)
"RTN","RORP031",220,0)
 ... D UPDATE^DIE(,"RORFDA",,"RORMSG")
"RTN","RORP031",221,0)
 ... I $G(DIERR) D
"RTN","RORP031",222,0)
 .... K RORERR
"RTN","RORP031",223,0)
 .... S RORERR(1)="     New entry for "_RORREG_"(ien #"_REGIEN_") encountered the following error"
"RTN","RORP031",224,0)
 .... S RORERR(2)="     and was not added to the ROR LIST ITEM file."
"RTN","RORP031",225,0)
 .... S RORERR(3)="     (Data = "_RORDATA_")"
"RTN","RORP031",226,0)
 .... S RORERR(4)="     Please report this error to your CCR contact:"
"RTN","RORP031",227,0)
 .... S RORERR(5)=""
"RTN","RORP031",228,0)
 .... S Z=0,CT=5 F  S Z=$O(RORMSG("DIERR",1,"TEXT",Z)) Q:'Z  S CT=CT+1,RORERR(CT)=$J("",6)_$G(RORMSG("DIERR",1,"TEXT",Z))
"RTN","RORP031",229,0)
 .... S CT=CT+1,RORERR(CT)=" "
"RTN","RORP031",230,0)
 .... D MES^XPDUTL(.RORERR)
"RTN","RORP031",231,0)
 Q
"RTN","RORP031",232,0)
 ;
"RTN","RORP031",233,0)
LISTITEM ;  Entries to add to file 799.1  text^group^code
"RTN","RORP031",234,0)
 ;;eGFR by CKD-EPI^7^3
"RTN","RORP031",235,0)
 ;;eGFR by MDRD^7^2
"RTN","RORP031",236,0)
 ;;Creatinine clearance by Cockcroft-Gault^7^1
"RTN","RORP031",237,0)
 ;;FIB-4^6^4
"RTN","RORP031",238,0)
 ;;APRI^6^3
"RTN","RORP031",239,0)
 ;;MELD-Na^6^2
"RTN","RORP031",240,0)
 ;;MELD^6^1
"RTN","RORP031",241,0)
 ;;BMI^5^1
"RTN","RORP031",242,0)
 ;;Registry Lab^3^1
"RTN","RORP031",243,0)
 ;;
"RTN","RORP031",244,0)
 ;
"RTN","RORP031",245,0)
 ; Sets the DIR array from the post-install question #4  (suspension end time)
"RTN","RORP031",246,0)
POSQ4(DIR) ;
"RTN","RORP031",247,0)
 K:$G(XPDQUES("POSQ2"))'=1 DIR
"RTN","RORP031",248,0)
 Q:'$D(DIR)
"RTN","RORP031",249,0)
 S DIR("A")="Suspension end time"
"RTN","RORP031",250,0)
 ;  Make sure end time entered is later than end time start
"RTN","RORP031",251,0)
 S DIR(0)="D^::R^K:(Y#1)'>(XPDQUES(""POSQ3"")#1) X"
"RTN","RORP031",252,0)
 D BLD^DIALOG(7980000.012,,,"DIR(""?"")","S")
"RTN","RORP031",253,0)
 Q
"RTN","RORP031",254,0)
 ;
"RTN","RORP031",255,0)
 ; Updates the DIR array from the post-install question #5  (schedule time for ROR INITIALIZE task)
"RTN","RORP031",256,0)
POSQ5(DIR) ;
"RTN","RORP031",257,0)
 Q:'$D(DIR)
"RTN","RORP031",258,0)
 N ROREDT
"RTN","RORP031",259,0)
 ; Set earliest date to schedule to 15 minutes from 'NOW'
"RTN","RORP031",260,0)
 S ROREDT=$$FMADD^XLFDT($$NOW^XLFDT(),,,15)
"RTN","RORP031",261,0)
 ; Strip seconds
"RTN","RORP031",262,0)
 S ROREDT=$P(ROREDT,".",1)_"."_$E($P(ROREDT,".",2),1,4)
"RTN","RORP031",263,0)
 ;  Make sure future date/time is entered
"RTN","RORP031",264,0)
 S $P(DIR(0),U,3)=("K:Y<"_ROREDT_" X")
"RTN","RORP031",265,0)
 S DIR("B")=$$FMTE^XLFDT(ROREDT,2)
"RTN","RORP031",266,0)
 Q
"RTN","RORP031",267,0)
 ;
"RTN","RORP031",268,0)
UPDPANEL ; --- Add new Age Range panel #21 to all reports following the Birth Sex panel #23
"RTN","RORP031",269,0)
 N CT,DIERR,P1,P2,RORDATA,RORRPT,RORERR,RORFDA,RORMSG,X,Y,Z
"RTN","RORP031",270,0)
 S RORRPT=0 F  S RORRPT=$O(^ROR(799.34,RORRPT)) Q:'RORRPT  D
"RTN","RORP031",271,0)
 . ; Extract field #1 PARAMETER PANELS - Quit if ",21," already exists in the record.  Add ,21 after ,23
"RTN","RORP031",272,0)
 . S RORDATA=$$GET1^DIQ(799.34,RORRPT_",",1,"I")
"RTN","RORP031",273,0)
 . I RORDATA[",23,21" D  Q
"RTN","RORP031",274,0)
 .. D BMES^XPDUTL("   o New selection panel 21 (Age Range) already exists for report #"_RORRPT)
"RTN","RORP031",275,0)
 . K RORFDA,RORMSG
"RTN","RORP031",276,0)
 . S P1=$P(RORDATA,",23"),P2=$P(RORDATA,",23",2)
"RTN","RORP031",277,0)
 . S RORFDA(799.34,RORRPT_",",1)=P1_",23,21"_P2
"RTN","RORP031",278,0)
 . D UPDATE^DIE("","RORFDA",,"RORMSG")
"RTN","RORP031",279,0)
 . I $D(DIERR) D  Q
"RTN","RORP031",280,0)
 .. K RORERR
"RTN","RORP031",281,0)
 .. D DBS^RORERR("RORMSG",-112,,,799.34,RORRPT)
"RTN","RORP031",282,0)
 .. M RORMSG=RORERR
"RTN","RORP031",283,0)
 .. K RORERR
"RTN","RORP031",284,0)
 .. S RORERR(1)="     Update of report "_$P($G(^ROR(799.34,RORRPT,0)),U)_" with new panel"
"RTN","RORP031",285,0)
 .. S RORERR(2)="      encountered the following error.  Please report this error to your CCR contact:"
"RTN","RORP031",286,0)
 .. S RORERR(3)=""
"RTN","RORP031",287,0)
 .. S Z=0,CT=3 F  S Z=$O(RORMSG("DIERR",1,"TEXT",Z)) Q:'Z  S CT=CT+1,RORERR(CT)=$J("",10)_$G(RORMSG("DIERR",1,"TEXT",Z))
"RTN","RORP031",288,0)
 .. S CT=CT+1,RORERR(CT)=" "
"RTN","RORP031",289,0)
 .. D MES^XPDUTL(.RORERR)
"RTN","RORP031",290,0)
 Q
"RTN","RORP031",291,0)
 ;
"RTN","RORP031",292,0)
UP799P1 ; --- Rename 'HIV WB' entry of the VA HIV Registry in the ROR LIST ITEM file (#799.1) to 'HIV Confirm'
"RTN","RORP031",293,0)
 N RORDA,NODE,FDA
"RTN","RORP031",294,0)
 S RORDA=0 F  S RORDA=$O(^ROR(799.1,RORDA)) Q:'RORDA  S NODE=$G(^(RORDA,0)) I $P(NODE,"^")="HIV WB" D  Q
"RTN","RORP031",295,0)
 . I $$GET1^DIQ(799.1,RORDA,.01)]"" S FDA(799.1,RORDA_",",.01)="HIV Confirm" D FILE^DIE("","FDA")
"RTN","RORP031",296,0)
 Q
"RTN","RORP031",297,0)
 ;
"RTN","RORP031",298,0)
GENDRG ; --- Delete entry in ROR GENERIC DRUG with unresolved pointers
"RTN","RORP031",299,0)
 ; clean up 799.51 if pointers are bad
"RTN","RORP031",300,0)
 ;
"RTN","RORP031",301,0)
 N DIC,X,DIK,DA,Y
"RTN","RORP031",302,0)
 S DIC=799.51,DIC(0)="MNZ",X="SOFOSBUVIR/VELPATASVIR/VOXILAP" D ^DIC
"RTN","RORP031",303,0)
 Q:+$P(Y(0),U,4)>0
"RTN","RORP031",304,0)
 S DA=+Y,DIK="^ROR(799.51," D ^DIK
"RTN","RORP031",305,0)
 D BMES^XPDUTL("WARNING*** Missing entry in VA GENERIC file.")
"RTN","RORP031",306,0)
 Q
"RTN","RORP031",307,0)
 ;
"RTN","RORUTL02")
0^1^B58261524^B53382352
"RTN","RORUTL02",1,0)
RORUTL02 ;HCIOFO/SG - UTILITIES  ;8/25/05 10:20am
"RTN","RORUTL02",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**21,27,31**;Feb 17, 2006;Build 62
"RTN","RORUTL02",3,0)
 ;
"RTN","RORUTL02",4,0)
 ;******************************************************************************
"RTN","RORUTL02",5,0)
 ;******************************************************************************
"RTN","RORUTL02",6,0)
 ;                 --- ROUTINE MODIFICATION LOG ---
"RTN","RORUTL02",7,0)
 ;        
"RTN","RORUTL02",8,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORUTL02",9,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","RORUTL02",10,0)
 ;ROR*1.5*27   FEB 2015    T KOPP       Changed LOCKREG entry point to loop thru
"RTN","RORUTL02",11,0)
 ;                                      registries to lock only 15 at a time to
"RTN","RORUTL02",12,0)
 ;                                      prevent maxstring errors when lock
"RTN","RORUTL02",13,0)
 ;                                      command is executed.
"RTN","RORUTL02",14,0)
 ;ROR*1.5*31   MAY 2017    M FERRARESE  Adding PACT and PCP as additional identifiers.
"RTN","RORUTL02",15,0)
 ;******************************************************************************
"RTN","RORUTL02",16,0)
 ;
"RTN","RORUTL02",17,0)
 ; This routine uses the following IAs:
"RTN","RORUTL02",18,0)
 ;
"RTN","RORUTL02",19,0)
 ; #2701         $$GETICN^MPIF001 Gets ICN (supported)
"RTN","RORUTL02",20,0)
 ;               $$IFLOCAL^MPIF001 (checks for local ICN) (supported)
"RTN","RORUTL02",21,0)
 ; #3556         $$GCPR^LA7QRY
"RTN","RORUTL02",22,0)
 ; #3557         Access to the field .01 and x-ref "B"
"RTN","RORUTL02",23,0)
 ;               of the file 95.3
"RTN","RORUTL02",24,0)
 ; #3646         $$EMPL^DGSEC4
"RTN","RORUTL02",25,0)
 ; #10035        Access to the field #.09 of the file #2
"RTN","RORUTL02",26,0)
 ;
"RTN","RORUTL02",27,0)
 Q
"RTN","RORUTL02",28,0)
 ;
"RTN","RORUTL02",29,0)
 ;***** REMOVES THE INACTIVE REGISTRIES FROM THE LIST
"RTN","RORUTL02",30,0)
 ;
"RTN","RORUTL02",31,0)
 ; .REGLST(      A list of registry names (as subscripts)
"RTN","RORUTL02",32,0)
 ;   RegName)    Registry IEN (output)
"RTN","RORUTL02",33,0)
 ;
"RTN","RORUTL02",34,0)
 ; Return values:
"RTN","RORUTL02",35,0)
 ;       <0  Error code
"RTN","RORUTL02",36,0)
 ;        0  Ok
"RTN","RORUTL02",37,0)
 ;
"RTN","RORUTL02",38,0)
 ; This function removes names of those registries that are
"RTN","RORUTL02",39,0)
 ; inactive or cannot be updated for any other reasons from
"RTN","RORUTL02",40,0)
 ; the list. It also associates registry IENs with the names
"RTN","RORUTL02",41,0)
 ; of registries remaining on the list.
"RTN","RORUTL02",42,0)
 ;
"RTN","RORUTL02",43,0)
 ; Moreover, it records corresponding messages about skipped
"RTN","RORUTL02",44,0)
 ; registries to the current open log.
"RTN","RORUTL02",45,0)
 ;
"RTN","RORUTL02",46,0)
ARLST(REGLST) ;
"RTN","RORUTL02",47,0)
 N INFO,RC,REGIEN,REGNAME,RORBUF,TMP  K DSTLST
"RTN","RORUTL02",48,0)
 S REGNAME="",RC=0
"RTN","RORUTL02",49,0)
 F  S REGNAME=$O(REGLST(REGNAME))  Q:REGNAME=""  D  Q:RC<0
"RTN","RORUTL02",50,0)
 . S REGIEN=$$REGIEN(REGNAME,"@;11I;21.05I",.RORBUF)
"RTN","RORUTL02",51,0)
 . ;--- Cannot find (or load) the registry parameters
"RTN","RORUTL02",52,0)
 . I REGIEN'>0  D  Q
"RTN","RORUTL02",53,0)
 . . D ERROR^RORERR(REGIEN,,REGNAME)
"RTN","RORUTL02",54,0)
 . . K REGLST(REGNAME)
"RTN","RORUTL02",55,0)
 . ;--- Check if the registry is marked as 'inactive'
"RTN","RORUTL02",56,0)
 . I $G(RORBUF("DILIST","ID",1,11))  D  Q
"RTN","RORUTL02",57,0)
 . . D ERROR^RORERR(-48,,,,REGNAME)
"RTN","RORUTL02",58,0)
 . . K REGLST(REGNAME)
"RTN","RORUTL02",59,0)
 . ;--- Check if the registry has not been populated
"RTN","RORUTL02",60,0)
 . I '$G(RORBUF("DILIST","ID",1,21.05)),'$G(RORPARM("SETUP"))  D  Q
"RTN","RORUTL02",61,0)
 . . D TEXT^RORTXT(7980000.02,.INFO)
"RTN","RORUTL02",62,0)
 . . D ERROR^RORERR(-103,,.INFO,,REGNAME)
"RTN","RORUTL02",63,0)
 . . K INFO,REGLST(REGNAME)
"RTN","RORUTL02",64,0)
 . ;--- Store the registry IEN
"RTN","RORUTL02",65,0)
 . S REGLST(REGNAME)=REGIEN
"RTN","RORUTL02",66,0)
 Q RC
"RTN","RORUTL02",67,0)
 ;
"RTN","RORUTL02",68,0)
 ;***** RETURNS A FULL NATIONAL ICN OF THE PATIENT
"RTN","RORUTL02",69,0)
 ;
"RTN","RORUTL02",70,0)
 ; PTIEN         Patient IEN
"RTN","RORUTL02",71,0)
 ;
"RTN","RORUTL02",72,0)
 ; Return Values:
"RTN","RORUTL02",73,0)
 ;       <0  Error code
"RTN","RORUTL02",74,0)
 ;       ""  ICN has not been assigned or ICN is a local ICN
"RTN","RORUTL02",75,0)
 ;       >0  Patient National ICN
"RTN","RORUTL02",76,0)
 ;
"RTN","RORUTL02",77,0)
ICN(PTIEN) ;
"RTN","RORUTL02",78,0)
 N ICN,L,TMP
"RTN","RORUTL02",79,0)
 I $$IFLOCAL^MPIF001(PTIEN) Q ""
"RTN","RORUTL02",80,0)
 S ICN=$$GETICN^MPIF001(PTIEN)
"RTN","RORUTL02",81,0)
 I ICN'>0  D  Q ""
"RTN","RORUTL02",82,0)
 . S TMP=$$ERROR^RORERR(-57,,$P(ICN,U,2),PTIEN,+ICN,"$$GETICN^MPIF001")
"RTN","RORUTL02",83,0)
 ;--- Validate the checksum (just in case ;-)
"RTN","RORUTL02",84,0)
 S L=$L($P(ICN,"V",2))
"RTN","RORUTL02",85,0)
 Q $S(L<6:$P(ICN,"V")_"V"_$E("000000",1,6-L)_$P(ICN,"V",2),1:ICN)
"RTN","RORUTL02",86,0)
 ;
"RTN","RORUTL02",87,0)
PACT(DFN) ;returns ien & name of pc team PATCH 30
"RTN","RORUTL02",88,0)
 ; DFN - pointer to patient file
"RTN","RORUTL02",89,0)
 ; Date of interest (Default=DT)
"RTN","RORUTL02",90,0)
 ;
"RTN","RORUTL02",91,0)
 Q $P($$OUTPTTM^SDUTL3(DFN,DT),U,2)
"RTN","RORUTL02",92,0)
 ;
"RTN","RORUTL02",93,0)
PCP(DFN)  ;returns ien & name of pract filling pc position PATCH 30
"RTN","RORUTL02",94,0)
 ; DFN - pointer to patient file
"RTN","RORUTL02",95,0)
 ; DATE - date of interest
"RTN","RORUTL02",96,0)
 ; PCROLE - Practitioner Position where '1' = PC provider         ;                                      '2' = PC attending 
"RTN","RORUTL02",97,0)
 ;                                      '3' = PC associate provider
"RTN","RORUTL02",98,0)
 ;
"RTN","RORUTL02",99,0)
 ; returns (ien^name), or "" if none or -1 if error
"RTN","RORUTL02",100,0)
 ;
"RTN","RORUTL02",101,0)
 Q $P($$OUTPTPR^SDUTL3(DFN,DT,1),"^",2)
"RTN","RORUTL02",102,0)
 ;
"RTN","RORUTL02",103,0)
 ;***** LOADS THE LAB RESULTS
"RTN","RORUTL02",104,0)
 ;
"RTN","RORUTL02",105,0)
 ; PTIEN         Patient IEN
"RTN","RORUTL02",106,0)
 ;
"RTN","RORUTL02",107,0)
 ; SDT           Start date of the results
"RTN","RORUTL02",108,0)
 ; EDT           End date of the results
"RTN","RORUTL02",109,0)
 ;
"RTN","RORUTL02",110,0)
 ; [ROR8DST]     Closed root of the destination array
"RTN","RORUTL02",111,0)
 ;               (the ^TMP("RORTMP",$J) node, by default)
"RTN","RORUTL02",112,0)
 ;
"RTN","RORUTL02",113,0)
 ; Return values:
"RTN","RORUTL02",114,0)
 ;       <0  Error code
"RTN","RORUTL02",115,0)
 ;        0  Ok
"RTN","RORUTL02",116,0)
 ;
"RTN","RORUTL02",117,0)
LABRSLTS(PTIEN,SDT,EDT,ROR8DST) ;
"RTN","RORUTL02",118,0)
 N H7CH,RC,RORMSG,TMP
"RTN","RORUTL02",119,0)
 S:$G(ROR8DST)="" ROR8DST=$NA(^TMP("RORTMP",$J))
"RTN","RORUTL02",120,0)
 K @ROR8DST
"RTN","RORUTL02",121,0)
 I $D(RORLRC)<10  Q:$G(RORLRC)="" 0
"RTN","RORUTL02",122,0)
 ;--- Get the Patient ID (ICN or SSN)
"RTN","RORUTL02",123,0)
 S PTID=$$PTID(PTIEN)  Q:PTID<0 PTID
"RTN","RORUTL02",124,0)
 ;--- Get the Lab data
"RTN","RORUTL02",125,0)
 S H7CH=$G(RORHL("FS"))_$G(RORHL("ECH"))
"RTN","RORUTL02",126,0)
 S RC=$$GCPR^LA7QRY(PTID,SDT,EDT,.RORLRC,"*",.RORMSG,ROR8DST,H7CH)
"RTN","RORUTL02",127,0)
 I RC="",$D(RORMSG)>1  D
"RTN","RORUTL02",128,0)
 . N ERR,I,LST
"RTN","RORUTL02",129,0)
 . S (ERR,LST)=""
"RTN","RORUTL02",130,0)
 . F I=1:1  S ERR=$O(RORMSG(ERR))  Q:ERR=""  D
"RTN","RORUTL02",131,0)
 . . S LST=LST_","_ERR,TMP=RORMSG(ERR)
"RTN","RORUTL02",132,0)
 . . K RORMSG(ERR)  S RORMSG(I)=TMP
"RTN","RORUTL02",133,0)
 . S LST=$P(LST,",",2,999)  Q:(LST=3)!(LST=99)
"RTN","RORUTL02",134,0)
 . S RC=$$ERROR^RORERR(-27,,.RORMSG,PTIEN)
"RTN","RORUTL02",135,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORUTL02",136,0)
 ;
"RTN","RORUTL02",137,0)
 ;***** RETURNS THE LOINC CODE WITH THE CONTROL DIGIT
"RTN","RORUTL02",138,0)
 ;
"RTN","RORUTL02",139,0)
 ; LNCODE        LOINC code
"RTN","RORUTL02",140,0)
 ;
"RTN","RORUTL02",141,0)
 ; Besides adding a control digit to the LOINC code, the function
"RTN","RORUTL02",142,0)
 ; checks the code against the LAB LOINC file (#95.3).
"RTN","RORUTL02",143,0)
 ;
"RTN","RORUTL02",144,0)
 ; Return values:
"RTN","RORUTL02",145,0)
 ;       <0  Error code
"RTN","RORUTL02",146,0)
 ;       >0  LOINC code with the control digit
"RTN","RORUTL02",147,0)
 ;
"RTN","RORUTL02",148,0)
LNCODE(LNCODE) ;
"RTN","RORUTL02",149,0)
 N RC,RORBUF,RORMSG
"RTN","RORUTL02",150,0)
 D FIND^DIC(95.3,,"@;.01E","X",$P(LNCODE,"-"),2,"B",,,"RORBUF","RORMSG")
"RTN","RORUTL02",151,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,95.3)
"RTN","RORUTL02",152,0)
 I $G(RORBUF("DILIST",0))<1  D  Q RC ; Non-existent code
"RTN","RORUTL02",153,0)
 . S RC=$$ERROR^RORERR(-29,,,,LNCODE)
"RTN","RORUTL02",154,0)
 I $G(RORBUF("DILIST",0))>1  D  Q RC ; Duplicate records
"RTN","RORUTL02",155,0)
 . S RC=$$ERROR^RORERR(-30,,,,LNCODE)
"RTN","RORUTL02",156,0)
 Q RORBUF("DILIST","ID",1,.01)
"RTN","RORUTL02",157,0)
 ;
"RTN","RORUTL02",158,0)
 ;***** LOCK/UNLOCK REGISTRIES BEING PROCESSED
"RTN","RORUTL02",159,0)
 ;
"RTN","RORUTL02",160,0)
 ; .REGLST       Reference to a local array containing registry names 
"RTN","RORUTL02",161,0)
 ;               as subscripts and optional registry IENs as values
"RTN","RORUTL02",162,0)
 ; [MODE]        0 - Unlock (default), 1 - Lock
"RTN","RORUTL02",163,0)
 ; [TO]          LOCK timeout (3 sec by defualt)
"RTN","RORUTL02",164,0)
 ; [NAME]        Name of the process/task
"RTN","RORUTL02",165,0)
 ;
"RTN","RORUTL02",166,0)
 ; Return Values:
"RTN","RORUTL02",167,0)
 ;       <0  Error code
"RTN","RORUTL02",168,0)
 ;        0  Some of the registries has been locked by another job
"RTN","RORUTL02",169,0)
 ;        1  Ok
"RTN","RORUTL02",170,0)
 ;
"RTN","RORUTL02",171,0)
LOCKREG(REGLST,MODE,TO,NAME) ;
"RTN","RORUTL02",172,0)
 Q:$D(REGLST)<10 1
"RTN","RORUTL02",173,0)
 N LOCKLST,RORLIST,RC,REGIEN,REGNAME
"RTN","RORUTL02",174,0)
 N CT,FAILS,Q,Q0,Z
"RTN","RORUTL02",175,0)
 ; RORLIST = 0 if less than 15 entries to lock
"RTN","RORUTL02",176,0)
 ;         = 1 if 15 or more entries to lock
"RTN","RORUTL02",177,0)
 ;        (n,x,y) = the array in LOCKLST(x,y) at that point
"RTN","RORUTL02",178,0)
 ;                  (where n = the # identifying the set of 15
"RTN","RORUTL02",179,0)
 ;                   registries being locked at one time)
"RTN","RORUTL02",180,0)
 ; FAILS = <0 or 1 ... lock failed     = 0 ... lock was successful
"RTN","RORUTL02",181,0)
 S REGNAME="",CT=0,RORLIST=0
"RTN","RORUTL02",182,0)
 F  S REGNAME=$O(REGLST(REGNAME))  Q:REGNAME=""  D  Q:REGIEN<0
"RTN","RORUTL02",183,0)
 . S REGIEN=+$G(REGLST(REGNAME))
"RTN","RORUTL02",184,0)
 . I REGIEN'>0  S REGIEN=$$REGIEN^RORUTL02(REGNAME)  Q:REGIEN'>0
"RTN","RORUTL02",185,0)
 . S CT=CT+1
"RTN","RORUTL02",186,0)
 . S LOCKLST(798.1,REGIEN_",")=""
"RTN","RORUTL02",187,0)
 . I '(CT#15) D  ; Split the locks into smaller chunks every 15 entries
"RTN","RORUTL02",188,0)
 .. M RORLIST(CT/15)=LOCKLST S RORLIST=1
"RTN","RORUTL02",189,0)
 .. K LOCKLST
"RTN","RORUTL02",190,0)
 Q:$G(REGIEN)<0 REGIEN
"RTN","RORUTL02",191,0)
 I RORLIST,$O(LOCKLST(""))'="" M RORLIST((CT/15\1)+1)=LOCKLST K LOCKLST
"RTN","RORUTL02",192,0)
 Q:$D(LOCKLST)<10&'$O(RORLIST(0)) 1
"RTN","RORUTL02",193,0)
 I $G(MODE) S RC=0 D
"RTN","RORUTL02",194,0)
 . I 'RORLIST S RC=$$LOCK^RORLOCK(.LOCKLST,,,+$G(TO,3),$G(NAME)) Q
"RTN","RORUTL02",195,0)
 . F Q=1:1 Q:'$D(RORLIST(Q))!RC  D
"RTN","RORUTL02",196,0)
 .. K LOCKLST M LOCKLST=RORLIST(Q)
"RTN","RORUTL02",197,0)
 .. S FAILS=$$LOCK^RORLOCK(.LOCKLST,,,+$G(TO,3),$G(NAME)),RC=FAILS
"RTN","RORUTL02",198,0)
 .. ; If lock fails for at least one set of nodes [=1 or <0] - unlock previous locks
"RTN","RORUTL02",199,0)
 .. I FAILS D:Q>1
"RTN","RORUTL02",200,0)
 ... F Q0=1:1:Q-1 K LOCKLST M LOCKLST=RORLIST(Q0) S Z=$$UNLOCK^RORLOCK(.LOCKLST)
"RTN","RORUTL02",201,0)
 E  D
"RTN","RORUTL02",202,0)
 . I 'RORLIST S RC=$$UNLOCK^RORLOCK(.LOCKLST) Q
"RTN","RORUTL02",203,0)
 . S RC=0
"RTN","RORUTL02",204,0)
 . F Q=1:1 K LOCKLST Q:'$D(RORLIST(Q))  D
"RTN","RORUTL02",205,0)
 .. M LOCKLST=RORLIST(Q) S FAILS=$$UNLOCK^RORLOCK(.LOCKLST)
"RTN","RORUTL02",206,0)
 .. S:FAILS RC=FAILS
"RTN","RORUTL02",207,0)
 Q $S('RC:1,RC<0:RC,1:0)
"RTN","RORUTL02",208,0)
 ;
"RTN","RORUTL02",209,0)
 ;***** RETURNS A PATIENT ID (ICN OR SSN)
"RTN","RORUTL02",210,0)
 ;
"RTN","RORUTL02",211,0)
 ; PTIEN         Patient IEN
"RTN","RORUTL02",212,0)
 ;
"RTN","RORUTL02",213,0)
 ; Return Values:
"RTN","RORUTL02",214,0)
 ;       <0  Error code
"RTN","RORUTL02",215,0)
 ;       ""  Neither ICN nor SSN has been assigned
"RTN","RORUTL02",216,0)
 ;       >0  Patient ICN (or SSN if ICN is not available)
"RTN","RORUTL02",217,0)
 ;
"RTN","RORUTL02",218,0)
PTID(PTIEN) ;
"RTN","RORUTL02",219,0)
 N L,PTID,RC,RORMSG
"RTN","RORUTL02",220,0)
 S PTID=$$GETICN^MPIF001(PTIEN)
"RTN","RORUTL02",221,0)
 I PTID>0  D  Q PTID
"RTN","RORUTL02",222,0)
 . ;--- Validate the checksum (just in case ;-)
"RTN","RORUTL02",223,0)
 . S L=$L($P(PTID,"V",2))  Q:L'<6
"RTN","RORUTL02",224,0)
 . ;S RC=$$ERROR^RORERR(-59,,,PTIEN)
"RTN","RORUTL02",225,0)
 . S $P(PTID,"V",2)=$E("000000",1,6-L)_$P(PTID,"V",2)
"RTN","RORUTL02",226,0)
 ;--- Get SSN if ICN is not available
"RTN","RORUTL02",227,0)
 S PTID=$$GET1^DIQ(2,PTIEN_",",.09,,,"RORMSG")
"RTN","RORUTL02",228,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,PTIEN,2)
"RTN","RORUTL02",229,0)
 Q PTID
"RTN","RORUTL02",230,0)
 ;
"RTN","RORUTL02",231,0)
 ;***** RETURNS IEN OF THE REGISTRY PARAMETERS
"RTN","RORUTL02",232,0)
 ;
"RTN","RORUTL02",233,0)
 ; REGNAME       Name of the registry
"RTN","RORUTL02",234,0)
 ; [FIELDS]      List of fields (separated by semicolons) to load
"RTN","RORUTL02",235,0)
 ; [.RORTRGT]    Reference to a local variable where field values will
"RTN","RORUTL02",236,0)
 ;               be stored by the FIND^DIC call
"RTN","RORUTL02",237,0)
 ;
"RTN","RORUTL02",238,0)
 ; Return Values:
"RTN","RORUTL02",239,0)
 ;       <0  Error code
"RTN","RORUTL02",240,0)
 ;       >0  Registry parameters IEN
"RTN","RORUTL02",241,0)
 ;
"RTN","RORUTL02",242,0)
REGIEN(REGNAME,FIELDS,RORTRGT) ;
"RTN","RORUTL02",243,0)
 N RC,REGIEN,RORMSG  K RORTRGT
"RTN","RORUTL02",244,0)
 D FIND^DIC(798.1,,"@;"_$G(FIELDS),"UX",REGNAME,2,"B",,,"RORTRGT","RORMSG")
"RTN","RORUTL02",245,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,798.1)
"RTN","RORUTL02",246,0)
 S RC=+$G(RORTRGT("DILIST",0))
"RTN","RORUTL02",247,0)
 Q $S(RC<1:-1,RC>1:-2,1:+RORTRGT("DILIST",2,1))
"RTN","RORUTL02",248,0)
 ;
"RTN","RORUTL02",249,0)
 ;***** RETURNS NUMBER OF RECORDS IN THE REGISTRY
"RTN","RORUTL02",250,0)
 ;
"RTN","RORUTL02",251,0)
 ; REGIEN        Registry IEN
"RTN","RORUTL02",252,0)
 ; [.LOWIEN]     The smallest IEN will be returned via this parameter
"RTN","RORUTL02",253,0)
 ; [.HIGHIEN]    The biggest IEN will be returned via this parameter
"RTN","RORUTL02",254,0)
 ;
"RTN","RORUTL02",255,0)
 ; Return Values:
"RTN","RORUTL02",256,0)
 ;       <0  Error code
"RTN","RORUTL02",257,0)
 ;        0  The registry is empty
"RTN","RORUTL02",258,0)
 ;       >0  Number of records in the registry
"RTN","RORUTL02",259,0)
 ;
"RTN","RORUTL02",260,0)
REGSIZE(REGIEN,LOWIEN,HIGHIEN) ;
"RTN","RORUTL02",261,0)
 N I,NODE,NRE,RC,RORFDA,RORMSG
"RTN","RORUTL02",262,0)
 S NODE=$NA(^RORDATA(798,"AC",REGIEN))
"RTN","RORUTL02",263,0)
 S LOWIEN=$O(@NODE@(""))
"RTN","RORUTL02",264,0)
 S HIGHIEN=$O(@NODE@(""),-1)
"RTN","RORUTL02",265,0)
 ;--- Get number of records from the parameters
"RTN","RORUTL02",266,0)
 S NRE=$$GET1^DIQ(798.1,REGIEN_",",19.1,,,"RORMSG")
"RTN","RORUTL02",267,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,798.1,REGIEN)
"RTN","RORUTL02",268,0)
 Q:NRE>0 NRE
"RTN","RORUTL02",269,0)
 ;--- Count the records of the registry
"RTN","RORUTL02",270,0)
 S I="",NRE=0
"RTN","RORUTL02",271,0)
 F  S I=$O(@NODE@(I))  Q:I=""  S NRE=NRE+1
"RTN","RORUTL02",272,0)
 ;--- Store the value in the parameters
"RTN","RORUTL02",273,0)
 S RORFDA(798.1,REGIEN_",",19.1)=NRE
"RTN","RORUTL02",274,0)
 D FILE^DIE("K","RORFDA","RORMSG")
"RTN","RORUTL02",275,0)
 Q NRE
"RTN","RORUTL02",276,0)
 ;
"RTN","RORUTL02",277,0)
 ;***** CHECKS IF AN EMPLOYEE SHOULD BE SKIPPED
"RTN","RORUTL02",278,0)
 ;
"RTN","RORUTL02",279,0)
 ; PTIEN         Patient IEN
"RTN","RORUTL02",280,0)
 ;
"RTN","RORUTL02",281,0)
 ; [.]REGIEN     Registry IEN
"RTN","RORUTL02",282,0)
 ;
"RTN","RORUTL02",283,0)
 ;               If you are going to call this function for several
"RTN","RORUTL02",284,0)
 ;               patients in a row (in a cycle), you can pass the
"RTN","RORUTL02",285,0)
 ;               second parameter by reference. This will eliminate
"RTN","RORUTL02",286,0)
 ;               repetitive access to the registry parameters (the
"RTN","RORUTL02",287,0)
 ;               REGIEN("SE") node will be used as a "cache" for the
"RTN","RORUTL02",288,0)
 ;               value of the EXCLUDE EMPLOYEES field).
"RTN","RORUTL02",289,0)
 ;
"RTN","RORUTL02",290,0)
 ; Return Values:
"RTN","RORUTL02",291,0)
 ;        0  Patient can be added to the registry
"RTN","RORUTL02",292,0)
 ;        1  Patient should be skipped
"RTN","RORUTL02",293,0)
 ;
"RTN","RORUTL02",294,0)
 ; The function checks if the patient is an employee and if he/she
"RTN","RORUTL02",295,0)
 ; can be added to the registry (according to the value of the
"RTN","RORUTL02",296,0)
 ; EXCLUDE EMPLOYEES field of the ROR REGISTRY PARAMETERS file).
"RTN","RORUTL02",297,0)
 ;
"RTN","RORUTL02",298,0)
SKIPEMPL(PTIEN,REGIEN) ;
"RTN","RORUTL02",299,0)
 Q:'$$EMPL^DGSEC4(PTIEN,"P") 0
"RTN","RORUTL02",300,0)
 S:'$D(REGIEN("SE")) REGIEN("SE")=+$P($G(^ROR(798.1,+REGIEN,0)),U,10)
"RTN","RORUTL02",301,0)
 Q +REGIEN("SE")
"RTN","RORUTL02",302,0)
 ;
"RTN","RORUTL02",303,0)
 ;***** RETURNS IEN OF THE SELECTION RULE
"RTN","RORUTL02",304,0)
 ;
"RTN","RORUTL02",305,0)
 ; RULENAME      Name of the selection rule
"RTN","RORUTL02",306,0)
 ; [FIELDS]      List of fields (separated by semicolons) to load
"RTN","RORUTL02",307,0)
 ; [.RORTRGT]    Reference to a local variable where field values will
"RTN","RORUTL02",308,0)
 ;               be stored by the FIND^DIC call.
"RTN","RORUTL02",309,0)
 ;
"RTN","RORUTL02",310,0)
 ; Return Values:
"RTN","RORUTL02",311,0)
 ;       <0  Error code
"RTN","RORUTL02",312,0)
 ;       >0  Selection rule IEN
"RTN","RORUTL02",313,0)
 ;
"RTN","RORUTL02",314,0)
SRLIEN(RULENAME,FIELDS,RORTRGT) ;
"RTN","RORUTL02",315,0)
 N RC,RULEIEN,RORMSG  K RORTRGT
"RTN","RORUTL02",316,0)
 D FIND^DIC(798.2,,"@;"_$G(FIELDS),"X",RULENAME,2,"B",,,"RORTRGT","RORMSG")
"RTN","RORUTL02",317,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,798.2)
"RTN","RORUTL02",318,0)
 S RC=+$G(RORTRGT("DILIST",0))
"RTN","RORUTL02",319,0)
 Q $S(RC<1:-3,RC>1:-4,1:+RORTRGT("DILIST",2,1))
"RTN","RORUTL11")
0^57^B4071769^B4666039
"RTN","RORUTL11",1,0)
RORUTL11 ;HCIOFO/SG - ACCESS AND SECURITY UTILITIES ; 03 Dec 2015  1:56 PM
"RTN","RORUTL11",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**13,14,15,17,18,20,19,21,22,24,27,25,26,28,29,30,31**;Feb 17, 2006;Build 62
"RTN","RORUTL11",3,0)
 ;
"RTN","RORUTL11",4,0)
 ;******************************************************************************
"RTN","RORUTL11",5,0)
 ;******************************************************************************
"RTN","RORUTL11",6,0)
 ;                 --- ROUTINE MODIFICATION LOG ---
"RTN","RORUTL11",7,0)
 ;        
"RTN","RORUTL11",8,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORUTL11",9,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","RORUTL11",10,0)
 ;ROR*1.5*13   DEC  2010   A SAUNDERS   Added tag VERSRV to return an associated
"RTN","RORUTL11",11,0)
 ;                                      version to the GUI during RPC call ROR
"RTN","RORUTL11",12,0)
 ;                                      GET M VERSION
"RTN","RORUTL11",13,0)
 ;ROR*1.5*14   APR  2011   A SAUNDERS   Updated version in tag VERSRV
"RTN","RORUTL11",14,0)
 ;ROR*1.5*15   JUN 2011    C RAY        Updated version
"RTN","RORUTL11",15,0)
 ;ROR*1.5*17   DEC 2011    C RAY        Updated version 
"RTN","RORUTL11",16,0)
 ;ROR*1.5*18   MAY 2012    C RAY        Updated version 
"RTN","RORUTL11",17,0)
 ;ROR*1.5*20   DEC 2012    C RAY        Updated version
"RTN","RORUTL11",18,0)
 ;ROR*1.5*19   APR 2012    K GUPTA      Updated version                            
"RTN","RORUTL11",19,0)
 ;ROR*1.5*21   AUG 2013    T KOPP       Updated version
"RTN","RORUTL11",20,0)
 ;ROR*1.5*22   FEB 2014    T KOPP       Updated version 
"RTN","RORUTL11",21,0)
 ;ROR*1.5*24   DEC 2014    T KOPP       Updated version
"RTN","RORUTL11",22,0)
 ;ROR*1.5*27   FEB 2015    T KOPP       Updated version
"RTN","RORUTL11",23,0)
 ;ROR*1.5*25   MAR 2015    T KOPP       Updated version                  
"RTN","RORUTL11",24,0)
 ;ROR*1.5*26   MAY 2015    T KOPP       Updated version
"RTN","RORUTL11",25,0)
 ;ROR*1.5*28   APR 2016    T KOPP       Updated version
"RTN","RORUTL11",26,0)
 ;ROR*1.5*29   AUG 2016    T KOPP       Updated version
"RTN","RORUTL11",27,0)
 ;ROR*1.5*30   MAR 2017    M FERRARESE  Updated version
"RTN","RORUTL11",28,0)
 ;ROR*1.5*31   JUL 2017    S ALSAHHAR   Updated version
"RTN","RORUTL11",29,0)
 ;******************************************************************************
"RTN","RORUTL11",30,0)
 ; This routine uses the following IAs:
"RTN","RORUTL11",31,0)
 ;
"RTN","RORUTL11",32,0)
 ; #2055   $$ROOT^DILFD (supported)
"RTN","RORUTL11",33,0)
 ; #10013  ENALL^DIK (supported)
"RTN","RORUTL11",34,0)
 ;         
"RTN","RORUTL11",35,0)
 ;******************************************************************************
"RTN","RORUTL11",36,0)
 Q
"RTN","RORUTL11",37,0)
 ;
"RTN","RORUTL11",38,0)
 ;***** REBUILDS THE "ACL" CROSS-REFERENCE (USER ACCESS)
"RTN","RORUTL11",39,0)
 ;
"RTN","RORUTL11",40,0)
 ; Return Values:
"RTN","RORUTL11",41,0)
 ;       <0  Error code
"RTN","RORUTL11",42,0)
 ;        0  Ok
"RTN","RORUTL11",43,0)
 ;
"RTN","RORUTL11",44,0)
RNDXACL() ;
"RTN","RORUTL11",45,0)
 N DA,DIK,REGIEN,ROOT
"RTN","RORUTL11",46,0)
 S ROOT=$$ROOT^DILFD(798.1,,1)  K @ROOT@("ACL")
"RTN","RORUTL11",47,0)
 S REGIEN=0
"RTN","RORUTL11",48,0)
 F  S REGIEN=$O(@ROOT@(REGIEN))  Q:'REGIEN  D
"RTN","RORUTL11",49,0)
 . S DIK=$$ROOT^DILFD(798.118,","_REGIEN_","),DIK(1)=".01^ACL"
"RTN","RORUTL11",50,0)
 . S DA(1)=REGIEN  D ENALL^DIK
"RTN","RORUTL11",51,0)
 Q 0
"RTN","RORUTL11",52,0)
 ;
"RTN","RORUTL11",53,0)
 ;***** CHECKS IF THE RPC CAN BE CALLED BY THE CURRENT USER
"RTN","RORUTL11",54,0)
 ;
"RTN","RORUTL11",55,0)
 ; RPCNAME       Name of the RPC
"RTN","RORUTL11",56,0)
 ;
"RTN","RORUTL11",57,0)
 ; [REGIEN]      Registry IEN
"RTN","RORUTL11",58,0)
 ;
"RTN","RORUTL11",59,0)
 ; [FLAGS]       Flags that control the execution (can be combined):
"RTN","RORUTL11",60,0)
 ;                 A  Administrator Only
"RTN","RORUTL11",61,0)
 ;                 I  IRM Only
"RTN","RORUTL11",62,0)
 ;
"RTN","RORUTL11",63,0)
 ; Return Values:
"RTN","RORUTL11",64,0)
 ;       <0  Error code
"RTN","RORUTL11",65,0)
 ;        0  Ok
"RTN","RORUTL11",66,0)
 ;       >0  Access denied
"RTN","RORUTL11",67,0)
 ;
"RTN","RORUTL11",68,0)
RPCHECK(RPCNAME,REGIEN,FLAGS) ;
"RTN","RORUTL11",69,0)
 N ACCESS,KEY,RC
"RTN","RORUTL11",70,0)
 Q:$G(DUZ)'>0 $$ERROR^RORERR(-40,,,,"DUZ")
"RTN","RORUTL11",71,0)
 S FLAGS=$G(FLAGS),REGIEN=+$G(REGIEN)
"RTN","RORUTL11",72,0)
 ;---
"RTN","RORUTL11",73,0)
 S (ACCESS,RC)=0
"RTN","RORUTL11",74,0)
 D  Q:ACCESS 0
"RTN","RORUTL11",75,0)
 . I REGIEN  Q:$D(^ROR(798.1,"ACL",DUZ,REGIEN))<10
"RTN","RORUTL11",76,0)
 . E  Q:$D(^ROR(798.1,"ACL",DUZ))<10
"RTN","RORUTL11",77,0)
 . I FLAGS["I"  Q:'$D(^XUSEC("ROR VA IRM",DUZ))
"RTN","RORUTL11",78,0)
 . I FLAGS["A"  S RC=1,KEY=""  D  Q:RC
"RTN","RORUTL11",79,0)
 . . F  S KEY=$O(^ROR(798.1,"ACL",DUZ,REGIEN,KEY))  Q:KEY=""  D  Q:'RC
"RTN","RORUTL11",80,0)
 . . . I KEY?1"ROR"1.E  S:KEY["ADMIN" RC=0
"RTN","RORUTL11",81,0)
 . S ACCESS=1
"RTN","RORUTL11",82,0)
 ;---
"RTN","RORUTL11",83,0)
 D ACVIOLTN^RORLOG(-91,$G(REGIEN),RPCNAME)
"RTN","RORUTL11",84,0)
 Q 1
"RTN","RORUTL11",85,0)
 ;
"RTN","RORUTL11",86,0)
 ;***** RETURNS SERVER VERSION
"RTN","RORUTL11",87,0)
 ;REMOTE PROCEDURE: ROR GET M VERSION
"RTN","RORUTL11",88,0)
 ;
"RTN","RORUTL11",89,0)
 ;The purpose of this RPC is to catch when the GUI executable has been
"RTN","RORUTL11",90,0)
 ;upgraded AND REQUIRES an associated M patch, but the M patch has not
"RTN","RORUTL11",91,0)
 ;been installed yet.
"RTN","RORUTL11",92,0)
 ;
"RTN","RORUTL11",93,0)
 ; VAL n.n.n represents the CCR package version and the m patch number that
"RTN","RORUTL11",94,0)
 ; contains the associated M changes that the GUI is expecting.
"RTN","RORUTL11",95,0)
 ;
"RTN","RORUTL11",96,0)
 ;NOTE TO CCR MAINTENANCE TEAM: For M changes made by the maintenance team,
"RTN","RORUTL11",97,0)
 ;the server version below should not be modified.  The only time the server
"RTN","RORUTL11",98,0)
 ;version should be modified is if the GUI was changed AND there were
"RTN","RORUTL11",99,0)
 ;associated M changes needed for it.
"RTN","RORUTL11",100,0)
 ;
"RTN","RORUTL11",101,0)
VERSRV(VAL) ;
"RTN","RORUTL11",102,0)
 S VAL="1.5.31"
"RTN","RORUTL11",103,0)
 Q
"RTN","RORX001")
0^7^B60961993^B49457815
"RTN","RORX001",1,0)
RORX001 ;HOIFO/SG,VAC - LIST OF REGISTRY PATIENTS ;4/16/09 11:53am
"RTN","RORX001",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**8,10,14,17,19,21,31**;Feb 17, 2006;Build 62
"RTN","RORX001",3,0)
 ;
"RTN","RORX001",4,0)
 ; This routine uses the following IAs:
"RTN","RORX001",5,0)
 ;
"RTN","RORX001",6,0)
 ; #2051         LIST^DIC (supported)
"RTN","RORX001",7,0)
 ; #2056         GET1^DIQ, GETS^DIQ (supported)
"RTN","RORX001",8,0)
 ; #10061        DEM^VADPT (supported)
"RTN","RORX001",9,0)
 ; #10103        FMADD^XLFDT (supported)
"RTN","RORX001",10,0)
 ;
"RTN","RORX001",11,0)
 ; This routine modified March 2009 to handle ICD9 Filter for Include
"RTN","RORX001",12,0)
 ;    or Exclude
"RTN","RORX001",13,0)
 Q
"RTN","RORX001",14,0)
 ;******************************************************************************
"RTN","RORX001",15,0)
 ;******************************************************************************
"RTN","RORX001",16,0)
 ;                       --- ROUTINE MODIFICATION LOG ---
"RTN","RORX001",17,0)
 ;        
"RTN","RORX001",18,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORX001",19,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","RORX001",20,0)
 ;ROR*1.5*14   APR  2011   A SAUNDERS   Added column and data for 'FIRSTDIAG'.
"RTN","RORX001",21,0)
 ;ROR*1.5*17   AUG  2011   C RAY        Added params 'CONFIRM_AFTER', 'CONFDT_AFTER' 
"RTN","RORX001",22,0)
 ;ROR*1.5*19   FEB  2012   K GUPTA      Support for ICD-10 Coding System
"RTN","RORX001",23,0)
 ;ROR*1.5*21   SEP 2013    T KOPP       Added ICN as last report column if
"RTN","RORX001",24,0)
 ;                                      additional identifier option selected
"RTN","RORX001",25,0)
 ;ROR*1.5*31   MAY 2017    M FERRARESE  Adding PACT and PCP as additional identifiers.
"RTN","RORX001",26,0)
 ;******************************************************************************
"RTN","RORX001",27,0)
 ;******************************************************************************
"RTN","RORX001",28,0)
 ;
"RTN","RORX001",29,0)
 ;***** OUTPUTS THE REPORT HEADER
"RTN","RORX001",30,0)
 ;
"RTN","RORX001",31,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX001",32,0)
 ;
"RTN","RORX001",33,0)
 ; Return Values:
"RTN","RORX001",34,0)
 ;       <0  Error code
"RTN","RORX001",35,0)
 ;        0  Ok
"RTN","RORX001",36,0)
 ;
"RTN","RORX001",37,0)
HEADER(PARTAG) ;
"RTN","RORX001",38,0)
 N COL,COLUMNS,HEADER,TMP,AGETYPE
"RTN","RORX001",39,0)
 S HEADER=$$HEADER^RORXU002(.RORTSK,PARTAG)
"RTN","RORX001",40,0)
 S COLUMNS=$$ADDVAL^RORTSK11(RORTSK,"TBLDEF",,HEADER)
"RTN","RORX001",41,0)
 D ADDATTR^RORTSK11(RORTSK,COLUMNS,"NAME","PATIENTS")
"RTN","RORX001",42,0)
 D ADDATTR^RORTSK11(RORTSK,COLUMNS,"HEADER","1")
"RTN","RORX001",43,0)
 D ADDATTR^RORTSK11(RORTSK,COLUMNS,"FOOTER","1")
"RTN","RORX001",44,0)
 S RORFLDS=".01"
"RTN","RORX001",45,0)
 ;--- Required columns
"RTN","RORX001",46,0)
 F COL="#","NAME"  D
"RTN","RORX001",47,0)
 . S TMP=$$ADDVAL^RORTSK11(RORTSK,"COLUMN",,COLUMNS)
"RTN","RORX001",48,0)
 . D ADDATTR^RORTSK11(RORTSK,TMP,"NAME",COL)
"RTN","RORX001",49,0)
 ;--- Age/DOB header if needed
"RTN","RORX001",50,0)
 S AGETYPE=$$PARAM^RORTSK01("AGE_RANGE","TYPE") I AGETYPE'="ALL" D
"RTN","RORX001",51,0)
 . S TMP=$$ADDVAL^RORTSK11(RORTSK,"COLUMN",,COLUMNS)
"RTN","RORX001",52,0)
 . D ADDATTR^RORTSK11(RORTSK,TMP,"NAME",AGETYPE)
"RTN","RORX001",53,0)
 ;
"RTN","RORX001",54,0)
 ;--- Additional columns
"RTN","RORX001",55,0)
 F COL="DOD","CSSN","LAST4","SELRULES","SELDT","CONFDT","PENDCOMM","FIRSTDIAG"  D
"RTN","RORX001",56,0)
 . Q:'$$OPTCOL^RORXU006(COL)
"RTN","RORX001",57,0)
 . S TMP=$$ADDVAL^RORTSK11(RORTSK,"COLUMN",,COLUMNS)
"RTN","RORX001",58,0)
 . D ADDATTR^RORTSK11(RORTSK,TMP,"NAME",COL)
"RTN","RORX001",59,0)
 ; --- ICN if selected must be last column on report
"RTN","RORX001",60,0)
 I $$PARAM^RORTSK01("PATIENTS","ICN") D ICNHDR^RORXU006(RORTSK,COLUMNS)
"RTN","RORX001",61,0)
 I $$PARAM^RORTSK01("PATIENTS","PACT") D PACTHDR^RORXU006(RORTSK,COLUMNS)
"RTN","RORX001",62,0)
 I $$PARAM^RORTSK01("PATIENTS","PCP") D PCPHDR^RORXU006(RORTSK,COLUMNS)
"RTN","RORX001",63,0)
 ;---
"RTN","RORX001",64,0)
 S:$$OPTCOL^RORXU006("CONFDT") RORFLDS=RORFLDS_";2"
"RTN","RORX001",65,0)
 S:$$OPTCOL^RORXU006("SELDT") RORFLDS=RORFLDS_";3.2"
"RTN","RORX001",66,0)
 S:$$OPTCOL^RORXU006("PENDCOMM") RORFLDS=RORFLDS_";12"
"RTN","RORX001",67,0)
 Q 0
"RTN","RORX001",68,0)
 ;
"RTN","RORX001",69,0)
 ;***** ADDS THE PATIENT DATA TO THE REPORT
"RTN","RORX001",70,0)
 ;
"RTN","RORX001",71,0)
 ; IENS          IENS of the patient's record in the registry
"RTN","RORX001",72,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX001",73,0)
 ;
"RTN","RORX001",74,0)
 ; Return Values:
"RTN","RORX001",75,0)
 ;       <0  Error code
"RTN","RORX001",76,0)
 ;        0  Ok
"RTN","RORX001",77,0)
 ;
"RTN","RORX001",78,0)
PATIENT(IENS,PARTAG) ;
"RTN","RORX001",79,0)
 N DFN,IATIME,NAME,RC,RORBUF,RORMSG,TMP,VA,VADM,VAHOW,VAROOT,PTAG,AGETYPE,AGE
"RTN","RORX001",80,0)
 K RORMSG D GETS^DIQ(798,IENS,RORFLDS,"I","RORBUF","RORMSG")
"RTN","RORX001",81,0)
 Q:$G(RORMSG("DIERR")) $$DBS^RORERR("RORMSG",-9,,,798,IENS)
"RTN","RORX001",82,0)
 S DFN=$G(RORBUF(798,IENS,.01,"I"))
"RTN","RORX001",83,0)
 ;--- Load the demographic data
"RTN","RORX001",84,0)
 D DEM^VADPT
"RTN","RORX001",85,0)
 ;--- The <PATIENT> tag
"RTN","RORX001",86,0)
 S PTAG=$$ADDVAL^RORTSK11(RORTSK,"PATIENT",,PARTAG,,DFN)
"RTN","RORX001",87,0)
 ;--- Patient Name
"RTN","RORX001",88,0)
 D ADDVAL^RORTSK11(RORTSK,"NAME",VADM(1),PTAG,1)
"RTN","RORX001",89,0)
 ;--- Age/DOB
"RTN","RORX001",90,0)
 I $$PARAM^RORTSK01("AGE_RANGE","TYPE")'="ALL" S AGETYPE=$$PARAM^RORTSK01("AGE_RANGE","TYPE") D
"RTN","RORX001",91,0)
 . S AGE=$S(AGETYPE="AGE":$P(VADM(4),U),AGETYPE="DOB":$$DATE^RORXU002($P(VADM(3),U)\1),1:"")
"RTN","RORX001",92,0)
 . D ADDVAL^RORTSK11(RORTSK,AGETYPE,AGE,PTAG,1)
"RTN","RORX001",93,0)
 ;
"RTN","RORX001",94,0)
 ;--- Date of Death
"RTN","RORX001",95,0)
 D:$$OPTCOL^RORXU006("DOD")
"RTN","RORX001",96,0)
 . S TMP=$$DATE^RORXU002(VADM(6)\1)
"RTN","RORX001",97,0)
 . D ADDVAL^RORTSK11(RORTSK,"DOD",TMP,PTAG,1)
"RTN","RORX001",98,0)
 ;--- Coded SSN
"RTN","RORX001",99,0)
 D:$$OPTCOL^RORXU006("CSSN")
"RTN","RORX001",100,0)
 . S TMP=$$XOR^RORUTL03($P(VADM(2),U))
"RTN","RORX001",101,0)
 . D ADDVAL^RORTSK11(RORTSK,"CSSN",TMP,PTAG,1)
"RTN","RORX001",102,0)
 ;--- Last 4 digits of the SSN
"RTN","RORX001",103,0)
 D:$$OPTCOL^RORXU006("LAST4")
"RTN","RORX001",104,0)
 . D ADDVAL^RORTSK11(RORTSK,"LAST4",VA("BID"),PTAG,2)
"RTN","RORX001",105,0)
 ;--- Selection Rules
"RTN","RORX001",106,0)
 I $$OPTCOL^RORXU006("SELRULES")  D  Q:RC<0 RC
"RTN","RORX001",107,0)
 . S RC=$$SELRULES(IENS,PTAG)
"RTN","RORX001",108,0)
 ;--- Date Selected for the Registry
"RTN","RORX001",109,0)
 D:$$OPTCOL^RORXU006("SELDT")
"RTN","RORX001",110,0)
 . S TMP=$$DATE^RORXU002($G(RORBUF(798,IENS,3.2,"I"))\1)
"RTN","RORX001",111,0)
 . D ADDVAL^RORTSK11(RORTSK,"SELDT",TMP,PTAG,1)
"RTN","RORX001",112,0)
 ;--- Date Confirmed in the Registry
"RTN","RORX001",113,0)
 D:$$OPTCOL^RORXU006("CONFDT")
"RTN","RORX001",114,0)
 . S TMP=$$DATE^RORXU002($G(RORBUF(798,IENS,2,"I"))\1)
"RTN","RORX001",115,0)
 . D ADDVAL^RORTSK11(RORTSK,"CONFDT",TMP,PTAG,1)
"RTN","RORX001",116,0)
 ;--- Pending Comment
"RTN","RORX001",117,0)
 D:$$OPTCOL^RORXU006("PENDCOMM")
"RTN","RORX001",118,0)
 . S TMP=$G(RORBUF(798,IENS,12,"I"))
"RTN","RORX001",119,0)
 . S TMP=$S($L(TMP)>0:TMP,1:"")
"RTN","RORX001",120,0)
 . D ADDVAL^RORTSK11(RORTSK,"PENDCOMM",TMP,PTAG,1)
"RTN","RORX001",121,0)
 ;--- First Healthcare Setting to Diagnose HIV
"RTN","RORX001",122,0)
 D:$$OPTCOL^RORXU006("FIRSTDIAG")
"RTN","RORX001",123,0)
 . K RORBUF,RORMSG D GETS^DIQ(799.4,IENS,12.08,"I","RORBUF","RORMSG")
"RTN","RORX001",124,0)
 . S TMP=$G(RORBUF(799.4,IENS,12.08,"I"))
"RTN","RORX001",125,0)
 . S TMP=$S($G(TMP)=1:"Yes",$G(TMP)=0:"No",$G(TMP)=9:"Unknown",1:"")
"RTN","RORX001",126,0)
 . D ADDVAL^RORTSK11(RORTSK,"FIRSTDIAG",$G(TMP),PTAG,1)
"RTN","RORX001",127,0)
 ;--- ICN
"RTN","RORX001",128,0)
 I $$PARAM^RORTSK01("PATIENTS","ICN") D
"RTN","RORX001",129,0)
 . S:'$D(DFN) DFN=$G(RORBUF(798,IENS,.01,"I"))
"RTN","RORX001",130,0)
 . D ICNDATA^RORXU006(RORTSK,DFN,PTAG)
"RTN","RORX001",131,0)
 ;
"RTN","RORX001",132,0)
 ;--- PACT
"RTN","RORX001",133,0)
 I $$PARAM^RORTSK01("PATIENTS","PACT") D
"RTN","RORX001",134,0)
 . S:'$D(DFN) DFN=$G(RORBUF(798,IENS,.01,"I"))
"RTN","RORX001",135,0)
 . D PACTDATA^RORXU006(RORTSK,DFN,PTAG)
"RTN","RORX001",136,0)
 ;
"RTN","RORX001",137,0)
 ;--- PCP
"RTN","RORX001",138,0)
 I $$PARAM^RORTSK01("PATIENTS","PCP") D
"RTN","RORX001",139,0)
 . S:'$D(DFN) DFN=$G(RORBUF(798,IENS,.01,"I"))
"RTN","RORX001",140,0)
 . D PCPDATA^RORXU006(RORTSK,DFN,PTAG)
"RTN","RORX001",141,0)
 Q 0
"RTN","RORX001",142,0)
 ;
"RTN","RORX001",143,0)
 ;***** COMPILES A LIST OF REGISTRY PATIENTS
"RTN","RORX001",144,0)
 ; REPORT CODE: 001
"RTN","RORX001",145,0)
 ;
"RTN","RORX001",146,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORX001",147,0)
 ;
"RTN","RORX001",148,0)
 ; Return Values:
"RTN","RORX001",149,0)
 ;       <0  Error code
"RTN","RORX001",150,0)
 ;        0  Ok
"RTN","RORX001",151,0)
 ;
"RTN","RORX001",152,0)
REGPTLST(RORTSK) ;
"RTN","RORX001",153,0)
 N RORFLDS       ; Fields to load from the file #798
"RTN","RORX001",154,0)
 N RORPTN        ; Number of patients in the registry
"RTN","RORX001",155,0)
 N RORREG        ; Registry IEN
"RTN","RORX001",156,0)
 ;
"RTN","RORX001",157,0)
 N BODY,CNT,ECNT,IEN,IENS,MODE,PTNAME,RC,REPORT,SFLAGS,TMP,XREFNODE
"RTN","RORX001",158,0)
 N RCC,FLAG,RORCDT,PARAMS
"RTN","RORX001",159,0)
 ;--- Root node of the report
"RTN","RORX001",160,0)
 S REPORT=$$ADDVAL^RORTSK11(RORTSK,"REPORT")
"RTN","RORX001",161,0)
 Q:REPORT<0 REPORT
"RTN","RORX001",162,0)
 ;
"RTN","RORX001",163,0)
 ;--- Get and prepare the report parameters
"RTN","RORX001",164,0)
 S RORREG=$$PARAM^RORTSK01("REGIEN")
"RTN","RORX001",165,0)
 S PARAMS=$$PARAMS^RORXU002(.RORTSK,REPORT,,,.SFLAGS)  Q:PARAMS<0 PARAMS
"RTN","RORX001",166,0)
 S SFLAGS=$TR(SFLAGS,"DG")
"RTN","RORX001",167,0)
 I '$$PARAM^RORTSK01("PATIENTS","CONFIRMED"),'$$PARAM^RORTSK01("PATIENTS","CONFIRM_AFTER") S SFLAGS=SFLAGS_"C"
"RTN","RORX001",168,0)
 S:'$$PARAM^RORTSK01("PATIENTS","PENDING") SFLAGS=SFLAGS_"G"
"RTN","RORX001",169,0)
 S RORCDT=$$PARAM^RORTSK01("PATIENTS","CONFDT_AFTER")
"RTN","RORX001",170,0)
 D ADDVAL^RORTSK11(RORTSK,"TYPE",SFLAGS,REPORT)
"RTN","RORX001",171,0)
 ;--- After date range
"RTN","RORX001",172,0)
 I RORCDT D
"RTN","RORX001",173,0)
 . S SFLAGS=SFLAGS_"P"
"RTN","RORX001",174,0)
 . S RORCDT=$$FMADD^XLFDT(RORCDT,1)  ;add one day
"RTN","RORX001",175,0)
 ;
"RTN","RORX001",176,0)
 ;--- Initialize constants and variables
"RTN","RORX001",177,0)
 S RORPTN=$$REGSIZE^RORUTL02(+RORREG)  S:RORPTN<0 RORPTN=0
"RTN","RORX001",178,0)
 S ECNT=0,XREFNODE=$NA(^RORDATA(798,"ARP",RORREG_"#"))
"RTN","RORX001",179,0)
 ;
"RTN","RORX001",180,0)
 ;--- The report header and list of patients
"RTN","RORX001",181,0)
 S RC=$$HEADER(REPORT)  Q:RC<0 RC
"RTN","RORX001",182,0)
 S BODY=$$ADDVAL^RORTSK11(RORTSK,"PATIENTS",,REPORT)
"RTN","RORX001",183,0)
 D ADDATTR^RORTSK11(RORTSK,BODY,"TABLE","PATIENTS")
"RTN","RORX001",184,0)
 Q:BODY<0 BODY
"RTN","RORX001",185,0)
 ;
"RTN","RORX001",186,0)
 ;--- Browse through the registry records
"RTN","RORX001",187,0)
 S PTNAME="",(CNT,RC)=0
"RTN","RORX001",188,0)
 S FLAG=$G(RORTSK("PARAMS","ICDFILT","A","FILTER"))
"RTN","RORX001",189,0)
 F  S PTNAME=$O(@XREFNODE@(PTNAME))  Q:PTNAME=""  D  Q:RC<0
"RTN","RORX001",190,0)
 . S IEN=0
"RTN","RORX001",191,0)
 . F  S IEN=$O(@XREFNODE@(PTNAME,IEN))  Q:IEN'>0  D  Q:RC<0
"RTN","RORX001",192,0)
 . . S TMP=$S(RORPTN>0:CNT/RORPTN,1:"")
"RTN","RORX001",193,0)
 . . S RC=$$LOOP^RORTSK01(TMP)  Q:RC<0
"RTN","RORX001",194,0)
 . . S IENS=IEN_",",CNT=CNT+1
"RTN","RORX001",195,0)
 . . ;--- Check if the patient should be skipped
"RTN","RORX001",196,0)
 . . Q:$$SKIP^RORXU005(IEN,SFLAGS,RORCDT)
"RTN","RORX001",197,0)
 . .;--- Check the patient against the ICD Filter
"RTN","RORX001",198,0)
 . . S DFN=$$PTIEN^RORUTL01(+IENS)
"RTN","RORX001",199,0)
 . . S RCC=0
"RTN","RORX001",200,0)
 . . I FLAG'="ALL" D
"RTN","RORX001",201,0)
 . . . S RCC=$$ICD^RORXU010(DFN)
"RTN","RORX001",202,0)
 . . I (FLAG="INCLUDE")&(RCC=0) Q
"RTN","RORX001",203,0)
 . . I (FLAG="EXCLUDE")&(RCC=1) Q
"RTN","RORX001",204,0)
 . .;--- End of filter check
"RTN","RORX001",205,0)
 . . ;--- Process the registry record
"RTN","RORX001",206,0)
 . . I $$PATIENT(IENS,BODY)<0  S ECNT=ECNT+1  Q
"RTN","RORX001",207,0)
 ;---
"RTN","RORX001",208,0)
 Q $S(RC<0:RC,ECNT>0:-43,1:0)
"RTN","RORX001",209,0)
 ;
"RTN","RORX001",210,0)
 ;***** ADDS THE SELECTION RULES TO THE REPORT
"RTN","RORX001",211,0)
 ;
"RTN","RORX001",212,0)
 ; IENS          IENS of the patient's record in the registry
"RTN","RORX001",213,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX001",214,0)
 ;
"RTN","RORX001",215,0)
 ; Return Values:
"RTN","RORX001",216,0)
 ;       <0  Error code
"RTN","RORX001",217,0)
 ;        0  Ok
"RTN","RORX001",218,0)
 ;
"RTN","RORX001",219,0)
SELRULES(IENS,PARTAG) ;
"RTN","RORX001",220,0)
 N CNT,I,RORBUF,RORMSG,RT,SRLTAG,TMP
"RTN","RORX001",221,0)
 ;--- Load the list of selection rules
"RTN","RORX001",222,0)
 K RORMSG D LIST^DIC(798.01,","_IENS,"@;.01I;1I",,,,,"B",,,"RORBUF","RORMSG")
"RTN","RORX001",223,0)
 ;Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,798.01,IENS)
"RTN","RORX001",224,0)
 Q:$G(RORMSG("DIERR")) $$DBS^RORERR("RORMSG",-9,,,798.01,IENS)
"RTN","RORX001",225,0)
 ;--- The <SELRULES> ... </SELRULES> tags
"RTN","RORX001",226,0)
 S SRLTAG=$$ADDVAL^RORTSK11(RORTSK,"SELRULES",,PARTAG)
"RTN","RORX001",227,0)
 ;--- Add the selection rules to the report
"RTN","RORX001",228,0)
 S I="",CNT=0
"RTN","RORX001",229,0)
 F  S I=$O(RORBUF("DILIST","ID",I))  Q:I=""  D
"RTN","RORX001",230,0)
 . S RT=$$ADDVAL^RORTSK11(RORTSK,"RULE",,SRLTAG),CNT=CNT+1
"RTN","RORX001",231,0)
 . S TMP=$G(RORBUF("DILIST","ID",I,.01))
"RTN","RORX001",232,0)
 . K RORMSG S TMP=$$GET1^DIQ(798.2,TMP_",",4,,,"RORMSG")
"RTN","RORX001",233,0)
 . ;Q:$G(DIERR)!(TMP="")
"RTN","RORX001",234,0)
 . Q:$G(RORMSG("DIERR"))!(TMP="")
"RTN","RORX001",235,0)
 . D ADDATTR^RORTSK11(RORTSK,RT,"DESCR",TMP)
"RTN","RORX001",236,0)
 . S TMP=$$DATE^RORXU002($G(RORBUF("DILIST","ID",I,1))\1)
"RTN","RORX001",237,0)
 . D:TMP'="" ADDATTR^RORTSK11(RORTSK,RT,"DATE",TMP)
"RTN","RORX001",238,0)
 ;--- Add the default item if no selection rules have been found
"RTN","RORX001",239,0)
 D:CNT'>0
"RTN","RORX001",240,0)
 . S RT=$$ADDVAL^RORTSK11(RORTSK,"RULE",,SRLTAG)
"RTN","RORX001",241,0)
 . D ADDATTR^RORTSK11(RORTSK,RT,"DESCR","Manual Entry")
"RTN","RORX001",242,0)
 ;
"RTN","RORX001",243,0)
 Q 0
"RTN","RORX001",244,0)
 ;
"RTN","RORX001",245,0)
         
"RTN","RORX002")
0^2^B43221624^B28362843
"RTN","RORX002",1,0)
RORX002 ;HOIFO/SG,VAC - CURRENT INPATIENT LIST ;4/7/09 2:06pm
"RTN","RORX002",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**1,8,19,21,31**;Feb 17, 2006;Build 62
"RTN","RORX002",3,0)
 ;
"RTN","RORX002",4,0)
 ; This routine uses the following IAs:
"RTN","RORX002",5,0)
 ;
"RTN","RORX002",6,0)
 ; #10061        51^VADPT (supported)
"RTN","RORX002",7,0)
 ;
"RTN","RORX002",8,0)
 ; Routine modified March 2009 for ICD9 filter for INCLUDE or EXCLUDE
"RTN","RORX002",9,0)
 ;
"RTN","RORX002",10,0)
 ;******************************************************************************
"RTN","RORX002",11,0)
 ;******************************************************************************
"RTN","RORX002",12,0)
 ;                       --- ROUTINE MODIFICATION LOG ---
"RTN","RORX002",13,0)
 ;        
"RTN","RORX002",14,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORX002",15,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","RORX002",16,0)
 ;ROR*1.5*19   FEB  2012   K GUPTA      Support for ICD-10 Coding System
"RTN","RORX002",17,0)
 ;ROR*1.5*21   SEP 2013    T KOPP       Add ICN column if Additional Identifier
"RTN","RORX002",18,0)
 ;                                       requested.
"RTN","RORX002",19,0)
 ;ROR*1.5*31   MAY 2017    M FERRARESE  Adding PACT, PCP, and AGE/DOB as additional
"RTN","RORX002",20,0)
 ;                                       identifiers.
"RTN","RORX002",21,0)
 ;******************************************************************************
"RTN","RORX002",22,0)
 ;
"RTN","RORX002",23,0)
 Q
"RTN","RORX002",24,0)
 ;
"RTN","RORX002",25,0)
 ;***** OUTPUTS THE REPORT HEADER
"RTN","RORX002",26,0)
 ;
"RTN","RORX002",27,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX002",28,0)
 ;
"RTN","RORX002",29,0)
 ; Return Values:
"RTN","RORX002",30,0)
 ;       <0  Error code
"RTN","RORX002",31,0)
 ;        0  Ok
"RTN","RORX002",32,0)
 ;
"RTN","RORX002",33,0)
HEADER(PARTAG) ;
"RTN","RORX002",34,0)
 ;;PATIENTS(#,NAME,LAST4,AGE,WARD,ROOM-BED,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="AGE"
"RTN","RORX002",35,0)
 ;;PATIENTS(#,NAME,LAST4,DOB,WARD,ROOM-BED,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="DOB"
"RTN","RORX002",36,0)
 ;;PATIENTS(#,NAME,LAST4,WARD,ROOM-BED,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="ALL"
"RTN","RORX002",37,0)
 ;
"RTN","RORX002",38,0)
 N HEADER,RC
"RTN","RORX002",39,0)
 S HEADER=$$HEADER^RORXU002(.RORTSK,PARTAG)
"RTN","RORX002",40,0)
 Q:HEADER<0 HEADER
"RTN","RORX002",41,0)
 S RC=$$TBLDEF^RORXU002("HEADER^RORX002",HEADER)
"RTN","RORX002",42,0)
 Q $S(RC<0:RC,1:HEADER)
"RTN","RORX002",43,0)
 ;
"RTN","RORX002",44,0)
 ;***** COMPILES THE "CURRENT INPATIENT LIST"
"RTN","RORX002",45,0)
 ; REPORT CODE: 002
"RTN","RORX002",46,0)
 ;
"RTN","RORX002",47,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORX002",48,0)
 ;
"RTN","RORX002",49,0)
 ; Return Values:
"RTN","RORX002",50,0)
 ;       <0  Error code
"RTN","RORX002",51,0)
 ;        0  Ok
"RTN","RORX002",52,0)
 ;
"RTN","RORX002",53,0)
INPTLST(RORTSK) ;
"RTN","RORX002",54,0)
 N RORPTN        ; Number of patients in the registry
"RTN","RORX002",55,0)
 N RORREG        ; Registry IEN
"RTN","RORX002",56,0)
 N RORTMP        ; Closed root of the temporary buffer
"RTN","RORX002",57,0)
 ;
"RTN","RORX002",58,0)
 N BODY,ECNT,INPCNT,RC,REPORT,SFLAGS,TMP
"RTN","RORX002",59,0)
 ;--- Root node of the report
"RTN","RORX002",60,0)
 S REPORT=$$ADDVAL^RORTSK11(RORTSK,"REPORT")
"RTN","RORX002",61,0)
 Q:REPORT<0 REPORT
"RTN","RORX002",62,0)
 ;
"RTN","RORX002",63,0)
 ;--- Get and prepare the report parameters
"RTN","RORX002",64,0)
 S RORREG=$$PARAM^RORTSK01("REGIEN")
"RTN","RORX002",65,0)
 S RC=$$PARAMS^RORXU002(.RORTSK,REPORT,,,.SFLAGS)  Q:RC<0 RC
"RTN","RORX002",66,0)
 ;
"RTN","RORX002",67,0)
 ;--- Initialize constants and variables
"RTN","RORX002",68,0)
 S ECNT=0
"RTN","RORX002",69,0)
 S RORPTN=$$REGSIZE^RORUTL02(+RORREG)  S:RORPTN<0 RORPTN=0
"RTN","RORX002",70,0)
 ;
"RTN","RORX002",71,0)
 ;--- Report header
"RTN","RORX002",72,0)
 S RC=$$HEADER(REPORT)  Q:RC<0 RC
"RTN","RORX002",73,0)
 S RORTMP=$$ALLOC^RORTMP()
"RTN","RORX002",74,0)
 D
"RTN","RORX002",75,0)
 . ;--- Query the registry
"RTN","RORX002",76,0)
 . D TPPSETUP^RORTSK01(50)
"RTN","RORX002",77,0)
 . S RC=$$QUERY(.INPCNT,SFLAGS)
"RTN","RORX002",78,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX002",79,0)
 . ;--- Generate the list of patients
"RTN","RORX002",80,0)
 . D TPPSETUP^RORTSK01(50)
"RTN","RORX002",81,0)
 . S RC=$$PTLIST(REPORT,INPCNT)
"RTN","RORX002",82,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX002",83,0)
 ;
"RTN","RORX002",84,0)
 ;--- Cleanup
"RTN","RORX002",85,0)
 D FREE^RORTMP(RORTMP)
"RTN","RORX002",86,0)
 Q $S(RC<0:RC,ECNT>0:-43,1:0)
"RTN","RORX002",87,0)
 ;
"RTN","RORX002",88,0)
 ;***** ADDS THE PATIENT DATA TO THE REPORT
"RTN","RORX002",89,0)
 ;
"RTN","RORX002",90,0)
 ; NODE          Closed root of the patient's node in the buffer
"RTN","RORX002",91,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX002",92,0)
 ;
"RTN","RORX002",93,0)
 ; Return Values:
"RTN","RORX002",94,0)
 ;       <0  Error code
"RTN","RORX002",95,0)
 ;        0  Ok
"RTN","RORX002",96,0)
 ;
"RTN","RORX002",97,0)
PATIENT(NODE,PARTAG) ;
"RTN","RORX002",98,0)
 N IEN,NAME,PATIEN,PTAG,PTBUF,RC,TMP,AGETYPE
"RTN","RORX002",99,0)
 S PTBUF=@NODE,PATIEN=$P(PTBUF,U,2)
"RTN","RORX002",100,0)
 Q:PATIEN'>0 0
"RTN","RORX002",101,0)
 ;--- The <PATIENT> tag
"RTN","RORX002",102,0)
 S PTAG=$$ADDVAL^RORTSK11(RORTSK,"PATIENT",,PARTAG,,PATIEN)
"RTN","RORX002",103,0)
 ;--- Patient data
"RTN","RORX002",104,0)
 D ADDVAL^RORTSK11(RORTSK,"NAME",$QS(NODE,4),PTAG,1)
"RTN","RORX002",105,0)
 D ADDVAL^RORTSK11(RORTSK,"LAST4",$QS(NODE,5),PTAG,2)
"RTN","RORX002",106,0)
 S AGETYPE=$$PARAM^RORTSK01("AGE_RANGE","TYPE") I AGETYPE'="ALL" D
"RTN","RORX002",107,0)
 . D ADDVAL^RORTSK11(RORTSK,$S(AGETYPE="AGE":"AGE",1:"DOB"),$P(PTBUF,U,$L(PTBUF,U)),PTAG,1)
"RTN","RORX002",108,0)
 S TMP=$$DATE^RORXU002($P(PTBUF,U,4)\1)
"RTN","RORX002",109,0)
 ;D ADDVAL^RORTSK11(RORTSK,"DOD",TMP,PTAG,1)
"RTN","RORX002",110,0)
 ;
"RTN","RORX002",111,0)
 D ADDVAL^RORTSK11(RORTSK,"WARD",$QS(NODE,3),PTAG,1)
"RTN","RORX002",112,0)
 D ADDVAL^RORTSK11(RORTSK,"ROOM-BED",$P(PTBUF,U,3),PTAG,1)
"RTN","RORX002",113,0)
 ; --- ICN, PACT, PCP if selected will be one of the last columns on report accordingly.
"RTN","RORX002",114,0)
 I $$PARAM^RORTSK01("PATIENTS","ICN") D ADDVAL^RORTSK11(RORTSK,"ICN",$P(PTBUF,U,$L(PTBUF,U)),PTAG,1)
"RTN","RORX002",115,0)
 I $$PARAM^RORTSK01("PATIENTS","PACT") D ADDVAL^RORTSK11(RORTSK,"PACT",$P(PTBUF,U,$L(PTBUF,U)),PTAG,1)
"RTN","RORX002",116,0)
 I $$PARAM^RORTSK01("PATIENTS","PCP") D ADDVAL^RORTSK11(RORTSK,"PCP",$P(PTBUF,U,$L(PTBUF,U)),PTAG,1)
"RTN","RORX002",117,0)
 Q 0
"RTN","RORX002",118,0)
 ;
"RTN","RORX002",119,0)
 ;***** GENERATES THE LIST OF PATIENTS
"RTN","RORX002",120,0)
 ;
"RTN","RORX002",121,0)
 ; REPORT        IEN of the <REPORT> node
"RTN","RORX002",122,0)
 ; INPCNT        Number of inpatients
"RTN","RORX002",123,0)
 ;
"RTN","RORX002",124,0)
 ; Return Values:
"RTN","RORX002",125,0)
 ;       <0  Error code
"RTN","RORX002",126,0)
 ;        0  Ok
"RTN","RORX002",127,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX002",128,0)
 ;
"RTN","RORX002",129,0)
PTLIST(REPORT,INPCNT) ;
"RTN","RORX002",130,0)
 N BODY,CNT,ECNT,FLT,FLTLEN,NODE,RC,TCNT,TMP
"RTN","RORX002",131,0)
 S (CNT,ECNT,RC)=0
"RTN","RORX002",132,0)
 S BODY=$$ADDVAL^RORTSK11(RORTSK,"PATIENTS",,REPORT)
"RTN","RORX002",133,0)
 Q:BODY<0 BODY
"RTN","RORX002",134,0)
 D ADDATTR^RORTSK11(RORTSK,BODY,"TABLE","PATIENTS")
"RTN","RORX002",135,0)
 D:$D(@RORTMP)>1
"RTN","RORX002",136,0)
 . S NODE=RORTMP
"RTN","RORX002",137,0)
 . S FLTLEN=$L(NODE)-1,FLT=$E(NODE,1,FLTLEN)
"RTN","RORX002",138,0)
 . F  S NODE=$Q(@NODE)  Q:$E(NODE,1,FLTLEN)'=FLT  D  Q:RC<0
"RTN","RORX002",139,0)
 . . S TMP=$S(INPCNT>0:CNT/INPCNT,1:"")
"RTN","RORX002",140,0)
 . . S RC=$$LOOP^RORTSK01(TMP)  Q:RC<0
"RTN","RORX002",141,0)
 . . S CNT=CNT+1
"RTN","RORX002",142,0)
 . . I $$PATIENT(NODE,BODY)<0  S ECNT=ECNT+1  Q
"RTN","RORX002",143,0)
 Q $S(RC<0:RC,1:ECNT)
"RTN","RORX002",144,0)
 ;
"RTN","RORX002",145,0)
 ;***** QUERIES THE REGISTRY
"RTN","RORX002",146,0)
 ;
"RTN","RORX002",147,0)
 ; .INPCNT       Number of inpatients is returned in this parameter
"RTN","RORX002",148,0)
 ; SFLAGS        Flags for $$SKIP^RORXU005
"RTN","RORX002",149,0)
 ;
"RTN","RORX002",150,0)
 ; Return Values:
"RTN","RORX002",151,0)
 ;       <0  Error code
"RTN","RORX002",152,0)
 ;        0  Ok
"RTN","RORX002",153,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX002",154,0)
 ;
"RTN","RORX002",155,0)
QUERY(INPCNT,SFLAGS) ;
"RTN","RORX002",156,0)
 N CNT,DFN,ECNT,IEN,IENS,RC,TCNT,TMP,VA,VADM,VAHOW,VAIP,VAROOT,XREFNODE,WARD,AGEDOB
"RTN","RORX002",157,0)
 N RCC,FLAG
"RTN","RORX002",158,0)
 S XREFNODE=$NA(^RORDATA(798,"AC",+RORREG))
"RTN","RORX002",159,0)
 S (CNT,ECNT,INPCNT,RC)=0
"RTN","RORX002",160,0)
 ;--- Browse through the registry records
"RTN","RORX002",161,0)
 S IEN=0
"RTN","RORX002",162,0)
 S FLAG=$G(RORTSK("PARAMS","ICDFILT","A","FILTER"))
"RTN","RORX002",163,0)
 F  S IEN=$O(@XREFNODE@(IEN))  Q:IEN'>0  D  Q:RC<0
"RTN","RORX002",164,0)
 . S TMP=$S(RORPTN>0:CNT/RORPTN,1:"")
"RTN","RORX002",165,0)
 . S RC=$$LOOP^RORTSK01(TMP)  Q:RC<0
"RTN","RORX002",166,0)
 . S IENS=IEN_",",CNT=CNT+1
"RTN","RORX002",167,0)
 . ;--- Skip a patient
"RTN","RORX002",168,0)
 . Q:$$SKIP^RORXU005(IEN,SFLAGS)
"RTN","RORX002",169,0)
 . ;--- Process the registry record
"RTN","RORX002",170,0)
 . S DFN=$$PTIEN^RORUTL01(IEN)  Q:DFN'>0
"RTN","RORX002",171,0)
 .; --- Check the ICD filter
"RTN","RORX002",172,0)
 . S RCC=0
"RTN","RORX002",173,0)
 . I FLAG'="ALL" D
"RTN","RORX002",174,0)
 . . S RCC=$$ICD^RORXU010(DFN)
"RTN","RORX002",175,0)
 . I (FLAG="INCLUDE")&(RCC=0) Q
"RTN","RORX002",176,0)
 . I (FLAG="EXCLUDE")&(RCC=1) Q
"RTN","RORX002",177,0)
 .;--- End of ICD Filter check
"RTN","RORX002",178,0)
 . K VA,VADM,VAIP  S VAIP("D")=DT\1  D 51^VADPT
"RTN","RORX002",179,0)
 . S AGEDOB=$$PARAM^RORTSK01("AGE_RANGE","TYPE") S AGEDOB=$S(AGEDOB="AGE":$P($G(VADM(4)),U),AGEDOB="DOB":$P($G(VADM(3)),U),1:"")
"RTN","RORX002",180,0)
 . S WARD=$P(VAIP(5),U,2)  Q:WARD=""
"RTN","RORX002",181,0)
 . S TMP=$S($G(VA("BID"))'="":VA("BID"),1:"UNKN") ; Last 4 of SSN
"RTN","RORX002",182,0)
 . S @RORTMP@(WARD,VADM(1),TMP)=IEN_U_DFN_U_$P(VAIP(6),U,2)_U_$P(VADM(6),U)
"RTN","RORX002",183,0)
 . I $$PARAM^RORTSK01("PATIENTS","ICN") D
"RTN","RORX002",184,0)
 . . N TMP1
"RTN","RORX002",185,0)
 . . S TMP1=$$ICN^RORUTL02(DFN)
"RTN","RORX002",186,0)
 . . I TMP1'<0 S @RORTMP@(WARD,VADM(1),TMP)=@RORTMP@(WARD,VADM(1),TMP)_U_TMP1
"RTN","RORX002",187,0)
 . I $$PARAM^RORTSK01("PATIENTS","PACT") D
"RTN","RORX002",188,0)
 . . N TMP1
"RTN","RORX002",189,0)
 . . S TMP1=$$PACT^RORUTL02(DFN)
"RTN","RORX002",190,0)
 . . I TMP1'<0 S @RORTMP@(WARD,VADM(1),TMP)=@RORTMP@(WARD,VADM(1),TMP)_U_TMP1
"RTN","RORX002",191,0)
 . I $$PARAM^RORTSK01("PATIENTS","PCP") D
"RTN","RORX002",192,0)
 . . N TMP1
"RTN","RORX002",193,0)
 . . S TMP1=$$PCP^RORUTL02(DFN)
"RTN","RORX002",194,0)
 . . I TMP1'<0 S @RORTMP@(WARD,VADM(1),TMP)=@RORTMP@(WARD,VADM(1),TMP)_U_TMP1
"RTN","RORX002",195,0)
 . N TMP1
"RTN","RORX002",196,0)
 . S TMP1=$$DATE^RORXU002(AGEDOB\1)
"RTN","RORX002",197,0)
 . I TMP1'<0 S @RORTMP@(WARD,VADM(1),TMP)=@RORTMP@(WARD,VADM(1),TMP)_U_TMP1
"RTN","RORX002",198,0)
 . S INPCNT=INPCNT+1
"RTN","RORX002",199,0)
 ;---
"RTN","RORX002",200,0)
 Q $S(RC<0:RC,1:ECNT)
"RTN","RORX002",201,0)
 ;
"RTN","RORX002",202,0)
 ;***** CHECKS THE SUFFIX FOR VALIDITY
"RTN","RORX002",203,0)
 ;
"RTN","RORX002",204,0)
 ; SUFFIX        Suffix
"RTN","RORX002",205,0)
 ;
"RTN","RORX002",206,0)
 ; Return Values:
"RTN","RORX002",207,0)
 ;        0  Ok
"RTN","RORX002",208,0)
 ;        1  Invalid suffix
"RTN","RORX002",209,0)
VSUFFIX(SUFFIX) ;
"RTN","RORX002",210,0)
 Q '("9AA,9AB,9BB,A0,A4,A5,BU,BV,PA"[SUFFIX)
"RTN","RORX003")
0^3^B41815764^B39739839
"RTN","RORX003",1,0)
RORX003 ;HOIFO/SG,VAC - GENERAL UTILIZATION AND DEMOGRAPHICS ;4/7/09 2:06pm
"RTN","RORX003",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**1,8,13,19,21,30,31**;Feb 17, 2006;Build 62
"RTN","RORX003",3,0)
 ;
"RTN","RORX003",4,0)
 ; This routine uses the following IAs:
"RTN","RORX003",5,0)
 ;
"RTN","RORX003",6,0)
 ; #10103  FMADD^XLFDT, FMDIFF^XLFDT, FMTE^XLFDT (supported)
"RTN","RORX003",7,0)
 ;
"RTN","RORX003",8,0)
 ;******************************************************************************
"RTN","RORX003",9,0)
 ;******************************************************************************
"RTN","RORX003",10,0)
 ;                 --- ROUTINE MODIFICATION LOG ---
"RTN","RORX003",11,0)
 ;        
"RTN","RORX003",12,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORX003",13,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","RORX003",14,0)
 ;ROR*1.5*8    MAR  2010   V CARR       Modified to handle ICD9 filter for
"RTN","RORX003",15,0)
 ;                                      'include' or 'exclude'.
"RTN","RORX003",16,0)
 ;ROR*1.5*13   DEC  2010   A SAUNDERS   User can select specific patients,
"RTN","RORX003",17,0)
 ;                                      clinics, or divisions for the report.
"RTN","RORX003",18,0)
 ;ROR*1.5*19   FEB  2012   K GUPTA      Support for ICD-10 Coding System
"RTN","RORX003",19,0)
 ;ROR*1.5*21   SEP 2013    T KOPP       Added ICN as last report column if
"RTN","RORX003",20,0)
 ;                                      additional identifier option selected
"RTN","RORX003",21,0)
 ;ROR*1.5*30   OCT 2016    M FERRARESE  Changing the display for "Sex" to "Birth Sex"
"RTN","RORX003",22,0)
 ;
"RTN","RORX003",23,0)
 ;ROR*1.5*31   MAY 2017    M FERRARESE  Adding PACT and PCP as additional identifiers.
"RTN","RORX003",24,0)
 ;                                      
"RTN","RORX003",25,0)
 ;******************************************************************************
"RTN","RORX003",26,0)
 ;******************************************************************************
"RTN","RORX003",27,0)
 Q
"RTN","RORX003",28,0)
 ;
"RTN","RORX003",29,0)
 ;***** OUTPUTS THE REPORT HEADER
"RTN","RORX003",30,0)
 ;
"RTN","RORX003",31,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX003",32,0)
 ;
"RTN","RORX003",33,0)
 ; Return Values:
"RTN","RORX003",34,0)
 ;       <0  Error code
"RTN","RORX003",35,0)
 ;       >0  IEN of the HEADER element
"RTN","RORX003",36,0)
 ;
"RTN","RORX003",37,0)
HEADER(PARTAG) ;
"RTN","RORX003",38,0)
 N COLUMNS,HEADER,NAME,NOTES,TMP
"RTN","RORX003",39,0)
 S HEADER=$$HEADER^RORXU002(.RORTSK,PARTAG)
"RTN","RORX003",40,0)
 Q:HEADER<0 HEADER
"RTN","RORX003",41,0)
 S NOTES=$$ADDVAL^RORTSK11(RORTSK,"NOTES",,HEADER)
"RTN","RORX003",42,0)
 D ADDVAL^RORTSK11(RORTSK,"AGE_BASE_DATE",RORAGEDT,NOTES)
"RTN","RORX003",43,0)
 ;---
"RTN","RORX003",44,0)
 S COLUMNS=$$ADDVAL^RORTSK11(RORTSK,"TBLDEF",,HEADER)
"RTN","RORX003",45,0)
 Q:COLUMNS<0 COLUMNS
"RTN","RORX003",46,0)
 D ADDATTR^RORTSK11(RORTSK,COLUMNS,"HEADER","1")
"RTN","RORX003",47,0)
 D ADDATTR^RORTSK11(RORTSK,COLUMNS,"FOOTER","1")
"RTN","RORX003",48,0)
 D ADDATTR^RORTSK11(RORTSK,COLUMNS,"NAME","PATIENTS")
"RTN","RORX003",49,0)
 S RORFL798=".01",RORFLICR=""
"RTN","RORX003",50,0)
 ;--- Required columns
"RTN","RORX003",51,0)
 F NAME="#","NAME"  D
"RTN","RORX003",52,0)
 . S TMP=$$ADDVAL^RORTSK11(RORTSK,"COLUMN",,COLUMNS)
"RTN","RORX003",53,0)
 . D ADDATTR^RORTSK11(RORTSK,TMP,"NAME",NAME)
"RTN","RORX003",54,0)
 ;--- SSN or LAST4
"RTN","RORX003",55,0)
 S NAME=$S($$OPTCOL^RORXU006("SSN"):"SSN",1:"LAST4")
"RTN","RORX003",56,0)
 S TMP=$$ADDVAL^RORTSK11(RORTSK,"COLUMN",,COLUMNS)  Q:TMP<0 TMP
"RTN","RORX003",57,0)
 D ADDATTR^RORTSK11(RORTSK,TMP,"NAME",NAME)
"RTN","RORX003",58,0)
 ;--- Optional columns
"RTN","RORX003",59,0)
 F NAME="DOB","AGE","BIRTHSEX","RACE","ETHN","RISK","SELDT","CONFDT","UTIL","DOD"  D
"RTN","RORX003",60,0)
 . Q:'$$OPTCOL^RORXU006(NAME)
"RTN","RORX003",61,0)
 . S TMP=$$ADDVAL^RORTSK11(RORTSK,"COLUMN",,COLUMNS)
"RTN","RORX003",62,0)
 . D ADDATTR^RORTSK11(RORTSK,TMP,"NAME",NAME)
"RTN","RORX003",63,0)
 ; --- ICN if selected must be last column on report
"RTN","RORX003",64,0)
 I $$PARAM^RORTSK01("PATIENTS","ICN") D ICNHDR^RORXU006(RORTSK,COLUMNS)
"RTN","RORX003",65,0)
 I $$PARAM^RORTSK01("PATIENTS","PACT") D PACTHDR^RORXU006(RORTSK,COLUMNS)
"RTN","RORX003",66,0)
 I $$PARAM^RORTSK01("PATIENTS","PCP") D PCPHDR^RORXU006(RORTSK,COLUMNS)
"RTN","RORX003",67,0)
 ;---
"RTN","RORX003",68,0)
 S:$$OPTCOL^RORXU006("CONFDT") RORFL798=RORFL798_";2"
"RTN","RORX003",69,0)
 S:$$OPTCOL^RORXU006("SELDT") RORFL798=RORFL798_";3.2"
"RTN","RORX003",70,0)
 Q HEADER
"RTN","RORX003",71,0)
 ;
"RTN","RORX003",72,0)
 ;***** COMPILES THE "GENERAL UTLIZATION AND DEMOGRAPHICS" REPORT
"RTN","RORX003",73,0)
 ; REPORT CODE: 003
"RTN","RORX003",74,0)
 ;
"RTN","RORX003",75,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORX003",76,0)
 ;
"RTN","RORX003",77,0)
 ; Return Values:
"RTN","RORX003",78,0)
 ;       <0  Error code
"RTN","RORX003",79,0)
 ;        0  Ok
"RTN","RORX003",80,0)
 ;
"RTN","RORX003",81,0)
UTLDMG(RORTSK) ;
"RTN","RORX003",82,0)
 N RORAGEDT      ; Base date for age calculations
"RTN","RORX003",83,0)
 N RORDTE0       ; Beginning of the Date Entered "sliding window"
"RTN","RORX003",84,0)
 N ROREDT        ; End date
"RTN","RORX003",85,0)
 N RORFL798      ; Fields to load from the file #798
"RTN","RORX003",86,0)
 N RORFLICR      ; Fields to load from the file #799.4
"RTN","RORX003",87,0)
 N RORREG        ; Registry IEN
"RTN","RORX003",88,0)
 N RORRISK       ; Risk factor counters
"RTN","RORX003",89,0)
 N RORSDT        ; Start date
"RTN","RORX003",90,0)
 N RORSUM        ; Summary data
"RTN","RORX003",91,0)
 N RORUTIL       ; Requested utilization types
"RTN","RORX003",92,0)
 N RORUCNT       ; Utilization counters
"RTN","RORX003",93,0)
 N RORCDLIST     ; Flag to indicate whether a clinic or division list exists
"RTN","RORX003",94,0)
 N RORCDSTDT     ; Start date for clinic/division utilization search
"RTN","RORX003",95,0)
 N RORCDENDT     ; End date for clinic/division utilization search
"RTN","RORX003",96,0)
 ;
"RTN","RORX003",97,0)
 N CNT,ECNT,IEN,IENS,PARAMS,PATIENTS,RC,REPORT,RORPTN,SFLAGS,TMP,XREFNODE
"RTN","RORX003",98,0)
 N RCC,FLAG,DFN
"RTN","RORX003",99,0)
 ;--- Root node of the report
"RTN","RORX003",100,0)
 S REPORT=$$ADDVAL^RORTSK11(RORTSK,"REPORT")
"RTN","RORX003",101,0)
 Q:REPORT<0 REPORT
"RTN","RORX003",102,0)
 ;
"RTN","RORX003",103,0)
 ;=== Get and prepare the report parameters
"RTN","RORX003",104,0)
 S RORREG=$$PARAM^RORTSK01("REGIEN")
"RTN","RORX003",105,0)
 S PARAMS=$$PARAMS^RORXU002(.RORTSK,REPORT,.RORSDT,.ROREDT,.SFLAGS)
"RTN","RORX003",106,0)
 Q:PARAMS<0 PARAMS
"RTN","RORX003",107,0)
 ;--- Default set of columns for the summary-only report
"RTN","RORX003",108,0)
 S XREFNODE=$NA(RORTSK("PARAMS","OPTIONAL_COLUMNS","C"))
"RTN","RORX003",109,0)
 I $$PARAM^RORTSK01("OPTIONS","SUMMARY")  D
"RTN","RORX003",110,0)
 . F TMP="RACE","RISK","AGE","BIRTHSEX","UTIL"  D
"RTN","RORX003",111,0)
 . . S @XREFNODE@(TMP)=""
"RTN","RORX003",112,0)
 S:$$OPTCOL^RORXU006("RACE") @XREFNODE@("ETHN")=""
"RTN","RORX003",113,0)
 ;--- Construct the description of utilization types
"RTN","RORX003",114,0)
 I '$$PARAM^RORTSK01("UTIL_TYPES","ALL")  D
"RTN","RORX003",115,0)
 . M RORUTIL=RORTSK("PARAMS","UTIL_TYPES","C")
"RTN","RORX003",116,0)
 E  S RORUTIL("ALL")=1
"RTN","RORX003",117,0)
 S TMP=$$OPTXT^RORXU002(.RORUTIL,7980000.019)
"RTN","RORX003",118,0)
 D ADDVAL^RORTSK11(RORTSK,"UTIL_TYPES",TMP,PARAMS)
"RTN","RORX003",119,0)
 ;
"RTN","RORX003",120,0)
 ;=== Initialize constants and variables
"RTN","RORX003",121,0)
 S RORPTN=$$REGSIZE^RORUTL02(+RORREG)  S:RORPTN<0 RORPTN=0
"RTN","RORX003",122,0)
 S XREFNODE=$NA(^RORDATA(798,"AC",RORREG)),ECNT=0
"RTN","RORX003",123,0)
 S TMP=$$FMDIFF^XLFDT(ROREDT,RORSDT)
"RTN","RORX003",124,0)
 S RORAGEDT=$$FMADD^XLFDT(RORSDT,TMP\2)
"RTN","RORX003",125,0)
 S RORDTE0=$P($$FMTE^XLFDT(DT,7),"/")-10  ; 10 year "sliding window"
"RTN","RORX003",126,0)
 ;
"RTN","RORX003",127,0)
 S FLAG=$G(RORTSK("PARAMS","ICDFILT","A","FILTER"))
"RTN","RORX003",128,0)
 ;
"RTN","RORX003",129,0)
 ;=== Set up Clinic/Division list parameters
"RTN","RORX003",130,0)
 S RORCDLIST=$$CDPARMS^RORXU001(.RORTSK,.RORCDSTDT,.RORCDENDT)
"RTN","RORX003",131,0)
 ;
"RTN","RORX003",132,0)
 D
"RTN","RORX003",133,0)
 . ;=== Report header
"RTN","RORX003",134,0)
 . S RC=$$HEADER(REPORT)  Q:RC<0
"RTN","RORX003",135,0)
 . ;---
"RTN","RORX003",136,0)
 . S PATIENTS=$$ADDVAL^RORTSK11(RORTSK,"PATIENTS",,REPORT)
"RTN","RORX003",137,0)
 . I PATIENTS<0  S RC=+PATIENTS  Q
"RTN","RORX003",138,0)
 . D ADDATTR^RORTSK11(RORTSK,PATIENTS,"TABLE","PATIENTS")
"RTN","RORX003",139,0)
 . ;=== Browse through the registry records
"RTN","RORX003",140,0)
 . D TPPSETUP^RORTSK01(95)
"RTN","RORX003",141,0)
 . S (CNT,IEN,RC)=0
"RTN","RORX003",142,0)
 . F  S IEN=$O(@XREFNODE@(IEN))  Q:IEN'>0  D  Q:RC<0
"RTN","RORX003",143,0)
 . . ;--- Calculate 'progress' for the GUI display
"RTN","RORX003",144,0)
 . . S TMP=$S(RORPTN>0:CNT/RORPTN,1:"")
"RTN","RORX003",145,0)
 . . S RC=$$LOOP^RORTSK01(TMP)  Q:RC<0
"RTN","RORX003",146,0)
 . . S IENS=IEN_",",CNT=CNT+1
"RTN","RORX003",147,0)
 . . ;-- Get patient DFN
"RTN","RORX003",148,0)
 . . S DFN=$$PTIEN^RORUTL01(IEN) Q:DFN'>0
"RTN","RORX003",149,0)
 . . ;--- Check for patient list and quit if not in list
"RTN","RORX003",150,0)
 . . I $D(RORTSK("PARAMS","PATIENTS","C")),'$D(RORTSK("PARAMS","PATIENTS","C",DFN)) Q
"RTN","RORX003",151,0)
 . . ;--- Check if the patient should be skipped
"RTN","RORX003",152,0)
 . . Q:$$SKIP^RORXU005(IEN,SFLAGS,RORSDT,ROREDT)
"RTN","RORX003",153,0)
 . . ;--- Check if the ICD Filter includes or excludes the patient
"RTN","RORX003",154,0)
 . . S RCC=0
"RTN","RORX003",155,0)
 . . I FLAG'="ALL" D
"RTN","RORX003",156,0)
 . . . S RCC=$$ICD^RORXU010(DFN)
"RTN","RORX003",157,0)
 . . I (FLAG="INCLUDE")&(RCC=0) Q
"RTN","RORX003",158,0)
 . . I (FLAG="EXCLUDE")&(RCC=1) Q
"RTN","RORX003",159,0)
 . . ;--- End of ICD check.
"RTN","RORX003",160,0)
 . . ;--- Check for Clinic or Division list and quit if not in list
"RTN","RORX003",161,0)
 . . I RORCDLIST,'$$CDUTIL^RORXU001(.RORTSK,DFN,RORCDSTDT,RORCDENDT) Q
"RTN","RORX003",162,0)
 . . ;--- Process the registry record
"RTN","RORX003",163,0)
 . . S TMP=$$PATIENT^RORX003A(IENS,PATIENTS)
"RTN","RORX003",164,0)
 . . I TMP<0  S ECNT=ECNT+1  Q
"RTN","RORX003",165,0)
 . Q:RC<0
"RTN","RORX003",166,0)
 . ;
"RTN","RORX003",167,0)
 . ;=== Report summary
"RTN","RORX003",168,0)
 . D TPPSETUP^RORTSK01(5)
"RTN","RORX003",169,0)
 . S RC=$$SUMMARY^RORX003A(REPORT,PATIENTS)  Q:RC<0
"RTN","RORX003",170,0)
 . ;
"RTN","RORX003",171,0)
 . ;=== Summary only
"RTN","RORX003",172,0)
 . S TMP=$$PARAM^RORTSK01("OPTIONS","COMPLETE")
"RTN","RORX003",173,0)
 . D:'TMP UPDVAL^RORTSK11(RORTSK,PATIENTS,,,1)
"RTN","RORX003",174,0)
 ;
"RTN","RORX003",175,0)
 ;=== Cleanup
"RTN","RORX003",176,0)
 Q $S(RC<0:RC,ECNT>0:-43,1:0)
"RTN","RORX003A")
0^4^B54138636^B49665251
"RTN","RORX003A",1,0)
RORX003A ;HCIOFO/SG - GENERAL UTILIZATION AND DEMOGRAPHICS ;11/14/06 8:50am
"RTN","RORX003A",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**1,21,30,31**;Feb 17, 2006;Build 62
"RTN","RORX003A",3,0)
 ;
"RTN","RORX003A",4,0)
 ; This routine uses the following IAs:
"RTN","RORX003A",5,0)
 ;
"RTN","RORX003A",6,0)
 ; #10061        2^VADPT (supported)
"RTN","RORX003A",7,0)
 ;
"RTN","RORX003A",8,0)
 Q
"RTN","RORX003A",9,0)
 ;
"RTN","RORX003A",10,0)
 ;** MODIFICATIONS **
"RTN","RORX003A",11,0)
 ;ROR*1.5*21   SEP 2013    T KOPP       Added ICN as last report column if
"RTN","RORX003A",12,0)
 ;                                      additional identifier option selected
"RTN","RORX003A",13,0)
 ;ROR*1.5*30   OCT 2016   M FERRARESE   Changing the display for "Sex" to "Birth Sex"
"RTN","RORX003A",14,0)
 ;
"RTN","RORX003A",15,0)
 ;ROR*1.5*31   MAY 2017   M FERRARESE   Adding PACT and PCP as additional identifiers.
"RTN","RORX003A",16,0)
 ;                                                                           
"RTN","RORX003A",17,0)
 ;**
"RTN","RORX003A",18,0)
 ;***** INCREMENTS SUMMARY COUNTER
"RTN","RORX003A",19,0)
INCSUM(SUMMARY,VAL) ;
"RTN","RORX003A",20,0)
 S:$G(VAL)="" VAL="NO DATA"
"RTN","RORX003A",21,0)
 S RORSUM(SUMMARY,VAL)=$G(RORSUM(SUMMARY,VAL))+1
"RTN","RORX003A",22,0)
 Q
"RTN","RORX003A",23,0)
 ;
"RTN","RORX003A",24,0)
 ;***** ADDS THE PATIENT DATA TO THE REPORT
"RTN","RORX003A",25,0)
 ;
"RTN","RORX003A",26,0)
 ; IENS          IENS of the patient's record in the registry
"RTN","RORX003A",27,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX003A",28,0)
 ;
"RTN","RORX003A",29,0)
 ; Return Values:
"RTN","RORX003A",30,0)
 ;       <0  Error code
"RTN","RORX003A",31,0)
 ;        0  Ok
"RTN","RORX003A",32,0)
 ;       >0  Skip the patient
"RTN","RORX003A",33,0)
 ;
"RTN","RORX003A",34,0)
PATIENT(IENS,PARTAG) ;
"RTN","RORX003A",35,0)
 N DFN,IEN,NAME,PTAG,RC,RORBUF,RORMSG,TMP,UTIL,VA,VADM,VAERR,VAHOW,VAPTYP,VAROOT
"RTN","RORX003A",36,0)
 S RC=0
"RTN","RORX003A",37,0)
 ;
"RTN","RORX003A",38,0)
 ;--- Get the data from the ROR REGISTRY RECORD file
"RTN","RORX003A",39,0)
 I $G(RORFL798)'=""  D  Q:RC<0 RC
"RTN","RORX003A",40,0)
 . D GETS^DIQ(798,IENS,RORFL798,"I","RORBUF","RORMSG")
"RTN","RORX003A",41,0)
 . S:$G(DIERR) RC=$$DBS^RORERR("RORMSG",-9,,,798,IENS)
"RTN","RORX003A",42,0)
 S DFN=$G(RORBUF(798,IENS,.01,"I"))
"RTN","RORX003A",43,0)
 ;
"RTN","RORX003A",44,0)
 ;--- Skip a patient without utilization
"RTN","RORX003A",45,0)
 S UTIL=$$UTIL^RORXU003(RORSDT,ROREDT,DFN,.RORUTIL)
"RTN","RORX003A",46,0)
 Q:'UTIL 1
"RTN","RORX003A",47,0)
 ;
"RTN","RORX003A",48,0)
 ;--- Get the data from the ROR HIV STUDY file
"RTN","RORX003A",49,0)
 I $G(RORFLICR)'=""  D  Q:RC<0 RC
"RTN","RORX003A",50,0)
 . D GETS^DIQ(799.4,IENS,RORFLICR,"I","RORBUF","RORMSG")
"RTN","RORX003A",51,0)
 . I $G(DIERR),'$D(RORMSG("DIERR","E",601))  D  Q
"RTN","RORX003A",52,0)
 . . S RC=$$DBS^RORERR("RORMSG",-9,,,799.4,IENS)
"RTN","RORX003A",53,0)
 ;
"RTN","RORX003A",54,0)
 ;--- Load the demographic data
"RTN","RORX003A",55,0)
 D 2^VADPT
"RTN","RORX003A",56,0)
 ;
"RTN","RORX003A",57,0)
 ;--- The <PATIENT> tag
"RTN","RORX003A",58,0)
 S PTAG=$$ADDVAL^RORTSK11(RORTSK,"PATIENT",,PARTAG,,DFN)
"RTN","RORX003A",59,0)
 Q:PTAG<0 PTAG  S RORSUM=$G(RORSUM)+1
"RTN","RORX003A",60,0)
 ;--- Patient Name
"RTN","RORX003A",61,0)
 D ADDVAL^RORTSK11(RORTSK,"NAME",VADM(1),PTAG,1)
"RTN","RORX003A",62,0)
 ;--- SSN or LAST4
"RTN","RORX003A",63,0)
 I $$OPTCOL^RORXU006("SSN")  D
"RTN","RORX003A",64,0)
 . D ADDVAL^RORTSK11(RORTSK,"SSN",$P(VADM(2),U),PTAG,2)
"RTN","RORX003A",65,0)
 E  D ADDVAL^RORTSK11(RORTSK,"LAST4",VA("BID"),PTAG,2)
"RTN","RORX003A",66,0)
 ;
"RTN","RORX003A",67,0)
 ;--- Date of Birth
"RTN","RORX003A",68,0)
 D:$$OPTCOL^RORXU006("DOB")
"RTN","RORX003A",69,0)
 . S TMP=$$DATE^RORXU002(VADM(3)\1)
"RTN","RORX003A",70,0)
 . D ADDVAL^RORTSK11(RORTSK,"DOB",TMP,PTAG,1)
"RTN","RORX003A",71,0)
 . S TMP=$P($$FMTE^XLFDT(TMP,7),"/")
"RTN","RORX003A",72,0)
 . D INCSUM("DOB",$S(TMP'<RORDTE0:TMP,TMP>0:0,1:""))
"RTN","RORX003A",73,0)
 ;
"RTN","RORX003A",74,0)
 ;--- Age
"RTN","RORX003A",75,0)
 D:$$OPTCOL^RORXU006("AGE")
"RTN","RORX003A",76,0)
 . S TMP=+$G(VADM(6))  ; Date of Death
"RTN","RORX003A",77,0)
 . S TMP=$S(TMP'>0:RORAGEDT,TMP<RORAGEDT:TMP,1:RORAGEDT)
"RTN","RORX003A",78,0)
 . S TMP=$$FMDIFF^XLFDT(TMP,+VADM(3))\365
"RTN","RORX003A",79,0)
 . D ADDVAL^RORTSK11(RORTSK,"AGE",$S(TMP>0:TMP,1:""),PTAG,1)
"RTN","RORX003A",80,0)
 . Q:TMP'>0
"RTN","RORX003A",81,0)
 . S RORSUM("AGE")=$G(RORSUM("AGE"))+1
"RTN","RORX003A",82,0)
 . S RORSUM("AGE","Average")=$G(RORSUM("AGE","Average"))+TMP
"RTN","RORX003A",83,0)
 . D INCSUM("AGE",TMP-(TMP#10))
"RTN","RORX003A",84,0)
 ;
"RTN","RORX003A",85,0)
 ;--- Birth Sex
"RTN","RORX003A",86,0)
 D:$$OPTCOL^RORXU006("BIRTHSEX")
"RTN","RORX003A",87,0)
 . S TMP=$P(VADM(5),U,2)
"RTN","RORX003A",88,0)
 . D ADDVAL^RORTSK11(RORTSK,"BIRTHSEX",TMP,PTAG,1)
"RTN","RORX003A",89,0)
 . D INCSUM("BIRTHSEX",TMP)
"RTN","RORX003A",90,0)
 ;
"RTN","RORX003A",91,0)
 ;--- Race
"RTN","RORX003A",92,0)
 D:$$OPTCOL^RORXU006("RACE")
"RTN","RORX003A",93,0)
 . N I,SUMVAL,TABLE
"RTN","RORX003A",94,0)
 . S TABLE=$$ADDVAL^RORTSK11(RORTSK,"RACES",,PTAG)
"RTN","RORX003A",95,0)
 . I $G(VADM(12))>0  S I=""  D
"RTN","RORX003A",96,0)
 . . F  S I=$O(VADM(12,I))  Q:I=""  D
"RTN","RORX003A",97,0)
 . . . S SUMVAL=$P(VADM(12,I),U,2)
"RTN","RORX003A",98,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"RACE",SUMVAL,TABLE)
"RTN","RORX003A",99,0)
 . . S:VADM(12)>1 SUMVAL="MULTIPLE VALUES"
"RTN","RORX003A",100,0)
 . E  D ADDVAL^RORTSK11(RORTSK,"RACE",,TABLE)
"RTN","RORX003A",101,0)
 . D INCSUM("RACE",$G(SUMVAL))
"RTN","RORX003A",102,0)
 ;
"RTN","RORX003A",103,0)
 ;--- Ethnicity
"RTN","RORX003A",104,0)
 D:$$OPTCOL^RORXU006("RACE")
"RTN","RORX003A",105,0)
 . N I,SUMVAL,TABLE
"RTN","RORX003A",106,0)
 . S TABLE=$$ADDVAL^RORTSK11(RORTSK,"ETHNS",,PTAG)
"RTN","RORX003A",107,0)
 . I $G(VADM(11))>0  S I=""  D
"RTN","RORX003A",108,0)
 . . F  S I=$O(VADM(11,I))  Q:I=""  D
"RTN","RORX003A",109,0)
 . . . S SUMVAL=$P(VADM(11,I),U,2)
"RTN","RORX003A",110,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"ETHN",SUMVAL,TABLE)
"RTN","RORX003A",111,0)
 . . S:VADM(11)>1 SUMVAL="MULTIPLE VALUES"
"RTN","RORX003A",112,0)
 . E  D ADDVAL^RORTSK11(RORTSK,"ETHN",,TABLE)
"RTN","RORX003A",113,0)
 . D INCSUM("ETHN",$G(SUMVAL))
"RTN","RORX003A",114,0)
 ;
"RTN","RORX003A",115,0)
 ;--- Risk factors
"RTN","RORX003A",116,0)
 D:$$OPTCOL^RORXU006("RISK")
"RTN","RORX003A",117,0)
 . N I,RISKS
"RTN","RORX003A",118,0)
 . S RISKS=$$RISKS^RORXU005(+IENS)  S:RISKS<0 RISKS=""
"RTN","RORX003A",119,0)
 . D ADDVAL^RORTSK11(RORTSK,"RISK",RISKS,PTAG)
"RTN","RORX003A",120,0)
 . S RISKS=$TR(RISKS," ")
"RTN","RORX003A",121,0)
 . F I=1:1  S TMP=$P(RISKS,",",I)  Q:TMP'>0  D
"RTN","RORX003A",122,0)
 . . S RORRISK(TMP)=$G(RORRISK(TMP))+1
"RTN","RORX003A",123,0)
 ;
"RTN","RORX003A",124,0)
 ;--- Date Selected
"RTN","RORX003A",125,0)
 D:$$OPTCOL^RORXU006("SELDT")
"RTN","RORX003A",126,0)
 . S TMP=$$DATE^RORXU002($G(RORBUF(798,IENS,3.2,"I"))\1)
"RTN","RORX003A",127,0)
 . D ADDVAL^RORTSK11(RORTSK,"SELDT",TMP,PTAG,1)
"RTN","RORX003A",128,0)
 . S TMP=$P($$FMTE^XLFDT(TMP,7),"/")
"RTN","RORX003A",129,0)
 . D INCSUM("SELDT",$S(TMP'<RORDTE0:TMP,TMP>0:0,1:""))
"RTN","RORX003A",130,0)
 ;
"RTN","RORX003A",131,0)
 ;--- Date Confirmed
"RTN","RORX003A",132,0)
 D:$$OPTCOL^RORXU006("CONFDT")
"RTN","RORX003A",133,0)
 . S TMP=$$DATE^RORXU002($G(RORBUF(798,IENS,2,"I"))\1)
"RTN","RORX003A",134,0)
 . D ADDVAL^RORTSK11(RORTSK,"CONFDT",TMP,PTAG,1)
"RTN","RORX003A",135,0)
 . S TMP=$P($$FMTE^XLFDT(TMP,7),"/")
"RTN","RORX003A",136,0)
 . D INCSUM("CONFDT",$S(TMP'<RORDTE0:TMP,TMP>0:0,1:""))
"RTN","RORX003A",137,0)
 ;
"RTN","RORX003A",138,0)
 ;--- Utilization
"RTN","RORX003A",139,0)
 D:$$OPTCOL^RORXU006("UTIL")
"RTN","RORX003A",140,0)
 . S TMP=$$UTLCODES($P(UTIL,U,2,999))
"RTN","RORX003A",141,0)
 . D ADDVAL^RORTSK11(RORTSK,"UTIL",TMP,PTAG)
"RTN","RORX003A",142,0)
 ;
"RTN","RORX003A",143,0)
 ;--- Date of Death
"RTN","RORX003A",144,0)
 D:$$OPTCOL^RORXU006("DOD")
"RTN","RORX003A",145,0)
 . S TMP=$$DATE^RORXU002(VADM(6)\1)
"RTN","RORX003A",146,0)
 . D ADDVAL^RORTSK11(RORTSK,"DOD",TMP,PTAG,1)
"RTN","RORX003A",147,0)
 . S TMP=$P($$FMTE^XLFDT(TMP,7),"/")
"RTN","RORX003A",148,0)
 . D INCSUM("DOD",$S(TMP'<RORDTE0:TMP,TMP>0:0,1:""))
"RTN","RORX003A",149,0)
 ;
"RTN","RORX003A",150,0)
 ;--- ICN
"RTN","RORX003A",151,0)
 I $$PARAM^RORTSK01("PATIENTS","ICN") D
"RTN","RORX003A",152,0)
 . S:'$D(DFN) DFN=$G(RORBUF(798,IENS,.01,"I"))
"RTN","RORX003A",153,0)
 . D ICNDATA^RORXU006(RORTSK,DFN,PTAG)
"RTN","RORX003A",154,0)
 ;--- PACT
"RTN","RORX003A",155,0)
 I $$PARAM^RORTSK01("PATIENTS","PACT") D
"RTN","RORX003A",156,0)
 . S:'$D(DFN) DFN=$G(RORBUF(798,IENS,.01,"I"))
"RTN","RORX003A",157,0)
 . D PACTDATA^RORXU006(RORTSK,DFN,PTAG)
"RTN","RORX003A",158,0)
 ;
"RTN","RORX003A",159,0)
 ;--- PCP
"RTN","RORX003A",160,0)
 I $$PARAM^RORTSK01("PATIENTS","PCP") D
"RTN","RORX003A",161,0)
 . S:'$D(DFN) DFN=$G(RORBUF(798,IENS,.01,"I"))
"RTN","RORX003A",162,0)
 . D PCPDATA^RORXU006(RORTSK,DFN,PTAG)
"RTN","RORX003A",163,0)
 Q 0
"RTN","RORX003A",164,0)
 ;
"RTN","RORX003A",165,0)
 ;***** GENERATES THE REPORT SUMMARY
"RTN","RORX003A",166,0)
 ;
"RTN","RORX003A",167,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX003A",168,0)
 ;
"RTN","RORX003A",169,0)
 ; PATIENTS      Reference (IEN) to the PATIENTS tag
"RTN","RORX003A",170,0)
 ;
"RTN","RORX003A",171,0)
 ; Return Values:
"RTN","RORX003A",172,0)
 ;       <0  Error code
"RTN","RORX003A",173,0)
 ;        0  Ok
"RTN","RORX003A",174,0)
 ;
"RTN","RORX003A",175,0)
SUMMARY(PARTAG,PATIENTS) ;
"RTN","RORX003A",176,0)
 N AGE,I,RC,RORBUF,SI,SUMMARY,TABLE,TAG,TMP
"RTN","RORX003A",177,0)
 S SUMMARY=$$ADDVAL^RORTSK11(RORTSK,"SUMMARY",,PARTAG)
"RTN","RORX003A",178,0)
 Q:SUMMARY<0 SUMMARY
"RTN","RORX003A",179,0)
 ;
"RTN","RORX003A",180,0)
 ;--- Risk factors
"RTN","RORX003A",181,0)
 D:$D(RORRISK)>1
"RTN","RORX003A",182,0)
 . K RORBUF  D BLD^DIALOG(7980000.016,.RORRISK,,"RORBUF")
"RTN","RORX003A",183,0)
 . D ADDTEXT^RORTSK11(RORTSK,"RISK_FACTORS",.RORBUF,SUMMARY)
"RTN","RORX003A",184,0)
 ;
"RTN","RORX003A",185,0)
 ;--- Simple summaries
"RTN","RORX003A",186,0)
 F SI="RACE","ETHN","BIRTHSEX"  D:$D(RORSUM(SI))>1
"RTN","RORX003A",187,0)
 . S TABLE=$$ADDVAL^RORTSK11(RORTSK,SI_"_SUMMARY",,SUMMARY)
"RTN","RORX003A",188,0)
 . S I=""
"RTN","RORX003A",189,0)
 . F  S I=$O(RORSUM(SI,I))  Q:I=""  D
"RTN","RORX003A",190,0)
 . . S TAG=$$ADDVAL^RORTSK11(RORTSK,SI,I,TABLE)
"RTN","RORX003A",191,0)
 . . D ADDATTR^RORTSK11(RORTSK,TAG,"COUNT",RORSUM(SI,I))
"RTN","RORX003A",192,0)
 ;
"RTN","RORX003A",193,0)
 ;--- Date summaries
"RTN","RORX003A",194,0)
 F SI="DOB","DOD","CONFDT","SELDT"  D:$D(RORSUM(SI))>1
"RTN","RORX003A",195,0)
 . S TABLE=$$ADDVAL^RORTSK11(RORTSK,SI_"_SUMMARY",,SUMMARY)
"RTN","RORX003A",196,0)
 . D:$G(RORSUM(SI,0))>0
"RTN","RORX003A",197,0)
 . . S TAG=$$ADDVAL^RORTSK11(RORTSK,SI,"Before "_RORDTE0,TABLE)
"RTN","RORX003A",198,0)
 . . D ADDATTR^RORTSK11(RORTSK,TAG,"COUNT",RORSUM(SI,0))
"RTN","RORX003A",199,0)
 . S I=0
"RTN","RORX003A",200,0)
 . F  S I=$O(RORSUM(SI,I))  Q:I=""  D
"RTN","RORX003A",201,0)
 . . S TAG=$$ADDVAL^RORTSK11(RORTSK,SI,I,TABLE)
"RTN","RORX003A",202,0)
 . . D ADDATTR^RORTSK11(RORTSK,TAG,"COUNT",RORSUM(SI,I))
"RTN","RORX003A",203,0)
 ;
"RTN","RORX003A",204,0)
 ;--- Age summary
"RTN","RORX003A",205,0)
 I $G(RORSUM("AGE"))>0  D
"RTN","RORX003A",206,0)
 . ;--- Average age
"RTN","RORX003A",207,0)
 . S TMP=$G(RORSUM("AGE","Average"))/RORSUM("AGE")
"RTN","RORX003A",208,0)
 . S RORSUM("AGE","Average")=$J(TMP,0,2)
"RTN","RORX003A",209,0)
 . ;--- Median age
"RTN","RORX003A",210,0)
 . S TMP=$$XREFNODE^RORTSK10(RORTSK,PATIENTS,"AGE")
"RTN","RORX003A",211,0)
 . S:TMP'="" TMP=$$XREFMDNV^RORXU004(TMP,RORSUM("AGE"))
"RTN","RORX003A",212,0)
 . S RORSUM("AGE","Median")=$S(TMP'="":$J(TMP,0,2),1:"")
"RTN","RORX003A",213,0)
 . ;--- Output the table
"RTN","RORX003A",214,0)
 . S TABLE=$$ADDVAL^RORTSK11(RORTSK,"AGE_SUMMARY",,SUMMARY)
"RTN","RORX003A",215,0)
 . S I=""
"RTN","RORX003A",216,0)
 . F  S I=$O(RORSUM("AGE",I))  Q:I=""  D
"RTN","RORX003A",217,0)
 . . S TAG=$$ADDVAL^RORTSK11(RORTSK,"AGE",$S(+I=I:I_"+",1:I),TABLE)
"RTN","RORX003A",218,0)
 . . D ADDATTR^RORTSK11(RORTSK,TAG,"COUNT",RORSUM("AGE",I))
"RTN","RORX003A",219,0)
 ;
"RTN","RORX003A",220,0)
 ;--- Utilization codes
"RTN","RORX003A",221,0)
 D:$D(RORUCNT)>1
"RTN","RORX003A",222,0)
 . K RORBUF  D BLD^DIALOG(7980000.017,.RORUCNT,,"RORBUF")
"RTN","RORX003A",223,0)
 . D ADDTEXT^RORTSK11(RORTSK,"UTIL_CODES",.RORBUF,SUMMARY)
"RTN","RORX003A",224,0)
 ;---
"RTN","RORX003A",225,0)
 Q 0
"RTN","RORX003A",226,0)
 ;
"RTN","RORX003A",227,0)
 ;***** PROCESSES UTILIZATION CODES
"RTN","RORX003A",228,0)
UTLCODES(UCSRC) ;
"RTN","RORX003A",229,0)
 N I,UCLST,UC  S UCLST=""
"RTN","RORX003A",230,0)
 F I=1:1  S UC=$P(UCSRC,U,I)  Q:UC=""  D
"RTN","RORX003A",231,0)
 . S UCLST=UCLST_", "_UC,RORUCNT(UC)=$G(RORUCNT(UC))+1
"RTN","RORX003A",232,0)
 Q $P(UCLST,", ",2,999)
"RTN","RORX004")
0^8^B37005998^B27457448
"RTN","RORX004",1,0)
RORX004 ;HOIFO/BH,SG,VAC - CLINIC FOLLOW UP ;4/7/09 2:06pm
"RTN","RORX004",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**8,13,19,21,31**;Feb 17, 2006;Build 62
"RTN","RORX004",3,0)
 ;
"RTN","RORX004",4,0)
 ; This routine uses the following IAs:
"RTN","RORX004",5,0)
 ;
"RTN","RORX004",6,0)
 ; #10061        2^VADPT (supported)
"RTN","RORX004",7,0)
 ;
"RTN","RORX004",8,0)
 ;******************************************************************************
"RTN","RORX004",9,0)
 ;******************************************************************************
"RTN","RORX004",10,0)
 ;                 --- ROUTINE MODIFICATION LOG ---
"RTN","RORX004",11,0)
 ;        
"RTN","RORX004",12,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORX004",13,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","RORX004",14,0)
 ;ROR*1.5*8    MAR  2010   V CARR       Modified to add panel 180 to GUI.  The
"RTN","RORX004",15,0)
 ;                                      function is to permit a filter on ICD9 
"RTN","RORX004",16,0)
 ;                                      codes to Include or Exclude specific 
"RTN","RORX004",17,0)
 ;                                      ICD9 codes.  An extrinsic is called 
"RTN","RORX004",18,0)
 ;                                      RORXU010 and it is evaluated on return 
"RTN","RORX004",19,0)
 ;                                      as to whether or not to report the 
"RTN","RORX004",20,0)
 ;                                      patient.
"RTN","RORX004",21,0)
 ;ROR*1.5*13   DEC  2010   A SAUNDERS   User can now select specific patients or
"RTN","RORX004",22,0)
 ;                                      divisions for the report.
"RTN","RORX004",23,0)
 ;ROR*1.5*19   FEB  2012   K GUPTA      Support for ICD-10 Coding System
"RTN","RORX004",24,0)
 ;ROR*1.5*21   SEP 2013    T KOPP       Add ICN column if Additional Identifier
"RTN","RORX004",25,0)
 ;                                       requested.
"RTN","RORX004",26,0)
 ;ROR*1.5*31   MAY 2017    M FERRARESE  Adding PACT and PCP as additional identifiers.
"RTN","RORX004",27,0)
 ;******************************************************************************
"RTN","RORX004",28,0)
 ;******************************************************************************
"RTN","RORX004",29,0)
 Q
"RTN","RORX004",30,0)
 ;
"RTN","RORX004",31,0)
 ;***** COMPILES THE "CLINIC FOLLOW UP" REPORT
"RTN","RORX004",32,0)
 ; REPORT CODE: 004
"RTN","RORX004",33,0)
 ;
"RTN","RORX004",34,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORX004",35,0)
 ;
"RTN","RORX004",36,0)
 ; Return Values:
"RTN","RORX004",37,0)
 ;       <0  Error code
"RTN","RORX004",38,0)
 ;        0  Ok
"RTN","RORX004",39,0)
 ;
"RTN","RORX004",40,0)
CLNFLWUP(RORTSK) ;
"RTN","RORX004",41,0)
 N ROREDT        ; End date
"RTN","RORX004",42,0)
 N RORREG        ; Registry IEN
"RTN","RORX004",43,0)
 N RORSDT        ; Start date
"RTN","RORX004",44,0)
 N RORDLIST      ; Flag to indicate if a division list exists
"RTN","RORX004",45,0)
 N RORDSTDT      ; Start date for division utilization search
"RTN","RORX004",46,0)
 N RORDENDT      ; End date for division utilization search
"RTN","RORX004",47,0)
 ;
"RTN","RORX004",48,0)
 N CNT,ECNT,IEN,IENS,PATIENTS,RC,REPORT,RORPTN,SFLAGS,TMP,XREFNODE,DFN
"RTN","RORX004",49,0)
 ;--- Root node of the report
"RTN","RORX004",50,0)
 S REPORT=$$ADDVAL^RORTSK11(RORTSK,"REPORT")
"RTN","RORX004",51,0)
 Q:REPORT<0 REPORT
"RTN","RORX004",52,0)
 ;
"RTN","RORX004",53,0)
 ;--- Get and prepare the report parameters
"RTN","RORX004",54,0)
 S RORREG=$$PARAM^RORTSK01("REGIEN")
"RTN","RORX004",55,0)
 S RC=$$PARAMS(REPORT,.RORSDT,.ROREDT,.SFLAGS)
"RTN","RORX004",56,0)
 Q:RC<0 RC
"RTN","RORX004",57,0)
 ;
"RTN","RORX004",58,0)
 ;--- Initialize constants and variables
"RTN","RORX004",59,0)
 S RORPTN=$$REGSIZE^RORUTL02(+RORREG) S:RORPTN<0 RORPTN=0
"RTN","RORX004",60,0)
 S ECNT=0,XREFNODE=$NA(^RORDATA(798,"AC",RORREG))
"RTN","RORX004",61,0)
 ;
"RTN","RORX004",62,0)
 ;=== Set up Division list parameters
"RTN","RORX004",63,0)
 I $D(RORTSK("PARAMS","DIVISIONS","C")) S RORDLIST=$$CDPARMS^RORXU001(.RORTSK,.RORDSTDT,.RORDENDT)
"RTN","RORX004",64,0)
 ;
"RTN","RORX004",65,0)
 D
"RTN","RORX004",66,0)
 . ;--- Report header
"RTN","RORX004",67,0)
 . S RC=$$HEADER(REPORT) Q:RC<0
"RTN","RORX004",68,0)
 . S PATIENTS=$$ADDVAL^RORTSK11(RORTSK,"PATIENTS",,REPORT)
"RTN","RORX004",69,0)
 . I PATIENTS<0 S RC=+PATIENTS Q
"RTN","RORX004",70,0)
 . D ADDATTR^RORTSK11(RORTSK,PATIENTS,"TABLE","PATIENTS")
"RTN","RORX004",71,0)
 . ;
"RTN","RORX004",72,0)
 . ;--- Browse through the registry records
"RTN","RORX004",73,0)
 . D TPPSETUP^RORTSK01(100)
"RTN","RORX004",74,0)
 . S (CNT,IEN,RC)=0
"RTN","RORX004",75,0)
 . F  S IEN=$O(@XREFNODE@(IEN)) Q:IEN'>0  D  Q:RC<0
"RTN","RORX004",76,0)
 . . S TMP=$S(RORPTN>0:CNT/RORPTN,1:"")
"RTN","RORX004",77,0)
 . . S RC=$$LOOP^RORTSK01(TMP) Q:RC<0
"RTN","RORX004",78,0)
 . . S IENS=IEN_",",CNT=CNT+1
"RTN","RORX004",79,0)
 . . ;--- Get patient DFN
"RTN","RORX004",80,0)
 . . S DFN=$$PTIEN^RORUTL01(IEN) Q:DFN'>0
"RTN","RORX004",81,0)
 . . ;--- Check for patient list and quit if not in list
"RTN","RORX004",82,0)
 . . I $D(RORTSK("PARAMS","PATIENTS","C")),'$D(RORTSK("PARAMS","PATIENTS","C",DFN)) Q
"RTN","RORX004",83,0)
 . . ;--- Check if the patient should be skipped
"RTN","RORX004",84,0)
 . . Q:$$SKIP^RORXU005(IEN,SFLAGS,RORSDT,ROREDT)
"RTN","RORX004",85,0)
 . . ;--- Check for Division list and quit if not in list
"RTN","RORX004",86,0)
 . . I $D(RORTSK("PARAMS","DIVISIONS","C")),'$$CDUTIL^RORXU001(.RORTSK,DFN,RORDSTDT,RORDENDT) Q
"RTN","RORX004",87,0)
 . . ;--- Process the registry record
"RTN","RORX004",88,0)
 . . S TMP=$$PATIENT(IENS,PATIENTS)
"RTN","RORX004",89,0)
 . . I TMP<0 S ECNT=ECNT+1 Q
"RTN","RORX004",90,0)
 . Q:RC<0
"RTN","RORX004",91,0)
 ;
"RTN","RORX004",92,0)
 ;--- Cleanup
"RTN","RORX004",93,0)
 Q $S(RC<0:RC,ECNT>0:-43,1:0)
"RTN","RORX004",94,0)
 ;
"RTN","RORX004",95,0)
 ;***** OUTPUTS THE REPORT HEADER
"RTN","RORX004",96,0)
 ;
"RTN","RORX004",97,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX004",98,0)
 ;
"RTN","RORX004",99,0)
 ; Return Values:
"RTN","RORX004",100,0)
 ;       <0  Error code
"RTN","RORX004",101,0)
 ;        0  Ok
"RTN","RORX004",102,0)
 ;
"RTN","RORX004",103,0)
HEADER(PARTAG) ;
"RTN","RORX004",104,0)
 ;;PATIENTS(#,NAME,LAST4,AGE,DOD,SEEN,LSNDT,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="AGE"
"RTN","RORX004",105,0)
 ;;PATIENTS(#,NAME,LAST4,DOB,DOD,SEEN,LSNDT,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="DOB"
"RTN","RORX004",106,0)
 ;;PATIENTS(#,NAME,LAST4,DOD,SEEN,LSNDT,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="ALL"
"RTN","RORX004",107,0)
 ;
"RTN","RORX004",108,0)
 N HEADER,RC
"RTN","RORX004",109,0)
 S HEADER=$$HEADER^RORXU002(.RORTSK,PARTAG)
"RTN","RORX004",110,0)
 Q:HEADER<0 HEADER
"RTN","RORX004",111,0)
 S RC=$$TBLDEF^RORXU002("HEADER^RORX004",HEADER)
"RTN","RORX004",112,0)
 Q $S(RC<0:RC,1:HEADER)
"RTN","RORX004",113,0)
 ;
"RTN","RORX004",114,0)
 ;***** OUTPUTS THE PARAMETERS TO THE REPORT
"RTN","RORX004",115,0)
 ;
"RTN","RORX004",116,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX004",117,0)
 ;
"RTN","RORX004",118,0)
 ; [.STDT]       Start and end dates of the report
"RTN","RORX004",119,0)
 ; [.ENDT]       are returned via these parameters
"RTN","RORX004",120,0)
 ;
"RTN","RORX004",121,0)
 ; [.FLAGS]      Flags for the $$SKIP^RORXU005 are
"RTN","RORX004",122,0)
 ;               returned via this parameter
"RTN","RORX004",123,0)
 ;
"RTN","RORX004",124,0)
 ; Return Values:
"RTN","RORX004",125,0)
 ;       <0  Error code
"RTN","RORX004",126,0)
 ;       >0  IEN of the PARAMETERS element
"RTN","RORX004",127,0)
 ;
"RTN","RORX004",128,0)
PARAMS(PARTAG,STDT,ENDT,FLAGS) ;
"RTN","RORX004",129,0)
 N PARAMS,TMP
"RTN","RORX004",130,0)
 S PARAMS=$$PARAMS^RORXU002(.RORTSK,PARTAG,.STDT,.ENDT,.FLAGS)
"RTN","RORX004",131,0)
 Q:PARAMS<0 PARAMS
"RTN","RORX004",132,0)
 ;--- Process the list of clinics
"RTN","RORX004",133,0)
 ;patch 13: code from CLINLST has been incorporated into PARAMS^RORXU002
"RTN","RORX004",134,0)
 ;S TMP=$$CLINLST^RORXU006(.RORTSK,PARAMS) ;removed in patch 13
"RTN","RORX004",135,0)
 ;Q:TMP<0 TMP ;removed in patch 13
"RTN","RORX004",136,0)
 ;---
"RTN","RORX004",137,0)
 Q PARAMS
"RTN","RORX004",138,0)
 ;
"RTN","RORX004",139,0)
 ;***** ADDS THE PATIENT DATA TO THE REPORT
"RTN","RORX004",140,0)
 ;
"RTN","RORX004",141,0)
 ; IENS          IENS of the patient's record in the registry
"RTN","RORX004",142,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX004",143,0)
 ;
"RTN","RORX004",144,0)
 ; Return Values:
"RTN","RORX004",145,0)
 ;       <0  Error code
"RTN","RORX004",146,0)
 ;        0  Ok
"RTN","RORX004",147,0)
 ;       >0  Skip the patient
"RTN","RORX004",148,0)
 ;
"RTN","RORX004",149,0)
PATIENT(IENS,PARTAG) ;
"RTN","RORX004",150,0)
 N CHK,CLINAIDS,DFN,IEN,RC,RCC,RORBUF,RORMSG,SEEN,TMP,VA,VADM,VAHOW,VAROOT,FLAG,PTAG,AGE,AGETYPE
"RTN","RORX004",151,0)
 S RC=0
"RTN","RORX004",152,0)
 S DFN=$$PTIEN^RORUTL01(+IENS)
"RTN","RORX004",153,0)
 ;
"RTN","RORX004",154,0)
 ;--- Evaluates patient if ICD filter is Include or Exclude
"RTN","RORX004",155,0)
 S FLAG=$G(RORTSK("PARAMS","ICDFILT","A","FILTER")),RCC=0
"RTN","RORX004",156,0)
 I FLAG'="ALL" D
"RTN","RORX004",157,0)
 .S RCC=$$ICD^RORXU010(DFN)
"RTN","RORX004",158,0)
 I (FLAG="INCLUDE")&(RCC=0) Q 1
"RTN","RORX004",159,0)
 I (FLAG="EXCLUDE")&(RCC=1) Q 1
"RTN","RORX004",160,0)
 ;
"RTN","RORX004",161,0)
 ;--- Only include patients that received utilization if care is true
"RTN","RORX004",162,0)
 I $$PARAM^RORTSK01("PATIENTS","CAREONLY") D  Q:'TMP 1
"RTN","RORX004",163,0)
 . S CHK("ALL")=""
"RTN","RORX004",164,0)
 . S TMP=$$UTIL^RORXU003(RORSDT,ROREDT,DFN,.CHK)
"RTN","RORX004",165,0)
 ;
"RTN","RORX004",166,0)
 ;--- Select Seen/NotSeen patients
"RTN","RORX004",167,0)
 S SEEN=$$SEEN^RORXU001(RORSDT,ROREDT,DFN)
"RTN","RORX004",168,0)
 Q:'$$PARAM^RORTSK01("PATIENTS",$S(SEEN:"SEEN",1:"NOTSEEN")) 1
"RTN","RORX004",169,0)
 ;
"RTN","RORX004",170,0)
 ;--- Load the demographic data
"RTN","RORX004",171,0)
 D 2^VADPT
"RTN","RORX004",172,0)
 ;
"RTN","RORX004",173,0)
 ;--- The <PATIENT> tag
"RTN","RORX004",174,0)
 S PTAG=$$ADDVAL^RORTSK11(RORTSK,"PATIENT",,PARTAG,,DFN)
"RTN","RORX004",175,0)
 Q:PTAG<0 PTAG
"RTN","RORX004",176,0)
 ;
"RTN","RORX004",177,0)
 ;--- Patient Name
"RTN","RORX004",178,0)
 D ADDVAL^RORTSK11(RORTSK,"NAME",VADM(1),PTAG,1)
"RTN","RORX004",179,0)
 ;--- Last 4 digits of the SSN
"RTN","RORX004",180,0)
 D ADDVAL^RORTSK11(RORTSK,"LAST4",VA("BID"),PTAG,2)
"RTN","RORX004",181,0)
 ;
"RTN","RORX004",182,0)
 ;--- Patient age/DOB 
"RTN","RORX004",183,0)
 S AGETYPE=$$PARAM^RORTSK01("AGE_RANGE","TYPE") I AGETYPE'="ALL" D
"RTN","RORX004",184,0)
 . S AGE=$S(AGETYPE="AGE":$P(VADM(4),U),AGETYPE="DOB":$$DATE^RORXU002($P(VADM(3),U)\1),1:"")
"RTN","RORX004",185,0)
 . D ADDVAL^RORTSK11(RORTSK,AGETYPE,AGE,PTAG,1)
"RTN","RORX004",186,0)
 ;
"RTN","RORX004",187,0)
 ;--- Date of Death
"RTN","RORX004",188,0)
 S TMP=$$DATE^RORXU002($P(VADM(6),U)\1)
"RTN","RORX004",189,0)
 D ADDVAL^RORTSK11(RORTSK,"DOD",TMP,PTAG,1)
"RTN","RORX004",190,0)
 ;--- Seen/Not Seen
"RTN","RORX004",191,0)
 D ADDVAL^RORTSK11(RORTSK,"SEEN",SEEN,PTAG,1)
"RTN","RORX004",192,0)
 ;--- The latest date the patient was seen at any one of
"RTN","RORX004",193,0)
 ;--- the given clinics
"RTN","RORX004",194,0)
 S TMP=$$LASTVSIT^RORXU001(DFN)\1
"RTN","RORX004",195,0)
 D ADDVAL^RORTSK11(RORTSK,"LSNDT",$$DATE^RORXU002(TMP),PTAG,1)
"RTN","RORX004",196,0)
 ;
"RTN","RORX004",197,0)
 ; ICN, if requested
"RTN","RORX004",198,0)
 I $$PARAM^RORTSK01("PATIENTS","ICN") D
"RTN","RORX004",199,0)
 . S TMP=$$ICN^RORUTL02(DFN)
"RTN","RORX004",200,0)
 . D ADDVAL^RORTSK11(RORTSK,"ICN",TMP,PTAG,1)
"RTN","RORX004",201,0)
 ;
"RTN","RORX004",202,0)
 ; PACT, if requested
"RTN","RORX004",203,0)
 I $$PARAM^RORTSK01("PATIENTS","PACT") D
"RTN","RORX004",204,0)
 . S TMP=$$PACT^RORUTL02(DFN)
"RTN","RORX004",205,0)
 . D ADDVAL^RORTSK11(RORTSK,"PACT",TMP,PTAG,1)
"RTN","RORX004",206,0)
 ;
"RTN","RORX004",207,0)
 ; PCP, if requested
"RTN","RORX004",208,0)
 I $$PARAM^RORTSK01("PATIENTS","PCP") D
"RTN","RORX004",209,0)
 . S TMP=$$PCP^RORUTL02(DFN)
"RTN","RORX004",210,0)
 . D ADDVAL^RORTSK11(RORTSK,"PCP",TMP,PTAG,1)
"RTN","RORX004",211,0)
 Q 0
"RTN","RORX005")
0^9^B15238780^B10629002
"RTN","RORX005",1,0)
RORX005 ;HCIOFO/BH,SG - INPATIENT UTILIZATION ;10/14/05 1:53pm
"RTN","RORX005",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**21,31**;Feb 17, 2006;Build 62
"RTN","RORX005",3,0)
 ;
"RTN","RORX005",4,0)
 ;******************************************************************************
"RTN","RORX005",5,0)
 ;                       --- ROUTINE MODIFICATION LOG ---
"RTN","RORX005",6,0)
 ;        
"RTN","RORX005",7,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORX005",8,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","RORX005",9,0)
 ;ROR*1.5*21   SEP 2013    T KOPP       Add ICN column if Additional Identifier
"RTN","RORX005",10,0)
 ;                                       requested.
"RTN","RORX005",11,0)
 ;ROR*1.5*31   MAY 2017    M FERRARESE  Adding PACT, PCP, and AGE/DOB as additional
"RTN","RORX005",12,0)
 ;                                      identifiers.  
"RTN","RORX005",13,0)
 ;******************************************************************************
"RTN","RORX005",14,0)
 ;
"RTN","RORX005",15,0)
 Q
"RTN","RORX005",16,0)
 ;
"RTN","RORX005",17,0)
 ;***** OUTPUTS THE REPORT HEADER
"RTN","RORX005",18,0)
 ;
"RTN","RORX005",19,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX005",20,0)
 ;
"RTN","RORX005",21,0)
 ; Return Values:
"RTN","RORX005",22,0)
 ;       <0  Error code
"RTN","RORX005",23,0)
 ;       >0  IEN of the HEADER element
"RTN","RORX005",24,0)
 ;
"RTN","RORX005",25,0)
HEADER(PARTAG) ;
"RTN","RORX005",26,0)
 ;;HU_DAYS(#,NAME,LAST4,AGE,NST,ND,NSS,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="AGE"
"RTN","RORX005",27,0)
 ;;HU_DAYS(#,NAME,LAST4,DOB,NST,ND,NSS,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="DOB"
"RTN","RORX005",28,0)
 ;;HU_DAYS(#,NAME,LAST4,NST,ND,NSS,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="ALL"
"RTN","RORX005",29,0)
 ;;HU_STAYS(#,NAME,LAST4,AGE,NST,ND,NSS,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="AGE"
"RTN","RORX005",30,0)
 ;;HU_STAYS(#,NAME,LAST4,DOB,NST,ND,NSS,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="DOB"
"RTN","RORX005",31,0)
 ;;HU_STAYS(#,NAME,LAST4,NST,ND,NSS,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="ALL"
"RTN","RORX005",32,0)
 ;;BEDSECTIONS(#,NAME,NP,NST,ND,MLOS,NSS)
"RTN","RORX005",33,0)
 ;;NOBS(#,NAME,LAST4,AGE,DATE,PTF,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="AGE"
"RTN","RORX005",34,0)
 ;;NOBS(#,NAME,LAST4,DOB,DATE,PTF,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="DOB"
"RTN","RORX005",35,0)
 ;;NOBS(#,NAME,LAST4,DATE,PTF,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="ALL"
"RTN","RORX005",36,0)
 ;;STAYS(NP,NST)
"RTN","RORX005",37,0)
 ;
"RTN","RORX005",38,0)
 N HEADER,RC
"RTN","RORX005",39,0)
 S HEADER=$$HEADER^RORXU002(.RORTSK,PARTAG)
"RTN","RORX005",40,0)
 Q:HEADER<0 HEADER
"RTN","RORX005",41,0)
 S RC=$$TBLDEF^RORXU002("HEADER^RORX005",HEADER)
"RTN","RORX005",42,0)
 Q $S(RC<0:RC,1:HEADER)
"RTN","RORX005",43,0)
 ;
"RTN","RORX005",44,0)
 ;
"RTN","RORX005",45,0)
 ;***** COMPILES THE "INPATIENT UTILIZATION" REPORT
"RTN","RORX005",46,0)
 ; REPORT CODE: 005
"RTN","RORX005",47,0)
 ;
"RTN","RORX005",48,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORX005",49,0)
 ;
"RTN","RORX005",50,0)
 ; The ^TMP("RORX005",$J) global node is used by this function.
"RTN","RORX005",51,0)
 ;
"RTN","RORX005",52,0)
 ; ^TMP("RORX005",$J,
"RTN","RORX005",53,0)
 ;
"RTN","RORX005",54,0)
 ;   "IP",             Number of inpatients
"RTN","RORX005",55,0)
 ;     DFN,            Last 4 digits of SSN^National ICN^Patient care team PACT^Primary Care provider PCP^Age/DOB
"RTN","RORX005",56,0)
 ;       "D")          Number of days
"RTN","RORX005",57,0)
 ;       "S")          Number of overnight stays
"RTN","RORX005",58,0)
 ;       "V")          Number of short stays
"RTN","RORX005",59,0)
 ;
"RTN","RORX005",60,0)
 ;   "IPB",
"RTN","RORX005",61,0)
 ;#    BedSectID,
"RTN","RORX005",62,0)
 ;       "D")          Number of days
"RTN","RORX005",63,0)
 ;       "P",          Number of patients
"RTN","RORX005",64,0)
 ;         DFN)
"RTN","RORX005",65,0)
 ;       "S")          Number of overnight stays
"RTN","RORX005",66,0)
 ;       "V")          Number of short stays
"RTN","RORX005",67,0)
 ;     "B",
"RTN","RORX005",68,0)
 ;       BedSectName,
"RTN","RORX005",69,0)
 ;%        BedSectID)
"RTN","RORX005",70,0)
 ;
"RTN","RORX005",71,0)
 ;   "IPD",            Total number of days
"RTN","RORX005",72,0)
 ;     NumOfDays,      Number of patients
"RTN","RORX005",73,0)
 ;       PatientName,
"RTN","RORX005",74,0)
 ;         DFN)
"RTN","RORX005",75,0)
 ;
"RTN","RORX005",76,0)
 ;   "IPMLOS",         Median Length Of Stay
"RTN","RORX005",77,0)
 ;*    BedSectID,      Median Length Of Stay
"RTN","RORX005",78,0)
 ;       NumOfDays,
"RTN","RORX005",79,0)
 ;         Seq#)
"RTN","RORX005",80,0)
 ;
"RTN","RORX005",81,0)
 ;   "IPNOBS",
"RTN","RORX005",82,0)
 ;      PatientName,
"RTN","RORX005",83,0)
 ;        Date,
"RTN","RORX005",84,0)
 ;          PTF#,
"RTN","RORX005",85,0)
 ;            DFN)
"RTN","RORX005",86,0)
 ;
"RTN","RORX005",87,0)
 ;   "IPS",            Total number of stays
"RTN","RORX005",88,0)
 ;     NumOfStays,     Number of patients
"RTN","RORX005",89,0)
 ;       PatientName,
"RTN","RORX005",90,0)
 ;         DFN)
"RTN","RORX005",91,0)
 ;
"RTN","RORX005",92,0)
 ;   "IPV")            Total number of short stays
"RTN","RORX005",93,0)
 ;
"RTN","RORX005",94,0)
 ; Bed section IDs (BedSectID):
"RTN","RORX005",95,0)
 ;   -1  No bed section               [#%*]
"RTN","RORX005",96,0)
 ;    0  Whole patient's stays        [  *]
"RTN","RORX005",97,0)
 ;   >0  Bed section ID (IEN;File#)   [# *]
"RTN","RORX005",98,0)
 ;
"RTN","RORX005",99,0)
 ; Return Values:
"RTN","RORX005",100,0)
 ;       <0  Error code
"RTN","RORX005",101,0)
 ;        0  Ok
"RTN","RORX005",102,0)
 ;
"RTN","RORX005",103,0)
IPUTL(RORTSK) ;
"RTN","RORX005",104,0)
 N ROREDT        ; End date
"RTN","RORX005",105,0)
 N RORREG        ; Registry IEN
"RTN","RORX005",106,0)
 N RORSDT        ; Start date
"RTN","RORX005",107,0)
 ;
"RTN","RORX005",108,0)
 N ECNT,RC,REPORT,SFLAGS,TMP
"RTN","RORX005",109,0)
 S (ECNT,RC)=0
"RTN","RORX005",110,0)
 K ^TMP("RORX005",$J)
"RTN","RORX005",111,0)
 ;--- Root node of the report
"RTN","RORX005",112,0)
 S REPORT=$$ADDVAL^RORTSK11(RORTSK,"REPORT")
"RTN","RORX005",113,0)
 Q:REPORT<0 REPORT
"RTN","RORX005",114,0)
 ;
"RTN","RORX005",115,0)
 ;--- Get and prepare the report parameters
"RTN","RORX005",116,0)
 S RORREG=$$PARAM^RORTSK01("REGIEN")
"RTN","RORX005",117,0)
 S RC=$$PARAMS(REPORT,.RORSDT,.ROREDT,.SFLAGS)  Q:RC<0 RC
"RTN","RORX005",118,0)
 ;
"RTN","RORX005",119,0)
 ;--- Report header
"RTN","RORX005",120,0)
 S RC=$$HEADER(REPORT)  Q:RC<0 RC
"RTN","RORX005",121,0)
 ;
"RTN","RORX005",122,0)
 D
"RTN","RORX005",123,0)
 . ;--- Query the registry
"RTN","RORX005",124,0)
 . D TPPSETUP^RORTSK01(70)
"RTN","RORX005",125,0)
 . S RC=$$QUERY^RORX005A(SFLAGS)
"RTN","RORX005",126,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX005",127,0)
 . ;--- Sort the data
"RTN","RORX005",128,0)
 . D TPPSETUP^RORTSK01(15)
"RTN","RORX005",129,0)
 . S RC=$$SORT^RORX005B()
"RTN","RORX005",130,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX005",131,0)
 . ;--- Store the results
"RTN","RORX005",132,0)
 . D TPPSETUP^RORTSK01(15)
"RTN","RORX005",133,0)
 . S RC=$$STORE^RORX005C(REPORT)
"RTN","RORX005",134,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX005",135,0)
 ;
"RTN","RORX005",136,0)
 ;--- Cleanup
"RTN","RORX005",137,0)
 K ^TMP("RORX005",$J)
"RTN","RORX005",138,0)
 Q $S(RC<0:RC,ECNT>0:-43,1:0)
"RTN","RORX005",139,0)
 ;
"RTN","RORX005",140,0)
 ;***** OUTPUTS THE PARAMETERS TO THE REPORT
"RTN","RORX005",141,0)
 ;
"RTN","RORX005",142,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX005",143,0)
 ;
"RTN","RORX005",144,0)
 ; [.STDT]       Start and end dates of the report
"RTN","RORX005",145,0)
 ; [.ENDT]       are returned via these parameters
"RTN","RORX005",146,0)
 ;
"RTN","RORX005",147,0)
 ; [.FLAGS]      Flags for the $$SKIP^RORXU005 are
"RTN","RORX005",148,0)
 ;               returned via this parameter
"RTN","RORX005",149,0)
 ;
"RTN","RORX005",150,0)
 ; Return Values:
"RTN","RORX005",151,0)
 ;       <0  Error code
"RTN","RORX005",152,0)
 ;       >0  IEN of the PARAMETERS element
"RTN","RORX005",153,0)
 ;
"RTN","RORX005",154,0)
PARAMS(PARTAG,STDT,ENDT,FLAGS) ;
"RTN","RORX005",155,0)
 N NAME,PARAMS,TMP
"RTN","RORX005",156,0)
 S PARAMS=$$PARAMS^RORXU002(.RORTSK,PARTAG,.STDT,.ENDT,.FLAGS)
"RTN","RORX005",157,0)
 Q:PARAMS<0 PARAMS
"RTN","RORX005",158,0)
 ;--- Process the list of divisions
"RTN","RORX005",159,0)
 S TMP=$$DIVLST^RORXU006(.RORTSK,PARAMS)
"RTN","RORX005",160,0)
 Q:TMP<0 TMP
"RTN","RORX005",161,0)
 ;--- Additional parameters
"RTN","RORX005",162,0)
 F NAME="MAXUTNUM"  D
"RTN","RORX005",163,0)
 . S TMP=$$PARAM^RORTSK01(NAME)
"RTN","RORX005",164,0)
 . D:TMP'="" ADDVAL^RORTSK11(RORTSK,NAME,TMP,PARAMS)
"RTN","RORX005",165,0)
 ;---
"RTN","RORX005",166,0)
 Q PARAMS
"RTN","RORX005A")
0^10^B46197607^B40196382
"RTN","RORX005A",1,0)
RORX005A ;HOIFO/BH,SG - INPATIENT UTILIZATION (QUERY) ;4/21/09 2:20pm
"RTN","RORX005A",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**1,8,10,13,19,21,31**;Feb 17, 2006;Build 62
"RTN","RORX005A",3,0)
 ;
"RTN","RORX005A",4,0)
 ; This routine uses the following IAs:
"RTN","RORX005A",5,0)
 ;
"RTN","RORX005A",6,0)
 ; #92           ^DGPT(  #45.7 (controlled)
"RTN","RORX005A",7,0)
 ; #417          .01 field and "C" x-ref of file #40.8 (controlled)
"RTN","RORX005A",8,0)
 ; #2056         $$GET1^DIQ (supported)
"RTN","RORX005A",9,0)
 ; #3545         ^DGPT("AAD" (private)
"RTN","RORX005A",10,0)
 ; #10061        IN5^VADPT (supported) 
"RTN","RORX005A",11,0)
 ; #10103        FMADD^XLFDT, FMDIFF^XLFDT (supported)
"RTN","RORX005A",12,0)
 ;
"RTN","RORX005A",13,0)
 ;******************************************************************************
"RTN","RORX005A",14,0)
 ;******************************************************************************
"RTN","RORX005A",15,0)
 ;                 --- ROUTINE MODIFICATION LOG ---
"RTN","RORX005A",16,0)
 ;        
"RTN","RORX005A",17,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORX005A",18,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","RORX005A",19,0)
 ;ROR*1.5*8    MAR  2010   V CARR       Modified to handle ICD9 filter for
"RTN","RORX005A",20,0)
 ;                                      'include' or 'exclude'.
"RTN","RORX005A",21,0)
 ;ROR*1.5*13   DEC  2010   A SAUNDERS   User can select specific patients.
"RTN","RORX005A",22,0)
 ;ROR*1.5*19   FEB  2012   K GUPTA      Support for ICD-10 Coding System
"RTN","RORX005A",23,0)
 ;ROR*1.5*31   MAY 2017    M FERRARESE  Adding PACT,PCP, and AGE/DOB as additional
"RTN","RORX005A",24,0)
 ;                                      identifiers.                           
"RTN","RORX005A",25,0)
 ;******************************************************************************
"RTN","RORX005A",26,0)
 ;******************************************************************************
"RTN","RORX005A",27,0)
 Q
"RTN","RORX005A",28,0)
 ;
"RTN","RORX005A",29,0)
 ;***** ADDS THE INPATIENT STAY
"RTN","RORX005A",30,0)
 ;
"RTN","RORX005A",31,0)
 ; DFN           Patient IEN (in file #2)
"RTN","RORX005A",32,0)
 ; PTFIEN        IEN of the PTF record
"RTN","RORX005A",33,0)
 ; LOS           Length of stay
"RTN","RORX005A",34,0)
 ; BSID          Bed section ID
"RTN","RORX005A",35,0)
 ; DATE          Movement date/time (FileMan)
"RTN","RORX005A",36,0)
 ;
"RTN","RORX005A",37,0)
ADDSTAY(DFN,PTFIEN,LOS,BSID,DATE) ;
"RTN","RORX005A",38,0)
 N DST,I,TMP
"RTN","RORX005A",39,0)
 S:$G(BSID)="" BSID=0
"RTN","RORX005A",40,0)
 ;--- Number of patients for the bedsection
"RTN","RORX005A",41,0)
 I 'BSID  S DST=$NA(@RORDST@("IP",DFN))
"RTN","RORX005A",42,0)
 E  S DST=$NA(@RORDST@("IPB",BSID))  D:'$D(@DST@("P",DFN))
"RTN","RORX005A",43,0)
 . S @DST@("P")=$G(@DST@("P"))+1,@DST@("P",DFN)=""
"RTN","RORX005A",44,0)
 ;--- No bed section ID
"RTN","RORX005A",45,0)
 S:BSID<0 @RORDST@("IPNOBS",RORPNAME,DATE,PTFIEN,DFN)=""
"RTN","RORX005A",46,0)
 ;--- Short stays (visits)
"RTN","RORX005A",47,0)
 I LOS'>0  S @DST@("V")=$G(@DST@("V"))+1  Q
"RTN","RORX005A",48,0)
 ;--- Days and stays
"RTN","RORX005A",49,0)
 S @DST@("D")=$G(@DST@("D"))+LOS
"RTN","RORX005A",50,0)
 S @DST@("S")=$G(@DST@("S"))+1
"RTN","RORX005A",51,0)
 ;--- Lengths of stay for median value calculations
"RTN","RORX005A",52,0)
 S I=$O(@RORDST@("IPMLOS",BSID,LOS,""),-1)+1
"RTN","RORX005A",53,0)
 S @RORDST@("IPMLOS",BSID,LOS,I)=""
"RTN","RORX005A",54,0)
 Q
"RTN","RORX005A",55,0)
 ;
"RTN","RORX005A",56,0)
 ;***** LOADS AND PROCESSES THE INPATIENT DATA
"RTN","RORX005A",57,0)
 ;
"RTN","RORX005A",58,0)
 ; DFN           Patient IEN (in file #2)
"RTN","RORX005A",59,0)
 ;
"RTN","RORX005A",60,0)
 ; Return Values:
"RTN","RORX005A",61,0)
 ;       <0  Error code
"RTN","RORX005A",62,0)
 ;        0  Ok
"RTN","RORX005A",63,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX005A",64,0)
 ;
"RTN","RORX005A",65,0)
IPDATA(DFN) ;
"RTN","RORX005A",66,0)
 N RORDST        ; Closed reference to the category node in ^TMP
"RTN","RORX005A",67,0)
 ;
"RTN","RORX005A",68,0)
 N BSID,DATE,DISDT,ENDT,FACILITY,LOS,PTFIEN,RC,RORMSG,STDT,SUFFIX,TMP,VAHOW,VAIP,VAROOT,XDATE
"RTN","RORX005A",69,0)
 S RORDST=$NA(^TMP("RORX005",$J))
"RTN","RORX005A",70,0)
 ;---
"RTN","RORX005A",71,0)
 S XDATE=RORSDT
"RTN","RORX005A",72,0)
 F  S RC=0  D  Q:RC<2  S XDATE=$O(^DGPT("AAD",DFN,XDATE))  Q:XDATE'>0
"RTN","RORX005A",73,0)
 . I XDATE'<ROREDT1  S RC=1  Q
"RTN","RORX005A",74,0)
 . K DATE,LOS,VAIP  S VAIP(16,1)=XDATE
"RTN","RORX005A",75,0)
 . F  D  Q:RC
"RTN","RORX005A",76,0)
 . . S VAIP("D")=+$G(VAIP(16,1))
"RTN","RORX005A",77,0)
 . . I VAIP("D")'>0  S RC=2  Q
"RTN","RORX005A",78,0)
 . . D IN5^VADPT
"RTN","RORX005A",79,0)
 . . I $G(VAIP(1))'>0  S RC=2  Q
"RTN","RORX005A",80,0)
 . . S DATE=+VAIP(3)
"RTN","RORX005A",81,0)
 . . Q:+$G(VAIP(4))=3
"RTN","RORX005A",82,0)
 . . ;--- Check the movement date
"RTN","RORX005A",83,0)
 . . I DATE'<ROREDT1  S RC=1  Q
"RTN","RORX005A",84,0)
 . . S:DATE<RORSDT DATE=RORSDT
"RTN","RORX005A",85,0)
 . . ;--- Check the PTF record - Task removed April 2009
"RTN","RORX005A",86,0)
 . . S PTFIEN=+$G(VAIP(12))  Q:PTFIEN'>0
"RTN","RORX005A",87,0)
 . . I '$D(PTFIEN(PTFIEN))  D  Q:RC
"RTN","RORX005A",88,0)
 . . . S PTFIEN(PTFIEN)=0
"RTN","RORX005A",89,0)
 . . . Q:$$PTF^RORXU001(PTFIEN,"FP",,,.SUFFIX,,.FACILITY)
"RTN","RORX005A",90,0)
 . . . ;--- Check the suffix
"RTN","RORX005A",91,0)
 . . . ;I SUFFIX'=""  Q:$$VSUFFIX(SUFFIX)  ; ROR 1.5
"RTN","RORX005A",92,0)
 . . . ;--- Check the division
"RTN","RORX005A",93,0)
 . . . S TMP=$$PARAM^RORTSK01("DIVISIONS","ALL")
"RTN","RORX005A",94,0)
 . . . I 'TMP  D  Q:'$D(RORTSK("PARAMS","DIVISIONS","C",DIVIEN))
"RTN","RORX005A",95,0)
 . . . . S TMP=FACILITY_SUFFIX
"RTN","RORX005A",96,0)
 . . . . S DIVIEN=$S(TMP'="":+$O(^DG(40.8,"C",TMP,"")),1:0)
"RTN","RORX005A",97,0)
 . . . K DIVIEN ;kill statement added
"RTN","RORX005A",98,0)
 . . . S PTFIEN(PTFIEN)=1
"RTN","RORX005A",99,0)
 . . ;--- Skip the PTF record if necessary
"RTN","RORX005A",100,0)
 . . Q:'PTFIEN(PTFIEN)
"RTN","RORX005A",101,0)
 . . ;--- Process the admission (only once)
"RTN","RORX005A",102,0)
 . . I '$D(LOS)  D  Q:RC
"RTN","RORX005A",103,0)
 . . . S LOS=$$LOS(+$G(VAIP(13,1)),+$G(VAIP(17,1)))
"RTN","RORX005A",104,0)
 . . . D ADDSTAY(DFN,PTFIEN,LOS)
"RTN","RORX005A",105,0)
 . . ;--- Process the movement
"RTN","RORX005A",106,0)
 . . S ENDT=$G(VAIP(16,1))\1
"RTN","RORX005A",107,0)
 . . S:(ENDT'>0)!(ENDT'<ROREDT1) ENDT=ROREDT,RC=2
"RTN","RORX005A",108,0)
 . . Q:ENDT<RORSDT
"RTN","RORX005A",109,0)
 . . S LOS=$$FMDIFF^XLFDT(ENDT,DATE\1,1)  S:LOS'>0 LOS=0
"RTN","RORX005A",110,0)
 . . ;--- Use the IEN in the SPECIALTY file (#42.4) as the Bedsection 
"RTN","RORX005A",111,0)
 . . ;    ID if it is available (it should be). Otherwise, use the
"RTN","RORX005A",112,0)
 . . ;--- IEN in the FACILITY TREATING SPECIALTY file (#45.7).
"RTN","RORX005A",113,0)
 . . I $G(VAIP(8))>0  D
"RTN","RORX005A",114,0)
 . . . K RORMSG S TMP=$$GET1^DIQ(45.7,+VAIP(8),1,"I",,"RORMSG")
"RTN","RORX005A",115,0)
 . . . ;D:$G(DIERR) DBS^RORERR("RORMSG",-9,,DFN,45.7,+VAIP(8))
"RTN","RORX005A",116,0)
 . . . D:$G(RORMSG("DIERR")) DBS^RORERR("RORMSG",-9,,DFN,45.7,+VAIP(8))
"RTN","RORX005A",117,0)
 . . . S BSID=$S(TMP>0:TMP_";42.4",1:+VAIP(8)_";45.7")
"RTN","RORX005A",118,0)
 . . E  S BSID=-1
"RTN","RORX005A",119,0)
 . . D ADDSTAY(DFN,PTFIEN,LOS,BSID,+VAIP(3))
"RTN","RORX005A",120,0)
 . S:$G(DATE)>XDATE XDATE=DATE
"RTN","RORX005A",121,0)
 ;---
"RTN","RORX005A",122,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORX005A",123,0)
 ;
"RTN","RORX005A",124,0)
 ;***** CALCULATES THE LENGTH OF STAY
"RTN","RORX005A",125,0)
LOS(STDT,ENDT) ;
"RTN","RORX005A",126,0)
 N DAYS
"RTN","RORX005A",127,0)
 S:STDT<RORSDT STDT=RORSDT
"RTN","RORX005A",128,0)
 S:(ENDT'>0)!(ENDT>ROREDT) ENDT=ROREDT
"RTN","RORX005A",129,0)
 S DAYS=$$FMDIFF^XLFDT(ENDT\1,STDT\1,1)
"RTN","RORX005A",130,0)
 Q $S(DAYS'<0:DAYS,1:0)
"RTN","RORX005A",131,0)
 ;
"RTN","RORX005A",132,0)
 ;***** QUERIES THE REGISTRY
"RTN","RORX005A",133,0)
 ;
"RTN","RORX005A",134,0)
 ; FLAGS         Flags for the $$SKIP^RORXU005
"RTN","RORX005A",135,0)
 ;
"RTN","RORX005A",136,0)
 ; Return Values:
"RTN","RORX005A",137,0)
 ;       <0  Error code
"RTN","RORX005A",138,0)
 ;        0  Ok
"RTN","RORX005A",139,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX005A",140,0)
 ;
"RTN","RORX005A",141,0)
QUERY(FLAGS) ;
"RTN","RORX005A",142,0)
 N ROREDT1       ; Day after the end date
"RTN","RORX005A",143,0)
 N RORLAST4      ; Last 4 digits of the current patient's SSN
"RTN","RORX005A",144,0)
 N RORPNAME      ; Name of the current patient
"RTN","RORX005A",145,0)
 N RORICN        ; National ICN
"RTN","RORX005A",146,0)
 N RORPACT       ; Patient Care team
"RTN","RORX005A",147,0)
 N RORPCP        ; Primary care physician
"RTN","RORX005A",148,0)
 N RORPTN        ; Number of patients in the registry
"RTN","RORX005A",149,0)
 N AGE,AGETYPE
"RTN","RORX005A",150,0)
 ;
"RTN","RORX005A",151,0)
 N CNT,ECNT,IEN,IENS,PATIEN,RC,TMP,VA,VADM,XREFNODE
"RTN","RORX005A",152,0)
 N RCC,FLAG
"RTN","RORX005A",153,0)
 S XREFNODE=$NA(^RORDATA(798,"AC",+RORREG))
"RTN","RORX005A",154,0)
 S RORPTN=$$REGSIZE^RORUTL02(+RORREG)  S:RORPTN<0 RORPTN=0
"RTN","RORX005A",155,0)
 S ROREDT1=$$FMADD^XLFDT(ROREDT,1)
"RTN","RORX005A",156,0)
 S (CNT,ECNT,RC)=0
"RTN","RORX005A",157,0)
 ;--- Browse through the registry records
"RTN","RORX005A",158,0)
 S IEN=0
"RTN","RORX005A",159,0)
 S FLAG=$G(RORTSK("PARAMS","ICDFILT","A","FILTER"))
"RTN","RORX005A",160,0)
 F  S IEN=$O(@XREFNODE@(IEN))  Q:IEN'>0  D  Q:RC<0
"RTN","RORX005A",161,0)
 . S TMP=$S(RORPTN>0:CNT/RORPTN,1:"")
"RTN","RORX005A",162,0)
 . S RC=$$LOOP^RORTSK01(TMP)  Q:RC<0
"RTN","RORX005A",163,0)
 . S IENS=IEN_",",CNT=CNT+1
"RTN","RORX005A",164,0)
 . ;--- Get the patient DFN
"RTN","RORX005A",165,0)
 . S PATIEN=$$PTIEN^RORUTL01(IEN)  Q:PATIEN'>0
"RTN","RORX005A",166,0)
 . ;check for patient list and quit if not on list
"RTN","RORX005A",167,0)
 . I $D(RORTSK("PARAMS","PATIENTS","C")),'$D(RORTSK("PARAMS","PATIENTS","C",PATIEN)) Q
"RTN","RORX005A",168,0)
 . ;--- Check if the patient should be skipped
"RTN","RORX005A",169,0)
 . Q:$$SKIP^RORXU005(IEN,FLAGS,RORSDT,ROREDT)
"RTN","RORX005A",170,0)
 . ;--- Filter patient on ICD codes
"RTN","RORX005A",171,0)
 . S RCC=0
"RTN","RORX005A",172,0)
 . I FLAG'="ALL" D
"RTN","RORX005A",173,0)
 . . S RCC=$$ICD^RORXU010(PATIEN)
"RTN","RORX005A",174,0)
 . I (FLAG="INCLUDE")&(RCC=0) Q
"RTN","RORX005A",175,0)
 . I (FLAG="EXCLUDE")&(RCC=1) Q
"RTN","RORX005A",176,0)
 . ;--- End of filter
"RTN","RORX005A",177,0)
 . ;
"RTN","RORX005A",178,0)
 . ;--- Get the patient's data
"RTN","RORX005A",179,0)
 . D VADEM^RORUTL05(PATIEN,1)
"RTN","RORX005A",180,0)
 . S RORPNAME=VADM(1),RORLAST4=VA("BID")
"RTN","RORX005A",181,0)
 . S RORICN=$S($$PARAM^RORTSK01("PATIENTS","ICN"):$$ICN^RORUTL02(PATIEN),1:"")
"RTN","RORX005A",182,0)
 . S RORPACT=$S($$PARAM^RORTSK01("PATIENTS","PACT"):$$PACT^RORUTL02(PATIEN),1:"")
"RTN","RORX005A",183,0)
 . S RORPCP=$S($$PARAM^RORTSK01("PATIENTS","PCP"):$$PCP^RORUTL02(PATIEN),1:"")
"RTN","RORX005A",184,0)
 . S AGETYPE=$$PARAM^RORTSK01("AGE_RANGE","TYPE") D
"RTN","RORX005A",185,0)
 . . S AGE=$S(AGETYPE="AGE":$P(VADM(4),U),AGETYPE="DOB":$$DATE^RORXU002($P(VADM(3),U)\1),1:"")
"RTN","RORX005A",186,0)
 . ;
"RTN","RORX005A",187,0)
 . ;--- Get the inpatient data
"RTN","RORX005A",188,0)
 . S RC=$$IPDATA(PATIEN)
"RTN","RORX005A",189,0)
 . I RC  S ECNT=ECNT+1  Q:RC<0
"RTN","RORX005A",190,0)
 . ;
"RTN","RORX005A",191,0)
 . ;--- Calculate intermediate totals
"RTN","RORX005A",192,0)
 . S RC=$$TOTALS^RORX005B(PATIEN)
"RTN","RORX005A",193,0)
 . I RC  S ECNT=ECNT+1  Q:RC<0
"RTN","RORX005A",194,0)
 ;---
"RTN","RORX005A",195,0)
 Q $S(RC<0:RC,1:ECNT)
"RTN","RORX005A",196,0)
 ;
"RTN","RORX005A",197,0)
 ;***** CHECKS THE SUFFIX FOR VALIDITY
"RTN","RORX005A",198,0)
 ;
"RTN","RORX005A",199,0)
 ; SUFFIX        Suffix
"RTN","RORX005A",200,0)
 ;
"RTN","RORX005A",201,0)
 ; Return Values:
"RTN","RORX005A",202,0)
 ;        0  Ok
"RTN","RORX005A",203,0)
 ;        1  Invalid suffix
"RTN","RORX005A",204,0)
VSUFFIX(SUFFIX) ;
"RTN","RORX005A",205,0)
 Q '("9AA,9AB,9AC,9AD,9AE,9BB,A0,A4,A5,BU,BV,PA"[SUFFIX)
"RTN","RORX005B")
0^11^B10714938^B9080085
"RTN","RORX005B",1,0)
RORX005B ;HCIOFO/BH,SG - INPATIENT UTILIZATION (SORT) ; 04 Apr 2016  12:48 PM
"RTN","RORX005B",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**28,31**;Feb 17, 2006;Build 62
"RTN","RORX005B",3,0)
 ;
"RTN","RORX005B",4,0)
 ; This routine uses the following IAs:
"RTN","RORX005B",5,0)
 ;
"RTN","RORX005B",6,0)
 ; #2056 GET1^DIQ
"RTN","RORX005B",7,0)
 ;
"RTN","RORX005B",8,0)
 ;**********************************************************************
"RTN","RORX005B",9,0)
 ;                       --- ROUTINE MODIFICATION LOG ---
"RTN","RORX005B",10,0)
 ;        
"RTN","RORX005B",11,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORX005B",12,0)
 ;-----------  ----------  -----------  --------------------------------
"RTN","RORX005B",13,0)
 ;ROR*1.5*28   APR 2016    T KOPP       Add ICN data if additional
"RTN","RORX005B",14,0)
 ;                                       identifier requested.
"RTN","RORX005B",15,0)
 ;ROR*1.5*31   MAY 2017    M FERRARESE  Adding PACT, PCP, and AGE/DOB as additional
"RTN","RORX005B",16,0)
 ;                                       identifiers.
"RTN","RORX005B",17,0)
 ;**********************************************************************
"RTN","RORX005B",18,0)
 ;
"RTN","RORX005B",19,0)
 Q
"RTN","RORX005B",20,0)
 ;
"RTN","RORX005B",21,0)
 ;***** CALCULATES MEDIAN LENGTHS OF STAY
"RTN","RORX005B",22,0)
 ;
"RTN","RORX005B",23,0)
 ; NODE          Closed root of the category section
"RTN","RORX005B",24,0)
 ;               in the temporary global
"RTN","RORX005B",25,0)
 ;
"RTN","RORX005B",26,0)
 ; FSUM          Update the summary data (0/1)
"RTN","RORX005B",27,0)
 ;
"RTN","RORX005B",28,0)
MLOS(NODE) ;
"RTN","RORX005B",29,0)
 N BSID,TMP,XREFNODE
"RTN","RORX005B",30,0)
 ;--- Median length of the whole stays
"RTN","RORX005B",31,0)
 S XREFNODE=$NA(@NODE@("IPMLOS",0))
"RTN","RORX005B",32,0)
 S TMP=$$XREFMDNV^RORXU004(XREFNODE,+$G(@NODE@("IPS")))
"RTN","RORX005B",33,0)
 S (@NODE@("IPMLOS"),@NODE@("IPMLOS",0))=TMP
"RTN","RORX005B",34,0)
 ;--- Median lengths of the bed section stays
"RTN","RORX005B",35,0)
 S BSID=""
"RTN","RORX005B",36,0)
 F  S BSID=$O(@NODE@("IPMLOS",BSID))  Q:BSID=""  D:BSID
"RTN","RORX005B",37,0)
 . S XREFNODE=$NA(@NODE@("IPMLOS",BSID))
"RTN","RORX005B",38,0)
 . S TMP=+$G(@NODE@("IPB",BSID,"S"))
"RTN","RORX005B",39,0)
 . S @NODE@("IPMLOS",BSID)=$$XREFMDNV^RORXU004(XREFNODE,TMP)
"RTN","RORX005B",40,0)
 Q
"RTN","RORX005B",41,0)
 ;
"RTN","RORX005B",42,0)
 ;***** SORTS THE RESULTS AND COMPILES THE TOTALS
"RTN","RORX005B",43,0)
 ;
"RTN","RORX005B",44,0)
 ; Return Values:
"RTN","RORX005B",45,0)
 ;       <0  Error code
"RTN","RORX005B",46,0)
 ;        0  Ok
"RTN","RORX005B",47,0)
 ;
"RTN","RORX005B",48,0)
SORT() ;
"RTN","RORX005B",49,0)
 N BSID,DIERR,FILE,IENS,NAME,NODE,RC,RORMSG,TMP
"RTN","RORX005B",50,0)
 S NODE=$NA(^TMP("RORX005",$J))  Q:$D(@NODE)<10 0
"RTN","RORX005B",51,0)
 ;--- Bed sections
"RTN","RORX005B",52,0)
 S RC=$$LOOP^RORTSK01(0)  Q:RC<0 RC
"RTN","RORX005B",53,0)
 S BSID=""
"RTN","RORX005B",54,0)
 F  S BSID=$O(@NODE@("IPB",BSID))  Q:'BSID  D
"RTN","RORX005B",55,0)
 . D:BSID>0
"RTN","RORX005B",56,0)
 . . S IENS=(+BSID)_",",FILE=+$P(BSID,";",2)
"RTN","RORX005B",57,0)
 . . S NAME=$$GET1^DIQ(FILE,IENS,.01,,,"RORMSG")
"RTN","RORX005B",58,0)
 . . D:$G(DIERR) DBS^RORERR("RORMSG",-9,,,FILE,IENS)
"RTN","RORX005B",59,0)
 . . S:NAME?." " NAME="Unknown ("_BSID_")"
"RTN","RORX005B",60,0)
 . . S @NODE@("IPB","B",NAME,BSID)=""
"RTN","RORX005B",61,0)
 ;--- Median length of stay
"RTN","RORX005B",62,0)
 S RC=$$LOOP^RORTSK01(0.5)  Q:RC<0 RC
"RTN","RORX005B",63,0)
 D MLOS(NODE)
"RTN","RORX005B",64,0)
 ;---
"RTN","RORX005B",65,0)
 Q 0
"RTN","RORX005B",66,0)
 ;
"RTN","RORX005B",67,0)
 ;***** CALCULATES THE INTERMEDIATE TOTALS
"RTN","RORX005B",68,0)
 ;
"RTN","RORX005B",69,0)
 ; PATIEN        Patient IEN (DFN)
"RTN","RORX005B",70,0)
 ;
"RTN","RORX005B",71,0)
 ; Return Values:
"RTN","RORX005B",72,0)
 ;       <0  Error code
"RTN","RORX005B",73,0)
 ;        0  Ok
"RTN","RORX005B",74,0)
 ;
"RTN","RORX005B",75,0)
TOTALS(PATIEN) ;
"RTN","RORX005B",76,0)
 N NODE,TMP
"RTN","RORX005B",77,0)
 S NODE=$NA(^TMP("RORX005",$J))
"RTN","RORX005B",78,0)
 ;
"RTN","RORX005B",79,0)
 ;=== Inpatient data
"RTN","RORX005B",80,0)
 D:$D(@NODE@("IP",PATIEN))>1
"RTN","RORX005B",81,0)
 . N DAYS,STAYS,VISITS
"RTN","RORX005B",82,0)
 . S RORICN=$S($$PARAM^RORTSK01("PATIENTS","ICN"):$G(RORICN),1:"")
"RTN","RORX005B",83,0)
 . S RORPACT=$S($$PARAM^RORTSK01("PATIENTS","PACT"):$G(RORPACT),1:"")
"RTN","RORX005B",84,0)
 . S @NODE@("IP",PATIEN)=RORLAST4_U_RORICN_U_RORPACT_U_$S($$PARAM^RORTSK01("PATIENTS","PCP"):$G(RORPCP),1:"")_U_AGE
"RTN","RORX005B",85,0)
 . S @NODE@("IP")=$G(@NODE@("IP"))+1
"RTN","RORX005B",86,0)
 . S STAYS=+$G(@NODE@("IP",PATIEN,"S"))
"RTN","RORX005B",87,0)
 . S DAYS=+$G(@NODE@("IP",PATIEN,"D"))
"RTN","RORX005B",88,0)
 . S VISITS=+$G(@NODE@("IP",PATIEN,"V"))
"RTN","RORX005B",89,0)
 . ;--- Number of stays
"RTN","RORX005B",90,0)
 . D:(STAYS>0)!(VISITS>0)
"RTN","RORX005B",91,0)
 . . S @NODE@("IPS")=$G(@NODE@("IPS"))+STAYS
"RTN","RORX005B",92,0)
 . . S @NODE@("IPS",STAYS)=$G(@NODE@("IPS",STAYS))+1
"RTN","RORX005B",93,0)
 . . S @NODE@("IPS",STAYS,RORPNAME,PATIEN)=""
"RTN","RORX005B",94,0)
 . ;--- Number of days
"RTN","RORX005B",95,0)
 . D:(DAYS>0)!(VISITS>0)
"RTN","RORX005B",96,0)
 . . S @NODE@("IPD")=$G(@NODE@("IPD"))+DAYS
"RTN","RORX005B",97,0)
 . . S @NODE@("IPD",DAYS)=$G(@NODE@("IPD",DAYS))+1
"RTN","RORX005B",98,0)
 . . S @NODE@("IPD",DAYS,RORPNAME,PATIEN)=""
"RTN","RORX005B",99,0)
 . ;--- Number of short stays (visits)
"RTN","RORX005B",100,0)
 . D:VISITS>0
"RTN","RORX005B",101,0)
 . . S @NODE@("IPV")=$G(@NODE@("IPV"))+VISITS
"RTN","RORX005B",102,0)
 Q 0
"RTN","RORX005C")
0^12^B48722299^B38387317
"RTN","RORX005C",1,0)
RORX005C ;HCIOFO/BH,SG - INPATIENT UTILIZATION (STORE) ;9/14/05 9:17am
"RTN","RORX005C",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**21,31**;Feb 17, 2006;Build 62
"RTN","RORX005C",3,0)
 ;
"RTN","RORX005C",4,0)
 ;**********************************************************************
"RTN","RORX005C",5,0)
 ;                       --- ROUTINE MODIFICATION LOG ---
"RTN","RORX005C",6,0)
 ;        
"RTN","RORX005C",7,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORX005C",8,0)
 ;-----------  ----------  -----------  --------------------------------
"RTN","RORX005C",9,0)
 ;ROR*1.5*31   MAY 2017    M FERRARESE  Adding PACT, PCP, and AGE/DOB as additional
"RTN","RORX005C",10,0)
 ;                                       identifiers.
"RTN","RORX005C",11,0)
 ;**********************************************************************
"RTN","RORX005C",12,0)
 ;
"RTN","RORX005C",13,0)
 Q
"RTN","RORX005C",14,0)
 ;
"RTN","RORX005C",15,0)
 ;***** HIGHEST UTILIZATION
"RTN","RORX005C",16,0)
 ;
"RTN","RORX005C",17,0)
 ; PRNTELMT      IEN of the parent element
"RTN","RORX005C",18,0)
 ;
"RTN","RORX005C",19,0)
 ; RORNODE       Closed root of the section in the temporary global
"RTN","RORX005C",20,0)
 ;
"RTN","RORX005C",21,0)
 ; Return Values:
"RTN","RORX005C",22,0)
 ;       <0  Error code
"RTN","RORX005C",23,0)
 ;        0  Ok
"RTN","RORX005C",24,0)
 ;
"RTN","RORX005C",25,0)
HIGHUTIL(PRNTELMT,RORNODE) ;
"RTN","RORX005C",26,0)
 N RC,RORMAXUT,RORTCNT,SECTION,TMP
"RTN","RORX005C",27,0)
 S RORMAXUT=$$PARAM^RORTSK01("MAXUTNUM")
"RTN","RORX005C",28,0)
 Q:RORMAXUT'>0 0
"RTN","RORX005C",29,0)
 S SECTION=$$ADDVAL^RORTSK11(RORTSK,"HIGHUTIL",,PRNTELMT)
"RTN","RORX005C",30,0)
 Q:SECTION<0 SECTION
"RTN","RORX005C",31,0)
 S (RC,RORTCNT)=0
"RTN","RORX005C",32,0)
 ;--- Stays
"RTN","RORX005C",33,0)
 S RC=$$HIGHUTSD(SECTION,"IPS","HU_STAYS")  Q:RC<0 RC
"RTN","RORX005C",34,0)
 ;--- Days
"RTN","RORX005C",35,0)
 S RC=$$HIGHUTSD(SECTION,"IPD","HU_DAYS")   Q:RC<0 RC
"RTN","RORX005C",36,0)
 ;--- Disable the empty section
"RTN","RORX005C",37,0)
 D:RORTCNT'>0 UPDVAL^RORTSK11(RORTSK,SECTION,"",,1)
"RTN","RORX005C",38,0)
 Q 0
"RTN","RORX005C",39,0)
 ;
"RTN","RORX005C",40,0)
 ;*****
"RTN","RORX005C",41,0)
 ;
"RTN","RORX005C",42,0)
 ; SECTION       IEN of the parent element
"RTN","RORX005C",43,0)
 ;
"RTN","RORX005C",44,0)
 ; SUBS          Utilization subscript in the temporary global
"RTN","RORX005C",45,0)
 ;
"RTN","RORX005C",46,0)
 ; TBLNAME       Name of the table element
"RTN","RORX005C",47,0)
 ;
"RTN","RORX005C",48,0)
 ; Return Values:
"RTN","RORX005C",49,0)
 ;       <0  Error code
"RTN","RORX005C",50,0)
 ;        0  Ok
"RTN","RORX005C",51,0)
 ;
"RTN","RORX005C",52,0)
HIGHUTSD(SECTION,SUBS,TBLNAME) ;
"RTN","RORX005C",53,0)
 Q:$D(@RORNODE@(SUBS))<10 0
"RTN","RORX005C",54,0)
 N COUNT,DFN,IDNODE,ITEM,NAME,NUM,RC,TABLE,TMP
"RTN","RORX005C",55,0)
 S TABLE=$$ADDVAL^RORTSK11(RORTSK,TBLNAME,,SECTION)
"RTN","RORX005C",56,0)
 Q:TABLE<0 TABLE
"RTN","RORX005C",57,0)
 D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE",TBLNAME)
"RTN","RORX005C",58,0)
 S RORTCNT=RORTCNT+1
"RTN","RORX005C",59,0)
 ;---
"RTN","RORX005C",60,0)
 S NUM="",(COUNT,RC)=0
"RTN","RORX005C",61,0)
 F  S NUM=$O(@RORNODE@(SUBS,NUM),-1)  Q:NUM=""  D  Q:RC
"RTN","RORX005C",62,0)
 . S NAME=""
"RTN","RORX005C",63,0)
 . F  S NAME=$O(@RORNODE@(SUBS,NUM,NAME))  Q:NAME=""  D  Q:RC
"RTN","RORX005C",64,0)
 . . S DFN=""
"RTN","RORX005C",65,0)
 . . F  S DFN=$O(@RORNODE@(SUBS,NUM,NAME,DFN))  Q:DFN=""  D  Q:RC
"RTN","RORX005C",66,0)
 . . . S COUNT=COUNT+1  I COUNT>RORMAXUT  S RC=1  Q
"RTN","RORX005C",67,0)
 . . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"PATIENT",,TABLE)
"RTN","RORX005C",68,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"NAME",NAME,ITEM,1)
"RTN","RORX005C",69,0)
 . . . S IDNODE=$G(@RORNODE@("IP",DFN))
"RTN","RORX005C",70,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"LAST4",$P(IDNODE,U),ITEM,2)
"RTN","RORX005C",71,0)
 . . . S AGETYPE=$$PARAM^RORTSK01("AGE_RANGE","TYPE") I AGETYPE'="ALL" D
"RTN","RORX005C",72,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,AGETYPE,$P(IDNODE,U,5),ITEM,1)
"RTN","RORX005C",73,0)
 . . . S TMP=+$G(@RORNODE@("IP",DFN,"S"))
"RTN","RORX005C",74,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"NST",TMP,ITEM,3)
"RTN","RORX005C",75,0)
 . . . S TMP=+$G(@RORNODE@("IP",DFN,"D"))
"RTN","RORX005C",76,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"ND",TMP,ITEM,3)
"RTN","RORX005C",77,0)
 . . . S TMP=$G(@RORNODE@("IP",DFN,"V"))
"RTN","RORX005C",78,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"NSS",TMP,ITEM,3)
"RTN","RORX005C",79,0)
 . . . I $$PARAM^RORTSK01("PATIENTS","ICN") D ADDVAL^RORTSK11(RORTSK,"ICN",$P(IDNODE,U,2),ITEM,1)
"RTN","RORX005C",80,0)
 . . . I $$PARAM^RORTSK01("PATIENTS","PACT") D ADDVAL^RORTSK11(RORTSK,"PACT",$P(IDNODE,U,3),ITEM,1)
"RTN","RORX005C",81,0)
 . . . I $$PARAM^RORTSK01("PATIENTS","PCP") D ADDVAL^RORTSK11(RORTSK,"PCP",$P(IDNODE,U,4),ITEM,1)
"RTN","RORX005C",82,0)
 Q 0
"RTN","RORX005C",83,0)
 ;
"RTN","RORX005C",84,0)
 ;***** STORES THE REPORT DATA
"RTN","RORX005C",85,0)
 ;
"RTN","RORX005C",86,0)
 ; REPORT        IEN of the REPORT element
"RTN","RORX005C",87,0)
 ;
"RTN","RORX005C",88,0)
 ; Return Values:
"RTN","RORX005C",89,0)
 ;       <0  Error code
"RTN","RORX005C",90,0)
 ;        0  Ok
"RTN","RORX005C",91,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX005C",92,0)
 ;
"RTN","RORX005C",93,0)
STORE(REPORT) ;
"RTN","RORX005C",94,0)
 N RORSONLY      ; Output summary only
"RTN","RORX005C",95,0)
 ;
"RTN","RORX005C",96,0)
 N ECNT,NODE,RC,TMP
"RTN","RORX005C",97,0)
 S NODE=$NA(^TMP("RORX005",$J))
"RTN","RORX005C",98,0)
 Q:$D(@NODE)<10 0
"RTN","RORX005C",99,0)
 S RORSONLY=$$SMRYONLY^RORXU006(),(ECNT,RC)=0
"RTN","RORX005C",100,0)
 ;--- Inpatients
"RTN","RORX005C",101,0)
 S RC=$$LOOP^RORTSK01(0)    Q:RC<0 RC
"RTN","RORX005C",102,0)
 S RC=$$STOREIP(REPORT,NODE)
"RTN","RORX005C",103,0)
 I RC  Q:RC<0 RC  S ECNT=ECNT+1
"RTN","RORX005C",104,0)
 ;--- Highest utilization
"RTN","RORX005C",105,0)
 S RC=$$LOOP^RORTSK01(0.5)  Q:RC<0 RC
"RTN","RORX005C",106,0)
 S RC=$$HIGHUTIL(REPORT,NODE)
"RTN","RORX005C",107,0)
 I RC  Q:RC<0 RC  S ECNT=ECNT+1
"RTN","RORX005C",108,0)
 ;---
"RTN","RORX005C",109,0)
 Q ECNT
"RTN","RORX005C",110,0)
 ;
"RTN","RORX005C",111,0)
 ;***** INPATIENT DATA
"RTN","RORX005C",112,0)
 ;
"RTN","RORX005C",113,0)
 ; PRNTELMT      IEN of the parent element
"RTN","RORX005C",114,0)
 ;
"RTN","RORX005C",115,0)
 ; NODE          Closed root of the category section
"RTN","RORX005C",116,0)
 ;               in the temporary global
"RTN","RORX005C",117,0)
 ;
"RTN","RORX005C",118,0)
 ; Return Values:
"RTN","RORX005C",119,0)
 ;       <0  Error code
"RTN","RORX005C",120,0)
 ;        0  Ok
"RTN","RORX005C",121,0)
 ;
"RTN","RORX005C",122,0)
STOREIP(PRNTELMT,NODE) ;
"RTN","RORX005C",123,0)
 Q:$D(@NODE@("IP"))<10 0
"RTN","RORX005C",124,0)
 N BSID,DATE,ITEM,NAME,NS,PATIEN,PTF,RC,SECTION,TABLE,TMP
"RTN","RORX005C",125,0)
 S SECTION=$$ADDVAL^RORTSK11(RORTSK,"INPATIENTS",,PRNTELMT)
"RTN","RORX005C",126,0)
 Q:SECTION<0 SECTION
"RTN","RORX005C",127,0)
 S RC=0
"RTN","RORX005C",128,0)
 ;--- Stays
"RTN","RORX005C",129,0)
 I $D(@NODE@("IPS"))>1  D  Q:RC<0 RC
"RTN","RORX005C",130,0)
 . S TABLE=$$ADDVAL^RORTSK11(RORTSK,"STAYS",,SECTION)
"RTN","RORX005C",131,0)
 . I TABLE<0  S RC=TABLE  Q
"RTN","RORX005C",132,0)
 . D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","STAYS")
"RTN","RORX005C",133,0)
 . S NS=""
"RTN","RORX005C",134,0)
 . F  S NS=$O(@NODE@("IPS",NS))  Q:NS=""  D
"RTN","RORX005C",135,0)
 . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"ITEM",,TABLE)
"RTN","RORX005C",136,0)
 . . D ADDVAL^RORTSK11(RORTSK,"NP",$P(@NODE@("IPS",NS),U),ITEM,3)
"RTN","RORX005C",137,0)
 . . D ADDVAL^RORTSK11(RORTSK,"NST",NS,ITEM,3)
"RTN","RORX005C",138,0)
 ;--- Bed sections (clinics)
"RTN","RORX005C",139,0)
 I $D(@NODE@("IPB"))>1  D  Q:RC<0 RC
"RTN","RORX005C",140,0)
 . S TABLE=$$ADDVAL^RORTSK11(RORTSK,"BEDSECTIONS",,SECTION)
"RTN","RORX005C",141,0)
 . I TABLE<0  S RC=TABLE  Q
"RTN","RORX005C",142,0)
 . D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","BEDSECTIONS")
"RTN","RORX005C",143,0)
 . S NAME=""
"RTN","RORX005C",144,0)
 . F  S NAME=$O(@NODE@("IPB","B",NAME))  Q:NAME=""  D
"RTN","RORX005C",145,0)
 . . S BSID=""
"RTN","RORX005C",146,0)
 . . F  S BSID=$O(@NODE@("IPB","B",NAME,BSID))  Q:BSID=""  D:BSID>0
"RTN","RORX005C",147,0)
 . . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"BEDSECTION",,TABLE)
"RTN","RORX005C",148,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"NAME",NAME,ITEM,1)
"RTN","RORX005C",149,0)
 . . . S TMP=+$G(@NODE@("IPB",BSID,"P"))
"RTN","RORX005C",150,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"NP",TMP,ITEM,3)
"RTN","RORX005C",151,0)
 . . . S TMP=+$G(@NODE@("IPB",BSID,"S"))
"RTN","RORX005C",152,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"NST",TMP,ITEM,3)
"RTN","RORX005C",153,0)
 . . . S TMP=+$G(@NODE@("IPB",BSID,"D"))
"RTN","RORX005C",154,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"ND",TMP,ITEM,3)
"RTN","RORX005C",155,0)
 . . . S TMP=+$G(@NODE@("IPMLOS",BSID))
"RTN","RORX005C",156,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"MLOS",$J(TMP,0,1),ITEM,3)
"RTN","RORX005C",157,0)
 . . . S TMP=$G(@NODE@("IPB",BSID,"V"))
"RTN","RORX005C",158,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"NSS",TMP,ITEM,3)
"RTN","RORX005C",159,0)
 ;--- No bed section
"RTN","RORX005C",160,0)
 I 'RORSONLY,$D(@NODE@("IPNOBS"))>1  D  Q:RC<0 RC
"RTN","RORX005C",161,0)
 . S TABLE=$$ADDVAL^RORTSK11(RORTSK,"NOBS",,SECTION)
"RTN","RORX005C",162,0)
 . I TABLE<0  S RC=TABLE  Q
"RTN","RORX005C",163,0)
 . D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","NOBS")
"RTN","RORX005C",164,0)
 . S NAME=""
"RTN","RORX005C",165,0)
 . F  S NAME=$O(@NODE@("IPNOBS",NAME))  Q:NAME=""  D
"RTN","RORX005C",166,0)
 . . S DATE=""
"RTN","RORX005C",167,0)
 . . F  S DATE=$O(@NODE@("IPNOBS",NAME,DATE))  Q:DATE=""  D
"RTN","RORX005C",168,0)
 . . . S PTF=""
"RTN","RORX005C",169,0)
 . . . F  S PTF=$O(@NODE@("IPNOBS",NAME,DATE,PTF))  Q:PTF=""  D
"RTN","RORX005C",170,0)
 . . . . S DFN=""
"RTN","RORX005C",171,0)
 . . . . F  S DFN=$O(@NODE@("IPNOBS",NAME,DATE,PTF,DFN))  Q:DFN=""  D
"RTN","RORX005C",172,0)
 . . . . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"PATIENT",,TABLE)
"RTN","RORX005C",173,0)
 . . . . . D ADDVAL^RORTSK11(RORTSK,"NAME",NAME,ITEM,1)
"RTN","RORX005C",174,0)
 . . . . . S TMP=$P($G(@NODE@("IP",DFN)),U)
"RTN","RORX005C",175,0)
 . . . . . D ADDVAL^RORTSK11(RORTSK,"LAST4",TMP,ITEM,2)
"RTN","RORX005C",176,0)
 . . . . . S TMP=$G(@NODE@("IP",DFN,"I"))
"RTN","RORX005C",177,0)
 . . . . . D ADDVAL^RORTSK11(RORTSK,"ICN",TMP,ITEM,1)
"RTN","RORX005C",178,0)
 . . . . . D ADDVAL^RORTSK11(RORTSK,"ICN",$P(TMP,U,2),ITEM,1)
"RTN","RORX005C",179,0)
 . . . . . D ADDVAL^RORTSK11(RORTSK,"PACT",$P(TMP,U,3),ITEM,1)
"RTN","RORX005C",180,0)
 . . . . . D ADDVAL^RORTSK11(RORTSK,"PCP",$P(TMP,U,4),ITEM,1)
"RTN","RORX005C",181,0)
 . . . . . S AGETYPE=$$PARAM^RORTSK01("AGE_RANGE","TYPE") I AGETYPE'="ALL" D
"RTN","RORX005C",182,0)
 . . . . . . D ADDVAL^RORTSK11(RORTSK,AGETYPE,$P(TMP,U,5),ITEM,1)
"RTN","RORX005C",183,0)
 . . . . . D ADDVAL^RORTSK11(RORTSK,"DATE",DATE,ITEM,3)
"RTN","RORX005C",184,0)
 . . . . . D ADDVAL^RORTSK11(RORTSK,"PTF",PTF,ITEM,1)
"RTN","RORX005C",185,0)
 ;--- Summary
"RTN","RORX005C",186,0)
 D ADDVAL^RORTSK11(RORTSK,"NP",+$G(@NODE@("IP")),SECTION)
"RTN","RORX005C",187,0)
 D ADDVAL^RORTSK11(RORTSK,"NST",+$G(@NODE@("IPS")),SECTION)
"RTN","RORX005C",188,0)
 D ADDVAL^RORTSK11(RORTSK,"ND",+$G(@NODE@("IPD")),SECTION)
"RTN","RORX005C",189,0)
 D ADDVAL^RORTSK11(RORTSK,"NSS",+$G(@NODE@("IPV")),SECTION)
"RTN","RORX005C",190,0)
 S TMP=$G(@NODE@("IPMLOS",0))
"RTN","RORX005C",191,0)
 D ADDVAL^RORTSK11(RORTSK,"MLOS",$J(TMP,0,1),SECTION)
"RTN","RORX005C",192,0)
 I $G(@NODE@("IPS"))>0  D
"RTN","RORX005C",193,0)
 . S TMP=$G(@NODE@("IPD"))/@NODE@("IPS")
"RTN","RORX005C",194,0)
 E  S TMP=0
"RTN","RORX005C",195,0)
 D ADDVAL^RORTSK11(RORTSK,"ALOS",$J(TMP,0,1),SECTION)
"RTN","RORX005C",196,0)
 Q 0
"RTN","RORX006")
0^13^B13663817^B11883397
"RTN","RORX006",1,0)
RORX006 ;HCIOFO/BH,SG - LAB UTILIZATION ;11/8/05 8:53am
"RTN","RORX006",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**21,31**;Feb 17, 2006;Build 62
"RTN","RORX006",3,0)
 ;
"RTN","RORX006",4,0)
 ;******************************************************************************
"RTN","RORX006",5,0)
 ;                       --- ROUTINE MODIFICATION LOG ---
"RTN","RORX006",6,0)
 ;        
"RTN","RORX006",7,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORX006",8,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","RORX006",9,0)
 ;ROR*1.5*21   SEP 2013    T KOPP       Add ICN column if Additional Identifier
"RTN","RORX006",10,0)
 ;                                       requested.
"RTN","RORX006",11,0)
 ;ROR*1.5*31   MAY 2017    M FERRARESE  Adding PACT ,PCP, and AGE/DOB as additional
"RTN","RORX006",12,0)
 ;                                      identifiers.
"RTN","RORX006",13,0)
 ;******************************************************************************
"RTN","RORX006",14,0)
 ;
"RTN","RORX006",15,0)
 Q
"RTN","RORX006",16,0)
 ;
"RTN","RORX006",17,0)
 ;***** OUTPUTS THE REPORT HEADER
"RTN","RORX006",18,0)
 ;
"RTN","RORX006",19,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX006",20,0)
 ;
"RTN","RORX006",21,0)
 ; Return Values:
"RTN","RORX006",22,0)
 ;       <0  Error code
"RTN","RORX006",23,0)
 ;       >0  IEN of the HEADER element
"RTN","RORX006",24,0)
 ;
"RTN","RORX006",25,0)
HEADER(PARTAG) ;
"RTN","RORX006",26,0)
 ;;LABTESTS(#,NAME,NP,NR,MAXNRPP,MAXNP)
"RTN","RORX006",27,0)
 ;;PATIENTS(#,NAME,LAST4,AGE,DOD,NO,NR,NDT,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="AGE"
"RTN","RORX006",28,0)
 ;;PATIENTS(#,NAME,LAST4,DOB,DOD,NO,NR,NDT,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="DOB"
"RTN","RORX006",29,0)
 ;;PATIENTS(#,NAME,LAST4,DOD,NO,NR,NDT,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="ALL"
"RTN","RORX006",30,0)
 ;;RESULTS(NP,NR)
"RTN","RORX006",31,0)
 ;
"RTN","RORX006",32,0)
 N HEADER,RC
"RTN","RORX006",33,0)
 S HEADER=$$HEADER^RORXU002(.RORTSK,PARTAG)
"RTN","RORX006",34,0)
 Q:HEADER<0 HEADER
"RTN","RORX006",35,0)
 S RC=$$TBLDEF^RORXU002("HEADER^RORX006",HEADER)
"RTN","RORX006",36,0)
 Q $S(RC<0:RC,1:HEADER)
"RTN","RORX006",37,0)
 ;
"RTN","RORX006",38,0)
 ;
"RTN","RORX006",39,0)
 ;***** COMPILES THE "LAB UTILIZATION" REPORT
"RTN","RORX006",40,0)
 ; REPORT CODE: 006
"RTN","RORX006",41,0)
 ;
"RTN","RORX006",42,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORX006",43,0)
 ;
"RTN","RORX006",44,0)
 ; The ^TMP("RORX006",$J) global node is used by this function.
"RTN","RORX006",45,0)
 ;
"RTN","RORX006",46,0)
 ; ^TMP("RORX006",$J,
"RTN","RORX006",47,0)
 ;
"RTN","RORX006",48,0)
 ;     "ORD",            Total number of orders
"RTN","RORX006",49,0)
 ;       NumOfOrd,       Number of patients
"RTN","RORX006",50,0)
 ;         PatientName,
"RTN","RORX006",51,0)
 ;           DFN)
"RTN","RORX006",52,0)
 ;
"RTN","RORX006",53,0)
 ;     "PAT",            Total number of patients
"RTN","RORX006",54,0)
 ;       DFN,            Patient descriptor
"RTN","RORX006",55,0)
 ;                         01: Last 4 digits of SSN
"RTN","RORX006",56,0)
 ;                         02: Date of death
"RTN","RORX006",57,0)
 ;         "O")          Number of orders
"RTN","RORX006",58,0)
 ;         "R",          Results
"RTN","RORX006",59,0)
 ;                         ^01: Number of results
"RTN","RORX006",60,0)
 ;                         ^02: Number of different tests
"RTN","RORX006",61,0)
 ;           TestIEN)    Number of results
"RTN","RORX006",62,0)
 ;
"RTN","RORX006",63,0)
 ;     "RES",            Totals
"RTN","RORX006",64,0)
 ;                         ^01: Total number of results
"RTN","RORX006",65,0)
 ;                         ^02: Number of different tests
"RTN","RORX006",66,0)
 ;       TestIEN,
"RTN","RORX006",67,0)
 ;         "M")          Maximum
"RTN","RORX006",68,0)
 ;                         ^01: Maximum number of results
"RTN","RORX006",69,0)
 ;                         ^02: Number of patients
"RTN","RORX006",70,0)
 ;         "P")          Number of patients
"RTN","RORX006",71,0)
 ;         "R")          Number of results
"RTN","RORX006",72,0)
 ;       "B",
"RTN","RORX006",73,0)
 ;         NumOfRes,
"RTN","RORX006",74,0)
 ;           TestName,
"RTN","RORX006",75,0)
 ;             TestIEN)
"RTN","RORX006",76,0)
 ;
"RTN","RORX006",77,0)
 ;     "RES1",
"RTN","RORX006",78,0)
 ;       NumOfResults,   Number of patients
"RTN","RORX006",79,0)
 ;         PatientName,
"RTN","RORX006",80,0)
 ;           DFN)
"RTN","RORX006",81,0)
 ;
"RTN","RORX006",82,0)
 ; Return Values:
"RTN","RORX006",83,0)
 ;       <0  Error code
"RTN","RORX006",84,0)
 ;        0  Ok
"RTN","RORX006",85,0)
 ;
"RTN","RORX006",86,0)
LABUTL(RORTSK) ;
"RTN","RORX006",87,0)
 N ROREDT        ; End date
"RTN","RORX006",88,0)
 N ROREDT1       ; End date + 1 day
"RTN","RORX006",89,0)
 N RORLTST       ; Closed root of the list of lab tests
"RTN","RORX006",90,0)
 N RORREG        ; Registry IEN
"RTN","RORX006",91,0)
 N RORSDT        ; Start date
"RTN","RORX006",92,0)
 ;
"RTN","RORX006",93,0)
 N ECNT,RC,REPORT,SFLAGS,TMP
"RTN","RORX006",94,0)
 K ^TMP("RORX006",$J)
"RTN","RORX006",95,0)
 S RORLTST="",(ECNT,RC)=0
"RTN","RORX006",96,0)
 ;--- Root node of the report
"RTN","RORX006",97,0)
 S REPORT=$$ADDVAL^RORTSK11(RORTSK,"REPORT")
"RTN","RORX006",98,0)
 Q:REPORT<0 REPORT
"RTN","RORX006",99,0)
 ;
"RTN","RORX006",100,0)
 D
"RTN","RORX006",101,0)
 . ;--- Get and prepare the report parameters
"RTN","RORX006",102,0)
 . S RORREG=$$PARAM^RORTSK01("REGIEN")
"RTN","RORX006",103,0)
 . S RC=$$PARAMS(REPORT,.RORSDT,.ROREDT,.SFLAGS)  Q:RC<0
"RTN","RORX006",104,0)
 . S ROREDT1=$$FMADD^XLFDT(ROREDT\1,1)
"RTN","RORX006",105,0)
 . ;--- Report header
"RTN","RORX006",106,0)
 . S RC=$$HEADER(REPORT)  Q:RC<0
"RTN","RORX006",107,0)
 . ;--- Query the registry
"RTN","RORX006",108,0)
 . D TPPSETUP^RORTSK01(70)
"RTN","RORX006",109,0)
 . S RC=$$QUERY^RORX006A(SFLAGS)
"RTN","RORX006",110,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX006",111,0)
 . ;--- Sort the data
"RTN","RORX006",112,0)
 . D TPPSETUP^RORTSK01(15)
"RTN","RORX006",113,0)
 . S RC=$$SORT^RORX006A()
"RTN","RORX006",114,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX006",115,0)
 . ;--- Store the results
"RTN","RORX006",116,0)
 . D TPPSETUP^RORTSK01(15)
"RTN","RORX006",117,0)
 . S RC=$$STORE^RORX006C(REPORT)
"RTN","RORX006",118,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX006",119,0)
 ;
"RTN","RORX006",120,0)
 ;--- Cleanup
"RTN","RORX006",121,0)
 D FREE^RORTMP(RORLTST)
"RTN","RORX006",122,0)
 K ^TMP("RORX006",$J)
"RTN","RORX006",123,0)
 Q $S(RC<0:RC,ECNT>0:-43,1:0)
"RTN","RORX006",124,0)
 ;
"RTN","RORX006",125,0)
 ;***** OUTPUTS PARAMETERS TO THE REPORT
"RTN","RORX006",126,0)
 ;
"RTN","RORX006",127,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX006",128,0)
 ;
"RTN","RORX006",129,0)
 ; [.STDT]       Start and end dates of the report
"RTN","RORX006",130,0)
 ; [.ENDT]       are returned via these parameters
"RTN","RORX006",131,0)
 ;
"RTN","RORX006",132,0)
 ; [.FLAGS]      Flags for the $$SKIP^RORXU005 are
"RTN","RORX006",133,0)
 ;               returned via this parameter
"RTN","RORX006",134,0)
 ;
"RTN","RORX006",135,0)
 ; Return Values:
"RTN","RORX006",136,0)
 ;       <0  Error code
"RTN","RORX006",137,0)
 ;       >0  IEN of the PARAMETERS element
"RTN","RORX006",138,0)
 ;
"RTN","RORX006",139,0)
PARAMS(PARTAG,STDT,ENDT,FLAGS) ;
"RTN","RORX006",140,0)
 N NAME,PARAMS,TMP
"RTN","RORX006",141,0)
 S PARAMS=$$PARAMS^RORXU002(.RORTSK,PARTAG,.STDT,.ENDT,.FLAGS)
"RTN","RORX006",142,0)
 Q:PARAMS<0 PARAMS
"RTN","RORX006",143,0)
 ;--- Additional parameters
"RTN","RORX006",144,0)
 F NAME="MAXUTNUM","MINRPNUM"  D
"RTN","RORX006",145,0)
 . S TMP=$$PARAM^RORTSK01(NAME)
"RTN","RORX006",146,0)
 . D:TMP'="" ADDVAL^RORTSK11(RORTSK,NAME,TMP,PARAMS)
"RTN","RORX006",147,0)
 ;--- Process the list of Lab tests
"RTN","RORX006",148,0)
 S TMP=$$LTLST^RORXU006(.RORTSK,PARAMS,.RORLTST)  Q:TMP<0 TMP
"RTN","RORX006",149,0)
 ;---
"RTN","RORX006",150,0)
 Q PARAMS
"RTN","RORX006A")
0^14^B41340951^B35649870
"RTN","RORX006A",1,0)
RORX006A ;HOIFO/BH,SG,VAC - LAB UTILIZATION (QUERY & SORT) ;4/7/09 2:07pm
"RTN","RORX006A",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**8,13,19,21,31**;Feb 17, 2006;Build 62
"RTN","RORX006A",3,0)
 ;
"RTN","RORX006A",4,0)
 ; This routine uses the following IAs:
"RTN","RORX006A",5,0)
 ;
"RTN","RORX006A",6,0)
 ; #2056         GET1^DIQ (supported)
"RTN","RORX006A",7,0)
 ; 
"RTN","RORX006A",8,0)
 ;******************************************************************************
"RTN","RORX006A",9,0)
 ;******************************************************************************
"RTN","RORX006A",10,0)
 ;                 --- ROUTINE MODIFICATION LOG ---
"RTN","RORX006A",11,0)
 ;        
"RTN","RORX006A",12,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORX006A",13,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","RORX006A",14,0)
 ;ROR*1.5*8    MAR  2010   V CARR       Modified to handle ICD9 filter for
"RTN","RORX006A",15,0)
 ;                                      'include' or 'exclude'.
"RTN","RORX006A",16,0)
 ;ROR*1.5*13   DEC  2010   A SAUNDERS   User can select specific patients,
"RTN","RORX006A",17,0)
 ;                                      clinics, or divisions for the report.
"RTN","RORX006A",18,0)
 ;ROR*1.5*19   FEB  2012   K GUPTA      Support for ICD-10 Coding System
"RTN","RORX006A",19,0)
 ;ROR*1.5*21   SEP 2013    T KOPP       Add ICN column if Additional Identifier
"RTN","RORX006A",20,0)
 ;                                       requested.
"RTN","RORX006A",21,0)
 ;ROR*1.5*31   MAY 2017    M FERRARESE  Adding PACT, PCP , AGE/DOB as additional
"RTN","RORX006A",22,0)
 ;                                       identifiers.
"RTN","RORX006A",23,0)
 ;******************************************************************************
"RTN","RORX006A",24,0)
 ;******************************************************************************
"RTN","RORX006A",25,0)
 Q
"RTN","RORX006A",26,0)
 ;
"RTN","RORX006A",27,0)
 ;***** LOADS AND PROCESSES THE LAB DATA
"RTN","RORX006A",28,0)
 ;
"RTN","RORX006A",29,0)
 ; DFN           Patient IEN (in file #2)
"RTN","RORX006A",30,0)
 ;
"RTN","RORX006A",31,0)
 ; Return Values:
"RTN","RORX006A",32,0)
 ;       <0  Error code
"RTN","RORX006A",33,0)
 ;        0  Ok
"RTN","RORX006A",34,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX006A",35,0)
 ;
"RTN","RORX006A",36,0)
LABDATA(DFN) ;
"RTN","RORX006A",37,0)
 N DST,ENDT,NR,PTNO,PTNR,PRNT,RC,TSTIEN
"RTN","RORX006A",38,0)
 S DST=$NA(^TMP("RORX006",$J))
"RTN","RORX006A",39,0)
 ;
"RTN","RORX006A",40,0)
 ;--- Get the data
"RTN","RORX006A",41,0)
 S DST("RORCB")="$$LTSCB^RORX006A",DST("RORIDT")=""
"RTN","RORX006A",42,0)
 S RC=$$LTSEARCH^RORUTL10(DFN,RORLTST,.DST,,RORSDT,ROREDT1)
"RTN","RORX006A",43,0)
 Q:RC<0 RC  Q:$D(@DST@("PAT",DFN))<10 0
"RTN","RORX006A",44,0)
 ;
"RTN","RORX006A",45,0)
 ;--- Calculate intermediate totals of the tests
"RTN","RORX006A",46,0)
 N PTNT ;added 'new' statement
"RTN","RORX006A",47,0)
 S TSTIEN=0,(PTNR,PTNT)=0
"RTN","RORX006A",48,0)
 F  S TSTIEN=$O(@DST@("PAT",DFN,"R",TSTIEN))  Q:TSTIEN'>0  D
"RTN","RORX006A",49,0)
 . S NR=+$G(@DST@("PAT",DFN,"R",TSTIEN))
"RTN","RORX006A",50,0)
 . S PTNR=PTNR+NR  ; Number of patient's results
"RTN","RORX006A",51,0)
 . S PTNT=PTNT+1   ; Number of different tests
"RTN","RORX006A",52,0)
 . ;---
"RTN","RORX006A",53,0)
 . S @DST@("RES",TSTIEN,"P")=$G(@DST@("RES",TSTIEN,"P"))+1
"RTN","RORX006A",54,0)
 . S @DST@("RES",TSTIEN,"R")=$G(@DST@("RES",TSTIEN,"R"))+NR
"RTN","RORX006A",55,0)
 . ;---
"RTN","RORX006A",56,0)
 . S TMP=$G(@DST@("RES",TSTIEN,"M"))
"RTN","RORX006A",57,0)
 . D:NR'<TMP
"RTN","RORX006A",58,0)
 . . I NR>TMP  S @DST@("RES",TSTIEN,"M")=NR_U_1  Q
"RTN","RORX006A",59,0)
 . . S $P(@DST@("RES",TSTIEN,"M"),U,2)=$P(TMP,U,2)+1
"RTN","RORX006A",60,0)
 ;
"RTN","RORX006A",61,0)
 ;--- Orders
"RTN","RORX006A",62,0)
 S @DST@("ORD")=$G(@DST@("ORD"))+$G(@DST@("PAT",DFN,"O"))
"RTN","RORX006A",63,0)
 ;
"RTN","RORX006A",64,0)
 ;--- Results
"RTN","RORX006A",65,0)
 S @DST@("RES1",PTNR)=$G(@DST@("RES1",PTNR))+1
"RTN","RORX006A",66,0)
 S @DST@("RES1",PTNR,RORPNAME,DFN)=""
"RTN","RORX006A",67,0)
 ;
"RTN","RORX006A",68,0)
 ;--- Other totals
"RTN","RORX006A",69,0)
 S @DST@("PAT",DFN)=RORLAST4_U_RORDOD_U_$G(RORICN)_U_$G(RORPACT)_U_$G(RORPCP)_U_AGE
"RTN","RORX006A",70,0)
 S @DST@("PAT",DFN,"R")=PTNR_U_PTNT
"RTN","RORX006A",71,0)
 S @DST@("PAT")=$G(@DST@("PAT"))+1
"RTN","RORX006A",72,0)
 S @DST@("RES")=$G(@DST@("RES"))+PTNR
"RTN","RORX006A",73,0)
 Q 0
"RTN","RORX006A",74,0)
 ;
"RTN","RORX006A",75,0)
 ;***** LAB SEARCH CALLBACK
"RTN","RORX006A",76,0)
 ;
"RTN","RORX006A",77,0)
 ; .ROR8DST      Reference to the ROR8DST parameter.
"RTN","RORX006A",78,0)
 ;
"RTN","RORX006A",79,0)
 ; INVDT         IEN of the Lab test (inverted date)
"RTN","RORX006A",80,0)
 ;
"RTN","RORX006A",81,0)
 ; .RESULT       Reference to a local variable, which contains
"RTN","RORX006A",82,0)
 ;               the result (see the $$LTSEARCH^RORUTL10).
"RTN","RORX006A",83,0)
 ;
"RTN","RORX006A",84,0)
 ; Return Values:
"RTN","RORX006A",85,0)
 ;       <0  Error code (the search will be aborted)
"RTN","RORX006A",86,0)
 ;        0  Ok
"RTN","RORX006A",87,0)
 ;        1  Skip this result
"RTN","RORX006A",88,0)
 ;        2  Skip this and all remaining results
"RTN","RORX006A",89,0)
 ;
"RTN","RORX006A",90,0)
LTSCB(ROR8DST,INVDT,RESULT) ;
"RTN","RORX006A",91,0)
 N DFN,TMP,TSTIEN
"RTN","RORX006A",92,0)
 S DFN=+ROR8DST("RORDFN"),TSTIEN=+RESULT(2)
"RTN","RORX006A",93,0)
 ;--- Number of orders
"RTN","RORX006A",94,0)
 I INVDT'=ROR8DST("RORIDT")  D  S ROR8DST("RORIDT")=INVDT
"RTN","RORX006A",95,0)
 . S @ROR8DST@("PAT",DFN,"O")=$G(@ROR8DST@("PAT",DFN,"O"))+1
"RTN","RORX006A",96,0)
 ;--- Number of results
"RTN","RORX006A",97,0)
 S TMP=$G(@ROR8DST@("PAT",DFN,"R",TSTIEN))
"RTN","RORX006A",98,0)
 S @ROR8DST@("PAT",DFN,"R",TSTIEN)=TMP+1
"RTN","RORX006A",99,0)
 Q 0
"RTN","RORX006A",100,0)
 ;
"RTN","RORX006A",101,0)
 ;***** QUERIES THE REGISTRY
"RTN","RORX006A",102,0)
 ;
"RTN","RORX006A",103,0)
 ; FLAGS         Flags for the $$SKIP^RORXU005
"RTN","RORX006A",104,0)
 ;
"RTN","RORX006A",105,0)
 ; Return Values:
"RTN","RORX006A",106,0)
 ;       <0  Error code
"RTN","RORX006A",107,0)
 ;        0  Ok
"RTN","RORX006A",108,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX006A",109,0)
 ;
"RTN","RORX006A",110,0)
QUERY(FLAGS) ;
"RTN","RORX006A",111,0)
 N RORDOD        ; Date of death of the current patient
"RTN","RORX006A",112,0)
 N RORLAST4      ; Last 4 digits of the current patient's SSN
"RTN","RORX006A",113,0)
 N RORPNAME      ; Name of the current patient
"RTN","RORX006A",114,0)
 N RORPTN        ; Number of patients in the registry
"RTN","RORX006A",115,0)
 N RORICN        ; National ICN of patient
"RTN","RORX006A",116,0)
 N RORPACT       ; Primary Care Team
"RTN","RORX006A",117,0)
 N RORPCP        ; Primary Care Physician
"RTN","RORX006A",118,0)
 ;
"RTN","RORX006A",119,0)
 N CNT,ECNT,IEN,IENS,PATIEN,RC,TMP,VA,VADM,XREFNODE
"RTN","RORX006A",120,0)
 N RCC,FLAG
"RTN","RORX006A",121,0)
 N RORCDLIST     ; Flag to indicate whether a clinic or division list exists
"RTN","RORX006A",122,0)
 N RORCDSTDT     ; Start date for clinic/division utilization search
"RTN","RORX006A",123,0)
 N RORCDENDT     ; End date for clinic/division utilization search
"RTN","RORX006A",124,0)
 N AGE,AGETYPE
"RTN","RORX006A",125,0)
 ;
"RTN","RORX006A",126,0)
 S XREFNODE=$NA(^RORDATA(798,"AC",+RORREG))
"RTN","RORX006A",127,0)
 S RORPTN=$$REGSIZE^RORUTL02(+RORREG)  S:RORPTN<0 RORPTN=0
"RTN","RORX006A",128,0)
 S (CNT,ECNT,RC)=0
"RTN","RORX006A",129,0)
 ;
"RTN","RORX006A",130,0)
 ;=== Set up Clinic/Division list parameters
"RTN","RORX006A",131,0)
 S RORCDLIST=$$CDPARMS^RORXU001(.RORTSK,.RORCDSTDT,.RORCDENDT)
"RTN","RORX006A",132,0)
 ;
"RTN","RORX006A",133,0)
 ;--- Browse through the registry records
"RTN","RORX006A",134,0)
 S IEN=0
"RTN","RORX006A",135,0)
 S FLAG=$G(RORTSK("PARAMS","ICDFILT","A","FILTER"))
"RTN","RORX006A",136,0)
 F  S IEN=$O(@XREFNODE@(IEN))  Q:IEN'>0  D  Q:RC<0
"RTN","RORX006A",137,0)
 . S TMP=$S(RORPTN>0:CNT/RORPTN,1:"")
"RTN","RORX006A",138,0)
 . S RC=$$LOOP^RORTSK01(TMP)  Q:RC<0
"RTN","RORX006A",139,0)
 . S IENS=IEN_",",CNT=CNT+1
"RTN","RORX006A",140,0)
 . ;--- Get the patient DFN
"RTN","RORX006A",141,0)
 . S PATIEN=$$PTIEN^RORUTL01(IEN)  Q:PATIEN'>0
"RTN","RORX006A",142,0)
 . ;--- Check for patient list and quit if not on list
"RTN","RORX006A",143,0)
 . I $D(RORTSK("PARAMS","PATIENTS","C")),'$D(RORTSK("PARAMS","PATIENTS","C",PATIEN)) Q
"RTN","RORX006A",144,0)
 . ;--- Check if the patient should be skipped
"RTN","RORX006A",145,0)
 . Q:$$SKIP^RORXU005(IEN,FLAGS,RORSDT,ROREDT)
"RTN","RORX006A",146,0)
 . ;--- Check if ICD Filter Includes or Excludes Patient
"RTN","RORX006A",147,0)
 . S RCC=0
"RTN","RORX006A",148,0)
 . I FLAG'="ALL" D
"RTN","RORX006A",149,0)
 . . S RCC=$$ICD^RORXU010(PATIEN)
"RTN","RORX006A",150,0)
 . I (FLAG="INCLUDE")&(RCC=0) Q
"RTN","RORX006A",151,0)
 . I (FLAG="EXCLUDE")&(RCC=1) Q
"RTN","RORX006A",152,0)
 . ;--- End of ICD Filter check
"RTN","RORX006A",153,0)
 . ;--- Check for Clinic or Division list and quit if not in list
"RTN","RORX006A",154,0)
 . I RORCDLIST,'$$CDUTIL^RORXU001(.RORTSK,PATIEN,RORCDSTDT,RORCDENDT) Q
"RTN","RORX006A",155,0)
 . ;--- Get the patient's data
"RTN","RORX006A",156,0)
 . D VADEM^RORUTL05(PATIEN,1)
"RTN","RORX006A",157,0)
 . S RORPNAME=VADM(1),RORLAST4=VA("BID")
"RTN","RORX006A",158,0)
 . S RORDOD=$$DATE^RORXU002($P(VADM(6),U)\1)
"RTN","RORX006A",159,0)
 . I $$PARAM^RORTSK01("PATIENTS","ICN") S RORICN=$$ICN^RORUTL02(PATIEN)
"RTN","RORX006A",160,0)
 . I $$PARAM^RORTSK01("PATIENTS","PACT") S RORPACT=$$PACT^RORUTL02(PATIEN)
"RTN","RORX006A",161,0)
 . I $$PARAM^RORTSK01("PATIENTS","PCP") S RORPCP=$$PCP^RORUTL02(PATIEN)
"RTN","RORX006A",162,0)
 . S AGETYPE=$$PARAM^RORTSK01("AGE_RANGE","TYPE")
"RTN","RORX006A",163,0)
 . S AGE=$S(AGETYPE="AGE":$P(VADM(4),U),AGETYPE="DOB":$$DATE^RORXU002($P(VADM(3),U)\1),1:"")
"RTN","RORX006A",164,0)
 . ;
"RTN","RORX006A",165,0)
 . ;--- Get the Lab data
"RTN","RORX006A",166,0)
 . S RC=$$LABDATA(PATIEN)
"RTN","RORX006A",167,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX006A",168,0)
 ;---
"RTN","RORX006A",169,0)
 Q $S(RC<0:RC,1:ECNT)
"RTN","RORX006A",170,0)
 ;
"RTN","RORX006A",171,0)
 ;***** SORTS THE RESULTS AND COMPILES THE TOTALS
"RTN","RORX006A",172,0)
 ;
"RTN","RORX006A",173,0)
 ; Return Values:
"RTN","RORX006A",174,0)
 ;       <0  Error code
"RTN","RORX006A",175,0)
 ;        0  Ok
"RTN","RORX006A",176,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX006A",177,0)
 ;
"RTN","RORX006A",178,0)
SORT() ;
"RTN","RORX006A",179,0)
 N ECNT,IEN,NAME,NDLT,NODE,RC,RORMSG,TMP
"RTN","RORX006A",180,0)
 S NODE=$NA(^TMP("RORX006",$J)),(ECNT,RC)=0
"RTN","RORX006A",181,0)
 ;---
"RTN","RORX006A",182,0)
 S RC=$$LOOP^RORTSK01(0)  Q:RC<0 RC
"RTN","RORX006A",183,0)
 Q:$D(@NODE)<10 0
"RTN","RORX006A",184,0)
 ;---
"RTN","RORX006A",185,0)
 S IEN=0,NDLT=0
"RTN","RORX006A",186,0)
 F  S IEN=$O(@NODE@("RES",IEN))  Q:IEN'>0  D
"RTN","RORX006A",187,0)
 . S NDLT=NDLT+1
"RTN","RORX006A",188,0)
 . K RORMSG S NAME=$$GET1^DIQ(60,IEN,.01,,,"RORMSG")
"RTN","RORX006A",189,0)
 . ;D:$G(DIERR) DBS^RORERR("RORMSG",-9,,,60,IEN)
"RTN","RORX006A",190,0)
 . D:$G(RORMSG("DIERR")) DBS^RORERR("RORMSG",-9,,,60,IEN)
"RTN","RORX006A",191,0)
 . S:NAME?." " NAME="Unknown ("_IEN_")"
"RTN","RORX006A",192,0)
 . S TMP=+$G(@NODE@("RES",IEN,"R"))
"RTN","RORX006A",193,0)
 . S @NODE@("RES","B",TMP,NAME,IEN)=""
"RTN","RORX006A",194,0)
 ;--- Total numbers of Lab tests
"RTN","RORX006A",195,0)
 S $P(@NODE@("RES"),U,2)=NDLT
"RTN","RORX006A",196,0)
 ;---
"RTN","RORX006A",197,0)
 Q $S(RC<0:RC,1:ECNT)
"RTN","RORX006C")
0^15^B25987651^B22918813
"RTN","RORX006C",1,0)
RORX006C ;HCIOFO/BH,SG - LAB UTILIZATION (STORE) ;9/19/05 9:39am
"RTN","RORX006C",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**21,31**;Feb 17, 2006;Build 62
"RTN","RORX006C",3,0)
 ;
"RTN","RORX006C",4,0)
 ;******************************************************************************
"RTN","RORX006C",5,0)
 ;******************************************************************************
"RTN","RORX006C",6,0)
 ;                       --- ROUTINE MODIFICATION LOG ---
"RTN","RORX006C",7,0)
 ;        
"RTN","RORX006C",8,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORX006C",9,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","RORX006C",10,0)
 ;ROR*1.5*21   SEP 2013    T KOPP       Add ICN column if Additional Identifier
"RTN","RORX006C",11,0)
 ;                                       requested.
"RTN","RORX006C",12,0)
 ;ROR*1.5*31   MAY 2017    M FERRARESE  Adding PACT, PCP, AGE/DOB as additional
"RTN","RORX006C",13,0)
 ;                                       identifiers.
"RTN","RORX006C",14,0)
 ;******************************************************************************
"RTN","RORX006C",15,0)
 Q
"RTN","RORX006C",16,0)
 ;
"RTN","RORX006C",17,0)
 ;***** PATIENTS WITH HIGHEST UTILIZATION
"RTN","RORX006C",18,0)
 ;
"RTN","RORX006C",19,0)
 ; PRNTELMT      IEN of the parent element
"RTN","RORX006C",20,0)
 ;
"RTN","RORX006C",21,0)
 ; NODE          Closed root of the category section
"RTN","RORX006C",22,0)
 ;               in the temporary global
"RTN","RORX006C",23,0)
 ;
"RTN","RORX006C",24,0)
 ; Return Values:
"RTN","RORX006C",25,0)
 ;       <0  Error code
"RTN","RORX006C",26,0)
 ;        0  Ok
"RTN","RORX006C",27,0)
 ;
"RTN","RORX006C",28,0)
PATIENTS(PRNTELMT,NODE) ;
"RTN","RORX006C",29,0)
 Q:$D(@NODE@("PAT"))<10 0
"RTN","RORX006C",30,0)
 N COUNT,DFN,ITEM,MAXUTNUM,NAME,NUM,RC,TMP,AGETYPE
"RTN","RORX006C",31,0)
 S MAXUTNUM=$$PARAM^RORTSK01("MAXUTNUM")
"RTN","RORX006C",32,0)
 Q:MAXUTNUM'>0 0
"RTN","RORX006C",33,0)
 S TABLE=$$ADDVAL^RORTSK11(RORTSK,"PATIENTS",,PRNTELMT)
"RTN","RORX006C",34,0)
 Q:TABLE<0 TABLE
"RTN","RORX006C",35,0)
 D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","PATIENTS")
"RTN","RORX006C",36,0)
 ;---
"RTN","RORX006C",37,0)
 S NUM="",(COUNT,RC)=0
"RTN","RORX006C",38,0)
 S AGETYPE=$$PARAM^RORTSK01("AGE_RANGE","TYPE")
"RTN","RORX006C",39,0)
 F  S NUM=$O(@NODE@("RES1",NUM),-1)  Q:NUM=""  D  Q:RC
"RTN","RORX006C",40,0)
 . S NAME=""
"RTN","RORX006C",41,0)
 . F  S NAME=$O(@NODE@("RES1",NUM,NAME))  Q:NAME=""  D  Q:RC
"RTN","RORX006C",42,0)
 . . S DFN=""
"RTN","RORX006C",43,0)
 . . F  S DFN=$O(@NODE@("RES1",NUM,NAME,DFN))  Q:DFN=""  D  Q:RC
"RTN","RORX006C",44,0)
 . . . S COUNT=COUNT+1  I COUNT>MAXUTNUM  S RC=1  Q
"RTN","RORX006C",45,0)
 . . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"PATIENT",,TABLE)
"RTN","RORX006C",46,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"NAME",NAME,ITEM,1)
"RTN","RORX006C",47,0)
 . . . S TMP=$G(@NODE@("PAT",DFN))
"RTN","RORX006C",48,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"LAST4",$P(TMP,U),ITEM,2)
"RTN","RORX006C",49,0)
 . . . I AGETYPE'="ALL" D ADDVAL^RORTSK11(RORTSK,AGETYPE,$P(TMP,U,6),ITEM,1)
"RTN","RORX006C",50,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"DOD",$P(TMP,U,2),ITEM,1)
"RTN","RORX006C",51,0)
 . . . S TMP=+$G(@NODE@("PAT",DFN,"O"))
"RTN","RORX006C",52,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"NO",TMP,ITEM,3)
"RTN","RORX006C",53,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"NR",NUM,ITEM,3)
"RTN","RORX006C",54,0)
 . . . S TMP=+$P($G(@NODE@("PAT",DFN,"R")),U,2)
"RTN","RORX006C",55,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"NDT",TMP,ITEM,3)
"RTN","RORX006C",56,0)
 . . . S TMP=$G(@NODE@("PAT",DFN))
"RTN","RORX006C",57,0)
 . . . I $$PARAM^RORTSK01("PATIENTS","ICN") D
"RTN","RORX006C",58,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"ICN",$P(TMP,U,3),ITEM,1)
"RTN","RORX006C",59,0)
 . . . I $$PARAM^RORTSK01("PATIENTS","PACT") D
"RTN","RORX006C",60,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"PACT",$P(TMP,U,4),ITEM,1)
"RTN","RORX006C",61,0)
 . . . I $$PARAM^RORTSK01("PATIENTS","PCP") D
"RTN","RORX006C",62,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"PCP",$P(TMP,U,5),ITEM,1)
"RTN","RORX006C",63,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORX006C",64,0)
 ;
"RTN","RORX006C",65,0)
 ;***** NUMBERS OF PATIENTS AND RESULTS
"RTN","RORX006C",66,0)
 ;
"RTN","RORX006C",67,0)
 ; PRNTELMT      IEN of the parent element
"RTN","RORX006C",68,0)
 ;
"RTN","RORX006C",69,0)
 ; NODE          Closed root of the category section
"RTN","RORX006C",70,0)
 ;               in the temporary global
"RTN","RORX006C",71,0)
 ;
"RTN","RORX006C",72,0)
 ; Return Values:
"RTN","RORX006C",73,0)
 ;       <0  Error code
"RTN","RORX006C",74,0)
 ;        0  Ok
"RTN","RORX006C",75,0)
 ;
"RTN","RORX006C",76,0)
RESULTS(PRNTELMT,NODE) ;
"RTN","RORX006C",77,0)
 Q:$D(@NODE@("RES1"))<10 0
"RTN","RORX006C",78,0)
 N ITEM,NUM,RC,TABLE
"RTN","RORX006C",79,0)
 S TABLE=$$ADDVAL^RORTSK11(RORTSK,"RESULTS",,PRNTELMT)
"RTN","RORX006C",80,0)
 Q:TABLE<0 TABLE
"RTN","RORX006C",81,0)
 D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","RESULTS")
"RTN","RORX006C",82,0)
 S NUM="",RC=0
"RTN","RORX006C",83,0)
 F  S NUM=$O(@NODE@("RES1",NUM),-1)  Q:NUM=""  D  Q:RC
"RTN","RORX006C",84,0)
 . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"ITEM",,TABLE)
"RTN","RORX006C",85,0)
 . S TMP=+$G(@NODE@("RES1",NUM))
"RTN","RORX006C",86,0)
 . D ADDVAL^RORTSK11(RORTSK,"NP",TMP,ITEM,3)
"RTN","RORX006C",87,0)
 . D ADDVAL^RORTSK11(RORTSK,"NR",NUM,ITEM,3)
"RTN","RORX006C",88,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORX006C",89,0)
 ;
"RTN","RORX006C",90,0)
 ;***** STORES THE REPORT DATA
"RTN","RORX006C",91,0)
 ;
"RTN","RORX006C",92,0)
 ; REPORT        IEN of the REPORT element
"RTN","RORX006C",93,0)
 ;
"RTN","RORX006C",94,0)
 ; Return Values:
"RTN","RORX006C",95,0)
 ;       <0  Error code
"RTN","RORX006C",96,0)
 ;        0  Ok
"RTN","RORX006C",97,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX006C",98,0)
 ;
"RTN","RORX006C",99,0)
STORE(REPORT) ;
"RTN","RORX006C",100,0)
 N RORSONLY      ; Output summary only
"RTN","RORX006C",101,0)
 ;
"RTN","RORX006C",102,0)
 N ECNT,NODE,RC,RORI,SUBLST,TMP
"RTN","RORX006C",103,0)
 S RORSONLY=$$SMRYONLY^RORXU006()
"RTN","RORX006C",104,0)
 S (ECNT,RC)=0
"RTN","RORX006C",105,0)
 ;---
"RTN","RORX006C",106,0)
 S NODE=$NA(^TMP("RORX006",$J))
"RTN","RORX006C",107,0)
 Q:$D(@NODE)<10 0
"RTN","RORX006C",108,0)
 ;--- Tables
"RTN","RORX006C",109,0)
 S RC=$$LOOP^RORTSK01(0)  Q:RC<0 RC
"RTN","RORX006C",110,0)
 S RC=$$RESULTS(REPORT,NODE)
"RTN","RORX006C",111,0)
 I RC  Q:RC<0 RC  S ECNT=ECNT+RC
"RTN","RORX006C",112,0)
 ;---
"RTN","RORX006C",113,0)
 S RC=$$LOOP^RORTSK01(1/3)  Q:RC<0 RC
"RTN","RORX006C",114,0)
 S RC=$$TESTS(REPORT,NODE)
"RTN","RORX006C",115,0)
 I RC  Q:RC<0 RC  S ECNT=ECNT+RC
"RTN","RORX006C",116,0)
 ;---
"RTN","RORX006C",117,0)
 S RC=$$LOOP^RORTSK01(2/3)  Q:RC<0 RC
"RTN","RORX006C",118,0)
 S RC=$$PATIENTS(REPORT,NODE)
"RTN","RORX006C",119,0)
 I RC  Q:RC<0 RC  S ECNT=ECNT+RC
"RTN","RORX006C",120,0)
 ;--- Summary
"RTN","RORX006C",121,0)
 D ADDVAL^RORTSK11(RORTSK,"NO",+$G(@NODE@("ORD")),REPORT)
"RTN","RORX006C",122,0)
 S TMP=$G(@NODE@("RES"))
"RTN","RORX006C",123,0)
 D ADDVAL^RORTSK11(RORTSK,"NR",+$P(TMP,U),REPORT)
"RTN","RORX006C",124,0)
 D ADDVAL^RORTSK11(RORTSK,"NDT",+$P(TMP,U,2),REPORT)
"RTN","RORX006C",125,0)
 D ADDVAL^RORTSK11(RORTSK,"NP",+$G(@NODE@("PAT")),REPORT)
"RTN","RORX006C",126,0)
 ;---
"RTN","RORX006C",127,0)
 Q $S(RC<0:RC,1:ECNT)
"RTN","RORX006C",128,0)
 ;
"RTN","RORX006C",129,0)
 ;***** LAB TESTS
"RTN","RORX006C",130,0)
 ;
"RTN","RORX006C",131,0)
 ; PRNTELMT      IEN of the parent element
"RTN","RORX006C",132,0)
 ;
"RTN","RORX006C",133,0)
 ; NODE          Closed root of the category section
"RTN","RORX006C",134,0)
 ;               in the temporary global
"RTN","RORX006C",135,0)
 ;
"RTN","RORX006C",136,0)
 ; Return Values:
"RTN","RORX006C",137,0)
 ;       <0  Error code
"RTN","RORX006C",138,0)
 ;        0  Ok
"RTN","RORX006C",139,0)
 ;
"RTN","RORX006C",140,0)
TESTS(PRNTELMT,NODE) ;
"RTN","RORX006C",141,0)
 Q:$D(@NODE@("RES"))<10 0
"RTN","RORX006C",142,0)
 N IEN,ITEM,MINRPNUM,NAME,NUM,RC,TMP
"RTN","RORX006C",143,0)
 S MINRPNUM=$$PARAM^RORTSK01("MINRPNUM")
"RTN","RORX006C",144,0)
 Q:MINRPNUM'>0 0
"RTN","RORX006C",145,0)
 S TABLE=$$ADDVAL^RORTSK11(RORTSK,"LABTESTS",,PRNTELMT)
"RTN","RORX006C",146,0)
 Q:TABLE<0 TABLE
"RTN","RORX006C",147,0)
 D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","LABTESTS")
"RTN","RORX006C",148,0)
 ;---
"RTN","RORX006C",149,0)
 S NUM="",RC=0
"RTN","RORX006C",150,0)
 F  S NUM=$O(@NODE@("RES","B",NUM),-1)  Q:NUM<MINRPNUM  D  Q:RC
"RTN","RORX006C",151,0)
 . S NAME=""
"RTN","RORX006C",152,0)
 . F  S NAME=$O(@NODE@("RES","B",NUM,NAME))  Q:NAME=""  D  Q:RC
"RTN","RORX006C",153,0)
 . . S IEN=""
"RTN","RORX006C",154,0)
 . . F  S IEN=$O(@NODE@("RES","B",NUM,NAME,IEN))  Q:IEN=""  D  Q:RC
"RTN","RORX006C",155,0)
 . . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"LT",,TABLE)
"RTN","RORX006C",156,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"NAME",NAME,ITEM,1)
"RTN","RORX006C",157,0)
 . . . S TMP=+$G(@NODE@("RES",IEN,"P"))
"RTN","RORX006C",158,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"NP",TMP,ITEM,3)
"RTN","RORX006C",159,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"NR",NUM,ITEM,3)
"RTN","RORX006C",160,0)
 . . . S TMP=$G(@NODE@("RES",IEN,"M"))
"RTN","RORX006C",161,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"MAXNRPP",+$P(TMP,U),ITEM,3)
"RTN","RORX006C",162,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"MAXNP",+$P(TMP,U,2),ITEM,3)
"RTN","RORX006C",163,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORX007")
0^16^B66066509^B53595796
"RTN","RORX007",1,0)
RORX007 ;HCIOFO/BH,SG - RADIOLOGY UTILIZATION ;10/14/05 1:37pm
"RTN","RORX007",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**21,31**;Feb 17, 2006;Build 62
"RTN","RORX007",3,0)
 ;
"RTN","RORX007",4,0)
 ; This routine uses the following IAs:
"RTN","RORX007",5,0)
 ;
"RTN","RORX007",6,0)
 ; #10061        DEM^VADPT (supported)
"RTN","RORX007",7,0)
 ;
"RTN","RORX007",8,0)
 ;******************************************************************************
"RTN","RORX007",9,0)
 ;                       --- ROUTINE MODIFICATION LOG ---
"RTN","RORX007",10,0)
 ;        
"RTN","RORX007",11,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORX007",12,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","RORX007",13,0)
 ;ROR*1.5*21   SEP 2013    T KOPP       Added ICN as last report column if
"RTN","RORX007",14,0)
 ;                                      additional identifier option selected
"RTN","RORX007",15,0)
 ;ROR*1.5*31   MAY 2017    M FERRARESE  Adding PACT, PCP, and AGE/DOB as additional
"RTN","RORX007",16,0)
 ;                                      identifiers.
"RTN","RORX007",17,0)
 ;******************************************************************************
"RTN","RORX007",18,0)
 Q
"RTN","RORX007",19,0)
 ;
"RTN","RORX007",20,0)
 ;***** COMPILES THE "RADIOLOGY UTILIZATION" REPORT
"RTN","RORX007",21,0)
 ; REPORT CODE: 007
"RTN","RORX007",22,0)
 ;
"RTN","RORX007",23,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORX007",24,0)
 ;
"RTN","RORX007",25,0)
 ; The ^TMP("RORX007",$J) and ^TMP($J,"RAE1") global nodes are
"RTN","RORX007",26,0)
 ; used by this function.
"RTN","RORX007",27,0)
 ;
"RTN","RORX007",28,0)
 ; ^TMP("RORX007",$J,
"RTN","RORX007",29,0)
 ;
"RTN","RORX007",30,0)
 ;     "PAT",
"RTN","RORX007",31,0)
 ;       DFN,
"RTN","RORX007",32,0)
 ;         ProcName)     Number of procedures
"RTN","RORX007",33,0)
 ;
"RTN","RORX007",34,0)
 ;     "PATSORT",
"RTN","RORX007",35,0)
 ;       ProcQnty,
"RTN","RORX007",36,0)
 ;         Name,
"RTN","RORX007",37,0)
 ;           Last4)      Patient data
"RTN","RORX007",38,0)
 ;                         ^01: Number of different procedures
"RTN","RORX007",39,0)
 ;                         ^02: Date of death
"RTN","RORX007",40,0)
 ;                         ^03: National ICN
"RTN","RORX007",41,0)
 ;                         ^04: Patient Care Team
"RTN","RORX007",42,0)
 ;                         ^05: Primary Care Provider
"RTN","RORX007",43,0)
 ;                         ^06: AGE/DOB
"RTN","RORX007",44,0)
 ;
"RTN","RORX007",45,0)
 ;     "PROC",
"RTN","RORX007",46,0)
 ;       ProcName,
"RTN","RORX007",47,0)
 ;         DFN)          Number of procedures
"RTN","RORX007",48,0)
 ;
"RTN","RORX007",49,0)
 ;     "PROCSORT",
"RTN","RORX007",50,0)
 ;       ProcQnty,
"RTN","RORX007",51,0)
 ;         ProcName,
"RTN","RORX007",52,0)
 ;           CPT)        Number of individual patients
"RTN","RORX007",53,0)
 ;
"RTN","RORX007",54,0)
 ;     "TOTAL")          Category Totals
"RTN","RORX007",55,0)
 ;                         ^01: Total number of procedures
"RTN","RORX007",56,0)
 ;                         ^02: Number of different procedures
"RTN","RORX007",57,0)
 ;                         ^03: Total number of patients
"RTN","RORX007",58,0)
 ;                         ^04: Number of individual patients
"RTN","RORX007",59,0)
 ;
"RTN","RORX007",60,0)
 ; Return Values:
"RTN","RORX007",61,0)
 ;       <0  Error code
"RTN","RORX007",62,0)
 ;        0  Ok
"RTN","RORX007",63,0)
 ;
"RTN","RORX007",64,0)
RADUTL(RORTSK) ;
"RTN","RORX007",65,0)
 N ROREDT        ; End date
"RTN","RORX007",66,0)
 N RORREG        ; Registry IEN
"RTN","RORX007",67,0)
 N RORSDT        ; Start date
"RTN","RORX007",68,0)
 ;
"RTN","RORX007",69,0)
 N CNT,ECNT,RC,REPORT,RORPTN,SFLAGS,TMP
"RTN","RORX007",70,0)
 ;--- Root node of the report
"RTN","RORX007",71,0)
 S REPORT=$$ADDVAL^RORTSK11(RORTSK,"REPORT")
"RTN","RORX007",72,0)
 Q:REPORT<0 REPORT
"RTN","RORX007",73,0)
 ;
"RTN","RORX007",74,0)
 ;--- Get and prepare the report parameters
"RTN","RORX007",75,0)
 S RORREG=$$PARAM^RORTSK01("REGIEN")
"RTN","RORX007",76,0)
 S RC=$$PARAMS^RORX007A(REPORT,.RORSDT,.ROREDT,.SFLAGS)
"RTN","RORX007",77,0)
 Q:RC<0 RC
"RTN","RORX007",78,0)
 ;
"RTN","RORX007",79,0)
 ;--- Initialize constants and variables
"RTN","RORX007",80,0)
 S RORPTN=$$REGSIZE^RORUTL02(+RORREG)  S:RORPTN<0 RORPTN=0
"RTN","RORX007",81,0)
 S ECNT=0  K ^TMP("RORX007",$J)
"RTN","RORX007",82,0)
 ;
"RTN","RORX007",83,0)
 ;--- Report header
"RTN","RORX007",84,0)
 S RC=$$HEADER^RORX007A(REPORT)  Q:RC<0 RC
"RTN","RORX007",85,0)
 ;
"RTN","RORX007",86,0)
 D
"RTN","RORX007",87,0)
 . ;--- Query the registry
"RTN","RORX007",88,0)
 . D TPPSETUP^RORTSK01(75)
"RTN","RORX007",89,0)
 . S RC=$$QUERY^RORX007A(SFLAGS)
"RTN","RORX007",90,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX007",91,0)
 . ;--- Sort the data
"RTN","RORX007",92,0)
 . D TPPSETUP^RORTSK01(10)
"RTN","RORX007",93,0)
 . S RC=$$SORT()
"RTN","RORX007",94,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX007",95,0)
 . ;--- Store the results
"RTN","RORX007",96,0)
 . D TPPSETUP^RORTSK01(15)
"RTN","RORX007",97,0)
 . S RC=$$STORE(REPORT)
"RTN","RORX007",98,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX007",99,0)
 ;
"RTN","RORX007",100,0)
 ;--- Cleanup
"RTN","RORX007",101,0)
 K ^TMP("RORX007",$J),^TMP($J,"RAE1")
"RTN","RORX007",102,0)
 Q $S(RC<0:RC,ECNT>0:-43,1:0)
"RTN","RORX007",103,0)
 ;
"RTN","RORX007",104,0)
 ;***** SORTS THE RESULTS AND COMPILES THE TOTALS
"RTN","RORX007",105,0)
 ;
"RTN","RORX007",106,0)
 ; SPCNT         Number of patients selected for the report
"RTN","RORX007",107,0)
 ;
"RTN","RORX007",108,0)
 ; Return Values:
"RTN","RORX007",109,0)
 ;       <0  Error code
"RTN","RORX007",110,0)
 ;        0  Ok
"RTN","RORX007",111,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX007",112,0)
 ;
"RTN","RORX007",113,0)
SORT(SPCNT) ;
"RTN","RORX007",114,0)
 N DFN,DOD,DPCNT,ECNT,ICN,NAME,NODE,PACT,PCP,PRCNT,PQ,PRN,RC,TMP,TOTAL,VA,VADM,VAHOW,VAROOT,AGETYPE,AGE
"RTN","RORX007",115,0)
 S (ECNT,RC)=0
"RTN","RORX007",116,0)
 S NODE=$NA(^TMP("RORX007",$J))
"RTN","RORX007",117,0)
 Q:$D(@NODE)<10 0
"RTN","RORX007",118,0)
 ;--- Procedures
"RTN","RORX007",119,0)
 S RC=$$LOOP^RORTSK01(0)  Q:RC<0 RC
"RTN","RORX007",120,0)
 S PRN=""
"RTN","RORX007",121,0)
 F  S PRN=$O(@NODE@("PROC",PRN))  Q:PRN=""  D
"RTN","RORX007",122,0)
 . S (DPCNT,PRCNT)=0
"RTN","RORX007",123,0)
 . S DFN=""
"RTN","RORX007",124,0)
 . F  S DFN=$O(@NODE@("PROC",PRN,DFN))  Q:DFN=""  D
"RTN","RORX007",125,0)
 . . S PQ=$G(@NODE@("PROC",PRN,DFN))
"RTN","RORX007",126,0)
 . . S DPCNT=DPCNT+1,PRCNT=PRCNT+PQ
"RTN","RORX007",127,0)
 . ;---
"RTN","RORX007",128,0)
 . S @NODE@("PROCSORT",PRCNT,$P(PRN,U),$P(PRN,U,2))=DPCNT
"RTN","RORX007",129,0)
 . S TOTAL("DPR")=$G(TOTAL("DPR"))+1      ; Different procedures
"RTN","RORX007",130,0)
 . S TOTAL("TPT")=$G(TOTAL("TPT"))+DPCNT  ; Number of patients
"RTN","RORX007",131,0)
 K @NODE@("PROC")
"RTN","RORX007",132,0)
 ;--- Patients
"RTN","RORX007",133,0)
 S RC=$$LOOP^RORTSK01(0.5)  Q:RC<0 RC
"RTN","RORX007",134,0)
 S DFN=""
"RTN","RORX007",135,0)
 F  S DFN=$O(@NODE@("PAT",DFN))  Q:DFN=""  D
"RTN","RORX007",136,0)
 . S (DPCNT,PRCNT)=0
"RTN","RORX007",137,0)
 . D DEM^VADPT
"RTN","RORX007",138,0)
 . S NAME=$G(VADM(1))  Q:NAME=""
"RTN","RORX007",139,0)
 . S LAST4=$G(VA("BID"))  S:LAST4="" LAST4=" "
"RTN","RORX007",140,0)
 . S DOD=$$DATE^RORXU002($P(VADM(6),U)\1)
"RTN","RORX007",141,0)
 . S ICN=$$ICN^RORUTL02(DFN)
"RTN","RORX007",142,0)
 . S PACT=$$PACT^RORUTL02(DFN)
"RTN","RORX007",143,0)
 . S PCP=$$PCP^RORUTL02(DFN)
"RTN","RORX007",144,0)
 . S AGETYPE=$$PARAM^RORTSK01("AGE_RANGE","TYPE") D
"RTN","RORX007",145,0)
 . . S AGE=$S(AGETYPE="AGE":$P(VADM(4),U),AGETYPE="DOB":$$DATE^RORXU002($P(VADM(3),U)\1),1:"")
"RTN","RORX007",146,0)
 . S PRN=""
"RTN","RORX007",147,0)
 . F  S PRN=$O(@NODE@("PAT",DFN,PRN))  Q:PRN=""  D
"RTN","RORX007",148,0)
 . . S PQ=$G(@NODE@("PAT",DFN,PRN))
"RTN","RORX007",149,0)
 . . S DPCNT=DPCNT+1,PRCNT=PRCNT+PQ
"RTN","RORX007",150,0)
 . ;---
"RTN","RORX007",151,0)
 . S PACT=$S($$PARAM^RORTSK01("PATIENTS","PACT"):PACT,1:"")
"RTN","RORX007",152,0)
 . S PCP=$S($$PARAM^RORTSK01("PATIENTS","PCP"):PCP,1:"")
"RTN","RORX007",153,0)
 . S @NODE@("PATSORT",PRCNT,NAME,LAST4)=DPCNT_U_DOD_U_$S($$PARAM^RORTSK01("PATIENTS","ICN"):ICN,1:"")_U_PACT_U_PCP_U_AGE
"RTN","RORX007",154,0)
 . S TOTAL("TPR")=$G(TOTAL("TPR"))+PRCNT  ; Number of procedures
"RTN","RORX007",155,0)
 . S TOTAL("DPT")=$G(TOTAL("DPT"))+1      ; Different patients
"RTN","RORX007",156,0)
 K @NODE@("PAT")
"RTN","RORX007",157,0)
 ;--- Totals
"RTN","RORX007",158,0)
 S TMP=$G(TOTAL("TPR"))_U_$G(TOTAL("DPR"))
"RTN","RORX007",159,0)
 S @NODE@("TOTAL")=TMP_U_$G(TOTAL("TPT"))_U_$G(TOTAL("DPT"))
"RTN","RORX007",160,0)
 ;---
"RTN","RORX007",161,0)
 Q $S(RC<0:RC,1:ECNT)
"RTN","RORX007",162,0)
 ;
"RTN","RORX007",163,0)
 ;***** STORES THE RESULTS
"RTN","RORX007",164,0)
 ;
"RTN","RORX007",165,0)
 ; Return Values:
"RTN","RORX007",166,0)
 ;       <0  Error code
"RTN","RORX007",167,0)
 ;        0  Ok
"RTN","RORX007",168,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX007",169,0)
 ;
"RTN","RORX007",170,0)
STORE(PARTAG) ;
"RTN","RORX007",171,0)
 N RORSONLY      ; Output summary only
"RTN","RORX007",172,0)
 ;
"RTN","RORX007",173,0)
 N RC,TMP
"RTN","RORX007",174,0)
 S RORSONLY=$$SMRYONLY^RORXU006()
"RTN","RORX007",175,0)
 S RC=0
"RTN","RORX007",176,0)
 ;--- Tables
"RTN","RORX007",177,0)
 Q:$D(^TMP("RORX007",$J))<10 0
"RTN","RORX007",178,0)
 ;--- Procedures
"RTN","RORX007",179,0)
 S RC=$$LOOP^RORTSK01(0)    Q:RC<0 RC
"RTN","RORX007",180,0)
 S RC=$$TBLPROC(PARTAG)     Q:RC<0 RC
"RTN","RORX007",181,0)
 ;--- Patients
"RTN","RORX007",182,0)
 S RC=$$LOOP^RORTSK01(0.5)  Q:RC<0 RC
"RTN","RORX007",183,0)
 S RC=$$TBLPAT(PARTAG)      Q:RC<0 RC
"RTN","RORX007",184,0)
 ;--- Totals
"RTN","RORX007",185,0)
 S TMP=$G(^TMP("RORX007",$J,"TOTAL"))
"RTN","RORX007",186,0)
 D ADDVAL^RORTSK11(RORTSK,"NPR",$P(TMP,U,1),PARTAG)
"RTN","RORX007",187,0)
 D ADDVAL^RORTSK11(RORTSK,"NDP",$P(TMP,U,2),PARTAG)
"RTN","RORX007",188,0)
 D ADDVAL^RORTSK11(RORTSK,"NP",$P(TMP,U,4),PARTAG)
"RTN","RORX007",189,0)
 ;---
"RTN","RORX007",190,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORX007",191,0)
 ;
"RTN","RORX007",192,0)
 ;***** STORES THE TABLE OF PATIENTS
"RTN","RORX007",193,0)
 ;
"RTN","RORX007",194,0)
 ; PRNTELMT      IEN of the parent tag
"RTN","RORX007",195,0)
 ;
"RTN","RORX007",196,0)
 ; Return Values:
"RTN","RORX007",197,0)
 ;       <0  Error code
"RTN","RORX007",198,0)
 ;        0  Ok
"RTN","RORX007",199,0)
 ;
"RTN","RORX007",200,0)
TBLPAT(PRNTELMT) ;
"RTN","RORX007",201,0)
 N BUF,ITEM,LAST4,MAXUTNUM,NAME,NODE,PRCNT,RC,TABLE,TMP,UTNUM
"RTN","RORX007",202,0)
 S MAXUTNUM=$$PARAM^RORTSK01("MAXUTNUM")
"RTN","RORX007",203,0)
 Q:MAXUTNUM'>0 0
"RTN","RORX007",204,0)
 S TABLE=$$ADDVAL^RORTSK11(RORTSK,"PATIENTS",,PRNTELMT)
"RTN","RORX007",205,0)
 Q:TABLE<0 TABLE
"RTN","RORX007",206,0)
 D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","PATIENTS")
"RTN","RORX007",207,0)
 S NODE=$NA(^TMP("RORX007",$J,"PATSORT"))
"RTN","RORX007",208,0)
 ;--- Table
"RTN","RORX007",209,0)
 S PRCNT="",(RC,UTNUM)=0
"RTN","RORX007",210,0)
 F  S PRCNT=$O(@NODE@(PRCNT),-1)  Q:PRCNT=""  D  Q:RC
"RTN","RORX007",211,0)
 . S NAME=""
"RTN","RORX007",212,0)
 . F  S NAME=$O(@NODE@(PRCNT,NAME))  Q:NAME=""  D  Q:RC
"RTN","RORX007",213,0)
 . . S LAST4=""
"RTN","RORX007",214,0)
 . . F  S LAST4=$O(@NODE@(PRCNT,NAME,LAST4))  Q:LAST4=""  D  Q:RC
"RTN","RORX007",215,0)
 . . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"PATIENT",,TABLE)
"RTN","RORX007",216,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"NAME",NAME,ITEM,1)
"RTN","RORX007",217,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"LAST4",LAST4,ITEM,1)
"RTN","RORX007",218,0)
 . . . S BUF=@NODE@(PRCNT,NAME,LAST4)
"RTN","RORX007",219,0)
 . . . S AGETYPE=$$PARAM^RORTSK01("AGE_RANGE","TYPE") I AGETYPE'="ALL" D
"RTN","RORX007",220,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,AGETYPE,$P(BUF,U,6),ITEM,1)
"RTN","RORX007",221,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"DOD",$P(BUF,U,2),ITEM,1)
"RTN","RORX007",222,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"TOTAL",PRCNT,ITEM,1)
"RTN","RORX007",223,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"UNIQUE",+BUF,ITEM,1)
"RTN","RORX007",224,0)
 . . . I $$PARAM^RORTSK01("PATIENTS","ICN") D
"RTN","RORX007",225,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"ICN",$P(BUF,U,3),ITEM,1)
"RTN","RORX007",226,0)
 . . . I $$PARAM^RORTSK01("PATIENTS","PACT") D
"RTN","RORX007",227,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"PACT",$P(BUF,U,4),ITEM,1)
"RTN","RORX007",228,0)
 . . . I $$PARAM^RORTSK01("PATIENTS","PCP") D
"RTN","RORX007",229,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"PCP",$P(BUF,U,5),ITEM,1)
"RTN","RORX007",230,0)
 . . . S UTNUM=UTNUM+1  S:UTNUM'<MAXUTNUM RC=1
"RTN","RORX007",231,0)
 Q:RC<0 RC
"RTN","RORX007",232,0)
 ;---
"RTN","RORX007",233,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORX007",234,0)
 ;
"RTN","RORX007",235,0)
 ;***** STORES THE TABLE OF PROCEDURES
"RTN","RORX007",236,0)
 ;
"RTN","RORX007",237,0)
 ; PRNTELMT      IEN of the parent tag
"RTN","RORX007",238,0)
 ;
"RTN","RORX007",239,0)
 ; Return Values:
"RTN","RORX007",240,0)
 ;       <0  Error code
"RTN","RORX007",241,0)
 ;        0  Ok
"RTN","RORX007",242,0)
 ;
"RTN","RORX007",243,0)
TBLPROC(PRNTELMT) ;
"RTN","RORX007",244,0)
 N CPT,ITEM,MINRPNUM,NODE,PRCNT,PRN,TABLE,TMP
"RTN","RORX007",245,0)
 S MINRPNUM=$$PARAM^RORTSK01("MINRPNUM")
"RTN","RORX007",246,0)
 Q:MINRPNUM'>0 0
"RTN","RORX007",247,0)
 S TABLE=$$ADDVAL^RORTSK11(RORTSK,"PROCEDURES",,PRNTELMT)
"RTN","RORX007",248,0)
 Q:TABLE<0 TABLE
"RTN","RORX007",249,0)
 D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","PROCEDURES")
"RTN","RORX007",250,0)
 S NODE=$NA(^TMP("RORX007",$J,"PROCSORT"))
"RTN","RORX007",251,0)
 ;--- Table
"RTN","RORX007",252,0)
 S PRCNT="",RC=0
"RTN","RORX007",253,0)
 F  S PRCNT=$O(@NODE@(PRCNT),-1)  Q:PRCNT<MINRPNUM  D  Q:RC
"RTN","RORX007",254,0)
 . S PRN=""
"RTN","RORX007",255,0)
 . F  S PRN=$O(@NODE@(PRCNT,PRN))  Q:PRN=""  D  Q:RC
"RTN","RORX007",256,0)
 . . S CPT=""
"RTN","RORX007",257,0)
 . . F  S CPT=$O(@NODE@(PRCNT,PRN,CPT))  Q:CPT=""  D  Q:RC
"RTN","RORX007",258,0)
 . . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"PROCEDURE",,TABLE)
"RTN","RORX007",259,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"NAME",PRN,ITEM,1)
"RTN","RORX007",260,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"CPT",CPT,ITEM,2)
"RTN","RORX007",261,0)
 . . . S TMP=+@NODE@(PRCNT,PRN,CPT)
"RTN","RORX007",262,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"PATIENTS",TMP,ITEM,1)
"RTN","RORX007",263,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"TOTAL",PRCNT,ITEM,1)
"RTN","RORX007",264,0)
 Q:RC<0 RC
"RTN","RORX007",265,0)
 ;---
"RTN","RORX007",266,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORX007A")
0^17^B28732550^B25681411
"RTN","RORX007A",1,0)
RORX007A ;HOIFO/BH,SG,VAC - RADIOLOGY UTILIZATION (OVERFLOW) ;4/7/09 2:07pm
"RTN","RORX007A",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**1,8,13,19,21,31**;Feb 17, 2006;Build 62
"RTN","RORX007A",3,0)
 ;
"RTN","RORX007A",4,0)
 ; This routine uses the following IAs:
"RTN","RORX007A",5,0)
 ;
"RTN","RORX007A",6,0)
 ; #2043         EN1^RAO7PC1 (supported)
"RTN","RORX007A",7,0)
 ;
"RTN","RORX007A",8,0)
 ;******************************************************************************
"RTN","RORX007A",9,0)
 ;******************************************************************************
"RTN","RORX007A",10,0)
 ;                 --- ROUTINE MODIFICATION LOG ---
"RTN","RORX007A",11,0)
 ;        
"RTN","RORX007A",12,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORX007A",13,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","RORX007A",14,0)
 ;ROR*1.5*8    MAR  2010   V CARR       Modified to handle ICD9 filter for
"RTN","RORX007A",15,0)
 ;                                      'include' or 'exclude'.
"RTN","RORX007A",16,0)
 ;ROR*1.5*13   DEC  2010   A SAUNDERS   User can select specific patients,
"RTN","RORX007A",17,0)
 ;                                      clinics, or divisions for the report.
"RTN","RORX007A",18,0)
 ;ROR*1.5*19   FEB  2012   K GUPTA      Support for ICD-10 Coding System
"RTN","RORX007A",19,0)
 ;ROR*1.5*21   SEP 2013    T KOPP       Added ICN as last report column if
"RTN","RORX007A",20,0)
 ;                                      additional identifier option selected
"RTN","RORX007A",21,0)
 ;ROR*1.5*31   MAY 2017    M FERRARESE  Adding PACT, PCP, and AGE/DOB as additional
"RTN","RORX007A",22,0)
 ;                                      identifiers.
"RTN","RORX007A",23,0)
 ;                                   
"RTN","RORX007A",24,0)
 ;******************************************************************************
"RTN","RORX007A",25,0)
 ;******************************************************************************
"RTN","RORX007A",26,0)
 Q
"RTN","RORX007A",27,0)
 ;
"RTN","RORX007A",28,0)
 ;***** APPENDS MODIFIERS TO THE CPT CODE
"RTN","RORX007A",29,0)
 ;
"RTN","RORX007A",30,0)
 ; CPT           CPT code
"RTN","RORX007A",31,0)
 ;
"RTN","RORX007A",32,0)
 ; NODE          Closed root of the exam data node returned
"RTN","RORX007A",33,0)
 ;               by the EN1^RAO7PC1
"RTN","RORX007A",34,0)
 ;
"RTN","RORX007A",35,0)
CPTMOD(CPT,NODE) ;
"RTN","RORX007A",36,0)
 N CPM,RORIM
"RTN","RORX007A",37,0)
 S RORIM=""
"RTN","RORX007A",38,0)
 F  S RORIM=$O(@NODE@("CMOD",RORIM))  Q:RORIM=""  D
"RTN","RORX007A",39,0)
 . S CPM=$P($G(@NODE@("CMOD",RORIM)),U)
"RTN","RORX007A",40,0)
 . S:CPM'="" CPT=CPT_"-"_CPM
"RTN","RORX007A",41,0)
 Q CPT
"RTN","RORX007A",42,0)
 ;
"RTN","RORX007A",43,0)
 ;***** LOADS AND PROCESSES THE RADIOLOGY DATA
"RTN","RORX007A",44,0)
 ;
"RTN","RORX007A",45,0)
 ; DFN           Patient IEN (in file #2)
"RTN","RORX007A",46,0)
 ;
"RTN","RORX007A",47,0)
 ; Return Values:
"RTN","RORX007A",48,0)
 ;       <0  Error code
"RTN","RORX007A",49,0)
 ;        0  Ok
"RTN","RORX007A",50,0)
 ;
"RTN","RORX007A",51,0)
GETDATA(DFN) ;
"RTN","RORX007A",52,0)
 N CPT,EXAMID,NODE,PRNAME,RORBUF
"RTN","RORX007A",53,0)
 ;--- Get the data
"RTN","RORX007A",54,0)
 D EN1^RAO7PC1(DFN,RORSDT,ROREDT,999999)
"RTN","RORX007A",55,0)
 ;data returned from radiology/nuclear medicine API in ^TMP($J,"RAE1"
"RTN","RORX007A",56,0)
 Q:'$D(^TMP($J,"RAE1",DFN)) 0
"RTN","RORX007A",57,0)
 ;
"RTN","RORX007A",58,0)
 ;--- Process the data
"RTN","RORX007A",59,0)
 S EXAMID=""
"RTN","RORX007A",60,0)
 F  S EXAMID=$O(^TMP($J,"RAE1",DFN,EXAMID))  Q:EXAMID=""  D
"RTN","RORX007A",61,0)
 . S NODE=$NA(^TMP($J,"RAE1",DFN,EXAMID))
"RTN","RORX007A",62,0)
 . S RORBUF=$G(@NODE),CPT=$$CPTMOD($P(RORBUF,U,10),NODE)
"RTN","RORX007A",63,0)
 . ;--- Get Procedure Name
"RTN","RORX007A",64,0)
 . S PRNAME=$E($P(RORBUF,U),1,30)  Q:PRNAME=""
"RTN","RORX007A",65,0)
 . S PRNAME=PRNAME_U_$S(CPT'="":CPT,1:" ")
"RTN","RORX007A",66,0)
 . ;--- Increment the counters
"RTN","RORX007A",67,0)
 . S ^(DFN)=$G(^TMP("RORX007",$J,"PROC",PRNAME,DFN))+1 ;naked reference: ^TMP("RORX007",$J,"PROC",PRNAME,DFN)
"RTN","RORX007A",68,0)
 . S ^(PRNAME)=$G(^TMP("RORX007",$J,"PAT",DFN,PRNAME))+1 ;naked reference: ^TMP("RORX007",$J,"PROC",PRNAME,DFN,PRNAME)
"RTN","RORX007A",69,0)
 ;
"RTN","RORX007A",70,0)
 ;--- Cleanup
"RTN","RORX007A",71,0)
 K ^TMP($J,"RAE1")
"RTN","RORX007A",72,0)
 Q 0
"RTN","RORX007A",73,0)
 ;
"RTN","RORX007A",74,0)
 ;***** OUTPUTS THE REPORT HEADER
"RTN","RORX007A",75,0)
 ;
"RTN","RORX007A",76,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX007A",77,0)
 ;
"RTN","RORX007A",78,0)
 ; Return Values:
"RTN","RORX007A",79,0)
 ;       <0  Error code
"RTN","RORX007A",80,0)
 ;        0  Ok
"RTN","RORX007A",81,0)
 ;
"RTN","RORX007A",82,0)
HEADER(PARTAG) ;
"RTN","RORX007A",83,0)
 ;;PATIENTS(#,NAME,LAST4,DOD,TOTAL,UNIQUE,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="ALL"
"RTN","RORX007A",84,0)
 ;;PATIENTS(#,NAME,LAST4,AGE,DOD,TOTAL,UNIQUE,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="AGE"
"RTN","RORX007A",85,0)
 ;;PATIENTS(#,NAME,LAST4,DOB,DOD,TOTAL,UNIQUE,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="DOB"
"RTN","RORX007A",86,0)
 ;;PROCEDURES(#,NAME,CPT,PATIENTS,TOTAL)
"RTN","RORX007A",87,0)
 ;
"RTN","RORX007A",88,0)
 N HEADER,RC
"RTN","RORX007A",89,0)
 S HEADER=$$HEADER^RORXU002(.RORTSK,PARTAG)
"RTN","RORX007A",90,0)
 Q:HEADER<0 HEADER
"RTN","RORX007A",91,0)
 S RC=$$TBLDEF^RORXU002("HEADER^RORX007A",HEADER)
"RTN","RORX007A",92,0)
 Q $S(RC<0:RC,1:HEADER)
"RTN","RORX007A",93,0)
 ;
"RTN","RORX007A",94,0)
 ;***** OUTPUTS THE PARAMETERS TO THE REPORT
"RTN","RORX007A",95,0)
 ;
"RTN","RORX007A",96,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX007A",97,0)
 ;
"RTN","RORX007A",98,0)
 ; [.STDT]       Start and end dates of the report
"RTN","RORX007A",99,0)
 ; [.ENDT]       are returned via these parameters
"RTN","RORX007A",100,0)
 ;
"RTN","RORX007A",101,0)
 ; [.FLAGS]      Flags for the $$SKIP^RORXU005 are
"RTN","RORX007A",102,0)
 ;               returned via this parameter
"RTN","RORX007A",103,0)
 ;
"RTN","RORX007A",104,0)
 ; Return Values:
"RTN","RORX007A",105,0)
 ;       <0  Error code
"RTN","RORX007A",106,0)
 ;       >0  IEN of the PARAMETERS element
"RTN","RORX007A",107,0)
 ;
"RTN","RORX007A",108,0)
PARAMS(PARTAG,STDT,ENDT,FLAGS) ;
"RTN","RORX007A",109,0)
 N NAME,PARAMS,TMP
"RTN","RORX007A",110,0)
 S PARAMS=$$PARAMS^RORXU002(.RORTSK,PARTAG,.STDT,.ENDT,.FLAGS)
"RTN","RORX007A",111,0)
 Q:PARAMS<0 PARAMS
"RTN","RORX007A",112,0)
 ;--- Additional parameters
"RTN","RORX007A",113,0)
 F NAME="MAXUTNUM","MINRPNUM"  D
"RTN","RORX007A",114,0)
 . S TMP=$$PARAM^RORTSK01(NAME)
"RTN","RORX007A",115,0)
 . D:TMP'="" ADDVAL^RORTSK11(RORTSK,NAME,TMP,PARAMS)
"RTN","RORX007A",116,0)
 ;---
"RTN","RORX007A",117,0)
 Q PARAMS
"RTN","RORX007A",118,0)
 ;
"RTN","RORX007A",119,0)
 ;***** QUERIES THE REGISTRY
"RTN","RORX007A",120,0)
 ;
"RTN","RORX007A",121,0)
 ; FLAGS         Flags for the $$SKIP^RORXU005
"RTN","RORX007A",122,0)
 ;
"RTN","RORX007A",123,0)
 ; Return Values:
"RTN","RORX007A",124,0)
 ;       <0  Error code
"RTN","RORX007A",125,0)
 ;        0  Ok
"RTN","RORX007A",126,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX007A",127,0)
 ;
"RTN","RORX007A",128,0)
QUERY(FLAGS) ;
"RTN","RORX007A",129,0)
 N CNT,ECNT,IEN,IENS,PATIEN,RC,RORMSG,TMP,XREFNODE
"RTN","RORX007A",130,0)
 N RCC,FLAG
"RTN","RORX007A",131,0)
 N RORCDLIST     ; Flag to indicate whether a clinic or division list exists
"RTN","RORX007A",132,0)
 N RORCDSTDT     ; Start date for clinic/division utilization search
"RTN","RORX007A",133,0)
 N RORCDENDT     ; End date for clinic/division utilization search
"RTN","RORX007A",134,0)
 ;
"RTN","RORX007A",135,0)
 S XREFNODE=$NA(^RORDATA(798,"AC",+RORREG))
"RTN","RORX007A",136,0)
 S (CNT,ECNT,RC)=0
"RTN","RORX007A",137,0)
 ;=== Set up Clinic/Division list parameters
"RTN","RORX007A",138,0)
 S RORCDLIST=$$CDPARMS^RORXU001(.RORTSK,.RORCDSTDT,.RORCDENDT)
"RTN","RORX007A",139,0)
 ;
"RTN","RORX007A",140,0)
 ;--- Browse through the registry records
"RTN","RORX007A",141,0)
 S IEN=0
"RTN","RORX007A",142,0)
 S FLAG=$G(RORTSK("PARAMS","ICDFILT","A","FILTER"))
"RTN","RORX007A",143,0)
 F  S IEN=$O(@XREFNODE@(IEN)) Q:IEN'>0  D  Q:RC<0
"RTN","RORX007A",144,0)
 . S TMP=$S(RORPTN>0:CNT/RORPTN,1:"")
"RTN","RORX007A",145,0)
 . S RC=$$LOOP^RORTSK01(TMP)  Q:RC<0
"RTN","RORX007A",146,0)
 . S IENS=IEN_",",CNT=CNT+1
"RTN","RORX007A",147,0)
 . ;--- Get the patient DFN
"RTN","RORX007A",148,0)
 . S PATIEN=$$PTIEN^RORUTL01(IEN) Q:PATIEN'>0
"RTN","RORX007A",149,0)
 . ;--- Check for patient list and quit if not on list
"RTN","RORX007A",150,0)
 . I $D(RORTSK("PARAMS","PATIENTS","C")),'$D(RORTSK("PARAMS","PATIENTS","C",PATIEN)) Q
"RTN","RORX007A",151,0)
 . ;--- Check if the patient should be skipped
"RTN","RORX007A",152,0)
 . Q:$$SKIP^RORXU005(IEN,FLAGS,RORSDT,ROREDT)
"RTN","RORX007A",153,0)
 . ;--- Check the patient against the ICD Filter
"RTN","RORX007A",154,0)
 . S RCC=0
"RTN","RORX007A",155,0)
 . I FLAG'="ALL" D
"RTN","RORX007A",156,0)
 . . S RCC=$$ICD^RORXU010(PATIEN)
"RTN","RORX007A",157,0)
 . I (FLAG="INCLUDE")&(RCC=0) Q
"RTN","RORX007A",158,0)
 . I (FLAG="EXCLUDE")&(RCC=1) Q
"RTN","RORX007A",159,0)
 . ;--- End of ICD check
"RTN","RORX007A",160,0)
 . ;--- Check for Clinic or Division list and quit if not in list
"RTN","RORX007A",161,0)
 . I RORCDLIST,'$$CDUTIL^RORXU001(.RORTSK,PATIEN,RORCDSTDT,RORCDENDT) Q
"RTN","RORX007A",162,0)
 . ;--- Get the radiology data
"RTN","RORX007A",163,0)
 . S RC=$$GETDATA(PATIEN)
"RTN","RORX007A",164,0)
 . I RC  S ECNT=ECNT+1  Q:RC<0
"RTN","RORX007A",165,0)
 ;---
"RTN","RORX007A",166,0)
 Q $S(RC<0:RC,1:ECNT)
"RTN","RORX007A",167,0)
 ;
"RTN","RORX007A",168,0)
 ;***** PLURAL/SINGULAR
"RTN","RORX007A",169,0)
SRPL(QNTY,WORD,SQ) ;
"RTN","RORX007A",170,0)
 Q $S('$G(SQ):QNTY_" ",1:"")_$P(WORD,U,$S(QNTY=1:1,1:2))
"RTN","RORX008")
0^18^B14193423^B9636299
"RTN","RORX008",1,0)
RORX008 ;HOIFO/BH,SG - VERA REIMBURSEMENT REPORT ;11/8/05 8:38am
"RTN","RORX008",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**21,31**;Feb 17, 2006;Build 62
"RTN","RORX008",3,0)
 ;
"RTN","RORX008",4,0)
 ;--------------------------------------------------------------------
"RTN","RORX008",5,0)
 ; Registry: [VA ICR]
"RTN","RORX008",6,0)
 ;--------------------------------------------------------------------
"RTN","RORX008",7,0)
 ;******************************************************************************
"RTN","RORX008",8,0)
 ;                       --- ROUTINE MODIFICATION LOG ---
"RTN","RORX008",9,0)
 ;        
"RTN","RORX008",10,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORX008",11,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","RORX008",12,0)
 ;ROR*1.5*21   SEP 2013    T KOPP       Added ICN as last report column if
"RTN","RORX008",13,0)
 ;                                      additional identifier option selected
"RTN","RORX008",14,0)
 ;ROR*1.5*31   MAY 2017    M FERRARESE  Adding PACT, PCP, and AGE/DOB as additional
"RTN","RORX008",15,0)
 ;                                      identifiers.
"RTN","RORX008",16,0)
 ;******************************************************************************
"RTN","RORX008",17,0)
 Q
"RTN","RORX008",18,0)
 ;
"RTN","RORX008",19,0)
 ;***** COMPILES THE "VERA REIMBURSEMENT" REPORT
"RTN","RORX008",20,0)
 ; REPORT CODE: 008
"RTN","RORX008",21,0)
 ;
"RTN","RORX008",22,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORX008",23,0)
 ;
"RTN","RORX008",24,0)
 ; The ^TMP("RORX008",$J) global node is used by this function.
"RTN","RORX008",25,0)
 ;
"RTN","RORX008",26,0)
 ; ^TMP("RORX008",$J,
"RTN","RORX008",27,0)
 ;
"RTN","RORX008",28,0)
 ;   "DRG",
"RTN","RORX008",29,0)
 ;     GenDrugIEN,       Generic drug name
"RTN","RORX008",30,0)
 ;       0)              Number of HIV+ patients
"RTN","RORX008",31,0)
 ;       1)              Number of Clinical AIDS patients
"RTN","RORX008",32,0)
 ;
"RTN","RORX008",33,0)
 ;   "PAT",              Totals
"RTN","RORX008",34,0)
 ;                         ^01: Number of basic care patients
"RTN","RORX008",35,0)
 ;                         ^02: Number of complex care patients
"RTN","RORX008",36,0)
 ;                         ^03: Number of patients received ARVs
"RTN","RORX008",37,0)
 ;     DFN)              Patient Descriptor
"RTN","RORX008",38,0)
 ;                         ^01: Last 4 digits of SSN
"RTN","RORX008",39,0)
 ;                         ^02: Name
"RTN","RORX008",40,0)
 ;                         ^03: Date of Death (FileMan)
"RTN","RORX008",41,0)
 ;                         ^04: Received ARV drugs(0/1)
"RTN","RORX008",42,0)
 ;                         ^05: Complex care (0/1)
"RTN","RORX008",43,0)
 ;                         ^06: National ICN
"RTN","RORX008",44,0)
 ;                         ^07: PACT Patient care team
"RTN","RORX008",45,0)
 ;                         ^08: PCP Primary care physician
"RTN","RORX008",46,0)
 ;                         ^09: Age/DOB
"RTN","RORX008",47,0)
 ;
"RTN","RORX008",48,0)
 ; Return Values:
"RTN","RORX008",49,0)
 ;       <0  Error code
"RTN","RORX008",50,0)
 ;        0  Ok
"RTN","RORX008",51,0)
 ;
"RTN","RORX008",52,0)
ARVREIMB(RORTSK) ;
"RTN","RORX008",53,0)
 N ROREDT        ; End date
"RTN","RORX008",54,0)
 N ROREDT1       ; End date + 1
"RTN","RORX008",55,0)
 N RORREG        ; Registry IEN
"RTN","RORX008",56,0)
 N RORSDT        ; Start date
"RTN","RORX008",57,0)
 N RORXL         ; Drug list for the pharmacy search API
"RTN","RORX008",58,0)
 ;
"RTN","RORX008",59,0)
 N ECNT,RC,REPORT,SFLAGS,TMP
"RTN","RORX008",60,0)
 K ^TMP("RORX008",$J)
"RTN","RORX008",61,0)
 S RORXL="",(ECNT,RC)=0
"RTN","RORX008",62,0)
 ;--- Root node of the report
"RTN","RORX008",63,0)
 S REPORT=$$ADDVAL^RORTSK11(RORTSK,"REPORT")
"RTN","RORX008",64,0)
 Q:REPORT<0 REPORT
"RTN","RORX008",65,0)
 ;
"RTN","RORX008",66,0)
 D
"RTN","RORX008",67,0)
 . ;--- Get and prepare the report parameters
"RTN","RORX008",68,0)
 . S RORREG=$$PARAM^RORTSK01("REGIEN")
"RTN","RORX008",69,0)
 . S RC=$$PARAMS(REPORT,.RORSDT,.ROREDT,.SFLAGS)  Q:RC<0
"RTN","RORX008",70,0)
 . S ROREDT1=$$FMADD^XLFDT(ROREDT\1,1)
"RTN","RORX008",71,0)
 . ;--- Report header
"RTN","RORX008",72,0)
 . S RC=$$HEADER(REPORT)  Q:RC<0
"RTN","RORX008",73,0)
 . ;--- Query the registry
"RTN","RORX008",74,0)
 . D TPPSETUP^RORTSK01(75)
"RTN","RORX008",75,0)
 . S RC=$$QUERY^RORX008A(SFLAGS)
"RTN","RORX008",76,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX008",77,0)
 . ;--- Store the results
"RTN","RORX008",78,0)
 . D TPPSETUP^RORTSK01(25)
"RTN","RORX008",79,0)
 . S RC=$$STORE^RORX008A(REPORT)
"RTN","RORX008",80,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX008",81,0)
 ;
"RTN","RORX008",82,0)
 ;--- Cleanup
"RTN","RORX008",83,0)
 K ^TMP("RORX008",$J)
"RTN","RORX008",84,0)
 D FREE^RORTMP(RORXL)
"RTN","RORX008",85,0)
 Q $S(RC<0:RC,ECNT>0:-43,1:0)
"RTN","RORX008",86,0)
 ;
"RTN","RORX008",87,0)
 ;***** OUTPUTS THE REPORT HEADER
"RTN","RORX008",88,0)
 ;
"RTN","RORX008",89,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX008",90,0)
 ;
"RTN","RORX008",91,0)
 ; Return Values:
"RTN","RORX008",92,0)
 ;       <0  Error code
"RTN","RORX008",93,0)
 ;       >0  IEN of the HEADER element
"RTN","RORX008",94,0)
 ;
"RTN","RORX008",95,0)
HEADER(PARTAG) ;
"RTN","RORX008",96,0)
 ;;DRUGS(#,NAME,NP,NPHIV,NPAIDS)^I $$PARAM^RORTSK01("OPTIONS","REGMEDSMRY")
"RTN","RORX008",97,0)
 ;;PATIENTS(#,NAME,LAST4,DOD,AIDSTAT,ARV,COMPLEX,ICN,PACT,PCP)^I $$PARAM^RORTSK01("OPTIONS","PTLIST"),$$PARAM^RORTSK01("AGE_RANGE","TYPE")="ALL"
"RTN","RORX008",98,0)
 ;;PATIENTS(#,NAME,LAST4,AGE,DOD,AIDSTAT,ARV,COMPLEX,ICN,PACT,PCP)^I $$PARAM^RORTSK01("OPTIONS","PTLIST"),$$PARAM^RORTSK01("AGE_RANGE","TYPE")="AGE"
"RTN","RORX008",99,0)
 ;;PATIENTS(#,NAME,LAST4,DOB,DOD,AIDSTAT,ARV,COMPLEX,ICN,PACT,PCP)^I $$PARAM^RORTSK01("OPTIONS","PTLIST"),$$PARAM^RORTSK01("AGE_RANGE","TYPE")="DOB"
"RTN","RORX008",100,0)
 ;
"RTN","RORX008",101,0)
 N HEADER,RC
"RTN","RORX008",102,0)
 S HEADER=$$HEADER^RORXU002(.RORTSK,PARTAG)
"RTN","RORX008",103,0)
 Q:HEADER<0 HEADER
"RTN","RORX008",104,0)
 S RC=$$TBLDEF^RORXU002("HEADER^RORX008",HEADER)
"RTN","RORX008",105,0)
 Q $S(RC<0:RC,1:HEADER)
"RTN","RORX008",106,0)
 ;
"RTN","RORX008",107,0)
 ;***** OUTPUTS THE PARAMETERS TO THE REPORT
"RTN","RORX008",108,0)
 ;
"RTN","RORX008",109,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX008",110,0)
 ;
"RTN","RORX008",111,0)
 ; [.STDT]       Start and end dates of the report
"RTN","RORX008",112,0)
 ; [.ENDT]       are returned via these parameters
"RTN","RORX008",113,0)
 ;
"RTN","RORX008",114,0)
 ; [.FLAGS]      Flags for the $$SKIP^RORXU005 are
"RTN","RORX008",115,0)
 ;               returned via this parameter
"RTN","RORX008",116,0)
 ;
"RTN","RORX008",117,0)
 ; Return Values:
"RTN","RORX008",118,0)
 ;       <0  Error code
"RTN","RORX008",119,0)
 ;       >0  IEN of the PARAMETERS element
"RTN","RORX008",120,0)
 ;
"RTN","RORX008",121,0)
PARAMS(PARTAG,STDT,ENDT,FLAGS) ;
"RTN","RORX008",122,0)
 N PARAMS,TMP
"RTN","RORX008",123,0)
 S PARAMS=$$PARAMS^RORXU002(.RORTSK,PARTAG,.STDT,.ENDT,.FLAGS)
"RTN","RORX008",124,0)
 Q:PARAMS<0 PARAMS
"RTN","RORX008",125,0)
 ;--- Process the drug list and options
"RTN","RORX008",126,0)
 S RORTSK("PARAMS","DRUGS","A","REGMEDS")=1
"RTN","RORX008",127,0)
 S TMP=$$DRUGLST^RORXU007(.RORTSK,PARAMS,.RORXL)
"RTN","RORX008",128,0)
 Q:TMP<0 TMP
"RTN","RORX008",129,0)
 ;---
"RTN","RORX008",130,0)
 Q PARAMS
"RTN","RORX008A")
0^19^B54936763^B44591375
"RTN","RORX008A",1,0)
RORX008A ;HOIFO/BH,SG,VAC - VERA REIMBURSEMENT REPORT ;4/7/09 2:08pm
"RTN","RORX008A",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**8,13,19,21,31**;Feb 17, 2006;Build 62
"RTN","RORX008A",3,0)
 ;
"RTN","RORX008A",4,0)
 ;******************************************************************************
"RTN","RORX008A",5,0)
 ;******************************************************************************
"RTN","RORX008A",6,0)
 ;                 --- ROUTINE MODIFICATION LOG ---
"RTN","RORX008A",7,0)
 ;        
"RTN","RORX008A",8,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORX008A",9,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","RORX008A",10,0)
 ;ROR*1.5*8    MAR  2010   V CARR       Modified to handle ICD9 filter for
"RTN","RORX008A",11,0)
 ;                                      'include' or 'exclude'.
"RTN","RORX008A",12,0)
 ;ROR*1.5*13   DEC  2010   A SAUNDERS   User can select specific patients,
"RTN","RORX008A",13,0)
 ;                                      clinics, or divisions for the report.
"RTN","RORX008A",14,0)
 ;ROR*1.5*19   FEB  2012   K GUPTA      Support for ICD-10 Coding System
"RTN","RORX008A",15,0)
 ;ROR*1.5*21   SEP 2013    T KOPP       Added ICN as last report column if
"RTN","RORX008A",16,0)
 ;                                      additional identifier option selected
"RTN","RORX008A",17,0)
 ;ROR*1.5*31   MAY 2017    M FERRARESE  Adding PACT, PCP, and AGE/DOB as additional
"RTN","RORX008A",18,0)
 ;                                      identifiers.
"RTN","RORX008A",19,0)
 ;                                     
"RTN","RORX008A",20,0)
 ;******************************************************************************
"RTN","RORX008A",21,0)
 ;******************************************************************************
"RTN","RORX008A",22,0)
 Q
"RTN","RORX008A",23,0)
 ;
"RTN","RORX008A",24,0)
 ;***** QUERIES THE REGISTRY
"RTN","RORX008A",25,0)
 ;
"RTN","RORX008A",26,0)
 ; FLAGS         Flags for the $$SKIP^RORXU005
"RTN","RORX008A",27,0)
 ;
"RTN","RORX008A",28,0)
 ; Return Values:
"RTN","RORX008A",29,0)
 ;       <0  Error code
"RTN","RORX008A",30,0)
 ;        0  Ok
"RTN","RORX008A",31,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX008A",32,0)
 ;
"RTN","RORX008A",33,0)
QUERY(FLAGS) ;
"RTN","RORX008A",34,0)
 N RORPTN        ; Number of patients in the registry
"RTN","RORX008A",35,0)
 N RORCDLIST     ; Flag to indicate whether a clinic or division list exists
"RTN","RORX008A",36,0)
 N RORCDSTDT     ; Start date for clinic/division utilization search
"RTN","RORX008A",37,0)
 N RORCDENDT     ; End date for clinic/division utilization search
"RTN","RORX008A",38,0)
 ;
"RTN","RORX008A",39,0)
 N CLINAIDS,CMPXCARE,CNT,CNTARV,CNTBASIC,CNTCMPX,ECNT,FLAG,IEN,NAME,PATIEN,RC,RCC,RORIEN,RORXDST,TMP,UTLCHK,VA,VADM,VAERR,XREFNODE
"RTN","RORX008A",40,0)
 N AGE,AGETYPE
"RTN","RORX008A",41,0)
 ;
"RTN","RORX008A",42,0)
 S XREFNODE=$NA(^RORDATA(798,"AC",+RORREG))
"RTN","RORX008A",43,0)
 S RORPTN=$$REGSIZE^RORUTL02(+RORREG)  S:RORPTN<0 RORPTN=0
"RTN","RORX008A",44,0)
 S (CNT,CNTARV,CNTBASIC,CNTCMPX,ECNT,RC)=0
"RTN","RORX008A",45,0)
 S UTLCHK("ALL")=""
"RTN","RORX008A",46,0)
 ;
"RTN","RORX008A",47,0)
 ;--- Prepare parameters for the pharmacy search API
"RTN","RORX008A",48,0)
 S RORXDST("RORCB")="$$RXSCB^RORX008A"
"RTN","RORX008A",49,0)
 S TMP=$$PARAM^RORTSK01("OPTIONS","REGMEDSMRY")
"RTN","RORX008A",50,0)
 S RORXDST("SINGLE")='TMP!'$$PARAM^RORTSK01("PATIENTS","COMPLEX")
"RTN","RORX008A",51,0)
 ;
"RTN","RORX008A",52,0)
 ;=== Set up Clinic/Division list parameters
"RTN","RORX008A",53,0)
 S RORCDLIST=$$CDPARMS^RORXU001(.RORTSK,.RORCDSTDT,.RORCDENDT)
"RTN","RORX008A",54,0)
 ;
"RTN","RORX008A",55,0)
 ;--- Browse through the registry records
"RTN","RORX008A",56,0)
 S RORIEN=0
"RTN","RORX008A",57,0)
 S FLAG=$G(RORTSK("PARAMS","ICDFILT","A","FILTER"))
"RTN","RORX008A",58,0)
 F  S RORIEN=$O(@XREFNODE@(RORIEN))  Q:RORIEN'>0  D  Q:RC<0
"RTN","RORX008A",59,0)
 . ;--- Start progress counter
"RTN","RORX008A",60,0)
 . S TMP=$S(RORPTN>0:CNT/RORPTN,1:"")
"RTN","RORX008A",61,0)
 . S RC=$$LOOP^RORTSK01(TMP)  Q:RC<0
"RTN","RORX008A",62,0)
 . S CNT=CNT+1
"RTN","RORX008A",63,0)
 . ;--- Get patient DFN
"RTN","RORX008A",64,0)
 . S PATIEN=$$PTIEN^RORUTL01(RORIEN) Q:PATIEN'>0
"RTN","RORX008A",65,0)
 . ;check for patient list and quit if not on list
"RTN","RORX008A",66,0)
 . I $D(RORTSK("PARAMS","PATIENTS","C")),'$D(RORTSK("PARAMS","PATIENTS","C",PATIEN)) Q
"RTN","RORX008A",67,0)
 . ;--- Check if the patient should be skipped
"RTN","RORX008A",68,0)
 . Q:$$SKIP^RORXU005(RORIEN,FLAGS,RORSDT,ROREDT)
"RTN","RORX008A",69,0)
 . ;--- Check patient against ICD list
"RTN","RORX008A",70,0)
 . S RCC=0
"RTN","RORX008A",71,0)
 . I FLAG'="ALL" D
"RTN","RORX008A",72,0)
 . . S RCC=$$ICD^RORXU010(PATIEN)
"RTN","RORX008A",73,0)
 . I (FLAG="INCLUDE")&(RCC=0) Q
"RTN","RORX008A",74,0)
 . I (FLAG="EXCLUDE")&(RCC=1) Q
"RTN","RORX008A",75,0)
 . ; End of check of ICD list
"RTN","RORX008A",76,0)
 . ;
"RTN","RORX008A",77,0)
 . ;--- Check for Clinic or Division list and quit if not in list
"RTN","RORX008A",78,0)
 . I RORCDLIST,'$$CDUTIL^RORXU001(.RORTSK,PATIEN,RORCDSTDT,RORCDENDT) Q
"RTN","RORX008A",79,0)
 . ;
"RTN","RORX008A",80,0)
 . ;--- Skip Clinical AIDS if Complex Care was not requested
"RTN","RORX008A",81,0)
 . S CMPXCARE=0
"RTN","RORX008A",82,0)
 . S CLINAIDS=$S($$CLINAIDS^RORHIVUT(RORIEN,ROREDT):1,1:0)
"RTN","RORX008A",83,0)
 . I CLINAIDS  Q:'$$PARAM^RORTSK01("PATIENTS","COMPLEX")  S CMPXCARE=1
"RTN","RORX008A",84,0)
 . ;
"RTN","RORX008A",85,0)
 . ;--- Skip a patient without utlilization
"RTN","RORX008A",86,0)
 . Q:'$$UTIL^RORXU003(RORSDT,ROREDT,PATIEN,.UTLCHK)
"RTN","RORX008A",87,0)
 . ;
"RTN","RORX008A",88,0)
 . ;--- Search for pharmacy data
"RTN","RORX008A",89,0)
 . K RORXDST("ARV")
"RTN","RORX008A",90,0)
 . S TMP=$$RXSEARCH^RORUTL14(PATIEN,RORXL,.RORXDST,"EIOV",RORSDT,ROREDT1)
"RTN","RORX008A",91,0)
 . I TMP<0  S ECNT=ECNT+1  Q
"RTN","RORX008A",92,0)
 . I $D(RORXDST("ARV"))  Q:'$$PARAM^RORTSK01("PATIENTS","COMPLEX")  D
"RTN","RORX008A",93,0)
 . . S IEN=0
"RTN","RORX008A",94,0)
 . . F  S IEN=$O(RORXDST("ARV",IEN))  Q:IEN'>0  D
"RTN","RORX008A",95,0)
 . . . D:'$D(^TMP("RORX008",$J,"DRG",IEN))
"RTN","RORX008A",96,0)
 . . . . S ^TMP("RORX008",$J,"DRG",IEN)=RORXDST("ARV",IEN)
"RTN","RORX008A",97,0)
 . . . S ^(CLINAIDS)=$G(^TMP("RORX008",$J,"DRG",IEN,CLINAIDS))+1 ;naked reference: ^TMP("RORX008",$J,"DRG",IEN,CLINAIDS)
"RTN","RORX008A",98,0)
 . . S CMPXCARE=1,CNTARV=CNTARV+1
"RTN","RORX008A",99,0)
 . ;
"RTN","RORX008A",100,0)
 . ;--- Skip Basic Care if it was not requested
"RTN","RORX008A",101,0)
 . I CMPXCARE  S CNTCMPX=CNTCMPX+1
"RTN","RORX008A",102,0)
 . E  Q:'$$PARAM^RORTSK01("PATIENTS","BASIC")  S CNTBASIC=CNTBASIC+1
"RTN","RORX008A",103,0)
 . ;
"RTN","RORX008A",104,0)
 . D:$$PARAM^RORTSK01("OPTIONS","PTLIST")
"RTN","RORX008A",105,0)
 . . D VADEM^RORUTL05(PATIEN,1)
"RTN","RORX008A",106,0)
 . . S TMP=$$DATE^RORXU002(VADM(6)\1)
"RTN","RORX008A",107,0)
 . . S TMP=TMP_U_($D(RORXDST("ARV"))>0)_U_CMPXCARE_U_CLINAIDS
"RTN","RORX008A",108,0)
 . . S ^TMP("RORX008",$J,"PAT",PATIEN)=VA("BID")_U_VADM(1)_U_TMP
"RTN","RORX008A",109,0)
 . . S $P(^TMP("RORX008",$J,"PAT",PATIEN),U,6)=$S($$PARAM^RORTSK01("PATIENTS","ICN"):$$ICN^RORUTL02(PATIEN),1:"")
"RTN","RORX008A",110,0)
 . . S $P(^TMP("RORX008",$J,"PAT",PATIEN),U,7)=$S($$PARAM^RORTSK01("PATIENTS","PACT"):$$PACT^RORUTL02(PATIEN),1:"")
"RTN","RORX008A",111,0)
 . . S $P(^TMP("RORX008",$J,"PAT",PATIEN),U,8)=$S($$PARAM^RORTSK01("PATIENTS","PCP"):$$PCP^RORUTL02(PATIEN),1:"")
"RTN","RORX008A",112,0)
 . . S AGETYPE=$$PARAM^RORTSK01("AGE_RANGE","TYPE") D
"RTN","RORX008A",113,0)
 . . . S AGE=$S(AGETYPE="AGE":$P(VADM(4),U),AGETYPE="DOB":$$DATE^RORXU002($P(VADM(3),U)\1),1:"")
"RTN","RORX008A",114,0)
 . . S $P(^TMP("RORX008",$J,"PAT",PATIEN),U,9)=AGE
"RTN","RORX008A",115,0)
 ;
"RTN","RORX008A",116,0)
 ;--- Totals
"RTN","RORX008A",117,0)
 S ^TMP("RORX008",$J,"PAT")=CNTBASIC_U_CNTCMPX_U_CNTARV
"RTN","RORX008A",118,0)
 ;---
"RTN","RORX008A",119,0)
 Q $S(RC<0:RC,1:ECNT)
"RTN","RORX008A",120,0)
 ;
"RTN","RORX008A",121,0)
 ;***** CALLBACK FUNCTION FOR THE PHARMACY SEARCH API
"RTN","RORX008A",122,0)
RXSCB(ROR8DST,ORDER,ORDFLG,DRUG,DATE) ;
"RTN","RORX008A",123,0)
 N CA,IEN,NAME
"RTN","RORX008A",124,0)
 S IEN=+ROR8DST("RORXGEN"),NAME=$P(ROR8DST("RORXGEN"),U,2)
"RTN","RORX008A",125,0)
 Q:(IEN'>0)!(NAME="") 1
"RTN","RORX008A",126,0)
 ;---
"RTN","RORX008A",127,0)
 S ROR8DST("ARV")=""  Q:ROR8DST("SINGLE") 2
"RTN","RORX008A",128,0)
 ;---
"RTN","RORX008A",129,0)
 S ROR8DST("ARV",IEN)=NAME
"RTN","RORX008A",130,0)
 Q 0
"RTN","RORX008A",131,0)
 ;
"RTN","RORX008A",132,0)
 ;***** STORES THE REPORT DATA
"RTN","RORX008A",133,0)
 ;
"RTN","RORX008A",134,0)
 ; REPORT        IEN of the REPORT element
"RTN","RORX008A",135,0)
 ;
"RTN","RORX008A",136,0)
 ; Return Values:
"RTN","RORX008A",137,0)
 ;       <0  Error code
"RTN","RORX008A",138,0)
 ;        0  Ok
"RTN","RORX008A",139,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX008A",140,0)
 ;
"RTN","RORX008A",141,0)
STORE(REPORT) ;
"RTN","RORX008A",142,0)
 N BUF,CNT,ITEM,IEN,NODE,NPAIDS,NPHIV,RC,TABLE,TMP
"RTN","RORX008A",143,0)
 S NODE=$NA(^TMP("RORX008",$J)),RC=0
"RTN","RORX008A",144,0)
 ;
"RTN","RORX008A",145,0)
 ;--- List of ARV drugs
"RTN","RORX008A",146,0)
 S TMP=$$PARAM^RORTSK01("OPTIONS","REGMEDSMRY")
"RTN","RORX008A",147,0)
 I TMP,$$PARAM^RORTSK01("PATIENTS","COMPLEX")  D  Q:RC<0 RC
"RTN","RORX008A",148,0)
 . S TABLE=$$ADDVAL^RORTSK11(RORTSK,"DRUGS",,REPORT)
"RTN","RORX008A",149,0)
 . I TABLE<0  S RC=TABLE  Q
"RTN","RORX008A",150,0)
 . D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","DRUGS")
"RTN","RORX008A",151,0)
 . S IEN=0
"RTN","RORX008A",152,0)
 . F  S IEN=$O(@NODE@("DRG",IEN))  Q:IEN'>0  D
"RTN","RORX008A",153,0)
 . . S BUF=@NODE@("DRG",IEN)
"RTN","RORX008A",154,0)
 . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"DRUG",,TABLE)
"RTN","RORX008A",155,0)
 . . D ADDVAL^RORTSK11(RORTSK,"NAME",$P(@NODE@("DRG",IEN),U),ITEM,1)
"RTN","RORX008A",156,0)
 . . S NPHIV=+$G(@NODE@("DRG",IEN,0))
"RTN","RORX008A",157,0)
 . . S NPAIDS=+$G(@NODE@("DRG",IEN,1))
"RTN","RORX008A",158,0)
 . . D ADDVAL^RORTSK11(RORTSK,"NP",NPHIV+NPAIDS,ITEM,3)
"RTN","RORX008A",159,0)
 . . D ADDVAL^RORTSK11(RORTSK,"NPHIV",NPHIV,ITEM,3)
"RTN","RORX008A",160,0)
 . . D ADDVAL^RORTSK11(RORTSK,"NPAIDS",NPAIDS,ITEM,3)
"RTN","RORX008A",161,0)
 ;
"RTN","RORX008A",162,0)
 ;--- List of patients
"RTN","RORX008A",163,0)
 I $$PARAM^RORTSK01("OPTIONS","PTLIST")  D  Q:RC<0 RC
"RTN","RORX008A",164,0)
 . S TABLE=$$ADDVAL^RORTSK11(RORTSK,"PATIENTS",,REPORT)
"RTN","RORX008A",165,0)
 . I TABLE<0  S RC=TABLE  Q
"RTN","RORX008A",166,0)
 . D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","PATIENTS")
"RTN","RORX008A",167,0)
 . S IEN=0
"RTN","RORX008A",168,0)
 . F  S IEN=$O(@NODE@("PAT",IEN))  Q:IEN'>0  D
"RTN","RORX008A",169,0)
 . . S BUF=@NODE@("PAT",IEN)
"RTN","RORX008A",170,0)
 . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"PATIENT",,TABLE,,IEN)
"RTN","RORX008A",171,0)
 . . D ADDVAL^RORTSK11(RORTSK,"NAME",$P(BUF,U,2),ITEM,1)
"RTN","RORX008A",172,0)
 . . D ADDVAL^RORTSK11(RORTSK,"LAST4",$P(BUF,U),ITEM,2)
"RTN","RORX008A",173,0)
 . . S AGETYPE=$$PARAM^RORTSK01("AGE_RANGE","TYPE") I AGETYPE'="ALL" D
"RTN","RORX008A",174,0)
 . . . D ADDVAL^RORTSK11(RORTSK,AGETYPE,$P(BUF,U,9),ITEM,1)
"RTN","RORX008A",175,0)
 . . D ADDVAL^RORTSK11(RORTSK,"DOD",$P(BUF,U,3),ITEM,1)
"RTN","RORX008A",176,0)
 . . D ADDVAL^RORTSK11(RORTSK,"AIDSTAT",+$P(BUF,U,6),ITEM,1)
"RTN","RORX008A",177,0)
 . . D ADDVAL^RORTSK11(RORTSK,"ARV",+$P(BUF,U,4),ITEM,1)
"RTN","RORX008A",178,0)
 . . D ADDVAL^RORTSK11(RORTSK,"COMPLEX",+$P(BUF,U,5),ITEM,1)
"RTN","RORX008A",179,0)
 . . I $$PARAM^RORTSK01("PATIENTS","ICN") D ADDVAL^RORTSK11(RORTSK,"ICN",$P(BUF,U,6),ITEM,1)
"RTN","RORX008A",180,0)
 . . I $$PARAM^RORTSK01("PATIENTS","PACT") D ADDVAL^RORTSK11(RORTSK,"PACT",$P(BUF,U,7),ITEM,1)
"RTN","RORX008A",181,0)
 . . I $$PARAM^RORTSK01("PATIENTS","PCP") D ADDVAL^RORTSK11(RORTSK,"PCP",$P(BUF,U,8),ITEM,1)
"RTN","RORX008A",182,0)
 ;
"RTN","RORX008A",183,0)
 ;--- Summary
"RTN","RORX008A",184,0)
 S BUF=@NODE@("PAT")
"RTN","RORX008A",185,0)
 S ITEM=$$ADDVAL^RORTSK11(RORTSK,"SUMMARY",,REPORT)
"RTN","RORX008A",186,0)
 D ADDVAL^RORTSK11(RORTSK,"NP",$P(BUF,U)+$P(BUF,U,2),ITEM)
"RTN","RORX008A",187,0)
 D ADDVAL^RORTSK11(RORTSK,"NPBASIC",+$P(BUF,U,1),ITEM)
"RTN","RORX008A",188,0)
 D ADDVAL^RORTSK11(RORTSK,"NPCOMPLEX",+$P(BUF,U,2),ITEM)
"RTN","RORX008A",189,0)
 D ADDVAL^RORTSK11(RORTSK,"NPARV",+$P(BUF,U,3),ITEM)
"RTN","RORX008A",190,0)
 Q 0
"RTN","RORX009")
0^20^B25826904^B15825292
"RTN","RORX009",1,0)
RORX009 ;HCIOFO/SG - PHARMACY PRESCRIPTION UTILIZATION ;11/16/05 10:49am
"RTN","RORX009",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**21,31**;Feb 17, 2006;Build 62
"RTN","RORX009",3,0)
 ;
"RTN","RORX009",4,0)
 ;******************************************************************************
"RTN","RORX009",5,0)
 ;                       --- ROUTINE MODIFICATION LOG ---
"RTN","RORX009",6,0)
 ;        
"RTN","RORX009",7,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORX009",8,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","RORX009",9,0)
 ;ROR*1.5*21   SEP 2013    T KOPP       Added ICN as last report column if
"RTN","RORX009",10,0)
 ;                                      additional identifier option selected
"RTN","RORX009",11,0)
 ;ROR*1.5*31   MAY 2017    M FERRARESE  Adding PACT, PCP, and AGE/DOB as additional
"RTN","RORX009",12,0)
 ;                                      identifiers.
"RTN","RORX009",13,0)
 ;******************************************************************************
"RTN","RORX009",14,0)
 ;
"RTN","RORX009",15,0)
 Q
"RTN","RORX009",16,0)
 ;
"RTN","RORX009",17,0)
 ;***** OUTPUTS THE REPORT HEADER
"RTN","RORX009",18,0)
 ;
"RTN","RORX009",19,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX009",20,0)
 ;
"RTN","RORX009",21,0)
 ; Return Values:
"RTN","RORX009",22,0)
 ;       <0  Error code
"RTN","RORX009",23,0)
 ;       >0  IEN of the HEADER element
"RTN","RORX009",24,0)
 ;
"RTN","RORX009",25,0)
HEADER(PARTAG) ;
"RTN","RORX009",26,0)
 ;;DOSES(NP,IPNRX)^I $$PARAM^RORTSK01("PATIENTS","INPATIENT")
"RTN","RORX009",27,0)
 ;;DRUGS_DOSES(#,NAME,NP,IPNRX,MAXNRPP,MAXNP)
"RTN","RORX009",28,0)
 ;;DRUGS_FILLS(#,NAME,NP,OPNRX,MAXNRPP,MAXNP)
"RTN","RORX009",29,0)
 ;;FILLS(NP,OPNRX)^I $$PARAM^RORTSK01("PATIENTS","OUTPATIENT")
"RTN","RORX009",30,0)
 ;;HU_DOSES(#,NAME,LAST4,DOD,IPNRX,ND,ICN,PACT,PCP)^I $$PARAM^RORTSK01("PATIENTS","INPATIENT"),$$PARAM^RORTSK01("AGE_RANGE","TYPE")="ALL"
"RTN","RORX009",31,0)
 ;;HU_DOSES(#,NAME,LAST4,AGE,DOD,IPNRX,ND,ICN,PACT,PCP)^I $$PARAM^RORTSK01("PATIENTS","INPATIENT"),$$PARAM^RORTSK01("AGE_RANGE","TYPE")="AGE"
"RTN","RORX009",32,0)
 ;;HU_DOSES(#,NAME,LAST4,DOB,DOD,IPNRX,ND,ICN,PACT,PCP)^I $$PARAM^RORTSK01("PATIENTS","INPATIENT"),$$PARAM^RORTSK01("AGE_RANGE","TYPE")="DOB"
"RTN","RORX009",33,0)
 ;;HU_FILLS(#,NAME,LAST4,DOD,OPNRX,ND,ICN,PACT,PCP)^I $$PARAM^RORTSK01("PATIENTS","OUTPATIENT"),$$PARAM^RORTSK01("AGE_RANGE","TYPE")="ALL"
"RTN","RORX009",34,0)
 ;;HU_FILLS(#,NAME,LAST4,AGE,DOD,OPNRX,ND,ICN,PACT,PCP)^I $$PARAM^RORTSK01("PATIENTS","OUTPATIENT"),$$PARAM^RORTSK01("AGE_RANGE","TYPE")="AGE"
"RTN","RORX009",35,0)
 ;;HU_FILLS(#,NAME,LAST4,DOB,DOD,OPNRX,ND,ICN,PACT,PCP)^I $$PARAM^RORTSK01("PATIENTS","OUTPATIENT"),$$PARAM^RORTSK01("AGE_RANGE","TYPE")="DOB"
"RTN","RORX009",36,0)
 ;;HU_NRX(#,NAME,LAST4,DOD,OPNRX,IPNRX,ND,ICN,PACT,PCP)^I $$PARAM^RORTSK01("PATIENTS","OUTPATIENT"),$$PARAM^RORTSK01("PATIENTS","INPATIENT"),$$PARAM^RORTSK01("AGE_RANGE","TYPE")="ALL"
"RTN","RORX009",37,0)
 ;;HU_NRX(#,NAME,LAST4,AGE,DOD,OPNRX,IPNRX,ND,ICN,PACT,PCP)^I $$PARAM^RORTSK01("PATIENTS","OUTPATIENT"),$$PARAM^RORTSK01("PATIENTS","INPATIENT"),$$PARAM^RORTSK01("AGE_RANGE","TYPE")="AGE"
"RTN","RORX009",38,0)
 ;;HU_NRX(#,NAME,LAST4,DOB,DOD,OPNRX,IPNRX,ND,ICN,PACT,PCP)^I $$PARAM^RORTSK01("PATIENTS","OUTPATIENT"),$$PARAM^RORTSK01("PATIENTS","INPATIENT"),$$PARAM^RORTSK01("AGE_RANGE","TYPE")="DOB"
"RTN","RORX009",39,0)
 ;
"RTN","RORX009",40,0)
 N HEADER,RC
"RTN","RORX009",41,0)
 S HEADER=$$HEADER^RORXU002(.RORTSK,PARTAG)
"RTN","RORX009",42,0)
 Q:HEADER<0 HEADER
"RTN","RORX009",43,0)
 S RC=$$TBLDEF^RORXU002("HEADER^RORX009",HEADER)
"RTN","RORX009",44,0)
 Q $S(RC<0:RC,1:HEADER)
"RTN","RORX009",45,0)
 ;
"RTN","RORX009",46,0)
 ;***** OUTPUTS THE PARAMETERS TO THE REPORT
"RTN","RORX009",47,0)
 ;
"RTN","RORX009",48,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX009",49,0)
 ;
"RTN","RORX009",50,0)
 ; [.STDT]       Start and end dates of the report
"RTN","RORX009",51,0)
 ; [.ENDT]       are returned via these parameters
"RTN","RORX009",52,0)
 ;
"RTN","RORX009",53,0)
 ; [.FLAGS]      Flags for the $$SKIP^RORXU005 are
"RTN","RORX009",54,0)
 ;               returned via this parameter
"RTN","RORX009",55,0)
 ;
"RTN","RORX009",56,0)
 ; Return Values:
"RTN","RORX009",57,0)
 ;       <0  Error code
"RTN","RORX009",58,0)
 ;       >0  IEN of the PARAMETERS element
"RTN","RORX009",59,0)
 ;
"RTN","RORX009",60,0)
PARAMS(PARTAG,STDT,ENDT,FLAGS) ;
"RTN","RORX009",61,0)
 N NAME,PARAMS,TMP
"RTN","RORX009",62,0)
 S PARAMS=$$PARAMS^RORXU002(.RORTSK,PARTAG,.STDT,.ENDT,.FLAGS)
"RTN","RORX009",63,0)
 Q:PARAMS<0 PARAMS
"RTN","RORX009",64,0)
 ;--- Process the drug list and options
"RTN","RORX009",65,0)
 S TMP=$$DRUGLST^RORXU007(.RORTSK,PARAMS,.RORXL,.RORXGRP)
"RTN","RORX009",66,0)
 Q:TMP<0 TMP
"RTN","RORX009",67,0)
 ;--- Additional parameters
"RTN","RORX009",68,0)
 F NAME="MAXUTNUM"  D
"RTN","RORX009",69,0)
 . S TMP=$$PARAM^RORTSK01(NAME)
"RTN","RORX009",70,0)
 . D:TMP'="" ADDVAL^RORTSK11(RORTSK,NAME,TMP,PARAMS)
"RTN","RORX009",71,0)
 ;---
"RTN","RORX009",72,0)
 Q PARAMS
"RTN","RORX009",73,0)
 ;
"RTN","RORX009",74,0)
 ;***** COMPILES THE "PHARMACY PRESCRIPTION UTILIZATION" REPORT
"RTN","RORX009",75,0)
 ; REPORT CODE: 009
"RTN","RORX009",76,0)
 ;
"RTN","RORX009",77,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORX009",78,0)
 ;
"RTN","RORX009",79,0)
 ; The ^TMP("RORX009",$J) global node is used by this function.
"RTN","RORX009",80,0)
 ;
"RTN","RORX009",81,0)
 ; ^TMP("RORX009",$J,
"RTN","RORX009",82,0)
 ;
"RTN","RORX009",83,0)
 ;     "IP",             Number of inpatients
"RTN","RORX009",84,0)
 ;       DFN,            Patient's data
"RTN","RORX009",85,0)
 ;                         ^01: Last 4 digits of SSN
"RTN","RORX009",86,0)
 ;                         ^02: Name
"RTN","RORX009",87,0)
 ;                         ^03: Date of Death
"RTN","RORX009",88,0)
 ;                         ^04: Total number of doses
"RTN","RORX009",89,0)
 ;                         ^05: Number of different drugs
"RTN","RORX009",90,0)
 ;                         ^06: National ICN
"RTN","RORX009",91,0)
 ;                         ^07: PACT Patient care team
"RTN","RORX009",92,0)
 ;                         ^08: PCP Primary care physician
"RTN","RORX009",93,0)
 ;                         ^09: AGE/DOB
"RTN","RORX009",94,0)
 ;         "D",
"RTN","RORX009",95,0)
 ;           DrugIEN)    Quantity
"RTN","RORX009",96,0)
 ;
"RTN","RORX009",97,0)
 ;     "IPD",            Number of different drugs
"RTN","RORX009",98,0)
 ;       DrugIEN,        Drug Name
"RTN","RORX009",99,0)
 ;         "D")          Number of doses
"RTN","RORX009",100,0)
 ;         "M")          Maximum
"RTN","RORX009",101,0)
 ;                         ^01: Maximum number of doses
"RTN","RORX009",102,0)
 ;                         ^02: Number of patients
"RTN","RORX009",103,0)
 ;         "P")          Number of patients
"RTN","RORX009",104,0)
 ;       "B",
"RTN","RORX009",105,0)
 ;         NumOfDoses,
"RTN","RORX009",106,0)
 ;           DrugName,
"RTN","RORX009",107,0)
 ;             DrugIEN)  ""
"RTN","RORX009",108,0)
 ;
"RTN","RORX009",109,0)
 ;     "IPRX",           Total number of doses
"RTN","RORX009",110,0)
 ;       NumOfDoses,     Number of patients
"RTN","RORX009",111,0)
 ;         PatientName,
"RTN","RORX009",112,0)
 ;           DFN)        ""
"RTN","RORX009",113,0)
 ;
"RTN","RORX009",114,0)
 ;     "OP",             Number of outpatients
"RTN","RORX009",115,0)
 ;       DFN,            Patient's data
"RTN","RORX009",116,0)
 ;                         ^01: Last 4 digits of SSN
"RTN","RORX009",117,0)
 ;                         ^02: Name
"RTN","RORX009",118,0)
 ;                         ^03: Date of Death
"RTN","RORX009",119,0)
 ;                         ^04: Total number of fills
"RTN","RORX009",120,0)
 ;                         ^05: Number of different drugs
"RTN","RORX009",121,0)
 ;                         ^06: National ICN
"RTN","RORX009",122,0)
 ;                         ^07: PACT Patient care team
"RTN","RORX009",123,0)
 ;                         ^08: PCP Primary care physician
"RTN","RORX009",124,0)
 ;                         ^09: AGE/DOB
"RTN","RORX009",125,0)
 ;         "D",
"RTN","RORX009",126,0)
 ;           DrugIEN)    Quantity
"RTN","RORX009",127,0)
 ;
"RTN","RORX009",128,0)
 ;     "OPD",            Number of different drugs
"RTN","RORX009",129,0)
 ;       DrugIEN,        Drug Name
"RTN","RORX009",130,0)
 ;         "D")          Number of fills
"RTN","RORX009",131,0)
 ;         "M")          Maximum
"RTN","RORX009",132,0)
 ;                         ^01: Maximum number of fills
"RTN","RORX009",133,0)
 ;                         ^02: Number of patients
"RTN","RORX009",134,0)
 ;         "P")          Number of patients
"RTN","RORX009",135,0)
 ;       "B",
"RTN","RORX009",136,0)
 ;         NumOfFills,
"RTN","RORX009",137,0)
 ;           DrugName,
"RTN","RORX009",138,0)
 ;             DrugIEN)  ""
"RTN","RORX009",139,0)
 ;
"RTN","RORX009",140,0)
 ;     "OPRX",           Total number of fills
"RTN","RORX009",141,0)
 ;       NumOfFills,     Number of patients
"RTN","RORX009",142,0)
 ;         PatientName,
"RTN","RORX009",143,0)
 ;           DFN)        ""
"RTN","RORX009",144,0)
 ;
"RTN","RORX009",145,0)
 ;     "SUMRX",
"RTN","RORX009",146,0)
 ;       NumberOfRX,     Number of patients
"RTN","RORX009",147,0)
 ;         PatientName,
"RTN","RORX009",148,0)
 ;           DFN,        Number of different drugs
"RTN","RORX009",149,0)
 ;             "IP")
"RTN","RORX009",150,0)
 ;             "OP")
"RTN","RORX009",151,0)
 ;
"RTN","RORX009",152,0)
 ; Return Values:
"RTN","RORX009",153,0)
 ;       <0  Error code
"RTN","RORX009",154,0)
 ;        0  Ok
"RTN","RORX009",155,0)
 ;
"RTN","RORX009",156,0)
RXUTIL(RORTSK) ;
"RTN","RORX009",157,0)
 N ROREDT        ; End date
"RTN","RORX009",158,0)
 N RORREG        ; Registry IEN
"RTN","RORX009",159,0)
 N RORSDT        ; Start date
"RTN","RORX009",160,0)
 N RORXGRP       ; List of drug groups
"RTN","RORX009",161,0)
 N RORXL         ; List of drugs for the pharmacy search API
"RTN","RORX009",162,0)
 ;
"RTN","RORX009",163,0)
 N ECNT,RC,REPORT,SFLAGS,TMP
"RTN","RORX009",164,0)
 S RORXL="",(ECNT,RC)=0
"RTN","RORX009",165,0)
 K ^TMP("RORX009",$J)
"RTN","RORX009",166,0)
 ;--- Root node of the report
"RTN","RORX009",167,0)
 S REPORT=$$ADDVAL^RORTSK11(RORTSK,"REPORT")
"RTN","RORX009",168,0)
 Q:REPORT<0 REPORT
"RTN","RORX009",169,0)
 ;
"RTN","RORX009",170,0)
 D
"RTN","RORX009",171,0)
 . ;--- Get and prepare the report parameters
"RTN","RORX009",172,0)
 . S RORREG=$$PARAM^RORTSK01("REGIEN")
"RTN","RORX009",173,0)
 . S RC=$$PARAMS(REPORT,.RORSDT,.ROREDT,.SFLAGS)  Q:RC<0
"RTN","RORX009",174,0)
 . ;--- Report header
"RTN","RORX009",175,0)
 . S RC=$$HEADER(REPORT)  Q:RC<0
"RTN","RORX009",176,0)
 . ;--- Query the registry
"RTN","RORX009",177,0)
 . D TPPSETUP^RORTSK01(80)
"RTN","RORX009",178,0)
 . S RC=$$QUERY^RORX009A(SFLAGS)
"RTN","RORX009",179,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX009",180,0)
 . ;--- Sort the data
"RTN","RORX009",181,0)
 . D TPPSETUP^RORTSK01(10)
"RTN","RORX009",182,0)
 . S RC=$$SORT^RORX009A()
"RTN","RORX009",183,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX009",184,0)
 . ;--- Store the results
"RTN","RORX009",185,0)
 . D TPPSETUP^RORTSK01(10)
"RTN","RORX009",186,0)
 . S RC=$$STORE^RORX009C(REPORT)
"RTN","RORX009",187,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX009",188,0)
 ;
"RTN","RORX009",189,0)
 ;--- Cleanup
"RTN","RORX009",190,0)
 K ^TMP("RORX009",$J)
"RTN","RORX009",191,0)
 D FREE^RORTMP(RORXL)
"RTN","RORX009",192,0)
 Q $S(RC<0:RC,ECNT>0:-43,1:0)
"RTN","RORX009A")
0^21^B90917415^B81898095
"RTN","RORX009A",1,0)
RORX009A ;HOIFO/SG,VAC - PRESCRIPTION UTILIZ. (QUERY & SORT) ;4/7/09 2:08pm
"RTN","RORX009A",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**8,13,19,21,31**;Feb 17, 2006;Build 62
"RTN","RORX009A",3,0)
 ;
"RTN","RORX009A",4,0)
 ; This routine uses the following IAs:
"RTN","RORX009A",5,0)
 ;
"RTN","RORX009A",6,0)
 ; #10103         FMADD^XLFDT (supported)
"RTN","RORX009A",7,0)
 ;   
"RTN","RORX009A",8,0)
 ;******************************************************************************
"RTN","RORX009A",9,0)
 ;******************************************************************************
"RTN","RORX009A",10,0)
 ;                 --- ROUTINE MODIFICATION LOG ---
"RTN","RORX009A",11,0)
 ;        
"RTN","RORX009A",12,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORX009A",13,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","RORX009A",14,0)
 ;ROR*1.5*8    MAR  2010   V CARR       Modified to handle ICD9 filter for
"RTN","RORX009A",15,0)
 ;                                      'include' or 'exclude'.
"RTN","RORX009A",16,0)
 ;ROR*1.5*13   DEC  2010   A SAUNDERS   User can select specific patients,
"RTN","RORX009A",17,0)
 ;                                      clinics, or divisions for the report.
"RTN","RORX009A",18,0)
 ;ROR*1.5*19   FEB  2012   K GUPTA      Support for ICD-10 Coding System
"RTN","RORX009A",19,0)
 ;ROR*1.5*21   SEP 2013    T KOPP       Added ICN as last report column if
"RTN","RORX009A",20,0)
 ;                                      additional identifier option selected
"RTN","RORX009A",21,0)
 ;ROR*1.5*31   MAY 2017    M FERRARESE  Adding PACT, PCP, and AGE/DOB as additional
"RTN","RORX009A",22,0)
 ;                                      identifiers.
"RTN","RORX009A",23,0)
 ;                                      
"RTN","RORX009A",24,0)
 ;******************************************************************************
"RTN","RORX009A",25,0)
 ;******************************************************************************
"RTN","RORX009A",26,0)
 Q
"RTN","RORX009A",27,0)
 ;
"RTN","RORX009A",28,0)
 ;***** QUERIES THE REGISTRY
"RTN","RORX009A",29,0)
 ;
"RTN","RORX009A",30,0)
 ; FLAGS         Flags for the $$SKIP^RORXU005
"RTN","RORX009A",31,0)
 ;
"RTN","RORX009A",32,0)
 ; Return Values:
"RTN","RORX009A",33,0)
 ;       <0  Error code
"RTN","RORX009A",34,0)
 ;        0  Ok
"RTN","RORX009A",35,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX009A",36,0)
 ;
"RTN","RORX009A",37,0)
QUERY(FLAGS) ;
"RTN","RORX009A",38,0)
 N ROREDT1       ; Day after the end date
"RTN","RORX009A",39,0)
 N RORPTN        ; Number of patients in the registry
"RTN","RORX009A",40,0)
 N RORCDLIST     ; Flag to indicate whether a clinic or division list exists
"RTN","RORX009A",41,0)
 N RORCDSTDT     ; Start date for clinic/division utilization search
"RTN","RORX009A",42,0)
 N RORCDENDT     ; End date for clinic/division utilization search
"RTN","RORX009A",43,0)
 ;
"RTN","RORX009A",44,0)
 N CNT,ECNT,IEN,IENS,PATIEN,RC,RORXDST,RXFLAGS,TMP,XREFNODE
"RTN","RORX009A",45,0)
 N RCC,FLAG
"RTN","RORX009A",46,0)
 S XREFNODE=$NA(^RORDATA(798,"AC",+RORREG))
"RTN","RORX009A",47,0)
 S RORPTN=$$REGSIZE^RORUTL02(+RORREG)  S:RORPTN<0 RORPTN=0
"RTN","RORX009A",48,0)
 S ROREDT1=$$FMADD^XLFDT(ROREDT,1)
"RTN","RORX009A",49,0)
 S (CNT,ECNT,RC)=0
"RTN","RORX009A",50,0)
 ;
"RTN","RORX009A",51,0)
 ;--- Prepare parameters for the pharmacy search API
"RTN","RORX009A",52,0)
 S RORXDST=$NA(^TMP("RORX009",$J))
"RTN","RORX009A",53,0)
 S RORXDST("RORCB")="$$RXSCB^RORX009A"
"RTN","RORX009A",54,0)
 S RORXDST("GENERIC")=$$PARAM^RORTSK01("DRUGS","AGGR_GENERIC")
"RTN","RORX009A",55,0)
 S RXFLAGS="E"
"RTN","RORX009A",56,0)
 S:$$PARAM^RORTSK01("PATIENTS","INPATIENT") RXFLAGS=RXFLAGS_"IV"
"RTN","RORX009A",57,0)
 S:$$PARAM^RORTSK01("PATIENTS","OUTPATIENT") RXFLAGS=RXFLAGS_"O"
"RTN","RORX009A",58,0)
 Q:RXFLAGS="E" 0
"RTN","RORX009A",59,0)
 ;
"RTN","RORX009A",60,0)
 ;=== Set up Clinic/Division list parameters
"RTN","RORX009A",61,0)
 S RORCDLIST=$$CDPARMS^RORXU001(.RORTSK,.RORCDSTDT,.RORCDENDT)
"RTN","RORX009A",62,0)
 ;
"RTN","RORX009A",63,0)
 ;--- Browse through the registry records
"RTN","RORX009A",64,0)
 S IEN=0
"RTN","RORX009A",65,0)
 S FLAG=$G(RORTSK("PARAMS","ICDFILT","A","FILTER"))
"RTN","RORX009A",66,0)
 F  S IEN=$O(@XREFNODE@(IEN))  Q:IEN'>0  D  Q:RC<0
"RTN","RORX009A",67,0)
 . S TMP=$S(RORPTN>0:CNT/RORPTN,1:"")
"RTN","RORX009A",68,0)
 . S RC=$$LOOP^RORTSK01(TMP)  Q:RC<0
"RTN","RORX009A",69,0)
 . S IENS=IEN_",",CNT=CNT+1
"RTN","RORX009A",70,0)
 . ;--- Get patient DFN
"RTN","RORX009A",71,0)
 . S PATIEN=$$PTIEN^RORUTL01(IEN)  Q:PATIEN'>0
"RTN","RORX009A",72,0)
 . ;check for patient list and quit if not on list
"RTN","RORX009A",73,0)
 . I $D(RORTSK("PARAMS","PATIENTS","C")),'$D(RORTSK("PARAMS","PATIENTS","C",PATIEN)) Q
"RTN","RORX009A",74,0)
 . ;--- Check if the patient should be skipped
"RTN","RORX009A",75,0)
 . Q:$$SKIP^RORXU005(IEN,FLAGS,RORSDT,ROREDT)
"RTN","RORX009A",76,0)
 . ;--- Check if patient filtered for ICD Codes
"RTN","RORX009A",77,0)
 . S RCC=0
"RTN","RORX009A",78,0)
 . I FLAG'="ALL" D
"RTN","RORX009A",79,0)
 . . S RCC=$$ICD^RORXU010(PATIEN)
"RTN","RORX009A",80,0)
 . I (FLAG="INCLUDE")&(RCC=0) Q
"RTN","RORX009A",81,0)
 . I (FLAG="EXCLUDE")&(RCC=1) Q
"RTN","RORX009A",82,0)
 . ;--- End of ICD Filter check.
"RTN","RORX009A",83,0)
 . ;
"RTN","RORX009A",84,0)
 . ;--- Check for Clinic or Division list and quit if not in list
"RTN","RORX009A",85,0)
 . I RORCDLIST,'$$CDUTIL^RORXU001(.RORTSK,PATIEN,RORCDSTDT,RORCDENDT) Q
"RTN","RORX009A",86,0)
 . ;
"RTN","RORX009A",87,0)
 . ;--- Search the pharmacy data
"RTN","RORX009A",88,0)
 . M RORXDST("RORXGRP")=RORXGRP("C")
"RTN","RORX009A",89,0)
 . S TMP=$$RXSEARCH^RORUTL14(PATIEN,RORXL,.RORXDST,RXFLAGS,RORSDT,ROREDT1)
"RTN","RORX009A",90,0)
 . I TMP<0  S ECNT=ECNT+1  Q
"RTN","RORX009A",91,0)
 . ;--- No medications from some groups
"RTN","RORX009A",92,0)
 . Q:$D(RORXDST("RORXGRP"))>1
"RTN","RORX009A",93,0)
 . ;--- Skip the patient if no data has been found
"RTN","RORX009A",94,0)
 . I '$D(@RORXDST@("IP",PATIEN)),'$D(@RORXDST@("OP",PATIEN))  Q
"RTN","RORX009A",95,0)
 . ;
"RTN","RORX009A",96,0)
 . ;--- Calculate intermediate totals
"RTN","RORX009A",97,0)
 . S RC=$$TOTALS(PATIEN)
"RTN","RORX009A",98,0)
 . I RC  S ECNT=ECNT+1  Q:RC<0
"RTN","RORX009A",99,0)
 ;---
"RTN","RORX009A",100,0)
 Q $S(RC<0:RC,1:ECNT)
"RTN","RORX009A",101,0)
 ;
"RTN","RORX009A",102,0)
 ;***** CALLBACK FUNCTION FOR THE PHARMACY SEARCH API
"RTN","RORX009A",103,0)
RXSCB(ROR8DST,ORDER,ORDFLG,DRUG,DATE) ;
"RTN","RORX009A",104,0)
 N DRUGIEN,DRUGNAME,IRP,RPS,RXCNT,SUBS,TMP
"RTN","RORX009A",105,0)
 I ROR8DST("GENERIC")  D
"RTN","RORX009A",106,0)
 . S DRUGIEN=+ROR8DST("RORXGEN"),DRUGNAME=$P(ROR8DST("RORXGEN"),U,2)
"RTN","RORX009A",107,0)
 E  S DRUGIEN=+DRUG,DRUGNAME=$P(DRUG,U,2)
"RTN","RORX009A",108,0)
 Q:(DRUGIEN'>0)!(DRUGNAME="") 1
"RTN","RORX009A",109,0)
 ;=== Check the drug groups
"RTN","RORX009A",110,0)
 S TMP=$$RXGRPCHK^RORXU007(.ROR8DST,+DRUG,RORXL)
"RTN","RORX009A",111,0)
 Q:TMP TMP
"RTN","RORX009A",112,0)
 ;=== Process the order
"RTN","RORX009A",113,0)
 S SUBS=$S(ORDFLG["I":"IP",ORDFLG["O":"OP",1:"")  Q:SUBS="" 1
"RTN","RORX009A",114,0)
 S RXCNT=0
"RTN","RORX009A",115,0)
 ;--- Count the original order, refills and partials
"RTN","RORX009A",116,0)
 I ORDFLG["I"  S RXCNT=RXCNT+1  ; Inpatient
"RTN","RORX009A",117,0)
 E  D                           ; Outpatient
"RTN","RORX009A",118,0)
 . S TMP=+$P($G(^TMP("PS",$J,"RXN",0)),U,6)  ; Original Fill Date
"RTN","RORX009A",119,0)
 . S:(TMP'<ROR8DST("RORSDT"))&(TMP<ROR8DST("ROREDT")) RXCNT=RXCNT+1
"RTN","RORX009A",120,0)
 F RPS="PAR","REF"  S IRP=0  D
"RTN","RORX009A",121,0)
 . F  S IRP=$O(^TMP("PS",$J,RPS,IRP))  Q:IRP'>0  S RXCNT=RXCNT+1
"RTN","RORX009A",122,0)
 ;--- Update the counters
"RTN","RORX009A",123,0)
 D:RXCNT>0
"RTN","RORX009A",124,0)
 . S TMP=$G(@ROR8DST@(SUBS,+ROR8DST("RORDFN"),"D",DRUGIEN))
"RTN","RORX009A",125,0)
 . S @ROR8DST@(SUBS,+ROR8DST("RORDFN"),"D",DRUGIEN)=TMP+RXCNT
"RTN","RORX009A",126,0)
 . S TMP=SUBS_"D"
"RTN","RORX009A",127,0)
 . S:'$D(@ROR8DST@(TMP,DRUGIEN)) @ROR8DST@(TMP,DRUGIEN)=DRUGNAME
"RTN","RORX009A",128,0)
 Q 0
"RTN","RORX009A",129,0)
 ;
"RTN","RORX009A",130,0)
 ;***** SORTS THE RESULTS AND COMPILES THE TOTALS
"RTN","RORX009A",131,0)
 ;
"RTN","RORX009A",132,0)
 ; Return Values:
"RTN","RORX009A",133,0)
 ;       <0  Error code
"RTN","RORX009A",134,0)
 ;        0  Ok
"RTN","RORX009A",135,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX009A",136,0)
 ;
"RTN","RORX009A",137,0)
SORT() ;
"RTN","RORX009A",138,0)
 N ECNT,NODE,RC
"RTN","RORX009A",139,0)
 S (ECNT,RC)=0
"RTN","RORX009A",140,0)
 S NODE=$NA(^TMP("RORX009",$J))
"RTN","RORX009A",141,0)
 Q:$D(@NODE)<10 0
"RTN","RORX009A",142,0)
 ;---
"RTN","RORX009A",143,0)
 S RC=$$LOOP^RORTSK01(0)    Q:RC<0 RC
"RTN","RORX009A",144,0)
 D SORTRX(NODE,"IPD")
"RTN","RORX009A",145,0)
 ;---
"RTN","RORX009A",146,0)
 S RC=$$LOOP^RORTSK01(.33)  Q:RC<0 RC
"RTN","RORX009A",147,0)
 D SORTRX(NODE,"OPD")
"RTN","RORX009A",148,0)
 ;---
"RTN","RORX009A",149,0)
 S RC=$$LOOP^RORTSK01(.66)  Q:RC<0 RC
"RTN","RORX009A",150,0)
 S RC=$$SUMRX(NODE)
"RTN","RORX009A",151,0)
 ;---
"RTN","RORX009A",152,0)
 Q $S(RC<0:RC,1:ECNT)
"RTN","RORX009A",153,0)
 ;
"RTN","RORX009A",154,0)
 ;***** SORTS THE DRUG LIST
"RTN","RORX009A",155,0)
 ;
"RTN","RORX009A",156,0)
 ; NODE          Closed root of the category section
"RTN","RORX009A",157,0)
 ;               in the temporary global
"RTN","RORX009A",158,0)
 ;
"RTN","RORX009A",159,0)
 ; SUBS          Drug list subscript ("IPD" or "OPD")
"RTN","RORX009A",160,0)
 ;
"RTN","RORX009A",161,0)
SORTRX(NODE,SUBS) ;
"RTN","RORX009A",162,0)
 N IEN,NAME,NDRUGS,SUM,TMP
"RTN","RORX009A",163,0)
 S IEN=0,NDRUGS=0
"RTN","RORX009A",164,0)
 F  S IEN=$O(@NODE@(SUBS,IEN))  Q:IEN'>0  D
"RTN","RORX009A",165,0)
 . S NAME=@NODE@(SUBS,IEN),NDRUGS=NDRUGS+1
"RTN","RORX009A",166,0)
 . S TMP=+$G(@NODE@(SUBS,IEN,"D"))
"RTN","RORX009A",167,0)
 . S @NODE@(SUBS,"B",TMP,NAME,IEN)=""
"RTN","RORX009A",168,0)
 ;--- Numbers of different drugs
"RTN","RORX009A",169,0)
 S @NODE@(SUBS)=NDRUGS
"RTN","RORX009A",170,0)
 Q
"RTN","RORX009A",171,0)
 ;
"RTN","RORX009A",172,0)
 ;***** COMBINES THE INPATIENT AND OUTPATIENT DATA
"RTN","RORX009A",173,0)
 ;
"RTN","RORX009A",174,0)
 ; NODE          Closed root of the category section
"RTN","RORX009A",175,0)
 ;               in the temporary global
"RTN","RORX009A",176,0)
 ;
"RTN","RORX009A",177,0)
SUMRX(NODE) ;
"RTN","RORX009A",178,0)
 N COUNT,I,MAXUTNUM,NDRX,NRX,RC,RXIEN,SUMNRX,TMP
"RTN","RORX009A",179,0)
 Q:($D(@NODE@("IPRX"))<10)!($D(@NODE@("OPRX"))<10) 0
"RTN","RORX009A",180,0)
 S MAXUTNUM=$$PARAM^RORTSK01("MAXUTNUM")
"RTN","RORX009A",181,0)
 Q:MAXUTNUM'>0 0
"RTN","RORX009A",182,0)
 ;
"RTN","RORX009A",183,0)
 ;=== Outpatient data
"RTN","RORX009A",184,0)
 S NRX="",(COUNT,RC)=0
"RTN","RORX009A",185,0)
 F  S NRX=$O(@NODE@("OPRX",NRX),-1)  Q:NRX=""  D  Q:RC
"RTN","RORX009A",186,0)
 . S RC=$$LOOP^RORTSK01()  Q:RC<0
"RTN","RORX009A",187,0)
 . S @NODE@("SUMRX",NRX)=$G(@NODE@("OPRX",NRX))
"RTN","RORX009A",188,0)
 . S NAME=""
"RTN","RORX009A",189,0)
 . F  S NAME=$O(@NODE@("OPRX",NRX,NAME))  Q:NAME=""  D  Q:RC
"RTN","RORX009A",190,0)
 . . S DFN=""
"RTN","RORX009A",191,0)
 . . F  S DFN=$O(@NODE@("OPRX",NRX,NAME,DFN))  Q:DFN=""  D  Q:RC
"RTN","RORX009A",192,0)
 . . . ;--- Include only the patients with highest utilization
"RTN","RORX009A",193,0)
 . . . S COUNT=COUNT+1  I COUNT>MAXUTNUM  S RC=1  Q
"RTN","RORX009A",194,0)
 . . . ;--- Calculate the totals
"RTN","RORX009A",195,0)
 . . . S (NDRX,SUMNRX)=0
"RTN","RORX009A",196,0)
 . . . F I="IP","OP"  S TMP=$G(@NODE@(I,DFN))  D
"RTN","RORX009A",197,0)
 . . . . S NDRX=NDRX+$P(TMP,U,5),SUMNRX=SUMNRX+$P(TMP,U,4)
"RTN","RORX009A",198,0)
 . . . S @NODE@("SUMRX",SUMNRX,NAME,DFN,"OP")=""
"RTN","RORX009A",199,0)
 . . . S @NODE@("SUMRX",SUMNRX)=$G(@NODE@("SUMRX",SUMNRX))+1
"RTN","RORX009A",200,0)
 . . . ;--- Adjust the total number of different drugs
"RTN","RORX009A",201,0)
 . . . ;--- (some drugs could be both inpatient and outpatient)
"RTN","RORX009A",202,0)
 . . . S RXIEN=0
"RTN","RORX009A",203,0)
 . . . F  S RXIEN=$O(@NODE@("OP",DFN,"D",RXIEN))  Q:RXIEN'>0  D
"RTN","RORX009A",204,0)
 . . . . S:$D(@NODE@("IP",DFN,"D",RXIEN)) NDRX=NDRX-1
"RTN","RORX009A",205,0)
 . . . ;--- Store the number of different drugs
"RTN","RORX009A",206,0)
 . . . S @NODE@("SUMRX",SUMNRX,NAME,DFN)=NDRX
"RTN","RORX009A",207,0)
 ;
"RTN","RORX009A",208,0)
 ;=== Inpatient data
"RTN","RORX009A",209,0)
 S NRX="",(COUNT,RC)=0
"RTN","RORX009A",210,0)
 F  S NRX=$O(@NODE@("IPRX",NRX),-1)  Q:NRX=""  D  Q:RC
"RTN","RORX009A",211,0)
 . S RC=$$LOOP^RORTSK01()  Q:RC<0
"RTN","RORX009A",212,0)
 . S NAME=""
"RTN","RORX009A",213,0)
 . F  S NAME=$O(@NODE@("IPRX",NRX,NAME))  Q:NAME=""  D  Q:RC
"RTN","RORX009A",214,0)
 . . S DFN=""
"RTN","RORX009A",215,0)
 . . F  S DFN=$O(@NODE@("IPRX",NRX,NAME,DFN))  Q:DFN=""  D  Q:RC
"RTN","RORX009A",216,0)
 . . . ;--- Include only the patients with highest utilization
"RTN","RORX009A",217,0)
 . . . S COUNT=COUNT+1  I COUNT>MAXUTNUM  S RC=1  Q
"RTN","RORX009A",218,0)
 . . . ;--- Calculate the totals
"RTN","RORX009A",219,0)
 . . . S (NDRX,SUMNRX)=0
"RTN","RORX009A",220,0)
 . . . F I="IP","OP"  S TMP=$G(@NODE@(I,DFN))  D
"RTN","RORX009A",221,0)
 . . . . S NDRX=NDRX+$P(TMP,U,5),SUMNRX=SUMNRX+$P(TMP,U,4)
"RTN","RORX009A",222,0)
 . . . S @NODE@("SUMRX",SUMNRX,NAME,DFN,"IP")=""
"RTN","RORX009A",223,0)
 . . . ;--- Quit if the patient has been processed already
"RTN","RORX009A",224,0)
 . . . Q:$D(@NODE@("SUMRX",SUMNRX,NAME,DFN,"OP"))
"RTN","RORX009A",225,0)
 . . . S @NODE@("SUMRX",SUMNRX)=$G(@NODE@("SUMRX",SUMNRX))+1
"RTN","RORX009A",226,0)
 . . . ;--- Adjust the total number of different drugs
"RTN","RORX009A",227,0)
 . . . ;--- (some drugs could be both inpatient and outpatient)
"RTN","RORX009A",228,0)
 . . . S RXIEN=0
"RTN","RORX009A",229,0)
 . . . F  S RXIEN=$O(@NODE@("IP",DFN,"D",RXIEN))  Q:RXIEN'>0  D
"RTN","RORX009A",230,0)
 . . . . S:$D(@NODE@("OP",DFN,"D",RXIEN)) NDRX=NDRX-1
"RTN","RORX009A",231,0)
 . . . ;--- Store the number of different drugs
"RTN","RORX009A",232,0)
 . . . S @NODE@("SUMRX",SUMNRX,NAME,DFN)=NDRX
"RTN","RORX009A",233,0)
 ;===
"RTN","RORX009A",234,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORX009A",235,0)
 ;
"RTN","RORX009A",236,0)
 ;***** CALCULATES THE INTERMEDIATE TOTALS
"RTN","RORX009A",237,0)
 ;
"RTN","RORX009A",238,0)
 ; PATIEN        Patient IEN (DFN)
"RTN","RORX009A",239,0)
 ;
"RTN","RORX009A",240,0)
 ; Return Values:
"RTN","RORX009A",241,0)
 ;       <0  Error code
"RTN","RORX009A",242,0)
 ;        0  Ok
"RTN","RORX009A",243,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX009A",244,0)
 ;
"RTN","RORX009A",245,0)
TOTALS(PATIEN) ;
"RTN","RORX009A",246,0)
 N DOD,IEN,LAST4,NDRUGS,NODE,NRX,PTNAME,PTNRX,RXS,SUBS,TMP,VA,VADM,VAERR,AGE,AGETYPE
"RTN","RORX009A",247,0)
 S NODE=$NA(^TMP("RORX009",$J))
"RTN","RORX009A",248,0)
 ;--- Get the patient's data
"RTN","RORX009A",249,0)
 D VADEM^RORUTL05(PATIEN,1)
"RTN","RORX009A",250,0)
 S PTNAME=VADM(1),LAST4=VA("BID"),DOD=$$DATE^RORXU002(VADM(6)\1)
"RTN","RORX009A",251,0)
 S AGETYPE=$$PARAM^RORTSK01("AGE_RANGE","TYPE")
"RTN","RORX009A",252,0)
 S AGE=$S(AGETYPE="AGE":$P(VADM(4),U),AGETYPE="DOB":$$DATE^RORXU002($P(VADM(3),U)\1),1:"")
"RTN","RORX009A",253,0)
 ;---
"RTN","RORX009A",254,0)
 F SUBS="IP","OP"  D:$D(@NODE@(SUBS,PATIEN))>1
"RTN","RORX009A",255,0)
 . S RXS=SUBS_"D"
"RTN","RORX009A",256,0)
 . S IEN=0,(NDRUGS,PTNRX)=0
"RTN","RORX009A",257,0)
 . F  S IEN=$O(@NODE@(SUBS,PATIEN,"D",IEN))  Q:IEN'>0  D
"RTN","RORX009A",258,0)
 . . S NRX=@NODE@(SUBS,PATIEN,"D",IEN)
"RTN","RORX009A",259,0)
 . . S NDRUGS=NDRUGS+1,PTNRX=PTNRX+NRX
"RTN","RORX009A",260,0)
 . . ;---
"RTN","RORX009A",261,0)
 . . S @NODE@(RXS,IEN,"D")=$G(@NODE@(RXS,IEN,"D"))+NRX
"RTN","RORX009A",262,0)
 . . S @NODE@(RXS,IEN,"P")=$G(@NODE@(RXS,IEN,"P"))+1
"RTN","RORX009A",263,0)
 . . ;---
"RTN","RORX009A",264,0)
 . . S TMP=$G(@NODE@(RXS,IEN,"M"))
"RTN","RORX009A",265,0)
 . . D:NRX'<TMP
"RTN","RORX009A",266,0)
 . . . I NRX>TMP  S @NODE@(RXS,IEN,"M")=NRX_U_1  Q
"RTN","RORX009A",267,0)
 . . . S $P(@NODE@(RXS,IEN,"M"),U,2)=$P(TMP,U,2)+1
"RTN","RORX009A",268,0)
 . ;---
"RTN","RORX009A",269,0)
 . S @NODE@(SUBS)=$G(@NODE@(SUBS))+1
"RTN","RORX009A",270,0)
 . S TMP=$S($$PARAM^RORTSK01("PATIENTS","ICN"):$$ICN^RORUTL02(PATIEN),1:"")
"RTN","RORX009A",271,0)
 . S @NODE@(SUBS,PATIEN)=LAST4_U_PTNAME_U_DOD_U_PTNRX_U_NDRUGS_U_TMP
"RTN","RORX009A",272,0)
 . S TMP=$S($$PARAM^RORTSK01("PATIENTS","PACT"):$$PACT^RORUTL02(PATIEN),1:"")
"RTN","RORX009A",273,0)
 . S @NODE@(SUBS,PATIEN)=@NODE@(SUBS,PATIEN)_U_TMP
"RTN","RORX009A",274,0)
 . S TMP=$S($$PARAM^RORTSK01("PATIENTS","PCP"):$$PCP^RORUTL02(PATIEN),1:"")
"RTN","RORX009A",275,0)
 . S @NODE@(SUBS,PATIEN)=@NODE@(SUBS,PATIEN)_U_TMP_U_AGE
"RTN","RORX009A",276,0)
 . ;---
"RTN","RORX009A",277,0)
 . S RXS=SUBS_"RX"
"RTN","RORX009A",278,0)
 . S @NODE@(RXS)=$G(@NODE@(RXS))+PTNRX
"RTN","RORX009A",279,0)
 . S @NODE@(RXS,PTNRX)=$G(@NODE@(RXS,PTNRX))+1
"RTN","RORX009A",280,0)
 . S @NODE@(RXS,PTNRX,PTNAME,PATIEN)=""
"RTN","RORX009A",281,0)
 ;---
"RTN","RORX009A",282,0)
 Q 0
"RTN","RORX009C")
0^22^B87202952^B65520857
"RTN","RORX009C",1,0)
RORX009C ;HCIOFO/SG - PRESCRIPTION UTILIZ. (STORE) ;12/16/05 9:19am
"RTN","RORX009C",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**21,31**;Feb 17, 2006;Build 62
"RTN","RORX009C",3,0)
 ;
"RTN","RORX009C",4,0)
 ;******************************************************************************
"RTN","RORX009C",5,0)
 ;                       --- ROUTINE MODIFICATION LOG ---
"RTN","RORX009C",6,0)
 ;        
"RTN","RORX009C",7,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORX009C",8,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","RORX009C",9,0)
 ;ROR*1.5*21   SEP 2013    T KOPP       Added ICN as last report column if
"RTN","RORX009C",10,0)
 ;                                      additional identifier option selected
"RTN","RORX009C",11,0)
 ;ROR*1.5*31   MAY 2017    M FERRARESE  Adding PACT, PCP, and AGE/DOB as additional
"RTN","RORX009C",12,0)
 ;                                      identifiers.
"RTN","RORX009C",13,0)
 ;******************************************************************************
"RTN","RORX009C",14,0)
 ;
"RTN","RORX009C",15,0)
 Q
"RTN","RORX009C",16,0)
 ;
"RTN","RORX009C",17,0)
 ;***** DRUGS
"RTN","RORX009C",18,0)
 ;
"RTN","RORX009C",19,0)
 ; SECTION       IEN of the parent element
"RTN","RORX009C",20,0)
 ;
"RTN","RORX009C",21,0)
 ; SUBS
"RTN","RORX009C",22,0)
 ;
"RTN","RORX009C",23,0)
 ; NODE          Closed root of the category section
"RTN","RORX009C",24,0)
 ;               in the temporary global
"RTN","RORX009C",25,0)
 ;
"RTN","RORX009C",26,0)
 ; TBLNAME
"RTN","RORX009C",27,0)
 ;
"RTN","RORX009C",28,0)
 ; Return Values:
"RTN","RORX009C",29,0)
 ;       <0  Error code
"RTN","RORX009C",30,0)
 ;        0  Ok
"RTN","RORX009C",31,0)
 ;
"RTN","RORX009C",32,0)
DRUGS(SECTION,SUBS,NODE,TBLNAME) ;
"RTN","RORX009C",33,0)
 Q:$D(@NODE@(SUBS))<10 0
"RTN","RORX009C",34,0)
 N IEN,ITEM,NAME,NRXNAME,NUM,RC,TMP
"RTN","RORX009C",35,0)
 S TABLE=$$ADDVAL^RORTSK11(RORTSK,TBLNAME,,SECTION)
"RTN","RORX009C",36,0)
 Q:TABLE<0 TABLE
"RTN","RORX009C",37,0)
 D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE",TBLNAME)
"RTN","RORX009C",38,0)
 S NRXNAME=$E(SUBS,1,2)_"NRX"
"RTN","RORX009C",39,0)
 ;---
"RTN","RORX009C",40,0)
 S NUM="",RC=0
"RTN","RORX009C",41,0)
 F  S NUM=$O(@NODE@(SUBS,"B",NUM),-1)  Q:NUM=""  D  Q:RC
"RTN","RORX009C",42,0)
 . S NAME=""
"RTN","RORX009C",43,0)
 . F  S NAME=$O(@NODE@(SUBS,"B",NUM,NAME))  Q:NAME=""  D  Q:RC
"RTN","RORX009C",44,0)
 . . S IEN=""
"RTN","RORX009C",45,0)
 . . F  S IEN=$O(@NODE@(SUBS,"B",NUM,NAME,IEN))  Q:IEN=""  D  Q:RC
"RTN","RORX009C",46,0)
 . . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"DRUG",,TABLE)
"RTN","RORX009C",47,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"NAME",NAME,ITEM,1)
"RTN","RORX009C",48,0)
 . . . S TMP=+$G(@NODE@(SUBS,IEN,"P"))
"RTN","RORX009C",49,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"NP",TMP,ITEM,3)
"RTN","RORX009C",50,0)
 . . . D ADDVAL^RORTSK11(RORTSK,NRXNAME,NUM,ITEM,3)
"RTN","RORX009C",51,0)
 . . . S TMP=$G(@NODE@(SUBS,IEN,"M"))
"RTN","RORX009C",52,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"MAXNRPP",+$P(TMP,U),ITEM,3)
"RTN","RORX009C",53,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"MAXNP",+$P(TMP,U,2),ITEM,3)
"RTN","RORX009C",54,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORX009C",55,0)
 ;
"RTN","RORX009C",56,0)
 ;***** STORES THE REPORT DATA
"RTN","RORX009C",57,0)
 ;
"RTN","RORX009C",58,0)
 ; REPORT        IEN of the REPORT element
"RTN","RORX009C",59,0)
 ;
"RTN","RORX009C",60,0)
 ; Return Values:
"RTN","RORX009C",61,0)
 ;       <0  Error code
"RTN","RORX009C",62,0)
 ;        0  Ok
"RTN","RORX009C",63,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX009C",64,0)
 ;
"RTN","RORX009C",65,0)
STORE(REPORT) ;
"RTN","RORX009C",66,0)
 N RORSONLY      ; Output summary only
"RTN","RORX009C",67,0)
 ;
"RTN","RORX009C",68,0)
 N ECNT,NODE,RC,TMP
"RTN","RORX009C",69,0)
 S RORSONLY=$$SMRYONLY^RORXU006(),(ECNT,RC)=0
"RTN","RORX009C",70,0)
 S NODE=$NA(^TMP("RORX009",$J))
"RTN","RORX009C",71,0)
 Q:$D(@NODE)<10 0
"RTN","RORX009C",72,0)
 ;--- Outpatient data
"RTN","RORX009C",73,0)
 S RC=$$LOOP^RORTSK01(0)  Q:RC<0 RC
"RTN","RORX009C",74,0)
 S RC=$$STOREOP(REPORT,NODE)
"RTN","RORX009C",75,0)
 I RC  Q:RC<0  S ECNT=ECNT+1
"RTN","RORX009C",76,0)
 ;--- Inpatient data
"RTN","RORX009C",77,0)
 S RC=$$LOOP^RORTSK01(.33)  Q:RC<0 RC
"RTN","RORX009C",78,0)
 S RC=$$STOREIP(REPORT,NODE)
"RTN","RORX009C",79,0)
 I RC  Q:RC<0  S ECNT=ECNT+1
"RTN","RORX009C",80,0)
 ;--- Highest utilization summary
"RTN","RORX009C",81,0)
 S RC=$$LOOP^RORTSK01(.66)  Q:RC<0 RC
"RTN","RORX009C",82,0)
 S RC=$$STORESUM(REPORT,NODE)
"RTN","RORX009C",83,0)
 I RC  Q:RC<0  S ECNT=ECNT+1
"RTN","RORX009C",84,0)
 ;---
"RTN","RORX009C",85,0)
 Q $S(RC<0:RC,1:ECNT)
"RTN","RORX009C",86,0)
 ;
"RTN","RORX009C",87,0)
 ;***** INPATIENT DATA
"RTN","RORX009C",88,0)
 ;
"RTN","RORX009C",89,0)
 ; PRNTELMT      IEN of the parent element
"RTN","RORX009C",90,0)
 ;
"RTN","RORX009C",91,0)
 ; NODE          Closed root of the category section
"RTN","RORX009C",92,0)
 ;               in the temporary global
"RTN","RORX009C",93,0)
 ;
"RTN","RORX009C",94,0)
 ; Return Values:
"RTN","RORX009C",95,0)
 ;       <0  Error code
"RTN","RORX009C",96,0)
 ;        0  Ok
"RTN","RORX009C",97,0)
 ;
"RTN","RORX009C",98,0)
STOREIP(PRNTELMT,NODE) ;
"RTN","RORX009C",99,0)
 Q:$D(@NODE@("IP"))<10 0
"RTN","RORX009C",100,0)
 N BUF,COUNT,DFN,ITEM,MAXUTNUM,NAME,NRX,RC,SECTION,TABLE,TMP,AGETYPE
"RTN","RORX009C",101,0)
 S MAXUTNUM=$$PARAM^RORTSK01("MAXUTNUM")
"RTN","RORX009C",102,0)
 S SECTION=$$ADDVAL^RORTSK11(RORTSK,"INPATIENTS",,PRNTELMT)
"RTN","RORX009C",103,0)
 Q:SECTION<0 SECTION
"RTN","RORX009C",104,0)
 S RC=0
"RTN","RORX009C",105,0)
 S AGETYPE=$$PARAM^RORTSK01("AGE_RANGE","TYPE")
"RTN","RORX009C",106,0)
 ;--- Number of doses
"RTN","RORX009C",107,0)
 S TABLE=$$ADDVAL^RORTSK11(RORTSK,"DOSES",,SECTION)
"RTN","RORX009C",108,0)
 Q:TABLE<0 TABLE
"RTN","RORX009C",109,0)
 D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","DOSES")
"RTN","RORX009C",110,0)
 S NRX=""
"RTN","RORX009C",111,0)
 F  S NRX=$O(@NODE@("IPRX",NRX),-1)  Q:NRX=""  D
"RTN","RORX009C",112,0)
 . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"ITEM",,TABLE)
"RTN","RORX009C",113,0)
 . D ADDVAL^RORTSK11(RORTSK,"NP",$P(@NODE@("IPRX",NRX),U),ITEM,3)
"RTN","RORX009C",114,0)
 . D ADDVAL^RORTSK11(RORTSK,"IPNRX",NRX,ITEM,3)
"RTN","RORX009C",115,0)
 ;--- Drugs
"RTN","RORX009C",116,0)
 S RC=$$DRUGS(SECTION,"IPD",NODE,"DRUGS_DOSES")  Q:RC<0 RC
"RTN","RORX009C",117,0)
 ;--- Patients with highest utlization
"RTN","RORX009C",118,0)
 I MAXUTNUM>0  D  Q:RC<0 RC
"RTN","RORX009C",119,0)
 . S TABLE=$$ADDVAL^RORTSK11(RORTSK,"HU_DOSES",,SECTION)
"RTN","RORX009C",120,0)
 . I TABLE<0  S RC=TABLE  Q
"RTN","RORX009C",121,0)
 . D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","HU_DOSES")
"RTN","RORX009C",122,0)
 . S NRX="",(COUNT,RC)=0
"RTN","RORX009C",123,0)
 . F  S NRX=$O(@NODE@("IPRX",NRX),-1)  Q:NRX=""  D  Q:RC
"RTN","RORX009C",124,0)
 . . S RC=$$LOOP^RORTSK01()  Q:RC<0
"RTN","RORX009C",125,0)
 . . S NAME=""
"RTN","RORX009C",126,0)
 . . F  S NAME=$O(@NODE@("IPRX",NRX,NAME))  Q:NAME=""  D  Q:RC
"RTN","RORX009C",127,0)
 . . . S DFN=""
"RTN","RORX009C",128,0)
 . . . F  S DFN=$O(@NODE@("IPRX",NRX,NAME,DFN))  Q:DFN=""  D  Q:RC
"RTN","RORX009C",129,0)
 . . . . S COUNT=COUNT+1  I COUNT>MAXUTNUM  S RC=1  Q
"RTN","RORX009C",130,0)
 . . . . S BUF=$G(@NODE@("IP",DFN))
"RTN","RORX009C",131,0)
 . . . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"PATIENT",,TABLE)
"RTN","RORX009C",132,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"NAME",NAME,ITEM,1)
"RTN","RORX009C",133,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"LAST4",$P(BUF,U),ITEM,2)
"RTN","RORX009C",134,0)
 . . . . I AGETYPE'="ALL" D ADDVAL^RORTSK11(RORTSK,AGETYPE,$P(BUF,U,9),ITEM,1)
"RTN","RORX009C",135,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"DOD",$P(BUF,U,3),ITEM,1)
"RTN","RORX009C",136,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"IPNRX",NRX,ITEM,3)
"RTN","RORX009C",137,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"ND",$P(BUF,U,5),ITEM,3)
"RTN","RORX009C",138,0)
 . . . . I $$PARAM^RORTSK01("PATIENTS","ICN") D
"RTN","RORX009C",139,0)
 . . . . . D ADDVAL^RORTSK11(RORTSK,"ICN",$P(BUF,U,6),ITEM,1)
"RTN","RORX009C",140,0)
 . . . . I $$PARAM^RORTSK01("PATIENTS","PACT") D
"RTN","RORX009C",141,0)
 . . . . . D ADDVAL^RORTSK11(RORTSK,"PACT",$P(BUF,U,7),ITEM,1)
"RTN","RORX009C",142,0)
 . . . . I $$PARAM^RORTSK01("PATIENTS","PCP") D
"RTN","RORX009C",143,0)
 . . . . . D ADDVAL^RORTSK11(RORTSK,"PCP",$P(BUF,U,8),ITEM,1)
"RTN","RORX009C",144,0)
 ;--- Summary
"RTN","RORX009C",145,0)
 D ADDVAL^RORTSK11(RORTSK,"NP",+$G(@NODE@("IP")),SECTION)
"RTN","RORX009C",146,0)
 D ADDVAL^RORTSK11(RORTSK,"IPNRX",+$G(@NODE@("IPRX")),SECTION)
"RTN","RORX009C",147,0)
 D ADDVAL^RORTSK11(RORTSK,"ND",+$G(@NODE@("IPD")),SECTION)
"RTN","RORX009C",148,0)
 Q 0
"RTN","RORX009C",149,0)
 ;
"RTN","RORX009C",150,0)
 ;***** OUTPATIENT DATA
"RTN","RORX009C",151,0)
 ;
"RTN","RORX009C",152,0)
 ; PRNTELMT      IEN of the parent element
"RTN","RORX009C",153,0)
 ;
"RTN","RORX009C",154,0)
 ; NODE          Closed root of the category section
"RTN","RORX009C",155,0)
 ;               in the temporary global
"RTN","RORX009C",156,0)
 ;
"RTN","RORX009C",157,0)
 ; Return Values:
"RTN","RORX009C",158,0)
 ;       <0  Error code
"RTN","RORX009C",159,0)
 ;        0  Ok
"RTN","RORX009C",160,0)
 ;
"RTN","RORX009C",161,0)
STOREOP(PRNTELMT,NODE) ;
"RTN","RORX009C",162,0)
 Q:$D(@NODE@("OP"))<10 0
"RTN","RORX009C",163,0)
 N BUF,COUNT,DFN,ITEM,MAXUTNUM,NAME,NRX,RC,SECTION,TABLE,TMP,AGETYPE
"RTN","RORX009C",164,0)
 S MAXUTNUM=$$PARAM^RORTSK01("MAXUTNUM")
"RTN","RORX009C",165,0)
 S SECTION=$$ADDVAL^RORTSK11(RORTSK,"OUTPATIENTS",,PRNTELMT)
"RTN","RORX009C",166,0)
 Q:SECTION<0 SECTION
"RTN","RORX009C",167,0)
 S RC=0
"RTN","RORX009C",168,0)
 ;--- Number of fills
"RTN","RORX009C",169,0)
 S TABLE=$$ADDVAL^RORTSK11(RORTSK,"FILLS",,SECTION)
"RTN","RORX009C",170,0)
 Q:TABLE<0 TABLE
"RTN","RORX009C",171,0)
 D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","FILLS")
"RTN","RORX009C",172,0)
 S NRX=""
"RTN","RORX009C",173,0)
 S AGETYPE=$$PARAM^RORTSK01("AGE_RANGE","TYPE")
"RTN","RORX009C",174,0)
 F  S NRX=$O(@NODE@("OPRX",NRX),-1)  Q:NRX=""  D
"RTN","RORX009C",175,0)
 . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"ITEM",,TABLE)
"RTN","RORX009C",176,0)
 . D ADDVAL^RORTSK11(RORTSK,"NP",$P(@NODE@("OPRX",NRX),U),ITEM,3)
"RTN","RORX009C",177,0)
 . D ADDVAL^RORTSK11(RORTSK,"OPNRX",NRX,ITEM,3)
"RTN","RORX009C",178,0)
 ;--- Drugs
"RTN","RORX009C",179,0)
 S RC=$$DRUGS(SECTION,"OPD",NODE,"DRUGS_FILLS")  Q:RC<0 RC
"RTN","RORX009C",180,0)
 ;--- Patients with highest utlization
"RTN","RORX009C",181,0)
 I MAXUTNUM>0  D  Q:RC<0 RC
"RTN","RORX009C",182,0)
 . S TABLE=$$ADDVAL^RORTSK11(RORTSK,"HU_FILLS",,SECTION)
"RTN","RORX009C",183,0)
 . I TABLE<0  S RC=TABLE  Q
"RTN","RORX009C",184,0)
 . D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","HU_FILLS")
"RTN","RORX009C",185,0)
 . S NRX="",(COUNT,RC)=0
"RTN","RORX009C",186,0)
 . F  S NRX=$O(@NODE@("OPRX",NRX),-1)  Q:NRX=""  D  Q:RC
"RTN","RORX009C",187,0)
 . . S RC=$$LOOP^RORTSK01()  Q:RC<0
"RTN","RORX009C",188,0)
 . . S NAME=""
"RTN","RORX009C",189,0)
 . . F  S NAME=$O(@NODE@("OPRX",NRX,NAME))  Q:NAME=""  D  Q:RC
"RTN","RORX009C",190,0)
 . . . S DFN=""
"RTN","RORX009C",191,0)
 . . . F  S DFN=$O(@NODE@("OPRX",NRX,NAME,DFN))  Q:DFN=""  D  Q:RC
"RTN","RORX009C",192,0)
 . . . . S COUNT=COUNT+1  I COUNT>MAXUTNUM  S RC=1  Q
"RTN","RORX009C",193,0)
 . . . . S BUF=$G(@NODE@("OP",DFN))
"RTN","RORX009C",194,0)
 . . . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"PATIENT",,TABLE)
"RTN","RORX009C",195,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"NAME",NAME,ITEM,1)
"RTN","RORX009C",196,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"LAST4",$P(BUF,U),ITEM,2)
"RTN","RORX009C",197,0)
 . . . . I AGETYPE'="ALL" D ADDVAL^RORTSK11(RORTSK,AGETYPE,$P(BUF,U,9),ITEM,1)
"RTN","RORX009C",198,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"DOD",$P(BUF,U,3),ITEM,1)
"RTN","RORX009C",199,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"OPNRX",NRX,ITEM,3)
"RTN","RORX009C",200,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"ND",$P(BUF,U,5),ITEM,3)
"RTN","RORX009C",201,0)
 . . . . I $$PARAM^RORTSK01("PATIENTS","ICN") D
"RTN","RORX009C",202,0)
 . . . . . D ADDVAL^RORTSK11(RORTSK,"ICN",$P(BUF,U,6),ITEM,1)
"RTN","RORX009C",203,0)
 . . . . I $$PARAM^RORTSK01("PATIENTS","PACT") D
"RTN","RORX009C",204,0)
 . . . . . D ADDVAL^RORTSK11(RORTSK,"PACT",$P(BUF,U,7),ITEM,1)
"RTN","RORX009C",205,0)
 . . . . I $$PARAM^RORTSK01("PATIENTS","PCP") D
"RTN","RORX009C",206,0)
 . . . . . D ADDVAL^RORTSK11(RORTSK,"PCP",$P(BUF,U,8),ITEM,1)
"RTN","RORX009C",207,0)
 ;--- Summary
"RTN","RORX009C",208,0)
 D ADDVAL^RORTSK11(RORTSK,"NP",+$G(@NODE@("OP")),SECTION)
"RTN","RORX009C",209,0)
 D ADDVAL^RORTSK11(RORTSK,"OPNRX",+$G(@NODE@("OPRX")),SECTION)
"RTN","RORX009C",210,0)
 D ADDVAL^RORTSK11(RORTSK,"ND",+$G(@NODE@("OPD")),SECTION)
"RTN","RORX009C",211,0)
 Q 0
"RTN","RORX009C",212,0)
 ;
"RTN","RORX009C",213,0)
 ;***** SUMMARY DATA
"RTN","RORX009C",214,0)
 ;
"RTN","RORX009C",215,0)
 ; PRNTELMT      IEN of the parent element
"RTN","RORX009C",216,0)
 ;
"RTN","RORX009C",217,0)
 ; NODE          Closed root of the category section
"RTN","RORX009C",218,0)
 ;               in the temporary global
"RTN","RORX009C",219,0)
 ;
"RTN","RORX009C",220,0)
 ; Return Values:
"RTN","RORX009C",221,0)
 ;       <0  Error code
"RTN","RORX009C",222,0)
 ;        0  Ok
"RTN","RORX009C",223,0)
 ;
"RTN","RORX009C",224,0)
STORESUM(PRNTELMT,NODE) ;
"RTN","RORX009C",225,0)
 N BUF,DFN,DOD,IPNRX,ITEM,LAST4,MAXUTNUM,NAME,NRX,OPNRX,RC,SECTION,TABLE,TMP,AGETYPE,PCP,PACT,ICN
"RTN","RORX009C",226,0)
 S MAXUTNUM=$$PARAM^RORTSK01("MAXUTNUM")
"RTN","RORX009C",227,0)
 Q:($D(@NODE@("SUMRX"))<10)!(MAXUTNUM'>0) 0
"RTN","RORX009C",228,0)
 ;---
"RTN","RORX009C",229,0)
 S SECTION=$$ADDVAL^RORTSK11(RORTSK,"SUMMARY",,PRNTELMT)
"RTN","RORX009C",230,0)
 Q:SECTION<0 SECTION
"RTN","RORX009C",231,0)
 S RC=0
"RTN","RORX009C",232,0)
 ;--- Patients with highest utlization
"RTN","RORX009C",233,0)
 S TABLE=$$ADDVAL^RORTSK11(RORTSK,"HU_NRX",,SECTION)
"RTN","RORX009C",234,0)
 I TABLE<0  S RC=TABLE  Q
"RTN","RORX009C",235,0)
 D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","HU_NRX")
"RTN","RORX009C",236,0)
 ;---
"RTN","RORX009C",237,0)
 S NRX="",RC=0
"RTN","RORX009C",238,0)
 S AGETYPE=$$PARAM^RORTSK01("AGE_RANGE","TYPE")
"RTN","RORX009C",239,0)
 F  S NRX=$O(@NODE@("SUMRX",NRX),-1)  Q:NRX=""  D  Q:RC
"RTN","RORX009C",240,0)
 . S RC=$$LOOP^RORTSK01()  Q:RC<0
"RTN","RORX009C",241,0)
 . S NAME=""
"RTN","RORX009C",242,0)
 . F  S NAME=$O(@NODE@("SUMRX",NRX,NAME))  Q:NAME=""  D  Q:RC
"RTN","RORX009C",243,0)
 . . S DFN=""
"RTN","RORX009C",244,0)
 . . F  S DFN=$O(@NODE@("SUMRX",NRX,NAME,DFN))  Q:DFN=""  D  Q:RC
"RTN","RORX009C",245,0)
 . . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"PATIENT",,TABLE)
"RTN","RORX009C",246,0)
 . . . S (IPNRX,OPNRX)=0
"RTN","RORX009C",247,0)
 . . . S BUF=$G(@NODE@("OP",DFN))
"RTN","RORX009C",248,0)
 . . . S:BUF'="" LAST4=$P(BUF,U),DOD=$P(BUF,U,3),OPNRX=$P(BUF,U,4),ICN=$P(BUF,U,6),PACT=$P(BUF,U,7),PCP=$P(BUF,U,8),AGE=$P(BUF,U,9)
"RTN","RORX009C",249,0)
 . . . S BUF=$G(@NODE@("IP",DFN))
"RTN","RORX009C",250,0)
 . . . S:BUF'="" LAST4=$P(BUF,U),DOD=$P(BUF,U,3),IPNRX=$P(BUF,U,4),ICN=$P(BUF,U,6),PACT=$P(BUF,U,7),PCP=$P(BUF,U,8),AGE=$P(BUF,U,9)
"RTN","RORX009C",251,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"NAME",NAME,ITEM,1)
"RTN","RORX009C",252,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"LAST4",LAST4,ITEM,2)
"RTN","RORX009C",253,0)
 . . . I AGETYPE'="ALL" D ADDVAL^RORTSK11(RORTSK,AGETYPE,AGE,ITEM,1)
"RTN","RORX009C",254,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"DOD",DOD,ITEM,1)
"RTN","RORX009C",255,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"OPNRX",OPNRX,ITEM,3)
"RTN","RORX009C",256,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"IPNRX",IPNRX,ITEM,3)
"RTN","RORX009C",257,0)
 . . . S TMP=+$G(@NODE@("SUMRX",NRX,NAME,DFN))
"RTN","RORX009C",258,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"ND",TMP,ITEM,3)
"RTN","RORX009C",259,0)
 . . . I $$PARAM^RORTSK01("PATIENTS","ICN") D
"RTN","RORX009C",260,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"ICN",ICN,ITEM,1)
"RTN","RORX009C",261,0)
 . . . I $$PARAM^RORTSK01("PATIENTS","PACT") D
"RTN","RORX009C",262,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"PACT",PACT,ITEM,1)
"RTN","RORX009C",263,0)
 . . . I $$PARAM^RORTSK01("PATIENTS","PCP") D
"RTN","RORX009C",264,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"PCP",PCP,ITEM,1)
"RTN","RORX009C",265,0)
 ;---
"RTN","RORX009C",266,0)
 Q 0
"RTN","RORX010")
0^55^B75093403^B61839287
"RTN","RORX010",1,0)
RORX010 ;HOIFO/SG,VAC - LAB TESTS BY RANGE REPORT ;4/7/09 2:08pm
"RTN","RORX010",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**8,13,19,21,31**;Feb 17, 2006;Build 62
"RTN","RORX010",3,0)
 ;
"RTN","RORX010",4,0)
 ; This routine uses the following IAs:
"RTN","RORX010",5,0)
 ;
"RTN","RORX010",6,0)
 ; #2056  GETS^DIQ (supported)
"RTN","RORX010",7,0)
 ; #10103 FMADD^XLFDT (supported)
"RTN","RORX010",8,0)
 ;
"RTN","RORX010",9,0)
 ;******************************************************************************
"RTN","RORX010",10,0)
 ;******************************************************************************
"RTN","RORX010",11,0)
 ;                 --- ROUTINE MODIFICATION LOG ---
"RTN","RORX010",12,0)
 ;        
"RTN","RORX010",13,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORX010",14,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","RORX010",15,0)
 ;ROR*1.5*8    MAR  2010   V CARR       Modified to handle ICD9 filter for
"RTN","RORX010",16,0)
 ;                                      'include' or 'exclude'.
"RTN","RORX010",17,0)
 ;ROR*1.5*13   DEC  2010   A SAUNDERS   User can select specific patients,
"RTN","RORX010",18,0)
 ;                                      clinics, or divisions for the report.
"RTN","RORX010",19,0)
 ;ROR*1.5*19   FEB  2012   K GUPTA      Support for ICD-10 Coding System
"RTN","RORX010",20,0)
 ;ROR*1.5*21   SEP 2013    T KOPP       Added ICN as last report column if
"RTN","RORX010",21,0)
 ;                                      additional identifier option selected
"RTN","RORX010",22,0)
 ;ROR*1.5*31   MAY 2017    M FERRARESE  Adding PACT, PCP, and AGE/DOB as additional identifiers.
"RTN","RORX010",23,0)
 ;                                      Fixing the ICN and PCP at the end of the 
"RTN","RORX010",24,0)
 ;                                      Highest Combined OP and IP Utilization Summary panel
"RTN","RORX010",25,0)
 ;******************************************************************************
"RTN","RORX010",26,0)
 ;******************************************************************************
"RTN","RORX010",27,0)
 Q
"RTN","RORX010",28,0)
 ;
"RTN","RORX010",29,0)
 ;***** OUTPUTS THE REPORT HEADER
"RTN","RORX010",30,0)
 ;
"RTN","RORX010",31,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX010",32,0)
 ;
"RTN","RORX010",33,0)
 ; Return Values:
"RTN","RORX010",34,0)
 ;       <0  Error code
"RTN","RORX010",35,0)
 ;        0  Ok
"RTN","RORX010",36,0)
 ;
"RTN","RORX010",37,0)
HEADER(PARTAG) ;
"RTN","RORX010",38,0)
 ;;PATIENTS(#,NAME,LAST4,DOD,ICN,PACT,PCP,PTLRL(GROUP,DATE,NAME,RESULT))^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="ALL"
"RTN","RORX010",39,0)
 ;;PATIENTS(#,NAME,LAST4,AGE,DOD,ICN,PACT,PCP,PTLRL(GROUP,DATE,NAME,RESULT))^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="AGE"
"RTN","RORX010",40,0)
 ;;PATIENTS(#,NAME,LAST4,DOB,DOD,ICN,PACT,PCP,PTLRL(GROUP,DATE,NAME,RESULT))^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="DOB"
"RTN","RORX010",41,0)
 ; 
"RTN","RORX010",42,0)
 N COLUMNS,HEADER,LT,NAME,TMP
"RTN","RORX010",43,0)
 S HEADER=$$HEADER^RORXU002(.RORTSK,PARTAG)
"RTN","RORX010",44,0)
 Q:HEADER<0 HEADER
"RTN","RORX010",45,0)
 S RC=$$TBLDEF^RORXU002("HEADER^RORX010",HEADER)
"RTN","RORX010",46,0)
 Q $S(RC<0:RC,1:HEADER)
"RTN","RORX010",47,0)
 ;
"RTN","RORX010",48,0)
 ;***** COMPILES THE LAB TESTS BY RANGE REPORT
"RTN","RORX010",49,0)
 ; REPORT CODE: 010
"RTN","RORX010",50,0)
 ;
"RTN","RORX010",51,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORX010",52,0)
 ;
"RTN","RORX010",53,0)
 ; The ^TMP("RORX010",$J) global node is used by this function.
"RTN","RORX010",54,0)
 ;
"RTN","RORX010",55,0)
 ; Return Values:
"RTN","RORX010",56,0)
 ;       <0  Error code
"RTN","RORX010",57,0)
 ;        0  Ok
"RTN","RORX010",58,0)
 ;
"RTN","RORX010",59,0)
LRGRANGE(RORTSK) ;
"RTN","RORX010",60,0)
 N RORDST        ; Callback descriptor
"RTN","RORX010",61,0)
 N ROREDT        ; End date
"RTN","RORX010",62,0)
 N ROREDT1       ; End date + 1 day
"RTN","RORX010",63,0)
 N RORLTL        ; Closed root of the list of lab tests to search for
"RTN","RORX010",64,0)
 N RORREG        ; Registry IEN
"RTN","RORX010",65,0)
 N RORSDT        ; Start date
"RTN","RORX010",66,0)
 N RORCDLIST     ; Flag to indicate whether a clinic or division list exists
"RTN","RORX010",67,0)
 N RORCDSTDT     ; Start date for clinic/division utilization search
"RTN","RORX010",68,0)
 N RORCDENDT     ; End date for clinic/division utilization search
"RTN","RORX010",69,0)
 ;
"RTN","RORX010",70,0)
 N BODY,CNT,ECNT,IEN,IENS,LRGLST,RC,REPORT,RORPTN,SFLAGS,TMP
"RTN","RORX010",71,0)
 N DFN,RCC,FLAG
"RTN","RORX010",72,0)
 ;--- Root node of the report
"RTN","RORX010",73,0)
 S REPORT=$$ADDVAL^RORTSK11(RORTSK,"REPORT")
"RTN","RORX010",74,0)
 Q:REPORT<0 REPORT
"RTN","RORX010",75,0)
 ;
"RTN","RORX010",76,0)
 ;--- Get and prepare the report parameters
"RTN","RORX010",77,0)
 S RORREG=+$$PARAM^RORTSK01("REGIEN")
"RTN","RORX010",78,0)
 S RC=$$PARAMS(REPORT,.SFLAGS,.LRGLST)  Q:RC<0 RC
"RTN","RORX010",79,0)
 ;
"RTN","RORX010",80,0)
 ;--- Initialize constants and variables
"RTN","RORX010",81,0)
 S RORPTN=$$REGSIZE^RORUTL02(+RORREG)  S:RORPTN<0 RORPTN=0
"RTN","RORX010",82,0)
 S ROREDT1=$$FMADD^XLFDT(ROREDT\1,1),ECNT=0
"RTN","RORX010",83,0)
 K ^TMP("RORX010",$J)
"RTN","RORX010",84,0)
 S RORLTL=$$ALLOC^RORTMP()
"RTN","RORX010",85,0)
 ;
"RTN","RORX010",86,0)
 ;--- Prepare the search parameters
"RTN","RORX010",87,0)
 S RORDST=$NA(^TMP("RORX010",$J))
"RTN","RORX010",88,0)
 S RORDST("RORCB")="$$LTCB^RORX010"
"RTN","RORX010",89,0)
 S RC=$$LOADTSTS^RORUTL10(RORLTL,+RORREG,LRGLST)
"RTN","RORX010",90,0)
 ;
"RTN","RORX010",91,0)
 ;--- Report header and list of patients
"RTN","RORX010",92,0)
 S RC=$$HEADER(REPORT)  G:RC<0 ERROR
"RTN","RORX010",93,0)
 S BODY=$$ADDVAL^RORTSK11(RORTSK,"PATIENTS",,REPORT)
"RTN","RORX010",94,0)
 I BODY<0  S RC=+BODY  G ERROR
"RTN","RORX010",95,0)
 D ADDATTR^RORTSK11(RORTSK,BODY,"TABLE","PATIENTS")
"RTN","RORX010",96,0)
 ;
"RTN","RORX010",97,0)
 ;=== Set up Clinic/Division list parameters
"RTN","RORX010",98,0)
 S RORCDLIST=$$CDPARMS^RORXU001(.RORTSK,.RORCDSTDT,.RORCDENDT)
"RTN","RORX010",99,0)
 ;
"RTN","RORX010",100,0)
 ;--- Browse through the registry records
"RTN","RORX010",101,0)
 S (CNT,IEN,RC)=0
"RTN","RORX010",102,0)
 S FLAG=$G(RORTSK("PARAMS","ICDFILT","A","FILTER"))
"RTN","RORX010",103,0)
 F  S IEN=$O(^RORDATA(798,"AC",RORREG,IEN))  Q:IEN'>0  D  Q:RC<0
"RTN","RORX010",104,0)
 . S TMP=$S(RORPTN>0:CNT/RORPTN,1:"")
"RTN","RORX010",105,0)
 . S RC=$$LOOP^RORTSK01(TMP)  Q:RC<0
"RTN","RORX010",106,0)
 . S IENS=IEN_",",CNT=CNT+1
"RTN","RORX010",107,0)
 . ;--- Get patient DFN
"RTN","RORX010",108,0)
 . S DFN=$$PTIEN^RORUTL01(IEN) Q:DFN'>0
"RTN","RORX010",109,0)
 . ;--- Check for patient list and quit if not on list
"RTN","RORX010",110,0)
 . I $D(RORTSK("PARAMS","PATIENTS","C")),'$D(RORTSK("PARAMS","PATIENTS","C",DFN)) Q
"RTN","RORX010",111,0)
 . ;--- Check if the patient should be skipped
"RTN","RORX010",112,0)
 . Q:$$SKIP^RORXU005(IEN,SFLAGS,RORSDT,ROREDT)
"RTN","RORX010",113,0)
 . ;--- Check pateint against ICD Filter
"RTN","RORX010",114,0)
 . S RCC=0
"RTN","RORX010",115,0)
 . I FLAG'="ALL" D
"RTN","RORX010",116,0)
 . . S RCC=$$ICD^RORXU010(DFN)
"RTN","RORX010",117,0)
 . I (FLAG="INCLUDE")&(RCC=0) Q
"RTN","RORX010",118,0)
 . I (FLAG="EXCLUDE")&(RCC=1) Q
"RTN","RORX010",119,0)
 . ;--- End of ICD Check
"RTN","RORX010",120,0)
 . ;--- Check for Clinic or Division list and quit if not in list
"RTN","RORX010",121,0)
 . I RORCDLIST,'$$CDUTIL^RORXU001(.RORTSK,DFN,RORCDSTDT,RORCDENDT) Q
"RTN","RORX010",122,0)
 . ;--- Process the registry record
"RTN","RORX010",123,0)
 . I $$PATIENT(IENS,BODY)<0  S ECNT=ECNT+1  Q
"RTN","RORX010",124,0)
 ;
"RTN","RORX010",125,0)
ERROR ;--- Cleanup
"RTN","RORX010",126,0)
 D FREE^RORTMP(RORLTL)
"RTN","RORX010",127,0)
 K ^TMP("RORX010",$J)
"RTN","RORX010",128,0)
 Q $S(RC<0:RC,ECNT>0:-43,1:0)
"RTN","RORX010",129,0)
 ;
"RTN","RORX010",130,0)
 ;***** CALLBACK FUNCTION FOR LAB DATA SEARCH
"RTN","RORX010",131,0)
LTCB(RORDST,INVDT,RESULT) ;
"RTN","RORX010",132,0)
 N GRP,NODE,RC,VAL
"RTN","RORX010",133,0)
 S NODE=$NA(RORTSK("PARAMS","LRGRANGES","C"))
"RTN","RORX010",134,0)
 S GRP=+$P($G(RESULT(2)),U,3)
"RTN","RORX010",135,0)
 ;--- Check the result range if necessary
"RTN","RORX010",136,0)
 I $D(@NODE@(GRP))>1  S RC=1  D  Q:RC RC
"RTN","RORX010",137,0)
 . S VAL=$$CLRNMVAL^RORUTL18($P($G(RESULT(1)),U,3))
"RTN","RORX010",138,0)
 . ;--- Skip a non-numeric result
"RTN","RORX010",139,0)
 . Q:'$$NUMERIC^RORUTL05(VAL)
"RTN","RORX010",140,0)
 . ;--- Check the range
"RTN","RORX010",141,0)
 . I $G(@NODE@(GRP,"L"))'=""  Q:VAL<@NODE@(GRP,"L")
"RTN","RORX010",142,0)
 . I $G(@NODE@(GRP,"H"))'=""  Q:VAL>@NODE@(GRP,"H")
"RTN","RORX010",143,0)
 . S RC=0
"RTN","RORX010",144,0)
 ;--- Store the result
"RTN","RORX010",145,0)
 K RORDST("GRP",GRP)
"RTN","RORX010",146,0)
 S RORDST("RORPTR")=$G(RORDST("RORPTR"))+1
"RTN","RORX010",147,0)
 M @RORDST@(RORDST("RORPTR"))=RESULT
"RTN","RORX010",148,0)
 Q 0
"RTN","RORX010",149,0)
 ;
"RTN","RORX010",150,0)
 ;***** OUTPUTS THE REPORT PARAMETERS
"RTN","RORX010",151,0)
 ;
"RTN","RORX010",152,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX010",153,0)
 ;
"RTN","RORX010",154,0)
 ; .FLAGS        Flags for the $$SKIP^RORXU005 are
"RTN","RORX010",155,0)
 ;               returned via this parameter
"RTN","RORX010",156,0)
 ;
"RTN","RORX010",157,0)
 ; .LRGLST       List of lab group codes for the $$LOADTSTS^RORUTL10
"RTN","RORX010",158,0)
 ;
"RTN","RORX010",159,0)
 ; Return Values:
"RTN","RORX010",160,0)
 ;       <0  Error code
"RTN","RORX010",161,0)
 ;        0  Ok
"RTN","RORX010",162,0)
 ;
"RTN","RORX010",163,0)
PARAMS(PARTAG,FLAGS,LRGLST) ;
"RTN","RORX010",164,0)
 N PARAMS,TMP
"RTN","RORX010",165,0)
 S (FLAGS,LRGLST)=""
"RTN","RORX010",166,0)
 S PARAMS=$$PARAMS^RORXU002(.RORTSK,PARTAG,.RORSDT,.ROREDT,.FLAGS)
"RTN","RORX010",167,0)
 Q:PARAMS<0 PARAMS
"RTN","RORX010",168,0)
 ;--- Lab test ranges
"RTN","RORX010",169,0)
 I $D(RORTSK("PARAMS","LRGRANGES","C"))>1  D  Q:RC<0 RC
"RTN","RORX010",170,0)
 . N GRC,ELEMENT,NODE,LRGELMTS,RANGE
"RTN","RORX010",171,0)
 . S NODE=$NA(RORTSK("PARAMS","LRGRANGES","C"))
"RTN","RORX010",172,0)
 . S LRGELMTS=$$ADDVAL^RORTSK11(RORTSK,"LRGRANGES",,PARAMS)
"RTN","RORX010",173,0)
 . S (GRC,RC)=0
"RTN","RORX010",174,0)
 . F  S GRC=$O(@NODE@(GRC))  Q:GRC'>0  D  Q:RC<0
"RTN","RORX010",175,0)
 . . S RANGE=0,TMP=$$RANGE(GRC)
"RTN","RORX010",176,0)
 . . S ELEMENT=$$ADDVAL^RORTSK11(RORTSK,"LRGRANGE",TMP,LRGELMTS)
"RTN","RORX010",177,0)
 . . I ELEMENT<0  S RC=ELEMENT  Q
"RTN","RORX010",178,0)
 . . D ADDATTR^RORTSK11(RORTSK,ELEMENT,"ID",GRC)
"RTN","RORX010",179,0)
 . . S LRGLST=LRGLST_$S(LRGLST'="":","_GRC,1:GRC)
"RTN","RORX010",180,0)
 . . ;--- Process the range values
"RTN","RORX010",181,0)
 . . S TMP=$G(@NODE@(GRC,"L"))
"RTN","RORX010",182,0)
 . . I TMP'=""  D  S RANGE=1
"RTN","RORX010",183,0)
 . . . D ADDATTR^RORTSK11(RORTSK,ELEMENT,"LOW",TMP)
"RTN","RORX010",184,0)
 . . S TMP=$G(@NODE@(GRC,"H"))
"RTN","RORX010",185,0)
 . . I TMP'=""  D  S RANGE=1
"RTN","RORX010",186,0)
 . . . D ADDATTR^RORTSK11(RORTSK,ELEMENT,"HIGH",TMP)
"RTN","RORX010",187,0)
 . . D:RANGE ADDATTR^RORTSK11(RORTSK,ELEMENT,"RANGE",1)
"RTN","RORX010",188,0)
 ;--- Success
"RTN","RORX010",189,0)
 Q PARAMS
"RTN","RORX010",190,0)
 ;
"RTN","RORX010",191,0)
 ;***** ADDS THE PATIENT DATA TO THE REPORT
"RTN","RORX010",192,0)
 ;
"RTN","RORX010",193,0)
 ; IENS          IENS of the patient's record in the registry
"RTN","RORX010",194,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX010",195,0)
 ;
"RTN","RORX010",196,0)
 ; Return Values:
"RTN","RORX010",197,0)
 ;       <0  Error code
"RTN","RORX010",198,0)
 ;        0  Ok
"RTN","RORX010",199,0)
 ;
"RTN","RORX010",200,0)
PATIENT(IENS,PARTAG) ;
"RTN","RORX010",201,0)
 N DFN,I,LABTESTS,LT,NAME,PTAG,RC,RORBUF,RORMSG,TMP,VA,VADM,RORPACT,RORPCP,AGE,AGETYPE
"RTN","RORX010",202,0)
 ;--- Get the data from the ROR REGISTRY RECORD file
"RTN","RORX010",203,0)
 K RORMSG D GETS^DIQ(798,IENS,".01","I","RORBUF","RORMSG")
"RTN","RORX010",204,0)
 ;Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,798,IENS)
"RTN","RORX010",205,0)
 Q:$G(RORMSG("DIERR")) $$DBS^RORERR("RORMSG",-9,,,798,IENS)
"RTN","RORX010",206,0)
 S DFN=$G(RORBUF(798,IENS,.01,"I"))
"RTN","RORX010",207,0)
 ;--- Search for the lab results
"RTN","RORX010",208,0)
 K @RORDST,RORDST("RORPTR")
"RTN","RORX010",209,0)
 M RORDST("GRP")=RORTSK("PARAMS","LRGRANGES","C")
"RTN","RORX010",210,0)
 S RC=$$LTSEARCH^RORUTL10(DFN,RORLTL,.RORDST,,RORSDT,ROREDT1)
"RTN","RORX010",211,0)
 Q:RC'>0 RC
"RTN","RORX010",212,0)
 ;--- Results from all groups should be present
"RTN","RORX010",213,0)
 Q:$D(RORDST("GRP"))>1 0
"RTN","RORX010",214,0)
 ;--- Load the demographic data
"RTN","RORX010",215,0)
 D VADEM^RORUTL05(DFN,1)
"RTN","RORX010",216,0)
 ;--- The <PATIENT> tag
"RTN","RORX010",217,0)
 S PTAG=$$ADDVAL^RORTSK11(RORTSK,"PATIENT",,PARTAG,,DFN)
"RTN","RORX010",218,0)
 Q:PTAG<0 PTAG
"RTN","RORX010",219,0)
 ;--- Patient Name
"RTN","RORX010",220,0)
 D ADDVAL^RORTSK11(RORTSK,"NAME",VADM(1),PTAG,1)
"RTN","RORX010",221,0)
 ;--- Last 4 digits of the SSN
"RTN","RORX010",222,0)
 D ADDVAL^RORTSK11(RORTSK,"LAST4",VA("BID"),PTAG,2)
"RTN","RORX010",223,0)
 ;--- Age/DOB
"RTN","RORX010",224,0)
 S AGETYPE=$$PARAM^RORTSK01("AGE_RANGE","TYPE")
"RTN","RORX010",225,0)
 S AGE=$S(AGETYPE="AGE":$P(VADM(4),U),AGETYPE="DOB":$$DATE^RORXU002($P(VADM(3),U)\1),1:"")
"RTN","RORX010",226,0)
 I AGETYPE'="ALL" D ADDVAL^RORTSK11(RORTSK,AGETYPE,AGE,PTAG,1)
"RTN","RORX010",227,0)
 ;--- Date of death
"RTN","RORX010",228,0)
 S TMP=$$DATE^RORXU002($P(VADM(6),U)\1)
"RTN","RORX010",229,0)
 D ADDVAL^RORTSK11(RORTSK,"DOD",TMP,PTAG,1)
"RTN","RORX010",230,0)
 I $$PARAM^RORTSK01("PATIENTS","ICN") D
"RTN","RORX010",231,0)
 . S TMP=$$ICN^RORUTL02(DFN)
"RTN","RORX010",232,0)
 . D ADDVAL^RORTSK11(RORTSK,"ICN",TMP,PTAG,1)
"RTN","RORX010",233,0)
 I $$PARAM^RORTSK01("PATIENTS","PACT") S RORPACT="" D
"RTN","RORX010",234,0)
 . S RORPACT=$$PACT^RORUTL02(DFN) D ADDVAL^RORTSK11(RORTSK,"PACT",RORPACT,PTAG,1)
"RTN","RORX010",235,0)
 ;
"RTN","RORX010",236,0)
 I $$PARAM^RORTSK01("PATIENTS","PCP") S RORPCP="" D
"RTN","RORX010",237,0)
 . S RORPCP=$$PCP^RORUTL02(DFN) D ADDVAL^RORTSK11(RORTSK,"PCP",RORPCP,PTAG,1)
"RTN","RORX010",238,0)
 ;--- Lab results
"RTN","RORX010",239,0)
 S LABTESTS=$$ADDVAL^RORTSK11(RORTSK,"PTLRL",,PTAG)
"RTN","RORX010",240,0)
 S I=""
"RTN","RORX010",241,0)
 F  S I=$O(@RORDST@(I))  Q:I=""  D
"RTN","RORX010",242,0)
 . S LT=$$ADDVAL^RORTSK11(RORTSK,"LT",,LABTESTS)
"RTN","RORX010",243,0)
 . D ADDVAL^RORTSK11(RORTSK,"GROUP",$P(@RORDST@(I,2),U,4),LT,1)
"RTN","RORX010",244,0)
 . D ADDVAL^RORTSK11(RORTSK,"DATE",$P(@RORDST@(I,1),U,2),LT,1)
"RTN","RORX010",245,0)
 . D ADDVAL^RORTSK11(RORTSK,"NAME",$P(@RORDST@(I,2),U,2),LT,1)
"RTN","RORX010",246,0)
 . D ADDVAL^RORTSK11(RORTSK,"RESULT",$P(@RORDST@(I,1),U,3),LT,3)
"RTN","RORX010",247,0)
 ;---
"RTN","RORX010",248,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORX010",249,0)
 ;
"RTN","RORX010",250,0)
 ;***** PROCESSES THE RESULT RANGE OPTIONS
"RTN","RORX010",251,0)
 ;
"RTN","RORX010",252,0)
 ; GRC           Code of a Lab Group
"RTN","RORX010",253,0)
 ;
"RTN","RORX010",254,0)
 ; Return Values:
"RTN","RORX010",255,0)
 ;       Description of the Lab results to be included in the report.
"RTN","RORX010",256,0)
 ;
"RTN","RORX010",257,0)
RANGE(GRC) ;
"RTN","RORX010",258,0)
 N RANGE,TMP
"RTN","RORX010",259,0)
 S RANGE=""
"RTN","RORX010",260,0)
 ;--- Range
"RTN","RORX010",261,0)
 D:$D(RORTSK("PARAMS","LRGRANGES","C",GRC))>1
"RTN","RORX010",262,0)
 . ;--- Low
"RTN","RORX010",263,0)
 . S TMP=$G(RORTSK("PARAMS","LRGRANGES","C",GRC,"L"))
"RTN","RORX010",264,0)
 . S:TMP'="" RANGE=RANGE_" not less than "_TMP
"RTN","RORX010",265,0)
 . ;--- High
"RTN","RORX010",266,0)
 . S TMP=$G(RORTSK("PARAMS","LRGRANGES","C",GRC,"H"))
"RTN","RORX010",267,0)
 . I TMP'=""  D:RANGE'=""  S RANGE=RANGE_" not greater than "_TMP
"RTN","RORX010",268,0)
 . . S RANGE=RANGE_" and"
"RTN","RORX010",269,0)
 ;--- Description
"RTN","RORX010",270,0)
 S TMP=$G(RORTSK("PARAMS","LRGRANGES","C",GRC))
"RTN","RORX010",271,0)
 S:TMP="" TMP="Unknown ("_GRC_")"
"RTN","RORX010",272,0)
 Q TMP_" - "_$S(RANGE'="":"numeric results"_RANGE,1:"all results")
"RTN","RORX011")
0^24^B104112495^B100694826
"RTN","RORX011",1,0)
RORX011 ;HOIFO/SG,VAC - PATIENT MEDICATION HISTORY ;4/17/09 10:45am
"RTN","RORX011",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**1,8,13,19,21,31**;Feb 17, 2006;Build 62
"RTN","RORX011",3,0)
 ;
"RTN","RORX011",4,0)
 ; This routine uses the following IAs:
"RTN","RORX011",5,0)
 ;
"RTN","RORX011",6,0)
 ; #10103 DT^XLFDT, FMADD^XLFDT (supported)
"RTN","RORX011",7,0)
 ;    
"RTN","RORX011",8,0)
 ;******************************************************************************
"RTN","RORX011",9,0)
 ;******************************************************************************
"RTN","RORX011",10,0)
 ;                 --- ROUTINE MODIFICATION LOG ---
"RTN","RORX011",11,0)
 ;        
"RTN","RORX011",12,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORX011",13,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","RORX011",14,0)
 ;ROR*1.5*8    MAR  2010   V CARR       Modified to handle ICD9 filter for
"RTN","RORX011",15,0)
 ;                                      'include' or 'exclude'.
"RTN","RORX011",16,0)
 ;ROR*1.5*13   DEC  2010   A SAUNDERS   Added #refills remaining and logic
"RTN","RORX011",17,0)
 ;                                      to include only most recent fills
"RTN","RORX011",18,0)
 ;                                      NOTE: Patch 11 became patch 13.
"RTN","RORX011",19,0)
 ;                                      Any references to patch 11 in the code
"RTN","RORX011",20,0)
 ;                                      below is referring to path 13.
"RTN","RORX011",21,0)
 ;ROR*1.5*19   FEB  2012   K GUPTA      Support for ICD-10 Coding System
"RTN","RORX011",22,0)
 ;ROR*1.5*21   SEP 2013    T KOPP       Added ICN as last report column if
"RTN","RORX011",23,0)
 ;                                      additional identifier option selected
"RTN","RORX011",24,0)
 ;ROR*1.5*31   MAY 2017    M FERRARESE  Adding PACT and PCP as additional identifiers.
"RTN","RORX011",25,0)
 ;******************************************************************************
"RTN","RORX011",26,0)
 ;******************************************************************************
"RTN","RORX011",27,0)
 Q
"RTN","RORX011",28,0)
 ;
"RTN","RORX011",29,0)
 ;***** OUTPUTS THE REPORT HEADER
"RTN","RORX011",30,0)
 ;
"RTN","RORX011",31,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX011",32,0)
 ;
"RTN","RORX011",33,0)
 ; Return Values:
"RTN","RORX011",34,0)
 ;       <0  Error code
"RTN","RORX011",35,0)
 ;       >0  IEN of the HEADER element
"RTN","RORX011",36,0)
 ;
"RTN","RORX011",37,0)
HEADER(PARTAG) ;
"RTN","RORX011",38,0)
 ;;PATIENTS(#,NAME,LAST4,DOB,AGE,DOD,ICN,PACT,PCP)
"RTN","RORX011",39,0)
 ;;PTRXL(DATE,ORDER,TYPE,NAME,GENERIC,DAYSPLY,FILLTYPE,REFILLS)
"RTN","RORX011",40,0)
 ;REFILLS added to column headers (above) - Patch 11
"RTN","RORX011",41,0)
 N HEADER,NOTES,RC
"RTN","RORX011",42,0)
 S HEADER=$$HEADER^RORXU002(.RORTSK,PARTAG)
"RTN","RORX011",43,0)
 Q:HEADER<0 HEADER
"RTN","RORX011",44,0)
 S NOTES=$$ADDVAL^RORTSK11(RORTSK,"NOTES",,HEADER)
"RTN","RORX011",45,0)
 D ADDVAL^RORTSK11(RORTSK,"AGE",$$DT^XLFDT,NOTES)
"RTN","RORX011",46,0)
 S RC=$$TBLDEF^RORXU002("HEADER^RORX011",HEADER)
"RTN","RORX011",47,0)
 Q $S(RC<0:RC,1:HEADER)
"RTN","RORX011",48,0)
 ;
"RTN","RORX011",49,0)
 ;***** OUTPUTS THE PARAMETERS TO THE REPORT
"RTN","RORX011",50,0)
 ;
"RTN","RORX011",51,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX011",52,0)
 ;
"RTN","RORX011",53,0)
 ; [.STDT]       Start and end dates of the report
"RTN","RORX011",54,0)
 ; [.ENDT]       are returned via these parameters
"RTN","RORX011",55,0)
 ; [.FLAGS]      Flags for the $$SKIP^RORXU005 are returned via this parameter
"RTN","RORX011",56,0)
 ;
"RTN","RORX011",57,0)
 ; Return Values:
"RTN","RORX011",58,0)
 ;       <0  Error code
"RTN","RORX011",59,0)
 ;       >0  IEN of the PARAMETERS element
"RTN","RORX011",60,0)
 ;
"RTN","RORX011",61,0)
PARAMS(PARTAG,STDT,ENDT,FLAGS) ;
"RTN","RORX011",62,0)
 N PARAMS,TMP
"RTN","RORX011",63,0)
 S PARAMS=$$PARAMS^RORXU002(.RORTSK,PARTAG,.STDT,.ENDT,.FLAGS)
"RTN","RORX011",64,0)
 Q:PARAMS<0 PARAMS
"RTN","RORX011",65,0)
 ;--- Process the drug list and options
"RTN","RORX011",66,0)
 S TMP=$$DRUGLST^RORXU007(.RORTSK,PARAMS,.RORXL,.RORXGRP)
"RTN","RORX011",67,0)
 Q:TMP<0 TMP
"RTN","RORX011",68,0)
 ;
"RTN","RORX011",69,0)
 Q PARAMS
"RTN","RORX011",70,0)
 ;
"RTN","RORX011",71,0)
 ;***** PROCESS THE PATIENT'S DATA
"RTN","RORX011",72,0)
 ;
"RTN","RORX011",73,0)
 ; PTLIST        Reference (IEN) to the parent tag
"RTN","RORX011",74,0)
 ; PATIEN        Patient IEN in the file #2 (DFN)
"RTN","RORX011",75,0)
 ; RORXDST       Patient's Medication History data
"RTN","RORX011",76,0)
 ;
"RTN","RORX011",77,0)
 ; Return Values:
"RTN","RORX011",78,0)
 ;       <0  Error code
"RTN","RORX011",79,0)
 ;        0  Ok
"RTN","RORX011",80,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX011",81,0)
 ;
"RTN","RORX011",82,0)
PATIENT(PTLIST,PATIEN,RORXDST) ;
"RTN","RORX011",83,0)
 N BUF,FLT,FLTL,FQL,ITEM,NODE,PTAG,QSB,RC,TABLE,VA,VADM,VAERR
"RTN","RORX011",84,0)
 S (ECNT,RC)=0
"RTN","RORX011",85,0)
 ;--- Patient data
"RTN","RORX011",86,0)
 S PTAG=$$ADDVAL^RORTSK11(RORTSK,"PATIENT",,PTLIST,,PATIEN)
"RTN","RORX011",87,0)
 Q:PTAG<0 PTAG
"RTN","RORX011",88,0)
 D VADEM^RORUTL05(PATIEN,1)
"RTN","RORX011",89,0)
 D ADDVAL^RORTSK11(RORTSK,"NAME",VADM(1),PTAG,1)
"RTN","RORX011",90,0)
 D ADDVAL^RORTSK11(RORTSK,"LAST4",VA("BID"),PTAG,2)
"RTN","RORX011",91,0)
 D ADDVAL^RORTSK11(RORTSK,"DOB",$$DATE^RORXU002(VADM(3)\1),PTAG,1)
"RTN","RORX011",92,0)
 D ADDVAL^RORTSK11(RORTSK,"AGE",VADM(4),PTAG,3)
"RTN","RORX011",93,0)
 D ADDVAL^RORTSK11(RORTSK,"DOD",$$DATE^RORXU002(VADM(6)\1),PTAG,1)
"RTN","RORX011",94,0)
 I $$PARAM^RORTSK01("PATIENTS","ICN") D
"RTN","RORX011",95,0)
 . D ADDVAL^RORTSK11(RORTSK,"ICN",$$ICN^RORUTL02(PATIEN),PTAG,1)
"RTN","RORX011",96,0)
 I $$PARAM^RORTSK01("PATIENTS","PACT") D
"RTN","RORX011",97,0)
 . D ADDVAL^RORTSK11(RORTSK,"PACT",$$PACT^RORUTL02(PATIEN),PTAG,1)
"RTN","RORX011",98,0)
 I $$PARAM^RORTSK01("PATIENTS","PCP") D
"RTN","RORX011",99,0)
 . D ADDVAL^RORTSK11(RORTSK,"PCP",$$PCP^RORUTL02(PATIEN),PTAG,1)
"RTN","RORX011",100,0)
 ;--- List of drugs
"RTN","RORX011",101,0)
 S TABLE=$$ADDVAL^RORTSK11(RORTSK,"PTRXL",,PTAG)
"RTN","RORX011",102,0)
 Q:TABLE<0 TABLE
"RTN","RORX011",103,0)
 D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","PTRXL")
"RTN","RORX011",104,0)
 ;---
"RTN","RORX011",105,0)
 S NODE=RORXDST,FLTL=$L(NODE)-1,FLT=$E(NODE,1,FLTL)
"RTN","RORX011",106,0)
 S QSB=$QL(NODE),FQL=QSB+5
"RTN","RORX011",107,0)
 F  S NODE=$Q(@NODE)  Q:$E(NODE,1,FLTL)'=FLT  D:$QL(NODE)=FQL
"RTN","RORX011",108,0)
 . ; NODE: @RORXDST@(DATE,DRUGNAME,DRUGIEN,RXNUM,RXCNT)
"RTN","RORX011",109,0)
 . S BUF=@NODE
"RTN","RORX011",110,0)
 . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"DRUG",,TABLE)
"RTN","RORX011",111,0)
 . D ADDVAL^RORTSK11(RORTSK,"DATE",$QS(NODE,QSB+1)\1,ITEM,1)
"RTN","RORX011",112,0)
 . D ADDVAL^RORTSK11(RORTSK,"ORDER",$QS(NODE,QSB+4),ITEM,1)
"RTN","RORX011",113,0)
 . S TMP=$P(BUF,U)
"RTN","RORX011",114,0)
 . S TMP=$S(TMP="O":"ORIGINAL",TMP="P":"PARTIAL",TMP="R":"REFILL",1:"")
"RTN","RORX011",115,0)
 . D ADDVAL^RORTSK11(RORTSK,"TYPE",TMP,ITEM,1)
"RTN","RORX011",116,0)
 . D ADDVAL^RORTSK11(RORTSK,"NAME",$QS(NODE,QSB+2),ITEM,1)
"RTN","RORX011",117,0)
 . D ADDVAL^RORTSK11(RORTSK,"GENERIC",$P(BUF,U,4),ITEM,1)
"RTN","RORX011",118,0)
 . D ADDVAL^RORTSK11(RORTSK,"DAYSPLY",$P(BUF,U,5),ITEM,1)
"RTN","RORX011",119,0)
 . S TMP=$P(BUF,U,2)
"RTN","RORX011",120,0)
 . S TMP=$S(TMP="I":"INPATIENT",TMP="M":"MAIL",TMP="W":"WINDOW",1:"")
"RTN","RORX011",121,0)
 . D ADDVAL^RORTSK11(RORTSK,"FILLTYPE",TMP,ITEM,1)
"RTN","RORX011",122,0)
 . D ADDVAL^RORTSK11(RORTSK,"REFILLS",$P(BUF,U,6),ITEM,1) ;number of refills remaining - Patch 11
"RTN","RORX011",123,0)
 ;---
"RTN","RORX011",124,0)
 Q $S(RC<0:RC,1:ECNT)
"RTN","RORX011",125,0)
 ;
"RTN","RORX011",126,0)
 ;***** PROCESSES THE LIST OF PATIENTS
"RTN","RORX011",127,0)
 ;
"RTN","RORX011",128,0)
 ; REPORT        Reference (IEN) to the parent tag
"RTN","RORX011",129,0)
 ;
"RTN","RORX011",130,0)
 ; Return Values:
"RTN","RORX011",131,0)
 ;       <0  Error code
"RTN","RORX011",132,0)
 ;        0  Ok
"RTN","RORX011",133,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX011",134,0)
 ;
"RTN","RORX011",135,0)
PROCESS(REPORT,FLAGS) ;
"RTN","RORX011",136,0)
 N CNT,ECNT,IEN798,PTIEN,PTLIST,PTNODE,RC,RORPTN,RORXDST,RXFLAGS,SKIP,TMP,DFN
"RTN","RORX011",137,0)
 N RORX011 S RORX011=1 ;Patch 11: needed for 'callback' function setup in PROCESS^RORUTL15
"RTN","RORX011",138,0)
 S (CNT,ECNT,RC)=0
"RTN","RORX011",139,0)
 N RCC,FLAG
"RTN","RORX011",140,0)
 N RORCDLIST     ; Flag to indicate whether a clinic or division list exists
"RTN","RORX011",141,0)
 N RORCDSTDT     ; Start date for clinic/division utilization search
"RTN","RORX011",142,0)
 N RORCDENDT     ; End date for clinic/division utilization search
"RTN","RORX011",143,0)
 ;
"RTN","RORX011",144,0)
 ;--- Count patients in the list.  Define which patient 'list' to use: the one 
"RTN","RORX011",145,0)
 ;selected by the user, or all patients in 798
"RTN","RORX011",146,0)
 I RORALL  D  S:RORPTN<0 RORPTN=0
"RTN","RORX011",147,0)
 . S PTNODE=$NA(^RORDATA(798,"ARP",RORREG_"#"))
"RTN","RORX011",148,0)
 . S RORPTN=$$REGSIZE^RORUTL02(+RORREG)
"RTN","RORX011",149,0)
 E  S (PTIEN,RORPTN)=0  D  Q:RORPTN'>0 0
"RTN","RORX011",150,0)
 . S PTNODE=$NA(RORTSK("PARAMS","PATIENTS","C"))
"RTN","RORX011",151,0)
 . F  S PTIEN=$O(@PTNODE@(PTIEN))  Q:PTIEN'>0  S RORPTN=RORPTN+1
"RTN","RORX011",152,0)
 ;---
"RTN","RORX011",153,0)
 S PTLIST=$$ADDVAL^RORTSK11(RORTSK,"PATIENTS",,REPORT)
"RTN","RORX011",154,0)
 Q:PTLIST<0 PTLIST
"RTN","RORX011",155,0)
 ;
"RTN","RORX011",156,0)
 ;--- Prepare parameters for the pharmacy search API
"RTN","RORX011",157,0)
 S RORXDST=$NA(^TMP("RORX011",$J))
"RTN","RORX011",158,0)
 S RORXDST("RORCB")="$$RXSCB^RORX011"
"RTN","RORX011",159,0)
 S RXFLAGS="E"
"RTN","RORX011",160,0)
 S:$$PARAM^RORTSK01("PATIENTS","INPATIENT") RXFLAGS=RXFLAGS_"IV"
"RTN","RORX011",161,0)
 S:$$PARAM^RORTSK01("PATIENTS","OUTPATIENT") RXFLAGS=RXFLAGS_"O"
"RTN","RORX011",162,0)
 ;
"RTN","RORX011",163,0)
 ;=== Set up Clinic/Division list parameters
"RTN","RORX011",164,0)
 S RORCDLIST=$$CDPARMS^RORXU001(.RORTSK,.RORCDSTDT,.RORCDENDT)
"RTN","RORX011",165,0)
 ;
"RTN","RORX011",166,0)
 ;--- Browse through the list of selected patients
"RTN","RORX011",167,0)
 S (CNT,PTIEN)=0
"RTN","RORX011",168,0)
 S FLAG=$G(RORTSK("PARAMS","ICDFILT","A","FILTER"))
"RTN","RORX011",169,0)
 ;
"RTN","RORX011",170,0)
 F  S PTIEN=$O(@PTNODE@(PTIEN))  Q:PTIEN'>0  D  Q:RC<0
"RTN","RORX011",171,0)
 . S RC=$$LOOP^RORTSK01(CNT/RORPTN)  Q:RC<0
"RTN","RORX011",172,0)
 . S CNT=CNT+1,IEN798=$$PRRIEN^RORUTL01(PTIEN,RORREG)  Q:IEN798'>0
"RTN","RORX011",173,0)
 . ;--- Check if the patient should be skipped
"RTN","RORX011",174,0)
 . I RORALL  Q:$$SKIP^RORXU005(IEN798,FLAGS,RORSDT,ROREDT)
"RTN","RORX011",175,0)
 . ;
"RTN","RORX011",176,0)
 . ;--- Check the patient against the ICD Filter
"RTN","RORX011",177,0)
 . S RCC=0
"RTN","RORX011",178,0)
 . I FLAG'="ALL" D
"RTN","RORX011",179,0)
 . . S RCC=$$ICD^RORXU010(PTIEN)
"RTN","RORX011",180,0)
 . I (FLAG="INCLUDE")&(RCC=0) Q
"RTN","RORX011",181,0)
 . I (FLAG="EXCLUDE")&(RCC=1) Q
"RTN","RORX011",182,0)
 . ;--- End of check for ICD Filter
"RTN","RORX011",183,0)
 . ;--- Check for Clinic or Division list and quit if not in list
"RTN","RORX011",184,0)
 . I RORCDLIST,'$$CDUTIL^RORXU001(.RORTSK,PTIEN,RORCDSTDT,RORCDENDT) Q
"RTN","RORX011",185,0)
 . ;--- Search the pharmacy data
"RTN","RORX011",186,0)
 . K @RORXDST
"RTN","RORX011",187,0)
 . S TMP=$$RXSEARCH^RORUTL14(PTIEN,RORXL,.RORXDST,RXFLAGS,RORSDT,ROREDT1)
"RTN","RORX011",188,0)
 . I TMP<0  S ECNT=ECNT+1  Q
"RTN","RORX011",189,0)
 . I RORALL  Q:TMP'>0
"RTN","RORX011",190,0)
 . ;--- If user selected most recent drug fills, remove older duplicates
"RTN","RORX011",191,0)
 . I $$PARAM^RORTSK01("OPTIONS","RECENT_FILLS") D RECENT(RORXDST)
"RTN","RORX011",192,0)
 . ;--- Append the patient's data to the report
"RTN","RORX011",193,0)
 . S TMP=$$PATIENT(PTLIST,PTIEN,RORXDST)
"RTN","RORX011",194,0)
 . I TMP  S ECNT=ECNT+$S(TMP>0:TMP,1:1)  Q
"RTN","RORX011",195,0)
 ;
"RTN","RORX011",196,0)
 ;--- Cleanup
"RTN","RORX011",197,0)
 K @RORXDST
"RTN","RORX011",198,0)
 K ^TMP("RORX011-RESORTED",$J) ;Patch 11
"RTN","RORX011",199,0)
 Q $S(RC<0:RC,1:ECNT)
"RTN","RORX011",200,0)
 ;
"RTN","RORX011",201,0)
 ;***** COMPILES THE "PATIENT DRUG HISTORY" REPORT
"RTN","RORX011",202,0)
 ; REPORT CODE: 011
"RTN","RORX011",203,0)
 ;
"RTN","RORX011",204,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORX011",205,0)
 ;
"RTN","RORX011",206,0)
 ; The ^TMP("RORX011",$J) global node is used by this function.
"RTN","RORX011",207,0)
 ;
"RTN","RORX011",208,0)
 ; Return Values:
"RTN","RORX011",209,0)
 ;       <0  Error code
"RTN","RORX011",210,0)
 ;        0  Ok
"RTN","RORX011",211,0)
 ;
"RTN","RORX011",212,0)
RXHIST(RORTSK) ;
"RTN","RORX011",213,0)
 N RORALL        ; Consider all registry patients
"RTN","RORX011",214,0)
 N ROREDT        ; End date
"RTN","RORX011",215,0)
 N ROREDT1       ; End date + 1
"RTN","RORX011",216,0)
 N RORREG        ; Registry IEN
"RTN","RORX011",217,0)
 N RORSDT        ; Start date
"RTN","RORX011",218,0)
 N RORXGRP       ; List of drug groups
"RTN","RORX011",219,0)
 N RORXL         ; Closed root of the medication list
"RTN","RORX011",220,0)
 ;
"RTN","RORX011",221,0)
 N ECNT,FLAGS,RC,REPORT,TMP
"RTN","RORX011",222,0)
 S RORXL="",(ECNT,RC)=0
"RTN","RORX011",223,0)
 K ^TMP("RORX011",$J)
"RTN","RORX011",224,0)
 ;
"RTN","RORX011",225,0)
 ;--- Root node of the report
"RTN","RORX011",226,0)
 S REPORT=$$ADDVAL^RORTSK11(RORTSK,"REPORT")
"RTN","RORX011",227,0)
 Q:REPORT<0 REPORT
"RTN","RORX011",228,0)
 ;
"RTN","RORX011",229,0)
 D
"RTN","RORX011",230,0)
 . ;--- Get and prepare the report parameters
"RTN","RORX011",231,0)
 . S RORREG=+$$PARAM^RORTSK01("REGIEN")
"RTN","RORX011",232,0)
 . S RORALL=$$PARAM^RORTSK01("PATIENTS","ALL")
"RTN","RORX011",233,0)
 . S RC=$$PARAMS(REPORT,.RORSDT,.ROREDT,.FLAGS)  Q:RC<0
"RTN","RORX011",234,0)
 . S ROREDT1=$$FMADD^XLFDT(ROREDT\1,1)
"RTN","RORX011",235,0)
 . ;
"RTN","RORX011",236,0)
 . ;--- Report header
"RTN","RORX011",237,0)
 . S RC=$$HEADER(REPORT)  Q:RC<0
"RTN","RORX011",238,0)
 . ;
"RTN","RORX011",239,0)
 . ;--- Process the data and generate the report
"RTN","RORX011",240,0)
 . S RC=$$PROCESS(REPORT,FLAGS)  S:RC>0 ECNT=ECNT+RC
"RTN","RORX011",241,0)
 ;
"RTN","RORX011",242,0)
 ;--- Cleanup
"RTN","RORX011",243,0)
 K ^TMP("RORX011-RESORTED",$J)
"RTN","RORX011",244,0)
 D FREE^RORTMP(RORXL)
"RTN","RORX011",245,0)
 Q $S(RC<0:RC,ECNT>0:-43,1:0)
"RTN","RORX011",246,0)
 ;
"RTN","RORX011",247,0)
 ;***** CALLBACK FUNCTION FOR THE PHARMACY SEARCH API
"RTN","RORX011",248,0)
RXSCB(ROR8DST,ORDER,ORDFLG,DRUG,DATE,NUMREF) ;
"RTN","RORX011",249,0)
 N DRUGIEN,DRUGNAME,FILLTYPE,IEN,IRP,OFD,RPSUB,RXBUF,RXCNT,RXNUM,TMP
"RTN","RORX011",250,0)
 S DRUGIEN=+DRUG,DRUGNAME=$P(DRUG,U,2)
"RTN","RORX011",251,0)
 Q:(DRUGIEN'>0)!(DRUGNAME="") 1
"RTN","RORX011",252,0)
 ;--- Check the drug groups
"RTN","RORX011",253,0)
 S TMP=$$RXGRPCHK^RORXU007(.ROR8DST,+DRUG,RORXL)
"RTN","RORX011",254,0)
 Q:TMP TMP
"RTN","RORX011",255,0)
 ;--- Process the order
"RTN","RORX011",256,0)
 S:ROR8DST("RORXGEN")>0 $P(RXBUF,U,4)=$P(ROR8DST("RORXGEN"),U,2)
"RTN","RORX011",257,0)
 S $P(RXBUF,U,5)=$P($G(^TMP("PS",$J,0)),U,7)  ; Days Supply
"RTN","RORX011",258,0)
 S $P(RXBUF,U,6)=+$G(NUMREF)  ; # Refills remaining - Patch 11
"RTN","RORX011",259,0)
 S TMP=$G(^TMP("PS",$J,"RXN",0))
"RTN","RORX011",260,0)
 S FILLTYPE=$S(ORDFLG["I":"I",1:$P(TMP,U,3))
"RTN","RORX011",261,0)
 S RXNUM=$P(TMP,U)  S:RXNUM="" RXNUM=" "
"RTN","RORX011",262,0)
 S RXCNT=0
"RTN","RORX011",263,0)
 ;--- Original prescription
"RTN","RORX011",264,0)
 I ORDFLG["I"  D  ;--- Inpatient
"RTN","RORX011",265,0)
 . S OFD=$P($G(^TMP("PS",$J,0)),U,5)         ; Start Date
"RTN","RORX011",266,0)
 . S $P(RXBUF,U,1,2)="I"_U_FILLTYPE,RXCNT=RXCNT+1
"RTN","RORX011",267,0)
 . S @ROR8DST@(OFD,DRUGNAME,DRUGIEN,RXNUM,RXCNT)=RXBUF
"RTN","RORX011",268,0)
 E  D             ;--- Outpatient
"RTN","RORX011",269,0)
 . S OFD=+$P($G(^TMP("PS",$J,"RXN",0)),U,6)  ; Original Fill Date
"RTN","RORX011",270,0)
 . Q:(OFD<ROR8DST("RORSDT"))!(OFD'<ROR8DST("ROREDT"))
"RTN","RORX011",271,0)
 . S $P(RXBUF,U,1,2)="O"_U_FILLTYPE,RXCNT=RXCNT+1
"RTN","RORX011",272,0)
 . S @ROR8DST@(OFD,DRUGNAME,DRUGIEN,RXNUM,RXCNT)=RXBUF
"RTN","RORX011",273,0)
 ;--- Refills and partials
"RTN","RORX011",274,0)
 F RPSUB="REF","PAR"  D
"RTN","RORX011",275,0)
 . S $P(RXBUF,U)=$E(RPSUB,1)
"RTN","RORX011",276,0)
 . S IRP=0
"RTN","RORX011",277,0)
 . F  S IRP=$O(^TMP("PS",$J,RPSUB,IRP))  Q:IRP'>0  D
"RTN","RORX011",278,0)
 . . S TMP=$G(^TMP("PS",$J,RPSUB,IRP,0))
"RTN","RORX011",279,0)
 . . S $P(RXBUF,U,2)=$S(ORDFLG["I":"I",1:$P(TMP,U,5))
"RTN","RORX011",280,0)
 . . S $P(RXBUF,U,5)=$P(TMP,U,2)  ; Days Supply
"RTN","RORX011",281,0)
 . . I TMP>0  S RXCNT=RXCNT+1  D
"RTN","RORX011",282,0)
 . . . S @ROR8DST@(+TMP,DRUGNAME,DRUGIEN,RXNUM,RXCNT)=RXBUF
"RTN","RORX011",283,0)
 Q 0
"RTN","RORX011",284,0)
 ;
"RTN","RORX011",285,0)
 ;***** KEEP ONLY MOST RECENT FILLS FOR EACH DRUG
"RTN","RORX011",286,0)
 ;Input:
"RTN","RORX011",287,0)
 ;   RORXDST - arry containing all drug fills for patient
"RTN","RORX011",288,0)
 ;
"RTN","RORX011",289,0)
 ;Output:
"RTN","RORX011",290,0)
 ;   RORXDST - array containing only most recent drug fills for patient
"RTN","RORX011",291,0)
 ;       
"RTN","RORX011",292,0)
 ;The ^TMP("RORX011-RESORTED",$J) global node is used by this function.
"RTN","RORX011",293,0)
 ;Indirection: RORXDST = $NA(^TMP("RORX011",$J))
"RTN","RORX011",294,0)
 ;                           ^TMP("RORX011",$J,DATE,DRUG_NAME,IEN,...)
"RTN","RORX011",295,0)
 ;
"RTN","RORX011",296,0)
RECENT(RORXDST) ;
"RTN","RORX011",297,0)
 N DATE,DRUG
"RTN","RORX011",298,0)
 K ^TMP("RORX011-RESORTED",$J) ;empty the temporary global
"RTN","RORX011",299,0)
 ;Patient's Rx data was stored by date, then drug name.  Spin through
"RTN","RORX011",300,0)
 ;Rx data and re-order it by drug name first, then date.  The reordered
"RTN","RORX011",301,0)
 ;data is put into temp global ^TMP("RORX011-RESORTED",$J,DRUG,DATE)
"RTN","RORX011",302,0)
 S DATE=0 F  S DATE=$O(@RORXDST@(DATE)) Q:'DATE  D
"RTN","RORX011",303,0)
 . S DRUG=0 F  S DRUG=$O(@RORXDST@(DATE,DRUG)) Q:'$L(DRUG)  D
"RTN","RORX011",304,0)
 . . S ^TMP("RORX011-RESORTED",$J,DRUG,DATE)=1
"RTN","RORX011",305,0)
 ;
"RTN","RORX011",306,0)
 ;spin through re-sorted drug file
"RTN","RORX011",307,0)
 S DRUG=0 F  S DRUG=$O(^TMP("RORX011-RESORTED",$J,DRUG)) Q:'$L(DRUG)  D
"RTN","RORX011",308,0)
 . ;get entry for drug with most recent (latest) date
"RTN","RORX011",309,0)
 . S DATE=$O(^TMP("RORX011-RESORTED",$J,DRUG,9999999),-1)
"RTN","RORX011",310,0)
 . ;has any drug been re-filled?
"RTN","RORX011",311,0)
 . F  S DATE=$O(^TMP("RORX011-RESORTED",$J,DRUG,DATE),-1) Q:'DATE  D
"RTN","RORX011",312,0)
 . . ;yes, previous/older fill found - delete from the original file
"RTN","RORX011",313,0)
 . . K @RORXDST@(DATE,DRUG)
"RTN","RORX011",314,0)
 Q
"RTN","RORX012")
0^25^B23138519^B17967420
"RTN","RORX012",1,0)
RORX012 ;HOIFO/SG,VAC - COMBINED MEDS AND LABS REPORT ;4/9/09 9:40am
"RTN","RORX012",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**8,21,31**;Feb 17, 2006;Build 62
"RTN","RORX012",3,0)
 ;
"RTN","RORX012",4,0)
 ;Modified Feb 2009, to permit only the most recent test to be
"RTN","RORX012",5,0)
 ;    displayed on the report - a call to ^RORXU009
"RTN","RORX012",6,0)
 ;
"RTN","RORX012",7,0)
 ;Modified March 2009 to filter patients on Include or Exclude ICD9
"RTN","RORX012",8,0)
 ;    codes.  Call to ^RORXU010
"RTN","RORX012",9,0)
 ;
"RTN","RORX012",10,0)
 ;ROR*1.5*21   SEP 2013    T KOPP       Add ICN column if Additional Identifier
"RTN","RORX012",11,0)
 ;                                       requested.
"RTN","RORX012",12,0)
 ;ROR*1.5*31   MAY 2017    M FERRARESE  Adding PACT, PCP, and AGE/DOB as additional
"RTN","RORX012",13,0)
 ;                                      identifiers.
"RTN","RORX012",14,0)
 ;******************************************************************************
"RTN","RORX012",15,0)
 ;
"RTN","RORX012",16,0)
 Q
"RTN","RORX012",17,0)
 ;
"RTN","RORX012",18,0)
 ;***** OUTPUTS THE REPORT HEADER
"RTN","RORX012",19,0)
 ;
"RTN","RORX012",20,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX012",21,0)
 ;
"RTN","RORX012",22,0)
 ; Return Values:
"RTN","RORX012",23,0)
 ;       <0  Error code
"RTN","RORX012",24,0)
 ;       >0  IEN of the HEADER element
"RTN","RORX012",25,0)
 ;
"RTN","RORX012",26,0)
HEADER(PARTAG) ;
"RTN","RORX012",27,0)
 ;;DRUGS(#,NAME,LAST4,DOD,RXNAME)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="ALL"
"RTN","RORX012",28,0)
 ;;DRUGS(#,NAME,LAST4,AGE,DOD,RXNAME)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="AGE"
"RTN","RORX012",29,0)
 ;;DRUGS(#,NAME,LAST4,DOB,DOD,RXNAME)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="DOB"
"RTN","RORX012",30,0)
 ;;LABTESTS(#,NAME,LAST4,DOD,DATE,LTNAME,RESULT)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="ALL"
"RTN","RORX012",31,0)
 ;;LABTESTS(#,NAME,LAST4,AGE,DOD,DATE,LTNAME,RESULT)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="AGE"
"RTN","RORX012",32,0)
 ;;LABTESTS(#,NAME,LAST4,DOB,DOD,DATE,LTNAME,RESULT)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="DOB"
"RTN","RORX012",33,0)
 ;;PATIENTS(#,NAME,LAST4,DOD,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="ALL"
"RTN","RORX012",34,0)
 ;;PATIENTS(#,NAME,LAST4,AGE,DOD,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="AGE"
"RTN","RORX012",35,0)
 ;;PATIENTS(#,NAME,LAST4,DOB,DOD,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="DOB"
"RTN","RORX012",36,0)
 ;
"RTN","RORX012",37,0)
 N HEADER,RC
"RTN","RORX012",38,0)
 S HEADER=$$HEADER^RORXU002(.RORTSK,PARTAG)
"RTN","RORX012",39,0)
 Q:HEADER<0 HEADER
"RTN","RORX012",40,0)
 S RC=$$TBLDEF^RORXU002("HEADER^RORX012",HEADER)
"RTN","RORX012",41,0)
 Q $S(RC<0:RC,1:HEADER)
"RTN","RORX012",42,0)
 ;
"RTN","RORX012",43,0)
 ;***** OUTPUTS THE PARAMETERS TO THE REPORT
"RTN","RORX012",44,0)
 ;
"RTN","RORX012",45,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX012",46,0)
 ;
"RTN","RORX012",47,0)
 ; [.STDT]       Start and end dates of the report
"RTN","RORX012",48,0)
 ; [.ENDT]       are returned via these parameters
"RTN","RORX012",49,0)
 ;
"RTN","RORX012",50,0)
 ; [.FLAGS]      Flags for the $$SKIP^RORXU005 are
"RTN","RORX012",51,0)
 ;               returned via this parameter
"RTN","RORX012",52,0)
 ;
"RTN","RORX012",53,0)
 ; Return Values:
"RTN","RORX012",54,0)
 ;       <0  Error code
"RTN","RORX012",55,0)
 ;       >0  IEN of the PARAMETERS element
"RTN","RORX012",56,0)
 ;
"RTN","RORX012",57,0)
PARAMS(PARTAG,STDT,ENDT,FLAGS) ;
"RTN","RORX012",58,0)
 N PARAMS,TMP
"RTN","RORX012",59,0)
 S PARAMS=$$PARAMS^RORXU002(.RORTSK,PARTAG,.STDT,.ENDT,.FLAGS)
"RTN","RORX012",60,0)
 Q:PARAMS<0 PARAMS
"RTN","RORX012",61,0)
 ;--- Process the list of drugs and groups
"RTN","RORX012",62,0)
 I RORPHARM  D  Q:TMP<0 TMP
"RTN","RORX012",63,0)
 . S TMP=$$DRUGLST^RORXU007(.RORTSK,PARAMS,.RORXL,.RORXGRP)
"RTN","RORX012",64,0)
 ;--- Process the list of Lab tests
"RTN","RORX012",65,0)
 I RORLAB  D  Q:TMP<0 TMP
"RTN","RORX012",66,0)
 . S TMP=$$LTLST^RORXU006(.RORTSK,PARAMS,.RORLTST,"RORLTRV")
"RTN","RORX012",67,0)
 ;---
"RTN","RORX012",68,0)
 Q PARAMS
"RTN","RORX012",69,0)
 ;
"RTN","RORX012",70,0)
 ;***** DETERMINES THE REPORT MODE FOR LAB OR PHARMACY
"RTN","RORX012",71,0)
 ;
"RTN","RORX012",72,0)
 ; NAME          Base name of the attribute ("LAB" or "PHARM")
"RTN","RORX012",73,0)
 ;
"RTN","RORX012",74,0)
 ; Return Values:
"RTN","RORX012",75,0)
 ;       <0  "Did Not"
"RTN","RORX012",76,0)
 ;        0  Not selected
"RTN","RORX012",77,0)
 ;       >0  "Did"
"RTN","RORX012",78,0)
RPTMODE(NAME) ;
"RTN","RORX012",79,0)
 Q:$$PARAM^RORTSK01("PATIENTS",NAME) 1        ; "Did"
"RTN","RORX012",80,0)
 Q:$$PARAM^RORTSK01("PATIENTS","NO"_NAME) -1  ; "Did Not"
"RTN","RORX012",81,0)
 Q 0
"RTN","RORX012",82,0)
 ;
"RTN","RORX012",83,0)
 ;***** COMPILES THE "COMBINED PHARMACY AND LAB" REPORT
"RTN","RORX012",84,0)
 ; REPORT CODE: 012
"RTN","RORX012",85,0)
 ;
"RTN","RORX012",86,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORX012",87,0)
 ;
"RTN","RORX012",88,0)
 ; The ^TMP("RORX012",$J) global node is used by this function.
"RTN","RORX012",89,0)
 ;
"RTN","RORX012",90,0)
 ; ^TMP("RORX012",$J,
"RTN","RORX012",91,0)
 ;   "PAT",
"RTN","RORX012",92,0)
 ;     DFN,              Patient descriptor
"RTN","RORX012",93,0)
 ;                         ^01: Last 4 digits of SSN
"RTN","RORX012",94,0)
 ;                         ^02: Patient name
"RTN","RORX012",95,0)
 ;                         ^03: Date of Death
"RTN","RORX012",96,0)
 ;                         ^04: ICN
"RTN","RORX012",97,0)
 ;                         ^05: PACT
"RTN","RORX012",98,0)
 ;                         ^06: PCP 
"RTN","RORX012",99,0)
 ;                         ^07: AGE/DOB
"RTN","RORX012",100,0)
 ;       "LR",
"RTN","RORX012",101,0)
 ;         Date,
"RTN","RORX012",102,0)
 ;           TestName,
"RTN","RORX012",103,0)
 ;             TestIEN)  Result
"RTN","RORX012",104,0)
 ;       "RX",
"RTN","RORX012",105,0)
 ;         DrugName,
"RTN","RORX012",106,0)
 ;           DrugIEN)    ""
"RTN","RORX012",107,0)
 ;
"RTN","RORX012",108,0)
 ; Return Values:
"RTN","RORX012",109,0)
 ;       <0  Error code
"RTN","RORX012",110,0)
 ;        0  Ok
"RTN","RORX012",111,0)
 ;
"RTN","RORX012",112,0)
RXANDLAB(RORTSK) ;
"RTN","RORX012",113,0)
 N RORLAB        ; Labs mode (-1|0|1)
"RTN","RORX012",114,0)
 N RORLTST       ; Closed root of the list of lab tests for the
"RTN","RORX012",115,0)
 ;               ; Lab search API
"RTN","RORX012",116,0)
 N RORLTRV       ; Closed root of the list of lab tests with ranges
"RTN","RORX012",117,0)
 N RORPHARM      ; Meds mode (-1|0|1)
"RTN","RORX012",118,0)
 N RORREG        ; Registry IEN
"RTN","RORX012",119,0)
 N RORXEDT       ; Pharmacy end date
"RTN","RORX012",120,0)
 N RORXGRP       ; List of drug groups
"RTN","RORX012",121,0)
 N RORXL         ; Closed root of the drug list for the pharmacy
"RTN","RORX012",122,0)
 ;               ; search API or "*" if all drugs were selected
"RTN","RORX012",123,0)
 N RORXSDT       ; Pharmacy start date
"RTN","RORX012",124,0)
 ;
"RTN","RORX012",125,0)
 N ECNT,NSPT,RC,REPORT,SFLAGS,TMP
"RTN","RORX012",126,0)
 N RORDEL        ; Flag to determine if Most Recent is set
"RTN","RORX012",127,0)
 N RORDELTSK     ; Task number passed to delete tests
"RTN","RORX012",128,0)
 S RORDEL=$G(RORTSK("PARAMS","LABTESTS","A","MOST_RECENT"))
"RTN","RORX012",129,0)
 S RORDELTSK=RORTSK
"RTN","RORX012",130,0)
 S (RORXL,RORLTST)="",(ECNT,RC)=0
"RTN","RORX012",131,0)
 K ^TMP("RORX012",$J)
"RTN","RORX012",132,0)
 ;--- Root node of the report
"RTN","RORX012",133,0)
 S REPORT=$$ADDVAL^RORTSK11(RORTSK,"REPORT")
"RTN","RORX012",134,0)
 Q:REPORT<0 REPORT
"RTN","RORX012",135,0)
 ;
"RTN","RORX012",136,0)
 D
"RTN","RORX012",137,0)
 . ;--- Get and prepare the report parameters
"RTN","RORX012",138,0)
 . S RORREG=$$PARAM^RORTSK01("REGIEN")  ; Registry IEN
"RTN","RORX012",139,0)
 . S RORLAB=$$RPTMODE("LAB")            ; Labs logic
"RTN","RORX012",140,0)
 . S RORPHARM=$$RPTMODE("PHARM")        ; Meds logic
"RTN","RORX012",141,0)
 . S RC=$$PARAMS(REPORT,.RORXSDT,.RORXEDT,.SFLAGS)  Q:RC<0
"RTN","RORX012",142,0)
 . ;--- Report header
"RTN","RORX012",143,0)
 . S RC=$$HEADER(REPORT)  Q:RC<0
"RTN","RORX012",144,0)
 . ;--- Query the registry
"RTN","RORX012",145,0)
 . D TPPSETUP^RORTSK01(80)
"RTN","RORX012",146,0)
 . S RC=$$QUERY^RORX012A(SFLAGS,.NSPT)
"RTN","RORX012",147,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX012",148,0)
 . ;--- Store the results
"RTN","RORX012",149,0)
 . D TPPSETUP^RORTSK01(20)
"RTN","RORX012",150,0)
 . S RC=$$STORE^RORX012A(REPORT,NSPT)
"RTN","RORX012",151,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX012",152,0)
 ;
"RTN","RORX012",153,0)
 ;--- Cleanup
"RTN","RORX012",154,0)
 ;--- Modify the report if only the latest test is required
"RTN","RORX012",155,0)
 ;    Inputs are Task number for File 798.8 and the flag
"RTN","RORX012",156,0)
 I RORDEL=1 D DEL^RORXU009(RORDELTSK)
"RTN","RORX012",157,0)
 K ^TMP("RORX012",$J)
"RTN","RORX012",158,0)
 D FREE^RORTMP(RORXL),FREE^RORTMP(RORLTST)
"RTN","RORX012",159,0)
 ;
"RTN","RORX012",160,0)
 Q $S(RC<0:RC,ECNT>0:-43,1:0)
"RTN","RORX012A")
0^26^B120421000^B95062743
"RTN","RORX012A",1,0)
RORX012A ;HOIFO/SG,VAC - COMBINED MEDS AND LABS (QUERY & STORE) ;4/7/09 2:09pm
"RTN","RORX012A",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**8,13,19,21,31**;Feb 17, 2006;Build 62
"RTN","RORX012A",3,0)
 ;
"RTN","RORX012A",4,0)
 ; This routine uses the following IAs:
"RTN","RORX012A",5,0)
 ;
"RTN","RORX012A",6,0)
 ; #10103 FMADD^XLFDT (supported)
"RTN","RORX012A",7,0)
 ;   
"RTN","RORX012A",8,0)
 ;******************************************************************************
"RTN","RORX012A",9,0)
 ;******************************************************************************
"RTN","RORX012A",10,0)
 ;                 --- ROUTINE MODIFICATION LOG ---
"RTN","RORX012A",11,0)
 ;        
"RTN","RORX012A",12,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORX012A",13,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","RORX012A",14,0)
 ;ROR*1.5*8    MAR  2010   V CARR       Modified to handle ICD9 filter for
"RTN","RORX012A",15,0)
 ;                                      'include' or 'exclude'.
"RTN","RORX012A",16,0)
 ;ROR*1.5*13   DEC  2010   A SAUNDERS   User can select specific patients,
"RTN","RORX012A",17,0)
 ;                                      clinics, or divisions for the report.
"RTN","RORX012A",18,0)
 ;ROR*1.5*19   FEB  2012   K GUPTA      Support for ICD-10 Coding System
"RTN","RORX012A",19,0)
 ;ROR*1.5*21   SEP 2013    T KOPP       Add ICN column if Additional Identifier
"RTN","RORX012A",20,0)
 ;                                       requested.
"RTN","RORX012A",21,0)
 ;ROR*1.5*31   MAY 2017    M FERRARESE  Adding PACT, PCP, AGE/DOB as additional
"RTN","RORX012A",22,0)
 ;                                       identifiers.
"RTN","RORX012A",23,0)
 ;******************************************************************************
"RTN","RORX012A",24,0)
 ;******************************************************************************
"RTN","RORX012A",25,0)
 Q
"RTN","RORX012A",26,0)
 ;
"RTN","RORX012A",27,0)
 ;***** LAB SEARCH CALLBACK
"RTN","RORX012A",28,0)
 ;
"RTN","RORX012A",29,0)
 ; .ROR8DST      Reference to the ROR8DST parameter.
"RTN","RORX012A",30,0)
 ;
"RTN","RORX012A",31,0)
 ; INVDT         IEN of the Lab test (inverted date)
"RTN","RORX012A",32,0)
 ;
"RTN","RORX012A",33,0)
 ; .RESULT       Reference to a local variable, which contains
"RTN","RORX012A",34,0)
 ;               the result (see the $$LTSEARCH^RORUTL10).
"RTN","RORX012A",35,0)
 ;
"RTN","RORX012A",36,0)
 ; Return Values:
"RTN","RORX012A",37,0)
 ;       <0  Error code (the search will be aborted)
"RTN","RORX012A",38,0)
 ;        0  Ok
"RTN","RORX012A",39,0)
 ;        1  Skip this result
"RTN","RORX012A",40,0)
 ;        2  Skip this and all remaining results
"RTN","RORX012A",41,0)
 ;
"RTN","RORX012A",42,0)
LTSCB(ROR8DST,INVDT,RESULT) ;
"RTN","RORX012A",43,0)
 N DATE,IEN,NAME,RC,TMP,VAL
"RTN","RORX012A",44,0)
 S IEN=+RESULT(2)           Q:IEN'>0 1   ; IEN of the Lab test
"RTN","RORX012A",45,0)
 S NAME=$P(RESULT(2),U,2)   Q:NAME="" 1  ; Name of the test
"RTN","RORX012A",46,0)
 S DATE=+$P(RESULT(1),U,2)  Q:DATE'>0 1  ; Date of the test
"RTN","RORX012A",47,0)
 S ROR8DST("RORUTIL")=1
"RTN","RORX012A",48,0)
 ;--- Check the result range if necessary
"RTN","RORX012A",49,0)
 I $D(RORLTRV(IEN))>1  S RC=1  D  Q:RC RC
"RTN","RORX012A",50,0)
 . S VAL=$$CLRNMVAL^RORUTL18($P(RESULT(1),U,3))
"RTN","RORX012A",51,0)
 . ;--- Skip a non-numeric result
"RTN","RORX012A",52,0)
 . Q:'$$NUMERIC^RORUTL05(VAL)
"RTN","RORX012A",53,0)
 . ;--- Check the range
"RTN","RORX012A",54,0)
 . I $G(RORLTRV(IEN,"L"))'=""  Q:VAL<RORLTRV(IEN,"L")
"RTN","RORX012A",55,0)
 . I $G(RORLTRV(IEN,"H"))'=""  Q:VAL>RORLTRV(IEN,"H")
"RTN","RORX012A",56,0)
 . S RC=0
"RTN","RORX012A",57,0)
 ;--- Store the result
"RTN","RORX012A",58,0)
 S @ROR8DST@(DATE,NAME,IEN)=$P(RESULT(1),U,3)
"RTN","RORX012A",59,0)
 Q 0
"RTN","RORX012A",60,0)
 ;
"RTN","RORX012A",61,0)
 ;***** QUERIES THE REGISTRY
"RTN","RORX012A",62,0)
 ;
"RTN","RORX012A",63,0)
 ; FLAGS         Flags for the $$SKIP^RORXU005
"RTN","RORX012A",64,0)
 ; .NSPT         Number of selected patients is returned here
"RTN","RORX012A",65,0)
 ;
"RTN","RORX012A",66,0)
 ; Return Values:
"RTN","RORX012A",67,0)
 ;       <0  Error code
"RTN","RORX012A",68,0)
 ;        0  Ok
"RTN","RORX012A",69,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX012A",70,0)
 ;
"RTN","RORX012A",71,0)
QUERY(FLAGS,NSPT) ;
"RTN","RORX012A",72,0)
 N RORLDST       ; Descriptor for Lab search API
"RTN","RORX012A",73,0)
 N RORPTN        ; Number of patients in the registry
"RTN","RORX012A",74,0)
 N RORXDST       ; Descriptor for pharmacy search API
"RTN","RORX012A",75,0)
 N RORCDLIST     ; Flag to indicate whether a clinic or division list exists
"RTN","RORX012A",76,0)
 N RORCDSTDT     ; Start date for clinic/division utilization search
"RTN","RORX012A",77,0)
 N RORCDENDT     ; End date for clinic/division utilization search
"RTN","RORX012A",78,0)
 N RORICN        ; National ICN
"RTN","RORX012A",79,0)
 N RORPACT       ; Patient Care Team PACT
"RTN","RORX012A",80,0)
 N RORPCP        ; Primary Care Provider PCP
"RTN","RORX012A",81,0)
 ;
"RTN","RORX012A",82,0)
 N CNT,ECNT,IEN,IENS,LTEDT,LTSDT,PATIEN,RC,RXEDT,SKIP,SKIPEDT,SKIPSDT,TMP,UTEDT,UTIL,UTSDT,VA,VADM,XREFNODE
"RTN","RORX012A",83,0)
 N RCC,FLAG
"RTN","RORX012A",84,0)
 S XREFNODE=$NA(^RORDATA(798,"AC",+RORREG))
"RTN","RORX012A",85,0)
 S (CNT,ECNT,NSPT,RC)=0,(SKIPEDT,SKIPSDT)=0
"RTN","RORX012A",86,0)
 ;--- Utilization date range
"RTN","RORX012A",87,0)
 D:$$PARAM^RORTSK01("PATIENTS","CAREONLY")
"RTN","RORX012A",88,0)
 . S UTSDT=$$PARAM^RORTSK01("DATE_RANGE_3","START")\1
"RTN","RORX012A",89,0)
 . S UTEDT=$$PARAM^RORTSK01("DATE_RANGE_3","END")\1
"RTN","RORX012A",90,0)
 . ;--- Combined date range
"RTN","RORX012A",91,0)
 . S SKIPSDT=$$DTMIN^RORUTL18(SKIPSDT,UTSDT)
"RTN","RORX012A",92,0)
 . S SKIPEDT=$$DTMAX^RORUTL18(SKIPEDT,UTEDT)
"RTN","RORX012A",93,0)
 ;--- Number of patients in the registry
"RTN","RORX012A",94,0)
 S RORPTN=$$REGSIZE^RORUTL02(+RORREG)  S:RORPTN<0 RORPTN=0
"RTN","RORX012A",95,0)
 ;
"RTN","RORX012A",96,0)
 ;--- Setup the descriptors for callback API's
"RTN","RORX012A",97,0)
 I RORLAB  D
"RTN","RORX012A",98,0)
 . I RORLTST'="*",$D(@RORLTST)<10  S RORLAB=0  Q
"RTN","RORX012A",99,0)
 . S RORLDST("RORCB")="$$LTSCB^RORX012A"
"RTN","RORX012A",100,0)
 . ;--- Labs date range
"RTN","RORX012A",101,0)
 . S LTSDT=$$PARAM^RORTSK01("DATE_RANGE_2","START")\1
"RTN","RORX012A",102,0)
 . S LTEDT=$$PARAM^RORTSK01("DATE_RANGE_2","END")\1
"RTN","RORX012A",103,0)
 . ;--- Combined date range
"RTN","RORX012A",104,0)
 . S SKIPSDT=$$DTMIN^RORUTL18(SKIPSDT,LTSDT)
"RTN","RORX012A",105,0)
 . S SKIPEDT=$$DTMAX^RORUTL18(SKIPEDT,LTEDT)
"RTN","RORX012A",106,0)
 . ;--- Shift the Labs end date
"RTN","RORX012A",107,0)
 . S LTEDT=$$FMADD^XLFDT(LTEDT,1)
"RTN","RORX012A",108,0)
 I RORPHARM  D
"RTN","RORX012A",109,0)
 . I RORXL'="*",$D(@RORXL)<10  S RORPHARM=0  Q
"RTN","RORX012A",110,0)
 . S RORXDST("RORCB")="$$RXSCB^RORX012A"
"RTN","RORX012A",111,0)
 . S RORXDST("GENERIC")=$$PARAM^RORTSK01("DRUGS","AGGR_GENERIC")
"RTN","RORX012A",112,0)
 . ;--- Combined date range
"RTN","RORX012A",113,0)
 . S SKIPSDT=$$DTMIN^RORUTL18(SKIPSDT,RORXSDT)
"RTN","RORX012A",114,0)
 . S SKIPEDT=$$DTMAX^RORUTL18(SKIPEDT,RORXEDT)
"RTN","RORX012A",115,0)
 . ;--- Shift the Meds end date
"RTN","RORX012A",116,0)
 . S RXEDT=$$FMADD^XLFDT(RORXEDT\1,1)
"RTN","RORX012A",117,0)
 Q:'(RORLAB!RORPHARM) 0
"RTN","RORX012A",118,0)
 ;
"RTN","RORX012A",119,0)
 ;=== Set up Clinic/Division list parameters
"RTN","RORX012A",120,0)
 S RORCDLIST=$$CDPARMS^RORXU001(.RORTSK,.RORCDSTDT,.RORCDENDT,1)
"RTN","RORX012A",121,0)
 ;
"RTN","RORX012A",122,0)
 ;--- Browse through the registry records
"RTN","RORX012A",123,0)
 S IEN=0
"RTN","RORX012A",124,0)
 S FLAG=$G(RORTSK("PARAMS","ICDFILT","A","FILTER"))
"RTN","RORX012A",125,0)
 F  S IEN=$O(@XREFNODE@(IEN))  Q:IEN'>0  D  Q:RC<0
"RTN","RORX012A",126,0)
 . S TMP=$S(RORPTN>0:CNT/RORPTN,1:"")
"RTN","RORX012A",127,0)
 . S RC=$$LOOP^RORTSK01(TMP)  Q:RC<0
"RTN","RORX012A",128,0)
 . S IENS=IEN_",",CNT=CNT+1
"RTN","RORX012A",129,0)
 . ;--- Get patient DFN
"RTN","RORX012A",130,0)
 . S PATIEN=$$PTIEN^RORUTL01(IEN)  Q:PATIEN'>0
"RTN","RORX012A",131,0)
 . ;check for patient list and quit if not on list
"RTN","RORX012A",132,0)
 . I $D(RORTSK("PARAMS","PATIENTS","C")),'$D(RORTSK("PARAMS","PATIENTS","C",PATIEN)) Q
"RTN","RORX012A",133,0)
 . ;--- Check if the patient should be skipped
"RTN","RORX012A",134,0)
 . Q:$$SKIP^RORXU005(IEN,FLAGS,SKIPSDT,SKIPEDT)
"RTN","RORX012A",135,0)
 . S SKIP=1,UTIL=0
"RTN","RORX012A",136,0)
 . ;--- Check if patient should be filtered because of ICD codes
"RTN","RORX012A",137,0)
 . S RCC=0
"RTN","RORX012A",138,0)
 . I FLAG'="ALL" D
"RTN","RORX012A",139,0)
 . . S RCC=$$ICD^RORXU010(PATIEN)
"RTN","RORX012A",140,0)
 . I (FLAG="INCLUDE")&(RCC=0) Q
"RTN","RORX012A",141,0)
 . I (FLAG="EXCLUDE")&(RCC=1) Q
"RTN","RORX012A",142,0)
 . ;
"RTN","RORX012A",143,0)
 . ;--- Check for Clinic or Division list and quit if not in list
"RTN","RORX012A",144,0)
 . I RORCDLIST,'$$CDUTIL^RORXU001(.RORTSK,PATIEN,RORCDSTDT,RORCDENDT) Q
"RTN","RORX012A",145,0)
 . ;
"RTN","RORX012A",146,0)
 . D  I RC<0  S ECNT=ECNT+1,RC=0  Q
"RTN","RORX012A",147,0)
 . . ;--- Search for pharmacy data
"RTN","RORX012A",148,0)
 . . I RORPHARM  D  Q:RC'>0
"RTN","RORX012A",149,0)
 . . . M RORXDST("RORXGRP")=RORXGRP("C")
"RTN","RORX012A",150,0)
 . . . S RORXDST=$NA(^TMP("RORX012",$J,"PAT",PATIEN,"RX"))
"RTN","RORX012A",151,0)
 . . . K RORXDST("RORUTIL")
"RTN","RORX012A",152,0)
 . . . S RC=$$RXSEARCH^RORUTL14(PATIEN,RORXL,.RORXDST,"EIOV",RORXSDT,RXEDT)
"RTN","RORX012A",153,0)
 . . . Q:RC<0
"RTN","RORX012A",154,0)
 . . . ;S:$G(RORXDST("RORUTIL")) UTIL=1
"RTN","RORX012A",155,0)
 . . . I RC>0  S:$D(RORXDST("RORXGRP"))>1 RC=0
"RTN","RORX012A",156,0)
 . . . ;--- Invert the result if the "Did Not" logic was selected
"RTN","RORX012A",157,0)
 . . . I RORPHARM<0  S RC='RC  K @RORXDST
"RTN","RORX012A",158,0)
 . . ;--- Search for Lab data
"RTN","RORX012A",159,0)
 . . I RORLAB  D  Q:RC'>0
"RTN","RORX012A",160,0)
 . . . S RORLDST=$NA(^TMP("RORX012",$J,"PAT",PATIEN,"LR"))
"RTN","RORX012A",161,0)
 . . . K RORLDST("RORUTIL")
"RTN","RORX012A",162,0)
 . . . S RC=$$LTSEARCH^RORUTL10(PATIEN,RORLTST,.RORLDST,,LTSDT,LTEDT)
"RTN","RORX012A",163,0)
 . . . Q:RC<0
"RTN","RORX012A",164,0)
 . . . ;S:$G(RORLDST("RORUTIL")) UTIL=1
"RTN","RORX012A",165,0)
 . . . ;--- Invert the result if the "Did Not" logic was selected
"RTN","RORX012A",166,0)
 . . . S:RORLAB<0 RC='RC
"RTN","RORX012A",167,0)
 . . ;---
"RTN","RORX012A",168,0)
 . . S SKIP=0
"RTN","RORX012A",169,0)
 . ;
"RTN","RORX012A",170,0)
 . ;--- Check for any utilization in the corresponding date range
"RTN","RORX012A",171,0)
 . I 'SKIP  D:$$PARAM^RORTSK01("PATIENTS","CAREONLY")
"RTN","RORX012A",172,0)
 . . K TMP  S TMP("ALL")=1
"RTN","RORX012A",173,0)
 . . S UTIL=+$$UTIL^RORXU003(UTSDT,UTEDT,PATIEN,.TMP)
"RTN","RORX012A",174,0)
 . . S:'UTIL SKIP=1
"RTN","RORX012A",175,0)
 . ;
"RTN","RORX012A",176,0)
 . ;--- Skip the patient if not all search criteria have been met
"RTN","RORX012A",177,0)
 . I SKIP  K ^TMP("RORX012",$J,"PAT",PATIEN)  Q
"RTN","RORX012A",178,0)
 . ;
"RTN","RORX012A",179,0)
 . ;--- Get and store the patient's data
"RTN","RORX012A",180,0)
 . D VADEM^RORUTL05(PATIEN,1)
"RTN","RORX012A",181,0)
 . S RORICN=$S($$PARAM^RORTSK01("PATIENTS","ICN"):$$ICN^RORUTL02(PATIEN),1:"")
"RTN","RORX012A",182,0)
 . S TMP=$$DATE^RORXU002(VADM(6)\1)
"RTN","RORX012A",183,0)
 . S RORPACT=$S($$PARAM^RORTSK01("PATIENTS","PACT"):$$PACT^RORUTL02(PATIEN),1:"")
"RTN","RORX012A",184,0)
 . S RORPCP=$S($$PARAM^RORTSK01("PATIENTS","PCP"):$$PCP^RORUTL02(PATIEN),1:"")
"RTN","RORX012A",185,0)
 . S AGETYPE=$$PARAM^RORTSK01("AGE_RANGE","TYPE")
"RTN","RORX012A",186,0)
 . S AGE=$S(AGETYPE="AGE":$P(VADM(4),U),AGETYPE="DOB":$$DATE^RORXU002($P(VADM(3),U)\1),1:"")
"RTN","RORX012A",187,0)
 . S ^TMP("RORX012",$J,"PAT",PATIEN)=VA("BID")_U_VADM(1)_U_TMP_U_RORICN_U_RORPACT_U_RORPCP_U_AGE
"RTN","RORX012A",188,0)
 . S NSPT=NSPT+1
"RTN","RORX012A",189,0)
 ;
"RTN","RORX012A",190,0)
 ;---
"RTN","RORX012A",191,0)
 Q $S(RC<0:RC,1:ECNT)
"RTN","RORX012A",192,0)
 ;
"RTN","RORX012A",193,0)
 ;***** CALLBACK FUNCTION FOR THE PHARMACY SEARCH API
"RTN","RORX012A",194,0)
RXSCB(ROR8DST,ORDER,ORDFLG,DRUG,DATE) ;
"RTN","RORX012A",195,0)
 N GRP,IEN,NAME,TMP
"RTN","RORX012A",196,0)
 S ROR8DST("RORUTIL")=1
"RTN","RORX012A",197,0)
 ;=== Check the drug groups
"RTN","RORX012A",198,0)
 S TMP=$$RXGRPCHK^RORXU007(.ROR8DST,+DRUG,RORXL)
"RTN","RORX012A",199,0)
 Q:TMP TMP
"RTN","RORX012A",200,0)
 ;--- Get the drug data
"RTN","RORX012A",201,0)
 I ROR8DST("GENERIC")  D
"RTN","RORX012A",202,0)
 . S IEN=+ROR8DST("RORXGEN"),NAME=$P(ROR8DST("RORXGEN"),U,2)
"RTN","RORX012A",203,0)
 E  S IEN=+DRUG,NAME=$P(DRUG,U,2)
"RTN","RORX012A",204,0)
 Q:(IEN'>0)!(NAME="") 1
"RTN","RORX012A",205,0)
 ;--- Output the data
"RTN","RORX012A",206,0)
 S @ROR8DST@(NAME,IEN)=""
"RTN","RORX012A",207,0)
 Q 0
"RTN","RORX012A",208,0)
 ;
"RTN","RORX012A",209,0)
 ;***** STORES THE REPORT DATA
"RTN","RORX012A",210,0)
 ;
"RTN","RORX012A",211,0)
 ; REPORT        IEN of the REPORT element
"RTN","RORX012A",212,0)
 ; NSPT          Number of selected patients
"RTN","RORX012A",213,0)
 ;
"RTN","RORX012A",214,0)
 ; Return Values:
"RTN","RORX012A",215,0)
 ;       <0  Error code
"RTN","RORX012A",216,0)
 ;        0  Ok
"RTN","RORX012A",217,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX012A",218,0)
 ;
"RTN","RORX012A",219,0)
STORE(REPORT,NSPT) ;
"RTN","RORX012A",220,0)
 N CNT,DATE,DFN,DOD,ECNT,ICN,IEN,ITEM,LAST4,LTLST,PACT,PCP,NAME,NODE,PTCNT,PTLST,PTNAME,RC,RXLST,TMP,VAL,AGE,AGETYPE
"RTN","RORX012A",221,0)
 S (ECNT,RC)=0,(LTLST,PTLST,RXLST)=-1
"RTN","RORX012A",222,0)
 ;--- Force the "patient data" note in the output
"RTN","RORX012A",223,0)
 D ADDVAL^RORTSK11(RORTSK,"PATIENT",,REPORT)
"RTN","RORX012A",224,0)
 ;--- Create lab test list
"RTN","RORX012A",225,0)
 I RORLAB  D  Q:LTLST<0 LTLST
"RTN","RORX012A",226,0)
 . S LTLST=$$ADDVAL^RORTSK11(RORTSK,"LABTESTS",,REPORT)
"RTN","RORX012A",227,0)
 . D ADDATTR^RORTSK11(RORTSK,LTLST,"TABLE","LABTESTS")
"RTN","RORX012A",228,0)
 ;--- Create pharmacy list
"RTN","RORX012A",229,0)
 I RORPHARM>0  D  Q:RXLST<0 RXLST
"RTN","RORX012A",230,0)
 . S RXLST=$$ADDVAL^RORTSK11(RORTSK,"DRUGS",,REPORT)
"RTN","RORX012A",231,0)
 . D ADDATTR^RORTSK11(RORTSK,RXLST,"TABLE","DRUGS")
"RTN","RORX012A",232,0)
 ;--- Create patient list
"RTN","RORX012A",233,0)
 I (RORLAB<0)!(RORPHARM<0)  D  Q:PTLST<0 PTLST
"RTN","RORX012A",234,0)
 . S PTLST=$$ADDVAL^RORTSK11(RORTSK,"PATIENTS",,REPORT)
"RTN","RORX012A",235,0)
 . D ADDATTR^RORTSK11(RORTSK,PTLST,"TABLE","PATIENTS")
"RTN","RORX012A",236,0)
 ;---
"RTN","RORX012A",237,0)
 S (CNT,DFN,PTCNT)=0
"RTN","RORX012A",238,0)
 S AGETYPE=$$PARAM^RORTSK01("AGE_RANGE","TYPE")
"RTN","RORX012A",239,0)
 F  S DFN=$O(^TMP("RORX012",$J,"PAT",DFN))  Q:DFN'>0  D  Q:RC<0
"RTN","RORX012A",240,0)
 . S TMP=$S(NSPT>0:CNT/NSPT,1:"")
"RTN","RORX012A",241,0)
 . S RC=$$LOOP^RORTSK01(TMP)  Q:RC<0
"RTN","RORX012A",242,0)
 . S CNT=CNT+1,NODE=$NA(^TMP("RORX012",$J,"PAT",DFN))
"RTN","RORX012A",243,0)
 . ;--- Patient's data
"RTN","RORX012A",244,0)
 . S TMP=$G(@NODE)
"RTN","RORX012A",245,0)
 . S LAST4=$P(TMP,U),PTNAME=$P(TMP,U,2),DOD=$P(TMP,U,3),ICN=$P(TMP,U,4),PACT=$P(TMP,U,5),PCP=$P(TMP,U,6),AGE=$P(TMP,U,7)
"RTN","RORX012A",246,0)
 . ;--- Patient list
"RTN","RORX012A",247,0)
 . S TMP=$S(LTLST<0:1,1:$D(@NODE@("LR"))<10)
"RTN","RORX012A",248,0)
 . I TMP,$S(RXLST<0:1,1:$D(@NODE@("RX"))<10)  D  Q
"RTN","RORX012A",249,0)
 . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"PATIENT",,PTLST,,DFN)
"RTN","RORX012A",250,0)
 . . D ADDVAL^RORTSK11(RORTSK,"NAME",PTNAME,ITEM,1)
"RTN","RORX012A",251,0)
 . . D ADDVAL^RORTSK11(RORTSK,"LAST4",LAST4,ITEM,2)
"RTN","RORX012A",252,0)
 . . I AGETYPE'="ALL" D ADDVAL^RORTSK11(RORTSK,AGETYPE,AGE,ITEM,1)
"RTN","RORX012A",253,0)
 . . D ADDVAL^RORTSK11(RORTSK,"DOD",DOD,ITEM,1)
"RTN","RORX012A",254,0)
 . . I $$PARAM^RORTSK01("PATIENTS","ICN") D ADDVAL^RORTSK11(RORTSK,"ICN",ICN,ITEM,1)
"RTN","RORX012A",255,0)
 . . I $$PARAM^RORTSK01("PATIENTS","PACT") D ADDVAL^RORTSK11(RORTSK,"PACT",PACT,ITEM,1)
"RTN","RORX012A",256,0)
 . . I $$PARAM^RORTSK01("PATIENTS","PCP") D ADDVAL^RORTSK11(RORTSK,"PCP",PCP,ITEM,1)
"RTN","RORX012A",257,0)
 . . S PTCNT=PTCNT+1
"RTN","RORX012A",258,0)
 . ;--- List of Lab tests
"RTN","RORX012A",259,0)
 . S DATE=""
"RTN","RORX012A",260,0)
 . F  S DATE=$O(@NODE@("LR",DATE))  Q:DATE=""  D
"RTN","RORX012A",261,0)
 . . S NAME=""
"RTN","RORX012A",262,0)
 . . F  S NAME=$O(@NODE@("LR",DATE,NAME))  Q:NAME=""  D
"RTN","RORX012A",263,0)
 . . . S IEN=""
"RTN","RORX012A",264,0)
 . . . F  S IEN=$O(@NODE@("LR",DATE,NAME,IEN))  Q:IEN=""  D
"RTN","RORX012A",265,0)
 . . . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"LT",,LTLST,,DFN)
"RTN","RORX012A",266,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"NAME",PTNAME,ITEM,1)
"RTN","RORX012A",267,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"LAST4",LAST4,ITEM,2)
"RTN","RORX012A",268,0)
 . . . . I AGETYPE'="ALL" D ADDVAL^RORTSK11(RORTSK,AGETYPE,AGE,ITEM,1)
"RTN","RORX012A",269,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"DOD",DOD,ITEM,1)
"RTN","RORX012A",270,0)
 . . . . I $$PARAM^RORTSK01("PATIENTS","ICN") D ADDVAL^RORTSK11(RORTSK,"ICN",ICN,ITEM,1)
"RTN","RORX012A",271,0)
 . . . . I $$PARAM^RORTSK01("PATIENTS","PACT") D ADDVAL^RORTSK11(RORTSK,"PACT",PACT,ITEM,1)
"RTN","RORX012A",272,0)
 . . . . I $$PARAM^RORTSK01("PATIENTS","PCP") D ADDVAL^RORTSK11(RORTSK,"PCP",PCP,ITEM,1)
"RTN","RORX012A",273,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"DATE",DATE\1,ITEM,1)
"RTN","RORX012A",274,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"LTNAME",NAME,ITEM,1)
"RTN","RORX012A",275,0)
 . . . . S VAL=$G(@NODE@("LR",DATE,NAME,IEN))
"RTN","RORX012A",276,0)
 . . . . S TMP=$S($$NUMERIC^RORUTL05(VAL):3,1:1)
"RTN","RORX012A",277,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"RESULT",VAL,ITEM,TMP)
"RTN","RORX012A",278,0)
 . ;--- List of drugs
"RTN","RORX012A",279,0)
 . S NAME=""
"RTN","RORX012A",280,0)
 . F  S NAME=$O(@NODE@("RX",NAME))  Q:NAME=""  D
"RTN","RORX012A",281,0)
 . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"DRUG",,RXLST,,DFN)
"RTN","RORX012A",282,0)
 . . D ADDVAL^RORTSK11(RORTSK,"NAME",PTNAME,ITEM,1)
"RTN","RORX012A",283,0)
 . . D ADDVAL^RORTSK11(RORTSK,"LAST4",LAST4,ITEM,2)
"RTN","RORX012A",284,0)
 . . I AGETYPE'="ALL" D ADDVAL^RORTSK11(RORTSK,AGETYPE,AGE,ITEM,1)
"RTN","RORX012A",285,0)
 . . D ADDVAL^RORTSK11(RORTSK,"DOD",DOD,ITEM,1)
"RTN","RORX012A",286,0)
 . . I $$PARAM^RORTSK01("PATIENTS","ICN") D ADDVAL^RORTSK11(RORTSK,"ICN",ICN,ITEM,1)
"RTN","RORX012A",287,0)
 . . I $$PARAM^RORTSK01("PATIENTS","PACT") D ADDVAL^RORTSK11(RORTSK,"PACT",PACT,ITEM,1)
"RTN","RORX012A",288,0)
 . . I $$PARAM^RORTSK01("PATIENTS","PCP") D ADDVAL^RORTSK11(RORTSK,"PCP",PCP,ITEM,1)
"RTN","RORX012A",289,0)
 . . D ADDVAL^RORTSK11(RORTSK,"RXNAME",NAME,ITEM,1)
"RTN","RORX012A",290,0)
 ;--- Inactivate the patient list tag if the list is empty
"RTN","RORX012A",291,0)
 D:PTCNT'>0 UPDVAL^RORTSK11(RORTSK,PTLST,,,1)
"RTN","RORX012A",292,0)
 ;---
"RTN","RORX012A",293,0)
 Q ECNT
"RTN","RORX013")
0^27^B12392289^B9830576
"RTN","RORX013",1,0)
RORX013 ;HOIFO/SG - DIAGNOSIS CODES REPORT ;6/21/06 3:05pm
"RTN","RORX013",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**1,19,21,31**;Feb 17, 2006;Build 62
"RTN","RORX013",3,0)
 ;
"RTN","RORX013",4,0)
 ;******************************************************************************
"RTN","RORX013",5,0)
 ;******************************************************************************
"RTN","RORX013",6,0)
 ; --- ROUTINE MODIFICATION LOG ---
"RTN","RORX013",7,0)
 ; 
"RTN","RORX013",8,0)
 ;PKG/PATCH   DATE       DEVELOPER   MODIFICATION
"RTN","RORX013",9,0)
 ;----------- ---------- ----------- ----------------------------------------
"RTN","RORX013",10,0)
 ;ROR*1.5*19  FEB 2012   J SCOTT     Support for ICD-10 Coding System.
"RTN","RORX013",11,0)
 ;ROR*1.5*19  FEB 2012   J SCOTT     Change entry point ICD9LST to ICDLST. 
"RTN","RORX013",12,0)
 ;ROR*1.5*21  SEP 2013   T KOPP      Add ICN column if Additional Identifier
"RTN","RORX013",13,0)
 ;                                    requested.
"RTN","RORX013",14,0)
 ;ROR*1.5*31   MAY 2017  M FERRARESE  Adding PACT ,PCP,and AGE/DOB as additional
"RTN","RORX013",15,0)
 ;                                    identifiers.
"RTN","RORX013",16,0)
 ;******************************************************************************
"RTN","RORX013",17,0)
 ;******************************************************************************
"RTN","RORX013",18,0)
 ;
"RTN","RORX013",19,0)
 Q
"RTN","RORX013",20,0)
 ;
"RTN","RORX013",21,0)
 ;***** OUTPUTS THE REPORT HEADER
"RTN","RORX013",22,0)
 ;
"RTN","RORX013",23,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX013",24,0)
 ;
"RTN","RORX013",25,0)
 ; Return Values:
"RTN","RORX013",26,0)
 ;       <0  Error code
"RTN","RORX013",27,0)
 ;       >0  IEN of the HEADER element
"RTN","RORX013",28,0)
 ;
"RTN","RORX013",29,0)
HEADER(PARTAG) ;
"RTN","RORX013",30,0)
 ;;ICDLST(#,CODE,DIAG,NP,NC)
"RTN","RORX013",31,0)
 ;;PATIENTS(#,NAME,LAST4,DOD,ICN,PACT,PCP,PTICDL(CODE,DIAG,DATE,SOURCE))^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="ALL"
"RTN","RORX013",32,0)
 ;;PATIENTS(#,NAME,LAST4,AGE,DOD,ICN,PACT,PCP,PTICDL(CODE,DIAG,DATE,SOURCE))^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="AGE"
"RTN","RORX013",33,0)
 ;;PATIENTS(#,NAME,LAST4,DOB,DOD,PACT,PCP,ICN,PTICDL(CODE,DIAG,DATE,SOURCE))^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="DOB"
"RTN","RORX013",34,0)
 ;
"RTN","RORX013",35,0)
 N HEADER,RC
"RTN","RORX013",36,0)
 S HEADER=$$HEADER^RORXU002(.RORTSK,PARTAG)
"RTN","RORX013",37,0)
 Q:HEADER<0 HEADER
"RTN","RORX013",38,0)
 S RC=$$TBLDEF^RORXU002("HEADER^RORX013",HEADER)
"RTN","RORX013",39,0)
 Q $S(RC<0:RC,1:HEADER)
"RTN","RORX013",40,0)
 ;
"RTN","RORX013",41,0)
 ;
"RTN","RORX013",42,0)
 ;***** COMPILES THE "DIAGNOSIS CODE" REPORT
"RTN","RORX013",43,0)
 ; REPORT CODE: 013
"RTN","RORX013",44,0)
 ;
"RTN","RORX013",45,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORX013",46,0)
 ;
"RTN","RORX013",47,0)
 ; The ^TMP("VSIT",$J) global node is used by this function.
"RTN","RORX013",48,0)
 ;
"RTN","RORX013",49,0)
 ; @RORTMP@(
"RTN","RORX013",50,0)
 ;
"RTN","RORX013",51,0)
 ;   "PAT",              Number of patients
"RTN","RORX013",52,0)
 ;     DFN,              Descriptor
"RTN","RORX013",53,0)
 ;                         ^01: Las 4 digits of SSN
"RTN","RORX013",54,0)
 ;                         ^02: Name
"RTN","RORX013",55,0)
 ;                         ^03: Date of Death
"RTN","RORX013",56,0)
 ;                         ^04: ICN
"RTN","RORX013",57,0)
 ;                         ^05: Patient Care Team
"RTN","RORX013",58,0)
 ;                         ^06: Priamary Care Provider
"RTN","RORX013",59,0)
 ;                         ^07: Age/DOB
"RTN","RORX013",60,0)
 ;       ICDIEN,         Earliest Code Descriptor
"RTN","RORX013",61,0)
 ;                         ^01: Date
"RTN","RORX013",62,0)
 ;                         ^02: Source ("I", "O", or "PB")
"RTN","RORX013",63,0)
 ;         "C")          Quantity
"RTN","RORX013",64,0)
 ;         "I")          Inpatient quantity
"RTN","RORX013",65,0)
 ;         "O")          Outpatient quantity
"RTN","RORX013",66,0)
 ;         "PB")         Problem List quantity
"RTN","RORX013",67,0)
 ;
"RTN","RORX013",68,0)
 ;   "ICD",              Totals
"RTN","RORX013",69,0)
 ;                         ^01: Number of ICD codes
"RTN","RORX013",70,0)
 ;                         ^02: Number of different codes
"RTN","RORX013",71,0)
 ;     ICDIEN,           ICD Descriptor
"RTN","RORX013",72,0)
 ;                         ^01: Code
"RTN","RORX013",73,0)
 ;                         ^02: Diagnosis (current version)
"RTN","RORX013",74,0)
 ;       "C")            Quantity
"RTN","RORX013",75,0)
 ;       "P")            Number of unique patients
"RTN","RORX013",76,0)
 ;
"RTN","RORX013",77,0)
 ; Return Values:
"RTN","RORX013",78,0)
 ;       <0  Error code
"RTN","RORX013",79,0)
 ;        0  Ok
"RTN","RORX013",80,0)
 ;
"RTN","RORX013",81,0)
ICDLST(RORTSK) ;
"RTN","RORX013",82,0)
 N ROREDT        ; End date
"RTN","RORX013",83,0)
 N RORICDL       ; Prepared list of ICD codes
"RTN","RORX013",84,0)
 N RORIGRP       ; List of ICD groups
"RTN","RORX013",85,0)
 N RORREG        ; Registry IEN
"RTN","RORX013",86,0)
 N RORSDT        ; Start date
"RTN","RORX013",87,0)
 N RORTMP        ; Closed root of the temporary buffer
"RTN","RORX013",88,0)
 ;
"RTN","RORX013",89,0)
 N ECNT,RC,REPORT,SFLAGS,TMP
"RTN","RORX013",90,0)
 S RORICDL="",(ECNT,RC)=0
"RTN","RORX013",91,0)
 ;--- Root node of the report
"RTN","RORX013",92,0)
 S REPORT=$$ADDVAL^RORTSK11(RORTSK,"REPORT")
"RTN","RORX013",93,0)
 Q:REPORT<0 REPORT
"RTN","RORX013",94,0)
 ;
"RTN","RORX013",95,0)
 ;--- Get and prepare the report parameters
"RTN","RORX013",96,0)
 S RORREG=$$PARAM^RORTSK01("REGIEN")
"RTN","RORX013",97,0)
 S RC=$$PARAMS(REPORT,.RORSDT,.ROREDT,.SFLAGS)  Q:RC<0 RC
"RTN","RORX013",98,0)
 ;
"RTN","RORX013",99,0)
 ;--- Report header
"RTN","RORX013",100,0)
 S RC=$$HEADER(REPORT)  Q:RC<0 RC
"RTN","RORX013",101,0)
 S RORTMP=$$ALLOC^RORTMP()
"RTN","RORX013",102,0)
 D
"RTN","RORX013",103,0)
 . ;--- Query the registry
"RTN","RORX013",104,0)
 . D TPPSETUP^RORTSK01(70)
"RTN","RORX013",105,0)
 . S RC=$$QUERY^RORX013A(SFLAGS)
"RTN","RORX013",106,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX013",107,0)
 . ;--- Sort the data
"RTN","RORX013",108,0)
 . D TPPSETUP^RORTSK01(10)
"RTN","RORX013",109,0)
 . S RC=$$SORT^RORX013A()
"RTN","RORX013",110,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX013",111,0)
 . ;--- Store the results
"RTN","RORX013",112,0)
 . D TPPSETUP^RORTSK01(20)
"RTN","RORX013",113,0)
 . S RC=$$STORE^RORX013C(REPORT)
"RTN","RORX013",114,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX013",115,0)
 ;
"RTN","RORX013",116,0)
 ;--- Cleanup
"RTN","RORX013",117,0)
 D FREE^RORTMP(RORTMP),FREE^RORTMP(RORICDL)
"RTN","RORX013",118,0)
 K ^TMP("VSIT",$J)
"RTN","RORX013",119,0)
 Q $S(RC<0:RC,ECNT>0:-43,1:0)
"RTN","RORX013",120,0)
 ;
"RTN","RORX013",121,0)
 ;***** OUTPUTS THE PARAMETERS TO THE REPORT
"RTN","RORX013",122,0)
 ;
"RTN","RORX013",123,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX013",124,0)
 ;
"RTN","RORX013",125,0)
 ; [.STDT]       Start and end dates of the report
"RTN","RORX013",126,0)
 ; [.ENDT]       are returned via these parameters
"RTN","RORX013",127,0)
 ;
"RTN","RORX013",128,0)
 ; [.FLAGS]      Flags for the $$SKIP^RORXU005 are
"RTN","RORX013",129,0)
 ;               returned via this parameter
"RTN","RORX013",130,0)
 ;
"RTN","RORX013",131,0)
 ; Return Values:
"RTN","RORX013",132,0)
 ;       <0  Error code
"RTN","RORX013",133,0)
 ;       >0  IEN of the PARAMETERS element
"RTN","RORX013",134,0)
 ;
"RTN","RORX013",135,0)
PARAMS(PARTAG,STDT,ENDT,FLAGS) ;
"RTN","RORX013",136,0)
 N PARAMS,TMP
"RTN","RORX013",137,0)
 S PARAMS=$$PARAMS^RORXU002(.RORTSK,PARTAG,.STDT,.ENDT,.FLAGS)
"RTN","RORX013",138,0)
 Q:PARAMS<0 PARAMS
"RTN","RORX013",139,0)
 ;--- Process the list of ICD codes
"RTN","RORX013",140,0)
 S TMP=$$ICDLST^RORXU008(.RORTSK,PARAMS,.RORICDL,.RORIGRP)
"RTN","RORX013",141,0)
 Q:TMP<0 TMP
"RTN","RORX013",142,0)
 ;---
"RTN","RORX013",143,0)
 Q PARAMS
"RTN","RORX013A")
0^28^B88174933^B79404657
"RTN","RORX013A",1,0)
RORX013A ;HCIOFO/SG - DIAGNOSIS CODES (QUERY & SORT) ;6/21/06 2:24pm
"RTN","RORX013A",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**1,13,19,21,25,31**;Feb 17, 2006;Build 62
"RTN","RORX013A",3,0)
 ;
"RTN","RORX013A",4,0)
 ; This routine uses the following IAs:
"RTN","RORX013A",5,0)
 ;
"RTN","RORX013A",6,0)
 ; #928          ACTIVE^GMPLUTL (controlled)
"RTN","RORX013A",7,0)
 ; #1554         POV^PXAPIIB (controlled)
"RTN","RORX013A",8,0)
 ; #1905         SELECTED^VSIT (controlled)
"RTN","RORX013A",9,0)
 ; #2977         GETFLDS^GMPLEDT3 (controlled)
"RTN","RORX013A",10,0)
 ; #3157         RPC^DGPTFAPI (supported)
"RTN","RORX013A",11,0)
 ; #3545         Access to the "AAD" cross-reference and the field 80 (private)
"RTN","RORX013A",12,0)
 ; #92           ^DGPT(IEN,0)  (controlled)
"RTN","RORX013A",13,0)
 ; #5747         $$CODEN^ICDEX, $$CODEC^ICDEX, $$VSTD^ICDEX (controlled)
"RTN","RORX013A",14,0)
 ; #6130         PTFICD^DGPTFUT
"RTN","RORX013A",15,0)
 ;
"RTN","RORX013A",16,0)
 ;******************************************************************************
"RTN","RORX013A",17,0)
 ;******************************************************************************
"RTN","RORX013A",18,0)
 ;                 --- ROUTINE MODIFICATION LOG ---
"RTN","RORX013A",19,0)
 ;        
"RTN","RORX013A",20,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORX013A",21,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","RORX013A",22,0)
 ;ROR*1.5*13   DEC 2010    A SAUNDERS   User can select specific patients,
"RTN","RORX013A",23,0)
 ;                                      clinics, or divisions for the report.
"RTN","RORX013A",24,0)
 ;ROR*1.5*19   FEB 2012    J SCOTT      Support for ICD-10 Coding System.
"RTN","RORX013A",25,0)
 ;ROR*1.5*21   SEP 2013    T KOPP       Add Utilization date range to the report
"RTN","RORX013A",26,0)
 ;                                      Add ICN to report, if requested
"RTN","RORX013A",27,0)
 ;ROR*1.5*25   OCT 2014    T KOPP       Added PTF ICD-10 support for 25 diagnoses
"RTN","RORX013A",28,0)
 ;ROR*1.5*31   MAY 2017    M FERRARESE  Adding PACT ,PCP,and AGE/DOB as additional
"RTN","RORX013A",29,0)
 ;                                      identifiers.                                    
"RTN","RORX013A",30,0)
 ;******************************************************************************
"RTN","RORX013A",31,0)
 ;******************************************************************************
"RTN","RORX013A",32,0)
 Q
"RTN","RORX013A",33,0)
 ;
"RTN","RORX013A",34,0)
 ;**** STORES THE ICD CODE
"RTN","RORX013A",35,0)
 ;
"RTN","RORX013A",36,0)
 ; PATIEN        Patient IEN (DFN)
"RTN","RORX013A",37,0)
 ; SOURCE        ICD source code ("I", "O", "PB")
"RTN","RORX013A",38,0)
 ; [ICDIEN]      IEN of the ICD descriptor in file #80
"RTN","RORX013A",39,0)
 ; DATE          Date when the code was entered
"RTN","RORX013A",40,0)
 ; [ICD]         ICD code
"RTN","RORX013A",41,0)
 ;
"RTN","RORX013A",42,0)
 ; Either the ICDIEN or the ICD parameter must be provided.
"RTN","RORX013A",43,0)
 ;
"RTN","RORX013A",44,0)
ICDSET(PATIEN,SOURCE,ICDIEN,DATE,ICD) ;
"RTN","RORX013A",45,0)
 Q:DATE'>0
"RTN","RORX013A",46,0)
 N TMP
"RTN","RORX013A",47,0)
 S ICDIEN=+$G(ICDIEN)
"RTN","RORX013A",48,0)
 I ICDIEN'>0  Q:$G(ICD)=""  D  Q:ICDIEN'>0
"RTN","RORX013A",49,0)
 . S ICDIEN=+$$CODEN^ICDEX(ICD,80)
"RTN","RORX013A",50,0)
 ;---
"RTN","RORX013A",51,0)
 Q:$$ICDGRCHK^RORXU008(.RORPTGRP,ICDIEN,RORICDL)
"RTN","RORX013A",52,0)
 ;---
"RTN","RORX013A",53,0)
 S TMP=+$G(@RORTMP@("PAT",PATIEN,ICDIEN))
"RTN","RORX013A",54,0)
 S:'TMP!(DATE<TMP) @RORTMP@("PAT",PATIEN,ICDIEN)=DATE_U_SOURCE
"RTN","RORX013A",55,0)
 S ^(SOURCE)=$G(@RORTMP@("PAT",PATIEN,ICDIEN,SOURCE))+1 ;naked reference: ^TMP($J,"RORTMP-n") from RORX013
"RTN","RORX013A",56,0)
 Q
"RTN","RORX013A",57,0)
 ;
"RTN","RORX013A",58,0)
 ;***** SEARCHES FOR INPATIENT DIAGNOSES
"RTN","RORX013A",59,0)
 ;
"RTN","RORX013A",60,0)
 ; PATIEN        Patient IEN (DFN)
"RTN","RORX013A",61,0)
 ;
"RTN","RORX013A",62,0)
 ; Return Values:
"RTN","RORX013A",63,0)
 ;       <0  Error code
"RTN","RORX013A",64,0)
 ;        0  Ok
"RTN","RORX013A",65,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX013A",66,0)
 ;
"RTN","RORX013A",67,0)
INPAT(PATIEN) ;
"RTN","RORX013A",68,0)
 N ADMDT,DISDT,I,IEN,NODE,RC,RORBUF,RORMSG,DIERR,TMP
"RTN","RORX013A",69,0)
 S NODE=$NA(^DGPT("AAD",+PATIEN))
"RTN","RORX013A",70,0)
 S RC=0
"RTN","RORX013A",71,0)
 ;--- Browse through the admissions
"RTN","RORX013A",72,0)
 S ADMDT=ROREDT1
"RTN","RORX013A",73,0)
 F  S ADMDT=$O(@NODE@(ADMDT),-1)  Q:ADMDT'>0  D  Q:RC
"RTN","RORX013A",74,0)
 . S IEN=""
"RTN","RORX013A",75,0)
 . F  S IEN=$O(@NODE@(ADMDT,IEN),-1)  Q:IEN'>0  D  Q:RC
"RTN","RORX013A",76,0)
 . . Q:+$G(^DGPT(IEN,0))'=PATIEN
"RTN","RORX013A",77,0)
 . . Q:$$PTF^RORXU001(IEN,"FP",,.DISDT)
"RTN","RORX013A",78,0)
 . . ;--- Skip invalid and/or incomplete admissions
"RTN","RORX013A",79,0)
 . . I DISDT'>0  D  Q:TMP!(DISDT'>0)
"RTN","RORX013A",80,0)
 . . . S TMP=$$CHKADM^RORXU001(PATIEN,ADMDT,.DISDT)
"RTN","RORX013A",81,0)
 . . ;--- Check if any appropriate admissions are left
"RTN","RORX013A",82,0)
 . . I DISDT<RORSDT  S RC=1  Q
"RTN","RORX013A",83,0)
 . . Q:DISDT'<ROREDT1
"RTN","RORX013A",84,0)
 . . ;--- Load and process the admission data
"RTN","RORX013A",85,0)
 . . K RORBUF  D RPC^DGPTFAPI(.RORBUF,IEN)
"RTN","RORX013A",86,0)
 . . I $G(RORBUF(0))<0  D  Q
"RTN","RORX013A",87,0)
 . . . D ERROR^RORERR(-57,,,,RORBUF(0),"RPC^DGPTFAPI")
"RTN","RORX013A",88,0)
 . . S TMP=$P($G(RORBUF(1)),U,3)
"RTN","RORX013A",89,0)
 . . D:TMP'="" ICDSET(PATIEN,"I",,DISDT,TMP)   ; ICD1
"RTN","RORX013A",90,0)
 . . D:$G(RORBUF(2))'=""                       ; ICD2 - ICD24
"RTN","RORX013A",91,0)
 . . . F I=1:1:24  S TMP=$P(RORBUF(2),U,I)  D:TMP'=""
"RTN","RORX013A",92,0)
 . . . . D ICDSET(PATIEN,"I",,DISDT,TMP)
"RTN","RORX013A",93,0)
 . . S TMP=+$$GET1^DIQ(45,IEN,80,"I",,"RORMSG")
"RTN","RORX013A",94,0)
 . . D:$G(DIERR) DBS^RORERR("RORMSG",-9,,,45,IEN)
"RTN","RORX013A",95,0)
 . . D:TMP>0 ICDSET(PATIEN,"I",TMP,DISDT)     ; PRINCIPAL DIAGNOSIS
"RTN","RORX013A",96,0)
 ;---
"RTN","RORX013A",97,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORX013A",98,0)
 ;
"RTN","RORX013A",99,0)
 ;***** SEARCHES FOR OUTPATIENT DIAGNOSES
"RTN","RORX013A",100,0)
 ;
"RTN","RORX013A",101,0)
 ; PATIEN        Patient IEN (DFN)
"RTN","RORX013A",102,0)
 ;
"RTN","RORX013A",103,0)
 ; Return Values:
"RTN","RORX013A",104,0)
 ;       <0  Error code
"RTN","RORX013A",105,0)
 ;        0  Ok
"RTN","RORX013A",106,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX013A",107,0)
 ;
"RTN","RORX013A",108,0)
OUTPAT(PATIEN) ;
"RTN","RORX013A",109,0)
 N DATE,ICDIEN,RC,RORMSG,RORVPLST,TMP,VPIEN,VSIEN,VSIT
"RTN","RORX013A",110,0)
 D SELECTED^VSIT(PATIEN,RORSDT,ROREDT)
"RTN","RORX013A",111,0)
 ;--- Browse through the visits
"RTN","RORX013A",112,0)
 S (VSIEN,RC)=0
"RTN","RORX013A",113,0)
 F  S VSIEN=$O(^TMP("VSIT",$J,VSIEN))  Q:VSIEN=""  D  Q:RC<0
"RTN","RORX013A",114,0)
 . S TMP=+$O(^TMP("VSIT",$J,VSIEN,""))  Q:TMP'>0
"RTN","RORX013A",115,0)
 . S DATE=$P($G(^TMP("VSIT",$J,VSIEN,TMP)),U)  Q:DATE'>0
"RTN","RORX013A",116,0)
 . ;--- Get a list of V POV records
"RTN","RORX013A",117,0)
 . D POV^PXAPIIB(VSIEN,.RORVPLST)
"RTN","RORX013A",118,0)
 . ;--- Process the records
"RTN","RORX013A",119,0)
 . S (VPIEN,RC)=0
"RTN","RORX013A",120,0)
 . F  S VPIEN=$O(RORVPLST(VPIEN))  Q:VPIEN'>0  D  Q:RC
"RTN","RORX013A",121,0)
 . . S ICDIEN=+$P(RORVPLST(VPIEN),U)
"RTN","RORX013A",122,0)
 . . D:ICDIEN>0 ICDSET(PATIEN,"O",ICDIEN,DATE)
"RTN","RORX013A",123,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORX013A",124,0)
 ;
"RTN","RORX013A",125,0)
 ;***** SEARCHES FOR PROBLEMS
"RTN","RORX013A",126,0)
 ;
"RTN","RORX013A",127,0)
 ; PATIEN        Patient IEN (DFN)
"RTN","RORX013A",128,0)
 ;
"RTN","RORX013A",129,0)
 ; Return Values:
"RTN","RORX013A",130,0)
 ;       <0  Error code
"RTN","RORX013A",131,0)
 ;        0  Ok
"RTN","RORX013A",132,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX013A",133,0)
 ;
"RTN","RORX013A",134,0)
PROBLEM(PATIEN) ;
"RTN","RORX013A",135,0)
 N DATE,GMPFLD,GMPORIG,GMPROV,GMPVAMC,ICDIEN,IEN,IS,RC,RORPLST,TMP
"RTN","RORX013A",136,0)
 ;--- Load a list of active problems
"RTN","RORX013A",137,0)
 D ACTIVE^GMPLUTL(PATIEN,.RORPLST)
"RTN","RORX013A",138,0)
 ;--- Browse through the problems
"RTN","RORX013A",139,0)
 S (GMPVAMC,GMPROV)=0
"RTN","RORX013A",140,0)
 S (IS,RC)=0
"RTN","RORX013A",141,0)
 F  S IS=$O(RORPLST(IS))  Q:IS=""  D  Q:RC
"RTN","RORX013A",142,0)
 . S IEN=+$G(RORPLST(IS,0))  Q:IEN'>0
"RTN","RORX013A",143,0)
 . K GMPFLD,GMPORIG  D GETFLDS^GMPLEDT3(IEN)
"RTN","RORX013A",144,0)
 . S ICDIEN=+$G(GMPFLD(.01))  Q:ICDIEN'>0
"RTN","RORX013A",145,0)
 . S DATE=$P($G(GMPFLD(.08)),U)
"RTN","RORX013A",146,0)
 . D:(DATE'<RORSDT)&(DATE<ROREDT1) ICDSET(PATIEN,"PB",ICDIEN,DATE)
"RTN","RORX013A",147,0)
 Q 0
"RTN","RORX013A",148,0)
 ;
"RTN","RORX013A",149,0)
 ;***** QUERIES THE REGISTRY
"RTN","RORX013A",150,0)
 ;
"RTN","RORX013A",151,0)
 ; FLAGS         Flags for the $$SKIP^RORXU005
"RTN","RORX013A",152,0)
 ;
"RTN","RORX013A",153,0)
 ; Return Values:
"RTN","RORX013A",154,0)
 ;       <0  Error code
"RTN","RORX013A",155,0)
 ;        0  Ok
"RTN","RORX013A",156,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX013A",157,0)
 ;
"RTN","RORX013A",158,0)
QUERY(FLAGS) ;
"RTN","RORX013A",159,0)
 N RORDOD        ; Date of death
"RTN","RORX013A",160,0)
 N ROREDT1       ; Day after the end date
"RTN","RORX013A",161,0)
 N RORLAST4      ; Last 4 digits of the current patient's SSN
"RTN","RORX013A",162,0)
 N RORPNAME      ; Name of the current patient
"RTN","RORX013A",163,0)
 N RORICN        ; ICN of patient (optional)
"RTN","RORX013A",164,0)
 N RORPACT       ; PACT of patient (optional)
"RTN","RORX013A",165,0)
 N RORPCP        ; PCP of patient (optional) 
"RTN","RORX013A",166,0)
 N RORPTGRP      ; Temporary list of ICD groups
"RTN","RORX013A",167,0)
 N RORPTN        ; Number of patients in the registry
"RTN","RORX013A",168,0)
 N RORCDLIST     ; Flag to indicate whether a clinic or division list exists
"RTN","RORX013A",169,0)
 N RORCDSTDT     ; Start date for clinic/division utilization search
"RTN","RORX013A",170,0)
 N RORCDENDT     ; End date for clinic/division utilization search
"RTN","RORX013A",171,0)
 ;
"RTN","RORX013A",172,0)
 N CNT,ECNT,IEN,IENS,PATIEN,RC,SKIPEDT,SKIPSDT,TMP,UTEDT,UTIL,UTSDT,VA,VADM,XREFNODE,AGE,AGETYPE
"RTN","RORX013A",173,0)
 ;--- Utilization date range
"RTN","RORX013A",174,0)
 D:$$PARAM^RORTSK01("PATIENTS","CAREONLY")
"RTN","RORX013A",175,0)
 . S UTSDT=$$PARAM^RORTSK01("DATE_RANGE_3","START")\1
"RTN","RORX013A",176,0)
 . S UTEDT=$$PARAM^RORTSK01("DATE_RANGE_3","END")\1
"RTN","RORX013A",177,0)
 . ;--- Combined date range
"RTN","RORX013A",178,0)
 . S SKIPSDT=$$DTMIN^RORUTL18(SKIPSDT,UTSDT)
"RTN","RORX013A",179,0)
 . S SKIPEDT=$$DTMAX^RORUTL18(SKIPEDT,UTEDT)
"RTN","RORX013A",180,0)
 S XREFNODE=$NA(^RORDATA(798,"AC",+RORREG))
"RTN","RORX013A",181,0)
 S RORPTN=$$REGSIZE^RORUTL02(+RORREG)  S:RORPTN<0 RORPTN=0
"RTN","RORX013A",182,0)
 S ROREDT1=$$FMADD^XLFDT(ROREDT\1,1)
"RTN","RORX013A",183,0)
 S (CNT,ECNT,RC)=0
"RTN","RORX013A",184,0)
 ;
"RTN","RORX013A",185,0)
 ;=== Set up Clinic/Division list parameters
"RTN","RORX013A",186,0)
 S RORCDLIST=$$CDPARMS^RORXU001(.RORTSK,.RORCDSTDT,.RORCDENDT)
"RTN","RORX013A",187,0)
 ;
"RTN","RORX013A",188,0)
 ;--- Browse through the registry records
"RTN","RORX013A",189,0)
 S IEN=0
"RTN","RORX013A",190,0)
 F  S IEN=$O(@XREFNODE@(IEN))  Q:IEN'>0  D  Q:RC<0
"RTN","RORX013A",191,0)
 . S TMP=$S(RORPTN>0:CNT/RORPTN,1:"")
"RTN","RORX013A",192,0)
 . S RC=$$LOOP^RORTSK01(TMP)  Q:RC<0
"RTN","RORX013A",193,0)
 . S IENS=IEN_",",CNT=CNT+1
"RTN","RORX013A",194,0)
 . ;--- Get patient DFN
"RTN","RORX013A",195,0)
 . S PATIEN=$$PTIEN^RORUTL01(IEN)  Q:PATIEN'>0
"RTN","RORX013A",196,0)
 . ;check for patient list and quit if not on list
"RTN","RORX013A",197,0)
 . I $D(RORTSK("PARAMS","PATIENTS","C")),'$D(RORTSK("PARAMS","PATIENTS","C",PATIEN)) Q
"RTN","RORX013A",198,0)
 . ;--- Check if the patient should be skipped
"RTN","RORX013A",199,0)
 . Q:$$SKIP^RORXU005(IEN,FLAGS,RORSDT,ROREDT)
"RTN","RORX013A",200,0)
 . ;
"RTN","RORX013A",201,0)
 . ;--- Check for Clinic or Division list and quit if not in list
"RTN","RORX013A",202,0)
 . I RORCDLIST,'$$CDUTIL^RORXU001(.RORTSK,PATIEN,RORCDSTDT,RORCDENDT) Q
"RTN","RORX013A",203,0)
 . ;
"RTN","RORX013A",204,0)
 . ;--- Check for any utilization in the corresponding date range
"RTN","RORX013A",205,0)
 . I $$PARAM^RORTSK01("PATIENTS","CAREONLY") D  Q:'UTIL
"RTN","RORX013A",206,0)
 . . K TMP  S TMP("ALL")=1
"RTN","RORX013A",207,0)
 . . S UTIL=+$$UTIL^RORXU003(UTSDT,UTEDT,PATIEN,.TMP)
"RTN","RORX013A",208,0)
 . ;
"RTN","RORX013A",209,0)
 . M RORPTGRP=RORIGRP("C")
"RTN","RORX013A",210,0)
 . ;
"RTN","RORX013A",211,0)
 . ;--- Inpatient codes
"RTN","RORX013A",212,0)
 . S RC=$$INPAT(PATIEN)
"RTN","RORX013A",213,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX013A",214,0)
 . ;
"RTN","RORX013A",215,0)
 . ;--- Outpatient codes
"RTN","RORX013A",216,0)
 . S RC=$$OUTPAT(PATIEN)
"RTN","RORX013A",217,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX013A",218,0)
 . ;
"RTN","RORX013A",219,0)
 . ;--- Problem list
"RTN","RORX013A",220,0)
 . S RC=$$PROBLEM(PATIEN)
"RTN","RORX013A",221,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX013A",222,0)
 . ;
"RTN","RORX013A",223,0)
 . ;--- Skip the patient if no data has been found
"RTN","RORX013A",224,0)
 . Q:$D(@RORTMP@("PAT",PATIEN))<10
"RTN","RORX013A",225,0)
 . ;--- No ICD from some groups
"RTN","RORX013A",226,0)
 . I $D(RORPTGRP)>1  K @RORTMP@("PAT",PATIEN)  Q
"RTN","RORX013A",227,0)
 . ;
"RTN","RORX013A",228,0)
 . ;--- Get the patient's data
"RTN","RORX013A",229,0)
 . D VADEM^RORUTL05(PATIEN,1)
"RTN","RORX013A",230,0)
 . S RORPNAME=VADM(1),RORDOD=$$DATE^RORXU002($P(VADM(6),U)\1),RORLAST4=VA("BID")
"RTN","RORX013A",231,0)
 . I $$PARAM^RORTSK01("PATIENTS","ICN") S RORICN=$$ICN^RORUTL02(PATIEN)
"RTN","RORX013A",232,0)
 . S AGETYPE=$$PARAM^RORTSK01("AGE_RANGE","TYPE")
"RTN","RORX013A",233,0)
 . S AGE=$S(AGETYPE="AGE":$P(VADM(4),U),AGETYPE="DOB":$$DATE^RORXU002($P(VADM(3),U)\1),1:"")
"RTN","RORX013A",234,0)
 . I $$PARAM^RORTSK01("PATIENTS","PACT") S RORPACT=$$PACT^RORUTL02(PATIEN)
"RTN","RORX013A",235,0)
 . I $$PARAM^RORTSK01("PATIENTS","PCP") S RORPCP=$$PCP^RORUTL02(PATIEN)
"RTN","RORX013A",236,0)
 . ;
"RTN","RORX013A",237,0)
 . ;--- Calculate the patient's totals
"RTN","RORX013A",238,0)
 . S RC=$$TOTALS(PATIEN)
"RTN","RORX013A",239,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX013A",240,0)
 ;---
"RTN","RORX013A",241,0)
 Q $S(RC<0:RC,1:ECNT)
"RTN","RORX013A",242,0)
 ;
"RTN","RORX013A",243,0)
 ;***** SORTS THE RESULTS AND COMPILES THE TOTALS
"RTN","RORX013A",244,0)
 ;
"RTN","RORX013A",245,0)
 ; Return Values:
"RTN","RORX013A",246,0)
 ;       <0  Error code
"RTN","RORX013A",247,0)
 ;        0  Ok
"RTN","RORX013A",248,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX013A",249,0)
 ;
"RTN","RORX013A",250,0)
SORT() ;
"RTN","RORX013A",251,0)
 N ICDIEN,TMP,TNC,TNDC
"RTN","RORX013A",252,0)
 ;---
"RTN","RORX013A",253,0)
 S ICDIEN=0,(TNC,TNDC)=0
"RTN","RORX013A",254,0)
 F  S ICDIEN=$O(@RORTMP@("ICD",ICDIEN))  Q:ICDIEN'>0  D
"RTN","RORX013A",255,0)
 . S TNC=TNC+$G(@RORTMP@("ICD",ICDIEN,"C"))
"RTN","RORX013A",256,0)
 . S TNDC=TNDC+1
"RTN","RORX013A",257,0)
 S @RORTMP@("ICD")=TNC_U_TNDC
"RTN","RORX013A",258,0)
 ;---
"RTN","RORX013A",259,0)
 Q 0
"RTN","RORX013A",260,0)
 ;
"RTN","RORX013A",261,0)
 ;***** CALCULATES INTERMEDIATE TOTALS
"RTN","RORX013A",262,0)
 ;
"RTN","RORX013A",263,0)
 ; PATIEN        Patient IEN (DFN)
"RTN","RORX013A",264,0)
 ;
"RTN","RORX013A",265,0)
 ; Return Values:
"RTN","RORX013A",266,0)
 ;       <0  Error code
"RTN","RORX013A",267,0)
 ;        0  Ok
"RTN","RORX013A",268,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX013A",269,0)
 ;
"RTN","RORX013A",270,0)
TOTALS(PATIEN) ;
"RTN","RORX013A",271,0)
 N CNT,ICD,ICDIEN,ICDVST,PNODE,RC,TMP
"RTN","RORX013A",272,0)
 S PNODE=$NA(@RORTMP@("PAT",PATIEN))
"RTN","RORX013A",273,0)
 S @PNODE=RORLAST4_U_RORPNAME_U_RORDOD_U_$G(RORICN)_U_$G(RORPACT)_U_$G(RORPCP)_U_AGE
"RTN","RORX013A",274,0)
 S ^("PAT")=$G(@RORTMP@("PAT"))+1 ;naked reference: ^TMP($J,"RORTMP-n") from RORX013
"RTN","RORX013A",275,0)
 ;
"RTN","RORX013A",276,0)
 S ICDIEN=0
"RTN","RORX013A",277,0)
 F  S ICDIEN=$O(@PNODE@(ICDIEN))  Q:ICDIEN'>0  D
"RTN","RORX013A",278,0)
 . S ICD=$P($G(@RORTMP@("ICD",ICDIEN)),U)
"RTN","RORX013A",279,0)
 . I ICD=""  D
"RTN","RORX013A",280,0)
 . . S ICD=$$CODEC^ICDEX(80,ICDIEN)
"RTN","RORX013A",281,0)
 . . S ICDVST=$$VSTD^ICDEX(ICDIEN)
"RTN","RORX013A",282,0)
 . . S:ICD="" ICD="UNKN"
"RTN","RORX013A",283,0)
 . . S:ICDVST="" ICDVST="Unknown ("_ICDIEN_")"
"RTN","RORX013A",284,0)
 . . S @RORTMP@("ICD",ICDIEN)=ICD_U_ICDVST
"RTN","RORX013A",285,0)
 . ;---
"RTN","RORX013A",286,0)
 . S CNT=0
"RTN","RORX013A",287,0)
 . F TMP="I","O","PB"  S CNT=CNT+$G(@PNODE@(ICDIEN,TMP))
"RTN","RORX013A",288,0)
 . S @PNODE@(ICDIEN,"C")=CNT
"RTN","RORX013A",289,0)
 . S ^("C")=$G(@RORTMP@("ICD",ICDIEN,"C"))+CNT ;naked reference: ^TMP($J,"RORTMP-n") from RORX013
"RTN","RORX013A",290,0)
 . S ^("P")=$G(@RORTMP@("ICD",ICDIEN,"P"))+1 ;naked reference: ^TMP($J,"RORTMP-n") from RORX013
"RTN","RORX013A",291,0)
 Q 0
"RTN","RORX013C")
0^29^B19770411^B16710528
"RTN","RORX013C",1,0)
RORX013C ;HCIOFO/SG - DIAGNOSIS CODES (STORE) ;10/27/05 11:11am
"RTN","RORX013C",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**19,21,31**;Feb 17, 2006;Build 62
"RTN","RORX013C",3,0)
 ;
"RTN","RORX013C",4,0)
 ; This routine uses the following IAs:
"RTN","RORX013C",5,0)
 ;
"RTN","RORX013C",6,0)
 ; #5747         $$ICDDX^ICDEX, $$CSI^ICDEX (controlled)
"RTN","RORX013C",7,0)
 ;
"RTN","RORX013C",8,0)
 ;******************************************************************************
"RTN","RORX013C",9,0)
 ;******************************************************************************
"RTN","RORX013C",10,0)
 ; --- ROUTINE MODIFICATION LOG ---
"RTN","RORX013C",11,0)
 ; 
"RTN","RORX013C",12,0)
 ;PKG/PATCH   DATE       DEVELOPER   MODIFICATION
"RTN","RORX013C",13,0)
 ;----------- ---------- ----------- ----------------------------------------
"RTN","RORX013C",14,0)
 ;ROR*1.5*19  FEB 2012   J SCOTT     Support for ICD-10 Coding System.
"RTN","RORX013C",15,0)
 ;ROR*1.5*21  SEP 2013   T KOPP      Add ICN column if Additional Identifier
"RTN","RORX013C",16,0)
 ;                                    requested.
"RTN","RORX013C",17,0)
 ;ROR*1.5*31   MAY 2017  M FERRARESE  Adding PACT ,PCP,and AGE/DOB as additional
"RTN","RORX013C",18,0)
 ;                                    identifiers.
"RTN","RORX013C",19,0)
 ;******************************************************************************
"RTN","RORX013C",20,0)
 ;******************************************************************************
"RTN","RORX013C",21,0)
 ;
"RTN","RORX013C",22,0)
 Q
"RTN","RORX013C",23,0)
 ;
"RTN","RORX013C",24,0)
 ;***** STORES THE ICD CODE TABLE
"RTN","RORX013C",25,0)
 ;
"RTN","RORX013C",26,0)
 ; PTAG          IEN of the parent element
"RTN","RORX013C",27,0)
 ;
"RTN","RORX013C",28,0)
 ; NODE          Closed root of the node of the temporary global
"RTN","RORX013C",29,0)
 ;
"RTN","RORX013C",30,0)
 ; Return Values:
"RTN","RORX013C",31,0)
 ;       <0  Error code
"RTN","RORX013C",32,0)
 ;        0  Ok
"RTN","RORX013C",33,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX013C",34,0)
 ;
"RTN","RORX013C",35,0)
CODES(PTAG,NODE) ;
"RTN","RORX013C",36,0)
 N ICDIEN,ITEM,TABLE,TMP,RORICDSYS,RORICDCODE
"RTN","RORX013C",37,0)
 S TABLE=$$ADDVAL^RORTSK11(RORTSK,"ICDLST",,PTAG)
"RTN","RORX013C",38,0)
 Q:TABLE<0 TABLE
"RTN","RORX013C",39,0)
 D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","ICDLST")
"RTN","RORX013C",40,0)
 S ICDIEN=0
"RTN","RORX013C",41,0)
 F  S ICDIEN=$O(@NODE@("ICD",ICDIEN))  Q:ICDIEN'>0  D
"RTN","RORX013C",42,0)
 . S RORICDSYS=+$$CSI^ICDEX(80,ICDIEN)
"RTN","RORX013C",43,0)
 . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"ICD",,TABLE)
"RTN","RORX013C",44,0)
 . S TMP=@NODE@("ICD",ICDIEN)
"RTN","RORX013C",45,0)
 . S RORICDCODE="("_$S(RORICDSYS=1:"ICD-9",RORICDSYS=30:"ICD-10",1:"UNKN")_") "_$P(TMP,U,1)
"RTN","RORX013C",46,0)
 . D ADDVAL^RORTSK11(RORTSK,"CODE",RORICDCODE,ITEM,2)
"RTN","RORX013C",47,0)
 . D ADDVAL^RORTSK11(RORTSK,"DIAG",$P(TMP,U,2),ITEM,2)
"RTN","RORX013C",48,0)
 . S TMP=$G(@NODE@("ICD",ICDIEN,"P"))
"RTN","RORX013C",49,0)
 . D ADDVAL^RORTSK11(RORTSK,"NP",TMP,ITEM,3)
"RTN","RORX013C",50,0)
 . S TMP=$G(@NODE@("ICD",ICDIEN,"C"))
"RTN","RORX013C",51,0)
 . D ADDVAL^RORTSK11(RORTSK,"NC",TMP,ITEM,3)
"RTN","RORX013C",52,0)
 Q 0
"RTN","RORX013C",53,0)
 ;
"RTN","RORX013C",54,0)
 ;***** STORES THE PATIENT TABLE
"RTN","RORX013C",55,0)
 ;
"RTN","RORX013C",56,0)
 ; PTAG          IEN of the parent element
"RTN","RORX013C",57,0)
 ;
"RTN","RORX013C",58,0)
 ; NODE          Closed root of the node of the temporary global
"RTN","RORX013C",59,0)
 ;
"RTN","RORX013C",60,0)
 ; Return Values:
"RTN","RORX013C",61,0)
 ;       <0  Error code
"RTN","RORX013C",62,0)
 ;        0  Ok
"RTN","RORX013C",63,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX013C",64,0)
 ;
"RTN","RORX013C",65,0)
PATIENTS(PTAG,NODE) ;
"RTN","RORX013C",66,0)
 N DATE,ICD,ICDIEN,ITEM,PATIEN,PTICDL,SOURCE,TABLE,TMP,RORICDSYS,RORICDCODE,AGETYPE
"RTN","RORX013C",67,0)
 S TABLE=$$ADDVAL^RORTSK11(RORTSK,"PATIENTS",,PTAG)
"RTN","RORX013C",68,0)
 Q:TABLE<0 TABLE
"RTN","RORX013C",69,0)
 D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","PATIENTS")
"RTN","RORX013C",70,0)
 S PATIEN=0
"RTN","RORX013C",71,0)
 S AGETYPE=$$PARAM^RORTSK01("AGE_RANGE","TYPE")
"RTN","RORX013C",72,0)
 F  S PATIEN=$O(@NODE@("PAT",PATIEN))  Q:PATIEN'>0  D
"RTN","RORX013C",73,0)
 . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"PATIENT",,TABLE)
"RTN","RORX013C",74,0)
 . S TMP=@NODE@("PAT",PATIEN)
"RTN","RORX013C",75,0)
 . D ADDVAL^RORTSK11(RORTSK,"NAME",$P(TMP,U,2),ITEM,2)
"RTN","RORX013C",76,0)
 . D ADDVAL^RORTSK11(RORTSK,"LAST4",$P(TMP,U,1),ITEM,2)
"RTN","RORX013C",77,0)
 . I AGETYPE'="ALL" D ADDVAL^RORTSK11(RORTSK,AGETYPE,$P(TMP,U,7),ITEM,1)
"RTN","RORX013C",78,0)
 . D ADDVAL^RORTSK11(RORTSK,"DOD",$P(TMP,U,3),ITEM,1)
"RTN","RORX013C",79,0)
 . I $$PARAM^RORTSK01("PATIENTS","ICN") D ADDVAL^RORTSK11(RORTSK,"ICN",$P(TMP,U,4),ITEM,1)
"RTN","RORX013C",80,0)
 . I $$PARAM^RORTSK01("PATIENTS","PACT") D ADDVAL^RORTSK11(RORTSK,"PACT",$P(TMP,U,5),ITEM,1)
"RTN","RORX013C",81,0)
 . I $$PARAM^RORTSK01("PATIENTS","PCP") D ADDVAL^RORTSK11(RORTSK,"PCP",$P(TMP,U,6),ITEM,1)
"RTN","RORX013C",82,0)
 . S PTICDL=$$ADDVAL^RORTSK11(RORTSK,"PTICDL",,ITEM)
"RTN","RORX013C",83,0)
 . S ICDIEN=0
"RTN","RORX013C",84,0)
 . F  S ICDIEN=$O(@NODE@("PAT",PATIEN,ICDIEN))  Q:ICDIEN'>0  D
"RTN","RORX013C",85,0)
 . . S RORICDSYS=+$$CSI^ICDEX(80,ICDIEN)
"RTN","RORX013C",86,0)
 . . S ICD=$$ADDVAL^RORTSK11(RORTSK,"ICD",,PTICDL)
"RTN","RORX013C",87,0)
 . . S TMP=$G(@NODE@("PAT",PATIEN,ICDIEN))
"RTN","RORX013C",88,0)
 . . S DATE=$P(TMP,U),SOURCE=$P(TMP,U,2)
"RTN","RORX013C",89,0)
 . . S TMP=$$ICDDX^ICDEX(ICDIEN,DATE,,"I")
"RTN","RORX013C",90,0)
 . . S:TMP<0 TMP=""
"RTN","RORX013C",91,0)
 . . S RORICDCODE="("_$S(RORICDSYS=1:"ICD-9",RORICDSYS=30:"ICD-10",1:"UNKN")_") "_$P(TMP,U,2)
"RTN","RORX013C",92,0)
 . . D ADDVAL^RORTSK11(RORTSK,"CODE",RORICDCODE,ICD,2)
"RTN","RORX013C",93,0)
 . . D ADDVAL^RORTSK11(RORTSK,"DIAG",$P(TMP,U,4),ICD,2)
"RTN","RORX013C",94,0)
 . . D ADDVAL^RORTSK11(RORTSK,"DATE",DATE\1,ICD,1)
"RTN","RORX013C",95,0)
 . . D ADDVAL^RORTSK11(RORTSK,"SOURCE",SOURCE,ICD,2)
"RTN","RORX013C",96,0)
 Q 0
"RTN","RORX013C",97,0)
 ;
"RTN","RORX013C",98,0)
 ;***** STORES THE REPORT DATA
"RTN","RORX013C",99,0)
 ;
"RTN","RORX013C",100,0)
 ; REPORT        IEN of the REPORT element
"RTN","RORX013C",101,0)
 ;
"RTN","RORX013C",102,0)
 ; Return Values:
"RTN","RORX013C",103,0)
 ;       <0  Error code
"RTN","RORX013C",104,0)
 ;        0  Ok
"RTN","RORX013C",105,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX013C",106,0)
 ;
"RTN","RORX013C",107,0)
STORE(REPORT) ;
"RTN","RORX013C",108,0)
 N ECNT,ICDIEN,PATIEN,RC,SECTION,TMP
"RTN","RORX013C",109,0)
 S (ECNT,RC)=0
"RTN","RORX013C",110,0)
 ;--- Diagnosis codes
"RTN","RORX013C",111,0)
 S RC=$$CODES(REPORT,RORTMP)
"RTN","RORX013C",112,0)
 I RC  Q:RC<0 RC  S ECNT=ECNT+RC
"RTN","RORX013C",113,0)
 S RC=$$LOOP^RORTSK01(.4)  Q:RC<0 RC
"RTN","RORX013C",114,0)
 ;--- Patients
"RTN","RORX013C",115,0)
 S TMP=$$PARAM^RORTSK01("OPTIONS","COMPLETE")
"RTN","RORX013C",116,0)
 I TMP  D  I RC  Q:RC<0 RC  S ECNT=ECNT+RC
"RTN","RORX013C",117,0)
 . S RC=$$PATIENTS(REPORT,RORTMP)
"RTN","RORX013C",118,0)
 S RC=$$LOOP^RORTSK01(.99)  Q:RC<0 RC
"RTN","RORX013C",119,0)
 ;--- Totals
"RTN","RORX013C",120,0)
 S SECTION=$$ADDVAL^RORTSK11(RORTSK,"SUMMARY",,REPORT)
"RTN","RORX013C",121,0)
 Q:SECTION<0 SECTION
"RTN","RORX013C",122,0)
 S TMP=$G(@RORTMP@("ICD"))
"RTN","RORX013C",123,0)
 D ADDVAL^RORTSK11(RORTSK,"NC",+$P(TMP,U,1),SECTION)
"RTN","RORX013C",124,0)
 D ADDVAL^RORTSK11(RORTSK,"NDC",+$P(TMP,U,2),SECTION)
"RTN","RORX013C",125,0)
 S TMP=$G(@RORTMP@("PAT"))
"RTN","RORX013C",126,0)
 D ADDVAL^RORTSK11(RORTSK,"NP",+TMP,SECTION)
"RTN","RORX013C",127,0)
 ;---
"RTN","RORX013C",128,0)
 Q ECNT
"RTN","RORX014")
0^30^B13414286^B10669506
"RTN","RORX014",1,0)
RORX014 ;HOIFO/SG - REGISTRY MEDICATIONS REPORT ;11/25/05 5:57pm
"RTN","RORX014",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**21,31**;Feb 17, 2006;Build 62
"RTN","RORX014",3,0)
 ;
"RTN","RORX014",4,0)
 Q
"RTN","RORX014",5,0)
 ;******************************************************************************
"RTN","RORX014",6,0)
 ;                 --- ROUTINE MODIFICATION LOG ---
"RTN","RORX014",7,0)
 ;        
"RTN","RORX014",8,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORX014",9,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","RORX014",10,0)
 ;ROR*1.5*21   SEP 2013    T KOPP       Added ICN as last report column if
"RTN","RORX014",11,0)
 ;                                      additional identifier option selected
"RTN","RORX014",12,0)
 ;ROR*1.5*31   MAY 2017    M FERRARESE  Adding PACT ,PCP,and AGE/DOB as additional
"RTN","RORX014",13,0)
 ;                                      identifiers.
"RTN","RORX014",14,0)
 ;******************************************************************************
"RTN","RORX014",15,0)
 ;
"RTN","RORX014",16,0)
 ;***** OUTPUTS THE REPORT HEADER
"RTN","RORX014",17,0)
 ;
"RTN","RORX014",18,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX014",19,0)
 ;
"RTN","RORX014",20,0)
 ; Return Values:
"RTN","RORX014",21,0)
 ;       <0  Error code
"RTN","RORX014",22,0)
 ;       >0  IEN of the HEADER element
"RTN","RORX014",23,0)
 ;
"RTN","RORX014",24,0)
HEADER(PARTAG) ;
"RTN","RORX014",25,0)
 ;;RXCOMBLST(NP,PATIENTS(NAME,LAST4,DOD,ICN,PACT,PCP))^I $$PARAM^RORTSK01("OPTIONS","COMPLETE"),$$PARAM^RORTSK01("AGE_RANGE","TYPE")="ALL"
"RTN","RORX014",26,0)
 ;;RXCOMBLST(NP,PATIENTS(NAME,LAST4,AGE,DOD,ICN,PACT,PCP))^I $$PARAM^RORTSK01("OPTIONS","COMPLETE"),$$PARAM^RORTSK01("AGE_RANGE","TYPE")="AGE"
"RTN","RORX014",27,0)
 ;;RXCOMBLST(NP,PATIENTS(NAME,LAST4,DOB,DOD,ICN,PACT,PCP))^I $$PARAM^RORTSK01("OPTIONS","COMPLETE"),$$PARAM^RORTSK01("AGE_RANGE","TYPE")="DOB"
"RTN","RORX014",28,0)
 ;;RXCOMBLST(NP,RXCOMB)^I $$PARAM^RORTSK01("OPTIONS","SUMMARY")
"RTN","RORX014",29,0)
 ;
"RTN","RORX014",30,0)
 N HEADER,RC
"RTN","RORX014",31,0)
 S HEADER=$$HEADER^RORXU002(.RORTSK,PARTAG)
"RTN","RORX014",32,0)
 Q:HEADER<0 HEADER
"RTN","RORX014",33,0)
 S RC=$$TBLDEF^RORXU002("HEADER^RORX014",HEADER)
"RTN","RORX014",34,0)
 Q $S(RC<0:RC,1:HEADER)
"RTN","RORX014",35,0)
 ;
"RTN","RORX014",36,0)
 ;***** OUTPUTS THE PARAMETERS TO THE REPORT
"RTN","RORX014",37,0)
 ;
"RTN","RORX014",38,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX014",39,0)
 ;
"RTN","RORX014",40,0)
 ; [.STDT]       Start and end dates of the report
"RTN","RORX014",41,0)
 ; [.ENDT]       are returned via these parameters
"RTN","RORX014",42,0)
 ;
"RTN","RORX014",43,0)
 ; [.FLAGS]      Flags for the $$SKIP^RORXU005 are
"RTN","RORX014",44,0)
 ;               returned via this parameter
"RTN","RORX014",45,0)
 ;
"RTN","RORX014",46,0)
 ; Return Values:
"RTN","RORX014",47,0)
 ;       <0  Error code
"RTN","RORX014",48,0)
 ;       >0  IEN of the PARAMETERS element
"RTN","RORX014",49,0)
 ;
"RTN","RORX014",50,0)
PARAMS(PARTAG,STDT,ENDT,FLAGS) ;
"RTN","RORX014",51,0)
 N PARAMS,RC
"RTN","RORX014",52,0)
 S PARAMS=$$PARAMS^RORXU002(.RORTSK,PARTAG,.STDT,.ENDT,.FLAGS)
"RTN","RORX014",53,0)
 Q:PARAMS<0 PARAMS
"RTN","RORX014",54,0)
 ;--- Process the drug list and options
"RTN","RORX014",55,0)
 S RORTSK("PARAMS","DRUGS","A","REGMEDS")=1
"RTN","RORX014",56,0)
 S RORTSK("PARAMS","DRUGS","A","AGGR_GENERIC")=1
"RTN","RORX014",57,0)
 S RC=$$DRUGLST^RORXU007(.RORTSK,PARAMS,.RORXL)
"RTN","RORX014",58,0)
 Q:RC<0 RC
"RTN","RORX014",59,0)
 ;--- Success
"RTN","RORX014",60,0)
 Q PARAMS
"RTN","RORX014",61,0)
 ;
"RTN","RORX014",62,0)
 ;***** COMPILES THE "REGISTRY MEDICATIONS" REPORT
"RTN","RORX014",63,0)
 ; REPORT CODE: 014
"RTN","RORX014",64,0)
 ;
"RTN","RORX014",65,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORX014",66,0)
 ;
"RTN","RORX014",67,0)
 ; The ^TMP("RORX014",$J) global node is used by this function.
"RTN","RORX014",68,0)
 ;
"RTN","RORX014",69,0)
 ; ^TMP("RORX014",$J,
"RTN","RORX014",70,0)
 ;   "DRG",
"RTN","RORX014",71,0)
 ;     DrugIEN)          Medication name (generic or formulation)
"RTN","RORX014",72,0)
 ;   "RXC",
"RTN","RORX014",73,0)
 ;     RxcIEN,
"RTN","RORX014",74,0)
 ;       1)              List of Drug IEN's separated by ","
"RTN","RORX014",75,0)
 ;       "P"             Number of patients
"RTN","RORX014",76,0)
 ;         DFN)          Patient Descriptor
"RTN","RORX014",77,0)
 ;                         ^01: Las 4 digits of SSN
"RTN","RORX014",78,0)
 ;                         ^02: Name
"RTN","RORX014",79,0)
 ;                         ^03: Date of Death
"RTN","RORX014",80,0)
 ;                         ^04: ICN
"RTN","RORX014",81,0)
 ;                         ^05: Age/DOB
"RTN","RORX014",82,0)
 ;     "B",
"RTN","RORX014",83,0)
 ;       RxcNdx,
"RTN","RORX014",84,0)
 ;         RxcIEN)       ""
"RTN","RORX014",85,0)
 ;     "P",
"RTN","RORX014",86,0)
 ;       NumOfPat,
"RTN","RORX014",87,0)
 ;         RxcIEN)       ""
"RTN","RORX014",88,0)
 ;
"RTN","RORX014",89,0)
 ; RxcNdx is the first 100 characters of the list of Drug IEN's.
"RTN","RORX014",90,0)
 ;
"RTN","RORX014",91,0)
 ; Return Values:
"RTN","RORX014",92,0)
 ;       <0  Error code
"RTN","RORX014",93,0)
 ;        0  Ok
"RTN","RORX014",94,0)
 ;
"RTN","RORX014",95,0)
RXCOMB(RORTSK) ;
"RTN","RORX014",96,0)
 N ROREDT        ; End date
"RTN","RORX014",97,0)
 N ROREDT1       ; End date + 1
"RTN","RORX014",98,0)
 N RORREG        ; Registry IEN
"RTN","RORX014",99,0)
 N RORSDT        ; Start date
"RTN","RORX014",100,0)
 N RORXL         ; Drug list for the pharmacy search API
"RTN","RORX014",101,0)
 ;
"RTN","RORX014",102,0)
 N ECNT,NRXC,RC,REPORT,SFLAGS,TMP
"RTN","RORX014",103,0)
 S RORXL="",(ECNT,RC)=0
"RTN","RORX014",104,0)
 K ^TMP("RORX014",$J)
"RTN","RORX014",105,0)
 ;--- Root node of the report
"RTN","RORX014",106,0)
 S REPORT=$$ADDVAL^RORTSK11(RORTSK,"REPORT")
"RTN","RORX014",107,0)
 Q:REPORT<0 REPORT
"RTN","RORX014",108,0)
 ;
"RTN","RORX014",109,0)
 D
"RTN","RORX014",110,0)
 . ;--- Get and prepare the report parameters
"RTN","RORX014",111,0)
 . S RORREG=$$PARAM^RORTSK01("REGIEN")
"RTN","RORX014",112,0)
 . S RC=$$PARAMS(REPORT,.RORSDT,.ROREDT,.SFLAGS)  Q:RC<0
"RTN","RORX014",113,0)
 . S ROREDT1=$$FMADD^XLFDT(ROREDT\1,1)
"RTN","RORX014",114,0)
 . ;--- Report header
"RTN","RORX014",115,0)
 . S RC=$$HEADER(REPORT)  Q:RC<0
"RTN","RORX014",116,0)
 . ;--- Query the registry
"RTN","RORX014",117,0)
 . D TPPSETUP^RORTSK01(80)
"RTN","RORX014",118,0)
 . S RC=$$QUERY^RORX014A(SFLAGS)
"RTN","RORX014",119,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX014",120,0)
 . ;--- Sort the data
"RTN","RORX014",121,0)
 . D TPPSETUP^RORTSK01(5)
"RTN","RORX014",122,0)
 . S RC=$$SORT^RORX014A(.NRXC)
"RTN","RORX014",123,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX014",124,0)
 . ;--- Store the results
"RTN","RORX014",125,0)
 . D TPPSETUP^RORTSK01(15)
"RTN","RORX014",126,0)
 . S RC=$$STORE^RORX014A(REPORT,NRXC)
"RTN","RORX014",127,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX014",128,0)
 ;
"RTN","RORX014",129,0)
 ;--- Cleanup
"RTN","RORX014",130,0)
 K ^TMP("RORX014",$J)
"RTN","RORX014",131,0)
 D FREE^RORTMP(RORXL)
"RTN","RORX014",132,0)
 Q $S(RC<0:RC,ECNT>0:-43,1:0)
"RTN","RORX014A")
0^31^B52467259^B43649580
"RTN","RORX014A",1,0)
RORX014A ;HOIFO/BH,SG,VAC - REGISTRY MEDS REPORT (QUERY & SORT) ;4/7/09 2:09pm
"RTN","RORX014A",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**8,13,19,21,31**;Feb 17, 2006;Build 62
"RTN","RORX014A",3,0)
 ;
"RTN","RORX014A",4,0)
 ;******************************************************************************
"RTN","RORX014A",5,0)
 ;******************************************************************************
"RTN","RORX014A",6,0)
 ;                 --- ROUTINE MODIFICATION LOG ---
"RTN","RORX014A",7,0)
 ;        
"RTN","RORX014A",8,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORX014A",9,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","RORX014A",10,0)
 ;ROR*1.5*8    MAR 2010    V CARR       Modified to handle ICD9 filter for
"RTN","RORX014A",11,0)
 ;                                      'include' or 'exclude'.
"RTN","RORX014A",12,0)
 ;ROR*1.5*13   DEC 2010    A SAUNDERS   User can select specific patients,
"RTN","RORX014A",13,0)
 ;                                      clinics, or divisions for the report.
"RTN","RORX014A",14,0)
 ;ROR*1.5*19   FEB 2012    J SCOTT      Support for ICD-10 Coding System.
"RTN","RORX014A",15,0)
 ;ROR*1.5*21   SEP 2013    T KOPP       Added ICN as last report column if
"RTN","RORX014A",16,0)
 ;                                      additional identifier option selected
"RTN","RORX014A",17,0)
 ;ROR*1.5*31   MAY 2017    M FERRARESE  Adding PACT ,PCP,and AGE/DOB as additional
"RTN","RORX014A",18,0)
 ;                                      identifiers.
"RTN","RORX014A",19,0)
 ;******************************************************************************
"RTN","RORX014A",20,0)
 ;******************************************************************************
"RTN","RORX014A",21,0)
 Q
"RTN","RORX014A",22,0)
 ;
"RTN","RORX014A",23,0)
 ;***** ADDS THE DRUG COMBINATION TO THE REPORT
"RTN","RORX014A",24,0)
 ;
"RTN","RORX014A",25,0)
 ; RXLST         List of drug IEN's separated by commas
"RTN","RORX014A",26,0)
 ; PATIEN        Patient IEN in file #2 (DFN)
"RTN","RORX014A",27,0)
 ;
"RTN","RORX014A",28,0)
ADD(RXLST,PATIEN) ;
"RTN","RORX014A",29,0)
 N RXCIEN,RXCNDX,TMP,VA,VADM,VAERR
"RTN","RORX014A",30,0)
 S RXCNDX=$E(RXLST,1,100)
"RTN","RORX014A",31,0)
 ;--- Search for the combination
"RTN","RORX014A",32,0)
 S RXCIEN=""
"RTN","RORX014A",33,0)
 F  D  Q:RXCIEN=""  Q:^TMP("RORX014",$J,"RXC",RXCIEN,1)=RXLST
"RTN","RORX014A",34,0)
 . S RXCIEN=$O(^TMP("RORX014",$J,"RXC","B",RXCNDX,RXCIEN))
"RTN","RORX014A",35,0)
 ;--- Add new combination
"RTN","RORX014A",36,0)
 D:RXCIEN'>0
"RTN","RORX014A",37,0)
 . S RXCIEN=$O(^TMP("RORX014",$J,"RXC"," "),-1)+1
"RTN","RORX014A",38,0)
 . S ^TMP("RORX014",$J,"RXC",RXCIEN,1)=RXLST
"RTN","RORX014A",39,0)
 . S ^TMP("RORX014",$J,"RXC","B",RXCNDX,RXCIEN)=""
"RTN","RORX014A",40,0)
 ;--- Add new patient
"RTN","RORX014A",41,0)
 S ^("P")=$G(^TMP("RORX014",$J,"RXC",RXCIEN,"P"))+1 ;naked reference: ^TMP("RORX014",$J,"RXC",RXCIEN,"P")
"RTN","RORX014A",42,0)
 D VADEM^RORUTL05(PATIEN,1)
"RTN","RORX014A",43,0)
 S AGETYPE=$$PARAM^RORTSK01("AGE_RANGE","TYPE") D
"RTN","RORX014A",44,0)
 . S AGE=$S(AGETYPE="AGE":$P(VADM(4),U),AGETYPE="DOB":$$DATE^RORXU002($P(VADM(3),U)\1),1:"")
"RTN","RORX014A",45,0)
 S TMP=VA("BID")_U_VADM(1)_U_$$DATE^RORXU002(VADM(6)\1)_U_$S($$PARAM^RORTSK01("PATIENTS","ICN"):$$ICN^RORUTL02(PATIEN),1:"")
"RTN","RORX014A",46,0)
 S TMP=TMP_U_$S($$PARAM^RORTSK01("PATIENTS","PACT"):$$PACT^RORUTL02(PATIEN),1:"")_U_$S($$PARAM^RORTSK01("PATIENTS","PCP"):$$PCP^RORUTL02(PATIEN),1:"")_U_AGE
"RTN","RORX014A",47,0)
 S ^TMP("RORX014",$J,"RXC",RXCIEN,"P",PATIEN)=TMP
"RTN","RORX014A",48,0)
 Q
"RTN","RORX014A",49,0)
 ;
"RTN","RORX014A",50,0)
 ;***** QUERIES THE REGISTRY
"RTN","RORX014A",51,0)
 ;
"RTN","RORX014A",52,0)
 ; FLAGS         Flags for the $$SKIP^RORXU005
"RTN","RORX014A",53,0)
 ;
"RTN","RORX014A",54,0)
 ; Return Values:
"RTN","RORX014A",55,0)
 ;       <0  Error code
"RTN","RORX014A",56,0)
 ;        0  Ok
"RTN","RORX014A",57,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX014A",58,0)
 ;
"RTN","RORX014A",59,0)
QUERY(FLAGS) ;
"RTN","RORX014A",60,0)
 N RORPTN        ; Number of patients in the registry
"RTN","RORX014A",61,0)
 N RORXDST       ; Descriptor for pharmacy search API
"RTN","RORX014A",62,0)
 ;
"RTN","RORX014A",63,0)
 N CNT,DRGIEN,ECNT,NAME,PATIEN,RC,RORIEN,RXFLAGS,STR,TMP,XREFNODE
"RTN","RORX014A",64,0)
 N RCC,FLAG
"RTN","RORX014A",65,0)
 N RORCDLIST     ; Flag to indicate whether a clinic or division list exists
"RTN","RORX014A",66,0)
 N RORCDSTDT     ; Start date for clinic/division utilization search
"RTN","RORX014A",67,0)
 N RORCDENDT     ; End date for clinic/division utilization search
"RTN","RORX014A",68,0)
 ;
"RTN","RORX014A",69,0)
 S XREFNODE=$NA(^RORDATA(798,"AC",+RORREG))
"RTN","RORX014A",70,0)
 S RORPTN=$$REGSIZE^RORUTL02(+RORREG)  S:RORPTN<0 RORPTN=0
"RTN","RORX014A",71,0)
 S (CNT,ECNT,RC)=0
"RTN","RORX014A",72,0)
 ;
"RTN","RORX014A",73,0)
 ;--- Prepare parameters for the pharmacy search API
"RTN","RORX014A",74,0)
 S RORXDST=$NA(RORXDST("RORX014"))
"RTN","RORX014A",75,0)
 S RORXDST("RORCB")="$$RXSCB^RORX014A"
"RTN","RORX014A",76,0)
 S RORXDST("GENERIC")=$$PARAM^RORTSK01("DRUGS","AGGR_GENERIC")
"RTN","RORX014A",77,0)
 S RXFLAGS="E"
"RTN","RORX014A",78,0)
 S:$$PARAM^RORTSK01("PATIENTS","INPATIENT") RXFLAGS=RXFLAGS_"IV"
"RTN","RORX014A",79,0)
 S:$$PARAM^RORTSK01("PATIENTS","OUTPATIENT") RXFLAGS=RXFLAGS_"O"
"RTN","RORX014A",80,0)
 Q:RXFLAGS="E" 0
"RTN","RORX014A",81,0)
 ;
"RTN","RORX014A",82,0)
 ;=== Set up Clinic/Division list parameters
"RTN","RORX014A",83,0)
 S RORCDLIST=$$CDPARMS^RORXU001(.RORTSK,.RORCDSTDT,.RORCDENDT)
"RTN","RORX014A",84,0)
 ;
"RTN","RORX014A",85,0)
 ;--- Browse through the registry records
"RTN","RORX014A",86,0)
 S RORIEN=0
"RTN","RORX014A",87,0)
 S FLAG=$G(RORTSK("PARAMS","ICDFILT","A","FILTER"))
"RTN","RORX014A",88,0)
 F  S RORIEN=$O(@XREFNODE@(RORIEN))  Q:RORIEN'>0  D  Q:RC<0
"RTN","RORX014A",89,0)
 . S TMP=$S(RORPTN>0:CNT/RORPTN,1:"")
"RTN","RORX014A",90,0)
 . S RC=$$LOOP^RORTSK01(TMP)  Q:RC<0
"RTN","RORX014A",91,0)
 . S CNT=CNT+1
"RTN","RORX014A",92,0)
 . ;--- Get patient DFN
"RTN","RORX014A",93,0)
 . S PATIEN=$$PTIEN^RORUTL01(RORIEN)  Q:PATIEN'>0
"RTN","RORX014A",94,0)
 . ;check for patient list and quit if not on list
"RTN","RORX014A",95,0)
 . I $D(RORTSK("PARAMS","PATIENTS","C")),'$D(RORTSK("PARAMS","PATIENTS","C",PATIEN)) Q
"RTN","RORX014A",96,0)
 . ;--- Check if the patient should be skipped
"RTN","RORX014A",97,0)
 . Q:$$SKIP^RORXU005(RORIEN,FLAGS,RORSDT,ROREDT)
"RTN","RORX014A",98,0)
 . ;--- Check the patient against the ICD Filter
"RTN","RORX014A",99,0)
 . S RCC=0
"RTN","RORX014A",100,0)
 . I FLAG'="ALL" D
"RTN","RORX014A",101,0)
 . . S RCC=$$ICD^RORXU010(PATIEN)
"RTN","RORX014A",102,0)
 . I (FLAG="INCLUDE")&(RCC=0) Q
"RTN","RORX014A",103,0)
 . I (FLAG="EXCLUDE")&(RCC=1) Q
"RTN","RORX014A",104,0)
 . ;--- End of ICD check
"RTN","RORX014A",105,0)
 . ;
"RTN","RORX014A",106,0)
 . ;--- Check for Clinic or Division list and quit if not in list
"RTN","RORX014A",107,0)
 . I RORCDLIST,'$$CDUTIL^RORXU001(.RORTSK,PATIEN,RORCDSTDT,RORCDENDT) Q
"RTN","RORX014A",108,0)
 . ;
"RTN","RORX014A",109,0)
 . ;--- Search for pharmacy data
"RTN","RORX014A",110,0)
 . S TMP=$$RXSEARCH^RORUTL14(PATIEN,RORXL,.RORXDST,RXFLAGS,RORSDT,ROREDT1)
"RTN","RORX014A",111,0)
 . I TMP'>0  S:TMP<0 ECNT=ECNT+1  Q:$D(@RORXDST)<10
"RTN","RORX014A",112,0)
 . ;
"RTN","RORX014A",113,0)
 . S (NAME,STR)=""
"RTN","RORX014A",114,0)
 . F  S NAME=$O(@RORXDST@(NAME))  Q:NAME=""  D
"RTN","RORX014A",115,0)
 . . S DRGIEN=0
"RTN","RORX014A",116,0)
 . . F  S DRGIEN=$O(@RORXDST@(NAME,DRGIEN))  Q:DRGIEN'>0  D
"RTN","RORX014A",117,0)
 . . . S ^TMP("RORX014",$J,"DRG",DRGIEN)=NAME
"RTN","RORX014A",118,0)
 . . . S STR=STR_","_DRGIEN
"RTN","RORX014A",119,0)
 . K @RORXDST
"RTN","RORX014A",120,0)
 . ;
"RTN","RORX014A",121,0)
 . D ADD($P(STR,",",2,999),PATIEN)
"RTN","RORX014A",122,0)
 ;
"RTN","RORX014A",123,0)
 ;---
"RTN","RORX014A",124,0)
 Q $S(RC<0:RC,1:ECNT)
"RTN","RORX014A",125,0)
 ;
"RTN","RORX014A",126,0)
 ;***** CALLBACK FUNCTION FOR THE PHARMACY SEARCH API
"RTN","RORX014A",127,0)
RXSCB(RORDST,ORDER,ORDFLG,DRUG,DATE) ;
"RTN","RORX014A",128,0)
 N IEN,NAME
"RTN","RORX014A",129,0)
 I ROR8DST("GENERIC")  D
"RTN","RORX014A",130,0)
 . S IEN=+ROR8DST("RORXGEN"),NAME=$P(ROR8DST("RORXGEN"),U,2)
"RTN","RORX014A",131,0)
 E  S IEN=+DRUG,NAME=$P(DRUG,U,2)
"RTN","RORX014A",132,0)
 Q:(IEN'>0)!(NAME="") 1
"RTN","RORX014A",133,0)
 S @RORDST@(NAME,IEN)=""
"RTN","RORX014A",134,0)
 Q 0
"RTN","RORX014A",135,0)
 ;
"RTN","RORX014A",136,0)
 ;***** SORTS THE RESULTS AND COMPILES THE TOTALS
"RTN","RORX014A",137,0)
 ;
"RTN","RORX014A",138,0)
 ; NRXC          Number of drug combinations
"RTN","RORX014A",139,0)
 ;
"RTN","RORX014A",140,0)
 ; Return Values:
"RTN","RORX014A",141,0)
 ;       <0  Error code
"RTN","RORX014A",142,0)
 ;        0  Ok
"RTN","RORX014A",143,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX014A",144,0)
 ;
"RTN","RORX014A",145,0)
SORT(NRXC) ;
"RTN","RORX014A",146,0)
 N IEN,TMP
"RTN","RORX014A",147,0)
 S (IEN,NRXC)=0
"RTN","RORX014A",148,0)
 F  S IEN=$O(^TMP("RORX014",$J,"RXC",IEN))  Q:IEN'>0  D
"RTN","RORX014A",149,0)
 . S TMP=^TMP("RORX014",$J,"RXC",IEN,"P")
"RTN","RORX014A",150,0)
 . S ^TMP("RORX014",$J,"RXC","P",TMP,IEN)="",NRXC=NRXC+1
"RTN","RORX014A",151,0)
 Q 0
"RTN","RORX014A",152,0)
 ;
"RTN","RORX014A",153,0)
 ;***** STORES THE REPORT DATA
"RTN","RORX014A",154,0)
 ;
"RTN","RORX014A",155,0)
 ; REPORT        IEN of the REPORT element
"RTN","RORX014A",156,0)
 ; NRXC          Number of drug combinations
"RTN","RORX014A",157,0)
 ;
"RTN","RORX014A",158,0)
 ; Return Values:
"RTN","RORX014A",159,0)
 ;       <0  Error code
"RTN","RORX014A",160,0)
 ;        0  Ok
"RTN","RORX014A",161,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX014A",162,0)
 ;
"RTN","RORX014A",163,0)
STORE(REPORT,NRXC) ;
"RTN","RORX014A",164,0)
 N BUF,CNT,DRG,ITEM,NODE,PATIEN,RORI,RXCIEN,RXCNT,RXCOMB,SECTION,TABLE,VA,VADM,VAERR,AGETYPE,AGE
"RTN","RORX014A",165,0)
 S NODE=$NA(^TMP("RORX014",$J))
"RTN","RORX014A",166,0)
 S SECTION=$$ADDVAL^RORTSK11(RORTSK,"RXCOMBLST",,REPORT)
"RTN","RORX014A",167,0)
 Q:SECTION<0 SECTION
"RTN","RORX014A",168,0)
 D ADDATTR^RORTSK11(RORTSK,SECTION,"TABLE","RXCOMBLST")
"RTN","RORX014A",169,0)
 ;---
"RTN","RORX014A",170,0)
 Q:NRXC'>0 0
"RTN","RORX014A",171,0)
 ;---
"RTN","RORX014A",172,0)
 S RXCNT="",CNT=0,AGE=""
"RTN","RORX014A",173,0)
 F  S RXCNT=$O(@NODE@("RXC","P",RXCNT),-1)  Q:RXCNT=""  D
"RTN","RORX014A",174,0)
 . S RC=$$LOOP^RORTSK01(CNT/NRXC),CNT=CNT+1  Q:RC<0
"RTN","RORX014A",175,0)
 . S RXCIEN=""
"RTN","RORX014A",176,0)
 . F  S RXCIEN=$O(@NODE@("RXC","P",RXCNT,RXCIEN),-1)  Q:RXCIEN=""  D
"RTN","RORX014A",177,0)
 . . S RXCOMB=$$ADDVAL^RORTSK11(RORTSK,"RXCOMB",,SECTION)
"RTN","RORX014A",178,0)
 . . ;--- List of drugs
"RTN","RORX014A",179,0)
 . . S TABLE=$$ADDVAL^RORTSK11(RORTSK,"DRUGS",,RXCOMB)
"RTN","RORX014A",180,0)
 . . S BUF=@NODE@("RXC",RXCIEN,1)
"RTN","RORX014A",181,0)
 . . F RORI=1:1  S DRG=$P(BUF,",",RORI)  Q:DRG=""  D
"RTN","RORX014A",182,0)
 . . . S DRG=$P(^TMP("RORX014",$J,"DRG",DRG),U)
"RTN","RORX014A",183,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"NAME",DRG,TABLE,1)
"RTN","RORX014A",184,0)
 . . ;--- Number of unique patients
"RTN","RORX014A",185,0)
 . . D ADDVAL^RORTSK11(RORTSK,"NP",RXCNT,RXCOMB,3)
"RTN","RORX014A",186,0)
 . . ;--- List of patients
"RTN","RORX014A",187,0)
 . . Q:'$$PARAM^RORTSK01("OPTIONS","COMPLETE")
"RTN","RORX014A",188,0)
 . . S TABLE=$$ADDVAL^RORTSK11(RORTSK,"PATIENTS",,RXCOMB)
"RTN","RORX014A",189,0)
 . . D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","PATIENTS")
"RTN","RORX014A",190,0)
 . . S PATIEN=""
"RTN","RORX014A",191,0)
 . . F  S PATIEN=$O(@NODE@("RXC",RXCIEN,"P",PATIEN))  Q:PATIEN=""  D
"RTN","RORX014A",192,0)
 . . . S BUF=@NODE@("RXC",RXCIEN,"P",PATIEN)
"RTN","RORX014A",193,0)
 . . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"PATIENT",,TABLE,,PATIEN)
"RTN","RORX014A",194,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"NAME",$P(BUF,U,2),ITEM,1)
"RTN","RORX014A",195,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"LAST4",$P(BUF,U),ITEM,2)
"RTN","RORX014A",196,0)
 . . . ;
"RTN","RORX014A",197,0)
 . . . S AGETYPE=$$PARAM^RORTSK01("AGE_RANGE","TYPE") I AGETYPE'="ALL" D
"RTN","RORX014A",198,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,AGETYPE,$P(BUF,U,7),ITEM,1)
"RTN","RORX014A",199,0)
 . . . ;
"RTN","RORX014A",200,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"DOD",$P(BUF,U,3),ITEM,1)
"RTN","RORX014A",201,0)
 . . . I $$PARAM^RORTSK01("PATIENTS","ICN") D ADDVAL^RORTSK11(RORTSK,"ICN",$P(BUF,U,4),ITEM,1)
"RTN","RORX014A",202,0)
 . . . I $$PARAM^RORTSK01("PATIENTS","PACT") D ADDVAL^RORTSK11(RORTSK,"PACT",$P(BUF,U,5),ITEM,1)
"RTN","RORX014A",203,0)
 . . . I $$PARAM^RORTSK01("PATIENTS","PCP") D ADDVAL^RORTSK11(RORTSK,"PCP",$P(BUF,U,6),ITEM,1)
"RTN","RORX014A",204,0)
 Q 0
"RTN","RORX015")
0^32^B18214274^B14335516
"RTN","RORX015",1,0)
RORX015 ;HOIFO/SG - PROCEDURES REPORT ;6/23/06 1:36pm
"RTN","RORX015",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**1,19,21,31**;Feb 17, 2006;Build 62
"RTN","RORX015",3,0)
 ;
"RTN","RORX015",4,0)
 ;******************************************************************************
"RTN","RORX015",5,0)
 ;******************************************************************************
"RTN","RORX015",6,0)
 ; --- ROUTINE MODIFICATION LOG ---
"RTN","RORX015",7,0)
 ; 
"RTN","RORX015",8,0)
 ;PKG/PATCH   DATE       DEVELOPER   MODIFICATION
"RTN","RORX015",9,0)
 ;----------- ---------- ----------- ----------------------------------------
"RTN","RORX015",10,0)
 ;ROR*1.5*19  FEB 2012   J SCOTT     Support for ICD-10 Coding System.
"RTN","RORX015",11,0)
 ;ROR*1.5*21  SEP 2013   T KOPP      Added ICN as report column if
"RTN","RORX015",12,0)
 ;                                    additional identifier option selected
"RTN","RORX015",13,0)
 ;ROR*1.5*31   MAY 2017  M FERRARESE  Adding PACT, PCP, and AGE/DOB as additional
"RTN","RORX015",14,0)
 ;                                    identifiers.
"RTN","RORX015",15,0)
 ;
"RTN","RORX015",16,0)
 ;******************************************************************************
"RTN","RORX015",17,0)
 ;******************************************************************************
"RTN","RORX015",18,0)
 Q
"RTN","RORX015",19,0)
 ;
"RTN","RORX015",20,0)
 ;***** OUTPUTS THE REPORT HEADER
"RTN","RORX015",21,0)
 ;
"RTN","RORX015",22,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX015",23,0)
 ;
"RTN","RORX015",24,0)
 ; Return Values:
"RTN","RORX015",25,0)
 ;       <0  Error code
"RTN","RORX015",26,0)
 ;       >0  IEN of the HEADER element
"RTN","RORX015",27,0)
 ;
"RTN","RORX015",28,0)
HEADER(PARTAG) ;
"RTN","RORX015",29,0)
 ;;PROCLST(#,PROCODE,PROCNAME,NP,NC,SOURCE)
"RTN","RORX015",30,0)
 ;;PROCEDURES(#,NAME,LAST4,DOD,ICN,PACT,PCP,PROCODE,PROCNAME,DATE,SOURCE)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="ALL"
"RTN","RORX015",31,0)
 ;;PROCEDURES(#,NAME,LAST4,AGE,DOD,ICN,PACT,PCP,PROCODE,PROCNAME,DATE,SOURCE)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="AGE"
"RTN","RORX015",32,0)
 ;;PROCEDURES(#,NAME,LAST4,DOB,DOD,ICN,PACT,PCP,PROCODE,PROCNAME,DATE,SOURCE)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="DOB"
"RTN","RORX015",33,0)
 ;;PATIENTS(#,NAME,LAST4,DOD,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="ALL"
"RTN","RORX015",34,0)
 ;;PATIENTS(#,NAME,LAST4,DOD,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="AGE"
"RTN","RORX015",35,0)
 ;;PATIENTS(#,NAME,LAST4,DOD,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="DOB"
"RTN","RORX015",36,0)
 ;
"RTN","RORX015",37,0)
 N HEADER,RC
"RTN","RORX015",38,0)
 S HEADER=$$HEADER^RORXU002(.RORTSK,PARTAG)
"RTN","RORX015",39,0)
 Q:HEADER<0 HEADER
"RTN","RORX015",40,0)
 S RC=$$TBLDEF^RORXU002("HEADER^RORX015",HEADER)
"RTN","RORX015",41,0)
 Q $S(RC<0:RC,1:HEADER)
"RTN","RORX015",42,0)
 ;
"RTN","RORX015",43,0)
 ;***** OUTPUTS THE PARAMETERS TO THE REPORT
"RTN","RORX015",44,0)
 ;
"RTN","RORX015",45,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX015",46,0)
 ;
"RTN","RORX015",47,0)
 ; [.STDT]       Start and end dates of the report
"RTN","RORX015",48,0)
 ; [.ENDT]       are returned via these parameters
"RTN","RORX015",49,0)
 ;
"RTN","RORX015",50,0)
 ; [.FLAGS]      Flags for the $$SKIP^RORXU005 are
"RTN","RORX015",51,0)
 ;               returned via this parameter
"RTN","RORX015",52,0)
 ;
"RTN","RORX015",53,0)
 ; Return Values:
"RTN","RORX015",54,0)
 ;       <0  Error code
"RTN","RORX015",55,0)
 ;       >0  IEN of the PARAMETERS element
"RTN","RORX015",56,0)
 ;
"RTN","RORX015",57,0)
PARAMS(PARTAG,STDT,ENDT,FLAGS) ;
"RTN","RORX015",58,0)
 N PARAMS,TMP
"RTN","RORX015",59,0)
 S PARAMS=$$PARAMS^RORXU002(.RORTSK,PARTAG,.STDT,.ENDT,.FLAGS)
"RTN","RORX015",60,0)
 Q:PARAMS<0 PARAMS
"RTN","RORX015",61,0)
 ;--- Process the list of ICD codes
"RTN","RORX015",62,0)
 I $$PARAM^RORTSK01("PATIENTS","INPATIENT")  D  Q:TMP<0 TMP
"RTN","RORX015",63,0)
 . S TMP=$$ICDLST^RORXU008(.RORTSK,PARAMS,.RORICDL,.RORIGRP)
"RTN","RORX015",64,0)
 ;--- Process the list of CPT codes
"RTN","RORX015",65,0)
 I $$PARAM^RORTSK01("PATIENTS","OUTPATIENT")  D  Q:TMP<0 TMP
"RTN","RORX015",66,0)
 . S TMP=$$CPTLST^RORXU006(.RORTSK,PARAMS)
"RTN","RORX015",67,0)
 ;---
"RTN","RORX015",68,0)
 Q PARAMS
"RTN","RORX015",69,0)
 ;
"RTN","RORX015",70,0)
 ;***** COMPILES THE "PROCEDURES" REPORT
"RTN","RORX015",71,0)
 ; REPORT CODE: 015
"RTN","RORX015",72,0)
 ;
"RTN","RORX015",73,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORX015",74,0)
 ;
"RTN","RORX015",75,0)
 ; @RORTMP@(
"RTN","RORX015",76,0)
 ;
"RTN","RORX015",77,0)
 ;   "PAT",              Number of patients
"RTN","RORX015",78,0)
 ;     DFN,              Descriptor
"RTN","RORX015",79,0)
 ;                         ^01: Last 4 digits of SSN
"RTN","RORX015",80,0)
 ;                         ^02: Name
"RTN","RORX015",81,0)
 ;                         ^03: Date of Death
"RTN","RORX015",82,0)
 ;                         ^04: National ICN
"RTN","RORX015",83,0)
 ;                         ^05: Age/DOB
"RTN","RORX015",84,0)
 ;       "I",
"RTN","RORX015",85,0)
 ;         ICDIEN,       Earliest Code Descriptor
"RTN","RORX015",86,0)
 ;                         ^01: Date
"RTN","RORX015",87,0)
 ;         "C")          Quantity
"RTN","RORX015",88,0)
 ;       "O",
"RTN","RORX015",89,0)
 ;         CPTIEN,       Earliest Code Descriptor
"RTN","RORX015",90,0)
 ;                         ^01: Date
"RTN","RORX015",91,0)
 ;           "C")        Quantity
"RTN","RORX015",92,0)
 ;
"RTN","RORX015",93,0)
 ;   "PROC",             Totals
"RTN","RORX015",94,0)
 ;                         ^01: Number of procedure codes
"RTN","RORX015",95,0)
 ;                         ^02: Number of different codes
"RTN","RORX015",96,0)
 ;     "B",
"RTN","RORX015",97,0)
 ;       ProcName,
"RTN","RORX015",98,0)
 ;         Source,
"RTN","RORX015",99,0)
 ;           IEN)        ""
"RTN","RORX015",100,0)
 ;     "I",
"RTN","RORX015",101,0)
 ;       ICDIEN,         Procedure Descriptor
"RTN","RORX015",102,0)
 ;                         ^01: Code
"RTN","RORX015",103,0)
 ;                         ^02: Short description (current version)
"RTN","RORX015",104,0)
 ;         "C")          Quantity
"RTN","RORX015",105,0)
 ;         "P")          Number of unique patients
"RTN","RORX015",106,0)
 ;     "O",
"RTN","RORX015",107,0)
 ;       CPTIEN,         Procedure Descriptor
"RTN","RORX015",108,0)
 ;                         ^01: Code
"RTN","RORX015",109,0)
 ;                         ^02: Short description (current version)
"RTN","RORX015",110,0)
 ;         "C")          Quantity
"RTN","RORX015",111,0)
 ;         "P")          Number of unique patients
"RTN","RORX015",112,0)
 ;
"RTN","RORX015",113,0)
 ; Return Values:
"RTN","RORX015",114,0)
 ;       <0  Error code
"RTN","RORX015",115,0)
 ;        0  Ok
"RTN","RORX015",116,0)
 ;
"RTN","RORX015",117,0)
PROCLST(RORTSK) ;
"RTN","RORX015",118,0)
 N RORPROC       ; Procedures mode (-1|1)
"RTN","RORX015",119,0)
 N ROREDT        ; End date
"RTN","RORX015",120,0)
 N RORICDL       ; Prepared list of ICD codes
"RTN","RORX015",121,0)
 N RORIGRP       ; List of ICD groups
"RTN","RORX015",122,0)
 N RORREG        ; Registry IEN
"RTN","RORX015",123,0)
 N RORSDT        ; Start date
"RTN","RORX015",124,0)
 N RORTMP        ; Closed root of the temporary buffer
"RTN","RORX015",125,0)
 ;
"RTN","RORX015",126,0)
 N ECNT,RC,REPORT,SFLAGS,TMP
"RTN","RORX015",127,0)
 S (ECNT,RC)=0,(RORICDL,RORTMP)=""
"RTN","RORX015",128,0)
 ;
"RTN","RORX015",129,0)
 ;--- Root node of the report
"RTN","RORX015",130,0)
 S REPORT=$$ADDVAL^RORTSK11(RORTSK,"REPORT")
"RTN","RORX015",131,0)
 Q:REPORT<0 REPORT
"RTN","RORX015",132,0)
 ;
"RTN","RORX015",133,0)
 ;--- Get and prepare the report parameters
"RTN","RORX015",134,0)
 S RORREG=$$PARAM^RORTSK01("REGIEN")
"RTN","RORX015",135,0)
 S RC=$$PARAMS(REPORT,.RORSDT,.ROREDT,.SFLAGS)  Q:RC<0 RC
"RTN","RORX015",136,0)
 S RORPROC=$$RPTMODE("PROC")
"RTN","RORX015",137,0)
 ;
"RTN","RORX015",138,0)
 ;--- Report header
"RTN","RORX015",139,0)
 S RC=$$HEADER(REPORT)  Q:RC<0 RC
"RTN","RORX015",140,0)
 S RORTMP=$$ALLOC^RORTMP()
"RTN","RORX015",141,0)
 D
"RTN","RORX015",142,0)
 . ;--- Query the registry
"RTN","RORX015",143,0)
 . D TPPSETUP^RORTSK01(70)
"RTN","RORX015",144,0)
 . S RC=$$QUERY^RORX015A(SFLAGS)
"RTN","RORX015",145,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX015",146,0)
 . ;--- Sort the data
"RTN","RORX015",147,0)
 . D TPPSETUP^RORTSK01(10)
"RTN","RORX015",148,0)
 . S RC=$$SORT^RORX015A()
"RTN","RORX015",149,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX015",150,0)
 . ;--- Store the results
"RTN","RORX015",151,0)
 . D TPPSETUP^RORTSK01(20)
"RTN","RORX015",152,0)
 . S RC=$$STORE^RORX015C(REPORT)
"RTN","RORX015",153,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX015",154,0)
 ;
"RTN","RORX015",155,0)
 ;--- Cleanup
"RTN","RORX015",156,0)
 D FREE^RORTMP(RORTMP),FREE^RORTMP(RORICDL)
"RTN","RORX015",157,0)
 Q $S(RC<0:RC,ECNT>0:-43,1:0)
"RTN","RORX015",158,0)
 ;
"RTN","RORX015",159,0)
 ;***** DETERMINES THE REPORT MODE FOR PROCEDURES
"RTN","RORX015",160,0)
 ;
"RTN","RORX015",161,0)
 ; NAME          Base name of the attribute ("PROC")
"RTN","RORX015",162,0)
 ;
"RTN","RORX015",163,0)
 ; Return Values:
"RTN","RORX015",164,0)
 ;       <0  "Did Not"
"RTN","RORX015",165,0)
 ;        0  Not selected
"RTN","RORX015",166,0)
 ;       >0  "Did"
"RTN","RORX015",167,0)
RPTMODE(NAME) ;
"RTN","RORX015",168,0)
 Q:$$PARAM^RORTSK01("PATIENTS",NAME) 1        ; "Did"
"RTN","RORX015",169,0)
 Q:$$PARAM^RORTSK01("PATIENTS","NO"_NAME) -1  ; "Did Not"
"RTN","RORX015",170,0)
 Q 0
"RTN","RORX015A")
0^33^B98302910^B90387034
"RTN","RORX015A",1,0)
RORX015A ;HOIFO/SG,VAC - OUTPATIENT PROCEDURES (QUERY & SORT) ;4/7/09 2:10pm
"RTN","RORX015A",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**1,8,13,19,21,25,31**;Feb 17, 2006;Build 62
"RTN","RORX015A",3,0)
 ;
"RTN","RORX015A",4,0)
 ; This routine uses the following IAs:
"RTN","RORX015A",5,0)
 ;
"RTN","RORX015A",6,0)
 ; #1995         $$CODEN^ICPTCOD and $$CPT^ICPTCOD (supported)
"RTN","RORX015A",7,0)
 ; #2055         ROOT^DILFD
"RTN","RORX015A",8,0)
 ; #2056         GETS^DIQ
"RTN","RORX015A",9,0)
 ; #2546         GETCPT^SDOE
"RTN","RORX015A",10,0)
 ; #2548         Multiple APIs in SDQ routine (supported)
"RTN","RORX015A",11,0)
 ; #10103        FMADD^XLFDT (supported)
"RTN","RORX015A",12,0)
 ; #5747         $$CODEC^ICDEX, $$CODEN^ICDEX, $$VSTP^ICDEX (controlled)
"RTN","RORX015A",13,0)
 ; #6130         PTFICD^DGPTFUT
"RTN","RORX015A",14,0)
 ;
"RTN","RORX015A",15,0)
 ;******************************************************************************
"RTN","RORX015A",16,0)
 ;******************************************************************************
"RTN","RORX015A",17,0)
 ;                 --- ROUTINE MODIFICATION LOG ---
"RTN","RORX015A",18,0)
 ;        
"RTN","RORX015A",19,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORX015A",20,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","RORX015A",21,0)
 ;ROR*1.5*8    MAR 2010   V CARR        Modified to handle ICD9 filter for
"RTN","RORX015A",22,0)
 ;                                      'include' or 'exclude'.
"RTN","RORX015A",23,0)
 ;ROR*1.5*13   DEC 2010   A SAUNDERS    User can select specific patients,
"RTN","RORX015A",24,0)
 ;                                      clinics, or divisions for the report.
"RTN","RORX015A",25,0)
 ;ROR*1.5*19   FEB 2012   J SCOTT       Support for ICD-10 Coding System.
"RTN","RORX015A",26,0)
 ;ROR*1.5*21   SEP 2013   T KOPP        Added ICN as report column if
"RTN","RORX015A",27,0)
 ;                                      additional identifier option selected
"RTN","RORX015A",28,0)
 ;ROR*1.5*25   OCT 2014   T KOPP        Added PTF ICD-10 support for 25 diagnoses
"RTN","RORX015A",29,0)
 ;ROR*1.5*31   MAY 2017   M FERRARESE    Adding PACT, PCP, and AGE/DOB as additional
"RTN","RORX015A",30,0)
 ;                                       identifiers.
"RTN","RORX015A",31,0)
 ;                                      
"RTN","RORX015A",32,0)
 ;******************************************************************************
"RTN","RORX015A",33,0)
 ;******************************************************************************
"RTN","RORX015A",34,0)
 Q
"RTN","RORX015A",35,0)
 ;
"RTN","RORX015A",36,0)
 ;***** SEARCHES FOR INPATIENT PROCEDURES
"RTN","RORX015A",37,0)
 ;
"RTN","RORX015A",38,0)
 ; PTIEN         Patient IEN (DFN)
"RTN","RORX015A",39,0)
 ;
"RTN","RORX015A",40,0)
 ; Return Values:
"RTN","RORX015A",41,0)
 ;       <0  Error code
"RTN","RORX015A",42,0)
 ;        0  Ok
"RTN","RORX015A",43,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX015A",44,0)
 ;
"RTN","RORX015A",45,0)
INPAT(PTIEN) ;
"RTN","RORX015A",46,0)
 N DATE,ERRCNT,IEN,IEN45,IENS,NODE,RC,RORBUF,RORIBUF,RORMSG,XREF,FLD
"RTN","RORX015A",47,0)
 S (ERRCNT,RC)=0
"RTN","RORX015A",48,0)
 S XREF=$$ROOT^DILFD(45,,1),XREF=$NA(@XREF@("B",PTIEN))
"RTN","RORX015A",49,0)
 S IEN45=0
"RTN","RORX015A",50,0)
 F  S IEN45=$O(@XREF@(IEN45))  Q:IEN45'>0  D
"RTN","RORX015A",51,0)
 . ;--- Surgical procedures
"RTN","RORX015A",52,0)
 . S NODE=$$ROOT^DILFD(45.01,","_IEN45_",",1)
"RTN","RORX015A",53,0)
 . S IEN=0
"RTN","RORX015A",54,0)
 . F  S IEN=$O(@NODE@(IEN))  Q:IEN'>0  D
"RTN","RORX015A",55,0)
 . . S IENS=IEN_","_IEN45_","  K RORBUF
"RTN","RORX015A",56,0)
 . . ;--- Load the data
"RTN","RORX015A",57,0)
 . . K RORMSG D GETS^DIQ(45.01,IENS,".01;","I","RORBUF","RORMSG")
"RTN","RORX015A",58,0)
 . . I $G(RORMSG("DIERR"))  D  S ERRCNT=ERRCNT+1
"RTN","RORX015A",59,0)
 . . . D DBS^RORERR("RORMSG",-99,,PTIEN,45.01,IENS)
"RTN","RORX015A",60,0)
 . . S DATE=$G(RORBUF(45.01,IENS,.01,"I"))
"RTN","RORX015A",61,0)
 . . Q:(DATE<RORSDT)!(DATE'<ROREDT1)
"RTN","RORX015A",62,0)
 . . ;--- Generate the output
"RTN","RORX015A",63,0)
 . . K RORIBUF
"RTN","RORX015A",64,0)
 . . D PTFICD^DGPTFUT(401,IEN45,IEN,.RORIBUF)
"RTN","RORX015A",65,0)
 . . S FLD="" F  S FLD=$O(RORIBUF(FLD)) Q:FLD=""  I $G(RORIBUF(FLD)) D
"RTN","RORX015A",66,0)
 . . . D PROCSET(PTIEN,"I",+RORIBUF(FLD),DATE)
"RTN","RORX015A",67,0)
 . ;--- Other procedures
"RTN","RORX015A",68,0)
 . S NODE=$$ROOT^DILFD(45.05,","_IEN45_",",1)
"RTN","RORX015A",69,0)
 . S IEN=0
"RTN","RORX015A",70,0)
 . F  S IEN=$O(@NODE@(IEN))  Q:IEN'>0  D
"RTN","RORX015A",71,0)
 . . S IENS=IEN_","_IEN45_","  K RORBUF
"RTN","RORX015A",72,0)
 . . ;--- Load the data
"RTN","RORX015A",73,0)
 . . K RORMSG D GETS^DIQ(45.05,IENS,".01","I","RORBUF","RORMSG")
"RTN","RORX015A",74,0)
 . . I $G(RORMSG("DIERR"))  D  S ERRCNT=ERRCNT+1
"RTN","RORX015A",75,0)
 . . . D DBS^RORERR("RORMSG",-99,,PTIEN,45.05,IENS)
"RTN","RORX015A",76,0)
 . . S DATE=$G(RORBUF(45.05,IENS,.01,"I"))
"RTN","RORX015A",77,0)
 . . Q:(DATE<RORSDT)!(DATE'<ROREDT1)
"RTN","RORX015A",78,0)
 . . ;--- Generate the output
"RTN","RORX015A",79,0)
 . . K RORIBUF
"RTN","RORX015A",80,0)
 . . D PTFICD^DGPTFUT(601,IEN45,IEN,.RORIBUF)
"RTN","RORX015A",81,0)
 . . S FLD="" F  S FLD=$O(RORIBUF(FLD)) Q:FLD=""  I $G(RORIBUF(FLD)) D
"RTN","RORX015A",82,0)
 . . . D PROCSET(PTIEN,"I",+RORIBUF(FLD),DATE)
"RTN","RORX015A",83,0)
 ;---
"RTN","RORX015A",84,0)
 Q $S(RC<0:RC,1:ERRCNT)
"RTN","RORX015A",85,0)
 ;
"RTN","RORX015A",86,0)
 ;***** CALL-BACK PROCEDURE FOR THE OUTPATIENT SEARCH
"RTN","RORX015A",87,0)
 ;
"RTN","RORX015A",88,0)
 ; PTIEN         Patient IEN (DFN)
"RTN","RORX015A",89,0)
 ;
"RTN","RORX015A",90,0)
OPSCAN(PTIEN) ;
"RTN","RORX015A",91,0)
 N CPTIEN,DATE,IEN,RORCPT,VDATE
"RTN","RORX015A",92,0)
 D GETCPT^SDOE(Y,"RORCPT")
"RTN","RORX015A",93,0)
 Q:$G(RORCPT)'>0
"RTN","RORX015A",94,0)
 S VDATE=+$P(Y0,U)
"RTN","RORX015A",95,0)
 ;---
"RTN","RORX015A",96,0)
 S IEN=0
"RTN","RORX015A",97,0)
 F  S IEN=$O(RORCPT(IEN))  Q:IEN'>0  D
"RTN","RORX015A",98,0)
 . S CPTIEN=+$P(RORCPT(IEN),U),DATE=+$P($G(RORCPT(IEN,12)),U)
"RTN","RORX015A",99,0)
 . D:CPTIEN>0 PROCSET(PTIEN,"O",CPTIEN,$S(DATE>0:DATE,1:VDATE))
"RTN","RORX015A",100,0)
 Q
"RTN","RORX015A",101,0)
 ;
"RTN","RORX015A",102,0)
 ;***** SEARCHES FOR OUTPATIENT PROCEDURES
"RTN","RORX015A",103,0)
 ;
"RTN","RORX015A",104,0)
 ; PTIEN         Patient IEN (DFN)
"RTN","RORX015A",105,0)
 ;
"RTN","RORX015A",106,0)
 ; Return Values:
"RTN","RORX015A",107,0)
 ;       <0  Error code
"RTN","RORX015A",108,0)
 ;        0  Ok
"RTN","RORX015A",109,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX015A",110,0)
 ;
"RTN","RORX015A",111,0)
OUTPAT(PTIEN) ;
"RTN","RORX015A",112,0)
 N QUERY
"RTN","RORX015A",113,0)
 D OPEN^SDQ(.QUERY)
"RTN","RORX015A",114,0)
 D INDEX^SDQ(.QUERY,"PATIENT/DATE","SET")
"RTN","RORX015A",115,0)
 D PAT^SDQ(.QUERY,PTIEN,"SET")
"RTN","RORX015A",116,0)
 D DATE^SDQ(.QUERY,RORSDT,ROREDT1,"SET")
"RTN","RORX015A",117,0)
 D SCANCB^SDQ(.QUERY,"D OPSCAN^RORX015A("_PTIEN_")","SET")
"RTN","RORX015A",118,0)
 D ACTIVE^SDQ(.QUERY,"TRUE","SET")
"RTN","RORX015A",119,0)
 D SCAN^SDQ(.QUERY,"FORWARD")
"RTN","RORX015A",120,0)
 D CLOSE^SDQ(.QUERY)
"RTN","RORX015A",121,0)
 Q 0
"RTN","RORX015A",122,0)
 ;
"RTN","RORX015A",123,0)
 ;**** STORES THE PROCEDURE CODE
"RTN","RORX015A",124,0)
 ;
"RTN","RORX015A",125,0)
 ; PTIEN         Patient IEN (DFN)
"RTN","RORX015A",126,0)
 ; SOURCE        CPT source code ("O" or "I")
"RTN","RORX015A",127,0)
 ; [IEN]         IEN of the procedure descriptor (file #81 or #80.1)
"RTN","RORX015A",128,0)
 ; DATE          Date when the code was entered
"RTN","RORX015A",129,0)
 ; [CODE]        Procedure code (CPT or ICD-9)
"RTN","RORX015A",130,0)
 ;
"RTN","RORX015A",131,0)
 ; Either the IEN or the CODE parameter must be provided.
"RTN","RORX015A",132,0)
 ;
"RTN","RORX015A",133,0)
PROCSET(PTIEN,SOURCE,IEN,DATE,CODE) ;
"RTN","RORX015A",134,0)
 Q:DATE'>0
"RTN","RORX015A",135,0)
 N TMP
"RTN","RORX015A",136,0)
 S IEN=+$G(IEN)
"RTN","RORX015A",137,0)
 ;---
"RTN","RORX015A",138,0)
 I IEN'>0  Q:$G(CODE)=""  D  Q:IEN'>0
"RTN","RORX015A",139,0)
 . I SOURCE="O"  S IEN=+$$CODEN^ICPTCOD(CODE) Q
"RTN","RORX015A",140,0)
 . I SOURCE="I"  S IEN=+$$CODEN^ICDEX(CODE,80.1) Q
"RTN","RORX015A",141,0)
 ;---
"RTN","RORX015A",142,0)
 I SOURCE="O",'$$PARAM^RORTSK01("CPTLST","ALL")  D  Q:'TMP
"RTN","RORX015A",143,0)
 . S TMP=$D(RORTSK("PARAMS","CPTLST","C",IEN))
"RTN","RORX015A",144,0)
 I SOURCE="I"  Q:$$ICDGRCHK^RORXU008(.RORPTGRP,IEN,RORICDL)
"RTN","RORX015A",145,0)
 ;---
"RTN","RORX015A",146,0)
 S TMP=+$G(@RORTMP@("PAT",PTIEN,SOURCE,IEN))
"RTN","RORX015A",147,0)
 S:'TMP!(DATE<TMP) @RORTMP@("PAT",PTIEN,SOURCE,IEN)=DATE
"RTN","RORX015A",148,0)
 S ^("C")=$G(@RORTMP@("PAT",PTIEN,SOURCE,IEN,"C"))+1 ;naked reference: ^TMP($J,"RORTMP-n") from RORX015
"RTN","RORX015A",149,0)
 Q
"RTN","RORX015A",150,0)
 ;
"RTN","RORX015A",151,0)
 ;***** QUERIES THE REGISTRY
"RTN","RORX015A",152,0)
 ;
"RTN","RORX015A",153,0)
 ; FLAGS         Flags for the $$SKIP^RORXU005
"RTN","RORX015A",154,0)
 ;
"RTN","RORX015A",155,0)
 ; Return Values:
"RTN","RORX015A",156,0)
 ;       <0  Error code
"RTN","RORX015A",157,0)
 ;        0  Ok
"RTN","RORX015A",158,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX015A",159,0)
 ;
"RTN","RORX015A",160,0)
QUERY(FLAGS) ;
"RTN","RORX015A",161,0)
 N ROREDT1       ; Day after the end date
"RTN","RORX015A",162,0)
 N RORPTGRP      ; Temporary list of ICD groups
"RTN","RORX015A",163,0)
 N RORPTN        ; Number of patients in the registry
"RTN","RORX015A",164,0)
 N RORCDLIST     ; Flag to indicate whether a clinic or division list exists
"RTN","RORX015A",165,0)
 N RORCDSTDT     ; Start date for clinic/division utilization search
"RTN","RORX015A",166,0)
 N RORCDENDT     ; End date for clinic/division utilization search
"RTN","RORX015A",167,0)
 ;
"RTN","RORX015A",168,0)
 N CNT,ECNT,IEN,IENS,MODE,PTIEN,RC,SKIP,SKIPEDT,SKIPSDT,TMP,UTEDT,UTSDT,XREFNODE
"RTN","RORX015A",169,0)
 N RCC,FLAG,UTIL
"RTN","RORX015A",170,0)
 S XREFNODE=$NA(^RORDATA(798,"AC",+RORREG))
"RTN","RORX015A",171,0)
 S ROREDT1=$$FMADD^XLFDT(ROREDT\1,1)
"RTN","RORX015A",172,0)
 S (CNT,ECNT,RC)=0,SKIPEDT=ROREDT,SKIPSDT=RORSDT
"RTN","RORX015A",173,0)
 S:$$PARAM^RORTSK01("PATIENTS","INPATIENT") MODE("I")=1
"RTN","RORX015A",174,0)
 S:$$PARAM^RORTSK01("PATIENTS","OUTPATIENT") MODE("O")=1
"RTN","RORX015A",175,0)
 ;--- Utilization date range
"RTN","RORX015A",176,0)
 D:$$PARAM^RORTSK01("PATIENTS","CAREONLY")
"RTN","RORX015A",177,0)
 . S UTSDT=$$PARAM^RORTSK01("DATE_RANGE_3","START")\1
"RTN","RORX015A",178,0)
 . S UTEDT=$$PARAM^RORTSK01("DATE_RANGE_3","END")\1
"RTN","RORX015A",179,0)
 . ;--- Combined date range
"RTN","RORX015A",180,0)
 . S SKIPSDT=$$DTMIN^RORUTL18(SKIPSDT,UTSDT)
"RTN","RORX015A",181,0)
 . S SKIPEDT=$$DTMAX^RORUTL18(SKIPEDT,UTEDT)
"RTN","RORX015A",182,0)
 ;--- Number of patients in the registry
"RTN","RORX015A",183,0)
 S RORPTN=$$REGSIZE^RORUTL02(+RORREG)  S:RORPTN<0 RORPTN=0
"RTN","RORX015A",184,0)
 ;
"RTN","RORX015A",185,0)
 ;=== Set up Clinic/Division list parameters
"RTN","RORX015A",186,0)
 S RORCDLIST=$$CDPARMS^RORXU001(.RORTSK,.RORCDSTDT,.RORCDENDT,1)
"RTN","RORX015A",187,0)
 ;
"RTN","RORX015A",188,0)
 ;=== Browse through the registry records
"RTN","RORX015A",189,0)
 S IEN=0
"RTN","RORX015A",190,0)
 S FLAG=$G(RORTSK("PARAMS","ICDFILT","A","FILTER"))
"RTN","RORX015A",191,0)
 F  S IEN=$O(@XREFNODE@(IEN))  Q:IEN'>0  D  Q:RC<0
"RTN","RORX015A",192,0)
 . S TMP=$S(RORPTN>0:CNT/RORPTN,1:"")
"RTN","RORX015A",193,0)
 . S RC=$$LOOP^RORTSK01(TMP)  Q:RC<0
"RTN","RORX015A",194,0)
 . S IENS=IEN_",",CNT=CNT+1
"RTN","RORX015A",195,0)
 . ;--- Get patient DFN
"RTN","RORX015A",196,0)
 . S PTIEN=$$PTIEN^RORUTL01(IEN)  Q:PTIEN'>0
"RTN","RORX015A",197,0)
 . ;--- Check for patient list and quit if not on list
"RTN","RORX015A",198,0)
 . I $D(RORTSK("PARAMS","PATIENTS","C")),'$D(RORTSK("PARAMS","PATIENTS","C",PTIEN)) Q
"RTN","RORX015A",199,0)
 . ;--- Check if the patient should be skipped
"RTN","RORX015A",200,0)
 . Q:$$SKIP^RORXU005(IEN,FLAGS,SKIPSDT,SKIPEDT)
"RTN","RORX015A",201,0)
 . ;--- Check if patient has passed the ICD Filter
"RTN","RORX015A",202,0)
 . S RCC=0
"RTN","RORX015A",203,0)
 . I FLAG'="ALL" D
"RTN","RORX015A",204,0)
 . . S RCC=$$ICD^RORXU010(PTIEN)
"RTN","RORX015A",205,0)
 . I (FLAG="INCLUDE")&(RCC=0) Q
"RTN","RORX015A",206,0)
 . I (FLAG="EXCLUDE")&(RCC=1) Q
"RTN","RORX015A",207,0)
 . ;--- End of ICD check
"RTN","RORX015A",208,0)
 . M RORPTGRP=RORIGRP("C")
"RTN","RORX015A",209,0)
 . ;
"RTN","RORX015A",210,0)
 . ;--- Check for Clinic or Division list and quit if not in list
"RTN","RORX015A",211,0)
 . I RORCDLIST,'$$CDUTIL^RORXU001(.RORTSK,PTIEN,RORCDSTDT,RORCDENDT) Q
"RTN","RORX015A",212,0)
 . ;
"RTN","RORX015A",213,0)
 . ;--- Inpatient codes (ICD)
"RTN","RORX015A",214,0)
 . I $G(MODE("I"))   D  I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX015A",215,0)
 . . S RC=$$INPAT(PTIEN)
"RTN","RORX015A",216,0)
 . ;--- Outpatient codes (CPT)
"RTN","RORX015A",217,0)
 . I $G(MODE("O"))  D  I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX015A",218,0)
 . . S RC=$$OUTPAT(PTIEN)
"RTN","RORX015A",219,0)
 . ;
"RTN","RORX015A",220,0)
 . ;--- If ICD codes from some groups have not been found,
"RTN","RORX015A",221,0)
 . ;--- then do not consider inpatient procedures at all
"RTN","RORX015A",222,0)
 . K:$D(RORPTGRP)>1 @RORTMP@("PAT",PTIEN,"I")
"RTN","RORX015A",223,0)
 . ;---
"RTN","RORX015A",224,0)
 . S SKIP=($D(@RORTMP@("PAT",PTIEN))<10)
"RTN","RORX015A",225,0)
 . S:RORPROC<0 SKIP='SKIP
"RTN","RORX015A",226,0)
 . ;
"RTN","RORX015A",227,0)
 . ;--- Check for any utilization in the corresponding date range
"RTN","RORX015A",228,0)
 . I 'SKIP  D:$$PARAM^RORTSK01("PATIENTS","CAREONLY")
"RTN","RORX015A",229,0)
 . . K TMP  S TMP("ALL")=1
"RTN","RORX015A",230,0)
 . . S UTIL=+$$UTIL^RORXU003(UTSDT,UTEDT,PTIEN,.TMP)
"RTN","RORX015A",231,0)
 . . S:'UTIL SKIP=1
"RTN","RORX015A",232,0)
 . ;
"RTN","RORX015A",233,0)
 . ;--- Skip the patient if not all search criteria have been met
"RTN","RORX015A",234,0)
 . I SKIP  K @RORTMP@("PAT",PTIEN)  Q
"RTN","RORX015A",235,0)
 . ;
"RTN","RORX015A",236,0)
 . ;--- Calculate the patient's totals
"RTN","RORX015A",237,0)
 . S RC=$$TOTALS(PTIEN)
"RTN","RORX015A",238,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX015A",239,0)
 ;---
"RTN","RORX015A",240,0)
 Q $S(RC<0:RC,1:ECNT)
"RTN","RORX015A",241,0)
 ;
"RTN","RORX015A",242,0)
 ;***** SORTS THE RESULTS AND COMPILES THE TOTALS
"RTN","RORX015A",243,0)
 ;
"RTN","RORX015A",244,0)
 ; Return Values:
"RTN","RORX015A",245,0)
 ;       <0  Error code
"RTN","RORX015A",246,0)
 ;        0  Ok
"RTN","RORX015A",247,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX015A",248,0)
 ;
"RTN","RORX015A",249,0)
SORT() ;
"RTN","RORX015A",250,0)
 N IEN,SRC,TMP,TNC,TNDC
"RTN","RORX015A",251,0)
 ;---
"RTN","RORX015A",252,0)
 S (TNC,TNDC)=0
"RTN","RORX015A",253,0)
 F SRC="I","O"  D
"RTN","RORX015A",254,0)
 . S IEN=0
"RTN","RORX015A",255,0)
 . F  S IEN=$O(@RORTMP@("PROC",SRC,IEN))  Q:IEN'>0  D
"RTN","RORX015A",256,0)
 . . S TMP=$P($G(@RORTMP@("PROC",SRC,IEN)),U,2)
"RTN","RORX015A",257,0)
 . . S:TMP'="" @RORTMP@("PROC","B",TMP,SRC,IEN)=""
"RTN","RORX015A",258,0)
 . . S TNC=TNC+$G(@RORTMP@("PROC",SRC,IEN,"C"))
"RTN","RORX015A",259,0)
 . . S TNDC=TNDC+1
"RTN","RORX015A",260,0)
 S @RORTMP@("PROC")=TNC_U_TNDC
"RTN","RORX015A",261,0)
 ;---
"RTN","RORX015A",262,0)
 Q 0
"RTN","RORX015A",263,0)
 ;
"RTN","RORX015A",264,0)
 ;***** CALCULATES INTERMEDIATE TOTALS
"RTN","RORX015A",265,0)
 ;
"RTN","RORX015A",266,0)
 ; PTIEN         Patient IEN (DFN)
"RTN","RORX015A",267,0)
 ;
"RTN","RORX015A",268,0)
 ; Return Values:
"RTN","RORX015A",269,0)
 ;       <0  Error code
"RTN","RORX015A",270,0)
 ;        0  Ok
"RTN","RORX015A",271,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX015A",272,0)
 ;
"RTN","RORX015A",273,0)
TOTALS(PTIEN) ;
"RTN","RORX015A",274,0)
 N CNT,CODE,IEN,NAME,PNODE,RC,SRC,TMP,TMP1,TMP2,VA,VADM,AGE,AGETYPE
"RTN","RORX015A",275,0)
 S PNODE=$NA(@RORTMP@("PAT",PTIEN))
"RTN","RORX015A",276,0)
 ;--- Get and store the patient's data
"RTN","RORX015A",277,0)
 D VADEM^RORUTL05(PTIEN,1)
"RTN","RORX015A",278,0)
 S TMP=$S($$PARAM^RORTSK01("PATIENTS","ICN"):$$ICN^RORUTL02(PTIEN),1:"")
"RTN","RORX015A",279,0)
 S TMP1=$S($$PARAM^RORTSK01("PATIENTS","PACT"):$$PACT^RORUTL02(PTIEN),1:"")
"RTN","RORX015A",280,0)
 S TMP2=$S($$PARAM^RORTSK01("PATIENTS","PCP"):$$PCP^RORUTL02(PTIEN),1:"")
"RTN","RORX015A",281,0)
 S AGETYPE=$$PARAM^RORTSK01("AGE_RANGE","TYPE")
"RTN","RORX015A",282,0)
 S AGE=$S(AGETYPE="AGE":$P(VADM(4),U),AGETYPE="DOB":$$DATE^RORXU002($P(VADM(3),U)\1),1:"")
"RTN","RORX015A",283,0)
 S @PNODE=VA("BID")_U_VADM(1)_U_$$DATE^RORXU002(VADM(6)\1)_U_TMP_U_TMP1_U_TMP2_U_AGE
"RTN","RORX015A",284,0)
 S ^("PAT")=$G(@RORTMP@("PAT"))+1 ;naked reference: ^TMP($J,"RORTMP-n") from RORX015
"RTN","RORX015A",285,0)
 ;
"RTN","RORX015A",286,0)
 F SRC="I","O"  D
"RTN","RORX015A",287,0)
 . S IEN=0
"RTN","RORX015A",288,0)
 . F  S IEN=$O(@PNODE@(SRC,IEN))  Q:IEN'>0  D
"RTN","RORX015A",289,0)
 . . S CODE=$P($G(@RORTMP@("PROC",SRC,IEN)),U),NAME=""
"RTN","RORX015A",290,0)
 . . D:CODE=""
"RTN","RORX015A",291,0)
 . . . I SRC="O"  D
"RTN","RORX015A",292,0)
 . . . . S TMP=$$CPT^ICPTCOD(IEN)
"RTN","RORX015A",293,0)
 . . . . S:TMP'<0 CODE=$P(TMP,U,2),NAME=$P(TMP,U,3)
"RTN","RORX015A",294,0)
 . . . E  D
"RTN","RORX015A",295,0)
 . . . . ;S TMP=$$ICDOP^ICDCODE(IEN)
"RTN","RORX015A",296,0)
 . . . . ;S:TMP'<0 CODE=$P(TMP,U,2),NAME=$P(TMP,U,5)
"RTN","RORX015A",297,0)
 . . . . S CODE=$$CODEC^ICDEX(80.1,IEN)
"RTN","RORX015A",298,0)
 . . . . S NAME=$$VSTP^ICDEX(IEN)
"RTN","RORX015A",299,0)
 . . . S:CODE="" CODE="UNKN"
"RTN","RORX015A",300,0)
 . . . S:NAME="" NAME="Unknown ("_IEN_")"
"RTN","RORX015A",301,0)
 . . . S @RORTMP@("PROC",SRC,IEN)=CODE_U_NAME
"RTN","RORX015A",302,0)
 . . ;---
"RTN","RORX015A",303,0)
 . . S CNT=+$G(@PNODE@(SRC,IEN,"C"))
"RTN","RORX015A",304,0)
 . . S ^("C")=$G(@RORTMP@("PROC",SRC,IEN,"C"))+CNT ;naked reference: ^TMP($J,"RORTMP-n") from RORX015
"RTN","RORX015A",305,0)
 . . S ^("P")=$G(@RORTMP@("PROC",SRC,IEN,"P"))+1 ;naked reference: ^TMP($J,"RORTMP-n") from RORX015
"RTN","RORX015A",306,0)
 Q 0
"RTN","RORX015C")
0^54^B36664881^B28498077
"RTN","RORX015C",1,0)
RORX015C ;HCIOFO/SG - OUTPATIENT PROCEDURES (STORE) ;6/27/06 10:54am
"RTN","RORX015C",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**1,19,21,31**;Feb 17, 2006;Build 62
"RTN","RORX015C",3,0)
 ;
"RTN","RORX015C",4,0)
 ; This routine uses the following IAs:
"RTN","RORX015C",5,0)
 ;
"RTN","RORX015C",6,0)
 ; #1995         $$CPT^ICPTCOD (supported)
"RTN","RORX015C",7,0)
 ; #5747         $$ICDOP^ICDEX, $$CSI^ICDEX (controlled)
"RTN","RORX015C",8,0)
 ;
"RTN","RORX015C",9,0)
 ;******************************************************************************
"RTN","RORX015C",10,0)
 ;******************************************************************************
"RTN","RORX015C",11,0)
 ; --- ROUTINE MODIFICATION LOG ---
"RTN","RORX015C",12,0)
 ; 
"RTN","RORX015C",13,0)
 ;PKG/PATCH   DATE       DEVELOPER   MODIFICATION
"RTN","RORX015C",14,0)
 ;----------- ---------- ----------- ----------------------------------------
"RTN","RORX015C",15,0)
 ;ROR*1.5*19  FEB 2012   J SCOTT     Support for ICD-10 Coding System.
"RTN","RORX015C",16,0)
 ;ROR*1.5*21  SEP 2013   T KOPP      Added ICN as last report column if
"RTN","RORX015C",17,0)
 ;                                    additional identifier option selected
"RTN","RORX015C",18,0)
 ;ROR*1.5*31   MAY 2017  M FERRARESE  Adding PACT, PCP, and AGE/DOB as additional
"RTN","RORX015C",19,0)
 ;                                    identifiers.
"RTN","RORX015C",20,0)
 ;
"RTN","RORX015C",21,0)
 ;******************************************************************************
"RTN","RORX015C",22,0)
 ;******************************************************************************
"RTN","RORX015C",23,0)
 Q
"RTN","RORX015C",24,0)
 ;
"RTN","RORX015C",25,0)
 ;***** STORES THE PROCEDURE CODE TABLE
"RTN","RORX015C",26,0)
 ;
"RTN","RORX015C",27,0)
 ; PTAG          IEN of the parent element
"RTN","RORX015C",28,0)
 ;
"RTN","RORX015C",29,0)
 ; NODE          Closed root of the node of the temporary global
"RTN","RORX015C",30,0)
 ;
"RTN","RORX015C",31,0)
 ; Return Values:
"RTN","RORX015C",32,0)
 ;       <0  Error code
"RTN","RORX015C",33,0)
 ;        0  Ok
"RTN","RORX015C",34,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX015C",35,0)
 ;
"RTN","RORX015C",36,0)
CODES(PTAG,NODE) ;
"RTN","RORX015C",37,0)
 N IEN,ITEM,NAME,SRC,TABLE,TMP,RORPROCSYS,RORPROCCODE
"RTN","RORX015C",38,0)
 S TABLE=$$ADDVAL^RORTSK11(RORTSK,"PROCLST",,PTAG)
"RTN","RORX015C",39,0)
 Q:TABLE<0 TABLE
"RTN","RORX015C",40,0)
 D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","PROCLST")
"RTN","RORX015C",41,0)
 S NAME=""
"RTN","RORX015C",42,0)
 F  S NAME=$O(@NODE@("PROC","B",NAME))  Q:NAME=""  D
"RTN","RORX015C",43,0)
 . S SRC=""
"RTN","RORX015C",44,0)
 . F  S SRC=$O(@NODE@("PROC","B",NAME,SRC))  Q:SRC=""  D
"RTN","RORX015C",45,0)
 . . S IEN=0
"RTN","RORX015C",46,0)
 . . F  S IEN=$O(@NODE@("PROC","B",NAME,SRC,IEN))  Q:IEN'>0  D
"RTN","RORX015C",47,0)
 . . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"PROCEDURE",,TABLE)
"RTN","RORX015C",48,0)
 . . . S TMP=@NODE@("PROC",SRC,IEN)
"RTN","RORX015C",49,0)
 . . . S RORPROCCODE=$P(TMP,U,1)
"RTN","RORX015C",50,0)
 . . . I SRC="I" D
"RTN","RORX015C",51,0)
 . . . . S RORPROCSYS=+$$CSI^ICDEX(80.1,IEN)
"RTN","RORX015C",52,0)
 . . . . S RORPROCCODE="("_$S(RORPROCSYS=2:"ICD-9",RORPROCSYS=31:"ICD-10",1:"UNKN")_") "_RORPROCCODE
"RTN","RORX015C",53,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"PROCODE",RORPROCCODE,ITEM,2)
"RTN","RORX015C",54,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"PROCNAME",$P(TMP,U,2),ITEM,2)
"RTN","RORX015C",55,0)
 . . . S TMP=$G(@NODE@("PROC",SRC,IEN,"P"))
"RTN","RORX015C",56,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"NP",TMP,ITEM,3)
"RTN","RORX015C",57,0)
 . . . S TMP=$G(@NODE@("PROC",SRC,IEN,"C"))
"RTN","RORX015C",58,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"NC",TMP,ITEM,3)
"RTN","RORX015C",59,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"SOURCE",SRC,ITEM,1)
"RTN","RORX015C",60,0)
 Q 0
"RTN","RORX015C",61,0)
 ;
"RTN","RORX015C",62,0)
 ;***** STORES THE PATIENT TABLE
"RTN","RORX015C",63,0)
 ;
"RTN","RORX015C",64,0)
 ; PTAG          IEN of the parent element
"RTN","RORX015C",65,0)
 ;
"RTN","RORX015C",66,0)
 ; NODE          Closed root of the node of the temporary global
"RTN","RORX015C",67,0)
 ;
"RTN","RORX015C",68,0)
 ; Return Values:
"RTN","RORX015C",69,0)
 ;       <0  Error code
"RTN","RORX015C",70,0)
 ;        0  Ok
"RTN","RORX015C",71,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX015C",72,0)
 ;
"RTN","RORX015C",73,0)
PATIENTS(PTAG,NODE) ;
"RTN","RORX015C",74,0)
 N DATE,DOD,ICN,IEN,ITEM,LAST4,PACT,PCP,PTIEN,PROCLST,PTCPTL,PTLST,PTNAME,SRC,TMP,RORPROCSYS,RORPROCCODE
"RTN","RORX015C",75,0)
 N AGE,AGETYPE
"RTN","RORX015C",76,0)
 S (PROCLST,PTLST)=-1
"RTN","RORX015C",77,0)
 ;--- Table for patients with procedures
"RTN","RORX015C",78,0)
 I RORPROC>0  D  Q:PROCLST<0 PROCLST
"RTN","RORX015C",79,0)
 . S PROCLST=$$ADDVAL^RORTSK11(RORTSK,"PROCEDURES",,PTAG)
"RTN","RORX015C",80,0)
 . D ADDATTR^RORTSK11(RORTSK,PROCLST,"TABLE","PROCEDURES")
"RTN","RORX015C",81,0)
 . ;--- Force the privacy note
"RTN","RORX015C",82,0)
 . D ADDVAL^RORTSK11(RORTSK,"PATIENT",,PTAG)
"RTN","RORX015C",83,0)
 ;--- Table for patients without procedures
"RTN","RORX015C",84,0)
 I RORPROC<0  D  Q:PTLST<0 PTLST
"RTN","RORX015C",85,0)
 . S PTLST=$$ADDVAL^RORTSK11(RORTSK,"PATIENTS",,PTAG)
"RTN","RORX015C",86,0)
 . D ADDATTR^RORTSK11(RORTSK,PTLST,"TABLE","PATIENTS")
"RTN","RORX015C",87,0)
 ;---
"RTN","RORX015C",88,0)
 S PTIEN=0
"RTN","RORX015C",89,0)
 S AGETYPE=$$PARAM^RORTSK01("AGE_RANGE","TYPE")
"RTN","RORX015C",90,0)
 F  S PTIEN=$O(@NODE@("PAT",PTIEN))  Q:PTIEN'>0  D
"RTN","RORX015C",91,0)
 . S TMP=@NODE@("PAT",PTIEN)
"RTN","RORX015C",92,0)
 . S LAST4=$P(TMP,U),PTNAME=$P(TMP,U,2),DOD=$P(TMP,U,3),ICN=$P(TMP,U,4),PACT=$P(TMP,U,5),PCP=$P(TMP,U,6),AGE=$P(TMP,U,7)
"RTN","RORX015C",93,0)
 . ;--- Patient list
"RTN","RORX015C",94,0)
 . I RORPROC<0  D  Q
"RTN","RORX015C",95,0)
 . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"PATIENT",,PTLST,,PTIEN)
"RTN","RORX015C",96,0)
 . . D ADDVAL^RORTSK11(RORTSK,"NAME",PTNAME,ITEM,2)
"RTN","RORX015C",97,0)
 . . D ADDVAL^RORTSK11(RORTSK,"LAST4",LAST4,ITEM,2)
"RTN","RORX015C",98,0)
 . . I AGETYPE'="ALL" D ADDVAL^RORTSK11(RORTSK,AGETYPE,AGE,ITEM,1)
"RTN","RORX015C",99,0)
 . . D ADDVAL^RORTSK11(RORTSK,"DOD",DOD,ITEM,1)
"RTN","RORX015C",100,0)
 . . I $$PARAM^RORTSK01("PATIENTS","ICN") D ADDVAL^RORTSK11(RORTSK,"ICN",ICN,ITEM,1)
"RTN","RORX015C",101,0)
 . . I $$PARAM^RORTSK01("PATIENTS","PACT") D ADDVAL^RORTSK11(RORTSK,"PACT",PACT,ITEM,1)
"RTN","RORX015C",102,0)
 . . I $$PARAM^RORTSK01("PATIENTS","PCP") D ADDVAL^RORTSK11(RORTSK,"PCP",PCP,ITEM,1)
"RTN","RORX015C",103,0)
 . ;--- Patients and procedures
"RTN","RORX015C",104,0)
 . F SRC="I","O"  D
"RTN","RORX015C",105,0)
 . . S IEN=0
"RTN","RORX015C",106,0)
 . . F  S IEN=$O(@NODE@("PAT",PTIEN,SRC,IEN))  Q:IEN'>0  D
"RTN","RORX015C",107,0)
 . . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"PROCEDURE",,PROCLST,,PTIEN)
"RTN","RORX015C",108,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"NAME",PTNAME,ITEM,2)
"RTN","RORX015C",109,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"LAST4",LAST4,ITEM,2)
"RTN","RORX015C",110,0)
 . . . I AGETYPE'="ALL" D ADDVAL^RORTSK11(RORTSK,AGETYPE,AGE,ITEM,1)
"RTN","RORX015C",111,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"DOD",DOD,ITEM,1)
"RTN","RORX015C",112,0)
 . . . I $$PARAM^RORTSK01("PATIENTS","ICN") D ADDVAL^RORTSK11(RORTSK,"ICN",ICN,ITEM,1)
"RTN","RORX015C",113,0)
 . . . I $$PARAM^RORTSK01("PATIENTS","PACT") S PACT="" S PACT=$$PACT^RORUTL02(PTIEN) D ADDVAL^RORTSK11(RORTSK,"PACT",PACT,ITEM,1)
"RTN","RORX015C",114,0)
 . . . I $$PARAM^RORTSK01("PATIENTS","PCP") S PCP="" S PCP=$$PCP^RORUTL02(PTIEN) D ADDVAL^RORTSK11(RORTSK,"PCP",PCP,ITEM,1)
"RTN","RORX015C",115,0)
 . . . S TMP=$G(@NODE@("PAT",PTIEN,SRC,IEN))
"RTN","RORX015C",116,0)
 . . . S DATE=$P(TMP,U)
"RTN","RORX015C",117,0)
 . . . I SRC="O"  D
"RTN","RORX015C",118,0)
 . . . . S TMP=$$CPT^ICPTCOD(IEN,DATE)  S:TMP<0 TMP=""
"RTN","RORX015C",119,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"PROCODE",$P(TMP,U,2),ITEM,2)
"RTN","RORX015C",120,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"PROCNAME",$P(TMP,U,3),ITEM,2)
"RTN","RORX015C",121,0)
 . . . E  D
"RTN","RORX015C",122,0)
 . . . . S RORPROCSYS=+$$CSI^ICDEX(80.1,IEN)
"RTN","RORX015C",123,0)
 . . . . S TMP=$$ICDOP^ICDEX(IEN,DATE,,"I")  S:TMP<0 TMP=""
"RTN","RORX015C",124,0)
 . . . . S RORPROCCODE="("_$S(RORPROCSYS=2:"ICD-9",RORPROCSYS=31:"ICD-10",1:"UNKN")_") "_$P(TMP,U,2)
"RTN","RORX015C",125,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"PROCODE",RORPROCCODE,ITEM,2)
"RTN","RORX015C",126,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"PROCNAME",$P(TMP,U,5),ITEM,2)
"RTN","RORX015C",127,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"DATE",$$DATE^RORXU002(DATE\1),ITEM,1)
"RTN","RORX015C",128,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"SOURCE",SRC,ITEM,1)
"RTN","RORX015C",129,0)
 Q 0
"RTN","RORX015C",130,0)
 ;
"RTN","RORX015C",131,0)
 ;***** STORES THE REPORT DATA
"RTN","RORX015C",132,0)
 ;
"RTN","RORX015C",133,0)
 ; REPORT        IEN of the REPORT element
"RTN","RORX015C",134,0)
 ;
"RTN","RORX015C",135,0)
 ; Return Values:
"RTN","RORX015C",136,0)
 ;       <0  Error code
"RTN","RORX015C",137,0)
 ;        0  Ok
"RTN","RORX015C",138,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX015C",139,0)
 ;
"RTN","RORX015C",140,0)
STORE(REPORT) ;
"RTN","RORX015C",141,0)
 N ECNT,RC,SECTION,TMP
"RTN","RORX015C",142,0)
 S (ECNT,RC)=0
"RTN","RORX015C",143,0)
 ;--- Procedure codes
"RTN","RORX015C",144,0)
 I RORPROC>0  D  Q:RC<0 RC
"RTN","RORX015C",145,0)
 . S RC=$$CODES(REPORT,RORTMP)
"RTN","RORX015C",146,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX015C",147,0)
 . S RC=$$LOOP^RORTSK01(.3)
"RTN","RORX015C",148,0)
 ;--- Patients
"RTN","RORX015C",149,0)
 S TMP=$$PARAM^RORTSK01("OPTIONS","COMPLETE")
"RTN","RORX015C",150,0)
 I TMP  D  I RC  Q:RC<0 RC  S ECNT=ECNT+RC
"RTN","RORX015C",151,0)
 . S RC=$$PATIENTS(REPORT,RORTMP)
"RTN","RORX015C",152,0)
 S RC=$$LOOP^RORTSK01(.99)  Q:RC<0 RC
"RTN","RORX015C",153,0)
 ;--- Totals
"RTN","RORX015C",154,0)
 S SECTION=$$ADDVAL^RORTSK11(RORTSK,"SUMMARY",,REPORT)
"RTN","RORX015C",155,0)
 Q:SECTION<0 SECTION
"RTN","RORX015C",156,0)
 S TMP=$G(@RORTMP@("PROC"))
"RTN","RORX015C",157,0)
 D ADDVAL^RORTSK11(RORTSK,"NC",+$P(TMP,U,1),SECTION)
"RTN","RORX015C",158,0)
 D ADDVAL^RORTSK11(RORTSK,"NDC",+$P(TMP,U,2),SECTION)
"RTN","RORX015C",159,0)
 S TMP=$G(@RORTMP@("PAT"))
"RTN","RORX015C",160,0)
 D ADDVAL^RORTSK11(RORTSK,"NP",+TMP,SECTION)
"RTN","RORX015C",161,0)
 ;---
"RTN","RORX015C",162,0)
 Q ECNT
"RTN","RORX016")
0^34^B11086418^B9229044
"RTN","RORX016",1,0)
RORX016 ;HCIOFO/BH,SG - OUTPATIENT UTILIZATION ;10/14/05 2:06pm
"RTN","RORX016",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**21,31**;Feb 17, 2006;Build 62
"RTN","RORX016",3,0)
 ;
"RTN","RORX016",4,0)
 Q
"RTN","RORX016",5,0)
 ;******************************************************************************
"RTN","RORX016",6,0)
 ;                       --- ROUTINE MODIFICATION LOG ---
"RTN","RORX016",7,0)
 ;        
"RTN","RORX016",8,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORX016",9,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","RORX016",10,0)
 ;ROR*1.5*21   SEP 2013    T KOPP       Added ICN as last report column if
"RTN","RORX016",11,0)
 ;                                      additional identifier option selected
"RTN","RORX016",12,0)
 ;ROR*1.5*31   MAY 2017  M FERRARESE    Adding PACT, PCP, and AGE/DOB as additional
"RTN","RORX016",13,0)
 ;                                      identifiers.
"RTN","RORX016",14,0)
 ;******************************************************************************
"RTN","RORX016",15,0)
 ;
"RTN","RORX016",16,0)
 ;***** OUTPUTS THE REPORT HEADER
"RTN","RORX016",17,0)
 ;
"RTN","RORX016",18,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX016",19,0)
 ;
"RTN","RORX016",20,0)
 ; Return Values:
"RTN","RORX016",21,0)
 ;       <0  Error code
"RTN","RORX016",22,0)
 ;       >0  IEN of the HEADER element
"RTN","RORX016",23,0)
 ;
"RTN","RORX016",24,0)
HEADER(PARTAG) ;
"RTN","RORX016",25,0)
 ;;CLINICS(#,STOP,NAME,NP,NV,NSC)
"RTN","RORX016",26,0)
 ;;HU_STOPS(#,NAME,LAST4,AGE,NV,NSC,NDS,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="AGE"
"RTN","RORX016",27,0)
 ;;HU_STOPS(#,NAME,LAST4,DOB,NV,NSC,NDS,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="DOB"
"RTN","RORX016",28,0)
 ;;HU_STOPS(#,NAME,LAST4,NV,NSC,NDS,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="ALL"
"RTN","RORX016",29,0)
 ;;STOPS(NP,NSC)
"RTN","RORX016",30,0)
 ;
"RTN","RORX016",31,0)
 N HEADER,RC
"RTN","RORX016",32,0)
 S HEADER=$$HEADER^RORXU002(.RORTSK,PARTAG)
"RTN","RORX016",33,0)
 Q:HEADER<0 HEADER
"RTN","RORX016",34,0)
 S RC=$$TBLDEF^RORXU002("HEADER^RORX016",HEADER)
"RTN","RORX016",35,0)
 Q $S(RC<0:RC,1:HEADER)
"RTN","RORX016",36,0)
 ;
"RTN","RORX016",37,0)
 ;
"RTN","RORX016",38,0)
 ;***** COMPILES THE "OUTPATIENT UTILIZATION" REPORT
"RTN","RORX016",39,0)
 ; REPORT CODE: 016
"RTN","RORX016",40,0)
 ;
"RTN","RORX016",41,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORX016",42,0)
 ;
"RTN","RORX016",43,0)
 ; The ^TMP("RORX016",$J) global node is used by this function.
"RTN","RORX016",44,0)
 ;
"RTN","RORX016",45,0)
 ; ^TMP("RORX016",$J,
"RTN","RORX016",46,0)
 ;
"RTN","RORX016",47,0)
 ;     "OP",             Number of outpatients
"RTN","RORX016",48,0)
 ;       DFN,            Patient's data
"RTN","RORX016",49,0)
 ;                         ^01: Number of stops
"RTN","RORX016",50,0)
 ;                         ^02: Number of different stops
"RTN","RORX016",51,0)
 ;                         ^03: Last 4 digits of SSN
"RTN","RORX016",52,0)
 ;                         ^04: Number of visits
"RTN","RORX016",53,0)
 ;                         ^05: National ICN
"RTN","RORX016",54,0)
 ;                         ^06: Patient Care Team
"RTN","RORX016",55,0)
 ;                         ^07: Primary Care Provider
"RTN","RORX016",56,0)
 ;                         ^08: Age/DOB
"RTN","RORX016",57,0)
 ;                       Children of this node are KILL'ed by
"RTN","RORX016",58,0)
 ;                       the $$TOTALS^RORX016B function.
"RTN","RORX016",59,0)
 ;         Date,         Number of stops associated with the visit
"RTN","RORX016",60,0)
 ;           StopCode)   Quantity
"RTN","RORX016",61,0)
 ;
"RTN","RORX016",62,0)
 ;     "OPS",            Totals
"RTN","RORX016",63,0)
 ;                         ^01: Total number of stops
"RTN","RORX016",64,0)
 ;                         ^02: Number of different stops
"RTN","RORX016",65,0)
 ;       StopCode,       Name of the Clinic Stop Code
"RTN","RORX016",66,0)
 ;         "P")          Number of patients
"RTN","RORX016",67,0)
 ;         "S")          Quantity
"RTN","RORX016",68,0)
 ;         "V")          Number of visits
"RTN","RORX016",69,0)
 ;
"RTN","RORX016",70,0)
 ;     "OPS1",
"RTN","RORX016",71,0)
 ;       NumOfStops,     Number of patients
"RTN","RORX016",72,0)
 ;         PatientName,
"RTN","RORX016",73,0)
 ;           DFN)
"RTN","RORX016",74,0)
 ;
"RTN","RORX016",75,0)
 ;     "OPV")            Total number of visits
"RTN","RORX016",76,0)
 ;
"RTN","RORX016",77,0)
 ; Return Values:
"RTN","RORX016",78,0)
 ;       <0  Error code
"RTN","RORX016",79,0)
 ;        0  Ok
"RTN","RORX016",80,0)
 ;
"RTN","RORX016",81,0)
OPUTL(RORTSK) ;
"RTN","RORX016",82,0)
 N RORDIV        ; List of division IEN's
"RTN","RORX016",83,0)
 N ROREDT        ; End date
"RTN","RORX016",84,0)
 N RORREG        ; Registry IEN
"RTN","RORX016",85,0)
 N RORSDT        ; Start date
"RTN","RORX016",86,0)
 ;
"RTN","RORX016",87,0)
 N ECNT,RC,REPORT,SFLAGS,TMP
"RTN","RORX016",88,0)
 S (ECNT,RC)=0  K ^TMP("RORX016",$J)
"RTN","RORX016",89,0)
 ;--- Root node of the report
"RTN","RORX016",90,0)
 S REPORT=$$ADDVAL^RORTSK11(RORTSK,"REPORT")
"RTN","RORX016",91,0)
 Q:REPORT<0 REPORT
"RTN","RORX016",92,0)
 ;
"RTN","RORX016",93,0)
 ;--- Get and prepare the report parameters
"RTN","RORX016",94,0)
 S RORREG=$$PARAM^RORTSK01("REGIEN")
"RTN","RORX016",95,0)
 S RC=$$PARAMS(REPORT,.RORSDT,.ROREDT,.SFLAGS)  Q:RC<0 RC
"RTN","RORX016",96,0)
 ;
"RTN","RORX016",97,0)
 ;--- Report header
"RTN","RORX016",98,0)
 S RC=$$HEADER(REPORT)  Q:RC<0 RC
"RTN","RORX016",99,0)
 ;
"RTN","RORX016",100,0)
 D
"RTN","RORX016",101,0)
 . ;--- Query the registry
"RTN","RORX016",102,0)
 . D TPPSETUP^RORTSK01(70)
"RTN","RORX016",103,0)
 . S RC=$$QUERY^RORX016A(SFLAGS)
"RTN","RORX016",104,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX016",105,0)
 . ;--- Sort the data
"RTN","RORX016",106,0)
 . D TPPSETUP^RORTSK01(15)
"RTN","RORX016",107,0)
 . S RC=$$SORT^RORX016B()
"RTN","RORX016",108,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX016",109,0)
 . ;--- Store the results
"RTN","RORX016",110,0)
 . D TPPSETUP^RORTSK01(15)
"RTN","RORX016",111,0)
 . S RC=$$STORE^RORX016C(REPORT)
"RTN","RORX016",112,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX016",113,0)
 ;
"RTN","RORX016",114,0)
 ;--- Cleanup
"RTN","RORX016",115,0)
 K ^TMP("RORX016",$J)
"RTN","RORX016",116,0)
 Q $S(RC<0:RC,ECNT>0:-43,1:0)
"RTN","RORX016",117,0)
 ;
"RTN","RORX016",118,0)
 ;***** OUTPUTS THE PARAMETERS TO THE REPORT
"RTN","RORX016",119,0)
 ;
"RTN","RORX016",120,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX016",121,0)
 ;
"RTN","RORX016",122,0)
 ; [.STDT]       Start and end dates of the report
"RTN","RORX016",123,0)
 ; [.ENDT]       are returned via these parameters
"RTN","RORX016",124,0)
 ;
"RTN","RORX016",125,0)
 ; [.FLAGS]      Flags for the $$SKIP^RORXU005 are
"RTN","RORX016",126,0)
 ;               returned via this parameter
"RTN","RORX016",127,0)
 ;
"RTN","RORX016",128,0)
 ; Return Values:
"RTN","RORX016",129,0)
 ;       <0  Error code
"RTN","RORX016",130,0)
 ;       >0  IEN of the PARAMETERS element
"RTN","RORX016",131,0)
 ;
"RTN","RORX016",132,0)
PARAMS(PARTAG,STDT,ENDT,FLAGS) ;
"RTN","RORX016",133,0)
 N NAME,PARAMS,TMP
"RTN","RORX016",134,0)
 S PARAMS=$$PARAMS^RORXU002(.RORTSK,PARTAG,.STDT,.ENDT,.FLAGS)
"RTN","RORX016",135,0)
 Q:PARAMS<0 PARAMS
"RTN","RORX016",136,0)
 ;--- Process the list of divisions
"RTN","RORX016",137,0)
 S TMP=$$DIVLST^RORXU006(.RORTSK,PARAMS)
"RTN","RORX016",138,0)
 Q:TMP<0 TMP
"RTN","RORX016",139,0)
 ;--- Additional parameters
"RTN","RORX016",140,0)
 F NAME="MAXUTNUM"  D
"RTN","RORX016",141,0)
 . S TMP=$$PARAM^RORTSK01(NAME)
"RTN","RORX016",142,0)
 . D:TMP'="" ADDVAL^RORTSK11(RORTSK,NAME,TMP,PARAMS)
"RTN","RORX016",143,0)
 ;---
"RTN","RORX016",144,0)
 Q PARAMS
"RTN","RORX016A")
0^59^B15495238^B14149594
"RTN","RORX016A",1,0)
RORX016A ;HOIFO/BH,SG,VAC - OUTPATIENT UTILIZATION (QUERY) ;4/7/09 2:10pm
"RTN","RORX016A",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**8,13,19,31**;Feb 17, 2006;Build 62
"RTN","RORX016A",3,0)
 ;
"RTN","RORX016A",4,0)
 ; This routine uses the following IAs:
"RTN","RORX016A",5,0)
 ;
"RTN","RORX016A",6,0)
 ; #557          Read access to the file #40.7 (controlled)
"RTN","RORX016A",7,0)
 ; #2548         APIs in routine SDQ: ACRP Interface Toolkit (supported)
"RTN","RORX016A",8,0)
 ; #10103        FMADD^XLFDT (supported)
"RTN","RORX016A",9,0)
 ;
"RTN","RORX016A",10,0)
 ;******************************************************************************
"RTN","RORX016A",11,0)
 ;******************************************************************************
"RTN","RORX016A",12,0)
 ;                 --- ROUTINE MODIFICATION LOG ---
"RTN","RORX016A",13,0)
 ;        
"RTN","RORX016A",14,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORX016A",15,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","RORX016A",16,0)
 ;ROR*1.5*8    MAR 2010    V CARR       Modified to handle ICD9 filter for
"RTN","RORX016A",17,0)
 ;                                      'include' or 'exclude'.
"RTN","RORX016A",18,0)
 ;ROR*1.5*13   DEC 2010    A SAUNDERS   User can select specific patients
"RTN","RORX016A",19,0)
 ;ROR*1.5*19   FEB 2012    J SCOTT      Support for ICD-10 Coding System
"RTN","RORX016A",20,0)
 ;ROR*1.5*31   MAY 2017    S ALSAHHAR   Adding AGE/DOB as additional identifiers.
"RTN","RORX016A",21,0)
 ;******************************************************************************
"RTN","RORX016A",22,0)
 ;******************************************************************************
"RTN","RORX016A",23,0)
 Q
"RTN","RORX016A",24,0)
 ;
"RTN","RORX016A",25,0)
 ;***** LOADS AND PROCESSES THE OUTPATIENT DATA
"RTN","RORX016A",26,0)
 ;
"RTN","RORX016A",27,0)
 ; RORDFN        Patient IEN (in file #2)
"RTN","RORX016A",28,0)
 ;
"RTN","RORX016A",29,0)
 ; Return Values:
"RTN","RORX016A",30,0)
 ;       <0  Error code
"RTN","RORX016A",31,0)
 ;        0  Ok
"RTN","RORX016A",32,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX016A",33,0)
 ;
"RTN","RORX016A",34,0)
OPDATA(RORDFN) ;
"RTN","RORX016A",35,0)
 N QUERY,RORDST,RORECNT
"RTN","RORX016A",36,0)
 S RORDST=$NA(^TMP("RORX016",$J))
"RTN","RORX016A",37,0)
 D OPEN^SDQ(.QUERY)
"RTN","RORX016A",38,0)
 D INDEX^SDQ(.QUERY,"PATIENT/DATE","SET")
"RTN","RORX016A",39,0)
 D PAT^SDQ(.QUERY,RORDFN,"SET")
"RTN","RORX016A",40,0)
 D DATE^SDQ(.QUERY,RORSDT,ROREDT1,"SET")
"RTN","RORX016A",41,0)
 D SCANCB^SDQ(.QUERY,"D SCAN^RORX016A(Y,Y0)","SET")
"RTN","RORX016A",42,0)
 D ACTIVE^SDQ(.QUERY,"TRUE","SET")
"RTN","RORX016A",43,0)
 D SCAN^SDQ(.QUERY,"FORWARD")
"RTN","RORX016A",44,0)
 D CLOSE^SDQ(.QUERY)
"RTN","RORX016A",45,0)
 Q +$G(RORECNT)
"RTN","RORX016A",46,0)
 ;
"RTN","RORX016A",47,0)
 ;***** QUERIES THE REGISTRY
"RTN","RORX016A",48,0)
 ;
"RTN","RORX016A",49,0)
 ; FLAGS         Flags for the $$SKIP^RORXU005
"RTN","RORX016A",50,0)
 ;
"RTN","RORX016A",51,0)
 ; Return Values:
"RTN","RORX016A",52,0)
 ;       <0  Error code
"RTN","RORX016A",53,0)
 ;        0  Ok
"RTN","RORX016A",54,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX016A",55,0)
 ;
"RTN","RORX016A",56,0)
QUERY(FLAGS) ;
"RTN","RORX016A",57,0)
 N ROREDT1       ; Day after the end date
"RTN","RORX016A",58,0)
 N RORLAST4      ; Last 4 digits of the current patient's SSN
"RTN","RORX016A",59,0)
 N RORPNAME      ; Name of the current patient
"RTN","RORX016A",60,0)
 N RORPTN        ; Number of patients in the registry
"RTN","RORX016A",61,0)
 ;
"RTN","RORX016A",62,0)
 N CNT,ECNT,IEN,IENS,PATIEN,RC,TMP,VA,VADM,XREFNODE,AGE,AGETYPE
"RTN","RORX016A",63,0)
 N RCC,FLAG
"RTN","RORX016A",64,0)
 S XREFNODE=$NA(^RORDATA(798,"AC",+RORREG))
"RTN","RORX016A",65,0)
 S RORPTN=$$REGSIZE^RORUTL02(+RORREG)  S:RORPTN<0 RORPTN=0
"RTN","RORX016A",66,0)
 S ROREDT1=$$FMADD^XLFDT(ROREDT,1)
"RTN","RORX016A",67,0)
 S (CNT,ECNT,RC)=0
"RTN","RORX016A",68,0)
 ;--- Browse through the registry records
"RTN","RORX016A",69,0)
 S IEN=0
"RTN","RORX016A",70,0)
 S FLAG=$G(RORTSK("PARAMS","ICDFILT","A","FILTER"))
"RTN","RORX016A",71,0)
 F  S IEN=$O(@XREFNODE@(IEN))  Q:IEN'>0  D  Q:RC<0
"RTN","RORX016A",72,0)
 . S TMP=$S(RORPTN>0:CNT/RORPTN,1:"")
"RTN","RORX016A",73,0)
 . S RC=$$LOOP^RORTSK01(TMP)  Q:RC<0
"RTN","RORX016A",74,0)
 . S IENS=IEN_",",CNT=CNT+1
"RTN","RORX016A",75,0)
 . ;--- Get the patient DFN
"RTN","RORX016A",76,0)
 . S PATIEN=$$PTIEN^RORUTL01(IEN)  Q:PATIEN'>0
"RTN","RORX016A",77,0)
 . ;--- Check for patient list and quit if not in list
"RTN","RORX016A",78,0)
 . I $D(RORTSK("PARAMS","PATIENTS","C")),'$D(RORTSK("PARAMS","PATIENTS","C",PATIEN)) Q
"RTN","RORX016A",79,0)
 . ;--- Check if the patient should be skipped
"RTN","RORX016A",80,0)
 . Q:$$SKIP^RORXU005(IEN,FLAGS,RORSDT,ROREDT)
"RTN","RORX016A",81,0)
 . ;--- Check the patient against the ICD Filter
"RTN","RORX016A",82,0)
 . S RCC=0
"RTN","RORX016A",83,0)
 . I FLAG'="ALL" D
"RTN","RORX016A",84,0)
 . . S RCC=$$ICD^RORXU010(PATIEN)
"RTN","RORX016A",85,0)
 . I (FLAG="INCLUDE")&(RCC=0) Q
"RTN","RORX016A",86,0)
 . I (FLAG="EXCLUDE")&(RCC=1) Q
"RTN","RORX016A",87,0)
 . ;--- End of ICD Filter check
"RTN","RORX016A",88,0)
 . ;
"RTN","RORX016A",89,0)
 . ;--- Get the patient's data
"RTN","RORX016A",90,0)
 . D VADEM^RORUTL05(PATIEN,1)
"RTN","RORX016A",91,0)
 . S RORPNAME=VADM(1),RORLAST4=VA("BID")
"RTN","RORX016A",92,0)
 . S AGETYPE=$$PARAM^RORTSK01("AGE_RANGE","TYPE")
"RTN","RORX016A",93,0)
 . S AGE=$S(AGETYPE="AGE":$P(VADM(4),U),AGETYPE="DOB":$$DATE^RORXU002($P(VADM(3),U)\1),1:"")
"RTN","RORX016A",94,0)
 . ;
"RTN","RORX016A",95,0)
 . ;--- Get the outpatient data
"RTN","RORX016A",96,0)
 . S RC=$$OPDATA(PATIEN)
"RTN","RORX016A",97,0)
 . I RC  S ECNT=ECNT+1  Q:RC<0
"RTN","RORX016A",98,0)
 . ;
"RTN","RORX016A",99,0)
 . ;--- Calculate intermediate totals
"RTN","RORX016A",100,0)
 . S RC=$$TOTALS^RORX016B(PATIEN,AGE)
"RTN","RORX016A",101,0)
 . I RC  S ECNT=ECNT+1  Q:RC<0
"RTN","RORX016A",102,0)
 ;---
"RTN","RORX016A",103,0)
 Q $S(RC<0:RC,1:ECNT)
"RTN","RORX016A",104,0)
 ;
"RTN","RORX016A",105,0)
 ;***** CALLBACK ENTRY POINT FOR ACRP API
"RTN","RORX016A",106,0)
SCAN(Y,Y0) ;
"RTN","RORX016A",107,0)
 N DTX,STOP,TMP
"RTN","RORX016A",108,0)
 ;--- Check the division list
"RTN","RORX016A",109,0)
 S TMP=$$PARAM^RORTSK01("DIVISIONS","ALL")
"RTN","RORX016A",110,0)
 I 'TMP  Q:'$D(RORTSK("PARAMS","DIVISIONS","C",+$P(Y0,U,11)))
"RTN","RORX016A",111,0)
 ;--- Data comes from the OUTPATIENT ENCOUNTER file (409.68)
"RTN","RORX016A",112,0)
 S STOP=$P($G(^DIC(40.7,+$P(Y0,U,3),0)),U,2),DTX=Y0\1
"RTN","RORX016A",113,0)
 S:STOP="" STOP="NSC"
"RTN","RORX016A",114,0)
 S @RORDST@("OP",RORDFN,DTX)=$G(@RORDST@("OP",RORDFN,DTX))+1
"RTN","RORX016A",115,0)
 S @RORDST@("OP",RORDFN,DTX,STOP)=$G(@RORDST@("OP",RORDFN,DTX,STOP))+1
"RTN","RORX016A",116,0)
 Q
"RTN","RORX016B")
0^35^B12089847^B9775689
"RTN","RORX016B",1,0)
RORX016B ;HCIOFO/BH,SG - OUTPATIENT UTILIZATION (SORT) ;9/14/05 10:08am
"RTN","RORX016B",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**21,31**;Feb 17, 2006;Build 62
"RTN","RORX016B",3,0)
 ;
"RTN","RORX016B",4,0)
 Q
"RTN","RORX016B",5,0)
 ;******************************************************************************
"RTN","RORX016B",6,0)
 ;                       --- ROUTINE MODIFICATION LOG ---
"RTN","RORX016B",7,0)
 ;        
"RTN","RORX016B",8,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORX016B",9,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","RORX016B",10,0)
 ;ROR*1.5*21   SEP 2013    T KOPP       Added ICN as last report column if
"RTN","RORX016B",11,0)
 ;                                      additional identifier option selected
"RTN","RORX016B",12,0)
 ;ROR*1.5*31   MAY 2017    M FERRARESE  Adding PACT and PCP as additional identifiers.
"RTN","RORX016B",13,0)
 ;******************************************************************************
"RTN","RORX016B",14,0)
 ;
"RTN","RORX016B",15,0)
 ;***** SORTS THE RESULTS AND COMPILES THE TOTALS
"RTN","RORX016B",16,0)
 ;
"RTN","RORX016B",17,0)
 ; Return Values:
"RTN","RORX016B",18,0)
 ;       <0  Error code
"RTN","RORX016B",19,0)
 ;        0  Ok
"RTN","RORX016B",20,0)
 ;
"RTN","RORX016B",21,0)
SORT() ;
"RTN","RORX016B",22,0)
 N I,NDSC,NAME,NODE,NSC,NV,RC,RORBUF,RORMSG,STOP,TMP
"RTN","RORX016B",23,0)
 S NODE=$NA(^TMP("RORX016",$J))  Q:$D(@NODE)<10 0
"RTN","RORX016B",24,0)
 ;--- Outpatient stop codes
"RTN","RORX016B",25,0)
 S RC=$$LOOP^RORTSK01(0)  Q:RC<0 RC
"RTN","RORX016B",26,0)
 S STOP="",(NDSC,NSC)=0
"RTN","RORX016B",27,0)
 F  S STOP=$O(@NODE@("OPS",STOP))  Q:STOP=""  D
"RTN","RORX016B",28,0)
 . S NSC=NSC+$G(@NODE@("OPS",STOP,"S")),NDSC=NDSC+1
"RTN","RORX016B",29,0)
 . D FIND^DIC(40.7,,"@;.01","UX",STOP,1,"C",,,"RORBUF","RORMSG")
"RTN","RORX016B",30,0)
 . D:$G(DIERR) DBS^RORERR("RORMSG",-9,,,40.7)
"RTN","RORX016B",31,0)
 . S NAME=$G(RORBUF("DILIST","ID",1,.01))  K RORBUF
"RTN","RORX016B",32,0)
 . S @NODE@("OPS",STOP)=$S(NAME'="":NAME,1:"Unknown")
"RTN","RORX016B",33,0)
 S @NODE@("OPS")=NSC_U_NDSC
"RTN","RORX016B",34,0)
 ;---
"RTN","RORX016B",35,0)
 Q 0
"RTN","RORX016B",36,0)
 ;
"RTN","RORX016B",37,0)
 ;***** CALCULATES THE INTERMEDIATE TOTALS
"RTN","RORX016B",38,0)
 ;
"RTN","RORX016B",39,0)
 ; PATIEN        Patient IEN (DFN)
"RTN","RORX016B",40,0)
 ; CATSUB        Category subscript in the temporary global
"RTN","RORX016B",41,0)
 ;
"RTN","RORX016B",42,0)
 ; Return Values:
"RTN","RORX016B",43,0)
 ;       <0  Error code
"RTN","RORX016B",44,0)
 ;        0  Ok
"RTN","RORX016B",45,0)
 ;
"RTN","RORX016B",46,0)
TOTALS(PATIEN,AGE) ;
"RTN","RORX016B",47,0)
 N NODE,TMP
"RTN","RORX016B",48,0)
 S NODE=$NA(^TMP("RORX016",$J))
"RTN","RORX016B",49,0)
 ;
"RTN","RORX016B",50,0)
 ;=== Outpatient data
"RTN","RORX016B",51,0)
 D:$D(@NODE@("OP",PATIEN))>1
"RTN","RORX016B",52,0)
 . N DATE,NDSC,NPSC,NSC,NV,NVSC,SCLST,STOP
"RTN","RORX016B",53,0)
 . S @NODE@("OP")=$G(@NODE@("OP"))+1
"RTN","RORX016B",54,0)
 . ;---
"RTN","RORX016B",55,0)
 . S (DATE,NPSC,NV)=0
"RTN","RORX016B",56,0)
 . F  S DATE=$O(@NODE@("OP",PATIEN,DATE))  Q:DATE'>0  D
"RTN","RORX016B",57,0)
 . . S NV=NV+1                              ; Number of visits
"RTN","RORX016B",58,0)
 . . S NVSC=@NODE@("OP",PATIEN,DATE)        ; Number of visist's stops
"RTN","RORX016B",59,0)
 . . ;--- Count the patient's stops
"RTN","RORX016B",60,0)
 . . S STOP=""
"RTN","RORX016B",61,0)
 . . F  S STOP=$O(@NODE@("OP",PATIEN,DATE,STOP))  Q:STOP=""  D
"RTN","RORX016B",62,0)
 . . . S NSC=@NODE@("OP",PATIEN,DATE,STOP)  ; Number of stops
"RTN","RORX016B",63,0)
 . . . S @NODE@("OPS",STOP,"S")=$G(@NODE@("OPS",STOP,"S"))+NSC
"RTN","RORX016B",64,0)
 . . . S @NODE@("OPS",STOP,"V")=$G(@NODE@("OPS",STOP,"V"))+(NSC/NVSC)
"RTN","RORX016B",65,0)
 . . . S SCLST(STOP)=""
"RTN","RORX016B",66,0)
 . . S NPSC=NPSC+NVSC                       ; Total number of stops
"RTN","RORX016B",67,0)
 . K @NODE@("OP",PATIEN)
"RTN","RORX016B",68,0)
 . ;--- Count the different stops and patients
"RTN","RORX016B",69,0)
 . S STOP="",NDSC=0
"RTN","RORX016B",70,0)
 . F  S STOP=$O(SCLST(STOP))  Q:STOP=""  D
"RTN","RORX016B",71,0)
 . . S @NODE@("OPS",STOP,"P")=$G(@NODE@("OPS",STOP,"P"))+1
"RTN","RORX016B",72,0)
 . . S NDSC=NDSC+1                          ; Number of diff. stops
"RTN","RORX016B",73,0)
 . ;--- Count the visits
"RTN","RORX016B",74,0)
 . S:NV>0 @NODE@("OPV")=$G(@NODE@("OPV"))+NV
"RTN","RORX016B",75,0)
 . ;--- Count the stop codes
"RTN","RORX016B",76,0)
 . D:NPSC>0
"RTN","RORX016B",77,0)
 . . S @NODE@("OP",PATIEN)=NPSC_U_NDSC_U_$G(VA("BID"))_U_NV_U_$S($$PARAM^RORTSK01("PATIENTS","ICN"):$$ICN^RORUTL02(PATIEN),1:"")
"RTN","RORX016B",78,0)
 . . S @NODE@("OP",PATIEN)=@NODE@("OP",PATIEN)_U_$S($$PARAM^RORTSK01("PATIENTS","PACT"):$$PACT^RORUTL02(PATIEN),1:"")_U_$S($$PARAM^RORTSK01("PATIENTS","PCP"):$$PCP^RORUTL02(PATIEN),1:"")_U_AGE
"RTN","RORX016B",79,0)
 . . S @NODE@("OPS1",NPSC)=$G(@NODE@("OPS1",NPSC))+1
"RTN","RORX016B",80,0)
 . . S @NODE@("OPS1",NPSC,RORPNAME,PATIEN)=""
"RTN","RORX016B",81,0)
 Q 0
"RTN","RORX016C")
0^36^B23020980^B20014196
"RTN","RORX016C",1,0)
RORX016C ;HCIOFO/BH,SG - OUTPATIENT UTILIZATION (STORE) ;9/14/05 9:43am
"RTN","RORX016C",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**21,31**;Feb 17, 2006;Build 62
"RTN","RORX016C",3,0)
 ;
"RTN","RORX016C",4,0)
 Q
"RTN","RORX016C",5,0)
 ;
"RTN","RORX016C",6,0)
 ;******************************************************************************
"RTN","RORX016C",7,0)
 ;                       --- ROUTINE MODIFICATION LOG ---
"RTN","RORX016C",8,0)
 ;        
"RTN","RORX016C",9,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORX016C",10,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","RORX016C",11,0)
 ;ROR*1.5*21   SEP 2013    T KOPP       Added ICN as last report column if
"RTN","RORX016C",12,0)
 ;                                      additional identifier option selected
"RTN","RORX016C",13,0)
 ;ROR*1.5*31   MAY 2017  M FERRARESE    Adding PACT, PCP, and AGE/DOB as additional
"RTN","RORX016C",14,0)
 ;                                      identifiers.
"RTN","RORX016C",15,0)
 ;******************************************************************************
"RTN","RORX016C",16,0)
 ;
"RTN","RORX016C",17,0)
 ;***** HIGHEST UTILIZATION
"RTN","RORX016C",18,0)
 ;
"RTN","RORX016C",19,0)
 ; PRNTELMT      IEN of the parent element
"RTN","RORX016C",20,0)
 ;
"RTN","RORX016C",21,0)
 ; RORNODE       Closed root of the section in the temporary global
"RTN","RORX016C",22,0)
 ;
"RTN","RORX016C",23,0)
 ; Return Values:
"RTN","RORX016C",24,0)
 ;       <0  Error code
"RTN","RORX016C",25,0)
 ;        0  Ok
"RTN","RORX016C",26,0)
 ;
"RTN","RORX016C",27,0)
HIGHUTIL(PRNTELMT,RORNODE) ;
"RTN","RORX016C",28,0)
 N BUF,COUNT,DFN,I,ITEM,NAME,NUM,RC,RORMAXUT,RORTCNT,SECTION,TABLE,TMP,AGETYPE
"RTN","RORX016C",29,0)
 S RORMAXUT=$$PARAM^RORTSK01("MAXUTNUM")
"RTN","RORX016C",30,0)
 Q:RORMAXUT'>0 0
"RTN","RORX016C",31,0)
 S SECTION=$$ADDVAL^RORTSK11(RORTSK,"HIGHUTIL",,PRNTELMT)
"RTN","RORX016C",32,0)
 Q:SECTION<0 SECTION
"RTN","RORX016C",33,0)
 S (RC,RORTCNT)=0
"RTN","RORX016C",34,0)
 S AGETYPE=$$PARAM^RORTSK01("AGE_RANGE","TYPE")
"RTN","RORX016C",35,0)
 ;--- Stops
"RTN","RORX016C",36,0)
 I $D(@RORNODE@("OPS1"))>1  D  Q:RC<0 RC
"RTN","RORX016C",37,0)
 . S TABLE=$$ADDVAL^RORTSK11(RORTSK,"HU_STOPS",,SECTION)
"RTN","RORX016C",38,0)
 . I TABLE<0  S RC=TABLE  Q
"RTN","RORX016C",39,0)
 . D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","HU_STOPS")
"RTN","RORX016C",40,0)
 . S RORTCNT=RORTCNT+1
"RTN","RORX016C",41,0)
 . ;---
"RTN","RORX016C",42,0)
 . S NUM="",(COUNT,RC)=0
"RTN","RORX016C",43,0)
 . F  S NUM=$O(@RORNODE@("OPS1",NUM),-1)  Q:NUM=""  D  Q:RC
"RTN","RORX016C",44,0)
 . . S NAME=""
"RTN","RORX016C",45,0)
 . . F  S NAME=$O(@RORNODE@("OPS1",NUM,NAME))  Q:NAME=""  D  Q:RC
"RTN","RORX016C",46,0)
 . . . S DFN=""
"RTN","RORX016C",47,0)
 . . . F  S DFN=$O(@RORNODE@("OPS1",NUM,NAME,DFN))  Q:DFN=""  D  Q:RC
"RTN","RORX016C",48,0)
 . . . . S COUNT=COUNT+1  I COUNT>RORMAXUT  S RC=1  Q
"RTN","RORX016C",49,0)
 . . . . S BUF=$G(@RORNODE@("OP",DFN))
"RTN","RORX016C",50,0)
 . . . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"PATIENT",,TABLE)
"RTN","RORX016C",51,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"NAME",NAME,ITEM,1)
"RTN","RORX016C",52,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"LAST4",$P(BUF,U,3),ITEM,2)
"RTN","RORX016C",53,0)
 . . . . I AGETYPE'="ALL" D ADDVAL^RORTSK11(RORTSK,AGETYPE,$P(BUF,U,8),ITEM,1)
"RTN","RORX016C",54,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"NV",+$P(BUF,U,4),ITEM,3)
"RTN","RORX016C",55,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"NSC",NUM,ITEM,3)
"RTN","RORX016C",56,0)
 . . . . D ADDVAL^RORTSK11(RORTSK,"NDS",+$P(BUF,U,2),ITEM,3)
"RTN","RORX016C",57,0)
 . . . . I $$PARAM^RORTSK01("PATIENTS","ICN") D
"RTN","RORX016C",58,0)
 . . . . . D ADDVAL^RORTSK11(RORTSK,"ICN",$P(BUF,U,5),ITEM,1)
"RTN","RORX016C",59,0)
 . . . . I $$PARAM^RORTSK01("PATIENTS","PACT") D
"RTN","RORX016C",60,0)
 . . . . . D ADDVAL^RORTSK11(RORTSK,"PACT",$P(BUF,U,6),ITEM,1)
"RTN","RORX016C",61,0)
 . . . . I $$PARAM^RORTSK01("PATIENTS","PCP") D
"RTN","RORX016C",62,0)
 . . . . . D ADDVAL^RORTSK11(RORTSK,"PCP",$P(BUF,U,7),ITEM,1)
"RTN","RORX016C",63,0)
 ;--- Disable the empty section
"RTN","RORX016C",64,0)
 D:RORTCNT'>0 UPDVAL^RORTSK11(RORTSK,SECTION,"",,1)
"RTN","RORX016C",65,0)
 Q 0
"RTN","RORX016C",66,0)
 ;
"RTN","RORX016C",67,0)
 ;***** STORES THE REPORT DATA
"RTN","RORX016C",68,0)
 ;
"RTN","RORX016C",69,0)
 ; REPORT        IEN of the REPORT element
"RTN","RORX016C",70,0)
 ;
"RTN","RORX016C",71,0)
 ; Return Values:
"RTN","RORX016C",72,0)
 ;       <0  Error code
"RTN","RORX016C",73,0)
 ;        0  Ok
"RTN","RORX016C",74,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX016C",75,0)
 ;
"RTN","RORX016C",76,0)
STORE(REPORT) ;
"RTN","RORX016C",77,0)
 N RORSONLY      ; Output summary only
"RTN","RORX016C",78,0)
 ;
"RTN","RORX016C",79,0)
 N ECNT,NODE,RC,TMP
"RTN","RORX016C",80,0)
 S NODE=$NA(^TMP("RORX016",$J))
"RTN","RORX016C",81,0)
 Q:$D(@NODE)<10 0
"RTN","RORX016C",82,0)
 S RORSONLY=$$SMRYONLY^RORXU006(),(ECNT,RC)=0
"RTN","RORX016C",83,0)
 ;--- Outpatients
"RTN","RORX016C",84,0)
 S RC=$$LOOP^RORTSK01(0)    Q:RC<0 RC
"RTN","RORX016C",85,0)
 S RC=$$STOREOP(REPORT,NODE)
"RTN","RORX016C",86,0)
 I RC  Q:RC<0 RC  S ECNT=ECNT+1
"RTN","RORX016C",87,0)
 ;--- Highest utilization
"RTN","RORX016C",88,0)
 S RC=$$LOOP^RORTSK01(0.5)  Q:RC<0 RC
"RTN","RORX016C",89,0)
 S RC=$$HIGHUTIL(REPORT,NODE)
"RTN","RORX016C",90,0)
 I RC  Q:RC<0 RC  S ECNT=ECNT+1
"RTN","RORX016C",91,0)
 ;---
"RTN","RORX016C",92,0)
 Q ECNT
"RTN","RORX016C",93,0)
 ;
"RTN","RORX016C",94,0)
 ;***** OUTPATIENT DATA
"RTN","RORX016C",95,0)
 ;
"RTN","RORX016C",96,0)
 ; PRNTELMT      IEN of the parent element
"RTN","RORX016C",97,0)
 ;
"RTN","RORX016C",98,0)
 ; NODE          Closed root of the category section
"RTN","RORX016C",99,0)
 ;               in the temporary global
"RTN","RORX016C",100,0)
 ;
"RTN","RORX016C",101,0)
 ; Return Values:
"RTN","RORX016C",102,0)
 ;       <0  Error code
"RTN","RORX016C",103,0)
 ;        0  Ok
"RTN","RORX016C",104,0)
 ;
"RTN","RORX016C",105,0)
STOREOP(PRNTELMT,NODE) ;
"RTN","RORX016C",106,0)
 Q:$D(@NODE@("OP"))<10 0
"RTN","RORX016C",107,0)
 N ITEM,NSC,NV,RC,SECTION,STOP,TABLE,TMP
"RTN","RORX016C",108,0)
 S SECTION=$$ADDVAL^RORTSK11(RORTSK,"OUTPATIENTS",,PRNTELMT)
"RTN","RORX016C",109,0)
 Q:SECTION<0 SECTION
"RTN","RORX016C",110,0)
 S RC=0
"RTN","RORX016C",111,0)
 ;--- Stop codes
"RTN","RORX016C",112,0)
 I $D(@NODE@("OPS1"))>1  D  Q:RC<0 RC
"RTN","RORX016C",113,0)
 . S TABLE=$$ADDVAL^RORTSK11(RORTSK,"STOPS",,SECTION)
"RTN","RORX016C",114,0)
 . I TABLE<0  S RC=TABLE  Q
"RTN","RORX016C",115,0)
 . D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","STOPS")
"RTN","RORX016C",116,0)
 . S NSC=""
"RTN","RORX016C",117,0)
 . F  S NSC=$O(@NODE@("OPS1",NSC),-1)  Q:NSC=""  D
"RTN","RORX016C",118,0)
 . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"ITEM",,TABLE)
"RTN","RORX016C",119,0)
 . . D ADDVAL^RORTSK11(RORTSK,"NP",$P(@NODE@("OPS1",NSC),U),ITEM,3)
"RTN","RORX016C",120,0)
 . . D ADDVAL^RORTSK11(RORTSK,"NSC",NSC,ITEM,3)
"RTN","RORX016C",121,0)
 ;--- Clinics
"RTN","RORX016C",122,0)
 I $D(@NODE@("OPS"))>1  D  Q:RC<0 RC
"RTN","RORX016C",123,0)
 . S TABLE=$$ADDVAL^RORTSK11(RORTSK,"CLINICS",,SECTION)
"RTN","RORX016C",124,0)
 . I TABLE<0  S RC=TABLE  Q
"RTN","RORX016C",125,0)
 . D ADDATTR^RORTSK11(RORTSK,TABLE,"TABLE","CLINICS")
"RTN","RORX016C",126,0)
 . S STOP=""
"RTN","RORX016C",127,0)
 . F  S STOP=$O(@NODE@("OPS",STOP))  Q:STOP=""  D
"RTN","RORX016C",128,0)
 . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"CLINIC",,TABLE)
"RTN","RORX016C",129,0)
 . . D ADDVAL^RORTSK11(RORTSK,"STOP",STOP,ITEM,3)
"RTN","RORX016C",130,0)
 . . D ADDVAL^RORTSK11(RORTSK,"NAME",$P(@NODE@("OPS",STOP),U),ITEM,1)
"RTN","RORX016C",131,0)
 . . D ADDVAL^RORTSK11(RORTSK,"NP",+$G(@NODE@("OPS",STOP,"P")),ITEM,3)
"RTN","RORX016C",132,0)
 . . S TMP=+$G(@NODE@("OPS",STOP,"V"))
"RTN","RORX016C",133,0)
 . . D ADDVAL^RORTSK11(RORTSK,"NV",$J(TMP,0,2),ITEM,3)
"RTN","RORX016C",134,0)
 . . D ADDVAL^RORTSK11(RORTSK,"NSC",+$G(@NODE@("OPS",STOP,"S")),ITEM,3)
"RTN","RORX016C",135,0)
 ;--- Summary
"RTN","RORX016C",136,0)
 D ADDVAL^RORTSK11(RORTSK,"NP",+$G(@NODE@("OP")),SECTION)
"RTN","RORX016C",137,0)
 D ADDVAL^RORTSK11(RORTSK,"NV",+$G(@NODE@("OPV")),SECTION)
"RTN","RORX016C",138,0)
 D ADDVAL^RORTSK11(RORTSK,"NSC",+$G(@NODE@("OPS")),SECTION)
"RTN","RORX016C",139,0)
 Q 0
"RTN","RORX018")
0^37^B166229893^B167696194
"RTN","RORX018",1,0)
RORX018 ;BPOIFO/ACS - BMI BY RANGE REPORT ;11/1/09
"RTN","RORX018",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**10,13,19,21,31**;Feb 17, 2006;Build 62
"RTN","RORX018",3,0)
 ;
"RTN","RORX018",4,0)
 ;
"RTN","RORX018",5,0)
 ; This routine uses the following IAs:
"RTN","RORX018",6,0)
 ;
"RTN","RORX018",7,0)
 ; #4290  ^PXRMINDX(120.5 (controlled)
"RTN","RORX018",8,0)
 ; #3647   $$EN^GMVPXRM (controlled)
"RTN","RORX018",9,0)
 ; #5047   $$GETIEN^GMVGETVT (supported)
"RTN","RORX018",10,0)
 ;
"RTN","RORX018",11,0)
 ;******************************************************************************
"RTN","RORX018",12,0)
 ;******************************************************************************
"RTN","RORX018",13,0)
 ;                 --- ROUTINE MODIFICATION LOG ---
"RTN","RORX018",14,0)
 ;        
"RTN","RORX018",15,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORX018",16,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","RORX018",17,0)
 ;ROR*1.5*10   MAR  2010   A SAUNDERS   Routine created
"RTN","RORX018",18,0)
 ;ROR*1.5*13   DEC  2010   A SAUNDERS   User can select specific patients,
"RTN","RORX018",19,0)
 ;                                      clinics, or divisions for the report.
"RTN","RORX018",20,0)
 ;                                      Modified XML tags for sort.
"RTN","RORX018",21,0)
 ;ROR*1.5*19   FEB  2012   K GUPTA      Support for ICD-10 Coding System
"RTN","RORX018",22,0)
 ;ROR*1.5*21   SEP 2013    T KOPP       Add ICN column if Additional Identifier
"RTN","RORX018",23,0)
 ;                                       requested.
"RTN","RORX018",24,0)
 ;ROR*1.5*31   MAY 2017    M FERRARESE  Adding PACT, PCP, and AGE/DOB as additional
"RTN","RORX018",25,0)
 ;                                       identifiers. 
"RTN","RORX018",26,0)
 ;                                      
"RTN","RORX018",27,0)
 ;******************************************************************************
"RTN","RORX018",28,0)
 ;******************************************************************************
"RTN","RORX018",29,0)
 Q
"RTN","RORX018",30,0)
 ;*****************************************************************************
"RTN","RORX018",31,0)
 ;COMPILE THE "BMI BY RANGE" REPORT
"RTN","RORX018",32,0)
 ;REPORT CODE: 018
"RTN","RORX018",33,0)
 ;
"RTN","RORX018",34,0)
 ;Called by entry "BMI by Range" in ROR REPORT PARAMETERS (#799.34)
"RTN","RORX018",35,0)
 ;
"RTN","RORX018",36,0)
 ;INPUT
"RTN","RORX018",37,0)
 ;  RORTSK     Task number and task parameters
"RTN","RORX018",38,0)
 ;
"RTN","RORX018",39,0)
 ;  Below is a sample RORTSK input array for utilization in 2003, most recent
"RTN","RORX018",40,0)
 ;  scores, BMI range from 30 to 45:
"RTN","RORX018",41,0)
 ;
"RTN","RORX018",42,0)
 ;  RORTSK=nnn   (task number)
"RTN","RORX018",43,0)
 ;  RORTSK("EP")="$$BMIRANGE^RORX018"
"RTN","RORX018",44,0)
 ;  RORTSK("PARAMS","AGE_RANGE","A","TYPE")=ALL
"RTN","RORX018",45,0)
 ;  RORTSK("PARAMS","AGE_RANGE","A","TYPE")=DOB
"RTN","RORX018",46,0)
 ;  RORTSK("PARAMS","AGE_RANGE","A","END")=3031231
"RTN","RORX018",47,0)
 ;  RORTSK("PARAMS","AGE_RANGE","A","START")=3030101
"RTN","RORX018",48,0)
 ;  RORTSK("PARAMS","AGE_RANGE","A","TYPE")=AGE
"RTN","RORX018",49,0)
 ;  RORTSK("PARAMS","AGE_RANGE","A","END")=3031231
"RTN","RORX018",50,0)
 ;  RORTSK("PARAMS","AGE_RANGE","A","START")=3030101
"RTN","RORX018",51,0)
 ;  RORTSK("PARAMS","DATE_RANGE_3","A","END")=3031231
"RTN","RORX018",52,0)
 ;  RORTSK("PARAMS","DATE_RANGE_3","A","START")=3030101
"RTN","RORX018",53,0)
 ;  RORTSK("PARAMS","ICD9FILT","A","FILTER")="ALL"
"RTN","RORX018",54,0)
 ;  RORTSK("PARAMS","LRGRANGES","C",1)=""
"RTN","RORX018",55,0)
 ;  RORTSK("PARAMS","LRGRANGES","C",1,"H")=45
"RTN","RORX018",56,0)
 ;  RORTSK("PARAMS","LRGRANGES","C",1,"L")=30
"RTN","RORX018",57,0)
 ;  RORTSK("PARAMS","OPTIONS","A","COMPLETE")=1
"RTN","RORX018",58,0)
 ;  RORTSK("PARAMS","OPTIONS","A","MOST_RECENT")=1
"RTN","RORX018",59,0)
 ;  RORTSK("PARAMS","PATIENTS","A","DE_AFTER")=1
"RTN","RORX018",60,0)
 ;  RORTSK("PARAMS","PATIENTS","A","DE_BEFORE")=1
"RTN","RORX018",61,0)
 ;  RORTSK("PARAMS","PATIENTS","A","DE_DURING")=1
"RTN","RORX018",62,0)
 ;  RORTSK("PARAMS","REGIEN")=1
"RTN","RORX018",63,0)
 ;
"RTN","RORX018",64,0)
 ;  If the user selected an 'as of' date = 12/31/2005:
"RTN","RORX018",65,0)
 ;     RORTSK("PARAMS","OPTIONS","A","MOST_RECENT")=1
"RTN","RORX018",66,0)
 ;  is replaced with:  
"RTN","RORX018",67,0)
 ;     RORTSK("PARAMS","OPTIONS","A","MAX_DATE")=3051231
"RTN","RORX018",68,0)
 ;
"RTN","RORX018",69,0)
 ;OUTPUT
"RTN","RORX018",70,0)
 ;  <0  Error code
"RTN","RORX018",71,0)
 ;   0  Ok
"RTN","RORX018",72,0)
 ;*****************************************************************************
"RTN","RORX018",73,0)
BMIRANGE(RORTSK) ;
"RTN","RORX018",74,0)
 N RORDATA       ; array to hold ROR data and summary totals
"RTN","RORX018",75,0)
 N RORREG        ; Registry IEN
"RTN","RORX018",76,0)
 N RORSDT        ; report start date
"RTN","RORX018",77,0)
 N ROREDT        ; report end date
"RTN","RORX018",78,0)
 N RORPTIEN      ; IEN of patient in the ROR registry
"RTN","RORX018",79,0)
 N DFN           ; DFN of patient in the PATIENT file (#2)
"RTN","RORX018",80,0)
 N RORCDLIST     ; Flag to indicate whether a clinic or division list exists
"RTN","RORX018",81,0)
 N RORCDSTDT     ; Start date for clinic/division utilization search
"RTN","RORX018",82,0)
 N RORCDENDT     ; End date for clinic/division utilization search
"RTN","RORX018",83,0)
 ;
"RTN","RORX018",84,0)
 N REPORT,PARAMS,SFLAGS,RC,CNT,ECNT,UTSDT,UTEDT,SKIPSDT,SKIPEDT,RORBODY,RORPTN
"RTN","RORX018",85,0)
 N RCC,FLAG,TMP,DFN,SKIP
"RTN","RORX018",86,0)
 ;--- Establish the root XML Node of the report and put into output
"RTN","RORX018",87,0)
 S REPORT=$$ADDVAL^RORTSK11(RORTSK,"REPORT")
"RTN","RORX018",88,0)
 Q:REPORT<0 REPORT
"RTN","RORX018",89,0)
 ;
"RTN","RORX018",90,0)
 ;--- Get registry IEN
"RTN","RORX018",91,0)
 S RORREG=$$PARAM^RORTSK01("REGIEN")  ; Registry IEN
"RTN","RORX018",92,0)
 ;
"RTN","RORX018",93,0)
 ;--- Set standard report parameters data into output:
"RTN","RORX018",94,0)
 ;registry, comment, patients (before, during, after), options (summary vs.
"RTN","RORX018",95,0)
 ;complete), other registries, and other diagnoses
"RTN","RORX018",96,0)
 S PARAMS=$$PARAMS^RORXU002(.RORTSK,REPORT,.RORSDT,.ROREDT,.SFLAGS) Q:PARAMS<0 PARAMS
"RTN","RORX018",97,0)
 ;
"RTN","RORX018",98,0)
 ;--- Add range parameters to output
"RTN","RORX018",99,0)
 S RC=$$PARAMS^RORX018A(PARAMS,.RORDATA) Q:RC<0 RC
"RTN","RORX018",100,0)
 ;
"RTN","RORX018",101,0)
 ;--- Put report header data into output:
"RTN","RORX018",102,0)
 ;report creation date, task number, last registry update date, and
"RTN","RORX018",103,0)
 ;last data extraction date
"RTN","RORX018",104,0)
 S RC=$$HEADER(REPORT) Q:RC<0 RC
"RTN","RORX018",105,0)
 ;
"RTN","RORX018",106,0)
 ;--- Set the number of BMI ranges and initialize their values to 0
"RTN","RORX018",107,0)
 S RORDATA("RCNT")=6 D INIT(.RORDATA)
"RTN","RORX018",108,0)
 ;
"RTN","RORX018",109,0)
 ;--- Get GMRV VITAL TYPE pointer for HEIGHT and WEIGHT
"RTN","RORX018",110,0)
 S RORDATA("HGTP")=$$GETIEN^GMVGETVT("HEIGHT",1)
"RTN","RORX018",111,0)
 S RORDATA("WGTP")=$$GETIEN^GMVGETVT("WEIGHT",1)
"RTN","RORX018",112,0)
 I '$G(RORDATA("HGTP")) Q -1
"RTN","RORX018",113,0)
 I '$G(RORDATA("WGTP")) Q -1
"RTN","RORX018",114,0)
 ;
"RTN","RORX018",115,0)
 ;--- 'Most recent' vs. max date requested
"RTN","RORX018",116,0)
 S RORDATA("DATE")=0
"RTN","RORX018",117,0)
 I $$PARAM^RORTSK01("OPTIONS","MOST_RECENT") S RORDATA("DATE")=DT_.9
"RTN","RORX018",118,0)
 I '$G(RORDATA("DATE")) S RORDATA("DATE")=$$PARAM^RORTSK01("OPTIONS","MAX_DATE")_.9
"RTN","RORX018",119,0)
 ;
"RTN","RORX018",120,0)
 ;--- Summary vs. complete report requested
"RTN","RORX018",121,0)
 S RORDATA("SUMMARY")=0
"RTN","RORX018",122,0)
 I $$PARAM^RORTSK01("OPTIONS","SUMMARY") S RORDATA("SUMMARY")=1
"RTN","RORX018",123,0)
 ;
"RTN","RORX018",124,0)
 ;--- Get BMI range requested (there is currently only 1 BMI test)
"RTN","RORX018",125,0)
 S I=0 F  S I=$O(RORTSK("PARAMS","LRGRANGES","C",I)) Q:I=""  D
"RTN","RORX018",126,0)
 . S RORDATA("L",I)=$G(RORTSK("PARAMS","LRGRANGES","C",I,"L")) ;low BMI range
"RTN","RORX018",127,0)
 . S RORDATA("H",I)=$G(RORTSK("PARAMS","LRGRANGES","C",I,"H")) ;high BMI range
"RTN","RORX018",128,0)
 ;
"RTN","RORX018",129,0)
 ;--- Create 'patients' table
"RTN","RORX018",130,0)
 S RORBODY=$$ADDVAL^RORTSK11(RORTSK,"PATIENTS",,REPORT)
"RTN","RORX018",131,0)
 D ADDATTR^RORTSK11(RORTSK,RORBODY,"TABLE","PATIENTS")
"RTN","RORX018",132,0)
 ;
"RTN","RORX018",133,0)
 ;--- Get utilization date range (always sent in)
"RTN","RORX018",134,0)
 S (CNT,ECNT,RC)=0,SKIPEDT=ROREDT,SKIPSDT=RORSDT
"RTN","RORX018",135,0)
 S UTSDT=$$PARAM^RORTSK01("DATE_RANGE_3","START")\1
"RTN","RORX018",136,0)
 S UTEDT=$$PARAM^RORTSK01("DATE_RANGE_3","END")\1
"RTN","RORX018",137,0)
 ; Combined date range
"RTN","RORX018",138,0)
 S SKIPSDT=$$DTMIN^RORUTL18(SKIPSDT,$G(UTSDT))
"RTN","RORX018",139,0)
 S SKIPEDT=$$DTMAX^RORUTL18(SKIPEDT,$G(UTEDT))
"RTN","RORX018",140,0)
 ;
"RTN","RORX018",141,0)
 ;--- Number of patients in the registry - used for calculating the
"RTN","RORX018",142,0)
 ;task progress percentage - shown on the GUI screen
"RTN","RORX018",143,0)
 S RORPTN=$$REGSIZE^RORUTL02(+RORREG) S:RORPTN<0 RORPTN=0
"RTN","RORX018",144,0)
 ;
"RTN","RORX018",145,0)
 ;=== Set up Clinic/Division list parameters
"RTN","RORX018",146,0)
 S RORCDLIST=$$CDPARMS^RORXU001(.RORTSK,.RORCDSTDT,.RORCDENDT,1)
"RTN","RORX018",147,0)
 ;
"RTN","RORX018",148,0)
 ;--- Get registry records
"RTN","RORX018",149,0)
 S (CNT,RORPTIEN,RC)=0
"RTN","RORX018",150,0)
 S FLAG=$G(RORTSK("PARAMS","ICDFILT","A","FILTER"))
"RTN","RORX018",151,0)
 F  S RORPTIEN=$O(^RORDATA(798,"AC",RORREG,RORPTIEN))  Q:RORPTIEN'>0  D  Q:RC<0
"RTN","RORX018",152,0)
 . ;--- Calculate 'progress' for the GUI display
"RTN","RORX018",153,0)
 . S TMP=$S(RORPTN>0:CNT/RORPTN,1:"")
"RTN","RORX018",154,0)
 . S RC=$$LOOP^RORTSK01(TMP)  Q:RC<0
"RTN","RORX018",155,0)
 . S CNT=CNT+1
"RTN","RORX018",156,0)
 . ;--- Get patient DFN
"RTN","RORX018",157,0)
 . S DFN=$$PTIEN^RORUTL01(RORPTIEN) Q:DFN'>0
"RTN","RORX018",158,0)
 . ;check for patient list and quit if not on list
"RTN","RORX018",159,0)
 . I $D(RORTSK("PARAMS","PATIENTS","C")),'$D(RORTSK("PARAMS","PATIENTS","C",DFN)) Q
"RTN","RORX018",160,0)
 . ;--- Check if the patient should be skipped
"RTN","RORX018",161,0)
 . Q:$$SKIP^RORXU005(RORPTIEN,SFLAGS,SKIPSDT,SKIPEDT)
"RTN","RORX018",162,0)
 . ;--- Check if patient has passed the ICD filter
"RTN","RORX018",163,0)
 . S RCC=0
"RTN","RORX018",164,0)
 . I FLAG'="ALL" D
"RTN","RORX018",165,0)
 . . S RCC=$$ICD^RORXU010(DFN)
"RTN","RORX018",166,0)
 . I (FLAG="INCLUDE")&(RCC=0) Q
"RTN","RORX018",167,0)
 . I (FLAG="EXCLUDE")&(RCC=1) Q
"RTN","RORX018",168,0)
 . ;
"RTN","RORX018",169,0)
 . ;--- Check for Clinic or Division list and quit if not in list
"RTN","RORX018",170,0)
 . I RORCDLIST,'$$CDUTIL^RORXU001(.RORTSK,DFN,RORCDSTDT,RORCDENDT) Q
"RTN","RORX018",171,0)
 . ;
"RTN","RORX018",172,0)
 . ;--- Check for any utilization in the corresponding date range
"RTN","RORX018",173,0)
 . S SKIP=0 I $G(UTSDT)>0 D
"RTN","RORX018",174,0)
 .. N UTIL K TMP S TMP("ALL")=1
"RTN","RORX018",175,0)
 .. S UTIL=+$$UTIL^RORXU003(UTSDT,UTEDT,DFN,.TMP)
"RTN","RORX018",176,0)
 .. S:'UTIL SKIP=1
"RTN","RORX018",177,0)
 . ;--- Skip the patient if they have no utilization in the range
"RTN","RORX018",178,0)
 . Q:$G(SKIP)
"RTN","RORX018",179,0)
 . ;
"RTN","RORX018",180,0)
 . ;--- For each patient, process the registry record
"RTN","RORX018",181,0)
 . I $$PATIENT(DFN,RORBODY,.RORDATA)<0 S ECNT=ECNT+1 ;error count
"RTN","RORX018",182,0)
 ;
"RTN","RORX018",183,0)
 ;--- Always create BMI summary report
"RTN","RORX018",184,0)
 S RC=$$SUMMARY(RORTSK,REPORT,.RORDATA) Q:RC<0 RC
"RTN","RORX018",185,0)
 K ^TMP("RORX018",$J)
"RTN","RORX018",186,0)
 Q $S(RC<0:RC,ECNT>0:-43,1:0)
"RTN","RORX018",187,0)
 ;
"RTN","RORX018",188,0)
 ;*****************************************************************************
"RTN","RORX018",189,0)
 ;ADD THE PATIENT DATA TO THE REPORT
"RTN","RORX018",190,0)
 ;
"RTN","RORX018",191,0)
 ;INPUT
"RTN","RORX018",192,0)
 ;  DFN      Patient DFN in PATIENT file (#2)
"RTN","RORX018",193,0)
 ;  PTAG     Reference IEN to the 'body' parent XML tag
"RTN","RORX018",194,0)
 ;  RORDATA  Array with ROR data
"RTN","RORX018",195,0)
 ;
"RTN","RORX018",196,0)
 ;OUTPUT
"RTN","RORX018",197,0)
 ;  1        ok
"RTN","RORX018",198,0)
 ; <0        error
"RTN","RORX018",199,0)
 ;*****************************************************************************
"RTN","RORX018",200,0)
PATIENT(DFN,PTAG,RORDATA) ;
"RTN","RORX018",201,0)
 I $$CALCBMI(DFN,PTAG,.RORDATA)<0 Q 0  ;calculate the BMI
"RTN","RORX018",202,0)
 I '$$INRANGE(.RORDATA) Q 0 ;if range sent, BMI must be in the requested range
"RTN","RORX018",203,0)
 D BMICAT(.RORDATA) ;add 1 to appropriate category count
"RTN","RORX018",204,0)
 Q:RORDATA("SUMMARY") 1  ;stop if only the 'summary' report was requested
"RTN","RORX018",205,0)
 ;
"RTN","RORX018",206,0)
 ;--- Get patient data and put into the report
"RTN","RORX018",207,0)
 N VADM,VA,RORDOD,BTAG,HTAG,WTAG,AGE,AGETYPE
"RTN","RORX018",208,0)
 D VADEM^RORUTL05(DFN,1)
"RTN","RORX018",209,0)
 ;--- The <PATIENT> tag
"RTN","RORX018",210,0)
 S PTAG=$$ADDVAL^RORTSK11(RORTSK,"PATIENT",,PTAG,,DFN)
"RTN","RORX018",211,0)
 I PTAG<0 Q PTAG
"RTN","RORX018",212,0)
 ;--- Patient Name
"RTN","RORX018",213,0)
 D ADDVAL^RORTSK11(RORTSK,"NAME",VADM(1),PTAG,1)
"RTN","RORX018",214,0)
 ;
"RTN","RORX018",215,0)
 ;--- Last 4 digits of the SSN
"RTN","RORX018",216,0)
 D ADDVAL^RORTSK11(RORTSK,"LAST4",VA("BID"),PTAG,2)
"RTN","RORX018",217,0)
 ;
"RTN","RORX018",218,0)
 ;--- Patient age/DOB
"RTN","RORX018",219,0)
 S AGETYPE=$$PARAM^RORTSK01("AGE_RANGE","TYPE") I AGETYPE'="ALL" D
"RTN","RORX018",220,0)
 . S AGE=$S(AGETYPE="AGE":$P(VADM(4),U),AGETYPE="DOB":$$DATE^RORXU002($P(VADM(3),U)\1),1:"")
"RTN","RORX018",221,0)
 . D ADDVAL^RORTSK11(RORTSK,AGETYPE,AGE,PTAG,1)
"RTN","RORX018",222,0)
 ;
"RTN","RORX018",223,0)
 ;--- Date of death
"RTN","RORX018",224,0)
 S RORDOD=$$DATE^RORXU002($P(VADM(6),U)\1)
"RTN","RORX018",225,0)
 D ADDVAL^RORTSK11(RORTSK,"DOD",$G(RORDOD),PTAG,1)
"RTN","RORX018",226,0)
 ;--- 'BMIDATA' tag
"RTN","RORX018",227,0)
 S BTAG=$$ADDVAL^RORTSK11(RORTSK,"BMIDATA",,PTAG)
"RTN","RORX018",228,0)
 Q:BTAG<0 BTAG
"RTN","RORX018",229,0)
 ;--- Height tag
"RTN","RORX018",230,0)
 S HTAG=$$ADDVAL^RORTSK11(RORTSK,"HEIGHT",,BTAG)
"RTN","RORX018",231,0)
 Q:HTAG<0 HTAG
"RTN","RORX018",232,0)
 ;---  Date Height Taken
"RTN","RORX018",233,0)
 D ADDVAL^RORTSK11(RORTSK,"DATE",$G(RORDATA("HDATE")),HTAG)
"RTN","RORX018",234,0)
 ;---  Height value
"RTN","RORX018",235,0)
 D ADDVAL^RORTSK11(RORTSK,"RESULT",$G(RORDATA("HGT")),HTAG)
"RTN","RORX018",236,0)
 ;---  Weight tag
"RTN","RORX018",237,0)
 S WTAG=$$ADDVAL^RORTSK11(RORTSK,"WEIGHT",,BTAG)
"RTN","RORX018",238,0)
 Q:WTAG<0 WTAG
"RTN","RORX018",239,0)
 ;---  Date Weight Taken
"RTN","RORX018",240,0)
 D ADDVAL^RORTSK11(RORTSK,"DATE",$G(RORDATA("WDATE")),WTAG)
"RTN","RORX018",241,0)
 ;---  Weight value
"RTN","RORX018",242,0)
 D ADDVAL^RORTSK11(RORTSK,"RESULT",$G(RORDATA("WGT")),WTAG)
"RTN","RORX018",243,0)
 ;---  Calculated BMI value goes on PATIENT tag
"RTN","RORX018",244,0)
 D ADDVAL^RORTSK11(RORTSK,"BMI",$G(RORDATA("SCORE",1)),PTAG,3)
"RTN","RORX018",245,0)
 ; --- ICN if selected must be last column on report
"RTN","RORX018",246,0)
 I $$PARAM^RORTSK01("PATIENTS","ICN") D ICNDATA^RORXU006(.RORTSK,DFN,PTAG)
"RTN","RORX018",247,0)
 ;
"RTN","RORX018",248,0)
 ; --- PACT if selected may be one of the last columns on report
"RTN","RORX018",249,0)
 I $$PARAM^RORTSK01("PATIENTS","PACT") D PACTDATA^RORXU006(.RORTSK,DFN,PTAG)
"RTN","RORX018",250,0)
 ;
"RTN","RORX018",251,0)
 ; --- PCP if selected may be one of the last columns on report
"RTN","RORX018",252,0)
 I $$PARAM^RORTSK01("PATIENTS","PCP") D PCPDATA^RORXU006(.RORTSK,DFN,PTAG)
"RTN","RORX018",253,0)
 ;
"RTN","RORX018",254,0)
 Q 1
"RTN","RORX018",255,0)
 ;
"RTN","RORX018",256,0)
 ;*****************************************************************************
"RTN","RORX018",257,0)
 ;CALCULATE THE BMI FOR CURRENT PATIENT
"RTN","RORX018",258,0)
 ;
"RTN","RORX018",259,0)
 ;INPUT
"RTN","RORX018",260,0)
 ;  DFN      Patient DFN in PATIENT file (#2)
"RTN","RORX018",261,0)
 ;  PTAG     Reference IEN to the 'body' parent XML tag
"RTN","RORX018",262,0)
 ;  RORDATA  Array with ROR data
"RTN","RORX018",263,0)
 ;  
"RTN","RORX018",264,0)
 ;OUTPUT
"RTN","RORX018",265,0)
 ;  1        BMI calculated successfully
"RTN","RORX018",266,0)
 ; -1        Patient does not have vital measurements or BMI is out of range
"RTN","RORX018",267,0)
 ;  RORDATA  Array with ROR data:
"RTN","RORX018",268,0)
 ;           RORDATA("WGT")   - weight measurement
"RTN","RORX018",269,0)
 ;           RORDATA("WDATE") - date of weight measurement
"RTN","RORX018",270,0)
 ;           RORDATA("HGT")   - height measurement
"RTN","RORX018",271,0)
 ;           RORDATA("HDATE") - date of height measurement
"RTN","RORX018",272,0)
 ;           RORDATA("SCORE",N) - calculated BMI value for test N
"RTN","RORX018",273,0)
 ;*****************************************************************************
"RTN","RORX018",274,0)
CALCBMI(DFN,PTAG,RORDATA) ;
"RTN","RORX018",275,0)
 ;-- get vital measurements for BMI calculation
"RTN","RORX018",276,0)
 S RORDATA("CALC")=1 ;default - the score for this patient should be calculated
"RTN","RORX018",277,0)
 N RORDATE,I,RORVMDT,RORVMIEN,RORARY,TMP1,TMP2,TMP3
"RTN","RORX018",278,0)
 K RORDATA("HGT"),RORDATA("WGT"),RORDATA("SCORE",1)
"RTN","RORX018",279,0)
 S RORDATE=RORDATA("DATE")
"RTN","RORX018",280,0)
 F I="HGTP","WGTP" D  ;height and weight pointers
"RTN","RORX018",281,0)
 . ;get vital measurement date and IEN
"RTN","RORX018",282,0)
 . S RORVMDT=$O(^PXRMINDX(120.5,"PI",DFN,RORDATA(I),RORDATE),-1) ;vm date
"RTN","RORX018",283,0)
 . Q:$G(RORVMDT)=""
"RTN","RORX018",284,0)
 . S RORVMIEN=$O(^PXRMINDX(120.5,"PI",DFN,RORDATA(I),RORVMDT,0)) ;vm IEN
"RTN","RORX018",285,0)
 . Q:$G(RORVMIEN)=""
"RTN","RORX018",286,0)
 . ;call API to get patient's vital measurement value
"RTN","RORX018",287,0)
 . K RORARY D EN^GMVPXRM(.RORARY,RORVMIEN,"I")
"RTN","RORX018",288,0)
 . ; set values into RORDATA("WGT"), ("HGT"), ("WDATE"), & ("HDATE")
"RTN","RORX018",289,0)
 . S RORDATA($E(I,1,3))=$G(RORARY(7)),RORDATA($E(I,1)_"DATE")=$P(RORVMDT,".",1)
"RTN","RORX018",290,0)
 ;quit if height or weight is not > 0
"RTN","RORX018",291,0)
 I (($G(RORDATA("HGT"))'>0)!($G(RORDATA("WGT"))'>0)) Q -1
"RTN","RORX018",292,0)
 ;strip out characters "IN", ",E"
"RTN","RORX018",293,0)
 I ((RORDATA("HGT")["IN")!(RORDATA("HGT")[",E")) S RORDATA("HGT")=+RORDATA("HGT")
"RTN","RORX018",294,0)
 ;mark as 'invalid' if height not between 36 and 96 inches
"RTN","RORX018",295,0)
 I ((RORDATA("HGT")<36)!(RORDATA("HGT")>96)) D  Q 1
"RTN","RORX018",296,0)
 . S RORDATA("CALC")=0 ;no score calculations can be done on 'invalid' data
"RTN","RORX018",297,0)
 . S RORDATA("HGT")=RORDATA("HGT")_"*"
"RTN","RORX018",298,0)
 ;mark as 'invalid' if height contains "CM", or "'" or double quote
"RTN","RORX018",299,0)
 I ((RORDATA("HGT")["CM")!(RORDATA("HGT")["'")!(RORDATA("HGT")["""")) D  Q 1
"RTN","RORX018",300,0)
 . S RORDATA("CALC")=0 ;no score calculations can be done on 'invalid' data
"RTN","RORX018",301,0)
 . S RORDATA("HGT")=RORDATA("HGT")_"*"
"RTN","RORX018",302,0)
 ;
"RTN","RORX018",303,0)
 ;BMI calculation: (weight * 703) / (height*height)
"RTN","RORX018",304,0)
 S TMP1=703*($G(RORDATA("WGT")))
"RTN","RORX018",305,0)
 S TMP2=$G(RORDATA("HGT"))*($G(RORDATA("HGT")))
"RTN","RORX018",306,0)
 S TMP3=TMP1/TMP2
"RTN","RORX018",307,0)
 S RORDATA("SCORE",1)=$J(TMP3,0,1) ;round to 1 decimal point
"RTN","RORX018",308,0)
 Q 1
"RTN","RORX018",309,0)
 ;
"RTN","RORX018",310,0)
 ;************************************************************************
"RTN","RORX018",311,0)
 ;DETERMINE IF THE SCORE IS WITHIN THE REQUESTED RANGE
"RTN","RORX018",312,0)
 ;
"RTN","RORX018",313,0)
 ;INPUT:
"RTN","RORX018",314,0)
 ;  RORDATA  RORDATA("SCORE",I) contains computed test score for test ID 'I'
"RTN","RORX018",315,0)
 ;
"RTN","RORX018",316,0)
 ;OUTPUT:
"RTN","RORX018",317,0)
 ;  1  computed test score in range
"RTN","RORX018",318,0)
 ;  0  computed test score not in range
"RTN","RORX018",319,0)
 ;************************************************************************
"RTN","RORX018",320,0)
INRANGE(RORDATA) ;
"RTN","RORX018",321,0)
 ;if range exists for the test, and any result is considered 'invalid',
"RTN","RORX018",322,0)
 ;then skip the range check and exclude data from report
"RTN","RORX018",323,0)
 I $G(RORDATA("RANGE")),'$G(RORDATA("CALC")) Q 0
"RTN","RORX018",324,0)
 ;if range does not exist for test, and any result is considered 'invalid',
"RTN","RORX018",325,0)
 ;then skip the range check and include data in the report
"RTN","RORX018",326,0)
 I '$G(RORDATA("RANGE")),'$G(RORDATA("CALC")) Q 1
"RTN","RORX018",327,0)
 ;
"RTN","RORX018",328,0)
 N I,RETURN S RETURN=1 ;default is set to 'within range'
"RTN","RORX018",329,0)
 S I=0
"RTN","RORX018",330,0)
 F  S I=$O(RORDATA("SCORE",I)) Q:I=""  D
"RTN","RORX018",331,0)
 . I $G(RORDATA("L",I))'="" D
"RTN","RORX018",332,0)
 .. I $G(RORDATA("SCORE",I))<RORDATA("L",I) S RETURN=0
"RTN","RORX018",333,0)
 . I $G(RORDATA("H",I))'="" D
"RTN","RORX018",334,0)
 .. I $G(RORDATA("SCORE",I))>RORDATA("H",I) S RETURN=0
"RTN","RORX018",335,0)
 Q RETURN
"RTN","RORX018",336,0)
 ;
"RTN","RORX018",337,0)
 ;*****************************************************************************
"RTN","RORX018",338,0)
 ;ADD 1 TO APPROPRIATE BMI CATEGORY
"RTN","RORX018",339,0)
 ;
"RTN","RORX018",340,0)
 ;INPUT
"RTN","RORX018",341,0)
 ;  RORDATA  Array with ROR data
"RTN","RORX018",342,0)
 ;           RORDATA("SCORE",N) - calculated BMI value for test N
"RTN","RORX018",343,0)
 ;OUTPUT
"RTN","RORX018",344,0)
 ;  RORDATA("NP",N) - incremented by 1 if BMI in Nth range
"RTN","RORX018",345,0)
 ;           
"RTN","RORX018",346,0)
 ;*****************************************************************************
"RTN","RORX018",347,0)
BMICAT(RORDATA) ;
"RTN","RORX018",348,0)
 I '$G(RORDATA("SCORE",1)) Q
"RTN","RORX018",349,0)
 I $G(RORDATA("SCORE",1))<18.5 S RORDATA("NP",1)=$G(RORDATA("NP",1))+1 Q
"RTN","RORX018",350,0)
 I $G(RORDATA("SCORE",1))<25 S RORDATA("NP",2)=$G(RORDATA("NP",2))+1 Q
"RTN","RORX018",351,0)
 I $G(RORDATA("SCORE",1))<30 S RORDATA("NP",3)=$G(RORDATA("NP",3))+1 Q
"RTN","RORX018",352,0)
 I $G(RORDATA("SCORE",1))<35 S RORDATA("NP",4)=$G(RORDATA("NP",4))+1 Q
"RTN","RORX018",353,0)
 I $G(RORDATA("SCORE",1))<40 S RORDATA("NP",5)=$G(RORDATA("NP",5))+1 Q
"RTN","RORX018",354,0)
 I $G(RORDATA("SCORE",1))>39 S RORDATA("NP",6)=$G(RORDATA("NP",6))+1 Q
"RTN","RORX018",355,0)
 Q
"RTN","RORX018",356,0)
 ;
"RTN","RORX018",357,0)
 ;*****************************************************************************
"RTN","RORX018",358,0)
 ;ADD THE SUMMARY DATA TO THE REPORT
"RTN","RORX018",359,0)
 ;
"RTN","RORX018",360,0)
 ;INPUT
"RTN","RORX018",361,0)
 ;  RORTSK   Task number and task parameters
"RTN","RORX018",362,0)
 ;  REPORT   'Report' XML tag number
"RTN","RORX018",363,0)
 ;  RORDATA  Array with summary data:
"RTN","RORX018",364,0)
 ;           RORDATA("NP",N) - total count of patients in Nth range
"RTN","RORX018",365,0)
 ;
"RTN","RORX018",366,0)
 ;OUTPUT
"RTN","RORX018",367,0)
 ;  DATA     'Data' XML tag number or error code
"RTN","RORX018",368,0)
 ;*****************************************************************************
"RTN","RORX018",369,0)
SUMMARY(RORTSK,REPORT,RORDATA) ; Add the summary values to the report
"RTN","RORX018",370,0)
 N SUMMARY,I,STAG,RORCATNUM,RORNAME,RORRANGE
"RTN","RORX018",371,0)
 S SUMMARY=$$ADDVAL^RORTSK11(RORTSK,"SUMMARY",,REPORT)
"RTN","RORX018",372,0)
 Q:SUMMARY<0 SUMMARY
"RTN","RORX018",373,0)
 ;add data for the summary entries
"RTN","RORX018",374,0)
 F I=1:1:RORDATA("RCNT")  D  Q:STAG<0
"RTN","RORX018",375,0)
 . S STAG=$$ADDVAL^RORTSK11(RORTSK,"DATA",,SUMMARY)
"RTN","RORX018",376,0)
 . Q:STAG<0
"RTN","RORX018",377,0)
 . ;get each value
"RTN","RORX018",378,0)
 . S RORCATNUM="S"_I S RORNAME=$P($T(@RORCATNUM),";;",2)
"RTN","RORX018",379,0)
 . S RORRANGE=$P($T(@RORCATNUM),";;",3)
"RTN","RORX018",380,0)
 . D ADDVAL^RORTSK11(RORTSK,"DESC",$G(RORNAME),STAG) ;severity
"RTN","RORX018",381,0)
 . D ADDVAL^RORTSK11(RORTSK,"VALUES",$G(RORRANGE),STAG) ;range
"RTN","RORX018",382,0)
 . D ADDVAL^RORTSK11(RORTSK,"NP",$G(RORDATA("NP",I)),STAG) ;count
"RTN","RORX018",383,0)
 Q STAG
"RTN","RORX018",384,0)
 ;
"RTN","RORX018",385,0)
 ;*****************************************************************************
"RTN","RORX018",386,0)
 ;RETURN RANGE TEXT
"RTN","RORX018",387,0)
 ;
"RTN","RORX018",388,0)
 ; GRC   Test ID
"RTN","RORX018",389,0)
 ;
"RTN","RORX018",390,0)
 ; Return Values:
"RTN","RORX018",391,0)
 ;       Description - <range>
"RTN","RORX018",392,0)
 ;*****************************************************************************
"RTN","RORX018",393,0)
RTEXT(GRC) ;
"RTN","RORX018",394,0)
 N RANGE,TMP
"RTN","RORX018",395,0)
 S RANGE=""
"RTN","RORX018",396,0)
 ;--- Range
"RTN","RORX018",397,0)
 I $D(RORTSK("PARAMS","LRGRANGES","C",GRC))>1 D
"RTN","RORX018",398,0)
 . ;--- Low
"RTN","RORX018",399,0)
 . S TMP=$G(RORTSK("PARAMS","LRGRANGES","C",GRC,"L"))
"RTN","RORX018",400,0)
 . S:TMP'="" RANGE=RANGE_" not less than "_TMP
"RTN","RORX018",401,0)
 . ;--- High
"RTN","RORX018",402,0)
 . S TMP=$G(RORTSK("PARAMS","LRGRANGES","C",GRC,"H"))
"RTN","RORX018",403,0)
 . I TMP'=""  D:RANGE'=""  S RANGE=RANGE_" not greater than "_TMP
"RTN","RORX018",404,0)
 . . S RANGE=RANGE_" and"
"RTN","RORX018",405,0)
 ;--- Description
"RTN","RORX018",406,0)
 S TMP=$G(RORTSK("PARAMS","LRGRANGES","C",GRC))
"RTN","RORX018",407,0)
 S:TMP="" TMP="Unknown ("_GRC_")"
"RTN","RORX018",408,0)
 Q TMP_" - "_$S(RANGE'="":"numeric results"_RANGE,1:"all results")
"RTN","RORX018",409,0)
 ;
"RTN","RORX018",410,0)
 ;*****************************************************************************
"RTN","RORX018",411,0)
 ;ADD THE HEADERS TO THE REPORT
"RTN","RORX018",412,0)
 ;
"RTN","RORX018",413,0)
 ;INPUT
"RTN","RORX018",414,0)
 ;  PARTAG  Reference IEN to the 'report' parent XML tag
"RTN","RORX018",415,0)
 ;
"RTN","RORX018",416,0)
 ;OUTPUT
"RTN","RORX018",417,0)
 ;  <0      error
"RTN","RORX018",418,0)
 ;  >0      'Header' XML tag number or error code
"RTN","RORX018",419,0)
 ;*****************************************************************************
"RTN","RORX018",420,0)
HEADER(PARTAG) ;
"RTN","RORX018",421,0)
 ;;PATIENTS(#,NAME,LAST4,AGE,DOD,VITAL,DATE,RESULT,BMI,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="AGE"
"RTN","RORX018",422,0)
 ;;PATIENTS(#,NAME,LAST4,DOB,DOD,VITAL,DATE,RESULT,BMI,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="DOB"
"RTN","RORX018",423,0)
 ;;PATIENTS(#,NAME,LAST4,DOD,VITAL,DATE,RESULT,BMI,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="ALL"
"RTN","RORX018",424,0)
 ;
"RTN","RORX018",425,0)
 N HEADER,RC
"RTN","RORX018",426,0)
 ;call to $$HEADER^RORXU002 will populate the report created date, task number,
"RTN","RORX018",427,0)
 ;last registry update, and last data extraction.
"RTN","RORX018",428,0)
 S HEADER=$$HEADER^RORXU002(.RORTSK,PARTAG)
"RTN","RORX018",429,0)
 Q:HEADER<0 HEADER
"RTN","RORX018",430,0)
 ;automatically build the table defintion(s) listed under the header tag above
"RTN","RORX018",431,0)
 S RC=$$TBLDEF^RORXU002("HEADER^RORX018",HEADER)
"RTN","RORX018",432,0)
 Q $S(RC<0:RC,1:HEADER)
"RTN","RORX018",433,0)
 ;
"RTN","RORX018",434,0)
 ;*****************************************************************************
"RTN","RORX018",435,0)
 ;INITIALIZE THE NUMBER OF PATIENTS IN EACH CATEGORY TO 0
"RTN","RORX018",436,0)
 ;
"RTN","RORX018",437,0)
 ;INPUT
"RTN","RORX018",438,0)
 ;  RORDATA  Array with ROR data
"RTN","RORX018",439,0)
 ;           RORDATA("RCNT") Number of categories to initialize
"RTN","RORX018",440,0)
 ;*****************************************************************************
"RTN","RORX018",441,0)
INIT(RORDATA) ;
"RTN","RORX018",442,0)
 I $G(RORDATA("RCNT"))="" Q
"RTN","RORX018",443,0)
 F I=1:1:RORDATA("RCNT") D
"RTN","RORX018",444,0)
 . S RORDATA("NP",I)=0
"RTN","RORX018",445,0)
 Q
"RTN","RORX018",446,0)
 ;
"RTN","RORX018",447,0)
 ;*****************************************************************************
"RTN","RORX018",448,0)
 ;BMI Categories and Values for the summary table.
"RTN","RORX018",449,0)
 ;NOTE: the number of entries below must match the value of RORDATA("RCNT")
"RTN","RORX018",450,0)
 ;*****************************************************************************
"RTN","RORX018",451,0)
S1 ;;Underweight;;<18.5
"RTN","RORX018",452,0)
S2 ;;Normal weight;;18.5-24.9
"RTN","RORX018",453,0)
S3 ;;Overweight;;25.0-29.99
"RTN","RORX018",454,0)
S4 ;;Class I Obesity;;30.0-34.9
"RTN","RORX018",455,0)
S5 ;;Class II Obesity;;35-39.9
"RTN","RORX018",456,0)
S6 ;;Class III Obesity;;>=40
"RTN","RORX018A")
0^56^B2762309^n/a
"RTN","RORX018A",1,0)
RORX018A ;BPOIFO/SJA - BMI BY RANGE REPORT (CONT.) ;07/26/17
"RTN","RORX018A",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**31**;Feb 17, 2006;Build 62
"RTN","RORX018A",3,0)
 ;
"RTN","RORX018A",4,0)
 ;
"RTN","RORX018A",5,0)
 ;OUTPUT THE REPORT 'RANGE' PARAMETERS
"RTN","RORX018A",6,0)
 ;
"RTN","RORX018A",7,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX018A",8,0)
 ;
"RTN","RORX018A",9,0)
 ; Return Values:
"RTN","RORX018A",10,0)
 ;       <0  Error code
"RTN","RORX018A",11,0)
 ;        0  Ok
"RTN","RORX018A",12,0)
 ;*****************************************************************************
"RTN","RORX018A",13,0)
PARAMS(PARTAG,RORDATA) ;
"RTN","RORX018A",14,0)
 N PARAMS,TMP,RC S RC=0
"RTN","RORX018A",15,0)
 S RORDATA("RANGE")=0 ;initialize to 'no range passed in'
"RTN","RORX018A",16,0)
 ;--- Lab test ranges
"RTN","RORX018A",17,0)
 I $D(RORTSK("PARAMS","LRGRANGES","C"))>1  D  Q:RC<0 RC
"RTN","RORX018A",18,0)
 . N GRC,ELEMENT,NODE,RTAG,RANGE
"RTN","RORX018A",19,0)
 . S NODE=$NA(RORTSK("PARAMS","LRGRANGES","C"))
"RTN","RORX018A",20,0)
 . S RTAG=$$ADDVAL^RORTSK11(RORTSK,"LRGRANGES",,PARTAG)
"RTN","RORX018A",21,0)
 . S (GRC,RC)=0
"RTN","RORX018A",22,0)
 . F  S GRC=$O(@NODE@(GRC))  Q:GRC'>0  D  Q:RC<0
"RTN","RORX018A",23,0)
 . . S RANGE=0,TMP=$$RTEXT^RORX018(GRC)
"RTN","RORX018A",24,0)
 . . S ELEMENT=$$ADDVAL^RORTSK11(RORTSK,"LRGRANGE",TMP,RTAG)
"RTN","RORX018A",25,0)
 . . I ELEMENT<0  S RC=ELEMENT  Q
"RTN","RORX018A",26,0)
 . . D ADDATTR^RORTSK11(RORTSK,ELEMENT,"ID",GRC)
"RTN","RORX018A",27,0)
 . . ;--- Process the range values
"RTN","RORX018A",28,0)
 . . S TMP=$G(@NODE@(GRC,"L"))
"RTN","RORX018A",29,0)
 . . I TMP'=""  D  S RANGE=1
"RTN","RORX018A",30,0)
 . . . D ADDATTR^RORTSK11(RORTSK,ELEMENT,"LOW",TMP)
"RTN","RORX018A",31,0)
 . . S TMP=$G(@NODE@(GRC,"H"))
"RTN","RORX018A",32,0)
 . . I TMP'=""  D  S RANGE=1
"RTN","RORX018A",33,0)
 . . . D ADDATTR^RORTSK11(RORTSK,ELEMENT,"HIGH",TMP)
"RTN","RORX018A",34,0)
 . . I RANGE D
"RTN","RORX018A",35,0)
 . . . D ADDATTR^RORTSK11(RORTSK,ELEMENT,"RANGE",1)
"RTN","RORX018A",36,0)
 . . . S RORDATA("RANGE")=1 ;range exists
"RTN","RORX018A",37,0)
 ;--- Success
"RTN","RORX018A",38,0)
 Q RC
"RTN","RORX018A",39,0)
 ;
"RTN","RORX019")
0^38^B212873345^B188558484
"RTN","RORX019",1,0)
RORX019 ;BPOIFO/ACS - LIVER SCORE BY RANGE ;5/18/11 12:39pm
"RTN","RORX019",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**10,13,14,15,19,21,26,31**;Feb 17, 2006;Build 62
"RTN","RORX019",3,0)
 ;
"RTN","RORX019",4,0)
 ;******************************************************************************
"RTN","RORX019",5,0)
 ;******************************************************************************
"RTN","RORX019",6,0)
 ;                 --- ROUTINE MODIFICATION LOG ---
"RTN","RORX019",7,0)
 ;        
"RTN","RORX019",8,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORX019",9,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","RORX019",10,0)
 ;ROR*1.5*10   MAR 2010    A SAUNDERS   Routine created
"RTN","RORX019",11,0)
 ;ROR*1.5*13   DEC 2010    A SAUNDERS   User can select specific patients,
"RTN","RORX019",12,0)
 ;                                      clinics, or divisions for the report.
"RTN","RORX019",13,0)
 ;                                      Modified XML tags for sort.
"RTN","RORX019",14,0)
 ;ROR*1.5*14   APR 2011    A SAUNDERS   Added APRI and FIB4 scores.
"RTN","RORX019",15,0)
 ;ROR*1.5*15   MAY 2011    C RAY        Modified to exclude null tests
"RTN","RORX019",16,0)
 ;ROR*1.5*19   FEB 2012    J SCOTT      Support for ICD-10 Coding System
"RTN","RORX019",17,0)
 ;ROR*1.5*21   SEP 2013    T KOPP       Added ICN as last report column if
"RTN","RORX019",18,0)
 ;                                      additional identifier option selected
"RTN","RORX019",19,0)
 ;ROR*1.5*26   MAY 2015    T KOPP       Set up LIVPARAM so it can be called
"RTN","RORX019",20,0)
 ;                                      from other entry points/reports
"RTN","RORX019",21,0)
 ;ROR*1.5*31   MAY 2017    M FERRARESE  Adding PACT ,PCP,and AGE/DOB as additional
"RTN","RORX019",22,0)
 ;                                      identifiers.
"RTN","RORX019",23,0)
 ;******************************************************************************
"RTN","RORX019",24,0)
 ;******************************************************************************
"RTN","RORX019",25,0)
 Q
"RTN","RORX019",26,0)
 ;************************************************************************
"RTN","RORX019",27,0)
 ;COMPILE THE "LIVER SCORE BY RANGE" REPORT (EXTRINISIC FUNCTION)
"RTN","RORX019",28,0)
 ;REPORT CODE: 019
"RTN","RORX019",29,0)
 ;
"RTN","RORX019",30,0)
 ;Called by entry "Liver Score by Range" in ROR REPORT PARAMETERS (#799.34)
"RTN","RORX019",31,0)
 ;
"RTN","RORX019",32,0)
 ;INPUT
"RTN","RORX019",33,0)
 ;  RORTSK     Task number and task parameters
"RTN","RORX019",34,0)
 ;
"RTN","RORX019",35,0)
 ;
"RTN","RORX019",36,0)
 ;  Below is a sample RORTSK input array for utilization in 2003, most recent
"RTN","RORX019",37,0)
 ;  scores, MELD range from 10 to 30, MELD Na range from 20 to 50:
"RTN","RORX019",38,0)
 ;  
"RTN","RORX019",39,0)
 ;  RORTSK=nnn   (the task number)
"RTN","RORX019",40,0)
 ;  RORTSK("EP")="$$MLDRANGE^RORX019"
"RTN","RORX019",41,0)
 ;  RORTSK("PARAMS","DATE_RANGE_3","A","END")=3031231
"RTN","RORX019",42,0)
 ;  RORTSK("PARAMS","DATE_RANGE_3","A","START")=3030101
"RTN","RORX019",43,0)
 ;  RORTSK("PARAMS","ICDFILT","A","FILTER")="ALL"
"RTN","RORX019",44,0)
 ;  RORTSK("PARAMS","LRGRANGES","C",1)=""
"RTN","RORX019",45,0)
 ;  RORTSK("PARAMS","LRGRANGES","C",1,"H")=30
"RTN","RORX019",46,0)
 ;  RORTSK("PARAMS","LRGRANGES","C",1,"L")=10
"RTN","RORX019",47,0)
 ;  RORTSK("PARAMS","LRGRANGES","C",2)=""
"RTN","RORX019",48,0)
 ;  RORTSK("PARAMS","LRGRANGES","C",2,"H")=50
"RTN","RORX019",49,0)
 ;  RORTSK("PARAMS","LRGRANGES","C",2,"L")=20
"RTN","RORX019",50,0)
 ;  RORTSK("PARAMS","OPTIONS","A","COMPLETE")=1
"RTN","RORX019",51,0)
 ;  RORTSK("PARAMS","OPTIONS","A","MOST_RECENT")=1
"RTN","RORX019",52,0)
 ;  RORTSK("PARAMS","PATIENTS","A","DE_AFTER")=1
"RTN","RORX019",53,0)
 ;  RORTSK("PARAMS","PATIENTS","A","DE_BEFORE")=1
"RTN","RORX019",54,0)
 ;  RORTSK("PARAMS","PATIENTS","A","DE_DURING")=1
"RTN","RORX019",55,0)
 ;  RORTSK("PARAMS","REGIEN")=1
"RTN","RORX019",56,0)
 ;  
"RTN","RORX019",57,0)
 ;  If the user selected an 'as of' date = 12/31/2005:
"RTN","RORX019",58,0)
 ;  RORTSK("PARAMS","OPTIONS","A","MOST_RECENT")=1
"RTN","RORX019",59,0)
 ;     is replaced with:  
"RTN","RORX019",60,0)
 ;  RORTSK("PARAMS","OPTIONS","A","MAX_DATE")=3051231
"RTN","RORX019",61,0)
 ;
"RTN","RORX019",62,0)
 ;
"RTN","RORX019",63,0)
 ;OUTPUT
"RTN","RORX019",64,0)
 ;  <0  Error code
"RTN","RORX019",65,0)
 ;   0  Ok
"RTN","RORX019",66,0)
 ;************************************************************************
"RTN","RORX019",67,0)
MLDRANGE(RORTSK) ;
"RTN","RORX019",68,0)
 N RORREG        ; Registry IEN
"RTN","RORX019",69,0)
 N RORSDT        ; report start date
"RTN","RORX019",70,0)
 N ROREDT        ; report end date
"RTN","RORX019",71,0)
 N RORDATA       ; array to hold ROR data and summary totals
"RTN","RORX019",72,0)
 N RORPTIEN      ; IEN of patient in the ROR registry
"RTN","RORX019",73,0)
 N DFN           ; DFN of patient in the PATIENT file (#2)
"RTN","RORX019",74,0)
 N RORLC         ; sub-file and array of LOINC codes to search Lab data
"RTN","RORX019",75,0)
 N RORCDLIST     ; Flag to indicate whether a clinic or division list exists
"RTN","RORX019",76,0)
 N RORCDSTDT     ; Start date for clinic/division utilization search
"RTN","RORX019",77,0)
 N RORCDENDT     ; End date for clinic/division utilization search
"RTN","RORX019",78,0)
 ;
"RTN","RORX019",79,0)
 N REPORT,RC,I,TMP,SFLAGS,PARAMS
"RTN","RORX019",80,0)
 ;--- Establish the root XML Node of the report and put into output
"RTN","RORX019",81,0)
 S REPORT=$$ADDVAL^RORTSK11(RORTSK,"REPORT")
"RTN","RORX019",82,0)
 Q:REPORT<0 REPORT
"RTN","RORX019",83,0)
 ;
"RTN","RORX019",84,0)
 ;--- Get registry IEN
"RTN","RORX019",85,0)
 S RORREG=$$PARAM^RORTSK01("REGIEN")  ; Registry IEN
"RTN","RORX019",86,0)
 ;
"RTN","RORX019",87,0)
 ;--- Set standard report parameters data into output:
"RTN","RORX019",88,0)
 ;registry, comment, patients (before, during, after), options (summary vs.
"RTN","RORX019",89,0)
 ;complete), other registries, and other diagnoses
"RTN","RORX019",90,0)
 S PARAMS=$$PARAMS^RORXU002(.RORTSK,REPORT,.RORSDT,.ROREDT,.SFLAGS) Q:PARAMS<0 PARAMS
"RTN","RORX019",91,0)
 ;
"RTN","RORX019",92,0)
 ;--- Add range parameters to output
"RTN","RORX019",93,0)
 S RC=$$PARAMS^RORX019A(PARAMS,.RORDATA,.RORTSK) Q:RC<0 RC
"RTN","RORX019",94,0)
 ;
"RTN","RORX019",95,0)
 ;--- Get ULNAST value for calculations
"RTN","RORX019",96,0)
 I $D(RORTSK("PARAMS","ULNAST")) S RORDATA("ULNAST")=$G(RORTSK("PARAMS","ULNAST"))
"RTN","RORX019",97,0)
 ;
"RTN","RORX019",98,0)
 ;--- Put report header data into output:
"RTN","RORX019",99,0)
 ;report creation date, task number, last registry update date, last
"RTN","RORX019",100,0)
 ;data extraction date, and ULNAST if present, liver score by range
"RTN","RORX019",101,0)
 S RC=$$HEADER(REPORT,PARAMS) Q:RC<0 RC
"RTN","RORX019",102,0)
 ;
"RTN","RORX019",103,0)
 D LIVPARAM(.RORDATA,.RORTSK,.RORLC)
"RTN","RORX019",104,0)
 ;
"RTN","RORX019",105,0)
 ;--- Create 'patients' table
"RTN","RORX019",106,0)
 N RORBODY S RORBODY=$$ADDVAL^RORTSK11(RORTSK,"PATIENTS",,REPORT)
"RTN","RORX019",107,0)
 D ADDATTR^RORTSK11(RORTSK,RORBODY,"TABLE","PATIENTS")
"RTN","RORX019",108,0)
 ;
"RTN","RORX019",109,0)
 ;--- Check utilization
"RTN","RORX019",110,0)
 N CNT,ECNT,UTSDT,UTEDT,SKIPSDT,SKIPEDT
"RTN","RORX019",111,0)
 S (CNT,ECNT,RC)=0,SKIPEDT=ROREDT,SKIPSDT=RORSDT
"RTN","RORX019",112,0)
 ; Utilization date range is always sent
"RTN","RORX019",113,0)
 S UTSDT=$$PARAM^RORTSK01("DATE_RANGE_3","START")\1
"RTN","RORX019",114,0)
 S UTEDT=$$PARAM^RORTSK01("DATE_RANGE_3","END")\1
"RTN","RORX019",115,0)
 ; Combined date range
"RTN","RORX019",116,0)
 S SKIPSDT=$$DTMIN^RORUTL18(SKIPSDT,$G(UTSDT))
"RTN","RORX019",117,0)
 S SKIPEDT=$$DTMAX^RORUTL18(SKIPEDT,$G(UTEDT))
"RTN","RORX019",118,0)
 ;
"RTN","RORX019",119,0)
 ;--- Number of patients in the registry - used for calculating the
"RTN","RORX019",120,0)
 ;task progress percentage (shown on the GUI screen)
"RTN","RORX019",121,0)
 N RORPTCNT S RORPTCNT=$$REGSIZE^RORUTL02(+RORREG) S:RORPTCNT<0 RORPTCNT=0
"RTN","RORX019",122,0)
 ;
"RTN","RORX019",123,0)
 ;
"RTN","RORX019",124,0)
 ;=== Set up Clinic/Division list parameters
"RTN","RORX019",125,0)
 S RORCDLIST=$$CDPARMS^RORXU001(.RORTSK,.RORCDSTDT,.RORCDENDT,1)
"RTN","RORX019",126,0)
 ;
"RTN","RORX019",127,0)
 ;--- Get registry records
"RTN","RORX019",128,0)
 N RCC,FLAG,TMP,DFN,SKIP
"RTN","RORX019",129,0)
 S (CNT,RORPTIEN,RC)=0
"RTN","RORX019",130,0)
 S FLAG=$G(RORTSK("PARAMS","ICDFILT","A","FILTER"))
"RTN","RORX019",131,0)
 F  S RORPTIEN=$O(^RORDATA(798,"AC",RORREG,RORPTIEN))  Q:RORPTIEN'>0  D  Q:RC<0
"RTN","RORX019",132,0)
 . ;--- Calculate 'progress' for the GUI display
"RTN","RORX019",133,0)
 . S TMP=$S(RORPTCNT>0:CNT/RORPTCNT,1:"")
"RTN","RORX019",134,0)
 . S RC=$$LOOP^RORTSK01(TMP)  Q:RC<0
"RTN","RORX019",135,0)
 . S CNT=CNT+1
"RTN","RORX019",136,0)
 . ;--- Get patient DFN
"RTN","RORX019",137,0)
 . S DFN=$$PTIEN^RORUTL01(RORPTIEN) Q:DFN'>0
"RTN","RORX019",138,0)
 . ;check for patient list and quit if not on list
"RTN","RORX019",139,0)
 . I $D(RORTSK("PARAMS","PATIENTS","C")),'$D(RORTSK("PARAMS","PATIENTS","C",DFN)) Q
"RTN","RORX019",140,0)
 . ;--- Check if the patient should be skipped
"RTN","RORX019",141,0)
 . Q:$$SKIP^RORXU005(RORPTIEN,SFLAGS,SKIPSDT,SKIPEDT)
"RTN","RORX019",142,0)
 . ;--- Check if patient has passed the ICD filter
"RTN","RORX019",143,0)
 . S RCC=0
"RTN","RORX019",144,0)
 . I FLAG'="ALL" D
"RTN","RORX019",145,0)
 . . S RCC=$$ICD^RORXU010(DFN)
"RTN","RORX019",146,0)
 . I (FLAG="INCLUDE")&(RCC=0) Q
"RTN","RORX019",147,0)
 . I (FLAG="EXCLUDE")&(RCC=1) Q
"RTN","RORX019",148,0)
 . ;
"RTN","RORX019",149,0)
 . ;--- Check for Clinic or Division list and quit if not in list
"RTN","RORX019",150,0)
 . I RORCDLIST,'$$CDUTIL^RORXU001(.RORTSK,DFN,RORCDSTDT,RORCDENDT) Q
"RTN","RORX019",151,0)
 . ;
"RTN","RORX019",152,0)
 . ;--- Check for any utilization in the corresponding date range
"RTN","RORX019",153,0)
 . S SKIP=0 I $G(UTSDT)>0 D
"RTN","RORX019",154,0)
 .. N UTIL K TMP S TMP("ALL")=1
"RTN","RORX019",155,0)
 .. S UTIL=+$$UTIL^RORXU003(UTSDT,UTEDT,DFN,.TMP)
"RTN","RORX019",156,0)
 .. S:'UTIL SKIP=1
"RTN","RORX019",157,0)
 . ;--- Skip the patient if they have no utilization in the range
"RTN","RORX019",158,0)
 . I $G(SKIP) Q
"RTN","RORX019",159,0)
 . ;
"RTN","RORX019",160,0)
 . ;--- For each patient, process the registry record and create report
"RTN","RORX019",161,0)
 . I $$PATIENT(DFN,RORBODY,.RORDATA,RORPTIEN,.RORLC)<0 S ECNT=ECNT+1 ;error count
"RTN","RORX019",162,0)
 ;
"RTN","RORX019",163,0)
 K ^TMP("RORX019",$J)
"RTN","RORX019",164,0)
 Q $S(RC<0:RC,ECNT>0:-43,1:0)
"RTN","RORX019",165,0)
 ;
"RTN","RORX019",166,0)
 ;************************************************************************
"RTN","RORX019",167,0)
 ;ADD PATIENT DATA TO THE REPORT (EXTRINISIC FUNCTION)
"RTN","RORX019",168,0)
 ;
"RTN","RORX019",169,0)
 ;INPUT
"RTN","RORX019",170,0)
 ;  DFN      Patient DFN in PATIENT file (#2)
"RTN","RORX019",171,0)
 ;  PTAG     Reference IEN to the 'body' parent XML tag
"RTN","RORX019",172,0)
 ;  RORDATA  Array with ROR data
"RTN","RORX019",173,0)
 ;  RORPTIEN Patient IEN in the ROR registry
"RTN","RORX019",174,0)
 ;  RORLC    sub-file and LOINC codes to search for
"RTN","RORX019",175,0)
 ;
"RTN","RORX019",176,0)
 ;OUTPUT
"RTN","RORX019",177,0)
 ;  1        ok
"RTN","RORX019",178,0)
 ; <0        error
"RTN","RORX019",179,0)
 ;************************************************************************
"RTN","RORX019",180,0)
PATIENT(DFN,PTAG,RORDATA,RORPTIEN,RORLC) ;
"RTN","RORX019",181,0)
 ;Calculate the scores requested by the user
"RTN","RORX019",182,0)
 I ((RORDATA("IDLST")[1)!(RORDATA("IDLST")[2)) I $$CALCMLD^RORX019A(DFN,PTAG,.RORDATA,RORPTIEN,.RORLC)<0 Q 1
"RTN","RORX019",183,0)
 I ((RORDATA("IDLST")[3)!(RORDATA("IDLST")[4)) I $$CALCFIB^RORX019A(DFN,PTAG,.RORDATA,RORPTIEN,.RORLC)<0 Q 1
"RTN","RORX019",184,0)
 I '$$INRANGE(.RORDATA) Q 1  ;exclude patient from report if ANY score is out of range
"RTN","RORX019",185,0)
 I '$$SKIP(.RORDATA) Q 1  ;exclude patient from report with null scores
"RTN","RORX019",186,0)
 ;--- Get patient data and put into the report
"RTN","RORX019",187,0)
 N VADM,VA,RORDOD,MTAG,TTAG,AGETYPE,AGE
"RTN","RORX019",188,0)
 D VADEM^RORUTL05(DFN,1)
"RTN","RORX019",189,0)
 ;--- The <PATIENT> tag
"RTN","RORX019",190,0)
 S PTAG=$$ADDVAL^RORTSK11(RORTSK,"PATIENT",,PTAG,,DFN)
"RTN","RORX019",191,0)
 I PTAG<0 Q PTAG
"RTN","RORX019",192,0)
 ;--- Patient Name
"RTN","RORX019",193,0)
 D ADDVAL^RORTSK11(RORTSK,"NAME",VADM(1),PTAG,1)
"RTN","RORX019",194,0)
 ;--- Last 4 digits of the SSN
"RTN","RORX019",195,0)
 D ADDVAL^RORTSK11(RORTSK,"LAST4",VA("BID"),PTAG,2)
"RTN","RORX019",196,0)
 ;--- Age/DOB
"RTN","RORX019",197,0)
 S AGETYPE=$$PARAM^RORTSK01("AGE_RANGE","TYPE") I AGETYPE'="ALL" D
"RTN","RORX019",198,0)
 . S AGE=$S(AGETYPE="AGE":$P(VADM(4),U),AGETYPE="DOB":$$DATE^RORXU002($P(VADM(3),U)\1),1:"")
"RTN","RORX019",199,0)
 . D ADDVAL^RORTSK11(RORTSK,AGETYPE,AGE,PTAG,1)
"RTN","RORX019",200,0)
 ;--- Date of death
"RTN","RORX019",201,0)
 S RORDOD=$$DATE^RORXU002($P(VADM(6),U)\1)
"RTN","RORX019",202,0)
 D ADDVAL^RORTSK11(RORTSK,"DOD",$G(RORDOD),PTAG,1)
"RTN","RORX019",203,0)
 ;--- MELDDATA tag
"RTN","RORX019",204,0)
 S MTAG=$$ADDVAL^RORTSK11(RORTSK,"MELDDATA",,PTAG)
"RTN","RORX019",205,0)
 I MTAG<0 Q MTAG
"RTN","RORX019",206,0)
 ;--- Test Result Values
"RTN","RORX019",207,0)
 N TNAME
"RTN","RORX019",208,0)
 I ((RORDATA("IDLST")[1)!(RORDATA("IDLST")[2)) D
"RTN","RORX019",209,0)
 .F TNAME="BILI","CR","INR" D TSTRSLT(TNAME,MTAG)
"RTN","RORX019",210,0)
 .I RORDATA("IDLST")[2 D TSTRSLT("NA",MTAG)
"RTN","RORX019",211,0)
 I ((RORDATA("IDLST")[3)!(RORDATA("IDLST")[4)) D
"RTN","RORX019",212,0)
 .F TNAME="AST","PLAT" D TSTRSLT(TNAME,MTAG)
"RTN","RORX019",213,0)
 .I RORDATA("IDLST")[4 D TSTRSLT("ALT",MTAG)
"RTN","RORX019",214,0)
 ;---  MELD score
"RTN","RORX019",215,0)
 I RORDATA("IDLST")[1 D ADDVAL^RORTSK11(RORTSK,"MELD",$G(RORDATA("SCORE",1)),PTAG,3)
"RTN","RORX019",216,0)
 ;---  MELD-Na Score
"RTN","RORX019",217,0)
 I RORDATA("IDLST")[2 D ADDVAL^RORTSK11(RORTSK,"MELDNA",$G(RORDATA("SCORE",2)),PTAG,3)
"RTN","RORX019",218,0)
 ;---  APRI Score
"RTN","RORX019",219,0)
 I RORDATA("IDLST")[3 D ADDVAL^RORTSK11(RORTSK,"APRI",$G(RORDATA("SCORE",3)),PTAG,3)
"RTN","RORX019",220,0)
 ;---  FIB-4 Score
"RTN","RORX019",221,0)
 I RORDATA("IDLST")[4 D ADDVAL^RORTSK11(RORTSK,"FIB4",$G(RORDATA("SCORE",4)),PTAG,3)
"RTN","RORX019",222,0)
 I $$PARAM^RORTSK01("PATIENTS","ICN") D
"RTN","RORX019",223,0)
 . S TMP=$$ICN^RORUTL02(DFN)
"RTN","RORX019",224,0)
 . D ADDVAL^RORTSK11(RORTSK,"ICN",TMP,PTAG,1)
"RTN","RORX019",225,0)
 I $$PARAM^RORTSK01("PATIENTS","PACT") D
"RTN","RORX019",226,0)
 . S TMP=$$PACT^RORUTL02(DFN)
"RTN","RORX019",227,0)
 . D ADDVAL^RORTSK11(RORTSK,"PACT",TMP,PTAG,1)
"RTN","RORX019",228,0)
 I $$PARAM^RORTSK01("PATIENTS","PCP") D
"RTN","RORX019",229,0)
 . S TMP=$$PCP^RORUTL02(DFN)
"RTN","RORX019",230,0)
 . D ADDVAL^RORTSK11(RORTSK,"PCP",TMP,PTAG,1)
"RTN","RORX019",231,0)
 Q ($S($G(TTAG)<0:TTAG,1:1))
"RTN","RORX019",232,0)
 ;
"RTN","RORX019",233,0)
 ;*****************************************************
"RTN","RORX019",234,0)
 ;Procedure to add test name, date and results to report
"RTN","RORX019",235,0)
 ;INPUT
"RTN","RORX019",236,0)
 ;   TNAME       Name of test 
"RTN","RORX019",237,0)
 ;   MTAG        IEN of parent record
"RTN","RORX019",238,0)
 ;OUTPUT         n/a
"RTN","RORX019",239,0)
 ;******************************************************
"RTN","RORX019",240,0)
TSTRSLT(TNAME,MTAG) ;
"RTN","RORX019",241,0)
 ;--- Test Result Values
"RTN","RORX019",242,0)
 ;--- TEST tag
"RTN","RORX019",243,0)
 N TNAMEMIX
"RTN","RORX019",244,0)
 S TTAG=$$ADDVAL^RORTSK11(RORTSK,"TEST",,MTAG)
"RTN","RORX019",245,0)
 I TTAG<0 Q
"RTN","RORX019",246,0)
 ;--- Mixed case test name for GUI application
"RTN","RORX019",247,0)
 I TNAME="BILI" S TNAMEMIX="Bili"
"RTN","RORX019",248,0)
 I TNAME="CR" S TNAMEMIX="Cr"
"RTN","RORX019",249,0)
 I TNAME="INR" S TNAMEMIX="INR"
"RTN","RORX019",250,0)
 I TNAME="NA" S TNAMEMIX="Na"
"RTN","RORX019",251,0)
 I TNAME="AST" S TNAMEMIX="AST"
"RTN","RORX019",252,0)
 I TNAME="PLAT" S TNAMEMIX="Platelet"
"RTN","RORX019",253,0)
 I TNAME="ALT" S TNAMEMIX="ALT"
"RTN","RORX019",254,0)
 ;---  Test Name
"RTN","RORX019",255,0)
 D ADDVAL^RORTSK11(RORTSK,"TNAME",TNAMEMIX,TTAG)
"RTN","RORX019",256,0)
 ;---  Test Date
"RTN","RORX019",257,0)
 D ADDVAL^RORTSK11(RORTSK,"DATE",$P($G(RORDATA(TNAME)),U,2),TTAG)
"RTN","RORX019",258,0)
 ;---  Test Result Value
"RTN","RORX019",259,0)
 D ADDVAL^RORTSK11(RORTSK,"RESULT",$P($G(RORDATA(TNAME)),U,1),TTAG)
"RTN","RORX019",260,0)
 Q
"RTN","RORX019",261,0)
 ;****************************************************************
"RTN","RORX019",262,0)
 ;Function to check whether patient should be included on report
"RTN","RORX019",263,0)
 ;To be included patient must have a score for at least one of
"RTN","RORX019",264,0)
 ;the scores requested by the user
"RTN","RORX019",265,0)
 ;
"RTN","RORX019",266,0)
 ;INPUT
"RTN","RORX019",267,0)
 ;   RORDATA   Array with ROR Data
"RTN","RORX019",268,0)
 ;OUTPUT
"RTN","RORX019",269,0)
 ;   1         Include
"RTN","RORX019",270,0)
 ;   0         Exclude
"RTN","RORX019",271,0)
 ;***************************************************************
"RTN","RORX019",272,0)
SKIP(RORDATA) ;
"RTN","RORX019",273,0)
 ;
"RTN","RORX019",274,0)
 N RETURN
"RTN","RORX019",275,0)
 S RETURN=0
"RTN","RORX019",276,0)
 I RORDATA("IDLST")[1,+$G(RORDATA("SCORE",1)) S RETURN=1
"RTN","RORX019",277,0)
 I RORDATA("IDLST")[2,+$G(RORDATA("SCORE",2)) S RETURN=1
"RTN","RORX019",278,0)
 I RORDATA("IDLST")[3,+$G(RORDATA("SCORE",3)) S RETURN=1
"RTN","RORX019",279,0)
 I RORDATA("IDLST")[4,+$G(RORDATA("SCORE",4)) S RETURN=1
"RTN","RORX019",280,0)
 Q RETURN
"RTN","RORX019",281,0)
 ;************************************************************************
"RTN","RORX019",282,0)
 ;DETERMINE IF THE SCORES ARE WITHIN THE REQUESTED RANGES
"RTN","RORX019",283,0)
 ;-- If both tests contain ranges: scores for BOTH tests must fall in the
"RTN","RORX019",284,0)
 ;ranges...treated like an 'AND'
"RTN","RORX019",285,0)
 ;-- If 1 test contains a range: only patients with scores in the requested range
"RTN","RORX019",286,0)
 ;will be displayed, and the test without the range will also be displayed
"RTN","RORX019",287,0)
 ;with the calculated score (if applicable)
"RTN","RORX019",288,0)
 ;-- If neither test contains a range: all patients and their test results
"RTN","RORX019",289,0)
 ;and scores (null if they can't be calculated) are returned
"RTN","RORX019",290,0)
 ;
"RTN","RORX019",291,0)
 ;INPUT
"RTN","RORX019",292,0)
 ;  RORDATA  Array with ROR data
"RTN","RORX019",293,0)
 ;OUTPUT
"RTN","RORX019",294,0)
 ;  1        include on report
"RTN","RORX019",295,0)
 ;  0        exclude from report
"RTN","RORX019",296,0)
 ;************************************************************************
"RTN","RORX019",297,0)
INRANGE(RORDATA) ;
"RTN","RORX019",298,0)
 ;include data and quit if no range was sent in
"RTN","RORX019",299,0)
 Q:($D(RORDATA("RANGE"))'>1) 1
"RTN","RORX019",300,0)
 ;check scores to see if they are within the user-selected range(s)
"RTN","RORX019",301,0)
 N I,RETURN,SCORE S RETURN=1 ;default is set to 'within range'
"RTN","RORX019",302,0)
 S I=0 F  S I=$O(RORDATA("RANGE",I)) Q:I=""  D
"RTN","RORX019",303,0)
 . I $G(RORDATA("L",I))'="" D
"RTN","RORX019",304,0)
 .. S SCORE=$G(RORDATA("SCORE",I))
"RTN","RORX019",305,0)
 .. I $G(SCORE)="" S RETURN=0 Q
"RTN","RORX019",306,0)
 .. I SCORE<RORDATA("L",I) S RETURN=0
"RTN","RORX019",307,0)
 . I $G(RORDATA("H",I))'="" D
"RTN","RORX019",308,0)
 .. S SCORE=$G(RORDATA("SCORE",I))
"RTN","RORX019",309,0)
 .. I $G(SCORE)="" S RETURN=0 Q
"RTN","RORX019",310,0)
 .. I SCORE>$G(RORDATA("H",I)) S RETURN=0
"RTN","RORX019",311,0)
 ;
"RTN","RORX019",312,0)
 Q RETURN
"RTN","RORX019",313,0)
 ;
"RTN","RORX019",314,0)
 ;************************************************************************
"RTN","RORX019",315,0)
 ;ADD THE HEADERS TO THE REPORT (EXTRINISIC FUNCTION)
"RTN","RORX019",316,0)
 ;
"RTN","RORX019",317,0)
 ;INPUT
"RTN","RORX019",318,0)
 ;  PARTAG  Reference IEN to the 'report' parent XML tag
"RTN","RORX019",319,0)
 ;  PARAMS  Reference IEN to the 'params' parent XML tag
"RTN","RORX019",320,0)
 ;
"RTN","RORX019",321,0)
 ;OUTPUT
"RTN","RORX019",322,0)
 ;  <0      error
"RTN","RORX019",323,0)
 ;  >0      'Header' XML tag number or error code
"RTN","RORX019",324,0)
 ;************************************************************************
"RTN","RORX019",325,0)
HEADER(PARTAG,PARAMS) ;
"RTN","RORX019",326,0)
 N HEADER,RC,COL,COLUMNS,TMP S RC=0
"RTN","RORX019",327,0)
 ;call to $$HEADER^RORXU002 will populate the report created date, task number,
"RTN","RORX019",328,0)
 ;last registry update, and last data extraction.
"RTN","RORX019",329,0)
 S HEADER=$$HEADER^RORXU002(.RORTSK,PARTAG)
"RTN","RORX019",330,0)
 Q:HEADER<0 HEADER
"RTN","RORX019",331,0)
 ;manually build the table defintion(s) listed below
"RTN","RORX019",332,0)
 ;PATIENTS(#,NAME,LAST4,AGE,DOD,TEST,DATE,RESULT,MELD,MELDNA,APRI,FIB4,ICN,PACT,PCP)
"RTN","RORX019",333,0)
 S COLUMNS=$$ADDVAL^RORTSK11(RORTSK,"TBLDEF",,HEADER)
"RTN","RORX019",334,0)
 D ADDATTR^RORTSK11(RORTSK,COLUMNS,"NAME","PATIENTS")
"RTN","RORX019",335,0)
 D ADDATTR^RORTSK11(RORTSK,COLUMNS,"HEADER","1")
"RTN","RORX019",336,0)
 D ADDATTR^RORTSK11(RORTSK,COLUMNS,"FOOTER","1")
"RTN","RORX019",337,0)
 ;--- Required columns
"RTN","RORX019",338,0)
 S AGETYPE=$$PARAM^RORTSK01("AGE_RANGE","TYPE")
"RTN","RORX019",339,0)
 F COL="#","NAME","LAST4",AGETYPE,"DOD","TEST","DATE","RESULT" D
"RTN","RORX019",340,0)
 . Q:COL="ALL"  ;don't add AGE/DOB to the columns if AGETYPE is set to ALL ages
"RTN","RORX019",341,0)
 . S TMP=$$ADDVAL^RORTSK11(RORTSK,"COLUMN",,COLUMNS)
"RTN","RORX019",342,0)
 . D ADDATTR^RORTSK11(RORTSK,TMP,"NAME",COL)
"RTN","RORX019",343,0)
 ;--- Additional columns
"RTN","RORX019",344,0)
 I RORDATA("IDLST")[1 D
"RTN","RORX019",345,0)
 . S TMP=$$ADDVAL^RORTSK11(RORTSK,"COLUMN",,COLUMNS)
"RTN","RORX019",346,0)
 . D ADDATTR^RORTSK11(RORTSK,TMP,"NAME","MELD")
"RTN","RORX019",347,0)
 I RORDATA("IDLST")[2 D
"RTN","RORX019",348,0)
 . S TMP=$$ADDVAL^RORTSK11(RORTSK,"COLUMN",,COLUMNS)
"RTN","RORX019",349,0)
 . ;D ADDATTR^RORTSK11(RORTSK,TMP,"NAME","MELDNA")
"RTN","RORX019",350,0)
 . ;note: the column name length above was causing problems in the
"RTN","RORX019",351,0)
 . ;XSL diaglog file entry 7981019.001, so we shortened it to just "NA".
"RTN","RORX019",352,0)
 . D ADDATTR^RORTSK11(RORTSK,TMP,"NAME","NA")
"RTN","RORX019",353,0)
 I RORDATA("IDLST")[3 D
"RTN","RORX019",354,0)
 . S TMP=$$ADDVAL^RORTSK11(RORTSK,"COLUMN",,COLUMNS)
"RTN","RORX019",355,0)
 . D ADDATTR^RORTSK11(RORTSK,TMP,"NAME","APRI")
"RTN","RORX019",356,0)
 I RORDATA("IDLST")[4 D
"RTN","RORX019",357,0)
 . S TMP=$$ADDVAL^RORTSK11(RORTSK,"COLUMN",,COLUMNS)
"RTN","RORX019",358,0)
 . D ADDATTR^RORTSK11(RORTSK,TMP,"NAME","FIB4")
"RTN","RORX019",359,0)
 I $$PARAM^RORTSK01("PATIENTS","ICN") D
"RTN","RORX019",360,0)
 . S TMP=$$ADDVAL^RORTSK11(RORTSK,"COLUMN",,COLUMNS)
"RTN","RORX019",361,0)
 . D ADDATTR^RORTSK11(RORTSK,TMP,"NAME","ICN")
"RTN","RORX019",362,0)
 I $$PARAM^RORTSK01("PATIENTS","PACT") D
"RTN","RORX019",363,0)
 . S TMP=$$ADDVAL^RORTSK11(RORTSK,"COLUMN",,COLUMNS)
"RTN","RORX019",364,0)
 . D ADDATTR^RORTSK11(RORTSK,TMP,"NAME","PACT")
"RTN","RORX019",365,0)
 I $$PARAM^RORTSK01("PATIENTS","PCP") D
"RTN","RORX019",366,0)
 . S TMP=$$ADDVAL^RORTSK11(RORTSK,"COLUMN",,COLUMNS)
"RTN","RORX019",367,0)
 . D ADDATTR^RORTSK11(RORTSK,TMP,"NAME","PCP")
"RTN","RORX019",368,0)
 ;--- LOINC codes
"RTN","RORX019",369,0)
 N LTAG S LTAG=$$ADDVAL^RORTSK11(RORTSK,"LOINC_CODES",,PARTAG)
"RTN","RORX019",370,0)
 N CTAG S CTAG=$$ADDVAL^RORTSK11(RORTSK,"CODE",,LTAG)
"RTN","RORX019",371,0)
 D ADDATTR^RORTSK11(RORTSK,CTAG,"CODE","ALT: 1742-6, 16325-3")
"RTN","RORX019",372,0)
 N CTAG S CTAG=$$ADDVAL^RORTSK11(RORTSK,"CODE",,LTAG)
"RTN","RORX019",373,0)
 D ADDATTR^RORTSK11(RORTSK,CTAG,"CODE","AST: 1916-6, 1920-8, 127344-1")
"RTN","RORX019",374,0)
 N CTAG S CTAG=$$ADDVAL^RORTSK11(RORTSK,"CODE",,LTAG)
"RTN","RORX019",375,0)
 D ADDATTR^RORTSK11(RORTSK,CTAG,"CODE","Billirubin: 14631-6, 1975-2")
"RTN","RORX019",376,0)
 N CTAG S CTAG=$$ADDVAL^RORTSK11(RORTSK,"CODE",,LTAG)
"RTN","RORX019",377,0)
 D ADDATTR^RORTSK11(RORTSK,CTAG,"CODE","Creatinine: 15045-8, 21232-4, 2160-0")
"RTN","RORX019",378,0)
 N CTAG S CTAG=$$ADDVAL^RORTSK11(RORTSK,"CODE",,LTAG)
"RTN","RORX019",379,0)
 D ADDATTR^RORTSK11(RORTSK,CTAG,"CODE","INR: 34714-6, 6301-6")
"RTN","RORX019",380,0)
 N CTAG S CTAG=$$ADDVAL^RORTSK11(RORTSK,"CODE",,LTAG)
"RTN","RORX019",381,0)
 D ADDATTR^RORTSK11(RORTSK,CTAG,"CODE","Platelets: 777-3, 778-1, 26515-7")
"RTN","RORX019",382,0)
 N CTAG S CTAG=$$ADDVAL^RORTSK11(RORTSK,"CODE",,LTAG)
"RTN","RORX019",383,0)
 D ADDATTR^RORTSK11(RORTSK,CTAG,"CODE","Sodium: 2947-0, 2951-2, 32717-1")
"RTN","RORX019",384,0)
 ;
"RTN","RORX019",385,0)
 ;Add ULNAST value if passed in
"RTN","RORX019",386,0)
 I $G(RORTSK("PARAMS","ULNAST")) D
"RTN","RORX019",387,0)
 . N ULNAST S ULNAST=$$ADDVAL^RORTSK11(RORTSK,"ULNAST",,PARAMS)
"RTN","RORX019",388,0)
 . D ADDATTR^RORTSK11(RORTSK,ULNAST,"VALUES",$G(RORDATA("ULNAST")))
"RTN","RORX019",389,0)
 ;
"RTN","RORX019",390,0)
 Q $S(RC<0:RC,1:HEADER)
"RTN","RORX019",391,0)
 ;
"RTN","RORX019",392,0)
 ; Set up parameter values for liver scores
"RTN","RORX019",393,0)
 ;
"RTN","RORX019",394,0)
 ;  Input:
"RTN","RORX019",395,0)
 ;     RORDATA   Array with ROR data
"RTN","RORX019",396,0)
 ;     RORTSK    Task number and task parameters
"RTN","RORX019",397,0)
 ;
"RTN","RORX019",398,0)
 ;  Output:
"RTN","RORX019",399,0)
 ;     RORDATA
"RTN","RORX019",400,0)
 ;     RORTSK
"RTN","RORX019",401,0)
 ;     RORLC     sub-file and LOINC codes to search for    
"RTN","RORX019",402,0)
 ;
"RTN","RORX019",403,0)
LIVPARAM(RORDATA,RORTSK,RORLC) ;
"RTN","RORX019",404,0)
 ;--- Get test ranges requested
"RTN","RORX019",405,0)
 ;I=1 ==> report = MELD      I=2 ==> report = MELD Na
"RTN","RORX019",406,0)
 ;I=3 ==> report = APRI      I=4 ==> report = FIB-4
"RTN","RORX019",407,0)
 N I
"RTN","RORX019",408,0)
 S I=0 F  S I=$O(RORTSK("PARAMS","LRGRANGES","C",I)) Q:I=""  D
"RTN","RORX019",409,0)
 . S RORDATA("L",I)=$G(RORTSK("PARAMS","LRGRANGES","C",I,"L")) ;low range
"RTN","RORX019",410,0)
 . S RORDATA("H",I)=$G(RORTSK("PARAMS","LRGRANGES","C",I,"H")) ;high range
"RTN","RORX019",411,0)
 ;
"RTN","RORX019",412,0)
 ;--- Get Max Date for test results  OUTPUT: RORDATA("DATE")
"RTN","RORX019",413,0)
 ;In the GUI, the user selects either 'most recent' or 'as of' date
"RTN","RORX019",414,0)
 S RORDATA("DATE")=$$PARAM^RORTSK01("OPTIONS","MAX_DATE")
"RTN","RORX019",415,0)
 I $G(RORDATA("DATE"))="" S RORDATA("DATE")=DT
"RTN","RORX019",416,0)
 ;
"RTN","RORX019",417,0)
 ;--- LOINC codes
"RTN","RORX019",418,0)
 I "1,2"[RORDATA("IDLST") D  ;If MELD or MELD-NA scores requested
"RTN","RORX019",419,0)
 . ;create list for future comparison
"RTN","RORX019",420,0)
 . S RORDATA("CR_LOINC")=";15045-8;21232-4;2160-0;" ;Creatinine
"RTN","RORX019",421,0)
 . S RORDATA("BIL_LOINC")=";14631-6;1975-2;" ;Bilirubin
"RTN","RORX019",422,0)
 . S RORDATA("SOD_LOINC")=";2947-0;2951-2;32717-1;" ;Sodium
"RTN","RORX019",423,0)
 . S RORDATA("INR_LOINC")=";34714-6;6301-6;" ;INR 
"RTN","RORX019",424,0)
 . ;set up array for future call to Lab API
"RTN","RORX019",425,0)
 . S RORLC="CH" ;chemistry sub-file to search in #63
"RTN","RORX019",426,0)
 . S RORLC(1)="15045-8^LN" ;Creatinine LOINC
"RTN","RORX019",427,0)
 . S RORLC(2)="21232-4^LN" ;Creatinine LOINC
"RTN","RORX019",428,0)
 . S RORLC(3)="2160-0^LN"  ;Creatinine LOINC
"RTN","RORX019",429,0)
 . S RORLC(4)="14631-6^LN" ;Bilirubin LOINC
"RTN","RORX019",430,0)
 . S RORLC(5)="1975-2^LN"  ;Bilirubin LOINC
"RTN","RORX019",431,0)
 . S RORLC(6)="2947-0^LN"  ;Sodium LOINC
"RTN","RORX019",432,0)
 . S RORLC(7)="2951-2^LN"  ;Sodium LOINC
"RTN","RORX019",433,0)
 . S RORLC(8)="32717-1^LN" ;Sodium LOINC
"RTN","RORX019",434,0)
 . S RORLC(9)="34714-6^LN" ;INR LOINC
"RTN","RORX019",435,0)
 . S RORLC(10)="6301-6^LN" ;INR LOINC
"RTN","RORX019",436,0)
 ;
"RTN","RORX019",437,0)
 I "3,4"[RORDATA("IDLST") D  ;If APRI or FIB-4 scores requested
"RTN","RORX019",438,0)
 . ;create list for future comparison
"RTN","RORX019",439,0)
 . S RORDATA("AST_LOINC")=";1916-6;1920-8;127344-1;" ;AST 
"RTN","RORX019",440,0)
 . S RORDATA("PLAT_LOINC")=";777-3;778-1;26515-7;" ;Platelets 
"RTN","RORX019",441,0)
 . S RORDATA("ALT_LOINC")=";1742-6;16325-3;" ;ALT 
"RTN","RORX019",442,0)
 . ;set up array for future call to Lab API
"RTN","RORX019",443,0)
 . S RORLC="CH" ;chemistry sub-file to search in #63
"RTN","RORX019",444,0)
 . S RORLC(1)="1916-6^LN" ;AST LOINC
"RTN","RORX019",445,0)
 . S RORLC(2)="1920-8^LN" ;AST LOINC
"RTN","RORX019",446,0)
 . ;S RORLC(3)="127344-1^LN" ;AST LOINC
"RTN","RORX019",447,0)
 . S RORLC(4)="777-3^LN" ;Platelets LOINC
"RTN","RORX019",448,0)
 . S RORLC(5)="778-1^LN" ;Platelets LOINC
"RTN","RORX019",449,0)
 . S RORLC(6)="26515-7^LN" ;Platelets LOINC
"RTN","RORX019",450,0)
 . S RORLC(7)="1742-6^LN" ;ALT LOINC
"RTN","RORX019",451,0)
 . S RORLC(8)="16325-3^LN" ;ALT LOINC
"RTN","RORX019",452,0)
 Q
"RTN","RORX019",453,0)
 ;
"RTN","RORX020")
0^39^B78730803^B71011817
"RTN","RORX020",1,0)
RORX020 ;BPOIFO/ACS - RENAL FUNCTION BY RANGE ;6/2/11 4:19pm
"RTN","RORX020",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**10,13,14,15,19,21,31**;Feb 17, 2006;Build 62
"RTN","RORX020",3,0)
 ;
"RTN","RORX020",4,0)
 ; This routine uses the following IAs:
"RTN","RORX020",5,0)
 ;
"RTN","RORX020",6,0)
 ; #4290         ^PXRMINDX(120.5 (controlled)
"RTN","RORX020",7,0)
 ; #3647         $$EN^GMVPXRM (controlled)
"RTN","RORX020",8,0)
 ; #10061        DEM^VADPT (supported)
"RTN","RORX020",9,0)
 ; #10105        PWR^XLFMTH (supported)
"RTN","RORX020",10,0)
 ; #5047         $$GETIEN^GMVGETVT (supported)
"RTN","RORX020",11,0)
 ; #3556         GCPR^LA7QRY (supported)
"RTN","RORX020",12,0)
 ;
"RTN","RORX020",13,0)
 ;******************************************************************************
"RTN","RORX020",14,0)
 ;******************************************************************************
"RTN","RORX020",15,0)
 ;                 --- ROUTINE MODIFICATION LOG ---
"RTN","RORX020",16,0)
 ;        
"RTN","RORX020",17,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORX020",18,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","RORX020",19,0)
 ;ROR*1.5*10   MAR 2010   A SAUNDERS    Routine created.
"RTN","RORX020",20,0)
 ;ROR*1.5*13   DEC 2010   A SAUNDERS    User can select specific patients,
"RTN","RORX020",21,0)
 ;                                      clinics, or divisions for the report.
"RTN","RORX020",22,0)
 ;                                      Modified XML tags for sort.
"RTN","RORX020",23,0)
 ;ROR*1.5*14   APR 2011   A SAUNDERS    CALCRF: Age calculation now uses 
"RTN","RORX020",24,0)
 ;                                      $$AGE^RORX019A.
"RTN","RORX020",25,0)
 ;ROR*1.5*15   JUN 2011   C RAY         Added calculation for eGRF by CKD-EPI.
"RTN","RORX020",26,0)
 ;ROR*1.5*19   FEB 2012   J SCOTT       Support for ICD-10 Coding System.
"RTN","RORX020",27,0)
 ;ROR*1.5*21   SEP 2013   T KOPP        Add ICN column if Additional Identifier
"RTN","RORX020",28,0)
 ;                                       requested.
"RTN","RORX020",29,0)
 ;ROR*1.5*31   MAY 2017   M FERRARESE   Adding PACT ,PCP,and AGE/DOB as additional
"RTN","RORX020",30,0)
 ;                                      identifiers.
"RTN","RORX020",31,0)
 ;******************************************************************************
"RTN","RORX020",32,0)
 ;******************************************************************************
"RTN","RORX020",33,0)
 Q
"RTN","RORX020",34,0)
 ;
"RTN","RORX020",35,0)
 ;************************************************************************
"RTN","RORX020",36,0)
 ;COMPILE THE "RENAL FUNCTION BY RANGE" REPORT
"RTN","RORX020",37,0)
 ;REPORT CODE: 020
"RTN","RORX020",38,0)
 ;
"RTN","RORX020",39,0)
 ;Called by entry "Renal Function by Range" in ROR REPORT PARAMETERS (#799.34)
"RTN","RORX020",40,0)
 ;
"RTN","RORX020",41,0)
 ;INPUT
"RTN","RORX020",42,0)
 ;  RORTSK     Task number and task parameters
"RTN","RORX020",43,0)
 ;  
"RTN","RORX020",44,0)
 ;  Below is a sample RORTSK input array for utilization in 2003, most recent
"RTN","RORX020",45,0)
 ;  scores, CrCL range from 20 to 50, eGFR range from 30 to 60:
"RTN","RORX020",46,0)
 ;  
"RTN","RORX020",47,0)
 ;  RORTSK=nnn   (the task number)
"RTN","RORX020",48,0)
 ;  RORTSK("EP")="$$RFRANGE^RORX020"
"RTN","RORX020",49,0)
 ;  RORTSK("PARAMS","DATE_RANGE_3","A","END")=3031231
"RTN","RORX020",50,0)
 ;  RORTSK("PARAMS","DATE_RANGE_3","A","START")=3030101
"RTN","RORX020",51,0)
 ;  RORTSK("PARAMS","IC9FILT","A","FILTER")="ALL"
"RTN","RORX020",52,0)
 ;  RORTSK("PARAMS","LRGRANGES","C",1)=""
"RTN","RORX020",53,0)
 ;  RORTSK("PARAMS","LRGRANGES","C",1,"H")=50
"RTN","RORX020",54,0)
 ;  RORTSK("PARAMS","LRGRANGES","C",1,"L")=20
"RTN","RORX020",55,0)
 ;  RORTSK("PARAMS","LRGRANGES","C",2)=""
"RTN","RORX020",56,0)
 ;  RORTSK("PARAMS","LRGRANGES","C",2,"H")=60
"RTN","RORX020",57,0)
 ;  RORTSK("PARAMS","LRGRANGES","C",2,"L")=30
"RTN","RORX020",58,0)
 ;  RORTSK("PARAMS","OPTIONS","A","COMPLETE")=1
"RTN","RORX020",59,0)
 ;  RORTSK("PARAMS","OPTIONS","A","MOST_RECENT")=1
"RTN","RORX020",60,0)
 ;  RORTSK("PARAMS","PATIENTS","A","DE_AFTER")=1
"RTN","RORX020",61,0)
 ;  RORTSK("PARAMS","PATIENTS","A","DE_BEFORE")=1
"RTN","RORX020",62,0)
 ;  RORTSK("PARAMS","PATIENTS","A","DE_DURING")=1
"RTN","RORX020",63,0)
 ;  RORTSK("PARAMS","REGIEN")=1
"RTN","RORX020",64,0)
 ;  
"RTN","RORX020",65,0)
 ;  If the user selected an 'as of' date = 12/31/2005:
"RTN","RORX020",66,0)
 ;     RORTSK("PARAMS","OPTIONS","A","MOST_RECENT")=1
"RTN","RORX020",67,0)
 ;  is replaced with:  
"RTN","RORX020",68,0)
 ;     RORTSK("PARAMS","OPTIONS","A","MAX_DATE")=3051231
"RTN","RORX020",69,0)
 ;
"RTN","RORX020",70,0)
 ;OUTPUT
"RTN","RORX020",71,0)
 ;  <0  Error code
"RTN","RORX020",72,0)
 ;   0  Ok
"RTN","RORX020",73,0)
 ;************************************************************************
"RTN","RORX020",74,0)
RFRANGE(RORTSK) ;
"RTN","RORX020",75,0)
 N RORDATA       ; array to hold ROR data and summary totals
"RTN","RORX020",76,0)
 N RORREG        ; Registry IEN
"RTN","RORX020",77,0)
 N RORSDT        ; report start date
"RTN","RORX020",78,0)
 N ROREDT        ; report end date
"RTN","RORX020",79,0)
 N RORPTIEN      ; IEN of patient in the ROR registry
"RTN","RORX020",80,0)
 N DFN           ; DFN of patient in the PATIENT file (#2)
"RTN","RORX020",81,0)
 N RORLC         ; sub-file and array of LOINC codes to search Lab data
"RTN","RORX020",82,0)
 N RORCDLIST     ; Flag to indicate whether a clinic or division list exists
"RTN","RORX020",83,0)
 N RORCDSTDT     ; Start date for clinic/division utilization search
"RTN","RORX020",84,0)
 N RORCDENDT     ; End date for clinic/division utilization search
"RTN","RORX020",85,0)
 ;
"RTN","RORX020",86,0)
 N REPORT,RC,I,SFLAGS,PARAMS
"RTN","RORX020",87,0)
 ;--- Establish the root XML Node of the report and put into output
"RTN","RORX020",88,0)
 S REPORT=$$ADDVAL^RORTSK11(RORTSK,"REPORT")
"RTN","RORX020",89,0)
 Q:REPORT<0 REPORT
"RTN","RORX020",90,0)
 ;
"RTN","RORX020",91,0)
 ;--- Get registry IEN
"RTN","RORX020",92,0)
 S RORREG=$$PARAM^RORTSK01("REGIEN")  ; Registry IEN
"RTN","RORX020",93,0)
 ;
"RTN","RORX020",94,0)
 ;--- Set standard report parameters data into output:
"RTN","RORX020",95,0)
 ;registry, comment, patients (before, during, after), options (summary vs.
"RTN","RORX020",96,0)
 ;complete), other registries, and other diagnoses
"RTN","RORX020",97,0)
 S PARAMS=$$PARAMS^RORXU002(.RORTSK,REPORT,.RORSDT,.ROREDT,.SFLAGS) Q:PARAMS<0 PARAMS
"RTN","RORX020",98,0)
 ;
"RTN","RORX020",99,0)
 ;--- Add range parameters to output
"RTN","RORX020",100,0)
 S RC=$$PARAMS^RORX020A(PARAMS,.RORDATA) Q:RC<0 RC
"RTN","RORX020",101,0)
 ;
"RTN","RORX020",102,0)
 ;--- Put report header data into output:
"RTN","RORX020",103,0)
 ;report creation date, task number, last registry update date, and
"RTN","RORX020",104,0)
 ;last data extraction date
"RTN","RORX020",105,0)
 S RC=$$HEADER^RORX020A(REPORT,.RORTSK) Q:RC<0 RC
"RTN","RORX020",106,0)
 ;
"RTN","RORX020",107,0)
 ;--- Get Renal ranges requested
"RTN","RORX020",108,0)
 ;I=1 ==> report = CrCL      I=2 ==> report = eGFR by MDRD
"RTN","RORX020",109,0)
 S I=0 F  S I=$O(RORTSK("PARAMS","LRGRANGES","C",I)) Q:I=""  D
"RTN","RORX020",110,0)
 . S RORDATA("L",I)=$G(RORTSK("PARAMS","LRGRANGES","C",I,"L")) ;low range
"RTN","RORX020",111,0)
 . S RORDATA("H",I)=$G(RORTSK("PARAMS","LRGRANGES","C",I,"H")) ;high range
"RTN","RORX020",112,0)
 ;
"RTN","RORX020",113,0)
 ;--- Get GMRV VITAL TYPE pointer for HEIGHT
"RTN","RORX020",114,0)
 S RORDATA("HGTP")=$$GETIEN^GMVGETVT("HEIGHT",1)
"RTN","RORX020",115,0)
 I '$G(RORDATA("HGTP")) Q -1
"RTN","RORX020",116,0)
 ;
"RTN","RORX020",117,0)
 ;--- Get Max Date  OUTPUT: RORDATA("DATE")  - Max Date for test scores
"RTN","RORX020",118,0)
 S RORDATA("DATE")=$$PARAM^RORTSK01("OPTIONS","MAX_DATE")
"RTN","RORX020",119,0)
 I $G(RORDATA("DATE"))="" S RORDATA("DATE")=DT
"RTN","RORX020",120,0)
 ;
"RTN","RORX020",121,0)
 ;--- Summary vs. complete report requested
"RTN","RORX020",122,0)
 S RORDATA("COMPLETE")=0 ;default to 'summary' only
"RTN","RORX020",123,0)
 I $$PARAM^RORTSK01("OPTIONS","COMPLETE") S RORDATA("COMPLETE")=1
"RTN","RORX020",124,0)
 ;
"RTN","RORX020",125,0)
 ;--- Set the number of Renal ranges and initialize their values to 0
"RTN","RORX020",126,0)
 S RORDATA("RCNT")=5 D INIT^RORX020A(.RORDATA)
"RTN","RORX020",127,0)
 ;
"RTN","RORX020",128,0)
 ;--- Create 'patients' table
"RTN","RORX020",129,0)
 N RORBODY S RORBODY=$$ADDVAL^RORTSK11(RORTSK,"PATIENTS",,REPORT)
"RTN","RORX020",130,0)
 D ADDATTR^RORTSK11(RORTSK,RORBODY,"TABLE","PATIENTS")
"RTN","RORX020",131,0)
 ;
"RTN","RORX020",132,0)
 ;--- Check utilization
"RTN","RORX020",133,0)
 N CNT,ECNT,UTSDT,UTEDT,SKIPSDT,SKIPEDT
"RTN","RORX020",134,0)
 S (CNT,ECNT,RC)=0,SKIPEDT=ROREDT,SKIPSDT=RORSDT
"RTN","RORX020",135,0)
 ; Utilization date range is always sent
"RTN","RORX020",136,0)
 S UTSDT=$$PARAM^RORTSK01("DATE_RANGE_3","START")\1
"RTN","RORX020",137,0)
 S UTEDT=$$PARAM^RORTSK01("DATE_RANGE_3","END")\1
"RTN","RORX020",138,0)
 ; Combined date range
"RTN","RORX020",139,0)
 S SKIPSDT=$$DTMIN^RORUTL18(SKIPSDT,$G(UTSDT))
"RTN","RORX020",140,0)
 S SKIPEDT=$$DTMAX^RORUTL18(SKIPEDT,$G(UTEDT))
"RTN","RORX020",141,0)
 ;
"RTN","RORX020",142,0)
 ;--- Number of patients in the registry - used for calculating the
"RTN","RORX020",143,0)
 ;task progress percentage (shown on the GUI screen)
"RTN","RORX020",144,0)
 N RORPTCNT S RORPTCNT=$$REGSIZE^RORUTL02(+RORREG) S:RORPTCNT<0 RORPTCNT=0
"RTN","RORX020",145,0)
 ;
"RTN","RORX020",146,0)
 ;--- LOINC codes for Creatinine
"RTN","RORX020",147,0)
 ;create list for future comparison
"RTN","RORX020",148,0)
 S RORDATA("LOINC")=";15045-8;21232-4;2160-0;"
"RTN","RORX020",149,0)
 ;set up array for future call to Lab API
"RTN","RORX020",150,0)
 S RORLC="CH" ;chemistry sub-file to search in #63
"RTN","RORX020",151,0)
 S RORLC(1)="15045-8^LN" ;Creatinine LOINC
"RTN","RORX020",152,0)
 S RORLC(2)="21232-4^LN" ;Creatinine LOINC
"RTN","RORX020",153,0)
 S RORLC(3)="2160-0^LN"  ;Creatinine LOINC
"RTN","RORX020",154,0)
 ;
"RTN","RORX020",155,0)
 ;--- RACE code 2054-5 = 'black or african american' in RACE file (IEN=9)
"RTN","RORX020",156,0)
 S RORDATA("BAM")=";9;"
"RTN","RORX020",157,0)
 ;
"RTN","RORX020",158,0)
 ;=== Set up Clinic/Division list parameters
"RTN","RORX020",159,0)
 S RORCDLIST=$$CDPARMS^RORXU001(.RORTSK,.RORCDSTDT,.RORCDENDT,1)
"RTN","RORX020",160,0)
 ;
"RTN","RORX020",161,0)
 ;--- Get registry records
"RTN","RORX020",162,0)
 N RCC,FLAG,SKIP,TMP
"RTN","RORX020",163,0)
 S (CNT,RORPTIEN,RC)=0
"RTN","RORX020",164,0)
 S FLAG=$G(RORTSK("PARAMS","ICDFILT","A","FILTER"))
"RTN","RORX020",165,0)
 F  S RORPTIEN=$O(^RORDATA(798,"AC",RORREG,RORPTIEN))  Q:RORPTIEN'>0  D  Q:RC<0
"RTN","RORX020",166,0)
 . ;--- Calculate 'progress' for the GUI display
"RTN","RORX020",167,0)
 . S TMP=$S(RORPTCNT>0:CNT/RORPTCNT,1:"")
"RTN","RORX020",168,0)
 . S RC=$$LOOP^RORTSK01(TMP)  Q:RC<0
"RTN","RORX020",169,0)
 . S CNT=CNT+1
"RTN","RORX020",170,0)
 . ;--- Get the patient DFN
"RTN","RORX020",171,0)
 . S DFN=$$PTIEN^RORUTL01(RORPTIEN)  Q:DFN'>0
"RTN","RORX020",172,0)
 . ;--- Check for patient list and quit if not on list
"RTN","RORX020",173,0)
 . I $D(RORTSK("PARAMS","PATIENTS","C")),'$D(RORTSK("PARAMS","PATIENTS","C",DFN)) Q
"RTN","RORX020",174,0)
 . ;--- Check if the patient should be skipped
"RTN","RORX020",175,0)
 . Q:$$SKIP^RORXU005(RORPTIEN,SFLAGS,SKIPSDT,SKIPEDT)
"RTN","RORX020",176,0)
 . ;--- Check if patient has passed the ICD filter
"RTN","RORX020",177,0)
 . S RCC=0
"RTN","RORX020",178,0)
 . I FLAG'="ALL" D
"RTN","RORX020",179,0)
 . . S RCC=$$ICD^RORXU010(DFN)
"RTN","RORX020",180,0)
 . I (FLAG="INCLUDE")&(RCC=0) Q
"RTN","RORX020",181,0)
 . I (FLAG="EXCLUDE")&(RCC=1) Q
"RTN","RORX020",182,0)
 . ;
"RTN","RORX020",183,0)
 . ;--- Check for Clinic or Division list and quit if not in list
"RTN","RORX020",184,0)
 . I RORCDLIST,'$$CDUTIL^RORXU001(.RORTSK,DFN,RORCDSTDT,RORCDENDT) Q
"RTN","RORX020",185,0)
 . ;
"RTN","RORX020",186,0)
 . ;--- Check for utilization in the corresponding 'utilization' date range
"RTN","RORX020",187,0)
 . S SKIP=0 I $G(UTSDT)>0 D
"RTN","RORX020",188,0)
 .. N UTIL K TMP S TMP("ALL")=1
"RTN","RORX020",189,0)
 .. S UTIL=+$$UTIL^RORXU003(UTSDT,UTEDT,DFN,.TMP)
"RTN","RORX020",190,0)
 .. I 'UTIL S SKIP=1
"RTN","RORX020",191,0)
 . ;--- Skip the patient if they have no utilization in the range
"RTN","RORX020",192,0)
 . I $G(SKIP) Q
"RTN","RORX020",193,0)
 . ;
"RTN","RORX020",194,0)
 . ;--- For each patient, process the registry record and create report
"RTN","RORX020",195,0)
 . I $$PATIENT(DFN,RORBODY,.RORDATA,RORPTIEN,.RORLC)<0 S ECNT=ECNT+1 ;error count
"RTN","RORX020",196,0)
 ;
"RTN","RORX020",197,0)
 ;--- If user selected eGFR by MDRD (ID=2) or eGFR by CKD-EPI (ID=3), create summary report
"RTN","RORX020",198,0)
 I RORDATA("IDLST")[2!(RORDATA("IDLST")[3) S RC=$$SUMMARY^RORX020A(RORTSK,REPORT,.RORDATA)
"RTN","RORX020",199,0)
 Q:RC<0 RC
"RTN","RORX020",200,0)
 K ^TMP("RORX020",$J),^TMP("ROROUT",$J)
"RTN","RORX020",201,0)
 Q $S(RC<0:RC,ECNT>0:-43,1:0)
"RTN","RORX020",202,0)
 ;
"RTN","RORX020",203,0)
 ;************************************************************************
"RTN","RORX020",204,0)
 ;ADD THE PATIENT DATA TO THE REPORT
"RTN","RORX020",205,0)
 ;
"RTN","RORX020",206,0)
 ;INPUT
"RTN","RORX020",207,0)
 ;  DFN      Patient DFN in PATIENT file (#2)
"RTN","RORX020",208,0)
 ;  PTAG     Reference IEN to the 'body' parent XML tag
"RTN","RORX020",209,0)
 ;  RORDATA  Array with ROR data
"RTN","RORX020",210,0)
 ;  RORPTIEN Patient IEN in the ROR registry
"RTN","RORX020",211,0)
 ;  RORLC    sub-file and LOINC codes to search for
"RTN","RORX020",212,0)
 ;
"RTN","RORX020",213,0)
 ;OUTPUT
"RTN","RORX020",214,0)
 ;  1        ok
"RTN","RORX020",215,0)
 ; <0        error
"RTN","RORX020",216,0)
 ;************************************************************************
"RTN","RORX020",217,0)
PATIENT(DFN,PTAG,RORDATA,RORPTIEN,RORLC) ;
"RTN","RORX020",218,0)
 ;calculate Renal Function scores
"RTN","RORX020",219,0)
 I $$CALCRF^RORX020B(DFN,.RORDATA,RORPTIEN,.RORLC)<0 Q 1  ;quit if patient data not available
"RTN","RORX020",220,0)
 I '$$INRANGE^RORX020A(.RORDATA) Q 1  ;quit if score(s) out of requested range
"RTN","RORX020",221,0)
 ;if eGFR by MDRD requested, add 1 to appropriate category count
"RTN","RORX020",222,0)
 I RORDATA("IDLST")[2 D MDRDCAT^RORX020A(.RORDATA)
"RTN","RORX020",223,0)
 ;if eGFR by CKD-EPI requested, add 1 to appropriate category count
"RTN","RORX020",224,0)
 I RORDATA("IDLST")[3 D CKDCAT^RORX020A(.RORDATA)
"RTN","RORX020",225,0)
 Q:'RORDATA("COMPLETE") 1  ;continue only if 'complete' report is requested
"RTN","RORX020",226,0)
 ;--- Get patient data and put into the report
"RTN","RORX020",227,0)
 N VADM,VA,RORDOD,TTAG,RTAG,TMP,AGETYPE,AGE
"RTN","RORX020",228,0)
 D VADEM^RORUTL05(DFN,1)
"RTN","RORX020",229,0)
 ;--- The <PATIENT> tag
"RTN","RORX020",230,0)
 S PTAG=$$ADDVAL^RORTSK11(RORTSK,"PATIENT",,PTAG,,DFN)
"RTN","RORX020",231,0)
 I PTAG<0 Q PTAG
"RTN","RORX020",232,0)
 ;--- Patient Name
"RTN","RORX020",233,0)
 D ADDVAL^RORTSK11(RORTSK,"NAME",VADM(1),PTAG,1)
"RTN","RORX020",234,0)
 ;--- Last 4 digits of the SSN
"RTN","RORX020",235,0)
 D ADDVAL^RORTSK11(RORTSK,"LAST4",VA("BID"),PTAG,2)
"RTN","RORX020",236,0)
 ;--- Age/DOB
"RTN","RORX020",237,0)
 S AGETYPE=$$PARAM^RORTSK01("AGE_RANGE","TYPE") I AGETYPE'="ALL" D
"RTN","RORX020",238,0)
 . S AGE=$S(AGETYPE="AGE":$P(VADM(4),U),AGETYPE="DOB":$$DATE^RORXU002($P(VADM(3),U)\1),1:"")
"RTN","RORX020",239,0)
 . D ADDVAL^RORTSK11(RORTSK,AGETYPE,AGE,PTAG,1)
"RTN","RORX020",240,0)
 ;--- Date of death
"RTN","RORX020",241,0)
 S RORDOD=$$DATE^RORXU002($P(VADM(6),U)\1)
"RTN","RORX020",242,0)
 D ADDVAL^RORTSK11(RORTSK,"DOD",$G(RORDOD),PTAG,1)
"RTN","RORX020",243,0)
 ;--- RENAL DATA tag
"RTN","RORX020",244,0)
 S RTAG=$$ADDVAL^RORTSK11(RORTSK,"RNLDATA",,PTAG)
"RTN","RORX020",245,0)
 Q:RTAG<0 RTAG
"RTN","RORX020",246,0)
 ;---  CR Test Tag
"RTN","RORX020",247,0)
 S TTAG=$$ADDVAL^RORTSK11(RORTSK,"TEST",,RTAG)
"RTN","RORX020",248,0)
 Q:TTAG<0 TTAG
"RTN","RORX020",249,0)
 ;---  Date Cr Test Taken
"RTN","RORX020",250,0)
 D ADDVAL^RORTSK11(RORTSK,"DATE",$G(RORDATA("CRDATE")),TTAG)
"RTN","RORX020",251,0)
 ;---  Cr Test Value
"RTN","RORX020",252,0)
 D ADDVAL^RORTSK11(RORTSK,"RESULT",$G(RORDATA("CR")),TTAG)
"RTN","RORX020",253,0)
 ;--- Height tag
"RTN","RORX020",254,0)
 S TTAG=$$ADDVAL^RORTSK11(RORTSK,"HEIGHT",,RTAG)
"RTN","RORX020",255,0)
 Q:TTAG<0 TTAG
"RTN","RORX020",256,0)
 ;---  Date Height Taken
"RTN","RORX020",257,0)
 D ADDVAL^RORTSK11(RORTSK,"DATE",$G(RORDATA("HDATE")),TTAG)
"RTN","RORX020",258,0)
 ;---  Height value
"RTN","RORX020",259,0)
 D ADDVAL^RORTSK11(RORTSK,"RESULT",$G(RORDATA("HGT")),TTAG)
"RTN","RORX020",260,0)
 ;---  Calculated CRCL
"RTN","RORX020",261,0)
 I RORDATA("IDLST")[1 D ADDVAL^RORTSK11(RORTSK,"CRCL",$G(RORDATA("SCORE",1)),PTAG,3)
"RTN","RORX020",262,0)
 ;---  Calculated eGFR by MDRD
"RTN","RORX020",263,0)
 I RORDATA("IDLST")[2 D ADDVAL^RORTSK11(RORTSK,"MDRD",$G(RORDATA("SCORE",2)),PTAG,3)
"RTN","RORX020",264,0)
 ;---  Calculated eGFR by CKD-EPI
"RTN","RORX020",265,0)
 I RORDATA("IDLST")[3 D ADDVAL^RORTSK11(RORTSK,"CKD",$G(RORDATA("SCORE",3)),PTAG,3)
"RTN","RORX020",266,0)
 ;--- ICN,PACT,PCP
"RTN","RORX020",267,0)
 I $$PARAM^RORTSK01("PATIENTS","ICN") D ICNDATA^RORXU006(RORTSK,DFN,PTAG)
"RTN","RORX020",268,0)
 I $$PARAM^RORTSK01("PATIENTS","PACT") D PACTDATA^RORXU006(RORTSK,DFN,PTAG)
"RTN","RORX020",269,0)
 I $$PARAM^RORTSK01("PATIENTS","PCP") D PCPDATA^RORXU006(RORTSK,DFN,PTAG)
"RTN","RORX020",270,0)
 Q ($S(TTAG<0:TTAG,1:1))
"RTN","RORX020",271,0)
 ;
"RTN","RORX020A")
0^40^B59481878^B55299646
"RTN","RORX020A",1,0)
RORX020A ;BPOIFO/ACS - RENAL FUNCTION BY RANGE (CONT.) ;5/20/11 12:11pm
"RTN","RORX020A",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**10,14,15,21,31**;Feb 17, 2006;Build 62
"RTN","RORX020A",3,0)
 ;
"RTN","RORX020A",4,0)
 Q
"RTN","RORX020A",5,0)
 ;******************************************************************************
"RTN","RORX020A",6,0)
 ;******************************************************************************
"RTN","RORX020A",7,0)
 ;                 --- ROUTINE MODIFICATION LOG ---
"RTN","RORX020A",8,0)
 ;        
"RTN","RORX020A",9,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORX020A",10,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","RORX020A",11,0)
 ;ROR*1.5*14   APR  2011   A SAUNDERS   HEADER: Added LOINCs to report header
"RTN","RORX020A",12,0)
 ;ROR*1.5*21   SEP 2013    T KOPP       Added ICN as last report column if
"RTN","RORX020A",13,0)
 ;                                      additional identifier option selected
"RTN","RORX020A",14,0)
 ;ROR*1.5*31   MAY 2017    M FERRARESE  Adding PACT ,PCP,and AGE/DOB as additional
"RTN","RORX020A",15,0)
 ;                                      identifiers.
"RTN","RORX020A",16,0)
 ;******************************************************************************
"RTN","RORX020A",17,0)
 ;******************************************************************************
"RTN","RORX020A",18,0)
 ;
"RTN","RORX020A",19,0)
 ;************************************************************************
"RTN","RORX020A",20,0)
 ;ADD THE HEADERS TO THE REPORT (EXTRINSIC FUNCTION)
"RTN","RORX020A",21,0)
 ;
"RTN","RORX020A",22,0)
 ;INPUT
"RTN","RORX020A",23,0)
 ;  PARTAG  Reference IEN to the 'report' parent XML tag
"RTN","RORX020A",24,0)
 ;
"RTN","RORX020A",25,0)
 ;OUTPUT
"RTN","RORX020A",26,0)
 ;  <0      error
"RTN","RORX020A",27,0)
 ;  >0      'Header' XML tag number or error code
"RTN","RORX020A",28,0)
 ;************************************************************************
"RTN","RORX020A",29,0)
HEADER(PARTAG,RORTSK) ;
"RTN","RORX020A",30,0)
 N HEADER,RC,COL,COLUMNS,TMP S RC=0
"RTN","RORX020A",31,0)
 ;call to $$HEADER^RORXU002 will populate the report created date, task number,
"RTN","RORX020A",32,0)
 ;last registry update, and last data extraction.
"RTN","RORX020A",33,0)
 S HEADER=$$HEADER^RORXU002(.RORTSK,PARTAG)
"RTN","RORX020A",34,0)
 Q:HEADER<0 HEADER
"RTN","RORX020A",35,0)
 ;manually build the table definition(s) listed below
"RTN","RORX020A",36,0)
 ;PATIENTS(#,NAME,LAST4,AGE,DOD,TEST,DATE,RESULT,CRCL,EGFR)
"RTN","RORX020A",37,0)
 S COLUMNS=$$ADDVAL^RORTSK11(RORTSK,"TBLDEF",,HEADER)
"RTN","RORX020A",38,0)
 D ADDATTR^RORTSK11(RORTSK,COLUMNS,"NAME","PATIENTS")
"RTN","RORX020A",39,0)
 D ADDATTR^RORTSK11(RORTSK,COLUMNS,"HEADER","1")
"RTN","RORX020A",40,0)
 D ADDATTR^RORTSK11(RORTSK,COLUMNS,"FOOTER","1")
"RTN","RORX020A",41,0)
 ;--- Required columns
"RTN","RORX020A",42,0)
 S AGETYPE=$$PARAM^RORTSK01("AGE_RANGE","TYPE") ; do not list Age if the selection is to list ALL ages
"RTN","RORX020A",43,0)
 F COL="#","NAME","LAST4",AGETYPE,"DOD","TEST","DATE","RESULT"  D
"RTN","RORX020A",44,0)
 . Q:COL="ALL"
"RTN","RORX020A",45,0)
 . S TMP=$$ADDVAL^RORTSK11(RORTSK,"COLUMN",,COLUMNS)
"RTN","RORX020A",46,0)
 . D ADDATTR^RORTSK11(RORTSK,TMP,"NAME",COL)
"RTN","RORX020A",47,0)
 ;--- Additional columns
"RTN","RORX020A",48,0)
 I RORDATA("IDLST")[1 D
"RTN","RORX020A",49,0)
 . S TMP=$$ADDVAL^RORTSK11(RORTSK,"COLUMN",,COLUMNS)
"RTN","RORX020A",50,0)
 . D ADDATTR^RORTSK11(RORTSK,TMP,"NAME","CRCL")
"RTN","RORX020A",51,0)
 I RORDATA("IDLST")[2 D
"RTN","RORX020A",52,0)
 . S TMP=$$ADDVAL^RORTSK11(RORTSK,"COLUMN",,COLUMNS)
"RTN","RORX020A",53,0)
 . D ADDATTR^RORTSK11(RORTSK,TMP,"NAME","MDRD")
"RTN","RORX020A",54,0)
 I RORDATA("IDLST")[3 D
"RTN","RORX020A",55,0)
 . S TMP=$$ADDVAL^RORTSK11(RORTSK,"COLUMN",,COLUMNS)
"RTN","RORX020A",56,0)
 . D ADDATTR^RORTSK11(RORTSK,TMP,"NAME","CKD")
"RTN","RORX020A",57,0)
 ;--- LOINC codes
"RTN","RORX020A",58,0)
 N LTAG S LTAG=$$ADDVAL^RORTSK11(RORTSK,"LOINC_CODES",,PARTAG)
"RTN","RORX020A",59,0)
 N CTAG S CTAG=$$ADDVAL^RORTSK11(RORTSK,"CODE",,LTAG)
"RTN","RORX020A",60,0)
 D ADDATTR^RORTSK11(RORTSK,CTAG,"CODE","Creatinine: 15045-8, 21232-4, 2160-0")
"RTN","RORX020A",61,0)
 ;--- ICN
"RTN","RORX020A",62,0)
 I $$PARAM^RORTSK01("PATIENTS","ICN") D ICNHDR^RORXU006(RORTSK,COLUMNS)
"RTN","RORX020A",63,0)
 ;--- PACT
"RTN","RORX020A",64,0)
 I $$PARAM^RORTSK01("PATIENTS","PACT") D PACTHDR^RORXU006(RORTSK,COLUMNS)
"RTN","RORX020A",65,0)
 ;--- PCP
"RTN","RORX020A",66,0)
 I $$PARAM^RORTSK01("PATIENTS","PCP") D PCPHDR^RORXU006(RORTSK,COLUMNS)
"RTN","RORX020A",67,0)
 ;---
"RTN","RORX020A",68,0)
 Q $S(RC<0:RC,1:HEADER)
"RTN","RORX020A",69,0)
 ;
"RTN","RORX020A",70,0)
 ;*****************************************************************************
"RTN","RORX020A",71,0)
 ;INITIALIZE THE RANGE COUNTS TO 0
"RTN","RORX020A",72,0)
 ;
"RTN","RORX020A",73,0)
 ;INPUT
"RTN","RORX020A",74,0)
 ;  RORDATA  Array with ROR data
"RTN","RORX020A",75,0)
 ;           RORDATA("RCNT") Number of ranges/groupings to initialize
"RTN","RORX020A",76,0)
 ;*****************************************************************************
"RTN","RORX020A",77,0)
INIT(RORDATA) ;
"RTN","RORX020A",78,0)
 I $G(RORDATA("RCNT"))="" Q
"RTN","RORX020A",79,0)
 N I
"RTN","RORX020A",80,0)
 F I=1:1:RORDATA("RCNT") D
"RTN","RORX020A",81,0)
 .I RORDATA("IDLST")[2 S RORDATA("NPMDRD",I)=0
"RTN","RORX020A",82,0)
 .I RORDATA("IDLST")[3 S RORDATA("NPCKD",I)=0
"RTN","RORX020A",83,0)
 Q
"RTN","RORX020A",84,0)
 ;
"RTN","RORX020A",85,0)
 ;*****************************************************************************
"RTN","RORX020A",86,0)
 ;OUTPUT REPORT 'RANGE' PARAMETERS, SET UP REPORT ID LIST (EXTRINISIC FUNCTION)
"RTN","RORX020A",87,0)
 ;
"RTN","RORX020A",88,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX020A",89,0)
 ;
"RTN","RORX020A",90,0)
 ; Return Values:
"RTN","RORX020A",91,0)
 ;        RORDATA("IDLST") - list of IDs for tests requested
"RTN","RORX020A",92,0)
 ;        RORDATA("RANGE") - 1 if range passed in for either test, else 0
"RTN","RORX020A",93,0)
 ;       <0  Error code
"RTN","RORX020A",94,0)
 ;        0  Ok
"RTN","RORX020A",95,0)
 ;*****************************************************************************
"RTN","RORX020A",96,0)
PARAMS(PARTAG,RORDATA) ;
"RTN","RORX020A",97,0)
 N PARAMS,DESC,TMP,RC,RANGE S RC=0
"RTN","RORX020A",98,0)
 S RORDATA("RANGE")=0 ;initialize to 'no range passed in'
"RTN","RORX020A",99,0)
 ;--- Lab test ranges
"RTN","RORX020A",100,0)
 I $D(RORTSK("PARAMS","LRGRANGES","C"))>1  D  Q:RC<0 RC
"RTN","RORX020A",101,0)
 . N GRC,ELEMENT,NODE,RTAG,RANGE
"RTN","RORX020A",102,0)
 . S NODE=$NA(RORTSK("PARAMS","LRGRANGES","C"))
"RTN","RORX020A",103,0)
 . S RTAG=$$ADDVAL^RORTSK11(RORTSK,"LRGRANGES",,PARTAG)
"RTN","RORX020A",104,0)
 . S (GRC,RC)=0
"RTN","RORX020A",105,0)
 . F  S GRC=$O(@NODE@(GRC))  Q:GRC'>0  D  Q:RC<0
"RTN","RORX020A",106,0)
 . . S RANGE=0,DESC=$$RTEXT(GRC,.RORDATA)
"RTN","RORX020A",107,0)
 . . S ELEMENT=$$ADDVAL^RORTSK11(RORTSK,"LRGRANGE",DESC,RTAG)
"RTN","RORX020A",108,0)
 . . I ELEMENT<0 S RC=ELEMENT Q
"RTN","RORX020A",109,0)
 . . D ADDATTR^RORTSK11(RORTSK,ELEMENT,"ID",GRC)
"RTN","RORX020A",110,0)
 . . ;add the user-requested test ID to the test ID 'list'
"RTN","RORX020A",111,0)
 . . S RORDATA("IDLST")=$G(RORDATA("IDLST"))_$S($G(RORDATA("IDLST"))'="":","_GRC,1:GRC)
"RTN","RORX020A",112,0)
 . . ;--- Process the range values
"RTN","RORX020A",113,0)
 . . S TMP=$G(@NODE@(GRC,"L"))
"RTN","RORX020A",114,0)
 . . I TMP'="" D  S RANGE=1
"RTN","RORX020A",115,0)
 . . . D ADDATTR^RORTSK11(RORTSK,ELEMENT,"LOW",TMP)
"RTN","RORX020A",116,0)
 . . S TMP=$G(@NODE@(GRC,"H"))
"RTN","RORX020A",117,0)
 . . I TMP'="" D  S RANGE=1
"RTN","RORX020A",118,0)
 . . . D ADDATTR^RORTSK11(RORTSK,ELEMENT,"HIGH",TMP)
"RTN","RORX020A",119,0)
 . . I RANGE D 
"RTN","RORX020A",120,0)
 . . . D ADDATTR^RORTSK11(RORTSK,ELEMENT,"RANGE",1)
"RTN","RORX020A",121,0)
 . . . S RORDATA("RANGE")=1
"RTN","RORX020A",122,0)
 ;--- Success
"RTN","RORX020A",123,0)
 ;if user didn't select any tests, default to both tests
"RTN","RORX020A",124,0)
 I $G(RORDATA("IDLST"))="" S RORDATA("IDLST")="1,2,3"
"RTN","RORX020A",125,0)
 Q RC
"RTN","RORX020A",126,0)
 ;
"RTN","RORX020A",127,0)
 ;*****************************************************************************
"RTN","RORX020A",128,0)
 ;RETURN RANGE TEXT AND ADD RANGE VALUES TO RORDATA (EXTRINISIC FUNCTION) 
"RTN","RORX020A",129,0)
 ;ID=1: MELD
"RTN","RORX020A",130,0)
 ;ID=2: MELD-Na
"RTN","RORX020A",131,0)
 ;
"RTN","RORX020A",132,0)
 ;INPUT:
"RTN","RORX020A",133,0)
 ;  GRC   Test ID number
"RTN","RORX020A",134,0)
 ;  RORDATA - Array with ROR data
"RTN","RORX020A",135,0)
 ;
"RTN","RORX020A",136,0)
 ;OUTPUT:
"RTN","RORX020A",137,0)
 ;  RORDATA("L",ID) - test ID low range
"RTN","RORX020A",138,0)
 ;  RORDATA("H",ID) - test ID high range
"RTN","RORX020A",139,0)
 ;  Description - <range>
"RTN","RORX020A",140,0)
 ;*****************************************************************************
"RTN","RORX020A",141,0)
RTEXT(GRC,RORDATA) ;
"RTN","RORX020A",142,0)
 N RANGE,TMP
"RTN","RORX020A",143,0)
 S RANGE=""
"RTN","RORX020A",144,0)
 ;--- Range
"RTN","RORX020A",145,0)
 I $D(RORTSK("PARAMS","LRGRANGES","C",GRC))>1 D
"RTN","RORX020A",146,0)
 . ;--- Low
"RTN","RORX020A",147,0)
 . S TMP=$G(RORTSK("PARAMS","LRGRANGES","C",GRC,"L"))
"RTN","RORX020A",148,0)
 . S RORDATA("L",GRC)=$G(TMP)
"RTN","RORX020A",149,0)
 . S:TMP'="" RANGE=RANGE_" not less than "_TMP
"RTN","RORX020A",150,0)
 . ;--- High
"RTN","RORX020A",151,0)
 . S TMP=$G(RORTSK("PARAMS","LRGRANGES","C",GRC,"H"))
"RTN","RORX020A",152,0)
 . S RORDATA("H",GRC)=$G(TMP)
"RTN","RORX020A",153,0)
 . I TMP'=""  D:RANGE'=""  S RANGE=RANGE_" not greater than "_TMP
"RTN","RORX020A",154,0)
 . . S RANGE=RANGE_" and"
"RTN","RORX020A",155,0)
 ;--- Description
"RTN","RORX020A",156,0)
 S TMP=$G(RORTSK("PARAMS","LRGRANGES","C",GRC))
"RTN","RORX020A",157,0)
 S:TMP="" TMP="Unknown ("_GRC_")"
"RTN","RORX020A",158,0)
 Q TMP_" - "_$S(RANGE'="":"numeric results"_RANGE,1:"all results")
"RTN","RORX020A",159,0)
 ;
"RTN","RORX020A",160,0)
 ;************************************************************************
"RTN","RORX020A",161,0)
 ;DETERMINE IF THE SCORES ARE WITHIN THE REQUESTED RANGES (EXTRINSIC FUNCTION)
"RTN","RORX020A",162,0)
 ;If not in the range, exclude from report
"RTN","RORX020A",163,0)
 ;
"RTN","RORX020A",164,0)
 ;INPUT:
"RTN","RORX020A",165,0)
 ;  RORDATA  RORDATA("SCORE",I) contains computed test score for test ID 'I'
"RTN","RORX020A",166,0)
 ;
"RTN","RORX020A",167,0)
 ;OUTPUT:
"RTN","RORX020A",168,0)
 ;  1  include on report
"RTN","RORX020A",169,0)
 ;  0  exclude from report
"RTN","RORX020A",170,0)
 ;************************************************************************
"RTN","RORX020A",171,0)
INRANGE(RORDATA) ;
"RTN","RORX020A",172,0)
 ;if range exists for either test, and any result is considered 'invalid',
"RTN","RORX020A",173,0)
 ;then skip the range check and exclude data from report
"RTN","RORX020A",174,0)
 ;I $G(RORDATA("RANGE")),'$G(RORDATA("CALC")) Q 0
"RTN","RORX020A",175,0)
 ;if range does not exist for either test, and any result is considered 'invalid',
"RTN","RORX020A",176,0)
 ;then skip the range check and include data in the report
"RTN","RORX020A",177,0)
 I '$G(RORDATA("RANGE")),'$G(RORDATA("CALC")) Q 1
"RTN","RORX020A",178,0)
 ;
"RTN","RORX020A",179,0)
 ;---Range Check
"RTN","RORX020A",180,0)
 N I,RETURN S RETURN=1 ;default is set to 'within range'
"RTN","RORX020A",181,0)
 S I=0 F  S I=$O(RORDATA("SCORE",I)) Q:I=""  D
"RTN","RORX020A",182,0)
 . I $G(RORDATA("L",I))'="" D
"RTN","RORX020A",183,0)
 .. ;if score is less than 'low' range, do not include on report 
"RTN","RORX020A",184,0)
 .. I $G(RORDATA("SCORE",I))<RORDATA("L",I) S RETURN=0
"RTN","RORX020A",185,0)
 . I $G(RORDATA("H",I))'="" D
"RTN","RORX020A",186,0)
 .. ;if score is higher than 'high' range, do not include on report 
"RTN","RORX020A",187,0)
 .. I $G(RORDATA("SCORE",I))>RORDATA("H",I) S RETURN=0
"RTN","RORX020A",188,0)
 ;
"RTN","RORX020A",189,0)
 Q RETURN
"RTN","RORX020A",190,0)
 ;
"RTN","RORX020A",191,0)
 ;************************************************************************
"RTN","RORX020A",192,0)
 ;ADD 1 TO APPROPRIATE eGFR CATEGORY
"RTN","RORX020A",193,0)
 ;
"RTN","RORX020A",194,0)
 ;INPUT
"RTN","RORX020A",195,0)
 ;  RORDATA  Array with ROR data
"RTN","RORX020A",196,0)
 ;************************************************************************
"RTN","RORX020A",197,0)
MDRDCAT(RORDATA) ;
"RTN","RORX020A",198,0)
 I '$G(RORDATA("SCORE",2)) Q  ;quit if no score was calculated
"RTN","RORX020A",199,0)
 I $G(RORDATA("SCORE",2))>89 S RORDATA("NPMDRD",1)=$G(RORDATA("NPMDRD",1))+1 Q
"RTN","RORX020A",200,0)
 I $G(RORDATA("SCORE",2))>59 S RORDATA("NPMDRD",2)=$G(RORDATA("NPMDRD",2))+1 Q
"RTN","RORX020A",201,0)
 I $G(RORDATA("SCORE",2))>29 S RORDATA("NPMDRD",3)=$G(RORDATA("NPMDRD",3))+1 Q
"RTN","RORX020A",202,0)
 I $G(RORDATA("SCORE",2))>14 S RORDATA("NPMDRD",4)=$G(RORDATA("NPMDRD",4))+1 Q
"RTN","RORX020A",203,0)
 S RORDATA("NPMDRD",5)=$G(RORDATA("NPMDRD",5))+1 Q
"RTN","RORX020A",204,0)
 Q
"RTN","RORX020A",205,0)
 ;
"RTN","RORX020A",206,0)
 ;************************************************************************
"RTN","RORX020A",207,0)
 ;ADD 1 TO APPROPRIATE eGFR CATEGORY
"RTN","RORX020A",208,0)
 ;
"RTN","RORX020A",209,0)
 ;INPUT
"RTN","RORX020A",210,0)
 ;  RORDATA  Array with ROR data
"RTN","RORX020A",211,0)
 ;************************************************************************
"RTN","RORX020A",212,0)
CKDCAT(RORDATA) ;
"RTN","RORX020A",213,0)
 I '$G(RORDATA("SCORE",3)) Q  ;quit if no score was calculated
"RTN","RORX020A",214,0)
 I $G(RORDATA("SCORE",3))>89 S RORDATA("NPCKD",1)=$G(RORDATA("NPCKD",1))+1 Q
"RTN","RORX020A",215,0)
 I $G(RORDATA("SCORE",3))>59 S RORDATA("NPCKD",2)=$G(RORDATA("NPCKD",2))+1 Q
"RTN","RORX020A",216,0)
 I $G(RORDATA("SCORE",3))>29 S RORDATA("NPCKD",3)=$G(RORDATA("NPCKD",3))+1 Q
"RTN","RORX020A",217,0)
 I $G(RORDATA("SCORE",3))>14 S RORDATA("NPCKD",4)=$G(RORDATA("NPCKD",4))+1 Q
"RTN","RORX020A",218,0)
 S RORDATA("NPCKD",5)=$G(RORDATA("NPCKD",5))+1 Q
"RTN","RORX020A",219,0)
 Q
"RTN","RORX020A",220,0)
 ;*****************************************************************************
"RTN","RORX020A",221,0)
 ;ADD SUMMARY DATA TO THE REPORT (EXTRINSIC FUNCTION)
"RTN","RORX020A",222,0)
 ;
"RTN","RORX020A",223,0)
 ;INPUT
"RTN","RORX020A",224,0)
 ;  RORTSK   Task number and task parameters
"RTN","RORX020A",225,0)
 ;  REPORT   'Report' XML tag number
"RTN","RORX020A",226,0)
 ;  RORDATA  Array with summary data:
"RTN","RORX020A",227,0)
 ;           RORDATA("NP",1) - total count of patients in 1st range
"RTN","RORX020A",228,0)
 ;           RORDATA("NP",2) - total count of patients in 2nd range
"RTN","RORX020A",229,0)
 ;           RORDATA("NP",3) - total count of patients in 3rd range
"RTN","RORX020A",230,0)
 ;           RORDATA("NP",4) - total count of patients in 4th range
"RTN","RORX020A",231,0)
 ;           RORDATA("NP",5) - total count of patients in 5th range
"RTN","RORX020A",232,0)
 ;
"RTN","RORX020A",233,0)
 ;OUTPUT
"RTN","RORX020A",234,0)
 ;  STAG     XML 'summary' tag number or error code
"RTN","RORX020A",235,0)
 ;*****************************************************************************
"RTN","RORX020A",236,0)
SUMMARY(RORTSK,REPORT,RORDATA) ; Add the summary values to the report
"RTN","RORX020A",237,0)
 N SUMMARY,I,STAG,RORTAG,RORNAME,RORRANGE
"RTN","RORX020A",238,0)
 S SUMMARY=$$ADDVAL^RORTSK11(RORTSK,"SUMMARY",,REPORT)
"RTN","RORX020A",239,0)
 Q:SUMMARY<0 SUMMARY
"RTN","RORX020A",240,0)
 ;add data for the summary entries
"RTN","RORX020A",241,0)
 F I=1:1:RORDATA("RCNT")  D  Q:STAG<0
"RTN","RORX020A",242,0)
 . S STAG=$$ADDVAL^RORTSK11(RORTSK,"DATA",,SUMMARY)
"RTN","RORX020A",243,0)
 . Q:STAG<0
"RTN","RORX020A",244,0)
 . ;get each value
"RTN","RORX020A",245,0)
 . S RORTAG="S"_I S RORNAME=$P($T(@RORTAG),";;",2)
"RTN","RORX020A",246,0)
 . S RORRANGE=$P($T(@RORTAG),";;",3)
"RTN","RORX020A",247,0)
 . D ADDVAL^RORTSK11(RORTSK,"DESC",$G(RORNAME),STAG) ;severity
"RTN","RORX020A",248,0)
 . D ADDVAL^RORTSK11(RORTSK,"VALUES",$G(RORRANGE),STAG) ;range
"RTN","RORX020A",249,0)
 . D ADDVAL^RORTSK11(RORTSK,"NPMDRD",$G(RORDATA("NPMDRD",I)),STAG) ;count
"RTN","RORX020A",250,0)
 . D ADDVAL^RORTSK11(RORTSK,"NPCKD",$G(RORDATA("NPCKD",I)),STAG) ;count
"RTN","RORX020A",251,0)
 Q STAG
"RTN","RORX020A",252,0)
 ;************************************************************************
"RTN","RORX020A",253,0)
 ;eGFR by MDRD Categories and Values for the summary table.
"RTN","RORX020A",254,0)
 ;NOTE: the number of entries below must match the value of RORDATA("RCNT")
"RTN","RORX020A",255,0)
 ;************************************************************************
"RTN","RORX020A",256,0)
S1 ;;Normal or CKD1;;>=90 mL/min/1.73m
"RTN","RORX020A",257,0)
S2 ;;CKD2 (Mild);;60-89 mL/min/1.73m
"RTN","RORX020A",258,0)
S3 ;;CKD3 (Moderate);;30-59 mL/min/1.73m
"RTN","RORX020A",259,0)
S4 ;;CKD4 (Severe);;15-29 mL/min/1.73m
"RTN","RORX020A",260,0)
S5 ;;CKD5 (Kidney failure);;<15 mL/min/1.73m
"RTN","RORX021")
0^41^B30013567^B26620213
"RTN","RORX021",1,0)
RORX021 ;BPOIFO/CLR - HCV DAA CANDIDATES REPORT ;26 May 2015  4:02 PM
"RTN","RORX021",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**17,21,26,31**;Feb 17, 2006;Build 62
"RTN","RORX021",3,0)
 ;
"RTN","RORX021",4,0)
 ;******************************************************************************
"RTN","RORX021",5,0)
 ;                       --- ROUTINE MODIFICATION LOG ---
"RTN","RORX021",6,0)
 ;        
"RTN","RORX021",7,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORX021",8,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","RORX021",9,0)
 ;ROR*1.5*21   SEP 2013    T KOPP       Added ICN as last report column if
"RTN","RORX021",10,0)
 ;                                      additional identifier option selected
"RTN","RORX021",11,0)
 ;ROR*1.5*26   JAN 2015    T KOPP       Added FIB4 parameters set and header
"RTN","RORX021",12,0)
 ;                                      for FIB4 score. Remove treatment status.
"RTN","RORX021",13,0)
 ;ROR*1.5*31   MAY 2017    M FERRARESE  Adding PACT ,PCP,and AGE/DOB as additional
"RTN","RORX021",14,0)
 ;                                      identifiers.
"RTN","RORX021",15,0)
 ;******************************************************************************
"RTN","RORX021",16,0)
 ;
"RTN","RORX021",17,0)
 Q
"RTN","RORX021",18,0)
 ;
"RTN","RORX021",19,0)
 ;***** OUTPUTS THE REPORT HEADER
"RTN","RORX021",20,0)
 ;
"RTN","RORX021",21,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX021",22,0)
 ;
"RTN","RORX021",23,0)
 ; Return Values:
"RTN","RORX021",24,0)
 ;       <0  Error code
"RTN","RORX021",25,0)
 ;       >0  IEN of the HEADER element
"RTN","RORX021",26,0)
 ;
"RTN","RORX021",27,0)
HEADER(PARTAG) ;
"RTN","RORX021",28,0)
 ;;PATIENTS(#,NAME,LAST4,HCV_DATE,HCV,GT,FILL_DATE,FILL_MED,FIB4,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="ALL"
"RTN","RORX021",29,0)
 ;;PATIENTS(#,NAME,LAST4,AGE,HCV_DATE,HCV,GT,FILL_DATE,FILL_MED,FIB4,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="AGE"
"RTN","RORX021",30,0)
 ;;PATIENTS(#,NAME,LAST4,DOB,HCV_DATE,HCV,GT,FILL_DATE,FILL_MED,FIB4,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="DOB"
"RTN","RORX021",31,0)
 ;
"RTN","RORX021",32,0)
 N HEADER,RC
"RTN","RORX021",33,0)
 S HEADER=$$HEADER^RORXU002(.RORTSK,PARTAG)
"RTN","RORX021",34,0)
 Q:HEADER<0 HEADER
"RTN","RORX021",35,0)
 S RC=$$TBLDEF^RORXU002("HEADER^RORX021",HEADER)
"RTN","RORX021",36,0)
 Q $S(RC<0:RC,1:HEADER)
"RTN","RORX021",37,0)
 ;
"RTN","RORX021",38,0)
 ;***** COMPILES THE "POTENTIAL DAA CANDIDATES" REPORT
"RTN","RORX021",39,0)
 ; REPORT CODE: 021
"RTN","RORX021",40,0)
 ;
"RTN","RORX021",41,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORX021",42,0)
 ;
"RTN","RORX021",43,0)
 ; The ^TMP("RORX021",$J) global node is used by this function.
"RTN","RORX021",44,0)
 ;
"RTN","RORX021",45,0)
 ; ^TMP("RORX021",$J,
"RTN","RORX021",46,0)
 ;   "PAT",
"RTN","RORX021",47,0)
 ;     DFN,              Patient descriptor
"RTN","RORX021",48,0)
 ;                         ^01: Last 4 digits of SSN
"RTN","RORX021",49,0)
 ;                         ^02: Patient name
"RTN","RORX021",50,0)
 ;                         ^03: Treatment History (not used)
"RTN","RORX021",51,0)
 ;                         ^04: National ICN
"RTN","RORX021",52,0)
 ;                         ^05: FIB4 score
"RTN","RORX021",53,0)
 ;                         ^06: Patient Care Team
"RTN","RORX021",54,0)
 ;                         ^07: Priamary Care Provider
"RTN","RORX021",55,0)
 ;                         ^08: Age/DOB
"RTN","RORX021",56,0)
 ;       "LR",
"RTN","RORX021",57,0)
 ;         Category,
"RTN","RORX021",58,0)
 ;           Date(inverse) = Result
"RTN","RORX021",59,0)
 ;            
"RTN","RORX021",60,0)
 ;       "RX",
"RTN","RORX021",61,0)
 ;         Date(inverse),
"RTN","RORX021",62,0)
 ;           Generic Drug Name,
"RTN","RORX021",63,0)
 ;             Drug IEN,
"RTN","RORX021",64,0)
 ;                RX #,
"RTN","RORX021",65,0)
 ;                   Count) = ""
"RTN","RORX021",66,0)
 ;
"RTN","RORX021",67,0)
 ; Return Values:
"RTN","RORX021",68,0)
 ;       <0  Error code
"RTN","RORX021",69,0)
 ;        0  Ok
"RTN","RORX021",70,0)
 ;
"RTN","RORX021",71,0)
HCVDAA(RORTSK) ;
"RTN","RORX021",72,0)
 N RORLTST       ; Closed root of the list of lab tests for the
"RTN","RORX021",73,0)
 ;               ; Lab search API
"RTN","RORX021",74,0)
 N RORREG        ; Registry IEN
"RTN","RORX021",75,0)
 N RORSDT       ; Pharmacy start date
"RTN","RORX021",76,0)
 N ROREDT       ; Pharmacy end date
"RTN","RORX021",77,0)
 N RORXGRP       ; List of drug groups
"RTN","RORX021",78,0)
 N RORXL         ; Closed root of the drug list for the pharmacy
"RTN","RORX021",79,0)
 ;               ; search API 
"RTN","RORX021",80,0)
 N RORLC         ; sub-file and LOINC codes to search for FIB4
"RTN","RORX021",81,0)
 N ECNT,NSPT,RC,SFLAGS,TMP,BUF,RORDATA
"RTN","RORX021",82,0)
 N REPORT,PARAMS,ELEMENT  ;XML parent variables
"RTN","RORX021",83,0)
 ;
"RTN","RORX021",84,0)
 S (RORXL,RORLTST)="",(ECNT,RC)=0
"RTN","RORX021",85,0)
 K ^TMP("RORX021",$J)
"RTN","RORX021",86,0)
 ;--- Root node of the report
"RTN","RORX021",87,0)
 S REPORT=$$ADDVAL^RORTSK11(RORTSK,"REPORT")
"RTN","RORX021",88,0)
 Q:REPORT<0 REPORT
"RTN","RORX021",89,0)
 ;
"RTN","RORX021",90,0)
 ;--- Get and prepare the report parameters
"RTN","RORX021",91,0)
 D
"RTN","RORX021",92,0)
 . N Z
"RTN","RORX021",93,0)
 . S RORREG=$$PARAM^RORTSK01("REGIEN")  ; Registry IEN
"RTN","RORX021",94,0)
 . S PARAMS=$$PARAMS^RORXU002(.RORTSK,REPORT,.RORXSDT,.RORXEDT,.SFLAGS)
"RTN","RORX021",95,0)
 . I PARAMS<0 S RC=PARAMS Q
"RTN","RORX021",96,0)
 . S Z=0,RORDATA("IDLST")=""
"RTN","RORX021",97,0)
 . F  S Z=$O(RORTSK("PARAMS","LRGRANGES","C",Z)) Q:'Z  D
"RTN","RORX021",98,0)
 .. S RORDATA("IDLST")=RORDATA("IDLST")_$S(RORDATA("IDLST")'="":",",1:"")_Z
"RTN","RORX021",99,0)
 . K:RORDATA("IDLST")="" RORDATA("IDLST")
"RTN","RORX021",100,0)
 . I $D(RORDATA("IDLST")) D  Q:RC<0
"RTN","RORX021",101,0)
 .. D LIVPARAM^RORX019(.RORDATA,.RORTSK,.RORLC)
"RTN","RORX021",102,0)
 .. ;--- Add lab results range parameters to output
"RTN","RORX021",103,0)
 .. S RC=$$PARAMS(PARAMS,.RORDATA,.RORTSK)
"RTN","RORX021",104,0)
 .. Q:RC<0
"RTN","RORX021",105,0)
 .. S ELEMENT=$$ADDVAL^RORTSK11(RORTSK,"FIB4",$$OPTXT^RORXU002(.RORDATA),PARAMS)
"RTN","RORX021",106,0)
 .. I ELEMENT<0 S RC=ELEMENT Q
"RTN","RORX021",107,0)
 . Q:RC<0
"RTN","RORX021",108,0)
 . ;--- Get and store treatment history parameters
"RTN","RORX021",109,0)
 . M BUF=RORTSK("PARAMS","TREATMENT_HISTORY","A")  Q:$D(BUF)<10
"RTN","RORX021",110,0)
 . S ELEMENT=$$ADDVAL^RORTSK11(RORTSK,"TREATMENT_HISTORY",$$OPTXT^RORXU002(.BUF),PARAMS)
"RTN","RORX021",111,0)
 . I ELEMENT'>0  S RC=ELEMENT  Q
"RTN","RORX021",112,0)
 . S TMP=""
"RTN","RORX021",113,0)
 . F  S TMP=$O(BUF(TMP))  Q:TMP=""  D  Q:RC<0
"RTN","RORX021",114,0)
 . . S RC=$$ADDATTR^RORTSK11(RORTSK,ELEMENT,TMP,BUF(TMP))
"RTN","RORX021",115,0)
 . ;--- Report header
"RTN","RORX021",116,0)
 . S RC=$$HEADER(REPORT)  Q:RC<0
"RTN","RORX021",117,0)
 . ;--- Query the registry
"RTN","RORX021",118,0)
 . D TPPSETUP^RORTSK01(80)
"RTN","RORX021",119,0)
 . S RC=$$QUERY^RORX021A(REPORT,SFLAGS,.NSPT,.RORLC)
"RTN","RORX021",120,0)
 . I RC Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX021",121,0)
 . ;--- Store the results
"RTN","RORX021",122,0)
 . D TPPSETUP^RORTSK01(20)
"RTN","RORX021",123,0)
 . S RC=$$STORE^RORX021A(REPORT,NSPT)
"RTN","RORX021",124,0)
 . I RC Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX021",125,0)
 ;--- Cleanup
"RTN","RORX021",126,0)
 K ^TMP("RORX021",$J)
"RTN","RORX021",127,0)
 ;
"RTN","RORX021",128,0)
 Q $S(RC<0:RC,ECNT>0:-43,1:0)
"RTN","RORX021",129,0)
 ;
"RTN","RORX021",130,0)
  ;*****************************************************************************
"RTN","RORX021",131,0)
 ;OUTPUT REPORT 'RANGE' PARAMETERS, SET UP REPORT ID LIST (EXTRINISIC FUNCTION)
"RTN","RORX021",132,0)
 ;
"RTN","RORX021",133,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX021",134,0)
 ;
"RTN","RORX021",135,0)
 ; Return Values:
"RTN","RORX021",136,0)
 ;       <0  Error code
"RTN","RORX021",137,0)
 ;        0  Ok
"RTN","RORX021",138,0)
 ;*****************************************************************************
"RTN","RORX021",139,0)
PARAMS(PARTAG,RORDATA,RORTSK) ;  Currently, only FIB-4 is used for this report
"RTN","RORX021",140,0)
 N PARAMS,DESC,TMP,RC S RC=0
"RTN","RORX021",141,0)
 ;--- Lab test ranges
"RTN","RORX021",142,0)
 S RORDATA("RANGE",4)=0 ;initialize FIB4 to 'no range passed in'
"RTN","RORX021",143,0)
 I $D(RORTSK("PARAMS","LRGRANGES","C",4)) D  Q:RC<0 RC
"RTN","RORX021",144,0)
 . N ELEMENT,NODE,RTAG,RANGE
"RTN","RORX021",145,0)
 . S NODE=$NA(RORTSK("PARAMS","LRGRANGES","C"))
"RTN","RORX021",146,0)
 . S RTAG=$$ADDVAL^RORTSK11(RORTSK,"LRGRANGES",,PARTAG)
"RTN","RORX021",147,0)
 . S RANGE=0,DESC=$$RTEXT^RORX019A(4,.RORDATA,.RORTSK) ;get range description
"RTN","RORX021",148,0)
 . S ELEMENT=$$ADDVAL^RORTSK11(RORTSK,"LRGRANGE",DESC,RTAG) ;add desc to output
"RTN","RORX021",149,0)
 . I ELEMENT<0 S RC=ELEMENT Q
"RTN","RORX021",150,0)
 . D ADDATTR^RORTSK11(RORTSK,ELEMENT,"ID",4)
"RTN","RORX021",151,0)
 . ;--- Process the range values
"RTN","RORX021",152,0)
 . S TMP=$G(@NODE@(4,"L"))
"RTN","RORX021",153,0)
 . I TMP'="" D  S RANGE=1
"RTN","RORX021",154,0)
 .. D ADDATTR^RORTSK11(RORTSK,ELEMENT,"LOW",TMP) S RORDATA("RANGE",4)=1
"RTN","RORX021",155,0)
 .. S TMP=$G(@NODE@(4,"H"))
"RTN","RORX021",156,0)
 .. I TMP'="" D  S RANGE=1
"RTN","RORX021",157,0)
 ... D ADDATTR^RORTSK11(RORTSK,ELEMENT,"HIGH",TMP) S RORDATA("RANGE",4)=1
"RTN","RORX021",158,0)
 .. I RANGE D ADDATTR^RORTSK11(RORTSK,ELEMENT,"RANGE",1)
"RTN","RORX021",159,0)
 Q RC
"RTN","RORX021",160,0)
 ;
"RTN","RORX021A")
0^42^B172044491^B151761658
"RTN","RORX021A",1,0)
RORX021A ;BPOIFO/CLR - HCV DAA CANDIDATES(QUERY & STORE) ;7/15/11 3:37pm
"RTN","RORX021A",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**17,19,21,27,26,31**;Feb 17, 2006;Build 62
"RTN","RORX021A",3,0)
 ;
"RTN","RORX021A",4,0)
 ; This routine uses the following IAs:
"RTN","RORX021A",5,0)
 ;
"RTN","RORX021A",6,0)
 ; #10103 FMADD^XLFDT (supported)
"RTN","RORX021A",7,0)
 ; #10035 Direct read of the DOD field of the file #2 (supported)
"RTN","RORX021A",8,0)
 ; #10000 C^%DTC (supported)
"RTN","RORX021A",9,0)
 ; #10103 $$TRIM^XLFSTR (supported)
"RTN","RORX021A",10,0)
 ; #10103 $$UP^XLFSTR (supported)
"RTN","RORX021A",11,0)
 ;   
"RTN","RORX021A",12,0)
 ;******************************************************************************
"RTN","RORX021A",13,0)
 ;******************************************************************************
"RTN","RORX021A",14,0)
 ;                 --- ROUTINE MODIFICATION LOG ---
"RTN","RORX021A",15,0)
 ;        
"RTN","RORX021A",16,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORX021A",17,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","RORX021A",18,0)
 ;ROR*1.5*19   JUN  2012   K GUPTA      Support for ICD-10 Coding System
"RTN","RORX021A",19,0)
 ;ROR*1.5*21   SEP 2013    T KOPP       Added ICN as last report column if
"RTN","RORX021A",20,0)
 ;                                      additional identifier option selected
"RTN","RORX021A",21,0)
 ;ROR*1.5*27   FEB 2015    T KOPP       Remove requirement to skip patient in
"RTN","RORX021A",22,0)
 ;                                      report if they received Boceprevir or
"RTN","RORX021A",23,0)
 ;                                      Telaprevir, removed requirement that
"RTN","RORX021A",24,0)
 ;                                      only genotype 1 is included on the
"RTN","RORX021A",25,0)
 ;                                      report.
"RTN","RORX021A",26,0)
 ;ROR*1.5*26   MAR 2015    T KOPP       Added FIB-4 as report column if FIB-4
"RTN","RORX021A",27,0)
 ;                                      range option selected (STORE), calculate
"RTN","RORX021A",28,0)
 ;                                      FIB-4 score if parameter selected. 
"RTN","RORX021A",29,0)
 ;                                      Remove treatment status column. 
"RTN","RORX021A",30,0)
 ;ROR*1.5*31   MAY 2017    M FERRARESE  Adding PACT ,PCP,and AGE/DOB as additional
"RTN","RORX021A",31,0)
 ;                                      identifiers.       
"RTN","RORX021A",32,0)
 ;******************************************************************************
"RTN","RORX021A",33,0)
 ;******************************************************************************
"RTN","RORX021A",34,0)
 Q
"RTN","RORX021A",35,0)
 ;
"RTN","RORX021A",36,0)
 ;***** LAB SEARCH CALLBACK
"RTN","RORX021A",37,0)
 ;
"RTN","RORX021A",38,0)
 ; .ROR8DST      Reference to the ROR8DST parameter.
"RTN","RORX021A",39,0)
 ;
"RTN","RORX021A",40,0)
 ; INVDT         IEN of the Lab test (inverted date)
"RTN","RORX021A",41,0)
 ;
"RTN","RORX021A",42,0)
 ; .RESULT       Reference to a local variable, which contains
"RTN","RORX021A",43,0)
 ;               the result (see the $$LTSEARCH^RORUTL10).
"RTN","RORX021A",44,0)
 ;
"RTN","RORX021A",45,0)
 ; Return Values:
"RTN","RORX021A",46,0)
 ;       <0  Error code (the search will be aborted)
"RTN","RORX021A",47,0)
 ;        0  Ok
"RTN","RORX021A",48,0)
 ;        1  Skip this result
"RTN","RORX021A",49,0)
 ;        2  Skip this and all remaining results
"RTN","RORX021A",50,0)
 ;
"RTN","RORX021A",51,0)
LTSCB(ROR8DST,INVDT,RESULT) ;
"RTN","RORX021A",52,0)
 N DATE,IEN,NAME,RC,TMP,VAL,CAT,SUB
"RTN","RORX021A",53,0)
 S IEN=+RESULT(2)           Q:IEN'>0 1   ; IEN of the Lab test
"RTN","RORX021A",54,0)
 S NAME=$P(RESULT(2),U,2)   Q:NAME="" 1  ; Name of the test
"RTN","RORX021A",55,0)
 S DATE=+$P(RESULT(1),U,1)  Q:DATE'>0 1  ; Date of the test
"RTN","RORX021A",56,0)
 S CAT=$P(RESULT(2),U,4)    Q:CAT="" 1   ; Category(lab group) of the test
"RTN","RORX021A",57,0)
 S VAL=$P(RESULT(1),U,3)    Q:VAL="" 1   ; Result of the test
"RTN","RORX021A",58,0)
 ;--- Skip if test is not in lab groups HepC GT, Quant, or Qual
"RTN","RORX021A",59,0)
 I CAT'="HepC GT",(CAT'="HepC Quant"),(CAT'="HepC Qual") Q 1
"RTN","RORX021A",60,0)
 ;=== Mark values as quantitative, qualitative or responded to treatment
"RTN","RORX021A",61,0)
 ;---  HCVQT=quant,HCVQL=qual,HCVOK=cured
"RTN","RORX021A",62,0)
 I CAT="HepC Quant"!(CAT="HepC Qual") D  Q:TMP 1
"RTN","RORX021A",63,0)
 . S TMP=0
"RTN","RORX021A",64,0)
 . S VAL=$$UP^XLFSTR(VAL)  ;convert to upper case
"RTN","RORX021A",65,0)
 . S VAL=$TR(VAL," ")  ;strip out all spaces
"RTN","RORX021A",66,0)
 . I VAL["POS" S SUB="HCVQL" Q
"RTN","RORX021A",67,0)
 . I $E(VAL,1,1)="P" S SUB="HCVQL" Q
"RTN","RORX021A",68,0)
 . I VAL["NEG" S SUB="HCVOK" Q
"RTN","RORX021A",69,0)
 . I VAL["NO" S SUB="HCVOK" Q
"RTN","RORX021A",70,0)
 . I $E(VAL,1,1)="N" S SUB="HCVOK" Q
"RTN","RORX021A",71,0)
 . I VAL["COMMENT"!(VAL["CANC")!(VAL["DNR")!(VAL["TNP") S TMP=1 Q
"RTN","RORX021A",72,0)
 . I +VAL=VAL,VAL<51 S TMP=1 Q  ;skip abnormally low values
"RTN","RORX021A",73,0)
 . I $$NUMERIC^RORUTL05($TR(VAL," >,GT")) S SUB="HCVQT" Q
"RTN","RORX021A",74,0)
 . I $$NUMERIC^RORUTL05($TR(VAL," <,LT")) S SUB="HCVOK" Q
"RTN","RORX021A",75,0)
 . S TMP=1
"RTN","RORX021A",76,0)
 S SUB=$S(CAT="HepC GT":"GT",1:SUB)
"RTN","RORX021A",77,0)
 ;--- Store the result
"RTN","RORX021A",78,0)
 S @ROR8DST@(SUB,DATE)=$P(RESULT(1),U,3)
"RTN","RORX021A",79,0)
 Q 0
"RTN","RORX021A",80,0)
 ;
"RTN","RORX021A",81,0)
 ;***** QUERIES THE REGISTRY
"RTN","RORX021A",82,0)
 ; REPORT        Parent IEN of report
"RTN","RORX021A",83,0)
 ; FLAGS         Flags for the $$SKIP^RORXU005
"RTN","RORX021A",84,0)
 ; .NSPT         Number of selected patients is returned here
"RTN","RORX021A",85,0)
 ; .RORLC        sub-file and LOINC codes to search for FIB4
"RTN","RORX021A",86,0)
 ;
"RTN","RORX021A",87,0)
 ; Return Values:
"RTN","RORX021A",88,0)
 ;       <0  Fatal error
"RTN","RORX021A",89,0)
 ;        0  Ok
"RTN","RORX021A",90,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX021A",91,0)
 ;
"RTN","RORX021A",92,0)
QUERY(REPORT,FLAGS,NSPT,RORLC) ;
"RTN","RORX021A",93,0)
 N RORLDST       ; Descriptor for Lab search API
"RTN","RORX021A",94,0)
 N RORPTN        ; Number of patients in the registry
"RTN","RORX021A",95,0)
 N RORXDST       ; Descriptor for pharmacy search API
"RTN","RORX021A",96,0)
 N RORCDLIST     ; Flag to indicate whether a clinic or division list exists
"RTN","RORX021A",97,0)
 N RORCDSTDT     ; Start date for clinic/division utilization search
"RTN","RORX021A",98,0)
 N RORCDENDT     ; End date for clinic/division utilization search
"RTN","RORX021A",99,0)
 N RORXCDT       ; User selected cut off date for registry meds
"RTN","RORX021A",100,0)
 N RORTS         ; User selected treatment status categories
"RTN","RORX021A",101,0)
 N RORXEDT       ; RX end date
"RTN","RORX021A",102,0)
 N RORXSDT       ; RX start date
"RTN","RORX021A",103,0)
 N RORTH         ; Patient treatment status (EXP=experienced, NAIVE=naive)
"RTN","RORX021A",104,0)
 ;
"RTN","RORX021A",105,0)
 N CNT,ECNT,IEN,IENS,LTEDT,LTSDT,PATIEN,RC,RXEDT,SKIP,TMP,UTEDT,UTIL,UTSDT,VA,VADM,XREFNODE
"RTN","RORX021A",106,0)
 N RCC,FLAG,HCV,GT,ROR1,ROR2,ROR3
"RTN","RORX021A",107,0)
 S XREFNODE=$NA(^RORDATA(798,"AC",+RORREG))
"RTN","RORX021A",108,0)
 S (CNT,ECNT,NSPT,RC)=0,(UTEDT,UTSDT)=0
"RTN","RORX021A",109,0)
 ;=== Set up parameters
"RTN","RORX021A",110,0)
 ;--- Utilization date range
"RTN","RORX021A",111,0)
 D:$$PARAM^RORTSK01("PATIENTS","CAREONLY")
"RTN","RORX021A",112,0)
 . S UTSDT=$$PARAM^RORTSK01("DATE_RANGE_3","START")\1
"RTN","RORX021A",113,0)
 . S UTEDT=$$PARAM^RORTSK01("DATE_RANGE_3","END")\1
"RTN","RORX021A",114,0)
 ;--- Number of patients in the registry
"RTN","RORX021A",115,0)
 S RORPTN=$$REGSIZE^RORUTL02(+RORREG)  S:RORPTN<0 RORPTN=0
"RTN","RORX021A",116,0)
 ;--- Set up Treatment status parameters
"RTN","RORX021A",117,0)
 F TMP="NAIVE","EXP","EXP_DAYS" D
"RTN","RORX021A",118,0)
 . S RORTS(TMP)=$$PARAM^RORTSK01("TREATMENT_HISTORY",TMP)
"RTN","RORX021A",119,0)
 ;--- Lab parameters
"RTN","RORX021A",120,0)
 S RORLDST("RORCB")="$$LTSCB^RORX021A"
"RTN","RORX021A",121,0)
 ;--- Labs date range
"RTN","RORX021A",122,0)
 S LTSDT=""
"RTN","RORX021A",123,0)
 S LTEDT=DT
"RTN","RORX021A",124,0)
 ;--- Shift the Labs end date
"RTN","RORX021A",125,0)
 S LTEDT=$$FMADD^XLFDT(LTEDT,1)
"RTN","RORX021A",126,0)
 ;== Pharm parameters
"RTN","RORX021A",127,0)
 S RORXDST("GENERIC")=1  ;only meds with generic name
"RTN","RORX021A",128,0)
 S RORXDST("RORCB")="$$RXOCB^RORX021A"   ;call back routine
"RTN","RORX021A",129,0)
 ;--- RX cut off date (inverse)/shift cut off back one day
"RTN","RORX021A",130,0)
 N X1,X2,X S X2=-(+RORTS("EXP_DAYS")+1),X1=DT D C^%DTC S RORXCDT=99999999-X
"RTN","RORX021A",131,0)
 ;--- RX start and end dates
"RTN","RORX021A",132,0)
 S RORXSDT=2000101  ;start date 1/1/1900
"RTN","RORX021A",133,0)
 S RORXEDT=DT
"RTN","RORX021A",134,0)
 ;--- RX list of HepC registry drugs
"RTN","RORX021A",135,0)
 S RORXL=$$ALLOC^RORTMP()
"RTN","RORX021A",136,0)
 S RC=$$DRUGLIST^RORUTL16(RORXL,+RORREG)
"RTN","RORX021A",137,0)
 ;--- Shift the Labs end date
"RTN","RORX021A",138,0)
 S RORXEDT=$$FMADD^XLFDT(RORXEDT\1,1)
"RTN","RORX021A",139,0)
 ;--- Set up Clinic/Division list parameters date_range_3
"RTN","RORX021A",140,0)
 S RORCDLIST=$$CDPARMS^RORXU001(.RORTSK,.RORCDSTDT,.RORCDENDT,1)
"RTN","RORX021A",141,0)
 ;--- Set up ICD parameters
"RTN","RORX021A",142,0)
 S FLAG=$G(RORTSK("PARAMS","ICDFILT","A","FILTER"))
"RTN","RORX021A",143,0)
 ;=== Browse through the registry records
"RTN","RORX021A",144,0)
 S IEN=0
"RTN","RORX021A",145,0)
 F  S IEN=$O(@XREFNODE@(IEN))  Q:IEN'>0  D  Q:RC<0
"RTN","RORX021A",146,0)
 . S TMP=$S(RORPTN>0:CNT/RORPTN,1:"")
"RTN","RORX021A",147,0)
 . S RC=$$LOOP^RORTSK01(TMP)  Q:RC<0
"RTN","RORX021A",148,0)
 . S IENS=IEN_",",CNT=CNT+1
"RTN","RORX021A",149,0)
 . ;--- Get patient DFN
"RTN","RORX021A",150,0)
 . S PATIEN=$$PTIEN^RORUTL01(IEN)  Q:PATIEN'>0
"RTN","RORX021A",151,0)
 . I +$P($G(^DPT(PATIEN,.35)),U)>0 Q  ;patient has died
"RTN","RORX021A",152,0)
 . ;--- Check if the patient should be skipped based on standard filters
"RTN","RORX021A",153,0)
 . Q:$$SKIP^RORXU005(IEN,FLAGS,UTSDT,UTEDT)
"RTN","RORX021A",154,0)
 . ;--- Check if patient should be skipped because of ICD codes
"RTN","RORX021A",155,0)
 . S RCC=0
"RTN","RORX021A",156,0)
 . I FLAG'="ALL" D
"RTN","RORX021A",157,0)
 . . S RCC=$$ICD^RORXU010(PATIEN)
"RTN","RORX021A",158,0)
 . I (FLAG="INCLUDE")&(RCC=0) Q
"RTN","RORX021A",159,0)
 . I (FLAG="EXCLUDE")&(RCC=1) Q
"RTN","RORX021A",160,0)
 . ;
"RTN","RORX021A",161,0)
 . ;--- Check if patient should be skipped because of Clinic or Division 
"RTN","RORX021A",162,0)
 . I RORCDLIST,'$$CDUTIL^RORXU001(.RORTSK,PATIEN,RORCDSTDT,RORCDENDT) Q
"RTN","RORX021A",163,0)
 . ;=== Check labs and meds
"RTN","RORX021A",164,0)
 . S SKIP=1,UTIL=0
"RTN","RORX021A",165,0)
 . D  I RC<0  S ECNT=ECNT+1,RC=0  Q
"RTN","RORX021A",166,0)
 . . S RORLDST=$NA(^TMP("RORX021",$J,"PAT",PATIEN,"LR"))
"RTN","RORX021A",167,0)
 . . S RC=$$LTSEARCH^RORUTL10(PATIEN,+RORREG,.RORLDST,,LTSDT,LTEDT)
"RTN","RORX021A",168,0)
 . . Q:RC'>0
"RTN","RORX021A",169,0)
 . . ;=== Skip if patient no longer has HCV
"RTN","RORX021A",170,0)
 . . S ROR1=+$O(@RORLDST@("HCVOK","")),ROR2=+$O(@RORLDST@("HCVQL","")),ROR3=(+$O(@RORLDST@("HCVQT","")))
"RTN","RORX021A",171,0)
 . . I ROR1>0 D  Q:SKIP=1
"RTN","RORX021A",172,0)
 . . . ;--- Skip if date of most recent HCV test is normal
"RTN","RORX021A",173,0)
 . . . I (ROR1<ROR2),(ROR1<ROR3) S SKIP=1 Q
"RTN","RORX021A",174,0)
 . . . I (ROR1<ROR2),(ROR3=0) S SKIP=1 Q
"RTN","RORX021A",175,0)
 . . . I (ROR1<ROR3),(ROR2=0) S SKIP=1 Q
"RTN","RORX021A",176,0)
 . . . ;--- Skip if no qual or quant test
"RTN","RORX021A",177,0)
 . . . I ROR2+ROR3=0 S SKIP=1 Q
"RTN","RORX021A",178,0)
 . . . S SKIP=0
"RTN","RORX021A",179,0)
 . . ;--- Check if patient should be skipped because of user selected Treatment status
"RTN","RORX021A",180,0)
 . . S RORXDST=$NA(^TMP("RORX021",$J,"PAT",PATIEN,"RX"))
"RTN","RORX021A",181,0)
 . . S RC=$$RXSEARCH^RORUTL14(PATIEN,RORXL,.RORXDST,"EIOV",RORXSDT,RORXEDT)
"RTN","RORX021A",182,0)
 . . Q:RC<0  ;error occurred
"RTN","RORX021A",183,0)
 . . I $G(RORXDST("SKIP")) S SKIP=1 K RORXDST("SKIP") Q  ;skip if taking DAA meds
"RTN","RORX021A",184,0)
 . . I RC>0,'+RORTS("EXP") S SKIP=1 Q  ; skip naive patients 
"RTN","RORX021A",185,0)
 . . I RC=0,'+RORTS("NAIVE") S SKIP=1 Q  ;skip experienced patients
"RTN","RORX021A",186,0)
 . . I RC>0,$O(@RORXDST@(RORXCDT),-1) S SKIP=1 Q  ;skip if patient has meds after cutoff
"RTN","RORX021A",187,0)
 . . ;--- Include patient 
"RTN","RORX021A",188,0)
 . . S RORTH=$S(RC>0:"EXP",RC=0:"NAIVE",1:"")
"RTN","RORX021A",189,0)
 . . S SKIP=0
"RTN","RORX021A",190,0)
 . ;--- Check if patient should be skipped because no utilization in the corresponding date range
"RTN","RORX021A",191,0)
 . I 'SKIP D:$$PARAM^RORTSK01("PATIENTS","CAREONLY")
"RTN","RORX021A",192,0)
 . . K TMP  S TMP("ALL")=1
"RTN","RORX021A",193,0)
 . . S UTIL=+$$UTIL^RORXU003(UTSDT,UTEDT,PATIEN,.TMP)
"RTN","RORX021A",194,0)
 . . S:'UTIL SKIP=1
"RTN","RORX021A",195,0)
 . ;
"RTN","RORX021A",196,0)
 . ; Skip patient if FIB4 range has been selected and score does not match parameters
"RTN","RORX021A",197,0)
 . I 'SKIP,$G(RORDATA("IDLST")) D
"RTN","RORX021A",198,0)
 . . N OK
"RTN","RORX021A",199,0)
 . . S OK=$$CALCFIB^RORX019A(PATIEN,"",.RORDATA,IEN,.RORLC)
"RTN","RORX021A",200,0)
 . . I OK<0 S SKIP=1 Q
"RTN","RORX021A",201,0)
 . . I '$$INRANGE^RORX019(.RORDATA) S SKIP=1 Q  ;exclude patient from report if ANY score is out of range
"RTN","RORX021A",202,0)
 . . I '$$SKIP^RORX019(.RORDATA) S SKIP=1  ;exclude patient from report with null scores
"RTN","RORX021A",203,0)
 . ;--- Skip the patient if not all selection criteria have been met
"RTN","RORX021A",204,0)
 . I SKIP K ^TMP("RORX021",$J,"PAT",PATIEN)  Q
"RTN","RORX021A",205,0)
 . ;
"RTN","RORX021A",206,0)
 . ;--- Get and store the patient's data  last4^name^treatment status^ICN^FIB-4 score^PACT^PCP^AGE/DOB
"RTN","RORX021A",207,0)
 . D VADEM^RORUTL05(PATIEN,1)
"RTN","RORX021A",208,0)
 . S TMP=$S($$PARAM^RORTSK01("PATIENTS","ICN"):$$ICN^RORUTL02(PATIEN),1:"")
"RTN","RORX021A",209,0)
 . S ^TMP("RORX021",$J,"PAT",PATIEN)=VA("BID")_U_VADM(1)_U_RORTH_U_TMP_U_$G(RORDATA("SCORE",4))
"RTN","RORX021A",210,0)
 . S AGETYPE=$$PARAM^RORTSK01("AGE_RANGE","TYPE") D
"RTN","RORX021A",211,0)
 . . S AGE=$S(AGETYPE="AGE":$P(VADM(4),U),AGETYPE="DOB":$$DATE^RORXU002($P(VADM(3),U)\1),1:"")
"RTN","RORX021A",212,0)
 . S TMP=$S($$PARAM^RORTSK01("PATIENTS","PACT"):$$PACT^RORUTL02(PATIEN),1:"")
"RTN","RORX021A",213,0)
 . S ^TMP("RORX021",$J,"PAT",PATIEN)=^TMP("RORX021",$J,"PAT",PATIEN)_U_TMP
"RTN","RORX021A",214,0)
 . S TMP=$S($$PARAM^RORTSK01("PATIENTS","PCP"):$$PCP^RORUTL02(PATIEN),1:"")
"RTN","RORX021A",215,0)
 . S ^TMP("RORX021",$J,"PAT",PATIEN)=^TMP("RORX021",$J,"PAT",PATIEN)_U_TMP_U_AGE
"RTN","RORX021A",216,0)
 . S NSPT=NSPT+1   ;increment count of selected patients
"RTN","RORX021A",217,0)
 ;
"RTN","RORX021A",218,0)
 D FREE^RORTMP(RORXL)  ;clean up drug list
"RTN","RORX021A",219,0)
 Q $S(RC<0:RC,1:ECNT)
"RTN","RORX021A",220,0)
 ;
"RTN","RORX021A",221,0)
 ;***** CALLBACK FUNCTION FOR THE PHARMACY SEARCH API
"RTN","RORX021A",222,0)
 ;
"RTN","RORX021A",223,0)
 ;
"RTN","RORX021A",224,0)
 ;                .ROR8DST      Reference to the ROR8DST parameter.
"RTN","RORX021A",225,0)
 ;
"RTN","RORX021A",226,0)
 ;
"RTN","RORX021A",227,0)
 ;                 ORDER         Order number (from condensed list)
"RTN","RORX021A",228,0)
 ;
"RTN","RORX021A",229,0)
 ;                 FLAGS         Flags describing the order to be
"RTN","RORX021A",230,0)
 ;                               processed.
"RTN","RORX021A",231,0)
 ;
"RTN","RORX021A",232,0)
 ;                 DRUG          Dispensed drug
"RTN","RORX021A",233,0)
 ;                                 ^01: Drug IEN in file #50
"RTN","RORX021A",234,0)
 ;                                 ^02: Drug name
"RTN","RORX021A",235,0)
 ;
"RTN","RORX021A",236,0)
 ;                 DATE          Order date (issue date for outpatient
"RTN","RORX021A",237,0)
 ;                               drugs or start date for inpatient)
"RTN","RORX021A",238,0)
 ;
"RTN","RORX021A",239,0)
 ;Return Values:
"RTN","RORX021A",240,0)
 ;       <0  Error code (the search will be aborted)
"RTN","RORX021A",241,0)
 ;        0  Ok
"RTN","RORX021A",242,0)
 ;        1  Skip this result
"RTN","RORX021A",243,0)
 ;        2  Skip this and all remaining results
"RTN","RORX021A",244,0)
 ;
"RTN","RORX021A",245,0)
RXOCB(ROR8DST,ORDER,ORDFLG,DRUG,DATE) ;
"RTN","RORX021A",246,0)
 N DRUGIEN,DRUGNAME,IEN,IRP,OFD,RPSUB,RXBUF,RXCNT,RXNUM,TMP
"RTN","RORX021A",247,0)
 ;--- Skip med if med does not have a generic name
"RTN","RORX021A",248,0)
 I ROR8DST("GENERIC")  D
"RTN","RORX021A",249,0)
 . S DRUGIEN=+ROR8DST("RORXGEN"),DRUGNAME=$P(ROR8DST("RORXGEN"),U,2)
"RTN","RORX021A",250,0)
 E  Q 1
"RTN","RORX021A",251,0)
 Q:(DRUGIEN'>0)!(DRUGNAME="") 1
"RTN","RORX021A",252,0)
 ;--- Process the order
"RTN","RORX021A",253,0)
 S TMP=$G(^TMP("PS",$J,"RXN",0))
"RTN","RORX021A",254,0)
 S RXNUM=$P(TMP,U)  S:RXNUM="" RXNUM=" "
"RTN","RORX021A",255,0)
 S RXCNT=0
"RTN","RORX021A",256,0)
 ;--- Original prescription
"RTN","RORX021A",257,0)
 I ORDFLG["I"  D  ;--- Inpatient
"RTN","RORX021A",258,0)
 . S OFD=$P($G(^TMP("PS",$J,0)),U,5)         ; Start Date
"RTN","RORX021A",259,0)
 . S RXCNT=RXCNT+1
"RTN","RORX021A",260,0)
 . S @ROR8DST@((99999999-OFD),DRUGNAME,DRUGIEN,RXNUM,RXCNT)=""
"RTN","RORX021A",261,0)
 E  D             ;--- Outpatient
"RTN","RORX021A",262,0)
 . S OFD=+$P($G(^TMP("PS",$J,"RXN",0)),U,6)  ; Original Fill Date
"RTN","RORX021A",263,0)
 . Q:(OFD<ROR8DST("RORSDT"))!(OFD'<ROR8DST("ROREDT"))
"RTN","RORX021A",264,0)
 . S RXCNT=RXCNT+1
"RTN","RORX021A",265,0)
 . S @ROR8DST@((99999999-OFD),DRUGNAME,DRUGIEN,RXNUM,RXCNT)=""
"RTN","RORX021A",266,0)
 ;--- Refills and partials
"RTN","RORX021A",267,0)
 F RPSUB="REF","PAR"  D
"RTN","RORX021A",268,0)
 . S $P(RXBUF,U)=$E(RPSUB,1)
"RTN","RORX021A",269,0)
 . S IRP=0
"RTN","RORX021A",270,0)
 . F  S IRP=$O(^TMP("PS",$J,RPSUB,IRP))  Q:IRP'>0  D
"RTN","RORX021A",271,0)
 . . S TMP=$G(^TMP("PS",$J,RPSUB,IRP,0))
"RTN","RORX021A",272,0)
 . . I TMP>0  S RXCNT=RXCNT+1,TMP=99999999-TMP  D
"RTN","RORX021A",273,0)
 . . . S @ROR8DST@(+TMP,DRUGNAME,DRUGIEN,RXNUM,RXCNT)=""
"RTN","RORX021A",274,0)
 Q 0
"RTN","RORX021A",275,0)
 ;***** STORES THE REPORT DATA
"RTN","RORX021A",276,0)
 ;
"RTN","RORX021A",277,0)
 ; REPORT        IEN of the REPORT element
"RTN","RORX021A",278,0)
 ; NSPT          Number of selected patients
"RTN","RORX021A",279,0)
 ;
"RTN","RORX021A",280,0)
 ; Return Values:
"RTN","RORX021A",281,0)
 ;       <0  Error code
"RTN","RORX021A",282,0)
 ;        0  Ok
"RTN","RORX021A",283,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX021A",284,0)
 ;
"RTN","RORX021A",285,0)
STORE(REPORT,NSPT) ;
"RTN","RORX021A",286,0)
 N RORFDT        ;med fill date
"RTN","RORX021A",287,0)
 N RORLBG        ;lab test type (GT, HCVQT,HCVQL)
"RTN","RORX021A",288,0)
 N RORLVAL       ;lab value
"RTN","RORX021A",289,0)
 N RORRX         ;med name
"RTN","RORX021A",290,0)
 N RORSTNAM      ;
"RTN","RORX021A",291,0)
 N RORLDST
"RTN","RORX021A",292,0)
 N RORXDST
"RTN","RORX021A",293,0)
 N RORICN
"RTN","RORX021A",294,0)
 N RORFIB4
"RTN","RORX021A",295,0)
 N RORPACT
"RTN","RORX021A",296,0)
 N RORPCP
"RTN","RORX021A",297,0)
 N RORBODY,PTAG  ;parent iens
"RTN","RORX021A",298,0)
 N CNT,DATE,DFN,ECNT,IEN,LAST4,LTLST,NAME,NODE,PTCNT,PTLST,PTNAME,RC,RXLST,TMP,VAL,THIST,AGE,AGETYPE
"RTN","RORX021A",299,0)
 N GT,HCVQT,HCV,HCVQL
"RTN","RORX021A",300,0)
 S (ECNT,RC)=0,(LTLST,PTLST,RXLST)=-1
"RTN","RORX021A",301,0)
 ;--- Create 'patients' table
"RTN","RORX021A",302,0)
 S RORBODY=$$ADDVAL^RORTSK11(RORTSK,"PATIENTS",,REPORT)
"RTN","RORX021A",303,0)
 D ADDATTR^RORTSK11(RORTSK,RORBODY,"TABLE","PATIENTS")
"RTN","RORX021A",304,0)
 S (CNT,DFN,PTCNT)=0
"RTN","RORX021A",305,0)
 F  S DFN=$O(^TMP("RORX021",$J,"PAT",DFN))  Q:DFN'>0  D  Q:RC<0
"RTN","RORX021A",306,0)
 . S TMP=$S(NSPT>0:CNT/NSPT,1:"")
"RTN","RORX021A",307,0)
 . S RC=$$LOOP^RORTSK01(TMP)  Q:RC<0
"RTN","RORX021A",308,0)
 . S CNT=CNT+1,NODE=$NA(^TMP("RORX021",$J,"PAT",DFN))
"RTN","RORX021A",309,0)
 . ;--- Patient's data
"RTN","RORX021A",310,0)
 . S TMP=$G(@NODE)
"RTN","RORX021A",311,0)
 . S LAST4=$P(TMP,U),PTNAME=$P(TMP,U,2),THIST=$P(TMP,U,3),RORICN=$P(TMP,U,4),RORFIB4=$P(TMP,U,5)
"RTN","RORX021A",312,0)
 . S RORPACT=$P(TMP,U,6),RORPCP=$P(TMP,U,7),AGE=$P(TMP,U,8)
"RTN","RORX021A",313,0)
 . ;--- get lab results
"RTN","RORX021A",314,0)
 . S RORLDST=$NA(^TMP("RORX021",$J,"PAT",DFN,"LR"))
"RTN","RORX021A",315,0)
 . S RORXDST=$NA(^TMP("RORX021",$J,"PAT",DFN,"RX"))
"RTN","RORX021A",316,0)
 . ;--- Gets most recent result for HepC Qual, HepC Quant and GT
"RTN","RORX021A",317,0)
 . ;    HCVQT=date of most recent quanitative test^result
"RTN","RORX021A",318,0)
 . ;    HCVQL=date of most recent qualitative test^result
"RTN","RORX021A",319,0)
 . ;    GT=date of most recent GT test^result
"RTN","RORX021A",320,0)
 . K HCVQT,HCVQL,GT
"RTN","RORX021A",321,0)
 . F RORLBG="HCVQT","HCVQL","GT" D
"RTN","RORX021A",322,0)
 . . S NODE=RORLBG,@NODE="^"
"RTN","RORX021A",323,0)
 . . S RORFDT=$O(@RORLDST@(RORLBG,""))
"RTN","RORX021A",324,0)
 . . Q:RORFDT=""
"RTN","RORX021A",325,0)
 . . S RORLVAL=$G(@RORLDST@(RORLBG,RORFDT))
"RTN","RORX021A",326,0)
 . . S RORFDT=9999999-RORFDT
"RTN","RORX021A",327,0)
 . . S RORFDT=RORFDT\1  ;strip time  
"RTN","RORX021A",328,0)
 . . S @NODE=(RORFDT)_U_RORLVAL
"RTN","RORX021A",329,0)
 . ;--- get most recent registry med if experienced
"RTN","RORX021A",330,0)
 . ;--- if more than one med give preference to INTERFERON
"RTN","RORX021A",331,0)
 . S RORFDT=$O(@RORXDST@("")),RORRX=""
"RTN","RORX021A",332,0)
 . I THIST="EXP" D
"RTN","RORX021A",333,0)
 . . S RORSTNAM="",RORRX=""
"RTN","RORX021A",334,0)
 . . F  S RORSTNAM=$O(@RORXDST@(RORFDT,RORSTNAM)) Q:RORSTNAM=""  D
"RTN","RORX021A",335,0)
 . . . S RORRX=$S(RORRX="":RORSTNAM,RORRX["INTERFERON":RORRX,1:RORSTNAM)
"RTN","RORX021A",336,0)
 . . S RORFDT=99999999-RORFDT
"RTN","RORX021A",337,0)
 . . S RORFDT=RORFDT\1
"RTN","RORX021A",338,0)
 . S PTAG=$$ADDVAL^RORTSK11(RORTSK,"PATIENT",,RORBODY,,DFN)
"RTN","RORX021A",339,0)
 . ;--- give preference to quant result over qual result
"RTN","RORX021A",340,0)
 . S HCV=$S(+$G(HCVQL)>+$G(HCVQT):HCVQL,$G(HCVQT):HCVQT,1:"")
"RTN","RORX021A",341,0)
 . ;--- store
"RTN","RORX021A",342,0)
 . D ADDVAL^RORTSK11(RORTSK,"NAME",PTNAME,PTAG,1)
"RTN","RORX021A",343,0)
 . D ADDVAL^RORTSK11(RORTSK,"LAST4",LAST4,PTAG,2)
"RTN","RORX021A",344,0)
 . S AGETYPE=$$PARAM^RORTSK01("AGE_RANGE","TYPE") I AGETYPE'="ALL" D
"RTN","RORX021A",345,0)
 . . D ADDVAL^RORTSK11(RORTSK,AGETYPE,AGE,PTAG,1)
"RTN","RORX021A",346,0)
 . ; I $G(RORDATA("LIST"))'["4" D ADDVAL^RORTSK11(RORTSK,"STATUS",THIST,PTAG,1)
"RTN","RORX021A",347,0)
 . D ADDVAL^RORTSK11(RORTSK,"HCV_DATE",$P(HCV,U),PTAG,1)
"RTN","RORX021A",348,0)
 . D ADDVAL^RORTSK11(RORTSK,"HCV",$P(HCV,U,2),PTAG,3)
"RTN","RORX021A",349,0)
 . D ADDVAL^RORTSK11(RORTSK,"GT",$P(GT,U,2),PTAG,1)
"RTN","RORX021A",350,0)
 . D ADDVAL^RORTSK11(RORTSK,"FILL_DATE",RORFDT,PTAG,1)
"RTN","RORX021A",351,0)
 . D ADDVAL^RORTSK11(RORTSK,"FILL_MED",RORRX,PTAG,1)
"RTN","RORX021A",352,0)
 . I $G(RORDATA("IDLST"))'="" D
"RTN","RORX021A",353,0)
 . . S:RORDATA("IDLST")["4" TMP=$$ADDVAL^RORTSK11(RORTSK,"FIB4",RORFIB4,PTAG,3)
"RTN","RORX021A",354,0)
 . I $$PARAM^RORTSK01("PATIENTS","ICN") D ADDVAL^RORTSK11(RORTSK,"ICN",RORICN,PTAG,1)
"RTN","RORX021A",355,0)
 . I $$PARAM^RORTSK01("PATIENTS","PACT") D ADDVAL^RORTSK11(RORTSK,"PACT",RORPACT,PTAG,1)
"RTN","RORX021A",356,0)
 . I $$PARAM^RORTSK01("PATIENTS","PCP") D ADDVAL^RORTSK11(RORTSK,"PCP",RORPCP,PTAG,1)
"RTN","RORX021A",357,0)
 . S PTCNT=PTCNT+1
"RTN","RORX021A",358,0)
 ;--- Inactivate the patient list tag if the list is empty
"RTN","RORX021A",359,0)
 D:PTCNT'>0 UPDVAL^RORTSK11(RORTSK,PTLST,,,1)
"RTN","RORX021A",360,0)
 ;---
"RTN","RORX021A",361,0)
 Q ECNT
"RTN","RORX022")
0^43^B21237172^B15916471
"RTN","RORX022",1,0)
RORX022 ;BPOIFO/CLR - LAB DAA MONITOR REPORT ;4/9/09 9:40am
"RTN","RORX022",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**17,21,31**;Feb 17, 2006;Build 62
"RTN","RORX022",3,0)
 ;
"RTN","RORX022",4,0)
 ;******************************************************************************
"RTN","RORX022",5,0)
 ;******************************************************************************
"RTN","RORX022",6,0)
 ;                       --- ROUTINE MODIFICATION LOG ---
"RTN","RORX022",7,0)
 ;        
"RTN","RORX022",8,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORX022",9,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","RORX022",10,0)
 ;ROR*1.5*21   SEP 2013    T KOPP       Add ICN column if Additional Identifier
"RTN","RORX022",11,0)
 ;                                       requested.
"RTN","RORX022",12,0)
 ;ROR*1.5*31   MAY 2017    M FERRARESE  Adding PACT ,PCP,and AGE/DOB as additional
"RTN","RORX022",13,0)
 ;                                      identifiers.
"RTN","RORX022",14,0)
 ;******************************************************************************
"RTN","RORX022",15,0)
 ;******************************************************************************
"RTN","RORX022",16,0)
 ;
"RTN","RORX022",17,0)
 Q
"RTN","RORX022",18,0)
 ;
"RTN","RORX022",19,0)
 ;***** OUTPUTS THE REPORT HEADER
"RTN","RORX022",20,0)
 ;
"RTN","RORX022",21,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX022",22,0)
 ;
"RTN","RORX022",23,0)
 ; Return Values:
"RTN","RORX022",24,0)
 ;       <0  Error code
"RTN","RORX022",25,0)
 ;       >0  IEN of the HEADER element
"RTN","RORX022",26,0)
 ;
"RTN","RORX022",27,0)
HEADER(PARTAG) ;
"RTN","RORX022",28,0)
 ;;DRUGS(#,NAME,LAST4,DAA_FILL,FILL_DATE,RXNAME,DAYSPLY)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="ALL"
"RTN","RORX022",29,0)
 ;;DRUGS(#,NAME,LAST4,AGE,DAA_FILL,FILL_DATE,RXNAME,DAYSPLY)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="AGE"
"RTN","RORX022",30,0)
 ;;DRUGS(#,NAME,LAST4,DOB,DAA_FILL,FILL_DATE,RXNAME,DAYSPLY)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="DOB"
"RTN","RORX022",31,0)
 ;;LABTESTS(#,NAME,LAST4,DAA_FILL,DATE,LTNAME,RESULT,WKS_LAB)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="ALL"
"RTN","RORX022",32,0)
 ;;LABTESTS(#,NAME,LAST4,AGE,DAA_FILL,DATE,LTNAME,RESULT,WKS_LAB)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="AGE"
"RTN","RORX022",33,0)
 ;;LABTESTS(#,NAME,LAST4,DOB,DAA_FILL,DATE,LTNAME,RESULT,WKS_LAB)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="DOB"
"RTN","RORX022",34,0)
 ;;PATIENTS(#,NAME,LAST4,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="ALL"
"RTN","RORX022",35,0)
 ;;PATIENTS(#,NAME,LAST4,AGE,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="AGE"
"RTN","RORX022",36,0)
 ;;PATIENTS(#,NAME,LAST4,DOB,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="DOB"
"RTN","RORX022",37,0)
 ;
"RTN","RORX022",38,0)
 N HEADER,RC
"RTN","RORX022",39,0)
 S HEADER=$$HEADER^RORXU002(.RORTSK,PARTAG)
"RTN","RORX022",40,0)
 Q:HEADER<0 HEADER
"RTN","RORX022",41,0)
 S RC=$$TBLDEF^RORXU002("HEADER^RORX022",HEADER)
"RTN","RORX022",42,0)
 Q $S(RC<0:RC,1:HEADER)
"RTN","RORX022",43,0)
 ;
"RTN","RORX022",44,0)
 ;***** OUTPUTS THE PARAMETERS TO THE REPORT
"RTN","RORX022",45,0)
 ;
"RTN","RORX022",46,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX022",47,0)
 ;
"RTN","RORX022",48,0)
 ; [.STDT]       Start and end dates of the report
"RTN","RORX022",49,0)
 ; [.ENDT]       are returned via these parameters
"RTN","RORX022",50,0)
 ;
"RTN","RORX022",51,0)
 ; [.FLAGS]      Flags for the $$SKIP^RORXU005 are
"RTN","RORX022",52,0)
 ;               returned via this parameter
"RTN","RORX022",53,0)
 ;
"RTN","RORX022",54,0)
 ; Return Values:
"RTN","RORX022",55,0)
 ;       <0  Error code
"RTN","RORX022",56,0)
 ;       >0  IEN of the PARAMETERS element
"RTN","RORX022",57,0)
 ;
"RTN","RORX022",58,0)
PARAMS(PARTAG,STDT,ENDT,FLAGS) ;
"RTN","RORX022",59,0)
 N PARAMS,TMP,ELEMENT
"RTN","RORX022",60,0)
 S PARAMS=$$PARAMS^RORXU002(.RORTSK,PARTAG,.STDT,.ENDT,.FLAGS)
"RTN","RORX022",61,0)
 Q:PARAMS<0 PARAMS
"RTN","RORX022",62,0)
 ;report specific parameters
"RTN","RORX022",63,0)
 S ELEMENT=$$ADDVAL^RORTSK11(RORTSK,"WEEKS_AFTER",$$PARAM^RORTSK01("WEEKS_AFTER"),PARAMS)
"RTN","RORX022",64,0)
 Q:ELEMENT<0 ELEMENT
"RTN","RORX022",65,0)
 I $$PARAM^RORTSK01("WEEKS_AFTER","MOST_RECENT") D
"RTN","RORX022",66,0)
 . D ADDATTR^RORTSK11(RORTSK,ELEMENT,"MOST_RECENT",$$PARAM^RORTSK01("WEEKS_AFTER","MOST_RECENT"))
"RTN","RORX022",67,0)
 ;--- Process the list of Lab tests
"RTN","RORX022",68,0)
 D  Q:TMP<0 TMP
"RTN","RORX022",69,0)
 . S TMP=$$LTLST^RORXU006(.RORTSK,PARAMS,.RORLTST,"RORLTRV")
"RTN","RORX022",70,0)
 Q PARAMS
"RTN","RORX022",71,0)
 ;
"RTN","RORX022",72,0)
 ;
"RTN","RORX022",73,0)
 ;***** COMPILES THE "DAA LAB MONITOR" REPORT
"RTN","RORX022",74,0)
 ; REPORT CODE: 022
"RTN","RORX022",75,0)
 ;
"RTN","RORX022",76,0)
 ;INPUT
"RTN","RORX022",77,0)
 ;  .RORTSK     Task number and task parameters
"RTN","RORX022",78,0)
 ;
"RTN","RORX022",79,0)
 ;  Below is a sample RORTSK input array for utilization in 2003, most recent
"RTN","RORX022",80,0)
 ;  scores, BMI range from 30 to 45:
"RTN","RORX022",81,0)
 ;
"RTN","RORX022",82,0)
 ;  RORTSK=nnn   (task number)
"RTN","RORX022",83,0)
 ;  RORTSK("EP")="$$DAAMON^RORX022"
"RTN","RORX022",84,0)
 ;  RORTSK("PARAMS","DATE_RANGE_3","A","END")=3031231
"RTN","RORX022",85,0)
 ;  RORTSK("PARAMS","DATE_RANGE_3","A","START")=3030101
"RTN","RORX022",86,0)
 ;  RORTSK("PARAMS","ICD9FILT","A","FILTER")="ALL"
"RTN","RORX022",87,0)
 ;  RORTSK("PARAMS","LRGRANGES","C",1)=""
"RTN","RORX022",88,0)
 ;  RORTSK("PARAMS","LRGRANGES","C",1,"H")=45
"RTN","RORX022",89,0)
 ;  RORTSK("PARAMS","LRGRANGES","C",1,"L")=30
"RTN","RORX022",90,0)
 ;  RORTSK("PARAMS","OPTIONS","A","COMPLETE")=1
"RTN","RORX022",91,0)
 ;  RORTSK("PARAMS","OPTIONS","A","MOST_RECENT")=1
"RTN","RORX022",92,0)
 ;  RORTSK("PARAMS","PATIENTS","A","DE_AFTER")=1
"RTN","RORX022",93,0)
 ;  RORTSK("PARAMS","PATIENTS","A","DE_BEFORE")=1
"RTN","RORX022",94,0)
 ;  RORTSK("PARAMS","PATIENTS","A","DE_DURING")=1
"RTN","RORX022",95,0)
 ;  RORTSK("PARAMS","REGIEN")=1
"RTN","RORX022",96,0)
 ;
"RTN","RORX022",97,0)
 ;  If the user selected an 'as of' date = 12/31/2005:
"RTN","RORX022",98,0)
 ;     RORTSK("PARAMS","OPTIONS","A","MOST_RECENT")=1
"RTN","RORX022",99,0)
 ;  is replaced with:  
"RTN","RORX022",100,0)
 ;     RORTSK("PARAMS","OPTIONS","A","MAX_DATE")=3051231
"RTN","RORX022",101,0)
 ;
"RTN","RORX022",102,0)
 ;
"RTN","RORX022",103,0)
 ; The ^TMP("RORX022",$J) global node is used by this function.
"RTN","RORX022",104,0)
 ;
"RTN","RORX022",105,0)
 ; ^TMP("RORX022",$J,
"RTN","RORX022",106,0)
 ;   "PAT",
"RTN","RORX022",107,0)
 ;     DFN,              Patient descriptor
"RTN","RORX022",108,0)
 ;                         ^01: Last 4 digits of SSN
"RTN","RORX022",109,0)
 ;                         ^02: Patient name
"RTN","RORX022",110,0)
 ;                         ^03: Date of 1st DAA fill
"RTN","RORX022",111,0)
 ;                         ^04: National ICN
"RTN","RORX022",112,0)
 ;                         ^05: Age/DOB
"RTN","RORX022",113,0)
 ;       "LR",
"RTN","RORX022",114,0)
 ;         TestName,
"RTN","RORX022",115,0)
 ;          TestIEN
"RTN","RORX022",116,0)
 ;            Inv Date)  Result
"RTN","RORX022",117,0)
 ;                         ^01:  Test result
"RTN","RORX022",118,0)
 ;                         ^02:  # wks since 1st DAA fill
"RTN","RORX022",119,0)
 ;       "RX",
"RTN","RORX022",120,0)
 ;         Inv Date,
"RTN","RORX022",121,0)
 ;           DrugName,
"RTN","RORX022",122,0)
 ;             DrugIEN,
"RTN","RORX022",123,0)
 ;               RX#,
"RTN","RORX022",124,0)
 ;                 Index)Days Supply
"RTN","RORX022",125,0)
 ;                         ^05:Days Supply           
"RTN","RORX022",126,0)
 ;
"RTN","RORX022",127,0)
 ; Return Values:
"RTN","RORX022",128,0)
 ;       <0  Error code
"RTN","RORX022",129,0)
 ;        0  Ok
"RTN","RORX022",130,0)
 ;
"RTN","RORX022",131,0)
DAAMON(RORTSK) ;
"RTN","RORX022",132,0)
 N RORLTST       ; Closed root of the list of lab tests for the
"RTN","RORX022",133,0)
 ;               ; Lab search API
"RTN","RORX022",134,0)
 N RORLTRV       ; Closed root of the list of lab tests with ranges
"RTN","RORX022",135,0)
 N RORREG        ; Registry IEN
"RTN","RORX022",136,0)
 N RORXEDT       ; Pharmacy end date
"RTN","RORX022",137,0)
 N RORXL         ; Closed root of the drug list for the pharmacy
"RTN","RORX022",138,0)
 ;               ; search API or "*" if all drugs were selected
"RTN","RORX022",139,0)
 N RORXSDT       ; Pharmacy start date
"RTN","RORX022",140,0)
 N LTMREC        ; Baseline result request
"RTN","RORX022",141,0)
 ;
"RTN","RORX022",142,0)
 N ECNT,NSPT,RC,REPORT,SFLAGS,TMP
"RTN","RORX022",143,0)
 S (RORXL,RORLTST)="",(ECNT,RC)=0
"RTN","RORX022",144,0)
 K ^TMP("RORX022",$J)
"RTN","RORX022",145,0)
 ;--- Root node of the report
"RTN","RORX022",146,0)
 S REPORT=$$ADDVAL^RORTSK11(RORTSK,"REPORT")
"RTN","RORX022",147,0)
 Q:REPORT<0 REPORT
"RTN","RORX022",148,0)
 ;
"RTN","RORX022",149,0)
 D
"RTN","RORX022",150,0)
 . ;--- Get and prepare the report parameters
"RTN","RORX022",151,0)
 . S RORREG=$$PARAM^RORTSK01("REGIEN")  ; Registry IEN
"RTN","RORX022",152,0)
 . S RC=$$PARAMS(REPORT,.RORXSDT,.RORXEDT,.SFLAGS)  Q:RC<0
"RTN","RORX022",153,0)
 . ;--- Report header
"RTN","RORX022",154,0)
 . S RC=$$HEADER(REPORT)  Q:RC<0
"RTN","RORX022",155,0)
 . ;--- Query the registry
"RTN","RORX022",156,0)
 . D TPPSETUP^RORTSK01(80)
"RTN","RORX022",157,0)
 . S RC=$$QUERY^RORX022A(SFLAGS,.RORTSK,.NSPT)
"RTN","RORX022",158,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX022",159,0)
 . ;--- Store the results
"RTN","RORX022",160,0)
 . D TPPSETUP^RORTSK01(20)
"RTN","RORX022",161,0)
 . S RC=$$STORE^RORX022A(REPORT,.RORTSK,NSPT)
"RTN","RORX022",162,0)
 . I RC  Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX022",163,0)
 ;
"RTN","RORX022",164,0)
 K ^TMP("RORX022",$J)
"RTN","RORX022",165,0)
 D FREE^RORTMP(RORLTST)
"RTN","RORX022",166,0)
 ;
"RTN","RORX022",167,0)
 Q $S(RC<0:RC,ECNT>0:-43,1:0)
"RTN","RORX022A")
0^44^B176351270^B147471078
"RTN","RORX022A",1,0)
RORX022A ;BPOIFO/CLR - LAB DAA MONITOR (CONT.) ; 22 Feb 2016  2:28 AM
"RTN","RORX022A",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**8,13,17,18,19,21,28,31**;Feb 17, 2006;Build 62
"RTN","RORX022A",3,0)
 ;
"RTN","RORX022A",4,0)
 ; This routine uses the following IAs:
"RTN","RORX022A",5,0)
 ;
"RTN","RORX022A",6,0)
 ; #10103 FMADD^XLFDT (supported)
"RTN","RORX022A",7,0)
 ; #10103 FMDIFF^XLFDT (supported)
"RTN","RORX022A",8,0)
 ; #10035 Direct read of the DOD field of the file #2
"RTN","RORX022A",9,0)
 ; #10000 C^%DTC (supported)
"RTN","RORX022A",10,0)
 ;   
"RTN","RORX022A",11,0)
 ;******************************************************************************
"RTN","RORX022A",12,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORX022A",13,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","RORX022A",14,0)
 ;ROR*1.5*18   APR  2012   C RAY        Adds select patient panel
"RTN","RORX022A",15,0)
 ;ROR*1.5*19   JUN  2012   K GUPTA      Support for ICD-10 Coding System
"RTN","RORX022A",16,0)
 ;ROR*1.5*21   SEP  2013   T KOPP       Add ICN column if Additional Identifier
"RTN","RORX022A",17,0)
 ;                                       requested.
"RTN","RORX022A",18,0)
 ;ROR*1.5*28   APR  2016   T KOPP       Add select DAA/in house drug parameter
"RTN","RORX022A",19,0)
 ;                                      Change selection of Rx's from 2 specific
"RTN","RORX022A",20,0)
 ;                                       drugs to any drug assigned to the HEP C
"RTN","RORX022A",21,0)
 ;                                       registry plus local drugs defined for 
"RTN","RORX022A",22,0)
 ;                                       the registry.
"RTN","RORX022A",23,0)
 ;ROR*1.5*31   MAY 2017    M FERRARESE  Adding PACT ,PCP,and AGE/DOB as additional
"RTN","RORX022A",24,0)
 ;                                      identifiers.
"RTN","RORX022A",25,0)
 ;******************************************************************************
"RTN","RORX022A",26,0)
 Q
"RTN","RORX022A",27,0)
 ;
"RTN","RORX022A",28,0)
 ;***** LAB SEARCH CALLBACK
"RTN","RORX022A",29,0)
 ;
"RTN","RORX022A",30,0)
 ; .ROR8DST      Reference to the ROR8DST parameter.
"RTN","RORX022A",31,0)
 ;
"RTN","RORX022A",32,0)
 ; INVDT         IEN of the Lab test (inverted date)
"RTN","RORX022A",33,0)
 ;
"RTN","RORX022A",34,0)
 ; .RESULT       Reference to a local variable, which contains
"RTN","RORX022A",35,0)
 ;               the result (see the $$LTSEARCH^RORUTL10).
"RTN","RORX022A",36,0)
 ;
"RTN","RORX022A",37,0)
 ; Return Values:
"RTN","RORX022A",38,0)
 ;       <0  Error code (the search will be aborted)
"RTN","RORX022A",39,0)
 ;        0  Ok
"RTN","RORX022A",40,0)
 ;        1  Skip this result
"RTN","RORX022A",41,0)
 ;        2  Skip this and all remaining results
"RTN","RORX022A",42,0)
 ;
"RTN","RORX022A",43,0)
LTSCB(ROR8DST,INVDT,RESULT) ;
"RTN","RORX022A",44,0)
 ;all lab tests
"RTN","RORX022A",45,0)
 N DATE,IEN,NAME,RC,TMP,VAL,WEEKS,DAYS,RAWDAYS
"RTN","RORX022A",46,0)
 S IEN=+RESULT(2)           Q:IEN'>0 1   ; IEN of the Lab test
"RTN","RORX022A",47,0)
 S NAME=$P(RESULT(2),U,2)   Q:NAME="" 1  ; Name of the test
"RTN","RORX022A",48,0)
 S VAL=$P(RESULT(1),U,3)    Q:VAL="" 1   ; Result of the test
"RTN","RORX022A",49,0)
 S DATE=+$P(RESULT(1),U,1)  Q:DATE'>0 1  ; Date of the test
"RTN","RORX022A",50,0)
 S RAWDAYS=$$FMDIFF^XLFDT(((9999999-DATE)\1),ROR8DST("DAA"))
"RTN","RORX022A",51,0)
 S WEEKS=RAWDAYS\7  ;Number of weeks
"RTN","RORX022A",52,0)
 S DAYS=RAWDAYS#7  ;Remainder in days
"RTN","RORX022A",53,0)
 S VAL=$$UP^XLFSTR(VAL)
"RTN","RORX022A",54,0)
 ;--- Skip value if test not performed
"RTN","RORX022A",55,0)
 I VAL["CANC"!(VAL["DNR")!(VAL["TNP") Q 1
"RTN","RORX022A",56,0)
 ;--- Skip value out of the result range
"RTN","RORX022A",57,0)
 I $D(RORLTRV(IEN))>1  S RC=1  D  Q:RC RC
"RTN","RORX022A",58,0)
 . S VAL=$$CLRNMVAL^RORUTL18($P(RESULT(1),U,3))
"RTN","RORX022A",59,0)
 . ;--- Skip a non-numeric result
"RTN","RORX022A",60,0)
 . Q:'$$NUMERIC^RORUTL05(VAL)
"RTN","RORX022A",61,0)
 . ;--- Check the range
"RTN","RORX022A",62,0)
 . I $G(RORLTRV(IEN,"L"))'=""  Q:VAL<RORLTRV(IEN,"L")
"RTN","RORX022A",63,0)
 . I $G(RORLTRV(IEN,"H"))'=""  Q:VAL>RORLTRV(IEN,"H")
"RTN","RORX022A",64,0)
 . S RC=0
"RTN","RORX022A",65,0)
 ;--- Store the result
"RTN","RORX022A",66,0)
 S @ROR8DST@(NAME,IEN,DATE)=($P(RESULT(1),U,3))_U_(+WEEKS_" weeks "_+DAYS_" days")
"RTN","RORX022A",67,0)
 Q 0
"RTN","RORX022A",68,0)
 ;
"RTN","RORX022A",69,0)
 ;***** QUERIES THE REGISTRY
"RTN","RORX022A",70,0)
 ;
"RTN","RORX022A",71,0)
 ; FLAGS         Flags for the $$SKIP^RORXU005
"RTN","RORX022A",72,0)
 ; RORTSK        Parameters passed by client
"RTN","RORX022A",73,0)
 ; .NSPT         Number of selected patients is returned here
"RTN","RORX022A",74,0)
 ;
"RTN","RORX022A",75,0)
 ; Return Values:
"RTN","RORX022A",76,0)
 ;       <0  Error code
"RTN","RORX022A",77,0)
 ;        0  Ok
"RTN","RORX022A",78,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX022A",79,0)
 ;
"RTN","RORX022A",80,0)
QUERY(FLAGS,RORTSK,NSPT) ;
"RTN","RORX022A",81,0)
 N RORLDST       ; Descriptor for Lab search API
"RTN","RORX022A",82,0)
 N RORPTN        ; Number of patients in the registry
"RTN","RORX022A",83,0)
 N RORXDST       ; Descriptor for pharmacy search API
"RTN","RORX022A",84,0)
 N RORCDLIST     ; Flag to indicate whether a clinic or division list exists
"RTN","RORX022A",85,0)
 N RORCDSTDT     ; Start date for clinic/division utilization search
"RTN","RORX022A",86,0)
 N RORCDENDT     ; End date for clinic/division utilization search
"RTN","RORX022A",87,0)
 N RORDAA        ; Date of patient's 1st DAA fill
"RTN","RORX022A",88,0)
 N RORXL         ; Location of drug list
"RTN","RORX022A",89,0)
 N RXSDT         ; RX start date
"RTN","RORX022A",90,0)
 N RXEDT         ; RX end date
"RTN","RORX022A",91,0)
 N RORICN        ; National ICN
"RTN","RORX022A",92,0)
 N RORPACT       ; Patient Care Team
"RTN","RORX022A",93,0)
 N RORPCP        ; Priamary Care Provider
"RTN","RORX022A",94,0)
 ;
"RTN","RORX022A",95,0)
 N CNT,ECNT,IEN,IENS,PATIEN,RC,SKIP,TMP,VA,VADM,XREFNODE
"RTN","RORX022A",96,0)
 N RCC,FLAG,DAASDT,DAAEDT,RORXSDT,RORDAACH,AGE,AGETYPE
"RTN","RORX022A",97,0)
 N LTEDT,LTSDT,LTWKDYS,LTWKS
"RTN","RORX022A",98,0)
 S XREFNODE=$NA(^RORDATA(798,"AC",+RORREG))
"RTN","RORX022A",99,0)
 S (CNT,ECNT,NSPT,RC,RORCDLIST)=0
"RTN","RORX022A",100,0)
 ;--- Number of patients in the registry
"RTN","RORX022A",101,0)
 S RORPTN=$$REGSIZE^RORUTL02(+RORREG)  S:RORPTN<0 RORPTN=0
"RTN","RORX022A",102,0)
 ;--- Date range to search for DAA meds
"RTN","RORX022A",103,0)
 S DAASDT=$$PARAM^RORTSK01("DATE_RANGE_4","START")\1
"RTN","RORX022A",104,0)
 S DAAEDT=$$PARAM^RORTSK01("DATE_RANGE_4","END")\1
"RTN","RORX022A",105,0)
 ;--- set up LAB descriptors
"RTN","RORX022A",106,0)
 S LTWKS=$$PARAM^RORTSK01("WEEKS_AFTER")
"RTN","RORX022A",107,0)
 S LTWKDYS=LTWKS*7
"RTN","RORX022A",108,0)
 S LTMREC=$$PARAM^RORTSK01("WEEKS_AFTER","MOST_RECENT")
"RTN","RORX022A",109,0)
 S RORLDST("RORCB")="$$LTSCB^RORX022A"
"RTN","RORX022A",110,0)
 ;--- set up RX descriptors
"RTN","RORX022A",111,0)
 S RORXDST("RORCB")="$$RXOCB^RORX022A"
"RTN","RORX022A",112,0)
 S RORXDST("GENERIC")=1
"RTN","RORX022A",113,0)
 S RORXL=$$ALLOC^RORTMP()
"RTN","RORX022A",114,0)
 S RC=$$DRUGLIST^RORUTL16(RORXL,+RORREG,"DG")
"RTN","RORX022A",115,0)
 S RXSDT=3100101  ;based on compliance date PSN*4*293
"RTN","RORX022A",116,0)
 S RXEDT=$$FMADD^XLFDT(DAAEDT,1)
"RTN","RORX022A",117,0)
 ;--- Set up Clinic/Division list parameters
"RTN","RORX022A",118,0)
 I $D(RORTSK("PARAMS","CLINICS","C")) S RORCDLIST=1
"RTN","RORX022A",119,0)
 I $D(RORTSK("PARAMS","DIVISIONS","C")) S RORCDLIST=1
"RTN","RORX022A",120,0)
 ;--- Set up ICD parameters
"RTN","RORX022A",121,0)
 S FLAG=$G(RORTSK("PARAMS","ICDFILT","A","FILTER"))
"RTN","RORX022A",122,0)
 ;
"RTN","RORX022A",123,0)
 ;--- Browse through the registry records
"RTN","RORX022A",124,0)
 S IEN=0
"RTN","RORX022A",125,0)
 F  S IEN=$O(@XREFNODE@(IEN))  Q:IEN'>0  D  Q:RC<0
"RTN","RORX022A",126,0)
 . S TMP=$S(RORPTN>0:CNT/RORPTN,1:"")
"RTN","RORX022A",127,0)
 . S RC=$$LOOP^RORTSK01(TMP)  Q:RC<0
"RTN","RORX022A",128,0)
 . S IENS=IEN_",",CNT=CNT+1
"RTN","RORX022A",129,0)
 . ;--- Get patient DFN
"RTN","RORX022A",130,0)
 . S PATIEN=$$PTIEN^RORUTL01(IEN)  Q:PATIEN'>0
"RTN","RORX022A",131,0)
 . I +$P($G(^DPT(PATIEN,.35)),U)>0 Q  ;patient has died
"RTN","RORX022A",132,0)
 . ;check for patient list and quit if not on list  ;+18
"RTN","RORX022A",133,0)
 . I $D(RORTSK("PARAMS","PATIENTS","C")),'$D(RORTSK("PARAMS","PATIENTS","C",PATIEN)) Q
"RTN","RORX022A",134,0)
 . ;--- Check if the patient should be skipped
"RTN","RORX022A",135,0)
 . Q:$$SKIP^RORXU005(IEN,FLAGS)
"RTN","RORX022A",136,0)
 . ;--- Check if patient should be skipped because of ICD codes
"RTN","RORX022A",137,0)
 . S RCC=0
"RTN","RORX022A",138,0)
 . I FLAG'="ALL" D
"RTN","RORX022A",139,0)
 . . S RCC=$$ICD^RORXU010(PATIEN)
"RTN","RORX022A",140,0)
 . I (FLAG="INCLUDE")&(RCC=0) Q
"RTN","RORX022A",141,0)
 . I (FLAG="EXCLUDE")&(RCC=1) Q
"RTN","RORX022A",142,0)
 . ;--- Check if patient should be skipped because not on Clinic or Division list
"RTN","RORX022A",143,0)
 . I RORCDLIST,'$$CDUTIL^RORXU001(.RORTSK,PATIEN,DAASDT,DAAEDT) Q
"RTN","RORX022A",144,0)
 . ;--- Report specific filters
"RTN","RORX022A",145,0)
 . S SKIP=1
"RTN","RORX022A",146,0)
 . ;--- Check if patient should be skipped because no DAA fill
"RTN","RORX022A",147,0)
 . D  I RC<0  S ECNT=ECNT+1,RC=0  Q
"RTN","RORX022A",148,0)
 . . ;--- Search for 1st DAA fill date skip patient if not taking DAA
"RTN","RORX022A",149,0)
 . . S RORXDST("1STDAA")=1  ;set DAA flag
"RTN","RORX022A",150,0)
 . . D  I RC'>0 Q
"RTN","RORX022A",151,0)
 . . . N RORDAACH
"RTN","RORX022A",152,0)
 . . . S RORDAACH=$$PARAM^RORTSK01("OPTIONS","DAA_DRUGS")
"RTN","RORX022A",153,0)
 . . . S RORXDST=$$ALLOC^RORTMP()
"RTN","RORX022A",154,0)
 . . . S RC=$$RXSEARCH^RORUTL14(PATIEN,RORXL,.RORXDST,"EIOV"_$S(RORDAACH="C":"C",RORDAACH="I":"H",1:""),RXSDT,RXEDT)
"RTN","RORX022A",155,0)
 . . S SKIP=0
"RTN","RORX022A",156,0)
 . S RORDAA=$O(@RORXDST@(""))
"RTN","RORX022A",157,0)
 . I +RORDAA<DAASDT S SKIP=1  ;1st fill before daa start date
"RTN","RORX022A",158,0)
 . ;--- Skip the patient if not all search criteria have been met
"RTN","RORX022A",159,0)
 . I SKIP D FREE^RORTMP(RORXDST) Q
"RTN","RORX022A",160,0)
 . ;=== Store the patient's data
"RTN","RORX022A",161,0)
 . D VADEM^RORUTL05(PATIEN,1)
"RTN","RORX022A",162,0)
 . D FREE^RORTMP(RORXDST)
"RTN","RORX022A",163,0)
 . S AGETYPE=$$PARAM^RORTSK01("AGE_RANGE","TYPE")
"RTN","RORX022A",164,0)
 . S AGE=$S(AGETYPE="AGE":$P(VADM(4),U),AGETYPE="DOB":$$DATE^RORXU002($P(VADM(3),U)\1),1:"")
"RTN","RORX022A",165,0)
 . S RORICN=$S($$PARAM^RORTSK01("PATIENTS","ICN"):$$ICN^RORUTL02(PATIEN),1:"")
"RTN","RORX022A",166,0)
 . S RORPACT=$S($$PARAM^RORTSK01("PATIENTS","PACT"):$$PACT^RORUTL02(PATIEN),1:"")
"RTN","RORX022A",167,0)
 . S RORPCP=$S($$PARAM^RORTSK01("PATIENTS","PCP"):$$PCP^RORUTL02(PATIEN),1:"")
"RTN","RORX022A",168,0)
 . S ^TMP("RORX022",$J,"PAT",PATIEN)=VA("BID")_U_VADM(1)_U_RORDAA_U_RORICN_U_RORPACT_U_RORPCP_U_AGE
"RTN","RORX022A",169,0)
 . ;--- Get lab tests N weeks after 1st DAA fill
"RTN","RORX022A",170,0)
 . N X,X1,X2
"RTN","RORX022A",171,0)
 . S X1=RORDAA,X2=LTWKDYS D C^%DTC S LTEDT=X
"RTN","RORX022A",172,0)
 . S LTEDT=$$FMADD^XLFDT(LTEDT\1,1)
"RTN","RORX022A",173,0)
 . ;--- If baseline requested get all lab results
"RTN","RORX022A",174,0)
 . S LTSDT=$S(LTMREC=1:"",1:RORDAA)
"RTN","RORX022A",175,0)
 . S RORLDST("DAA")=RORDAA
"RTN","RORX022A",176,0)
 . D  Q:RC<0 
"RTN","RORX022A",177,0)
 . . S RORLDST=$NA(^TMP("RORX022",$J,"PAT",PATIEN,"LR"))
"RTN","RORX022A",178,0)
 . . S RC=$$LTSEARCH^RORUTL10(PATIEN,RORLTST,.RORLDST,,LTSDT,LTEDT)
"RTN","RORX022A",179,0)
 . ;--- Get all registry med fills 60 days before 1st DAA fill
"RTN","RORX022A",180,0)
 . K RORXDST("1STDAA")  ;clear DAA flag
"RTN","RORX022A",181,0)
 . D  Q:RC<0
"RTN","RORX022A",182,0)
 . . N RORDAACH
"RTN","RORX022A",183,0)
 . . S RORXDST=$NA(^TMP("RORX022",$J,"PAT",PATIEN,"RX"))
"RTN","RORX022A",184,0)
 . . S X1=RORDAA,X2=-60 D C^%DTC S RORXSDT=X
"RTN","RORX022A",185,0)
 . . S RORXEDT=$$FMADD^XLFDT(DT,1)
"RTN","RORX022A",186,0)
 . . S RORDAACH=$$PARAM^RORTSK01("OPTIONS","DAA_DRUGS")
"RTN","RORX022A",187,0)
 . . S RC=$$RXSEARCH^RORUTL14(PATIEN,RORXL,.RORXDST,"EIOV"_$S(RORDAACH="C":"C",RORDAACH="I":"H",1:""),RORXSDT,RORXEDT)
"RTN","RORX022A",188,0)
 . S NSPT=NSPT+1
"RTN","RORX022A",189,0)
 Q $S(RC<0:RC,1:ECNT)
"RTN","RORX022A",190,0)
 ;
"RTN","RORX022A",191,0)
 ;
"RTN","RORX022A",192,0)
 ;***** CALLBACK FUNCTION FOR THE PHARMACY SEARCH API
"RTN","RORX022A",193,0)
 ;
"RTN","RORX022A",194,0)
 ;                .ROR8DST      Reference to the ROR8DST parameter.
"RTN","RORX022A",195,0)
 ;
"RTN","RORX022A",196,0)
 ;
"RTN","RORX022A",197,0)
 ;                 ORDER         Order number (from condensed list)
"RTN","RORX022A",198,0)
 ;
"RTN","RORX022A",199,0)
 ;                 FLAGS         Flags describing the order to be
"RTN","RORX022A",200,0)
 ;                               processed.
"RTN","RORX022A",201,0)
 ;
"RTN","RORX022A",202,0)
 ;                 DRUG          Dispensed drug
"RTN","RORX022A",203,0)
 ;                                 ^01: Drug IEN in file #50
"RTN","RORX022A",204,0)
 ;                                 ^02: Drug name
"RTN","RORX022A",205,0)
 ;
"RTN","RORX022A",206,0)
 ;                 DATE          Order date (issue date for outpatient
"RTN","RORX022A",207,0)
 ;                               drugs or start date for inpatient)
"RTN","RORX022A",208,0)
 ;
"RTN","RORX022A",209,0)
 ;Return Values:
"RTN","RORX022A",210,0)
 ;       <0  Error code (the search will be aborted)
"RTN","RORX022A",211,0)
 ;        0  Ok
"RTN","RORX022A",212,0)
 ;        1  Skip this result
"RTN","RORX022A",213,0)
 ;        2  Skip this and all remaining results
"RTN","RORX022A",214,0)
 ;
"RTN","RORX022A",215,0)
RXOCB(ROR8DST,ORDER,ORDFLG,DRUG,DATE) ;
"RTN","RORX022A",216,0)
 N DRUGIEN,DRUGNAME,IEN,IRP,OFD,RPSUB,RXBUF,RXCNT,RXNUM,TMP
"RTN","RORX022A",217,0)
 I ROR8DST("GENERIC")  D
"RTN","RORX022A",218,0)
 . S DRUGIEN=+ROR8DST("RORXGEN"),DRUGNAME=$P(ROR8DST("RORXGEN"),U,2)
"RTN","RORX022A",219,0)
 I DRUGIEN'>0!(DRUGNAME="") S DRUGIEN=+DRUG,DRUGNAME=$P(DRUG,U,2)
"RTN","RORX022A",220,0)
 Q:(DRUGIEN'>0)!(DRUGNAME="") 1
"RTN","RORX022A",221,0)
 ;--- if DAA flag set, skip med if not a DAA
"RTN","RORX022A",222,0)
 ;I +$G(ROR8DST("1STDAA")),(DRUGNAME'="BOCEPREVIR"),(DRUGNAME'="TELAPREVIR") Q 1
"RTN","RORX022A",223,0)
 S $P(RXBUF,U,5)=$P($G(^TMP("PS",$J,0)),U,7)  ; Days Supply
"RTN","RORX022A",224,0)
 S TMP=$G(^TMP("PS",$J,"RXN",0))
"RTN","RORX022A",225,0)
 S RXNUM=$P(TMP,U)  S:RXNUM="" RXNUM=" "
"RTN","RORX022A",226,0)
 S RXCNT=0
"RTN","RORX022A",227,0)
 ;--- Original prescription
"RTN","RORX022A",228,0)
 I ORDFLG["I"  D  ;--- Inpatient
"RTN","RORX022A",229,0)
 . S OFD=$P($G(^TMP("PS",$J,0)),U,5)\1         ; Start Date
"RTN","RORX022A",230,0)
 . S RXCNT=RXCNT+1
"RTN","RORX022A",231,0)
 . S @ROR8DST@(OFD,DRUGNAME,DRUGIEN,RXNUM,RXCNT)=RXBUF
"RTN","RORX022A",232,0)
 E  D             ;--- Outpatient
"RTN","RORX022A",233,0)
 . S OFD=+$P($G(^TMP("PS",$J,"RXN",0)),U,6)  ; Original Fill Date
"RTN","RORX022A",234,0)
 . Q:(OFD<ROR8DST("RORSDT"))!(OFD'<ROR8DST("ROREDT"))
"RTN","RORX022A",235,0)
 . S RXCNT=RXCNT+1
"RTN","RORX022A",236,0)
 . S @ROR8DST@(OFD,DRUGNAME,DRUGIEN,RXNUM,RXCNT)=RXBUF
"RTN","RORX022A",237,0)
 ;--- Refills and partials
"RTN","RORX022A",238,0)
 F RPSUB="REF","PAR"  D
"RTN","RORX022A",239,0)
 . S IRP=0
"RTN","RORX022A",240,0)
 . F  S IRP=$O(^TMP("PS",$J,RPSUB,IRP))  Q:IRP'>0  D
"RTN","RORX022A",241,0)
 . . S TMP=$G(^TMP("PS",$J,RPSUB,IRP,0))
"RTN","RORX022A",242,0)
 . . S $P(RXBUF,U,5)=$P(TMP,U,2)  ; Days Supply
"RTN","RORX022A",243,0)
 . . I TMP>0  S RXCNT=RXCNT+1  D
"RTN","RORX022A",244,0)
 . . . S @ROR8DST@(+TMP,DRUGNAME,DRUGIEN,RXNUM,RXCNT)=RXBUF
"RTN","RORX022A",245,0)
 Q 0
"RTN","RORX022A",246,0)
 ;
"RTN","RORX022A",247,0)
 ;***** STORES THE REPORT DATA
"RTN","RORX022A",248,0)
 ;
"RTN","RORX022A",249,0)
 ; REPORT        IEN of the REPORT element
"RTN","RORX022A",250,0)
 ; RORTSK        Parameters passed by GUI
"RTN","RORX022A",251,0)
 ; NSPT          Number of selected patients
"RTN","RORX022A",252,0)
 ;
"RTN","RORX022A",253,0)
 ; Return Values:
"RTN","RORX022A",254,0)
 ;       <0  Error code
"RTN","RORX022A",255,0)
 ;        0  Ok
"RTN","RORX022A",256,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX022A",257,0)
 ;
"RTN","RORX022A",258,0)
STORE(REPORT,RORTSK,NSPT) ;
"RTN","RORX022A",259,0)
 N CNT,DATE,DFN,DAA,ECNT,ICN,IEN,ITEM,LAST4,LTLST,NAME,NODE,PTCNT,PACT,PCP,PTLST,PTNAME,RC,RXLST,TMP,VAL,AGE,AGETYPE
"RTN","RORX022A",260,0)
 N DAAINV,LRMREC
"RTN","RORX022A",261,0)
 S (ECNT,RC)=0,(LTLST,PTLST,RXLST)=-1
"RTN","RORX022A",262,0)
 ;--- Force the "patient data" note in the output
"RTN","RORX022A",263,0)
 D ADDVAL^RORTSK11(RORTSK,"PATIENT",,REPORT)
"RTN","RORX022A",264,0)
 S LRMREC=$$PARAM^RORTSK01("LABTESTS","MOST_RECENT")
"RTN","RORX022A",265,0)
 ;--- Create lab test list
"RTN","RORX022A",266,0)
 D  Q:LTLST<0 LTLST
"RTN","RORX022A",267,0)
 . S LTLST=$$ADDVAL^RORTSK11(RORTSK,"LABTESTS",,REPORT)
"RTN","RORX022A",268,0)
 . D ADDATTR^RORTSK11(RORTSK,LTLST,"TABLE","LABTESTS")
"RTN","RORX022A",269,0)
 ;--- Create pharmacy list
"RTN","RORX022A",270,0)
 D  Q:RXLST<0 RXLST
"RTN","RORX022A",271,0)
 . S RXLST=$$ADDVAL^RORTSK11(RORTSK,"DRUGS",,REPORT)
"RTN","RORX022A",272,0)
 . D ADDATTR^RORTSK11(RORTSK,RXLST,"TABLE","DRUGS")
"RTN","RORX022A",273,0)
 ;--- Loop through selected patients and store as XML
"RTN","RORX022A",274,0)
 S (CNT,DFN,PTCNT)=0
"RTN","RORX022A",275,0)
 S AGETYPE=$$PARAM^RORTSK01("AGE_RANGE","TYPE")
"RTN","RORX022A",276,0)
 F  S DFN=$O(^TMP("RORX022",$J,"PAT",DFN))  Q:DFN'>0  D  Q:RC<0
"RTN","RORX022A",277,0)
 . S TMP=$S(NSPT>0:CNT/NSPT,1:"")
"RTN","RORX022A",278,0)
 . S RC=$$LOOP^RORTSK01(TMP)  Q:RC<0
"RTN","RORX022A",279,0)
 . S CNT=CNT+1,NODE=$NA(^TMP("RORX022",$J,"PAT",DFN))
"RTN","RORX022A",280,0)
 . ;--- Patient's data
"RTN","RORX022A",281,0)
 . S TMP=$G(@NODE)
"RTN","RORX022A",282,0)
 . S LAST4=$P(TMP,U),PTNAME=$P(TMP,U,2),DAA=$P(TMP,U,3),ICN=$P(TMP,U,4),PACT=$P(TMP,U,5),PCP=$P(TMP,U,6),AGE=$P(TMP,U,7)
"RTN","RORX022A",283,0)
 . S PTCNT=PTCNT+1
"RTN","RORX022A",284,0)
 . ;--- List of Lab tests
"RTN","RORX022A",285,0)
 . S NAME="" K LTCNT
"RTN","RORX022A",286,0)
 . F  S NAME=$O(@NODE@("LR",NAME)) Q:NAME=""  D
"RTN","RORX022A",287,0)
 . . S IEN=""
"RTN","RORX022A",288,0)
 . . F  S IEN=$O(@NODE@("LR",NAME,IEN)) Q:IEN=""  D
"RTN","RORX022A",289,0)
 . . . S DATE="",DAAINV=9999999-DAA
"RTN","RORX022A",290,0)
 . . . F  S DATE=$O(@NODE@("LR",NAME,IEN,DATE)) Q:DATE=""!($G(LTCNT(NAME,IEN))=2)!((DATE>DAAINV)&'LTMREC)  D
"RTN","RORX022A",291,0)
 . . . . ;store results after or on DAA fill date
"RTN","RORX022A",292,0)
 . . . . I DATE'>DAAINV D  Q
"RTN","RORX022A",293,0)
 . . . . . I LRMREC,$G(LTCNT(NAME,IEN))=0 Q  ;quit if most recent
"RTN","RORX022A",294,0)
 . . . . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"LT",,LTLST,,DFN)
"RTN","RORX022A",295,0)
 . . . . . D ADDVAL^RORTSK11(RORTSK,"NAME",PTNAME,ITEM,1)
"RTN","RORX022A",296,0)
 . . . . . D ADDVAL^RORTSK11(RORTSK,"LAST4",LAST4,ITEM,2)
"RTN","RORX022A",297,0)
 . . . . . I AGETYPE'="ALL" D ADDVAL^RORTSK11(RORTSK,AGETYPE,AGE,ITEM,1)
"RTN","RORX022A",298,0)
 . . . . . I $$PARAM^RORTSK01("PATIENTS","ICN") D ADDVAL^RORTSK11(RORTSK,"ICN",ICN,ITEM,1)
"RTN","RORX022A",299,0)
 . . . . . I $$PARAM^RORTSK01("PATIENTS","PACT") D ADDVAL^RORTSK11(RORTSK,"PACT",PACT,ITEM,1)
"RTN","RORX022A",300,0)
 . . . . . I $$PARAM^RORTSK01("PATIENTS","PCP") D ADDVAL^RORTSK11(RORTSK,"PCP",PCP,ITEM,1)
"RTN","RORX022A",301,0)
 . . . . . D ADDVAL^RORTSK11(RORTSK,"DATE",((9999999-DATE)\1),ITEM,1)
"RTN","RORX022A",302,0)
 . . . . . D ADDVAL^RORTSK11(RORTSK,"LTNAME",NAME,ITEM,1)
"RTN","RORX022A",303,0)
 . . . . . S VAL=$G(@NODE@("LR",NAME,IEN,DATE))
"RTN","RORX022A",304,0)
 . . . . . S TMP=$S($$NUMERIC^RORUTL05($P(VAL,U)):3,1:1)
"RTN","RORX022A",305,0)
 . . . . . D ADDVAL^RORTSK11(RORTSK,"RESULT",$P(VAL,U),ITEM,TMP)
"RTN","RORX022A",306,0)
 . . . . . D ADDVAL^RORTSK11(RORTSK,"WKS_LAB",$P(VAL,U,2),ITEM,1)
"RTN","RORX022A",307,0)
 . . . . . S LTCNT(NAME,IEN)=0
"RTN","RORX022A",308,0)
 . . . . ;store 2 baseline results if flag is set
"RTN","RORX022A",309,0)
 . . . . I LTMREC D
"RTN","RORX022A",310,0)
 . . . . . S LTCNT(NAME,IEN)=$S('$D(LTCNT(NAME,IEN)):1,1:LTCNT(NAME,IEN)+1)  ;count for each test
"RTN","RORX022A",311,0)
 . . . . . Q:LTCNT(NAME,IEN)>2  ;stop after 2 baseline results
"RTN","RORX022A",312,0)
 . . . . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"LT",,LTLST,,DFN)
"RTN","RORX022A",313,0)
 . . . . . D ADDVAL^RORTSK11(RORTSK,"NAME",PTNAME,ITEM,1)
"RTN","RORX022A",314,0)
 . . . . . D ADDVAL^RORTSK11(RORTSK,"LAST4",LAST4,ITEM,2)
"RTN","RORX022A",315,0)
 . . . . . I AGETYPE'="ALL" D ADDVAL^RORTSK11(RORTSK,AGETYPE,AGE,ITEM,1)
"RTN","RORX022A",316,0)
 . . . . . I $$PARAM^RORTSK01("PATIENTS","ICN") D ADDVAL^RORTSK11(RORTSK,"ICN",ICN,ITEM,1)
"RTN","RORX022A",317,0)
 . . . . . I $$PARAM^RORTSK01("PATIENTS","PACT") D ADDVAL^RORTSK11(RORTSK,"PACT",PACT,ITEM,1)
"RTN","RORX022A",318,0)
 . . . . . I $$PARAM^RORTSK01("PATIENTS","PCP") D ADDVAL^RORTSK11(RORTSK,"PCP",PCP,ITEM,1)
"RTN","RORX022A",319,0)
 . . . . . D ADDVAL^RORTSK11(RORTSK,"DAA_FILL",DAA,ITEM,1)
"RTN","RORX022A",320,0)
 . . . . . D ADDVAL^RORTSK11(RORTSK,"DATE",((9999999-DATE)\1),ITEM,1)
"RTN","RORX022A",321,0)
 . . . . . D ADDVAL^RORTSK11(RORTSK,"LTNAME",NAME,ITEM,1)
"RTN","RORX022A",322,0)
 . . . . . S VAL=$G(@NODE@("LR",NAME,IEN,DATE))
"RTN","RORX022A",323,0)
 . . . . . S TMP=$S($$NUMERIC^RORUTL05($P(VAL,U)):3,1:1)
"RTN","RORX022A",324,0)
 . . . . . D ADDVAL^RORTSK11(RORTSK,"RESULT",$P(VAL,U),ITEM,TMP)
"RTN","RORX022A",325,0)
 . . . . . D ADDVAL^RORTSK11(RORTSK,"WKS_LAB","Baseline",ITEM,1)
"RTN","RORX022A",326,0)
 . ;--- List of drugs
"RTN","RORX022A",327,0)
 . S DATE=""
"RTN","RORX022A",328,0)
 . F  S DATE=$O(@NODE@("RX",DATE))  Q:DATE=""  D
"RTN","RORX022A",329,0)
 . . S NAME=""
"RTN","RORX022A",330,0)
 . . F  S NAME=$O(@NODE@("RX",DATE,NAME))  Q:NAME=""  D
"RTN","RORX022A",331,0)
 . . . S IEN=""
"RTN","RORX022A",332,0)
 . . . F  S IEN=$O(@NODE@("RX",DATE,NAME,IEN))  Q:IEN=""  D
"RTN","RORX022A",333,0)
 . . . . S RXNUM=""
"RTN","RORX022A",334,0)
 . . . . F  S RXNUM=$O(@NODE@("RX",DATE,NAME,IEN,RXNUM)) Q:RXNUM=""  D
"RTN","RORX022A",335,0)
 . . . . . S RXCNT=""
"RTN","RORX022A",336,0)
 . . . . . F  S RXCNT=$O(@NODE@("RX",DATE,NAME,IEN,RXNUM,RXCNT)) Q:RXCNT=""  S RXBUF=@NODE@("RX",DATE,NAME,IEN,RXNUM,RXCNT) D
"RTN","RORX022A",337,0)
 . . . . . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"DRUG",,RXLST,,DFN)
"RTN","RORX022A",338,0)
 . . . . . . D ADDVAL^RORTSK11(RORTSK,"NAME",PTNAME,ITEM,1)
"RTN","RORX022A",339,0)
 . . . . . . D ADDVAL^RORTSK11(RORTSK,"LAST4",LAST4,ITEM,2)
"RTN","RORX022A",340,0)
 . . . . . . I AGETYPE'="ALL" D ADDVAL^RORTSK11(RORTSK,AGETYPE,AGE,ITEM,1)
"RTN","RORX022A",341,0)
 . . . . . . I $$PARAM^RORTSK01("PATIENTS","ICN") D ADDVAL^RORTSK11(RORTSK,"ICN",ICN,ITEM,1)
"RTN","RORX022A",342,0)
 . . . . . . I $$PARAM^RORTSK01("PATIENTS","PACT") D ADDVAL^RORTSK11(RORTSK,"PACT",PACT,ITEM,1)
"RTN","RORX022A",343,0)
 . . . . . . I $$PARAM^RORTSK01("PATIENTS","PCP") D ADDVAL^RORTSK11(RORTSK,"PCP",PCP,ITEM,1)
"RTN","RORX022A",344,0)
 . . . . . . D ADDVAL^RORTSK11(RORTSK,"DAA_FILL",DAA,ITEM,1)
"RTN","RORX022A",345,0)
 . . . . . . D ADDVAL^RORTSK11(RORTSK,"FILL_DATE",DATE\1,ITEM,1)
"RTN","RORX022A",346,0)
 . . . . . . D ADDVAL^RORTSK11(RORTSK,"RXNAME",NAME,ITEM,1)
"RTN","RORX022A",347,0)
 . . . . . . D ADDVAL^RORTSK11(RORTSK,"DAYSPLY",$P(RXBUF,U,5),ITEM,1)
"RTN","RORX022A",348,0)
 ;--- Inactivate the patient list tag if the list is empty
"RTN","RORX022A",349,0)
 D:PTCNT'>0 UPDVAL^RORTSK11(RORTSK,PTLST,,,1)
"RTN","RORX022A",350,0)
 Q ECNT
"RTN","RORX023")
0^49^B10226863^B8007140
"RTN","RORX023",1,0)
RORX023 ;ALB/TMK -  HCV SUSTAINED VIROLOGIC RESPONSE REPORT ;7/21/11 1:04pm
"RTN","RORX023",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**24,31**;Feb 17, 2006;Build 62
"RTN","RORX023",3,0)
 ;
"RTN","RORX023",4,0)
 ;******************************************************************************
"RTN","RORX023",5,0)
 ;                       --- ROUTINE MODIFICATION LOG ---
"RTN","RORX023",6,0)
 ;        
"RTN","RORX023",7,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORX023",8,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","RORX023",9,0)
 ;ROR*1.5*24   JUN 2014    T KOPP       Created report
"RTN","RORX023",10,0)
 ;ROR*1.5*31   MAY 2017    M FERRARESE  Adding PACT, PCP, and AGE/DOB as additional
"RTN","RORX023",11,0)
 ;                                      identifiers.
"RTN","RORX023",12,0)
 ;******************************************************************************
"RTN","RORX023",13,0)
 ;
"RTN","RORX023",14,0)
 Q
"RTN","RORX023",15,0)
 ;
"RTN","RORX023",16,0)
 ;***** OUTPUTS THE REPORT HEADER
"RTN","RORX023",17,0)
 ;
"RTN","RORX023",18,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX023",19,0)
 ;
"RTN","RORX023",20,0)
 ; Return Values:
"RTN","RORX023",21,0)
 ;       <0  Error code
"RTN","RORX023",22,0)
 ;       >0  IEN of the HEADER element
"RTN","RORX023",23,0)
 ;
"RTN","RORX023",24,0)
HEADER(PARTAG) ;
"RTN","RORX023",25,0)
 ;;PATIENTS(#,NAME,LAST4,HCV_DATE,HCV,GT,LAST_TAKEN,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="ALL"
"RTN","RORX023",26,0)
 ;;PATIENTS(#,NAME,LAST4,AGE,HCV_DATE,HCV,GT,LAST_TAKEN,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="AGE"
"RTN","RORX023",27,0)
 ;;PATIENTS(#,NAME,LAST4,DOB,HCV_DATE,HCV,GT,LAST_TAKEN,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="DOB"
"RTN","RORX023",28,0)
 ;
"RTN","RORX023",29,0)
 N HEADER,RC
"RTN","RORX023",30,0)
 S HEADER=$$HEADER^RORXU002(.RORTSK,PARTAG)
"RTN","RORX023",31,0)
 Q:HEADER<0 HEADER
"RTN","RORX023",32,0)
 S RC=$$TBLDEF^RORXU002("HEADER^RORX023",HEADER)
"RTN","RORX023",33,0)
 Q $S(RC<0:RC,1:HEADER)
"RTN","RORX023",34,0)
 ;
"RTN","RORX023",35,0)
 ;***** COMPILES THE "SUSTAINED VIROLOGIC RESPONSE" REPORT
"RTN","RORX023",36,0)
 ; REPORT CODE: 023
"RTN","RORX023",37,0)
 ;
"RTN","RORX023",38,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORX023",39,0)
 ;
"RTN","RORX023",40,0)
 ; The ^TMP("RORX023",$J) global node is used by this function.
"RTN","RORX023",41,0)
 ;
"RTN","RORX023",42,0)
 ; ^TMP("RORX023",$J,
"RTN","RORX023",43,0)
 ;   "PAT",
"RTN","RORX023",44,0)
 ;     DFN,              Patient descriptor
"RTN","RORX023",45,0)
 ;                         ^01: Last 4 digits of SSN
"RTN","RORX023",46,0)
 ;                         ^02: Patient name
"RTN","RORX023",47,0)
 ;                         ^03: empty
"RTN","RORX023",48,0)
 ;                         ^04: National ICN
"RTN","RORX023",49,0)
 ;                         ^05: Patient Care Team
"RTN","RORX023",50,0)
 ;                         ^06: Priamary Care Provider
"RTN","RORX023",51,0)
 ;                         ^07: Age/DOB
"RTN","RORX023",52,0)
 ;       "LR",
"RTN","RORX023",53,0)
 ;         Category,
"RTN","RORX023",54,0)
 ;           Date(inverse) = Result
"RTN","RORX023",55,0)
 ;            
"RTN","RORX023",56,0)
 ;       "RX",
"RTN","RORX023",57,0)
 ;         Last Taken Date) = ""
"RTN","RORX023",58,0)
 ;
"RTN","RORX023",59,0)
 ; Return Values:
"RTN","RORX023",60,0)
 ;       <0  Error code
"RTN","RORX023",61,0)
 ;        0  Ok
"RTN","RORX023",62,0)
 ;
"RTN","RORX023",63,0)
HCVSVR(RORTSK) ;
"RTN","RORX023",64,0)
 N RORLTST       ; Closed root of the list of lab tests for the
"RTN","RORX023",65,0)
 ;               ; Lab search API
"RTN","RORX023",66,0)
 N RORREG        ; Registry IEN
"RTN","RORX023",67,0)
 N RORSDT       ; Pharmacy start date
"RTN","RORX023",68,0)
 N ROREDT       ; Pharmacy end date
"RTN","RORX023",69,0)
 N RORXGRP       ; List of drug groups
"RTN","RORX023",70,0)
 N RORXL         ; Closed root of the drug list for the pharmacy
"RTN","RORX023",71,0)
 ;               ; search API 
"RTN","RORX023",72,0)
 N ECNT,NSPT,RC,SFLAGS,TMP,BUF,RORXEDT,RORXSDT
"RTN","RORX023",73,0)
 N REPORT,PARAMS,ELEMENT  ;XML parent variables
"RTN","RORX023",74,0)
 ;
"RTN","RORX023",75,0)
 S (RORXL,RORLTST)="",(ECNT,RC)=0
"RTN","RORX023",76,0)
 K ^TMP("RORX023",$J)
"RTN","RORX023",77,0)
 ;--- Root node of the report
"RTN","RORX023",78,0)
 S REPORT=$$ADDVAL^RORTSK11(RORTSK,"REPORT")
"RTN","RORX023",79,0)
 Q:REPORT<0 REPORT
"RTN","RORX023",80,0)
 ;
"RTN","RORX023",81,0)
 ;--- Get and prepare the report parameters
"RTN","RORX023",82,0)
 D
"RTN","RORX023",83,0)
 . S RORREG=$$PARAM^RORTSK01("REGIEN")  ; Registry IEN
"RTN","RORX023",84,0)
 . S PARAMS=$$PARAMS^RORXU002(.RORTSK,REPORT,.RORXSDT,.RORXEDT,.SFLAGS)
"RTN","RORX023",85,0)
 . Q:PARAMS<0
"RTN","RORX023",86,0)
 . S TMP=""
"RTN","RORX023",87,0)
 . F  S TMP=$O(BUF(TMP))  Q:TMP=""  D  Q:RC<0
"RTN","RORX023",88,0)
 . . S RC=$$ADDATTR^RORTSK11(RORTSK,ELEMENT,TMP,BUF(TMP))
"RTN","RORX023",89,0)
 . ;--- Report header
"RTN","RORX023",90,0)
 . S RC=$$HEADER(REPORT)  Q:RC<0
"RTN","RORX023",91,0)
 . ;--- Query the registry
"RTN","RORX023",92,0)
 . D TPPSETUP^RORTSK01(80)
"RTN","RORX023",93,0)
 . S RC=$$QUERY^RORX023A(REPORT,SFLAGS,.NSPT)
"RTN","RORX023",94,0)
 . I RC Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX023",95,0)
 . ;--- Store the results
"RTN","RORX023",96,0)
 . D TPPSETUP^RORTSK01(20)
"RTN","RORX023",97,0)
 . S RC=$$STORE^RORX023A(REPORT,NSPT)
"RTN","RORX023",98,0)
 . I RC Q:RC<0  S ECNT=ECNT+RC
"RTN","RORX023",99,0)
 ;
"RTN","RORX023",100,0)
 ;--- Cleanup
"RTN","RORX023",101,0)
 K ^TMP("RORX023",$J)
"RTN","RORX023",102,0)
 ;
"RTN","RORX023",103,0)
 Q $S(RC<0:RC,ECNT>0:-43,1:0)
"RTN","RORX023A")
0^50^B138370750^B122090515
"RTN","RORX023A",1,0)
RORX023A ;ALB/TMK - HCV SUSTAINED VIROLOGIC RESPONSE REPORT(QUERY & STORE) ;7/15/11 3:37pm
"RTN","RORX023A",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**24,27,31**;Feb 17, 2006;Build 62
"RTN","RORX023A",3,0)
 ;
"RTN","RORX023A",4,0)
 ; This routine uses the following IAs:
"RTN","RORX023A",5,0)
 ;
"RTN","RORX023A",6,0)
 ; #10103 FMADD^XLFDT (supported)
"RTN","RORX023A",7,0)
 ; #10104 UP^XLFSTR (supported)
"RTN","RORX023A",8,0)
 ;   
"RTN","RORX023A",9,0)
 ;******************************************************************************
"RTN","RORX023A",10,0)
 ;******************************************************************************
"RTN","RORX023A",11,0)
 ;                 --- ROUTINE MODIFICATION LOG ---
"RTN","RORX023A",12,0)
 ;        
"RTN","RORX023A",13,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORX023A",14,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","RORX023A",15,0)
 ;ROR*1.5*24   JUN 2014    T KOPP       New report
"RTN","RORX023A",16,0)
 ;ROR*1.5*27   FEB 2015    T KOPP       Fix selection of SVR chg ">" to "<" 
"RTN","RORX023A",17,0)
 ;                                      at LTSCB+11 and pull SVR/NO SVR logic
"RTN","RORX023A",18,0)
 ;                                      into callable function $$SVR
"RTN","RORX023A",19,0)
 ;ROR*1.5*31   MAY 2017    M FERRARESE  Adding PACT, PCP, and AGE/DOB as additional
"RTN","RORX023A",20,0)
 ;                                      identifiers. 
"RTN","RORX023A",21,0)
 ;                                      
"RTN","RORX023A",22,0)
 ;******************************************************************************
"RTN","RORX023A",23,0)
 ;******************************************************************************
"RTN","RORX023A",24,0)
 Q
"RTN","RORX023A",25,0)
 ;
"RTN","RORX023A",26,0)
 ;***** LAB SEARCH CALLBACK
"RTN","RORX023A",27,0)
 ;
"RTN","RORX023A",28,0)
 ; .ROR8DST      Reference to the ROR8DST parameter.
"RTN","RORX023A",29,0)
 ;
"RTN","RORX023A",30,0)
 ; INVDT         IEN of the Lab test (inverted date)
"RTN","RORX023A",31,0)
 ;
"RTN","RORX023A",32,0)
 ; .RESULT       Reference to a local variable, which contains
"RTN","RORX023A",33,0)
 ;               the result (see the $$LTSEARCH^RORUTL10).
"RTN","RORX023A",34,0)
 ;
"RTN","RORX023A",35,0)
 ; Return Values:
"RTN","RORX023A",36,0)
 ;       <0  Error code (the search will be aborted)
"RTN","RORX023A",37,0)
 ;        0  Ok
"RTN","RORX023A",38,0)
 ;        1  Skip this result
"RTN","RORX023A",39,0)
 ;        2  Skip this and all remaining results
"RTN","RORX023A",40,0)
 ;
"RTN","RORX023A",41,0)
LTSCB(ROR8DST,INVDT,RESULT) ;
"RTN","RORX023A",42,0)
 N DATE,IEN,NAME,RC,TMP,VAL,CAT,SUB
"RTN","RORX023A",43,0)
 S IEN=+RESULT(2)           Q:IEN'>0 1   ; IEN of the Lab test
"RTN","RORX023A",44,0)
 S NAME=$P(RESULT(2),U,2)   Q:NAME="" 1  ; Name of the test
"RTN","RORX023A",45,0)
 S DATE=+$P(RESULT(1),U,1)  Q:DATE'>0 1  ; Date of the test
"RTN","RORX023A",46,0)
 S CAT=$P(RESULT(2),U,4)    Q:CAT="" 1   ; Category(lab group) of the test
"RTN","RORX023A",47,0)
 S VAL=$P(RESULT(1),U,3)    Q:VAL="" 1   ; Result of the test
"RTN","RORX023A",48,0)
 ;--- Skip if test is not in lab groups HepC GT, Quant, or Qual
"RTN","RORX023A",49,0)
 S TMP=0
"RTN","RORX023A",50,0)
 I CAT'="HepC GT",(CAT'="HepC Quant"),(CAT'="HepC Qual") S TMP=1
"RTN","RORX023A",51,0)
 I 'TMP,CAT'="HepC GT" D
"RTN","RORX023A",52,0)
 . S TMP=$S($E(VAL)="<":0,VAL["NOT DETECT":0,VAL["NO HCV RNA":0,VAL["NO RNA":0,$E(VAL,1,3)="NEG":0,VAL["NEGATIVE":0,VAL["NO_HCV_RNA_DETECTED":0,VAL["TND":0,1:1)
"RTN","RORX023A",53,0)
 I 'TMP,+VAL=VAL,VAL<51 S TMP=1  ;skip abnormally low values
"RTN","RORX023A",54,0)
 I TMP Q 1
"RTN","RORX023A",55,0)
 S SUB=$S(CAT="HepC GT":"GT",1:"HepC")
"RTN","RORX023A",56,0)
 ;--- Store the result
"RTN","RORX023A",57,0)
 S @ROR8DST@(SUB,DATE)=VAL
"RTN","RORX023A",58,0)
 Q 0
"RTN","RORX023A",59,0)
 ;
"RTN","RORX023A",60,0)
 ;***** QUERIES THE REGISTRY
"RTN","RORX023A",61,0)
 ; REPORT        Parent IEN of report
"RTN","RORX023A",62,0)
 ; FLAGS         Flags for the $$SKIP^RORXU005
"RTN","RORX023A",63,0)
 ; .NSPT         Number of selected patients is returned here
"RTN","RORX023A",64,0)
 ;
"RTN","RORX023A",65,0)
 ; Return Values:
"RTN","RORX023A",66,0)
 ;       <0  Fatal error
"RTN","RORX023A",67,0)
 ;        0  Ok
"RTN","RORX023A",68,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX023A",69,0)
 ;
"RTN","RORX023A",70,0)
 ;  Assumes RORREG = the ien of the ROR REGISTER PARAMETERS entry in file 798.1 being processed
"RTN","RORX023A",71,0)
QUERY(REPORT,FLAGS,NSPT) ;
"RTN","RORX023A",72,0)
 N RORLDST       ; Descriptor for Lab search API
"RTN","RORX023A",73,0)
 N RORPTN        ; Number of patients in the registry
"RTN","RORX023A",74,0)
 N RORXDST       ; Descriptor for pharmacy search API
"RTN","RORX023A",75,0)
 N RORCDLIST     ; Flag to indicate whether a clinic or division list exists
"RTN","RORX023A",76,0)
 N RORCDSTDT     ; Start date for clinic/division utilization search
"RTN","RORX023A",77,0)
 N RORCDENDT     ; End date for clinic/division utilization search
"RTN","RORX023A",78,0)
 N RORXEDT       ; RX end date
"RTN","RORX023A",79,0)
 N RORXSDT       ; RX start date
"RTN","RORX023A",80,0)
 ;
"RTN","RORX023A",81,0)
 N CNT,ECNT,IEN,IENS,LTEDT,LTSDT,PATIEN,RC,RXEDT,SKIP,TMP,UTEDT,UTIL,UTSDT,VA,VADM,XREFNODE
"RTN","RORX023A",82,0)
 N RCC,FLAG,HCV,GT,ROR1,ROR2,ROR3,RORX023,RORTAKN,RORXL
"RTN","RORX023A",83,0)
 S XREFNODE=$NA(^RORDATA(798,"AC",+RORREG))
"RTN","RORX023A",84,0)
 S (CNT,ECNT,NSPT,RC)=0,(UTEDT,UTSDT)=0,RORX023=1
"RTN","RORX023A",85,0)
 ;=== Set up parameters
"RTN","RORX023A",86,0)
 ;--- Utilization date range
"RTN","RORX023A",87,0)
 D:$$PARAM^RORTSK01("PATIENTS","CAREONLY")
"RTN","RORX023A",88,0)
 . S UTSDT=$$PARAM^RORTSK01("DATE_RANGE_3","START")\1
"RTN","RORX023A",89,0)
 . S UTEDT=$$PARAM^RORTSK01("DATE_RANGE_3","END")\1
"RTN","RORX023A",90,0)
 ;--- Number of patients in the registry
"RTN","RORX023A",91,0)
 S RORPTN=$$REGSIZE^RORUTL02(+RORREG)  S:RORPTN<0 RORPTN=0
"RTN","RORX023A",92,0)
 ;--- Lab parameters
"RTN","RORX023A",93,0)
 S RORLDST("RORCB")="$$LTSCB^RORX023A"
"RTN","RORX023A",94,0)
 ;--- Labs date range
"RTN","RORX023A",95,0)
 S LTSDT=""
"RTN","RORX023A",96,0)
 S LTEDT=DT
"RTN","RORX023A",97,0)
 ;--- Shift the Labs end date
"RTN","RORX023A",98,0)
 S LTEDT=$$FMADD^XLFDT(LTEDT,1)
"RTN","RORX023A",99,0)
 ;== Pharm parameters
"RTN","RORX023A",100,0)
 S RORXDST("GENERIC")=1  ;only meds with generic name
"RTN","RORX023A",101,0)
 S RORXDST("RORCB")="$$RXOCB^RORX023A"   ;call back routine
"RTN","RORX023A",102,0)
 ;--- RX start and end dates
"RTN","RORX023A",103,0)
 S RORXSDT=2000101  ;start date 1/1/1900
"RTN","RORX023A",104,0)
 S RORXEDT=DT
"RTN","RORX023A",105,0)
 ;--- RX list of HepC registry drugs
"RTN","RORX023A",106,0)
 S RORXL=$$ALLOC^RORTMP()
"RTN","RORX023A",107,0)
 S RC=$$DRUGLIST^RORUTL16(RORXL,+RORREG)
"RTN","RORX023A",108,0)
 ;--- Shift the RXs end date
"RTN","RORX023A",109,0)
 S RORXEDT=$$FMADD^XLFDT(RORXEDT\1,1)
"RTN","RORX023A",110,0)
 ;--- Set up Clinic/Division list parameters date_range_3
"RTN","RORX023A",111,0)
 S RORCDLIST=$$CDPARMS^RORXU001(.RORTSK,.RORCDSTDT,.RORCDENDT,1)
"RTN","RORX023A",112,0)
 ;--- Set up ICD parameters
"RTN","RORX023A",113,0)
 S FLAG=$G(RORTSK("PARAMS","ICDFILT","A","FILTER"))
"RTN","RORX023A",114,0)
 ;=== Browse through the registry records
"RTN","RORX023A",115,0)
 S IEN=0
"RTN","RORX023A",116,0)
 F  S IEN=$O(@XREFNODE@(IEN))  Q:IEN'>0  D  Q:RC<0
"RTN","RORX023A",117,0)
 . S TMP=$S(RORPTN>0:CNT/RORPTN,1:"")
"RTN","RORX023A",118,0)
 . S RC=$$LOOP^RORTSK01(TMP)  Q:RC<0
"RTN","RORX023A",119,0)
 . S IENS=IEN_",",CNT=CNT+1
"RTN","RORX023A",120,0)
 . ;--- Get patient DFN
"RTN","RORX023A",121,0)
 . S PATIEN=$$PTIEN^RORUTL01(IEN)  Q:PATIEN'>0
"RTN","RORX023A",122,0)
 . I +$P($G(^DPT(PATIEN,.35)),U)>0 Q  ;patient has died
"RTN","RORX023A",123,0)
 . ;--- Check if the patient should be skipped based on standard filters
"RTN","RORX023A",124,0)
 . Q:$$SKIP^RORXU005(IEN,FLAGS,UTSDT,UTEDT)
"RTN","RORX023A",125,0)
 . ;--- Check if patient should be skipped because of ICD codes
"RTN","RORX023A",126,0)
 . S RCC=0
"RTN","RORX023A",127,0)
 . I FLAG'="ALL" D
"RTN","RORX023A",128,0)
 . . S RCC=$$ICD^RORXU010(PATIEN)
"RTN","RORX023A",129,0)
 . I (FLAG="INCLUDE")&(RCC=0) Q
"RTN","RORX023A",130,0)
 . I (FLAG="EXCLUDE")&(RCC=1) Q
"RTN","RORX023A",131,0)
 . ;
"RTN","RORX023A",132,0)
 . ;--- Check if patient should be skipped because of Clinic or Division 
"RTN","RORX023A",133,0)
 . I RORCDLIST,'$$CDUTIL^RORXU001(.RORTSK,PATIEN,RORCDSTDT,RORCDENDT) Q
"RTN","RORX023A",134,0)
 . ;=== Check meds and labs
"RTN","RORX023A",135,0)
 . ; Find last date HepC registry meds were taken, add 84 days to the date of the last med fill/refill plus the days supply
"RTN","RORX023A",136,0)
 . ; Include in report if the patient has selected HepC Quant or HepC Qual lab results:
"RTN","RORX023A",137,0)
 . ;  Result either starts with a <   -- OR -- includes the phrase "NOT DETECT" or "NO HCV RNA" or "NO RNA" or "NEGATIVE" 
"RTN","RORX023A",138,0)
 . ; -- OR -- starts "NEG"  -- OR -- = "NO_HCV_RNA_DETECTED" or "TND".) and the last result was on or after 84 days past
"RTN","RORX023A",139,0)
 . ; the last date registry med was taken calculated date.
"RTN","RORX023A",140,0)
 . ;
"RTN","RORX023A",141,0)
 . S SKIP=1,UTIL=0
"RTN","RORX023A",142,0)
 . D  I RC<0  S ECNT=ECNT+1,RC=0  Q
"RTN","RORX023A",143,0)
 . . N RORCHK
"RTN","RORX023A",144,0)
 . . S RORCHK=$$SVR(PATIEN,RORXSDT,RORXEDT,RORREG,RORXL,LTSDT,LTEDT,.RORLDST,.RORXDST),RC=RORCHK
"RTN","RORX023A",145,0)
 . . I RORCHK<0 Q  ;error
"RTN","RORX023A",146,0)
 . . I RORCHK S SKIP=0 ; SVR criteria met - don't skip
"RTN","RORX023A",147,0)
 . ;
"RTN","RORX023A",148,0)
 . ;--- Check if patient should be skipped because no utilization in the corresponding date range
"RTN","RORX023A",149,0)
 . I 'SKIP D:$$PARAM^RORTSK01("PATIENTS","CAREONLY")
"RTN","RORX023A",150,0)
 . . K TMP  S TMP("ALL")=1
"RTN","RORX023A",151,0)
 . . S UTIL=+$$UTIL^RORXU003(UTSDT,UTEDT,PATIEN,.TMP)
"RTN","RORX023A",152,0)
 . . S:'UTIL SKIP=1
"RTN","RORX023A",153,0)
 . ;
"RTN","RORX023A",154,0)
 . ;--- Skip the patient if not all selection criteria have been met
"RTN","RORX023A",155,0)
 . I SKIP K ^TMP("RORX023",$J,"PAT",PATIEN) Q
"RTN","RORX023A",156,0)
 . ;
"RTN","RORX023A",157,0)
 . ;--- Get and store the patient's data  last4^name
"RTN","RORX023A",158,0)
 . D VADEM^RORUTL05(PATIEN,1)
"RTN","RORX023A",159,0)
 . S TMP=$S($$PARAM^RORTSK01("PATIENTS","ICN"):$$ICN^RORUTL02(PATIEN),1:"")
"RTN","RORX023A",160,0)
 . S TMP=TMP_U_$S($$PARAM^RORTSK01("PATIENTS","PACT"):$$PACT^RORUTL02(PATIEN),1:"")
"RTN","RORX023A",161,0)
 . S TMP=TMP_U_$S($$PARAM^RORTSK01("PATIENTS","PCP"):$$PCP^RORUTL02(PATIEN),1:"")
"RTN","RORX023A",162,0)
 . S AGETYPE=$$PARAM^RORTSK01("AGE_RANGE","TYPE") D
"RTN","RORX023A",163,0)
 . . S AGE=$S(AGETYPE="AGE":$P(VADM(4),U),AGETYPE="DOB":$$DATE^RORXU002($P(VADM(3),U)\1),1:"")
"RTN","RORX023A",164,0)
 . S ^TMP("RORX023",$J,"PAT",PATIEN)=VA("BID")_U_VADM(1)_U_U_TMP_U_AGE
"RTN","RORX023A",165,0)
 . S NSPT=NSPT+1   ;increment count of selected patients
"RTN","RORX023A",166,0)
 ;
"RTN","RORX023A",167,0)
 D FREE^RORTMP(RORXL)  ;clean up drug list
"RTN","RORX023A",168,0)
 Q $S(RC<0:RC,1:ECNT)
"RTN","RORX023A",169,0)
 ;
"RTN","RORX023A",170,0)
 ;***** CALLBACK FUNCTION FOR THE PHARMACY SEARCH API
"RTN","RORX023A",171,0)
 ;
"RTN","RORX023A",172,0)
 ; Need to identify the 
"RTN","RORX023A",173,0)
 ;
"RTN","RORX023A",174,0)
 ;                .ROR8DST      Reference to the ROR8DST parameter.
"RTN","RORX023A",175,0)
 ;
"RTN","RORX023A",176,0)
 ;
"RTN","RORX023A",177,0)
 ;                 ORDER         Order number (from condensed list)
"RTN","RORX023A",178,0)
 ;
"RTN","RORX023A",179,0)
 ;                 FLAGS         Flags describing the order to be
"RTN","RORX023A",180,0)
 ;                               processed.
"RTN","RORX023A",181,0)
 ;
"RTN","RORX023A",182,0)
 ;                 DRUG          Dispensed drug
"RTN","RORX023A",183,0)
 ;                                 ^01: Drug IEN in file #50
"RTN","RORX023A",184,0)
 ;                                 ^02: Drug name
"RTN","RORX023A",185,0)
 ;
"RTN","RORX023A",186,0)
 ;                 DATE          Order date (issue date for outpatient
"RTN","RORX023A",187,0)
 ;                               drugs or start date for inpatient)
"RTN","RORX023A",188,0)
 ;
"RTN","RORX023A",189,0)
 ;Return Values:
"RTN","RORX023A",190,0)
 ;       <0  Error code (the search will be aborted)
"RTN","RORX023A",191,0)
 ;        0  Ok
"RTN","RORX023A",192,0)
 ;        1  Skip this result
"RTN","RORX023A",193,0)
 ;        2  Skip this and all remaining results
"RTN","RORX023A",194,0)
 ;
"RTN","RORX023A",195,0)
RXOCB(ROR8DST,ORDER,ORDFLG,DRUG,DATE) ;
"RTN","RORX023A",196,0)
 N DRUGIEN,DRUGNAME,IEN,IRP,OFD,RPSUB,RXBUF,RXCNT,RXNUM,RORDS,RORTAKEN,TMP
"RTN","RORX023A",197,0)
 ;--- Skip med if med does not have a generic name
"RTN","RORX023A",198,0)
 I ROR8DST("GENERIC")  D
"RTN","RORX023A",199,0)
 . S DRUGIEN=+ROR8DST("RORXGEN"),DRUGNAME=$P(ROR8DST("RORXGEN"),U,2)
"RTN","RORX023A",200,0)
 E  Q 1
"RTN","RORX023A",201,0)
 Q:(DRUGIEN'>0)!(DRUGNAME="") 1
"RTN","RORX023A",202,0)
 ;--- Process the order
"RTN","RORX023A",203,0)
 S TMP=$G(^TMP("PS",$J,"RXN",0))
"RTN","RORX023A",204,0)
 S RXNUM=$P(TMP,U)  S:RXNUM="" RXNUM=" "
"RTN","RORX023A",205,0)
 S RXCNT=0
"RTN","RORX023A",206,0)
 ;--- Original prescription
"RTN","RORX023A",207,0)
 I ORDFLG["I"  D  ;--- Inpatient
"RTN","RORX023A",208,0)
 . S OFD=$P($G(^TMP("PS",$J,0)),U,5)         ; Start Date
"RTN","RORX023A",209,0)
 . S RORDS=$P($G(^TMP("PS",$J,0)),U,7)       ; Days supply
"RTN","RORX023A",210,0)
 . S RORTAKEN=$$FMADD^XLFDT(OFD,+RORDS)      ; Last date taken
"RTN","RORX023A",211,0)
 . S RXCNT=RXCNT+1
"RTN","RORX023A",212,0)
 . S @ROR8DST@(RORTAKEN)=""
"RTN","RORX023A",213,0)
 E  D             ;--- Outpatient
"RTN","RORX023A",214,0)
 . S OFD=+$P($G(^TMP("PS",$J,"RXN",0)),U,6)   ; Original Fill Date
"RTN","RORX023A",215,0)
 . S RORDS=$P($G(^TMP("PS",$J,0)),U,7)        ; Days supply
"RTN","RORX023A",216,0)
 . S RORTAKEN=$$FMADD^XLFDT(OFD,+RORDS)       ; Last date taken
"RTN","RORX023A",217,0)
 . Q:(OFD<ROR8DST("RORSDT"))!(OFD'<ROR8DST("ROREDT"))
"RTN","RORX023A",218,0)
 . S RXCNT=RXCNT+1
"RTN","RORX023A",219,0)
 . S @ROR8DST@(RORTAKEN)=""
"RTN","RORX023A",220,0)
 ;--- Refills and partials
"RTN","RORX023A",221,0)
 F RPSUB="REF","PAR"  D
"RTN","RORX023A",222,0)
 . S $P(RXBUF,U)=$E(RPSUB,1)
"RTN","RORX023A",223,0)
 . S IRP=0
"RTN","RORX023A",224,0)
 . F  S IRP=$O(^TMP("PS",$J,RPSUB,IRP))  Q:IRP'>0  D
"RTN","RORX023A",225,0)
 . . S TMP=$G(^TMP("PS",$J,RPSUB,IRP,0))
"RTN","RORX023A",226,0)
 . . I TMP>0  S RXCNT=RXCNT+1 D
"RTN","RORX023A",227,0)
 . . . S RORDS=$P(TMP,U,2)                           ; Days supply
"RTN","RORX023A",228,0)
 . . . S RORTAKEN=$$FMADD^XLFDT(+TMP,+RORDS)         ; Last date taken
"RTN","RORX023A",229,0)
 . . . S @ROR8DST@(RORTAKEN)=""
"RTN","RORX023A",230,0)
 Q 0
"RTN","RORX023A",231,0)
 ;
"RTN","RORX023A",232,0)
 ;***** CHECKS FOR SVR CRITERIA MET
"RTN","RORX023A",233,0)
 ;PATIEN the ien of patient entry from PATIENT file (#2)
"RTN","RORX023A",234,0)
 ;RORREG the ien of the ROR REGISTER PARAMETERS entry in file 798.1 being processed
"RTN","RORX023A",235,0)
 ;RORXL Closed root of the array containing RX list of HepC registry drugs from call to $$DRUGLIST^RORUTL1
"RTN","RORX023A",236,0)
 ;RORXEDT RX end date
"RTN","RORX023A",237,0)
 ;RORXSDT RX start date
"RTN","RORX023A",238,0)
 ;LTSDT  Labs start date
"RTN","RORX023A",239,0)
 ;LTEDT   Labs end date
"RTN","RORX023A",240,0)
 ;RORLDST  Descriptor for Lab search API
"RTN","RORX023A",241,0)
 ;RORXDST  Descriptor for pharmacy search API
"RTN","RORX023A",242,0)
 ;
"RTN","RORX023A",243,0)
 ;=== SVR criteria 'rules'
"RTN","RORX023A",244,0)
 ; Find last date HepC registry meds were taken, add the days supply to the date of the last med fill/refill
"RTN","RORX023A",245,0)
 ; Include in report if the patient has selected HepC Quant or HepC Qual lab results:
"RTN","RORX023A",246,0)
 ; Result either starts with a < -- OR -- includes the phrase "NOT DETECT" or "NO HCV RNA" or "NO RNA" or "NEGATIVE" 
"RTN","RORX023A",247,0)
 ; -- OR -- starts "NEG" -- OR -- = "NO_HCV_RNA_DETECTED" or "TND".) and the last result was on or after 84 days past
"RTN","RORX023A",248,0)
 ; the last date registry med was taken calculated date.
"RTN","RORX023A",249,0)
 ;
"RTN","RORX023A",250,0)
 ; Return Values:
"RTN","RORX023A",251,0)
 ; <0 Error code
"RTN","RORX023A",252,0)
 ; 0 SVR criteria not met
"RTN","RORX023A",253,0)
 ; 1 SVR criteria met
"RTN","RORX023A",254,0)
 ;
"RTN","RORX023A",255,0)
SVR(PATIEN,RORXSDT,RORXEDT,RORREG,RORXL,LTSDT,LTEDT,RORLDST,RORXDST) ; 
"RTN","RORX023A",256,0)
 N RC,RORLABDT,RORTAKN
"RTN","RORX023A",257,0)
 ; Get registry meds for patient
"RTN","RORX023A",258,0)
 S RORXDST=$NA(^TMP("RORX023",$J,"PAT",PATIEN,"RX"))
"RTN","RORX023A",259,0)
 S RC=$$RXSEARCH^RORUTL14(PATIEN,RORXL,.RORXDST,"EIOV",RORXSDT,RORXEDT)
"RTN","RORX023A",260,0)
 I RC<0 Q RC  ;error occurred
"RTN","RORX023A",261,0)
 I $G(RORXDST("SKIP"))!'$O(@RORXDST@("")) K RORXDST("SKIP") Q 0 ;patient never took or still takes registry meds
"RTN","RORX023A",262,0)
 ;
"RTN","RORX023A",263,0)
 S RORLDST=$NA(^TMP("RORX023",$J,"PAT",PATIEN,"LR"))
"RTN","RORX023A",264,0)
 S RC=$$LTSEARCH^RORUTL10(PATIEN,+RORREG,.RORLDST,,LTSDT,LTEDT)
"RTN","RORX023A",265,0)
 I RC<0 Q RC  ;error
"RTN","RORX023A",266,0)
 ;=== SVR if patient has a qualifying lab test at least 84 days past the last med taken date
"RTN","RORX023A",267,0)
 I '$O(@RORLDST@("HepC","")) Q 0  ; No lab result date
"RTN","RORX023A",268,0)
 S RORLABDT=(9999999-$O(@RORLDST@("HepC","")))/1 ; Data stored inversely, reverse to normal and strip time
"RTN","RORX023A",269,0)
 S RORTAKN=$O(@RORXDST@(" "),-1)
"RTN","RORX023A",270,0)
 I 'RORTAKN Q 0  ; No last taken date
"RTN","RORX023A",271,0)
 I RORLABDT<$$FMADD^XLFDT(RORTAKN,84) Q 0  ; No qualifying lab test at least 84 days past the last taken date
"RTN","RORX023A",272,0)
 Q 1
"RTN","RORX023A",273,0)
 ;
"RTN","RORX023A",274,0)
 ;***** STORES THE REPORT DATA
"RTN","RORX023A",275,0)
 ;
"RTN","RORX023A",276,0)
 ; REPORT        IEN of the REPORT element
"RTN","RORX023A",277,0)
 ; NSPT          Number of selected patients
"RTN","RORX023A",278,0)
 ;
"RTN","RORX023A",279,0)
 ; Return Values:
"RTN","RORX023A",280,0)
 ;       <0  Error code
"RTN","RORX023A",281,0)
 ;        0  Ok
"RTN","RORX023A",282,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX023A",283,0)
 ;
"RTN","RORX023A",284,0)
STORE(REPORT,NSPT) ;
"RTN","RORX023A",285,0)
 N RORFDT        ;med last taken date
"RTN","RORX023A",286,0)
 N RORLBG        ;lab test type (GT, HCV)
"RTN","RORX023A",287,0)
 N RORLVAL       ;lab value
"RTN","RORX023A",288,0)
 N RORLDST
"RTN","RORX023A",289,0)
 N RORXDST
"RTN","RORX023A",290,0)
 N RORICN
"RTN","RORX023A",291,0)
 N RORPACT
"RTN","RORX023A",292,0)
 N RORPCP
"RTN","RORX023A",293,0)
 N RORBODY,PTAG  ;parent iens
"RTN","RORX023A",294,0)
 N CNT,DATE,DFN,ECNT,IEN,LAST4,LTLST,NAME,NODE,PTCNT,PTLST,PTNAME,RC,RXLST,TMP,VAL,THIST,AGETYPE,AGE
"RTN","RORX023A",295,0)
 N GT,HCV,HCVHEPC
"RTN","RORX023A",296,0)
 S (ECNT,RC)=0,(LTLST,PTLST,RXLST)=-1
"RTN","RORX023A",297,0)
 ;--- Create 'patients' table
"RTN","RORX023A",298,0)
 S RORBODY=$$ADDVAL^RORTSK11(RORTSK,"PATIENTS",,REPORT)
"RTN","RORX023A",299,0)
 D ADDATTR^RORTSK11(RORTSK,RORBODY,"TABLE","PATIENTS")
"RTN","RORX023A",300,0)
 S (CNT,DFN,PTCNT)=0
"RTN","RORX023A",301,0)
 F  S DFN=$O(^TMP("RORX023",$J,"PAT",DFN))  Q:DFN'>0  D  Q:RC<0
"RTN","RORX023A",302,0)
 . S TMP=$S(NSPT>0:CNT/NSPT,1:"")
"RTN","RORX023A",303,0)
 . S RC=$$LOOP^RORTSK01(TMP)  Q:RC<0
"RTN","RORX023A",304,0)
 . S CNT=CNT+1,NODE=$NA(^TMP("RORX023",$J,"PAT",DFN))
"RTN","RORX023A",305,0)
 . ;--- Patient's data
"RTN","RORX023A",306,0)
 . S TMP=$G(@NODE)
"RTN","RORX023A",307,0)
 . S LAST4=$P(TMP,U),PTNAME=$P(TMP,U,2),RORICN=$P(TMP,U,4),RORPACT=$P(TMP,U,5),RORPCP=$P(TMP,U,6),AGE=$P(TMP,U,7)
"RTN","RORX023A",308,0)
 . ;--- get lab results
"RTN","RORX023A",309,0)
 . S RORLDST=$NA(^TMP("RORX023",$J,"PAT",DFN,"LR"))
"RTN","RORX023A",310,0)
 . S RORXDST=$NA(^TMP("RORX023",$J,"PAT",DFN,"RX"))
"RTN","RORX023A",311,0)
 . ;--- Gets most recent result for Qualifying HepC and GT lab tests
"RTN","RORX023A",312,0)
 . ;    HEPC=date of most recent quanitative or qualitative test^result
"RTN","RORX023A",313,0)
 . ;    GT=date of most recent GT test^result
"RTN","RORX023A",314,0)
 . K HEPC,GT
"RTN","RORX023A",315,0)
 . F RORLBG="HepC","GT" D
"RTN","RORX023A",316,0)
 . . S NODE=$$UP^XLFSTR(RORLBG),@NODE="^"
"RTN","RORX023A",317,0)
 . . S RORFDT=$O(@RORLDST@(RORLBG,""))
"RTN","RORX023A",318,0)
 . . Q:RORFDT=""
"RTN","RORX023A",319,0)
 . . S RORLVAL=$G(@RORLDST@(RORLBG,RORFDT))
"RTN","RORX023A",320,0)
 . . S RORFDT=(9999999-RORFDT)\1  ;strip time  
"RTN","RORX023A",321,0)
 . . S @NODE=(RORFDT)_U_RORLVAL
"RTN","RORX023A",322,0)
 . S PTAG=$$ADDVAL^RORTSK11(RORTSK,"PATIENT",,RORBODY,,DFN)
"RTN","RORX023A",323,0)
 . S RORFDT=$O(@RORXDST@(""),-1)
"RTN","RORX023A",324,0)
 . ;--- store
"RTN","RORX023A",325,0)
 . D ADDVAL^RORTSK11(RORTSK,"NAME",PTNAME,PTAG,1)
"RTN","RORX023A",326,0)
 . D ADDVAL^RORTSK11(RORTSK,"LAST4",LAST4,PTAG,2)
"RTN","RORX023A",327,0)
 . ;--- Patient age/DOB 
"RTN","RORX023A",328,0)
 . S AGETYPE=$$PARAM^RORTSK01("AGE_RANGE","TYPE") I AGETYPE'="ALL" D
"RTN","RORX023A",329,0)
 . . D ADDVAL^RORTSK11(RORTSK,AGETYPE,AGE,PTAG,1)
"RTN","RORX023A",330,0)
 . D ADDVAL^RORTSK11(RORTSK,"HCV_DATE",$P(HEPC,U),PTAG,1)
"RTN","RORX023A",331,0)
 . D ADDVAL^RORTSK11(RORTSK,"HCV",$P(HEPC,U,2),PTAG,3)
"RTN","RORX023A",332,0)
 . D ADDVAL^RORTSK11(RORTSK,"GT",$P(GT,U,2),PTAG,1)
"RTN","RORX023A",333,0)
 . D ADDVAL^RORTSK11(RORTSK,"LAST_TAKEN",RORFDT,PTAG,1)
"RTN","RORX023A",334,0)
 . I $$PARAM^RORTSK01("PATIENTS","ICN") D ADDVAL^RORTSK11(RORTSK,"ICN",RORICN,PTAG,1)
"RTN","RORX023A",335,0)
 . I $$PARAM^RORTSK01("PATIENTS","PACT") D ADDVAL^RORTSK11(RORTSK,"PACT",RORPACT,PTAG,1)
"RTN","RORX023A",336,0)
 . I $$PARAM^RORTSK01("PATIENTS","PCP") D ADDVAL^RORTSK11(RORTSK,"PCP",RORPCP,PTAG,1)
"RTN","RORX023A",337,0)
 . S PTCNT=PTCNT+1
"RTN","RORX023A",338,0)
 ;--- Inactivate the patient list tag if the list is empty
"RTN","RORX023A",339,0)
 D:PTCNT'>0 UPDVAL^RORTSK11(RORTSK,PTLST,,,1)
"RTN","RORX023A",340,0)
 ;---
"RTN","RORX023A",341,0)
 Q ECNT
"RTN","RORX024")
0^51^B77292615^B71003457
"RTN","RORX024",1,0)
RORX024 ;ALB/TK,MAF - HEP A VACCINE OR IMMUNITY REPORT ; 27 Jul 2016  3:03 PM
"RTN","RORX024",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**29,31**;Feb 17, 2006;Build 62
"RTN","RORX024",3,0)
 ;
"RTN","RORX024",4,0)
 ;******************************************************************************
"RTN","RORX024",5,0)
 ; This routine uses the following IAs:
"RTN","RORX024",6,0)
 ;
"RTN","RORX024",7,0)
 ; #10103 HL7TFM^XLFDT
"RTN","RORX024",8,0)
 ;
"RTN","RORX024",9,0)
 ;******************************************************************************
"RTN","RORX024",10,0)
 ;******************************************************************************
"RTN","RORX024",11,0)
 ;                       --- ROUTINE MODIFICATION LOG ---
"RTN","RORX024",12,0)
 ;        
"RTN","RORX024",13,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORX024",14,0)
 ;-----------  ----------  -----------  ---------------------------------------
"RTN","RORX024",15,0)
 ;ROR*1.5*29   APR 2016    T KOPP       Added 'Hep A vaccine or immunity report'
"RTN","RORX024",16,0)
 ;ROR*1.5*31   MAY 2017    M FERRARESE  Adding PACT, PCP, and AGE/DOB as additional
"RTN","RORX024",17,0)
 ;                                      identifiers.
"RTN","RORX024",18,0)
 ;
"RTN","RORX024",19,0)
 ;******************************************************************************
"RTN","RORX024",20,0)
 ;******************************************************************************
"RTN","RORX024",21,0)
 ;
"RTN","RORX024",22,0)
 Q
"RTN","RORX024",23,0)
 ;
"RTN","RORX024",24,0)
 ;***** COMPILES THE "HEP A VACCINE OR IMMUNITY" REPORT
"RTN","RORX024",25,0)
 ; REPORT CODE: 024
"RTN","RORX024",26,0)
 ;
"RTN","RORX024",27,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORX024",28,0)
 ;
"RTN","RORX024",29,0)
 ; The ^TMP("RORX024",$J) global node is used by this function.
"RTN","RORX024",30,0)
 ;
"RTN","RORX024",31,0)
 ; ^TMP("RORX024",$J,
"RTN","RORX024",32,0)
 ;   "PAT",
"RTN","RORX024",33,0)
 ;     DFN,              Patient descriptor
"RTN","RORX024",34,0)
 ;                         ^01: Last 4 digits of SSN
"RTN","RORX024",35,0)
 ;                         ^02: Patient name
"RTN","RORX024",36,0)
 ;                         ^03: Date of Death
"RTN","RORX024",37,0)
 ;                         ^04: ICN
"RTN","RORX024",38,0)
 ;                         ^05: Patient Care Team
"RTN","RORX024",39,0)
 ;                         ^06: Priamary Care Provider
"RTN","RORX024",40,0)
 ;                         ^07: Age/DOB
"RTN","RORX024",41,0)
 ;       "IMM")          Result if positive test found or "" if no positive test found
"RTN","RORX024",42,0)
 ;                         ^01: Local lab test name
"RTN","RORX024",43,0)
 ;                         ^02: Collected date (FM)
"RTN","RORX024",44,0)
 ;                         ^03: Lab test result
"RTN","RORX024",45,0)
 ;
"RTN","RORX024",46,0)
 ;       "VAC",           Number of results
"RTN","RORX024",47,0)
 ;                         ^01: #
"RTN","RORX024",48,0)
 ;           VaccineName, 
"RTN","RORX024",49,0)
 ;             VaccineDate) Always null if node exists
"RTN","RORX024",50,0)
 ;                         ^01: Null
"RTN","RORX024",51,0)
 ;
"RTN","RORX024",52,0)
 ; Return Values:
"RTN","RORX024",53,0)
 ;       <0  Error code
"RTN","RORX024",54,0)
 ;        0  Ok
"RTN","RORX024",55,0)
 ;
"RTN","RORX024",56,0)
HEPARPT(RORTSK) ;
"RTN","RORX024",57,0)
 N RORIMM        ; Immunity wanted mode (-1|0|1)  no|not selected|yes  (verified by lab test)
"RTN","RORX024",58,0)
 N RORVAC        ; Vaccination (-1|0|1)  not received|not selected|received  (verified by immunization record)
"RTN","RORX024",59,0)
 N RORREG        ; Registry IEN
"RTN","RORX024",60,0)
 N RORVEDT       ; Vaccination end date
"RTN","RORX024",61,0)
 N RORVSDT       ; Vaccination start date
"RTN","RORX024",62,0)
 N RORLEDT       ; Lab test/LOINC end date
"RTN","RORX024",63,0)
 N RORLSDT       ; Lab test/LOINC start date
"RTN","RORX024",64,0)
 N RORRTN        ; Routine to invoke for hep A processing
"RTN","RORX024",65,0)
 ;
"RTN","RORX024",66,0)
 N NSPT,RC,REPORT,SFLAGS,TMP
"RTN","RORX024",67,0)
 S RC=0,RORRTN="RORX024"
"RTN","RORX024",68,0)
 K ^TMP(RORRTN,$J)
"RTN","RORX024",69,0)
 ;--- Root node of the report
"RTN","RORX024",70,0)
 S REPORT=$$ADDVAL^RORTSK11(RORTSK,"REPORT")
"RTN","RORX024",71,0)
 Q:REPORT<0 REPORT
"RTN","RORX024",72,0)
 ;
"RTN","RORX024",73,0)
 D
"RTN","RORX024",74,0)
 . ;--- Get and prepare the report parameters
"RTN","RORX024",75,0)
 . S RORREG=$$PARAM^RORTSK01("REGIEN")  ; Registry IEN
"RTN","RORX024",76,0)
 . S RORVAC=$$RPTMODE("HEPAVAC")        ; Vaccination option chosen
"RTN","RORX024",77,0)
 . S RORIMM=$$RPTMODE("HEPAIMM")        ; Immunity option chosen
"RTN","RORX024",78,0)
 . S RC=$$PARAMS(REPORT,.RORVSDT,.RORVEDT,.SFLAGS)  Q:RC<0
"RTN","RORX024",79,0)
 . ;--- Report header
"RTN","RORX024",80,0)
 . S RC=$$HEADER(REPORT)  Q:RC<0
"RTN","RORX024",81,0)
 . ;--- Query the registry
"RTN","RORX024",82,0)
 . D TPPSETUP^RORTSK01(80)
"RTN","RORX024",83,0)
 . S RC=$$QUERY^RORX024A(SFLAGS,.NSPT,RORRTN)
"RTN","RORX024",84,0)
 . I RC Q:RC<0
"RTN","RORX024",85,0)
 . ;--- Store the results
"RTN","RORX024",86,0)
 . D TPPSETUP^RORTSK01(20)
"RTN","RORX024",87,0)
 . S RC=$$STORE^RORX024A(REPORT,NSPT,RORRTN)
"RTN","RORX024",88,0)
 . I RC Q:RC<0
"RTN","RORX024",89,0)
 ;
"RTN","RORX024",90,0)
 ;--- Cleanup
"RTN","RORX024",91,0)
 K ^TMP(RORRTN,$J)
"RTN","RORX024",92,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORX024",93,0)
 ;
"RTN","RORX024",94,0)
 ;
"RTN","RORX024",95,0)
 ;
"RTN","RORX024",96,0)
 ;***** OUTPUTS THE REPORT HEADER
"RTN","RORX024",97,0)
 ;
"RTN","RORX024",98,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX024",99,0)
 ;
"RTN","RORX024",100,0)
 ; Return Values:
"RTN","RORX024",101,0)
 ;       <0  Error code
"RTN","RORX024",102,0)
 ;       >0  IEN of the HEADER element
"RTN","RORX024",103,0)
 ;
"RTN","RORX024",104,0)
HEADER(PARTAG) ;
"RTN","RORX024",105,0)
 ;;PATIENTS(#,NAME,LAST4,AGE,DOD,VAC_NAME,VAC_DATE,LTNAME,DATE,RESULT,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="AGE"
"RTN","RORX024",106,0)
 ;;PATIENTS(#,NAME,LAST4,DOB,DOD,VAC_NAME,VAC_DATE,LTNAME,DATE,RESULT,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="DOB"
"RTN","RORX024",107,0)
 ;;PATIENTS(#,NAME,LAST4,DOD,VAC_NAME,VAC_DATE,LTNAME,DATE,RESULT,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="ALL"
"RTN","RORX024",108,0)
 ;
"RTN","RORX024",109,0)
 N HEADER,LN,RC,CTAG,LTAG
"RTN","RORX024",110,0)
 S HEADER=$$HEADER^RORXU002(.RORTSK,PARTAG)
"RTN","RORX024",111,0)
 Q:HEADER<0 HEADER
"RTN","RORX024",112,0)
 ;--- LOINC codes output
"RTN","RORX024",113,0)
 I $G(RORIMM) D
"RTN","RORX024",114,0)
 . S LTAG=$$ADDVAL^RORTSK11(RORTSK,"LOINC_CODES",,PARTAG)
"RTN","RORX024",115,0)
 . S LN=0 F  S LN=$O(^TMP("RORX024",$J,"IMM","TYPE",LN)) Q:'LN  D
"RTN","RORX024",116,0)
 . . S CTAG=$$ADDVAL^RORTSK11(RORTSK,"CODE",,LTAG)
"RTN","RORX024",117,0)
 . . D ADDATTR^RORTSK11(RORTSK,CTAG,"CODE",^TMP("RORX024",$J,"IMM","TYPE",LN))
"RTN","RORX024",118,0)
 S RC=$$TBLDEF^RORXU002("HEADER^RORX024",HEADER)
"RTN","RORX024",119,0)
 Q $S(RC<0:RC,1:HEADER)
"RTN","RORX024",120,0)
 ;
"RTN","RORX024",121,0)
 ;***** OUTPUTS THE PARAMETERS TO THE REPORT
"RTN","RORX024",122,0)
 ;
"RTN","RORX024",123,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX024",124,0)
 ;
"RTN","RORX024",125,0)
 ; [.STDT]       Start and end dates of the report
"RTN","RORX024",126,0)
 ; [.ENDT]       are returned via these parameters
"RTN","RORX024",127,0)
 ;
"RTN","RORX024",128,0)
 ; [.FLAGS]      Flags for the $$SKIP^RORXU005 are
"RTN","RORX024",129,0)
 ;               returned via this parameter
"RTN","RORX024",130,0)
 ;
"RTN","RORX024",131,0)
 ; Return Values:
"RTN","RORX024",132,0)
 ;       <0  Error code
"RTN","RORX024",133,0)
 ;       >0  IEN of the PARAMETERS element
"RTN","RORX024",134,0)
 ;
"RTN","RORX024",135,0)
PARAMS(PARTAG,STDT,ENDT,FLAGS) ;
"RTN","RORX024",136,0)
 N PARAMS,TMP
"RTN","RORX024",137,0)
 S PARAMS=$$PARAMS^RORXU002(.RORTSK,PARTAG,,,.FLAGS)
"RTN","RORX024",138,0)
 Q:PARAMS<0 PARAMS
"RTN","RORX024",139,0)
 ;--- Process the list of Lab tests/LOINC codes
"RTN","RORX024",140,0)
 I $G(RORIMM) D
"RTN","RORX024",141,0)
 . D GETIMM("RORX024") ;extract the immunity criteria for HEP A
"RTN","RORX024",142,0)
 ;--- Process the list of vaccinations
"RTN","RORX024",143,0)
 I $G(RORVAC) D
"RTN","RORX024",144,0)
 . D GETVAC("RORX024") ;extract the vaccine criteria for HEP A
"RTN","RORX024",145,0)
 ;---
"RTN","RORX024",146,0)
 Q PARAMS
"RTN","RORX024",147,0)
 ;
"RTN","RORX024",148,0)
 ;
"RTN","RORX024",149,0)
 ; -- Extract immunity (lab) data for a patient
"RTN","RORX024",150,0)
 ;
"RTN","RORX024",151,0)
 ; PATIEN        IEN of the patient (DFN)
"RTN","RORX024",152,0)
 ;
"RTN","RORX024",153,0)
 ; RORLOINC      Closed root of a variable, which contains a list
"RTN","RORX024",154,0)
 ;               of LOINC codes for HEP A or HEPB in the format
"RTN","RORX024",155,0)
 ;                          @RORLOINC@("VALID",i,
"RTN","RORX024",156,0)
 ;                                          ^01: LOINC code
"RTN","RORX024",157,0)
 ;                                   @("PRIORITY",LOINC code,priority)=""
"RTN","RORX024",158,0)
 ;
"RTN","RORX024",159,0)
 ;                      HEPA priority [0 for Ab Total or 1 for IgG]
"RTN","RORX024",160,0)
 ;                      HEPB priority [0 for Surface AB or 1 for Core AB]
"RTN","RORX024",161,0)
 ;
"RTN","RORX024",162,0)
 ; RORLRES  Closed root of an array where the data will be
"RTN","RORX024",163,0)
 ;               returned.
"RTN","RORX024",164,0)
 ;               The data will be stored into the destination
"RTN","RORX024",165,0)
 ;               array in following format:
"RTN","RORX024",166,0)
 ;
"RTN","RORX024",167,0)
 ;                    @RORLRES
"RTN","RORX024",168,0)
 ;                                 ^01: Local lab test name
"RTN","RORX024",169,0)
 ;                                 ^02: Collected date (FM)
"RTN","RORX024",170,0)
 ;                                 ^03: Lab test result
"RTN","RORX024",171,0)
 ;                             
"RTN","RORX024",172,0)
 ;  LTSDT        Lab test start date (FileMan)
"RTN","RORX024",173,0)
 ;  LTEDT        Lab test end date   (FileMan)
"RTN","RORX024",174,0)
 ;
"RTN","RORX024",175,0)
 ;  The function should return the following values:
"RTN","RORX024",176,0)
 ;
"RTN","RORX024",177,0)
 ;        <0 Error code (the search will be aborted)
"RTN","RORX024",178,0)
 ;         0 No immunity found
"RTN","RORX024",179,0)
 ;         1 At least 1 immunity found
"RTN","RORX024",180,0)
 ;
"RTN","RORX024",181,0)
LAB(PATIEN,RORLOINC,RORLRES,LTSDT,LTEDT) ;
"RTN","RORX024",182,0)
 N RC1,DFN,RORID,RORENDT,RORSTDT,ROR1,RESDT,RESULT,RORLRC,RORLAB,RORMSG,Z,Z0
"RTN","RORX024",183,0)
 ;
"RTN","RORX024",184,0)
 S DFN=PATIEN
"RTN","RORX024",185,0)
 ;
"RTN","RORX024",186,0)
 ; Search for specific LOINC codes and positive results
"RTN","RORX024",187,0)
 S RORLAB=$NA(^TMP("ROROUT",$J)) ;lab API output global
"RTN","RORX024",188,0)
 K RORMSG,@RORLAB ;initialize prior to call
"RTN","RORX024",189,0)
 ;---CALL LAB API---
"RTN","RORX024",190,0)
 M RORLRC=@RORLOINC@("VALID")
"RTN","RORX024",191,0)
 S RORLRC="CH,MI",RORLRES="",RORID=$$PTID^RORUTL02(DFN)
"RTN","RORX024",192,0)
 S RC1=$$GCPR^LA7QRY(RORID,LTSDT,LTEDT,.RORLRC,"*",.RORMSG,RORLAB)
"RTN","RORX024",193,0)
 I RC1<0 Q -1
"RTN","RORX024",194,0)
 Q:$D(@RORLAB)<10 0
"RTN","RORX024",195,0)
 ;Note: the Lab API returns data in the form of HL7 segments
"RTN","RORX024",196,0)
 N FS,TMP,LOINC,RESULT,RORLTN,RORVAL,RORNODE,RORSEG,SEGTYPE,RORDATE,RORX,RORX1
"RTN","RORX024",197,0)
 S FS="|" ;HL7 field separator for lab data
"RTN","RORX024",198,0)
 S (RORNODE,RESULT)=0
"RTN","RORX024",199,0)
 F  S RORNODE=$O(^TMP("ROROUT",$J,RORNODE)) Q:RORNODE=""  D
"RTN","RORX024",200,0)
 . S RORSEG=$G(^TMP("ROROUT",$J,RORNODE)) ;get entire HL7 segment
"RTN","RORX024",201,0)
 . S SEGTYPE=$P(RORSEG,FS,1) ;get segment type (PID,OBR,OBX,etc.)
"RTN","RORX024",202,0)
 . Q:SEGTYPE'="OBX"  ;we want OBX segments only
"RTN","RORX024",203,0)
 . S LOINC=$P($P(RORSEG,FS,4),U,1) ;get LOINC code for test
"RTN","RORX024",204,0)
 . Q:$S(LOINC="":1,1:'$D(@RORLOINC@("PRIORITY",LOINC)))  ; Call to lab does not filter out unwanted LOINCs
"RTN","RORX024",205,0)
 . S RORLTN=$P($P($P(RORSEG,FS,4),U,9),FS) ;local test name
"RTN","RORX024",206,0)
 . S RORVAL=$P(RORSEG,FS,6) ;test result value
"RTN","RORX024",207,0)
 . S RORVAL=$TR(RORVAL,"""","") ;get rid of double quotes around values
"RTN","RORX024",208,0)
 . Q:RORVAL=""  ;quit if no value
"RTN","RORX024",209,0)
 . ;Check if value meets the positive result criteria selected for immunity
"RTN","RORX024",210,0)
 . Q:'$$POS^RORX024A(RORVAL)
"RTN","RORX024",211,0)
 . S RORDATE=$$HL7TFM^XLFDT($E($P(RORSEG,FS,15),1,8)) ;get date collected
"RTN","RORX024",212,0)
 . ;S RORDATE=RORDATE\1
"RTN","RORX024",213,0)
 . ;Output the record into RORX by priority, date, LOINC Code if positive result
"RTN","RORX024",214,0)
 . S RORX(+$O(@RORLOINC@("PRIORITY",LOINC,0)),RORDATE,LOINC)=RORVAL_U_RORLTN
"RTN","RORX024",215,0)
 ; Find the result as the earliest date in priority 0 tests and if none, earliest in priority 1
"RTN","RORX024",216,0)
 F Z=1,2 S Z0=$O(RORX(Z,0)) I Z0 D  Q:RESULT
"RTN","RORX024",217,0)
 . S RORX1=$O(RORX(Z,Z0,0))
"RTN","RORX024",218,0)
 . Q:RORX1=""
"RTN","RORX024",219,0)
 . S RESULT=1,RORLRES=$P(RORX(Z,Z0,RORX1),U,2)_U_Z0_U_$P(RORX(Z,Z0,RORX1),U)
"RTN","RORX024",220,0)
 K @RORLAB
"RTN","RORX024",221,0)
 Q RESULT
"RTN","RORX024",222,0)
 ;
"RTN","RORX024",223,0)
 ;***** DETERMINES THE REPORT MODE FOR IMMUNITY OR VACCINATION
"RTN","RORX024",224,0)
 ;
"RTN","RORX024",225,0)
 ; NAME          Base name of the attribute ("HEPAIMM" or "HEPAVAC")
"RTN","RORX024",226,0)
 ;                                    OR    ("HEPBIMM" or "HEPBVAC")
"RTN","RORX024",227,0)
 ; Return Values:
"RTN","RORX024",228,0)
 ;       <0  "No"
"RTN","RORX024",229,0)
 ;        0  Not selected
"RTN","RORX024",230,0)
 ;       >0  "Yes"
"RTN","RORX024",231,0)
 ;
"RTN","RORX024",232,0)
RPTMODE(NAME) ;
"RTN","RORX024",233,0)
 Q:$$PARAM^RORTSK01("PATIENTS",NAME) 1        ; "Yes"
"RTN","RORX024",234,0)
 Q:$$PARAM^RORTSK01("PATIENTS","NO"_NAME) -1  ; "No"
"RTN","RORX024",235,0)
 Q 0
"RTN","RORX024",236,0)
 ;
"RTN","RORX024",237,0)
 ; ******* EXTRACT LOINC CODES FOR IMMUNITY ********
"RTN","RORX024",238,0)
 ; RORRTN = the name of the report routine where the IMMUNITY data should be extracted from
"RTN","RORX024",239,0)
 ;
"RTN","RORX024",240,0)
 ; Returns ^TMP(RORRTN,$J,"IMM","VALID",n)=LOINC code^LN     and
"RTN","RORX024",241,0)
 ;         ^TMP(RORRTN,$J,"IMM","PRIORITY",LOINC code,[0 for Total Ab or 1 for IgG])=""
"RTN","RORX024",242,0)
 ;         ^TMP(RORRTN,$J,"IMM","TYPE",n)=Type of LOINC: list of LOINC codes for type    (used for header output)
"RTN","RORX024",243,0)
 ;         
"RTN","RORX024",244,0)
 ;
"RTN","RORX024",245,0)
GETIMM(RORRTN) ;
"RTN","RORX024",246,0)
 N RORDATA,RORI,RORI1,COM,CT,Z
"RTN","RORX024",247,0)
 K ^TMP(RORRTN,$J,"IMM")
"RTN","RORX024",248,0)
 ;
"RTN","RORX024",249,0)
 I $E(RORRTN)=U S RORRTN=$P(RORRTN,U,2)
"RTN","RORX024",250,0)
 S CT=0
"RTN","RORX024",251,0)
 F RORI=1:1 S RORDATA=$P($T(@("IMMUNITY+"_RORI_U_RORRTN)),";;",2) Q:RORDATA=""  D
"RTN","RORX024",252,0)
 . S ^TMP(RORRTN,$J,"IMM","TYPE",RORI)=$P(RORDATA,U)_": ",COM=0
"RTN","RORX024",253,0)
 . F RORI1=2:1 S Z=$P(RORDATA,U,RORI1) Q:Z=""  D
"RTN","RORX024",254,0)
 . . S CT=CT+1,^TMP(RORRTN,$J,"IMM","VALID",CT)=Z_"^LN"
"RTN","RORX024",255,0)
 . . S ^TMP(RORRTN,$J,"IMM","PRIORITY",Z,RORI)=""
"RTN","RORX024",256,0)
 . . S ^TMP(RORRTN,$J,"IMM","TYPE",RORI)=^TMP(RORRTN,$J,"IMM","TYPE",RORI)_$S('COM:"",1:";")_Z,COM=1
"RTN","RORX024",257,0)
 ;
"RTN","RORX024",258,0)
 Q
"RTN","RORX024",259,0)
 ;
"RTN","RORX024",260,0)
 ; --  LOINC codes to check for HEP A immunity
"RTN","RORX024",261,0)
IMMUNITY ; List of LOINC codes indicating HEP A immunity results by type Line +1 = Total AB (priority), Line +2 = IgG
"RTN","RORX024",262,0)
 ;;Hepatitis A Ab Total^20575-7^13951-9^22312-3^5183-9^5184-7
"RTN","RORX024",263,0)
 ;;Hepatitis A IgG^32018-4^22313-1^5179-7
"RTN","RORX024",264,0)
 ;;
"RTN","RORX024",265,0)
 Q
"RTN","RORX024",266,0)
 ; ******* EXTRACT VACCINE NAMES ********
"RTN","RORX024",267,0)
 ; RORRTN = the name of the report routine where the IMMUNITY data should be extracted from
"RTN","RORX024",268,0)
 ;
"RTN","RORX024",269,0)
 ; Returns ^TMP(RORRTN,$J,"VAC",seq #)=pattern to match
"RTN","RORX024",270,0)
 ;
"RTN","RORX024",271,0)
GETVAC(RORRTN) ;  Extract pertinent vaccine names to match
"RTN","RORX024",272,0)
 N CT,CHAR,QUOTE,POS,RORDATA,RORI,RORI1,RESULT,VACNM,Z
"RTN","RORX024",273,0)
 ;
"RTN","RORX024",274,0)
 I $E(RORRTN="^") S RORRTN=$P(RORRTN,U,2)
"RTN","RORX024",275,0)
 S CT=0
"RTN","RORX024",276,0)
 F RORI=1:1 S RORDATA=$P($T(@("VACCINE+"_RORI_U_RORRTN)),";;",2) Q:RORDATA=""  D
"RTN","RORX024",277,0)
 . F RORI1=1:1 S VACNM=$P(RORDATA,U,RORI1) Q:VACNM=""  D
"RTN","RORX024",278,0)
 .. S RESULT=""
"RTN","RORX024",279,0)
 .. ; determine pattern
"RTN","RORX024",280,0)
 .. S QUOTE=0
"RTN","RORX024",281,0)
 .. F POS=1:1:$L(VACNM) S CHAR=$E(VACNM,POS) D
"RTN","RORX024",282,0)
 ... I POS=1,CHAR="%" S RESULT=".E" Q
"RTN","RORX024",283,0)
 ... I CHAR'="%" S RESULT=RESULT_$S('QUOTE:"1""",1:"")_CHAR,QUOTE=1 Q
"RTN","RORX024",284,0)
 ... I CHAR="%" D
"RTN","RORX024",285,0)
 .... I QUOTE S RESULT=RESULT_""""
"RTN","RORX024",286,0)
 .... S RESULT=RESULT_".E",QUOTE=0
"RTN","RORX024",287,0)
 .. I RESULT'="",QUOTE S RESULT=RESULT_""""
"RTN","RORX024",288,0)
 .. S CT=CT+1,^TMP(RORRTN,$J,"VAC",CT)=RESULT
"RTN","RORX024",289,0)
 ;
"RTN","RORX024",290,0)
 Q
"RTN","RORX024",291,0)
 ;
"RTN","RORX024",292,0)
 ; -- List of vaccines to include
"RTN","RORX024",293,0)
 ;  Business owner also requested (HEPATITIS A&B%, HEPATITIS A/B, HEPATITIS AB) that are the same as %HEPATITIS A%
"RTN","RORX024",294,0)
 ;                                (HEP A/HEP B%, HEP A&B, HEP A/HEP B) that are the same as HEP A%
"RTN","RORX024",295,0)
VACCINE ;  Hepatitis A vaccine names (% = wild card)
"RTN","RORX024",296,0)
 ;;HEP A%^%HEPATITIS A%^HEPATITIS-A%^HEPAADULT^HEPAADLT1^HEPA,%^HEPA/HEPB%^%HEP A/B%^HEPAB%^TWINRIX%
"RTN","RORX024",297,0)
 ;;
"RTN","RORX024",298,0)
 Q
"RTN","RORX024",299,0)
 ;
"RTN","RORX024A")
0^52^B88883037^B73730046
"RTN","RORX024A",1,0)
RORX024A ;ALB/TK,MAF - HEP A/B VACCINE/IMMUNITY REPORTS (QUERY & STORE) ; 27 Jul 2016  3:04 PM
"RTN","RORX024A",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**29,30,31**;Feb 17, 2006;Build 62
"RTN","RORX024A",3,0)
 ;
"RTN","RORX024A",4,0)
 ; This routine uses the following IAs:
"RTN","RORX024A",5,0)
 ;
"RTN","RORX024A",6,0)
 ; #10103 FMADD^XLFDT (supported)
"RTN","RORX024A",7,0)
 ; #2051  FIND1^DIC
"RTN","RORX024A",8,0)
 ;   
"RTN","RORX024A",9,0)
 ;******************************************************************************
"RTN","RORX024A",10,0)
 ;******************************************************************************
"RTN","RORX024A",11,0)
 ;                 --- ROUTINE MODIFICATION LOG ---
"RTN","RORX024A",12,0)
 ;        
"RTN","RORX024A",13,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORX024A",14,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","RORX024A",15,0)
 ;ROR*1.5*29   APR 2016    T KOPP       Added for Hep A/B vaccine/immunity reports
"RTN","RORX024A",16,0)
 ;ROR*1.5*30   MAR 2017    M FERRARESE  LOINC CODES result values changed to uppercase
"RTN","RORX024A",17,0)
 ;ROR*1.5*31   MAY 2017    M FERRARESE  Adding PACT, PCP, and AGE/DOB as additional
"RTN","RORX024A",18,0)
 ;                                      identifiers.
"RTN","RORX024A",19,0)
 ;******************************************************************************
"RTN","RORX024A",20,0)
 ;******************************************************************************
"RTN","RORX024A",21,0)
 Q
"RTN","RORX024A",22,0)
 ;
"RTN","RORX024A",23,0)
 ;***** QUERIES THE REGISTRY
"RTN","RORX024A",24,0)
 ;
"RTN","RORX024A",25,0)
 ; FLAGS         Flags for the $$SKIP^RORXU005
"RTN","RORX024A",26,0)
 ; .NSPT         Number of selected patients is returned here
"RTN","RORX024A",27,0)
 ; RORRTN        Routine name for Hep A (RORX024) or Hep B (RORX025) report
"RTN","RORX024A",28,0)
 ;
"RTN","RORX024A",29,0)
 ; Return Values:
"RTN","RORX024A",30,0)
 ;       <0  Error code
"RTN","RORX024A",31,0)
 ;        0  Ok
"RTN","RORX024A",32,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX024A",33,0)
 ;
"RTN","RORX024A",34,0)
QUERY(FLAGS,NSPT,RORRTN) ;
"RTN","RORX024A",35,0)
 N RORPTN        ; Number of patients in the registry
"RTN","RORX024A",36,0)
 N RORVSDT       ; Vaccination search start date
"RTN","RORX024A",37,0)
 N RORVEDT       ; Vaccination search end date
"RTN","RORX024A",38,0)
 N RORCDLIST     ; Flag to indicate whether a clinic or division list exists
"RTN","RORX024A",39,0)
 N RORCDSTDT     ; Start date for clinic/division utilization search
"RTN","RORX024A",40,0)
 N RORCDENDT     ; End date for clinic/division utilization search
"RTN","RORX024A",41,0)
 N RORICN        ; National ICN
"RTN","RORX024A",42,0)
 N RORPACT       ;Patient Care Team
"RTN","RORX024A",43,0)
 N RORPCP        ;Primary Care Provider
"RTN","RORX024A",44,0)
 N AGE,AGETYPE
"RTN","RORX024A",45,0)
 ;
"RTN","RORX024A",46,0)
 S:$G(RORRTN)="" RORRTN="RORX024"
"RTN","RORX024A",47,0)
 N CNT,IEN,IENS,LTEDT,LTSDT,RORHEPB,PATIEN,RC,SKIP,SKIPEDT,SKIPSDT,TMP,UTEDT,UTIL,UTSDT,VA,VADM,XREFNODE
"RTN","RORX024A",48,0)
 N RCC,FLAG
"RTN","RORX024A",49,0)
 S XREFNODE=$NA(^RORDATA(798,"AC",+RORREG))
"RTN","RORX024A",50,0)
 S (CNT,NSPT,RC,SKIPEDT,SKIPSDT)=0
"RTN","RORX024A",51,0)
 ;--- Utilization date range
"RTN","RORX024A",52,0)
 D:$$PARAM^RORTSK01("PATIENTS","CAREONLY")
"RTN","RORX024A",53,0)
 . S UTSDT=$$PARAM^RORTSK01("DATE_RANGE_3","START")\1
"RTN","RORX024A",54,0)
 . S UTEDT=$$PARAM^RORTSK01("DATE_RANGE_3","END")\1
"RTN","RORX024A",55,0)
 . ;--- Combined date range
"RTN","RORX024A",56,0)
 . S SKIPSDT=$$DTMIN^RORUTL18(SKIPSDT,UTSDT)
"RTN","RORX024A",57,0)
 . S SKIPEDT=$$DTMAX^RORUTL18(SKIPEDT,UTEDT)
"RTN","RORX024A",58,0)
 ;--- Number of patients in the registry
"RTN","RORX024A",59,0)
 S RORPTN=$$REGSIZE^RORUTL02(+RORREG)  S:RORPTN<0 RORPTN=0
"RTN","RORX024A",60,0)
 ;
"RTN","RORX024A",61,0)
 ;--- Setup the immunity and vaccination parameters
"RTN","RORX024A",62,0)
 I RORIMM  D
"RTN","RORX024A",63,0)
 . ;--- Lab/LOINC codes date range
"RTN","RORX024A",64,0)
 . S LTSDT=$$PARAM^RORTSK01("DATE_RANGE_7","START")\1
"RTN","RORX024A",65,0)
 . S LTEDT=$$PARAM^RORTSK01("DATE_RANGE_7","END")\1
"RTN","RORX024A",66,0)
 . ;--- Combined date range
"RTN","RORX024A",67,0)
 . S SKIPSDT=$$DTMIN^RORUTL18(SKIPSDT,LTSDT)
"RTN","RORX024A",68,0)
 . S SKIPEDT=$$DTMAX^RORUTL18(SKIPEDT,LTEDT)
"RTN","RORX024A",69,0)
 . ;--- Shift the Labs end date
"RTN","RORX024A",70,0)
 . S LTEDT=$$FMADD^XLFDT(LTEDT,1)
"RTN","RORX024A",71,0)
 I RORVAC  D
"RTN","RORX024A",72,0)
 . S RORVSDT=$$PARAM^RORTSK01("DATE_RANGE_6","START")\1
"RTN","RORX024A",73,0)
 . S RORVEDT=$$PARAM^RORTSK01("DATE_RANGE_6","END")\1
"RTN","RORX024A",74,0)
 . ;--- Combined date range
"RTN","RORX024A",75,0)
 . S SKIPSDT=$$DTMIN^RORUTL18(SKIPSDT,RORVSDT)
"RTN","RORX024A",76,0)
 . S SKIPEDT=$$DTMAX^RORUTL18(SKIPEDT,RORVEDT)
"RTN","RORX024A",77,0)
 . ;--- Shift the vaccine end date
"RTN","RORX024A",78,0)
 . S RORVEDT=$$FMADD^XLFDT(RORVEDT\1,1)
"RTN","RORX024A",79,0)
 Q:'(RORIMM!RORVAC) 0
"RTN","RORX024A",80,0)
 ;
"RTN","RORX024A",81,0)
 ;=== Set up Clinic/Division list parameters
"RTN","RORX024A",82,0)
 S RORCDLIST=$$CDPARMS^RORXU001(.RORTSK,.RORCDSTDT,.RORCDENDT,1)
"RTN","RORX024A",83,0)
 ;
"RTN","RORX024A",84,0)
 S RORHEPB=$S(RORRTN'="RORX024":"",1:$$FIND1^DIC(798.1,,"BQX","VA HEPB"))
"RTN","RORX024A",85,0)
 ;--- Browse through the registry records
"RTN","RORX024A",86,0)
 S IEN=0
"RTN","RORX024A",87,0)
 S FLAG=$G(RORTSK("PARAMS","ICDFILT","A","FILTER"))
"RTN","RORX024A",88,0)
 F  S IEN=$O(@XREFNODE@(IEN))  Q:IEN'>0  D  Q:RC<0
"RTN","RORX024A",89,0)
 . S TMP=$S(RORPTN>0:CNT/RORPTN,1:"")
"RTN","RORX024A",90,0)
 . S RC=$$LOOP^RORTSK01(TMP)  Q:RC<0
"RTN","RORX024A",91,0)
 . S IENS=IEN_",",CNT=CNT+1
"RTN","RORX024A",92,0)
 . ; Ignore patients in Hep B registry if Hep B report
"RTN","RORX024A",93,0)
 . I RORHEPB'="" Q:$D(^RORDATA(798,"AC",+RORHEPB,+IEN))
"RTN","RORX024A",94,0)
 . ;--- Get patient DFN
"RTN","RORX024A",95,0)
 . S PATIEN=$$PTIEN^RORUTL01(IEN)  Q:PATIEN'>0
"RTN","RORX024A",96,0)
 . ;check for patient list and quit if not on list
"RTN","RORX024A",97,0)
 . I $D(RORTSK("PARAMS","PATIENTS","C")),'$D(RORTSK("PARAMS","PATIENTS","C",PATIEN)) Q
"RTN","RORX024A",98,0)
 . ;--- Check if the patient should be skipped
"RTN","RORX024A",99,0)
 . Q:$$SKIP^RORXU005(IEN,FLAGS,SKIPSDT,SKIPEDT)
"RTN","RORX024A",100,0)
 . S SKIP=1,UTIL=0
"RTN","RORX024A",101,0)
 . ;--- Check if patient should be filtered because of ICD codes
"RTN","RORX024A",102,0)
 . S RCC=0
"RTN","RORX024A",103,0)
 . I FLAG'="ALL" D
"RTN","RORX024A",104,0)
 . . S RCC=$$ICD^RORXU010(PATIEN)
"RTN","RORX024A",105,0)
 . I (FLAG="INCLUDE")&(RCC=0) Q
"RTN","RORX024A",106,0)
 . I (FLAG="EXCLUDE")&(RCC=1) Q
"RTN","RORX024A",107,0)
 . ;
"RTN","RORX024A",108,0)
 . ;--- Check for Clinic or Division list and quit if not in list
"RTN","RORX024A",109,0)
 . I RORCDLIST,'$$CDUTIL^RORXU001(.RORTSK,PATIEN,RORCDSTDT,RORCDENDT) Q
"RTN","RORX024A",110,0)
 . ;
"RTN","RORX024A",111,0)
 . S RCC=0,SKIP=1
"RTN","RORX024A",112,0)
 . D
"RTN","RORX024A",113,0)
 . . ;--- Search for vaccination data in IMMUNIZATIONS file
"RTN","RORX024A",114,0)
 . . I RORVAC D  Q:RCC<0
"RTN","RORX024A",115,0)
 . . . N VAC,ROR8PAT,ROR8LST,RORVRES
"RTN","RORX024A",116,0)
 . . . S ROR8PAT=$NA(^TMP(RORRTN,$J,"VAC"))
"RTN","RORX024A",117,0)
 . . . S RORVRES=$NA(^TMP(RORRTN,$J,"VAC_RES")) K @RORVRES
"RTN","RORX024A",118,0)
 . . . S VAC=$$QUERY^RORUTL21(PATIEN,ROR8PAT,RORVRES,RORVSDT,RORVEDT)
"RTN","RORX024A",119,0)
 . . . I VAC<0 S RCC=-1 Q
"RTN","RORX024A",120,0)
 . . . I RORVAC<0,'VAC S ^TMP(RORRTN,$J,"PAT",PATIEN,"VAC")=0 Q     ; No vaccination requested and none found 
"RTN","RORX024A",121,0)
 . . . I RORVAC>0,VAC D  Q   ; Vaccination requested, at least one found
"RTN","RORX024A",122,0)
 . . . . S ROR8LST=$NA(^TMP(RORRTN,$J,"PAT",PATIEN,"VAC"))
"RTN","RORX024A",123,0)
 . . . . S RCC=$$PROCESS^RORUTL21(RORVRES,PATIEN,ROR8LST)
"RTN","RORX024A",124,0)
 . . . . K @RORVRES
"RTN","RORX024A",125,0)
 . . . . Q:RCC<0
"RTN","RORX024A",126,0)
 . . . S RCC=-1  ;does not pass vaccination selection criteria validation
"RTN","RORX024A",127,0)
 . . ;
"RTN","RORX024A",128,0)
 . . ;--- Search for lab data positive results for selected LOINC codes
"RTN","RORX024A",129,0)
 . . I RORIMM D  Q:RCC<0
"RTN","RORX024A",130,0)
 . . . N IMM,ROR8LST,RORLOINC,RORLRES
"RTN","RORX024A",131,0)
 . . . S RORLOINC=$NA(^TMP(RORRTN,$J,"IMM"))
"RTN","RORX024A",132,0)
 . . . ; Extract positive lab test results for selected LOINC codes
"RTN","RORX024A",133,0)
 . . . S IMM=$$LAB^RORX024(PATIEN,RORLOINC,.RORLRES,LTSDT,LTEDT)
"RTN","RORX024A",134,0)
 . . . I IMM<0 S RCC=-1 Q
"RTN","RORX024A",135,0)
 . . . I RORIMM<0,'IMM D  Q     ; No immunity requested and no positive test found
"RTN","RORX024A",136,0)
 . . . . S ^TMP(RORRTN,$J,"PAT",PATIEN,"IMM")=""
"RTN","RORX024A",137,0)
 . . . I RORIMM>0,IMM D  Q   ; Immunity requested, at least one positive lab test found
"RTN","RORX024A",138,0)
 . . . . S ^TMP(RORRTN,$J,"PAT",PATIEN,"IMM")=RORLRES
"RTN","RORX024A",139,0)
 . . . S RCC=-1  ;does not pass immunity selection criteria validation
"RTN","RORX024A",140,0)
 . . S SKIP=0
"RTN","RORX024A",141,0)
 . ;
"RTN","RORX024A",142,0)
 . ;--- Check for any utilization in the corresponding date range
"RTN","RORX024A",143,0)
 . I 'SKIP  D:$$PARAM^RORTSK01("PATIENTS","CAREONLY")
"RTN","RORX024A",144,0)
 . . K TMP  S TMP("ALL")=1
"RTN","RORX024A",145,0)
 . . S UTIL=+$$UTIL^RORXU003(UTSDT,UTEDT,PATIEN,.TMP)
"RTN","RORX024A",146,0)
 . . S:'UTIL SKIP=1
"RTN","RORX024A",147,0)
 . ;
"RTN","RORX024A",148,0)
 . ;--- Skip the patient if not all search criteria have been met
"RTN","RORX024A",149,0)
 . I SKIP K ^TMP(RORRTN,$J,"PAT",PATIEN) Q
"RTN","RORX024A",150,0)
 . ;
"RTN","RORX024A",151,0)
 . ;--- Get and store the patient's data
"RTN","RORX024A",152,0)
 . D VADEM^RORUTL05(PATIEN,1)
"RTN","RORX024A",153,0)
 . S RORICN=$S($$PARAM^RORTSK01("PATIENTS","ICN"):$$ICN^RORUTL02(PATIEN),1:"")
"RTN","RORX024A",154,0)
 . S RORPACT=$S($$PARAM^RORTSK01("PATIENTS","PACT"):$$PACT^RORUTL02(PATIEN),1:"")
"RTN","RORX024A",155,0)
 . S RORPCP=$S($$PARAM^RORTSK01("PATIENTS","PCP"):$$PCP^RORUTL02(PATIEN),1:"")
"RTN","RORX024A",156,0)
 . S TMP=$$DATE^RORXU002(VADM(6)\1)
"RTN","RORX024A",157,0)
 . ;
"RTN","RORX024A",158,0)
 . ;--- Patient age/DOB
"RTN","RORX024A",159,0)
 . S AGETYPE=$$PARAM^RORTSK01("AGE_RANGE","TYPE") D
"RTN","RORX024A",160,0)
 . . S AGE=$S(AGETYPE="AGE":$P(VADM(4),U),AGETYPE="DOB":$$DATE^RORXU002($P(VADM(3),U)\1),1:"")
"RTN","RORX024A",161,0)
 . ;
"RTN","RORX024A",162,0)
 . S ^TMP(RORRTN,$J,"PAT",PATIEN)=VA("BID")_U_VADM(1)_U_TMP_U_RORICN_U_RORPACT_U_RORPCP_U_AGE
"RTN","RORX024A",163,0)
 . S NSPT=NSPT+1
"RTN","RORX024A",164,0)
 ;
"RTN","RORX024A",165,0)
 ;---
"RTN","RORX024A",166,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORX024A",167,0)
 ;
"RTN","RORX024A",168,0)
POS(VAL) ; Returns 1 if lab test returns positive result (VAL)
"RTN","RORX024A",169,0)
 ;Positive results are results that are equal to "P" or contain "POS", "DETEC" or "REACT"
"RTN","RORX024A",170,0)
 ;         -- AND -- do not contain "NEG", "NO" or "IND." 
"RTN","RORX024A",171,0)
 N POS,X
"RTN","RORX024A",172,0)
 S POS=0
"RTN","RORX024A",173,0)
 S X=VAL
"RTN","RORX024A",174,0)
 S VAL=$TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","RORX024A",175,0)
 I VAL="P"!(VAL["POS")!(VAL["DETEC")!(VAL["REACT") D
"RTN","RORX024A",176,0)
 . I '(VAL["NEG"!(VAL["NO")!(VAL["IND.")) S POS=1
"RTN","RORX024A",177,0)
 Q POS
"RTN","RORX024A",178,0)
 ;
"RTN","RORX024A",179,0)
 ;***** STORES THE REPORT DATA
"RTN","RORX024A",180,0)
 ;
"RTN","RORX024A",181,0)
 ; REPORT        IEN of the REPORT element
"RTN","RORX024A",182,0)
 ; [.]NSPT       # of patients in registry
"RTN","RORX024A",183,0)
 ;
"RTN","RORX024A",184,0)
 ; Return Values:
"RTN","RORX024A",185,0)
 ;       <0  Error code
"RTN","RORX024A",186,0)
 ;        0  Ok
"RTN","RORX024A",187,0)
 ;       >0  Number of non-fatal errors
"RTN","RORX024A",188,0)
 ;
"RTN","RORX024A",189,0)
 ;
"RTN","RORX024A",190,0)
STORE(REPORT,NSPT,RORRTN) ;
"RTN","RORX024A",191,0)
 N CNT,DFN,DOD,ICN,ITEM,LAST4,NAME,NODE,PACT,PCP,PTCNT,PTLST,PTNAME,RC,VDATE,TMP,VAL,LTIMM,IMMLST,VACLST,VLST,AGETYPE,AGE
"RTN","RORX024A",192,0)
 S RC=0,PTLST=-1
"RTN","RORX024A",193,0)
 ;--- Force the "patient data" note in the output
"RTN","RORX024A",194,0)
 D ADDVAL^RORTSK11(RORTSK,"PATIENT",,REPORT)
"RTN","RORX024A",195,0)
 ;--- Create patient list
"RTN","RORX024A",196,0)
 S PTLST=$$ADDVAL^RORTSK11(RORTSK,"PATIENTS",,REPORT)
"RTN","RORX024A",197,0)
 D ADDATTR^RORTSK11(RORTSK,PTLST,"TABLE","PATIENTS")
"RTN","RORX024A",198,0)
 ;---
"RTN","RORX024A",199,0)
 S (CNT,DFN,PTCNT)=0
"RTN","RORX024A",200,0)
 F  S DFN=$O(^TMP(RORRTN,$J,"PAT",DFN))  Q:DFN'>0  D  Q:RC<0
"RTN","RORX024A",201,0)
 . S TMP=$S(NSPT>0:CNT/NSPT,1:"")
"RTN","RORX024A",202,0)
 . S RC=$$LOOP^RORTSK01(TMP)  Q:RC<0
"RTN","RORX024A",203,0)
 . S CNT=CNT+1,NODE=$NA(^TMP(RORRTN,$J,"PAT",DFN))
"RTN","RORX024A",204,0)
 . ;--- Patient's data
"RTN","RORX024A",205,0)
 . S TMP=$G(@NODE)
"RTN","RORX024A",206,0)
 . S LAST4=$P(TMP,U),PTNAME=$P(TMP,U,2),DOD=$P(TMP,U,3),ICN=$P(TMP,U,4),PACT=$P(TMP,U,5),PCP=$P(TMP,U,6),AGE=$P(TMP,U,7)
"RTN","RORX024A",207,0)
 . ;--- Patient list
"RTN","RORX024A",208,0)
 . S TMP=$S('RORIMM:1,RORIMM<0:$G(@NODE@("IMM"))="",1:$G(@NODE@("IMM"))'="")
"RTN","RORX024A",209,0)
 . I TMP,$S('RORVAC:1,RORVAC<0:'$G(@NODE@("VAC")),1:$G(@NODE@("VAC"))) D
"RTN","RORX024A",210,0)
 . . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"PATIENT",,PTLST,,DFN)
"RTN","RORX024A",211,0)
 . . D ADDVAL^RORTSK11(RORTSK,"NAME",PTNAME,ITEM,1)
"RTN","RORX024A",212,0)
 . . D ADDVAL^RORTSK11(RORTSK,"LAST4",LAST4,ITEM,2)
"RTN","RORX024A",213,0)
 . . ;--- Age/DOB
"RTN","RORX024A",214,0)
 . . S AGETYPE=$$PARAM^RORTSK01("AGE_RANGE","TYPE") I AGETYPE'="ALL" D
"RTN","RORX024A",215,0)
 . . . D ADDVAL^RORTSK11(RORTSK,AGETYPE,AGE,ITEM,1)
"RTN","RORX024A",216,0)
 . . ;
"RTN","RORX024A",217,0)
 . . D ADDVAL^RORTSK11(RORTSK,"DOD",DOD,ITEM,1)
"RTN","RORX024A",218,0)
 . . S PTCNT=PTCNT+1
"RTN","RORX024A",219,0)
 . ;--- List of vaccines
"RTN","RORX024A",220,0)
 . S VACLST=-1
"RTN","RORX024A",221,0)
 . I $O(@NODE@("VAC",""))'="" S VACLST=$$ADDVAL^RORTSK11(RORTSK,"VACCINES",,ITEM) Q:VACLST<0
"RTN","RORX024A",222,0)
 . I RORVAC=1,VACLST'<0 S NAME="" F  S NAME=$O(@NODE@("VAC",NAME)) Q:NAME=""  D
"RTN","RORX024A",223,0)
 . . S VLST=$$ADDVAL^RORTSK11(RORTSK,"VACCINE",,VACLST)
"RTN","RORX024A",224,0)
 . . Q:VLST<0
"RTN","RORX024A",225,0)
 . . S VDATE=0
"RTN","RORX024A",226,0)
 . . F  S VDATE=$O(@NODE@("VAC",NAME,VDATE))  Q:'VDATE  D
"RTN","RORX024A",227,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"VAC_NAME",NAME,VLST,1)
"RTN","RORX024A",228,0)
 . . . D ADDVAL^RORTSK11(RORTSK,"VAC_DATE",VDATE\1,VLST,1)
"RTN","RORX024A",229,0)
 . ;--- Immunity
"RTN","RORX024A",230,0)
 . I RORIMM=1,$G(@NODE@("IMM"))'="" D
"RTN","RORX024A",231,0)
 . . S IMMLST=$$ADDVAL^RORTSK11(RORTSK,"LABTESTS",,ITEM) Q:IMMLST<0
"RTN","RORX024A",232,0)
 . . S LTIMM=$G(@NODE@("IMM"))
"RTN","RORX024A",233,0)
 . . Q:LTIMM=""
"RTN","RORX024A",234,0)
 . . D ADDVAL^RORTSK11(RORTSK,"LTNAME",$P(LTIMM,U),IMMLST,1)
"RTN","RORX024A",235,0)
 . . D ADDVAL^RORTSK11(RORTSK,"DATE",$P(LTIMM,U,2)\1,IMMLST,1)
"RTN","RORX024A",236,0)
 . . S VAL=$P(LTIMM,U,3)
"RTN","RORX024A",237,0)
 . . S TMP=$S($$NUMERIC^RORUTL05(VAL):3,1:1)
"RTN","RORX024A",238,0)
 . . D ADDVAL^RORTSK11(RORTSK,"RESULT",VAL,IMMLST,TMP)
"RTN","RORX024A",239,0)
 . I $$PARAM^RORTSK01("PATIENTS","ICN") D ADDVAL^RORTSK11(RORTSK,"ICN",ICN,ITEM,1)
"RTN","RORX024A",240,0)
 . I $$PARAM^RORTSK01("PATIENTS","PACT") D ADDVAL^RORTSK11(RORTSK,"PACT",PACT,ITEM,1)
"RTN","RORX024A",241,0)
 . I $$PARAM^RORTSK01("PATIENTS","PCP") D ADDVAL^RORTSK11(RORTSK,"PCP",PCP,ITEM,1)
"RTN","RORX024A",242,0)
 ;--- Inactivate the patient list tag if the list is empty
"RTN","RORX024A",243,0)
 D:PTCNT'>0 UPDVAL^RORTSK11(RORTSK,PTLST,,,1)
"RTN","RORX024A",244,0)
 ;---
"RTN","RORX024A",245,0)
 Q 0
"RTN","RORX024A",246,0)
 ;
"RTN","RORX025")
0^48^B23252812^B19022640
"RTN","RORX025",1,0)
RORX025 ;ALB/TK,MAF - HEP B VACCINE OR IMMUNITY REPORT ;4/21/16 9:40am
"RTN","RORX025",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**29,31**;Feb 17, 2006;Build 62
"RTN","RORX025",3,0)
 ;
"RTN","RORX025",4,0)
 ;******************************************************************************
"RTN","RORX025",5,0)
 ;******************************************************************************
"RTN","RORX025",6,0)
 ;                       --- ROUTINE MODIFICATION LOG ---
"RTN","RORX025",7,0)
 ;        
"RTN","RORX025",8,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORX025",9,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","RORX025",10,0)
 ;ROR*1.5*29   APR 2016    T KOPP       Added 'Hep B vaccine or immunity report'
"RTN","RORX025",11,0)
 ;ROR*1.5*31   MAY 2017    M FERRARESE  Adding PACT, PCP, and AGE/DOB as additional
"RTN","RORX025",12,0)
 ;                                      identifiers.
"RTN","RORX025",13,0)
 ;******************************************************************************
"RTN","RORX025",14,0)
 ;******************************************************************************
"RTN","RORX025",15,0)
 ;
"RTN","RORX025",16,0)
 ;***** COMPILES THE "HEP B VACCINE OR IMMUNITY" REPORT
"RTN","RORX025",17,0)
 ; REPORT CODE: 025
"RTN","RORX025",18,0)
 ;
"RTN","RORX025",19,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORX025",20,0)
 ;
"RTN","RORX025",21,0)
 ; The ^TMP("RORX025",$J) global node is used by this function.
"RTN","RORX025",22,0)
 ;
"RTN","RORX025",23,0)
 ; ^TMP("RORX025",$J,
"RTN","RORX025",24,0)
 ;   "PAT",
"RTN","RORX025",25,0)
 ;     DFN,              Patient descriptor
"RTN","RORX025",26,0)
 ;                         ^01: Last 4 digits of SSN
"RTN","RORX025",27,0)
 ;                         ^02: Patient name
"RTN","RORX025",28,0)
 ;                         ^03: Date of Death
"RTN","RORX025",29,0)
 ;                         ^04: ICN
"RTN","RORX025",30,0)
 ;                         ^05: Patient Care Team
"RTN","RORX025",31,0)
 ;                         ^06: Priamary Care Provider
"RTN","RORX025",32,0)
 ;                         ^07: Age/DOB
"RTN","RORX025",33,0)
 ;       "IMM")          Result if positive test found or "" if no positive test found
"RTN","RORX025",34,0)
 ;                         ^01: Local lab test name
"RTN","RORX025",35,0)
 ;                         ^02: Collected date (FM)
"RTN","RORX025",36,0)
 ;                         ^03: Lab test result
"RTN","RORX025",37,0)
 ;       "VAC",           Number of results
"RTN","RORX025",38,0)
 ;                         ^01: #
"RTN","RORX025",39,0)
 ;           VaccineName, 
"RTN","RORX025",40,0)
 ;             VaccineDate) Always null if node exists
"RTN","RORX025",41,0)
 ;                         ^01: Null
"RTN","RORX025",42,0)
 ;
"RTN","RORX025",43,0)
 ; Return Values:
"RTN","RORX025",44,0)
 ;       <0  Error code
"RTN","RORX025",45,0)
 ;        0  Ok
"RTN","RORX025",46,0)
 ;
"RTN","RORX025",47,0)
HEPBRPT(RORTSK) ;
"RTN","RORX025",48,0)
 N RORIMM        ; Immunity wanted mode (-1|0|1)  no|not selected|yes  (verified by lab test)
"RTN","RORX025",49,0)
 N RORVAC        ; Vaccination (-1|0|1)  not received|not selected|received  (verified by immunization record)
"RTN","RORX025",50,0)
 N RORREG        ; Registry IEN
"RTN","RORX025",51,0)
 N RORVEDT       ; Vaccination end date
"RTN","RORX025",52,0)
 N RORVSDT       ; Vaccination start date
"RTN","RORX025",53,0)
 N RORLEDT       ; Lab test/LOINC end date
"RTN","RORX025",54,0)
 N RORLSDT       ; Lab test/LOINC start date
"RTN","RORX025",55,0)
 N RORRTN        ; Routine to invoke for hep B processing
"RTN","RORX025",56,0)
 ;
"RTN","RORX025",57,0)
 N NSPT,RC,REPORT,SFLAGS,TMP
"RTN","RORX025",58,0)
 S RC=0,RORRTN="RORX025"
"RTN","RORX025",59,0)
 K ^TMP(RORRTN,$J)
"RTN","RORX025",60,0)
 ;--- Root node of the report
"RTN","RORX025",61,0)
 S REPORT=$$ADDVAL^RORTSK11(RORTSK,"REPORT")
"RTN","RORX025",62,0)
 Q:REPORT<0 REPORT
"RTN","RORX025",63,0)
 ;
"RTN","RORX025",64,0)
 D
"RTN","RORX025",65,0)
 . ;--- Get and prepare the report parameters
"RTN","RORX025",66,0)
 . S RORREG=$$PARAM^RORTSK01("REGIEN")  ; Registry IEN
"RTN","RORX025",67,0)
 . S RORVAC=$$RPTMODE^RORX024("HEPBVAC")        ; Vaccination option chosen
"RTN","RORX025",68,0)
 . S RORIMM=$$RPTMODE^RORX024("HEPBIMM")        ; Immunity option chosen
"RTN","RORX025",69,0)
 . S RC=$$PARAMS(REPORT,.RORVSDT,.RORVEDT,.SFLAGS)  Q:RC<0
"RTN","RORX025",70,0)
 . ;--- Report header
"RTN","RORX025",71,0)
 . S RC=$$HEADER(REPORT)  Q:RC<0
"RTN","RORX025",72,0)
 . ;--- Query the registry
"RTN","RORX025",73,0)
 . D TPPSETUP^RORTSK01(80)
"RTN","RORX025",74,0)
 . S RC=$$QUERY^RORX024A(SFLAGS,.NSPT,RORRTN)
"RTN","RORX025",75,0)
 . I RC Q:RC<0
"RTN","RORX025",76,0)
 . ;--- Store the results
"RTN","RORX025",77,0)
 . D TPPSETUP^RORTSK01(20)
"RTN","RORX025",78,0)
 . S RC=$$STORE^RORX024A(REPORT,NSPT,RORRTN)
"RTN","RORX025",79,0)
 . I RC Q:RC<0
"RTN","RORX025",80,0)
 ;
"RTN","RORX025",81,0)
 ;--- Cleanup
"RTN","RORX025",82,0)
 K ^TMP(RORRTN,$J)
"RTN","RORX025",83,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORX025",84,0)
 ;
"RTN","RORX025",85,0)
 ;
"RTN","RORX025",86,0)
 ;
"RTN","RORX025",87,0)
 ;***** OUTPUTS THE REPORT HEADER
"RTN","RORX025",88,0)
 ;
"RTN","RORX025",89,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX025",90,0)
 ;
"RTN","RORX025",91,0)
 ; Return Values:
"RTN","RORX025",92,0)
 ;       <0  Error code
"RTN","RORX025",93,0)
 ;       >0  IEN of the HEADER element
"RTN","RORX025",94,0)
 ;
"RTN","RORX025",95,0)
HEADER(PARTAG) ;
"RTN","RORX025",96,0)
 ;;PATIENTS(#,NAME,LAST4,DOD,VAC_NAME,VAC_DATE,LTNAME,DATE,RESULT,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="ALL"
"RTN","RORX025",97,0)
 ;;PATIENTS(#,NAME,LAST4,AGE,DOD,VAC_NAME,VAC_DATE,LTNAME,DATE,RESULT,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="AGE"
"RTN","RORX025",98,0)
 ;;PATIENTS(#,NAME,LAST4,DOB,DOD,VAC_NAME,VAC_DATE,LTNAME,DATE,RESULT,ICN,PACT,PCP)^I $$PARAM^RORTSK01("AGE_RANGE","TYPE")="DOB"
"RTN","RORX025",99,0)
 ;
"RTN","RORX025",100,0)
 N HEADER,LN,RC,CTAG,LTAG
"RTN","RORX025",101,0)
 S HEADER=$$HEADER^RORXU002(.RORTSK,PARTAG)
"RTN","RORX025",102,0)
 Q:HEADER<0 HEADER
"RTN","RORX025",103,0)
 ;--- LOINC codes output
"RTN","RORX025",104,0)
 I $G(RORIMM) D
"RTN","RORX025",105,0)
 . S LTAG=$$ADDVAL^RORTSK11(RORTSK,"LOINC_CODES",,PARTAG)
"RTN","RORX025",106,0)
 . S LN=0 F  S LN=$O(^TMP("RORX025",$J,"IMM","TYPE",LN)) Q:'LN  D
"RTN","RORX025",107,0)
 . . S CTAG=$$ADDVAL^RORTSK11(RORTSK,"CODE",,LTAG)
"RTN","RORX025",108,0)
 . . D ADDATTR^RORTSK11(RORTSK,CTAG,"CODE",^TMP("RORX025",$J,"IMM","TYPE",LN))
"RTN","RORX025",109,0)
 S RC=$$TBLDEF^RORXU002("HEADER^RORX025",HEADER)
"RTN","RORX025",110,0)
 Q $S(RC<0:RC,1:HEADER)
"RTN","RORX025",111,0)
 ;
"RTN","RORX025",112,0)
 ;***** OUTPUTS THE PARAMETERS TO THE REPORT
"RTN","RORX025",113,0)
 ;
"RTN","RORX025",114,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORX025",115,0)
 ;
"RTN","RORX025",116,0)
 ; [.STDT]       Start and end dates of the report
"RTN","RORX025",117,0)
 ; [.ENDT]       are returned via these parameters
"RTN","RORX025",118,0)
 ;
"RTN","RORX025",119,0)
 ; [.FLAGS]      Flags for the $$SKIP^RORXU005 are
"RTN","RORX025",120,0)
 ;               returned via this parameter
"RTN","RORX025",121,0)
 ;
"RTN","RORX025",122,0)
 ; Return Values:
"RTN","RORX025",123,0)
 ;       <0  Error code
"RTN","RORX025",124,0)
 ;       >0  IEN of the PARAMETERS element
"RTN","RORX025",125,0)
 ;
"RTN","RORX025",126,0)
PARAMS(PARTAG,STDT,ENDT,FLAGS) ;
"RTN","RORX025",127,0)
 N PARAMS,TMP
"RTN","RORX025",128,0)
 S PARAMS=$$PARAMS^RORXU002(.RORTSK,PARTAG,,,.FLAGS)
"RTN","RORX025",129,0)
 Q:PARAMS<0 PARAMS
"RTN","RORX025",130,0)
 ;--- Process the list of Lab tests/LOINC codes
"RTN","RORX025",131,0)
 I $G(RORIMM) D
"RTN","RORX025",132,0)
 . D GETIMM^RORX024("RORX025") ;extract the immunity criteria for HEP B
"RTN","RORX025",133,0)
 ;--- Process the list of vaccinations
"RTN","RORX025",134,0)
 I $G(RORVAC) D
"RTN","RORX025",135,0)
 . D GETVAC^RORX024("RORX025") ;extract the vaccine criteria for HEP B
"RTN","RORX025",136,0)
 ;---
"RTN","RORX025",137,0)
 Q PARAMS
"RTN","RORX025",138,0)
 ;
"RTN","RORX025",139,0)
 ; --  LOINC codes to check for HEP B immunity
"RTN","RORX025",140,0)
IMMUNITY ; LOINC codes indicating HEP B immunity results by type Line +1 = Surface AB (priority), Line +2 = Core AB
"RTN","RORX025",141,0)
 ;;Surface AB^22322-2^10900-9^16935-9^5193-8^5194-6^22323-0^32019-2
"RTN","RORX025",142,0)
 ;;Core AB^32685-0^22318-0^13919-6^16933-4^13952-7^22316-4^5187-0^5188-8^22317-2^21005-4
"RTN","RORX025",143,0)
 ;;
"RTN","RORX025",144,0)
 Q
"RTN","RORX025",145,0)
 ;
"RTN","RORX025",146,0)
 ; -- List of Hep B vaccines to include
"RTN","RORX025",147,0)
VACCINE ;  Hepatitis B vaccine names (% = wild card)
"RTN","RORX025",148,0)
 ;;%ENGERIX-B%^%HEP B%^%HEPATITIS B%^HEPATITIS-B%^HEPB%^HEP A&B^HEPA/HEPB%^%HEP A/B%^HEPAB%^HEPATITIS A & B%^HEPATITIS A&B%
"RTN","RORX025",149,0)
 ;;HEPATITIS A/B^HEPATITIS AB^TWINRIX%
"RTN","RORX025",150,0)
 ;;
"RTN","RORX025",151,0)
 Q
"RTN","RORX025",152,0)
 ;
"RTN","RORXU002")
0^5^B167579102^B148272435
"RTN","RORXU002",1,0)
RORXU002 ;HCIOFO/SG - REPORT BUILDER UTILITIES ; 20 Apr 2016  1:21 PM
"RTN","RORXU002",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**1,10,13,15,17,19,21,22,26,29,30,31**;Feb 17, 2006;Build 62
"RTN","RORXU002",3,0)
 ;
"RTN","RORXU002",4,0)
 ; This routine uses the following IAs:
"RTN","RORXU002",5,0)
 ;
"RTN","RORXU002",6,0)
 ; #3990   $$ICDD^ICDCODE (supported)
"RTN","RORXU002",7,0)
 ; #2050   BLD^DIALOG (supported)
"RTN","RORXU002",8,0)
 ; #2056   GETS^DIQ (supported)
"RTN","RORXU002",9,0)
 ; #2056   $$GET1^DIQ (supported)
"RTN","RORXU002",10,0)
 ; #10103  $$NOW^XLFDT  (supported)
"RTN","RORXU002",11,0)
 ; #10104  $$TRIM^XLFSTR (supported)
"RTN","RORXU002",12,0)
 ; #417    Read access to .01 field of file #40.8 (controlled)
"RTN","RORXU002",13,0)
 ; #10040  Read access to file #44 (supported)
"RTN","RORXU002",14,0)
 ; #5747   $$VLTD^ICDEX (controlled)
"RTN","RORXU002",15,0)
 ;
"RTN","RORXU002",16,0)
 ;******************************************************************************
"RTN","RORXU002",17,0)
 ;******************************************************************************
"RTN","RORXU002",18,0)
 ;                 --- ROUTINE MODIFICATION LOG ---
"RTN","RORXU002",19,0)
 ;        
"RTN","RORXU002",20,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORXU002",21,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","RORXU002",22,0)
 ;ROR*1.5*10   APR  2010   A SAUNDERS   Modified Lab Tests Ranges section in
"RTN","RORXU002",23,0)
 ;                                      PARAMS tag to include the 3 new reports.
"RTN","RORXU002",24,0)
 ;ROR*1.5*13   DEC  2010   A SAUNDERS   Added Division and Clinic sections in
"RTN","RORXU002",25,0)
 ;                                      PARAMS tag (pulled from RORXU006).
"RTN","RORXU002",26,0)
 ;ROR*1.5*15   JUN  2011   C RAY        Added HIV_DX
"RTN","RORXU002",27,0)
 ; 
"RTN","RORXU002",28,0)
 ;ROR*1.5*17   AUG  2011   C RAY        Modified to allow 
"RTN","RORXU002",29,0)
 ;                                      PATIENTS,OPTIONS params to have other
"RTN","RORXU002",30,0)
 ;                                      values besides boolean
"RTN","RORXU002",31,0)
 ;                                      Modified to add DATE_RANGE_4
"RTN","RORXU002",32,0)
 ;ROR*1.5*19   FEB  2012   J SCOTT      Support for ICD-10 Coding System.
"RTN","RORXU002",33,0)
 ;
"RTN","RORXU002",34,0)
 ;ROR*1.5*21   SEP 2013    T KOPP       Added flags for GENDER (SEX) selection on
"RTN","RORXU002",35,0)
 ;                                      reports in PATIENTS XML tag
"RTN","RORXU002",36,0)
 ;                                      Added ICN column if Additional Identifier
"RTN","RORXU002",37,0)
 ;                                       requested.
"RTN","RORXU002",38,0)
 ;
"RTN","RORXU002",39,0)
 ;ROR*1.5*22   FEB 2014    T KOPP       Added flags for OEF/OIF period of service
"RTN","RORXU002",40,0)
 ;                                      selection on reports in PATIENTS XML tag
"RTN","RORXU002",41,0)
 ;
"RTN","RORXU002",42,0)
 ;ROR*1.5*26   JAN 2015    T KOPP       Added flags for SVR ONLY or NO SVR ONLY
"RTN","RORXU002",43,0)
 ;                                      selection on reports in PATIENTS XML tag.
"RTN","RORXU002",44,0)
 ;                                      Suppress FIB4 header on DAA Potential
"RTN","RORXU002",45,0)
 ;                                      Candidates report if FIB-4 parameter not
"RTN","RORXU002",46,0)
 ;                                      selected
"RTN","RORXU002",47,0)
 ;
"RTN","RORXU002",48,0)
 ;ROR*1.5*29   APR 2016    T KOPP       Added DATE_RANGE_5-7 to parameter output in
"RTN","RORXU002",49,0)
 ;                                       PARAMS
"RTN","RORXU002",50,0)
 ;
"RTN","RORXU002",51,0)
 ;ROR*1.5*30   OCT 2016    M FERRARESE   Changing the dispay for "Sex" to "Birth Sex" 
"RTN","RORXU002",52,0)
 ;
"RTN","RORXU002",53,0)
 ;ROR*1.5*31   MAY 2017    M FERRARESE   Adding PACT, PCP, and AGE/DOB as additional 
"RTN","RORXU002",54,0)
 ;                                       identifiers.
"RTN","RORXU002",55,0)
 ;
"RTN","RORXU002",56,0)
 ;******************************************************************************
"RTN","RORXU002",57,0)
 ;******************************************************************************
"RTN","RORXU002",58,0)
 Q
"RTN","RORXU002",59,0)
 ;
"RTN","RORXU002",60,0)
 ;***** SCANS THE TABLE DEFINITION (RORSRC) FOR COLUMN NAMES
"RTN","RORXU002",61,0)
 ;
"RTN","RORXU002",62,0)
 ; .TERM         Reference to a local variable where
"RTN","RORXU002",63,0)
 ;               is terminator is returned
"RTN","RORXU002",64,0)
 ;
"RTN","RORXU002",65,0)
 ; Return Values:
"RTN","RORXU002",66,0)
 ;       ""  End of definition
"RTN","RORXU002",67,0)
 ;      ...  Name of the column
"RTN","RORXU002",68,0)
 ;
"RTN","RORXU002",69,0)
COLSCAN(TERM) ;
"RTN","RORXU002",70,0)
 N CH,I,TOKEN
"RTN","RORXU002",71,0)
 F I=1:1 S TERM=$E(RORSRC,I) Q:"(,)"[TERM
"RTN","RORXU002",72,0)
 S TOKEN=$E(RORSRC,1,I-1)
"RTN","RORXU002",73,0)
 F I=I+1:1 S CH=$E(RORSRC,I) Q:(CH="")!("(,)"'[CH)
"RTN","RORXU002",74,0)
 S $E(RORSRC,1,I-1)=""
"RTN","RORXU002",75,0)
 Q TOKEN
"RTN","RORXU002",76,0)
 ;
"RTN","RORXU002",77,0)
 ;***** CHECKS THE FILEMAN DATE/TIME VALUE
"RTN","RORXU002",78,0)
DATE(DT) ;
"RTN","RORXU002",79,0)
 Q $S(DT>0:+DT,1:"")
"RTN","RORXU002",80,0)
 ;
"RTN","RORXU002",81,0)
 ;***** OUTPUTS THE BASIC HEADER TO THE REPORT
"RTN","RORXU002",82,0)
 ;
"RTN","RORXU002",83,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORXU002",84,0)
 ;
"RTN","RORXU002",85,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORXU002",86,0)
 ;
"RTN","RORXU002",87,0)
 ; Return Values:
"RTN","RORXU002",88,0)
 ;       <0  Error code
"RTN","RORXU002",89,0)
 ;       >0  IEN of the HEADER element
"RTN","RORXU002",90,0)
 ;
"RTN","RORXU002",91,0)
HEADER(RORTSK,PARTAG) ;
"RTN","RORXU002",92,0)
 N HEADER,IENS,REGIEN,RORBUF,RORMSG,TMP,DIERR
"RTN","RORXU002",93,0)
 S HEADER=$$ADDVAL^RORTSK11(RORTSK,"HEADER",,PARTAG)
"RTN","RORXU002",94,0)
 Q:HEADER<0 HEADER
"RTN","RORXU002",95,0)
 D ADDVAL^RORTSK11(RORTSK,"DATE",$$DATE($$NOW^XLFDT),HEADER)
"RTN","RORXU002",96,0)
 D ADDVAL^RORTSK11(RORTSK,"TASK_NUMBER",RORTSK,HEADER)
"RTN","RORXU002",97,0)
 S REGIEN=+$$PARAM^RORTSK01("REGIEN")
"RTN","RORXU002",98,0)
 ;---
"RTN","RORXU002",99,0)
 S IENS=REGIEN_","
"RTN","RORXU002",100,0)
 D GETS^DIQ(798.1,IENS,"1;2","I","RORBUF","RORMSG")
"RTN","RORXU002",101,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,798.1,IENS)
"RTN","RORXU002",102,0)
 S TMP=$G(RORBUF(798.1,IENS,1,"I"))
"RTN","RORXU002",103,0)
 D ADDVAL^RORTSK11(RORTSK,"UPDATED_UNTIL",$$DATE(TMP),HEADER)
"RTN","RORXU002",104,0)
 S TMP=$G(RORBUF(798.1,IENS,2,"I"))
"RTN","RORXU002",105,0)
 D ADDVAL^RORTSK11(RORTSK,"EXTRACTED_UNTIL",$$DATE(TMP),HEADER)
"RTN","RORXU002",106,0)
 Q HEADER
"RTN","RORXU002",107,0)
 ;
"RTN","RORXU002",108,0)
 ;***** PARSES THE COMMA-SEPARATED LIST
"RTN","RORXU002",109,0)
 ;
"RTN","RORXU002",110,0)
 ; .LIST         Reference to a local variable that contains a list.
"RTN","RORXU002",111,0)
 ;               Items of the list are returned as the subscripts of
"RTN","RORXU002",112,0)
 ;               this variable.
"RTN","RORXU002",113,0)
 ;
"RTN","RORXU002",114,0)
LIST(LIST) ;
"RTN","RORXU002",115,0)
 N I,TMP,VAL
"RTN","RORXU002",116,0)
 F I=1:1 S VAL=$P(LIST,",",I) Q:VAL=""  D
"RTN","RORXU002",117,0)
 . S TMP=$$TRIM^XLFSTR(VAL)
"RTN","RORXU002",118,0)
 . S:TMP'="" LIST(TMP)=""
"RTN","RORXU002",119,0)
 Q
"RTN","RORXU002",120,0)
 ;
"RTN","RORXU002",121,0)
 ;***** COMPILES A TEXT DESCRIPTION FOR THE REPORT OPTIONS
"RTN","RORXU002",122,0)
 ;
"RTN","RORXU002",123,0)
 ; .OPTIONS      Reference to a local variable containing
"RTN","RORXU002",124,0)
 ;               the options as subscripts
"RTN","RORXU002",125,0)
 ;
"RTN","RORXU002",126,0)
 ; [DLGNUM]      Number of the dialog that contains the template
"RTN","RORXU002",127,0)
 ;               (7980000.018, by default).
"RTN","RORXU002",128,0)
 ;
"RTN","RORXU002",129,0)
 ; Return Values:
"RTN","RORXU002",130,0)
 ;      ...  Text description of the options
"RTN","RORXU002",131,0)
 ;
"RTN","RORXU002",132,0)
OPTXT(OPTIONS,DLGNUM) ;
"RTN","RORXU002",133,0)
 N I,J,NS,RORBUF,TEXT,TMP
"RTN","RORXU002",134,0)
 S:$G(DLGNUM)'>0 DLGNUM=7980000.018
"RTN","RORXU002",135,0)
 D BLD^DIALOG(DLGNUM,,,"RORBUF")
"RTN","RORXU002",136,0)
 S TEXT="",I=0
"RTN","RORXU002",137,0)
 F  S I=$O(RORBUF(I)) Q:I=""  D:$E(RORBUF(I),1)'=" "
"RTN","RORXU002",138,0)
 . S NS=0
"RTN","RORXU002",139,0)
 . F J=1:1 S TMP=$TR($P(RORBUF(I),",",J)," ") Q:TMP=""  D
"RTN","RORXU002",140,0)
 . . S:$D(OPTIONS(TMP)) NS=2**(J-1)+NS
"RTN","RORXU002",141,0)
 . Q:'NS
"RTN","RORXU002",142,0)
 . S TMP=$$TRIM^XLFSTR($G(RORBUF(I+NS)))
"RTN","RORXU002",143,0)
 . S:TMP'="" TEXT=TEXT_", "_TMP
"RTN","RORXU002",144,0)
 Q $P(TEXT,", ",2,999)
"RTN","RORXU002",145,0)
 ;
"RTN","RORXU002",146,0)
 ;***** OUTPUTS THE PARAMETERS TO THE REPORT
"RTN","RORXU002",147,0)
 ;
"RTN","RORXU002",148,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORXU002",149,0)
 ;
"RTN","RORXU002",150,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORXU002",151,0)
 ;
"RTN","RORXU002",152,0)
 ; .STDT         Start and end dates of the report
"RTN","RORXU002",153,0)
 ; .ENDT         are returned via these parameters
"RTN","RORXU002",154,0)
 ;
"RTN","RORXU002",155,0)
 ; [.FLAGS]      Flags for the $$SKIP^RORXU005 are returned via this
"RTN","RORXU002",156,0)
 ;               parameter. The "D" (skip deceased patients) and "G"
"RTN","RORXU002",157,0)
 ;               (skip pending patients) flags are always added.
"RTN","RORXU002",158,0)
 ;
"RTN","RORXU002",159,0)
 ; Return Values:
"RTN","RORXU002",160,0)
 ;       <0  Error code
"RTN","RORXU002",161,0)
 ;       >0  IEN of the PARAMETERS element
"RTN","RORXU002",162,0)
 ;
"RTN","RORXU002",163,0)
PARAMS(RORTSK,PARTAG,STDT,ENDT,FLAGS) ;
"RTN","RORXU002",164,0)
 N BUF,ELEMENT,I,LTAG,MODE,NAME,PARAMS,RC,REGIEN,RORMSG,TMP,IEN,DIERR,TMP1
"RTN","RORXU002",165,0)
 S PARAMS=$$ADDVAL^RORTSK11(RORTSK,"PARAMETERS",,PARTAG)
"RTN","RORXU002",166,0)
 S RC=0,(ARENDT,ENDT,ARSTDT,STDT)="",FLAGS=""
"RTN","RORXU002",167,0)
 ;
"RTN","RORXU002",168,0)
 ;=== Registry name
"RTN","RORXU002",169,0)
 S REGIEN=+$$PARAM^RORTSK01("REGIEN")
"RTN","RORXU002",170,0)
 I REGIEN>0 D  Q:RC<0 RC
"RTN","RORXU002",171,0)
 . S TMP=$P($$REGNAME^RORUTL01(REGIEN),U)
"RTN","RORXU002",172,0)
 . I TMP="" S RC=-1 Q
"RTN","RORXU002",173,0)
 . S RC=$$ADDVAL^RORTSK11(RORTSK,"REGNAME",TMP,PARAMS)
"RTN","RORXU002",174,0)
 ;
"RTN","RORXU002",175,0)
 ;=== Alternate date ranges
"RTN","RORXU002",176,0)
 F I=2:1:7 D  Q:RC<0
"RTN","RORXU002",177,0)
 . S STDT=$$PARAM^RORTSK01("DATE_RANGE_"_I,"START")\1 Q:STDT'>0
"RTN","RORXU002",178,0)
 . S ENDT=$$PARAM^RORTSK01("DATE_RANGE_"_I,"END")\1 Q:ENDT'>0
"RTN","RORXU002",179,0)
 . S ELEMENT=$$ADDVAL^RORTSK11(RORTSK,"DATE_RANGE_"_I,,PARAMS)
"RTN","RORXU002",180,0)
 . I ELEMENT<0 S RC=+ELEMENT Q
"RTN","RORXU002",181,0)
 . S RC=$$ADDATTR^RORTSK11(RORTSK,ELEMENT,"START",STDT) Q:RC<0
"RTN","RORXU002",182,0)
 . S RC=$$ADDATTR^RORTSK11(RORTSK,ELEMENT,"END",ENDT)
"RTN","RORXU002",183,0)
 Q:RC<0 RC
"RTN","RORXU002",184,0)
 ;
"RTN","RORXU002",185,0)
 ;=== Main date range
"RTN","RORXU002",186,0)
 S STDT=$$PARAM^RORTSK01("DATE_RANGE","START")\1
"RTN","RORXU002",187,0)
 S ENDT=$$PARAM^RORTSK01("DATE_RANGE","END")\1
"RTN","RORXU002",188,0)
 I STDT>0,ENDT>0 D  Q:RC<0 RC
"RTN","RORXU002",189,0)
 . S ELEMENT=$$ADDVAL^RORTSK11(RORTSK,"DATE_RANGE",,PARAMS)
"RTN","RORXU002",190,0)
 . I ELEMENT<0 S RC=+ELEMENT Q
"RTN","RORXU002",191,0)
 . S RC=$$ADDATTR^RORTSK11(RORTSK,ELEMENT,"START",STDT) Q:RC<0
"RTN","RORXU002",192,0)
 . S RC=$$ADDATTR^RORTSK11(RORTSK,ELEMENT,"END",ENDT)
"RTN","RORXU002",193,0)
 E  S (ENDT,STDT)=""
"RTN","RORXU002",194,0)
 ;
"RTN","RORXU002",195,0)
 ;=== Task comment
"RTN","RORXU002",196,0)
 S TMP=$$PARAM^RORTSK01("TASK_COMMENT")
"RTN","RORXU002",197,0)
 D:TMP'="" ADDVAL^RORTSK11(RORTSK,"TASK_COMMENT",TMP,PARAMS)
"RTN","RORXU002",198,0)
 ;
"RTN","RORXU002",199,0)
 ;=== Clinic Selection - patch 13
"RTN","RORXU002",200,0)
 D:$D(RORTSK("PARAMS","CLINICS","C"))
"RTN","RORXU002",201,0)
 . S LTAG=$$ADDVAL^RORTSK11(RORTSK,"CLINICS",,PARAMS) Q:LTAG'>0
"RTN","RORXU002",202,0)
 . S IEN=0
"RTN","RORXU002",203,0)
 . F  S IEN=$O(RORTSK("PARAMS","CLINICS","C",IEN)) Q:IEN'>0  D
"RTN","RORXU002",204,0)
 . . S TMP=$$GET1^DIQ(44,IEN_",",.01,,,"RORMSG")
"RTN","RORXU002",205,0)
 . . D:$G(DIERR) DBS^RORERR("RORMSG",-9,,,44,IEN_",")
"RTN","RORXU002",206,0)
 . . Q:TMP=""
"RTN","RORXU002",207,0)
 . . D ADDVAL^RORTSK11(RORTSK,"CLINIC",TMP,LTAG,,IEN)
"RTN","RORXU002",208,0)
 D:$$PARAM^RORTSK01("CLINICS","ALL")
"RTN","RORXU002",209,0)
 . S LTAG=$$ADDVAL^RORTSK11(RORTSK,"CLINICS","ALL",PARAMS)
"RTN","RORXU002",210,0)
 ;
"RTN","RORXU002",211,0)
 ;=== Division Selection - patch 13
"RTN","RORXU002",212,0)
 D:$D(RORTSK("PARAMS","DIVISIONS","C"))
"RTN","RORXU002",213,0)
 . S LTAG=$$ADDVAL^RORTSK11(RORTSK,"DIVISIONS",,PARAMS) Q:LTAG'>0
"RTN","RORXU002",214,0)
 . S IEN=0
"RTN","RORXU002",215,0)
 . F  S IEN=$O(RORTSK("PARAMS","DIVISIONS","C",IEN)) Q:IEN'>0  D
"RTN","RORXU002",216,0)
 . . S TMP=$$GET1^DIQ(40.8,IEN_",",.01,,,"RORMSG")
"RTN","RORXU002",217,0)
 . . D:$G(DIERR) DBS^RORERR("RORMSG",-9,,,40.8,IEN_",")
"RTN","RORXU002",218,0)
 . . Q:TMP=""
"RTN","RORXU002",219,0)
 . . D ADDVAL^RORTSK11(RORTSK,"DIVISION",TMP,LTAG,,IEN)
"RTN","RORXU002",220,0)
 D:$$PARAM^RORTSK01("DIVISIONS","ALL")
"RTN","RORXU002",221,0)
 . S LTAG=$$ADDVAL^RORTSK11(RORTSK,"DIVISIONS","ALL",PARAMS)
"RTN","RORXU002",222,0)
 ;
"RTN","RORXU002",223,0)
 ;=== Age Range - patch 31
"RTN","RORXU002",224,0)
 S TMP1=$G(RORTSK("PARAMS","AGE_RANGE","A","TYPE"))
"RTN","RORXU002",225,0)
 I TMP1="ALL" D  Q:RC<0 RC
"RTN","RORXU002",226,0)
 . S RC=$$ADDVAL^RORTSK11(RORTSK,"AGE_RANGE",,PARAMS)
"RTN","RORXU002",227,0)
 . S RC=$$ADDATTR^RORTSK11(RORTSK,"AGE_RANGE","TYPE",TMP1)
"RTN","RORXU002",228,0)
 ;
"RTN","RORXU002",229,0)
 I TMP1="AGE"!(TMP1="DOB") D  Q:RC<0 RC
"RTN","RORXU002",230,0)
 . S ARSTDT=$$PARAM^RORTSK01("AGE_RANGE","START")
"RTN","RORXU002",231,0)
 . S ARENDT=$$PARAM^RORTSK01("AGE_RANGE","END")
"RTN","RORXU002",232,0)
 . I ARSTDT>0,ARENDT>0 D  Q
"RTN","RORXU002",233,0)
 . . S ELEMENT=$$ADDVAL^RORTSK11(RORTSK,"AGE_RANGE",,PARAMS)
"RTN","RORXU002",234,0)
 . . I ELEMENT<0 S RC=+ELEMENT Q
"RTN","RORXU002",235,0)
 . . S RC=$$ADDATTR^RORTSK11(RORTSK,ELEMENT,"TYPE",TMP1) Q:RC<0
"RTN","RORXU002",236,0)
 . . S RC=$$ADDATTR^RORTSK11(RORTSK,ELEMENT,"START",ARSTDT)
"RTN","RORXU002",237,0)
 . . S RC=$$ADDATTR^RORTSK11(RORTSK,ELEMENT,"END",ARENDT)
"RTN","RORXU002",238,0)
 . E  S (ARENDT,ARSTDT)=""
"RTN","RORXU002",239,0)
 ;
"RTN","RORXU002",240,0)
 ;=== Patient selection and Options
"RTN","RORXU002",241,0)
 F NAME="PATIENTS","OPTIONS" D  Q:RC<0
"RTN","RORXU002",242,0)
 . K BUF M BUF=RORTSK("PARAMS",NAME,"A") Q:$D(BUF)<10
"RTN","RORXU002",243,0)
 . ;--- Generate the XML tags
"RTN","RORXU002",244,0)
 . S ELEMENT=$$ADDVAL^RORTSK11(RORTSK,NAME,$$OPTXT(.BUF),PARAMS)
"RTN","RORXU002",245,0)
 . I ELEMENT'>0 S RC=ELEMENT Q
"RTN","RORXU002",246,0)
 . S TMP=""
"RTN","RORXU002",247,0)
 . F  S TMP=$O(BUF(TMP)) Q:TMP=""  D  Q:RC<0
"RTN","RORXU002",248,0)
 . . S RC=$$ADDATTR^RORTSK11(RORTSK,ELEMENT,TMP,$G(BUF(TMP)))
"RTN","RORXU002",249,0)
 . ;--- Compile the flags
"RTN","RORXU002",250,0)
 . D:NAME="PATIENTS"
"RTN","RORXU002",251,0)
 . . S:'$D(BUF("DE_BEFORE")) FLAGS=FLAGS_"P"
"RTN","RORXU002",252,0)
 . . S:'$D(BUF("DE_DURING")) FLAGS=FLAGS_"N"
"RTN","RORXU002",253,0)
 . . S:'$D(BUF("DE_AFTER")) FLAGS=FLAGS_"F"
"RTN","RORXU002",254,0)
 . . I $D(BUF("BIRTHSEX")) S FLAGS=FLAGS_$S(BUF("BIRTHSEX")="M":"W",BUF("BIRTHSEX")="F":"M",1:"")
"RTN","RORXU002",255,0)
 . . I $D(BUF("OEF")) D
"RTN","RORXU002",256,0)
 . . . S FLAGS=FLAGS_$S(BUF("OEF")=1:"I",BUF("OEF")=-1:"E",1:"")
"RTN","RORXU002",257,0)
 . . I $D(BUF("SVR")) S FLAGS=FLAGS_$S(BUF("SVR")=1:"S",BUF("SVR")=0:"V",1:"")
"RTN","RORXU002",258,0)
 Q:RC<0 RC
"RTN","RORXU002",259,0)
 ;
"RTN","RORXU002",260,0)
 ;=== Other Registries
"RTN","RORXU002",261,0)
 I $D(RORTSK("PARAMS","OTHER_REGISTRIES","C"))>1 D  Q:RC<0 RC
"RTN","RORXU002",262,0)
 . N NODE,REGIEN
"RTN","RORXU002",263,0)
 . S LTAG=$$ADDVAL^RORTSK11(RORTSK,"OTHER_REGISTRIES",,PARAMS)
"RTN","RORXU002",264,0)
 . I LTAG<0 S RC=+LTAG Q
"RTN","RORXU002",265,0)
 . S NODE=$NA(RORTSK("PARAMS","OTHER_REGISTRIES","C"))
"RTN","RORXU002",266,0)
 . S REGIEN=0
"RTN","RORXU002",267,0)
 . F  S REGIEN=$O(@NODE@(REGIEN)) Q:REGIEN'>0  D  Q:RC<0
"RTN","RORXU002",268,0)
 . . S TMP=$P($$REGNAME^RORUTL01(REGIEN),U,2)
"RTN","RORXU002",269,0)
 . . S MODE=+$G(@NODE@(REGIEN))
"RTN","RORXU002",270,0)
 . . I 'MODE!(TMP="") K @NODE@(REGIEN) Q
"RTN","RORXU002",271,0)
 . . S TMP=TMP_" ("_$S(MODE<0:"Exclude",1:"Include")_")"
"RTN","RORXU002",272,0)
 . . S RC=$$ADDVAL^RORTSK11(RORTSK,"REGNAME",TMP,LTAG)
"RTN","RORXU002",273,0)
 . S FLAGS=FLAGS_"R"
"RTN","RORXU002",274,0)
 ;
"RTN","RORXU002",275,0)
 ;=== Local Fields
"RTN","RORXU002",276,0)
 I $D(RORTSK("PARAMS","LOCAL_FIELDS","C"))>1 D  Q:RC<0 RC
"RTN","RORXU002",277,0)
 . N NODE,IEN,IENS
"RTN","RORXU002",278,0)
 . S LTAG=$$ADDVAL^RORTSK11(RORTSK,"LOCAL_FIELDS",,PARAMS)
"RTN","RORXU002",279,0)
 . I LTAG<0 S RC=+LTAG Q
"RTN","RORXU002",280,0)
 . S NODE=$NA(RORTSK("PARAMS","LOCAL_FIELDS","C"))
"RTN","RORXU002",281,0)
 . S IEN=0
"RTN","RORXU002",282,0)
 . F  S IEN=$O(@NODE@(IEN)) Q:IEN'>0  D  Q:RC<0
"RTN","RORXU002",283,0)
 . . S TMP=$$GET1^DIQ(799.53,IEN_",",.01,,,"RORMSG")
"RTN","RORXU002",284,0)
 . . D:$G(DIERR) DBS^RORERR("RORMSG",-9,,,799.53,IEN_",")
"RTN","RORXU002",285,0)
 . . S MODE=+$G(@NODE@(IEN))
"RTN","RORXU002",286,0)
 . . I 'MODE!(TMP="") K @NODE@(IEN) Q
"RTN","RORXU002",287,0)
 . . S TMP=TMP_" ("_$S(MODE<0:"Exclude",1:"Include")_")"
"RTN","RORXU002",288,0)
 . . S RC=$$ADDVAL^RORTSK11(RORTSK,"FIELD",TMP,LTAG)
"RTN","RORXU002",289,0)
 . S FLAGS=FLAGS_"O"
"RTN","RORXU002",290,0)
 ;
"RTN","RORXU002",291,0)
 ;=== Lab test ranges
"RTN","RORXU002",292,0)
 I $D(RORTSK("PARAMS","LRGRANGES","C"))>1 D  Q:RC<0 RC
"RTN","RORXU002",293,0)
 . N TYPE S TYPE=3 ;default = 3 for 'lab by range' report
"RTN","RORXU002",294,0)
 . I $G(RORTSK("EP"))["BMIRANGE" S TYPE=5 ;change to 5 if BMI
"RTN","RORXU002",295,0)
 . I $G(RORTSK("EP"))["MLDRANGE"!($G(RORTSK("EP"))["HCVDAA") S TYPE=6 ;change to 6 if MELD
"RTN","RORXU002",296,0)
 . I $G(RORTSK("EP"))["RFRANGE" S TYPE=7 ;change to 7 if Renal
"RTN","RORXU002",297,0)
 . N GRC,NODE
"RTN","RORXU002",298,0)
 . S NODE=$NA(RORTSK("PARAMS","LRGRANGES","C"))
"RTN","RORXU002",299,0)
 . S GRC=0
"RTN","RORXU002",300,0)
 . F  S GRC=$O(@NODE@(GRC)) Q:GRC'>0  D  Q:RC<0
"RTN","RORXU002",301,0)
 . . S RC=$$ITEMIEN^RORUTL09(TYPE,REGIEN,GRC,.TMP)
"RTN","RORXU002",302,0)
 . . S:RC'<0 @NODE@(GRC)=TMP
"RTN","RORXU002",303,0)
 ;
"RTN","RORXU002",304,0)
 ;=== ICD filter/group/codes
"RTN","RORXU002",305,0)
 N LEV1FILT,LEV2GRP,LEV3ICD,ICDIEN,ICDCODE,GRPNAME,FILTER,ICDDESC,RORXMLNODE,RORICDSYS
"RTN","RORXU002",306,0)
 S FILTER=$G(RORTSK("PARAMS","ICDFILT","A","FILTER"))
"RTN","RORXU002",307,0)
 I $L(FILTER)>0 D  ;quit if no ICD filter exists
"RTN","RORXU002",308,0)
 . S LEV1FILT=$$ADDVAL^RORTSK11(RORTSK,"ICDFILT",,PARAMS)
"RTN","RORXU002",309,0)
 . I LEV1FILT<0 S RC=LEV1FILT Q
"RTN","RORXU002",310,0)
 . ;add filter value to the output
"RTN","RORXU002",311,0)
 . S RC=$$ADDATTR^RORTSK11(RORTSK,LEV1FILT,"FILTER",FILTER)
"RTN","RORXU002",312,0)
 . ;if there's an ICD group, process it
"RTN","RORXU002",313,0)
 . I $D(RORTSK("PARAMS","ICDFILT","G"))>1 D  Q:RC<0
"RTN","RORXU002",314,0)
 .. S NODE=$NA(RORTSK("PARAMS","ICDFILT","G"))
"RTN","RORXU002",315,0)
 .. S GRPNAME=0,RC=0
"RTN","RORXU002",316,0)
 .. F  S GRPNAME=$O(@NODE@(GRPNAME)) Q:GRPNAME=""  D  Q:RC<0
"RTN","RORXU002",317,0)
 ... S LEV2GRP=$$ADDVAL^RORTSK11(RORTSK,"GROUP",,LEV1FILT)
"RTN","RORXU002",318,0)
 ... I LEV2GRP'>0 S RC=LEV2GRP Q 
"RTN","RORXU002",319,0)
 ... ;add group name to the output
"RTN","RORXU002",320,0)
 ... D ADDATTR^RORTSK11(RORTSK,LEV2GRP,"ID",GRPNAME)
"RTN","RORXU002",321,0)
 ... S ICDIEN=0
"RTN","RORXU002",322,0)
 ... F  S ICDIEN=$O(@NODE@(GRPNAME,"C",ICDIEN)) Q:ICDIEN'>0  D
"RTN","RORXU002",323,0)
 .... S ICDCODE=$P(@NODE@(GRPNAME,"C",ICDIEN),U,1) Q:ICDCODE=""
"RTN","RORXU002",324,0)
 .... S RORICDSYS=$P(@NODE@(GRPNAME,"C",ICDIEN),U,2)
"RTN","RORXU002",325,0)
 .... ;get diagnosis description
"RTN","RORXU002",326,0)
 .... S ICDDESC=$$VLTD^ICDEX(ICDIEN)
"RTN","RORXU002",327,0)
 .... S RORXMLNODE=$S(RORICDSYS=1:"ICD9",1:"ICD10")
"RTN","RORXU002",328,0)
 .... S LEV3ICD=$$ADDVAL^RORTSK11(RORTSK,RORXMLNODE,ICDDESC,LEV2GRP)
"RTN","RORXU002",329,0)
 .... D ADDATTR^RORTSK11(RORTSK,LEV3ICD,"ID",ICDCODE)
"RTN","RORXU002",330,0)
 ;
"RTN","RORXU002",331,0)
 ;=== get Max Date
"RTN","RORXU002",332,0)
 N MAXDT S MAXDT=$$PARAM^RORTSK01("OPTIONS","MAX_DATE")
"RTN","RORXU002",333,0)
 I $G(MAXDT)>0 D ADDVAL^RORTSK11(RORTSK,"MAX_DATE",MAXDT,PARAMS)
"RTN","RORXU002",334,0)
 ;
"RTN","RORXU002",335,0)
 ;=== get HIV_DX
"RTN","RORXU002",336,0)
 N RORMODE S RORMODE=$$PARAM^RORTSK01("HIV_DX")
"RTN","RORXU002",337,0)
 S RORMODE=$S(RORMODE=1:"Include",RORMODE=-1:"Exclude",1:"")
"RTN","RORXU002",338,0)
 I RORMODE'="" D
"RTN","RORXU002",339,0)
 . D ADDVAL^RORTSK11(RORTSK,"HIV_DX",RORMODE,PARAMS)
"RTN","RORXU002",340,0)
 . S FLAGS=FLAGS_"H"
"RTN","RORXU002",341,0)
 ;
"RTN","RORXU002",342,0)
 ;=== Defaults
"RTN","RORXU002",343,0)
 S TMP=$TR(FLAGS,"FNP") S:$L(FLAGS)-$L(TMP)=3 FLAGS=TMP
"RTN","RORXU002",344,0)
 S FLAGS=FLAGS_"DG"
"RTN","RORXU002",345,0)
 ;
"RTN","RORXU002",346,0)
 ;=== Success
"RTN","RORXU002",347,0)
 Q PARAMS
"RTN","RORXU002",348,0)
 ;
"RTN","RORXU002",349,0)
 ;***** GENERATES TABLE DEFINITION
"RTN","RORXU002",350,0)
 ;
"RTN","RORXU002",351,0)
 ; TBLREF        Reference to the definition table in the source
"RTN","RORXU002",352,0)
 ;               code (TAG^ROUTINE). See the HEADER^RORX013 for
"RTN","RORXU002",353,0)
 ;               examples of table definitions.
"RTN","RORXU002",354,0)
 ;
"RTN","RORXU002",355,0)
 ; HEADER        IEN of the HEADER element
"RTN","RORXU002",356,0)
 ;
"RTN","RORXU002",357,0)
 ; Return Values:
"RTN","RORXU002",358,0)
 ;       <0  Error code
"RTN","RORXU002",359,0)
 ;        0  Ok
"RTN","RORXU002",360,0)
 ;
"RTN","RORXU002",361,0)
TBLDEF(TBLREF,HEADER) ;
"RTN","RORXU002",362,0)
 N COND,IT,NAME,RC,RORSRC,TBLDEF,TERM,TGET
"RTN","RORXU002",363,0)
 K ^TMP($J,"RORSELCOL")
"RTN","RORXU002",364,0)
 S TGET="S RORSRC=$T("_$P(TBLREF,"^")_"+IT^"_$P(TBLREF,"^",2)_")"
"RTN","RORXU002",365,0)
 S RC=0
"RTN","RORXU002",366,0)
 F IT=1:1 X TGET S RORSRC=$P(RORSRC,";;",2) Q:RORSRC=""  D  Q:RC<0
"RTN","RORXU002",367,0)
 . S COND=$$TRIM^XLFSTR($P(RORSRC,U,2,999))
"RTN","RORXU002",368,0)
 . I COND'="" X COND E  Q
"RTN","RORXU002",369,0)
 . S RORSRC=$$TRIM^XLFSTR($P(RORSRC,U))
"RTN","RORXU002",370,0)
 . S NAME=$$COLSCAN(.TERM) Q:(NAME="")!(TERM'="(")
"RTN","RORXU002",371,0)
 . S TBLDEF=$$ADDVAL^RORTSK11(RORTSK,"TBLDEF",,HEADER)
"RTN","RORXU002",372,0)
 . I TBLDEF<0 S RC=TBLDEF Q
"RTN","RORXU002",373,0)
 . D ADDATTR^RORTSK11(RORTSK,TBLDEF,"NAME",NAME)
"RTN","RORXU002",374,0)
 . D ADDATTR^RORTSK11(RORTSK,TBLDEF,"HEADER","1")
"RTN","RORXU002",375,0)
 . D ADDATTR^RORTSK11(RORTSK,TBLDEF,"FOOTER","1")
"RTN","RORXU002",376,0)
 . D TBLDEF1(TBLDEF)
"RTN","RORXU002",377,0)
 K ^TMP($J,"RORSELCOL")
"RTN","RORXU002",378,0)
 Q $S(RC<0:RC,1:0)
"RTN","RORXU002",379,0)
 ;
"RTN","RORXU002",380,0)
 ;***** GENERATES <COLUMN> ELEMENTS FROM TABLE DEFINITION (RORSRC)
"RTN","RORXU002",381,0)
 ;
"RTN","RORXU002",382,0)
 ; PTAG          IEN of the parent element
"RTN","RORXU002",383,0)
 ;
"RTN","RORXU002",384,0)
TBLDEF1(PTAG) ;
"RTN","RORXU002",385,0)
 N COLUMN,IT,NAME,OK,ROR,TERM
"RTN","RORXU002",386,0)
 F  S NAME=$$COLSCAN(.TERM) Q:NAME=""  D  Q:")"[TERM
"RTN","RORXU002",387,0)
 . I '$D(^TMP($J,"RORSELCOL")) D  ; set up special columns selection criteria
"RTN","RORXU002",388,0)
 . . F IT=1:1 X "S ROR=$P($T(SELCOL+"_IT_"^RORXU002),"";;"",2)" Q:$P(ROR,U)=""  D
"RTN","RORXU002",389,0)
 . . . S ^TMP($J,"RORSELCOL",$P(ROR,U))=$P(ROR,U,2,999)
"RTN","RORXU002",390,0)
 . I $D(^TMP($J,"RORSELCOL",NAME)) D  Q:'OK
"RTN","RORXU002",391,0)
 . . X ^TMP($J,"RORSELCOL",NAME) S OK=$T
"RTN","RORXU002",392,0)
 . S COLUMN=$$ADDVAL^RORTSK11(RORTSK,"COLUMN",,PTAG)
"RTN","RORXU002",393,0)
 . D ADDATTR^RORTSK11(RORTSK,COLUMN,"NAME",NAME)
"RTN","RORXU002",394,0)
 . D:TERM="(" TBLDEF1(COLUMN)
"RTN","RORXU002",395,0)
 Q
"RTN","RORXU002",396,0)
 ;
"RTN","RORXU002",397,0)
 ;Setup of values in SELCOL is:
"RTN","RORXU002",398,0)
 ;name of selected optional column^statement to execute to set $T if the condition to include this field has been met
"RTN","RORXU002",399,0)
 ;
"RTN","RORXU002",400,0)
SELCOL ;selected optional fields and screen criteria is listed here
"RTN","RORXU002",401,0)
 ;;ICN^I $$PARAM^RORTSK01("PATIENTS","ICN")
"RTN","RORXU002",402,0)
 ;;FIB4^I $D(RORTSK("PARAMS","LRGRANGES","C",4))
"RTN","RORXU002",403,0)
 ;;PACT^I $$PARAM^RORTSK01("PATIENTS","PACT")
"RTN","RORXU002",404,0)
 ;;PCP^I $$PARAM^RORTSK01("PATIENTS","PCP")
"RTN","RORXU002",405,0)
 ;;
"RTN","RORXU005")
0^58^B56314333^B45030841
"RTN","RORXU005",1,0)
RORXU005 ;HCIOFO/SG - REPORT BUILDER UTILITIES ;5/25/11 11:48am
"RTN","RORXU005",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**1,15,21,22,26,30,31**;Feb 17, 2006;Build 62
"RTN","RORXU005",3,0)
 ;
"RTN","RORXU005",4,0)
 ;******************************************************************************
"RTN","RORXU005",5,0)
 ;******************************************************************************
"RTN","RORXU005",6,0)
 ;
"RTN","RORXU005",7,0)
 ;                 --- ROUTINE MODIFICATION LOG ---
"RTN","RORXU005",8,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORXU005",9,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","RORXU005",10,0)
 ;ROR*1.5*22   FEB  2014   T KOPP       Added tag SKIPOEF to return the result
"RTN","RORXU005",11,0)
 ;                                      if the period of service of patient
"RTN","RORXU005",12,0)
 ;                                      matches OEF/OIF selection criteria.
"RTN","RORXU005",13,0)
 ;ROR*1.5*26   JAN  2015   T KOPP       Added check for SVR match in report
"RTN","RORXU005",14,0)
 ;
"RTN","RORXU005",15,0)
 ;ROR*1.5*30   OCT 2016   M FERRARESE   Changing the dispay for "Sex" to "Birth Sex"
"RTN","RORXU005",16,0)
 ;                                      screen logic, flags S and V
"RTN","RORXU005",17,0)
 ;ROR*1.5*31   MAY 2017   S ALSAHHAR    Adding logic for AGE/DOB identifier
"RTN","RORXU005",18,0)
 ;
"RTN","RORXU005",19,0)
 ;****************************************************************************** 
"RTN","RORXU005",20,0)
 ; This routine uses the following IAs:
"RTN","RORXU005",21,0)
 ;
"RTN","RORXU005",22,0)
 ; #10035        Direct read of the DOD field of the file #2
"RTN","RORXU005",23,0)
 ; #10061        DEM^VADPT (supported)
"RTN","RORXU005",24,0)
 ;
"RTN","RORXU005",25,0)
 Q
"RTN","RORXU005",26,0)
 ;
"RTN","RORXU005",27,0)
 ;***** CALLBACK FUNCTION FOR DRUG SEARCH API
"RTN","RORXU005",28,0)
REIMBCB(RORDST,ORDER,FLAGS,DRUG,DATE) ;
"RTN","RORXU005",29,0)
 S RORDST=1
"RTN","RORXU005",30,0)
 Q 2
"RTN","RORXU005",31,0)
 ;
"RTN","RORXU005",32,0)
 ;***** RETURNS THE REIMBURSEMENT LEVEL FOR THE PATIENT
"RTN","RORXU005",33,0)
 ;
"RTN","RORXU005",34,0)
 ; RORIEN        IEN of the patient's record in the registry
"RTN","RORXU005",35,0)
 ;
"RTN","RORXU005",36,0)
 ; ROR8DRGS      Either closed root of the ARV drug list prepared by
"RTN","RORXU005",37,0)
 ;               the $$DRUGLIST^RORUTL16 or the Registry IEN. In the
"RTN","RORXU005",38,0)
 ;               latter case, the list will be compiled automatically.
"RTN","RORXU005",39,0)
 ;
"RTN","RORXU005",40,0)
 ; STDT          Start date
"RTN","RORXU005",41,0)
 ; ENDT          End date
"RTN","RORXU005",42,0)
 ;
"RTN","RORXU005",43,0)
 ; Return Values:
"RTN","RORXU005",44,0)
 ;       <0  Error code
"RTN","RORXU005",45,0)
 ;        0  Neither Clinical AIDS nor ARV drugs
"RTN","RORXU005",46,0)
 ;       10  ARV drugs
"RTN","RORXU005",47,0)
 ;       20  Clinical AIDS
"RTN","RORXU005",48,0)
 ;       30  Both Clinical AIDS and ARV drugs
"RTN","RORXU005",49,0)
 ;
"RTN","RORXU005",50,0)
REIMBLVL(RORIEN,ROR8DRGS,STDT,ENDT) ;
"RTN","RORXU005",51,0)
 N PATIEN,RC,RLVL,RORDST
"RTN","RORXU005",52,0)
 S RLVL=0
"RTN","RORXU005",53,0)
 ;--- Clinical AIDS
"RTN","RORXU005",54,0)
 S:$$CLINAIDS^RORHIVUT(+RORIEN,ENDT) RLVL=RLVL+20
"RTN","RORXU005",55,0)
 ;--- ARV Drugs
"RTN","RORXU005",56,0)
 S PATIEN=$$PTIEN^RORUTL01(RORIEN)
"RTN","RORXU005",57,0)
 S RORDST("RORCB")="$$REIMBCB^RORXU005"
"RTN","RORXU005",58,0)
 S RC=$$RXSEARCH^RORUTL14(PATIEN,ROR8DRGS,.RORDST,"IOV",STDT,ENDT)
"RTN","RORXU005",59,0)
 S:$G(RORDST)>0 RLVL=RLVL+10
"RTN","RORXU005",60,0)
 ;--- Reimbursement level
"RTN","RORXU005",61,0)
 Q $S(RC<0:RC,1:RLVL)
"RTN","RORXU005",62,0)
 ;
"RTN","RORXU005",63,0)
 ;***** RETURNS THE PATIENT'S LIST OF RISK FACTORS
"RTN","RORXU005",64,0)
 ;
"RTN","RORXU005",65,0)
 ; RORIEN        IEN of the patient's record in the registry
"RTN","RORXU005",66,0)
 ;
"RTN","RORXU005",67,0)
 ; Return Values:
"RTN","RORXU005",68,0)
 ;       <0  Error code
"RTN","RORXU005",69,0)
 ;       ""  No risk factors have been found
"RTN","RORXU005",70,0)
 ;  " ... "  A string containing the risk factor numbers
"RTN","RORXU005",71,0)
 ;           separated by commas and spaces
"RTN","RORXU005",72,0)
 ;
"RTN","RORXU005",73,0)
RISKS(RORIEN) ;
"RTN","RORXU005",74,0)
 Q:'$D(^RORDATA(799.4,+RORIEN,0)) ""
"RTN","RORXU005",75,0)
 N FLD,FLDLST,I,IENS,RISKLST,RORBUF,RORMSG,DIERR
"RTN","RORXU005",76,0)
 S FLDLST="14.01;14.02;14.03;14.04;14.08;14.07;14.09;14.1;14.11;14.12;14.13;14.16;14.17"
"RTN","RORXU005",77,0)
 ;--- Load the risk fields
"RTN","RORXU005",78,0)
 S IENS=(+RORIEN)_","
"RTN","RORXU005",79,0)
 D GETS^DIQ(799.4,IENS,FLDLST,"I","RORBUF","RORMSG")
"RTN","RORXU005",80,0)
 Q:$G(DIERR) $$DBS^RORERR(799.4,-9,,,799.4,IENS)
"RTN","RORXU005",81,0)
 ;--- Process the data
"RTN","RORXU005",82,0)
 S RISKLST=""
"RTN","RORXU005",83,0)
 F I=1:1  S FLD=$P(FLDLST,";",I)  Q:FLD=""  D:FLD>0
"RTN","RORXU005",84,0)
 . S:$G(RORBUF(799.4,IENS,FLD,"I"))=1 RISKLST=RISKLST_", "_I
"RTN","RORXU005",85,0)
 Q $P(RISKLST,", ",2,999)
"RTN","RORXU005",86,0)
 ;
"RTN","RORXU005",87,0)
 ;***** DETERMINES IF THE PATIENT SHOULD NOT BE INCLUDED IN THE REPORT
"RTN","RORXU005",88,0)
 ;
"RTN","RORXU005",89,0)
 ; RORIEN        IEN of the patient's record in the registry
"RTN","RORXU005",90,0)
 ;
"RTN","RORXU005",91,0)
 ; FLAGS         Flags that control the execution (can be combined)
"RTN","RORXU005",92,0)
 ;
"RTN","RORXU005",93,0)
 ;                 C  Skip confirmed patients
"RTN","RORXU005",94,0)
 ;                 G  Skip pending patients
"RTN","RORXU005",95,0)
 ;
"RTN","RORXU005",96,0)
 ;                 D  Skip deceased patients
"RTN","RORXU005",97,0)
 ;                 L  Skip alive patients
"RTN","RORXU005",98,0)
 ;
"RTN","RORXU005",99,0)
 ;                 P  Skip patients confirmed before the start date
"RTN","RORXU005",100,0)
 ;                 N  Skip patients confirmed during the report
"RTN","RORXU005",101,0)
 ;                    time frame
"RTN","RORXU005",102,0)
 ;                 F  Skip patients added after the end date
"RTN","RORXU005",103,0)
 ;
"RTN","RORXU005",104,0)
 ;                 H  Skip patients without local HIV diagnosis
"RTN","RORXU005",105,0)
 ;
"RTN","RORXU005",106,0)
 ;                 M  Skip male patients
"RTN","RORXU005",107,0)
 ;                 W  Skip female patients
"RTN","RORXU005",108,0)
 ;
"RTN","RORXU005",109,0)
 ;                 O  Process LOCAL_FIELDS
"RTN","RORXU005",110,0)
 ;                 R  Process OTHER_REGISTRIES
"RTN","RORXU005",111,0)
 ;
"RTN","RORXU005",112,0)
 ;                 E  Exclude patients with OEF/OIF period of service
"RTN","RORXU005",113,0)
 ;                 I  Include only patients with OEF/OIF period of service
"RTN","RORXU005",114,0)
 ;
"RTN","RORXU005",115,0)
 ;                 S  Include only patients with SVR
"RTN","RORXU005",116,0)
 ;                 V  Include only patients with No SVR
"RTN","RORXU005",117,0)
 ;
"RTN","RORXU005",118,0)
 ; [STDT]        Start date of the report (FileMan).
"RTN","RORXU005",119,0)
 ;               Time is ignored and the beginning of the day is
"RTN","RORXU005",120,0)
 ;               considered as the boundary (STDT\1).
"RTN","RORXU005",121,0)
 ;
"RTN","RORXU005",122,0)
 ;               If not defined or not greater than 0 then 0 is used.
"RTN","RORXU005",123,0)
 ;
"RTN","RORXU005",124,0)
 ; [ENDT]        End date of the report (FileMan).
"RTN","RORXU005",125,0)
 ;               Time is ignored and the end of the day is
"RTN","RORXU005",126,0)
 ;               considered as the boundary (ENDT\1+1).
"RTN","RORXU005",127,0)
 ;
"RTN","RORXU005",128,0)
 ;               If not defined or not greater than 0 then 9999999
"RTN","RORXU005",129,0)
 ;               is used.
"RTN","RORXU005",130,0)
 ;
"RTN","RORXU005",131,0)
 ; Return Values:
"RTN","RORXU005",132,0)
 ;        0  Include the patient's data in the report
"RTN","RORXU005",133,0)
 ;        1  Skip the patient
"RTN","RORXU005",134,0)
 ;
"RTN","RORXU005",135,0)
SKIP(RORIEN,FLAGS,STDT,ENDT) ;
"RTN","RORXU005",136,0)
 N DOD,IEN,MODE,NODE,PTIEN,REGIEN,BIRTHSEX,SKIP,STATUS,TMP,ARFLAG
"RTN","RORXU005",137,0)
 S SKIP=0
"RTN","RORXU005",138,0)
 ;--- Always skip patients marked for deletion
"RTN","RORXU005",139,0)
 Q:$$SKIPNA(RORIEN,FLAGS,.STATUS) 1
"RTN","RORXU005",140,0)
 ;---Include all registry patients if flags are not provided
"RTN","RORXU005",141,0)
 Q:FLAGS="" 0
"RTN","RORXU005",142,0)
 ;
"RTN","RORXU005",143,0)
 ;--- Confirmed
"RTN","RORXU005",144,0)
 I FLAGS["C"  Q:STATUS'=4 1
"RTN","RORXU005",145,0)
 ;
"RTN","RORXU005",146,0)
 ;--- Alive/Deceased patients
"RTN","RORXU005",147,0)
 S STDT=$S($G(STDT)>0:STDT\1,1:0)
"RTN","RORXU005",148,0)
 I $TR(FLAGS,"LD")'=FLAGS  D  Q:$S(TMP:FLAGS["L",1:FLAGS["D") 1
"RTN","RORXU005",149,0)
 . S:'$D(PTIEN) PTIEN=+$$PTIEN^RORUTL01(RORIEN)
"RTN","RORXU005",150,0)
 . S DOD=+$P($G(^DPT(PTIEN,.35)),U)
"RTN","RORXU005",151,0)
 . S TMP=$S(DOD>0:DOD'<STDT,1:1)
"RTN","RORXU005",152,0)
 ;
"RTN","RORXU005",153,0)
 ;--- Male/Female patients screen
"RTN","RORXU005",154,0)
 I FLAGS["M"!(FLAGS["W") D  Q:SKIP 1
"RTN","RORXU005",155,0)
 . S:'$D(PTIEN) PTIEN=+$$PTIEN^RORUTL01(RORIEN)  ;get dfn
"RTN","RORXU005",156,0)
 . S SKIP=$$SKIPSEX(PTIEN,FLAGS)
"RTN","RORXU005",157,0)
 ;
"RTN","RORXU005",158,0)
 ;--- Age Range patients screen
"RTN","RORXU005",159,0)
 S ARFLAG=$G(RORTSK("PARAMS","AGE_RANGE","A","TYPE"))
"RTN","RORXU005",160,0)
 I $D(ARFLAG),ARFLAG'="ALL" D  Q:SKIP 1
"RTN","RORXU005",161,0)
 . S:'$D(PTIEN) PTIEN=+$$PTIEN^RORUTL01(RORIEN)  ;get dfn
"RTN","RORXU005",162,0)
 . S SKIP=$$SKIPAR(PTIEN,ARFLAG)
"RTN","RORXU005",163,0)
 ;
"RTN","RORXU005",164,0)
 ;--- OEF/OIF period of service patients screen
"RTN","RORXU005",165,0)
 I FLAGS["E"!(FLAGS["I") D  Q:SKIP 1
"RTN","RORXU005",166,0)
 . S:'$D(PTIEN) PTIEN=+$$PTIEN^RORUTL01(RORIEN)  ;get dfn
"RTN","RORXU005",167,0)
 . S SKIP=$$SKIPOEF(PTIEN,FLAGS)
"RTN","RORXU005",168,0)
 ;
"RTN","RORXU005",169,0)
 ;--- SVR patients screen
"RTN","RORXU005",170,0)
 I FLAGS["V"!(FLAGS["S") D  Q:SKIP 1
"RTN","RORXU005",171,0)
 . N REGIEN,RC,RORXL,RORLDST,RORXDST
"RTN","RORXU005",172,0)
 . S:'$D(PTIEN) PTIEN=+$$PTIEN^RORUTL01(RORIEN)  ;get dfn
"RTN","RORXU005",173,0)
 . S REGIEN=$$GET1^DIQ(798,RORIEN_",",.02,"I")
"RTN","RORXU005",174,0)
 . ;== Lab parameters
"RTN","RORXU005",175,0)
 . S RORLDST("RORCB")="$$LTSCB^RORX023A"
"RTN","RORXU005",176,0)
 . ;== Pharm parameters
"RTN","RORXU005",177,0)
 . S RORXDST("GENERIC")=1  ;only meds with generic name
"RTN","RORXU005",178,0)
 . S RORXDST("RORCB")="$$RXOCB^RORX023A"   ;call back routine
"RTN","RORXU005",179,0)
 . ;--- RX list of HepC registry drugs
"RTN","RORXU005",180,0)
 . S RORXL=$$ALLOC^RORTMP()
"RTN","RORXU005",181,0)
 . S RC=$$DRUGLIST^RORUTL16(RORXL,REGIEN)
"RTN","RORXU005",182,0)
 . S RC=$$SVR^RORX023A(PTIEN,2000101,DT,REGIEN,RORXL,"",$$FMADD^XLFDT(DT,1),.RORLDST,.RORXDST)
"RTN","RORXU005",183,0)
 . D POP^RORTMP(RORXL)
"RTN","RORXU005",184,0)
 . I FLAGS["V" S SKIP=$S(RC=0:0,1:1) Q  ; skip if SVR and not SVR requested
"RTN","RORXU005",185,0)
 . I FLAGS["S" S SKIP=$S(RC=1:0,1:1)    ; skip if not SVR and SVR requested
"RTN","RORXU005",186,0)
 ;
"RTN","RORXU005",187,0)
 ;--- Confirmed before/during/after the date range
"RTN","RORXU005",188,0)
 S ENDT=$S($G(ENDT)>0:ENDT\1,1:9999999)+1
"RTN","RORXU005",189,0)
 I $TR(FLAGS,"PNF")'=FLAGS  D  Q:TMP 1
"RTN","RORXU005",190,0)
 . S TMP=+$$CONFDT^RORUTL18(RORIEN)  ; Date Confirmed
"RTN","RORXU005",191,0)
 . S TMP=$S(TMP<STDT:FLAGS["P",TMP>ENDT:FLAGS["F",1:FLAGS["N")
"RTN","RORXU005",192,0)
 ;
"RTN","RORXU005",193,0)
 ;--- Other registries
"RTN","RORXU005",194,0)
 I FLAGS["R"  D  Q:SKIP 1
"RTN","RORXU005",195,0)
 . S NODE=$NA(RORTSK("PARAMS","OTHER_REGISTRIES","C"))
"RTN","RORXU005",196,0)
 . Q:$D(@NODE)<10
"RTN","RORXU005",197,0)
 . S:'$D(PTIEN) PTIEN=+$$PTIEN^RORUTL01(RORIEN)
"RTN","RORXU005",198,0)
 . S REGIEN=0
"RTN","RORXU005",199,0)
 . F  S REGIEN=$O(@NODE@(REGIEN))  Q:REGIEN'>0  D  Q:SKIP
"RTN","RORXU005",200,0)
 . . S MODE=+$G(@NODE@(REGIEN))  Q:'MODE
"RTN","RORXU005",201,0)
 . . S IEN=$$PRRIEN^RORUTL01(PTIEN,REGIEN)
"RTN","RORXU005",202,0)
 . . I IEN'>0  S SKIP=1
"RTN","RORXU005",203,0)
 . . E  S:$$SKIPNA(IEN,FLAGS) SKIP=1
"RTN","RORXU005",204,0)
 . . S:MODE<0 SKIP='SKIP  ; Exclude
"RTN","RORXU005",205,0)
 ;
"RTN","RORXU005",206,0)
 ;--- Local Fields
"RTN","RORXU005",207,0)
 I FLAGS["O"  D  Q:SKIP 1
"RTN","RORXU005",208,0)
 . S NODE=$NA(RORTSK("PARAMS","LOCAL_FIELDS","C"))
"RTN","RORXU005",209,0)
 . Q:$D(@NODE)<10
"RTN","RORXU005",210,0)
 . S IEN=0
"RTN","RORXU005",211,0)
 . F  S IEN=$O(@NODE@(IEN))  Q:IEN'>0  D  Q:SKIP
"RTN","RORXU005",212,0)
 . . S MODE=+$G(@NODE@(IEN))  Q:'MODE
"RTN","RORXU005",213,0)
 . . S:'$D(^RORDATA(798,RORIEN,20,"B",IEN)) SKIP=1
"RTN","RORXU005",214,0)
 . . S:MODE<0 SKIP='SKIP  ; Exclude
"RTN","RORXU005",215,0)
 ;
"RTN","RORXU005",216,0)
 ;--- Local HIV Diagnosis
"RTN","RORXU005",217,0)
 I FLAGS["H" D  Q:SKIP 1
"RTN","RORXU005",218,0)
 . N RORV
"RTN","RORXU005",219,0)
 . S MODE=+RORTSK("PARAMS","HIV_DX") Q:'MODE
"RTN","RORXU005",220,0)
 . S RORV=+$P($G(^RORDATA(799.4,RORIEN,12)),U,8)
"RTN","RORXU005",221,0)
 . S:RORV'=1 SKIP=1
"RTN","RORXU005",222,0)
 . S:MODE<0 SKIP='SKIP
"RTN","RORXU005",223,0)
 ;
"RTN","RORXU005",224,0)
 ;
"RTN","RORXU005",225,0)
 ;--- Include in the report
"RTN","RORXU005",226,0)
 Q 0
"RTN","RORXU005",227,0)
 ;
"RTN","RORXU005",228,0)
 ;***** CHECKS STATUS OF THE PATIENT'S REGISTRY RECORD (internal)
"RTN","RORXU005",229,0)
 ;
"RTN","RORXU005",230,0)
 ; IEN798        IEN of the patient's record in the registry
"RTN","RORXU005",231,0)
 ;
"RTN","RORXU005",232,0)
 ; FLAGS         Flags that control the execution
"RTN","RORXU005",233,0)
 ;
"RTN","RORXU005",234,0)
 ; [.STATUS]     Status code is returned via this parameter.
"RTN","RORXU005",235,0)
 ;
"RTN","RORXU005",236,0)
 ; Return Values:
"RTN","RORXU005",237,0)
 ;        0  Continue processing of the patient's data
"RTN","RORXU005",238,0)
 ;        1  Skip the patient
"RTN","RORXU005",239,0)
 ;
"RTN","RORXU005",240,0)
SKIPNA(IEN798,FLAGS,STATUS) ;
"RTN","RORXU005",241,0)
 Q:$$ACTIVE^RORDD(IEN798,,.STATUS) 0  ; Active patient
"RTN","RORXU005",242,0)
 Q:(STATUS=5)!(STATUS="") 1           ; Deleted patient
"RTN","RORXU005",243,0)
 Q:(STATUS=4)&(FLAGS["G") 1           ; Pending patient
"RTN","RORXU005",244,0)
 Q 0
"RTN","RORXU005",245,0)
 ;
"RTN","RORXU005",246,0)
 ;***** CHECKS IF BIRTHSEX OF PATIENT MATCHES BIRTHSEX SELECTED FOR REPORT
"RTN","RORXU005",247,0)
 ;
"RTN","RORXU005",248,0)
 ; DFN           IEN of the patient's record in the patient file (#2)
"RTN","RORXU005",249,0)
 ;
"RTN","RORXU005",250,0)
 ; FLAGS         Flags that control the execution
"RTN","RORXU005",251,0)
 ;
"RTN","RORXU005",252,0)
 ; Return Values:
"RTN","RORXU005",253,0)
 ;        0  Continue processing of the patient's data
"RTN","RORXU005",254,0)
 ;        1  Skip the patient
"RTN","RORXU005",255,0)
 ;
"RTN","RORXU005",256,0)
SKIPSEX(DFN,FLAGS) ;
"RTN","RORXU005",257,0)
 N VADM,VAPTYP,VAHOW,BIRTHSEX
"RTN","RORXU005",258,0)
 D DEM^VADPT
"RTN","RORXU005",259,0)
 S BIRTHSEX=$P($G(VADM(5)),U)
"RTN","RORXU005",260,0)
 Q $S(FLAGS["M":BIRTHSEX'="F",FLAGS["W":BIRTHSEX'="M",1:0)
"RTN","RORXU005",261,0)
 ;
"RTN","RORXU005",262,0)
 ;***** CHECKS IF PERIOD OF SERVICE OF PATIENT MATCHES OEF/OIF SELECTION FOR
"RTN","RORXU005",263,0)
 ;      REPORT
"RTN","RORXU005",264,0)
 ;
"RTN","RORXU005",265,0)
 ; DFN           IEN of the patient's record in the patient file (#2)
"RTN","RORXU005",266,0)
 ;
"RTN","RORXU005",267,0)
 ; FLAGS         Flags that control the execution
"RTN","RORXU005",268,0)
 ;
"RTN","RORXU005",269,0)
 ; Return Values:
"RTN","RORXU005",270,0)
 ;        0  Continue processing of the patient's data
"RTN","RORXU005",271,0)
 ;        1  Skip the patient
"RTN","RORXU005",272,0)
 ;
"RTN","RORXU005",273,0)
SKIPOEF(DFN,FLAGS) ;
"RTN","RORXU005",274,0)
 N VASV,QUIT
"RTN","RORXU005",275,0)
 D SVC^VADPT
"RTN","RORXU005",276,0)
 S QUIT=0
"RTN","RORXU005",277,0)
 ; Ignore if Only OEF/OIF selected and patient has no such POS
"RTN","RORXU005",278,0)
 I FLAGS["I" S QUIT=$S($G(VASV(11))!($G(VASV(12)))!($G(VASV(13))):0,1:1)
"RTN","RORXU005",279,0)
 ; Ignore if Exclude OEF/OIF selected and patient has such POS
"RTN","RORXU005",280,0)
 I 'QUIT,FLAGS["E" S QUIT=$S($G(VASV(11))!($G(VASV(12)))!($G(VASV(13))):1,1:0)
"RTN","RORXU005",281,0)
 Q QUIT
"RTN","RORXU005",282,0)
 ;
"RTN","RORXU005",283,0)
 ;***** CHECKS IF AGE RANGE OF PATIENT MATCHES AGE RANGE SELECTED FOR REPORT
"RTN","RORXU005",284,0)
 ;
"RTN","RORXU005",285,0)
 ; DFN           IEN of the patient's record in the patient file (#2)
"RTN","RORXU005",286,0)
 ;
"RTN","RORXU005",287,0)
 ; FLAGS         Flags that control the execution
"RTN","RORXU005",288,0)
 ;
"RTN","RORXU005",289,0)
 ; Return Values:
"RTN","RORXU005",290,0)
 ;        0  Continue processing of the patient's data
"RTN","RORXU005",291,0)
 ;        1  Skip the patient
"RTN","RORXU005",292,0)
 ;
"RTN","RORXU005",293,0)
SKIPAR(DFN,ARFLAGS) ; skip Age Range
"RTN","RORXU005",294,0)
 N VADM,VAPTYP,VAHOW,ARSTDT,ARENDT,PATAGE
"RTN","RORXU005",295,0)
 I $G(ARFLAGS)="" Q 0
"RTN","RORXU005",296,0)
 D DEM^VADPT
"RTN","RORXU005",297,0)
 S ARSTDT=$G(RORTSK("PARAMS","AGE_RANGE","A","START"))
"RTN","RORXU005",298,0)
 S ARENDT=$G(RORTSK("PARAMS","AGE_RANGE","A","END"))
"RTN","RORXU005",299,0)
 I ARSTDT>ARENDT!(ARSTDT="")!(ARENDT="") Q 0
"RTN","RORXU005",300,0)
 S PATAGE=$S(ARFLAGS["AGE":$P($G(VADM(4)),U),ARFLAGS["DOB":$P($G(VADM(3)),U),1:"")
"RTN","RORXU005",301,0)
 I PATAGE>ARENDT!(PATAGE<ARSTDT) Q 1
"RTN","RORXU005",302,0)
 Q 0
"RTN","RORXU006")
0^6^B51777169^B42534255
"RTN","RORXU006",1,0)
RORXU006 ;HCIOFO/SG - REPORT PARAMETERS ;6/21/06 1:41pm
"RTN","RORXU006",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**1,13,21,31**;Feb 17, 2006;Build 62
"RTN","RORXU006",3,0)
 ;
"RTN","RORXU006",4,0)
 ; This routine uses the following IAs:
"RTN","RORXU006",5,0)
 ;
"RTN","RORXU006",6,0)
 ; #91           Read access to the file #60 (controlled)
"RTN","RORXU006",7,0)
 ; #417          The .01 field of file #40.8 (controlled)
"RTN","RORXU006",8,0)
 ; #2947         ATESTS^ORWLRR (controlled)
"RTN","RORXU006",9,0)
 ; #10035        Direct read of DOD field of file #2 (supported)
"RTN","RORXU006",10,0)
 ; #10040        Read access to HOSPITAL LOCATION file (supported)
"RTN","RORXU006",11,0)
 ;
"RTN","RORXU006",12,0)
 ;******************************************************************************
"RTN","RORXU006",13,0)
 ;******************************************************************************
"RTN","RORXU006",14,0)
 ;                 --- ROUTINE MODIFICATION LOG ---
"RTN","RORXU006",15,0)
 ;        
"RTN","RORXU006",16,0)
 ;PKG/PATCH    DATE        DEVELOPER    MODIFICATION
"RTN","RORXU006",17,0)
 ;-----------  ----------  -----------  ----------------------------------------
"RTN","RORXU006",18,0)
 ;ROR*1.5*13   DEC  2010   A SAUNDERS   Moved code in tags CLINLST and DIVLST to
"RTN","RORXU006",19,0)
 ;                                      PARMS^RORXU002 so the clinic or
"RTN","RORXU006",20,0)
 ;                                      division XML will be returned for all
"RTN","RORXU006",21,0)
 ;                                      reports. 
"RTN","RORXU006",22,0)
 ;                                      NOTE: Patch 11 became patch 13.
"RTN","RORXU006",23,0)
 ;                                      Any references to patch 11 in the code
"RTN","RORXU006",24,0)
 ;                                      below is referring to path 13.
"RTN","RORXU006",25,0)
 ;ROR*1.5*21   SEP 2013    T KOPP       Add ICN column if Additional Identifier
"RTN","RORXU006",26,0)
 ;
"RTN","RORXU006",27,0)
 ;ROR*1.5*31   MAY 2017    M FERRARESE  Adding PACT and PCP as additional
"RTN","RORXU006",28,0)
 ;                                      identifiers.                                 
"RTN","RORXU006",29,0)
 ;******************************************************************************
"RTN","RORXU006",30,0)
 ;******************************************************************************
"RTN","RORXU006",31,0)
 Q
"RTN","RORXU006",32,0)
 ;
"RTN","RORXU006",33,0)
 ;***** PROCESSES THE LIST OF CLINICS
"RTN","RORXU006",34,0)
 ;
"RTN","RORXU006",35,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORXU006",36,0)
 ;
"RTN","RORXU006",37,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORXU006",38,0)
 ;
"RTN","RORXU006",39,0)
 ; Return Values:
"RTN","RORXU006",40,0)
 ;       <0  Error code
"RTN","RORXU006",41,0)
 ;       >0  IEN of the CLINICS element
"RTN","RORXU006",42,0)
 ;
"RTN","RORXU006",43,0)
CLINLST(RORTSK,PARTAG) ;
"RTN","RORXU006",44,0)
 Q 0  ;code removed for patch 11
"RTN","RORXU006",45,0)
 N IEN,LTAG,RORMSG,TMP
"RTN","RORXU006",46,0)
 I $D(RORTSK("PARAMS","CLINICS","C"))>1  D
"RTN","RORXU006",47,0)
 . S LTAG=$$ADDVAL^RORTSK11(RORTSK,"CLINICS",,PARTAG)  Q:LTAG'>0
"RTN","RORXU006",48,0)
 . S IEN=0
"RTN","RORXU006",49,0)
 . F  S IEN=$O(RORTSK("PARAMS","CLINICS","C",IEN))  Q:IEN'>0  D
"RTN","RORXU006",50,0)
 . . S TMP=$$GET1^DIQ(44,IEN_",",.01,,,"RORMSG")
"RTN","RORXU006",51,0)
 . . D:$G(DIERR) DBS^RORERR("RORMSG",-9,,,44,IEN_",")
"RTN","RORXU006",52,0)
 . . Q:TMP=""
"RTN","RORXU006",53,0)
 . . D ADDVAL^RORTSK11(RORTSK,"CLINIC",TMP,LTAG,,IEN)
"RTN","RORXU006",54,0)
 E  D:$$PARAM^RORTSK01("CLINICS","ALL")
"RTN","RORXU006",55,0)
 . S LTAG=$$ADDVAL^RORTSK11(RORTSK,"CLINICS","ALL",PARTAG)
"RTN","RORXU006",56,0)
 Q +$G(LTAG)
"RTN","RORXU006",57,0)
 ;
"RTN","RORXU006",58,0)
 ;***** PROCESSES THE LIST OF CPT CODES
"RTN","RORXU006",59,0)
 ;
"RTN","RORXU006",60,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORXU006",61,0)
 ;
"RTN","RORXU006",62,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORXU006",63,0)
 ;
"RTN","RORXU006",64,0)
 ; Return Values:
"RTN","RORXU006",65,0)
 ;       <0  Error code
"RTN","RORXU006",66,0)
 ;       >0  IEN of the CPTLST element
"RTN","RORXU006",67,0)
 ;
"RTN","RORXU006",68,0)
CPTLST(RORTSK,PARTAG) ;
"RTN","RORXU006",69,0)
 N CPT,IEN,LTAG,TMP
"RTN","RORXU006",70,0)
 I $D(RORTSK("PARAMS","CPTLST","C"))>1  D
"RTN","RORXU006",71,0)
 . S LTAG=$$ADDVAL^RORTSK11(RORTSK,"CPTLST",,PARTAG)  Q:LTAG'>0
"RTN","RORXU006",72,0)
 . S IEN=0
"RTN","RORXU006",73,0)
 . F  S IEN=$O(RORTSK("PARAMS","CPTLST","C",IEN))  Q:IEN'>0  D
"RTN","RORXU006",74,0)
 . . S CPT=$P(RORTSK("PARAMS","CPTLST","C",IEN),U)  Q:CPT=""
"RTN","RORXU006",75,0)
 . . D ADDVAL^RORTSK11(RORTSK,"CPT",CPT,LTAG,,IEN)
"RTN","RORXU006",76,0)
 E  D:$$PARAM^RORTSK01("CPTLST","ALL")
"RTN","RORXU006",77,0)
 . S LTAG=$$ADDVAL^RORTSK11(RORTSK,"CPTLST","ALL",PARTAG)
"RTN","RORXU006",78,0)
 Q +$G(LTAG)
"RTN","RORXU006",79,0)
 ;
"RTN","RORXU006",80,0)
 ;***** PROCESSES THE LIST OF DIVISIONS
"RTN","RORXU006",81,0)
 ;
"RTN","RORXU006",82,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORXU006",83,0)
 ;
"RTN","RORXU006",84,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORXU006",85,0)
 ;
"RTN","RORXU006",86,0)
 ; Return Values:
"RTN","RORXU006",87,0)
 ;       <0  Error code
"RTN","RORXU006",88,0)
 ;       >0  IEN of the DIVISIONS element
"RTN","RORXU006",89,0)
 ;
"RTN","RORXU006",90,0)
DIVLST(RORTSK,PARTAG) ;
"RTN","RORXU006",91,0)
 Q 0  ;code removed for patch 11
"RTN","RORXU006",92,0)
 N IEN,LTAG,RORMSG,TMP
"RTN","RORXU006",93,0)
 I $D(RORTSK("PARAMS","DIVISIONS","C"))>1  D
"RTN","RORXU006",94,0)
 . S LTAG=$$ADDVAL^RORTSK11(RORTSK,"DIVISIONS",,PARTAG)  Q:LTAG'>0
"RTN","RORXU006",95,0)
 . S IEN=0
"RTN","RORXU006",96,0)
 . F  S IEN=$O(RORTSK("PARAMS","DIVISIONS","C",IEN))  Q:IEN'>0  D
"RTN","RORXU006",97,0)
 . . S TMP=$$GET1^DIQ(40.8,IEN_",",.01,,,"RORMSG")
"RTN","RORXU006",98,0)
 . . D:$G(DIERR) DBS^RORERR("RORMSG",-9,,,40.8,IEN_",")
"RTN","RORXU006",99,0)
 . . Q:TMP=""
"RTN","RORXU006",100,0)
 . . D ADDVAL^RORTSK11(RORTSK,"DIVISION",TMP,LTAG,,IEN)
"RTN","RORXU006",101,0)
 E  D:$$PARAM^RORTSK01("DIVISIONS","ALL")
"RTN","RORXU006",102,0)
 . S LTAG=$$ADDVAL^RORTSK11(RORTSK,"DIVISIONS","ALL",PARTAG)
"RTN","RORXU006",103,0)
 Q +$G(LTAG)
"RTN","RORXU006",104,0)
 ;
"RTN","RORXU006",105,0)
 ;***** PROCESSES THE LIST OF LAB TESTS
"RTN","RORXU006",106,0)
 ;
"RTN","RORXU006",107,0)
 ; .RORTSK       Task number and task parameters
"RTN","RORXU006",108,0)
 ;
"RTN","RORXU006",109,0)
 ; PARTAG        Reference (IEN) to the parent tag
"RTN","RORXU006",110,0)
 ;
"RTN","RORXU006",111,0)
 ;
"RTN","RORXU006",112,0)
 ; .ROR8LST      Reference to a local variable, which contains a
"RTN","RORXU006",113,0)
 ;               closed root of an array. Descriptors of selected
"RTN","RORXU006",114,0)
 ;               lab tests will be returned into this array.
"RTN","RORXU006",115,0)
 ;
"RTN","RORXU006",116,0)
 ;                 @ROR8LTST@(ResultNode,TestIEN)
"RTN","RORXU006",117,0)
 ;                   ^01: Test IEN (in file #60)
"RTN","RORXU006",118,0)
 ;                   ^02: Test name
"RTN","RORXU006",119,0)
 ;                   ^03: 99
"RTN","RORXU006",120,0)
 ;                   ^04: "Other"
"RTN","RORXU006",121,0)
 ;                   ^05: Location subscript
"RTN","RORXU006",122,0)
 ;                   ^06: Result node
"RTN","RORXU006",123,0)
 ;
"RTN","RORXU006",124,0)
 ;               If this parameter is undefined or empty, then a
"RTN","RORXU006",125,0)
 ;               temporary buffer is allocated by the $$ALLOC^RORTMP
"RTN","RORXU006",126,0)
 ;               function and its root is returned via this parameter.
"RTN","RORXU006",127,0)
 ;
"RTN","RORXU006",128,0)
 ;               If all drugs are requested (the "ALL" attribute of
"RTN","RORXU006",129,0)
 ;               the "DRUGS" tag), then "*" is returned.
"RTN","RORXU006",130,0)
 ;
"RTN","RORXU006",131,0)
 ; [ROR8LRG]     Closed root of a node where the lab tests with
"RTN","RORXU006",132,0)
 ;               defined range values will be returned. By default
"RTN","RORXU006",133,0)
 ;               ($G(ROR8LRG)=""), this list is not compiled.
"RTN","RORXU006",134,0)
 ;
"RTN","RORXU006",135,0)
 ;                  @ROR8LRG@(TestIEN,
"RTN","RORXU006",136,0)
 ;                    "H") = Low
"RTN","RORXU006",137,0)
 ;                    "L") = High
"RTN","RORXU006",138,0)
 ;
"RTN","RORXU006",139,0)
 ;               "H", "L", or both will be defined.
"RTN","RORXU006",140,0)
 ;
"RTN","RORXU006",141,0)
 ; If the source list contains lab test panels, all corresponding
"RTN","RORXU006",142,0)
 ; lab tests are added to the @ROR8LST array but only a single tag
"RTN","RORXU006",143,0)
 ; is added to the XML list.
"RTN","RORXU006",144,0)
 ;
"RTN","RORXU006",145,0)
 ; Return Values:
"RTN","RORXU006",146,0)
 ;       <0  Error code
"RTN","RORXU006",147,0)
 ;       >0  IEN of the LABTESTS element
"RTN","RORXU006",148,0)
 ;
"RTN","RORXU006",149,0)
LTLST(RORTSK,PARTAG,ROR8LST,ROR8LRG) ;
"RTN","RORXU006",150,0)
 N ALL,BUF,I,LTAG,LTIEN,LTOPTS,TMP
"RTN","RORXU006",151,0)
 S ALL=+$$PARAM^RORTSK01("LABTESTS","ALL")
"RTN","RORXU006",152,0)
 S (LTAG,RC)=0
"RTN","RORXU006",153,0)
 ;
"RTN","RORXU006",154,0)
 ;=== Validate parameters
"RTN","RORXU006",155,0)
 I 'ALL  D  K @ROR8LST
"RTN","RORXU006",156,0)
 . S:$G(ROR8LST)="" ROR8LST=$$ALLOC^RORTMP()
"RTN","RORXU006",157,0)
 E  S ROR8LST="*"
"RTN","RORXU006",158,0)
 ;
"RTN","RORXU006",159,0)
 ;=== Process the drug options (if present)
"RTN","RORXU006",160,0)
 M LTOPTS=RORTSK("PARAMS","LABTESTS","A")
"RTN","RORXU006",161,0)
 I $D(LTOPTS)>1  D  Q:LTAG'>0 LTAG
"RTN","RORXU006",162,0)
 . N ATTR,REGIEN
"RTN","RORXU006",163,0)
 . S ATTR=$S(ALL:"ALL",1:"")
"RTN","RORXU006",164,0)
 . S LTAG=$$ADDVAL^RORTSK11(RORTSK,"LABTESTS",ATTR,PARTAG)
"RTN","RORXU006",165,0)
 . Q:LTAG'>0
"RTN","RORXU006",166,0)
 . ;--- Output option attributes
"RTN","RORXU006",167,0)
 . S ATTR="",RC=0
"RTN","RORXU006",168,0)
 . F  S ATTR=$O(LTOPTS(ATTR))  Q:ATTR=""  D  Q:RC<0
"RTN","RORXU006",169,0)
 . . S RC=$$ADDATTR^RORTSK11(RORTSK,LTAG,ATTR,"1")
"RTN","RORXU006",170,0)
 . I RC<0  S LTAG=RC  Q
"RTN","RORXU006",171,0)
 . S ATTR=$$OPTXT^RORXU002(.LTOPTS)
"RTN","RORXU006",172,0)
 . D:ATTR'="" ADDATTR^RORTSK11(RORTSK,LTAG,"DESCR",ATTR)
"RTN","RORXU006",173,0)
 ;
"RTN","RORXU006",174,0)
 ;=== Process the list of tests (if present)
"RTN","RORXU006",175,0)
 I 'ALL,$D(RORTSK("PARAMS","LABTESTS","C"))>1  D
"RTN","RORXU006",176,0)
 . I LTAG'>0  D  Q:LTAG'>0
"RTN","RORXU006",177,0)
 . . S LTAG=$$ADDVAL^RORTSK11(RORTSK,"LABTESTS",,PARTAG)
"RTN","RORXU006",178,0)
 . S LTIEN=0
"RTN","RORXU006",179,0)
 . F  S LTIEN=$O(RORTSK("PARAMS","LABTESTS","C",LTIEN))  Q:LTIEN'>0  D
"RTN","RORXU006",180,0)
 . . D LTLSTI(LTIEN,LTAG)
"RTN","RORXU006",181,0)
 ;
"RTN","RORXU006",182,0)
 Q $S(RC<0:RC,1:LTAG)
"RTN","RORXU006",183,0)
 ;
"RTN","RORXU006",184,0)
 ;***** CREATES THE LAB TEST ITEM(S)
"RTN","RORXU006",185,0)
 ;
"RTN","RORXU006",186,0)
 ; LTIEN         IEN of the lab test in the file #60
"RTN","RORXU006",187,0)
 ; [LTAG]        IEN of the parent tag
"RTN","RORXU006",188,0)
 ;
"RTN","RORXU006",189,0)
 ; This is an internal entry point. Do NOT call it directly.
"RTN","RORXU006",190,0)
 ;
"RTN","RORXU006",191,0)
LTLSTI(LTIEN,LTAG) ;
"RTN","RORXU006",192,0)
 N BUF,I,IENS,ITEM,LTNAME,LTNODE,PLTCNT,RORBUF,RORMSG,TMP
"RTN","RORXU006",193,0)
 ;--- Load the lab test parameters
"RTN","RORXU006",194,0)
 S IENS=LTIEN_","
"RTN","RORXU006",195,0)
 D GETS^DIQ(60,IENS,".01;5","EI","RORBUF","RORMSG")
"RTN","RORXU006",196,0)
 D:$G(DIERR) DBS^RORERR("RORMSG",-9,,,60,IENS)
"RTN","RORXU006",197,0)
 S LTNAME=$G(RORBUF(60,IENS,.01,"E"))  Q:LTNAME=""
"RTN","RORXU006",198,0)
 ;--- Output the tag and update the list of ranges
"RTN","RORXU006",199,0)
 D:$G(LTAG)>0
"RTN","RORXU006",200,0)
 . S ITEM=$$ADDVAL^RORTSK11(RORTSK,"LT",LTNAME,LTAG,,LTIEN)
"RTN","RORXU006",201,0)
 . S TMP=$$UP^XLFSTR($G(RORTSK("PARAMS","LABTESTS","C",LTIEN,"L")))
"RTN","RORXU006",202,0)
 . D:TMP'=""
"RTN","RORXU006",203,0)
 . . D ADDATTR^RORTSK11(RORTSK,ITEM,"LOW",TMP)
"RTN","RORXU006",204,0)
 . . S:$G(ROR8LRG)'="" @ROR8LRG@(LTIEN,"L")=TMP
"RTN","RORXU006",205,0)
 . S TMP=$$UP^XLFSTR($G(RORTSK("PARAMS","LABTESTS","C",LTIEN,"H")))
"RTN","RORXU006",206,0)
 . D:TMP'=""
"RTN","RORXU006",207,0)
 . . D ADDATTR^RORTSK11(RORTSK,ITEM,"HIGH",TMP)
"RTN","RORXU006",208,0)
 . . S:$G(ROR8LRG)'="" @ROR8LRG@(LTIEN,"H")=TMP
"RTN","RORXU006",209,0)
 ;--- Process the panel
"RTN","RORXU006",210,0)
 D ATESTS^ORWLRR(.BUF,LTIEN)
"RTN","RORXU006",211,0)
 I $D(BUF)>1  S I="",PLTCNT=0  D  Q:PLTCNT>1
"RTN","RORXU006",212,0)
 . F  S I=$O(BUF(I))  Q:I=""  D
"RTN","RORXU006",213,0)
 . . S TMP=+$P(BUF(I),U),PLTCNT=PLTCNT+1
"RTN","RORXU006",214,0)
 . . D:TMP'=LTIEN LTLSTI(TMP)
"RTN","RORXU006",215,0)
 ;--- Create the reference
"RTN","RORXU006",216,0)
 S LTNODE=$P($G(RORBUF(60,IENS,5,"I")),";",2)  Q:LTNODE=""
"RTN","RORXU006",217,0)
 S BUF=LTIEN_U_LTNAME_U_"99^Other"
"RTN","RORXU006",218,0)
 S $P(BUF,U,5)=$P(RORBUF(60,IENS,5,"I"),";")  ; Subscript
"RTN","RORXU006",219,0)
 S $P(BUF,U,6)=LTNODE                         ; Result node
"RTN","RORXU006",220,0)
 S @ROR8LST@(LTNODE,LTIEN)=BUF
"RTN","RORXU006",221,0)
 Q
"RTN","RORXU006",222,0)
 ;
"RTN","RORXU006",223,0)
 ;***** CHECKS IF THE OPTIONAL COLUMN IS SELECTED
"RTN","RORXU006",224,0)
 ;
"RTN","RORXU006",225,0)
 ; NAME          Column name
"RTN","RORXU006",226,0)
 ;
"RTN","RORXU006",227,0)
 ; Return Values:
"RTN","RORXU006",228,0)
 ;        0  Skip the field
"RTN","RORXU006",229,0)
 ;       >0  Include in report
"RTN","RORXU006",230,0)
 ;
"RTN","RORXU006",231,0)
OPTCOL(NAME) ;
"RTN","RORXU006",232,0)
 Q $S($G(NAME)'="":$D(RORTSK("PARAMS","OPTIONAL_COLUMNS","C",NAME)),1:0)
"RTN","RORXU006",233,0)
 ;
"RTN","RORXU006",234,0)
 ;***** CHECK IF ONLY THE SUMMARY SHOULD BE GENERATED
"RTN","RORXU006",235,0)
SMRYONLY() ;
"RTN","RORXU006",236,0)
 Q:$$PARAM^RORTSK01("MAXUTNUM")'="" 0
"RTN","RORXU006",237,0)
 Q:$$PARAM^RORTSK01("MINRPNUM")'="" 0
"RTN","RORXU006",238,0)
 Q 1
"RTN","RORXU006",239,0)
 ;
"RTN","RORXU006",240,0)
 ;***** OUTPUTS ICN DATA IF ICN SHOULD BE THE FINAL COLUMN
"RTN","RORXU006",241,0)
 ; TASK          Task number
"RTN","RORXU006",242,0)
 ;
"RTN","RORXU006",243,0)
 ; VALUE         DFN of patient
"RTN","RORXU006",244,0)
 ;
"RTN","RORXU006",245,0)
 ; PARENT        IEN of the parent element
"RTN","RORXU006",246,0)
 ;
"RTN","RORXU006",247,0)
ICNDATA(TASK,VALUE,PARENT) ;
"RTN","RORXU006",248,0)
 N TMP
"RTN","RORXU006",249,0)
 S TMP=$$ICN^RORUTL02(VALUE)
"RTN","RORXU006",250,0)
 I TMP'<0 D ADDVAL^RORTSK11(TASK,"ICN",TMP,PARENT,1)
"RTN","RORXU006",251,0)
 Q
"RTN","RORXU006",252,0)
 ;
"RTN","RORXU006",253,0)
PACTDATA(TASK,VALUE,PARENT) ;
"RTN","RORXU006",254,0)
 N TMP
"RTN","RORXU006",255,0)
 S TMP=$$PACT^RORUTL02(VALUE)
"RTN","RORXU006",256,0)
 I TMP'<0 D ADDVAL^RORTSK11(TASK,"PACT",TMP,PARENT,1)
"RTN","RORXU006",257,0)
 Q
"RTN","RORXU006",258,0)
 ;
"RTN","RORXU006",259,0)
PCPDATA(TASK,VALUE,PARENT) ;
"RTN","RORXU006",260,0)
 N TMP
"RTN","RORXU006",261,0)
 S TMP=$$PCP^RORUTL02(VALUE)
"RTN","RORXU006",262,0)
 I TMP'<0 D ADDVAL^RORTSK11(TASK,"PCP",TMP,PARENT,1)
"RTN","RORXU006",263,0)
 Q
"RTN","RORXU006",264,0)
 ;***** OUTPUTS ICN HEADER IF ICN SHOULD BE THE FINAL COLUMN
"RTN","RORXU006",265,0)
 ; TASK          Task number
"RTN","RORXU006",266,0)
 ;
"RTN","RORXU006",267,0)
 ; PARENT        IEN of the parent element
"RTN","RORXU006",268,0)
 ;
"RTN","RORXU006",269,0)
ICNHDR(TASK,PARENT) ;
"RTN","RORXU006",270,0)
 N TMP
"RTN","RORXU006",271,0)
 S TMP=$$ADDVAL^RORTSK11(TASK,"COLUMN",,PARENT)
"RTN","RORXU006",272,0)
 D ADDATTR^RORTSK11(TASK,TMP,"NAME","ICN")
"RTN","RORXU006",273,0)
 Q
"RTN","RORXU006",274,0)
 ;
"RTN","RORXU006",275,0)
PACTHDR(TASK,PARENT) ;
"RTN","RORXU006",276,0)
 N TMP
"RTN","RORXU006",277,0)
 S TMP=$$ADDVAL^RORTSK11(TASK,"COLUMN",,PARENT)
"RTN","RORXU006",278,0)
 D ADDATTR^RORTSK11(TASK,TMP,"NAME","PACT")
"RTN","RORXU006",279,0)
 Q
"RTN","RORXU006",280,0)
 ;
"RTN","RORXU006",281,0)
PCPHDR(TASK,PARENT) ;
"RTN","RORXU006",282,0)
 N TMP
"RTN","RORXU006",283,0)
 S TMP=$$ADDVAL^RORTSK11(TASK,"COLUMN",,PARENT)
"RTN","RORXU006",284,0)
 D ADDATTR^RORTSK11(TASK,TMP,"NAME","PCP")
"RTN","RORXU006",285,0)
 Q
"RTN","RORXU006",286,0)
 ; 
"RTN","RORXU010")
0^23^B25087165^B25087165
"RTN","RORXU010",1,0)
RORXU010 ;HCOIFO/VC - REPORT MODIFICATON UTILITY ;4/16/09 2:54pm
"RTN","RORXU010",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**8,19,25,29,31**;Feb 17, 2006;Build 62
"RTN","RORXU010",3,0)
 ;
"RTN","RORXU010",4,0)
 ;Routine builds the ^TMP($J,"RORFLTR" global array that includes
"RTN","RORXU010",5,0)
 ;ICD information from inpatient, outpatient and problem
"RTN","RORXU010",6,0)
 ;list data for the identified patient.
"RTN","RORXU010",7,0)
 ;
"RTN","RORXU010",8,0)
 ;The ICD information that is stored in the ^TMP($J,"RORFLTR"
"RTN","RORXU010",9,0)
 ;global array is then compared to ICD information stored in 
"RTN","RORXU010",10,0)
 ;the RORTSK local array which is established by the calling
"RTN","RORXU010",11,0)
 ;report routine.
"RTN","RORXU010",12,0)
 ;
"RTN","RORXU010",13,0)
 ;This routine returns a status flag indicating whether the
"RTN","RORXU010",14,0)
 ;patient should being included on the calling report.
"RTN","RORXU010",15,0)
 ;
"RTN","RORXU010",16,0)
 ;Format is:
"RTN","RORXU010",17,0)
 ;   ^TMP($J,"RORFLTR",PATIENT IEN,ICD FILE #,ICD IEN)=1
"RTN","RORXU010",18,0)
 ;   ^TMP($J,"RORFLTR",PATIENT IEN,ICD FILE #,ICD IEN,"DATE",ICD Date)=""
"RTN","RORXU010",19,0)
 ;
"RTN","RORXU010",20,0)
 ;The inputs are:
"RTN","RORXU010",21,0)
 ;   1)  PIEN - Patient's IEN in the registry file (required).
"RTN","RORXU010",22,0)
 ;              Specifically ^RORDATA(798.4,PIEN) and in the 
"RTN","RORXU010",23,0)
 ;              patient file ^DPT(PIEN).
"RTN","RORXU010",24,0)
 ;
"RTN","RORXU010",25,0)
 ;The return code is:
"RTN","RORXU010",26,0)
 ;       RC   - Flag indicating if patient should be retained.
"RTN","RORXU010",27,0)
 ;              1 - Patient should be retained for report.
"RTN","RORXU010",28,0)
 ;              0 - Patient should NOT be retained for report.
"RTN","RORXU010",29,0)
 ;
"RTN","RORXU010",30,0)
 ;ICD information is obtained from 3 different packages:
"RTN","RORXU010",31,0)
 ;   Registration package for patient inpatient diagnosis.
"RTN","RORXU010",32,0)
 ;   Patient Care Encounter package for patient outpatient diagnosis.
"RTN","RORXU010",33,0)
 ;   Problem List package for patient problem list diagnosis.
"RTN","RORXU010",34,0)
 ;   
"RTN","RORXU010",35,0)
 ;This routine uses the following IAs:
"RTN","RORXU010",36,0)
 ;
"RTN","RORXU010",37,0)
 ;#92       ^DGPT(  (controlled)
"RTN","RORXU010",38,0)
 ;#928      ACTIVE^GMPLUTL (controlled)
"RTN","RORXU010",39,0)
 ;#1554     POV^PXAPIIB (controlled)
"RTN","RORXU010",40,0)
 ;#1905     SELECTED^VSIT (controlled)
"RTN","RORXU010",41,0)
 ;#2977     GETFLDS^GMPLEDT3 (controlled)
"RTN","RORXU010",42,0)
 ;#3545     ^DGPT("AAD" (private)
"RTN","RORXU010",43,0)
 ;#6130     PTFICD^DGPTFUT
"RTN","RORXU010",44,0)
 ;
"RTN","RORXU010",45,0)
 ;******************************************************************************
"RTN","RORXU010",46,0)
 ;******************************************************************************
"RTN","RORXU010",47,0)
 ; --- ROUTINE MODIFICATION LOG ---
"RTN","RORXU010",48,0)
 ; 
"RTN","RORXU010",49,0)
 ;PKG/PATCH   DATE       DEVELOPER   MODIFICATION
"RTN","RORXU010",50,0)
 ;----------- ---------- ----------- ----------------------------------------
"RTN","RORXU010",51,0)
 ;ROR*1.5*8   MAR 2010   V CARR      Modified to handle ICD9 filter for
"RTN","RORXU010",52,0)
 ;                                   'include' or 'exclude'.
"RTN","RORXU010",53,0)
 ;ROR*1.5*13  DEC 2010   A SAUNDERS  User can select specific patients, 
"RTN","RORXU010",54,0)
 ;                                   clinics, or divisions for the report.
"RTN","RORXU010",55,0)
 ;ROR*1.5*19  FEB 2012   J SCOTT     Support for ICD-10 Coding System.
"RTN","RORXU010",56,0)
 ;ROR*1.5*19  FEB 2012   J SCOTT     Removed direct read of ^ICD9( global.
"RTN","RORXU010",57,0)
 ;ROR*1.5*19  FEB 2012   J SCOTT     Changed the screening of ICD codes from
"RTN","RORXU010",58,0)
 ;                                   external to internal values.
"RTN","RORXU010",59,0)
 ;ROR*1.5*19  FEB 2012   J SCOTT     Removed obsolete REG parameter from
"RTN","RORXU010",60,0)
 ;                                   ICD entry point.
"RTN","RORXU010",61,0)
 ;ROR*1.5*25  OCT 2014   T KOPP      Added PTF ICD-10 support for 25 diagnoses
"RTN","RORXU010",62,0)
 ;ROR*1.5*29  APR 2016   T KOPP      Add check for selected diagnosis date range
"RTN","RORXU010",63,0)
 ; 
"RTN","RORXU010",64,0)
 ;******************************************************************************
"RTN","RORXU010",65,0)
 ;******************************************************************************
"RTN","RORXU010",66,0)
 Q
"RTN","RORXU010",67,0)
 ;
"RTN","RORXU010",68,0)
ICD(PIEN) ;Determine if patient is retained for report based on ICD information.
"RTN","RORXU010",69,0)
 ;
"RTN","RORXU010",70,0)
 K ^TMP($J,"RORFLTR",PIEN)
"RTN","RORXU010",71,0)
 N PATIEN,RORICDIEN
"RTN","RORXU010",72,0)
 S PATIEN=PIEN
"RTN","RORXU010",73,0)
 ;
"RTN","RORXU010",74,0)
 ;Gather INPATIENT ICD information from Registration package file #45 (PTF).
"RTN","RORXU010",75,0)
 N DATE,DGPTREF,ICD1,ICD2,FLDLOC,RORIBUF,FLD
"RTN","RORXU010",76,0)
 ;
"RTN","RORXU010",77,0)
 ;Browse through each inpatient date.
"RTN","RORXU010",78,0)
 S DATE=0
"RTN","RORXU010",79,0)
 F  S DATE=$O(^DGPT("AAD",PATIEN,DATE)) Q:DATE=""  D
"RTN","RORXU010",80,0)
 .;Browse through each PTF (#45) entry for an inpatient date.
"RTN","RORXU010",81,0)
 .S DGPTREF=0
"RTN","RORXU010",82,0)
 .F  S DGPTREF=$O(^DGPT("AAD",PATIEN,DATE,DGPTREF)) Q:DGPTREF=""  D
"RTN","RORXU010",83,0)
 ..;Extract ICD diagnosis codes.
"RTN","RORXU010",84,0)
 ..D PTFICD^DGPTFUT(701,DGPTREF,"",.RORIBUF)
"RTN","RORXU010",85,0)
 ..S FLD="" F  S FLD=$O(RORIBUF(FLD)) Q:FLD=""  I $G(RORIBUF(FLD)) D
"RTN","RORXU010",86,0)
 ... S ^TMP($J,"RORFLTR",PATIEN,80,+RORIBUF(FLD))=1
"RTN","RORXU010",87,0)
 ... S ^TMP($J,"RORFLTR",PATIEN,80,+RORIBUF(FLD),"DATE",+$P(RORIBUF,U,10))=""
"RTN","RORXU010",88,0)
 ;
"RTN","RORXU010",89,0)
 ;Gather OUTPATIENT ICD information from Patient Care Encounter package.
"RTN","RORXU010",90,0)
 N VSIEN,TMP,RORVPLST,VPOVREF,VSDATE
"RTN","RORXU010",91,0)
 ;
"RTN","RORXU010",92,0)
 ;Get a list of all VISIT (#9000010) entries for the patient.
"RTN","RORXU010",93,0)
 D SELECTED^VSIT(PATIEN)
"RTN","RORXU010",94,0)
 ;Browse through each returned VISIT entry.
"RTN","RORXU010",95,0)
 S VSIEN=0
"RTN","RORXU010",96,0)
 F  S VSIEN=$O(^TMP("VSIT",$J,VSIEN)) Q:VSIEN=""  D
"RTN","RORXU010",97,0)
 .S TMP=+$O(^TMP("VSIT",$J,VSIEN,"")) Q:TMP'>0
"RTN","RORXU010",98,0)
 .S VSDATE=+^TMP("VSIT",$J,VSIEN,TMP)
"RTN","RORXU010",99,0)
 .;Get V POV (#9000010.07) entries for a specific VISIT entry.
"RTN","RORXU010",100,0)
 .D POV^PXAPIIB(VSIEN,.RORVPLST)
"RTN","RORXU010",101,0)
 .;Browse through each returned V POV entry.
"RTN","RORXU010",102,0)
 .S VPOVREF=""
"RTN","RORXU010",103,0)
 .F  S VPOVREF=$O(RORVPLST(VPOVREF)) Q:VPOVREF=""  D
"RTN","RORXU010",104,0)
 ..;Extract ICD diagnosis code.
"RTN","RORXU010",105,0)
 ..S RORICDIEN=$P(RORVPLST(VPOVREF),U,1)
"RTN","RORXU010",106,0)
 ..I RORICDIEN'="" D
"RTN","RORXU010",107,0)
 ...S ^TMP($J,"RORFLTR",PATIEN,80,RORICDIEN)=1
"RTN","RORXU010",108,0)
 ...S ^TMP($J,"RORFLTR",PATIEN,80,RORICDIEN,"DATE",VSDATE)=""
"RTN","RORXU010",109,0)
 K ^TMP("VSIT",$J)
"RTN","RORXU010",110,0)
 ;
"RTN","RORXU010",111,0)
 ;Gather PROBLEM LIST ICD information from Problem List package.
"RTN","RORXU010",112,0)
 N RORPLST,PLSTREF,GMPVAMC,GMPROV,PROBNUM
"RTN","RORXU010",113,0)
 ;
"RTN","RORXU010",114,0)
 ;Get a list of all PROBLEM (#9000011) entries for the patient.
"RTN","RORXU010",115,0)
 D ACTIVE^GMPLUTL(PATIEN,.RORPLST)
"RTN","RORXU010",116,0)
 S (GMPVAMC,GMPROV)=0
"RTN","RORXU010",117,0)
 ;Browse through each returned PROBLEM entry.
"RTN","RORXU010",118,0)
 S PROBNUM=0
"RTN","RORXU010",119,0)
 F  S PROBNUM=$O(RORPLST(PROBNUM)) Q:PROBNUM=""  D
"RTN","RORXU010",120,0)
 .S PLSTREF=$G(RORPLST(PROBNUM,0))
"RTN","RORXU010",121,0)
 .Q:PLSTREF'>0
"RTN","RORXU010",122,0)
 .;Extract ICD diagnosis code.
"RTN","RORXU010",123,0)
 .K GMPFLD,GMPORIG
"RTN","RORXU010",124,0)
 .D GETFLDS^GMPLEDT3(PLSTREF)
"RTN","RORXU010",125,0)
 .S RORICDIEN=$P($G(GMPFLD(.01)),U,1)
"RTN","RORXU010",126,0)
 .I RORICDIEN'="" D
"RTN","RORXU010",127,0)
 ..S ^TMP($J,"RORFLTR",PATIEN,80,RORICDIEN)=1
"RTN","RORXU010",128,0)
 ..S ^TMP($J,"RORFLTR",PATIEN,80,RORICDIEN,"DATE",+$G(GMPFLD(.08)))=""
"RTN","RORXU010",129,0)
 .K GMPFLD,GMPORIG
"RTN","RORXU010",130,0)
 ;
"RTN","RORXU010",131,0)
COMPARE ;Determine if patient should be retained or not.
"RTN","RORXU010",132,0)
 ;
"RTN","RORXU010",133,0)
 ;Compare ICD data gathered for patient in ^TMP($J,"RORFLTR"
"RTN","RORXU010",134,0)
 ;with ICD data in RORTSK local array that was established from
"RTN","RORXU010",135,0)
 ;the calling routine.
"RTN","RORXU010",136,0)
 ;
"RTN","RORXU010",137,0)
 N A,B,C,DTOK,STOP,X,Y,Y1,RC
"RTN","RORXU010",138,0)
 S A="PARAMS",B="ICDFILT",C="DATE_RANGE_5",RC=0
"RTN","RORXU010",139,0)
 S X="",STOP="GO"
"RTN","RORXU010",140,0)
 F  S X=$O(RORTSK(A,B,"G",X)) Q:X=""  Q:STOP="STOP"  D
"RTN","RORXU010",141,0)
 .S Y=""
"RTN","RORXU010",142,0)
 .F  S Y=$O(RORTSK(A,B,"G",X,"C",Y)) Q:Y=""  Q:STOP="STOP"  D
"RTN","RORXU010",143,0)
 ..I $D(^TMP($J,"RORFLTR",PATIEN,80,Y))>0 D
"RTN","RORXU010",144,0)
 ...S DTOK=0
"RTN","RORXU010",145,0)
 ...I $G(RORTSK(A,C,"A","START"))>0 D  Q:'DTOK          ;Check if diagnosis is within date range
"RTN","RORXU010",146,0)
 ....S Y1=$G(RORTSK(A,C,"A","START"))-.1   ; Start looking just before earliest start date
"RTN","RORXU010",147,0)
 ....S Y1=$O(^TMP($J,"RORFLTR",PATIEN,80,Y,"DATE",Y1))  ;First diagnosis date after start date                                                                             ; This date must exist and be <= range end date
"RTN","RORXU010",148,0)
 ....I 'Y1!(Y1>$G(RORTSK(A,C,"A","END")))  Q        ; Diagnosis is not within the date range - keep looking
"RTN","RORXU010",149,0)
 ....S DTOK=1
"RTN","RORXU010",150,0)
 ...S RC=1,STOP="STOP"
"RTN","RORXU010",151,0)
 K ^TMP($J,"RORFLTR",PATIEN)
"RTN","RORXU010",152,0)
 Q RC
"VER")
8.0^22.2
"^DD",798.1,798.1,0)
FIELD^^31^36
"^DD",798.1,798.1,0,"DDA")
N
"^DD",798.1,798.1,0,"DT")
3120301
"^DD",798.1,798.1,0,"ID","WRITE")
D EN^DDIOL("  "_$P($G(^(0)),U,4),,"?30")
"^DD",798.1,798.1,0,"IX","ACL",798.118,.01)

"^DD",798.1,798.1,0,"IX","AEP",798.1,25)

"^DD",798.1,798.1,0,"IX","ARULES",798.13,.01)

"^DD",798.1,798.1,0,"IX","C",798.1,31)

"^DD",798.1,798.1,0,"NM","ROR REGISTRY PARAMETERS")
 
"^DD",798.1,798.1,0,"PT",798,.02)
 
"^DD",798.1,798.1,0,"PT",798.31,.01)
 
"^DD",798.1,798.1,0,"PT",798.5,.01)

"^DD",798.1,798.1,0,"PT",798.6,.02)
 
"^DD",798.1,798.1,0,"PT",798.73,.01)
 
"^DD",798.1,798.1,0,"PT",798.8,.03)
 
"^DD",798.1,798.1,0,"PT",799.1,.03)
 
"^DD",798.1,798.1,0,"PT",799.51,.02)
 
"^DD",798.1,798.1,0,"PT",799.53,.03)
 
"^DD",798.1,798.1,0,"SCR")
I $$ACCESS^RORDD(798.1,Y)
"^DD",798.1,798.1,0,"VRPK")
ROR
"^DD",798.1,798.1,0,"VRRV")
1.5^ROR 1.5
"^DD",798.1,798.1,.01,0)
REGISTRY NAME^RFX^^0;1^Q:$$VAEDT^RORDD(798.1,$G(DA))  K:$L(X)>30!($L(X)<3)!'(X?1.UNP) X
"^DD",798.1,798.1,.01,1,0)
^.1^^0
"^DD",798.1,798.1,.01,3)
Enter the unique registry name (3-30 characters).
"^DD",798.1,798.1,.01,8.5)
@
"^DD",798.1,798.1,.01,9)
@
"^DD",798.1,798.1,.01,20,0)
^.3LA^1^1
"^DD",798.1,798.1,.01,20,1,0)
DEFINITION
"^DD",798.1,798.1,.01,21,0)
^.001^9^9^3060203^^
"^DD",798.1,798.1,.01,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A
"^DD",798.1,798.1,.01,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",798.1,798.1,.01,21,3,0)
 
"^DD",798.1,798.1,.01,21,4,0)
You can either select an existing registry or add 
"^DD",798.1,798.1,.01,21,5,0)
a new one. Registry names must be unique. Names of
"^DD",798.1,798.1,.01,21,6,0)
the National registries must start with "VA".
"^DD",798.1,798.1,.01,21,7,0)
 
"^DD",798.1,798.1,.01,21,8,0)
You can only select records of those registries
"^DD",798.1,798.1,.01,21,9,0)
that you have appropriate security key(s) for.
"^DD",798.1,798.1,.01,"DEL",1,0)
I $$VADEL^RORDD(798.1,$G(DA))
"^DD",798.1,798.1,.01,"DT")
3060203
"^DD",798.1,798.1,.09,0)
NATIONAL^SX^0:NO;1:YES;^0;11^Q:$$VAEDT^RORDD(798.1,,-1)
"^DD",798.1,798.1,.09,8.5)
@
"^DD",798.1,798.1,.09,9)
@
"^DD",798.1,798.1,.09,20,0)
^.3LA^1^1
"^DD",798.1,798.1,.09,20,1,0)
DEFINITION
"^DD",798.1,798.1,.09,21,0)
^^6^6^3060203^
"^DD",798.1,798.1,.09,21,1,0)
ONLY AUTHORIZED NATIONAL REGISTRY DEVELOPERS CAN
"^DD",798.1,798.1,.09,21,2,0)
EDIT THIS FIELD!
"^DD",798.1,798.1,.09,21,3,0)
 
"^DD",798.1,798.1,.09,21,4,0)
The national registries must have this field set
"^DD",798.1,798.1,.09,21,5,0)
to "YES". This prevents local editing of other 
"^DD",798.1,798.1,.09,21,6,0)
fields of national registry definitions.
"^DD",798.1,798.1,.09,"DEL",1,0)
I $$VADEL^RORDD(798.1,,-1)
"^DD",798.1,798.1,.09,"DT")
3011120
"^DD",798.1,798.1,1,0)
REGISTRY UPDATED UNTIL^D^^0;2^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",798.1,798.1,1,20,0)
^.3LA^1^1
"^DD",798.1,798.1,1,20,1,0)
STATE
"^DD",798.1,798.1,1,21,0)
^^9^9^3060203^
"^DD",798.1,798.1,1,21,1,0)
This field indicates the date of the last 
"^DD",798.1,798.1,1,21,2,0)
successful run of the regular registry update
"^DD",798.1,798.1,1,21,3,0)
process. The search engine looks for new patients
"^DD",798.1,798.1,1,21,4,0)
starting from this date.
"^DD",798.1,798.1,1,21,5,0)
 
"^DD",798.1,798.1,1,21,6,0)
Usually, this field should not be manually edited;
"^DD",798.1,798.1,1,21,7,0)
it is updated automatically. Before initial
"^DD",798.1,798.1,1,21,8,0)
population of the registry, enter the date that the
"^DD",798.1,798.1,1,21,9,0)
data search should start from.
"^DD",798.1,798.1,1,23,0)
^.001^3^3^3060203^^^
"^DD",798.1,798.1,1,23,1,0)
This field is updated automatically by the registry 
"^DD",798.1,798.1,1,23,2,0)
update process after successful completion (see the 
"^DD",798.1,798.1,1,23,3,0)
$$TMSTMP^RORUPD01 function for details).
"^DD",798.1,798.1,1,"DT")
3010928
"^DD",798.1,798.1,2,0)
DATA EXTRACTED UNTIL^D^^0;3^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",798.1,798.1,2,20,0)
^.3LA^1^1
"^DD",798.1,798.1,2,20,1,0)
STATE
"^DD",798.1,798.1,2,21,0)
^.001^3^3^3020816^^
"^DD",798.1,798.1,2,21,1,0)
This field indicates the date of the last 
"^DD",798.1,798.1,2,21,2,0)
successful run of the regular data extraction
"^DD",798.1,798.1,2,21,3,0)
process. Do not edit this field.
"^DD",798.1,798.1,2,23,0)
^.001^3^3^3020816^^
"^DD",798.1,798.1,2,23,1,0)
This field is updated automatically by the regular data
"^DD",798.1,798.1,2,23,2,0)
extraction process after its successful completion (see
"^DD",798.1,798.1,2,23,3,0)
the $$TMSTMP^ROREXTUT function for details).
"^DD",798.1,798.1,2,"DT")
3010928
"^DD",798.1,798.1,3,0)
SELECTION RULE^798.13^^1;0
"^DD",798.1,798.1,3,9)
@
"^DD",798.1,798.1,3,20,0)
^.3LA^1^1
"^DD",798.1,798.1,3,20,1,0)
DEFINITION
"^DD",798.1,798.1,3,21,0)
^.001^8^8^3140228^^^^
"^DD",798.1,798.1,3,21,1,0)
The SELECTION RULE field contains a list of the 
"^DD",798.1,798.1,3,21,2,0)
top-level selection rules that are used to screen
"^DD",798.1,798.1,3,21,3,0)
the patients to be added to the registry.
"^DD",798.1,798.1,3,21,4,0)
 
"^DD",798.1,798.1,3,21,5,0)
The records of the multiple are uniquely 
"^DD",798.1,798.1,3,21,6,0)
identified by the selection rule names. The "A"
"^DD",798.1,798.1,3,21,7,0)
primary key and the uniqueness index "B" are used
"^DD",798.1,798.1,3,21,8,0)
for this purpose.
"^DD",798.1,798.1,4,0)
SHORT DESCRIPTION^RFX^^0;4^Q:$$VAEDT^RORDD(798.1,$G(DA))  K:$L(X)>40!($L(X)<3) X
"^DD",798.1,798.1,4,3)
Enter a short description of the registry (3-40 characters).
"^DD",798.1,798.1,4,8.5)
@
"^DD",798.1,798.1,4,9)
@
"^DD",798.1,798.1,4,21,0)
^.001^2^2^3020403^^
"^DD",798.1,798.1,4,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A
"^DD",798.1,798.1,4,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",798.1,798.1,4,"DT")
3011109
"^DD",798.1,798.1,5,0)
DESCRIPTION^798.15^^2;0
"^DD",798.1,798.1,5,21,0)
^.001^2^2^3011009^^^
"^DD",798.1,798.1,5,21,1,0)
Any additional reference information related to
"^DD",798.1,798.1,5,21,2,0)
the registry may be stored in this field.
"^DD",798.1,798.1,5,23,0)
^.001^1^1^3011009^^
"^DD",798.1,798.1,5,23,1,0)
Content of this field is not used by the application.
"^DD",798.1,798.1,6.1,0)
BEFORE UPDATE^FX^^4;E1,245^Q:$$VAEDT^RORDD(798.1,$G(DA))  Q:$$EP^RORDD(3)
"^DD",798.1,798.1,6.1,3)
Answer must be $$TAG^ROUTINE (5-19 characters in length).
"^DD",798.1,798.1,6.1,8.5)
@
"^DD",798.1,798.1,6.1,9)
@
"^DD",798.1,798.1,6.1,20,0)
^.3LA^1^1
"^DD",798.1,798.1,6.1,20,1,0)
DEFINITION
"^DD",798.1,798.1,6.1,21,0)
^.001^7^7^3050427^^^^
"^DD",798.1,798.1,6.1,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A
"^DD",798.1,798.1,6.1,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",798.1,798.1,6.1,21,3,0)
 
"^DD",798.1,798.1,6.1,21,4,0)
Enter a full name ($$TAG^ROUTINE) of the external
"^DD",798.1,798.1,6.1,21,5,0)
MUMPS function that will be called before adding a
"^DD",798.1,798.1,6.1,21,6,0)
new record to the registry. This entry point can
"^DD",798.1,798.1,6.1,21,7,0)
be used to prepare any additional data.
"^DD",798.1,798.1,6.1,23,0)
^^20^20^3050427^
"^DD",798.1,798.1,6.1,23,1,0)
The call-back entry point must accept three parameters:
"^DD",798.1,798.1,6.1,23,2,0)
 
"^DD",798.1,798.1,6.1,23,3,0)
FDA - A reference to a local array that contains 
"^DD",798.1,798.1,6.1,23,4,0)
prepared data (for the UPDATE^DIE FileMan DSB call)
"^DD",798.1,798.1,6.1,23,5,0)
that should be stored as a new record in the ROR
"^DD",798.1,798.1,6.1,23,6,0)
REGISTRY RECORD (#798) file.
"^DD",798.1,798.1,6.1,23,7,0)
 
"^DD",798.1,798.1,6.1,23,8,0)
The main record uses "+1," placeholder and records of
"^DD",798.1,798.1,6.1,23,9,0)
the SELECTION RULE multiple use placeholders with
"^DD",798.1,798.1,6.1,23,10,0)
numbers starting from 1001.
"^DD",798.1,798.1,6.1,23,11,0)
 
"^DD",798.1,798.1,6.1,23,12,0)
See the source code of the $$ADD^RORUPD50 function and
"^DD",798.1,798.1,6.1,23,13,0)
the FileMan Programmer Manual for further details.
"^DD",798.1,798.1,6.1,23,14,0)
 
"^DD",798.1,798.1,6.1,23,15,0)
PATIEN - Patient IEN (in the file #2)
"^DD",798.1,798.1,6.1,23,16,0)
 
"^DD",798.1,798.1,6.1,23,17,0)
REGIEN - Registry IEN (in the file #798.1)
"^DD",798.1,798.1,6.1,23,18,0)
 
"^DD",798.1,798.1,6.1,23,19,0)
The function should return a negative number in case of
"^DD",798.1,798.1,6.1,23,20,0)
errors. Otherwise, zero should be returned.
"^DD",798.1,798.1,6.1,"DEL",1,0)
I $$VADEL^RORDD(798.1,$G(DA))
"^DD",798.1,798.1,6.1,"DT")
3011120
"^DD",798.1,798.1,6.2,0)
AFTER UPDATE^FX^^5;E1,245^Q:$$VAEDT^RORDD(798.1,$G(DA))  Q:$$EP^RORDD(3)
"^DD",798.1,798.1,6.2,3)
Answer must be $$TAG^ROUTINE (5-19 characters in length).
"^DD",798.1,798.1,6.2,8.5)
@
"^DD",798.1,798.1,6.2,9)
@
"^DD",798.1,798.1,6.2,20,0)
^.3LA^1^1
"^DD",798.1,798.1,6.2,20,1,0)
DEFINITION
"^DD",798.1,798.1,6.2,21,0)
^.001^8^8^3020816^^
"^DD",798.1,798.1,6.2,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A
"^DD",798.1,798.1,6.2,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",798.1,798.1,6.2,21,3,0)
 
"^DD",798.1,798.1,6.2,21,4,0)
Enter a full name ($$TAG^ROUTINE) of the external
"^DD",798.1,798.1,6.2,21,5,0)
MUMPS function that will be called after adding a
"^DD",798.1,798.1,6.2,21,6,0)
new record to the registry. This entry point can
"^DD",798.1,798.1,6.2,21,7,0)
be used to create record(s) in additional linked
"^DD",798.1,798.1,6.2,21,8,0)
file(s) of the local registry.
"^DD",798.1,798.1,6.2,23,0)
^^11^11^3050427^
"^DD",798.1,798.1,6.2,23,1,0)
The call-back function must accept three parameters:
"^DD",798.1,798.1,6.2,23,2,0)
 
"^DD",798.1,798.1,6.2,23,3,0)
IEN - An IEN of the newly added record of the ROR
"^DD",798.1,798.1,6.2,23,4,0)
REGISTRY RECORD file
"^DD",798.1,798.1,6.2,23,5,0)
 
"^DD",798.1,798.1,6.2,23,6,0)
PATIEN - Patient IEN (in file #2)
"^DD",798.1,798.1,6.2,23,7,0)
 
"^DD",798.1,798.1,6.2,23,8,0)
REGIEN - Registry IEN (in file #798.1)
"^DD",798.1,798.1,6.2,23,9,0)
 
"^DD",798.1,798.1,6.2,23,10,0)
The function should return a negative number in case of
"^DD",798.1,798.1,6.2,23,11,0)
errors. Otherwise, zero should be returned.
"^DD",798.1,798.1,6.2,"DEL",1,0)
I $$VADEL^RORDD(798.1,$G(DA))
"^DD",798.1,798.1,6.2,"DT")
3011120
"^DD",798.1,798.1,7,0)
EXTRACT PERIOD FOR NEW PATIENT^NJ5,0X^^0;5^Q:$$VAEDT^RORDD(798.1,$G(DA))  K:+X'=X!(X>15000)!(X<1)!(X?.E1"."1N.N) X
"^DD",798.1,798.1,7,3)
Enter number of days between 1 and 15000.
"^DD",798.1,798.1,7,8.5)
@
"^DD",798.1,798.1,7,9)
@
"^DD",798.1,798.1,7,20,0)
^.3LA^1^1
"^DD",798.1,798.1,7,20,1,0)
DEFINITION
"^DD",798.1,798.1,7,21,0)
^.001^11^11^3030717^^^
"^DD",798.1,798.1,7,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A
"^DD",798.1,798.1,7,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",798.1,798.1,7,21,3,0)
 
"^DD",798.1,798.1,7,21,4,0)
Enter the number of days that should be subtracted
"^DD",798.1,798.1,7,21,5,0)
from the earliest date when the patient passed one
"^DD",798.1,798.1,7,21,6,0)
of the selection rules. The result will be used as
"^DD",798.1,798.1,7,21,7,0)
the start date of the data extraction for this new
"^DD",798.1,798.1,7,21,8,0)
patient.
"^DD",798.1,798.1,7,21,9,0)
 
"^DD",798.1,798.1,7,21,10,0)
If this field is empty, the default value of 3650
"^DD",798.1,798.1,7,21,11,0)
is used.
"^DD",798.1,798.1,7,"DEL",1,0)
I $$VADEL^RORDD(798.1,$G(DA))
"^DD",798.1,798.1,7,"DT")
3011109
"^DD",798.1,798.1,7,"V",0)
^.12P
"^DD",798.1,798.1,8,0)
ENABLE LOG^S^0:NO;1:YES;^0;6^Q
"^DD",798.1,798.1,8,20,0)
^.3LA^1^1
"^DD",798.1,798.1,8,20,1,0)
PARAMETERS
"^DD",798.1,798.1,8,21,0)
^^3^3^3060203^
"^DD",798.1,798.1,8,21,1,0)
Select "YES" to enable recording of different 
"^DD",798.1,798.1,8,21,2,0)
kinds of events (debug messages, errors, etc.)
"^DD",798.1,798.1,8,21,3,0)
generated by registry processes.
"^DD",798.1,798.1,8,23,0)
^.001^10^10^3060203^^
"^DD",798.1,798.1,8,23,1,0)
The ENABLE LOG field controls recording of the errors
"^DD",798.1,798.1,8,23,2,0)
and other events in the log file.
"^DD",798.1,798.1,8,23,3,0)
 
"^DD",798.1,798.1,8,23,4,0)
If internal value of the field is 0 or the field is 
"^DD",798.1,798.1,8,23,5,0)
empty, the recording of all events associated with the
"^DD",798.1,798.1,8,23,6,0)
registry is disabled.
"^DD",798.1,798.1,8,23,7,0)
 
"^DD",798.1,798.1,8,23,8,0)
If internal value of the field is 1, content of the
"^DD",798.1,798.1,8,23,9,0)
LOG EVENT multiple is analyzed to determine which
"^DD",798.1,798.1,8,23,10,0)
events (errors, warnings, etc.) should be recorded.
"^DD",798.1,798.1,8,"DT")
3000503
"^DD",798.1,798.1,8.1,0)
LOG EVENT^798.11S^^3;0
"^DD",798.1,798.1,8.1,20,0)
^.3LA^^0
"^DD",798.1,798.1,8.1,21,0)
^.001^8^8^3060203^^
"^DD",798.1,798.1,8.1,21,1,0)
The LOG EVENT multiple contain a list of event 
"^DD",798.1,798.1,8.1,21,2,0)
types that are enabled to record. 
"^DD",798.1,798.1,8.1,21,3,0)
 
"^DD",798.1,798.1,8.1,21,4,0)
If the list is empty and recording is enabled, 
"^DD",798.1,798.1,8.1,21,5,0)
all events except debug messages will be recorded.
"^DD",798.1,798.1,8.1,21,6,0)
 
"^DD",798.1,798.1,8.1,21,7,0)
Otherwise, only recording of the events from the
"^DD",798.1,798.1,8.1,21,8,0)
list and error messages will be enabled.
"^DD",798.1,798.1,8.1,"DT")
3050722
"^DD",798.1,798.1,10,0)
MESSAGE BUILDER^FX^^7;E1,245^Q:$$VAEDT^RORDD(798.1,$G(DA))  Q:$$EP^RORDD(4)
"^DD",798.1,798.1,10,3)
Answer must be $$TAG^ROUTINE (5-19 characters in length).
"^DD",798.1,798.1,10,8.5)
@
"^DD",798.1,798.1,10,9)
@
"^DD",798.1,798.1,10,20,0)
^.3LA^1^1
"^DD",798.1,798.1,10,20,1,0)
DEFINITION
"^DD",798.1,798.1,10,21,0)
^^10^10^3060106^
"^DD",798.1,798.1,10,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A
"^DD",798.1,798.1,10,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",798.1,798.1,10,21,3,0)
 
"^DD",798.1,798.1,10,21,4,0)
Enter a full name ($$TAG^ROUTINE) of the external 
"^DD",798.1,798.1,10,21,5,0)
MUMPS function that will be called to generate the
"^DD",798.1,798.1,10,21,6,0)
registry-specific section of the HL7 message for
"^DD",798.1,798.1,10,21,7,0)
each record of the registry.
"^DD",798.1,798.1,10,21,8,0)
 
"^DD",798.1,798.1,10,21,9,0)
If this field has no value, the default entry 
"^DD",798.1,798.1,10,21,10,0)
point ($$REGDATA^ROREXT02) will be used.
"^DD",798.1,798.1,10,23,0)
^^28^28^3060106^
"^DD",798.1,798.1,10,23,1,0)
The call-back function must accept four parameters:
"^DD",798.1,798.1,10,23,2,0)
 
"^DD",798.1,798.1,10,23,3,0)
IEN - IEN of the registry record
"^DD",798.1,798.1,10,23,4,0)
 
"^DD",798.1,798.1,10,23,5,0)
PATIEN - Patient IEN (in the file #2)
"^DD",798.1,798.1,10,23,6,0)
 
"^DD",798.1,798.1,10,23,7,0)
[.]DXDTS - Either a single time frame in 
"^DD",798.1,798.1,10,23,8,0)
StartDate^EndDate format or a reference to a local 
"^DD",798.1,798.1,10,23,9,0)
variable containing the list of data extraction time 
"^DD",798.1,798.1,10,23,10,0)
frames. The main time frame should be stored in the
"^DD",798.1,798.1,10,23,11,0)
root node (see the $$DXPERIOD^ROREXTUT function for 
"^DD",798.1,798.1,10,23,12,0)
details):
"^DD",798.1,798.1,10,23,13,0)
 
"^DD",798.1,798.1,10,23,14,0)
  DXDTS(         StartDate^EndDate  (FileMan)
"^DD",798.1,798.1,10,23,15,0)
    DataArea,
"^DD",798.1,798.1,10,23,16,0)
      i)         StartDate^EndDate  (FileMan)
"^DD",798.1,798.1,10,23,17,0)
 
"^DD",798.1,798.1,10,23,18,0)
The function should add the text of the HL7 message 
"^DD",798.1,798.1,10,23,19,0)
after already existing nodes in the standard location:
"^DD",798.1,798.1,10,23,20,0)
^TMP("HLS",$J). DO NOT KILL THIS NODE! It contains the
"^DD",798.1,798.1,10,23,21,0)
previous messages of the batch.
"^DD",798.1,798.1,10,23,22,0)
 
"^DD",798.1,798.1,10,23,23,0)
If the message was generated successfully, the function
"^DD",798.1,798.1,10,23,24,0)
should return zero. A negative value corresponds to the
"^DD",798.1,798.1,10,23,25,0)
error code.
"^DD",798.1,798.1,10,23,26,0)
                                                                    
"^DD",798.1,798.1,10,23,27,0)
See the source code of the $$REGDATA^ROREXT02 function 
"^DD",798.1,798.1,10,23,28,0)
for further details.
"^DD",798.1,798.1,10,"DEL",1,0)
I $$VADEL^RORDD(798.1,$G(DA))
"^DD",798.1,798.1,10,"DT")
3011120
"^DD",798.1,798.1,11,0)
REGISTRY STATUS^S^0:ACTIVE;1:INACTIVE;^0;7^Q
"^DD",798.1,798.1,11,1,0)
^.1^^0
"^DD",798.1,798.1,11,20,0)
^.3LA^1^1
"^DD",798.1,798.1,11,20,1,0)
PARAMETERS
"^DD",798.1,798.1,11,21,0)
^.001^3^3^3020816^^
"^DD",798.1,798.1,11,21,1,0)
Select the "INACTIVE" code if you want to exclude
"^DD",798.1,798.1,11,21,2,0)
the registry from the regular registry updates and
"^DD",798.1,798.1,11,21,3,0)
data transmissions.
"^DD",798.1,798.1,11,"DT")
3020424
"^DD",798.1,798.1,12,0)
EXTRACTED RESULT^798.112I^^8;0
"^DD",798.1,798.1,12,9)
@
"^DD",798.1,798.1,12,20,0)
^.3LA^1^1
"^DD",798.1,798.1,12,20,1,0)
DEFINITION
"^DD",798.1,798.1,12,21,0)
^.001^3^3^3020816^^
"^DD",798.1,798.1,12,21,1,0)
This multiple contains a list of Lab result codes.
"^DD",798.1,798.1,12,21,2,0)
These results will be extracted and transmitted to
"^DD",798.1,798.1,12,21,3,0)
AAC.
"^DD",798.1,798.1,12,"DT")
3010629
"^DD",798.1,798.1,13,0)
PROTOCOL^*P101'X^ORD(101,^9;1^Q:$$VAEDT^RORDD(798.1,$G(DA))  S DIC("S")="S D=$G(^(0)) I $E($P(D,U),1,3)=""ROR"",$P(D,U,4)=""E""" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",798.1,798.1,13,3)
 
"^DD",798.1,798.1,13,8.5)
@
"^DD",798.1,798.1,13,9)
@
"^DD",798.1,798.1,13,12)
Only Event Drivers from the "ROR" namespace can be selected!
"^DD",798.1,798.1,13,12.1)
S DIC("S")="S D=$G(^(0)) I $E($P(D,U),1,3)=""ROR"",$P(D,U,4)=""E"""
"^DD",798.1,798.1,13,20,0)
^.3LA^2^2
"^DD",798.1,798.1,13,20,1,0)
HL7
"^DD",798.1,798.1,13,20,2,0)
DEFINITION
"^DD",798.1,798.1,13,21,0)
^.001^6^6^3120501^^^^
"^DD",798.1,798.1,13,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS A PART OF
"^DD",798.1,798.1,13,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",798.1,798.1,13,21,3,0)
 
"^DD",798.1,798.1,13,21,4,0)
This field contains a pointer to the protocol in 
"^DD",798.1,798.1,13,21,5,0)
the PROTOCOL file that is used as the event driver
"^DD",798.1,798.1,13,21,6,0)
for sending HL7 messages.
"^DD",798.1,798.1,13,23,0)
^^5^5^3120501^
"^DD",798.1,798.1,13,23,1,0)
If several registries are processed by the same nightly
"^DD",798.1,798.1,13,23,2,0)
task and they have different values of the PROTOCOL
"^DD",798.1,798.1,13,23,3,0)
field, then the registries are grouped by the value of
"^DD",798.1,798.1,13,23,4,0)
this field and data extraction is performed separately
"^DD",798.1,798.1,13,23,5,0)
for each of those groups.
"^DD",798.1,798.1,13,"DEL",1,0)
I $$VADEL^RORDD(798.1,$G(DA))
"^DD",798.1,798.1,13,"DT")
3011112
"^DD",798.1,798.1,13.1,0)
MAXIMUM MESSAGE SIZE^NJ4,1^^9;2^K:+X'=X!(X>99)!(X<0)!(X?.E1"."2N.N) X
"^DD",798.1,798.1,13.1,3)
Enter maximum size (in megabytes) between 0 and 99, 1 decimal digit.
"^DD",798.1,798.1,13.1,8.5)
@
"^DD",798.1,798.1,13.1,9)
@
"^DD",798.1,798.1,13.1,20,0)
^.3LA^2^2
"^DD",798.1,798.1,13.1,20,1,0)
HL7
"^DD",798.1,798.1,13.1,20,2,0)
PARAMETERS
"^DD",798.1,798.1,13.1,21,0)
^.001^8^8^3060203^^
"^DD",798.1,798.1,13.1,21,1,0)
This field stores the maximum size (in megabytes)
"^DD",798.1,798.1,13.1,21,2,0)
of a batch HL7 message that can be sent to Austin
"^DD",798.1,798.1,13.1,21,3,0)
Automation Center (AAC). If this field is empty or
"^DD",798.1,798.1,13.1,21,4,0)
contains 0, the size is not limited.
"^DD",798.1,798.1,13.1,21,5,0)
 
"^DD",798.1,798.1,13.1,21,6,0)
You must coordinate your intentions with AAC
"^DD",798.1,798.1,13.1,21,7,0)
support personnel if you are going to edit this
"^DD",798.1,798.1,13.1,21,8,0)
field.
"^DD",798.1,798.1,13.1,23,0)
^^8^8^3060203^
"^DD",798.1,798.1,13.1,23,1,0)
Actual size of an HL7 batch can be greater than the
"^DD",798.1,798.1,13.1,23,2,0)
value of this field because the software does not break
"^DD",798.1,798.1,13.1,23,3,0)
in the middle of an individual HL7 message.
"^DD",798.1,798.1,13.1,23,4,0)
 
"^DD",798.1,798.1,13.1,23,5,0)
For example, if the maximum size is 10Mb, the current
"^DD",798.1,798.1,13.1,23,6,0)
size is 9Mb and 3Mb should be sent for the patient
"^DD",798.1,798.1,13.1,23,7,0)
being processed, then the actual size of the batch will
"^DD",798.1,798.1,13.1,23,8,0)
be 12Mb.
"^DD",798.1,798.1,13.1,"DT")
3020730
"^DD",798.1,798.1,13.2,0)
ALERT FREQUENCY^NJ2,0^^9;3^K:+X'=X!(X>10)!(X<1)!(X?.E1"."1N.N) X
"^DD",798.1,798.1,13.2,3)
Type a Number between 1 and 10, 0 Decimal Digits
"^DD",798.1,798.1,13.2,8.5)
@
"^DD",798.1,798.1,13.2,9)
@
"^DD",798.1,798.1,13.2,11,0)
^.2LAP^^0
"^DD",798.1,798.1,13.2,20,0)
^.3LA^2^2
"^DD",798.1,798.1,13.2,20,1,0)
HL7
"^DD",798.1,798.1,13.2,20,2,0)
PARAMETERS
"^DD",798.1,798.1,13.2,21,0)
^.001^20^20^3060203^^
"^DD",798.1,798.1,13.2,21,1,0)
Value of the ALERT FREQUENCY field determines how
"^DD",798.1,798.1,13.2,21,2,0)
often e-mail notifications and VistA alerts are 
"^DD",798.1,798.1,13.2,21,3,0)
sent to the AAC and local staff in case of
"^DD",798.1,798.1,13.2,21,4,0)
problems with the site's CCR software (data
"^DD",798.1,798.1,13.2,21,5,0)
extraction problems, unsent HL7 messages, etc.).
"^DD",798.1,798.1,13.2,21,6,0)
 
"^DD",798.1,798.1,13.2,21,7,0)
If this field is empty or 0, notifications are
"^DD",798.1,798.1,13.2,21,8,0)
not sent.
"^DD",798.1,798.1,13.2,21,9,0)
 
"^DD",798.1,798.1,13.2,21,10,0)
Otherwise, the nightly task increments the error
"^DD",798.1,798.1,13.2,21,11,0)
counters and checks the remainders from division
"^DD",798.1,798.1,13.2,21,12,0)
of the counters by the value of this field. When a
"^DD",798.1,798.1,13.2,21,13,0)
reminder becomes 0, the software sends the
"^DD",798.1,798.1,13.2,21,14,0)
corresponding e-mail notification to the AAC and
"^DD",798.1,798.1,13.2,21,15,0)
generates the VistA alert to the local staff
"^DD",798.1,798.1,13.2,21,16,0)
listed in the NOTIFICATION multiple (14).
"^DD",798.1,798.1,13.2,21,17,0)
 
"^DD",798.1,798.1,13.2,21,18,0)
For example, if the nightly task runs every night 
"^DD",798.1,798.1,13.2,21,19,0)
and the ALERT FREQUENCY is 2, then alerts and 
"^DD",798.1,798.1,13.2,21,20,0)
notifications will be sent every other night.
"^DD",798.1,798.1,13.2,23,0)
^.001^3^3^3060203^^^
"^DD",798.1,798.1,13.2,23,1,0)
See description of the HL7 PROBLEM COUNTER field (19.3)
"^DD",798.1,798.1,13.2,23,2,0)
and source code of the $$CHECKMSG^ROR10 function for
"^DD",798.1,798.1,13.2,23,3,0)
more details.
"^DD",798.1,798.1,13.2,"DT")
3050503
"^DD",798.1,798.1,13.3,0)
NATIONAL NOTIFICATION E-MAIL^FX^^9;4^Q:$$VAEDT^RORDD(798.1,$G(DA))  K:$L(X)>50!($L(X)<3)!(X'?1.ANP1"@"1.ANP) X
"^DD",798.1,798.1,13.3,3)
Answer must be a valid e-mail address (3-50 characters in length).
"^DD",798.1,798.1,13.3,8.5)
@
"^DD",798.1,798.1,13.3,9)
@
"^DD",798.1,798.1,13.3,20,0)
^.3LA^1^1
"^DD",798.1,798.1,13.3,20,1,0)
DEFINITION
"^DD",798.1,798.1,13.3,21,0)
^.001^10^10^3060203^^
"^DD",798.1,798.1,13.3,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS A PART OF
"^DD",798.1,798.1,13.3,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",798.1,798.1,13.3,21,3,0)
 
"^DD",798.1,798.1,13.3,21,4,0)
The NATIONAL NOTIFICATION E-MAIL field holds an 
"^DD",798.1,798.1,13.3,21,5,0)
e-mail address where notifications about registry
"^DD",798.1,798.1,13.3,21,6,0)
problems (mostly, data transmission problems) are
"^DD",798.1,798.1,13.3,21,7,0)
sent to.
"^DD",798.1,798.1,13.3,21,8,0)
 
"^DD",798.1,798.1,13.3,21,9,0)
If the field is empty, e-mail notifications will
"^DD",798.1,798.1,13.3,21,10,0)
not be sent.
"^DD",798.1,798.1,13.3,"DEL",1,0)
I $$VADEL^RORDD(798.1,$G(DA))
"^DD",798.1,798.1,13.3,"DT")
3030429
"^DD",798.1,798.1,14,0)
NOTIFICATION^798.114P^^10;0
"^DD",798.1,798.1,14,21,0)
^.001^3^3^3050525^^^
"^DD",798.1,798.1,14,21,1,0)
This multiple contains a list of VistA users that
"^DD",798.1,798.1,14,21,2,0)
should be notified about problems with the local
"^DD",798.1,798.1,14,21,3,0)
registry.
"^DD",798.1,798.1,14,"DT")
3050427
"^DD",798.1,798.1,15.1,0)
LAG DAYS^NJ1,0^^11;1^K:+X'=X!(X>7)!(X<1)!(X?.E1"."1N.N) X
"^DD",798.1,798.1,15.1,3)
Enter number of days between 1 and 7.
"^DD",798.1,798.1,15.1,20,0)
^.3LA^1^1
"^DD",798.1,798.1,15.1,20,1,0)
PARAMETERS
"^DD",798.1,798.1,15.1,21,0)
^.001^12^12^3120501^^^^
"^DD",798.1,798.1,15.1,21,1,0)
Number of days that defines an overlap of the data
"^DD",798.1,798.1,15.1,21,2,0)
searches during the registry updates and a data
"^DD",798.1,798.1,15.1,21,3,0)
extraction delay during the regular data
"^DD",798.1,798.1,15.1,21,4,0)
extractions.
"^DD",798.1,798.1,15.1,21,5,0)
 
"^DD",798.1,798.1,15.1,21,6,0)
If this field is empty, the default value of 1 is 
"^DD",798.1,798.1,15.1,21,7,0)
used by the registry update and data extraction
"^DD",798.1,798.1,15.1,21,8,0)
processes.
"^DD",798.1,798.1,15.1,21,9,0)
 
"^DD",798.1,798.1,15.1,21,10,0)
See the package documentation or Technical
"^DD",798.1,798.1,15.1,21,11,0)
Description of the field in the data dictionary
"^DD",798.1,798.1,15.1,21,12,0)
for more information.
"^DD",798.1,798.1,15.1,23,0)
^^37^37^3120501^
"^DD",798.1,798.1,15.1,23,1,0)
Clinical data may be entered into the VistA system 
"^DD",798.1,798.1,15.1,23,2,0)
later than they are available. For example, an
"^DD",798.1,798.1,15.1,23,3,0)
encounter that occurred today may not get entered into
"^DD",798.1,798.1,15.1,23,4,0)
the system until tomorrow.
"^DD",798.1,798.1,15.1,23,5,0)
 
"^DD",798.1,798.1,15.1,23,6,0)
Because of this delay, data may be missed by the
"^DD",798.1,798.1,15.1,23,7,0)
registry update and data extraction processes if they
"^DD",798.1,798.1,15.1,23,8,0)
look for the data until the current date and then
"^DD",798.1,798.1,15.1,23,9,0)
continue from that point next time.
"^DD",798.1,798.1,15.1,23,10,0)
 
"^DD",798.1,798.1,15.1,23,11,0)
To avoid this problem, data search intervals are 
"^DD",798.1,798.1,15.1,23,12,0)
overlapped by the number of days indicated by this 
"^DD",798.1,798.1,15.1,23,13,0)
field. The registry update process looks for new data 
"^DD",798.1,798.1,15.1,23,14,0)
not from the end date of its previous run but from the 
"^DD",798.1,798.1,15.1,23,15,0)
date that is earlier by the number of days from this 
"^DD",798.1,798.1,15.1,23,16,0)
field. This overlap increases the chances of data
"^DD",798.1,798.1,15.1,23,17,0)
entered retrospectively to be found by the next run of
"^DD",798.1,798.1,15.1,23,18,0)
the registry update process.
"^DD",798.1,798.1,15.1,23,19,0)
 
"^DD",798.1,798.1,15.1,23,20,0)
Moreover, the regular data extraction process extracts
"^DD",798.1,798.1,15.1,23,21,0)
data not until the date when the process is run but
"^DD",798.1,798.1,15.1,23,22,0)
until the date that is earlier by the number of days
"^DD",798.1,798.1,15.1,23,23,0)
from this field. So, this is a delay that allows the
"^DD",798.1,798.1,15.1,23,24,0)
data to be entered retrospectively before the next data
"^DD",798.1,798.1,15.1,23,25,0)
extraction.
"^DD",798.1,798.1,15.1,23,26,0)
 
"^DD",798.1,798.1,15.1,23,27,0)
If the value of this field is too small, you may miss 
"^DD",798.1,798.1,15.1,23,28,0)
some data entered retrospectively. If it is too big,
"^DD",798.1,798.1,15.1,23,29,0)
the national registry will not contain up to date
"^DD",798.1,798.1,15.1,23,30,0)
information (data will be delayed by the number of days
"^DD",798.1,798.1,15.1,23,31,0)
indicated by this field) and the registry update
"^DD",798.1,798.1,15.1,23,32,0)
process will take more time to complete, because 
"^DD",798.1,798.1,15.1,23,33,0)
additional time will be spent processing the data from
"^DD",798.1,798.1,15.1,23,34,0)
the overlap interval).
"^DD",798.1,798.1,15.1,23,35,0)
 
"^DD",798.1,798.1,15.1,23,36,0)
When several registries are processed at the same time,
"^DD",798.1,798.1,15.1,23,37,0)
the maximum value of the LAG DAYS field is used.
"^DD",798.1,798.1,15.1,"DT")
3020426
"^DD",798.1,798.1,18,0)
SECURITY KEY^798.118^^18;0
"^DD",798.1,798.1,18,9)
@
"^DD",798.1,798.1,18,20,0)
^.3LA^1^1
"^DD",798.1,798.1,18,20,1,0)
DEFINITION
"^DD",798.1,798.1,18,21,0)
^.001^2^2^3050722^^^^
"^DD",798.1,798.1,18,21,1,0)
This multiple stores a list of security keys 
"^DD",798.1,798.1,18,21,2,0)
associated with the registry.
"^DD",798.1,798.1,19.1,0)
NUMBER OF PATIENTS^NJ9,0^^19;1^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",798.1,798.1,19.1,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",798.1,798.1,19.1,8.5)
@
"^DD",798.1,798.1,19.1,9)
@
"^DD",798.1,798.1,19.1,20,0)
^.3LA^1^1
"^DD",798.1,798.1,19.1,20,1,0)
STATE
"^DD",798.1,798.1,19.1,21,0)
^.001^3^3^3060106^^^
"^DD",798.1,798.1,19.1,21,1,0)
The NUMBER OF PATIENTS field contains total number
"^DD",798.1,798.1,19.1,21,2,0)
of confirmed patients in the registry right after
"^DD",798.1,798.1,19.1,21,3,0)
the last registry update.
"^DD",798.1,798.1,19.1,23,0)
^.001^3^3^3060203^^
"^DD",798.1,798.1,19.1,23,1,0)
This field should not be edited. It is updated
"^DD",798.1,798.1,19.1,23,2,0)
automatically by the $$UPDDEM^RORUPD51 function during
"^DD",798.1,798.1,19.1,23,3,0)
the registry update.
"^DD",798.1,798.1,19.1,"DT")
3031027
"^DD",798.1,798.1,19.2,0)
NUMBER OF PENDING PATIENTS^NJ9,0^^19;2^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",798.1,798.1,19.2,3)
Type a Number between 0 and 999999999, 0 Decimal Digits
"^DD",798.1,798.1,19.2,8.5)
@
"^DD",798.1,798.1,19.2,9)
@
"^DD",798.1,798.1,19.2,20,0)
^.3LA^1^1
"^DD",798.1,798.1,19.2,20,1,0)
STATE
"^DD",798.1,798.1,19.2,21,0)
^.001^3^3^3060106^^
"^DD",798.1,798.1,19.2,21,1,0)
The NUMBER OF PENDING PATIENTS field stores number
"^DD",798.1,798.1,19.2,21,2,0)
of pending patients in the registry right after
"^DD",798.1,798.1,19.2,21,3,0)
the last registry update.
"^DD",798.1,798.1,19.2,23,0)
^.001^3^3^3060203^^
"^DD",798.1,798.1,19.2,23,1,0)
This field should not be edited. It is updated 
"^DD",798.1,798.1,19.2,23,2,0)
automatically by the $$UPDDEM^RORUPD51 function during
"^DD",798.1,798.1,19.2,23,3,0)
the registry update.
"^DD",798.1,798.1,19.2,"DT")
3050627
"^DD",798.1,798.1,19.3,0)
HL7 ATTEMPT COUNTER^NJ3,0^^19;3^K:+X'=X!(X>999)!(X<0)!(X?.E1"."1N.N) X
"^DD",798.1,798.1,19.3,3)
Type a Number between 0 and 999, 0 Decimal Digits
"^DD",798.1,798.1,19.3,8.5)
@
"^DD",798.1,798.1,19.3,9)
@
"^DD",798.1,798.1,19.3,20,0)
^.3LA^1^1
"^DD",798.1,798.1,19.3,20,1,0)
HL7
"^DD",798.1,798.1,19.3,21,0)
^^10^10^3060203^
"^DD",798.1,798.1,19.3,21,1,0)
The HL7 ATTEMPT COUNTER field is incremented each
"^DD",798.1,798.1,19.3,21,2,0)
time the nightly task (the Registry Update & Data 
"^DD",798.1,798.1,19.3,21,3,0)
Extraction [ROR TASK] option) encounters at least
"^DD",798.1,798.1,19.3,21,4,0)
one unsent HL7 message.
"^DD",798.1,798.1,19.3,21,5,0)
 
"^DD",798.1,798.1,19.3,21,6,0)
The nightly task assigns 1 to the field when new
"^DD",798.1,798.1,19.3,21,7,0)
HL7 messages are generated (only if all previous
"^DD",798.1,798.1,19.3,21,8,0)
messages have been successfully transmitted).
"^DD",798.1,798.1,19.3,21,9,0)
 
"^DD",798.1,798.1,19.3,21,10,0)
Usually, you should not edit this field.
"^DD",798.1,798.1,19.3,23,0)
^.001^3^3^3060203^^^^
"^DD",798.1,798.1,19.3,23,1,0)
See description of the ALERT FREQUENCY field (13.2) and
"^DD",798.1,798.1,19.3,23,2,0)
source code of the $$CHECKMSG^ROR10 function for more
"^DD",798.1,798.1,19.3,23,3,0)
details.
"^DD",798.1,798.1,19.3,"DT")
3050701
"^DD",798.1,798.1,21.01,0)
AUTOMATIC BACKPULL^*P799.6'^RORDATA(799.6,^21;1^S DIC("S")="I $P($G(^(0)),U,2)=1" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",798.1,798.1,21.01,8.5)
@
"^DD",798.1,798.1,21.01,9)
@
"^DD",798.1,798.1,21.01,12)
Only "Auto" definitions can be selected.
"^DD",798.1,798.1,21.01,12.1)
S DIC("S")="I $P($G(^(0)),U,2)=1"
"^DD",798.1,798.1,21.01,20,0)
^.3LA^1^1
"^DD",798.1,798.1,21.01,20,1,0)
STATE
"^DD",798.1,798.1,21.01,21,0)
^^3^3^3051110^
"^DD",798.1,798.1,21.01,21,1,0)
This field stores the pointer to the historical 
"^DD",798.1,798.1,21.01,21,2,0)
data extraction definition that was used during
"^DD",798.1,798.1,21.01,21,3,0)
the previous run of the nightly task.
"^DD",798.1,798.1,21.01,"DT")
3051110
"^DD",798.1,798.1,21.04,0)
LOCAL DATA RESENT^D^^21;3^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",798.1,798.1,21.04,8.5)
@
"^DD",798.1,798.1,21.04,9)
@
"^DD",798.1,798.1,21.04,20,0)
^.3LA^1^1
"^DD",798.1,798.1,21.04,20,1,0)
STATE
"^DD",798.1,798.1,21.04,21,0)
^.001^10^10^3060203^^
"^DD",798.1,798.1,21.04,21,1,0)
This field holds the date when all local registry 
"^DD",798.1,798.1,21.04,21,2,0)
data was resent to AAC after the installation (to 
"^DD",798.1,798.1,21.04,21,3,0)
fix the data incorrectly overwritten with the 
"^DD",798.1,798.1,21.04,21,4,0)
historical data).
"^DD",798.1,798.1,21.04,21,5,0)
 
"^DD",798.1,798.1,21.04,21,6,0)
Usually, you should not modify this field. If you
"^DD",798.1,798.1,21.04,21,7,0)
need to resend all local registry and demographic
"^DD",798.1,798.1,21.04,21,8,0)
data to AAC, you should clear this field. The data
"^DD",798.1,798.1,21.04,21,9,0)
will be resent automatically during the next
"^DD",798.1,798.1,21.04,21,10,0)
nightly transmission.
"^DD",798.1,798.1,21.04,23,0)
^.001^4^4^3060203^^^^
"^DD",798.1,798.1,21.04,23,1,0)
The value of this field is analyzed and modified by the
"^DD",798.1,798.1,21.04,23,2,0)
$$REMARK^RORUTL05 function. The function is called by
"^DD",798.1,798.1,21.04,23,3,0)
the nightly registry update and data transmission task
"^DD",798.1,798.1,21.04,23,4,0)
(TASK^ROR).
"^DD",798.1,798.1,21.04,"DT")
3020508
"^DD",798.1,798.1,21.05,0)
HDT DATE/TIME^D^^21;4^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",798.1,798.1,21.05,8.5)
@
"^DD",798.1,798.1,21.05,9)
@
"^DD",798.1,798.1,21.05,21,0)
^.001^4^4^3060123^^
"^DD",798.1,798.1,21.05,21,1,0)
This field is initialized with the current 
"^DD",798.1,798.1,21.05,21,2,0)
date/time by the registry setup task upon
"^DD",798.1,798.1,21.05,21,3,0)
successful completion of the initial registry
"^DD",798.1,798.1,21.05,21,4,0)
population.
"^DD",798.1,798.1,21.05,23,0)
^^4^4^3060123^
"^DD",798.1,798.1,21.05,23,1,0)
The field is populated by the $$UPDHDTRP^RORSETU2 
"^DD",798.1,798.1,21.05,23,2,0)
function during the registry setup.
"^DD",798.1,798.1,21.05,23,3,0)
 
"^DD",798.1,798.1,21.05,23,4,0)
Do not delete value of this field!
"^DD",798.1,798.1,21.05,"DT")
3031027
"^DD",798.1,798.1,22,0)
LAST BATCH CONTROL ID^798.122^^22;0
"^DD",798.1,798.1,22,9)
@
"^DD",798.1,798.1,22,20,0)
^.3LA^1^1
"^DD",798.1,798.1,22,20,1,0)
HL7
"^DD",798.1,798.1,22,21,0)
^.001^3^3^3060203^^^^
"^DD",798.1,798.1,22,21,1,0)
This multiple contains a list of identifiers of
"^DD",798.1,798.1,22,21,2,0)
the HL7 batch messages generated during the
"^DD",798.1,798.1,22,21,3,0)
previous run of the nightly task.
"^DD",798.1,798.1,22,23,0)
^^3^3^3060203^
"^DD",798.1,798.1,22,23,1,0)
The nightly task checks status of each message from 
"^DD",798.1,798.1,22,23,2,0)
this multiple before the registry update and data
"^DD",798.1,798.1,22,23,3,0)
extraction.
"^DD",798.1,798.1,22,"DT")
3050504
"^DD",798.1,798.1,25,0)
ENABLE PROTOCOLS^S^0:NO;1:YES;^0;14^Q
"^DD",798.1,798.1,25,1,0)
^.1
"^DD",798.1,798.1,25,1,1,0)
798.1^AEP^MUMPS
"^DD",798.1,798.1,25,1,1,1)
S:X ^ROR(798.1,"AEP",DA)=""
"^DD",798.1,798.1,25,1,1,2)
K ^ROR(798.1,"AEP",DA)
"^DD",798.1,798.1,25,1,1,3)
Do not delete!
"^DD",798.1,798.1,25,1,1,"%D",0)
^^10^10^3060203^
"^DD",798.1,798.1,25,1,1,"%D",1,0)
This cross-reference controls the package event 
"^DD",798.1,798.1,25,1,1,"%D",2,0)
protocols.
"^DD",798.1,798.1,25,1,1,"%D",3,0)
 
"^DD",798.1,798.1,25,1,1,"%D",4,0)
If at least one registry has the ENABLE PROTOCOLS
"^DD",798.1,798.1,25,1,1,"%D",5,0)
field set to "YES", the ^ROR(798.1,"AEP") node
"^DD",798.1,798.1,25,1,1,"%D",6,0)
will be defined and the protocols will call the
"^DD",798.1,798.1,25,1,1,"%D",7,0)
processing routines.
"^DD",798.1,798.1,25,1,1,"%D",8,0)
 
"^DD",798.1,798.1,25,1,1,"%D",9,0)
Otherwise, they will run idle unless they are 
"^DD",798.1,798.1,25,1,1,"%D",10,0)
disabled or unsubscribed manually.
"^DD",798.1,798.1,25,1,1,"DT")
3020418
"^DD",798.1,798.1,25,20,0)
^.3LA^1^1
"^DD",798.1,798.1,25,20,1,0)
PARAMETERS
"^DD",798.1,798.1,25,21,0)
^^13^13^3060203^
"^DD",798.1,798.1,25,21,1,0)
If this field is set to "YES", event protocols
"^DD",798.1,798.1,25,21,2,0)
will be used by the package to speed up the 
"^DD",798.1,798.1,25,21,3,0)
registry processing.
"^DD",798.1,798.1,25,21,4,0)
 
"^DD",798.1,798.1,25,21,5,0)
The protocols create references to patient events
"^DD",798.1,798.1,25,21,6,0)
in the ROR PATIENT EVENTS file. Only those 
"^DD",798.1,798.1,25,21,7,0)
patients that have new references will be 
"^DD",798.1,798.1,25,21,8,0)
processed by the next registry update.
"^DD",798.1,798.1,25,21,9,0)
 
"^DD",798.1,798.1,25,21,10,0)
If several registries are updated at the same 
"^DD",798.1,798.1,25,21,11,0)
time and at least one of them has this field set 
"^DD",798.1,798.1,25,21,12,0)
to "YES", all these registries will be processed 
"^DD",798.1,798.1,25,21,13,0)
using event references.
"^DD",798.1,798.1,25,23,0)
^.001^11^11^3060203^^
"^DD",798.1,798.1,25,23,1,0)
This field controls both the registry update engine 
"^DD",798.1,798.1,25,23,2,0)
and the event protocols.
"^DD",798.1,798.1,25,23,3,0)
 
"^DD",798.1,798.1,25,23,4,0)
If at least one of the defined registries enables the
"^DD",798.1,798.1,25,23,5,0)
protocols, they will process the events and create
"^DD",798.1,798.1,25,23,6,0)
references in the ROR PATIENT EVENTS file (#798.3).
"^DD",798.1,798.1,25,23,7,0)
 
"^DD",798.1,798.1,25,23,8,0)
Otherwise, the protocols will be executed (if they are
"^DD",798.1,798.1,25,23,9,0)
not disabled or unsubscribed manually) but will not
"^DD",798.1,798.1,25,23,10,0)
call processing routines and will not create references
"^DD",798.1,798.1,25,23,11,0)
in file #798.3.
"^DD",798.1,798.1,25,"DT")
3020418
"^DD",798.1,798.1,26,0)
EXCLUDE EMPLOYEES^SX^0:NO;1:YES;^0;10^Q:$$VAEDT^RORDD(798.1,$G(DA))
"^DD",798.1,798.1,26,8.5)
@
"^DD",798.1,798.1,26,9)
@
"^DD",798.1,798.1,26,20,0)
^.3LA^1^1
"^DD",798.1,798.1,26,20,1,0)
DEFINITION
"^DD",798.1,798.1,26,21,0)
^^6^6^3060203^
"^DD",798.1,798.1,26,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A
"^DD",798.1,798.1,26,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",798.1,798.1,26,21,3,0)
 
"^DD",798.1,798.1,26,21,4,0)
If this field is set to "YES", patients who are
"^DD",798.1,798.1,26,21,5,0)
employees will not be processed by the registry
"^DD",798.1,798.1,26,21,6,0)
update or data extraction functions.
"^DD",798.1,798.1,26,"DEL",1,0)
I $$VADEL^RORDD(798.1,$G(DA))
"^DD",798.1,798.1,26,"DT")
3020802
"^DD",798.1,798.1,27,0)
AVAILABLE REPORTS^FX^^27;E1,250^Q:$$VAEDT^RORDD(798.1,$G(DA))  K:$L(X)>250!($L(X)<1) X
"^DD",798.1,798.1,27,3)
Answer must be 1-250 characters in length.
"^DD",798.1,798.1,27,8.5)
@
"^DD",798.1,798.1,27,9)
@
"^DD",798.1,798.1,27,20,0)
^.3LA^1^1
"^DD",798.1,798.1,27,20,1,0)
DEFINITION
"^DD",798.1,798.1,27,21,0)
^^7^7^3060203^
"^DD",798.1,798.1,27,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS A PART OF
"^DD",798.1,798.1,27,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",798.1,798.1,27,21,3,0)
 
"^DD",798.1,798.1,27,21,4,0)
The AVAILABLE REPORTS field stores a list of 
"^DD",798.1,798.1,27,21,5,0)
report codes (not the IENs!) separated by commas.
"^DD",798.1,798.1,27,21,6,0)
These reports will be available for this registry
"^DD",798.1,798.1,27,21,7,0)
in the GUI.
"^DD",798.1,798.1,27,23,0)
^.001^5^5^3060203^^^^
"^DD",798.1,798.1,27,23,1,0)
The GUI loads the value of this field using the ROR 
"^DD",798.1,798.1,27,23,2,0)
REPORTS AVAILABLE remote procedure.
"^DD",798.1,798.1,27,23,3,0)
 
"^DD",798.1,798.1,27,23,4,0)
See the data dictionary of the ROR REPORT PARAMETERS 
"^DD",798.1,798.1,27,23,5,0)
file (#799.12) for more details.
"^DD",798.1,798.1,27,"DEL",1,0)
I $$VADEL^RORDD(798.1,$G(DA))
"^DD",798.1,798.1,27,"DT")
3030417
"^DD",798.1,798.1,28,0)
LOCAL TEST NAME^798.128PI^^28;0
"^DD",798.1,798.1,28,20,0)
^.3LA^1^1
"^DD",798.1,798.1,28,20,1,0)
PARAMETERS
"^DD",798.1,798.1,28,21,0)
^.001^3^3^3060106^^
"^DD",798.1,798.1,28,21,1,0)
This multiple maps local lab tests to the 
"^DD",798.1,798.1,28,21,2,0)
predefined lab test groups that are used in the 
"^DD",798.1,798.1,28,21,3,0)
reports.
"^DD",798.1,798.1,28,"DT")
3030402
"^DD",798.1,798.1,29,0)
LOCAL DRUG NAME^798.129P^^29;0
"^DD",798.1,798.1,29,20,0)
^.3LA^1^1
"^DD",798.1,798.1,29,20,1,0)
PARAMETERS
"^DD",798.1,798.1,29,21,0)
^^3^3^3060106^
"^DD",798.1,798.1,29,21,1,0)
This multiple maps local medication names to the
"^DD",798.1,798.1,29,21,2,0)
predefined medication groups that are used in the
"^DD",798.1,798.1,29,21,3,0)
reports.
"^DD",798.1,798.1,30,0)
REPORT STATS^798.12P^^30;0
"^DD",798.1,798.1,30,9)
@
"^DD",798.1,798.1,30,20,0)
^.3LA^1^1
"^DD",798.1,798.1,30,20,1,0)
STATE
"^DD",798.1,798.1,30,21,0)
^.001^4^4^3120228^^^
"^DD",798.1,798.1,30,21,1,0)
Records of this multiple store the statistic data 
"^DD",798.1,798.1,30,21,2,0)
related to running reports. Usually, the stats are
"^DD",798.1,798.1,30,21,3,0)
reset after successful data transmission to the
"^DD",798.1,798.1,30,21,4,0)
AAC.
"^DD",798.1,798.1,30,23,0)
^.001^7^7^3120228^^
"^DD",798.1,798.1,30,23,1,0)
Please do not edit the records of this multiple
"^DD",798.1,798.1,30,23,2,0)
directly. Use the entry points of the RORTSK12 routine
"^DD",798.1,798.1,30,23,3,0)
instead.
"^DD",798.1,798.1,30,23,4,0)
 
"^DD",798.1,798.1,30,23,5,0)
The input transform associated with the .01 field of 
"^DD",798.1,798.1,30,23,6,0)
this multiple guarantees that each report has only one
"^DD",798.1,798.1,30,23,7,0)
corresponding record in the multiple.
"^DD",798.1,798.1,31,0)
AUTO-CONFIRM^S^0:NO;1:YES;^6;1^Q
"^DD",798.1,798.1,31,1,0)
^.1
"^DD",798.1,798.1,31,1,1,0)
798.1^C
"^DD",798.1,798.1,31,1,1,1)
S ^ROR(798.1,"C",$E(X,1,30),DA)=""
"^DD",798.1,798.1,31,1,1,2)
K ^ROR(798.1,"C",$E(X,1,30),DA)
"^DD",798.1,798.1,31,1,1,"DT")
3120301
"^DD",798.1,798.1,31,3)
Enter 'Yes' if the status of patients added to this registry should be automatically confirmed.
"^DD",798.1,798.1,31,21,0)
^^4^4^3120503^
"^DD",798.1,798.1,31,21,1,0)
This field is used during the registry update to set the status of new 
"^DD",798.1,798.1,31,21,2,0)
patients.  If the registry is set to auto-confirm, the patient status is
"^DD",798.1,798.1,31,21,3,0)
set to 'Confirmed'.  If auto-confirm is no, the patient status is set to
"^DD",798.1,798.1,31,21,4,0)
'Pending'.
"^DD",798.1,798.1,31,"DT")
3120301
"^DD",798.1,798.11,0)
LOG EVENT SUB-FIELD^^.01^1
"^DD",798.1,798.11,0,"DT")
3010712
"^DD",798.1,798.11,0,"NM","LOG EVENT")
 
"^DD",798.1,798.11,0,"UP")
798.1
"^DD",798.1,798.11,.01,0)
LOG EVENT^MSX^1:Debug;2:Information;3:Data Quality;4:Warning;5:Database Error;6:Error;^0;1^Q
"^DD",798.1,798.11,.01,1,0)
^.1^^0
"^DD",798.1,798.11,.01,21,0)
^.001^10^10^3060203^^
"^DD",798.1,798.11,.01,21,1,0)
Select the type of the event if you want to enable
"^DD",798.1,798.11,.01,21,2,0)
recording of these events. If the list is empty,
"^DD",798.1,798.11,.01,21,3,0)
recording of all events is enabled. Otherwise,
"^DD",798.1,798.11,.01,21,4,0)
only events from the list and error messages will 
"^DD",798.1,798.11,.01,21,5,0)
be recorded.
"^DD",798.1,798.11,.01,21,6,0)
 
"^DD",798.1,798.11,.01,21,7,0)
Debug messages are exclusions from this rule (they
"^DD",798.1,798.11,.01,21,8,0)
are not logged if the ENABLE LOG field is set to
"^DD",798.1,798.11,.01,21,9,0)
"YES" and this multiple is empty). Their recording
"^DD",798.1,798.11,.01,21,10,0)
can only be enabled explicitly.
"^DD",798.1,798.11,.01,23,0)
^.001^9^9^3060203^^^^
"^DD",798.1,798.11,.01,23,1,0)
If several registries are processed at the same time,
"^DD",798.1,798.11,.01,23,2,0)
the recording parameters are combined.
"^DD",798.1,798.11,.01,23,3,0)
 
"^DD",798.1,798.11,.01,23,4,0)
If one of the registries requests recording of all 
"^DD",798.1,798.11,.01,23,5,0)
events, all events except the debug messages (type 1)
"^DD",798.1,798.11,.01,23,6,0)
will be recorded for all registries.
"^DD",798.1,798.11,.01,23,7,0)
 
"^DD",798.1,798.11,.01,23,8,0)
Otherwise, merged content of the LOG EVENT multiples
"^DD",798.1,798.11,.01,23,9,0)
will determine the events to be recorded.
"^DD",798.1,798.11,.01,"DT")
3050722
"^DD",798.1,798.112,0)
EXTRACTED RESULT SUB-FIELD^^.03^3
"^DD",798.1,798.112,0,"DT")
3030318
"^DD",798.1,798.112,0,"ID","WRITE")
D EN^DDIOL($P(^(0),U,2),"","?20")
"^DD",798.1,798.112,0,"IX","B",798.112,.01)

"^DD",798.1,798.112,0,"IX","C",798.112,.02)

"^DD",798.1,798.112,0,"NM","EXTRACTED RESULT")
 
"^DD",798.1,798.112,0,"UP")
798.1
"^DD",798.1,798.112,.01,0)
LOINC CODE^MFX^^0;1^Q:$$VAEDT^RORDD(798.1,$G(DA(1)))  K:X'?1(1.7N,1"*") X
"^DD",798.1,798.112,.01,1,0)
^.1
"^DD",798.1,798.112,.01,1,1,0)
798.112^B
"^DD",798.1,798.112,.01,1,1,1)
S ^ROR(798.1,DA(1),8,"B",$E(X,1,30),DA)=""
"^DD",798.1,798.112,.01,1,1,2)
K ^ROR(798.1,DA(1),8,"B",$E(X,1,30),DA)
"^DD",798.1,798.112,.01,1,1,3)
Do not delete!
"^DD",798.1,798.112,.01,1,1,"DT")
3010716
"^DD",798.1,798.112,.01,3)
Answer must be 1-7 characters in length.
"^DD",798.1,798.112,.01,8.5)
@
"^DD",798.1,798.112,.01,9)
@
"^DD",798.1,798.112,.01,21,0)
^^11^11^3011015^
"^DD",798.1,798.112,.01,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A
"^DD",798.1,798.112,.01,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",798.1,798.112,.01,21,3,0)
 
"^DD",798.1,798.112,.01,21,4,0)
Enter the unique numeric LOINC code (without the
"^DD",798.1,798.112,.01,21,5,0)
check digit) of the Lab result to be extracted. If
"^DD",798.1,798.112,.01,21,6,0)
you want to use only NLT code, enter zero as the
"^DD",798.1,798.112,.01,21,7,0)
value of this field.
"^DD",798.1,798.112,.01,21,8,0)
 
"^DD",798.1,798.112,.01,21,9,0)
If you want to extract all results, create a
"^DD",798.1,798.112,.01,21,10,0)
record in this multiple containing the "*" 
"^DD",798.1,798.112,.01,21,11,0)
character in this field.
"^DD",798.1,798.112,.01,"DEL",1,0)
I $$VADEL^RORDD(798.1,$G(DA(1)))
"^DD",798.1,798.112,.01,"DT")
3010716
"^DD",798.1,798.112,.02,0)
NLT CODE^FX^^0;2^Q:$$VAEDT^RORDD(798.1,$G(DA(1)))  K:'(X?5N1"."4.5N) X
"^DD",798.1,798.112,.02,1,0)
^.1
"^DD",798.1,798.112,.02,1,1,0)
798.112^C
"^DD",798.1,798.112,.02,1,1,1)
S ^ROR(798.1,DA(1),8,"C",$E(X,1,30),DA)=""
"^DD",798.1,798.112,.02,1,1,2)
K ^ROR(798.1,DA(1),8,"C",$E(X,1,30),DA)
"^DD",798.1,798.112,.02,1,1,3)
Do not delete!
"^DD",798.1,798.112,.02,1,1,"DT")
3010716
"^DD",798.1,798.112,.02,3)
Answer must be 10-11 characters in length.
"^DD",798.1,798.112,.02,8.5)
@
"^DD",798.1,798.112,.02,9)
@
"^DD",798.1,798.112,.02,21,0)
^^8^8^3011015^
"^DD",798.1,798.112,.02,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A
"^DD",798.1,798.112,.02,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",798.1,798.112,.02,21,3,0)
 
"^DD",798.1,798.112,.02,21,4,0)
Enter the unique NLT code of the Lab result to be
"^DD",798.1,798.112,.02,21,5,0)
extracted. Both LOINC and NLT codes (if available)
"^DD",798.1,798.112,.02,21,6,0)
are used for searching the Lab results. If you 
"^DD",798.1,798.112,.02,21,7,0)
want to use only the LOINC code, leave this field 
"^DD",798.1,798.112,.02,21,8,0)
empty.
"^DD",798.1,798.112,.02,"DEL",1,0)
I $$VADEL^RORDD(798.1,$G(DA(1)))
"^DD",798.1,798.112,.02,"DT")
3010716
"^DD",798.1,798.112,.03,0)
SUBSCRIPTS^FX^^0;3^Q:$$VAEDT^RORDD(798.1,$G(DA(1)))  K:$L(X)>30!($L(X)<2) X
"^DD",798.1,798.112,.03,3)
Answer must be 2-30 characters in length.
"^DD",798.1,798.112,.03,8.5)
@
"^DD",798.1,798.112,.03,9)
@
"^DD",798.1,798.112,.03,21,0)
^^14^14^3030318^
"^DD",798.1,798.112,.03,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A
"^DD",798.1,798.112,.03,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",798.1,798.112,.03,21,3,0)
 
"^DD",798.1,798.112,.03,21,4,0)
Enter a list of the subscripts separated by commas
"^DD",798.1,798.112,.03,21,5,0)
(CH, MI, etc.) from where the results should be
"^DD",798.1,798.112,.03,21,6,0)
loaded by the $$GCPR^LA7QRY function. Only these
"^DD",798.1,798.112,.03,21,7,0)
subscripts will be searched for new data.
"^DD",798.1,798.112,.03,21,8,0)
 
"^DD",798.1,798.112,.03,21,9,0)
NOTE: The value of the field affects the data
"^DD",798.1,798.112,.03,21,10,0)
extraction only if the LOINC CODE field is equal
"^DD",798.1,798.112,.03,21,11,0)
to "*".
"^DD",798.1,798.112,.03,21,12,0)
 
"^DD",798.1,798.112,.03,21,13,0)
If this field is empty (by default), the API 
"^DD",798.1,798.112,.03,21,14,0)
searches through all supported subscripts.
"^DD",798.1,798.112,.03,"DT")
3030318
"^DD",798.1,798.114,0)
NOTIFICATION SUB-FIELD^^.01^1
"^DD",798.1,798.114,0,"DT")
3010907
"^DD",798.1,798.114,0,"IX","B",798.114,.01)

"^DD",798.1,798.114,0,"NM","NOTIFICATION")
 
"^DD",798.1,798.114,0,"UP")
798.1
"^DD",798.1,798.114,.01,0)
NOTIFICATION^MP200'X^VA(200,^0;1^S:$D(X) DINUM=X
"^DD",798.1,798.114,.01,1,0)
^.1
"^DD",798.1,798.114,.01,1,1,0)
798.114^B
"^DD",798.1,798.114,.01,1,1,1)
S ^ROR(798.1,DA(1),10,"B",$E(X,1,30),DA)=""
"^DD",798.1,798.114,.01,1,1,2)
K ^ROR(798.1,DA(1),10,"B",$E(X,1,30),DA)
"^DD",798.1,798.114,.01,1,1,3)
Do not delete!
"^DD",798.1,798.114,.01,21,0)
^^4^4^3060203^
"^DD",798.1,798.114,.01,21,1,0)
Select a user who already receives alerts or add a
"^DD",798.1,798.114,.01,21,2,0)
new one from the NEW PERSON file. VistA users
"^DD",798.1,798.114,.01,21,3,0)
referenced by this field will be notified about
"^DD",798.1,798.114,.01,21,4,0)
problems with the registry processes.
"^DD",798.1,798.114,.01,"DT")
3050427
"^DD",798.1,798.118,0)
SECURITY KEY SUB-FIELD^^.01^1
"^DD",798.1,798.118,0,"DT")
3020801
"^DD",798.1,798.118,0,"NM","SECURITY KEY")
 
"^DD",798.1,798.118,0,"UP")
798.1
"^DD",798.1,798.118,.01,0)
SECURITY KEY^MFX^^0;1^Q:$$VAEDT^RORDD(798.1,$G(DA(1)))  K:$L(X)>27!($L(X)<3) X
"^DD",798.1,798.118,.01,1,0)
^.1^^-1
"^DD",798.1,798.118,.01,1,2,0)
798.1^ACL^MUMPS
"^DD",798.1,798.118,.01,1,2,1)
D ACLSET^RORDD
"^DD",798.1,798.118,.01,1,2,2)
D ACLKILL^RORDD
"^DD",798.1,798.118,.01,1,2,3)
Do not delete!
"^DD",798.1,798.118,.01,1,2,"%D",0)
^^25^25^3060203^
"^DD",798.1,798.118,.01,1,2,"%D",1,0)
This cross-reference is used by the screening 
"^DD",798.1,798.118,.01,1,2,"%D",2,0)
logic (the "SCR" node) of some Clinical Case 
"^DD",798.1,798.118,.01,1,2,"%D",3,0)
Registries files to check whether a user is
"^DD",798.1,798.118,.01,1,2,"%D",4,0)
allowed to access the records or not.
"^DD",798.1,798.118,.01,1,2,"%D",5,0)
 
"^DD",798.1,798.118,.01,1,2,"%D",6,0)
The cross-reference contains two kinds of items:
"^DD",798.1,798.118,.01,1,2,"%D",7,0)
 
"^DD",798.1,798.118,.01,1,2,"%D",8,0)
  ^ROR(798.1,"ACL",RORDUZ,RegIEN,KEY,IEN) = ""
"^DD",798.1,798.118,.01,1,2,"%D",9,0)
  ^ROR(798.1,"ACL",RORDUZ,RegName,KEY,IEN) = ""
"^DD",798.1,798.118,.01,1,2,"%D",10,0)
 
"^DD",798.1,798.118,.01,1,2,"%D",11,0)
where RORDUZ is the value of the DUZ variable for
"^DD",798.1,798.118,.01,1,2,"%D",12,0)
the user who has access to one or more registries
"^DD",798.1,798.118,.01,1,2,"%D",13,0)
(according to the allocated security keys). RegIEN
"^DD",798.1,798.118,.01,1,2,"%D",14,0)
and RegName are the registry IEN and name. KEY is
"^DD",798.1,798.118,.01,1,2,"%D",15,0)
the name of security key and IEN is the internal
"^DD",798.1,798.118,.01,1,2,"%D",16,0)
entry number of the corresponding record of the
"^DD",798.1,798.118,.01,1,2,"%D",17,0)
SECURITY KEY multiple.
"^DD",798.1,798.118,.01,1,2,"%D",18,0)
 
"^DD",798.1,798.118,.01,1,2,"%D",19,0)
The cross-reference should be rebuilt after
"^DD",798.1,798.118,.01,1,2,"%D",20,0)
changes in the allocation of the security keys
"^DD",798.1,798.118,.01,1,2,"%D",21,0)
associated with any registry. Usually, this is
"^DD",798.1,798.118,.01,1,2,"%D",22,0)
done by the nightly task (the [ROR TASK] option).
"^DD",798.1,798.118,.01,1,2,"%D",23,0)
However, if you want the changes to be in effect
"^DD",798.1,798.118,.01,1,2,"%D",24,0)
immediately, you should rebuild this
"^DD",798.1,798.118,.01,1,2,"%D",25,0)
cross-reference manually.
"^DD",798.1,798.118,.01,1,2,"DT")
3020805
"^DD",798.1,798.118,.01,3)
Enter a name of security key (3-27 characters in length).
"^DD",798.1,798.118,.01,8.5)
@
"^DD",798.1,798.118,.01,9)
@
"^DD",798.1,798.118,.01,20,0)
^.3LA^^0
"^DD",798.1,798.118,.01,21,0)
^.001^5^5^3020816^^^
"^DD",798.1,798.118,.01,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A
"^DD",798.1,798.118,.01,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",798.1,798.118,.01,21,3,0)
 
"^DD",798.1,798.118,.01,21,4,0)
The SECURITY KEY field contains the name of the 
"^DD",798.1,798.118,.01,21,5,0)
security key associated with the registry.
"^DD",798.1,798.118,.01,"DEL",1,0)
I $$VADEL^RORDD(798.1,$G(DA(1)))
"^DD",798.1,798.118,.01,"DT")
3050722
"^DD",798.1,798.12,0)
REPORT STATS SUB-FIELD^^.02^2
"^DD",798.1,798.12,0,"DT")
3050715
"^DD",798.1,798.12,0,"IX","B",798.12,.01)

"^DD",798.1,798.12,0,"NM","REPORT STATS")
 
"^DD",798.1,798.12,0,"UP")
798.1
"^DD",798.1,798.12,.01,0)
REPORT STATS^MP799.34'X^ROR(799.34,^0;1^S:$D(X) DINUM=X
"^DD",798.1,798.12,.01,1,0)
^.1
"^DD",798.1,798.12,.01,1,1,0)
798.12^B
"^DD",798.1,798.12,.01,1,1,1)
S ^ROR(798.1,DA(1),30,"B",$E(X,1,30),DA)=""
"^DD",798.1,798.12,.01,1,1,2)
K ^ROR(798.1,DA(1),30,"B",$E(X,1,30),DA)
"^DD",798.1,798.12,.01,1,1,3)
Do not delete!
"^DD",798.1,798.12,.01,1,1,"DT")
3050722
"^DD",798.1,798.12,.01,3)
 
"^DD",798.1,798.12,.01,8.5)
@
"^DD",798.1,798.12,.01,9)
@
"^DD",798.1,798.12,.01,20,0)
^.3LA^1^1
"^DD",798.1,798.12,.01,20,1,0)
STATE
"^DD",798.1,798.12,.01,21,0)
^.001^2^2^3120228^^
"^DD",798.1,798.12,.01,21,1,0)
A pointer stored in this field links the stats to 
"^DD",798.1,798.12,.01,21,2,0)
the report definition.
"^DD",798.1,798.12,.01,"DT")
3050722
"^DD",798.1,798.12,.02,0)
NUMBER OF RUNS^NJ9,0^^0;2^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",798.1,798.12,.02,3)
Type a Number between 0 and 999999999, 0 Decimal Digits.
"^DD",798.1,798.12,.02,8.5)
@
"^DD",798.1,798.12,.02,9)
@
"^DD",798.1,798.12,.02,20,0)
^.3LA^1^1
"^DD",798.1,798.12,.02,20,1,0)
STATE
"^DD",798.1,798.12,.02,21,0)
^.001^2^2^3060203^^
"^DD",798.1,798.12,.02,21,1,0)
This field serves as a counter of report runs 
"^DD",798.1,798.12,.02,21,2,0)
since the last successful data transmission.
"^DD",798.1,798.12,.02,23,0)
^.001^2^2^3060203^^
"^DD",798.1,798.12,.02,23,1,0)
Please do not edit the field directly. Use the entry
"^DD",798.1,798.12,.02,23,2,0)
points of the RORTSK12 routine instead.
"^DD",798.1,798.12,.02,"DT")
3050715
"^DD",798.1,798.122,0)
LAST BATCH CONTROL ID SUB-FIELD^^.03^3
"^DD",798.1,798.122,0,"DT")
3051129
"^DD",798.1,798.122,0,"NM","LAST BATCH CONTROL ID")
 
"^DD",798.1,798.122,0,"UP")
798.1
"^DD",798.1,798.122,.01,0)
LAST BATCH CONTROL ID^MFX^^0;1^K:$L(X)>20!($L(X)<1) X
"^DD",798.1,798.122,.01,1,0)
^.1^^0
"^DD",798.1,798.122,.01,3)
Answer must be 1-20 characters in length.
"^DD",798.1,798.122,.01,8.5)
@
"^DD",798.1,798.122,.01,9)
@
"^DD",798.1,798.122,.01,20,0)
^.3LA^1^1
"^DD",798.1,798.122,.01,20,1,0)
HL7
"^DD",798.1,798.122,.01,21,0)
^.001^3^3^3050503^^^
"^DD",798.1,798.122,.01,21,1,0)
The LAST BATCH CONTROL ID field contains the
"^DD",798.1,798.122,.01,21,2,0)
message control ID (BHS-11) of the latest batch
"^DD",798.1,798.122,.01,21,3,0)
HL7 message submitted to the VistA HL7 engine.
"^DD",798.1,798.122,.01,23,0)
^^3^3^3060203^
"^DD",798.1,798.122,.01,23,1,0)
This field is populated with the value returned by the 
"^DD",798.1,798.122,.01,23,2,0)
GENERATE^HLMA procedure. This value is usually
"^DD",798.1,798.122,.01,23,3,0)
different from that of the INTERNAL BATCH ID field.
"^DD",798.1,798.122,.01,"DT")
3051129
"^DD",798.1,798.122,.02,0)
INTERNAL BATCH ID^RF^^0;2^K:$L(X)>20!($L(X)<1) X
"^DD",798.1,798.122,.02,3)
Answer must be 1-20 characters in length.
"^DD",798.1,798.122,.02,8.5)
@
"^DD",798.1,798.122,.02,9)
@
"^DD",798.1,798.122,.02,20,0)
^.3LA^1^1
"^DD",798.1,798.122,.02,20,1,0)
HL7
"^DD",798.1,798.122,.02,21,0)
^^8^8^3060203^
"^DD",798.1,798.122,.02,21,1,0)
This field contains the internal batch identifier
"^DD",798.1,798.122,.02,21,2,0)
that was used during the generation of the batch 
"^DD",798.1,798.122,.02,21,3,0)
message.
"^DD",798.1,798.122,.02,21,4,0)
 
"^DD",798.1,798.122,.02,21,5,0)
The Control ID of each individual message included
"^DD",798.1,798.122,.02,21,6,0)
in the batch is constructed from the value of this
"^DD",798.1,798.122,.02,21,7,0)
field and a sequential number separated by the '-'
"^DD",798.1,798.122,.02,21,8,0)
character.
"^DD",798.1,798.122,.02,23,0)
^.001^7^7^3060203^^
"^DD",798.1,798.122,.02,23,1,0)
The INTERNAL BATCH ID field is automatically populated 
"^DD",798.1,798.122,.02,23,2,0)
with the identifier of the batch placeholder created by
"^DD",798.1,798.122,.02,23,3,0)
the CREATE^HLTF procedure. See the $$CREATE^RORHL7 and
"^DD",798.1,798.122,.02,23,4,0)
$$TMSTMP^ROREXTUT functions for details.
"^DD",798.1,798.122,.02,23,5,0)
 
"^DD",798.1,798.122,.02,23,6,0)
The actual batch control ID (BHS-11) is usually
"^DD",798.1,798.122,.02,23,7,0)
different from the value stored in this field.
"^DD",798.1,798.122,.02,"DT")
3050503
"^DD",798.1,798.122,.03,0)
DATE^D^^0;3^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",798.1,798.122,.03,8.5)
@
"^DD",798.1,798.122,.03,9)
@
"^DD",798.1,798.122,.03,21,0)
^^2^2^3060106^
"^DD",798.1,798.122,.03,21,1,0)
This field stores the date/time of the batch HL7 
"^DD",798.1,798.122,.03,21,2,0)
message.
"^DD",798.1,798.122,.03,"DT")
3051129
"^DD",798.1,798.128,0)
LOCAL TEST NAME SUB-FIELD^^.02^2
"^DD",798.1,798.128,0,"DT")
3030402
"^DD",798.1,798.128,0,"ID","WRITE")
S %I=Y,Y=+$P($G(^(0)),U,2),Y=$S(Y>0:$P($G(^ROR(799.1,Y,0)),U),1:"") D EN^DDIOL("   "_Y,,"?40") S Y=%I K %I
"^DD",798.1,798.128,0,"IX","B",798.128,.01)

"^DD",798.1,798.128,0,"NM","LOCAL TEST NAME")
 
"^DD",798.1,798.128,0,"UP")
798.1
"^DD",798.1,798.128,.01,0)
LOCAL TEST NAME^MP60'^LAB(60,^0;1^Q
"^DD",798.1,798.128,.01,1,0)
^.1
"^DD",798.1,798.128,.01,1,1,0)
798.128^B
"^DD",798.1,798.128,.01,1,1,1)
S ^ROR(798.1,DA(1),28,"B",$E(X,1,30),DA)=""
"^DD",798.1,798.128,.01,1,1,2)
K ^ROR(798.1,DA(1),28,"B",$E(X,1,30),DA)
"^DD",798.1,798.128,.01,20,0)
^.3LA^^0
"^DD",798.1,798.128,.01,"DT")
3030706
"^DD",798.1,798.128,.02,0)
LAB GROUP^R*P799.1'X^ROR(799.1,^0;2^S DIC("S")="S D=$G(^(0)) I $P(D,U,2)=3,$P(D,U,3)="_DA(1) D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",798.1,798.128,.02,1,0)
^.1^^0
"^DD",798.1,798.128,.02,12)
Only Lab Groups can be selected.
"^DD",798.1,798.128,.02,12.1)
S DIC("S")="I $P(^(0),U,2)=3"
"^DD",798.1,798.128,.02,"DT")
3030706
"^DD",798.1,798.129,0)
LOCAL DRUG NAME SUB-FIELD^^.02^2
"^DD",798.1,798.129,0,"DT")
3030625
"^DD",798.1,798.129,0,"IX","B",798.129,.01)

"^DD",798.1,798.129,0,"NM","LOCAL DRUG NAME")
 
"^DD",798.1,798.129,0,"UP")
798.1
"^DD",798.1,798.129,.01,0)
LOCAL DRUG NAME^MP50'^PSDRUG(^0;1^Q
"^DD",798.1,798.129,.01,1,0)
^.1
"^DD",798.1,798.129,.01,1,1,0)
798.129^B
"^DD",798.1,798.129,.01,1,1,1)
S ^ROR(798.1,DA(1),29,"B",$E(X,1,30),DA)=""
"^DD",798.1,798.129,.01,1,1,2)
K ^ROR(798.1,DA(1),29,"B",$E(X,1,30),DA)
"^DD",798.1,798.129,.01,20,0)
^.3LA^^0
"^DD",798.1,798.129,.01,"DT")
3030706
"^DD",798.1,798.129,.02,0)
DRUG GROUP^R*P799.1'X^ROR(799.1,^0;2^S DIC("S")="S D=$G(^(0)) I $P(D,U,2)=4,$P(D,U,3)="_DA(1) D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",798.1,798.129,.02,12)
Only Drug Groups can be selected.
"^DD",798.1,798.129,.02,12.1)
S DIC("S")="I $P(^(0),U,2)=4"
"^DD",798.1,798.129,.02,20,0)
^.3LA^^0
"^DD",798.1,798.129,.02,"DT")
3030706
"^DD",798.1,798.13,0)
SELECTION RULE SUB-FIELD^^.01^1
"^DD",798.1,798.13,0,"DT")
3000410
"^DD",798.1,798.13,0,"NM","SELECTION RULE")

"^DD",798.1,798.13,0,"UP")
798.1
"^DD",798.1,798.13,.01,0)
SELECTION RULE^MFX^^0;1^Q:$$VAEDT^RORDD(798.1,$G(DA(1)))  K:$L(X)>40!($L(X)<3)!'(X?3.UNP) X I $D(X) K:'$D(^ROR(798.2,"B",$E(X,1,40))) X
"^DD",798.1,798.13,.01,1,0)
^.1^^-1
"^DD",798.1,798.13,.01,1,2,0)
798.1^ARULES
"^DD",798.1,798.13,.01,1,2,1)
S ^ROR(798.1,"ARULES",$E(X,1,40),DA(1),DA)=""
"^DD",798.1,798.13,.01,1,2,2)
K ^ROR(798.1,"ARULES",$E(X,1,40),DA(1),DA)
"^DD",798.1,798.13,.01,1,2,3)
Do not delete!
"^DD",798.1,798.13,.01,1,2,"%D",0)
^.101^2^2^3140228^^
"^DD",798.1,798.13,.01,1,2,"%D",1,0)
This cross-reference can be used to find all 
"^DD",798.1,798.13,.01,1,2,"%D",2,0)
registries that use the selection rule.
"^DD",798.1,798.13,.01,1,2,"DT")
3000406
"^DD",798.1,798.13,.01,3)
Enter a name of the selection rule (3-40 characters).
"^DD",798.1,798.13,.01,4)
I $G(X)="??" N D,DIC,DZ S DIC="^ROR(798.2,",DIC(0)="",D="B",DZ="??" D DQ^DICQ,EN^DDIOL("",,"!")
"^DD",798.1,798.13,.01,8.5)
@
"^DD",798.1,798.13,.01,9)
@
"^DD",798.1,798.13,.01,21,0)
^.001^8^8^3140228^^^^
"^DD",798.1,798.13,.01,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A
"^DD",798.1,798.13,.01,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",798.1,798.13,.01,21,3,0)
 
"^DD",798.1,798.13,.01,21,4,0)
Enter a name of the selection rule that will be 
"^DD",798.1,798.13,.01,21,5,0)
used to select patients for addition to the
"^DD",798.1,798.13,.01,21,6,0)
registry. The name should be entered exactly as it
"^DD",798.1,798.13,.01,21,7,0)
appears in the list of selection rules (file 
"^DD",798.1,798.13,.01,21,8,0)
#798.2).
"^DD",798.1,798.13,.01,23,0)
^.001^3^3^3140228^^^^
"^DD",798.1,798.13,.01,23,1,0)
Names of the selection rules are used here instead of 
"^DD",798.1,798.13,.01,23,2,0)
pointers because the KIDS pointer resolving feature 
"^DD",798.1,798.13,.01,23,3,0)
does not work for .01 fields.
"^DD",798.1,798.13,.01,"DEL",1,0)
I $$VADEL^RORDD(798.1,$G(DA(1)))
"^DD",798.1,798.13,.01,"DT")
3140228
"^DD",798.1,798.15,0)
DESCRIPTION SUB-FIELD^^.01^1
"^DD",798.1,798.15,0,"NM","DESCRIPTION")
 
"^DD",798.1,798.15,0,"UP")
798.1
"^DD",798.1,798.15,.01,0)
DESCRIPTION^W^^0;1^Q
"^DD",798.1,798.15,.01,"DT")
3000313
"^DD",798.2,798.2,0)
FIELD^^6^8
"^DD",798.2,798.2,0,"DDA")
N
"^DD",798.2,798.2,0,"DT")
3150423
"^DD",798.2,798.2,0,"ID","WRITE")
D EN^DDIOL("  "_$P($G(^(0)),U,3),,"?30")
"^DD",798.2,798.2,0,"NM","ROR SELECTION RULE")

"^DD",798.2,798.2,0,"PT",798.01,.01)

"^DD",798.2,798.2,0,"VRPK")
ROR
"^DD",798.2,798.2,.01,0)
RULE NAME^FX^^0;1^Q:$$VAEDT^RORDD(798.2,$G(DA))  K:$L(X)>40!($L(X)<3)!'(X?1.UNP) X
"^DD",798.2,798.2,.01,1,0)
^.1^^0
"^DD",798.2,798.2,.01,3)
Enter a unique namespaced rule name (3-40 characters).
"^DD",798.2,798.2,.01,8.5)
@
"^DD",798.2,798.2,.01,9)
@
"^DD",798.2,798.2,.01,21,0)
^.001^6^6^3140310^^^
"^DD",798.2,798.2,.01,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS A PART OF
"^DD",798.2,798.2,.01,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",798.2,798.2,.01,21,3,0)
 
"^DD",798.2,798.2,.01,21,4,0)
Selection rule name must be unique and name 
"^DD",798.2,798.2,.01,21,5,0)
spaced. Names of the rules that are used for
"^DD",798.2,798.2,.01,21,6,0)
National Registries must start with "VA".
"^DD",798.2,798.2,.01,"DEL",1,0)
I $$VADEL^RORDD(798.2,$G(DA))
"^DD",798.2,798.2,.01,"DT")
3140228
"^DD",798.2,798.2,.09,0)
NATIONAL^SX^0:NO;1:YES;^0;4^Q:$$VAEDT^RORDD(798.2,,-1)
"^DD",798.2,798.2,.09,1,0)
^.1^^0
"^DD",798.2,798.2,.09,3)
Enter 1 or YES if this rule is for a national registry.
"^DD",798.2,798.2,.09,8.5)
@
"^DD",798.2,798.2,.09,9)
@
"^DD",798.2,798.2,.09,21,0)
^.001^6^6^3150528^^
"^DD",798.2,798.2,.09,21,1,0)
ONLY AUTHORIZED NATIONAL REGISTRY DEVELOPERS CAN
"^DD",798.2,798.2,.09,21,2,0)
EDIT THIS FIELD!
"^DD",798.2,798.2,.09,21,3,0)
 
"^DD",798.2,798.2,.09,21,4,0)
Selection rules of the national registries must
"^DD",798.2,798.2,.09,21,5,0)
have this field set to "YES". This prevents local
"^DD",798.2,798.2,.09,21,6,0)
editing of other fields of rule definitions.
"^DD",798.2,798.2,.09,"DEL",1,0)
I $$VADEL^RORDD(798.2,,-1)
"^DD",798.2,798.2,.09,"DT")
3011121
"^DD",798.2,798.2,1,0)
EXPRESSION^RFX^^1;E1,245^Q:$$VAEDT^RORDD(798.2,$G(DA))  K:$L(X)>250!($L(X)<1) X I $D(X) Q:$$EXPR^RORDD($P($G(^ROR(798.2,DA,0)),U,2))
"^DD",798.2,798.2,1,3)
Enter M expression that implements the selection rule (1-250 characters).
"^DD",798.2,798.2,1,8.5)
@
"^DD",798.2,798.2,1,9)
@
"^DD",798.2,798.2,1,21,0)
^^5^5^3011010^
"^DD",798.2,798.2,1,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS A PART OF
"^DD",798.2,798.2,1,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",798.2,798.2,1,21,3,0)
 
"^DD",798.2,798.2,1,21,4,0)
Enter a MUMPS expression (it may contain special
"^DD",798.2,798.2,1,21,5,0)
macros) that implements the selection rule.
"^DD",798.2,798.2,1,23,0)
^^62^62^3060203^
"^DD",798.2,798.2,1,23,1,0)
MUMPS expression that implements the selection rule can
"^DD",798.2,798.2,1,23,2,0)
contain special macros:
"^DD",798.2,798.2,1,23,3,0)
 
"^DD",798.2,798.2,1,23,4,0)
 {E: Field Name} - External value of the field
"^DD",798.2,798.2,1,23,5,0)
 {E: Field Number}
"^DD",798.2,798.2,1,23,6,0)
 
"^DD",798.2,798.2,1,23,7,0)
 {I: Field Name} - Internal value of the field
"^DD",798.2,798.2,1,23,8,0)
 {I: Field Number}
"^DD",798.2,798.2,1,23,9,0)
 
"^DD",798.2,798.2,1,23,10,0)
 {Rule Name} - Result value of the lower level
"^DD",798.2,798.2,1,23,11,0)
selection rule
"^DD",798.2,798.2,1,23,12,0)
 
"^DD",798.2,798.2,1,23,13,0)
 {AVG: Rule Name} - Average value of the rule
"^DD",798.2,798.2,1,23,14,0)
 
"^DD",798.2,798.2,1,23,15,0)
 {CNT: Rule Name} - Number of calculations of the rule
"^DD",798.2,798.2,1,23,16,0)
 
"^DD",798.2,798.2,1,23,17,0)
 {MAX: Rule Name} - Maximum value of the rule
"^DD",798.2,798.2,1,23,18,0)
 
"^DD",798.2,798.2,1,23,19,0)
 {MIN: Rule Name} - Minimum value of the rule
"^DD",798.2,798.2,1,23,20,0)
 
"^DD",798.2,798.2,1,23,21,0)
 {SUM: Rule Name} - Total of the selection rule values
"^DD",798.2,798.2,1,23,22,0)
 
"^DD",798.2,798.2,1,23,23,0)
 {LS: Lab Search Name} - This macro can be used only in
"^DD",798.2,798.2,1,23,24,0)
the selection rules associated with the LAB DATA file
"^DD",798.2,798.2,1,23,25,0)
(#63). It is evaluated as 1 if some of the patient
"^DD",798.2,798.2,1,23,26,0)
lab results pass the Lab search criteria (from the file
"^DD",798.2,798.2,1,23,27,0)
#798.9). Otherwise, it is evaluated as zero.
"^DD",798.2,798.2,1,23,28,0)
 
"^DD",798.2,798.2,1,23,29,0)
Return values of the top-level rules:
"^DD",798.2,798.2,1,23,30,0)
 
"^DD",798.2,798.2,1,23,31,0)
 0        - Skip the patient
"^DD",798.2,798.2,1,23,32,0)
 Non-zero - Add the patient to the registry
"^DD",798.2,798.2,1,23,33,0)
 
"^DD",798.2,798.2,1,23,34,0)
Return values of the lower level rules:
"^DD",798.2,798.2,1,23,35,0)
 
"^DD",798.2,798.2,1,23,36,0)
Return values can be used in the expressions of the
"^DD",798.2,798.2,1,23,37,0)
other rules. Some additional values are calculated
"^DD",798.2,798.2,1,23,38,0)
automatically (minimum, maximum, average, etc.) for
"^DD",798.2,798.2,1,23,39,0)
each rule.
"^DD",798.2,798.2,1,23,40,0)
 
"^DD",798.2,798.2,1,23,41,0)
Avoid circular references in the expressions. If a 
"^DD",798.2,798.2,1,23,42,0)
rule directly or indirectly depends on itself, it
"^DD",798.2,798.2,1,23,43,0)
cannot be evaluated. An example of the circular
"^DD",798.2,798.2,1,23,44,0)
reference:
"^DD",798.2,798.2,1,23,45,0)
 
"^DD",798.2,798.2,1,23,46,0)
 Rule A: {MAX:B}<10
"^DD",798.2,798.2,1,23,47,0)
 Rule B: {I:23}+{C}
"^DD",798.2,798.2,1,23,48,0)
 Rule C: {CNT:A}
"^DD",798.2,798.2,1,23,49,0)
 
"^DD",798.2,798.2,1,23,50,0)
The rule A cannot be evaluated because it depends on 
"^DD",798.2,798.2,1,23,51,0)
the rule B, which depends on rule C, and C depends on
"^DD",798.2,798.2,1,23,52,0)
A.
"^DD",798.2,798.2,1,23,53,0)
 
"^DD",798.2,798.2,1,23,54,0)
Complex selection rules could be implemented by 
"^DD",798.2,798.2,1,23,55,0)
external MUMPS functions. In that case the expression
"^DD",798.2,798.2,1,23,56,0)
should contains a full reference to the function
"^DD",798.2,798.2,1,23,57,0)
($$TAG^ROUTINE). Values of the necessary data elements
"^DD",798.2,798.2,1,23,58,0)
can be loaded automatically (see description of the
"^DD",798.2,798.2,1,23,59,0)
DATA ELEMENT multiple).
"^DD",798.2,798.2,1,23,60,0)
 
"^DD",798.2,798.2,1,23,61,0)
See the Programmer's reference manual for more details 
"^DD",798.2,798.2,1,23,62,0)
regarding the selection rule expressions.
"^DD",798.2,798.2,1,"DEL",1,0)
I $$VADEL^RORDD(798.2,$G(DA))
"^DD",798.2,798.2,1,"DT")
3011109
"^DD",798.2,798.2,2,0)
FILE^RNJ22,9X^^0;2^Q:$$VAEDT^RORDD(798.2,$G(DA))  K:+X'=X!(X>999999999999)!(X<1)!(X?.E1"."10N.N) X I $D(X) K:'$$VFILE^DILFD(X) X
"^DD",798.2,798.2,2,3)
Enter (sub)file number between 1 and 999999999999, 9 Decimal Digits.
"^DD",798.2,798.2,2,8.5)
@
"^DD",798.2,798.2,2,9)
@
"^DD",798.2,798.2,2,21,0)
^.001^6^6^3020403^^
"^DD",798.2,798.2,2,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS A PART OF
"^DD",798.2,798.2,2,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",798.2,798.2,2,21,3,0)
 
"^DD",798.2,798.2,2,21,4,0)
Enter a file/sub-file number that the selection 
"^DD",798.2,798.2,2,21,5,0)
rule is associated with. Each selection rule can
"^DD",798.2,798.2,2,21,6,0)
be associated with only one file.
"^DD",798.2,798.2,2,"DEL",1,0)
I $$VADEL^RORDD(798.2,$G(DA))
"^DD",798.2,798.2,2,"DT")
3011109
"^DD",798.2,798.2,4,0)
SHORT DESCRIPTION^FX^^0;3^Q:$$VAEDT^RORDD(798.2,$G(DA))  K:$L(X)>30!($L(X)<3) X
"^DD",798.2,798.2,4,3)
Enter a short description of the selection rule (3-30 characters).
"^DD",798.2,798.2,4,8.5)
@
"^DD",798.2,798.2,4,9)
@
"^DD",798.2,798.2,4,21,0)
^^5^5^3020403^
"^DD",798.2,798.2,4,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS A PART OF
"^DD",798.2,798.2,4,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",798.2,798.2,4,21,3,0)
 
"^DD",798.2,798.2,4,21,4,0)
The short description of the selection rule is 
"^DD",798.2,798.2,4,21,5,0)
used in the reports and GUI dialogs.
"^DD",798.2,798.2,4,"DEL",1,0)
I $$VADEL^RORDD(798.2,$G(DA))
"^DD",798.2,798.2,4,"DT")
3011109
"^DD",798.2,798.2,5,0)
DESCRIPTION^798.25^^3;0
"^DD",798.2,798.2,5,21,0)
^^3^3^3150528^^
"^DD",798.2,798.2,5,21,1,0)
You can enter any additional reference information
"^DD",798.2,798.2,5,21,2,0)
related to the selection rule. The content of this
"^DD",798.2,798.2,5,21,3,0)
field is not used by the application.
"^DD",798.2,798.2,6,0)
DATA ELEMENT^798.26^^4;0
"^DD",798.2,798.2,6,9)
@
"^DD",798.2,798.2,6,21,0)
^.001^12^12^3060203^^
"^DD",798.2,798.2,6,21,1,0)
The DATA ELEMENT multiple contains a list of 
"^DD",798.2,798.2,6,21,2,0)
additional data elements to load. 
"^DD",798.2,798.2,6,21,3,0)
 
"^DD",798.2,798.2,6,21,4,0)
Values of all the data elements referenced in the
"^DD",798.2,798.2,6,21,5,0)
selection rule expression are loaded
"^DD",798.2,798.2,6,21,6,0)
automatically.
"^DD",798.2,798.2,6,21,7,0)
 
"^DD",798.2,798.2,6,21,8,0)
However, if the rule is implemented by an external
"^DD",798.2,798.2,6,21,9,0)
function, you can enter the codes of all necessary
"^DD",798.2,798.2,6,21,10,0)
data elements into this multiple. Their values
"^DD",798.2,798.2,6,21,11,0)
will be loaded automatically and will be
"^DD",798.2,798.2,6,21,12,0)
accessible in the function.
"^DD",798.2,798.2,6,"DT")
3020326
"^DD",798.2,798.2,7,0)
CODING SYSTEM^*P80.4'^ICDS(^5;1^S DIC("S")="I $$FILE^ICDEX(+Y)=80!($$FILE^ICDEX(+Y)=80.1)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",798.2,798.2,7,3)
Select a coding system.
"^DD",798.2,798.2,7,12)
The screen limits the coding system to those allowed in files 80 and 80.1
"^DD",798.2,798.2,7,12.1)
S DIC("S")="I $$FILE^ICDEX(+Y)=80!($$FILE^ICDEX(+Y)=80.1)"
"^DD",798.2,798.2,7,21,0)
^.001^1^1^3150423^^^^
"^DD",798.2,798.2,7,21,1,0)
This is the coding system to which the code belongs.
"^DD",798.2,798.2,7,"DT")
3150423
"^DD",798.2,798.25,0)
DESCRIPTION SUB-FIELD^^.01^1
"^DD",798.2,798.25,0,"NM","DESCRIPTION")

"^DD",798.2,798.25,0,"UP")
798.2
"^DD",798.2,798.25,.01,0)
DESCRIPTION^W^^0;1^Q
"^DD",798.2,798.25,.01,3)
Enter any additional text here to describe the rule.
"^DD",798.2,798.25,.01,21,0)
^^2^2^3150528^
"^DD",798.2,798.25,.01,21,1,0)
This field can contain any additional information needed to describe
"^DD",798.2,798.25,.01,21,2,0)
unique characteristics of this rule.
"^DD",798.2,798.25,.01,"DT")
3150528
"^DD",798.2,798.26,0)
DATA ELEMENT SUB-FIELD^^1^2
"^DD",798.2,798.26,0,"DT")
3020326
"^DD",798.2,798.26,0,"NM","DATA ELEMENT")

"^DD",798.2,798.26,0,"UP")
798.2
"^DD",798.2,798.26,.01,0)
ELEMENT CODE^MNJ9,0X^^0;1^Q:$$VAEDT^RORDD(798.2,$G(DA(1)))  K:+X'=X!(X>999999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",798.2,798.26,.01,1,0)
^.1^^0
"^DD",798.2,798.26,.01,3)
Type a Number between 1 and 999999999, 0 Decimal Digits.
"^DD",798.2,798.26,.01,8.5)
@
"^DD",798.2,798.26,.01,9)
@
"^DD",798.2,798.26,.01,21,0)
^^8^8^3020328^
"^DD",798.2,798.26,.01,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS A PART OF
"^DD",798.2,798.26,.01,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",798.2,798.26,.01,21,3,0)
 
"^DD",798.2,798.26,.01,21,4,0)
Enter the code of the data element that should be 
"^DD",798.2,798.26,.01,21,5,0)
loaded before evaluation of the expression. Values
"^DD",798.2,798.26,.01,21,6,0)
of all data elements referenced in the selection
"^DD",798.2,798.26,.01,21,7,0)
rule expression are loaded automatically (you do
"^DD",798.2,798.26,.01,21,8,0)
not need to enter them here).
"^DD",798.2,798.26,.01,"DEL",1,0)
I $$VADEL^RORDD(798.2,$G(DA(1)))
"^DD",798.2,798.26,.01,"DT")
3020326
"^DD",798.2,798.26,1,0)
VALUE TYPE^RSX^E:External;I:Internal;EI:Both;^0;2^Q:$$VAEDT^RORDD(798.2,$G(DA(1)))
"^DD",798.2,798.26,1,3)
Enter a value type to describe the retrieval format of the data element.
"^DD",798.2,798.26,1,8.5)
@
"^DD",798.2,798.26,1,9)
@
"^DD",798.2,798.26,1,21,0)
^.001^3^3^3150528^^
"^DD",798.2,798.26,1,21,1,0)
This field holds required value type(s) of the
"^DD",798.2,798.26,1,21,2,0)
data element. The type(s) must be supported by the
"^DD",798.2,798.26,1,21,3,0)
search engine.
"^DD",798.2,798.26,1,"DT")
3020311
"^DD",798.5,798.5,0)
FIELD^^3^4
"^DD",798.5,798.5,0,"DDA")
N
"^DD",798.5,798.5,0,"DT")
3150409
"^DD",798.5,798.5,0,"IX","B",798.5,.01)

"^DD",798.5,798.5,0,"NM","ROR ICD SEARCH")

"^DD",798.5,798.5,0,"VRPK")
ROR
"^DD",798.5,798.5,.01,0)
REGISTRY^RP798.1'X^ROR(798.1,^0;1^Q
"^DD",798.5,798.5,.01,1,0)
^.1
"^DD",798.5,798.5,.01,1,1,0)
798.5^B
"^DD",798.5,798.5,.01,1,1,1)
S ^ROR(798.5,"B",$E(X,1,30),DA)=""
"^DD",798.5,798.5,.01,1,1,2)
K ^ROR(798.5,"B",$E(X,1,30),DA)
"^DD",798.5,798.5,.01,3)
Enter a registry from the ROR REGISTRY PARAMETERS file.
"^DD",798.5,798.5,.01,21,0)
^^5^5^3120323^
"^DD",798.5,798.5,.01,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS PART OF A NATIONAL REGISTRY 
"^DD",798.5,798.5,.01,21,2,0)
DEFINITION.
"^DD",798.5,798.5,.01,21,3,0)
 
"^DD",798.5,798.5,.01,21,4,0)
The ICD codes defined for this registry will be used to select qualified 
"^DD",798.5,798.5,.01,21,5,0)
patients.
"^DD",798.5,798.5,.01,"DEL",1,0)
I $$VADEL^RORDD(798.5,$G(DA),.01)
"^DD",798.5,798.5,.01,"DT")
3140729
"^DD",798.5,798.5,1,0)
ICD CODE^798.51P^^1;0
"^DD",798.5,798.5,1,21,0)
^.001^4^4^3150528^^^^
"^DD",798.5,798.5,1,21,1,0)
This multiple contains a list of ICD codes in the ICD DIAGNOSIS
"^DD",798.5,798.5,1,21,2,0)
file (#80).  Selection rules for a registry use these codes to find
"^DD",798.5,798.5,1,21,3,0)
new registry patients during the registry update process.
"^DD",798.5,798.5,1,21,4,0)
  
"^DD",798.5,798.5,2,0)
ICD PROCEDURE CODE^798.52P^^2;0
"^DD",798.5,798.5,2,21,0)
^.001^3^3^3150528^^^^
"^DD",798.5,798.5,2,21,1,0)
This multiple contains a list of ICD codes in the ICD OPERATION/PROCEDURE
"^DD",798.5,798.5,2,21,2,0)
file (#80.1).  Selection rules for a registry use these codes to find
"^DD",798.5,798.5,2,21,3,0)
new registry patients during the registry update process.
"^DD",798.5,798.5,3,0)
INPATIENT CPT CODE^798.53P^^3;0
"^DD",798.5,798.5,3,21,0)
^^3^3^3150528^
"^DD",798.5,798.5,3,21,1,0)
This multiple contains a list of CPT codes in the CPT
"^DD",798.5,798.5,3,21,2,0)
file (#81).  Selection rules for a registry use these codes to find
"^DD",798.5,798.5,3,21,3,0)
new registry patients during the registry update process.
"^DD",798.5,798.51,0)
ICD CODE SUB-FIELD^^.01^1
"^DD",798.5,798.51,0,"DT")
3120223
"^DD",798.5,798.51,0,"IX","B",798.51,.01)

"^DD",798.5,798.51,0,"NM","ICD CODE")
 
"^DD",798.5,798.51,0,"UP")
798.5
"^DD",798.5,798.51,.01,0)
ICD CODE^MP80'^ICD9(^0;1^Q
"^DD",798.5,798.51,.01,1,0)
^.1
"^DD",798.5,798.51,.01,1,1,0)
798.51^B
"^DD",798.5,798.51,.01,1,1,1)
S ^ROR(798.5,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",798.5,798.51,.01,1,1,2)
K ^ROR(798.5,DA(1),1,"B",$E(X,1,30),DA)
"^DD",798.5,798.51,.01,3)
Enter an ICD code.
"^DD",798.5,798.51,.01,21,0)
^.001^1^1^3120416^^^^
"^DD",798.5,798.51,.01,21,1,0)
The ICD diagnosis code is used to qualify a patient for the registry.
"^DD",798.5,798.51,.01,"DT")
3120328
"^DD",798.5,798.52,0)
ICD PROCEDURE CODE SUB-FIELD^^.01^1
"^DD",798.5,798.52,0,"DT")
3150409
"^DD",798.5,798.52,0,"IX","B",798.52,.01)

"^DD",798.5,798.52,0,"NM","ICD PROCEDURE CODE")

"^DD",798.5,798.52,0,"UP")
798.5
"^DD",798.5,798.52,.01,0)
ICD PROCEDURE CODE^MP80.1'^ICD0(^0;1^Q
"^DD",798.5,798.52,.01,1,0)
^.1
"^DD",798.5,798.52,.01,1,1,0)
798.52^B
"^DD",798.5,798.52,.01,1,1,1)
S ^ROR(798.5,DA(1),2,"B",$E(X,1,30),DA)=""
"^DD",798.5,798.52,.01,1,1,2)
K ^ROR(798.5,DA(1),2,"B",$E(X,1,30),DA)
"^DD",798.5,798.52,.01,3)
Enter an ICD procedure code.
"^DD",798.5,798.52,.01,21,0)
^.001^2^2^3150528^^^^
"^DD",798.5,798.52,.01,21,1,0)
The ICD procedure code is used to qualify a
"^DD",798.5,798.52,.01,21,2,0)
patient for the registry.
"^DD",798.5,798.52,.01,"DT")
3150409
"^DD",798.5,798.53,0)
INPATIENT CPT CODE SUB-FIELD^^.01^1
"^DD",798.5,798.53,0,"DT")
3150409
"^DD",798.5,798.53,0,"IX","B",798.53,.01)

"^DD",798.5,798.53,0,"NM","INPATIENT CPT CODE")

"^DD",798.5,798.53,0,"UP")
798.5
"^DD",798.5,798.53,.01,0)
INPATIENT CPT CODE^MP81'^ICPT(^0;1^Q
"^DD",798.5,798.53,.01,1,0)
^.1
"^DD",798.5,798.53,.01,1,1,0)
798.53^B
"^DD",798.5,798.53,.01,1,1,1)
S ^ROR(798.5,DA(1),3,"B",$E(X,1,30),DA)=""
"^DD",798.5,798.53,.01,1,1,2)
K ^ROR(798.5,DA(1),3,"B",$E(X,1,30),DA)
"^DD",798.5,798.53,.01,3)
Enter a CPT code.
"^DD",798.5,798.53,.01,21,0)
^.001^1^1^3150528^^
"^DD",798.5,798.53,.01,21,1,0)
The INPATIENT CPT procedure code is used to qualify a patient for a registry.
"^DD",798.5,798.53,.01,"DT")
3150409
"^DD",799.31,799.31,0)
FIELD^^.01^1
"^DD",799.31,799.31,0,"DDA")
N
"^DD",799.31,799.31,0,"DT")
3021130
"^DD",799.31,799.31,0,"NM","ROR XML ITEM")

"^DD",799.31,799.31,0,"PT",798.87,.01)

"^DD",799.31,799.31,0,"PT",798.872,.01)

"^DD",799.31,799.31,0,"VRPK")
ROR
"^DD",799.31,799.31,0,"VRRV")
1.5^ROR 1.5
"^DD",799.31,799.31,.01,0)
NAME^RFX^^0;1^Q:$$VAEDT^RORDD(799.31,,-1)  K:$L(X)>30!($L(X)<2)!'(X'?1P.E) X
"^DD",799.31,799.31,.01,1,0)
^.1^^0
"^DD",799.31,799.31,.01,3)
Enter the tag name (2-30 characters).
"^DD",799.31,799.31,.01,8.5)
@
"^DD",799.31,799.31,.01,9)
@
"^DD",799.31,799.31,.01,21,0)
^.001^4^4^3030506^^
"^DD",799.31,799.31,.01,21,1,0)
This field stores the tag name. The name should 
"^DD",799.31,799.31,.01,21,2,0)
not contain spaces and any punctuation marks 
"^DD",799.31,799.31,.01,21,3,0)
except underscore. See an XML reference guide for
"^DD",799.31,799.31,.01,21,4,0)
more details.
"^DD",799.31,799.31,.01,23,0)
^^4^4^3060203^
"^DD",799.31,799.31,.01,23,1,0)
Please use shorter names for tags that will be used
"^DD",799.31,799.31,.01,23,2,0)
more often and/or will be repeated many times in the
"^DD",799.31,799.31,.01,23,3,0)
report. This will decrease amount of the overhead data
"^DD",799.31,799.31,.01,23,4,0)
transmitted from the server to the GUI.
"^DD",799.31,799.31,.01,"DEL",1,0)
I $$VADEL^RORDD(799.31,,-1)
"^DD",799.31,799.31,.01,"DT")
3050722
"^DD",799.51,799.51,0)
FIELD^^.09^5
"^DD",799.51,799.51,0,"DDA")
N
"^DD",799.51,799.51,0,"DT")
3040114
"^DD",799.51,799.51,0,"IX","AR",799.51,.02)

"^DD",799.51,799.51,0,"IX","B",799.51,.01)

"^DD",799.51,799.51,0,"NM","ROR GENERIC DRUG")

"^DD",799.51,799.51,0,"VRPK")
ROR
"^DD",799.51,799.51,0,"VRRV")
1.1^ROR*1*5
"^DD",799.51,799.51,.01,0)
NAME^RFX^^0;1^Q:$$VAEDT^RORDD(799.51,$G(DA))  K:$L(X)>30!(X?.N)!($L(X)<3)!'(X'?1P.E) X
"^DD",799.51,799.51,.01,1,0)
^.1
"^DD",799.51,799.51,.01,1,1,0)
799.51^B
"^DD",799.51,799.51,.01,1,1,1)
S ^ROR(799.51,"B",$E(X,1,30),DA)=""
"^DD",799.51,799.51,.01,1,1,2)
K ^ROR(799.51,"B",$E(X,1,30),DA)
"^DD",799.51,799.51,.01,1,1,3)
Do not delete!
"^DD",799.51,799.51,.01,3)
Name must be 3-30 characters, not numeric or starting with punctuation.
"^DD",799.51,799.51,.01,8.5)
@
"^DD",799.51,799.51,.01,9)
@
"^DD",799.51,799.51,.01,21,0)
^.001^4^4^3040124^^^
"^DD",799.51,799.51,.01,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS A PART OF 
"^DD",799.51,799.51,.01,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",799.51,799.51,.01,21,3,0)
 
"^DD",799.51,799.51,.01,21,4,0)
The NAME field stores a short name of the drug.
"^DD",799.51,799.51,.01,"DEL",1,0)
I $$VADEL^RORDD(799.51,$G(DA))
"^DD",799.51,799.51,.02,0)
REGISTRY^RP798.1'X^ROR(798.1,^0;2^Q:$$VAEDT^RORDD(799.51,$G(DA))
"^DD",799.51,799.51,.02,1,0)
^.1
"^DD",799.51,799.51,.02,1,1,0)
799.51^AR
"^DD",799.51,799.51,.02,1,1,1)
S ^ROR(799.51,"AR",$E(X,1,30),DA)=""
"^DD",799.51,799.51,.02,1,1,2)
K ^ROR(799.51,"AR",$E(X,1,30),DA)
"^DD",799.51,799.51,.02,1,1,3)
Do not delete!
"^DD",799.51,799.51,.02,1,1,"%D",0)
^^2^2^3040124^
"^DD",799.51,799.51,.02,1,1,"%D",1,0)
This cross-reference groups all drugs associated
"^DD",799.51,799.51,.02,1,1,"%D",2,0)
with a particular registry together.
"^DD",799.51,799.51,.02,1,1,"DT")
3030818
"^DD",799.51,799.51,.02,8.5)
@
"^DD",799.51,799.51,.02,9)
@
"^DD",799.51,799.51,.02,21,0)
^^5^5^3040124^
"^DD",799.51,799.51,.02,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS A PART OF 
"^DD",799.51,799.51,.02,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",799.51,799.51,.02,21,3,0)
 
"^DD",799.51,799.51,.02,21,4,0)
This field identifies the registry that the drug 
"^DD",799.51,799.51,.02,21,5,0)
is associated with.
"^DD",799.51,799.51,.02,"DT")
3040114
"^DD",799.51,799.51,.03,0)
DRUG GROUP^R*P799.1'X^ROR(799.1,^0;3^Q:$$VAEDT^RORDD(799.51,$G(DA))  S Y=$P($G(^ROR(799.51,DA,0)),U,2),DIC("S")="S D=$G(^(0)) I $P(D,U,2)=4"_$S(Y>0:",$P(D,U,3)="_Y,1:"") D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",799.51,799.51,.03,3)

"^DD",799.51,799.51,.03,8.5)
@
"^DD",799.51,799.51,.03,9)
@
"^DD",799.51,799.51,.03,12)
Only Drug Groups can be selected.
"^DD",799.51,799.51,.03,12.1)
S DIC("S")="S D=$G(^(0)) I $P(D,U,2)=4"_$S(Y>0:",$P(D,U,3)="_Y,1:"")
"^DD",799.51,799.51,.03,21,0)
^^2^2^3040124^
"^DD",799.51,799.51,.03,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS A PART OF 
"^DD",799.51,799.51,.03,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",799.51,799.51,.03,23,0)
^^2^2^3040124^
"^DD",799.51,799.51,.03,23,1,0)
This field is not used currently. It is reserved for 
"^DD",799.51,799.51,.03,23,2,0)
future use.
"^DD",799.51,799.51,.03,"DT")
3040124
"^DD",799.51,799.51,.04,0)
VA GENERIC^RP50.6'X^PSNDF(50.6,^0;4^Q:$$VAEDT^RORDD(799.51,$G(DA))
"^DD",799.51,799.51,.04,8.5)
@
"^DD",799.51,799.51,.04,9)
@
"^DD",799.51,799.51,.04,21,0)
^^2^2^3040124^
"^DD",799.51,799.51,.04,21,1,0)
YOU MUST NOT EDIT THIS FIELD IF IT IS A PART OF 
"^DD",799.51,799.51,.04,21,2,0)
NATIONAL REGISTRY DEFINITION!
"^DD",799.51,799.51,.04,"DT")
3040114
"^DD",799.51,799.51,.09,0)
NATIONAL^SX^0:NO;1:YES;^0;9^Q:$$VAEDT^RORDD(799.51,,-1)
"^DD",799.51,799.51,.09,8.5)
@
"^DD",799.51,799.51,.09,9)
@
"^DD",799.51,799.51,.09,21,0)
^^6^6^3060203^
"^DD",799.51,799.51,.09,21,1,0)
ONLY AUTHORIZED NATIONAL REGISTRY DEVELOPERS CAN
"^DD",799.51,799.51,.09,21,2,0)
EDIT THIS FIELD!
"^DD",799.51,799.51,.09,21,3,0)
 
"^DD",799.51,799.51,.09,21,4,0)
Drugs associated with the national registries must
"^DD",799.51,799.51,.09,21,5,0)
have this field set to "YES". This prevents local
"^DD",799.51,799.51,.09,21,6,0)
editing of other fields of the record.
"^DD",799.51,799.51,.09,"DEL",1,0)
I $$VADEL^RORDD(799.51,,-1)
"^DD",799.51,799.51,.09,"DT")
3030818
"^DIC",798.1,798.1,0)
ROR REGISTRY PARAMETERS^798.1
"^DIC",798.1,798.1,0,"GL")
^ROR(798.1,
"^DIC",798.1,798.1,"%",0)
^1.005^^0
"^DIC",798.1,798.1,"%D",0)
^^22^22^3060203^
"^DIC",798.1,798.1,"%D",1,0)
Records of the ROR REGISTRY PARAMETERS file 
"^DIC",798.1,798.1,"%D",2,0)
contain various registry parameters and the data
"^DIC",798.1,798.1,"%D",3,0)
that indicates current registry state. Every 
"^DIC",798.1,798.1,"%D",4,0)
registry must have a record in this file.
"^DIC",798.1,798.1,"%D",5,0)
 
"^DIC",798.1,798.1,"%D",6,0)
Records of the file are uniquely identified by the
"^DIC",798.1,798.1,"%D",7,0)
registry name (the "A" primary key and the
"^DIC",798.1,798.1,"%D",8,0)
uniqueness index "B" are used for that purpose).
"^DIC",798.1,798.1,"%D",9,0)
 
"^DIC",798.1,798.1,"%D",10,0)
A permanent screen (the ^DD(798.1,0,"SCR") node) 
"^DIC",798.1,798.1,"%D",11,0)
restricts access to records of this file. Users
"^DIC",798.1,798.1,"%D",12,0)
can only access records of those registries that
"^DIC",798.1,798.1,"%D",13,0)
they have the security key(s) for. Users with the
"^DIC",798.1,798.1,"%D",14,0)
ROR VA IRM security key can access all records of
"^DIC",798.1,798.1,"%D",15,0)
the file.
"^DIC",798.1,798.1,"%D",16,0)
 
"^DIC",798.1,798.1,"%D",17,0)
If you want the changes in the security keys 
"^DIC",798.1,798.1,"%D",18,0)
allocation to have an effect immediately, you
"^DIC",798.1,798.1,"%D",19,0)
should rebuild the "ACL" cross-reference of the
"^DIC",798.1,798.1,"%D",20,0)
.01 field of the SECURITY KEY multiple of this
"^DIC",798.1,798.1,"%D",21,0)
file. See the description of the cross-reference
"^DIC",798.1,798.1,"%D",22,0)
for more details.
"^DIC",798.1,"B","ROR REGISTRY PARAMETERS",798.1)

"^DIC",798.2,798.2,0)
ROR SELECTION RULE^798.2
"^DIC",798.2,798.2,0,"GL")
^ROR(798.2,
"^DIC",798.2,798.2,"%",0)
^1.005^^0
"^DIC",798.2,798.2,"%D",0)
^^30^30^3020403^
"^DIC",798.2,798.2,"%D",1,0)
The ROR SELECTION RULES file contains definitions
"^DIC",798.2,798.2,"%D",2,0)
of the selection rules that are used to screen
"^DIC",798.2,798.2,"%D",3,0)
patients for addition to the registries. There are
"^DIC",798.2,798.2,"%D",4,0)
two kinds of rules: top-level and lower level.
"^DIC",798.2,798.2,"%D",5,0)
 
"^DIC",798.2,798.2,"%D",6,0)
If a rule is referenced by the ROR REGISTRY 
"^DIC",798.2,798.2,"%D",7,0)
PARAMETERS file, it is the top-level rule.
"^DIC",798.2,798.2,"%D",8,0)
Non-zero value of any top-level rule expression 
"^DIC",798.2,798.2,"%D",9,0)
directly determines that the patient should be
"^DIC",798.2,798.2,"%D",10,0)
added to the corresponding registry.
"^DIC",798.2,798.2,"%D",11,0)
 
"^DIC",798.2,798.2,"%D",12,0)
Lower level rules are referenced only by other 
"^DIC",798.2,798.2,"%D",13,0)
rules (by rule macros in the expressions). Their
"^DIC",798.2,798.2,"%D",14,0)
expressions are evaluated in the proper order, and
"^DIC",798.2,798.2,"%D",15,0)
the result values are used in the expressions of 
"^DIC",798.2,798.2,"%D",16,0)
other rules. Lower level rules have an indirect
"^DIC",798.2,798.2,"%D",17,0)
impact on the final result and can be used for
"^DIC",798.2,798.2,"%D",18,0)
complex processing of linked files and multiples.
"^DIC",798.2,798.2,"%D",19,0)
 
"^DIC",798.2,798.2,"%D",20,0)
For example, a lower level rule can calculate 
"^DIC",798.2,798.2,"%D",21,0)
maximum and minimum values of a parameter in the
"^DIC",798.2,798.2,"%D",22,0)
sub-file, and a top-level rule will analyze these
"^DIC",798.2,798.2,"%D",23,0)
values and decide if the patient should be added 
"^DIC",798.2,798.2,"%D",24,0)
to the registry. Moreover, they could be used to
"^DIC",798.2,798.2,"%D",25,0)
split a very complex rule into several simpler
"^DIC",798.2,798.2,"%D",26,0)
rules.
"^DIC",798.2,798.2,"%D",27,0)
 
"^DIC",798.2,798.2,"%D",28,0)
Records of the file are uniquely identified by the
"^DIC",798.2,798.2,"%D",29,0)
rule name (the "A" primary key and the uniqueness
"^DIC",798.2,798.2,"%D",30,0)
index "B" are used for this purpose).
"^DIC",798.2,"B","ROR SELECTION RULE",798.2)

"^DIC",798.5,798.5,0)
ROR ICD SEARCH^798.5
"^DIC",798.5,798.5,0,"GL")
^ROR(798.5,
"^DIC",798.5,798.5,"%",0)
^1.005^^0
"^DIC",798.5,798.5,"%D",0)
^1.001^7^7^3150528^^^
"^DIC",798.5,798.5,"%D",1,0)
This file stores all the ICD procedure and diagnostic codes and
"^DIC",798.5,798.5,"%D",2,0)
the CPT codes used to identify patients for a given registry during the
"^DIC",798.5,798.5,"%D",3,0)
Registry Update process. The B cross references for the ICD CODE, ICD
"^DIC",798.5,798.5,"%D",4,0)
PROCEDURE CODE and the INPATIENT CPT CODE are used in the EXPRESSION of the
"^DIC",798.5,798.5,"%D",5,0)
ROR SELECTION RULES file (#798.2).  The file design allows CCR to support
"^DIC",798.5,798.5,"%D",6,0)
an unlimited number of codes selected from the ICD DIAGNOSIS file (#80),
"^DIC",798.5,798.5,"%D",7,0)
the ICD OPERATION/PROCEDURE file (#80.1) and the CPT file (#81).
"^DIC",798.5,"B","ROR ICD SEARCH",798.5)

"^DIC",799.31,799.31,0)
ROR XML ITEM^799.31
"^DIC",799.31,799.31,0,"GL")
^ROR(799.31,
"^DIC",799.31,799.31,"%",0)
^1.005^^0
"^DIC",799.31,799.31,"%D",0)
^^7^7^3040124^
"^DIC",799.31,799.31,"%D",1,0)
THIS FILE MUST NOT BE MODIFIED LOCALLY! ONLY 
"^DIC",799.31,799.31,"%D",2,0)
AUTHORIZED NATIONAL REGISTRY DEVELOPERS CAN EDIT
"^DIC",799.31,799.31,"%D",3,0)
THIS FILE!
"^DIC",799.31,799.31,"%D",4,0)
 
"^DIC",799.31,799.31,"%D",5,0)
The ROR XML ELEMENT file contains a list of XML 
"^DIC",799.31,799.31,"%D",6,0)
tags and attributes that can be used in the 
"^DIC",799.31,799.31,"%D",7,0)
reports.
"^DIC",799.31,"B","ROR XML ITEM",799.31)

"^DIC",799.51,799.51,0)
ROR GENERIC DRUG^799.51
"^DIC",799.51,799.51,0,"GL")
^ROR(799.51,
"^DIC",799.51,799.51,"%",0)
^1.005^^0
"^DIC",799.51,799.51,"%D",0)
^^5^5^3060203^
"^DIC",799.51,799.51,"%D",1,0)
This file contains a list of registry specific
"^DIC",799.51,799.51,"%D",2,0)
generic medications. For example, the ARV 
"^DIC",799.51,799.51,"%D",3,0)
(anti-retroviral) medications associated with the
"^DIC",799.51,799.51,"%D",4,0)
Human Immunodeficiency Virus (HIV) registry are
"^DIC",799.51,799.51,"%D",5,0)
stored here.
"^DIC",799.51,"B","ROR GENERIC DRUG",799.51)

"BLD",10244,6)
^31
**END**
**END**

