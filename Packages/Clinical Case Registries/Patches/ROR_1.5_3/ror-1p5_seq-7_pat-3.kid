Released ROR*1.5*3 SEQ #7
Extracted from mail message
**KIDS**:ROR*1.5*3^

**INSTALL NAME**
ROR*1.5*3
"BLD",6630,0)
ROR*1.5*3^CLINICAL CASE REGISTRIES^0^3080604^y
"BLD",6630,1,0)
^^1^1^3080214^
"BLD",6630,1,1,0)
This build fixes several Clinical Case Registries problems.
"BLD",6630,4,0)
^9.64PA^^0
"BLD",6630,6.3)
7
"BLD",6630,"KRN",0)
^9.67PA^8989.52^19
"BLD",6630,"KRN",.4,0)
.4
"BLD",6630,"KRN",.401,0)
.401
"BLD",6630,"KRN",.402,0)
.402
"BLD",6630,"KRN",.403,0)
.403
"BLD",6630,"KRN",.5,0)
.5
"BLD",6630,"KRN",.84,0)
.84
"BLD",6630,"KRN",.84,"NM",0)
^9.68A^^0
"BLD",6630,"KRN",3.6,0)
3.6
"BLD",6630,"KRN",3.8,0)
3.8
"BLD",6630,"KRN",9.2,0)
9.2
"BLD",6630,"KRN",9.8,0)
9.8
"BLD",6630,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",6630,"KRN",9.8,"NM",1,0)
ROR^^0^B22153387
"BLD",6630,"KRN",9.8,"NM",2,0)
ROR01^^0^B18633
"BLD",6630,"KRN",9.8,"NM",3,0)
RORHL04^^0^B33231243
"BLD",6630,"KRN",9.8,"NM","B","ROR",1)

"BLD",6630,"KRN",9.8,"NM","B","ROR01",2)

"BLD",6630,"KRN",9.8,"NM","B","RORHL04",3)

"BLD",6630,"KRN",19,0)
19
"BLD",6630,"KRN",19,"NM",0)
^9.68A^^0
"BLD",6630,"KRN",19.1,0)
19.1
"BLD",6630,"KRN",101,0)
101
"BLD",6630,"KRN",101,"NM",0)
^9.68A^^0
"BLD",6630,"KRN",409.61,0)
409.61
"BLD",6630,"KRN",771,0)
771
"BLD",6630,"KRN",870,0)
870
"BLD",6630,"KRN",8989.51,0)
8989.51
"BLD",6630,"KRN",8989.52,0)
8989.52
"BLD",6630,"KRN",8994,0)
8994
"BLD",6630,"KRN",8994,"NM",0)
^9.68A^^0
"BLD",6630,"KRN","B",.4,.4)

"BLD",6630,"KRN","B",.401,.401)

"BLD",6630,"KRN","B",.402,.402)

"BLD",6630,"KRN","B",.403,.403)

"BLD",6630,"KRN","B",.5,.5)

"BLD",6630,"KRN","B",.84,.84)

"BLD",6630,"KRN","B",3.6,3.6)

"BLD",6630,"KRN","B",3.8,3.8)

"BLD",6630,"KRN","B",9.2,9.2)

"BLD",6630,"KRN","B",9.8,9.8)

"BLD",6630,"KRN","B",19,19)

"BLD",6630,"KRN","B",19.1,19.1)

"BLD",6630,"KRN","B",101,101)

"BLD",6630,"KRN","B",409.61,409.61)

"BLD",6630,"KRN","B",771,771)

"BLD",6630,"KRN","B",870,870)

"BLD",6630,"KRN","B",8989.51,8989.51)

"BLD",6630,"KRN","B",8989.52,8989.52)

"BLD",6630,"KRN","B",8994,8994)

"BLD",6630,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",6630,"QUES",0)
^9.62^^
"BLD",6630,"REQB",0)
^9.611^1^1
"BLD",6630,"REQB",1,0)
ROR*1.5*2^2
"BLD",6630,"REQB","B","ROR*1.5*2",1)

"MBREQ")
0
"PKG",389,-1)
1^1
"PKG",389,0)
CLINICAL CASE REGISTRIES^ROR^CLINICAL CASE REGISTRIES
"PKG",389,20,0)
^9.402P^^
"PKG",389,22,0)
^9.49I^1^1
"PKG",389,22,1,0)
1.5^3060208^3060221^222222227
"PKG",389,22,1,"PAH",1,0)
3^3080604
"PKG",389,22,1,"PAH",1,1,0)
^^1^1^3080604
"PKG",389,22,1,"PAH",1,1,1,0)
This build fixes several Clinical Case Registries problems.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","ROR")
0^1^B22153387^B21431367
"RTN","ROR",1,0)
ROR ;HCIOFO/SG - CLINICAL CASE REGISTRIES ; 1/26/07 4:54pm
"RTN","ROR",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**1,3**;Feb 17, 2006;Build 7
"RTN","ROR",3,0)
 ;
"RTN","ROR",4,0)
 ; LOCAL VARIABLE ------ DESCRIPTION
"RTN","ROR",5,0)
 ;
"RTN","ROR",6,0)
 ; RORCACHE              In-memory cache
"RTN","ROR",7,0)
 ; RORERRDL              Default error location
"RTN","ROR",8,0)
 ; RORERROR              Error processing data
"RTN","ROR",9,0)
 ; RORPARM               Task-wide constants and variables
"RTN","ROR",10,0)
 ;
"RTN","ROR",11,0)
 ; See the source code of the ^ROR02 routine for more details.
"RTN","ROR",12,0)
 ;
"RTN","ROR",13,0)
 ; ROREXT                Regular data extraction    (See ^ROREXT)
"RTN","ROR",14,0)
 ; RORHDT                Historical data extraction (See ^RORHDT)
"RTN","ROR",15,0)
 ; RORLOG                Log subsystem data         (See ^RORLOG)
"RTN","ROR",16,0)
 ; RORUPD                Registry update parameters (See ^RORUPD)
"RTN","ROR",17,0)
 ;
"RTN","ROR",18,0)
 ; TEMPORARY NODE ------ DESCRIPTION
"RTN","ROR",19,0)
 ;
"RTN","ROR",20,0)
 ; ^TMP("RORHDT")        Control data of historical data extraction
"RTN","ROR",21,0)
 ; ^TMP("RORTMP")        Temporary storage
"RTN","ROR",22,0)
 ; ^TMP("RORUPD")        Registry update temporary data
"RTN","ROR",23,0)
 ;
"RTN","ROR",24,0)
 ; ^TMP(rtn_name)        Temporary storage used by the rtn_name
"RTN","ROR",25,0)
 ;                       routine (mostly, the RPC's)
"RTN","ROR",26,0)
 ;
"RTN","ROR",27,0)
 ; ^TMP($J,"RORTMP-"_)   Generic temporary storage used by ^RORTMP
"RTN","ROR",28,0)
 ;
"RTN","ROR",29,0)
 ; ^XTMP("RORHDT")       Control data of historical data extraction
"RTN","ROR",30,0)
 ; ^XTMP("RORUPDJ")      Registry update temporary data (multitask)
"RTN","ROR",31,0)
 ; ^XTMP("RORUPDR")      Registry update temporary data (installation)
"RTN","ROR",32,0)
 ;
"RTN","ROR",33,0)
 ; See detailed description of the temporary global nodes in
"RTN","ROR",34,0)
 ; the source code of the ^ROR01 routine.
"RTN","ROR",35,0)
 ;
"RTN","ROR",36,0)
 ; NAMESPACE ----------- DESCRIPTION
"RTN","ROR",37,0)
 ;
"RTN","ROR",38,0)
 ; RORAPI*               Supported APIs
"RTN","ROR",39,0)
 ; RORDD*                Routines used by the Data Dictionary
"RTN","ROR",40,0)
 ; RORERR*               Error processing
"RTN","ROR",41,0)
 ; ROREVT*               Event protocols
"RTN","ROR",42,0)
 ; ROREX*                Regular data extraction & transmission
"RTN","ROR",43,0)
 ; RORHDT*               Historical data extraction
"RTN","ROR",44,0)
 ; RORHIV*               HIV registry-specific routines
"RTN","ROR",45,0)
 ; RORHL*                HL7 utilities
"RTN","ROR",46,0)
 ; RORKIDS*              Low-level installation utilities (KIDS)
"RTN","ROR",47,0)
 ; RORLOCK*              Locks and transactions
"RTN","ROR",48,0)
 ; RORLOG*               Error recording
"RTN","ROR",49,0)
 ;
"RTN","ROR",50,0)
 ; RORPnnn*               Patch installation routines (KIDS)
"RTN","ROR",51,0)
 ;                         nnn - patch number
"RTN","ROR",52,0)
 ; RORPUT*               High-level installation utilities
"RTN","ROR",53,0)
 ;
"RTN","ROR",54,0)
 ; RORREP*               Roll-and-scroll reports
"RTN","ROR",55,0)
 ; RORRP*                Remote procedures
"RTN","ROR",56,0)
 ; RORSET*               Registry setup routines
"RTN","ROR",57,0)
 ; RORTXT*               Text resource routines
"RTN","ROR",58,0)
 ; RORUP*                Registry update
"RTN","ROR",59,0)
 ; RORUTL*               Utilities
"RTN","ROR",60,0)
 ; RORVM*                Entry points for VistA menu options
"RTN","ROR",61,0)
 ; RORXnnn*              XML reports (nnn - report code)
"RTN","ROR",62,0)
 ; RORXU*                Utilities for XML reports
"RTN","ROR",63,0)
 ;
"RTN","ROR",64,0)
 ; DIALOG -------------- DESCRIPTION
"RTN","ROR",65,0)
 ;
"RTN","ROR",66,0)
 ; 7980000.*             Various messages and templates
"RTN","ROR",67,0)
 ; 7981???.*             Report templates (XSL)
"RTN","ROR",68,0)
 ;
"RTN","ROR",69,0)
 ; MENU OPTION --------- DESCRIPTION
"RTN","ROR",70,0)
 ;
"RTN","ROR",71,0)
 ; [ROR TASK]            Registry update and data extraction option
"RTN","ROR",72,0)
 ;                       (must be scheduled; do not run it directly)
"RTN","ROR",73,0)
 ; [ROR SETUP]           Registry Setup
"RTN","ROR",74,0)
 ; [RORHDT MAIN]         Historical data extraction menu
"RTN","ROR",75,0)
 ; [RORMNT MAIN]         Maintenance menu
"RTN","ROR",76,0)
 ;
"RTN","ROR",77,0)
 ; SPECIAL ENTRY POINT - DESCRIPTION
"RTN","ROR",78,0)
 ;
"RTN","ROR",79,0)
 ;         ^RORUTL06     Menu for developer's utilities
"RTN","ROR",80,0)
 ; DISTPREP^RORUTL06     Prepares registry for KIDS distribution
"RTN","ROR",81,0)
 ;   PRTMDE^RORUTL06     Prints the data element metadata
"RTN","ROR",82,0)
 ;   VERIFY^RORUTL06     Checks the registry definition
"RTN","ROR",83,0)
 ;
"RTN","ROR",84,0)
 ;  EXTRACT^RORUTL07     Data extraction & transmission in debug mode
"RTN","ROR",85,0)
 ;   UPDATE^RORUTL07     Registry update in debug mode
"RTN","ROR",86,0)
 ;
"RTN","ROR",87,0)
 ; INITIALS ------------ DEVELOPER
"RTN","ROR",88,0)
 ;
"RTN","ROR",89,0)
 ; BH                    Brent Hicks
"RTN","ROR",90,0)
 ; CRT                   Cameron Taylor
"RTN","ROR",91,0)
 ; SG                    Sergey Gavrilov
"RTN","ROR",92,0)
 ;
"RTN","ROR",93,0)
 Q
"RTN","ROR",94,0)
 ;
"RTN","ROR",95,0)
 ;***** RETURNS THE TEST BUILD NUMBER FOR THE DATA EXTRACTION
"RTN","ROR",96,0)
BUILD() ;
"RTN","ROR",97,0)
 Q 1
"RTN","ROR",98,0)
 ;
"RTN","ROR",99,0)
 ;***** REGISTRY UPDATE AND DATA EXTRACTION TASK
"RTN","ROR",100,0)
 ;
"RTN","ROR",101,0)
 ; ZTQPARAM      String that contains a list of registry names
"RTN","ROR",102,0)
 ;               separated by commas. You must define the list as
"RTN","ROR",103,0)
 ;               a value of the TASK PARAMETERS field during
"RTN","ROR",104,0)
 ;               scheduling of the [ROR TASK] option that uses
"RTN","ROR",105,0)
 ;               this entry point.
"RTN","ROR",106,0)
 ;
"RTN","ROR",107,0)
 ; The following task parameters are optional. They can be defined
"RTN","ROR",108,0)
 ; on the second page of the option scheduling form as the pairs of
"RTN","ROR",109,0)
 ; variable names and values. See description of the ROR TASK option
"RTN","ROR",110,0)
 ; for more details regarding these parameters.
"RTN","ROR",111,0)
 ;
"RTN","ROR",112,0)
 ; [RORFLCLR]    Clear flags to control processing (default: "").
"RTN","ROR",113,0)
 ; [RORFLSET]    Set flags to control processing (default: "EX").
"RTN","ROR",114,0)
 ;
"RTN","ROR",115,0)
 ;                 D  Run the task(s) in Debug Mode #1
"RTN","ROR",116,0)
 ;
"RTN","ROR",117,0)
 ;                 E  Use the event references (file #798.3)
"RTN","ROR",118,0)
 ;
"RTN","ROR",119,0)
 ;                 M  Disable data extraction and HL7 messaging
"RTN","ROR",120,0)
 ;
"RTN","ROR",121,0)
 ;                 S  Run the data extraction in single-task mode
"RTN","ROR",122,0)
 ;
"RTN","ROR",123,0)
 ;                 X  Suspend the data extraction task in the
"RTN","ROR",124,0)
 ;                    same way as the registry update
"RTN","ROR",125,0)
 ;
"RTN","ROR",126,0)
 ; [RORMNTSK]    Maximum number of the registry update subtasks.
"RTN","ROR",127,0)
 ;               The default value of the parameter is "2-3-AUTO".
"RTN","ROR",128,0)
 ;
"RTN","ROR",129,0)
 ; [RORSUSP]     Suspension parameters of the registry update and
"RTN","ROR",130,0)
 ;               data extraction subtasks. The subtasks are not
"RTN","ROR",131,0)
 ;               suspended by default.
"RTN","ROR",132,0)
 ;
"RTN","ROR",133,0)
TASK ;
"RTN","ROR",134,0)
 N RORERROR      ; Error processing data
"RTN","ROR",135,0)
 N RORLOG        ; Log subsystem constants & variables
"RTN","ROR",136,0)
 N RORPARM       ; Application parameters
"RTN","ROR",137,0)
 ;
"RTN","ROR",138,0)
 N CNT,FLAGS,I,RC,REGLST,REGNAME,RORERRDL  K ZTREQ
"RTN","ROR",139,0)
 ;--- Initialize constants and variables
"RTN","ROR",140,0)
 D INIT^RORUTL01("ROR",1)
"RTN","ROR",141,0)
 D CLEAR^RORERR("TASK^ROR",1)
"RTN","ROR",142,0)
 ;--- Open a new log
"RTN","ROR",143,0)
 S RC=$$SETUP^RORLOG()
"RTN","ROR",144,0)
 S RC=$$OPEN^RORLOG(,7,"ROR TASK STARTED")
"RTN","ROR",145,0)
 ;
"RTN","ROR",146,0)
 ;--- Check and log the task parameters and force the <UNDEF>
"RTN","ROR",147,0)
 ;--- error in case of a missing/invalid critical value
"RTN","ROR",148,0)
 I $$TASKPRMS^ROR10(.REGLST)<0  K ZTQPARAM  S RC=ZTQPARAM
"RTN","ROR",149,0)
 ;--- Clear/Set the flags (override the default value)
"RTN","ROR",150,0)
 S FLAGS=$TR("EX",RORFLCLR_RORFLSET)_RORFLSET
"RTN","ROR",151,0)
 ;--- Associate the log with the registries
"RTN","ROR",152,0)
 S RC=$$SETRGLST^RORLOG(.REGLST)
"RTN","ROR",153,0)
 ;--- Enable debug mode if requested
"RTN","ROR",154,0)
 S:FLAGS["D" RORPARM("DEBUG")=1
"RTN","ROR",155,0)
 ;
"RTN","ROR",156,0)
 ;--- Rebuild the "ACL" cross-reference
"RTN","ROR",157,0)
 S RC=$$RNDXACL^RORUTL11()
"RTN","ROR",158,0)
 ;--- Remove inactive registries from the list
"RTN","ROR",159,0)
 S RC=$$ARLST^RORUTL02(.REGLST)  G:RC<0 ABORT
"RTN","ROR",160,0)
 ;--- Check the status of last HL7 message(s)
"RTN","ROR",161,0)
 I FLAGS'["M"  D  G:RC<0 ABORT
"RTN","ROR",162,0)
 . S RC=$$CHECKMSG^ROR10(.REGLST)
"RTN","ROR",163,0)
 ;
"RTN","ROR",164,0)
 ;--- Update the registries
"RTN","ROR",165,0)
 S RC=$$UPDATE^RORUPD(.REGLST,RORMNTSK,RORSUSP,FLAGS)
"RTN","ROR",166,0)
 ;--- Process the errors
"RTN","ROR",167,0)
 I RC<0  D  G:RC<0 ABORT
"RTN","ROR",168,0)
 . ;--- Quit if stop is requested (via the TaskMan User option)
"RTN","ROR",169,0)
 . I RC=-42  D ALERT^RORUTL01(.REGLST,-42)  S ZTSTOP=1  Q
"RTN","ROR",170,0)
 . ;--- Do not send the alert for some warnings
"RTN","ROR",171,0)
 . I RC=-28  S RC=0  Q
"RTN","ROR",172,0)
 . ;--- Send the alert in case of other errors/warnings
"RTN","ROR",173,0)
 . D ALERT^RORUTL01(.REGLST,-43,,,,"registry update")
"RTN","ROR",174,0)
 . S RC=0
"RTN","ROR",175,0)
 ;
"RTN","ROR",176,0)
 ;--- Mark registry records 1 month after the installation so that
"RTN","ROR",177,0)
 ;    the local registry data and demographic data will be resent
"RTN","ROR",178,0)
 ;--- to restore the data overwritten with the historical data
"RTN","ROR",179,0)
 S RC=$$REMARK^RORUTL05(.REGLST,31)
"RTN","ROR",180,0)
 ;
"RTN","ROR",181,0)
 ;--- Perform the data extraction
"RTN","ROR",182,0)
 S RC=$S(FLAGS'["M":$$EXTRACT^ROREXT(.REGLST,,RORSUSP,FLAGS),1:0)
"RTN","ROR",183,0)
 ;--- Process the errors
"RTN","ROR",184,0)
 I RC<0  D  G:RC<0 ABORT
"RTN","ROR",185,0)
 . ;--- Quit if stop is requested (via the TaskMan User option)
"RTN","ROR",186,0)
 . I RC=-42  D ALERT^RORUTL01(.REGLST,-42)  S ZTSTOP=1  Q
"RTN","ROR",187,0)
 . ;--- Do not send the alert for some warnings
"RTN","ROR",188,0)
 . I RC=-28  S RC=0  Q
"RTN","ROR",189,0)
 . ;--- Send the alert in case of other errors/warnings
"RTN","ROR",190,0)
 . D ALERT^RORUTL01(.REGLST,-43,,,,"data extraction")
"RTN","ROR",191,0)
 . S RC=0
"RTN","ROR",192,0)
 ;
"RTN","ROR",193,0)
 ;--- Purge the old tasks
"RTN","ROR",194,0)
 S RC=$$PURGE^RORTSK02(14)
"RTN","ROR",195,0)
 ;--- Purge the old logs
"RTN","ROR",196,0)
 S RC=$$PURGE^RORLOG01(31)
"RTN","ROR",197,0)
 ;--- Purge the old event references
"RTN","ROR",198,0)
 S RC=$$EPDATE^RORUTL05()
"RTN","ROR",199,0)
 S:RC>0 RC=$$PURGE^RORUPP02(RC)
"RTN","ROR",200,0)
 ;---
"RTN","ROR",201,0)
 S ZTREQ="@"
"RTN","ROR",202,0)
ABORT ;
"RTN","ROR",203,0)
 S I=$S($G(ZTREQ)="@":"COMPLETED",1:"ABORTED")
"RTN","ROR",204,0)
 D CLOSE^RORLOG("ROR TASK "_I)
"RTN","ROR",205,0)
 Q
"RTN","ROR01")
0^2^B18633^B17051
"RTN","ROR01",1,0)
ROR01 ;HCIOFO/SG - CLINICAL CASE REGISTRIES (TEMP. GLOBALS) ; 4/23/07 3:18pm
"RTN","ROR01",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**1,3**;Feb 17, 2006;Build 7
"RTN","ROR01",3,0)
 ;
"RTN","ROR01",4,0)
 ; ^TMP($J,"RORTMP-"_) - TEMPORARY STORAGE (see the ^RORTMP routine)
"RTN","ROR01",5,0)
 ;
"RTN","ROR01",6,0)
 ; ^TMP($J,"RORTMP-0",   Indexes of allocated buffers
"RTN","ROR01",7,0)
 ;   i)                  ""
"RTN","ROR01",8,0)
 ;
"RTN","ROR01",9,0)
 ; ^TMP($J,"RORTMP-"_i,  Allocated buffers
"RTN","ROR01",10,0)
 ;   ...)
"RTN","ROR01",11,0)
 ;
"RTN","ROR01",12,0)
 ; ^TMP("RORACK") ------ CONTROL DATA OF ACKNOWLEDGEMENT PROCESSING
"RTN","ROR01",13,0)
 ;
"RTN","ROR01",14,0)
 ; ^TMP("RORACK",$J,
"RTN","ROR01",15,0)
 ;   "PR",IEN)           List of IENs of registry records that
"RTN","ROR01",16,0)
 ;                       acknowledgements have been processed for.
"RTN","ROR01",17,0)
 ;
"RTN","ROR01",18,0)
 ; ^TMP("RORHDT") ------ CONTROL DATA OF HISTORICAL DATA EXTRACTION
"RTN","ROR01",19,0)
 ;
"RTN","ROR01",20,0)
 ; ^TMP("RORHDT",$J,
"RTN","ROR01",21,0)
 ;   "PR",               List of IENs of registry records processed
"RTN","ROR01",22,0)
 ;                       in the re-extraction section of function
"RTN","ROR01",23,0)
 ;                       $$EXTRACT^RORHDT04.
"RTN","ROR01",24,0)
 ;     IEN)              Return code of the record processing. If this
"RTN","ROR01",25,0)
 ;                       value is less than zero, data extraction was
"RTN","ROR01",26,0)
 ;                       not successful again.
"RTN","ROR01",27,0)
 ;
"RTN","ROR01",28,0)
 ; ^TMP("RORPTF") ------ TEMPOPARY PTF INDEX FOR DATA EXTRACTION
"RTN","ROR01",29,0)
 ;
"RTN","ROR01",30,0)
 ; ^TMP("RORPTF",$J,
"RTN","ROR01",31,0)
 ;   "DTF",              List of already indexed time frames of
"RTN","ROR01",32,0)
 ;                       the PTF CLOSE OUT file (#45.84).
"RTN","ROR01",33,0)
 ;     StartDate)        StartDate^EndDate
"RTN","ROR01",34,0)
 ;   "PDI",              Temporary PTF index itself
"RTN","ROR01",35,0)
 ;     DFN,PTFIEN)       ""
"RTN","ROR01",36,0)
 ;
"RTN","ROR01",37,0)
 ; ^TMP("RORTMP",$J) --- TEMPORARY STORAGE
"RTN","ROR01",38,0)
 ;
"RTN","ROR01",39,0)
 ; ^TMP("RORUPD") ------ REGISTRY UPDATE TEMPORARY DATA
"RTN","ROR01",40,0)
 ;
"RTN","ROR01",41,0)
 ; ^TMP("RORUPD",$J,
"RTN","ROR01",42,0)
 ;
"RTN","ROR01",43,0)
 ;   1,File#,
"RTN","ROR01",44,0)
 ;     "S",Rule Name)    List of selection rules
"RTN","ROR01",45,0)
 ;     "F",DataCode,     List of data elements to load
"RTN","ROR01",46,0)
 ;       "E")            If expression implementing the selection
"RTN","ROR01",47,0)
 ;                       rule references an external value of the
"RTN","ROR01",48,0)
 ;                       element, the "E" sub-node will be defined.
"RTN","ROR01",49,0)
 ;       "I")            If expression implementing the selection
"RTN","ROR01",50,0)
 ;                       rule references an internal value of the
"RTN","ROR01",51,0)
 ;                       element, the "I" sub-node will be defined.
"RTN","ROR01",52,0)
 ;
"RTN","ROR01",53,0)
 ;   2,Registry#)        Registry Name
"RTN","ROR01",54,0)
 ;
"RTN","ROR01",55,0)
 ;   3,Rule Name,        Selection rule descriptor
"RTN","ROR01",56,0)
 ;                         ^1: Rule#
"RTN","ROR01",57,0)
 ;                         ^2: File Number
"RTN","ROR01",58,0)
 ;                         ^3: 1 if already processed, otherwise
"RTN","ROR01",59,0)
 ;                             empty string
"RTN","ROR01",60,0)
 ;                         ^4: 1 if registry should be updated (in
"RTN","ROR01",61,0)
 ;                             case of matched condition, of course)
"RTN","ROR01",62,0)
 ;     1)                MUMPS function entry point
"RTN","ROR01",63,0)
 ;     2,Registry#)      List of affected registries
"RTN","ROR01",64,0)
 ;     3,Rule Name)      List of rules that this rule depend on
"RTN","ROR01",65,0)
 ;
"RTN","ROR01",66,0)
 ;   4,LabSearch#)       List of Lab search IENs
"RTN","ROR01",67,0)
 ;
"RTN","ROR01",68,0)
 ;   "LS",
"RTN","ROR01",69,0)
 ;     Result Code,
"RTN","ROR01",70,0)
 ;       LabSearch#,
"RTN","ROR01",71,0)
 ;         Seq#)         Condition to check the result
"RTN","ROR01",72,0)
 ;                         ^1: Indicator
"RTN","ROR01",73,0)
 ;                         ^2: Indicated Value
"RTN","ROR01",74,0)
 ;
"RTN","ROR01",75,0)
 ;   "U",Patient#,       This node is defined if the patient has been 
"RTN","ROR01",76,0)
 ;                       processed
"RTN","ROR01",77,0)
 ;     2,Registry#,      This node is defined if the registry should
"RTN","ROR01",78,0)
 ;                       be updated
"RTN","ROR01",79,0)
 ;       Rule#)          Reference to a top-level selection rule
"RTN","ROR01",80,0)
 ;                         ^01: Trigger date of the rule
"RTN","ROR01",81,0)
 ;                         ^02: Institution IEN
"RTN","ROR01",82,0)
 ;
"RTN","ROR01",83,0)
 ; ^XTMP("RORLOCK") ---- LIST OF LOCK DESCRIPTORS
"RTN","ROR01",84,0)
 ;
"RTN","ROR01",85,0)
 ; ^XTMP("RORLOCK",
"RTN","ROR01",86,0)
 ;   NodeNdx)            Lock Descriptor (see ^RORLOCK for details)
"RTN","ROR01",87,0)
 ;                         ^01: Date/Time (FileMan)
"RTN","ROR01",88,0)
 ;                         ^02: User/Process name
"RTN","ROR01",89,0)
 ;                         ^03: User IEN (DUZ)
"RTN","ROR01",90,0)
 ;                         ^04: $JOB
"RTN","ROR01",91,0)
 ;                         ^05: Task number
"RTN","ROR01",92,0)
 ;                         ^06: Lock counter
"RTN","ROR01",93,0)
 ;
"RTN","ROR01",94,0)
 ; ^XTMP("RORTHREAD") -- RPC THREAD DESCRIPTORS
"RTN","ROR01",95,0)
 ;
"RTN","ROR01",96,0)
 ; ^XTMP("RORTHREAD",
"RTN","ROR01",97,0)
 ;
"RTN","ROR01",98,0)
 ;   0)                  Node descriptor
"RTN","ROR01",99,0)
 ;                         ^1: Purge date  (FileMan)
"RTN","ROR01",100,0)
 ;                         ^2: Create date (FileMan)
"RTN","ROR01",101,0)
 ;                         ^3: Description
"RTN","ROR01",102,0)
 ;
"RTN","ROR01",103,0)
 ;   Task#,              Task number returned by the Taskman
"RTN","ROR01",104,0)
 ;     "RESULTS",
"RTN","ROR01",105,0)
 ;       i,              Line of thread results (i>0)
"RTN","ROR01",106,0)
 ;         j)            Continuation of the line (j>0)
"RTN","ROR01",107,0)
 ;
"RTN","ROR01",108,0)
 ; ^XTMP("RORUPD"_) ---- REGISTRY UPDATE TEMPORARY DATA (MULTITASK)
"RTN","ROR01",109,0)
 ;
"RTN","ROR01",110,0)
 ;                       If the registry update starts in the
"RTN","ROR01",111,0)
 ;                       multitask mode, all temporary data from the
"RTN","ROR01",112,0)
 ;                       ^TMP("RORUPD",$J) node is merged to this
"RTN","ROR01",113,0)
 ;                       node so that it will be available for all
"RTN","ROR01",114,0)
 ;                       registry update subtasks.
"RTN","ROR01",115,0)
 ;
"RTN","ROR01",116,0)
 ; ^XTMP("RORUPDJ"_$J,
"RTN","ROR01",117,0)
 ;                       If the regular registry update is run in the
"RTN","ROR01",118,0)
 ;                       multitask mode, the ^XTMP("RORUPDJ"_$J) node
"RTN","ROR01",119,0)
 ;                       is used. $J is the job number of the main
"RTN","ROR01",120,0)
 ;                       registry update task.
"RTN","ROR01",121,0)
 ;
"RTN","ROR01",122,0)
 ; ^XTMP("RORUPDR"_Registry#,
"RTN","ROR01",123,0)
 ;                       During the initial registry population
"RTN","ROR01",124,0)
 ;                       (performed by the post-install routines),
"RTN","ROR01",125,0)
 ;                       the ^XTMP("RORUPDR"_Registry#) node is used.
"RTN","ROR01",126,0)
 ;                       The list of processed patients (the "U"
"RTN","ROR01",127,0)
 ;                       subscript) is used to restart the process
"RTN","ROR01",128,0)
 ;                       after an error or a crash.
"RTN","ROR01",129,0)
 ;
"RTN","ROR01",130,0)
 ;   0)                  Node descriptor
"RTN","ROR01",131,0)
 ;                         ^1: purge date  (FileMan)
"RTN","ROR01",132,0)
 ;                         ^2: create date (FileMan)
"RTN","ROR01",133,0)
 ;                         ^3: description
"RTN","ROR01",134,0)
 ;
"RTN","ROR01",135,0)
 ;   "T",Task#)          This node is LOCKed while the (sub)task is
"RTN","ROR01",136,0)
 ;                       running (subscript of the main task is 0).
"RTN","ROR01",137,0)
 ;
"RTN","ROR01",138,0)
 ;                       Otherwise, "S" means that the subtask has
"RTN","ROR01",139,0)
 ;                       been scheduled but not started yet.
"RTN","ROR01",140,0)
 ;
"RTN","ROR01",141,0)
 ;                       A negative value of the non-locked node
"RTN","ROR01",142,0)
 ;                       represents the error code (for example,
"RTN","ROR01",143,0)
 ;                       -60 means that the subtask has crashed).
"RTN","ROR01",144,0)
 ;
"RTN","ROR01",145,0)
 ;                       Non-negative value of the node means that
"RTN","ROR01",146,0)
 ;                       the subtask has been completed. The value
"RTN","ROR01",147,0)
 ;                       has the following structure:
"RTN","ROR01",148,0)
 ;                         ^1: Number of processed patients
"RTN","ROR01",149,0)
 ;                         ^2: Number of patients processed with
"RTN","ROR01",150,0)
 ;                             errors
"RTN","ROR01",151,0)
 ;
"RTN","ROR01",152,0)
 Q
"RTN","RORHL04")
0^3^B33231243^B31631249
"RTN","RORHL04",1,0)
RORHL04 ;HOIFO/CRT,SG - HL7 RADIOLOGY: OBR,OBX ; 4/26/07 12:53pm
"RTN","RORHL04",2,0)
 ;;1.5;CLINICAL CASE REGISTRIES;**3**;Feb 17, 2006;Build 7
"RTN","RORHL04",3,0)
 ;
"RTN","RORHL04",4,0)
 ; This routine uses the following IAs:
"RTN","RORHL04",5,0)
 ;
"RTN","RORHL04",6,0)
 ; #65           Read access to file #70 (controlled)
"RTN","RORHL04",7,0)
 ; #118-B        Read access to file #71 (controlled)
"RTN","RORHL04",8,0)
 ; #118-D        Read access to file #72 (controlled)
"RTN","RORHL04",9,0)
 ; #1995         $$CPT^ICPTCOD (supported)
"RTN","RORHL04",10,0)
 ; #2043         EN1^RAO7PC1 (supported)
"RTN","RORHL04",11,0)
 ; #2265         EN3^RAO7PC1 (supported)
"RTN","RORHL04",12,0)
 ; #10060        Read access to the file #200 (supported)
"RTN","RORHL04",13,0)
 ; #10090        Read access to the file #4 (supported)
"RTN","RORHL04",14,0)
 ;
"RTN","RORHL04",15,0)
 ; #15-C         Read access to file #74 (Private)
"RTN","RORHL04",16,0)
 ;
"RTN","RORHL04",17,0)
 Q
"RTN","RORHL04",18,0)
 ;
"RTN","RORHL04",19,0)
 ;***** SEARCHES RADIOLOGY FOR DATA
"RTN","RORHL04",20,0)
 ;
"RTN","RORHL04",21,0)
 ; RORDFN        IEN of the patient in the PATIENT file (#2)
"RTN","RORHL04",22,0)
 ;
"RTN","RORHL04",23,0)
 ; .DXDTS        Reference to a local variable where the
"RTN","RORHL04",24,0)
 ;               data extraction time frames are stored.
"RTN","RORHL04",25,0)
 ;
"RTN","RORHL04",26,0)
 ; Return Values:
"RTN","RORHL04",27,0)
 ;       <0  Error code
"RTN","RORHL04",28,0)
 ;        0  Ok
"RTN","RORHL04",29,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL04",30,0)
 ;
"RTN","RORHL04",31,0)
 ; The ^TMP($J,"RAE1") and ^TMP($J,"RAE2") global nodes are used by
"RTN","RORHL04",32,0)
 ; this function.
"RTN","RORHL04",33,0)
 ;
"RTN","RORHL04",34,0)
EN1(RORDFN,DXDTS) ;
"RTN","RORHL04",35,0)
 N CNI,DTI,ERRCNT,EXAMID,IDX,IENS,IENS74,RACN0,RC,RORENDT,RORSTDT,STR1,TMP
"RTN","RORHL04",36,0)
 S (ERRCNT,RC)=0
"RTN","RORHL04",37,0)
 ;
"RTN","RORHL04",38,0)
 S IDX=0
"RTN","RORHL04",39,0)
 F  S IDX=$O(DXDTS(4,IDX))  Q:IDX'>0  D  Q:RC<0
"RTN","RORHL04",40,0)
 . S RORSTDT=$P(DXDTS(4,IDX),U),RORENDT=$P(DXDTS(4,IDX),U,2)
"RTN","RORHL04",41,0)
 . ;--- Get radiology data
"RTN","RORHL04",42,0)
 . K ^TMP($J,"RAE1")
"RTN","RORHL04",43,0)
 . D EN1^RAO7PC1(RORDFN,RORSTDT,RORENDT,999999999)
"RTN","RORHL04",44,0)
 . ;--- Process the data
"RTN","RORHL04",45,0)
 . S EXAMID=""
"RTN","RORHL04",46,0)
 . F  S EXAMID=$O(^TMP($J,"RAE1",RORDFN,EXAMID))  Q:EXAMID=""  D
"RTN","RORHL04",47,0)
 . . S DTI=$P(EXAMID,"-"),CNI=$P(EXAMID,"-",2)
"RTN","RORHL04",48,0)
 . . S IENS=CNI_","_DTI_","_RORDFN_","
"RTN","RORHL04",49,0)
 . . S STR=^TMP($J,"RAE1",RORDFN,EXAMID)
"RTN","RORHL04",50,0)
 . . S RACN0=$P(STR,"^",2),IENS74=$P(STR,"^",5)
"RTN","RORHL04",51,0)
 . . S TMP=$$OBR(IENS,RACN0)
"RTN","RORHL04",52,0)
 . . I TMP  Q:TMP<0  S ERRCNT=ERRCNT+TMP
"RTN","RORHL04",53,0)
 . . Q:TMP="S"
"RTN","RORHL04",54,0)
 . . S TMP=$$OBX(IENS,IENS74)
"RTN","RORHL04",55,0)
 . . I TMP  Q:TMP<0  S ERRCNT=ERRCNT+TMP
"RTN","RORHL04",56,0)
 ;
"RTN","RORHL04",57,0)
 K ^TMP($J,"RAE1")
"RTN","RORHL04",58,0)
 Q $S(RC<0:RC,1:ERRCNT)
"RTN","RORHL04",59,0)
 ;
"RTN","RORHL04",60,0)
 ;*****
"RTN","RORHL04",61,0)
LOOP(ROR8NODE,OID,PREFIX) ;
"RTN","RORHL04",62,0)
 N BR,CNT,I,I1,TMP
"RTN","RORHL04",63,0)
 S BR=$E(HLECH,3)_".br"_$E(HLECH,3)
"RTN","RORHL04",64,0)
 S RORSEG(3)=OID
"RTN","RORHL04",65,0)
 K RORSEG(5)
"RTN","RORHL04",66,0)
 ;---
"RTN","RORHL04",67,0)
 S I=$O(@ROR8NODE@("")),CNT=0
"RTN","RORHL04",68,0)
 D:$G(PREFIX)'=""
"RTN","RORHL04",69,0)
 . S CNT=CNT+1
"RTN","RORHL04",70,0)
 . S RORSEG(5,CNT)=$$ESCAPE^RORHL7(PREFIX)_$S(I'="":BR,1:"")
"RTN","RORHL04",71,0)
 ;---
"RTN","RORHL04",72,0)
 F  Q:I=""  S I1=$O(@ROR8NODE@(I))  D  S I=I1
"RTN","RORHL04",73,0)
 . S TMP=$$ESCAPE^RORHL7(@ROR8NODE@(I))
"RTN","RORHL04",74,0)
 . S CNT=CNT+1,RORSEG(5,CNT)=$S(I1'="":TMP_BR,1:TMP)
"RTN","RORHL04",75,0)
 ;---
"RTN","RORHL04",76,0)
 D:$D(RORSEG(5)) ADDSEG^RORHL7(.RORSEG)
"RTN","RORHL04",77,0)
 Q
"RTN","RORHL04",78,0)
 ;
"RTN","RORHL04",79,0)
 ;***** GENERATES THE RADIOLOGY OBR SEGMENT
"RTN","RORHL04",80,0)
 ;
"RTN","RORHL04",81,0)
 ; RORIENS       IENS of the radiology record in the file #70.03
"RTN","RORHL04",82,0)
 ;
"RTN","RORHL04",83,0)
 ; Return Values:
"RTN","RORHL04",84,0)
 ;       <0  Error code
"RTN","RORHL04",85,0)
 ;        0  Ok
"RTN","RORHL04",86,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL04",87,0)
 ;      "S"  Skip the record
"RTN","RORHL04",88,0)
 ;
"RTN","RORHL04",89,0)
OBR(RORIENS,RACN0) ;
"RTN","RORHL04",90,0)
 N BUF,CPTIEN,CS,ERRCNT,IENS,IENS7002,RADTE,RC,RORMSG,ROROUT,RORSEG,TMP
"RTN","RORHL04",91,0)
 S (ERRCNT,RC)=0
"RTN","RORHL04",92,0)
 D ECH^RORHL7(.CS)
"RTN","RORHL04",93,0)
 ;--- Check the parameters
"RTN","RORHL04",94,0)
 S:$E(RORIENS,$L(RORIENS))'="," RORIENS=RORIENS_","
"RTN","RORHL04",95,0)
 ;
"RTN","RORHL04",96,0)
 D GETS^DIQ(70.03,RORIENS,"2;14","IE","ROROUT","RORMSG")
"RTN","RORHL04",97,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,70.03,RORIENS)
"RTN","RORHL04",98,0)
 S IENS7002=$P(RORIENS,",",2,3)_","
"RTN","RORHL04",99,0)
 D GETS^DIQ(70.02,IENS7002,".01;3","EI","ROROUT","RORMSG")
"RTN","RORHL04",100,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,70.02,IENS7002)
"RTN","RORHL04",101,0)
 ;
"RTN","RORHL04",102,0)
 ;--- Initialize the segment
"RTN","RORHL04",103,0)
 S RORSEG(0)="OBR"
"RTN","RORHL04",104,0)
 ;
"RTN","RORHL04",105,0)
 ;--- OBR-3 - Unique Accession #
"RTN","RORHL04",106,0)
 S BUF=$P(RORIENS,",",2)_"-"_$P(RORIENS,",")
"RTN","RORHL04",107,0)
 S RADTE=$G(ROROUT(70.02,IENS7002,.01,"I"))\1
"RTN","RORHL04",108,0)
 S $P(BUF,CS,2)=$E(RADTE,4,7)_$E(RADTE,2,3)_"-"_+RACN0
"RTN","RORHL04",109,0)
 S RORSEG(3)=BUF
"RTN","RORHL04",110,0)
 ;
"RTN","RORHL04",111,0)
 ;--- OBR-4 - Procedure & CPT Code
"RTN","RORHL04",112,0)
 S IENS=+$G(ROROUT(70.03,RORIENS,2,"I"))_","
"RTN","RORHL04",113,0)
 Q:IENS'>0 $$ERROR^RORERR(-95,,,,70.03,RORIENS,2)
"RTN","RORHL04",114,0)
 S CPTIEN=+$$GET1^DIQ(71,IENS,9,"I",,"RORMSG")
"RTN","RORHL04",115,0)
 Q:$G(DIERR) $$DBS^RORERR("RORMSG",-9,,,71,IENS)
"RTN","RORHL04",116,0)
 ;--- Some procedures never have a CPT code. Record a warning
"RTN","RORHL04",117,0)
 ;--- (only in debug mode) and skip the record.
"RTN","RORHL04",118,0)
 I CPTIEN'>0  D:$G(RORPARM("DEBUG"))  Q "S"
"RTN","RORHL04",119,0)
 . D ERROR^RORERR(-95,,,,71,IENS,9)
"RTN","RORHL04",120,0)
 ;---
"RTN","RORHL04",121,0)
 S TMP=$$CPT^ICPTCOD(CPTIEN)
"RTN","RORHL04",122,0)
 Q:TMP<0 $$ERROR^RORERR(-56,,$P(TMP,U,2),,+TMP,"$$CPT^ICPTCOD")
"RTN","RORHL04",123,0)
 S BUF=$P(TMP,U,2)_CS_$$ESCAPE^RORHL7($P(TMP,U,3))_CS_"C4"
"RTN","RORHL04",124,0)
 ;---
"RTN","RORHL04",125,0)
 S $P(BUF,CS,4)=$G(ROROUT(70.03,RORIENS,2,"I"))
"RTN","RORHL04",126,0)
 S $P(BUF,CS,5)=$$ESCAPE^RORHL7($G(ROROUT(70.03,RORIENS,2,"E")))
"RTN","RORHL04",127,0)
 S $P(BUF,CS,6)="99RAP"
"RTN","RORHL04",128,0)
 S RORSEG(4)=BUF
"RTN","RORHL04",129,0)
 ;
"RTN","RORHL04",130,0)
 ;--- OBR-7 - Exam Date/Time
"RTN","RORHL04",131,0)
 S TMP=$$FMTHL7^XLFDT($G(ROROUT(70.02,IENS7002,.01,"I")))
"RTN","RORHL04",132,0)
 Q:TMP'>0 $$ERROR^RORERR(-95,,,,70.02,IENS7002,.01)
"RTN","RORHL04",133,0)
 S RORSEG(7)=TMP
"RTN","RORHL04",134,0)
 ;
"RTN","RORHL04",135,0)
 ;--- OBR-16 - Requesting Physician
"RTN","RORHL04",136,0)
 S BUF=+$G(ROROUT(70.03,RORIENS,14,"I"))
"RTN","RORHL04",137,0)
 I BUF>0  D
"RTN","RORHL04",138,0)
 . S $P(BUF,CS,13)=$$GET1^DIQ(200,+BUF_",",53.5,"E",,"RORMSG")
"RTN","RORHL04",139,0)
 . I $G(DIERR)  D DBS^RORERR("RORMSG",-99,,,200,+BUF_",")  Q
"RTN","RORHL04",140,0)
 . S RORSEG(16)=BUF
"RTN","RORHL04",141,0)
 ;
"RTN","RORHL04",142,0)
 ;--- OBR-24 - Service Section ID
"RTN","RORHL04",143,0)
 S RORSEG(24)="RAD"
"RTN","RORHL04",144,0)
 ;
"RTN","RORHL04",145,0)
 ;--- OBR-44 - Division
"RTN","RORHL04",146,0)
 S RORSEG(44)=$$SITE^RORUTL03(CS)
"RTN","RORHL04",147,0)
 S IENS=+$G(ROROUT(70.02,IENS7002,3,"I"))_","
"RTN","RORHL04",148,0)
 I IENS>0  D
"RTN","RORHL04",149,0)
 . S BUF=$$GET1^DIQ(4,IENS,99,"I",,"RORMSG")
"RTN","RORHL04",150,0)
 . I $G(DIERR)  D DBS^RORERR("RORMSG",-99,,,4,IENS)  Q
"RTN","RORHL04",151,0)
 . Q:BUF=""
"RTN","RORHL04",152,0)
 . S $P(BUF,CS,2)=$$ESCAPE^RORHL7($G(ROROUT(70.02,IENS7002,3,"E")))
"RTN","RORHL04",153,0)
 . S $P(BUF,CS,3)="99VA4"
"RTN","RORHL04",154,0)
 . S RORSEG(44)=BUF
"RTN","RORHL04",155,0)
 ;
"RTN","RORHL04",156,0)
 ;--- Store the segment
"RTN","RORHL04",157,0)
 D ADDSEG^RORHL7(.RORSEG)
"RTN","RORHL04",158,0)
 Q ERRCNT
"RTN","RORHL04",159,0)
 ;
"RTN","RORHL04",160,0)
 ;***** GENERATES THE RADIOLOGY OBX SEGMENT
"RTN","RORHL04",161,0)
 ;
"RTN","RORHL04",162,0)
 ; RORIENS       IENS of the radiology record in the file #70.03
"RTN","RORHL04",163,0)
 ;
"RTN","RORHL04",164,0)
 ; Return Values:
"RTN","RORHL04",165,0)
 ;       <0  Error code
"RTN","RORHL04",166,0)
 ;        0  Ok
"RTN","RORHL04",167,0)
 ;       >0  Non-fatal error(s)
"RTN","RORHL04",168,0)
 ;
"RTN","RORHL04",169,0)
OBX(RORIENS,IENS74) ;
"RTN","RORHL04",170,0)
 N CASEIEN,RAENODE,ERRCNT,PTIEN,RC,RFS,RORBUF,RORSEG,RORTXT,TMP
"RTN","RORHL04",171,0)
 S (ERRCNT,RC)=0
"RTN","RORHL04",172,0)
 D ECH^RORHL7(.CS)
"RTN","RORHL04",173,0)
 ;--- Check the parameters
"RTN","RORHL04",174,0)
 S:$E(RORIENS,$L(RORIENS))'="," RORIENS=RORIENS_","
"RTN","RORHL04",175,0)
 ;
"RTN","RORHL04",176,0)
 ;--- Load the data into the ^TMP($J,"RAE2")
"RTN","RORHL04",177,0)
 S CASEIEN=$P(IENS,","),PTIEN=$P(IENS,",",3)
"RTN","RORHL04",178,0)
 D EN3^RAO7PC1(PTIEN_U_$P(IENS,",",2)_U_CASEIEN)
"RTN","RORHL04",179,0)
 S TMP=$O(^TMP($J,"RAE2",PTIEN,CASEIEN,""))
"RTN","RORHL04",180,0)
 Q:TMP="" $$ERROR^RORERR(-100,,,PTIEN,"Nothing","EN3^RAO7PC1")
"RTN","RORHL04",181,0)
 S RAENODE=$NA(^TMP($J,"RAE2",PTIEN,CASEIEN,TMP))
"RTN","RORHL04",182,0)
 ;
"RTN","RORHL04",183,0)
 ;--- Initialize the segment
"RTN","RORHL04",184,0)
 S RORSEG(0)="OBX"
"RTN","RORHL04",185,0)
 ;
"RTN","RORHL04",186,0)
 ;--- OBX-2
"RTN","RORHL04",187,0)
 S RORSEG(2)="FT"
"RTN","RORHL04",188,0)
 ;
"RTN","RORHL04",189,0)
 ;--- OBX-11
"RTN","RORHL04",190,0)
 S RORSEG(11)="F"
"RTN","RORHL04",191,0)
 ;
"RTN","RORHL04",192,0)
 ;-- Get the Report Text
"RTN","RORHL04",193,0)
 S TMP=$NA(@RAENODE@("R"))
"RTN","RORHL04",194,0)
 D:$D(@TMP)>1 LOOP(TMP,"RT"_CS_"Report Text"_CS_"VA080")
"RTN","RORHL04",195,0)
 ;
"RTN","RORHL04",196,0)
 ;--- Get the Impression Report
"RTN","RORHL04",197,0)
 S TMP=$NA(@RAENODE@("I"))
"RTN","RORHL04",198,0)
 D:$D(@TMP)>1 LOOP(TMP,"IT"_CS_"Impression Text"_CS_"VA080")
"RTN","RORHL04",199,0)
 ;
"RTN","RORHL04",200,0)
 ;--- Get the Reason for Study and Clinical History
"RTN","RORHL04",201,0)
 S TMP=$NA(@RAENODE@("H")),RFS=$G(@RAENODE@("RFS"))
"RTN","RORHL04",202,0)
 D:($D(@TMP)>1)!(RFS'="")
"RTN","RORHL04",203,0)
 . S:RFS'="" RFS="Reason for Study: "_RFS
"RTN","RORHL04",204,0)
 . D LOOP(TMP,"CH"_CS_"Clinical History"_CS_"VA080",RFS)
"RTN","RORHL04",205,0)
 ;
"RTN","RORHL04",206,0)
 ;--- Get the Reason for Study (alternative approach)
"RTN","RORHL04",207,0)
 ;S RORBUF(1)=$G(@RAENODE@("RFS"))
"RTN","RORHL04",208,0)
 ;D:RORBUF(1)'="" LOOP("RORBUF","RS"_CS_"Reason for Study"_CS_"VA080")
"RTN","RORHL04",209,0)
 ;
"RTN","RORHL04",210,0)
 Q ERRCNT
"VER")
8.0^22.0
"BLD",6630,6)
^7
**END**
**END**
