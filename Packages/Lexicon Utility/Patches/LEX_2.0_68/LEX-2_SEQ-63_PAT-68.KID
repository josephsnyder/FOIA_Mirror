Released LEX*2*68 SEQ #63
Extracted from mail message
**KIDS**:LEX*2.0*68^

**INSTALL NAME**
LEX*2.0*68
"BLD",7252,0)
LEX*2.0*68^LEXICON UTILITY^0^3091208^y
"BLD",7252,1,0)
^^2^2^3091119^
"BLD",7252,1,1,0)
Please see the National Patch Module for details of the enhancements
"BLD",7252,1,2,0)
included in this patch.
"BLD",7252,4,0)
^9.64PA^^
"BLD",7252,6.3)
1
"BLD",7252,"INIT")
POST^LEX2068P
"BLD",7252,"KRN",0)
^9.67PA^8989.52^19
"BLD",7252,"KRN",.4,0)
.4
"BLD",7252,"KRN",.401,0)
.401
"BLD",7252,"KRN",.402,0)
.402
"BLD",7252,"KRN",.403,0)
.403
"BLD",7252,"KRN",.5,0)
.5
"BLD",7252,"KRN",.84,0)
.84
"BLD",7252,"KRN",3.6,0)
3.6
"BLD",7252,"KRN",3.8,0)
3.8
"BLD",7252,"KRN",9.2,0)
9.2
"BLD",7252,"KRN",9.8,0)
9.8
"BLD",7252,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",7252,"KRN",9.8,"NM",1,0)
LEX2068^^0^B103074816
"BLD",7252,"KRN",9.8,"NM",2,0)
LEX2068P^^0^B3703266
"BLD",7252,"KRN",9.8,"NM",3,0)
LEXQCM^^0^B67014752
"BLD",7252,"KRN",9.8,"NM","B","LEX2068",1)

"BLD",7252,"KRN",9.8,"NM","B","LEX2068P",2)

"BLD",7252,"KRN",9.8,"NM","B","LEXQCM",3)

"BLD",7252,"KRN",19,0)
19
"BLD",7252,"KRN",19.1,0)
19.1
"BLD",7252,"KRN",101,0)
101
"BLD",7252,"KRN",409.61,0)
409.61
"BLD",7252,"KRN",771,0)
771
"BLD",7252,"KRN",870,0)
870
"BLD",7252,"KRN",8989.51,0)
8989.51
"BLD",7252,"KRN",8989.52,0)
8989.52
"BLD",7252,"KRN",8994,0)
8994
"BLD",7252,"KRN","B",.4,.4)

"BLD",7252,"KRN","B",.401,.401)

"BLD",7252,"KRN","B",.402,.402)

"BLD",7252,"KRN","B",.403,.403)

"BLD",7252,"KRN","B",.5,.5)

"BLD",7252,"KRN","B",.84,.84)

"BLD",7252,"KRN","B",3.6,3.6)

"BLD",7252,"KRN","B",3.8,3.8)

"BLD",7252,"KRN","B",9.2,9.2)

"BLD",7252,"KRN","B",9.8,9.8)

"BLD",7252,"KRN","B",19,19)

"BLD",7252,"KRN","B",19.1,19.1)

"BLD",7252,"KRN","B",101,101)

"BLD",7252,"KRN","B",409.61,409.61)

"BLD",7252,"KRN","B",771,771)

"BLD",7252,"KRN","B",870,870)

"BLD",7252,"KRN","B",8989.51,8989.51)

"BLD",7252,"KRN","B",8989.52,8989.52)

"BLD",7252,"KRN","B",8994,8994)

"BLD",7252,"PRE")
LEX2068
"BLD",7252,"QDEF")
^^^^NO^^^^^^NO
"BLD",7252,"QUES",0)
^9.62^^
"BLD",7252,"REQB",0)
^9.611^4^4
"BLD",7252,"REQB",1,0)
LEX*2.0*67^2
"BLD",7252,"REQB",2,0)
ICD*18.0*45^2
"BLD",7252,"REQB",3,0)
LEX*2.0*55^2
"BLD",7252,"REQB",4,0)
LEX*2.0*62^2
"BLD",7252,"REQB","B","ICD*18.0*45",2)

"BLD",7252,"REQB","B","LEX*2.0*55",3)

"BLD",7252,"REQB","B","LEX*2.0*62",4)

"BLD",7252,"REQB","B","LEX*2.0*67",1)

"INIT")
POST^LEX2068P
"MBREQ")
0
"PKG",574,-1)
1^1
"PKG",574,0)
LEXICON UTILITY^LEX^Medical and Biomedical Terminology System.
"PKG",574,20,0)
^9.402P^^
"PKG",574,22,0)
^9.49I^1^1
"PKG",574,22,1,0)
2.0^2960915^2970127^520665222
"PKG",574,22,1,"PAH",1,0)
68^3091208
"PKG",574,22,1,"PAH",1,1,0)
^^2^2^3091208
"PKG",574,22,1,"PAH",1,1,1,0)
Please see the National Patch Module for details of the enhancements
"PKG",574,22,1,"PAH",1,1,2,0)
included in this patch.
"PRE")
LEX2068
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","LEX2068")
0^1^B103074816^n/a
"RTN","LEX2068",1,0)
LEX2068 ;ISL/KER - LEX*2.0*68 Env Check ;12/08/2009
"RTN","LEX2068",2,0)
 ;;2.0;LEXICON UTILITY;**68**;Sep 23, 1996;Build 1
"RTN","LEX2068",3,0)
 ;               
"RTN","LEX2068",4,0)
 ; Global Variables
"RTN","LEX2068",5,0)
 ;    ^LEXM
"RTN","LEX2068",6,0)
 ;               
"RTN","LEX2068",7,0)
 ; External References
"RTN","LEX2068",8,0)
 ;    FIND^DIC            ICR   2051
"RTN","LEX2068",9,0)
 ;    EN^DIQ1             ICR  10015
"RTN","LEX2068",10,0)
 ;    $$FMTE^XLFDT        ICR  10103
"RTN","LEX2068",11,0)
 ;    $$PATCH^XPDUTL      ICR  10141
"RTN","LEX2068",12,0)
 ;    $$VERSION^XPDUTL    ICR  10141
"RTN","LEX2068",13,0)
 ;    BMES^XPDUTL         ICR  10141
"RTN","LEX2068",14,0)
 ;    MES^XPDUTL          ICR  10141
"RTN","LEX2068",15,0)
 ;               
"RTN","LEX2068",16,0)
 ; Local Variables Killed by Kernel after Install
"RTN","LEX2068",17,0)
 ;     XPDABORT,XPDDIQ,XPDQUIT
"RTN","LEX2068",18,0)
 ;               
"RTN","LEX2068",19,0)
ENV ; Environment Check
"RTN","LEX2068",20,0)
 ;                    
"RTN","LEX2068",21,0)
 ;   General
"RTN","LEX2068",22,0)
 ;
"RTN","LEX2068",23,0)
 N LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR,LEXG,LEXE,LEXSTR D IMP
"RTN","LEX2068",24,0)
 K XPDDIQ("XPZ1","B"),XPDDIQ("XPI1","B") S XPDDIQ("XPZ1","B")="NO",XPDDIQ("XPI1","B")="NO"
"RTN","LEX2068",25,0)
 S LEXSTR=$G(LEXPTYPE) S:$L($G(LEXFY))&($L($G(LEXQTR))) LEXSTR=LEXSTR_" for "_$G(LEXFY)_" "_$G(LEXQTR)_" Quarter"
"RTN","LEX2068",26,0)
 D BM(LEXSTR),M("")
"RTN","LEX2068",27,0)
 S U="^"
"RTN","LEX2068",28,0)
 ;     No user
"RTN","LEX2068",29,0)
 D:+($$UR)'>0 ET("User not defined (DUZ)")
"RTN","LEX2068",30,0)
 ;     No IO
"RTN","LEX2068",31,0)
 D:+($$SY)'>0 ET("Undefined IO variable(s)")
"RTN","LEX2068",32,0)
 I $D(LEXE) D ABRT Q
"RTN","LEX2068",33,0)
 ;                    
"RTN","LEX2068",34,0)
 ;   Load Distribution
"RTN","LEX2068",35,0)
 ;
"RTN","LEX2068",36,0)
 ;     XPDENV = 0 Environment Check during Load
"RTN","LEX2068",37,0)
 ;
"RTN","LEX2068",38,0)
 ;       Check Version (2.0)
"RTN","LEX2068",39,0)
 I $$VERSION^XPDUTL("LEX")'="2.0" D  D ABRT Q
"RTN","LEX2068",40,0)
 . D ET("Version 2.0 not found.  Please install Lexicon Utility v 2.0")
"RTN","LEX2068",41,0)
 ;
"RTN","LEX2068",42,0)
 ;       Check Required Patches
"RTN","LEX2068",43,0)
 D:'$L($G(LEXREQP)) IMP I $L(LEXREQP) D
"RTN","LEX2068",44,0)
 . N LEXPAT,LEXI,LEXPN,LEXP,LEXR,LEXC,LEXO,LEXC1,LEXC2,LEXC3 S (LEXR,LEXC)=0 S LEXC1=5,(LEXC2,LEXC3)=20
"RTN","LEX2068",45,0)
 . F LEXI=1:1 Q:'$L($P(LEXREQP,";",LEXI))  S LEXC=LEXC+1,LEXPAT=$P(LEXREQP,";",LEXI) S:$P(LEXPAT,"^",2)?7N LEXR=LEXR+1,LEXC3=LEXC2+13
"RTN","LEX2068",46,0)
 . F LEXI=1:1 Q:'$L($P(LEXREQP,";",LEXI))  S LEXPAT=$P(LEXREQP,";",LEXI) D
"RTN","LEX2068",47,0)
 . . N LEXREL,LEXINS,LEXINE S LEXREL=$P(LEXPAT,"^",2),LEXPAT=$P(LEXPAT,"^",1)
"RTN","LEX2068",48,0)
 . . S LEXPN=$$PATCH^XPDUTL(LEXPAT),LEXINS=$$INS(LEXPAT),LEXINE=$P(LEXINS,"^",2)
"RTN","LEX2068",49,0)
 . . W:LEXI=1 !,?3,"Checking for ",?LEXC2,$S(+($G(LEXR))>0:"Released",1:"")
"RTN","LEX2068",50,0)
 . . W !,?LEXC1,LEXPAT
"RTN","LEX2068",51,0)
 . . I LEXREL?7N W ?LEXC2,$TR($$FMTE^XLFDT(LEXREL,"5DZ"),"@"," ")
"RTN","LEX2068",52,0)
 . . I +LEXPN>0 H 1 S LEXO=+($G(LEXO))+1 W ?LEXC3,"Installed " W:$L($G(LEXINE)) LEXINE
"RTN","LEX2068",53,0)
 . . I +LEXPN'>0 D ET((" "_LEXPAT_" not found, please install "_LEXPAT_" before continuing"))
"RTN","LEX2068",54,0)
 . W:+($G(LEXO))'=LEXC !
"RTN","LEX2068",55,0)
 I $D(LEXE) D ABRT Q
"RTN","LEX2068",56,0)
 S LEXG=$$RGBL
"RTN","LEX2068",57,0)
 I $D(LEXE)&(+LEXG=0) D ABRT Q
"RTN","LEX2068",58,0)
 I $D(LEXE)&(+LEXG<0) D ABRT Q
"RTN","LEX2068",59,0)
 I '$D(LEXFULL)&(+($G(XPDENV))'=1) D QUIT Q
"RTN","LEX2068",60,0)
 ;                    
"RTN","LEX2068",61,0)
 ;   Install Package(s)
"RTN","LEX2068",62,0)
 ;
"RTN","LEX2068",63,0)
 ;     XPDENV = 1 Environment Check during Install
"RTN","LEX2068",64,0)
 ;
"RTN","LEX2068",65,0)
 ;       Check Data "is installed" or "is translated"
"RTN","LEX2068",66,0)
 N LEXIT S LEXIT=+($$CPD) I '$D(LEXFULL)&(LEXIT) D QUIT Q
"RTN","LEX2068",67,0)
 ;       Checking Global "Write" Protection 
"RTN","LEX2068",68,0)
 D:+($G(XPDENV))=1 GBLS I $D(LEXE) D ABRT Q
"RTN","LEX2068",69,0)
 ;       Check Import Global Checksum 
"RTN","LEX2068",70,0)
 D:+($G(XPDENV))=1 CS I $D(LEXE) D ABRT Q
"RTN","LEX2068",71,0)
 ;                    
"RTN","LEX2068",72,0)
 ;   Quit, Exit or Abort
"RTN","LEX2068",73,0)
 ;
"RTN","LEX2068",74,0)
QUIT ;     Quit   Passed Environment Check
"RTN","LEX2068",75,0)
 K LEXFULL D OK
"RTN","LEX2068",76,0)
 Q
"RTN","LEX2068",77,0)
EXIT ;     Exit   Failed Environment Check
"RTN","LEX2068",78,0)
 D:$D(LEXE) ED S XPDQUIT=2 K LEXE,LEXFULL Q
"RTN","LEX2068",79,0)
ABRT ;     Abort  Failed Environment Check, KILL the distribution
"RTN","LEX2068",80,0)
 D:$D(LEXE) ED S XPDABORT=1,XPDQUIT=1 S:$L($G(LEXBUILD)) XPDQUIT(LEXBUILD)=1
"RTN","LEX2068",81,0)
 K LEXE,LEXFULL
"RTN","LEX2068",82,0)
 Q
"RTN","LEX2068",83,0)
ENV2 ; Environment Check (for testing only)
"RTN","LEX2068",84,0)
 N XPDENV S XPDENV=1 D ENV
"RTN","LEX2068",85,0)
 Q
"RTN","LEX2068",86,0)
 ;               
"RTN","LEX2068",87,0)
 ; Checks
"RTN","LEX2068",88,0)
 ;
"RTN","LEX2068",89,0)
GBLS ;   Check Write access on globals
"RTN","LEX2068",90,0)
 N LEXB1,LEXB2,LEXE,LEXGBL,LEXRT,LEXT,LEXF,LEXI,LEXX,LEXOK,LEXCPD,LEXS,X S LEXOK=1
"RTN","LEX2068",91,0)
 D BM("   I will now check the protection on ^LEX, ^ICPT, ^ICD and ^DIC Globals.")
"RTN","LEX2068",92,0)
 D M("   If you get an ERROR, you will need to change the protection on these")
"RTN","LEX2068",93,0)
 D M("   globals to allow read/write as indicated:")
"RTN","LEX2068",94,0)
 D BM("                        Owner     Group    World   Network")
"RTN","LEX2068",95,0)
 D M("      Cache systems      RWD       RW       RW      RWD")
"RTN","LEX2068",96,0)
 D BM("   Checking:"),M(" ")
"RTN","LEX2068",97,0)
 S LEXCPD=$$CPD,LEXS="",X=1 F LEXI=1:1 D  Q:'$L(LEXX)
"RTN","LEX2068",98,0)
 . S LEXX="" S LEXE="S LEXX=$T(GD+"_LEXI_")" X LEXE S LEXX=$$TRIM(LEXX) Q:'$L(LEXX)  Q:'$L($TR(LEXX,";",""))
"RTN","LEX2068",99,0)
 . S LEXGBL=$P(LEXX,";",3) Q:+LEXCPD>0&(LEXGBL="^LEXM(0)")  S LEXRT=$P(LEXX,";",4),LEXT=$P(LEXX,";",5),LEXF=$P(LEXX,";",6)
"RTN","LEX2068",100,0)
 . S (LEXB1,LEXB2)="",$P(LEXB1," ",(19-$L(LEXRT)))="",$P(LEXB2," ",(28-$L(LEXT)))=""
"RTN","LEX2068",101,0)
 . I '$D(@LEXGBL) D RGNF S LEXOK=0 D M(("      <"_LEXRT_" not found>")) Q
"RTN","LEX2068",102,0)
 . D M(("      "_LEXRT_LEXB1_LEXT_LEXB2_LEXF)) S @LEXGBL=$G(@LEXGBL) H 1
"RTN","LEX2068",103,0)
 D:LEXOK M("    --> ok") D:'LEXOK M("    ??") D M(" ")
"RTN","LEX2068",104,0)
 Q
"RTN","LEX2068",105,0)
RGBL(X) ;   Check Write access on globals
"RTN","LEX2068",106,0)
 N LEXCPD,LEXS,LEXI,LEXX,LEXEC,LEXGBL,LEXRT,LEXT,LEXF,LEXB1,LEXB2
"RTN","LEX2068",107,0)
 S LEXCPD=$$CPD,LEXS="",X=1 F LEXI=1:1 D  Q:'$L(LEXX)
"RTN","LEX2068",108,0)
 . S LEXX="" S LEXEC="S LEXX=$T(GD+"_LEXI_")" X LEXEC S LEXX=$$TRIM(LEXX) Q:'$L(LEXX)  Q:'$L($TR(LEXX,";",""))
"RTN","LEX2068",109,0)
 . S LEXGBL=$P(LEXX,";",3) Q:+LEXCPD>0&(LEXGBL="^LEXM(0)")  S LEXRT=$P(LEXX,";",4),LEXT=$P(LEXX,";",5),LEXF=$P(LEXX,";",6)
"RTN","LEX2068",110,0)
 . S (LEXB1,LEXB2)="",$P(LEXB1," ",(15-$L(LEXRT)))="",$P(LEXB2," ",(28-$L(LEXT)))=""
"RTN","LEX2068",111,0)
 . I '$D(@LEXGBL) S:LEXS'[LEXRT LEXS=LEXS_", "_LEXRT S X=-1 S:LEXGBL["LEXM("&(X=1) X=0
"RTN","LEX2068",112,0)
 I $L(LEXS),X'>0 D
"RTN","LEX2068",113,0)
 . S:LEXS[", " LEXS=$P(LEXS,", ",1,($L(LEXS,", ")-1))_" and "_$P(LEXS,", ",$L(LEXS,", "))
"RTN","LEX2068",114,0)
 . S:$E(LEXS,1,2)=", " LEXS=$E(LEXS,3,$L(LEXS)) S:$E(LEXS,1,7)[" and " LEXS=$P(LEXS," and ",2)
"RTN","LEX2068",115,0)
 . D:X=-1 ET(("Global"_$S(LEXS[", "!(LEXS[" and "):"s",1:"")_" "_LEXS_" either not found or incomplete."))
"RTN","LEX2068",116,0)
 . D:X=0 CM
"RTN","LEX2068",117,0)
 Q X
"RTN","LEX2068",118,0)
RGNF ;   Required global not found
"RTN","LEX2068",119,0)
 N LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR D IMP
"RTN","LEX2068",120,0)
 D:$G(LEXGBL)["^LEX"&($G(LEXGBL)'["^LEXM") ET(""),ET("Required global "_$P($G(LEXGBL),"(",1)_" not found.")
"RTN","LEX2068",121,0)
 D:$G(LEXGBL)["^LEX"&($G(LEXGBL)["^LEXM") CM
"RTN","LEX2068",122,0)
 Q
"RTN","LEX2068",123,0)
INS(X) ;  Installed on
"RTN","LEX2068",124,0)
 N LEXB,LEXINS,LEXMSG,LEXINC,LEXI,LEXE,LEXT,LEXM S LEXB=$G(X) Q:'$L(LEXB) ""
"RTN","LEX2068",125,0)
 S LEXT="LEXINS(1)",LEXM="LEXMSG(1)" D FIND^DIC(9.7,"","17I","",LEXB,"*","B","","",LEXT,LEXM)
"RTN","LEX2068",126,0)
 S LEXINC=$O(LEXINS(1,"DILIST","ID"," "),-1),LEXI=$G(LEXINS(1,"DILIST","ID",LEXINC,17)) Q:$E(LEXI,1,7)'?7N ""
"RTN","LEX2068",127,0)
 S LEXE=$TR($$FMTE^XLFDT(LEXI,"5DZ"),"@"," ") Q:'$L(LEXE) ""  S X=LEXI_"^"_LEXE
"RTN","LEX2068",128,0)
 Q X
"RTN","LEX2068",129,0)
CHK ;   Check the Checksum
"RTN","LEX2068",130,0)
 D CS I $D(LEXE) D ED Q
"RTN","LEX2068",131,0)
 D BM("  OK"),M(" ")
"RTN","LEX2068",132,0)
 Q
"RTN","LEX2068",133,0)
CS ;   Checksum for import global
"RTN","LEX2068",134,0)
 K LEXE D BM("   Running checksum routine on the ^LEXM import global, please wait")
"RTN","LEX2068",135,0)
 N LEXCK,LEXND,LEXV S LEXCK=+($G(^LEXM(0,"CHECKSUM")))
"RTN","LEX2068",136,0)
 S LEXND=+($G(^LEXM(0,"NODES"))),LEXV=+($$VC(LEXCK,LEXND))
"RTN","LEX2068",137,0)
 D M(" ") D:LEXV>0 M("     Checksum is ok"),M(" ")
"RTN","LEX2068",138,0)
 D:LEXV=0 CM D:LEXV=-1 CW D:LEXV=-2 CU D:LEXV=-3 CF
"RTN","LEX2068",139,0)
 Q
"RTN","LEX2068",140,0)
VC(X,Y) ;   Verify Checksum for import global
"RTN","LEX2068",141,0)
 N LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR Q:'$D(^LEXM) 0
"RTN","LEX2068",142,0)
 D IMP I $G(^LEXM(0,"BUILD"))'=$G(LEXBUILD) Q -1
"RTN","LEX2068",143,0)
 N LEXCK,LEXND,LEXCNT,LEXLC,LEXL,LEXS,LEXNC,LEXD,LEXN,LEXC,LEXGCS,LEXP,LEXT
"RTN","LEX2068",144,0)
 S LEXCK=+($G(X)),LEXND=+($G(Y))
"RTN","LEX2068",145,0)
 Q:LEXCK'>0!(LEXND'>0) -2
"RTN","LEX2068",146,0)
 S LEXL=64,(LEXCNT,LEXLC)=0,LEXS=(+(LEXND\LEXL))
"RTN","LEX2068",147,0)
 S:LEXS=0 LEXS=1 D:+($O(^LEXM(0)))>0 M("")
"RTN","LEX2068",148,0)
 S (LEXC,LEXN)="^LEXM",(LEXNC,LEXGCS)=0 W "   "
"RTN","LEX2068",149,0)
 F  S LEXN=$Q(@LEXN) Q:LEXN=""!(LEXN'[LEXC)  D
"RTN","LEX2068",150,0)
 . Q:LEXN="^LEXM(0,""CHECKSUM"")"
"RTN","LEX2068",151,0)
 . Q:LEXN="^LEXM(0,""NODES"")"
"RTN","LEX2068",152,0)
 . S LEXCNT=LEXCNT+1
"RTN","LEX2068",153,0)
 . I LEXCNT'<LEXS S LEXLC=LEXLC+1 W:LEXLC'>LEXL "." S LEXCNT=0
"RTN","LEX2068",154,0)
 . S LEXNC=LEXNC+1,LEXD=@LEXN,LEXT=LEXN_"="_LEXD
"RTN","LEX2068",155,0)
 . F LEXP=1:1:$L(LEXT) S LEXGCS=$A(LEXT,LEXP)*LEXP+LEXGCS
"RTN","LEX2068",156,0)
 Q:LEXNC'=LEXND -3
"RTN","LEX2068",157,0)
 Q:LEXGCS'=LEXCK -3
"RTN","LEX2068",158,0)
 Q 1
"RTN","LEX2068",159,0)
SY(X) ;   Check System variables
"RTN","LEX2068",160,0)
 Q:'$D(IO)!('$D(IOF))!('$D(IOM))!('$D(ION))!('$D(IOSL))!('$D(IOST)) 0
"RTN","LEX2068",161,0)
 Q 1
"RTN","LEX2068",162,0)
UR(X) ;   Check User variables
"RTN","LEX2068",163,0)
 Q:'$L($G(DUZ(0))) 0
"RTN","LEX2068",164,0)
 Q:+($G(DUZ))=0!($$NOTDEF(+$G(DUZ))) 0
"RTN","LEX2068",165,0)
 Q 1
"RTN","LEX2068",166,0)
CPD(X) ;   Check Current Patched Data is installed
"RTN","LEX2068",167,0)
 N INS S INS=1
"RTN","LEX2068",168,0)
 Q 0
"RTN","LEX2068",169,0)
 ;               
"RTN","LEX2068",170,0)
 ; Error messages
"RTN","LEX2068",171,0)
 ;
"RTN","LEX2068",172,0)
CM ;   Missing ^LEXM
"RTN","LEX2068",173,0)
 N LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR D IMP D ET(""),ET("Missing import global ^LEXM.") D CO
"RTN","LEX2068",174,0)
 Q
"RTN","LEX2068",175,0)
CW ;   Wrong ^LEXM
"RTN","LEX2068",176,0)
 N LEXB,LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR D IMP S LEXB=$G(^LEXM(0,"BUILD")) D ET("")
"RTN","LEX2068",177,0)
 I $L(LEXBUILD),$L(LEXB),LEXBUILD'=LEXB D  Q
"RTN","LEX2068",178,0)
 . D ET(("Incorrect import global ^LEXM found ("_LEXB_" global).")) D CKO
"RTN","LEX2068",179,0)
 D ET("Incorrect import global ^LEXM found.") D CKO
"RTN","LEX2068",180,0)
 Q
"RTN","LEX2068",181,0)
CU ;   Unable to verify
"RTN","LEX2068",182,0)
 N LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR D IMP D ET(""),ET("Unable to verify checksum for import global ^LEXM (possibly corrupt).") D CKO
"RTN","LEX2068",183,0)
 Q
"RTN","LEX2068",184,0)
CF ;   Failed checksum
"RTN","LEX2068",185,0)
 N LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR D IMP D ET("") D ET("Import global ^LEXM failed checksum.") D CKO
"RTN","LEX2068",186,0)
 Q
"RTN","LEX2068",187,0)
CO ;   Obtain new global
"RTN","LEX2068",188,0)
 N LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR D IMP
"RTN","LEX2068",189,0)
 D ET(""),ET("    Please obtain a copy of the import global ^LEXM contained in the ")
"RTN","LEX2068",190,0)
 D ET(("    global host file "_LEXIGHF_" before continuing with the "_LEXBUILD))
"RTN","LEX2068",191,0)
 D ET(("    installation."))
"RTN","LEX2068",192,0)
 Q
"RTN","LEX2068",193,0)
CKO ;   Kill and Obtain new global
"RTN","LEX2068",194,0)
 N LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR D IMP
"RTN","LEX2068",195,0)
 D ET(""),ET("    Please KILL the existing import global ^LEXM from your system")
"RTN","LEX2068",196,0)
 D ET(("    and obtain a new copy of ^LEXM contained in the global host file"))
"RTN","LEX2068",197,0)
 D ET(("    "_LEXIGHF_" before continuing with the "_LEXBUILD_" installation."))
"RTN","LEX2068",198,0)
 Q
"RTN","LEX2068",199,0)
ET(X) ;   Error Text
"RTN","LEX2068",200,0)
 N LEXI S LEXI=+($G(LEXE(0))),LEXI=LEXI+1,LEXE(LEXI)="    "_$G(X),LEXE(0)=LEXI
"RTN","LEX2068",201,0)
 Q
"RTN","LEX2068",202,0)
ED ;   Error Display
"RTN","LEX2068",203,0)
 N LEXI S LEXI=0 F  S LEXI=$O(LEXE(LEXI)) Q:+LEXI=0  D M(LEXE(LEXI))
"RTN","LEX2068",204,0)
 D M(" ") K LEXE Q
"RTN","LEX2068",205,0)
 ;                   
"RTN","LEX2068",206,0)
 ; Miscellaneous
"RTN","LEX2068",207,0)
 ;
"RTN","LEX2068",208,0)
NOTDEF(IEN) ;   Check to see if user is defined
"RTN","LEX2068",209,0)
 N DA,DR,DIQ,LEX,DIC S DA=IEN,DR=.01,DIC=200,DIQ="LEX" D EN^DIQ1 Q '$D(LEX)
"RTN","LEX2068",210,0)
OK ;   Environment is OK
"RTN","LEX2068",211,0)
 N LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR,LEXT
"RTN","LEX2068",212,0)
 D IMP S LEXT="  Environment "_$S($L(LEXBUILD):("for patch/build "_LEXBUILD_" "),1:"")_"is ok"
"RTN","LEX2068",213,0)
 D BM(LEXT),M(" ")
"RTN","LEX2068",214,0)
 Q
"RTN","LEX2068",215,0)
BM(X) ;   Blank Line with Message
"RTN","LEX2068",216,0)
 S X=$G(X) S:$E(X,1)'=" " X=" "_X D BMES^XPDUTL(X) Q
"RTN","LEX2068",217,0)
M(X) ;   Message
"RTN","LEX2068",218,0)
 S X=$G(X) S:$E(X,1)'=" " X=" "_X D MES^XPDUTL(X) Q
"RTN","LEX2068",219,0)
TRIM(X) ;   Trim Spaces
"RTN","LEX2068",220,0)
 S X=$G(X) F  Q:$E(X,1)'=" "  S X=$E(X,2,$L(X))
"RTN","LEX2068",221,0)
 F  Q:$E(X,$L(X))'=" "  S X=$E(X,1,($L(X)-1))
"RTN","LEX2068",222,0)
 Q X
"RTN","LEX2068",223,0)
IMP ;   Import names
"RTN","LEX2068",224,0)
 ;     Patch Type
"RTN","LEX2068",225,0)
 S LEXPTYPE="Code Set Remedy Ticket Fixes"
"RTN","LEX2068",226,0)
 S LEXPTYPE="Code Set Update"
"RTN","LEX2068",227,0)
 ;     Revision
"RTN","LEX2068",228,0)
 S LEXLREV=68
"RTN","LEX2068",229,0)
 ;     Required Builds
"RTN","LEX2068",230,0)
 S LEXREQP="LEX*2.0*55^3090902;LEX*2.0*67^3091015;ICD*18.0*45"
"RTN","LEX2068",231,0)
 S LEXREQP="LEX*2.0*55;LEX*2.0*67;ICD*18.0*45"
"RTN","LEX2068",232,0)
 S LEXREQP="LEX*2.0*55;LEX*2.0*67"
"RTN","LEX2068",233,0)
 S LEXREQP="LEX*2.0*62;LEX*2.0*55;LEX*2.0*67;ICD*18.0*45"
"RTN","LEX2068",234,0)
 S LEXREQP="LEX*2.0*62^3090506;LEX*2.0*55^3090902;LEX*2.0*67^3091015;ICD*18.0*45^3091109"
"RTN","LEX2068",235,0)
 ;     This Build Name
"RTN","LEX2068",236,0)
 S LEXBUILD="LEX*2.0*68"
"RTN","LEX2068",237,0)
 ;     This Build's Export Global Host Filename
"RTN","LEX2068",238,0)
 S LEXIGHF="LEX_2_68.GBL"
"RTN","LEX2068",239,0)
 ;     Fiscal Year
"RTN","LEX2068",240,0)
 S LEXFY="FY10"
"RTN","LEX2068",241,0)
 ;     Quarter
"RTN","LEX2068",242,0)
 S LEXQTR="2nd"
"RTN","LEX2068",243,0)
 Q
"RTN","LEX2068",244,0)
EF ;   Exported Files
"RTN","LEX2068",245,0)
 ;;^LEX(757.01);^LEX(*;Lexicon;757-757.41
"RTN","LEX2068",246,0)
 ;;^LEXT(757.2);^LEXT(757.2);Lexicon Subsets/Defaults;757.2
"RTN","LEX2068",247,0)
 ;;^ICPT(0);^ICPT(;CPT/HCPCS;81
"RTN","LEX2068",248,0)
 ;;^DIC(81.1,0);^DIC(81.1);CPT Category;81.1
"RTN","LEX2068",249,0)
 ;;^DIC(81.2,0);^DIC(81.2);CPT Copyright;81.2
"RTN","LEX2068",250,0)
 ;;^DIC(81.3,0);^DIC(81.3);CPT Modifier;81.3
"RTN","LEX2068",251,0)
 ;;^ICD9(0);^ICD9(;ICD Diagnosis;80
"RTN","LEX2068",252,0)
 ;;^ICD0(0);^ICD0(;ICD Operation/Procedure;80.1
"RTN","LEX2068",253,0)
 ;;^ICD(0);^ICD(;DRG Grouper;80.2
"RTN","LEX2068",254,0)
 ;;^ICM(0);^ICM(;MAJOR DIAGNOSTIC CATEGORY;80.3
"RTN","LEX2068",255,0)
 ;;^ICD9(0);^ICD9(;ICD Diagnosis;80
"RTN","LEX2068",256,0)
 ;;^DIC(81.1,0);^DIC(81.1);CPT Category;81.1
"RTN","LEX2068",257,0)
 ;;^ICD9(0);^ICD9(;ICD Diagnosis;80
"RTN","LEX2068",258,0)
 ;;^ICD0(0);^ICD0(;ICD Operation/Procedure;80.1
"RTN","LEX2068",259,0)
 Q
"RTN","LEX2068",260,0)
GD ;   Global Data
"RTN","LEX2068",261,0)
 ;;^ICD9(0);^ICD9(;ICD Diagnosis;80
"RTN","LEX2068",262,0)
 ;;^ICD0(0);^ICD0(;ICD Operation/Procedure;80.1
"RTN","LEX2068",263,0)
 ;;^ICPT(0);^ICPT(;CPT/HCPCS;81
"RTN","LEX2068",264,0)
 ;;^DIC(81.1,0);^DIC(81.1);CPT Category;81.1
"RTN","LEX2068",265,0)
 ;;^DIC(81.2,0);^DIC(81.2);CPT Copyright;81.2
"RTN","LEX2068",266,0)
 ;;^DIC(81.3,0);^DIC(81.3);CPT Modifier;81.3
"RTN","LEX2068",267,0)
 ;;^LEX(757.01);^LEX(*;Lexicon;757-757.41
"RTN","LEX2068P")
0^2^B3703266^n/a
"RTN","LEX2068P",1,0)
LEX2068P ;ISL/KER - LEX*2.0*68 Pre/Post Install ;12/08/2009
"RTN","LEX2068P",2,0)
 ;;2.0;LEXICON UTILITY;**68**;Sep 23, 1996;Build 1
"RTN","LEX2068P",3,0)
 ;               
"RTN","LEX2068P",4,0)
 ; Global Variables
"RTN","LEX2068P",5,0)
 ;    ^LEXM(
"RTN","LEX2068P",6,0)
 ;               
"RTN","LEX2068P",7,0)
 ; External References
"RTN","LEX2068P",8,0)
 ;    None
"RTN","LEX2068P",9,0)
 ;               
"RTN","LEX2068P",10,0)
 Q
"RTN","LEX2068P",11,0)
POST ; Post-Install
"RTN","LEX2068P",12,0)
 ;            
"RTN","LEX2068P",13,0)
 ; From IMP in the Environment Check
"RTN","LEX2068P",14,0)
 ;            
"RTN","LEX2068P",15,0)
 ;      LEXBUILD   Build Name - LEX*2.0*nn
"RTN","LEX2068P",16,0)
 ;      LEXPTYPE   Patch Type - Remedy or Quarterly
"RTN","LEX2068P",17,0)
 ;      LEXFY      Fiscal Year - FYnn
"RTN","LEX2068P",18,0)
 ;      LEXQTR     Quarter - 1st, 2nd, 3rd, or 4th
"RTN","LEX2068P",19,0)
 ;      LEXIGHF    Name of Host File - LEX_2_nn.GBL
"RTN","LEX2068P",20,0)
 ;      LEXLREV    Revision - nn
"RTN","LEX2068P",21,0)
 ;      LEXREQP    Required Builds - build;build;build
"RTN","LEX2068P",22,0)
 ;            
"RTN","LEX2068P",23,0)
 N LEXEDT,LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR,LEXB,LEXCD,LEXSTR,LEXLAST,LEXOK S LEXOK=0 D IMP
"RTN","LEX2068P",24,0)
 S LEXEDT=$G(^LEXM(0,"CREATED")) D:LEXOK>0 LOAD
"RTN","LEX2068P",25,0)
 Q
"RTN","LEX2068P",26,0)
LOAD ; Load Data
"RTN","LEX2068P",27,0)
 ;             
"RTN","LEX2068P",28,0)
 ;      LEXSHORT   Send Short Message
"RTN","LEX2068P",29,0)
 ;      LEXMSG     Flag to send Message
"RTN","LEX2068P",30,0)
 ;            
"RTN","LEX2068P",31,0)
 N LEXSHORT,LEXMSG S LEXSHORT="",LEXMSG=""
"RTN","LEX2068P",32,0)
 S LEXSTR=$G(LEXPTYPE) S:$L($G(LEXFY))&($L($G(LEXQTR))) LEXSTR=LEXSTR_" for "_$G(LEXFY)_" "_$G(LEXQTR)_" Quarter"
"RTN","LEX2068P",33,0)
 S U="^",LEXB=$G(^LEXM(0,"BUILD")) Q:LEXB=""  Q:$G(LEXBUILD)=""
"RTN","LEX2068P",34,0)
 D:LEXB=LEXBUILD EN^LEXXGI
"RTN","LEX2068P",35,0)
LQ ; Load Quit
"RTN","LEX2068P",36,0)
 D KLEXM
"RTN","LEX2068P",37,0)
 Q
"RTN","LEX2068P",38,0)
 ;             
"RTN","LEX2068P",39,0)
KLEXM ; Subscripted Kill of ^LEXM
"RTN","LEX2068P",40,0)
 H 2 N DA S DA=0 F  S DA=$O(^LEXM(DA)) Q:+DA=0  K ^LEXM(DA)
"RTN","LEX2068P",41,0)
 N LEX S LEX=$G(^LEXM(0,"PRO")) K ^LEXM(0)
"RTN","LEX2068P",42,0)
 Q
"RTN","LEX2068P",43,0)
 ;            
"RTN","LEX2068P",44,0)
PRE ; Pre-Install              (N/A for this patch)
"RTN","LEX2068P",45,0)
 Q
"RTN","LEX2068P",46,0)
 ;            
"RTN","LEX2068P",47,0)
CON ; Conversion of data       (N/A for this patch)
"RTN","LEX2068P",48,0)
 Q
"RTN","LEX2068P",49,0)
IMP ; Call IMP in Environment Check
"RTN","LEX2068P",50,0)
 K LEXBUILD,LEXFY,LEXIGHF,LEXLREV,LEXPTYPE,LEXQTR,LEXREQP N LEXF
"RTN","LEX2068P",51,0)
 S LEXF=$P($T(+1)," ",1) S:$E(LEXF,$L(LEXF))="P" LEXF=$E(LEXF,1,($L(LEXF)-1)) Q:'$L(LEXF)
"RTN","LEX2068P",52,0)
 S LEXF="IMP^"_LEXF Q:'$L($T(@LEXF))  D @LEXF S:$L(LEXBUILD) LEXOK=1
"RTN","LEX2068P",53,0)
 Q
"RTN","LEXQCM")
0^3^B67014752^B66900998
"RTN","LEXQCM",1,0)
LEXQCM ;ISL/KER - Query - CPT Modifiers - Extract ;12/08/2009
"RTN","LEXQCM",2,0)
 ;;2.0;LEXICON UTILITY;**62,68**;Sep 23, 1996;Build 1
"RTN","LEXQCM",3,0)
 ;               
"RTN","LEXQCM",4,0)
 ; Global Variables
"RTN","LEXQCM",5,0)
 ;    ^DIC(81.3,          ICR   4492
"RTN","LEXQCM",6,0)
 ;               
"RTN","LEXQCM",7,0)
 ; External References
"RTN","LEXQCM",8,0)
 ;    HOME^%ZIS           ICR  10086
"RTN","LEXQCM",9,0)
 ;    $$GET1^DIQ          ICR   2056
"RTN","LEXQCM",10,0)
 ;    GETS^DIQ            ICR   2056
"RTN","LEXQCM",11,0)
 ;    HIST^ICPTAPIU       ICR   1997
"RTN","LEXQCM",12,0)
 ;    $$MOD^ICPTMOD       ICR   1996
"RTN","LEXQCM",13,0)
 ;    MODD^ICPTMOD        ICR   1996
"RTN","LEXQCM",14,0)
 ;    $$DT^XLFDT          ICR  10103
"RTN","LEXQCM",15,0)
 ;    $$UP^XLFSTR         ICR  10104
"RTN","LEXQCM",16,0)
 ;               
"RTN","LEXQCM",17,0)
EN ; Main Entry Point
"RTN","LEXQCM",18,0)
 N LEXENV S LEXENV=$$EV Q:+LEXENV'>0
"RTN","LEXQCM",19,0)
 N LEXAD,LEXEDT,LEXCDT,LEXEXIT,LEXTEST S LEXEXIT=0,LEXCDT=""
"RTN","LEXQCM",20,0)
 F  S LEXCDT=$$AD^LEXQM,LEXAD=LEXCDT Q:'$L(LEXCDT)  S LEXEDT=$P(LEXCDT,"^",1),LEXCDT=$P(LEXCDT,"^",2) Q:LEXCDT'?7N  D LOOK Q:LEXCDT'?7N  Q:+LEXEXIT>0
"RTN","LEXQCM",21,0)
 Q
"RTN","LEXQCM",22,0)
LOOK ; CPT Modifier Lookup Loop
"RTN","LEXQCM",23,0)
 S LEXCDT=$G(LEXCDT),LEXEDT=$$ED^LEXQM(LEXCDT) I LEXCDT'?7N S LEXCDT="" Q
"RTN","LEXQCM",24,0)
 N LEXMOD,LEXMODC S LEXLEN=62
"RTN","LEXQCM",25,0)
 F  S LEXMOD=$$MOD^LEXQCMA S:LEXMOD="^^" LEXEXIT=1 Q:LEXMOD="^"!(LEXMOD="^^")  D  Q:LEXMOD="^"!(LEXMOD="^^")
"RTN","LEXQCM",26,0)
 . K LEXGET,LEXST,LEXSD,LEXLD,LEXMD,LEXRAN,LEXLX,LEXWN N LEXIEN,LEXLDT,LEXELDT,LEXINC,LEXINCI,LEXINCF S (LEXINC,LEXINCI,LEXINCF)=0
"RTN","LEXQCM",27,0)
 . S LEXIEN=+($G(LEXMOD)),LEXLDT=+($G(LEXCDT)) Q:+LEXIEN'>0  Q:LEXLDT'?7N  S LEXELDT=$$SD^LEXQM(LEXLDT) Q:'$L(LEXELDT)
"RTN","LEXQCM",28,0)
 . S LEXINC=$$INC^LEXQCMA Q:LEXINC["^"  S:+LEXINC>0 LEXINCI=$$INCI^LEXQCMA S:+LEXINC>0 LEXINCF=$$INCF^LEXQCMA
"RTN","LEXQCM",29,0)
 . D CSV,EN^LEXQCM2
"RTN","LEXQCM",30,0)
 Q
"RTN","LEXQCM",31,0)
CSV ; Code Set Versioning Display
"RTN","LEXQCM",32,0)
 ; Needs LEXCDT Date 
"RTN","LEXQCM",33,0)
 ;       LEXMOD CPT Modifier Internal Entry Number
"RTN","LEXQCM",34,0)
 N LEXEDT,LEXIEN,LEXIENS,LEXLTXT,LEXSO,LEXSTA
"RTN","LEXQCM",35,0)
 S LEXCDT=$G(LEXCDT),LEXEDT=$$ED^LEXQM(LEXCDT) I LEXCDT'?7N S (LEXMOD,LEXCDT)="" Q
"RTN","LEXQCM",36,0)
 S LEXINC=+($G(LEXINC)),LEXINCI=+($G(LEXINCI)),LEXIEN=+($G(LEXMOD)),LEXSO=$P($G(LEXMOD),"^",2),LEXLTXT=$P($G(LEXMOD),"^",3)
"RTN","LEXQCM",37,0)
 Q:+LEXIEN'>0  Q:'$L(LEXSO)
"RTN","LEXQCM",38,0)
 ;
"RTN","LEXQCM",39,0)
 ; Get the "Unversioned" Fields
"RTN","LEXQCM",40,0)
 ;   Modifier                    Field .01
"RTN","LEXQCM",41,0)
 S LEXIENS=LEXIEN_"," D GETS^DIQ(81.3,LEXIENS,".01","IE","LEXGET","LEXMSG")
"RTN","LEXQCM",42,0)
 ; Get the "Versioned" Fields
"RTN","LEXQCM",43,0)
 ;   Effective Date and Status   Sub-File 81.33   (60)
"RTN","LEXQCM",44,0)
 S LEXST=$$EF(+($G(LEXIEN)),+LEXCDT),LEXSTA=+($P(LEXST,"^",2))
"RTN","LEXQCM",45,0)
 ;   Modifier Name               Sub-File 81.361  (61)
"RTN","LEXQCM",46,0)
 D SDS(+($G(LEXIEN)),+LEXCDT,.LEXSD,62,LEXSTA)
"RTN","LEXQCM",47,0)
 ;   Description                 Sub-File 81.362  (62)
"RTN","LEXQCM",48,0)
 D LDS(+($G(LEXIEN)),+LEXCDT,.LEXLD,62)
"RTN","LEXQCM",49,0)
 D WN(+LEXCDT,.LEXWN,62)
"RTN","LEXQCM",50,0)
 D:+($G(LEXINC))>0 CCR^LEXQCM2(+($G(LEXIEN)),+LEXCDT,.LEXRAN,62,+($G(LEXINCI)),+($G(LEXINCF)))
"RTN","LEXQCM",51,0)
 Q
"RTN","LEXQCM",52,0)
 ;            
"RTN","LEXQCM",53,0)
EF(X,LEXCDT) ; Effective Dates
"RTN","LEXQCM",54,0)
 N LEX,LEXAD,LEXBRD,LEXBRW,LEXEE,LEXEF,LEXES,LEXFA,LEXH,LEXI,LEXID,LEXIEN,LEXLS,LEXPE,LEXPH,LEXPI,LEXP0,LEXPS,LEXSO,LEXST
"RTN","LEXQCM",55,0)
 S LEXIEN=+($G(X)),LEXCDT=+($G(LEXCDT)),LEXBRD=2890101,LEXBRW=""
"RTN","LEXQCM",56,0)
 Q:+LEXIEN'>0 "^^"  Q:'$L($G(^DIC(81.3,+LEXIEN,0))) "^^"  Q:LEXCDT'?7N "^^"  S LEXSO=$P($G(^DIC(81.3,+LEXIEN,0)),"^",1)
"RTN","LEXQCM",57,0)
 S LEXFA=$$FA(+LEXIEN),LEXPI=$O(^DIC(81.3,+LEXIEN,60,"B",(LEXCDT+.999999)),-1),LEXPH=$O(^DIC(81.3,+LEXIEN,60,"B",+LEXPI," "),-1)
"RTN","LEXQCM",58,0)
 S LEXP0=$G(^DIC(81.3,+LEXIEN,60,+LEXPH,0)),LEXPS=$P(LEXP0,"^",2),LEXPE=$P(LEXP0,"^",1)
"RTN","LEXQCM",59,0)
 S:LEXCDT<LEXBRD&(+LEXFA=LEXBRD) LEXBRW="Warning:  The 'Based on Date' provided precedes the initial Code Set Business Rule date of "_$$SD^LEXQM(LEXBRD)_", the Effective date may be inaccurate."
"RTN","LEXQCM",60,0)
 S:LEXFA?7N&('$L(LEXPE))&('$L(LEXPS))&(LEXFA=LEXBRD) LEXPE=LEXFA,LEXPS=1
"RTN","LEXQCM",61,0)
 I '$L(LEXPE),'$L(LEXPS) D  Q X
"RTN","LEXQCM",62,0)
 . N LEXFA S LEXFA=$$FA(+LEXIEN)
"RTN","LEXQCM",63,0)
 . S LEXST="",LEXEF="",LEXES="Not Applicable",LEXLS=-1
"RTN","LEXQCM",64,0)
 . S LEXEE="" S:LEXFA?7N LEXEE="(future activation of "_$$SD^LEXQM(LEXFA)_")"
"RTN","LEXQCM",65,0)
 . S X=LEXLS_"^"_LEXST_"^"_LEXEF_"^"_LEXES_"^"_LEXEE S:$L(LEXBRW) $P(X,"^",6)=LEXBRW
"RTN","LEXQCM",66,0)
 S (LEXLS,LEXST)=LEXPS,LEXEF=LEXPE,LEXES=$S(+LEXST>0:"Active",1:"Inactive"),LEXEE=$$SD^LEXQM(LEXEF)
"RTN","LEXQCM",67,0)
 S X=LEXLS_"^"_LEXST_"^"_LEXEF_"^"_LEXES_"^"_LEXEE S:$L(LEXBRW) $P(X,"^",6)=LEXBRW
"RTN","LEXQCM",68,0)
 Q X
"RTN","LEXQCM",69,0)
 ;            
"RTN","LEXQCM",70,0)
SDS(X,LEXVDT,LEX,LEXLEN,LEXSTA) ; Modifier Name (short description)
"RTN","LEXQCM",71,0)
 ;            
"RTN","LEXQCM",72,0)
 ; LEX=# of Lines
"RTN","LEXQCM",73,0)
 ; LEX(0)=External Date of Modifier Name
"RTN","LEXQCM",74,0)
 ; LEX(#)=Modifier Name
"RTN","LEXQCM",75,0)
 ;            
"RTN","LEXQCM",76,0)
 N LEXD,LEXBRD,LEXBRW,LEXDDT,LEXE,LEXEE,LEXEFF,LEXFA,LEXHIS,LEXI,LEXIA,LEXIEN,LEXL,LEXLAST,LEXLEF,LEXLHI,LEXM,LEXR,LEXSDT,LEXSO,LEXLSD,LEXT
"RTN","LEXQCM",77,0)
 S LEXIEN=$G(X) Q:+LEXIEN'>0  Q:'$D(^DIC(81.3,+LEXIEN,61))  S LEXVDT=+($G(LEXVDT)) S:LEXVDT'?7N LEXVDT=$$DT^XLFDT S LEXSTA=+($G(LEXSTA))
"RTN","LEXQCM",78,0)
 S LEXSO=$P($G(^DIC(81.3,+LEXIEN,0)),"^",1),LEXLAST=$$MOD^ICPTMOD(+LEXIEN,"I",LEXVDT),LEXLSD=$P(LEXLAST,"^",3),LEXBRD=2890101
"RTN","LEXQCM",79,0)
 S:$D(LEXGET)&($L(LEXLSD)) LEXGET(81.3,(+LEXIEN_","),"B")=LEXLSD
"RTN","LEXQCM",80,0)
 S LEXLEN=+($G(LEXLEN)) S:+LEXLEN'>0 LEXLEN=62 S LEXFA=$$FA(+LEXIEN),LEXM=""
"RTN","LEXQCM",81,0)
 S LEXM="" S:+LEXVDT<LEXFA&(LEXFA'=LEXBRD) LEXM="CPT Modifier Short Name is not available.  The date provided precedes the initial activation of the code"
"RTN","LEXQCM",82,0)
 I $L(LEXM) D  Q
"RTN","LEXQCM",83,0)
 . K LEX N LEXT,LEXI S LEXT(1)=LEXM D PR^LEXQM(.LEXT,(LEXLEN-7))
"RTN","LEXQCM",84,0)
 . S LEXI=0 F  S LEXI=$O(LEXT(LEXI)) Q:+LEXI'>0  S LEXT=$G(LEXT(LEXI)) S LEX(LEXI)=LEXT
"RTN","LEXQCM",85,0)
 . S:$D(LEX(1)) LEX(0)="--/--/----" S LEX=+($O(LEX(" "),-1))
"RTN","LEXQCM",86,0)
 S LEXM="" S LEXEFF=$O(^DIC(81.3,LEXIEN,61,"B",(LEXVDT+.001)),-1),LEXHIS=$O(^DIC(81.3,LEXIEN,61,"B",+LEXEFF," "),-1),LEXSDT=$P($G(^DIC(81.3,+LEXIEN,61,+LEXHIS,0)),"^",2)
"RTN","LEXQCM",87,0)
 S LEXLEF=$O(^DIC(81.3,LEXIEN,61,"B",(9999999+.001)),-1),LEXLHI=$O(^DIC(81.3,LEXIEN,61,"B",+LEXLEF," "),-1),LEXDDT=$P($G(^DIC(81.3,+LEXIEN,61,+LEXLHI,0)),"^",2)
"RTN","LEXQCM",88,0)
 S (LEXD,LEXE,LEXR)="" S:$L(LEXSDT)&(LEXEFF?7N) LEXD=LEXSDT,LEXE=LEXEFF
"RTN","LEXQCM",89,0)
 S:$L(LEXDDT)&(LEXLEF?7N)&('$L(LEXD))&('$L(LEXE)) LEXD=LEXDDT,LEXE=LEXLEF,LEXR="No Text Available for Date Provided"
"RTN","LEXQCM",90,0)
 K LEX S LEX(1)=LEXD S:$L(LEXD) LEXGET(81.3,(+LEXIEN_","),"B")=LEXD S LEXEE=$$SD^LEXQM(LEXE)
"RTN","LEXQCM",91,0)
 S:$D(LEXTEST)&(+($G(LEXSTA))'>0) LEXEE="--/--/----" S:$L(LEX(1)) LEX(0)=LEXEE
"RTN","LEXQCM",92,0)
 S LEX=+($O(LEX(" "),-1))
"RTN","LEXQCM",93,0)
 Q
"RTN","LEXQCM",94,0)
LDS(X,LEXVDT,LEX,LEXLEN,LEXSTA) ; Long Description
"RTN","LEXQCM",95,0)
 ;            
"RTN","LEXQCM",96,0)
 ; LEX=# of Lines
"RTN","LEXQCM",97,0)
 ; LEX(0)=External Date of Description
"RTN","LEXQCM",98,0)
 ; LEX(#)=Description
"RTN","LEXQCM",99,0)
 ; LEX(#)=Description continued
"RTN","LEXQCM",100,0)
 ;            
"RTN","LEXQCM",101,0)
 N LEXC,LEXBRD,LEXDDT,LEXEVDT,LEXFA,LEXI,LEXIEN,LEXL,LEXLT,LEXLN,LEXM,LEXT,LEXSO,LEXTL,LEXTMP S LEXIEN=$G(X) Q:+LEXIEN'>0  Q:'$D(^DIC(81.3,+LEXIEN,62))
"RTN","LEXQCM",102,0)
 S LEXVDT=+($G(LEXVDT)) S:LEXVDT'?7N LEXVDT=$$DT^XLFDT S LEXEVDT=$$SD^LEXQM(LEXVDT),LEXLEN=+($G(LEXLEN)) S:+LEXLEN'>0 LEXLEN=62
"RTN","LEXQCM",103,0)
 S LEXSO=$P($G(^DIC(81.3,+LEXIEN,0)),"^",1) S LEXFA=$$FA(+LEXIEN),LEXM=""  S LEXSTA=+($G(LEXSTA)),LEXBRD=2890101
"RTN","LEXQCM",104,0)
 S LEXM="" S:+LEXVDT<LEXFA&(LEXFA'=LEXBRD) LEXM=" Modifier description is not available.  The date provided precedes the initial activation of the code" I $L(LEXM) D  Q
"RTN","LEXQCM",105,0)
 . K LEX N LEXT,LEXI S LEXT(1)=LEXM D PR^LEXQM(.LEXT,(LEXLEN-7)) S LEXI=0 F  S LEXI=$O(LEXT(LEXI)) Q:+LEXI'>0  S LEXT=$G(LEXT(LEXI)) S LEX(LEXI)=LEXT
"RTN","LEXQCM",106,0)
 . S:$D(LEX(1)) LEX(0)="--/--/----" S LEX=+($O(LEX(" "),-1))
"RTN","LEXQCM",107,0)
 K LEXTMP S LEXLT=$$MODD^ICPTMOD(LEXIEN,"LEXTMP",,LEXVDT) S LEXL=+($O(LEXTMP(" "),-1)),LEXLN=$G(LEXTMP(+LEXL))
"RTN","LEXQCM",108,0)
 S LEXM="" K:LEXL>0&(LEXLN["CODE TEXT MAY BE INACCURATE") LEXTMP(+LEXL)
"RTN","LEXQCM",109,0)
 F LEXI=1:1:2 S LEXL=+($O(LEXTMP(" "),-1)),LEXLN=$$TM^LEXQM($G(LEXTMP(+LEXL))) K:LEXL>0&('$L(LEXLN)) LEXTMP(+LEXL)
"RTN","LEXQCM",110,0)
 S LEXDDT=$O(^DIC(81.3,+LEXIEN,62,"B",(LEXVDT+.999999)),-1) S:LEXDDT'?7N LEXDDT=$O(^DIC(81.3,+LEXIEN,62,"B",0)) S:LEXDDT?7N LEXEVDT=$$SD^LEXQM(LEXDDT)
"RTN","LEXQCM",111,0)
 D PR^LEXQM(.LEXTMP,LEXLEN) K LEX F LEXI=1:1:+($G(LEXTMP)) D
"RTN","LEXQCM",112,0)
 . Q:'$D(LEXTMP(LEXI))  S LEXT=$$TM^LEXQM($G(LEXTMP(LEXI))),LEX(LEXI)=$$UP^XLFSTR(LEXT)
"RTN","LEXQCM",113,0)
 I $L(LEXM) D
"RTN","LEXQCM",114,0)
 . N LEXT,LEXI,LEXL,LEXC S LEXL=+($O(LEX(" "),-1)),LEXC=0 S LEXT(1)=LEXM D PR^LEXQM(.LEXT,(LEXLEN-7))
"RTN","LEXQCM",115,0)
 . S LEXI=0 F  S LEXI=$O(LEXT(LEXI)) Q:+LEXI'>0  D
"RTN","LEXQCM",116,0)
 . . S LEXT=$G(LEXT(LEXI)) S:$L(LEXT) LEXC=LEXC+1 S LEXL=LEXL+1,LEX(LEXL)=LEXT
"RTN","LEXQCM",117,0)
 S:$D(LEXTEST)&(+($G(LEXSTA))'>0) LEXEVDT="--/--/----" S:$D(LEX(1)) LEX(0)=LEXEVDT S LEX=+($O(LEX(" "),-1))
"RTN","LEXQCM",118,0)
 Q
"RTN","LEXQCM",119,0)
WN(X,LEX,LEXLEN) ;   Warning
"RTN","LEXQCM",120,0)
 ;            
"RTN","LEXQCM",121,0)
 ; LEX=# of Lines
"RTN","LEXQCM",122,0)
 ; LEX(0)=External Date
"RTN","LEXQCM",123,0)
 ; LEX(#)=Warning
"RTN","LEXQCM",124,0)
 ;            
"RTN","LEXQCM",125,0)
 N LEXVDT,LEXIA,LEXTMP K LEX S LEXVDT=$G(X) Q:LEXVDT'?7N  S LEXIA=$$IA(LEXVDT) Q:+LEXIA'>0  S LEXLEN=+$G(LEXLEN) S:+LEXLEN>62 LEXLEN=62
"RTN","LEXQCM",126,0)
 S LEXTMP(1)="Warning:  The 'Based on Date' provided precedes Code Set Versioning.  The Modifier Name and Description may be inaccurate for "_$$SD^LEXQM(LEXVDT)
"RTN","LEXQCM",127,0)
 D PR^LEXQM(.LEXTMP,LEXLEN) K LEX S LEXI=0 F  S LEXI=$O(LEXTMP(LEXI)) Q:+LEXI'>0  S LEX(LEXI)=$G(LEXTMP(LEXI))
"RTN","LEXQCM",128,0)
 S LEX=$O(LEX(" "),-1),LEX(0)=$$SD^LEXQM(LEXVDT)
"RTN","LEXQCM",129,0)
 Q
"RTN","LEXQCM",130,0)
 ; Miscellaneous
"RTN","LEXQCM",131,0)
FA(X) ;   First Activation
"RTN","LEXQCM",132,0)
 N LEXFA,LEXH,LEXI,LEXIEN,LEXSO S LEXIEN=+($G(X)) S X="",LEXSO=$P($G(^DIC(81.3,+LEXIEN,0)),"^",1) D HIST^ICPTAPIU(LEXSO,.LEXH) S LEXFA="",LEXI=0
"RTN","LEXQCM",133,0)
 F  S LEXI=$O(LEXH(LEXI)) Q:+LEXI'>0!($L(LEXFA))  S:+($G(LEXH(LEXI)))>0&(LEXI?7N) LEXFA=LEXI Q:$L(LEXFA)
"RTN","LEXQCM",134,0)
 S X=LEXFA
"RTN","LEXQCM",135,0)
 Q X
"RTN","LEXQCM",136,0)
IA(X) ;   Inaccurate
"RTN","LEXQCM",137,0)
 N LEXBRD,LEXVDT,LEXSYS S LEXVDT=+($G(X)),LEXSYS=1,LEXVDT=$S($G(LEXVDT)="":$$DT^XLFDT,1:$$DBR(LEXVDT)),LEXBRD=3021001,X=$S(LEXVDT<LEXBRD:1,1:0)
"RTN","LEXQCM",138,0)
 Q X
"RTN","LEXQCM",139,0)
DBR(X) ;   Date Business Rules
"RTN","LEXQCM",140,0)
 N LEXVDT S LEXVDT=$G(X) Q:'$G(LEXVDT)!($P(LEXVDT,".")'?7N) $$DT^XLFDT
"RTN","LEXQCM",141,0)
 S:LEXVDT#10000=0 LEXVDT=LEXVDT+101 S:LEXVDT#100=0 LEXVDT=LEXVDT+1 S X=$S(LEXVDT<2890101:2890101,1:LEXVDT)
"RTN","LEXQCM",142,0)
 Q X
"RTN","LEXQCM",143,0)
EV(X) ;   Check environment
"RTN","LEXQCM",144,0)
 N LEX S DT=$$DT^XLFDT D HOME^%ZIS S U="^" I +($G(DUZ))=0 W !!,?5,"DUZ not defined" Q 0
"RTN","LEXQCM",145,0)
 S LEX=$$GET1^DIQ(200,(DUZ_","),.01) I '$L(LEX) W !!,?5,"DUZ not valid" Q 0
"RTN","LEXQCM",146,0)
 Q 1
"VER")
8.0^22.0
"BLD",7252,6)
^63
**END**
**END**
