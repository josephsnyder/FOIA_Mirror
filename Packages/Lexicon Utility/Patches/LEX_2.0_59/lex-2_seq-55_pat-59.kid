Released LEX*2*59 SEQ #55
Extracted from mail message
**KIDS**:LEX*2.0*59^

**INSTALL NAME**
LEX*2.0*59
"BLD",7230,0)
LEX*2.0*59^LEXICON UTILITY^0^3080722^y
"BLD",7230,1,0)
^^2^2^3080509^
"BLD",7230,1,1,0)
Please see the National Patch Module for details of the enhancements
"BLD",7230,1,2,0)
included in this patch.
"BLD",7230,4,0)
^9.64PA^757.01^1
"BLD",7230,4,757.01,0)
757.01
"BLD",7230,4,757.01,2,0)
^9.641^757.01^1
"BLD",7230,4,757.01,2,757.01,0)
EXPRESSIONS  (File-top level)
"BLD",7230,4,757.01,2,757.01,1,0)
^9.6411^.01^1
"BLD",7230,4,757.01,2,757.01,1,.01,0)
DISPLAYABLE TEXT
"BLD",7230,4,757.01,222)
y^y^p^^^^n^^n
"BLD",7230,4,757.01,224)

"BLD",7230,4,"APDD",757.01,757.01)

"BLD",7230,4,"APDD",757.01,757.01,.01)

"BLD",7230,4,"B",757.01,757.01)

"BLD",7230,6.3)
6
"BLD",7230,"INIT")
POST^LEX2059P
"BLD",7230,"KRN",0)
^9.67PA^8989.52^19
"BLD",7230,"KRN",.4,0)
.4
"BLD",7230,"KRN",.401,0)
.401
"BLD",7230,"KRN",.402,0)
.402
"BLD",7230,"KRN",.403,0)
.403
"BLD",7230,"KRN",.5,0)
.5
"BLD",7230,"KRN",.84,0)
.84
"BLD",7230,"KRN",3.6,0)
3.6
"BLD",7230,"KRN",3.8,0)
3.8
"BLD",7230,"KRN",9.2,0)
9.2
"BLD",7230,"KRN",9.8,0)
9.8
"BLD",7230,"KRN",9.8,"NM",0)
^9.68A^9^9
"BLD",7230,"KRN",9.8,"NM",1,0)
LEX2059P^^0^B2424109
"BLD",7230,"KRN",9.8,"NM",2,0)
LEX2059^^0^B115832848
"BLD",7230,"KRN",9.8,"NM",3,0)
LEXXFI^^0^B53174607
"BLD",7230,"KRN",9.8,"NM",4,0)
LEXXGI^^0^B38282153
"BLD",7230,"KRN",9.8,"NM",5,0)
LEXXII^^0^B36561888
"BLD",7230,"KRN",9.8,"NM",6,0)
LEXXII2^^0^B32005202
"BLD",7230,"KRN",9.8,"NM",7,0)
LEXTRAN^^0^B59128681
"BLD",7230,"KRN",9.8,"NM",8,0)
LEXTRAN1^^0^B62011182
"BLD",7230,"KRN",9.8,"NM",9,0)
LEXXGI3^^0^B21977980
"BLD",7230,"KRN",9.8,"NM","B","LEX2059",2)

"BLD",7230,"KRN",9.8,"NM","B","LEX2059P",1)

"BLD",7230,"KRN",9.8,"NM","B","LEXTRAN",7)

"BLD",7230,"KRN",9.8,"NM","B","LEXTRAN1",8)

"BLD",7230,"KRN",9.8,"NM","B","LEXXFI",3)

"BLD",7230,"KRN",9.8,"NM","B","LEXXGI",4)

"BLD",7230,"KRN",9.8,"NM","B","LEXXGI3",9)

"BLD",7230,"KRN",9.8,"NM","B","LEXXII",5)

"BLD",7230,"KRN",9.8,"NM","B","LEXXII2",6)

"BLD",7230,"KRN",19,0)
19
"BLD",7230,"KRN",19.1,0)
19.1
"BLD",7230,"KRN",101,0)
101
"BLD",7230,"KRN",409.61,0)
409.61
"BLD",7230,"KRN",771,0)
771
"BLD",7230,"KRN",870,0)
870
"BLD",7230,"KRN",8989.51,0)
8989.51
"BLD",7230,"KRN",8989.52,0)
8989.52
"BLD",7230,"KRN",8994,0)
8994
"BLD",7230,"KRN","B",.4,.4)

"BLD",7230,"KRN","B",.401,.401)

"BLD",7230,"KRN","B",.402,.402)

"BLD",7230,"KRN","B",.403,.403)

"BLD",7230,"KRN","B",.5,.5)

"BLD",7230,"KRN","B",.84,.84)

"BLD",7230,"KRN","B",3.6,3.6)

"BLD",7230,"KRN","B",3.8,3.8)

"BLD",7230,"KRN","B",9.2,9.2)

"BLD",7230,"KRN","B",9.8,9.8)

"BLD",7230,"KRN","B",19,19)

"BLD",7230,"KRN","B",19.1,19.1)

"BLD",7230,"KRN","B",101,101)

"BLD",7230,"KRN","B",409.61,409.61)

"BLD",7230,"KRN","B",771,771)

"BLD",7230,"KRN","B",870,870)

"BLD",7230,"KRN","B",8989.51,8989.51)

"BLD",7230,"KRN","B",8989.52,8989.52)

"BLD",7230,"KRN","B",8994,8994)

"BLD",7230,"PRE")
LEX2059
"BLD",7230,"QUES",0)
^9.62^^
"BLD",7230,"REQB",0)
^9.611^2^2
"BLD",7230,"REQB",1,0)
LEX*2.0*56^2
"BLD",7230,"REQB",2,0)
LEX*2.0*41^2
"BLD",7230,"REQB","B","LEX*2.0*41",2)

"BLD",7230,"REQB","B","LEX*2.0*56",1)

"FIA",757.01)
EXPRESSIONS
"FIA",757.01,0)
^LEX(757.01,
"FIA",757.01,0,0)
757.01
"FIA",757.01,0,1)
y^y^p^^^^n^^n
"FIA",757.01,0,10)

"FIA",757.01,0,11)

"FIA",757.01,0,"RLRO")

"FIA",757.01,0,"VR")
2.0^LEX
"FIA",757.01,757.01)
1
"FIA",757.01,757.01,.01)

"INIT")
POST^LEX2059P
"MBREQ")
0
"PKG",574,-1)
1^1
"PKG",574,0)
LEXICON UTILITY^LEX^Medical and Biomedical Terminology System.
"PKG",574,20,0)
^9.402P^^
"PKG",574,22,0)
^9.49I^1^1
"PKG",574,22,1,0)
2.0^2960915^2970127^1
"PKG",574,22,1,"PAH",1,0)
59^3080722
"PKG",574,22,1,"PAH",1,1,0)
^^2^2^3080722
"PKG",574,22,1,"PAH",1,1,1,0)
Please see the National Patch Module for details of the enhancements
"PKG",574,22,1,"PAH",1,1,2,0)
included in this patch.
"PRE")
LEX2059
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
9
"RTN","LEX2059")
0^2^B115832848^n/a
"RTN","LEX2059",1,0)
LEX2059 ;ISL/KER - LEX*2.0*59 Env Check ;07/16/2008
"RTN","LEX2059",2,0)
 ;;2.0;LEXICON UTILITY;**59**;Sep 23, 1996;Build 6
"RTN","LEX2059",3,0)
 ;              
"RTN","LEX2059",4,0)
 ; Variables NEWed or KILLed Elsewhere
"RTN","LEX2059",5,0)
 ;    XPDABORT
"RTN","LEX2059",6,0)
 ;    XPDDIQ("XPI1")
"RTN","LEX2059",7,0)
 ;    XPDDIQ("XPZ1")
"RTN","LEX2059",8,0)
 ;    XPDENV
"RTN","LEX2059",9,0)
 ;    XPDQUIT
"RTN","LEX2059",10,0)
 ;              
"RTN","LEX2059",11,0)
 ; Global Variables
"RTN","LEX2059",12,0)
 ;    ^LEXM
"RTN","LEX2059",13,0)
 ;              
"RTN","LEX2059",14,0)
 ; External References
"RTN","LEX2059",15,0)
 ;    DBIA 10015  EN^DIQ1
"RTN","LEX2059",16,0)
 ;    DBIA 10141  $$PATCH^XPDUTL
"RTN","LEX2059",17,0)
 ;    DBIA 10141  $$VERSION^XPDUTL
"RTN","LEX2059",18,0)
 ;    DBIA 10141  BMES^XPDUTL
"RTN","LEX2059",19,0)
 ;    DBIA 10141  MES^XPDUTL
"RTN","LEX2059",20,0)
 ;              
"RTN","LEX2059",21,0)
ENV ; LEX*2.0*59 Environment Check
"RTN","LEX2059",22,0)
 ;                    
"RTN","LEX2059",23,0)
 ;   General
"RTN","LEX2059",24,0)
 ;
"RTN","LEX2059",25,0)
 N LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR,LEXG,LEXE,LEXSTR,LEXIT D IMP
"RTN","LEX2059",26,0)
 K XPDDIQ("XPZ1","B"),XPDDIQ("XPI1","B") S XPDDIQ("XPZ1","B")="NO",XPDDIQ("XPI1","B")="NO"
"RTN","LEX2059",27,0)
 S LEXSTR=$G(LEXPTYPE) S:$L($G(LEXFY))&($L($G(LEXQTR))) LEXSTR=LEXSTR_" for "_$G(LEXFY)_" "_$G(LEXQTR)_" Quarter"
"RTN","LEX2059",28,0)
 D BM(LEXSTR),M("")
"RTN","LEX2059",29,0)
 S U="^"
"RTN","LEX2059",30,0)
 ;     No user
"RTN","LEX2059",31,0)
 D:+($$UR)'>0 ET("User not defined (DUZ)")
"RTN","LEX2059",32,0)
 ;     No IO
"RTN","LEX2059",33,0)
 D:+($$SY)'>0 ET("Undefined IO variable(s)")
"RTN","LEX2059",34,0)
 I $D(LEXE) D ABRT Q
"RTN","LEX2059",35,0)
 ;                    
"RTN","LEX2059",36,0)
 ;   Load Distribution
"RTN","LEX2059",37,0)
 ;
"RTN","LEX2059",38,0)
 ;     XPDENV = 0 Environment Check during Load
"RTN","LEX2059",39,0)
 ;
"RTN","LEX2059",40,0)
 ;       Check Version (2.0)
"RTN","LEX2059",41,0)
 I $$VERSION^XPDUTL("LEX")'="2.0" D  D ABRT Q
"RTN","LEX2059",42,0)
 . D ET("Version 2.0 not found.  Please install Lexicon Utility v 2.0")
"RTN","LEX2059",43,0)
 ;
"RTN","LEX2059",44,0)
 ;       Check Required Patches
"RTN","LEX2059",45,0)
 D:'$L($G(LEXREQP)) IMP I $L(LEXREQP) D
"RTN","LEX2059",46,0)
 . N LEXPAT,LEXI,LEXPN
"RTN","LEX2059",47,0)
 . F LEXI=1:1 Q:'$L($P(LEXREQP,";",LEXI))  S LEXPAT=$P(LEXREQP,";",LEXI) D
"RTN","LEX2059",48,0)
 . . S LEXPN=$$PATCH^XPDUTL(LEXPAT) W !,"   Checking for ",LEXPAT I +LEXPN>0 H 1 W " - installed"
"RTN","LEX2059",49,0)
 . . I +LEXPN'>0 D ET((LEXPAT_" not found, please install "_LEXPAT_" before continuing"))
"RTN","LEX2059",50,0)
 I $D(LEXE) D ABRT Q
"RTN","LEX2059",51,0)
 ;       Check Required Data
"RTN","LEX2059",52,0)
 S LEXIT=$$LPD I $L($P($G(LEXIT),"^",1)) D  I +LEXIT'>0!($D(LEXE)) D ABRT Q
"RTN","LEX2059",53,0)
 . W !!,"   Checking for LEX*2.0*41 Data"
"RTN","LEX2059",54,0)
 . W:$L($P($G(LEXIT),"^",2)) !,"     ",$P($G(LEXIT),"^",2)
"RTN","LEX2059",55,0)
 ;       Check Globals
"RTN","LEX2059",56,0)
 S LEXG=$$RGBL
"RTN","LEX2059",57,0)
 I $D(LEXE)&(+LEXG=0) D ABRT Q
"RTN","LEX2059",58,0)
 I $D(LEXE)&(+LEXG<0) D ABRT Q
"RTN","LEX2059",59,0)
 I '$D(LEXFULL)&(+($G(XPDENV))'=1) D QUIT Q
"RTN","LEX2059",60,0)
 ;                    
"RTN","LEX2059",61,0)
 ;   Install Package(s)
"RTN","LEX2059",62,0)
 ;
"RTN","LEX2059",63,0)
 ;     XPDENV = 1 Environment Check during Install
"RTN","LEX2059",64,0)
 ;
"RTN","LEX2059",65,0)
 ;       Check Data "is installed" or "is translated"
"RTN","LEX2059",66,0)
 S LEXIT=+($$CPD) I '$D(LEXFULL)&(LEXIT) D QUIT Q
"RTN","LEX2059",67,0)
 ;       Checking Global "Write" Protection 
"RTN","LEX2059",68,0)
 D:+($G(XPDENV))=1 GBLS I $D(LEXE) D ABRT Q
"RTN","LEX2059",69,0)
 ;       Check Import Global Checksum 
"RTN","LEX2059",70,0)
 D:+($G(XPDENV))=1 CS I $D(LEXE) D ABRT Q
"RTN","LEX2059",71,0)
 ;                    
"RTN","LEX2059",72,0)
 ;   Quit, Exit or Abort
"RTN","LEX2059",73,0)
 ;
"RTN","LEX2059",74,0)
QUIT ;     Quit   Passed Environment Check
"RTN","LEX2059",75,0)
 K LEXFULL D OK
"RTN","LEX2059",76,0)
 Q
"RTN","LEX2059",77,0)
EXIT ;     Exit   Failed Environment Check
"RTN","LEX2059",78,0)
 D:$D(LEXE) ED S XPDQUIT=2 K LEXE,LEXFULL Q
"RTN","LEX2059",79,0)
ABRT ;     Abort  Failed Environment Check, KILL the distribution
"RTN","LEX2059",80,0)
 D:$D(LEXE) ED S XPDABORT=1,XPDQUIT=1,XPDQUIT("LEX*2.0*59")=1
"RTN","LEX2059",81,0)
 K LEXE,LEXFULL
"RTN","LEX2059",82,0)
 Q
"RTN","LEX2059",83,0)
 ;               
"RTN","LEX2059",84,0)
 ; Checks
"RTN","LEX2059",85,0)
 ;
"RTN","LEX2059",86,0)
GBLS ;   Check Write access on globals
"RTN","LEX2059",87,0)
 N LEXB1,LEXB2,LEXE,LEXGBL,LEXRT,LEXT,LEXF,LEXI,LEXX,LEXOK,LEXCPD,LEXS,X S LEXOK=1
"RTN","LEX2059",88,0)
 D BM("   I will now check the protection on ^LEX, ^ICPT, ^ICD and ^DIC Globals.")
"RTN","LEX2059",89,0)
 D M("   If you get an ERROR, you will need to change the protection on these")
"RTN","LEX2059",90,0)
 D M("   globals to allow read/write as indicated:")
"RTN","LEX2059",91,0)
 D BM("                        Owner     Group    World   Network")
"RTN","LEX2059",92,0)
 D M("      Cache systems      RWD       RW       RW      RWD")
"RTN","LEX2059",93,0)
 D BM("   Checking:"),M(" ")
"RTN","LEX2059",94,0)
 S LEXCPD=$$CPD,LEXS="",X=1 F LEXI=1:1 D  Q:'$L(LEXX)
"RTN","LEX2059",95,0)
 . S LEXX="" S LEXE="S LEXX=$T(GD+"_LEXI_")" X LEXE S LEXX=$$TRIM(LEXX) Q:'$L(LEXX)  Q:'$L($TR(LEXX,";",""))
"RTN","LEX2059",96,0)
 . S LEXGBL=$P(LEXX,";",3) Q:+LEXCPD>0&(LEXGBL="^LEXM(0)")  S LEXRT=$P(LEXX,";",4),LEXT=$P(LEXX,";",5),LEXF=$P(LEXX,";",6)
"RTN","LEX2059",97,0)
 . S (LEXB1,LEXB2)="",$P(LEXB1," ",(19-$L(LEXRT)))="",$P(LEXB2," ",(28-$L(LEXT)))=""
"RTN","LEX2059",98,0)
 . I '$D(@LEXGBL) D RGNF S LEXOK=0 D M(("      <"_LEXRT_" not found>")) Q
"RTN","LEX2059",99,0)
 . D M(("      "_LEXRT_LEXB1_LEXT_LEXB2_LEXF)) S @LEXGBL=$G(@LEXGBL) H 1
"RTN","LEX2059",100,0)
 D:LEXOK M("    --> ok") D:'LEXOK M("    ??") D M(" ")
"RTN","LEX2059",101,0)
 Q
"RTN","LEX2059",102,0)
RGBL(X) ;   Check Write access on globals
"RTN","LEX2059",103,0)
 N LEXCPD,LEXS,LEXI,LEXX,LEXEC,LEXGBL,LEXRT,LEXT,LEXF,LEXB1,LEXB2
"RTN","LEX2059",104,0)
 S LEXCPD=$$CPD,LEXS="",X=1 F LEXI=1:1 D  Q:'$L(LEXX)
"RTN","LEX2059",105,0)
 . S LEXX="" S LEXEC="S LEXX=$T(GD+"_LEXI_")" X LEXEC S LEXX=$$TRIM(LEXX) Q:'$L(LEXX)  Q:'$L($TR(LEXX,";",""))
"RTN","LEX2059",106,0)
 . S LEXGBL=$P(LEXX,";",3) Q:+LEXCPD>0&(LEXGBL="^LEXM(0)")  S LEXRT=$P(LEXX,";",4),LEXT=$P(LEXX,";",5),LEXF=$P(LEXX,";",6)
"RTN","LEX2059",107,0)
 . S (LEXB1,LEXB2)="",$P(LEXB1," ",(15-$L(LEXRT)))="",$P(LEXB2," ",(28-$L(LEXT)))=""
"RTN","LEX2059",108,0)
 . I '$D(@LEXGBL) S:LEXS'[LEXRT LEXS=LEXS_", "_LEXRT S X=-1 S:LEXGBL["LEXM("&(X=1) X=0
"RTN","LEX2059",109,0)
 I $L(LEXS),X'>0 D
"RTN","LEX2059",110,0)
 . S:LEXS[", " LEXS=$P(LEXS,", ",1,($L(LEXS,", ")-1))_" and "_$P(LEXS,", ",$L(LEXS,", "))
"RTN","LEX2059",111,0)
 . S:$E(LEXS,1,2)=", " LEXS=$E(LEXS,3,$L(LEXS)) S:$E(LEXS,1,7)[" and " LEXS=$P(LEXS," and ",2)
"RTN","LEX2059",112,0)
 . D:X=-1 ET(("Global"_$S(LEXS[", "!(LEXS[" and "):"s",1:"")_" "_LEXS_" either not found or incomplete."))
"RTN","LEX2059",113,0)
 . D:X=0 CM
"RTN","LEX2059",114,0)
 Q X
"RTN","LEX2059",115,0)
RGNF ;   Required global not found
"RTN","LEX2059",116,0)
 N LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR D IMP
"RTN","LEX2059",117,0)
 D:$G(LEXGBL)["^LEX"&($G(LEXGBL)'["^LEXM") ET(""),ET("Required global "_$P($G(LEXGBL),"(",1)_" not found.")
"RTN","LEX2059",118,0)
 D:$G(LEXGBL)["^LEX"&($G(LEXGBL)["^LEXM") CM
"RTN","LEX2059",119,0)
 Q
"RTN","LEX2059",120,0)
CHK ;   Check the Checksum
"RTN","LEX2059",121,0)
 D CS I $D(LEXE) D ED Q
"RTN","LEX2059",122,0)
 D BM("  OK"),M(" ")
"RTN","LEX2059",123,0)
 Q
"RTN","LEX2059",124,0)
CS ;   Checksum for import global
"RTN","LEX2059",125,0)
 K LEXE D BM("   Running checksum routine on the ^LEXM import global, please wait")
"RTN","LEX2059",126,0)
 N LEXCK,LEXND,LEXV S LEXCK=+($G(^LEXM(0,"CHECKSUM")))
"RTN","LEX2059",127,0)
 S LEXND=+($G(^LEXM(0,"NODES"))),LEXV=+($$VC(LEXCK,LEXND))
"RTN","LEX2059",128,0)
 D M(" ") D:LEXV>0 M("     Checksum is ok"),M(" ")
"RTN","LEX2059",129,0)
 D:LEXV=0 CM D:LEXV=-1 CW D:LEXV=-2 CU D:LEXV=-3 CF
"RTN","LEX2059",130,0)
 Q
"RTN","LEX2059",131,0)
VC(X,Y) ;   Verify Checksum for import global
"RTN","LEX2059",132,0)
 N LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR Q:'$D(^LEXM) 0
"RTN","LEX2059",133,0)
 D IMP I $G(^LEXM(0,"BUILD"))'=$G(LEXBUILD) Q -1
"RTN","LEX2059",134,0)
 N LEXCK,LEXND,LEXCNT,LEXLC,LEXL,LEXS,LEXNC,LEXD,LEXN,LEXC,LEXGCS,LEXP,LEXT
"RTN","LEX2059",135,0)
 S LEXCK=+($G(X)),LEXND=+($G(Y))
"RTN","LEX2059",136,0)
 Q:LEXCK'>0!(LEXND'>0) -2
"RTN","LEX2059",137,0)
 S LEXL=64,(LEXCNT,LEXLC)=0,LEXS=(+(LEXND\LEXL))
"RTN","LEX2059",138,0)
 S:LEXS=0 LEXS=1 D:+($O(^LEXM(0)))>0 M("")
"RTN","LEX2059",139,0)
 S (LEXC,LEXN)="^LEXM",(LEXNC,LEXGCS)=0 W "   "
"RTN","LEX2059",140,0)
 F  S LEXN=$Q(@LEXN) Q:LEXN=""!(LEXN'[LEXC)  D
"RTN","LEX2059",141,0)
 . Q:LEXN="^LEXM(0,""CHECKSUM"")"
"RTN","LEX2059",142,0)
 . Q:LEXN="^LEXM(0,""NODES"")"
"RTN","LEX2059",143,0)
 . S LEXCNT=LEXCNT+1
"RTN","LEX2059",144,0)
 . I LEXCNT'<LEXS S LEXLC=LEXLC+1 W:LEXLC'>LEXL "." S LEXCNT=0
"RTN","LEX2059",145,0)
 . S LEXNC=LEXNC+1,LEXD=@LEXN,LEXT=LEXN_"="_LEXD
"RTN","LEX2059",146,0)
 . F LEXP=1:1:$L(LEXT) S LEXGCS=$A(LEXT,LEXP)*LEXP+LEXGCS
"RTN","LEX2059",147,0)
 Q:LEXNC'=LEXND -3
"RTN","LEX2059",148,0)
 Q:LEXGCS'=LEXCK -3
"RTN","LEX2059",149,0)
 Q 1
"RTN","LEX2059",150,0)
SY(X) ;   Check System variables
"RTN","LEX2059",151,0)
 Q:'$D(IO)!('$D(IOF))!('$D(IOM))!('$D(ION))!('$D(IOSL))!('$D(IOST)) 0
"RTN","LEX2059",152,0)
 Q 1
"RTN","LEX2059",153,0)
UR(X) ;   Check User variables
"RTN","LEX2059",154,0)
 Q:'$L($G(DUZ(0))) 0
"RTN","LEX2059",155,0)
 Q:+($G(DUZ))=0!($$NOTDEF(+$G(DUZ))) 0
"RTN","LEX2059",156,0)
 Q 1
"RTN","LEX2059",157,0)
CPD(X) ;   Check Current Patched Data is installed
"RTN","LEX2059",158,0)
 N INS S INS=1
"RTN","LEX2059",159,0)
 Q 0
"RTN","LEX2059",160,0)
LPD(X) ; Check for Last Patched Data Installed (patch 41)
"RTN","LEX2059",161,0)
 N COM,CON,KID,FUL,ER1,ER2,IND,PAT,SA,ST,STA,STT,TGT,TM,INS S PAT="LEX*2.0*41",INS=1
"RTN","LEX2059",162,0)
 D FIND^DIC(9.7,,".01;.02I;11I;17I","C",PAT,50,,,,"TGT","MSG")
"RTN","LEX2059",163,0)
 S IND="",STA="not installed",KID=0 S IND=$O(TGT("DILIST","ID"," "),-1) I +IND>0 D
"RTN","LEX2059",164,0)
 . N ST,SA,TM S ST=$G(TGT("DILIST","ID",+IND,.02)),SA=$G(TGT("DILIST","ID",+IND,11)),TM=$G(TGT("DILIST","ID",+IND,17))
"RTN","LEX2059",165,0)
 . S IND="" S:+($G(ST))=3&(+TM>0) IND=+TM,STA="install completed "_$TR($$FMTE^XLFDT(+TM,"5Z"),"@"," "),KID=1
"RTN","LEX2059",166,0)
 . S:(+SA>0)&(+TM'>0) STA="install started "_$TR($$FMTE^XLFDT(+SA,"5Z"),"@"," ")
"RTN","LEX2059",167,0)
 S:$L(STA) ER1=PAT_" "_STA
"RTN","LEX2059",168,0)
 ;
"RTN","LEX2059",169,0)
 S CON="" S:+IND'>0 IND="" S (STT,FUL)=1
"RTN","LEX2059",170,0)
 ; Started (First SET)
"RTN","LEX2059",171,0)
 S:$G(^LEX(757,7000001,0))'="7000001" STT=0
"RTN","LEX2059",172,0)
 ; Last SET
"RTN","LEX2059",173,0)
 S:'$D(^LEX(757.21,"C","[X]ZYGOMYCOSIS, UNSPECIFIED",7444769)) FUL=0
"RTN","LEX2059",174,0)
 ; Last KILL
"RTN","LEX2059",175,0)
 S:$D(^LEX(757.21,"C","POSTOPERATIVE SHOCK",3567)) FUL=0
"RTN","LEX2059",176,0)
 ; Content
"RTN","LEX2059",177,0)
 S:STT>0&(FUL'>0) CON="data partially installed",ER2="Data for patch LEX*2.0*41 was partially installed"
"RTN","LEX2059",178,0)
 S:STT>0&(FUL>0) CON="data fully installed"
"RTN","LEX2059",179,0)
 S:+STT'>0 CON="data not installed",ER2="Data for patch LEX*2.0*41 was not installed"
"RTN","LEX2059",180,0)
 S COM=""
"RTN","LEX2059",181,0)
 ; Comment
"RTN","LEX2059",182,0)
 I $L(STA)!($L(CON)) D
"RTN","LEX2059",183,0)
 . S:$L(STA)&($L(CON)) COM=PAT_" "_STA_" ("_CON_")"
"RTN","LEX2059",184,0)
 . S:$L(STA)&('$L(CON)) COM=PAT_" "_STA
"RTN","LEX2059",185,0)
 . S:'$L(STA)&($L(CON)) COM=PAT_" "_CON
"RTN","LEX2059",186,0)
 ; Installed
"RTN","LEX2059",187,0)
 S:KID'>0!(FUL'>0) INS=0
"RTN","LEX2059",188,0)
 ; Error
"RTN","LEX2059",189,0)
 I INS'>0 D
"RTN","LEX2059",190,0)
 . D ET("") D:$L(ER1) ET(ER1) D:$L(ER2) ET(ER2)
"RTN","LEX2059",191,0)
 . D:KID>0&($L(ER2)) ET("Please re-install LEX*2.0*41 using the install"),ET("instructions in LEX*2.0*60 before continuing")
"RTN","LEX2059",192,0)
 . D:KID'>0&($L(ER2)) ET("Please install LEX*2.0*41 using the install"),ET("instructions in LEX*2.0*60 before continuing")
"RTN","LEX2059",193,0)
 S X=INS S:+INS>0&($L($G(COM))) X=X_"^"_$G(COM)
"RTN","LEX2059",194,0)
 Q X
"RTN","LEX2059",195,0)
BREAK ;
"RTN","LEX2059",196,0)
 K ^LEX(757.21,"C","[X]ZYGOMYCOSIS, UNSPECIFIED",7444769) D ENV,FIX
"RTN","LEX2059",197,0)
 Q
"RTN","LEX2059",198,0)
FIX ;
"RTN","LEX2059",199,0)
 S ^LEX(757.21,"C","[X]ZYGOMYCOSIS, UNSPECIFIED",7444769)=""
"RTN","LEX2059",200,0)
 Q
"RTN","LEX2059",201,0)
 ;               
"RTN","LEX2059",202,0)
 ; Error messages
"RTN","LEX2059",203,0)
 ;
"RTN","LEX2059",204,0)
CM ;   Missing ^LEXM
"RTN","LEX2059",205,0)
 N LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR D IMP D ET(""),ET("Missing import global ^LEXM.") D CO
"RTN","LEX2059",206,0)
 Q
"RTN","LEX2059",207,0)
CW ;   Wrong ^LEXM
"RTN","LEX2059",208,0)
 N LEXB,LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR D IMP S LEXB=$G(^LEXM(0,"BUILD")) D ET("")
"RTN","LEX2059",209,0)
 I $L(LEXBUILD),$L(LEXB),LEXBUILD'=LEXB D  Q
"RTN","LEX2059",210,0)
 . D ET(("Incorrect import global ^LEXM found ("_LEXB_" global).")) D CKO
"RTN","LEX2059",211,0)
 D ET("Incorrect import global ^LEXM found.") D CKO
"RTN","LEX2059",212,0)
 Q
"RTN","LEX2059",213,0)
CU ;   Unable to verify
"RTN","LEX2059",214,0)
 N LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR D IMP D ET(""),ET("Unable to verify checksum for import global ^LEXM (possibly corrupt).") D CKO
"RTN","LEX2059",215,0)
 Q
"RTN","LEX2059",216,0)
CF ;   Failed checksum
"RTN","LEX2059",217,0)
 N LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR D IMP D ET("") D ET("Import global ^LEXM failed checksum.") D CKO
"RTN","LEX2059",218,0)
 Q
"RTN","LEX2059",219,0)
CO ;   Obtain new global
"RTN","LEX2059",220,0)
 N LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR D IMP
"RTN","LEX2059",221,0)
 D ET(""),ET("    Please obtain a copy of the import global ^LEXM contained in the ")
"RTN","LEX2059",222,0)
 D ET(("    global host file "_LEXIGHF_" before continuing with the "_LEXBUILD))
"RTN","LEX2059",223,0)
 D ET(("    installation."))
"RTN","LEX2059",224,0)
 Q
"RTN","LEX2059",225,0)
CKO ;   Kill and Obtain new global
"RTN","LEX2059",226,0)
 N LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR D IMP
"RTN","LEX2059",227,0)
 D ET(""),ET("    Please KILL the existing import global ^LEXM from your system")
"RTN","LEX2059",228,0)
 D ET(("    and obtain a new copy of ^LEXM contained in the global host file"))
"RTN","LEX2059",229,0)
 D ET(("    "_LEXIGHF_" before continuing with the "_LEXBUILD_" installation."))
"RTN","LEX2059",230,0)
 Q
"RTN","LEX2059",231,0)
ET(X) ;   Error Text
"RTN","LEX2059",232,0)
 N LEXI S LEXI=+($G(LEXE(0))),LEXI=LEXI+1,LEXE(LEXI)="    "_$G(X),LEXE(0)=LEXI
"RTN","LEX2059",233,0)
 Q
"RTN","LEX2059",234,0)
ED ;   Error Display
"RTN","LEX2059",235,0)
 N LEXI S LEXI=0 F  S LEXI=$O(LEXE(LEXI)) Q:+LEXI=0  D M(LEXE(LEXI))
"RTN","LEX2059",236,0)
 D M(" ") K LEXE Q
"RTN","LEX2059",237,0)
 ;                   
"RTN","LEX2059",238,0)
 ; Miscellaneous
"RTN","LEX2059",239,0)
 ;
"RTN","LEX2059",240,0)
NOTDEF(IEN) ;   Check to see if user is defined
"RTN","LEX2059",241,0)
 N DA,DR,DIQ,LEX,DIC S DA=IEN,DR=.01,DIC=200,DIQ="LEX" D EN^DIQ1 Q '$D(LEX)
"RTN","LEX2059",242,0)
OK ;   Environment is OK
"RTN","LEX2059",243,0)
 N LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR,LEXT
"RTN","LEX2059",244,0)
 D IMP S LEXT="  Environment "_$S($L(LEXBUILD):("for patch/build "_LEXBUILD_" "),1:"")_"is ok"
"RTN","LEX2059",245,0)
 D BM(LEXT),M(" ")
"RTN","LEX2059",246,0)
 Q
"RTN","LEX2059",247,0)
BM(X) ;   Blank Line with Message
"RTN","LEX2059",248,0)
 D BMES^XPDUTL($G(X)) Q
"RTN","LEX2059",249,0)
M(X) ;   Message
"RTN","LEX2059",250,0)
 D MES^XPDUTL($G(X)) Q
"RTN","LEX2059",251,0)
TRIM(X) ;   Trim Spaces
"RTN","LEX2059",252,0)
 S X=$G(X) F  Q:$E(X,1)'=" "  S X=$E(X,2,$L(X))
"RTN","LEX2059",253,0)
 F  Q:$E(X,$L(X))'=" "  S X=$E(X,1,($L(X)-1))
"RTN","LEX2059",254,0)
 Q X
"RTN","LEX2059",255,0)
IMP ;   Import names
"RTN","LEX2059",256,0)
 ;     Patch Type
"RTN","LEX2059",257,0)
 S LEXPTYPE="Code Set Remedy Ticket Fixes"
"RTN","LEX2059",258,0)
 S LEXPTYPE="Code Set Update"
"RTN","LEX2059",259,0)
 ;     Revision
"RTN","LEX2059",260,0)
 S LEXLREV=59
"RTN","LEX2059",261,0)
 ;     Required Builds
"RTN","LEX2059",262,0)
 S LEXREQP="LEX*2.0*56;LEX*2.0*41"
"RTN","LEX2059",263,0)
 ;     This Build Name
"RTN","LEX2059",264,0)
 S LEXBUILD="LEX*2.0*59"
"RTN","LEX2059",265,0)
 ;     This Build's Export Global Host Filename
"RTN","LEX2059",266,0)
 S LEXIGHF="LEX_2_59.GBL"
"RTN","LEX2059",267,0)
 ;     Fiscal Year
"RTN","LEX2059",268,0)
 S LEXFY="FY08"
"RTN","LEX2059",269,0)
 ;     Quarter
"RTN","LEX2059",270,0)
 S LEXQTR="4th"
"RTN","LEX2059",271,0)
 Q
"RTN","LEX2059",272,0)
EF ;   Exported Files
"RTN","LEX2059",273,0)
 ;;^LEX(757.01);^LEX(*;Lexicon;757-757.41
"RTN","LEX2059",274,0)
 ;;^LEXT(757.2);^LEXT(757.2);Lexicon Subsets/Defaults;757.2
"RTN","LEX2059",275,0)
 ;;^ICPT(0);^ICPT(;CPT/HCPCS;81
"RTN","LEX2059",276,0)
 ;;^DIC(81.1,0);^DIC(81.1);CPT Category;81.1
"RTN","LEX2059",277,0)
 ;;^DIC(81.2,0);^DIC(81.2);CPT Copyright;81.2
"RTN","LEX2059",278,0)
 ;;^DIC(81.3,0);^DIC(81.3);CPT Modifier;81.3
"RTN","LEX2059",279,0)
 ;;^ICD9(0);^ICD9(;ICD Diagnosis;80
"RTN","LEX2059",280,0)
 ;;^ICD0(0);^ICD0(;ICD Operation/Procedure;80.1
"RTN","LEX2059",281,0)
 ;;^ICD(0);^ICD(;DRG Grouper;80.2
"RTN","LEX2059",282,0)
 ;;^ICM(0);^ICM(;MAJOR DIAGNOSTIC CATEGORY;80.3
"RTN","LEX2059",283,0)
 ;;^ICD9(0);^ICD9(;ICD Diagnosis;80
"RTN","LEX2059",284,0)
 Q
"RTN","LEX2059",285,0)
GD ;   Global Data
"RTN","LEX2059",286,0)
 ;;^LEX(757.01);^LEX(*;Lexicon;757-757.41
"RTN","LEX2059",287,0)
 ;;^ICPT(0);^ICPT(;CPT/HCPCS;81
"RTN","LEX2059",288,0)
 ;;^DIC(81.1,0);^DIC(81.1);CPT Category;81.1
"RTN","LEX2059",289,0)
 ;;^DIC(81.3,0);^DIC(81.3);CPT Modifier;81.3
"RTN","LEX2059P")
0^1^B2424109^n/a
"RTN","LEX2059P",1,0)
LEX2059P ;ISL/KER - LEX*2.0*59 Pre/Post Install ;07/16/2008
"RTN","LEX2059P",2,0)
 ;;2.0;LEXICON UTILITY;**59**;Sep 23, 1996;Build 6
"RTN","LEX2059P",3,0)
 ;              
"RTN","LEX2059P",4,0)
 ; Variables NEWed or KILLed Elsewhere
"RTN","LEX2059P",5,0)
 ;    None
"RTN","LEX2059P",6,0)
 ;              
"RTN","LEX2059P",7,0)
 ; Global Variables
"RTN","LEX2059P",8,0)
 ;    ^LEXM
"RTN","LEX2059P",9,0)
 ;              
"RTN","LEX2059P",10,0)
 ; External References
"RTN","LEX2059P",11,0)
 ;    None
"RTN","LEX2059P",12,0)
 ;              
"RTN","LEX2059P",13,0)
 Q
"RTN","LEX2059P",14,0)
POST ; LEX*2.0*59 Post-Install
"RTN","LEX2059P",15,0)
 ;            
"RTN","LEX2059P",16,0)
 ; From IMP^LEX2059
"RTN","LEX2059P",17,0)
 ;            
"RTN","LEX2059P",18,0)
 ;      LEXBUILD   Build Name - LEX*2.0*nn
"RTN","LEX2059P",19,0)
 ;      LEXPTYPE   Patch Type - Remedy or Quarterly
"RTN","LEX2059P",20,0)
 ;      LEXFY      Fiscal Year - FYnn
"RTN","LEX2059P",21,0)
 ;      LEXQTR     Quarter - 1st, 2nd, 3rd, or 4th
"RTN","LEX2059P",22,0)
 ;      LEXIGHF    Name of Host File - LEX_2_nn.GBL
"RTN","LEX2059P",23,0)
 ;      LEXLREV    Revision - nn
"RTN","LEX2059P",24,0)
 ;      LEXREQP    Required Builds - build;build;build
"RTN","LEX2059P",25,0)
 ;            
"RTN","LEX2059P",26,0)
 N LEXEDT,LEXPTYPE,LEXLREV,LEXREQP,LEXBUILD,LEXIGHF,LEXFY,LEXQTR,LEXB,LEXCD,LEXSTR,LEXLAST D IMP^LEX2059
"RTN","LEX2059P",27,0)
 S LEXEDT=$G(^LEXM(0,"CREATED")) D LOAD
"RTN","LEX2059P",28,0)
 Q
"RTN","LEX2059P",29,0)
LOAD ; Load Data
"RTN","LEX2059P",30,0)
 ;             
"RTN","LEX2059P",31,0)
 ;      LEXSHORT   Send Short Message
"RTN","LEX2059P",32,0)
 ;      LEXMSG     Flag to send Message
"RTN","LEX2059P",33,0)
 ;            
"RTN","LEX2059P",34,0)
 N LEXSHORT,LEXMSG S LEXSHORT="",LEXMSG=""
"RTN","LEX2059P",35,0)
 S LEXSTR=$G(LEXPTYPE) S:$L($G(LEXFY))&($L($G(LEXQTR))) LEXSTR=LEXSTR_" for "_$G(LEXFY)_" "_$G(LEXQTR)_" Quarter"
"RTN","LEX2059P",36,0)
 S U="^",LEXB=$G(^LEXM(0,"BUILD")) Q:LEXB=""  Q:LEXBUILD=""
"RTN","LEX2059P",37,0)
 D:LEXB=LEXBUILD EN^LEXXGI
"RTN","LEX2059P",38,0)
LQ ; Load Quit
"RTN","LEX2059P",39,0)
 D KLEXM
"RTN","LEX2059P",40,0)
 Q
"RTN","LEX2059P",41,0)
 ;             
"RTN","LEX2059P",42,0)
KLEXM ; Subscripted Kill of ^LEXM
"RTN","LEX2059P",43,0)
 H 2 N DA S DA=0 F  S DA=$O(^LEXM(DA)) Q:+DA=0  K ^LEXM(DA)
"RTN","LEX2059P",44,0)
 N LEX S LEX=$G(^LEXM(0,"PRO")) K ^LEXM(0)
"RTN","LEX2059P",45,0)
 Q
"RTN","LEX2059P",46,0)
 ;            
"RTN","LEX2059P",47,0)
PRE ; LEX*2.0*59 Pre-Install   (N/A for patch 59)
"RTN","LEX2059P",48,0)
 Q
"RTN","LEX2059P",49,0)
 ;            
"RTN","LEX2059P",50,0)
CON ; Conversion of data       (N/A for patch 59)
"RTN","LEX2059P",51,0)
 Q
"RTN","LEXTRAN")
0^7^B59128681^B59640556
"RTN","LEXTRAN",1,0)
LEXTRAN ;ISL/FJF - Lexicon code and text wrapper API's ;07/16/2008
"RTN","LEXTRAN",2,0)
 ;;2.0;LEXICON UTILITY;**41,59**;Sep 23, 1996;Build 6
"RTN","LEXTRAN",3,0)
 ; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","LEXTRAN",4,0)
 ;
"RTN","LEXTRAN",5,0)
CODE(LEXCODE,LEXSRC,LEXVDT,LEXRAY) ;
"RTN","LEXTRAN",6,0)
 ; Lexicon wrapper application to obtain concept data for a given code
"RTN","LEXTRAN",7,0)
 ; and source
"RTN","LEXTRAN",8,0)
 ; 
"RTN","LEXTRAN",9,0)
 ; Input
"RTN","LEXTRAN",10,0)
 ; 
"RTN","LEXTRAN",11,0)
 ;   LEXCODE  code - mandatory
"RTN","LEXTRAN",12,0)
 ;   LEXSRC   code system source abbreviation e.g. SCT (SNOMED CT)
"RTN","LEXTRAN",13,0)
 ;            - mandatory
"RTN","LEXTRAN",14,0)
 ;   LEXVDT   effective date (defaults to current date) - optional
"RTN","LEXTRAN",15,0)
 ;   LEXRAY   output array (defaults to 'LEX') optionaL
"RTN","LEXTRAN",16,0)
 ;   
"RTN","LEXTRAN",17,0)
 ; Output
"RTN","LEXTRAN",18,0)
 ; 
"RTN","LEXTRAN",19,0)
 ;   if call finds an active code for the source
"RTN","LEXTRAN",20,0)
 ;     "1^LEXCODE"
"RTN","LEXTRAN",21,0)
 ;     LEX     -   an array containing information about the code
"RTN","LEXTRAN",22,0)
 ;     LEX(0)  -   a five piece string:
"RTN","LEXTRAN",23,0)
 ;                 1. code
"RTN","LEXTRAN",24,0)
 ;                 2. hierarchy
"RTN","LEXTRAN",25,0)
 ;                 3. version
"RTN","LEXTRAN",26,0)
 ;                 4. legacy code
"RTN","LEXTRAN",27,0)
 ;                 5. code status
"RTN","LEXTRAN",28,0)
 ;     LEX("F")    fully specified name
"RTN","LEXTRAN",29,0)
 ;     LEX("P")    preferred term
"RTN","LEXTRAN",30,0)
 ;     LEX("S",n)  synonyms (n is the nth synonym)
"RTN","LEXTRAN",31,0)
 ;     
"RTN","LEXTRAN",32,0)
 ;   if call cannot find specified code on file
"RTN","LEXTRAN",33,0)
 ;     "-2^"_LEXSCNM_" code "_LEXCODE_" not on file"
"RTN","LEXTRAN",34,0)
 ;     where LEXSCNM is the source name
"RTN","LEXTRAN",35,0)
 ;           LEXCODE is the code
"RTN","LEXTRAN",36,0)
 ;                 
"RTN","LEXTRAN",37,0)
 ;   if call finds an inactive code for the source
"RTN","LEXTRAN",38,0)
 ;     "-4^"_LEXSCNM_" code "_LEXCODE_" not active for "_LEXVDT
"RTN","LEXTRAN",39,0)
 ;     LEX    - an array containing information about the code
"RTN","LEXTRAN",40,0)
 ;     LEX(0) -  a five piece string:
"RTN","LEXTRAN",41,0)
 ;               1. code
"RTN","LEXTRAN",42,0)
 ;               2. hierarchy
"RTN","LEXTRAN",43,0)
 ;               3. version
"RTN","LEXTRAN",44,0)
 ;               4. legacy code
"RTN","LEXTRAN",45,0)
 ;               5. code status
"RTN","LEXTRAN",46,0)
 ;     
"RTN","LEXTRAN",47,0)
 ;   otherwise
"RTN","LEXTRAN",48,0)
 ;     "-1^error text" 
"RTN","LEXTRAN",49,0)
 ; 
"RTN","LEXTRAN",50,0)
 ;   example of LEX array:
"RTN","LEXTRAN",51,0)
 ;     LEX(0)="67922002^Substance^20050701^T-C2500^1"
"RTN","LEXTRAN",52,0)
 ;     LEX("F")="Serum (Substance)"
"RTN","LEXTRAN",53,0)
 ;     LEX("P")="Serum"
"RTN","LEXTRAN",54,0)
 ;                        
"RTN","LEXTRAN",55,0)
 ; check passed parameter arguments
"RTN","LEXTRAN",56,0)
 ;
"RTN","LEXTRAN",57,0)
 I $G(LEXCODE)="" Q "-1^no code specified"
"RTN","LEXTRAN",58,0)
 I $G(LEXSRC)="" Q "-1^no source specified"
"RTN","LEXTRAN",59,0)
 I '$D(^LEX(757.03,"B",LEXSRC)) Q "-1^source not recognized"
"RTN","LEXTRAN",60,0)
 I $D(^TMP("LEXSCH",$J,"VDT",0)) S LEXVDT=^(0)
"RTN","LEXTRAN",61,0)
 I $G(LEXVDT)'="" S LEXVDT=$$INTDAT(LEXVDT)
"RTN","LEXTRAN",62,0)
 I $G(LEXVDT)=-1 Q "-1^invalid date format"
"RTN","LEXTRAN",63,0)
 I $G(LEXVDT)="" S LEXVDT=$$DT^XLFDT
"RTN","LEXTRAN",64,0)
 I $G(LEXRAY)="" K LEXRAY
"RTN","LEXTRAN",65,0)
 ;
"RTN","LEXTRAN",66,0)
 ; obtain source mnemonic and ASAB
"RTN","LEXTRAN",67,0)
 ;
"RTN","LEXTRAN",68,0)
 N LEXSCNM,LEXSIEN,LEXASAB,LEXCIEN,VALCODE,LEXSTAT,LEXPIEN,T
"RTN","LEXTRAN",69,0)
 ;
"RTN","LEXTRAN",70,0)
 S LEXSIEN=$O(^LEX(757.03,"B",LEXSRC,""))
"RTN","LEXTRAN",71,0)
 S T=^LEX(757.03,LEXSIEN,0)
"RTN","LEXTRAN",72,0)
 S LEXSCNM=$P(T,U,2)
"RTN","LEXTRAN",73,0)
 S LEXASAB=$E($P(T,U),1,3)
"RTN","LEXTRAN",74,0)
 ;
"RTN","LEXTRAN",75,0)
 ; check for code existence for source
"RTN","LEXTRAN",76,0)
 ; 
"RTN","LEXTRAN",77,0)
 S LEXCIEN="",VALCODE=0
"RTN","LEXTRAN",78,0)
 F  Q:VALCODE=1  D  Q:LEXCIEN=""
"RTN","LEXTRAN",79,0)
 .S LEXCIEN=$O(^LEX(757.02,"CODE",LEXCODE_" ",LEXCIEN)) Q:LEXCIEN=""  D
"RTN","LEXTRAN",80,0)
 .I $D(^LEX(757.02,"ASRC",LEXASAB,LEXCIEN)) S VALCODE=1 Q
"RTN","LEXTRAN",81,0)
 I 'VALCODE Q "-2^"_LEXSCNM_" code "_LEXCODE_" not on file"
"RTN","LEXTRAN",82,0)
 ;
"RTN","LEXTRAN",83,0)
 ; now we know that the code belongs to the source and that it is known
"RTN","LEXTRAN",84,0)
 ; in our files
"RTN","LEXTRAN",85,0)
 ; check that code is valid for date
"RTN","LEXTRAN",86,0)
 ;
"RTN","LEXTRAN",87,0)
 K LEXSTAT,LEX
"RTN","LEXTRAN",88,0)
 K ^TMP("LEXSCH",$J)
"RTN","LEXTRAN",89,0)
 S LEXSTAT=$$STATCHK^LEXSRC2(LEXCODE,LEXVDT,.LEXSTAT)
"RTN","LEXTRAN",90,0)
 I +LEXSTAT=0 D  Q "-4^"_LEXSCNM_" code "_LEXCODE_" not active for "_LEXVDT
"RTN","LEXTRAN",91,0)
 .S LEXPIEN=$P(LEXSTAT(1),U)
"RTN","LEXTRAN",92,0)
 .;D INFO^LEXA(LEXPIEN)
"RTN","LEXTRAN",93,0)
 .D GETINFO
"RTN","LEXTRAN",94,0)
 .I $D(LEXRAY),LEXRAY'="LEX" M @LEXRAY=LEX K LEX
"RTN","LEXTRAN",95,0)
 ;
"RTN","LEXTRAN",96,0)
 ; if we've got this far we have a good code that is active
"RTN","LEXTRAN",97,0)
 S LEXPIEN=$P(LEXSTAT(1),U)
"RTN","LEXTRAN",98,0)
 ;Q "1^"_LEXCODE
"RTN","LEXTRAN",99,0)
 ;D INFO^LEXA(LEXPIEN)
"RTN","LEXTRAN",100,0)
 D GETINFO
"RTN","LEXTRAN",101,0)
 I $D(LEXRAY),LEXRAY'="LEX" M @LEXRAY=LEX K LEX
"RTN","LEXTRAN",102,0)
 ; 
"RTN","LEXTRAN",103,0)
 Q "1^"_LEXCODE
"RTN","LEXTRAN",104,0)
 ;
"RTN","LEXTRAN",105,0)
GETINFO ; obtain information for code and populate LEX array
"RTN","LEXTRAN",106,0)
 ;
"RTN","LEXTRAN",107,0)
 N LEXFSN,LEXHIER,LEXLGY,LEXVER,N,LEXSEP,I
"RTN","LEXTRAN",108,0)
 ;I $D(LEX("SEL","EXP","C","FUL")) D
"RTN","LEXTRAN",109,0)
 ;.S LEXFSN=LEX("SEL","EXP",$O(LEX("SEL","EXP","C","FUL","")))
"RTN","LEXTRAN",110,0)
 ;.S LEXHIER=$P($P(LEXFSN,"(",$L(LEXFSN,"(")),")")
"RTN","LEXTRAN",111,0)
 ; designations
"RTN","LEXTRAN",112,0)
 S LEX=$$GETSYN^LEXTRAN1(LEXSRC,LEXCODE,LEXVDT)
"RTN","LEXTRAN",113,0)
 ; legacy code
"RTN","LEXTRAN",114,0)
 S LEXLGY=$$GET1^DIQ(757.02,LEXCIEN_",",13)
"RTN","LEXTRAN",115,0)
 ; hierarchy
"RTN","LEXTRAN",116,0)
 I $D(LEX("F")) S LEXHIER=$P($P(LEX("F"),"(",$L(LEX("F"),"(")),")")
"RTN","LEXTRAN",117,0)
 ; version
"RTN","LEXTRAN",118,0)
 S LEXVER=$$VERSION(LEXSRC,LEXCODE,LEXVDT)
"RTN","LEXTRAN",119,0)
 ; create return array
"RTN","LEXTRAN",120,0)
 ;S LEXSEP=" ["_LEXCODE_"]"
"RTN","LEXTRAN",121,0)
 S LEX(0)=LEXCODE_U_$G(LEXHIER)_U_$S(+LEXVER=-1:"",1:$P(LEXVER,U,3))
"RTN","LEXTRAN",122,0)
 S LEX(0)=LEX(0)_U_LEXLGY_U_+LEXSTAT
"RTN","LEXTRAN",123,0)
 I $D(LEX("F")) S LEXHIER=$P($P(LEX("F"),"(",$L(LEX("F"),"(")),")")
"RTN","LEXTRAN",124,0)
 ;S LEX("P")=$P(LEX("SEL","EXP",$O(LEX("SEL","EXP","C","MAJ",""))),U,2)
"RTN","LEXTRAN",125,0)
 ;I $D(LEXFSN) S LEX("F")=$P(LEXFSN,"^",2)
"RTN","LEXTRAN",126,0)
 ;S N=""
"RTN","LEXTRAN",127,0)
 ;F I=1:1 S N=$O(LEX("SEL","EXP","C","SYN",N)) Q:N=""  D
"RTN","LEXTRAN",128,0)
 ;.S LEX("S",I)=$P(LEX("SEL","EXP",N),U,2)
"RTN","LEXTRAN",129,0)
 K LEX("SEL")
"RTN","LEXTRAN",130,0)
 Q
"RTN","LEXTRAN",131,0)
 ;
"RTN","LEXTRAN",132,0)
TEXT(LEXTEXT,LEXVDT,LEXSUB,LEXSRC,LEXRAY) ;
"RTN","LEXTRAN",133,0)
 ;
"RTN","LEXTRAN",134,0)
 ; Lexicon wrapper application to obtain concept data for a given text
"RTN","LEXTRAN",135,0)
 ; and source
"RTN","LEXTRAN",136,0)
 ; 
"RTN","LEXTRAN",137,0)
 ; Input
"RTN","LEXTRAN",138,0)
 ;   
"RTN","LEXTRAN",139,0)
 ;   LEXTEXT  the search string - mandatory
"RTN","LEXTRAN",140,0)
 ;   LEXVDT   effective date (defaults to current date) - optional
"RTN","LEXTRAN",141,0)
 ;   LEXSUB   subset or 'hierarchy' - optional
"RTN","LEXTRAN",142,0)
 ;   LEXSRC   code system source abbreviation e.g. SCT (SNOMED CT)
"RTN","LEXTRAN",143,0)
 ;            - optional
"RTN","LEXTRAN",144,0)
 ;   LEXRAY   output array  (defaults to 'LEX')- optional
"RTN","LEXTRAN",145,0)
 ;   
"RTN","LEXTRAN",146,0)
 ; Output
"RTN","LEXTRAN",147,0)
 ;    
"RTN","LEXTRAN",148,0)
 ;   LEX or passed array name    - an array containing information
"RTN","LEXTRAN",149,0)
 ;                                 about the code
"RTN","LEXTRAN",150,0)
 ;     LEX(0) -  a five piece string:
"RTN","LEXTRAN",151,0)
 ;               1. code
"RTN","LEXTRAN",152,0)
 ;               2. hierarchy
"RTN","LEXTRAN",153,0)
 ;               3. version
"RTN","LEXTRAN",154,0)
 ;               4. legacy code
"RTN","LEXTRAN",155,0)
 ;               5. code status
"RTN","LEXTRAN",156,0)
 ;     
"RTN","LEXTRAN",157,0)
 ;   otherwise
"RTN","LEXTRAN",158,0)
 ;     "-1^error text" 
"RTN","LEXTRAN",159,0)
 ; 
"RTN","LEXTRAN",160,0)
 ;   example of LEX array:
"RTN","LEXTRAN",161,0)
 ;     LEX(0)="67922002^Substance^20050701^T-C2500^1"
"RTN","LEXTRAN",162,0)
 ;     LEX("F")="Serum (Substance)"
"RTN","LEXTRAN",163,0)
 ;     LEX("P")="Serum"
"RTN","LEXTRAN",164,0)
 ;     
"RTN","LEXTRAN",165,0)
 I $G(LEXTEXT)="" Q "-1^no search string specified"
"RTN","LEXTRAN",166,0)
 S LEXSRC=$G(LEXSRC)
"RTN","LEXTRAN",167,0)
 I $G(LEXVDT)'="" S LEXVDT=$$INTDAT(LEXVDT)
"RTN","LEXTRAN",168,0)
 I $G(LEXVDT)=-1 Q "-1^invalid date format"
"RTN","LEXTRAN",169,0)
 I $G(LEXVDT)="" S LEXVDT=$$DT^XLFDT
"RTN","LEXTRAN",170,0)
 S LEXSRC=$G(LEXSRC)
"RTN","LEXTRAN",171,0)
 S LEXSUB=$G(LEXSUB) I LEXSUB="" S LEXSUB=LEXSRC
"RTN","LEXTRAN",172,0)
 I $G(LEXRAY)="" K LEXRAY
"RTN","LEXTRAN",173,0)
 ;
"RTN","LEXTRAN",174,0)
 N X,LEXPIEN,LEXCODE,LEXSTAT,LEXCIEN,Y
"RTN","LEXTRAN",175,0)
 K ^TMP("LEXSCH",$J),LEX
"RTN","LEXTRAN",176,0)
 S X=LEXTEXT
"RTN","LEXTRAN",177,0)
 D CONFIG^LEXSET(LEXSRC,LEXSUB,LEXVDT)
"RTN","LEXTRAN",178,0)
 D EN^LEXA1
"RTN","LEXTRAN",179,0)
 I +Y=-1 Q "-1^search could not find term"
"RTN","LEXTRAN",180,0)
 ;
"RTN","LEXTRAN",181,0)
 S LEXPIEN=+Y
"RTN","LEXTRAN",182,0)
 D INFO^LEXA(LEXPIEN)
"RTN","LEXTRAN",183,0)
 S LEXCODE=$O(LEX("SEL","SRC","C",""))
"RTN","LEXTRAN",184,0)
 S LEXSTAT=$$STATCHK^LEXSRC2(LEXCODE,LEXVDT,.LEXSTAT)
"RTN","LEXTRAN",185,0)
 S LEXCIEN=$P(LEXSTAT,U,2)
"RTN","LEXTRAN",186,0)
 S LEXSRC=$P(LEXSTAT(2),U,2)
"RTN","LEXTRAN",187,0)
 D GETINFO
"RTN","LEXTRAN",188,0)
 I $D(LEXRAY),LEXRAY'="LEX" M @LEXRAY=LEX K LEX
"RTN","LEXTRAN",189,0)
 Q "1^"_LEXPIEN
"RTN","LEXTRAN",190,0)
 ;
"RTN","LEXTRAN",191,0)
VERSION(LEXSRC,LEXCODE,LEXVDT) ;
"RTN","LEXTRAN",192,0)
 ; infer version of code
"RTN","LEXTRAN",193,0)
 ; Input
"RTN","LEXTRAN",194,0)
 ;   
"RTN","LEXTRAN",195,0)
 ;   LEXSRC   code system source abbreviation e.g. SCT (SNOMED CT)
"RTN","LEXTRAN",196,0)
 ;   LEXCODE  code - mandatory
"RTN","LEXTRAN",197,0)
 ;   LEXVDT   effective date (defaults to current date) - optional
"RTN","LEXTRAN",198,0)
 ;            - optional
"RTN","LEXTRAN",199,0)
 ;   
"RTN","LEXTRAN",200,0)
 ; Output
"RTN","LEXTRAN",201,0)
 ; 
"RTN","LEXTRAN",202,0)
 ;   1^Version
"RTN","LEXTRAN",203,0)
 ;     or
"RTN","LEXTRAN",204,0)
 ;   -1^error message
"RTN","LEXTRAN",205,0)
 ;      
"RTN","LEXTRAN",206,0)
 I $G(LEXVDT)'="" S LEXVDT=$$INTDAT(LEXVDT)
"RTN","LEXTRAN",207,0)
 I $G(LEXVDT)=-1 Q "-1^invalid date format"
"RTN","LEXTRAN",208,0)
 I $G(LEXVDT)="" S LEXVDT=$$DT^XLFDT
"RTN","LEXTRAN",209,0)
 N SIEN,VIEN,VDAT,LEXSTAT
"RTN","LEXTRAN",210,0)
 S SIEN=$O(^LEX(757.03,"B",LEXSRC,""))
"RTN","LEXTRAN",211,0)
 I '$D(^LEX(757.03,SIEN,1)) Q "-1^No source version data available"
"RTN","LEXTRAN",212,0)
 S LEXSTAT=$$STATCHK^LEXSRC2(LEXCODE,LEXVDT,.LEXSTAT)
"RTN","LEXTRAN",213,0)
 I +LEXSTAT=0 Q "-1^Code not active for date specified"
"RTN","LEXTRAN",214,0)
 S VDAT=$O(^LEX(757.03,SIEN,1,"B",LEXVDT+1),-1)
"RTN","LEXTRAN",215,0)
 S VIEN=$O(^LEX(757.03,SIEN,1,"B",VDAT,""))
"RTN","LEXTRAN",216,0)
 Q "1^"_^LEX(757.03,SIEN,1,VIEN,0)
"RTN","LEXTRAN",217,0)
 ;
"RTN","LEXTRAN",218,0)
 ;
"RTN","LEXTRAN",219,0)
TXT4CS(LEXTEXT,LEXSRC,LEXRAY,LEXSUB) ; Is text valid for an SCT code
"RTN","LEXTRAN",220,0)
 ;
"RTN","LEXTRAN",221,0)
 ; Input
"RTN","LEXTRAN",222,0)
 ; 
"RTN","LEXTRAN",223,0)
 ;   LEXTEXT is term being checked
"RTN","LEXTRAN",224,0)
 ;   LEXSRC is code system mnemonic or IEN
"RTN","LEXTRAN",225,0)
 ;   LEXRAY   output array (defaults to 'LEX') optional
"RTN","LEXTRAN",226,0)
 ;   LEXSUB   subset or 'hierarchy' - optional
"RTN","LEXTRAN",227,0)
 ;   
"RTN","LEXTRAN",228,0)
 ; Output
"RTN","LEXTRAN",229,0)
 ; 
"RTN","LEXTRAN",230,0)
 ;   1^no of finds
"RTN","LEXTRAN",231,0)
 ;     plus
"RTN","LEXTRAN",232,0)
 ;     LEX or passed array name    - an array containing discovered
"RTN","LEXTRAN",233,0)
 ;                                   concept IDs and expression type
"RTN","LEXTRAN",234,0)
 ;                                   for finds                              
"RTN","LEXTRAN",235,0)
 ;     e.g. LEX(113912006)="MAJOR CONCEPT"
"RTN","LEXTRAN",236,0)
 ;     
"RTN","LEXTRAN",237,0)
 ;      or
"RTN","LEXTRAN",238,0)
 ;      
"RTN","LEXTRAN",239,0)
 ;   -1^error message
"RTN","LEXTRAN",240,0)
 ;   
"RTN","LEXTRAN",241,0)
 N EXP,EXIEN,MCIEN,FOUND,CIEN,CODE,EXPTYP,FINDS,LAR,HIER,HIERNAM,LEXW
"RTN","LEXTRAN",242,0)
 I $G(LEXTEXT)="" Q "-1^text not specified"
"RTN","LEXTRAN",243,0)
 I $G(LEXSRC)="" Q "-1^code system not specified"
"RTN","LEXTRAN",244,0)
 I $$CSYSIEN(LEXSRC)+$$CSYSMNEM(LEXSRC)=-2 Q "-1^code system unknown in Lexicon"
"RTN","LEXTRAN",245,0)
 I $G(LEXRAY)="" K LEXRAY
"RTN","LEXTRAN",246,0)
 S LEXSUB=$G(LEXSUB)
"RTN","LEXTRAN",247,0)
 I LEXSUB'="",'$D(^LEXT(757.2,"AA",LEXSUB)) Q "-1^hierarchy unknown in Lexicon"
"RTN","LEXTRAN",248,0)
 S:LEXSRC?.N LEXSRC=$P($$CSYSMNEM(LEXSRC),"^",2)
"RTN","LEXTRAN",249,0)
 ; text IEN's in 757.01
"RTN","LEXTRAN",250,0)
 I '$D(^LEX(757.01,"B",$E($$UP^XLFSTR(LEXTEXT),1,63))) Q "-1^expression unknown in Lexicon"
"RTN","LEXTRAN",251,0)
 ; build an array of expression IENs for text
"RTN","LEXTRAN",252,0)
 S EXIEN=""
"RTN","LEXTRAN",253,0)
 F  S EXIEN=$O(^LEX(757.01,"B",$$UP^XLFSTR(LEXTEXT),EXIEN)) Q:EXIEN=""  D
"RTN","LEXTRAN",254,0)
 .S EXP(EXIEN)=""
"RTN","LEXTRAN",255,0)
 ; scan array to find code for expression (LEXTEXT) for code system (LEXSRC)
"RTN","LEXTRAN",256,0)
 S EXIEN=""
"RTN","LEXTRAN",257,0)
 K LEXW
"RTN","LEXTRAN",258,0)
 S (FOUND,FINDS)=0
"RTN","LEXTRAN",259,0)
 F  S EXIEN=$O(EXP(EXIEN)) Q:EXIEN=""  D
"RTN","LEXTRAN",260,0)
 .S MCIEN=$P(^LEX(757.01,EXIEN,1),U)
"RTN","LEXTRAN",261,0)
 .S EXPTYP=$P(^LEX(757.011,$P(^LEX(757.01,EXIEN,1),U,2),0),U)
"RTN","LEXTRAN",262,0)
 .S CIEN=""
"RTN","LEXTRAN",263,0)
 .F  S CIEN=$O(^LEX(757.02,"AMC",MCIEN,CIEN)) Q:CIEN=""  D
"RTN","LEXTRAN",264,0)
 ..I $P($$CSYSMNEM($P(^LEX(757.02,CIEN,0),U,3)),U,2)=LEXSRC D
"RTN","LEXTRAN",265,0)
 ...S CODE=$P(^LEX(757.02,CIEN,0),U,2)
"RTN","LEXTRAN",266,0)
 ...S (HIER,HIERNAM)=""
"RTN","LEXTRAN",267,0)
 ...I LEXSUB'="" D
"RTN","LEXTRAN",268,0)
 ....K LAR
"RTN","LEXTRAN",269,0)
 ....S LAR=$$CODE(CODE,"SCT",,"LAR")
"RTN","LEXTRAN",270,0)
 ....S HIER=$P(LAR(0),U,2)
"RTN","LEXTRAN",271,0)
 ....S HIERNAM=$P(^LEXT(757.2,$O(^LEXT(757.2,"AA",LEXSUB,"")),0),U)
"RTN","LEXTRAN",272,0)
 ...I LEXSUB'="",HIER'=HIERNAM Q
"RTN","LEXTRAN",273,0)
 ...S FOUND=1
"RTN","LEXTRAN",274,0)
 ...S FINDS=FINDS+1
"RTN","LEXTRAN",275,0)
 ...S LEXW(CODE)=EXPTYP
"RTN","LEXTRAN",276,0)
 M LEX=LEXW
"RTN","LEXTRAN",277,0)
 I $D(LEXRAY),LEXRAY'="LEX" M @LEXRAY=LEX K LEX
"RTN","LEXTRAN",278,0)
 Q FOUND_"^"_FINDS
"RTN","LEXTRAN",279,0)
 ;
"RTN","LEXTRAN",280,0)
CSYSIEN(MNEM) ; return code system IEN for mnemonic
"RTN","LEXTRAN",281,0)
 I '$D(^LEX(757.03,"B",MNEM)) Q "-1^code system unknown in Lexicon"
"RTN","LEXTRAN",282,0)
 Q "1^"_$O(^LEX(757.03,"B",MNEM,""))
"RTN","LEXTRAN",283,0)
 ;
"RTN","LEXTRAN",284,0)
CSYSMNEM(SIEN) ; return code system mnemonic for IEN
"RTN","LEXTRAN",285,0)
 I '$D(^LEX(757.03,SIEN)) Q "-1^code system unknown in Lexicon"
"RTN","LEXTRAN",286,0)
 Q "1^"_$P(^LEX(757.03,SIEN,0),"^")
"RTN","LEXTRAN",287,0)
 ;
"RTN","LEXTRAN",288,0)
INTDAT(X) ; convert date from external format to VA internal format
"RTN","LEXTRAN",289,0)
 N Y
"RTN","LEXTRAN",290,0)
 D ^%DT
"RTN","LEXTRAN",291,0)
 Q Y
"RTN","LEXTRAN1")
0^8^B62011182^n/a
"RTN","LEXTRAN1",1,0)
LEXTRAN1 ;ISL/FJF - Lexicon code and text wrapper API's ;07/16/2008
"RTN","LEXTRAN1",2,0)
 ;;2.0;LEXICON UTILITY;**59**;Sep 23, 1996;Build 6
"RTN","LEXTRAN1",3,0)
 ; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","LEXTRAN1",4,0)
GETSYN(LEXSRC,LEXCODE,LEXVDT,LEXRAY,LEXIENS) ; obtain synonyms
"RTN","LEXTRAN1",5,0)
 ;
"RTN","LEXTRAN1",6,0)
 ; Input
"RTN","LEXTRAN1",7,0)
 ;
"RTN","LEXTRAN1",8,0)
 ;   LEXSRC   code system source abbreviation e.g. SCT (SNOMED CT)
"RTN","LEXTRAN1",9,0)
 ;            - mandatory
"RTN","LEXTRAN1",10,0)
 ;   LEXCODE  code - mandatory
"RTN","LEXTRAN1",11,0)
 ;   LEXVDT   effective date (defaults to current date) - optional
"RTN","LEXTRAN1",12,0)
 ;   LEXRAY   output array (defaults to 'LEX') optional
"RTN","LEXTRAN1",13,0)
 ;   LEXIENS  include expression IENs in output array
"RTN","LEXTRAN1",14,0)
 ;            - optional
"RTN","LEXTRAN1",15,0)
 ;              1 include IENS
"RTN","LEXTRAN1",16,0)
 ;              0 exclude IENS (default)
"RTN","LEXTRAN1",17,0)
 ;
"RTN","LEXTRAN1",18,0)
 ; Output
"RTN","LEXTRAN1",19,0)
 ;
"RTN","LEXTRAN1",20,0)
 ;   if call finds an active code for the source
"RTN","LEXTRAN1",21,0)
 ;     "1^LEXCODE"
"RTN","LEXTRAN1",22,0)
 ;     LEX     -   an array containing information about the code
"RTN","LEXTRAN1",23,0)
 ;     LEX("F")    fully specified name^IEN
"RTN","LEXTRAN1",24,0)
 ;     LEX("P")    preferred term^IEN
"RTN","LEXTRAN1",25,0)
 ;     LEX("S",n)  synonyms^IEN (n is the nth synonym)
"RTN","LEXTRAN1",26,0)
 ;
"RTN","LEXTRAN1",27,0)
 ;   if call cannot find specified code on file
"RTN","LEXTRAN1",28,0)
 ;     "-2^"_LEXSCNM_" code "_LEXCODE_" not on file"
"RTN","LEXTRAN1",29,0)
 ;     where LEXSCNM is the source name
"RTN","LEXTRAN1",30,0)
 ;
"RTN","LEXTRAN1",31,0)
 I $G(LEXCODE)="" Q -1_U_"no code specified"
"RTN","LEXTRAN1",32,0)
 I $G(LEXSRC)="" Q -1_U_"no source specified"
"RTN","LEXTRAN1",33,0)
 I '$D(^LEX(757.03,"B",LEXSRC)) Q -1_U_"source not recognized"
"RTN","LEXTRAN1",34,0)
 I $D(^TMP("LEXSCH",$J,"VDT",0)) S LEXVDT=^(0)
"RTN","LEXTRAN1",35,0)
 I $G(LEXVDT)'="" S LEXVDT=$$INTDAT(LEXVDT)
"RTN","LEXTRAN1",36,0)
 I $G(LEXVDT)=-1 Q -1_U_"invalid date format"
"RTN","LEXTRAN1",37,0)
 I $G(LEXVDT)="" S LEXVDT=$$DT^XLFDT
"RTN","LEXTRAN1",38,0)
 I $G(LEXRAY)="" K LEXRAY
"RTN","LEXTRAN1",39,0)
 S LEXIENS=+$G(LEXIENS)
"RTN","LEXTRAN1",40,0)
 I LEXIENS'=0,LEXIENS'=1 Q -1_U_"if specified, IENS indicator must be 0 or 1"
"RTN","LEXTRAN1",41,0)
 ;
"RTN","LEXTRAN1",42,0)
 ; obtain source mnemonic and ASAB
"RTN","LEXTRAN1",43,0)
 ;
"RTN","LEXTRAN1",44,0)
 N LEXSIEN,LEXCIEN,VALCODE,LEXSTAT,LEXPIEN,T
"RTN","LEXTRAN1",45,0)
 ;
"RTN","LEXTRAN1",46,0)
 ;
"RTN","LEXTRAN1",47,0)
 ; check for code existence for source
"RTN","LEXTRAN1",48,0)
 ; 
"RTN","LEXTRAN1",49,0)
 S LEXCIEN="",VALCODE=0
"RTN","LEXTRAN1",50,0)
 F  Q:VALCODE=1  D  Q:LEXCIEN=""
"RTN","LEXTRAN1",51,0)
 .S LEXCIEN=$O(^LEX(757.02,"CODE",LEXCODE_" ",LEXCIEN)) Q:LEXCIEN=""  D
"RTN","LEXTRAN1",52,0)
 .I $D(^LEX(757.02,"ASRC",$$LEXASAB(LEXSRC),LEXCIEN)) S VALCODE=1 Q
"RTN","LEXTRAN1",53,0)
 I 'VALCODE Q -2_U_$$LEXSCNM(LEXSRC)_" code "_LEXCODE_" not on file"
"RTN","LEXTRAN1",54,0)
 ;
"RTN","LEXTRAN1",55,0)
 ; now we know that the code belongs to the source and that it is known
"RTN","LEXTRAN1",56,0)
 ; in our files
"RTN","LEXTRAN1",57,0)
 ; check that code is valid for date
"RTN","LEXTRAN1",58,0)
 ;
"RTN","LEXTRAN1",59,0)
 K LEXSTAT
"RTN","LEXTRAN1",60,0)
 K ^TMP("LEXSCH",$J)
"RTN","LEXTRAN1",61,0)
 S LEXSTAT=$$STATCHK^LEXSRC2(LEXCODE,LEXVDT,.LEXSTAT)
"RTN","LEXTRAN1",62,0)
 N RESP
"RTN","LEXTRAN1",63,0)
 S RESP=0
"RTN","LEXTRAN1",64,0)
 I +LEXSTAT=0 S RESP=-4_U_$$LEXSCNM(LEXSRC)_" code "_LEXCODE_" not active for "_LEXVDT
"RTN","LEXTRAN1",65,0)
 I +LEXSTAT=-1 S RESP=-8_U_LEXVDT_" precedes earliest activation date for code"
"RTN","LEXTRAN1",66,0)
 ;
"RTN","LEXTRAN1",67,0)
 ; code is good for source for date
"RTN","LEXTRAN1",68,0)
 ; 
"RTN","LEXTRAN1",69,0)
 K LEX
"RTN","LEXTRAN1",70,0)
 N CNIEN,EXIEN,ARR,FINDS,FOUND
"RTN","LEXTRAN1",71,0)
 S LEXCIEN=$$GETCIEN(LEXCODE)
"RTN","LEXTRAN1",72,0)
 S CNIEN=$P(^LEX(757.02,LEXCIEN,0),U,4)
"RTN","LEXTRAN1",73,0)
 S EXIEN="",FINDS=0
"RTN","LEXTRAN1",74,0)
 F  S EXIEN=$O(^LEX(757.01,"AMC",CNIEN,EXIEN)) Q:EXIEN=""  D
"RTN","LEXTRAN1",75,0)
 .S FINDS=FINDS+1
"RTN","LEXTRAN1",76,0)
 .S ARR(EXIEN)=""
"RTN","LEXTRAN1",77,0)
 N CT,EXP,EXTYP,LEXW
"RTN","LEXTRAN1",78,0)
 S EXIEN="",CT=0
"RTN","LEXTRAN1",79,0)
 F  S EXIEN=$O(ARR(EXIEN)) Q:EXIEN=""  D
"RTN","LEXTRAN1",80,0)
 .S EXP=^LEX(757.01,EXIEN,0)
"RTN","LEXTRAN1",81,0)
 .S EXTYP=$P(^LEX(757.01,EXIEN,1),U,2)
"RTN","LEXTRAN1",82,0)
 .I EXTYP=1 S LEXW("P")=EXP_$S(LEXIENS:U_EXIEN,1:"") Q
"RTN","LEXTRAN1",83,0)
 .I EXTYP=8 S LEXW("F")=EXP_$S(LEXIENS:U_EXIEN,1:"") Q
"RTN","LEXTRAN1",84,0)
 .S CT=CT+1
"RTN","LEXTRAN1",85,0)
 .S LEXW("S",CT)=EXP_$S(LEXIENS:U_EXIEN,1:"")
"RTN","LEXTRAN1",86,0)
 M LEX=LEXW
"RTN","LEXTRAN1",87,0)
 I $D(LEXRAY),LEXRAY'="LEX" M @LEXRAY=LEX K LEX
"RTN","LEXTRAN1",88,0)
 I RESP=0 S RESP=''FINDS_U_FINDS
"RTN","LEXTRAN1",89,0)
 Q RESP
"RTN","LEXTRAN1",90,0)
 ;
"RTN","LEXTRAN1",91,0)
GETFSN(LEXSRC,LEXCODE,LEXVDT) ; obtain fully specified name
"RTN","LEXTRAN1",92,0)
 ;
"RTN","LEXTRAN1",93,0)
 ; Input
"RTN","LEXTRAN1",94,0)
 ;
"RTN","LEXTRAN1",95,0)
 ;   LEXSRC   code system source abbreviation e.g. SCT (SNOMED CT)
"RTN","LEXTRAN1",96,0)
 ;            - mandatory
"RTN","LEXTRAN1",97,0)
 ;   LEXCODE  code - mandatory
"RTN","LEXTRAN1",98,0)
 ;   LEXVDT   effective date (defaults to current date) - optional
"RTN","LEXTRAN1",99,0)
 ;
"RTN","LEXTRAN1",100,0)
 ; Output
"RTN","LEXTRAN1",101,0)
 ;
"RTN","LEXTRAN1",102,0)
 ;   if call finds an active code for the source
"RTN","LEXTRAN1",103,0)
 ;     "1^LEXFSN"
"RTN","LEXTRAN1",104,0)
 ;     where LEXFSN is the fully specified name
"RTN","LEXTRAN1",105,0)
 ;   if call cannot find specified code on file
"RTN","LEXTRAN1",106,0)
 ;     "-8^"_LEXSCNM_" code "_LEXCODE_" has no FSN"
"RTN","LEXTRAN1",107,0)
 ;     where LEXSCNM is the source name
"RTN","LEXTRAN1",108,0)
 ;       
"RTN","LEXTRAN1",109,0)
 N SYNS,LEX
"RTN","LEXTRAN1",110,0)
 S SYNS=$$GETSYN(LEXSRC,LEXCODE,$G(LEXVDT))
"RTN","LEXTRAN1",111,0)
 I +SYNS'>0 Q SYNS
"RTN","LEXTRAN1",112,0)
 I $D(LEX("F")) Q 1_U_LEX("F")
"RTN","LEXTRAN1",113,0)
 Q -8_U_$$LEXSCNM(LEXSRC)_" code "_LEXCODE_" has no FSN"
"RTN","LEXTRAN1",114,0)
 ;
"RTN","LEXTRAN1",115,0)
GETPREF(LEXSRC,LEXCODE,LEXVDT) ; obtain preferred term
"RTN","LEXTRAN1",116,0)
 ;
"RTN","LEXTRAN1",117,0)
 ; Input
"RTN","LEXTRAN1",118,0)
 ;
"RTN","LEXTRAN1",119,0)
 ;   LEXSRC   code system source abbreviation e.g. SCT (SNOMED CT)
"RTN","LEXTRAN1",120,0)
 ;            - mandatory
"RTN","LEXTRAN1",121,0)
 ;   LEXCODE  code - mandatory
"RTN","LEXTRAN1",122,0)
 ;   LEXVDT   effective date (defaults to current date) - optional
"RTN","LEXTRAN1",123,0)
 ;
"RTN","LEXTRAN1",124,0)
 ; Output
"RTN","LEXTRAN1",125,0)
 ;
"RTN","LEXTRAN1",126,0)
 ;   if call finds an active code for the source
"RTN","LEXTRAN1",127,0)
 ;     "1^LEXPREF"
"RTN","LEXTRAN1",128,0)
 ;     where LEXPREF is the preferred name
"RTN","LEXTRAN1",129,0)
 ;   if call cannot find specified code on file
"RTN","LEXTRAN1",130,0)
 ;     "-2^"_LEXSCNM_" code "_LEXCODE_" not on file"
"RTN","LEXTRAN1",131,0)
 ;     where LEXSCNM is the source name
"RTN","LEXTRAN1",132,0)
 ;
"RTN","LEXTRAN1",133,0)
 N SYNS,LEX
"RTN","LEXTRAN1",134,0)
 S SYNS=$$GETSYN(LEXSRC,LEXCODE,$G(LEXVDT))
"RTN","LEXTRAN1",135,0)
 I +SYNS'>0 Q SYNS
"RTN","LEXTRAN1",136,0)
 Q 1_U_LEX("P")
"RTN","LEXTRAN1",137,0)
 ;
"RTN","LEXTRAN1",138,0)
GETDES(LEXSRC,LEXTEXT,LEXVDT) ; obtain designation code
"RTN","LEXTRAN1",139,0)
 ;
"RTN","LEXTRAN1",140,0)
 ; Input
"RTN","LEXTRAN1",141,0)
 ;
"RTN","LEXTRAN1",142,0)
 ;   LEXSRC   code system source abbreviation e.g. SCT (SNOMED CT)
"RTN","LEXTRAN1",143,0)
 ;            - mandatory
"RTN","LEXTRAN1",144,0)
 ;   LEXTEXT  displayable text of expression for which designation code is required
"RTN","LEXTRAN1",145,0)
 ;            - mandatory
"RTN","LEXTRAN1",146,0)
 ;   LEXVDT   effective date (defaults to current date) - optional
"RTN","LEXTRAN1",147,0)
 ;
"RTN","LEXTRAN1",148,0)
 ; Output
"RTN","LEXTRAN1",149,0)
 ;
"RTN","LEXTRAN1",150,0)
 ;   if call finds an active code for the source
"RTN","LEXTRAN1",151,0)
 ;     "1^LEXDSG"
"RTN","LEXTRAN1",152,0)
 ;     where LEXDSG is the designation code
"RTN","LEXTRAN1",153,0)
 ;   if call cannot find specified code on file
"RTN","LEXTRAN1",154,0)
 ;     "-2^"_LEXSCNM_" code "_LEXCODE_" not on file"
"RTN","LEXTRAN1",155,0)
 ;     where LEXSCNM is the source name
"RTN","LEXTRAN1",156,0)
 ;
"RTN","LEXTRAN1",157,0)
 I $G(LEXSRC)="" Q -1_U_"no source specified"
"RTN","LEXTRAN1",158,0)
 I '$D(^LEX(757.03,"B",LEXSRC)) Q -1_U_"source not recognized"
"RTN","LEXTRAN1",159,0)
 I $G(LEXTEXT)="" Q -1_U_"no text specified"
"RTN","LEXTRAN1",160,0)
 I $D(^TMP("LEXSCH",$J,"VDT",0)) S LEXVDT=^(0)
"RTN","LEXTRAN1",161,0)
 I $G(LEXVDT)'="" S LEXVDT=$$INTDAT(LEXVDT)
"RTN","LEXTRAN1",162,0)
 I $G(LEXVDT)=-1 Q -1_U_"invalid date format"
"RTN","LEXTRAN1",163,0)
 I $G(LEXVDT)="" S LEXVDT=$$DT^XLFDT
"RTN","LEXTRAN1",164,0)
 ;
"RTN","LEXTRAN1",165,0)
 ; find candidate designations
"RTN","LEXTRAN1",166,0)
 ;
"RTN","LEXTRAN1",167,0)
 N CIEN,CODE,SRC,TARR,XIEN,LEXDSG,INDSUB,SCIEN,CONC
"RTN","LEXTRAN1",168,0)
 S INDSUB=$E($$UP^XLFSTR(LEXTEXT),1,63)
"RTN","LEXTRAN1",169,0)
 S XIEN=""
"RTN","LEXTRAN1",170,0)
 F  S XIEN=$O(^LEX(757.01,"B",INDSUB,XIEN)) Q:XIEN=""  D
"RTN","LEXTRAN1",171,0)
 .I $$UP^XLFSTR(^LEX(757.01,XIEN,0))=$$UP^XLFSTR(LEXTEXT) S TARR(XIEN)=$P(^LEX(757.01,XIEN,1),U)
"RTN","LEXTRAN1",172,0)
 S XIEN=""
"RTN","LEXTRAN1",173,0)
 F  S XIEN=$O(TARR(XIEN)) Q:XIEN=""  D
"RTN","LEXTRAN1",174,0)
 .S CONC=TARR(XIEN)
"RTN","LEXTRAN1",175,0)
 .S (CIEN,SCIEN)=""
"RTN","LEXTRAN1",176,0)
 .F  S SCIEN=$O(^LEX(757.02,"AMC",CONC,SCIEN)) Q:SCIEN=""  D
"RTN","LEXTRAN1",177,0)
 ..S SRC=$P(^LEX(757.02,SCIEN,0),U,3)
"RTN","LEXTRAN1",178,0)
 ..I $O(^LEX(757.03,"B",LEXSRC,""))'=SRC Q
"RTN","LEXTRAN1",179,0)
 ..I $P(^LEX(757.02,SCIEN,0),U,5)'=1 Q
"RTN","LEXTRAN1",180,0)
 ..S CIEN=SCIEN
"RTN","LEXTRAN1",181,0)
 .I CIEN="" K TARR(XIEN) Q
"RTN","LEXTRAN1",182,0)
 .; eliminate if wrong source
"RTN","LEXTRAN1",183,0)
 .S CODE=$P(^LEX(757.02,CIEN,0),U,2)
"RTN","LEXTRAN1",184,0)
 .S SRC=$P(^LEX(757.02,CIEN,0),U,3)
"RTN","LEXTRAN1",185,0)
 .I $O(^LEX(757.03,"B",LEXSRC,""))'=SRC K TARR(XIEN) Q
"RTN","LEXTRAN1",186,0)
 .; eliminate if inactive for LEXVDT
"RTN","LEXTRAN1",187,0)
 .I '+$$STATCHK^LEXSRC2(CODE,LEXVDT) K TARR(XIEN) Q
"RTN","LEXTRAN1",188,0)
 ; get the designation code
"RTN","LEXTRAN1",189,0)
 S XIEN=$O(TARR(""))
"RTN","LEXTRAN1",190,0)
 I XIEN="" Q -1_U_"text not recognized for source"
"RTN","LEXTRAN1",191,0)
 S LEXDSG=$O(^LEX(757.01,XIEN,7,"C",SRC,""))
"RTN","LEXTRAN1",192,0)
 I LEXDSG="" Q -1_U_"no designation code for text and source"
"RTN","LEXTRAN1",193,0)
 Q 1_U_LEXDSG
"RTN","LEXTRAN1",194,0)
 ;
"RTN","LEXTRAN1",195,0)
GETASSN(LEXCODE,LEXMAP,LEXVDT,LEXRAY) ;
"RTN","LEXTRAN1",196,0)
 ; Input
"RTN","LEXTRAN1",197,0)
 ;
"RTN","LEXTRAN1",198,0)
 ;   LEXCODE  code - mandatory
"RTN","LEXTRAN1",199,0)
 ;   LEXMAP   mapping identifier (VUID) or mnemonic - mandatory
"RTN","LEXTRAN1",200,0)
 ;   LEXVDT   effective date (defaults to current date) - optional
"RTN","LEXTRAN1",201,0)
 ;   LEXRAY   output array (defaults to 'LEX') optional
"RTN","LEXTRAN1",202,0)
 ;
"RTN","LEXTRAN1",203,0)
 ; Output
"RTN","LEXTRAN1",204,0)
 ;
"RTN","LEXTRAN1",205,0)
 ;   if call finds active mappings for passed arguments
"RTN","LEXTRAN1",206,0)
 ;     "1^"_number_of_mappings
"RTN","LEXTRAN1",207,0)
 ;     LEX     -        an array containing the mapping target codes
"RTN","LEXTRAN1",208,0)
 ;     LEX = number of mappings
"RTN","LEXTRAN1",209,0)
 ;     LEX(order,code)  mapped codes (order is the order of the mapping)
"RTN","LEXTRAN1",210,0)
 ;                                   (code is the mapping target code)
"RTN","LEXTRAN1",211,0)
 ;
"RTN","LEXTRAN1",212,0)
 ;   if call finds no active mappings for passed arguments
"RTN","LEXTRAN1",213,0)
 ;     "0^0"
"RTN","LEXTRAN1",214,0)
 ;
"RTN","LEXTRAN1",215,0)
 ;   if a bad argument is passed for a parameter then the call returns
"RTN","LEXTRAN1",216,0)
 ;     "-1^"_error_message
"RTN","LEXTRAN1",217,0)
 ;
"RTN","LEXTRAN1",218,0)
 ;   if call cannot find specified code on file
"RTN","LEXTRAN1",219,0)
 ;     "-2^"_LEXSCNM_" code "_LEXCODE_" not on file"
"RTN","LEXTRAN1",220,0)
 ;     where LEXSCNM is the source name
"RTN","LEXTRAN1",221,0)
 ;   
"RTN","LEXTRAN1",222,0)
 ;   Caution
"RTN","LEXTRAN1",223,0)
 ;   -------
"RTN","LEXTRAN1",224,0)
 ;   When the API is invoked in the following way
"RTN","LEXTRAN1",225,0)
 ;   S VAR=$$GETASSN^LEXTRAN1(CODE,MAP,[DATE],[ARR])
"RTN","LEXTRAN1",226,0)
 ;   make sure that ARR'="VAR"
"RTN","LEXTRAN1",227,0)
 ;   e.g. S ORY=$$GETASSN^LEXTRAN1(44452003,"SCT2ICD",,"VAR") is OK
"RTN","LEXTRAN1",228,0)
 ;   but  S VAR=$$GETASSN^LEXTRAN1(44452003,"SCT2ICD",,"VAR") is not OK
"RTN","LEXTRAN1",229,0)
 ;        this would be akin to using the same variable for two purposes. 
"RTN","LEXTRAN1",230,0)
 ;
"RTN","LEXTRAN1",231,0)
 I $G(LEXCODE)="" Q -1_U_"no code specified"
"RTN","LEXTRAN1",232,0)
 I $G(LEXMAP)="" Q -1_U_"no mapping specified"
"RTN","LEXTRAN1",233,0)
 I $G(LEXVDT)'="" S LEXVDT=$$INTDAT(LEXVDT)
"RTN","LEXTRAN1",234,0)
 I $G(LEXVDT)=-1 Q -1_U_"invalid date format"
"RTN","LEXTRAN1",235,0)
 I $G(LEXVDT)="" S LEXVDT=$$DT^XLFDT
"RTN","LEXTRAN1",236,0)
 S LEXRAY=$G(LEXRAY,"LEX")
"RTN","LEXTRAN1",237,0)
 ;
"RTN","LEXTRAN1",238,0)
 N MIDIEN,CSYS,CIEN,VALCD,MORD,MTAR,MIEN,EFDT,STAT,CT
"RTN","LEXTRAN1",239,0)
 ;
"RTN","LEXTRAN1",240,0)
 I '$D(^LEX(757.32,"B",LEXMAP)),'$D(^LEX(757.32,"C",LEXMAP))
"RTN","LEXTRAN1",241,0)
 I $D(^LEX(757.32,"C",LEXMAP)) D
"RTN","LEXTRAN1",242,0)
 .S MIDIEN=$O(^LEX(757.32,"C",LEXMAP,""))
"RTN","LEXTRAN1",243,0)
 I $D(^LEX(757.32,"B",LEXMAP)) D
"RTN","LEXTRAN1",244,0)
 .S MIDIEN=$O(^LEX(757.32,"B",LEXMAP,""))
"RTN","LEXTRAN1",245,0)
 I '$D(MIDIEN) Q -1_U_"not a recognized mapping identifier"
"RTN","LEXTRAN1",246,0)
 S CSYS=$$GET1^DIQ(757.32,MIDIEN_",",3)
"RTN","LEXTRAN1",247,0)
 ;
"RTN","LEXTRAN1",248,0)
 ; check that code exists for coding system
"RTN","LEXTRAN1",249,0)
 ;
"RTN","LEXTRAN1",250,0)
 S CIEN="",VALCD=0
"RTN","LEXTRAN1",251,0)
 F  Q:VALCD=1  D  Q:CIEN=""
"RTN","LEXTRAN1",252,0)
 .S CIEN=$O(^LEX(757.02,"CODE",LEXCODE_" ",CIEN)) Q:CIEN=""  D
"RTN","LEXTRAN1",253,0)
 .S VALCD=''$D(^LEX(757.02,"ASRC",$$LEXASAB(CSYS),CIEN))
"RTN","LEXTRAN1",254,0)
 I 'VALCD Q -2_U_$$LEXSCNM(CSYS)_" code "_LEXCODE_" not on file"
"RTN","LEXTRAN1",255,0)
 ;
"RTN","LEXTRAN1",256,0)
 ; obtain mappings that are valid for date passed
"RTN","LEXTRAN1",257,0)
 ;
"RTN","LEXTRAN1",258,0)
 S (MORD,MTAR,MIEN)=""
"RTN","LEXTRAN1",259,0)
 K LEX
"RTN","LEXTRAN1",260,0)
 S LEX=0
"RTN","LEXTRAN1",261,0)
 F  S MORD=$O(^LEX(757.33,"C",MIDIEN,LEXCODE,MORD)) Q:MORD=""  D
"RTN","LEXTRAN1",262,0)
 .F  S MTAR=$O(^LEX(757.33,"C",MIDIEN,LEXCODE,MORD,MTAR)) Q:MTAR=""  D
"RTN","LEXTRAN1",263,0)
 ..F  S MIEN=$O(^LEX(757.33,"C",MIDIEN,LEXCODE,MORD,MTAR,MIEN)) Q:MIEN=""  D
"RTN","LEXTRAN1",264,0)
 ...S EFDT=+$O(^LEX(757.33,"G",MIEN,LEXVDT+.0001),-1)
"RTN","LEXTRAN1",265,0)
 ...Q:EFDT=0
"RTN","LEXTRAN1",266,0)
 ...S STAT=+$O(^LEX(757.33,"G",MIEN,EFDT,""))
"RTN","LEXTRAN1",267,0)
 ...Q:STAT=0
"RTN","LEXTRAN1",268,0)
 ...S LEX=LEX+1
"RTN","LEXTRAN1",269,0)
 ...S LEX(MORD,MTAR)=""
"RTN","LEXTRAN1",270,0)
 I LEXRAY'="LEX" M @LEXRAY=LEX K LEX
"RTN","LEXTRAN1",271,0)
 Q ''@LEXRAY_U_@LEXRAY
"RTN","LEXTRAN1",272,0)
 ;
"RTN","LEXTRAN1",273,0)
LEXSCNM(LEXSRC) ; get source name
"RTN","LEXTRAN1",274,0)
 Q $P(^LEX(757.03,$O(^LEX(757.03,"B",LEXSRC,"")),0),U,2)
"RTN","LEXTRAN1",275,0)
 ;
"RTN","LEXTRAN1",276,0)
LEXASAB(LEXSRC) ; get source abbreviation
"RTN","LEXTRAN1",277,0)
 Q $E($P(^LEX(757.03,$O(^LEX(757.03,"B",LEXSRC,"")),0),U),1,3)
"RTN","LEXTRAN1",278,0)
 ;
"RTN","LEXTRAN1",279,0)
INTDAT(X) ; convert date from external format to VA internal format
"RTN","LEXTRAN1",280,0)
 N Y
"RTN","LEXTRAN1",281,0)
 D ^%DT
"RTN","LEXTRAN1",282,0)
 Q Y
"RTN","LEXTRAN1",283,0)
 ;
"RTN","LEXTRAN1",284,0)
GETCIEN(CODE) ; get correct code ien for code and date
"RTN","LEXTRAN1",285,0)
 ; CODE must be defined
"RTN","LEXTRAN1",286,0)
 ; LEXVXT must be defined
"RTN","LEXTRAN1",287,0)
 N STA,DAT,CIEN,ARR
"RTN","LEXTRAN1",288,0)
 S (STA,DAT,CIEN)=""
"RTN","LEXTRAN1",289,0)
 F  S STA=$O(^LEX(757.02,"ACT",CODE_" ",STA)) Q:STA=""  D
"RTN","LEXTRAN1",290,0)
 .Q:(STA+1)>2
"RTN","LEXTRAN1",291,0)
 .F  S DAT=$O(^LEX(757.02,"ACT",CODE_" ",STA,DAT)) Q:DAT=""  D
"RTN","LEXTRAN1",292,0)
 ..F  S CIEN=$O(^LEX(757.02,"ACT",CODE_" ",STA,DAT,CIEN)) Q:CIEN=""  D
"RTN","LEXTRAN1",293,0)
 ...S ARR(DAT,CIEN)=""
"RTN","LEXTRAN1",294,0)
 S CIEN=$O(ARR($O(ARR(LEXVDT+.001),-1),""),-1)
"RTN","LEXTRAN1",295,0)
 Q CIEN
"RTN","LEXXFI")
0^3^B53174607^B52571781
"RTN","LEXXFI",1,0)
LEXXFI ;ISL/KER - File Info ;07/16/2008
"RTN","LEXXFI",2,0)
 ;;2.0;LEXICON UTILITY;**32,46,49,41,59**;Sep 23, 1996;Build 6
"RTN","LEXXFI",3,0)
 Q
"RTN","LEXXFI",4,0)
 ;
"RTN","LEXXFI",5,0)
 ; Global Variables
"RTN","LEXXFI",6,0)
 ;   ^LEXM(0
"RTN","LEXXFI",7,0)
 ;   ^TMP("LEX*",$J    SACC 2.3.2.5.1
"RTN","LEXXFI",8,0)
 ;
"RTN","LEXXFI",9,0)
 ; External References
"RTN","LEXXFI",10,0)
 ;   DBIA 10086  HOME^%ZIS
"RTN","LEXXFI",11,0)
 ;   DBIA 10089  ^%ZISC
"RTN","LEXXFI",12,0)
 ;   DBIA 10063  ^%ZTLOAD
"RTN","LEXXFI",13,0)
 ;   DBIA  2056  $$GET1^DIQ (file #200)
"RTN","LEXXFI",14,0)
 ;   DBIA 10103  $$DT^XLFDT
"RTN","LEXXFI",15,0)
 ;   DBIA 10103  $$FMTE^XLFDT
"RTN","LEXXFI",16,0)
 ;   DBIA 10103  $$NOW^XLFDT
"RTN","LEXXFI",17,0)
 ;   DBIA 10070  ^XMD
"RTN","LEXXFI",18,0)
 ;   DBIA  4409  $$DTIME^XUP
"RTN","LEXXFI",19,0)
 ;
"RTN","LEXXFI",20,0)
 ; Newed by Post-Install LEX20nnP
"RTN","LEXXFI",21,0)
 ;   LEXBUILD  Build
"RTN","LEXXFI",22,0)
 ;   LEXCRE    Import Global Creation Date
"RTN","LEXXFI",23,0)
 ;   LEXIGHF   Import Global Host File
"RTN","LEXXFI",24,0)
 ;   LEXLREV   Revision
"RTN","LEXXFI",25,0)
 ;   LEXREQP   Required Patches
"RTN","LEXXFI",26,0)
 ;   LEXSHORT  Flag for Summary Install Message
"RTN","LEXXFI",27,0)
 ;
"RTN","LEXXFI",28,0)
 ; XPDA        Newed by KIDS during Install
"RTN","LEXXFI",29,0)
 ; LEXCOUNT    Flag Checked $D() and not used
"RTN","LEXXFI",30,0)
 ;
"RTN","LEXXFI",31,0)
 ; Checksums/Counts
"RTN","LEXXFI",32,0)
EN ;   For One or More File(s)
"RTN","LEXXFI",33,0)
 N LEXENV,LEXMET,LEXID
"RTN","LEXXFI",34,0)
 S LEXENV=$$ENV
"RTN","LEXXFI",35,0)
 Q:+LEXENV'>0
"RTN","LEXXFI",36,0)
 S LEXMET=$$MT^LEXXFI7
"RTN","LEXXFI",37,0)
 I '$L(LEXMET) W !!," Checksum Files (One or All) not Selected" Q
"RTN","LEXXFI",38,0)
 I $L($T(@(LEXMET_"^LEXXFI")))>0 W ! D @LEXMET
"RTN","LEXXFI",39,0)
 Q
"RTN","LEXXFI",40,0)
ONE ;   For ONE file
"RTN","LEXXFI",41,0)
 K ^TMP("LEXCS",$J),^TMP("LEXCNT",$J),^TMP("LEXI",$J),^TMP("LEXMSG",$J)
"RTN","LEXXFI",42,0)
 N LEXBEG,LEXELP,LEXEND,LEXFC,LEXFI,LEXLDR,LEXMOD,LEXMUL,LEXNM,LEXTCS
"RTN","LEXXFI",43,0)
 N LEXTND,LEXTT,LEXTXT
"RTN","LEXXFI",44,0)
 S LEXBEG=$$TIC^LEXXFI8,LEXMUL=0,LEXMOD=0
"RTN","LEXXFI",45,0)
 S LEXFI=$$FI^LEXXFI7 I +LEXFI'>0 W !!," Checksum File not Selected" Q
"RTN","LEXXFI",46,0)
 S LEXLDR=$$LDR^LEXXFI8(LEXFI),LEXMOD=LEXMOD+($$MOD^LEXXFI8(LEXFI))
"RTN","LEXXFI",47,0)
 S LEXNM=$$FN^LEXXFI8(LEXFI),LEXTT=" "
"RTN","LEXXFI",48,0)
 W !
"RTN","LEXXFI",49,0)
 D ONE^LEXXFI2(LEXFI),ONE^LEXXFI3(LEXFI),ONE^LEXXFI5(LEXFI)
"RTN","LEXXFI",50,0)
 S LEXEND=$$TIC^LEXXFI8,LEXELP=$$ELAP^LEXXFI8(LEXBEG,LEXEND)
"RTN","LEXXFI",51,0)
 S:LEXELP="" LEXELP="00:00:00"
"RTN","LEXXFI",52,0)
 I +LEXBEG>0,LEXEND>0,$L(LEXELP) D TIM
"RTN","LEXXFI",53,0)
 K ^TMP("LEXCS",$J),^TMP("LEXCNT",$J),^TMP("LEXI",$J),^TMP("LEXMSG",$J)
"RTN","LEXXFI",54,0)
 Q
"RTN","LEXXFI",55,0)
ALL ;   For ALL files
"RTN","LEXXFI",56,0)
 K ^TMP("LEXCS",$J),^TMP("LEXCNT",$J),^TMP("LEXI",$J),^TMP("LEXMSG",$J)
"RTN","LEXXFI",57,0)
 K ^TMP("LEXINS",$J),^TMP("LEXKID",$J) S:$D(ZTQUEUED) ZTREQ="@"
"RTN","LEXXFI",58,0)
 N LEXBEG,LEXELP,LEXEND,LEXFC,LEXMOD,LEXMUL,LEXTCS,LEXTND,LEXID
"RTN","LEXXFI",59,0)
 S LEXID="LEXKID",LEXBEG=$$TIC^LEXXFI8,LEXMUL=1,(LEXTND,LEXTCS,LEXMOD,LEXFC)=0
"RTN","LEXXFI",60,0)
 D:'$D(LEXPOST) HDR
"RTN","LEXXFI",61,0)
 I '$D(LEXSHORT) D ALL^LEXXFI5,ALL^LEXXFI2,ALL^LEXXFI3
"RTN","LEXXFI",62,0)
 S LEXEND=$$TIC^LEXXFI8 S LEXELP=$$ELAP^LEXXFI8(LEXBEG,LEXEND)
"RTN","LEXXFI",63,0)
 S:LEXELP="" LEXELP="00:00:00"
"RTN","LEXXFI",64,0)
 I +LEXBEG>0,LEXEND>0,$L(LEXELP) D TIM
"RTN","LEXXFI",65,0)
 D:$D(LEXSEND)!($D(LEXPOST)) EN^LEXXII K ^LEXM(0,"PRO") D:$D(ZTQUEUED) MAIL
"RTN","LEXXFI",66,0)
 I '$D(ZTQUEUED) D
"RTN","LEXXFI",67,0)
 . N LEXI S LEXI=0 F  S LEXI=$O(^TMP("LEXKID",$J,LEXI)) Q:+LEXI=0  D
"RTN","LEXXFI",68,0)
 . . W !,$E($G(^TMP("LEXKID",$J,LEXI)),1,79)
"RTN","LEXXFI",69,0)
 D KILL
"RTN","LEXXFI",70,0)
 Q
"RTN","LEXXFI",71,0)
 ;
"RTN","LEXXFI",72,0)
POST ; Entry Point for Post-Install Message
"RTN","LEXXFI",73,0)
 N LEXPOST S LEXPOST=""
"RTN","LEXXFI",74,0)
 ;
"RTN","LEXXFI",75,0)
SEND ; Send Message
"RTN","LEXXFI",76,0)
 N LEXDESC,LEXENV,LEXP,LEXACCT,LEXPRO,LEXPRON,LEXSEND,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE,ZTSK,ZTQUEUED,ZTREQ
"RTN","LEXXFI",77,0)
 S LEXP=0,LEXENV=$$ENV Q:+LEXENV'>0  S LEXSEND="",LEXPRON="LEXICAL SERVICES UPDATE",LEXPRO=$G(^LEXM(0,"PRO"))
"RTN","LEXXFI",78,0)
 S:+LEXPRO>0 LEXPRO=$$FMTE^XLFDT(LEXPRO,"1"),LEXP=1
"RTN","LEXXFI",79,0)
 S LEXACCT=$$U^LEXXFI7 S ZTSAVE("LEXACCT")=""
"RTN","LEXXFI",80,0)
 S ZTRTN="ALL^LEXXFI",ZTSAVE("LEXSEND")="",ZTSAVE("LEXPOST")=""
"RTN","LEXXFI",81,0)
 S:$D(LEXCOUNT) ZTSAVE("LEXCOUNT")=""
"RTN","LEXXFI",82,0)
 I $L($G(LEXPRO)),$L($G(LEXPRON)),+$G(LEXP)>0 S ZTSAVE("LEXPRO")="",ZTSAVE("LEXPRON")=""
"RTN","LEXXFI",83,0)
 S:$D(LEXLREV) ZTSAVE("LEXLREV")=""
"RTN","LEXXFI",84,0)
 S:$D(LEXREQP) ZTSAVE("LEXREQP")=""
"RTN","LEXXFI",85,0)
 S:$D(LEXBUILD) ZTSAVE("LEXBUILD")=""
"RTN","LEXXFI",86,0)
 S:$D(LEXSHORT) ZTSAVE("LEXSHORT")=""
"RTN","LEXXFI",87,0)
 S:$D(LEXIGHF) ZTSAVE("LEXIGHF")=""
"RTN","LEXXFI",88,0)
 S:$D(LEXCRE) ZTSAVE("LEXCRE")=""
"RTN","LEXXFI",89,0)
 S:$D(LEXSTART) ZTSAVE("LEXSTART")=""
"RTN","LEXXFI",90,0)
 S:$D(LEXID) ZTSAVE("LEXID")=""
"RTN","LEXXFI",91,0)
 S:$D(LEXRES) ZTSAVE("LEXRES")=""
"RTN","LEXXFI",92,0)
 S:$D(XPDA) ZTSAVE("XPDA")=""
"RTN","LEXXFI",93,0)
 S (LEXDESC,ZTDESC)="Post-Install File Counts "
"RTN","LEXXFI",94,0)
 S:$D(LEXSHORT) (LEXDESC,ZTDESC)="Post-Install Summary"
"RTN","LEXXFI",95,0)
 S ZTDTH=$H
"RTN","LEXXFI",96,0)
 S ZTIO=""
"RTN","LEXXFI",97,0)
 D ^%ZTLOAD
"RTN","LEXXFI",98,0)
 W:+($G(ZTSK))>0 !!,"  ",LEXDESC,!,"  Queued Task #",+($G(ZTSK)) W !
"RTN","LEXXFI",99,0)
 D ^%ZISC
"RTN","LEXXFI",100,0)
 Q
"RTN","LEXXFI",101,0)
MAIL ; Mail global array in message
"RTN","LEXXFI",102,0)
 N DIFROM,LEXPRI,LEXADR,LEXI,LEXM,LEXSUB,XCNP,XMDUZ,XMSCR,XMSUB,XMTEXT,XMY,XMZ
"RTN","LEXXFI",103,0)
 I '$D(LEXSHORT),+$G(^TMP("LEXCS",$J,0))'>0 G MAILQ
"RTN","LEXXFI",104,0)
 K ^TMP("LEXMSG",$J)
"RTN","LEXXFI",105,0)
 S LEXSUB="Lexicon/ICD/CPT Installation"
"RTN","LEXXFI",106,0)
 S:$L($G(LEXBUILD)) LEXSUB=$G(LEXBUILD)_" Installation"
"RTN","LEXXFI",107,0)
 S LEXPRI=$$ADR^LEXXFI8
"RTN","LEXXFI",108,0)
 G:'$L(LEXPRI) MAILQ
"RTN","LEXXFI",109,0)
 S LEXPRI="G.LEXINS@"_LEXPRI
"RTN","LEXXFI",110,0)
 S LEXADR=$$GET1^DIQ(200,+($G(DUZ)),.01)
"RTN","LEXXFI",111,0)
 G:'$L(LEXADR) MAILQ
"RTN","LEXXFI",112,0)
 S U="^",XMSUB="LEX/ICD/CPT File Checksums - "_$$FMTE^XLFDT($$NOW^XLFDT)
"RTN","LEXXFI",113,0)
 S:$D(LEXCOUNT) XMSUB="LEX/ICD/CPT File Checksums/Counts - "_$$FMTE^XLFDT($$NOW^XLFDT)
"RTN","LEXXFI",114,0)
 S:$L($G(LEXBUILD)) XMSUB=$G(LEXBUILD)_" File Checksums"
"RTN","LEXXFI",115,0)
 I $L($G(LEXBUILD)),$D(LEXCOUNT) S XMSUB=$G(LEXBUILD)_" File Checksums/Counts"
"RTN","LEXXFI",116,0)
 S:$D(LEXPOST) XMSUB=LEXSUB
"RTN","LEXXFI",117,0)
 S LEXI=0 F  S LEXI=$O(^TMP("LEXKID",$J,LEXI)) Q:+LEXI=0  D
"RTN","LEXXFI",118,0)
 . S LEXM=+($O(^TMP("LEXMSG",$J," "),-1))+1
"RTN","LEXXFI",119,0)
 . S ^TMP("LEXMSG",$J,LEXM,0)=$E($G(^TMP("LEXKID",$J,LEXI)),1,79)
"RTN","LEXXFI",120,0)
 . S ^TMP("LEXMSG",$J,0)=LEXM
"RTN","LEXXFI",121,0)
 K ^TMP("LEXKID",$J)
"RTN","LEXXFI",122,0)
 I '$D(LEXSHORT) S LEXI=0 F  S LEXI=$O(^TMP("LEXCS",$J,LEXI)) Q:+LEXI=0  D
"RTN","LEXXFI",123,0)
 . S LEXM=+($O(^TMP("LEXMSG",$J," "),-1))+1
"RTN","LEXXFI",124,0)
 . S ^TMP("LEXMSG",$J,LEXM,0)=$E($G(^TMP("LEXCS",$J,LEXI)),1,79)
"RTN","LEXXFI",125,0)
 . S ^TMP("LEXMSG",$J,0)=LEXM
"RTN","LEXXFI",126,0)
 K ^TMP("LEXCS",$J) G:'$D(^TMP("LEXMSG",$J)) MAILQ G:+($G(^TMP("LEXMSG",$J,0)))'>0 MAILQ
"RTN","LEXXFI",127,0)
 S XMY(LEXPRI)="",XMY(LEXADR)="",XMTEXT="^TMP(""LEXMSG"",$J,",XMDUZ=.5 D ^XMD
"RTN","LEXXFI",128,0)
MAILQ ; Quit Mail
"RTN","LEXXFI",129,0)
 D KILL K XCNP,XMSCR,XMDUZ,XMY,XMZ,XMSUB,XMY,XMTEXT,XMDUZ
"RTN","LEXXFI",130,0)
 Q
"RTN","LEXXFI",131,0)
 ;
"RTN","LEXXFI",132,0)
 ; Miscellaneous
"RTN","LEXXFI",133,0)
HDR ;   Header
"RTN","LEXXFI",134,0)
 N LEXD,LEXP,LEXN,LEXT,LEXU,LEXA,LEXACT,LEXI,LEXF,LEXMUL S LEXF=0 S LEXACT=$G(LEXACCT),LEXA=""
"RTN","LEXXFI",135,0)
 S:$L($P(LEXACT,"^",1))&($L($P(LEXACT,"^",1))) LEXA=LEXACT
"RTN","LEXXFI",136,0)
 S:'$L($G(LEXA)) LEXA=$$U^LEXXFI7 S LEXU=$$P^LEXXFI7,LEXD=$$A^LEXXFI7 D TT^LEXXFI8("","Status")
"RTN","LEXXFI",137,0)
 S LEXT="" S:$L(LEXD) LEXT="   As of:       "_LEXD
"RTN","LEXXFI",138,0)
 I $L(LEXD) D:+LEXF'>0 BL^LEXXFI8 D TL^LEXXFI8(LEXT) S LEXF=1
"RTN","LEXXFI",139,0)
 S LEXT="",LEXI=$S($L($P(LEXA,"^",1)):"[",1:"")_$P(LEXA,"^",1)_$S($L($P(LEXA,"^",2)):"]",1:"")
"RTN","LEXXFI",140,0)
 S:$L(LEXI)&($L($P(LEXA,"^",2))) LEXI=LEXI_"  "_$P(LEXA,"^",2)
"RTN","LEXXFI",141,0)
 S LEXT="" S:$L(LEXI) LEXT="   In Account:  "_LEXI
"RTN","LEXXFI",142,0)
 I $L(LEXT) D:+LEXF'>0 BL^LEXXFI8 D TL^LEXXFI8(LEXT) S LEXF=1
"RTN","LEXXFI",143,0)
 S LEXN=$P(LEXU,"^",1),LEXP=$P(LEXU,"^",2)
"RTN","LEXXFI",144,0)
 S LEXT="" S:$L(LEXN) LEXT="   Maint By:    "
"RTN","LEXXFI",145,0)
 S:$L(LEXN) LEXT=LEXT_LEXN S:$L(LEXP)&($L(LEXN)) LEXT=LEXT_"   "_LEXP
"RTN","LEXXFI",146,0)
 I $L(LEXT) D:+LEXF'>0 BL^LEXXFI8 D TL^LEXXFI8(LEXT) S LEXF=1
"RTN","LEXXFI",147,0)
 S LEXT="" S:$L($G(LEXBUILD)) LEXT="   Build:       "_$G(LEXBUILD)
"RTN","LEXXFI",148,0)
 I $L(LEXT) D:+LEXF'>0 BL^LEXXFI8 D TL^LEXXFI8(LEXT) S LEXF=1
"RTN","LEXXFI",149,0)
 S LEXT="" I $L($G(LEXPRO))&($L($G(LEXPRON))) D
"RTN","LEXXFI",150,0)
 . S LEXT="   Protocol:    "_LEXPRON_" invoked "_LEXPRO
"RTN","LEXXFI",151,0)
 . I $L(LEXT) D:+LEXF'>0 BL^LEXXFI8 D TL^LEXXFI8(LEXT) S LEXF=1
"RTN","LEXXFI",152,0)
 D BL^LEXXFI8
"RTN","LEXXFI",153,0)
 Q
"RTN","LEXXFI",154,0)
TIM ;   Time
"RTN","LEXXFI",155,0)
 Q:$D(LEXPOST)  Q:+($G(LEXBEG))'>0  Q:+($G(LEXEND))'>0  Q:'$L($G(LEXELP))
"RTN","LEXXFI",156,0)
 D BL^LEXXFI8,TL^LEXXFI8(("   Started:   "_$TR($$FMTE^XLFDT(LEXBEG),"@"," ")))
"RTN","LEXXFI",157,0)
 D TL^LEXXFI8(("   Finished:  "_$TR($$FMTE^XLFDT(LEXEND),"@"," ")))
"RTN","LEXXFI",158,0)
 D TL^LEXXFI8(("   Elapsed:   "_LEXELP)),BL^LEXXFI8
"RTN","LEXXFI",159,0)
 Q
"RTN","LEXXFI",160,0)
ENV(X) ;   Environment check
"RTN","LEXXFI",161,0)
 N LEXNM D HOME^%ZIS S U="^",DT=$$DT^XLFDT
"RTN","LEXXFI",162,0)
 I +($G(DUZ))'>0 W !!,"    User (DUZ) not defined",! Q 0
"RTN","LEXXFI",163,0)
 S LEXNM=$$GET1^DIQ(200,+($G(DUZ)),.01)
"RTN","LEXXFI",164,0)
 I '$L(LEXNM) W !!,"    Invalid User (DUZ) defined",! Q 0
"RTN","LEXXFI",165,0)
 S DTIME=$$DTIME^XUP(+($G(DUZ)))
"RTN","LEXXFI",166,0)
 Q 1
"RTN","LEXXFI",167,0)
CLR ;   Clear ^TMP("LEXCS",$J)
"RTN","LEXXFI",168,0)
 K ^TMP("LEXCS",$J) Q
"RTN","LEXXFI",169,0)
KILL ;   Kill all ^TMP("LEX**"
"RTN","LEXXFI",170,0)
 K ^TMP("LEXCNT",$J),^TMP("LEXCS",$J),^TMP("LEXI",$J)
"RTN","LEXXFI",171,0)
 K ^TMP("LEXINS",$J),^TMP("LEXMSG",$J),^TMP("LEXKID",$J)
"RTN","LEXXFI",172,0)
 Q
"RTN","LEXXFI",173,0)
 ;;
"RTN","LEXXFI",174,0)
 ;;
"RTN","LEXXFI",175,0)
FILES ;;
"RTN","LEXXFI",176,0)
 ;;;;757
"RTN","LEXXFI",177,0)
 ;;1;;757.001
"RTN","LEXXFI",178,0)
 ;;1;;757.01
"RTN","LEXXFI",179,0)
 ;;;;757.011
"RTN","LEXXFI",180,0)
 ;;;;757.014
"RTN","LEXXFI",181,0)
 ;;;;757.02
"RTN","LEXXFI",182,0)
 ;;;;757.03
"RTN","LEXXFI",183,0)
 ;;1;;757.04
"RTN","LEXXFI",184,0)
 ;;1;;757.05
"RTN","LEXXFI",185,0)
 ;;1;;757.06
"RTN","LEXXFI",186,0)
 ;;;;757.1
"RTN","LEXXFI",187,0)
 ;;;;757.11
"RTN","LEXXFI",188,0)
 ;;;;757.12
"RTN","LEXXFI",189,0)
 ;;;;757.13
"RTN","LEXXFI",190,0)
 ;;;;757.14
"RTN","LEXXFI",191,0)
 ;;1;;757.2
"RTN","LEXXFI",192,0)
 ;;1;;757.21
"RTN","LEXXFI",193,0)
 ;;;;757.3
"RTN","LEXXFI",194,0)
 ;;;;757.31
"RTN","LEXXFI",195,0)
 ;;1;;757.4
"RTN","LEXXFI",196,0)
 ;;1;;757.41
"RTN","LEXXFI",197,0)
 ;;;;80
"RTN","LEXXFI",198,0)
 ;;;;80.1
"RTN","LEXXFI",199,0)
 ;;;;80.3
"RTN","LEXXFI",200,0)
 ;;;;81
"RTN","LEXXFI",201,0)
 ;;;;81.1
"RTN","LEXXFI",202,0)
 ;;1;;81.2
"RTN","LEXXFI",203,0)
 ;;;;81.3
"RTN","LEXXFI",204,0)
 ;;
"RTN","LEXXFI",205,0)
 ;;
"RTN","LEXXFI",206,0)
 ;;
"RTN","LEXXFI",207,0)
 Q
"RTN","LEXXGI")
0^4^B38282153^B74289713
"RTN","LEXXGI",1,0)
LEXXGI ;ISL/KER/FJF - Global Import (Needs ^LEXM) ;07/16/2008
"RTN","LEXXGI",2,0)
 ;;2.0;LEXICON UTILITY;**4,25,26,27,28,29,46,49,50,41,59**;Sep 23, 1996;Build 6
"RTN","LEXXGI",3,0)
 ;              
"RTN","LEXXGI",4,0)
 ; NEWed by Lexicon Environment Check routine LEX20nn
"RTN","LEXXGI",5,0)
 ;    LEXBUILD
"RTN","LEXXGI",6,0)
 ;    LEXFY
"RTN","LEXXGI",7,0)
 ;    LEXIGHF
"RTN","LEXXGI",8,0)
 ;    LEXLREV
"RTN","LEXXGI",9,0)
 ;    LEXPTYPE
"RTN","LEXXGI",10,0)
 ;    LEXQTR
"RTN","LEXXGI",11,0)
 ;    LEXREQP
"RTN","LEXXGI",12,0)
 ;              
"RTN","LEXXGI",13,0)
 ; NEWed by KIDS during the Install of a patch/build
"RTN","LEXXGI",14,0)
 ;    XPDNM
"RTN","LEXXGI",15,0)
 ;              
"RTN","LEXXGI",16,0)
 ; Global Variables
"RTN","LEXXGI",17,0)
 ;    ^LEXM
"RTN","LEXXGI",18,0)
 ;              
"RTN","LEXXGI",19,0)
 ; External References
"RTN","LEXXGI",20,0)
 ;    DBIA 10086  HOME^%ZIS
"RTN","LEXXGI",21,0)
 ;    DBIA 10016  ^DIM
"RTN","LEXXGI",22,0)
 ;    DBIA  2056  $$GET1^DIQ (file 200)
"RTN","LEXXGI",23,0)
 ;    DBIA 10103  $$DT^XLFDT
"RTN","LEXXGI",24,0)
 ;    DBIA 10103  $$FMTE^XLFDT
"RTN","LEXXGI",25,0)
 ;    DBIA 10141  BMES^XPDUTL 
"RTN","LEXXGI",26,0)
 ;    DBIA 10141  MES^XPDUTL
"RTN","LEXXGI",27,0)
 ;              
"RTN","LEXXGI",28,0)
EN ; Main Entry Point for Installing LEXM in Post-Installs
"RTN","LEXXGI",29,0)
 ;                
"RTN","LEXXGI",30,0)
 ; Requires 
"RTN","LEXXGI",31,0)
 ;                
"RTN","LEXXGI",32,0)
 ;   LEXBUILD - the name of the patch/build being installed
"RTN","LEXXGI",33,0)
 ;                
"RTN","LEXXGI",34,0)
 ; Uses
"RTN","LEXXGI",35,0)
 ;                
"RTN","LEXXGI",36,0)
 ;   LEXMSG   - If this variable exist, then an install message
"RTN","LEXXGI",37,0)
 ;              message will be set to G.LEXICON
"RTN","LEXXGI",38,0)
 ;              
"RTN","LEXXGI",39,0)
 ;   LEXSHORT - If this variable exist, the install message
"RTN","LEXXGI",40,0)
 ;              will be an abbreviated message, without the 
"RTN","LEXXGI",41,0)
 ;              file totals and checksums
"RTN","LEXXGI",42,0)
 ;               
"RTN","LEXXGI",43,0)
 ;              Abbreviated Install Message
"RTN","LEXXGI",44,0)
 ;               
"RTN","LEXXGI",45,0)
 ;                Date and Time Installed
"RTN","LEXXGI",46,0)
 ;                Account where the Data was Installed
"RTN","LEXXGI",47,0)
 ;                Who Installed the Data
"RTN","LEXXGI",48,0)
 ;                The Name of the Build Installed
"RTN","LEXXGI",49,0)
 ;                The Name of the Global Host File
"RTN","LEXXGI",50,0)
 ;                Protocol Invoked
"RTN","LEXXGI",51,0)
 ;                Date and time Protocol was Invoked
"RTN","LEXXGI",52,0)
 ;                Install Start Date/Time
"RTN","LEXXGI",53,0)
 ;                Install Complete Date/Time
"RTN","LEXXGI",54,0)
 ;                Install Elapsed Time
"RTN","LEXXGI",55,0)
 ;               
"RTN","LEXXGI",56,0)
 ;              Long Install Message
"RTN","LEXXGI",57,0)
 ;               
"RTN","LEXXGI",58,0)
 ;                All of the elements above plus:
"RTN","LEXXGI",59,0)
 ;               
"RTN","LEXXGI",60,0)
 ;                   File Versions/Revisions
"RTN","LEXXGI",61,0)
 ;                   File Checksums
"RTN","LEXXGI",62,0)
 ;                   File Record Counts
"RTN","LEXXGI",63,0)
 ;              
"RTN","LEXXGI",64,0)
 ;   LEXPTYPE - Patch Type
"RTN","LEXXGI",65,0)
 ;   LEXLREV  - Revision
"RTN","LEXXGI",66,0)
 ;   LEXREQP  - Required Patches/Builds
"RTN","LEXXGI",67,0)
 ;   LEXIGHF  - The patch Export Global Host Filename
"RTN","LEXXGI",68,0)
 ;   LEXFY    - Fiscal Year
"RTN","LEXXGI",69,0)
 ;   LEXQTR   - Quarter
"RTN","LEXXGI",70,0)
 ;   LEXCRE   - Import Global Creation Date
"RTN","LEXXGI",71,0)
 ;                
"RTN","LEXXGI",72,0)
 D IMPORT D KALL^LEXXGI2
"RTN","LEXXGI",73,0)
 Q
"RTN","LEXXGI",74,0)
TASK ; Queue Lexicon Update with Taskman
"RTN","LEXXGI",75,0)
 N Y,ZTRTN,ZTDESC,ZTIO,ZTDTH,ZTSK,ZTSAVE,ZTQUEUED,ZTREQ S:$D(LEXBUILD) ZTSAVE("LEXBUILD")="" S:$D(LEXMSG) ZTSAVE("LEXMSG")=""
"RTN","LEXXGI",76,0)
 S:$D(LEXSHORT) ZTSAVE("LEXSHORT")="" S:$D(LEXPTYPE) ZTSAVE("LEXPTYPE")="" S:$D(LEXLREV) ZTSAVE("LEXLREV")="" S:$D(LEXREQP) ZTSAVE("LEXREQP")=""
"RTN","LEXXGI",77,0)
 S:$D(LEXIGHF) ZTSAVE("LEXIGHF")="" S:$D(LEXFY) ZTSAVE("LEXFY")="" S:$D(LEXQTR) ZTSAVE("LEXQTR")="" S:$D(LEXCRE) ZTSAVE("LEXCRE")=""
"RTN","LEXXGI",78,0)
 S ZTRTN="EN^LEXXGI",ZTDESC="Importing Updated Lexicon Data" S ZTIO="",ZTDTH=$H D ^%ZTLOAD,HOME^%ZIS
"RTN","LEXXGI",79,0)
 Q
"RTN","LEXXGI",80,0)
FORCE ; Force Install of LEXM w/o a Post-Install
"RTN","LEXXGI",81,0)
 N LEXBUILD,LEXBLD,LEXB,LEXBO,LEXSHORT,LEXTYPE,LEXMSG,LEXNOT,LEXPOST
"RTN","LEXXGI",82,0)
 S LEXBO=$G(^LEXM(0,"BUILD")),(LEXBUILD,LEXBLD,LEXB,^LEXM(0,"BUILD"))="LEX*2.0*NN" S:$L($G(LEXBO)) (LEXBUILD,LEXBLD,LEXB,^LEXM(0,"BUILD"))=LEXBO
"RTN","LEXXGI",83,0)
 S LEXSHORT="",LEXTYPE=LEXB S:$L(LEXB) LEXTYPE=LEXTYPE_" (Forced)" S LEXMSG="",LEXPOST="",LEXNOT=0
"RTN","LEXXGI",84,0)
 D EN
"RTN","LEXXGI",85,0)
 Q
"RTN","LEXXGI",86,0)
IMPORT ; Import Data during a Patch Installation
"RTN","LEXXGI",87,0)
 S:$D(ZTQUEUED) ZTREQ="@" S:'$D(LEXNOT) LEXNOT=1
"RTN","LEXXGI",88,0)
 S:$L($G(LEXPTYPE)) LEXPTYPE=$G(LEXPTYPE) S:$L($G(LEXLREV)) LEXLREV=$G(LEXLREV) S:$L($G(LEXREQP)) LEXREQP=$G(LEXREQP)
"RTN","LEXXGI",89,0)
 S:$L($G(LEXBUILD)) LEXBUILD=$G(LEXBUILD) S:$L($G(LEXIGHF)) LEXIGHF=$G(LEXIGHF) S:$L($G(LEXFY)) LEXFY=$G(LEXFY)
"RTN","LEXXGI",90,0)
 S:$L($G(LEXQTR)) LEXQTR=$G(LEXQTR) K LEXSCHG,LEXCHG
"RTN","LEXXGI",91,0)
 N LEXB,LEXCD,LEXSTR,LEXLAST,LEXRES,LEXSTART,%,%DT,C,D,D0,D1,D2,DG,DIC,DICR,DILOCKTM,DIW,IREC,J,XMDUN,XMZ,ZTSK
"RTN","LEXXGI",92,0)
 S U="^",LEXSTR=$G(LEXPTYPE),LEXB=$G(^LEXM(0,"BUILD")),LEXSTART=$$NOW^XLFDT
"RTN","LEXXGI",93,0)
 S:$L($G(LEXFY))&($L($G(LEXQTR)))&($L(LEXSTR)) LEXSTR=LEXSTR_" for "_$G(LEXFY)_" "_$G(LEXQTR)_" Quarter"
"RTN","LEXXGI",94,0)
 S:$L(LEXB) LEXBLD=LEXB S:'$L(LEXBLD)&($L(LEXBUILD)) LEXBLD=LEXBUILD
"RTN","LEXXGI",95,0)
 I '$L(LEXB)!(LEXB'=LEXBUILD) D
"RTN","LEXXGI",96,0)
 . N X,LEXBLD I '$L(LEXB) D  Q
"RTN","LEXXGI",97,0)
 . . S X=" Invalid export global, aborting data install" W:'$D(XPDNM) !!,X D:$D(XPDNM) BMES^XPDUTL(X) W:'$D(XPDNM) ! D:$D(XPDNM) MES^XPDUTL(" ")
"RTN","LEXXGI",98,0)
 . I '$L(LEXBUILD) D  Q
"RTN","LEXXGI",99,0)
 . . S X=" Undefined KIDS Build, aborting data install" W:'$D(XPDNM) !!,X D:$D(XPDNM) BMES^XPDUTL(X) W:'$D(XPDNM) ! D:$D(XPDNM) MES^XPDUTL(" ")
"RTN","LEXXGI",100,0)
 I $L(LEXB)&(LEXB=LEXBUILD) D
"RTN","LEXXGI",101,0)
 . N LEXFI,LEXID S X="Installing Data for patch "_LEXB W:'$D(XPDNM) !!,X D:$D(XPDNM) BMES^XPDUTL(X) W:'$D(XPDNM) ! D:$D(XPDNM) MES^XPDUTL(" ")
"RTN","LEXXGI",102,0)
 . K LEXSCHG S LEXCHG=0,LEXFI=0 F  S LEXFI=$O(^LEXM(LEXFI)) Q:+LEXFI'>0  D
"RTN","LEXXGI",103,0)
 . . S LEXID=$S(LEXFI=80!(LEXFI=80.1):"ICD",LEXFI=81!(LEXFI=81.1)!(LEXFI=81.2)!(LEXFI=81.3):"CPT",$P(LEXFI,".",1)=757:"LEX",1:"UNK")
"RTN","LEXXGI",104,0)
 . . S LEXSCHG(LEXFI,0)=+($G(^LEXM(LEXFI,0))),LEXSCHG("B",LEXFI)="" S LEXSCHG("C",LEXID,LEXFI)=""
"RTN","LEXXGI",105,0)
 . S:$D(LEXSCHG("C","CPT"))!($D(LEXSCHG("C","ICD"))) LEXSCHG("D","PRO")="",LEXCHG=1,LEXSCHG(0)=1
"RTN","LEXXGI",106,0)
 . D LOAD D:+($G(LEXNOT))>0 NOTIFY^LEXXGI2 K LEXNOT I +($G(DUZ))>0,$L($$GET1^DIQ(200,(+($G(DUZ))_","),.01)) D
"RTN","LEXXGI",107,0)
 . . D HOME^%ZIS N DIFROM,LEXPRO,LEXPRON,LEXLAST S LEXPRON="LEXICAL SERVICES UPDATE",LEXPRO=$G(^LEXM(0,"PRO"))
"RTN","LEXXGI",108,0)
 . . D:$D(LEXMSG) POST^LEXXFI
"RTN","LEXXGI",109,0)
 K LEXNOT
"RTN","LEXXGI",110,0)
 Q
"RTN","LEXXGI",111,0)
LOAD ; Load Data from ^LEXM into IC*/LEX Files
"RTN","LEXXGI",112,0)
 Q:'$L($G(LEXB))  S:$D(ZTQUEUED) ZTREQ="@"
"RTN","LEXXGI",113,0)
 N LEXBEG,LEXELP,LEXEND,LEXMSG,LEXOK,LEXFL,LEXTXT
"RTN","LEXXGI",114,0)
 D:'$D(^LEXM) NF^LEXXGI2 Q:'$D(^LEXM)
"RTN","LEXXGI",115,0)
 S LEXOK=0 S:$O(^LEXM(0))>0 LEXOK=1 D:'LEXOK IG^LEXXGI2 Q:'LEXOK
"RTN","LEXXGI",116,0)
 S LEXBEG=$$HACK^LEXXGI2 D FILES^LEXXGI3 S LEXEND=$$HACK^LEXXGI2,LEXELP=$$ELAP^LEXXGI2(LEXBEG,LEXEND)
"RTN","LEXXGI",117,0)
 S:LEXELP="" LEXELP="00:00:00"
"RTN","LEXXGI",118,0)
 S LEXRES=$$RESULTS^LEXXII2
"RTN","LEXXGI",119,0)
 S LEXTXT="  Data Update" S:$L(LEXRES) LEXTXT=LEXTXT_":   "_$G(LEXRES)
"RTN","LEXXGI",120,0)
 D PB^LEXXGI2(LEXTXT)
"RTN","LEXXGI",121,0)
 D PB^LEXXGI2(("     Started:    "_$TR($$FMTE^XLFDT(LEXBEG),"@"," ")))
"RTN","LEXXGI",122,0)
 D TL^LEXXGI2(("     Finished:   "_$TR($$FMTE^XLFDT(LEXEND),"@"," ")))
"RTN","LEXXGI",123,0)
 D TL^LEXXGI2(("     Elapsed:    "_LEXELP))
"RTN","LEXXGI",124,0)
 Q
"RTN","LEXXGI",125,0)
 ;                     
"RTN","LEXXGI",126,0)
NOTIFY ; Notify by Protocol - LEXICAL SERVICES UPDATE
"RTN","LEXXGI",127,0)
 D NOTIFY^LEXXGI2,KALL^LEXXGI2
"RTN","LEXXGI",128,0)
 Q
"RTN","LEXXGI",129,0)
SCHG ;   Save Change File Changes (for NOTIFY)
"RTN","LEXXGI",130,0)
 N FI,ID K LEXSCHG S LEXCHG=0
"RTN","LEXXGI",131,0)
 N FI S FI=0 F  S FI=$O(^LEXM(FI)) Q:+FI'>0  D
"RTN","LEXXGI",132,0)
 . S ID=$S(FI=80!(FI=80.1):"ICD",FI=81!(FI=81.1)!(FI=81.2)!(FI=81.3):"CPT",$P(FI,".",1)=757:"LEX",1:"UNK")
"RTN","LEXXGI",133,0)
 . S LEXSCHG(FI,0)=+($G(^LEXM(FI,0))),LEXSCHG("B",FI)="" S LEXSCHG("C",ID,FI)=""
"RTN","LEXXGI",134,0)
 S:$D(LEXSCHG("C","CPT"))!($D(LEXSCHG("C","ICD"))) LEXSCHG("D","PRO")=""
"RTN","LEXXGI",135,0)
 S:$D(^LEXM(80))!($D(^LEXM(80.1)))!($D(^LEXM(81)))!($D(^LEXM(81.2)))!($D(^LEXM(81.3)))!($D(LEXSCHG("D","PRO"))) LEXCHG=1,LEXSCHG(0)=1
"RTN","LEXXGI",136,0)
 Q
"RTN","LEXXGI",137,0)
ZTQ ; Taskman Quit
"RTN","LEXXGI",138,0)
 K ZTDESC,ZTDTH,ZTIO,ZTQUEUED,ZTREQ,ZTRTN,ZTSAVE,ZTSK
"RTN","LEXXGI",139,0)
 Q
"RTN","LEXXGI",140,0)
CHECKSUM ; Check ^LEXM Checksum
"RTN","LEXXGI",141,0)
 D CS^LEXXGI2
"RTN","LEXXGI",142,0)
 Q
"RTN","LEXXGI3")
0^9^B21977980^n/a
"RTN","LEXXGI3",1,0)
LEXXGI3 ;ISL/KER/FJF - Global Import (Needs ^LEXM) ;07/16/2008
"RTN","LEXXGI3",2,0)
 ;;2.0;LEXICON UTILITY;**59**;Sep 23, 1996;Build 6
"RTN","LEXXGI3",3,0)
 ;              
"RTN","LEXXGI3",4,0)
 ; Local Variables NEWed or KILLed Elsewhere (LEXXGI)
"RTN","LEXXGI3",5,0)
 ;                
"RTN","LEXXGI3",6,0)
 ;   LEXFL        Array of Files
"RTN","LEXXGI3",7,0)
 ;   LEXOK        LEXM exist
"RTN","LEXXGI3",8,0)
 ;   LEXSCHG      Changes
"RTN","LEXXGI3",9,0)
 ;   ZTQUEUED     Queued Task
"RTN","LEXXGI3",10,0)
 ;   ZTSK         Task Number
"RTN","LEXXGI3",11,0)
 ;              
"RTN","LEXXGI3",12,0)
 ; Global Variables
"RTN","LEXXGI3",13,0)
 ;    ^LEXM(              N/A
"RTN","LEXXGI3",14,0)
 ;               
"RTN","LEXXGI3",15,0)
 ; External References
"RTN","LEXXGI3",16,0)
 ;    $$S^%ZTLOAD         ICR  10063
"RTN","LEXXGI3",17,0)
 ;    ^DIM                ICR  10016
"RTN","LEXXGI3",18,0)
 ;    $$DT^XLFDT          ICR  10103
"RTN","LEXXGI3",19,0)
 ;    $$FMTE^XLFDT        ICR  10103
"RTN","LEXXGI3",20,0)
 ;               
"RTN","LEXXGI3",21,0)
 ;                
"RTN","LEXXGI3",22,0)
FILES ;   Load Data for all files
"RTN","LEXXGI3",23,0)
 Q:'$L($G(LEXB))  N LEXHDR,LEXBLD,LEXDAT,LEXFI,LEXFIC,LEXHDRS,LEXLOG,LEXINS,LEXTOTI,LEXTOTN,LEXPER,LEXPRE
"RTN","LEXXGI3",24,0)
 S (LEXFI,LEXFIC,LEXHDR,LEXTOTI,LEXTOTN,LEXPER,LEXPRE)=0,LEXBLD=LEXB
"RTN","LEXXGI3",25,0)
 S LEXDAT=$P($G(^LEXM(0,"VRRVDT")),"^",1),LEXINS=1
"RTN","LEXXGI3",26,0)
 S:+LEXDAT'>0 LEXDAT=$$DT^XLFDT I LEXOK D
"RTN","LEXXGI3",27,0)
 . N LEXCRE,LEXL1 S LEXL1="" S LEXCRE=$G(^LEXM(0,"CREATED")) S LEXCRE=$S(+LEXCRE>0:($$MIX^LEXXGI2($$FMTE^XLFDT(LEXCRE))),1:"")
"RTN","LEXXGI3",28,0)
 . S:$L($P(LEXCRE,"@",2)) LEXCRE=$P(LEXCRE,"@",1)_" at "_$P(LEXCRE,"@",2) S LEXL1=" Updating files "
"RTN","LEXXGI3",29,0)
 . S:$L($G(LEXCRE))&($L($G(LEXL1))) LEXL1=$G(LEXL1)_"using export global created "_$G(LEXCRE)
"RTN","LEXXGI3",30,0)
 . D PB^LEXXGI2(LEXL1)
"RTN","LEXXGI3",31,0)
 S LEXFI=0 F  S LEXFI=$O(^LEXM(LEXFI)) Q:+LEXFI=0  S LEXTOTN=+($G(LEXTOTN))+($O(^LEXM(LEXFI," "),-1))
"RTN","LEXXGI3",32,0)
 S LEXFI=0 F  S LEXFI=$O(^LEXM(LEXFI)) Q:+LEXFI=0  D FILE
"RTN","LEXXGI3",33,0)
 Q
"RTN","LEXXGI3",34,0)
FILE ;     Load Data for one file
"RTN","LEXXGI3",35,0)
 N LEXCF,LEXCHG,LEXCHGS,LEXCNT,LEXFIL,LEXI,LEXID,LEXIEN,LEXL,LEXLC
"RTN","LEXXGI3",36,0)
 N LEXMUMPS,LEXNM,LEXRT,LEXS,LEXTOT,LEXTXT,LEXIGL,LEXIGI,LEXIGF,LEXIGT
"RTN","LEXXGI3",37,0)
 N LEXIGD,LEXIGO,LEXBEG,LEXEND,LEXELP,LEXFB
"RTN","LEXXGI3",38,0)
 S LEXFB=$G(^LEXM(+LEXFI,0,"BUILD")),LEXIGO=0,LEXBEG=$$HACK^LEXXGI2
"RTN","LEXXGI3",39,0)
 S (LEXCNT,LEXLC,LEXI)=0,LEXL=68,LEXFIC=LEXFIC+1 I LEXOK D
"RTN","LEXXGI3",40,0)
 . N LEXB,LEXFID,LEXNM,LEXVR,LEXRV,LEXDT,LEXL1,LEXL2 S (LEXL1,LEXL2)="",LEXFID=$P(LEXFI,".",1)
"RTN","LEXXGI3",41,0)
 . Q:+LEXFID'>0  Q:$D(LEXHDRS(+LEXFID))  S LEXHDRS(LEXFID)="" S:+LEXFI=81!(+LEXFI=81.3) LEXHDRS(81)="",LEXHDRS(81.3)=""
"RTN","LEXXGI3",42,0)
 . S:LEXFID=80 LEXNM="ICD-9-CM" S:LEXFID=81 LEXNM="CPT-4/HCPCS" S:LEXFID=757 LEXNM="Lexicon" S LEXB=$G(^LEXM(LEXFI,0,"BUILD"))
"RTN","LEXXGI3",43,0)
 . S LEXVR=$G(^LEXM(LEXFI,0,"VR")),LEXRV=$G(^LEXM(LEXFI,0,"VRRV")),LEXDT=$$MIX^LEXXGI2($$FMTE^XLFDT($P(LEXRV,"^",2))),LEXRV=$P(LEXRV,"^",1)
"RTN","LEXXGI3",44,0)
 . S LEXL1="Updating "_LEXNM S:$L(LEXB) LEXL1=LEXL1_" with patch/build "_LEXB S:$L(LEXVR) LEXL2=" To version "_LEXVR
"RTN","LEXXGI3",45,0)
 . S:$L(LEXVR)&($L(LEXRV)) LEXL2=LEXL2_" revision "_LEXRV S:$L(LEXVR)&($L(LEXRV))&($L(LEXDT)) LEXL2=LEXL2_" dated "_LEXDT
"RTN","LEXXGI3",46,0)
 . S:$L(LEXL1) LEXL1=" "_LEXL1 S:$L(LEXL2) LEXL2=" "_LEXL2 D BL^LEXXGI2 D:$L(LEXL1) TL^LEXXGI2(LEXL1) D:$L(LEXL2) TL^LEXXGI2(LEXL2),BL^LEXXGI2
"RTN","LEXXGI3",47,0)
 S LEXTOT=+($G(^LEXM(LEXFI,0))) G:LEXTOT=0 FILEQ
"RTN","LEXXGI3",48,0)
 S LEXNM=$G(^LEXM(LEXFI,0,"NM"))
"RTN","LEXXGI3",49,0)
 I $L(LEXNM),$$UP^LEXXGI2(LEXNM)'["FILE" S LEXNM=LEXNM_" FILE"
"RTN","LEXXGI3",50,0)
 S:$L(LEXNM) LEXNM=$$MIX^LEXXGI2(LEXNM) S LEXCHG=$G(^LEXM(LEXFI,0))
"RTN","LEXXGI3",51,0)
 S LEXTXT="   "_LEXNM,LEXTXT=LEXTXT_$J("",(40-$L(LEXTXT)))_LEXFI
"RTN","LEXXGI3",52,0)
 D:LEXFIC=1 PB^LEXXGI2(LEXTXT) D:LEXFIC'=1 TL^LEXXGI2(LEXTXT)
"RTN","LEXXGI3",53,0)
 S LEXS=+(LEXTOT\LEXL) S:LEXS=0 LEXS=1 W:+($O(^LEXM(LEXFI,0)))>0 !,"   "
"RTN","LEXXGI3",54,0)
 D UPCHG^LEXXGI2 F  S LEXI=$O(^LEXM(LEXFI,LEXI)) Q:+LEXI=0  D
"RTN","LEXXGI3",55,0)
 . S LEXCNT=LEXCNT+1,LEXMUMPS=$G(^LEXM(LEXFI,LEXI))
"RTN","LEXXGI3",56,0)
 . I LEXCNT'<LEXS S LEXLC=LEXLC+1 W:LEXLC'>LEXL "." S LEXCNT=0
"RTN","LEXXGI3",57,0)
 . S LEXRT=$P(LEXMUMPS,"^",2),LEXFIL=""
"RTN","LEXXGI3",58,0)
 . S:LEXMUMPS["^LEX("!(LEXMUMPS["^LEXT(")!(LEXMUMPS["^LEXC(") LEXFIL=+($P(LEXRT,"(",2)),LEXFL(+($P(LEXRT,"(",2)))=""
"RTN","LEXXGI3",59,0)
 . S:LEXMUMPS["^ICD9(" LEXFIL=80,LEXFL(80)=""
"RTN","LEXXGI3",60,0)
 . S:LEXMUMPS["^ICD0(" LEXFIL=80.1,LEXFL(80.1)=""
"RTN","LEXXGI3",61,0)
 . S:LEXMUMPS["^ICPT(" LEXFIL=81,LEXFL(81)=""
"RTN","LEXXGI3",62,0)
 . S:LEXMUMPS["^DIC(81.3" LEXFIL=81.3,LEXFL(81.3)=""
"RTN","LEXXGI3",63,0)
 . S:LEXMUMPS["^DIC(81.2" LEXFIL=81.2,LEXFL(81.2)=""
"RTN","LEXXGI3",64,0)
 . S:LEXMUMPS["^LEX("!(LEXMUMPS["^LEXT(")!(LEXMUMPS["^LEXC(") LEXFIL=+($P(LEXRT,"(",2))
"RTN","LEXXGI3",65,0)
 . S:LEXMUMPS["^ICD9(" LEXFIL=80 S:LEXMUMPS["^ICD0(" LEXFIL=80.1
"RTN","LEXXGI3",66,0)
 . S:LEXMUMPS["^ICPT(" LEXFIL=81 S:LEXMUMPS["^DIC(81.3" LEXFIL=81.3
"RTN","LEXXGI3",67,0)
 . S:+LEXFIL>0 LEXSCHG(+LEXFIL,0)=""
"RTN","LEXXGI3",68,0)
 . I $L(LEXMUMPS) D
"RTN","LEXXGI3",69,0)
 . . N X S X=LEXMUMPS D ^DIM Q:'$D(X)  X LEXMUMPS S LEXIGO=1
"RTN","LEXXGI3",70,0)
 . . S LEXTOTI=+($G(LEXTOTI))+1 I +($G(LEXTOTN))>0,+($G(LEXTOTI))>0,$D(ZTQUEUED),+($G(ZTSK))>0 D
"RTN","LEXXGI3",71,0)
 . . . N LEXT,LEXTSK S (LEXT,LEXPER)=(+($G(LEXTOTI))/+($G(LEXTOTN)))*100 Q:+LEXPER-(+($G(LEXPRE)))'>2  S LEXPRE=+($G(LEXPER))
"RTN","LEXXGI3",72,0)
 . . . S LEXPER=$J(LEXPER,6,2) I +LEXT>0 S LEXPER=LEXPER_"% complete" S LEXTSK=$$S^%ZTLOAD(LEXPER)
"RTN","LEXXGI3",73,0)
 I +($G(LEXIGO))>0 D
"RTN","LEXXGI3",74,0)
 . S LEXEND=$$HACK^LEXXGI2 S LEXELP=$$ELAP^LEXXGI2(LEXBEG,LEXEND) S:LEXELP="" LEXELP="00:00:00"
"RTN","LEXXGI3",75,0)
FILEQ ;     Load Data for one file - QUIT
"RTN","LEXXGI3",76,0)
 Q
"RTN","LEXXII")
0^5^B36561888^B34625513
"RTN","LEXXII",1,0)
LEXXII ;ISL/KER - Lexicon Status (Install Info) ;07/16/2008
"RTN","LEXXII",2,0)
 ;;2.0;LEXICON UTILITY;**32,46,49,50,41,59**;Sep 23, 1996;Build 6
"RTN","LEXXII",3,0)
 ;              
"RTN","LEXXII",4,0)
 ; Variables NEWed or KILLed Elsewhere
"RTN","LEXXII",5,0)
 ;   LEXACCT  NEWed by LEXXFI sending message
"RTN","LEXXII",6,0)
 ;   LEXID    NEWed by LEXXFI sending message
"RTN","LEXXII",7,0)
 ;   LEXCRE   NEWed by LEXXGI loading data
"RTN","LEXXII",8,0)
 ;   LEXIGHF  NEWed by Post Install routine LEX20nnP
"RTN","LEXXII",9,0)
 ;   XPDA     NEWed by KIDS during Install
"RTN","LEXXII",10,0)
 ;              
"RTN","LEXXII",11,0)
 ; Global Variables
"RTN","LEXXII",12,0)
 ;   DBIA 10096  ^%ZOSF("PROD"
"RTN","LEXXII",13,0)
 ;   DBIA 10096  ^%ZOSF("UCI"
"RTN","LEXXII",14,0)
 ;   DBIA 10060  ^VA(200
"RTN","LEXXII",15,0)
 ;   ^LEXM(0
"RTN","LEXXII",16,0)
 ;   ^TMP("LEX*",$J    SACC 2.3.2.5.1
"RTN","LEXXII",17,0)
 ;              
"RTN","LEXXII",18,0)
 ; External References
"RTN","LEXXII",19,0)
 ;   DBIA 10103  $$FMTE^XLFDT
"RTN","LEXXII",20,0)
 ;   DBIA 10103  $$NOW^XLFDT
"RTN","LEXXII",21,0)
 ;   DBIA 10103  $$FMDIFF^XLFDT
"RTN","LEXXII",22,0)
 ;   DBIA  2056  $$GET1^DIQ (file #200)
"RTN","LEXXII",23,0)
 ;   DBIA  2051  FIND^DIC
"RTN","LEXXII",24,0)
 ;   DBIA  2056  GETS^DIQ
"RTN","LEXXII",25,0)
 ;              
"RTN","LEXXII",26,0)
EN ; Main Entry
"RTN","LEXXII",27,0)
 N LEXSUB S LEXSUB=$G(LEXID) S:LEXSUB="" LEXSUB="LEXXII" K ^TMP(LEXSUB,$J) D II
"RTN","LEXXII",28,0)
 Q
"RTN","LEXXII",29,0)
 ;                               
"RTN","LEXXII",30,0)
II ; Install Information
"RTN","LEXXII",31,0)
 N LEXT,LEXA,LEXACT,LEXB,LEXD,LEXE,LEXL,LEXU,LEXN,LEXP,LEXPROF,LEXDA H 2
"RTN","LEXXII",32,0)
 S LEXA="",LEXACT=$G(LEXACCT),LEXPRO=$G(LEXPRO),LEXPRON=$G(LEXPRON)
"RTN","LEXXII",33,0)
 S:'$L(LEXPRON) LEXPRON="LEXICAL SERVICES UPDATE" S:'$L(LEXPRO) LEXPRO=$G(^LEXM(0,"PRO")) S:+LEXPRO>0 LEXPRO=$$ED(LEXPRO)
"RTN","LEXXII",34,0)
 S LEXT="Lexicon/ICD/CPT Installation" D TL(LEXT)
"RTN","LEXXII",35,0)
 S LEXT="============================" D TL(LEXT),BL
"RTN","LEXXII",36,0)
 S LEXD=$$ASOF,LEXA=$$UCI,LEXU=$$USR,LEXN=$P(LEXU,"^",1)
"RTN","LEXXII",37,0)
 S:$L($P(LEXACT,"^",1))&($L($P(LEXACT,"^",1))) LEXA=LEXACT
"RTN","LEXXII",38,0)
 S LEXP=$P(LEXU,"^",2),LEXN=$$PM^LEXXFI7(LEXN)
"RTN","LEXXII",39,0)
 S:$L(LEXD) LEXT="  As of:       "_LEXD
"RTN","LEXXII",40,0)
 D:$L(LEXD) TL(LEXT)
"RTN","LEXXII",41,0)
 S LEXT="" S:$L(LEXA) LEXT="  In Account:  "_$S($L($P(LEXA,"^",1)):"[",1:"")_$P(LEXA,"^",1)_$S($L($P(LEXA,"^",2)):"]",1:"")
"RTN","LEXXII",42,0)
 S:$L(LEXT)&($L($P(LEXA,"^",2))) LEXT=LEXT_"  "_$P(LEXA,"^",2)
"RTN","LEXXII",43,0)
 D:$L(LEXA) TL(LEXT)
"RTN","LEXXII",44,0)
 S LEXT="" S:$L(LEXU) LEXT="  Maint By:    "
"RTN","LEXXII",45,0)
 S:$L(LEXN) LEXT=LEXT_LEXN
"RTN","LEXXII",46,0)
 S:$L(LEXP)&($L(LEXN)) LEXT=LEXT_"   "_LEXP
"RTN","LEXXII",47,0)
 D:$L(LEXT)&(LEXT'["UNKNOWN") TL(LEXT)
"RTN","LEXXII",48,0)
 S LEXT="" S:$L($G(LEXBUILD)) LEXT="  Build:       "_$G(LEXBUILD)
"RTN","LEXXII",49,0)
 D:$L(LEXT) TL(LEXT)
"RTN","LEXXII",50,0)
 S LEXT="" S:$L($G(LEXIGHF)) LEXT="  Host File:   "_$G(LEXIGHF)
"RTN","LEXXII",51,0)
 S:$L(LEXT)&($L($G(LEXCRE)))&($P($G(LEXCRE),".",1)?7N) LEXT=LEXT_" (Created "_$$ED($G(LEXCRE))_")"
"RTN","LEXXII",52,0)
 S:'$L(LEXT)&($L($G(LEXCRE)))&($P($G(LEXCRE),".",1)?7N) LEXT="  Created:     "_$$ED($G(LEXCRE))
"RTN","LEXXII",53,0)
 D:$L(LEXT) TL(LEXT)
"RTN","LEXXII",54,0)
 S LEXT="" I $L($G(LEXPRO))&($L($G(LEXPRON))) D
"RTN","LEXXII",55,0)
 . S LEXT="  Protocol:    "_LEXPRON D BL,TL(LEXT)
"RTN","LEXXII",56,0)
 . S LEXT="  Invoked:     "_LEXPRO D TL(LEXT)
"RTN","LEXXII",57,0)
 . K LEXPRO,LEXPRON,^LEXM(0,"PRO")
"RTN","LEXXII",58,0)
 S LEXB=$$SS($G(LEXBUILD)),LEXE=$P(LEXB,"^",2),LEXL=$P(LEXB,"^",3),LEXB=$P(LEXB,"^",1)
"RTN","LEXXII",59,0)
 I $P(LEXB,".",1)?7N!($P(LEXB,".",2)?7N)!($P(LEXB,".",3)[":") D
"RTN","LEXXII",60,0)
 . D BL
"RTN","LEXXII",61,0)
 . I $P(LEXB,".",1)?7N D
"RTN","LEXXII",62,0)
 . . S LEXT="" S LEXT="  Started:     "_$$ED($G(LEXB)) D TL(LEXT)
"RTN","LEXXII",63,0)
 . I $P(LEXE,".",1)?7N D
"RTN","LEXXII",64,0)
 . . S LEXT="" S LEXT="  Finished:    "_$$ED($G(LEXE)) D TL(LEXT)
"RTN","LEXXII",65,0)
 . I $L(LEXL) D
"RTN","LEXXII",66,0)
 . . S LEXT="" S LEXT="  Elapsed:     "_$$ED($G(LEXL)) D TL(LEXT)
"RTN","LEXXII",67,0)
 I $L($G(LEXRES)) D
"RTN","LEXXII",68,0)
 . S LEXT="" S LEXT="  Data:        "_$G(LEXRES) D BL,TL(LEXT)
"RTN","LEXXII",69,0)
 D BL
"RTN","LEXXII",70,0)
 Q
"RTN","LEXXII",71,0)
 ;                             
"RTN","LEXXII",72,0)
 ; Miscellaneous
"RTN","LEXXII",73,0)
UCI(X) ;   UCI where Lexicon is installed
"RTN","LEXXII",74,0)
 N LEXU,LEXP,LEXT,Y X ^%ZOSF("UCI") S LEXU=Y,LEXP="" S:LEXU=^%ZOSF("PROD")!($P(LEXU,",",1)=^%ZOSF("PROD")) LEXP=" (Production)"
"RTN","LEXXII",75,0)
 S:LEXU'=^%ZOSF("PROD")&($P(LEXU,",",1)'=^%ZOSF("PROD")) LEXP=" (Test)" S X="",$P(X,"^",1)=LEXU,$P(X,"^",2)=LEXP
"RTN","LEXXII",76,0)
 Q X
"RTN","LEXXII",77,0)
USR(LEX) ;   User/Person
"RTN","LEXXII",78,0)
 N LEXDUZ,LEXPH,LEXNM
"RTN","LEXXII",79,0)
 S LEX=+($G(DUZ)),LEXNM=$$GET1^DIQ(200,+LEX,.01) Q:'$L(LEXNM) "UNKNOWN^"
"RTN","LEXXII",80,0)
 S LEXDUZ=LEX S LEXPH=$$GET1^DIQ(200,+LEXDUZ,.132) S:LEXPH="" LEXPH=$$GET1^DIQ(200,+LEXDUZ,.131)
"RTN","LEXXII",81,0)
 S:LEXPH="" LEXPH=$$GET1^DIQ(200,+LEXDUZ,.133) S:LEXPH="" LEXPH=$$GET1^DIQ(200,+LEXDUZ,.134)
"RTN","LEXXII",82,0)
 S LEXDUZ=$$GET1^DIQ(200,+LEX,.01),LEX=LEXDUZ_"^"_LEXPH Q LEX
"RTN","LEXXII",83,0)
SS(LEX) ;   Start/Stop Times
"RTN","LEXXII",84,0)
 N LEXDA,LEXOUT,LEXIENS,LEXB,LEXBUILD,LEXB,LEXE,LEXL
"RTN","LEXXII",85,0)
 S LEXBUILD=$G(LEX),LEXD=0 S:$L(LEXBUILD) LEXD=$$DDA(LEXBUILD)
"RTN","LEXXII",86,0)
 S LEXDA=+($G(XPDA))
"RTN","LEXXII",87,0)
 I +LEXDA>0 D
"RTN","LEXXII",88,0)
 . S LEXIENS=LEXDA_"," D GETS^DIQ(9.7,LEXIENS,"11;17","I","LEXOUT")
"RTN","LEXXII",89,0)
 . S LEXL=0,LEXB=$G(LEXOUT(9.7,LEXIENS,11,"I"))
"RTN","LEXXII",90,0)
 . S:'$L(LEXB)&($L($G(LEXSTART))&($E($G(LEXSTART),1,7)?7N)) LEXB=$G(LEXSTART)
"RTN","LEXXII",91,0)
 . S LEXE=$$NOW^XLFDT S:+LEXB>0&(+LEXE>0) LEXL=$$EP(LEXB,LEXE)
"RTN","LEXXII",92,0)
 . S LEX=LEXB_"^"_LEXE S:$L(LEXL) $P(LEX,"^",3)=LEXL
"RTN","LEXXII",93,0)
 I +LEXDA=0 D
"RTN","LEXXII",94,0)
 . S LEX="" S LEXDA=+($G(LEXD)) S LEXL="",LEXB=$P($G(LEXD),"^",2)
"RTN","LEXXII",95,0)
 . S:'$L(LEXB)&($L($G(LEXSTART))&($E($G(LEXSTART),1,7)?7N)) LEXB=$G(LEXSTART)
"RTN","LEXXII",96,0)
 . Q:$P(LEXB,".",1)'?7N  S LEXE=$$NOW^XLFDT S:+LEXB>0&(+LEXE>0) LEXL=$$EP(LEXB,LEXE)
"RTN","LEXXII",97,0)
 . S LEX=LEXB_"^"_LEXE S:$L(LEXL) $P(LEX,"^",3)=LEXL
"RTN","LEXXII",98,0)
 Q LEX
"RTN","LEXXII",99,0)
DDA(LEX) ;   Get Default DA of Build LEX
"RTN","LEXXII",100,0)
 N LEXB,LEXE,LEXOUT,LEXMSG,LEXI S LEXB=$G(LEX) Q:'$L(LEXB) ""
"RTN","LEXXII",101,0)
 D FIND^DIC(9.7,,"11I;17I","BP",LEXB,,"B",,,"LEXOUT","LEXMSG")
"RTN","LEXXII",102,0)
 S LEXI=+($O(LEXOUT("DILIST"," "),-1))
"RTN","LEXXII",103,0)
 S LEXB=$G(LEXOUT("DILIST",+LEXI,0))
"RTN","LEXXII",104,0)
 S LEXI=$P(LEXB,"^",1),LEXE=$P(LEXB,"^",4),LEXB=$P(LEXB,"^",3)
"RTN","LEXXII",105,0)
 Q:+($G(LEXI))'>0 ""  Q:+($G(LEXB))'>0 ""  S:+LEXE'>0 LEXE=$$NOW^XLFDT
"RTN","LEXXII",106,0)
 S LEX=LEXI_"^"_LEXB_"^"_LEXE
"RTN","LEXXII",107,0)
 Q LEX
"RTN","LEXXII",108,0)
ASOF(LEX) ;   As of date/time
"RTN","LEXXII",109,0)
 S X=$$ED($$NOW^XLFDT) Q X
"RTN","LEXXII",110,0)
ED(LEX) ;   External Date MM/DD/YYYY TT:TT
"RTN","LEXXII",111,0)
 S LEX=$$FMTE^XLFDT($G(LEX),"1Z")
"RTN","LEXXII",112,0)
 S:LEX["@" LEX=$P(LEX,"@",1)_"  "_$P(LEX,"@",2,299) Q LEX
"RTN","LEXXII",113,0)
 Q LEX
"RTN","LEXXII",114,0)
EP(X,Y) ;   Elapsed Time (Begin, End)
"RTN","LEXXII",115,0)
 N LEXTIM,LEXBEG,LEXEND
"RTN","LEXXII",116,0)
 S LEXBEG=$G(X),LEXEND=$G(Y) Q:+LEXBEG'>0 ""  Q:+LEXEND'>0 ""
"RTN","LEXXII",117,0)
 S LEXTIM=$$FMDIFF^XLFDT(LEXEND,LEXBEG,2) Q:+LEXTIM'>0 "00:00:00"
"RTN","LEXXII",118,0)
 S LEXTIM=$$TIM(LEXTIM)
"RTN","LEXXII",119,0)
 Q LEXTIM
"RTN","LEXXII",120,0)
TIM(X) ;   Format Time Elapsed
"RTN","LEXXII",121,0)
 N LEXD,LEXH,LEXM,LEXS,LEXT,LEXV S X=+($G(X)) Q:X'>0 "00:00:00"
"RTN","LEXXII",122,0)
 S LEXD=X\86400 S LEXV=LEXD*86400 S:+LEXV>0&(LEXV<X) X=X-LEXV
"RTN","LEXXII",123,0)
 S LEXH=X\3600 S LEXV=LEXH*3600 S:+LEXV>0&(LEXV<X) X=X-LEXV
"RTN","LEXXII",124,0)
 S:$L(LEXH)<2 LEXH="0"_LEXH S:$L(LEXH)<2 LEXH="0"_LEXH
"RTN","LEXXII",125,0)
 S LEXM=X\60 S LEXV=LEXM*60 S:+LEXV>0&(LEXV<X) X=X-LEXV
"RTN","LEXXII",126,0)
 S:$L(LEXM)<2 LEXM="0"_LEXM S:$L(LEXM)<2 LEXM="0"_LEXM
"RTN","LEXXII",127,0)
 S LEXS=X S:$L(LEXS)<2 LEXS="0"_LEXS S:$L(LEXS)<2 LEXS="0"_LEXS
"RTN","LEXXII",128,0)
 S LEXT="" S:+LEXD>0 LEXT=+LEXD_" day"_$S(+LEXD>1:"s",1:"")_" "
"RTN","LEXXII",129,0)
 S LEXT=LEXT_LEXH_":"_LEXM_":"_LEXS,X=LEXT
"RTN","LEXXII",130,0)
 Q X
"RTN","LEXXII",131,0)
BL ;   Blank Line
"RTN","LEXXII",132,0)
 D TL("") Q
"RTN","LEXXII",133,0)
TL(LEXX) ;   Text Line
"RTN","LEXXII",134,0)
 S LEXSUB=$G(LEXSUB) S:'$L(LEXSUB) LEXSUB="LEXXII"
"RTN","LEXXII",135,0)
 I '$D(^TMP(LEXSUB,$J,1)) S ^TMP(LEXSUB,$J,1)=" ",^TMP(LEXSUB,$J,0)=1
"RTN","LEXXII",136,0)
 N LEXNX S LEXNX=$O(^TMP(LEXSUB,$J," "),-1),LEXNX=LEXNX+1
"RTN","LEXXII",137,0)
 S ^TMP(LEXSUB,$J,LEXNX)=" "_$G(LEXX),^TMP(LEXSUB,$J,0)=LEXNX
"RTN","LEXXII",138,0)
 Q
"RTN","LEXXII",139,0)
ST ;   Show Temp Array
"RTN","LEXXII",140,0)
 S LEXSUB=$G(LEXSUB) S:'$L(LEXSUB) LEXSUB="LEXXII"
"RTN","LEXXII",141,0)
 N LEXN,LEXC S LEXN="^TMP("""_LEXSUB_""","_$J_")",LEXC="^TMP("""_LEXSUB_""","_$J_","
"RTN","LEXXII",142,0)
 F  S LEXN=$Q(@LEXN) Q:LEXN=""!(LEXN'[LEXC)  D
"RTN","LEXXII",143,0)
 . Q:LEXN[",0)"  W !,@LEXN
"RTN","LEXXII",144,0)
 Q
"RTN","LEXXII2")
0^6^B32005202^n/a
"RTN","LEXXII2",1,0)
LEXXII2 ;ISL/KER - Lexicon Status (Data Status) ;07/16/2008
"RTN","LEXXII2",2,0)
 ;;2.0;LEXICON UTILITY;**59**;Sep 23, 1996;Build 6
"RTN","LEXXII2",3,0)
 ;
"RTN","LEXXII2",4,0)
 ; Variables NEWed or KILLed Elsewhere
"RTN","LEXXII2",5,0)
 ;   LEXSUB  NEWed by LEXXII and LEXXFI sending message
"RTN","LEXXII2",6,0)
 ;   
"RTN","LEXXII2",7,0)
 ; Global Variables
"RTN","LEXXII2",8,0)
 ;    ^LEXM(              N/A
"RTN","LEXXII2",9,0)
 ;    ^TMP("LEXVER",$J)   SACC 2.3.2.5.1
"RTN","LEXXII2",10,0)
 ;               
"RTN","LEXXII2",11,0)
 ; External References
"RTN","LEXXII2",12,0)
 ;    ^DIM                ICR  10016
"RTN","LEXXII2",13,0)
 ;               
"RTN","LEXXII2",14,0)
 Q
"RTN","LEXXII2",15,0)
RESULTS(X) ; Get Results of Install
"RTN","LEXXII2",16,0)
 D SETUP^LEXXII2 N LEXR S LEXR=$$CHK S X="" S:$L($P(LEXR,"^",2)) X=$P(LEXR,"^",2) K ^TMP("LEXVER",$J)
"RTN","LEXXII2",17,0)
 Q X
"RTN","LEXXII2",18,0)
SETUP ; Last Set/Kills (Negation)
"RTN","LEXXII2",19,0)
 Q:'$D(^LEXM)  Q:+($O(^LEXM(0)))'>0  K ^TMP("LEXVER",$J) N LEXC1,LEXC2,LEXCK,LEXCS,LEXCT,LEXEC,LEXFI,LEXIEN,LEXKK,LEXLK,LEXLS,LEXOK,LEXSAB,LEXSK,LEXSS,LEXT,LEXTT,X
"RTN","LEXXII2",20,0)
 S LEXFI=9999.999 F  S LEXFI=$O(^LEXM(LEXFI),-1) Q:+LEXFI=0  D LLF(LEXFI)
"RTN","LEXXII2",21,0)
 S LEXFI=0 F  S LEXFI=$O(^LEXM(LEXFI)) Q:+LEXFI'>0  D FIR(LEXFI) Q:$L($G(LEXSK("FIR","SK")))
"RTN","LEXXII2",22,0)
 D VERC
"RTN","LEXXII2",23,0)
 Q
"RTN","LEXXII2",24,0)
LLF(X) ;   Last Set/Last Kill for File X
"RTN","LEXXII2",25,0)
 N LEXFI,LEXIEN,LEXLK,LEXLS,LEXSAB S LEXFI=$G(X),(LEXLS,LEXLK)="" Q:$O(^LEXM(LEXFI,0))'>0
"RTN","LEXXII2",26,0)
 S LEXSAB=$S(+($G(LEXFI))=80:"ICD",+($G(LEXFI))=80.1:"ICP",+($G(LEXFI))=81:"CPT",+($G(LEXFI))=81.3:"CPM",$E(+($G(LEXFI)),1,3)="757"&($E(+($G(LEXFI)),1,5)'="757.9"):"LEX",1:"")
"RTN","LEXXII2",27,0)
 Q:'$L(LEXSAB)  Q:$L($G(LEXSK(LEXSAB,"LS")))&($L($G(LEXSK(LEXSAB,"LK"))))  S LEXIEN=+($O(^LEXM(LEXFI," "),-1))+1
"RTN","LEXXII2",28,0)
 F  S LEXIEN=$O(^LEXM(LEXFI,LEXIEN),-1) Q:+LEXIEN=0  D  Q:$L(LEXLS)&($L(LEXLK))
"RTN","LEXXII2",29,0)
 . Q:$G(^LEXM(LEXFI,LEXIEN))["^DD("  Q:+LEXIEN=0
"RTN","LEXXII2",30,0)
 . I $E($G(^LEXM(LEXFI,LEXIEN)),1,3)="S ^",'$L(LEXLS),'$L($G(LEXSK(LEXSAB,"LS"))) D
"RTN","LEXXII2",31,0)
 . . S LEXLS=$G(^LEXM(LEXFI,LEXIEN)) S:'$D(LEXSK(LEXSAB,"LS")) LEXSK(LEXSAB,"LS")=$G(^LEXM(LEXFI,LEXIEN))
"RTN","LEXXII2",32,0)
 . I $E($G(^LEXM(LEXFI,LEXIEN)),1,3)="K ^",'$L(LEXLK),'$L($G(LEXSK(LEXSAB,"LK"))) D
"RTN","LEXXII2",33,0)
 . . S LEXLK=$G(^LEXM(LEXFI,LEXIEN)) S:'$D(LEXSK(LEXSAB,"LK")) LEXSK(LEXSAB,"LK")=$G(^LEXM(LEXFI,LEXIEN))
"RTN","LEXXII2",34,0)
 Q
"RTN","LEXXII2",35,0)
FIR(X) ;   First Set/Kill
"RTN","LEXXII2",36,0)
 N LEXFI,LEXIEN,LEXLK,LEXLS,LEXSAB S LEXFI=$G(X),(LEXLS,LEXLK)="" Q:$O(^LEXM(LEXFI,0))'>0  S LEXSAB="FIR"
"RTN","LEXXII2",37,0)
 Q:$L($G(LEXSK(LEXSAB,"SK")))  S LEXIEN=0 F  S LEXIEN=$O(^LEXM(LEXFI,LEXIEN)) Q:+LEXIEN'>0  D  Q:$L($G(LEXSK(LEXSAB,"SK")))
"RTN","LEXXII2",38,0)
 . Q:$L($G(LEXSK(LEXSAB,"SK")))  Q:$G(^LEXM(LEXFI,LEXIEN))["^DD("
"RTN","LEXXII2",39,0)
 . I $E($G(^LEXM(LEXFI,LEXIEN)),1,3)="S ^" S:'$D(LEXSK(LEXSAB,"SK")) LEXSK(LEXSAB,"SK")=$G(^LEXM(LEXFI,LEXIEN)) Q
"RTN","LEXXII2",40,0)
 . I $E($G(^LEXM(LEXFI,LEXIEN)),1,3)="K ^" S:'$D(LEXSK(LEXSAB,"SK")) LEXSK(LEXSAB,"SK")=$G(^LEXM(LEXFI,LEXIEN)) Q
"RTN","LEXXII2",41,0)
 Q
"RTN","LEXXII2",42,0)
VERC ;   Verification Check for file
"RTN","LEXXII2",43,0)
 N LEXCK,LEXCS,LEXCT,LEXKK,LEXSS,LEXTT,LEXSAB
"RTN","LEXXII2",44,0)
 N LEXSAB F LEXSAB="LEX","ICD","CPT","CPM","FIR" D
"RTN","LEXXII2",45,0)
 . S (LEXCS,LEXCK,LEXCT)="" S LEXSS=$G(LEXSK(LEXSAB,"LS")),LEXCS=$P(LEXSS,"=",1),LEXCS=$P(LEXCS," ",2,299)
"RTN","LEXXII2",46,0)
 . S LEXKK=$G(LEXSK(LEXSAB,"LK")),LEXCK=$P(LEXKK,"=",1),LEXCK=$P(LEXCK," ",2,299)
"RTN","LEXXII2",47,0)
 . S LEXTT=$G(LEXSK(LEXSAB,"SK")),LEXCT=$P(LEXTT,"=",1),LEXCT=$P(LEXCT," ",2,299)
"RTN","LEXXII2",48,0)
 . D:$L(LEXCS)!($L(LEXCK))!($L(LEXCT)) VERS
"RTN","LEXXII2",49,0)
 Q
"RTN","LEXXII2",50,0)
VERS ;   Verification Strings
"RTN","LEXXII2",51,0)
 Q:'$L(LEXSAB)  I $G(LEXSAB)="FIR" D  Q
"RTN","LEXXII2",52,0)
 . Q:'$L($G(LEXTT))  Q:'$L($G(LEXCT))  S (LEXC1,LEXC2)=""  I $E(LEXTT,1,3)="S ^",LEXTT[LEXCT D
"RTN","LEXXII2",53,0)
 . . S LEXC1="S:"_"$D("_LEXCT_")"_" LEXOK(""FIR"",1)=1" S X=LEXC1 D ^DIM S:'$D(X) LEXC1=""
"RTN","LEXXII2",54,0)
 . . S LEXC2="S:"_"'$D("_LEXCT_")"_" LEXOK(""FIR"",1)=0" S X=LEXC2 D ^DIM S:'$D(X) LEXC2=""
"RTN","LEXXII2",55,0)
 . I $E(LEXTT,1,3)="K ^",LEXTT[LEXCT D
"RTN","LEXXII2",56,0)
 . . S LEXC1="S:"_"'$D("_LEXCT_")"_" LEXOK(""FIR"",1)=1" S X=LEXC1 D ^DIM S:'$D(X) LEXC1=""
"RTN","LEXXII2",57,0)
 . . S LEXC2="S:"_"$D("_LEXCT_")"_" LEXOK(""FIR"")1)=0" S X=LEXC2 D ^DIM S:'$D(X) LEXC2=""
"RTN","LEXXII2",58,0)
 . S:$L(LEXSAB)&($L(LEXC1)) ^TMP("LEXVER",$J,LEXSAB,1)=LEXC1 S:$L(LEXSAB)&($L(LEXC2)) ^TMP("LEXVER",$J,LEXSAB,2)=LEXC2
"RTN","LEXXII2",59,0)
 N LEXC1,LEXC2 S (LEXC1,LEXC2)=""  S:$L(LEXCS) LEXC1="$D("_LEXCS_")" S:$L(LEXCK) LEXC2="'$D("_LEXCK_")" Q:'$L(LEXC1)&('$L(LEXC2))
"RTN","LEXXII2",60,0)
 I $L(LEXCS)&($L(LEXCK)) D
"RTN","LEXXII2",61,0)
 . S LEXC1="S:"_"$D("_LEXCS_")"_"&("_"'$D("_LEXCK_")"_") LEXOK("""_LEXSAB_""",2)=1" S X=LEXC1 D ^DIM S:'$D(X) LEXC1=""
"RTN","LEXXII2",62,0)
 . S LEXC2="S:"_"'$D("_LEXCS_")"_"!("_"$D("_LEXCK_")"_") LEXOK("""_LEXSAB_""",3)=0" S X=LEXC2 D ^DIM S:'$D(X) LEXC2=""
"RTN","LEXXII2",63,0)
 I $L(LEXCS)&('$L(LEXCK)) D
"RTN","LEXXII2",64,0)
 . S LEXC1="S:"_"$D("_LEXCS_")"_" LEXOK("""_LEXSAB_""",2)=1" S X=LEXC1 D ^DIM S:'$D(X) LEXC1=""
"RTN","LEXXII2",65,0)
 . S LEXC2="S:"_"'$D("_LEXCS_")"_" LEXOK("""_LEXSAB_""",3)=0" S X=LEXC2 D ^DIM S:'$D(X) LEXC2=""
"RTN","LEXXII2",66,0)
 I '$L(LEXCS)&($L(LEXCK)) D
"RTN","LEXXII2",67,0)
 . S LEXC1="S:"_"'$D("_LEXCK_")"_" LEXOK("""_LEXSAB_""",2)=1" S X=LEXC1 D ^DIM S:'$D(X) LEXC1=""
"RTN","LEXXII2",68,0)
 . S LEXC2="S:"_"$D("_LEXCK_")"_" LEXOK("""_LEXSAB_""",3)=0" S X=LEXC2 D ^DIM S:'$D(X) LEXC2=""
"RTN","LEXXII2",69,0)
 S:$L(LEXSAB)&($L(LEXC1)) ^TMP("LEXVER",$J,LEXSAB,1)=LEXC1 S:$L(LEXSAB)&($L(LEXC2)) ^TMP("LEXVER",$J,LEXSAB,2)=LEXC2
"RTN","LEXXII2",70,0)
 Q
"RTN","LEXXII2",71,0)
 ;                 
"RTN","LEXXII2",72,0)
CHECK ; Check if Data is installed
"RTN","LEXXII2",73,0)
 N LEXC,LEXEC,LEXFN,LEXOK,LEXSAB,LEXST,LEXT,X S LEXC=$$CHK K ^TMP("LEXVER",$J) Q:'$L($P(LEXC,"^",2))
"RTN","LEXXII2",74,0)
 S LEXT="  Data:        "_$P(LEXC,"^",2) D TL(LEXT)
"RTN","LEXXII2",75,0)
 Q
"RTN","LEXXII2",76,0)
CHK(X) ;   Check if Data is Fully Installed
"RTN","LEXXII2",77,0)
 Q:'$D(^TMP("LEXVER",$J)) ""  N LEXEC,LEXFN,LEXOK,LEXSAB,LEXST,LEXT S LEXST=0,LEXFN=1,LEXOK("FIR",1)=0 F LEXSAB="LEX","ICD","CPT","CPM" D
"RTN","LEXXII2",78,0)
 . Q:'$D(^TMP("LEXVER",$J,LEXSAB))  S LEXOK(LEXSAB,2)=0,LEXOK(LEXSAB,3)=1
"RTN","LEXXII2",79,0)
 F LEXSAB="FIR","LEX","ICD","CPT","CPM" D
"RTN","LEXXII2",80,0)
 . Q:'$D(^TMP("LEXVER",$J,LEXSAB))  S (LEXEC,X)=$G(^TMP("LEXVER",$J,LEXSAB,1)) D ^DIM X:$D(X) LEXEC
"RTN","LEXXII2",81,0)
 . S (LEXEC,X)=$G(^TMP("LEXVER",$J,LEXSAB,2)) D ^DIM X:$D(X) LEXEC
"RTN","LEXXII2",82,0)
 . Q:LEXSAB="FIR"  S:+($G(LEXOK(LEXSAB,2)))'>0 LEXFN=0
"RTN","LEXXII2",83,0)
 S:+($G(LEXOK("FIR",1)))>0 LEXST=1
"RTN","LEXXII2",84,0)
 S:+($G(LEXST))>0&(+($G(LEXFN))>0) X="1^Installation of data completed successfully"
"RTN","LEXXII2",85,0)
 S:+($G(LEXST))>0&(+($G(LEXFN))'>0) X="0^Installation of data started but did not finish (incomplete)"
"RTN","LEXXII2",86,0)
 S:+($G(LEXST))'>0 X="0^Installation of data not started (incomplete)"
"RTN","LEXXII2",87,0)
 S:'$D(^TMP("LEXVER",$J)) X=0
"RTN","LEXXII2",88,0)
 Q X
"RTN","LEXXII2",89,0)
 ;                 
"RTN","LEXXII2",90,0)
 ; Miscellaneous
"RTN","LEXXII2",91,0)
BL ;   Blank Line
"RTN","LEXXII2",92,0)
 D TL("") Q
"RTN","LEXXII2",93,0)
TL(X) ;   Text Line
"RTN","LEXXII2",94,0)
 W !,$G(X) Q
"RTN","LEXXII2",95,0)
 S LEXSUB=$G(LEXSUB) S:'$L(LEXSUB) LEXSUB="LEXXII"
"RTN","LEXXII2",96,0)
 I '$D(^TMP(LEXSUB,$J,1)) S ^TMP(LEXSUB,$J,1)=" ",^TMP(LEXSUB,$J,0)=1
"RTN","LEXXII2",97,0)
 N LEXNX S LEXNX=$O(^TMP(LEXSUB,$J," "),-1),LEXNX=LEXNX+1
"RTN","LEXXII2",98,0)
 S ^TMP(LEXSUB,$J,LEXNX)=" "_$G(X),^TMP(LEXSUB,$J,0)=LEXNX
"RTN","LEXXII2",99,0)
 Q
"VER")
8.0^22.0
"^DD",757.01,757.01,.01,0)
DISPLAYABLE TEXT^RFX^^0;1^I $D(X) K:$L(X)>240!($L(X)<1) X
"^DD",757.01,757.01,.01,1,0)
^.1
"^DD",757.01,757.01,.01,1,1,0)
757.01^B
"^DD",757.01,757.01,.01,1,1,1)
S ^LEX(757.01,"B",$E($$UP^XLFSTR(X),1,63),DA)=""
"^DD",757.01,757.01,.01,1,1,2)
K ^LEX(757.01,"B",$E($$UP^XLFSTR(X),1,63),DA)
"^DD",757.01,757.01,.01,1,1,"%D",0)
^^4^4^2940902^
"^DD",757.01,757.01,.01,1,1,"%D",1,0)
^LEX(757.01,"B",EXP,IEN) - where EXP is the expression (either a Major Concept,
"^DD",757.01,757.01,.01,1,1,"%D",2,0)
Synonym or a Lexical Variant) in the Expression file #757.01 and IEN is the
"^DD",757.01,757.01,.01,1,1,"%D",3,0)
Internal Entry Number in the Expression file #757.01 where this expression is
"^DD",757.01,757.01,.01,1,1,"%D",4,0)
located.
"^DD",757.01,757.01,.01,1,2,0)
757.01^ASL^MUMPS
"^DD",757.01,757.01,.01,1,2,1)
D SSF^LEXNDX6
"^DD",757.01,757.01,.01,1,2,2)
D KSF^LEXNDX6
"^DD",757.01,757.01,.01,1,2,"%D",0)
^^3^3^2950212^
"^DD",757.01,757.01,.01,1,2,"%D",1,0)
^LEX(757.01,"ASL",STR,FREQ) - Where STR is a string found in the Clinical
"^DD",757.01,757.01,.01,1,2,"%D",2,0)
Lexicon and FREQ is the number of times (frequency) it occurrs.  This is not
"^DD",757.01,757.01,.01,1,2,"%D",3,0)
an index.
"^DD",757.01,757.01,.01,1,2,"DT")
2950212
"^DD",757.01,757.01,.01,3)
Displayable Text must be 1-240 characters in length.
"^DD",757.01,757.01,.01,21,0)
^.001^2^2^3061011^^^^
"^DD",757.01,757.01,.01,21,1,0)
This is the text which will be used to represent the expression (Major Concept,
"^DD",757.01,757.01,.01,21,2,0)
Synonym or Lexical Variant).
"^DD",757.01,757.01,.01,"DT")
3061011
"^DD",757.01,757.01,.01,"LAYGO",1,0)
I 0
"BLD",7230,6)
^55
**END**
**END**
