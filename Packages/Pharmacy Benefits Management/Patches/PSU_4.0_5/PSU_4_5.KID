KIDS Distribution saved on Nov 14, 2008@09:56:11
PBM patches PSU*4*5, PSJ*5*161, PSO*7*170, DG*5.3*671
**KIDS**:PSU*4.0*5^PSJ*5.0*161^PSO*7.0*170^DG*5.3*671^

**INSTALL NAME**
PSU*4.0*5
"BLD",6053,0)
PSU*4.0*5^PHARMACY BENEFITS MANAGEMENT^0^3081114^y
"BLD",6053,1,0)
^^34^34^3080304^^^
"BLD",6053,1,1,0)
This patch addresses a request which support the Pharmacy Benefits
"BLD",6053,1,2,0)
Management (PBM) Extracts Enhancement #3 project. In order to allow the
"BLD",6053,1,3,0)
retransmission of only those patients who have had demographic updates,
"BLD",6053,1,4,0)
Outpatient Pharmacy V. 7.0, Inpatient Medications V. 5.0, Registration
"BLD",6053,1,5,0)
v. 5.3 and Pharmacy Data Management V. 1.0 were modified to build an entry
"BLD",6053,1,6,0)
for re-transmission in PBM PATIENT DEMOGRAPHICS File #59.9.
"BLD",6053,1,7,0)
 
"BLD",6053,1,8,0)
The following issues are addressed in this patch:
"BLD",6053,1,9,0)
1. The logic in routine PSUHL was corrected so that when an edit is made
"BLD",6053,1,10,0)
to the RACE INFORMATION field #2 or ETHNICITY INFORMATION field #6 in
"BLD",6053,1,11,0)
the PATIENT File #2, an entry is queued in the PBM PATIENT DEMOGRAPHICS
"BLD",6053,1,12,0)
File #59.9. Currently, because of flawed logic when edits are made to
"BLD",6053,1,13,0)
either of these two fields, an entry is not queued.
"BLD",6053,1,14,0)
 
"BLD",6053,1,15,0)
The integration agreement #4803 was added to record the usage of routine
"BLD",6053,1,16,0)
PSUHL by other packages.
"BLD",6053,1,17,0)
 
"BLD",6053,1,18,0)
 
"BLD",6053,1,19,0)
2. The Automatic Pharmacy Statistics [PSU PBM AUTO] report generated a
"BLD",6053,1,20,0)
<SUSBCRIPT> error condition. This error was created when the report was
"BLD",6053,1,21,0)
run before any monthly data was filed. Routine PSUHL was modified to quit
"BLD",6053,1,22,0)
the FOR loop at line tag CLEANUP when the DAY variable is NULL.
"BLD",6053,1,23,0)
 
"BLD",6053,1,24,0)

"BLD",6053,1,25,0)
3. Sites reported getting <STORE>SETDPT+9^DPTLK1 errors which was traced
"BLD",6053,1,26,0)
to the protocol PSU PATIENT DEMOGRAPHIC CHANGE called by the DG FIELD
"BLD",6053,1,27,0)
MONITOR protocol. Line tag LOGDFN was changed to use the DBS call
"BLD",6053,1,28,0)
UPDATE^DIE instead of the Fileman call FILE^DICN.
"BLD",6053,1,29,0)
 
"BLD",6053,1,30,0)
4. During internal testing, a problem was discovered with the handling
"BLD",6053,1,31,0)
of local data elements in routine PSUHL. The killing of those variables
"BLD",6053,1,32,0)
presents the potential for problems later in other areas. This patch
"BLD",6053,1,33,0)
corrects the way in which these variables are handled.
"BLD",6053,1,34,0)

"BLD",6053,4,0)
^9.64PA^^0
"BLD",6053,6)
1^
"BLD",6053,6.3)
22
"BLD",6053,"ABPKG")
n
"BLD",6053,"KRN",0)
^9.67PA^8989.52^19
"BLD",6053,"KRN",.4,0)
.4
"BLD",6053,"KRN",.4,"NM",0)
^9.68A^^
"BLD",6053,"KRN",.401,0)
.401
"BLD",6053,"KRN",.402,0)
.402
"BLD",6053,"KRN",.403,0)
.403
"BLD",6053,"KRN",.5,0)
.5
"BLD",6053,"KRN",.84,0)
.84
"BLD",6053,"KRN",3.6,0)
3.6
"BLD",6053,"KRN",3.8,0)
3.8
"BLD",6053,"KRN",9.2,0)
9.2
"BLD",6053,"KRN",9.8,0)
9.8
"BLD",6053,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",6053,"KRN",9.8,"NM",1,0)
PSUHL^^0^B5015040
"BLD",6053,"KRN",9.8,"NM","B","PSUHL",1)

"BLD",6053,"KRN",19,0)
19
"BLD",6053,"KRN",19,"NM",0)
^9.68A^^0
"BLD",6053,"KRN",19.1,0)
19.1
"BLD",6053,"KRN",101,0)
101
"BLD",6053,"KRN",409.61,0)
409.61
"BLD",6053,"KRN",771,0)
771
"BLD",6053,"KRN",870,0)
870
"BLD",6053,"KRN",8989.51,0)
8989.51
"BLD",6053,"KRN",8989.52,0)
8989.52
"BLD",6053,"KRN",8994,0)
8994
"BLD",6053,"KRN","B",.4,.4)

"BLD",6053,"KRN","B",.401,.401)

"BLD",6053,"KRN","B",.402,.402)

"BLD",6053,"KRN","B",.403,.403)

"BLD",6053,"KRN","B",.5,.5)

"BLD",6053,"KRN","B",.84,.84)

"BLD",6053,"KRN","B",3.6,3.6)

"BLD",6053,"KRN","B",3.8,3.8)

"BLD",6053,"KRN","B",9.2,9.2)

"BLD",6053,"KRN","B",9.8,9.8)

"BLD",6053,"KRN","B",19,19)

"BLD",6053,"KRN","B",19.1,19.1)

"BLD",6053,"KRN","B",101,101)

"BLD",6053,"KRN","B",409.61,409.61)

"BLD",6053,"KRN","B",771,771)

"BLD",6053,"KRN","B",870,870)

"BLD",6053,"KRN","B",8989.51,8989.51)

"BLD",6053,"KRN","B",8989.52,8989.52)

"BLD",6053,"KRN","B",8994,8994)

"BLD",6053,"QDEF")
^^^^NO^^^^NO^^YES
"BLD",6053,"QUES",0)
^9.62^^
"BLD",6053,"REQB",0)
^9.611^^0
"MBREQ")
0
"PKG",367,-1)
1^1
"PKG",367,0)
PHARMACY BENEFITS MANAGEMENT^PSU^PHARMACY BENEFITS MANAGEMENT
"PKG",367,22,0)
^9.49I^1^1
"PKG",367,22,1,0)
4.0^3050622^3050901^10000000010
"PKG",367,22,1,"PAH",1,0)
5^3081114^11882
"PKG",367,22,1,"PAH",1,1,0)
^^34^34^3081114
"PKG",367,22,1,"PAH",1,1,1,0)
This patch addresses a request which support the Pharmacy Benefits
"PKG",367,22,1,"PAH",1,1,2,0)
Management (PBM) Extracts Enhancement #3 project. In order to allow the
"PKG",367,22,1,"PAH",1,1,3,0)
retransmission of only those patients who have had demographic updates,
"PKG",367,22,1,"PAH",1,1,4,0)
Outpatient Pharmacy V. 7.0, Inpatient Medications V. 5.0, Registration
"PKG",367,22,1,"PAH",1,1,5,0)
v. 5.3 and Pharmacy Data Management V. 1.0 were modified to build an entry
"PKG",367,22,1,"PAH",1,1,6,0)
for re-transmission in PBM PATIENT DEMOGRAPHICS File #59.9.
"PKG",367,22,1,"PAH",1,1,7,0)
 
"PKG",367,22,1,"PAH",1,1,8,0)
The following issues are addressed in this patch:
"PKG",367,22,1,"PAH",1,1,9,0)
1. The logic in routine PSUHL was corrected so that when an edit is made
"PKG",367,22,1,"PAH",1,1,10,0)
to the RACE INFORMATION field #2 or ETHNICITY INFORMATION field #6 in
"PKG",367,22,1,"PAH",1,1,11,0)
the PATIENT File #2, an entry is queued in the PBM PATIENT DEMOGRAPHICS
"PKG",367,22,1,"PAH",1,1,12,0)
File #59.9. Currently, because of flawed logic when edits are made to
"PKG",367,22,1,"PAH",1,1,13,0)
either of these two fields, an entry is not queued.
"PKG",367,22,1,"PAH",1,1,14,0)
 
"PKG",367,22,1,"PAH",1,1,15,0)
The integration agreement #4803 was added to record the usage of routine
"PKG",367,22,1,"PAH",1,1,16,0)
PSUHL by other packages.
"PKG",367,22,1,"PAH",1,1,17,0)
 
"PKG",367,22,1,"PAH",1,1,18,0)
 
"PKG",367,22,1,"PAH",1,1,19,0)
2. The Automatic Pharmacy Statistics [PSU PBM AUTO] report generated a
"PKG",367,22,1,"PAH",1,1,20,0)
<SUSBCRIPT> error condition. This error was created when the report was
"PKG",367,22,1,"PAH",1,1,21,0)
run before any monthly data was filed. Routine PSUHL was modified to quit
"PKG",367,22,1,"PAH",1,1,22,0)
the FOR loop at line tag CLEANUP when the DAY variable is NULL.
"PKG",367,22,1,"PAH",1,1,23,0)
 
"PKG",367,22,1,"PAH",1,1,24,0)

"PKG",367,22,1,"PAH",1,1,25,0)
3. Sites reported getting <STORE>SETDPT+9^DPTLK1 errors which was traced
"PKG",367,22,1,"PAH",1,1,26,0)
to the protocol PSU PATIENT DEMOGRAPHIC CHANGE called by the DG FIELD
"PKG",367,22,1,"PAH",1,1,27,0)
MONITOR protocol. Line tag LOGDFN was changed to use the DBS call
"PKG",367,22,1,"PAH",1,1,28,0)
UPDATE^DIE instead of the Fileman call FILE^DICN.
"PKG",367,22,1,"PAH",1,1,29,0)
 
"PKG",367,22,1,"PAH",1,1,30,0)
4. During internal testing, a problem was discovered with the handling
"PKG",367,22,1,"PAH",1,1,31,0)
of local data elements in routine PSUHL. The killing of those variables
"PKG",367,22,1,"PAH",1,1,32,0)
presents the potential for problems later in other areas. This patch
"PKG",367,22,1,"PAH",1,1,33,0)
corrects the way in which these variables are handled.
"PKG",367,22,1,"PAH",1,1,34,0)

"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSUHL")
0^1^B5015040
"RTN","PSUHL",1,0)
PSUHL ;BIR/RDC - DYNAMIC CAPTURE OF PATIENT DEMOGRAPHICS ;05 MAR 2004
"RTN","PSUHL",2,0)
 ;;4.0;PHARMACY BENEFITS MANAGEMENT;**5**;MARCH, 2005;Build 22
"RTN","PSUHL",3,0)
 ;
"RTN","PSUHL",4,0)
 ;DBIA's
"RTN","PSUHL",5,0)
 ; Reference to file 55      supported by DBIA 3502
"RTN","PSUHL",6,0)
 ; Reference to file 2 (for protocol PSU PATIENT DEMOGRAPHIC CHANGE)
"RTN","PSUHL",7,0)
 ;                           supported by DBIA 3344
"RTN","PSUHL",8,0)
 ;
"RTN","PSUHL",9,0)
CHNG ; THIS TAG WILL EXECUTE UPON ANY MODIFICATION TO THE PATIENT FILE #2
"RTN","PSUHL",10,0)
 ; CHANGES TO ANY FIELDS OTHER THAN THOSE INHERANT TO THE 
"RTN","PSUHL",11,0)
 ; PATIENT DEMOGRAPHIC EXTRACT (^PSUDEM1) WILL BE IGNORED
"RTN","PSUHL",12,0)
 ; SUCCESSFUL EXECUTION OF THIS TAG WILL RESULT IN THE DATE AND
"RTN","PSUHL",13,0)
 ; DFN BEING LOGGED IN THE PBM PATIENT DEMOGRAPHICS file #59.9
"RTN","PSUHL",14,0)
 ;
"RTN","PSUHL",15,0)
 N FIELD
"RTN","PSUHL",16,0)
 ;                               ; ** loop thru pertinent fields **
"RTN","PSUHL",17,0)
 ;
"RTN","PSUHL",18,0)
 I DGFILE=2 F FIELD=.351,.03,.02,.361,.14,27.01,.09,991.01,.104,.097,2.02,2.06 I $G(DGFIELD)=FIELD D LOGDFN(DGDA) Q      ; flag if one of our fields changes
"RTN","PSUHL",19,0)
 I DGFILE=2.02,$G(DGFIELD)=.01 D LOGDFN(DGDA(1))
"RTN","PSUHL",20,0)
 I DGFILE=2.06,$G(DGFIELD)=.01 D LOGDFN(DGDA(1))
"RTN","PSUHL",21,0)
 ;
"RTN","PSUHL",22,0)
 Q
"RTN","PSUHL",23,0)
 ;
"RTN","PSUHL",24,0)
LOGDFN(DFN)            ; This tag will log the date & dfn to file #59.9
"RTN","PSUHL",25,0)
 ;
"RTN","PSUHL",26,0)
 Q:+$G(DFN)=0                    ; no patient pointer to log ***
"RTN","PSUHL",27,0)
 Q:$D(^PSUDEM("C",DFN,DT))       ; patient already logged for today
"RTN","PSUHL",28,0)
 N PSSDA
"RTN","PSUHL",29,0)
 S PSSDA(59.9,"+1,",.01)=DT
"RTN","PSUHL",30,0)
 S PSSDA(59.9,"+1,",.02)=DFN
"RTN","PSUHL",31,0)
 D UPDATE^DIE("","PSSDA")
"RTN","PSUHL",32,0)
 Q
"RTN","PSUHL",33,0)
 ; 
"RTN","PSUHL",34,0)
PHARM ;
"RTN","PSUHL",35,0)
 ; THIS TAG IS TRIGGERED BY A CROSS REFERENCE ON THE 
"RTN","PSUHL",36,0)
 ; PHARMACY PATIENT FILE (#55); FIRST SERVICE DATE (#.07)
"RTN","PSUHL",37,0)
 ;
"RTN","PSUHL",38,0)
 D LOGDFN(DA)              ;log change of patient demographics
"RTN","PSUHL",39,0)
 Q
"RTN","PSUHL",40,0)
 ;
"RTN","PSUHL",41,0)
CLEANUP ;  THIS TAG CLEANS UP DATA IN ^PSUDEM >75 DAYS
"RTN","PSUHL",42,0)
 ;
"RTN","PSUHL",43,0)
 N MIN,DAY,DFN,DIK,X1,X2,X
"RTN","PSUHL",44,0)
 S X1=DT,X2=-75
"RTN","PSUHL",45,0)
 D C^%DTC S MIN=X                                      ;today-75 days
"RTN","PSUHL",46,0)
 S DIK="^PSUDEM("                                 ;file root to kill
"RTN","PSUHL",47,0)
 S DAY=""
"RTN","PSUHL",48,0)
 F  S DAY=$O(^PSUDEM("B",DAY)) Q:DAY=""  Q:DAY>MIN  D  ;loop thru days
"RTN","PSUHL",49,0)
 . S DFN=""                                       ;older than 75 days
"RTN","PSUHL",50,0)
 . F  S DFN=$O(^PSUDEM("B",DAY,DFN)) Q:DFN=""  D  ;get the dfn
"RTN","PSUHL",51,0)
 .. S DA=DFN D ^DIK                     ; and have Fileman kill the dfn
"RTN","PSUHL",52,0)
 ;
"RTN","PSUHL",53,0)
 Q
"RTN","PSUHL",54,0)
 ;
"VER")
8.0^22.0
**INSTALL NAME**
PSJ*5.0*161
"BLD",6079,0)
PSJ*5.0*161^INPATIENT MEDICATIONS^0^3081114^y
"BLD",6079,1,0)
^^37^37^3080306^
"BLD",6079,1,1,0)
                             I M P O R T A N T
"BLD",6079,1,2,0)
 
"BLD",6079,1,3,0)
*************************************************************************
"BLD",6079,1,4,0)
 This Inpatient Medications patch PSJ*5*161 along with PSU*4*5, PSO*7*170
"BLD",6079,1,5,0)
 and DG*5.3*671 is being released in a single KIDS software distribution 
"BLD",6079,1,6,0)
 host file, PSU_4_P5.KID as part of the Pharmacy Benefits Management (PBM)
"BLD",6079,1,7,0)
 Extracts Enhancement #3 project. PSS*1*99 which is also part of this
"BLD",6079,1,8,0)
 enhancement is being released separately.
"BLD",6079,1,9,0)
 
"BLD",6079,1,10,0)
 This patch description includes only the informational portion of
"BLD",6079,1,11,0)
 PSJ*5*161. Please refer to the "Software Retrieval Instructions" and
"BLD",6079,1,12,0)
 "Installation Instructions" sections of the PSU*4*5 patch description
"BLD",6079,1,13,0)
for instructions on how to  acquire and install the patch software.
"BLD",6079,1,14,0)
 
"BLD",6079,1,15,0)
*************************************************************************
"BLD",6079,1,16,0)
 
"BLD",6079,1,17,0)
  
"BLD",6079,1,18,0)
       ********************* WARNING *********************
"BLD",6079,1,19,0)
       *****************************************************
"BLD",6079,1,20,0)
     If your facility has the Pyxis/Omnicell/McKesson interface 
"BLD",6079,1,21,0)
     from ILC this patch will overwrite any "local" modifications 
"BLD",6079,1,22,0)
     in routine PSGOETO. This could affect certain orders being 
"BLD",6079,1,23,0)
     sent across this interface.  The modifications will have to 
"BLD",6079,1,24,0)
     be reintroduced following installation of this patch.
"BLD",6079,1,25,0)
       *****************************************************
"BLD",6079,1,26,0)
       *****************************************************
"BLD",6079,1,27,0)
 
"BLD",6079,1,28,0)
 
"BLD",6079,1,29,0)
This patch addresses a request which supports the Pharmacy Benefits
"BLD",6079,1,30,0)
Management (PBM) Extracts Enhancement #3 project. In order to allow the
"BLD",6079,1,31,0)
retransmission of only those patients who have had demographic updates,
"BLD",6079,1,32,0)
Outpatient Pharmacy V. 7.0, Inpatient Medications V. 5.0, Registration
"BLD",6079,1,33,0)
v. 5.3 and Pharmacy Data Management V. 1.0 were modified to build an
"BLD",6079,1,34,0)
entry for re-transmission in PBM PATIENT DEMOGRAPHICS File #59.9.
"BLD",6079,1,35,0)
 
"BLD",6079,1,36,0)
Whenever the FIRST SERVICE DATE field (#.07) in the PHARMACY PATIENT 
"BLD",6079,1,37,0)
file #55 is updated for a patient, an entry is queued for retransmission.
"BLD",6079,4,0)
^9.64PA^^
"BLD",6079,6)
3^
"BLD",6079,6.3)
28
"BLD",6079,"ABPKG")
n
"BLD",6079,"INID")
n
"BLD",6079,"KRN",0)
^9.67PA^8989.52^19
"BLD",6079,"KRN",.4,0)
.4
"BLD",6079,"KRN",.401,0)
.401
"BLD",6079,"KRN",.402,0)
.402
"BLD",6079,"KRN",.403,0)
.403
"BLD",6079,"KRN",.5,0)
.5
"BLD",6079,"KRN",.84,0)
.84
"BLD",6079,"KRN",3.6,0)
3.6
"BLD",6079,"KRN",3.8,0)
3.8
"BLD",6079,"KRN",9.2,0)
9.2
"BLD",6079,"KRN",9.8,0)
9.8
"BLD",6079,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",6079,"KRN",9.8,"NM",1,0)
PSGOT^^0^B15393110
"BLD",6079,"KRN",9.8,"NM",2,0)
PSGOETO^^0^B34640551
"BLD",6079,"KRN",9.8,"NM",3,0)
PSIVORFB^^0^B61354894
"BLD",6079,"KRN",9.8,"NM","B","PSGOETO",2)

"BLD",6079,"KRN",9.8,"NM","B","PSGOT",1)

"BLD",6079,"KRN",9.8,"NM","B","PSIVORFB",3)

"BLD",6079,"KRN",19,0)
19
"BLD",6079,"KRN",19.1,0)
19.1
"BLD",6079,"KRN",101,0)
101
"BLD",6079,"KRN",409.61,0)
409.61
"BLD",6079,"KRN",771,0)
771
"BLD",6079,"KRN",870,0)
870
"BLD",6079,"KRN",8989.51,0)
8989.51
"BLD",6079,"KRN",8989.52,0)
8989.52
"BLD",6079,"KRN",8994,0)
8994
"BLD",6079,"KRN","B",.4,.4)

"BLD",6079,"KRN","B",.401,.401)

"BLD",6079,"KRN","B",.402,.402)

"BLD",6079,"KRN","B",.403,.403)

"BLD",6079,"KRN","B",.5,.5)

"BLD",6079,"KRN","B",.84,.84)

"BLD",6079,"KRN","B",3.6,3.6)

"BLD",6079,"KRN","B",3.8,3.8)

"BLD",6079,"KRN","B",9.2,9.2)

"BLD",6079,"KRN","B",9.8,9.8)

"BLD",6079,"KRN","B",19,19)

"BLD",6079,"KRN","B",19.1,19.1)

"BLD",6079,"KRN","B",101,101)

"BLD",6079,"KRN","B",409.61,409.61)

"BLD",6079,"KRN","B",771,771)

"BLD",6079,"KRN","B",870,870)

"BLD",6079,"KRN","B",8989.51,8989.51)

"BLD",6079,"KRN","B",8989.52,8989.52)

"BLD",6079,"KRN","B",8994,8994)

"BLD",6079,"QUES",0)
^9.62^^
"BLD",6079,"REQB",0)
^9.611^3^2
"BLD",6079,"REQB",2,0)
PSU*4.0*5^2
"BLD",6079,"REQB",3,0)
PSJ*5.0*213^2
"BLD",6079,"REQB","B","PSJ*5.0*213",3)

"BLD",6079,"REQB","B","PSU*4.0*5",2)

"MBREQ")
0
"PKG",197,-1)
1^1
"PKG",197,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",197,20,0)
^9.402P^^
"PKG",197,22,0)
^9.49I^1^1
"PKG",197,22,1,0)
5.0^2971215^2980917^11712
"PKG",197,22,1,"PAH",1,0)
161^3081114^11882
"PKG",197,22,1,"PAH",1,1,0)
^^37^37^3081114
"PKG",197,22,1,"PAH",1,1,1,0)
                             I M P O R T A N T
"PKG",197,22,1,"PAH",1,1,2,0)
 
"PKG",197,22,1,"PAH",1,1,3,0)
*************************************************************************
"PKG",197,22,1,"PAH",1,1,4,0)
 This Inpatient Medications patch PSJ*5*161 along with PSU*4*5, PSO*7*170
"PKG",197,22,1,"PAH",1,1,5,0)
 and DG*5.3*671 is being released in a single KIDS software distribution 
"PKG",197,22,1,"PAH",1,1,6,0)
 host file, PSU_4_P5.KID as part of the Pharmacy Benefits Management (PBM)
"PKG",197,22,1,"PAH",1,1,7,0)
 Extracts Enhancement #3 project. PSS*1*99 which is also part of this
"PKG",197,22,1,"PAH",1,1,8,0)
 enhancement is being released separately.
"PKG",197,22,1,"PAH",1,1,9,0)
 
"PKG",197,22,1,"PAH",1,1,10,0)
 This patch description includes only the informational portion of
"PKG",197,22,1,"PAH",1,1,11,0)
 PSJ*5*161. Please refer to the "Software Retrieval Instructions" and
"PKG",197,22,1,"PAH",1,1,12,0)
 "Installation Instructions" sections of the PSU*4*5 patch description
"PKG",197,22,1,"PAH",1,1,13,0)
for instructions on how to  acquire and install the patch software.
"PKG",197,22,1,"PAH",1,1,14,0)
 
"PKG",197,22,1,"PAH",1,1,15,0)
*************************************************************************
"PKG",197,22,1,"PAH",1,1,16,0)
 
"PKG",197,22,1,"PAH",1,1,17,0)
  
"PKG",197,22,1,"PAH",1,1,18,0)
       ********************* WARNING *********************
"PKG",197,22,1,"PAH",1,1,19,0)
       *****************************************************
"PKG",197,22,1,"PAH",1,1,20,0)
     If your facility has the Pyxis/Omnicell/McKesson interface 
"PKG",197,22,1,"PAH",1,1,21,0)
     from ILC this patch will overwrite any "local" modifications 
"PKG",197,22,1,"PAH",1,1,22,0)
     in routine PSGOETO. This could affect certain orders being 
"PKG",197,22,1,"PAH",1,1,23,0)
     sent across this interface.  The modifications will have to 
"PKG",197,22,1,"PAH",1,1,24,0)
     be reintroduced following installation of this patch.
"PKG",197,22,1,"PAH",1,1,25,0)
       *****************************************************
"PKG",197,22,1,"PAH",1,1,26,0)
       *****************************************************
"PKG",197,22,1,"PAH",1,1,27,0)
 
"PKG",197,22,1,"PAH",1,1,28,0)
 
"PKG",197,22,1,"PAH",1,1,29,0)
This patch addresses a request which supports the Pharmacy Benefits
"PKG",197,22,1,"PAH",1,1,30,0)
Management (PBM) Extracts Enhancement #3 project. In order to allow the
"PKG",197,22,1,"PAH",1,1,31,0)
retransmission of only those patients who have had demographic updates,
"PKG",197,22,1,"PAH",1,1,32,0)
Outpatient Pharmacy V. 7.0, Inpatient Medications V. 5.0, Registration
"PKG",197,22,1,"PAH",1,1,33,0)
v. 5.3 and Pharmacy Data Management V. 1.0 were modified to build an
"PKG",197,22,1,"PAH",1,1,34,0)
entry for re-transmission in PBM PATIENT DEMOGRAPHICS File #59.9.
"PKG",197,22,1,"PAH",1,1,35,0)
 
"PKG",197,22,1,"PAH",1,1,36,0)
Whenever the FIRST SERVICE DATE field (#.07) in the PHARMACY PATIENT 
"PKG",197,22,1,"PAH",1,1,37,0)
file #55 is updated for a patient, an entry is queued for retransmission.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","PSGOETO")
0^2^B34640551
"RTN","PSGOETO",1,0)
PSGOETO ;BIR/CML3-TRANSCRIBE ORDERS ;25 Feb 99 / 1:17 PM
"RTN","PSGOETO",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**3,13,25,31,33,50,68,58,85,105,90,117,110,111,112,161**;16 DEC 97;Build 28
"RTN","PSGOETO",3,0)
 ;
"RTN","PSGOETO",4,0)
 ; Reference to ^PS(51.2 is supported by DBIA #2178.
"RTN","PSGOETO",5,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSGOETO",6,0)
 ; Reference to ^PS(59.7 is supported by DBIA #2181.
"RTN","PSGOETO",7,0)
 ; Reference to ^PSUHL is supported by DBIA 4803.
"RTN","PSGOETO",8,0)
 ;
"RTN","PSGOETO",9,0)
 W:'$D(PSGOEE)&'$D(PSGOES) !!,"...transcribing this ",$S($D(PSGOES):"",'PSGOEAV:"non-verified ",1:"active "),"order..." S PSGOETOF=1 S:PSGSM="" PSGSM=0
"RTN","PSGOETO",10,0)
 I PSGPR'=PSGOEPR D:'$D(^PS(55,PSGP,0)) ENSET0^PSGNE3(PSGP) S $P(^PS(55,PSGP,5.1),U,2)=PSGPR,PSGOEPR=PSGPR
"RTN","PSGOETO",11,0)
 K ND4,DA D ENGNN:'PSGOEAV,ENGNA:PSGOEAV S PSGDT=$$DATE^PSJUTL2() I $S($D(ORACTION):0,$G(PSGOEE)="R":1,+$G(^PS(55,PSGP,5.1))>PSGDT:0,1:$G(PSGOEE)'="E") D ENWALL^PSGNE3(PSGNESD,PSGNEFD,PSGP)
"RTN","PSGOETO",12,0)
 I $D(^PS(51.2,+PSGMR,0)),$P(^(0),U,3)]"" S PSGMRN=$P(^(0),U,3)
"RTN","PSGOETO",13,0)
 S ND=DA_U_PSGPR_U_PSGMR_"^U^"_PSGSM_U_PSGHSM_U_PSGST_"^^"_$S(PSGOEAV:"A",1:"N")_"^^^^^"_PSGDT_U_PSGP_U_PSGDT S:PSGNEDFD $P(ND,U,$P(PSGNEDFD,U)["L"+10)=+PSGNEDFD
"RTN","PSGOETO",14,0)
 S:$D(PSGOEE) $P(ND,U,24,25)=PSGOEE_U_PSGOORD S:'PSGOEAV $P(ND,U,18)=DA S ND2=PSGSCH_U_$S(+PSGNESD=PSGNESD:+PSGNESD,1:"")_"^^"_+PSGNEFD_U_PSGS0Y_U_PSGS0XT_"^^^^"_+PSJPWD
"RTN","PSGOETO",15,0)
 ; naked reference below refers to ^PS(55,PSGP,0)
"RTN","PSGOETO",16,0)
 I PSGOEAV S F=^PS(55,PSGP,0) I $P(F,"^",7)="" S $P(F,"^",7)=$P($P(ND,"^",16),"."),$P(F,"^",8)="A",^(0)=F D LOGDFN^PSUHL(PSGP)
"RTN","PSGOETO",17,0)
 S $P(ND4,U,7)=DUZ I PSGOEAV,PSJSYSU D
"RTN","PSGOETO",18,0)
 .S $P(ND4,U,PSJSYSU,PSJSYSU+1)=DUZ_U_PSGDT,$P(ND4,U,+PSJSYSU=1+9)=1,$P(ND4,U,+PSJSYSU=3+9)=0
"RTN","PSGOETO",19,0)
 .S $P(ND4,U,9,10)=+$P(ND4,U,9)_U_+$P(ND4,U,10)
"RTN","PSGOETO",20,0)
 .I '$P(ND4,U,9) S ^PS(55,"APV",PSGP,DA)=""
"RTN","PSGOETO",21,0)
 .I '$P(ND4,U,10) S ^PS(55,"NPV",PSGP,DA)=""
"RTN","PSGOETO",22,0)
 .I $P(ND4,U,9) K ^PS(55,"APV",PSGP,DA)
"RTN","PSGOETO",23,0)
 .I $P(ND4,U,10) K ^PS(55,"NPV",PSGP,DA)
"RTN","PSGOETO",24,0)
 S F="^PS("_$S(PSGOEAV:"55,"_PSGP_",5",1:53.1)_","_DA_",",@(F_"0)")=ND
"RTN","PSGOETO",25,0)
 ;naked reference below refers to full reference inside indirection @(F_".2)") for either file 53.1 or 55
"RTN","PSGOETO",26,0)
 S @(F_".2)")=PSGPDRG_U_PSGDO_U_PSJNOO S:$G(PSJDOSE("DO"))]"" $P(^(.2),U,5,6)=$P(PSJDOSE("DO"),U,1,2)
"RTN","PSGOETO",27,0)
 I '$D(PSJDOSE("DO")),$D(PSGORD),PSGPDRG=$P(@("^PS("_$S(PSGORD["U":"55,"_PSGP_",5",1:53.1)_","_+PSGORD_",.2)"),U) S $P(@(F_".2)"),U,5,6)=$P(@("^PS("_$S(PSGORD["U":"55,"_PSGP_",5",1:53.1)_","_+PSGORD_",.2)"),U,5,6)
"RTN","PSGOETO",28,0)
 ;naked reference below refers to full reference inside indirection @(F_"2)") for either file 53.1 or 55
"RTN","PSGOETO",29,0)
 S @(F_"2)")=$S(PSGOEAV:ND2,1:$P(ND2,"^",1,6)),^(4)=ND4 S:PSGSI]"" ^(6)=PSGSI
"RTN","PSGOETO",30,0)
 S (C,X)=0 F  S X=$O(^PS(53.45,PSJSYSP,2,X)) Q:'X  S D=$G(^(X,0)) I D,$S('$P(D,U,3):1,1:$P(D,U,3)>DT) S C=C+1,@(F_"1,"_C_",0)")=$P(D,U,1,2),@(F_"1,""B"","_+D_","_C_")")=""
"RTN","PSGOETO",31,0)
 S:C @(F_"1,0)")=U_$S(PSGOEAV:55.07,1:53.11)_"P^"_C_U_C
"RTN","PSGOETO",32,0)
 S (C,Q)=0 F  S Q=$O(^PS(53.45,PSJSYSP,1,Q)) Q:'Q  S X=$G(^(Q,0)) S:X]"" C=C+1,@(F_"3,"_C_",0)")=X
"RTN","PSGOETO",33,0)
 S:C @(F_"3,0)")=U_$S(PSGOEAV:55.08,1:53.12)_U_C_U_C
"RTN","PSGOETO",34,0)
 I $P(ND,U,24)="R" S %X="^PS(55,"_PSGP_",5,"_+PSGORD_",12,",%Y=F_"12," D %XY^%RCR
"RTN","PSGOETO",35,0)
 W "." D CRN:'PSGOEAV,CRA:PSGOEAV
"RTN","PSGOETO",36,0)
 ; don't send message to CPRS if from Order Set and autoverify turned off
"RTN","PSGOETO",37,0)
 S PSGORD=DA_$S(PSGOEAV:"U",1:"P")
"RTN","PSGOETO",38,0)
 I $G(PSGOORD),$D(PSGOEE) N CLINAPPT S CLINAPPT=$S(PSGOORD["U":$G(^PS(55,PSGP,5,+PSGOORD,8)),PSGOORD["P":$G(^PS(53.1,+PSGOORD,"DSS")),1:"") I CLINAPPT D
"RTN","PSGOETO",39,0)
 .N DIE,DA,DR
"RTN","PSGOETO",40,0)
 .I PSGORD["U" S DIE="^PS(55,"_PSGP_",5,",DA=+PSGORD,DA(1)=PSGP,DR="130////"_+CLINAPPT_";" S:$P(CLINAPPT,"^",2) DR=DR_"131////"_$P(CLINAPPT,"^",2)_";"
"RTN","PSGOETO",41,0)
 .I PSGORD["P" S DIE="^PS(53.1,",DA=+PSGORD,DR="113////"_+CLINAPPT_";" S:$P(CLINAPPT,"^",2) DR=DR_"126////"_$P(CLINAPPT,"^",2)_";"
"RTN","PSGOETO",42,0)
 .I $G(DR) D ^DIE
"RTN","PSGOETO",43,0)
 D:('$D(PSGOES))!(($D(PSGOES)&(PSGOEAV))) ORSET^PSGOETO1
"RTN","PSGOETO",44,0)
 I $D(PSGOES),'$D(PSGOESON) N PSGOESON S PSGOESON=PSGORD D DISACTIO^PSJOE(DFN,PSGORD,0) D:PSGORD["U"&(PSGOESON=PSGORD)&($P(@(PSGOEEWF_"0)"),"^",9)'="D") EN^PSGPEN(PSGORD) G OUT
"RTN","PSGOETO",45,0)
 D DONE S PSGCANFL="" I '$D(PSGOEE) S PSJLM=1,PSGOEEF=0 D GETUD^PSJLMGUD(PSGP,PSGORD),ENSFE^PSGOEE0(PSGP,PSGORD),EN^VALM("PSJ LM ACCEPT") I PSGCANFL=1 G OUT
"RTN","PSGOETO",46,0)
 I $D(PSJSYSO) S PSGPOSA="W",PSGPOSD=PSGDT D ENPOS^PSGVDS
"RTN","PSGOETO",47,0)
 S DA=+PSGORD,X=$P(PSGORD,DA,2) I PSJSYSL,$S(PSGOEAV:1,1:PSJSYSL<3),$S("AOU"[X:'$D(^PS(55,PSGP,5,+PSGORD,7)),1:'$D(^PS(53.1,+PSGORD,7))) D
"RTN","PSGOETO",48,0)
 .; naked ref below is from line above, ^PS(53.1,+PSGORD,7)
"RTN","PSGOETO",49,0)
 .S $P(^(7),U,1,2)=PSGDT_"^N"_$G(PSGOEE),PSGUOW=DUZ,PSGTOL=2,PSGTOO=$S("AOU"[X:1,1:2) D ENL^PSGVDS
"RTN","PSGOETO",50,0)
OUT ;
"RTN","PSGOETO",51,0)
 K PSGOETOF
"RTN","PSGOETO",52,0)
DONE ;
"RTN","PSGOETO",53,0)
 I PSGOEAV L -^PS(55,PSGP,5,+PSGORD)
"RTN","PSGOETO",54,0)
 I 'PSGOEAV L -^PS(53.1,+PSGORD)
"RTN","PSGOETO",55,0)
 K C,D,ND,ND2,ND4,PSGDO,PSGDRG,PSGDRGN,PSGFOK,PSGHSM,PSGMR,PSGMRN,PSGNEDFD,PSGNEFD,PSGNESD,PSGPDRG,PSGPDRGN,PSGSI,PSGSTN,PSJDOSE
"RTN","PSGOETO",56,0)
 Q
"RTN","PSGOETO",57,0)
CRA ;
"RTN","PSGOETO",58,0)
 S:PSGPDRG ^PS(55,PSGP,5,"C",PSGPDRG,DA)="" S (^PS(55,"AUE",PSGP,DA),^PS(55,PSGP,5,"AU",PSGST,+PSGNEFD,DA),^PS(55,PSGP,5,"AUS",+PSGNEFD,DA))="",^PS(55,"AUD",+$P(ND2,"^",4),PSGP,DA)="",^PS(55,"AUDS",+$P(ND2,"^",2),PSGP,DA)=""
"RTN","PSGOETO",59,0)
 I $$PATCH^XPDUTL("PXRM*1.5*12") S X(1)=+PSGNESD,X(2)=+PSGNEFD,DA(1)=PSGP D SPSPA^PSJXRFS(.X,.DA,"UD")
"RTN","PSGOETO",60,0)
 S DA(1)=PSGP K DIK S DIK="^PS(55,"_DA(1)_",5,",DIK(1)=125 D EN1^DIK K DIK
"RTN","PSGOETO",61,0)
 K PSGALO,PSGALR S DA(1)=PSGP,PSGAL("C")=PSJSYSU*10+$S('$D(PSGOEE):22500,PSGOEE="E":22600,1:22700) D ^PSGAL5 Q
"RTN","PSGOETO",62,0)
CRN ;
"RTN","PSGOETO",63,0)
 S (^PS(53.1,"AC",PSGP,DA),^PS(53.1,"AS","N",PSGP,DA),^PS(53.1,"B",DA,DA),^PS(53.1,"C",PSGP,DA))="" S:PSGPDRG (^PS(53.1,"AOD",PSGP,PSGPDRG,DA),^PS(53.1,"D",PSGPDRG,DA))="" Q
"RTN","PSGOETO",64,0)
ENGNA ;
"RTN","PSGOETO",65,0)
 F  L +^PS(55,PSGP,5,0):$S($G(DILOCKTM)>0:DILOCKTM,1:3) S:'$D(^PS(55,PSGP,0)) ^(0)=PSGP,^PS(55,"B",PSGP,PSGP)="" S ND=$S($D(^PS(55,PSGP,5,0)):^(0),1:"^55.06IA") Q
"RTN","PSGOETO",66,0)
 N PSGLCK S PSGLCK=0
"RTN","PSGOETO",67,0)
 F DA=$P(ND,U,3)+1:1 W "." I '$D(^PS(55,PSGP,5,DA)),'$D(^PS(55,PSGP,5,"B",DA)) D  I PSGLCK S ^PS(55,PSGP,5,DA,0)=DA,^PS(55,PSGP,5,"B",DA,DA)="",$P(ND,U,3)=DA,$P(ND,U,4)=$P(ND,U,4)+1,^PS(55,PSGP,5,0)=ND Q
"RTN","PSGOETO",68,0)
 . L +^PS(55,PSGP,5,DA):$S($G(DILOCKTM)>0:DILOCKTM,1:3) I  S PSGLCK=1
"RTN","PSGOETO",69,0)
 L -^PS(55,PSGP,5,0) Q
"RTN","PSGOETO",70,0)
ENGNN ;
"RTN","PSGOETO",71,0)
 N ND F  L +^PS(59.7,1,25):$S($G(DILOCKTM)>0:DILOCKTM,1:3) I  S DA=+$G(^PS(59.7,1,25)) Q
"RTN","PSGOETO",72,0)
 F DA=DA+1:1 I '$D(^PS(53.1,DA)),'$D(^PS(53.1,"B",DA)) L +^PS(53.1,DA):$S($G(DILOCKTM)>0:DILOCKTM,1:3) I  S ^PS(59.7,1,25)=DA,^PS(53.1,DA,0)=DA,^PS(53.1,"B",DA,DA)="" Q
"RTN","PSGOETO",73,0)
 F  L +^PS(53.1,0):$S($G(DILOCKTM)>0:DILOCKTM,1:3) I  S ND=$G(^PS(53.1,0)),$P(ND,U,3)=DA,$P(ND,U,4)=$P(ND,U,4)+1,^(0)=ND Q
"RTN","PSGOETO",74,0)
 L -^PS(59.7,1,25),-^PS(53.1,0)
"RTN","PSGOETO",75,0)
 Q
"RTN","PSGOT")
0^1^B15393110
"RTN","PSGOT",1,0)
PSGOT ;BIR/CML3-TRANSFERS DATA FROM 53.1 TO 55 ;24 SEP 97 / 7:54 AM
"RTN","PSGOT",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**13,68,90,110,173,134,161**;16 DEC 97;Build 28
"RTN","PSGOT",3,0)
 ;
"RTN","PSGOT",4,0)
 ; Reference to ^PS(55 supported by DBIA 2191.
"RTN","PSGOT",5,0)
 ; Reference to ^PSUHL supported by DBIA 4803.
"RTN","PSGOT",6,0)
 ;
"RTN","PSGOT",7,0)
START ; get internal record number, lock record, and write
"RTN","PSGOT",8,0)
 S ODA=+PSGORD S:$D(^PS(55,PSGP,0))[0 ^(0)=PSGP,^PS(55,"B",PSGP,PSGP)="",$P(^PS(55,0),U,3,4)=PSGP_U_($P($G(^PS(55,0)),U,4)+1) F  L +^PS(55,PSGP,5,0):$S($G(DILOCKTM)>0:DILOCKTM,1:3) I  Q
"RTN","PSGOT",9,0)
 S ZND=$G(^PS(55,PSGP,5,0)) S:ZND="" ZND="^55.06IA" F DA=$P(ZND,"^",3)+1:1 I '$D(^PS(55,PSGP,5,DA)),'$D(^("B",DA)) L +^PS(55,PSGP,5,DA):$S($G(DILOCKTM)>0:DILOCKTM,1:3) I  S $P(ZND,"^",3)=DA,$P(ZND,"^",4)=$P(ZND,"^",4)+1,^PS(55,PSGP,5,0)=ZND Q
"RTN","PSGOT",10,0)
 L -^PS(55,PSGP,5,0) S ND0=^PS(53.1,ODA,0),$P(ND0,"^",23)=PSJPWD,^PS(55,PSGP,5,DA,0)=ND0
"RTN","PSGOT",11,0)
 S (ND1,^PS(55,PSGP,5,DA,.2))=$G(^PS(53.1,ODA,.2)),^PS(55,PSGP,5,DA,.3)=$G(^PS(53.1,ODA,.3)),(ND2,^PS(55,PSGP,5,DA,2))=^PS(53.1,ODA,2),^PS(55,PSGP,5,DA,4)=$G(^PS(53.1,ODA,4)),^PS(55,"AUD",+$P(ND2,"^",4),PSGP,DA)=""
"RTN","PSGOT",12,0)
 S X=^PS(55,PSGP,0) I $P(X,"^",7)="" S $P(X,"^",7)=$P($P(ND0,"^",16),"."),$P(X,"^",8)="A",^(0)=X D LOGDFN^PSUHL(PSGP)
"RTN","PSGOT",13,0)
 I $P($G(^PS(55,PSGP,5,DA,2)),"^",6)="" S $P(^PS(55,PSGP,5,DA,2),"^",6)=$S($G(PSGS0XT)'="":PSGS0XT,$P($G(ZZND),"^",3)'="":$P(ZZND,"^",3),1:""),$P(^PS(53.1,ODA,2),"^",6)=$P(^PS(55,PSGP,5,DA,2),"^",6)
"RTN","PSGOT",14,0)
 F X=6,7,13 I $D(^PS(53.1,ODA,X)) S ^PS(55,PSGP,5,DA,X)=^(X)
"RTN","PSGOT",15,0)
 I $D(^PS(53.1,ODA,"DSS")) S ^PS(55,PSGP,5,DA,8)=^("DSS")
"RTN","PSGOT",16,0)
 I $O(^PS(53.1,ODA,1,0)) S (C,X)=0 F  S X=$O(^PS(53.1,ODA,1,X)) Q:'X  S:$D(^(X,0)) C=C+1,^PS(55,PSGP,5,DA,1,C,0)=^(0),^PS(55,PSGP,5,DA,1,"B",+$P($G(^(0)),U),C)=""
"RTN","PSGOT",17,0)
 I $O(^PS(53.1,ODA,1,0)) S ^PS(55,PSGP,5,DA,1,0)="^55.07P^"_C_"^"_C
"RTN","PSGOT",18,0)
 F X=3,12 D  S ^PS(55,PSGP,5,DA,X,0)="^55.0"_$S(X=3:8,1:612)_U_CNT_U_CNT
"RTN","PSGOT",19,0)
 .S CNT=0 F C=0:0 S C=$O(^PS(53.1,ODA,X,C)) Q:'C  I $D(^(C,0)) S ^PS(55,PSGP,5,DA,X,C,0)=^(0),CNT=CNT+1
"RTN","PSGOT",20,0)
 S $P(^PS(53.1,ODA,0),"^",19)=DA
"RTN","PSGOT",21,0)
CR ; set x-refs
"RTN","PSGOT",22,0)
 N A
"RTN","PSGOT",23,0)
 I $D(^PS(55,PSGP,5.1)),$P(^(5.1),"^",6) S X=$P(^(5.1),"^",6) I $P(ND2,"^",3),$P(ND2,"^",6)'>X S $P(^(5.1),"^",6)=$P(ND2,"^",3)
"RTN","PSGOT",24,0)
 S ^PS(55,PSGP,5,"B",+ODA,DA)="",^PS(55,PSGP,5,"AU",$P(ND0,"^",7),+$P(ND2,"^",4),DA)=""
"RTN","PSGOT",25,0)
 S ^PS(55,PSGP,5,"AUS",+$P(ND2,"^",4),DA)=""
"RTN","PSGOT",26,0)
 S ^PS(55,PSGP,5,"C",+ND1,DA)="",^PS(55,"AUE",PSGP,DA)=""
"RTN","PSGOT",27,0)
 S ^PS(55,"AUDS",+$P(ND2,"^",2),PSGP,DA)=""
"RTN","PSGOT",28,0)
 I $D(^PS(55,PSGP,5,DA,8)) S A=^(8),^PS(55,"AUDC",+$P(ND2,"^",4),+A,PSGP,DA)=""
"RTN","PSGOT",29,0)
 I $$PATCH^XPDUTL("PXRM*1.5*12") S X(1)=+$P(ND2,"^",2),X(2)=+$P(ND2,"^",4),DA(1)=PSGP D SPSPA^PSJXRFS(.X,.DA,"UD")
"RTN","PSGOT",30,0)
 K DIK S DA(1)=PSGP S DIK="^PS(55,"_DA(1)_",5,",DIK(1)=125 D EN1^DIK K DIK
"RTN","PSGOT",31,0)
 S PSGTOL=2,PSGTOO=1 F PSGUOW=0:0 S PSGUOW=$O(^PS(53.41,2,1,PSGUOW)) Q:'PSGUOW  I $D(^(PSGUOW,1,PSGP,1,2,1,ODA)) K ^(ODA) D ENL^PSGVDS
"RTN","PSGOT",32,0)
DONE I $D(PSGOE2),PSGOE2]"",$D(^TMP("PSJON",$J,PSGOE2)) S ^(PSGOE2)=DA_"U"
"RTN","PSGOT",33,0)
 S PSGODA=ODA,PSGORD=DA_"U"
"RTN","PSGOT",34,0)
 S PSGNODE=$G(^PS(55,PSGP,5,DA,0)),PSG25=$P(PSGNODE,"^",25),PSG26=$P(PSGNODE,"^",26)
"RTN","PSGOT",35,0)
 I PSG25 S X=$S(PSG25["V":"^PS(55,"_PSGP_",""IV"",",PSG25["U"!(PSG25["A"):"^PS(55,"_PSGP_",5,",1:"^PS(53.1,")_+PSG25_","_$E("02",PSG25["V"+1)_")" I $D(@X) S $P(@X,"^",$S(PSG25["V":6,1:26))=DA_"U"
"RTN","PSGOT",36,0)
 I $P(PSGNODE,"^",26),$P(PSGNODE,"^",26)'["V",$D(^PS(55,PSGP,5,+$P(PSGNODE,"^",26),0)) S $P(^(0),"^",25)=DA_"U"
"RTN","PSGOT",37,0)
 F Q=0:0 S Q=$O(^PS(53.44,Q)) Q:'Q  I $D(^(Q,1,PSGP,ODA,0)) S $P(^(0),"^",2)=DA
"RTN","PSGOT",38,0)
 L -^PS(53.1,ODA) L -^PS(55,DFN,5,+PSGORD) K CNT,ND,ODA,XX,ZND Q
"RTN","PSIVORFB")
0^3^B61354894
"RTN","PSIVORFB",1,0)
PSIVORFB ;BIR/MLM-FILE/RETRIEVE ORDERS IN ^PS(55 ;25 Sep 98 / 2:24 PM
"RTN","PSIVORFB",2,0)
 ;;5.0; INPATIENT MEDICATIONS ;**3,18,28,68,58,85,110,111,120,134,213,161**;16 DEC 97;Build 28
"RTN","PSIVORFB",3,0)
 ;
"RTN","PSIVORFB",4,0)
 ; Reference to ^PS(50.7 is supported by DBIA #2180.
"RTN","PSIVORFB",5,0)
 ; Reference to ^PS(51.2 is supported by DBIA #2178.
"RTN","PSIVORFB",6,0)
 ; Reference to ^PS(52.6 is supported by DBIA #1231.
"RTN","PSIVORFB",7,0)
 ; Reference to ^PS(52.7 is supported by DBIA #2173.
"RTN","PSIVORFB",8,0)
 ; Reference to ^PS(55 is supported by DBIA #2191.
"RTN","PSIVORFB",9,0)
 ; Reference to ^PS(51.1 is supported by DBIA #2177.
"RTN","PSIVORFB",10,0)
 ; Reference to ^PSUHL is supported by DBIA #4803.
"RTN","PSIVORFB",11,0)
 ; 
"RTN","PSIVORFB",12,0)
NEW55 ; Get new order number in 55.
"RTN","PSIVORFB",13,0)
 N DA,DD,DO,DIC,DLAYGO,X,Y,PSIVLIM,MINS,PSJDSTP1,PSJDSTP2,A,PSJCLIN,PSJDNM,PSJPROV,PSJWARD,PSJPAO,PSJALRT
"RTN","PSIVORFB",14,0)
 I $D(^PS(55,+DFN)),'$D(^PS(55,+DFN,0)) D ENSET0^PSGNE3(+DFN)
"RTN","PSIVORFB",15,0)
 I $G(PSJORD)["V"!($G(PSJORD)["P"),$G(P(2))]"" D LIMSTOP(.PSJDSTP1,.PSJDSTP2)
"RTN","PSIVORFB",16,0)
 I ($G(PSJORD)["P"!($G(PSJORD)["V"))&$G(PSIVLIM) I $$CMPLIM(PSJORD,PSJDSTP1,PSJDSTP2) D
"RTN","PSIVORFB",17,0)
 . D
"RTN","PSIVORFB",18,0)
 .. S PSJPROV=DUZ I PSJORD["P" S PSJPROV=$P($G(^PS(53.1,+PSJORD,0)),"^",2)
"RTN","PSIVORFB",19,0)
 .. I PSJORD["V" S PSJPROV=$P($G(^PS(55,DFN,"IV",+PSJORD,0)),"^",6)
"RTN","PSIVORFB",20,0)
 .. D NOW^%DTC S XQA(PSJPROV)="",XQAID="PSJ,"_DFN_";"_PSJPROV_";"_%,XQADATA=""
"RTN","PSIVORFB",21,0)
 .. D
"RTN","PSIVORFB",22,0)
 ... I PSJORD["P" S A=$G(^PS(53.1,+PSJORD,"DSS"))
"RTN","PSIVORFB",23,0)
 ... I PSJORD["V" S A=$G(^PS(55,PSGP,"IV",+PSJORD,"DSS"))
"RTN","PSIVORFB",24,0)
 ... S PSJCLIN=$P(A,"^") I PSJCLIN]"" S PSJCLIN=$P(^SC(PSJCLIN,0),"^")
"RTN","PSIVORFB",25,0)
 .. S A=$G(^DPT(DFN,0)),PSJWARD=$G(^(.1))
"RTN","PSIVORFB",26,0)
 .. S XQAMSG=$P(A,"^")_" ("_$E($P(A,"^"))_$E($P(A,"^",9),6,9)_"): ["_$S(PSJWARD]"":$E(PSJWARD,1,10),$G(PSJCLIN)]"":$E(PSJCLIN,1,10),1:"UNKNOWN")_"] "
"RTN","PSIVORFB",27,0)
 .. S A=$O(DRG("AD",0)) I A]"" S A=DRG("AD",A)
"RTN","PSIVORFB",28,0)
 .. I A="" S A=$O(DRG("SOL",0)) I A]"" S A=DRG("SOL",A)
"RTN","PSIVORFB",29,0)
 .. S PSJDNM=$P(^PS(50.7,+$P(A,"^",6),0),"^")
"RTN","PSIVORFB",30,0)
 .. S XQAMSG=XQAMSG_PSJDNM_" your DURATION not used for stop date/time"
"RTN","PSIVORFB",31,0)
 .. D SETUP^XQALERT
"RTN","PSIVORFB",32,0)
 .. S PSJALRT=$$FMTDUR^PSJLIVMD($S(PSJORD["P":$P($G(^PS(53.1,+PSJORD,2.5)),"^",4),PSJORD["IV":$P($G(^PS(55,DFN,"IV",+PSJORD,2.5)),"^",4),1:"UNK"))
"RTN","PSIVORFB",33,0)
 S DIC="^PS(55,",DIC(0)="LN",DLAYGO=55,(DINUM,X)=+DFN D ^DIC Q:Y<0
"RTN","PSIVORFB",34,0)
LOCK0 F  L +^PS(55,DFN,"IV",0):$S($G(DILOCKTM)>0:DILOCKTM,1:3) I  Q
"RTN","PSIVORFB",35,0)
 S ND=$S($D(^PS(55,DFN,"IV",0)):^(0),1:"^55.01") F DA=$P(ND,"^",3)+1:1 W "." I '$D(^PS(55,DFN,"IV",DA)) S $P(ND,"^",3)=DA,$P(ND,"^",4)=$P(ND,"^",4)+1,^PS(55,DFN,"IV",0)=ND Q
"RTN","PSIVORFB",36,0)
 L +^PS(55,DFN,"IV",+DA):$S($G(DILOCKTM)>0:DILOCKTM,1:3) E  G LOCK0
"RTN","PSIVORFB",37,0)
 S ^PS(55,DFN,"IV",+DA,0)=+DA,^PS(55,DFN,"IV","B",+DA,+DA)=""
"RTN","PSIVORFB",38,0)
 L -^PS(55,DFN,"IV",0) S ON55=+DA_"V"
"RTN","PSIVORFB",39,0)
 I $G(PSJALRT)]"" S PSIVAL="IV LIMIT OVERRIDDEN ("_$G(PSJALRT)_"): ALERT SENT",PSIVALT="",PSIVREA="E" D
"RTN","PSIVORFB",40,0)
 .D LOG^PSIVORAL S P("LIMIT")="",P("OVRIDE")=1 K IVLIM,IVLIMIT
"RTN","PSIVORFB",41,0)
 .S $P(^PS(55,DFN,"IV",+ON55,2.5),"^",4)="" S:$G(PSJORD)["P" $P(^PS(53.1,+PSJORD,2.5),"^",4)=""
"RTN","PSIVORFB",42,0)
 .K PSIVAL,PSIVREA,PSIVALT
"RTN","PSIVORFB",43,0)
 Q
"RTN","PSIVORFB",44,0)
SET55 ; Move data from local variables to 55.
"RTN","PSIVORFB",45,0)
 I '$D(ON55) W !,"*** Can't create this order at this time ***" Q
"RTN","PSIVORFB",46,0)
 N DA,DIK,ND,PSIVACT,PSIVDUR
"RTN","PSIVORFB",47,0)
 S:'$D(P(21)) (P(21),P("21FLG"))="" S ND(0)=+ON55,P(22)=$S(VAIN(4):+VAIN(4),1:.5) F X=2:1:23 I $D(P(X)) S $P(ND(0),U,X)=P(X)
"RTN","PSIVORFB",48,0)
 S ND(.3)=$G(P("INS")),ND(2.5)="" N X S X=$S($G(PSGORD):PSGORD,1:$G(ON)) I X D
"RTN","PSIVORFB",49,0)
 .N PKG S PKG=$E(X,$L(X)) S PKG=$S(PKG="V":"""IV""",PKG="U":5,PKG="P":"P",1:"") Q:PKG=""
"RTN","PSIVORFB",50,0)
 .S PSIVDUR=$$GETDUR^PSJLIVMD(DFN,+X,$E(X,$L(X)),1) Q:PSIVDUR=""
"RTN","PSIVORFB",51,0)
 .I $G(IVLIMIT) S ND(2.5)="^^^"_PSIVDUR K IVLIMIT Q
"RTN","PSIVORFB",52,0)
 S $P(ND(0),U,17)="A",ND(1)=P("REM"),ND(3)=P("OPI"),ND(.2)=$P($G(P("PD")),U)_U_$G(P("DO"))_U_+P("MR")_U_$G(P("PRY"))_U_$G(P("NAT"))_U_U_U_$G(P("PRNTON"))
"RTN","PSIVORFB",53,0)
 F X=0,1,2.5,3,.2,.3 S ^PS(55,DFN,"IV",+ON55,X)=ND(X)
"RTN","PSIVORFB",54,0)
 ; PSJ*5*213 - if Piggyback, intermittent syringe, or
"RTN","PSIVORFB",55,0)
 ; intermittent chemotherapy, and frequency is null, attempt to
"RTN","PSIVORFB",56,0)
 ; set frequency again based on P(15),PSGS0XT, and piece 3 of ZZND if they exist.
"RTN","PSIVORFB",57,0)
 ; If this still is null, attempt to re-set based upon the schedule name.
"RTN","PSIVORFB",58,0)
 I $G(P("IVCAT"))="I"!($P($G(ND(0)),U,4)?1(1"P",1"S",1"C"))&($P($G(ND(0)),U,15)="") D
"RTN","PSIVORFB",59,0)
 . I $P($G(ND(0)),U,4)="S",$P($G(ND(0)),U,5)'=1 Q  ;Not intermittent syringe
"RTN","PSIVORFB",60,0)
 . I $P($G(ND(0)),U,4)="C",$P($G(ND(0)),U,23)?1(1"A",1"H") Q  ;Not chemo piggyback or syringe
"RTN","PSIVORFB",61,0)
 . I $P($G(ND(0)),U,4)="C",$P($G(ND(0)),U,23)="S",$P($G(ND(0)),U,5)'=1 Q  ;Not intermitent chemo syringe
"RTN","PSIVORFB",62,0)
 . S $P(^PS(55,DFN,"IV",+ON55,0),U,15)=$S($G(P(15))'="":P(15),$G(PSGS0XT)'="":PSGS0XT,$P($G(ZZND),"^",3)'="":$P(ZZND,"^",3),1:$$GETFRQ($P($G(ND(0)),U,9))) K PSJFRQ,PSJSKED
"RTN","PSIVORFB",63,0)
 S $P(^PS(55,DFN,"IV",+ON55,2),U,1,4)=P("LOG")_U_+P("IVRM")_U_U_P("SYRS"),$P(^(2),U,8,10)=P("RES")_U_$G(P("FRES"))_U_$S($G(VAIN(4)):+VAIN(4),1:"")
"RTN","PSIVORFB",64,0)
 S X=^PS(55,DFN,0) I $P(X,"^",7)="" S $P(X,"^",7)=$P($P(P("LOG"),"^"),"."),$P(X,"^",8)="A",^(0)=X D LOGDFN^PSUHL(DFN)
"RTN","PSIVORFB",65,0)
 S $P(^PS(55,DFN,"IV",+ON55,2),U,11)=+P("CLRK")
"RTN","PSIVORFB",66,0)
 S:+$G(P("CLIN")) $P(^PS(55,DFN,"IV",+ON55,"DSS"),"^")=P("CLIN")
"RTN","PSIVORFB",67,0)
 S:+$G(P("APPT")) $P(^PS(55,DFN,"IV",+ON55,"DSS"),"^",2)=P("APPT")
"RTN","PSIVORFB",68,0)
 S:+$G(P("NINIT")) ^PS(55,DFN,"IV",+ON55,4)=P("NINIT")_U_P("NINITDT")
"RTN","PSIVORFB",69,0)
 I '$G(PSIVCHG)!($G(PSJREN)&($G(PSIVCHG)=2)) I $G(P("PON")),P("PON")'=ON55 D
"RTN","PSIVORFB",70,0)
 . N X S X=$S(P("PON")["P":"^PS(53.1,+P(""PON""),12,0)",P("PON")["V"&$G(PSJREN):"^PS(55,DFN,""IV"",+P(""PON""),5,0)",1:"") Q:X=""
"RTN","PSIVORFB",71,0)
 . I $O(@X) S %X=X,%Y="^PS(55,"_DFN_",""IV"","_+ON55_",5," D %XY^%RCR
"RTN","PSIVORFB",72,0)
 F DRGT="AD","SOL" D PUTD55
"RTN","PSIVORFB",73,0)
 K DA,DIK S DA(1)=DFN,DA=+ON55,DIK="^PS(55,"_DA(1)_",""IV"",",PSIVACT=1 D IX^DIK
"RTN","PSIVORFB",74,0)
 I $G(PSJCOM),$G(PSJCOMSI),$G(PSJORD)["V" K PSJCOMSI N PSJCHILD,PSJOEORD S PSJOEORD=0 F  S PSJOEORD=$O(^PS(55,"ACX",PSJCOM,PSJOEORD)) Q:'PSJOEORD  D
"RTN","PSIVORFB",75,0)
 . N PSJCHILD S PSJCHILD=0 F  S PSJCHILD=$O(^PS(55,"ACX",PSJCOM,PSJOEORD,PSJCHILD)) Q:'PSJCHILD  S PSJCHILD(+PSJCHILD)=PSJCOM
"RTN","PSIVORFB",76,0)
 . S PSJCHILD=0 F  S PSJCHILD=$O(PSJCHILD(PSJCHILD)) Q:'PSJCHILD  D
"RTN","PSIVORFB",77,0)
 .. Q:PSJCHILD=PSJORD  K DR,DA,DIE,ORD S DR="31////"_$P($G(P("OPI")),"^",1,2),DA(1)=DFN
"RTN","PSIVORFB",78,0)
 .. N ON,ON55 S (ON,ON55)=+PSJCHILD_"V" S:+$G(PSJPINIT)'>0 PSJPINIT=DUZ S PSIVALT=1,PSIVAL="COMPLEX ORDER" D ENTACT^PSIVAL D
"RTN","PSIVORFB",79,0)
 ... I $P($G(^PS(55,DFN,"IV",+ON55,3)),"^")'=$P(P("OPI"),"^") S P("FC")="OTHER PRINT INFO^"_$P($G(^(3)),"^")_U_$P(P("OPI"),"^") D GTFC^PSIVORAL
"RTN","PSIVORFB",80,0)
 ... I $D(^PS(55,DFN,"IV",+ON55,0)) S ^PS(55,DFN,"IV",+ON55,3)=P("OPI") D EN1^PSJHL2(DFN,"XX",ON55)
"RTN","PSIVORFB",81,0)
 Q
"RTN","PSIVORFB",82,0)
 ;
"RTN","PSIVORFB",83,0)
PUTD55 ; Move drug data from local array into 55
"RTN","PSIVORFB",84,0)
 K ^PS(55,DFN,"IV",+ON55,DRGT) S ^PS(55,DFN,"IV",+ON55,DRGT,0)=$S(DRGT="AD":"^55.02PA",1:"^55.11IPA")
"RTN","PSIVORFB",85,0)
 F X=0:0 S X=$O(DRG(DRGT,X)) Q:'X  D
"RTN","PSIVORFB",86,0)
 .S Y=^PS(55,DFN,"IV",+ON55,DRGT,0),$P(Y,U,3)=$P(Y,U,3)+1,DRG=$P(Y,U,3),$P(Y,U,4)=$P(Y,U,4)+1
"RTN","PSIVORFB",87,0)
 .S ^PS(55,DFN,"IV",+ON55,DRGT,0)=Y,Y=$P(DRG(DRGT,X),U)_U_$P(DRG(DRGT,X),U,3) S:DRGT="AD" $P(Y,U,3)=$P(DRG(DRGT,X),U,4) S ^PS(55,DFN,"IV",+ON55,DRGT,+DRG,0)=Y
"RTN","PSIVORFB",88,0)
 Q
"RTN","PSIVORFB",89,0)
GT55 ; Retrieve data from 55 into local array
"RTN","PSIVORFB",90,0)
 K DRG,DRGN,P S:'$D(ON55) ON55=ON S P("REN")="",Y=$G(^PS(55,DFN,"IV",+ON55,0)) F X=1:1:23 S P(X)=$P(Y,U,X)
"RTN","PSIVORFB",91,0)
 S P("21FLG")=P(21)
"RTN","PSIVORFB",92,0)
 S P("PON")=ON55,PSJORIFN=P(21),P(6)=P(6)_U_$P($G(^VA(200,+P(6),0)),U),(DRG,DRGN)="",P("REM")=$G(^PS(55,DFN,"IV",+ON55,1))
"RTN","PSIVORFB",93,0)
 S Y=$G(^PS(55,DFN,"IV",+ON55,2)),P("LOG")=$P(Y,U),P("IVRM")=$P(Y,U,2)_U_$P($G(^PS(59.5,+$P(Y,U,2),0)),U)
"RTN","PSIVORFB",94,0)
 S P("CLRK")=$P(Y,U,11)_U_$P($G(^VA(200,+$P(Y,U,11),0)),U),P("RES")=$P(Y,U,8),P("FRES")=$P(Y,U,9),P("SYRS")=$P(Y,U,4),P("OPI")=$G(^PS(55,DFN,"IV",+ON55,3))
"RTN","PSIVORFB",95,0)
 S P("INS")=$G(^PS(55,DFN,"IV",+ON55,.3))
"RTN","PSIVORFB",96,0)
 S P("CLIN")=$P($G(^PS(55,DFN,"IV",+ON55,"DSS")),"^"),P("APPT")=$P($G(^PS(55,DFN,"IV",+ON55,"DSS")),"^",2)
"RTN","PSIVORFB",97,0)
 S P("DTYP")=$S(P(4)="":0,P(4)="P"!(P(23)="P")!(P(5)):1,P(4)="H":2,1:3)
"RTN","PSIVORFB",98,0)
 D:'$D(PSJLABEL) GTPC(ON55) S ND=$G(^PS(55,DFN,"IV",+ON55,.2)),P("PD")=$S($P(ND,U):$P(ND,U)_U_$$OIDF^PSJLMUT1(+ND)_U_$P($G(^PS(50.7,+ND,0)),U),1:""),P("DO")=$P(ND,U,2),P("PRY")=$P(ND,U,4),P("NAT")=$P(ND,U,5),(PSJCOM,P("PRNTON"))=$P(ND,U,8)
"RTN","PSIVORFB",99,0)
 I P("PRY")="D",'+P("IVRM") S P("IVRM")=+$G(PSIVSN)_U_$P($G(^PS(59.5,+$G(PSIVSN),0)),U)
"RTN","PSIVORFB",100,0)
 S P("MR")=$P(ND,U,3),ND=$G(^PS(51.2,+P("MR"),0)),P("MR")=P("MR")_U_$S($P(ND,U,3)]"":$P(ND,U,3),1:$P(ND,U)) D GTCUM
"RTN","PSIVORFB",101,0)
 D GTDRG,GTOT^PSIVUTL(P(4))
"RTN","PSIVORFB",102,0)
 N ND2P5 S ND2P5=$G(^PS(55,DFN,"IV",+ON55,2.5)) D
"RTN","PSIVORFB",103,0)
 .S P("DUR")=$P(ND2P5,"^",2)
"RTN","PSIVORFB",104,0)
 .S P("LIMIT")=$P(ND2P5,"^",4)
"RTN","PSIVORFB",105,0)
 .S P("IVCAT")=$P(ND2P5,"^",5)
"RTN","PSIVORFB",106,0)
K ; Kill and exit.
"RTN","PSIVORFB",107,0)
 K FIL,ND
"RTN","PSIVORFB",108,0)
 Q
"RTN","PSIVORFB",109,0)
GTDRG ; Get drug info and place in DRG(.
"RTN","PSIVORFB",110,0)
 F DRGT="AD","SOL" S FIL=$S(DRGT="AD":52.6,1:52.7) F Y=0:0 S Y=$O(^PS(55,DFN,"IV",+ON55,DRGT,Y)) Q:'Y  D
"RTN","PSIVORFB",111,0)
 .; naked ref below refers to line above
"RTN","PSIVORFB",112,0)
 .S DRG=$G(^(Y,0)),ND=$G(^PS(FIL,+DRG,0)),(DRGI,DRG(DRGT,0))=$G(DRG(DRGT,0))+1
"RTN","PSIVORFB",113,0)
 .S DRG(DRGT,+DRGI)=+DRG_U_$P(ND,U)_U_$P(DRG,U,2)_U_$P(DRG,U,3)_U_$P(ND,U,13)_U_$P(ND,U,11)
"RTN","PSIVORFB",114,0)
 Q
"RTN","PSIVORFB",115,0)
 ;
"RTN","PSIVORFB",116,0)
GTCUM ; Retrieve dispensing info.
"RTN","PSIVORFB",117,0)
 S ND=$G(^PS(55,DFN,"IV",+ON55,9)),P("LF")=$P(ND,U),P("LFA")=$P(ND,U,2),P("CUM")=$P(ND,U,3)
"RTN","PSIVORFB",118,0)
 Q
"RTN","PSIVORFB",119,0)
 ;
"RTN","PSIVORFB",120,0)
GTPC(ON) ; Retrieve Provider Comments and create "scratch" fields to edit
"RTN","PSIVORFB",121,0)
 Q
"RTN","PSIVORFB",122,0)
 ;
"RTN","PSIVORFB",123,0)
SETNEW ; Create new order and set
"RTN","PSIVORFB",124,0)
 D NEW55,SET55
"RTN","PSIVORFB",125,0)
 Q
"RTN","PSIVORFB",126,0)
 ;
"RTN","PSIVORFB",127,0)
CMPLIM(PSJORD,PSJDSTP1,PSJDSTP2) ; Compare stop date of order against IV Limit
"RTN","PSIVORFB",128,0)
 I $P($G(^PS(53.1,+PSJORD,0)),"^",25)]"" D CHKD Q:PSJPAO 0
"RTN","PSIVORFB",129,0)
 I $G(PSJDSTP1),$E(+PSJDSTP1,1,11)'=$E(+P(3),1,11),+PSJDSTP2'=+P(3) Q 1
"RTN","PSIVORFB",130,0)
 Q 0
"RTN","PSIVORFB",131,0)
 ;
"RTN","PSIVORFB",132,0)
LIMSTOP(PSJDSTP1,PSJDSTP2) ; Calculate default stop date using IV Limit
"RTN","PSIVORFB",133,0)
 ;      Output: PSJDSTP1 - Default stop using duration only
"RTN","PSIVORFB",134,0)
 ;              PSJDSTP2 - Default stop using duration and IV parameters for time
"RTN","PSIVORFB",135,0)
 S PSIVLIM=$$GETLIM^PSIVCAL(DFN,PSJORD)
"RTN","PSIVORFB",136,0)
 I 'PSIVLIM,PSIVLIM]"" S PSIVLIM=$$GETMIN^PSIVCAL(PSIVLIM,DFN,PSJORD)
"RTN","PSIVORFB",137,0)
 I PSIVLIM]"" D
"RTN","PSIVORFB",138,0)
 . S MINS=$$GETMIN^PSIVCAL(PSIVLIM,DFN,PSJORD),PSJDSTP1=$$FMADD^XLFDT(P(2),,,MINS)
"RTN","PSIVORFB",139,0)
 . S X=$P(PSJDSTP1,"."),PSJDSTP2=X_$S($P(PSIVSITE,"^",14)="":.2359,1:"."_$P(PSIVSITE,"^",14))
"RTN","PSIVORFB",140,0)
 Q
"RTN","PSIVORFB",141,0)
 ;
"RTN","PSIVORFB",142,0)
GETFRQ(PSJSKED) ;Get frequency using name of schedule
"RTN","PSIVORFB",143,0)
 I PSJSKED="" K PSJSKED Q ""
"RTN","PSIVORFB",144,0)
 S (PSJCNTX,PSJFRQ)=""
"RTN","PSIVORFB",145,0)
 I $D(^PS(51.1,"APPSJ",PSJSKED)) F  S PSJCNTX=$O(^PS(51.1,"APPSJ",PSJSKED,PSJCNTX)) Q:PSJCNTX=""  D  Q:$G(PSJFRQ)'=""
"RTN","PSIVORFB",146,0)
 . I $P($G(^PS(51.1,PSJCNTX,0)),U,3)'="" S PSJFRQ=$P(^PS(51.1,PSJCNTX,0),U,3)
"RTN","PSIVORFB",147,0)
 K PSJCNTX
"RTN","PSIVORFB",148,0)
 Q PSJFRQ
"RTN","PSIVORFB",149,0)
 ;
"RTN","PSIVORFB",150,0)
CHKD ;Check for a previous active order and compare the duration
"RTN","PSIVORFB",151,0)
 N PSJPO,A,PSJDUR
"RTN","PSIVORFB",152,0)
 S PSJDUR=$$GETLIM^PSIVCAL(DFN,PSJORD)
"RTN","PSIVORFB",153,0)
 S PSJPAO=0,PSJPO=PSJORD
"RTN","PSIVORFB",154,0)
CHKDR S PSJPO=$P($G(^PS(53.1,+PSJPO,0)),"^",25) Q:PSJPO=""
"RTN","PSIVORFB",155,0)
 I PSJPO["P" G CHKDR
"RTN","PSIVORFB",156,0)
 I PSJPO["V" S PSIVLIM=$$GETLIM^PSIVCAL(DFN,PSJPO) I PSJDUR'=PSIVLIM S PSJPAO=1 Q
"RTN","PSIVORFB",157,0)
 G CHKDR
"VER")
8.0^22.0
**INSTALL NAME**
PSO*7.0*170
"BLD",6054,0)
PSO*7.0*170^OUTPATIENT PHARMACY^0^3081114^y
"BLD",6054,1,0)
^^16^16^3080311^
"BLD",6054,1,1,0)
The following issues are addressed in this patch:
"BLD",6054,1,2,0)
1. This patch addresses a request which support the Pharmacy Benefits
"BLD",6054,1,3,0)
Management (PBM) Extracts Enhancement #3 project. In order to allow the
"BLD",6054,1,4,0)
retransmission of only those patients who have had demographic updates,
"BLD",6054,1,5,0)
Outpatient Pharmacy V. 7.0, Inpatient Medications V. 5.0, Registration
"BLD",6054,1,6,0)
V. 5.3 and Pharmacy Data Management V. 1.0 were modified to build an entry
"BLD",6054,1,7,0)
for re-transmission in PBM PATIENT DEMOGRAPHICS File #59.9.
"BLD",6054,1,8,0)
 
"BLD",6054,1,9,0)
When the FIRST SERVICE DATE field (#.07) in the PHARMACY PATIENT file #55
"BLD",6054,1,10,0)
is updated for a patient, an entry is queued for retransmission.
"BLD",6054,1,11,0)
 
"BLD",6054,1,12,0)
 
"BLD",6054,1,13,0)
2. During internal testing, it was discovered that the FIRST SERVICE DATE
"BLD",6054,1,14,0)
field (#.07) and the ACTUAL/HISTORICAL FLAG field (#.08) were not being
"BLD",6054,1,15,0)
set appropriately when the user exited out of label print. This patch
"BLD",6054,1,16,0)
corrects this problem.
"BLD",6054,4,0)
^9.64PA^^
"BLD",6054,6)
6^
"BLD",6054,6.3)
23
"BLD",6054,"ABPKG")
n
"BLD",6054,"KRN",0)
^9.67PA^8989.52^19
"BLD",6054,"KRN",.4,0)
.4
"BLD",6054,"KRN",.401,0)
.401
"BLD",6054,"KRN",.402,0)
.402
"BLD",6054,"KRN",.403,0)
.403
"BLD",6054,"KRN",.5,0)
.5
"BLD",6054,"KRN",.84,0)
.84
"BLD",6054,"KRN",3.6,0)
3.6
"BLD",6054,"KRN",3.8,0)
3.8
"BLD",6054,"KRN",9.2,0)
9.2
"BLD",6054,"KRN",9.8,0)
9.8
"BLD",6054,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",6054,"KRN",9.8,"NM",1,0)
PSORX1^^0^B58219914
"BLD",6054,"KRN",9.8,"NM","B","PSORX1",1)

"BLD",6054,"KRN",19,0)
19
"BLD",6054,"KRN",19.1,0)
19.1
"BLD",6054,"KRN",101,0)
101
"BLD",6054,"KRN",409.61,0)
409.61
"BLD",6054,"KRN",771,0)
771
"BLD",6054,"KRN",870,0)
870
"BLD",6054,"KRN",8989.51,0)
8989.51
"BLD",6054,"KRN",8989.52,0)
8989.52
"BLD",6054,"KRN",8994,0)
8994
"BLD",6054,"KRN","B",.4,.4)

"BLD",6054,"KRN","B",.401,.401)

"BLD",6054,"KRN","B",.402,.402)

"BLD",6054,"KRN","B",.403,.403)

"BLD",6054,"KRN","B",.5,.5)

"BLD",6054,"KRN","B",.84,.84)

"BLD",6054,"KRN","B",3.6,3.6)

"BLD",6054,"KRN","B",3.8,3.8)

"BLD",6054,"KRN","B",9.2,9.2)

"BLD",6054,"KRN","B",9.8,9.8)

"BLD",6054,"KRN","B",19,19)

"BLD",6054,"KRN","B",19.1,19.1)

"BLD",6054,"KRN","B",101,101)

"BLD",6054,"KRN","B",409.61,409.61)

"BLD",6054,"KRN","B",771,771)

"BLD",6054,"KRN","B",870,870)

"BLD",6054,"KRN","B",8989.51,8989.51)

"BLD",6054,"KRN","B",8989.52,8989.52)

"BLD",6054,"KRN","B",8994,8994)

"BLD",6054,"QDEF")
^^^^NO^^^^NO
"BLD",6054,"QUES",0)
^9.62^^
"BLD",6054,"REQB",0)
^9.611^3^2
"BLD",6054,"REQB",2,0)
PSU*4.0*5^2
"BLD",6054,"REQB",3,0)
PSO*7.0*300^2
"BLD",6054,"REQB","B","PSO*7.0*300",3)

"BLD",6054,"REQB","B","PSU*4.0*5",2)

"MBREQ")
0
"PKG",141,-1)
1^1
"PKG",141,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",141,20,0)
^9.402P^^
"PKG",141,22,0)
^9.49I^1^1
"PKG",141,22,1,0)
7.0^2971216^2980917^11712
"PKG",141,22,1,"PAH",1,0)
170^3081114^11882
"PKG",141,22,1,"PAH",1,1,0)
^^16^16^3081114
"PKG",141,22,1,"PAH",1,1,1,0)
The following issues are addressed in this patch:
"PKG",141,22,1,"PAH",1,1,2,0)
1. This patch addresses a request which support the Pharmacy Benefits
"PKG",141,22,1,"PAH",1,1,3,0)
Management (PBM) Extracts Enhancement #3 project. In order to allow the
"PKG",141,22,1,"PAH",1,1,4,0)
retransmission of only those patients who have had demographic updates,
"PKG",141,22,1,"PAH",1,1,5,0)
Outpatient Pharmacy V. 7.0, Inpatient Medications V. 5.0, Registration
"PKG",141,22,1,"PAH",1,1,6,0)
V. 5.3 and Pharmacy Data Management V. 1.0 were modified to build an entry
"PKG",141,22,1,"PAH",1,1,7,0)
for re-transmission in PBM PATIENT DEMOGRAPHICS File #59.9.
"PKG",141,22,1,"PAH",1,1,8,0)
 
"PKG",141,22,1,"PAH",1,1,9,0)
When the FIRST SERVICE DATE field (#.07) in the PHARMACY PATIENT file #55
"PKG",141,22,1,"PAH",1,1,10,0)
is updated for a patient, an entry is queued for retransmission.
"PKG",141,22,1,"PAH",1,1,11,0)
 
"PKG",141,22,1,"PAH",1,1,12,0)
 
"PKG",141,22,1,"PAH",1,1,13,0)
2. During internal testing, it was discovered that the FIRST SERVICE DATE
"PKG",141,22,1,"PAH",1,1,14,0)
field (#.07) and the ACTUAL/HISTORICAL FLAG field (#.08) were not being
"PKG",141,22,1,"PAH",1,1,15,0)
set appropriately when the user exited out of label print. This patch
"PKG",141,22,1,"PAH",1,1,16,0)
corrects this problem.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","PSORX1")
0^1^B58219914
"RTN","PSORX1",1,0)
PSORX1 ;BIR/SAB-medication processing driver ;8/20/08 7:39am
"RTN","PSORX1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**7,22,23,57,62,46,74,71,90,95,115,117,146,139,135,182,195,233,268,300,170**;DEC 1997;Build 23
"RTN","PSORX1",3,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSORX1",4,0)
 ;External reference ^DIC(31 supported by DBIA 658
"RTN","PSORX1",5,0)
 ;External reference ^DPT(D0,.372 supported by DBIA 1476
"RTN","PSORX1",6,0)
 ;External reference DISPPRF^DGPFAPI supported by DBIA #4563
"RTN","PSORX1",7,0)
 ;External reference ^ORRDI1 is supported by DBIA 4659
"RTN","PSORX1",8,0)
 ;External reference ^XTMP("ORRDI" is supported by DBIA 4660
"RTN","PSORX1",9,0)
 ;External reference ^PSUHL supported by DBIA 4803
"RTN","PSORX1",10,0)
 ;
"RTN","PSORX1",11,0)
 ;PSO*195 add call to display Patient Record Flag (DISPPRF^DGPFAPI)
"RTN","PSORX1",12,0)
 ;
"RTN","PSORX1",13,0)
START K PSOQFLG,PSOID,PSOFIN,PSOQUIT,PSODRUG S (PSOBCK,PSOERR)=1 D INIT G:PSORX("QFLG") END
"RTN","PSORX1",14,0)
 D PT G:$G(PSORX("QFLG")) END D FULL^VALM1 I $G(NOPROC) K NOPROC G NX
"RTN","PSORX1",15,0)
 ;call to add bingo board data to file 52.11
"RTN","PSORX1",16,0)
 F SLPPL=0:0 S SLPPL=$O(RXRS(SLPPL)) Q:'SLPPL  D
"RTN","PSORX1",17,0)
 .I $P($G(^PSRX(SLPPL,"STA")),"^")'=5 K RXRS(SLPPL) Q
"RTN","PSORX1",18,0)
 .S RXREC=SLPPL D WIND^PSOSUPOE I $G(PBINGRTE) D BBADD^PSOSUPOE S (BINGCRT,BINGRTE)=1 S:$G(PSOFROM)'="NEW" PSOFROM="REFILL"
"RTN","PSORX1",19,0)
 K TM,TM1 I $G(PSORX("PSOL",1))]""!($D(RXRS)) D ^PSORXL K PSORX
"RTN","PSORX1",20,0)
 G:$G(NOBG) NX
"RTN","PSORX1",21,0)
 S TM=$P(^TMP("PSOBB",$J),"^"),TM1=$P(^TMP("PSOBB",$J),"^",2) K ^TMP("PSOBB",$J)
"RTN","PSORX1",22,0)
 I $G(PSOFROM)="NEW"!($G(PSOFROM)="REFILL")!($G(PSOFROM)="PARTIAL") D:$D(BINGCRT)&($D(BINGRTE)&($D(DISGROUP))) ^PSOBING1 K BINGCRT,BINGRTE,BBRX,BBFLG
"RTN","PSORX1",23,0)
NX I $G(POERR("DEAD"))!$G(PSOQFLG) D EOJ G START
"RTN","PSORX1",24,0)
 D EOJ G START
"RTN","PSORX1",25,0)
END Q
"RTN","PSORX1",26,0)
 ;---------------------------------------------------------
"RTN","PSORX1",27,0)
INIT ;
"RTN","PSORX1",28,0)
 S PSORX("QFLG")=0
"RTN","PSORX1",29,0)
 D:'$D(PSOPAR) ^PSOLSET I '$D(PSOPAR) S PSORX("QFLG")=1
"RTN","PSORX1",30,0)
 I $P($G(PSOPAR),"^",2),'$D(^XUSEC("PSORPH",DUZ)) S PSORX("VERIFY")=1
"RTN","PSORX1",31,0)
INITX Q
"RTN","PSORX1",32,0)
 ;
"RTN","PSORX1",33,0)
PT ;
"RTN","PSORX1",34,0)
 K ^TMP("PSORXDC",$J),CLOZPAT,DIC,PSODFN S PSORX("QFLG")=0,DIC=2,DIC(0)="QEAM" D ^DIC K DIC,DA
"RTN","PSORX1",35,0)
 I +Y'>0 S PSORX("QFLG")=1 G PTX
"RTN","PSORX1",36,0)
OERR N:$G(MEDP) PAT,POERR K PSOXFLG S (DFN,PSODFN)=+Y,PSORX("NAME")=$P(Y,"^",2)
"RTN","PSORX1",37,0)
 K NPPROC,PSOQFLG,DIC,DR,DIQ S DIC=2,DA=PSODFN,DR=.351,DIQ="PSOPTPST" D EN^DIQ1 K DIC,DA,DR,DIQ D DEAD^PSOPTPST I $G(PSOQFLG) S NOPROC=1 Q
"RTN","PSORX1",38,0)
 ;PSO*195 move SSN write to here and add DISPPRF call
"RTN","PSORX1",39,0)
 S SSN=$P(^DPT(PSODFN,0),"^",9) W !!?10,$C(7),PSORX("NAME")
"RTN","PSORX1",40,0)
 W " ("_$E(SSN,1,3)_"-"_$E(SSN,4,5)_"-"_$E(SSN,6,9)_")" K SSN
"RTN","PSORX1",41,0)
 S PSONOAL="" D ALLERGY^PSOORUT2 D  I PSONOAL'="" D PAUSE
"RTN","PSORX1",42,0)
 .I PSONOAL'="" W !,$C(7),"     No Allergy Assessment!"
"RTN","PSORX1",43,0)
 D REMOTE
"RTN","PSORX1",44,0)
 N PSOUPDT
"RTN","PSORX1",45,0)
 S PSOUPDT=1
"RTN","PSORX1",46,0)
 I $G(XQY0)["PSO LMOE FINISH" S PSOUPDT=0
"RTN","PSORX1",47,0)
 D CHKADDR^PSOBAI(PSODFN,1,PSOUPDT)
"RTN","PSORX1",48,0)
 D:(XQY0["PSO LMOE FINISH")&('$G(SNGLPAT)) DISPPRF^DGPFAPI(PSODFN)
"RTN","PSORX1",49,0)
 ;
"RTN","PSORX1",50,0)
 I $P($G(^PS(55,PSODFN,"LAN")),"^") W !?10,"Patient has another language preference!",! H 3
"RTN","PSORX1",51,0)
 I $G(^PS(55,"ASTALK",PSODFN)) W !,"Patient is enrolled to receive ScripTalk 'talking' prescription labels.",! H 2 D MAIL
"RTN","PSORX1",52,0)
 D NOW^%DTC S TM=$E(%,1,12),TM1=$P(TM,".",2) S ^TMP("PSOBB",$J)=TM_"^"_TM1
"RTN","PSORX1",53,0)
 S PSOQFLG=0,DIC="^PS(55,",DLAYGO=55
"RTN","PSORX1",54,0)
 I '$D(^PS(55,PSODFN,0)) D
"RTN","PSORX1",55,0)
 .K DD,DO S DIC(0)="L",(DINUM,X)=PSODFN D FILE^DICN D:Y<1  K DIC,DA,DR,DD,DO
"RTN","PSORX1",56,0)
 ..S $P(^PS(55,PSODFN,0),"^")=PSODFN K DIK S DA=PSODFN,DIK="^PS(55,",DIK(1)=.01 D EN^DIK K DIK
"RTN","PSORX1",57,0)
 D RXSTA
"RTN","PSORX1",58,0)
 S PSOLOUD=1 D:$P($G(^PS(55,PSODFN,0)),"^",6)'=2 EN^PSOHLUP(PSODFN) K PSOLOUD
"RTN","PSORX1",59,0)
 I $G(^PS(55,PSODFN,"PS"))']"" D  I $G(POERR("QFLG")) G EOJ
"RTN","PSORX1",60,0)
 .L +^PS(55,PSODFN):$S(+$G(^DD("DILOCKTM"))>0:+^DD("DILOCKTM"),1:3) I '$T W $C(7),!!,"Patient Data is Being Edited by Another User!",! S POERR("QFLG")=1 S:$G(PSOFIN) PSOQUIT=1 Q
"RTN","PSORX1",61,0)
 .S PSOXFLG=1,SSN=$P(^DPT(PSODFN,0),"^",9) W !!?10,$C(7),PSORX("NAME")_" ("_$E(SSN,1,3)_"-"_$E(SSN,4,5)_"-"_$E(SSN,6,9)_")",! K SSN
"RTN","PSORX1",62,0)
 .S DIE=55,DR=".02;.03;.04;.05;1;D ELIG^PSORX1;3;50;106;106.1",DA=PSODFN W !!,?5,">>PHARMACY PATIENT DATA<<",! D ^DIE L -^PS(55,PSODFN)
"RTN","PSORX1",63,0)
 S PSOX=$G(^PS(55,PSODFN,"PS")) I PSOX]"" S PSORX("PATIENT STATUS")=$P($G(^PS(53,PSOX,0)),"^")
"RTN","PSORX1",64,0)
 I $G(^PS(55,PSODFN,"PS"))']"" D  I $G(POERR("QFLG")) G EOJ
"RTN","PSORX1",65,0)
 .W !!,"Patient Status Required!!",! D ELIG
"RTN","PSORX1",66,0)
 .W ! K POERR("QFLG"),DIC,DR,DIE S DIC("A")="RX PATIENT STATUS: ",DIC(0)="QEAMZ",DIC=53 D ^DIC K DIC
"RTN","PSORX1",67,0)
 .I $D(DIRUT)!(Y=-1) D  Q
"RTN","PSORX1",68,0)
 ..W $C(7),"Required Data!",! S POERR("QFLG")=1 S:$G(PSOFIN) PSOQUIT=1
"RTN","PSORX1",69,0)
 ..I $O(^PS(55,PSODFN,0))="" S DA=PSODFN,DIK="^PS(55," D ^DIK
"RTN","PSORX1",70,0)
 .S ^PS(55,PSODFN,"PS")=+Y,PSORX("PATIENT STATUS")=$P(^PS(53,+Y,0),"^")
"RTN","PSORX1",71,0)
 .K DIRUT,DTOUT,DUOUT,X,Y,DA
"RTN","PSORX1",72,0)
 Q:$G(PSOFIN)
"RTN","PSORX1",73,0)
 D ^PSOBUILD
"RTN","PSORX1",74,0)
 F PT="GET","DEAD","INP","CNH","TPB","ADDRESS","COPAY" S RTN=PT_"^PSOPTPST" D @RTN Q:$G(POERR("DEAD"))!($G(PSOQFLG))
"RTN","PSORX1",75,0)
 I $G(POERR("DEAD")) S POERR("QFLG")=1 F II=0:0 S II=$O(^PS(52.41,"P",PSODFN,II)) D:$P($G(^PS(52.41,II,0)),"^",3)'="DC"&($P($G(^(0)),"^",3)'="DE") DC^PSOORFI2
"RTN","PSORX1",76,0)
 K PSOERR("DEAD"),II I $G(PSOQFLG) S POERR("QFLG")=1 G EOJ Q
"RTN","PSORX1",77,0)
 S (PAT,PSOXXDFN)=PSODFN,POERR=1 D ^PSOORUT2,BLD^PSOORUT1,EN^PSOLMUTL
"RTN","PSORX1",78,0)
 D CLEAR^VALM1 G:$G(PSOQUIT) PTX D EN^PSOLMAO
"RTN","PSORX1",79,0)
 S (DFN,PSODFN)=PSOXXDFN K DIE,DIC,DLAYGO,DR,DA,PSOX,PSORXED
"RTN","PSORX1",80,0)
 I $O(RXFL("")),$P(^PS(55,PSODFN,0),"^",7)="" D
"RTN","PSORX1",81,0)
 . N %
"RTN","PSORX1",82,0)
 . D NOW^%DTC
"RTN","PSORX1",83,0)
 . S $P(^PS(55,PSODFN,0),"^",7)=$E(%,1,12),$P(^(0),"^",8)="A" D LOGDFN^PSUHL(PSODFN)
"RTN","PSORX1",84,0)
PTX ;
"RTN","PSORX1",85,0)
 K X,Y,^TMP("PS",$J),C,DEA,PRC,PSCNT,PSOACT,PSOCLC,PSOCS,PSOCT,PSOFINFL,PSOHD,PSOLST,PSOOPT,PSOPF,PSOX,PSOX1,PSOXXDFN,SIGOK,STP,STR
"RTN","PSORX1",86,0)
 Q
"RTN","PSORX1",87,0)
EOJ ;
"RTN","PSORX1",88,0)
 K PSOERR,PSOMED,PSORX,PSOSD,PSODRUG,PSODFN,PSOOPT,PSOBILL,PSOIBQS,PSOCPAY,PSOPF,PSOPI,COMM,DGI,DGS,PT,PTDY,PTRF,RN,RTN,SERS,ST0,STAT,DFN,STOP,SLPPL,RXREC
"RTN","PSORX1",89,0)
 K:'$G(MEDP) PSOQFLG
"RTN","PSORX1",90,0)
 D KVA^VADPT,FULL^VALM1 K PSOLST,PSOXFLG,PSCNT,PSDIS,PSOAL,P1,LOG,%,%DT,%I,D0,DAT,DFN,DRG,ORX,PSON,PSOPTPST,PSORX,PTST,PSOBCK,PSOID,PSOBXPUL
"RTN","PSORX1",91,0)
 K INCOM,SIG,SG,STP,RX0,RXN,RX2,RX3,RTS,C,DEAD,PS,PSOCLC,PSOCNT,PSOCT,PSODA,PSOFROM,PSOHD,R3,REA,RF,RFD,RFM,RLD,RXNUM,RXP,RXPR,RXRP,RXRS,STR,POERR,VALMSG
"RTN","PSORX1",92,0)
 K ^TMP("PSORXDC",$J),^TMP("PSOAL",$J),^TMP("PSOAO",$J),^TMP("PSOSF",$J),^TMP("PSOPF",$J),^TMP("PSOPI",$J),^TMP("PSOPO",$J),^TMP("PSOHDR",$J) I '$G(MEDP),'$G(PSOQUIT) K PAT
"RTN","PSORX1",93,0)
 K PSORX,RFN,PSOXXDFN,VALM,VALMKEY,PSOBCK,SPOERR,PSOFLAG,VALMBCK,D,GMRA,GMRAL,GMRAREC,PSOSTA,PSODT,RXFL,NOBG,BBRX,BBFLG
"RTN","PSORX1",94,0)
 Q
"RTN","PSORX1",95,0)
ELIG ; shows eligibility and disabilities
"RTN","PSORX1",96,0)
 D ELIG^VADPT W !,"Eligibility: "_$P(VAEL(1),"^",2)_$S(+VAEL(3):"     SC%: "_$P(VAEL(3),"^",2),1:"") S N=0 F  S N=$O(VAEL(1,N)) Q:'N  W !,?10,$P(VAEL(1,N),"^",2)
"RTN","PSORX1",97,0)
 W !,"Disabilities: " F I=0:0 S I=$O(^DPT(DFN,.372,I)) Q:'I  S I1=$S($D(^DPT(DFN,.372,I,0)):^(0),1:"") D:+I1
"RTN","PSORX1",98,0)
 .S PSDIS=$S($P($G(^DIC(31,+I1,0)),"^")]""&($P($G(^(0)),"^",4)']""):$P(^(0),"^"),$P($G(^DIC(31,+I1,0)),"^",4)]"":$P(^(0),"^",4),1:""),PSCNT=$P(I1,"^",2)
"RTN","PSORX1",99,0)
 .W:$L(PSDIS_"-"_PSCNT_"% ("_$S($P(I1,"^",3):"SC",1:"NSC")_"), ")>80 !,?15
"RTN","PSORX1",100,0)
 .W $S($G(PSDIS)]"":PSDIS_"-",1:"")_PSCNT_"% ("_$S($P(I1,"^",3):"SC",1:"NSC")_"), "
"RTN","PSORX1",101,0)
 K N
"RTN","PSORX1",102,0)
 Q
"RTN","PSORX1",103,0)
PROFILE ;
"RTN","PSORX1",104,0)
 S (PSORX("REFILL"),PSORX("RENEW"))=0,PSOX="" D ^PSOBUILD
"RTN","PSORX1",105,0)
 I '$G(PSOSD) W !,"This patient has no prescriptions" S:'$D(DFN) DFN=PSODFN D GMRA^PSODEM G PROFILEX
"RTN","PSORX1",106,0)
 S (PSODRG,PSOX)="" F  S PSODRG=$O(PSOSD(PSODRG)) Q:PSODRG=""  F  S PSOX=$O(PSOSD(PSODRG,PSOX)) Q:PSOX=""  S:$P(PSOSD(PSODRG,PSOX),"^",3)="" PSORX("RENEW")=1 S:$P(PSOSD(PSODRG,PSOX),"^",4)="" PSORX("REFILL")=1
"RTN","PSORX1",107,0)
 K PSOX
"RTN","PSORX1",108,0)
PROFILEX Q
"RTN","PSORX1",109,0)
 ;
"RTN","PSORX1",110,0)
MAIL ; MAKE SURE MAIL STATUS IS COMPATIBLE WITH SCRIPTALK PATIENT
"RTN","PSORX1",111,0)
 I $P($G(^PS(59,PSOSITE,"STALK")),"^")="" Q  ; NO SCRIPTALK PRINTER SET UP FOR THIS DIVISION
"RTN","PSORX1",112,0)
 N MAIL
"RTN","PSORX1",113,0)
 S MAIL=$G(^PS(55,PSODFN,0)) I $P(MAIL,"^",3)>1 Q
"RTN","PSORX1",114,0)
MAILP W !!,"REMINDER: CMOP does not fill ScripTalk prescriptions.Please select mail"
"RTN","PSORX1",115,0)
 W !,"status:  2 (DO NOT MAIL), 3 (LOCAL REGULAR MAIL) or 4 (LOCAL CERTFIED MAIL)."
"RTN","PSORX1",116,0)
 R !,"MAIL: ",MAIL:120
"RTN","PSORX1",117,0)
 I MAIL?1"^".E Q
"RTN","PSORX1",118,0)
 I MAIL<2!(MAIL>4) W !,"INVALID MAIL SETTING - ENTER 2,3, OR 4" G MAILP
"RTN","PSORX1",119,0)
 W "  ",$S(MAIL=2:"DO NOT MAIL",MAIL=3:"LOCAL REGULAR MAIL",1:"LOCAL CERTIFIED MAIL")
"RTN","PSORX1",120,0)
 S $P(^PS(55,PSODFN,0),"^",3)=MAIL
"RTN","PSORX1",121,0)
 Q
"RTN","PSORX1",122,0)
REMOTE ; 
"RTN","PSORX1",123,0)
 I $T(HAVEHDR^ORRDI1)']"" Q
"RTN","PSORX1",124,0)
 I '$$HAVEHDR^ORRDI1 Q
"RTN","PSORX1",125,0)
 I $D(^XTMP("ORRDI","OUTAGE INFO","DOWN")) W !,"Remote data not available - Only local order checks processed." D  Q
"RTN","PSORX1",126,0)
 .K DIR W ! S DIR(0)="EA",DIR("A")="Press Return to continue..." D ^DIR W ! K DIR
"RTN","PSORX1",127,0)
 Q
"RTN","PSORX1",128,0)
PAUSE ;
"RTN","PSORX1",129,0)
 W ! K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSORX1",130,0)
 Q
"RTN","PSORX1",131,0)
 ;
"RTN","PSORX1",132,0)
RXSTA ; DISPLAY ELIGIBILITY & PROMPT FOR RX PATIENT STATUS
"RTN","PSORX1",133,0)
 N DA,PSOSTA
"RTN","PSORX1",134,0)
 I '$G(PSODFN) Q
"RTN","PSORX1",135,0)
 S DA=PSODFN,PSOSTA=$G(^PS(55,PSODFN,"PS"))
"RTN","PSORX1",136,0)
 I XQY0["PSO LMOE FINISH"!(XQY0["PSO LM BACKDOOR ORDERS") I PSOSTA]"" D
"RTN","PSORX1",137,0)
 .D ELIG^VADPT W !,"Eligibility: "_$P(VAEL(1),"^",2)_$S(+VAEL(3):"     SC%: "_$P(VAEL(3),"^",2),1:"")
"RTN","PSORX1",138,0)
 .S N=0 F  S N=$O(VAEL(1,N)) Q:'N  W !,?10,$P(VAEL(1,N),"^",2)
"RTN","PSORX1",139,0)
 .S DIC("A")="RX PATIENT STATUS: ",DIC("B")=PSOSTA,DIC(0)="QEAMZ",DIC=53 D ^DIC K DIC
"RTN","PSORX1",140,0)
 .I +Y>0,+Y'=PSOSTA S DIE="^PS(55,",DR="3////"_+Y D ^DIE
"RTN","PSORX1",141,0)
 Q
"VER")
8.0^22.0
**INSTALL NAME**
DG*5.3*671
"BLD",6306,0)
DG*5.3*671^REGISTRATION^0^3081114^y
"BLD",6306,1,0)
^^16^16^3080311^
"BLD",6306,1,1,0)
This patch addresses a request which supports the Pharmacy Benefits
"BLD",6306,1,2,0)
Management (PBM)Extracts Enhancement #3 project. In order to allow the
"BLD",6306,1,3,0)
retransmission of only those patients who have had demographic updates,
"BLD",6306,1,4,0)
Outpatient Pharmacy V. 7.0, Inpatient Medications V. 5.0, Registration
"BLD",6306,1,5,0)
V. 5.3 and Pharmacy Data Management V. 1.0 were modified to build an
"BLD",6306,1,6,0)
entry for re-transmission in PBM PATIENT DEMOGRAPHICS File #59.9.
"BLD",6306,1,7,0)
 
"BLD",6306,1,8,0)
This patch will introduce six (6) new fields to the DG Field Monitor Event
"BLD",6306,1,9,0)
driver. This will enhance the PBM extract process anytime these fields
"BLD",6306,1,10,0)
are accessed and updated. The six fields are:
"BLD",6306,1,11,0)
   SEX  (#.02)
"BLD",6306,1,12,0)
   PRIMARY ELIGIBILITY CODE (#.361)
"BLD",6306,1,13,0)
   CURRENT MEANS TEST STATUS (#.14)
"BLD",6306,1,14,0)
   CURRENT ENROLLMENT (#27.01)
"BLD",6306,1,15,0)
   PROVIDER (#.104)
"BLD",6306,1,16,0)
   DATE ENTERED INTO FILE (#.097)
"BLD",6306,4,0)
^9.64PA^2^1
"BLD",6306,4,2,0)
2
"BLD",6306,4,2,2,0)
^9.641^2^1
"BLD",6306,4,2,2,2,0)
PATIENT  (File-top level)
"BLD",6306,4,2,2,2,1,0)
^9.6411^.097^6
"BLD",6306,4,2,2,2,1,.02,0)
SEX
"BLD",6306,4,2,2,2,1,.097,0)
DATE ENTERED INTO FILE
"BLD",6306,4,2,2,2,1,.104,0)
PROVIDER
"BLD",6306,4,2,2,2,1,.14,0)
CURRENT MEANS TEST STATUS
"BLD",6306,4,2,2,2,1,.361,0)
PRIMARY ELIGIBILITY CODE
"BLD",6306,4,2,2,2,1,27.01,0)
CURRENT ENROLLMENT
"BLD",6306,4,2,222)
y^y^p^^^^n^^n
"BLD",6306,4,2,224)

"BLD",6306,4,"APDD",2,2)

"BLD",6306,4,"APDD",2,2,.02)

"BLD",6306,4,"APDD",2,2,.097)

"BLD",6306,4,"APDD",2,2,.104)

"BLD",6306,4,"APDD",2,2,.14)

"BLD",6306,4,"APDD",2,2,.361)

"BLD",6306,4,"APDD",2,2,27.01)

"BLD",6306,4,"B",2,2)

"BLD",6306,6.3)
27
"BLD",6306,"INID")
^y
"BLD",6306,"INIT")
DG53671P
"BLD",6306,"KRN",0)
^9.67PA^8989.52^19
"BLD",6306,"KRN",.4,0)
.4
"BLD",6306,"KRN",.401,0)
.401
"BLD",6306,"KRN",.402,0)
.402
"BLD",6306,"KRN",.403,0)
.403
"BLD",6306,"KRN",.5,0)
.5
"BLD",6306,"KRN",.84,0)
.84
"BLD",6306,"KRN",3.6,0)
3.6
"BLD",6306,"KRN",3.8,0)
3.8
"BLD",6306,"KRN",9.2,0)
9.2
"BLD",6306,"KRN",9.2,"NM",0)
^9.68A^^
"BLD",6306,"KRN",9.8,0)
9.8
"BLD",6306,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",6306,"KRN",9.8,"NM",1,0)
DGMTDD^^0^B17672823
"BLD",6306,"KRN",9.8,"NM",2,0)
DGENA1^^0^B7946917
"BLD",6306,"KRN",9.8,"NM",3,0)
DGPMDDCN^^0^B21852300
"BLD",6306,"KRN",9.8,"NM",4,0)
DGPATN^^0^B5286431
"BLD",6306,"KRN",9.8,"NM","B","DGENA1",2)

"BLD",6306,"KRN",9.8,"NM","B","DGMTDD",1)

"BLD",6306,"KRN",9.8,"NM","B","DGPATN",4)

"BLD",6306,"KRN",9.8,"NM","B","DGPMDDCN",3)

"BLD",6306,"KRN",19,0)
19
"BLD",6306,"KRN",19.1,0)
19.1
"BLD",6306,"KRN",101,0)
101
"BLD",6306,"KRN",409.61,0)
409.61
"BLD",6306,"KRN",771,0)
771
"BLD",6306,"KRN",870,0)
870
"BLD",6306,"KRN",8989.51,0)
8989.51
"BLD",6306,"KRN",8989.52,0)
8989.52
"BLD",6306,"KRN",8994,0)
8994
"BLD",6306,"KRN","B",.4,.4)

"BLD",6306,"KRN","B",.401,.401)

"BLD",6306,"KRN","B",.402,.402)

"BLD",6306,"KRN","B",.403,.403)

"BLD",6306,"KRN","B",.5,.5)

"BLD",6306,"KRN","B",.84,.84)

"BLD",6306,"KRN","B",3.6,3.6)

"BLD",6306,"KRN","B",3.8,3.8)

"BLD",6306,"KRN","B",9.2,9.2)

"BLD",6306,"KRN","B",9.8,9.8)

"BLD",6306,"KRN","B",19,19)

"BLD",6306,"KRN","B",19.1,19.1)

"BLD",6306,"KRN","B",101,101)

"BLD",6306,"KRN","B",409.61,409.61)

"BLD",6306,"KRN","B",771,771)

"BLD",6306,"KRN","B",870,870)

"BLD",6306,"KRN","B",8989.51,8989.51)

"BLD",6306,"KRN","B",8989.52,8989.52)

"BLD",6306,"KRN","B",8994,8994)

"BLD",6306,"QUES",0)
^9.62^^
"BLD",6306,"REQB",0)
^9.611^5^5
"BLD",6306,"REQB",1,0)
DG*5.3*232^2
"BLD",6306,"REQB",2,0)
DG*5.3*618^2
"BLD",6306,"REQB",3,0)
DG*5.3*278^2
"BLD",6306,"REQB",4,0)
DG*5.3*498^2
"BLD",6306,"REQB",5,0)
PSU*4.0*5^2
"BLD",6306,"REQB","B","DG*5.3*232",1)

"BLD",6306,"REQB","B","DG*5.3*278",3)

"BLD",6306,"REQB","B","DG*5.3*498",4)

"BLD",6306,"REQB","B","DG*5.3*618",2)

"BLD",6306,"REQB","B","PSU*4.0*5",5)

"FIA",2)
PATIENT
"FIA",2,0)
^DPT(
"FIA",2,0,0)
2I
"FIA",2,0,1)
y^y^p^^^^n^^n
"FIA",2,0,10)

"FIA",2,0,11)

"FIA",2,0,"RLRO")

"FIA",2,0,"VR")
5.3^DG
"FIA",2,2)
1
"FIA",2,2,.02)

"FIA",2,2,.097)

"FIA",2,2,.104)

"FIA",2,2,.14)

"FIA",2,2,.361)

"FIA",2,2,27.01)

"INIT")
DG53671P
"IX",2,2,"ADGFM27D01",0)
2^ADGFM27D01^This x-ref calls the DG FIELD MONITOR event point.^MU^^F^I^I^2^^^^^A
"IX",2,2,"ADGFM27D01",.1,0)
^^2^2^3060624^
"IX",2,2,"ADGFM27D01",.1,1,0)
This cross reference activates the DG FIELD MONITOR event point if the 
"IX",2,2,"ADGFM27D01",.1,2,0)
CURRENT ENROLLMENT (#27.01) field changes.
"IX",2,2,"ADGFM27D01",1)
D FC^DGFCPROT(.DA,2,27.01,"SET",$H,$G(DUZ),.X,.X1,.X2,$G(XQY0)) Q
"IX",2,2,"ADGFM27D01",2)
D FC^DGFCPROT(.DA,2,27.01,"KILL",$H,$G(DUZ),.X,.X1,.X2,$G(XQY0)) Q
"IX",2,2,"ADGFM27D01",11.1,0)
^.114IA^1^1
"IX",2,2,"ADGFM27D01",11.1,1,0)
1^F^2^27.01^^^F
"IX",2,2,"ADGFM27D01",11.1,1,3)

"IX",2,2,"ADGFMD02",0)
2^ADGFMD02^This x-ref calls the DG FIELD MONITOR event point.^MU^^F^I^I^2^^^^^A
"IX",2,2,"ADGFMD02",.1,0)
^^2^2^3060624^
"IX",2,2,"ADGFMD02",.1,1,0)
This cross reference activates the DG FIELD MONITOR event point if the
"IX",2,2,"ADGFMD02",.1,2,0)
data in the SEX (.02) field changes.
"IX",2,2,"ADGFMD02",1)
D FC^DGFCPROT(.DA,2,.02,"SET",$H,$G(DUZ),.X,.X1,.X2,$G(XQY0)) Q
"IX",2,2,"ADGFMD02",2)
D FC^DGFCPROT(.DA,2,.02,"KILL",$H,$G(DUZ),.X,.X1,.X2,$G(XQY0)) Q
"IX",2,2,"ADGFMD02",11.1,0)
^.114IA^1^1
"IX",2,2,"ADGFMD02",11.1,1,0)
1^F^2^.02^^^F
"IX",2,2,"ADGFMD02",11.1,1,3)

"IX",2,2,"ADGFMD097",0)
2^ADGFMD097^This x-ref calls the DG FIELD MONITOR event point.^MU^^F^I^I^2^^^^^A
"IX",2,2,"ADGFMD097",.1,0)
^^2^2^3060624^
"IX",2,2,"ADGFMD097",.1,1,0)
This cross reference activates the DG FIELD MONITOR event point if field 
"IX",2,2,"ADGFMD097",.1,2,0)
DATE ENTERED INTO FILE (.097) is modified.
"IX",2,2,"ADGFMD097",1)
D FC^DGFCPROT(.DA,2,.097,"SET",$H,$G(DUZ),.X,.X1,.X2,$G(XQY0)) Q
"IX",2,2,"ADGFMD097",2)
D FC^DGFCPROT(.DA,2,.097,"KILL",$H,$G(DUZ),.X,.X1,.X2,$G(XQY0)) Q
"IX",2,2,"ADGFMD097",11.1,0)
^.114IA^1^1
"IX",2,2,"ADGFMD097",11.1,1,0)
1^F^2^.097^^^F
"IX",2,2,"ADGFMD097",11.1,1,3)

"IX",2,2,"ADGFMD104",0)
2^ADGFMD104^x-ref calls the DG FIELD MONITOR event point.^MU^^F^^I^2^^^^^A
"IX",2,2,"ADGFMD104",.1,0)
^^2^2^3060624^
"IX",2,2,"ADGFMD104",.1,1,0)
This cross reference activates the DG FIELD MONITOR event point if the 
"IX",2,2,"ADGFMD104",.1,2,0)
PROVIDER (.104) is modified.
"IX",2,2,"ADGFMD104",1)
D FC^DGFCPROT(.DA,2,.104,"SET",$H,$G(DUZ),.X,.X1,.X2,$G(XQY0)) Q
"IX",2,2,"ADGFMD104",2)
D FC^DGFCPROT(.DA,2,.104,"KILL",$H,$G(DUZ),.X,.X1,.X2,$G(XQY0)) Q
"IX",2,2,"ADGFMD104",11.1,0)
^.114IA^1^1
"IX",2,2,"ADGFMD104",11.1,1,0)
1^F^2^.104^^^F
"IX",2,2,"ADGFMD104",11.1,1,3)

"IX",2,2,"ADGFMD14",0)
2^ADGFMD14^This x-ref calls the DG FIELD MONITOR event point.^MU^^F^I^I^2^^^^^A
"IX",2,2,"ADGFMD14",.1,0)
^^2^2^3060624^
"IX",2,2,"ADGFMD14",.1,1,0)
This cross reference activates the DG FIELD MONITOR event point if the 
"IX",2,2,"ADGFMD14",.1,2,0)
field CURRENT MEANS TEST STATUS (#.14) is modified.
"IX",2,2,"ADGFMD14",1)
D FC^DGFCPROT(.DA,2,.14,"SET",$H,$G(DUZ),.X,.X1,.X2,$G(XQY0)) Q
"IX",2,2,"ADGFMD14",2)
D FC^DGFCPROT(.DA,2,.14,"KILL",$H,$G(DUZ),.X,.X1,.X2,$G(XQY0)) Q
"IX",2,2,"ADGFMD14",11.1,0)
^.114IA^1^1
"IX",2,2,"ADGFMD14",11.1,1,0)
1^F^2^.14^^^F
"IX",2,2,"ADGFMD14",11.1,1,3)

"IX",2,2,"ADGFMD361",0)
2^ADGFMD361^THhis x-ref calls the DG FIELD MONITOR event point.^MU^^F^I^I^2^^^^^A
"IX",2,2,"ADGFMD361",.1,0)
^^2^2^3060624^
"IX",2,2,"ADGFMD361",.1,1,0)
This cross reference activates the DG FIELD MONITOR event point if the 
"IX",2,2,"ADGFMD361",.1,2,0)
PRIMARY ELIGIBILITY CODE (#.361)field changes.
"IX",2,2,"ADGFMD361",1)
D FC^DGFCPROT(.DA,2,.361,"SET",$H,$G(DUZ),.X,.X1,.X2,$G(XQY0)) Q
"IX",2,2,"ADGFMD361",2)
D FC^DGFCPROT(.DA,2,.361,"KILL",$H,$G(DUZ),.X,.X1,.X2,$G(XQY0)) Q
"IX",2,2,"ADGFMD361",11.1,0)
^.114IA^1^1
"IX",2,2,"ADGFMD361",11.1,1,0)
1^F^2^.361^^^F
"MBREQ")
0
"PKG",114,-1)
1^1
"PKG",114,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",114,22,0)
^9.49I^1^1
"PKG",114,22,1,0)
5.3^2930813^2930821
"PKG",114,22,1,"PAH",1,0)
671^3081114^11882
"PKG",114,22,1,"PAH",1,1,0)
^^16^16^3081114
"PKG",114,22,1,"PAH",1,1,1,0)
This patch addresses a request which supports the Pharmacy Benefits
"PKG",114,22,1,"PAH",1,1,2,0)
Management (PBM)Extracts Enhancement #3 project. In order to allow the
"PKG",114,22,1,"PAH",1,1,3,0)
retransmission of only those patients who have had demographic updates,
"PKG",114,22,1,"PAH",1,1,4,0)
Outpatient Pharmacy V. 7.0, Inpatient Medications V. 5.0, Registration
"PKG",114,22,1,"PAH",1,1,5,0)
V. 5.3 and Pharmacy Data Management V. 1.0 were modified to build an
"PKG",114,22,1,"PAH",1,1,6,0)
entry for re-transmission in PBM PATIENT DEMOGRAPHICS File #59.9.
"PKG",114,22,1,"PAH",1,1,7,0)
 
"PKG",114,22,1,"PAH",1,1,8,0)
This patch will introduce six (6) new fields to the DG Field Monitor Event
"PKG",114,22,1,"PAH",1,1,9,0)
driver. This will enhance the PBM extract process anytime these fields
"PKG",114,22,1,"PAH",1,1,10,0)
are accessed and updated. The six fields are:
"PKG",114,22,1,"PAH",1,1,11,0)
   SEX  (#.02)
"PKG",114,22,1,"PAH",1,1,12,0)
   PRIMARY ELIGIBILITY CODE (#.361)
"PKG",114,22,1,"PAH",1,1,13,0)
   CURRENT MEANS TEST STATUS (#.14)
"PKG",114,22,1,"PAH",1,1,14,0)
   CURRENT ENROLLMENT (#27.01)
"PKG",114,22,1,"PAH",1,1,15,0)
   PROVIDER (#.104)
"PKG",114,22,1,"PAH",1,1,16,0)
   DATE ENTERED INTO FILE (#.097)
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","DG53671P")
0^^B1975361
"RTN","DG53671P",1,0)
DG53671P ;ALB/GSN - Post Install to recompile Input Templates ;2/13/08 4:41pm
"RTN","DG53671P",2,0)
 ;;5.3;Registration;**671**;Aug 13, 1993;Build 27
"RTN","DG53671P",3,0)
 ;
"RTN","DG53671P",4,0)
EN ;
"RTN","DG53671P",5,0)
 ;-- re-compile input templates
"RTN","DG53671P",6,0)
 D COMP
"RTN","DG53671P",7,0)
 Q
"RTN","DG53671P",8,0)
 ;
"RTN","DG53671P",9,0)
COMP ;-- Re-compile input templates
"RTN","DG53671P",10,0)
 ;
"RTN","DG53671P",11,0)
 N DGCOUNT,X,Y,DMAX,DGNAME,DGMAX
"RTN","DG53671P",12,0)
 S DGMAX=$$ROUSIZE^DILF
"RTN","DG53671P",13,0)
 D MES^XPDUTL("Recompiling affected input templates ...")
"RTN","DG53671P",14,0)
 F DGCOUNT=1:1 S DGNAME=$P($T(TEMP+DGCOUNT),";;",2) Q:DGNAME=""  D
"RTN","DG53671P",15,0)
 .;
"RTN","DG53671P",16,0)
 .;find the ien of the input template
"RTN","DG53671P",17,0)
 .S Y=$O(^DIE("B",DGNAME,0))
"RTN","DG53671P",18,0)
 .Q:('Y)
"RTN","DG53671P",19,0)
 .;
"RTN","DG53671P",20,0)
 .;quit if input template not compiled
"RTN","DG53671P",21,0)
 .S X=$P($G(^DIE(Y,"ROUOLD")),"^")
"RTN","DG53671P",22,0)
 .Q:(X="")
"RTN","DG53671P",23,0)
 .;
"RTN","DG53671P",24,0)
 .D MES^XPDUTL("Compiling "_DGNAME_" , compiled routine is "_X_" ...")
"RTN","DG53671P",25,0)
 .S DMAX=DGMAX
"RTN","DG53671P",26,0)
 .D EN^DIEZ
"RTN","DG53671P",27,0)
 .D MES^XPDUTL("done")
"RTN","DG53671P",28,0)
 D MES^XPDUTL("Completed compiling input templates")
"RTN","DG53671P",29,0)
 Q
"RTN","DG53671P",30,0)
 ;
"RTN","DG53671P",31,0)
TEMP ;
"RTN","DG53671P",32,0)
 ;;DVBA C ADD 2507 PAT
"RTN","DG53671P",33,0)
 ;;DG101
"RTN","DG53671P",34,0)
 ;;DVBHINQ UPDATE
"RTN","DG53671P",35,0)
 ;;IB SCREEN1
"RTN","DG53671P",36,0)
 ;;DGRPT 10-10T REGISTRATION
"RTN","DG53671P",37,0)
 ;;SDM1
"RTN","DG53671P",38,0)
 ;;DG LOAD EDIT SCREEN 7
"RTN","DGENA1")
0^2^B7946917
"RTN","DGENA1",1,0)
DGENA1 ;ALB/CJM,ISA/KWP - Enrollment API - File Data ;3/31/08 12:18pm
"RTN","DGENA1",2,0)
 ;;5.3;Registration;**121,147,232,671**;Aug 13,1993;Build 27
"RTN","DGENA1",3,0)
 ;PHASE II moved CHECK and TESTVAL to DGENA3
"RTN","DGENA1",4,0)
LOCK(DFN) ;
"RTN","DGENA1",5,0)
 ;Description: This lock is used to prevent another process from editing
"RTN","DGENA1",6,0)
 ;     a patient's enrollment, including the current enrollment and the
"RTN","DGENA1",7,0)
 ;     enrollment history.
"RTN","DGENA1",8,0)
 ;Input:
"RTN","DGENA1",9,0)
 ;  DFN - Patient IEN
"RTN","DGENA1",10,0)
 ;Output:
"RTN","DGENA1",11,0)
 ;  Function Value - Returns 1 if the lock was successful, 0 otherwise
"RTN","DGENA1",12,0)
 ;
"RTN","DGENA1",13,0)
 I $G(DFN) L +^DPT("ENROLLMENT",DFN):10
"RTN","DGENA1",14,0)
 Q $T
"RTN","DGENA1",15,0)
UNLOCK(DFN) ;
"RTN","DGENA1",16,0)
 ;Description: Used to release a lock created by $$LOCK.
"RTN","DGENA1",17,0)
 ;Input:
"RTN","DGENA1",18,0)
 ;  DFN - Patient IEN
"RTN","DGENA1",19,0)
 ;Output: None
"RTN","DGENA1",20,0)
 ;
"RTN","DGENA1",21,0)
 I $G(DFN) L -^DPT("ENROLLMENT",DFN)
"RTN","DGENA1",22,0)
 Q
"RTN","DGENA1",23,0)
STORE(DGENR,NOCHECK,ERRMSG) ;
"RTN","DGENA1",24,0)
 ;Description: Used to file a PATIENT ENROLLMENT record.  Consistency
"RTN","DGENA1",25,0)
 ;     checks are done unless NOCHECK=1.If the
"RTN","DGENA1",26,0)
 ;     enrollment passes the consistency checks specified the
"RTN","DGENA1",27,0)
 ;     PATIENT ENROLLMENT record will be created and the ien returned.
"RTN","DGENA1",28,0)
 ;     If the consistency checks are not passed, or a record can not
"RTN","DGENA1",29,0)
 ;     be created, 0 is returned. This call does NOT lock the record - 
"RTN","DGENA1",30,0)
 ;     call LOCK prior to STORE if the record needs to be locked. 
"RTN","DGENA1",31,0)
 ;Input :
"RTN","DGENA1",32,0)
 ;  DGENR - this local array represents a PATIENT ENROLLMENT (pass by reference)
"RTN","DGENA1",33,0)
 ;  NOCHECK - a flag, if NOCHECK=1 it means the consistency checks were done already, so do not do them again. (optional)
"RTN","DGENA1",34,0)
 ;  ERRMSG - error message on failure (optional, pass by reference)
"RTN","DGENA1",35,0)
 ;Output:
"RTN","DGENA1",36,0)
 ;  Function Value - returns the ien of the PATIENT ENROLLMENT record
"RTN","DGENA1",37,0)
 ;     created if successful , 0 otherwise
"RTN","DGENA1",38,0)
 N DIC,DA,DIE,Y,DR,DO,DD
"RTN","DGENA1",39,0)
 ;check that enrollment is valid before storing
"RTN","DGENA1",40,0)
 I $G(NOCHECK)'=1 Q:'$$CHECK^DGENA3(.DGENR,,.ERRMSG) 0
"RTN","DGENA1",41,0)
 ;create a new record
"RTN","DGENA1",42,0)
 S DIC(0)="",X=DGENR("APP"),DIC="^DGEN(27.11,"
"RTN","DGENA1",43,0)
 D FILE^DICN
"RTN","DGENA1",44,0)
 I Y=-1 S ERRMSG="FILEMAN UNABLE TO CREATE ENROLLMENT RECORD" Q 0
"RTN","DGENA1",45,0)
 S DA=+Y
"RTN","DGENA1",46,0)
 ;if failed to store record, exit
"RTN","DGENA1",47,0)
 Q:'DA 0
"RTN","DGENA1",48,0)
 ;edit the record
"RTN","DGENA1",49,0)
 I '$$EDIT^DGENA1A(DA,.DGENR) Q 0
"RTN","DGENA1",50,0)
 Q DA
"RTN","DGENA1",51,0)
STORECUR(DGENR,NOCHECK,ERRMSG) ;
"RTN","DGENA1",52,0)
 ;Description: Used to store an enrollment that has already been created
"RTN","DGENA1",53,0)
 ;     as a local array  into  the PATIENT ENROLLMENT file as the
"RTN","DGENA1",54,0)
 ;     patient's current enrollment.  If the enrollment passes the
"RTN","DGENA1",55,0)
 ;     consistency checks specified the enrollment record will be
"RTN","DGENA1",56,0)
 ;     created and the internal entry number returned. If the
"RTN","DGENA1",57,0)
 ;     consistency checks are not passed, or a record can not be
"RTN","DGENA1",58,0)
 ;     created, 0 will be returned
"RTN","DGENA1",59,0)
 ;Input :
"RTN","DGENA1",60,0)
 ;  DGENR - this local array represents a PATIENT ENROLLMENT and should
"RTN","DGENA1",61,0)
 ;     be passed by reference.
"RTN","DGENA1",62,0)
 ;  NOCHECK - a flag, if NOCHECK=1 it means the consistency checks were done already, so do not do them again. (optional)
"RTN","DGENA1",63,0)
 ;Output:
"RTN","DGENA1",64,0)
 ;  Function Value - returns the internal entry number of the PATIENT
"RTN","DGENA1",65,0)
 ;     ENROLLMENT record created if successful , 0 otherwise
"RTN","DGENA1",66,0)
 ;  ERRMSG - error message on failure (optional, pass by reference)
"RTN","DGENA1",67,0)
 N DGENRIEN,OK
"RTN","DGENA1",68,0)
 S OK=1
"RTN","DGENA1",69,0)
 I '$$LOCK($G(DGENR("DFN"))) S OK=0
"RTN","DGENA1",70,0)
 D:OK
"RTN","DGENA1",71,0)
 .S DGENRIEN=$$STORE(.DGENR,$G(NOCHECK),.ERRMSG)
"RTN","DGENA1",72,0)
 .I 'DGENRIEN S OK=0
"RTN","DGENA1",73,0)
 .D:OK
"RTN","DGENA1",74,0)
 ..N PRIOR
"RTN","DGENA1",75,0)
 ..;link enrollment record to the prior enrollment
"RTN","DGENA1",76,0)
 ..D:DGENR("PRIORREC") KILL^DGENA1A(27.11,DGENRIEN,.09,DGENR("PRIORREC"))
"RTN","DGENA1",77,0)
 ..S PRIOR=$$FINDCUR^DGENA(DGENR("DFN"))
"RTN","DGENA1",78,0)
 ..S $P(^DGEN(27.11,DGENRIEN,0),"^",9)=PRIOR
"RTN","DGENA1",79,0)
 ..D:PRIOR SET^DGENA1A(27.11,DGENRIEN,.09,PRIOR)
"RTN","DGENA1",80,0)
 ..;now link the patient record to the new current enrollment
"RTN","DGENA1",81,0)
 ..D:PRIOR KILL^DGENA1A(2,DGENR("DFN"),27.01,PRIOR)
"RTN","DGENA1",82,0)
 ..N DGENFDA
"RTN","DGENA1",83,0)
 ..S DGENFDA(2,DGENR("DFN")_",",27.01)=DGENRIEN
"RTN","DGENA1",84,0)
 ..D UPDATE^DIE("","DGENFDA","","ERR")
"RTN","DGENA1",85,0)
 D UNLOCK(DGENR("DFN"))
"RTN","DGENA1",86,0)
 Q $S(OK:DGENRIEN,1:0)
"RTN","DGENA1",87,0)
EDITCUR(DGENR) ;
"RTN","DGENA1",88,0)
 ;Description: Used to store an enrollment that has already been created
"RTN","DGENA1",89,0)
 ;     as a local array  into  the PATIENT ENROLLMENT file as the
"RTN","DGENA1",90,0)
 ;     patient's current enrollment. If the enrollment passes the
"RTN","DGENA1",91,0)
 ;     consistency checks specified the current enrollment record, if
"RTN","DGENA1",92,0)
 ;     it exists, will be overlaid by the enrollment contained in
"RTN","DGENA1",93,0)
 ;     DGENR, otherwise, if there is no current enrollment, a new
"RTN","DGENA1",94,0)
 ;     patient enrollment record will be created as the current
"RTN","DGENA1",95,0)
 ;     enrollment. If the consistency checks are not passed, or a
"RTN","DGENA1",96,0)
 ;     record can not be created, NULL will be returned.
"RTN","DGENA1",97,0)
 ;Input :
"RTN","DGENA1",98,0)
 ;  DGENR - this local array represents a PATIENT ENROLLMENT and
"RTN","DGENA1",99,0)
 ;     should be passed by reference.
"RTN","DGENA1",100,0)
 ;Output:
"RTN","DGENA1",101,0)
 ;  Function Value - returns the internal entry number of the PATIENT
"RTN","DGENA1",102,0)
 ;     ENROLLMENT record created if successful , 0 otherwise
"RTN","DGENA1",103,0)
 N DGENRIEN,OK
"RTN","DGENA1",104,0)
 S OK=$$LOCK($G(DGENR("DFN")))
"RTN","DGENA1",105,0)
 D:OK
"RTN","DGENA1",106,0)
 .S DGENRIEN=$$FINDCUR^DGENA(DGENR("DFN"))
"RTN","DGENA1",107,0)
 .I 'DGENRIEN D
"RTN","DGENA1",108,0)
 ..S OK=$$STORECUR(.DGENR)
"RTN","DGENA1",109,0)
 .E  D
"RTN","DGENA1",110,0)
 ..S OK=$$CHECK^DGENA3(.DGENR)
"RTN","DGENA1",111,0)
 ..I OK S OK=$$EDIT^DGENA1A(DGENRIEN,.DGENR)
"RTN","DGENA1",112,0)
 D UNLOCK(DGENR("DFN"))
"RTN","DGENA1",113,0)
 Q $S(OK:DGENRIEN,1:0)
"RTN","DGMTDD")
0^1^B17672823
"RTN","DGMTDD",1,0)
DGMTDD ;ALB/RMO,CAW,CJM,LBD,PHH - Annual Means Test file (#408.31) Data Dictionary Calls ; 2/10/2005 9:12am
"RTN","DGMTDD",2,0)
 ;;5.3;Registration;**33,182,411,456,618,671**;Aug 13, 1993;Build 27
"RTN","DGMTDD",3,0)
 ;
"RTN","DGMTDD",4,0)
CUR ;Cross-reference on the Status field (#.03) 
"RTN","DGMTDD",5,0)
 ;to update the Current Means Test Status field (#.14)
"RTN","DGMTDD",6,0)
 ;in the Patient file (#2)
"RTN","DGMTDD",7,0)
 N DFN,DGCS,DGDT,DGIX,DGMTI,DGMTS,DGNAM
"RTN","DGMTDD",8,0)
 S DFN=$P($G(^DGMT(408.31,DA,0)),U,2),DGCS=$P($G(^DPT(DFN,0)),U,14),(DGDT,DGMTS)=""
"RTN","DGMTDD",9,0)
 ;
"RTN","DGMTDD",10,0)
 S DGNAM=$P($G(^DPT(DFN,0)),"^",1)
"RTN","DGMTDD",11,0)
 Q:DGNAM=""
"RTN","DGMTDD",12,0)
 Q:'$D(^DPT("B",DGNAM))
"RTN","DGMTDD",13,0)
 ;
"RTN","DGMTDD",14,0)
 S DGMTI=+$$MTIENLT^DGMTU3(1,DFN,"")
"RTN","DGMTDD",15,0)
 I $D(^DGMT(408.31,DGMTI,0)) S DGMTS=$P(^(0),U,3) G CURQ:DGCS=DGMTS
"RTN","DGMTDD",16,0)
 I DGCS]"" D
"RTN","DGMTDD",17,0)
 .N DA,X
"RTN","DGMTDD",18,0)
 .S DA=DFN,X=DGCS,DGIX=0
"RTN","DGMTDD",19,0)
 .F  S DGIX=$O(^DD(2,.14,1,DGIX)) Q:'DGIX  X ^(DGIX,2) S X=DGCS
"RTN","DGMTDD",20,0)
 D
"RTN","DGMTDD",21,0)
 . N DR,DIE,DA,D0,DI,DIC,DQ,D,DE,DC,DH,FDA,DIERR
"RTN","DGMTDD",22,0)
 . S FDA(2,DFN_",",.14)=DGMTS
"RTN","DGMTDD",23,0)
 . D FILE^DIE("K","FDA","DIERR")
"RTN","DGMTDD",24,0)
 I DGMTS]"" D
"RTN","DGMTDD",25,0)
 .N DA,X
"RTN","DGMTDD",26,0)
 .S DA=DFN,X=DGMTS,DGIX=0
"RTN","DGMTDD",27,0)
 .F  S DGIX=$O(^DD(2,.14,1,DGIX)) Q:'DGIX  X ^(DGIX,1) S X=DGMTS
"RTN","DGMTDD",28,0)
CURQ Q
"RTN","DGMTDD",29,0)
 ;
"RTN","DGMTDD",30,0)
COM ;Input Transform check of the Completion date/time field (#.07)
"RTN","DGMTDD",31,0)
 N DGDT,DGMT0,XMB,XMDUZ
"RTN","DGMTDD",32,0)
 S DGMT0=$G(^DGMT(408.31,DA,0))
"RTN","DGMTDD",33,0)
 I X<+DGMT0 W !?5,"The completion date/time cannot be before the date of test." K X
"RTN","DGMTDD",34,0)
 I $D(X) S DGDT=+$O(^DGMT(408.31,"AD",$P(DGMT0,U,19),$P(DGMT0,U,2),+DGMT0)) I DGDT,X'<DGDT W !?5,"The completion date/time cannot be after the next date of test." K X
"RTN","DGMTDD",35,0)
 ; DG*5.3*411 - MT Completion Bulletin
"RTN","DGMTDD",36,0)
 ;
"RTN","DGMTDD",37,0)
 I $D(X) D
"RTN","DGMTDD",38,0)
 . N EASDT S EASDT=X
"RTN","DGMTDD",39,0)
 . Q:'$$GET1^DIQ(713,1,7,"I")
"RTN","DGMTDD",40,0)
 . Q:$P(DGMT0,U,19)'=1
"RTN","DGMTDD",41,0)
 . S XMB="EAS MTCOMPLETION"
"RTN","DGMTDD",42,0)
 . S XMB(1)=$$GET1^DIQ(2,$P(DGMT0,U,2),.01)
"RTN","DGMTDD",43,0)
 . S XMB(2)=$E($$GET1^DIQ(2,$P(DGMT0,U,2),.09),6,10)
"RTN","DGMTDD",44,0)
 . S XMB(3)=$$FMTE^XLFDT(EASDT)
"RTN","DGMTDD",45,0)
 . S XMB(4)=$$GET1^DIQ(200,DUZ,.01)
"RTN","DGMTDD",46,0)
 . S XMDUZ="EAS MT Completion"
"RTN","DGMTDD",47,0)
 . D ^XMB
"RTN","DGMTDD",48,0)
COMQ Q
"RTN","DGMTDD",49,0)
 ;
"RTN","DGMTDD",50,0)
SCR(DGMTS,DGMTI,DGMTYPT,DGMTACT) ;Screen for the Status field (#.03)
"RTN","DGMTDD",51,0)
 ;                         Input  -- DGMTS    Means Test Status IEN
"RTN","DGMTDD",52,0)
 ;                                   DGMTI    Annual Means Test IEN
"RTN","DGMTDD",53,0)
 ;                                   DGMTYPT  Type of Test 1=MT 2=COPAY
"RTN","DGMTDD",54,0)
 ;                                   DGMTACT  Means Test Action (Opt)
"RTN","DGMTDD",55,0)
 ;                         Output -- 1=SELECTABLE and 0=NOT SELECTABLE
"RTN","DGMTDD",56,0)
 N DA,DGMT0,DGMTDT,Y
"RTN","DGMTDD",57,0)
 S DGMT0=$G(^DGMT(408.31,DGMTI,0)),DGMTDT=+DGMT0
"RTN","DGMTDD",58,0)
 I DGMTYPT=1,$$ACT(DGMTS,DGMTDT),$$MTS(DGMTS,DGMTDT,DGMT0,$G(DGMTACT),DGMTYPT) S Y=1
"RTN","DGMTDD",59,0)
 I DGMTYPT=2,$$ACT(DGMTS,DGMTDT),$P(^DG(408.32,DGMTS,0),U,19)=2,$$MTS(DGMTS,DGMTDT,DGMT0,$G(DGMTACT),DGMTYPT) S Y=1
"RTN","DGMTDD",60,0)
 Q +$G(Y)
"RTN","DGMTDD",61,0)
 ;
"RTN","DGMTDD",62,0)
ACT(DGMTS,DGMTDT) ;Determine if means test status is active
"RTN","DGMTDD",63,0)
 ;                 Input  -- DGMTS   Means Test Status IEN
"RTN","DGMTDD",64,0)
 ;                           DGMTDT  Date of Test
"RTN","DGMTDD",65,0)
 ;                 Output -- 1=ACTIVE and 0=INACTIVE
"RTN","DGMTDD",66,0)
 N Y
"RTN","DGMTDD",67,0)
 S:'$P(DGMTDT,".",2) DGMTDT=DGMTDT_.2359
"RTN","DGMTDD",68,0)
 I $D(^DG(408.32,DGMTS,"E",+$O(^(+$O(^DG(408.32,DGMTS,"E","AID",-DGMTDT)),0)),0)),$P($G(^(0)),U,2) S Y=1
"RTN","DGMTDD",69,0)
 Q +$G(Y)
"RTN","DGMTDD",70,0)
 ;
"RTN","DGMTDD",71,0)
MTS(DGMTS,DGMTDT,DGMT0,DGMTACT,DGMTYPT) ;Determine if means test status is selectable
"RTN","DGMTDD",72,0)
 ;                      Input  -- DGMTS    Means Test Status IEN
"RTN","DGMTDD",73,0)
 ;                                DGMTDT   Date of Test
"RTN","DGMTDD",74,0)
 ;                                DGMT0    Annual Means Test 0th node
"RTN","DGMTDD",75,0)
 ;                                DGMTACT  Means Test Action  (Opt)
"RTN","DGMTDD",76,0)
 ;                                DGMTYPT  Type of Test 1=MT 2=COPAY
"RTN","DGMTDD",77,0)
 ;                      Output -- 1=SELECTABLE and 0=NOT SELECTABLE
"RTN","DGMTDD",78,0)
 N DGDET,DGINT,DGLY,DGMTPAR,DGNWT,DGOMTS,DGTHA,DGTHB,DGTHPF,DGTSRC
"RTN","DGMTDD",79,0)
 N DGMTNWC,DGNW,DGTHG
"RTN","DGMTDD",80,0)
 S Y=0
"RTN","DGMTDD",81,0)
 I DGMTYPT=1 D
"RTN","DGMTDD",82,0)
 .S DGOMTS=$P(DGMT0,U,3),DGINT=$P(DGMT0,U,4),DGNWT=$P(DGMT0,U,5),DGDET=$P(DGMT0,U,15),DGLY=$E(DGMTDT,1,3)-1_"0000"
"RTN","DGMTDD",83,0)
 .S:$$ACT(4,DGMTDT) DGTHA=$P(DGMT0,U,12) S:$$ACT(5,DGMTDT) DGTHB=$P(DGMT0,U,13) S:$$ACT(16,DGMTDT) DGTHG=$P(DGMT0,U,27)
"RTN","DGMTDD",84,0)
 .S DGMTPAR=$G(^DG(43,1,"MT",$S($P(DGMT0,U,16):DGLY,1:DGLY+10000),0))
"RTN","DGMTDD",85,0)
 .S DGMTNWC=+$G(^DG(43,1,"GMT"))
"RTN","DGMTDD",86,0)
 .S DGNW=DGNWT-DGDET+$S(DGMTNWC:0,1:DGINT)
"RTN","DGMTDD",87,0)
 .S DGTHPF=$S(DGNW'<$P(DGMTPAR,U,8):1,1:0)
"RTN","DGMTDD",88,0)
 .S DGTSRC=$P($G(^DG(408.34,+$P(DGMT0,U,23),0)),U)
"RTN","DGMTDD",89,0)
 .I DGMTS=2,$G(DGMTACT)="CAT" D
"RTN","DGMTDD",90,0)
 ..S:DGTHPF Y=1
"RTN","DGMTDD",91,0)
 ..S:((DGTSRC="VAMC")&(DGOMTS=4)) Y=0
"RTN","DGMTDD",92,0)
 .I DGMTS=4 S Y=1
"RTN","DGMTDD",93,0)
 .I DGMTS=5 D
"RTN","DGMTDD",94,0)
 ..S:DGTHPF!(DGINT>$G(DGTHA)) Y=1
"RTN","DGMTDD",95,0)
 ..S:((DGTSRC="VAMC")&(DGOMTS=4)) Y=0
"RTN","DGMTDD",96,0)
 .I DGMTS=6 D
"RTN","DGMTDD",97,0)
 ..S:DGTHPF!(DGINT>$G(DGTHA)&(DGINT>$G(DGTHG))) Y=1
"RTN","DGMTDD",98,0)
 ..S:(DGOMTS=2)&($G(DGTHG)>$G(DGTHA)) Y=0
"RTN","DGMTDD",99,0)
 ..S:((DGTSRC="VAMC")&(DGOMTS=4)) Y=0
"RTN","DGMTDD",100,0)
 .I DGMTS=16 D
"RTN","DGMTDD",101,0)
 ..S:$G(DGTHG)>$G(DGTHA)&(DGTHPF!(DGINT>$G(DGTHA))) Y=1
"RTN","DGMTDD",102,0)
 ..S:((DGTSRC="VAMC")&(DGOMTS=4)) Y=0
"RTN","DGMTDD",103,0)
 I DGMTYPT=2 D
"RTN","DGMTDD",104,0)
 .I DGMTS=7 S Y=1
"RTN","DGMTDD",105,0)
 .I DGMTS=8 S Y=1
"RTN","DGMTDD",106,0)
 .I DGMTS=9 S Y=1
"RTN","DGMTDD",107,0)
 .I DGMTS=10 S Y=0
"RTN","DGMTDD",108,0)
 .I DGMTS=11 S Y=0
"RTN","DGMTDD",109,0)
 Q +$G(Y)
"RTN","DGMTDD",110,0)
 ;
"RTN","DGMTDD",111,0)
STOPAUTO(DA) ;
"RTN","DGMTDD",112,0)
 ;This is the kill logic for an xref on the Test Determined Status field.
"RTN","DGMTDD",113,0)
 ;If the status changes, and there is a linked test via the Linked
"RTN","DGMTDD",114,0)
 ;Rx Copay/Means Test field, the Test Determined Status of the linked
"RTN","DGMTDD",115,0)
 ;test should be deleted.
"RTN","DGMTDD",116,0)
 ;
"RTN","DGMTDD",117,0)
 ;Input - DA is the ien of a test in the Annual Means Test file
"RTN","DGMTDD",118,0)
 ;Output - none
"RTN","DGMTDD",119,0)
 ;
"RTN","DGMTDD",120,0)
 N LINKEDMT
"RTN","DGMTDD",121,0)
 Q:'$G(DA)
"RTN","DGMTDD",122,0)
 S LINKEDMT=$P($G(^DGMT(408.31,DA,2)),"^",6)
"RTN","DGMTDD",123,0)
 I LINKEDMT D
"RTN","DGMTDD",124,0)
 .S $P(^DGMT(408.31,LINKEDMT,2),"^",2)=$$NOW^XLFDT
"RTN","DGMTDD",125,0)
 .S $P(^DGMT(408.31,LINKEDMT,2),"^",3)=""
"RTN","DGMTDD",126,0)
 Q
"RTN","DGPATN")
0^4^B5286431
"RTN","DGPATN",1,0)
DGPATN ;ALB/MRL - NEW PATIENT ENTRY ; 22 MAY 87
"RTN","DGPATN",2,0)
 ;;5.3;Registration;**41,278,671**;Aug 13, 1993;Build 27
"RTN","DGPATN",3,0)
 ;Name Changed/Patient Deleted Bulletin
"RTN","DGPATN",4,0)
 I $S('$D(DFN):1,'$D(X):1,1:0) Q
"RTN","DGPATN",5,0)
 I $D(DGNEWVAL),(DGNEWVAL=X) Q  ; edit and edited to same value
"RTN","DGPATN",6,0)
 S DGDATA=X D ^DGPATV S DGB=$S(DGNAME'=X:3,1:9) G Q:'DGB S XMSUB="PATIENT "_$S(DGB=3:"NAME CHANGED",1:"DELETED")
"RTN","DGPATN",7,0)
 ;
"RTN","DGPATN",8,0)
 ;Delete entries in PT/IHS file when entries deleted from PT file.
"RTN","DGPATN",9,0)
 I XMSUB="PATIENT DELETED" D
"RTN","DGPATN",10,0)
 . N DA,DIK
"RTN","DGPATN",11,0)
 . S DA=DFN,DIK="^AUPNPAT(" D ^DIK
"RTN","DGPATN",12,0)
 ;
"RTN","DGPATN",13,0)
 S DGTEXT(1,0)="NAME:  "_DGNAME,DGTEXT(2,0)="SSN :  "_$P(SSN,"^",2),DGTEXT(3,0)="DOB :  "_$P(DOB,"^",2),DGTEXT(4,0)="" I DGB=3 S DGTEXT(5,0)="Previous name was '"_DGDATA_"'."
"RTN","DGPATN",14,0)
 G T
"RTN","DGPATN",15,0)
 ;
"RTN","DGPATN",16,0)
S ;SSN Changed/New Patient Added Bulletin
"RTN","DGPATN",17,0)
 I $S('$D(DFN):1,'$D(X):1,1:0) Q
"RTN","DGPATN",18,0)
 S DGDATA=X D ^DGPATV S DGB=$S(SSN=X:2,SSN="UNSPECIFIED":2,DGDATA'=$P(SSN,"^",1):4,1:0) I 'DGB G Q
"RTN","DGPATN",19,0)
 S XMSUB=$S(DGB=2:"NEW PATIENT ADDED TO SYSTEM",1:"SSN CHANGED"),DGTEXT(1,0)="NAME:  "_DGNAME,DGTEXT(2,0)="SSN :  "_$E(DGDATA,1,3)_"-"_$E(DGDATA,4,5)_"-"_$E(DGDATA,6,10),DGTEXT(3,0)="DOB :  "_$P(DOB,"^",2)
"RTN","DGPATN",20,0)
 I DGB=4 S DGTEXT(4,0)="",DGTEXT(5,0)="Previous SSN was '"_$P(SSN,"^",2)_"'."
"RTN","DGPATN",21,0)
 I DGB=2 D H^DGUTL D       ;New patient Who & When
"RTN","DGPATN",22,0)
 . N DR,DIE,DA,D,D0,DI,DIC,DQ,PRIOR,X,Y,%,%DT,%I,DB,DC,DE,DH,DIEL,DIER,DIETMP,DIFLD,DIP,DK,DL,DM,DP,DU,DW,DZ,DV
"RTN","DGPATN",23,0)
 . S DIE="^DPT(",DA=DFN,DR=".097///"_DGDATE
"RTN","DGPATN",24,0)
 . S:$G(DUZ)>0 DR=DR_";.096///"_DUZ
"RTN","DGPATN",25,0)
 . D ^DIE
"RTN","DGPATN",26,0)
T K XMTEXT D ^DGBUL
"RTN","DGPATN",27,0)
Q S X=DGDATA D KILL^DGPATV K DGDATA,DGTIME,DGDATE Q
"RTN","DGPMDDCN")
0^3^B21852300
"RTN","DGPMDDCN",1,0)
DGPMDDCN ;ALB/MRL - DETERMINE INPATIENT X-REF'S ;3/04/08 8:54am
"RTN","DGPMDDCN",2,0)
 ;;5.3;Registration;**54,498,671**;Aug 13, 1993;Build 27
"RTN","DGPMDDCN",3,0)
 ;
"RTN","DGPMDDCN",4,0)
1 ; 
"RTN","DGPMDDCN",5,0)
 I $S($D(DGPMT):1,('$D(DA)#2):1,'$D(DGPMDDF):1,'$D(DGPMDDT):1,1:0) G KX
"RTN","DGPMDDCN",6,0)
 N DFN S DFN=+$P(^DGPM(+DA,0),"^",3) I '$D(^DPT(DFN,0)) G KX
"RTN","DGPMDDCN",7,0)
 I 'DGPMDDT D @("K"_+DGPMDDF) G Q
"RTN","DGPMDDCN",8,0)
 D INPTCK
"RTN","DGPMDDCN",9,0)
 I $S('VAWD:1,1:$P(VAWD,"^",2)="") D  G Q
"RTN","DGPMDDCN",10,0)
 . N DGWD
"RTN","DGPMDDCN",11,0)
 . D FIND^DGPMDDLD
"RTN","DGPMDDCN",12,0)
 . I DGWD,($P(DGWD,"^",2)]"") D EN^DGPMDDLD Q
"RTN","DGPMDDCN",13,0)
 . K X
"RTN","DGPMDDCN",14,0)
 D @("S"_+DGPMDDF) G Q
"RTN","DGPMDDCN",15,0)
 ;
"RTN","DGPMDDCN",16,0)
KX K X
"RTN","DGPMDDCN",17,0)
Q D KVAR^VADPT30 K DGPMX,DGPMX1,DGFLD,DGPMDD,DGPMDDF,DGPMDDT,I Q
"RTN","DGPMDDCN",18,0)
 ;
"RTN","DGPMDDCN",19,0)
S6 ; -- ward x-ref
"RTN","DGPMDDCN",20,0)
 S DGFLD=.1 I $D(^DPT(DFN,.1)) S DGPMX=^(.1) K:$D(^(.105)) ^DGPM("CN",DGPMX,+^(.105)) D KILL
"RTN","DGPMDDCN",21,0)
 S DGPMX=$P(VAWD,"^",2),^DGPM("CN",DGPMX,+$P(^DGPM(+VAMV,0),"^",14))=""
"RTN","DGPMDDCN",22,0)
 D SET
"RTN","DGPMDDCN",23,0)
 S DGFLD=.102 I $D(^DPT(DFN,.102)) S DGPMX=^(.102) D KILL
"RTN","DGPMDDCN",24,0)
 S DGPMX=+VAMV D SET:DGPMX
"RTN","DGPMDDCN",25,0)
 S DGFLD=.105 I $D(^DPT(DFN,.105)) S DGPMX=^(.105) D KILL
"RTN","DGPMDDCN",26,0)
 S DGPMX=+$P(^DGPM(+VAMV,0),"^",14) D SET:DGPMX
"RTN","DGPMDDCN",27,0)
 Q
"RTN","DGPMDDCN",28,0)
 ;
"RTN","DGPMDDCN",29,0)
K6 ;
"RTN","DGPMDDCN",30,0)
 I X S W=$S($D(^DIC(42,+X,0)):$P(^(0),"^",1),1:"") I W]"" K ^DGPM("CN",W,+$P(^DGPM(DA,0),"^",14)) I $D(^DPT(DFN,.1)),^(.1)=W S DGPMX=W,DGFLD=.1 D KILL
"RTN","DGPMDDCN",31,0)
 K W
"RTN","DGPMDDCN",32,0)
 I $D(^DPT(DFN,.102)),^(.102)=DA S DGPMX=DA,DGFLD=.102 D KILL
"RTN","DGPMDDCN",33,0)
 I $D(^DPT(DFN,.105)),^(.105)=$P(^DGPM(DA,0),"^",14) S DGPMX=$P(^DGPM(DA,0),"^",14),DGFLD=.105 D KILL
"RTN","DGPMDDCN",34,0)
 Q
"RTN","DGPMDDCN",35,0)
 ;
"RTN","DGPMDDCN",36,0)
S7 ; -- room-bed x-ref
"RTN","DGPMDDCN",37,0)
 I $D(^DPT(DFN,.108)) S DGPMX=^(.108),DGFLD=.108 D KILL F DGPMX1=0:0 S DGPMX1=+$O(^DGPM("ARM",DGPMX,DGPMX1)) D CHK I $T K ^DGPM("ARM",DGPMX,DGPMX1) Q
"RTN","DGPMDDCN",38,0)
 S DGFLD=.101 I $D(^DPT(DFN,.101)) S DGPMX=^(.101) D KILL
"RTN","DGPMDDCN",39,0)
 S DGPMX=$P(VARM,"^",2) D SET
"RTN","DGPMDDCN",40,0)
 I +VARM S DGFLD=.108,DGPMX=+VARM,^DGPM("ARM",DGPMX,VAWDA)=0 D SET
"RTN","DGPMDDCN",41,0)
 Q
"RTN","DGPMDDCN",42,0)
 ;
"RTN","DGPMDDCN",43,0)
K7 ;
"RTN","DGPMDDCN",44,0)
 I $D(^DPT(DFN,.108)),X=+^(.108) S DGPMX=X I $D(^DGPM("ARM",DGPMX,DA)) K ^(DA) S DGFLD=.108 D KILL
"RTN","DGPMDDCN",45,0)
 I X S R=$S($D(^DG(405.4,+X,0)):$P(^(0),"^",1),1:"") I R]"",$D(^DPT(DFN,.101)),^(.101)=R S DGPMX=R,DGFLD=.101 D KILL
"RTN","DGPMDDCN",46,0)
 Q
"RTN","DGPMDDCN",47,0)
 ;
"RTN","DGPMDDCN",48,0)
CHK ;
"RTN","DGPMDDCN",49,0)
 I '$D(^DGPM(DGPMX1,0)) Q
"RTN","DGPMDDCN",50,0)
 I $P(^DGPM(DGPMX1,0),"^",3)=DFN Q
"RTN","DGPMDDCN",51,0)
 Q
"RTN","DGPMDDCN",52,0)
 ;
"RTN","DGPMDDCN",53,0)
S8 ; -- doc x-ref
"RTN","DGPMDDCN",54,0)
 I $D(^DPT(DFN,.104)) S DGPMX=+^(.104) D KILL
"RTN","DGPMDDCN",55,0)
 S DGPMX=+VAPP I DGPMX D
"RTN","DGPMDDCN",56,0)
 . N DA,DR,DIE,DIC,D,%H,%T,D0,DIK,DK,DL,X,DQ,Y
"RTN","DGPMDDCN",57,0)
 . S DIE="^DPT(",DA=DFN,DR=".104////"_DGPMX D ^DIE
"RTN","DGPMDDCN",58,0)
 Q
"RTN","DGPMDDCN",59,0)
 ;
"RTN","DGPMDDCN",60,0)
K8 ;
"RTN","DGPMDDCN",61,0)
 I X,$D(^DPT(DFN,.104)),^(.104)=X S DGPMX=X,DGFLD=.104 D KILL
"RTN","DGPMDDCN",62,0)
 Q
"RTN","DGPMDDCN",63,0)
 ;
"RTN","DGPMDDCN",64,0)
S9 ; -- tr. spec x-ref
"RTN","DGPMDDCN",65,0)
 S DGFLD=.103 I $D(^DPT(DFN,.103)) S DGPMX=+^(.103) D KILL
"RTN","DGPMDDCN",66,0)
 S DGPMX=+VATS D SET:DGPMX
"RTN","DGPMDDCN",67,0)
 Q
"RTN","DGPMDDCN",68,0)
 ;
"RTN","DGPMDDCN",69,0)
K9 ;
"RTN","DGPMDDCN",70,0)
 I X,$D(^DPT(DFN,.103)),^(.103)=X S DGPMX=X,DGFLD=.103 D KILL
"RTN","DGPMDDCN",71,0)
 Q
"RTN","DGPMDDCN",72,0)
 ;
"RTN","DGPMDDCN",73,0)
S19 ; -- attend x-ref
"RTN","DGPMDDCN",74,0)
 S DGFLD=.1041 I $D(^DPT(DFN,.1041)) S DGPMX=+^(.1041) D KILL
"RTN","DGPMDDCN",75,0)
 S DGPMX=+VAAP D SET:DGPMX
"RTN","DGPMDDCN",76,0)
 Q
"RTN","DGPMDDCN",77,0)
 ;
"RTN","DGPMDDCN",78,0)
K19 ;
"RTN","DGPMDDCN",79,0)
 I X,$D(^DPT(DFN,.1041)),^(.1041)=X S DGPMX=X,DGFLD=.1041 D KILL
"RTN","DGPMDDCN",80,0)
 Q
"RTN","DGPMDDCN",81,0)
 ;
"RTN","DGPMDDCN",82,0)
S41 ; -- fac dir x-ref (AFD)
"RTN","DGPMDDCN",83,0)
 S DGFLD=.109 S DGPMX=$P($G(^DPT(DFN,.109)),"^",1) D KILL:(DGPMX'="")
"RTN","DGPMDDCN",84,0)
 S DGPMX=$P(VAFD,"^",1) D SET:(DGPMX'="")
"RTN","DGPMDDCN",85,0)
 Q
"RTN","DGPMDDCN",86,0)
 ;
"RTN","DGPMDDCN",87,0)
K41 ;
"RTN","DGPMDDCN",88,0)
 I X'="",$P($G(^DPT(DFN,.109)),"^",1)=X S DGPMX=X,DGFLD=.109 D KILL
"RTN","DGPMDDCN",89,0)
 Q
"RTN","DGPMDDCN",90,0)
 ;
"RTN","DGPMDDCN",91,0)
SET ; -- generic set x-ref logic
"RTN","DGPMDDCN",92,0)
 Q:DGPMX']""
"RTN","DGPMDDCN",93,0)
 N X,DA S DA=DFN,(^DPT(DA,DGFLD),X)=DGPMX
"RTN","DGPMDDCN",94,0)
 F DGIX=0:0 S DGIX=$O(^DD(2,DGFLD,1,DGIX)) Q:'DGIX  X ^(DGIX,1) S X=DGPMX
"RTN","DGPMDDCN",95,0)
 K DGIX Q
"RTN","DGPMDDCN",96,0)
 ;
"RTN","DGPMDDCN",97,0)
KILL ; -- generic kill x-ref logic
"RTN","DGPMDDCN",98,0)
 Q:DGPMX']""
"RTN","DGPMDDCN",99,0)
 N X,DA S DA=DFN,X=DGPMX
"RTN","DGPMDDCN",100,0)
 F DGIX=0:0 S DGIX=$O(^DD(2,DGFLD,1,DGIX)) Q:'DGIX  X ^(DGIX,2) S X=DGPMX
"RTN","DGPMDDCN",101,0)
 K DGIX,^DPT(DA,DGFLD) Q
"RTN","DGPMDDCN",102,0)
 ;
"RTN","DGPMDDCN",103,0)
CN ; -- set "CN" x-ref for file #2 equal to corresp adm mv
"RTN","DGPMDDCN",104,0)
 N DFN,VAMV0,VAMV,VAMT,VAID,DGX
"RTN","DGPMDDCN",105,0)
 S DGX=X D NOW^%DTC S VAID=9999999.999999-%,DFN=DA D MV^VADPT30
"RTN","DGPMDDCN",106,0)
 I $P(VAMV0,U,2),$P(VAMV0,U,2)'=3 S ^DPT("CN",DGX,DA)=$P(VAMV0,"^",14)
"RTN","DGPMDDCN",107,0)
 Q
"RTN","DGPMDDCN",108,0)
 ;
"RTN","DGPMDDCN",109,0)
RESET ; -- reset ^DPT nodes and x-refs
"RTN","DGPMDDCN",110,0)
 ;    input: DFN
"RTN","DGPMDDCN",111,0)
 ;
"RTN","DGPMDDCN",112,0)
 ; -- kill data and x-refs
"RTN","DGPMDDCN",113,0)
 I $D(^DPT(DFN,.105)),$D(^(.1)),^(.1)]"" K ^DGPM("CN",^(.1),+^(.105))
"RTN","DGPMDDCN",114,0)
 I $D(^DPT(DFN,.108)) S DGPMX=^(.108),DGFLD=.108 D KILL F DGPMX1=0:0 S DGPMX1=+$O(^DGPM("ARM",DGPMX,DGPMX1)) D CHK I $T K ^DGPM("ARM",DGPMX,DGPMX1) Q
"RTN","DGPMDDCN",115,0)
 F DGFLD=.1,.101,.102,.103,.104,.1041,.105,.109 I $D(^DPT(DFN,DGFLD)) S DGPMX=^(DGFLD) D KILL
"RTN","DGPMDDCN",116,0)
 ; -- reset data and x-refs
"RTN","DGPMDDCN",117,0)
 D INPTCK
"RTN","DGPMDDCN",118,0)
 I $S('VAWD:1,1:$P(VAWD,"^",2)="") D  G RESETQ
"RTN","DGPMDDCN",119,0)
 . N DGWD
"RTN","DGPMDDCN",120,0)
 . D FIND^DGPMDDLD
"RTN","DGPMDDCN",121,0)
 . I DGWD,($P(DGWD,"^",2)]"") D RESET^DGPMDDLD
"RTN","DGPMDDCN",122,0)
 D SETALL
"RTN","DGPMDDCN",123,0)
RESETQ D KVAR^VADPT30 K DGPMX,DGPMX1,DGFLD,I Q
"RTN","DGPMDDCN",124,0)
 ;
"RTN","DGPMDDCN",125,0)
SETALL D S6,S7,S8,S9,S19,S41 Q
"RTN","DGPMDDCN",126,0)
 ;
"RTN","DGPMDDCN",127,0)
XREF I $D(^DGPM(DA,0)),$P(^(0),"^",2)=4!($P(^(0),"^",2)=5) G XREF^DGPMDDLD
"RTN","DGPMDDCN",128,0)
 Q:$D(DGPMT)
"RTN","DGPMDDCN",129,0)
 I $D(^DGPM(DA,0)) N DFN S DFN=+$P(^(0),U,3) D RESET
"RTN","DGPMDDCN",130,0)
 Q
"RTN","DGPMDDCN",131,0)
 ;
"RTN","DGPMDDCN",132,0)
INPTCK ; check to see if patient is current inpatient
"RTN","DGPMDDCN",133,0)
 D NOW^%DTC S VAPRT=0,VATD=9999999.999999-%,(VACN,VAPRC)=1
"RTN","DGPMDDCN",134,0)
 S VA200="" D VAR^VADPT30 K VA200
"RTN","DGPMDDCN",135,0)
 Q
"VER")
8.0^22.0
"^DD",2,2,.02,0)
SEX^RSa^M:MALE;F:FEMALE;^0;2^Q
"^DD",2,2,.02,1,0)
^.1^^-1
"^DD",2,2,.02,1,1,0)
2^ASX
"^DD",2,2,.02,1,1,1)
S ^DPT("ASX",$E(X,1,30),DA)=""
"^DD",2,2,.02,1,1,2)
K ^DPT("ASX",$E(X,1,30),DA)
"^DD",2,2,.02,1,2,0)
2^AENR02^MUMPS
"^DD",2,2,.02,1,2,1)
D EVENT^IVMPLOG(DA)
"^DD",2,2,.02,1,2,2)
D EVENT^IVMPLOG(DA)
"^DD",2,2,.02,1,2,3)
DO NOT DELETE
"^DD",2,2,.02,1,2,"%D",0)
^^2^2^2971007^^^
"^DD",2,2,.02,1,2,"%D",1,0)
This cross-reference is used to notify HEC of changes that may affect
"^DD",2,2,.02,1,2,"%D",2,0)
enrollment. 
"^DD",2,2,.02,1,2,"DT")
2971007
"^DD",2,2,.02,1,301,0)
2^IVM02^MUMPS
"^DD",2,2,.02,1,301,1)
S IVMX=X,X="IVMPXFR" X ^%ZOSF("TEST") D:$T DPT^IVMPXFR S X=IVMX K IVMX
"^DD",2,2,.02,1,301,2)
S IVMX=X,IVMKILL=2,X="IVMPXFR" X ^%ZOSF("TEST") D:$T DPT^IVMPXFR S X=IVMX K IVMX,IVMKILL
"^DD",2,2,.02,1,301,"%D",0)
^^8^8^2991027^
"^DD",2,2,.02,1,301,"%D",1,0)
This cross-reference will check the IVM PATIENT file to see if a change
"^DD",2,2,.02,1,301,"%D",2,0)
to this field will require transmission to the IVM Center.  If it does,
"^DD",2,2,.02,1,301,"%D",3,0)
the IVM PATIENT file entry's TRANSMISSION STATUS will be set to 0 and
"^DD",2,2,.02,1,301,"%D",4,0)
the nightly background job will transmit the updated information.
"^DD",2,2,.02,1,301,"%D",5,0)
 
"^DD",2,2,.02,1,301,"%D",6,0)
Also, if this field is edited, this cross-reference will check to see if the
"^DD",2,2,.02,1,301,"%D",7,0)
patient requires a financial query to be sent to the IVM Center (Data
"^DD",2,2,.02,1,301,"%D",8,0)
Collection Division (DCD).
"^DD",2,2,.02,1,301,"DT")
2991027
"^DD",2,2,.02,1,991,0)
2^AVAFC02^MUMPS
"^DD",2,2,.02,1,991,1)
I ($T(AVAFC^VAFCDD01)'="") S VAFCF=".02;" D AVAFC^VAFCDD01(DA)
"^DD",2,2,.02,1,991,2)
I ($T(AVAFC^VAFCDD01)'="") S VAFCF=".02;" D AVAFC^VAFCDD01(DA)
"^DD",2,2,.02,1,991,"%D",0)
^^15^15^2990204^^^^
"^DD",2,2,.02,1,991,"%D",1,0)
This cross reference is used to remember that changes were made to the
"^DD",2,2,.02,1,991,"%D",2,0)
PATIENT file (#2) outside of the Registration process.  Execution of this
"^DD",2,2,.02,1,991,"%D",3,0)
cross reference will create an entry in the ADT/HL7 PIVOT file (#391.71)
"^DD",2,2,.02,1,991,"%D",4,0)
and mark it as requiring transmission of an HL7 ADT-A08 message.
"^DD",2,2,.02,1,991,"%D",5,0)
 
"^DD",2,2,.02,1,991,"%D",6,0)
The local variable VAFCFLG will be set to 1 if the cross reference is
"^DD",2,2,.02,1,991,"%D",7,0)
not executed because the change is being made from within the Registration
"^DD",2,2,.02,1,991,"%D",8,0)
process.
"^DD",2,2,.02,1,991,"%D",9,0)
 
"^DD",2,2,.02,1,991,"%D",10,0)
Execution of this cross reference can be prevented by setting the local
"^DD",2,2,.02,1,991,"%D",11,0)
variable VAFCA08 equal to 1.
"^DD",2,2,.02,1,991,"%D",12,0)
  
"^DD",2,2,.02,1,991,"%D",13,0)
The local variable VAFCF is used to identify the field edited.
"^DD",2,2,.02,1,991,"%D",14,0)
This data is stored in the FIELD(S) EDITED (#2.1) field in the 
"^DD",2,2,.02,1,991,"%D",15,0)
ADT/HL7 PIVOT file (#391.71).
"^DD",2,2,.02,1,991,"DT")
2970825
"^DD",2,2,.02,1,992,0)
2^ADGRU02^MUMPS
"^DD",2,2,.02,1,992,1)
D:($T(ADGRU^DGRUDD01)'="") ADGRU^DGRUDD01(DA)
"^DD",2,2,.02,1,992,2)
D:($T(ADGRU^DGRUDD01)'="") ADGRU^DGRUDD01(DA)
"^DD",2,2,.02,1,992,"%D",0)
^^9^9^2990920^
"^DD",2,2,.02,1,992,"%D",1,0)
This cross reference is used to remember that changes were made to a 
"^DD",2,2,.02,1,992,"%D",2,0)
monitored data field in the PATIENT File (#2) required for a vendor
"^DD",2,2,.02,1,992,"%D",3,0)
RAI/MDS COTS system.  Execution of this cross reference will create
"^DD",2,2,.02,1,992,"%D",4,0)
an entry in the ADT/HL7 PIVOT file (#391.71) and mark it as requiring
"^DD",2,2,.02,1,992,"%D",5,0)
transmission of an HL7 demographic A08 update message to the COTS
"^DD",2,2,.02,1,992,"%D",6,0)
interface.
"^DD",2,2,.02,1,992,"%D",7,0)
 
"^DD",2,2,.02,1,992,"%D",8,0)
The local variable DGRUGA08 will be set to 1 if the cross reference is
"^DD",2,2,.02,1,992,"%D",9,0)
not to be executed as part of a re-indexing.
"^DD",2,2,.02,1,992,"DT")
2990920
"^DD",2,2,.02,3)
Enter 'M' for MALE, or 'F' for FEMALE.
"^DD",2,2,.02,20,0)
^.3LA^1^1
"^DD",2,2,.02,20,1,0)
DEMOG^
"^DD",2,2,.02,21,0)
^^1^1^2920721^^^
"^DD",2,2,.02,21,1,0)
Enter 'M' if this applicant is a male, or 'F' if female.
"^DD",2,2,.02,"AUDIT")
y
"^DD",2,2,.02,"DT")
3060624
"^DD",2,2,.097,0)
DATE ENTERED INTO FILE^DI^^0;16^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",2,2,.097,3)
The date this patient record was established in the patient file.
"^DD",2,2,.097,8.5)
^
"^DD",2,2,.097,9)
^
"^DD",2,2,.097,21,0)
^.001^3^3^3080122^^
"^DD",2,2,.097,21,1,0)
This field stores the date this patient was initially stored into the
"^DD",2,2,.097,21,2,0)
PATIENT file.  This is filled in automatically once a patient is
"^DD",2,2,.097,21,3,0)
successfully added to the database.
"^DD",2,2,.097,"DT")
3080122
"^DD",2,2,.104,0)
PROVIDER^*P200'^VA(200,^.104;1^S DIC("S")="I $$SCREEN^DGPMDD(Y,DA,DT)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",2,2,.104,1,0)
^.1
"^DD",2,2,.104,1,1,0)
2^APR
"^DD",2,2,.104,1,1,1)
S ^DPT("APR",$E(X,1,30),DA)=""
"^DD",2,2,.104,1,1,2)
K ^DPT("APR",$E(X,1,30),DA)
"^DD",2,2,.104,3)
The provider currently assigned to this inpatient applicant.
"^DD",2,2,.104,4)
D HELP^DGPMDD(DA,DT)
"^DD",2,2,.104,9)
^
"^DD",2,2,.104,12)
Allow only active providers.
"^DD",2,2,.104,12.1)
S DIC("S")="I $$SCREEN^DGPMDD(Y,DA,DT)"
"^DD",2,2,.104,21,0)
^^2^2^2930330^^^^
"^DD",2,2,.104,21,1,0)
From the available listing select the provider who is currently treating
"^DD",2,2,.104,21,2,0)
this patient.
"^DD",2,2,.104,"DT")
3060624
"^DD",2,2,.14,0)
CURRENT MEANS TEST STATUS^P408.32'I^DG(408.32,^0;14^Q
"^DD",2,2,.14,1,0)
^.1^^-1
"^DD",2,2,.14,1,1,0)
2^ACS
"^DD",2,2,.14,1,1,1)
S ^DPT("ACS",$E(X,1,30),DA)=""
"^DD",2,2,.14,1,1,2)
K ^DPT("ACS",$E(X,1,30),DA)
"^DD",2,2,.14,1,1,"DT")
2911127
"^DD",2,2,.14,3)
This field is computed by the system.  It contains the current means test status for a patient.
"^DD",2,2,.14,21,0)
^^2^2^2931015^^
"^DD",2,2,.14,21,1,0)
This field is computed by the system.  It contains the current
"^DD",2,2,.14,21,2,0)
means test status for a patient.
"^DD",2,2,.14,23,0)
^^4^4^2931015^^
"^DD",2,2,.14,23,1,0)
This field is computed by the system.  It is updated by a mumps
"^DD",2,2,.14,23,2,0)
cross-reference on the 'STATUS' field (#.03) in the Annual Means
"^DD",2,2,.14,23,3,0)
Test file (#408.31).  The current means test status is based on
"^DD",2,2,.14,23,4,0)
the status of the last means test on file for the patient.
"^DD",2,2,.14,"DT")
3060624
"^DD",2,2,.361,0)
PRIMARY ELIGIBILITY CODE^*P8'Xa^DIC(8,^.36;1^S DFN=DA D EV^DGLOCK I $D(X) D ECD^DGLOCK1
"^DD",2,2,.361,.1)

"^DD",2,2,.361,1,0)
^.1^^-1
"^DD",2,2,.361,1,1,0)
2^AG^MUMPS
"^DD",2,2,.361,1,1,1)
S DFN=DA D EN^DGMTR K DGREQF
"^DD",2,2,.361,1,1,2)
Q
"^DD",2,2,.361,1,1,"DT")
2920720
"^DD",2,2,.361,1,2,0)
^^TRIGGER^2.0361^.01
"^DD",2,2,.361,1,2,1)
K DIV S DIV=X,D0=DA,DIV(0)=D0 X ^DD(2,.361,1,2,89.4) S Y(102)=$S($D(^DPT(D0,"E",D1,0)):^(0),1:"") S X=$S('$D(^DIC(8,+$P(Y(102),U,1),0)):"",1:$P(^(0),U,1)) S D0=I(0,0) S D1=I(1,0) S DIU=X K Y S X=DIV S X=DIV,X=X X ^DD(2,.361,1,2,1.4)
"^DD",2,2,.361,1,2,1.4)
S DIH=$S($D(^DPT(DIV(0),"E",DIV(1),0)):^(0),1:""),DIV=X I $D(^(0)) S $P(^(0),U,1)=DIV,DIH=2.0361,DIG=.01 D ^DICR:$O(^DD(DIH,DIG,1,0))>0
"^DD",2,2,.361,1,2,2)
K DIV S DIV=X,D0=DA,DIV(0)=D0 X ^DD(2,.361,1,2,2.2) I DIV(1)>0 S DIK(0)=DA,DIK="^DPT(DIV(0),""E"",",DA(1)=DIV(0),DA=DIV(1) D ^DIK S DA=DIK(0) K DIK
"^DD",2,2,.361,1,2,2.2)
X ^DD(2,.361,1,2,99.3) S X=$S('$D(^DIC(8,+$P(Y(102),U,1),0)):"",1:$P(^(0),U,1)) S D0=I(0,0) S D1=I(1,0) S DIU=X K Y
"^DD",2,2,.361,1,2,3)
This trigger stuffs the ELIGIBILITY CODE into the PATIENT'S ELIGIBILITIES multiple.
"^DD",2,2,.361,1,2,89.2)
S I(0,0)=$S($D(D0):D0,1:""),I(1,0)=$S($D(D1):D1,1:""),Y(2)=$S($D(^DPT(D0,.36)):^(.36),1:"") S X="`",Y(1)=X S X=$P(Y(2),U,1),X=X S Y=X,X=Y(1),X=X S X=X
"^DD",2,2,.361,1,2,89.3)
X ^DD(2,.361,1,2,89.2) S X=X_Y,X=X S X=X
"^DD",2,2,.361,1,2,89.4)
X ^DD(2,.361,1,2,89.3) K DIC S Y=-1,DIC="^DPT(D0,""E"",",DIC(0)="NMFL",DIC("P")="2.0361P",DIU(1)=$S($D(DA(1)):DA(1),1:0),DA(1)=D0 D ^DIC:D0>0 S (D,D1,DIV(1))=+Y,DA(1)=DIU(1)
"^DD",2,2,.361,1,2,99.2)
S I(0,0)=$S($D(D0):D0,1:""),I(1,0)=$S($D(D1):D1,1:""),Y(2)=DIV S X="`",Y(1)=X S X=$P(Y(2),U,1),X=X S Y=X,X=Y(1),X=X S X=X
"^DD",2,2,.361,1,2,99.3)
X ^DD(2,.361,1,2,99.2) S X=X_Y K DIC S Y=-1,DIC="^DPT(D0,""E"",",DIC(0)="NMF" D ^DIC:D0>0 S (D,D1,DIV(1))=+Y S Y(102)=$S($D(^DPT(D0,"E",D1,0)):^(0),1:"")
"^DD",2,2,.361,1,2,"CREATE VALUE")
INTERNAL(ELIGIBILITY CODE)
"^DD",2,2,.361,1,2,"DELETE VALUE")
@
"^DD",2,2,.361,1,2,"DIC")
LOOKUP
"^DD",2,2,.361,1,2,"DIK")
DELETE
"^DD",2,2,.361,1,2,"FIELD")
"`"_INTERNAL(ELIGIBILITY CODE):#361:#.01
"^DD",2,2,.361,1,3,0)
2^AXR28^MUMPS
"^DD",2,2,.361,1,3,1)
Q
"^DD",2,2,.361,1,3,2)
I $S('$D(^DIC(8,+X,0)):0,$P(^(0),"^",1)["DOM":0,'$D(^DPT(DA,.36)):1,'$D(^DIC(8,+^(.36),0)):1,$P(^(0),"^",1)'["DOM":1,1:0) S DGXRF=.361 D ^DGDDC Q
"^DD",2,2,.361,1,3,"%D",0)
^^8^8^2920429^
"^DD",2,2,.361,1,3,"%D",1,0)
When the eligibility code is changed, this cross-reference removes the
"^DD",2,2,.361,1,3,"%D",2,0)
data in the ELIGIBILITY STATUS field.  This only occurs if neither the
"^DD",2,2,.361,1,3,"%D",3,0)
original eligibility code nor the new eligibility code (the one being
"^DD",2,2,.361,1,3,"%D",4,0)
entered) is DOM. PATIENT.  If either is DOM. PATIENT, no update occurs.
"^DD",2,2,.361,1,3,"%D",5,0)
 
"^DD",2,2,.361,1,3,"%D",6,0)
Since the DOM. PATIENT eligibility is being inactivated with MAS 5.2,
"^DD",2,2,.361,1,3,"%D",7,0)
the conditional on this cross-reference will be removed in a future 
"^DD",2,2,.361,1,3,"%D",8,0)
version of MAS.
"^DD",2,2,.361,1,3,"DT")
2920429
"^DD",2,2,.361,1,4,0)
2^AEL^MUMPS
"^DD",2,2,.361,1,4,1)
S ^DPT("AEL",DA,+X)=""
"^DD",2,2,.361,1,4,2)
K ^DPT("AEL",DA,+X)
"^DD",2,2,.361,1,5,0)
2^AENR361^MUMPS
"^DD",2,2,.361,1,5,1)
D AUTOUPD^DGENA2(DA)
"^DD",2,2,.361,1,5,2)
D AUTOUPD^DGENA2(DA)
"^DD",2,2,.361,1,5,3)
DO NOT DELETE
"^DD",2,2,.361,1,5,"%D",0)
^^2^2^2970715^^
"^DD",2,2,.361,1,5,"%D",1,0)
This cross-reference is used to update the patient's current Patient Enrollment 
"^DD",2,2,.361,1,5,"%D",2,0)
record.
"^DD",2,2,.361,1,5,"DT")
2970715
"^DD",2,2,.361,3)
Select from the available list the eligibility code which best defines this applicant's primary entitlement to care.  For more detailed information, enter ??.
"^DD",2,2,.361,12)
Applicable code based on veteran or non-veteran status.
"^DD",2,2,.361,12.1)
S DFN=DA D ECD^DGLOCK1
"^DD",2,2,.361,20,0)
^.3LA^1^1
"^DD",2,2,.361,20,1,0)
ECD
"^DD",2,2,.361,21,0)
^.001^45^45^3060321^^^^
"^DD",2,2,.361,21,1,0)
Select from the available listing the appropriate eligibility code for
"^DD",2,2,.361,21,2,0)
this applicant.  For non-veteran applicants a wide variety of choices
"^DD",2,2,.361,21,3,0)
are available.  For veteran applicants the choices are screened [in the
"^DD",2,2,.361,21,4,0)
following order] dependent on the responses to other prompts:
"^DD",2,2,.361,21,5,0)
   
"^DD",2,2,.361,21,6,0)
1.  If the SERVICE CONNECTED prompt (field .301) is answered YES
"^DD",2,2,.361,21,7,0)
    only the following two choices are available:
"^DD",2,2,.361,21,8,0)
    
"^DD",2,2,.361,21,9,0)
    a.  If the SERVICE CONNECTED PERCENTAGE prompt (field .302) entered
"^DD",2,2,.361,21,10,0)
        is 50% or greater 'SERVICE CONNECTED 50% TO 100%' can be
"^DD",2,2,.361,21,11,0)
        selected.
"^DD",2,2,.361,21,12,0)
   
"^DD",2,2,.361,21,13,0)
    b.  Otherwise, the percentage is assumed to be less than 50% and
"^DD",2,2,.361,21,14,0)
        only 'SC, LESS THAN 50%' may be entered.
"^DD",2,2,.361,21,15,0)
   
"^DD",2,2,.361,21,16,0)
2.  If the response to the WERE YOU A PRISONER OF WAR field (# .525)
"^DD",2,2,.361,21,17,0)
    is YES and the veteran is not service connected, you must select 
"^DD",2,2,.361,21,18,0)
    PRISONER OF WAR as the eligibility code.
"^DD",2,2,.361,21,19,0)
   
"^DD",2,2,.361,21,20,0)
3.  If the response to the CURRENT PH INDICATOR field (#.531) 
"^DD",2,2,.361,21,21,0)
    is YES and the veteran is not service connected and is not a Prisoner
"^DD",2,2,.361,21,22,0)
    of War, you must select PURPLE HEART RECIPIENT as the eligibility code.
"^DD",2,2,.361,21,23,0)
 
"^DD",2,2,.361,21,24,0)
4.  If the veteran is receiving VA benefits, but does not meet the
"^DD",2,2,.361,21,25,0)
    criteria in items 1 and 2 above, then the following choices may
"^DD",2,2,.361,21,26,0)
    be presented for selection:
"^DD",2,2,.361,21,27,0)
 
"^DD",2,2,.361,21,28,0)
    If RECEIVING A&A BENEFITS is answered YES, the eligibility code
"^DD",2,2,.361,21,29,0)
    AID & ATTENDANCE may be selected.
"^DD",2,2,.361,21,30,0)
 
"^DD",2,2,.361,21,31,0)
    If the RECEIVING HOUSEBOUND BENEFITS is answered YES ,the eligibility
"^DD",2,2,.361,21,32,0)
    code HOUSEBOUND may be selected.
"^DD",2,2,.361,21,33,0)
 
"^DD",2,2,.361,21,34,0)
    If the above two prompts were answered NO, but the RECEIVING A VA
"^DD",2,2,.361,21,35,0)
    PENSION prompt was answered YES, only the NSC, VA PENSION prompt
"^DD",2,2,.361,21,36,0)
    may be selected.
"^DD",2,2,.361,21,37,0)
 
"^DD",2,2,.361,21,38,0)
5.  If none of the above pertain to this veteran, then the NSC eligibility
"^DD",2,2,.361,21,39,0)
    will be available for selection.
"^DD",2,2,.361,21,40,0)
 
"^DD",2,2,.361,21,41,0)
**  Dependent on the birthdate of the applicant, the following two
"^DD",2,2,.361,21,42,0)
    eligibility codes may be displayed along with those shown in items
"^DD",2,2,.361,21,43,0)
    3 through 5 above:  WORLD WAR I and MEXICAN BORDER WAR.  These would
"^DD",2,2,.361,21,44,0)
    display for veterans not meeting the criteria in items 1 and 2, but
"^DD",2,2,.361,21,45,0)
    whose date of birth is prior to 1907.
"^DD",2,2,.361,"AUDIT")
y
"^DD",2,2,.361,"DEL",1,0)
S DFN=DA D EV^DGLOCK I '$D(X)
"^DD",2,2,.361,"DT")
3060321
"^DD",2,2,27.01,0)
CURRENT ENROLLMENT^P27.11'I^DGEN(27.11,^ENR;1^Q
"^DD",2,2,27.01,1,0)
^.1
"^DD",2,2,27.01,1,1,0)
2^AENRC^MUMPS
"^DD",2,2,27.01,1,1,1)
D SET1^DGENDD(DA,X)
"^DD",2,2,27.01,1,1,2)
D KILL1^DGENDD(DA)
"^DD",2,2,27.01,1,1,3)
DO NOT DELETE
"^DD",2,2,27.01,1,1,"%D",0)
^^6^6^2970911^^^^
"^DD",2,2,27.01,1,1,"%D",1,0)
This index sorts the patients by their current enrollment status.
"^DD",2,2,27.01,1,1,"%D",2,0)
The ENROLLMENT STATUS field of the PATIENT ENROLLMENT file also triggers
"^DD",2,2,27.01,1,1,"%D",3,0)
this cross-reference.
"^DD",2,2,27.01,1,1,"%D",4,0)

"^DD",2,2,27.01,1,1,"%D",5,0)
The format of the index is:
"^DD",2,2,27.01,1,1,"%D",6,0)
^DPT("AENRC",<current enrollment status>,<DFN>)=""
"^DD",2,2,27.01,1,1,"DT")
2970619
"^DD",2,2,27.01,3)
Enter the patient's current enrollment.
"^DD",2,2,27.01,21,0)
^^1^1^2970520^
"^DD",2,2,27.01,21,1,0)
The patient's current enrollment.
"^DD",2,2,27.01,"DT")
3060624
**END**
**END**
