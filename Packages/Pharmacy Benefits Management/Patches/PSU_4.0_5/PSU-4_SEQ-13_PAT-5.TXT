
=============================================================================
Run Date: JUL 14, 2009                     Designation: PSU*4*5
Package : PSU - PHARMACY BENEFITS MANAGEMENT  Priority: Mandatory
Version : 4        SEQ #13                      Status: Released
                  Compliance Date: AUG 14, 2009
=============================================================================


Subject: PBM EXTRACTS ENHANCEMENT SUPPORT

Category: 
  - Routine
  - Enhancement (Mandatory)
  - Informational

Description:
============

                              I M P O R T A N T
  
 *************************************************************************
  This Pharmacy Benefits Management patch PSU*4*5 along with PSJ*5*161, 
  PSO*7*170 and DG*5.3*671 is being released in a single KIDS software 
  distribution host file, PSU_4_P5.KID as part of the Pharmacy Benefits 
  Management (PBM) Extracts Enhancement #3 project. PSS*1*99 which is 
  also part of this enhancement is being released separately.
  
  Please refer to the "Software Retrieval Instructions" and "Installation 
  Instructions" sections of this patch description for instructions on how 
  to acquire and install the patch software.
  
 *************************************************************************
  
   
        **************** WARNING ON PSJ*5*161 ***************
        *****************************************************
      If your facility has the Pyxis/Omnicell/McKesson interface
      from ILC this patch will overwrite any "local" modifications
      in routine PSGOETO. This could affect certain orders being
      sent across this interface.  The modifications will have to
      be reintroduced following installation of the PSJ*5*161 patch.
        *****************************************************
        *****************************************************  
   
 This patch addresses a request which support the Pharmacy Benefits 
 Management (PBM) Extracts Enhancement #3 project. In order to allow the 
 retransmission of only those patients who have had demographic updates, 
 Pharmacy Benefits Management V. 4.0, Inpatient Medications V. 5.0, 
 Outpatient Pharmacy V. 7.0, Registration V. 5.3 and Pharmacy Data
 Management V. 1.0 were modified to build an entry for re-transmission in
 PBM PATIENT DEMOGRAPHICS File #59.9.
   
 The following issues are addressed in this patch:
 1. The logic in routine PSUHL was corrected so that when an edit is made 
 to the RACE INFORMATION field #2 or ETHNICITY INFORMATION field #6 in 
 the PATIENT File #2, an entry is queued in the PBM PATIENT DEMOGRAPHICS 
 File #59.9. Currently, because of flawed logic when edits are made to 
 either of these two fields, an entry is not queued.
  
 The integration agreement #4803 was added to record the usage of routine 
 PSUHL by other packages. 
   
      
 2. The Automatic Pharmacy Statistics [PSU PBM AUTO] report generated a 
 <SUSBCRIPT> error condition. This error was created when the report was 
 run before any monthly data was filed. Routine PSUHL was modified to quit 
 the FOR loop at line tag CLEANUP when the DAY variable is NULL. 
   
  
 3. Sites reported getting <STORE>SETDPT+9^DPTLK1 errors which was traced 
 to the protocol PSU PATIENT DEMOGRAPHIC CHANGE called by the DG FIELD 
 MONITOR protocol. Line tag LOGDFN was changed to use the DBS call 
 UPDATE^DIE instead of the Fileman call FILE^DICN.
   
     
 4. During internal testing, a problem was discovered with the handling 
 of local data elements in routine PSUHL. The killing of those variables 
 presents the potential for problems later in other areas. This patch 
 corrects the way in which these variables are handled.
   
   
 Associated New Service Request (NSR):
 =====================================
 N/A
  
  
 Associated Remedy Ticket(s):
 ============================
 HD0000000124653 - <STORE>SETDPT+9^DPTLK1
 HD0000000115651 - tasked PSU PBM AUTO did not complete
 HD0000000228928 - <SUBSCRIPT>HL7+8~PSUDEM1
 HD0000000132211 - <STORE>SETDPT+9^DPTLK1 (same as RT 124653)
       
     
 Test Sites:
 ===========
 Hines, IL
 New Jersey HCS
 Oklahoma City, OK
     
  
 Software Retrieval Instructions:
 ================================
 The software for this patch is not being distributed through the National
 Patch Module.  This patch is being distributed as a host file.  The host
 file will contain four (4) KIDS builds.
  
   Host file name: PSU_4_P5.KID
            Build: PSU*4.0*5
                   PSJ*5.0*161
                   PSO*7.0*170
                   DG*5.3*671
  
 Sites may retrieve the host file and documentation in one of the following 
 ways:
  
 (1) The preferred method is to FTP the files from
     download.vista.med.va.gov, which will transmit the files from the
     first available FTP server.
  
 (2) Sites may also elect to retrieve documentation directly from a
     specific server as follows:
  
     Albany          ftp.fo-albany.med.va.gov
     Hines           ftp.fo-hines.med.va.gov
     Salt Lake City  ftp.fo-slc.med.va.gov
  
     The documentation distribution includes:
     FILE NAME                              DESCRIPTION
     --------------------                   -------------------
     PSJ_5_PSO_7_PSU_4_DG_5_3_PSS_1_RN.PDF  Pharmacy Enhancements to Support 
                                            Pharmacy Benefits Management 
                                            Release Notes
   
     PSU_4_TM_R0509.PDF                     Pharmacy Benefits Management V. 4.0
                                            Technical Manual/Security Guide
                                            
     PSU_4_P5_TM_CP.PDF                     Pharmacy Benefits Management V. 4.0
                                            Technical Manual/Security Guide
                                            Change Pages
 
     * Note:  Use Binary mode when transferring the .PDF files.
  
 (3) Once released, documentation may be retrieved from VISTA Documentation
     Library (VDL) on the Internet at the following address,
     http://www.va.gov/vdl
   
        
 Installation Instructions 
 =========================
 If installed during the normal workday, it is recommended that the following
 selection(s) in the OPTION (#19) file, and all of their descendants be 
 disabled to prevent possible conflicts while running the KIDS Install. 
 Other VISTA users will not be affected. 
  
    Register a Patient               [DG REGISTER PATIENT]
    Load/Edit PTF Data               [DG PTF SCREEN]  
    Patient Prescription Processing  [PSO LM BACKDOOR ORDERS]
    Complete Orders from OERR        [PSO LMOE FINISH]
    Automatic Pharmacy Statistics    [PSU PBM AUTO]
      
 Install Time - less than 5 minutes
  
 1.  LOAD TRANSPORT GLOBAL
     ---------------------
     Download the host file PSU_4_P5.KID from one of the OIFO sites.
  
 2.  START UP KIDS
     -------------
     Start up the Kernel Installation and Distribution System Menu [XPD MAIN]:
  
          Edits and Distribution ...
          Utilities ...
          Installation ...
  
     Select Kernel Installation & Distribution System Option: INStallation
                                                              ---
          Load a Distribution
          Print Transport Global
          Compare Transport Global to Current System
          Verify Checksums in Transport Global
          Install Package(s)
          Restart Install of Package(s)
          Unload a Distribution
          Backup a Transport Global
  
     Select Installation Option: LOAD A DISTRIBUTION
                                 -------------------
 3.  Select the LOAD A DISTRIBUTION option on the KIDS INSTALLATION menu, and
     enter: PSU_4_P5.KID
   
 4.  Select Installation Option:
     ---------------------------
     NOTE:  The following are OPTIONAL - (When prompted for the INSTALL NAME,
            enter PSU*4.0*5):
  
     a.  Backup a Transport Global - This option will create a backup
         message of any routines exported with this patch.  It will not
         backup any other changes such as DD's or templates.
     b.  Compare Transport Global to Current System - This option will
         allow you to view all changes that will be made when this patch
         is installed.  It compares all components of this patch
         (routines, DD's, templates, etc.).
     c.  Verify Checksums in Transport Global - This option will allow
         you to ensure the integrity of the routines that are in the
         transport global.
  
 5.  Select Installation Option: Install Package(s)
                                 ------------------
     **This is the step to start the installation of this KIDS patch:
  
     a.  Choose the Install Package(s) option and select the package
         PSU*4.0*5.
     b.  When prompted 'Want KIDS to Rebuild Menu Trees Upon Completion of
         Install? NO//' answer NO.
     c.  When prompted 'Want KIDS to INHIBIT LOGONs during the install?
         YES//' answer NO.
     d.  When prompted 'Want to DISABLE Scheduled Options, Menu
         Options, and Protocols? YES//' answer YES.  When prompted to select
         the Options you would like to place out of order, enter all of the
         Options listed above.
           Register a Patient               [DG REGISTER PATIENT]
           Load/Edit PTF Data               [DG PTF SCREEN]
           Patient Prescription Processing  [PSO LM BACKDOOR ORDERS]
           Complete Orders from OERR        [PSO LMOE FINISH]
           Automatic Pharmacy Statistics    [PSU PBM AUTO]
     e.  When prompted 'Enter protocols you wish to mark as 'Out Of
         Order':' answer YES. Enter the following protocol.
            DG FIELD MONITOR
            PSU PATIENT DEMOGRAPHIC CHANGE
   
     f. When prompted "Delay Install (Minutes):  (0-60): 0//" respond with
        a value between 0 and 60.
    
     g. When prompted, "Device: HOME//" respond with the appropriate device.
    
   
 Install Example:
 ================
 Enter a Host File: _$1$DGA9:[CDEVMAN.CML]PSU_4_P5.KID                           
                                                                                 
 KIDS Distribution saved on Mar 12, 2008@10:41:11                                
 Comment: PBM PATCHES - PSU*4*5, PSJ*5*161, PSO*7*170, DG*5.3*671                
                                                                                 
 This Distribution contains Transport Globals for the following Package(s):      
 Build PSU*4.0*5 has been loaded before, here is when:                           
       PSU*4.0*5   Install Completed                                             
                   was loaded on Jun 02, 2006@12:02:12                           
 OK to continue with Load? NO// YES                                              
                                                                                 
 Build PSJ*5.0*161 has been loaded before, here is when:                         
       PSJ*5.0*161   Install Completed                                           
                     was loaded on Aug 17, 2007@16:00:36                         
       PSJ*5.0*161   Install Completed                                           
                     was loaded on Mar 05, 2008@09:36:56                         
 OK to continue with Load? NO// YES                                              
                                                                                 
 Build PSO*7.0*170 has been loaded before, here is when:                         
       PSO*7.0*170   Install Completed                                           
                     was loaded on Jun 02, 2006@12:03:24                         
 OK to continue with Load? NO// YES                                              
                                                                                 
 Build DG*5.3*671 has been loaded before, here is when:                          
       DG*5.3*671   Install Completed                                            
                    was loaded on Jan 22, 2008@08:50:05                          
       DG*5.3*671   Install Completed                                            
                    was loaded on Mar 11, 2008@12:58:35                          
 OK to continue with Load? NO// YES                                              
                                                                                 
 Distribution OK!                                                                
                                                                                 
 Want to Continue with Load? YES//                                               
 Loading Distribution...                                                         
                                                                                 
    PSU*4.0*5                                                                    
    PSJ*5.0*161                                                                  
    PSO*7.0*170                                                                  
    DG*5.3*671                                                                   
 Use INSTALL NAME: PSU*4.0*5 to install this Distribution.                       
  
                                                                    
 Select INSTALL NAME: PSU*4.0*5       Loaded from Distribution  3/12/08@10:52:31 
      => PBM PATCHES - PSU*4*5, PSJ*5*161, PSO*7*170, DG*5.3*671  ;Created on M  
                                                                                 
 This Distribution was loaded on Mar 12, 2008@10:52:31 with header of            
    PBM PATCHES - PSU*4*5, PSJ*5*161, PSO*7*170, DG*5.3*671  ;Created on Mar 12, 
 2008@10:41:11                                                                   
    It consisted of the following Install(s):                                    
       PSU*4.0*5    PSJ*5.0*161    PSO*7.0*170     DG*5.3*671                    
 Checking Install for Package PSU*4.0*5                                          
                                                                                 
 Install Questions for PSU*4.0*5                                                 
                                                                                 
 Checking Install for Package PSJ*5.0*161                                        
                                                                                 
 Install Questions for PSJ*5.0*161                                               
                                                                                 
 Checking Install for Package PSO*7.0*170                                        
                                                                                 
 Install Questions for PSO*7.0*170                                               
                                                                                 
 Checking Install for Package DG*5.3*671                                         
                                                                                 
 Install Questions for DG*5.3*671                                                
                                                                                 
 Incoming Files:                                                                 
                                                                                 
    2         PATIENT  (Partial Definition)                                      
 Note:  You already have the 'PATIENT' File.                                     
                                                                                 
                                                                                 
 Want KIDS to INHIBIT LOGONs during the install? NO//                            
 Want to DISABLE Scheduled Options, Menu Options, and Protocols? YES//           
                                                                                 
 Enter options you wish to mark as 'Out Of Order': DG REGISTER PATIENT Regi
 ster a Patient                                                                  
                                                                                 
 Enter options you wish to mark as 'Out Of Order': DG PTF SCREEN  Load/Edit 
 PTF Data                                                                        
                                                                                 
 Enter options you wish to mark as 'Out Of Order': PSO LM BACKDOOR ORDERS  P
 atient Prescription Processing                                                  
                                                                                 
 Enter options you wish to mark as 'Out Of Order': PSO LMOE FINISH  Complete
  Orders from OERR                                                               
                                                                                 
 Enter options you wish to mark as 'Out Of Order': PSU PBM AUTO Automatic P
 harmacy Statistics                                                              
                                                                                 
 Enter options you wish to mark as 'Out Of Order':                               
                                                                                 
 Enter protocols you wish to mark as 'Out Of Order': DG FIELD MONITOR  DG Fi
 eld Monitor                                                                     
                                                                                 
 Enter protocols you wish to mark as 'Out Of Order': PSU PATIENT DEMOGRAPHIC 
 CHANGE       PATIENT DEMOGRAPHIC CHANGE     PSUDEM 
                                                                                 
 Enter protocols you wish to mark as 'Out Of Order':                             
                                                                                 
 Delay Install (Minutes):  (0-60): 0//                                           
                                                                                 
 Enter the Device you want to print the Install messages.                        
 You can queue the install by enter a 'Q' at the device prompt.                  
 Enter a '^' to abort the install.                                               
                                                                                 
 DEVICE: HOME//   COMPUTER ROOM                                                  
                                                                                 
 --------------------------------------------------------------------------------
                                                                                 
  Install Started for PSU*4.0*5 :                                                
                Mar 12, 2008@10:58:09                                            
                                                                                 
 Build Distribution Date: Mar 12, 2008                                           
                                                                                 
  Installing Routines:                                                           
                Mar 12, 2008@10:58:10                                            
                                                                                 
  Updating Routine file...                                                       
                                                                                 
  Updating KIDS files...                                                         
                                                                                 
  PSU*4.0*5 Installed.                                                           
                Mar 12, 2008@10:58:10                                            
                                                                                 
  Install Started for PSJ*5.0*161 :                                              
                Mar 12, 2008@10:58:10                                            
                                                                                 
 Build Distribution Date: Mar 12, 2008                                           
                                                                                 
  Installing Routines:                                                           
                Mar 12, 2008@10:58:10                                            
                                                                                 
  Updating Routine file...                                                       
                                                                                 
  Updating KIDS files...                                                         
                                                                                 
  PSJ*5.0*161 Installed.                                                         
                Mar 12, 2008@10:58:10                                            
                                                                                 
  Install Started for PSO*7.0*170 :                                              
                Mar 12, 2008@10:58:10                                            
                                                                                 
 Build Distribution Date: Mar 12, 2008                                           
                                                                                 
  Installing Routines:                                                           
                Mar 12, 2008@10:58:10                                            
                                                                                 
  Updating Routine file...                                                       
                                                                                 
  Updating KIDS files...                                                         
                                                                                 
  PSO*7.0*170 Installed.                                                         
                Mar 12, 2008@10:58:10                                            
                                                                                 
  Install Started for DG*5.3*671 :                                               
                Mar 12, 2008@10:58:10                                            
                                                                                 
 Build Distribution Date: Mar 12, 2008                                           
                                                                                 
  Installing Routines:                                                           
                Mar 12, 2008@10:58:10                                            
                                                                                 
  Installing Data Dictionaries: ....                                             
                Mar 12, 2008@10:58:12                                            
                                                                                 
  Running Post-Install Routine: ^DG53671P                                        
 Recompiling affected input templates ...                                        
 Compiling DVBA C ADD 2507 PAT , compiled routine is DVBAXA ...                  
                                                                                 
 Compiling DVBA C ADD 2507 PAT Input Template of File 2....                      
   
 Compiling DG101 , compiled routine is DGPTX1 ...                                
                                                                                 
 Compiling DG101 Input Template of File 45.............                          
  
 Compiling DVBHINQ UPDATE , compiled routine is DVBHCE ...                       
                                                                                 
 Compiling DVBHINQ UPDATE Input Template of File 2......                         
   
 Compiling IB SCREEN1 , compiled routine is IBXSC1 ...                           
                                                                                 
 Compiling IB SCREEN1 Input Template of File 399...                              
  
 Compiling DGRPT 10-10T REGISTRATION , compiled routine is DGRPTX ...            
                                                                                 
 Compiling DGRPT 10-10T REGISTRATION Input Template of File 2.....               
  
 Compiling SDM1 , compiled routine is SDM1T ...                                  
                                                                                 
 Compiling SDM1 Input Template of File 2....                                     
  
 Compiling DG LOAD EDIT SCREEN 7 , compiled routine is DGRPX7 ...                
                                                                                 
 Compiling DG LOAD EDIT SCREEN 7 Input Template of File 2.......                 
  
 Completed compiling input templates              
                                                                                 
  Updating Routine file...                                                       
                                                                                 
  Updating KIDS files...                                                         
                                                                                 
  DG*5.3*671 Installed.                                                          
                Mar 12, 2008@10:58:15                                            
                                                                                 
                                                                                 
                                    DG*5.3*671                                   
                                                                                 
                                                                                 
 Install Completed 
 
 
 

Routine Information:
====================
The second line of each of these routines now looks like:
 ;;4.0;PHARMACY BENEFITS MANAGEMENT;**[Patch List]**;MARCH, 2005;Build 14

The checksums below are new checksums, and
 can be checked with CHECK1^XTSUMBLD.

Routine Name: PSUHL
    Before:  B6908275   After:  B5015040  **5**

=============================================================================
User Information:
Entered By  : CARROLL,RICHARD               Date Entered  : SEP 23, 2005
Completed By: BANGRAKULUR,KRISHNA           Date Completed: JUN 30, 2009
Released By : HEMBREE,SUSAN                 Date Released : JUL 14, 2009
=============================================================================


Packman Mail Message:
=====================

No routines included
