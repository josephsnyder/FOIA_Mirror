Released EC*2*94 SEQ #88
Extracted from mail message
**KIDS**:EC*2.0*94^

**INSTALL NAME**
EC*2.0*94
"BLD",7361,0)
EC*2.0*94^EVENT CAPTURE^0^3080306^y
"BLD",7361,1,0)
^^1^1^3080306^^^^
"BLD",7361,1,1,0)
This patch provides a fix to several remedy tickets.
"BLD",7361,4,0)
^9.64PA^^
"BLD",7361,6)
1^
"BLD",7361,6.3)
4
"BLD",7361,"KRN",0)
^9.67PA^8989.52^19
"BLD",7361,"KRN",.4,0)
.4
"BLD",7361,"KRN",.401,0)
.401
"BLD",7361,"KRN",.402,0)
.402
"BLD",7361,"KRN",.403,0)
.403
"BLD",7361,"KRN",.5,0)
.5
"BLD",7361,"KRN",.84,0)
.84
"BLD",7361,"KRN",3.6,0)
3.6
"BLD",7361,"KRN",3.8,0)
3.8
"BLD",7361,"KRN",9.2,0)
9.2
"BLD",7361,"KRN",9.8,0)
9.8
"BLD",7361,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",7361,"KRN",9.8,"NM",1,0)
ECRRPT^^0^B40896414
"BLD",7361,"KRN",9.8,"NM",2,0)
ECUURPC^^0^B5686150
"BLD",7361,"KRN",9.8,"NM",3,0)
ECUMRPC1^^0^B62704681
"BLD",7361,"KRN",9.8,"NM","B","ECRRPT",1)

"BLD",7361,"KRN",9.8,"NM","B","ECUMRPC1",3)

"BLD",7361,"KRN",9.8,"NM","B","ECUURPC",2)

"BLD",7361,"KRN",19,0)
19
"BLD",7361,"KRN",19,"NM",0)
^9.68A^^
"BLD",7361,"KRN",19.1,0)
19.1
"BLD",7361,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",7361,"KRN",101,0)
101
"BLD",7361,"KRN",101,"NM",0)
^9.68A^^
"BLD",7361,"KRN",409.61,0)
409.61
"BLD",7361,"KRN",771,0)
771
"BLD",7361,"KRN",870,0)
870
"BLD",7361,"KRN",8989.51,0)
8989.51
"BLD",7361,"KRN",8989.52,0)
8989.52
"BLD",7361,"KRN",8994,0)
8994
"BLD",7361,"KRN","B",.4,.4)

"BLD",7361,"KRN","B",.401,.401)

"BLD",7361,"KRN","B",.402,.402)

"BLD",7361,"KRN","B",.403,.403)

"BLD",7361,"KRN","B",.5,.5)

"BLD",7361,"KRN","B",.84,.84)

"BLD",7361,"KRN","B",3.6,3.6)

"BLD",7361,"KRN","B",3.8,3.8)

"BLD",7361,"KRN","B",9.2,9.2)

"BLD",7361,"KRN","B",9.8,9.8)

"BLD",7361,"KRN","B",19,19)

"BLD",7361,"KRN","B",19.1,19.1)

"BLD",7361,"KRN","B",101,101)

"BLD",7361,"KRN","B",409.61,409.61)

"BLD",7361,"KRN","B",771,771)

"BLD",7361,"KRN","B",870,870)

"BLD",7361,"KRN","B",8989.51,8989.51)

"BLD",7361,"KRN","B",8989.52,8989.52)

"BLD",7361,"KRN","B",8994,8994)

"BLD",7361,"QUES",0)
^9.62^^
"BLD",7361,"REQB",0)
^9.611^3^3
"BLD",7361,"REQB",1,0)
EC*2.0*82^2
"BLD",7361,"REQB",2,0)
EC*2.0*49^2
"BLD",7361,"REQB",3,0)
EC*2.0*72^2
"BLD",7361,"REQB","B","EC*2.0*49",2)

"BLD",7361,"REQB","B","EC*2.0*72",3)

"BLD",7361,"REQB","B","EC*2.0*82",1)

"MBREQ")
0
"PKG",486,-1)
1^1
"PKG",486,0)
EVENT CAPTURE^EC^Event Capture Workload Capture System^
"PKG",486,20,0)
^9.402P^^
"PKG",486,22,0)
^9.49I^1^1
"PKG",486,22,1,0)
2.0^2960508^2981027^66481
"PKG",486,22,1,"PAH",1,0)
94^3080306^123456804
"PKG",486,22,1,"PAH",1,1,0)
^^1^1^3080306
"PKG",486,22,1,"PAH",1,1,1,0)
This patch provides a fix to several remedy tickets.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","ECRRPT")
0^1^B40896414^B40906304
"RTN","ECRRPT",1,0)
ECRRPT ;ALB/JAM;Event Capture Report RPC Broker ;Jan 2, 2001
"RTN","ECRRPT",2,0)
 ;;2.0; EVENT CAPTURE ;**25,32,41,56,61,82,94**;8 May 96;Build 4
"RTN","ECRRPT",3,0)
 ;
"RTN","ECRRPT",4,0)
REQCHK(ECV) ;Required data check
"RTN","ECRRPT",5,0)
 N I,C
"RTN","ECRRPT",6,0)
 S C=1
"RTN","ECRRPT",7,0)
 F I=1:1:$L(ECV,U) I '$D(@$P(ECV,U,I)) D
"RTN","ECRRPT",8,0)
 . S ^TMP("ECMSG",$J,C)="0^Required data missing "_$P(ECV,U,I)
"RTN","ECRRPT",9,0)
 . S C=C+1,ECERR=1
"RTN","ECRRPT",10,0)
 Q
"RTN","ECRRPT",11,0)
DATECHK(ECSD,ECED) ;Check human format date and converts to FileMan format
"RTN","ECRRPT",12,0)
 ;    Input  ECSD  - Start Date (ex. 10/9/01)
"RTN","ECRRPT",13,0)
 ;           ECED  - End Date
"RTN","ECRRPT",14,0)
 N ECI,X,Y
"RTN","ECRRPT",15,0)
 S %DT="X" F ECI="ECSD","ECED" S X=@ECI D ^%DT S @ECI=Y
"RTN","ECRRPT",16,0)
 S ECSD=$S(ECSD=-1:DT,1:ECSD),ECED=$S(ECED=-1:DT,1:ECED)
"RTN","ECRRPT",17,0)
 S ECDATE=$$FMTE^XLFDT(ECSD)_"^"_$$FMTE^XLFDT(ECED)
"RTN","ECRRPT",18,0)
 Q
"RTN","ECRRPT",19,0)
QUEUE ;Queues report to printer
"RTN","ECRRPT",20,0)
 N ZTIO,ZTDESC,ZTRTN,ZTDTH,ZTSAVE,%ZIS,I,IOP,POP
"RTN","ECRRPT",21,0)
 S XNAM=$P($G(^%ZIS(1,ECDEV,0)),U,2)
"RTN","ECRRPT",22,0)
 S IOP="Q;`"_ECDEV,%ZIS="Q" D ^%ZIS I POP D  Q
"RTN","ECRRPT",23,0)
 . ;S IOP="Q;"_XNAM,%ZIS="Q" D ^%ZIS I POP D  Q
"RTN","ECRRPT",24,0)
 . S ^TMP("ECMSG",$J,1)="0^Device selection unsuccessful"
"RTN","ECRRPT",25,0)
 S ZTIO=ION,ZTDESC=ECDESC,ZTRTN=ECROU
"RTN","ECRRPT",26,0)
 S ZTDTH=$$FMTH^XLFDT(ECQDT)
"RTN","ECRRPT",27,0)
 ;D NOW^%DTC S ZTDTH=$S(%'<ECQDT:%+.0002,1:ECQDT)
"RTN","ECRRPT",28,0)
 F I=1:1:$L(ECV,U) I $D(@$P(ECV,U,I)) S ZTSAVE($P(ECV,U,I))=""
"RTN","ECRRPT",29,0)
 M ZTSAVE=ECSAVE
"RTN","ECRRPT",30,0)
 D ^%ZTLOAD,HOME^%ZIS,^%ZISC ;K IO("Q")
"RTN","ECRRPT",31,0)
 I $D(ZTSK) S ^TMP("ECMSG",$J)="1^Report queued. Task #"_ZTSK Q
"RTN","ECRRPT",32,0)
 S ^TMP("ECMSG",$J)="0^Task Rejected"
"RTN","ECRRPT",33,0)
 Q
"RTN","ECRRPT",34,0)
 ;
"RTN","ECRRPT",35,0)
ECPAT ;Patient Summary Report for RPC Call
"RTN","ECRRPT",36,0)
 ;     Variables passed in
"RTN","ECRRPT",37,0)
 ;       ECDFN  - Patient IEN for file #2
"RTN","ECRRPT",38,0)
 ;       ECSD   - Start Date or Report
"RTN","ECRRPT",39,0)
 ;       ECED   - End Date or Report
"RTN","ECRRPT",40,0)
 ;       ECRY   - Print Procedure Reason (optional)
"RTN","ECRRPT",41,0)
 ;
"RTN","ECRRPT",42,0)
 ;     Variable return
"RTN","ECRRPT",43,0)
 ;       ^TMP($J,"ECRPT",n)=report output or to print device.
"RTN","ECRRPT",44,0)
 N ECDATE,ECPAT,ECV,DIC,X,Y,ECROU,ECDESC
"RTN","ECRRPT",45,0)
 S ECV="ECDFN^ECSD^ECED" D REQCHK(ECV) I ECERR Q
"RTN","ECRRPT",46,0)
 S DIC=2,DIC(0)="QNMZX",X=ECDFN D ^DIC Q:Y<0  S ECPAT=$P(Y,U,2)
"RTN","ECRRPT",47,0)
 D DATECHK(.ECSD,.ECED)
"RTN","ECRRPT",48,0)
 S ECSD=ECSD-.0001,ECED=ECED+.9999
"RTN","ECRRPT",49,0)
 I $E($G(ECRY))'="Y" K ECRY
"RTN","ECRRPT",50,0)
 I ECPTYP="P" D  Q
"RTN","ECRRPT",51,0)
 . S ECV="ECDFN^ECPAT^ECDATE^ECSD^ECED^ECRY",ECROU="SUM^ECPAT"
"RTN","ECRRPT",52,0)
 . S ECDESC="EVENT CAPTURE PATIENT SUMMARY"
"RTN","ECRRPT",53,0)
 . D QUEUE
"RTN","ECRRPT",54,0)
 D SUM^ECPAT
"RTN","ECRRPT",55,0)
 Q
"RTN","ECRRPT",56,0)
ECRDSSU ;DSS Unit Workload Summary Report
"RTN","ECRRPT",57,0)
 ;     Variables passed in
"RTN","ECRRPT",58,0)
 ;       ECL    - Location to report (1 or ALL)
"RTN","ECRRPT",59,0)
 ;       ECD    - DSS Unit to report (1, some or ALL)
"RTN","ECRRPT",60,0)
 ;       ECSD   - Start Date or Report
"RTN","ECRRPT",61,0)
 ;       ECED   - End Date or Report
"RTN","ECRRPT",62,0)
 ;       ECDUZ  - User IEN from file (#200)
"RTN","ECRRPT",63,0)
 ;
"RTN","ECRRPT",64,0)
 ;     Variable return
"RTN","ECRRPT",65,0)
 ;       ^TMP($J,"ECRPT",n)=report output or to print device.
"RTN","ECRRPT",66,0)
 N ECLOC,ECDSSU,ECV,ECI,ECSTDT,ECENDDT,ECKEY,ECROU,ECSAVE,ECDESC,ECNT
"RTN","ECRRPT",67,0)
 N ECDATE,ECX,DUZ,DIC,X,Y
"RTN","ECRRPT",68,0)
 S ECV="ECL^ECD0^ECSD^ECED^ECDUZ" D REQCHK(ECV) I ECERR Q
"RTN","ECRRPT",69,0)
 D  I '$D(ECLOC) S ^TMP("ECMSG",$J)="1^Invalid Location." Q
"RTN","ECRRPT",70,0)
 . I ECL="ALL" D LOCARRY^ECRUTL Q
"RTN","ECRRPT",71,0)
 . S DIC=4,DIC(0)="QNZX",X=ECL D ^DIC Q:Y<0  S ECLOC(1)=+Y_"^"_$P(Y,U,2)
"RTN","ECRRPT",72,0)
 D  I '$D(ECDSSU) S ^TMP("ECMSG",$J)="1^Invalid DSS Unit." Q
"RTN","ECRRPT",73,0)
 . I ECD0="ALL" D  Q
"RTN","ECRRPT",74,0)
 . . S ECKEY=$S($D(^XUSEC("ECALLU",ECDUZ)):1,1:0),DUZ=ECDUZ D ALLU^ECRUTL
"RTN","ECRRPT",75,0)
 . S (ECI,ECNT)=0 F ECI=0:1 S ECX="ECD"_ECI Q:'$D(@ECX)  D
"RTN","ECRRPT",76,0)
 . . K DIC S DIC=724,DIC(0)="QNZX",X=@ECX D ^DIC I Y<0 Q
"RTN","ECRRPT",77,0)
 . . S ECNT=ECNT+1,ECDSSU(ECNT)=Y
"RTN","ECRRPT",78,0)
 D DATECHK(.ECSD,.ECED)
"RTN","ECRRPT",79,0)
 S ECSTDT=ECSD-.0001,ECENDDT=ECED+.9999
"RTN","ECRRPT",80,0)
 I ECPTYP="P" D  Q
"RTN","ECRRPT",81,0)
 . S ECV="ECDATE^ECSTDT^ECENDDT",ECROU="STRPT^ECRDSSU"
"RTN","ECRRPT",82,0)
 . S (ECSAVE("ECLOC("),ECSAVE("ECDSSU("))=""
"RTN","ECRRPT",83,0)
 . S ECDESC="DSS UNIT WORKLOAD SUMMARY REPORT"
"RTN","ECRRPT",84,0)
 . D QUEUE
"RTN","ECRRPT",85,0)
 D STRPT^ECRDSSU
"RTN","ECRRPT",86,0)
 Q
"RTN","ECRRPT",87,0)
PROSUM ;Provider (1-3) Summary Report for RPC Call
"RTN","ECRRPT",88,0)
 ;     Variables passed in
"RTN","ECRRPT",89,0)
 ;       ECU    - Provider IEN for file #200
"RTN","ECRRPT",90,0)
 ;       ECSD   - Start Date or Report
"RTN","ECRRPT",91,0)
 ;       ECED   - End Date or Report
"RTN","ECRRPT",92,0)
 ;       ECRY   - Print Procedure Reason (optional)
"RTN","ECRRPT",93,0)
 ;
"RTN","ECRRPT",94,0)
 ;     Variable return
"RTN","ECRRPT",95,0)
 ;       ^TMP($J,"ECRPT",n)=report output or to print device.
"RTN","ECRRPT",96,0)
 N ECV,ECDATE,ECUN,ECROU,ECDESC,DIC,X,Y
"RTN","ECRRPT",97,0)
 S ECV="ECU^ECSD^ECED" D REQCHK(ECV) I ECERR Q
"RTN","ECRRPT",98,0)
 S DIC=200,DIC(0)="QNZX",X=ECU D ^DIC D:Y<0  Q:Y<0  S ECUN=$P(Y,U,2)
"RTN","ECRRPT",99,0)
 . S ^TMP("ECMSG",$J)="1^Invalid Provider."
"RTN","ECRRPT",100,0)
 D DATECHK(.ECSD,.ECED)
"RTN","ECRRPT",101,0)
 I ECRY'="Y" K ECRY
"RTN","ECRRPT",102,0)
 I ECPTYP="P" D  Q
"RTN","ECRRPT",103,0)
 . S ECV="ECU^ECUN^ECDATE^ECSD^ECED^ECRY"
"RTN","ECRRPT",104,0)
 . S ECROU="EN^ECPRSUM1",ECDESC="Event Capture Provider Summary"
"RTN","ECRRPT",105,0)
 . D QUEUE
"RTN","ECRRPT",106,0)
 D EN^ECPRSUM1
"RTN","ECRRPT",107,0)
 Q
"RTN","ECRRPT",108,0)
ECPROV ;Provider Summary Report for RPC Call
"RTN","ECRRPT",109,0)
 ;     Variables passed in
"RTN","ECRRPT",110,0)
 ;       ECL    - Location to report (1 or ALL)
"RTN","ECRRPT",111,0)
 ;       ECD    - DSS Unit to report (1 or ALL)
"RTN","ECRRPT",112,0)
 ;       ECSD   - Start Date or Report
"RTN","ECRRPT",113,0)
 ;       ECED   - End Date or Report
"RTN","ECRRPT",114,0)
 ;       ECRY   - Print Procedure Reason (optional)
"RTN","ECRRPT",115,0)
 ;       ECDUZ  - User DUZ (ien in #200)
"RTN","ECRRPT",116,0)
 ;
"RTN","ECRRPT",117,0)
 ;     Variable return
"RTN","ECRRPT",118,0)
 ;       ^TMP($J,"ECRPT",n)=report output or to print device.
"RTN","ECRRPT",119,0)
 N ECV,ECDN,ECDATE,ECLN,ECSAVE,ECDESC,ECROU,DIC,X,Y,CNT,UNIT
"RTN","ECRRPT",120,0)
 S ECDN="ALL",ECV="ECL^ECD^ECSD^ECED^ECDUZ" D REQCHK(ECV) I ECERR Q
"RTN","ECRRPT",121,0)
 I ECL'="ALL" D  I ECERR Q
"RTN","ECRRPT",122,0)
 . ;The line below was changed by VMP for NOIS ANN-1003-42305
"RTN","ECRRPT",123,0)
 . S DIC=4,DIC(0)="QNZX",X=ECL D ^DIC D:Y<0  Q:Y<0  S ECLN=$P(Y,U,2)
"RTN","ECRRPT",124,0)
 . . S ^TMP("ECMSG",$J)="1^Invalid Location.",ECERR=1
"RTN","ECRRPT",125,0)
 I ECD'="ALL" K DIC D  I ECERR Q
"RTN","ECRRPT",126,0)
 . S DIC=724,DIC(0)="QNMZX",X=ECD D ^DIC D:Y<0  Q:Y<0  S ECDN=$P(Y,U,2)
"RTN","ECRRPT",127,0)
 . . S ^TMP("ECMSG",$J)="1^Invalid Location.",ECERR=1
"RTN","ECRRPT",128,0)
 I ECD="ALL",'$D(^XUSEC("ECALLU",ECDUZ)) D
"RTN","ECRRPT",129,0)
 . S (ECD,ECDN)="SOME",(X,CNT)=0
"RTN","ECRRPT",130,0)
 . F  S X=$O(^VA(200,ECDUZ,"EC",X)) Q:'X  D
"RTN","ECRRPT",131,0)
 . . S CNT=CNT+1,UNIT=$P(^VA(200,ECDUZ,"EC",X,0),"^")
"RTN","ECRRPT",132,0)
 . . S UNIT(CNT)=UNIT_"^"_$P(^ECD(UNIT,0),"^")
"RTN","ECRRPT",133,0)
 I $E($G(ECRY))'="Y" K ECRY
"RTN","ECRRPT",134,0)
 D DATECHK(.ECSD,.ECED)
"RTN","ECRRPT",135,0)
 S ECSD=ECSD-.0001,ECED=ECED+.9999 S:'$D(UNIT) UNIT=""
"RTN","ECRRPT",136,0)
 I ECPTYP="P" D  Q
"RTN","ECRRPT",137,0)
 . S ECV="ECDATE^ECSD^ECED^ECRY",ECROU="START^ECPROV2"
"RTN","ECRRPT",138,0)
 . S (ECSAVE("ECL*"),ECSAVE("ECD*"),ECSAVE("UNIT*"))=""
"RTN","ECRRPT",139,0)
 . S ECDESC="EVENT CAPTURE PROVIDER SUMMARY"
"RTN","ECRRPT",140,0)
 . D QUEUE
"RTN","ECRRPT",141,0)
 U IO D START^ECPROV2
"RTN","ECRRPT",142,0)
 Q
"RTN","ECRRPT",143,0)
ECOSSUM ;Ordering Section Summary Report for RPC Call
"RTN","ECRRPT",144,0)
 ;     Variables passed in
"RTN","ECRRPT",145,0)
 ;       ECOS   - Ordering Section
"RTN","ECRRPT",146,0)
 ;       ECSD   - Start Date or Report
"RTN","ECRRPT",147,0)
 ;       ECED   - End Date or Report
"RTN","ECRRPT",148,0)
 ;       ECL    - Location to report (1 or ALL)
"RTN","ECRRPT",149,0)
 ;       ECD    - DSS Unit to report (1, some or ALL)
"RTN","ECRRPT",150,0)
 ;       ECDUZ  - User ien (#200)
"RTN","ECRRPT",151,0)
 ;
"RTN","ECRRPT",152,0)
 ;     Variable return
"RTN","ECRRPT",153,0)
 ;       ^TMP($J,"ECRPT",n)=report output or to print device.
"RTN","ECRRPT",154,0)
 N ECV,ECI,ECOSN,ECLOC,ECDSSU,ECDATE,ECNT,ECSAVE,ECROU,ECDESC,DUZ,DIC,X,Y
"RTN","ECRRPT",155,0)
 S ECV="ECOS^ECL^ECD0^ECSD^ECED^ECDUZ" D REQCHK(ECV) I ECERR Q
"RTN","ECRRPT",156,0)
 S DIC=723,DIC(0)="QNMZX",X=ECOS D ^DIC D:Y<0  Q:Y<0  S ECOSN=$P(Y,U,2)
"RTN","ECRRPT",157,0)
 . S ^TMP("ECMSG",$J)="1^Invalid Ordering Section.",ECERR=1
"RTN","ECRRPT",158,0)
 D  I '$D(ECLOC) S ^TMP("ECMSG",$J)="1^Invalid Location.",ECERR=1 Q
"RTN","ECRRPT",159,0)
 . K DIC I ECL="ALL" D LOCARRY^ECRUTL Q
"RTN","ECRRPT",160,0)
 . S DIC=4,DIC(0)="QNZX",X=ECL D ^DIC Q:Y<0  S ECLOC(1)=+Y_"^"_$P(Y,U,2)
"RTN","ECRRPT",161,0)
 D  I '$D(ECDSSU) S ^TMP("ECMSG",$J)="1^Invalid DSS Unit." Q
"RTN","ECRRPT",162,0)
 . I ECD0="ALL" D  Q
"RTN","ECRRPT",163,0)
 . . S ECKEY=$S($D(^XUSEC("ECALLU",ECDUZ)):1,1:0),DUZ=ECDUZ D ALLU^ECRUTL
"RTN","ECRRPT",164,0)
 . S (ECI,ECNT)=0 F ECI=0:1 S ECX="ECD"_ECI Q:'$D(@ECX)  D
"RTN","ECRRPT",165,0)
 . . K DIC S DIC=724,DIC(0)="QNMZX",X=@ECX D ^DIC I Y<0 Q
"RTN","ECRRPT",166,0)
 . . S ECNT=ECNT+1,ECDSSU(ECNT)=Y
"RTN","ECRRPT",167,0)
 D DATECHK(.ECSD,.ECED)
"RTN","ECRRPT",168,0)
 S ECSD=ECSD-.0001,ECED=ECED+.9999
"RTN","ECRRPT",169,0)
 I ECPTYP="P" D  Q
"RTN","ECRRPT",170,0)
 . S ECV="ECOS^ECSD^ECED^ECOSN",ECROU="START^ECOSSUM"
"RTN","ECRRPT",171,0)
 . S (ECSAVE("ECLOC("),ECSAVE("ECDSSU("))=""
"RTN","ECRRPT",172,0)
 . S ECDESC="EC Ordering Section Summary"
"RTN","ECRRPT",173,0)
 . D QUEUE
"RTN","ECRRPT",174,0)
 D START^ECOSSUM
"RTN","ECRRPT",175,0)
 Q
"RTN","ECRRPT",176,0)
ECPCER ;PCE Data Summary Report for RPC Call
"RTN","ECRRPT",177,0)
 ;     Variables passed in
"RTN","ECRRPT",178,0)
 ;       ECDFN  - Patient IEN for file #2
"RTN","ECRRPT",179,0)
 ;       ECSD   - Start Date or Report
"RTN","ECRRPT",180,0)
 ;       ECED   - End Date or Report
"RTN","ECRRPT",181,0)
 ;
"RTN","ECRRPT",182,0)
 ;     Variable return
"RTN","ECRRPT",183,0)
 ;       ^TMP($J,"ECRPT",n)=report output or to print device.
"RTN","ECRRPT",184,0)
 N ECV,ECDATE,ECPAT,ECROU,ECDESC,X,DIC,Y
"RTN","ECRRPT",185,0)
 S ECV="ECDFN^ECSD^ECED" D REQCHK(ECV) I ECERR Q
"RTN","ECRRPT",186,0)
 S DIC=2,DIC(0)="QNMZX",X=ECDFN D ^DIC D:Y<0  Q:Y<0  S ECPAT=$P(Y,U,2)
"RTN","ECRRPT",187,0)
 . S ^TMP("ECMSG",$J)="1^Invalid Provider."
"RTN","ECRRPT",188,0)
 D DATECHK(.ECSD,.ECED)
"RTN","ECRRPT",189,0)
 S ECSD=ECSD-.0001,ECED=ECED+.9999
"RTN","ECRRPT",190,0)
 I ECPTYP="P" D  Q
"RTN","ECRRPT",191,0)
 . S ECV="ECDFN^ECPAT^ECDATE^ECSD^ECED",ECROU="SUM^ECPCER"
"RTN","ECRRPT",192,0)
 . S ECDESC="ECS/PCE PATIENT SUMMARY"
"RTN","ECRRPT",193,0)
 . D QUEUE
"RTN","ECRRPT",194,0)
 D SUM^ECPCER
"RTN","ECRRPT",195,0)
 Q
"RTN","ECUMRPC1")
0^3^B62704681^B61789202
"RTN","ECUMRPC1",1,0)
ECUMRPC1 ;ALB/JAM-Event Capture Management Broker Utilities ;28 Nov 00
"RTN","ECUMRPC1",2,0)
 ;;2.0; EVENT CAPTURE ;**25,30,33,72,94**;8 May 96;Build 4
"RTN","ECUMRPC1",3,0)
 ;
"RTN","ECUMRPC1",4,0)
DSSUNT(RESULTS,ECARY) ;
"RTN","ECUMRPC1",5,0)
 ;
"RTN","ECUMRPC1",6,0)
 ;This broker entry point returns DSS units from file 724
"RTN","ECUMRPC1",7,0)
 ;        RPC: EC GETDSSUNIT
"RTN","ECUMRPC1",8,0)
 ;INPUTS         ECARY - Contains the following subscripted elements
"RTN","ECUMRPC1",9,0)
 ;               STAT   - Active or inactive DSS Units (optional)
"RTN","ECUMRPC1",10,0)
 ;               A-ctive (default), I-nactive, B-oth
"RTN","ECUMRPC1",11,0)
 ;
"RTN","ECUMRPC1",12,0)
 ;OUTPUTS        RESULTS - Array of DSS units. Data pieces as follows:-
"RTN","ECUMRPC1",13,0)
 ;               PIECE - Description
"RTN","ECUMRPC1",14,0)
 ;                 1     IEN of DSS Unit
"RTN","ECUMRPC1",15,0)
 ;                 2     Name of DSS Unit
"RTN","ECUMRPC1",16,0)
 ;                 3     Service
"RTN","ECUMRPC1",17,0)
 ;                 4     Medical Specialty
"RTN","ECUMRPC1",18,0)
 ;                 5     Cost Center
"RTN","ECUMRPC1",19,0)
 ;                 6     Unit Number
"RTN","ECUMRPC1",20,0)
 ;                 7     Inactive Flag
"RTN","ECUMRPC1",21,0)
 ;                 8     Associated Stop code (if not sending to PCE)
"RTN","ECUMRPC1",22,0)
 ;                 9     Category flag
"RTN","ECUMRPC1",23,0)
 ;                 10    Default date entry
"RTN","ECUMRPC1",24,0)
 ;                 11    Send to PCE Flag
"RTN","ECUMRPC1",25,0)
 ;
"RTN","ECUMRPC1",26,0)
 N UNT,STAT,CNT,CAT,NODE,ECS,STR,SRV,MED,CST,UNO,INACT,ASC,PCE,ACT,NODE
"RTN","ECUMRPC1",27,0)
 N DFD
"RTN","ECUMRPC1",28,0)
 D SETENV^ECUMRPC
"RTN","ECUMRPC1",29,0)
 K ^TMP($J,"ECDSSUNT")
"RTN","ECUMRPC1",30,0)
 S STAT=$P($G(ECARY),U),(CNT,UNT)=0 S:STAT="" STAT="A"
"RTN","ECUMRPC1",31,0)
 F  S UNT=$O(^ECD(UNT)) Q:'UNT  S NODE=$G(^ECD(UNT,0)) I NODE'="" D
"RTN","ECUMRPC1",32,0)
 . S ECS=$P(NODE,U,8),ACT=$P(NODE,U,6),ACT=$S(ACT:1,1:0)
"RTN","ECUMRPC1",33,0)
 . Q:'ECS  I $S(STAT="A"&(ACT):1,STAT="I"&('ACT):1,1:0) Q
"RTN","ECUMRPC1",34,0)
 . S CNT=CNT+1,CAT=$P(NODE,U,11),CAT=$S(CAT:"Y",1:"N"),UNO=$P(NODE,U,5)
"RTN","ECUMRPC1",35,0)
 . S SRV=$$GET1^DIQ(49,$P(NODE,U,2),.01,"I")
"RTN","ECUMRPC1",36,0)
 . S MED=$$GET1^DIQ(723,$P(NODE,U,3),.01,"I")
"RTN","ECUMRPC1",37,0)
 . S CST=$$GET1^DIQ(420.1,$P(NODE,U,4),.01,"I")
"RTN","ECUMRPC1",38,0)
 . S INACT=$P(NODE,U,6),INACT=$S(INACT:"I",1:"A"),ASC=$P(NODE,U,10)
"RTN","ECUMRPC1",39,0)
 . S:ASC ASC=$$GET1^DIQ(40.7,ASC,.01,"I")
"RTN","ECUMRPC1",40,0)
 . S DFD=$S($P(NODE,U,12)="N":"N",1:"X"),PCE=$P(NODE,U,14)
"RTN","ECUMRPC1",41,0)
 . S PCE=$S(PCE="A":PCE,PCE="O":PCE,1:"N")
"RTN","ECUMRPC1",42,0)
 . S STR=UNT_U_$P(NODE,U)_U_SRV_U_MED_U_CST_U_UNO_U_INACT_U_ASC_U_CAT
"RTN","ECUMRPC1",43,0)
 . S STR=STR_U_DFD_U_PCE,^TMP($J,"ECDSSUNT",CNT)=STR
"RTN","ECUMRPC1",44,0)
 S RESULTS=$NA(^TMP($J,"ECDSSUNT"))
"RTN","ECUMRPC1",45,0)
 Q
"RTN","ECUMRPC1",46,0)
CAT(RESULTS,ECARY) ;
"RTN","ECUMRPC1",47,0)
 ;
"RTN","ECUMRPC1",48,0)
 ;This broker entry point returns a list of categories from file 726
"RTN","ECUMRPC1",49,0)
 ;        RPC: EC GETCAT
"RTN","ECUMRPC1",50,0)
 ;INPUTS         ECARY - Contains the following subscripted elements
"RTN","ECUMRPC1",51,0)
 ;                STAT - Active or inactive category (optional)
"RTN","ECUMRPC1",52,0)
 ;                A-ctive (default), I-nactive, B-oth
"RTN","ECUMRPC1",53,0)
 ;
"RTN","ECUMRPC1",54,0)
 ;OUTPUTS        RESULTS - Array of category. Data pieces as follows:-
"RTN","ECUMRPC1",55,0)
 ;               PIECE - Description
"RTN","ECUMRPC1",56,0)
 ;                 1     IEN of Category
"RTN","ECUMRPC1",57,0)
 ;                 2     Name of Category
"RTN","ECUMRPC1",58,0)
 ;                 3     Creation Date
"RTN","ECUMRPC1",59,0)
 ;                 4     Inactive Date
"RTN","ECUMRPC1",60,0)
 ;
"RTN","ECUMRPC1",61,0)
 N STAT,CNT,CAT,NODE,ECDT,INDT,CRDT
"RTN","ECUMRPC1",62,0)
 D SETENV^ECUMRPC
"RTN","ECUMRPC1",63,0)
 K ^TMP($J,"ECCAT")
"RTN","ECUMRPC1",64,0)
 S STAT=$P($G(ECARY),U),(CNT,CAT)=0 S:STAT="" STAT="A"
"RTN","ECUMRPC1",65,0)
 F  S CAT=$O(^EC(726,CAT)) Q:'CAT  S NODE=$G(^EC(726,CAT,0)) I NODE'="" D
"RTN","ECUMRPC1",66,0)
 . S ECDT=$P(NODE,U,3)
"RTN","ECUMRPC1",67,0)
 . I STAT="A",ECDT'="",ECDT'>DT Q
"RTN","ECUMRPC1",68,0)
 . I STAT="I",ECDT="" Q
"RTN","ECUMRPC1",69,0)
 . S CRDT=$$FMTE^XLFDT($P(NODE,U,2),"2F")
"RTN","ECUMRPC1",70,0)
 . S INDT=$$FMTE^XLFDT($P(NODE,U,3),"2F")
"RTN","ECUMRPC1",71,0)
 . ;S CNT=CNT+1,^TMP($J,"ECCAT",CNT)=CAT_U_$P(NODE,U)_U_CRDT_U_INDT
"RTN","ECUMRPC1",72,0)
 . S CNT=CNT+1,^TMP($J,"ECCAT",CNT)=CAT_U_$P(NODE,U)_U_$P(CRDT,"@",1)_U_$P(INDT,"@",1)
"RTN","ECUMRPC1",73,0)
 S RESULTS=$NA(^TMP($J,"ECCAT"))
"RTN","ECUMRPC1",74,0)
 Q
"RTN","ECUMRPC1",75,0)
 ;
"RTN","ECUMRPC1",76,0)
CATCHK(RESULTS,ECARY) ;
"RTN","ECUMRPC1",77,0)
 ;
"RTN","ECUMRPC1",78,0)
 ;Broker call checks whether category is used in an Event Code Screen.
"RTN","ECUMRPC1",79,0)
 ;        RPC: EC DSSCATCHECK
"RTN","ECUMRPC1",80,0)
 ;INPUTS   ECARY  - Contains the following subscripted elements
"RTN","ECUMRPC1",81,0)
 ;          ECDA  - DSS Unit ien (file #724)
"RTN","ECUMRPC1",82,0)
 ;
"RTN","ECUMRPC1",83,0)
 ;OUTPUTS  RESULTS - Category used in Event Code Screen, 1-Yes or 0-No
"RTN","ECUMRPC1",84,0)
 ;
"RTN","ECUMRPC1",85,0)
 N ECDA,ECFLG,ECX
"RTN","ECUMRPC1",86,0)
 D SETENV^ECUMRPC
"RTN","ECUMRPC1",87,0)
 S ECDA=$P(ECARY,U) I ECDA="" Q
"RTN","ECUMRPC1",88,0)
 S (ECFLG,ECX)=0
"RTN","ECUMRPC1",89,0)
 F  S ECX=$O(^ECJ("AP",ECX)) Q:'ECX!(ECFLG)  D
"RTN","ECUMRPC1",90,0)
 . I $D(^ECJ("AP",ECX,ECDA)) S ECFLG=1
"RTN","ECUMRPC1",91,0)
 S RESULTS=ECFLG
"RTN","ECUMRPC1",92,0)
 Q
"RTN","ECUMRPC1",93,0)
PXCHK(RESULTS,ECARY) ;
"RTN","ECUMRPC1",94,0)
 ;
"RTN","ECUMRPC1",95,0)
 ;Checks whether procedure description or national number exist
"RTN","ECUMRPC1",96,0)
 ;INPUTS   ECARY  - Contains the following subscripted elements
"RTN","ECUMRPC1",97,0)
 ;          ECP - Procedure description
"RTN","ECUMRPC1",98,0)
 ;          ECN - EC National Number
"RTN","ECUMRPC1",99,0)
 ;
"RTN","ECUMRPC1",100,0)
 ;OUTPUTS  RESULTS - Px used^National # used, 1-Yes or 0-No ex. 1^0
"RTN","ECUMRPC1",101,0)
 ;
"RTN","ECUMRPC1",102,0)
 N ECX,ECP,ECN
"RTN","ECUMRPC1",103,0)
 Q:$G(ECARY)
"RTN","ECUMRPC1",104,0)
 D SETENV^ECUMRPC
"RTN","ECUMRPC1",105,0)
 S ECP=$P(ECARY,U),ECN=$P(ECARY,U,2),RESULTS="0^0"
"RTN","ECUMRPC1",106,0)
 I ECP'="",$D(^EC(725,"B",ECP)) S $P(RESULTS,U)=1
"RTN","ECUMRPC1",107,0)
 I ECN'="" F ECX="E","D","DL" D  I $P(RESULTS,U,2) Q
"RTN","ECUMRPC1",108,0)
 . I $D(^EC(725,ECX,ECN)) S $P(RESULTS,U,2)=1
"RTN","ECUMRPC1",109,0)
 Q
"RTN","ECUMRPC1",110,0)
SRCLST(RESULTS,ECARY) ;
"RTN","ECUMRPC1",111,0)
 ;
"RTN","ECUMRPC1",112,0)
 ;This broker entry returns an array of codes from a file based on a 
"RTN","ECUMRPC1",113,0)
 ;search string.
"RTN","ECUMRPC1",114,0)
 ;        RPC: EC GETLIST
"RTN","ECUMRPC1",115,0)
 ;
"RTN","ECUMRPC1",116,0)
 ;INPUTS      ECARY   - Contains the following subscripted elements
"RTN","ECUMRPC1",117,0)
 ;             ECSTR  - Search string
"RTN","ECUMRPC1",118,0)
 ;             ECFIL  - File to search
"RTN","ECUMRPC1",119,0)
 ;             ECDIR  - Search order
"RTN","ECUMRPC1",120,0)
 ;
"RTN","ECUMRPC1",121,0)
 ;OUTPUTS     RESULTS - Array of values based on the search criteria.
"RTN","ECUMRPC1",122,0)
 ;
"RTN","ECUMRPC1",123,0)
 N ECNT,DIC,ECSTR,ECFIL,ECORD,ECER,ECDI
"RTN","ECUMRPC1",124,0)
 D SETENV^ECUMRPC
"RTN","ECUMRPC1",125,0)
 S ECNT=0,ECFIL=$P(ECARY,U),ECSTR=$P(ECARY,U,2),ECDIR=$P(ECARY,U,3)
"RTN","ECUMRPC1",126,0)
 S ECORD=$S(ECDIR=-1:"B",1:"I")
"RTN","ECUMRPC1",127,0)
 K ^TMP($J,"ECFIND"),^TMP("ECSRCH",$J)
"RTN","ECUMRPC1",128,0)
 I ECFIL="" Q
"RTN","ECUMRPC1",129,0)
 S ECNUM=44
"RTN","ECUMRPC1",130,0)
 I ECFIL=420.1 D CSTCTR            ;Cost Center search
"RTN","ECUMRPC1",131,0)
 I ECFIL=49 D SERVC                ;Service search
"RTN","ECUMRPC1",132,0)
 I ECFIL=723 D MEDSPC              ;Medical specialty
"RTN","ECUMRPC1",133,0)
 I ECFIL=40.7 D STPCDE G EXIT      ;Associated stop code
"RTN","ECUMRPC1",134,0)
 I ECFIL=724 D DUNT G EXIT         ;DSS Unit
"RTN","ECUMRPC1",135,0)
 I ECFIL=726 D ECAT                ;Category
"RTN","ECUMRPC1",136,0)
 I ECFIL=4 D LOC                   ;Location
"RTN","ECUMRPC1",137,0)
 I ECFIL=44 D ASCLN G EXIT         ;Associated clinic
"RTN","ECUMRPC1",138,0)
 I ECFIL=757.01 D LEX^ECUMRPC2 G EXIT  ;Lex ICD code
"RTN","ECUMRPC1",139,0)
 I ECFIL=200 D PROV^ECUMRPC2      ;Providers
"RTN","ECUMRPC1",140,0)
 I $D(ECER) S ^TMP($J,"ECFIND",1)="0^Error occurred during search" G EXIT
"RTN","ECUMRPC1",141,0)
 D SORT
"RTN","ECUMRPC1",142,0)
EXIT K ^TMP("ECSRCH",$J)
"RTN","ECUMRPC1",143,0)
 S RESULTS=$NA(^TMP($J,"ECFIND"))
"RTN","ECUMRPC1",144,0)
 Q
"RTN","ECUMRPC1",145,0)
ASCLN ;Search for active associated clinics (file #44)
"RTN","ECUMRPC1",146,0)
 N CNT,NOD,ECDT,INACT,REACT,ERR
"RTN","ECUMRPC1",147,0)
 S CNT=0,ECDT=DT
"RTN","ECUMRPC1",148,0)
 F  Q:CNT=ECNUM  S ECSTR=$O(^SC("B",ECSTR),ECDIR) Q:ECSTR=""  S CLN="" D
"RTN","ECUMRPC1",149,0)
 .F  S CLN=$O(^SC("B",ECSTR,CLN),ECDIR) Q:CLN=""  S NOD=$G(^SC(CLN,0)) D
"RTN","ECUMRPC1",150,0)
 ..Q:NOD=""  Q:$P(NOD,U,3)'="C"  ;Q:+$G(^SC(CLN,"OOS"))
"RTN","ECUMRPC1",151,0)
 ..S ERR=0 I $D(^SC(CLN,"I")) D  I ERR Q
"RTN","ECUMRPC1",152,0)
 ...S INACT=$P(^SC(CLN,"I"),U),REACT=$P(^SC(CLN,"I"),U,2)
"RTN","ECUMRPC1",153,0)
 ...I INACT D  I ERR Q
"RTN","ECUMRPC1",154,0)
 ....I REACT="" S:ECDT'<INACT ERR=1 Q
"RTN","ECUMRPC1",155,0)
 ....I ECDT'<INACT,ECDT<REACT S ERR=1 Q
"RTN","ECUMRPC1",156,0)
 ...I REACT,ECDT<REACT S ERR=1
"RTN","ECUMRPC1",157,0)
 ..S CNT=CNT+1,^TMP($J,"ECFIND",CNT)=CLN_U_$P(NOD,U)
"RTN","ECUMRPC1",158,0)
 Q
"RTN","ECUMRPC1",159,0)
CSTCTR ;Search for cost centers (File #420.1)
"RTN","ECUMRPC1",160,0)
 N ECNULL,INDX,STR,NSTR,I
"RTN","ECUMRPC1",161,0)
 S $P(ECNULL," ",7)=" ",INDX="B"
"RTN","ECUMRPC1",162,0)
 I $E(ECSTR)?.N,$L(ECSTR)<7 S ECSTR=ECSTR_$E(ECNULL,1,7-$L(ECSTR))
"RTN","ECUMRPC1",163,0)
 I $L($P(ECSTR," "))=6,$P(ECSTR," ",2)?.A D   ;truncate for x-ref
"RTN","ECUMRPC1",164,0)
 . S ECSTR=$P(ECSTR," ")_" "_$E($P(ECSTR," ",2,999),1,22)
"RTN","ECUMRPC1",165,0)
 I $E(ECSTR)?.A S INDX="C",(STR,NSTR)="" D  S ECSTR=NSTR
"RTN","ECUMRPC1",166,0)
 .F I=1:1 S STR=$P(ECSTR," ",I) Q:STR=""  D
"RTN","ECUMRPC1",167,0)
 ..S STR=$E(STR)_$TR($E(STR,2,9999),"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz")
"RTN","ECUMRPC1",168,0)
 ..S NSTR=NSTR_STR
"RTN","ECUMRPC1",169,0)
 D LISTDIC(ECFIL,"",.01,ECORD,ECNUM,ECSTR,"",INDX,"I '$P(^(0),U,2)","","^TMP(""ECSRCH"",$J)","ECER")
"RTN","ECUMRPC1",170,0)
 Q
"RTN","ECUMRPC1",171,0)
SERVC ;Search for services (File #49)
"RTN","ECUMRPC1",172,0)
 D LISTDIC(ECFIL,"",.01,ECORD,ECNUM,ECSTR,"","","","","^TMP(""ECSRCH"",$J)","ECER")
"RTN","ECUMRPC1",173,0)
 Q
"RTN","ECUMRPC1",174,0)
MEDSPC ;Search for medical specialty (File #723)
"RTN","ECUMRPC1",175,0)
 D LISTDIC(ECFIL,"",.01,ECORD,ECNUM,ECSTR,"","","","","^TMP(""ECSRCH"",$J)","ECER")
"RTN","ECUMRPC1",176,0)
 Q
"RTN","ECUMRPC1",177,0)
STPCDE ;Search for associated stop code (File #40.7)
"RTN","ECUMRPC1",178,0)
 N ECNT,INDX,ECNUL,STR,IEN
"RTN","ECUMRPC1",179,0)
 S $P(ECNUL,"  ",30)=" ",INDX="B",ECNT=0,ECSTR=$P(ECSTR,"~")
"RTN","ECUMRPC1",180,0)
 I +ECSTR,+ECSTR?.N S INDX="C",IEN=0 D  Q
"RTN","ECUMRPC1",181,0)
 .S ECSTR=$O(^DIC(40.7,INDX,+ECSTR)) I ECSTR="" Q
"RTN","ECUMRPC1",182,0)
 .F  S IEN=$O(^DIC(40.7,INDX,ECSTR,IEN)) Q:'IEN  D  I ECNT>(ECNUM-1) Q
"RTN","ECUMRPC1",183,0)
 ..S STR=$G(^DIC(40.7,IEN,0)) I (STR="")!($P(STR,U,3)'="") Q
"RTN","ECUMRPC1",184,0)
 ..S STR=$E($P(STR,U),1,30)_"  ["_$J($P(STR,U,2),3,0)_"]"_U_$P(STR,U,2)_U_IEN
"RTN","ECUMRPC1",185,0)
 ..S ECNT=ECNT+1,^TMP($J,"ECFIND",ECNT)=STR
"RTN","ECUMRPC1",186,0)
 D LISTDIC(ECFIL,"",".01;1",ECORD,ECNUM,ECSTR,"",INDX,"I $P(^(0),""^"",3)=""""!($P(^(0),U,3)'<DT)","","^TMP(""ECSRCH"",$J)","ECER")
"RTN","ECUMRPC1",187,0)
 S ECNT=0
"RTN","ECUMRPC1",188,0)
 F  S ECNT=$O(^TMP("ECSRCH",$J,"DILIST","ID",ECNT)) Q:'ECNT  D
"RTN","ECUMRPC1",189,0)
 .S STR=$G(^TMP("ECSRCH",$J,"DILIST","ID",ECNT,.01))_U_$G(^(1))
"RTN","ECUMRPC1",190,0)
 .S STR=$E($P(STR,U),1,30)_"  ["_$J($P(STR,U,2),3,0)_"]"_U_$P(STR,U,2)
"RTN","ECUMRPC1",191,0)
 .S ^TMP($J,"ECFIND",ECNT)=STR_U_^TMP("ECSRCH",$J,"DILIST",2,ECNT)
"RTN","ECUMRPC1",192,0)
 Q
"RTN","ECUMRPC1",193,0)
DUNT ;Search for DSS unit (File #724)
"RTN","ECUMRPC1",194,0)
 N ECNT,SNDPCE
"RTN","ECUMRPC1",195,0)
 D LISTDIC(ECFIL,"",".01;10;13",ECORD,ECNUM,ECSTR,"","","I '$P(^(0),""^"",6),$P(^(0),U,8)","","^TMP(""ECSRCH"",$J)","ECER")
"RTN","ECUMRPC1",196,0)
 S ECNT=0
"RTN","ECUMRPC1",197,0)
 F  S ECNT=$O(^TMP("ECSRCH",$J,"DILIST","ID",ECNT)) Q:'ECNT  D
"RTN","ECUMRPC1",198,0)
 .S SNDPCE=$G(^TMP("ECSRCH",$J,"DILIST","ID",ECNT,13))
"RTN","ECUMRPC1",199,0)
 .S SNDPCE=$S(SNDPCE="O":1,SNDPCE="A":1,1:0)
"RTN","ECUMRPC1",200,0)
 .S ^TMP($J,"ECFIND",ECNT)=$G(^TMP("ECSRCH",$J,"DILIST","ID",ECNT,.01))_U_^TMP("ECSRCH",$J,"DILIST",2,ECNT)_U_$G(^TMP("ECSRCH",$J,"DILIST","ID",ECNT,10))_U_SNDPCE
"RTN","ECUMRPC1",201,0)
 Q
"RTN","ECUMRPC1",202,0)
ECAT ;Search for Category (File #726)
"RTN","ECUMRPC1",203,0)
 D LISTDIC(ECFIL,"",.01,ECORD,ECNUM,ECSTR,"","","I $P(^(0),""^"",3)=""""!($P(^(0),U,3)>DT)","","^TMP(""ECSRCH"",$J)","ECER")
"RTN","ECUMRPC1",204,0)
 Q
"RTN","ECUMRPC1",205,0)
LOC ;Search for Location (File #4)
"RTN","ECUMRPC1",206,0)
 D LISTDIC(ECFIL,"",.01,ECORD,ECNUM,ECSTR,"","","I $G(^(""EC""))","","^TMP(""ECSRCH"",$J)","ECER")
"RTN","ECUMRPC1",207,0)
 Q
"RTN","ECUMRPC1",208,0)
LISTDIC(ECFL,ECIEN,ECFLD,ECFLG,ECNUM,ECFRM,ECPRT,ECINDX,ECSCN,ECIND,ECTG,ECER) ;
"RTN","ECUMRPC1",209,0)
 ;Produces a list of records in a file base on search string
"RTN","ECUMRPC1",210,0)
 N DIC
"RTN","ECUMRPC1",211,0)
 D LIST^DIC(ECFL,ECIEN,ECFLD,ECFLG,ECNUM,ECFRM,ECPRT,ECINDX,ECSCN,ECIND,ECTG,ECER)
"RTN","ECUMRPC1",212,0)
 K ECFL,ECIEN,ECFLD,ECFLG,ECNUM,ECFRM,ECPRT,ECINDX,ECSCN,ECID
"RTN","ECUMRPC1",213,0)
 Q
"RTN","ECUMRPC1",214,0)
SORT ;Extracts data to be returned to broker
"RTN","ECUMRPC1",215,0)
 N ECNT,STR
"RTN","ECUMRPC1",216,0)
 S ECNT=0
"RTN","ECUMRPC1",217,0)
 F  S ECNT=$O(^TMP("ECSRCH",$J,"DILIST","ID",ECNT)) Q:'ECNT  D
"RTN","ECUMRPC1",218,0)
 .S ^TMP($J,"ECFIND",ECNT)=$G(^TMP("ECSRCH",$J,"DILIST","ID",ECNT,.01))_U_^TMP("ECSRCH",$J,"DILIST",2,ECNT)
"RTN","ECUMRPC1",219,0)
 Q
"RTN","ECUURPC")
0^2^B5686150^B5408975
"RTN","ECUURPC",1,0)
ECUURPC ;ALB/JAM;Event Capture Data Entry Broker Utilities ;Aug 28, 2000
"RTN","ECUURPC",2,0)
 ;;2.0; EVENT CAPTURE ;**25,42,49,94**;8 May 96;Build 4
"RTN","ECUURPC",3,0)
 ;
"RTN","ECUURPC",4,0)
ECHELP(RESULTS,ECARY) ;
"RTN","ECUURPC",5,0)
 ;
"RTN","ECUURPC",6,0)
 ;Broker call returns the entries from HELP FILE #9.2
"RTN","ECUURPC",7,0)
 ;        RPC: EC GETSCNHELP
"RTN","ECUURPC",8,0)
 ;INPUTS   ECARY - Contains the following elements
"RTN","ECUURPC",9,0)
 ;          HLPDA  - Help Frame Name
"RTN","ECUURPC",10,0)
 ;
"RTN","ECUURPC",11,0)
 ;OUTPUTS  RESULTS - Array of help text in the HELP FRAM File (#9.2)
"RTN","ECUURPC",12,0)
 ;
"RTN","ECUURPC",13,0)
 N HLPDA,DIC,X,Y
"RTN","ECUURPC",14,0)
 S HLPDA=$G(ECARY) I HLPDA="" Q
"RTN","ECUURPC",15,0)
 D SETENV^ECUMRPC K ^TMP($J,"ECHELP")
"RTN","ECUURPC",16,0)
 S DIC="^DIC(9.2,",DIC(0)="MN",X=HLPDA
"RTN","ECUURPC",17,0)
 D ^DIC M ^TMP($J,"ECHELP")=^DIC(9.2,+Y,1)
"RTN","ECUURPC",18,0)
 I $D(^TMP($J,"ECHELP")) D
"RTN","ECUURPC",19,0)
 . S $P(^TMP($J,"ECHELP",0),U)=$P(^DIC(9.2,+Y,0),U,2)
"RTN","ECUURPC",20,0)
 S RESULTS=$NA(^TMP($J,"ECHELP"))
"RTN","ECUURPC",21,0)
 Q
"RTN","ECUURPC",22,0)
FNDIEN(RESULTS,ECARY) ;find IEN
"RTN","ECUURPC",23,0)
 ;Broker call returns the IEN from a file
"RTN","ECUURPC",24,0)
 ;        RPC: EC GETIEN
"RTN","ECUURPC",25,0)
 ;INPUTS   ECARY - Contains the following data elements
"RTN","ECUURPC",26,0)
 ;          FIL  - File number
"RTN","ECUURPC",27,0)
 ;          TXT  - .01 description
"RTN","ECUURPC",28,0)
 ;
"RTN","ECUURPC",29,0)
 ;OUTPUTS  RESULTS - File IEN
"RTN","ECUURPC",30,0)
 ;
"RTN","ECUURPC",31,0)
 N TXT,FIL,DIC,X,Y
"RTN","ECUURPC",32,0)
 D SETENV^ECUMRPC
"RTN","ECUURPC",33,0)
 S FIL=$P(ECARY,U),TXT=$P(ECARY,U,2) I TXT=""!(FIL="") Q
"RTN","ECUURPC",34,0)
 S DIC=FIL,DIC(0)="MN",X=TXT
"RTN","ECUURPC",35,0)
 I FIL=81.3 S DIC("S")="I $P(^DIC(81.3,Y,0),U,5)'=1" ;PATCH 94
"RTN","ECUURPC",36,0)
 D ^DIC I Y=-1 Q
"RTN","ECUURPC",37,0)
 S RESULTS=+Y
"RTN","ECUURPC",38,0)
 Q
"RTN","ECUURPC",39,0)
ECDATE(RESULTS,ECARY) ;
"RTN","ECUURPC",40,0)
 ;
"RTN","ECUURPC",41,0)
 ;Broker call returns an Fileman internal date
"RTN","ECUURPC",42,0)
 ;        RPC: EC GETDATE
"RTN","ECUURPC",43,0)
 ;INPUTS   ECARY - Contains the following elements
"RTN","ECUURPC",44,0)
 ;          DTSTR  - Date String
"RTN","ECUURPC",45,0)
 ;          FLG    - Date Flag (optional)
"RTN","ECUURPC",46,0)
 ;
"RTN","ECUURPC",47,0)
 ;OUTPUTS  RESULTS - A valid Fileman date format^External format
"RTN","ECUURPC",48,0)
 ;
"RTN","ECUURPC",49,0)
 N ECDTSTR,DIC,X,Y,DTSTR,FLG
"RTN","ECUURPC",50,0)
 D SETENV^ECUMRPC
"RTN","ECUURPC",51,0)
 S DTSTR=$P(ECARY,U),FLG=$P(ECARY,U,2) I DTSTR="" Q
"RTN","ECUURPC",52,0)
 S X=DTSTR,%DT="XT"_$S(FLG="R":"R",1:""),%DT(0)="-NOW" D ^%DT
"RTN","ECUURPC",53,0)
 I +Y<1 S RESULTS="0^Invalid Date/Time" Q
"RTN","ECUURPC",54,0)
 S RESULTS=Y D D^DIQ
"RTN","ECUURPC",55,0)
 S RESULTS=RESULTS_U_Y
"RTN","ECUURPC",56,0)
 Q
"RTN","ECUURPC",57,0)
PATCH(RESULTS,ECARY)    ;
"RTN","ECUURPC",58,0)
 ;
"RTN","ECUURPC",59,0)
 ;Broker call returns 1 if patch X is installed
"RTN","ECUURPC",60,0)
 ;        RPC: EC GETPATCH
"RTN","ECUURPC",61,0)
 ;INPUTS   ECARY - contains the patch number
"RTN","ECUURPC",62,0)
 ;
"RTN","ECUURPC",63,0)
 ;OUTPUTS  RESULTS 1 OR 0
"RTN","ECUURPC",64,0)
 ;
"RTN","ECUURPC",65,0)
 I ECARY="" Q
"RTN","ECUURPC",66,0)
 D SETENV^ECUMRPC
"RTN","ECUURPC",67,0)
 S RESULTS=$$PATCH^XPDUTL(ECARY)
"RTN","ECUURPC",68,0)
 Q
"RTN","ECUURPC",69,0)
VERSRV(RESULTS,ECARY,VERSION)   ; Return server version of option name and 
"RTN","ECUURPC",70,0)
 ; minimum GUI client version.
"RTN","ECUURPC",71,0)
 ;
"RTN","ECUURPC",72,0)
 ;Server/client version consist of 4 pieces, namely
"RTN","ECUURPC",73,0)
 ;    major version.minor version.release.build  (ex. 2.0.10.1)
"RTN","ECUURPC",74,0)
 ;
"RTN","ECUURPC",75,0)
 ;Broker call returns server version of option name
"RTN","ECUURPC",76,0)
 ;        RPC: EC GETVERSION
"RTN","ECUURPC",77,0)
 ;INPUTS   ECARY - contains the option name
"RTN","ECUURPC",78,0)
 ;         VERSION - EC GUI client version ;stay in partition for session
"RTN","ECUURPC",79,0)
 ;
"RTN","ECUURPC",80,0)
 ;OUTPUTS  RESULTS version number OR null ("")
"RTN","ECUURPC",81,0)
 ;           current server version^minimum client version
"RTN","ECUURPC",82,0)
 ;
"RTN","ECUURPC",83,0)
 S ECCLVER=$G(VERSION)
"RTN","ECUURPC",84,0)
 I $G(ECARY)="" Q
"RTN","ECUURPC",85,0)
 N ECLST,ECMINV
"RTN","ECUURPC",86,0)
 S ECMINV="2.0.10.1"    ; Minimum version of EC GUI client
"RTN","ECUURPC",87,0)
 D FIND^DIC(19,"",1,"X",ECARY,1,,,,"ECLST")
"RTN","ECUURPC",88,0)
 I 'ECLST("DILIST",0) S RESULTS="" Q
"RTN","ECUURPC",89,0)
 S RESULTS=ECLST("DILIST","ID",1,1)
"RTN","ECUURPC",90,0)
 S RESULTS=$P(RESULTS,"version ",2)_U_ECMINV
"RTN","ECUURPC",91,0)
 Q
"VER")
8.0^22.0
"BLD",7361,6)
^88
**END**
**END**
