EMERGENCY Released EC*2*105 SEQ #97
Extracted from mail message
**KIDS**:EC*2.0*105^

**INSTALL NAME**
EC*2.0*105
"BLD",8095,0)
EC*2.0*105^EVENT CAPTURE^0^3090630^y
"BLD",8095,1,0)
^^2^2^3090609^
"BLD",8095,1,1,0)
This patch provides a fix to the active associated clinics (file #44) s
"BLD",8095,1,2,0)
search routine ASCLN^ECUMRPC1.
"BLD",8095,4,0)
^9.64PA^^
"BLD",8095,6)
1^
"BLD",8095,6.3)
3
"BLD",8095,"ABPKG")
n
"BLD",8095,"KRN",0)
^9.67PA^779.2^20
"BLD",8095,"KRN",.4,0)
.4
"BLD",8095,"KRN",.401,0)
.401
"BLD",8095,"KRN",.402,0)
.402
"BLD",8095,"KRN",.403,0)
.403
"BLD",8095,"KRN",.5,0)
.5
"BLD",8095,"KRN",.84,0)
.84
"BLD",8095,"KRN",3.6,0)
3.6
"BLD",8095,"KRN",3.8,0)
3.8
"BLD",8095,"KRN",9.2,0)
9.2
"BLD",8095,"KRN",9.8,0)
9.8
"BLD",8095,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",8095,"KRN",9.8,"NM",1,0)
ECUMRPC1^^0^B63731298
"BLD",8095,"KRN",9.8,"NM","B","ECUMRPC1",1)

"BLD",8095,"KRN",19,0)
19
"BLD",8095,"KRN",19.1,0)
19.1
"BLD",8095,"KRN",101,0)
101
"BLD",8095,"KRN",409.61,0)
409.61
"BLD",8095,"KRN",771,0)
771
"BLD",8095,"KRN",779.2,0)
779.2
"BLD",8095,"KRN",870,0)
870
"BLD",8095,"KRN",8989.51,0)
8989.51
"BLD",8095,"KRN",8989.52,0)
8989.52
"BLD",8095,"KRN",8994,0)
8994
"BLD",8095,"KRN","B",.4,.4)

"BLD",8095,"KRN","B",.401,.401)

"BLD",8095,"KRN","B",.402,.402)

"BLD",8095,"KRN","B",.403,.403)

"BLD",8095,"KRN","B",.5,.5)

"BLD",8095,"KRN","B",.84,.84)

"BLD",8095,"KRN","B",3.6,3.6)

"BLD",8095,"KRN","B",3.8,3.8)

"BLD",8095,"KRN","B",9.2,9.2)

"BLD",8095,"KRN","B",9.8,9.8)

"BLD",8095,"KRN","B",19,19)

"BLD",8095,"KRN","B",19.1,19.1)

"BLD",8095,"KRN","B",101,101)

"BLD",8095,"KRN","B",409.61,409.61)

"BLD",8095,"KRN","B",771,771)

"BLD",8095,"KRN","B",779.2,779.2)

"BLD",8095,"KRN","B",870,870)

"BLD",8095,"KRN","B",8989.51,8989.51)

"BLD",8095,"KRN","B",8989.52,8989.52)

"BLD",8095,"KRN","B",8994,8994)

"BLD",8095,"QUES",0)
^9.62^^
"BLD",8095,"REQB",0)
^9.611^1^1
"BLD",8095,"REQB",1,0)
EC*2.0*95^2
"BLD",8095,"REQB","B","EC*2.0*95",1)

"MBREQ")
0
"PKG",486,-1)
1^1
"PKG",486,0)
EVENT CAPTURE^EC^Event Capture Workload Capture System^
"PKG",486,20,0)
^9.402P^^
"PKG",486,22,0)
^9.49I^1^1
"PKG",486,22,1,0)
2.0^2960508^2981027^66481
"PKG",486,22,1,"PAH",1,0)
105^3090630^123456804
"PKG",486,22,1,"PAH",1,1,0)
^^2^2^3090630
"PKG",486,22,1,"PAH",1,1,1,0)
This patch provides a fix to the active associated clinics (file #44) s
"PKG",486,22,1,"PAH",1,1,2,0)
search routine ASCLN^ECUMRPC1.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","ECUMRPC1")
0^1^B63731298^B63202010
"RTN","ECUMRPC1",1,0)
ECUMRPC1 ;ALB/JAM-Event Capture Management Broker Utilities ;09 June 2009
"RTN","ECUMRPC1",2,0)
 ;;2.0; EVENT CAPTURE ;**25,30,33,72,94,95,105**;8 May 96;Build 3
"RTN","ECUMRPC1",3,0)
 ;
"RTN","ECUMRPC1",4,0)
DSSUNT(RESULTS,ECARY) ;
"RTN","ECUMRPC1",5,0)
 ;
"RTN","ECUMRPC1",6,0)
 ;This broker entry point returns DSS units from file 724
"RTN","ECUMRPC1",7,0)
 ;        RPC: EC GETDSSUNIT
"RTN","ECUMRPC1",8,0)
 ;INPUTS         ECARY - Contains the following subscripted elements
"RTN","ECUMRPC1",9,0)
 ;               STAT   - Active or inactive DSS Units (optional)
"RTN","ECUMRPC1",10,0)
 ;               A-ctive (default), I-nactive, B-oth
"RTN","ECUMRPC1",11,0)
 ;
"RTN","ECUMRPC1",12,0)
 ;OUTPUTS        RESULTS - Array of DSS units. Data pieces as follows:-
"RTN","ECUMRPC1",13,0)
 ;               PIECE - Description
"RTN","ECUMRPC1",14,0)
 ;                 1     IEN of DSS Unit
"RTN","ECUMRPC1",15,0)
 ;                 2     Name of DSS Unit
"RTN","ECUMRPC1",16,0)
 ;                 3     Service
"RTN","ECUMRPC1",17,0)
 ;                 4     Medical Specialty
"RTN","ECUMRPC1",18,0)
 ;                 5     Cost Center
"RTN","ECUMRPC1",19,0)
 ;                 6     Unit Number
"RTN","ECUMRPC1",20,0)
 ;                 7     Inactive Flag
"RTN","ECUMRPC1",21,0)
 ;                 8     Associated Stop code (if not sending to PCE)
"RTN","ECUMRPC1",22,0)
 ;                 9     Category flag
"RTN","ECUMRPC1",23,0)
 ;                 10    Default date entry
"RTN","ECUMRPC1",24,0)
 ;                 11    Send to PCE Flag
"RTN","ECUMRPC1",25,0)
 ;
"RTN","ECUMRPC1",26,0)
 N UNT,STAT,CNT,CAT,NODE,ECS,STR,SRV,MED,CST,UNO,INACT,ASC,PCE,ACT,NODE
"RTN","ECUMRPC1",27,0)
 N DFD
"RTN","ECUMRPC1",28,0)
 D SETENV^ECUMRPC
"RTN","ECUMRPC1",29,0)
 K ^TMP($J,"ECDSSUNT")
"RTN","ECUMRPC1",30,0)
 S STAT=$P($G(ECARY),U),(CNT,UNT)=0 S:STAT="" STAT="A"
"RTN","ECUMRPC1",31,0)
 F  S UNT=$O(^ECD(UNT)) Q:'UNT  S NODE=$G(^ECD(UNT,0)) I NODE'="" D
"RTN","ECUMRPC1",32,0)
 . S ECS=$P(NODE,U,8),ACT=$P(NODE,U,6),ACT=$S(ACT:1,1:0)
"RTN","ECUMRPC1",33,0)
 . Q:'ECS  I $S(STAT="A"&(ACT):1,STAT="I"&('ACT):1,1:0) Q
"RTN","ECUMRPC1",34,0)
 . S CNT=CNT+1,CAT=$P(NODE,U,11),CAT=$S(CAT:"Y",1:"N"),UNO=$P(NODE,U,5)
"RTN","ECUMRPC1",35,0)
 . S SRV=$$GET1^DIQ(49,$P(NODE,U,2),.01,"I")
"RTN","ECUMRPC1",36,0)
 . S MED=$$GET1^DIQ(723,$P(NODE,U,3),.01,"I")
"RTN","ECUMRPC1",37,0)
 . S CST=$$GET1^DIQ(420.1,$P(NODE,U,4),.01,"I")
"RTN","ECUMRPC1",38,0)
 . S INACT=$P(NODE,U,6),INACT=$S(INACT:"I",1:"A"),ASC=$P(NODE,U,10)
"RTN","ECUMRPC1",39,0)
 . S:ASC ASC=$$GET1^DIQ(40.7,ASC,.01,"I")
"RTN","ECUMRPC1",40,0)
 . S DFD=$S($P(NODE,U,12)="N":"N",1:"X"),PCE=$P(NODE,U,14)
"RTN","ECUMRPC1",41,0)
 . S PCE=$S(PCE="A":PCE,PCE="O":PCE,1:"N")
"RTN","ECUMRPC1",42,0)
 . S STR=UNT_U_$P(NODE,U)_U_SRV_U_MED_U_CST_U_UNO_U_INACT_U_ASC_U_CAT
"RTN","ECUMRPC1",43,0)
 . S STR=STR_U_DFD_U_PCE,^TMP($J,"ECDSSUNT",CNT)=STR
"RTN","ECUMRPC1",44,0)
 S RESULTS=$NA(^TMP($J,"ECDSSUNT"))
"RTN","ECUMRPC1",45,0)
 Q
"RTN","ECUMRPC1",46,0)
CAT(RESULTS,ECARY) ;
"RTN","ECUMRPC1",47,0)
 ;
"RTN","ECUMRPC1",48,0)
 ;This broker entry point returns a list of categories from file 726
"RTN","ECUMRPC1",49,0)
 ;        RPC: EC GETCAT
"RTN","ECUMRPC1",50,0)
 ;INPUTS         ECARY - Contains the following subscripted elements
"RTN","ECUMRPC1",51,0)
 ;                STAT - Active or inactive category (optional)
"RTN","ECUMRPC1",52,0)
 ;                A-ctive (default), I-nactive, B-oth
"RTN","ECUMRPC1",53,0)
 ;
"RTN","ECUMRPC1",54,0)
 ;OUTPUTS        RESULTS - Array of category. Data pieces as follows:-
"RTN","ECUMRPC1",55,0)
 ;               PIECE - Description
"RTN","ECUMRPC1",56,0)
 ;                 1     IEN of Category
"RTN","ECUMRPC1",57,0)
 ;                 2     Name of Category
"RTN","ECUMRPC1",58,0)
 ;                 3     Creation Date
"RTN","ECUMRPC1",59,0)
 ;                 4     Inactive Date
"RTN","ECUMRPC1",60,0)
 ;
"RTN","ECUMRPC1",61,0)
 N STAT,CNT,CAT,NODE,ECDT,INDT,CRDT
"RTN","ECUMRPC1",62,0)
 D SETENV^ECUMRPC
"RTN","ECUMRPC1",63,0)
 K ^TMP($J,"ECCAT")
"RTN","ECUMRPC1",64,0)
 S STAT=$P($G(ECARY),U),(CNT,CAT)=0 S:STAT="" STAT="A"
"RTN","ECUMRPC1",65,0)
 F  S CAT=$O(^EC(726,CAT)) Q:'CAT  S NODE=$G(^EC(726,CAT,0)) I NODE'="" D
"RTN","ECUMRPC1",66,0)
 . S ECDT=$P(NODE,U,3)
"RTN","ECUMRPC1",67,0)
 . I STAT="A",ECDT'="",ECDT'>DT Q
"RTN","ECUMRPC1",68,0)
 . I STAT="I",ECDT="" Q
"RTN","ECUMRPC1",69,0)
 . S CRDT=$$FMTE^XLFDT($P(NODE,U,2),"2F")
"RTN","ECUMRPC1",70,0)
 . S INDT=$$FMTE^XLFDT($P(NODE,U,3),"2F")
"RTN","ECUMRPC1",71,0)
 . ;S CNT=CNT+1,^TMP($J,"ECCAT",CNT)=CAT_U_$P(NODE,U)_U_CRDT_U_INDT
"RTN","ECUMRPC1",72,0)
 . S CNT=CNT+1,^TMP($J,"ECCAT",CNT)=CAT_U_$P(NODE,U)_U_$P(CRDT,"@",1)_U_$P(INDT,"@",1)
"RTN","ECUMRPC1",73,0)
 S RESULTS=$NA(^TMP($J,"ECCAT"))
"RTN","ECUMRPC1",74,0)
 Q
"RTN","ECUMRPC1",75,0)
 ;
"RTN","ECUMRPC1",76,0)
CATCHK(RESULTS,ECARY) ;
"RTN","ECUMRPC1",77,0)
 ;
"RTN","ECUMRPC1",78,0)
 ;Broker call checks whether category is used in an Event Code Screen.
"RTN","ECUMRPC1",79,0)
 ;        RPC: EC DSSCATCHECK
"RTN","ECUMRPC1",80,0)
 ;INPUTS   ECARY  - Contains the following subscripted elements
"RTN","ECUMRPC1",81,0)
 ;          ECDA  - DSS Unit ien (file #724)
"RTN","ECUMRPC1",82,0)
 ;
"RTN","ECUMRPC1",83,0)
 ;OUTPUTS  RESULTS - Category used in Event Code Screen, 1-Yes or 0-No
"RTN","ECUMRPC1",84,0)
 ;
"RTN","ECUMRPC1",85,0)
 N ECDA,ECFLG,ECX
"RTN","ECUMRPC1",86,0)
 D SETENV^ECUMRPC
"RTN","ECUMRPC1",87,0)
 S ECDA=$P(ECARY,U) I ECDA="" Q
"RTN","ECUMRPC1",88,0)
 S (ECFLG,ECX)=0
"RTN","ECUMRPC1",89,0)
 F  S ECX=$O(^ECJ("AP",ECX)) Q:'ECX!(ECFLG)  D
"RTN","ECUMRPC1",90,0)
 . I $D(^ECJ("AP",ECX,ECDA)) S ECFLG=1
"RTN","ECUMRPC1",91,0)
 S RESULTS=ECFLG
"RTN","ECUMRPC1",92,0)
 Q
"RTN","ECUMRPC1",93,0)
PXCHK(RESULTS,ECARY) ;
"RTN","ECUMRPC1",94,0)
 ;
"RTN","ECUMRPC1",95,0)
 ;Checks whether procedure description or national number exist
"RTN","ECUMRPC1",96,0)
 ;INPUTS   ECARY  - Contains the following subscripted elements
"RTN","ECUMRPC1",97,0)
 ;          ECP - Procedure description
"RTN","ECUMRPC1",98,0)
 ;          ECN - EC National Number
"RTN","ECUMRPC1",99,0)
 ;
"RTN","ECUMRPC1",100,0)
 ;OUTPUTS  RESULTS - Px used^National # used, 1-Yes or 0-No ex. 1^0
"RTN","ECUMRPC1",101,0)
 ;
"RTN","ECUMRPC1",102,0)
 N ECX,ECP,ECN
"RTN","ECUMRPC1",103,0)
 Q:$G(ECARY)
"RTN","ECUMRPC1",104,0)
 D SETENV^ECUMRPC
"RTN","ECUMRPC1",105,0)
 S ECP=$P(ECARY,U),ECN=$P(ECARY,U,2),RESULTS="0^0"
"RTN","ECUMRPC1",106,0)
 I ECP'="",$D(^EC(725,"B",ECP)) S $P(RESULTS,U)=1
"RTN","ECUMRPC1",107,0)
 I ECN'="" F ECX="E","D","DL" D  I $P(RESULTS,U,2) Q
"RTN","ECUMRPC1",108,0)
 . I $D(^EC(725,ECX,ECN)) S $P(RESULTS,U,2)=1
"RTN","ECUMRPC1",109,0)
 Q
"RTN","ECUMRPC1",110,0)
SRCLST(RESULTS,ECARY) ;
"RTN","ECUMRPC1",111,0)
 ;
"RTN","ECUMRPC1",112,0)
 ;This broker entry returns an array of codes from a file based on a 
"RTN","ECUMRPC1",113,0)
 ;search string.
"RTN","ECUMRPC1",114,0)
 ;        RPC: EC GETLIST
"RTN","ECUMRPC1",115,0)
 ;
"RTN","ECUMRPC1",116,0)
 ;INPUTS   ECARY   - Contains the following subscripted elements
"RTN","ECUMRPC1",117,0)
 ;           ECSTR  - Search string
"RTN","ECUMRPC1",118,0)
 ;           ECFIL  - File to search
"RTN","ECUMRPC1",119,0)
 ;           ECDIR  - Search order
"RTN","ECUMRPC1",120,0)
 ;           ECNUM  - (Optional) # records to return [default=44]
"RTN","ECUMRPC1",121,0)
 ;OUTPUTS     RESULTS - Array of values based on the search criteria.
"RTN","ECUMRPC1",122,0)
 ;
"RTN","ECUMRPC1",123,0)
 N ECNT,DIC,ECSTR,ECFIL,ECORD,ECER,ECDI,ECNUM
"RTN","ECUMRPC1",124,0)
 D SETENV^ECUMRPC
"RTN","ECUMRPC1",125,0)
 S ECNT=0,ECFIL=$P(ECARY,U),ECSTR=$P(ECARY,U,2),ECDIR=$P(ECARY,U,3)
"RTN","ECUMRPC1",126,0)
 S ECORD=$S(ECDIR=-1:"B",1:"I")
"RTN","ECUMRPC1",127,0)
 K ^TMP($J,"ECFIND"),^TMP("ECSRCH",$J)
"RTN","ECUMRPC1",128,0)
 I ECFIL="" Q
"RTN","ECUMRPC1",129,0)
 S ECNUM=$S(+$P(ECARY,U,4)>0:$P(ECARY,U,4),1:44)
"RTN","ECUMRPC1",130,0)
 I ECFIL=420.1 D CSTCTR            ;Cost Center search
"RTN","ECUMRPC1",131,0)
 I ECFIL=49 D SERVC                ;Service search
"RTN","ECUMRPC1",132,0)
 I ECFIL=723 D MEDSPC              ;Medical specialty
"RTN","ECUMRPC1",133,0)
 I ECFIL=40.7 D STPCDE G EXIT      ;Associated stop code
"RTN","ECUMRPC1",134,0)
 I ECFIL=724 D DUNT G EXIT         ;DSS Unit
"RTN","ECUMRPC1",135,0)
 I ECFIL=726 D ECAT                ;Category
"RTN","ECUMRPC1",136,0)
 I ECFIL=4 D LOC                   ;Location
"RTN","ECUMRPC1",137,0)
 I ECFIL=44 D ASCLN G EXIT         ;Associated clinic
"RTN","ECUMRPC1",138,0)
 I ECFIL=757.01 D LEX^ECUMRPC2 G EXIT  ;Lex ICD code
"RTN","ECUMRPC1",139,0)
 I ECFIL=200 D PROV^ECUMRPC2(ECNUM)      ;Providers
"RTN","ECUMRPC1",140,0)
 I $D(ECER) S ^TMP($J,"ECFIND",1)="0^Error occurred during search" G EXIT
"RTN","ECUMRPC1",141,0)
 D SORT
"RTN","ECUMRPC1",142,0)
EXIT K ^TMP("ECSRCH",$J)
"RTN","ECUMRPC1",143,0)
 S RESULTS=$NA(^TMP($J,"ECFIND"))
"RTN","ECUMRPC1",144,0)
 Q
"RTN","ECUMRPC1",145,0)
ASCLN ;Search for active associated clinics (file #44)
"RTN","ECUMRPC1",146,0)
 N CNT,NOD,ECDT,INACT,REACT,ERR
"RTN","ECUMRPC1",147,0)
 S CNT=0,ECDT=DT
"RTN","ECUMRPC1",148,0)
 I (ECDIR'=1)&(ECDIR'=-1) S ECDIR=1
"RTN","ECUMRPC1",149,0)
 F  Q:CNT=ECNUM  S ECSTR=$O(^SC("B",ECSTR),ECDIR) Q:ECSTR=""  S CLN="" D
"RTN","ECUMRPC1",150,0)
 .F  S CLN=$O(^SC("B",ECSTR,CLN),ECDIR) Q:CLN=""  S NOD=$G(^SC(CLN,0)) D
"RTN","ECUMRPC1",151,0)
 ..Q:NOD=""  Q:$P(NOD,U,3)'="C"  ;Q:+$G(^SC(CLN,"OOS"))
"RTN","ECUMRPC1",152,0)
 ..S ERR=0 I $D(^SC(CLN,"I")) D  I ERR Q
"RTN","ECUMRPC1",153,0)
 ...S INACT=$P(^SC(CLN,"I"),U),REACT=$P(^SC(CLN,"I"),U,2)
"RTN","ECUMRPC1",154,0)
 ...I INACT D  I ERR Q
"RTN","ECUMRPC1",155,0)
 ....I REACT="" S:ECDT'<INACT ERR=1 Q
"RTN","ECUMRPC1",156,0)
 ....I ECDT'<INACT,ECDT<REACT S ERR=1 Q
"RTN","ECUMRPC1",157,0)
 ...I REACT,ECDT<REACT S ERR=1
"RTN","ECUMRPC1",158,0)
 ..S CNT=CNT+1,^TMP($J,"ECFIND",CNT)=CLN_U_$P(NOD,U)
"RTN","ECUMRPC1",159,0)
 Q
"RTN","ECUMRPC1",160,0)
CSTCTR ;Search for cost centers (File #420.1)
"RTN","ECUMRPC1",161,0)
 N ECNULL,INDX,STR,NSTR,I
"RTN","ECUMRPC1",162,0)
 S $P(ECNULL," ",7)=" ",INDX="B"
"RTN","ECUMRPC1",163,0)
 I $E(ECSTR)?.N,$L(ECSTR)<7 S ECSTR=ECSTR_$E(ECNULL,1,7-$L(ECSTR))
"RTN","ECUMRPC1",164,0)
 I $L($P(ECSTR," "))=6,$P(ECSTR," ",2)?.A D   ;truncate for x-ref
"RTN","ECUMRPC1",165,0)
 . S ECSTR=$P(ECSTR," ")_" "_$E($P(ECSTR," ",2,999),1,22)
"RTN","ECUMRPC1",166,0)
 I $E(ECSTR)?.A S INDX="C",(STR,NSTR)="" D  S ECSTR=NSTR
"RTN","ECUMRPC1",167,0)
 .F I=1:1 S STR=$P(ECSTR," ",I) Q:STR=""  D
"RTN","ECUMRPC1",168,0)
 ..S STR=$E(STR)_$TR($E(STR,2,9999),"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz")
"RTN","ECUMRPC1",169,0)
 ..S NSTR=NSTR_STR
"RTN","ECUMRPC1",170,0)
 D LISTDIC(ECFIL,"",.01,ECORD,ECNUM,ECSTR,"",INDX,"I '$P(^(0),U,2)","","^TMP(""ECSRCH"",$J)","ECER")
"RTN","ECUMRPC1",171,0)
 Q
"RTN","ECUMRPC1",172,0)
SERVC ;Search for services (File #49)
"RTN","ECUMRPC1",173,0)
 D LISTDIC(ECFIL,"",.01,ECORD,ECNUM,ECSTR,"","","","","^TMP(""ECSRCH"",$J)","ECER")
"RTN","ECUMRPC1",174,0)
 Q
"RTN","ECUMRPC1",175,0)
MEDSPC ;Search for medical specialty (File #723)
"RTN","ECUMRPC1",176,0)
 D LISTDIC(ECFIL,"",.01,ECORD,ECNUM,ECSTR,"","","","","^TMP(""ECSRCH"",$J)","ECER")
"RTN","ECUMRPC1",177,0)
 Q
"RTN","ECUMRPC1",178,0)
STPCDE ;Search for associated stop code (File #40.7)
"RTN","ECUMRPC1",179,0)
 N ECNT,INDX,ECNUL,STR,IEN
"RTN","ECUMRPC1",180,0)
 S $P(ECNUL,"  ",30)=" ",INDX="B",ECNT=0,ECSTR=$P(ECSTR,"~")
"RTN","ECUMRPC1",181,0)
 I +ECSTR,+ECSTR?.N S INDX="C",IEN=0 D  Q
"RTN","ECUMRPC1",182,0)
 .S ECSTR=$O(^DIC(40.7,INDX,+ECSTR)) I ECSTR="" Q
"RTN","ECUMRPC1",183,0)
 .F  S IEN=$O(^DIC(40.7,INDX,ECSTR,IEN)) Q:'IEN  D  I ECNT>(ECNUM-1) Q
"RTN","ECUMRPC1",184,0)
 ..S STR=$G(^DIC(40.7,IEN,0)) I (STR="")!($P(STR,U,3)'="") Q
"RTN","ECUMRPC1",185,0)
 ..S STR=$E($P(STR,U),1,30)_"  ["_$J($P(STR,U,2),3,0)_"]"_U_$P(STR,U,2)_U_IEN
"RTN","ECUMRPC1",186,0)
 ..S ECNT=ECNT+1,^TMP($J,"ECFIND",ECNT)=STR
"RTN","ECUMRPC1",187,0)
 D LISTDIC(ECFIL,"",".01;1",ECORD,ECNUM,ECSTR,"",INDX,"I $P(^(0),""^"",3)=""""!($P(^(0),U,3)'<DT)","","^TMP(""ECSRCH"",$J)","ECER")
"RTN","ECUMRPC1",188,0)
 S ECNT=0
"RTN","ECUMRPC1",189,0)
 F  S ECNT=$O(^TMP("ECSRCH",$J,"DILIST","ID",ECNT)) Q:'ECNT  D
"RTN","ECUMRPC1",190,0)
 .S STR=$G(^TMP("ECSRCH",$J,"DILIST","ID",ECNT,.01))_U_$G(^(1))
"RTN","ECUMRPC1",191,0)
 .S STR=$E($P(STR,U),1,30)_"  ["_$J($P(STR,U,2),3,0)_"]"_U_$P(STR,U,2)
"RTN","ECUMRPC1",192,0)
 .S ^TMP($J,"ECFIND",ECNT)=STR_U_^TMP("ECSRCH",$J,"DILIST",2,ECNT)
"RTN","ECUMRPC1",193,0)
 Q
"RTN","ECUMRPC1",194,0)
DUNT ;Search for DSS unit (File #724)
"RTN","ECUMRPC1",195,0)
 N ECNT,SNDPCE
"RTN","ECUMRPC1",196,0)
 D LISTDIC(ECFIL,"",".01;10;13",ECORD,ECNUM,ECSTR,"","","I '$P(^(0),""^"",6),$P(^(0),U,8)","","^TMP(""ECSRCH"",$J)","ECER")
"RTN","ECUMRPC1",197,0)
 S ECNT=0
"RTN","ECUMRPC1",198,0)
 F  S ECNT=$O(^TMP("ECSRCH",$J,"DILIST","ID",ECNT)) Q:'ECNT  D
"RTN","ECUMRPC1",199,0)
 .S SNDPCE=$G(^TMP("ECSRCH",$J,"DILIST","ID",ECNT,13))
"RTN","ECUMRPC1",200,0)
 .S SNDPCE=$S(SNDPCE="O":1,SNDPCE="A":1,1:0)
"RTN","ECUMRPC1",201,0)
 .S ^TMP($J,"ECFIND",ECNT)=$G(^TMP("ECSRCH",$J,"DILIST","ID",ECNT,.01))_U_^TMP("ECSRCH",$J,"DILIST",2,ECNT)_U_$G(^TMP("ECSRCH",$J,"DILIST","ID",ECNT,10))_U_SNDPCE
"RTN","ECUMRPC1",202,0)
 Q
"RTN","ECUMRPC1",203,0)
ECAT ;Search for Category (File #726)
"RTN","ECUMRPC1",204,0)
 D LISTDIC(ECFIL,"",.01,ECORD,ECNUM,ECSTR,"","","I $P(^(0),""^"",3)=""""!($P(^(0),U,3)>DT)","","^TMP(""ECSRCH"",$J)","ECER")
"RTN","ECUMRPC1",205,0)
 Q
"RTN","ECUMRPC1",206,0)
LOC ;Search for Location (File #4)
"RTN","ECUMRPC1",207,0)
 D LISTDIC(ECFIL,"",.01,ECORD,ECNUM,ECSTR,"","","I $G(^(""EC""))","","^TMP(""ECSRCH"",$J)","ECER")
"RTN","ECUMRPC1",208,0)
 Q
"RTN","ECUMRPC1",209,0)
LISTDIC(ECFL,ECIEN,ECFLD,ECFLG,ECNUM,ECFRM,ECPRT,ECINDX,ECSCN,ECIND,ECTG,ECER) ;
"RTN","ECUMRPC1",210,0)
 ;Produces a list of records in a file base on search string
"RTN","ECUMRPC1",211,0)
 N DIC
"RTN","ECUMRPC1",212,0)
 D LIST^DIC(ECFL,ECIEN,ECFLD,ECFLG,ECNUM,ECFRM,ECPRT,ECINDX,ECSCN,ECIND,ECTG,ECER)
"RTN","ECUMRPC1",213,0)
 K ECFL,ECIEN,ECFLD,ECFLG,ECNUM,ECFRM,ECPRT,ECINDX,ECSCN,ECID
"RTN","ECUMRPC1",214,0)
 Q
"RTN","ECUMRPC1",215,0)
SORT ;Extracts data to be returned to broker
"RTN","ECUMRPC1",216,0)
 N ECNT,STR
"RTN","ECUMRPC1",217,0)
 S ECNT=0
"RTN","ECUMRPC1",218,0)
 F  S ECNT=$O(^TMP("ECSRCH",$J,"DILIST","ID",ECNT)) Q:'ECNT  D
"RTN","ECUMRPC1",219,0)
 .S ^TMP($J,"ECFIND",ECNT)=$G(^TMP("ECSRCH",$J,"DILIST","ID",ECNT,.01))_U_^TMP("ECSRCH",$J,"DILIST",2,ECNT)
"RTN","ECUMRPC1",220,0)
 Q
"VER")
8.0^22.0
"BLD",8095,6)
^97
**END**
**END**
