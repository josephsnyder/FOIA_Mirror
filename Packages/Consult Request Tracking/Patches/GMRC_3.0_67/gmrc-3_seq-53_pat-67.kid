Released GMRC*3*67 SEQ #53
Extracted from mail message
**KIDS**:GMRC*3.0*67^

**INSTALL NAME**
GMRC*3.0*67
"BLD",7071,0)
GMRC*3.0*67^CONSULT/REQUEST TRACKING^0^3080716^y
"BLD",7071,4,0)
^9.64PA^^
"BLD",7071,6.3)
1
"BLD",7071,"KRN",0)
^9.67PA^8989.52^19
"BLD",7071,"KRN",.4,0)
.4
"BLD",7071,"KRN",.401,0)
.401
"BLD",7071,"KRN",.402,0)
.402
"BLD",7071,"KRN",.403,0)
.403
"BLD",7071,"KRN",.5,0)
.5
"BLD",7071,"KRN",.84,0)
.84
"BLD",7071,"KRN",3.6,0)
3.6
"BLD",7071,"KRN",3.8,0)
3.8
"BLD",7071,"KRN",9.2,0)
9.2
"BLD",7071,"KRN",9.8,0)
9.8
"BLD",7071,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",7071,"KRN",9.8,"NM",1,0)
GMRCSTLA^^0^B51723362
"BLD",7071,"KRN",9.8,"NM",2,0)
GMRCSTLB^^0^B26343796
"BLD",7071,"KRN",9.8,"NM","B","GMRCSTLA",1)

"BLD",7071,"KRN",9.8,"NM","B","GMRCSTLB",2)

"BLD",7071,"KRN",19,0)
19
"BLD",7071,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",7071,"KRN",19,"NM",1,0)
GMRC REPORTS^^2
"BLD",7071,"KRN",19,"NM",2,0)
GMRC RPT LOCAL COMPLETE RATE^^0
"BLD",7071,"KRN",19,"NM","B","GMRC REPORTS",1)

"BLD",7071,"KRN",19,"NM","B","GMRC RPT LOCAL COMPLETE RATE",2)

"BLD",7071,"KRN",19.1,0)
19.1
"BLD",7071,"KRN",101,0)
101
"BLD",7071,"KRN",409.61,0)
409.61
"BLD",7071,"KRN",771,0)
771
"BLD",7071,"KRN",870,0)
870
"BLD",7071,"KRN",8989.51,0)
8989.51
"BLD",7071,"KRN",8989.52,0)
8989.52
"BLD",7071,"KRN",8994,0)
8994
"BLD",7071,"KRN","B",.4,.4)

"BLD",7071,"KRN","B",.401,.401)

"BLD",7071,"KRN","B",.402,.402)

"BLD",7071,"KRN","B",.403,.403)

"BLD",7071,"KRN","B",.5,.5)

"BLD",7071,"KRN","B",.84,.84)

"BLD",7071,"KRN","B",3.6,3.6)

"BLD",7071,"KRN","B",3.8,3.8)

"BLD",7071,"KRN","B",9.2,9.2)

"BLD",7071,"KRN","B",9.8,9.8)

"BLD",7071,"KRN","B",19,19)

"BLD",7071,"KRN","B",19.1,19.1)

"BLD",7071,"KRN","B",101,101)

"BLD",7071,"KRN","B",409.61,409.61)

"BLD",7071,"KRN","B",771,771)

"BLD",7071,"KRN","B",870,870)

"BLD",7071,"KRN","B",8989.51,8989.51)

"BLD",7071,"KRN","B",8989.52,8989.52)

"BLD",7071,"KRN","B",8994,8994)

"BLD",7071,"QDEF")
^^^^^^^^YES^^YES
"BLD",7071,"QUES",0)
^9.62^^
"BLD",7071,"REQB",0)
^9.611^^
"KRN",19,4142,-1)
2^1
"KRN",19,4142,0)
GMRC REPORTS^Consult Tracking Reports^^M^1119^^^^^^^
"KRN",19,4142,10,0)
^19.01IP^19^19
"KRN",19,4142,10,19,0)
10341^LCR
"KRN",19,4142,10,19,"^")
GMRC RPT LOCAL COMPLETE RATE
"KRN",19,4142,"U")
CONSULT TRACKING REPORTS
"KRN",19,10341,-1)
0^2
"KRN",19,10341,0)
GMRC RPT LOCAL COMPLETE RATE^Consults Local Completion Rate^^R^^^^^^^^CONSULT/REQUEST TRACKING
"KRN",19,10341,1,0)
^^16^16^3080703^
"KRN",19,10341,1,1,0)
This report will provide the local sites with an option to generate a
"KRN",19,10341,1,2,0)
report listing consults requested, consults completed, consult completion
"KRN",19,10341,1,3,0)
rates, completed consults with results attached and rate of completed
"KRN",19,10341,1,4,0)
consults with results attached for a user determined date range.
"KRN",19,10341,1,5,0)
 
"KRN",19,10341,1,6,0)
For completed consults with results attached, the report includes those 
"KRN",19,10341,1,7,0)
consults that have results attached either in the TIU, Medicine or 
"KRN",19,10341,1,8,0)
Clinical Procedures applications.
"KRN",19,10341,1,9,0)
 
"KRN",19,10341,1,10,0)
Excluded from the report are: Prosthetics consults, Consults with a status
"KRN",19,10341,1,11,0)
of Cancelled or Discontinued, and Inter-facility Consults (IFC) requests
"KRN",19,10341,1,12,0)
where the reporting site is the sending site for the IFC.
"KRN",19,10341,1,13,0)
 
"KRN",19,10341,1,14,0)
The report can be run in a summary format to view on screen or print and 
"KRN",19,10341,1,15,0)
a comma delimited format for importing into in spreadsheet and/or database
"KRN",19,10341,1,16,0)
software.
"KRN",19,10341,25)
EN^GMRCSTLA
"KRN",19,10341,"U")
CONSULTS LOCAL COMPLETION RATE
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",128,-1)
1^1
"PKG",128,0)
CONSULT/REQUEST TRACKING^GMRC^13
"PKG",128,20,0)
^9.402P^^
"PKG",128,22,0)
^9.49I^1^1
"PKG",128,22,1,0)
3.0^2980101
"PKG",128,22,1,"PAH",1,0)
67^3080716
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","GMRCSTLA")
0^1^B51723362^n/a
"RTN","GMRCSTLA",1,0)
GMRCSTLA ;SLC/JFR,WAT - DRIVER FOR LOCAL CSLT COMPL RATE ;
"RTN","GMRCSTLA",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**67**;DEC 27, 1997;Build 1
"RTN","GMRCSTLA",3,0)
 ;
"RTN","GMRCSTLA",4,0)
 ;This routine invokes the following ICRs:
"RTN","GMRCSTLA",5,0)
 ;1519(XUTMDEVQ,10103(XLFDT),10104(XLFSTR),10089(%ZISC),10026(DIR)
"RTN","GMRCSTLA",6,0)
 Q
"RTN","GMRCSTLA",7,0)
 ;
"RTN","GMRCSTLA",8,0)
EN       ; start here
"RTN","GMRCSTLA",9,0)
 K GMRCQUT
"RTN","GMRCSTLA",10,0)
 N DIROUT,DTOUT,DUOUT,DIR,DIRUT,GMRCTMP,GMRCDG,GMRCSVC,GMRCSVNM,GMRCDT1
"RTN","GMRCSTLA",11,0)
 N GMRCDT2,GMRCFMT,GMRCGRP,VALMBCK,GMRCSAVE
"RTN","GMRCSTLA",12,0)
 ;
"RTN","GMRCSTLA",13,0)
 ;Ask for service
"RTN","GMRCSTLA",14,0)
 N Y
"RTN","GMRCSTLA",15,0)
 S DIR(0)="PO^123.5:EMQ",DIR("??")="^D LISTALL^GMRCASV"
"RTN","GMRCSTLA",16,0)
 S DIR("A")="Select Service/Specialty"
"RTN","GMRCSTLA",17,0)
 D ^DIR
"RTN","GMRCSTLA",18,0)
 I Y<1 Q
"RTN","GMRCSTLA",19,0)
 S GMRCDG=+Y,GMRCSVNM=$P(Y,U,2)
"RTN","GMRCSTLA",20,0)
 ;
"RTN","GMRCSTLA",21,0)
 ;Ask for date range
"RTN","GMRCSTLA",22,0)
 D ^GMRCSPD
"RTN","GMRCSTLA",23,0)
 I $D(GMRCQUT) G EXIT
"RTN","GMRCSTLA",24,0)
 ;
"RTN","GMRCSTLA",25,0)
 ; what type of report
"RTN","GMRCSTLA",26,0)
 K DIR,X,Y
"RTN","GMRCSTLA",27,0)
 S DIR(0)="S:O^S:Summary;D:Delimited",DIR("A")="What type of report"
"RTN","GMRCSTLA",28,0)
 D ^DIR
"RTN","GMRCSTLA",29,0)
 I Y="" G EXIT
"RTN","GMRCSTLA",30,0)
 S GMRCFMT=$S(Y="S":"CP",1:"DEL")
"RTN","GMRCSTLA",31,0)
 ;
"RTN","GMRCSTLA",32,0)
 W @IOF
"RTN","GMRCSTLA",33,0)
 S GMRCSAVE("GMRCFMT")=""
"RTN","GMRCSTLA",34,0)
 S GMRCSAVE("GMRCDG")=""
"RTN","GMRCSTLA",35,0)
 S GMRCSAVE("GMRCDT1")=""
"RTN","GMRCSTLA",36,0)
 S GMRCSAVE("GMRCDT2")=""
"RTN","GMRCSTLA",37,0)
 S GMRCSAVE("GMRCSVNM")=""
"RTN","GMRCSTLA",38,0)
 ;
"RTN","GMRCSTLA",39,0)
 D EN^XUTMDEVQ("PRNTQ^GMRCSTLA","LOCAL CONSULT COMPLETION RATES",.GMRCSAVE)
"RTN","GMRCSTLA",40,0)
 ;
"RTN","GMRCSTLA",41,0)
 D EXIT
"RTN","GMRCSTLA",42,0)
 ;
"RTN","GMRCSTLA",43,0)
 Q
"RTN","GMRCSTLA",44,0)
 ;
"RTN","GMRCSTLA",45,0)
ENOR(RETURN,GMRCSVC,GMRCDT1,GMRCDT2,GMRCSTAT,GMRCARRN) ;Entry point
"RTN","GMRCSTLA",46,0)
 ;.RETURN:   This is the root to the returned temp array.
"RTN","GMRCSTLA",47,0)
 ;GMRCSVC:  Service for which consults are to be displayed.
"RTN","GMRCSTLA",48,0)
 ;GMRCDT1:  Starting date or "ALL"
"RTN","GMRCSTLA",49,0)
 ;GMRCDT2:  Ending date if not GMRCDT1="ALL"
"RTN","GMRCSTLA",50,0)
 ;GMRCSTAT: The list of status to include separated by commas
"RTN","GMRCSTLA",51,0)
 ;GMRCARRN: Format of report becomes ^TMP array element
"RTN","GMRCSTLA",52,0)
 ;          "CP": Summary Report; "DEL": Delimited Report
"RTN","GMRCSTLA",53,0)
 ;
"RTN","GMRCSTLA",54,0)
 ;This temp array is used internally by the report:
"RTN","GMRCSTLA",55,0)
 ;^TMP("GMRCSLIST",$J,n)=ien^name^parient ien^"+" if grouper^status
"RTN","GMRCSTLA",56,0)
 ;  status is "" tracking and/or grouper
"RTN","GMRCSTLA",57,0)
 ;            1  grouper only
"RTN","GMRCSTLA",58,0)
 ;            2  tracking only
"RTN","GMRCSTLA",59,0)
 ;            9  disabled
"RTN","GMRCSTLA",60,0)
 ;
"RTN","GMRCSTLA",61,0)
 N GMRCEDT1,GMRCEDT2,GMRCDG,GMRCHEAD,GMRCGRP,VALMCNT,VALMBCK
"RTN","GMRCSTLA",62,0)
 K ^TMP("GMRCR",$J,GMRCARRN)
"RTN","GMRCSTLA",63,0)
 S RETURN="^TMP(""GMRCR"",$J,GMRCARRN)"
"RTN","GMRCSTLA",64,0)
 I '($D(GMRCSVC)#2) S GMRCSVC=1
"RTN","GMRCSTLA",65,0)
 Q:'$D(^GMR(123.5,$G(GMRCSVC),0))
"RTN","GMRCSTLA",66,0)
 ;Build service array
"RTN","GMRCSTLA",67,0)
 S GMRCDG=GMRCSVC
"RTN","GMRCSTLA",68,0)
 D SERV1^GMRCASV
"RTN","GMRCSTLA",69,0)
 ;Get external form of date range
"RTN","GMRCSTLA",70,0)
 I '($D(GMRCDT1)#2) S GMRCDT1="ALL"
"RTN","GMRCSTLA",71,0)
 S:GMRCDT1="ALL" GMRCDT2=0
"RTN","GMRCSTLA",72,0)
 D LISTDATE^GMRCSTU1(GMRCDT1,$G(GMRCDT2),.GMRCEDT1,.GMRCEDT2)
"RTN","GMRCSTLA",73,0)
 ;
"RTN","GMRCSTLA",74,0)
 N GMRCDA,INDEX,STATUS,LOOP,GROUPER
"RTN","GMRCSTLA",75,0)
 N STS,GMRCD,GMRCDT,GMRCSVCG,TEMP,GMRCPT,LINETEMP
"RTN","GMRCSTLA",76,0)
 N GMRCPTN,GMRCPTSN,GMRCDLA,GMRCXDT,GMRCLOC,GMRCSVCP
"RTN","GMRCSTLA",77,0)
 N GRP,GMRCIRF,GMRCIRFN,GMRCIDD,GMRCST,GMRCRDT
"RTN","GMRCSTLA",78,0)
 ;
"RTN","GMRCSTLA",79,0)
 K ^TMP("GMRCR",$J,GMRCARRN),^TMP("GMRCRINDEX",$J),^TMP("GMRCTOT",$J)
"RTN","GMRCSTLA",80,0)
 ;
"RTN","GMRCSTLA",81,0)
 S GROUPER=0
"RTN","GMRCSTLA",82,0)
 S GROUPER(0)=0
"RTN","GMRCSTLA",83,0)
 I GMRCARRN="DEL" D
"RTN","GMRCSTLA",84,0)
 . N STR
"RTN","GMRCSTLA",85,0)
 . S STR="Service;Total;Unresolved;Complete;Comp w/Results;%Complete;"
"RTN","GMRCSTLA",86,0)
 . S STR=STR_"%Comp w/Results"
"RTN","GMRCSTLA",87,0)
 . S ^TMP("GMRCR",$J,GMRCARRN,1,0)=STR
"RTN","GMRCSTLA",88,0)
 S INDEX=""
"RTN","GMRCSTLA",89,0)
 ;Loop on Service
"RTN","GMRCSTLA",90,0)
 F  S INDEX=$O(^TMP("GMRCSLIST",$J,INDEX)) Q:INDEX=""  D
"RTN","GMRCSTLA",91,0)
 .S GMRCSVC=$P(^TMP("GMRCSLIST",$J,INDEX),"^",1)
"RTN","GMRCSTLA",92,0)
 .S GMRCSVCP=$P(^TMP("GMRCSLIST",$J,INDEX),"^",2)
"RTN","GMRCSTLA",93,0)
 .S GMRCSVCG=$P(^TMP("GMRCSLIST",$J,INDEX),"^",3)
"RTN","GMRCSTLA",94,0)
 .S ^TMP("GMRCTOT",$J,1,GMRCSVC,"T")=0
"RTN","GMRCSTLA",95,0)
 .S ^TMP("GMRCTOT",$J,1,GMRCSVC,"P")=0
"RTN","GMRCSTLA",96,0)
 .S ^TMP("GMRCTOT",$J,1,GMRCSVC,"R")=0
"RTN","GMRCSTLA",97,0)
 .S ^TMP("GMRCTOT",$J,1,GMRCSVC,"C")=0
"RTN","GMRCSTLA",98,0)
 .S ^TMP("GMRCTOT",$J,2,GMRCSVC,"T")=0
"RTN","GMRCSTLA",99,0)
 .S ^TMP("GMRCTOT",$J,2,GMRCSVC,"P")=0
"RTN","GMRCSTLA",100,0)
 .S ^TMP("GMRCTOT",$J,2,GMRCSVC,"R")=0
"RTN","GMRCSTLA",101,0)
 .S ^TMP("GMRCTOT",$J,2,GMRCSVC,"C")=0
"RTN","GMRCSTLA",102,0)
 . ;Check if starting a new Grouper
"RTN","GMRCSTLA",103,0)
 . F  Q:GROUPER(GROUPER)=GMRCSVCG  D
"RTN","GMRCSTLA",104,0)
 ..;End of a group so print the group totals
"RTN","GMRCSTLA",105,0)
 ..I GROUPER(GROUPER)=GMRCSVCG D
"RTN","GMRCSTLA",106,0)
 ... I GMRCARRN="CP" D
"RTN","GMRCSTLA",107,0)
 .... D PRTTOT^GMRCSTLB(2,GROUPER(GROUPER),GMRCARRN)
"RTN","GMRCSTLA",108,0)
 ... I GMRCARRN="DEL" D
"RTN","GMRCSTLA",109,0)
 .... D DELTOT^GMRCSTLB(2,GROUPER(GROUPER),GMRCARRN)
"RTN","GMRCSTLA",110,0)
 ..;pop grouper from stack
"RTN","GMRCSTLA",111,0)
 ..S GROUPER=GROUPER-1
"RTN","GMRCSTLA",112,0)
 .I $P(^TMP("GMRCSLIST",$J,INDEX),"^",4)="+" D
"RTN","GMRCSTLA",113,0)
 ..;push new grouper on stack
"RTN","GMRCSTLA",114,0)
 ..S GROUPER=GROUPER+1
"RTN","GMRCSTLA",115,0)
 ..S GROUPER(GROUPER)=GMRCSVC
"RTN","GMRCSTLA",116,0)
 .;Loop for one status at a time
"RTN","GMRCSTLA",117,0)
 .F LOOP=1:1:$L(GMRCSTAT,",") S STATUS=$P(GMRCSTAT,",",LOOP) D
"RTN","GMRCSTLA",118,0)
 .. D ONESTAT^GMRCSTLB(GMRCARRN,INDEX,STATUS,GMRCDT1,GMRCDT2)
"RTN","GMRCSTLA",119,0)
 .F GRP=GROUPER:-1:1 D
"RTN","GMRCSTLA",120,0)
 ..;  pending for this service to all of its groupers
"RTN","GMRCSTLA",121,0)
 ..S ^TMP("GMRCTOT",$J,2,GROUPER(GRP),"P")=$G(^TMP("GMRCTOT",$J,2,GROUPER(GRP),"P"))+^TMP("GMRCTOT",$J,1,GMRCSVC,"P")
"RTN","GMRCSTLA",122,0)
 .. ; completed w/results for all groupers
"RTN","GMRCSTLA",123,0)
 .. S ^TMP("GMRCTOT",$J,2,GROUPER(GRP),"R")=$G(^TMP("GMRCTOT",$J,2,GROUPER(GRP),"R"))+^TMP("GMRCTOT",$J,1,GMRCSVC,"R")
"RTN","GMRCSTLA",124,0)
 ..;  for all status for this service to all of its groupers
"RTN","GMRCSTLA",125,0)
 ..S ^TMP("GMRCTOT",$J,2,GROUPER(GRP),"T")=$G(^TMP("GMRCTOT",$J,2,GROUPER(GRP),"T"))+^TMP("GMRCTOT",$J,1,GMRCSVC,"T")
"RTN","GMRCSTLA",126,0)
  .. ; add all completed for all groupers
"RTN","GMRCSTLA",127,0)
  .. S ^TMP("GMRCTOT",$J,2,GROUPER(GRP),"C")=$G(^TMP("GMRCTOT",$J,2,GROUPER(GRP),"C"))+^TMP("GMRCTOT",$J,1,GMRCSVC,"C")
"RTN","GMRCSTLA",128,0)
  .;
"RTN","GMRCSTLA",129,0)
  .;Print the totals for this service that are >0
"RTN","GMRCSTLA",130,0)
  . I GMRCARRN="CP" D
"RTN","GMRCSTLA",131,0)
  .. D PRTTOT^GMRCSTLB(1,GMRCSVC,GMRCSVCP,GMRCARRN)
"RTN","GMRCSTLA",132,0)
  . I GMRCARRN="DEL" D
"RTN","GMRCSTLA",133,0)
  .. D DELTOT^GMRCSTLB(1,GMRCSVC,GMRCSVCP,GMRCARRN)
"RTN","GMRCSTLA",134,0)
  . Q
"RTN","GMRCSTLA",135,0)
  ;
"RTN","GMRCSTLA",136,0)
  ;Done, so now list the group totals for the top group
"RTN","GMRCSTLA",137,0)
  ;F GROUPER=GROUPER:-1:1 D  ; left for looking at all totals in future
"RTN","GMRCSTLA",138,0)
  I $G(GROUPER) S GROUPER=1 D
"RTN","GMRCSTLA",139,0)
  . I GMRCARRN="CP" D
"RTN","GMRCSTLA",140,0)
  .. D PRTTOT^GMRCSTLB(2,GROUPER(GROUPER),$P(^GMR(123.5,GROUPER(GROUPER),0),"^",1),GMRCARRN)
"RTN","GMRCSTLA",141,0)
  . I GMRCARRN="DEL" D
"RTN","GMRCSTLA",142,0)
  .. D DELTOT^GMRCSTLB(2,GROUPER(GROUPER),$P(^GMR(123.5,GROUPER(GROUPER),0),"^",1),GMRCARRN)
"RTN","GMRCSTLA",143,0)
  Q
"RTN","GMRCSTLA",144,0)
  ;
"RTN","GMRCSTLA",145,0)
PRNTQ      ;Build report and print it
"RTN","GMRCSTLA",146,0)
  ;
"RTN","GMRCSTLA",147,0)
 N GMRCPG,GMRCTMP,IDX,GMRCQUT,TEMP
"RTN","GMRCSTLA",148,0)
 S GMRCPG=1
"RTN","GMRCSTLA",149,0)
 D SERV1^GMRCASV
"RTN","GMRCSTLA",150,0)
 D HEAD(GMRCPG) S GMRCPG=GMRCPG+1
"RTN","GMRCSTLA",151,0)
 W !,$J("",23)_"Local Consult Completion Rates"
"RTN","GMRCSTLA",152,0)
 S TEMP="FROM: "_$$FMTE^XLFDT(GMRCDT1)_"  TO: "_$$FMTE^XLFDT(GMRCDT2)
"RTN","GMRCSTLA",153,0)
 I GMRCDT1="ALL" S TEMP="ALL DATES"
"RTN","GMRCSTLA",154,0)
 W !,$J("",40-($L(TEMP)/2)+.5)_TEMP,!
"RTN","GMRCSTLA",155,0)
 I '$O(^TMP("GMRCSLIST",$J,0)) D  G EXIT
"RTN","GMRCSTLA",156,0)
 . W !!,"No records to print"
"RTN","GMRCSTLA",157,0)
 D ENOR^GMRCSTLA(.GMRCTMP,GMRCDG,GMRCDT1,GMRCDT2,"5,6,8,2,9",GMRCFMT)
"RTN","GMRCSTLA",158,0)
 I '$D(^TMP("GMRCR",$J,GMRCFMT)) D
"RTN","GMRCSTLA",159,0)
 . W !!,"No records to print",!
"RTN","GMRCSTLA",160,0)
 S IDX=""
"RTN","GMRCSTLA",161,0)
 F  S IDX=$O(^TMP("GMRCR",$J,GMRCFMT,IDX)) Q:'IDX!($G(GMRCQUT))  D
"RTN","GMRCSTLA",162,0)
 . I IOSL-$Y<3 D
"RTN","GMRCSTLA",163,0)
 .. I $E(IOST,1,2)["C-" D
"RTN","GMRCSTLA",164,0)
 ... N DIR S DIR(0)="E" D ^DIR
"RTN","GMRCSTLA",165,0)
 ... I 'Y S GMRCQUT=1
"RTN","GMRCSTLA",166,0)
 .. Q:$G(GMRCQUT)
"RTN","GMRCSTLA",167,0)
 .. D HEAD(GMRCPG) S GMRCPG=GMRCPG+1
"RTN","GMRCSTLA",168,0)
 . Q:$G(GMRCQUT)
"RTN","GMRCSTLA",169,0)
 . W ^TMP("GMRCR",$J,GMRCFMT,IDX,0),!
"RTN","GMRCSTLA",170,0)
 I GMRCFMT="CP",'$G(GMRCQUT) D
"RTN","GMRCSTLA",171,0)
 . Q:$O(^TMP("GMRCTOT",$J,0,""))=""
"RTN","GMRCSTLA",172,0)
 . I IOSL-$Y<6 D HEAD(GMRCPG) S GMRCPG=GMRCPG+1
"RTN","GMRCSTLA",173,0)
 . W !!!,$$REPEAT^XLFSTR("-",IOM-5)
"RTN","GMRCSTLA",174,0)
 . W !,"Consult services with no activity meeting the criteria of this report in",!,"the specified date range:",!
"RTN","GMRCSTLA",175,0)
 . S IDX=""
"RTN","GMRCSTLA",176,0)
 . F  S IDX=$O(^TMP("GMRCTOT",$J,0,IDX)) Q:IDX=""!($G(GMRCQUT))  D
"RTN","GMRCSTLA",177,0)
 .. I IOSL-$Y<3 D
"RTN","GMRCSTLA",178,0)
 ... I $E(IOST,1,2)["C-" D
"RTN","GMRCSTLA",179,0)
 .... N DIR S DIR(0)="E" D ^DIR
"RTN","GMRCSTLA",180,0)
 .... I 'Y S GMRCQUT=1
"RTN","GMRCSTLA",181,0)
 ... Q:$G(GMRCQUT)
"RTN","GMRCSTLA",182,0)
 ... D HEAD(GMRCPG) S GMRCPG=GMRCPG+1
"RTN","GMRCSTLA",183,0)
 .. Q:$G(GMRCQUT)
"RTN","GMRCSTLA",184,0)
 .. W ?4,IDX,!
"RTN","GMRCSTLA",185,0)
 D ^%ZISC
"RTN","GMRCSTLA",186,0)
 D EXIT
"RTN","GMRCSTLA",187,0)
 Q
"RTN","GMRCSTLA",188,0)
 ;
"RTN","GMRCSTLA",189,0)
HEAD(PAGE) ; print header
"RTN","GMRCSTLA",190,0)
 W @IOF
"RTN","GMRCSTLA",191,0)
 W "Local Consult Completion Rates",?40,$$HTE^XLFDT($H)
"RTN","GMRCSTLA",192,0)
 W ?73,"Page: ",PAGE,!
"RTN","GMRCSTLA",193,0)
 W $$REPEAT^XLFSTR("-",IOM-2),!
"RTN","GMRCSTLA",194,0)
 Q
"RTN","GMRCSTLA",195,0)
 ;
"RTN","GMRCSTLA",196,0)
EXIT     F ARR="GMRCR","GMRCS","GMRCSLIST","GMRCTOT" K ^TMP(ARR,$J)
"RTN","GMRCSTLA",197,0)
 K ARR
"RTN","GMRCSTLA",198,0)
 Q
"RTN","GMRCSTLA",199,0)
 ;
"RTN","GMRCSTLB")
0^2^B26343796^n/a
"RTN","GMRCSTLB",1,0)
GMRCSTLB ;SLC/JFR,WAT - Totals format for LOCAL CSLT COMPL RATE ;
"RTN","GMRCSTLB",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**67**;DEC 27, 1997;Build 1
"RTN","GMRCSTLB",3,0)
 ;;
"RTN","GMRCSTLB",4,0)
 ;875 (file 100.01), 2638 (file 100.01), 3744 (VADPT)
"RTN","GMRCSTLB",5,0)
 ; portions copied from GMRCSTL1 & GMRCSTL2
"RTN","GMRCSTLB",6,0)
 ;
"RTN","GMRCSTLB",7,0)
 Q  ; can't start here
"RTN","GMRCSTLB",8,0)
 ;
"RTN","GMRCSTLB",9,0)
PRTTOT(GEN,INDEX,NAME,ARRN) ; totals for printed report
"RTN","GMRCSTLB",10,0)
 N COUNT,SVCUSG
"RTN","GMRCSTLB",11,0)
 S COUNT=$O(^TMP("GMRCR",$J,ARRN," "),-1)
"RTN","GMRCSTLB",12,0)
 I GEN=2 D
"RTN","GMRCSTLB",13,0)
 . S COUNT=COUNT+1
"RTN","GMRCSTLB",14,0)
 . S ^TMP("GMRCR",$J,ARRN,COUNT,0)=""
"RTN","GMRCSTLB",15,0)
 . S COUNT=COUNT+1
"RTN","GMRCSTLB",16,0)
 . S ^TMP("GMRCR",$J,ARRN,COUNT,0)=" GROUPER: "_NAME_" Totals:"
"RTN","GMRCSTLB",17,0)
 I GEN=1 D
"RTN","GMRCSTLB",18,0)
 . I ^TMP("GMRCTOT",$J,1,INDEX,"T")=0 D  Q  ;collect zero servs for summ
"RTN","GMRCSTLB",19,0)
 .. Q:$P(^GMR(123.5,INDEX,0),U,2)=1
"RTN","GMRCSTLB",20,0)
 .. S ^TMP("GMRCTOT",$J,0,NAME)=""
"RTN","GMRCSTLB",21,0)
 . S COUNT=COUNT+1
"RTN","GMRCSTLB",22,0)
 . S ^TMP("GMRCR",$J,ARRN,COUNT,0)=" "
"RTN","GMRCSTLB",23,0)
 . S COUNT=COUNT+1
"RTN","GMRCSTLB",24,0)
 . S SVCUSG=$P(^GMR(123.5,INDEX,0),U,2),^TMP("GMRCR",$J,ARRN,COUNT,0)="SERVICE: "_NAME_$S($G(SVCUSG)=9:"   <disabled>",1:"")
"RTN","GMRCSTLB",25,0)
 . S COUNT=COUNT+1
"RTN","GMRCSTLB",26,0)
 . S ^TMP("GMRCR",$J,ARRN,COUNT,0)="Total Requests To Service:"_$J(^TMP("GMRCTOT",$J,1,INDEX,"T"),30,0)
"RTN","GMRCSTLB",27,0)
 I GEN=2,^TMP("GMRCTOT",$J,2,INDEX,"T")>0 D
"RTN","GMRCSTLB",28,0)
 . S COUNT=COUNT+1
"RTN","GMRCSTLB",29,0)
 . S ^TMP("GMRCR",$J,ARRN,COUNT,0)="Total Requests To Grouper:"_$J(^TMP("GMRCTOT",$J,2,INDEX,"T"),30,0)
"RTN","GMRCSTLB",30,0)
 I $G(^TMP("GMRCTOT",$J,GEN,INDEX,"T"))>0 D
"RTN","GMRCSTLB",31,0)
 . S COUNT=COUNT+1
"RTN","GMRCSTLB",32,0)
 . S ^TMP("GMRCR",$J,ARRN,COUNT,0)="Total Requests Pending Resolution: "_$J(^TMP("GMRCTOT",$J,GEN,INDEX,"P"),21,0)
"RTN","GMRCSTLB",33,0)
 . S COUNT=COUNT+1
"RTN","GMRCSTLB",34,0)
 . S ^TMP("GMRCR",$J,ARRN,COUNT,0)="Total Requests Completed: "_$J(^TMP("GMRCTOT",$J,GEN,INDEX,"C"),30,0)
"RTN","GMRCSTLB",35,0)
 . S COUNT=COUNT+1
"RTN","GMRCSTLB",36,0)
 . S ^TMP("GMRCR",$J,ARRN,COUNT,0)="Total Requests Completed with Results: "_$J(^TMP("GMRCTOT",$J,GEN,INDEX,"R"),17,0)
"RTN","GMRCSTLB",37,0)
 . N GMRCPCT
"RTN","GMRCSTLB",38,0)
 . I ^TMP("GMRCTOT",$J,GEN,INDEX,"T")=0 S GMRCPCT="N/A"
"RTN","GMRCSTLB",39,0)
 . I '$D(GMRCPCT) S GMRCPCT=(^TMP("GMRCTOT",$J,GEN,INDEX,"C")/^TMP("GMRCTOT",$J,GEN,INDEX,"T"))*100
"RTN","GMRCSTLB",40,0)
 . S COUNT=COUNT+1
"RTN","GMRCSTLB",41,0)
 . S ^TMP("GMRCR",$J,ARRN,COUNT,0)="Percentage of Total Requests Completed: "_$S(+GMRCPCT'=GMRCPCT:$J(GMRCPCT,16),1:($J(GMRCPCT,19,2)_"%"))
"RTN","GMRCSTLB",42,0)
 . K GMRCPCT
"RTN","GMRCSTLB",43,0)
 . I ^TMP("GMRCTOT",$J,GEN,INDEX,"C")=0 S GMRCPCT="N/A"
"RTN","GMRCSTLB",44,0)
 . I '$D(GMRCPCT) S GMRCPCT=(^TMP("GMRCTOT",$J,GEN,INDEX,"R")/^TMP("GMRCTOT",$J,GEN,INDEX,"C"))*100
"RTN","GMRCSTLB",45,0)
 . S COUNT=COUNT+1
"RTN","GMRCSTLB",46,0)
 . S ^TMP("GMRCR",$J,ARRN,COUNT,0)="Percentage of Total Completed Requests with Results: "_$S(+GMRCPCT'=GMRCPCT:GMRCPCT,1:($J(GMRCPCT,6,2)_"%"))
"RTN","GMRCSTLB",47,0)
 Q
"RTN","GMRCSTLB",48,0)
 ;
"RTN","GMRCSTLB",49,0)
DELTOT(GEN,INDEX,NAME,ARRN) ; format for delimited
"RTN","GMRCSTLB",50,0)
 ;
"RTN","GMRCSTLB",51,0)
 I ^TMP("GMRCTOT",$J,GEN,INDEX,"T")=0 Q
"RTN","GMRCSTLB",52,0)
 N STRING,COUNT,SVCUSG
"RTN","GMRCSTLB",53,0)
 S COUNT=$O(^TMP("GMRCR",$J,ARRN," "),-1)
"RTN","GMRCSTLB",54,0)
 S SVCUSG=$P(^GMR(123.5,INDEX,0),U,2),STRING=$S(GEN=2:"GROUPER: ",1:"")_NAME_$S($G(SVCUSG)=9:"   <disabled>",1:"")_";"
"RTN","GMRCSTLB",55,0)
 S STRING=STRING_^TMP("GMRCTOT",$J,GEN,INDEX,"T")_";"
"RTN","GMRCSTLB",56,0)
 S STRING=STRING_^TMP("GMRCTOT",$J,GEN,INDEX,"P")_";"
"RTN","GMRCSTLB",57,0)
 S STRING=STRING_^TMP("GMRCTOT",$J,GEN,INDEX,"C")_";"
"RTN","GMRCSTLB",58,0)
 S STRING=STRING_^TMP("GMRCTOT",$J,GEN,INDEX,"R")_";"
"RTN","GMRCSTLB",59,0)
 D  ;get % completed
"RTN","GMRCSTLB",60,0)
 . N GMRCPCT
"RTN","GMRCSTLB",61,0)
 . S GMRCPCT=(^TMP("GMRCTOT",$J,GEN,INDEX,"C")/^TMP("GMRCTOT",$J,GEN,INDEX,"T"))*100
"RTN","GMRCSTLB",62,0)
 . S STRING=STRING_$J(GMRCPCT,0,2)_";"
"RTN","GMRCSTLB",63,0)
 . Q
"RTN","GMRCSTLB",64,0)
 D  ; get % completed w/results
"RTN","GMRCSTLB",65,0)
 . I ^TMP("GMRCTOT",$J,GEN,INDEX,"C")=0 S STRING=STRING_"N/A;" Q
"RTN","GMRCSTLB",66,0)
 . N GMRCPCT
"RTN","GMRCSTLB",67,0)
 . S GMRCPCT=(^TMP("GMRCTOT",$J,GEN,INDEX,"R")/^TMP("GMRCTOT",$J,GEN,INDEX,"C"))*100
"RTN","GMRCSTLB",68,0)
 . S STRING=STRING_$J(GMRCPCT,0,2)
"RTN","GMRCSTLB",69,0)
 . Q
"RTN","GMRCSTLB",70,0)
 S COUNT=COUNT+1
"RTN","GMRCSTLB",71,0)
 S ^TMP("GMRCR",$J,ARRN,COUNT,0)=STRING
"RTN","GMRCSTLB",72,0)
 Q
"RTN","GMRCSTLB",73,0)
 ;
"RTN","GMRCSTLB",74,0)
ONESTAT(ARRN,SVCN,STAT,DT1,DT2) ;Process one status
"RTN","GMRCSTLB",75,0)
 ; Input -- ARRN "CP" - to be printed
"RTN","GMRCSTLB",76,0)
 ; "DEL" - in delimited format
"RTN","GMRCSTLB",77,0)
 ; SVCN = node in ^TMP("GMRCLIST,$J
"RTN","GMRCSTLB",78,0)
 ; STAT = status being worked on
"RTN","GMRCSTLB",79,0)
 ; DT1 = starting date
"RTN","GMRCSTLB",80,0)
 ; DT2 = ending date
"RTN","GMRCSTLB",81,0)
 ;
"RTN","GMRCSTLB",82,0)
 ; Output - None
"RTN","GMRCSTLB",83,0)
 ;
"RTN","GMRCSTLB",84,0)
 N GMRCPT,GMRCXDT,TEMP,GMRCSVC,GMRCSVCG,GMRCSVCP
"RTN","GMRCSTLB",85,0)
 S GMRCSVC=$P(^TMP("GMRCSLIST",$J,SVCN),"^",1)
"RTN","GMRCSTLB",86,0)
 S GMRCSVCP=$P(^TMP("GMRCSLIST",$J,SVCN),"^",2)
"RTN","GMRCSTLB",87,0)
 S GMRCSVCG=$P(^TMP("GMRCSLIST",$J,SVCN),"^",3)
"RTN","GMRCSTLB",88,0)
 S GMRCXDT=$S(DT1="ALL":0,1:9999999-DT2-.6)
"RTN","GMRCSTLB",89,0)
 F  S GMRCXDT=$O(^GMR(123,"AE",GMRCSVC,STAT,GMRCXDT)) Q:GMRCXDT=""!(GMRCXDT>(9999999-DT1))  D
"RTN","GMRCSTLB",90,0)
 .S GMRCPT=0
"RTN","GMRCSTLB",91,0)
 .;Loop for one consult at a time
"RTN","GMRCSTLB",92,0)
 .F  S GMRCPT=$O(^GMR(123,"AE",GMRCSVC,STAT,GMRCXDT,GMRCPT)) Q:GMRCPT=""  D
"RTN","GMRCSTLB",93,0)
 .. N PROS
"RTN","GMRCSTLB",94,0)
 ..; Check for bad "AE" x-ref
"RTN","GMRCSTLB",95,0)
 ..I '$D(^GMR(123,GMRCPT,0)) D  Q
"RTN","GMRCSTLB",96,0)
 ...K ^GMR(123,"AE",GMRCSVC,STAT,GMRCXDT,GMRCPT)
"RTN","GMRCSTLB",97,0)
 .. I $$TESTPAT^VADPT(+$P(^GMR(123,GMRCPT,0),U,2)) Q  ; exclude test pats
"RTN","GMRCSTLB",98,0)
 .. D  I $G(PROS) Q
"RTN","GMRCSTLB",99,0)
 ... N SVC S SVC=$P(^GMR(123,GMRCPT,0),U,5)
"RTN","GMRCSTLB",100,0)
 ... I +$G(^GMR(123.5,SVC,"INT")) S PROS=1 ; exclude PROS consults
"RTN","GMRCSTLB",101,0)
 .. I $P($G(^GMR(123,GMRCPT,12)),U,5)="P" Q  ; exclude IFC placer
"RTN","GMRCSTLB",102,0)
 ..; Add to totals
"RTN","GMRCSTLB",103,0)
 ..; for all status for this service
"RTN","GMRCSTLB",104,0)
 ..S ^TMP("GMRCTOT",$J,1,GMRCSVC,"T")=^TMP("GMRCTOT",$J,1,GMRCSVC,"T")+1
"RTN","GMRCSTLB",105,0)
 ..; pending for this service
"RTN","GMRCSTLB",106,0)
 ..S:",3,4,5,6,8,9,11,99,"[(","_STAT_",") ^TMP("GMRCTOT",$J,1,GMRCSVC,"P")=^TMP("GMRCTOT",$J,1,GMRCSVC,"P")+1
"RTN","GMRCSTLB",107,0)
 .. I STAT=2 D
"RTN","GMRCSTLB",108,0)
 ... S ^TMP("GMRCTOT",$J,1,GMRCSVC,"C")=+$G(^TMP("GMRCTOT",$J,1,GMRCSVC,"C"))+1
"RTN","GMRCSTLB",109,0)
 ... Q:'$O(^GMR(123,+$G(GMRCPT),50,0))  ; Q if no results
"RTN","GMRCSTLB",110,0)
 ... S ^TMP("GMRCTOT",$J,1,GMRCSVC,"R")=+$G(^TMP("GMRCTOT",$J,1,GMRCSVC,"R"))+1
"RTN","GMRCSTLB",111,0)
 Q
"RTN","GMRCSTLB",112,0)
 ;
"VER")
8.0^22.0
"BLD",7071,6)
^53
**END**
**END**
