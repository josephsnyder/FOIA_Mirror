Released GMRC*3*68 SEQ #61
Extracted from mail message
**KIDS**:GMRC*3.0*68^

**INSTALL NAME**
GMRC*3.0*68
"BLD",7953,0)
GMRC*3.0*68^CONSULT/REQUEST TRACKING^0^3100727^y
"BLD",7953,1,0)
^^3^3^3100721^^^^
"BLD",7953,1,1,0)
This patch corrects an issue which causes an Inter-Facility Consult (IFC)
"BLD",7953,1,2,0)
to not transmit correctly to the consulting site and appear as a local
"BLD",7953,1,3,0)
consult.
"BLD",7953,4,0)
^9.64PA^^0
"BLD",7953,6)
5^
"BLD",7953,6.3)
21
"BLD",7953,"ABPKG")
n
"BLD",7953,"INIT")
POST^GMRCYP68
"BLD",7953,"KRN",0)
^9.67PA^779.2^20
"BLD",7953,"KRN",.4,0)
.4
"BLD",7953,"KRN",.4,"NM",0)
^9.68A^^
"BLD",7953,"KRN",.401,0)
.401
"BLD",7953,"KRN",.401,"NM",0)
^9.68A^^
"BLD",7953,"KRN",.402,0)
.402
"BLD",7953,"KRN",.402,"NM",0)
^9.68A^^
"BLD",7953,"KRN",.403,0)
.403
"BLD",7953,"KRN",.403,"NM",0)
^9.68A^^
"BLD",7953,"KRN",.5,0)
.5
"BLD",7953,"KRN",.84,0)
.84
"BLD",7953,"KRN",3.6,0)
3.6
"BLD",7953,"KRN",3.8,0)
3.8
"BLD",7953,"KRN",9.2,0)
9.2
"BLD",7953,"KRN",9.8,0)
9.8
"BLD",7953,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",7953,"KRN",9.8,"NM",1,0)
GMRCHL7A^^0^B28033116
"BLD",7953,"KRN",9.8,"NM",2,0)
GMRCYP68^^0^B76565979
"BLD",7953,"KRN",9.8,"NM","B","GMRCHL7A",1)

"BLD",7953,"KRN",9.8,"NM","B","GMRCYP68",2)

"BLD",7953,"KRN",19,0)
19
"BLD",7953,"KRN",19,"NM",0)
^9.68A^^
"BLD",7953,"KRN",19.1,0)
19.1
"BLD",7953,"KRN",101,0)
101
"BLD",7953,"KRN",409.61,0)
409.61
"BLD",7953,"KRN",771,0)
771
"BLD",7953,"KRN",779.2,0)
779.2
"BLD",7953,"KRN",870,0)
870
"BLD",7953,"KRN",8989.51,0)
8989.51
"BLD",7953,"KRN",8989.52,0)
8989.52
"BLD",7953,"KRN",8994,0)
8994
"BLD",7953,"KRN","B",.4,.4)

"BLD",7953,"KRN","B",.401,.401)

"BLD",7953,"KRN","B",.402,.402)

"BLD",7953,"KRN","B",.403,.403)

"BLD",7953,"KRN","B",.5,.5)

"BLD",7953,"KRN","B",.84,.84)

"BLD",7953,"KRN","B",3.6,3.6)

"BLD",7953,"KRN","B",3.8,3.8)

"BLD",7953,"KRN","B",9.2,9.2)

"BLD",7953,"KRN","B",9.8,9.8)

"BLD",7953,"KRN","B",19,19)

"BLD",7953,"KRN","B",19.1,19.1)

"BLD",7953,"KRN","B",101,101)

"BLD",7953,"KRN","B",409.61,409.61)

"BLD",7953,"KRN","B",771,771)

"BLD",7953,"KRN","B",779.2,779.2)

"BLD",7953,"KRN","B",870,870)

"BLD",7953,"KRN","B",8989.51,8989.51)

"BLD",7953,"KRN","B",8989.52,8989.52)

"BLD",7953,"KRN","B",8994,8994)

"BLD",7953,"QUES",0)
^9.62^^
"BLD",7953,"REQB",0)
^9.611^1^1
"BLD",7953,"REQB",1,0)
GMRC*3.0*33^2
"BLD",7953,"REQB","B","GMRC*3.0*33",1)

"INIT")
POST^GMRCYP68
"MBREQ")
0
"PKG",300,-1)
1^1
"PKG",300,0)
CONSULT/REQUEST TRACKING^GMRC^CONSULTS/REQUESTS
"PKG",300,20,0)
^9.402P^^
"PKG",300,22,0)
^9.49I^1^1
"PKG",300,22,1,0)
3.0^2980101^2980417^1271
"PKG",300,22,1,"PAH",1,0)
68^3100727^33257
"PKG",300,22,1,"PAH",1,1,0)
^^3^3^3100727
"PKG",300,22,1,"PAH",1,1,1,0)
This patch corrects an issue which causes an Inter-Facility Consult (IFC)
"PKG",300,22,1,"PAH",1,1,2,0)
to not transmit correctly to the consulting site and appear as a local
"PKG",300,22,1,"PAH",1,1,3,0)
consult.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","GMRCHL7A")
0^1^B28033116^B27421740
"RTN","GMRCHL7A",1,0)
GMRCHL7A ;SLC/DCM,MA - Receive HL-7 Message from OERR ; 6/2/10 3:21pm
"RTN","GMRCHL7A",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,5,12,15,21,22,33,68**;DEC 27, 1997;Build 21
"RTN","GMRCHL7A",3,0)
 ;
"RTN","GMRCHL7A",4,0)
 ; This routine invokes IA #2849
"RTN","GMRCHL7A",5,0)
 ;
"RTN","GMRCHL7A",6,0)
URG(X) ;Return Urgency give Z-code from HL-7 segment; see ORC+9
"RTN","GMRCHL7A",7,0)
 S X=$S(X="S":"STAT",X="R":"ROUTINE",X="ZT":"TODAY",X="Z24":"WITHIN 24 HOURS",X="Z48":"WITHIN 48 HOURS",X="Z72":"WITHIN 72 HOURS",X="ZW":"WITHIN 1 WEEK",X="ZM":"WITHIN 1 MONTH",X="ZNA":"NEXT AVAILABLE",1:X)
"RTN","GMRCHL7A",8,0)
 I $E(X,1)="Z" S X=$S(X="ZT":"TODAY",X="ZE":"EMERGENCY",1:"")
"RTN","GMRCHL7A",9,0)
 Q X
"RTN","GMRCHL7A",10,0)
 ;
"RTN","GMRCHL7A",11,0)
ORC(GMRCORC) ;Get fields from ORC segment and set into GMRC variables
"RTN","GMRCHL7A",12,0)
 ;GMRCTRLC=ORC control code from HL7 Table 119
"RTN","GMRCHL7A",13,0)
 ;GMRCURGI=priority/urgency     GMRCPLCR=who entered the order
"RTN","GMRCHL7A",14,0)
 ;GMRCORNP=provider             GMRCNATO=nature of order
"RTN","GMRCHL7A",15,0)
 ;GMRCAD=date of request        GMRCOCR=order request reason
"RTN","GMRCHL7A",16,0)
 ;GMRCORFN=oe/rr file number    GMRCO=file 123 IEN - if not a new order
"RTN","GMRCHL7A",17,0)
 ;GMRCS38=order status - taken from Table 38, HL7 standard
"RTN","GMRCHL7A",18,0)
 S GMRCTRLC=$P(GMRCORC,SEP1,2),GMRCORFN=$P(GMRCORC,SEP1,3),GMRCORFN=$P($P(GMRCORFN,SEP2,1),";",1),GMRCAPP=$P($P(GMRCORC,SEP1,3),SEP2,2)
"RTN","GMRCHL7A",19,0)
 S GMRCS38=$P(GMRCORC,SEP1,6),GMRCURGI=$P($P(GMRCORC,SEP1,8),SEP2,6),GMRCPLCR=$P(GMRCORC,SEP1,11),GMRCORNP=$P(GMRCORC,SEP1,13)
"RTN","GMRCHL7A",20,0)
 I $L(GMRCURGI) S GMRCURGI="GMRCURGENCY - "_$$URG(GMRCURGI),GMRCURGI=$O(^ORD(101,"B",GMRCURGI,0))
"RTN","GMRCHL7A",21,0)
 S GMRCO=+$P($P(GMRCORC,SEP1,4),SEP2,1)
"RTN","GMRCHL7A",22,0)
 S GMRCODT=$P(GMRCORC,SEP1,16),GMRCAD=$$FMDATE^GMRCHL7(GMRCODT)
"RTN","GMRCHL7A",23,0)
 S GMRCOCR=$P(GMRCORC,SEP1,17),GMRCNATO=$P(GMRCOCR,SEP2,5)
"RTN","GMRCHL7A",24,0)
 Q
"RTN","GMRCHL7A",25,0)
OBR(GMRCOBR) ;Get fields from OBR segment and set into GMRC variables
"RTN","GMRCHL7A",26,0)
 ;GMRCTYPE=GMRC consult or GMRC request  GMRCSS=To Service
"RTN","GMRCHL7A",27,0)
 ;GMRCPLI=place of consultation          GMRCODT=observation date/time
"RTN","GMRCHL7A",28,0)
 ;GMRCATN=person to alert (attention)    GMRCSTDT=status change date/time
"RTN","GMRCHL7A",29,0)
 ;GMRCS123=results status (table 123)    GMRCINTR=results interpreter
"RTN","GMRCHL7A",30,0)
 ;GMRCPRI=procedure from file ^ORD(101,  
"RTN","GMRCHL7A",31,0)
 ;GMRCXMF=foreign consult service
"RTN","GMRCHL7A",32,0)
 ;        a flag that tells the HL7 routine that
"RTN","GMRCHL7A",33,0)
 ;        consults does not need to return CPRS a file
"RTN","GMRCHL7A",34,0)
 ;        IEN for file 123. See routine ^GMRCXMF
"RTN","GMRCHL7A",35,0)
 S GMRCPR=$P($P(GMRCOBR,SEP1,5),SEP2,6)
"RTN","GMRCHL7A",36,0)
 S GMRCTYPE=$S(GMRCPR="99PRC":"P",1:"C")
"RTN","GMRCHL7A",37,0)
 S GMRCPRI="",GMRCSS=""
"RTN","GMRCHL7A",38,0)
 I GMRCPR="99PRC" D
"RTN","GMRCHL7A",39,0)
 . S GMRCPRI=$P($P(GMRCOBR,SEP1,5),SEP2,4)
"RTN","GMRCHL7A",40,0)
 . S GMRCPRI=$S(+GMRCPRI:GMRCPRI_";GMR(123.3,",1:"")
"RTN","GMRCHL7A",41,0)
 . Q
"RTN","GMRCHL7A",42,0)
 ;
"RTN","GMRCHL7A",43,0)
 S GMRCOTXT=$P($P(GMRCOBR,SEP1,5),SEP2,5) ;consult type or service name
"RTN","GMRCHL7A",44,0)
 S GMRCODT=$P(GMRCOBR,SEP1,7) I GMRCODT]"" S GMRCODT=$$FMDATE^GMRCHL7(GMRCODT)
"RTN","GMRCHL7A",45,0)
 S GMRCPLI=$P(GMRCOBR,SEP1,19) I GMRCPLI]"" S GMRCPLI="GMRCPLACE - "_$S(GMRCPLI="OC":"ON CALL",GMRCPLI="B":"BEDSIDE",GMRCPLI="E":"EMERGENCY ROOM",1:GMRCPLI),GMRCPLI=$O(^ORD(101,"B",GMRCPLI,0))
"RTN","GMRCHL7A",46,0)
 S GMRCATN=$P(GMRCOBR,SEP1,20),GMRCSTDT=$P(GMRCOBR,SEP1,23),GMRCSTDT=$$FMDATE^GMRCHL7(GMRCSTDT)
"RTN","GMRCHL7A",47,0)
 S GMRCS123=$P(GMRCOBR,SEP1,26),GMRCINTR=$P(GMRCOBR,SEP1,33)
"RTN","GMRCHL7A",48,0)
 Q
"RTN","GMRCHL7A",49,0)
ZSV(GMRCZSV) ;Get service from ZSV segment and set into GMRCSS
"RTN","GMRCHL7A",50,0)
 S GMRCZSS=$P($P(GMRCZSV,SEP1,2),SEP2,4)
"RTN","GMRCHL7A",51,0)
 I +$G(GMRCZSS) S GMRCSS=+$G(GMRCZSS) ;Set the service if ZSV provided
"RTN","GMRCHL7A",52,0)
 I $L($P(GMRCZSV,"|",3)) S GMRCOTXT=$P(GMRCZSV,"|",3) ;consult type
"RTN","GMRCHL7A",53,0)
 Q
"RTN","GMRCHL7A",54,0)
OBX(GMRCOBX) ;Get fields from OBX segment and set into GMRC variables
"RTN","GMRCHL7A",55,0)
 ;GMRCVTYP=Value type from table 123 - i.e. TX(text), ST(string data),etc.
"RTN","GMRCHL7A",56,0)
 ;GMRCOID=observation id identifying value in seg. 5
"RTN","GMRCHL7A",57,0)
 ;GMRCVAL=observation value coded by segment 3
"RTN","GMRCHL7A",58,0)
 ;GMRCPRDG=provisional diagnosis
"RTN","GMRCHL7A",59,0)
 ;    free text or code^free text^I9C
"RTN","GMRCHL7A",60,0)
 S GMRCMSG=MSG(GMRCOBX)
"RTN","GMRCHL7A",61,0)
 S GMRCVTYP=$P(GMRCMSG,SEP1,3),GMRCOID=$P($P(GMRCMSG,SEP1,4),SEP2,2),GMRCVAL=$P(GMRCOID,SEP2,3)
"RTN","GMRCHL7A",62,0)
 I GMRCOID="REASON FOR REQUEST" D
"RTN","GMRCHL7A",63,0)
 .S GMRCRFQ(1)=$P(GMRCMSG,SEP1,6)
"RTN","GMRCHL7A",64,0)
 .S LN=0 F  S LN=$O(MSG(GMRCOBX,LN)) Q:LN=""  S GMRCRFQ(LN+1)=MSG(GMRCOBX,LN)
"RTN","GMRCHL7A",65,0)
 .Q
"RTN","GMRCHL7A",66,0)
 I GMRCOID="PROVISIONAL DIAGNOSIS" D  Q
"RTN","GMRCHL7A",67,0)
 . I GMRCVTYP="TX" D  Q
"RTN","GMRCHL7A",68,0)
 .. S GMRCPRDG=$P(GMRCMSG,SEP1,6)
"RTN","GMRCHL7A",69,0)
 .. S GMRCPRDG=$TR(GMRCPRDG,$C(9,10,13)," ") Q
"RTN","GMRCHL7A",70,0)
 . I GMRCVTYP="CE" D  Q
"RTN","GMRCHL7A",71,0)
 .. N PRDXSEG S PRDXSEG=$P(GMRCMSG,SEP1,6)
"RTN","GMRCHL7A",72,0)
 .. S GMRCPRDG=$TR($P(PRDXSEG,"^",2),$C(9,10,13),"")_"("_$P(PRDXSEG,"^")_")"
"RTN","GMRCHL7A",73,0)
 .. S GMRCPRCD=$P(PRDXSEG,"^")
"RTN","GMRCHL7A",74,0)
 I GMRCOID["COMMENT" D
"RTN","GMRCHL7A",75,0)
 .S GMRCCMT(1)=$P(GMRCMSG,SEP1,6)
"RTN","GMRCHL7A",76,0)
 .S LN=0 F  S LN=$O(MSG(GMRCOBX,LN)) Q:LN=""  S GMRCCMT(LN+1)=MSG(GMRCOBX,LN)
"RTN","GMRCHL7A",77,0)
 .Q
"RTN","GMRCHL7A",78,0)
 K LN
"RTN","GMRCHL7A",79,0)
 Q
"RTN","GMRCHL7A",80,0)
EN(MSG) ;Entry point to routine
"RTN","GMRCHL7A",81,0)
 ;MSG = local array which contains the HL-7 segments
"RTN","GMRCHL7A",82,0)
 ;GMRCSEND=sending application   GMRCFAC=sending facility
"RTN","GMRCHL7A",83,0)
 ;GMRCMTP=message type
"RTN","GMRCHL7A",84,0)
 N DFN,GMRCACT,GMRCADD,GMRCFAC,GMRCMTP,GMRCPNM,GMRCO,GMRCOCR,GMRCORNP
"RTN","GMRCHL7A",85,0)
 N GMRCORFN,GMRCPLCR,GMRCRB,GMRCSEND,GMRCSTS,GMRCTRLC,GMRCWARD,ORIFN
"RTN","GMRCHL7A",86,0)
 N GMRCTRLC,GMRCAD,ORC,GMRCSBR,GMRCZSS,GMRCSS,GMRCOTXT,GMRCPRCD
"RTN","GMRCHL7A",87,0)
 N GMRCREJ,GMRCRECV
"RTN","GMRCHL7A",88,0)
 S GMRCMSG="",GMRCNOD=0 F  S GMRCNOD=$O(MSG(GMRCNOD)) Q:GMRCNOD=""  S GMRCMSG=MSG(GMRCNOD) I $E(GMRCMSG,1,3)="MSH" D INIT^GMRCHL7U(GMRCMSG) D  Q
"RTN","GMRCHL7A",89,0)
 .S GMRCSEND=$P(GMRCMSG,SEP1,3),GMRCFAC=$P(GMRCMSG,SEP1,4)
"RTN","GMRCHL7A",90,0)
 .S GMRCMTP=$P(GMRCMSG,SEP1,9),GMRCRECV=$P(GMRCMSG,SEP1,5)
"RTN","GMRCHL7A",91,0)
 .Q
"RTN","GMRCHL7A",92,0)
 I $G(GMRCRECV)'="CONSULTS" Q  ;not intended for Consults
"RTN","GMRCHL7A",93,0)
 S GMRCMSG="",GMRCNOD=0
"RTN","GMRCHL7A",94,0)
 F  S GMRCNOD=$O(MSG(GMRCNOD)) Q:GMRCNOD=""  S GMRCMSG=MSG(GMRCNOD) D
"RTN","GMRCHL7A",95,0)
 .I $E(GMRCMSG,1,3)="PID" D PID^GMRCHL7U(GMRCMSG) Q
"RTN","GMRCHL7A",96,0)
 .I $E(GMRCMSG,1,3)="PV1" D PV1^GMRCHL7U(GMRCMSG) Q
"RTN","GMRCHL7A",97,0)
 .I $E(GMRCMSG,1,3)="ORC" D ORC(GMRCMSG) Q
"RTN","GMRCHL7A",98,0)
 .I $E(GMRCMSG,1,3)="OBR" D OBR(GMRCMSG) Q
"RTN","GMRCHL7A",99,0)
 .I $E(GMRCMSG,1,3)="ZSV" D ZSV(GMRCMSG) Q
"RTN","GMRCHL7A",100,0)
 .I $E(GMRCMSG,1,3)="OBX" D OBX(GMRCNOD) Q
"RTN","GMRCHL7A",101,0)
 .I $E(GMRCMSG,1,3)="NTE" D NTE^GMRCHL7U(.MSG,GMRCNOD,GMRCO,GMRCTRLC) Q
"RTN","GMRCHL7A",102,0)
 .I $E(GMRCMSG,1,3)="ZXX" S GMRCOFN=+$P(GMRCMSG,SEP1,2) K MSG(GMRCNOD) Q
"RTN","GMRCHL7A",103,0)
 .Q
"RTN","GMRCHL7A",104,0)
 ;Note, ZXX is not used yet; planned for future sharing consults with foreign facilities.
"RTN","GMRCHL7A",105,0)
 I '$D(GMRCTRLC) D EXIT^GMRCHL7U Q
"RTN","GMRCHL7A",106,0)
 I GMRCTRLC="Z@" D CPRSPURG^GMRCPURG(+GMRCO),EXIT^GMRCHL7U Q
"RTN","GMRCHL7A",107,0)
 I GMRCTRLC="NW" D NEW^GMRCHL7B(.GMRCREJ) D
"RTN","GMRCHL7A",108,0)
 . I $G(GMRCO) D RETURN^GMRCHL7U(GMRCO,GMRCTRLC) Q
"RTN","GMRCHL7A",109,0)
 . D REJECT^GMRCHL7U(.MSG,$G(GMRCREJ))
"RTN","GMRCHL7A",110,0)
 I '$D(GMRCO) D EXIT^GMRCHL7U Q
"RTN","GMRCHL7A",111,0)
 I $S(GMRCTRLC="CA":1,GMRCTRLC="DC":1,1:0) D DC^GMRCHL7B(GMRCO,GMRCTRLC),RETURN^GMRCHL7U(GMRCO,GMRCTRLC)
"RTN","GMRCHL7A",112,0)
 I GMRCTRLC="NA" D RTN(GMRCORFN,GMRCO)
"RTN","GMRCHL7A",113,0)
 I GMRCTRLC="XX" D MODIFY^GMRCHL7B ;Not currently returned by CPRS
"RTN","GMRCHL7A",114,0)
 ; If consults sends an XX, CPRS returns an NA.
"RTN","GMRCHL7A",115,0)
 D EXIT^GMRCHL7U
"RTN","GMRCHL7A",116,0)
 Q
"RTN","GMRCHL7A",117,0)
RTN(GMRCORN,DA) ;Put ^OR(100, ien for order into ^GMR(123, 
"RTN","GMRCHL7A",118,0)
 S DIE="^GMR(123,",DR=".03////^S X=GMRCORN"
"RTN","GMRCHL7A",119,0)
 L +^GMR(123,DA) D ^DIE L -^GMR(123,DA)
"RTN","GMRCHL7A",120,0)
 K DIE,DR
"RTN","GMRCHL7A",121,0)
 Q
"RTN","GMRCYP68")
0^2^B76565979^n/a
"RTN","GMRCYP68",1,0)
GMRCYP68 ;SLC/NG - POST INSTALL FOR GMRC*3*68 ;7/09/2010
"RTN","GMRCYP68",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**68**;DEC 27, 1997;Build 21
"RTN","GMRCYP68",3,0)
 Q
"RTN","GMRCYP68",4,0)
 ;
"RTN","GMRCYP68",5,0)
POST ; Start of Post-init for patch GMRC*3*68
"RTN","GMRCYP68",6,0)
 N GMRCTTL
"RTN","GMRCYP68",7,0)
 K ^TMP("GMRCYP68",$J)
"RTN","GMRCYP68",8,0)
 D BMES^XPDUTL("Starting Post-init...")
"RTN","GMRCYP68",9,0)
 D BMES^XPDUTL(" Searching for Consult Request which should be Inter-Facility")
"RTN","GMRCYP68",10,0)
 D MES^XPDUTL(" Consults, but are displaying as local Consults.")
"RTN","GMRCYP68",11,0)
 D MES^XPDUTL(" ")
"RTN","GMRCYP68",12,0)
 D SEARCH
"RTN","GMRCYP68",13,0)
 I GMRCTTL D MSG
"RTN","GMRCYP68",14,0)
 I 'GMRCTTL D BMES^XPDUTL(" No invalid entries found.")
"RTN","GMRCYP68",15,0)
 D BMES^XPDUTL("Post-init complete.")
"RTN","GMRCYP68",16,0)
 Q
"RTN","GMRCYP68",17,0)
 ;
"RTN","GMRCYP68",18,0)
SEARCH ; Search RELATED SERVICES (#2) field of the GMRC PROCEDURE (#123) file
"RTN","GMRCYP68",19,0)
 ;for invalid IFC services.
"RTN","GMRCYP68",20,0)
 N GMRCCPRS,GMRCSVC,GMRCSIEN,GMRCDT,X,GMRCSTS,GMRCDATE,GMRCINDT,GMRCPIFC
"RTN","GMRCYP68",21,0)
 N GMRCIFC1,GMRCIFC2,GMRCPRC,GMRCPRC1,GMRCPRC2,GMRCRFAC,GMRCSIEN0,I
"RTN","GMRCYP68",22,0)
 N GMRCIFC
"RTN","GMRCYP68",23,0)
 S (GMRCTTL,X)=0
"RTN","GMRCYP68",24,0)
 S (I,GMRCINDT,GMRCDATE,GMRCDT)=""
"RTN","GMRCYP68",25,0)
 S GMRCSTS=U
"RTN","GMRCYP68",26,0)
 F I="ACTIVE","PARTIAL RESULTS","PENDING","SCHEDULED"  D
"RTN","GMRCYP68",27,0)
 . S GMRCSTS=GMRCSTS_$O(^ORD(100.01,"B",I,""))_U
"RTN","GMRCYP68",28,0)
 S X=$$INSTALDT^XPDUTL("GMRC*3.0*22",.GMRCINDT)
"RTN","GMRCYP68",29,0)
 I +X>0 F  S GMRCDATE=$O(GMRCINDT(GMRCDATE)) Q:GMRCDATE=""  D  Q:GMRCDT'=""
"RTN","GMRCYP68",30,0)
 . I GMRCDATE<3020408 Q  ;Don't set date if not greater than release date
"RTN","GMRCYP68",31,0)
 . S GMRCDT=GMRCDATE
"RTN","GMRCYP68",32,0)
 I 'GMRCDT S GMRCDT="3020407.9999999999" ;Set date to release date if no install date
"RTN","GMRCYP68",33,0)
 F  S GMRCDT=$O(^GMR(123,"B",GMRCDT)) Q:GMRCDT=""  D
"RTN","GMRCYP68",34,0)
 . S GMRCSIEN=0
"RTN","GMRCYP68",35,0)
 . F  S GMRCSIEN=$O(^GMR(123,"B",GMRCDT,GMRCSIEN)) Q:GMRCSIEN=""  D
"RTN","GMRCYP68",36,0)
 .. S (GMRCIFC,GMRCIFC1,GMRCIFC2,GMRCPIFC,GMRCPRC,GMRCPRC1,GMRCPRC2)=""
"RTN","GMRCYP68",37,0)
 .. S GMRCSIEN0=$G(^GMR(123,GMRCSIEN,0))
"RTN","GMRCYP68",38,0)
 .. S GMRCCPRS=$P($G(GMRCSIEN0),U,12)
"RTN","GMRCYP68",39,0)
 .. I GMRCSTS'[GMRCCPRS Q  ;CPRS STATUS NOT ACTIVE, PENDING, SCHEDULED, OR PARTIAL RESULTS
"RTN","GMRCYP68",40,0)
 .. S GMRCCPRS=$P(^ORD(100.01,GMRCCPRS,0),U,1)
"RTN","GMRCYP68",41,0)
 .. S GMRCSVC=$P($G(GMRCSIEN0),U,5)
"RTN","GMRCYP68",42,0)
 .. S GMRCPRC=$P($G(GMRCSIEN0),U,8)
"RTN","GMRCYP68",43,0)
 .. I GMRCPRC'="" D
"RTN","GMRCYP68",44,0)
 ... S GMRCPRC1=$P($G(GMRCPRC),";",1),GMRCPRC2=$P($G(GMRCPRC),";",2)
"RTN","GMRCYP68",45,0)
 ... I $G(GMRCPRC2)="GMR(123.3,",+$G(GMRCPRC1)>0 D
"RTN","GMRCYP68",46,0)
 .... S GMRCPIFC=$G(^GMR(123.3,GMRCPRC1,"IFC"))
"RTN","GMRCYP68",47,0)
 .... S GMRCIFC1=+$P($G(GMRCPIFC),U,1),GMRCIFC2=$P($G(GMRCPIFC),U,2)
"RTN","GMRCYP68",48,0)
 .. I $G(GMRCIFC1)="",$G(GMRCIFC2)="",(($G(GMRCPRC)="")!($G(GMRCPRC2)'="GMR(123.3,")) D
"RTN","GMRCYP68",49,0)
 ... S GMRCIFC=$G(^GMR(123.5,+GMRCSVC,"IFC"))
"RTN","GMRCYP68",50,0)
 ... S GMRCIFC1=$P(GMRCIFC,U,1),GMRCIFC2=$P(GMRCIFC,U,2)
"RTN","GMRCYP68",51,0)
 .. I ('+GMRCIFC1)!(GMRCIFC2="") Q  ;IFC ROUTING SITE^IFC REMOTE NAME (NOT AN IFC)
"RTN","GMRCYP68",52,0)
 .. S GMRCRFAC=$P($G(GMRCSIEN0),U,23)
"RTN","GMRCYP68",53,0)
 .. I +GMRCRFAC Q  ;IF ROUTING FACILITY, NOT A PROBLEM ENTRY
"RTN","GMRCYP68",54,0)
 .. S GMRCSITE=$P($G(^DIC(4,GMRCIFC1,0)),U,1)
"RTN","GMRCYP68",55,0)
 .. S GMRCPIEN=$P($G(GMRCSIEN0),U,2)
"RTN","GMRCYP68",56,0)
 .. I +GMRCPIEN S GMRCNAME=$P($G(^DPT(GMRCPIEN,0)),U,1)_" ("_$E($P($G(^DPT(GMRCPIEN,0)),U,9),6,9)_")"
"RTN","GMRCYP68",57,0)
 .. E  S GMRCPIEN=0,GMRCNAME="UNKNOWN"
"RTN","GMRCYP68",58,0)
 .. ;I $P(GMRCPRC,";",2)="GMR(123.3," S GMRCPRC=$P(^GMR(123.3,$P(GMRCPRC,";",1),0),U,1)
"RTN","GMRCYP68",59,0)
 .. S ^TMP("GMRCYP68",$J,GMRCNAME,GMRCPIEN,GMRCDT,GMRCSIEN)=$S((($G(GMRCPRC2)="GMR(123.3,")&(+$G(GMRCPRC1)>0)):$P($G(^GMR(123.3,+GMRCPRC1,0)),U,1)_" (PROCEDURE)",1:$P($G(^GMR(123.5,+GMRCSVC,0)),U,1)_" (SERVICE)")_U_GMRCSITE_U_GMRCIFC2_U_GMRCCPRS
"RTN","GMRCYP68",60,0)
 .. S GMRCTTL=GMRCTTL+1
"RTN","GMRCYP68",61,0)
 ;D MES^XPDUTL(" ")
"RTN","GMRCYP68",62,0)
 D BMES^XPDUTL(" "_GMRCTTL_" Total Invalid IFC Consult Request Records Found.")
"RTN","GMRCYP68",63,0)
 Q
"RTN","GMRCYP68",64,0)
MSG ; Send Mailman message to installer
"RTN","GMRCYP68",65,0)
 N GMRCC,GMRCPARM,GMRCPRC,GMRCSVC,GMRCTXT,GMRCSIEN,GMRCNAME,GMRCSITE,GMRCIFC
"RTN","GMRCYP68",66,0)
 N GMRCPIEN,GMRCDT,GMRCDATE,GMRCSPS,GMRCIEN,GMRCMSG,GMRCSTS,GMRC0,GMRCCNT
"RTN","GMRCYP68",67,0)
 N XMDUZ,XMERR,XMSUB,XMTEXT,XMY,XMZ,Y
"RTN","GMRCYP68",68,0)
 I DUZ="" N DUZ S DUZ=.5 ; if user not defined set to postmaster
"RTN","GMRCYP68",69,0)
 S XMDUZ=DUZ,XMTEXT="GMRCTXT"
"RTN","GMRCYP68",70,0)
 S GMRCPARM("FROM")="PATCH GMRC*3.0*68 POST-INIT"
"RTN","GMRCYP68",71,0)
 S XMY(DUZ)="" ; send message to user
"RTN","GMRCYP68",72,0)
 S XMSUB="GMRC*3*68 - IFC CONSULTS NOT SENT"
"RTN","GMRCYP68",73,0)
 K GMRCTXT
"RTN","GMRCYP68",74,0)
 S GMRCC=0
"RTN","GMRCYP68",75,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="This message has been sent by patch GMRC*3.0*68 at the completion of"
"RTN","GMRCYP68",76,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="the post-init routine."
"RTN","GMRCYP68",77,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)=" "
"RTN","GMRCYP68",78,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="This message was sent because Inter-Facility Consult records were found"
"RTN","GMRCYP68",79,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="which were not sent as Inter-Facility Consults and appear as local"
"RTN","GMRCYP68",80,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="Consults. These IFC Consults are listed in this Mailman message so the"
"RTN","GMRCYP68",81,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="proper action may be taken to correct the erroneous IFC Consult Request"
"RTN","GMRCYP68",82,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="Records. We have identified two different ways in which sites may correct"
"RTN","GMRCYP68",83,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="these incorrect IFC entries:"
"RTN","GMRCYP68",84,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)=" "
"RTN","GMRCYP68",85,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="  Option 1: After identifying and verifying the problem entry, forward the"
"RTN","GMRCYP68",86,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="            problem entry to a different consult service/procedure and then"
"RTN","GMRCYP68",87,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="            forward the entry back to the original service/procedure. This"
"RTN","GMRCYP68",88,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="            action will correct the problem and allow the consult to transmit"
"RTN","GMRCYP68",89,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="            properly to the consulting facility. If this option is used,"
"RTN","GMRCYP68",90,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="            it is suggested the forwarding to service be made aware of"
"RTN","GMRCYP68",91,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="            these pending actions and a standard message be devised to"
"RTN","GMRCYP68",92,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="            be included as a comment for the effected consult entries."
"RTN","GMRCYP68",93,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)=" "
"RTN","GMRCYP68",94,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="  Option 2: After identifying and verifying the problem entry, contact"
"RTN","GMRCYP68",95,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="            the ordering provider to determine if the order is still"
"RTN","GMRCYP68",96,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="            needed. Have the provider Discontinue the order. If the"
"RTN","GMRCYP68",97,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="            order was no longer needed, then this is all that is needed."
"RTN","GMRCYP68",98,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="            If the order is needed, then the provider should re-order"
"RTN","GMRCYP68",99,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="            it. Sites may want to create a standardized message for the"
"RTN","GMRCYP68",100,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="            discontinued orders and new orders if appropriate."
"RTN","GMRCYP68",101,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)=" "
"RTN","GMRCYP68",102,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="  Submit a Remedy ticket if you need additional instructions or help."
"RTN","GMRCYP68",103,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)=" "
"RTN","GMRCYP68",104,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="The following information is provided to assist you in your cleanup efforts."
"RTN","GMRCYP68",105,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)=" "
"RTN","GMRCYP68",106,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="PATIENT NAME (L4 SSN)"
"RTN","GMRCYP68",107,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="   DATE                    IEN NUMBER       STATUS"
"RTN","GMRCYP68",108,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="      CONSULT REQUEST (SERVICE/PROCEDURE)"
"RTN","GMRCYP68",109,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="         IFC ROUTING SITE"
"RTN","GMRCYP68",110,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="         IFC REMOTE NAME"
"RTN","GMRCYP68",111,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="=============================================================================="
"RTN","GMRCYP68",112,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)=" "
"RTN","GMRCYP68",113,0)
 S GMRCCNT=0
"RTN","GMRCYP68",114,0)
 S GMRCSPS=" "
"RTN","GMRCYP68",115,0)
 S GMRCNAME=""
"RTN","GMRCYP68",116,0)
 F  S GMRCNAME=$O(^TMP("GMRCYP68",$J,GMRCNAME)) Q:GMRCNAME=""  D
"RTN","GMRCYP68",117,0)
 . S GMRCPIEN=""
"RTN","GMRCYP68",118,0)
 . F  S GMRCPIEN=$O(^TMP("GMRCYP68",$J,GMRCNAME,GMRCPIEN)) Q:GMRCPIEN=""  D
"RTN","GMRCYP68",119,0)
 .. S GMRCC=GMRCC+1,GMRCTXT(GMRCC)=GMRCNAME
"RTN","GMRCYP68",120,0)
 .. S GMRCDT=""
"RTN","GMRCYP68",121,0)
 .. F  S GMRCDT=$O(^TMP("GMRCYP68",$J,GMRCNAME,GMRCPIEN,GMRCDT)) Q:GMRCDT=""  D
"RTN","GMRCYP68",122,0)
 ... S GMRCSIEN=""
"RTN","GMRCYP68",123,0)
 ... F  S GMRCSIEN=$O(^TMP("GMRCYP68",$J,GMRCNAME,GMRCPIEN,GMRCDT,GMRCSIEN)) Q:GMRCSIEN=""  D
"RTN","GMRCYP68",124,0)
 .... S GMRC0=$G(^TMP("GMRCYP68",$J,GMRCNAME,GMRCPIEN,GMRCDT,GMRCSIEN))
"RTN","GMRCYP68",125,0)
 .... S Y=GMRCDT D DD^%DT
"RTN","GMRCYP68",126,0)
 .... S GMRCDATE=$E(Y_"                        ",1,24)
"RTN","GMRCYP68",127,0)
 .... S GMRCSVC=$P(GMRC0,U,1)
"RTN","GMRCYP68",128,0)
 .... S GMRCSITE=$P(GMRC0,U,2)
"RTN","GMRCYP68",129,0)
 .... S GMRCIFC=$P(GMRC0,U,3)
"RTN","GMRCYP68",130,0)
 .... S GMRCIEN=$E(GMRCSIEN_"               ",1,17)
"RTN","GMRCYP68",131,0)
 .... S GMRCSTS=$P(GMRC0,U,4)
"RTN","GMRCYP68",132,0)
 .... S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="   "_GMRCDATE_GMRCIEN_GMRCSTS
"RTN","GMRCYP68",133,0)
 .... S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="      "_GMRCSVC
"RTN","GMRCYP68",134,0)
 .... S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="         "_GMRCSITE
"RTN","GMRCYP68",135,0)
 .... S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="         "_GMRCIFC
"RTN","GMRCYP68",136,0)
 .... S GMRCC=GMRCC+1,GMRCTXT(GMRCC)=" "
"RTN","GMRCYP68",137,0)
 .... S GMRCCNT=GMRCCNT+1
"RTN","GMRCYP68",138,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)=" "
"RTN","GMRCYP68",139,0)
 S GMRCC=GMRCC+1,GMRCTXT(GMRCC)="Total Invalid IFC Consult Request Records Found: "_GMRCCNT
"RTN","GMRCYP68",140,0)
 D SENDMSG^XMXAPI(XMDUZ,XMSUB,XMTEXT,.XMY,.GMRCPARM,.XMZ,"")
"RTN","GMRCYP68",141,0)
 I '$D(XMERR) D BMES^XPDUTL("Message #"_XMZ_" has been sent")
"RTN","GMRCYP68",142,0)
 I $D(XMERR) D 
"RTN","GMRCYP68",143,0)
 . S GMRCMSG(1)=" "
"RTN","GMRCYP68",144,0)
 . S GMRCMSG(2)="******************************************************************************"
"RTN","GMRCYP68",145,0)
 . S GMRCMSG(3)="** Message containing IFC Consult records which were not **"
"RTN","GMRCYP68",146,0)
 . S GMRCMSG(4)="** sent due "_$S($D(XMERR):"to an error in the message set up. **",1:"sent to the "_$S(DUZ=.5:"postmaster. Please forward this **",1:"user. Please forward this **"))
"RTN","GMRCYP68",147,0)
 . I $D(XMERR) S GMRCMSG(5)="** Dumping message to screen. **"
"RTN","GMRCYP68",148,0)
 . I '$D(XMERR) S GMRCMSG(5)="** message to the appropriate staff, which includes the clinical **"
"RTN","GMRCYP68",149,0)
 . I '$D(XMERR) S GMRCMSG(6)="** coordinator, for further action. **"
"RTN","GMRCYP68",150,0)
 . S GMRCMSG($S($D(XMERR):6,1:7))="******************************************************************************"
"RTN","GMRCYP68",151,0)
 . D BMES^XPDUTL(GMRCMSG)
"RTN","GMRCYP68",152,0)
 I $D(XMERR) D BMES^XPDUTL(" "),BMES^XPDUTL(.GMRCTXT)
"RTN","GMRCYP68",153,0)
 K ^TMP("GMRCYP68",$J)
"RTN","GMRCYP68",154,0)
 Q
"VER")
8.0^22.0
"BLD",7953,6)
^61
**END**
**END**
