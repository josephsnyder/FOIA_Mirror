Released GMRC*3*63 SEQ #56
Extracted from mail message
**KIDS**:GMRC*3.0*63^

**INSTALL NAME**
GMRC*3.0*63
"BLD",7798,0)
GMRC*3.0*63^CONSULT/REQUEST TRACKING^0^3090223^y
"BLD",7798,1,0)
^^14^14^3090107^^
"BLD",7798,1,1,0)
This patch reformats the Consult Service reports (PC, CC, CP, IFC, IR, 
"BLD",7798,1,2,0)
NU, and SC) total section to print the totals like the Consult 
"BLD",7798,1,3,0)
Performance Monitor Report.  Consult Reports (SC, IFC, IR, NU, PI, and 
"BLD",7798,1,4,0)
PR) will now print a total service total line even if the total is 
"BLD",7798,1,5,0)
zero, if the report is ran for an individual service or the grouper and 
"BLD",7798,1,6,0)
for all statuses.  Zero service total lines will not print when the 
"BLD",7798,1,7,0)
report is ran for All Services, but a listing of those services will
"BLD",7798,1,8,0)
be listed at the end of the report.  In addition, the "ALL SERVICES" total
"BLD",7798,1,9,0)
section will not count a service twice if it can be found in multiple
"BLD",7798,1,10,0)
groupers.  The patch also corrects the issue where a "Quit" was received
"BLD",7798,1,11,0)
in the middle of the report which also caused incorrect page numbers and
"BLD",7798,1,12,0)
the down arrow to stop working.  The undefined error at SETUP CONSULT
"BLD",7798,1,13,0)
SERVICE has been corrected, and an alert issue in Vista has been fixed to
"BLD",7798,1,14,0)
allow multiple commands to be performed on the consult alert.
"BLD",7798,4,0)
^9.64PA^^
"BLD",7798,6)
3^
"BLD",7798,6.3)
10
"BLD",7798,"KRN",0)
^9.67PA^8989.52^19
"BLD",7798,"KRN",.4,0)
.4
"BLD",7798,"KRN",.401,0)
.401
"BLD",7798,"KRN",.402,0)
.402
"BLD",7798,"KRN",.403,0)
.403
"BLD",7798,"KRN",.5,0)
.5
"BLD",7798,"KRN",.84,0)
.84
"BLD",7798,"KRN",3.6,0)
3.6
"BLD",7798,"KRN",3.8,0)
3.8
"BLD",7798,"KRN",9.2,0)
9.2
"BLD",7798,"KRN",9.8,0)
9.8
"BLD",7798,"KRN",9.8,"NM",0)
^9.68A^6^6
"BLD",7798,"KRN",9.8,"NM",1,0)
GMRCSLM1^^0^B56247928
"BLD",7798,"KRN",9.8,"NM",2,0)
GMRCSLMA^^0^B13581833
"BLD",7798,"KRN",9.8,"NM",3,0)
GMRCSRVS^^0^B67442979
"BLD",7798,"KRN",9.8,"NM",4,0)
GMRCSTL1^^0^B15110151
"BLD",7798,"KRN",9.8,"NM",5,0)
GMRCSTL2^^0^B33679640
"BLD",7798,"KRN",9.8,"NM",6,0)
GMRCSTLM^^0^B105230463
"BLD",7798,"KRN",9.8,"NM","B","GMRCSLM1",1)

"BLD",7798,"KRN",9.8,"NM","B","GMRCSLMA",2)

"BLD",7798,"KRN",9.8,"NM","B","GMRCSRVS",3)

"BLD",7798,"KRN",9.8,"NM","B","GMRCSTL1",4)

"BLD",7798,"KRN",9.8,"NM","B","GMRCSTL2",5)

"BLD",7798,"KRN",9.8,"NM","B","GMRCSTLM",6)

"BLD",7798,"KRN",19,0)
19
"BLD",7798,"KRN",19.1,0)
19.1
"BLD",7798,"KRN",101,0)
101
"BLD",7798,"KRN",409.61,0)
409.61
"BLD",7798,"KRN",771,0)
771
"BLD",7798,"KRN",870,0)
870
"BLD",7798,"KRN",8989.51,0)
8989.51
"BLD",7798,"KRN",8989.52,0)
8989.52
"BLD",7798,"KRN",8994,0)
8994
"BLD",7798,"KRN","B",.4,.4)

"BLD",7798,"KRN","B",.401,.401)

"BLD",7798,"KRN","B",.402,.402)

"BLD",7798,"KRN","B",.403,.403)

"BLD",7798,"KRN","B",.5,.5)

"BLD",7798,"KRN","B",.84,.84)

"BLD",7798,"KRN","B",3.6,3.6)

"BLD",7798,"KRN","B",3.8,3.8)

"BLD",7798,"KRN","B",9.2,9.2)

"BLD",7798,"KRN","B",9.8,9.8)

"BLD",7798,"KRN","B",19,19)

"BLD",7798,"KRN","B",19.1,19.1)

"BLD",7798,"KRN","B",101,101)

"BLD",7798,"KRN","B",409.61,409.61)

"BLD",7798,"KRN","B",771,771)

"BLD",7798,"KRN","B",870,870)

"BLD",7798,"KRN","B",8989.51,8989.51)

"BLD",7798,"KRN","B",8989.52,8989.52)

"BLD",7798,"KRN","B",8994,8994)

"BLD",7798,"QUES",0)
^9.62^^
"BLD",7798,"REQB",0)
^9.611^4^4
"BLD",7798,"REQB",1,0)
GMRC*3.0*18^1
"BLD",7798,"REQB",2,0)
GMRC*3.0*29^1
"BLD",7798,"REQB",3,0)
GMRC*3.0*32^1
"BLD",7798,"REQB",4,0)
GMRC*3.0*53^1
"BLD",7798,"REQB","B","GMRC*3.0*18",1)

"BLD",7798,"REQB","B","GMRC*3.0*29",2)

"BLD",7798,"REQB","B","GMRC*3.0*32",3)

"BLD",7798,"REQB","B","GMRC*3.0*53",4)

"MBREQ")
0
"PKG",300,-1)
1^1
"PKG",300,0)
CONSULT/REQUEST TRACKING^GMRC^CONSULTS/REQUESTS
"PKG",300,22,0)
^9.49I^1^1
"PKG",300,22,1,0)
3.0^2980101^2980417^1271
"PKG",300,22,1,"PAH",1,0)
63^3090223^33290
"PKG",300,22,1,"PAH",1,1,0)
^^14^14^3090223
"PKG",300,22,1,"PAH",1,1,1,0)
This patch reformats the Consult Service reports (PC, CC, CP, IFC, IR, 
"PKG",300,22,1,"PAH",1,1,2,0)
NU, and SC) total section to print the totals like the Consult 
"PKG",300,22,1,"PAH",1,1,3,0)
Performance Monitor Report.  Consult Reports (SC, IFC, IR, NU, PI, and 
"PKG",300,22,1,"PAH",1,1,4,0)
PR) will now print a total service total line even if the total is 
"PKG",300,22,1,"PAH",1,1,5,0)
zero, if the report is ran for an individual service or the grouper and 
"PKG",300,22,1,"PAH",1,1,6,0)
for all statuses.  Zero service total lines will not print when the 
"PKG",300,22,1,"PAH",1,1,7,0)
report is ran for All Services, but a listing of those services will
"PKG",300,22,1,"PAH",1,1,8,0)
be listed at the end of the report.  In addition, the "ALL SERVICES" total
"PKG",300,22,1,"PAH",1,1,9,0)
section will not count a service twice if it can be found in multiple
"PKG",300,22,1,"PAH",1,1,10,0)
groupers.  The patch also corrects the issue where a "Quit" was received
"PKG",300,22,1,"PAH",1,1,11,0)
in the middle of the report which also caused incorrect page numbers and
"PKG",300,22,1,"PAH",1,1,12,0)
the down arrow to stop working.  The undefined error at SETUP CONSULT
"PKG",300,22,1,"PAH",1,1,13,0)
SERVICE has been corrected, and an alert issue in Vista has been fixed to
"PKG",300,22,1,"PAH",1,1,14,0)
allow multiple commands to be performed on the consult alert.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","GMRCSLM1")
0^1^B56247928^B55643288
"RTN","GMRCSLM1",1,0)
GMRCSLM1 ;SLC/DCM - Gather data and format ^TMP global for consult tracking Silent call for use by List Manager and GUI ;10/9/01 23:12
"RTN","GMRCSLM1",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,4,10,12,15,17,22,32,63**;DEC 27, 1997;Build 10
"RTN","GMRCSLM1",3,0)
 ;
"RTN","GMRCSLM1",4,0)
 ; This routine invokes IA #2638,#2740
"RTN","GMRCSLM1",5,0)
 ;
"RTN","GMRCSLM1",6,0)
 G AD
"RTN","GMRCSLM1",7,0)
SVC(NODE) ;Check for a valid service
"RTN","GMRCSLM1",8,0)
 K GMRCDEAV
"RTN","GMRCSLM1",9,0)
 I '$D(^GMR(123,NODE,0)) Q 0
"RTN","GMRCSLM1",10,0)
 I '+$P(^GMR(123,NODE,0),"^",5) Q 0
"RTN","GMRCSLM1",11,0)
 I '$D(^TMP("GMRCS",$J,$P(^GMR(123,NODE,0),"^",5))) Q 0
"RTN","GMRCSLM1",12,0)
 Q 1
"RTN","GMRCSLM1",13,0)
AD ;Main entry point. Loop through AD x-ref in file 123; Find consults that have been released to requested service
"RTN","GMRCSLM1",14,0)
 ;;DFN and GMRCSSNM must be defined when this entry point is called
"RTN","GMRCSLM1",15,0)
 ;;DFN=Internal File Number of Patient in ^DPT
"RTN","GMRCSLM1",16,0)
 ;;GMRCSSNM=Service Name of a Hospital Service from file ^GMR(123.5
"RTN","GMRCSLM1",17,0)
 ;;If GMRCSSNM is not defined or is null, then no records will be found.
"RTN","GMRCSLM1",18,0)
 ;;GMRCOER must be passed so that proper formatting for GUI or List Manager can be performed.  GMRCOER is passed as 0 for List Manager, 1 for GUI.
"RTN","GMRCSLM1",19,0)
 ;;GMRCDT1 and GMRCDT2 are passed in as start and stop dates for the lookup. If GMRCDT1="" or GMRCDT1="ALL", then all dates are searched.
"RTN","GMRCSLM1",20,0)
 ;;GMRCIS=IFC site (if defined); Values: R(equesting) or C(onsulting)
"RTN","GMRCSLM1",21,0)
 ;;  ***********************************************************
"RTN","GMRCSLM1",22,0)
 K ^TMP("GMRCR",$J,"CS"),GMRCNUL
"RTN","GMRCSLM1",23,0)
 I $D(GMRCSSS) S (GMRCDG,GMRCSS)=GMRCSSS,GMRCSSNM=($P($G(^GMR(123.5,+GMRCSS,0)),"^",1)) D SERV1^GMRCASV K GMRCSSS ;reset after forward
"RTN","GMRCSLM1",24,0)
 S TAB="",$P(TAB," ",41)="",BLK=0,LNCT=1 S:'$D(GMRCOER) GMRCOER=0
"RTN","GMRCSLM1",25,0)
 S GMRCD=0 F  S GMRCD=$O(^GMR(123,"AD",DFN,GMRCD)) Q:'GMRCD  S GMRCDA=0 F  S GMRCDA=$O(^GMR(123,"AD",DFN,GMRCD,GMRCDA)) Q:'GMRCDA  I $$SVC(GMRCDA) D SET
"RTN","GMRCSLM1",26,0)
 D END Q
"RTN","GMRCSLM1",27,0)
SET ;;Format entries into a word processing 'TMP("GMRCR",$J,"CS",' global that List Manager can display
"RTN","GMRCSLM1",28,0)
 ;;GMRCOER is a variable that signals that data is being formatted for the OE/RR GUI; this data is formatted differently than the data for List Manager.
"RTN","GMRCSLM1",29,0)
 ;;GMRCOER=0 : Data is List Manager formatted.
"RTN","GMRCSLM1",30,0)
 ;;GMRCOER=1 : Data is OE/RR GUI formatted.
"RTN","GMRCSLM1",31,0)
 S:'$D(TAB) TAB="",$P(TAB," ",30)=""
"RTN","GMRCSLM1",32,0)
 S GMRCIFN=$G(GMRCDA) I '$L(GMRCIFN),$D(XQADATA) S (GMRCDA,GMRCIFN)=+XQADATA
"RTN","GMRCSLM1",33,0)
 I $G(XQADATA)["@" S (GMRCDA,GMRCIFN)=+$P($P(XQADATA,"@",2),"|",2)
"RTN","GMRCSLM1",34,0)
 S GMRCSEX=$S($P(^DPT(DFN,0),"^",2)="M":"MALE",1:"FEMALE")
"RTN","GMRCSLM1",35,0)
 I '$D(^GMR(123,+GMRCIFN,0)) S GMRCQUT=1 Q
"RTN","GMRCSLM1",36,0)
 S PROC="",GMRC(0)=^GMR(123,GMRCIFN,0)
"RTN","GMRCSLM1",37,0)
 ;IF Consults
"RTN","GMRCSLM1",38,0)
 N GMRCCK
"RTN","GMRCSLM1",39,0)
 I $D(GMRCIS) D  Q:'GMRCCK
"RTN","GMRCSLM1",40,0)
 . S GMRCCK=1
"RTN","GMRCSLM1",41,0)
 . S:'$P($G(GMRC(0)),"^",23) GMRCCK=0
"RTN","GMRCSLM1",42,0)
 . I GMRCCK=1 D
"RTN","GMRCSLM1",43,0)
 . . S GMRC(12)=$G(^GMR(123,GMRCIFN,12))
"RTN","GMRCSLM1",44,0)
 . . I GMRCIS="R",$P(GMRC(12),"^",5)'="P" S GMRCCK=0
"RTN","GMRCSLM1",45,0)
 . . I GMRCIS="C",$P(GMRC(12),"^",5)'="F" S GMRCCK=0
"RTN","GMRCSLM1",46,0)
 I $D(GMRCSTCK),GMRCSTCK'="" N STATUS,TITLE D  Q:'STATUS
"RTN","GMRCSLM1",47,0)
 . N I
"RTN","GMRCSLM1",48,0)
 . F I=1:1 S STATUS=$P(GMRCSTCK,",",I) Q:STATUS=$P(GMRC(0),"^",12)  Q:'STATUS
"RTN","GMRCSLM1",49,0)
 . Q
"RTN","GMRCSLM1",50,0)
 I $D(GMRCVP),GMRCVP'=$P(GMRC(0),"^",8) Q
"RTN","GMRCSLM1",51,0)
 S (GMRCFMDT,X)=$P(GMRC(0),"^",7) I GMRCDT1'="ALL",$P(X,".",1)<GMRCDT1!($P(X,".",1)>GMRCDT2) Q
"RTN","GMRCSLM1",52,0)
 I GMRCOER'=2 D
"RTN","GMRCSLM1",53,0)
 . S BLK=BLK+1
"RTN","GMRCSLM1",54,0)
 . S ^TMP("GMRCR",$J,"CS","AD",BLK,LNCT,GMRCDA)=""
"RTN","GMRCSLM1",55,0)
 D REGDTM^GMRCU S CDT=$P(X," ")
"RTN","GMRCSLM1",56,0)
 S PROC=$S($P(GMRC(0),U,17)="P":"Procedure",1:"Consult")
"RTN","GMRCSLM1",57,0)
 I PROC'="Consult" S PROC=$$GET1^DIQ(123.3,+$P(GMRC(0),"^",8),.01)
"RTN","GMRCSLM1",58,0)
 S:PROC="" PROC="Consult"
"RTN","GMRCSLM1",59,0)
 S TO=+$P(GMRC(0),"^",5)
"RTN","GMRCSLM1",60,0)
 I +TO S TOD=$S($P($G(^GMR(123.5,+TO,0)),"^",2)=9:1,1:0)
"RTN","GMRCSLM1",61,0)
 I '$D(TOD) S TOD=0
"RTN","GMRCSLM1",62,0)
 S TO=$S(+TO:$P($G(^GMR(123.5,+TO,0)),"^",1),1:"")
"RTN","GMRCSLM1",63,0)
 S TO=$S(TOD:"<",1:"")_TO
"RTN","GMRCSLM1",64,0)
 S TO=$S(GMRCOER:TO,1:$E(TO,1,40))_$S(TOD:">",1:"")
"RTN","GMRCSLM1",65,0)
 I '$L(TO) S TO="**Unknown Service**"
"RTN","GMRCSLM1",66,0)
 S STS=$P(GMRC(0),"^",12) D
"RTN","GMRCSLM1",67,0)
 . I '+STS,'$D(^ORD(100.01,+STS,0)) Q
"RTN","GMRCSLM1",68,0)
 . I '+GMRCOER S STS=$P(^ORD(100.01,+STS,.1),"^",1) Q
"RTN","GMRCSLM1",69,0)
 . I GMRCOER=1 S STS=$P(^ORD(100.01,+STS,0),"^") Q
"RTN","GMRCSLM1",70,0)
 . S STS=$P(^ORD(100.01,+STS,.1),"^")
"RTN","GMRCSLM1",71,0)
 I $S(STS="":1,'$D(^ORD(100.01,+$P(GMRC(0),"^",12),0)):1,1:0) S STS=99,$P(GMRC(0),"^",12)=STS,STS=$S(GMRCOER=1:$P(^ORD(100.01,5,0),"^",1),1:$P(^ORD(100.01,+STS,.1),"^",1))
"RTN","GMRCSLM1",72,0)
 D SERVPROC
"RTN","GMRCSLM1",73,0)
 I 'GMRCOER D  Q
"RTN","GMRCSLM1",74,0)
 . S ^TMP("GMRCR",$J,"CS",LNCT,0)=BLK_$E(TAB,1,(4-$L(BLK)))_CDT_"  "_$E(STS,1,3)_$S(STS?1A:"  ",STS?2A:" ",1:"")_" "_$J(GMRCDA,7)_" "_$S($P(GMRC(0),"^",19)="Y":"*",1:" ")_TITLE
"RTN","GMRCSLM1",75,0)
 . S LNCT=LNCT+1
"RTN","GMRCSLM1",76,0)
 I GMRCOER D
"RTN","GMRCSLM1",77,0)
 . N DATA
"RTN","GMRCSLM1",78,0)
 . S DATA=GMRCDA_U_GMRCFMDT_U_STS_U_TO_U_PROC_U
"RTN","GMRCSLM1",79,0)
 . S DATA=DATA_$S($P(GMRC(0),U,19)="Y":"*",1:"")_U
"RTN","GMRCSLM1",80,0)
 . S DATA=DATA_TITLE_U_$P(GMRC(0),U,3)
"RTN","GMRCSLM1",81,0)
 . D  ;get type of record for proper icon in GUI
"RTN","GMRCSLM1",82,0)
 .. ; "C"=reg cons, "P"=reg proc, "M"=clin proc, "I"=IF cons, "R"=IF proc
"RTN","GMRCSLM1",83,0)
 .. I +$G(^GMR(123,GMRCDA,1)) S $P(DATA,U,9)="M" Q
"RTN","GMRCSLM1",84,0)
 .. S $P(DATA,U,9)=$P(GMRC(0),U,17)
"RTN","GMRCSLM1",85,0)
 .. N GMRCGVER
"RTN","GMRCSLM1",86,0)
 .. S GMRCGVER=$P($G(ORWCLVER),".",3,4) ;GUI version running
"RTN","GMRCSLM1",87,0)
 .. I GMRCGVER'>19.1 Q  ;will crash at less than 19.1
"RTN","GMRCSLM1",88,0)
 .. I $P(GMRC(0),U,23) S $P(DATA,U,9)=$S($P(DATA,U,9)="P":"R",1:"I")
"RTN","GMRCSLM1",89,0)
 . S ^TMP("GMRCR",$J,"CS",LNCT,0)=DATA
"RTN","GMRCSLM1",90,0)
 . S LNCT=LNCT+1
"RTN","GMRCSLM1",91,0)
 . K STSOER Q
"RTN","GMRCSLM1",92,0)
 Q
"RTN","GMRCSLM1",93,0)
END I LNCT<2 S (BLK,LNCT,GMRCNUL)=1,GMRCNPM="< PATIENT DOES NOT HAVE ANY CONSULTS/REQUESTS "_$S($D(GMRCPRNM):"FOR "_GMRCPRNM,1:"")_" ON FILE. >",GMRCNPM=$E(TAB,1,(80-$L(GMRCNPM))\80)_GMRCNPM,^TMP("GMRCR",$J,"CS",LNCT,0)=GMRCNPM D
"RTN","GMRCSLM1",94,0)
 .I $D(GMRCDT1)&($D(GMRCDT2)),GMRCDT1'="ALL" S LNCT=LNCT+1,^TMP("GMRCR",$J,"CS",LNCT,0)="Between Dates: "_$$FMTE^XLFDT(GMRCDT1)_" and "_$$FMTE^XLFDT(GMRCDT2)
"RTN","GMRCSLM1",95,0)
 .I $D(GMRCSTCK),$L(GMRCSTCK) S LNCT=LNCT+1,^TMP("GMRCR",$J,"CS",LNCT,0)="With Status: " S STS="" F I=1:1 S STS=$P(GMRCSTCK,",",I) Q:STS=""  S ^TMP("GMRCR",$J,"CS",LNCT,0)=^(0)_$P($G(^ORD(100.01,+STS,0)),"^",1)_" "
"RTN","GMRCSLM1",96,0)
 .Q
"RTN","GMRCSLM1",97,0)
 E  S (BLK,LNCT)=LNCT-1,^TMP("GMRCR",$J,"CS",0)="^^^"_LNCT
"RTN","GMRCSLM1",98,0)
 I $D(GMRCALFL) S (BLK,LNCT)=1
"RTN","GMRCSLM1",99,0)
 K TO,TOD,END,FLG,GMRC(0),GMRCD,GMRCDG,GMRCIFN,GMRCFMDT,GMRCNPM,GMRCWARD
"RTN","GMRCSLM1",100,0)
 K I,PROC,STS,URG
"RTN","GMRCSLM1",101,0)
 Q
"RTN","GMRCSLM1",102,0)
OER(DFN,GMRCDG,GMRCDT1,GMRCDT2,GMRCSTCK,GMRCOER) ;;GUI interface for CPRS
"RTN","GMRCSLM1",103,0)
 ;;DFN=Patient internal file number
"RTN","GMRCSLM1",104,0)
 ;;GMRCDG:  Internal file number of consult service from file 123.5
"RTN","GMRCSLM1",105,0)
 ;;GMRCDT1:  Beginning date for lookup
"RTN","GMRCSLM1",106,0)
 ;;GMRCDT2:  Ending date for lookup
"RTN","GMRCSLM1",107,0)
 ;;GMRCSTCK: IEN from OER Status File [^OER(100.01)] to screen results
"RTN","GMRCSLM1",108,0)
 ;;     so that only consults with a desired status are displayed
"RTN","GMRCSLM1",109,0)
 ;;     Can be sent as a set of statuses: i.e., 6,5,2
"RTN","GMRCSLM1",110,0)
 ;;      (GMRCSTCK=GMRC STATUS CHECK)
"RTN","GMRCSLM1",111,0)
 ;;GMRCOER=0 if request is from CONSULTS
"RTN","GMRCSLM1",112,0)
 ;;       =1 if request is for CPRS List Manager
"RTN","GMRCSLM1",113,0)
 ;;       =2 if for CPRS GUI
"RTN","GMRCSLM1",114,0)
 I GMRCDT1="" S GMRCDT1="ALL"
"RTN","GMRCSLM1",115,0)
 I GMRCDG="" S GMRCDG=$O(^GMR(123.5,"B","ALL SERVICES",0))
"RTN","GMRCSLM1",116,0)
 S:'$D(GMRCOER) GMRCOER=1
"RTN","GMRCSLM1",117,0)
 D SERV1^GMRCASV,AD
"RTN","GMRCSLM1",118,0)
 K ^TMP("GMRCS",$J),^TMP("GMRCSLIST",$J)
"RTN","GMRCSLM1",119,0)
 Q
"RTN","GMRCSLM1",120,0)
SERVPROC ; Build contents of SERV/PROC field for List Manager
"RTN","GMRCSLM1",121,0)
 N TYPE,OTXT
"RTN","GMRCSLM1",122,0)
 S TITLE=""
"RTN","GMRCSLM1",123,0)
 S TYPE=""
"RTN","GMRCSLM1",124,0)
 S OTXT=$P($G(^GMR(123,GMRCDA,1.11)),"^")
"RTN","GMRCSLM1",125,0)
 I OTXT="" D BUILD2
"RTN","GMRCSLM1",126,0)
 I OTXT'="" D BUILD1
"RTN","GMRCSLM1",127,0)
 Q
"RTN","GMRCSLM1",128,0)
BUILD1 ;OTXT does contain information
"RTN","GMRCSLM1",129,0)
 N FLG,BADFLG,TPROC,TTO,LEN,ABBRS,ABBRP
"RTN","GMRCSLM1",130,0)
 S TPROC=$$UP^XLFSTR(PROC),TTO=$$UP^XLFSTR(TO)
"RTN","GMRCSLM1",131,0)
 S TITLE=OTXT,OTXT=$$UP^XLFSTR(OTXT)
"RTN","GMRCSLM1",132,0)
 S BADFLG=0
"RTN","GMRCSLM1",133,0)
 I PROC="Consult" S FLG=1,TYPE="Cons"
"RTN","GMRCSLM1",134,0)
 I PROC'="Consult" S FLG=0,TYPE="Proc"
"RTN","GMRCSLM1",135,0)
 S LEN=$L(TITLE)
"RTN","GMRCSLM1",136,0)
 I TO="" S TO="No Service"
"RTN","GMRCSLM1",137,0)
 I LEN<30,FLG=1,OTXT'=TTO S TITLE=TITLE_" "_TO_" "_TYPE Q
"RTN","GMRCSLM1",138,0)
 I LEN<30,FLG=1,OTXT=TTO S TITLE=TITLE_" "_TYPE Q
"RTN","GMRCSLM1",139,0)
 I TO["<" S BADFLG=1
"RTN","GMRCSLM1",140,0)
 S ABBRS=$$SVC^GMRCAU(GMRCDA),ABBRP=$$PROC^GMRCAU(GMRCDA)
"RTN","GMRCSLM1",141,0)
 I LEN<30,FLG=0,TPROC'=OTXT,TTO'=TPROC S TITLE=TITLE_" "_PROC_" "_TO_" "_TYPE Q
"RTN","GMRCSLM1",142,0)
 I LEN<30,FLG=0,TPROC=OTXT,TTO'=TPROC S TITLE=TITLE_" "_TO_" "_TYPE Q
"RTN","GMRCSLM1",143,0)
 I LEN<30,FLG=0,TPROC=OTXT,TTO=TPROC S TITLE=TITLE_" "_TYPE Q
"RTN","GMRCSLM1",144,0)
 I LEN>30,FLG=1,TTO'=OTXT S TITLE=TITLE_" "_TO_" "_TYPE Q
"RTN","GMRCSLM1",145,0)
 I LEN>30,FLG=1,TTO=OTXT S TITLE=TITLE_" "_TYPE Q
"RTN","GMRCSLM1",146,0)
 I LEN>30,FLG=0,TPROC'=OTXT,TTO'=TPROC S TITLE=TITLE_" "_ABBRP_" "_TYPE Q
"RTN","GMRCSLM1",147,0)
 I LEN>30,FLG=0,TTO'=OTXT,BADFLG=0 S TITLE=TITLE_" "_ABBRS_" "_TYPE Q
"RTN","GMRCSLM1",148,0)
 I LEN>30,FLG=0,TTO'=OTXT,BADFLG=1 S TITLE=TITLE_" "_"<"_ABBRS_">"_TYPE Q
"RTN","GMRCSLM1",149,0)
 Q
"RTN","GMRCSLM1",150,0)
BUILD2 ;OTXT contains no information
"RTN","GMRCSLM1",151,0)
 N FLG,TPROC,TTO,LEN
"RTN","GMRCSLM1",152,0)
 S TPROC=$$UP^XLFSTR(PROC),TTO=$$UP^XLFSTR(TO)
"RTN","GMRCSLM1",153,0)
 I PROC="Consult" S TITLE=TO,LEN=$L(TITLE),FLG=1,TYPE="Cons"
"RTN","GMRCSLM1",154,0)
 I PROC'="Consult" S TITLE=PROC,LEN=$L(TITLE),FLG=0,TYPE="Proc"
"RTN","GMRCSLM1",155,0)
 I FLG=1 S TITLE=TITLE_" "_TYPE Q
"RTN","GMRCSLM1",156,0)
 I FLG=0,TTO=TPROC S TITLE=TITLE_" "_TYPE Q
"RTN","GMRCSLM1",157,0)
 I FLG=0,TTO'=TPROC S TITLE=TITLE_" "_TO_" "_TYPE Q
"RTN","GMRCSLM1",158,0)
 Q
"RTN","GMRCSLMA")
0^2^B13581833^B13426803
"RTN","GMRCSLMA",1,0)
GMRCSLMA ;SLC/DLT - List Manager protocol entry, exit actions ; 11/25/2000
"RTN","GMRCSLMA",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**4,18,63**;DEC 27, 1997;Build 10
"RTN","GMRCSLMA",3,0)
 ; This routine invokes IA #875,#2638
"RTN","GMRCSLMA",4,0)
 ;Variables used in entry and exit actions
"RTN","GMRCSLMA",5,0)
 ; GMRCALFL is 1 flags the action is executing from an alert
"RTN","GMRCSLMA",6,0)
 ;        set logic is GMRCALFL=$S($D(XQAID)&($D(XQADATA):1,1:0)
"RTN","GMRCSLMA",7,0)
 ; VALMBCK="R" to refresh screen
"RTN","GMRCSLMA",8,0)
 ;        =NULL to clear bottom portion of screen and prompt for action
"RTN","GMRCSLMA",9,0)
 ;        =Q to exit List manager
"RTN","GMRCSLMA",10,0)
 ; GMRC("NMBR") = the currently highlighed entry in the list
"RTN","GMRCSLMA",11,0)
 ; BLK=
"RTN","GMRCSLMA",12,0)
 ; LNCT= Set to 1 if the GMRCALFL flag is 1
"RTN","GMRCSLMA",13,0)
 ; GMRCQUT= if defined than exit list manager?
"RTN","GMRCSLMA",14,0)
 ; GMRCEN = defined if branched to date range prompt by EN^GMRCSLM
"RTN","GMRCSLMA",15,0)
 ; GMRCOER= used to indicate whether CPRS or consults initiated action
"RTN","GMRCSLMA",16,0)
 ;         0 for Consults List Manager
"RTN","GMRCSLMA",17,0)
 ;         1 for GUI
"RTN","GMRCSLMA",18,0)
 ;         2 for CPRS Consults tab to Detailed Display
"RTN","GMRCSLMA",19,0)
 ; ^TMP("GMRC",$J,"CURRENT","MENU"))= the action menu for user
"RTN","GMRCSLMA",20,0)
 ;        based on the service by EN^GMRCMENU
"RTN","GMRCSLMA",21,0)
 ;Entry points called:
"RTN","GMRCSLMA",22,0)
 ;  AD^GMRCSLM1  ;Loop through AD cross-reference doing SET
"RTN","GMRCSLMA",23,0)
 ;  SET^GMRCSLM1 ;Format entries into ^TMP("GMRCR",$J,"CS"
"RTN","GMRCSLMA",24,0)
 ;  INIT^GMRCSLM ;Initialize variables and list array
"RTN","GMRCSLMA",25,0)
 ;  END^GMRCSLM1 ;Resets BLK and LNCT and kills variables
"RTN","GMRCSLMA",26,0)
 ;  HDR^GMRCSLM  ;Reset the VALMHDR values
"RTN","GMRCSLMA",27,0)
 ;  AGAIN^GMRCSLMV(GMRC("NMBR")) ;Reset the video attribute only, do not redisplay
"RTN","GMRCSLMA",28,0)
 ;  RESET^GMRCSLMV(GMRC("NMBR")) ;turn reverse video off when another item is selected
"RTN","GMRCSLMA",29,0)
 ;
"RTN","GMRCSLMA",30,0)
ENTRY(TYPE) ; -- Entry action for list manager actions
"RTN","GMRCSLMA",31,0)
 ;Actions: RT,DT
"RTN","GMRCSLMA",32,0)
 ;TYPE="" when the list and header have no change
"RTN","GMRCSLMA",33,0)
 ;TYPE["L"
"RTN","GMRCSLMA",34,0)
 ;    Assumes Rebuild the list due to change in the list information
"RTN","GMRCSLMA",35,0)
 ;    Use for GMRCACT CANCEL REQUEST, GMRCACT DISCONTINUE
"RTN","GMRCSLMA",36,0)
 ;            GMRCACT COMPLETE,GMRCACT EDIT/RESUBMIT
"RTN","GMRCSLMA",37,0)
 ;TYPE["H"
"RTN","GMRCSLMA",38,0)
 ;    Assumes need to rebuild the header too due to change in the list
"RTN","GMRCSLMA",39,0)
 ;        manager used while processing the action
"RTN","GMRCSLMA",40,0)
 ;    Use for GMRCACT COMPLETE, DD, RT, since it goes to TIU
"RTN","GMRCSLMA",41,0)
 S VALMBCK="R"
"RTN","GMRCSLMA",42,0)
 ;Q:$D(GMRCQUT)
"RTN","GMRCSLMA",43,0)
 ;
"RTN","GMRCSLMA",44,0)
 I $D(GMRCALFL) D  Q  ;Processing from an alert, quit
"RTN","GMRCSLMA",45,0)
 . K ^TMP("GMRCR",$J,"CS"),GMRCDA
"RTN","GMRCSLMA",46,0)
 . S BLK=0,LNCT=1
"RTN","GMRCSLMA",47,0)
 . S VALMBCK="R"
"RTN","GMRCSLMA",48,0)
 . D SET^GMRCSLM1
"RTN","GMRCSLMA",49,0)
 . D INIT^GMRCSLM
"RTN","GMRCSLMA",50,0)
 . S VALMCNT=1
"RTN","GMRCSLMA",51,0)
 . ;D END^GMRCSLM1 ;cancel,receive
"RTN","GMRCSLMA",52,0)
 . Q
"RTN","GMRCSLMA",53,0)
 ;
"RTN","GMRCSLMA",54,0)
 ;Processing from Consults action
"RTN","GMRCSLMA",55,0)
 I $G(TYPE)["L" D AD^GMRCSLM1,INIT^GMRCSLM S VALMBG=1
"RTN","GMRCSLMA",56,0)
 I $G(TYPE)["H" D HDR^GMRCSLM,INIT^GMRCSLM
"RTN","GMRCSLMA",57,0)
 Q
"RTN","GMRCSLMA",58,0)
 ;alert logic not flushed out
"RTN","GMRCSLMA",59,0)
 ;. I $G(TYPE)["L" D
"RTN","GMRCSLMA",60,0)
 ;. . ; rebuild the list
"RTN","GMRCSLMA",61,0)
 ;. . K ^TMP("GMRCR",$J,"CS")
"RTN","GMRCSLMA",62,0)
 ;. . D SET^GMRCSLM1
"RTN","GMRCSLMA",63,0)
 ;. . D INIT^GMRCSLM
"RTN","GMRCSLMA",64,0)
 ;. I $G(TYPE)["H" D HDR^GMRCSLM,INIT^GMRCSLM
"RTN","GMRCSLMA",65,0)
 ;. I $G(TYPE)["L" D END^GMRCSLM1 ;cancel,receive
"RTN","GMRCSLMA",66,0)
 ;. Q
"RTN","GMRCSLMA",67,0)
 ;
"RTN","GMRCSLMA",68,0)
EXIT(LINE) ; -- Exit action for list manager to refresh screen and reset the menu
"RTN","GMRCSLMA",69,0)
 ;Actions using this: RT,DT
"RTN","GMRCSLMA",70,0)
 ;LINE contains "A" Re-highlight line on list
"RTN","GMRCSLMA",71,0)
 ;LINE contains "R" Remove highlight on list
"RTN","GMRCSLMA",72,0)
 ;Used by GMRCACT CANCEL REQUEST,GMRCACT COMMENT ORDERS,
"RTN","GMRCSLMA",73,0)
 ;        GMRCACT EDIT/RESUBMIT
"RTN","GMRCSLMA",74,0)
 I "A"[LINE,$D(GMRC("NMBR")) D AGAIN^GMRCSLMV(GMRC("NMBR")) ;DD entry and RD exit action
"RTN","GMRCSLMA",75,0)
 I "R"[LINE,$D(GMRC("NMBR")) D RESET^GMRCSLMV(GMRC("NMBR")) K GMRC("NMBR")
"RTN","GMRCSLMA",76,0)
 S VALMBCK="R"
"RTN","GMRCSLMA",77,0)
 S:$D(^TMP("GMRC",$J,"CURRENT","MENU")) XQORM("HIJACK")=^("MENU")
"RTN","GMRCSLMA",78,0)
 S VALMBG=1
"RTN","GMRCSLMA",79,0)
 K GMRCSEL,GMRCO,GMRCND
"RTN","GMRCSLMA",80,0)
 Q
"RTN","GMRCSLMA",81,0)
 ;
"RTN","GMRCSLMA",82,0)
PHDR ; -- protocol header code called from the protocol action menus
"RTN","GMRCSLMA",83,0)
 ;S VALMSG=$$MSG
"RTN","GMRCSLMA",84,0)
 D SHOW^VALM
"RTN","GMRCSLMA",85,0)
 S XQORM("#")=$O(^ORD(101,"B","GMRC SELECT ITEM",0))_"^1:"_VALMCNT
"RTN","GMRCSLMA",86,0)
 S XQORM("A")="Select: "
"RTN","GMRCSLMA",87,0)
 S XQORM("KEY","EX")=$O(^ORD(101,"B","GMRCACT QUIT",0))_"^1"
"RTN","GMRCSLMA",88,0)
 S XQORM("KEY","Q")=$O(^ORD(101,"B","GMRCACT QUIT",0))_"^1"
"RTN","GMRCSLMA",89,0)
 S XQORM("KEY","CLOSE")=$O(^ORD(101,"B","GMRCACT QUIT",0))_"^1"
"RTN","GMRCSLMA",90,0)
 S XQORM("KEY","NX")=$O(^ORD(101,"B","GMRCACT NEXT SCREEN",0))_"^1"
"RTN","GMRCSLMA",91,0)
 S XQORM("KEY","NEXT")=$O(^ORD(101,"B","GMRCACT NEXT SCREEN",0))_"^1"
"RTN","GMRCSLMA",92,0)
 S XQORM("KEY","PS")=$O(^ORD(101,"B","GMRCACT PRINT CONSULT FORM",0))_"^1"
"RTN","GMRCSLMA",93,0)
 S XQORM("KEY","CM")=$O(^ORD(101,"B","GMRCACT COMMENT ORDERS",0))_"^1"
"RTN","GMRCSLMA",94,0)
 K GMRCNMBR
"RTN","GMRCSLMA",95,0)
 Q
"RTN","GMRCSLMA",96,0)
 ;I '+$G(OVRRIDE),$$VALID^GMRCAU(+$G(GMRCSS)) D  ;set 2.5 mnem's into XQORM("KEY")
"RTN","GMRCSLMA",97,0)
 ;. S XQORM("KEY","AC")="$O(^ORD(101,"B","GMRCACT ADMIN COMPLETE",0)_"^1"
"RTN","GMRCSLMA",98,0)
 ;. S XQORM("KEY","DY")=$O(^ORD(101,"B","GMRCACT CANCEL",0))_"^1"
"RTN","GMRCSLMA",99,0)
 ;. S XQORM("KEY","ED")=$O(^ORD(101,"B","GMRC CHANGE ORDERS",0))_"^1"
"RTN","GMRCSLMA",100,0)
 Q
"RTN","GMRCSLMA",101,0)
MSG() ; -- LMgr message bar
"RTN","GMRCSLMA",102,0)
 Q "Enter the number of the item you wish to act on, or select an action."
"RTN","GMRCSLMA",103,0)
 ;
"RTN","GMRCSLMA",104,0)
MARGIN ; -- Reset bottom margin if menu display off
"RTN","GMRCSLMA",105,0)
 N BM S BM=$S(VALMMENU:17,1:21) Q:BM=VALM("BM")  ; no change
"RTN","GMRCSLMA",106,0)
 S VALM("BM")=BM,VALM("LINES")=VALM("BM")-VALM("TM")+1,VALMBCK="R"
"RTN","GMRCSLMA",107,0)
 Q
"RTN","GMRCSLMA",108,0)
 ;
"RTN","GMRCSLMA",109,0)
SELEXIT ; -- Exit action for list manager when selection criteria changed
"RTN","GMRCSLMA",110,0)
 S:$D(^TMP("GMRC",$J,"CURRENT","MENU")) XQORM("HIJACK")=^("MENU")
"RTN","GMRCSLMA",111,0)
 S VALMBCK="R"
"RTN","GMRCSLMA",112,0)
 Q:($D(GMRCQUT)!$D(GMRCQUIT))  ;status exit using GMRCQUIT??
"RTN","GMRCSLMA",113,0)
 I $D(GMRC("NMBR")) D RESET^GMRCSLMV(GMRC("NMBR")) K GMRC("NMBR")
"RTN","GMRCSLMA",114,0)
 D AD^GMRCSLM1
"RTN","GMRCSLMA",115,0)
 D INIT^GMRCSLM ;from select patient, select service
"RTN","GMRCSLMA",116,0)
 D HDR^GMRCSLM  ;from select patient, select date range
"RTN","GMRCSLMA",117,0)
 K GMRCSEL,GMRCO,GMRCND
"RTN","GMRCSLMA",118,0)
 Q
"RTN","GMRCSLMA",119,0)
 ;
"RTN","GMRCSRVS")
0^3^B67442979^B67385586
"RTN","GMRCSRVS",1,0)
GMRCSRVS ;SLC/DCM,JFR - Add/Edit services in File 123.5. ;6/14/00 12:00
"RTN","GMRCSRVS",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,16,40,53,63**;DEC 27, 1997;Build 10
"RTN","GMRCSRVS",3,0)
 ;
"RTN","GMRCSRVS",4,0)
EN ;set up services entry point
"RTN","GMRCSRVS",5,0)
 ;GMRCOLDU=Service Usage field. If changed, GMRCOLDU shows the change (See ^DD(123.5,2,0) for field description).
"RTN","GMRCSRVS",6,0)
 N GMRCSAFE,GMRCOLDU,GMRCOLDS,GMRCOSNM,GMRCSRVC,GMRCACT,GMRCSSNM
"RTN","GMRCSRVS",7,0)
 N DIC,DLAYGO,DUOUT,DTOUT
"RTN","GMRCSRVS",8,0)
 S DIC="^GMR(123.5,",DLAYGO=123.5,DIC(0)="AELMQZ",DIC("A")="Select Service/Specialty:"
"RTN","GMRCSRVS",9,0)
 D ^DIC I $S(Y<0:1,$D(DTOUT):1,$D(DUOUT):1,1:0) D END K GMRCMSG,DTOUT,DUOUT Q
"RTN","GMRCSRVS",10,0)
 D
"RTN","GMRCSRVS",11,0)
 .S GMRCSAFE=+$G(^GMR(123.5,+Y,"INT"))
"RTN","GMRCSRVS",12,0)
 .S (DA,GMRCSRVC)=+Y,GMRCOSNM=$P(Y,"^",2),(GMRCOLDU,GMRCOLDS)=""
"RTN","GMRCSRVS",13,0)
 .S GMRCACT=$S('$O(^GMR(123.5,+Y,0)):"MAD",1:"MUP"),GMRCOLDU=$P(^(0),"^",2),GMRCOLDN=$P(^(0),"^",1) S ND=0,GMRCOLDS="" F  S ND=$O(^GMR(123.5,+Y,2,ND)) Q:ND?1A.E!(ND="")  S GMRCOLDS=GMRCOLDS_^GMR(123.5,+Y,2,ND,0)_"^"
"RTN","GMRCSRVS",14,0)
 .S DIE=DIC,DR="[GMRC SETUP REQUEST SERVICE]",DIE("NO^")="OUTOK"
"RTN","GMRCSRVS",15,0)
 .D ^DIE
"RTN","GMRCSRVS",16,0)
 .Q
"RTN","GMRCSRVS",17,0)
 I $D(DA) S GMRCACT=$S($P(^GMR(123.5,GMRCSRVC,0),"^",2)=9:"MDC",$P(^(0),"^",2)=1:"MDC",1:GMRCACT) D
"RTN","GMRCSRVS",18,0)
 .S GMRCSSNM=$P(^GMR(123.5,GMRCSRVC,0),"^",1)
"RTN","GMRCSRVS",19,0)
 .I GMRCACT'="MAD",GMRCSSNM'=GMRCOSNM S GMRCACT="MUP"
"RTN","GMRCSRVS",20,0)
 .I $S(GMRCACT'="MAD":1,GMRCACT'="MUP":1,1:0),$L(GMRCOLDU),GMRCOLDU=$P(^GMR(123.5,GMRCSRVC,0),"^",2) S GMRCACT="NOACT"
"RTN","GMRCSRVS",21,0)
 .I $S(GMRCACT="MUP":1,GMRCACT="NOACT":1,1:0),GMRCOLDN'=$P(^GMR(123.5,GMRCSRVC,0),"^",1) S GMRCACT="MUP"
"RTN","GMRCSRVS",22,0)
 .S ND=0 F  S ND=$O(^GMR(123.5,GMRCSRVC,2,ND)) Q:ND?1A.E!(ND="")  I GMRCOLDS'=""&(^GMR(123.5,GMRCSRVC,2,ND,0)'=""),GMRCOLDS'[^GMR(123.5,GMRCSRVC,2,ND,0) S GMRCACT="MUP" Q
"RTN","GMRCSRVS",23,0)
 .I $S(GMRCACT="MAD":1,GMRCACT="MUP":1,GMRCACT="MDC":1,1:0) D SVC^GMRC101H(GMRCSRVC,GMRCSSNM,GMRCACT),MSG^XQOR("GMRC ORDERABLE ITEM UPDATE",.GMRCMSG)
"RTN","GMRCSRVS",24,0)
 .D PTRCLN^GMRCU
"RTN","GMRCSRVS",25,0)
 .Q
"RTN","GMRCSRVS",26,0)
 K GMRCMSG,GMRCSSNM,GMRCSRVS,GMRCOLDN,GMRCOLDS,GMRCOLDU,ND
"RTN","GMRCSRVS",27,0)
 ;Ask to continue...
"RTN","GMRCSRVS",28,0)
 ;
"RTN","GMRCSRVS",29,0)
 N GMRC0,GMRCA,GMRCB,GMRCH,GMRCL
"RTN","GMRCSRVS",30,0)
 S GMRC0="YA",GMRCA="Add/Edit Another Service? ",GMRCB="NO"
"RTN","GMRCSRVS",31,0)
 S GMRCH="Enter 'YES' to add/edit another service, or 'NO' to exit."
"RTN","GMRCSRVS",32,0)
 S GMRCL=2
"RTN","GMRCSRVS",33,0)
 I '+$$READ(GMRC0,GMRCA,GMRCB,GMRCH,GMRCL) D END Q
"RTN","GMRCSRVS",34,0)
 G EN
"RTN","GMRCSRVS",35,0)
 ;
"RTN","GMRCSRVS",36,0)
END K DIC,DIE,DTOUT,DUOUT,DA,DR,FL,GMRCACT,GMRCANS,GMRCMSG,GMRCREA,GMRCSRVC,GMRCSSNM,REVCODE,RLEVCODE,Y
"RTN","GMRCSRVS",37,0)
 Q
"RTN","GMRCSRVS",38,0)
 ;
"RTN","GMRCSRVS",39,0)
READ(GMRC0,GMRCA,GMRCB,GMRCH,GMRCL,GMRCS) ;
"RTN","GMRCSRVS",40,0)
 ;
"RTN","GMRCSRVS",41,0)
 ;  GMRC0 -> DIR(0) --- Type of read
"RTN","GMRCSRVS",42,0)
 ;  GMRCA -> DIR("A") - Prompt
"RTN","GMRCSRVS",43,0)
 ;  GMRCB -> DIR("B") - Default Answer
"RTN","GMRCSRVS",44,0)
 ;  GMRCH -> DIR("?") - Help text or ^Execute code
"RTN","GMRCSRVS",45,0)
 ;  GMRCS -> DIR("S") - Screen
"RTN","GMRCSRVS",46,0)
 ;  GMRCL -> Number of blank lines to put before Prompt
"RTN","GMRCSRVS",47,0)
 ;
"RTN","GMRCSRVS",48,0)
 ;  Returns "^" or answer
"RTN","GMRCSRVS",49,0)
 ;
"RTN","GMRCSRVS",50,0)
 N GMRCLINE,DIR,DTOUT,DUOUT,DIRUT,DIROUT,X,Y
"RTN","GMRCSRVS",51,0)
 Q:'$L($G(GMRC0)) U
"RTN","GMRCSRVS",52,0)
 S DIR(0)=GMRC0
"RTN","GMRCSRVS",53,0)
 S:$L($G(GMRCA)) DIR("A")=GMRCA
"RTN","GMRCSRVS",54,0)
 I $D(GMRCA("A")) M DIR("A")=GMRCA("A")
"RTN","GMRCSRVS",55,0)
 S:$L($G(GMRCB)) DIR("B")=GMRCB
"RTN","GMRCSRVS",56,0)
 I $D(GMRCH("?")) M DIR("?")=GMRCH("?")
"RTN","GMRCSRVS",57,0)
 S:$L($G(GMRCH)) DIR("?")=GMRCH
"RTN","GMRCSRVS",58,0)
 S:$L($G(GMRCS)) DIR("S")=GMRCS
"RTN","GMRCSRVS",59,0)
 F GMRCLINE=1:1:($G(GMRCL)-1) W !
"RTN","GMRCSRVS",60,0)
 D ^DIR
"RTN","GMRCSRVS",61,0)
 I $D(DTOUT)!$D(DUOUT)!$D(DIRUT)!$D(DIROUT) Q U
"RTN","GMRCSRVS",62,0)
 Q Y
"RTN","GMRCSRVS",63,0)
 ;
"RTN","GMRCSRVS",64,0)
NOED(SERV) ;
"RTN","GMRCSRVS",65,0)
 I '$D(^GMR(123.5,+SERV,0)) Q 0
"RTN","GMRCSRVS",66,0)
 N NAME
"RTN","GMRCSRVS",67,0)
 S NAME=$P(^GMR(123.5,+SERV,0),U)
"RTN","GMRCSRVS",68,0)
 I NAME="PROSTHETICS REQUEST" Q 1
"RTN","GMRCSRVS",69,0)
 I NAME="EYEGLASS REQUEST" Q 1
"RTN","GMRCSRVS",70,0)
 I NAME="CONTACT LENS REQUEST" Q 1
"RTN","GMRCSRVS",71,0)
 I NAME="HOME OXYGEN REQUEST" Q 1
"RTN","GMRCSRVS",72,0)
 Q 0
"RTN","GMRCSRVS",73,0)
 ;
"RTN","GMRCSRVS",74,0)
CLONPSAS ; clone a PROSTHETICS service
"RTN","GMRCSRVS",75,0)
 ; choose service and text to append
"RTN","GMRCSRVS",76,0)
 N GMRCSIEN,GMRCROOT,GMRCNWNM
"RTN","GMRCSRVS",77,0)
 N GMRCCPY,GMRCNEW,FDA,GMRCERR,GMRC
"RTN","GMRCSRVS",78,0)
 S GMRC(0)="PAO^GMR(123.5,:AEMQ"
"RTN","GMRCSRVS",79,0)
 S GMRC("A")="Select the Prosthetics Service to clone: "
"RTN","GMRCSRVS",80,0)
 S GMRC("S")="I $$NOED^GMRCSRVS(+Y)"
"RTN","GMRCSRVS",81,0)
 S GMRCCPY=+$$READ(GMRC(0),GMRC("A"),,,2,GMRC("S"))
"RTN","GMRCSRVS",82,0)
 I 'GMRCCPY Q
"RTN","GMRCSRVS",83,0)
 K GMRC
"RTN","GMRCSRVS",84,0)
 S GMRCNWNM=$$GETAPP(GMRCCPY)
"RTN","GMRCSRVS",85,0)
 I '$L(GMRCNWNM) Q
"RTN","GMRCSRVS",86,0)
 S FDA(1,123.5,"+1,",.01)=GMRCNWNM
"RTN","GMRCSRVS",87,0)
 S FDA(1,123.5,"+1,",2)="DISABLED"
"RTN","GMRCSRVS",88,0)
 S FDA(1,123.5,"+1,",1.01)="REQUIRE"
"RTN","GMRCSRVS",89,0)
 S FDA(1,123.5,"+1,",1.02)="LEXICON"
"RTN","GMRCSRVS",90,0)
 S FDA(1,123.5,"+1,",123.01)="CONSULTS"
"RTN","GMRCSRVS",91,0)
 S FDA(1,123.5,"+1,",123.03)="GMRCACTM SERVICE ACTION MENU"
"RTN","GMRCSRVS",92,0)
 S FDA(1,123.5,"+1,",131)="YES"
"RTN","GMRCSRVS",93,0)
 D UPDATE^DIE("E","FDA(1)","GMRCNEW","GMRCERR")
"RTN","GMRCSRVS",94,0)
 I '$D(GMRCNEW) W !,"Failed to create new entry. Please try again" Q
"RTN","GMRCSRVS",95,0)
 W !!,GMRCNWNM," created",!
"RTN","GMRCSRVS",96,0)
 S GMRCSIEN=GMRCNEW(1)_","
"RTN","GMRCSRVS",97,0)
 S GMRCROOT="^GMR(123.5,"_GMRCCPY_",124)"
"RTN","GMRCSRVS",98,0)
 D WP^DIE(123.5,GMRCSIEN,124,,GMRCROOT,"GMRCERR")
"RTN","GMRCSRVS",99,0)
 W !!,"The new Service is currently DISABLED. To activate this service for use in"
"RTN","GMRCSRVS",100,0)
 W !,"the Prosthetics interface, you MUST use the Setup Consult Services option"
"RTN","GMRCSRVS",101,0)
 W !,"and delete the DISABLED flag from the SERVICE USAGE field.",!
"RTN","GMRCSRVS",102,0)
 Q
"RTN","GMRCSRVS",103,0)
GETAPP(GMRIEN) ;get text to append
"RTN","GMRCSRVS",104,0)
 N GMRCNWNM,QTFLG,I,GMRC,GMRCHL,OK
"RTN","GMRCSRVS",105,0)
 S GMRCNWNM=""
"RTN","GMRCSRVS",106,0)
 F I=0:0 D  Q:$G(QTFLG)
"RTN","GMRCSRVS",107,0)
 . W !!
"RTN","GMRCSRVS",108,0)
 . S GMRC(0)="FA^3:40"
"RTN","GMRCSRVS",109,0)
 . S GMRC("A")="Enter text to append to national service name: "
"RTN","GMRCSRVS",110,0)
 . S GMRCHL("?",1)="The text entered will be appended to the name of the exported service"
"RTN","GMRCSRVS",111,0)
 . S GMRCHL("?")="(e.g. If HINES was entered it may appear as PROSTHETICS REQUEST - HINES"
"RTN","GMRCSRVS",112,0)
 . S GMRCNWNM=$$READ(GMRC(0),GMRC("A"),,.GMRCHL,2)
"RTN","GMRCSRVS",113,0)
 . I '$L(GMRCNWNM)!(GMRCNWNM["^") S GMRCNWNM="",QTFLG=1 Q
"RTN","GMRCSRVS",114,0)
 . K GMRC,GMRCHL
"RTN","GMRCSRVS",115,0)
 . S GMRCNWNM=$P(^GMR(123.5,GMRIEN,0),U)_" - "_GMRCNWNM
"RTN","GMRCSRVS",116,0)
 . I $$FIND1^DIC(123.5,,"X",GMRCNWNM) D  Q
"RTN","GMRCSRVS",117,0)
 .. W !!,$C(7),"This service already exists, you'll have to try again!",!
"RTN","GMRCSRVS",118,0)
 .. S GMRCNWNM=""
"RTN","GMRCSRVS",119,0)
 . W !,"The new service name will be:"
"RTN","GMRCSRVS",120,0)
 . W !,?5,GMRCNWNM,!
"RTN","GMRCSRVS",121,0)
 . S OK=+$$READ("Y","Is this OK",,,1)
"RTN","GMRCSRVS",122,0)
 . I OK=U S QTFLG=1 Q
"RTN","GMRCSRVS",123,0)
 . I 'OK S GMRCNWNM="" Q
"RTN","GMRCSRVS",124,0)
 . S QTFLG=1
"RTN","GMRCSRVS",125,0)
 Q GMRCNWNM
"RTN","GMRCSRVS",126,0)
INPUT(X,GMRCDA) ; INPUT TRANSFORM FOR THE SUB-SERVICE/SPECIALTY (#.01) FIELD
"RTN","GMRCSRVS",127,0)
 ; OF THE SUB-SERVICE (#123.51) FILE WHICH IS A SUB-FILE OF THE
"RTN","GMRCSRVS",128,0)
 ; SUB-SERVICE (#10) FIELD OF THE REQUEST SERVICES (#123.5) FILE.
"RTN","GMRCSRVS",129,0)
 ;
"RTN","GMRCSRVS",130,0)
 ; X = INTERNAL VALUE OF USER SELECTED SUB-SERVICE (IEN OF SERVICE
"RTN","GMRCSRVS",131,0)
 ;     IN FILE 123.5)
"RTN","GMRCSRVS",132,0)
 ; GMRCDA = IEN OF INITIAL PARENT SERVICE IN FILE 123.5
"RTN","GMRCSRVS",133,0)
 ;
"RTN","GMRCSRVS",134,0)
 I +$G(X)=0 K X Q
"RTN","GMRCSRVS",135,0)
 I GMRCDA<1 D  Q:'$D(X)
"RTN","GMRCSRVS",136,0)
 . S GMRCDA=+$G(D0)
"RTN","GMRCSRVS",137,0)
 . I GMRCDA<1 K X
"RTN","GMRCSRVS",138,0)
 N GMRPARNT,GMRCHILD,GMRQ,GMRCNT
"RTN","GMRCSRVS",139,0)
 K ^TMP("GMRC INPUT",$J) ;MAKE SURE INPUT PARENT LOG GLOBAL IS BLANK
"RTN","GMRCSRVS",140,0)
 I X=GMRCDA S GMRQ=1 G INPUTQ ;NOT ALLOW SERVICE AS A SUB-SERVICE TO ITSELF
"RTN","GMRCSRVS",141,0)
 S ^TMP("GMRC INPUT",$J,"B",GMRCDA)="" ;USED TO PREVENT DUPLICATE CHECKING OF PARENTS
"RTN","GMRCSRVS",142,0)
 S ^TMP("GMRC INPUT",$J,0)=1 ;USED TO FIND NEXT NUMBER FOR TMP GLOBAL ENTRY
"RTN","GMRCSRVS",143,0)
 S ^TMP("GMRC INPUT",$J,1)=GMRCDA ;PARENT IEN STORED TO BE USED AS CHILD
"RTN","GMRCSRVS",144,0)
 S (GMRCNT,GMRQ)=0
"RTN","GMRCSRVS",145,0)
 F  S GMRCNT=$O(^TMP("GMRC INPUT",$J,GMRCNT)) Q:'GMRCNT  D  Q:GMRQ=1
"RTN","GMRCSRVS",146,0)
 . S GMRCHILD=$G(^TMP("GMRC INPUT",$J,GMRCNT))
"RTN","GMRCSRVS",147,0)
 . S GMRPARNT=0
"RTN","GMRCSRVS",148,0)
 . F  S GMRPARNT=$O(^GMR(123.5,"APC",GMRCHILD,GMRPARNT)) Q:GMRPARNT=""  D  Q:GMRQ=1
"RTN","GMRCSRVS",149,0)
 .. I GMRPARNT=X S GMRQ=1 Q  ;NOT ALLOW SERVICE AS A SUB-SERVICE WITHIN IT'S SUB-SERVICE HIERARCHY
"RTN","GMRCSRVS",150,0)
 .. I '$D(^TMP("GMRC INPUT",$J,"B",GMRPARNT)) D  ;IF NOT IN LIST ADD
"RTN","GMRCSRVS",151,0)
 ... S ^TMP("GMRC INPUT",$J,"B",GMRPARNT)="" ;ADD TO "B" CROSS-REFERENCE
"RTN","GMRCSRVS",152,0)
 ... S ^TMP("GMRC INPUT",$J,0)=$G(^TMP("GMRC INPUT",$J,0))+1 ;INCREASE LAST NUMBER BY 1
"RTN","GMRCSRVS",153,0)
 ... S ^TMP("GMRC INPUT",$J,$G(^TMP("GMRC INPUT",$J,0)))=GMRPARNT ;ADD NEW PARENT SERVICE TO GLOBAL SO IT CAN BE CHECKED AS A CHILD ENTRY TO FIND IT'S PARENTS
"RTN","GMRCSRVS",154,0)
 K ^TMP("GMRC INPUT",$J)
"RTN","GMRCSRVS",155,0)
INPUTQ I GMRQ=1 D EN^DDIOL("A SERVICE CAN NOT BE A SUB-SERVICE OF ITSELF","","!!?12") K X Q
"RTN","GMRCSRVS",156,0)
 ;
"RTN","GMRCSRVS",157,0)
DUPCHK ;CHECK FOR CONSULT SERVICES APPEARING AS PART OF THE CONSULT SERVICE
"RTN","GMRCSRVS",158,0)
 ;HIERARCHY IN MORE THAN ONE PLACE
"RTN","GMRCSRVS",159,0)
 N ARRAY,COUNT,GMRCON,PARENT
"RTN","GMRCSRVS",160,0)
 S PARENT=0
"RTN","GMRCSRVS",161,0)
 ;Check if they are a sub-service to more than one service.
"RTN","GMRCSRVS",162,0)
 F COUNT=0:1 S PARENT=$O(^GMR(123.5,"APC",X,PARENT)) Q:'+PARENT
"RTN","GMRCSRVS",163,0)
 ;Print message about which services this service is a sub-service of.
"RTN","GMRCSRVS",164,0)
 I COUNT'>0 Q
"RTN","GMRCSRVS",165,0)
 S COUNT=1
"RTN","GMRCSRVS",166,0)
 S ARRAY(COUNT)=" ",COUNT=COUNT+1
"RTN","GMRCSRVS",167,0)
 S ARRAY(COUNT)=" ",COUNT=COUNT+1
"RTN","GMRCSRVS",168,0)
 S ARRAY="Service "_$P(^GMR(123.5,X,0),"^",1)_" is already a sub-service of:"
"RTN","GMRCSRVS",169,0)
 D PARSE(.ARRAY)
"RTN","GMRCSRVS",170,0)
 S PARENT=0
"RTN","GMRCSRVS",171,0)
 F  S PARENT=$O(^GMR(123.5,"APC",X,PARENT)) Q:'+PARENT  S ARRAY="   "_$P(^GMR(123.5,PARENT,0),"^",1) D PARSE(.ARRAY)
"RTN","GMRCSRVS",172,0)
 S ARRAY(COUNT)=" ",COUNT=COUNT+1
"RTN","GMRCSRVS",173,0)
 S ARRAY(COUNT)="A consult service appearing as part of the Consult service",COUNT=COUNT+1
"RTN","GMRCSRVS",174,0)
 S ARRAY(COUNT)="hierarchy in more than one place (i.e. a sub-service of more",COUNT=COUNT+1
"RTN","GMRCSRVS",175,0)
 S ARRAY(COUNT)="than one parent) has the potential to skew the results of the",COUNT=COUNT+1
"RTN","GMRCSRVS",176,0)
 S ARRAY(COUNT)="Consult Performance Monitor Report [GMRC RPT PERF MONITOR].",COUNT=COUNT+1
"RTN","GMRCSRVS",177,0)
 S ARRAY(COUNT)=" ",COUNT=COUNT+1
"RTN","GMRCSRVS",178,0)
 D EN^DDIOL(.ARRAY)
"RTN","GMRCSRVS",179,0)
 I '$G(DIQUIET) D
"RTN","GMRCSRVS",180,0)
 . S GMRCON=0
"RTN","GMRCSRVS",181,0)
 . D YESNO(X,Y)
"RTN","GMRCSRVS",182,0)
 . I 'GMRCON K X
"RTN","GMRCSRVS",183,0)
 . D EN^DDIOL(" ")
"RTN","GMRCSRVS",184,0)
 Q
"RTN","GMRCSRVS",185,0)
PARSE(ARRAY) ;TAKE ARRAY VALUE AND PARSE INTO PIECES SHORTER THAN 70 CHARACTERS
"RTN","GMRCSRVS",186,0)
 N ARRAYSP,GMRCNT
"RTN","GMRCSRVS",187,0)
PARSE1 I $L(ARRAY)'>70 S ARRAY(COUNT)=ARRAY,COUNT=COUNT+1 Q
"RTN","GMRCSRVS",188,0)
 F GMRCNT=70:-1 S ARRAYSP=$E(ARRAY,GMRCNT) I ARRAYSP=" " Q
"RTN","GMRCSRVS",189,0)
 S ARRAY(COUNT)=$E(ARRAY,1,GMRCNT-1),COUNT=COUNT+1
"RTN","GMRCSRVS",190,0)
 S ARRAY=$E(ARRAY,GMRCNT+1,9999)
"RTN","GMRCSRVS",191,0)
 G:ARRAY'="" PARSE1
"RTN","GMRCSRVS",192,0)
 Q
"RTN","GMRCSRVS",193,0)
YESNO(X,Y) ;YES/NO QUESTION/RESPONSE
"RTN","GMRCSRVS",194,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","GMRCSRVS",195,0)
 S DIR(0)="YA"
"RTN","GMRCSRVS",196,0)
 S DIR("A")="Do you wish to continue adding "_$P(^GMR(123.5,X,0),"^",1)_" as a new sub-service? "
"RTN","GMRCSRVS",197,0)
 S DIR("B")="NO"
"RTN","GMRCSRVS",198,0)
 S DIR("T")=300
"RTN","GMRCSRVS",199,0)
 S DIR("?",1)="Enter ""YES"" to add service as a sub-service."
"RTN","GMRCSRVS",200,0)
 S DIR("?")="Enter ""NO"" to NOT add the service as a sub-service."
"RTN","GMRCSRVS",201,0)
 D ^DIR Q:($G(DTOUT))!($G(DUOUT))!($G(DIROUT))
"RTN","GMRCSRVS",202,0)
 I Y=1 S GMRCON=1
"RTN","GMRCSRVS",203,0)
 Q
"RTN","GMRCSTL1")
0^4^B15110151^B17452945
"RTN","GMRCSTL1",1,0)
GMRCSTL1 ;SLC/DCM,dee;MA - List Manager Format Routine - Get Active Consults by service - pending,active,scheduled,incomplete,etc. ;11/13/02 08:30
"RTN","GMRCSTL1",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**7,21,22,29,63**;DEC 27, 1997;Build 10
"RTN","GMRCSTL1",3,0)
 ; Patch #21 changed array GMRCTOT to ^TMP("GMRCTOT,$J)
"RTN","GMRCSTL1",4,0)
 ; This routine invokes IA #875, #2638
"RTN","GMRCSTL1",5,0)
 Q
"RTN","GMRCSTL1",6,0)
STATNAME(STATUS) ;Return the name for the status number
"RTN","GMRCSTL1",7,0)
 I STATUS<9 Q $S(STATUS=1:"Discont.",STATUS=2:"Completed",STATUS=3:"On Hold",STATUS=4:"Flagged",STATUS=5:"Pending",STATUS=6:"Active",STATUS=7:"Expired",STATUS=8:"Scheduled",1:"No Status")
"RTN","GMRCSTL1",8,0)
 E  Q $S(STATUS=9:"Incomplete",STATUS=10:"Delayed",STATUS=11:"Unreleased",STATUS=12:"Discont/Ed",STATUS=13:"Cancelled",STATUS=14:"Lapsed",STATUS=15:"Renewed",1:"No Status")
"RTN","GMRCSTL1",9,0)
 Q
"RTN","GMRCSTL1",10,0)
 ;
"RTN","GMRCSTL1",11,0)
STATABBR(STATUS) ;Return the name for the status number
"RTN","GMRCSTL1",12,0)
 Q ^ORD(100.01,STATUS,.1)
"RTN","GMRCSTL1",13,0)
 ;
"RTN","GMRCSTL1",14,0)
LISTTOT(COUNT,GEN,INDEX,NAME,GROUPNAM,CONTROL,ARRN) ;
"RTN","GMRCSTL1",15,0)
 N LOOP,STATUS,STS,CTRLTEMP,GMRCTOTS,SP
"RTN","GMRCSTL1",16,0)
 S SP=""
"RTN","GMRCSTL1",17,0)
 S CTRLTEMP=$S(CONTROL#2:"^",1:"")
"RTN","GMRCSTL1",18,0)
 I GEN=2 D
"RTN","GMRCSTL1",19,0)
 . S COUNT=COUNT+1
"RTN","GMRCSTL1",20,0)
 . S ^TMP("GMRCR",$J,ARRN,COUNT,0)=CTRLTEMP
"RTN","GMRCSTL1",21,0)
 . S COUNT=COUNT+1
"RTN","GMRCSTL1",22,0)
 . S ^TMP("GMRCR",$J,ARRN,COUNT,0)=CTRLTEMP_"          GROUPER: "_NAME_" Totals:"
"RTN","GMRCSTL1",23,0)
 S GMRCTOTS=0
"RTN","GMRCSTL1",24,0)
 I $L(GMRCSTAT,",")=16 S GMRCTOTS=1 ;only incl. totals if all status
"RTN","GMRCSTL1",25,0)
 F LOOP=1:1:$L(GMRCSTAT,",") S STATUS=$P(GMRCSTAT,",",LOOP) I ^TMP("GMRCTOT",$J,GEN,INDEX,STATUS)>0 D
"RTN","GMRCSTL1",26,0)
 .S COUNT=COUNT+1
"RTN","GMRCSTL1",27,0)
 .S STS=$$STATNAME(STATUS)
"RTN","GMRCSTL1",28,0)
 .S ^TMP("GMRCR",$J,ARRN,COUNT,0)=CTRLTEMP_"Total Requests "_STS_": "_$J(^TMP("GMRCTOT",$J,GEN,INDEX,STATUS),42-$L(STS),0)
"RTN","GMRCSTL1",29,0)
 ;If any printed are pending then print the total that are pending for all pending status.
"RTN","GMRCSTL1",30,0)
 I ^TMP("GMRCTOT",$J,GEN,INDEX,"P")>0 D
"RTN","GMRCSTL1",31,0)
 .S COUNT=COUNT+1
"RTN","GMRCSTL1",32,0)
 .S ^TMP("GMRCR",$J,ARRN,COUNT,0)=CTRLTEMP_"Total Requests Pending Resolution: "_$J(^TMP("GMRCTOT",$J,GEN,INDEX,"P"),24,0)
"RTN","GMRCSTL1",33,0)
 ; IF Consults
"RTN","GMRCSTL1",34,0)
 I ARRN="IFC" D
"RTN","GMRCSTL1",35,0)
 .N IRFN,VALSVC,VALTOT S IRFN=""
"RTN","GMRCSTL1",36,0)
 .F  S IRFN=$O(^TMP("GMRCTOT",$J,GEN,INDEX,"F",IRFN)) Q:IRFN=""  D
"RTN","GMRCSTL1",37,0)
 ..I GMRCTOTS D
"RTN","GMRCSTL1",38,0)
 ...S COUNT=COUNT+1
"RTN","GMRCSTL1",39,0)
 ...I GEN=1 S ^TMP("GMRCR",$J,ARRN,COUNT,0)=CTRLTEMP_"Total Requests To Service @ "_$E(IRFN,1,16)_": "_$J(SP,16-$L($E(IRFN,1,16)))_$J(^TMP("GMRCTOT",$J,1,INDEX,"F",IRFN),13,0)
"RTN","GMRCSTL1",40,0)
 ...E  S ^TMP("GMRCR",$J,ARRN,COUNT,0)=CTRLTEMP_"Total Requests to Grouper @ "_$E(IRFN,1,20)_": "_$J(SP,20-$L($E(IRFN,1,20)))_$J(^TMP("GMRCTOT",$J,2,INDEX,"F",IRFN),9,0)
"RTN","GMRCSTL1",41,0)
 ..I $P($G(GMRCST(GEN,INDEX,IRFN)),"^",2)>0 D
"RTN","GMRCSTL1",42,0)
 ...S COUNT=COUNT+1
"RTN","GMRCSTL1",43,0)
 ...S VALSVC=$P(GMRCST(GEN,INDEX,IRFN),"^")\$P(GMRCST(GEN,INDEX,IRFN),"^",2)
"RTN","GMRCSTL1",44,0)
 ...S ^TMP("GMRCR",$J,ARRN,COUNT,0)=CTRLTEMP_"Mean Days Completed To "_$S(GEN=1:"Service ",1:"Grouper ")_"@ "_$E(IRFN,1,16)_": "_$J(SP,16-$L($E(IRFN,1,16)))_$J(VALSVC,8,0)
"RTN","GMRCSTL1",45,0)
 .I $P($G(GMRCST(GEN,INDEX)),"^",2)>0 D
"RTN","GMRCSTL1",46,0)
 ..S COUNT=COUNT+1
"RTN","GMRCSTL1",47,0)
 ..S VALTOT=$P(GMRCST(GEN,INDEX),"^")\$P(GMRCST(GEN,INDEX),"^",2)
"RTN","GMRCSTL1",48,0)
 ..S ^TMP("GMRCR",$J,ARRN,COUNT,0)=CTRLTEMP_"Mean Days Completed To "_$S(GEN=1:"Service",1:"Grouper")_": "_$J(VALTOT,27,0)
"RTN","GMRCSTL1",49,0)
 I GMRCTOTS D
"RTN","GMRCSTL1",50,0)
 .S COUNT=COUNT+1
"RTN","GMRCSTL1",51,0)
 .I GEN=1 S ^TMP("GMRCR",$J,ARRN,COUNT,0)=CTRLTEMP_"Total Requests To Service: "_$J(^TMP("GMRCTOT",$J,1,INDEX,"T"),32,0)
"RTN","GMRCSTL1",52,0)
 .E  S ^TMP("GMRCR",$J,ARRN,COUNT,0)=CTRLTEMP_"Total Requests To Grouper: "_$J(^TMP("GMRCTOT",$J,2,INDEX,"T"),32,0)
"RTN","GMRCSTL1",53,0)
 Q
"RTN","GMRCSTL1",54,0)
 ;
"RTN","GMRCSTL2")
0^5^B33679640^B30799061
"RTN","GMRCSTL2",1,0)
GMRCSTL2 ;SLC/DCM,dee;MA - List Manager Format Routine - Get Active Consults by service - pending,active,scheduled,incomplete,etc. ;4/18/01  10:31
"RTN","GMRCSTL2",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**7,21,22,63**;DEC 27, 1997;Build 10
"RTN","GMRCSTL2",3,0)
 ; Patch #21 changed array GMRCTOT to ^TMP("GMRCTOT",$J)
"RTN","GMRCSTL2",4,0)
 ; Patch #21 also added a plus sign to the $P when setting
"RTN","GMRCSTL2",5,0)
 ; GMRCDLA to check for a NULL value.
"RTN","GMRCSTL2",6,0)
 ; This routine invokes IA #10035,#44, #10040
"RTN","GMRCSTL2",7,0)
 Q
"RTN","GMRCSTL2",8,0)
 ;
"RTN","GMRCSTL2",9,0)
ONESTAT(GMRCARRN) ;Process one status
"RTN","GMRCSTL2",10,0)
 ; Input -- GMRCARRN  List Template Array Name (Subscript)
"RTN","GMRCSTL2",11,0)
 ;          Values:
"RTN","GMRCSTL2",12,0)
 ;          "CP": pending consults; "IFC": inter-facility consults
"RTN","GMRCSTL2",13,0)
 ; Output - None
"RTN","GMRCSTL2",14,0)
 S ^TMP("GMRCTOT",$J,1,GMRCSVC,STATUS)=0
"RTN","GMRCSTL2",15,0)
 S ^TMP("GMRCTOT",$J,2,GMRCSVC,STATUS)=0
"RTN","GMRCSTL2",16,0)
 S GMRCXDT=$S(GMRCDT1="ALL":0,1:9999999-GMRCDT2-.6)
"RTN","GMRCSTL2",17,0)
 F  S GMRCXDT=$O(^GMR(123,"AE",GMRCSVC,STATUS,GMRCXDT)) Q:GMRCXDT=""!(GMRCXDT>(9999999-GMRCDT1))  D
"RTN","GMRCSTL2",18,0)
 .S GMRCPT=0
"RTN","GMRCSTL2",19,0)
ONE .;Loop for one consult at a time
"RTN","GMRCSTL2",20,0)
 .F  S GMRCPT=$O(^GMR(123,"AE",GMRCSVC,STATUS,GMRCXDT,GMRCPT)) Q:GMRCPT=""  D
"RTN","GMRCSTL2",21,0)
 ..; Check for bad "AE" x-ref
"RTN","GMRCSTL2",22,0)
 ..I '$D(^GMR(123,GMRCPT,0)) D  Q
"RTN","GMRCSTL2",23,0)
 ...K ^GMR(123,"AE",GMRCSVC,STATUS,GMRCXDT,GMRCPT)
"RTN","GMRCSTL2",24,0)
 ..S X=9999999-GMRCXDT
"RTN","GMRCSTL2",25,0)
 ..D REGDTM^GMRCU
"RTN","GMRCSTL2",26,0)
 ..S GMRCDT=$P(X," ",1)
"RTN","GMRCSTL2",27,0)
 ..S GMRCDLA=$P(X," ",1)
"RTN","GMRCSTL2",28,0)
 ..S GMRCD(0)=^GMR(123,GMRCPT,0)
"RTN","GMRCSTL2",29,0)
 ..I GMRCARRN="IFC" D  Q:'GMRCCK
"RTN","GMRCSTL2",30,0)
 ...S GMRCCK=1
"RTN","GMRCSTL2",31,0)
 ...S:'$D(GMRCIS) GMRCCK=0 S:'$P($G(GMRCD(0)),"^",23) GMRCCK=0
"RTN","GMRCSTL2",32,0)
 ...I GMRCCK=1 D
"RTN","GMRCSTL2",33,0)
 ....S GMRCD(12)=$G(^GMR(123,GMRCPT,12))
"RTN","GMRCSTL2",34,0)
 ....I GMRCIS="R",$P(GMRCD(12),"^",5)'="P" S GMRCCK=0
"RTN","GMRCSTL2",35,0)
 ....I GMRCIS="C",$P(GMRCD(12),"^",5)'="F" S GMRCCK=0
"RTN","GMRCSTL2",36,0)
 ....I $D(GMRCREMP),$P(GMRCD(12),"^",6)'=GMRCREMP S GMRCCK=0
"RTN","GMRCSTL2",37,0)
 ....I $D(GMRCRF),$P($G(GMRCD(0)),"^",23)'=GMRCRF S GMRCCK=0
"RTN","GMRCSTL2",38,0)
 ..S GMRCPTN=$P(^DPT($P(GMRCD(0),"^",2),0),"^",1)
"RTN","GMRCSTL2",39,0)
 ..S GMRCPTN=$P(GMRCPTN,",",1)_","_$E($P(GMRCPTN,",",2),1)_"."
"RTN","GMRCSTL2",40,0)
 ..S GMRCPTSN="("_$E($P(^DPT($P(GMRCD(0),"^",2),0),"^",9),6,9)_")"
"RTN","GMRCSTL2",41,0)
 ..; IF Consults
"RTN","GMRCSTL2",42,0)
 ..I GMRCARRN="IFC" D
"RTN","GMRCSTL2",43,0)
 ...N GMRCIRF,RCVDT,COMPLDT,ND
"RTN","GMRCSTL2",44,0)
 ...S GMRCIRFN="NONE",GMRCIDD="N/A",GMRCRDT=""
"RTN","GMRCSTL2",45,0)
 ...S GMRCIRF=$P($G(GMRCD(0)),"^",23)
"RTN","GMRCSTL2",46,0)
 ... I GMRCIRF S GMRCIRFN=$E($$GET1^DIQ(4,GMRCIRF,.01),1,16)
"RTN","GMRCSTL2",47,0)
 ...I '$D(^TMP("GMRCTOT",$J,1,GMRCSVC,"F",GMRCIRFN)) D
"RTN","GMRCSTL2",48,0)
 ....S ^TMP("GMRCTOT",$J,1,GMRCSVC,"F",GMRCIRFN)=0
"RTN","GMRCSTL2",49,0)
 ....S GMRCST(1,GMRCSVC,GMRCIRFN)="0^0"
"RTN","GMRCSTL2",50,0)
 ...D GETDT^GMRCSTU(GMRCPT)
"RTN","GMRCSTL2",51,0)
 ...I COMPLDT<9999999,$S(GMRCDT1="ALL":1,RCVDT'<GMRCDT1&(RCVDT'>GMRCDT2):1,1:0) D
"RTN","GMRCSTL2",52,0)
 ....S X1=COMPLDT,X2=RCVDT D ^%DTC
"RTN","GMRCSTL2",53,0)
 ....S GMRCIDD=X
"RTN","GMRCSTL2",54,0)
 ...I GMRCIS="C" D
"RTN","GMRCSTL2",55,0)
 ....S GMRCRDT=$$GETRDT(GMRCPT)
"RTN","GMRCSTL2",56,0)
 ....I GMRCRDT]"" D
"RTN","GMRCSTL2",57,0)
 .....N X
"RTN","GMRCSTL2",58,0)
 .....S X=GMRCRDT D REGDT^GMRCU
"RTN","GMRCSTL2",59,0)
 .....S GMRCRDT=X
"RTN","GMRCSTL2",60,0)
 ..S GMRCD=0
"RTN","GMRCSTL2",61,0)
 ..S GMRCD=$O(^GMR(123,GMRCPT,40,"B",GMRCD))
"RTN","GMRCSTL2",62,0)
 ..I GMRCD]"" D
"RTN","GMRCSTL2",63,0)
 ...S GMRCDA=""
"RTN","GMRCSTL2",64,0)
 ...S GMRCDA=$O(^GMR(123,+GMRCPT,40,"B",GMRCD,GMRCDA))
"RTN","GMRCSTL2",65,0)
 ..S GMRCDLA=$E($P($G(^GMR(123.1,+$P(GMRCD(0),"^",13),0)),"^"),1,19)
"RTN","GMRCSTL2",66,0)
 ..S GMRCLOC=$P(GMRCD(0),"^",4)
"RTN","GMRCSTL2",67,0)
 ..S:$L(GMRCLOC) GMRCLOC=$P($G(^SC(GMRCLOC,0)),"^",1) ;DBIA#10040
"RTN","GMRCSTL2",68,0)
 ..I '$L(GMRCLOC),$P(GMRCD(0),U,21) D
"RTN","GMRCSTL2",69,0)
 ...S GMRCLOC=$$GET1^DIQ(4,$P(GMRCD(0),U,21),.01)
"RTN","GMRCSTL2",70,0)
 ..I '$L(GMRCLOC),$P(GMRCD(0),U,23) D
"RTN","GMRCSTL2",71,0)
 ...S GMRCLOC=$$GET1^DIQ(4,$P(GMRCD(0),U,23),.01)
"RTN","GMRCSTL2",72,0)
 ..I GMRCARRN="IFC",$L(GMRCLOC) D
"RTN","GMRCSTL2",73,0)
 ...S GMRCLOC=$E(GMRCLOC,1,23)
"RTN","GMRCSTL2",74,0)
 ..I ^TMP("GMRCTOT",$J,1,GMRCSVC,"T")=0 D
"RTN","GMRCSTL2",75,0)
 ...S GMRCCT=GMRCCT+1
"RTN","GMRCSTL2",76,0)
 ...S ^TMP("GMRCR",$J,GMRCARRN,GMRCCT,0)=CTRLTEMP
"RTN","GMRCSTL2",77,0)
 ...S GMRCCT=GMRCCT+1
"RTN","GMRCSTL2",78,0)
 ...S TEMP="SERVICE: "_GMRCSVCP
"RTN","GMRCSTL2",79,0)
 ...S:GMRCSVCG>0 TEMP=TEMP_" in Group: "_$P(^GMR(123.5,GMRCSVCG,0),"^",1)
"RTN","GMRCSTL2",80,0)
 ...S ^TMP("GMRCR",$J,GMRCARRN,GMRCCT,0)=CTRLTEMP_TEMP
"RTN","GMRCSTL2",81,0)
 ...S NUMCLIN=NUMCLIN+1
"RTN","GMRCSTL2",82,0)
 ..S LINETEMP=""
"RTN","GMRCSTL2",83,0)
CTRL ..I GMRCCTRL#100\10 D
"RTN","GMRCSTL2",84,0)
 ...I GMRCCTRL#100\10=1 D
"RTN","GMRCSTL2",85,0)
 ....S GMRCLINE=GMRCLINE+1
"RTN","GMRCSTL2",86,0)
 ....S ^TMP("GMRCRINDEX",$J,GMRCLINE)=GMRCPT
"RTN","GMRCSTL2",87,0)
 ....S LINETEMP=$J(GMRCLINE,4)_" "
"RTN","GMRCSTL2",88,0)
 ...E  S LINETEMP=$J(GMRCPT,9)_" "
"RTN","GMRCSTL2",89,0)
 ..I GMRCCTRL#2 S LINETEMP=GMRCPT_"^"_LINETEMP
"RTN","GMRCSTL2",90,0)
 ..I GMRCCTRL#1000\100 D
"RTN","GMRCSTL2",91,0)
 ...S STS=$$STATABBR^GMRCSTL1(STATUS)
"RTN","GMRCSTL2",92,0)
 ...S STS=STS_$J("",4-$L(STS)+1)
"RTN","GMRCSTL2",93,0)
 ..E  D
"RTN","GMRCSTL2",94,0)
 ...S STS=$$STATNAME^GMRCSTL1(STATUS)
"RTN","GMRCSTL2",95,0)
 ...S STS=STS_$J("",10-$L(STS)+1)
"RTN","GMRCSTL2",96,0)
 ..S GMRCCT=GMRCCT+1
"RTN","GMRCSTL2",97,0)
 ..S ^TMP("GMRCR",$J,GMRCARRN,GMRCCT,0)=LINETEMP_STS_GMRCDLA_$J("",20-$L(GMRCDLA))_GMRCDT_" "_GMRCPTN_" "_GMRCPTSN_$J("",12-$L(GMRCPTN)+5)_GMRCLOC
"RTN","GMRCSTL2",98,0)
 ..; IF Consults
"RTN","GMRCSTL2",99,0)
 ..I GMRCARRN="IFC" D
"RTN","GMRCSTL2",100,0)
 ...S ^TMP("GMRCR",$J,GMRCARRN,GMRCCT,0)=^TMP("GMRCR",$J,GMRCARRN,GMRCCT,0)_$J("",25-$L(GMRCLOC))_GMRCIRFN_$J("",17-$L(GMRCIRFN))_" "_GMRCIDD_$J("",9-$L(GMRCIDD))_"  "_GMRCRDT
"RTN","GMRCSTL2",101,0)
 ...I '$D(GMRCCNSLT(GMRCPT)) S ^TMP("GMRCTOT",$J,1,GMRCSVC,"F",GMRCIRFN)=^TMP("GMRCTOT",$J,1,GMRCSVC,"F",GMRCIRFN)+1,GMRCCNSLT(GMRCPT)=""
"RTN","GMRCSTL2",102,0)
 ...I GMRCIDD'="N/A" D
"RTN","GMRCSTL2",103,0)
 ....S $P(GMRCST(1,GMRCSVC,GMRCIRFN),"^")=$P(GMRCST(1,GMRCSVC,GMRCIRFN),"^")+GMRCIDD
"RTN","GMRCSTL2",104,0)
 ....S $P(GMRCST(1,GMRCSVC,GMRCIRFN),"^",2)=$P(GMRCST(1,GMRCSVC,GMRCIRFN),"^",2)+1
"RTN","GMRCSTL2",105,0)
 ....S $P(GMRCST(1,GMRCSVC),"^")=$P(GMRCST(1,GMRCSVC),"^")+GMRCIDD
"RTN","GMRCSTL2",106,0)
 ....S $P(GMRCST(1,GMRCSVC),"^",2)=$P(GMRCST(1,GMRCSVC),"^",2)+1
"RTN","GMRCSTL2",107,0)
 ..;
"RTN","GMRCSTL2",108,0)
ADDTOT ..;Add to totals
"RTN","GMRCSTL2",109,0)
 ..;  for all status for this service
"RTN","GMRCSTL2",110,0)
 ..S ^TMP("GMRCTOT",$J,1,GMRCSVC,"T")=^TMP("GMRCTOT",$J,1,GMRCSVC,"T")+1
"RTN","GMRCSTL2",111,0)
 ..;  pending for this service
"RTN","GMRCSTL2",112,0)
 ..S:",3,4,5,6,8,9,11,99,"[(","_STATUS_",") ^TMP("GMRCTOT",$J,1,GMRCSVC,"P")=^TMP("GMRCTOT",$J,1,GMRCSVC,"P")+1
"RTN","GMRCSTL2",113,0)
 ..;  this status (STATUS) for this service
"RTN","GMRCSTL2",114,0)
 ..S ^TMP("GMRCTOT",$J,1,GMRCSVC,STATUS)=^TMP("GMRCTOT",$J,1,GMRCSVC,STATUS)+1
"RTN","GMRCSTL2",115,0)
 ..;  this status (STATUS) for services to all of its groupers
"RTN","GMRCSTL2",116,0)
 F GRP=GROUPER:-1:1  D
"RTN","GMRCSTL2",117,0)
 . I $D(^TMP("GMRCTOTX",$J,GROUPER(GRP),GMRCSVC,STATUS)) Q
"RTN","GMRCSTL2",118,0)
 . S ^TMP("GMRCTOT",$J,2,GROUPER(GRP),STATUS)=$G(^TMP("GMRCTOT",$J,2,GROUPER(GRP),STATUS))+^TMP("GMRCTOT",$J,1,GMRCSVC,STATUS),^TMP("GMRCTOTX",$J,GROUPER(GRP),GMRCSVC,STATUS)=""
"RTN","GMRCSTL2",119,0)
 Q
"RTN","GMRCSTL2",120,0)
 ;
"RTN","GMRCSTL2",121,0)
GETRDT(GMRCPT) ;get the received date
"RTN","GMRCSTL2",122,0)
 ; Input:
"RTN","GMRCSTL2",123,0)
 ;  GMRCPT  = File #123 IEN
"RTN","GMRCSTL2",124,0)
 ; Output:
"RTN","GMRCSTL2",125,0)
 ;  GMRCRDT = Date of action entry for remote request received/received
"RTN","GMRCSTL2",126,0)
 N GMRCCKR,GMRCRDT,ND
"RTN","GMRCSTL2",127,0)
 S (GMRCCKR,ND)=0,GMRCRDT=""
"RTN","GMRCSTL2",128,0)
 F  S ND=$O(^GMR(123,GMRCPT,40,ND)) Q:ND'>0!GMRCCKR  D
"RTN","GMRCSTL2",129,0)
 .I $P(^GMR(123,GMRCPT,40,ND,0),"^",2)=23 D
"RTN","GMRCSTL2",130,0)
 ..S GMRCRDT=$P(^GMR(123,GMRCPT,40,ND,0),"^"),GMRCCKR=1
"RTN","GMRCSTL2",131,0)
 .I $P(^GMR(123,GMRCPT,40,ND,0),"^",2)=21 D
"RTN","GMRCSTL2",132,0)
 ..S GMRCRDT=$P(^GMR(123,GMRCPT,40,ND,0),"^")
"RTN","GMRCSTL2",133,0)
 Q GMRCRDT
"RTN","GMRCSTLM")
0^6^B105230463^B82753364
"RTN","GMRCSTLM",1,0)
GMRCSTLM ;SLC/DCM,dee,MA - List Manager Format Routine - Get Active Consults by service - pending,active,scheduled,incomplete,etc. ;11/21/02  05:29
"RTN","GMRCSTLM",2,0)
 ;;3.0;CONSULT/REQUEST TRACKING;**1,7,21,23,22,29,63**;DEC 27, 1997;Build 10
"RTN","GMRCSTLM",3,0)
 ; Patch #21 added a initialization KILL for ^TMP("GMRCTOT",$J)
"RTN","GMRCSTLM",4,0)
 ; Patch #23 remove the default prompt "ALL SERVICES"
"RTN","GMRCSTLM",5,0)
 Q
"RTN","GMRCSTLM",6,0)
 ;
"RTN","GMRCSTLM",7,0)
EN ;Ask for new service and date range
"RTN","GMRCSTLM",8,0)
 K GMRCQUT
"RTN","GMRCSTLM",9,0)
 N DIROUT,DTOUT,DUOUT,DIR
"RTN","GMRCSTLM",10,0)
 ;
"RTN","GMRCSTLM",11,0)
 ;Ask for service
"RTN","GMRCSTLM",12,0)
 N Y
"RTN","GMRCSTLM",13,0)
 S DIR(0)="PO^123.5:EMQ",DIR("??")="^D LISTALL^GMRCASV"
"RTN","GMRCSTLM",14,0)
 S DIR("A")="Select Service/Specialty"
"RTN","GMRCSTLM",15,0)
 D ^DIR
"RTN","GMRCSTLM",16,0)
 I Y<1 S VALMBCK="Q" Q
"RTN","GMRCSTLM",17,0)
 S GMRCDG=+Y,GMRCSVNM=$P(Y,U,2)
"RTN","GMRCSTLM",18,0)
 D SERV1^GMRCASV
"RTN","GMRCSTLM",19,0)
 I '$O(^TMP("GMRCSLIST",$J,0)) S VALMBCK="Q" Q 
"RTN","GMRCSTLM",20,0)
 ;
"RTN","GMRCSTLM",21,0)
 ;Ask for date range
"RTN","GMRCSTLM",22,0)
 D ^GMRCSPD
"RTN","GMRCSTLM",23,0)
 I $D(GMRCQUT) S VALMBCK="Q" G EXIT
"RTN","GMRCSTLM",24,0)
 D LISTDATE^GMRCSTU1(GMRCDT1,GMRCDT2,.GMRCEDT1,.GMRCEDT2)
"RTN","GMRCSTLM",25,0)
 Q
"RTN","GMRCSTLM",26,0)
 ;
"RTN","GMRCSTLM",27,0)
ENOR(RETURN,GMRCSVC,GMRCDT1,GMRCDT2,GMRCSTAT,GMRCCTRL,GMRCARRN) ;Entry point for GUI interface.
"RTN","GMRCSTLM",28,0)
 ;.RETURN:   This is the root to the returned temp array.
"RTN","GMRCSTLM",29,0)
 ;GMRCSVC:  Service for which consults are to be displayed.
"RTN","GMRCSTLM",30,0)
 ;GMRCDT1:  Starting date or "ALL"
"RTN","GMRCSTLM",31,0)
 ;GMRCDT2:  Ending date if not GMRCDT1="ALL"
"RTN","GMRCSTLM",32,0)
 ;GMRCSTAT: The list of status to include separated by commas
"RTN","GMRCSTLM",33,0)
 ;GMRCCTRL:   0, null or not define then just the display list is 
"RTN","GMRCSTLM",34,0)
 ;                displayed
"RTN","GMRCSTLM",35,0)
 ;            1 then the list will be two pieces with the first piece 
"RTN","GMRCSTLM",36,0)
 ;                being the ien of the consult for selection in the gui
"RTN","GMRCSTLM",37,0)
 ;                and the second piece being the display text.
"RTN","GMRCSTLM",38,0)
 ;           10 then the consults will have a line number on them for
"RTN","GMRCSTLM",39,0)
 ;                selection
"RTN","GMRCSTLM",40,0)
 ;           20 then the consults will have the consult number displayed
"RTN","GMRCSTLM",41,0)
 ;          100 then use abbreviations for the statuses
"RTN","GMRCSTLM",42,0)
 ;      1, (10 or 20) and 100 can be added together to add there features
"RTN","GMRCSTLM",43,0)
 ;GMRCARRN: List Template Array Name
"RTN","GMRCSTLM",44,0)
 ;          "CP": pending; "IFC": inter-facility
"RTN","GMRCSTLM",45,0)
 ;
"RTN","GMRCSTLM",46,0)
 ;This temp array is used internally by the report:
"RTN","GMRCSTLM",47,0)
 ;^TMP("GMRCSLIST",$J,n)=ien^name^parient ien^"+" if grouper^status
"RTN","GMRCSTLM",48,0)
 ;  status is "" tracking and/or grouper
"RTN","GMRCSTLM",49,0)
 ;            1  grouper only
"RTN","GMRCSTLM",50,0)
 ;            2  tracking only
"RTN","GMRCSTLM",51,0)
 ;            9  disabled
"RTN","GMRCSTLM",52,0)
 ;
"RTN","GMRCSTLM",53,0)
 N GMRCEDT1,GMRCEDT2,GMRCDG,GMRCHEAD,GMRCCT,GMRCGRP,VALMCNT,VALMBCK
"RTN","GMRCSTLM",54,0)
 K ^TMP("GMRCR",$J,GMRCARRN)
"RTN","GMRCSTLM",55,0)
 S RETURN="^TMP(""GMRCR"",$J,GMRCARRN)"
"RTN","GMRCSTLM",56,0)
 I '($D(GMRCSVC)#2) S GMRCSVC=1
"RTN","GMRCSTLM",57,0)
 Q:'$D(^GMR(123.5,$G(GMRCSVC),0))
"RTN","GMRCSTLM",58,0)
 ;Build service array
"RTN","GMRCSTLM",59,0)
 S GMRCDG=GMRCSVC
"RTN","GMRCSTLM",60,0)
 D SERV1^GMRCASV
"RTN","GMRCSTLM",61,0)
 ;Get external form of date range
"RTN","GMRCSTLM",62,0)
 I '($D(GMRCDT1)#2) S GMRCDT1="ALL"
"RTN","GMRCSTLM",63,0)
 S:GMRCDT1="ALL" GMRCDT2=0
"RTN","GMRCSTLM",64,0)
 D LISTDATE^GMRCSTU1(GMRCDT1,$G(GMRCDT2),.GMRCEDT1,.GMRCEDT2)
"RTN","GMRCSTLM",65,0)
 G ENORSTR
"RTN","GMRCSTLM",66,0)
 ;
"RTN","GMRCSTLM",67,0)
ENORLM(GMRCARRN) ;Entry point for List Manager interface.
"RTN","GMRCSTLM",68,0)
 ; Input -- GMRCARRN  List Template Array Name
"RTN","GMRCSTLM",69,0)
 ;          "CP": pending; "IFC": inter-facility
"RTN","GMRCSTLM",70,0)
 ; Output - None
"RTN","GMRCSTLM",71,0)
 D WAIT^DICD
"RTN","GMRCSTLM",72,0)
 ;
"RTN","GMRCSTLM",73,0)
ENORSTR ;Common part
"RTN","GMRCSTLM",74,0)
 N GMRCDA,NUMCLIN,INDEX,STATUS,LOOP,GROUPER
"RTN","GMRCSTLM",75,0)
 N STS,GMRCD,GMRCDT,GMRCSVCG,TEMP
"RTN","GMRCSTLM",76,0)
 N GMRCPT,CTRLTEMP,LINETEMP,GMRCLINE
"RTN","GMRCSTLM",77,0)
 N GMRCPTN,GMRCPTSN,GMRCDLA,GMRCXDT,GMRCLOC,GMRCSVCP
"RTN","GMRCSTLM",78,0)
 N GRP,GMRCIRF,GMRCIRFN,GMRCIDD,GMRCST,GMRCRDT,CNT,IDX
"RTN","GMRCSTLM",79,0)
 S:'$D(GMRCARRN) GMRCARRN="CP"
"RTN","GMRCSTLM",80,0)
 ;
"RTN","GMRCSTLM",81,0)
 ; Patch #21 added the kill for ^TMP("GMRCTOT",$J)
"RTN","GMRCSTLM",82,0)
 K ^TMP("GMRCR",$J,GMRCARRN),^TMP("GMRCRINDEX",$J),^TMP("GMRCTOT",$J),^TMP("GMRCT",$J)
"RTN","GMRCSTLM",83,0)
 K ^TMP("GMRCTOTX",$J),GMRCCNSLT
"RTN","GMRCSTLM",84,0)
 ;
"RTN","GMRCSTLM",85,0)
 S CNT=0
"RTN","GMRCSTLM",86,0)
 S GMRCCT=0
"RTN","GMRCSTLM",87,0)
 S NUMCLIN=0
"RTN","GMRCSTLM",88,0)
 S GMRCLINE=0
"RTN","GMRCSTLM",89,0)
 S GROUPER=0
"RTN","GMRCSTLM",90,0)
 S GROUPER(0)=0
"RTN","GMRCSTLM",91,0)
 S GMRCCT=GMRCCT+1
"RTN","GMRCSTLM",92,0)
 I '($D(GMRCCTRL)#2) S GMRCCTRL=0 ;default to just the list
"RTN","GMRCSTLM",93,0)
 S CTRLTEMP=$S(GMRCCTRL#2:"^",1:"")
"RTN","GMRCSTLM",94,0)
 I GMRCARRN="IFC" D
"RTN","GMRCSTLM",95,0)
 .S ^TMP("GMRCR",$J,GMRCARRN,GMRCCT,0)=CTRLTEMP_$J("",18)_"IF Consult/Request By Status - "_$S(GMRCIS="R":"Requesting",1:"Consulting")_" Site"
"RTN","GMRCSTLM",96,0)
 E  D
"RTN","GMRCSTLM",97,0)
 .S ^TMP("GMRCR",$J,GMRCARRN,GMRCCT,0)=CTRLTEMP_$J("",28)_"Consult/Request By Status"
"RTN","GMRCSTLM",98,0)
 S GMRCCT=GMRCCT+1
"RTN","GMRCSTLM",99,0)
 S TEMP="FROM: "_GMRCEDT1_"   TO: "_GMRCEDT2
"RTN","GMRCSTLM",100,0)
 S ^TMP("GMRCR",$J,GMRCARRN,GMRCCT,0)=CTRLTEMP_$J("",40-($L(TEMP)/2)+.5)_TEMP
"RTN","GMRCSTLM",101,0)
 I GMRCARRN="IFC",$D(GMRCRF),$D(GMRCREMP) D
"RTN","GMRCSTLM",102,0)
 .S GMRCCT=GMRCCT+1
"RTN","GMRCSTLM",103,0)
 .S ^TMP("GMRCR",$J,GMRCARRN,GMRCCT,0)=CTRLTEMP_"Routing Facility - "_$$GET1^DIQ(4,GMRCRF,.01)
"RTN","GMRCSTLM",104,0)
 .S GMRCCT=GMRCCT+1
"RTN","GMRCSTLM",105,0)
 .S ^TMP("GMRCR",$J,GMRCARRN,GMRCCT,0)=CTRLTEMP_"Remote Ordering Provider - "_GMRCREMP
"RTN","GMRCSTLM",106,0)
 I GMRCCTRL=120 D
"RTN","GMRCSTLM",107,0)
 .S GMRCCT=GMRCCT+1
"RTN","GMRCSTLM",108,0)
 .S ^TMP("GMRCR",$J,GMRCARRN,GMRCCT,0)=CTRLTEMP
"RTN","GMRCSTLM",109,0)
 .S GMRCCT=GMRCCT+1
"RTN","GMRCSTLM",110,0)
 .S ^TMP("GMRCR",$J,GMRCARRN,GMRCCT,0)="   Number St   Last Action         Req Dt   Patient Name            Patient Location"_$S(GMRCARRN="IFC":"         Routing Facility  Days Diff"_$S(GMRCIS="C":"  Rec Dt",1:""),1:"")
"RTN","GMRCSTLM",111,0)
 ;
"RTN","GMRCSTLM",112,0)
 I '($D(GMRCSVC)#2) S GMRCSVC=1
"RTN","GMRCSTLM",113,0)
 I '($D(GMRCDT1)#2) S GMRCDT1="ALL",GMRCDT2=0
"RTN","GMRCSTLM",114,0)
 I '($D(GMRCDT2)#2) S GMRCDT2=""
"RTN","GMRCSTLM",115,0)
 I '($D(GMRCSTAT)#2),GMRCARRN="CP" S GMRCSTAT="3,4,5,6,8,9,11,99" ;pending consults
"RTN","GMRCSTLM",116,0)
 I '($D(GMRCSTAT)#2),GMRCARRN="IFC"  S GMRCSTAT="1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,99"
"RTN","GMRCSTLM",117,0)
 ;
"RTN","GMRCSTLM",118,0)
CAPTION ;Set the List Mangager Caption Line
"RTN","GMRCSTLM",119,0)
 ; Does GMRCCTRL contain 10 i.e. display line numbers
"RTN","GMRCSTLM",120,0)
 ;                    or 20 i.e. display consult number
"RTN","GMRCSTLM",121,0)
 I $G(VALMAR)="^TMP(""GMRCR"",$J,""CP"")"!($G(VALMAR)="^TMP(""GMRCR"",$J,""IFC"")") D
"RTN","GMRCSTLM",122,0)
 .I GMRCCTRL#100\10 D
"RTN","GMRCSTLM",123,0)
 ..I GMRCCTRL#100\10=1 D
"RTN","GMRCSTLM",124,0)
 ...; Does GMRCCTRL contain 100 i.e. use abbreviations for the statuses
"RTN","GMRCSTLM",125,0)
 ...I GMRCCTRL#1000\100 D CHGCAP^VALM("CAPTION LINE","     St    Last Action   Request Date  Patient Name         Pt Location")
"RTN","GMRCSTLM",126,0)
 ...; Do not use abbreviations for the statuses
"RTN","GMRCSTLM",127,0)
 ...E  D CHGCAP^VALM("CAPTION LINE","     Status      Last Action   Request Date  Patient Name         Pt Location")
"RTN","GMRCSTLM",128,0)
 ..; Do not display consult number
"RTN","GMRCSTLM",129,0)
 ..E  D
"RTN","GMRCSTLM",130,0)
 ...; Does GMRCCTRL contain 100 i.e. use abbreviations for the statuses
"RTN","GMRCSTLM",131,0)
 ...I GMRCCTRL#1000\100 D CHGCAP^VALM("CAPTION LINE"," Number   St    Last Action   Request Date  Patient Name         Pt Location")
"RTN","GMRCSTLM",132,0)
 ...; Do not use abbreviations for the statuses
"RTN","GMRCSTLM",133,0)
 ...E  D CHGCAP^VALM("CAPTION LINE"," Number   Status      Last Action   Request Date  Patient Name         Pt Location")
"RTN","GMRCSTLM",134,0)
 .E  D
"RTN","GMRCSTLM",135,0)
 ..; Does GMRCCTRL contain 100 i.e. use abbreviations for the statuses
"RTN","GMRCSTLM",136,0)
 ..I GMRCCTRL#1000\100 D CHGCAP^VALM("CAPTION LINE","St    Last Action   Request Date  Patient Name         Pt Location")
"RTN","GMRCSTLM",137,0)
 ..; Do not use abbreviations for the statuses
"RTN","GMRCSTLM",138,0)
 ..E  D CHGCAP^VALM("CAPTION LINE","Status      Last Action      Request Date  Patient Name      Pt Location")
"RTN","GMRCSTLM",139,0)
 .I GMRCARRN="IFC" D
"RTN","GMRCSTLM",140,0)
 ..D CHGCAP^VALM("CAPTION LINE 1","Routing Facility  Days Diff"_$S(GMRCIS="C":"  Rec Date",1:""))
"RTN","GMRCSTLM",141,0)
 ;Set screen width
"RTN","GMRCSTLM",142,0)
 S VALM("RM")=$S(GMRCARRN="CP":$$CWIDTH^GMRCPC(GMRCCTRL),1:$$CWIDTH^GMRCIR(GMRCCTRL))
"RTN","GMRCSTLM",143,0)
 ;
"RTN","GMRCSTLM",144,0)
 S GMRCHEAD=$P($G(^TMP("GMRCSLIST",$J,+$O(^TMP("GMRCSLIST",$J,"")))),"^",2)
"RTN","GMRCSTLM",145,0)
 S INDEX=""
"RTN","GMRCSTLM",146,0)
SVC ;Loop on Service
"RTN","GMRCSTLM",147,0)
 F  S INDEX=$O(^TMP("GMRCSLIST",$J,INDEX)) Q:INDEX=""  D
"RTN","GMRCSTLM",148,0)
 .S GMRCSVC=$P(^TMP("GMRCSLIST",$J,INDEX),"^",1)
"RTN","GMRCSTLM",149,0)
 .S GMRCSVCP=$P(^TMP("GMRCSLIST",$J,INDEX),"^",2)
"RTN","GMRCSTLM",150,0)
 .S GMRCSVCG=$P(^TMP("GMRCSLIST",$J,INDEX),"^",3)
"RTN","GMRCSTLM",151,0)
 .S ^TMP("GMRCTOT",$J,1,GMRCSVC,"T")=0
"RTN","GMRCSTLM",152,0)
 .S ^TMP("GMRCTOT",$J,1,GMRCSVC,"P")=0
"RTN","GMRCSTLM",153,0)
 .S ^TMP("GMRCTOT",$J,2,GMRCSVC,"T")=0
"RTN","GMRCSTLM",154,0)
 .S ^TMP("GMRCTOT",$J,2,GMRCSVC,"P")=0
"RTN","GMRCSTLM",155,0)
 .I GMRCARRN="IFC" D
"RTN","GMRCSTLM",156,0)
 ..S GMRCST(1,GMRCSVC)="0^0"
"RTN","GMRCSTLM",157,0)
 ..S GMRCST(2,GMRCSVC)="0^0"
"RTN","GMRCSTLM",158,0)
GROUPER .;Check if starting a new Grouper
"RTN","GMRCSTLM",159,0)
 .F  Q:GROUPER(GROUPER)=GMRCSVCG  D
"RTN","GMRCSTLM",160,0)
 ..;End of a group so print the group totals
"RTN","GMRCSTLM",161,0)
 ..D LISTTOT^GMRCSTL1(.GMRCCT,2,GROUPER(GROUPER),$P(^GMR(123.5,GROUPER(GROUPER),0),"^",1),"",GMRCCTRL,GMRCARRN)
"RTN","GMRCSTLM",162,0)
 ..;pop grouper from stack
"RTN","GMRCSTLM",163,0)
 ..S GROUPER=GROUPER-1
"RTN","GMRCSTLM",164,0)
 .I $P(^TMP("GMRCSLIST",$J,INDEX),"^",4)="+" D
"RTN","GMRCSTLM",165,0)
 ..;Start of a new group so print the group heading.
"RTN","GMRCSTLM",166,0)
 ..S GMRCCT=GMRCCT+1
"RTN","GMRCSTLM",167,0)
 ..S ^TMP("GMRCR",$J,GMRCARRN,GMRCCT,0)=CTRLTEMP
"RTN","GMRCSTLM",168,0)
 ..S GMRCCT=GMRCCT+1
"RTN","GMRCSTLM",169,0)
 ..S TEMP="GROUPER: "_GMRCSVCP
"RTN","GMRCSTLM",170,0)
 ..S:GMRCSVCG>0 TEMP=TEMP_"  in Group: "_$P(^GMR(123.5,GMRCSVCG,0),"^",1)
"RTN","GMRCSTLM",171,0)
 ..S ^TMP("GMRCR",$J,GMRCARRN,GMRCCT,0)=CTRLTEMP_$J("",40-(($L(TEMP)/2)+.5))_TEMP
"RTN","GMRCSTLM",172,0)
 ..;push new grouper on stack
"RTN","GMRCSTLM",173,0)
 ..S GROUPER=GROUPER+1
"RTN","GMRCSTLM",174,0)
 ..S GROUPER(GROUPER)=GMRCSVC
"RTN","GMRCSTLM",175,0)
STAT .;Loop for one status at a time
"RTN","GMRCSTLM",176,0)
 .F LOOP=1:1:$L(GMRCSTAT,",") S STATUS=$P(GMRCSTAT,",",LOOP) D ONESTAT^GMRCSTL2(GMRCARRN)
"RTN","GMRCSTLM",177,0)
 .F GRP=GROUPER:-1:1 D
"RTN","GMRCSTLM",178,0)
 ..;  pending for this service to all of its groupers
"RTN","GMRCSTLM",179,0)
 ..I $D(^TMP("GMRCTOTX",$J,GROUPER(GRP),GMRCSVC,"P")) Q
"RTN","GMRCSTLM",180,0)
 ..S ^TMP("GMRCTOT",$J,2,GROUPER(GRP),"P")=$G(^TMP("GMRCTOT",$J,2,GROUPER(GRP),"P"))+^TMP("GMRCTOT",$J,1,GMRCSVC,"P")
"RTN","GMRCSTLM",181,0)
 ..S ^TMP("GMRCTOTX",$J,GROUPER(GRP),GMRCSVC,"P")=""
"RTN","GMRCSTLM",182,0)
 ..I $D(^TMP("GMRCTOTX",$J,GROUPER(GRP),GMRCSVC,"T")) Q
"RTN","GMRCSTLM",183,0)
 ..S ^TMP("GMRCTOT",$J,2,GROUPER(GRP),"T")=$G(^TMP("GMRCTOT",$J,2,GROUPER(GRP),"T"))+^TMP("GMRCTOT",$J,1,GMRCSVC,"T")
"RTN","GMRCSTLM",184,0)
 ..S ^TMP("GMRCTOTX",$J,GROUPER(GRP),GMRCSVC,"T")=""
"RTN","GMRCSTLM",185,0)
 ..;IF Consults
"RTN","GMRCSTLM",186,0)
 ..I GMRCARRN="IFC" S GMRCIRFN="" F  S GMRCIRFN=$O(^TMP("GMRCTOT",$J,1,GMRCSVC,"F",GMRCIRFN)) Q:GMRCIRFN=""  D
"RTN","GMRCSTLM",187,0)
 ...I '$D(^TMP("GMRCTOT",$J,2,GROUPER(GRP),"F",GMRCIRFN)) D
"RTN","GMRCSTLM",188,0)
 ....S ^TMP("GMRCTOT",$J,2,GROUPER(GRP),"F",GMRCIRFN)=0
"RTN","GMRCSTLM",189,0)
 ....S GMRCST(2,GROUPER(GRP),GMRCIRFN)="0^0"
"RTN","GMRCSTLM",190,0)
 ...S ^TMP("GMRCTOT",$J,2,GROUPER(GRP),"F",GMRCIRFN)=$G(^TMP("GMRCTOT",$J,2,GROUPER(GRP),"F",GMRCIRFN))+^TMP("GMRCTOT",$J,1,GMRCSVC,"F",GMRCIRFN)
"RTN","GMRCSTLM",191,0)
 ...I +$P(GMRCST(1,GMRCSVC,GMRCIRFN),"^",2)>0 D
"RTN","GMRCSTLM",192,0)
 ....S $P(GMRCST(2,GROUPER(GRP),GMRCIRFN),"^")=($P(GMRCST(2,GROUPER(GRP)),"^"))+($P(GMRCST(1,GMRCSVC,GMRCIRFN),"^"))
"RTN","GMRCSTLM",193,0)
 ....S $P(GMRCST(2,GROUPER(GRP),GMRCIRFN),"^",2)=($P(GMRCST(2,GROUPER(GRP),GMRCIRFN),"^",2))+($P(GMRCST(1,GMRCSVC,GMRCIRFN),"^",2))
"RTN","GMRCSTLM",194,0)
 ..I GMRCARRN="IFC" D
"RTN","GMRCSTLM",195,0)
 ...S $P(GMRCST(2,GROUPER(GRP)),"^")=($P(GMRCST(2,GROUPER(GRP)),"^"))+($P(GMRCST(1,GMRCSVC),"^"))
"RTN","GMRCSTLM",196,0)
 ...S $P(GMRCST(2,GROUPER(GRP)),"^",2)=($P(GMRCST(2,GROUPER(GRP)),"^",2))+($P(GMRCST(1,GMRCSVC),"^",2))
"RTN","GMRCSTLM",197,0)
 .;
"RTN","GMRCSTLM",198,0)
PRINTST .;Print the totals for this service that are >0
"RTN","GMRCSTLM",199,0)
 .S GMRCSVNM=GMRCHEAD
"RTN","GMRCSTLM",200,0)
 .I ^TMP("GMRCTOT",$J,1,GMRCSVC,"T")>0 D LISTTOT^GMRCSTL1(.GMRCCT,1,GMRCSVC,GMRCSVCP,$P($G(^GMR(123.5,GMRCSVCG,0)),"^",1),GMRCCTRL,GMRCARRN)
"RTN","GMRCSTLM",201,0)
 .I ^TMP("GMRCTOT",$J,1,GMRCSVC,"T")=0,GMRCSVNM'="ALL SERVICES" D 
"RTN","GMRCSTLM",202,0)
 ..S GMRCCT=GMRCCT+1
"RTN","GMRCSTLM",203,0)
 ..S ^TMP("GMRCR",$J,GMRCARRN,GMRCCT,0)=CTRLTEMP
"RTN","GMRCSTLM",204,0)
 ..S GMRCCT=GMRCCT+1
"RTN","GMRCSTLM",205,0)
 ..S TEMP="SERVICE: "_GMRCSVCP
"RTN","GMRCSTLM",206,0)
 ..S:GMRCSVCG>0 TEMP=TEMP_" in Group: "_$P(^GMR(123.5,GMRCSVCG,0),"^",1)
"RTN","GMRCSTLM",207,0)
 ..S ^TMP("GMRCR",$J,GMRCARRN,GMRCCT,0)=CTRLTEMP_TEMP
"RTN","GMRCSTLM",208,0)
 ..S NUMCLIN=NUMCLIN+1
"RTN","GMRCSTLM",209,0)
 ..D LISTTOT^GMRCSTL1(.GMRCCT,1,GMRCSVC,GMRCSVCP,$P($G(^GMR(123.5,GMRCSVCG,0)),"^",1),GMRCCTRL,GMRCARRN)
"RTN","GMRCSTLM",210,0)
 .I ^TMP("GMRCTOT",$J,1,GMRCSVC,"T")=0,GMRCSVNM="ALL SERVICES" D
"RTN","GMRCSTLM",211,0)
 ..S CNT=CNT+1
"RTN","GMRCSTLM",212,0)
 ..S ^TMP("GMRCT",$J,0,GMRCSVC)=""
"RTN","GMRCSTLM",213,0)
 ;
"RTN","GMRCSTLM",214,0)
 ;Done so
"RTN","GMRCSTLM",215,0)
 ;Now list the group totals for the current groups
"RTN","GMRCSTLM",216,0)
 F GROUPER=GROUPER:-1:1 D
"RTN","GMRCSTLM",217,0)
 .D LISTTOT^GMRCSTL1(.GMRCCT,2,GROUPER(GROUPER),$P(^GMR(123.5,GROUPER(GROUPER),0),"^",1),"",GMRCCTRL,GMRCARRN)
"RTN","GMRCSTLM",218,0)
 ;
"RTN","GMRCSTLM",219,0)
 I CNT D
"RTN","GMRCSTLM",220,0)
 .S GMRCCT=GMRCCT+1
"RTN","GMRCSTLM",221,0)
 .S ^TMP("GMRCR",$J,GMRCARRN,GMRCCT,0)=CTRLTEMP,GMRCCT=GMRCCT+1
"RTN","GMRCSTLM",222,0)
 .S ^TMP("GMRCR",$J,GMRCARRN,GMRCCT,0)=CTRLTEMP_"The following Consult Services had zero requests for the specified date range:",GMRCCT=GMRCCT+1
"RTN","GMRCSTLM",223,0)
 .S ^TMP("GMRCR",$J,GMRCARRN,GMRCCT,0)=CTRLTEMP,GMRCCT=GMRCCT+1
"RTN","GMRCSTLM",224,0)
 .S IDX="" F  S IDX=$O(^TMP("GMRCT",$J,0,IDX)) Q:IDX=""  D
"RTN","GMRCSTLM",225,0)
 ..I $P(^GMR(123.5,IDX,0),U,2)=1 Q  ;don't add to list if service is a grouper only...
"RTN","GMRCSTLM",226,0)
 ..S ^TMP("GMRCR",$J,GMRCARRN,GMRCCT,0)=CTRLTEMP_$P(^GMR(123.5,IDX,0),U,1),GMRCCT=GMRCCT+1
"RTN","GMRCSTLM",227,0)
 ;
"RTN","GMRCSTLM",228,0)
 S VALMCNT=$O(^TMP("GMRCR",$J,GMRCARRN," "),-1)
"RTN","GMRCSTLM",229,0)
 I $D(IOBM),$D(IOTM) S VALMBCK="R"
"RTN","GMRCSTLM",230,0)
EXIT Q
"RTN","GMRCSTLM",231,0)
 ;
"VER")
8.0^22.0
"BLD",7798,6)
^56
**END**
**END**
