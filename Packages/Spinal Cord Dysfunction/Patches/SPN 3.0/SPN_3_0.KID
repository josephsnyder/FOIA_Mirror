KIDS Distribution saved on Sep 14, 2010@13:15:17
SPINAL CORD VERSION 3.0
**KIDS**:SPN 3.0^

**INSTALL NAME**
SPN 3.0
"BLD",6926,0)
SPN 3.0^SPINAL CORD DYSFUNCTION^0^3100914^y
"BLD",6926,4,0)
^9.64PA^^
"BLD",6926,6.3)
39
"BLD",6926,"ABPKG")
n
"BLD",6926,"KRN",0)
^9.67PA^8989.52^19
"BLD",6926,"KRN",.4,0)
.4
"BLD",6926,"KRN",.4,"NM",0)
^9.68A^^0
"BLD",6926,"KRN",.401,0)
.401
"BLD",6926,"KRN",.402,0)
.402
"BLD",6926,"KRN",.402,"NM",0)
^9.68A^^0
"BLD",6926,"KRN",.403,0)
.403
"BLD",6926,"KRN",.403,"NM",0)
^9.68A^^0
"BLD",6926,"KRN",.5,0)
.5
"BLD",6926,"KRN",.84,0)
.84
"BLD",6926,"KRN",3.6,0)
3.6
"BLD",6926,"KRN",3.6,"NM",0)
^9.68A^^0
"BLD",6926,"KRN",3.8,0)
3.8
"BLD",6926,"KRN",3.8,"NM",0)
^9.68A^^0
"BLD",6926,"KRN",9.2,0)
9.2
"BLD",6926,"KRN",9.8,0)
9.8
"BLD",6926,"KRN",9.8,"NM",0)
^9.68A^104^80
"BLD",6926,"KRN",9.8,"NM",1,0)
SPNJRP4A^^0^B1258600
"BLD",6926,"KRN",9.8,"NM",2,0)
SPNJRPC0^^0^B4797467
"BLD",6926,"KRN",9.8,"NM",3,0)
SPNJRPC1^^0^B25695639
"BLD",6926,"KRN",9.8,"NM",4,0)
SPNJRPC2^^0^B8549659
"BLD",6926,"KRN",9.8,"NM",5,0)
SPNJRPC3^^0^B53506814
"BLD",6926,"KRN",9.8,"NM",6,0)
SPNJRPC4^^0^B38673987
"BLD",6926,"KRN",9.8,"NM",7,0)
SPNJRPC5^^0^B14449910
"BLD",6926,"KRN",9.8,"NM",8,0)
SPNJRPC6^^0^B4635814
"BLD",6926,"KRN",9.8,"NM",9,0)
SPNJRPC7^^0^B352636
"BLD",6926,"KRN",9.8,"NM",10,0)
SPNJRPC8^^0^B1723581
"BLD",6926,"KRN",9.8,"NM",11,0)
SPNJRPC9^^0^B17400459
"BLD",6926,"KRN",9.8,"NM",12,0)
SPNJRPCC^^0^B705728
"BLD",6926,"KRN",9.8,"NM",13,0)
SPNJRPCD^^0^B26963457
"BLD",6926,"KRN",9.8,"NM",14,0)
SPNJRPCE^^0^B947821
"BLD",6926,"KRN",9.8,"NM",15,0)
SPNJRPCM^^0^B3844721
"BLD",6926,"KRN",9.8,"NM",16,0)
SPNJRPCP^^0^B454442
"BLD",6926,"KRN",9.8,"NM",17,0)
SPNJRPCS^^0^B842386
"BLD",6926,"KRN",9.8,"NM",18,0)
SPNJRPCX^^0^B81896576
"BLD",6926,"KRN",9.8,"NM",19,0)
SPNJRPIC^^0^B7764384
"BLD",6926,"KRN",9.8,"NM",20,0)
SPNJRPIL^^0^B1214679
"BLD",6926,"KRN",9.8,"NM",21,0)
SPNJRPIP^^0^B4321660
"BLD",6926,"KRN",9.8,"NM",22,0)
SPNJRPP1^^0^B23248535
"BLD",6926,"KRN",9.8,"NM",23,0)
SPNJRPP2^^0^B18150887
"BLD",6926,"KRN",9.8,"NM",24,0)
SPNJRPPL^^0^B1212848
"BLD",6926,"KRN",9.8,"NM",25,0)
SPNJRPPN^^0^B1907848
"BLD",6926,"KRN",9.8,"NM",26,0)
SPNJRPRC^^0^B3460486
"BLD",6926,"KRN",9.8,"NM",27,0)
SPNJRPRE^^0^B5915306
"BLD",6926,"KRN",9.8,"NM",28,0)
SPNJRPSC^^0^B1441105
"BLD",6926,"KRN",9.8,"NM",29,0)
SPNJRPSD^^0^B22832226
"BLD",6926,"KRN",9.8,"NM",30,0)
SPNLRK7^^0^B1438782
"BLD",6926,"KRN",9.8,"NM",31,0)
SPNLRL7^^0^B3954554
"BLD",6926,"KRN",9.8,"NM",32,0)
SPNLRM7^^0^B3003178
"BLD",6926,"KRN",9.8,"NM",33,0)
SPNLRR7^^0^B9512592
"BLD",6926,"KRN",9.8,"NM",34,0)
SPNLRS7^^0^B19321322
"BLD",6926,"KRN",9.8,"NM",36,0)
SPNRPC03^^0^B10552423
"BLD",6926,"KRN",9.8,"NM",37,0)
SPNRPC1^^0^B17718596
"BLD",6926,"KRN",9.8,"NM",38,0)
SPNRPC10^^0^B2838928
"BLD",6926,"KRN",9.8,"NM",39,0)
SPNRPC13^^0^B19205247
"BLD",6926,"KRN",9.8,"NM",43,0)
SPNRPC5^^0^B609564
"BLD",6926,"KRN",9.8,"NM",44,0)
SPNRPC6^^0^B851415
"BLD",6926,"KRN",9.8,"NM",45,0)
SPNRPC7^^0^B3491672
"BLD",6926,"KRN",9.8,"NM",46,0)
SPNRPC8^^0^B1815443
"BLD",6926,"KRN",9.8,"NM",47,0)
SPNRPC9^^0^B2808690
"BLD",6926,"KRN",9.8,"NM",48,0)
SPNRPCA1^^0^B4948876
"BLD",6926,"KRN",9.8,"NM",49,0)
SPNRPCB^^0^B889413
"BLD",6926,"KRN",9.8,"NM",50,0)
SPNRPCC^^0^B15974748
"BLD",6926,"KRN",9.8,"NM",51,0)
SPNRPCD^^0^B17417590
"BLD",6926,"KRN",9.8,"NM",52,0)
SPNRPCE^^0^B23315717
"BLD",6926,"KRN",9.8,"NM",53,0)
SPNRPCF^^0^B23018946
"BLD",6926,"KRN",9.8,"NM",54,0)
SPNRPCG^^0^B9080936
"BLD",6926,"KRN",9.8,"NM",55,0)
SPNRPCH^^0^B12245424
"BLD",6926,"KRN",9.8,"NM",56,0)
SPNRPCI^^0^B18057216
"BLD",6926,"KRN",9.8,"NM",57,0)
SPNRPCIC^^0^B97795
"BLD",6926,"KRN",9.8,"NM",58,0)
SPNRPCJ^^0^B16481640
"BLD",6926,"KRN",9.8,"NM",60,0)
SPNRPCL^^0^B16794514
"BLD",6926,"KRN",9.8,"NM",61,0)
SPNRPCM^^0^B21192373
"BLD",6926,"KRN",9.8,"NM",62,0)
SPNRPCN^^0^B14508746
"BLD",6926,"KRN",9.8,"NM",63,0)
SPNRPCO^^0^B12699717
"BLD",6926,"KRN",9.8,"NM",65,0)
SPNRPCQ^^0^B6960635
"BLD",6926,"KRN",9.8,"NM",70,0)
SPNRPCW^^0^B13994447
"BLD",6926,"KRN",9.8,"NM",71,0)
SPNRPCW2^^0^B20809166
"BLD",6926,"KRN",9.8,"NM",74,0)
SPNLRK8^^0^B15230861
"BLD",6926,"KRN",9.8,"NM",75,0)
SPNLRL1^^0^B19098772
"BLD",6926,"KRN",9.8,"NM",76,0)
SPNLRL2^^0^B24652075
"BLD",6926,"KRN",9.8,"NM",77,0)
SPNLRL3^^0^B16249663
"BLD",6926,"KRN",9.8,"NM",78,0)
SPNLRM8^^0^B23501774
"BLD",6926,"KRN",9.8,"NM",79,0)
SPNLRM9^^0^B9152833
"BLD",6926,"KRN",9.8,"NM",82,0)
SPNRPC4B^^0^B46067512
"BLD",6926,"KRN",9.8,"NM",83,0)
SPNJRPX2^^0^B33025054
"BLD",6926,"KRN",9.8,"NM",86,0)
SPNJRPDC^^0^B7788443
"BLD",6926,"KRN",9.8,"NM",87,0)
SPNJRPE2^^0^B1830378
"BLD",6926,"KRN",9.8,"NM",88,0)
SPNJRPET^^0^B981420
"BLD",6926,"KRN",9.8,"NM",89,0)
SPNJRPFB^^0^B2618869
"BLD",6926,"KRN",9.8,"NM",90,0)
SPNJRPOP^^0^B5917365
"BLD",6926,"KRN",9.8,"NM",91,0)
SPNJRPPR^^0^B3055124
"BLD",6926,"KRN",9.8,"NM",92,0)
SPNJRPSR^^0^B2758801
"BLD",6926,"KRN",9.8,"NM",101,0)
SPNJRPIW^^0^B77468632
"BLD",6926,"KRN",9.8,"NM",102,0)
SPNJRPML^^0^B5642555
"BLD",6926,"KRN",9.8,"NM",103,0)
SPNJRPPM^^0^B12765608
"BLD",6926,"KRN",9.8,"NM",104,0)
SPNRPC4^^0^B51645622
"BLD",6926,"KRN",9.8,"NM","B","SPNJRP4A",1)

"BLD",6926,"KRN",9.8,"NM","B","SPNJRPC0",2)

"BLD",6926,"KRN",9.8,"NM","B","SPNJRPC1",3)

"BLD",6926,"KRN",9.8,"NM","B","SPNJRPC2",4)

"BLD",6926,"KRN",9.8,"NM","B","SPNJRPC3",5)

"BLD",6926,"KRN",9.8,"NM","B","SPNJRPC4",6)

"BLD",6926,"KRN",9.8,"NM","B","SPNJRPC5",7)

"BLD",6926,"KRN",9.8,"NM","B","SPNJRPC6",8)

"BLD",6926,"KRN",9.8,"NM","B","SPNJRPC7",9)

"BLD",6926,"KRN",9.8,"NM","B","SPNJRPC8",10)

"BLD",6926,"KRN",9.8,"NM","B","SPNJRPC9",11)

"BLD",6926,"KRN",9.8,"NM","B","SPNJRPCC",12)

"BLD",6926,"KRN",9.8,"NM","B","SPNJRPCD",13)

"BLD",6926,"KRN",9.8,"NM","B","SPNJRPCE",14)

"BLD",6926,"KRN",9.8,"NM","B","SPNJRPCM",15)

"BLD",6926,"KRN",9.8,"NM","B","SPNJRPCP",16)

"BLD",6926,"KRN",9.8,"NM","B","SPNJRPCS",17)

"BLD",6926,"KRN",9.8,"NM","B","SPNJRPCX",18)

"BLD",6926,"KRN",9.8,"NM","B","SPNJRPDC",86)

"BLD",6926,"KRN",9.8,"NM","B","SPNJRPE2",87)

"BLD",6926,"KRN",9.8,"NM","B","SPNJRPET",88)

"BLD",6926,"KRN",9.8,"NM","B","SPNJRPFB",89)

"BLD",6926,"KRN",9.8,"NM","B","SPNJRPIC",19)

"BLD",6926,"KRN",9.8,"NM","B","SPNJRPIL",20)

"BLD",6926,"KRN",9.8,"NM","B","SPNJRPIP",21)

"BLD",6926,"KRN",9.8,"NM","B","SPNJRPIW",101)

"BLD",6926,"KRN",9.8,"NM","B","SPNJRPML",102)

"BLD",6926,"KRN",9.8,"NM","B","SPNJRPOP",90)

"BLD",6926,"KRN",9.8,"NM","B","SPNJRPP1",22)

"BLD",6926,"KRN",9.8,"NM","B","SPNJRPP2",23)

"BLD",6926,"KRN",9.8,"NM","B","SPNJRPPL",24)

"BLD",6926,"KRN",9.8,"NM","B","SPNJRPPM",103)

"BLD",6926,"KRN",9.8,"NM","B","SPNJRPPN",25)

"BLD",6926,"KRN",9.8,"NM","B","SPNJRPPR",91)

"BLD",6926,"KRN",9.8,"NM","B","SPNJRPRC",26)

"BLD",6926,"KRN",9.8,"NM","B","SPNJRPRE",27)

"BLD",6926,"KRN",9.8,"NM","B","SPNJRPSC",28)

"BLD",6926,"KRN",9.8,"NM","B","SPNJRPSD",29)

"BLD",6926,"KRN",9.8,"NM","B","SPNJRPSR",92)

"BLD",6926,"KRN",9.8,"NM","B","SPNJRPX2",83)

"BLD",6926,"KRN",9.8,"NM","B","SPNLRK7",30)

"BLD",6926,"KRN",9.8,"NM","B","SPNLRK8",74)

"BLD",6926,"KRN",9.8,"NM","B","SPNLRL1",75)

"BLD",6926,"KRN",9.8,"NM","B","SPNLRL2",76)

"BLD",6926,"KRN",9.8,"NM","B","SPNLRL3",77)

"BLD",6926,"KRN",9.8,"NM","B","SPNLRL7",31)

"BLD",6926,"KRN",9.8,"NM","B","SPNLRM7",32)

"BLD",6926,"KRN",9.8,"NM","B","SPNLRM8",78)

"BLD",6926,"KRN",9.8,"NM","B","SPNLRM9",79)

"BLD",6926,"KRN",9.8,"NM","B","SPNLRR7",33)

"BLD",6926,"KRN",9.8,"NM","B","SPNLRS7",34)

"BLD",6926,"KRN",9.8,"NM","B","SPNRPC03",36)

"BLD",6926,"KRN",9.8,"NM","B","SPNRPC1",37)

"BLD",6926,"KRN",9.8,"NM","B","SPNRPC10",38)

"BLD",6926,"KRN",9.8,"NM","B","SPNRPC13",39)

"BLD",6926,"KRN",9.8,"NM","B","SPNRPC4",104)

"BLD",6926,"KRN",9.8,"NM","B","SPNRPC4B",82)

"BLD",6926,"KRN",9.8,"NM","B","SPNRPC5",43)

"BLD",6926,"KRN",9.8,"NM","B","SPNRPC6",44)

"BLD",6926,"KRN",9.8,"NM","B","SPNRPC7",45)

"BLD",6926,"KRN",9.8,"NM","B","SPNRPC8",46)

"BLD",6926,"KRN",9.8,"NM","B","SPNRPC9",47)

"BLD",6926,"KRN",9.8,"NM","B","SPNRPCA1",48)

"BLD",6926,"KRN",9.8,"NM","B","SPNRPCB",49)

"BLD",6926,"KRN",9.8,"NM","B","SPNRPCC",50)

"BLD",6926,"KRN",9.8,"NM","B","SPNRPCD",51)

"BLD",6926,"KRN",9.8,"NM","B","SPNRPCE",52)

"BLD",6926,"KRN",9.8,"NM","B","SPNRPCF",53)

"BLD",6926,"KRN",9.8,"NM","B","SPNRPCG",54)

"BLD",6926,"KRN",9.8,"NM","B","SPNRPCH",55)

"BLD",6926,"KRN",9.8,"NM","B","SPNRPCI",56)

"BLD",6926,"KRN",9.8,"NM","B","SPNRPCIC",57)

"BLD",6926,"KRN",9.8,"NM","B","SPNRPCJ",58)

"BLD",6926,"KRN",9.8,"NM","B","SPNRPCL",60)

"BLD",6926,"KRN",9.8,"NM","B","SPNRPCM",61)

"BLD",6926,"KRN",9.8,"NM","B","SPNRPCN",62)

"BLD",6926,"KRN",9.8,"NM","B","SPNRPCO",63)

"BLD",6926,"KRN",9.8,"NM","B","SPNRPCQ",65)

"BLD",6926,"KRN",9.8,"NM","B","SPNRPCW",70)

"BLD",6926,"KRN",9.8,"NM","B","SPNRPCW2",71)

"BLD",6926,"KRN",19,0)
19
"BLD",6926,"KRN",19,"NM",0)
^9.68A^3^1
"BLD",6926,"KRN",19,"NM",3,0)
SPN GENERAL USER RPC^^0
"BLD",6926,"KRN",19,"NM","B","SPN GENERAL USER RPC",3)

"BLD",6926,"KRN",19.1,0)
19.1
"BLD",6926,"KRN",19.1,"NM",0)
^9.68A^5^5
"BLD",6926,"KRN",19.1,"NM",1,0)
SPN_ADMIN^^0
"BLD",6926,"KRN",19.1,"NM",2,0)
SPN_RESEARCHER^^0
"BLD",6926,"KRN",19.1,"NM",3,0)
SPN_CLINICIAN^^0
"BLD",6926,"KRN",19.1,"NM",4,0)
SPN_CATCHMENT^^0
"BLD",6926,"KRN",19.1,"NM",5,0)
SPN_IRM^^0
"BLD",6926,"KRN",19.1,"NM","B","SPN_ADMIN",1)

"BLD",6926,"KRN",19.1,"NM","B","SPN_CATCHMENT",4)

"BLD",6926,"KRN",19.1,"NM","B","SPN_CLINICIAN",3)

"BLD",6926,"KRN",19.1,"NM","B","SPN_IRM",5)

"BLD",6926,"KRN",19.1,"NM","B","SPN_RESEARCHER",2)

"BLD",6926,"KRN",101,0)
101
"BLD",6926,"KRN",101,"NM",0)
^9.68A^^0
"BLD",6926,"KRN",409.61,0)
409.61
"BLD",6926,"KRN",771,0)
771
"BLD",6926,"KRN",771,"NM",0)
^9.68A^^0
"BLD",6926,"KRN",870,0)
870
"BLD",6926,"KRN",870,"NM",0)
^9.68A^^0
"BLD",6926,"KRN",8989.51,0)
8989.51
"BLD",6926,"KRN",8989.52,0)
8989.52
"BLD",6926,"KRN",8994,0)
8994
"BLD",6926,"KRN",8994,"NM",0)
^9.68A^85^66
"BLD",6926,"KRN",8994,"NM",1,0)
SPN GET CLINIC STOPS^^0
"BLD",6926,"KRN",8994,"NM",2,0)
SPN LIST ICDS/CPTS^^0
"BLD",6926,"KRN",8994,"NM",3,0)
SPN GET LAST SEEN^^0
"BLD",6926,"KRN",8994,"NM",4,0)
SPN GET FUTURE APPTS^^0
"BLD",6926,"KRN",8994,"NM",5,0)
SPN INPAT OUTPAT ACTIVITY^^0
"BLD",6926,"KRN",8994,"NM",6,0)
SPN INPAT OUTPAT SPECIFIC^^0
"BLD",6926,"KRN",8994,"NM",7,0)
SPN PAT BREAKDOWN^^0
"BLD",6926,"KRN",8994,"NM",8,0)
SPN CURRENT INPATS^^0
"BLD",6926,"KRN",8994,"NM",9,0)
SPN GET SPEC CODES^^0
"BLD",6926,"KRN",8994,"NM",10,0)
SPN GET MAILING ADDRESS^^0
"BLD",6926,"KRN",8994,"NM",11,0)
SPN ICD9 CODE SEARCH^^0
"BLD",6926,"KRN",8994,"NM",12,0)
SPN GET SCI COORDINATORS^^0
"BLD",6926,"KRN",8994,"NM",13,0)
SPN COMM DISCHARGES^^0
"BLD",6926,"KRN",8994,"NM",14,0)
SPN GET ENROLLMENT^^0
"BLD",6926,"KRN",8994,"NM",15,0)
SPN RECENT MED CENTERS^^0
"BLD",6926,"KRN",8994,"NM",16,0)
SPN GET PAIN RATING^^0
"BLD",6926,"KRN",8994,"NM",17,0)
SPN GET VA STATUS^^0
"BLD",6926,"KRN",8994,"NM",18,0)
SPN ICDS/CPTS & DESCRIPTIONS^^0
"BLD",6926,"KRN",8994,"NM",19,0)
SPN INPAT CARE^^0
"BLD",6926,"KRN",8994,"NM",20,0)
SPN ICN LOADER^^0
"BLD",6926,"KRN",8994,"NM",21,0)
SPN INPATIENT ICNS^^0
"BLD",6926,"KRN",8994,"NM",22,0)
SPN PROS UTL REPORT^^0
"BLD",6926,"KRN",8994,"NM",23,0)
SPN PROS UTL SPECIFIC^^0
"BLD",6926,"KRN",8994,"NM",24,0)
SPN GET PROS ITEMS^^0
"BLD",6926,"KRN",8994,"NM",25,0)
SPN PROGRESS NOTES WRAPPER^^0
"BLD",6926,"KRN",8994,"NM",26,0)
SPN GET RACE^^0
"BLD",6926,"KRN",8994,"NM",27,0)
SPN READMISSIONS REPORT^^0
"BLD",6926,"KRN",8994,"NM",28,0)
SPN SERVICE CONNECTED ICNS^^0
"BLD",6926,"KRN",8994,"NM",29,0)
SPN SCI SCD DISCHARGES^^0
"BLD",6926,"KRN",8994,"NM",30,0)
SPN LAB UTL REPORT^^0
"BLD",6926,"KRN",8994,"NM",31,0)
SPN PHARMACY UTL REPORT^^0
"BLD",6926,"KRN",8994,"NM",32,0)
SPN RAD UTL REPORT^^0
"BLD",6926,"KRN",8994,"NM",33,0)
SPN LAB UTL SPECIFIC^^0
"BLD",6926,"KRN",8994,"NM",34,0)
SPN RX UTILIZATION SPECIFIC^^0
"BLD",6926,"KRN",8994,"NM",37,0)
SPN NUTRITION PRECAUTIONS^^0
"BLD",6926,"KRN",8994,"NM",41,0)
SPN ADMISSIONS REPORT^^0
"BLD",6926,"KRN",8994,"NM",46,0)
SPN PAIN VITALS^^0
"BLD",6926,"KRN",8994,"NM",48,0)
SPN LIST PROGRESS NOTE TITLES^^0
"BLD",6926,"KRN",8994,"NM",49,0)
SPN SECONDARY ICDS^^0
"BLD",6926,"KRN",8994,"NM",51,0)
SPN LAB SPUTUM^^0
"BLD",6926,"KRN",8994,"NM",52,0)
SPN GET RAD REPORTS^^0
"BLD",6926,"KRN",8994,"NM",53,0)
SPN LAB COMPLETE BLOOD COUNT^^0
"BLD",6926,"KRN",8994,"NM",54,0)
SPN LAB URINALYSIS^^0
"BLD",6926,"KRN",8994,"NM",55,0)
SPN LAB MICRO URINE^^0
"BLD",6926,"KRN",8994,"NM",56,0)
SPN LAB MICRO BLOOD^^0
"BLD",6926,"KRN",8994,"NM",57,0)
SPN PUT PROSTHETIC DEVICES^^0
"BLD",6926,"KRN",8994,"NM",58,0)
SPN MEDS 1ST 2-CHARS VA CLASS^^0
"BLD",6926,"KRN",8994,"NM",59,0)
SPN MEDS BY FULL VA CLASS^^0
"BLD",6926,"KRN",8994,"NM",60,0)
SPN IDT DISCHARGE LOCATIONS^^0
"BLD",6926,"KRN",8994,"NM",62,0)
SPN PUT LAB COMPLETE BLOOD^^0
"BLD",6926,"KRN",8994,"NM",63,0)
SPN PUT LAB CYTOPATH^^0
"BLD",6926,"KRN",8994,"NM",64,0)
SPN PUT LAB SURG PATH^^0
"BLD",6926,"KRN",8994,"NM",65,0)
SPN PUT LAB MICRO^^0
"BLD",6926,"KRN",8994,"NM",67,0)
SPN BUILD PICK LIST ENTRIES^^0
"BLD",6926,"KRN",8994,"NM",72,0)
SPN INFLUENZA RPT^^0
"BLD",6926,"KRN",8994,"NM",73,0)
SPN FEE BASIS ICNS^^0
"BLD",6926,"KRN",8994,"NM",76,0)
SPN GET ETHNICITY^^0
"BLD",6926,"KRN",8994,"NM",77,0)
SPN MEANS & ELIGIBILITY^^0
"BLD",6926,"KRN",8994,"NM",78,0)
SPN MEDICATIONS ICNS^^0
"BLD",6926,"KRN",8994,"NM",79,0)
SPN OUTPATIENT ICNS^^0
"BLD",6926,"KRN",8994,"NM",80,0)
SPN PROSTHETICS ICNS^^0
"BLD",6926,"KRN",8994,"NM",81,0)
SPN SCI USER ROLES^^0
"BLD",6926,"KRN",8994,"NM",82,0)
SPN GET ADT DATA^^0
"BLD",6926,"KRN",8994,"NM",83,0)
SPN ICDS/CPTS W RAD COMMENTS^^0
"BLD",6926,"KRN",8994,"NM",84,0)
SPN MAILMAN NOTIFICATION^^0
"BLD",6926,"KRN",8994,"NM",85,0)
SPN VADPT VALUES^^0
"BLD",6926,"KRN",8994,"NM","B","SPN ADMISSIONS REPORT",41)

"BLD",6926,"KRN",8994,"NM","B","SPN BUILD PICK LIST ENTRIES",67)

"BLD",6926,"KRN",8994,"NM","B","SPN COMM DISCHARGES",13)

"BLD",6926,"KRN",8994,"NM","B","SPN CURRENT INPATS",8)

"BLD",6926,"KRN",8994,"NM","B","SPN FEE BASIS ICNS",73)

"BLD",6926,"KRN",8994,"NM","B","SPN GET ADT DATA",82)

"BLD",6926,"KRN",8994,"NM","B","SPN GET CLINIC STOPS",1)

"BLD",6926,"KRN",8994,"NM","B","SPN GET ENROLLMENT",14)

"BLD",6926,"KRN",8994,"NM","B","SPN GET ETHNICITY",76)

"BLD",6926,"KRN",8994,"NM","B","SPN GET FUTURE APPTS",4)

"BLD",6926,"KRN",8994,"NM","B","SPN GET LAST SEEN",3)

"BLD",6926,"KRN",8994,"NM","B","SPN GET MAILING ADDRESS",10)

"BLD",6926,"KRN",8994,"NM","B","SPN GET PAIN RATING",16)

"BLD",6926,"KRN",8994,"NM","B","SPN GET PROS ITEMS",24)

"BLD",6926,"KRN",8994,"NM","B","SPN GET RACE",26)

"BLD",6926,"KRN",8994,"NM","B","SPN GET RAD REPORTS",52)

"BLD",6926,"KRN",8994,"NM","B","SPN GET SCI COORDINATORS",12)

"BLD",6926,"KRN",8994,"NM","B","SPN GET SPEC CODES",9)

"BLD",6926,"KRN",8994,"NM","B","SPN GET VA STATUS",17)

"BLD",6926,"KRN",8994,"NM","B","SPN ICD9 CODE SEARCH",11)

"BLD",6926,"KRN",8994,"NM","B","SPN ICDS/CPTS & DESCRIPTIONS",18)

"BLD",6926,"KRN",8994,"NM","B","SPN ICDS/CPTS W RAD COMMENTS",83)

"BLD",6926,"KRN",8994,"NM","B","SPN ICN LOADER",20)

"BLD",6926,"KRN",8994,"NM","B","SPN IDT DISCHARGE LOCATIONS",60)

"BLD",6926,"KRN",8994,"NM","B","SPN INFLUENZA RPT",72)

"BLD",6926,"KRN",8994,"NM","B","SPN INPAT CARE",19)

"BLD",6926,"KRN",8994,"NM","B","SPN INPAT OUTPAT ACTIVITY",5)

"BLD",6926,"KRN",8994,"NM","B","SPN INPAT OUTPAT SPECIFIC",6)

"BLD",6926,"KRN",8994,"NM","B","SPN INPATIENT ICNS",21)

"BLD",6926,"KRN",8994,"NM","B","SPN LAB COMPLETE BLOOD COUNT",53)

"BLD",6926,"KRN",8994,"NM","B","SPN LAB MICRO BLOOD",56)

"BLD",6926,"KRN",8994,"NM","B","SPN LAB MICRO URINE",55)

"BLD",6926,"KRN",8994,"NM","B","SPN LAB SPUTUM",51)

"BLD",6926,"KRN",8994,"NM","B","SPN LAB URINALYSIS",54)

"BLD",6926,"KRN",8994,"NM","B","SPN LAB UTL REPORT",30)

"BLD",6926,"KRN",8994,"NM","B","SPN LAB UTL SPECIFIC",33)

"BLD",6926,"KRN",8994,"NM","B","SPN LIST ICDS/CPTS",2)

"BLD",6926,"KRN",8994,"NM","B","SPN LIST PROGRESS NOTE TITLES",48)

"BLD",6926,"KRN",8994,"NM","B","SPN MAILMAN NOTIFICATION",84)

"BLD",6926,"KRN",8994,"NM","B","SPN MEANS & ELIGIBILITY",77)

"BLD",6926,"KRN",8994,"NM","B","SPN MEDICATIONS ICNS",78)

"BLD",6926,"KRN",8994,"NM","B","SPN MEDS 1ST 2-CHARS VA CLASS",58)

"BLD",6926,"KRN",8994,"NM","B","SPN MEDS BY FULL VA CLASS",59)

"BLD",6926,"KRN",8994,"NM","B","SPN NUTRITION PRECAUTIONS",37)

"BLD",6926,"KRN",8994,"NM","B","SPN OUTPATIENT ICNS",79)

"BLD",6926,"KRN",8994,"NM","B","SPN PAIN VITALS",46)

"BLD",6926,"KRN",8994,"NM","B","SPN PAT BREAKDOWN",7)

"BLD",6926,"KRN",8994,"NM","B","SPN PHARMACY UTL REPORT",31)

"BLD",6926,"KRN",8994,"NM","B","SPN PROGRESS NOTES WRAPPER",25)

"BLD",6926,"KRN",8994,"NM","B","SPN PROS UTL REPORT",22)

"BLD",6926,"KRN",8994,"NM","B","SPN PROS UTL SPECIFIC",23)

"BLD",6926,"KRN",8994,"NM","B","SPN PROSTHETICS ICNS",80)

"BLD",6926,"KRN",8994,"NM","B","SPN PUT LAB COMPLETE BLOOD",62)

"BLD",6926,"KRN",8994,"NM","B","SPN PUT LAB CYTOPATH",63)

"BLD",6926,"KRN",8994,"NM","B","SPN PUT LAB MICRO",65)

"BLD",6926,"KRN",8994,"NM","B","SPN PUT LAB SURG PATH",64)

"BLD",6926,"KRN",8994,"NM","B","SPN PUT PROSTHETIC DEVICES",57)

"BLD",6926,"KRN",8994,"NM","B","SPN RAD UTL REPORT",32)

"BLD",6926,"KRN",8994,"NM","B","SPN READMISSIONS REPORT",27)

"BLD",6926,"KRN",8994,"NM","B","SPN RECENT MED CENTERS",15)

"BLD",6926,"KRN",8994,"NM","B","SPN RX UTILIZATION SPECIFIC",34)

"BLD",6926,"KRN",8994,"NM","B","SPN SCI SCD DISCHARGES",29)

"BLD",6926,"KRN",8994,"NM","B","SPN SCI USER ROLES",81)

"BLD",6926,"KRN",8994,"NM","B","SPN SECONDARY ICDS",49)

"BLD",6926,"KRN",8994,"NM","B","SPN SERVICE CONNECTED ICNS",28)

"BLD",6926,"KRN",8994,"NM","B","SPN VADPT VALUES",85)

"BLD",6926,"KRN","B",.4,.4)

"BLD",6926,"KRN","B",.401,.401)

"BLD",6926,"KRN","B",.402,.402)

"BLD",6926,"KRN","B",.403,.403)

"BLD",6926,"KRN","B",.5,.5)

"BLD",6926,"KRN","B",.84,.84)

"BLD",6926,"KRN","B",3.6,3.6)

"BLD",6926,"KRN","B",3.8,3.8)

"BLD",6926,"KRN","B",9.2,9.2)

"BLD",6926,"KRN","B",9.8,9.8)

"BLD",6926,"KRN","B",19,19)

"BLD",6926,"KRN","B",19.1,19.1)

"BLD",6926,"KRN","B",101,101)

"BLD",6926,"KRN","B",409.61,409.61)

"BLD",6926,"KRN","B",771,771)

"BLD",6926,"KRN","B",870,870)

"BLD",6926,"KRN","B",8989.51,8989.51)

"BLD",6926,"KRN","B",8989.52,8989.52)

"BLD",6926,"KRN","B",8994,8994)

"BLD",6926,"PRE")

"BLD",6926,"QUES",0)
^9.62^^
"BLD",6926,"REQB",0)
^9.611^15^15
"BLD",6926,"REQB",1,0)
XU*8.0*265^2
"BLD",6926,"REQB",2,0)
XU*8.0*337^2
"BLD",6926,"REQB",3,0)
XU*8.0*361^2
"BLD",6926,"REQB",4,0)
XT*7.3*89^2
"BLD",6926,"REQB",5,0)
XU*8.0*329^2
"BLD",6926,"REQB",6,0)
DG*5.3*244^2
"BLD",6926,"REQB",7,0)
DG*5.3*568^2
"BLD",6926,"REQB",8,0)
DG*5.3*585^2
"BLD",6926,"REQB",9,0)
DG*5.3*620^2
"BLD",6926,"REQB",10,0)
DG*5.3*641^2
"BLD",6926,"REQB",11,0)
SR*3.0*142^2
"BLD",6926,"REQB",12,0)
XOBU 1.5^2
"BLD",6926,"REQB",13,0)
XOBV 1.5^2
"BLD",6926,"REQB",14,0)
XOBS 1.5^2
"BLD",6926,"REQB",15,0)
SPN*2.0*23^2
"BLD",6926,"REQB","B","DG*5.3*244",6)

"BLD",6926,"REQB","B","DG*5.3*568",7)

"BLD",6926,"REQB","B","DG*5.3*585",8)

"BLD",6926,"REQB","B","DG*5.3*620",9)

"BLD",6926,"REQB","B","DG*5.3*641",10)

"BLD",6926,"REQB","B","SPN*2.0*23",15)

"BLD",6926,"REQB","B","SR*3.0*142",11)

"BLD",6926,"REQB","B","XOBS 1.5",14)

"BLD",6926,"REQB","B","XOBU 1.5",12)

"BLD",6926,"REQB","B","XOBV 1.5",13)

"BLD",6926,"REQB","B","XT*7.3*89",4)

"BLD",6926,"REQB","B","XU*8.0*265",1)

"BLD",6926,"REQB","B","XU*8.0*329",5)

"BLD",6926,"REQB","B","XU*8.0*337",2)

"BLD",6926,"REQB","B","XU*8.0*361",3)

"KRN",19,17366,-1)
0^3
"KRN",19,17366,0)
SPN GENERAL USER RPC^General Spinal Cord Injury user^^B^^^^^^^^SPINAL CORD DYSFUNCTION
"KRN",19,17366,1,0)
^19.06^2^2^3090616^^^^
"KRN",19,17366,1,1,0)
This menu is for the general SCI/D Outcomes user.  Is used for the GUI 
"KRN",19,17366,1,2,0)
interface.
"KRN",19,17366,99)
59800,44924
"KRN",19,17366,99.1)
60618,33278
"KRN",19,17366,"RPC",0)
^19.05P^90^89
"KRN",19,17366,"RPC",3,0)
XUS GET USER INFO
"KRN",19,17366,"RPC",4,0)
SPN PAIN VITALS
"KRN",19,17366,"RPC",9,0)
SPN LIST PROGRESS NOTE TITLES
"KRN",19,17366,"RPC",10,0)
SPN SECONDARY ICDS
"KRN",19,17366,"RPC",14,0)
SPN GET RAD REPORTS
"KRN",19,17366,"RPC",15,0)
SPN LAB COMPLETE BLOOD COUNT
"KRN",19,17366,"RPC",16,0)
SPN LAB URINALYSIS
"KRN",19,17366,"RPC",17,0)
SPN LAB MICRO URINE
"KRN",19,17366,"RPC",18,0)
SPN LAB MICRO BLOOD
"KRN",19,17366,"RPC",19,0)
SPN PUT PROSTHETIC DEVICES
"KRN",19,17366,"RPC",20,0)
SPN MEDS 1ST 2-CHARS VA CLASS
"KRN",19,17366,"RPC",21,0)
SPN MEDS BY FULL VA CLASS
"KRN",19,17366,"RPC",22,0)
SPN IDT DISCHARGE LOCATIONS
"KRN",19,17366,"RPC",24,0)
SPN PUT LAB CYTOPATH
"KRN",19,17366,"RPC",26,0)
SPN VADPT VALUES
"KRN",19,17366,"RPC",27,0)
SPN RX UTILIZATION SPECIFIC
"KRN",19,17366,"RPC",28,0)
SPN PUT LAB COMPLETE BLOOD
"KRN",19,17366,"RPC",29,0)
SPN PUT LAB SURG PATH
"KRN",19,17366,"RPC",30,0)
SPN PUT LAB MICRO
"KRN",19,17366,"RPC",32,0)
SPN BUILD PICK LIST ENTRIES
"KRN",19,17366,"RPC",34,0)
SPN PHARMACY UTL REPORT
"KRN",19,17366,"RPC",35,0)
SPN LAB UTL SPECIFIC
"KRN",19,17366,"RPC",36,0)
SPN LAB UTL REPORT
"KRN",19,17366,"RPC",37,0)
SPN RAD UTL REPORT
"KRN",19,17366,"RPC",39,0)
SPN INFLUENZA RPT
"KRN",19,17366,"RPC",41,0)
SPN LAB SPUTUM
"KRN",19,17366,"RPC",44,0)
SPN ADMISSIONS REPORT
"KRN",19,17366,"RPC",48,0)
SPN COMM DISCHARGES
"KRN",19,17366,"RPC",49,0)
SPN CURRENT INPATS
"KRN",19,17366,"RPC",50,0)
SPN GET CLINIC STOPS
"KRN",19,17366,"RPC",51,0)
SPN GET ENROLLMENT
"KRN",19,17366,"RPC",52,0)
SPN GET FUTURE APPTS
"KRN",19,17366,"RPC",53,0)
SPN GET LAST SEEN
"KRN",19,17366,"RPC",54,0)
SPN GET MAILING ADDRESS
"KRN",19,17366,"RPC",55,0)
SPN GET PAIN RATING
"KRN",19,17366,"RPC",56,0)
SPN GET PROS ITEMS
"KRN",19,17366,"RPC",57,0)
SPN GET RACE
"KRN",19,17366,"RPC",58,0)
SPN GET SCI COORDINATORS
"KRN",19,17366,"RPC",59,0)
SPN GET SPEC CODES
"KRN",19,17366,"RPC",60,0)
SPN GET VA STATUS
"KRN",19,17366,"RPC",61,0)
SPN ICD9 CODE SEARCH
"KRN",19,17366,"RPC",62,0)
SPN ICDS/CPTS & DESCRIPTIONS
"KRN",19,17366,"RPC",63,0)
SPN ICN LOADER
"KRN",19,17366,"RPC",64,0)
SPN INPAT CARE
"KRN",19,17366,"RPC",65,0)
SPN INPAT OUTPAT ACTIVITY
"KRN",19,17366,"RPC",66,0)
SPN INPAT OUTPAT SPECIFIC
"KRN",19,17366,"RPC",67,0)
SPN INPATIENT ICNS
"KRN",19,17366,"RPC",68,0)
SPN PROGRESS NOTES WRAPPER
"KRN",19,17366,"RPC",69,0)
SPN PROS UTL REPORT
"KRN",19,17366,"RPC",70,0)
SPN PROS UTL SPECIFIC
"KRN",19,17366,"RPC",71,0)
SPN READMISSIONS REPORT
"KRN",19,17366,"RPC",72,0)
SPN RECENT MED CENTERS
"KRN",19,17366,"RPC",73,0)
SPN SCI SCD DISCHARGES
"KRN",19,17366,"RPC",74,0)
SPN SERVICE CONNECTED ICNS
"KRN",19,17366,"RPC",75,0)
SPN LIST ICDS/CPTS
"KRN",19,17366,"RPC",76,0)
SPN NUTRITION PRECAUTIONS
"KRN",19,17366,"RPC",77,0)
SPN PAT BREAKDOWN
"KRN",19,17366,"RPC",79,0)
SPN FEE BASIS ICNS
"KRN",19,17366,"RPC",80,0)
SPN PROSTHETICS ICNS
"KRN",19,17366,"RPC",81,0)
SPN MEDICATIONS ICNS
"KRN",19,17366,"RPC",82,0)
SPN OUTPATIENT ICNS
"KRN",19,17366,"RPC",84,0)
SPN GET ETHNICITY
"KRN",19,17366,"RPC",85,0)
SPN SCI USER ROLES
"KRN",19,17366,"RPC",86,0)
SPN MEANS & ELIGIBILITY
"KRN",19,17366,"RPC",87,0)
SPN ICDS/CPTS W RAD COMMENTS
"KRN",19,17366,"RPC",88,0)
SPN GET ADT DATA
"KRN",19,17366,"RPC",89,0)
SPN MAILMAN NOTIFICATION
"KRN",19,17366,"RPC",90,0)
XOBV TEST PING
"KRN",19,17366,"U")
GENERAL SPINAL CORD INJURY USE
"KRN",19.1,672,-1)
0^1
"KRN",19.1,672,0)
SPN_ADMIN^Grants admin rights GUI^^^1
"KRN",19.1,672,1,0)
^^1^1^3070517^
"KRN",19.1,672,1,1,0)
This key is used to control the the SCI GUI admin screen
"KRN",19.1,673,-1)
0^4
"KRN",19.1,673,0)
SPN_CATCHMENT^Allows full data view^^^1
"KRN",19.1,673,1,0)
^^2^2^3070517^
"KRN",19.1,673,1,1,0)
Holders of this key are granted access to all data in their catchment 
"KRN",19.1,673,1,2,0)
area.
"KRN",19.1,674,-1)
0^3
"KRN",19.1,674,0)
SPN_CLINICIAN^Grants clinician rights GUI^^^1
"KRN",19.1,675,-1)
0^5
"KRN",19.1,675,0)
SPN_IRM^Grants IRM rights GUI^^^1
"KRN",19.1,676,-1)
0^2
"KRN",19.1,676,0)
SPN_RESEARCHER^Grants researcher rights GUI^^^1
"KRN",19.1,676,1,0)
^^2^2^3070517^
"KRN",19.1,676,1,1,0)
SCI GUI. Grants right to the researcher who conducts the research using
"KRN",19.1,676,1,2,0)
SCI reports.
"KRN",8994,2595,-1)
0^85
"KRN",8994,2595,0)
SPN VADPT VALUES^COL^SPNRPC1^4^A^0^^^^^1
"KRN",8994,2595,1,0)
^8994.01^125^125^3070131^^^
"KRN",8994,2595,1,1,0)
This RPC utilizes the CALLABLE ENTRY POINTS IN VADPT PIM manual. 
"KRN",8994,2595,1,2,0)
http://www.va.gov/vdl/documents/Clinical/Admis_Disch_Transfer_(ADT)/pimstm
"KRN",8994,2595,1,3,0)
.doc   (DBIA #10061) 
"KRN",8994,2595,1,4,0)
As well as the DBIA #4938 which returns the ICN.
"KRN",8994,2595,1,5,0)
 
"KRN",8994,2595,1,6,0)
 
"KRN",8994,2595,1,7,0)
Note that the call to VAPA API is called twice the first time forcing the 
"KRN",8994,2595,1,8,0)
return of the permanent address and a second time forcing the return of 
"KRN",8994,2595,1,9,0)
the temporary address. 
"KRN",8994,2595,1,10,0)
The Temporary address is retuned in its own subscript referenced as 
"KRN",8994,2595,1,11,0)
VAPA_TEMP_ADDRESS.   The return values are all listed in the ADT manual 
"KRN",8994,2595,1,12,0)
listed above, with the exception of the ICN and the VAPA_TEMP_ADDRESS.
"KRN",8994,2595,1,13,0)
 
"KRN",8994,2595,1,14,0)
This call can be called by passing in either dfn or icn or both.  If both 
"KRN",8994,2595,1,15,0)
are passed in they will be validate to insure that they match the same 
"KRN",8994,2595,1,16,0)
entry in the patient file.  
"KRN",8994,2595,1,17,0)
 
"KRN",8994,2595,1,18,0)
(global root,dfn,icn)
"KRN",8994,2595,1,19,0)
 
"KRN",8994,2595,1,20,0)
Testing section;
"KRN",8994,2595,1,21,0)
 
"KRN",8994,2595,1,22,0)
Note that this is a test patient.
"KRN",8994,2595,1,23,0)
 
"KRN",8994,2595,1,24,0)
Test 1)  PASSING IN AN INVALID ICN AND A VALID DFN
"KRN",8994,2595,1,25,0)
D COL(,785,10026276877)
"KRN",8994,2595,1,26,0)
Results:
"KRN",8994,2595,1,27,0)
^TMP(546781790,1)=COULD NOT MATCH UP ICN WITH A DFN
"KRN",8994,2595,1,28,0)
 
"KRN",8994,2595,1,29,0)
Test 2) PASSING IN A INVALID DFN WITH A VALID ICN
"KRN",8994,2595,1,30,0)
D COL(,78599999,1002627687)
"KRN",8994,2595,1,31,0)
Results:
"KRN",8994,2595,1,32,0)
^TMP(546781790,1)=DFN AND ICN ARE NOT MATCHED
"KRN",8994,2595,1,33,0)
 
"KRN",8994,2595,1,34,0)
Test 3) PASSING IN BOTH AN INVALID DFN AND ICN
"KRN",8994,2595,1,35,0)
D COL(,78599999,1002627687999999)
"KRN",8994,2595,1,36,0)
Results:
"KRN",8994,2595,1,37,0)
^TMP(546781790,1)=COULD NOT MATCH UP ICN WITH A DFN
"KRN",8994,2595,1,38,0)
 
"KRN",8994,2595,1,39,0)
Below is a successful call to this RPC passing only a dfn.
"KRN",8994,2595,1,40,0)
 
"KRN",8994,2595,1,41,0)
D COL(,785,)
"KRN",8994,2595,1,42,0)
Global ^TMP($J -- NOTE: translation in effect
"KRN",8994,2595,1,43,0)
^TMP(546781790,1)=VA(ICN)^1002627687^EOL999
"KRN",8994,2595,1,44,0)
               2)=VA(BID)^3235^EOL999
"KRN",8994,2595,1,45,0)
               3)=VA(PID)^***********^EOL999
"KRN",8994,2595,1,46,0)
               4)=VADM(1)^EASTER,WILLIAM DAVE (C)^EOL999
"KRN",8994,2595,1,47,0)
               5)=VADM(2)^101013235^***********^EOL999
"KRN",8994,2595,1,48,0)
               6)=VADM(3)^2571006^OCT 6,1957^EOL999
"KRN",8994,2595,1,49,0)
               7)=VADM(4)^49^EOL999
"KRN",8994,2595,1,50,0)
               8)=VADM(5)^M^MALE^EOL999
"KRN",8994,2595,1,51,0)
               9)=VADM(6)^^EOL999
"KRN",8994,2595,1,52,0)
              10)=VADM(7)^DR KEVIN SD^EOL999
"KRN",8994,2595,1,53,0)
              11)=VADM(8)^3^WHITE, NOT OF HISPANIC ORIGIN^EOL999
"KRN",8994,2595,1,54,0)
              12)=VADM(9)^3^BAPTIST^EOL999
"KRN",8994,2595,1,55,0)
              13)=VADM(10)^6^NEVER MARRIED^EOL999
"KRN",8994,2595,1,56,0)
              14)=VADM(11)^1^EOL999
"KRN",8994,2595,1,57,0)
              15)=VADM(11,1)^4^UNKNOWN BY PATIENT^EOL999
"KRN",8994,2595,1,58,0)
              16)=VADM(12)^2^EOL999
"KRN",8994,2595,1,59,0)
              17)=VADM(12,1)^2^AMERICAN INDIAN OR ALASKA NATIVE^EOL999
"KRN",8994,2595,1,60,0)
              18)=VADM(12,1,1)^3^OBSERVER^EOL999
"KRN",8994,2595,1,61,0)
              19)=VADM(12,2)^13^WHITE^EOL999
"KRN",8994,2595,1,62,0)
              20)=VADM(12,2,1)^1^SELF IDENTIFICATION^EOL999
"KRN",8994,2595,1,63,0)
              21)=BOS VAEL^EOL999
"KRN",8994,2595,1,64,0)
              22)=VAEL(1)^2^AID & ATTENDANCE^EOL999
"KRN",8994,2595,1,65,0)
              23)=VAEL,1,4)^4^NSC, VA PENSION^EOL999
"KRN",8994,2595,1,66,0)
              24)=VAEL,1,6)^6^OTHER FEDERAL AGENCY^EOL999
"KRN",8994,2595,1,67,0)
              25)=VAEL,1,9)^9^SHARING AGREEMENT^EOL999
"KRN",8994,2595,1,68,0)
              26)=VAEL,1,19)^19^TRICARE^EOL999
"KRN",8994,2595,1,69,0)
              27)=VAEL(2)^7^VIETNAM ERA^EOL999
"KRN",8994,2595,1,70,0)
              28)=VAEL(3)^0^EOL999
"KRN",8994,2595,1,71,0)
              29)=VAEL(4)^1^EOL999
"KRN",8994,2595,1,72,0)
              30)=VAEL(5)^1^EOL999
"KRN",8994,2595,1,73,0)
              31)=VAEL(5,1)^^EOL999
"KRN",8994,2595,1,74,0)
              32)=VAEL(5,2)^^EOL999
"KRN",8994,2595,1,75,0)
              33)=VAEL(5,3)^^EOL999
"KRN",8994,2595,1,76,0)
              34)=VAEL(5,4)^^EOL999
"KRN",8994,2595,1,77,0)
              35)=VAEL(5,5)^^EOL999
"KRN",8994,2595,1,78,0)
              36)=VAEL(5,6)^^EOL999
"KRN",8994,2595,1,79,0)
              37)=VAEL(6)^12^NSC VETERAN^EOL999
"KRN",8994,2595,1,80,0)
              38)=VAEL(7)^SS^EOL999
"KRN",8994,2595,1,81,0)
              39)=VAEL(8)^V^VERIFIED^EOL999
"KRN",8994,2595,1,82,0)
              40)=VAEL(9)^N^NO LONGER REQUIRED^EOL999
"KRN",8994,2595,1,83,0)
              41)=BOS VAPA^EOL999
"KRN",8994,2595,1,84,0)
              42)=VAPA(1)^5407 ROCKING HORSE LANE^EOL999
"KRN",8994,2595,1,85,0)
              43)=VAPA(2)^NO APPT # LINE TWO OF ADDRESS^EOL999
"KRN",8994,2595,1,86,0)
              44)=VAPA(3)^NO LINE THREE EITHER^EOL999
"KRN",8994,2595,1,87,0)
              45)=VAPA(4)^OCEANSIDE^EOL999
"KRN",8994,2595,1,88,0)
              46)=VAPA(5)^6^CALIFORNIA^EOL999
"KRN",8994,2595,1,89,0)
              47)=VAPA(6)^92057^EOL999
"KRN",8994,2595,1,90,0)
              48)=VAPA(7)^4^SAN DIEGO^EOL999
"KRN",8994,2595,1,91,0)
              49)=VAPA(8)^760-295-9572^EOL999
"KRN",8994,2595,1,92,0)
              50)=VAPA(9)^^EOL999
"KRN",8994,2595,1,93,0)
              51)=VAPA(10)^^EOL999
"KRN",8994,2595,1,94,0)
              52)=VAPA(11)^92057^92057^EOL999
"KRN",8994,2595,1,95,0)
              53)=VAPA(12)^1^EOL999
"KRN",8994,2595,1,96,0)
              54)=VAPA(13)^1750 w CITRACADO PKWY^EOL999
"KRN",8994,2595,1,97,0)
              55)=VAPA(14)^UNIT 114^EOL999
"KRN",8994,2595,1,98,0)
              56)=VAPA(15)^MOUNTAIN SHADOWS^EOL999
"KRN",8994,2595,1,99,0)
              57)=VAPA(16)^ESCONDIDO^EOL999
"KRN",8994,2595,1,100,0)
              58)=VAPA(17)^6^CALIFORNIA^EOL999
"KRN",8994,2595,1,101,0)
              59)=VAPA(18)^92029^92029^EOL999
"KRN",8994,2595,1,102,0)
              60)=VAPA(19)^4^SAN DIEGO^EOL999
"KRN",8994,2595,1,103,0)
              61)=VAPA(20)^3061221^DEC 21,2006^EOL999
"KRN",8994,2595,1,104,0)
              62)=VAPA(21)^3061231^DEC 31,2006^EOL999
"KRN",8994,2595,1,105,0)
              63)=VAPA(22,2)^2^APPOINTMENT/SCHEDULING^Y^EOL999
"KRN",8994,2595,1,106,0)
              64)=VAPA(22,3)^3^COPAYMENTS/VETERAN BILLING^^EOL999
"KRN",8994,2595,1,107,0)
              65)=VAPA(22,4)^4^MEDICAL RECORDS^Y^EOL999
"KRN",8994,2595,1,108,0)
              66)=VAPA_TEMP_ADDRESS(1)^5412 TEMP ADDRESS LANE^EOL999
"KRN",8994,2595,1,109,0)
              67)=VAPA_TEMP_ADDRESS(2)^SOME BEACH TEMP LINE TWO^EOL999
"KRN",8994,2595,1,110,0)
              68)=VAPA_TEMP_ADDRESS(3)^WITH SUN AND SAND LINE THREE^EOL999
"KRN",8994,2595,1,111,0)
              69)=VAPA_TEMP_ADDRESS(4)^LAGUNA^EOL999
"KRN",8994,2595,1,112,0)
              70)=VAPA_TEMP_ADDRESS(5)^6^CALIFORNIA^EOL999
"KRN",8994,2595,1,113,0)
              71)=VAPA_TEMP_ADDRESS(6)^90210^EOL999
"KRN",8994,2595,1,114,0)
              72)=VAPA_TEMP_ADDRESS(7)^7^ALAMEDA^EOL999
"KRN",8994,2595,1,115,0)
              73)=VAPA_TEMP_ADDRESS(8)^800-555-1212^EOL999
"KRN",8994,2595,1,116,0)
              74)=VAPA_TEMP_ADDRESS(9)^3061212^DEC 12,2006^EOL999
"KRN",8994,2595,1,117,0)
              75)=VAPA_TEMP_ADDRESS(10)^3070130^JAN 30,2007^EOL999
"KRN",8994,2595,1,118,0)
              76)=BOS VAPD^EOL999
"KRN",8994,2595,1,119,0)
              77)=VAPD(1)^PEN^EOL999
"KRN",8994,2595,1,120,0)
              78)=VAPD(2)^12^FLORIDA^EOL999
"KRN",8994,2595,1,121,0)
              79)=VAPD(3)^EASTER,ELBERT JOE^EOL999
"KRN",8994,2595,1,122,0)
              80)=VAPD(4)^EASTER,ELIZABETH L^EOL999
"KRN",8994,2595,1,123,0)
              81)=VAPD(5)^HUGHES,ELIZABETH L^EOL999
"KRN",8994,2595,1,124,0)
              82)=VAPD(6)^TRUCK DRIVER^EOL999
"KRN",8994,2595,1,125,0)
              83)=VAPD(7)^1^EMPLOYED FULL TIME^EOL999
"KRN",8994,2595,2,0)
^8994.02A^3^3
"KRN",8994,2595,2,1,0)
IEN^1^245^1^1
"KRN",8994,2595,2,2,0)
DFN^1^^^1
"KRN",8994,2595,2,2,1,0)
^^1^1^3061227^
"KRN",8994,2595,2,2,1,1,0)
DFN OF PATIENT
"KRN",8994,2595,2,3,0)
ICN^1^^^2
"KRN",8994,2595,2,3,1,0)
^8994.021^1^1^3070131^^^
"KRN",8994,2595,2,3,1,1,0)
ICN OF PATIENT
"KRN",8994,2595,2,"B","DFN",2)

"KRN",8994,2595,2,"B","ICN",3)

"KRN",8994,2595,2,"B","IEN",1)

"KRN",8994,2595,2,"PARAMSEQ",1,1)

"KRN",8994,2595,2,"PARAMSEQ",1,2)

"KRN",8994,2595,2,"PARAMSEQ",2,3)

"KRN",8994,2596,-1)
0^46
"KRN",8994,2596,0)
SPN PAIN VITALS^EN^SPNRPC5^1^A^0^^1^^^1
"KRN",8994,2596,1,0)
^8994.01^1^1^3041207^^^
"KRN",8994,2596,1,1,0)
Returns the patient's most recent Pain Vitals from file GMR(120.5.
"KRN",8994,2596,2,0)
^8994.02A^1^1
"KRN",8994,2596,2,1,0)
ICN^1^^1^1
"KRN",8994,2596,2,"B","ICN",1)

"KRN",8994,2596,2,"PARAMSEQ",1,1)

"KRN",8994,2596,3,0)
^8994.03^15^15^3041207^^
"KRN",8994,2596,3,1,0)
Data is returned delimited by the up-arrow (^), with each piece defined 
"KRN",8994,2596,3,2,0)
as follows:
"KRN",8994,2596,3,3,0)
 
"KRN",8994,2596,3,4,0)
Piece
"KRN",8994,2596,3,5,0)
    1 is Date & Time Vital was Taken
"KRN",8994,2596,3,6,0)
    2 is Type of Vital
"KRN",8994,2596,3,7,0)
    3 is Rate
"KRN",8994,2596,3,8,0)
    4 is Mumps global root and ien (for troubleshooting only)
"KRN",8994,2596,3,9,0)
    5 is End of Line Indicator (EOL999)
"KRN",8994,2596,3,10,0)
 
"KRN",8994,2596,3,11,0)
Sample data stream:
"KRN",8994,2596,3,12,0)
 
"KRN",8994,2596,3,13,0)
SPN PAIN VITALS Results: 
"KRN",8994,2596,3,14,0)
 
"KRN",8994,2596,3,15,0)
JUL 05, 2002@14:44^PAIN^10^GMR(120.5,3959396^EOL999
"KRN",8994,2597,-1)
0^48
"KRN",8994,2597,0)
SPN LIST PROGRESS NOTE TITLES^LIST^SPNRPC7^2^A^0^^^^^1
"KRN",8994,2597,1,0)
^8994.01^12^12^3041019^
"KRN",8994,2597,1,1,0)
This RPC lists Progress Note Titles eligible for writing Progress Notes 
"KRN",8994,2597,1,2,0)
under Document Class "SCI OUTCOMES".
"KRN",8994,2597,1,3,0)
 
"KRN",8994,2597,1,4,0)
Parameter values:
"KRN",8994,2597,1,5,0)
 
"KRN",8994,2597,1,6,0)
        Document Class = Name of entry in TIU DOCUMENT DEFINITION file 
"KRN",8994,2597,1,7,0)
(#8925.1).  This name must be an entry of type "DOCUMENT CLASS".  
"KRN",8994,2597,1,8,0)
IMPORTANT: typically, this parameter should be "SCI OUTCOMES" (without 
"KRN",8994,2597,1,9,0)
the quotes) for the re-hosted SCI & D Outcomes project.
"KRN",8994,2597,1,10,0)
 
"KRN",8994,2597,1,11,0)
Tested at the Bay Pines FO account using Document Class = ADDICTION 
"KRN",8994,2597,1,12,0)
SEVERITY INDEX  (again, typically this would be SCI OUTCOMES).
"KRN",8994,2597,2,0)
^8994.02A^1^1
"KRN",8994,2597,2,1,0)
CLASSNAM^1
"KRN",8994,2597,2,1,1,0)
^8994.021^1^1^3040825^^
"KRN",8994,2597,2,1,1,1,0)
Is the Document class name in file TIU DOCUMENT DEFINITION.
"KRN",8994,2597,2,"B","CLASSNAM",1)

"KRN",8994,2597,3,0)
^^12^12^3041019^
"KRN",8994,2597,3,1,0)
Data is returned delimited by the up-arrow (^), with each piece defined 
"KRN",8994,2597,3,2,0)
as follows:
"KRN",8994,2597,3,3,0)
 
"KRN",8994,2597,3,4,0)
Piece
"KRN",8994,2597,3,5,0)
    1 is Name of Progress Note Title belonging to the Document Class 
"KRN",8994,2597,3,6,0)
         specified in input parameter.
"KRN",8994,2597,3,7,0)
    2 is Internal Entry Number (IEN) of title in file 8925.1.
"KRN",8994,2597,3,8,0)
    3 is End of Line Indicator (EOL999).
"KRN",8994,2597,3,9,0)
 
"KRN",8994,2597,3,10,0)
Sample data stream:
"KRN",8994,2597,3,11,0)
SPN LIST PROGRESS NOTE TITLES Results:
"KRN",8994,2597,3,12,0)
ASI-ADDICTION SEVERITY INDEX^40^EOL999
"KRN",8994,2598,-1)
0^49
"KRN",8994,2598,0)
SPN SECONDARY ICDS^COL^SPNRPC8^4^A^0^^1^^^1
"KRN",8994,2598,1,0)
^8994.01^3^3^3050531^^^^
"KRN",8994,2598,1,1,0)
The "Secondary Conditions" scroll box display on the Impairments Tab will 
"KRN",8994,2598,1,2,0)
be populated with ICD-9 diagnostic, from the patient's beginning date to
"KRN",8994,2598,1,3,0)
the current date.  But it excludes the 806, 952, 344, & 907 ICD-9 series.
"KRN",8994,2598,2,0)
^8994.02A^1^1
"KRN",8994,2598,2,1,0)
ICN^1
"KRN",8994,2598,2,"B","ICN",1)

"KRN",8994,2598,3,0)
^8994.03^17^17^3050531^^
"KRN",8994,2598,3,1,0)
Data is returned delimited by the up-arrow (^), with each piece defined 
"KRN",8994,2598,3,2,0)
as follows:
"KRN",8994,2598,3,3,0)
 
"KRN",8994,2598,3,4,0)
Piece
"KRN",8994,2598,3,5,0)
    1 is ICD Diagnosis
"KRN",8994,2598,3,6,0)
    2 is ICD Diagnosis code
"KRN",8994,2598,3,7,0)
    3 is Date & Time of ICD Diagnosis
"KRN",8994,2598,3,8,0)
    4 is Mumps global root (troubleshooting only)
"KRN",8994,2598,3,9,0)
    5 is Internal Entry Number of entry at the global root 
"KRN",8994,2598,3,10,0)
         (troubleshooting only)
"KRN",8994,2598,3,11,0)
    6 is End of Line Indicator (EOL999)
"KRN",8994,2598,3,12,0)
 
"KRN",8994,2598,3,13,0)
Sample data stream:
"KRN",8994,2598,3,14,0)
SPN SECONDARY ICDS Results:
"KRN",8994,2598,3,15,0)
 
"KRN",8994,2598,3,16,0)
UNKN CAUSE MORB/MORT NEC^799.9^APR 16, 1999@10:30^ECH^232681^EOL999
"KRN",8994,2598,3,17,0)
FX LOW END FEMUR NOS-CL^821.20^MAR 25, 1999@09:55:32^DGPT^116844^EOL999
"KRN",8994,2599,-1)
0^52
"KRN",8994,2599,0)
SPN GET RAD REPORTS^COL^SPNRPCB^2^A^0^^^^^1
"KRN",8994,2599,2,0)
^8994.02A^2^2
"KRN",8994,2599,2,1,0)
EXAM^1^^1^1
"KRN",8994,2599,2,2,0)
EXAM_TYPE^1^^1^2
"KRN",8994,2599,2,"B","EXAM",1)

"KRN",8994,2599,2,"B","EXAM_TYPE",2)

"KRN",8994,2599,2,"PARAMSEQ",1,1)

"KRN",8994,2599,2,"PARAMSEQ",2,2)

"KRN",8994,2599,3,0)
^^24^24^3040825^
"KRN",8994,2599,3,1,0)
This RPC supports situations where Radiology Report text is required.
"KRN",8994,2599,3,2,0)
 
"KRN",8994,2599,3,3,0)
To call this RPC pass in:
"KRN",8994,2599,3,4,0)
Parameter 1 is the exam ien in the RAD/NUC MED REPORTS file (#74)
"KRN",8994,2599,3,5,0)
Parameter 2 is report type you would like.
"KRN",8994,2599,3,6,0)
        ;  Type is either R,I or H.
"KRN",8994,2599,3,7,0)
        ;  Report / Impression /  History.
"KRN",8994,2599,3,8,0)
 
"KRN",8994,2599,3,9,0)
This is an example of the return value for Impression text (I).
"KRN",8994,2599,3,10,0)
 
"KRN",8994,2599,3,11,0)
For example, if you want Impression text (I), here's how to make the call:
"KRN",8994,2599,3,12,0)
 
"KRN",8994,2599,3,13,0)
D COL(,1385,"I")
"KRN",8994,2599,3,14,0)
 
"KRN",8994,2599,3,15,0)
The results (text) is returned as an array, because the field itself is a 
"KRN",8994,2599,3,16,0)
word-processing field.
"KRN",8994,2599,3,17,0)
 
"KRN",8994,2599,3,18,0)
RESULTS(1)=Normal esophagram.
"KRN",8994,2599,3,19,0)
RESULTS(2)=CH:TL344    D:01-21-93      T:01-21-93    JOB #: 3858
"KRN",8994,2599,3,20,0)
RESULTS(3)=Document Name: JXRCHR-1.CH-
"KRN",8994,2599,3,21,0)
 
"KRN",8994,2599,3,22,0)
 
"KRN",8994,2599,3,23,0)
For more information on obtaining the report text IEN, refer to SPN RPC 4.
"KRN",8994,2599,3,24,0)
This RPC (SPN RPC GET RAD) can be called if you know the report text IEN.
"KRN",8994,2600,-1)
0^53
"KRN",8994,2600,0)
SPN LAB COMPLETE BLOOD COUNT^COL^SPNRPCC^4^A^0^^^^^1
"KRN",8994,2600,1,0)
^8994.01^17^17^3041207^^^^
"KRN",8994,2600,1,1,0)
This RPC supports the following report(s):
"KRN",8994,2600,1,2,0)
 
"KRN",8994,2600,1,3,0)
        Report Page Name                Subscreen
"KRN",8994,2600,1,4,0)
        Urinary Tract Infection         Complete Blood Count
"KRN",8994,2600,1,5,0)
 
"KRN",8994,2600,1,6,0)
 
"KRN",8994,2600,1,7,0)
Notes: 
"KRN",8994,2600,1,8,0)
 
"KRN",8994,2600,1,9,0)
Calling the line tag COL will generate all Lab Complete Blood Count tests
"KRN",8994,2600,1,10,0)
on file for the patient from the cut off date forward.
"KRN",8994,2600,1,11,0)
 
"KRN",8994,2600,1,12,0)
DFN = Internal Entry Number of patient in the PATIENT file (#2)
"KRN",8994,2600,1,13,0)
CUTDATE = Cut off date. Results are inclusive from cut off date to present
"KRN",8994,2600,1,14,0)
 
"KRN",8994,2600,1,15,0)
 
"KRN",8994,2600,1,16,0)
Tested at the Bay Pines FO account using DFN = 100005251 and 
"KRN",8994,2600,1,17,0)
CUTDATE=1-1-1900.  Of course, at other sites, DFN would vary.
"KRN",8994,2600,2,0)
^8994.02A^2^2
"KRN",8994,2600,2,1,0)
ICN^1^^1^1
"KRN",8994,2600,2,2,0)
CUTDATE^1^^1^2
"KRN",8994,2600,2,"B","CUTDATE",2)

"KRN",8994,2600,2,"B","ICN",1)

"KRN",8994,2600,2,"PARAMSEQ",1,1)

"KRN",8994,2600,2,"PARAMSEQ",2,2)

"KRN",8994,2600,3,0)
^8994.03^28^28^3041207^^^
"KRN",8994,2600,3,1,0)
Data is returned delimited by the up-arrow (^), with each piece defined 
"KRN",8994,2600,3,2,0)
as follows:
"KRN",8994,2600,3,3,0)
 
"KRN",8994,2600,3,4,0)
Piece
"KRN",8994,2600,3,5,0)
  1 is Date & time of test
"KRN",8994,2600,3,6,0)
  2 is Test name
"KRN",8994,2600,3,7,0)
  3 is Test value (result)
"KRN",8994,2600,3,8,0)
  4 is High or Low indicator (H if > normal range or L if below)
"KRN",8994,2600,3,9,0)
  5 is Unit of measurement
"KRN",8994,2600,3,10,0)
  6 is Lower limit of normal range
"KRN",8994,2600,3,11,0)
  7 is Upper limit of normal range
"KRN",8994,2600,3,12,0)
  8 is Field number of the test (troubleshooting only)
"KRN",8994,2600,3,13,0)
  9 is Reverse date (troubleshooting only)
"KRN",8994,2600,3,14,0)
 10 is End of Line indicator (EOL999)
"KRN",8994,2600,3,15,0)
 
"KRN",8994,2600,3,16,0)
 
"KRN",8994,2600,3,17,0)
Notes: 
"KRN",8994,2600,3,18,0)
 
"KRN",8994,2600,3,19,0)
Sample data stream returned by this RPC:
"KRN",8994,2600,3,20,0)
 
"KRN",8994,2600,3,21,0)
SPN LAB COMPLETE BLOOD COUNT Results: 
"KRN",8994,2600,3,22,0)
FEB 28, 2002@08:49:55^WESTERGREN ESR^3^^MM/HR^0^10^469^6979771.914945^EOL999
"KRN",8994,2600,3,23,0)
FEB 02, 2002@08:99:27^WESTERGREN ESR^17^H^MM/HR^0^10^469^6979797.909973^EOL999
"KRN",8994,2600,3,24,0)
JAN 19, 2002@09:30:05^WESTERGREN ESR^40^H^MM/HR^0^10^469^6979880.906895^EOL999
"KRN",8994,2600,3,25,0)
JAN 04, 2002@18:99^WESTERGREN ESR^110^H^MM/HR^0^10^469^6979895.81^EOL999
"KRN",8994,2600,3,26,0)
DEC 30, 2001@23:13:47^LYMPHS^comment^^^^^396^6988769.768553^EOL999
"KRN",8994,2600,3,27,0)
DEC 30, 2001@23:13:47^MONOCYTES^comment^^^^^397^6988769.768553^EOL999
"KRN",8994,2600,3,28,0)
DEC 30, 2001@17:40:01^WESTERGREN ESR^12^H^MM/HR^0^10^469^6988769.825899^EOL999
"KRN",8994,2601,-1)
0^54
"KRN",8994,2601,0)
SPN LAB URINALYSIS^COL^SPNRPCD^4^A^0^^^^^1
"KRN",8994,2601,1,0)
^8994.01^17^17^3041207^^^^
"KRN",8994,2601,1,1,0)
This RPC supports the following report(s):
"KRN",8994,2601,1,2,0)
 
"KRN",8994,2601,1,3,0)
      Report Page Name              Subscreen
"KRN",8994,2601,1,4,0)
      Urinary Tract Infections      Urinalysis
"KRN",8994,2601,1,5,0)
 
"KRN",8994,2601,1,6,0)
 
"KRN",8994,2601,1,7,0)
Notes: 
"KRN",8994,2601,1,8,0)
 
"KRN",8994,2601,1,9,0)
Calling the line tag COL will generate all Lab Urinalysis tests
"KRN",8994,2601,1,10,0)
on file for the patient from the cut off date forward.
"KRN",8994,2601,1,11,0)
 
"KRN",8994,2601,1,12,0)
DFN = Internal Entry Number of patient in the PATIENT file (#2)
"KRN",8994,2601,1,13,0)
CUTDATE = Cut off date. Results are inclusive from cut off date to present
"KRN",8994,2601,1,14,0)
 
"KRN",8994,2601,1,15,0)
 
"KRN",8994,2601,1,16,0)
Tested at the Bay Pines FO account using DFN = 27 and
"KRN",8994,2601,1,17,0)
CUTDATE=1-1-1990.  Of course, at other sites, DFN would vary.
"KRN",8994,2601,2,0)
^8994.02A^2^2
"KRN",8994,2601,2,1,0)
ICN^1^^1^1
"KRN",8994,2601,2,1,1,0)
^8994.021^1^1^3041207^^^^
"KRN",8994,2601,2,1,1,1,0)
Internal entry number of the patient in the PATIENT file (#2).
"KRN",8994,2601,2,2,0)
CUTDATE^1^^1^2
"KRN",8994,2601,2,2,1,0)
^8994.021^1^1^3041207^^^^
"KRN",8994,2601,2,2,1,1,0)
Data from the CUTDATE forward to the present date will be returned.
"KRN",8994,2601,2,"B","CUTDATE",2)

"KRN",8994,2601,2,"B","ICN",1)

"KRN",8994,2601,2,"PARAMSEQ",1,1)

"KRN",8994,2601,2,"PARAMSEQ",2,2)

"KRN",8994,2601,3,0)
^^32^32^3040924^
"KRN",8994,2601,3,1,0)
Data is returned delimited by the up-arrow (^), with each piece defined 
"KRN",8994,2601,3,2,0)
as follows:
"KRN",8994,2601,3,3,0)
 
"KRN",8994,2601,3,4,0)
Piece
"KRN",8994,2601,3,5,0)
  1 is Date & time of test
"KRN",8994,2601,3,6,0)
  2 is Test name
"KRN",8994,2601,3,7,0)
  3 is Test value (result)
"KRN",8994,2601,3,8,0)
  4 is High or Low indicator (H if > normal range or L if below)
"KRN",8994,2601,3,9,0)
  5 is Unit of measurement
"KRN",8994,2601,3,10,0)
  6 is Lower limit of normal range
"KRN",8994,2601,3,11,0)
  7 is Upper limit of normal range
"KRN",8994,2601,3,12,0)
  8 is Field number of test (troubleshooting only)
"KRN",8994,2601,3,13,0)
  9 is Reverse date (troubleshooting only)
"KRN",8994,2601,3,14,0)
 10 is End of Line indicator EOL999
"KRN",8994,2601,3,15,0)
 
"KRN",8994,2601,3,16,0)
Notes:
"KRN",8994,2601,3,17,0)
 
"KRN",8994,2601,3,18,0)
 
"KRN",8994,2601,3,19,0)
Sample data stream returned by this RPC:
"KRN",8994,2601,3,20,0)
 
"KRN",8994,2601,3,21,0)
SPN LAB URINALYSIS Results:
"KRN",8994,2601,3,22,0)
DEC 30, 2001@17:40:06^SPECIFIC 
"KRN",8994,2601,3,23,0)
GRAVITY^1.027^^^1.003^1.035^685^6988769.825894^EOL999
"KRN",8994,2601,3,24,0)
DEC 30, 2001@17:40:06^UR 
"KRN",8994,2601,3,25,0)
KETONES^NEGATIVE^^MG/DL^"NEG"^^689^6988769.825894^EOL999
"KRN",8994,2601,3,26,0)
DEC 30, 2001@17:40:06^UR 
"KRN",8994,2601,3,27,0)
GLUCOSE^NEGATIVE^^MG/DL^"NEG"^^690^6988769.825894^EOL999
"KRN",8994,2601,3,28,0)
DEC 30, 2001@17:40:06^UR 
"KRN",8994,2601,3,29,0)
PROTEIN^NEG^^MG/DL^"NEG"^^691^6988769.825894^EOL999
"KRN",8994,2601,3,30,0)
DEC 30, 2001@17:40:06^UR PH^6.5^^^5^9^692^6988769.825894^EOL999
"KRN",8994,2601,3,31,0)
DEC 30, 2001@17:40:06^NITRITE, 
"KRN",8994,2601,3,32,0)
URINE^NEGATIVE^^^"NEG"^^795^6988769.825894^EOL999
"KRN",8994,2602,-1)
0^55
"KRN",8994,2602,0)
SPN LAB MICRO URINE^COL^SPNRPCE^4^A^0^^^^^1
"KRN",8994,2602,1,0)
^8994.01^51^51^3050209^^^
"KRN",8994,2602,1,1,0)
This RPC supports the Microbiology, Urine subscreen of the Laboratory
"KRN",8994,2602,1,2,0)
Results section of the Urinary Tract Infections report.
"KRN",8994,2602,1,3,0)
 
"KRN",8994,2602,1,4,0)
Calling the line tag COL will generate all Lab Microbiology Urine tests on
"KRN",8994,2602,1,5,0)
file from the cut off date forward.
"KRN",8994,2602,1,6,0)
 
"KRN",8994,2602,1,7,0)
The results are first placed into ^UTILITY($J), and
"KRN",8994,2602,1,8,0)
then sorted into reverse date order and placed into ^TMP($J)
"KRN",8994,2602,1,9,0)
 
"KRN",8994,2602,1,10,0)
To call this RPC, simply DO
"KRN",8994,2602,1,11,0)
COL(,DFN,CUTDATE) , where
"KRN",8994,2602,1,12,0)
 
"KRN",8994,2602,1,13,0)
DFN = Internal Entry Number of patient in the PATIENT file (#2)
"KRN",8994,2602,1,14,0)
 
"KRN",8994,2602,1,15,0)
CUTDATE = Cut off date. Results are inclusive from cut off date to present
"KRN",8994,2602,1,16,0)
 
"KRN",8994,2602,1,17,0)
 
"KRN",8994,2602,1,18,0)
Sample data stream, using first item:
"KRN",8994,2602,1,19,0)
 
"KRN",8994,2602,1,20,0)
 Piece
"KRN",8994,2602,1,21,0)
  1 is Accession --> MI 98 6158  (Accession is the Lab's tracking number)
"KRN",8994,2602,1,22,0)
  2 is Date/time Received --> OCT 27, 1998@14:06:48
"KRN",8994,2602,1,23,0)
  3 is Collection Sample --> URINE;CLEAN CATCH MIDSTREAM
"KRN",8994,2602,1,24,0)
  4 is Report Status --> Final
"KRN",8994,2602,1,25,0)
  5 is Report Date Approved --> OCT 29, 1998
"KRN",8994,2602,1,26,0)
  6 is Site/Specimen --> URINE
"KRN",8994,2602,1,27,0)
  7 & 8 are for troubleshoting only.
"KRN",8994,2602,1,28,0)
  
"KRN",8994,2602,1,29,0)
      In addition, there is report text in the "TXT" string. Note that
"KRN",8994,2602,1,30,0)
the "TXT" subscript may have multiple lines, and that some tests do not
"KRN",8994,2602,1,31,0)
have remarks.  This subscript is from the BACT RPT REMARK multiple in
"KRN",8994,2602,1,32,0)
Vista (subfield 13 of field 5 in LAB DATA file {#63}).
"KRN",8994,2602,1,33,0)
 
"KRN",8994,2602,1,34,0)
This global was ran using the dfn of 42729 at the Bay Pines test acct. 
"KRN",8994,2602,1,35,0)
 
"KRN",8994,2602,1,36,0)
^TMP(541078638,"MICRO URINE",1) = MI 00 3671^JUL 17, 2000@12:19:49^URINE; 
"KRN",8994,2602,1,37,0)
CLEAN CATCH MIDSTREAM^Final^JUL 18, 2000^URINE^^LR(53,6999281.878085^|
"KRN",8994,2602,1,38,0)
^TMP(541078638,"MICRO URINE",1,"TXT",1) = BACT RPT REMARK 1^NO GROWTH 
"KRN",8994,2602,1,39,0)
(<1000 CFU /ML) ^|
"KRN",8994,2602,1,40,0)
^TMP(541078638,"MICRO URINE",1,"TXT",2) = BACT RPT REMARK 2^THIS IS THE 
"KRN",8994,2602,1,41,0)
BACT RPT REMARD ^|
"KRN",8994,2602,1,42,0)
^TMP(541078638,"MICRO URINE",1,"TXT",3) = BACT RPT REMARK 3^AND THIS IS 
"KRN",8994,2602,1,43,0)
LINE 3 OF THE BACT REPT REMARKS ^|
"KRN",8994,2602,1,44,0)
^TMP(541078638,"MICRO URINE",1,"TXT",4) = BACT RPT REMARK 4^AND ONE MORE 
"KRN",8994,2602,1,45,0)
LINE FOR THE GIVE OF IT ^|
"KRN",8994,2602,1,46,0)
^TMP(541078638,"MICRO URINE",1,"TXT",5) = BACT RPT REMARK 5^AND THE LAST 
"KRN",8994,2602,1,47,0)
ONE ^|
"KRN",8994,2602,1,48,0)
^TMP(541078638,"MICRO URINE",2) = MI 99 4202^JUL 15,
"KRN",8994,2602,1,49,0)
1999@17:54:21^URINE^Final^JUL 17, 1999^URINE^^LR(53,7009283.824579^|
"KRN",8994,2602,1,50,0)
^TMP(541078638,"MICRO URINE",2,"TXT",1) = BACT RPT REMARK 1^SPECIMEN 
"KRN",8994,2602,1,51,0)
GROSSLY CONTAMINATED WITH 3 OR MORE ORGANISM: RESUBMIT ^|
"KRN",8994,2602,2,0)
^8994.02A^2^2
"KRN",8994,2602,2,1,0)
ICN^1
"KRN",8994,2602,2,2,0)
CUTDATE^1
"KRN",8994,2602,2,"B","CUTDATE",2)

"KRN",8994,2602,2,"B","ICN",1)

"KRN",8994,2602,3,0)
^8994.03^101^101^3050209^^^^
"KRN",8994,2602,3,1,0)
Sample data stream, using first item:
"KRN",8994,2602,3,2,0)
 
"KRN",8994,2602,3,3,0)
 Piece
"KRN",8994,2602,3,4,0)
  1 is Accession --> MI 98 6158  (Accession is the Lab's tracking number)
"KRN",8994,2602,3,5,0)
  2 is Date/time Received --> OCT 27, 1998@14:06:48
"KRN",8994,2602,3,6,0)
  3 is Collection Sample --> URINE;CLEAN CATCH MIDSTREAM
"KRN",8994,2602,3,7,0)
  4 is Report Status --> Final
"KRN",8994,2602,3,8,0)
  5 is Report Date Approved --> OCT 29, 1998
"KRN",8994,2602,3,9,0)
  6 is Site/Specimen --> URINE
"KRN",8994,2602,3,10,0)
  7 & 8 are for troubleshoting only.
"KRN",8994,2602,3,11,0)
 
"KRN",8994,2602,3,12,0)
      In addition, there is report text in the "TXT" string. Note that
"KRN",8994,2602,3,13,0)
the "TXT" subscript may have multiple lines, and that some tests do not
"KRN",8994,2602,3,14,0)
have remarks.  This subscript is from the BACT RPT REMARK multiple in
"KRN",8994,2602,3,15,0)
Vista (subfield 13 of field 5 in LAB DATA file {#63}).
"KRN",8994,2602,3,16,0)
 
"KRN",8994,2602,3,17,0)
This global was ran using the dfn of 42729 at the Bay Pines test acct.
"KRN",8994,2602,3,18,0)
 
"KRN",8994,2602,3,19,0)
SPN LAB MICRO URINE Results:
"KRN",8994,2602,3,20,0)
 
"KRN",8994,2602,3,21,0)
BOR999 1^MI 98 1262^FEB 27, 1998@11:43:42^URINE; CLEAN CATCH MIDSTREAM^Final^MAR 01, 1998^URINE^^LR(4221,7019771.885665^EOL999^
"KRN",8994,2602,3,22,0)
 
"KRN",8994,2602,3,23,0)
BOO999 1^ENTEROBACTER CLOACAE^>100000 CFU/ML ^EOL999^
"KRN",8994,2602,3,24,0)
BACT RPT REMARK 1^PATIENT EXPIRED: NO SENSITIVITY STUDIES DONE ^EOL999^
"KRN",8994,2602,3,25,0)
 
"KRN",8994,2602,3,26,0)
 
"KRN",8994,2602,3,27,0)
BOR999 2^MI 98 1040^FEB 18, 1998@08:34:31^URINE^Final^FEB 19, 1998^URINE^^LR(4221,7019780.916573^EOL999^
"KRN",8994,2602,3,28,0)
BOO999 1^GRAM NEG BACILLUS,NON-LACTOSE FERM^>1000 <10000 CFU/ML ^EOL999^
"KRN",8994,2602,3,29,0)
 
"KRN",8994,2602,3,30,0)
 
"KRN",8994,2602,3,31,0)
BOR999 3^MI 98 988^FEB 15, 1998@08:59:31^URINE^Final^FEB 16, 1998^URINE^^LR(4221,7019783.914089^EOL999^
"KRN",8994,2602,3,32,0)
BACT RPT REMARK 1^NO GROWTH (<1000 CFU/ML) ^EOL999^
"KRN",8994,2602,3,33,0)
 
"KRN",8994,2602,3,34,0)
 
"KRN",8994,2602,3,35,0)
BOR999 4^MI 98 676^JAN 29, 1998@20:28:01^URINE^Final^JAN 30, 1998^URINE^^LR(4221,7019869.797246^EOL999^
"KRN",8994,2602,3,36,0)
BACT RPT REMARK 1^NO GROWTH (<1000 CFU/ML) ^EOL999^
"KRN",8994,2602,3,37,0)
 
"KRN",8994,2602,3,38,0)
 
"KRN",8994,2602,3,39,0)
BOR999 5^MI 98 318^JAN 14, 1998@09:22:16^URINE^Final^JAN 15, 1998^URINE^^LR(4221,7019885.7752^EOL999^
"KRN",8994,2602,3,40,0)
BOO999 1^STAPHYLOCOCCUS HEMOLYTIC^>1000 <10000 CFU/ML ^EOL999^
"KRN",8994,2602,3,41,0)
 
"KRN",8994,2602,3,42,0)
 
"KRN",8994,2602,3,43,0)
BOR999 6^MI 98 118^JAN 06, 1998@10:15:11^URINE; CLEAN CATCH MIDSTREAM^Final^JAN 08, 1998^URINE^^LR(4221,7019892.898494^EOL999^
"KRN",8994,2602,3,44,0)
BOO999 1^STAPHYLOCOCCUS (COAG NEGATIVE)^>50000 <75000 CFU/ML ^EOL999^
"KRN",8994,2602,3,45,0)
 
"KRN",8994,2602,3,46,0)
 
"KRN",8994,2602,3,47,0)
BOR999 7^MI 98 115^JAN 06, 1998@09:12:51^URINE^Final^JAN 07, 1998^URINE^^LR(4221,7019892.908756^EOL999^
"KRN",8994,2602,3,48,0)
BACT RPT REMARK 1^THIS CULTURE SHOWS GROWTH OF SAME ORGANISMS AS OTHER RECENT CULTURES ^EOL999^
"KRN",8994,2602,3,49,0)
BACT RPT REMARK 2^PLEASE REFER TO THE FOLLOWING CULTURE #'S FOR RESULTS: #118 ^EOL999^
"KRN",8994,2602,3,50,0)
 
"KRN",8994,2602,3,51,0)
 
"KRN",8994,2602,3,52,0)
BOR999 8^MI 97 6121^OCT 26, 1997@10:52:21^URINE^Final^OCT 27, 1997^URINE^^LR(4221,7028973.7973^EOL999^
"KRN",8994,2602,3,53,0)
BACT RPT REMARK 1^NO GROWTH (<1000 CFU/ML) ^EOL999^
"KRN",8994,2602,3,54,0)
 
"KRN",8994,2602,3,55,0)
 
"KRN",8994,2602,3,56,0)
BOR999 9^MI 97 5932^OCT 16, 1997@08:42:47^URINE^Final^OCT 17, 1997^URINE^^LR(4221,7028983.817^EOL999^
"KRN",8994,2602,3,57,0)
BOO999 1^A SUIS^300 10 ^EOL999^
"KRN",8994,2602,3,58,0)
BOO999 1 TXT 1^ORG A SUIS COMMENT ONE ^EOL999^
"KRN",8994,2602,3,59,0)
BOO999 1 TXT 2^ORG A SUIS COMMENT TWO ^EOL999^
"KRN",8994,2602,3,60,0)
BOO999 1 TXT 3^ORG A SUIS COMMENT THREE ^EOL999^
"KRN",8994,2602,3,61,0)
BOO999 1 TXT 4^ORG A SISI COMMENT FOUR ^EOL999^
"KRN",8994,2602,3,62,0)
BOO999 2^BIRD^200 21 ^EOL999^
"KRN",8994,2602,3,63,0)
BOO999 2 TXT 1^ORG 2 COMMENT 1 ^EOL999^
"KRN",8994,2602,3,64,0)
BOO999 2 TXT 2^ORG 2 COMMENT 2 ^EOL999^
"KRN",8994,2602,3,65,0)
BOO999 2 TXT 3^ORG 3 BIRD COMMENT 3 ^EOL999^
"KRN",8994,2602,3,66,0)
BACT RPT REMARK 1^NO GROWTH (<1000 CFU/ML) ^EOL999^
"KRN",8994,2602,3,67,0)
BACT RPT REMARK 2^THIS IS THE BACT RPT REMARKS ^EOL999^
"KRN",8994,2602,3,68,0)
BACT RPT REMARK 3^AND ITS HAS FOUR ^EOL999^
"KRN",8994,2602,3,69,0)
BACT RPT REMARK 4^AND HERE IS THE FOURTH ^EOL999^
"KRN",8994,2602,3,70,0)
 
"KRN",8994,2602,3,71,0)
 
"KRN",8994,2602,3,72,0)
BOR999 10^MI 97 5420^SEP 15, 1997@15:04:28^URINE^Final^SEP 16, 1997^URINE^^LR(4221,7029083.849579^EOL999^
"KRN",8994,2602,3,73,0)
BACT RPT REMARK 1^NO GROWTH (<1000 CFU/ML) ^EOL999^
"KRN",8994,2602,3,74,0)
 
"KRN",8994,2602,3,75,0)
 
"KRN",8994,2602,3,76,0)
BOR999 11^MI 96 3414^MAY 25, 1996@11:29:45^URINE^Final^MAY 26, 1996^URINE^^LR(4221,7039473.887064^EOL999^
"KRN",8994,2602,3,77,0)
BOO999 1^STAPHYLOCOCCUS NON HEMOLYTIC^1 COLONY ^EOL999^
"KRN",8994,2602,3,78,0)
 
"KRN",8994,2602,3,79,0)
 
"KRN",8994,2602,3,80,0)
BOR999 12^MI 96 3328^MAY 21, 1996@12:56:18^URINE^Final^MAY 22, 1996^URINE^^LR(4221,7039477.874393^EOL999^
"KRN",8994,2602,3,81,0)
BACT RPT REMARK 1^NO GROWTH (<1000 CFU/ML) ^EOL999^
"KRN",8994,2602,3,82,0)
 
"KRN",8994,2602,3,83,0)
 
"KRN",8994,2602,3,84,0)
BOR999 13^MI 96 1616^MAR 06, 1996@07:41:15^URINE^Final^MAR 07, 1996^URINE^^LR(4221,7039692.9259^EOL999^
"KRN",8994,2602,3,85,0)
BACT RPT REMARK 1^>1000 <10000 CFU/ML ^EOL999^
"KRN",8994,2602,3,86,0)
 
"KRN",8994,2602,3,87,0)
 
"KRN",8994,2602,3,88,0)
BOR999 14^MI 95 1565^FEB 28, 1995@09:02^URINE^Final^MAR 01, 1995^URINE^^LR(4221,7049770.9098^EOL999^
"KRN",8994,2602,3,89,0)
BACT RPT REMARK 1^NO GROWTH (<1000 CFU/ML) ^EOL999^
"KRN",8994,2602,3,90,0)
 
"KRN",8994,2602,3,91,0)
 
"KRN",8994,2602,3,92,0)
BOR999 15^MI 95 1510^FEB 24, 1995@17:14^URINE; CLEAN CATCH MIDSTREAM^Final^FEB 25, 1995^URINE^^LR(4221,7049774.8286^EOL999^
"KRN",8994,2602,3,93,0)
BOO999 1^GRAM NEG BACILLUS,LACTOSE FERM^>1000 <10000 CFU/ML ^EOL999^
"KRN",8994,2602,3,94,0)
 
"KRN",8994,2602,3,95,0)
 
"KRN",8994,2602,3,96,0)
BOR999 16^MI 95 600^JAN 25, 1995@07:30^URINE; CATHETER INDWELLING^Final^JAN 26, 1995^URINE^^LR(4221,7049873.927^EOL999^
"KRN",8994,2602,3,97,0)
BACT RPT REMARK 1^NO GROWTH (<1000 CFU/ML) ^EOL999^
"KRN",8994,2602,3,98,0)
 
"KRN",8994,2602,3,99,0)
 
"KRN",8994,2602,3,100,0)
BOR999 17^MI 94 8818^DEC 17, 1994@13:15^URINE^Final^DEC 18, 1994^URINE^^LR(4221,7058781.8685^EOL999^
"KRN",8994,2602,3,101,0)
BACT RPT REMARK 1^NO GROWTH (<1000 CFU/ML) ^EOL999^
"KRN",8994,2603,-1)
0^56
"KRN",8994,2603,0)
SPN LAB MICRO BLOOD^COL^SPNRPCF^4^A^0^^^^^1
"KRN",8994,2603,1,0)
^8994.01^13^13^3041207^^
"KRN",8994,2603,1,1,0)
This RPC supports the following report(s):
"KRN",8994,2603,1,2,0)
 
"KRN",8994,2603,1,3,0)
Report Page Name                Subscreen
"KRN",8994,2603,1,4,0)
Urinary Tract Infections        Microbiology Blood
"KRN",8994,2603,1,5,0)
 
"KRN",8994,2603,1,6,0)
Notes:  
"KRN",8994,2603,1,7,0)
 
"KRN",8994,2603,1,8,0)
DFN = Internal Entry Number of patient in PATIENT file (#2)
"KRN",8994,2603,1,9,0)
CUTDATE = Cut off date. Results are inclusive from cut off
"KRN",8994,2603,1,10,0)
date to present
"KRN",8994,2603,1,11,0)
 
"KRN",8994,2603,1,12,0)
Tested at the Bay Pines FO account using DFN = 10000262 and
"KRN",8994,2603,1,13,0)
CUTDATE=1-1-1900.  Of course, at other sites, DFN would vary.
"KRN",8994,2603,2,0)
^8994.02A^2^2
"KRN",8994,2603,2,1,0)
ICN^1
"KRN",8994,2603,2,2,0)
CUTDATE^1
"KRN",8994,2603,2,"B","CUTDATE",2)

"KRN",8994,2603,2,"B","ICN",1)

"KRN",8994,2603,3,0)
^8994.03^110^110^3041207^^
"KRN",8994,2603,3,1,0)
Data is returned delimited by the up-arrow (^), with each piece defined 
"KRN",8994,2603,3,2,0)
as follows:
"KRN",8994,2603,3,3,0)
 
"KRN",8994,2603,3,4,0)
Piece
"KRN",8994,2603,3,5,0)
 1 is Beginning of Record indicator (BOR999)
"KRN",8994,2603,3,6,0)
 2 is Accession
"KRN",8994,2603,3,7,0)
 3 is Date/time Received
"KRN",8994,2603,3,8,0)
 4 is Collection Sample
"KRN",8994,2603,3,9,0)
 5 is Bact Rpt Status
"KRN",8994,2603,3,10,0)
 6 is Bact Rpt Date Approved
"KRN",8994,2603,3,11,0)
 7 is Site/Specimen
"KRN",8994,2603,3,12,0)
 8 is Provider
"KRN",8994,2603,3,13,0)
 9 is the LR entry (troubleshooting only)
"KRN",8994,2603,3,14,0)
10 is End of Line indicator (EOL999)
"KRN",8994,2603,3,15,0)
 
"KRN",8994,2603,3,16,0)
Notes:
"KRN",8994,2603,3,17,0)
 
"KRN",8994,2603,3,18,0)
There are also multiple data strings at lower levels, namely:
"KRN",8994,2603,3,19,0)
 
"KRN",8994,2603,3,20,0)
BACTEST999 is BACTERIOLOGY TEST(S)
"KRN",8994,2603,3,21,0)
ORGANISM 999 is ORGANISM at Piece 1, QUANTITY at Piece 2
"KRN",8994,2603,3,22,0)
TXT999 is COMMENT text for the above organism.
"KRN",8994,2603,3,23,0)
BACT_REMARKS is BACT RPT REMARKS
"KRN",8994,2603,3,24,0)
 
"KRN",8994,2603,3,25,0)
Sample data stream returned by this RPC:
"KRN",8994,2603,3,26,0)
 
"KRN",8994,2603,3,27,0)
SPN LAB MICRO BLOOD Results:
"KRN",8994,2603,3,28,0)
BOR999^BC 02 3211^OCT 17, 2002@22:17:11^BLOOD CULTURE BOTTLE 
"KRN",8994,2603,3,29,0)
(BLOOD)^Preliminary^OCT 20, 
"KRN",8994,2603,3,30,0)
2002^BLOOD^GRATTAN,HOWARD^LR(342,6978981.778295^EOL999
"KRN",8994,2603,3,31,0)
BACTTEST999^CHECKING BLOOD FOR LUMPS^EOL999
"KRN",8994,2603,3,32,0)
BACTTEST999^THIN CELL COUNT OF BLOOD^EOL999
"KRN",8994,2603,3,33,0)
ORGANISM999^A SUIS^^EOL999
"KRN",8994,2603,3,34,0)
TXT999^CDIF2 ^EOL999
"KRN",8994,2603,3,35,0)
TXT999^BETA LACTAMASE NEGATIVE ^EOL999
"KRN",8994,2603,3,36,0)
TXT999^BETA LACTAMASE POSITIVE ^EOL999
"KRN",8994,2603,3,37,0)
TXT999^ALT-3 ^EOL999
"KRN",8994,2603,3,38,0)
ORGANISM999^AGROBACTERIUM TUMEFACIENS/RADIOBACTER^209 ^EOL999
"KRN",8994,2603,3,39,0)
TXT999^REFERRED TO MYCOLOGY. IDENTIFICATION TO FOLLOW. ^EOL999
"KRN",8994,2603,3,40,0)
TXT999^RNS ^EOL999
"KRN",8994,2603,3,41,0)
TXT999^Vena Cava (VC) ^EOL999
"KRN",8994,2603,3,42,0)
TXT999^PATIENT EXPIRED: NO SENSITIVITY STUDIES DONE ^EOL999
"KRN",8994,2603,3,43,0)
TXT999^Left Ventricle (LV) ^EOL999
"KRN",8994,2603,3,44,0)
BACT_REMARKS999^NO GROWTH AFTER 2 DAYS (PRELIM) ^EOL999
"KRN",8994,2603,3,45,0)
 
"KRN",8994,2603,3,46,0)
 
"KRN",8994,2603,3,47,0)
BOR999^BC 02 3210^OCT 17, 2002@22:16:49^BLOOD CULTURE BOTTLE 
"KRN",8994,2603,3,48,0)
(BLOOD)^Preliminary^OCT 20, 
"KRN",8994,2603,3,49,0)
2002^BLOOD^GRATTAN,HOWARD^LR(342,6978981.778362^EOL999
"KRN",8994,2603,3,50,0)
BACT_REMARKS999^NO GROWTH AFTER 2 DAYS (PRELIM) ^EOL999
"KRN",8994,2603,3,51,0)
 
"KRN",8994,2603,3,52,0)
 
"KRN",8994,2603,3,53,0)
BOR999^BC 02 3027^OCT 01, 2002@16:19:07^BLOOD CULTURE BOTTLE 
"KRN",8994,2603,3,54,0)
(BLOOD)^Final^OCT 07, 2002^BLOOD^LO,HENRY M^LR(342,6978997.8455^EOL999
"KRN",8994,2603,3,55,0)
BACT_REMARKS999^NO GROWTH AFTER 2 DAYS (PRELIM) ^EOL999
"KRN",8994,2603,3,56,0)
BACT_REMARKS999^NO GROWTH (AEROBES OR ANAEROBES) AFTER 5 DAYS (FINAL) 
"KRN",8994,2603,3,57,0)
^EOL999
"KRN",8994,2603,3,58,0)
 
"KRN",8994,2603,3,59,0)
 
"KRN",8994,2603,3,60,0)
BOR999^BC 02 3026^OCT 01, 2002@16:18:35^BLOOD CULTURE BOTTLE 
"KRN",8994,2603,3,61,0)
(BLOOD)^Final^OCT 07, 2002^BLOOD^LO,HENRY M^LR(342,6978997.847^EOL999
"KRN",8994,2603,3,62,0)
BACT_REMARKS999^NO GROWTH AFTER 2 DAYS (PRELIM) ^EOL999
"KRN",8994,2603,3,63,0)
BACT_REMARKS999^NO GROWTH (AEROBES OR ANAEROBES) AFTER 5 DAYS (FINAL) 
"KRN",8994,2603,3,64,0)
^EOL999
"KRN",8994,2603,3,65,0)
 
"KRN",8994,2603,3,66,0)
 
"KRN",8994,2603,3,67,0)
BOR999^BC 97 1420^JUL 08, 1997@22:47:56^BLOOD CULTURE BOTTLE 
"KRN",8994,2603,3,68,0)
(BLOOD)^Final^JUL 14, 1997^BLOOD^FELIX,DENISON 
"KRN",8994,2603,3,69,0)
A^LR(342,7029290.775249^EOL999
"KRN",8994,2603,3,70,0)
BACTTEST999^CELLS PUT INTO CARTON^EOL999
"KRN",8994,2603,3,71,0)
BACTTEST999^COOKED TILL BOILING^EOL999
"KRN",8994,2603,3,72,0)
BACTTEST999^RECHECK CONTACT PROVIDER IF GROWTH^EOL999
"KRN",8994,2603,3,73,0)
ORGANISM999^CIMEX LECTULARIUS^C1 ^EOL999
"KRN",8994,2603,3,74,0)
TXT999^Trach Mask ^EOL999
"KRN",8994,2603,3,75,0)
TXT999^NRB Mask ^EOL999
"KRN",8994,2603,3,76,0)
TXT999^Venti Mask ^EOL999
"KRN",8994,2603,3,77,0)
TXT999^Spontaneous ^EOL999
"KRN",8994,2603,3,78,0)
TXT999^N/C ^EOL999
"KRN",8994,2603,3,79,0)
ORGANISM999^CANDIDA^IF CLINICALLY SIGNIFICANT CALL EXT 2647 FOR 
"KRN",8994,2603,3,80,0)
SENSITIVITY ^EOL999
"KRN",8994,2603,3,81,0)
TXT999^GROWTH IN 1 OF 2 BOTTLES ^EOL999
"KRN",8994,2603,3,82,0)
TXT999^GROWTH IN 2 OF 2 BOTTLES ^EOL999
"KRN",8994,2603,3,83,0)
TXT999^LAB POLICY ON DECUBITUS WOUND CULTURES WITH GROWTH OF 4 OR MORE 
"KRN",8994,2603,3,84,0)
^EOL999
"KRN",8994,2603,3,85,0)
BACT_REMARKS999^NO GROWTH AFTER 2 DAYS (PRELIM) ^EOL999
"KRN",8994,2603,3,86,0)
BACT_REMARKS999^NO GROWTH (AEROBES OR ANAEROBES) AFTER 5 DAYS (FINAL) 
"KRN",8994,2603,3,87,0)
^EOL999
"KRN",8994,2603,3,88,0)
 
"KRN",8994,2603,3,89,0)
 
"KRN",8994,2603,3,90,0)
BOR999^BC 97 1419^JUL 08, 1997@22:45:13^BLOOD CULTURE BOTTLE 
"KRN",8994,2603,3,91,0)
(BLOOD)^Final^JUL 14, 1997^BLOOD^FELIX,DENISON 
"KRN",8994,2603,3,92,0)
A^LR(342,7029290.775542^EOL999
"KRN",8994,2603,3,93,0)
BACT_REMARKS999^NO GROWTH AFTER 2 DAYS (PRELIM) ^EOL999
"KRN",8994,2603,3,94,0)
BACT_REMARKS999^NO GROWTH (AEROBES OR ANAEROBES) AFTER 5 DAYS (FINAL) 
"KRN",8994,2603,3,95,0)
^EOL999
"KRN",8994,2603,3,96,0)
 
"KRN",8994,2603,3,97,0)
 
"KRN",8994,2603,3,98,0)
BOR999^BC 95 1031^MAY 20, 1995@14:13:32^BLOOD CULTURE BOTTLE 
"KRN",8994,2603,3,99,0)
(BLOOD)^Final^MAY 26, 1995^BLOOD^JACKSON,PHILLIP 
"KRN",8994,2603,3,100,0)
G^LR(342,7049478.85869^EOL999
"KRN",8994,2603,3,101,0)
BACT_REMARKS999^NO GROWTH AFTER 2 DAYS (PRELIM) ^EOL999
"KRN",8994,2603,3,102,0)
BACT_REMARKS999^2 ^EOL999
"KRN",8994,2603,3,103,0)
BACT_REMARKS999^Y ^EOL999
"KRN",8994,2603,3,104,0)
BACT_REMARKS999^NO AEROBIC OR ANAEROBIC GROWTH AFTER 5 DAYS(FINAL) ^EOL999
"KRN",8994,2603,3,105,0)
 
"KRN",8994,2603,3,106,0)
 
"KRN",8994,2603,3,107,0)
BOR999^BC 95 1030^MAY 20, 1995@14:13:21^BLOOD CULTURE BOTTLE 
"KRN",8994,2603,3,108,0)
(BLOOD)^Final^MAY 26, 1995^BLOOD^JACKSON,PHILLIP 
"KRN",8994,2603,3,109,0)
G^LR(342,7049478.8587^EOL999
"KRN",8994,2603,3,110,0)
BACT_REMARKS999^NO AEROBIC OR ANAEROBIC GROWTH AFTER 5 DAYS(FINAL) ^EOL999
"KRN",8994,2604,-1)
0^57
"KRN",8994,2604,0)
SPN PUT PROSTHETIC DEVICES^COL^SPNRPCG^4^A^0^^^^^1
"KRN",8994,2604,1,0)
^8994.01^35^35^3041207^^
"KRN",8994,2604,1,1,0)
 This RPC is for the Prosthetic Device Codes subscreen on the Pressure 
"KRN",8994,2604,1,2,0)
 Ulcer Treatment report.
"KRN",8994,2604,1,3,0)
 
"KRN",8994,2604,1,4,0)
 Calling the line tag COL will generate all Prosthetic Device Codes on
"KRN",8994,2604,1,5,0)
 file from the cut off date forward.
"KRN",8994,2604,1,6,0)
 
"KRN",8994,2604,1,7,0)
 The results are first placed into ^UTILITY($J), and
"KRN",8994,2604,1,8,0)
 then sorted into reverse date order and placed into ^TMP($J)
"KRN",8994,2604,1,9,0)
 
"KRN",8994,2604,1,10,0)
 To call this RPC, simply DO
"KRN",8994,2604,1,11,0)
 COL(,DFN,CUTDATE) , where
"KRN",8994,2604,1,12,0)
 
"KRN",8994,2604,1,13,0)
 DFN = Internal Entry Number of patient in the PATIENT file (#2)
"KRN",8994,2604,1,14,0)
 
"KRN",8994,2604,1,15,0)
 CUTDATE = Cut off date. Results are inclusive from cut off date to 
"KRN",8994,2604,1,16,0)
present
"KRN",8994,2604,1,17,0)
 
"KRN",8994,2604,1,18,0)
 Sample ^TMP Global data string, using first item:
"KRN",8994,2604,1,19,0)
 
"KRN",8994,2604,1,20,0)
 Piece
"KRN",8994,2604,1,21,0)
  1 is HCPCS CODE --> L3001  (this is the prosthetic device code)
"KRN",8994,2604,1,22,0)
  2 is Item Description --> LINER-SPENCO
"KRN",8994,2604,1,23,0)
  3 is Date Delivered --> JUN 19, 2003
"KRN",8994,2604,1,24,0)
  4 is file and note where information was obtained from (troubleshooting 
"KRN",8994,2604,1,25,0)
only)
"KRN",8994,2604,1,26,0)
 
"KRN",8994,2604,1,27,0)
 
"KRN",8994,2604,1,28,0)
Global ^TMP($J -- NOTE: translation in effect
"KRN",8994,2604,1,29,0)
^TMP(545631591,1)=L3001^LINER-SPENCO^JUN 19, 2003^RMPR(664.1(9548
"KRN",8994,2604,1,30,0)
               2)=L3221^SHOE-EXTRA DEPTH *PR^AUG 30, 1999^RMPR(664.1(5039
"KRN",8994,2604,1,31,0)
               3)=L3002^INSERT,SHOE^AUG 30, 1999^RMPR(664.1(5039
"KRN",8994,2604,1,32,0)
               4)=L2999^SOCKS,DIABETIC,LOOSE-FIT *PR^AUG 30, 
"KRN",8994,2604,1,33,0)
1999^RMPR(664.1(5039
"KRN",8994,2604,1,34,0)
               5)=L3002^INSOLE-MOLDABLE *PR^JAN 11, 1999^RMPR(664.1(1379
"KRN",8994,2604,1,35,0)
               6)=L3002^INSERT,SHOE^JAN 11, 1999^RMPR(664.1(1415
"KRN",8994,2604,2,0)
^8994.02A^2^2
"KRN",8994,2604,2,1,0)
ICN^1
"KRN",8994,2604,2,2,0)
CUTDATE^1
"KRN",8994,2604,2,"B","CUTDATE",2)

"KRN",8994,2604,2,"B","ICN",1)

"KRN",8994,2604,3,0)
^8994.03^17^17^3041207^^
"KRN",8994,2604,3,1,0)
 Data is returned as a data stream, with each piece as follows:
"KRN",8994,2604,3,2,0)
 
"KRN",8994,2604,3,3,0)
 Piece
"KRN",8994,2604,3,4,0)
  1 is HCPCS CODE --> L3001  (this is the prosthetic device code)
"KRN",8994,2604,3,5,0)
  2 is Item Description --> LINER-SPENCO
"KRN",8994,2604,3,6,0)
  3 is Date Delivered --> JUN 19, 2003
"KRN",8994,2604,3,7,0)
  4 is file and note where data was obtained from (troubleshooting only)
"KRN",8994,2604,3,8,0)
 
"KRN",8994,2604,3,9,0)
Sample data stream returned by this RPC:
"KRN",8994,2604,3,10,0)
 
"KRN",8994,2604,3,11,0)
SPN PUT PROSTHETIC DEVICES Results:
"KRN",8994,2604,3,12,0)
L5301^L5300 BK LIMB(200F)^SEP 09, 2002^RMPR(664.1(1115EOL999
"KRN",8994,2604,3,13,0)
L5301^PROSTHESIS LEG PERMANENT BELOW KNEE^APR 26,
"KRN",8994,2604,3,14,0)
2002^RMPR(664.1(1035EOL999
"KRN",8994,2604,3,15,0)
L5301^PROSTHESIS LEG PERMANENT BELOW KNEE^APR 19,
"KRN",8994,2604,3,16,0)
2002^RMPR(664.1(1036EOL999
"KRN",8994,2604,3,17,0)
L5999^L5300 BK LIMB(200F)^MAR 28, 2002^RMPR(664.1(997EOL999
"KRN",8994,2605,-1)
0^58
"KRN",8994,2605,0)
SPN MEDS 1ST 2-CHARS VA CLASS^COL^SPNRPCH^4^A^0^^^^^1
"KRN",8994,2605,1,0)
^^85^85^3070119^
"KRN",8994,2605,1,1,0)
This RPC returns Pharmacy data in support of the Pharmacy Supplies 
"KRN",8994,2605,1,2,0)
subscreen of the Pressure Ulcer Treatment report.
"KRN",8994,2605,1,3,0)
 
"KRN",8994,2605,1,4,0)
The results are first placed into ^UTILITY($J), and
"KRN",8994,2605,1,5,0)
 then sorted into reverse date order and placed into ^TMP($J)
"KRN",8994,2605,1,6,0)
 
"KRN",8994,2605,1,7,0)
NOTE: NATIONAL DRUG CLASS (NDC) is also called VA CLASSIFICATION.
"KRN",8994,2605,1,8,0)
 
"KRN",8994,2605,1,9,0)
NOTE: This RPC will find prescriptions based on the
"KRN",8994,2605,1,10,0)
first two characters of the NATIONAL DRUG CLASS
"KRN",8994,2605,1,11,0)
being XX OR XA (these represent PHARMACY SUPPLIES).
"KRN",8994,2605,1,12,0)
 
"KRN",8994,2605,1,13,0)
NOTE: To find prescriptions based on the entire 5-character
"KRN",8994,2605,1,14,0)
NATIONAL DRUG CLASS name, use SPN MEDS BY FULL VA CLASS
"KRN",8994,2605,1,15,0)
 
"KRN",8994,2605,1,16,0)
   Parameter values:
"KRN",8994,2605,1,17,0)
   DFN is ien of the pt.
"KRN",8994,2605,1,18,0)
   CUTDATE is the date to start collection data from.
"KRN",8994,2605,1,19,0)
   TYPE will be for the drug class.
"KRN",8994,2605,1,20,0)
      1 is for rx's when the first two characters of the NDC 
"KRN",8994,2605,1,21,0)
      are XA or XX.
"KRN",8994,2605,1,22,0)
      2 is for rx's when the first two characters of the NDC
"KRN",8994,2605,1,23,0)
      are IM and the drug name contains INFLUENZA.
"KRN",8994,2605,1,24,0)
         Returns:
"KRN",8994,2605,1,25,0)
                TMP($J,X) sorted by most recent Rx
"KRN",8994,2605,1,26,0)
                VA CLASS ^ ITEM DESCRIPTION ^ DATE DISPENSED ^ PSRX(IEN
"KRN",8994,2605,1,27,0)
 
"KRN",8994,2605,1,28,0)
 
"KRN",8994,2605,1,29,0)
SPN MEDS 1ST 2-CHARS VA CLASS Results: 
"KRN",8994,2605,1,30,0)
 
"KRN",8994,2605,1,31,0)
IP 10.4.229.202
"KRN",8994,2605,1,32,0)
Account dayt42
"KRN",8994,2605,1,33,0)
 
"KRN",8994,2605,1,34,0)
NOTE  this routine will find prescriptions based on the
"KRN",8994,2605,1,35,0)
THE FIRST TWO CHARACTERS IN THE NATIONAL DRUG CLASS IN, AM .
"KRN",8994,2605,1,36,0)
TYPE will be for the drug class
"KRN",8994,2605,1,37,0)
1 is rx's that have a drug class that begin with either a XA OR XX..
"KRN",8994,2605,1,38,0)
2 Locates RX's the have a drug NDC that begins with 'IM' and the drug 
"KRN",8994,2605,1,39,0)
name has INFLUENZA in the text
"KRN",8994,2605,1,40,0)
 
"KRN",8994,2605,1,41,0)
Returns:
"KRN",8994,2605,1,42,0)
TMP($J,x) sorted by most recent rx
"KRN",8994,2605,1,43,0)
VA CLASS ^ ITEM DESCRIPTION ^ DATE DISPENSED ^ PSRX(IEN
"KRN",8994,2605,1,44,0)
 
"KRN",8994,2605,1,45,0)
Three parameters
"KRN",8994,2605,1,46,0)
 
"KRN",8994,2605,1,47,0)
1 1002624015  / ICN    (Patients dfn is 4570)
"KRN",8994,2605,1,48,0)
2 Jan 01 2004  / cut date
"KRN",8994,2605,1,49,0)
3 1
"KRN",8994,2605,1,50,0)
 
"KRN",8994,2605,1,51,0)
Report Generated at Fri Jan 19 17:51:17 CST 2007. 
"KRN",8994,2605,1,52,0)
parameter size: 3 
"KRN",8994,2605,1,53,0)
Division : 552 Is connected true 
"KRN",8994,2605,1,54,0)
 
"KRN",8994,2605,1,55,0)
 
"KRN",8994,2605,1,56,0)
SPN MEDS 1ST 2-CHARS VA CLASS Results: 
"KRN",8994,2605,1,57,0)
 
"KRN",8994,2605,1,58,0)
XA402^POUCH,DRAINABLE,SUR-FIT NATURA 401513^MAR 31, 
"KRN",8994,2605,1,59,0)
2005^PSRX(4302643^EOL999
"KRN",8994,2605,1,60,0)
XA402^POUCH,DRAINABLE,SUR-FIT NATURA 401513^FEB 03, 
"KRN",8994,2605,1,61,0)
2005^PSRX(4237949^EOL999
"KRN",8994,2605,1,62,0)
XA604^SKIN PREP WIPE^JAN 21, 2005^PSRX(4221489^EOL999
"KRN",8994,2605,1,63,0)
XA604^WAFER,SURFIT-NAT FLEXIBLE C#4131-67^JAN 21, 2005^PSRX(4221493^EOL999
"KRN",8994,2605,1,64,0)
XA511^CATHETER 26FR 5CC BALLOON (EA)^NOV 18, 2004^PSRX(4160679^EOL999
"KRN",8994,2605,1,65,0)
XA900^ADHESIVE REMOVER PAD^NOV 17, 2004^PSRX(4160676^EOL999
"KRN",8994,2605,1,66,0)
XA400^TRAY, CATHETERIZATION W/O CATHETER^NOV 17, 2004^PSRX(4160687^EOL999
"KRN",8994,2605,1,67,0)
XA500^URINE DRAINAGE BAG (CYSTOFLO) (ea) ^AUG 13, 2004^PSRX(4062088^EOL999
"KRN",8994,2605,1,68,0)
XA604^WAFER,SURFIT-NAT FLEXIBLE C#4131-67^AUG 13, 2004^PSRX(4062089^EOL999
"KRN",8994,2605,1,69,0)
XA604^WAFER,DURAHESIVE FLEXABLE #413165^JUN 28, 2004^PSRX(4007001^EOL999
"KRN",8994,2605,1,70,0)
XA400^TRAY, CATHETERIZATION W/O CATHETER^JUN 11, 2004^PSRX(3992102^EOL999
"KRN",8994,2605,1,71,0)
XA400^TRAY, CATHETERIZATION W/O CATHETER^MAY 14, 2004^PSRX(3962960^EOL999
"KRN",8994,2605,1,72,0)
XA400^TRAY, CATHETERIZATION W/O CATHETER^MAY 14, 2004^PSRX(3962961^EOL999
"KRN",8994,2605,1,73,0)
XA700^OSTO-ZYME 8 OZ^MAY 14, 2004^PSRX(3963501^EOL999
"KRN",8994,2605,1,74,0)
XA402^POUCH,DRAINABLE,SUR-FIT NATURA 401513^APR 07, 
"KRN",8994,2605,1,75,0)
2004^PSRX(3923827^EOL999
"KRN",8994,2605,1,76,0)
XA604^SKIN PREP WIPE^FEB 02, 2004^PSRX(3850184^EOL999
"KRN",8994,2605,1,77,0)
XA604^SKIN PREP WIPE^FEB 02, 2004^PSRX(3850185^EOL999
"KRN",8994,2605,1,78,0)
XA604^WAFER,DURAHESIVE FLEXABLE #413165^JAN 30, 2004^PSRX(3850186^EOL999
"KRN",8994,2605,1,79,0)
 
"KRN",8994,2605,1,80,0)
 
"KRN",8994,2605,1,81,0)
 SPN MEDS 1ST 2-CHARS VA CLASS Results length: 1227 Is connected true 
"KRN",8994,2605,1,82,0)
 
"KRN",8994,2605,1,83,0)
Ran to find no data results:
"KRN",8994,2605,1,84,0)
SPN MEDS 1ST 2-CHARS VA CLASS Results: 
"KRN",8994,2605,1,85,0)
SPN MEDS 1ST 2-CHARS VA CLASS Results length: 0 
"KRN",8994,2605,2,0)
^8994.02A^3^3
"KRN",8994,2605,2,1,0)
ICN^1
"KRN",8994,2605,2,2,0)
CUTDATE^1
"KRN",8994,2605,2,3,0)
TYPE^1
"KRN",8994,2605,2,"B","CUTDATE",2)

"KRN",8994,2605,2,"B","ICN",1)

"KRN",8994,2605,2,"B","TYPE",3)

"KRN",8994,2605,3,0)
^8994.03^19^19^3070119^^^
"KRN",8994,2605,3,1,0)
         Returns:
"KRN",8994,2605,3,2,0)
                TMP($J,X) sorted by most recent Rx
"KRN",8994,2605,3,3,0)
                VA CLASS ^ ITEM DESCRIPTION ^ DATE DISPENSED ^ PSRX(IEN
"KRN",8994,2605,3,4,0)
 
"KRN",8994,2605,3,5,0)
Data is returned as a data stream, with each piece as follows:
"KRN",8994,2605,3,6,0)
 Piece
"KRN",8994,2605,3,7,0)
  1 is National Drug Class or VA Class  (such as XA108)
"KRN",8994,2605,3,8,0)
  2 is Drug name  (such as BANDAGE,ELASTIC 4IN F#721-9792)
"KRN",8994,2605,3,9,0)
  3 is Date Dispensed  (such as MAY 21,2002)
"KRN",8994,2605,3,10,0)
  4 is The Prescription Number  (troubleshooting only)
"KRN",8994,2605,3,11,0)
  5 is the End-of-Line indicator (EOL999)
"KRN",8994,2605,3,12,0)
 
"KRN",8994,2605,3,13,0)
Sample data stream returned by this RPC:
"KRN",8994,2605,3,14,0)
 
"KRN",8994,2605,3,15,0)
SPN MEDS 1ST 2-CHARS VA CLASS Results:
"KRN",8994,2605,3,16,0)
XA109^KLING 4IN STERILE^JAN 23,2002^PSRX(12389247^EOL999
"KRN",8994,2605,3,17,0)
XA109^KLING 4IN STERILE^JAN 02,2002^PSRX(12361535^EOL999
"KRN",8994,2605,3,18,0)
XA202^TAPE,PAPER 1IN F#338-5405^DEC 12,2001^PSRX(12339629^EOL999
"KRN",8994,2605,3,19,0)
XA109^KERLIX 4.5IN STERILE^NOV 28,2001^PSRX(12322059^EOL999
"KRN",8994,2606,-1)
0^59
"KRN",8994,2606,0)
SPN MEDS BY FULL VA CLASS^COL^SPNRPCI^4^A^0^^^^^1
"KRN",8994,2606,1,0)
^8994.01^31^31^3041207^^
"KRN",8994,2606,1,1,0)
This RPC supports the Antiviral Medications subscreen of the Influenza 
"KRN",8994,2606,1,2,0)
Diagnosis and Treatment Report.
"KRN",8994,2606,1,3,0)
 
"KRN",8994,2606,1,4,0)
         NOTE this RPC will find antiviral medications based on the
"KRN",8994,2606,1,5,0)
               WHOLE VALUE of the NATIONAL DRUG CLASS (NDC)
"KRN",8994,2606,1,6,0)
               i.e., IN160, AM800.  Another name for NDC is VA CLASS.
"KRN",8994,2606,1,7,0)
         NOTE  To find prescriptions based on the first two characters
"KRN",8994,2606,1,8,0)
               of the NATIONAL DRUG CLASS, use SPN MEDS 1ST 2-CHARS VA 
"KRN",8994,2606,1,9,0)
CLASS
"KRN",8994,2606,1,10,0)
 
"KRN",8994,2606,1,11,0)
        Parameter values:
"KRN",8994,2606,1,12,0)
 
"KRN",8994,2606,1,13,0)
           DFN is ien of the pt
"KRN",8994,2606,1,14,0)
           CUTDATE is the date to start collection data from
"KRN",8994,2606,1,15,0)
           TYPE will be for the drug's VA class
"KRN",8994,2606,1,16,0)
               1 is anti-viral medications
"KRN",8994,2606,1,17,0)
               2 is NSAID analgesics
"KRN",8994,2606,1,18,0)
               3 is pain medications
"KRN",8994,2606,1,19,0)
               4 is anticonvulsants
"KRN",8994,2606,1,20,0)
               5 is tricyclic antidepressants
"KRN",8994,2606,1,21,0)
               6 is opioid analgesics
"KRN",8994,2606,1,22,0)
               7 is local anesthetics
"KRN",8994,2606,1,23,0)
               8 is other medications
"KRN",8994,2606,1,24,0)
 
"KRN",8994,2606,1,25,0)
        Returns:
"KRN",8994,2606,1,26,0)
               TMP($J,X) sorted by most recent rx
"KRN",8994,2606,1,27,0)
               VA CLASS ^ ITEM DESCRIPTION ^ DATE DISPENSED ^ PSRX(IEN
"KRN",8994,2606,1,28,0)
 
"KRN",8994,2606,1,29,0)
Piece 1 is VA CLASS (such as AM800)
"KRN",8994,2606,1,30,0)
Piece 2 is ITEM DESCRIPTION (such as OSELTAMIVIR PO4 75MG CAP)
"KRN",8994,2606,1,31,0)
Piece 3 is DATE DISPENSED (such as 10/01/2003)
"KRN",8994,2606,2,0)
^8994.02A^3^3
"KRN",8994,2606,2,1,0)
ICN^1
"KRN",8994,2606,2,2,0)
CUTDATE^1
"KRN",8994,2606,2,3,0)
TYPE^1
"KRN",8994,2606,2,"B","CUTDATE",2)

"KRN",8994,2606,2,"B","ICN",1)

"KRN",8994,2606,2,"B","TYPE",3)

"KRN",8994,2606,3,0)
^8994.03^13^13^3041207^^
"KRN",8994,2606,3,1,0)
Data is returned delimited by the up-arrow (^), with each piece defined
"KRN",8994,2606,3,2,0)
as follows:
"KRN",8994,2606,3,3,0)
 
"KRN",8994,2606,3,4,0)
Piece 1 is VA CLASS (such as AM800)
"KRN",8994,2606,3,5,0)
Piece 2 is ITEM DESCRIPTION (such as OSELTAMIVIR PO4 75MG CAP)
"KRN",8994,2606,3,6,0)
Piece 3 is DATE DISPENSED (such as 10/01/2003)
"KRN",8994,2606,3,7,0)
Piece 4 is Global Mumps reference for the Rx (troubleshooting only)
"KRN",8994,2606,3,8,0)
 
"KRN",8994,2606,3,9,0)
Sample data stream returned by SPN MEDS BY FULL VA CLASS:
"KRN",8994,2606,3,10,0)
SPN MEDS BY FULL VA CLASS Results:
"KRN",8994,2606,3,11,0)
AM800^OSELTAMIVIR PO4 75MG CAP^AUG 26, 2004^PSRX(12720896EOL999
"KRN",8994,2606,3,12,0)
AM800^AMANTADINE HCL 100MG CAP^SEP 01, 1997^PSRX(10929516EOL999
"KRN",8994,2606,3,13,0)
AM800^RIMANTADINE HCL 100MG TAB^APR 28, 1997^PSRX(10844378EOL999
"KRN",8994,2607,-1)
0^60
"KRN",8994,2607,0)
SPN IDT DISCHARGE LOCATIONS^COL^SPNRPCJ^4^A^0^^^^^1
"KRN",8994,2607,1,0)
^8994.01^32^32^3041207^^
"KRN",8994,2607,1,1,0)
This RPC supports the Discharge Locations subscreen of the Influenza
"KRN",8994,2607,1,2,0)
Diagnosis and Treatment Report.
"KRN",8994,2607,1,3,0)
 
"KRN",8994,2607,1,4,0)
Returns discharge location and discharge date (Note: potentially, this 
"KRN",8994,2607,1,5,0)
can also be used for admission location and admission date, by passing a 
"KRN",8994,2607,1,6,0)
1 in the TYPE parameter).  A TYPE parameter of 1 will return admission
"KRN",8994,2607,1,7,0)
information, whereas 3 will return discharge information.
"KRN",8994,2607,1,8,0)
 
"KRN",8994,2607,1,9,0)
Parameter values:
"KRN",8994,2607,1,10,0)
 
"KRN",8994,2607,1,11,0)
      DFN is ien of the patient
"KRN",8994,2607,1,12,0)
      CUTDATE is the date from which to start collection of data
"KRN",8994,2607,1,13,0)
      TYPE is 1 for Admission, 3 for Discharge
"KRN",8994,2607,1,14,0)
 
"KRN",8994,2607,1,15,0)
 
"KRN",8994,2607,1,16,0)
Sample ^TMP Global data string, using first item, and based on:
"KRN",8994,2607,1,17,0)
DFN     = 4812
"KRN",8994,2607,1,18,0)
CUTDATE = JAN 1,1980
"KRN",8994,2607,1,19,0)
TYPE    = 3
"KRN",8994,2607,1,20,0)
 
"KRN",8994,2607,1,21,0)
  Piece
"KRN",8994,2607,1,22,0)
   1 is Date & Time of Admission --> NOV 27, 1996@08:30:35
"KRN",8994,2607,1,23,0)
   2 is Ward admitted to --> 3SE
"KRN",8994,2607,1,24,0)
   3 is Room-Bed --> 3D15-6
"KRN",8994,2607,1,25,0)
   4 is Date & Time of Discharge --> NOV 29,1996@14:37:18
"KRN",8994,2607,1,26,0)
   5 is Discharge Location --> RETURN TO COMMUNITY-INDEPENDENT
"KRN",8994,2607,1,27,0)
   6 is Mumps global root and ien (for troubleshooting only)
"KRN",8994,2607,1,28,0)
   7 is End of Line indicator (EOL999)
"KRN",8994,2607,1,29,0)
 
"KRN",8994,2607,1,30,0)
 
"KRN",8994,2607,1,31,0)
^TMP(541077599,1) = NOV 27, 1996@08:30:35^3SE^3D15-6^NOV 29, 
"KRN",8994,2607,1,32,0)
1996@14:37:18^RETURN TO COMMUNITY-INDEPENDENT^DGPT(101199^EOL999
"KRN",8994,2607,2,0)
^8994.02A^3^3
"KRN",8994,2607,2,1,0)
ICN^1
"KRN",8994,2607,2,2,0)
CUTDATE^1
"KRN",8994,2607,2,3,0)
TYPE^1
"KRN",8994,2607,2,"B","CUTDATE",2)

"KRN",8994,2607,2,"B","ICN",1)

"KRN",8994,2607,2,"B","TYPE",3)

"KRN",8994,2607,3,0)
^^21^21^3041006^
"KRN",8994,2607,3,1,0)
Data is returned delimited by the up-arrow (^), with each piece defined 
"KRN",8994,2607,3,2,0)
as follows:
"KRN",8994,2607,3,3,0)
 
"KRN",8994,2607,3,4,0)
   Piece
"KRN",8994,2607,3,5,0)
    1 is Date & Time of Admission
"KRN",8994,2607,3,6,0)
    2 is Ward admitted to
"KRN",8994,2607,3,7,0)
    3 is Room-Bed
"KRN",8994,2607,3,8,0)
    4 is Date & Time of Discharge
"KRN",8994,2607,3,9,0)
    5 is Discharge Location
"KRN",8994,2607,3,10,0)
    6 is Mumps global root and ien (for troubleshooting only)
"KRN",8994,2607,3,11,0)
    7 is End of Line Indicator (EOL999)
"KRN",8994,2607,3,12,0)
 
"KRN",8994,2607,3,13,0)
Sample data stream:
"KRN",8994,2607,3,14,0)
 
"KRN",8994,2607,3,15,0)
SPN IDT DISCHARGE LOCATIONS Results:
"KRN",8994,2607,3,16,0)
MAR 07, 1999@14:37:05^4CCU^CORCU-5^MAR 11, 1999@13:30:37^VA MEDICAL 
"KRN",8994,2607,3,17,0)
CENTER^DGPT(116495^EOL999
"KRN",8994,2607,3,18,0)
FEB 06, 1994@10:45^3SW^3D62-22^FEB 08, 1994@15:04:20^RETURN TO 
"KRN",8994,2607,3,19,0)
COMMUNITY-INDEPENDENT^DGPT(79984^EOL999
"KRN",8994,2607,3,20,0)
JUN 07, 1990@16:08^3NE^3B60-22^JUN 13, 1990@14:28^RETURN TO 
"KRN",8994,2607,3,21,0)
COMMUNITY-INDEPENDENT^DGPT(49347^EOL999
"KRN",8994,2609,-1)
0^63
"KRN",8994,2609,0)
SPN PUT LAB CYTOPATH^COL^SPNRPCM^4^A^0^^^^^1
"KRN",8994,2609,2,0)
^8994.02A^2^2
"KRN",8994,2609,2,1,0)
ICN^1
"KRN",8994,2609,2,2,0)
CUTDATE^1
"KRN",8994,2609,2,"B","CUTDATE",2)

"KRN",8994,2609,2,"B","ICN",1)

"KRN",8994,2609,3,0)
^8994.03^112^112^3041207^^^
"KRN",8994,2609,3,1,0)
SPN LAB CYTOPATHOLOGY Results: 
"KRN",8994,2609,3,2,0)
 
"KRN",8994,2609,3,3,0)
BOR999 1^RIGHT URETER CYTOLOGY^MAY 20, 1998@00:00:20^CY 98 710^LR(7019478.99998^EOL999^
"KRN",8994,2609,3,4,0)
BCD999 1^THIS IS THE CYTOPTTHOLOGY DIAGNOSIS LINE ONE^EOL999^
"KRN",8994,2609,3,5,0)
BCD999 2^LINE TWO^EOL999^
"KRN",8994,2609,3,6,0)
BCD999 3^LINE THREE^EOL999^
"KRN",8994,2609,3,7,0)
BCD999 4^ ^EOL999^
"KRN",8994,2609,3,8,0)
BCD999 5^ ^EOL999^
"KRN",8994,2609,3,9,0)
BCD999 6^END OF THE CYTOPATHOLOGY DIAGNOSIS^EOL999^
"KRN",8994,2609,3,10,0)
BME999 1^RIGHT URETER CYTOLOGY:|TAB|^EOL999^
"KRN",8994,2609,3,11,0)
BME999 2^ - Abnormal transitional cells present, consistent with^EOL999^
"KRN",8994,2609,3,12,0)
BME999 3^ transitional cell carcinoma.|TAB|^EOL999^
"KRN",8994,2609,3,13,0)
BOF999 1^THIS IS THE OPERATIVE FINDING ON THIS ONE SPECIMEN^EOL999^
"KRN",8994,2609,3,14,0)
BOF999 2^OF DAVE AND CHRIST THIS IS JUST TESTING^EOL999^
"KRN",8994,2609,3,15,0)
BOF999 3^ ^EOL999^
"KRN",8994,2609,3,16,0)
BOF999 4^ ^EOL999^
"KRN",8994,2609,3,17,0)
BOF999 5^ ^EOL999^
"KRN",8994,2609,3,18,0)
BOF999 6^AND NOTHING ELSE^EOL999^
"KRN",8994,2609,3,19,0)
BOF999 7^ ^EOL999^
"KRN",8994,2609,3,20,0)
BOF999 8^ ^EOL999^
"KRN",8994,2609,3,21,0)
BOF999 9^THE END^EOL999^
"KRN",8994,2609,3,22,0)
BCP999 1^RIGHT URETER CYTOLOGY^EOL999^
"KRN",8994,2609,3,23,0)
BCP999 2^DAVES AND CHRIST'S TESTING^EOL999^
"KRN",8994,2609,3,24,0)
 
"KRN",8994,2609,3,25,0)
 
"KRN",8994,2609,3,26,0)
BOR999 2^LEFT URETER CYTOLOGY^MAY 20, 1998@00:00:10^CY 98 709^LR(7019478.99999^EOL999^
"KRN",8994,2609,3,27,0)
BME999 1^LEFT URETER CYTOLOGY:|TAB|^EOL999^
"KRN",8994,2609,3,28,0)
BME999 2^ - Highly suspicious for papillary transitional cell carcinoma|TAB|^EOL999^
"KRN",8994,2609,3,29,0)
BCP999 1^LEFT URETER CYTOLOGY^EOL999^
"KRN",8994,2609,3,30,0)
 
"KRN",8994,2609,3,31,0)
 
"KRN",8994,2609,3,32,0)
BOR999 3^URINE CYTOLOGY, BLADDER^MAY 20, 1998^CY 98 708^LR(7019479^EOL999^
"KRN",8994,2609,3,33,0)
BME999 1^URINE CYTOLOGY, BLADDER:|TAB|^EOL999^
"KRN",8994,2609,3,34,0)
BME999 2^ - Malignant cells present, consistent with papillary transitional|TAB|^EOL999^
"KRN",8994,2609,3,35,0)
BME999 3^ cell carcinoma.|TAB|^EOL999^
"KRN",8994,2609,3,36,0)
BCP999 1^URINE CYTOLOGY, BLADDER^EOL999^
"KRN",8994,2609,3,37,0)
 
"KRN",8994,2609,3,38,0)
 
"KRN",8994,2609,3,39,0)
BOR999 4^URINE^FEB 17, 1998^CY 98 217^LR(7019782^EOL999^
"KRN",8994,2609,3,40,0)
BME999 1^URINE:|TAB|^EOL999^
"KRN",8994,2609,3,41,0)
BME999 2^ - Malignant cells present, consistent with papillary transitional|TAB|^EOL999^
"KRN",8994,2609,3,42,0)
BME999 3^ cell carcinoma, grade II OR III.^EOL999^
"KRN",8994,2609,3,43,0)
BCP999 1^URINE^EOL999^
"KRN",8994,2609,3,44,0)
 
"KRN",8994,2609,3,45,0)
 
"KRN",8994,2609,3,46,0)
BOR999 5^URINE^FEB 13, 1998^CY 98 205^LR(7019786^EOL999^
"KRN",8994,2609,3,47,0)
BME999 1^URINE:|TAB|^EOL999^
"KRN",8994,2609,3,48,0)
BME999 2^ - Malignant cells present, consistent with Transitional cell carcinoma|TAB|^EOL999^
"KRN",8994,2609,3,49,0)
BCP999 1^URINE^EOL999^
"KRN",8994,2609,3,50,0)
 
"KRN",8994,2609,3,51,0)
 
"KRN",8994,2609,3,52,0)
BOR999 6^URINE^OCT 14, 1997^CY 97 1167^LR(7028985^EOL999^
"KRN",8994,2609,3,53,0)
BME999 1^URINE:|TAB|^EOL999^
"KRN",8994,2609,3,54,0)
BME999 2^ - Abnormal transitional cells are present, suggestive of papillary|TAB|^EOL999^
"KRN",8994,2609,3,55,0)
BME999 3^ transitional cell carcinoma.|TAB|^EOL999^
"KRN",8994,2609,3,56,0)
BCP999 1^URINE^EOL999^
"KRN",8994,2609,3,57,0)
 
"KRN",8994,2609,3,58,0)
 
"KRN",8994,2609,3,59,0)
BOR999 7^URINE^OCT 08, 1997^CY 97 1150^LR(7028991^EOL999^
"KRN",8994,2609,3,60,0)
BME999 1^URINE:|TAB|^EOL999^
"KRN",8994,2609,3,61,0)
BME999 2^ - Abnormal transitional cell clusters present, consistent with a|TAB|^EOL999^
"KRN",8994,2609,3,62,0)
BME999 3^ papillary transitional cell carcinoma.|TAB|^EOL999^
"KRN",8994,2609,3,63,0)
BCP999 1^URINE^EOL999^
"KRN",8994,2609,3,64,0)
 
"KRN",8994,2609,3,65,0)
 
"KRN",8994,2609,3,66,0)
BOR999 8^URINE^FEB 06, 1997^CY 97 145^LR(7029793^EOL999^
"KRN",8994,2609,3,67,0)
BME999 1^URINE: |TAB|^EOL999^
"KRN",8994,2609,3,68,0)
BME999 2^ - Moderate to severely atypical transitional cells present;|TAB|^EOL999^
"KRN",8994,2609,3,69,0)
BME999 3^ consistent with low-grade transitional cell carcinoma.|TAB|^EOL999^
"KRN",8994,2609,3,70,0)
BCP999 1^URINE^EOL999^
"KRN",8994,2609,3,71,0)
 
"KRN",8994,2609,3,72,0)
 
"KRN",8994,2609,3,73,0)
BOR999 9^URINE^SEP 24, 1996^CY 96 1154^LR(7039075^EOL999^
"KRN",8994,2609,3,74,0)
BME999 1^URINE:|TAB|^EOL999^
"KRN",8994,2609,3,75,0)
BME999 2^ - Acute inflammation and microhematuria with no apparent|TAB|^EOL999^
"KRN",8994,2609,3,76,0)
BME999 3^ cellular atypia.|TAB|^EOL999^
"KRN",8994,2609,3,77,0)
BCP999 1^URINE^EOL999^
"KRN",8994,2609,3,78,0)
 
"KRN",8994,2609,3,79,0)
 
"KRN",8994,2609,3,80,0)
BOR999 10^URINE^SEP 23, 1996^CY 96 1152^LR(7039076^EOL999^
"KRN",8994,2609,3,81,0)
BME999 1^URINE:|TAB|^EOL999^
"KRN",8994,2609,3,82,0)
BME999 2^ - Acute inflammation and bacteria present|TAB|^EOL999^
"KRN",8994,2609,3,83,0)
BME999 3^ - No apparent malignant cells seen|TAB|^EOL999^
"KRN",8994,2609,3,84,0)
BME999 4^ (See comment)|TAB|^EOL999^
"KRN",8994,2609,3,85,0)
BME999 5^|TAB|^EOL999^
"KRN",8994,2609,3,86,0)
BME999 6^COMMENT: Inflammation obscures cell detail.^EOL999^
"KRN",8994,2609,3,87,0)
BCP999 1^URINE^EOL999^
"KRN",8994,2609,3,88,0)
 
"KRN",8994,2609,3,89,0)
 
"KRN",8994,2609,3,90,0)
BOR999 11^BRONCHIAL WASH^FEB 06, 1995@00:00:10^CY 95 129^LR(7049792.99999^EOL999^
"KRN",8994,2609,3,91,0)
BME999 1^Bronchial Washing:^EOL999^
"KRN",8994,2609,3,92,0)
BME999 2^ - Rare squamous metaplastic cells accompanied by an acute^EOL999^
"KRN",8994,2609,3,93,0)
BME999 3^inflammatory exudate.^EOL999^
"KRN",8994,2609,3,94,0)
BME999 4^ - Evaluation is limited by the poor epithelial cell yield.^EOL999^
"KRN",8994,2609,3,95,0)
BME999 5^ ^EOL999^
"KRN",8994,2609,3,96,0)
BME999 6^Comment: This material is correlated with surgical 95S-333. The findings^EOL999^
"KRN",8994,2609,3,97,0)
BME999 7^are compatible.^EOL999^
"KRN",8994,2609,3,98,0)
BOF999 1^Edema of right lower lobe mucosa.^EOL999^
"KRN",8994,2609,3,99,0)
BPD999 1^Same.^EOL999^
"KRN",8994,2609,3,100,0)
BCP999 1^BRONCHIAL WASH^EOL999^
"KRN",8994,2609,3,101,0)
 
"KRN",8994,2609,3,102,0)
 
"KRN",8994,2609,3,103,0)
BOR999 12^BRONCHIAL BRUSH, RIGHT LOWER LOBE^FEB 06, 1995^CY 95 128^LR(7049793^EOL999^
"KRN",8994,2609,3,104,0)
BME999 1^Bronchial Brush, Right Lower Lobe:^EOL999^
"KRN",8994,2609,3,105,0)
BME999 2^ - Negative for malignant cells.^EOL999^
"KRN",8994,2609,3,106,0)
BME999 3^ - Acute inflammation is present.^EOL999^
"KRN",8994,2609,3,107,0)
BME999 4^ ^EOL999^
"KRN",8994,2609,3,108,0)
BME999 5^Comment: This material is correlated with surgical 95S-333. The findings^EOL999^
"KRN",8994,2609,3,109,0)
BME999 6^are compatible.^EOL999^
"KRN",8994,2609,3,110,0)
BOF999 1^Edema of right lower lobe mucosa.^EOL999^
"KRN",8994,2609,3,111,0)
BPD999 1^Same.^EOL999^
"KRN",8994,2609,3,112,0)
BCP999 1^BRONCHIAL BRUSH, RIGHT LOWER LOBE^EOL999^
"KRN",8994,2610,-1)
0^34
"KRN",8994,2610,0)
SPN RX UTILIZATION SPECIFIC^RPC^SPNLRS7^4^A^0^^1^^^1
"KRN",8994,2610,2,0)
^8994.02A^5^5
"KRN",8994,2610,2,1,0)
FDATE^1
"KRN",8994,2610,2,2,0)
TDATE^1
"KRN",8994,2610,2,3,0)
HIUSERS^1
"KRN",8994,2610,2,4,0)
VALUES^2
"KRN",8994,2610,2,5,0)
PTLIST^1
"KRN",8994,2610,2,"B","FDATE",1)

"KRN",8994,2610,2,"B","HIUSERS",3)

"KRN",8994,2610,2,"B","PTLIST",5)

"KRN",8994,2610,2,"B","TDATE",2)

"KRN",8994,2610,2,"B","VALUES",4)

"KRN",8994,2611,-1)
0^62
"KRN",8994,2611,0)
SPN PUT LAB COMPLETE BLOOD^COL^SPNRPCL^4^A^0^^^^^1
"KRN",8994,2611,2,0)
^8994.02A^2^2
"KRN",8994,2611,2,1,0)
ICN^1
"KRN",8994,2611,2,2,0)
CUTDATE^1
"KRN",8994,2611,2,"B","CUTDATE",2)

"KRN",8994,2611,2,"B","ICN",1)

"KRN",8994,2612,-1)
0^64
"KRN",8994,2612,0)
SPN PUT LAB SURG PATH^COL^SPNRPCN^4^A^0^^^^^1
"KRN",8994,2612,2,0)
^8994.02A^2^2
"KRN",8994,2612,2,1,0)
ICN^1
"KRN",8994,2612,2,2,0)
CUTDATE^1
"KRN",8994,2612,2,"B","CUTDATE",2)

"KRN",8994,2612,2,"B","ICN",1)

"KRN",8994,2613,-1)
0^65
"KRN",8994,2613,0)
SPN PUT LAB MICRO^COL^SPNRPCO^4^A^0^^^^^1
"KRN",8994,2613,2,0)
^8994.02A^2^2
"KRN",8994,2613,2,1,0)
ICN^1
"KRN",8994,2613,2,2,0)
CUTDATE^1
"KRN",8994,2613,2,"B","CUTDATE",2)

"KRN",8994,2613,2,"B","ICN",1)

"KRN",8994,2614,-1)
0^67
"KRN",8994,2614,0)
SPN BUILD PICK LIST ENTRIES^COL^SPNRPCQ^4^A^0^^^^^1
"KRN",8994,2614,1,0)
^8994.01^6^6^3050502^^
"KRN",8994,2614,1,1,0)
Supports the use of filters by providing a list of locally valid entries 
"KRN",8994,2614,1,2,0)
in the site's Vista files for Lab tests, Drug names, and Prosthetic 
"KRN",8994,2614,1,3,0)
device names.  This local "fetch" can then be used to supply locally 
"KRN",8994,2614,1,4,0)
valid records from which to choose when running the SPN FILTER call.  
"KRN",8994,2614,1,5,0)
This RPC is necessary because each site's file entries are named and 
"KRN",8994,2614,1,6,0)
numbered differently.
"KRN",8994,2614,2,0)
^8994.02A^1^1
"KRN",8994,2614,2,1,0)
TYPE^1^^1
"KRN",8994,2614,2,1,1,0)
^^1^1^3050502^
"KRN",8994,2614,2,1,1,1,0)
The value for this parameter must be either CLINIC, PROS, NDC, or LAB.
"KRN",8994,2614,2,"B","TYPE",1)

"KRN",8994,2615,-1)
0^31
"KRN",8994,2615,0)
SPN PHARMACY UTL REPORT^RPC^SPNLRL7^4^A^0^^^^^1
"KRN",8994,2615,2,0)
^8994.02A^7^7
"KRN",8994,2615,2,1,0)
FDATE^1
"KRN",8994,2615,2,1,1,0)
^^1^1^3041118^
"KRN",8994,2615,2,1,1,1,0)
Date to start from.  mm/dd/yyyy.
"KRN",8994,2615,2,2,0)
COST^1
"KRN",8994,2615,2,2,1,0)
^^1^1^3041118^
"KRN",8994,2615,2,2,1,1,0)
Value must be either ACTUAL OR CURRENT.
"KRN",8994,2615,2,3,0)
MINCOST^1
"KRN",8994,2615,2,3,1,0)
^^1^1^3041118^
"KRN",8994,2615,2,3,1,1,0)
Minimum dollar cost of dispensed fills to display:  (0-9999999)
"KRN",8994,2615,2,4,0)
MINFILL^1
"KRN",8994,2615,2,4,1,0)
^^1^1^3041118^
"KRN",8994,2615,2,4,1,1,0)
Minimum number of fills to display:  (1-999999)
"KRN",8994,2615,2,5,0)
PTLIST^2
"KRN",8994,2615,2,5,1,0)
^^1^1^3041207^
"KRN",8994,2615,2,5,1,1,0)
ICN^ICN^ICN
"KRN",8994,2615,2,6,0)
TDATE^1
"KRN",8994,2615,2,6,1,0)
^^1^1^3041118^
"KRN",8994,2615,2,6,1,1,0)
Date to end collection.  mm/dd/yyyy.
"KRN",8994,2615,2,7,0)
HIUSERS^1
"KRN",8994,2615,2,7,1,0)
^8994.021^1^1^3070116^^^^
"KRN",8994,2615,2,7,1,1,0)
Number of highest users to identify:  (0-100)
"KRN",8994,2615,2,"B","COST",2)

"KRN",8994,2615,2,"B","FDATE",1)

"KRN",8994,2615,2,"B","HIUSERS",7)

"KRN",8994,2615,2,"B","MINCOST",3)

"KRN",8994,2615,2,"B","MINFILL",4)

"KRN",8994,2615,2,"B","PTLIST",5)

"KRN",8994,2615,2,"B","TDATE",6)

"KRN",8994,2615,3,0)
^^85^85^3070116^
"KRN",8994,2615,3,1,0)
RPC SPN PHARMACY UTL REPORT Results: 
"KRN",8994,2615,3,2,0)
IP address of test 10.4.229.202
"KRN",8994,2615,3,3,0)
 
"KRN",8994,2615,3,4,0)
Prameters 7
"KRN",8994,2615,3,5,0)
1) JAN 1 2004
"KRN",8994,2615,3,6,0)
2) JAN 15 2004
"KRN",8994,2615,3,7,0)
3) ACTUAL
"KRN",8994,2615,3,8,0)
4) 10
"KRN",8994,2615,3,9,0)
5) 2
"KRN",8994,2615,3,10,0)
6)1002651548^1002633845^1002632389^1002636280^1005409510^1002623561^
"KRN",8994,2615,3,11,0)
1002654116^1002625018^1002624576^1005547840^1002624513
"KRN",8994,2615,3,12,0)
7) 0
"KRN",8994,2615,3,13,0)
Note that changing the seventh parameter will include the highest users 
"KRN",8994,2615,3,14,0)
count.  
"KRN",8994,2615,3,15,0)
 
"KRN",8994,2615,3,16,0)
 
"KRN",8994,2615,3,17,0)
 
"KRN",8994,2615,3,18,0)
BOS999^EOL999
"KRN",8994,2615,3,19,0)
HDR999^Totals: 38 fills reported for 11 patients^EOL999
"KRN",8994,2615,3,20,0)
HDR999^These include 31 different drugs^EOL999
"KRN",8994,2615,3,21,0)
1^8^EOL999
"KRN",8994,2615,3,22,0)
1^6^EOL999
"KRN",8994,2615,3,23,0)
3^4^EOL999
"KRN",8994,2615,3,24,0)
2^3^EOL999
"KRN",8994,2615,3,25,0)
2^2^EOL999
"KRN",8994,2615,3,26,0)
2^1^EOL999
"KRN",8994,2615,3,27,0)
 
"KRN",8994,2615,3,28,0)
BOS999^EOL999
"KRN",8994,2615,3,29,0)
HDR999^Drugs with 2 or more fills^EOL999
"KRN",8994,2615,3,30,0)
OXYCODONE 5MG/ACETAMINOPHEN 325MG TAB^5^4^2(1)^EOL999
"KRN",8994,2615,3,31,0)
INTERFERON BETA-1A 30MCG/SYR (AVONEX)^3^2^2(1)^EOL999
"KRN",8994,2615,3,32,0)
COLON ELECTROLYTE LAVAGE PWD FOR SOLN^2^1^^EOL999
"KRN",8994,2615,3,33,0)
 
"KRN",8994,2615,3,34,0)
BOS999^EOL999
"KRN",8994,2615,3,35,0)
HDR999^Drugs with fills totaling $10.00 or more^EOL999
"KRN",8994,2615,3,36,0)
CLINDAMYCIN HCL 150MG CAP^31.44^1^80^1^EOL999
"KRN",8994,2615,3,37,0)
PERI-WASH 8 OZ^2451.84^1^960^1^EOL999
"KRN",8994,2615,3,38,0)
NUTRITION SUPL ENSURE/VANILLA PWD^21.6^1^7200^1^EOL999
"KRN",8994,2615,3,39,0)
CATHETER, FREEDOM MEDIUM^25.5^1^30^1^EOL999
"KRN",8994,2615,3,40,0)
MORPHINE 60MG SR TAB^15.12^1^60^1^EOL999
"KRN",8994,2615,3,41,0)
OXYCODONE 5MG/ACETAMINOPHEN 325MG TAB^11.1^5^300^4^EOL999
"KRN",8994,2615,3,42,0)
SERTRALINE HCL 100MG TAB^36.36^1^30^1^EOL999
"KRN",8994,2615,3,43,0)
FENTANYL 25MCG/H TRANSDERMAL PATCH^80.46^1^10^1^EOL999
"KRN",8994,2615,3,44,0)
GABAPENTIN 300MG CAP^53.73^1^90^1^EOL999
"KRN",8994,2615,3,45,0)
CALCIUM ALGINATE DRSNG 3 X 4 3/4 10'S^36.5^1^10^1^EOL999
"KRN",8994,2615,3,46,0)
LANSOPRAZOLE 30MG SA CAP^16.122^1^30^1^EOL999
"KRN",8994,2615,3,47,0)
INTERFERON BETA-1A 30MCG/SYR (AVONEX)^6268.56^3^12^2^EOL999
"KRN",8994,2615,3,48,0)
UNDERPAD,BED LARGE^21.555^1^150^1^EOL999
"KRN",8994,2615,3,49,0)
PRECISION Q-I-D GLUCOSE TEST STRIP^17.2^1^50^1^EOL999
"KRN",8994,2615,3,50,0)
DRESSING,RESTORE PLUS 6IN X 8IN H#9954^99.207^1^9^1^EOL999
"KRN",8994,2615,3,51,0)
QUETIAPINE FUMARATE 25MG TAB^93.3^1^150^1^EOL999
"KRN",8994,2615,3,52,0)
EPOETIN ALFA,RECOMB 20,000UNT/ML INJ^525.8^1^4^1^EOL999
"KRN",8994,2615,3,53,0)
 
"KRN",8994,2615,3,54,0)
BHDR999^TOTAL for listed drugs 9805.394^EOL999
"KRN",8994,2615,3,55,0)
BHDR999^TOTAL (including unlisted drugs) 9863.5756^EOL999
"KRN",8994,2615,3,56,0)
 
"KRN",8994,2615,3,57,0)
BOS999^EOL999
"KRN",8994,2615,3,58,0)
HDR999^Dollor Cost^EOL999
"KRN",8994,2615,3,59,0)
1^4,200-4,299^EOL999
"KRN",8994,2615,3,60,0)
1^2,400-2,499^EOL999
"KRN",8994,2615,3,61,0)
1^2,100-2,199^EOL999
"KRN",8994,2615,3,62,0)
1^500-599^EOL999
"KRN",8994,2615,3,63,0)
2^100-199^EOL999
"KRN",8994,2615,3,64,0)
5^0-99^EOL999
"KRN",8994,2615,3,65,0)
 
"KRN",8994,2615,3,66,0)
High user output if it's input:
"KRN",8994,2615,3,67,0)
 
"KRN",8994,2615,3,68,0)
HDR999^Highest Utilization Patients Based on Fills^EOL999
"KRN",8994,2615,3,69,0)
BHASXY,UXFHU U (O)^***********^8^6^4252.959^EOL999
"KRN",8994,2615,3,70,0)
TNAHU,CLJVRHADYH CRTSDYH (C)^***********^6^6^147.327^EOL999
"KRN",8994,2615,3,71,0)
OATHY,UDJELUI L (C)^***********^4^4^2139.775^EOL999
"KRN",8994,2615,3,72,0)
TXZADYTXY,LYIUHP A (H)^***********^4^4^33.89^EOL999
"KRN",8994,2615,3,73,0)
BXNBDY,PDAADLZ (O)^***********^4^3^43.5556^EOL999
"KRN",8994,2615,3,74,0)
TLUWAHN,JLUASXY Z^***********^3^3^2474.8^EOL999
"KRN",8994,2615,3,75,0)
BUXPY,AHUXN^***********^3^3^12.48^EOL999
"KRN",8994,2615,3,76,0)
DXIFH,JAHLQHT J (C)^***********^2^2^135.707^EOL999
"KRN",8994,2615,3,77,0)
AADF,YXUZLY P (C)^***********^2^2^81.16^EOL999
"KRN",8994,2615,3,78,0)
 
"KRN",8994,2615,3,79,0)
BOS999^EOL999
"KRN",8994,2615,3,80,0)
HDR999^Highest Utilization Patients Based on Cost^EOL999
"KRN",8994,2615,3,81,0)
BHASXY,UXFHU U (O)^***********^8^6^4252.959^EOL999
"KRN",8994,2615,3,82,0)
TLUWAHN,JLUASXY Z^***********^3^3^2474.8^EOL999
"KRN",8994,2615,3,83,0)
OATHY,UDJELUI L (C)^***********^4^4^2139.775^EOL999
"KRN",8994,2615,3,84,0)
FULYBADY,LAKHUS C (C)^***********^1^1^525.8^EOL999
"KRN",8994,2615,3,85,0)
TNAHU,CLJVRHADYH CRTSDYH (C)^***********^6^6^147.327^EOL999
"KRN",8994,2616,-1)
0^33
"KRN",8994,2616,0)
SPN LAB UTL SPECIFIC^RPC^SPNLRR7^4^A^^^^^^1
"KRN",8994,2616,2,0)
^8994.02A^5^5
"KRN",8994,2616,2,1,0)
FDATE^1
"KRN",8994,2616,2,1,1,0)
^^1^1^3041122^
"KRN",8994,2616,2,1,1,1,0)
DATE TO START REPORT
"KRN",8994,2616,2,2,0)
TDATE^1
"KRN",8994,2616,2,2,1,0)
^^1^1^3041122^
"KRN",8994,2616,2,2,1,1,0)
DATE TO END AT
"KRN",8994,2616,2,3,0)
HIUSERS^1
"KRN",8994,2616,2,3,1,0)
^8994.021^2^2^3050415^^
"KRN",8994,2616,2,3,1,1,0)
0 JUST LABS AND STATS
"KRN",8994,2616,2,3,1,2,0)
1 TO SEE PATIENT USAGE DATA
"KRN",8994,2616,2,4,0)
VALUES^2
"KRN",8994,2616,2,4,1,0)
^8994.021^4^4^3050414^^
"KRN",8994,2616,2,4,1,1,0)
EXAMPLE OF WHAT IS IN THE QLIST
"KRN",8994,2616,2,4,1,2,0)
        S QLIST(605143)="HGB"
"KRN",8994,2616,2,4,1,3,0)
        S QLIST(605144)="HCT"
"KRN",8994,2616,2,4,1,4,0)
        S QLIST(605682)="K (OR)"
"KRN",8994,2616,2,5,0)
PTLIST^2
"KRN",8994,2616,2,5,1,0)
^^5^5^3041207^
"KRN",8994,2616,2,5,1,1,0)
ICN^ICN^ICN^....
"KRN",8994,2616,2,5,1,2,0)
 
"KRN",8994,2616,2,5,1,3,0)
Example
"KRN",8994,2616,2,5,1,4,0)
                  
"KRN",8994,2616,2,5,1,5,0)
10073051^10052887^10147361^20638^8368^10005030^10017220
"KRN",8994,2616,2,"B","FDATE",1)

"KRN",8994,2616,2,"B","HIUSERS",3)

"KRN",8994,2616,2,"B","PTLIST",5)

"KRN",8994,2616,2,"B","TDATE",2)

"KRN",8994,2616,2,"B","VALUES",4)

"KRN",8994,2617,-1)
0^30
"KRN",8994,2617,0)
SPN LAB UTL REPORT^RPC^SPNLRK7^4^A^^^0^^^1
"KRN",8994,2617,2,0)
^8994.02A^5^5
"KRN",8994,2617,2,1,0)
FDATE^1
"KRN",8994,2617,2,1,1,0)
^8994.021^1^1^3050413^^
"KRN",8994,2617,2,1,1,1,0)
DATE TO START FROM
"KRN",8994,2617,2,2,0)
TDATE^1
"KRN",8994,2617,2,2,1,0)
^8994.021^1^1^3050413^^
"KRN",8994,2617,2,2,1,1,0)
DATE TO END AT
"KRN",8994,2617,2,3,0)
QLIST^1
"KRN",8994,2617,2,3,1,0)
^8994.021^1^1^3050413^^^
"KRN",8994,2617,2,3,1,1,0)
Minimum number of results reported for a test to be listed
"KRN",8994,2617,2,4,0)
HIUSERS^1
"KRN",8994,2617,2,4,1,0)
^8994.021^1^1^3050413^^
"KRN",8994,2617,2,4,1,1,0)
Number of highest users to identify
"KRN",8994,2617,2,5,0)
PTLIST^2
"KRN",8994,2617,2,5,1,0)
^8994.021^4^4^3050428^^^^
"KRN",8994,2617,2,5,1,1,0)
PATIENTS DFN IN LIST FORMAT
"KRN",8994,2617,2,5,1,2,0)
 
"KRN",8994,2617,2,5,1,3,0)
ICN^ICN^ICN^ICN^ICN...
"KRN",8994,2617,2,5,1,4,0)
.....
"KRN",8994,2617,2,"B","FDATE",1)

"KRN",8994,2617,2,"B","HIUSERS",4)

"KRN",8994,2617,2,"B","PTLIST",5)

"KRN",8994,2617,2,"B","QLIST",3)

"KRN",8994,2617,2,"B","TDATE",2)

"KRN",8994,2618,-1)
0^32
"KRN",8994,2618,0)
SPN RAD UTL REPORT^RPC^SPNLRM7^4^A^^^^^^1
"KRN",8994,2618,2,0)
^8994.02A^6^6
"KRN",8994,2618,2,1,0)
FDATE^1
"KRN",8994,2618,2,1,1,0)
^^1^1^3041201^
"KRN",8994,2618,2,1,1,1,0)
DATE TO START COLLECTING DATA FROM
"KRN",8994,2618,2,2,0)
TDATE^1
"KRN",8994,2618,2,2,1,0)
^^1^1^3041201^
"KRN",8994,2618,2,2,1,1,0)
DATE TO COLLECT DATA UP TO
"KRN",8994,2618,2,3,0)
MINPROC^1
"KRN",8994,2618,2,3,1,0)
^8994.021^1^1^3050415^^^
"KRN",8994,2618,2,3,1,1,0)
Minimum number of procedures to display:  (1-99999)
"KRN",8994,2618,2,4,0)
MINCOST^1
"KRN",8994,2618,2,4,1,0)
^8994.021^1^1^3050415^^
"KRN",8994,2618,2,4,1,1,0)
Minimum dollar cost of procedures to display:  (0-999)
"KRN",8994,2618,2,5,0)
HIUSERS^1
"KRN",8994,2618,2,5,1,0)
^^1^1^3041201^
"KRN",8994,2618,2,5,1,1,0)
Number of highest users to identify:  (0-100)
"KRN",8994,2618,2,6,0)
PTLIST^2
"KRN",8994,2618,2,6,1,0)
^^4^4^3041201^
"KRN",8994,2618,2,6,1,1,0)
DFN^DFN^DFN
"KRN",8994,2618,2,6,1,2,0)
 
"KRN",8994,2618,2,6,1,3,0)
 
"KRN",8994,2618,2,6,1,4,0)
354^1368^1514^1862^2171^2254^2389^2401^2459^2726^2800^3504^3726^3793^4072
"KRN",8994,2618,2,"B","FDATE",1)

"KRN",8994,2618,2,"B","HIUSERS",5)

"KRN",8994,2618,2,"B","MINCOST",4)

"KRN",8994,2618,2,"B","MINPROC",3)

"KRN",8994,2618,2,"B","PTLIST",6)

"KRN",8994,2618,2,"B","TDATE",2)

"KRN",8994,2619,-1)
0^3
"KRN",8994,2619,0)
SPN GET LAST SEEN^COL^SPNJRPC1^4^A^0^^^^^1
"KRN",8994,2619,1,0)
^^2^2^3060824^
"KRN",8994,2619,1,1,0)
This RPC returns list of patients with the date that they were last seen 
"KRN",8994,2619,1,2,0)
at a clinic.
"KRN",8994,2619,2,0)
^8994.02A^3^2
"KRN",8994,2619,2,1,0)
ICNLST^2
"KRN",8994,2619,2,1,1,0)
^^2^2^3060824^
"KRN",8994,2619,2,1,1,1,0)
An array list of Integration Control Numbers of patients in the PATIENT 
"KRN",8994,2619,2,1,1,2,0)
file (#2).  Format: ICNLST(1)=1001000001, ICNLST(2)=1001000002, etc.
"KRN",8994,2619,2,3,0)
DAYS^1
"KRN",8994,2619,2,3,1,0)
^^1^1^3060824^
"KRN",8994,2619,2,3,1,1,0)
The number of days back from current date to begin search from.
"KRN",8994,2619,2,"B","DAYS",3)

"KRN",8994,2619,2,"B","ICNLST",1)

"KRN",8994,2619,3,0)
^^11^11^3060824^
"KRN",8994,2619,3,1,0)
 
"KRN",8994,2619,3,2,0)
Return format:
"KRN",8994,2619,3,3,0)
 
"KRN",8994,2619,3,4,0)
 Date last seen ^ Patient name ^ Last four digits of SSN ^ End of Line 
"KRN",8994,2619,3,5,0)
 
"KRN",8994,2619,3,6,0)
Sample of Return:
"KRN",8994,2619,3,7,0)
 
"KRN",8994,2619,3,8,0)
05/15/2003^SPINALCORD,ONE^0001^EOL999
"KRN",8994,2619,3,9,0)
06/26/2003^SPINALCORD,TWO^0002^EOL999
"KRN",8994,2619,3,10,0)
04/09/2003^SPINALCORD,THREE^0003^EOL999
"KRN",8994,2619,3,11,0)
03/20/2003^SPINALCORD,FOUR^0004^EOL999
"KRN",8994,2620,-1)
0^72
"KRN",8994,2620,0)
SPN INFLUENZA RPT^COL^SPNRPCW^4^A^0^^^^^1
"KRN",8994,2620,2,0)
^8994.02A^3^3
"KRN",8994,2620,2,1,0)
ICN^1
"KRN",8994,2620,2,2,0)
SDATE^1
"KRN",8994,2620,2,3,0)
EDATE^1
"KRN",8994,2620,2,"B","EDATE",3)

"KRN",8994,2620,2,"B","ICN",1)

"KRN",8994,2620,2,"B","SDATE",2)

"KRN",8994,2621,-1)
0^18
"KRN",8994,2621,0)
SPN ICDS/CPTS & DESCRIPTIONS^COL^SPNJRPCX^4^A^0^^1^^^1
"KRN",8994,2621,1,0)
^^2^2^3060824^
"KRN",8994,2621,1,1,0)
Returns ICD/CPT Codes and Descriptions for a given patient based on the 
"KRN",8994,2621,1,2,0)
ICN and a cutoff date. 
"KRN",8994,2621,2,0)
^8994.02A^2^2
"KRN",8994,2621,2,1,0)
ICN^1
"KRN",8994,2621,2,1,1,0)
^^1^1^3060824^
"KRN",8994,2621,2,1,1,1,0)
Individual Patient's ICN 
"KRN",8994,2621,2,2,0)
SPNCUTDT^1
"KRN",8994,2621,2,2,1,0)
^^1^1^3060824^
"KRN",8994,2621,2,2,1,1,0)
Date to start search from.  
"KRN",8994,2621,2,"B","ICN",1)

"KRN",8994,2621,2,"B","SPNCUTDT",2)

"KRN",8994,2621,3,0)
^^27^27^3060824^
"KRN",8994,2621,3,1,0)
 
"KRN",8994,2621,3,2,0)
Return format:
"KRN",8994,2621,3,3,0)
 
"KRN",8994,2621,3,4,0)
CPTBREAK^EOL999
"KRN",8994,2621,3,5,0)
 
"KRN",8994,2621,3,6,0)
CPT detail level: CPT Description ^ CPT Code ^ Date CPT was entered ^ CPT 
"KRN",8994,2621,3,7,0)
long description ^ end of line marker
"KRN",8994,2621,3,8,0)
 
"KRN",8994,2621,3,9,0)
ICDBREAK^EOL999
"KRN",8994,2621,3,10,0)
 
"KRN",8994,2621,3,11,0)
ICD Detail level: ICD Description ^ ICD Code ^ Date ICD was entered ^ ICD 
"KRN",8994,2621,3,12,0)
Long description ^ end of line marker
"KRN",8994,2621,3,13,0)
 
"KRN",8994,2621,3,14,0)
 
"KRN",8994,2621,3,15,0)
Sample of return: 
"KRN",8994,2621,3,16,0)
 
"KRN",8994,2621,3,17,0)
CPTBREAK^EOL999
"KRN",8994,2621,3,18,0)
OFFICE/OUTPATIENT VISIT, EST^99212^AUG 10, 2004@14:20^ OFFICE OR OTHER 
"KRN",8994,2621,3,19,0)
OUTPATIENT VISIT FOR THE EVALUATION AND MANAGEMENT OF AN ESTABLISHED 
"KRN",8994,2621,3,20,0)
PATIENT, WHICH REQUIRES AT LEAST TWO OF THESE THREE KEY COMPONENTS: A 
"KRN",8994,2621,3,21,0)
PROBLEM FOCUSED HISTORY; A PROBLEM FOCUSED EXAMINATION; STRAIGHTFORWARD 
"KRN",8994,2621,3,22,0)
MEDICAL DECISION MAKING. COUNSELING AND/OR COORDINATION OF CARE WITH 
"KRN",8994,2621,3,23,0)
OTHER PROVIDERS OR AGENCIES ARE PROVIDED CONSISTENT WITH THE NATURE OF 
"KRN",8994,2621,3,24,0)
THE PROBLEM(S) AND THE PATIENT'S AND/OR FAMILY'S NEEDS. USUALLY, THE 
"KRN",8994,2621,3,25,0)
PRESENTING PROBLEM(S) ARE SELF LIMITED OR MINOR. PHYSICIANS TYPICALLY 
"KRN",8994,2621,3,26,0)
SPEND 10 MINUTES FACE-TO-FACE WITH THE PATIENT AND/OR FAMILY.^EOL999 
"KRN",8994,2621,3,27,0)
ICDBREAK^EOL999
"KRN",8994,2622,-1)
0^4
"KRN",8994,2622,0)
SPN GET FUTURE APPTS^COL^SPNJRPC2^4^A^0^^^^^1
"KRN",8994,2622,1,0)
^8994.01^3^3^3060824^^^
"KRN",8994,2622,1,1,0)
Returns a listing of patients with appointment information
"KRN",8994,2622,1,2,0)
if they are scheduled for an appointment during the 
"KRN",8994,2622,1,3,0)
requested date range.
"KRN",8994,2622,2,0)
^8994.02A^4^4
"KRN",8994,2622,2,1,0)
ICNLST^2
"KRN",8994,2622,2,1,1,0)
^^2^2^3060824^
"KRN",8994,2622,2,1,1,1,0)
A list of Integration Control Numbers of patients in the PATIENT file (#2)
"KRN",8994,2622,2,1,1,2,0)
in the following format: (ICN^ICN^ICN^ICN^ICN...)
"KRN",8994,2622,2,2,0)
SPNSEL^1
"KRN",8994,2622,2,2,1,0)
^^4^4^3060824^
"KRN",8994,2622,2,2,1,1,0)
Specifies which patients to search through:
"KRN",8994,2622,2,2,1,2,0)
                1 - Patients from SCI registry only (ICNLST)
"KRN",8994,2622,2,2,1,3,0)
                2 - VistA patients with SCD indicator only
"KRN",8994,2622,2,2,1,4,0)
                3 - Both 1 & 2
"KRN",8994,2622,2,3,0)
SPNSTRT^1
"KRN",8994,2622,2,3,1,0)
^^1^1^3060824^
"KRN",8994,2622,2,3,1,1,0)
Starting date range.
"KRN",8994,2622,2,4,0)
SPNEND^1
"KRN",8994,2622,2,4,1,0)
^8994.021^1^1^3060824^^^
"KRN",8994,2622,2,4,1,1,0)
Ending date range.
"KRN",8994,2622,2,"B","ICNLST",1)

"KRN",8994,2622,2,"B","SPNEND",4)

"KRN",8994,2622,2,"B","SPNSEL",2)

"KRN",8994,2622,2,"B","SPNSTRT",3)

"KRN",8994,2622,3,0)
^^17^17^3060824^
"KRN",8994,2622,3,1,0)
Return Format:
"KRN",8994,2622,3,2,0)
 
"KRN",8994,2622,3,3,0)
Appointment date ^ Appointment time ^ Clinic name ^ Patient Name ^
"KRN",8994,2622,3,4,0)
Last four digits of SSN ^ Patient's ICN ^ End of Line
"KRN",8994,2622,3,5,0)
 
"KRN",8994,2622,3,6,0)
 
"KRN",8994,2622,3,7,0)
 
"KRN",8994,2622,3,8,0)
Sample of return:
"KRN",8994,2622,3,9,0)
 
"KRN",8994,2622,3,10,0)
JAN 12,2005^09:00^BURROWS REMINDER 
"KRN",8994,2622,3,11,0)
LETTER^SPINALCORD,NINE^0009^1001393031^EOL999
"KRN",8994,2622,3,12,0)
JAN 12,2005^10:00^GRUBBS REMINDER LETTER 
"KRN",8994,2622,3,13,0)
(DIAB)^SPINALCORD,FOURTEEN^0014^1002005177^EOL999
"KRN",8994,2622,3,14,0)
FEB 1,2005^10:00^HOME OXYGEN 
"KRN",8994,2622,3,15,0)
INIT/RECERT^SPINALCORD,FIFTEEN^0115^4420019543^EOL999
"KRN",8994,2622,3,16,0)
FEB 17,2005^10:30^PCT KEVIN^SPINALCORD,FOURTEEN^0014^1002005177^EOL999
"KRN",8994,2622,3,17,0)
MAR 2,2005^13:15^MCPEAK UROLOGY^SPINALCORD,FOURTEEN^0014^1002005177^EOL999
"KRN",8994,2623,-1)
0^37
"KRN",8994,2623,0)
SPN NUTRITION PRECAUTIONS^RPC^SPNRPC03^4^A^^^^^^1
"KRN",8994,2623,2,0)
^8994.02A^3^3
"KRN",8994,2623,2,1,0)
SDATE^1
"KRN",8994,2623,2,2,0)
EDATE^1
"KRN",8994,2623,2,3,0)
ICN^1
"KRN",8994,2623,2,"B","EDATE",2)

"KRN",8994,2623,2,"B","ICN",3)

"KRN",8994,2623,2,"B","SDATE",1)

"KRN",8994,2624,-1)
0^51
"KRN",8994,2624,0)
SPN LAB SPUTUM^COL^SPNRPCA1^4^A^^^^^^1
"KRN",8994,2624,2,0)
^8994.02A^3^3
"KRN",8994,2624,2,1,0)
ICN^1
"KRN",8994,2624,2,2,0)
SDATE^1
"KRN",8994,2624,2,3,0)
EDATE^1
"KRN",8994,2624,2,"B","EDATE",3)

"KRN",8994,2624,2,"B","ICN",1)

"KRN",8994,2624,2,"B","SDATE",2)

"KRN",8994,2625,-1)
0^5
"KRN",8994,2625,0)
SPN INPAT OUTPAT ACTIVITY^COL^SPNJRPC3^4^A^0^^^^^1
"KRN",8994,2625,1,0)
^^3^3^3060824^
"KRN",8994,2625,1,1,0)
Returns inpatient/outpatient activity statistics for a list of given 
"KRN",8994,2625,1,2,0)
patients (based on the ICN) based on a date range, minimum number of 
"KRN",8994,2625,1,3,0)
results, and number of highest patients to identify. 
"KRN",8994,2625,2,0)
^8994.02A^4^4
"KRN",8994,2625,2,1,0)
ICNLST^2
"KRN",8994,2625,2,1,1,0)
^^1^1^3060824^
"KRN",8994,2625,2,1,1,1,0)
Patient's ICN in string format (ICN^ICN^ICN^ICN ) 
"KRN",8994,2625,2,2,0)
FDATE^1
"KRN",8994,2625,2,2,1,0)
^^1^1^3060824^
"KRN",8994,2625,2,2,1,1,0)
Date to start search from.  
"KRN",8994,2625,2,3,0)
TDATE^1
"KRN",8994,2625,2,3,1,0)
^^1^1^3060824^
"KRN",8994,2625,2,3,1,1,0)
Date to end search at.  
"KRN",8994,2625,2,4,0)
HIUSERS^1
"KRN",8994,2625,2,4,1,0)
^^1^1^3060824^
"KRN",8994,2625,2,4,1,1,0)
Number of patients with highest amount of orders to identify. 
"KRN",8994,2625,2,"B","FDATE",2)

"KRN",8994,2625,2,"B","HIUSERS",4)

"KRN",8994,2625,2,"B","ICNLST",1)

"KRN",8994,2625,2,"B","TDATE",3)

"KRN",8994,2625,3,0)
^^37^37^3060824^
"KRN",8994,2625,3,1,0)
 
"KRN",8994,2625,3,2,0)
Returns data that displays in the SPN Inpatient Outpatient Activity 
"KRN",8994,2625,3,3,0)
report.
"KRN",8994,2625,3,4,0)
 
"KRN",8994,2625,3,5,0)
Sample of return:
"KRN",8994,2625,3,6,0)
 
"KRN",8994,2625,3,7,0)
PAT999^Outpatient Activity^EOL999
"KRN",8994,2625,3,8,0)
BOS999^Totals: 1 patient for 5 visits (5 stops)^EOL999
"KRN",8994,2625,3,9,0)
HDR999^Patients^Visits^EOL999
"KRN",8994,2625,3,10,0)
1^5^EOL999
"KRN",8994,2625,3,11,0)
HDR999^Clinic^Patients^Visits^Stops^EOL999
"KRN",8994,2625,3,12,0)
180^DENTAL^1^5.00^5^EOL999
"KRN",8994,2625,3,13,0)
 
"KRN",8994,2625,3,14,0)
BOS999^Highest Utilization of Visits^EOL999
"KRN",8994,2625,3,15,0)
HDR999^Patient Name^SSN^Visit^Different Stop Codes^EOL999
"KRN",8994,2625,3,16,0)
SPINALCORD,ONE^000-00-1001^5^1^EOL999
"KRN",8994,2625,3,17,0)
 
"KRN",8994,2625,3,18,0)
PAT999^Inpatient Activity^EOL999
"KRN",8994,2625,3,19,0)
BOS999^Totals: 2 patients for 3 stays and 225 days inpatient care^EOL999
"KRN",8994,2625,3,20,0)
HDR999^Patients^Stays^EOL999
"KRN",8994,2625,3,21,0)
1^1^EOL999
"KRN",8994,2625,3,22,0)
1^2^EOL999
"KRN",8994,2625,3,23,0)
 
"KRN",8994,2625,3,24,0)
BOS999^Median Length of Stay (MLOS): 108.0 days^EOL999
"KRN",8994,2625,3,25,0)
HDR999^Specialty^Patients^Stays^Days^MLOS^EOL999
"KRN",8994,2625,3,26,0)
GENERAL(ACUTE MEDICINE)^ 1^1^2^2.0^EOL999
"KRN",8994,2625,3,27,0)
NHCU^2^2^223^111.5^EOL999
"KRN",8994,2625,3,28,0)
 
"KRN",8994,2625,3,29,0)
BOS999^Highest Number of Stays^EOL999
"KRN",8994,2625,3,30,0)
HDR999^Patient Name^SSN^Stays^Days^EOL999
"KRN",8994,2625,3,31,0)
SPINALCORD,TWO^000-00-1002^2^117^EOL999
"KRN",8994,2625,3,32,0)
SPINALCORD,THREE^000-00-1003^1^108^EOL999
"KRN",8994,2625,3,33,0)
 
"KRN",8994,2625,3,34,0)
BOS999^Highest Number of Days^EOL999
"KRN",8994,2625,3,35,0)
HDR999^Patient Name^SSN^Days^Stays^EOL999
"KRN",8994,2625,3,36,0)
SPINALCORD,TWO^000-00-1002^117^2^EOL999
"KRN",8994,2625,3,37,0)
SPINALCORD,THREE^000-00-1003^108^1^EOL999
"KRN",8994,2626,-1)
0^6
"KRN",8994,2626,0)
SPN INPAT OUTPAT SPECIFIC^COL^SPNJRPC4^4^A^0^^^^^1
"KRN",8994,2626,1,0)
^^6^6^3060824^
"KRN",8994,2626,1,1,0)
Returns inpatient/outpatient activity information for a list of given 
"KRN",8994,2626,1,2,0)
patients (based on the ICN) based on a date range, minimum number of 
"KRN",8994,2626,1,3,0)
results, a list of Clinic names/numbers and Specialty names.  There are 
"KRN",8994,2626,1,4,0)
two types of returns for this RPC depending on the HIUSERS parameter that 
"KRN",8994,2626,1,5,0)
is passed, a '0' will return clinic & specialty stats only and a '1' will 
"KRN",8994,2626,1,6,0)
return patient usage data as well. 
"KRN",8994,2626,2,0)
^8994.02A^6^6
"KRN",8994,2626,2,1,0)
ICNLST^2
"KRN",8994,2626,2,1,1,0)
^^1^1^3060824^
"KRN",8994,2626,2,1,1,1,0)
Patient's ICN in string format (ICN^ICN^ICN^ICN) 
"KRN",8994,2626,2,2,0)
FDATE^1
"KRN",8994,2626,2,2,1,0)
^^1^1^3060824^
"KRN",8994,2626,2,2,1,1,0)
Date to start search from.  
"KRN",8994,2626,2,3,0)
TDATE^1
"KRN",8994,2626,2,3,1,0)
^^1^1^3060824^
"KRN",8994,2626,2,3,1,1,0)
Date to end search at.  
"KRN",8994,2626,2,4,0)
CLINSTP^2
"KRN",8994,2626,2,4,1,0)
^^1^1^3060824^
"KRN",8994,2626,2,4,1,1,0)
List of Clinic Stops to search for.
"KRN",8994,2626,2,5,0)
SPECLTY^2
"KRN",8994,2626,2,5,1,0)
^^1^1^3060824^
"KRN",8994,2626,2,5,1,1,0)
Type of Specialties to search for. 
"KRN",8994,2626,2,6,0)
HIUSERS^1
"KRN",8994,2626,2,6,1,0)
^^2^2^3060824^
"KRN",8994,2626,2,6,1,1,0)
Type of data to return: 0 - clinic & specialty stats, 1 - patient usage 
"KRN",8994,2626,2,6,1,2,0)
data. 
"KRN",8994,2626,2,"B","CLINSTP",4)

"KRN",8994,2626,2,"B","FDATE",2)

"KRN",8994,2626,2,"B","HIUSERS",6)

"KRN",8994,2626,2,"B","ICNLST",1)

"KRN",8994,2626,2,"B","SPECLTY",5)

"KRN",8994,2626,2,"B","TDATE",3)

"KRN",8994,2626,3,0)
^^19^19^3060824^
"KRN",8994,2626,3,1,0)
 
"KRN",8994,2626,3,2,0)
Returns data that displays in the SPN Inpatient Outpatient Specific 
"KRN",8994,2626,3,3,0)
report.
"KRN",8994,2626,3,4,0)
 
"KRN",8994,2626,3,5,0)
 
"KRN",8994,2626,3,6,0)
Sample of return:
"KRN",8994,2626,3,7,0)
 
"KRN",8994,2626,3,8,0)
PAT999^Selected Outpatient Activity^EOL999
"KRN",8994,2626,3,9,0)
BOS999^105. X-RAY^EOL999
"KRN",8994,2626,3,10,0)
HDR999^Patient Name^SSN^Visits^Stops^EOL999
"KRN",8994,2626,3,11,0)
TOT999^Totals: 3 patients^1.00^3^EOL999
"KRN",8994,2626,3,12,0)
SPINALCORD,ONE^000-00-1001^0.33^1^EOL999
"KRN",8994,2626,3,13,0)
SPINALCORD,TWO^000-00-1002^0.33^1^EOL999
"KRN",8994,2626,3,14,0)
SPINALCORD,THREE^000-00-1003^0.33^1^EOL999
"KRN",8994,2626,3,15,0)
PAT999^Selected Inpatient Activity^EOL999
"KRN",8994,2626,3,16,0)
BOS999^GENERAL(ACUTE MEDICINE)^EOL999
"KRN",8994,2626,3,17,0)
HDR999^Patient Name^SSN^Stay^Days^EOL999
"KRN",8994,2626,3,18,0)
TOT999^Totals: 1 patient^1^3^EOL999
"KRN",8994,2626,3,19,0)
SPINALCORD,TWO^000-00-1002^1^3^EOL999
"KRN",8994,2627,-1)
0^7
"KRN",8994,2627,0)
SPN PAT BREAKDOWN^COL^SPNJRPC5^4^A^0^^^^^1
"KRN",8994,2627,1,0)
^8994.01^2^2^3060824^^
"KRN",8994,2627,1,1,0)
Returns breakdown of patient statistics for a list of given patients 
"KRN",8994,2627,1,2,0)
(based on the ICN) based on a date range, if provided.
"KRN",8994,2627,2,0)
^8994.02A^3^3
"KRN",8994,2627,2,1,0)
ICNLIST^2
"KRN",8994,2627,2,1,1,0)
^^1^1^3060824^
"KRN",8994,2627,2,1,1,1,0)
Patient's ICN in string format (ICN^ICN^ICN^ICN) 
"KRN",8994,2627,2,2,0)
FDATE^1
"KRN",8994,2627,2,2,1,0)
^^1^1^3060824^
"KRN",8994,2627,2,2,1,1,0)
(Optional) Date to start search from.  
"KRN",8994,2627,2,3,0)
TDATE^1
"KRN",8994,2627,2,3,1,0)
^8994.021^1^1^3060824^^
"KRN",8994,2627,2,3,1,1,0)
(Optional) Date to end search at.  
"KRN",8994,2627,2,"B","FDATE",2)

"KRN",8994,2627,2,"B","ICNLIST",1)

"KRN",8994,2627,2,"B","TDATE",3)

"KRN",8994,2627,3,0)
^^41^41^3060824^
"KRN",8994,2627,3,1,0)
 
"KRN",8994,2627,3,2,0)
Returns data that displays in the SPN Patient Breakdown report.
"KRN",8994,2627,3,3,0)
 
"KRN",8994,2627,3,4,0)
 
"KRN",8994,2627,3,5,0)
Sample of return:
"KRN",8994,2627,3,6,0)
 
"KRN",8994,2627,3,7,0)
HDR999^CATEGORY^FEMALE^MALE^UNKNOWN^TOTAL^EOL999
"KRN",8994,2627,3,8,0)
BOS999^TOTALS^EOL999
"KRN",8994,2627,3,9,0)
Living (or Unknown)^2^16^^18^EOL999
"KRN",8994,2627,3,10,0)
Deceased (Date of Death in Patient file)^^4^^4^EOL999
"KRN",8994,2627,3,11,0)
BOS999^AGE^EOL999
"KRN",8994,2627,3,12,0)
39 years^1^^^1^EOL999
"KRN",8994,2627,3,13,0)
49 years^^1^^1^EOL999
"KRN",8994,2627,3,14,0)
54 years^1^2^^3^EOL999
"KRN",8994,2627,3,15,0)
59 years^^5^^5^EOL999
"KRN",8994,2627,3,16,0)
64 years^^1^^1^EOL999
"KRN",8994,2627,3,17,0)
69 years^^4^^4^EOL999
"KRN",8994,2627,3,18,0)
74 years^^4^^4^EOL999
"KRN",8994,2627,3,19,0)
79 years^^2^^2^EOL999
"KRN",8994,2627,3,20,0)
84 years^^1^^1^EOL999
"KRN",8994,2627,3,21,0)
BOS999^RACE^EOL999
"KRN",8994,2627,3,22,0)
UNSPECIFIED RACE^2^15^^17^EOL999
"KRN",8994,2627,3,23,0)
WHITE^^5^^5^EOL999
"KRN",8994,2627,3,24,0)
BOS999^MEANS TEST^EOL999
"KRN",8994,2627,3,25,0)
Means Test MT COPAY EXEMPT^1^5^^6^EOL999
"KRN",8994,2627,3,26,0)
Means Test NO LONGER REQUIRED^^6^^6^EOL999
"KRN",8994,2627,3,27,0)
Means Test NOT REQUIRED^1^9^^10^EOL999
"KRN",8994,2627,3,28,0)
BOS999^ELIGIBILITY^EOL999
"KRN",8994,2627,3,29,0)
AID & ATTENDANCE^^2^^2^EOL999
"KRN",8994,2627,3,30,0)
NSC^1^5^^6^EOL999
"KRN",8994,2627,3,31,0)
NSC, VA PENSION^^1^^1^EOL999
"KRN",8994,2627,3,32,0)
SC LESS THAN 50%^^1^^1^EOL999
"KRN",8994,2627,3,33,0)
SERVICE CONNECTED 50% to 100%^1^11^^12^EOL999
"KRN",8994,2627,3,34,0)
BOS999^PLACE OF SERVICE^EOL999
"KRN",8994,2627,3,35,0)
KOREAN^^4^^4^EOL999
"KRN",8994,2627,3,36,0)
PERSIAN GULF WAR^1^1^^2^EOL999
"KRN",8994,2627,3,37,0)
POST-KOREAN^^4^^4^EOL999
"KRN",8994,2627,3,38,0)
POST- VIETNAM^^1^^1^EOL999
"KRN",8994,2627,3,39,0)
VIETNAM ERA^1^9^^10^EOL999
"KRN",8994,2627,3,40,0)
WORLD WAR II^^1^^1^EOL999
"KRN",8994,2627,3,41,0)
BOS999^SEEN^EOL999
"KRN",8994,2628,-1)
0^8
"KRN",8994,2628,0)
SPN CURRENT INPATS^COL^SPNJRPC6^4^A^0^^^^^1
"KRN",8994,2628,1,0)
^8994.01^1^1^3060824^^^^
"KRN",8994,2628,1,1,0)
Returns Current Inpatient report data.
"KRN",8994,2628,2,0)
^8994.02A^1^1
"KRN",8994,2628,2,1,0)
ICNLIST^2
"KRN",8994,2628,2,1,1,0)
^8994.021^1^1^3060824^^^^
"KRN",8994,2628,2,1,1,1,0)
Patient's ICNs in list format (ICN^ICN^ICN^ICN^ICN...)
"KRN",8994,2628,2,"B","ICNLIST",1)

"KRN",8994,2628,3,0)
^^21^21^3060824^
"KRN",8994,2628,3,1,0)
 
"KRN",8994,2628,3,2,0)
Return format:
"KRN",8994,2628,3,3,0)
 
"KRN",8994,2628,3,4,0)
TOT999 level: "TOT999" ^ total # of inpatients ^ "EOL999"
"KRN",8994,2628,3,5,0)
 
"KRN",8994,2628,3,6,0)
HDR999 level: "HDR999" ^ "NAME" ^ "LAST FOUR" ^ "WARD" ^ "ADMISSION DATE" 
"KRN",8994,2628,3,7,0)
^ "CURR LOS" ^ "FYTD LOS" ^ "ADM DX" ^ "ROOM-BED" ^ "EOL999"
"KRN",8994,2628,3,8,0)
 
"KRN",8994,2628,3,9,0)
Detail level: Patient name ^ Last four digits of SSN ^ Ward type ^ Date 
"KRN",8994,2628,3,10,0)
of Admission ^ Current Length of stay ^ Fiscal YTD Length of stay ^ 
"KRN",8994,2628,3,11,0)
Admitting Diagnosis ^ Room/Bed # ^ "EOL999"
"KRN",8994,2628,3,12,0)
 
"KRN",8994,2628,3,13,0)
 
"KRN",8994,2628,3,14,0)
Sample of return:
"KRN",8994,2628,3,15,0)
 
"KRN",8994,2628,3,16,0)
 
"KRN",8994,2628,3,17,0)
TOT999^Total Inpatients: 2^EOL999
"KRN",8994,2628,3,18,0)
HDR999^NAME^LAST FOUR^WARD^ADMISSION DATE^CURR LOS^FYTD LOS^ADM 
"KRN",8994,2628,3,19,0)
DX^ROOM-BED^EOL999
"KRN",8994,2628,3,20,0)
GDATXY,ELUUN I^9999^ECU^06/20/01^1,429^230^pneumonia and MS^188- 2^EOL999
"KRN",8994,2628,3,21,0)
BALYI,UXKHUS^9999^TRANSITIONAL^09/01/04^260^230^CAUDA EQUINA^146-2^EOL999
"KRN",8994,2629,-1)
0^9
"KRN",8994,2629,0)
SPN GET SPEC CODES^COL^SPNJRPC7^4^A^0^^^^^1
"KRN",8994,2629,1,0)
^^1^1^3060824^
"KRN",8994,2629,1,1,0)
Returns full list of Specialty PTF codes.
"KRN",8994,2629,2,0)
^8994.02A^1^1
"KRN",8994,2629,2,1,0)
SPEC^1
"KRN",8994,2629,2,1,1,0)
^^1^1^3060824^
"KRN",8994,2629,2,1,1,1,0)
(not used)
"KRN",8994,2629,2,"B","SPEC",1)

"KRN",8994,2629,3,0)
^^10^10^3060824^
"KRN",8994,2629,3,1,0)
 
"KRN",8994,2629,3,2,0)
Sample of return:
"KRN",8994,2629,3,3,0)
 
"KRN",8994,2629,3,4,0)
ACUTE PSYCHIATRY (<45 DAYS)^EOL999
"KRN",8994,2629,3,5,0)
ALCOHOL DEPENDENCE TRMT UNIT^EOL999
"KRN",8994,2629,3,6,0)
ALLERGY^EOL999
"KRN",8994,2629,3,7,0)
BLIND REHAB^EOL999
"KRN",8994,2629,3,8,0)
BLIND REHAB OBSERVATION^EOL999
"KRN",8994,2629,3,9,0)
CARDIAC-STEP DOWN UNIT^EOL999
"KRN",8994,2629,3,10,0)
CARDIOLOGY^EOL999DERMATOLOGY^EOL999
"KRN",8994,2630,-1)
0^10
"KRN",8994,2630,0)
SPN GET MAILING ADDRESS^COL^SPNJRPC8^4^A^0^^^^^1
"KRN",8994,2630,1,0)
^8994.01^2^2^3060824^^^
"KRN",8994,2630,1,1,0)
Returns current mailing addresses for a list of given patients (based on 
"KRN",8994,2630,1,2,0)
the ICN).
"KRN",8994,2630,2,0)
^8994.02A^1^1
"KRN",8994,2630,2,1,0)
ICNLIST^2
"KRN",8994,2630,2,1,1,0)
^8994.021^1^1^3060824^^^
"KRN",8994,2630,2,1,1,1,0)
Patient's ICNs in list format (ICN^ICN^ICN^ICN^ICN...)
"KRN",8994,2630,2,"B","ICNLIST",1)

"KRN",8994,2630,3,0)
^^16^16^3060824^
"KRN",8994,2630,3,1,0)
 
"KRN",8994,2630,3,2,0)
Return format:
"KRN",8994,2630,3,3,0)
 
"KRN",8994,2630,3,4,0)
Patient name ^ Street Address (first line) ^ Street Address (second line) 
"KRN",8994,2630,3,5,0)
^ Street Address (third line) ^ City ^ State ^ Zip Code ^ End of line 
"KRN",8994,2630,3,6,0)
marker
"KRN",8994,2630,3,7,0)
 
"KRN",8994,2630,3,8,0)
 
"KRN",8994,2630,3,9,0)
 
"KRN",8994,2630,3,10,0)
 
"KRN",8994,2630,3,11,0)
Sample of return: 
"KRN",8994,2630,3,12,0)
 
"KRN",8994,2630,3,13,0)
SPINALCORD,ONE^1001 S BLANK ST^^^EL TORRO^MAINE^12345^EOL999
"KRN",8994,2630,3,14,0)
SPINALCORD,TWO^1002 E BLANK ST^^^HOMBERG^VIRGINIA^12345^EOL999
"KRN",8994,2630,3,15,0)
SPINALCORD,THREE^1003 BLANK BLVD^^^LITTLETON^COLORADO^12345^EOL999
"KRN",8994,2630,3,16,0)
SPINALCORD,FOUR^1004 N BLANK^^^SEDGEBRUSH^NORTH DAKOTA^12345^EOL999
"KRN",8994,2631,-1)
0^11
"KRN",8994,2631,0)
SPN ICD9 CODE SEARCH^COL^SPNJRPC9^4^A^0^^^^^1
"KRN",8994,2631,1,0)
^^2^2^3060824^
"KRN",8994,2631,1,1,0)
Returns a patient's ICD9 Code history for a list of given patients (based 
"KRN",8994,2631,1,2,0)
on the ICN), date range, and a list of ICD codes desired to be searched.
"KRN",8994,2631,2,0)
^8994.02A^6^6
"KRN",8994,2631,2,1,0)
ICNLST^2
"KRN",8994,2631,2,1,1,0)
^^1^1^3060824^
"KRN",8994,2631,2,1,1,1,0)
Patient's ICNs in list format (ICN^ICN^ICN^ICN^ICN...)
"KRN",8994,2631,2,2,0)
FDATE^1
"KRN",8994,2631,2,2,1,0)
^^1^1^3060824^
"KRN",8994,2631,2,2,1,1,0)
The admission starting date
"KRN",8994,2631,2,3,0)
TDATE^1
"KRN",8994,2631,2,3,1,0)
^^1^1^3060824^
"KRN",8994,2631,2,3,1,1,0)
The Admission ending date
"KRN",8994,2631,2,4,0)
PATTYP^1
"KRN",8994,2631,2,4,1,0)
^^1^1^3060824^
"KRN",8994,2631,2,4,1,1,0)
(1) Patients in SCI Registry only (2) All Patients
"KRN",8994,2631,2,5,0)
SPNANS^1
"KRN",8994,2631,2,5,1,0)
^^1^1^3060824^
"KRN",8994,2631,2,5,1,1,0)
(1) Range of Codes (2) Individual codes
"KRN",8994,2631,2,6,0)
CODES^2
"KRN",8994,2631,2,6,1,0)
^^1^1^3060824^
"KRN",8994,2631,2,6,1,1,0)
The list or range of ICD codes
"KRN",8994,2631,2,"B","CODES",6)

"KRN",8994,2631,2,"B","FDATE",2)

"KRN",8994,2631,2,"B","ICNLST",1)

"KRN",8994,2631,2,"B","PATTYP",4)

"KRN",8994,2631,2,"B","SPNANS",5)

"KRN",8994,2631,2,"B","TDATE",3)

"KRN",8994,2631,3,0)
^^27^27^3060824^
"KRN",8994,2631,3,1,0)
 
"KRN",8994,2631,3,2,0)
Return format:
"KRN",8994,2631,3,3,0)
 
"KRN",8994,2631,3,4,0)
HDR999 level: descriptions for report headings
"KRN",8994,2631,3,5,0)
 
"KRN",8994,2631,3,6,0)
PAT1 level: "PAT1" ^ Patient Name ^ SSN ^ Registration status ^ Admission 
"KRN",8994,2631,3,7,0)
date/timestamp ^ end of line marker
"KRN",8994,2631,3,8,0)
 
"KRN",8994,2631,3,9,0)
ICD1 level: "ICD1" ^ DXLS ^ ICD2 ^ ICD3 ^ ICD4 ^ ICD5
"KRN",8994,2631,3,10,0)
 
"KRN",8994,2631,3,11,0)
ICD2 level: "ICD2" ^ ICD6 ^ ICD7 ^ ICD8 ^ ICD9 ^ ICD10
"KRN",8994,2631,3,12,0)
 
"KRN",8994,2631,3,13,0)
 
"KRN",8994,2631,3,14,0)
Sample of return:  
"KRN",8994,2631,3,15,0)
 
"KRN",8994,2631,3,16,0)
PAT1^SYNIHU,ZDJELHA I^000009008^**NOT IN REGISTRY**^JAN 12, 
"KRN",8994,2631,3,17,0)
2001@14:20:34^EOL999
"KRN",8994,2631,3,18,0)
ICD1^453.8^^^^^EOL999
"KRN",8994,2631,3,19,0)
ICD2^^^^^^EOL999
"KRN",8994,2631,3,20,0)
PAT1^CXJEULY,ZDJELHA PLNYH^000009009^**NOT IN REGISTRY**^JAN 10, 
"KRN",8994,2631,3,21,0)
2001@04:44:38^EOL999
"KRN",8994,2631,3,22,0)
ICD1^786.59^305.1^^^^EOL999
"KRN",8994,2631,3,23,0)
ICD2^^^^^^EOL999
"KRN",8994,2631,3,24,0)
PAT1^SSLJB,CXEY LAAHY^000009010^**NOT IN REGISTRY**^JAN 15, 
"KRN",8994,2631,3,25,0)
2001@15:10:26^EOL999
"KRN",8994,2631,3,26,0)
ICD1^414.01^413.9^250.00^V12.79^V44.2^EOL999
"KRN",8994,2631,3,27,0)
ICD2^793.2^^^^^EOL999
"KRN",8994,2632,-1)
0^2
"KRN",8994,2632,0)
SPN LIST ICDS/CPTS^COL^SPNJRPC0^4^A^0^^^^^1
"KRN",8994,2632,1,0)
^8994.01^1^1^3060824^
"KRN",8994,2632,1,1,0)
Returns full list of ICD or CPT codes and descriptions.
"KRN",8994,2632,2,0)
^8994.02A^1^1
"KRN",8994,2632,2,1,0)
TYPE^1
"KRN",8994,2632,2,1,1,0)
^8994.021^1^1^3060824^^
"KRN",8994,2632,2,1,1,1,0)
Type of code that is desired (CPT or ICD)
"KRN",8994,2632,2,"B","TYPE",1)

"KRN",8994,2632,3,0)
^8994.03^16^16^3060824^^
"KRN",8994,2632,3,1,0)
 
"KRN",8994,2632,3,2,0)
Return format:
"KRN",8994,2632,3,3,0)
 
"KRN",8994,2632,3,4,0)
ICD/CPT code ^ ICD/CPT description ^ end of line marker
"KRN",8994,2632,3,5,0)
 
"KRN",8994,2632,3,6,0)
 
"KRN",8994,2632,3,7,0)
Sample of return:
"KRN",8994,2632,3,8,0)
 
"KRN",8994,2632,3,9,0)
001.0 ^CHOLERA DUE TO VIBRIO CHOLERAE^EOL999
"KRN",8994,2632,3,10,0)
001.1 ^CHOLERA DUE TO VIBRIO CHOLERAE EL TOR^EOL999
"KRN",8994,2632,3,11,0)
001.9 ^CHOLERA, UNSPECIFIED^EOL999
"KRN",8994,2632,3,12,0)
002.0 ^TYPHOID FEVER^EOL999
"KRN",8994,2632,3,13,0)
002.1 ^PARATYPHOID FEVER A^EOL999
"KRN",8994,2632,3,14,0)
002.2 ^PARATYPHOID FEVER B^EOL999
"KRN",8994,2632,3,15,0)
002.3 ^PARATYPHOID FEVER C^EOL999
"KRN",8994,2632,3,16,0)
002.9 ^PARATYPHOID FEVER, UNSPECIFIED^EOL999
"KRN",8994,2633,-1)
0^41
"KRN",8994,2633,0)
SPN ADMISSIONS REPORT^EN1^SPNRPC13^4^A^0^^^^^1
"KRN",8994,2633,2,0)
^8994.02A^3^3
"KRN",8994,2633,2,1,0)
STDATE^1
"KRN",8994,2633,2,2,0)
ENDATE^1
"KRN",8994,2633,2,3,0)
PTLIST^2
"KRN",8994,2633,2,"B","ENDATE",2)

"KRN",8994,2633,2,"B","PTLIST",3)

"KRN",8994,2633,2,"B","STDATE",1)

"KRN",8994,2634,-1)
0^1
"KRN",8994,2634,0)
SPN GET CLINIC STOPS^COL^SPNJRP4A^4^A^0^^^^^1
"KRN",8994,2634,1,0)
^8994.01^1^1^3060824^^^
"KRN",8994,2634,1,1,0)
Returns list of all clinic stops.
"KRN",8994,2634,3,0)
^^14^14^3060824^
"KRN",8994,2634,3,1,0)
 
"KRN",8994,2634,3,2,0)
Return format:
"KRN",8994,2634,3,3,0)
 
"KRN",8994,2634,3,4,0)
Clinic name ^ AMIS reporting stop code ^ Active/Inactive status ^ end of 
"KRN",8994,2634,3,5,0)
line marker
"KRN",8994,2634,3,6,0)
 
"KRN",8994,2634,3,7,0)
 
"KRN",8994,2634,3,8,0)
Sample of return:
"KRN",8994,2634,3,9,0)
 
"KRN",8994,2634,3,10,0)
ACTIVE DUTY SEX TRAUMA^524^ACTIVE^EOL999
"KRN",8994,2634,3,11,0)
ACUTE HEMODIAL TREATMENT^601^INACTIVE^EOL999
"KRN",8994,2634,3,12,0)
ACUTE PERITONEAL DIAL TREAT^605^INACTIVE^EOL999
"KRN",8994,2634,3,13,0)
ADMIN PAT ACTIVTIES (MASNONCT)^674^ACTIVE^EOL999
"KRN",8994,2634,3,14,0)
ADMITTING/SCREENING^2^INACTIVE^EOL999
"KRN",8994,2635,-1)
0^14
"KRN",8994,2635,0)
SPN GET ENROLLMENT^COL^SPNJRPCE^2^A^0^^^^^1
"KRN",8994,2635,1,0)
^8994.01^1^1^3060824^^^
"KRN",8994,2635,1,1,0)
Returns most recent Eligibility Enrollment Application information.
"KRN",8994,2635,2,0)
^8994.02A^2^1
"KRN",8994,2635,2,2,0)
ICN^1
"KRN",8994,2635,2,2,1,0)
^8994.021^1^1^3060824^^^
"KRN",8994,2635,2,2,1,1,0)
Individual patient's ICN.
"KRN",8994,2635,2,"B","ICN",2)

"KRN",8994,2635,3,0)
^8994.03^11^11^3060824^^
"KRN",8994,2635,3,1,0)
 
"KRN",8994,2635,3,2,0)
Return format:
"KRN",8994,2635,3,3,0)
 
"KRN",8994,2635,3,4,0)
 Patient's most recent Enrollment Priority ^ Patient's enrollment 
"KRN",8994,2635,3,5,0)
subgroup ^ End of Line indicator
"KRN",8994,2635,3,6,0)
 
"KRN",8994,2635,3,7,0)
 
"KRN",8994,2635,3,8,0)
 
"KRN",8994,2635,3,9,0)
Sample of return:
"KRN",8994,2635,3,10,0)
 
"KRN",8994,2635,3,11,0)
GROUP 7^c^EOL999
"KRN",8994,2636,-1)
0^12
"KRN",8994,2636,0)
SPN GET SCI COORDINATORS^COL^SPNJRPCC^4^A^0^^^^^1
"KRN",8994,2636,1,0)
^^1^1^3060824^
"KRN",8994,2636,1,1,0)
Returns SCI Coordinator Providers from New Person file.
"KRN",8994,2636,2,0)
^8994.02A^1^1
"KRN",8994,2636,2,1,0)
CPSRCH^1
"KRN",8994,2636,2,1,1,0)
^^1^1^3060824^
"KRN",8994,2636,2,1,1,1,0)
Partial name search of coordinator(s)  (optional parameter)
"KRN",8994,2636,2,"B","CPSRCH",1)

"KRN",8994,2636,3,0)
^^8^8^3060824^
"KRN",8994,2636,3,1,0)
 
"KRN",8994,2636,3,2,0)
Sample of return:
"KRN",8994,2636,3,3,0)
 
"KRN",8994,2636,3,4,0)
SPINALCORD,PROV ONE^EOL999
"KRN",8994,2636,3,5,0)
SPINALCORD,PROV TWO^EOL999
"KRN",8994,2636,3,6,0)
SPINALCORD,PROV THREE^EOL999
"KRN",8994,2636,3,7,0)
SPINALCORD,PROV FOUR^EOL999
"KRN",8994,2636,3,8,0)
SPINALCORD,PROV FIVE^EOL999
"KRN",8994,2637,-1)
0^17
"KRN",8994,2637,0)
SPN GET VA STATUS^COL^SPNJRPCS^2^A^0^^^^^1
"KRN",8994,2637,1,0)
^^1^1^3060824^
"KRN",8994,2637,1,1,0)
Returns VA SCI Status based on patient's ICN.
"KRN",8994,2637,2,0)
^8994.02A^1^1
"KRN",8994,2637,2,1,0)
ICN^1
"KRN",8994,2637,2,1,1,0)
^^1^1^3060824^
"KRN",8994,2637,2,1,1,1,0)
Individual patient's ICN.
"KRN",8994,2637,2,"B","ICN",1)

"KRN",8994,2637,3,0)
^^4^4^3060824^
"KRN",8994,2637,3,1,0)
 
"KRN",8994,2637,3,2,0)
Sample of return:
"KRN",8994,2637,3,3,0)
 
"KRN",8994,2637,3,4,0)
4 = QUADRIPLEGIA-NONTRAUMATIC^EOL999 
"KRN",8994,2638,-1)
0^16
"KRN",8994,2638,0)
SPN GET PAIN RATING^COL^SPNJRPCP^2^A^0^^^^^1
"KRN",8994,2638,1,0)
^^1^1^3060824^
"KRN",8994,2638,1,1,0)
Returns most recent Vitals Pain Rating (based on the ICN).
"KRN",8994,2638,2,0)
^8994.02A^1^1
"KRN",8994,2638,2,1,0)
ICN^1
"KRN",8994,2638,2,1,1,0)
^^1^1^3060824^
"KRN",8994,2638,2,1,1,1,0)
Individual patient's ICN.
"KRN",8994,2638,2,"B","ICN",1)

"KRN",8994,2638,3,0)
^^4^4^3060824^
"KRN",8994,2638,3,1,0)
 
"KRN",8994,2638,3,2,0)
Sample of return:
"KRN",8994,2638,3,3,0)
 
"KRN",8994,2638,3,4,0)
8^EOL999 
"KRN",8994,2639,-1)
0^15
"KRN",8994,2639,0)
SPN RECENT MED CENTERS^COL^SPNJRPCM^4^A^0^^^^^1
"KRN",8994,2639,1,0)
^^1^1^3060825^
"KRN",8994,2639,1,1,0)
Returns list of sites where requested patient has been treated.
"KRN",8994,2639,2,0)
^8994.02A^1^1
"KRN",8994,2639,2,1,0)
ICN^1
"KRN",8994,2639,2,1,1,0)
^^1^1^3060825^
"KRN",8994,2639,2,1,1,1,0)
ICN of the patient to process
"KRN",8994,2639,2,"B","ICN",1)

"KRN",8994,2639,3,0)
^^17^17^3060825^
"KRN",8994,2639,3,1,0)
 
"KRN",8994,2639,3,2,0)
Return format:
"KRN",8994,2639,3,3,0)
 
"KRN",8994,2639,3,4,0)
HDR999: Report heading descriptions
"KRN",8994,2639,3,5,0)
 
"KRN",8994,2639,3,6,0)
detail level: Medical center name ^ Date patient was last treated ^ end 
"KRN",8994,2639,3,7,0)
of line marker
"KRN",8994,2639,3,8,0)
 
"KRN",8994,2639,3,9,0)
 
"KRN",8994,2639,3,10,0)
Sample of return:
"KRN",8994,2639,3,11,0)
 
"KRN",8994,2639,3,12,0)
HDR999^Pt Has Been Treated at^Date Last Treated^EOL999
"KRN",8994,2639,3,13,0)
SAN DIEGO HCS^09/09/2004^EOL999
"KRN",8994,2639,3,14,0)
CHEYENNE VAMC^08/06/1998^EOL999
"KRN",8994,2639,3,15,0)
EASTERN COLORADO HCS^07/30/1998^EOL999
"KRN",8994,2639,3,16,0)
ST. LOUIS MO VAMC-JC DIVISION^06/18/1998^EOL999
"KRN",8994,2639,3,17,0)
BAY PINES VAMC^05/15/1998^EOL999
"KRN",8994,2640,-1)
0^24
"KRN",8994,2640,0)
SPN GET PROS ITEMS^COL^SPNJRPPL^4^A^0^^^^^1
"KRN",8994,2640,1,0)
^^1^1^3060824^
"KRN",8994,2640,1,1,0)
Returns full list of prosthetic items.
"KRN",8994,2640,3,0)
^^9^9^3060824^
"KRN",8994,2640,3,1,0)
 
"KRN",8994,2640,3,2,0)
Sample of return:
"KRN",8994,2640,3,3,0)
 
"KRN",8994,2640,3,4,0)
A-P LIPPED TIBIAL INSERT 9MM^EOL999
"KRN",8994,2640,3,5,0)
ABDOMINAL BINDER 30X45^EOL999
"KRN",8994,2640,3,6,0)
ABOVE KNEE FULL FOOT^EOL999
"KRN",8994,2640,3,7,0)
ABOVE KNEE OR HIP DISARTICULATION^EOL999
"KRN",8994,2640,3,8,0)
ACL DEFICIENT KNEE BRACE^EOL999
"KRN",8994,2640,3,9,0)
ACTIVEAID SHOWER WHEELCHAIR^EOL999
"KRN",8994,2641,-1)
0^23
"KRN",8994,2641,0)
SPN PROS UTL SPECIFIC^COL^SPNJRPP2^4^A^0^^^^^1
"KRN",8994,2641,1,0)
^^3^3^3060825^
"KRN",8994,2641,1,1,0)
Returns detailed information for delivered prosthetics items for a list 
"KRN",8994,2641,1,2,0)
of given patients (based on the ICN) based on a date range, and 
"KRN",8994,2641,1,3,0)
prosthetic item list.
"KRN",8994,2641,2,0)
^8994.02A^5^4
"KRN",8994,2641,2,1,0)
ICNLIST^2
"KRN",8994,2641,2,1,1,0)
^^1^1^3060825^
"KRN",8994,2641,2,1,1,1,0)
Patient's ICN in string format (ICN^ICN^ICN^ICN...)
"KRN",8994,2641,2,2,0)
FDATE^1
"KRN",8994,2641,2,2,1,0)
^^1^1^3060825^
"KRN",8994,2641,2,2,1,1,0)
Date to start search from.  
"KRN",8994,2641,2,3,0)
TDATE^1
"KRN",8994,2641,2,3,1,0)
^^1^1^3060825^
"KRN",8994,2641,2,3,1,1,0)
Date to end search at.  
"KRN",8994,2641,2,5,0)
ITEMS^2
"KRN",8994,2641,2,5,1,0)
^^1^1^3060825^
"KRN",8994,2641,2,5,1,1,0)
Array that has the prosthetic item names
"KRN",8994,2641,2,"B","FDATE",2)

"KRN",8994,2641,2,"B","ICNLIST",1)

"KRN",8994,2641,2,"B","ITEMS",5)

"KRN",8994,2641,2,"B","TDATE",3)

"KRN",8994,2641,3,0)
^^27^27^3060825^
"KRN",8994,2641,3,1,0)
 
"KRN",8994,2641,3,2,0)
Return format:
"KRN",8994,2641,3,3,0)
 
"KRN",8994,2641,3,4,0)
ITM999^Prosthetic item number^brief description of prosthetic 
"KRN",8994,2641,3,5,0)
item^Prosthetic HCPCS^EOL999
"KRN",8994,2641,3,6,0)
 
"KRN",8994,2641,3,7,0)
(detail/repeating):
"KRN",8994,2641,3,8,0)
Station ID^Patient name^Patient SSN^ total cost of item(s)^transaction 
"KRN",8994,2641,3,9,0)
type^Date Delivered^EOL999
"KRN",8994,2641,3,10,0)
 
"KRN",8994,2641,3,11,0)
TOT999^number of patients ordering item^ total cost of ordered 
"KRN",8994,2641,3,12,0)
items^EOL999
"KRN",8994,2641,3,13,0)
 
"KRN",8994,2641,3,14,0)
 
"KRN",8994,2641,3,15,0)
Sample of return:
"KRN",8994,2641,3,16,0)
 
"KRN",8994,2641,3,17,0)
ITM999^2128^WHEELCHAIR,CUSTOM^WHEELCHAIR LIGHTWEIGHT LEG R^EOL999
"KRN",8994,2641,3,18,0)
CHEYENNE VAMC^SPINALCORD,FIVE^000-00-0005^298.89^INITIAL^12/28/2001^EOL999
"KRN",8994,2641,3,19,0)
TOT999^1^298.89^EOL999
"KRN",8994,2641,3,20,0)
ITM999^2129^EYEGLASSES, PRESCRIPTION^BIFOCAL VISION PRESCR^EOL999
"KRN",8994,2641,3,21,0)
CHEYENNE 
"KRN",8994,2641,3,22,0)
VAMC^SPINALCORD,THREE^000-00-0003^102.45^REPLACE^03/31/2001^EOL999
"KRN",8994,2641,3,23,0)
TOT999^1^102.45^EOL999
"KRN",8994,2641,3,24,0)
ITM999^9958^PROSTHETIC SOCK WOOL BK^AFO MOLDED ANKLE GAUNTLET ^EOL999
"KRN",8994,2641,3,25,0)
CHEYENNE VAMC^SPINAL,CORD 
"KRN",8994,2641,3,26,0)
PTONE^000-00-1001^53.95^INITIAL^04/22/2001^EOL999
"KRN",8994,2641,3,27,0)
TOT999^1^53.95^EOL999 
"KRN",8994,2642,-1)
0^22
"KRN",8994,2642,0)
SPN PROS UTL REPORT^COL^SPNJRPP1^4^A^0^^^^^1
"KRN",8994,2642,1,0)
^^2^2^3060825^
"KRN",8994,2642,1,1,0)
Returns detailed information for delivered prosthetics items for a list 
"KRN",8994,2642,1,2,0)
of given patients (based on the ICN) based on a date range.
"KRN",8994,2642,2,0)
^8994.02A^3^3
"KRN",8994,2642,2,1,0)
ICNLIST^2
"KRN",8994,2642,2,1,1,0)
^^1^1^3060825^
"KRN",8994,2642,2,1,1,1,0)
Patient's ICN in string format (ICN^ICN^ICN^ICN...)
"KRN",8994,2642,2,2,0)
FDATE^1
"KRN",8994,2642,2,2,1,0)
^^1^1^3060825^
"KRN",8994,2642,2,2,1,1,0)
Date to start collection from: (mm/dd/yyyy)
"KRN",8994,2642,2,3,0)
TDATE^1
"KRN",8994,2642,2,3,1,0)
^^1^1^3060825^
"KRN",8994,2642,2,3,1,1,0)
Date to end collection: (mm/dd/yyyy)  
"KRN",8994,2642,2,"B","FDATE",2)

"KRN",8994,2642,2,"B","ICNLIST",1)

"KRN",8994,2642,2,"B","TDATE",3)

"KRN",8994,2642,3,0)
^^57^57^3060825^
"KRN",8994,2642,3,1,0)
 
"KRN",8994,2642,3,2,0)
Return format:
"KRN",8994,2642,3,3,0)
 
"KRN",8994,2642,3,4,0)
HDR999^PATIENTS^ITEMS^EOL999
"KRN",8994,2642,3,5,0)
 (detail/repeating):
"KRN",8994,2642,3,6,0)
Number of patients ^ Number of items ^ EOL999
"KRN",8994,2642,3,7,0)
 
"KRN",8994,2642,3,8,0)
HDR999^PROSTHETIC ITEM^BRIEF DESCRIPTION^QUANTITY^TOTAL 
"KRN",8994,2642,3,9,0)
COSTS^PATIENTS^EOL999
"KRN",8994,2642,3,10,0)
(detail/repeating):
"KRN",8994,2642,3,11,0)
Item number for prosthetic device ^ description of prosthetic device ^ 
"KRN",8994,2642,3,12,0)
total number that were ordered ^ total cost for all orders ^ number of 
"KRN",8994,2642,3,13,0)
patients ordering this device ^ EOL999
"KRN",8994,2642,3,14,0)
 
"KRN",8994,2642,3,15,0)
HDR999^STATION^NAME^SSN^PROSTHETIC ITEM^BRIEF DESCRIPTION^PSAS HCPC^TOTAL 
"KRN",8994,2642,3,16,0)
COST^TRANSACTION TYPE^DATE DELIVERED
"KRN",8994,2642,3,17,0)
(detail/repeating):
"KRN",8994,2642,3,18,0)
Institution/station ^ Patient's name ^ Patient's SSN ^ Item number for 
"KRN",8994,2642,3,19,0)
prosthetic device ^ description of prosthetic device ^ PSAS HCPC for the 
"KRN",8994,2642,3,20,0)
device ^ total cost for the item(s) ordered ^ transaction type for device 
"KRN",8994,2642,3,21,0)
ordered ^ date the item(s) were delivered ^ EOL999
"KRN",8994,2642,3,22,0)
 
"KRN",8994,2642,3,23,0)
 
"KRN",8994,2642,3,24,0)
Sample of return:
"KRN",8994,2642,3,25,0)
 
"KRN",8994,2642,3,26,0)
HDR999^PATIENTS^ITEMS
"KRN",8994,2642,3,27,0)
2^3^EOL999
"KRN",8994,2642,3,28,0)
1^2^EOL999
"KRN",8994,2642,3,29,0)
2^1^EOL999
"KRN",8994,2642,3,30,0)
 
"KRN",8994,2642,3,31,0)
HDR999^PROSTHETIC ITEM^BRIEF DESCRIPTION^QUANTITY^TOTAL 
"KRN",8994,2642,3,32,0)
COSTS^PATIENTS^EOL999
"KRN",8994,2642,3,33,0)
2128^WHEELCHAIR,CUSTOM^1^298.89^1^EOL999
"KRN",8994,2642,3,34,0)
2129^EYEGLASSES, PRESCRIPTION^1^102.45^1^EOL999
"KRN",8994,2642,3,35,0)
2462^SPLINT-BRACE-WRIST/L-LG-1B39^2^24.00^1^EOL999
"KRN",8994,2642,3,36,0)
3006^TIP-CANE-CRUTCH^2^^1^EOL999
"KRN",8994,2642,3,37,0)
3022^BRACE-ANKLE^1^49.99^1^EOL999
"KRN",8994,2642,3,38,0)
7682^HEEL LIFT ADJUSTABLE MEDIUM^1^18.76^1^EOL999
"KRN",8994,2642,3,39,0)
9958^PROSTHETIC SOCK WOOL BK^2^53.95^1^EOL999
"KRN",8994,2642,3,40,0)
 
"KRN",8994,2642,3,41,0)
HDR999^STATION^NAME^SSN^PROSTHETIC ITEM^BRIEF DESCRIPTION^PSAS 
"KRN",8994,2642,3,42,0)
HCPC^TOTAL COST^TRANSACTION TYPE^DATE DELIVERED^EOL999
"KRN",8994,2642,3,43,0)
CHEYENNE VAMC^SPINAL,CORD PTONE^000-00-1001^7682^HEEL LIFT ADJUSTABLE 
"KRN",8994,2642,3,44,0)
MEDIUM^SHOE LIFT ELEV HEEL/SOLE COR^18.76^INITIAL^04/22/2001^EOL999
"KRN",8994,2642,3,45,0)
CHEYENNE VAMC^SPINAL,CORD PTONE^000-00-1001^9958^PROSTHETIC SOCK WOOL 
"KRN",8994,2642,3,46,0)
BK^AFO MOLDED ANKLE GAUNTLET ^53.95^INITIAL^04/22/2001^EOL999
"KRN",8994,2642,3,47,0)
CHEYENNE VAMC^SPINALCORD,FIVE^000-00-
"KRN",8994,2642,3,48,0)
0005^2128^WHEELCHAIR,CUSTOM^WHEELCHAIR LIGHTWEIGHT LEG 
"KRN",8994,2642,3,49,0)
R^298.89^INITIAL^12/28/2001^EOL999
"KRN",8994,2642,3,50,0)
CHEYENNE VAMC^SPINALCORD,SEVEN^000-00-0007^2462^SPLINT-BRACE-WRIST/L-
"KRN",8994,2642,3,51,0)
LG-1B39^PRINTER, COMPUTER^24.00^SPARE^07/01/2002^EOL999
"KRN",8994,2642,3,52,0)
CHEYENNE VAMC^SPINALCORD,SIX^000-00-0006^3006^TIP-CANE-CRUTCH^JOINT 
"KRN",8994,2642,3,53,0)
DEVICE^^SPARE^03/05/2002^EOL999
"KRN",8994,2642,3,54,0)
CHEYENNE VAMC^SPINALCORD,SIX^000-00-0006^3022^BRACE-ANKLE^SLINGS 
"KRN",8994,2642,3,55,0)
^49.99^SPARE^03/05/2002^EOL999
"KRN",8994,2642,3,56,0)
CHEYENNE VAMC^SPINALCORD,THREE^000-00-0003^2129^EYEGLASSES, 
"KRN",8994,2642,3,57,0)
PRESCRIPTION^BIFOCAL VISION PRESCR^102.45^REPLACE^03/31/2001^EOL999
"KRN",8994,2643,-1)
0^13
"KRN",8994,2643,0)
SPN COMM DISCHARGES^COL^SPNJRPCD^4^A^0^^^^^1
"KRN",8994,2643,1,0)
^8994.01^1^1^3060824^^^^
"KRN",8994,2643,1,1,0)
Returns Discharge to Community report information.
"KRN",8994,2643,2,0)
^8994.02A^3^3
"KRN",8994,2643,2,1,0)
ICNLIST^2
"KRN",8994,2643,2,1,1,0)
^8994.021^1^1^3060824^^
"KRN",8994,2643,2,1,1,1,0)
Patient's ICN in list format (ICN^ICN^ICN^ICN^ICN...)
"KRN",8994,2643,2,2,0)
FDATE^1
"KRN",8994,2643,2,2,1,0)
^^1^1^3060824^
"KRN",8994,2643,2,2,1,1,0)
Date to begin search with.
"KRN",8994,2643,2,3,0)
TDATE^1
"KRN",8994,2643,2,3,1,0)
^8994.021^1^1^3060824^^^^
"KRN",8994,2643,2,3,1,1,0)
Date to end search at.
"KRN",8994,2643,2,"B","FDATE",2)

"KRN",8994,2643,2,"B","ICNLIST",1)

"KRN",8994,2643,2,"B","TDATE",3)

"KRN",8994,2643,3,0)
^^44^44^3060824^
"KRN",8994,2643,3,1,0)
 
"KRN",8994,2643,3,2,0)
Return format:
"KRN",8994,2643,3,3,0)
 
"KRN",8994,2643,3,4,0)
HDR999 record: heading titles
"KRN",8994,2643,3,5,0)
 
"KRN",8994,2643,3,6,0)
detail level: Division Name ^ Division Number ^ Patient Name ^ SSN ^ Date 
"KRN",8994,2643,3,7,0)
of Admission ^ Date of Discharge ^ Treating Specialty ^ Admission Source 
"KRN",8994,2643,3,8,0)
^ Admission code ^ Discharge type ^ Discharge Code ^ Destination ^ 
"KRN",8994,2643,3,9,0)
Destination Cord ^ End of line marker
"KRN",8994,2643,3,10,0)
 
"KRN",8994,2643,3,11,0)
TOT999 record: "Community Discharge Rate" ^ discharge rate per division ^ 
"KRN",8994,2643,3,12,0)
End of line marker
"KRN",8994,2643,3,13,0)
 
"KRN",8994,2643,3,14,0)
 
"KRN",8994,2643,3,15,0)
Sample of return:
"KRN",8994,2643,3,16,0)
 
"KRN",8994,2643,3,17,0)
 
"KRN",8994,2643,3,18,0)
HDR999^Facility Name^Division #^Veteran^SSN^Admission Date^Discharge 
"KRN",8994,2643,3,19,0)
Date^Treating Specialty^Admission Source^Admit Code^Discharge Type^DC 
"KRN",8994,2643,3,20,0)
Code^Destination^Destination Code^EOL999
"KRN",8994,2643,3,21,0)
 
"KRN",8994,2643,3,22,0)
CHEYENNE 
"KRN",8994,2643,3,23,0)
VAMC^442^SPINALCORD,THREE^000-00-0003^08/31/2000^09/07/2000^NHCU^DIRECT 
"KRN",8994,2643,3,24,0)
ADMISSION FROM ALL OTHER SOURCES^5G^REGULAR^1^RETURN TO 
"KRN",8994,2643,3,25,0)
COMMUNITY-INDEPENDENT^X^EOL999
"KRN",8994,2643,3,26,0)
 
"KRN",8994,2643,3,27,0)
TOT999^Community Discharge Rate^86.75^EOL999
"KRN",8994,2643,3,28,0)
 
"KRN",8994,2643,3,29,0)
 
"KRN",8994,2643,3,30,0)
 
"KRN",8994,2643,3,31,0)
 
"KRN",8994,2643,3,32,0)
 
"KRN",8994,2643,3,33,0)
 
"KRN",8994,2643,3,34,0)
 
"KRN",8994,2643,3,35,0)
 
"KRN",8994,2643,3,36,0)
 
"KRN",8994,2643,3,37,0)
Code^Destination^Destination Code^EOL999
"KRN",8994,2643,3,38,0)
 
"KRN",8994,2643,3,39,0)
CHEYENNE 
"KRN",8994,2643,3,40,0)
VAMC^442^SPINALCORD,THREE^000-00-0003^08/31/2000^09/07/2000^NHCU^DIRECT 
"KRN",8994,2643,3,41,0)
ADMISSION FROM ALL OTHER SOURCES^5G^REGULAR^1^RETURN TO 
"KRN",8994,2643,3,42,0)
COMMUNITY-INDEPENDENT^X^EOL999
"KRN",8994,2643,3,43,0)
 
"KRN",8994,2643,3,44,0)
TOT999^Community Discharge Rate^86.75^EOL999
"KRN",8994,2644,-1)
0^19
"KRN",8994,2644,0)
SPN INPAT CARE^COL^SPNJRPIC^4^A^0^^^^^1
"KRN",8994,2644,1,0)
^^2^2^3060824^
"KRN",8994,2644,1,1,0)
Returns detailed information for Applications for Inpatient Care for a 
"KRN",8994,2644,1,2,0)
list of given patients (list of ICNs) based on a date range. 
"KRN",8994,2644,2,0)
^8994.02A^3^3
"KRN",8994,2644,2,1,0)
ICNLIST^2
"KRN",8994,2644,2,1,1,0)
^^1^1^3060824^
"KRN",8994,2644,2,1,1,1,0)
Patient's ICNs in string format (ICN^ICN^ICN^ICN^ICN...) 
"KRN",8994,2644,2,2,0)
FDATE^1
"KRN",8994,2644,2,2,1,0)
^^1^1^3060824^
"KRN",8994,2644,2,2,1,1,0)
Date to start search from.  
"KRN",8994,2644,2,3,0)
TDATE^1
"KRN",8994,2644,2,3,1,0)
^^1^1^3060824^
"KRN",8994,2644,2,3,1,1,0)
Date to end search at.  
"KRN",8994,2644,2,"B","FDATE",2)

"KRN",8994,2644,2,"B","ICNLIST",1)

"KRN",8994,2644,2,"B","TDATE",3)

"KRN",8994,2644,3,0)
^^22^22^3060824^
"KRN",8994,2644,3,1,0)
 
"KRN",8994,2644,3,2,0)
Return format:
"KRN",8994,2644,3,3,0)
 
"KRN",8994,2644,3,4,0)
HDR999: headings for reporting
"KRN",8994,2644,3,5,0)
 
"KRN",8994,2644,3,6,0)
detail level: Patient name ^ last four digits of SSN ^ Date of 
"KRN",8994,2644,3,7,0)
disposition ^ Description of disposition ^ Type of benefit ^ end of line 
"KRN",8994,2644,3,8,0)
marker
"KRN",8994,2644,3,9,0)
 
"KRN",8994,2644,3,10,0)
 
"KRN",8994,2644,3,11,0)
Sample of return:
"KRN",8994,2644,3,12,0)
 
"KRN",8994,2644,3,13,0)
HDR999^PATIENT^DATE OF DISPOSITION^DISPOSITION^TYPE OF BENEFIT^EOL999
"KRN",8994,2644,3,14,0)
 
"KRN",8994,2644,3,15,0)
SPINALCORD,FIFTEEN (S0015)^10/10/02^SCHEDULE FUTURE 
"KRN",8994,2644,3,16,0)
APPOINTMENT^OUTPATIENT DENTAL^EOL999
"KRN",8994,2644,3,17,0)
 
"KRN",8994,2644,3,18,0)
SPINALCORD,NINE (S0009)^9/6/01^SCHEDULE FUTURE APPOINTMENT^OUTPATIENT 
"KRN",8994,2644,3,19,0)
DENTAL^EOL999
"KRN",8994,2644,3,20,0)
 
"KRN",8994,2644,3,21,0)
SPINALCORD,TWELVE (S0012)^3/25/03^NO CARE OR TREATMENT REQUIRED^NURSING 
"KRN",8994,2644,3,22,0)
HOME CARE^EOL999
"KRN",8994,2645,-1)
0^29
"KRN",8994,2645,0)
SPN SCI SCD DISCHARGES^COL^SPNJRPSD^4^A^0^^^^^1
"KRN",8994,2645,1,0)
^^2^2^3060825^
"KRN",8994,2645,1,1,0)
Returns detailed information for SCI/SCD DISCHARGES for a list of given 
"KRN",8994,2645,1,2,0)
patients (based on the ICN) based on a date range.
"KRN",8994,2645,2,0)
^8994.02A^3^3
"KRN",8994,2645,2,1,0)
ICNLIST^2
"KRN",8994,2645,2,1,1,0)
^^1^1^3060825^
"KRN",8994,2645,2,1,1,1,0)
Patient's ICN in string format (ICN^ICN^ICN^ICN...)
"KRN",8994,2645,2,2,0)
FDATE^1
"KRN",8994,2645,2,2,1,0)
^^1^1^3060825^
"KRN",8994,2645,2,2,1,1,0)
Date to start search from.  
"KRN",8994,2645,2,3,0)
TDATE^1
"KRN",8994,2645,2,3,1,0)
^^1^1^3060825^
"KRN",8994,2645,2,3,1,1,0)
Date to end search at.  
"KRN",8994,2645,2,"B","FDATE",2)

"KRN",8994,2645,2,"B","ICNLIST",1)

"KRN",8994,2645,2,"B","TDATE",3)

"KRN",8994,2645,3,0)
^^41^41^3060825^
"KRN",8994,2645,3,1,0)
 
"KRN",8994,2645,3,2,0)
Return format:
"KRN",8994,2645,3,3,0)
 
"KRN",8994,2645,3,4,0)
HDR1999^Patient^SSN^SCI^EOL999
"KRN",8994,2645,3,5,0)
Patient Name ^ Social Security Number ^ VA SCI Status ^ EOL999
"KRN",8994,2645,3,6,0)
 
"KRN",8994,2645,3,7,0)
(detail/repeating):
"KRN",8994,2645,3,8,0)
HDR2999^Date D/C^LOS^D/C Location^Diagnosis Codes^EOL999
"KRN",8994,2645,3,9,0)
DTL999^ Date of Discharge ^ Length of Stay ^ Discharge Location ^ EOL999
"KRN",8994,2645,3,10,0)
 
"KRN",8994,2645,3,11,0)
(diagnosis/repeating):
"KRN",8994,2645,3,12,0)
DIAG999 ^ Diagnosis Code ^ EOL999
"KRN",8994,2645,3,13,0)
 
"KRN",8994,2645,3,14,0)
HDR3999^Facility^Station #^Total^EOL999
"KRN",8994,2645,3,15,0)
Name of receiving facility ^ Station Number ID ^ Total # of patients 
"KRN",8994,2645,3,16,0)
received ^ EOL999
"KRN",8994,2645,3,17,0)
 
"KRN",8994,2645,3,18,0)
 
"KRN",8994,2645,3,19,0)
Sample of return:
"KRN",8994,2645,3,20,0)
 
"KRN",8994,2645,3,21,0)
HDR1999^Patient^SSN^SCI^EOL999
"KRN",8994,2645,3,22,0)
PAT999^AKDYFSXY,KUHYIL A^000-00-9001^NOT APPLICABLE^EOL999
"KRN",8994,2645,3,23,0)
HDR2999^Date D/C^LOS^D/C Location^Diagnosis Codes^EOL999
"KRN",8994,2645,3,24,0)
DTL999^7/28/02^1^ICU-M^EOL999
"KRN",8994,2645,3,25,0)
DIAG999^HYPOVOLEMIA^EOL999
"KRN",8994,2645,3,26,0)
DIAG999^CARDIAC DYSRHYTHMIAS NEC^EOL999
"KRN",8994,2645,3,27,0)
DIAG999^ANEMIA NOS^EOL999
"KRN",8994,2645,3,28,0)
DIAG999^ASTHMA NOS^EOL999
"KRN",8994,2645,3,29,0)
HDR1999^Patient^SSN^SCI^EOL999
"KRN",8994,2645,3,30,0)
PAT999^CALWWHU,KDAA A^000-00-9002^NOT APPLICABLE^EOL999
"KRN",8994,2645,3,31,0)
HDR2999^Date D/C^LOS^D/C Location^Diagnosis Codes^EOL999
"KRN",8994,2645,3,32,0)
DTL999^12/9/03^1^^EOL999
"KRN",8994,2645,3,33,0)
HDR1999^Patient^SSN^SCI^EOL999
"KRN",8994,2645,3,34,0)
PAT999^DHPHN,ELUXAI G^000-00-9003^PARAPLEGIA-NONTRAUMATIC^EOL999
"KRN",8994,2645,3,35,0)
HDR2999^Date D/C^LOS^D/C Location^Diagnosis Codes^EOL999
"KRN",8994,2645,3,36,0)
DTL999^1/31/03^29^HOSPICE^EOL999
"KRN",8994,2645,3,37,0)
DIAG999^MAL NEO BRONCH/LUNG NOS^EOL999
"KRN",8994,2645,3,38,0)
DIAG999^SECONDARY MALIG NEO BONE^EOL999
"KRN",8994,2645,3,39,0)
DIAG999^MYELOPATHY IN OTH DIS^EOL999
"KRN",8994,2645,3,40,0)
DIAG999^ENCOUNTER-PALLIATIVE CARE^EOL999
"KRN",8994,2645,3,41,0)
DIAG999^COR ATHEROSCL UNSP TYP-VES^EOL999
"KRN",8994,2646,-1)
0^27
"KRN",8994,2646,0)
SPN READMISSIONS REPORT^COL^SPNJRPRE^4^A^0^^^^^1
"KRN",8994,2646,1,0)
^^3^3^3060825^
"KRN",8994,2646,1,1,0)
Returns detailed information for SCI/SCD ADMISSIONS and DISCHARGES for a 
"KRN",8994,2646,1,2,0)
list of given patients (based on the ICN) based on a date range, so that 
"KRN",8994,2646,1,3,0)
numbers of Readmissions can be determined.
"KRN",8994,2646,2,0)
^8994.02A^3^3
"KRN",8994,2646,2,1,0)
ICNLIST^2
"KRN",8994,2646,2,1,1,0)
^^1^1^3060825^
"KRN",8994,2646,2,1,1,1,0)
Patient's ICN in string format (ICN^ICN^ICN^ICN...)
"KRN",8994,2646,2,2,0)
FDATE^1
"KRN",8994,2646,2,2,1,0)
^^1^1^3060825^
"KRN",8994,2646,2,2,1,1,0)
Date to start search from.  
"KRN",8994,2646,2,3,0)
TDATE^1
"KRN",8994,2646,2,3,1,0)
^^1^1^3060825^
"KRN",8994,2646,2,3,1,1,0)
Date to end search at.  
"KRN",8994,2646,2,"B","FDATE",2)

"KRN",8994,2646,2,"B","ICNLIST",1)

"KRN",8994,2646,2,"B","TDATE",3)

"KRN",8994,2646,3,0)
^^25^25^3060825^
"KRN",8994,2646,3,1,0)
 
"KRN",8994,2646,3,2,0)
Return format:
"KRN",8994,2646,3,3,0)
 
"KRN",8994,2646,3,4,0)
Patient's ICN ^ Transaction type (Admission or Discharge) ^ Institution 
"KRN",8994,2646,3,5,0)
Name ^ Institution Number ^ Ward Location ^ Mumps date/time stamp (for 
"KRN",8994,2646,3,6,0)
calculations) ^ Date/time stamp ^ EOL999
"KRN",8994,2646,3,7,0)
 
"KRN",8994,2646,3,8,0)
 
"KRN",8994,2646,3,9,0)
Sample of return:
"KRN",8994,2646,3,10,0)
 
"KRN",8994,2646,3,11,0)
1002009998^ADMISSION^^^ICU-M^3011029.144215^OCT 29,2001@14:42:15^EOL999
"KRN",8994,2646,3,12,0)
 
"KRN",8994,2646,3,13,0)
1002009998^DISCHARGE^EASTERN COLORADO HCS^554^ICU-M^3011029.172902^OCT 
"KRN",8994,2646,3,14,0)
29,2001@17:29:02^EOL999
"KRN",8994,2646,3,15,0)
 
"KRN",8994,2646,3,16,0)
1002009998^ADMISSION^^^ICU-M^3040912.203106^SEP 12,2004@20:31:06^EOL999
"KRN",8994,2646,3,17,0)
 
"KRN",8994,2646,3,18,0)
1002009998^DISCHARGE^^^ICU-M^3040914.12475^SEP 14,2004@12:47:50^EOL999
"KRN",8994,2646,3,19,0)
 
"KRN",8994,2646,3,20,0)
1002045970^ADMISSION^^^C SURGERY^2990224.100912^FEB 
"KRN",8994,2646,3,21,0)
24,1999@10:09:12^EOL999
"KRN",8994,2646,3,22,0)
 
"KRN",8994,2646,3,23,0)
1002045970^DISCHARGE^^^C SURGERY^2990303.110915^MAR 3,1999@11:09:15^EOL999
"KRN",8994,2646,3,24,0)
 
"KRN",8994,2646,3,25,0)
1002045970^ADMISSION^^^ICU-S^3050101.08^JAN 1,2005@08:00^EOL999
"KRN",8994,2647,-1)
0^25
"KRN",8994,2647,0)
SPN PROGRESS NOTES WRAPPER^COL^SPNJRPPN^1^A^0^^^^^1
"KRN",8994,2647,1,0)
^^2^2^3060824^
"KRN",8994,2647,1,1,0)
Submits progress note to VistA and returns a confirmation or error 
"KRN",8994,2647,1,2,0)
message, if problem occurred.
"KRN",8994,2647,2,0)
^8994.02A^11^11
"KRN",8994,2647,2,1,0)
DFN^1
"KRN",8994,2647,2,1,1,0)
^^1^1^3060824^
"KRN",8994,2647,2,1,1,1,0)
DFN/Internal Number of Patient
"KRN",8994,2647,2,2,0)
TITLE^1
"KRN",8994,2647,2,2,1,0)
^^1^1^3060824^
"KRN",8994,2647,2,2,1,1,0)
TIU Document Definition
"KRN",8994,2647,2,3,0)
VDT^1
"KRN",8994,2647,2,3,1,0)
^^1^1^3060824^
"KRN",8994,2647,2,3,1,1,0)
Time/Date of Visit (Not used, leave blank)
"KRN",8994,2647,2,4,0)
VLOC^1
"KRN",8994,2647,2,4,1,0)
^^1^1^3060824^
"KRN",8994,2647,2,4,1,1,0)
Visit Location (Not used, leave blank)
"KRN",8994,2647,2,5,0)
VSIT^1
"KRN",8994,2647,2,5,1,0)
^^1^1^3060824^
"KRN",8994,2647,2,5,1,1,0)
Visit file number (Not used, leave blank)
"KRN",8994,2647,2,6,0)
TIUX^2
"KRN",8994,2647,2,6,1,0)
^^1^1^3060824^
"KRN",8994,2647,2,6,1,1,0)
Array containing field data and body document
"KRN",8994,2647,2,7,0)
VSTR^1
"KRN",8994,2647,2,7,1,0)
^^1^1^3060824^
"KRN",8994,2647,2,7,1,1,0)
Visit string (VLOC;VDT;VTYPE)
"KRN",8994,2647,2,8,0)
SUPPRESS^1
"KRN",8994,2647,2,8,1,0)
^^1^1^3060824^
"KRN",8994,2647,2,8,1,1,0)
Suppress execution of Commit Action? (Not used, leave blank)
"KRN",8994,2647,2,9,0)
NOASF^1
"KRN",8994,2647,2,9,1,0)
^^1^1^3060824^
"KRN",8994,2647,2,9,1,1,0)
Set Asave Cross-reference? (Not used, leave blank)
"KRN",8994,2647,2,10,0)
DUZ^1
"KRN",8994,2647,2,10,1,0)
^^1^1^3060824^
"KRN",8994,2647,2,10,1,1,0)
Internal ID of employee entering Progress Note
"KRN",8994,2647,2,11,0)
SPNSIG^1
"KRN",8994,2647,2,11,1,0)
^^1^1^3060824^
"KRN",8994,2647,2,11,1,1,0)
Electronic Signature Code of employee
"KRN",8994,2647,2,"B","DFN",1)

"KRN",8994,2647,2,"B","DUZ",10)

"KRN",8994,2647,2,"B","NOASF",9)

"KRN",8994,2647,2,"B","SPNSIG",11)

"KRN",8994,2647,2,"B","SUPPRESS",8)

"KRN",8994,2647,2,"B","TITLE",2)

"KRN",8994,2647,2,"B","TIUX",6)

"KRN",8994,2647,2,"B","VDT",3)

"KRN",8994,2647,2,"B","VLOC",4)

"KRN",8994,2647,2,"B","VSIT",5)

"KRN",8994,2647,2,"B","VSTR",7)

"KRN",8994,2647,3,0)
^^6^6^3060824^
"KRN",8994,2647,3,1,0)
 
"KRN",8994,2647,3,2,0)
Returns: Confirmation Number, which will be the number '1' if successful.
"KRN",8994,2647,3,3,0)
('NOT A VALID SIGNATURE' will return if the ESIG is not valid for   
"KRN",8994,2647,3,4,0)
employee's DUZ, 'DOCUMENT NOT CREATED' will return if the note was not 
"KRN",8994,2647,3,5,0)
successfully stored, and 'MUST SIGN NOTE IN CPRS' if note was created, 
"KRN",8994,2647,3,6,0)
but not successfully signed.)
"KRN",8994,2648,-1)
0^26
"KRN",8994,2648,0)
SPN GET RACE^COL^SPNJRPRC^4^A^0^^^^^1
"KRN",8994,2648,1,0)
^8994.01^1^1^3070112^^^
"KRN",8994,2648,1,1,0)
Returns VA race information based on the patient's ICN.
"KRN",8994,2648,2,0)
^8994.02A^1^1
"KRN",8994,2648,2,1,0)
ICN^1
"KRN",8994,2648,2,1,1,0)
^8994.021^1^1^3070112^^^
"KRN",8994,2648,2,1,1,1,0)
Individual patient's ICN.
"KRN",8994,2648,2,"B","ICN",1)

"KRN",8994,2648,3,0)
^8994.03^4^4^3070112^^^
"KRN",8994,2648,3,1,0)
 
"KRN",8994,2648,3,2,0)
Sample of return:
"KRN",8994,2648,3,3,0)
 
"KRN",8994,2648,3,4,0)
WHITE^EOL999 
"KRN",8994,2649,-1)
0^20
"KRN",8994,2649,0)
SPN ICN LOADER^COL^SPNJRPIL^4^A^0^^^^^1
"KRN",8994,2649,1,0)
^^1^1^3060824^
"KRN",8994,2649,1,1,0)
Returns the appropriate ICNs for every DFN that is requested. 
"KRN",8994,2649,2,0)
^8994.02A^1^1
"KRN",8994,2649,2,1,0)
DFNLST^2
"KRN",8994,2649,2,1,1,0)
^^1^1^3060824^
"KRN",8994,2649,2,1,1,1,0)
Patients DFN in list format (DFN^DFN^DFN^DFN^DFN...)
"KRN",8994,2649,2,"B","DFNLST",1)

"KRN",8994,2649,3,0)
^^16^16^3060824^
"KRN",8994,2649,3,1,0)
 
"KRN",8994,2649,3,2,0)
Return format:
"KRN",8994,2649,3,3,0)
 
"KRN",8994,2649,3,4,0)
ICN (or error message) ^ DFN ^ end of line marker
"KRN",8994,2649,3,5,0)
 
"KRN",8994,2649,3,6,0)
 
"KRN",8994,2649,3,7,0)
Sample of return:
"KRN",8994,2649,3,8,0)
 
"KRN",8994,2649,3,9,0)
1002045970^31367^EOL999
"KRN",8994,2649,3,10,0)
DFN NOT FOUND^345X34^EOL999
"KRN",8994,2649,3,11,0)
DFN NOT FOUND^234523452345^EOL999
"KRN",8994,2649,3,12,0)
1003902708^23187^EOL999
"KRN",8994,2649,3,13,0)
NO LOCAL ICN FOUND^34772^EOL999
"KRN",8994,2649,3,14,0)
1009004975^23147^EOL999
"KRN",8994,2649,3,15,0)
1001375693^10227^EOL999
"KRN",8994,2649,3,16,0)
NO LOCAL ICN FOUND^27072^EOL999
"KRN",8994,2650,-1)
0^21
"KRN",8994,2650,0)
SPN INPATIENT ICNS^COL^SPNJRPIP^4^A^0^^^^^1
"KRN",8994,2650,1,0)
^8994.01^2^2^3060824^^
"KRN",8994,2650,1,1,0)
Returns list of ICNs of all Inpatients during a given date range...used 
"KRN",8994,2650,1,2,0)
as input for SCI filtered reports.
"KRN",8994,2650,2,0)
^8994.02A^2^2
"KRN",8994,2650,2,1,0)
FDATE^1
"KRN",8994,2650,2,1,1,0)
^^1^1^3060824^
"KRN",8994,2650,2,1,1,1,0)
Date to begin Inpatient search
"KRN",8994,2650,2,2,0)
TDATE^1
"KRN",8994,2650,2,2,1,0)
^^1^1^3060824^
"KRN",8994,2650,2,2,1,1,0)
Date to end Inpatient search
"KRN",8994,2650,2,"B","FDATE",1)

"KRN",8994,2650,2,"B","TDATE",2)

"KRN",8994,2650,3,0)
^^10^10^3060824^
"KRN",8994,2650,3,1,0)
 
"KRN",8994,2650,3,2,0)
Sample of return:
"KRN",8994,2650,3,3,0)
 
"KRN",8994,2650,3,4,0)
1000656510^EOL999
"KRN",8994,2650,3,5,0)
1000728259^EOL999
"KRN",8994,2650,3,6,0)
1000743416^EOL999
"KRN",8994,2650,3,7,0)
1000759238^EOL999
"KRN",8994,2650,3,8,0)
1000829592^EOL999
"KRN",8994,2650,3,9,0)
1000841339^EOL999
"KRN",8994,2650,3,10,0)
1000973336^EOL999
"KRN",8994,2651,-1)
0^28
"KRN",8994,2651,0)
SPN SERVICE CONNECTED ICNS^COL^SPNJRPSC^4^A^0^^^^^1
"KRN",8994,2651,1,0)
^8994.01^5^5^3060825^^
"KRN",8994,2651,1,1,0)
 
"KRN",8994,2651,1,2,0)
 
"KRN",8994,2651,1,3,0)
 
"KRN",8994,2651,1,4,0)
Returns list of ICNs of all patients with a service connection percentage 
"KRN",8994,2651,1,5,0)
within the range given.
"KRN",8994,2651,2,0)
^8994.02A^2^2
"KRN",8994,2651,2,1,0)
BPER^1
"KRN",8994,2651,2,1,1,0)
^^1^1^3060825^
"KRN",8994,2651,2,1,1,1,0)
Beginning or low range percentage of service connection
"KRN",8994,2651,2,2,0)
EPER^1
"KRN",8994,2651,2,2,1,0)
^^1^1^3060825^
"KRN",8994,2651,2,2,1,1,0)
Ending or high range percentage of service connection
"KRN",8994,2651,2,"B","BPER",1)

"KRN",8994,2651,2,"B","EPER",2)

"KRN",8994,2651,3,0)
^^14^14^3060825^
"KRN",8994,2651,3,1,0)
 
"KRN",8994,2651,3,2,0)
Return format:
"KRN",8994,2651,3,3,0)
 
"KRN",8994,2651,3,4,0)
ICN ^ Service connected % ^ end of line marker
"KRN",8994,2651,3,5,0)
 
"KRN",8994,2651,3,6,0)
 
"KRN",8994,2651,3,7,0)
Sample of return:
"KRN",8994,2651,3,8,0)
 
"KRN",8994,2651,3,9,0)
1000651813^40^EOL999
"KRN",8994,2651,3,10,0)
1000656166^60^EOL999
"KRN",8994,2651,3,11,0)
1000657700^40^EOL999
"KRN",8994,2651,3,12,0)
1000666648^40^EOL999
"KRN",8994,2651,3,13,0)
1000667766^60^EOL999
"KRN",8994,2651,3,14,0)
1000670352^60^EOL999
"KRN",8994,2652,-1)
0^73
"KRN",8994,2652,0)
SPN FEE BASIS ICNS^COL^SPNJRPFB^4^A^0^^^^^1
"KRN",8994,2652,1,0)
^8994.01^3^3^3060824^^
"KRN",8994,2652,1,1,0)
Returns list of patient's ICNs who were Fee Basis
"KRN",8994,2652,1,2,0)
patients during a selected date range...results are used
"KRN",8994,2652,1,3,0)
for filtered reporting.
"KRN",8994,2652,2,0)
^8994.02A^2^2
"KRN",8994,2652,2,1,0)
FDATE^1
"KRN",8994,2652,2,1,1,0)
^^1^1^3060824^
"KRN",8994,2652,2,1,1,1,0)
Date to begin Fee Basis search.
"KRN",8994,2652,2,2,0)
TDATE^1
"KRN",8994,2652,2,2,1,0)
^8994.021^1^1^3060824^^
"KRN",8994,2652,2,2,1,1,0)
Date to end Fee Basis search.
"KRN",8994,2652,2,"B","FDATE",1)

"KRN",8994,2652,2,"B","TDATE",2)

"KRN",8994,2652,3,0)
^8994.03^9^9^3060824^^
"KRN",8994,2652,3,1,0)
Sample of return:
"KRN",8994,2652,3,2,0)
 
"KRN",8994,2652,3,3,0)
1000652046^EOL999
"KRN",8994,2652,3,4,0)
1000655640^EOL999
"KRN",8994,2652,3,5,0)
1000657416^EOL999
"KRN",8994,2652,3,6,0)
1000657700^EOL999
"KRN",8994,2652,3,7,0)
1000659587^EOL999
"KRN",8994,2652,3,8,0)
1000683271^EOL999
"KRN",8994,2652,3,9,0)
1000720971^EOL999
"KRN",8994,2653,-1)
0^80
"KRN",8994,2653,0)
SPN PROSTHETICS ICNS^COL^SPNJRPPR^4^A^0^^^^^1
"KRN",8994,2653,1,0)
^^1^1^3060824^
"KRN",8994,2653,1,1,0)
Returns list of ICNs of all patients with a given prosthetics device.
"KRN",8994,2653,2,0)
^8994.02A^2^1
"KRN",8994,2653,2,2,0)
DESC^2
"KRN",8994,2653,2,2,1,0)
^^1^1^3060824^
"KRN",8994,2653,2,2,1,1,0)
List of descriptions of the prosthetic devices (array format)
"KRN",8994,2653,2,"B","DESC",2)

"KRN",8994,2653,3,0)
^^6^6^3060824^
"KRN",8994,2653,3,1,0)
 
"KRN",8994,2653,3,2,0)
Sample of return:
"KRN",8994,2653,3,3,0)
 
"KRN",8994,2653,3,4,0)
1002051716^EOL999
"KRN",8994,2653,3,5,0)
1002111043^EOL999
"KRN",8994,2653,3,6,0)
1003905705^EOL999
"KRN",8994,2654,-1)
0^78
"KRN",8994,2654,0)
SPN MEDICATIONS ICNS^COL^SPNJRPDC^4^A^0^^^^^1
"KRN",8994,2654,1,0)
^^2^2^3060824^
"KRN",8994,2654,1,1,0)
Returns list of ICNs of all patients prescribed a specific VA Drug Class 
"KRN",8994,2654,1,2,0)
during a given date range.
"KRN",8994,2654,2,0)
^8994.02A^4^4
"KRN",8994,2654,2,1,0)
FDATE^1
"KRN",8994,2654,2,1,1,0)
^^1^1^3060824^
"KRN",8994,2654,2,1,1,1,0)
Date to begin Medications search
"KRN",8994,2654,2,2,0)
TDATE^1
"KRN",8994,2654,2,2,1,0)
^^1^1^3060824^
"KRN",8994,2654,2,2,1,1,0)
Date to end Medications search
"KRN",8994,2654,2,3,0)
VADC^1
"KRN",8994,2654,2,3,1,0)
^^1^1^3060824^
"KRN",8994,2654,2,3,1,1,0)
VA Drug Class list (array format)
"KRN",8994,2654,2,4,0)
ICNLST^1
"KRN",8994,2654,2,4,1,0)
^^1^1^3060824^
"KRN",8994,2654,2,4,1,1,0)
List of ICNs to search from
"KRN",8994,2654,2,"B","FDATE",1)

"KRN",8994,2654,2,"B","ICNLST",4)

"KRN",8994,2654,2,"B","TDATE",2)

"KRN",8994,2654,2,"B","VADC",3)

"KRN",8994,2654,3,0)
^^9^9^3060824^
"KRN",8994,2654,3,1,0)
 
"KRN",8994,2654,3,2,0)
Sample of return:
"KRN",8994,2654,3,3,0)
 
"KRN",8994,2654,3,4,0)
1000655640^EOL999
"KRN",8994,2654,3,5,0)
1000666192^EOL999
"KRN",8994,2654,3,6,0)
1000672272^EOL999
"KRN",8994,2654,3,7,0)
1000678590^EOL999
"KRN",8994,2654,3,8,0)
1000684631^EOL999
"KRN",8994,2654,3,9,0)
1000698261^EOL999
"KRN",8994,2655,-1)
0^79
"KRN",8994,2655,0)
SPN OUTPATIENT ICNS^COL^SPNJRPOP^4^A^0^^^^^1
"KRN",8994,2655,1,0)
^^2^2^3060824^
"KRN",8994,2655,1,1,0)
Returns list of ICNs of all outpatient visits during a given date range 
"KRN",8994,2655,1,2,0)
and clinic list.
"KRN",8994,2655,2,0)
^8994.02A^5^4
"KRN",8994,2655,2,1,0)
FDATE^1
"KRN",8994,2655,2,1,1,0)
^^1^1^3060824^
"KRN",8994,2655,2,1,1,1,0)
Date to begin Outpatients search
"KRN",8994,2655,2,2,0)
TDATE^1
"KRN",8994,2655,2,2,1,0)
^^1^1^3060824^
"KRN",8994,2655,2,2,1,1,0)
Date to end Outpatients search
"KRN",8994,2655,2,3,0)
CLINLST^2
"KRN",8994,2655,2,3,1,0)
^^1^1^3060824^
"KRN",8994,2655,2,3,1,1,0)
List of Outpatient clinic stops 
"KRN",8994,2655,2,5,0)
ICNLST^2
"KRN",8994,2655,2,5,1,0)
^^1^1^3060824^
"KRN",8994,2655,2,5,1,1,0)
List of ICNs to search from
"KRN",8994,2655,2,"B","CLINLST",3)

"KRN",8994,2655,2,"B","FDATE",1)

"KRN",8994,2655,2,"B","ICNLST",5)

"KRN",8994,2655,2,"B","TDATE",2)

"KRN",8994,2655,3,0)
^^12^12^3060824^
"KRN",8994,2655,3,1,0)
 
"KRN",8994,2655,3,2,0)
Sample of return:
"KRN",8994,2655,3,3,0)
 
"KRN",8994,2655,3,4,0)
1002009998^EOL999
"KRN",8994,2655,3,5,0)
1001994671^EOL999
"KRN",8994,2655,3,6,0)
1002002086^EOL999
"KRN",8994,2655,3,7,0)
1002062536^EOL999
"KRN",8994,2655,3,8,0)
1002023463^EOL999
"KRN",8994,2655,3,9,0)
1002002563^EOL999
"KRN",8994,2655,3,10,0)
1002035307^EOL999
"KRN",8994,2655,3,11,0)
1002033570^EOL999
"KRN",8994,2655,3,12,0)
1001991401^EOL999
"KRN",8994,2656,-1)
0^76
"KRN",8994,2656,0)
SPN GET ETHNICITY^COL^SPNJRPET^4^A^0^^^^^1
"KRN",8994,2656,1,0)
^^1^1^3060824^
"KRN",8994,2656,1,1,0)
Returns VA Ethnicity information for a patient.
"KRN",8994,2656,2,0)
^8994.02A^1^1
"KRN",8994,2656,2,1,0)
ICN^1
"KRN",8994,2656,2,1,1,0)
^^1^1^3060824^
"KRN",8994,2656,2,1,1,1,0)
Individual patient's ICN.
"KRN",8994,2656,2,"B","ICN",1)

"KRN",8994,2656,3,0)
^^4^4^3060824^
"KRN",8994,2656,3,1,0)
 
"KRN",8994,2656,3,2,0)
Sample of return:
"KRN",8994,2656,3,3,0)
 
"KRN",8994,2656,3,4,0)
NOT HISPANIC OR LATINO^EOL999
"KRN",8994,2657,-1)
0^81
"KRN",8994,2657,0)
SPN SCI USER ROLES^COL^SPNJRPSR^4^A^0^^^^^1
"KRN",8994,2657,1,0)
^^1^1^3060825^
"KRN",8994,2657,1,1,0)
Returns SCI Roles for all SCI NEW PERSON entries.
"KRN",8994,2657,3,0)
^^12^12^3060825^
"KRN",8994,2657,3,1,0)
 
"KRN",8994,2657,3,2,0)
Return format:
"KRN",8994,2657,3,3,0)
 
"KRN",8994,2657,3,4,0)
SCI user name ^ Assigned role(s) ^ Assigned access ^ end of line marker
"KRN",8994,2657,3,5,0)
 
"KRN",8994,2657,3,6,0)
 
"KRN",8994,2657,3,7,0)
Sample of return:
"KRN",8994,2657,3,8,0)
 
"KRN",8994,2657,3,9,0)
AAAHY,BLSEUNY L^Admin^Institution^EOL999
"KRN",8994,2657,3,10,0)
SCIADMIN,USER GUI^Admin^Institution^EOL999
"KRN",8994,2657,3,11,0)
SCICLINICIAN,USER GUI^Clinician^Region^EOL999
"KRN",8994,2657,3,12,0)
SCIRESEARCHER,USER GUI^Researcher^Institution^EOL999
"KRN",8994,2658,-1)
0^77
"KRN",8994,2658,0)
SPN MEANS & ELIGIBILITY^COL^SPNJRPE2^4^A^0^^^^^1
"KRN",8994,2658,1,0)
^^1^1^3060824^
"KRN",8994,2658,1,1,0)
Returns list of current Means and Eligibility for all requested patients
"KRN",8994,2658,2,0)
^8994.02A^1^1
"KRN",8994,2658,2,1,0)
ICNLIST^1
"KRN",8994,2658,2,1,1,0)
^^1^1^3060824^
"KRN",8994,2658,2,1,1,1,0)
List of patient ICNs to process
"KRN",8994,2658,2,"B","ICNLIST",1)

"KRN",8994,2658,3,0)
^^20^20^3060824^
"KRN",8994,2658,3,1,0)
 
"KRN",8994,2658,3,2,0)
Return format:
"KRN",8994,2658,3,3,0)
 
"KRN",8994,2658,3,4,0)
Eligibility Group ^ Means type ^ Patient's ICN ^ end of line marker
"KRN",8994,2658,3,5,0)
 
"KRN",8994,2658,3,6,0)
 
"KRN",8994,2658,3,7,0)
Sample of return:
"KRN",8994,2658,3,8,0)
 
"KRN",8994,2658,3,9,0)
GROUP 1^^1003905705^EOL999
"KRN",8994,2658,3,10,0)
GROUP 1^^1002011919^EOL999
"KRN",8994,2658,3,11,0)
GROUP 4^^1002111043^EOL999
"KRN",8994,2658,3,12,0)
^REQUIRED^1002083480^EOL999
"KRN",8994,2658,3,13,0)
GROUP 1^^1001393031^EOL999
"KRN",8994,2658,3,14,0)
GROUP 1^^1003899556^EOL999
"KRN",8994,2658,3,15,0)
^^1001363154^EOL999
"KRN",8994,2658,3,16,0)
GROUP 1^^1001371219^EOL999
"KRN",8994,2658,3,17,0)
GROUP 5^MT COPAY EXEMPT^1003900936^EOL999
"KRN",8994,2658,3,18,0)
GROUP 5^NO LONGER REQUIRED^1010000048^EOL999
"KRN",8994,2658,3,19,0)
GROUP 4^^1002039820^EOL999
"KRN",8994,2658,3,20,0)
GROUP 1^^1003907629^EOL999
"KRN",8994,2659,-1)
0^83
"KRN",8994,2659,0)
SPN ICDS/CPTS W RAD COMMENTS^COL^SPNJRPIW^4^A^0^^^^^1
"KRN",8994,2659,1,0)
^^2^2^3060824^
"KRN",8994,2659,1,1,0)
Returns ICD/CPT Codes with Radiology Comments for a given patient based 
"KRN",8994,2659,1,2,0)
on the ICN and a cutoff date.
"KRN",8994,2659,2,0)
^8994.02A^2^2
"KRN",8994,2659,2,1,0)
ICN^1
"KRN",8994,2659,2,1,1,0)
^^1^1^3060824^
"KRN",8994,2659,2,1,1,1,0)
Individual patient's ICN.
"KRN",8994,2659,2,2,0)
SPNCUTDT^1
"KRN",8994,2659,2,2,1,0)
^^1^1^3060824^
"KRN",8994,2659,2,2,1,1,0)
Date to start search from.  
"KRN",8994,2659,2,"B","ICN",1)

"KRN",8994,2659,2,"B","SPNCUTDT",2)

"KRN",8994,2659,3,0)
^^39^39^3060824^
"KRN",8994,2659,3,1,0)
 
"KRN",8994,2659,3,2,0)
Return format:
"KRN",8994,2659,3,3,0)
 
"KRN",8994,2659,3,4,0)
CPTBREAK^EOL999
"KRN",8994,2659,3,5,0)
 
"KRN",8994,2659,3,6,0)
CPT detail level: CPT Description ^ CPT Code ^ Date CPT was entered ^ 
"KRN",8994,2659,3,7,0)
Source file where Procedure code was found ^ Internal number of record in 
"KRN",8994,2659,3,8,0)
source file ^ File and internal number of Radiology comments (if 
"KRN",8994,2659,3,9,0)
applicable) ^ end of line marker
"KRN",8994,2659,3,10,0)
 
"KRN",8994,2659,3,11,0)
Comments level: Type of comment (COM-R=Report, COM-I=Impression, 
"KRN",8994,2659,3,12,0)
COM-H=additional clinical history) ^ Commments ^ end of line marker
"KRN",8994,2659,3,13,0)
 
"KRN",8994,2659,3,14,0)
ICDBREAK^EOL999
"KRN",8994,2659,3,15,0)
 
"KRN",8994,2659,3,16,0)
ICD detail level: ICD Description ^ ICD Code ^ Date/Timestamp ICD was 
"KRN",8994,2659,3,17,0)
entered ^ Source file where Diagnosis code was found ^ Internal number of 
"KRN",8994,2659,3,18,0)
record in source file ^ (null) ^ end of line marker
"KRN",8994,2659,3,19,0)
 
"KRN",8994,2659,3,20,0)
 
"KRN",8994,2659,3,21,0)
Sample of return:
"KRN",8994,2659,3,22,0)
 
"KRN",8994,2659,3,23,0)
CPTBREAK^EOL999
"KRN",8994,2659,3,24,0)
GLYCATED HEMOGLOBIN TEST^83036^AUG 10, 
"KRN",8994,2659,3,25,0)
2004@12:06^AUPNVCPT(^2360582^^EOL999
"KRN",8994,2659,3,26,0)
CHEST X-RAY^71020^APR 23, 2004@09:26^AUPNVCPT(^2237884^^EOL999
"KRN",8994,2659,3,27,0)
CHEST X-RAY^71020^APR 23, 2004@09:26^RADPT^6959576.9073^RARPT 
"KRN",8994,2659,3,28,0)
162561^EOL999
"KRN",8994,2659,3,29,0)
COM-R^CLINICAL HISTORY: Renal cancer. ^EOL999
"KRN",8994,2659,3,30,0)
COM-R^Two views of the chest are submitted. Cardiac and mediastinal 
"KRN",8994,2659,3,31,0)
silhouettes ^EOL999
"KRN",8994,2659,3,32,0)
COM-I^1. Coarsened parenchymal markings, possibly due to emphysema or 
"KRN",8994,2659,3,33,0)
chronic ^EOL999
"KRN",8994,2659,3,34,0)
COM-I^lung disease. Recommend clinical correlation. ^EOL999
"KRN",8994,2659,3,35,0)
ICDBREAK^EOL999
"KRN",8994,2659,3,36,0)
EPIGLOTTIDECTOMY^30.21^FEB 24, 1999@10:09:12^DGPT^29429^^EOL999
"KRN",8994,2659,3,37,0)
HEPATIC DX PROC NEC^50.19^FEB 24, 1999@10:09:12^DGPT^29429^^EOL999
"KRN",8994,2659,3,38,0)
MALIG NEOPL KIDNEY^189.0^FEB 24, 1999@10:09:12^DGPT^29429^^EOL999
"KRN",8994,2659,3,39,0)
HEMATURIA^599.7^SEP 09, 1998@13:20^SCE^828849^^EOL999
"KRN",8994,2660,-1)
0^82
"KRN",8994,2660,0)
SPN GET ADT DATA^COL^SPNJRPPM^4^A^0^^^^^1
"KRN",8994,2660,1,0)
^8994.01^1^1^3060824^^^^
"KRN",8994,2660,1,1,0)
Returns ADT Patient Movement entries for the requested date(s).
"KRN",8994,2660,2,0)
^8994.02A^2^2
"KRN",8994,2660,2,1,0)
ICNLST^1
"KRN",8994,2660,2,1,1,0)
^8994.021^1^1^3060824^^
"KRN",8994,2660,2,1,1,1,0)
List of patient's ICNs (ICN^ICN^ICN^ICN^ICN...)
"KRN",8994,2660,2,2,0)
ACTDATE^1
"KRN",8994,2660,2,2,1,0)
^8994.021^1^1^3060824^^^^
"KRN",8994,2660,2,2,1,1,0)
Date to begin ADT entry search from.
"KRN",8994,2660,2,"B","ACTDATE",2)

"KRN",8994,2660,2,"B","ICNLST",1)

"KRN",8994,2660,3,0)
^^21^21^3060824^
"KRN",8994,2660,3,1,0)
 
"KRN",8994,2660,3,2,0)
Return format:
"KRN",8994,2660,3,3,0)
 
"KRN",8994,2660,3,4,0)
 Patient's ICN ^ Date/timestamp of ADT entry ^ Type of patient movement 
"KRN",8994,2660,3,5,0)
(Admission, Discharge, or Transfer) ^ Transfer Facility (if applicable) ^
"KRN",8994,2660,3,6,0)
Ward location ^ Room-Bed ^ Attending Physician ^ Treating Facility ^
"KRN",8994,2660,3,7,0)
Primary Physician (provider) ^ SCI status ^ Original Admission date (for 
"KRN",8994,2660,3,8,0)
Discharges) ^ End of Line marker
"KRN",8994,2660,3,9,0)
 
"KRN",8994,2660,3,10,0)
 
"KRN",8994,2660,3,11,0)
 
"KRN",8994,2660,3,12,0)
Sample of return:
"KRN",8994,2660,3,13,0)
 
"KRN",8994,2660,3,14,0)
1002061291^MAR 2,2004@08:45:17^ADMISSION^^C 
"KRN",8994,2660,3,15,0)
MEDICINE^333-1^MJDYSNUH,PDAADLZ P^MEDICINE^MJDYSNUH,PDAADLZ P^X = NOT 
"KRN",8994,2660,3,16,0)
APPLICABLE^^EOL999
"KRN",8994,2660,3,17,0)
1002061291^MAR 4,2004@11:30:55^DISCHARGE^^^^^^^X = NOT APPLICABLE^MAR 
"KRN",8994,2660,3,18,0)
2,2004@08:45:17^EOL999
"KRN",8994,2660,3,19,0)
1002061291^MAR 17,2004@08:00:27^ADMISSION^^C 
"KRN",8994,2660,3,20,0)
MEDICINE^334-1^MJDYSNUH,PDAADLZ P^MEDICINE^MJDYSNUH,PDAADLZ P^X = NOT 
"KRN",8994,2660,3,21,0)
APPLICABLE^^EOL999
"KRN",8994,2661,-1)
0^84
"KRN",8994,2661,0)
SPN MAILMAN NOTIFICATION^MAIL^SPNJRPML^1^A^0^^^^^1
"KRN",8994,2661,1,0)
^^2^2^3060824^
"KRN",8994,2661,1,1,0)
Sends admit/discharge/transfer mailman notifications to individual or 
"KRN",8994,2661,1,2,0)
group Mailman email addresses
"KRN",8994,2661,2,0)
^8994.02A^5^5
"KRN",8994,2661,2,1,0)
FROM^1
"KRN",8994,2661,2,1,1,0)
^^1^1^3060824^
"KRN",8994,2661,2,1,1,1,0)
DUZ of the user initiating the notification 
"KRN",8994,2661,2,2,0)
SUBJECT^1
"KRN",8994,2661,2,2,1,0)
^^1^1^3060824^
"KRN",8994,2661,2,2,1,1,0)
Subject of mailman notification
"KRN",8994,2661,2,3,0)
PAR^1
"KRN",8994,2661,2,3,1,0)
^^5^5^3060824^
"KRN",8994,2661,2,3,1,1,0)
Four options, set to 1 if chosen (1^1^1^1):
"KRN",8994,2661,2,3,1,2,0)
                            PIECE 1 - Priority
"KRN",8994,2661,2,3,1,3,0)
                            PIECE 2 - Information only
"KRN",8994,2661,2,3,1,4,0)
                            PIECE 3 - Confirmation required
"KRN",8994,2661,2,3,1,5,0)
                            PIECE 4 - Copy in 'IN' basket
"KRN",8994,2661,2,4,0)
TEXT^2
"KRN",8994,2661,2,4,1,0)
^^2^2^3060824^
"KRN",8994,2661,2,4,1,1,0)
An array format TEXT(1...n) containing the email message in 1 or more 
"KRN",8994,2661,2,4,1,2,0)
lines (limit to 80 chars per line)
"KRN",8994,2661,2,5,0)
MLTO^2
"KRN",8994,2661,2,5,1,0)
^^3^3^3060824^
"KRN",8994,2661,2,5,1,1,0)
An array format MLTO(1...n) containing the recipients of the email in, 
"KRN",8994,2661,2,5,1,2,0)
    and the recipient can be in the form of mail group names and/or 
"KRN",8994,2661,2,5,1,3,0)
    employee names.
"KRN",8994,2661,2,"B","FROM",1)

"KRN",8994,2661,2,"B","MLTO",5)

"KRN",8994,2661,2,"B","PAR",3)

"KRN",8994,2661,2,"B","SUBJECT",2)

"KRN",8994,2661,2,"B","TEXT",4)

"KRN",8994,2661,3,0)
^^6^6^3060824^
"KRN",8994,2661,3,1,0)
 
"KRN",8994,2661,3,2,0)
Data is a single value that determines whether or not the transmission 
"KRN",8994,2661,3,3,0)
was successful:
"KRN",8994,2661,3,4,0)
 
"KRN",8994,2661,3,5,0)
0 - Unsuccessful
"KRN",8994,2661,3,6,0)
1 - Successful
"MBREQ")
0
"ORD",3,19.1)
19.1;3;;;KEY^XPDTA1;KEYF1^XPDIA1;KEYE1^XPDIA1;KEYF2^XPDIA1;;KEYDEL^XPDIA1
"ORD",3,19.1,0)
SECURITY KEY
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",373,-1)
1^1
"PKG",373,0)
SPINAL CORD DYSFUNCTION^SPN^SPINAL CORD DYSFUNCTION, FIELD COMPONENT
"PKG",373,1,0)
^^2^2^2950927^^^^
"PKG",373,1,1,0)
The Spinal Cord Dysfunction package is intended to provide a registry of
"PKG",373,1,2,0)
SCD patients and to track their functional statuses.
"PKG",373,5)
HINES
"PKG",373,7)
^^I
"PKG",373,20,0)
^9.402P^^
"PKG",373,22,0)
^9.49I^1^1
"PKG",373,22,1,0)
3.0^3100914^3081224^35201
"PKG",373,"DEV")
DONATI/HINES
"PKG",373,"VERSION")
3.0
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
80
"RTN","SPNJRP4A")
0^1^B1258600
"RTN","SPNJRP4A",1,0)
SPNJRP4A ;BP/JAS - Returns Clinic Stops ;JUL 28, 2008
"RTN","SPNJRP4A",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNJRP4A",3,0)
 ;
"RTN","SPNJRP4A",4,0)
 ; Reference to ^DIC(40.7,"B" supported by IA# 4929
"RTN","SPNJRP4A",5,0)
 ; Additional references to ^DIC(40.7 supported by IA# 557
"RTN","SPNJRP4A",6,0)
 ;
"RTN","SPNJRP4A",7,0)
 ; Parm values:
"RTN","SPNJRP4A",8,0)
 ;     RETURN is the sorted data based on clinic stop name
"RTN","SPNJRP4A",9,0)
 ;
"RTN","SPNJRP4A",10,0)
 ; Returns: ^TMP($J)
"RTN","SPNJRP4A",11,0)
 ;
"RTN","SPNJRP4A",12,0)
COL(RETURN) ;
"RTN","SPNJRP4A",13,0)
 ;***************************
"RTN","SPNJRP4A",14,0)
 S RETURN=$NA(^TMP($J)),RETCNT=1
"RTN","SPNJRP4A",15,0)
 K ^TMP($J)
"RTN","SPNJRP4A",16,0)
 S CSNAM=""
"RTN","SPNJRP4A",17,0)
 F  S CSNAM=$O(^DIC(40.7,"B",CSNAM)) Q:CSNAM=""  D
"RTN","SPNJRP4A",18,0)
 . ;JAS - 05/14/08 - DEFECT 1090
"RTN","SPNJRP4A",19,0)
 . ;S CSDA=""
"RTN","SPNJRP4A",20,0)
 . S CSDA=0
"RTN","SPNJRP4A",21,0)
 . F  S CSDA=$O(^DIC(40.7,"B",CSNAM,CSDA)) Q:CSDA=""  D
"RTN","SPNJRP4A",22,0)
 . . Q:'$D(^DIC(40.7,CSDA,0))
"RTN","SPNJRP4A",23,0)
 . . S CLNM=$P(^DIC(40.7,CSDA,0),"^",2)
"RTN","SPNJRP4A",24,0)
 . . S STAT="ACTIVE"
"RTN","SPNJRP4A",25,0)
 . . S TERMDT=$P(^DIC(40.7,CSDA,0),"^",3)
"RTN","SPNJRP4A",26,0)
 . . I +TERMDT S STAT="INACTIVE"
"RTN","SPNJRP4A",27,0)
 . . S ^TMP($J,RETCNT)=CSNAM_"^"_CLNM_"^"_STAT_"^EOL999"
"RTN","SPNJRP4A",28,0)
 . . S RETCNT=RETCNT+1
"RTN","SPNJRP4A",29,0)
 K CLNM,CSDA,CSNAM,RETCNT,STAT,TERMDT
"RTN","SPNJRP4A",30,0)
 Q
"RTN","SPNJRPC0")
0^2^B4797467
"RTN","SPNJRPC0",1,0)
SPNJRPC0 ;BP/JAS - Returns list of ICD/CPT LONG DESCRIPTIONS ;JUN 16, 2009
"RTN","SPNJRPC0",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNJRPC0",3,0)
 ;
"RTN","SPNJRPC0",4,0)
 ; References to ^ICD9 supported by IA# 5388
"RTN","SPNJRPC0",5,0)
 ; Reference to API ICDDX^ICDCODE supported by IA# 3990
"RTN","SPNJRPC0",6,0)
 ; Reference to API ICDD^ICDCODE supported by IA# 3990
"RTN","SPNJRPC0",7,0)
 ; References to ^ICPT supported by IA# 2815
"RTN","SPNJRPC0",8,0)
 ; Reference to API CPTD^ICPTCOD supported by IA# 1995
"RTN","SPNJRPC0",9,0)
 ;
"RTN","SPNJRPC0",10,0)
 ; Parm values:
"RTN","SPNJRPC0",11,0)
 ;       TYPE will be either ICD or CPT.
"RTN","SPNJRPC0",12,0)
 ;
"RTN","SPNJRPC0",13,0)
 ; Returns: ^TMP($J)
"RTN","SPNJRPC0",14,0)
 ;
"RTN","SPNJRPC0",15,0)
COL(RETURN,TYPE) ;
"RTN","SPNJRPC0",16,0)
 ;
"RTN","SPNJRPC0",17,0)
 K ^TMP($J)
"RTN","SPNJRPC0",18,0)
 S RETURN=$NA(^TMP($J)),RETCNT=1
"RTN","SPNJRPC0",19,0)
 I TYPE="CPT" D CPT
"RTN","SPNJRPC0",20,0)
 I TYPE="ICD" D ICD
"RTN","SPNJRPC0",21,0)
 K CODE,IEN,LINE,RETCNT,TXT,DIAG
"RTN","SPNJRPC0",22,0)
 Q
"RTN","SPNJRPC0",23,0)
 ;
"RTN","SPNJRPC0",24,0)
 ;
"RTN","SPNJRPC0",25,0)
ICD ;
"RTN","SPNJRPC0",26,0)
 S CODE=""
"RTN","SPNJRPC0",27,0)
 F  S CODE=$O(^ICD9("AB",CODE)) Q:CODE=""  D
"RTN","SPNJRPC0",28,0)
 . ;JAS - 05/14/08 - DEFECT 1090
"RTN","SPNJRPC0",29,0)
 . ;S IEN="",IEN=$O(^ICD9("AB",CODE,IEN))
"RTN","SPNJRPC0",30,0)
 . ;JAS 6/16/09 - DEFECT 1137 - Removed direct reads of CPT/ICD files to API usage
"RTN","SPNJRPC0",31,0)
 . ;S IEN=0,IEN=$O(^ICD9("AB",CODE,IEN))
"RTN","SPNJRPC0",32,0)
 . ;Q:IEN=""
"RTN","SPNJRPC0",33,0)
 . ;S DIAG=$P($G(^ICD9(IEN,0)),"^",3)
"RTN","SPNJRPC0",34,0)
 . S SPNYAPI=$$ICDDX^ICDCODE(CODE,"","","")
"RTN","SPNJRPC0",35,0)
 . Q:$P(SPNYAPI,"^")=-1
"RTN","SPNJRPC0",36,0)
 . S DIAG=$P(SPNYAPI,"^",4)
"RTN","SPNJRPC0",37,0)
 . ;S TXT=$G(^ICD9(IEN,1))
"RTN","SPNJRPC0",38,0)
 . ;I TXT="" S TXT="No description on file"
"RTN","SPNJRPC0",39,0)
 . S ICDD=$$ICDD^ICDCODE(CODE,"SPNARY","")
"RTN","SPNJRPC0",40,0)
 . I SPNARY(1)="" S TXT="No description on file"
"RTN","SPNJRPC0",41,0)
 . S TXT=SPNARY(1)
"RTN","SPNJRPC0",42,0)
 . S ^TMP($J,RETCNT)=CODE_"^"_TXT_"^"_DIAG_"^EOL999"
"RTN","SPNJRPC0",43,0)
 . S RETCNT=RETCNT+1
"RTN","SPNJRPC0",44,0)
 K SPNYAPI,ICDD,SPNARY
"RTN","SPNJRPC0",45,0)
 Q
"RTN","SPNJRPC0",46,0)
CPT ;
"RTN","SPNJRPC0",47,0)
 ;JAS - 05/14/08 - DEFECT 1090
"RTN","SPNJRPC0",48,0)
 ;S CODE=""
"RTN","SPNJRPC0",49,0)
 S CODE=0
"RTN","SPNJRPC0",50,0)
 F  S CODE=$O(^ICPT("B",CODE)) Q:CODE=""  D
"RTN","SPNJRPC0",51,0)
 . S ^TMP($J,RETCNT)="CPT999^"_CODE_"^EOL999",RETCNT=RETCNT+1
"RTN","SPNJRPC0",52,0)
 . D CPTD^ICPTCOD(CODE,"SPNARRAY")
"RTN","SPNJRPC0",53,0)
 . I '$D(SPNARRAY) D  Q
"RTN","SPNJRPC0",54,0)
 . . S ^TMP($J,RETCNT)="No description on file^EOL999"
"RTN","SPNJRPC0",55,0)
 . . S RETCNT=RETCNT+1
"RTN","SPNJRPC0",56,0)
 . S LINE=""
"RTN","SPNJRPC0",57,0)
 . F  S LINE=$O(SPNARRAY(LINE)) Q:LINE=""  D
"RTN","SPNJRPC0",58,0)
 . . S TXT=SPNARRAY(LINE)
"RTN","SPNJRPC0",59,0)
 . . Q:TXT=""!(TXT=" ")
"RTN","SPNJRPC0",60,0)
 . . S ^TMP($J,RETCNT)=TXT_"^EOL999"
"RTN","SPNJRPC0",61,0)
 . . S RETCNT=RETCNT+1
"RTN","SPNJRPC0",62,0)
 . . Q
"RTN","SPNJRPC0",63,0)
 . K SPNARRAY
"RTN","SPNJRPC0",64,0)
 Q
"RTN","SPNJRPC1")
0^3^B25695639
"RTN","SPNJRPC1",1,0)
SPNJRPC1 ;BP/JAS - Returns list of patients with their date last seen ;JUL 22, 2008
"RTN","SPNJRPC1",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNJRPC1",3,0)
 ;
"RTN","SPNJRPC1",4,0)
 ; Reference to ^DPT(D0,"LR" supported by IA #998
"RTN","SPNJRPC1",5,0)
 ; References to file #45 supported by IA #92
"RTN","SPNJRPC1",6,0)
 ; Reference to ^LR(D0,"CH" supported by IA #554
"RTN","SPNJRPC1",7,0)
 ; Reference to ^PS(55,D0,"P","A" supported by IA #552
"RTN","SPNJRPC1",8,0)
 ; Reference to ^RADPT(D0,"DT" supported by IA #3125
"RTN","SPNJRPC1",9,0)
 ; Reference to API DEM^VADPT supported by IA #10061
"RTN","SPNJRPC1",10,0)
 ; Reference to API SDA^VADPT supported by IA #10061
"RTN","SPNJRPC1",11,0)
 ; Reference to API RX^PSO52API supported by IA #4820
"RTN","SPNJRPC1",12,0)
 ; Reference to API $$FMTE^XLFDT supported by IA #10103
"RTN","SPNJRPC1",13,0)
 ; API $$DATEMATH^SPNLRUDT is part of Spinal Cord Version 2.0
"RTN","SPNJRPC1",14,0)
 ; API $$FLIP^SPNRPCIC is part of Spinal Cord Version 3.0
"RTN","SPNJRPC1",15,0)
 ;
"RTN","SPNJRPC1",16,0)
 ; Parm values:
"RTN","SPNJRPC1",17,0)
 ;     ICNLST is the list of patient ICNs to process
"RTN","SPNJRPC1",18,0)
 ;     CUTDATE: is the earliest date to search to for services 
"RTN","SPNJRPC1",19,0)
 ;     RETURN: is the sorted data from the earliest date of listing
"RTN","SPNJRPC1",20,0)
 ;     DAYS: is the range of days that a patient hasn't been seen
"RTN","SPNJRPC1",21,0)
 ;
"RTN","SPNJRPC1",22,0)
 ; ^TMP($J) returns:
"RTN","SPNJRPC1",23,0)
 ;     LAST SEEN DATE ^ PATIENT NAME ^ SSN(LAST FOUR) ^ EOL999
"RTN","SPNJRPC1",24,0)
 ;
"RTN","SPNJRPC1",25,0)
COL(RETURN,ICNLST,DAYS) ;
"RTN","SPNJRPC1",26,0)
 ;***************************
"RTN","SPNJRPC1",27,0)
 K ^TMP($J),^UTILITY("VASD",$J)
"RTN","SPNJRPC1",28,0)
 S RETURN=$NA(^TMP($J))
"RTN","SPNJRPC1",29,0)
 S DAYS=DAYS_"D"
"RTN","SPNJRPC1",30,0)
 S SINCE=$$DATEMATH^SPNLRUDT(DT,"-"_DAYS)
"RTN","SPNJRPC1",31,0)
 S YRS="6Y"
"RTN","SPNJRPC1",32,0)
 S CUTDATE=$$DATEMATH^SPNLRUDT(DT,"-"_YRS)
"RTN","SPNJRPC1",33,0)
 ;***************************
"RTN","SPNJRPC1",34,0)
 S ICNNM=""
"RTN","SPNJRPC1",35,0)
 F  S ICNNM=$O(ICNLST(ICNNM)) Q:ICNNM=""  D
"RTN","SPNJRPC1",36,0)
 . S ICN=ICNLST(ICNNM) D IN
"RTN","SPNJRPC1",37,0)
 D CLNUP
"RTN","SPNJRPC1",38,0)
 Q
"RTN","SPNJRPC1",39,0)
IN Q:$G(ICN)=""
"RTN","SPNJRPC1",40,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNJRPC1",41,0)
 Q:$G(DFN)=""
"RTN","SPNJRPC1",42,0)
 ;***************************
"RTN","SPNJRPC1",43,0)
 D DEM^VADPT
"RTN","SPNJRPC1",44,0)
 S NAME=VADM(1),SSNLAST4=VA("BID")
"RTN","SPNJRPC1",45,0)
 D SEEN(DFN,CUTDATE,DT,.SEEN,.LASTSEEN)
"RTN","SPNJRPC1",46,0)
 S LASTDTE=$$FMTE^XLFDT(LASTSEEN,"5DZP")
"RTN","SPNJRPC1",47,0)
 I LASTDTE=0 S LASTDTE="**Not Seen in 6 Years**"
"RTN","SPNJRPC1",48,0)
 I LASTSEEN<CUTDATE S LASTDTE="**Not Seen in 6 Years**"
"RTN","SPNJRPC1",49,0)
 I LASTSEEN<SINCE S ^TMP($J,NAME,ICNNM)=LASTDTE_"^"_NAME_"^"_SSNLAST4_"^EOL999"
"RTN","SPNJRPC1",50,0)
 Q
"RTN","SPNJRPC1",51,0)
 ;;;
"RTN","SPNJRPC1",52,0)
SEEN(DFN,FDATE,TDATE,SEEN,LASTSEEN)  ;
"RTN","SPNJRPC1",53,0)
 ; DFN       Patient's internal entry number in the Patient file
"RTN","SPNJRPC1",54,0)
 ; FDATE     "From" date
"RTN","SPNJRPC1",55,0)
 ; TDATE     "Thru" date, default=today
"RTN","SPNJRPC1",56,0)
 ; During the time period FDATE thru TDATE,
"RTN","SPNJRPC1",57,0)
 ; SEEN      (1/0) patient was (not) seen
"RTN","SPNJRPC1",58,0)
 ; LASTSEEN  Date patient was last seen
"RTN","SPNJRPC1",59,0)
 ; SEENIP    (1/0) patient was (not) seen as an inpatient
"RTN","SPNJRPC1",60,0)
 ; SEENOP    (1/0) patient was (not) seen as an outpatient 
"RTN","SPNJRPC1",61,0)
 ; SEENCH    (1/0) patient was (not) seen for a lab test
"RTN","SPNJRPC1",62,0)
 ; SEENRX    (1/0) patient was (not) seen in pharmacy
"RTN","SPNJRPC1",63,0)
 ; SEENRA    (1/0) patient was (not) seen in radiology
"RTN","SPNJRPC1",64,0)
 N LASTIP,LASTOP,LASTCH,LASTRX,LASTRA
"RTN","SPNJRPC1",65,0)
 I '$D(TDATE) S TDATE=DT
"RTN","SPNJRPC1",66,0)
 S LASTSEEN=0
"RTN","SPNJRPC1",67,0)
 D IP(.SEENIP,.LASTIP)
"RTN","SPNJRPC1",68,0)
 I SEENIP,(LASTIP>LASTSEEN) S LASTSEEN=LASTIP
"RTN","SPNJRPC1",69,0)
 D OP(.SEENOP,.LASTOP)
"RTN","SPNJRPC1",70,0)
 I SEENOP,(LASTOP>LASTSEEN) S LASTSEEN=LASTOP
"RTN","SPNJRPC1",71,0)
 D CH(.SEENCH,.LASTCH)
"RTN","SPNJRPC1",72,0)
 I SEENCH,(LASTCH>LASTSEEN) S LASTSEEN=LASTCH
"RTN","SPNJRPC1",73,0)
 D RX(.SEENRX,.LASTRX)
"RTN","SPNJRPC1",74,0)
 I SEENRX,(LASTRX>LASTSEEN) S LASTSEEN=LASTRX
"RTN","SPNJRPC1",75,0)
 D RA(.SEENRA,.LASTRA)
"RTN","SPNJRPC1",76,0)
 I SEENRA,(LASTRA>LASTSEEN) S LASTSEEN=LASTRA
"RTN","SPNJRPC1",77,0)
 S SEEN=(SEENIP)!(SEENOP)!(SEENCH)!(SEENRX)!(SEENRA)
"RTN","SPNJRPC1",78,0)
 Q
"RTN","SPNJRPC1",79,0)
IP(SEEN,LASTSEEN) ;
"RTN","SPNJRPC1",80,0)
 N RECNR,RTYP,ZDD,ZAD
"RTN","SPNJRPC1",81,0)
 S LASTSEEN=0
"RTN","SPNJRPC1",82,0)
 ; We will take all admissions which overlap the desired range, and adjust
"RTN","SPNJRPC1",83,0)
 ; the admit and/or discharge dates to conform with the desired range.
"RTN","SPNJRPC1",84,0)
 S RECNR=0 ; for each inpatient record
"RTN","SPNJRPC1",85,0)
 F  S RECNR=$O(^DGPT("B",DFN,RECNR)) Q:RECNR=""  D
"RTN","SPNJRPC1",86,0)
 . S RTYP=$$GET1^DIQ(45,RECNR_",",11,"I")
"RTN","SPNJRPC1",87,0)
 . Q:RTYP'=1   ; 1=PTF record, 2=census record
"RTN","SPNJRPC1",88,0)
 . S ZDD=$$GET1^DIQ(45,RECNR_",",70,"I")\1   ; Discharge date
"RTN","SPNJRPC1",89,0)
 . Q:ZDD'=0&(ZDD<FDATE)
"RTN","SPNJRPC1",90,0)
 . S ZAD=$$GET1^DIQ(45,RECNR_",",2,"I")\1   ; Admit date
"RTN","SPNJRPC1",91,0)
 . Q:ZAD>TDATE
"RTN","SPNJRPC1",92,0)
 . S LASTSEEN=$S(ZDD>TDATE:TDATE,ZDD=0:TDATE,1:ZDD)
"RTN","SPNJRPC1",93,0)
 S SEEN=$S(LASTSEEN=0:0,1:1)
"RTN","SPNJRPC1",94,0)
 Q
"RTN","SPNJRPC1",95,0)
OP(SEEN,LASTSEEN) ;
"RTN","SPNJRPC1",96,0)
 N VASD,APPT,LASTAPPT
"RTN","SPNJRPC1",97,0)
 S VASD("F")=FDATE,VASD("T")=TDATE D SDA^VADPT
"RTN","SPNJRPC1",98,0)
 S (APPT,LASTAPPT)=0
"RTN","SPNJRPC1",99,0)
 F  S APPT=$O(^UTILITY("VASD",$J,APPT)) Q:APPT=""  D
"RTN","SPNJRPC1",100,0)
 . S LASTAPPT=APPT
"RTN","SPNJRPC1",101,0)
 I LASTAPPT=0 D
"RTN","SPNJRPC1",102,0)
 . S (SEEN,LASTSEEN)=0
"RTN","SPNJRPC1",103,0)
 E  D
"RTN","SPNJRPC1",104,0)
 . S LASTSEEN=+^UTILITY("VASD",$J,LASTAPPT,"I")\1
"RTN","SPNJRPC1",105,0)
 . S SEEN=1
"RTN","SPNJRPC1",106,0)
 Q
"RTN","SPNJRPC1",107,0)
CH(SEEN,LASTSEEN) ;
"RTN","SPNJRPC1",108,0)
 N LFN,LASTDATE,TESTDATE
"RTN","SPNJRPC1",109,0)
 S (SEEN,LASTSEEN)=0
"RTN","SPNJRPC1",110,0)
 S LFN=+$P($G(^DPT(DFN,"LR")),U,1)
"RTN","SPNJRPC1",111,0)
 Q:'LFN
"RTN","SPNJRPC1",112,0)
 S LASTDATE=9999999-FDATE
"RTN","SPNJRPC1",113,0)
 S TESTDATE=9999999-(TDATE+1)
"RTN","SPNJRPC1",114,0)
 S TESTDATE=$O(^LR(LFN,"CH",TESTDATE))
"RTN","SPNJRPC1",115,0)
 Q:TESTDATE'>0!(TESTDATE>LASTDATE)
"RTN","SPNJRPC1",116,0)
 S LASTSEEN=9999999-TESTDATE\1
"RTN","SPNJRPC1",117,0)
 S SEEN=1
"RTN","SPNJRPC1",118,0)
 Q
"RTN","SPNJRPC1",119,0)
RX(SEEN,LASTSEEN) ;
"RTN","SPNJRPC1",120,0)
 N EXPDATE,RECNR,FILLDATE,SUBRECNR
"RTN","SPNJRPC1",121,0)
 S LASTSEEN=0
"RTN","SPNJRPC1",122,0)
 S EXPDATE=FDATE-.000001 ; For each expiration date
"RTN","SPNJRPC1",123,0)
 F  S EXPDATE=$O(^PS(55,DFN,"P","A",EXPDATE)) Q:EXPDATE'>0  D
"RTN","SPNJRPC1",124,0)
 . S RECNR=0 ; For each prescription on that date
"RTN","SPNJRPC1",125,0)
 . F  S RECNR=$O(^PS(55,DFN,"P","A",EXPDATE,RECNR)) Q:RECNR'>0  D
"RTN","SPNJRPC1",126,0)
 . . D RX^PSO52API(DFN,"PSRX",RECNR)
"RTN","SPNJRPC1",127,0)
 . . S FILLDATE=$P(^TMP($J,"PSRX",DFN,RECNR,22),"^",1)
"RTN","SPNJRPC1",128,0)
 . . Q:FILLDATE=""
"RTN","SPNJRPC1",129,0)
 . . Q:FILLDATE>TDATE
"RTN","SPNJRPC1",130,0)
 . . S:FILLDATE'<FDATE LASTSEEN=FILLDATE ; original fill
"RTN","SPNJRPC1",131,0)
 . . S SUBRECNR=0 ; For each refill
"RTN","SPNJRPC1",132,0)
 . . F  S SUBRECNR=$O(^TMP($J,"PSRX",DFN,RECNR,"RF",SUBRECNR)) Q:SUBRECNR=""  D  Q:FILLDATE>TDATE
"RTN","SPNJRPC1",133,0)
 . . . S FILLDATE=$P(^TMP($J,"PSRX",DFN,RECNR,"RF",SUBRECNR,.01),"^",1)
"RTN","SPNJRPC1",134,0)
 . . . Q:FILLDATE<FDATE!(FILLDATE>TDATE)
"RTN","SPNJRPC1",135,0)
 . . . S:FILLDATE>LASTSEEN LASTSEEN=FILLDATE
"RTN","SPNJRPC1",136,0)
 . . K ^TMP($J,"PSRX")
"RTN","SPNJRPC1",137,0)
 S SEEN=$S(LASTSEEN=0:0,1:1)
"RTN","SPNJRPC1",138,0)
 Q
"RTN","SPNJRPC1",139,0)
RA(SEEN,LASTSEEN) ;
"RTN","SPNJRPC1",140,0)
 N LASTDATE,EXAMDATE
"RTN","SPNJRPC1",141,0)
 S (SEEN,LASTSEEN)=0
"RTN","SPNJRPC1",142,0)
 S LASTDATE=9999999.9999-FDATE
"RTN","SPNJRPC1",143,0)
 S EXAMDATE=9999999.9999-(TDATE+1)
"RTN","SPNJRPC1",144,0)
 S EXAMDATE=$O(^RADPT(DFN,"DT",EXAMDATE))
"RTN","SPNJRPC1",145,0)
 Q:EXAMDATE'>0!(EXAMDATE>LASTDATE)
"RTN","SPNJRPC1",146,0)
 S LASTSEEN=9999999.9999-EXAMDATE\1
"RTN","SPNJRPC1",147,0)
 S SEEN=1
"RTN","SPNJRPC1",148,0)
 Q
"RTN","SPNJRPC1",149,0)
CLNUP ;
"RTN","SPNJRPC1",150,0)
 K AICN,CUTDATE,I,ICN,ICNNM,LASTDTE,NAME,PATLIST,PATSTR
"RTN","SPNJRPC1",151,0)
 K SEENCH,SEENIP,SEENOP,SEENRA,SEENRX,SINCE,SPN,SSNLAST4
"RTN","SPNJRPC1",152,0)
 K VA,VADM,YRS
"RTN","SPNJRPC1",153,0)
 Q
"RTN","SPNJRPC2")
0^4^B8549659
"RTN","SPNJRPC2",1,0)
SPNJRPC2 ;BP/JAS - Returns list of patients with future appointments ;JUL 17, 2008 
"RTN","SPNJRPC2",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNJRPC2",3,0)
 ;
"RTN","SPNJRPC2",4,0)
 ; Reference to ^DPT(D0,57 supported by IA #4938
"RTN","SPNJRPC2",5,0)
 ; Reference to API DEM^VADPT supported by IA #10061
"RTN","SPNJRPC2",6,0)
 ; Reference to API $$SDAPI^SDAMA301 supported by IA #4433
"RTN","SPNJRPC2",7,0)
 ; API $$FLIP^SPNRPCIC is part of Spinal Cord Version 3.0
"RTN","SPNJRPC2",8,0)
 ;
"RTN","SPNJRPC2",9,0)
 ; Parm values:
"RTN","SPNJRPC2",10,0)
 ;     ICNLST is the list of patient ICNs to process
"RTN","SPNJRPC2",11,0)
 ;     SPNSEL determines which patients to search:
"RTN","SPNJRPC2",12,0)
 ;           1 - ICNLST ONLY
"RTN","SPNJRPC2",13,0)
 ;           2 - ONLY VISTA PATS WITH SCD INDICATOR
"RTN","SPNJRPC2",14,0)
 ;           3 - BOTH
"RTN","SPNJRPC2",15,0)
 ;
"RTN","SPNJRPC2",16,0)
 ;RETURN returns:
"RTN","SPNJRPC2",17,0)
 ;     APPT DATE ^ APPT TIME ^ CLINIC ^ PATIENT NAME ^ 
"RTN","SPNJRPC2",18,0)
 ;     SSN(LAST FOUR) ^ ICN ^ EOL999
"RTN","SPNJRPC2",19,0)
 ;
"RTN","SPNJRPC2",20,0)
COL(RETURN,ICNLST,SPNSEL,SPNSTRT,SPNEND) ;
"RTN","SPNJRPC2",21,0)
 ;***************************
"RTN","SPNJRPC2",22,0)
 S RETURN=$NA(^TMP($J))
"RTN","SPNJRPC2",23,0)
 S RETCNT=0
"RTN","SPNJRPC2",24,0)
 S X=SPNSTRT S %DT="T" D ^%DT S SPNSTRT=Y
"RTN","SPNJRPC2",25,0)
 S X=SPNEND S %DT="T" D ^%DT S SPNEND=Y
"RTN","SPNJRPC2",26,0)
 I SPNSTRT=""!(SPNSTRT=-1) S SPNSTRT=DT
"RTN","SPNJRPC2",27,0)
 I SPNEND=""!(SPNEND=-1) S SPNEND=DT+20000.2359
"RTN","SPNJRPC2",28,0)
 K ^TMP($J)
"RTN","SPNJRPC2",29,0)
 I SPNSEL=1!(SPNSEL=3) D ONE
"RTN","SPNJRPC2",30,0)
 I SPNSEL=2!(SPNSEL=3) D TWO
"RTN","SPNJRPC2",31,0)
 D CLNUP
"RTN","SPNJRPC2",32,0)
 Q
"RTN","SPNJRPC2",33,0)
ONE F ICNNM=1:1:$L(ICNLST,"^") S ICN=$P(ICNLST,"^",ICNNM) D
"RTN","SPNJRPC2",34,0)
 . Q:$G(ICN)=""
"RTN","SPNJRPC2",35,0)
 . S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNJRPC2",36,0)
 . Q:$G(DFN)=""
"RTN","SPNJRPC2",37,0)
 . D DEM^VADPT
"RTN","SPNJRPC2",38,0)
 . S NAME=VADM(1),SSNLAST4=VA("BID")
"RTN","SPNJRPC2",39,0)
 . S SPNDFN=DFN
"RTN","SPNJRPC2",40,0)
 . D APPT
"RTN","SPNJRPC2",41,0)
 Q
"RTN","SPNJRPC2",42,0)
TWO ;
"RTN","SPNJRPC2",43,0)
 S SPNDFN=0 F  S SPNDFN=$O(^DPT(SPNDFN)) Q:(SPNDFN="")!('+SPNDFN)  D
"RTN","SPNJRPC2",44,0)
 . S SPNCHK=$P($G(^DPT(SPNDFN,57)),U,4) I +SPNCHK D
"RTN","SPNJRPC2",45,0)
 . . I $D(^DPT(SPNDFN,"MPI")) S ICNCK=$P(^DPT(SPNDFN,"MPI"),"^",1)
"RTN","SPNJRPC2",46,0)
 . . I $G(ICNCK)'="",ICNLST[ICNCK Q
"RTN","SPNJRPC2",47,0)
 . . S DFN=SPNDFN D DEM^VADPT
"RTN","SPNJRPC2",48,0)
 . . S NAME=VADM(1),SSNLAST4=VA("BID")
"RTN","SPNJRPC2",49,0)
 . . D APPT
"RTN","SPNJRPC2",50,0)
 Q
"RTN","SPNJRPC2",51,0)
APPT ;
"RTN","SPNJRPC2",52,0)
 S SDARRAY(1)=SPNSTRT_";"_SPNEND
"RTN","SPNJRPC2",53,0)
 S SDARRAY(3)="R"
"RTN","SPNJRPC2",54,0)
 S SDARRAY(4)=SPNDFN
"RTN","SPNJRPC2",55,0)
 S SDARRAY("FLDS")="1;2"
"RTN","SPNJRPC2",56,0)
 S SDCOUNT=$$SDAPI^SDAMA301(.SDARRAY)
"RTN","SPNJRPC2",57,0)
 I SDCOUNT>0 D
"RTN","SPNJRPC2",58,0)
 .S SDCLIEN=0 F  S SDCLIEN=$O(^TMP($J,"SDAMA301",SPNDFN,SDCLIEN)) Q:'+SDCLIEN  D
"RTN","SPNJRPC2",59,0)
 ..S SDDATE=0 F  S SDDATE=$O(^TMP($J,"SDAMA301",SPNDFN,SDCLIEN,SDDATE)) Q:'+SDDATE  D
"RTN","SPNJRPC2",60,0)
 ...S SDAPPT=$G(^TMP($J,"SDAMA301",SPNDFN,SDCLIEN,SDDATE))
"RTN","SPNJRPC2",61,0)
 ...S SPNAPPT=$P($G(^TMP($J,"SDAMA301",SPNDFN,SDCLIEN,SDDATE)),U,1)
"RTN","SPNJRPC2",62,0)
 ...S SPNCL=$P(SDAPPT,U,2) S SPNCL=$P(SPNCL,";",2)
"RTN","SPNJRPC2",63,0)
 ...S SPNICN=$P($G(^DPT(SPNDFN,"MPI")),"^",1)
"RTN","SPNJRPC2",64,0)
 ...D SETRT
"RTN","SPNJRPC2",65,0)
 K ^TMP($J,"SDAMA301")
"RTN","SPNJRPC2",66,0)
 Q
"RTN","SPNJRPC2",67,0)
SETRT ;
"RTN","SPNJRPC2",68,0)
 S Y=SPNAPPT X ^DD("DD") S RETDATE=$P(Y,"@"),RETTIME=$P(Y,"@",2)
"RTN","SPNJRPC2",69,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPC2",70,0)
 S ^TMP($J,SDDATE,RETCNT)=RETDATE_"^"_RETTIME_"^"_SPNCL_"^"_NAME_"^"_SSNLAST4_"^"_SPNICN_"^"_"EOL999"
"RTN","SPNJRPC2",71,0)
 Q
"RTN","SPNJRPC2",72,0)
CLNUP ;
"RTN","SPNJRPC2",73,0)
 K %DT,AICN,DFN,ICN,ICNCK,ICNNM,NAME,PATLIST,RETCNT,RETDATE,RETTIME
"RTN","SPNJRPC2",74,0)
 K SDAPPT,SDARRAY,SDCLIEN,SDCOUNT,SDDATE,SPN,SPNAPPT,SPNCHK,SPNCL
"RTN","SPNJRPC2",75,0)
 K SPNDFN,SPNICN,SSNLAST4,VA,VADM,X,Y
"RTN","SPNJRPC2",76,0)
 Q
"RTN","SPNJRPC3")
0^5^B53506814
"RTN","SPNJRPC3",1,0)
SPNJRPC3 ;BP/JAS - Returns Inpatient/Outpatient Activity for list of pats ;JUL 28, 2008
"RTN","SPNJRPC3",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNJRPC3",3,0)
 ;
"RTN","SPNJRPC3",4,0)
 ; Reference to API DEM^VADPT supported by IA #10061
"RTN","SPNJRPC3",5,0)
 ; API $$FLIP^SPNRPCIC is part of Spinal Cord Version 3.0
"RTN","SPNJRPC3",6,0)
 ; API GETNAME^SPNLRU is part of Spinal Cord version 2.0
"RTN","SPNJRPC3",7,0)
 ; API ROLLUP^SPNLGROP is part of Spinal Cord version 2.0
"RTN","SPNJRPC3",8,0)
 ; API ROLLUP^SPNLGRIP is part of Spinal Cord version 2.0
"RTN","SPNJRPC3",9,0)
 ; API NAMEIT^SPNLGROP is part of Spinal Cord version 2.0
"RTN","SPNJRPC3",10,0)
 ; API NAMEIT^SPNLGRIP is part of Spinal Cord version 2.0
"RTN","SPNJRPC3",11,0)
 ;
"RTN","SPNJRPC3",12,0)
 ; Parm values:
"RTN","SPNJRPC3",13,0)
 ;     RETURN is the sorted data from the earliest date of listing
"RTN","SPNJRPC3",14,0)
 ;     ICNLST is the list of patient ICNs to process
"RTN","SPNJRPC3",15,0)
 ;     FDATE is the start date for period
"RTN","SPNJRPC3",16,0)
 ;     TDATE is the end date for period
"RTN","SPNJRPC3",17,0)
 ;     HIUSERS is the number of highest users to identify
"RTN","SPNJRPC3",18,0)
 ;
"RTN","SPNJRPC3",19,0)
 ; Returns: ^TMP($J)
"RTN","SPNJRPC3",20,0)
 ;
"RTN","SPNJRPC3",21,0)
COL(RETURN,ICNLST,FDATE,TDATE,HIUSERS) ;
"RTN","SPNJRPC3",22,0)
 ;***************************
"RTN","SPNJRPC3",23,0)
 S RETURN=$NA(^TMP($J)),RETCNT=1
"RTN","SPNJRPC3",24,0)
 S X=FDATE S %DT="T" D ^%DT S FDATE=Y
"RTN","SPNJRPC3",25,0)
 S X=TDATE S %DT="T" D ^%DT S TDATE=Y
"RTN","SPNJRPC3",26,0)
 ;***************************
"RTN","SPNJRPC3",27,0)
 K ^TMP($J),^TMP("SPN",$J)
"RTN","SPNJRPC3",28,0)
 F ICNNM=1:1:$L(ICNLST,"^") S ICN=$P(ICNLST,"^",ICNNM) D IN
"RTN","SPNJRPC3",29,0)
 D OUTPAT,INPAT
"RTN","SPNJRPC3",30,0)
 K %DT,AICN,DFN,ICN,ICNNM,PATLIST,RETCNT,SPN,X,Y
"RTN","SPNJRPC3",31,0)
 Q
"RTN","SPNJRPC3",32,0)
IN Q:$G(ICN)=""
"RTN","SPNJRPC3",33,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNJRPC3",34,0)
 Q:$G(DFN)=""
"RTN","SPNJRPC3",35,0)
 ;***************************
"RTN","SPNJRPC3",36,0)
 D DEM^VADPT
"RTN","SPNJRPC3",37,0)
 D ROLLUP^SPNLGROP(DFN,FDATE,TDATE,HIUSERS)
"RTN","SPNJRPC3",38,0)
 D ROLLUP^SPNLGRIP(DFN,FDATE,TDATE,HIUSERS)
"RTN","SPNJRPC3",39,0)
 D NAMEIT^SPNLGRIP
"RTN","SPNJRPC3",40,0)
 D NAMEIT^SPNLGROP
"RTN","SPNJRPC3",41,0)
 Q
"RTN","SPNJRPC3",42,0)
OUTPAT ;
"RTN","SPNJRPC3",43,0)
 D POP1,POP2
"RTN","SPNJRPC3",44,0)
 D:HIUSERS POP3
"RTN","SPNJRPC3",45,0)
 Q
"RTN","SPNJRPC3",46,0)
POP1 ;
"RTN","SPNJRPC3",47,0)
 ; VISITS    Number of visits
"RTN","SPNJRPC3",48,0)
 N VISITS,OUT,LINE,STARTLIN,COL,STOPS,NPATS
"RTN","SPNJRPC3",49,0)
 S NPATS=+$G(^TMP("SPN",$J,"OP","PAT"))
"RTN","SPNJRPC3",50,0)
 S VISITS=+$G(^TMP("SPN",$J,"OP","VISITS"))
"RTN","SPNJRPC3",51,0)
 S STOPS=+$G(^TMP("SPN",$J,"OP","STOPS"))
"RTN","SPNJRPC3",52,0)
 S ^TMP($J,RETCNT)="PAT999^Outpatient Activity^EOL999"
"RTN","SPNJRPC3",53,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPC3",54,0)
 S ^TMP($J,RETCNT)="BOS999^Totals:  "_$FN(NPATS,",")_" patient"_$S(NPATS=1:"",1:"s")_" for "_$FN(VISITS,",")_" visit"_$S(VISITS=1:"",1:"s")_" ("_$FN(STOPS,",")_" stop"_$S(STOPS=1:"",1:"s")_")^EOL999"
"RTN","SPNJRPC3",55,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPC3",56,0)
 S VISITS=+$O(^TMP("SPN",$J,"OP","VISITS",""))
"RTN","SPNJRPC3",57,0)
 F  D  Q:VISITS=""
"RTN","SPNJRPC3",58,0)
 . S STARTLIN=1
"RTN","SPNJRPC3",59,0)
 . F COL=1:1:3 D  Q:VISITS=""
"RTN","SPNJRPC3",60,0)
 . . S OUT(STARTLIN)=$G(OUT(STARTLIN))_"HDR999^Patients^Visits^EOL999"
"RTN","SPNJRPC3",61,0)
 . . F LINE=STARTLIN+2:1 D  Q:VISITS=""
"RTN","SPNJRPC3",62,0)
 . . . S OUT(LINE)=$G(OUT(LINE))_$G(^TMP("SPN",$J,"OP","VISITS",VISITS))_"^"_-VISITS_"^EOL999"
"RTN","SPNJRPC3",63,0)
 . . . S VISITS=$O(^TMP("SPN",$J,"OP","VISITS",VISITS))
"RTN","SPNJRPC3",64,0)
 . S LINE=""
"RTN","SPNJRPC3",65,0)
 . F  S LINE=$O(OUT(LINE)) Q:LINE=""  D
"RTN","SPNJRPC3",66,0)
 . . S ^TMP($J,RETCNT)=OUT(LINE)
"RTN","SPNJRPC3",67,0)
 . . S RETCNT=RETCNT+1
"RTN","SPNJRPC3",68,0)
 Q
"RTN","SPNJRPC3",69,0)
POP2 ;
"RTN","SPNJRPC3",70,0)
 ; SCNUM     Clinic Stop Code Number
"RTN","SPNJRPC3",71,0)
 ; SCNAME    Clinic Stop Code Name
"RTN","SPNJRPC3",72,0)
 ; NPATS     Number of patients who stopped at this stop code
"RTN","SPNJRPC3",73,0)
 ; VISITS    Number of visits made to this stop code
"RTN","SPNJRPC3",74,0)
 ; STOPS     Number of stops made at this stop code
"RTN","SPNJRPC3",75,0)
 N SCNUM,SCNAME,NPATS,STOPS,VISITS
"RTN","SPNJRPC3",76,0)
 S ^TMP($J,RETCNT)="HDR999^Clinic^Patients^Visits^Stops^EOL999"
"RTN","SPNJRPC3",77,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPC3",78,0)
 S SCNUM=""
"RTN","SPNJRPC3",79,0)
 F  S SCNUM=$O(^TMP("SPN",$J,"OP","SC",SCNUM)) Q:SCNUM=""  D
"RTN","SPNJRPC3",80,0)
 . S NPATS=^TMP("SPN",$J,"OP","SC",SCNUM)
"RTN","SPNJRPC3",81,0)
 . S STOPS=^TMP("SPN",$J,"OP","SC",SCNUM,"STOPS")
"RTN","SPNJRPC3",82,0)
 . S VISITS=^TMP("SPN",$J,"OP","SC",SCNUM,"VISITS")
"RTN","SPNJRPC3",83,0)
 . S SCNAME=^TMP("SPN",$J,"OP","SC",SCNUM,"NAME")
"RTN","SPNJRPC3",84,0)
 . S ^TMP($J,RETCNT)=SCNUM_"^"_SCNAME_"^"_NPATS_"^"_$FN(VISITS,",",2)_"^"_STOPS_"^"_"EOL999"
"RTN","SPNJRPC3",85,0)
 . S RETCNT=RETCNT+1
"RTN","SPNJRPC3",86,0)
 Q
"RTN","SPNJRPC3",87,0)
POP3 ;
"RTN","SPNJRPC3",88,0)
 ; I         High user counter
"RTN","SPNJRPC3",89,0)
 ; PID       Patient ID
"RTN","SPNJRPC3",90,0)
 ; PNAME     Patient Name
"RTN","SPNJRPC3",91,0)
 ; PSSN      Patient SSN
"RTN","SPNJRPC3",92,0)
 ; VISITS    Number of visits made to this stop code
"RTN","SPNJRPC3",93,0)
 ; NDSCNUMS  Number of different stop codes
"RTN","SPNJRPC3",94,0)
 N VISITS,PID,PNAME,PSSN,I,NDSCNUMS
"RTN","SPNJRPC3",95,0)
 S ^TMP($J,RETCNT)="BOS999^Highest Utilization of Visits^EOL999"
"RTN","SPNJRPC3",96,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPC3",97,0)
 S ^TMP($J,RETCNT)="HDR999^Patient Name^SSN^Visit^Different Stop Codes^EOL999"
"RTN","SPNJRPC3",98,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPC3",99,0)
 S VISITS=""
"RTN","SPNJRPC3",100,0)
 F I=1:1:HIUSERS S VISITS=$O(^TMP("SPN",$J,"OP","HI","H1",VISITS)) Q:VISITS=""  D
"RTN","SPNJRPC3",101,0)
 . S NDSCNUMS=""
"RTN","SPNJRPC3",102,0)
 . F  S NDSCNUMS=$O(^TMP("SPN",$J,"OP","HI","H1",VISITS,NDSCNUMS)) Q:NDSCNUMS=""  D
"RTN","SPNJRPC3",103,0)
 . . S PID=""
"RTN","SPNJRPC3",104,0)
 . . F  S PID=$O(^TMP("SPN",$J,"OP","HI","H1",VISITS,NDSCNUMS,PID)) Q:PID=""  D
"RTN","SPNJRPC3",105,0)
 . . . D GETNAME^SPNLRU(PID,.PNAME,.PSSN)
"RTN","SPNJRPC3",106,0)
 . . . S ^TMP($J,RETCNT)=PNAME_"^"_PSSN_"^"_-VISITS_"^"_-NDSCNUMS_"^EOL999"
"RTN","SPNJRPC3",107,0)
 . . . S RETCNT=RETCNT+1
"RTN","SPNJRPC3",108,0)
 Q
"RTN","SPNJRPC3",109,0)
INPAT ;
"RTN","SPNJRPC3",110,0)
 D PIP1,PIP2
"RTN","SPNJRPC3",111,0)
 I HIUSERS D PIP3,PIP4
"RTN","SPNJRPC3",112,0)
 Q
"RTN","SPNJRPC3",113,0)
PIP1 ;
"RTN","SPNJRPC3",114,0)
 ; ADM       Number of admissions (stays)
"RTN","SPNJRPC3",115,0)
 N ADM,OUT,LINE,STARTLIN,COL,NPATS,DAYS
"RTN","SPNJRPC3",116,0)
 S NPATS=+$G(^TMP("SPN",$J,"IP","PAT"))
"RTN","SPNJRPC3",117,0)
 S ADM=+$G(^TMP("SPN",$J,"IP","ADM"))
"RTN","SPNJRPC3",118,0)
 S DAYS=+$G(^TMP("SPN",$J,"IP","DAYS"))
"RTN","SPNJRPC3",119,0)
 S ^TMP($J,RETCNT)="PAT999^Inpatient Activity^EOL999"
"RTN","SPNJRPC3",120,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPC3",121,0)
 S ^TMP($J,RETCNT)="BOS999^Totals:  "_$FN(NPATS,",")_" patient"_$S(NPATS=1:"",1:"s")_" for "_$FN(ADM,",")_" stay"_$S(ADM=1:"",1:"s")_" and "_$FN(DAYS,",")_" day"_$S(DAYS=1:"",1:"s")_" inpatient care^EOL999"
"RTN","SPNJRPC3",122,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPC3",123,0)
 S ADM=+$O(^TMP("SPN",$J,"IP","ADM","PAT",""))
"RTN","SPNJRPC3",124,0)
 F  D  Q:ADM=""
"RTN","SPNJRPC3",125,0)
 . S STARTLIN=1
"RTN","SPNJRPC3",126,0)
 . F COL=1:1:3 D  Q:ADM=""
"RTN","SPNJRPC3",127,0)
 . . S OUT(STARTLIN)=$G(OUT(STARTLIN))_"HDR999^Patients^Stays^EOL999"
"RTN","SPNJRPC3",128,0)
 . . F LINE=STARTLIN+2:1 D  Q:ADM=""
"RTN","SPNJRPC3",129,0)
 . . . S OUT(LINE)=$G(OUT(LINE))_$G(^TMP("SPN",$J,"IP","ADM","PAT",ADM))_"^"_ADM_"^EOL999"
"RTN","SPNJRPC3",130,0)
 . . . S ADM=$O(^TMP("SPN",$J,"IP","ADM","PAT",ADM))
"RTN","SPNJRPC3",131,0)
 . S LINE=""
"RTN","SPNJRPC3",132,0)
 . F  S LINE=$O(OUT(LINE)) Q:LINE=""  D
"RTN","SPNJRPC3",133,0)
 . . S ^TMP($J,RETCNT)=OUT(LINE)
"RTN","SPNJRPC3",134,0)
 . . S RETCNT=RETCNT+1
"RTN","SPNJRPC3",135,0)
 Q
"RTN","SPNJRPC3",136,0)
PIP2 ;
"RTN","SPNJRPC3",137,0)
 ; BS        Bed Section Array
"RTN","SPNJRPC3",138,0)
 ; BSNAME    Bed Section Name
"RTN","SPNJRPC3",139,0)
 ; BSNR      Bed Section Number
"RTN","SPNJRPC3",140,0)
 ; DAYS      Number of days spent in a bed section
"RTN","SPNJRPC3",141,0)
 ; NPATS     Number of patients
"RTN","SPNJRPC3",142,0)
 ; STAYS     Number of stays in a bed section
"RTN","SPNJRPC3",143,0)
 N STAYS,BSNAME,NPATS,DAYS,BS,BSNR
"RTN","SPNJRPC3",144,0)
 S ^TMP($J,RETCNT)="BOS999^Median Length of Stay (MLOS):  "_$FN($$MEDIAN^SPNLRU($G(^TMP("SPN",$J,"IP","ADM")),"^TMP(""SPN"","_$J_",""IP"",""ADM"",""DAYS"","),",",1)_" days^EOL999"
"RTN","SPNJRPC3",145,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPC3",146,0)
 S ^TMP($J,RETCNT)="HDR999^Specialty^Patients^Stays^Days^MLOS^EOL999"
"RTN","SPNJRPC3",147,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPC3",148,0)
 S BSNR="" ; set up to print bed sections in name order
"RTN","SPNJRPC3",149,0)
 F  S BSNR=$O(^TMP("SPN",$J,"IP","BS",BSNR)) Q:BSNR=""  D
"RTN","SPNJRPC3",150,0)
 . S BS(^TMP("SPN",$J,"IP","BS",BSNR,"NAME"))=BSNR
"RTN","SPNJRPC3",151,0)
 S BSNAME=""
"RTN","SPNJRPC3",152,0)
 F  S BSNAME=$O(BS(BSNAME)) Q:BSNAME=""  D
"RTN","SPNJRPC3",153,0)
 . S BSNR=BS(BSNAME)
"RTN","SPNJRPC3",154,0)
 . S NPATS=^TMP("SPN",$J,"IP","BS",BSNR)
"RTN","SPNJRPC3",155,0)
 . S STAYS=^TMP("SPN",$J,"IP","BS",BSNR,"STAYS")
"RTN","SPNJRPC3",156,0)
 . S DAYS=^TMP("SPN",$J,"IP","BS",BSNR,"DAYS")
"RTN","SPNJRPC3",157,0)
 . S ^TMP($J,RETCNT)=BSNAME_"^"_NPATS_"^"_STAYS_"^"_DAYS_"^"_$FN($$MEDIAN^SPNLRU(STAYS,"^TMP(""SPN"","_$J_",""IP"",""BS"","""_BSNR_""",""DAYS"","),",",1)_"^EOL999"
"RTN","SPNJRPC3",158,0)
 . S RETCNT=RETCNT+1
"RTN","SPNJRPC3",159,0)
 Q
"RTN","SPNJRPC3",160,0)
PIP3 ;
"RTN","SPNJRPC3",161,0)
 ; ADM       Number of admissions (stays)
"RTN","SPNJRPC3",162,0)
 ; DAYS      Number of days for these admissions
"RTN","SPNJRPC3",163,0)
 ; I         High User Counter
"RTN","SPNJRPC3",164,0)
 ; PID       Patient ID (Coded SSN)
"RTN","SPNJRPC3",165,0)
 ; PNAME     Patient Name
"RTN","SPNJRPC3",166,0)
 ; PSSN      Patient SSN
"RTN","SPNJRPC3",167,0)
 N ADM,I,DAYS,PID,PNAME,PSSN
"RTN","SPNJRPC3",168,0)
 S ^TMP($J,RETCNT)="BOS999^Highest Number of Stays^EOL999"
"RTN","SPNJRPC3",169,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPC3",170,0)
 S ^TMP($J,RETCNT)="HDR999^Patient Name^SSN^Stays^Days^EOL999"
"RTN","SPNJRPC3",171,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPC3",172,0)
 S ADM=""
"RTN","SPNJRPC3",173,0)
 F I=1:1:HIUSERS S ADM=$O(^TMP("SPN",$J,"IP","HI","H1",ADM)) Q:ADM=""  D 
"RTN","SPNJRPC3",174,0)
 . S DAYS=""
"RTN","SPNJRPC3",175,0)
 . F  S DAYS=$O(^TMP("SPN",$J,"IP","HI","H1",ADM,DAYS)) Q:DAYS=""  D
"RTN","SPNJRPC3",176,0)
 . . S PID=""
"RTN","SPNJRPC3",177,0)
 . . F  S PID=$O(^TMP("SPN",$J,"IP","HI","H1",ADM,DAYS,PID)) Q:PID=""  D 
"RTN","SPNJRPC3",178,0)
 . . . D GETNAME^SPNLRU(PID,.PNAME,.PSSN)
"RTN","SPNJRPC3",179,0)
 . . . S ^TMP($J,RETCNT)=PNAME_"^"_PSSN_"^"_-ADM_"^"_-DAYS_"^EOL999"
"RTN","SPNJRPC3",180,0)
 . . . S RETCNT=RETCNT+1
"RTN","SPNJRPC3",181,0)
 Q
"RTN","SPNJRPC3",182,0)
PIP4 ;
"RTN","SPNJRPC3",183,0)
 N ADM,I,DAYS,PID,PNAME,PSSN
"RTN","SPNJRPC3",184,0)
 S ^TMP($J,RETCNT)="BOS999^Highest Number of Days^EOL999"
"RTN","SPNJRPC3",185,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPC3",186,0)
 S ^TMP($J,RETCNT)="HDR999^Patient Name^SSN^Days^Stays^EOL999"
"RTN","SPNJRPC3",187,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPC3",188,0)
 S DAYS=""
"RTN","SPNJRPC3",189,0)
 F I=1:1:HIUSERS S DAYS=$O(^TMP("SPN",$J,"IP","HI","H2",DAYS)) Q:DAYS=""  D
"RTN","SPNJRPC3",190,0)
 . S ADM=""
"RTN","SPNJRPC3",191,0)
 . F  S ADM=$O(^TMP("SPN",$J,"IP","HI","H2",DAYS,ADM)) Q:ADM=""  D
"RTN","SPNJRPC3",192,0)
 . . S PID=""
"RTN","SPNJRPC3",193,0)
 . . F  S PID=$O(^TMP("SPN",$J,"IP","HI","H2",DAYS,ADM,PID)) Q:PID=""  D 
"RTN","SPNJRPC3",194,0)
 . . . D GETNAME^SPNLRU(PID,.PNAME,.PSSN)
"RTN","SPNJRPC3",195,0)
 . . . S ^TMP($J,RETCNT)=PNAME_"^"_PSSN_"^"_-DAYS_"^"_-ADM_"^EOL999"
"RTN","SPNJRPC3",196,0)
 . . . S RETCNT=RETCNT+1
"RTN","SPNJRPC3",197,0)
 Q
"RTN","SPNJRPC4")
0^6^B38673987
"RTN","SPNJRPC4",1,0)
SPNJRPC4 ;BP/JAS - Returns Inpatient/Outpatient Specific for list of pats ;JUL 28, 2008
"RTN","SPNJRPC4",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNJRPC4",3,0)
 ;
"RTN","SPNJRPC4",4,0)
 ; Reference to ^DIC(40.7,"B" supported by IA #4929
"RTN","SPNJRPC4",5,0)
 ; Reference to ^DIC(40.7,D0,0 supported by IA #557
"RTN","SPNJRPC4",6,0)
 ; Reference to ^DIC(42.4,"B" supported by IA #4946
"RTN","SPNJRPC4",7,0)
 ; API $$FLIP^SPNRPCIC is part of Spinal Cord Version 3.0
"RTN","SPNJRPC4",8,0)
 ; API SELECT^SPNLGSOP is part of Spinal Cord version 2.0
"RTN","SPNJRPC4",9,0)
 ; API SELECT^SPNLGSIP is part of Spinal Cord version 2.0
"RTN","SPNJRPC4",10,0)
 ;
"RTN","SPNJRPC4",11,0)
 ; Parm values:
"RTN","SPNJRPC4",12,0)
 ;     RETURN is the sorted data from the earliest date of listing
"RTN","SPNJRPC4",13,0)
 ;     ICNLST is the list of patient ICNs to process
"RTN","SPNJRPC4",14,0)
 ;     FDATE is the start date for period
"RTN","SPNJRPC4",15,0)
 ;     TDATE is the end date for period
"RTN","SPNJRPC4",16,0)
 ;     CLINSTP is a list of clinic stops to search for
"RTN","SPNJRPC4",17,0)
 ;     SPECLTY is the type of specialties to search for
"RTN","SPNJRPC4",18,0)
 ;     HIUSERS determines whether patient usage data will be sent
"RTN","SPNJRPC4",19,0)
 ;
"RTN","SPNJRPC4",20,0)
 ; Returns: ^TMP($J)
"RTN","SPNJRPC4",21,0)
 ;
"RTN","SPNJRPC4",22,0)
COL(RETURN,ICNLST,FDATE,TDATE,CLINSTP,SPECLTY,HIUSERS)  ;
"RTN","SPNJRPC4",23,0)
 ;***************************
"RTN","SPNJRPC4",24,0)
 K ^TMP($J),^TMP("SPN",$J),QLIST
"RTN","SPNJRPC4",25,0)
 S RETURN=$NA(^TMP($J)),RETCNT=1
"RTN","SPNJRPC4",26,0)
 S X=FDATE S %DT="T" D ^%DT S FDATE=Y
"RTN","SPNJRPC4",27,0)
 S X=TDATE S %DT="T" D ^%DT S TDATE=Y
"RTN","SPNJRPC4",28,0)
 ;***************************
"RTN","SPNJRPC4",29,0)
 F CLNNM=1:1:$L(CLINSTP,"^") D
"RTN","SPNJRPC4",30,0)
 . S CLIN=$P($P(CLINSTP,"^",CLNNM),";;",1),CLINNM=$P($P(CLINSTP,"^",CLNNM),";;",2)
"RTN","SPNJRPC4",31,0)
 . ;JAS - 05/14/08 - DEFECT 1090
"RTN","SPNJRPC4",32,0)
 . ;I CLIN'="",$D(^DIC(40.7,"B",CLIN)) S CLINDA="" F  S CLINDA=$O(^DIC(40.7,"B",CLIN,CLINDA)) Q:CLINDA=""  D
"RTN","SPNJRPC4",33,0)
 . I CLIN'="",$D(^DIC(40.7,"B",CLIN)) S CLINDA=0 F  S CLINDA=$O(^DIC(40.7,"B",CLIN,CLINDA)) Q:CLINDA=""  D
"RTN","SPNJRPC4",34,0)
 . . Q:'$D(^DIC(40.7,CLINDA))
"RTN","SPNJRPC4",35,0)
 . . Q:CLINNM'=$P(^DIC(40.7,CLINDA,0),"^",2)
"RTN","SPNJRPC4",36,0)
 . . S QLIST("SC",CLINNM)=CLIN
"RTN","SPNJRPC4",37,0)
 F SPCNM=1:1:$L(SPECLTY,"^") S SPEC=$P(SPECLTY,"^",SPCNM) D
"RTN","SPNJRPC4",38,0)
 . ;JAS - 05/14/08 - DEFECT 1090
"RTN","SPNJRPC4",39,0)
 . ;I SPEC'="",$D(^DIC(42.4,"B",SPEC)) S SPECDA=$O(^DIC(42.4,"B",SPEC,"")) D
"RTN","SPNJRPC4",40,0)
 . I SPEC'="",$D(^DIC(42.4,"B",SPEC)) S SPECDA=$O(^DIC(42.4,"B",SPEC,0)) D
"RTN","SPNJRPC4",41,0)
 . . S QLIST("BS",SPECDA)=SPEC
"RTN","SPNJRPC4",42,0)
 F ICNNM=1:1:$L(ICNLST,"^") S ICN=$P(ICNLST,"^",ICNNM) D IN
"RTN","SPNJRPC4",43,0)
 I HIUSERS D
"RTN","SPNJRPC4",44,0)
 . I $D(QLIST("SC")) D OUTPAT
"RTN","SPNJRPC4",45,0)
 . I $D(QLIST("BS")) D INPAT
"RTN","SPNJRPC4",46,0)
 E  D
"RTN","SPNJRPC4",47,0)
 . I $D(QLIST("SC")) D OUTPAT2
"RTN","SPNJRPC4",48,0)
 . I $D(QLIST("BS")) D INPAT2
"RTN","SPNJRPC4",49,0)
 D CLNUP
"RTN","SPNJRPC4",50,0)
 Q
"RTN","SPNJRPC4",51,0)
IN Q:$G(ICN)=""
"RTN","SPNJRPC4",52,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNJRPC4",53,0)
 Q:$G(DFN)=""
"RTN","SPNJRPC4",54,0)
 ;***************************
"RTN","SPNJRPC4",55,0)
 D SELECT^SPNLGSOP(DFN,FDATE,TDATE,HIUSERS,.QLIST)
"RTN","SPNJRPC4",56,0)
 D SELECT^SPNLGSIP(DFN,FDATE,TDATE,HIUSERS,.QLIST)
"RTN","SPNJRPC4",57,0)
 Q
"RTN","SPNJRPC4",58,0)
OUTPAT ;
"RTN","SPNJRPC4",59,0)
 ; SCNAME    Clinic Stop Name
"RTN","SPNJRPC4",60,0)
 ; SCNUM     Clinic Stop Number
"RTN","SPNJRPC4",61,0)
 ; STOPS     Number of stops at a Clinic Stop
"RTN","SPNJRPC4",62,0)
 ; NPATS     Number of patients
"RTN","SPNJRPC4",63,0)
 ; VISITS    Number of visits to a Clinic Stop
"RTN","SPNJRPC4",64,0)
 N VISITS,SCNAME,NPATS,STOPS,SCNUM,PNAME,PSSN,PID,PDATA
"RTN","SPNJRPC4",65,0)
 S ^TMP($J,RETCNT)="PAT999^Selected Outpatient Activity^EOL999"
"RTN","SPNJRPC4",66,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPC4",67,0)
 S SCNUM="" ; list clinics in stop code number order
"RTN","SPNJRPC4",68,0)
 F  S SCNUM=$O(QLIST("SC",SCNUM)) Q:SCNUM=""  D
"RTN","SPNJRPC4",69,0)
 . S SCNAME=QLIST("SC",SCNUM)
"RTN","SPNJRPC4",70,0)
 . S NPATS=+$G(^TMP("SPN",$J,"OP","SC",SCNUM))
"RTN","SPNJRPC4",71,0)
 . S VISITS=+$G(^TMP("SPN",$J,"OP","SC",SCNUM,"VISITS"))
"RTN","SPNJRPC4",72,0)
 . S STOPS=+$G(^TMP("SPN",$J,"OP","SC",SCNUM,"STOPS"))
"RTN","SPNJRPC4",73,0)
 . S ^TMP($J,RETCNT)="BOS999^"_SCNUM_"^"_SCNAME_"^EOL999"
"RTN","SPNJRPC4",74,0)
 . S RETCNT=RETCNT+1
"RTN","SPNJRPC4",75,0)
 . S ^TMP($J,RETCNT)="TOT999^Totals:  "_$FN(NPATS,",")_" patient"_$S(NPATS=1:"",1:"s")_"^"_$FN(VISITS,",",2)_"^"_STOPS_"^EOL999"
"RTN","SPNJRPC4",76,0)
 . S RETCNT=RETCNT+1
"RTN","SPNJRPC4",77,0)
 . S ^TMP($J,RETCNT)="HDR999^Patient Name^SSN^Visits^Stops^EOL999"
"RTN","SPNJRPC4",78,0)
 . S RETCNT=RETCNT+1
"RTN","SPNJRPC4",79,0)
 . S PID=""
"RTN","SPNJRPC4",80,0)
 . F  S PID=$O(^TMP("SPN",$J,"OP","SC",SCNUM,"PID",PID)) Q:PID=""  D
"RTN","SPNJRPC4",81,0)
 . . S PNAME=$P(PID,U,1),PSSN=$P(PID,U,2)
"RTN","SPNJRPC4",82,0)
 . . S PDATA=^TMP("SPN",$J,"OP","SC",SCNUM,"PID",PID)
"RTN","SPNJRPC4",83,0)
 . . S VISITS=+$P(PDATA,U,1),STOPS=+$P(PDATA,U,2)
"RTN","SPNJRPC4",84,0)
 . . S ^TMP($J,RETCNT)="PATDETAIL999^"_PNAME_"^"_PSSN_"^"_$FN(VISITS,",",2)_"^"_STOPS_"^EOL999"
"RTN","SPNJRPC4",85,0)
 . . S RETCNT=RETCNT+1
"RTN","SPNJRPC4",86,0)
 Q
"RTN","SPNJRPC4",87,0)
INPAT ;
"RTN","SPNJRPC4",88,0)
 ; BS        Bed Section Array
"RTN","SPNJRPC4",89,0)
 ; BSNAME    Bed Section Name
"RTN","SPNJRPC4",90,0)
 ; BSNR      Bed Section Number
"RTN","SPNJRPC4",91,0)
 ; DAYS      Number of days spent in a bed section
"RTN","SPNJRPC4",92,0)
 ; NPATS     Number of patients
"RTN","SPNJRPC4",93,0)
 ; STAYS     Number of stays in a bed section
"RTN","SPNJRPC4",94,0)
 N STAYS,BSNAME,NPATS,DAYS,BS,BSNR,PNAME,PSSN,PID,PDATA
"RTN","SPNJRPC4",95,0)
 S ^TMP($J,RETCNT)="PAT999^Selected Inpatient Activity^EOL999"
"RTN","SPNJRPC4",96,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPC4",97,0)
 S BSNR="" ; create list in bed section name order
"RTN","SPNJRPC4",98,0)
 F  S BSNR=$O(QLIST("BS",BSNR)) Q:BSNR=""  D
"RTN","SPNJRPC4",99,0)
 . S BS(QLIST("BS",BSNR))=BSNR
"RTN","SPNJRPC4",100,0)
 S BSNAME=""
"RTN","SPNJRPC4",101,0)
 F  S BSNAME=$O(BS(BSNAME)) Q:BSNAME=""  D
"RTN","SPNJRPC4",102,0)
 . S BSNR=BS(BSNAME)
"RTN","SPNJRPC4",103,0)
 . S NPATS=+$G(^TMP("SPN",$J,"IP","BS",BSNR))
"RTN","SPNJRPC4",104,0)
 . S STAYS=+$G(^TMP("SPN",$J,"IP","BS",BSNR,"STAYS"))
"RTN","SPNJRPC4",105,0)
 . S DAYS=+$G(^TMP("SPN",$J,"IP","BS",BSNR,"DAYS"))
"RTN","SPNJRPC4",106,0)
 . S ^TMP($J,RETCNT)="BOS999^"_BSNAME_"^EOL999"
"RTN","SPNJRPC4",107,0)
 . S RETCNT=RETCNT+1
"RTN","SPNJRPC4",108,0)
 . S ^TMP($J,RETCNT)="TOT999^Totals:  "_$FN(NPATS,",")_" patient"_$S(NPATS=1:"",1:"s")_"^"_STAYS_"^"_DAYS_"^EOL999"
"RTN","SPNJRPC4",109,0)
 . S RETCNT=RETCNT+1
"RTN","SPNJRPC4",110,0)
 . S ^TMP($J,RETCNT)="HDR999^Patient Name^SSN^Stay^Days^EOL999"
"RTN","SPNJRPC4",111,0)
 . S RETCNT=RETCNT+1
"RTN","SPNJRPC4",112,0)
 . S PID=""
"RTN","SPNJRPC4",113,0)
 . F  S PID=$O(^TMP("SPN",$J,"IP","BS",BSNR,"PID",PID)) Q:PID=""  D
"RTN","SPNJRPC4",114,0)
 . . S PNAME=$P(PID,U,1),PSSN=$P(PID,U,2)
"RTN","SPNJRPC4",115,0)
 . . S PDATA=^TMP("SPN",$J,"IP","BS",BSNR,"PID",PID)
"RTN","SPNJRPC4",116,0)
 . . S STAYS=$P(PDATA,U,1),DAYS=$P(PDATA,U,2)
"RTN","SPNJRPC4",117,0)
 . . S ^TMP($J,RETCNT)="PATDETAIL999^"_PNAME_"^"_PSSN_"^"_STAYS_"^"_DAYS_"^EOL999"
"RTN","SPNJRPC4",118,0)
 . . S RETCNT=RETCNT+1
"RTN","SPNJRPC4",119,0)
 Q
"RTN","SPNJRPC4",120,0)
OUTPAT2 ;
"RTN","SPNJRPC4",121,0)
 ; SCNAME    Clinic Stop Name
"RTN","SPNJRPC4",122,0)
 ; SCNUM     Clinic Stop Number
"RTN","SPNJRPC4",123,0)
 ; STOPS     Number of stops at a Clinic Stop
"RTN","SPNJRPC4",124,0)
 ; NPATS     Number of patients
"RTN","SPNJRPC4",125,0)
 ; VISITS    Number of visits to a Clinic Stop
"RTN","SPNJRPC4",126,0)
 N VISITS,SCNAME,NPATS,STOPS,SC,SCNUM
"RTN","SPNJRPC4",127,0)
 S ^TMP($J,RETCNT)="PAT999^Selected Outpatient Activity^EOL999"
"RTN","SPNJRPC4",128,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPC4",129,0)
 S ^TMP($J,RETCNT)="HDR999^Clinic^Patients^Visits^Stops^EOL999"
"RTN","SPNJRPC4",130,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPC4",131,0)
 S SCNUM="" ; list clinics in stop code number order
"RTN","SPNJRPC4",132,0)
 F  S SCNUM=$O(QLIST("SC",SCNUM)) Q:SCNUM=""  D
"RTN","SPNJRPC4",133,0)
 . S SCNAME=QLIST("SC",SCNUM)
"RTN","SPNJRPC4",134,0)
 . S NPATS=+$G(^TMP("SPN",$J,"OP","SC",SCNUM))
"RTN","SPNJRPC4",135,0)
 . S VISITS=+$G(^TMP("SPN",$J,"OP","SC",SCNUM,"VISITS"))
"RTN","SPNJRPC4",136,0)
 . S STOPS=+$G(^TMP("SPN",$J,"OP","SC",SCNUM,"STOPS"))
"RTN","SPNJRPC4",137,0)
 . S ^TMP($J,RETCNT)="TOT999^"_SCNUM_"^"_SCNAME_"^"_NPATS_"^"_$FN(VISITS,",",2)_"^"_STOPS_"^EOL999"
"RTN","SPNJRPC4",138,0)
 . S RETCNT=RETCNT+1
"RTN","SPNJRPC4",139,0)
 Q
"RTN","SPNJRPC4",140,0)
INPAT2 ;
"RTN","SPNJRPC4",141,0)
 ; BS        Bed Section Array
"RTN","SPNJRPC4",142,0)
 ; BSNAME    Bed Section Name
"RTN","SPNJRPC4",143,0)
 ; BSNR      Bed Section Number
"RTN","SPNJRPC4",144,0)
 ; DAYS      Number of days spent in a bed section
"RTN","SPNJRPC4",145,0)
 ; NPATS     Number of patients
"RTN","SPNJRPC4",146,0)
 ; STAYS     Number of stays in a bed section
"RTN","SPNJRPC4",147,0)
 N STAYS,BSNAME,NPATS,DAYS,BS,BSNR
"RTN","SPNJRPC4",148,0)
 S ^TMP($J,RETCNT)="PAT999^Selected Inpatient Activity^EOL999"
"RTN","SPNJRPC4",149,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPC4",150,0)
 S ^TMP($J,RETCNT)="HDR999^Specialty^Patients^Stays^Days^EOL999"
"RTN","SPNJRPC4",151,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPC4",152,0)
 S BSNR="" ; create list in bed section name order
"RTN","SPNJRPC4",153,0)
 F  S BSNR=$O(QLIST("BS",BSNR)) Q:BSNR=""  D
"RTN","SPNJRPC4",154,0)
 . S BS(QLIST("BS",BSNR))=BSNR
"RTN","SPNJRPC4",155,0)
 S BSNAME=""
"RTN","SPNJRPC4",156,0)
 F  S BSNAME=$O(BS(BSNAME)) Q:BSNAME=""  D
"RTN","SPNJRPC4",157,0)
 . S BSNR=BS(BSNAME)
"RTN","SPNJRPC4",158,0)
 . S NPATS=+$G(^TMP("SPN",$J,"IP","BS",BSNR))
"RTN","SPNJRPC4",159,0)
 . S STAYS=+$G(^TMP("SPN",$J,"IP","BS",BSNR,"STAYS"))
"RTN","SPNJRPC4",160,0)
 . S DAYS=+$G(^TMP("SPN",$J,"IP","BS",BSNR,"DAYS"))
"RTN","SPNJRPC4",161,0)
 . S ^TMP($J,RETCNT)="TOT999^"_BSNAME_"^"_NPATS_"^"_STAYS_"^"_DAYS_"^EOL999"
"RTN","SPNJRPC4",162,0)
 . S RETCNT=RETCNT+1
"RTN","SPNJRPC4",163,0)
 Q
"RTN","SPNJRPC4",164,0)
CLNUP ;
"RTN","SPNJRPC4",165,0)
 K %DT,AICN,CLIN,CLINDA,CLINNM,CLNNM,DFN,ICN,ICNNM,PATLIST,RETCNT
"RTN","SPNJRPC4",166,0)
 K SPCNM,SPEC,SPECDA,SPN,X,Y
"RTN","SPNJRPC4",167,0)
 Q
"RTN","SPNJRPC5")
0^7^B14449910
"RTN","SPNJRPC5",1,0)
SPNJRPC5 ;BP/JAS - Returns Breakdown of Patients data ;JUL 28, 2008
"RTN","SPNJRPC5",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNJRPC5",3,0)
 ;
"RTN","SPNJRPC5",4,0)
 ; Reference to API DEM^VADPT supported by IA# 10061
"RTN","SPNJRPC5",5,0)
 ; API $$FLIP^SPNRPCIC is part of Spinal Cord Version 3.0
"RTN","SPNJRPC5",6,0)
 ; API GATHER^SPNLGRPS is part of Spinal Cord version 2.0
"RTN","SPNJRPC5",7,0)
 ;
"RTN","SPNJRPC5",8,0)
 ; Parm values:
"RTN","SPNJRPC5",9,0)
 ;     RETURN is the sorted data from the earliest date of listing
"RTN","SPNJRPC5",10,0)
 ;     ICNLST is the list of patient ICNs to process
"RTN","SPNJRPC5",11,0)
 ;     FDATE is the start date for period
"RTN","SPNJRPC5",12,0)
 ;     TDATE is the end date for period
"RTN","SPNJRPC5",13,0)
 ;
"RTN","SPNJRPC5",14,0)
 ; Returns: ^TMP($J)
"RTN","SPNJRPC5",15,0)
 ;
"RTN","SPNJRPC5",16,0)
COL(RETURN,ICNLST,FDATE,TDATE) ;
"RTN","SPNJRPC5",17,0)
 ;***************************
"RTN","SPNJRPC5",18,0)
 S QLIST("WINDOW")=0
"RTN","SPNJRPC5",19,0)
 S QLIST("INCLUDE DEAD")=1
"RTN","SPNJRPC5",20,0)
 S RETURN=$NA(^TMP($J)),RETCNT=1
"RTN","SPNJRPC5",21,0)
 S X=FDATE S %DT="T" D ^%DT S FDATE=Y
"RTN","SPNJRPC5",22,0)
 S X=TDATE S %DT="T" D ^%DT S TDATE=Y
"RTN","SPNJRPC5",23,0)
 I FDATE'=-1,TDATE'=-1 S QLIST("WINDOW")=1
"RTN","SPNJRPC5",24,0)
 ;***************************
"RTN","SPNJRPC5",25,0)
 K ^TMP($J),^TMP("SPN",$J)
"RTN","SPNJRPC5",26,0)
 F ICNNM=1:1:$L(ICNLST,"^") S ICN=$P(ICNLST,"^",ICNNM) D IN
"RTN","SPNJRPC5",27,0)
 D FMTRET
"RTN","SPNJRPC5",28,0)
 D CLNUP
"RTN","SPNJRPC5",29,0)
 Q
"RTN","SPNJRPC5",30,0)
IN Q:$G(ICN)=""
"RTN","SPNJRPC5",31,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNJRPC5",32,0)
 Q:$G(DFN)=""
"RTN","SPNJRPC5",33,0)
 ;***************************
"RTN","SPNJRPC5",34,0)
 D DEM^VADPT
"RTN","SPNJRPC5",35,0)
 D GATHER^SPNLGRPS(DFN,FDATE,TDATE,.QLIST)
"RTN","SPNJRPC5",36,0)
 Q
"RTN","SPNJRPC5",37,0)
FMTRET ;
"RTN","SPNJRPC5",38,0)
 F SEX="F","M","U" S SEXLIST(SEX)=""
"RTN","SPNJRPC5",39,0)
 S ^TMP($J,RETCNT)="HDR999^CATEGORY^FEMALE^MALE^UNKNOWN^TOTAL^EOL999"
"RTN","SPNJRPC5",40,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPC5",41,0)
 S ^TMP($J,RETCNT)="BOS999^TOTALS^EOL999"
"RTN","SPNJRPC5",42,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPC5",43,0)
 I QLIST("INCLUDE DEAD") D
"RTN","SPNJRPC5",44,0)
 . S ^TMP($J,RETCNT)="Living (or Unknown)" D LISTEM("STAT","LIVE")
"RTN","SPNJRPC5",45,0)
 . S ^TMP($J,RETCNT)="Deceased (Date of Death in Patient file)" D LISTEM("STAT","DEAD")
"RTN","SPNJRPC5",46,0)
 E  S ^TMP($J,RETCNT)="Total" D LISTEM("STAT","LIVE")
"RTN","SPNJRPC5",47,0)
 ;
"RTN","SPNJRPC5",48,0)
 S ^TMP($J,RETCNT)="BOS999^AGE^EOL999"
"RTN","SPNJRPC5",49,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPC5",50,0)
 N AGE S AGE=""
"RTN","SPNJRPC5",51,0)
 F  S AGE=$O(^TMP("SPN",$J,"PS","AGE",AGE)) Q:AGE=""  D
"RTN","SPNJRPC5",52,0)
 . S ^TMP($J,RETCNT)=(AGE)_"-"_(AGE+4)_" years" D LISTEM("AGE",AGE)
"RTN","SPNJRPC5",53,0)
 ;
"RTN","SPNJRPC5",54,0)
 S ^TMP($J,RETCNT)="BOS999^RACE^EOL999"
"RTN","SPNJRPC5",55,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPC5",56,0)
 N RACE S RACE=""
"RTN","SPNJRPC5",57,0)
 F  S RACE=$O(^TMP("SPN",$J,"PS","RACE",RACE)) Q:RACE=""  D
"RTN","SPNJRPC5",58,0)
 . S ^TMP($J,RETCNT)=RACE D LISTEM("RACE",RACE)
"RTN","SPNJRPC5",59,0)
 ;
"RTN","SPNJRPC5",60,0)
 S ^TMP($J,RETCNT)="BOS999^MEANS TEST^EOL999"
"RTN","SPNJRPC5",61,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPC5",62,0)
 N MEANS S MEANS=""
"RTN","SPNJRPC5",63,0)
 F  S MEANS=$O(^TMP("SPN",$J,"PS","MEANS",MEANS)) Q:MEANS=""  D
"RTN","SPNJRPC5",64,0)
 . S ^TMP($J,RETCNT)="Means Test "_MEANS D LISTEM("MEANS",MEANS)
"RTN","SPNJRPC5",65,0)
 ;
"RTN","SPNJRPC5",66,0)
 S ^TMP($J,RETCNT)="BOS999^ELIGIBILITY^EOL999"
"RTN","SPNJRPC5",67,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPC5",68,0)
 N ELIG S ELIG=""
"RTN","SPNJRPC5",69,0)
 F  S ELIG=$O(^TMP("SPN",$J,"PS","ELIG",ELIG)) Q:ELIG=""  D
"RTN","SPNJRPC5",70,0)
 . S ^TMP($J,RETCNT)=ELIG D LISTEM("ELIG",ELIG)
"RTN","SPNJRPC5",71,0)
 ;
"RTN","SPNJRPC5",72,0)
 S ^TMP($J,RETCNT)="BOS999^PLACE OF SERVICE^EOL999"
"RTN","SPNJRPC5",73,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPC5",74,0)
 N POS S POS=""
"RTN","SPNJRPC5",75,0)
 F  S POS=$O(^TMP("SPN",$J,"PS","POS",POS)) Q:POS=""  D
"RTN","SPNJRPC5",76,0)
 . S ^TMP($J,RETCNT)=POS D LISTEM("POS",POS)
"RTN","SPNJRPC5",77,0)
 ;
"RTN","SPNJRPC5",78,0)
 S ^TMP($J,RETCNT)="BOS999^SEEN^EOL999"
"RTN","SPNJRPC5",79,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPC5",80,0)
 N SEEN S SEEN=""
"RTN","SPNJRPC5",81,0)
 F  S SEEN=$O(^TMP("SPN",$J,"PS","SEEN",SEEN)) Q:SEEN=""  D
"RTN","SPNJRPC5",82,0)
 . S ^TMP($J,RETCNT)="Seen "_$S(SEEN="IP":"as Inpatient",SEEN="OP":"as Outpatient",SEEN="CH":"in Laboratory",SEEN="RX":"in Pharmacy",SEEN="RA":"in Radiology",1:"Somewhere")
"RTN","SPNJRPC5",83,0)
 . D LISTEM("SEEN",SEEN)
"RTN","SPNJRPC5",84,0)
 Q
"RTN","SPNJRPC5",85,0)
LISTEM(TYPE,SUB)        ;
"RTN","SPNJRPC5",86,0)
 N SEX,TOTLSEX,I,NUM
"RTN","SPNJRPC5",87,0)
 S SEX="",TOTLSEX=0
"RTN","SPNJRPC5",88,0)
 F I=0:1 S SEX=$O(SEXLIST(SEX)) Q:SEX=""  D
"RTN","SPNJRPC5",89,0)
 . S NUM=+$G(^TMP("SPN",$J,"PS",TYPE,SUB,SEX))
"RTN","SPNJRPC5",90,0)
 . Q:NUM=0
"RTN","SPNJRPC5",91,0)
 . S TOTLSEX=TOTLSEX+NUM
"RTN","SPNJRPC5",92,0)
 . S $P(^TMP($J,RETCNT),"^",I+2)=NUM
"RTN","SPNJRPC5",93,0)
 I I>1 S $P(^TMP($J,RETCNT),"^",5)=TOTLSEX
"RTN","SPNJRPC5",94,0)
 S $P(^TMP($J,RETCNT),"^",6)="EOL999"
"RTN","SPNJRPC5",95,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPC5",96,0)
 Q
"RTN","SPNJRPC5",97,0)
CLNUP ;
"RTN","SPNJRPC5",98,0)
 K %DT,AICN,DFN,ICN,ICNNM,NUMSEX,PATLIST,QLIST,RETCNT
"RTN","SPNJRPC5",99,0)
 K SEXLIST,SPN,X,Y
"RTN","SPNJRPC5",100,0)
 Q
"RTN","SPNJRPC6")
0^8^B4635814
"RTN","SPNJRPC6",1,0)
SPNJRPC6 ;BP/JAS - Returns Current Inpatients data ;JUL 28, 2008
"RTN","SPNJRPC6",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNJRPC6",3,0)
 ;
"RTN","SPNJRPC6",4,0)
 ; API $$FLIP^SPNRPCIC is part of Spinal Cord Version 3.0
"RTN","SPNJRPC6",5,0)
 ; API GATHER^SPNLGICI is part of Spinal Cord version 2.0
"RTN","SPNJRPC6",6,0)
 ;
"RTN","SPNJRPC6",7,0)
 ; Parm values:
"RTN","SPNJRPC6",8,0)
 ;     RETURN is the sorted data from the earliest date of listing
"RTN","SPNJRPC6",9,0)
 ;     ICNLST is the list of patient ICNs to process
"RTN","SPNJRPC6",10,0)
 ;
"RTN","SPNJRPC6",11,0)
 ;Returns: ^TMP($J)
"RTN","SPNJRPC6",12,0)
 ;
"RTN","SPNJRPC6",13,0)
COL(RETURN,ICNLST) ;
"RTN","SPNJRPC6",14,0)
 ;***************************
"RTN","SPNJRPC6",15,0)
 S RETURN=$NA(^TMP($J)),RETCNT=1
"RTN","SPNJRPC6",16,0)
 K ^TMP($J),^TMP("SPN",$J)
"RTN","SPNJRPC6",17,0)
 F ICNNM=1:1:$L(ICNLST,"^") S ICN=$P(ICNLST,"^",ICNNM) D IN
"RTN","SPNJRPC6",18,0)
 D FMTRET
"RTN","SPNJRPC6",19,0)
 K AICN,DFN,ICN,ICNNM,RETCNT,PATLIST,SPN
"RTN","SPNJRPC6",20,0)
 Q
"RTN","SPNJRPC6",21,0)
IN Q:$G(ICN)=""
"RTN","SPNJRPC6",22,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNJRPC6",23,0)
 Q:$G(DFN)=""
"RTN","SPNJRPC6",24,0)
 ;***************************
"RTN","SPNJRPC6",25,0)
 D GATHER^SPNLGICI(DFN,"")
"RTN","SPNJRPC6",26,0)
 Q
"RTN","SPNJRPC6",27,0)
FMTRET ;
"RTN","SPNJRPC6",28,0)
 N WARD,PAT,ZAD,ADMINFO,CURRLOS,FYTDLOS,ROOMBED,DIAG
"RTN","SPNJRPC6",29,0)
 S ^TMP($J,RETCNT)="TOT999^Total Inpatients:  "_+$G(^TMP("SPN",$J,"CI"))_"^EOL999"
"RTN","SPNJRPC6",30,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPC6",31,0)
 S ^TMP($J,RETCNT)="HDR999^NAME^LAST FOUR^WARD^ADMISSION DATE^CURR LOS^FYTD LOS^ADM DX^ROOM-BED^EOL999"
"RTN","SPNJRPC6",32,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPC6",33,0)
 S WARD=""
"RTN","SPNJRPC6",34,0)
 F  S WARD=$O(^TMP("SPN",$J,"CI",WARD)) Q:WARD=""  D
"RTN","SPNJRPC6",35,0)
 . S PAT=""
"RTN","SPNJRPC6",36,0)
 . F  S PAT=$O(^TMP("SPN",$J,"CI",WARD,PAT)) Q:PAT=""  D
"RTN","SPNJRPC6",37,0)
 . . S ADMINFO=^TMP("SPN",$J,"CI",WARD,PAT)
"RTN","SPNJRPC6",38,0)
 . . S ZAD=$P(ADMINFO,U,1)
"RTN","SPNJRPC6",39,0)
 . . S CURRLOS=$P(ADMINFO,U,2)
"RTN","SPNJRPC6",40,0)
 . . S FYTDLOS=$P(ADMINFO,U,3)
"RTN","SPNJRPC6",41,0)
 . . S ROOMBED=$P(ADMINFO,U,4)
"RTN","SPNJRPC6",42,0)
 . . S DIAG=$P(ADMINFO,U,5)
"RTN","SPNJRPC6",43,0)
 . . S ^TMP($J,RETCNT)=$P(PAT,U,1)_"^"_$P(PAT,U,2)_"^"_WARD_"^"_$E(ZAD,4,5)_"/"_$E(ZAD,6,7)_"/"_$E(ZAD,2,3)_"^"_$FN(CURRLOS,",")_"^"_$FN(FYTDLOS,",")_"^"_DIAG_"^"_ROOMBED_"^EOL999"
"RTN","SPNJRPC6",44,0)
 . . S RETCNT=RETCNT+1
"RTN","SPNJRPC6",45,0)
 . . Q
"RTN","SPNJRPC6",46,0)
 . Q
"RTN","SPNJRPC6",47,0)
 Q
"RTN","SPNJRPC7")
0^9^B352636
"RTN","SPNJRPC7",1,0)
SPNJRPC7 ;BP/JAS - Returns Specialty PTF codes ;JUL 28, 2008
"RTN","SPNJRPC7",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNJRPC7",3,0)
 ;
"RTN","SPNJRPC7",4,0)
 ; Reference to ^DIC(42.4,"B" supported by IA #4946
"RTN","SPNJRPC7",5,0)
 ;
"RTN","SPNJRPC7",6,0)
 ; Parm values:
"RTN","SPNJRPC7",7,0)
 ;     RETURN is the sorted data from the earliest date of listing
"RTN","SPNJRPC7",8,0)
 ;     SPEC is a dummy field to comply with Java RPC framework
"RTN","SPNJRPC7",9,0)
 ;
"RTN","SPNJRPC7",10,0)
 ; Returns: ^TMP($J)
"RTN","SPNJRPC7",11,0)
 ;
"RTN","SPNJRPC7",12,0)
COL(RETURN,SPEC) ;
"RTN","SPNJRPC7",13,0)
 ;***************************
"RTN","SPNJRPC7",14,0)
 S RETURN=$NA(^TMP($J)),RETCNT=1
"RTN","SPNJRPC7",15,0)
 K ^TMP($J)
"RTN","SPNJRPC7",16,0)
 S SDA=""
"RTN","SPNJRPC7",17,0)
 F  S SDA=$O(^DIC(42.4,"B",SDA)) Q:SDA=""  D
"RTN","SPNJRPC7",18,0)
 . S ^TMP($J,RETCNT)=SDA_"^EOL999"
"RTN","SPNJRPC7",19,0)
 . S RETCNT=RETCNT+1
"RTN","SPNJRPC7",20,0)
 K RETCNT,SDA
"RTN","SPNJRPC7",21,0)
 Q
"RTN","SPNJRPC8")
0^10^B1723581
"RTN","SPNJRPC8",1,0)
SPNJRPC8 ;BP/JAS - Returns Patient addresses for mailing labels ;JUL 28, 2008
"RTN","SPNJRPC8",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNJRPC8",3,0)
 ;
"RTN","SPNJRPC8",4,0)
 ; Reference to ^DPT(D0,0 supported by IA #998
"RTN","SPNJRPC8",5,0)
 ; Reference to APIs ADD^VADPT & KVAR^VADPT supported by IA #10061
"RTN","SPNJRPC8",6,0)
 ; API $$FLIP^SPNRPCIC is part of Spinal Cord Version 3.0
"RTN","SPNJRPC8",7,0)
 ;
"RTN","SPNJRPC8",8,0)
 ; Parm values:
"RTN","SPNJRPC8",9,0)
 ;     RETURN is the sorted data from the earliest date of listing
"RTN","SPNJRPC8",10,0)
 ;     ICNLST is the list of patient ICNs to process
"RTN","SPNJRPC8",11,0)
 ;
"RTN","SPNJRPC8",12,0)
 ; Returns: ^TMP($J)
"RTN","SPNJRPC8",13,0)
 ;
"RTN","SPNJRPC8",14,0)
COL(RETURN,ICNLST) ;
"RTN","SPNJRPC8",15,0)
 ;***************************
"RTN","SPNJRPC8",16,0)
 S RETURN=$NA(^TMP($J)),RETCNT=1
"RTN","SPNJRPC8",17,0)
 K ^TMP($J),^TMP("SPN",$J)
"RTN","SPNJRPC8",18,0)
 F ICNNM=1:1:$L(ICNLST,"^") S ICN=$P(ICNLST,"^",ICNNM) D IN
"RTN","SPNJRPC8",19,0)
 D CLNUP
"RTN","SPNJRPC8",20,0)
 Q
"RTN","SPNJRPC8",21,0)
IN Q:$G(ICN)=""
"RTN","SPNJRPC8",22,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNJRPC8",23,0)
 Q:$G(DFN)=""
"RTN","SPNJRPC8",24,0)
 ;***************************
"RTN","SPNJRPC8",25,0)
 S NAME=$P(^DPT(DFN,0),"^",1)
"RTN","SPNJRPC8",26,0)
 D ADD^VADPT
"RTN","SPNJRPC8",27,0)
 S ADD1=VAPA(1),ADD2=VAPA(2),ADD3=VAPA(3)
"RTN","SPNJRPC8",28,0)
 S CITY=VAPA(4),STATE=$P(VAPA(5),"^",2),ZIP=VAPA(6)
"RTN","SPNJRPC8",29,0)
 S ^TMP($J,RETCNT)=NAME_"^"_ADD1_"^"_ADD2_"^"_ADD3_"^"_CITY_"^"_STATE_"^"_ZIP_"^EOL999"
"RTN","SPNJRPC8",30,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPC8",31,0)
 Q
"RTN","SPNJRPC8",32,0)
CLNUP ;
"RTN","SPNJRPC8",33,0)
 D KVAR^VADPT
"RTN","SPNJRPC8",34,0)
 K VAPA  ;WDE
"RTN","SPNJRPC8",35,0)
 K ADD1,ADD2,ADD3,AICN,CITY,DFN,ICN,ICNNM,MADD
"RTN","SPNJRPC8",36,0)
 K NAME,PATLIST,RETCNT,SPN,STATE,ZIP
"RTN","SPNJRPC8",37,0)
 Q
"RTN","SPNJRPC9")
0^11^B17400459
"RTN","SPNJRPC9",1,0)
SPNJRPC9 ;BP/JAS - Returns ICD9 Codes based on search criteria ;JUN 16, 2009
"RTN","SPNJRPC9",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNJRPC9",3,0)
 ;
"RTN","SPNJRPC9",4,0)
 ; NO LONGER USED - ACCESS TO FILE NOT NEEDED: [References to ^ICD9 supported by IA #10082]
"RTN","SPNJRPC9",5,0)
 ; References to ^DPT(D0,0 supported by IA #998 and #10035
"RTN","SPNJRPC9",6,0)
 ; Reference to ^DPT(D0,"MPI" supported by IA #4938
"RTN","SPNJRPC9",7,0)
 ; References to ^DGPT supported by IA #4945
"RTN","SPNJRPC9",8,0)
 ; References to file #45 supported by IA #92
"RTN","SPNJRPC9",9,0)
 ; Reference to API DEM^VADPT supported by IA #10061
"RTN","SPNJRPC9",10,0)
 ; API $$FLIP^SPNRPCIC is part of Spinal Cord Version 3.0
"RTN","SPNJRPC9",11,0)
 ;
"RTN","SPNJRPC9",12,0)
 ; Parm values:
"RTN","SPNJRPC9",13,0)
 ;     RETURN is the sorted data from the earliest date of listing
"RTN","SPNJRPC9",14,0)
 ;     ICNLST is the list of patient ICNs to process
"RTN","SPNJRPC9",15,0)
 ;     FDATE  is the Admission starting date
"RTN","SPNJRPC9",16,0)
 ;     TDATE  is the Admission ending date
"RTN","SPNJRPC9",17,0)
 ;     PATTYP is (0) Pats in Reg only (1) All Pats
"RTN","SPNJRPC9",18,0)
 ;     SPNANS is (0) Range of Codes (1) Individual codes
"RTN","SPNJRPC9",19,0)
 ;     CODES  is the list or range of codes
"RTN","SPNJRPC9",20,0)
 ;
"RTN","SPNJRPC9",21,0)
 ; Returns: ^TMP($J)
"RTN","SPNJRPC9",22,0)
 ;
"RTN","SPNJRPC9",23,0)
COL(RETURN,ICNLST,FDATE,TDATE,PATTYP,SPNANS,CODES) ;
"RTN","SPNJRPC9",24,0)
 ;
"RTN","SPNJRPC9",25,0)
 ;***************************
"RTN","SPNJRPC9",26,0)
 S RETURN=$NA(^TMP($J)),RETCNT=1
"RTN","SPNJRPC9",27,0)
 S X=FDATE S %DT="T" D ^%DT S SPNSTRT=Y
"RTN","SPNJRPC9",28,0)
 S X=TDATE S %DT="T" D ^%DT S SPNEND=Y_.2359
"RTN","SPNJRPC9",29,0)
 ;***************************
"RTN","SPNJRPC9",30,0)
 K ^TMP($J),^TMP("SPN",$J),SPNARY
"RTN","SPNJRPC9",31,0)
 S SPNIN=$S(PATTYP=0:"JUST",1:"ALL")
"RTN","SPNJRPC9",32,0)
 Q:SPNANS'=1
"RTN","SPNJRPC9",33,0)
 S IDA="" F  S IDA=$O(CODES(IDA)) Q:IDA=""  D
"RTN","SPNJRPC9",34,0)
 . S ICD=CODES(IDA)
"RTN","SPNJRPC9",35,0)
 . I ICD?1E.E1" " S ICD=$E(ICD,1,($L(ICD)-1))
"RTN","SPNJRPC9",36,0)
 . ;JAS 6/16/09 - DEFECT 1137 - Removed direct reads of CPT/ICD files - Not needed
"RTN","SPNJRPC9",37,0)
 . ;S ICDA=$O(^ICD9("AB",ICD,0))
"RTN","SPNJRPC9",38,0)
 . ;S SPNARY(ICD)=ICDA_"^"_ICD
"RTN","SPNJRPC9",39,0)
 . S SPNARY(ICD)=""
"RTN","SPNJRPC9",40,0)
 . Q
"RTN","SPNJRPC9",41,0)
 ;JAS 05/01/08 DEFECT 1015 - REWROTE FOLLOWING SECTIONS & ELIMINATED 
"RTN","SPNJRPC9",42,0)
 ;                         UNNECESSARY CODE TO CORRECT FOR ALL PATS
"RTN","SPNJRPC9",43,0)
 D GATHER,EN
"RTN","SPNJRPC9",44,0)
 D CLNUP
"RTN","SPNJRPC9",45,0)
 Q
"RTN","SPNJRPC9",46,0)
GATHER ;Start looping through the af xfr of the PTF file
"RTN","SPNJRPC9",47,0)
 K ^TMP("SPN",$J)
"RTN","SPNJRPC9",48,0)
 S SPNADDT=SPNSTRT
"RTN","SPNJRPC9",49,0)
 F  S SPNADDT=$O(^DGPT("AF",SPNADDT)) Q:(SPNADDT="")!('+SPNADDT)  Q:SPNADDT>SPNEND  D
"RTN","SPNJRPC9",50,0)
 . S SPNPTF="",SPNPTF=$O(^DGPT("AF",SPNADDT,SPNPTF)) Q:SPNPTF=""
"RTN","SPNJRPC9",51,0)
 . D TESTPT
"RTN","SPNJRPC9",52,0)
 . Q
"RTN","SPNJRPC9",53,0)
 Q
"RTN","SPNJRPC9",54,0)
TESTPT ;test pt in 154 then icds
"RTN","SPNJRPC9",55,0)
 S SPNDFN=$P($G(^DGPT(SPNPTF,0)),U,1)
"RTN","SPNJRPC9",56,0)
 S SPNICD=$P($G(^DPT(SPNDFN,"MPI")),U,1)
"RTN","SPNJRPC9",57,0)
 I SPNIN="JUST" S FND=0 D
"RTN","SPNJRPC9",58,0)
 . S ICNT="" F  S ICNT=$O(ICNLST(ICNT)) Q:ICNT=""  D  Q:FND
"RTN","SPNJRPC9",59,0)
 . . I ICNLST(ICNT)=SPNICD S FND=1 Q
"RTN","SPNJRPC9",60,0)
 . Q
"RTN","SPNJRPC9",61,0)
 I SPNIN="JUST",'FND Q
"RTN","SPNJRPC9",62,0)
 ;spnans=1 range spnasn=2 just the ones entered
"RTN","SPNJRPC9",63,0)
 S SPNY=0 F A=79,79.16,79.17,79.18,79.19,79.201,79.21,79.22,79.23,79.24 S SPNY=$$GET1^DIQ(45,SPNPTF_",",A) I +SPNY D
"RTN","SPNJRPC9",64,0)
 . I SPNANS=0 I (SPNY]SPNRAN1) I (SPNY']SPNRAN2) S ^TMP("SPN",$J,SPNDFN,SPNPTF)=""
"RTN","SPNJRPC9",65,0)
 . I SPNANS=1 I $D(SPNARY(SPNY)) S ^TMP("SPN",$J,SPNDFN,SPNPTF)=""
"RTN","SPNJRPC9",66,0)
 . Q
"RTN","SPNJRPC9",67,0)
 Q
"RTN","SPNJRPC9",68,0)
EN ;
"RTN","SPNJRPC9",69,0)
 S Y=SPNSTRT X ^DD("DD") S SPNSTRT=Y,Y=SPNEND X ^DD("DD") S SPNEND=Y K Y
"RTN","SPNJRPC9",70,0)
 I $D(^TMP("SPN",$J))=0 Q
"RTN","SPNJRPC9",71,0)
 S ^TMP($J,RETCNT)="HDR999^Patient^SSN^Registration Status^Admission Date^EOL999"
"RTN","SPNJRPC9",72,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPC9",73,0)
 S SPNDFN=0 F  S SPNDFN=$O(^TMP("SPN",$J,SPNDFN)) Q:(SPNDFN=0)!('+SPNDFN)  D EN2
"RTN","SPNJRPC9",74,0)
 Q
"RTN","SPNJRPC9",75,0)
EN2 S SPNREG=""
"RTN","SPNJRPC9",76,0)
 S SPNICD=$P($G(^DPT(SPNDFN,"MPI")),U,1)
"RTN","SPNJRPC9",77,0)
 I SPNICD="" S SPNREG="**NOT IN SCIDO**"
"RTN","SPNJRPC9",78,0)
 I SPNICD'="",'$D(ICNLST(SPNICD)) S SPNREG="**NOT IN SCIDO**"
"RTN","SPNJRPC9",79,0)
 S SPNAM=$P(^DPT(SPNDFN,0),U,1),SPNSSN=$P(^DPT(SPNDFN,0),U,9)
"RTN","SPNJRPC9",80,0)
 S SPNPTF=0 F  S SPNPTF=$O(^TMP("SPN",$J,SPNDFN,SPNPTF)) Q:(SPNPTF=0)!('+SPNPTF)  D EN3
"RTN","SPNJRPC9",81,0)
 Q
"RTN","SPNJRPC9",82,0)
EN3 ;
"RTN","SPNJRPC9",83,0)
 S SPNADDT=$$GET1^DIQ(45,SPNPTF_",",2)
"RTN","SPNJRPC9",84,0)
 S ^TMP($J,RETCNT)="PAT1^"_SPNAM_"^"_SPNSSN_"^"_SPNREG_"^"_SPNADDT_"^EOL999"
"RTN","SPNJRPC9",85,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPC9",86,0)
 S DXLS=$$GET1^DIQ(45,SPNPTF_",",79)
"RTN","SPNJRPC9",87,0)
 S ICD2=$$GET1^DIQ(45,SPNPTF_",",79.16)
"RTN","SPNJRPC9",88,0)
 S ICD3=$$GET1^DIQ(45,SPNPTF_",",79.17)
"RTN","SPNJRPC9",89,0)
 S ICD4=$$GET1^DIQ(45,SPNPTF_",",79.18)
"RTN","SPNJRPC9",90,0)
 S ICD5=$$GET1^DIQ(45,SPNPTF_",",79.19)
"RTN","SPNJRPC9",91,0)
 S ^TMP($J,RETCNT)="ICD1^"_DXLS_"^"_ICD2_"^"_ICD3_"^"_ICD4_"^"_ICD5_"^EOL999"
"RTN","SPNJRPC9",92,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPC9",93,0)
 S ICD6=$$GET1^DIQ(45,SPNPTF_",",79.201)
"RTN","SPNJRPC9",94,0)
 S ICD7=$$GET1^DIQ(45,SPNPTF_",",79.21)
"RTN","SPNJRPC9",95,0)
 S ICD8=$$GET1^DIQ(45,SPNPTF_",",79.22)
"RTN","SPNJRPC9",96,0)
 S ICD9=$$GET1^DIQ(45,SPNPTF_",",79.23)
"RTN","SPNJRPC9",97,0)
 S ICD10=$$GET1^DIQ(45,SPNPTF_",",79.24)
"RTN","SPNJRPC9",98,0)
 S ^TMP($J,RETCNT)="ICD2^"_ICD6_"^"_ICD7_"^"_ICD8_"^"_ICD9_"^"_ICD10_"^EOL999"
"RTN","SPNJRPC9",99,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPC9",100,0)
 Q
"RTN","SPNJRPC9",101,0)
CLNUP ;
"RTN","SPNJRPC9",102,0)
 K %DT,A,AICN,DFN,DXLS,I,ICD,ICD10,ICD2,ICD3,ICD4,ICD5,ICD6,ICD7
"RTN","SPNJRPC9",103,0)
 K ICD8,ICD9,ICDA,ICN,ICNNM,IDA,PATARY,PATLIST,RETCNT,SPN,SPNADDT
"RTN","SPNJRPC9",104,0)
 K SPNAM,SPNDFN,SPNEND,SPNICD,SPNIN,SPNPTF,SPNRAN1,SPNRAN2
"RTN","SPNJRPC9",105,0)
 K SPNREG,SPNSSN,SPNSTRT,SPNY,X,ICNT,FND
"RTN","SPNJRPC9",106,0)
 Q
"RTN","SPNJRPCC")
0^12^B705728
"RTN","SPNJRPCC",1,0)
SPNJRPCC ;BP/JAS - Returns SCI Coordinator Providers from New Person file ;JUL 28, 2008
"RTN","SPNJRPCC",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNJRPCC",3,0)
 ;
"RTN","SPNJRPCC",4,0)
 ; Reference to file 200 supported by IA #10060
"RTN","SPNJRPCC",5,0)
 ;
"RTN","SPNJRPCC",6,0)
 ; Parm values:
"RTN","SPNJRPCC",7,0)
 ;     RETURN is the sorted data from the earliest date of listing
"RTN","SPNJRPCC",8,0)
 ;
"RTN","SPNJRPCC",9,0)
 ; Returns: ^TMP($J)
"RTN","SPNJRPCC",10,0)
 ;
"RTN","SPNJRPCC",11,0)
COL(RETURN,CPSRCH) ;
"RTN","SPNJRPCC",12,0)
 ;***************************
"RTN","SPNJRPCC",13,0)
 I '$D(CPSRCH) S CPSRCH=""
"RTN","SPNJRPCC",14,0)
 S RETURN=$NA(^TMP($J)),RETCNT=1
"RTN","SPNJRPCC",15,0)
 K ^TMP($J)
"RTN","SPNJRPCC",16,0)
 D LIST^DIC(200,"",.01,"Q","","",CPSRCH,"B")
"RTN","SPNJRPCC",17,0)
 S NPDA=""
"RTN","SPNJRPCC",18,0)
 F  S NPDA=$O(^TMP("DILIST",$J,1,NPDA)) Q:NPDA=""  D
"RTN","SPNJRPCC",19,0)
 . S NPNAM=^TMP("DILIST",$J,1,NPDA)
"RTN","SPNJRPCC",20,0)
 . S ^TMP($J,RETCNT)=NPNAM_"^EOL999"
"RTN","SPNJRPCC",21,0)
 . S RETCNT=RETCNT+1
"RTN","SPNJRPCC",22,0)
 K NPDA,NPNAM,RETCNT,^TMP("DILIST",$J)
"RTN","SPNJRPCC",23,0)
 Q
"RTN","SPNJRPCD")
0^13^B26963457
"RTN","SPNJRPCD",1,0)
SPNJRPCD ;BP/JAS - Returns Discharge to Community info ;Dec 14, 2009
"RTN","SPNJRPCD",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNJRPCD",3,0)
 ;
"RTN","SPNJRPCD",4,0)
 ; References to file 45 supported by IA# 92
"RTN","SPNJRPCD",5,0)
 ; References to ^DGPT supported by IA# 4945
"RTN","SPNJRPCD",6,0)
 ; Reference to ^DIC(4 supported by IA# 10090
"RTN","SPNJRPCD",7,0)
 ; References to ^DIC(45.6 supported by IA# 4018
"RTN","SPNJRPCD",8,0)
 ; References to ^DIC(45.1 supported by IA# 4944
"RTN","SPNJRPCD",9,0)
 ; Reference to API $$IEN^XUAF4 is supported by IA# 2171
"RTN","SPNJRPCD",10,0)
 ; API $$FLIP^SPNRPCIC is part of Spinal Cord Version 3.0
"RTN","SPNJRPCD",11,0)
 ;
"RTN","SPNJRPCD",12,0)
 ; Parm values:
"RTN","SPNJRPCD",13,0)
 ;     RETURN  is the sorted data from the earliest date of listing
"RTN","SPNJRPCD",14,0)
 ;     ICNLST  is the list of patient ICNs to process
"RTN","SPNJRPCD",15,0)
 ;     FDATE   is the delivery starting date
"RTN","SPNJRPCD",16,0)
 ;     TDATE   is the delivery ending date
"RTN","SPNJRPCD",17,0)
 ;
"RTN","SPNJRPCD",18,0)
 ; Returns: ^TMP($J)
"RTN","SPNJRPCD",19,0)
 ;
"RTN","SPNJRPCD",20,0)
COL(RETURN,ICNLST,FDATE,TDATE) ;
"RTN","SPNJRPCD",21,0)
 ;
"RTN","SPNJRPCD",22,0)
 ;***************************
"RTN","SPNJRPCD",23,0)
 S RETURN=$NA(^TMP($J)),RETCNT=1
"RTN","SPNJRPCD",24,0)
 S X=FDATE S %DT="T" D ^%DT S SPNSTRT=Y
"RTN","SPNJRPCD",25,0)
 S X=TDATE S %DT="T" D ^%DT S SPNEND=Y_.2359
"RTN","SPNJRPCD",26,0)
 S SRCLIST="1A^1B^1C^1J^1K^1M^1P^1R^1S^1T^2A^2B^2C^3A^3B^3C^3D^3E^4A^4B^4M^4N^4P^4Q^4R^4S^4T^4U^4W^4Y^5A^5B^5G^6A^6D^7B"
"RTN","SPNJRPCD",27,0)
 ;***************************
"RTN","SPNJRPCD",28,0)
 K ^TMP($J),^TMP("SPN",$J),CARRY
"RTN","SPNJRPCD",29,0)
 F ICNNM=1:1:$L(ICNLST,"^") S ICN=$P(ICNLST,"^",ICNNM) D IN
"RTN","SPNJRPCD",30,0)
 D OUT,CLNUP
"RTN","SPNJRPCD",31,0)
 Q
"RTN","SPNJRPCD",32,0)
IN Q:$G(ICN)=""
"RTN","SPNJRPCD",33,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNJRPCD",34,0)
 Q:$G(DFN)=""
"RTN","SPNJRPCD",35,0)
 ;***************************
"RTN","SPNJRPCD",36,0)
 Q:'$D(^DGPT("B",DFN))
"RTN","SPNJRPCD",37,0)
 ;JAS - 05/15/08 - DEFECT 1090
"RTN","SPNJRPCD",38,0)
 ;S PDA=""
"RTN","SPNJRPCD",39,0)
 S PDA=0
"RTN","SPNJRPCD",40,0)
 F  S PDA=$O(^DGPT("B",DFN,PDA)) Q:PDA=""  D
"RTN","SPNJRPCD",41,0)
 . Q:'$D(^DGPT(PDA,0))
"RTN","SPNJRPCD",42,0)
 . S PREC0=^DGPT(PDA,0)
"RTN","SPNJRPCD",43,0)
 . S DIVN=$P(PREC0,"^",3)
"RTN","SPNJRPCD",44,0)
 . Q:DIVN=""
"RTN","SPNJRPCD",45,0)
 . ;JAS - DEFECT 1180 - Retrieve Station Name by Institution ien instead of Station Number
"RTN","SPNJRPCD",46,0)
 . S DIEN=$$IEN^XUAF4(DIVN)
"RTN","SPNJRPCD",47,0)
 . ;S STAT=$$GET1^DIQ(4,DIVN_",",.01)
"RTN","SPNJRPCD",48,0)
 . S STAT=$$GET1^DIQ(4,DIEN_",",.01)
"RTN","SPNJRPCD",49,0)
 . I $D(^TMP("SPN","AD",STAT)) S ^TMP("SPN","AD",STAT)=^TMP("SPN","AD",STAT)+1
"RTN","SPNJRPCD",50,0)
 . E  S ^TMP("SPN","AD",STAT)=1
"RTN","SPNJRPCD",51,0)
 . S DISDAT=$$GET1^DIQ(45,PDA_",",70,"I")\1
"RTN","SPNJRPCD",52,0)
 . Q:DISDAT=""
"RTN","SPNJRPCD",53,0)
 . Q:DISDAT<SPNSTRT!(DISDAT>SPNEND)
"RTN","SPNJRPCD",54,0)
 . I $D(^TMP("SPN","DIS",STAT)) S ^TMP("SPN","DIS",STAT)=^TMP("SPN","DIS",STAT)+1
"RTN","SPNJRPCD",55,0)
 . E  S ^TMP("SPN","DIS",STAT)=1
"RTN","SPNJRPCD",56,0)
 . D DEM^VADPT
"RTN","SPNJRPCD",57,0)
 . S ADDTM=$$GET1^DIQ(45,PDA_",",2,"I")\1
"RTN","SPNJRPCD",58,0)
 . S ADDT=$$FMTE^XLFDT(ADDTM,"5DZP")
"RTN","SPNJRPCD",59,0)
 . S DISDAT=$$FMTE^XLFDT(DISDAT,"5DZP")
"RTN","SPNJRPCD",60,0)
 . S PREC70=^DGPT(PDA,70)
"RTN","SPNJRPCD",61,0)
 . S SPEC=$$GET1^DIQ(45,PDA_",",71)
"RTN","SPNJRPCD",62,0)
 . S DCCD=$$GET1^DIQ(45,PDA_",",72,"I")
"RTN","SPNJRPCD",63,0)
 . S DCTYP=$$GET1^DIQ(45,PDA_",",72)
"RTN","SPNJRPCD",64,0)
 . S DESP=$P(PREC70,"^",6) I DESP'="" D
"RTN","SPNJRPCD",65,0)
 . . S DEST=$P($G(^DIC(45.6,DESP,0)),"^",1)
"RTN","SPNJRPCD",66,0)
 . . S DESCD=$P($G(^DIC(45.6,DESP,0)),"^",2)
"RTN","SPNJRPCD",67,0)
 . S SRCE=$P($G(^DGPT(PDA,101)),"^",1) I SRCE'="" D
"RTN","SPNJRPCD",68,0)
 . . S ADCODE=$P($G(^DIC(45.1,SRCE,0)),"^",1)
"RTN","SPNJRPCD",69,0)
 . . S ADSRCE=$P($G(^DIC(45.1,SRCE,0)),"^",2)
"RTN","SPNJRPCD",70,0)
 . I $D(DCCD),$D(ADCODE),DCCD=1!(DCCD=2)!(DCCD=3)!(DCCD=5)&(SRCLIST[ADCODE) D
"RTN","SPNJRPCD",71,0)
 . . I $D(^TMP("SPN",$J,"DENOM",STAT,DIVN)) S ^TMP("SPN",$J,"DENOM",STAT,DIVN)=^TMP("SPN",$J,"DENOM",STAT,DIVN)+1
"RTN","SPNJRPCD",72,0)
 . . E  S ^TMP("SPN",$J,"DENOM",STAT,DIVN)=1
"RTN","SPNJRPCD",73,0)
 . . I $D(DESCD),DESCD="X"!(DESCD="F")!(DESCD="G")!(DESCD="H")!(DESCD="K")!(DESCD="P")!(DESCD="U")!(DESCD="T")!(DESCD="M")!(DESCD="Y")!(DESCD="Z") D
"RTN","SPNJRPCD",74,0)
 . . . I $D(^TMP("SPN",$J,"NUMER",STAT,DIVN)) S ^TMP("SPN",$J,"NUMER",STAT,DIVN)=^TMP("SPN",$J,"NUMER",STAT,DIVN)+1
"RTN","SPNJRPCD",75,0)
 . . . E  S ^TMP("SPN",$J,"NUMER",STAT,DIVN)=1
"RTN","SPNJRPCD",76,0)
 . Q:STAT=""!(DIVN="")!(VADM(1)="")!(VA("PID")="")!(ADDTM="")!(PDA="")
"RTN","SPNJRPCD",77,0)
 . S ^TMP("SPN",$J,"DETAIL",STAT,DIVN,VADM(1),VA("PID"),ADDTM,PDA)=STAT_"^"_DIVN_"^"_VADM(1)_"^"_VA("PID")_"^"_$G(ADDT)_"^"_$G(DISDAT)_"^"_$G(SPEC)_"^"_$G(ADSRCE)_"^"_$G(ADCODE)_"^"_$G(DCTYP)_"^"_$G(DCCD)_"^"_$G(DEST)_"^"_$G(DESCD)
"RTN","SPNJRPCD",78,0)
 . K ADDT,DISDAT,SPEC,ADSRCE,ADCODE,DCTYP,DCCD,DEST,DESCD
"RTN","SPNJRPCD",79,0)
 Q
"RTN","SPNJRPCD",80,0)
OUT ;
"RTN","SPNJRPCD",81,0)
 S ^TMP($J,RETCNT)="HDR999^Facility Name^Division #^Veteran^SSN^Admission Date^Discharge Date^Treating Specialty^Admission Source^Admit Code^Discharge Type^DC Code^Destination^Destination Code^EOL999"
"RTN","SPNJRPCD",82,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPCD",83,0)
 S STAT=""
"RTN","SPNJRPCD",84,0)
 F  S STAT=$O(^TMP("SPN",$J,"DETAIL",STAT)) Q:STAT=""  D
"RTN","SPNJRPCD",85,0)
 . S DIVN=""
"RTN","SPNJRPCD",86,0)
 . F  S DIVN=$O(^TMP("SPN",$J,"DETAIL",STAT,DIVN)) Q:DIVN=""  D
"RTN","SPNJRPCD",87,0)
 . . S NAM=""
"RTN","SPNJRPCD",88,0)
 . . F  S NAM=$O(^TMP("SPN",$J,"DETAIL",STAT,DIVN,NAM)) Q:NAM=""  D
"RTN","SPNJRPCD",89,0)
 . . . S SSN=""
"RTN","SPNJRPCD",90,0)
 . . . F  S SSN=$O(^TMP("SPN",$J,"DETAIL",STAT,DIVN,NAM,SSN)) Q:SSN=""  D
"RTN","SPNJRPCD",91,0)
 . . . . S ADDTM=""
"RTN","SPNJRPCD",92,0)
 . . . . F  S ADDTM=$O(^TMP("SPN",$J,"DETAIL",STAT,DIVN,NAM,SSN,ADDTM)) Q:ADDTM=""  D
"RTN","SPNJRPCD",93,0)
 . . . . . S PDA=""
"RTN","SPNJRPCD",94,0)
 . . . . . F  S PDA=$O(^TMP("SPN",$J,"DETAIL",STAT,DIVN,NAM,SSN,ADDTM,PDA)) Q:PDA=""  D
"RTN","SPNJRPCD",95,0)
 . . . . . . S ^TMP($J,RETCNT)=^TMP("SPN",$J,"DETAIL",STAT,DIVN,NAM,SSN,ADDTM,PDA)_"^EOL999"
"RTN","SPNJRPCD",96,0)
 . . . . . . S RETCNT=RETCNT+1
"RTN","SPNJRPCD",97,0)
 . . S NUMER=$G(^TMP("SPN",$J,"NUMER",STAT,DIVN))
"RTN","SPNJRPCD",98,0)
 . . S DENOM=$G(^TMP("SPN",$J,"DENOM",STAT,DIVN))
"RTN","SPNJRPCD",99,0)
 . . I 'NUMER S CDRATE="0.00"
"RTN","SPNJRPCD",100,0)
 . . E  S CDRATE=(NUMER/DENOM)*100
"RTN","SPNJRPCD",101,0)
 . . S ^TMP($J,RETCNT)="TOT999^Community Discharge Rate^"_$J(CDRATE,".",2)_"^EOL999"
"RTN","SPNJRPCD",102,0)
 . . S RETCNT=RETCNT+1
"RTN","SPNJRPCD",103,0)
 Q
"RTN","SPNJRPCD",104,0)
CLNUP ;
"RTN","SPNJRPCD",105,0)
 K %DT,ADDTM,CDRATE,DENOM,DESP,DFN,DIVN,ICN,ICNNM,NAM,NUMER,PDA,PREC0
"RTN","SPNJRPCD",106,0)
 K PREC70,RETCNT,SPNEND,SPNSTRT,SRCE,SRCLIST,SSN,STAT,VA,VADM,X,Y,DIEN
"RTN","SPNJRPCD",107,0)
 Q
"RTN","SPNJRPCE")
0^14^B947821
"RTN","SPNJRPCE",1,0)
SPNJRPCE ;BP/JAS - Returns most recent Eligibility Enrollment Application ;JUL 28, 2008
"RTN","SPNJRPCE",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNJRPCE",3,0)
 ;
"RTN","SPNJRPCE",4,0)
 ; References to ^DGEN supported by IA# 4947
"RTN","SPNJRPCE",5,0)
 ; API $$FLIP^SPNRPCIC is part of Spinal Cord Version 3.0
"RTN","SPNJRPCE",6,0)
 ;
"RTN","SPNJRPCE",7,0)
 ; Parm values:
"RTN","SPNJRPCE",8,0)
 ;     RETURN is the eligibility priority for a given patient
"RTN","SPNJRPCE",9,0)
 ;
"RTN","SPNJRPCE",10,0)
 ; Returns: ^TMP($J)
"RTN","SPNJRPCE",11,0)
 ;
"RTN","SPNJRPCE",12,0)
COL(RETURN,ICN) ;
"RTN","SPNJRPCE",13,0)
 ;***************************
"RTN","SPNJRPCE",14,0)
 K RETURN
"RTN","SPNJRPCE",15,0)
 Q:$G(ICN)=""
"RTN","SPNJRPCE",16,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNJRPCE",17,0)
 Q:$G(DFN)=""
"RTN","SPNJRPCE",18,0)
 ;***************************
"RTN","SPNJRPCE",19,0)
 Q:'$D(^DGEN(27.11,"C",DFN))
"RTN","SPNJRPCE",20,0)
 S EDA="",EDA=$O(^DGEN(27.11,"C",DFN,EDA),-1)
"RTN","SPNJRPCE",21,0)
 Q:'$D(^DGEN(27.11,EDA,0))
"RTN","SPNJRPCE",22,0)
 S PRIO=$P(^DGEN(27.11,EDA,0),"^",7)
"RTN","SPNJRPCE",23,0)
 I PRIO'="" S PRIO="GROUP "_PRIO
"RTN","SPNJRPCE",24,0)
 S SUBG=$P(^DGEN(27.11,EDA,0),"^",12)
"RTN","SPNJRPCE",25,0)
 S SUBG=$S(SUBG=1:"a",SUBG=3:"c",SUBG=5:"e",SUBG=7:"g",1:"")
"RTN","SPNJRPCE",26,0)
 S RETURN($J)=PRIO_"^"_SUBG_"^EOL999"
"RTN","SPNJRPCE",27,0)
 K DFN,EDA,PRIO,SUBG
"RTN","SPNJRPCE",28,0)
 Q
"RTN","SPNJRPCM")
0^15^B3844721
"RTN","SPNJRPCM",1,0)
SPNJRPCM ;BP/JAS - Returns Sites where Patient has been treated ;FEB 05, 2007
"RTN","SPNJRPCM",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNJRPCM",3,0)
 ;
"RTN","SPNJRPCM",4,0)
 ; References to ^DGCN(391.91 supported by IA# 4943
"RTN","SPNJRPCM",5,0)
 ; Reference to file #4 supported by IA# 10090
"RTN","SPNJRPCM",6,0)
 ; API $$FLIP^SPNRPCIC is part of Spinal Cord Version 3.0
"RTN","SPNJRPCM",7,0)
 ;
"RTN","SPNJRPCM",8,0)
 ; Parm values:
"RTN","SPNJRPCM",9,0)
 ;     RETURN  is the sorted data from the earliest date of listing
"RTN","SPNJRPCM",10,0)
 ;     ICN     is ICN of the patient to process
"RTN","SPNJRPCM",11,0)
 ;
"RTN","SPNJRPCM",12,0)
 ; Returns: ^TMP($J)
"RTN","SPNJRPCM",13,0)
 ;
"RTN","SPNJRPCM",14,0)
COL(RETURN,ICN) ;
"RTN","SPNJRPCM",15,0)
 ;
"RTN","SPNJRPCM",16,0)
 ;***************************
"RTN","SPNJRPCM",17,0)
 K ^TMP($J),^TMP("SPN",$J)
"RTN","SPNJRPCM",18,0)
 S RETURN=$NA(^TMP($J)),RETCNT=1
"RTN","SPNJRPCM",19,0)
 ;***************************
"RTN","SPNJRPCM",20,0)
 Q:$G(ICN)=""
"RTN","SPNJRPCM",21,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNJRPCM",22,0)
 Q:$G(DFN)=""
"RTN","SPNJRPCM",23,0)
 ;***************************
"RTN","SPNJRPCM",24,0)
 D IN,OUT
"RTN","SPNJRPCM",25,0)
 K DFN,MDATE,RDATE,RETCNT,RSITE,SPNIEN,RDA
"RTN","SPNJRPCM",26,0)
 Q
"RTN","SPNJRPCM",27,0)
IN I '$D(^DGCN(391.91,"B",DFN)) S ^TMP($J,RETCNT)="Pt has not been treated at any other VA site.^EOL999" Q
"RTN","SPNJRPCM",28,0)
 S SPNIEN=0
"RTN","SPNJRPCM",29,0)
 F  S SPNIEN=$O(^DGCN(391.91,"B",DFN,SPNIEN)) Q:'+SPNIEN  D
"RTN","SPNJRPCM",30,0)
 . S RDA=$P(^DGCN(391.91,SPNIEN,0),U,2)
"RTN","SPNJRPCM",31,0)
 . S RSITE=$$GET1^DIQ(4,RDA_",",.01)
"RTN","SPNJRPCM",32,0)
 . S MDATE=$P($G(^DGCN(391.91,SPNIEN,0)),U,3)
"RTN","SPNJRPCM",33,0)
 . I MDATE="" S MDATE=0
"RTN","SPNJRPCM",34,0)
 . S RDATE=$$FMTE^XLFDT($P($G(^DGCN(391.91,SPNIEN,0)),U,3),"5DZ")
"RTN","SPNJRPCM",35,0)
 . I RDATE="" S RDATE="DATE IS MISSING"
"RTN","SPNJRPCM",36,0)
 . S ^TMP("SPN",$J,MDATE,SPNIEN)=RSITE_"^"_RDATE
"RTN","SPNJRPCM",37,0)
 Q
"RTN","SPNJRPCM",38,0)
OUT S ^TMP($J,RETCNT)="HDR999^Pt Has Been Treated at^Date Last Treated^EOL999",RETCNT=RETCNT+1
"RTN","SPNJRPCM",39,0)
 S MDATE=""
"RTN","SPNJRPCM",40,0)
 F  S MDATE=$O(^TMP("SPN",$J,MDATE),-1) Q:MDATE=""  D
"RTN","SPNJRPCM",41,0)
 . S SPNIEN=""
"RTN","SPNJRPCM",42,0)
 . F  S SPNIEN=$O(^TMP("SPN",$J,MDATE,SPNIEN)) Q:SPNIEN=""  D
"RTN","SPNJRPCM",43,0)
 . . S ^TMP($J,RETCNT)=^TMP("SPN",$J,MDATE,SPNIEN)_"^EOL999"
"RTN","SPNJRPCM",44,0)
 . . S RETCNT=RETCNT+1
"RTN","SPNJRPCM",45,0)
 Q
"RTN","SPNJRPCP")
0^16^B454442
"RTN","SPNJRPCP",1,0)
SPNJRPCP ;BP/JAS - Returns most recent Vitals Pain Rating ;Jan 10, 2008
"RTN","SPNJRPCP",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNJRPCP",3,0)
 ;
"RTN","SPNJRPCP",4,0)
 ; Reference to API EN6^GMRVUTL supported by IA #1120
"RTN","SPNJRPCP",5,0)
 ; API $$FLIP^SPNRPCIC is part of Spinal Cord Version 3.0
"RTN","SPNJRPCP",6,0)
 ;
"RTN","SPNJRPCP",7,0)
 ; Parm values:
"RTN","SPNJRPCP",8,0)
 ;     RETURN is the most recent Vitals Pain Rating for patient
"RTN","SPNJRPCP",9,0)
 ;
"RTN","SPNJRPCP",10,0)
 ; Returns: ^TMP($J)
"RTN","SPNJRPCP",11,0)
 ;
"RTN","SPNJRPCP",12,0)
COL(RETURN,ICN) ;
"RTN","SPNJRPCP",13,0)
 ;***************************
"RTN","SPNJRPCP",14,0)
 K RETURN
"RTN","SPNJRPCP",15,0)
 Q:$G(ICN)=""
"RTN","SPNJRPCP",16,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNJRPCP",17,0)
 Q:$G(DFN)=""
"RTN","SPNJRPCP",18,0)
 ;***************************
"RTN","SPNJRPCP",19,0)
 ;JAS - 01/10/2008 - Defect 766 DBIA Changes 
"RTN","SPNJRPCP",20,0)
 ;Section of code below commented out and replaced due to DBIA changes
"RTN","SPNJRPCP",21,0)
 ;Q:'$D(^GMR(120.5,"C",DFN))
"RTN","SPNJRPCP",22,0)
 ;S VDA="",FOUND=0
"RTN","SPNJRPCP",23,0)
 ;F  S VDA=$O(^GMR(120.5,"C",DFN,VDA),-1) Q:VDA=""!(FOUND)  D
"RTN","SPNJRPCP",24,0)
 ;. Q:'$D(^GMR(120.5,VDA,0))
"RTN","SPNJRPCP",25,0)
 ;. Q:$P($G(^GMR(120.5,VDA,2)),"^",1)=1
"RTN","SPNJRPCP",26,0)
 ;. S VTYPE=$P(^GMR(120.5,VDA,0),"^",3)
"RTN","SPNJRPCP",27,0)
 ;. Q:'$D(^GMRD(120.51,VTYPE))
"RTN","SPNJRPCP",28,0)
 ;. Q:$P($G(^GMRD(120.51,VTYPE,0)),"^",1)'="PAIN"
"RTN","SPNJRPCP",29,0)
 ;. S FOUND=1
"RTN","SPNJRPCP",30,0)
 ;. S PRAT=$P(^GMR(120.5,VDA,0),"^",8)
"RTN","SPNJRPCP",31,0)
 ;. S RETURN($J)=PRAT_"^EOL999"
"RTN","SPNJRPCP",32,0)
 ;. Q
"RTN","SPNJRPCP",33,0)
 ;K DFN,FOUND,PRAT,VDA,VTYPE
"RTN","SPNJRPCP",34,0)
 S GMRVSTR="PN"
"RTN","SPNJRPCP",35,0)
 D EN6^GMRVUTL
"RTN","SPNJRPCP",36,0)
 S PRAT=$P(X,U,8)
"RTN","SPNJRPCP",37,0)
 Q:PRAT=""
"RTN","SPNJRPCP",38,0)
 S RETURN($J)=PRAT_"^EOL999"
"RTN","SPNJRPCP",39,0)
 K DFN,GMRVSTR,PRAT,X
"RTN","SPNJRPCP",40,0)
 Q
"RTN","SPNJRPCS")
0^17^B842386
"RTN","SPNJRPCS",1,0)
SPNJRPCS ;BP/JAS - Returns VA SCI Status ;Dec 15, 2006
"RTN","SPNJRPCS",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNJRPCS",3,0)
 ;
"RTN","SPNJRPCS",4,0)
 ; Reference to ^DPT(D0,57 supported by IA #4946
"RTN","SPNJRPCS",5,0)
 ;
"RTN","SPNJRPCS",6,0)
 ; Parm values:
"RTN","SPNJRPCS",7,0)
 ;     RETURN is the VA SCI Status for patient
"RTN","SPNJRPCS",8,0)
 ;
"RTN","SPNJRPCS",9,0)
 ; Returns: RETURN($J)
"RTN","SPNJRPCS",10,0)
 ;
"RTN","SPNJRPCS",11,0)
COL(RETURN,ICN) ;
"RTN","SPNJRPCS",12,0)
 ;***************************
"RTN","SPNJRPCS",13,0)
 K RETURN
"RTN","SPNJRPCS",14,0)
 Q:$G(ICN)=""
"RTN","SPNJRPCS",15,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNJRPCS",16,0)
 Q:$G(DFN)=""
"RTN","SPNJRPCS",17,0)
 ;***************************
"RTN","SPNJRPCS",18,0)
 S VAS=$$GET1^DIQ(2,DFN_",",57.4,"I")
"RTN","SPNJRPCS",19,0)
 S VASN=$$GET1^DIQ(2,DFN_",",57.4)
"RTN","SPNJRPCS",20,0)
 I VAS=1!(VAS=2)!(VAS=3)!(VAS=4)!(VAS="X") S VASN=VAS_" = "_VASN
"RTN","SPNJRPCS",21,0)
 I VAS'=1&(VAS'=2)&(VAS'=3)&(VAS'=4)&(VAS'="X") S VASN="X = NOT APPLICABLE"
"RTN","SPNJRPCS",22,0)
 S RETURN($J)=VASN_"^EOL999"
"RTN","SPNJRPCS",23,0)
 K DFN,VAS,VASN
"RTN","SPNJRPCS",24,0)
 Q
"RTN","SPNJRPCX")
0^18^B81896576
"RTN","SPNJRPCX",1,0)
SPNJRPCX ;BP/JAS - CPTS/ICDS CODES & DESCRIPTS ;Jun 17, 2009
"RTN","SPNJRPCX",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNJRPCX",3,0)
 ;
"RTN","SPNJRPCX",4,0)
 ; References to file #45/^DGPT supported by IA #92 and IA #4945
"RTN","SPNJRPCX",5,0)
 ; RETIRED AND REPLACED WITH IA# 3990 [Reference to ^ICD0 supported by IA #10083]
"RTN","SPNJRPCX",6,0)
 ; Reference to API ICDOP^ICDCODE supported by IA #3990
"RTN","SPNJRPCX",7,0)
 ; RETIRED AND REPLACED WITH IA# 3990 [Reference to ^ICD9 supported by IA #10082]
"RTN","SPNJRPCX",8,0)
 ; Reference to API ICDDX^ICDCODE supported by IA #3990
"RTN","SPNJRPCX",9,0)
 ; Reference to API ICDD^ICDCODE supported by IA# 3990
"RTN","SPNJRPCX",10,0)
 ; Reference to API VISIT^PXRHS01 supported by IA #1238
"RTN","SPNJRPCX",11,0)
 ; Reference to ^ICPT supported by IA #2815
"RTN","SPNJRPCX",12,0)
 ; Reference to API CPT^ICPTCOD supported by IA #1995
"RTN","SPNJRPCX",13,0)
 ; Reference to API CPTD^ICPTCOD supported by IA #1995
"RTN","SPNJRPCX",14,0)
 ; References to ^SRF supported by IA #3615
"RTN","SPNJRPCX",15,0)
 ; Reference to ^SRO supported by IA #4872
"RTN","SPNJRPCX",16,0)
 ; API $$FLIP^SPNRPCIC is part of Spinal Cord Version 3.0
"RTN","SPNJRPCX",17,0)
 ;
"RTN","SPNJRPCX",18,0)
COL(ROOT,ICN,SPNCUTDT) ;
"RTN","SPNJRPCX",19,0)
 ; return is TMP($J)
"RTN","SPNJRPCX",20,0)
 K ^TMP($J)  ;This is the return file
"RTN","SPNJRPCX",21,0)
 S ROOT=$NA(^TMP($J))
"RTN","SPNJRPCX",22,0)
 ;*********************************************
"RTN","SPNJRPCX",23,0)
 ;  convert icn to dfn
"RTN","SPNJRPCX",24,0)
 Q:$G(ICN)=""
"RTN","SPNJRPCX",25,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNJRPCX",26,0)
 Q:DFN=""
"RTN","SPNJRPCX",27,0)
 ;*********************************************
"RTN","SPNJRPCX",28,0)
 I '$D(^DPT(+$G(DFN))) Q
"RTN","SPNJRPCX",29,0)
 ;             1825= 5 years
"RTN","SPNJRPCX",30,0)
 S X=SPNCUTDT D ^%DT S SPNCUTDT=Y
"RTN","SPNJRPCX",31,0)
JUMPIN1 ;CALLED FROM SPNRPC8 WITH TODAY AS THE CUT DATE
"RTN","SPNJRPCX",32,0)
 S CNT=0  ;used to order the icd9's and icd0's
"RTN","SPNJRPCX",33,0)
 S CPTCNT=0  ;used to order the cpt's
"RTN","SPNJRPCX",34,0)
 S SPNPTFIE=0
"RTN","SPNJRPCX",35,0)
 F  S SPNPTFIE=$O(^DGPT("B",DFN,SPNPTFIE)) Q:(SPNPTFIE="")!('+SPNPTFIE)  D SET45
"RTN","SPNJRPCX",36,0)
 ;
"RTN","SPNJRPCX",37,0)
 D VCPT  ;Build visit file cpt's
"RTN","SPNJRPCX",38,0)
 D SURG
"RTN","SPNJRPCX",39,0)
 D ENTER^SPNJRPX2
"RTN","SPNJRPCX",40,0)
 D CREATE
"RTN","SPNJRPCX",41,0)
 D CLNUP
"RTN","SPNJRPCX",42,0)
 Q
"RTN","SPNJRPCX",43,0)
SET45 ;loop thgough PTF file and set up in rev date order
"RTN","SPNJRPCX",44,0)
 S SPNPTADM=$$GET1^DIQ(45,SPNPTFIE_",",2,"I")
"RTN","SPNJRPCX",45,0)
 Q:SPNPTADM<SPNCUTDT
"RTN","SPNJRPCX",46,0)
 S SPNREV=9999999.9999-SPNPTADM
"RTN","SPNJRPCX",47,0)
 S SPNPTRDT=$$GET1^DIQ(45,SPNPTFIE_",",2,"E")
"RTN","SPNJRPCX",48,0)
 D BLD
"RTN","SPNJRPCX",49,0)
 Q
"RTN","SPNJRPCX",50,0)
BLD ;codes from ptf file
"RTN","SPNJRPCX",51,0)
 ;get icdo's from pft file
"RTN","SPNJRPCX",52,0)
 F SPNFLD=45.01,45.02,45.03,45.04,45.05 D
"RTN","SPNJRPCX",53,0)
 . S XYZ=$$GET1^DIQ(45,SPNPTFIE_",",SPNFLD,"I")
"RTN","SPNJRPCX",54,0)
 . Q:XYZ=""
"RTN","SPNJRPCX",55,0)
 . ;JAS 6/17/09 - DEFECT 1137 - Removed direct reads of CPT/ICD files to API usage
"RTN","SPNJRPCX",56,0)
 . ;S XYZZ=$P($G(^ICD0(XYZ,0)),U,4)
"RTN","SPNJRPCX",57,0)
 . S SPNARY=$$ICDOP^ICDCODE(XYZ,"","","")
"RTN","SPNJRPCX",58,0)
 . S XYZZ=$P(SPNARY,"^",5)
"RTN","SPNJRPCX",59,0)
 . S CNT=CNT+1
"RTN","SPNJRPCX",60,0)
 . ;S ^TMP($J,"UTIL","ICD",SPNREV,CNT)=$P($G(^ICD0(XYZ,0)),U,4)_U_$P($G(^ICD0(XYZ,0)),U,1)_U_SPNPTRDT_U
"RTN","SPNJRPCX",61,0)
 . S ^TMP($J,"UTIL","ICD",SPNREV,CNT)=XYZZ_U_$P(SPNARY,U,2)_U_SPNPTRDT_U
"RTN","SPNJRPCX",62,0)
 K SPNARY
"RTN","SPNJRPCX",63,0)
 ;---------------------------------------------
"RTN","SPNJRPCX",64,0)
 ;get icd9's from pft file
"RTN","SPNJRPCX",65,0)
 F SPNFLD=79,79.16,79.17,79.18,79.19,79.201,79.21,79.22,79.23,79.24,80 D
"RTN","SPNJRPCX",66,0)
 . S XYZ=$$GET1^DIQ(45,SPNPTFIE_",",SPNFLD,"I")
"RTN","SPNJRPCX",67,0)
 . Q:XYZ=""
"RTN","SPNJRPCX",68,0)
 . ;JAS 6/17/09 - DEFECT 1137 - Removed direct reads of CPT/ICD files to API usage
"RTN","SPNJRPCX",69,0)
 . ;S XYZZ=$P($G(^ICD9(XYZ,0)),U,3)
"RTN","SPNJRPCX",70,0)
 . S SPNARY=$$ICDDX^ICDCODE(XYZ,"","","")
"RTN","SPNJRPCX",71,0)
 . S XYZZ=$P(SPNARY,"^",4)
"RTN","SPNJRPCX",72,0)
 . S CNT=CNT+1
"RTN","SPNJRPCX",73,0)
 . ;S ^TMP($J,"UTIL","ICD",SPNREV,CNT)=$P($G(^ICD9(XYZ,0)),U,3)_U_$P($G(^ICD9(XYZ,0)),U,1)_U_SPNPTRDT_U
"RTN","SPNJRPCX",74,0)
 . S ^TMP($J,"UTIL","ICD",SPNREV,CNT)=XYZZ_U_$P(SPNARY,U,2)_U_SPNPTRDT_U
"RTN","SPNJRPCX",75,0)
 K SPNARY
"RTN","SPNJRPCX",76,0)
BLD2 ;get 40 subscript
"RTN","SPNJRPCX",77,0)
 S SPNXY=0 F  S SPNXY=$O(^DGPT(SPNPTFIE,"S",SPNXY)) Q:(SPNXY=0)!('+SPNXY)  D
"RTN","SPNJRPCX",78,0)
 . S SPNSUDT=$$GET1^DIQ(45.01,SPNXY_","_SPNPTFIE_",",.01,"I")
"RTN","SPNJRPCX",79,0)
 . Q:SPNSUDT=""
"RTN","SPNJRPCX",80,0)
 . S Y=SPNSUDT X ^DD("DD") S SPNXXYZ=Y  ;date time
"RTN","SPNJRPCX",81,0)
 . S SPNSUDT=9999999.9999-SPNSUDT  ;rev date time
"RTN","SPNJRPCX",82,0)
 . F SPNFLD=8,9,10,11,12 D
"RTN","SPNJRPCX",83,0)
 . . S XYZ=$$GET1^DIQ(45.01,SPNXY_","_SPNPTFIE_",",SPNFLD,"I")
"RTN","SPNJRPCX",84,0)
 . . Q:XYZ=""
"RTN","SPNJRPCX",85,0)
 . . ;JAS 6/17/09 - DEFECT 1137 - Removed direct reads of CPT/ICD files to API usage
"RTN","SPNJRPCX",86,0)
 . . S SPNARY=$$ICDOP^ICDCODE(XYZ,"","","")
"RTN","SPNJRPCX",87,0)
 . . S CNT=CNT+1
"RTN","SPNJRPCX",88,0)
 . . ;S ^TMP($J,"UTIL","ICD",SPNSUDT,CNT)=$P($G(^ICD0(XYZ,0)),U,4)_U_$P($G(^ICD0(XYZ,0)),U,1)_U_SPNXXYZ_U
"RTN","SPNJRPCX",89,0)
 . . S ^TMP($J,"UTIL","ICD",SPNSUDT,CNT)=$P(SPNARY,U,5)_U_$P(SPNARY,U,2)_U_SPNXXYZ_U
"RTN","SPNJRPCX",90,0)
 . Q
"RTN","SPNJRPCX",91,0)
 K SPNARY
"RTN","SPNJRPCX",92,0)
 ;get the 60's now
"RTN","SPNJRPCX",93,0)
 S SPNXY=0 F  S SPNXY=$O(^DGPT(SPNPTFIE,"P",SPNXY)) Q:(SPNXY=0)!('+SPNXY)  D
"RTN","SPNJRPCX",94,0)
 . S SPNSUDT=$$GET1^DIQ(45.05,SPNXY_","_SPNPTFIE_",",.01,"I")
"RTN","SPNJRPCX",95,0)
 . Q:SPNSUDT=""
"RTN","SPNJRPCX",96,0)
 . S Y=SPNSUDT X ^DD("DD") S SPNXXYZ=Y  ;date time
"RTN","SPNJRPCX",97,0)
 . S SPNSUDT=9999999.9999-SPNSUDT
"RTN","SPNJRPCX",98,0)
 . F SPNFLD=5,6,7,8,9 D
"RTN","SPNJRPCX",99,0)
 . . S XYZ=$$GET1^DIQ(45.05,SPNXY_","_SPNPTFIE_",",SPNFLD,"I")
"RTN","SPNJRPCX",100,0)
 . . Q:XYZ=""
"RTN","SPNJRPCX",101,0)
 . . ;JAS 6/17/09 - DEFECT 1137 - Removed direct reads of CPT/ICD files to API usage
"RTN","SPNJRPCX",102,0)
 . . S SPNARY=$$ICDOP^ICDCODE(XYZ,"","","")
"RTN","SPNJRPCX",103,0)
 . . S CNT=CNT+1
"RTN","SPNJRPCX",104,0)
 . . ;S ^TMP($J,"UTIL","ICD",SPNSUDT,CNT)=$P($G(^ICD0(XYZ,0)),U,4)_U_$P($G(^ICD0(XYZ,0)),U,1)_U_SPNXXYZ_U
"RTN","SPNJRPCX",105,0)
 . . S ^TMP($J,"UTIL","ICD",SPNSUDT,CNT)=$P(SPNARY,U,5)_U_$P(SPNARY,U,2)_U_SPNXXYZ_U
"RTN","SPNJRPCX",106,0)
 K SPNARY
"RTN","SPNJRPCX",107,0)
 Q
"RTN","SPNJRPCX",108,0)
VCPT ;------------------------------------------------------------------
"RTN","SPNJRPCX",109,0)
 ;visit file cpt's
"RTN","SPNJRPCX",110,0)
 K ^TMP("PXHSV",$J)
"RTN","SPNJRPCX",111,0)
 ;02/26/08 JAS DEFECTS 188,191&192 - MODIFIED VCPT/VCPT2 TO INCLUDE ICDS ALONG WITH CPTS
"RTN","SPNJRPCX",112,0)
 ;D VISIT^PXRHS01(DFN,"",SPNCUTDT,"","AHICTNSOERDX","C",1)
"RTN","SPNJRPCX",113,0)
 D VISIT^PXRHS01(DFN,"",SPNCUTDT,"","AHICTNSOERDX","CD",1)
"RTN","SPNJRPCX",114,0)
 F CDTYP="C","D" D VCPT2
"RTN","SPNJRPCX",115,0)
 K RVDT,COUNT,X,VTMSTMP,MDT,XSTRING,ICPTIEN,CDTYP,CDTYP2
"RTN","SPNJRPCX",116,0)
 K ^TMP("PXHSV",$J)
"RTN","SPNJRPCX",117,0)
 Q
"RTN","SPNJRPCX",118,0)
VCPT2 ;
"RTN","SPNJRPCX",119,0)
 S RVDT=""
"RTN","SPNJRPCX",120,0)
 F  S RVDT=$O(^TMP("PXHSV",$J,RVDT)) Q:RVDT=""  D
"RTN","SPNJRPCX",121,0)
 .S COUNT=""
"RTN","SPNJRPCX",122,0)
 .F  S COUNT=$O(^TMP("PXHSV",$J,RVDT,COUNT)) Q:COUNT=""  D
"RTN","SPNJRPCX",123,0)
 ..;Q:'$D(^TMP("PXHSV",$J,RVDT,COUNT,"C"))
"RTN","SPNJRPCX",124,0)
 ..Q:'$D(^TMP("PXHSV",$J,RVDT,COUNT,CDTYP))
"RTN","SPNJRPCX",125,0)
 ..S X=""
"RTN","SPNJRPCX",126,0)
 ..;F  S X=$O(^TMP("PXHSV",$J,RVDT,COUNT,"C",X)) Q:X=""  D
"RTN","SPNJRPCX",127,0)
 ..F  S X=$O(^TMP("PXHSV",$J,RVDT,COUNT,CDTYP,X)) Q:X=""  D
"RTN","SPNJRPCX",128,0)
 ...;S ICPTIEN=$P(^TMP("PXHSV",$J,RVDT,COUNT,"C",X),"^",1)
"RTN","SPNJRPCX",129,0)
 ...S ICPTIEN=$P(^TMP("PXHSV",$J,RVDT,COUNT,CDTYP,X),"^",1)
"RTN","SPNJRPCX",130,0)
 ...S MDT=9999999-$P(RVDT,".",1)
"RTN","SPNJRPCX",131,0)
 ...S TMSTMP=MDT_"."_$P(RVDT,".",2)
"RTN","SPNJRPCX",132,0)
 ...S Y=TMSTMP X ^DD("DD") S VTMSTMP=Y  ;date time
"RTN","SPNJRPCX",133,0)
 ...I MDT<2890101 S MDT=2890101
"RTN","SPNJRPCX",134,0)
 ...;S XSTRING=$$CPT^ICPTCOD(ICPTIEN,MDT,"")
"RTN","SPNJRPCX",135,0)
 ...;S XYZZ=$P(XSTRING,"^",2)
"RTN","SPNJRPCX",136,0)
 ...;S XYZ=$P(XSTRING,"^",3)
"RTN","SPNJRPCX",137,0)
 ...I CDTYP="C" D
"RTN","SPNJRPCX",138,0)
 ....S XSTRING=$$CPT^ICPTCOD(ICPTIEN,MDT,"")
"RTN","SPNJRPCX",139,0)
 ....S XYZZ=$P(XSTRING,"^",2)
"RTN","SPNJRPCX",140,0)
 ....S XYZ=$P(XSTRING,"^",3)
"RTN","SPNJRPCX",141,0)
 ....S CDTYP2="CPT"
"RTN","SPNJRPCX",142,0)
 ...I CDTYP="D" D
"RTN","SPNJRPCX",143,0)
 ....;JAS 6/17/09 - DEFECT 1137 - Removed direct reads of CPT/ICD files to API usage
"RTN","SPNJRPCX",144,0)
 ....S SPNARY=$$ICDDX^ICDCODE(ICPTIEN,"","","")
"RTN","SPNJRPCX",145,0)
 ....;S XYZZ=$P($G(^ICD9(ICPTIEN,0)),U,1)
"RTN","SPNJRPCX",146,0)
 ....S XYZZ=$P(SPNARY,"^",2)
"RTN","SPNJRPCX",147,0)
 ....;S XYZ=$P($G(^ICD9(ICPTIEN,0)),U,3)
"RTN","SPNJRPCX",148,0)
 ....S XYZ=$P(SPNARY,"^",4)
"RTN","SPNJRPCX",149,0)
 ....S CDTYP2="ICD"
"RTN","SPNJRPCX",150,0)
 ...S CPTCNT=CPTCNT+1
"RTN","SPNJRPCX",151,0)
 ...;S ^TMP($J,"UTIL","CPT",RVDT,CPTCNT)=XYZ_U_XYZZ_U_VTMSTMP_U
"RTN","SPNJRPCX",152,0)
 ...S ^TMP($J,"UTIL",CDTYP2,RVDT,CPTCNT)=XYZ_U_XYZZ_U_VTMSTMP_U
"RTN","SPNJRPCX",153,0)
 ;K RVDT,COUNT,X,VTMSTMP,MDT,XSTRING,ICPTIEN
"RTN","SPNJRPCX",154,0)
 ;K ^TMP("PXHSV",$J)
"RTN","SPNJRPCX",155,0)
 K SPNARY
"RTN","SPNJRPCX",156,0)
 Q
"RTN","SPNJRPCX",157,0)
SURG ;------------------------------------------------------------
"RTN","SPNJRPCX",158,0)
 ;get surgery icd's
"RTN","SPNJRPCX",159,0)
 S X=0 F  S X=$O(^SRF("B",DFN,X)) Q:(X="")!('+X)  D
"RTN","SPNJRPCX",160,0)
 . S SPNSRDT=$P($G(^SRF(X,0)),U,9)
"RTN","SPNJRPCX",161,0)
 . Q:SPNSRDT=""
"RTN","SPNJRPCX",162,0)
 . Q:SPNSRDT<SPNCUTDT
"RTN","SPNJRPCX",163,0)
 . S SPNSRDT=9999999.9999-SPNSRDT
"RTN","SPNJRPCX",164,0)
 . ;S FIELD=14 D CHKSUR  ;Rob requested not to include pre op codes
"RTN","SPNJRPCX",165,0)
 . S FIELD=4 D CHKSUR
"RTN","SPNJRPCX",166,0)
 . D SURCPT
"RTN","SPNJRPCX",167,0)
 . Q
"RTN","SPNJRPCX",168,0)
 ;PUGET ERROR TRAP DEFECT 12/21/07 - ADDED NEXT LINE
"RTN","SPNJRPCX",169,0)
 K SPNSRDT
"RTN","SPNJRPCX",170,0)
 Q
"RTN","SPNJRPCX",171,0)
CHKSUR ;
"RTN","SPNJRPCX",172,0)
 S SPNX1=0 F  S SPNX1=$O(^SRO(136,X,FIELD,SPNX1)) Q:(SPNX1="")!('+SPNX1)  D
"RTN","SPNJRPCX",173,0)
 . S SPNXCODE=$P($G(^SRO(136,X,FIELD,SPNX1,0)),U,1) Q:SPNXCODE=""
"RTN","SPNJRPCX",174,0)
 . ;JAS 6/17/09 - DEFECT 1137 - Removed direct reads of CPT/ICD files to API usage
"RTN","SPNJRPCX",175,0)
 . S SPNARY=$$ICDDX^ICDCODE(SPNXCODE,"","","")
"RTN","SPNJRPCX",176,0)
 . ;S SPNCNUM=$P($G(^ICD9(SPNXCODE,0)),U,1)
"RTN","SPNJRPCX",177,0)
 . S SPNCNUM=$P(SPNARY,"^",2)
"RTN","SPNJRPCX",178,0)
 . ;S SPNXCODE=$P($G(^ICD9(SPNXCODE,0)),U,3)
"RTN","SPNJRPCX",179,0)
 . S SPNXCODE=$P(SPNARY,"^",4)
"RTN","SPNJRPCX",180,0)
 . ;PUGET ERROR TRAP 12/21/07
"RTN","SPNJRPCX",181,0)
 . ;S SPNSRDT=$P($G(^SRF(X,0)),U,9)
"RTN","SPNJRPCX",182,0)
 . ;Q:SPNSRDT=""
"RTN","SPNJRPCX",183,0)
 . ;Q:SPNSRDT<SPNCUTDT
"RTN","SPNJRPCX",184,0)
 . ;S SPNSRDT=9999999.9999-SPNSRDT
"RTN","SPNJRPCX",185,0)
 . S CNT=CNT+1
"RTN","SPNJRPCX",186,0)
 . S ^TMP($J,"UTIL","ICD",SPNSRDT,CNT)=SPNXCODE_U_SPNCNUM_U_$$GET1^DIQ(130,X_",",.09,"E")_U
"RTN","SPNJRPCX",187,0)
 . ;PUGET ERROR TRAP DEFECT 11/13/07
"RTN","SPNJRPCX",188,0)
 . ;K SPNSRDT,SPNXCODE
"RTN","SPNJRPCX",189,0)
 . K SPNXCODE
"RTN","SPNJRPCX",190,0)
 . Q
"RTN","SPNJRPCX",191,0)
 K SPNARY
"RTN","SPNJRPCX",192,0)
 ;SURG CPTS
"RTN","SPNJRPCX",193,0)
 Q
"RTN","SPNJRPCX",194,0)
SURCPT ;
"RTN","SPNJRPCX",195,0)
 S SURX=0 F  S SURX=$O(^SRO(136,X,3,SURX)) Q:(SURX="")!('+SURX)  D
"RTN","SPNJRPCX",196,0)
 . S SURCPT=$P($G(^SRO(136,X,3,SURX,0)),U,1)
"RTN","SPNJRPCX",197,0)
 . ;JAS 6/17/09 - DEFECT 1137 - Removed direct reads of CPT/ICD files to API usage
"RTN","SPNJRPCX",198,0)
 . S SPNARY=$$CPT^ICPTCOD(SURCPT,"","")
"RTN","SPNJRPCX",199,0)
 . ;S SURCPTN=$P($G(^ICPT(SURCPT,0)),U,1)  ;NUMBER
"RTN","SPNJRPCX",200,0)
 . S SURCPTN=$P(SPNARY,"^",2)
"RTN","SPNJRPCX",201,0)
 . ;S SURCPTX=$P($G(^ICPT(SURCPT,0)),U,2)  ;TEXT
"RTN","SPNJRPCX",202,0)
 . S SURCPTX=$P(SPNARY,"^",3)
"RTN","SPNJRPCX",203,0)
 . S CPTCNT=CPTCNT+1
"RTN","SPNJRPCX",204,0)
 . S ^TMP($J,"UTIL","CPT",SPNSRDT,CPTCNT)=SURCPTX_U_SURCPTN_U_$$GET1^DIQ(130,X_",",.09,"E")_U
"RTN","SPNJRPCX",205,0)
 . ;PUGET ERROR TRAP DEFECT 12/21/07
"RTN","SPNJRPCX",206,0)
 . ;K SPNSRDT
"RTN","SPNJRPCX",207,0)
 K SPNARY
"RTN","SPNJRPCX",208,0)
 Q
"RTN","SPNJRPCX",209,0)
CREATE ;
"RTN","SPNJRPCX",210,0)
 S (X,CNT,OLDCNT)=0
"RTN","SPNJRPCX",211,0)
 S CNT=CNT+1,^TMP($J,CNT)="CPTBREAK^EOL999"
"RTN","SPNJRPCX",212,0)
 S SUB="CPT" F  S X=$O(^TMP($J,"UTIL",SUB,X)) Q:(X="")!('+X)  S OLDCNT=0 F  S OLDCNT=$O(^TMP($J,"UTIL",SUB,X,OLDCNT)) Q:(OLDCNT="")!('+OLDCNT)  D
"RTN","SPNJRPCX",213,0)
 . S CNT=CNT+1
"RTN","SPNJRPCX",214,0)
 . S ^TMP($J,CNT)=$G(^TMP($J,"UTIL",SUB,X,OLDCNT))
"RTN","SPNJRPCX",215,0)
 . S CODE=$P(^TMP($J,CNT),"^",2)
"RTN","SPNJRPCX",216,0)
 . D CPT Q
"RTN","SPNJRPCX",217,0)
 S CNT=CNT+1,^TMP($J,CNT)="ICDBREAK^EOL999"
"RTN","SPNJRPCX",218,0)
 S SUB="ICD" F  S X=$O(^TMP($J,"UTIL",SUB,X)) Q:(X="")!('+X)  S OLDCNT=0 F  S OLDCNT=$O(^TMP($J,"UTIL",SUB,X,OLDCNT)) Q:(OLDCNT="")!('+OLDCNT)  D
"RTN","SPNJRPCX",219,0)
 . S CNT=CNT+1
"RTN","SPNJRPCX",220,0)
 . S ^TMP($J,CNT)=$G(^TMP($J,"UTIL",SUB,X,OLDCNT))
"RTN","SPNJRPCX",221,0)
 . S CODE=$P(^TMP($J,CNT),"^",2)
"RTN","SPNJRPCX",222,0)
 . D ICD Q
"RTN","SPNJRPCX",223,0)
 K ^TMP($J,"UTIL")
"RTN","SPNJRPCX",224,0)
 Q
"RTN","SPNJRPCX",225,0)
ICD ;
"RTN","SPNJRPCX",226,0)
 ;JAS 6/15/09 - DEFECT 1137 - Removed direct reads of CPT/ICD files to API usage
"RTN","SPNJRPCX",227,0)
 S CNT=CNT+1
"RTN","SPNJRPCX",228,0)
 ;I $D(^ICD0("AB",CODE)) D  Q
"RTN","SPNJRPCX",229,0)
 ;. ;JAS - 05/15/08 - DEFECT 1090
"RTN","SPNJRPCX",230,0)
 ;. ;S IEN="" S IEN=$O(^ICD0("AB",CODE,IEN))
"RTN","SPNJRPCX",231,0)
 ;. S IEN=0 S IEN=$O(^ICD0("AB",CODE,IEN))
"RTN","SPNJRPCX",232,0)
 ;. I IEN=""  D  Q
"RTN","SPNJRPCX",233,0)
 ;. . S ^TMP($J,CNT)="No "_CODE_" Code on file^EOL999"
"RTN","SPNJRPCX",234,0)
 ;. Q:IEN=""
"RTN","SPNJRPCX",235,0)
 ;. S TXT=$G(^ICD0(IEN,1))
"RTN","SPNJRPCX",236,0)
 ;. I TXT="" D  Q
"RTN","SPNJRPCX",237,0)
 ;. . S ^TMP($J,CNT)="No description on file^EOL999"
"RTN","SPNJRPCX",238,0)
 ;. S ^TMP($J,CNT)=TXT_"^EOL999"
"RTN","SPNJRPCX",239,0)
 ;. Q
"RTN","SPNJRPCX",240,0)
 ;S CODE=CODE_" "  ;needed to use the "AB" cross ref
"RTN","SPNJRPCX",241,0)
 ;I '$D(^ICD9("AB",CODE)) D  Q
"RTN","SPNJRPCX",242,0)
 ;. S ^TMP($J,CNT)="No "_CODE_" Code on file^EOL999"
"RTN","SPNJRPCX",243,0)
 ;;JAS - 05/15/08 - DEFECT 1090
"RTN","SPNJRPCX",244,0)
 ;;S IEN="" S IEN=$O(^ICD9("AB",CODE,IEN))
"RTN","SPNJRPCX",245,0)
 ;S IEN=0 S IEN=$O(^ICD9("AB",CODE,IEN))
"RTN","SPNJRPCX",246,0)
 ;I IEN=""  D  Q
"RTN","SPNJRPCX",247,0)
 ;. S ^TMP($J,CNT)="No "_CODE_" Code on file^EOL999"
"RTN","SPNJRPCX",248,0)
 ;Q:IEN=""
"RTN","SPNJRPCX",249,0)
 ;S TXT=$G(^ICD9(IEN,1))
"RTN","SPNJRPCX",250,0)
 ;I TXT="" D  Q
"RTN","SPNJRPCX",251,0)
 ;. S ^TMP($J,CNT)="No description on file^EOL999"
"RTN","SPNJRPCX",252,0)
 S ICDD=$$ICDD^ICDCODE(CODE,"SPNARY","")
"RTN","SPNJRPCX",253,0)
 I $P(ICDD,"^")=-1 S ^TMP($J,CNT)="No "_CODE_" Code on file"_U_"EOL999" Q
"RTN","SPNJRPCX",254,0)
 I SPNARY(1)="" S ^TMP($J,CNT)="No description on file"_U_"EOL999" Q
"RTN","SPNJRPCX",255,0)
 ;S ^TMP($J,CNT)=TXT_"^EOL999"
"RTN","SPNJRPCX",256,0)
 S ^TMP($J,CNT)=SPNARY(1)_"^EOL999"
"RTN","SPNJRPCX",257,0)
 ;Note that even though this is a single line of text the CPTS 
"RTN","SPNJRPCX",258,0)
 ;description is a mult.  And this call brings back either one.
"RTN","SPNJRPCX",259,0)
 K SPNARY,ICDD
"RTN","SPNJRPCX",260,0)
 Q
"RTN","SPNJRPCX",261,0)
CPT ;
"RTN","SPNJRPCX",262,0)
 D CPTD^ICPTCOD(CODE,"SPNARRAY")
"RTN","SPNJRPCX",263,0)
 I '$D(SPNARRAY) D  Q
"RTN","SPNJRPCX",264,0)
 . S CNT=CNT+1
"RTN","SPNJRPCX",265,0)
 . S ^TMP($J,CNT)="No CPT "_CODE_" on file^EOL999"
"RTN","SPNJRPCX",266,0)
 ;JAS - 05/15/08 - DEFECT 1090
"RTN","SPNJRPCX",267,0)
 ;S LINE=""
"RTN","SPNJRPCX",268,0)
 S LINE=0
"RTN","SPNJRPCX",269,0)
 F  S LINE=$O(SPNARRAY(LINE)) Q:LINE=""  D
"RTN","SPNJRPCX",270,0)
 . S TXT=SPNARRAY(LINE)
"RTN","SPNJRPCX",271,0)
 . Q:TXT=""!(TXT=" ")
"RTN","SPNJRPCX",272,0)
 . S CNT=CNT+1
"RTN","SPNJRPCX",273,0)
 . S ^TMP($J,CNT)=TXT
"RTN","SPNJRPCX",274,0)
 . Q
"RTN","SPNJRPCX",275,0)
 S ^TMP($J,CNT)=^TMP($J,CNT)_"^EOL999"
"RTN","SPNJRPCX",276,0)
 K SPNARRAY
"RTN","SPNJRPCX",277,0)
 Q
"RTN","SPNJRPCX",278,0)
CLNUP ;
"RTN","SPNJRPCX",279,0)
 K CNT,CODE,CPTCNT,DFN,FIELD,IEN,LINE,OLDCNT,SPNCNUM
"RTN","SPNJRPCX",280,0)
 K SPNFLD,SPNPTADM,SPNPTFIE,SPNPTRDT,SPNREV,SPNSUDT
"RTN","SPNJRPCX",281,0)
 K SPNX1,SPNXXYZ,SPNXY,SUB,SURCPT,SURCPTN,SURCPTX,SURX
"RTN","SPNJRPCX",282,0)
 K TXT,X,XY,XYZ,XYZZ,Y
"RTN","SPNJRPCX",283,0)
 K TMSTMP  ;WDE
"RTN","SPNJRPCX",284,0)
 Q
"RTN","SPNJRPDC")
0^86^B7788443
"RTN","SPNJRPDC",1,0)
SPNJRPDC ;BP/JAS - Returns list of ICNs who match VA Drug Class criteria ;JUN 25, 2007
"RTN","SPNJRPDC",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNJRPDC",3,0)
 ;
"RTN","SPNJRPDC",4,0)
 ; Reference to ^DPT(D0,"MPI" supported by IA# 4938
"RTN","SPNJRPDC",5,0)
 ; Reference to ^PS(55,D0,"P","A" supported by IA# 552
"RTN","SPNJRPDC",6,0)
 ; Reference to API RX^PSO52API supported by IA# 4820
"RTN","SPNJRPDC",7,0)
 ; API $$FLIP^SPNRPCIC is part of Spinal Cord Version 3.0
"RTN","SPNJRPDC",8,0)
 ;
"RTN","SPNJRPDC",9,0)
 ; Parm values:
"RTN","SPNJRPDC",10,0)
 ;     ICNLST  is the list of patient ICNs to process
"RTN","SPNJRPDC",11,0)
 ;     FDATE is the start date for period
"RTN","SPNJRPDC",12,0)
 ;     TDATE is the end date for period
"RTN","SPNJRPDC",13,0)
 ;     VADC is the VA Drug Class to search for
"RTN","SPNJRPDC",14,0)
 ;     ^TMP($J) is the return value with list of ICNs
"RTN","SPNJRPDC",15,0)
 ;
"RTN","SPNJRPDC",16,0)
 ; Returns: ^TMP($J)
"RTN","SPNJRPDC",17,0)
 ;
"RTN","SPNJRPDC",18,0)
COL(RETURN,ICNLST,FDATE,TDATE,VADC) ;
"RTN","SPNJRPDC",19,0)
 ;***************************
"RTN","SPNJRPDC",20,0)
 S RETURN=$NA(^TMP($J)),RETCNT=1
"RTN","SPNJRPDC",21,0)
 K ^TMP($J),^TMP("SPN",$J),VALIST
"RTN","SPNJRPDC",22,0)
 S X=FDATE S %DT="T" D ^%DT S FDATE=Y
"RTN","SPNJRPDC",23,0)
 S X=TDATE S %DT="T" D ^%DT S TDATE=Y
"RTN","SPNJRPDC",24,0)
 D VALOAD
"RTN","SPNJRPDC",25,0)
 F ICNNM=1:1:$L(ICNLST,"^") S ICN=$P(ICNLST,"^",ICNNM) D IN
"RTN","SPNJRPDC",26,0)
 D OUT,CLNUP
"RTN","SPNJRPDC",27,0)
 Q
"RTN","SPNJRPDC",28,0)
IN ;
"RTN","SPNJRPDC",29,0)
 Q:$G(ICN)=""
"RTN","SPNJRPDC",30,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNJRPDC",31,0)
 Q:$G(DFN)=""
"RTN","SPNJRPDC",32,0)
 ;***************************
"RTN","SPNJRPDC",33,0)
 Q:'$D(^PS(55,DFN,"P","A"))
"RTN","SPNJRPDC",34,0)
 N EXPDATE,RECNR,ZEROREC,TWOREC,ZDRUGNR,UNITVAL,PNAME,PSSN
"RTN","SPNJRPDC",35,0)
 N FILLDATE,SUBRECNR
"RTN","SPNJRPDC",36,0)
 I '$D(TDATE) S TDATE=DT
"RTN","SPNJRPDC",37,0)
 ; We are interested in any drug whose prescription 'expiration' or
"RTN","SPNJRPDC",38,0)
 ; 'cancel' date falls on or after the 'from' date.
"RTN","SPNJRPDC",39,0)
 ; We are going to take only the fills or refills which occurred
"RTN","SPNJRPDC",40,0)
 ; during the 'from'-'thru' date range.
"RTN","SPNJRPDC",41,0)
 S FND=0
"RTN","SPNJRPDC",42,0)
 S EXPDATE=FDATE-.000001 ; for each expiration date
"RTN","SPNJRPDC",43,0)
 F  S EXPDATE=$O(^PS(55,DFN,"P","A",EXPDATE)) Q:EXPDATE'>0!(FND)  D
"RTN","SPNJRPDC",44,0)
 . S RECNR=0 ; for each prescription on that date
"RTN","SPNJRPDC",45,0)
 . F  S RECNR=$O(^PS(55,DFN,"P","A",EXPDATE,RECNR)) Q:RECNR'>0!(FND)  D
"RTN","SPNJRPDC",46,0)
 . . K ^TMP($J,"PSARRAY")
"RTN","SPNJRPDC",47,0)
 . . D RX^PSO52API(DFN,"PSARRAY",RECNR)
"RTN","SPNJRPDC",48,0)
 . . S FILLDATE=$P(^TMP($J,"PSARRAY",DFN,RECNR,22),"^",1)
"RTN","SPNJRPDC",49,0)
 . . Q:FILLDATE>TDATE
"RTN","SPNJRPDC",50,0)
 . . S ZDRUGNR=$P(^TMP($J,"PSARRAY",DFN,RECNR,6),"^",1)
"RTN","SPNJRPDC",51,0)
 . . S PSDESC=$P(^TMP($J,"PSARRAY",DFN,RECNR,6),"^",2)
"RTN","SPNJRPDC",52,0)
 . . I FILLDATE'<FDATE,FILLDATE'>TDATE D CHK Q:FND
"RTN","SPNJRPDC",53,0)
 . . S SUBRECNR=0 ; for each refill of the drug
"RTN","SPNJRPDC",54,0)
 . . F  S SUBRECNR=$O(^TMP($J,"PSARRAY",DFN,RECNR,"RF",SUBRECNR)) Q:SUBRECNR=""  D
"RTN","SPNJRPDC",55,0)
 . . . S FILLDATE=$P(^TMP($J,"PSARRAY",DFN,RECNR,"RF",SUBRECNR,.01),"^",1)
"RTN","SPNJRPDC",56,0)
 . . . Q:FILLDATE<FDATE!(FILLDATE>TDATE)
"RTN","SPNJRPDC",57,0)
 . . . D CHK Q:FND
"RTN","SPNJRPDC",58,0)
 . . K ^TMP($J,"PSARRAY")
"RTN","SPNJRPDC",59,0)
 Q
"RTN","SPNJRPDC",60,0)
CHK ;
"RTN","SPNJRPDC",61,0)
 Q:'$D(VALIST(PSDESC))
"RTN","SPNJRPDC",62,0)
 S ICN=$P($G(^DPT(DFN,"MPI")),"^",1)
"RTN","SPNJRPDC",63,0)
 Q:ICN=""
"RTN","SPNJRPDC",64,0)
 S ^TMP("SPN",$J,ICN,PSDESC)=""
"RTN","SPNJRPDC",65,0)
 S FND=1
"RTN","SPNJRPDC",66,0)
 Q
"RTN","SPNJRPDC",67,0)
OUT ;
"RTN","SPNJRPDC",68,0)
 S ICN=""
"RTN","SPNJRPDC",69,0)
 F  S ICN=$O(^TMP("SPN",$J,ICN)) Q:ICN=""  D
"RTN","SPNJRPDC",70,0)
 . S ^TMP($J,RETCNT)=ICN_"^EOL999"
"RTN","SPNJRPDC",71,0)
 . S RETCNT=RETCNT+1
"RTN","SPNJRPDC",72,0)
 Q
"RTN","SPNJRPDC",73,0)
VALOAD ;
"RTN","SPNJRPDC",74,0)
 S MDA="" F  S MDA=$O(VADC(MDA)) Q:MDA=""  D
"RTN","SPNJRPDC",75,0)
 . S VAX=VADC(MDA)
"RTN","SPNJRPDC",76,0)
 . S VALIST(VAX)=""
"RTN","SPNJRPDC",77,0)
 Q
"RTN","SPNJRPDC",78,0)
CLNUP ;
"RTN","SPNJRPDC",79,0)
 K %DT,CNT,DFN,DNBR,FND,ICN,ICNNM,MDA,PATLST,PSDESC
"RTN","SPNJRPDC",80,0)
 K RETCNT,VAX,X,Y,VADC,VALIST,^TMP($J,"PSARRAY")
"RTN","SPNJRPDC",81,0)
 Q
"RTN","SPNJRPE2")
0^87^B1830378
"RTN","SPNJRPE2",1,0)
SPNJRPE2 ;BP/JAS - Returns most recent Means and Eligibility info for all patients ;JUL 28, 2008
"RTN","SPNJRPE2",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNJRPE2",3,0)
 ;
"RTN","SPNJRPE2",4,0)
 ; References to ^DGEN(27.11 supported by IA# 4947
"RTN","SPNJRPE2",5,0)
 ; Reference to ^DG(408.32 supported by IA# 4941
"RTN","SPNJRPE2",6,0)
 ; API $$FLIP^SPNRPCIC is part of Spinal Cord Version 3.0
"RTN","SPNJRPE2",7,0)
 ;
"RTN","SPNJRPE2",8,0)
 ; Parm values:
"RTN","SPNJRPE2",9,0)
 ;     ICNLST is the list of patient ICNs to process
"RTN","SPNJRPE2",10,0)
 ;     RETURN is the eligibility priority and means for a given patient
"RTN","SPNJRPE2",11,0)
 ;
"RTN","SPNJRPE2",12,0)
 ; Returns: ^TMP($J)
"RTN","SPNJRPE2",13,0)
 ;
"RTN","SPNJRPE2",14,0)
COL(RETURN,ICNLST) ;
"RTN","SPNJRPE2",15,0)
 ;***************************
"RTN","SPNJRPE2",16,0)
 K ^TMP($J)
"RTN","SPNJRPE2",17,0)
 S RETURN=$NA(^TMP($J)),RETCNT=0
"RTN","SPNJRPE2",18,0)
 F ICNNM=1:1:$L(ICNLST,"^") S ICN=$P(ICNLST,"^",ICNNM) D IN
"RTN","SPNJRPE2",19,0)
 D CLNUP
"RTN","SPNJRPE2",20,0)
 Q
"RTN","SPNJRPE2",21,0)
IN ;
"RTN","SPNJRPE2",22,0)
 Q:$G(ICN)=""
"RTN","SPNJRPE2",23,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNJRPE2",24,0)
 Q:$G(DFN)=""
"RTN","SPNJRPE2",25,0)
 ;***************************
"RTN","SPNJRPE2",26,0)
 Q:'$D(^DGEN(27.11,"C",DFN))
"RTN","SPNJRPE2",27,0)
 S EDA="",EDA=$O(^DGEN(27.11,"C",DFN,EDA),-1)
"RTN","SPNJRPE2",28,0)
 Q:'$D(^DGEN(27.11,EDA,0))
"RTN","SPNJRPE2",29,0)
 S PRIO=$P(^DGEN(27.11,EDA,0),"^",7)
"RTN","SPNJRPE2",30,0)
 I PRIO'="" S PRIO="GROUP "_PRIO
"RTN","SPNJRPE2",31,0)
 S MTS=""
"RTN","SPNJRPE2",32,0)
 I $D(^DGEN(27.11,EDA,"E")) D
"RTN","SPNJRPE2",33,0)
 . S MTSDA=$P(^DGEN(27.11,EDA,"E"),"^",14)
"RTN","SPNJRPE2",34,0)
 . I MTSDA'="" D
"RTN","SPNJRPE2",35,0)
 . . S MTS=$P($G(^DG(408.32,MTSDA,0)),"^",1)
"RTN","SPNJRPE2",36,0)
 S ^TMP($J,RETCNT)=PRIO_"^"_MTS_"^"_ICN_"^EOL999"
"RTN","SPNJRPE2",37,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPE2",38,0)
 Q
"RTN","SPNJRPE2",39,0)
CLNUP ;
"RTN","SPNJRPE2",40,0)
 K AICN,DFN,EDA,ICN,ICNNM,MTS,MTSDA,PATLIST,PRIO,RETCNT,SPN
"RTN","SPNJRPE2",41,0)
 Q
"RTN","SPNJRPET")
0^88^B981420
"RTN","SPNJRPET",1,0)
SPNJRPET ;BP/JAS - Returns VA Ethnicity info ;Dec 06, 2006
"RTN","SPNJRPET",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNJRPET",3,0)
 ;
"RTN","SPNJRPET",4,0)
 ; Reference to API DEM^VADPT supported by IA #10061
"RTN","SPNJRPET",5,0)
 ; API $$FLIP^SPNRPCIC is part of Spinal Cord Version 3.0
"RTN","SPNJRPET",6,0)
 ;
"RTN","SPNJRPET",7,0)
 ; Parm values:
"RTN","SPNJRPET",8,0)
 ;     RETURN is the ethnicity info for a given ICN
"RTN","SPNJRPET",9,0)
 ;     ICN is the indentifier for the spinal cord patient
"RTN","SPNJRPET",10,0)
 ;     
"RTN","SPNJRPET",11,0)
 ;Returns: ^TMP($J)
"RTN","SPNJRPET",12,0)
 ;
"RTN","SPNJRPET",13,0)
COL(RETURN,ICN) ;
"RTN","SPNJRPET",14,0)
 ;***************************
"RTN","SPNJRPET",15,0)
 K ^TMP($J)
"RTN","SPNJRPET",16,0)
 S RETURN=$NA(^TMP($J)),RETCNT=1
"RTN","SPNJRPET",17,0)
 Q:$G(ICN)=""
"RTN","SPNJRPET",18,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNJRPET",19,0)
 Q:$G(DFN)=""
"RTN","SPNJRPET",20,0)
 ;***************************
"RTN","SPNJRPET",21,0)
 D DEM^VADPT
"RTN","SPNJRPET",22,0)
 S ENUM=VADM(11)
"RTN","SPNJRPET",23,0)
 I ENUM=0 S ^TMP($J,RETCNT)="NO ETHNICITY INFO AVAILABLE^EOL999" Q
"RTN","SPNJRPET",24,0)
 F I=1:1:ENUM S EREC=VADM(11,I),^TMP($J,RETCNT)=$P(EREC,"^",2)_"^EOL999",RETCNT=RETCNT+1
"RTN","SPNJRPET",25,0)
 K DFN,I,ENUM,EREC,RETCNT
"RTN","SPNJRPET",26,0)
 K VADM  ;WDE
"RTN","SPNJRPET",27,0)
 Q
"RTN","SPNJRPFB")
0^89^B2618869
"RTN","SPNJRPFB",1,0)
SPNJRPFB ;BP/JAS - Returns list of ICNs who match Fee Basis Criteria ;JUL 28, 2008
"RTN","SPNJRPFB",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNJRPFB",3,0)
 ;
"RTN","SPNJRPFB",4,0)
 ; Reference to ^DPT(D0,"B" supported by IA# 10035
"RTN","SPNJRPFB",5,0)
 ; Reference to ^DPT(D0,"MPI" supported by IA# 4938
"RTN","SPNJRPFB",6,0)
 ; Reference to API $$AUTHL^FBUTL supported by IA# 4396
"RTN","SPNJRPFB",7,0)
 ; API $$FLIP^SPNRPCIC is part of Spinal Cord Version 3.0
"RTN","SPNJRPFB",8,0)
 ;
"RTN","SPNJRPFB",9,0)
 ; Parm values:
"RTN","SPNJRPFB",10,0)
 ;     FDATE is the start date for period
"RTN","SPNJRPFB",11,0)
 ;     TDATE is the end date for period
"RTN","SPNJRPFB",12,0)
 ;     ICNLST is the group of ICNs to search from
"RTN","SPNJRPFB",13,0)
 ;     ^TMP($J) is the return value with list of ICNs
"RTN","SPNJRPFB",14,0)
 ;
"RTN","SPNJRPFB",15,0)
 ; Returns: ^TMP($J)
"RTN","SPNJRPFB",16,0)
 ;
"RTN","SPNJRPFB",17,0)
COL(RETURN,FDATE,TDATE,ICNLST) ;
"RTN","SPNJRPFB",18,0)
 ;***************************
"RTN","SPNJRPFB",19,0)
 S RETURN=$NA(^TMP($J)),RETCNT=1
"RTN","SPNJRPFB",20,0)
 K ^TMP($J),^TMP("SPN",$J)
"RTN","SPNJRPFB",21,0)
 S X=FDATE S %DT="T" D ^%DT S FDATE=Y
"RTN","SPNJRPFB",22,0)
 S X=TDATE S %DT="T" D ^%DT S TDATE=Y
"RTN","SPNJRPFB",23,0)
 F ICNNM=1:1:$L(ICNLST,"^") S ICN=$P(ICNLST,"^",ICNNM) D IN
"RTN","SPNJRPFB",24,0)
 D OUT,CLNUP
"RTN","SPNJRPFB",25,0)
 Q
"RTN","SPNJRPFB",26,0)
IN ;
"RTN","SPNJRPFB",27,0)
 Q:$G(ICN)=""
"RTN","SPNJRPFB",28,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNJRPFB",29,0)
 Q:$G(DFN)=""
"RTN","SPNJRPFB",30,0)
 K SPNARRAY
"RTN","SPNJRPFB",31,0)
 S FBCNT=$$AUTHL^FBUTL(DFN,,,"SPNARRAY")
"RTN","SPNJRPFB",32,0)
 Q:$P(FBCNT,"^",1)'>0
"RTN","SPNJRPFB",33,0)
 S GOOD=0
"RTN","SPNJRPFB",34,0)
 F I=1:1:FBCNT D  Q:GOOD
"RTN","SPNJRPFB",35,0)
 . F J=0:1 D  Q:GOOD!(X>SPNARRAY(I,"TDT"))
"RTN","SPNJRPFB",36,0)
 . . S X=0
"RTN","SPNJRPFB",37,0)
 . . S X1=SPNARRAY(I,"FDT"),X2="+"_J
"RTN","SPNJRPFB",38,0)
 . . D C^%DTC
"RTN","SPNJRPFB",39,0)
 . . I X'<FDATE&(X'>TDATE) D  Q
"RTN","SPNJRPFB",40,0)
 . . . S ICN=$P($G(^DPT(DFN,"MPI")),"^",1)
"RTN","SPNJRPFB",41,0)
 . . . Q:ICN=""
"RTN","SPNJRPFB",42,0)
 . . . S ^TMP("SPN",$J,ICN)=""
"RTN","SPNJRPFB",43,0)
 . . . S GOOD=1
"RTN","SPNJRPFB",44,0)
 Q
"RTN","SPNJRPFB",45,0)
OUT ;
"RTN","SPNJRPFB",46,0)
 S ICN=""
"RTN","SPNJRPFB",47,0)
 F  S ICN=$O(^TMP("SPN",$J,ICN)) Q:ICN=""  D
"RTN","SPNJRPFB",48,0)
 . S ^TMP($J,RETCNT)=ICN_"^EOL999"
"RTN","SPNJRPFB",49,0)
 . S RETCNT=RETCNT+1
"RTN","SPNJRPFB",50,0)
 Q
"RTN","SPNJRPFB",51,0)
CLNUP ;
"RTN","SPNJRPFB",52,0)
 K %DT,NAME,DFN,FBCNT,SPNARRAY,GOOD,ICN,RETCNT,X,X1,X2,Y,I,J,ICNNM
"RTN","SPNJRPFB",53,0)
 Q
"RTN","SPNJRPIC")
0^19^B7764384
"RTN","SPNJRPIC",1,0)
SPNJRPIC ;BP/JAS - Returns Applications for Inpatient Care data ;JAN 18, 2006
"RTN","SPNJRPIC",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNJRPIC",3,0)
 ;
"RTN","SPNJRPIC",4,0)
 ; Reference to ^DPT(D0,0 supported by IA #998
"RTN","SPNJRPIC",5,0)
 ; Reference to API REG^VADPT supported by IA #10061
"RTN","SPNJRPIC",6,0)
 ; Reference to API DEM^VADPT supported by IA #10061
"RTN","SPNJRPIC",7,0)
 ; API $$FLIP^SPNRPCIC is part of Spinal Cord Version 3.0
"RTN","SPNJRPIC",8,0)
 ;
"RTN","SPNJRPIC",9,0)
 ; Parm values:
"RTN","SPNJRPIC",10,0)
 ;     RETURN  is the sorted data from the earliest date of listing
"RTN","SPNJRPIC",11,0)
 ;     ICNLST  is the list of patient ICNs to process
"RTN","SPNJRPIC",12,0)
 ;     FDATE   is the delivery starting date
"RTN","SPNJRPIC",13,0)
 ;     TDATE   is the delivery ending date
"RTN","SPNJRPIC",14,0)
 ;
"RTN","SPNJRPIC",15,0)
 ; Returns: ^TMP($J)
"RTN","SPNJRPIC",16,0)
 ;
"RTN","SPNJRPIC",17,0)
COL(RETURN,ICNLST,FDATE,TDATE) ;
"RTN","SPNJRPIC",18,0)
 ;
"RTN","SPNJRPIC",19,0)
 ;***************************
"RTN","SPNJRPIC",20,0)
 S RETURN=$NA(^TMP($J)),RETCNT=1
"RTN","SPNJRPIC",21,0)
 S X=FDATE S %DT="T" D ^%DT S SPNDATE=Y
"RTN","SPNJRPIC",22,0)
 S X=TDATE S %DT="T" D ^%DT S SPNEDAT=Y_.2359
"RTN","SPNJRPIC",23,0)
 ;***************************
"RTN","SPNJRPIC",24,0)
 K ^TMP($J),^TMP("SPN",$J)
"RTN","SPNJRPIC",25,0)
 D HEAD
"RTN","SPNJRPIC",26,0)
 F ICNNM=1:1:$L(ICNLST,"^") S ICN=$P(ICNLST,"^",ICNNM) D IN
"RTN","SPNJRPIC",27,0)
 D OUT,CLNUP
"RTN","SPNJRPIC",28,0)
 Q
"RTN","SPNJRPIC",29,0)
IN Q:$G(ICN)=""
"RTN","SPNJRPIC",30,0)
 S SPNDFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNJRPIC",31,0)
 Q:$G(SPNDFN)=""
"RTN","SPNJRPIC",32,0)
 ;***************************
"RTN","SPNJRPIC",33,0)
 N SPNX,SPNFAC
"RTN","SPNJRPIC",34,0)
 S (SPNLPRT,SPNFAC)=0
"RTN","SPNJRPIC",35,0)
 Q:'$D(^DPT(SPNDFN))
"RTN","SPNJRPIC",36,0)
 D PATIENT(SPNDFN)
"RTN","SPNJRPIC",37,0)
 Q
"RTN","SPNJRPIC",38,0)
 ;
"RTN","SPNJRPIC",39,0)
OUT I $D(^TMP("SPN",$J)) D
"RTN","SPNJRPIC",40,0)
 . N SPNSTATE,SPNDFN,SPNNAME
"RTN","SPNJRPIC",41,0)
 . S SPNNAME="" F  S SPNNAME=$O(^TMP("SPN",$J,SPNNAME)) Q:SPNNAME=""  D
"RTN","SPNJRPIC",42,0)
 . . S SPNDFN="" F  S SPNDFN=$O(^TMP("SPN",$J,SPNNAME,SPNDFN)) Q:SPNDFN=""  D
"RTN","SPNJRPIC",43,0)
 . . . S SPNX="" F  S SPNX=$O(^TMP("SPN",$J,SPNNAME,SPNDFN,SPNX)) Q:SPNX=""  D
"RTN","SPNJRPIC",44,0)
 . . . . S ^TMP($J,RETCNT)=^TMP("SPN",$J,SPNNAME,SPNDFN,SPNX)
"RTN","SPNJRPIC",45,0)
 . . . . S RETCNT=RETCNT+1
"RTN","SPNJRPIC",46,0)
 Q
"RTN","SPNJRPIC",47,0)
PATIENT(SPNDFN) ; Print Patient data
"RTN","SPNJRPIC",48,0)
 N DFN
"RTN","SPNJRPIC",49,0)
 S DFN=SPNDFN
"RTN","SPNJRPIC",50,0)
 D DEM^VADPT
"RTN","SPNJRPIC",51,0)
 S PNAM=$E(VADM(1),1,30)_" ("_$E(VADM(1),1)_VA("BID")_")"
"RTN","SPNJRPIC",52,0)
 S SPNNAME=VADM(1)
"RTN","SPNJRPIC",53,0)
 D KVAR^VADPT
"RTN","SPNJRPIC",54,0)
 K ^UTILITY("VARP",$J)
"RTN","SPNJRPIC",55,0)
 S DFN=SPNDFN,VARP("F")=SPNDATE,VARP("T")=SPNEDAT
"RTN","SPNJRPIC",56,0)
 D REG^VADPT
"RTN","SPNJRPIC",57,0)
 N SPNODE,SPNNODE
"RTN","SPNJRPIC",58,0)
 S SPNODE=0
"RTN","SPNJRPIC",59,0)
 F  S SPNODE=$O(^UTILITY("VARP",$J,SPNODE)) Q:SPNODE<1  D
"RTN","SPNJRPIC",60,0)
 . N SPNX,SPNY
"RTN","SPNJRPIC",61,0)
 . S SPNX=$G(^UTILITY("VARP",$J,SPNODE,"I")) Q:SPNX=""
"RTN","SPNJRPIC",62,0)
 . S SPNY=$G(^UTILITY("VARP",$J,SPNODE,"E")) Q:SPNY=""
"RTN","SPNJRPIC",63,0)
 . S DOD=$$FMTE^XLFDT($P(SPNX,U),"2D"),DISP=$P(SPNY,U,7)
"RTN","SPNJRPIC",64,0)
 . S TYBN=$P(SPNY,U,3)
"RTN","SPNJRPIC",65,0)
 . S ^TMP("SPN",$J,SPNNAME,SPNDFN,SPNX)=PNAM_"^"_DOD_"^"_DISP_"^"_TYBN_"^EOL999"
"RTN","SPNJRPIC",66,0)
 . Q
"RTN","SPNJRPIC",67,0)
 D KVAR^VADPT K ^UTILITY("VARP",$J)
"RTN","SPNJRPIC",68,0)
 Q
"RTN","SPNJRPIC",69,0)
HEAD ; Header Print
"RTN","SPNJRPIC",70,0)
 S ^TMP($J,RETCNT)="HDR999^PATIENT^DATE OF DISPOSITION^DISPOSITION^TYPE OF BENEFIT^EOL999"
"RTN","SPNJRPIC",71,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPIC",72,0)
 Q
"RTN","SPNJRPIC",73,0)
CLNUP ;
"RTN","SPNJRPIC",74,0)
 K ^TMP("SPN",$J)
"RTN","SPNJRPIC",75,0)
 K %DT,DISP,DOD,ICN,ICNNM,PNAM,RETCNT,SPNDATE,SPNEDAT,SPNLPRT
"RTN","SPNJRPIC",76,0)
 K SPNQDAT,SPNRDAT,TYBN,VA,VADM,VARP,X,Y
"RTN","SPNJRPIC",77,0)
 Q
"RTN","SPNJRPIL")
0^20^B1214679
"RTN","SPNJRPIL",1,0)
SPNJRPIL ;BP/JAS - Returns ICNs for list of DFNs ;JAN 18, 2006
"RTN","SPNJRPIL",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNJRPIL",3,0)
 ;
"RTN","SPNJRPIL",4,0)
 ; References to ^DPT supported by IA# 4938
"RTN","SPNJRPIL",5,0)
 ;
"RTN","SPNJRPIL",6,0)
 ; Parm values:
"RTN","SPNJRPIL",7,0)
 ;     RETURN  is the returned ICN value to go with the patient's DFN
"RTN","SPNJRPIL",8,0)
 ;     DFNLST  is DFN of the patient to process
"RTN","SPNJRPIL",9,0)
 ;
"RTN","SPNJRPIL",10,0)
 ; Returns: ^TMP($J)
"RTN","SPNJRPIL",11,0)
 ;
"RTN","SPNJRPIL",12,0)
COL(RETURN,DFNLST) ;
"RTN","SPNJRPIL",13,0)
 ;
"RTN","SPNJRPIL",14,0)
 ;***************************
"RTN","SPNJRPIL",15,0)
 K ^TMP($J),^TMP("SPN",$J)
"RTN","SPNJRPIL",16,0)
 S RETURN=$NA(^TMP($J)),RETCNT=1
"RTN","SPNJRPIL",17,0)
 ;***************************
"RTN","SPNJRPIL",18,0)
 F DFNNM=1:1:$L(DFNLST,"^") S DFN=$P(DFNLST,"^",DFNNM) D GET
"RTN","SPNJRPIL",19,0)
 K DFN,DFNNM,ICN,RETCNT
"RTN","SPNJRPIL",20,0)
 Q
"RTN","SPNJRPIL",21,0)
GET ;
"RTN","SPNJRPIL",22,0)
 I '$D(^DPT(DFN)) D  Q
"RTN","SPNJRPIL",23,0)
 . S ^TMP($J,RETCNT)="DFN NOT FOUND^"_DFN_"^EOL999"
"RTN","SPNJRPIL",24,0)
 . S RETCNT=RETCNT+1
"RTN","SPNJRPIL",25,0)
 I '$D(^DPT(DFN,"MPI")) D  Q
"RTN","SPNJRPIL",26,0)
 . S ^TMP($J,RETCNT)="NO LOCAL ICN FOUND^"_DFN_"^EOL999"
"RTN","SPNJRPIL",27,0)
 . S RETCNT=RETCNT+1
"RTN","SPNJRPIL",28,0)
 S ICN=$P(^DPT(DFN,"MPI"),"^",1)
"RTN","SPNJRPIL",29,0)
 S ^TMP($J,RETCNT)=ICN_"^"_DFN_"^EOL999"
"RTN","SPNJRPIL",30,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPIL",31,0)
 Q
"RTN","SPNJRPIP")
0^21^B4321660
"RTN","SPNJRPIP",1,0)
SPNJRPIP ;BP/JAS - Returns list of ICNs for Inpatients ;JUL 28, 2008
"RTN","SPNJRPIP",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNJRPIP",3,0)
 ;
"RTN","SPNJRPIP",4,0)
 ; Reference to ^DGPT("B" & file 45 supported by IA# 92
"RTN","SPNJRPIP",5,0)
 ; Reference to ^DGPT(D0,0 supported by IA# 4945
"RTN","SPNJRPIP",6,0)
 ; Reference to ^DPT(D0,"MPI" supported by IA# 4938
"RTN","SPNJRPIP",7,0)
 ; API $$FLIP^SPNRPCIC is part of Spinal Cord Version 3.0
"RTN","SPNJRPIP",8,0)
 ;
"RTN","SPNJRPIP",9,0)
 ; Parm values:
"RTN","SPNJRPIP",10,0)
 ;     RETURN is the list of ICNs who meet criteria
"RTN","SPNJRPIP",11,0)
 ;     FDATE is the start date for period
"RTN","SPNJRPIP",12,0)
 ;     TDATE is the end date for period
"RTN","SPNJRPIP",13,0)
 ;     ICNLST is the group of ICNs to search from
"RTN","SPNJRPIP",14,0)
 ;
"RTN","SPNJRPIP",15,0)
 ; Returns: ^TMP($J)
"RTN","SPNJRPIP",16,0)
 ;
"RTN","SPNJRPIP",17,0)
COL(RETURN,FDATE,TDATE,ICNLST) ;
"RTN","SPNJRPIP",18,0)
 ;***************************
"RTN","SPNJRPIP",19,0)
 S RETURN=$NA(^TMP($J)),RETCNT=1
"RTN","SPNJRPIP",20,0)
 S X=FDATE S %DT="T" D ^%DT S FDATE=Y
"RTN","SPNJRPIP",21,0)
 S X=TDATE S %DT="T" D ^%DT S TDATE=Y
"RTN","SPNJRPIP",22,0)
 ;***************************
"RTN","SPNJRPIP",23,0)
 K ^TMP($J),^TMP("SPN",$J)
"RTN","SPNJRPIP",24,0)
 F ICNNM=1:1:$L(ICNLST,"^") S ICN=$P(ICNLST,"^",ICNNM) D REC
"RTN","SPNJRPIP",25,0)
 D OUT
"RTN","SPNJRPIP",26,0)
 K %DT,DFN,ICN,RETCNT,Y,ICNNM
"RTN","SPNJRPIP",27,0)
 Q
"RTN","SPNJRPIP",28,0)
REC ;
"RTN","SPNJRPIP",29,0)
 Q:$G(ICN)=""
"RTN","SPNJRPIP",30,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNJRPIP",31,0)
 Q:$G(DFN)=""
"RTN","SPNJRPIP",32,0)
 N RECNR,NODE0,NODE70,ZDD,ZAD,BS,ADMDAYS,NUMADMS,BSNR,X,X1,X2
"RTN","SPNJRPIP",33,0)
 I '$D(TDATE) S TDATE=DT
"RTN","SPNJRPIP",34,0)
 ; We will take all admissions which overlap the desired range, and adjust
"RTN","SPNJRPIP",35,0)
 ; the admit and/or discharge dates to conform with the desired range.
"RTN","SPNJRPIP",36,0)
 S (ADMDAYS,NUMADMS,RECNR)=0 ; for each inpatient record
"RTN","SPNJRPIP",37,0)
 F  S RECNR=$O(^DGPT("B",DFN,RECNR)) Q:NUMADMS!(RECNR="")  D
"RTN","SPNJRPIP",38,0)
 . Q:$$GET1^DIQ(45,RECNR_",",11,"I")'=1  ; 1=PTF record, 2=census record
"RTN","SPNJRPIP",39,0)
 . ;wde/line added below to block fee basis records in the count 2/18/99
"RTN","SPNJRPIP",40,0)
 . I $$GET1^DIQ(45,RECNR_",",4,"I")=1 Q
"RTN","SPNJRPIP",41,0)
 . ;S NODE70=$G(^DGPT(RECNR,70))
"RTN","SPNJRPIP",42,0)
 . S ZDD=$$GET1^DIQ(45,RECNR_",",70,"I")\1 ; Discharge date
"RTN","SPNJRPIP",43,0)
 . Q:ZDD'=0&(ZDD<FDATE)
"RTN","SPNJRPIP",44,0)
 . S ZAD=$$GET1^DIQ(45,RECNR_",",2,"I")\1 Q:ZAD>TDATE  ; Admit date
"RTN","SPNJRPIP",45,0)
 . S NUMADMS=1
"RTN","SPNJRPIP",46,0)
 Q:NUMADMS=0
"RTN","SPNJRPIP",47,0)
 S ICN=$P($G(^DPT(DFN,"MPI")),"^",1)
"RTN","SPNJRPIP",48,0)
 Q:ICN=""
"RTN","SPNJRPIP",49,0)
 S ^TMP("SPN",$J,ICN)=""
"RTN","SPNJRPIP",50,0)
 Q
"RTN","SPNJRPIP",51,0)
OUT ;
"RTN","SPNJRPIP",52,0)
 S ICN=""
"RTN","SPNJRPIP",53,0)
 F  S ICN=$O(^TMP("SPN",$J,ICN)) Q:ICN=""  D
"RTN","SPNJRPIP",54,0)
 . S ^TMP($J,RETCNT)=ICN_"^EOL999"
"RTN","SPNJRPIP",55,0)
 . S RETCNT=RETCNT+1
"RTN","SPNJRPIP",56,0)
 Q
"RTN","SPNJRPIW")
0^101^B77468632
"RTN","SPNJRPIW",1,0)
SPNJRPIW ;BP/JAS - List Recent Diagnoses with Rad comments ;JUN 17, 2009
"RTN","SPNJRPIW",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNJRPIW",3,0)
 ;
"RTN","SPNJRPIW",4,0)
 ; References to file #45/^DGPT supported by IA #92 and IA #4945
"RTN","SPNJRPIW",5,0)
 ; RETIRED AND REPLACED WITH IA# 3990 [Reference to ^ICD0 supported by IA #10083]
"RTN","SPNJRPIW",6,0)
 ; Reference to API ICDOP^ICDCODE supported by IA #3990
"RTN","SPNJRPIW",7,0)
 ; RETIRED AND REPLACED WITH IA# 3990 [Reference to ^ICD9 supported by IA #10082]
"RTN","SPNJRPIW",8,0)
 ; Reference to API ICDDX^ICDCODE supported by IA #3990
"RTN","SPNJRPIW",9,0)
 ; Reference to API VISIT^PXRHS01 supported by IA #1238
"RTN","SPNJRPIW",10,0)
 ; Reference to ^ICPT supported by IA #2815
"RTN","SPNJRPIW",11,0)
 ; Reference to API CPT^ICPTCOD supported by IA #1995
"RTN","SPNJRPIW",12,0)
 ; References to ^SRF supported by IA #3615
"RTN","SPNJRPIW",13,0)
 ; Reference to ^SRO supported by IA #4872
"RTN","SPNJRPIW",14,0)
 ; Reference to file 74 supported by IA #2479
"RTN","SPNJRPIW",15,0)
 ; API $$FLIP^SPNRPCIC is part of Spinal Cord Version 3.0
"RTN","SPNJRPIW",16,0)
 ;
"RTN","SPNJRPIW",17,0)
COL(ROOT,ICN,SPNCUTDT) ;
"RTN","SPNJRPIW",18,0)
 ;
"RTN","SPNJRPIW",19,0)
 ; return is TMP($J)
"RTN","SPNJRPIW",20,0)
 K ^TMP($J)  ;This is the return file
"RTN","SPNJRPIW",21,0)
 S ROOT=$NA(^TMP($J))
"RTN","SPNJRPIW",22,0)
 ;*********************************************
"RTN","SPNJRPIW",23,0)
 ;  convert icn to dfn
"RTN","SPNJRPIW",24,0)
 Q:$G(ICN)=""
"RTN","SPNJRPIW",25,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNJRPIW",26,0)
 Q:DFN=""
"RTN","SPNJRPIW",27,0)
 ;*********************************************
"RTN","SPNJRPIW",28,0)
 I '$D(^DPT(+$G(DFN))) Q
"RTN","SPNJRPIW",29,0)
 ;             1825= 5 years
"RTN","SPNJRPIW",30,0)
 S X=SPNCUTDT D ^%DT S SPNCUTDT=Y
"RTN","SPNJRPIW",31,0)
JUMPIN1 ;CALLED FROM SPNRPC8 WITH TODAY AS THE CUT DATE
"RTN","SPNJRPIW",32,0)
 ;CUTDATE IS THE DATE TO GO BACK TO FORWARD
"RTN","SPNJRPIW",33,0)
 S CNT=0  ;used to order the icd9's and icd0's
"RTN","SPNJRPIW",34,0)
 S CPTCNT=0  ;used to order the cpt's
"RTN","SPNJRPIW",35,0)
 S SPNPTFIE=0 F  S SPNPTFIE=$O(^DGPT("B",DFN,SPNPTFIE)) Q:(SPNPTFIE="")!('+SPNPTFIE)  D SET45
"RTN","SPNJRPIW",36,0)
 ;
"RTN","SPNJRPIW",37,0)
 D VCPT  ;Build visit file cpt's
"RTN","SPNJRPIW",38,0)
 D SURG
"RTN","SPNJRPIW",39,0)
 D ENTER^SPNRPC4B
"RTN","SPNJRPIW",40,0)
 D CREATE
"RTN","SPNJRPIW",41,0)
 K ^TMP($J,"UTIL")
"RTN","SPNJRPIW",42,0)
 K SPNPTADM,SPNREV,SPNPTRDT,SPNFLD,XYZ,XYZZ,SPNXY,SPNX1,SURCPT,SURCPTX,SURCPTN,%DT
"RTN","SPNJRPIW",43,0)
 K CNT,FIELD,OLDCNT,SPNCNUM,SPNPTFIE,SPNSUDT,SPNXXYZ,SUB,SURX,TOT,TYPE,X,XY,Y
"RTN","SPNJRPIW",44,0)
 K CPTCNT,DFN,LINE,RADLN,RARDA,RARPT
"RTN","SPNJRPIW",45,0)
 K CNT,CPT,CPTCNT,CPTCODE,CPTTXT,DFN,DXIEN,ENTRYDT,EXAM
"RTN","SPNJRPIW",46,0)
 K ICPTTXT,PRODATE,PROSENT,RADCPT,RADDT,RADIMP,REALDT,REVRADT
"RTN","SPNJRPIW",47,0)
 K SPNSCDT,XA,XB,XC,XCCODE,XCODE,XCTEXT,Y
"RTN","SPNJRPIW",48,0)
 K TMSTMP  ;WDE
"RTN","SPNJRPIW",49,0)
 D KILL^SPNRPC4B
"RTN","SPNJRPIW",50,0)
 Q
"RTN","SPNJRPIW",51,0)
SET45 ;loop through PTF file and set up in rev date order
"RTN","SPNJRPIW",52,0)
 S SPNPTADM=$$GET1^DIQ(45,SPNPTFIE_",",2,"I")
"RTN","SPNJRPIW",53,0)
 Q:SPNPTADM<SPNCUTDT
"RTN","SPNJRPIW",54,0)
 S SPNREV=9999999.9999-SPNPTADM
"RTN","SPNJRPIW",55,0)
 S SPNPTRDT=$$GET1^DIQ(45,SPNPTFIE_",",2,"E")
"RTN","SPNJRPIW",56,0)
 D BLD
"RTN","SPNJRPIW",57,0)
 Q
"RTN","SPNJRPIW",58,0)
BLD ;codes from ptf file
"RTN","SPNJRPIW",59,0)
 ;get icdo's from ptf file
"RTN","SPNJRPIW",60,0)
 F SPNFLD=45.01,45.02,45.03,45.04,45.05 D
"RTN","SPNJRPIW",61,0)
 .S XYZ=$$GET1^DIQ(45,SPNPTFIE_",",SPNFLD,"I")
"RTN","SPNJRPIW",62,0)
 .Q:XYZ=""
"RTN","SPNJRPIW",63,0)
 .;JAS 6/17/09 - DEFECT 1137 - Removed direct reads of CPT/ICD files to API usage
"RTN","SPNJRPIW",64,0)
 .;S XYZZ=$P($G(^ICD0(XYZ,0)),U,4)
"RTN","SPNJRPIW",65,0)
 .S SPNARY=$$ICDOP^ICDCODE(XYZ,"","","")
"RTN","SPNJRPIW",66,0)
 .S XYZZ=$P(SPNARY,"^",5)
"RTN","SPNJRPIW",67,0)
 .S CNT=CNT+1
"RTN","SPNJRPIW",68,0)
 .;S ^TMP($J,"UTIL","ICD",SPNREV,CNT)=$P($G(^ICD0(XYZ,0)),U,4)_U_$P($G(^ICD0(XYZ,0)),U,1)_U_SPNPTRDT_U_"DGPT"_U_SPNPTFIE_U
"RTN","SPNJRPIW",69,0)
 .S ^TMP($J,"UTIL","ICD",SPNREV,CNT)=XYZZ_U_$P(SPNARY,U,2)_U_SPNPTRDT_U_"DGPT"_U_SPNPTFIE_U
"RTN","SPNJRPIW",70,0)
 K SPNARY
"RTN","SPNJRPIW",71,0)
 ;---------------------------------------------
"RTN","SPNJRPIW",72,0)
 ;get icd9's from pft file
"RTN","SPNJRPIW",73,0)
 F SPNFLD=79,79.16,79.17,79.18,79.19,79.201,79.21,79.22,79.23,79.24,80 D
"RTN","SPNJRPIW",74,0)
 .S XYZ=$$GET1^DIQ(45,SPNPTFIE_",",SPNFLD,"I")
"RTN","SPNJRPIW",75,0)
 .Q:XYZ=""
"RTN","SPNJRPIW",76,0)
 .;JAS 6/17/09 - DEFECT 1137 - Removed direct reads of CPT/ICD files to API usage
"RTN","SPNJRPIW",77,0)
 .;S XYZZ=$P($G(^ICD9(XYZ,0)),U,3)
"RTN","SPNJRPIW",78,0)
 .S SPNARY=$$ICDDX^ICDCODE(XYZ,"","","")
"RTN","SPNJRPIW",79,0)
 .S XYZZ=$P(SPNARY,"^",4)
"RTN","SPNJRPIW",80,0)
 .S CNT=CNT+1
"RTN","SPNJRPIW",81,0)
 .;S ^TMP($J,"UTIL","ICD",SPNREV,CNT)=$P($G(^ICD9(XYZ,0)),U,3)_U_$P($G(^ICD9(XYZ,0)),U,1)_U_SPNPTRDT_U_"DGPT"_U_SPNPTFIE_U
"RTN","SPNJRPIW",82,0)
 .S ^TMP($J,"UTIL","ICD",SPNREV,CNT)=XYZZ_U_$P(SPNARY,U,2)_U_SPNPTRDT_U_"DGPT"_U_SPNPTFIE_U
"RTN","SPNJRPIW",83,0)
 K SPNARY
"RTN","SPNJRPIW",84,0)
BLD2 ;get 40 subscript
"RTN","SPNJRPIW",85,0)
 S SPNXY=0 F  S SPNXY=$O(^DGPT(SPNPTFIE,"S",SPNXY)) Q:(SPNXY=0)!('+SPNXY)  D
"RTN","SPNJRPIW",86,0)
 .S SPNSUDT=$$GET1^DIQ(45.01,SPNXY_","_SPNPTFIE_",",.01,"I")
"RTN","SPNJRPIW",87,0)
 .Q:SPNSUDT=""
"RTN","SPNJRPIW",88,0)
 .S Y=SPNSUDT X ^DD("DD") S SPNXXYZ=Y  ;date time
"RTN","SPNJRPIW",89,0)
 .S SPNSUDT=9999999.9999-SPNSUDT  ;rev date time
"RTN","SPNJRPIW",90,0)
 .F SPNFLD=8,9,10,11,12 D
"RTN","SPNJRPIW",91,0)
 ..S XYZ=$$GET1^DIQ(45.01,SPNXY_","_SPNPTFIE_",",SPNFLD,"I")
"RTN","SPNJRPIW",92,0)
 ..Q:XYZ=""
"RTN","SPNJRPIW",93,0)
 ..;JAS 6/17/09 - DEFECT 1137 - Removed direct reads of CPT/ICD files to API usage
"RTN","SPNJRPIW",94,0)
 ..S SPNARY=$$ICDOP^ICDCODE(XYZ,"","","")
"RTN","SPNJRPIW",95,0)
 ..S CNT=CNT+1
"RTN","SPNJRPIW",96,0)
 ..;S ^TMP($J,"UTIL","ICD",SPNSUDT,CNT)=$P($G(^ICD0(XYZ,0)),U,4)_U_$P($G(^ICD0(XYZ,0)),U,1)_U_SPNXXYZ_U_"DGPT"_U_SPNPTFIE_U
"RTN","SPNJRPIW",97,0)
 ..S ^TMP($J,"UTIL","ICD",SPNSUDT,CNT)=$P(SPNARY,U,5)_U_$P(SPNARY,U,2)_U_SPNXXYZ_U_"DGPT"_U_SPNPTFIE_U
"RTN","SPNJRPIW",98,0)
 .Q
"RTN","SPNJRPIW",99,0)
 K SPNARY
"RTN","SPNJRPIW",100,0)
 ;get the 60's now
"RTN","SPNJRPIW",101,0)
 S SPNXY=0 F  S SPNXY=$O(^DGPT(SPNPTFIE,"P",SPNXY)) Q:(SPNXY=0)!('+SPNXY)  D
"RTN","SPNJRPIW",102,0)
 .S SPNSUDT=$$GET1^DIQ(45.05,SPNXY_","_SPNPTFIE_",",.01,"I")
"RTN","SPNJRPIW",103,0)
 .Q:SPNSUDT=""
"RTN","SPNJRPIW",104,0)
 .S Y=SPNSUDT X ^DD("DD") S SPNXXYZ=Y  ;date time
"RTN","SPNJRPIW",105,0)
 .S SPNSUDT=9999999.9999-SPNSUDT
"RTN","SPNJRPIW",106,0)
 .F SPNFLD=5,6,7,8,9 D
"RTN","SPNJRPIW",107,0)
 ..S XYZ=$$GET1^DIQ(45.05,SPNXY_","_SPNPTFIE_",",SPNFLD,"I")
"RTN","SPNJRPIW",108,0)
 ..Q:XYZ=""
"RTN","SPNJRPIW",109,0)
 ..;JAS 6/17/09 - DEFECT 1137 - Removed direct reads of CPT/ICD files to API usage
"RTN","SPNJRPIW",110,0)
 ..S SPNARY=$$ICDOP^ICDCODE(XYZ,"","","")
"RTN","SPNJRPIW",111,0)
 ..S CNT=CNT+1
"RTN","SPNJRPIW",112,0)
 ..;S ^TMP($J,"UTIL","ICD",SPNSUDT,CNT)=$P($G(^ICD0(XYZ,0)),U,4)_U_$P($G(^ICD0(XYZ,0)),U,1)_U_SPNXXYZ_U_"DGPT"_U_SPNPTFIE_U
"RTN","SPNJRPIW",113,0)
 ..S ^TMP($J,"UTIL","ICD",SPNSUDT,CNT)=$P(SPNARY,U,5)_U_$P(SPNARY,U,2)_U_SPNXXYZ_U_"DGPT"_U_SPNPTFIE_U
"RTN","SPNJRPIW",114,0)
 K SPNARY
"RTN","SPNJRPIW",115,0)
 Q
"RTN","SPNJRPIW",116,0)
VCPT ;------------------------------------------------------------------
"RTN","SPNJRPIW",117,0)
 ;visit file cpt's
"RTN","SPNJRPIW",118,0)
 K ^TMP("PXHSV",$J)
"RTN","SPNJRPIW",119,0)
 ;02/27/08 JAS DEFECTS 188,191&192 - MODIFIED VCPT/VCPT2 TO INCLUDE ICDS ALONG WITH CPTS
"RTN","SPNJRPIW",120,0)
 ;D VISIT^PXRHS01(DFN,"",SPNCUTDT,"","AHICTNSOERDX","C",1)
"RTN","SPNJRPIW",121,0)
 D VISIT^PXRHS01(DFN,"",SPNCUTDT,"","AHICTNSOERDX","CD",1)
"RTN","SPNJRPIW",122,0)
 F CDTYP="C","D" D VCPT2
"RTN","SPNJRPIW",123,0)
 K RVDT,COUNT,X,VTMSTMP,MDT,XSTRING,ICPTIEN,CDTYP,CDTYP2,FTYP
"RTN","SPNJRPIW",124,0)
 K ^TMP("PXHSV",$J)
"RTN","SPNJRPIW",125,0)
 Q
"RTN","SPNJRPIW",126,0)
VCPT2 ;
"RTN","SPNJRPIW",127,0)
 ;JAS - 05/15/08 - DEFECT 1090 (MULTIPLE CHANGES BELOW)
"RTN","SPNJRPIW",128,0)
 ;S RVDT=""
"RTN","SPNJRPIW",129,0)
 S RVDT=0
"RTN","SPNJRPIW",130,0)
 F  S RVDT=$O(^TMP("PXHSV",$J,RVDT)) Q:RVDT=""  D
"RTN","SPNJRPIW",131,0)
 .;S COUNT=""
"RTN","SPNJRPIW",132,0)
 .S COUNT=0
"RTN","SPNJRPIW",133,0)
 .F  S COUNT=$O(^TMP("PXHSV",$J,RVDT,COUNT)) Q:COUNT=""  D
"RTN","SPNJRPIW",134,0)
 ..;Q:'$D(^TMP("PXHSV",$J,RVDT,COUNT,"C"))
"RTN","SPNJRPIW",135,0)
 ..Q:'$D(^TMP("PXHSV",$J,RVDT,COUNT,CDTYP))
"RTN","SPNJRPIW",136,0)
 ..;S X=""
"RTN","SPNJRPIW",137,0)
 ..S X=0
"RTN","SPNJRPIW",138,0)
 ..;F  S X=$O(^TMP("PXHSV",$J,RVDT,COUNT,"C",X)) Q:X=""  D
"RTN","SPNJRPIW",139,0)
 ..F  S X=$O(^TMP("PXHSV",$J,RVDT,COUNT,CDTYP,X)) Q:X=""  D
"RTN","SPNJRPIW",140,0)
 ...;S ICPTIEN=$P(^TMP("PXHSV",$J,RVDT,COUNT,"C",X),"^",1)
"RTN","SPNJRPIW",141,0)
 ...S ICPTIEN=$P(^TMP("PXHSV",$J,RVDT,COUNT,CDTYP,X),"^",1)
"RTN","SPNJRPIW",142,0)
 ...S MDT=9999999-$P(RVDT,".",1)
"RTN","SPNJRPIW",143,0)
 ...S TMSTMP=MDT_"."_$P(RVDT,".",2)
"RTN","SPNJRPIW",144,0)
 ...S Y=TMSTMP X ^DD("DD") S VTMSTMP=Y  ;date time
"RTN","SPNJRPIW",145,0)
 ...I MDT<2890101 S MDT=2890101
"RTN","SPNJRPIW",146,0)
 ...;S XSTRING=$$CPT^ICPTCOD(ICPTIEN,MDT,"")
"RTN","SPNJRPIW",147,0)
 ...;S XYZZ=$P(XSTRING,"^",2)
"RTN","SPNJRPIW",148,0)
 ...;S XYZ=$P(XSTRING,"^",3)
"RTN","SPNJRPIW",149,0)
 ...I CDTYP="C" D
"RTN","SPNJRPIW",150,0)
 ....S XSTRING=$$CPT^ICPTCOD(ICPTIEN,MDT,"")
"RTN","SPNJRPIW",151,0)
 ....S XYZZ=$P(XSTRING,"^",2)
"RTN","SPNJRPIW",152,0)
 ....S XYZ=$P(XSTRING,"^",3)
"RTN","SPNJRPIW",153,0)
 ....S CDTYP2="CPT",FTYP="AUPNVCPT("
"RTN","SPNJRPIW",154,0)
 ...I CDTYP="D" D
"RTN","SPNJRPIW",155,0)
 ....;JAS 6/17/09 - DEFECT 1137 - Removed direct reads of CPT/ICD files to API usage
"RTN","SPNJRPIW",156,0)
 ....S SPNARY=$$ICDDX^ICDCODE(ICPTIEN,"","","")
"RTN","SPNJRPIW",157,0)
 ....;S XYZZ=$P($G(^ICD9(ICPTIEN,0)),U,1)
"RTN","SPNJRPIW",158,0)
 ....S XYZZ=$P(SPNARY,"^",2)
"RTN","SPNJRPIW",159,0)
 ....;S XYZ=$P($G(^ICD9(ICPTIEN,0)),U,3)
"RTN","SPNJRPIW",160,0)
 ....S XYZ=$P(SPNARY,"^",4)
"RTN","SPNJRPIW",161,0)
 ....S CDTYP2="ICD",FTYP="AUPNVPOV("
"RTN","SPNJRPIW",162,0)
 ...S CPTCNT=CPTCNT+1
"RTN","SPNJRPIW",163,0)
 ...;S ^TMP($J,"UTIL","CPT",RVDT,CPTCNT)=XYZ_U_XYZZ_U_VTMSTMP_U_"AUPNVCPT("_U_X_U
"RTN","SPNJRPIW",164,0)
 ...S ^TMP($J,"UTIL",CDTYP2,RVDT,CPTCNT)=XYZ_U_XYZZ_U_VTMSTMP_U_FTYP_U_X_U
"RTN","SPNJRPIW",165,0)
 ;K RVDT,COUNT,X,VTMSTMP,MDT,XSTRING,ICPTIEN
"RTN","SPNJRPIW",166,0)
 ;K ^TMP("PXHSV",$J)
"RTN","SPNJRPIW",167,0)
 K SPNARY
"RTN","SPNJRPIW",168,0)
 Q
"RTN","SPNJRPIW",169,0)
SURG ;------------------------------------------------------------
"RTN","SPNJRPIW",170,0)
 ;get surgery icd's
"RTN","SPNJRPIW",171,0)
 S X=0 F  S X=$O(^SRF("B",DFN,X)) Q:(X="")!('+X)  D
"RTN","SPNJRPIW",172,0)
 .S SPNSRDT=$P($G(^SRF(X,0)),U,9)
"RTN","SPNJRPIW",173,0)
 .Q:SPNSRDT=""
"RTN","SPNJRPIW",174,0)
 .Q:SPNSRDT<SPNCUTDT
"RTN","SPNJRPIW",175,0)
 .S SPNSRDT=9999999.9999-SPNSRDT
"RTN","SPNJRPIW",176,0)
 .;S FIELD=14 D CHKSUR  ;Rob requested not to include pre op codes
"RTN","SPNJRPIW",177,0)
 .S FIELD=4 D CHKSUR
"RTN","SPNJRPIW",178,0)
 .D SURCPT
"RTN","SPNJRPIW",179,0)
 .Q
"RTN","SPNJRPIW",180,0)
 ;PUGET ERROR TRAP 12/21/07 - ADDED LINE BELOW
"RTN","SPNJRPIW",181,0)
 K SPNSRDT
"RTN","SPNJRPIW",182,0)
 Q
"RTN","SPNJRPIW",183,0)
CHKSUR ;
"RTN","SPNJRPIW",184,0)
 S SPNX1=0 F  S SPNX1=$O(^SRO(136,X,FIELD,SPNX1)) Q:(SPNX1="")!('+SPNX1)  D
"RTN","SPNJRPIW",185,0)
 .S SPNXCODE=$P($G(^SRO(136,X,FIELD,SPNX1,0)),U,1) Q:SPNXCODE=""
"RTN","SPNJRPIW",186,0)
 .;JAS 6/17/09 - DEFECT 1137 - Removed direct reads of CPT/ICD files to API usage
"RTN","SPNJRPIW",187,0)
 .S SPNARY=$$ICDDX^ICDCODE(SPNXCODE,"","","")
"RTN","SPNJRPIW",188,0)
 .;S SPNCNUM=$P($G(^ICD9(SPNXCODE,0)),U,1)
"RTN","SPNJRPIW",189,0)
 .S SPNCNUM=$P(SPNARY,"^",2)
"RTN","SPNJRPIW",190,0)
 .;S SPNXCODE=$P($G(^ICD9(SPNXCODE,0)),U,3)
"RTN","SPNJRPIW",191,0)
 .S SPNXCODE=$P(SPNARY,"^",4)
"RTN","SPNJRPIW",192,0)
 .;PUGET ERROR TRAP 12/21/07
"RTN","SPNJRPIW",193,0)
 .;S SPNSRDT=$P($G(^SRF(X,0)),U,9)
"RTN","SPNJRPIW",194,0)
 .;Q:SPNSRDT=""
"RTN","SPNJRPIW",195,0)
 .;Q:SPNSRDT<SPNCUTDT
"RTN","SPNJRPIW",196,0)
 .;S SPNSRDT=9999999.9999-SPNSRDT
"RTN","SPNJRPIW",197,0)
 .S CNT=CNT+1
"RTN","SPNJRPIW",198,0)
 .S ^TMP($J,"UTIL","ICD",SPNSRDT,CNT)=SPNXCODE_U_SPNCNUM_U_$$GET1^DIQ(130,X_",",.09,"E")_U_"SRF"_U_X_"/"_FIELD_U
"RTN","SPNJRPIW",199,0)
 .;PUGET ERROR TRAP 12/21/07
"RTN","SPNJRPIW",200,0)
 .;K SPNSRDT,SPNXCODE
"RTN","SPNJRPIW",201,0)
 .K SPNXCODE
"RTN","SPNJRPIW",202,0)
 .Q
"RTN","SPNJRPIW",203,0)
 K SPNARY
"RTN","SPNJRPIW",204,0)
 Q
"RTN","SPNJRPIW",205,0)
SURCPT ;SURG CPTS
"RTN","SPNJRPIW",206,0)
 S SURX=0 F  S SURX=$O(^SRO(136,X,3,SURX)) Q:(SURX="")!('+SURX)  D
"RTN","SPNJRPIW",207,0)
 .S SURCPT=$P($G(^SRO(136,X,3,SURX,0)),U,1)
"RTN","SPNJRPIW",208,0)
 .;JAS 6/17/09 - DEFECT 1137 - Removed direct reads of CPT/ICD files to API usage
"RTN","SPNJRPIW",209,0)
 .S SPNARY=$$CPT^ICPTCOD(SURCPT,"","")
"RTN","SPNJRPIW",210,0)
 .;S SURCPTN=$P($G(^ICPT(SURCPT,0)),U,1)  ;NUMBER
"RTN","SPNJRPIW",211,0)
 .S SURCPTN=$P(SPNARY,"^",2)
"RTN","SPNJRPIW",212,0)
 .;S SURCPTX=$P($G(^ICPT(SURCPT,0)),U,2)  ;TEXT
"RTN","SPNJRPIW",213,0)
 .S SURCPTX=$P(SPNARY,"^",3)
"RTN","SPNJRPIW",214,0)
 .S CPTCNT=CPTCNT+1
"RTN","SPNJRPIW",215,0)
 .S ^TMP($J,"UTIL","CPT",SPNSRDT,CPTCNT)=SURCPTX_U_SURCPTN_U_$$GET1^DIQ(130,X_",",.09,"E")_U_"SRF("_U_X_U
"RTN","SPNJRPIW",216,0)
 K SPNARY
"RTN","SPNJRPIW",217,0)
 Q
"RTN","SPNJRPIW",218,0)
CREATE ;
"RTN","SPNJRPIW",219,0)
 S (X,CNT,OLDCNT)=0
"RTN","SPNJRPIW",220,0)
 S ^TMP($J,"CPT",0)="CPTBREAK^EOL999"
"RTN","SPNJRPIW",221,0)
 S ^TMP($J,"ICD",0)="ICDBREAK^EOL999"
"RTN","SPNJRPIW",222,0)
 F SUB="CPT","ICD" S X=0 F  S X=$O(^TMP($J,"UTIL",SUB,X)) Q:(X="")!('+X)  S OLDCNT=0 F  S OLDCNT=$O(^TMP($J,"UTIL",SUB,X,OLDCNT)) Q:(OLDCNT="")!('+OLDCNT)  D
"RTN","SPNJRPIW",223,0)
 .S CNT=CNT+1
"RTN","SPNJRPIW",224,0)
 .S ^TMP($J,SUB,CNT)=$G(^TMP($J,"UTIL",SUB,X,OLDCNT))_"^EOL999"
"RTN","SPNJRPIW",225,0)
 .S RARPT=$P($G(^TMP($J,"UTIL",SUB,X,OLDCNT)),"^",6)
"RTN","SPNJRPIW",226,0)
 .I RARPT'=""&($P(RARPT," ",1)="RARPT") D
"RTN","SPNJRPIW",227,0)
 ..S RARDA=$P(RARPT," ",2)
"RTN","SPNJRPIW",228,0)
 ..F TYPE=200,300,400 D
"RTN","SPNJRPIW",229,0)
 ...K WP
"RTN","SPNJRPIW",230,0)
 ...S WP=$$GET1^DIQ(74,RARDA_",",TYPE,"","WP")
"RTN","SPNJRPIW",231,0)
 ...Q:$D(WP)'=11
"RTN","SPNJRPIW",232,0)
 ...S TYPEL=$S(TYPE=200:"R",TYPE=300:"I",TYPE=400:"H")
"RTN","SPNJRPIW",233,0)
 ...S LINE="" F  S LINE=$O(WP(LINE)) Q:LINE=""  D
"RTN","SPNJRPIW",234,0)
 ....S RADLN=WP(LINE)
"RTN","SPNJRPIW",235,0)
 ....I RADLN=""!(RADLN=" ") Q
"RTN","SPNJRPIW",236,0)
 ....S CNT=CNT+1
"RTN","SPNJRPIW",237,0)
 ....S ^TMP($J,SUB,CNT)="COM-"_TYPEL_"^"_RADLN_U_"EOL999"
"RTN","SPNJRPIW",238,0)
 ....Q
"RTN","SPNJRPIW",239,0)
 ...K TYPEL,WP
"RTN","SPNJRPIW",240,0)
 ...Q
"RTN","SPNJRPIW",241,0)
 ..Q
"RTN","SPNJRPIW",242,0)
 .Q
"RTN","SPNJRPIW",243,0)
 Q
"RTN","SPNJRPML")
0^102^B5642555
"RTN","SPNJRPML",1,0)
SPNJRPML ;BP/JAS - Send Mailman notifications ;JUN 25, 2007
"RTN","SPNJRPML",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNJRPML",3,0)
 ;;
"RTN","SPNJRPML",4,0)
 ;;  Reference to API $$GOTLOCAL^XMXAPIG supported by IA# 3006
"RTN","SPNJRPML",5,0)
 ;;  Reference to API SENDMSG^XMXAPI supported by IA# 2729
"RTN","SPNJRPML",6,0)
 ;;
"RTN","SPNJRPML",7,0)
 ;;  SUCCESS - RETURNS 1 FOR SUCCESS, 0 FOR FAILURE
"RTN","SPNJRPML",8,0)
 ;;  FROM - DUZ OF THE USER INITIATING THE NOTIFICATION
"RTN","SPNJRPML",9,0)
 ;;  SUBJECT - SUBJECT OF MAILMAN NOTIFICATION
"RTN","SPNJRPML",10,0)
 ;;  PAR - FOUR OPTIONS, SET TO 1 IF CHOSEN:
"RTN","SPNJRPML",11,0)
 ;;           PIECE 1 - PRIORITY
"RTN","SPNJRPML",12,0)
 ;;           PIECE 2 - INFORMATION ONLY
"RTN","SPNJRPML",13,0)
 ;;           PIECE 3 - CONFIRMATION REQUIRED
"RTN","SPNJRPML",14,0)
 ;;           PIECE 4 - COPY IN 'IN' BASKET
"RTN","SPNJRPML",15,0)
 ;;  ARRAY - CONTAINS MESSAGE AND RECIPIENTS:
"RTN","SPNJRPML",16,0)
 ;;           ARRAY("TEXT",1...n) = MESSAGE LINES (LIMIT TO 80 CHARS PER LINE)
"RTN","SPNJRPML",17,0)
 ;;           ARRAY("TO",1...n) = RECIPIENTS (DUZ CODES)
"RTN","SPNJRPML",18,0)
 ;;           
"RTN","SPNJRPML",19,0)
MAIL(SUCCESS,FROM,SUBJECT,PAR,TEXT,MLTO) ; SEND VISTA MESSAGE
"RTN","SPNJRPML",20,0)
 S SUCCESS=0 K SPNT,TO,GROUP
"RTN","SPNJRPML",21,0)
 I $O(TEXT(0))="" Q
"RTN","SPNJRPML",22,0)
 I $O(MLTO(0))="" Q
"RTN","SPNJRPML",23,0)
 I $G(SUBJECT)="" Q
"RTN","SPNJRPML",24,0)
 I $G(FROM)="" Q
"RTN","SPNJRPML",25,0)
 F J=0:0 S J=$O(TEXT(J)) Q:J<1  S SPNT(J)=TEXT(J)
"RTN","SPNJRPML",26,0)
 F J=0:0 S J=$O(MLTO(J)) Q:J<1  D
"RTN","SPNJRPML",27,0)
 .S MAIL=MLTO(J)
"RTN","SPNJRPML",28,0)
 .I MAIL["@" S TO(MAIL)=""  Q
"RTN","SPNJRPML",29,0)
 .I $$GOTLOCAL^XMXAPIG(MAIL) D  Q
"RTN","SPNJRPML",30,0)
 ..S TO("G."_MAIL)=""
"RTN","SPNJRPML",31,0)
 .S TO(MAIL)=""
"RTN","SPNJRPML",32,0)
 S TITLE=SUBJECT
"RTN","SPNJRPML",33,0)
 I $G(PAR)]"" D
"RTN","SPNJRPML",34,0)
 .S PRIO=$P(PAR,U)
"RTN","SPNJRPML",35,0)
 .S INFO=$P(PAR,U,2)
"RTN","SPNJRPML",36,0)
 .S CONFIRM=$P(PAR,U,3)
"RTN","SPNJRPML",37,0)
 .I $P(PAR,U,4) S TO(FROM)="" ; SENDER'S IN BASKET
"RTN","SPNJRPML",38,0)
 D MSG
"RTN","SPNJRPML",39,0)
 K TEXT,TO,PAR,FROM,SUBJECT,IEN,J,MAIL
"RTN","SPNJRPML",40,0)
 Q
"RTN","SPNJRPML",41,0)
MSG ;
"RTN","SPNJRPML",42,0)
 N XMINSTR
"RTN","SPNJRPML",43,0)
 Q:'$O(SPNT(0))
"RTN","SPNJRPML",44,0)
 Q:$O(TO(""))=""
"RTN","SPNJRPML",45,0)
 I $G(CONFIRM) S XMINSTR("FLAGS")=$G(XMINSTR("FLAGS"))_"R"
"RTN","SPNJRPML",46,0)
 I $G(PRIO) S XMINSTR("FLAGS")=$G(XMINSTR("FLAGS"))_"P"
"RTN","SPNJRPML",47,0)
 I $G(INFO) S XMINSTR("FLAGS")=$G(XMINSTR("FLAGS"))_"I"
"RTN","SPNJRPML",48,0)
 I '$D(FROM) S FROM=.5
"RTN","SPNJRPML",49,0)
 S XMINSTR("FROM")="POSTMASTER"
"RTN","SPNJRPML",50,0)
 I '$D(TITLE) S TITLE="Title not specified by sender"
"RTN","SPNJRPML",51,0)
 I $L(TITLE)>65 S TITLE=$E(TITLE,1,65)
"RTN","SPNJRPML",52,0)
 I $L(TITLE)<3 S TITLE=TITLE_"..."
"RTN","SPNJRPML",53,0)
 D SENDMSG^XMXAPI(FROM,TITLE,"SPNT",.TO,.XMINSTR)
"RTN","SPNJRPML",54,0)
 I $G(XMERR)'>0 S SUCCESS=1
"RTN","SPNJRPML",55,0)
 K CONFIRM,FROM,GROUP,INFO,PRIO,SPNT,TITLE,TO,^TMP("XMERR",$J),XMERR
"RTN","SPNJRPML",56,0)
 Q
"RTN","SPNJRPOP")
0^90^B5917365
"RTN","SPNJRPOP",1,0)
SPNJRPOP ;BP/JAS - Returns list of ICNs for Outpatients ;JUL 01, 2008
"RTN","SPNJRPOP",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNJRPOP",3,0)
 ;
"RTN","SPNJRPOP",4,0)
 ; Reference to ^DIC(40.7 supported by IA #557
"RTN","SPNJRPOP",5,0)
 ; Reference to API VISIT^PXRHS01 supported by IA #1238
"RTN","SPNJRPOP",6,0)
 ; API $$FLIP^SPNRPCIC is part of Spinal Cord Version 3.0
"RTN","SPNJRPOP",7,0)
 ;
"RTN","SPNJRPOP",8,0)
 ; Param values:
"RTN","SPNJRPOP",9,0)
 ;     RETURN is the list of ICNs who meet criteria
"RTN","SPNJRPOP",10,0)
 ;     ICNLST  is the list of patient ICNs to process
"RTN","SPNJRPOP",11,0)
 ;     FDATE is the start date for period
"RTN","SPNJRPOP",12,0)
 ;     TDATE is the end date for period
"RTN","SPNJRPOP",13,0)
 ;     CLINLST is the Clinic Stops for Outpatients
"RTN","SPNJRPOP",14,0)
 ;
"RTN","SPNJRPOP",15,0)
 ; Returns: ^TMP($J)
"RTN","SPNJRPOP",16,0)
 ;
"RTN","SPNJRPOP",17,0)
COL(RETURN,ICNLST,FDATE,TDATE,CLINLST) ;
"RTN","SPNJRPOP",18,0)
 ;
"RTN","SPNJRPOP",19,0)
 K ^TMP($J),CLLIST
"RTN","SPNJRPOP",20,0)
 S RETURN=$NA(^TMP($J)),RETCNT=1
"RTN","SPNJRPOP",21,0)
 D CLLOAD
"RTN","SPNJRPOP",22,0)
 S X=FDATE S %DT="T" D ^%DT S FDATE=Y
"RTN","SPNJRPOP",23,0)
 I FDATE=-1 S FDATE=1000101
"RTN","SPNJRPOP",24,0)
 S X=TDATE S %DT="T" D ^%DT S TDATE=Y
"RTN","SPNJRPOP",25,0)
 I TDATE=-1 S TDATE=DT
"RTN","SPNJRPOP",26,0)
 ;JAS 02/05/08 - DEFECT 801 (NEXT LINE)
"RTN","SPNJRPOP",27,0)
 S TDATE=TDATE_".999999"
"RTN","SPNJRPOP",28,0)
 S ICNNM=""
"RTN","SPNJRPOP",29,0)
 F  S ICNNM=$O(ICNLST(ICNNM)) Q:ICNNM=""  D
"RTN","SPNJRPOP",30,0)
 . S ICN=ICNLST(ICNNM) D IN
"RTN","SPNJRPOP",31,0)
 D ZAP
"RTN","SPNJRPOP",32,0)
 Q
"RTN","SPNJRPOP",33,0)
IN ;
"RTN","SPNJRPOP",34,0)
 Q:$G(ICN)=""
"RTN","SPNJRPOP",35,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNJRPOP",36,0)
 Q:$G(DFN)=""
"RTN","SPNJRPOP",37,0)
 ;***************************
"RTN","SPNJRPOP",38,0)
 K ^TMP("PXHSV",$J)
"RTN","SPNJRPOP",39,0)
 D VISIT^PXRHS01(DFN,TDATE,FDATE,"","AHICTNSOERDX")
"RTN","SPNJRPOP",40,0)
 ;JAS - 05/15/08 - DEFECT 1090 (MULTIPLE EDITS BELOW)
"RTN","SPNJRPOP",41,0)
 ;S REVDT="",FND=0
"RTN","SPNJRPOP",42,0)
 S REVDT=0,FND=0
"RTN","SPNJRPOP",43,0)
 F  S REVDT=$O(^TMP("PXHSV",$J,REVDT)) Q:REVDT=""!(FND)  D
"RTN","SPNJRPOP",44,0)
 . ;S VCNT=""
"RTN","SPNJRPOP",45,0)
 . S VCNT=0
"RTN","SPNJRPOP",46,0)
 . F  S VCNT=$O(^TMP("PXHSV",$J,REVDT,VCNT)) Q:VCNT=""!(FND)  D
"RTN","SPNJRPOP",47,0)
 . . S CLINICNA=$P(^TMP("PXHSV",$J,REVDT,VCNT,0),"^",9)
"RTN","SPNJRPOP",48,0)
 . . Q:CLINICNA=""
"RTN","SPNJRPOP",49,0)
 . . I $D(CLLIST("ALL")) S ^TMP($J,RETCNT)=ICN_U_"EOL999",RETCNT=RETCNT+1,FND=1 Q
"RTN","SPNJRPOP",50,0)
 . . I $G(CLLIST(CLINICNA)) S ^TMP($J,RETCNT)=ICN_U_"EOL999",RETCNT=RETCNT+1,FND=1 Q
"RTN","SPNJRPOP",51,0)
 . . Q
"RTN","SPNJRPOP",52,0)
 . Q
"RTN","SPNJRPOP",53,0)
 Q
"RTN","SPNJRPOP",54,0)
ZAP      ;
"RTN","SPNJRPOP",55,0)
 K %DT,X,Y,CLINICNA,^TMP("PXHSV",$J)
"RTN","SPNJRPOP",56,0)
 K CL,CLIEN,CLINICS,CLLIST
"RTN","SPNJRPOP",57,0)
 K DFN,FDATE,ICN,I,FND
"RTN","SPNJRPOP",58,0)
 K CLA,CLIDX,CLNM,CLNAM
"RTN","SPNJRPOP",59,0)
 K CLINNM,ICNNM,RETCNT,REVDT,VCNT
"RTN","SPNJRPOP",60,0)
 Q
"RTN","SPNJRPOP",61,0)
CLLOAD   ;CREATE CLINIC LIST FROM USER'S STRING INPUT
"RTN","SPNJRPOP",62,0)
 I $G(CLINLST(1))="" S CLLIST("ALL")="" Q
"RTN","SPNJRPOP",63,0)
 S CLINNM=""
"RTN","SPNJRPOP",64,0)
 F  S CLINNM=$O(CLINLST(CLINNM)) Q:CLINNM=""  D
"RTN","SPNJRPOP",65,0)
 . S CL=CLINLST(CLINNM)
"RTN","SPNJRPOP",66,0)
 . I $D(^DIC(40.7,"C",CL)) D
"RTN","SPNJRPOP",67,0)
 . . S CLNM=CL,CLIDX=$O(^DIC(40.7,"C",CL,""))
"RTN","SPNJRPOP",68,0)
 . . I CLIDX="" S CLLIST(CLNM)=CLNM Q
"RTN","SPNJRPOP",69,0)
 . . S CLNAM=$P($G(^DIC(40.7,CLIDX,0)),"^",1)
"RTN","SPNJRPOP",70,0)
 . . S CLLIST(CLNAM)=CLNM_";"_CLNAM
"RTN","SPNJRPOP",71,0)
 . . Q
"RTN","SPNJRPOP",72,0)
 . Q
"RTN","SPNJRPOP",73,0)
 Q
"RTN","SPNJRPP1")
0^22^B23248535
"RTN","SPNJRPP1",1,0)
SPNJRPP1 ;BP/JAS - Returns Prosthetic Utilization info ;May 15, 2008
"RTN","SPNJRPP1",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNJRPP1",3,0)
 ;
"RTN","SPNJRPP1",4,0)
 ; References to ^RMPR(660 supported by IA# 4975
"RTN","SPNJRPP1",5,0)
 ; Reference to file 4 supported by IA# 10090
"RTN","SPNJRPP1",6,0)
 ; Reference to API DEM^VADPT supported by IA# 10061
"RTN","SPNJRPP1",7,0)
 ; Reference to API PSASHCPC^RMPOPF supported by IA# 4975
"RTN","SPNJRPP1",8,0)
 ; API $$FLIP^SPNRPCIC is part of Spinal Cord Version 3.0
"RTN","SPNJRPP1",9,0)
 ;
"RTN","SPNJRPP1",10,0)
 ; Parm values:
"RTN","SPNJRPP1",11,0)
 ;     RETURN  is the sorted data from the earliest date of listing
"RTN","SPNJRPP1",12,0)
 ;     ICNLST  is the list of patient ICNs to process
"RTN","SPNJRPP1",13,0)
 ;     FDATE   is the delivery starting date
"RTN","SPNJRPP1",14,0)
 ;     TDATE   is the delivery ending date
"RTN","SPNJRPP1",15,0)
 ;
"RTN","SPNJRPP1",16,0)
 ; Returns: ^TMP($J)
"RTN","SPNJRPP1",17,0)
 ;
"RTN","SPNJRPP1",18,0)
COL(RETURN,ICNLST,FDATE,TDATE) ;
"RTN","SPNJRPP1",19,0)
 ;
"RTN","SPNJRPP1",20,0)
 ;***************************
"RTN","SPNJRPP1",21,0)
 S RETURN=$NA(^TMP($J)),RETCNT=1
"RTN","SPNJRPP1",22,0)
 S X=FDATE S %DT="T" D ^%DT S SPNSTRT=Y
"RTN","SPNJRPP1",23,0)
 S X=TDATE S %DT="T" D ^%DT S SPNEND=Y_.2359
"RTN","SPNJRPP1",24,0)
 ;***************************
"RTN","SPNJRPP1",25,0)
 K ^TMP($J),^TMP("SPN",$J),CARRY
"RTN","SPNJRPP1",26,0)
 F ICNNM=1:1:$L(ICNLST,"^") S ICN=$P(ICNLST,"^",ICNNM) D IN
"RTN","SPNJRPP1",27,0)
 D OUT,CLNUP
"RTN","SPNJRPP1",28,0)
 Q
"RTN","SPNJRPP1",29,0)
IN Q:$G(ICN)=""
"RTN","SPNJRPP1",30,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNJRPP1",31,0)
 Q:$G(DFN)=""
"RTN","SPNJRPP1",32,0)
 ;***************************
"RTN","SPNJRPP1",33,0)
 Q:'$D(^RMPR(660,"C",DFN))
"RTN","SPNJRPP1",34,0)
 S ^TMP("SPN",$J,"1ST",DFN)=0
"RTN","SPNJRPP1",35,0)
 ;JAS - 05/15/08 - DEFECT 1090
"RTN","SPNJRPP1",36,0)
 ;S PDA=""
"RTN","SPNJRPP1",37,0)
 S PDA=0
"RTN","SPNJRPP1",38,0)
 F  S PDA=$O(^RMPR(660,"C",DFN,PDA)) Q:PDA=""  D
"RTN","SPNJRPP1",39,0)
 . Q:'$D(^RMPR(660,PDA,0))
"RTN","SPNJRPP1",40,0)
 . S DEDAT=$P($G(^RMPR(660,PDA,0)),"^",12)
"RTN","SPNJRPP1",41,0)
 . Q:DEDAT=""
"RTN","SPNJRPP1",42,0)
 . Q:DEDAT<SPNSTRT!(DEDAT>SPNEND)
"RTN","SPNJRPP1",43,0)
 . S STAT=$P(^RMPR(660,PDA,0),"^",10)
"RTN","SPNJRPP1",44,0)
 . S STAT=$$GET1^DIQ(4,STAT_",",.01)
"RTN","SPNJRPP1",45,0)
 . S RMPRHCDT=$P(^RMPR(660,PDA,0),"^",1)
"RTN","SPNJRPP1",46,0)
 . Q:'$D(^RMPR(660,PDA,1))
"RTN","SPNJRPP1",47,0)
 . S RMPRHCPC=$P(^RMPR(660,PDA,1),"^",4)
"RTN","SPNJRPP1",48,0)
 . Q:RMPRHCPC=""
"RTN","SPNJRPP1",49,0)
 . D PSASHCPC^RMPOPF
"RTN","SPNJRPP1",50,0)
 . Q:RMPREHC=""
"RTN","SPNJRPP1",51,0)
 . S ITEM=RMPREHC
"RTN","SPNJRPP1",52,0)
 . S IDESC=RMPRTHC
"RTN","SPNJRPP1",53,0)
 . D DEM^VADPT
"RTN","SPNJRPP1",54,0)
 . S IQTY=$P(^RMPR(660,PDA,0),"^",7)
"RTN","SPNJRPP1",55,0)
 . S ITYP=$P(^RMPR(660,PDA,0),"^",4)
"RTN","SPNJRPP1",56,0)
 . S ITYP=$S(ITYP="I":"INITIAL ISSUE",ITYP="X":"REPAIR",ITYP="S":"SPARE",ITYP="R":"REPLACE",ITYP=5:"RENTAL",1:"")
"RTN","SPNJRPP1",57,0)
 . S ICOST=$P(^RMPR(660,PDA,0),"^",16)
"RTN","SPNJRPP1",58,0)
 . S IHCP=IDESC
"RTN","SPNJRPP1",59,0)
 . S DEDAT=$$FMTE^XLFDT(DEDAT,"5DZP")
"RTN","SPNJRPP1",60,0)
 . S ^TMP("SPN",$J,"3RD",STAT,VADM(1),ITEM,IHCP,PDA)=STAT_"^"_VADM(1)_"^"_VA("PID")_"^"_ITEM_"^"_IHCP_"^"_IQTY_"^"_ICOST_"^"_ITYP_"^"_DEDAT
"RTN","SPNJRPP1",61,0)
 . S ^TMP("SPN",$J,"1ST",DFN)=^TMP("SPN",$J,"1ST",DFN)+IQTY
"RTN","SPNJRPP1",62,0)
 . I $D(^TMP("SPN",$J,"2ND-A",ITEM,IHCP)) D
"RTN","SPNJRPP1",63,0)
 . . S TQTY=$P(^TMP("SPN",$J,"2ND-A",ITEM,IHCP),"^",1)
"RTN","SPNJRPP1",64,0)
 . . S TQTY=TQTY+IQTY
"RTN","SPNJRPP1",65,0)
 . . S TCOST=$P(^TMP("SPN",$J,"2ND-A",ITEM,IHCP),"^",2)
"RTN","SPNJRPP1",66,0)
 . . S TCOST=TCOST+ICOST
"RTN","SPNJRPP1",67,0)
 . . Q
"RTN","SPNJRPP1",68,0)
 . E  S TQTY=IQTY,TCOST=ICOST
"RTN","SPNJRPP1",69,0)
 . S ^TMP("SPN",$J,"2ND-A",ITEM,IHCP)=TQTY_"^"_TCOST
"RTN","SPNJRPP1",70,0)
 . S ^TMP("SPN",$J,"2ND-B",ITEM,IHCP,DFN)=""
"RTN","SPNJRPP1",71,0)
 . Q
"RTN","SPNJRPP1",72,0)
 Q
"RTN","SPNJRPP1",73,0)
OUT ;
"RTN","SPNJRPP1",74,0)
 S ^TMP($J,RETCNT)="HDR999^PATIENTS^ITEMS^EOL999"
"RTN","SPNJRPP1",75,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPP1",76,0)
 S DFN=""
"RTN","SPNJRPP1",77,0)
 F  S DFN=$O(^TMP("SPN",$J,"1ST",DFN)) Q:DFN=""  D
"RTN","SPNJRPP1",78,0)
 . S TQTY=^TMP("SPN",$J,"1ST",DFN)
"RTN","SPNJRPP1",79,0)
 . I $D(CARRY(TQTY)) S CARRY(TQTY)=CARRY(TQTY)+1
"RTN","SPNJRPP1",80,0)
 . E  S CARRY(TQTY)=1
"RTN","SPNJRPP1",81,0)
 S TQTY=""
"RTN","SPNJRPP1",82,0)
 F  S TQTY=$O(CARRY(TQTY),-1) Q:TQTY=""  D
"RTN","SPNJRPP1",83,0)
 . S ^TMP($J,RETCNT)=CARRY(TQTY)_"^"_TQTY_"^EOL999"
"RTN","SPNJRPP1",84,0)
 . S RETCNT=RETCNT+1
"RTN","SPNJRPP1",85,0)
 ;;;
"RTN","SPNJRPP1",86,0)
 S ^TMP($J,RETCNT)="HDR999^PSAS HCPC^BRIEF DESCRIPTION^QUANTITY^TOTAL COSTS^PATIENTS^EOL999"
"RTN","SPNJRPP1",87,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPP1",88,0)
 S PINUM=""
"RTN","SPNJRPP1",89,0)
 F  S PINUM=$O(^TMP("SPN",$J,"2ND-A",PINUM)) Q:PINUM=""  D
"RTN","SPNJRPP1",90,0)
 . S ITEM=""
"RTN","SPNJRPP1",91,0)
 . F  S ITEM=$O(^TMP("SPN",$J,"2ND-A",PINUM,ITEM)) Q:ITEM=""  D
"RTN","SPNJRPP1",92,0)
 . . S TQTY=$P(^TMP("SPN",$J,"2ND-A",PINUM,ITEM),"^",1)
"RTN","SPNJRPP1",93,0)
 . . S TCOST=$P(^TMP("SPN",$J,"2ND-A",PINUM,ITEM),"^",2)
"RTN","SPNJRPP1",94,0)
 . . I $D(^TMP("SPN",$J,"2ND-B",PINUM,ITEM)) D
"RTN","SPNJRPP1",95,0)
 . . . S DFN="",PACNT=0
"RTN","SPNJRPP1",96,0)
 . . . F  S DFN=$O(^TMP("SPN",$J,"2ND-B",PINUM,ITEM,DFN)) Q:DFN=""  D
"RTN","SPNJRPP1",97,0)
 . . . . S PACNT=PACNT+1
"RTN","SPNJRPP1",98,0)
 . . S ^TMP($J,RETCNT)=PINUM_"^"_ITEM_"^"_TQTY_"^"_TCOST_"^"_PACNT_"^EOL999"
"RTN","SPNJRPP1",99,0)
 . . S RETCNT=RETCNT+1
"RTN","SPNJRPP1",100,0)
 ;;;
"RTN","SPNJRPP1",101,0)
 S ^TMP($J,RETCNT)="HDR999^STATION^NAME^SSN^PSAS HCPC^BRIEF DESCRIPTION^QUANTITY^TOTAL COST^TRANSACTION TYPE^DATE DELIVERED^EOL999"
"RTN","SPNJRPP1",102,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPP1",103,0)
 S STAT=""
"RTN","SPNJRPP1",104,0)
 F  S STAT=$O(^TMP("SPN",$J,"3RD",STAT)) Q:STAT=""  D
"RTN","SPNJRPP1",105,0)
 . S NAM="",PATCNT=0,TQTY=0,TCOST=0
"RTN","SPNJRPP1",106,0)
 . F  S NAM=$O(^TMP("SPN",$J,"3RD",STAT,NAM)) Q:NAM=""  D
"RTN","SPNJRPP1",107,0)
 . . S PINUM="",PATCNT=PATCNT+1
"RTN","SPNJRPP1",108,0)
 . . F  S PINUM=$O(^TMP("SPN",$J,"3RD",STAT,NAM,PINUM)) Q:PINUM=""  D
"RTN","SPNJRPP1",109,0)
 . . . S ITEM=""
"RTN","SPNJRPP1",110,0)
 . . . F  S ITEM=$O(^TMP("SPN",$J,"3RD",STAT,NAM,PINUM,ITEM)) Q:ITEM=""  D
"RTN","SPNJRPP1",111,0)
 . . . . S PDA=""
"RTN","SPNJRPP1",112,0)
 . . . . F  S PDA=$O(^TMP("SPN",$J,"3RD",STAT,NAM,PINUM,ITEM,PDA)) Q:PDA=""  D
"RTN","SPNJRPP1",113,0)
 . . . . . S ^TMP($J,RETCNT)=^TMP("SPN",$J,"3RD",STAT,NAM,PINUM,ITEM,PDA)_"^EOL999"
"RTN","SPNJRPP1",114,0)
 . . . . . S RETCNT=RETCNT+1
"RTN","SPNJRPP1",115,0)
 K ^TMP("SPN",$J)
"RTN","SPNJRPP1",116,0)
 Q
"RTN","SPNJRPP1",117,0)
CLNUP ;
"RTN","SPNJRPP1",118,0)
 K %DT,DEDAT,DFN,HCPREF,ICN,ICNNM,ICOST,IDESC,IHCP,IQTY,IREC0,IREC2
"RTN","SPNJRPP1",119,0)
 K ITDA,ITEM,ITYP,NAM,PACNT,PATCNT,PDA,PINUM,RETCNT,SPNEND
"RTN","SPNJRPP1",120,0)
 K SPNSTRT,STAT,TCOST,TQTY,VA,VADM,X,Y,RMPRHCDT,RMPRHCPC,RMPREHC,RMPRTHC
"RTN","SPNJRPP1",121,0)
 Q
"RTN","SPNJRPP2")
0^23^B18150887
"RTN","SPNJRPP2",1,0)
SPNJRPP2 ;BP/JAS - Returns Prosthetic Utilization Specific info ;May 15, 2008
"RTN","SPNJRPP2",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNJRPP2",3,0)
 ;
"RTN","SPNJRPP2",4,0)
 ; References to ^RMPR(660 supported by IA# 4975
"RTN","SPNJRPP2",5,0)
 ; Reference to file 4 supported by IA# 10090
"RTN","SPNJRPP2",6,0)
 ; Reference to API DEM^VADPT supported by IA# 10061
"RTN","SPNJRPP2",7,0)
 ; Reference to API PSASHCPC^RMPOPF supported by IA# 4975
"RTN","SPNJRPP2",8,0)
 ; API $$FLIP^SPNRPCIC is part of Spinal Cord Version 3.0
"RTN","SPNJRPP2",9,0)
 ;
"RTN","SPNJRPP2",10,0)
 ; Parm values:
"RTN","SPNJRPP2",11,0)
 ;     RETURN  is the sorted data from the earliest date of listing
"RTN","SPNJRPP2",12,0)
 ;     ICNLST  is the list of patient ICNs to process
"RTN","SPNJRPP2",13,0)
 ;     FDATE   is the delivery starting date
"RTN","SPNJRPP2",14,0)
 ;     TDATE   is the delivery ending date
"RTN","SPNJRPP2",15,0)
 ;     ITEMS   is the list of CPT codes to search for
"RTN","SPNJRPP2",16,0)
 ;
"RTN","SPNJRPP2",17,0)
 ; Returns: ^TMP($J)
"RTN","SPNJRPP2",18,0)
 ;
"RTN","SPNJRPP2",19,0)
COL(RETURN,ICNLST,FDATE,TDATE,ITEMS) ;
"RTN","SPNJRPP2",20,0)
 ;
"RTN","SPNJRPP2",21,0)
 ;***************************
"RTN","SPNJRPP2",22,0)
 S RETURN=$NA(^TMP($J)),RETCNT=1
"RTN","SPNJRPP2",23,0)
 S X=FDATE S %DT="T" D ^%DT S SPNSTRT=Y
"RTN","SPNJRPP2",24,0)
 S X=TDATE S %DT="T" D ^%DT S SPNEND=Y_.2359
"RTN","SPNJRPP2",25,0)
 ;***************************
"RTN","SPNJRPP2",26,0)
 K ^TMP($J),^TMP("SPN",$J)
"RTN","SPNJRPP2",27,0)
 K ITMLST,ICHK
"RTN","SPNJRPP2",28,0)
 D ITMLST
"RTN","SPNJRPP2",29,0)
 F ICNNM=1:1:$L(ICNLST,"^") S ICN=$P(ICNLST,"^",ICNNM) D IN
"RTN","SPNJRPP2",30,0)
 D OUT,CLNUP
"RTN","SPNJRPP2",31,0)
 Q
"RTN","SPNJRPP2",32,0)
IN Q:$G(ICN)=""
"RTN","SPNJRPP2",33,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNJRPP2",34,0)
 Q:$G(DFN)=""
"RTN","SPNJRPP2",35,0)
 ;***************************
"RTN","SPNJRPP2",36,0)
 Q:'$D(^RMPR(660,"C",DFN))
"RTN","SPNJRPP2",37,0)
 ;JAS - 05/15/08 - DEFECT 1090
"RTN","SPNJRPP2",38,0)
 ;S PDA=""
"RTN","SPNJRPP2",39,0)
 S PDA=0
"RTN","SPNJRPP2",40,0)
 F  S PDA=$O(^RMPR(660,"C",DFN,PDA)) Q:PDA=""  D
"RTN","SPNJRPP2",41,0)
 . Q:'$D(^RMPR(660,PDA,0))
"RTN","SPNJRPP2",42,0)
 . S DEDAT=$P($G(^RMPR(660,PDA,0)),"^",12)
"RTN","SPNJRPP2",43,0)
 . Q:DEDAT=""
"RTN","SPNJRPP2",44,0)
 . Q:DEDAT<SPNSTRT!(DEDAT>SPNEND)
"RTN","SPNJRPP2",45,0)
 . S STAT=$P(^RMPR(660,PDA,0),"^",10)
"RTN","SPNJRPP2",46,0)
 . S STAT=$$GET1^DIQ(4,STAT_",",.01)
"RTN","SPNJRPP2",47,0)
 . S RMPRHCDT=$P(^RMPR(660,PDA,0),"^",1)
"RTN","SPNJRPP2",48,0)
 . Q:'$D(^RMPR(660,PDA,1))
"RTN","SPNJRPP2",49,0)
 . S RMPRHCPC=$P(^RMPR(660,PDA,1),"^",4)
"RTN","SPNJRPP2",50,0)
 . Q:RMPRHCPC=""
"RTN","SPNJRPP2",51,0)
 . D PSASHCPC^RMPOPF
"RTN","SPNJRPP2",52,0)
 . Q:RMPREHC=""
"RTN","SPNJRPP2",53,0)
 . S ITEM=RMPREHC
"RTN","SPNJRPP2",54,0)
 . S IDESC=RMPRTHC
"RTN","SPNJRPP2",55,0)
 . D DEM^VADPT
"RTN","SPNJRPP2",56,0)
 . S IQTY=$P(^RMPR(660,PDA,0),"^",7)
"RTN","SPNJRPP2",57,0)
 . S ITYP=$P(^RMPR(660,PDA,0),"^",4)
"RTN","SPNJRPP2",58,0)
 . S ITYP=$S(ITYP="I":"INITIAL ISSUE",ITYP="X":"REPAIR",ITYP="S":"SPARE",ITYP="R":"REPLACE",ITYP=5:"RENTAL",1:"")
"RTN","SPNJRPP2",59,0)
 . S ICOST=$P(^RMPR(660,PDA,0),"^",16)
"RTN","SPNJRPP2",60,0)
 . S IHCP=IDESC
"RTN","SPNJRPP2",61,0)
 . S DEDAT=$$FMTE^XLFDT(DEDAT,"5DZP")
"RTN","SPNJRPP2",62,0)
 . Q:'$D(ITMLST(ITEM))
"RTN","SPNJRPP2",63,0)
 . S ^TMP("SPN",$J,ITEM,IHCP,STAT,VADM(1),PDA)=VADM(1)_"^"_VA("PID")_"^"_ITEM_"^"_IDESC_"^"_IQTY_"^"_ICOST_"^"_ITYP_"^"_DEDAT
"RTN","SPNJRPP2",64,0)
 . Q
"RTN","SPNJRPP2",65,0)
 Q
"RTN","SPNJRPP2",66,0)
OUT ;
"RTN","SPNJRPP2",67,0)
 S ICHK="" F  S ICHK=$O(ITMLST(ICHK)) Q:ICHK=""  D
"RTN","SPNJRPP2",68,0)
 . Q:ICHK=""!('$D(^ICPT("B",ICHK)))
"RTN","SPNJRPP2",69,0)
 . Q:'$D(^TMP("SPN",$J,ICHK))
"RTN","SPNJRPP2",70,0)
 . S ^TMP("SPN",$J,ICHK)=""
"RTN","SPNJRPP2",71,0)
 . Q
"RTN","SPNJRPP2",72,0)
 S ITEM=""
"RTN","SPNJRPP2",73,0)
 F  S ITEM=$O(^TMP("SPN",$J,ITEM)) Q:ITEM=""  D
"RTN","SPNJRPP2",74,0)
 . I $D(^TMP("SPN",$J,ITEM))=1 D  Q
"RTN","SPNJRPP2",75,0)
 . . S ^TMP($J,RETCNT)="ITM999^"_ITEM_"^^EOL999"
"RTN","SPNJRPP2",76,0)
 . . S RETCNT=RETCNT+1
"RTN","SPNJRPP2",77,0)
 . . S ^TMP($J,RETCNT)="TOT999^0^0^EOL999"
"RTN","SPNJRPP2",78,0)
 . . S RETCNT=RETCNT+1
"RTN","SPNJRPP2",79,0)
 . S HCP=""
"RTN","SPNJRPP2",80,0)
 . F  S HCP=$O(^TMP("SPN",$J,ITEM,HCP)) Q:HCP=""  D
"RTN","SPNJRPP2",81,0)
 . . S ^TMP($J,RETCNT)="ITM999^"_ITEM_"^"_HCP_"^EOL999"
"RTN","SPNJRPP2",82,0)
 . . S RETCNT=RETCNT+1
"RTN","SPNJRPP2",83,0)
 . . S STAT="",PATCNT=0,TQTY=0,TCOST=0
"RTN","SPNJRPP2",84,0)
 . . F  S STAT=$O(^TMP("SPN",$J,ITEM,HCP,STAT)) Q:STAT=""  D
"RTN","SPNJRPP2",85,0)
 . . . S NAM=""
"RTN","SPNJRPP2",86,0)
 . . . F  S NAM=$O(^TMP("SPN",$J,ITEM,HCP,STAT,NAM)) Q:NAM=""  D
"RTN","SPNJRPP2",87,0)
 . . . . S PATCNT=PATCNT+1
"RTN","SPNJRPP2",88,0)
 . . . . S PDA=""
"RTN","SPNJRPP2",89,0)
 . . . . F  S PDA=$O(^TMP("SPN",$J,ITEM,HCP,STAT,NAM,PDA)) Q:PDA=""  D
"RTN","SPNJRPP2",90,0)
 . . . . . S PREC=^TMP("SPN",$J,ITEM,HCP,STAT,NAM,PDA)
"RTN","SPNJRPP2",91,0)
 . . . . . S SSN=$P(PREC,"^",2),IDESC=$P(PREC,"^",4),IQTY=$P(PREC,"^",5)
"RTN","SPNJRPP2",92,0)
 . . . . . S ICOST=$P(PREC,"^",6),ITYP=$P(PREC,"^",7),DEDAT=$P(PREC,"^",8)
"RTN","SPNJRPP2",93,0)
 . . . . . S TQTY=TQTY+IQTY,TCOST=TCOST+ICOST
"RTN","SPNJRPP2",94,0)
 . . . . . S ^TMP($J,RETCNT)=STAT_"^"_NAM_"^"_SSN_"^"_IQTY_"^"_ICOST_"^"_ITYP_"^"_DEDAT_"^EOL999"
"RTN","SPNJRPP2",95,0)
 . . . . . S RETCNT=RETCNT+1
"RTN","SPNJRPP2",96,0)
 . . S ^TMP($J,RETCNT)="TOT999^"_PATCNT_"^"_TCOST_"^EOL999"
"RTN","SPNJRPP2",97,0)
 . . S RETCNT=RETCNT+1
"RTN","SPNJRPP2",98,0)
 K ^TMP("SPN",$J)
"RTN","SPNJRPP2",99,0)
 Q
"RTN","SPNJRPP2",100,0)
ITMLST ;
"RTN","SPNJRPP2",101,0)
 S CNT="" F  S CNT=$O(ITEMS(CNT)) Q:CNT=""  D
"RTN","SPNJRPP2",102,0)
 . S ICHK=$P(ITEMS(CNT),"^",1)
"RTN","SPNJRPP2",103,0)
 . I $D(^ICPT("B",ICHK)) S ITMLST(ICHK)=""
"RTN","SPNJRPP2",104,0)
 Q
"RTN","SPNJRPP2",105,0)
CLNUP ;
"RTN","SPNJRPP2",106,0)
 K FDATE,TDATE,ICNLST,ICN,ITEMS,SPNSTRT,SPEND,ICNNM,DFN,PDA,DEDAT,STAT,ITDA,IREC0,IREC2,IQTY,ITEM,ITMLST,ITEM
"RTN","SPNJRPP2",107,0)
 K ITYP,ICOST,HCPREF,DEDAT,VADM,IHCP,STAT,IDESC,ICOST,ICHK,INUM,RETCNT,ITEM,HCP,STAT,NAM,PATCNT,TCOST
"RTN","SPNJRPP2",108,0)
 K %DT,CNT,IREF,PREC,SPNEND,SSN,TQTY,VA,X,Y,RMPRHCDT,RMPRHCPC,RMPREHC,RMPRTHC
"RTN","SPNJRPP2",109,0)
 Q
"RTN","SPNJRPPL")
0^24^B1212848
"RTN","SPNJRPPL",1,0)
SPNJRPPL ;BP/JAS - Returns list of CPT codes and short names ;JUL 28, 2008
"RTN","SPNJRPPL",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNJRPPL",3,0)
 ;
"RTN","SPNJRPPL",4,0)
 ; References to ^ICPT supported by IA# 2815
"RTN","SPNJRPPL",5,0)
 ; Reference to API CPT^ICPTCOD supported by IA# 1995
"RTN","SPNJRPPL",6,0)
 ;
"RTN","SPNJRPPL",7,0)
 ; Parm values:
"RTN","SPNJRPPL",8,0)
 ;     RETURN is the sorted data based on clinic stop name
"RTN","SPNJRPPL",9,0)
 ;
"RTN","SPNJRPPL",10,0)
 ; Returns: ^TMP($J)
"RTN","SPNJRPPL",11,0)
 ;
"RTN","SPNJRPPL",12,0)
COL(RETURN) ;
"RTN","SPNJRPPL",13,0)
 ;***************************
"RTN","SPNJRPPL",14,0)
 S RETURN=$NA(^TMP($J)),RETCNT=1
"RTN","SPNJRPPL",15,0)
 K ^TMP($J)
"RTN","SPNJRPPL",16,0)
 ;JAS - 05/15/08 - DEFECT 1090
"RTN","SPNJRPPL",17,0)
 ;S CODE=""
"RTN","SPNJRPPL",18,0)
 S CODE=0
"RTN","SPNJRPPL",19,0)
 F  S CODE=$O(^ICPT("B",CODE)) Q:CODE=""  D
"RTN","SPNJRPPL",20,0)
 . S CSTRING=$$CPT^ICPTCOD(CODE,"","")
"RTN","SPNJRPPL",21,0)
 . Q:+CSTRING=-1
"RTN","SPNJRPPL",22,0)
 . ; Next two lines added for defect SCI1020
"RTN","SPNJRPPL",23,0)
 . S IDATE=$P(CSTRING,"^",8)
"RTN","SPNJRPPL",24,0)
 . I IDATE'="",IDATE?7N,IDATE'>DT Q
"RTN","SPNJRPPL",25,0)
 . S CPT=$P(CSTRING,"^",2)
"RTN","SPNJRPPL",26,0)
 . S CNAME=$P(CSTRING,"^",3)
"RTN","SPNJRPPL",27,0)
 . S CNAME=$$UP^XLFSTR(CNAME)
"RTN","SPNJRPPL",28,0)
 . S ^TMP($J,CNAME,RETCNT)=CPT_"^"_CNAME_"^EOL999"
"RTN","SPNJRPPL",29,0)
 . S RETCNT=RETCNT+1
"RTN","SPNJRPPL",30,0)
 K RETCNT,CODE,CSTRING,CPT,CNAME,IDATE
"RTN","SPNJRPPL",31,0)
 Q
"RTN","SPNJRPPM")
0^103^B12765608
"RTN","SPNJRPPM",1,0)
SPNJRPPM ;BP/JAS - Returns ADT Patient movement entries for requested date ;JUL 28, 2008
"RTN","SPNJRPPM",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNJRPPM",3,0)
 ;
"RTN","SPNJRPPM",4,0)
 ; Reference to ^DGPM("B" supported by IA# 92
"RTN","SPNJRPPM",5,0)
 ; References to ^DGPM(D0,0 supported by IA# 4942
"RTN","SPNJRPPM",6,0)
 ; Reference to ^DG(405.3 supported by IA# 433
"RTN","SPNJRPPM",7,0)
 ; Reference to file 4 supported by IA# 10090
"RTN","SPNJRPPM",8,0)
 ; Reference to ^DIC(42 supported by IA# 10039
"RTN","SPNJRPPM",9,0)
 ; Reference to ^DG(405.4 supported by IA# 1380
"RTN","SPNJRPPM",10,0)
 ; Reference to file 200 supported by IA# 10060
"RTN","SPNJRPPM",11,0)
 ; Reference to file 45.7 supported by IA# 1154
"RTN","SPNJRPPM",12,0)
 ; Reference to ^DPT(D0,"MPI" supported by IA# 4938
"RTN","SPNJRPPM",13,0)
 ; API $$FLIP^SPNRPCIC is part of Spinal Cord Version 3.0
"RTN","SPNJRPPM",14,0)
 ; API COL^SPNJRPCS is part of Spinal Cord Version 3.0
"RTN","SPNJRPPM",15,0)
 ;
"RTN","SPNJRPPM",16,0)
 ; Parm values:
"RTN","SPNJRPPM",17,0)
 ;     ICNLST is the list of patient ICNs to process
"RTN","SPNJRPPM",18,0)
 ;     ACTDATE: is the beginning date of patient movement activity 
"RTN","SPNJRPPM",19,0)
 ;     RETURN: is the sorted data from the earliest date of listing
"RTN","SPNJRPPM",20,0)
 ;
"RTN","SPNJRPPM",21,0)
 ; ^TMP($J) returns:
"RTN","SPNJRPPM",22,0)
 ;     ICN ^ DATESTAMP ^ TRANSACTION ^ TRANSFER FACILITY ^ WARD LOCATION ^ ROOM-BED ^ 
"RTN","SPNJRPPM",23,0)
 ;     ATTENDING PHYSICIAN ^ TREATING SPECIALTY ^ PRIMARY PHYSICIAN ^ SCI STATUS ^ 
"RTN","SPNJRPPM",24,0)
 ;     ORIGINAL ADMISSION DATE ^ EOL999
"RTN","SPNJRPPM",25,0)
 ;
"RTN","SPNJRPPM",26,0)
COL(RETURN,ICNLST,ACTDATE) ;
"RTN","SPNJRPPM",27,0)
 ;***************************
"RTN","SPNJRPPM",28,0)
 S RETURN=$NA(^TMP($J))
"RTN","SPNJRPPM",29,0)
 S RETCNT=1
"RTN","SPNJRPPM",30,0)
 S X=ACTDATE S %DT="T" D ^%DT S ACTDATE=Y
"RTN","SPNJRPPM",31,0)
 ;***************************
"RTN","SPNJRPPM",32,0)
 K ^TMP($J),^TMP("SPN",$J)
"RTN","SPNJRPPM",33,0)
 F ICNNM=1:1:$L(ICNLST,"^") S ICN=$P(ICNLST,"^",ICNNM) D
"RTN","SPNJRPPM",34,0)
 . Q:$G(ICN)=""
"RTN","SPNJRPPM",35,0)
 . S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNJRPPM",36,0)
 . Q:$G(DFN)=""
"RTN","SPNJRPPM",37,0)
 . S DFNLST(DFN)=ICN
"RTN","SPNJRPPM",38,0)
 ;***************************
"RTN","SPNJRPPM",39,0)
 S DA=ACTDATE-.00000001
"RTN","SPNJRPPM",40,0)
 F  S DA=$O(^DGPM("B",DA)) Q:DA=""!($P(DA,".",1)>DT)  D
"RTN","SPNJRPPM",41,0)
 . Q:$P(DA,".",1)<ACTDATE
"RTN","SPNJRPPM",42,0)
 . ;JAS - 05/15/08 - DEFECT 1090
"RTN","SPNJRPPM",43,0)
 . ;S IEN=""
"RTN","SPNJRPPM",44,0)
 . S IEN=0
"RTN","SPNJRPPM",45,0)
 . F  S IEN=$O(^DGPM("B",DA,IEN)) Q:IEN=""  D
"RTN","SPNJRPPM",46,0)
 . . Q:'$D(^DGPM(IEN,0))
"RTN","SPNJRPPM",47,0)
 . . S PMDATA=^DGPM(IEN,0)
"RTN","SPNJRPPM",48,0)
 . . S DFN=$P(PMDATA,"^",3)
"RTN","SPNJRPPM",49,0)
 . . Q:DFN=""
"RTN","SPNJRPPM",50,0)
 . . Q:'$D(DFNLST(DFN))
"RTN","SPNJRPPM",51,0)
 . . K TRANS,FAC,WRD,RB,PP,TS,AP,ORSTMP
"RTN","SPNJRPPM",52,0)
 . . S ICN=$P(^DPT(DFN,"MPI"),"^",1)
"RTN","SPNJRPPM",53,0)
 . . S MSTMP=$P(PMDATA,"^",1) I MSTMP'="" D
"RTN","SPNJRPPM",54,0)
 . . . S Y=MSTMP X ^DD("DD") S STMP=Y
"RTN","SPNJRPPM",55,0)
 . . S MASDA=$P(PMDATA,"^",2) I MASDA'="" D
"RTN","SPNJRPPM",56,0)
 . . . S TRANS=$P($G(^DG(405.3,MASDA,0)),"^",1)
"RTN","SPNJRPPM",57,0)
 . . I TRANS'="ADMISSION"&(TRANS'["TRANSFER")&(TRANS'="DISCHARGE") Q
"RTN","SPNJRPPM",58,0)
 . . S FACDA=$P(PMDATA,"^",5) I FACDA'="" D
"RTN","SPNJRPPM",59,0)
 . . . S FAC=$$GET1^DIQ(4,FACDA_",",.01)
"RTN","SPNJRPPM",60,0)
 . . S WRDDA=$P(PMDATA,"^",6) I WRDDA'="" D
"RTN","SPNJRPPM",61,0)
 . . . S WRD=$P(^DIC(42,WRDDA,0),"^",1)
"RTN","SPNJRPPM",62,0)
 . . S RBDA=$P(PMDATA,"^",7) I RBDA'="" D
"RTN","SPNJRPPM",63,0)
 . . . S RB=$P(^DG(405.4,RBDA,0),"^",1)
"RTN","SPNJRPPM",64,0)
 . . S PPDA=$P(PMDATA,"^",8) I PPDA'="" D
"RTN","SPNJRPPM",65,0)
 . . . S PP=$$GET1^DIQ(200,PPDA_",",.01)
"RTN","SPNJRPPM",66,0)
 . . S TSDA=$P(PMDATA,"^",9) I TSDA'="" D
"RTN","SPNJRPPM",67,0)
 . . . S TS=$$GET1^DIQ(45.7,TSDA_",",.01)
"RTN","SPNJRPPM",68,0)
 . . S APDA=$P(PMDATA,"^",19) I APDA'="" D
"RTN","SPNJRPPM",69,0)
 . . . ;JAS 07/15/08 IA Changes needed during SQA checklist
"RTN","SPNJRPPM",70,0)
 . . . ;S AP=$P(^VA(200,APDA,0),"^",1)
"RTN","SPNJRPPM",71,0)
 . . . S AP=$$GET1^DIQ(200,APDA_",",.01)
"RTN","SPNJRPPM",72,0)
 . . D COL^SPNJRPCS(.STATUS,ICN)
"RTN","SPNJRPPM",73,0)
 . . S VAS=$P($G(STATUS($J)),"^",1)
"RTN","SPNJRPPM",74,0)
 . . I TRANS="DISCHARGE" D
"RTN","SPNJRPPM",75,0)
 . . . S OREC=$P(PMDATA,"^",14)
"RTN","SPNJRPPM",76,0)
 . . . I OREC'="" S ODAT=$P($G(^DGPM(OREC,0)),"^",1)
"RTN","SPNJRPPM",77,0)
 . . . S Y=ODAT X ^DD("DD") S ORSTMP=Y
"RTN","SPNJRPPM",78,0)
 . . I TRANS="SPECIALTY TRANSFER" D  Q
"RTN","SPNJRPPM",79,0)
 . . . S PAR=$P(PMDATA,"^",24)
"RTN","SPNJRPPM",80,0)
 . . . Q:PAR=""
"RTN","SPNJRPPM",81,0)
 . . . I $D(^TMP("SPN",$J,PAR)) D
"RTN","SPNJRPPM",82,0)
 . . . . S $P(^TMP("SPN",$J,PAR),"^",7)=$G(PP)
"RTN","SPNJRPPM",83,0)
 . . . . S $P(^TMP("SPN",$J,PAR),"^",8)=$G(TS)
"RTN","SPNJRPPM",84,0)
 . . . . S $P(^TMP("SPN",$J,PAR),"^",9)=$G(AP)
"RTN","SPNJRPPM",85,0)
 . . S ^TMP("SPN",$J,IEN)=ICN_"^"_$G(STMP)_"^"_$G(TRANS)_"^"_$G(FAC)_"^"_$G(WRD)_"^"_$G(RB)_"^"_$G(PP)_"^"_$G(TS)_"^"_$G(AP)_"^"_$G(VAS)_"^"_$G(ORSTMP)_"^EOL999"
"RTN","SPNJRPPM",86,0)
 S CNT=""
"RTN","SPNJRPPM",87,0)
 F  S CNT=$O(^TMP("SPN",$J,CNT)) Q:CNT=""  D
"RTN","SPNJRPPM",88,0)
 . S ^TMP($J,RETCNT)=^TMP("SPN",$J,CNT)
"RTN","SPNJRPPM",89,0)
 . S RETCNT=RETCNT+1
"RTN","SPNJRPPM",90,0)
 D CLNUP
"RTN","SPNJRPPM",91,0)
 Q
"RTN","SPNJRPPM",92,0)
CLNUP ;
"RTN","SPNJRPPM",93,0)
 K %DT,AICN,APDA,CNT,DA,DFN,DFNLIST,DFNLST,FACDA,ICN,ICNNM
"RTN","SPNJRPPM",94,0)
 K IEN,MASDA,MSTMP,ODAT,OREC,PAR,PATLIST,PMDATA,PPDA,RBDA
"RTN","SPNJRPPM",95,0)
 K RETCNT,SPN,STATUS,STMP,TSDA,VAS,WRDDA,X,Y
"RTN","SPNJRPPM",96,0)
 Q
"RTN","SPNJRPPN")
0^25^B1907848
"RTN","SPNJRPPN",1,0)
SPNJRPPN ;BP/JAS - RPC to record SCI Progress Notes ;FEB 05, 2007
"RTN","SPNJRPPN",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNJRPPN",3,0)
 ;
"RTN","SPNJRPPN",4,0)
 ; Reference to API DUZ^XUP supported by IA# 4409
"RTN","SPNJRPPN",5,0)
 ; Reference to API MAKE^TIUSRVP supported by IA# 3535
"RTN","SPNJRPPN",6,0)
 ; Reference to API $$ENCRYP^XUSRB1 supported by IA# 2240
"RTN","SPNJRPPN",7,0)
 ; Reference to API SIGN^TIUSRVP supported by IA# 3535
"RTN","SPNJRPPN",8,0)
 ; API VALIDATE^SPNRPC6 is part of Spinal Cord Version 3.0
"RTN","SPNJRPPN",9,0)
 ;
"RTN","SPNJRPPN",10,0)
COL(SUCCESS,DFN,TITLE,VDT,VLOC,VSIT,TIUX,VSTR,SUPPRESS,NOASF,DUZ,SPNSIG) ;
"RTN","SPNJRPPN",11,0)
 ; 
"RTN","SPNJRPPN",12,0)
 ; SUCCESS = (by ref) TIU DOCUMENT # (PTR to 8925)
"RTN","SPNJRPPN",13,0)
 ;         = 0^Explanatory message if no SUCCESS
"RTN","SPNJRPPN",14,0)
 ; DFN     = Patient (#2)
"RTN","SPNJRPPN",15,0)
 ; TITLE   = TIU Document Definition (#8925.1)
"RTN","SPNJRPPN",16,0)
 ; [VDT]   = Date(/Time) of Visit
"RTN","SPNJRPPN",17,0)
 ; [VLOC]  = Visit Location (HOSPITAL LOCATION)
"RTN","SPNJRPPN",18,0)
 ; [VSIT]  = Visit file ien (#9000010)
"RTN","SPNJRPPN",19,0)
 ; [VSTR]  = Visit string (i.e., VLOC;VDT;VTYPE)
"RTN","SPNJRPPN",20,0)
 ; [NOASF] = if 1=Do Not Set ASAVE cross-reference
"RTN","SPNJRPPN",21,0)
 ; [SUPPRESS]
"RTN","SPNJRPPN",22,0)
 ;         = Indicates whether or not to suppress execution of COMMIT ACTION
"RTN","SPNJRPPN",23,0)
 ; TIUX    = (by ref) array containing field data and document body
"RTN","SPNJRPPN",24,0)
 ; DUZ     = New Person (#200)
"RTN","SPNJRPPN",25,0)
 ; SPNSIG    = Electronic Signature Code
"RTN","SPNJRPPN",26,0)
 ;
"RTN","SPNJRPPN",27,0)
 S (VDT,VLOC,VSIT,SUPPRESS,NOASF)=""
"RTN","SPNJRPPN",28,0)
 D VALIDATE^SPNRPC6(.RESULTS,DUZ,SPNSIG)
"RTN","SPNJRPPN",29,0)
 I '+RESULTS S SUCCESS="NOT A VALID SIGNATURE" Q
"RTN","SPNJRPPN",30,0)
 I '$D(DUZ(0))!('$D(DUZ(2))) D DUZ^XUP(DUZ)
"RTN","SPNJRPPN",31,0)
 D MAKE^TIUSRVP(.DOC,DFN,TITLE,VDT,VLOC,VSIT,.TIUX,VSTR,SUPPRESS,NOASF)
"RTN","SPNJRPPN",32,0)
 K TIUX
"RTN","SPNJRPPN",33,0)
 I '+DOC S SUCCESS="DOCUMENT NOT CREATED" Q
"RTN","SPNJRPPN",34,0)
 S TIUDA=DOC
"RTN","SPNJRPPN",35,0)
 S TIUX=$$ENCRYP^XUSRB1(SPNSIG)
"RTN","SPNJRPPN",36,0)
 D SIGN^TIUSRVP(.SUCCESS,TIUDA,TIUX)
"RTN","SPNJRPPN",37,0)
 I SUCCESS'=0 S SUCCESS="MUST SIGN NOTE IN CPRS" Q
"RTN","SPNJRPPN",38,0)
 S SUCCESS=1
"RTN","SPNJRPPN",39,0)
 K DOC,RESULTS,TIUDA
"RTN","SPNJRPPN",40,0)
 Q
"RTN","SPNJRPPR")
0^91^B3055124
"RTN","SPNJRPPR",1,0)
SPNJRPPR ;BP/JAS - Returns list of ICNs who match Prosthetics criteria ;JUL 28, 2008
"RTN","SPNJRPPR",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNJRPPR",3,0)
 ;
"RTN","SPNJRPPR",4,0)
 ; Reference to ^DPT(D0,"MPI" supported by IA# 4938
"RTN","SPNJRPPR",5,0)
 ; References to ^RMPR(660 supported by IA# 4975
"RTN","SPNJRPPR",6,0)
 ; Reference to ^ICPT("B" supported by IA# 2815
"RTN","SPNJRPPR",7,0)
 ; Reference to API PSASHCPC^RMPOPF supported by IA# 4975
"RTN","SPNJRPPR",8,0)
 ;
"RTN","SPNJRPPR",9,0)
 ; Parm values:
"RTN","SPNJRPPR",10,0)
 ;     DESC is the description of the Prosthetics device.
"RTN","SPNJRPPR",11,0)
 ;     ^TMP($J) is the return value with list of ICNs
"RTN","SPNJRPPR",12,0)
 ;
"RTN","SPNJRPPR",13,0)
 ; Returns: ^TMP($J)
"RTN","SPNJRPPR",14,0)
 ;
"RTN","SPNJRPPR",15,0)
COL(RETURN,DESC) ;
"RTN","SPNJRPPR",16,0)
 ;***************************
"RTN","SPNJRPPR",17,0)
 S RETURN=$NA(^TMP($J)),RETCNT=1
"RTN","SPNJRPPR",18,0)
 K ^TMP($J),^TMP("SPN",$J),DELIST
"RTN","SPNJRPPR",19,0)
 I $D(DESC) D DELOAD
"RTN","SPNJRPPR",20,0)
 ;JAS - 05/15/08 - DEFECT 1090
"RTN","SPNJRPPR",21,0)
 ;S DFN=""
"RTN","SPNJRPPR",22,0)
 S DFN=0
"RTN","SPNJRPPR",23,0)
 F  S DFN=$O(^RMPR(660,"C",DFN)) Q:DFN=""  D IN
"RTN","SPNJRPPR",24,0)
 D OUT,CLNUP
"RTN","SPNJRPPR",25,0)
 Q
"RTN","SPNJRPPR",26,0)
IN ;
"RTN","SPNJRPPR",27,0)
 S ICN=$P($G(^DPT(DFN,"MPI")),"^",1)
"RTN","SPNJRPPR",28,0)
 Q:ICN=""
"RTN","SPNJRPPR",29,0)
 ;JAS - 05/15/08 - DEFECT 1090
"RTN","SPNJRPPR",30,0)
 ;S PDA="",FND=0
"RTN","SPNJRPPR",31,0)
 S PDA=0,FND=0
"RTN","SPNJRPPR",32,0)
 F  S PDA=$O(^RMPR(660,"C",DFN,PDA)) Q:PDA=""!(FND)  D
"RTN","SPNJRPPR",33,0)
 . Q:'$D(^RMPR(660,PDA,0))
"RTN","SPNJRPPR",34,0)
 . I $D(DESC) D DESC
"RTN","SPNJRPPR",35,0)
 Q
"RTN","SPNJRPPR",36,0)
DESC ;
"RTN","SPNJRPPR",37,0)
 S RMPRHCDT=$P(^RMPR(660,PDA,0),"^",1)
"RTN","SPNJRPPR",38,0)
 Q:'$D(^RMPR(660,PDA,1))
"RTN","SPNJRPPR",39,0)
 S RMPRHCPC=$P(^RMPR(660,PDA,1),"^",4)
"RTN","SPNJRPPR",40,0)
 D PSASHCPC^RMPOPF
"RTN","SPNJRPPR",41,0)
 Q:RMPREHC=""
"RTN","SPNJRPPR",42,0)
 I $D(DELIST(RMPREHC)) D
"RTN","SPNJRPPR",43,0)
 . S ^TMP("SPN",$J,ICN)=""
"RTN","SPNJRPPR",44,0)
 . S FND=1
"RTN","SPNJRPPR",45,0)
 Q
"RTN","SPNJRPPR",46,0)
OUT ;
"RTN","SPNJRPPR",47,0)
 S ICN=""
"RTN","SPNJRPPR",48,0)
 F  S ICN=$O(^TMP("SPN",$J,ICN)) Q:ICN=""  D
"RTN","SPNJRPPR",49,0)
 . S ^TMP($J,RETCNT)=ICN_"^EOL999"
"RTN","SPNJRPPR",50,0)
 . S RETCNT=RETCNT+1
"RTN","SPNJRPPR",51,0)
 Q
"RTN","SPNJRPPR",52,0)
DELOAD ;
"RTN","SPNJRPPR",53,0)
 S DDA="" F  S DDA=$O(DESC(DDA)) Q:DDA=""  D
"RTN","SPNJRPPR",54,0)
 . S DEX=$P(DESC(DDA),"^",1)
"RTN","SPNJRPPR",55,0)
 . I $D(^ICPT("B",DEX)) S DELIST(DEX)=""
"RTN","SPNJRPPR",56,0)
 Q
"RTN","SPNJRPPR",57,0)
CLNUP ;
"RTN","SPNJRPPR",58,0)
 K DA,DDA,DEX,DFN,FND,ICN,IREC0,IREF,IREF2,ITDA,ITEM
"RTN","SPNJRPPR",59,0)
 K PDA,PRCDA,PROLIST,RETCNT,RMPRHCDT,RMPRHCPC,RMPREHC
"RTN","SPNJRPPR",60,0)
 Q
"RTN","SPNJRPRC")
0^26^B3460486
"RTN","SPNJRPRC",1,0)
SPNJRPRC ;BP/JAS - Returns VA Race info ;Dec 15, 2006
"RTN","SPNJRPRC",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNJRPRC",3,0)
 ;
"RTN","SPNJRPRC",4,0)
 ; Reference to API DEM^VADPT & KVAR^VADPT supported by IA #10061
"RTN","SPNJRPRC",5,0)
 ; API $$FLIP^SPNRPCIC is part of Spinal Cord Version 3.0
"RTN","SPNJRPRC",6,0)
 ;
"RTN","SPNJRPRC",7,0)
 ; Parm values:
"RTN","SPNJRPRC",8,0)
 ;     RETURN is the race type for a given ICN
"RTN","SPNJRPRC",9,0)
 ;
"RTN","SPNJRPRC",10,0)
 ; Returns: RETURN($J)
"RTN","SPNJRPRC",11,0)
 ;
"RTN","SPNJRPRC",12,0)
COL(RETURN,ICN) ;
"RTN","SPNJRPRC",13,0)
 ;***************************
"RTN","SPNJRPRC",14,0)
 K ^TMP($J)
"RTN","SPNJRPRC",15,0)
 S RETURN=$NA(^TMP($J)),RETCNT=1
"RTN","SPNJRPRC",16,0)
 Q:$G(ICN)=""
"RTN","SPNJRPRC",17,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNJRPRC",18,0)
 Q:$G(DFN)=""
"RTN","SPNJRPRC",19,0)
 ;***************************
"RTN","SPNJRPRC",20,0)
 D DEM^VADPT
"RTN","SPNJRPRC",21,0)
 S RCNT=VADM(12) Q:RCNT=0
"RTN","SPNJRPRC",22,0)
 F I=1:1:RCNT D
"RTN","SPNJRPRC",23,0)
 . S RACE=$P(VADM(12,I),"^",2)
"RTN","SPNJRPRC",24,0)
 . D RACE
"RTN","SPNJRPRC",25,0)
 . S ^TMP($J,RETCNT)=RACE_"^EOL999"
"RTN","SPNJRPRC",26,0)
 . S RETCNT=RETCNT+1
"RTN","SPNJRPRC",27,0)
 D KVAR^VADPT
"RTN","SPNJRPRC",28,0)
 K DFN,RACE,RCNT,RDA,RETCNT
"RTN","SPNJRPRC",29,0)
 K I,VADM  ;WDE
"RTN","SPNJRPRC",30,0)
 Q
"RTN","SPNJRPRC",31,0)
RACE ;
"RTN","SPNJRPRC",32,0)
 I RACE["BLACK" S RACE="BLACK OR AFRICAN AMERICAN" Q
"RTN","SPNJRPRC",33,0)
 I RACE["AFRICAN" S RACE="BLACK OR AFRICAN AMERICAN" Q
"RTN","SPNJRPRC",34,0)
 I RACE["AFROAMERICAN" S RACE="BLACK OR AFRICAN AMERICAN" Q
"RTN","SPNJRPRC",35,0)
 I RACE["NEGRO" S RACE="BLACK OR AFRICAN AMERICAN" Q
"RTN","SPNJRPRC",36,0)
 I RACE["ALASKA" S RACE="AMERICAN INDIAN OR ALASKA NATIVE" Q
"RTN","SPNJRPRC",37,0)
 I RACE["INDIAN" S RACE="AMERICAN INDIAN OR ALASKA NATIVE" Q
"RTN","SPNJRPRC",38,0)
 I RACE["HISPANIC" S RACE="WHITE" Q
"RTN","SPNJRPRC",39,0)
 I RACE["MEXICAN" S RACE="WHITE" Q
"RTN","SPNJRPRC",40,0)
 I RACE["CAUCASIAN" S RACE="WHITE" Q
"RTN","SPNJRPRC",41,0)
 I RACE["WHITE" S RACE="WHITE" Q
"RTN","SPNJRPRC",42,0)
 I RACE["ASIAN" S RACE="ASIAN" Q
"RTN","SPNJRPRC",43,0)
 I RACE["HAWAIIAN" S RACE="NATIVE HAWAIIAN OR OTHER PACIFIC ISLANDER" Q
"RTN","SPNJRPRC",44,0)
 I RACE["PACIFIC" S RACE="NATIVE HAWAIIAN OR OTHER PACIFIC ISLANDER" Q
"RTN","SPNJRPRC",45,0)
 S RACE="UNKNOWN"
"RTN","SPNJRPRC",46,0)
 Q
"RTN","SPNJRPRE")
0^27^B5915306
"RTN","SPNJRPRE",1,0)
SPNJRPRE ;BP/JAS - RPC READMISSIONS REPORT BY DATE RANGE ;FEB 05, 2007
"RTN","SPNJRPRE",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNJRPRE",3,0)
 ;
"RTN","SPNJRPRE",4,0)
 ; Reference to file #4 supported by IA# 10090
"RTN","SPNJRPRE",5,0)
 ; Reference to ^DGPM("APRD" supported by IA# 4942
"RTN","SPNJRPRE",6,0)
 ; Reference to API $$KSP^XUPARAM supported by IA# 2541
"RTN","SPNJRPRE",7,0)
 ; Reference to API DEM^VADPT supported by IA# 10061
"RTN","SPNJRPRE",8,0)
 ; Reference to API IN5^VADPT supported by IA# 10061
"RTN","SPNJRPRE",9,0)
 ; API $$FLIP^SPNRPCIC is part of Spinal Cord Version 3.0
"RTN","SPNJRPRE",10,0)
 ;
"RTN","SPNJRPRE",11,0)
 ; Parm values:
"RTN","SPNJRPRE",12,0)
 ;     RETURN  is the sorted data from the earliest date of listing
"RTN","SPNJRPRE",13,0)
 ;     ICNLST  is the list of patient ICNs to process
"RTN","SPNJRPRE",14,0)
 ;     FDATE   is the delivery starting date
"RTN","SPNJRPRE",15,0)
 ;     TDATE   is the delivery ending date
"RTN","SPNJRPRE",16,0)
 ;
"RTN","SPNJRPRE",17,0)
 ; Returns: ^TMP($J)
"RTN","SPNJRPRE",18,0)
 ;
"RTN","SPNJRPRE",19,0)
COL(RETURN,ICNLST,FDATE,TDATE) ;
"RTN","SPNJRPRE",20,0)
 ;
"RTN","SPNJRPRE",21,0)
 ;***************************
"RTN","SPNJRPRE",22,0)
 S RETURN=$NA(^TMP($J)),RETCNT=1
"RTN","SPNJRPRE",23,0)
 S X=FDATE S %DT="T" D ^%DT S SPNDATE=Y
"RTN","SPNJRPRE",24,0)
 S X=TDATE S %DT="T" D ^%DT S SPNEDAT=Y_.2359
"RTN","SPNJRPRE",25,0)
 ;***************************
"RTN","SPNJRPRE",26,0)
 K ^TMP($J),^TMP("SPN",$J)
"RTN","SPNJRPRE",27,0)
 S LOCDA=$$KSP^XUPARAM("INST")
"RTN","SPNJRPRE",28,0)
 S LOC=$$GET1^DIQ(4,LOCDA_",",.01)
"RTN","SPNJRPRE",29,0)
 F ICNNM=1:1:$L(ICNLST,"^") S ICN=$P(ICNLST,"^",ICNNM) D IN
"RTN","SPNJRPRE",30,0)
 D OUT,CLNUP
"RTN","SPNJRPRE",31,0)
 Q
"RTN","SPNJRPRE",32,0)
IN Q:$G(ICN)=""
"RTN","SPNJRPRE",33,0)
 S SPNDFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNJRPRE",34,0)
 Q:$G(DFN)=""
"RTN","SPNJRPRE",35,0)
 ;***************************
"RTN","SPNJRPRE",36,0)
 S SPNQDAT=SPNDATE-.000001
"RTN","SPNJRPRE",37,0)
 S SDA=SPNDFN
"RTN","SPNJRPRE",38,0)
 Q:'$D(^DGPM("APRD",SDA))
"RTN","SPNJRPRE",39,0)
 F  S SPNQDAT=$O(^DGPM("APRD",SDA,SPNQDAT)) Q:(SPNQDAT<1)  Q:(SPNQDAT>(SPNEDAT+30))  D
"RTN","SPNJRPRE",40,0)
 . S SPNIEN=0 F  S SPNIEN=$O(^DGPM("APRD",SDA,SPNQDAT,SPNIEN)) Q:SPNIEN<1  D
"RTN","SPNJRPRE",41,0)
 . . N DFN,SPNLINE,SPNLOS
"RTN","SPNJRPRE",42,0)
 . . S DFN=SPNDFN,VAIP("E")=SPNIEN D IN5^VADPT
"RTN","SPNJRPRE",43,0)
 . . Q:VAIP(2)'["ADMISSION"&(VAIP(2)'["DISCHARGE")
"RTN","SPNJRPRE",44,0)
 . . S TRANS=$P(VAIP(2),"^",2),WARD=$P(VAIP(5),"^",2)
"RTN","SPNJRPRE",45,0)
 . . S MDAT=$P(VAIP(3),"^",1),TDAT=$P(VAIP(3),"^",2)
"RTN","SPNJRPRE",46,0)
 . . I TRANS="DISCHARGE",SPNQDAT>SPNEDAT Q
"RTN","SPNJRPRE",47,0)
 . . S SPNLINE=ICN_U_TRANS_U_LOC_U_LOCDA_U_WARD_U_TDAT
"RTN","SPNJRPRE",48,0)
 . . S ^TMP("SPN",$J,ICN,MDAT,SPNIEN)=SPNLINE
"RTN","SPNJRPRE",49,0)
 . . D KVAR^VADPT
"RTN","SPNJRPRE",50,0)
 Q
"RTN","SPNJRPRE",51,0)
OUT ;
"RTN","SPNJRPRE",52,0)
 S ICN=""
"RTN","SPNJRPRE",53,0)
 F  S ICN=$O(^TMP("SPN",$J,ICN)) Q:ICN=""  D
"RTN","SPNJRPRE",54,0)
 . S MDAT=""
"RTN","SPNJRPRE",55,0)
 . F  S MDAT=$O(^TMP("SPN",$J,ICN,MDAT)) Q:MDAT=""  D
"RTN","SPNJRPRE",56,0)
 . . S SPNIEN=""
"RTN","SPNJRPRE",57,0)
 . . F  S SPNIEN=$O(^TMP("SPN",$J,ICN,MDAT,SPNIEN)) Q:SPNIEN=""  D
"RTN","SPNJRPRE",58,0)
 . . . S ^TMP($J,RETCNT)=^TMP("SPN",$J,ICN,MDAT,SPNIEN)_U_"EOL999"
"RTN","SPNJRPRE",59,0)
 . . . S RETCNT=RETCNT+1
"RTN","SPNJRPRE",60,0)
 Q
"RTN","SPNJRPRE",61,0)
CLNUP ;
"RTN","SPNJRPRE",62,0)
 K %DT,ICN,ICNNM,LOC,LOCDA,MDAT,RETCNT,SDA,SPNDATE,SPNDFN
"RTN","SPNJRPRE",63,0)
 K SPNEDAT,SPNIEN,SPNQDAT,TDAT,TRANS,VAIP,WARD,X,Y
"RTN","SPNJRPRE",64,0)
 Q
"RTN","SPNJRPSC")
0^28^B1441105
"RTN","SPNJRPSC",1,0)
SPNJRPSC ;BP/JAS - Returns list of ICNs who match Service Connection criteria ;JUL 28, 2008
"RTN","SPNJRPSC",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNJRPSC",3,0)
 ;
"RTN","SPNJRPSC",4,0)
 ; Reference to ^DTP(D0,"MPI" supported by IA# 4938
"RTN","SPNJRPSC",5,0)
 ; Reference to API ELIG^VADPT supported by IA# 10061
"RTN","SPNJRPSC",6,0)
 ;
"RTN","SPNJRPSC",7,0)
 ; Parm values:
"RTN","SPNJRPSC",8,0)
 ;     BPER is the beginning or low range percentage of Service Connection
"RTN","SPNJRPSC",9,0)
 ;     EPER is the ending or high range percentage of Service Connection
"RTN","SPNJRPSC",10,0)
 ;     ^TMP($J) is the return value with list of ICNs
"RTN","SPNJRPSC",11,0)
 ;
"RTN","SPNJRPSC",12,0)
 ; Returns: ^TMP($J)
"RTN","SPNJRPSC",13,0)
 ;
"RTN","SPNJRPSC",14,0)
COL(RETURN,BPER,EPER) ;
"RTN","SPNJRPSC",15,0)
 ;***************************
"RTN","SPNJRPSC",16,0)
 S RETURN=$NA(^TMP($J)),RETCNT=1
"RTN","SPNJRPSC",17,0)
 K ^TMP($J),^TMP("SPN",$J)
"RTN","SPNJRPSC",18,0)
 ;JAS - 05/15/08 - DEFECT 1090
"RTN","SPNJRPSC",19,0)
 ;S DFN=""
"RTN","SPNJRPSC",20,0)
 S DFN=0
"RTN","SPNJRPSC",21,0)
 F  S DFN=$O(^DPT(DFN)) Q:DFN=""!(DFN'?1N.N)  D IN
"RTN","SPNJRPSC",22,0)
 D OUT
"RTN","SPNJRPSC",23,0)
 K DFN,ICN,RETCNT,SPER,VAEL
"RTN","SPNJRPSC",24,0)
 Q
"RTN","SPNJRPSC",25,0)
IN ;
"RTN","SPNJRPSC",26,0)
 D ELIG^VADPT
"RTN","SPNJRPSC",27,0)
 I $D(VAEL(3)),$P(VAEL(3),"^",1)=1 D
"RTN","SPNJRPSC",28,0)
 . S SPER=$P(VAEL(3),"^",2)
"RTN","SPNJRPSC",29,0)
 . Q:SPER=""
"RTN","SPNJRPSC",30,0)
 . Q:SPER<BPER
"RTN","SPNJRPSC",31,0)
 . Q:SPER>EPER
"RTN","SPNJRPSC",32,0)
 . S ICN=$P($G(^DPT(DFN,"MPI")),"^",1)
"RTN","SPNJRPSC",33,0)
 . Q:ICN=""
"RTN","SPNJRPSC",34,0)
 . S ^TMP("SPN",$J,ICN)=SPER
"RTN","SPNJRPSC",35,0)
 K VAEL
"RTN","SPNJRPSC",36,0)
 Q
"RTN","SPNJRPSC",37,0)
OUT ;
"RTN","SPNJRPSC",38,0)
 S ICN=""
"RTN","SPNJRPSC",39,0)
 F  S ICN=$O(^TMP("SPN",$J,ICN)) Q:ICN=""  D
"RTN","SPNJRPSC",40,0)
 . S SPER=^TMP("SPN",$J,ICN)
"RTN","SPNJRPSC",41,0)
 . S ^TMP($J,RETCNT)=ICN_"^"_SPER_"^EOL999"
"RTN","SPNJRPSC",42,0)
 . S RETCNT=RETCNT+1
"RTN","SPNJRPSC",43,0)
 Q
"RTN","SPNJRPSD")
0^29^B22832226
"RTN","SPNJRPSD",1,0)
SPNJRPSD ;BP/JAS - Returns SCI/SCI Discharges data ;JUN 12, 2009
"RTN","SPNJRPSD",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNJRPSD",3,0)
 ;
"RTN","SPNJRPSD",4,0)
 ; Reference to ^DPT(D0,0 supported by IA# 998
"RTN","SPNJRPSD",5,0)
 ; Reference to ^DPT(D0,57 supported by IA# 4938
"RTN","SPNJRPSD",6,0)
 ; Reference to ^DPT(D0,"MPI" supported by IA# 4938
"RTN","SPNJRPSD",7,0)
 ; Reference to ^DGPM("APRD" supported by IA# 4942
"RTN","SPNJRPSD",8,0)
 ; References to file #4 supported by IA# 10090
"RTN","SPNJRPSD",9,0)
 ; References to file #45/^DGPT supported by IA# 92 & 4945
"RTN","SPNJRPSD",10,0)
 ; Reference to API ICDDX^ICDCODE supported by IA# 3990
"RTN","SPNJRPSD",11,0)
 ; RETIRED AND REPLACED WITH IA# 3990 [Reference to file #80 supported by IA# 10082]
"RTN","SPNJRPSD",12,0)
 ; Reference to file #4.3 supported by IA# 10091
"RTN","SPNJRPSD",13,0)
 ; Reference to API DEM^VADPT supported by IA# 10061
"RTN","SPNJRPSD",14,0)
 ; Reference to API IN5^VADPT supported by IA# 10061
"RTN","SPNJRPSD",15,0)
 ; API $$FLIP^SPNRPCIC is part of Spinal Cord Version 3.0
"RTN","SPNJRPSD",16,0)
 ;
"RTN","SPNJRPSD",17,0)
 ; Parm values:
"RTN","SPNJRPSD",18,0)
 ;     RETURN  is the sorted data from the earliest date of listing
"RTN","SPNJRPSD",19,0)
 ;     ICNLST  is the list of patient ICNs to process
"RTN","SPNJRPSD",20,0)
 ;     FDATE   is the delivery starting date
"RTN","SPNJRPSD",21,0)
 ;     TDATE   is the delivery ending date
"RTN","SPNJRPSD",22,0)
 ;
"RTN","SPNJRPSD",23,0)
 ; Returns: ^TMP($J)
"RTN","SPNJRPSD",24,0)
 ;
"RTN","SPNJRPSD",25,0)
COL(RETURN,ICNLST,FDATE,TDATE) ;
"RTN","SPNJRPSD",26,0)
 ;
"RTN","SPNJRPSD",27,0)
 ;***************************
"RTN","SPNJRPSD",28,0)
 S RETURN=$NA(^TMP($J)),RETCNT=1,DISCNT=0
"RTN","SPNJRPSD",29,0)
 S X=FDATE S %DT="T" D ^%DT S SPNDATE=Y
"RTN","SPNJRPSD",30,0)
 S X=TDATE S %DT="T" D ^%DT S SPNEDAT=Y_.2359
"RTN","SPNJRPSD",31,0)
 ;***************************
"RTN","SPNJRPSD",32,0)
 K ^TMP($J),^TMP("SPN",$J),SPNFAC
"RTN","SPNJRPSD",33,0)
 F ICNNM=1:1:$L(ICNLST,"^") S ICN=$P(ICNLST,"^",ICNNM) D IN
"RTN","SPNJRPSD",34,0)
 D OUT,HEAD2,CLNUP
"RTN","SPNJRPSD",35,0)
 Q
"RTN","SPNJRPSD",36,0)
IN Q:$G(ICN)=""
"RTN","SPNJRPSD",37,0)
 S SPNDFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNJRPSD",38,0)
 Q:$G(DFN)=""
"RTN","SPNJRPSD",39,0)
 ;***************************
"RTN","SPNJRPSD",40,0)
 N SPNX,SPNFAC
"RTN","SPNJRPSD",41,0)
 S (SPNLPRT,SPNFAC)=0
"RTN","SPNJRPSD",42,0)
 S SPNQDAT=SPNDATE-.000001
"RTN","SPNJRPSD",43,0)
 S SDA=SPNDFN
"RTN","SPNJRPSD",44,0)
 Q:'$D(^DGPM("APRD",SDA))
"RTN","SPNJRPSD",45,0)
 F  S SPNQDAT=$O(^DGPM("APRD",SDA,SPNQDAT)) Q:(SPNQDAT<1)  Q:(SPNQDAT>SPNEDAT)  D
"RTN","SPNJRPSD",46,0)
 . S SPNIEN=0 F  S SPNIEN=$O(^DGPM("APRD",SDA,SPNQDAT,SPNIEN)) Q:SPNIEN<1  D
"RTN","SPNJRPSD",47,0)
 . . N DFN,SPNLINE,SPNLOS
"RTN","SPNJRPSD",48,0)
 . . S DFN=SPNDFN,VAIP("E")=SPNIEN D IN5^VADPT
"RTN","SPNJRPSD",49,0)
 . . Q:VAIP(2)'["DISCHARGE"
"RTN","SPNJRPSD",50,0)
 . . S SPNLOS=$$FMDIFF^XLFDT(SPNQDAT,$P(VAIP(15,1),U)) ; LENGTH OF STAY
"RTN","SPNJRPSD",51,0)
 . . ; SPNLINE=Movement date(E)^pointer to PTF(I)^Length of Stay
"RTN","SPNJRPSD",52,0)
 . . ;         ^Ward location(E)^D/C date
"RTN","SPNJRPSD",53,0)
 . . S SPNLINE=$P(VAIP(15,1),U)_U_VAIP(12)_U_SPNLOS_U_$P(VAIP(5),U,2)_U_SPNQDAT
"RTN","SPNJRPSD",54,0)
 . . S ^TMP("SPN",$J,$$GET1^DIQ(2,SPNDFN,.01,"E"),SPNDFN,SPNIEN)=SPNLINE
"RTN","SPNJRPSD",55,0)
 . . D KVAR^VADPT
"RTN","SPNJRPSD",56,0)
 Q
"RTN","SPNJRPSD",57,0)
OUT ;
"RTN","SPNJRPSD",58,0)
 I $D(^TMP("SPN",$J)) D   ; Indicates the report had data
"RTN","SPNJRPSD",59,0)
 . N SPNSTATE,SPNDFN,SPNNAME,SPNCOU
"RTN","SPNJRPSD",60,0)
 . S SPNCOU=0,SPNFAC=0
"RTN","SPNJRPSD",61,0)
 . S SPNNAME="" F  S SPNNAME=$O(^TMP("SPN",$J,SPNNAME)) Q:SPNNAME=""  D
"RTN","SPNJRPSD",62,0)
 . . S SPNDFN=0 F  S SPNDFN=$O(^TMP("SPN",$J,SPNNAME,SPNDFN)) Q:SPNDFN<1  D NEWPAT(SPNDFN)  D
"RTN","SPNJRPSD",63,0)
 . . . S SPNIEN=0 F  S SPNIEN=$O(^TMP("SPN",$J,SPNNAME,SPNDFN,SPNIEN)) Q:SPNIEN<1  D
"RTN","SPNJRPSD",64,0)
 . . . . S SPNLINE=^TMP("SPN",$J,SPNNAME,SPNDFN,SPNIEN)
"RTN","SPNJRPSD",65,0)
 . . . . D HEAD
"RTN","SPNJRPSD",66,0)
 . . . . D PATIENT(SPNDFN,SPNLINE)
"RTN","SPNJRPSD",67,0)
 Q
"RTN","SPNJRPSD",68,0)
NEWPAT(SPNDFN) ; New patient to print
"RTN","SPNJRPSD",69,0)
 N DFN
"RTN","SPNJRPSD",70,0)
 S DFN=SPNDFN D DEM^VADPT
"RTN","SPNJRPSD",71,0)
 S ICN=$P(^DPT(DFN,"MPI"),"^",1)
"RTN","SPNJRPSD",72,0)
 S ^TMP($J,RETCNT)="HDR1999^Patient^SSN^SCI^EOL999"
"RTN","SPNJRPSD",73,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPSD",74,0)
 S ^TMP($J,RETCNT)="PAT999^"_VADM(1)_"^"_$P(VADM(2),"^",2)_"^"_$$GET1^DIQ(2,SPNDFN,57.4,"E")_"^"_ICN_"^EOL999"
"RTN","SPNJRPSD",75,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPSD",76,0)
 D KVAR^VADPT
"RTN","SPNJRPSD",77,0)
 S SPNCOU=SPNCOU+1
"RTN","SPNJRPSD",78,0)
 Q
"RTN","SPNJRPSD",79,0)
PATIENT(SPNDFN,SPNLINE) ; Print Patient data
"RTN","SPNJRPSD",80,0)
 ; SPNLINE=Movement date(I)^pointer to PTF(I)^Length of Stay
"RTN","SPNJRPSD",81,0)
 ;         ^Ward location(E)^D/C Date
"RTN","SPNJRPSD",82,0)
 ; SPNLINE=$P(VAIP(15,1),U,2)_U_VAIP(12)_U_SPNLOS_U_$P(VAIP(5),U,2)_U_SPNQDAT
"RTN","SPNJRPSD",83,0)
 S ^TMP($J,RETCNT)="DTL999^"_$$FMTE^XLFDT($P(SPNLINE,U,5),"5DZ")_"^"_$P(SPNLINE,U,3)_"^"_$P(SPNLINE,U,4)_"^EOL999"
"RTN","SPNJRPSD",84,0)
 S RETCNT=RETCNT+1,DISCNT=DISCNT+1
"RTN","SPNJRPSD",85,0)
 Q:$P(SPNLINE,U,2)=""
"RTN","SPNJRPSD",86,0)
 N SPNODE,SPNNODE
"RTN","SPNJRPSD",87,0)
 S SPNNODE=$G(^DGPT($P(SPNLINE,U,2),70)) Q:SPNNODE=""
"RTN","SPNJRPSD",88,0)
 I $P(SPNNODE,U,12)?1N.N S SPNFAC=SPNFAC+1,SPNFAC($P(SPNNODE,U,12))=$G(SPNFAC($P(SPNNODE,U,12)))+1 ; Collect Receiving Facility
"RTN","SPNJRPSD",89,0)
 N SPNY
"RTN","SPNJRPSD",90,0)
 S RETCNTB=RETCNT
"RTN","SPNJRPSD",91,0)
 ;F SPNODE=10,16:1:24 D
"RTN","SPNJRPSD",92,0)
 F SPNODE=79,79.16,79.17,79.18,79.19,79.201,79.21,79.22,79.23,79.24 D
"RTN","SPNJRPSD",93,0)
 . ;S SPNY=$P(SPNNODE,U,SPNODE)
"RTN","SPNJRPSD",94,0)
 . S SPNY=$$GET1^DIQ(45,$P(SPNLINE,U,2)_",",SPNODE,"I")
"RTN","SPNJRPSD",95,0)
 . I SPNY'>0 Q
"RTN","SPNJRPSD",96,0)
 . ;JAS 6/12/09 - DEFECT 1137 - Removed direct & FM reads of CPT/ICD files to API usage
"RTN","SPNJRPSD",97,0)
 . ;I $G(^ICD9(SPNY,0))="" Q
"RTN","SPNJRPSD",98,0)
 . S SPNYAPI=$$ICDDX^ICDCODE(SPNY,"","","")
"RTN","SPNJRPSD",99,0)
 . Q:$P(SPNYAPI,"^")=-1
"RTN","SPNJRPSD",100,0)
 . ;S ^TMP($J,RETCNT)="DIAG999^"_$$GET1^DIQ(80,SPNY,3,"E")_"^EOL999"
"RTN","SPNJRPSD",101,0)
 . S ^TMP($J,RETCNT)="DIAG999^"_$P(SPNYAPI,"^",4)_"^EOL999"
"RTN","SPNJRPSD",102,0)
 . S RETCNT=RETCNT+1
"RTN","SPNJRPSD",103,0)
 K SPNYAPI
"RTN","SPNJRPSD",104,0)
 I RETCNT=RETCNTB D
"RTN","SPNJRPSD",105,0)
 . S ^TMP($J,RETCNT)="DIAG999^^EOL999"
"RTN","SPNJRPSD",106,0)
 . S RETCNT=RETCNT+1
"RTN","SPNJRPSD",107,0)
 D KVAR^VADPT
"RTN","SPNJRPSD",108,0)
 Q
"RTN","SPNJRPSD",109,0)
HEAD ; Header Print
"RTN","SPNJRPSD",110,0)
 S ^TMP($J,RETCNT)="HDR2999^Date D/C^LOS^D/C Location^Diagnosis Codes^EOL999"
"RTN","SPNJRPSD",111,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPSD",112,0)
 Q
"RTN","SPNJRPSD",113,0)
HEAD2 ; Header Print
"RTN","SPNJRPSD",114,0)
 S ^TMP($J,RETCNT)="HDR3999^Facility^Station #^Total^EOL999"
"RTN","SPNJRPSD",115,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPSD",116,0)
 ;S DA=0  S DA=$O(^XMB(1,DA))
"RTN","SPNJRPSD",117,0)
 ;S STDA=$P(^XMB(1,DA,"XUS"),"^",17)
"RTN","SPNJRPSD",118,0)
 S STDA=$$GET1^DIQ(4.3,1,217,"I")
"RTN","SPNJRPSD",119,0)
 ;S STAT=$P(^DIC(4,STDA,0),"^",1),DIVN=$P(^DIC(4,STDA,99),"^",1)
"RTN","SPNJRPSD",120,0)
 S STAT=$$GET1^DIQ(4,STDA_",",.01)
"RTN","SPNJRPSD",121,0)
 S DIVN=$$GET1^DIQ(4,STDA_",",99)
"RTN","SPNJRPSD",122,0)
 S ^TMP($J,RETCNT)="TOT999^"_STAT_"^"_DIVN_"^"_DISCNT_"^EOL999"
"RTN","SPNJRPSD",123,0)
 S RETCNT=RETCNT+1
"RTN","SPNJRPSD",124,0)
 Q
"RTN","SPNJRPSD",125,0)
CLNUP ;
"RTN","SPNJRPSD",126,0)
 K %DT,DISCNT,DIVN,ICN,ICNNM,RETCNT,RETCNTB,SDA,SPNDATE
"RTN","SPNJRPSD",127,0)
 K SPNEDAT,SPNIEN,SPNLPRT,SPNQDAT,STAT,STDA,VADM,VAIP,X,Y
"RTN","SPNJRPSD",128,0)
 Q
"RTN","SPNJRPSR")
0^92^B2758801
"RTN","SPNJRPSR",1,0)
SPNJRPSR ;BP/JAS - Returns SCI Roles for all SCI NEW PERSON entries ;NOV 19, 2008
"RTN","SPNJRPSR",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNJRPSR",3,0)
 ;
"RTN","SPNJRPSR",4,0)
 ; References to ^XUSEC supported by IA# 10076
"RTN","SPNJRPSR",5,0)
 ; Reference to file 200 supported by IA# 10060
"RTN","SPNJRPSR",6,0)
 ;
"RTN","SPNJRPSR",7,0)
 ; Parm values:
"RTN","SPNJRPSR",8,0)
 ;     RETURN is the array containing role and access types for SCI users
"RTN","SPNJRPSR",9,0)
 ;     Returns: ^TMP($J)
"RTN","SPNJRPSR",10,0)
 ;
"RTN","SPNJRPSR",11,0)
COL(RETURN) ;
"RTN","SPNJRPSR",12,0)
 ;***************************
"RTN","SPNJRPSR",13,0)
 K ^TMP($J),^TMP("SPN",$J)
"RTN","SPNJRPSR",14,0)
 S RETURN=$NA(^TMP($J)),RETCNT=1
"RTN","SPNJRPSR",15,0)
 ;JAS - 11/19/08 - DEFECT 1110
"RTN","SPNJRPSR",16,0)
 ;S DA="SCI"
"RTN","SPNJRPSR",17,0)
 ;F  S DA=$O(^XUSEC(DA)) Q:DA=""!(DA]"SCI_Z")  D NPDA
"RTN","SPNJRPSR",18,0)
 S DA="SPN_AA"
"RTN","SPNJRPSR",19,0)
 F  S DA=$O(^XUSEC(DA)) Q:DA=""!(DA]"SPN_ZZ")  D NPDA
"RTN","SPNJRPSR",20,0)
 D FIN
"RTN","SPNJRPSR",21,0)
 K ACCESS,DA,NPDA,KEY,RETCNT,ROLE,UNAME,^TMP("SPN",$J)
"RTN","SPNJRPSR",22,0)
 Q
"RTN","SPNJRPSR",23,0)
NPDA ;
"RTN","SPNJRPSR",24,0)
 ;JAS - 05/15/08 - DEFECT 1090
"RTN","SPNJRPSR",25,0)
 ;S NPDA=""
"RTN","SPNJRPSR",26,0)
 S NPDA=0
"RTN","SPNJRPSR",27,0)
 F  S NPDA=$O(^XUSEC(DA,NPDA)) Q:NPDA=""  D FIND
"RTN","SPNJRPSR",28,0)
 Q
"RTN","SPNJRPSR",29,0)
FIND ;
"RTN","SPNJRPSR",30,0)
 S UNAME=$$GET1^DIQ(200,NPDA_",",.01)
"RTN","SPNJRPSR",31,0)
 S ^TMP("SPN",$J,UNAME,NPDA,DA)=""
"RTN","SPNJRPSR",32,0)
 Q
"RTN","SPNJRPSR",33,0)
FIN ;
"RTN","SPNJRPSR",34,0)
 S UNAME=""
"RTN","SPNJRPSR",35,0)
 F  S UNAME=$O(^TMP("SPN",$J,UNAME)) Q:UNAME=""  D
"RTN","SPNJRPSR",36,0)
 . S NPDA=""
"RTN","SPNJRPSR",37,0)
 . F  S NPDA=$O(^TMP("SPN",$J,UNAME,NPDA)) Q:NPDA=""  D
"RTN","SPNJRPSR",38,0)
 . . S KEY="",ROLE="",ACCESS=""
"RTN","SPNJRPSR",39,0)
 . . F  S KEY=$O(^TMP("SPN",$J,UNAME,NPDA,KEY)) Q:KEY=""  D
"RTN","SPNJRPSR",40,0)
 . . . I KEY["CATCHMENT" S ACCESS="Region" Q
"RTN","SPNJRPSR",41,0)
 . . . I ROLE="" S ROLE=$P(KEY,"_",2) Q
"RTN","SPNJRPSR",42,0)
 . . . S ROLE=ROLE_", "_$P(KEY,"_",2)
"RTN","SPNJRPSR",43,0)
 . . Q:ROLE=""&(ACCESS="")
"RTN","SPNJRPSR",44,0)
 . . I ACCESS="" S ACCESS="Institution"
"RTN","SPNJRPSR",45,0)
 . . S ^TMP($J,RETCNT)=UNAME_"^"_ROLE_"^"_ACCESS_"^EOL999"
"RTN","SPNJRPSR",46,0)
 . . S RETCNT=RETCNT+1
"RTN","SPNJRPSR",47,0)
 Q
"RTN","SPNJRPX2")
0^83^B33025054
"RTN","SPNJRPX2",1,0)
SPNJRPX2 ;BP/JAS - CPTS/ICDS CODES & DESCRIPTS ;JUN 17, 2009
"RTN","SPNJRPX2",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNJRPX2",3,0)
 ;
"RTN","SPNJRPX2",4,0)
 ; References to file #409.68/^SCE supported by IA #2443
"RTN","SPNJRPX2",5,0)
 ; RETIRED AND REPLACED WITH IA# 3990 [Reference to ^ICD9 supported by IA #10082]
"RTN","SPNJRPX2",6,0)
 ; Reference to API ICDDX^ICDCODE supported by IA #3990
"RTN","SPNJRPX2",7,0)
 ; Reference to ^SDD(409.43 supported by IA #4930
"RTN","SPNJRPX2",8,0)
 ; References to ^ACK(509850.6 supported by IA #1558
"RTN","SPNJRPX2",9,0)
 ; References to file #721/^ECH supported by IA #1873
"RTN","SPNJRPX2",10,0)
 ; References to file #70/^RADPT supported by IA #3125 & #118
"RTN","SPNJRPX2",11,0)
 ; Reference to ^RAMIS(71 supported by IA #586
"RTN","SPNJRPX2",12,0)
 ; References to ^RMPR(660 supported by IA #4975
"RTN","SPNJRPX2",13,0)
 ; Reference to ^ICPT supported by IA #2815
"RTN","SPNJRPX2",14,0)
 ; Reference to API CPT^ICPTCOD supported by IA #1995
"RTN","SPNJRPX2",15,0)
 ; Reference to API PSASHCPC^RMPOPF supported by IA #4975
"RTN","SPNJRPX2",16,0)
 ;
"RTN","SPNJRPX2",17,0)
ENTER ;
"RTN","SPNJRPX2",18,0)
 D SCE
"RTN","SPNJRPX2",19,0)
 D AUDIO
"RTN","SPNJRPX2",20,0)
 D ECH
"RTN","SPNJRPX2",21,0)
 D RAD
"RTN","SPNJRPX2",22,0)
 D PROS
"RTN","SPNJRPX2",23,0)
 ;NOTE: SOME VAR'S ARE KILLED IN SPNJRPCX
"RTN","SPNJRPX2",24,0)
 D CLNUP
"RTN","SPNJRPX2",25,0)
 Q
"RTN","SPNJRPX2",26,0)
 ;
"RTN","SPNJRPX2",27,0)
SCE ;loop through the sce file "c" on dfn then to the sdd file for icd9
"RTN","SPNJRPX2",28,0)
 S XA=0 F  S XA=$O(^SCE("C",DFN,XA)) Q:(XA="")!('+XA)  D
"RTN","SPNJRPX2",29,0)
 .S SPNREDT=9999999.9999-$P($G(^SCE(XA,0)),U,1)
"RTN","SPNJRPX2",30,0)
 .Q:$P($G(^SCE(XA,0)),U,1)<SPNCUTDT
"RTN","SPNJRPX2",31,0)
 .S SPNSCDT=$$GET1^DIQ(409.68,XA_",",.01,"E")
"RTN","SPNJRPX2",32,0)
 .;JAS - 05/15/08 - DEFECT 1090
"RTN","SPNJRPX2",33,0)
 .;S XB="" F  S XB=$O(^SDD(409.43,"AO",XA,XB)) Q:(XB="")!('+XB)  D
"RTN","SPNJRPX2",34,0)
 .S XB=0 F  S XB=$O(^SDD(409.43,"AO",XA,XB)) Q:(XB="")!('+XB)  D
"RTN","SPNJRPX2",35,0)
 ..;JAS 6/17/09 - DEFECT 1137 - Removed direct reads of CPT/ICD files to API usage
"RTN","SPNJRPX2",36,0)
 ..S SPNARY=$$ICDDX^ICDCODE(XB,"","","")
"RTN","SPNJRPX2",37,0)
 ..S CNT=CNT+1
"RTN","SPNJRPX2",38,0)
 ..;S ^TMP($J,"UTIL","ICD",SPNREDT,CNT)=$P($G(^ICD9(XB,0)),U,3)_U_$P($G(^ICD9(XB,0)),U,1)_U_SPNSCDT_U
"RTN","SPNJRPX2",39,0)
 ..S ^TMP($J,"UTIL","ICD",SPNREDT,CNT)=$P(SPNARY,U,4)_U_$P(SPNARY,U,2)_U_SPNSCDT_U
"RTN","SPNJRPX2",40,0)
 ..Q
"RTN","SPNJRPX2",41,0)
 .K SPNARY
"RTN","SPNJRPX2",42,0)
 .Q
"RTN","SPNJRPX2",43,0)
 Q
"RTN","SPNJRPX2",44,0)
AUDIO ;get icd9's from audio speech
"RTN","SPNJRPX2",45,0)
 S XA=0 F  S XA=$O(^ACK(509850.6,"C",DFN,XA)) Q:(XA="")!('+XA)  D
"RTN","SPNJRPX2",46,0)
 .S SPNARDT=$P($G(^ACK(509850.6,XA,0)),U,1)
"RTN","SPNJRPX2",47,0)
 .Q:SPNARDT=""
"RTN","SPNJRPX2",48,0)
 .Q:SPNARDT<SPNCUTDT
"RTN","SPNJRPX2",49,0)
 .S MDT=SPNARDT
"RTN","SPNJRPX2",50,0)
 .S SPNARDT=9999999.9999-SPNARDT
"RTN","SPNJRPX2",51,0)
 .S SPNFIELD=1 D COL
"RTN","SPNJRPX2",52,0)
 .S SPNFIELD=3 D COL
"RTN","SPNJRPX2",53,0)
 .Q
"RTN","SPNJRPX2",54,0)
 Q
"RTN","SPNJRPX2",55,0)
COL ;
"RTN","SPNJRPX2",56,0)
 S XB=0 F  S XB=$O(^ACK(509850.6,XA,SPNFIELD,XB)) Q:(XB="")!('+XB)  D
"RTN","SPNJRPX2",57,0)
 .S XC=$P($G(^ACK(509850.6,XA,SPNFIELD,XB,0)),U,1)
"RTN","SPNJRPX2",58,0)
 .Q:XC=""
"RTN","SPNJRPX2",59,0)
 .;JAS 6/17/09 - DEFECT 1137 - Removed direct reads of CPT/ICD files to API usage
"RTN","SPNJRPX2",60,0)
 .S SPNARY=$$ICDDX^ICDCODE(XC,"","","")
"RTN","SPNJRPX2",61,0)
 .;I SPNFIELD=1 S XCCODE=$P($G(^ICD9(XC,0)),U,1)
"RTN","SPNJRPX2",62,0)
 .I SPNFIELD=1 S XCCODE=$P(SPNARY,U,2)
"RTN","SPNJRPX2",63,0)
 .;I SPNFIELD=1 S XC=$P($G(^ICD9(XC,0)),U,3)
"RTN","SPNJRPX2",64,0)
 .I SPNFIELD=1 S XC=$P(SPNARY,U,4)
"RTN","SPNJRPX2",65,0)
 .I SPNFIELD=3 D
"RTN","SPNJRPX2",66,0)
 ..S XSTRING=$$CPT^ICPTCOD(XC,MDT,"")
"RTN","SPNJRPX2",67,0)
 ..S XCCODE=$P(XSTRING,"^",2)
"RTN","SPNJRPX2",68,0)
 ..S XC=$P(XSTRING,"^",3)
"RTN","SPNJRPX2",69,0)
 .Q:XC=""
"RTN","SPNJRPX2",70,0)
 .I SPNFIELD=1 S CNT=CNT+1
"RTN","SPNJRPX2",71,0)
 .I SPNFIELD=3 S CPTCNT=CPTCNT+1
"RTN","SPNJRPX2",72,0)
 .S ^TMP($J,"UTIL",$S(SPNFIELD=1:"ICD",1:"CPT"),SPNARDT,$S(SPNFIELD=1:CNT,1:CPTCNT))=XC_U_XCCODE_U_$$GET1^DIQ(509850.6,XA_",",.01,"E")_U
"RTN","SPNJRPX2",73,0)
 .S XC=""
"RTN","SPNJRPX2",74,0)
 .K SPNARY
"RTN","SPNJRPX2",75,0)
 .Q
"RTN","SPNJRPX2",76,0)
 Q 
"RTN","SPNJRPX2",77,0)
ECH ;
"RTN","SPNJRPX2",78,0)
 ;
"RTN","SPNJRPX2",79,0)
 ;Event Capture file 721
"RTN","SPNJRPX2",80,0)
 ; xa=date.time  xb = ien of ech
"RTN","SPNJRPX2",81,0)
 ; xc is the icd9 points to the ICD9 file
"RTN","SPNJRPX2",82,0)
 S XA=0 F  S XA=$O(^ECH("APAT",DFN,XA)) Q:(XA="")!('+XA)  S XB=0 F  S XB=$O(^ECH("APAT",DFN,XA,XB)) Q:(XB="")!('+XB)  D
"RTN","SPNJRPX2",83,0)
 .S SPNARDT=$P($G(^ECH(XB,0)),U,3)
"RTN","SPNJRPX2",84,0)
 .Q:SPNARDT=""
"RTN","SPNJRPX2",85,0)
 .Q:SPNARDT<SPNCUTDT
"RTN","SPNJRPX2",86,0)
 .S MDT=SPNARDT
"RTN","SPNJRPX2",87,0)
 .S SPNARDT=9999999.9999-SPNARDT
"RTN","SPNJRPX2",88,0)
 .S XCODE=$P($G(^ECH(XB,"P")),U,2)
"RTN","SPNJRPX2",89,0)
 .I XCODE'="" D ECHNIN
"RTN","SPNJRPX2",90,0)
 .S XCODE=$P($G(^ECH(XB,"P")),U,1)
"RTN","SPNJRPX2",91,0)
 .I XCODE'="" D ECHCPT
"RTN","SPNJRPX2",92,0)
 .D ECHSEC
"RTN","SPNJRPX2",93,0)
 .Q
"RTN","SPNJRPX2",94,0)
 Q
"RTN","SPNJRPX2",95,0)
ECHNIN ;gets the icd9 and sets tmp($j,"util"
"RTN","SPNJRPX2",96,0)
 S XC=$$GET1^DIQ(721,XB_",",20,"E")  ;icd9 number
"RTN","SPNJRPX2",97,0)
 ;JAS 6/17/09 - DEFECT 1137 - Removed direct reads of CPT/ICD files to API usage
"RTN","SPNJRPX2",98,0)
 ;S XCTEXT=$P($G(^ICD9(XCODE,0)),U,3)  ;text of the icd9
"RTN","SPNJRPX2",99,0)
 S XCTEXT=$P($$ICDDX^ICDCODE(XCODE,"","",""),U,4)
"RTN","SPNJRPX2",100,0)
 S CNT=CNT+1
"RTN","SPNJRPX2",101,0)
 S ^TMP($J,"UTIL","ICD",SPNARDT,CNT)=XCTEXT_U_XC_U_$$GET1^DIQ(721,XB_",",2,"E")_U
"RTN","SPNJRPX2",102,0)
 Q
"RTN","SPNJRPX2",103,0)
ECHCPT ;gets the icpt field 20
"RTN","SPNJRPX2",104,0)
 S XC=$$GET1^DIQ(721,XB_",",19,"E")   ;icpt number
"RTN","SPNJRPX2",105,0)
 S XSTRING=$$CPT^ICPTCOD(XCODE,MDT,"")
"RTN","SPNJRPX2",106,0)
 S XCTEXT=$P(XSTRING,"^",3)
"RTN","SPNJRPX2",107,0)
 S CPTCNT=CPTCNT+1
"RTN","SPNJRPX2",108,0)
 S ^TMP($J,"UTIL","CPT",SPNARDT,CPTCNT)=XCTEXT_U_XC_U_$$GET1^DIQ(721,XB_",",2,"E")_U
"RTN","SPNJRPX2",109,0)
 Q
"RTN","SPNJRPX2",110,0)
ECHSEC ;get SECONDARY ICD-9 CODE subscript dx
"RTN","SPNJRPX2",111,0)
 S DXIEN=0 F  S DXIEN=$O(^ECH(XB,"DX",DXIEN)) Q:(DXIEN="")!('+DXIEN)  D
"RTN","SPNJRPX2",112,0)
 .S XCODE=$P($G(^ECH(XB,"DX",DXIEN,0)),U,1)
"RTN","SPNJRPX2",113,0)
 .;JAS 6/17/09 - DEFECT 1137 - Removed direct reads of CPT/ICD files to API usage
"RTN","SPNJRPX2",114,0)
 .S SPNARY=$$ICDDX^ICDCODE(XCODE,"","","")
"RTN","SPNJRPX2",115,0)
 .;S XC=$P($G(^ICD9(XCODE,0)),U,1)
"RTN","SPNJRPX2",116,0)
 .S XC=$P(SPNARY,"^",2)
"RTN","SPNJRPX2",117,0)
 .;S XCTEXT=$P($G(^ICD9(XCODE,0)),U,3)
"RTN","SPNJRPX2",118,0)
 .S XCTEXT=$P(SPNARY,"^",4)
"RTN","SPNJRPX2",119,0)
 .S CNT=CNT+1
"RTN","SPNJRPX2",120,0)
 .S ^TMP($J,"UTIL","ICD",SPNARDT,CNT)=XCTEXT_U_XC_U_$$GET1^DIQ(721,XB_",",2,"E")_U
"RTN","SPNJRPX2",121,0)
 .K SPNARY
"RTN","SPNJRPX2",122,0)
 .Q
"RTN","SPNJRPX2",123,0)
 Q
"RTN","SPNJRPX2",124,0)
RAD ;RAD/NUC MED PATIENT
"RTN","SPNJRPX2",125,0)
 ;
"RTN","SPNJRPX2",126,0)
 S RADDT=0 F  S RADDT=$O(^RADPT(DFN,"DT",RADDT)) Q:(RADDT="")!('+RADDT)  D
"RTN","SPNJRPX2",127,0)
 .S REALDT=$$GET1^DIQ(70.02,RADDT_","_DFN_",",.01,"I")
"RTN","SPNJRPX2",128,0)
 .Q:REALDT<SPNCUTDT
"RTN","SPNJRPX2",129,0)
 .S EXAM=0 F  S EXAM=$O(^RADPT(DFN,"DT",RADDT,"P",EXAM)) Q:(EXAM="")!('+EXAM)  D
"RTN","SPNJRPX2",130,0)
 ..S RADCPT=$$GET1^DIQ(70.03,EXAM_","_RADDT_","_DFN_",",2,"I")
"RTN","SPNJRPX2",131,0)
 ..Q:RADCPT=""
"RTN","SPNJRPX2",132,0)
 ..S RADCPT=$P($G(^RAMIS(71,RADCPT,0)),U,9)
"RTN","SPNJRPX2",133,0)
 ..Q:RADCPT=""  ;NOT IN THE RAMIS FILE
"RTN","SPNJRPX2",134,0)
 ..S XSTRING=$$CPT^ICPTCOD(RADCPT,REALDT,"")
"RTN","SPNJRPX2",135,0)
 ..S ICPTTXT=$P(XSTRING,"^",3)
"RTN","SPNJRPX2",136,0)
 ..S CPTCNT=CPTCNT+1
"RTN","SPNJRPX2",137,0)
 ..S Y=REALDT D DD^%DT S SHOWDT=Y
"RTN","SPNJRPX2",138,0)
 ..S ^TMP($J,"UTIL","CPT",RADDT,CPTCNT)=ICPTTXT_U_RADCPT_U_SHOWDT_U
"RTN","SPNJRPX2",139,0)
 Q
"RTN","SPNJRPX2",140,0)
PROS ;Record of Prosthetics Appl Repair
"RTN","SPNJRPX2",141,0)
 S PROSENT=0 F  S PROSENT=$O(^RMPR(660,"C",DFN,PROSENT)) Q:(PROSENT=0)!('+PROSENT)  D
"RTN","SPNJRPX2",142,0)
 .S ENTRYDT=$P($G(^RMPR(660,PROSENT,0)),U,1)
"RTN","SPNJRPX2",143,0)
 .S RMPRHCDT=ENTRYDT
"RTN","SPNJRPX2",144,0)
 .Q:ENTRYDT<SPNCUTDT
"RTN","SPNJRPX2",145,0)
 .S REVRADT=9999999.9999-ENTRYDT
"RTN","SPNJRPX2",146,0)
 .S CPT=$P($G(^RMPR(660,PROSENT,1)),U,4)
"RTN","SPNJRPX2",147,0)
 .Q:CPT=""
"RTN","SPNJRPX2",148,0)
 .S RMPRHCPC=CPT
"RTN","SPNJRPX2",149,0)
 .D PSASHCPC^RMPOPF
"RTN","SPNJRPX2",150,0)
 .S CPTCODE=RMPREHC
"RTN","SPNJRPX2",151,0)
 .S CPTTXT=RMPRTHC
"RTN","SPNJRPX2",152,0)
 .S Y=ENTRYDT D DD^%DT S PRODATE=Y
"RTN","SPNJRPX2",153,0)
 .S CPTCNT=CPTCNT+1
"RTN","SPNJRPX2",154,0)
 .S ^TMP($J,"UTIL","CPT",REVRADT,CPTCNT)=CPTTXT_U_CPTCODE_U_PRODATE_U
"RTN","SPNJRPX2",155,0)
 .Q
"RTN","SPNJRPX2",156,0)
 Q
"RTN","SPNJRPX2",157,0)
CLNUP ;
"RTN","SPNJRPX2",158,0)
 K CPT,CPTCODE,CPTTXT,DXIEN,ENTRYDT,EXAM,ICPTTXT,PRODATE,PROSENT
"RTN","SPNJRPX2",159,0)
 K RADCPT,RADDT,REALDT,REVRADT,SHOWDT,SPNARDT,SPNFIELD
"RTN","SPNJRPX2",160,0)
 K SPNREDT,SPNSCDT,XA,XB,XC,XCCODE,XCODE,XCTEXT
"RTN","SPNJRPX2",161,0)
 K CNT,CPTCNT,DFN,SPNCUTDT,Y,MDT,XSTRING
"RTN","SPNJRPX2",162,0)
 K RMPREHC,RMPRHCDT,RMPRHCPC,RMPRTHC
"RTN","SPNJRPX2",163,0)
 Q
"RTN","SPNLRK7")
0^30^B1438782
"RTN","SPNLRK7",1,0)
SPNLRK7 ;SD/WDE - LAB TEST UTILIZATION REPORT;JUL 23, 2008
"RTN","SPNLRK7",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNLRK7",3,0)
 ;
"RTN","SPNLRK7",4,0)
 ;
"RTN","SPNLRK7",5,0)
RPC(ROOT,FDATE,TDATE,QLIST,HIUSERS,PTLIST) ;
"RTN","SPNLRK7",6,0)
 K ^TMP("SPN",$J)
"RTN","SPNLRK7",7,0)
 K ^TMP($J)
"RTN","SPNLRK7",8,0)
 S ROOT=$NA(^TMP($J))
"RTN","SPNLRK7",9,0)
DATES ;----------------------------------------------------------------
"RTN","SPNLRK7",10,0)
 ;convert dates to fm style
"RTN","SPNLRK7",11,0)
 S X=FDATE D ^%DT S FDATE=Y  ;fdate
"RTN","SPNLRK7",12,0)
 S X=TDATE D ^%DT S TDATE=Y  ;tdate
"RTN","SPNLRK7",13,0)
 ;D BQLIST  ;unload the values in values
"RTN","SPNLRK7",14,0)
 S QLIST("MIN")=QLIST
"RTN","SPNLRK7",15,0)
 ;-------------------------------------------------------------
"RTN","SPNLRK7",16,0)
 S CNT=0
"RTN","SPNLRK7",17,0)
 S ICN=0 F ZYZ=1:1 S ICN=$G(PTLIST(ZYZ)) Q:ICN=""  D COL
"RTN","SPNLRK7",18,0)
 K ^TMP($J)
"RTN","SPNLRK7",19,0)
 S CNT=0
"RTN","SPNLRK7",20,0)
 D NAMEIT^SPNLGRCH
"RTN","SPNLRK7",21,0)
 D P1^SPNLRK8  ;resort data
"RTN","SPNLRK7",22,0)
 D P2^SPNLRK8  ;resort data
"RTN","SPNLRK7",23,0)
 I +HIUSERS D P3^SPNLRK8  ;resort data for hiusers
"RTN","SPNLRK7",24,0)
 K CNT,DFN,ICN,X,Y,ZYZ
"RTN","SPNLRK7",25,0)
 Q
"RTN","SPNLRK7",26,0)
COL ;
"RTN","SPNLRK7",27,0)
 ;********************************
"RTN","SPNLRK7",28,0)
 Q:ICN=""
"RTN","SPNLRK7",29,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNLRK7",30,0)
 Q:$G(DFN)=""
"RTN","SPNLRK7",31,0)
 ;********************************
"RTN","SPNLRK7",32,0)
 D ROLLUP^SPNLGRCH(DFN,FDATE,TDATE,HIUSERS) ; gather lab test data
"RTN","SPNLRK7",33,0)
 ;Tag RPC is called by a Remote procedure
"RTN","SPNLRK7",34,0)
 ;   fdate = from date
"RTN","SPNLRK7",35,0)
 ;   tdate = to date
"RTN","SPNLRK7",36,0)
 ;   hiusers = report on hi users
"RTN","SPNLRK7",37,0)
 ;   ptlist = patient list array
"RTN","SPNLRK7",38,0)
 ;   abort = true or false abort yes no
"RTN","SPNLRK7",39,0)
 Q
"RTN","SPNLRK8")
0^74^B15230861
"RTN","SPNLRK8",1,0)
SPNLRK8 ;SD/WDE - SCD LAB TEST UTILIZATION REPORT;Nov 22, 2006
"RTN","SPNLRK8",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNLRK8",3,0)
P1 ;
"RTN","SPNLRK8",4,0)
 S CNT=0
"RTN","SPNLRK8",5,0)
 ; NDTESTS   Number of different lab tests
"RTN","SPNLRK8",6,0)
 ; TESTNR    Type of Lab test (lab test number)
"RTN","SPNLRK8",7,0)
 ; ORDERS    Number of orders places
"RTN","SPNLRK8",8,0)
 N NDTESTS,TESTNR,OUT,LINE,STARTLIN,COL,ORDERS,NPATS,RESULTS
"RTN","SPNLRK8",9,0)
 S ORDERS=+$G(^TMP("SPN",$J,"CH","ORDERS"))
"RTN","SPNLRK8",10,0)
 S RESULTS=+$G(^TMP("SPN",$J,"CH","RESULTS"))
"RTN","SPNLRK8",11,0)
 S NPATS=+$G(^TMP("SPN",$J,"CH","PAT"))
"RTN","SPNLRK8",12,0)
 S CNT=CNT+1
"RTN","SPNLRK8",13,0)
 S ^TMP($J,"UTIL",CNT)="BOS999"_U_"Totals:  "_ORDERS_" order"_$S(ORDERS=1:"",1:"s")_" placed ("_RESULTS_" result"_$S(RESULTS=1:"",1:"s")_" reported) for "_NPATS_" patient"_$S(NPATS=1:"",1:"s")_"^EOL999"
"RTN","SPNLRK8",14,0)
 S TESTNR=""
"RTN","SPNLRK8",15,0)
 F NDTESTS=0:1 S TESTNR=$O(^TMP("SPN",$J,"CH","TEST",TESTNR)) Q:TESTNR=""
"RTN","SPNLRK8",16,0)
 I NDTESTS=1&(RESULTS>1) S CNT=CNT+1 S ^TMP($J,"UTIL",CNT)="HDR999"_U_"(This includes just one type of lab test)"_"^EOL999"
"RTN","SPNLRK8",17,0)
 I NDTESTS>1 S CNT=CNT+1 S ^TMP($J,"UTIL",CNT)="HDR999"_U_"(These include "_$FN(NDTESTS,",")_" different lab tests)"_"^EOL999"
"RTN","SPNLRK8",18,0)
 S SPZ1="" F  S SPZ1=$O(^TMP("SPN",$J,"CH","ORDERS",SPZ1)) Q:SPZ1=""  D
"RTN","SPNLRK8",19,0)
 .S CNT=CNT+1
"RTN","SPNLRK8",20,0)
 .S ^TMP($J,"UTIL",CNT)=$G(^TMP("SPN",$J,"CH","ORDERS",SPZ1))_U_-SPZ1_"^EOL999"
"RTN","SPNLRK8",21,0)
 Q
"RTN","SPNLRK8",22,0)
P2 ;
"RTN","SPNLRK8",23,0)
 S CNT=CNT+1
"RTN","SPNLRK8",24,0)
 S ^TMP($J,"UTIL",CNT)="BOS999"_U_"Lab Tests with "_$FN(QLIST("MIN"),",")_" or more Results"_"^EOL999"
"RTN","SPNLRK8",25,0)
 S CNT=CNT+1 S ^TMP($J,"UTIL",CNT)="HDR999"_U_"Lab Test"_U_"Results"_U_"Patients"_U_"(# patients)"_"^EOL999"
"RTN","SPNLRK8",26,0)
 S TESTNR=""
"RTN","SPNLRK8",27,0)
 F  S TESTNR=$O(^TMP("SPN",$J,"CH","TEST",TESTNR)) Q:TESTNR=""  D
"RTN","SPNLRK8",28,0)
 . S RESULTS=^TMP("SPN",$J,"CH","TEST",TESTNR)
"RTN","SPNLRK8",29,0)
 . Q:RESULTS<QLIST("MIN")
"RTN","SPNLRK8",30,0)
 . S NPATS=^TMP("SPN",$J,"CH","TEST",TESTNR,"PAT")
"RTN","SPNLRK8",31,0)
 . S NAME=^TMP("SPN",$J,"CH","TEST",TESTNR,"NAME")
"RTN","SPNLRK8",32,0)
 . S ^TMP("SPN",$J,"CH","OUT",-RESULTS,-NPATS,NAME)=TESTNR
"RTN","SPNLRK8",33,0)
 S RESULTS=""
"RTN","SPNLRK8",34,0)
 F  S RESULTS=$O(^TMP("SPN",$J,"CH","OUT",RESULTS)) Q:RESULTS=""  D
"RTN","SPNLRK8",35,0)
 . S NPATS=""
"RTN","SPNLRK8",36,0)
 . F  S NPATS=$O(^TMP("SPN",$J,"CH","OUT",RESULTS,NPATS)) Q:NPATS=""  D
"RTN","SPNLRK8",37,0)
 . . S NAME=""
"RTN","SPNLRK8",38,0)
 . . F  S NAME=$O(^TMP("SPN",$J,"CH","OUT",RESULTS,NPATS,NAME)) Q:NAME=""  D
"RTN","SPNLRK8",39,0)
 . . . S TESTNR=^TMP("SPN",$J,"CH","OUT",RESULTS,NPATS,NAME)
"RTN","SPNLRK8",40,0)
 . . . S MAXTESTS=$O(^TMP("SPN",$J,"CH","TEST",TESTNR,"RESULTS",""))
"RTN","SPNLRK8",41,0)
 . . . S MAXPATS=^TMP("SPN",$J,"CH","TEST",TESTNR,"RESULTS",MAXTESTS)
"RTN","SPNLRK8",42,0)
 . . . S CNT=CNT+1
"RTN","SPNLRK8",43,0)
 . . . S ^TMP($J,"UTIL",CNT)=NAME_U_-RESULTS_U_-NPATS
"RTN","SPNLRK8",44,0)
 . . . I RESULTS'=NPATS&(-RESULTS>1)&(-NPATS>1) S ^TMP($J,"UTIL",CNT)=^TMP($J,"UTIL",CNT)_U_-MAXTESTS_"("_MAXPATS_")"
"RTN","SPNLRK8",45,0)
 . . . S ^TMP($J,"UTIL",CNT)=^TMP($J,"UTIL",CNT)_"^EOL999"
"RTN","SPNLRK8",46,0)
 Q
"RTN","SPNLRK8",47,0)
P3 ;
"RTN","SPNLRK8",48,0)
 N RESULTS,NDTESTS,PID,PNAME,PSSN,I,ORDERS
"RTN","SPNLRK8",49,0)
 S CNT=CNT+1
"RTN","SPNLRK8",50,0)
 S ^TMP($J,"UTIL",CNT)="BOS999"_U_"HIGH USERS"_"^EOL999"
"RTN","SPNLRK8",51,0)
 S CNT=CNT+1
"RTN","SPNLRK8",52,0)
 S ^TMP($J,"UTIL",CNT)="HDR999"_U_"Patient Name"_U_"SSN"_U_"Orders"_U_"Results"_U_"Different Lab Tests"_"^EOL999"
"RTN","SPNLRK8",53,0)
 S ORDERS=""
"RTN","SPNLRK8",54,0)
 F I=1:1:HIUSERS S ORDERS=$O(^TMP("SPN",$J,"CH","HI","H1",ORDERS)) Q:ORDERS=""  D
"RTN","SPNLRK8",55,0)
 . S RESULTS=""
"RTN","SPNLRK8",56,0)
 . F  S RESULTS=$O(^TMP("SPN",$J,"CH","HI","H1",ORDERS,RESULTS)) Q:RESULTS=""  D
"RTN","SPNLRK8",57,0)
 . . S NDTESTS=""
"RTN","SPNLRK8",58,0)
 . . F  S NDTESTS=$O(^TMP("SPN",$J,"CH","HI","H1",ORDERS,RESULTS,NDTESTS)) Q:NDTESTS=""  D
"RTN","SPNLRK8",59,0)
 . . . S PID=""
"RTN","SPNLRK8",60,0)
 . . . F  S PID=$O(^TMP("SPN",$J,"CH","HI","H1",ORDERS,RESULTS,NDTESTS,PID)) Q:PID=""  D
"RTN","SPNLRK8",61,0)
 . . . . D GETNAME^SPNLRU(PID,.PNAME,.PSSN)
"RTN","SPNLRK8",62,0)
 . . . . S CNT=CNT+1
"RTN","SPNLRK8",63,0)
 . . . . S ^TMP($J,"UTIL",CNT)=PNAME_U_PSSN_U_-ORDERS_U_-RESULTS_U_-NDTESTS_"^EOL999"
"RTN","SPNLRK8",64,0)
 Q
"RTN","SPNLRK8",65,0)
KILL ;CALLED FROM MAIN ROUTINE
"RTN","SPNLRK8",66,0)
 K NDTESTS,NAME,MAXTESTS,MAXPATS,HIUSERS,CNT,QLIST,SPZ1
"RTN","SPNLRL1")
0^75^B19098772
"RTN","SPNLRL1",1,0)
SPNLRL1 ;SD/WDE - SCD PHARMACY UTILIZATION REPORT (PRINT PART 1 OF 3) ;Nov 22, 2006
"RTN","SPNLRL1",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNLRL1",3,0)
 ;
"RTN","SPNLRL1",4,0)
 ;
"RTN","SPNLRL1",5,0)
 ;
"RTN","SPNLRL1",6,0)
 ;
"RTN","SPNLRL1",7,0)
 ; PAGELEN   Number of lines per page
"RTN","SPNLRL1",8,0)
 ; TITLE     Array of header lines (titles)
"RTN","SPNLRL1",9,0)
P1(TITLE,PAGELEN,ABORT) ;
"RTN","SPNLRL1",10,0)
 ; NDDRUGS   Number of different types of drugs
"RTN","SPNLRL1",11,0)
 ; ZDRUGNR   Internal Entry Number of a drug in ^PSDRUG
"RTN","SPNLRL1",12,0)
 ; FILLS     Number of fills given
"RTN","SPNLRL1",13,0)
 S CNT=0  ;rpc
"RTN","SPNLRL1",14,0)
 N NDDRUGS,ZDRUGNR,FILLS,OUT,LINE,STARTLIN,COL,NPATS
"RTN","SPNLRL1",15,0)
 S TITLE(4)=""
"RTN","SPNLRL1",16,0)
 S FILLS=+$G(^TMP("SPN",$J,"RX","FILLS"))
"RTN","SPNLRL1",17,0)
 S NPATS=+$G(^TMP("SPN",$J,"RX","PAT"))
"RTN","SPNLRL1",18,0)
 S TITLE(5)=$$CENTER^SPNLRU("Totals:  "_$FN(FILLS,",")_" fill"_$S(FILLS=1:"",1:"s")_" reported for "_$FN(NPATS,",")_" patient"_$S(NPATS=1:"",1:"s"))
"RTN","SPNLRL1",19,0)
 S CNT=CNT+1  ;rpc
"RTN","SPNLRL1",20,0)
 S ^TMP($J,CNT)="BOS999"_"^EOL999"
"RTN","SPNLRL1",21,0)
 S CNT=CNT+1  ;rpc
"RTN","SPNLRL1",22,0)
 S ^TMP($J,CNT)="HDR999"_U_"Totals:  "_FILLS_" fill"_$S(FILLS=1:"",1:"s")_" reported for "_NPATS_" patient"_$S(NPATS=1:"",1:"s")_"^EOL999"  ;rpc
"RTN","SPNLRL1",23,0)
 S ZDRUGNR=""
"RTN","SPNLRL1",24,0)
 F NDDRUGS=0:1 S ZDRUGNR=$O(^TMP("SPN",$J,"RX","DRUG",ZDRUGNR)) Q:ZDRUGNR=""
"RTN","SPNLRL1",25,0)
 S:NDDRUGS=1&(FILLS>1) TITLE(6)=$$CENTER^SPNLRU("(This includes just one type of drug)")
"RTN","SPNLRL1",26,0)
 S:NDDRUGS>1 TITLE(6)=$$CENTER^SPNLRU("(These include "_$FN(NDDRUGS,",")_" different drugs)")
"RTN","SPNLRL1",27,0)
 S CNT=CNT+1
"RTN","SPNLRL1",28,0)
 S ^TMP($J,CNT)="HDR999"_U_"These include "_NDDRUGS_" different drugs"_"^EOL999"  ;rpc
"RTN","SPNLRL1",29,0)
 S FILLS=+$O(^TMP("SPN",$J,"RX","FILLS",""))
"RTN","SPNLRL1",30,0)
 F  D  Q:FILLS=""!(ABORT)
"RTN","SPNLRL1",31,0)
 . D HEADER^SPNLRU(.TITLE,.ABORT) Q:ABORT
"RTN","SPNLRL1",32,0)
 . K OUT,TITLE(4),TITLE(5),TITLE(6)
"RTN","SPNLRL1",33,0)
 . S STARTLIN=$Y
"RTN","SPNLRL1",34,0)
 . S OUT(STARTLIN+1)=""
"RTN","SPNLRL1",35,0)
 . F COL=1:1:3 D  Q:FILLS=""
"RTN","SPNLRL1",36,0)
 . . S OUT(STARTLIN)=$G(OUT(STARTLIN))_"   Patients      Fills    "
"RTN","SPNLRL1",37,0)
 . . F LINE=STARTLIN+2:1:PAGELEN D  Q:FILLS=""
"RTN","SPNLRL1",38,0)
 . . . S OUT(LINE)=$G(OUT(LINE))_$J($FN($G(^TMP("SPN",$J,"RX","FILLS",FILLS)),","),10)_$J($FN(-FILLS,","),11)_"     "
"RTN","SPNLRL1",39,0)
 . . . S:$G(CNT)="" CNT=0 S CNT=CNT+1 S ^TMP($J,CNT)=$G(^TMP("SPN",$J,"RX","FILLS",FILLS))_U_-FILLS_"^EOL999"  ;rpc
"RTN","SPNLRL1",40,0)
 . . . S FILLS=$O(^TMP("SPN",$J,"RX","FILLS",FILLS))
"RTN","SPNLRL1",41,0)
 . S LINE=""
"RTN","SPNLRL1",42,0)
 . F  S LINE=$O(OUT(LINE)) Q:LINE=""  D
"RTN","SPNLRL1",43,0)
 . . W !,OUT(LINE)
"RTN","SPNLRL1",44,0)
 Q
"RTN","SPNLRL1",45,0)
P2(TITLE,PAGELEN,QLIST,ABORT) ;
"RTN","SPNLRL1",46,0)
 N NPATS,ZDRUGNR,FILLS,MAXPATS,MAXFILLS,NAME
"RTN","SPNLRL1",47,0)
 S TITLE(4)=""
"RTN","SPNLRL1",48,0)
 S TITLE(5)=$$CENTER^SPNLRU("Drugs with "_$FN(QLIST("MINFILL"),",")_" or more fills")
"RTN","SPNLRL1",49,0)
 S CNT=CNT+1  ;rpc
"RTN","SPNLRL1",50,0)
 S ^TMP($J,CNT)="BOS999"_"^EOL999"  ;rpc
"RTN","SPNLRL1",51,0)
 S CNT=CNT+1
"RTN","SPNLRL1",52,0)
 S ^TMP($J,CNT)="HDR999"_U_"Drugs with "_$G(QLIST("MINFILL"))_" or more fills"_"^EOL999"  ;rpc
"RTN","SPNLRL1",53,0)
 S TITLE(6)=""
"RTN","SPNLRL1",54,0)
 S TITLE(7)="                                                                     Max # Fills"
"RTN","SPNLRL1",55,0)
 S TITLE(8)="Drug                                          Fills    Patients     (# patients)"
"RTN","SPNLRL1",56,0)
 D HEADER^SPNLRU(.TITLE,.ABORT) Q:ABORT
"RTN","SPNLRL1",57,0)
 S ZDRUGNR=""
"RTN","SPNLRL1",58,0)
 F  S ZDRUGNR=$O(^TMP("SPN",$J,"RX","DRUG",ZDRUGNR)) Q:ZDRUGNR=""  D
"RTN","SPNLRL1",59,0)
 . S FILLS=^TMP("SPN",$J,"RX","DRUG",ZDRUGNR)
"RTN","SPNLRL1",60,0)
 . Q:FILLS<QLIST("MINFILL")
"RTN","SPNLRL1",61,0)
 . S NPATS=^TMP("SPN",$J,"RX","DRUG",ZDRUGNR,"PAT")
"RTN","SPNLRL1",62,0)
 . S NAME=^TMP("SPN",$J,"RX","DRUG",ZDRUGNR,"NAME")
"RTN","SPNLRL1",63,0)
 . S ^TMP("SPN",$J,"RX","OUT",-FILLS,-NPATS,NAME)=ZDRUGNR
"RTN","SPNLRL1",64,0)
 S FILLS=""
"RTN","SPNLRL1",65,0)
 F  S FILLS=$O(^TMP("SPN",$J,"RX","OUT",FILLS)) Q:FILLS=""  D  Q:ABORT
"RTN","SPNLRL1",66,0)
 . S NPATS=""
"RTN","SPNLRL1",67,0)
 . F  S NPATS=$O(^TMP("SPN",$J,"RX","OUT",FILLS,NPATS)) Q:NPATS=""  D  Q:ABORT
"RTN","SPNLRL1",68,0)
 . . S NAME=""
"RTN","SPNLRL1",69,0)
 . . F  S NAME=$O(^TMP("SPN",$J,"RX","OUT",FILLS,NPATS,NAME)) Q:NAME=""  D  Q:ABORT
"RTN","SPNLRL1",70,0)
 . . . S:$G(CNT)="" CNT=0  ;rpc
"RTN","SPNLRL1",71,0)
 . . . I $Y>PAGELEN D HEADER^SPNLRU(.TITLE,.ABORT) Q:ABORT
"RTN","SPNLRL1",72,0)
 . . . S ZDRUGNR=^TMP("SPN",$J,"RX","OUT",FILLS,NPATS,NAME)
"RTN","SPNLRL1",73,0)
 . . . S MAXFILLS=$O(^TMP("SPN",$J,"RX","DRUG",ZDRUGNR,"FILLS",""))
"RTN","SPNLRL1",74,0)
 . . . S MAXPATS=^TMP("SPN",$J,"RX","DRUG",ZDRUGNR,"FILLS",MAXFILLS)
"RTN","SPNLRL1",75,0)
 . . . W !,NAME,?40,$J($FN(-FILLS,","),10),?52,$J($FN(-NPATS,","),10)
"RTN","SPNLRL1",76,0)
 . . . S RPC1=NAME_U_-FILLS_U_-NPATS  ;rpc
"RTN","SPNLRL1",77,0)
 . . . I FILLS'=NPATS&(-FILLS>1)&(-NPATS>1) W ?65,$J($FN(-MAXFILLS,","),9)," (",MAXPATS,")"
"RTN","SPNLRL1",78,0)
 . . . I FILLS'=NPATS&(-FILLS>1)&(-NPATS>1) S RPC2=-MAXFILLS_"("_MAXPATS_")"  ;rpc
"RTN","SPNLRL1",79,0)
 . . . S CNT=CNT+1 S ^TMP($J,CNT)=$G(RPC1)_U_$G(RPC2)_"^EOL999" K RPC1,RPC2  ;rpc
"RTN","SPNLRL1",80,0)
 . . . ; See what IMRWRCP1 does here for national report.
"RTN","SPNLRL1",81,0)
 K ^TMP("SPN",$J,"RX","OUT")
"RTN","SPNLRL1",82,0)
 K TITLE(4),TITLE(5),TITLE(6),TITLE(7),TITLE(8)
"RTN","SPNLRL1",83,0)
 Q
"RTN","SPNLRL1",84,0)
KILL ;
"RTN","SPNLRL1",85,0)
 K CNT
"RTN","SPNLRL2")
0^76^B24652075
"RTN","SPNLRL2",1,0)
SPNLRL2 ;SD/WDE - SCD PHARMACY UTILIZATION REPORT (PRINT PART 2 OF 3) ;Nov 22, 2006
"RTN","SPNLRL2",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNLRL2",3,0)
 ;
"RTN","SPNLRL2",4,0)
 ;
"RTN","SPNLRL2",5,0)
 ;
"RTN","SPNLRL2",6,0)
 ;
"RTN","SPNLRL2",7,0)
 ; PAGELEN   Number of lines per page
"RTN","SPNLRL2",8,0)
 ; TITLE     Array of header lines (titles)
"RTN","SPNLRL2",9,0)
P3(TITLE,PAGELEN,QLIST,ABORT) ;
"RTN","SPNLRL2",10,0)
 N NPATS,ZDRUGNR,NAME,FILLS,LCOST,TCOST,COST,QTY,COSTITLE,COSTNODE
"RTN","SPNLRL2",11,0)
 I QLIST("COST")="ACTUAL" D
"RTN","SPNLRL2",12,0)
 . S COSTITLE(1)=" Actual"
"RTN","SPNLRL2",13,0)
 . S COSTITLE(2)="  Cost "
"RTN","SPNLRL2",14,0)
 . S COSTNODE="COST"
"RTN","SPNLRL2",15,0)
 E  D
"RTN","SPNLRL2",16,0)
 . S COSTITLE(1)="Current"
"RTN","SPNLRL2",17,0)
 . S COSTITLE(2)=" Value "
"RTN","SPNLRL2",18,0)
 . S COSTNODE="VAL"
"RTN","SPNLRL2",19,0)
 S TITLE(4)=""
"RTN","SPNLRL2",20,0)
 S TITLE(5)=$$CENTER^SPNLRU("Drugs with fills totaling $"_$FN(QLIST("MINCOST"),",",2)_" or more")
"RTN","SPNLRL2",21,0)
 S TITLE(6)=""
"RTN","SPNLRL2",22,0)
 S TITLE(7)="                                               "_COSTITLE(1)_"                Qty"
"RTN","SPNLRL2",23,0)
 S TITLE(8)="Drug                                           "_COSTITLE(2)_"    Fills      Disp   Pats"
"RTN","SPNLRL2",24,0)
 S CNT=CNT+1  ;rpc
"RTN","SPNLRL2",25,0)
 S ^TMP($J,CNT)="BOS999"_"^EOL999"  ;rpc
"RTN","SPNLRL2",26,0)
 S CNT=CNT+1  ;rpc
"RTN","SPNLRL2",27,0)
 S ^TMP($J,CNT)="HDR999"_U_"Drugs with fills totaling $"_$FN(QLIST("MINCOST"),",",2)_" or more"_"^EOL999"  ;rpc
"RTN","SPNLRL2",28,0)
 D HEADER^SPNLRU(.TITLE,.ABORT) Q:ABORT
"RTN","SPNLRL2",29,0)
 S ZDRUGNR="",(LCOST,TCOST)=0
"RTN","SPNLRL2",30,0)
 F  S ZDRUGNR=$O(^TMP("SPN",$J,"RX","DRUG",ZDRUGNR)) Q:ZDRUGNR=""  D
"RTN","SPNLRL2",31,0)
 . S COST=^TMP("SPN",$J,"RX","DRUG",ZDRUGNR,COSTNODE)
"RTN","SPNLRL2",32,0)
 . S TCOST=TCOST+COST
"RTN","SPNLRL2",33,0)
 . Q:COST<QLIST("MINCOST")
"RTN","SPNLRL2",34,0)
 . S LCOST=LCOST+COST
"RTN","SPNLRL2",35,0)
 . S FILLS=^TMP("SPN",$J,"RX","DRUG",ZDRUGNR)
"RTN","SPNLRL2",36,0)
 . S NPATS=^TMP("SPN",$J,"RX","DRUG",ZDRUGNR,"PAT")
"RTN","SPNLRL2",37,0)
 . S QTY=^TMP("SPN",$J,"RX","DRUG",ZDRUGNR,"QTY")
"RTN","SPNLRL2",38,0)
 . S NAME=^TMP("SPN",$J,"RX","DRUG",ZDRUGNR,"NAME")
"RTN","SPNLRL2",39,0)
 . S ^TMP("SPN",$J,"RX","OUT",-COST,-FILLS,-QTY,-NPATS,NAME)=""
"RTN","SPNLRL2",40,0)
 . S CNT=CNT+1  ;RPC
"RTN","SPNLRL2",41,0)
 . S ^TMP($J,CNT)=NAME_U_COST_U_FILLS_U_QTY_U_NPATS_"^EOL999"  ;rpc
"RTN","SPNLRL2",42,0)
 S COST=""
"RTN","SPNLRL2",43,0)
 F  S COST=$O(^TMP("SPN",$J,"RX","OUT",COST)) Q:COST=""  D  Q:ABORT
"RTN","SPNLRL2",44,0)
 . S FILLS=""
"RTN","SPNLRL2",45,0)
 . F  S FILLS=$O(^TMP("SPN",$J,"RX","OUT",COST,FILLS)) Q:FILLS=""  D  Q:ABORT
"RTN","SPNLRL2",46,0)
 . . S QTY=""
"RTN","SPNLRL2",47,0)
 . . F  S QTY=$O(^TMP("SPN",$J,"RX","OUT",COST,FILLS,QTY)) Q:QTY=""  D  Q:ABORT
"RTN","SPNLRL2",48,0)
 . . . S NPATS=""
"RTN","SPNLRL2",49,0)
 . . . F  S NPATS=$O(^TMP("SPN",$J,"RX","OUT",COST,FILLS,QTY,NPATS)) Q:NPATS=""  D  Q:ABORT
"RTN","SPNLRL2",50,0)
 . . . . S NAME=""
"RTN","SPNLRL2",51,0)
 . . . . F  S NAME=$O(^TMP("SPN",$J,"RX","OUT",COST,FILLS,QTY,NPATS,NAME)) Q:NAME=""  D  Q:ABORT
"RTN","SPNLRL2",52,0)
 . . . . . I $Y>PAGELEN D HEADER^SPNLRU(.TITLE,.ABORT) Q:ABORT
"RTN","SPNLRL2",53,0)
 . . . . . W !,NAME,?40,$J($FN(-COST,",",2),14),?54,$J($FN(-FILLS,","),9),?64,$J($FN(-QTY,","),9),?73,$J($FN(-NPATS,","),7)
"RTN","SPNLRL2",54,0)
 K ^TMP("SPN",$J,"RX","OUT")
"RTN","SPNLRL2",55,0)
 I TCOST=LCOST D
"RTN","SPNLRL2",56,0)
 . I $Y+1>PAGELEN D HEADER^SPNLRU(.TITLE,.ABORT) Q:ABORT
"RTN","SPNLRL2",57,0)
 . W !!,"TOTAL for all drugs",?40,$J($FN(TCOST,",",2),14)
"RTN","SPNLRL2",58,0)
 . S CNT=CNT+1 S ^TMP($J,CNT)="HDR999"_U_"TOTAL for all drugs "_TCOST_"^EOL999"  ;rpc
"RTN","SPNLRL2",59,0)
 E  D
"RTN","SPNLRL2",60,0)
 . I $Y+2>PAGELEN D HEADER^SPNLRU(.TITLE,.ABORT) Q:ABORT
"RTN","SPNLRL2",61,0)
 . W !!,"TOTAL for listed drugs",?40,$J($FN(LCOST,",",2),14)
"RTN","SPNLRL2",62,0)
 . W !,"TOTAL (including unlisted drugs)",?40,$J($FN(TCOST,",",2),14)
"RTN","SPNLRL2",63,0)
 . S CNT=CNT+1 S ^TMP($J,CNT)="BHDR999"_U_"TOTAL for listed drugs "_LCOST_"^EOL999"  ;rpc
"RTN","SPNLRL2",64,0)
 . S CNT=CNT+1 S ^TMP($J,CNT)="BHDR999"_U_"TOTAL (including unlisted drugs) "_TCOST_"^EOL999"  ;rpc
"RTN","SPNLRL2",65,0)
 K TITLE(4),TITLE(5),TITLE(6),TITLE(7),TITLE(8)
"RTN","SPNLRL2",66,0)
 Q
"RTN","SPNLRL2",67,0)
P4(TITLE,PAGELEN,QLIST,ABORT) ;
"RTN","SPNLRL2",68,0)
 N COST,JD,OUT,LINE,STARTLIN,COL,COSTITLE,COSTNODE
"RTN","SPNLRL2",69,0)
 S CNT=CNT+1 S ^TMP($J,CNT)="BOS999"_"^EOL999"  ;rpc
"RTN","SPNLRL2",70,0)
 I QLIST("COST")="ACTUAL" D
"RTN","SPNLRL2",71,0)
 . S COSTITLE="           Dollar Cost    "
"RTN","SPNLRL2",72,0)
X . S COSTNODE="COST"
"RTN","SPNLRL2",73,0)
 . S CNT=CNT+1 S ^TMP($J,CNT)="HDR999"_U_"Dollor Cost"_"^EOL999"  ;rpc
"RTN","SPNLRL2",74,0)
 E  D
"RTN","SPNLRL2",75,0)
 . S COSTITLE="          Dollar Value    "
"RTN","SPNLRL2",76,0)
 . S COSTNODE="VAL"
"RTN","SPNLRL2",77,0)
 . S CNT=CNT+1 S ^TMP($J,CNT)="HDR999"_U_"Dollar Value"_"^EOL999"  ;rpc
"RTN","SPNLRL2",78,0)
 S COST=+$O(^TMP("SPN",$J,"RX",COSTNODE,""))
"RTN","SPNLRL2",79,0)
 F  D  Q:COST=""!(ABORT)
"RTN","SPNLRL2",80,0)
 . D HEADER^SPNLRU(.TITLE,.ABORT) Q:ABORT
"RTN","SPNLRL2",81,0)
 . S STARTLIN=$Y
"RTN","SPNLRL2",82,0)
 . K OUT
"RTN","SPNLRL2",83,0)
 . S OUT(STARTLIN+2)=""
"RTN","SPNLRL2",84,0)
 . F COL=1:1:3 D  Q:COST=""
"RTN","SPNLRL2",85,0)
 . . S OUT(STARTLIN)=$G(OUT(STARTLIN))_COSTITLE
"RTN","SPNLRL2",86,0)
 . . S OUT(STARTLIN+1)=$G(OUT(STARTLIN+1))_"Patients    of Fills      "
"RTN","SPNLRL2",87,0)
 . . S JD=$L($FN(-COST,","))
"RTN","SPNLRL2",88,0)
 . . F LINE=STARTLIN+3:1:PAGELEN D  Q:COST=""
"RTN","SPNLRL2",89,0)
 . . . S NPATS=$G(^TMP("SPN",$J,"RX",COSTNODE,COST))
"RTN","SPNLRL2",90,0)
 . . . S OUT(LINE)=$G(OUT(LINE))_$J($FN(NPATS,","),7)_$J($FN(-COST,","),9)_"-"_$$PAD^SPNLRU($J($FN(-COST+99,","),JD),9-JD)
"RTN","SPNLRL2",91,0)
 . . . ;S CNT=CNT+1 S ^TMP($J,CNT)=$J($FN(NPATS,","),7)_$J($FN(-COST,","),9)_"-"_$$PAD^SPNLRU($J($FN(-COST+99,","),JD),9-JD)
"RTN","SPNLRL2",92,0)
 . . . ;S CNT=CNT+1 S ^TMP($J,CNT)=$FN(NPATS,",")_"^"_$FN(-COST,",")_"-"_$$PAD^SPNLRU($FN(-COST+99,","),JD)_"^EOL999"
"RTN","SPNLRL2",93,0)
 . . . S CNT=CNT+1 S ^TMP($J,CNT)=$FN(NPATS,",")_"^"_$FN(-COST,",")_"-"_$FN(-COST+99,",")_"^EOL999"
"RTN","SPNLRL2",94,0)
 . . . S COST=$O(^TMP("SPN",$J,"RX",COSTNODE,COST))
"RTN","SPNLRL2",95,0)
 . S LINE=""
"RTN","SPNLRL2",96,0)
 . F SPXX=1:1 S LINE=$O(OUT(LINE)) Q:LINE=""  D
"RTN","SPNLRL2",97,0)
 . . W !,OUT(LINE)
"RTN","SPNLRL2",98,0)
 . . ;I SPXX>3 S CNT=CNT+1 S ^TMP($J,CNT)=$P(OUT(LINE)," ",2)_"^"_$P(OUT(LINE)," ",3)_"^EOL999"_OUT(LINE)
"RTN","SPNLRL2",99,0)
 K SPXX
"RTN","SPNLRL2",100,0)
 ;LINE ABOUT WAS S ^TMP($J,CNT)=OUT(LINE)_"^EOL999"
"RTN","SPNLRL2",101,0)
 ;SEE CODE 8 LINES ABOVE OR NEW SETTING
"RTN","SPNLRL2",102,0)
 Q
"RTN","SPNLRL2",103,0)
KILL ;
"RTN","SPNLRL2",104,0)
 K CNT
"RTN","SPNLRL3")
0^77^B16249663
"RTN","SPNLRL3",1,0)
SPNLRL3 ;SD/WDE - SCD PHARMACY UTILIZATION REPORT (PRINT PART 3 OF 3) ;Nov 22, 2006
"RTN","SPNLRL3",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNLRL3",3,0)
 ;
"RTN","SPNLRL3",4,0)
 ;
"RTN","SPNLRL3",5,0)
 ;
"RTN","SPNLRL3",6,0)
 ;
"RTN","SPNLRL3",7,0)
 ; PAGELEN   Number of lines per page
"RTN","SPNLRL3",8,0)
 ; TITLE     Array of header lines (titles)
"RTN","SPNLRL3",9,0)
P5(TITLE,PAGELEN,QLIST,HIUSERS,ABORT) ;
"RTN","SPNLRL3",10,0)
 ; I         High user counter
"RTN","SPNLRL3",11,0)
 ; COST      Cost of the drugs
"RTN","SPNLRL3",12,0)
 ; NDDRUGS   Number of different drugs
"RTN","SPNLRL3",13,0)
 ; FILLS     Number of fills
"RTN","SPNLRL3",14,0)
 ; PID       Patient ID (Coded SSN)
"RTN","SPNLRL3",15,0)
 ; PNAME     Patient Name
"RTN","SPNLRL3",16,0)
 ; PSSN      Patient SSN
"RTN","SPNLRL3",17,0)
 N FILLS,NDDRUGS,COST,PID,PNAME,PSSN,I,HINODE,COSTITLE
"RTN","SPNLRL3",18,0)
 I QLIST("COST")="ACTUAL" D
"RTN","SPNLRL3",19,0)
 . S HINODE="H1"
"RTN","SPNLRL3",20,0)
 . S COSTITLE=" Cost"
"RTN","SPNLRL3",21,0)
 E  D
"RTN","SPNLRL3",22,0)
 . S HINODE="H3"
"RTN","SPNLRL3",23,0)
 . S COSTITLE="Value"
"RTN","SPNLRL3",24,0)
 S TITLE(4)=""
"RTN","SPNLRL3",25,0)
 S TITLE(5)=$$CENTER^SPNLRU("Highest Utilization Patients Based on Fills")
"RTN","SPNLRL3",26,0)
 S TITLE(6)=""
"RTN","SPNLRL3",27,0)
 S TITLE(7)="                                                  Total     Different     Total"
"RTN","SPNLRL3",28,0)
 S TITLE(8)="Patient Name                        SSN           Fills       Drugs       "_COSTITLE
"RTN","SPNLRL3",29,0)
 S CNT=CNT+1 S ^TMP($J,CNT)="BOS999"_"^EOL999"
"RTN","SPNLRL3",30,0)
 S CNT=CNT+1 S ^TMP($J,CNT)="HDR999"_U_"Highest Utilization Patients Based on Fills"_"^EOL999"  ;RPC
"RTN","SPNLRL3",31,0)
 D HEADER^SPNLRU(.TITLE,.ABORT) Q:ABORT
"RTN","SPNLRL3",32,0)
 S FILLS=""
"RTN","SPNLRL3",33,0)
 F I=1:1:HIUSERS S FILLS=$O(^TMP("SPN",$J,"RX","HI",HINODE,FILLS)) Q:FILLS=""  D  Q:ABORT
"RTN","SPNLRL3",34,0)
 . S NDDRUGS=""
"RTN","SPNLRL3",35,0)
 . F  S NDDRUGS=$O(^TMP("SPN",$J,"RX","HI",HINODE,FILLS,NDDRUGS)) Q:NDDRUGS=""  D  Q:ABORT
"RTN","SPNLRL3",36,0)
 . . S COST=""
"RTN","SPNLRL3",37,0)
 . . F  S COST=$O(^TMP("SPN",$J,"RX","HI",HINODE,FILLS,NDDRUGS,COST)) Q:COST=""  D  Q:ABORT
"RTN","SPNLRL3",38,0)
 . . . S PID=""
"RTN","SPNLRL3",39,0)
 . . . F  S PID=$O(^TMP("SPN",$J,"RX","HI",HINODE,FILLS,NDDRUGS,COST,PID)) Q:PID=""  D  Q:ABORT
"RTN","SPNLRL3",40,0)
 . . . . I $Y>PAGELEN D HEADER^SPNLRU(.TITLE,.ABORT) Q:ABORT
"RTN","SPNLRL3",41,0)
 . . . . D GETNAME^SPNLRU(PID,.PNAME,.PSSN)
"RTN","SPNLRL3",42,0)
 . . . . S CNT=CNT+1 S ^TMP($J,CNT)=PNAME_U_PSSN_U_-FILLS_U_-NDDRUGS_U_-COST_"^EOL999"  ;RPC
"RTN","SPNLRL3",43,0)
 . . . . W !,PNAME,?32,PSSN,?45,$J($FN(-FILLS,","),10),?58,$J(-NDDRUGS,8),?68,$J($FN(-COST,",",2),12)
"RTN","SPNLRL3",44,0)
 Q
"RTN","SPNLRL3",45,0)
P6(TITLE,PAGELEN,QLIST,HIUSERS,ABORT) ;
"RTN","SPNLRL3",46,0)
 ; I         High user counter
"RTN","SPNLRL3",47,0)
 ; COST      Cost of the drugs
"RTN","SPNLRL3",48,0)
 ; NDDRUGS   Number of different drugs
"RTN","SPNLRL3",49,0)
 ; FILLS     Number of fills
"RTN","SPNLRL3",50,0)
 ; PID       Patient ID (Coded SSN)
"RTN","SPNLRL3",51,0)
 ; PNAME     Patient Name
"RTN","SPNLRL3",52,0)
 ; PSSN      Patient SSN
"RTN","SPNLRL3",53,0)
 N FILLS,NDDRUGS,COST,PID,PNAME,PSSN,I,HINODE
"RTN","SPNLRL3",54,0)
 S CNT=CNT+1 S ^TMP($J,CNT)="BOS999"_"^EOL999"
"RTN","SPNLRL3",55,0)
 I QLIST("COST")="ACTUAL" D
"RTN","SPNLRL3",56,0)
 . S HINODE="H2"
"RTN","SPNLRL3",57,0)
 . S TITLE(5)=$$CENTER^SPNLRU("Highest Utilization Patients Based on Cost")
"RTN","SPNLRL3",58,0)
 . S CNT=CNT+1 S ^TMP($J,CNT)="HDR999"_U_"Highest Utilization Patients Based on Cost"_"^EOL999"  ;RPC
"RTN","SPNLRL3",59,0)
 E  D
"RTN","SPNLRL3",60,0)
 . S HINODE="H4"
"RTN","SPNLRL3",61,0)
 . S TITLE(5)=$$CENTER^SPNLRU("Highest Utilization Patients Based on Value")
"RTN","SPNLRL3",62,0)
 . S CNT=CNT+1 S ^TMP($J,CNT)="HDR999"_U_"Highest Utilization Patients Based on Value"_"^EOL999"  ;RPC
"RTN","SPNLRL3",63,0)
 D HEADER^SPNLRU(.TITLE,.ABORT) Q:ABORT
"RTN","SPNLRL3",64,0)
 S COST=""
"RTN","SPNLRL3",65,0)
 F I=1:1:HIUSERS S COST=$O(^TMP("SPN",$J,"RX","HI",HINODE,COST)) Q:COST=""  D  Q:ABORT
"RTN","SPNLRL3",66,0)
 . S FILLS=""
"RTN","SPNLRL3",67,0)
 . F  S FILLS=$O(^TMP("SPN",$J,"RX","HI",HINODE,COST,FILLS)) Q:FILLS=""  D  Q:ABORT
"RTN","SPNLRL3",68,0)
 . . S NDDRUGS=""
"RTN","SPNLRL3",69,0)
 . . F  S NDDRUGS=$O(^TMP("SPN",$J,"RX","HI",HINODE,COST,FILLS,NDDRUGS)) Q:NDDRUGS=""  D  Q:ABORT
"RTN","SPNLRL3",70,0)
 . . . S PID=""
"RTN","SPNLRL3",71,0)
 . . . F  S PID=$O(^TMP("SPN",$J,"RX","HI",HINODE,COST,FILLS,NDDRUGS,PID)) Q:PID=""  D  Q:ABORT
"RTN","SPNLRL3",72,0)
 . . . . I $Y>PAGELEN D HEADER^SPNLRU(.TITLE,.ABORT) Q:ABORT
"RTN","SPNLRL3",73,0)
 . . . . D GETNAME^SPNLRU(PID,.PNAME,.PSSN)
"RTN","SPNLRL3",74,0)
 . . . . W !,PNAME,?32,PSSN,?45,$J($FN(-FILLS,","),10),?58,$J(-NDDRUGS,8),?68,$J($FN(-COST,",",2),12)
"RTN","SPNLRL3",75,0)
 . . . . S CNT=CNT+1 S ^TMP($J,CNT)=PNAME_U_PSSN_U_-FILLS_U_-NDDRUGS_U_-COST_"^EOL999"  ;RPC
"RTN","SPNLRL3",76,0)
 K TITLE(4),TITLE(5),TITLE(6),TITLE(7),TITLE(8)
"RTN","SPNLRL3",77,0)
 Q
"RTN","SPNLRL3",78,0)
KILL ;
"RTN","SPNLRL3",79,0)
 K ABORT,CNT,COST,COSTITLE,FILLS,HINODE,HIUSERS,I,NDDRUGS,PAGELEN,PID,PNAME,PSSN,QLIST,TITLE
"RTN","SPNLRL7")
0^31^B3954554
"RTN","SPNLRL7",1,0)
SPNLRL7 ;SD/WDE - Pharmacy Utilization rpt RPC;Jan 12, 2007
"RTN","SPNLRL7",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNLRL7",3,0)
 ;
"RTN","SPNLRL7",4,0)
 ;
"RTN","SPNLRL7",5,0)
 ;
"RTN","SPNLRL7",6,0)
 ;
"RTN","SPNLRL7",7,0)
 ;
"RTN","SPNLRL7",8,0)
 ;FDATE  DATE TO START FROM
"RTN","SPNLRL7",9,0)
 ;TDATE  DATE TO END
"RTN","SPNLRL7",10,0)
 ;COST ACTUAL OR CURRENT
"RTN","SPNLRL7",11,0)
 ;MINCOST Minimum dollar cost of dispensed fills to display:  (0-9999999)
"RTN","SPNLRL7",12,0)
 ;MINFILL Minimum number of fills to display:  (1-999999)
"RTN","SPNLRL7",13,0)
 ;PTLIST  THE LIST OF PATIENTS TO REPORT ON  dfn^dfn^dfn...
"RTN","SPNLRL7",14,0)
 ;HIUSERS Number of highest users to identify:  (0-100)
"RTN","SPNLRL7",15,0)
 ;
"RTN","SPNLRL7",16,0)
 ;
"RTN","SPNLRL7",17,0)
RPC(ROOT,FDATE,TDATE,COST,MINCOST,MINFILL,PTLIST,HIUSERS) ;
"RTN","SPNLRL7",18,0)
 K ^TMP($J)
"RTN","SPNLRL7",19,0)
 K ^TMP("SPN",$J)
"RTN","SPNLRL7",20,0)
DATES ;----------------------------------------------------------------
"RTN","SPNLRL7",21,0)
 ;convert dates to fm style
"RTN","SPNLRL7",22,0)
 ;  ;fdate
"RTN","SPNLRL7",23,0)
 S X=FDATE D ^%DT S FDATE=Y
"RTN","SPNLRL7",24,0)
 ;  ;tdate
"RTN","SPNLRL7",25,0)
 S X=TDATE D ^%DT S TDATE=Y
"RTN","SPNLRL7",26,0)
 ;----------------------------------------------------------------
"RTN","SPNLRL7",27,0)
 S ROOT=$NA(^TMP($J))
"RTN","SPNLRL7",28,0)
 ; cost must to either actual or current
"RTN","SPNLRL7",29,0)
 S QLIST("COST")=COST
"RTN","SPNLRL7",30,0)
 ;Minimum dollar cost of dispensed fills to display:  (0-9999999)
"RTN","SPNLRL7",31,0)
 S QLIST("MINCOST")=MINCOST
"RTN","SPNLRL7",32,0)
 ;Minimum number of fills to display:  (1-999999)
"RTN","SPNLRL7",33,0)
 S QLIST("MINFILL")=MINFILL
"RTN","SPNLRL7",34,0)
 ;Number of highest users to identify:  (0-100)
"RTN","SPNLRL7",35,0)
 S HIUSERS=HIUSERS
"RTN","SPNLRL7",36,0)
 S CNT=0
"RTN","SPNLRL7",37,0)
 S ICN=0 F ZYZ=1:1 S ICN=$G(PTLIST(ZYZ)) Q:ICN=""  D
"RTN","SPNLRL7",38,0)
 .S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNLRL7",39,0)
 .Q:DFN=""
"RTN","SPNLRL7",40,0)
 .D GATHER^SPNLRL(DFN,FDATE,TDATE,HIUSERS,.QLIST)
"RTN","SPNLRL7",41,0)
 .Q
"RTN","SPNLRL7",42,0)
 S (FACNAME,XFDATE,XTDATE,ABORT)=""
"RTN","SPNLRL7",43,0)
 S SPNPAGE=1
"RTN","SPNLRL7",44,0)
 D PRINT^SPNLRL(FACNAME,XFDATE,XTDATE,HIUSERS,.QLIST,ABORT)
"RTN","SPNLRL7",45,0)
 K ABORT,CNT,COST,DFN,FACNAME,FDATE,HIUSERS,ICN,MINCOST,MINFILL,PTLIST,QLIST,SPNPAGE,STR,TDATE,X,XFDATE,XTDATE,Y,ZYZ
"RTN","SPNLRL7",46,0)
 Q
"RTN","SPNLRL7",47,0)
 ;---------------------------------------------------------------
"RTN","SPNLRL7",48,0)
NEWT ;
"RTN","SPNLRL7",49,0)
 ;TEST TAG JUST FOR DAYT42
"RTN","SPNLRL7",50,0)
 S PTLIST(1)=1002651548
"RTN","SPNLRL7",51,0)
 S PTLIST(2)=1002633845
"RTN","SPNLRL7",52,0)
 S PTLIST(3)=1002632389
"RTN","SPNLRL7",53,0)
 S PTLIST(4)=1002636280
"RTN","SPNLRL7",54,0)
 S PTLIST(5)=1005409510
"RTN","SPNLRL7",55,0)
 S PTLIST(6)=1002623561
"RTN","SPNLRL7",56,0)
 S PTLIST(7)=1002654116
"RTN","SPNLRL7",57,0)
 S PTLIST(8)=1002625018
"RTN","SPNLRL7",58,0)
 S PTLIST(9)=1002624576
"RTN","SPNLRL7",59,0)
 S PTLIST(10)=1005547840
"RTN","SPNLRL7",60,0)
 S PTLIST(11)=1002624513
"RTN","SPNLRL7",61,0)
 D RPC(.ROOT,"JAN 1 2004","JAN 3 2004","ACTUAL",10,2,.PTLIST,0)
"RTN","SPNLRL7",62,0)
 Q
"RTN","SPNLRM7")
0^32^B3003178
"RTN","SPNLRM7",1,0)
SPNLRM7 ;SD/WDE - RAD Utilization rpt RPC;JUL 28, 2008
"RTN","SPNLRM7",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNLRM7",3,0)
 ;
"RTN","SPNLRM7",4,0)
 ;
"RTN","SPNLRM7",5,0)
 ;
"RTN","SPNLRM7",6,0)
 ;
"RTN","SPNLRM7",7,0)
 ;
"RTN","SPNLRM7",8,0)
 ;FDATE  DATE TO START FROM
"RTN","SPNLRM7",9,0)
 ;TDATE  DATE TO END
"RTN","SPNLRM7",10,0)
 ;COST ACTUAL OR CURRENT
"RTN","SPNLRM7",11,0)
 ;MINCOST Minimum dollar cost of dispensed fills to display:  (0-9999999)
"RTN","SPNLRM7",12,0)
 ;MINFILL Minimum number of fills to display:  (1-999999)
"RTN","SPNLRM7",13,0)
 ;PTLIST  THE LIST OF PATIENTS TO REPORT ON  ICN^ICN^ICN....
"RTN","SPNLRM7",14,0)
 ;HIUSERS Number of highest users to identify:  (0-100)
"RTN","SPNLRM7",15,0)
 ;
"RTN","SPNLRM7",16,0)
 ;
"RTN","SPNLRM7",17,0)
RPC(ROOT,FDATE,TDATE,MINPROC,MINCOST,HIUSERS,PTLIST) ;
"RTN","SPNLRM7",18,0)
 K ^TMP($J)
"RTN","SPNLRM7",19,0)
 K ^TMP("SPN",$J)
"RTN","SPNLRM7",20,0)
DATES ;----------------------------------------------------------------
"RTN","SPNLRM7",21,0)
 ;convert dates to fm style
"RTN","SPNLRM7",22,0)
 ;  ;fdate
"RTN","SPNLRM7",23,0)
 S X=FDATE D ^%DT S FDATE=Y
"RTN","SPNLRM7",24,0)
 ;  ;tdate
"RTN","SPNLRM7",25,0)
 S X=TDATE D ^%DT S TDATE=Y
"RTN","SPNLRM7",26,0)
 ;----------------------------------------------------------------
"RTN","SPNLRM7",27,0)
 S ROOT=$NA(^TMP($J))
"RTN","SPNLRM7",28,0)
 ;Minimum dollar cost of dispensed fills to display:  (0-9999999)
"RTN","SPNLRM7",29,0)
 S QLIST("MINCOST")=MINCOST
"RTN","SPNLRM7",30,0)
 ;Minimum number of fills to display:  (1-999999)
"RTN","SPNLRM7",31,0)
 S QLIST("MINNUM")=MINPROC
"RTN","SPNLRM7",32,0)
 ;Number of highest users to identify:  (0-100)
"RTN","SPNLRM7",33,0)
 S HIUSERS=HIUSERS
"RTN","SPNLRM7",34,0)
 S CNT=0
"RTN","SPNLRM7",35,0)
 S ICN=0 F ZYZ=1:1 S ICN=$G(PTLIST(ZYZ)) Q:ICN=""  D
"RTN","SPNLRM7",36,0)
 .S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNLRM7",37,0)
 .Q:$G(DFN)=""
"RTN","SPNLRM7",38,0)
 .D ROLLUP^SPNLGRRA(DFN,FDATE,TDATE,HIUSERS) ; gather radiology data
"RTN","SPNLRM7",39,0)
 .Q
"RTN","SPNLRM7",40,0)
 D NAMEIT^SPNLGRRA
"RTN","SPNLRM7",41,0)
 D P1^SPNLRM8
"RTN","SPNLRM7",42,0)
 D P2^SPNLRM8
"RTN","SPNLRM7",43,0)
 D P3^SPNLRM8
"RTN","SPNLRM7",44,0)
 I HIUSERS D
"RTN","SPNLRM7",45,0)
 . D P4^SPNLRM9
"RTN","SPNLRM7",46,0)
 . D P5^SPNLRM9
"RTN","SPNLRM7",47,0)
 . Q
"RTN","SPNLRM7",48,0)
 K ABORT,CNT,COST,DFN,FACNAME,FDATE,HIUSERS,ICN,MINCOST,MINFILL,PTLIST,QLIST,SPNPAGE,STR,TDATE,X,XFDATE,XTDATE,Y,ZYZ
"RTN","SPNLRM7",49,0)
 Q
"RTN","SPNLRM7",50,0)
 ;---------------------------------------------------------------
"RTN","SPNLRM7",51,0)
SS ;JUST USED TO SET UP DFNS FOR TESTING
"RTN","SPNLRM7",52,0)
 S STR="",DFN="" F X=1:1:20 S DFN=$O(^SPNL(154,DFN)) Q:DFN=""  D
"RTN","SPNLRM7",53,0)
 .S STR=STR_"^"_DFN
"RTN","SPNLRM7",54,0)
 Q
"RTN","SPNLRM8")
0^78^B23501774
"RTN","SPNLRM8",1,0)
SPNLRM8 ;SD/WDE - SCD RADIOLOGY UTILIZATION REPORT (RPC PART 1 OF 2) ;Nov 24, 2006
"RTN","SPNLRM8",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNLRM8",3,0)
P1 ;
"RTN","SPNLRM8",4,0)
 ; CPTCODE   Code of radiology procedure
"RTN","SPNLRM8",5,0)
 ; NPROCS    Number of procedures
"RTN","SPNLRM8",6,0)
 ; NDPROCS   Number of different procedures
"RTN","SPNLRM8",7,0)
 N NPROCS,NDPROCS,CPTCODE,OUT,LINE,STARTLIN,COL,NPATS
"RTN","SPNLRM8",8,0)
 S CNT=0
"RTN","SPNLRM8",9,0)
 S NPROCS=+$G(^TMP("SPN",$J,"RA","EXAMS"))
"RTN","SPNLRM8",10,0)
 S NPATS=+$G(^TMP("SPN",$J,"RA","PAT"))
"RTN","SPNLRM8",11,0)
 S CNT=CNT+1
"RTN","SPNLRM8",12,0)
 S ^TMP($J,CNT)="BOS999"_U_"Totals:  "_$FN(NPROCS,",")_" procedure"_$S(NPROCS=1:"",1:"s")_" reported for "_$FN(NPATS,",")_" patient"_$S(NPATS=1:"",1:"s")_"^EOL999"
"RTN","SPNLRM8",13,0)
 S CNT=CNT+1 S ^TMP($J,CNT)="HDR999"_U_"Patients"_U_"Procedures"_"^EOL999"
"RTN","SPNLRM8",14,0)
 S CPTCODE=""
"RTN","SPNLRM8",15,0)
 F NDPROCS=0:1 S CPTCODE=$O(^TMP("SPN",$J,"RA","PROC",CPTCODE)) Q:CPTCODE=""
"RTN","SPNLRM8",16,0)
 I NDPROCS=1&(NPROCS>1) S CNT=CNT+1 S ^TMP($J,CNT)="(This includes just one type of procedure)"_"^EOL999"
"RTN","SPNLRM8",17,0)
 I NDPROCS>1 S CNT=CNT+1 S ^TMP($J,CNT)="HDR999"_U_"(These include "_$FN(NDPROCS,",")_" different procedures)"_"^EOL999"
"RTN","SPNLRM8",18,0)
 S NPROCS=+$O(^TMP("SPN",$J,"RA","EXAMS",""))
"RTN","SPNLRM8",19,0)
 F  D  Q:NPROCS=""
"RTN","SPNLRM8",20,0)
 . S CNT=CNT+1
"RTN","SPNLRM8",21,0)
 . S ^TMP($J,CNT)=$G(^TMP("SPN",$J,"RA","EXAMS",NPROCS))_U_-NPROCS_"^EOL999"
"RTN","SPNLRM8",22,0)
 . S NPROCS=$O(^TMP("SPN",$J,"RA","EXAMS",NPROCS))
"RTN","SPNLRM8",23,0)
 . Q
"RTN","SPNLRM8",24,0)
 Q
"RTN","SPNLRM8",25,0)
P2 ;
"RTN","SPNLRM8",26,0)
 N NPATS,NPROCS,CPTCODE,NAME,COST
"RTN","SPNLRM8",27,0)
 ;S TITLE(5)=$$CENTER^SPNLRU($FN(QLIST("MINNUM"),",")_" or More Procedures")
"RTN","SPNLRM8",28,0)
 ;S TITLE(6)=""
"RTN","SPNLRM8",29,0)
 ;S TITLE(7)="Radiology Procedure                  CPT Code    Procedures    Value    Patients"
"RTN","SPNLRM8",30,0)
 S CPTCODE=""
"RTN","SPNLRM8",31,0)
 S CNT=CNT+1
"RTN","SPNLRM8",32,0)
 S ^TMP($J,CNT)="BOS999"_U_QLIST("MINNUM")_" or More Procedures"_"^EOL999"
"RTN","SPNLRM8",33,0)
 S CNT=CNT+1
"RTN","SPNLRM8",34,0)
 S ^TMP($J,CNT)="HDR999"_U_"Radiology Procedure"_U_"CPT Code"_U_"Procedures"_U_"Value"_U_"Patients"_"^EOL999"
"RTN","SPNLRM8",35,0)
 F  S CPTCODE=$O(^TMP("SPN",$J,"RA","PROC",CPTCODE)) Q:CPTCODE=""  D
"RTN","SPNLRM8",36,0)
 . S NPROCS=^TMP("SPN",$J,"RA","PROC",CPTCODE)
"RTN","SPNLRM8",37,0)
 . Q:NPROCS<QLIST("MINNUM")
"RTN","SPNLRM8",38,0)
 . S COST=^TMP("SPN",$J,"RA","PROC",CPTCODE,"VAL")
"RTN","SPNLRM8",39,0)
 . S NPATS=^TMP("SPN",$J,"RA","PROC",CPTCODE,"PAT")
"RTN","SPNLRM8",40,0)
 . S NAME=^TMP("SPN",$J,"RA","PROC",CPTCODE,"NAME")
"RTN","SPNLRM8",41,0)
 . S ^TMP("SPN",$J,"RA","OUT",-NPROCS,-COST,-NPATS,NAME)=CPTCODE
"RTN","SPNLRM8",42,0)
 S NPROCS=""
"RTN","SPNLRM8",43,0)
 F  S NPROCS=$O(^TMP("SPN",$J,"RA","OUT",NPROCS)) Q:NPROCS=""  D
"RTN","SPNLRM8",44,0)
 . S COST=""
"RTN","SPNLRM8",45,0)
 . F  S COST=$O(^TMP("SPN",$J,"RA","OUT",NPROCS,COST)) Q:COST=""  D
"RTN","SPNLRM8",46,0)
 . . S NPATS=""
"RTN","SPNLRM8",47,0)
 . . F  S NPATS=$O(^TMP("SPN",$J,"RA","OUT",NPROCS,COST,NPATS)) Q:NPATS=""  D
"RTN","SPNLRM8",48,0)
 . . . S NAME=""
"RTN","SPNLRM8",49,0)
 . . . F  S NAME=$O(^TMP("SPN",$J,"RA","OUT",NPROCS,COST,NPATS,NAME)) Q:NAME=""  D
"RTN","SPNLRM8",50,0)
 . . . . S CPTCODE=^TMP("SPN",$J,"RA","OUT",NPROCS,COST,NPATS,NAME)
"RTN","SPNLRM8",51,0)
 . . . . S CNT=CNT+1 S ^TMP($J,CNT)=NAME_U_$S(CPTCODE=0:"",1:$J(CPTCODE,5))_U_-NPROCS_U_-COST_U_-NPATS_"^EOL999"
"RTN","SPNLRM8",52,0)
 K ^TMP("SPN",$J,"RA","OUT")
"RTN","SPNLRM8",53,0)
 K TITLE(4),TITLE(5),TITLE(6),TITLE(7)
"RTN","SPNLRM8",54,0)
 Q
"RTN","SPNLRM8",55,0)
P3 ;
"RTN","SPNLRM8",56,0)
 N NPATS,NAME,NPROCS,LCOST,TCOST,COST,CPTCODE
"RTN","SPNLRM8",57,0)
 S CNT=CNT+1 S ^TMP($J,CNT)="BOS999"_U_"Radiology procedures totaling $"_QLIST("MINCOST")_" or more"_"^EOL999"
"RTN","SPNLRM8",58,0)
 S TITLE(6)=""
"RTN","SPNLRM8",59,0)
 S TITLE(7)="Radiology Procedure                  CPT Code      Value   Procedures   Patients"
"RTN","SPNLRM8",60,0)
 S CNT=CNT+1 S ^TMP($J,CNT)="HDR999"_U_"Radiology Procedure"_U_"CPT Code"_U_"Value"_U_"Procedures"_U_"Patients"_"^EOL999"
"RTN","SPNLRM8",61,0)
 S CPTCODE="",(LCOST,TCOST)=0
"RTN","SPNLRM8",62,0)
 F  S CPTCODE=$O(^TMP("SPN",$J,"RA","PROC",CPTCODE)) Q:CPTCODE=""  D
"RTN","SPNLRM8",63,0)
 . S COST=^TMP("SPN",$J,"RA","PROC",CPTCODE,"VAL")
"RTN","SPNLRM8",64,0)
 . S TCOST=TCOST+COST
"RTN","SPNLRM8",65,0)
 . Q:COST<QLIST("MINCOST")
"RTN","SPNLRM8",66,0)
 . S LCOST=LCOST+COST
"RTN","SPNLRM8",67,0)
 . S NPROCS=^TMP("SPN",$J,"RA","PROC",CPTCODE)
"RTN","SPNLRM8",68,0)
 . S NPATS=^TMP("SPN",$J,"RA","PROC",CPTCODE,"PAT")
"RTN","SPNLRM8",69,0)
 . S NAME=^TMP("SPN",$J,"RA","PROC",CPTCODE,"NAME")
"RTN","SPNLRM8",70,0)
 . S ^TMP("SPN",$J,"RA","OUT",-COST,-NPROCS,-NPATS,NAME)=CPTCODE
"RTN","SPNLRM8",71,0)
 S COST=""
"RTN","SPNLRM8",72,0)
 F  S COST=$O(^TMP("SPN",$J,"RA","OUT",COST)) Q:COST=""  D
"RTN","SPNLRM8",73,0)
 . S NPROCS=""
"RTN","SPNLRM8",74,0)
 . F  S NPROCS=$O(^TMP("SPN",$J,"RA","OUT",COST,NPROCS)) Q:NPROCS=""  D
"RTN","SPNLRM8",75,0)
 . . S NPATS=""
"RTN","SPNLRM8",76,0)
 . . F  S NPATS=$O(^TMP("SPN",$J,"RA","OUT",COST,NPROCS,NPATS)) Q:NPATS=""  D
"RTN","SPNLRM8",77,0)
 . . . S NAME=""
"RTN","SPNLRM8",78,0)
 . . . F  S NAME=$O(^TMP("SPN",$J,"RA","OUT",COST,NPROCS,NPATS,NAME)) Q:NAME=""  D
"RTN","SPNLRM8",79,0)
 . . . . S CPTCODE=^TMP("SPN",$J,"RA","OUT",COST,NPROCS,NPATS,NAME)
"RTN","SPNLRM8",80,0)
 . . . . S CNT=CNT+1 S ^TMP($J,CNT)=NAME_U_$S(CPTCODE=0:"",1:$J(CPTCODE,5))_U_-COST_U_-NPROCS_U_-NPATS_"^EOL999"
"RTN","SPNLRM8",81,0)
 K ^TMP("SPN",$J,"RA","OUT")
"RTN","SPNLRM8",82,0)
 I TCOST=LCOST D
"RTN","SPNLRM8",83,0)
 . S CNT=CNT+1 S ^TMP($J,CNT)="BHDR999"_U_"TOTAL for all procedures "_TCOST_"^EOL999"
"RTN","SPNLRM8",84,0)
 E  D
"RTN","SPNLRM8",85,0)
 . S CNT=CNT+1 S ^TMP($J,CNT)="BHDR999"_U_"TOTAL for all procedures "_LCOST_"^EOL999"
"RTN","SPNLRM8",86,0)
 . S CNT=CNT+1 S ^TMP($J,CNT)="BHDR999"_U_"TOTAL (including unlisted procedures) "_TCOST_"^EOL999"
"RTN","SPNLRM8",87,0)
 K TITLE(4),TITLE(5),TITLE(6),TITLE(7)
"RTN","SPNLRM8",88,0)
 Q
"RTN","SPNLRM8",89,0)
KILL ;
"RTN","SPNLRM8",90,0)
 K ABORT,CNT,COST,DFN,FACNAME,FDATE,HIUSERS,ICN,MINCOST,MINFILL,PTLIST,QLIST,SPNPAGE,STR,TDATE,X,XFDATE,XTDATE,Y,ZYZ
"RTN","SPNLRM8",91,0)
 K TITLE(4),TITLE
"RTN","SPNLRM9")
0^79^B9152833
"RTN","SPNLRM9",1,0)
SPNLRM9 ;SD/WDE - SCD RADIOLOGY UTILIZATION REPORT (RPC PART 2 OF 2) ;Nov 24, 2006
"RTN","SPNLRM9",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNLRM9",3,0)
 ;
"RTN","SPNLRM9",4,0)
 ;
"RTN","SPNLRM9",5,0)
 ;
"RTN","SPNLRM9",6,0)
 ;
"RTN","SPNLRM9",7,0)
 ;
"RTN","SPNLRM9",8,0)
 ;
"RTN","SPNLRM9",9,0)
 ; PAGELEN   Number of lines per page
"RTN","SPNLRM9",10,0)
 ; TITLE     Array of header lines (titles)
"RTN","SPNLRM9",11,0)
P4 ;
"RTN","SPNLRM9",12,0)
 ; I         High user counter
"RTN","SPNLRM9",13,0)
 ; COST      Cost of the procedures
"RTN","SPNLRM9",14,0)
 ; NDPROCS   Number of different procedures
"RTN","SPNLRM9",15,0)
 ; NPROCS    Number of procedures
"RTN","SPNLRM9",16,0)
 ; PID       Patient ID (Coded SSN)
"RTN","SPNLRM9",17,0)
 ; PNAME     Patient Name
"RTN","SPNLRM9",18,0)
 ; PSSN      Patient SSN
"RTN","SPNLRM9",19,0)
 N NPROCS,NDPROCS,COST,PID,PNAME,PSSN,I
"RTN","SPNLRM9",20,0)
 S CNT=CNT+1 S ^TMP($J,CNT)="BOS999"_U_"Highest Utilization Patients Based on Number of Procedures"_"^EOL999"
"RTN","SPNLRM9",21,0)
 S CNT=CNT+1 S ^TMP($J,CNT)="HDR999"_U_"Patient Name"_U_"SSN"_U_"Total Procedures"_U_"Different Procedures"_U_"Total Value"_"^EOL999"
"RTN","SPNLRM9",22,0)
 S REPHDR=$G(^TMP($J,CNT))
"RTN","SPNLRM9",23,0)
 S NPROCS=""
"RTN","SPNLRM9",24,0)
 F I=1:1:HIUSERS S NPROCS=$O(^TMP("SPN",$J,"RA","HI","H1",NPROCS)) Q:NPROCS=""  D
"RTN","SPNLRM9",25,0)
 . S NDPROCS=""
"RTN","SPNLRM9",26,0)
 . F  S NDPROCS=$O(^TMP("SPN",$J,"RA","HI","H1",NPROCS,NDPROCS)) Q:NDPROCS=""  D
"RTN","SPNLRM9",27,0)
 . . S COST=""
"RTN","SPNLRM9",28,0)
 . . F  S COST=$O(^TMP("SPN",$J,"RA","HI","H1",NPROCS,NDPROCS,COST)) Q:COST=""  D
"RTN","SPNLRM9",29,0)
 . . . S PID=""
"RTN","SPNLRM9",30,0)
 . . . F  S PID=$O(^TMP("SPN",$J,"RA","HI","H1",NPROCS,NDPROCS,COST,PID)) Q:PID=""  D
"RTN","SPNLRM9",31,0)
 . . . . D GETNAME^SPNLRU(PID,.PNAME,.PSSN)
"RTN","SPNLRM9",32,0)
 . . . . S CNT=CNT+1 S ^TMP($J,CNT)=PNAME_U_PSSN_U_-NPROCS_U_-NDPROCS_U_-COST_"^EOL999"
"RTN","SPNLRM9",33,0)
 Q
"RTN","SPNLRM9",34,0)
P5 ;
"RTN","SPNLRM9",35,0)
 ; I         High user counter
"RTN","SPNLRM9",36,0)
 ; COST      Cost of the procedures
"RTN","SPNLRM9",37,0)
 ; NDPROCS   Number of different procedures
"RTN","SPNLRM9",38,0)
 ; NPROCS    Number of procedures
"RTN","SPNLRM9",39,0)
 ; PID       Patient ID (Coded SSN)
"RTN","SPNLRM9",40,0)
 ; PNAME     Patient Name
"RTN","SPNLRM9",41,0)
 ; PSSN      Patient SSN
"RTN","SPNLRM9",42,0)
 N NPROCS,NDPROCS,COST,PID,PNAME,PSSN,I
"RTN","SPNLRM9",43,0)
 S CNT=CNT+1 S ^TMP($J,CNT)="BOS999"_U_"Highest Utilization Patients Based on Value"_"^EOL999"
"RTN","SPNLRM9",44,0)
 S CNT=CNT+1 S ^TMP($J,CNT)=REPHDR  ;See above for header value
"RTN","SPNLRM9",45,0)
 S COST=""
"RTN","SPNLRM9",46,0)
 F I=1:1:HIUSERS S COST=$O(^TMP("SPN",$J,"RA","HI","H2",COST)) Q:COST=""  D
"RTN","SPNLRM9",47,0)
 . S NPROCS=""
"RTN","SPNLRM9",48,0)
 . F  S NPROCS=$O(^TMP("SPN",$J,"RA","HI","H2",COST,NPROCS)) Q:NPROCS=""  D
"RTN","SPNLRM9",49,0)
 . . S NDPROCS=""
"RTN","SPNLRM9",50,0)
 . . F  S NDPROCS=$O(^TMP("SPN",$J,"RA","HI","H2",COST,NPROCS,NDPROCS)) Q:NDPROCS=""  D
"RTN","SPNLRM9",51,0)
 . . . S PID=""
"RTN","SPNLRM9",52,0)
 . . . F  S PID=$O(^TMP("SPN",$J,"RA","HI","H2",COST,NPROCS,NDPROCS,PID)) Q:PID=""  D
"RTN","SPNLRM9",53,0)
 . . . . D GETNAME^SPNLRU(PID,.PNAME,.PSSN)
"RTN","SPNLRM9",54,0)
 . . . . S CNT=CNT+1 S ^TMP($J,CNT)=PNAME_U_PSSN_U_-NPROCS_U_-NDPROCS_U_-COST_"^EOL999"
"RTN","SPNLRM9",55,0)
 K TITLE(4),TITLE(5),TITLE(6),TITLE(7),TITLE(8)
"RTN","SPNLRM9",56,0)
 Q
"RTN","SPNLRM9",57,0)
KILL ;
"RTN","SPNLRM9",58,0)
 ;CALLED FROM SUB ROUTINE
"RTN","SPNLRM9",59,0)
 K ABORT,CNT,COST,DFN,FACNAME,FDATE,HIUSERS,ICN,MINCOST,MINFILL,PTLIST,QLIST,SPNPAGE,STR,TDATE,X,XFDATE,XTDATE,Y,ZYZ
"RTN","SPNLRM9",60,0)
 K REPHDR,TITLE
"RTN","SPNLRR7")
0^33^B9512592
"RTN","SPNLRR7",1,0)
SPNLRR7 ;SD/WDE Laboratory Utilization rpt specific RPC;JUL 23, 2008
"RTN","SPNLRR7",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNLRR7",3,0)
 ;
"RTN","SPNLRR7",4,0)
 ;
"RTN","SPNLRR7",5,0)
RPC(ROOT,FDATE,TDATE,HIUSERS,VALUES,PTLIST) ;
"RTN","SPNLRR7",6,0)
 K ^TMP("SPN",$J)
"RTN","SPNLRR7",7,0)
 K ^TMP($J)
"RTN","SPNLRR7",8,0)
 S ROOT=$NA(^TMP($J))
"RTN","SPNLRR7",9,0)
DATES ;----------------------------------------------------------------
"RTN","SPNLRR7",10,0)
 ;convert dates to fm style
"RTN","SPNLRR7",11,0)
 S X=FDATE D ^%DT S FDATE=Y  ;fdate
"RTN","SPNLRR7",12,0)
 S X=TDATE D ^%DT S TDATE=Y  ;tdate
"RTN","SPNLRR7",13,0)
 D BQLIST  ;unload the values in values
"RTN","SPNLRR7",14,0)
 ;-------------------------------------------------------------
"RTN","SPNLRR7",15,0)
 S CNT=0
"RTN","SPNLRR7",16,0)
 S ICN=0 F ZYZ=1:1 S ICN=$G(PTLIST(ZYZ)) Q:ICN=""  D COL
"RTN","SPNLRR7",17,0)
 K ^TMP($J)
"RTN","SPNLRR7",18,0)
 S CNT=0
"RTN","SPNLRR7",19,0)
 I HIUSERS=0 D P1  ;resort data
"RTN","SPNLRR7",20,0)
 I HIUSERS=1 D P2  ;resort data
"RTN","SPNLRR7",21,0)
 Q
"RTN","SPNLRR7",22,0)
COL ;
"RTN","SPNLRR7",23,0)
 ;*****************************
"RTN","SPNLRR7",24,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNLRR7",25,0)
 Q:$G(DFN)=""
"RTN","SPNLRR7",26,0)
 ;*****************************
"RTN","SPNLRR7",27,0)
 D SELECT^SPNLGSCH(DFN,FDATE,TDATE,HIUSERS,.QLIST) ; gather lab test data
"RTN","SPNLRR7",28,0)
 ;Tag RPC is called by a Remote procedure
"RTN","SPNLRR7",29,0)
 ;   fdate = from date
"RTN","SPNLRR7",30,0)
 ;   tdate = to date
"RTN","SPNLRR7",31,0)
 ;   hiusers = report on hi users
"RTN","SPNLRR7",32,0)
 ;   qlist = array that has the LAB TEST names and numbers
"RTN","SPNLRR7",33,0)
 ;   ptlist = patient list array
"RTN","SPNLRR7",34,0)
 ;   abort = true or false abort yes no
"RTN","SPNLRR7",35,0)
 Q
"RTN","SPNLRR7",36,0)
 ;---------------------------------------------------------------
"RTN","SPNLRR7",37,0)
P1 ;
"RTN","SPNLRR7",38,0)
 S CNT=0
"RTN","SPNLRR7",39,0)
 S TESTNR="" ; create list in test name order
"RTN","SPNLRR7",40,0)
 F  S TESTNR=$O(QLIST(TESTNR)) Q:TESTNR=""  D
"RTN","SPNLRR7",41,0)
 . S LABTEST(QLIST(TESTNR))=TESTNR
"RTN","SPNLRR7",42,0)
 S TESTNAME=""
"RTN","SPNLRR7",43,0)
 F  S TESTNAME=$O(LABTEST(TESTNAME)) Q:TESTNAME=""  D
"RTN","SPNLRR7",44,0)
 . S TESTNR=LABTEST(TESTNAME)
"RTN","SPNLRR7",45,0)
 . S RESULTS=+$G(^TMP("SPN",$J,"CH","TEST",TESTNR))
"RTN","SPNLRR7",46,0)
 . S NPATS=+$G(^TMP("SPN",$J,"CH","TEST",TESTNR,"PAT"))
"RTN","SPNLRR7",47,0)
 . S CNT=CNT+1 S ^TMP($J,CNT)=TESTNAME_U_NPATS_U_RESULTS_"^EOL999"
"RTN","SPNLRR7",48,0)
 Q
"RTN","SPNLRR7",49,0)
 ;----------------------------------------------------------------------
"RTN","SPNLRR7",50,0)
P2 ;USAGE DATA IS YES  HIUSERS=1
"RTN","SPNLRR7",51,0)
 S TESTNR="" ; create list in test name order
"RTN","SPNLRR7",52,0)
 F  S TESTNR=$O(QLIST(TESTNR)) Q:TESTNR=""  D
"RTN","SPNLRR7",53,0)
 . S LABTEST(QLIST(TESTNR))=TESTNR
"RTN","SPNLRR7",54,0)
 S TESTNAME=""
"RTN","SPNLRR7",55,0)
 F  S TESTNAME=$O(LABTEST(TESTNAME)) Q:TESTNAME=""  D
"RTN","SPNLRR7",56,0)
 . S TESTNR=LABTEST(TESTNAME)
"RTN","SPNLRR7",57,0)
 . S RESULTS=+$G(^TMP("SPN",$J,"CH","TEST",TESTNR))
"RTN","SPNLRR7",58,0)
 . S NPATS=+$G(^TMP("SPN",$J,"CH","TEST",TESTNR,"PAT"))
"RTN","SPNLRR7",59,0)
 . S CNT=CNT+1 S ^TMP($J,CNT)="BOS999"_U_TESTNAME_U_NPATS_U_RESULTS_"^EOL999"
"RTN","SPNLRR7",60,0)
 . S PID=""
"RTN","SPNLRR7",61,0)
 . F  S PID=$O(^TMP("SPN",$J,"CH","TEST",TESTNR,"PID",PID)) Q:(PID="")  D
"RTN","SPNLRR7",62,0)
 . . S PNAME=$P(PID,U,1),PSSN=$P(PID,U,2)
"RTN","SPNLRR7",63,0)
 . . S RESULTS=+$G(^TMP("SPN",$J,"CH","TEST",TESTNR,"PID",PID))
"RTN","SPNLRR7",64,0)
 . . S CNT=CNT+1 S ^TMP($J,CNT)=PNAME_U_PSSN_U_RESULTS_"^EOL999"
"RTN","SPNLRR7",65,0)
 . .Q
"RTN","SPNLRR7",66,0)
 .Q
"RTN","SPNLRR7",67,0)
 Q
"RTN","SPNLRR7",68,0)
KILL ;
"RTN","SPNLRR7",69,0)
 K ABORT,CNT,COST,DFN,FACNAME,FDATE,HIUSERS,ICN,MINCOST,MINFILL,PTLIST,QLIST,SPNPAGE,STR,TDATE,X,XFDATE,XTDATE,Y,ZYZ
"RTN","SPNLRR7",70,0)
 K PID,DRGNAM,NPATS,TESTNR,TESTNAME,VALUE,AA,DRGNUM,LABTEST,PNAM,PSSN,TESTPTS,VAL,XYZZ,ZZ,ZZA,PNAME,RESULTS
"RTN","SPNLRR7",71,0)
 ;==================================================================
"RTN","SPNLRR7",72,0)
BQLIST ;TESTIEN;TESTNAME^TESTIEN;TESTNAME
"RTN","SPNLRR7",73,0)
 F ZZA=1:1 S VAL=$G(VALUES(ZZA)) Q:VAL=""  D
"RTN","SPNLRR7",74,0)
 .S DRGNUM=$P(VAL,";",1)
"RTN","SPNLRR7",75,0)
 .S DRGNAM=$P(VAL,";",2)
"RTN","SPNLRR7",76,0)
 .S QLIST(DRGNUM)=DRGNAM
"RTN","SPNLRR7",77,0)
 .Q
"RTN","SPNLRR7",78,0)
 Q
"RTN","SPNLRS7")
0^34^B19321322
"RTN","SPNLRS7",1,0)
SPNLRS7 ;SD/WDE - Pharmacy Utilization rpt specific RPC;JUL 01, 2008
"RTN","SPNLRS7",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNLRS7",3,0)
 ;
"RTN","SPNLRS7",4,0)
 ;
"RTN","SPNLRS7",5,0)
 ;INTEGRATION REFERENCE #4533  ZERO^PSS50
"RTN","SPNLRS7",6,0)
 ;
"RTN","SPNLRS7",7,0)
 ;
"RTN","SPNLRS7",8,0)
RPC(ROOT,FDATE,TDATE,HIUSERS,VALUES,PTLIST)  ;
"RTN","SPNLRS7",9,0)
 ;
"RTN","SPNLRS7",10,0)
 K ^TMP("SPN",$J)
"RTN","SPNLRS7",11,0)
 K ^TMP($J)
"RTN","SPNLRS7",12,0)
 S ROOT=$NA(^TMP($J))
"RTN","SPNLRS7",13,0)
 K VAL,QTY,QLIST,PRICE,PATCNT,ICN,I,DRUGNAM,DRUGIEN,DFN,CVALUE,CQTY,CNT
"RTN","SPNLRS7",14,0)
 ;K SPNXXX  ;WDE
"RTN","SPNLRS7",15,0)
DATES ;----------------------------------------------------------------
"RTN","SPNLRS7",16,0)
 ;convert dates to fm style
"RTN","SPNLRS7",17,0)
 S X=FDATE D ^%DT S FDATE=Y  ;fdate
"RTN","SPNLRS7",18,0)
 S X=TDATE D ^%DT S TDATE=Y  ;tdate
"RTN","SPNLRS7",19,0)
 D BQLIST  ;unload the values in values
"RTN","SPNLRS7",20,0)
 ;-------------------------------------------------------------
"RTN","SPNLRS7",21,0)
 S CNT=0
"RTN","SPNLRS7",22,0)
 S ROOT=$NA(^TMP($J))
"RTN","SPNLRS7",23,0)
 S ICN=0 F ZYZ=1:1 S ICN=$G(PTLIST(ZYZ)) Q:ICN=""  D COL
"RTN","SPNLRS7",24,0)
 S ROOT=$NA(^TMP($J))
"RTN","SPNLRS7",25,0)
 D PRICEIT^SPNLGSRX ; get unit prices (cost) for the drugs
"RTN","SPNLRS7",26,0)
 D RESORT
"RTN","SPNLRS7",27,0)
 Q
"RTN","SPNLRS7",28,0)
COL ;
"RTN","SPNLRS7",29,0)
 ;***************************************
"RTN","SPNLRS7",30,0)
 Q:ICN=""
"RTN","SPNLRS7",31,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNLRS7",32,0)
 Q:$G(DFN)=""
"RTN","SPNLRS7",33,0)
 ;***************************************
"RTN","SPNLRS7",34,0)
 D SELECT^SPNLGSRX(DFN,FDATE,TDATE,HIUSERS,.QLIST) ; gather pharmacy data
"RTN","SPNLRS7",35,0)
 ;Tag RPC is called by a Remote procedure
"RTN","SPNLRS7",36,0)
 ;   fdate = from date
"RTN","SPNLRS7",37,0)
 ;   tdate = to date
"RTN","SPNLRS7",38,0)
 ;   hiusers = report on hi users
"RTN","SPNLRS7",39,0)
 ;   qlist = array that has the drug names and numbers
"RTN","SPNLRS7",40,0)
 ;   ptlist = patient list array
"RTN","SPNLRS7",41,0)
 ;   abort = true or false abort yes no
"RTN","SPNLRS7",42,0)
 Q
"RTN","SPNLRS7",43,0)
 ;---------------------------------------------------------------
"RTN","SPNLRS7",44,0)
RESORT ;
"RTN","SPNLRS7",45,0)
 ;we need to rebuild the ^tmp("spn",$j into a format for JAVA
"RTN","SPNLRS7",46,0)
 ;
"RTN","SPNLRS7",47,0)
 D BQLIST2
"RTN","SPNLRS7",48,0)
 S DRUGIEN=0 F  S DRUGIEN=$O(^TMP("SPN",$J,"RX","DRUG",DRUGIEN)) Q:DRUGIEN=""  D
"RTN","SPNLRS7",49,0)
 .;S DRUGNAM=$P($G(^PSDRUG(DRUGIEN,0)),U,1) ;OLD BEFORE CALL TO API DATA^PSS50
"RTN","SPNLRS7",50,0)
 .D DATA^PSS50(DRUGIEN,,,,,"SPN")
"RTN","SPNLRS7",51,0)
 .S DRUGNAM=$G(^TMP($J,"SPN",DRUGIEN,.01))
"RTN","SPNLRS7",52,0)
 .K ^TMP($J,"SPN")
"RTN","SPNLRS7",53,0)
 .;======================================
"RTN","SPNLRS7",54,0)
 .;Get price node
"RTN","SPNLRS7",55,0)
 .S PRICE=$G(^TMP("SPN",$J,"RX","DRUG",DRUGIEN,"PRICE"))
"RTN","SPNLRS7",56,0)
 .;patient count for this drug
"RTN","SPNLRS7",57,0)
 .S PATCNT=$G(^TMP("SPN",$J,"RX","DRUG",DRUGIEN,"PAT"))
"RTN","SPNLRS7",58,0)
 .;Quantity
"RTN","SPNLRS7",59,0)
 .S QTY=$G(^TMP("SPN",$J,"RX","DRUG",DRUGIEN,"QTY"))
"RTN","SPNLRS7",60,0)
 .;TOTAL FILLS
"RTN","SPNLRS7",61,0)
 .S TOTFILLS=$G(^TMP("SPN",$J,"RX","DRUG",DRUGIEN))
"RTN","SPNLRS7",62,0)
 .S ATCOST=PRICE*QTY
"RTN","SPNLRS7",63,0)
 .;S CNT=CNT+1 S ^TMP($J,CNT)="BOR999"_U_DRUGNAM_U_PRICE_U_PATCNT_U_TOTFILLS_U_QTY_U_PRICE*QTY_"^EOL999"
"RTN","SPNLRS7",64,0)
 .S CNT=CNT+1 S ^TMP($J,CNT)="BOS999"_U_DRUGNAM_U_PRICE_U_PATCNT_U_TOTFILLS_U_QTY_U_ATCOST_"^EOL999"
"RTN","SPNLRS7",65,0)
 .;S CNT=CNT+1 S ^TMP($J,CNT)="BOS999"_U_DRUGNAM_U_PRICE_U_0_U_PATCNT_"^EOL999"
"RTN","SPNLRS7",66,0)
 .;======================================
"RTN","SPNLRS7",67,0)
 .;patient loop
"RTN","SPNLRS7",68,0)
 .S PATID="" F  S PATID=$O(^TMP("SPN",$J,"RX","DRUG",DRUGIEN,"PID",PATID)) Q:PATID=""  D
"RTN","SPNLRS7",69,0)
 ..S CQTY=$P(^TMP("SPN",$J,"RX","DRUG",DRUGIEN,"PID",PATID),"^",2),CVALUE=CQTY*PRICE
"RTN","SPNLRS7",70,0)
 ..S CNT=CNT+1 S ^TMP($J,CNT)=PATID_U_$G(^TMP("SPN",$J,"RX","DRUG",DRUGIEN,"PID",PATID))_"^"_$J(CVALUE,".",2)_"^EOL999"
"RTN","SPNLRS7",71,0)
 ..Q
"RTN","SPNLRS7",72,0)
 .Q
"RTN","SPNLRS7",73,0)
 Q
"RTN","SPNLRS7",74,0)
KILL ;
"RTN","SPNLRS7",75,0)
 ;
"RTN","SPNLRS7",76,0)
 K ^TMP("SPN",$J)
"RTN","SPNLRS7",77,0)
 K ABORT,CNT,COST,DFN,FACNAME,FDATE,HIUSERS,ICN,MINCOST,MINFILL,PTLIST,QLIST,SPNPAGE,STR,TDATE,X,XFDATE,XTDATE,Y,ZYZ
"RTN","SPNLRS7",78,0)
 K PID,DRGNAM,NPATS,TESTNR,TESTNAME,VALUE,AA,DRGNUM,LABTEST,PNAM,PSSN,TESTPTS,VAL,XYZZ,ZZ,ZZA,PNAME,RESULTS,PATCNT
"RTN","SPNLRS7",79,0)
 K PRICE,TOTFILLS,CQTY,ATCOST,TOTFILLS,DRUGIEN,PATID,RPTID ;,SPNXX
"RTN","SPNLRS7",80,0)
BQLIST ;276;ASPIRIN 300MG TAB^868;IBUPROFEN 600MG TAB
"RTN","SPNLRS7",81,0)
 ;       QLIST(IEN)=DRUG NAME
"RTN","SPNLRS7",82,0)
 ;       QLIST(276)=ASPIRIN 300MG TAB
"RTN","SPNLRS7",83,0)
 ;       QLIST(868)=IBUPROFEN 600MG TAB
"RTN","SPNLRS7",84,0)
 S ZZA=0
"RTN","SPNLRS7",85,0)
 F ZZA=1:1 S VAL=$G(VALUES(ZZA)) Q:VAL=""  D
"RTN","SPNLRS7",86,0)
 .S DRGNUM=$P(VAL,";",1)
"RTN","SPNLRS7",87,0)
 .S DRGNAM=$P(VAL,";",2)
"RTN","SPNLRS7",88,0)
 .S QLIST(DRGNUM)=DRGNAM
"RTN","SPNLRS7",89,0)
 .Q
"RTN","SPNLRS7",90,0)
 Q
"RTN","SPNLRS7",91,0)
BQLIST2 ;
"RTN","SPNLRS7",92,0)
 ;S SPXXX=0 
"RTN","SPNLRS7",93,0)
 S ZZA=0
"RTN","SPNLRS7",94,0)
 F ZZA=1:1 S DRGNUM=$G(VALUES(ZZA)) Q:DRGNUM=""  D
"RTN","SPNLRS7",95,0)
 .S DRGNUM=$P(DRGNUM,";",1)
"RTN","SPNLRS7",96,0)
 .I '$D(^TMP("SPN",$J,"RX","DRUG",DRGNUM)) D
"RTN","SPNLRS7",97,0)
 ..S ^TMP("SPN",$J,"RX","DRUG",DRGNUM)=0
"RTN","SPNLRS7",98,0)
 ..S ^TMP("SPN",$J,"RX","DRUG",DRGNUM,"PAT")=0
"RTN","SPNLRS7",99,0)
 ..S ^TMP("SPN",$J,"RX","DRUG",DRGNUM,"PRICE")=0
"RTN","SPNLRS7",100,0)
 ..S ^TMP("SPN",$J,"RX","DRUG",DRGNUM,"QTY")=0
"RTN","SPNLRS7",101,0)
 Q
"RTN","SPNLRS7",102,0)
NEWT ;NEW TEST DAYT42 1/5/2007 working
"RTN","SPNLRS7",103,0)
 K ^TMP($J) K ^TMP("SPN",$J) K VALUES,QLIST,PTLIST
"RTN","SPNLRS7",104,0)
 S VALUES(1)="342;ACETAMINOPHEN W/CODEINE 30 MG TAB (EA)"
"RTN","SPNLRS7",105,0)
 S VALUES(2)="1649;IBUPROFEN 600MG TAB"
"RTN","SPNLRS7",106,0)
 S VALUES(3)="5911;MORPHINE 100MG SR TAB"
"RTN","SPNLRS7",107,0)
 S PTLIST(1)=1002657188
"RTN","SPNLRS7",108,0)
 S PTLIST(2)=1002630943
"RTN","SPNLRS7",109,0)
 S PTLIST(3)=1002627882
"RTN","SPNLRS7",110,0)
 S PTLIST(4)=1011238640
"RTN","SPNLRS7",111,0)
 S PTLIST(5)=1010567933
"RTN","SPNLRS7",112,0)
 S PTLIST(6)=1002623842
"RTN","SPNLRS7",113,0)
 S PTLIST(7)=1005409510
"RTN","SPNLRS7",114,0)
 S PTLIST(8)=1002632242
"RTN","SPNLRS7",115,0)
 S PTLIST(9)=1002630369
"RTN","SPNLRS7",116,0)
 ;01/01/2005 to 07/31/2005
"RTN","SPNLRS7",117,0)
 D RPC(.ROOT,"01/01/2005","07/31/2005",1,.VALUES,.PTLIST)
"RTN","SPNRPC03")
0^36^B10552423
"RTN","SPNRPC03",1,0)
SPNRPC03 ;SD/WDE - Nutrition Dietary Precautions RPC;JUL 28, 2008
"RTN","SPNRPC03",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNRPC03",3,0)
 ;
"RTN","SPNRPC03",4,0)
 ; References to ^FHPT supported by IA# 4920
"RTN","SPNRPC03",5,0)
 ; Reference to ^FH(119.4 supported by IA# 2319
"RTN","SPNRPC03",6,0)
 ; Reference to ^FH(115.4 supported by IA# 5457
"RTN","SPNRPC03",7,0)
 ; THIS FILE IS NO LONGER ACCESSED: [Requested IA to ^FH(118.2]
"RTN","SPNRPC03",8,0)
 ;
"RTN","SPNRPC03",9,0)
RPC(ROOT,SDATE,EDATE,ICN) ;
"RTN","SPNRPC03",10,0)
 ;parms
"RTN","SPNRPC03",11,0)
 ;
"RTN","SPNRPC03",12,0)
 ; FDATE   = DATE TO START FROM
"RTN","SPNRPC03",13,0)
 ; TDATE   = DATE TO GO TO
"RTN","SPNRPC03",14,0)
 ; ICN     = ICN
"RTN","SPNRPC03",15,0)
 ;
"RTN","SPNRPC03",16,0)
BLD ;  TEMPJUMP IN LINE TAG
"RTN","SPNRPC03",17,0)
 K ^TMP($J)
"RTN","SPNRPC03",18,0)
 S ROOT=$NA(^TMP($J))
"RTN","SPNRPC03",19,0)
 S CNT=0
"RTN","SPNRPC03",20,0)
 S X=SDATE S %DT="T" D ^%DT S SDATE=Y
"RTN","SPNRPC03",21,0)
 S X=EDATE S %DT="T" D ^%DT S EDATE=Y
"RTN","SPNRPC03",22,0)
 D PT
"RTN","SPNRPC03",23,0)
 D STATUS
"RTN","SPNRPC03",24,0)
 S CNT=CNT+1
"RTN","SPNRPC03",25,0)
 S ^TMP($J,"UTIL",CNT)="EOR999"_U_"EOL999"
"RTN","SPNRPC03",26,0)
 K %DT,CLINICNA,SHOWDT,X,Y,APPTDT,CL,CLIEN,CLINIC,CLINICS,CLLIST,DFN,FDATE,FILTER,ICN
"RTN","SPNRPC03",27,0)
 K DIETIEN,SDATE,EDATE,RSTDT,TFENT,TFIEN,DIETDT,CNT
"RTN","SPNRPC03",28,0)
 K D1,D2,DISPDT
"RTN","SPNRPC03",29,0)
 Q
"RTN","SPNRPC03",30,0)
 ;-------------------------------------------------------------
"RTN","SPNRPC03",31,0)
PT ;
"RTN","SPNRPC03",32,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNRPC03",33,0)
 Q:DFN=""  ;NO ICN ON FILE
"RTN","SPNRPC03",34,0)
 S DIETIEN=0 F  S DIETIEN=$O(^FHPT(DFN,"A",DIETIEN)) Q:(DIETIEN="")!('+DIETIEN)  D
"RTN","SPNRPC03",35,0)
 .D CHECK
"RTN","SPNRPC03",36,0)
 Q
"RTN","SPNRPC03",37,0)
CHECK ;
"RTN","SPNRPC03",38,0)
 ;Check if diet is date range
"RTN","SPNRPC03",39,0)
 ; if ok build the top of the record
"RTN","SPNRPC03",40,0)
 S DIETDT=$P($G(^FHPT(DFN,"A",DIETIEN,0)),U,1)
"RTN","SPNRPC03",41,0)
 I $P(DIETDT,".",1)<SDATE Q
"RTN","SPNRPC03",42,0)
 I $P(DIETDT,".",1)>EDATE Q
"RTN","SPNRPC03",43,0)
 S Y=DIETDT X ^DD("DD") S DISPDT=Y
"RTN","SPNRPC03",44,0)
 S CNT=CNT+1
"RTN","SPNRPC03",45,0)
 S D1=$P($G(^FHPT(DFN,"A",DIETIEN,0)),U,10)  ;isolation/precaution
"RTN","SPNRPC03",46,0)
 I D1'="" S D1=$P($G(^FH(119.4,D1,0)),U,1)
"RTN","SPNRPC03",47,0)
 S D2=$P($G(^FHPT(DFN,"A",DIETIEN,0)),U,13)  ;OE/RR isolation order
"RTN","SPNRPC03",48,0)
 S ^TMP($J,"UTIL",CNT)="BOR999"_U_DISPDT_U_D1_U_D2_U_"EOL999"
"RTN","SPNRPC03",49,0)
 ;now check the tube feeding data
"RTN","SPNRPC03",50,0)
 D TUBFEED
"RTN","SPNRPC03",51,0)
 Q
"RTN","SPNRPC03",52,0)
TUBFEED ;--------------------------------------------------------------
"RTN","SPNRPC03",53,0)
 S TFIEN=0 F  S TFIEN=$O(^FHPT(DFN,"A",DIETIEN,"TF",TFIEN)) Q:(TFIEN="")!('+TFIEN)  D
"RTN","SPNRPC03",54,0)
 .S Y=$P($G(^FHPT(DFN,"A",DIETIEN,"TF",TFIEN,0)),U,1)
"RTN","SPNRPC03",55,0)
 .X ^DD("DD") S D1=Y  ;Tubefeeding date
"RTN","SPNRPC03",56,0)
 .S CNT=CNT+1
"RTN","SPNRPC03",57,0)
 .S ^TMP($J,"UTIL",CNT)="BOSTUBEFEEDING999"_U_D1_U_"EOL999"
"RTN","SPNRPC03",58,0)
 .S TFENT=0 F  S TFENT=$O(^FHPT(DFN,"A",DIETIEN,"TF",TFIEN,"P",TFENT)) Q:(TFENT="")!('+TFENT)  D
"RTN","SPNRPC03",59,0)
 ..S Y=$P($G(^FHPT(DFN,"A",DIETIEN,"TF",TFIEN,0)),1)
"RTN","SPNRPC03",60,0)
 ..X ^DD("DD") S D1=Y  ;Tubefeeding date
"RTN","SPNRPC03",61,0)
 ..;JAS 07/18/08 Modifications due to IA Issues found during SQA Checklist
"RTN","SPNRPC03",62,0)
 ..;S D2=$P($G(^FHPT(DFN,"A",DIETIEN,"TF",TFIEN,"P",TFENT,0)),U,1)
"RTN","SPNRPC03",63,0)
 ..;S D2=$P($G(^FH(118.2,D2,0)),U,1)
"RTN","SPNRPC03",64,0)
 ..S D2=$$GET1^DIQ(115.1,TFENT_","_TFIEN_","_DIETIEN_","_DFN,.01)
"RTN","SPNRPC03",65,0)
 ..S CNT=CNT+1
"RTN","SPNRPC03",66,0)
 ..S ^TMP($J,"UTIL",CNT)=D2_U_"EOL999"
"RTN","SPNRPC03",67,0)
 Q
"RTN","SPNRPC03",68,0)
 ;-----------------------------------------------------------------
"RTN","SPNRPC03",69,0)
STATUS ;Get the status node data.  Note that it's not tied to the admission
"RTN","SPNRPC03",70,0)
 S CNT=CNT+1
"RTN","SPNRPC03",71,0)
 S ^TMP($J,"UTIL",CNT)="BOSSTATUS999"_U_"EOL999"
"RTN","SPNRPC03",72,0)
 Q:DFN=""
"RTN","SPNRPC03",73,0)
 ;JAS 03/03/08 - DEFECT 1124 - Modification to allow Status to be retrieved
"RTN","SPNRPC03",74,0)
 ;Q:$G(^FHPT(DFN,"S"))'>0
"RTN","SPNRPC03",75,0)
 Q:'$D(^FHPT(DFN,"S"))
"RTN","SPNRPC03",76,0)
 S RSTDT=0 F  S RSTDT=$O(^FHPT(DFN,"S",RSTDT)) Q:(RSTDT="")!('+RSTDT)  D
"RTN","SPNRPC03",77,0)
 .S Y=$P($G(^FHPT(DFN,"S",RSTDT,0)),U,1)
"RTN","SPNRPC03",78,0)
 .Q:$P(Y,".",1)<SDATE
"RTN","SPNRPC03",79,0)
 .Q:$P(Y,".",1)>EDATE
"RTN","SPNRPC03",80,0)
 .X ^DD("DD") S D1=Y
"RTN","SPNRPC03",81,0)
 .S D2=$P($G(^FHPT(DFN,"S",RSTDT,0)),U,2) S D2=$P($G(^FH(115.4,D2,0)),U,1)_" "_$P($G(^FH(115.4,D2,0)),U,2)
"RTN","SPNRPC03",82,0)
 .S CNT=CNT+1
"RTN","SPNRPC03",83,0)
 .S ^TMP($J,"UTIL",CNT)=D1_U_D2_U_"EOL999"
"RTN","SPNRPC03",84,0)
 .Q
"RTN","SPNRPC03",85,0)
 Q
"RTN","SPNRPC1")
0^37^B17718596
"RTN","SPNRPC1",1,0)
SPNRPC1 ;SD/WDE- Routine to list basic Patient data;DEC 26, 2006
"RTN","SPNRPC1",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNRPC1",3,0)
 ;
"RTN","SPNRPC1",4,0)
 ; RPC: SPN GET VADPT DATA
"RTN","SPNRPC1",5,0)
 ;
"RTN","SPNRPC1",6,0)
 ;        INTEGRATION REFERENCE INQUIRY #4938 FOR ICN
"RTN","SPNRPC1",7,0)
 ;    INTEGRATION REFERENCE INQUIRY #10061
"RTN","SPNRPC1",8,0)
 ;    Refer to this link for documentation on the vadpt calls / return values
"RTN","SPNRPC1",9,0)
 ;    http://www.va.gov/vdl/documents/Clinical/Admis_Disch_Transfer_(ADT)/pimstm.doc
"RTN","SPNRPC1",10,0)
 ;
"RTN","SPNRPC1",11,0)
 ;
"RTN","SPNRPC1",12,0)
COL(ROOT,SPN1DFN,ICN) ;
"RTN","SPNRPC1",13,0)
 K ^TMP($J)
"RTN","SPNRPC1",14,0)
 S ROOT=$NA(^TMP($J))
"RTN","SPNRPC1",15,0)
 ;JAS 01-15-2008 PUGET ERROR TRAP-DEFECT 1058 (ADDED NEXT LINE)
"RTN","SPNRPC1",16,0)
 I SPN1DFN=""&($G(ICN)="") Q
"RTN","SPNRPC1",17,0)
 ;**************************************
"RTN","SPNRPC1",18,0)
 I $G(ICN) D
"RTN","SPNRPC1",19,0)
 .S SPN2DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNRPC1",20,0)
 I $G(ICN) I $G(SPN2DFN)="" S ^TMP($J,1)="COULD NOT MATCH UP ICN WITH A DFN" K KILL Q
"RTN","SPNRPC1",21,0)
 ;**************************************
"RTN","SPNRPC1",22,0)
 I $G(ICN) I $G(SPN1DFN) I $G(SPN2DFN) I SPN1DFN'=DFN S ^TMP($J,1)="DFN AND ICN ARE NOT MATCHED" D KILL Q
"RTN","SPNRPC1",23,0)
 I $G(ICN)="" S DFN=SPN1DFN
"RTN","SPNRPC1",24,0)
ALL ;
"RTN","SPNRPC1",25,0)
 K VA,VADM,VAHOW
"RTN","SPNRPC1",26,0)
 D DEM^VADPT
"RTN","SPNRPC1",27,0)
 I VAERR=1 S ^TMP($J,999999999)="VADPT RETURNED AN ERROR" D KILL Q
"RTN","SPNRPC1",28,0)
 S SPNCNT=1
"RTN","SPNRPC1",29,0)
 S SPNICN=$$GET1^DIQ(2,DFN_",",991.01,"E")
"RTN","SPNRPC1",30,0)
 S ^TMP($J,SPNCNT)="VA(ICN)^"_SPNICN_"^EOL999"
"RTN","SPNRPC1",31,0)
 S SPNCNT=SPNCNT+1 S ^TMP($J,SPNCNT)="BOS VADM^EOL999"
"RTN","SPNRPC1",32,0)
 S ^TMP($J,SPNCNT)="VA(BID)^"_$G(VA("BID"))_"^EOL999"
"RTN","SPNRPC1",33,0)
 K VA("BID")
"RTN","SPNRPC1",34,0)
 S SPNCNT=SPNCNT+1 S ^TMP($J,SPNCNT)="VA(PID)^"_$G(VA("PID"))_"^EOL999"
"RTN","SPNRPC1",35,0)
 S SPNSUB=0 F SPNSUB=1,2,3,4,5,6,7,8,9,10 D
"RTN","SPNRPC1",36,0)
 .S SPNCNT=SPNCNT+1
"RTN","SPNRPC1",37,0)
 .S ^TMP($J,SPNCNT)="VADM("_SPNSUB_")^"_$G(VADM(SPNSUB))_"^EOL999"
"RTN","SPNRPC1",38,0)
 .Q
"RTN","SPNRPC1",39,0)
 K VA("PID")
"RTN","SPNRPC1",40,0)
 S SPNCNT=SPNCNT+1 S ^TMP($J,SPNCNT)="VADM(11)^"_$G(VADM(11))_"^EOL999"
"RTN","SPNRPC1",41,0)
 S SPNSUB=0 F  S SPNSUB=$O(VADM(11,SPNSUB)) Q:(SPNSUB="")!('+SPNSUB)  D
"RTN","SPNRPC1",42,0)
 .S SPNCNT=SPNCNT+1 S ^TMP($J,SPNCNT)="VADM(11,"_SPNSUB_")^"_$G(VADM(11,SPNSUB))_"^EOL999"
"RTN","SPNRPC1",43,0)
 .Q
"RTN","SPNRPC1",44,0)
 S SPNCNT=SPNCNT+1 S ^TMP($J,SPNCNT)="VADM(12)^"_$G(VADM(12))_"^EOL999"
"RTN","SPNRPC1",45,0)
 S SPNSUB=0 F  S SPNSUB=$O(VADM(12,SPNSUB)) Q:(SPNSUB="")!('+SPNSUB)  D
"RTN","SPNRPC1",46,0)
 .S SPNCNT=SPNCNT+1 S ^TMP($J,SPNCNT)="VADM(12,"_SPNSUB_")^"_$G(VADM(12,SPNSUB))_"^EOL999" D
"RTN","SPNRPC1",47,0)
 ..S SPNSUBB=0 F  S SPNSUBB=$O(VADM(12,SPNSUB,SPNSUBB)) Q:(SPNSUBB="")!('+SPNSUBB)  D
"RTN","SPNRPC1",48,0)
 ...S SPNCNT=SPNCNT+1 S ^TMP($J,SPNCNT)="VADM(12,"_SPNSUB_","_SPNSUBB_")^"_$G(VADM(12,SPNSUB,SPNSUBB))_"^EOL999"
"RTN","SPNRPC1",49,0)
 ...Q
"RTN","SPNRPC1",50,0)
 ;ELI
"RTN","SPNRPC1",51,0)
 K VADM
"RTN","SPNRPC1",52,0)
 D ELIG^VADPT
"RTN","SPNRPC1",53,0)
 S SPNCNT=SPNCNT+1 S ^TMP($J,SPNCNT)="BOS VAEL^EOL999"
"RTN","SPNRPC1",54,0)
 S SPNCNT=SPNCNT+1 S ^TMP($J,SPNCNT)="VAEL(1)^"_$G(VAEL(1))_"^EOL999"
"RTN","SPNRPC1",55,0)
 S SPNSUB=0 F  S SPNSUB=$O(VAEL(1,SPNSUB)) Q:(SPNSUB="")!('+SPNSUB)  D
"RTN","SPNRPC1",56,0)
 .S SPNCNT=SPNCNT+1 S ^TMP($J,SPNCNT)="VAEL,1,"_SPNSUB_")^"_$G(VAEL(1,SPNSUB))_"^EOL999"
"RTN","SPNRPC1",57,0)
 .Q
"RTN","SPNRPC1",58,0)
 S SPNSUB=0 F SPNSUB=2,3,4 D
"RTN","SPNRPC1",59,0)
 .S SPNCNT=SPNCNT+1
"RTN","SPNRPC1",60,0)
 .S ^TMP($J,SPNCNT)="VAEL("_SPNSUB_")^"_$G(VAEL(SPNSUB))_"^EOL999"
"RTN","SPNRPC1",61,0)
 S SPNCNT=SPNCNT+1 S ^TMP($J,SPNCNT)="VAEL(5)^"_$G(VAEL(5))_"^EOL999"
"RTN","SPNRPC1",62,0)
 S SPNSUB=0 F  S SPNSUB=$O(VAEL(5,SPNSUB)) Q:(SPNSUB="")!('+SPNSUB)  D
"RTN","SPNRPC1",63,0)
 .S SPNCNT=SPNCNT+1 S ^TMP($J,SPNCNT)="VAEL(5,"_SPNSUB_")^"_$G(VAEL(5,SPNSUB))_"^EOL999"
"RTN","SPNRPC1",64,0)
 .Q
"RTN","SPNRPC1",65,0)
 S SPNSUB=0 F SPNSUB=6,7,8,9 D
"RTN","SPNRPC1",66,0)
 .S SPNCNT=SPNCNT+1
"RTN","SPNRPC1",67,0)
 .S ^TMP($J,SPNCNT)="VAEL("_SPNSUB_")^"_$G(VAEL(SPNSUB))_"^EOL999"
"RTN","SPNRPC1",68,0)
 K VAEL
"RTN","SPNRPC1",69,0)
 S VAPA("P")=""
"RTN","SPNRPC1",70,0)
 D ADD^VADPT
"RTN","SPNRPC1",71,0)
 S SPNCNT=SPNCNT+1 S ^TMP($J,SPNCNT)="BOS VAPA^EOL999"
"RTN","SPNRPC1",72,0)
 S SPNSUB=0 F SPNSUB=1:1:21 D
"RTN","SPNRPC1",73,0)
 .S SPNCNT=SPNCNT+1
"RTN","SPNRPC1",74,0)
 .S ^TMP($J,SPNCNT)="VAPA("_SPNSUB_")^"_$G(VAPA(SPNSUB))_"^EOL999"
"RTN","SPNRPC1",75,0)
 .Q
"RTN","SPNRPC1",76,0)
 S SPNSUB=0 F  S SPNSUB=$O(VAPA(22,SPNSUB)) Q:(SPNSUB="")!('+SPNSUB)  D
"RTN","SPNRPC1",77,0)
 .S SPNCNT=SPNCNT+1 S ^TMP($J,SPNCNT)="VAPA(22,"_SPNSUB_")^"_$G(VAPA(22,SPNSUB))_"^EOL999"
"RTN","SPNRPC1",78,0)
 .Q
"RTN","SPNRPC1",79,0)
 ;RUN THE SAME CALL BUT BRING BACK THE TEMP ADDRESS AND DATES
"RTN","SPNRPC1",80,0)
 K VAPA
"RTN","SPNRPC1",81,0)
 D ADD^VADPT
"RTN","SPNRPC1",82,0)
 S SPNSUB=0 F SPNSUB=1:1:10 D
"RTN","SPNRPC1",83,0)
 .S SPNCNT=SPNCNT+1
"RTN","SPNRPC1",84,0)
 .S ^TMP($J,SPNCNT)="VAPA_TEMP_ADDRESS("_SPNSUB_")^"_$G(VAPA(SPNSUB))_"^EOL999"
"RTN","SPNRPC1",85,0)
 K VAPA
"RTN","SPNRPC1",86,0)
 ;OTHER RELATED DATA
"RTN","SPNRPC1",87,0)
 ;Returns other pertinent patient data which is commonly used but not contained in any other calls to VADPT.
"RTN","SPNRPC1",88,0)
 D OPD^VADPT
"RTN","SPNRPC1",89,0)
 S SPNCNT=SPNCNT+1
"RTN","SPNRPC1",90,0)
 S ^TMP($J,SPNCNT)="BOS VAPD^EOL999"
"RTN","SPNRPC1",91,0)
 S SPNSUB=0 F SPNSUB=1:1:7 D
"RTN","SPNRPC1",92,0)
 .S SPNCNT=SPNCNT+1
"RTN","SPNRPC1",93,0)
 .S ^TMP($J,SPNCNT)="VAPD("_SPNSUB_")^"_$G(VAPD(SPNSUB))_"^EOL999"
"RTN","SPNRPC1",94,0)
 .;JAS 01-24-08 DEFECT 834 (NEXT LINE)
"RTN","SPNRPC1",95,0)
 .I SPNSUB=7,$P(^TMP($J,SPNCNT),"^",2)=9 S $P(^TMP($J,SPNCNT),"^",3)="UNKNOWN"
"RTN","SPNRPC1",96,0)
 .Q
"RTN","SPNRPC1",97,0)
 K VAPD
"RTN","SPNRPC1",98,0)
KILL ;
"RTN","SPNRPC1",99,0)
 K SPNCNT,SPNSUB,SPNSUBB,VAERR,SPNDFN,ICN,DFN
"RTN","SPNRPC1",100,0)
 K SPN2DFN,SPNICN  ;WDE
"RTN","SPNRPC1",101,0)
 Q
"RTN","SPNRPC10")
0^38^B2838928
"RTN","SPNRPC10",1,0)
SPNRPC10 ;SD/WDE - Returns CPT'S BEFORE onset;JUL 23, 2008
"RTN","SPNRPC10",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNRPC10",3,0)
 ;
"RTN","SPNRPC10",4,0)
 ;
"RTN","SPNRPC10",5,0)
 ;
"RTN","SPNRPC10",6,0)
 ;
"RTN","SPNRPC10",7,0)
COL(ROOT,ICN,UPTODATE) ;
"RTN","SPNRPC10",8,0)
 ;Gets ALL CPTS FOR IMPAIRMENTS TAB
"RTN","SPNRPC10",9,0)
 ;  Input:
"RTN","SPNRPC10",10,0)
 ;  DFN=DFN
"RTN","SPNRPC10",11,0)
 ;  note that I first collect all from spnrpc4 then cut out
"RTN","SPNRPC10",12,0)
 ;  the un-wanted codes and trim the file from the beginning 
"RTN","SPNRPC10",13,0)
 ;  of time to the outcomes date.
"RTN","SPNRPC10",14,0)
 ;exclude this series in the gathering
"RTN","SPNRPC10",15,0)
 K ^TMP($J)
"RTN","SPNRPC10",16,0)
 S ROOT=$NA(^TMP($J))
"RTN","SPNRPC10",17,0)
 S SPNCUTDT=2
"RTN","SPNRPC10",18,0)
 S CNT=0
"RTN","SPNRPC10",19,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNRPC10",20,0)
 Q:DFN=""  ;NO ICN FOR PATIENT
"RTN","SPNRPC10",21,0)
 ;
"RTN","SPNRPC10",22,0)
JUMPTO ;
"RTN","SPNRPC10",23,0)
 D JUMPIN1^SPNRPC4
"RTN","SPNRPC10",24,0)
 ;clean out ICD'S from TMP($J,"UTIL"
"RTN","SPNRPC10",25,0)
 K ^TMP($J,"UTIL","ICD")
"RTN","SPNRPC10",26,0)
 K ^TMP($J,"CPT")
"RTN","SPNRPC10",27,0)
 K ^TMP($J,"ICD")
"RTN","SPNRPC10",28,0)
 S X=UPTODATE D ^%DT S UPTODATE=Y
"RTN","SPNRPC10",29,0)
 I $G(Y)="-1" K ^TMP($J) S ^TMP($J,1)="Invalid Date Error" Q
"RTN","SPNRPC10",30,0)
 ;clean out the un wanted CPT'S
"RTN","SPNRPC10",31,0)
 ;
"RTN","SPNRPC10",32,0)
BUILD ;Build temp with only the ones needed
"RTN","SPNRPC10",33,0)
 S SUBCNT=0
"RTN","SPNRPC10",34,0)
 S X34=0 F  S X34=$O(^TMP($J,"UTIL","CPT",X34)) Q:(X34="")!('+X34)  S X35=0 F  S X35=$O(^TMP($J,"UTIL","CPT",X34,X35)) Q:(X35="")!('+X35)  D
"RTN","SPNRPC10",35,0)
 .S SPNTEST=$P($G(^TMP($J,"UTIL","CPT",X34,X35)),U,3)
"RTN","SPNRPC10",36,0)
 .S SPNTEST=$P(SPNTEST,"@",1)
"RTN","SPNRPC10",37,0)
 .S X=SPNTEST D ^%DT S SPNTEST=Y
"RTN","SPNRPC10",38,0)
 .I SPNTEST>UPTODATE Q
"RTN","SPNRPC10",39,0)
 .S SUBCNT=SUBCNT+1
"RTN","SPNRPC10",40,0)
 .S ^TMP($J,SUBCNT)=$G(^TMP($J,"UTIL","CPT",X34,X35))_U_"EOL999"
"RTN","SPNRPC10",41,0)
 K ^TMP($J,"UTIL")
"RTN","SPNRPC10",42,0)
 K ^TMP($J,"ICD")
"RTN","SPNRPC10",43,0)
 K SPNCUTDT,CNT,DFN,X,Y,G,X34,X35,SPNTEST,SUBCNT,UPTODATE
"RTN","SPNRPC10",44,0)
 Q
"RTN","SPNRPC13")
0^39^B19205247
"RTN","SPNRPC13",1,0)
SPNRPC13 ;SD/WDE - RPC ADMISSIONS REPORT BY DATE RANGE;JUN 11, 2009
"RTN","SPNRPC13",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNRPC13",3,0)
 ;
"RTN","SPNRPC13",4,0)
 ; Reference to ^DGPM("B" supported by IA# 92
"RTN","SPNRPC13",5,0)
 ; References to ^DGPM(D0,0 supported by IA# 4942
"RTN","SPNRPC13",6,0)
 ; Reference to file 2, field .01 supported by IA# 998
"RTN","SPNRPC13",7,0)
 ; Reference to file 2, field 57.4 supported by IA# 4938
"RTN","SPNRPC13",8,0)
 ; Reference to API ICDDX^ICDCODE supported by IA# 3990
"RTN","SPNRPC13",9,0)
 ; RETIRED AND REPLACED WITH IA# 3990 [Reference to ^ICD9(D0 supported by IA# 10082]
"RTN","SPNRPC13",10,0)
 ; RETIRED AND REPLACED WITH IA# 3990 [Reference to file 80 supported by IA# 10082]
"RTN","SPNRPC13",11,0)
 ; Reference to API IN5^VADPT supported by IA# 10061
"RTN","SPNRPC13",12,0)
 ; Reference to API DEM^VADPT supported by IA# 10061
"RTN","SPNRPC13",13,0)
 ;
"RTN","SPNRPC13",14,0)
EN1(ROOT,SPNDATE,SPNEDAT,PTLIST) ; Main Entry Point
"RTN","SPNRPC13",15,0)
 ;=========================================================================
"RTN","SPNRPC13",16,0)
 ;PTLIST ICN;ICN;ICN...
"RTN","SPNRPC13",17,0)
 ;SPNDATE The earliest date of Admission for the print to START at.
"RTN","SPNRPC13",18,0)
 ;SPNEDAT the latest date of Admission for the print to END with.
"RTN","SPNRPC13",19,0)
 ;=========================================================================
"RTN","SPNRPC13",20,0)
 S ROOT=$NA(^TMP($J))
"RTN","SPNRPC13",21,0)
 K ^TMP($J),PTARRY,NOINLST
"RTN","SPNRPC13",22,0)
 S ICN=0 F ZYZ=1:1 S ICN=$P(PTLIST,"^",ZYZ) Q:ICN=""  D
"RTN","SPNRPC13",23,0)
 .S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNRPC13",24,0)
 .I +DFN S PTARRY(DFN)=ICN
"RTN","SPNRPC13",25,0)
 K ICN,DFN,PTLIST
"RTN","SPNRPC13",26,0)
 S X=SPNDATE D ^%DT S SPNDATE=Y  ;START DATE
"RTN","SPNRPC13",27,0)
 S X=SPNEDAT D ^%DT S SPNEDAT=Y  ;END DATE
"RTN","SPNRPC13",28,0)
 S SPNEDAT=SPNEDAT_.999999       ;JAS 6/13/06 - TO EXTEND END DATE THRU END OF DAY
"RTN","SPNRPC13",29,0)
 S SPNCNT=0
"RTN","SPNRPC13",30,0)
 S ROOT=$NA(^TMP($J))
"RTN","SPNRPC13",31,0)
 ;K SPNA,SPNIEN,SPNLPRT,SPNQ,SPNQDAT,SPNDATE,VADM,VAIP,ZTSAVE
"RTN","SPNRPC13",32,0)
 K ^TMP($J),^TMP("SPN",$J)
"RTN","SPNRPC13",33,0)
 N SPNDFN,SPNX
"RTN","SPNRPC13",34,0)
 S (SPNDFN,SPNLPRT)=0
"RTN","SPNRPC13",35,0)
 S SPNQDAT=SPNDATE-.000001
"RTN","SPNRPC13",36,0)
 ;JAS 6/13/06  REMOVED 2ND SET OF SPNQDAT...THE 2ND SET MADE THE START DATE TOO EARLY
"RTN","SPNRPC13",37,0)
 ;S SPNQDAT=SPNDATE-000001 F  S SPNQDAT=$O(^DGPM("B",SPNQDAT)) Q:'+SPNQDAT  Q:(SPNQDAT>SPNEDAT)  D
"RTN","SPNRPC13",38,0)
 F  S SPNQDAT=$O(^DGPM("B",SPNQDAT)) Q:'+SPNQDAT  Q:(SPNQDAT>SPNEDAT)  D
"RTN","SPNRPC13",39,0)
 . S SPNIEN=0 F  S SPNIEN=$O(^DGPM("B",SPNQDAT,SPNIEN)) Q:'+SPNIEN  D:$P($G(^DGPM(SPNIEN,0)),U,2)=1
"RTN","SPNRPC13",40,0)
 .. S SPNDFN=$P(^DGPM(SPNIEN,0),U,3)
"RTN","SPNRPC13",41,0)
 .. N DFN,SPNLINE
"RTN","SPNRPC13",42,0)
 .. I '$D(PTARRY(SPNDFN)) Q  ;pt not passed in the list
"RTN","SPNRPC13",43,0)
 .. S DFN=SPNDFN,VAIP("E")=SPNIEN D IN5^VADPT
"RTN","SPNRPC13",44,0)
 .. ;JAS 2/8/07  ADDED ICN TO END OF PATIENT DETAIL AS REQUESTED IN DEFECT 796
"RTN","SPNRPC13",45,0)
 .. ; SPNLINE=Admission date(E)^Ward location(E)^Room-Bed(E)^Adm date^Pointer to PTF^ICN
"RTN","SPNRPC13",46,0)
 .. ;S SPNLINE=$P(VAIP(3),U,1)_U_$P(VAIP(5),U,2)_U_$P(VAIP(6),U,2)_U_SPNQDAT_U_VAIP(12)
"RTN","SPNRPC13",47,0)
 .. S SPNLINE=$P(VAIP(3),U,1)_U_$P(VAIP(5),U,2)_U_$P(VAIP(6),U,2)_U_SPNQDAT_U_VAIP(12)_U_PTARRY(SPNDFN)
"RTN","SPNRPC13",48,0)
 .. S ^TMP("SPN",$J,$$GET1^DIQ(2,SPNDFN,.01,"E"),SPNDFN,SPNIEN)=SPNLINE
"RTN","SPNRPC13",49,0)
 .. D KVAR^VADPT
"RTN","SPNRPC13",50,0)
 .. Q
"RTN","SPNRPC13",51,0)
 . Q
"RTN","SPNRPC13",52,0)
 I $D(^TMP("SPN",$J)) D
"RTN","SPNRPC13",53,0)
 . N SPNDFN,SPNNAME,SPNCOU
"RTN","SPNRPC13",54,0)
 . S SPNCOU=0
"RTN","SPNRPC13",55,0)
 . S SPNNAME="" F  S SPNNAME=$O(^TMP("SPN",$J,SPNNAME)) Q:SPNNAME=""  D
"RTN","SPNRPC13",56,0)
 .. S SPNDFN=0 F  S SPNDFN=$O(^TMP("SPN",$J,SPNNAME,SPNDFN)) Q:SPNDFN<1  D         ; NEWPAT(SPNDFN)  D
"RTN","SPNRPC13",57,0)
 ... S SPNIEN=0 F  S SPNIEN=$O(^TMP("SPN",$J,SPNNAME,SPNDFN,SPNIEN)) Q:SPNIEN<1  D
"RTN","SPNRPC13",58,0)
 .... S SPNLINE=^TMP("SPN",$J,SPNNAME,SPNDFN,SPNIEN)
"RTN","SPNRPC13",59,0)
 .... D NEWPAT(SPNDFN)
"RTN","SPNRPC13",60,0)
 .... D PATIENT(SPNDFN,SPNLINE)
"RTN","SPNRPC13",61,0)
 ... Q
"RTN","SPNRPC13",62,0)
 .. Q
"RTN","SPNRPC13",63,0)
 . Q
"RTN","SPNRPC13",64,0)
 S ROOT=$NA(^TMP($J))
"RTN","SPNRPC13",65,0)
 ;K ^TMP("SPN",$J)
"RTN","SPNRPC13",66,0)
 K SPNCNT,SPNA,SPNIEN,SPNLPRT,SPNQ,SPNQDAT,SPNDATE,VADM,VAIP,ZTSAVE
"RTN","SPNRPC13",67,0)
 Q
"RTN","SPNRPC13",68,0)
NEWPAT(SPNDFN) ; New patient to print
"RTN","SPNRPC13",69,0)
 N DFN
"RTN","SPNRPC13",70,0)
 S DFN=SPNDFN D DEM^VADPT
"RTN","SPNRPC13",71,0)
 S SPNCOU=SPNCOU+1
"RTN","SPNRPC13",72,0)
 Q
"RTN","SPNRPC13",73,0)
PATIENT(SPNDFN,SPNLINE) ; Print Patient data
"RTN","SPNRPC13",74,0)
 S NOTINLST=""
"RTN","SPNRPC13",75,0)
 I $G(PTARRY(SPNDFN))="" S NOTINLST="Not in Registry"
"RTN","SPNRPC13",76,0)
 I $G(PTARRY(SPNDFN)) S NOTINLST=$$GET1^DIQ(2,SPNDFN,57.4,"E") I NOTINLST="NOT APPLICABLE" S NOTINLST="Marked as NOT APPLICABLE in VISTA"
"RTN","SPNRPC13",77,0)
 ;JAS 2/8/07  REMOVED TIME FROM DATESTAMP TO STANDARDIZE DATE FORMAT AS REQUESTED IN DEFECT 802
"RTN","SPNRPC13",78,0)
 ;            ADDED ICN TO END OF PATIENT DETAIL AS REQUESTED IN DEFECT 796
"RTN","SPNRPC13",79,0)
 ;S SPNCNT=SPNCNT+1 S ^TMP($J,SPNCNT,0)="BOR"_U_$G(VADM(1))_U_$P($G(VADM(2)),"^",2)_U_$$FMTE^XLFDT($P(SPNLINE,U,1),"5Z")_U_$P(SPNLINE,U,2)_U_$P(SPNLINE,U,3)_U_NOTINLST_U_"EOL999"
"RTN","SPNRPC13",80,0)
 S SPNCNT=SPNCNT+1 S ^TMP($J,SPNCNT,0)="BOR"_U_$G(VADM(1))_U_$P($G(VADM(2)),"^",2)_U_$$FMTE^XLFDT($P(SPNLINE,U,1),"5DZ")_U_$P(SPNLINE,U,2)_U_$P(SPNLINE,U,3)_U_NOTINLST_U_$P(SPNLINE,U,6)_U_"EOL999"
"RTN","SPNRPC13",81,0)
 S SPNCNT=SPNCNT+1 S ^TMP($J,SPNCNT,0)="BOSDIAG"_U_"Diagnosis Codes"_U_"EOL999"
"RTN","SPNRPC13",82,0)
 Q:$P(SPNLINE,U,2)=""
"RTN","SPNRPC13",83,0)
 Q:$P(SPNLINE,U,5)=""
"RTN","SPNRPC13",84,0)
 N SPNODE,SPNNODE
"RTN","SPNRPC13",85,0)
 S SPNNODE=$G(^DGPT($P(SPNLINE,U,5),70)) Q:SPNNODE=""
"RTN","SPNRPC13",86,0)
 N SPNY
"RTN","SPNRPC13",87,0)
 S SPNCNTB=SPNCNT
"RTN","SPNRPC13",88,0)
 F SPNODE=10,16:1:24 D
"RTN","SPNRPC13",89,0)
 .S SPNY=$P(SPNNODE,U,SPNODE)
"RTN","SPNRPC13",90,0)
 .I SPNY'>0 Q
"RTN","SPNRPC13",91,0)
 .;JAS 6/11/09 - DEFECT 1137 - Removed direct & FM reads of CPT/ICD files to API usage
"RTN","SPNRPC13",92,0)
 .;I $G(^ICD9(SPNY,0))="" Q
"RTN","SPNRPC13",93,0)
 .S SPNYAPI=$$ICDDX^ICDCODE(SPNY,"","","")
"RTN","SPNRPC13",94,0)
 .Q:$P(SPNYAPI,"^")=-1
"RTN","SPNRPC13",95,0)
 .;S SPNCNT=SPNCNT+1 S ^TMP($J,SPNCNT)=$$GET1^DIQ(80,SPNY,3,"E")_U_"EOL999"
"RTN","SPNRPC13",96,0)
 .S SPNCNT=SPNCNT+1 S ^TMP($J,SPNCNT)=$P(SPNYAPI,"^",4)_U_"EOL999"
"RTN","SPNRPC13",97,0)
 .Q
"RTN","SPNRPC13",98,0)
 K SPNYAPI
"RTN","SPNRPC13",99,0)
 I SPNCNT=SPNCNTB D
"RTN","SPNRPC13",100,0)
 . S SPNCNT=SPNCNT+1
"RTN","SPNRPC13",101,0)
 . S ^TMP($J,SPNCNT)="^EOL999"
"RTN","SPNRPC13",102,0)
 D KVAR^VADPT
"RTN","SPNRPC13",103,0)
 Q
"RTN","SPNRPC13",104,0)
KILL ;CALLED FROM VARIOUS OTHER RTN'S
"RTN","SPNRPC13",105,0)
 K ENDATE,NOTINLST,SPNCNTB,STDATE,X,Y,ZYZ
"RTN","SPNRPC13",106,0)
 Q
"RTN","SPNRPC4")
0^104^B51645622
"RTN","SPNRPC4",1,0)
SPNRPC4 ;SD/WDE - List Recent Diagnoses / Cover Sheet data;JUL 18, 2008
"RTN","SPNRPC4",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNRPC4",3,0)
 ;
"RTN","SPNRPC4",4,0)
 ; Reference to ^DGPM("B" supported by IA# 92
"RTN","SPNRPC4",5,0)
 ; References to ^DGPM(D0,0 supported by IA# 4942
"RTN","SPNRPC4",6,0)
 ; Reference to file 45 supported by IA# 4942
"RTN","SPNRPC4",7,0)
 ; Reference to ^ICD0 supported by IA# 10083
"RTN","SPNRPC4",8,0)
 ; Reference to ^ICD9 supported by IA# 10082
"RTN","SPNRPC4",9,0)
 ; Reference to ^ICPT supported by IA #2815
"RTN","SPNRPC4",10,0)
 ; References to ^SRF supported by IA# 3615
"RTN","SPNRPC4",11,0)
 ; Reference to ^SRO supported by IA #4872
"RTN","SPNRPC4",12,0)
 ; Reference to API VISIT^PXRHS01 supported by IA# 1238
"RTN","SPNRPC4",13,0)
 ; Reference to API CPT^ICPTCOD supported by IA #1995
"RTN","SPNRPC4",14,0)
 ;
"RTN","SPNRPC4",15,0)
COL(ROOT,ICN,SPNCUTDT) ;
"RTN","SPNRPC4",16,0)
 ;
"RTN","SPNRPC4",17,0)
 ; return is TMP($J)
"RTN","SPNRPC4",18,0)
 K ^TMP($J)  ;This is the return file
"RTN","SPNRPC4",19,0)
 K RETURN
"RTN","SPNRPC4",20,0)
 S ROOT=$NA(^TMP($J))
"RTN","SPNRPC4",21,0)
 ;*********************************************
"RTN","SPNRPC4",22,0)
 ;  convert icn to dfn
"RTN","SPNRPC4",23,0)
 Q:$G(ICN)=""
"RTN","SPNRPC4",24,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNRPC4",25,0)
 Q:DFN=""
"RTN","SPNRPC4",26,0)
 ;*********************************************
"RTN","SPNRPC4",27,0)
 I '$D(^DPT(+$G(DFN))) S RETURN="" Q
"RTN","SPNRPC4",28,0)
 ;             1825= 5 years
"RTN","SPNRPC4",29,0)
 ;S X1=DT,X2=-5000 D C^%DTC S SPNCUTDT=X  ;cut date no codes before
"RTN","SPNRPC4",30,0)
 S X=SPNCUTDT D ^%DT S SPNCUTDT=Y
"RTN","SPNRPC4",31,0)
JUMPIN1 ;CALLED FROM SPNRPC8 WITH TODAY AS THE CUT DATE
"RTN","SPNRPC4",32,0)
 ;CUTDATE IS THE DATE TO GO BACK TO FORWARD
"RTN","SPNRPC4",33,0)
 S CNT=0  ;used to order the icd9's and icd0's
"RTN","SPNRPC4",34,0)
 S CPTCNT=0  ;used to order the cpt's
"RTN","SPNRPC4",35,0)
 S SPNPTFIE=0 F  S SPNPTFIE=$O(^DGPT("B",DFN,SPNPTFIE)) Q:(SPNPTFIE="")!('+SPNPTFIE)  D SET45
"RTN","SPNRPC4",36,0)
 ;
"RTN","SPNRPC4",37,0)
 D VCPT  ;Build visit file cpt's
"RTN","SPNRPC4",38,0)
 D SURG
"RTN","SPNRPC4",39,0)
 D ENTER^SPNRPC4B
"RTN","SPNRPC4",40,0)
 D CREATE
"RTN","SPNRPC4",41,0)
 K ^TMP($J,"UTIL")
"RTN","SPNRPC4",42,0)
 K SPNPTADM,SPNREV,SPNPTRDT,SPNFLD,XYZ,XYZZ,SPNXY,SPNX1,SURCPT,SURCPTX,SURCPTN,%DT
"RTN","SPNRPC4",43,0)
 K CNT,FIELD,OLDCNT,SPNCNUM,SPNPTFIE,SPNSUDT,SPNXXYZ,SUB,SURX,TOT,TYPE,X,XY,Y
"RTN","SPNRPC4",44,0)
 K CPTCNT,DFN
"RTN","SPNRPC4",45,0)
 K CNT,CPT,CPTCNT,CPTCODE,CPTTXT,DFN,DXIEN,ENTRYDT,EXAM
"RTN","SPNRPC4",46,0)
 K ICPTTXT,PRODATE,PROSENT,RADCPT,RADDT,RADIMP,REALDT,REVRADT
"RTN","SPNRPC4",47,0)
 K SPNSCDT,XA,XB,XC,XCCODE,XCODE,XCTEXT,Y
"RTN","SPNRPC4",48,0)
 K ^TMP($J,"UTIL")
"RTN","SPNRPC4",49,0)
 K SPNPTADM,SPNREV,SPNPTRDT,SPNFLD,XYZ,XYZZ,SPNXY,SPNX1,SURCPT,SURCPTX,SURCPTN,%DT
"RTN","SPNRPC4",50,0)
 K CNT,FIELD,OLDCNT,SPNCNUM,SPNPTFIE,SPNSUDT,SPNXXYZ,SUB,SURX,TOT,TYPE,X,XY,Y
"RTN","SPNRPC4",51,0)
 K CPTCNT,DFN
"RTN","SPNRPC4",52,0)
 K CNT,CPT,CPTCNT,CPTCODE,CPTTXT,DFN,DXIEN,ENTRYDT,EXAM
"RTN","SPNRPC4",53,0)
 K ICPTTXT,PRODATE,PROSENT,RADCPT,RADDT,RADIMP,REALDT,REVRADT
"RTN","SPNRPC4",54,0)
 K SPNSCDT,XA,XB,XC,XCCODE,XCODE,XCTEXT,Y
"RTN","SPNRPC4",55,0)
 K SHOWDT,SPNARDT,SPNCUTDT,SPNREDT
"RTN","SPNRPC4",56,0)
 K SPNFIELD
"RTN","SPNRPC4",57,0)
 Q
"RTN","SPNRPC4",58,0)
SET45 ;loop through PTF file and set up in rev date order
"RTN","SPNRPC4",59,0)
 S SPNPTADM=$P($G(^DGPT(SPNPTFIE,0)),U,2)
"RTN","SPNRPC4",60,0)
 Q:SPNPTADM<SPNCUTDT
"RTN","SPNRPC4",61,0)
 S SPNREV=9999999.9999-SPNPTADM
"RTN","SPNRPC4",62,0)
 S SPNPTRDT=$$GET1^DIQ(45,SPNPTFIE_",",2,"E")
"RTN","SPNRPC4",63,0)
 D BLD
"RTN","SPNRPC4",64,0)
 Q
"RTN","SPNRPC4",65,0)
BLD ;codes from ptf file
"RTN","SPNRPC4",66,0)
 ;get icdo's from ptf file
"RTN","SPNRPC4",67,0)
 F SPNFLD=45.01,45.02,45.03,45.04,45.05 D
"RTN","SPNRPC4",68,0)
 .S XYZ=$$GET1^DIQ(45,SPNPTFIE_",",SPNFLD,"I")
"RTN","SPNRPC4",69,0)
 .Q:XYZ=""
"RTN","SPNRPC4",70,0)
 .S XYZZ=$P($G(^ICD0(XYZ,0)),U,4)
"RTN","SPNRPC4",71,0)
 .S CNT=CNT+1
"RTN","SPNRPC4",72,0)
 .S ^TMP($J,"UTIL","ICD",SPNREV,CNT)=$P($G(^ICD0(XYZ,0)),U,4)_U_$P($G(^ICD0(XYZ,0)),U,1)_U_SPNPTRDT_U_"DGPT"_U_SPNPTFIE_U
"RTN","SPNRPC4",73,0)
 ;---------------------------------------------
"RTN","SPNRPC4",74,0)
 ;get icd9's from ptf file
"RTN","SPNRPC4",75,0)
 F SPNFLD=79,79.16,79.17,79.18,79.19,79.201,79.21,79.22,79.23,79.24,80 D
"RTN","SPNRPC4",76,0)
 .S XYZ=$$GET1^DIQ(45,SPNPTFIE_",",SPNFLD,"I")
"RTN","SPNRPC4",77,0)
 .Q:XYZ=""
"RTN","SPNRPC4",78,0)
 .S XYZZ=$P($G(^ICD9(XYZ,0)),U,3)
"RTN","SPNRPC4",79,0)
 .S CNT=CNT+1
"RTN","SPNRPC4",80,0)
 .S ^TMP($J,"UTIL","ICD",SPNREV,CNT)=$P($G(^ICD9(XYZ,0)),U,3)_U_$P($G(^ICD9(XYZ,0)),U,1)_U_SPNPTRDT_U_"DGPT"_U_SPNPTFIE_U
"RTN","SPNRPC4",81,0)
BLD2 ;get 40 subscript
"RTN","SPNRPC4",82,0)
 S SPNXY=0 F  S SPNXY=$O(^DGPT(SPNPTFIE,"S",SPNXY)) Q:(SPNXY=0)!('+SPNXY)  D
"RTN","SPNRPC4",83,0)
 .S SPNSUDT=$P($G(^DGPT(SPNPTFIE,"S",SPNXY,0)),U,1)
"RTN","SPNRPC4",84,0)
 .Q:SPNSUDT=""
"RTN","SPNRPC4",85,0)
 .S Y=SPNSUDT X ^DD("DD") S SPNXXYZ=Y  ;date time
"RTN","SPNRPC4",86,0)
 .S SPNSUDT=9999999.9999-SPNSUDT  ;rev date time
"RTN","SPNRPC4",87,0)
 .F SPNFLD=8,9,10,11,12 D
"RTN","SPNRPC4",88,0)
 ..S XYZ=$P($G(^DGPT(SPNPTFIE,"S",SPNXY,0)),U,SPNFLD)
"RTN","SPNRPC4",89,0)
 ..Q:XYZ=""
"RTN","SPNRPC4",90,0)
 ..S CNT=CNT+1
"RTN","SPNRPC4",91,0)
 ..S ^TMP($J,"UTIL","ICD",SPNSUDT,CNT)=$P($G(^ICD0(XYZ,0)),U,4)_U_$P($G(^ICD0(XYZ,0)),U,1)_U_SPNXXYZ_U_"DGPT"_U_SPNPTFIE_U
"RTN","SPNRPC4",92,0)
 .Q
"RTN","SPNRPC4",93,0)
 ;get the 60's now
"RTN","SPNRPC4",94,0)
 S SPNXY=0 F  S SPNXY=$O(^DGPT(SPNPTFIE,"P",SPNXY)) Q:(SPNXY=0)!('+SPNXY)  D
"RTN","SPNRPC4",95,0)
 .S SPNSUDT=$P($G(^DGPT(SPNPTFIE,"P",SPNXY,0)),U,1)
"RTN","SPNRPC4",96,0)
 .Q:SPNSUDT=""
"RTN","SPNRPC4",97,0)
 .S Y=SPNSUDT X ^DD("DD") S SPNXXYZ=Y  ;date time
"RTN","SPNRPC4",98,0)
 .S SPNSUDT=9999999.9999-SPNSUDT
"RTN","SPNRPC4",99,0)
 .F SPNFLD=5,6,7,8,9 D
"RTN","SPNRPC4",100,0)
 ..S XYZ=$P($G(^DGPT(SPNPTFIE,"P",SPNXY,0)),U,SPNFLD)
"RTN","SPNRPC4",101,0)
 ..Q:XYZ=""
"RTN","SPNRPC4",102,0)
 ..S CNT=CNT+1
"RTN","SPNRPC4",103,0)
 ..S ^TMP($J,"UTIL","ICD",SPNSUDT,CNT)=$P($G(^ICD0(XYZ,0)),U,4)_U_$P($G(^ICD0(XYZ,0)),U,1)_U_SPNXXYZ_U_"DGPT"_U_SPNPTFIE_U
"RTN","SPNRPC4",104,0)
 Q
"RTN","SPNRPC4",105,0)
VCPT ;------------------------------------------------------------------
"RTN","SPNRPC4",106,0)
 ;visit file cpt's
"RTN","SPNRPC4",107,0)
 ;JAS 07/18/08 Completely re-wrote this section due to IA Issues found
"RTN","SPNRPC4",108,0)
 ;             during SQA checklist and missing ICD codes
"RTN","SPNRPC4",109,0)
 ;S X=0 F  S X=$O(^AUPNVCPT("C",DFN,X)) Q:(X="")!('+X)  D
"RTN","SPNRPC4",110,0)
 ;.S XY=$$GET1^DIQ(9000010.18,X_",",.03,"I")
"RTN","SPNRPC4",111,0)
 ;.Q:XY=""
"RTN","SPNRPC4",112,0)
 ;.S XY=$P($G(^AUPNVSIT(XY,0)),U,1)  ;visit date
"RTN","SPNRPC4",113,0)
 ;.Q:XY=""
"RTN","SPNRPC4",114,0)
 ;.Q:XY<SPNCUTDT
"RTN","SPNRPC4",115,0)
 ;.S XY=9999999.9999-XY  ;rev visit date
"RTN","SPNRPC4",116,0)
 ;.S XYZ=$$GET1^DIQ(9000010.18,X_",",.01,"I")  ;cpt code
"RTN","SPNRPC4",117,0)
 ;.Q:XYZ=""
"RTN","SPNRPC4",118,0)
 ;.S XYZZ=$P($G(^ICPT(XYZ,0)),U,1)
"RTN","SPNRPC4",119,0)
 ;.S XYZ=$P($G(^ICPT(XYZ,0)),U,2)
"RTN","SPNRPC4",120,0)
 ;.S CPTCNT=CPTCNT+1
"RTN","SPNRPC4",121,0)
 ;.;S ^TMP($J,"UTIL",CNT,XY)=XYZ_U_$$GET1^DIQ(9000010.18,X_",",.03,"E")_U_$$GET1^DIQ(9000010.18,X_",",.01)_U_"Visit file"
"RTN","SPNRPC4",122,0)
 ;.S ^TMP($J,"UTIL","CPT",XY,CPTCNT)=XYZ_U_XYZZ_U_$$GET1^DIQ(9000010.18,X_",",.03,"E")_U_"AUPNVCPT("_U_X_U
"RTN","SPNRPC4",123,0)
 ;.Q
"RTN","SPNRPC4",124,0)
 K ^TMP("PXHSV",$J)
"RTN","SPNRPC4",125,0)
 D VISIT^PXRHS01(DFN,"",SPNCUTDT,"","AHICTNSOERDX","CD",1)
"RTN","SPNRPC4",126,0)
 F CDTYP="C","D" D VCPT2
"RTN","SPNRPC4",127,0)
 K RVDT,COUNT,X,VTMSTMP,MDT,XSTRING,ICPTIEN,CDTYP,CDTYP2
"RTN","SPNRPC4",128,0)
 K ^TMP("PXHSV",$J)
"RTN","SPNRPC4",129,0)
 Q
"RTN","SPNRPC4",130,0)
VCPT2 ;
"RTN","SPNRPC4",131,0)
 S RVDT=""
"RTN","SPNRPC4",132,0)
 F  S RVDT=$O(^TMP("PXHSV",$J,RVDT)) Q:RVDT=""  D
"RTN","SPNRPC4",133,0)
 .S COUNT=""
"RTN","SPNRPC4",134,0)
 .F  S COUNT=$O(^TMP("PXHSV",$J,RVDT,COUNT)) Q:COUNT=""  D
"RTN","SPNRPC4",135,0)
 ..Q:'$D(^TMP("PXHSV",$J,RVDT,COUNT,CDTYP))
"RTN","SPNRPC4",136,0)
 ..S X=""
"RTN","SPNRPC4",137,0)
 ..F  S X=$O(^TMP("PXHSV",$J,RVDT,COUNT,CDTYP,X)) Q:X=""  D
"RTN","SPNRPC4",138,0)
 ...S ICPTIEN=$P(^TMP("PXHSV",$J,RVDT,COUNT,CDTYP,X),"^",1)
"RTN","SPNRPC4",139,0)
 ...S MDT=9999999-$P(RVDT,".",1)
"RTN","SPNRPC4",140,0)
 ...S TMSTMP=MDT_"."_$P(RVDT,".",2)
"RTN","SPNRPC4",141,0)
 ...S Y=TMSTMP X ^DD("DD") S VTMSTMP=Y  ;date time
"RTN","SPNRPC4",142,0)
 ...I MDT<2890101 S MDT=2890101
"RTN","SPNRPC4",143,0)
 ...I CDTYP="C" D
"RTN","SPNRPC4",144,0)
 ....S XSTRING=$$CPT^ICPTCOD(ICPTIEN,MDT,"")
"RTN","SPNRPC4",145,0)
 ....S XYZZ=$P(XSTRING,"^",2)
"RTN","SPNRPC4",146,0)
 ....S XYZ=$P(XSTRING,"^",3)
"RTN","SPNRPC4",147,0)
 ....S CDTYP2="CPT"
"RTN","SPNRPC4",148,0)
 ...I CDTYP="D" D
"RTN","SPNRPC4",149,0)
 ....S XYZZ=$P($G(^ICD9(ICPTIEN,0)),U,1)
"RTN","SPNRPC4",150,0)
 ....S XYZ=$P($G(^ICD9(ICPTIEN,0)),U,3)
"RTN","SPNRPC4",151,0)
 ....S CDTYP2="ICD"
"RTN","SPNRPC4",152,0)
 ...S CPTCNT=CPTCNT+1
"RTN","SPNRPC4",153,0)
 ...S ^TMP($J,"UTIL",CDTYP2,RVDT,CPTCNT)=XYZ_U_XYZZ_U_VTMSTMP_U_"AUPNVCPT("_U_RVDT_U
"RTN","SPNRPC4",154,0)
 Q
"RTN","SPNRPC4",155,0)
SURG ;------------------------------------------------------------
"RTN","SPNRPC4",156,0)
 ;get surgery icd's
"RTN","SPNRPC4",157,0)
 ;JAS 07/18/08 Rewrote sections of Surgery sections, due to IA issues found in
"RTN","SPNRPC4",158,0)
 ;             SQA checklist and out-of-date code.
"RTN","SPNRPC4",159,0)
 S X=0 F  S X=$O(^SRF("B",DFN,X)) Q:(X="")!('+X)  D
"RTN","SPNRPC4",160,0)
 .S SPNSRDT=$P($G(^SRF(X,0)),U,9)
"RTN","SPNRPC4",161,0)
 .Q:SPNSRDT=""
"RTN","SPNRPC4",162,0)
 .Q:SPNSRDT<SPNCUTDT
"RTN","SPNRPC4",163,0)
 .S SPNSRDT=9999999.9999-SPNSRDT
"RTN","SPNRPC4",164,0)
 .;S FIELD=14 D CHKSUR  ;Rob requested not to include pre op codes
"RTN","SPNRPC4",165,0)
 .;S FIELD=15 D CHKSUR
"RTN","SPNRPC4",166,0)
 . S FIELD=4 D CHKSUR
"RTN","SPNRPC4",167,0)
 .D SURCPT
"RTN","SPNRPC4",168,0)
 .Q
"RTN","SPNRPC4",169,0)
 K SPNSRDT
"RTN","SPNRPC4",170,0)
 Q
"RTN","SPNRPC4",171,0)
CHKSUR 
"RTN","SPNRPC4",172,0)
 ;S SPNX1=0 F  S SPNX1=$O(^SRF(X,FIELD,SPNX1)) Q:(SPNX1="")!('+SPNX1)  D
"RTN","SPNRPC4",173,0)
 ;.S SPNXCODE=$P($G(^SRF(X,FIELD,SPNX1,0)),U,3) Q:SPNXCODE=""
"RTN","SPNRPC4",174,0)
 S SPNX1=0 F  S SPNX1=$O(^SRO(136,X,FIELD,SPNX1)) Q:(SPNX1="")!('+SPNX1)  D
"RTN","SPNRPC4",175,0)
 .S SPNXCODE=$P($G(^SRO(136,X,FIELD,SPNX1,0)),U,1) Q:SPNXCODE=""
"RTN","SPNRPC4",176,0)
 .S SPNCNUM=$P($G(^ICD9(SPNXCODE,0)),U,1)
"RTN","SPNRPC4",177,0)
 .S SPNXCODE=$P($G(^ICD9(SPNXCODE,0)),U,3)
"RTN","SPNRPC4",178,0)
 ;.S SPNSRDT=$P($G(^SRF(X,0)),U,9)
"RTN","SPNRPC4",179,0)
 ;.Q:SPNSRDT=""
"RTN","SPNRPC4",180,0)
 ;.Q:SPNSRDT<SPNCUTDT
"RTN","SPNRPC4",181,0)
 ;.S SPNSRDT=9999999.9999-SPNSRDT
"RTN","SPNRPC4",182,0)
 .S CNT=CNT+1
"RTN","SPNRPC4",183,0)
 ;.S ^TMP($J,"UTIL","ICD",SPNSRDT,CNT)=SPNXCODE_U_SPNCNUM_U_$$GET1^DIQ(130,X_",",.09,"E")_U_"SRF"_U_X_"/"_FIELD_U
"RTN","SPNRPC4",184,0)
 .S ^TMP($J,"UTIL","ICD",SPNSRDT,CNT)=SPNXCODE_U_SPNCNUM_U_$$GET1^DIQ(130,X_",",.09,"E")_U_"SRO(136"_U_U
"RTN","SPNRPC4",185,0)
 ;.K SPNSRDT,SPNXCODE
"RTN","SPNRPC4",186,0)
 .K SPNXCODE
"RTN","SPNRPC4",187,0)
 .Q
"RTN","SPNRPC4",188,0)
 ;SURG CPTS
"RTN","SPNRPC4",189,0)
 Q
"RTN","SPNRPC4",190,0)
SURCPT ;
"RTN","SPNRPC4",191,0)
 ;S SURX=0 F  S SURX=$O(^SRF(X,13,SURX)) Q:(SURX="")!('+SURX)  D
"RTN","SPNRPC4",192,0)
 ;.S SURCPT=$P($G(^SRF(X,13,SURX,2)),U,1)
"RTN","SPNRPC4",193,0)
  S SURX=0 F  S SURX=$O(^SRO(136,X,3,SURX)) Q:(SURX="")!('+SURX)  D
"RTN","SPNRPC4",194,0)
 .S SURCPT=$P($G(^SRO(136,X,3,SURX,0)),U,1)
"RTN","SPNRPC4",195,0)
 .S SURCPTN=$P($G(^ICPT(SURCPT,0)),U,1)  ;NUMBER
"RTN","SPNRPC4",196,0)
 .S SURCPTX=$P($G(^ICPT(SURCPT,0)),U,2)  ;TEXT
"RTN","SPNRPC4",197,0)
 .S CPTCNT=CPTCNT+1
"RTN","SPNRPC4",198,0)
 ;.S ^TMP($J,"UTIL","CPT",SPNSRDT,CPTCNT)=SURCPTX_U_SURCPTN_U_$$GET1^DIQ(130,X_",",.09,"E")_U_"SRF("_U_X_U
"RTN","SPNRPC4",199,0)
 .S ^TMP($J,"UTIL","CPT",SPNSRDT,CPTCNT)=SURCPTX_U_SURCPTN_U_$$GET1^DIQ(130,X_",",.09,"E")_U_"SRO(136"_U_U
"RTN","SPNRPC4",200,0)
 Q
"RTN","SPNRPC4",201,0)
CREATE ;
"RTN","SPNRPC4",202,0)
 S (X,CNT,OLDCNT)=0
"RTN","SPNRPC4",203,0)
 S ^TMP($J,"CPT",0)="CPTBREAK^EOL999"
"RTN","SPNRPC4",204,0)
 S ^TMP($J,"ICD",0)="ICDBREAK^EOL999"
"RTN","SPNRPC4",205,0)
 F SUB="CPT","ICD" S X=0 F  S X=$O(^TMP($J,"UTIL",SUB,X)) Q:(X="")!('+X)  S OLDCNT=0 F  S OLDCNT=$O(^TMP($J,"UTIL",SUB,X,OLDCNT)) Q:(OLDCNT="")!('+OLDCNT)  D
"RTN","SPNRPC4",206,0)
 .S CNT=CNT+1
"RTN","SPNRPC4",207,0)
 .S ^TMP($J,SUB,CNT)=$G(^TMP($J,"UTIL",SUB,X,OLDCNT))_"^EOL999"
"RTN","SPNRPC4",208,0)
 .Q
"RTN","SPNRPC4",209,0)
 ;MOVED TO TOP K ^TMP($J,"UTIL")  ;REMOVE SUB TEMP GLOBAL
"RTN","SPNRPC4",210,0)
 Q
"RTN","SPNRPC4",211,0)
DISP ;just used to print out tmp for validation
"RTN","SPNRPC4",212,0)
 S TOT=0
"RTN","SPNRPC4",213,0)
 S TYPE="" F  S TYPE=$O(^TMP($J,TYPE)) Q:TYPE=""  S CNT=0 F  S CNT=$O(^TMP($J,TYPE,CNT)) Q:(CNT="")!('+CNT)  D
"RTN","SPNRPC4",214,0)
 .W !,$P($G(^TMP($J,TYPE,CNT)),U,1)
"RTN","SPNRPC4",215,0)
 .W ?30,$P($G(^TMP($J,TYPE,CNT)),U,2)
"RTN","SPNRPC4",216,0)
 .W ?40,$P($G(^TMP($J,TYPE,CNT)),U,3)
"RTN","SPNRPC4",217,0)
 .W ?60,$P($G(^TMP($J,TYPE,CNT)),U,4,5)
"RTN","SPNRPC4",218,0)
 .W !,$G(^TMP($J,TYPE,CNT))
"RTN","SPNRPC4",219,0)
 .S TOT=TOT+1
"RTN","SPNRPC4",220,0)
 Q
"RTN","SPNRPC4B")
0^82^B46067512
"RTN","SPNRPC4B",1,0)
SPNRPC4B ;SD/WDE - Routine to list Recent Diagnoses / Cover Sheet data;JUN 17, 2009
"RTN","SPNRPC4B",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNRPC4B",3,0)
 ;
"RTN","SPNRPC4B",4,0)
 ; References to file #409.68/^SCE supported by IA #2443
"RTN","SPNRPC4B",5,0)
 ; RETIRED AND REPLACED WITH IA# 3990 [Reference to ^ICD9 supported by IA #10082]
"RTN","SPNRPC4B",6,0)
 ; Reference to API ICDDX^ICDCODE supported by IA #3990
"RTN","SPNRPC4B",7,0)
 ; Reference to ^SDD(409.43 supported by IA #4930
"RTN","SPNRPC4B",8,0)
 ; References to ^ACK(509850.6 supported by IA #1558
"RTN","SPNRPC4B",9,0)
 ; References to file #721/^ECH supported by IA #1873
"RTN","SPNRPC4B",10,0)
 ; References to file #70/^RADPT supported by IA #3125 & #118
"RTN","SPNRPC4B",11,0)
 ; Reference to ^RAMIS(71 supported by IA #586
"RTN","SPNRPC4B",12,0)
 ; References to ^RMPR(660 supported by IA #4975
"RTN","SPNRPC4B",13,0)
 ; Reference to ^ICPT supported by IA #2815
"RTN","SPNRPC4B",14,0)
 ; Reference to API CPT^ICPTCOD supported by IA #1995
"RTN","SPNRPC4B",15,0)
 ; Reference to API PSASHCPC^RMPOPF supported by IA #4975
"RTN","SPNRPC4B",16,0)
 ;
"RTN","SPNRPC4B",17,0)
ENTER ;
"RTN","SPNRPC4B",18,0)
 D SCE
"RTN","SPNRPC4B",19,0)
 D AUDIO
"RTN","SPNRPC4B",20,0)
 D ECH
"RTN","SPNRPC4B",21,0)
 D RAD
"RTN","SPNRPC4B",22,0)
 D PROS
"RTN","SPNRPC4B",23,0)
 ;NOTE THAT THE VAR'S ARE KILLED IN SPNRPC4
"RTN","SPNRPC4B",24,0)
 Q
"RTN","SPNRPC4B",25,0)
 ;
"RTN","SPNRPC4B",26,0)
SCE ;loop through the sce file "c" on dfn then to the sdd file for icd9
"RTN","SPNRPC4B",27,0)
 S XA=0 F  S XA=$O(^SCE("C",DFN,XA)) Q:(XA="")!('+XA)  D
"RTN","SPNRPC4B",28,0)
 .S SPNREDT=9999999.9999-$P($G(^SCE(XA,0)),U,1)
"RTN","SPNRPC4B",29,0)
 .Q:$P($G(^SCE(XA,0)),U,1)<SPNCUTDT
"RTN","SPNRPC4B",30,0)
 .S SPNSCDT=$$GET1^DIQ(409.68,XA_",",.01,"E")
"RTN","SPNRPC4B",31,0)
 .;JAS - 05/15/08 - DEFECT 1090
"RTN","SPNRPC4B",32,0)
 .;S XB="" F  S XB=$O(^SDD(409.43,"AO",XA,XB)) Q:(XB="")!('+XB)  D
"RTN","SPNRPC4B",33,0)
 .S XB=0 F  S XB=$O(^SDD(409.43,"AO",XA,XB)) Q:(XB="")!('+XB)  D
"RTN","SPNRPC4B",34,0)
 ..;JAS 6/17/09 - DEFECT 1137 - Removed direct reads of CPT/ICD files to API usage
"RTN","SPNRPC4B",35,0)
 ..S SPNARY=$$ICDDX^ICDCODE(XB,"","","")
"RTN","SPNRPC4B",36,0)
 ..S CNT=CNT+1
"RTN","SPNRPC4B",37,0)
 ..;S ^TMP($J,"UTIL","ICD",SPNREDT,CNT)=$P($G(^ICD9(XB,0)),U,3)_U_$P($G(^ICD9(XB,0)),U,1)_U_SPNSCDT_U_"SCE"_U_XA_U
"RTN","SPNRPC4B",38,0)
 ..S ^TMP($J,"UTIL","ICD",SPNREDT,CNT)=$P(SPNARY,U,4)_U_$P(SPNARY,U,2)_U_SPNSCDT_U_"SCE"_U_XA_U
"RTN","SPNRPC4B",39,0)
 ..Q
"RTN","SPNRPC4B",40,0)
 .K SPNARY
"RTN","SPNRPC4B",41,0)
 .Q
"RTN","SPNRPC4B",42,0)
 Q
"RTN","SPNRPC4B",43,0)
AUDIO ;get icd9's from audio speech
"RTN","SPNRPC4B",44,0)
 S XA=0 F  S XA=$O(^ACK(509850.6,"C",DFN,XA)) Q:(XA="")!('+XA)  D
"RTN","SPNRPC4B",45,0)
 .S SPNARDT=$P($G(^ACK(509850.6,XA,0)),U,1)
"RTN","SPNRPC4B",46,0)
 .Q:SPNARDT=""
"RTN","SPNRPC4B",47,0)
 .Q:SPNARDT<SPNCUTDT
"RTN","SPNRPC4B",48,0)
 .S MDT=SPNARDT
"RTN","SPNRPC4B",49,0)
 .S SPNARDT=9999999.9999-SPNARDT
"RTN","SPNRPC4B",50,0)
 .S SPNFIELD=1 D COL
"RTN","SPNRPC4B",51,0)
 .S SPNFIELD=3 D COL
"RTN","SPNRPC4B",52,0)
 .Q
"RTN","SPNRPC4B",53,0)
 Q
"RTN","SPNRPC4B",54,0)
COL ;
"RTN","SPNRPC4B",55,0)
 S XB=0 F  S XB=$O(^ACK(509850.6,XA,SPNFIELD,XB)) Q:(XB="")!('+XB)  D
"RTN","SPNRPC4B",56,0)
 .S XC=$P($G(^ACK(509850.6,XA,SPNFIELD,XB,0)),U,1)
"RTN","SPNRPC4B",57,0)
 .Q:XC=""
"RTN","SPNRPC4B",58,0)
 .;JAS 6/17/09 - DEFECT 1137 - Removed direct reads of CPT/ICD files to API usage
"RTN","SPNRPC4B",59,0)
 .S SPNARY=$$ICDDX^ICDCODE(XC,"","","")
"RTN","SPNRPC4B",60,0)
 .;I SPNFIELD=1 S XCCODE=$P($G(^ICD9(XC,0)),U,1)
"RTN","SPNRPC4B",61,0)
 .I SPNFIELD=1 S XCCODE=$P(SPNARY,U,2)
"RTN","SPNRPC4B",62,0)
 .;I SPNFIELD=1 S XC=$P($G(^ICD9(XC,0)),U,3)
"RTN","SPNRPC4B",63,0)
 .I SPNFIELD=1 S XC=$P(SPNARY,U,4)
"RTN","SPNRPC4B",64,0)
 .;I SPNFIELD=3 S XCCODE=$P($G(^ICPT(XC,0)),U,1)
"RTN","SPNRPC4B",65,0)
 .;I SPNFIELD=3 S XC=$P($G(^ICPT(XC,0)),U,2)
"RTN","SPNRPC4B",66,0)
 .I SPNFIELD=3 D
"RTN","SPNRPC4B",67,0)
 ..S XSTRING=$$CPT^ICPTCOD(XC,MDT,"")
"RTN","SPNRPC4B",68,0)
 ..S XCCODE=$P(XSTRING,"^",2)
"RTN","SPNRPC4B",69,0)
 ..S XC=$P(XSTRING,"^",3)
"RTN","SPNRPC4B",70,0)
 .Q:XC=""
"RTN","SPNRPC4B",71,0)
 .I SPNFIELD=1 S CNT=CNT+1
"RTN","SPNRPC4B",72,0)
 .I SPNFIELD=3 S CPTCNT=CPTCNT+1
"RTN","SPNRPC4B",73,0)
 .S ^TMP($J,"UTIL",$S(SPNFIELD=1:"ICD",1:"CPT"),SPNARDT,$S(SPNFIELD=1:CNT,1:CPTCNT))=XC_U_XCCODE_U_$$GET1^DIQ(509850.6,XA_",",.01,"E")_U_"ACK(509850.6"_U_XA_U
"RTN","SPNRPC4B",74,0)
 .S XC=""
"RTN","SPNRPC4B",75,0)
 .K SPNARY
"RTN","SPNRPC4B",76,0)
 .Q
"RTN","SPNRPC4B",77,0)
 Q 
"RTN","SPNRPC4B",78,0)
ECH ;
"RTN","SPNRPC4B",79,0)
 ;
"RTN","SPNRPC4B",80,0)
 ;Event Capture file 721
"RTN","SPNRPC4B",81,0)
 ; xa=date.time  xb = ien of ^ECH
"RTN","SPNRPC4B",82,0)
 ; xc is the icd9 points to the ICD9 file
"RTN","SPNRPC4B",83,0)
 S XA=0 F  S XA=$O(^ECH("APAT",DFN,XA)) Q:(XA="")!('+XA)  S XB=0 F  S XB=$O(^ECH("APAT",DFN,XA,XB)) Q:(XB="")!('+XB)  D
"RTN","SPNRPC4B",84,0)
 .S SPNARDT=$P($G(^ECH(XB,0)),U,3)
"RTN","SPNRPC4B",85,0)
 .Q:SPNARDT=""
"RTN","SPNRPC4B",86,0)
 .Q:SPNARDT<SPNCUTDT
"RTN","SPNRPC4B",87,0)
 .S MDT=SPNARDT
"RTN","SPNRPC4B",88,0)
 .S SPNARDT=9999999.9999-SPNARDT
"RTN","SPNRPC4B",89,0)
 .S XCODE=$P($G(^ECH(XB,"P")),U,2)
"RTN","SPNRPC4B",90,0)
 .I XCODE'="" D ECHNIN
"RTN","SPNRPC4B",91,0)
 .S XCODE=$P($G(^ECH(XB,"P")),U,1)
"RTN","SPNRPC4B",92,0)
 .I XCODE'="" D ECHCPT
"RTN","SPNRPC4B",93,0)
 .D ECHSEC
"RTN","SPNRPC4B",94,0)
 .Q
"RTN","SPNRPC4B",95,0)
 Q
"RTN","SPNRPC4B",96,0)
ECHNIN ;gets the icd9 and sets tmp($j,"util"
"RTN","SPNRPC4B",97,0)
 S XC=$$GET1^DIQ(721,XB_",",20,"E")  ;icd9 number
"RTN","SPNRPC4B",98,0)
 ;JAS 6/17/09 - DEFECT 1137 - Removed direct reads of CPT/ICD files to API usage
"RTN","SPNRPC4B",99,0)
 ;S XCTEXT=$P($G(^ICD9(XCODE,0)),U,3)  ;text of the icd9
"RTN","SPNRPC4B",100,0)
 S XCTEXT=$P($$ICDDX^ICDCODE(XCODE,"","",""),U,4)
"RTN","SPNRPC4B",101,0)
 S CNT=CNT+1
"RTN","SPNRPC4B",102,0)
 S ^TMP($J,"UTIL","ICD",SPNARDT,CNT)=XCTEXT_U_XC_U_$$GET1^DIQ(721,XB_",",2,"E")_U_"ECH"_U_XB_U
"RTN","SPNRPC4B",103,0)
 Q
"RTN","SPNRPC4B",104,0)
ECHCPT ;gets the icpt field 20
"RTN","SPNRPC4B",105,0)
 S XC=$$GET1^DIQ(721,XB_",",19,"E")   ;icpt number
"RTN","SPNRPC4B",106,0)
 ;S XCTEXT=$P($G(^ICPT(XCODE,0)),U,2)  ;icpt text
"RTN","SPNRPC4B",107,0)
 S XSTRING=$$CPT^ICPTCOD(XCODE,MDT,"")
"RTN","SPNRPC4B",108,0)
 S XCTEXT=$P(XSTRING,"^",3)
"RTN","SPNRPC4B",109,0)
 S CPTCNT=CPTCNT+1
"RTN","SPNRPC4B",110,0)
 S ^TMP($J,"UTIL","CPT",SPNARDT,CPTCNT)=XCTEXT_U_XC_U_$$GET1^DIQ(721,XB_",",2,"E")_U_"ECH("_U_XB_U
"RTN","SPNRPC4B",111,0)
 Q
"RTN","SPNRPC4B",112,0)
ECHSEC ;get SECONDARY ICD-9 CODE subscript dx
"RTN","SPNRPC4B",113,0)
 S DXIEN=0 F  S DXIEN=$O(^ECH(XB,"DX",DXIEN)) Q:(DXIEN="")!('+DXIEN)  D
"RTN","SPNRPC4B",114,0)
 .S XCODE=$P($G(^ECH(XB,"DX",DXIEN,0)),U,1)
"RTN","SPNRPC4B",115,0)
 .;JAS 6/17/09 - DEFECT 1137 - Removed direct reads of CPT/ICD files to API usage
"RTN","SPNRPC4B",116,0)
 .S SPNARY=$$ICDDX^ICDCODE(XCODE,"","","")
"RTN","SPNRPC4B",117,0)
 .;S XC=$P($G(^ICD9(XCODE,0)),U,1)
"RTN","SPNRPC4B",118,0)
 .S XC=$P(SPNARY,"^",2)
"RTN","SPNRPC4B",119,0)
 .;S XCTEXT=$P($G(^ICD9(XCODE,0)),U,3)
"RTN","SPNRPC4B",120,0)
 .S XCTEXT=$P(SPNARY,"^",4)
"RTN","SPNRPC4B",121,0)
 .S CNT=CNT+1
"RTN","SPNRPC4B",122,0)
 .S ^TMP($J,"UTIL","ICD",SPNARDT,CNT)=XCTEXT_U_XC_U_$$GET1^DIQ(721,XB_",",2,"E")_U_"ECH"_U_XB_U
"RTN","SPNRPC4B",123,0)
 .K SPNARY
"RTN","SPNRPC4B",124,0)
 .Q
"RTN","SPNRPC4B",125,0)
 Q
"RTN","SPNRPC4B",126,0)
RAD ;RAD/NUC MED PATIENT
"RTN","SPNRPC4B",127,0)
 ;
"RTN","SPNRPC4B",128,0)
 S RADDT=0 F  S RADDT=$O(^RADPT(DFN,"DT",RADDT)) Q:(RADDT="")!('+RADDT)  D
"RTN","SPNRPC4B",129,0)
 .;S REALDT=$P($G(^RADPT(DFN,"DT",RADDT,0)),U,1)
"RTN","SPNRPC4B",130,0)
 .S REALDT=$$GET1^DIQ(70.02,RADDT_","_DFN_",",.01,"I")
"RTN","SPNRPC4B",131,0)
 .Q:REALDT<SPNCUTDT
"RTN","SPNRPC4B",132,0)
 .S EXAM=0 F  S EXAM=$O(^RADPT(DFN,"DT",RADDT,"P",EXAM)) Q:(EXAM="")!('+EXAM)  D
"RTN","SPNRPC4B",133,0)
 ..;S RADCPT=$P($G(^RADPT(DFN,"DT",RADDT,"P",EXAM,0)),U,2)
"RTN","SPNRPC4B",134,0)
 ..S RADCPT=$$GET1^DIQ(70.03,EXAM_","_RADDT_","_DFN_",",2,"I")
"RTN","SPNRPC4B",135,0)
 ..Q:RADCPT=""
"RTN","SPNRPC4B",136,0)
 ..S RADCPT=$P($G(^RAMIS(71,RADCPT,0)),U,9)
"RTN","SPNRPC4B",137,0)
 ..Q:RADCPT=""  ;NOT IN THE RAMIS FILE
"RTN","SPNRPC4B",138,0)
 ..S XSTRING=$$CPT^ICPTCOD(RADCPT,REALDT,"")
"RTN","SPNRPC4B",139,0)
 ..S ICPTTXT=$P(XSTRING,"^",3)
"RTN","SPNRPC4B",140,0)
 ..;S ICPTTXT=$P(^ICPT(RADCPT,0),U,2)
"RTN","SPNRPC4B",141,0)
 ..S CPTCNT=CPTCNT+1
"RTN","SPNRPC4B",142,0)
 ..S Y=REALDT D DD^%DT S SHOWDT=Y
"RTN","SPNRPC4B",143,0)
 ..;S RADIMP=$P($G(^RADPT(DFN,"DT",RADDT,"P",EXAM,0)),U,1) Note changed 3/2/2006 wde see line below
"RTN","SPNRPC4B",144,0)
 ..;S RADIMP=$P($G(^RADPT(DFN,"DT",RADDT,"P",EXAM,0)),U,17)  ;This is the ien in the file rarpt file line above is wrong
"RTN","SPNRPC4B",145,0)
 ..S RADIMP=$$GET1^DIQ(70.03,EXAM_","_RADDT_","_DFN_",",17,"I")
"RTN","SPNRPC4B",146,0)
 ..S ^TMP($J,"UTIL","CPT",RADDT,CPTCNT)=ICPTTXT_U_RADCPT_U_SHOWDT_U_"RADPT"_U_RADDT_U_"RARPT "_RADIMP
"RTN","SPNRPC4B",147,0)
 Q
"RTN","SPNRPC4B",148,0)
PROS ;Record of Prosthetics Appl Repair
"RTN","SPNRPC4B",149,0)
 S PROSENT=0 F  S PROSENT=$O(^RMPR(660,"C",DFN,PROSENT)) Q:(PROSENT=0)!('+PROSENT)  D
"RTN","SPNRPC4B",150,0)
 .S ENTRYDT=$P($G(^RMPR(660,PROSENT,0)),U,1)
"RTN","SPNRPC4B",151,0)
 .S RMPRHCDT=ENTRYDT
"RTN","SPNRPC4B",152,0)
 .Q:ENTRYDT<SPNCUTDT
"RTN","SPNRPC4B",153,0)
 .S REVRADT=9999999.9999-ENTRYDT
"RTN","SPNRPC4B",154,0)
 .;S CPT=$P($G(^RMPR(660,PROSENT,0)),U,22)
"RTN","SPNRPC4B",155,0)
 .;Q:CPT=""
"RTN","SPNRPC4B",156,0)
 .;S CPTCODE=$P($G(^ICPT(CPT,0)),U,1)
"RTN","SPNRPC4B",157,0)
 .;S CPTTXT=$P($G(^ICPT(CPT,0)),U,2)
"RTN","SPNRPC4B",158,0)
 .S CPT=$P($G(^RMPR(660,PROSENT,1)),U,4)
"RTN","SPNRPC4B",159,0)
 .Q:CPT=""
"RTN","SPNRPC4B",160,0)
 .S RMPRHCPC=CPT
"RTN","SPNRPC4B",161,0)
 .D PSASHCPC^RMPOPF
"RTN","SPNRPC4B",162,0)
 .S CPTCODE=RMPREHC
"RTN","SPNRPC4B",163,0)
 .S CPTTXT=RMPRTHC
"RTN","SPNRPC4B",164,0)
 .S Y=ENTRYDT D DD^%DT S PRODATE=Y
"RTN","SPNRPC4B",165,0)
 .S CPTCNT=CPTCNT+1
"RTN","SPNRPC4B",166,0)
 .S ^TMP($J,"UTIL","CPT",REVRADT,CPTCNT)=CPTTXT_U_CPTCODE_U_PRODATE_U_"RMPR(660("_U_PROSENT_U
"RTN","SPNRPC4B",167,0)
 .K RMPRHCPC,RMPREHC,RMPRTHC
"RTN","SPNRPC4B",168,0)
 .Q
"RTN","SPNRPC4B",169,0)
 Q
"RTN","SPNRPC4B",170,0)
KILL ;
"RTN","SPNRPC4B",171,0)
 ;VARS ARE KILLED IN SPNRPC4 JUST FOR INDEX ONLY
"RTN","SPNRPC4B",172,0)
 K ^TMP($J,"UTIL")
"RTN","SPNRPC4B",173,0)
 K SPNPTADM,SPNREV,SPNPTRDT,SPNFLD,XYZ,XYZZ,SPNXY,SPNX1,SURCPT,SURCPTX,SURCPTN,%DT
"RTN","SPNRPC4B",174,0)
 K CNT,FIELD,OLDCNT,SPNCNUM,SPNPTFIE,SPNSUDT,SPNXXYZ,SUB,SURX,TOT,TYPE,X,XY,Y
"RTN","SPNRPC4B",175,0)
 K CPTCNT,DFN
"RTN","SPNRPC4B",176,0)
 K CNT,CPT,CPTCNT,CPTCODE,CPTTXT,DFN,DXIEN,ENTRYDT,EXAM
"RTN","SPNRPC4B",177,0)
 K ICPTTXT,PRODATE,PROSENT,RADCPT,RADDT,RADIMP,REALDT,REVRADT
"RTN","SPNRPC4B",178,0)
 K SPNSCDT,XA,XB,XC,XCCODE,XCODE,XCTEXT,Y
"RTN","SPNRPC4B",179,0)
 K SHOWDT,SPNARDT,SPNCUTDT,SPNREDT
"RTN","SPNRPC4B",180,0)
 K SPNFIELD,MDT,XSTRING
"RTN","SPNRPC4B",181,0)
 K RMPRHCDT  ;WDE
"RTN","SPNRPC5")
0^43^B609564
"RTN","SPNRPC5",1,0)
SPNRPC5 ;SD/WDE - Routine to list Vitals / Cover Sheet data;Jan 10, 2008
"RTN","SPNRPC5",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNRPC5",3,0)
 ;
"RTN","SPNRPC5",4,0)
 ; Reference to API EN6^GMRVUTL supported by IA #1120
"RTN","SPNRPC5",5,0)
 ;
"RTN","SPNRPC5",6,0)
EN(RESULTS,ICN) ;
"RTN","SPNRPC5",7,0)
 ;****************************
"RTN","SPNRPC5",8,0)
 Q:$G(ICN)=""
"RTN","SPNRPC5",9,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNRPC5",10,0)
 Q:$G(DFN)=""
"RTN","SPNRPC5",11,0)
 ;****************************
"RTN","SPNRPC5",12,0)
 Q:$G(^DPT(DFN,0))=""
"RTN","SPNRPC5",13,0)
 ;JAS - 01/10/2008 - Defect 766 DBIA Changes 
"RTN","SPNRPC5",14,0)
 ;Section of code below commented out and replaced due to DBIA changes
"RTN","SPNRPC5",15,0)
 ;S REVDATE="" F  S REVDATE=$O(^GMR(120.5,"AA",DFN,22,REVDATE)) Q:(REVDATE="")!('+REVDATE)  S IEN="" F   S IEN=$O(^GMR(120.5,"AA",DFN,22,REVDATE,IEN)) Q:IEN'>0  D
"RTN","SPNRPC5",16,0)
 ;.I $P($G(^GMR(120.5,IEN,2)),U,1)=1 Q  ;entered in error
"RTN","SPNRPC5",17,0)
 ;.D SET S REVDATE=999999999999999999
"RTN","SPNRPC5",18,0)
 ;.Q
"RTN","SPNRPC5",19,0)
 ;K IEN,ICN,DFN,REVDATE,X,X1,X2,X3
"RTN","SPNRPC5",20,0)
 ;Q
"RTN","SPNRPC5",21,0)
 ;SET ;set up data
"RTN","SPNRPC5",22,0)
 ;S X=$$GET1^DIQ(120.5,IEN_",",.01,"E")
"RTN","SPNRPC5",23,0)
 ;S X1=$$GET1^DIQ(120.5,IEN_",",.03,"E")
"RTN","SPNRPC5",24,0)
 ;S X2=$$GET1^DIQ(120.5,IEN_",",1.2,"E")
"RTN","SPNRPC5",25,0)
 ;S X3=$$GET1^DIQ(120.5,IEN_",",5,"E")
"RTN","SPNRPC5",26,0)
 ;S RESULTS=X_U_X1_U_X2_U_"GMR(120.5,"_IEN_U_"EOL999"
"RTN","SPNRPC5",27,0)
 S GMRVSTR="PN"
"RTN","SPNRPC5",28,0)
 D EN6^GMRVUTL
"RTN","SPNRPC5",29,0)
 Q:X=""
"RTN","SPNRPC5",30,0)
 S RESULTS=$$FMTE^XLFDT($P(X,U,1))_U_"PAIN"_U_$P(X,U,8)_U_"GMR(120.5,"_U_"EOL999"
"RTN","SPNRPC5",31,0)
 K GMRVSTR,X,DFN
"RTN","SPNRPC5",32,0)
 Q
"RTN","SPNRPC6")
0^44^B851415
"RTN","SPNRPC6",1,0)
SPNRPC6 ;SD/WDE - Routine to validate electronic signature code;DEC 08, 2006
"RTN","SPNRPC6",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNRPC6",3,0)
 ;
"RTN","SPNRPC6",4,0)
 ;
"RTN","SPNRPC6",5,0)
 ;
"RTN","SPNRPC6",6,0)
 ;
"RTN","SPNRPC6",7,0)
 ;
"RTN","SPNRPC6",8,0)
 ;
"RTN","SPNRPC6",9,0)
VALIDATE(RESULTS,DUZ,SPNSIG) ; Validate Electronic Sign code
"RTN","SPNRPC6",10,0)
 ;  Input:  spnsig - contains the signature to be validated
"RTN","SPNRPC6",11,0)
 ; Output: results - contains a 1 if a valid e-sig (0 if not valid),
"RTN","SPNRPC6",12,0)
 ; user's sig block print name, and signature block title
"RTN","SPNRPC6",13,0)
 S U="^"
"RTN","SPNRPC6",14,0)
 S RESULTS=0
"RTN","SPNRPC6",15,0)
 I SPNSIG="" Q
"RTN","SPNRPC6",16,0)
 S X=$G(SPNSIG)
"RTN","SPNRPC6",17,0)
 D HASH^XUSHSHP
"RTN","SPNRPC6",18,0)
 ;I X'="",(X=$P($G(^VA(200,DUZ,20)),U,4)) D
"RTN","SPNRPC6",19,0)
 I X'="",(X=$$GET1^DIQ(200,DUZ,20.4,"I")) D
"RTN","SPNRPC6",20,0)
 .S RESULTS=1
"RTN","SPNRPC6",21,0)
 .;S RESULTS=RESULTS_U_$P($G(^VA(200,DUZ,20)),U,2,3)_U_"EOL999"
"RTN","SPNRPC6",22,0)
 .S RESULTS=RESULTS_U_$$GET1^DIQ(200,DUZ,20.2)_U_$$GET1^DIQ(200,DUZ,20.3)_U_"EOL999"
"RTN","SPNRPC6",23,0)
 .Q
"RTN","SPNRPC6",24,0)
 K X,SPNSIG
"RTN","SPNRPC6",25,0)
 Q
"RTN","SPNRPC7")
0^45^B3491672
"RTN","SPNRPC7",1,0)
SPNRPC7 ;SD/WDE - Returns TIU doc titles from 8925.1;DEC 29, 2006
"RTN","SPNRPC7",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNRPC7",3,0)
 ;
"RTN","SPNRPC7",4,0)
 ;INTEGRATION REFERENCES: 1782       TEXT INTEGRATION UTILITIES
"RTN","SPNRPC7",5,0)
 ;
"RTN","SPNRPC7",6,0)
 ;
"RTN","SPNRPC7",7,0)
 ;
"RTN","SPNRPC7",8,0)
LIST(RESULTS,CLASSNAM) ;Gets list of Progress Note Titles from 8925.1
"RTN","SPNRPC7",9,0)
 ; Input: Name of Document Class, typically SCI OUTCOMES
"RTN","SPNRPC7",10,0)
 ; Output: results - TIU titles under the Document Class
"RTN","SPNRPC7",11,0)
 S SPNCNT=0
"RTN","SPNRPC7",12,0)
 D NOTES^TIUSRVD(.SPNTEMP)  ;INTEGRATION REFERENCES: 1782
"RTN","SPNRPC7",13,0)
 S SPNSUB=0 F  S SPNSUB=$O(SPNTEMP(SPNSUB)) Q:(SPNSUB="")!('+SPNSUB)  D
"RTN","SPNRPC7",14,0)
 .S SPNDATA=$G(SPNTEMP(SPNSUB))
"RTN","SPNRPC7",15,0)
 .Q:SPNDATA=""
"RTN","SPNRPC7",16,0)
 .I $P(SPNDATA,U,2)="SCI FUNCTIONAL INDEPENDENCE MEASURE" D
"RTN","SPNRPC7",17,0)
 ..S SPNIEN=$P(SPNDATA,U,1) S SPNIEN=$P(SPNIEN,"i",2)
"RTN","SPNRPC7",18,0)
 ..S SPNCNT=SPNCNT+1 S RESULTS(SPNCNT)=$P(SPNDATA,U,2)_U_SPNIEN_"^EOL999"
"RTN","SPNRPC7",19,0)
 ..Q
"RTN","SPNRPC7",20,0)
 .I $P(SPNDATA,U,2)="SCI GENERAL NOTE" D
"RTN","SPNRPC7",21,0)
 ..S SPNIEN=$P(SPNDATA,U,1) S SPNIEN=$P(SPNIEN,"i",2)
"RTN","SPNRPC7",22,0)
 ..S SPNCNT=SPNCNT+1 S RESULTS(SPNCNT)=$P(SPNDATA,U,2)_U_SPNIEN_"^EOL999"
"RTN","SPNRPC7",23,0)
 ..Q
"RTN","SPNRPC7",24,0)
 .I $P(SPNDATA,U,2)="SCI CRAIG HANDICAP ASSESSMENT&REPORTING TECHNIQUE-SHORT FORM" D
"RTN","SPNRPC7",25,0)
 ..S SPNIEN=$P(SPNDATA,U,1) S SPNIEN=$P(SPNIEN,"i",2)
"RTN","SPNRPC7",26,0)
 ..S SPNCNT=SPNCNT+1 S RESULTS(SPNCNT)=$P(SPNDATA,U,2)_U_SPNIEN_"^EOL999"
"RTN","SPNRPC7",27,0)
 ..Q
"RTN","SPNRPC7",28,0)
 .I $P(SPNDATA,U,2)="SCI DIENER SATISFACTION WITH LIFE SCALE" D
"RTN","SPNRPC7",29,0)
 ..S SPNIEN=$P(SPNDATA,U,1) S SPNIEN=$P(SPNIEN,"i",2)
"RTN","SPNRPC7",30,0)
 ..S SPNCNT=SPNCNT+1 S RESULTS(SPNCNT)=$P(SPNDATA,U,2)_U_SPNIEN_"^EOL999"
"RTN","SPNRPC7",31,0)
 ..Q
"RTN","SPNRPC7",32,0)
 ;       
"RTN","SPNRPC7",33,0)
ZAP ;
"RTN","SPNRPC7",34,0)
 K SPNTEMP,SPNCNT,SPNIEN,SPNDATA,SPNSUB
"RTN","SPNRPC7",35,0)
 Q
"RTN","SPNRPC7",36,0)
COM ;
"RTN","SPNRPC7",37,0)
 ;===================================================================
"RTN","SPNRPC7",38,0)
 ;OLD OUTPUT BEFORE THE USE OF THE API
"RTN","SPNRPC7",39,0)
 ;THIS IS WHAT WE ARE LOOKING FOR AND THE FORMAT OF THE DATA.
"RTN","SPNRPC7",40,0)
 ;RESULTS(1)="SCI FUNCTIONAL INDEPENDENCE MEASURE^1644^EOL999"
"RTN","SPNRPC7",41,0)
 ;RESULTS(2)="SCI GENERAL NOTE^1645^EOL999"
"RTN","SPNRPC7",42,0)
 ;RESULTS(3)="SCI CRAIG HANDICAP ASSESSMENT&REPORTING TECHNIQUE-SHORT FORM^1646^EOL999"
"RTN","SPNRPC7",43,0)
 ;RESULTS(4)="SCI DIENER SATISFACTION WITH LIFE SCALE^1647^EOL999"
"RTN","SPNRPC7",44,0)
 ;
"RTN","SPNRPC7",45,0)
 ;====================================================================
"RTN","SPNRPC7",46,0)
 ;NEW OUT PUT WITH THE USE OF THE NOTES^TIUSRVD CALL
"RTN","SPNRPC7",47,0)
 ;====================================================================
"RTN","SPNRPC7",48,0)
 ;RESULTS(1)="SCI FUNCTIONAL INDEPENDENCE MEASURE^1644^EOL999"
"RTN","SPNRPC7",49,0)
 ;RESULTS(2)="SCI GENERAL NOTE^1645^EOL999"
"RTN","SPNRPC7",50,0)
 ;RESULTS(3)="SCI CRAIG HANDICAP ASSESSMENT&REPORTING TECHNIQUE-SHORT FORM^1646^EOL999"
"RTN","SPNRPC7",51,0)
 ;RESULTS(4)="SCI DIENER SATISFACTION WITH LIFE SCALE^1647^EOL999"
"RTN","SPNRPC8")
0^46^B1815443
"RTN","SPNRPC8",1,0)
SPNRPC8 ;SD/WDE -Returns ICD'S excluding SCI. No cut date;JUL 23, 2008
"RTN","SPNRPC8",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNRPC8",3,0)
 ;
"RTN","SPNRPC8",4,0)
COL(ROOT,ICN) ;Gets ALL ICDS FOR IMPAIRMENTS TAB EXECPT THE LISTED ONES
"RTN","SPNRPC8",5,0)
 ;  Input:
"RTN","SPNRPC8",6,0)
 ;  ICN=ICN
"RTN","SPNRPC8",7,0)
 ;  NO DATE RANGE ALL ICD9'S EXCEPT THE ONES IN THE ARRAY SPNECCLD
"RTN","SPNRPC8",8,0)
 ;exclude this series in the gathering
"RTN","SPNRPC8",9,0)
 K ^TMP($J)
"RTN","SPNRPC8",10,0)
 S ROOT=$NA(^TMP($J))
"RTN","SPNRPC8",11,0)
 S SPNCUTDT=2
"RTN","SPNRPC8",12,0)
 S CNT=0
"RTN","SPNRPC8",13,0)
 S SPNEXCLD(806)=""
"RTN","SPNRPC8",14,0)
 S SPNEXCLD(952)=""
"RTN","SPNRPC8",15,0)
 S SPNEXCLD(344)=""
"RTN","SPNRPC8",16,0)
 S SPNEXCLD(907)=""
"RTN","SPNRPC8",17,0)
 ;S SPNEXCLD(784)=""  ;REMOVE THIS ONE THIS IS FOR TESTING
"RTN","SPNRPC8",18,0)
 ;
"RTN","SPNRPC8",19,0)
JUMPTO ;JUMP IN WITH TODAY AS THE CUTDATE
"RTN","SPNRPC8",20,0)
 ;***********************************
"RTN","SPNRPC8",21,0)
 Q:$G(ICN)=""
"RTN","SPNRPC8",22,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNRPC8",23,0)
 Q:$G(DFN)=""
"RTN","SPNRPC8",24,0)
 ;**********************************
"RTN","SPNRPC8",25,0)
 D JUMPIN1^SPNRPC4
"RTN","SPNRPC8",26,0)
 ;clean out cpt's from tmp($j,"util"
"RTN","SPNRPC8",27,0)
 K ^TMP($J,"UTIL","CPT")
"RTN","SPNRPC8",28,0)
 ;clean out the unwanted CPT codes that are in array spnexcld
"RTN","SPNRPC8",29,0)
 ;
"RTN","SPNRPC8",30,0)
BUILD ;Build temp with only the ones needed
"RTN","SPNRPC8",31,0)
 S SUBCNT=0
"RTN","SPNRPC8",32,0)
 S X34=0 F  S X34=$O(^TMP($J,"ICD",X34)) Q:(X34="")!('+X34)  D
"RTN","SPNRPC8",33,0)
 .S SPNTEST=$P($G(^TMP($J,"ICD",X34)),U,2)
"RTN","SPNRPC8",34,0)
 .S SPNTEST=$P(SPNTEST,".",1)
"RTN","SPNRPC8",35,0)
 .I $D(SPNEXCLD(SPNTEST))=1 K ^TMP($J,"ICD",X34) Q
"RTN","SPNRPC8",36,0)
 .S SUBCNT=SUBCNT+1
"RTN","SPNRPC8",37,0)
 .S ^TMP($J,SUBCNT)=$G(^TMP($J,"ICD",X34))_"EOL999"
"RTN","SPNRPC8",38,0)
 K ^TMP($J,"UTIL")  ;MAY 31 05
"RTN","SPNRPC8",39,0)
 K ^TMP($J,"CPT")  ;MAY 31 05
"RTN","SPNRPC8",40,0)
 K ^TMP($J,"ICD")  ;MAY 31 05
"RTN","SPNRPC8",41,0)
 K CNT,DFN,ICN,SPNCUTDT,SPNEXCLD,SPNTEST,SUBCNT,X34
"RTN","SPNRPC8",42,0)
 Q
"RTN","SPNRPC9")
0^47^B2808690
"RTN","SPNRPC9",1,0)
SPNRPC9 ;SD/WDE -Returns ICD'S BEFORE onset;Mar 07, 2007
"RTN","SPNRPC9",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNRPC9",3,0)
 ;
"RTN","SPNRPC9",4,0)
COL(ROOT,ICN,UPTODATE) ;Gets ALL ICDS FOR IMPAIRMENTS TAB EXECPT THE LISTED ONES
"RTN","SPNRPC9",5,0)
 ;  Input:
"RTN","SPNRPC9",6,0)
 ;  DFN=DFN
"RTN","SPNRPC9",7,0)
 ;  note that I first collect all from spnrpc4 then cut out
"RTN","SPNRPC9",8,0)
 ;  the un-wanted codes and trim the file from the beginning 
"RTN","SPNRPC9",9,0)
 ;  of time to the outcomes date.
"RTN","SPNRPC9",10,0)
 ;exclude this series in the gathering
"RTN","SPNRPC9",11,0)
 K ^TMP($J)
"RTN","SPNRPC9",12,0)
 S ROOT=$NA(^TMP($J))
"RTN","SPNRPC9",13,0)
 S SPNCUTDT=2
"RTN","SPNRPC9",14,0)
 S CNT=0
"RTN","SPNRPC9",15,0)
 ;
"RTN","SPNRPC9",16,0)
JUMPTO ;
"RTN","SPNRPC9",17,0)
 ;****************************************
"RTN","SPNRPC9",18,0)
 Q:$G(ICN)=""
"RTN","SPNRPC9",19,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNRPC9",20,0)
 I DFN="" S ^TMP($J,1)="No ICN on file" Q
"RTN","SPNRPC9",21,0)
 ;*****************************************
"RTN","SPNRPC9",22,0)
 D JUMPIN1^SPNRPC4
"RTN","SPNRPC9",23,0)
 ;clean out cpt's from tmp($j,"util"
"RTN","SPNRPC9",24,0)
 K ^TMP($J,"UTIL","CPT")
"RTN","SPNRPC9",25,0)
 S X=UPTODATE D ^%DT S UPTODATE=Y
"RTN","SPNRPC9",26,0)
 I $G(Y)="-1" K ^TMP($J) S ^TMP($J,1)="Invalid Date Error" Q
"RTN","SPNRPC9",27,0)
 S UPTODATE=9999999-UPTODATE
"RTN","SPNRPC9",28,0)
 ;clean out the un wanted CPT'S
"RTN","SPNRPC9",29,0)
 ;
"RTN","SPNRPC9",30,0)
BUILD ;Build temp with only the ones needed
"RTN","SPNRPC9",31,0)
 S SUBCNT=0
"RTN","SPNRPC9",32,0)
 S X34=0 F  S X34=$O(^TMP($J,"UTIL","ICD",X34)) Q:(X34="")!('+X34)  S X35=0 F  S X35=$O(^TMP($J,"UTIL","ICD",X34,X35)) Q:(X35="")!('+X35)  D
"RTN","SPNRPC9",33,0)
 .S SPNTEST=$P($G(^TMP($J,"UTIL","ICD",X34,X35)),U,2)
"RTN","SPNRPC9",34,0)
 .S SPNTEST=$P(SPNTEST,".",1)
"RTN","SPNRPC9",35,0)
 .I X34<UPTODATE Q
"RTN","SPNRPC9",36,0)
 .S SUBCNT=SUBCNT+1
"RTN","SPNRPC9",37,0)
 .S ^TMP($J,SUBCNT)=$G(^TMP($J,"UTIL","ICD",X34,X35))_"EOL999"
"RTN","SPNRPC9",38,0)
 K ^TMP($J,"CPT")  ;6/1/2005
"RTN","SPNRPC9",39,0)
 K ^TMP($J,"ICD")  ;6/1/2005
"RTN","SPNRPC9",40,0)
 K ^TMP($J,"UTIL")  ;REMOVE TEMP SUB GLOBAL
"RTN","SPNRPC9",41,0)
KILL ;10/10/2006
"RTN","SPNRPC9",42,0)
 K CNT,DFN,SPNCUTDT,SPNTEST,SUBCNT,X,X34,X35,Y
"RTN","SPNRPCA1")
0^48^B4948876
"RTN","SPNRPCA1",1,0)
SPNRPCA1 ;SD/WDE - Returns SPUTUM LAB results box;JUL 28, 2008
"RTN","SPNRPCA1",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNRPCA1",3,0)
 ;
"RTN","SPNRPCA1",4,0)
 ;
"RTN","SPNRPCA1",5,0)
 ;   INTEGRATION REFERENCE INQUIRY #4245
"RTN","SPNRPCA1",6,0)
 ;   INTEGRATION REFERENCE INQUIRY #4246
"RTN","SPNRPCA1",7,0)
 ;
"RTN","SPNRPCA1",8,0)
 ;     dfn is ien of the pt
"RTN","SPNRPCA1",9,0)
 ;     root is the sorted data in latest date of test first
"RTN","SPNRPCA1",10,0)
 ;---------------------------------------------------------------------
"RTN","SPNRPCA1",11,0)
COL(ROOT,ICN,SPNSDT,SPNEDT) ;
"RTN","SPNRPCA1",12,0)
 ;
"RTN","SPNRPCA1",13,0)
 K ^TMP($J)
"RTN","SPNRPCA1",14,0)
 K SPNARRY
"RTN","SPNRPCA1",15,0)
 S ROOT=$NA(^TMP($J))
"RTN","SPNRPCA1",16,0)
 ;***************************
"RTN","SPNRPCA1",17,0)
 Q:$G(ICN)=""
"RTN","SPNRPCA1",18,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNRPCA1",19,0)
 Q:DFN=""
"RTN","SPNRPCA1",20,0)
 ;****************************
"RTN","SPNRPCA1",21,0)
 ;NEWT(ROOT,ICN,SDATE,EDATE)     ;
"RTN","SPNRPCA1",22,0)
 D NOW^%DTC S SPNEDT=X
"RTN","SPNRPCA1",23,0)
 S X=SPNSDT S %DT="T" D ^%DT S SPNSDT=Y
"RTN","SPNRPCA1",24,0)
 K Y,Y
"RTN","SPNRPCA1",25,0)
 ;ONLY THE BEGINNING DATE IS PASSED IN.  COLLECT DATA FROM THAT DATE UP TO THE CURRENT DATE.
"RTN","SPNRPCA1",26,0)
 K ^TMP($J)
"RTN","SPNRPCA1",27,0)
 K ^TMP("SPN",$J)
"RTN","SPNRPCA1",28,0)
 K SPNITEM
"RTN","SPNRPCA1",29,0)
 ;***************************
"RTN","SPNRPCA1",30,0)
 S LRDFN=$$LRDFN^LRPXAPIU(DFN) Q:LRDFN'>0
"RTN","SPNRPCA1",31,0)
 F  D  Q:'MORE
"RTN","SPNRPCA1",32,0)
  . D RESULTS^LRPXAPI(.SPNITEM,DFN,"M",,.MORE,,SPNSDT,SPNEDT)
"RTN","SPNRPCA1",33,0)
  . M ^TMP("SPN",$J)=SPNITEM
"RTN","SPNRPCA1",34,0)
 K SPNITEM
"RTN","SPNRPCA1",35,0)
 ;
"RTN","SPNRPCA1",36,0)
 S SPNCNT=0
"RTN","SPNRPCA1",37,0)
 S SPNXX=0 F A=1:1 S SPNXX=$O(^TMP("SPN",$J,SPNXX)) Q:SPNXX=""  D
"RTN","SPNRPCA1",38,0)
 .S SPNDATA=$G(^TMP("SPN",$J,SPNXX))
"RTN","SPNRPCA1",39,0)
 .S X=$P(SPNDATA,U,1)
"RTN","SPNRPCA1",40,0)
 .S SPNARRY(X)=SPNDATA
"RTN","SPNRPCA1",41,0)
 K SPNXX,SPNDATAM,SPNITEM
"RTN","SPNRPCA1",42,0)
 ;AT THIS POINT ARRAY ONLY CONTAINS THE TOP LEVEL DATA FOR THE TESTS DONE
"RTN","SPNRPCA1",43,0)
 S SPNTEST=0 F  S SPNTEST=$O(SPNARRY(SPNTEST)) Q:SPNTEST=""  D
"RTN","SPNRPCA1",44,0)
 .S SPNDATA=$G(SPNARRY(SPNTEST))
"RTN","SPNRPCA1",45,0)
 .S SPNCNT=0
"RTN","SPNRPCA1",46,0)
 .S SPNRDTE=$P(SPNDATA,";",5)
"RTN","SPNRPCA1",47,0)
 .S X=$P($$REFVAL^LRPXAPI("LRDFN;MI;SPNRDTE;1"),U,5)  ;sputum screen
"RTN","SPNRPCA1",48,0)
 .Q:X=""
"RTN","SPNRPCA1",49,0)
 .S SPNSPUT=$G(X) K X
"RTN","SPNRPCA1",50,0)
 .S Y=$P($$REFVAL^LRPXAPI("LRDFN;MI;SPNRDTE;0"),U,1) D DD^%DT  ;record date
"RTN","SPNRPCA1",51,0)
 .S SPNXDT=Y K X,Y  ;sputum screen date
"RTN","SPNRPCA1",52,0)
 .;
"RTN","SPNRPCA1",53,0)
 .S SPNCNT=SPNCNT+1
"RTN","SPNRPCA1",54,0)
 .S ^TMP($J,"UTIL",SPNRDTE,"A",SPNCNT)="BOR999"_U_SPNXDT_U_SPNSPUT_"^EOL999"
"RTN","SPNRPCA1",55,0)
KILL ;
"RTN","SPNRPCA1",56,0)
 K DFN,LRDFN,MORE,SPNSDT,SPNEDT,ICN,SPNITEM,SPNCNT,SPNXX,SPNARRY,SPNDATA,SPNTEST,SPNRDTE,X,Y,SPNSPUT,SPNXDT
"RTN","SPNRPCA1",57,0)
 K %DT,A
"RTN","SPNRPCA1",58,0)
 Q
"RTN","SPNRPCB")
0^49^B889413
"RTN","SPNRPCB",1,0)
SPNRPCB ;SD/WDE - Returns Radiology Report / Impression / Clinical history text;JUL 01, 2008
"RTN","SPNRPCB",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01,2006;Build 39
"RTN","SPNRPCB",3,0)
 ;
"RTN","SPNRPCB",4,0)
 ;
"RTN","SPNRPCB",5,0)
 ;dbia reference  IA# 2479 
"RTN","SPNRPCB",6,0)
 ;       
"RTN","SPNRPCB",7,0)
COL(RESULTS,SPNRAIEN,SPNTYPE) ;
"RTN","SPNRPCB",8,0)
 ;  Input:
"RTN","SPNRPCB",9,0)
 ;  SPNRAIEN is the ien in ^RARPT
"RTN","SPNRPCB",10,0)
 ;  SPNTYPE is either R,I or H. 
"RTN","SPNRPCB",11,0)
 ;  Report / Impression /  additional clinical history.
"RTN","SPNRPCB",12,0)
 ;       ;FIELDS R;0   200  REPORT TEXT
"RTN","SPNRPCB",13,0)
 ;           I;0   300  IMPRESSION TEXT
"RTN","SPNRPCB",14,0)
 ;           H;0   400  ADDITIONAL CLINICAL HISTORY
"RTN","SPNRPCB",15,0)
 ; 
"RTN","SPNRPCB",16,0)
 ;K SPNDATA,SPNLINE,SPNTEMP
"RTN","SPNRPCB",17,0)
 ;D GETS^DIQ(74,SPNRAIEN,"**","","SPNTEMP")
"RTN","SPNRPCB",18,0)
 ;S SPNTYP=$S(SPNTYPE="R":200,SPNTYPE="I":300,SPNTYPE="H":400,1:"0")
"RTN","SPNRPCB",19,0)
 ;S SPNRAIEN=""_SPNRAIEN_","
"RTN","SPNRPCB",20,0)
 ;S SPNLINE=0 F  S SPNLINE=$O(SPNTEMP(74,SPNRAIEN,SPNTYP,SPNLINE)) Q:(SPNLINE="")!('+SPNLINE)  D
"RTN","SPNRPCB",21,0)
 ;.S RESULTS(SPNLINE)=$G(SPNTEMP(74,SPNRAIEN,SPNTYP,SPNLINE))_U_"EOL999"
"RTN","SPNRPCB",22,0)
 N FIELD,I,IENS,SPNTEMP
"RTN","SPNRPCB",23,0)
 K RESULTS
"RTN","SPNRPCB",24,0)
 S FIELD=$S(SPNTYPE="R":200,SPNTYPE="I":300,SPNTYPE="H":400,1:0)
"RTN","SPNRPCB",25,0)
 Q:FIELD'>0
"RTN","SPNRPCB",26,0)
 S IENS=SPNRAIEN_","
"RTN","SPNRPCB",27,0)
 D GETS^DIQ(74,IENS,FIELD,,"SPNTEMP")
"RTN","SPNRPCB",28,0)
 S I=0
"RTN","SPNRPCB",29,0)
 F  S I=$O(SPNTEMP(74,IENS,FIELD,I))  Q:I'>0  D
"RTN","SPNRPCB",30,0)
 . S RESULTS(I)=SPNTEMP(74,IENS,FIELD,I)_U_"EOL999"
"RTN","SPNRPCB",31,0)
 Q
"RTN","SPNRPCB",32,0)
 ;NEW RESULTS
"RTN","SPNRPCB",33,0)
 ;IEN=1751
"RTN","SPNRPCB",34,0)
 ;TYPE=H
"RTN","SPNRPCB",35,0)
 ;RESULTS(1)="1.  Recent fx. s/p for crush injuries.  ^EOL999"
"RTN","SPNRPCB",36,0)
 ;RESULTS(2)=" ^EOL999"
"RTN","SPNRPCB",37,0)
 ;RESULTS(3)="2.  fx rt fifth MT bone.  ^EOL999"
"RTN","SPNRPCB",38,0)
 ;RESULTS(4)=" ^EOL999"
"RTN","SPNRPCB",39,0)
 ;RESULTS(5)="3.  Routine.  ^EOL999"
"RTN","SPNRPCB",40,0)
 ;
"RTN","SPNRPCB",41,0)
EXIT ;
"RTN","SPNRPCB",42,0)
 ;K SPNLINE,SPNTEMP,SPNRAIEN,SPNTYP
"RTN","SPNRPCB",43,0)
 Q
"RTN","SPNRPCB",44,0)
 ;OLD(RESULTS,RADEXAM,TYPE)      ;
"RTN","SPNRPCB",45,0)
 ;  Input:
"RTN","SPNRPCB",46,0)
 ;  radexam is the ien in ^RARPT
"RTN","SPNRPCB",47,0)
 ;  type is either R,I or H. 
"RTN","SPNRPCB",48,0)
 ;  Report / Impression /  additional clinical history.
"RTN","SPNRPCB",49,0)
 ;
"RTN","SPNRPCB",50,0)
 ;
"RTN","SPNRPCB",51,0)
 ;S LINE=0 F  S LINE=$O(^RARPT(RADEXAM,TYPE,LINE))  Q:(LINE="")!('+LINE)  D
"RTN","SPNRPCB",52,0)
 ;.S RESULTS(LINE)=$G(^RARPT(RADEXAM,TYPE,LINE,0))_U_"EOL999"
"RTN","SPNRPCB",53,0)
 ;Q
"RTN","SPNRPCB",54,0)
 ;OLD RESULTS BEFORE USING DBIA 12-19-2006
"RTN","SPNRPCB",55,0)
 ;THIS IS IN HERE JUST FOR EXAMPLE ONLY TO LOOK AT OLD AND NEW
"RTN","SPNRPCB",56,0)
 ;RESULTS(1)="1.  Recent fx. s/p for crush injuries.  ^EOL999"
"RTN","SPNRPCB",57,0)
 ;RESULTS(2)=" ^EOL999"
"RTN","SPNRPCB",58,0)
 ;RESULTS(3)="2.  fx rt fifth MT bone.  ^EOL999"
"RTN","SPNRPCB",59,0)
 ;RESULTS(4)=" ^EOL999"
"RTN","SPNRPCB",60,0)
 ;RESULTS(5)="3.  Routine.  ^EOL999"
"RTN","SPNRPCC")
0^50^B15974748
"RTN","SPNRPCC",1,0)
SPNRPCC ;SD/WDE - Returns Lab test results for the complete blood count;JUL 01, 2008
"RTN","SPNRPCC",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNRPCC",3,0)
 ;
"RTN","SPNRPCC",4,0)
 ;   INTEGRATION REFERENCE INQUIRY #4245
"RTN","SPNRPCC",5,0)
 ;   INTEGRATION REFERENCE INQUIRY #4246
"RTN","SPNRPCC",6,0)
 ;
"RTN","SPNRPCC",7,0)
 ;     dfn is ien of the pt
"RTN","SPNRPCC",8,0)
 ;     cutdate is the date to start collection data from
"RTN","SPNRPCC",9,0)
 ;     root is the sorted data in latest date of test first
"RTN","SPNRPCC",10,0)
 ;
"RTN","SPNRPCC",11,0)
COL(ROOT,ICN,CUTDATE) ;
"RTN","SPNRPCC",12,0)
 ;S X=CUTDATE S %DT="T" D ^%DT S CUTDATE=9999999.9999-Y
"RTN","SPNRPCC",13,0)
 S X=CUTDATE D ^%DT S CUTDATE=Y
"RTN","SPNRPCC",14,0)
 K ^TMP($J)
"RTN","SPNRPCC",15,0)
 S ROOT=$NA(^TMP($J))
"RTN","SPNRPCC",16,0)
 ;****************************************
"RTN","SPNRPCC",17,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNRPCC",18,0)
 Q:DFN=""
"RTN","SPNRPCC",19,0)
 D NEWT
"RTN","SPNRPCC",20,0)
 K SPNA,SPNB,SPNC,SPND,ITEMS,MORE,DATA,SPNCNT,SPNA,DATA,SPNREV,SPNTST,TESTS,Y,SPNDT
"RTN","SPNRPCC",21,0)
 K UPPER,LOWERM,UNIT,HILOW,VALUE,SPNZZZ,SPNX,ZZZ,Z,Y,TESTS,SPN,DFN,COL
"RTN","SPNRPCC",22,0)
 Q
"RTN","SPNRPCC",23,0)
NEWT ;
"RTN","SPNRPCC",24,0)
 K ^TMP($J),ITMES,TESTS
"RTN","SPNRPCC",25,0)
 K TESTS
"RTN","SPNRPCC",26,0)
 ;S DFN=141471   ;HAS TEST GROUPS 70,72 ONLY DAYT42 ACCOUNT
"RTN","SPNRPCC",27,0)
 ;S DFN=142920  ;HAS TEST GROUPS 70, 72 AND 73
"RTN","SPNRPCC",28,0)
 ; THIS WORKS D RESULTS^LRPXAPI(.ZZZ,DFN,"C",10,,"S=72") BUT I DONT HAVE THE NAME OF THE TEST
"RTN","SPNRPCC",29,0)
 ;get the test that the patient has received
"RTN","SPNRPCC",30,0)
 ;^LAB(61,70,0)=BLOOD^0X000^^^B^20
"RTN","SPNRPCC",31,0)
 ;^LAB(61,71,0)=URINE^7X100^^^U^15
"RTN","SPNRPCC",32,0)
 ;^LAB(61,72,0)=SERUM^0X500^^^S^4
"RTN","SPNRPCC",33,0)
 ;^LAB(61,73,0)=PLASMA^0X400^^^P^6
"RTN","SPNRPCC",34,0)
 ;^LAB(61,74,0)=CEREBROSPINAL FLUID^X1000^^  NOT INCLUDED IN THIS REPORT
"RTN","SPNRPCC",35,0)
 ;D TESTS^LRPXAPI(.TESTS,DFN)
"RTN","SPNRPCC",36,0)
 K SPNA,SPNB,SPNC,SPND
"RTN","SPNRPCC",37,0)
 S SPNCNT=0
"RTN","SPNRPCC",38,0)
 D TESTS^LRPXAPI(.SPNA,DFN,,,,"S=70")
"RTN","SPNRPCC",39,0)
 S SPN=0 F  S SPN=$O(SPNA(SPN)) Q:(SPN="")!('+SPN)  S SPNCNT=SPNCNT+1 S TESTS(SPN)=$G(SPNA(SPN))
"RTN","SPNRPCC",40,0)
 K SPNA,SPNB,SPNC
"RTN","SPNRPCC",41,0)
 F  D  Q:'MORE
"RTN","SPNRPCC",42,0)
  . D RESULTS^LRPXAPI(.ITEMS,DFN,"C",100,.MORE)
"RTN","SPNRPCC",43,0)
  . M ^TMP("SPN",$J)=ITEMS
"RTN","SPNRPCC",44,0)
  ;NOW RESORT THE DATA AND BUILD THE STRING WE WANT
"RTN","SPNRPCC",45,0)
  ;            "-3050303 5270")=3050303^5270^1^61.1^^82400.0000!!!3216!!!5270^2936^72!60!!!^^^^55
"RTN","SPNRPCC",46,0)
  K ITEMS
"RTN","SPNRPCC",47,0)
  S SPNCNT=0,DATA=""
"RTN","SPNRPCC",48,0)
  S SPNA=0 F  S SPNA=$O(^TMP("SPN",$J,SPNA)) Q:SPNA=""  D
"RTN","SPNRPCC",49,0)
 .S DATA=$G(^TMP("SPN",$J,SPNA))
"RTN","SPNRPCC",50,0)
 .Q:DATA=""
"RTN","SPNRPCC",51,0)
 .S SPNREV="-"_$P(DATA,U,1)  ;MINUS DATE THING
"RTN","SPNRPCC",52,0)
 .I $P(DATA,U,1)<CUTDATE Q
"RTN","SPNRPCC",53,0)
 .S Y=$P(DATA,U,1) D DD^%DT S SPNDT=Y
"RTN","SPNRPCC",54,0)
 .S SPNTST=$P(DATA,U,2)
"RTN","SPNRPCC",55,0)
 .Q:$G(TESTS(SPNTST))=""  ;IS NOT A TEST THAT WE WANT
"RTN","SPNRPCC",56,0)
 .S SPNTENA=$P($G(TESTS(SPNTST)),U,2)
"RTN","SPNRPCC",57,0)
 .;SCREEN FOR TEST WE WANT
"RTN","SPNRPCC",58,0)
 .S COL=0
"RTN","SPNRPCC",59,0)
 .I COL=0 I SPNTENA["WBC" S COL=1
"RTN","SPNRPCC",60,0)
 .I COL=0 I SPNTENA["RBC" S COL=1
"RTN","SPNRPCC",61,0)
 .I COL=0 I SPNTENA["HGB" S COL=1
"RTN","SPNRPCC",62,0)
 .I COL=0 I SPNTENA["HCT" S COL=1
"RTN","SPNRPCC",63,0)
 .I COL=0 I SPNTENA["MCV" S COL=1
"RTN","SPNRPCC",64,0)
 .I COL=0 I SPNTENA["MCH" S COL=1  ;NOTE THAT THIS GET "MCHC" AS WELL
"RTN","SPNRPCC",65,0)
 .I COL=0 I SPNTENA["RDW" S COL=1
"RTN","SPNRPCC",66,0)
 .I COL=0 I SPNTENA["PLT" S COL=1
"RTN","SPNRPCC",67,0)
 .I COL=0 I SPNTENA["MPV" S COL=1
"RTN","SPNRPCC",68,0)
 .I COL=0 I SPNTENA["WESTERGR" S COL=1
"RTN","SPNRPCC",69,0)
 .I COL=0 I SPNTENA["ESR" S COL=1
"RTN","SPNRPCC",70,0)
 .I COL=0 I SPNTENA["RETIC" S COL=1
"RTN","SPNRPCC",71,0)
 .I COL=0 I SPNTENA["GRANULOC" S COL=1
"RTN","SPNRPCC",72,0)
 .I COL=0 I SPNTENA["LYMPH" S COL=1
"RTN","SPNRPCC",73,0)
 .I COL=0 I SPNTENA["EOSINO" S COL=1
"RTN","SPNRPCC",74,0)
 .I COL=0 I SPNTENA["BASO" S COL=1
"RTN","SPNRPCC",75,0)
 .I COL=0 I SPNTENA["NRBC" S COL=1
"RTN","SPNRPCC",76,0)
 .I COL=0 I SPNTENA["SEGS" S COL=1
"RTN","SPNRPCC",77,0)
 .I COL=0 I SPNTENA["BANDS" S COL=1
"RTN","SPNRPCC",78,0)
 .I COL=0 I SPNTENA["MONOC" S COL=1
"RTN","SPNRPCC",79,0)
 .I COL=0 I SPNTENA["META" S COL=1
"RTN","SPNRPCC",80,0)
 .I COL=0 I SPNTENA["MYELO" S COL=1
"RTN","SPNRPCC",81,0)
 .I COL=0 I SPNTENA["PROMYELOC" S COL=1
"RTN","SPNRPCC",82,0)
 .I COL=0 I SPNTENA["BLAST" S COL=1
"RTN","SPNRPCC",83,0)
 .I COL=0 I SPNTENA["PLT" S COL=1
"RTN","SPNRPCC",84,0)
 .Q:COL=0  ;TEST DOES NOT MAKE IT
"RTN","SPNRPCC",85,0)
 .S LOWER=$P(DATA,"!",5)  ;lower range
"RTN","SPNRPCC",86,0)
 .S UPPER=$P(DATA,"!",6)  ;upper range
"RTN","SPNRPCC",87,0)
 .S SPNZZZ=$P(DATA,U,8) S UNIT=$P(SPNZZZ,"!",7) K SPNZZZ
"RTN","SPNRPCC",88,0)
 .S ZZ="" F Z=1:1:$L(UNIT) I $E(UNIT,Z)'=" " S ZZ=ZZ_$E(UNIT,Z)  ;Strip off the blanks
"RTN","SPNRPCC",89,0)
 .S UNIT=ZZ K ZZ,X
"RTN","SPNRPCC",90,0)
 .S HILOW=$P(DATA,U,5)
"RTN","SPNRPCC",91,0)
 .S VALUE=$P(DATA,U,4)
"RTN","SPNRPCC",92,0)
 .S SPNCNT=SPNCNT+1
"RTN","SPNRPCC",93,0)
 .S ^TMP($J,"BEFORE",SPNREV,SPNCNT)=SPNDT_U_SPNTENA_U_VALUE_U_HILOW_U_UNIT_U_LOWER_U_UPPER_U_"EOL999"
"RTN","SPNRPCC",94,0)
 .K SPNTENA,LOWER,UPPER,UNIT,SPNTENA,HILOW,VALUE,DATA
"RTN","SPNRPCC",95,0)
REDO ;RESORT THE TEMP GLOBAL
"RTN","SPNRPCC",96,0)
 S SPNCNT=0
"RTN","SPNRPCC",97,0)
 S SPNREV="" F  S SPNREV=$O(^TMP($J,"BEFORE",SPNREV)) Q:SPNREV=""  S SPNX=0 F  S SPNX=$O(^TMP($J,"BEFORE",SPNREV,SPNX)) Q:SPNX=""  D
"RTN","SPNRPCC",98,0)
 .S SPNCNT=SPNCNT+1
"RTN","SPNRPCC",99,0)
 .S ^TMP($J,SPNCNT)=$G(^TMP($J,"BEFORE",SPNREV,SPNX))
"RTN","SPNRPCC",100,0)
 K ^TMP($J,"BEFORE")
"RTN","SPNRPCC",101,0)
 K ^TMP("SPN",$J)
"RTN","SPNRPCD")
0^51^B17417590
"RTN","SPNRPCD",1,0)
SPNRPCD ;SD/WDE - Returns URINALYSIS Lab test results;JUL 01, 2008
"RTN","SPNRPCD",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNRPCD",3,0)
 ;
"RTN","SPNRPCD",4,0)
 ;      DBIA 4245 RESULTS^LRPXAPI
"RTN","SPNRPCD",5,0)
 ;
"RTN","SPNRPCD",6,0)
 ;
"RTN","SPNRPCD",7,0)
 ;     dfn is ien of the pt
"RTN","SPNRPCD",8,0)
 ;     cutdate is the date to start collection data from
"RTN","SPNRPCD",9,0)
 ;     root is the sorted data in latest date of test first
"RTN","SPNRPCD",10,0)
 ;
"RTN","SPNRPCD",11,0)
COL(ROOT,ICN,CUTDATE) ;
"RTN","SPNRPCD",12,0)
 ;S X=CUTDATE S %DT="T" D ^%DT S CUTDATE=9999999.9999-Y
"RTN","SPNRPCD",13,0)
 S X=CUTDATE D ^%DT S CUTDATE=Y
"RTN","SPNRPCD",14,0)
 K ^TMP($J)
"RTN","SPNRPCD",15,0)
 S ROOT=$NA(^TMP($J))
"RTN","SPNRPCD",16,0)
 ;*************************
"RTN","SPNRPCD",17,0)
 Q:$G(ICN)=""
"RTN","SPNRPCD",18,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNRPCD",19,0)
 Q:$G(DFN)=""
"RTN","SPNRPCD",20,0)
 D NEWT
"RTN","SPNRPCD",21,0)
 Q
"RTN","SPNRPCD",22,0)
 K SPNA,SPNB,SPNC,SPND,ITEMS,MORE,DATA,SPNCNT,SPNA,DATA,SPNREV,SPNTST,TESTS,Y,SPNDT
"RTN","SPNRPCD",23,0)
 K UPPER,LOWERM,UNIT,HILOW,VALUE,SPNZZZ,SPNX,ZZZ,Z,Y,TESTS,SPN,DFN,COL,SPNJ
"RTN","SPNRPCD",24,0)
 Q
"RTN","SPNRPCD",25,0)
NEWT ;
"RTN","SPNRPCD",26,0)
 K ^TMP($J),ITMES,TESTS
"RTN","SPNRPCD",27,0)
 K TESTS
"RTN","SPNRPCD",28,0)
 ;S DFN=141471   ;HAS TEST GROUPS 70,72 ONLY DAYT42 ACCOUNT
"RTN","SPNRPCD",29,0)
 ;S DFN=142920  ;HAS TEST GROUPS 70, 72 AND 73
"RTN","SPNRPCD",30,0)
 ; THIS WORKS D RESULTS^LRPXAPI(.ZZZ,DFN,"C",10,,"S=72") BUT I DONT HAVE THE NAME OF THE TEST
"RTN","SPNRPCD",31,0)
 ;get the test that the patient has received
"RTN","SPNRPCD",32,0)
 ;^LAB(61,70,0)=BLOOD^0X000^^^B^20
"RTN","SPNRPCD",33,0)
 ;^LAB(61,71,0)=URINE^7X100^^^U^15
"RTN","SPNRPCD",34,0)
 ;^LAB(61,72,0)=SERUM^0X500^^^S^4
"RTN","SPNRPCD",35,0)
 ;^LAB(61,73,0)=PLASMA^0X400^^^P^6
"RTN","SPNRPCD",36,0)
 ;^LAB(61,74,0)=CEREBROSPINAL FLUID^X1000^^  NOT INCLUDED IN THIS REPORT
"RTN","SPNRPCD",37,0)
 ;D TESTS^LRPXAPI(.TESTS,DFN)
"RTN","SPNRPCD",38,0)
 K SPNA,SPNB,SPNC,SPND
"RTN","SPNRPCD",39,0)
 D TESTS^LRPXAPI(.SPNA,DFN,,,,"S=71")
"RTN","SPNRPCD",40,0)
 S SPNJ=0 F  S SPNJ=$O(SPNA(SPNJ)) Q:SPNJ=""  S TESTS(SPNJ)=$G(SPNA(SPNJ))
"RTN","SPNRPCD",41,0)
 K SPNA
"RTN","SPNRPCD",42,0)
 D TESTS^LRPXAPI(.SPNA,DFN,,,,"S=70")
"RTN","SPNRPCD",43,0)
 S SPNJ=0 F  S SPNJ=$O(SPNA(SPNJ)) Q:SPNJ=""  S TESTS(SPNJ)=$G(SPNA(SPNJ))
"RTN","SPNRPCD",44,0)
 K SPNA,SPNB,SPNC
"RTN","SPNRPCD",45,0)
 F  D  Q:'MORE
"RTN","SPNRPCD",46,0)
  . D RESULTS^LRPXAPI(.ITEMS,DFN,"C",100,.MORE)
"RTN","SPNRPCD",47,0)
  . M ^TMP("SPN",$J)=ITEMS
"RTN","SPNRPCD",48,0)
  ;NOW RESORT THE DATA AND BUILD THE STRING WE WANT
"RTN","SPNRPCD",49,0)
  ;            "-3050303 5270")=3050303^5270^1^61.1^^82400.0000!!!3216!!!5270^2936^72!60!!!^^^^55
"RTN","SPNRPCD",50,0)
  K ITEMS
"RTN","SPNRPCD",51,0)
  S SPNCNT=0,DATA=""
"RTN","SPNRPCD",52,0)
  S SPNA=0 F  S SPNA=$O(^TMP("SPN",$J,SPNA)) Q:SPNA=""  D
"RTN","SPNRPCD",53,0)
 .S DATA=$G(^TMP("SPN",$J,SPNA))
"RTN","SPNRPCD",54,0)
 .S SPNCNT=SPNCNT+1
"RTN","SPNRPCD",55,0)
 .Q:DATA=""
"RTN","SPNRPCD",56,0)
 .S SPNREV="-"_$P(DATA,U,1)  ;MINUS DATE THING
"RTN","SPNRPCD",57,0)
 .I $P(DATA,U,1)<CUTDATE Q
"RTN","SPNRPCD",58,0)
 .S Y=$P(DATA,U,1) D DD^%DT S SPNDT=Y
"RTN","SPNRPCD",59,0)
 .S SPNTST=$P(DATA,U,2)
"RTN","SPNRPCD",60,0)
 .Q:SPNTST=""  ;NO TEST NUMBER IN THE DATA STREAM
"RTN","SPNRPCD",61,0)
 .S SPNTENA=$P($G(TESTS(SPNTST)),U,2)
"RTN","SPNRPCD",62,0)
 .Q:SPNTENA=""  ;TEST NOT IS THE LIST GENERATED IN TESTS^LRPXAPI
"RTN","SPNRPCD",63,0)
 .;SCREEN FOR TEST WE WANT
"RTN","SPNRPCD",64,0)
 .S COL=0
"RTN","SPNRPCD",65,0)
 .I SPNTENA["CRYSTA" S COL=1
"RTN","SPNRPCD",66,0)
 .I SPNTENA["TURBID" S COL=1
"RTN","SPNRPCD",67,0)
 .I SPNTENA["COLOR" S COL=1
"RTN","SPNRPCD",68,0)
 .I SPNTENA["SPECIF" S COL=1
"RTN","SPNRPCD",69,0)
 .I SPNTENA["UROBIL" S COL=1
"RTN","SPNRPCD",70,0)
 .I SPNTENA["UR BLOOD" S COL=1
"RTN","SPNRPCD",71,0)
 .I SPNTENA["URINE BLOOD" S COL=1
"RTN","SPNRPCD",72,0)
 .I SPNTENA["UR BILIR" S COL=1
"RTN","SPNRPCD",73,0)
 .I SPNTENA["KETO" S COL=1
"RTN","SPNRPCD",74,0)
 .I SPNTENA["UR GLU" S COL=1
"RTN","SPNRPCD",75,0)
 .I SPNTENA["URINE GLUCOSE" S COL=1
"RTN","SPNRPCD",76,0)
 .I SPNTENA["UR PROTEIN" S COL=1
"RTN","SPNRPCD",77,0)
 .I SPNTENA["URINE PROTEIN" S COL=1
"RTN","SPNRPCD",78,0)
 .I SPNTENA["UR PH" S COL=1
"RTN","SPNRPCD",79,0)
 .I SPNTENA["URINE PH" S COL=1
"RTN","SPNRPCD",80,0)
 .I SPNTENA["WBC/" S COL=1
"RTN","SPNRPCD",81,0)
 .I SPNTENA["RBC/" S COL=1
"RTN","SPNRPCD",82,0)
 .I SPNTENA["EPITHE" S COL=1
"RTN","SPNRPCD",83,0)
 .I SPNTENA["BACT" S COL=1
"RTN","SPNRPCD",84,0)
 .I SPNTENA["MUCUS" S COL=1
"RTN","SPNRPCD",85,0)
 .I SPNTENA["URINE CA" S COL=1
"RTN","SPNRPCD",86,0)
 .I SPNTENA["HYAL" S COL=1
"RTN","SPNRPCD",87,0)
 .I SPNTENA["WAXY" S COL=1
"RTN","SPNRPCD",88,0)
 .I SPNTENA["SQUAM" S COL=1
"RTN","SPNRPCD",89,0)
 .I SPNTENA["NITRI" S COL=1
"RTN","SPNRPCD",90,0)
 .I SPNTENA["LEUKOC" S COL=1
"RTN","SPNRPCD",91,0)
 .Q:COL=0  ;TEST DOES NOT MAKE IT
"RTN","SPNRPCD",92,0)
 .S LOWER=$P(DATA,"!",5)  ;lower range
"RTN","SPNRPCD",93,0)
 .S UPPER=$P(DATA,"!",6)  ;upper range
"RTN","SPNRPCD",94,0)
 .S SPNZZZ=$P(DATA,U,8) S UNIT=$P(SPNZZZ,"!",7) K SPNZZZ
"RTN","SPNRPCD",95,0)
 .S ZZ="" F Z=1:1:$L(UNIT) I $E(UNIT,Z)'=" " S ZZ=ZZ_$E(UNIT,Z)  ;Strip off the blanks
"RTN","SPNRPCD",96,0)
 .S UNIT=ZZ K ZZ,X
"RTN","SPNRPCD",97,0)
 .S HILOW=$P(DATA,U,5)
"RTN","SPNRPCD",98,0)
 .S VALUE=$P(DATA,U,4)
"RTN","SPNRPCD",99,0)
 .S SPNCNT=SPNCNT+1
"RTN","SPNRPCD",100,0)
 .S ^TMP($J,"BEFORE",SPNREV,SPNCNT)=SPNDT_U_SPNTENA_U_VALUE_U_HILOW_U_UNIT_U_LOWER_U_UPPER_U_"EOL999"
"RTN","SPNRPCD",101,0)
 .K SPNTENA,LOWER,UPPER,UNIT,SPNTENA,HILOW,VALUE,DATA
"RTN","SPNRPCD",102,0)
REDO ;RESORT THE TEMP GLOBAL
"RTN","SPNRPCD",103,0)
 S SPNCNT=0
"RTN","SPNRPCD",104,0)
 S SPNREV="" F  S SPNREV=$O(^TMP($J,"BEFORE",SPNREV)) Q:SPNREV=""  S SPNX=0 F  S SPNX=$O(^TMP($J,"BEFORE",SPNREV,SPNX)) Q:SPNX=""  D
"RTN","SPNRPCD",105,0)
 .S SPNCNT=SPNCNT+1
"RTN","SPNRPCD",106,0)
 .S ^TMP($J,SPNCNT)=$G(^TMP($J,"BEFORE",SPNREV,SPNX))
"RTN","SPNRPCD",107,0)
 K ^TMP($J,"BEFORE")
"RTN","SPNRPCD",108,0)
 K ^TMP("SPN",$J)
"RTN","SPNRPCD",109,0)
 Q
"RTN","SPNRPCD",110,0)
DOIT ;
"RTN","SPNRPCD",111,0)
 K TESTS
"RTN","SPNRPCD",112,0)
 K ^TMP($J,"BEFORE")
"RTN","SPNRPCD",113,0)
 K ^TMP("SPN",$J)
"RTN","SPNRPCD",114,0)
 K ^TMP($J)
"RTN","SPNRPCD",115,0)
 ;D COL(,1002619533,"JAN 1 1990")
"RTN","SPNRPCD",116,0)
 D COL(,1002619533,"DEC 1 2004")
"RTN","SPNRPCD",117,0)
 ;D ^%G
"RTN","SPNRPCD",118,0)
 Q
"RTN","SPNRPCE")
0^52^B23315717
"RTN","SPNRPCE",1,0)
SPNRPCE ;SD/WDE - Returns MICROBIOLOGY URINE Lab test results;JUL 23, 2008
"RTN","SPNRPCE",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNRPCE",3,0)
 ;
"RTN","SPNRPCE",4,0)
 ;   INTEGRATION REFERENCE INQUIRY #2210
"RTN","SPNRPCE",5,0)
 ;   INTEGRATION REFERENCE INQUIRY #10060  VA(200
"RTN","SPNRPCE",6,0)
 ;   INTEGRATION REFERENCE INQUIRY #4245
"RTN","SPNRPCE",7,0)
 ;   INTEGRATION REFERENCE INQUIRY #4246
"RTN","SPNRPCE",8,0)
 ;    
"RTN","SPNRPCE",9,0)
 ;
"RTN","SPNRPCE",10,0)
 ;     dfn is ien of the pt
"RTN","SPNRPCE",11,0)
 ;     cutdate is the date to start collection data from
"RTN","SPNRPCE",12,0)
 ;     root is the sorted data in latest date of test first
"RTN","SPNRPCE",13,0)
 ;
"RTN","SPNRPCE",14,0)
COL(ROOT,ICN,SDATE) ;
"RTN","SPNRPCE",15,0)
 K ^TMP($J)
"RTN","SPNRPCE",16,0)
 K ARRAY
"RTN","SPNRPCE",17,0)
 S ROOT=$NA(^TMP($J))
"RTN","SPNRPCE",18,0)
 ;***************************
"RTN","SPNRPCE",19,0)
 Q:$G(ICN)=""
"RTN","SPNRPCE",20,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNRPCE",21,0)
 Q:DFN=""
"RTN","SPNRPCE",22,0)
 ;****************************
"RTN","SPNRPCE",23,0)
 ;NEWT(ROOT,ICN,SDATE,EDATE)     ;
"RTN","SPNRPCE",24,0)
 D NOW^%DTC S EDATE=X
"RTN","SPNRPCE",25,0)
 S X=SDATE S %DT="T" D ^%DT S SDATE=Y
"RTN","SPNRPCE",26,0)
 ;ONLY THE BEGINNING DATE IS PASSED IN.  COLLECT DATA FROM THAT DATE UP TO THE CURRENT DATE.
"RTN","SPNRPCE",27,0)
 K ^TMP($J)
"RTN","SPNRPCE",28,0)
 K ^TMP("SPN",$J)
"RTN","SPNRPCE",29,0)
 K ITEMS
"RTN","SPNRPCE",30,0)
 ;***************************
"RTN","SPNRPCE",31,0)
 Q:$G(ICN)=""
"RTN","SPNRPCE",32,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNRPCE",33,0)
 Q:DFN=""
"RTN","SPNRPCE",34,0)
 ;
"RTN","SPNRPCE",35,0)
 S LRDFN=$$LRDFN^LRPXAPIU(DFN)  ;
"RTN","SPNRPCE",36,0)
 F  D  Q:'MORE
"RTN","SPNRPCE",37,0)
  . D RESULTS^LRPXAPI(.ITEMS,DFN,"M",,.MORE,,SDATE,EDATE)
"RTN","SPNRPCE",38,0)
  . M ^TMP("SPN",$J)=ITEMS
"RTN","SPNRPCE",39,0)
 K ITEMS
"RTN","SPNRPCE",40,0)
 ;
"RTN","SPNRPCE",41,0)
 S SPNXX=0 F A=1:1 S SPNXX=$O(^TMP("SPN",$J,SPNXX)) Q:SPNXX=""  D
"RTN","SPNRPCE",42,0)
 .S TSTDATA=$G(^TMP("SPN",$J,SPNXX))
"RTN","SPNRPCE",43,0)
 .S X=$P(TSTDATA,U,1)
"RTN","SPNRPCE",44,0)
 .S ARRAY(X)=TSTDATA
"RTN","SPNRPCE",45,0)
 .;AT THIS POINT ARRAY ONLY CONTAINS THE TOP LEVEL DATA FOR THE TESTS DONE
"RTN","SPNRPCE",46,0)
 S SPNTEST=0 F  S SPNTEST=$O(ARRAY(SPNTEST)) Q:SPNTEST=""  D
"RTN","SPNRPCE",47,0)
 .S TSTDATA=$G(ARRAY(SPNTEST))
"RTN","SPNRPCE",48,0)
 .S SPNCNT=0
"RTN","SPNRPCE",49,0)
 .S RDATE=$P(TSTDATA,";",5)
"RTN","SPNRPCE",50,0)
 .K SITPC
"RTN","SPNRPCE",51,0)
 .S SITPC=$P($$REFVAL^LRPXAPI("LRDFN;MI;RDATE;0"),U,5)
"RTN","SPNRPCE",52,0)
 .S SITESPEC=$$SPECNM^LRPXAPIU(SITPC)
"RTN","SPNRPCE",53,0)
 .Q:SITESPEC'["URINE"
"RTN","SPNRPCE",54,0)
 .S ACCES=$P($$REFVAL^LRPXAPI("LRDFN;MI;RDATE;0"),U,6)
"RTN","SPNRPCE",55,0)
 .S Y=$P($$REFVAL^LRPXAPI("LRDFN;MI;RDATE;0"),U,10) D DD^%DT S DATTAKE=Y
"RTN","SPNRPCE",56,0)
 .;
"RTN","SPNRPCE",57,0)
 .;
"RTN","SPNRPCE",58,0)
 .S X=$P($$REFVAL^LRPXAPI("LRDFN;MI;RDATE;0"),U,11) S COLSAMP=$$GET1^DIQ(62,X_",",.01)
"RTN","SPNRPCE",59,0)
 .I COLSAMP="" S COLSAMP="ERROR ON COLSAMP"
"RTN","SPNRPCE",60,0)
 .S REPTYPE=$P($$REFVAL^LRPXAPI("LRDFN;MI;RDATE;1"),U,2)
"RTN","SPNRPCE",61,0)
 .S REPTYPE=$S(REPTYPE="P":"Preliminary",REPTYPE="F":"Final",1:"-----")
"RTN","SPNRPCE",62,0)
 .S Y=$P($$REFVAL^LRPXAPI("LRDFN;MI;RDATE;1"),U,1) D DD^%DT
"RTN","SPNRPCE",63,0)
 .S REPORDT=Y K X,Y
"RTN","SPNRPCE",64,0)
 .;
"RTN","SPNRPCE",65,0)
 .;
"RTN","SPNRPCE",66,0)
 .;
"RTN","SPNRPCE",67,0)
 .S X=$P($$REFVAL^LRPXAPI("LRDFN;MI;RDATE;0"),U,7)
"RTN","SPNRPCE",68,0)
 .S PROVIDER=$$GET1^DIQ(200,X_",",.01)
"RTN","SPNRPCE",69,0)
 .;
"RTN","SPNRPCE",70,0)
 .S SPNCNT=SPNCNT+1
"RTN","SPNRPCE",71,0)
 .S ^TMP($J,"UTIL",RDATE,"A",SPNCNT)="BOR999"_U_ACCES_U_DATTAKE_U_COLSAMP_U_REPTYPE_U_REPORDT_U_SITESPEC_U_PROVIDER_U_"LR("_LRDFN_","_RDATE_U_"EOL999"
"RTN","SPNRPCE",72,0)
 .;
"RTN","SPNRPCE",73,0)
 .;
"RTN","SPNRPCE",74,0)
 .D BACT  ;STILL NEED TO RESOLVE THE ISSUE THAT THERE IS NOT ANY DATA AT THIS LEVEL
"RTN","SPNRPCE",75,0)
 .D ORG
"RTN","SPNRPCE",76,0)
 .D BACTXT
"RTN","SPNRPCE",77,0)
 .;
"RTN","SPNRPCE",78,0)
KILL ;
"RTN","SPNRPCE",79,0)
 K %DT,A,ACCE,B,COLSAMP,DATTAKE,DFN,EDATE,ICN,ITEMS,LINECT,ACCES,SITESPEC
"RTN","SPNRPCE",80,0)
 K LRDFN,MORE,ORGNAM,ORIEN,ORNUM,ORTEXT,ORTXIEN,ORTXLI,PROVIDER
"RTN","SPNRPCE",81,0)
 K RDATE,REPORDT,REPTYPE,SDATE,SITESPE,SITPC,SPNCNT,SPNTEST,SPNXX
"RTN","SPNRPCE",82,0)
 K SUBCNT,TEXT,TSTDATA,TXTCNT,VALUE
"RTN","SPNRPCE",83,0)
 Q
"RTN","SPNRPCE",84,0)
ORG ;
"RTN","SPNRPCE",85,0)
 ;now build the organism tests for this record date
"RTN","SPNRPCE",86,0)
 S SUBCNT=0
"RTN","SPNRPCE",87,0)
 S ORNUM=$P($$REFVAL^LRPXAPI("LRDFN;MI;RDATE;3,0"),U,4)
"RTN","SPNRPCE",88,0)
 S ORIEN="" F A=1:1:ORNUM D  ;S ORIEN=$P($$REFVAL^LRPXAPI("LRDFN;MI;RDATE;3,A,0"),U,1) D:$G(ORIEN)
"RTN","SPNRPCE",89,0)
 .S X=$P($$REFVAL^LRPXAPI("LRDFN;MI;RDATE;3,A,0"),U,1,2)
"RTN","SPNRPCE",90,0)
 .Q:X=""
"RTN","SPNRPCE",91,0)
 .S Y=$P(X,U,1) S ORGNAM=$$BUGNM^LRPXAPIU(X)
"RTN","SPNRPCE",92,0)
 .S VALUE=$P($G(X),U,2)
"RTN","SPNRPCE",93,0)
 .S SUBCNT=SUBCNT+1 S ^TMP($J,"UTIL",RDATE,"C",SUBCNT)="ORGANISM999^"_ORGNAM_U_VALUE_U_"EOL999"
"RTN","SPNRPCE",94,0)
 .;build the organism text for this organism
"RTN","SPNRPCE",95,0)
 .S ORTXLI=$P($$REFVAL^LRPXAPI("LRDFN;MI;RDATE;3,A,1,0"),U,3)  ;number of lines for this organism
"RTN","SPNRPCE",96,0)
 .S TXTCNT=0
"RTN","SPNRPCE",97,0)
 .S ORTXIEN=0 F B=1:1:ORTXLI S ORTEXT=$P($$REFVAL^LRPXAPI("LRDFN;MI;RDATE;3,A,1,B,0"),U,1) D
"RTN","SPNRPCE",98,0)
 ..S TXTCNT=TXTCNT+1 S ^TMP($J,"UTIL",RDATE,"C",A,SUBCNT,TXTCNT)="TXT999^"_ORTEXT_U_"EOL999"
"RTN","SPNRPCE",99,0)
 Q
"RTN","SPNRPCE",100,0)
 ;
"RTN","SPNRPCE",101,0)
 ;
"RTN","SPNRPCE",102,0)
BACT ;
"RTN","SPNRPCE",103,0)
 ;now build the BACT tests for this record date
"RTN","SPNRPCE",104,0)
 S SUBCNT=0
"RTN","SPNRPCE",105,0)
 S LINECT=$P($$REFVAL^LRPXAPI("LRDFN;MI;RDATE;26,0"),U,3)
"RTN","SPNRPCE",106,0)
 F A=1:1:LINECT D  ;S ORIEN=$P($$REFVAL^LRPXAPI("LRDFN;MI;RDATE;3,A,0"),U,1) D:$G(ORIEN)
"RTN","SPNRPCE",107,0)
 .S X=$P($$REFVAL^LRPXAPI("LRDFN;MI;RDATE;26,A,0"),U,1)
"RTN","SPNRPCE",108,0)
 .Q:X=""
"RTN","SPNRPCE",109,0)
 .;S Y=$P(X,U,1) S ORGNAM=$$BUGNM^LRPXAPIU(X)
"RTN","SPNRPCE",110,0)
 .;S VALUE=$P($G(X),U,2)
"RTN","SPNRPCE",111,0)
 .S SUBCNT=SUBCNT+1 S ^TMP($J,"UTIL",RDATE,"B",SUBCNT)="BACTTEST999^"_X_U_"EOL999"
"RTN","SPNRPCE",112,0)
 Q
"RTN","SPNRPCE",113,0)
BACTXT ;----------   DONT THINK THAT THERE ANY REMAKS WITH EACH ONE WILL LOOK
"RTN","SPNRPCE",114,0)
 ;build the BAC TEST REMARKS
"RTN","SPNRPCE",115,0)
 S X=$P($$REFVAL^LRPXAPI("LRDFN;MI;RDATE;4,0"),U,3)  ;number of lines
"RTN","SPNRPCE",116,0)
 S TXTCNT=0
"RTN","SPNRPCE",117,0)
 F B=1:1:X D
"RTN","SPNRPCE",118,0)
 .S TEXT=$P($$REFVAL^LRPXAPI("LRDFN;MI;RDATE;4,B,0"),U,1) D
"RTN","SPNRPCE",119,0)
 ..Q:TEXT=""
"RTN","SPNRPCE",120,0)
 ..S TXTCNT=TXTCNT+1 S ^TMP($J,"UTIL",RDATE,"D",TXTCNT)="BACT_REMARKS999^"_TEXT_U_"EOL999"
"RTN","SPNRPCE",121,0)
 ..Q
"RTN","SPNRPCE",122,0)
 .Q
"RTN","SPNRPCE",123,0)
 Q
"RTN","SPNRPCF")
0^53^B23018946
"RTN","SPNRPCF",1,0)
SPNRPCF ;SD/WDE - Returns MICROBIOLOGY BLOOD Lab test results;JUL 23, 2008
"RTN","SPNRPCF",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNRPCF",3,0)
 ;
"RTN","SPNRPCF",4,0)
 ;
"RTN","SPNRPCF",5,0)
 ;   INTEGRATION REFERENCE INQUIRY #2210  
"RTN","SPNRPCF",6,0)
 ;   INTEGRATION REFERENCE INQUIRY #10060  VA(200
"RTN","SPNRPCF",7,0)
 ;    DBIA 4245 AND 4246
"RTN","SPNRPCF",8,0)
 ;
"RTN","SPNRPCF",9,0)
 ;
"RTN","SPNRPCF",10,0)
 ;     dfn is ien of the pt
"RTN","SPNRPCF",11,0)
 ;     cutdate is the date to start collection data from
"RTN","SPNRPCF",12,0)
 ;     root is the sorted data in latest date of test first
"RTN","SPNRPCF",13,0)
 ;     
"RTN","SPNRPCF",14,0)
 ;     ;ONLY THE BEGINNING DATE IS PASSED IN.  COLLECT DATA FROM THAT DATE UP TO THE CURRENT DATE.
"RTN","SPNRPCF",15,0)
 ;
"RTN","SPNRPCF",16,0)
COL(ROOT,ICN,SDATE) ;
"RTN","SPNRPCF",17,0)
 K ^TMP($J)
"RTN","SPNRPCF",18,0)
 K ARRAY
"RTN","SPNRPCF",19,0)
 S ROOT=$NA(^TMP($J))
"RTN","SPNRPCF",20,0)
 ;***************************
"RTN","SPNRPCF",21,0)
 Q:$G(ICN)=""
"RTN","SPNRPCF",22,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNRPCF",23,0)
 Q:DFN=""
"RTN","SPNRPCF",24,0)
 ;****************************
"RTN","SPNRPCF",25,0)
 ;NEWT(ROOT,ICN,SDATE,EDATE)     ;
"RTN","SPNRPCF",26,0)
 D NOW^%DTC S EDATE=X
"RTN","SPNRPCF",27,0)
 ;S X=EDATE S %DT="T" D ^%DT S EDATE=Y
"RTN","SPNRPCF",28,0)
 S X=SDATE S %DT="T" D ^%DT S SDATE=Y
"RTN","SPNRPCF",29,0)
 ;ONLY THE BEGINNING DATE IS PASSED IN.  COLLECT DATA FROM THAT DATE UP TO THE CURRENT DATE.
"RTN","SPNRPCF",30,0)
 K ^TMP($J)
"RTN","SPNRPCF",31,0)
 K ^TMP("SPN",$J)
"RTN","SPNRPCF",32,0)
 K ITEMS
"RTN","SPNRPCF",33,0)
 ;***************************
"RTN","SPNRPCF",34,0)
 Q:$G(ICN)=""
"RTN","SPNRPCF",35,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNRPCF",36,0)
 Q:DFN=""
"RTN","SPNRPCF",37,0)
 S LRDFN=$$LRDFN^LRPXAPIU(DFN) Q:LRDFN'>0
"RTN","SPNRPCF",38,0)
 F  D  Q:'MORE
"RTN","SPNRPCF",39,0)
  . D RESULTS^LRPXAPI(.ITEMS,DFN,"M",100,.MORE,,SDATE,EDATE)
"RTN","SPNRPCF",40,0)
  . M ^TMP("SPN",$J)=ITEMS
"RTN","SPNRPCF",41,0)
 K ITEMS
"RTN","SPNRPCF",42,0)
 ;
"RTN","SPNRPCF",43,0)
 S SPNXX=0 F A=1:1 S SPNXX=$O(^TMP("SPN",$J,SPNXX)) Q:SPNXX=""  D
"RTN","SPNRPCF",44,0)
 .S TSTDATA=$G(^TMP("SPN",$J,SPNXX))
"RTN","SPNRPCF",45,0)
 .S X=$P(TSTDATA,U,1)
"RTN","SPNRPCF",46,0)
 .S ARRAY(X)=TSTDATA
"RTN","SPNRPCF",47,0)
 .;AT THIS POINT ARRAY ONLY CONTAINS THE TOP LEVEL DATA FOR THE TESTS DONE
"RTN","SPNRPCF",48,0)
 S SPNTEST=0 F  S SPNTEST=$O(ARRAY(SPNTEST)) Q:SPNTEST=""  D
"RTN","SPNRPCF",49,0)
 .S TSTDATA=$G(ARRAY(SPNTEST))
"RTN","SPNRPCF",50,0)
 .S SPNCNT=0
"RTN","SPNRPCF",51,0)
 .S RDATE=$P(TSTDATA,";",5)
"RTN","SPNRPCF",52,0)
 .K SITPC
"RTN","SPNRPCF",53,0)
 .S SITPC=$P($$REFVAL^LRPXAPI("LRDFN;MI;RDATE;0"),U,5)
"RTN","SPNRPCF",54,0)
 .S SITESPEC=$$SPECNM^LRPXAPIU(SITPC)
"RTN","SPNRPCF",55,0)
 .Q:SITESPEC'["BLOOD"
"RTN","SPNRPCF",56,0)
 .S ACCES=$P($$REFVAL^LRPXAPI("LRDFN;MI;RDATE;0"),U,6)
"RTN","SPNRPCF",57,0)
 .S Y=$P($$REFVAL^LRPXAPI("LRDFN;MI;RDATE;0"),U,10) D DD^%DT S DATTAKE=Y
"RTN","SPNRPCF",58,0)
 .;
"RTN","SPNRPCF",59,0)
 .;S X=$P($G(TSTDATA),U,16) S COLSAMP=$$GET1^DIQ(62,X_",",.01)
"RTN","SPNRPCF",60,0)
 .S X=$P($$REFVAL^LRPXAPI("LRDFN;MI;RDATE;0"),U,11) S COLSAMP=$$GET1^DIQ(62,X_",",.01)
"RTN","SPNRPCF",61,0)
 .I COLSAMP="" S COLSAMP="ERROR ON COLSAMP"
"RTN","SPNRPCF",62,0)
 .S REPTYPE=$P($$REFVAL^LRPXAPI("LRDFN;MI;RDATE;1"),U,2)
"RTN","SPNRPCF",63,0)
 .S REPTYPE=$S(REPTYPE="P":"Preliminary",REPTYPE="F":"Final",1:"-----")
"RTN","SPNRPCF",64,0)
 .S Y=$P($$REFVAL^LRPXAPI("LRDFN;MI;RDATE;1"),U,1) D DD^%DT
"RTN","SPNRPCF",65,0)
 .S REPORDT=Y K X,Y
"RTN","SPNRPCF",66,0)
 .;
"RTN","SPNRPCF",67,0)
 .;
"RTN","SPNRPCF",68,0)
 .K SITPC
"RTN","SPNRPCF",69,0)
 .S SITPC=$P($$REFVAL^LRPXAPI("LRDFN;MI;RDATE;0"),U,5)
"RTN","SPNRPCF",70,0)
 .S SITESPEC=$$SPECNM^LRPXAPIU(SITPC)
"RTN","SPNRPCF",71,0)
 .Q:SITESPEC'["BLOOD"
"RTN","SPNRPCF",72,0)
 .;
"RTN","SPNRPCF",73,0)
 .S X=$P($$REFVAL^LRPXAPI("LRDFN;MI;RDATE;0"),U,7)
"RTN","SPNRPCF",74,0)
 .S PROVIDER=$$GET1^DIQ(200,X_",",.01)
"RTN","SPNRPCF",75,0)
 .;
"RTN","SPNRPCF",76,0)
 .S SPNCNT=SPNCNT+1
"RTN","SPNRPCF",77,0)
 .S ^TMP($J,"UTIL",RDATE,"A",SPNCNT)="BOR999"_U_ACCES_U_DATTAKE_U_COLSAMP_U_REPTYPE_U_REPORDT_U_SITESPEC_U_PROVIDER_U_LRDFN_U_RDATE_U_"EOL999"
"RTN","SPNRPCF",78,0)
 .D ORG
"RTN","SPNRPCF",79,0)
 .D BACT
"RTN","SPNRPCF",80,0)
 D KILL
"RTN","SPNRPCF",81,0)
 Q
"RTN","SPNRPCF",82,0)
ORG ;
"RTN","SPNRPCF",83,0)
 ;now build the organism tests for this record date
"RTN","SPNRPCF",84,0)
 S SUBCNT=0
"RTN","SPNRPCF",85,0)
 S ORNUM=$P($$REFVAL^LRPXAPI("LRDFN;MI;RDATE;3,0"),U,4)
"RTN","SPNRPCF",86,0)
 S ORIEN="" F A=1:1:ORNUM D  ;S ORIEN=$P($$REFVAL^LRPXAPI("LRDFN;MI;RDATE;3,A,0"),U,1) D:$G(ORIEN)
"RTN","SPNRPCF",87,0)
 .S X=$P($$REFVAL^LRPXAPI("LRDFN;MI;RDATE;3,A,0"),U,1,2)
"RTN","SPNRPCF",88,0)
 .Q:X=""
"RTN","SPNRPCF",89,0)
 .S Y=$P(X,U,1) S ORGNAM=$$BUGNM^LRPXAPIU(X)
"RTN","SPNRPCF",90,0)
 .S VALUE=$P($G(X),U,2)
"RTN","SPNRPCF",91,0)
 .S SUBCNT=SUBCNT+1 S ^TMP($J,"UTIL",RDATE,"B",SUBCNT)="ORGANISM999^"_ORGNAM_U_VALUE_U_"EOL999"
"RTN","SPNRPCF",92,0)
 .;build the organism text for this organism
"RTN","SPNRPCF",93,0)
 .S ORTXLI=$P($$REFVAL^LRPXAPI("LRDFN;MI;RDATE;3,A,1,0"),U,3)  ;number of lines for this organism
"RTN","SPNRPCF",94,0)
 .S TXTCNT=0
"RTN","SPNRPCF",95,0)
 .S ORTXIEN=0 F B=1:1:ORTXLI S ORTEXT=$P($$REFVAL^LRPXAPI("LRDFN;MI;RDATE;3,A,1,B,0"),U,1) D
"RTN","SPNRPCF",96,0)
 ..S TXTCNT=TXTCNT+1 S ^TMP($J,"UTIL",RDATE,"B",A,SUBCNT,TXTCNT)="TXT999^"_ORTEXT_U_"EOL999"
"RTN","SPNRPCF",97,0)
 Q
"RTN","SPNRPCF",98,0)
BACT ;now get the bact txt remarks
"RTN","SPNRPCF",99,0)
 ;^LR(62894,"MI",6958969.917954,4,0)=^63.061A^5^5
"RTN","SPNRPCF",100,0)
 S BACCNT=0
"RTN","SPNRPCF",101,0)
 S LINES=$P($$REFVAL^LRPXAPI("LRDFN;MI;RDATE;4,0"),U,3)  ;number of lines for the bact report remarks
"RTN","SPNRPCF",102,0)
 S LINEIEN=0 F REM=1:1:LINES S TEXT=$P($$REFVAL^LRPXAPI("LRDFN;MI;RDATE;4,REM,0"),U,1) D
"RTN","SPNRPCF",103,0)
 .S BACCNT=BACCNT+1 S ^TMP($J,"UTIL",RDATE,"D",BACCNT)="BACT_REMARKS999^"_TEXT_U_"EOL999"
"RTN","SPNRPCF",104,0)
 Q
"RTN","SPNRPCF",105,0)
KILL ;10/10/2006
"RTN","SPNRPCF",106,0)
 K %DT,ASSES,BACIEN,BACTEST,BACTIEN,CNT,COLSAMP,CUTDATE,DATA,DATREC,DEFSPE,DFN,ICN,LINE,LRDFN,ORG,ORGIEN,ORGNAM,ORGQTY
"RTN","SPNRPCF",107,0)
 K ORTTXT,ORTXT,PROVIDER,RDATE,REPORDT,REPOTYP,REVDT,ROTX,SITESPEC,SUB,SUBCNT,TXT
"RTN","SPNRPCF",108,0)
 K A,ACCES,B,BACCNT,DATTAKE,EDATE,LINEIEN,LINES,MORE,ORIEN,ORNUM,ORTEXT,ORTXIEN,ORTXLI
"RTN","SPNRPCF",109,0)
 K ORTXIEN,ORTXLI,REM,REPTYPE,SPNCNT,SPNTEST,SPNXX,TEXT,TSTDATA,TXTCNT,VALUE
"RTN","SPNRPCF",110,0)
 ;
"RTN","SPNRPCF",111,0)
 Q
"RTN","SPNRPCG")
0^54^B9080936
"RTN","SPNRPCG",1,0)
SPNRPCG ;SD/WDE - Returns PROSTHETIC DEVICES ;JUL 28, 2008
"RTN","SPNRPCG",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNRPCG",3,0)
 ;
"RTN","SPNRPCG",4,0)
 ; References to ^RMPR(660 supported by IA# 4975
"RTN","SPNRPCG",5,0)
 ; Reference to API PSASHCPC^RMPOPF supported by IA# 4975
"RTN","SPNRPCG",6,0)
 ; API $$FLIP^SPNRPCIC is part of Spinal Cord Version 3.0
"RTN","SPNRPCG",7,0)
 ;
"RTN","SPNRPCG",8,0)
 ;     dfn is ien of the pt
"RTN","SPNRPCG",9,0)
 ;     cutdate is the date to start collection data from
"RTN","SPNRPCG",10,0)
 ;     root is the sorted data in latest date of test first
"RTN","SPNRPCG",11,0)
 ; TMP WILL LOOK CONTAIN
"RTN","SPNRPCG",12,0)
 ; HCPCS CODE ^ ITEM DESCRIPTION ^ DATE DELIVERED ^ RMPR(IEN
"RTN","SPNRPCG",13,0)
 ;
"RTN","SPNRPCG",14,0)
COL(ROOT,ICN,CUTDATE) ;
"RTN","SPNRPCG",15,0)
 S X=CUTDATE S %DT="T" D ^%DT S CUTDATE=Y
"RTN","SPNRPCG",16,0)
 K ^TMP($J)
"RTN","SPNRPCG",17,0)
 S ROOT=$NA(^TMP($J))
"RTN","SPNRPCG",18,0)
 ;*********************************
"RTN","SPNRPCG",19,0)
 Q:$G(ICN)=""
"RTN","SPNRPCG",20,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNRPCG",21,0)
 Q:$G(DFN)=""
"RTN","SPNRPCG",22,0)
 ;********************************
"RTN","SPNRPCG",23,0)
 D BLDUTIL
"RTN","SPNRPCG",24,0)
 D RESORT
"RTN","SPNRPCG",25,0)
 K CNT,ORDER,CUTDATE,HCPCS,ITEMNAM,SHOWDT,REVDT
"RTN","SPNRPCG",26,0)
 K %DT,A,OLDCNT,X,Y,DFN,RMPRHCDT,RMPRHCPC,RMPREHC,RMPRTHC
"RTN","SPNRPCG",27,0)
 K ITEMNUM  ;WDE
"RTN","SPNRPCG",28,0)
 Q
"RTN","SPNRPCG",29,0)
 ;
"RTN","SPNRPCG",30,0)
 ;
"RTN","SPNRPCG",31,0)
BLDUTIL ;
"RTN","SPNRPCG",32,0)
 S CNT=1
"RTN","SPNRPCG",33,0)
 ;S ORDER=0 F  S ORDER=$O(^RMPR(664.1,"D",DFN,ORDER)) Q:(ORDER="")!('+ORDER)  D
"RTN","SPNRPCG",34,0)
 S ORDER=0 F  S ORDER=$O(^RMPR(660,"C",DFN,ORDER)) Q:(ORDER="")!('+ORDER)  D
"RTN","SPNRPCG",35,0)
 .;JAS 03-06-07 Sections below were modified to reflect new DBIAs
"RTN","SPNRPCG",36,0)
 .;I $P($G(^RMPR(664.1,ORDER,7)),U,2)<CUTDATE Q
"RTN","SPNRPCG",37,0)
 .;S Y=$P($G(^RMPR(664.1,ORDER,7)),U,2)
"RTN","SPNRPCG",38,0)
 .I $P($G(^RMPR(660,ORDER,0)),U,12)<CUTDATE Q
"RTN","SPNRPCG",39,0)
 .S Y=$P($G(^RMPR(660,ORDER,0)),U,12)
"RTN","SPNRPCG",40,0)
 .Q:Y<CUTDATE
"RTN","SPNRPCG",41,0)
 .S REVDT=9999999-Y
"RTN","SPNRPCG",42,0)
 .D DD^%DT S SHOWDT=Y
"RTN","SPNRPCG",43,0)
 .;JAS 03-06-07 Sections below were modified to reflect new DBIAs
"RTN","SPNRPCG",44,0)
 .;S ITEMIEN=0 F  S ITEMIEN=$O(^RMPR(664.1,ORDER,2,ITEMIEN)) Q:(ITEMIEN=0)!('+ITEMIEN)  D
"RTN","SPNRPCG",45,0)
 .;.S ITEMNUM=$P($G(^RMPR(664.1,ORDER,2,ITEMIEN,0)),U,1)
"RTN","SPNRPCG",46,0)
 .;.Q:ITEMNUM=""
"RTN","SPNRPCG",47,0)
 .;.S IFCAPITM=0 S IFCAPITM=$P($G(^RMPR(661,ITEMNUM,0)),U,1)
"RTN","SPNRPCG",48,0)
 .;.S HCPCS=$P($G(^RMPR(664.1,ORDER,2,ITEMIEN,2)),U,1)
"RTN","SPNRPCG",49,0)
 .;.I HCPCS="" S HCPCS="-----"
"RTN","SPNRPCG",50,0)
 .;.S HCPCS=$P($G(^RMPR(661.1,HCPCS,0)),U,1)
"RTN","SPNRPCG",51,0)
 .;.I HCPCS="" S HCPCS="-----"
"RTN","SPNRPCG",52,0)
 .;.S ITEMNAM="" S ITEMNAM=$P($G(^PRC(441,IFCAPITM,0)),U,2)
"RTN","SPNRPCG",53,0)
 .;.;W !,DFN W !?10,ITEMIEN,?18,ITEMNUM,?28,IFCAPITM,?35,ITEMNAM,!?28,HCPCS
"RTN","SPNRPCG",54,0)
 .;S ^TMP($J,"UTIL",REVDT,CNT)=HCPCS_U_ITEMNAM_U_SHOWDT_U_"RMPR(664.1("_ORDER
"RTN","SPNRPCG",55,0)
 .S RMPRHCDT=$P(^RMPR(660,ORDER,0),"^",1)
"RTN","SPNRPCG",56,0)
 .Q:'$D(^RMPR(660,ORDER,1))
"RTN","SPNRPCG",57,0)
 .S RMPRHCPC=$P(^RMPR(660,ORDER,1),"^",4)
"RTN","SPNRPCG",58,0)
 .Q:RMPRHCPC=""
"RTN","SPNRPCG",59,0)
 .D PSASHCPC^RMPOPF
"RTN","SPNRPCG",60,0)
 .S HCPCS=RMPREHC
"RTN","SPNRPCG",61,0)
 .I HCPCS="" S HCPCS="-----"
"RTN","SPNRPCG",62,0)
 .S ITEMNAM=RMPRTHC
"RTN","SPNRPCG",63,0)
 .S ^TMP($J,"UTIL",REVDT,CNT)=HCPCS_U_ITEMNAM_U_SHOWDT_U_"RMPR(660("_ORDER
"RTN","SPNRPCG",64,0)
 .S (HCPCS,ITEMNAM,ITEMNUM)=""
"RTN","SPNRPCG",65,0)
 .S CNT=CNT+1
"RTN","SPNRPCG",66,0)
 .Q
"RTN","SPNRPCG",67,0)
 Q
"RTN","SPNRPCG",68,0)
RESORT ;
"RTN","SPNRPCG",69,0)
 S CNT=""
"RTN","SPNRPCG",70,0)
 S REVDT="" F  S REVDT=$O(^TMP($J,"UTIL",REVDT)) Q:(REVDT="")!('+REVDT)  D
"RTN","SPNRPCG",71,0)
 .S OLDCNT="" F  S OLDCNT=$O(^TMP($J,"UTIL",REVDT,OLDCNT)) Q:(OLDCNT="")!('+OLDCNT)  D
"RTN","SPNRPCG",72,0)
 ..S CNT=CNT+1
"RTN","SPNRPCG",73,0)
 ..S ^TMP($J,CNT)=$G(^TMP($J,"UTIL",REVDT,OLDCNT))_"^EOL999"
"RTN","SPNRPCG",74,0)
 ..Q
"RTN","SPNRPCG",75,0)
 .Q
"RTN","SPNRPCG",76,0)
 K ^TMP($J,"UTIL")
"RTN","SPNRPCG",77,0)
 Q
"RTN","SPNRPCH")
0^55^B12245424
"RTN","SPNRPCH",1,0)
SPNRPCH ;SD/WDE - Returns PHARMACY RX'S WHEN AN RX MATCHES THE FIRST TWO CHAR;DEC 17, 2009
"RTN","SPNRPCH",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNRPCH",3,0)
 ;
"RTN","SPNRPCH",4,0)
 ;     INTEGRATION REFERENCE DBIA90-B
"RTN","SPNRPCH",5,0)
 ;     NTEGRATION REFERENCE   4820
"RTN","SPNRPCH",6,0)
 ;     INTEGRATION REFERENCES 4533
"RTN","SPNRPCH",7,0)
 ;
"RTN","SPNRPCH",8,0)
 ;
"RTN","SPNRPCH",9,0)
 ;
"RTN","SPNRPCH",10,0)
 ;
"RTN","SPNRPCH",11,0)
 ;NOTE  this routine will find prescriptions based on the
"RTN","SPNRPCH",12,0)
 ;THE FIRST TWO CHARACTERS IN THE NATIONAL DRUG CLASS
"RTN","SPNRPCH",13,0)
 ;ie IN, AM
"RTN","SPNRPCH",14,0)
 ;NOTE  To find prescriptions based on the WHOLE NDC USE SPNRPCI
"RTN","SPNRPCH",15,0)
 ;Parm values;
"RTN","SPNRPCH",16,0)
 ;ICN is THE icn of the pt
"RTN","SPNRPCH",17,0)
 ;CUTDATE is the date to start collection data from
"RTN","SPNRPCH",18,0)
 ;ROOT is the the global where the data is stored.
"RTN","SPNRPCH",19,0)
 ;TYPE will be for the drug class
"RTN","SPNRPCH",20,0)
 ;1 is rx's that have a drug class that
"RTN","SPNRPCH",21,0)
 ;begin with either a XA OR XX.
"RTN","SPNRPCH",22,0)
 ;2 LOOKS FOR RX's THAT THE NDC BEGINS WITH 'IM' AND THE 
"RTN","SPNRPCH",23,0)
 ;  DRUG NAME HAS INFLUENZA IN THE TEXT
"RTN","SPNRPCH",24,0)
 ;Returns:
"RTN","SPNRPCH",25,0)
 ;TMP($J,x) sorted by most recent rx
"RTN","SPNRPCH",26,0)
 ;VA CLASS ^ ITEM DESCRIPTION ^ DATE DISPENSED ^ PSRX(IEN
"RTN","SPNRPCH",27,0)
 ;
"RTN","SPNRPCH",28,0)
COL(ROOT,ICN,CUTDATE,TYPE) ;
"RTN","SPNRPCH",29,0)
 S X=CUTDATE S %DT="T" D ^%DT S CUTDATE=Y
"RTN","SPNRPCH",30,0)
 K ^TMP($J)
"RTN","SPNRPCH",31,0)
 S ROOT=$NA(^TMP($J))
"RTN","SPNRPCH",32,0)
 ;************************
"RTN","SPNRPCH",33,0)
 Q:ICN=""
"RTN","SPNRPCH",34,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNRPCH",35,0)
 Q:DFN=""
"RTN","SPNRPCH",36,0)
 ;************************
"RTN","SPNRPCH",37,0)
 D @TYPE
"RTN","SPNRPCH",38,0)
 D BLDUTIL
"RTN","SPNRPCH",39,0)
 D RESORT
"RTN","SPNRPCH",40,0)
 K RXORD,CNT,RXNUM,VACLASS,VACLASNA,COL,TYPE,DRUGNAM,VACLASDS,DESPDT
"RTN","SPNRPCH",41,0)
 K REVDT,SPNCNT,RXORD,RXNUM,SPNDRIEN,SPNDRNA,SPNDISP,CUTDATE,SPNREV,SPNCOL,SPNCLA
"RTN","SPNRPCH",42,0)
 K %DT,DFN,RXX,SHOWDT,TESTVAL,T,X,Y,TYPE,TESTVAL,SPNDISP,SPNDFN,DTZ
"RTN","SPNRPCH",43,0)
 Q
"RTN","SPNRPCH",44,0)
 ;
"RTN","SPNRPCH",45,0)
 ;
"RTN","SPNRPCH",46,0)
BLDUTIL ;
"RTN","SPNRPCH",47,0)
 S SPNCNT=0
"RTN","SPNRPCH",48,0)
 K ^TMP($J)
"RTN","SPNRPCH",49,0)
 D RX^PSO52API(DFN,"SPNSCRPT",,,0,2650101)
"RTN","SPNRPCH",50,0)
 Q:DFN=""
"RTN","SPNRPCH",51,0)
 Q:$G(^TMP($J,"SPNSCRPT",DFN,0))'>0
"RTN","SPNRPCH",52,0)
 ;RETURNS
"RTN","SPNRPCH",53,0)
 ;^TMP($J,"SPNSCRPT",4570,2367165,.01)=800085513
"RTN","SPNRPCH",54,0)
 ;          1)=2990514^MAY 14, 1999
"RTN","SPNRPCH",55,0)
 ;          6)=5721^OXYCODONE 5MG/ACETAMINOPHEN 325MG TA
"RTN","SPNRPCH",56,0)
 S RXNUM=0
"RTN","SPNRPCH",57,0)
 Q:DFN=""
"RTN","SPNRPCH",58,0)
 F  S RXNUM=$O(^TMP($J,"SPNSCRPT",DFN,RXNUM)) Q:RXNUM'>0  D
"RTN","SPNRPCH",59,0)
 .S SPNDRIEN=$P($G(^TMP($J,"SPNSCRPT",DFN,RXNUM,6)),U,1)  ;DRUG IEN
"RTN","SPNRPCH",60,0)
 .Q:SPNDRIEN=""
"RTN","SPNRPCH",61,0)
 .S SPNDRNA=$P($G(^TMP($J,"SPNSCRPT",DFN,RXNUM,6)),U,2)  ;DRUG NAME
"RTN","SPNRPCH",62,0)
 .Q:SPNDRNA=""
"RTN","SPNRPCH",63,0)
 .S SPNDISP=$P($G(^TMP($J,"SPNSCRPT",DFN,RXNUM,1)),U,1)  ;DISPENSE DATE
"RTN","SPNRPCH",64,0)
 .Q:SPNDISP=""
"RTN","SPNRPCH",65,0)
 .Q:SPNDISP<CUTDATE
"RTN","SPNRPCH",66,0)
 .S SPNREV=9999999-SPNDISP  ;USED TO SET UP FILE IN REVERSE ORDER
"RTN","SPNRPCH",67,0)
 .K ^TMP($J,"SPNPRE")
"RTN","SPNRPCH",68,0)
 .;--------------------------------------------------------------------
"RTN","SPNRPCH",69,0)
 .D ZERO^PSS50(,SPNDRIEN,,,,"SPNPRE")
"RTN","SPNRPCH",70,0)
 .;^TMP($J,"SPNPRE",5721,.01)=OXYCODONE 5MG/ACETAMINOPHEN 325MG TAB
"RTN","SPNRPCH",71,0)
 .;                      2)=CN101
"RTN","SPNRPCH",72,0)
 .;-----------------------------------------------------------------------
"RTN","SPNRPCH",73,0)
 .S SPNCLA=$P($G(^TMP($J,"SPNPRE",SPNDRIEN,2)),U,1)
"RTN","SPNRPCH",74,0)
 .;JAS - DEFECT 1183 - Check to quit if drug is missing VA Class
"RTN","SPNRPCH",75,0)
 .Q:SPNCLA=""
"RTN","SPNRPCH",76,0)
 .S SPNCOL=0
"RTN","SPNRPCH",77,0)
 .I $G(TESTVAL($E(SPNCLA,1,2)))'="" D
"RTN","SPNRPCH",78,0)
 ..S SPNCOL=1
"RTN","SPNRPCH",79,0)
 .I TYPE=2 D
"RTN","SPNRPCH",80,0)
 ..I SPNDRNA'["INFLUENZA" S SPNCOL=0
"RTN","SPNRPCH",81,0)
 .I SPNCOL=1 D
"RTN","SPNRPCH",82,0)
 ..S SPNCNT=SPNCNT+1
"RTN","SPNRPCH",83,0)
 ..S Y=SPNDISP D DD^%DT S SPNDISP=Y
"RTN","SPNRPCH",84,0)
 ..S ^TMP($J,"KEEP",SPNREV,SPNCNT)=SPNCLA_U_SPNDRNA_U_SPNDISP_U_"PSRX("_RXNUM
"RTN","SPNRPCH",85,0)
 .K ^TMP($J,"SPNPRE")
"RTN","SPNRPCH",86,0)
 Q
"RTN","SPNRPCH",87,0)
RESORT ;
"RTN","SPNRPCH",88,0)
 S SPNCNT=0
"RTN","SPNRPCH",89,0)
 S SPNREVD=0 F  S SPNREVD=$O(^TMP($J,"KEEP",SPNREVD)) Q:(SPNREVD="")!('+SPNREVD)  D
"RTN","SPNRPCH",90,0)
 .S SPNX=0 F  S SPNX=$O(^TMP($J,"KEEP",SPNREVD,SPNX)) Q:(SPNX="")!('+SPNX)  D
"RTN","SPNRPCH",91,0)
 ..S SPNCNT=SPNCNT+1
"RTN","SPNRPCH",92,0)
 ..S ^TMP($J,SPNCNT)=$G(^TMP($J,"KEEP",SPNREVD,SPNX))_"^EOL999"
"RTN","SPNRPCH",93,0)
 K ^TMP($J,"UTIL")
"RTN","SPNRPCH",94,0)
 K ^TMP($J,"KEEP")
"RTN","SPNRPCH",95,0)
 K ^TMP($J,"SPNPRE")
"RTN","SPNRPCH",96,0)
 K ^TMP($J,"SPNSCRPT")
"RTN","SPNRPCH",97,0)
 K SPNREVD,SPNX,SPNCNT,Y,SPZZ,SPNTMP
"RTN","SPNRPCH",98,0)
 Q
"RTN","SPNRPCH",99,0)
1 ;Prosticis Rx's
"RTN","SPNRPCH",100,0)
 ;TO SET UP LOCAL ARRAY FOR TESTING
"RTN","SPNRPCH",101,0)
 S TESTVAL("XA")="XA"
"RTN","SPNRPCH",102,0)
 S TESTVAL("XX")="XX"
"RTN","SPNRPCH",103,0)
 Q
"RTN","SPNRPCH",104,0)
2 ;DRUG CLASS IM
"RTN","SPNRPCH",105,0)
 S TESTVAL("IM")="IM"
"RTN","SPNRPCH",106,0)
 Q
"RTN","SPNRPCI")
0^56^B18057216
"RTN","SPNRPCI",1,0)
SPNRPCI ;SD/WDE - Returns PHARMACY RX'S WITH A SPECIFIC NDC;DEC 17, 2009
"RTN","SPNRPCI",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNRPCI",3,0)
 ;
"RTN","SPNRPCI",4,0)
 ;      INTEGRATION REFERENCE DBIA90-B
"RTN","SPNRPCI",5,0)
 ;      INTEGRATION REFERENCE 4820
"RTN","SPNRPCI",6,0)
 ;      INTEGRATION REFERENCE 4533
"RTN","SPNRPCI",7,0)
 ;                       
"RTN","SPNRPCI",8,0)
 ;      
"RTN","SPNRPCI",9,0)
 ;      
"RTN","SPNRPCI",10,0)
 ;      
"RTN","SPNRPCI",11,0)
 ;      
"RTN","SPNRPCI",12,0)
 ;      NOTE  this routine will find prescriptions based on the
"RTN","SPNRPCI",13,0)
 ;       WHOLE VALUE of the NATIONAL DRUG CLASS
"RTN","SPNRPCI",14,0)
 ;          ie IN160, AM80
"RTN","SPNRPCI",15,0)
 ;     NOTE   To find prescriptions based on the first two characters
"RTN","SPNRPCI",16,0)
 ;             of the NATIONAL DRUG CLASS USE SPNRPCH
"RTN","SPNRPCI",17,0)
 ;Parm values;
"RTN","SPNRPCI",18,0)
 ;     ICN is ICN of the pt
"RTN","SPNRPCI",19,0)
 ;     cutdate is the date to start collection data from
"RTN","SPNRPCI",20,0)
 ;     root is the sorted data in latest date of test first
"RTN","SPNRPCI",21,0)
 ;     type will be for the drug class
"RTN","SPNRPCI",22,0)
 ;       1 is anti-viral medications
"RTN","SPNRPCI",23,0)
 ;       2 is NSAID analgesics
"RTN","SPNRPCI",24,0)
 ;       3 is Influenza Virus Vaccine Inj 0.5 ml
"RTN","SPNRPCI",25,0)
 ;       4 is anticonvulsants
"RTN","SPNRPCI",26,0)
 ;       5 is tricyclic antidepressants
"RTN","SPNRPCI",27,0)
 ;       6 is opioid analgesics
"RTN","SPNRPCI",28,0)
 ;       7 is local anesthetics
"RTN","SPNRPCI",29,0)
 ;       8 is other medications
"RTN","SPNRPCI",30,0)
 ;       9 is Pneumococcal Vaccination Pharmaceuticals (IM100)
"RTN","SPNRPCI",31,0)
 ;      10 is Pneumonia Medications
"RTN","SPNRPCI",32,0)
 ;
"RTN","SPNRPCI",33,0)
 ;Returns:
"RTN","SPNRPCI",34,0)
 ;TMP($J,x) sorted by most recent rx
"RTN","SPNRPCI",35,0)
 ;VA CLASS ^ ITEM DESCRIPTION ^ DATE DISPENSED ^ PSRX(IEN
"RTN","SPNRPCI",36,0)
 ;
"RTN","SPNRPCI",37,0)
COL(ROOT,ICN,CUTDATE,TYPE) ;
"RTN","SPNRPCI",38,0)
 S X=CUTDATE S %DT="T" D ^%DT S CUTDATE=Y
"RTN","SPNRPCI",39,0)
 K ^TMP($J)
"RTN","SPNRPCI",40,0)
 S ROOT=$NA(^TMP($J))
"RTN","SPNRPCI",41,0)
 ;***************************
"RTN","SPNRPCI",42,0)
 Q:$G(ICN)=""
"RTN","SPNRPCI",43,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNRPCI",44,0)
 Q:DFN=""
"RTN","SPNRPCI",45,0)
 ;*****************************
"RTN","SPNRPCI",46,0)
 D @TYPE
"RTN","SPNRPCI",47,0)
BLDUTIL ;
"RTN","SPNRPCI",48,0)
 Q:$D(^PS(55,DFN))=0
"RTN","SPNRPCI",49,0)
 S SPNCNT=0
"RTN","SPNRPCI",50,0)
 Q:DFN=""
"RTN","SPNRPCI",51,0)
 D RX^PSO52API(DFN,"SPNSCRPT",,,0,2650101)
"RTN","SPNRPCI",52,0)
 Q:$G(^TMP($J,"SPNSCRPT",DFN,0))'>0
"RTN","SPNRPCI",53,0)
 ;RETURNS                                                              
"RTN","SPNRPCI",54,0)
 ;^TMP($J,"SPNSCRPT",4570,2367165,.01)=800085513                     
"RTN","SPNRPCI",55,0)
 ;          1)=2990514^MAY 14, 1999                                    
"RTN","SPNRPCI",56,0)
 ;          6)=5721^OXYCODONE 5MG/ACETAMINOPHEN 325MG TA               
"RTN","SPNRPCI",57,0)
 S RXNUM=0
"RTN","SPNRPCI",58,0)
 Q:DFN=""
"RTN","SPNRPCI",59,0)
 F  S RXNUM=$O(^TMP($J,"SPNSCRPT",DFN,RXNUM)) Q:RXNUM'>0  D
"RTN","SPNRPCI",60,0)
 .S SPNDRIEN=$P($G(^TMP($J,"SPNSCRPT",DFN,RXNUM,6)),U,1)  ;DRUG IEN
"RTN","SPNRPCI",61,0)
 .Q:SPNDRIEN=""
"RTN","SPNRPCI",62,0)
 .S SPNDRNA=$P($G(^TMP($J,"SPNSCRPT",DFN,RXNUM,6)),U,2)  ;DRUG NAME
"RTN","SPNRPCI",63,0)
 .Q:SPNDRNA=""
"RTN","SPNRPCI",64,0)
 .S SPNDISP=$P($G(^TMP($J,"SPNSCRPT",DFN,RXNUM,1)),U,1)  ;DISPENSE DATE
"RTN","SPNRPCI",65,0)
 .Q:SPNDISP=""
"RTN","SPNRPCI",66,0)
 .K ^TMP($J,"SPNPRE")
"RTN","SPNRPCI",67,0)
 .;--------------------------------------------------------------------
"RTN","SPNRPCI",68,0)
 .D ZERO^PSS50(,SPNDRIEN,,,,"SPNPRE")
"RTN","SPNRPCI",69,0)
 .;^TMP($J,"SPNPRE",5721,.01)=OXYCODONE 5MG/ACETAMINOPHEN 325MG TAB
"RTN","SPNRPCI",70,0)
 .;                      2)=CN101
"RTN","SPNRPCI",71,0)
 .;-----------------------------------------------------------------------
"RTN","SPNRPCI",72,0)
 .S SPNCLA=$P($G(^TMP($J,"SPNPRE",SPNDRIEN,2)),U,1)
"RTN","SPNRPCI",73,0)
 .;JAS - DEFECT 1183 - Check to quit if drug is missing VA Class
"RTN","SPNRPCI",74,0)
 .Q:SPNCLA=""
"RTN","SPNRPCI",75,0)
 .I $G(TESTVAL(SPNCLA))'="" D
"RTN","SPNRPCI",76,0)
 ..Q:SPNDISP<CUTDATE
"RTN","SPNRPCI",77,0)
 ..S SPNCNT=SPNCNT+1
"RTN","SPNRPCI",78,0)
 ..S SPNREV=9999999-SPNDISP
"RTN","SPNRPCI",79,0)
 ..S Y=SPNDISP D DD^%DT S SPNDISP=Y K Y
"RTN","SPNRPCI",80,0)
 ..S ^TMP($J,"KEEP",SPNREV,SPNCNT)=SPNCLA_U_SPNDRNA_U_SPNDISP_"^PSRX("_RXNUM
"RTN","SPNRPCI",81,0)
 ;---------------------------------------------------------------------------------------
"RTN","SPNRPCI",82,0)
RESORT ;
"RTN","SPNRPCI",83,0)
 ;^TMP($J,"KEEP",7018890,359)
"RTN","SPNRPCI",84,0)
 S SPNCNT=0
"RTN","SPNRPCI",85,0)
 S SPNREV=0
"RTN","SPNRPCI",86,0)
 F  S SPNREV=$O(^TMP($J,"KEEP",SPNREV)) Q:(SPNREV="")!('+SPNREV)  S SPNX=0 F  S SPNX=$O(^TMP($J,"KEEP",SPNREV,SPNX)) Q:(SPNX="")!('+SPNX)  D
"RTN","SPNRPCI",87,0)
 .S SPNCNT=SPNCNT+1
"RTN","SPNRPCI",88,0)
 .S ^TMP($J,SPNCNT)=$G(^TMP($J,"KEEP",SPNREV,SPNX))_"^EOL999"
"RTN","SPNRPCI",89,0)
 .Q
"RTN","SPNRPCI",90,0)
 K SPNTMP,SPZZ,SPNDFN
"RTN","SPNRPCI",91,0)
 K ^TMP($J,"SPNSCRPT")
"RTN","SPNRPCI",92,0)
 K ^TMP($J,"UTIL")
"RTN","SPNRPCI",93,0)
 K ^TMP($J,"KEEP")
"RTN","SPNRPCI",94,0)
 K ^TMP($J,"SPNPRE")
"RTN","SPNRPCI",95,0)
 K TESTVAL
"RTN","SPNRPCI",96,0)
 K CNT,RXORD,RXNUM,VACLASS,VACLASNA,COL,VACLASDS,DESPDT,REVDT,TESTVAL
"RTN","SPNRPCI",97,0)
 K %DT,DFN,RXX,SHOWDT,X,Y,SPNREV,SPNX,SPNDISP,SPNDRNA,SPNCLA,SPNREV,CUTDATE,SPNCNT,SPNDRIEN
"RTN","SPNRPCI",98,0)
 Q
"RTN","SPNRPCI",99,0)
 ;-----------------------------------------------------------------------------------------
"RTN","SPNRPCI",100,0)
 ;JAS 03/26/2008 DEFECT 190 - ADD/REMOVE MEDS BEING RETRIEVED FOR REPORTING
"RTN","SPNRPCI",101,0)
1 ;anti-viral medications / influenza diagnoses and treatment report
"RTN","SPNRPCI",102,0)
 S TESTVAL("AM800")="AM800"
"RTN","SPNRPCI",103,0)
 S TESTVAL("IN160")="IN160"
"RTN","SPNRPCI",104,0)
 Q
"RTN","SPNRPCI",105,0)
2 ;nsaids analgesics / pain assessment and treatment report
"RTN","SPNRPCI",106,0)
 ;S TESTVAL("CN101")="CN101"
"RTN","SPNRPCI",107,0)
 ;S TESTVAL("CN102")="CN102"
"RTN","SPNRPCI",108,0)
 S TESTVAL("CN103")="CN103"
"RTN","SPNRPCI",109,0)
 ;S TESTVAL("MS102")="MS102"
"RTN","SPNRPCI",110,0)
 S TESTVAL("CN104")="CN104"
"RTN","SPNRPCI",111,0)
 S TESTVAL("CN100")="CN100"
"RTN","SPNRPCI",112,0)
 Q
"RTN","SPNRPCI",113,0)
 ;
"RTN","SPNRPCI",114,0)
3 ;Influenza Virus Vaccine Inj 0.5 ml Influenza immunization report
"RTN","SPNRPCI",115,0)
 S TESTVAL("IM700")="IM700"
"RTN","SPNRPCI",116,0)
 Q
"RTN","SPNRPCI",117,0)
 ;
"RTN","SPNRPCI",118,0)
4 ;anticonvulsants / pain assessment and treatment report
"RTN","SPNRPCI",119,0)
 S TESTVAL("CN400")="CN400"
"RTN","SPNRPCI",120,0)
 Q
"RTN","SPNRPCI",121,0)
 ;
"RTN","SPNRPCI",122,0)
5 ;is tricyclic antidepressants
"RTN","SPNRPCI",123,0)
 S TESTVAL("CN601")="CN601"
"RTN","SPNRPCI",124,0)
 Q
"RTN","SPNRPCI",125,0)
 ;
"RTN","SPNRPCI",126,0)
6 ;is opioid analgesics
"RTN","SPNRPCI",127,0)
 S TESTVAL("CN101")="CN101"
"RTN","SPNRPCI",128,0)
 Q
"RTN","SPNRPCI",129,0)
 ;
"RTN","SPNRPCI",130,0)
7 ;is local anesthetics
"RTN","SPNRPCI",131,0)
 S TESTVAL("CN204")="CN204"
"RTN","SPNRPCI",132,0)
 S TESTVAL("CN205")="CN205"
"RTN","SPNRPCI",133,0)
 S TESTVAL("DE650")="DE650"
"RTN","SPNRPCI",134,0)
 S TESTVAL("DE700")="DE700"
"RTN","SPNRPCI",135,0)
 Q
"RTN","SPNRPCI",136,0)
8 ;is other medications
"RTN","SPNRPCI",137,0)
 ;Note that this is a mixed group of class and have very specific 
"RTN","SPNRPCI",138,0)
 ;reason for being grouped like this
"RTN","SPNRPCI",139,0)
 S TESTVAL("CN900")="CN900"
"RTN","SPNRPCI",140,0)
 ;S TESTVAL("GA700")="GA700"
"RTN","SPNRPCI",141,0)
 S TESTVAL("IN500")="IN500"
"RTN","SPNRPCI",142,0)
 S TESTVAL("IN510")="IN510"
"RTN","SPNRPCI",143,0)
 S TESTVAL("GA605")="GA605"
"RTN","SPNRPCI",144,0)
 Q
"RTN","SPNRPCI",145,0)
9 ;is Pneumococcal Vaccination Pharmaceuticals (IM100)
"RTN","SPNRPCI",146,0)
 S TESTVAL("IM100")="IM100"
"RTN","SPNRPCI",147,0)
 Q
"RTN","SPNRPCI",148,0)
 ;
"RTN","SPNRPCI",149,0)
10 ;Pneumonia Medications
"RTN","SPNRPCI",150,0)
 S TESTVAL("IN970")="IN970"
"RTN","SPNRPCI",151,0)
 S TESTVAL("TN000")="TN000"
"RTN","SPNRPCI",152,0)
 S TESTVAL("TN200")="TN200"
"RTN","SPNRPCI",153,0)
 S TESTVAL("TN300")="TN300"
"RTN","SPNRPCI",154,0)
 S TESTVAL("TN900")="TN900"
"RTN","SPNRPCI",155,0)
 S TESTVAL("XA700")="XA700"
"RTN","SPNRPCI",156,0)
 S TESTVAL("XA701")="XA701"
"RTN","SPNRPCI",157,0)
 S TESTVAL("XA702")="XA702"
"RTN","SPNRPCI",158,0)
 S TESTVAL("XA703")="XA703"
"RTN","SPNRPCI",159,0)
 S TESTVAL("XA799")="XA799"
"RTN","SPNRPCI",160,0)
 Q
"RTN","SPNRPCIC")
0^57^B97795
"RTN","SPNRPCIC",1,0)
SPNRPCIC ;SD/WDE -FLIPS ICN TO DFN;Mar 07, 2007
"RTN","SPNRPCIC",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNRPCIC",3,0)
 ;
"RTN","SPNRPCIC",4,0)
 ;DBIA REFERENCE (#4938)
"RTN","SPNRPCIC",5,0)
 ;
"RTN","SPNRPCIC",6,0)
 ;  Input:
"RTN","SPNRPCIC",7,0)
 ;  DFN=DFN
"RTN","SPNRPCIC",8,0)
 ;  
"RTN","SPNRPCIC",9,0)
 ;
"RTN","SPNRPCIC",10,0)
FLIP(ICN) ;flips icn to dfn for
"RTN","SPNRPCIC",11,0)
 K DFN
"RTN","SPNRPCIC",12,0)
 S DFN="",DFN=$O(^DPT("AICN",ICN,DFN))
"RTN","SPNRPCIC",13,0)
 Q DFN
"RTN","SPNRPCIC",14,0)
 Q
"RTN","SPNRPCJ")
0^58^B16481640
"RTN","SPNRPCJ",1,0)
SPNRPCJ ;SD/WDE - Returns Discharge date and location ;JUL 28, 2008
"RTN","SPNRPCJ",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNRPCJ",3,0)
 ;
"RTN","SPNRPCJ",4,0)
 ; References to ^DGPT("B" supported by IA# 92
"RTN","SPNRPCJ",5,0)
 ; References to file 45 supported by IA# 92
"RTN","SPNRPCJ",6,0)
 ; References to ^DGPT(D0,0 & ^DGPT(D0,70 supported by IA# 4945
"RTN","SPNRPCJ",7,0)
 ; Reference to ^DIC(45.6 supported by IA# 4018
"RTN","SPNRPCJ",8,0)
 ; References to ^DGPM supported by IA# 4942
"RTN","SPNRPCJ",9,0)
 ; Reference to ^DIC(42 supported by IA# 10039
"RTN","SPNRPCJ",10,0)
 ; Reference to ^DG(405.4 supported by IA# 1380
"RTN","SPNRPCJ",11,0)
 ; API $$FLIP^SPNRPCIC is part of Spinal Cord Version 3.0
"RTN","SPNRPCJ",12,0)
 ;
"RTN","SPNRPCJ",13,0)
 ;   1 sort data by most recent Admission
"RTN","SPNRPCJ",14,0)
 ;   3 sort data by most recent Discharge
"RTN","SPNRPCJ",15,0)
 ;
"RTN","SPNRPCJ",16,0)
 ; Returns:
"RTN","SPNRPCJ",17,0)
 ; TMP($J,x) sorted by most recent first.
"RTN","SPNRPCJ",18,0)
 ; if 1
"RTN","SPNRPCJ",19,0)
 ;    Admission Location  ^ Admission Date ^ dgpt(ien
"RTN","SPNRPCJ",20,0)
 ; if 3
"RTN","SPNRPCJ",21,0)
 ;    Discharge Location  ^ Discharge Date ^ dgpt(ien
"RTN","SPNRPCJ",22,0)
 ;
"RTN","SPNRPCJ",23,0)
COL(ROOT,ICN,CUTDATE,TYPE) ;
"RTN","SPNRPCJ",24,0)
 S X=CUTDATE S %DT="T" D ^%DT S CUTDATE=Y
"RTN","SPNRPCJ",25,0)
 K ^TMP($J)
"RTN","SPNRPCJ",26,0)
 S ROOT=$NA(^TMP($J))
"RTN","SPNRPCJ",27,0)
 ;*************************************
"RTN","SPNRPCJ",28,0)
 Q:$G(ICN)=""
"RTN","SPNRPCJ",29,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNRPCJ",30,0)
 Q:DFN=""
"RTN","SPNRPCJ",31,0)
 ;*************************************
"RTN","SPNRPCJ",32,0)
 D BLD
"RTN","SPNRPCJ",33,0)
 D RESORT
"RTN","SPNRPCJ",34,0)
 K %DT,ADMBED,ADMDT,ADMIEN,ADMLOC
"RTN","SPNRPCJ",35,0)
 K CNT,DFN,DISDT,DISLOC,ICN,IEN,REVDT
"RTN","SPNRPCJ",36,0)
 K SHWADM,SHWDIS,SORTBY,X,Y
"RTN","SPNRPCJ",37,0)
 K DXLS,ICD1,ICD2,ICD3,ICD4,ICD5,ICD6,ICD7,ICD8,ICD9,ICD10
"RTN","SPNRPCJ",38,0)
 Q
"RTN","SPNRPCJ",39,0)
 ;
"RTN","SPNRPCJ",40,0)
 ;
"RTN","SPNRPCJ",41,0)
BLD ;
"RTN","SPNRPCJ",42,0)
 ;JAS - 05/15/08 - DEFECT 1090
"RTN","SPNRPCJ",43,0)
 ;S IEN="" F  S IEN=$O(^DGPT("B",DFN,IEN)) Q:(IEN="")!('+IEN)  D
"RTN","SPNRPCJ",44,0)
 S IEN=0 F  S IEN=$O(^DGPT("B",DFN,IEN)) Q:(IEN="")!('+IEN)  D
"RTN","SPNRPCJ",45,0)
 .I $P($G(^DGPT(IEN,0)),U,4)=1 Q  ;FEE BASIS RECORD
"RTN","SPNRPCJ",46,0)
 .;JAS 2/20/07 - DBIA Modifications
"RTN","SPNRPCJ",47,0)
 .;S ADMDT=$P($G(^DGPT(IEN,0)),U,2)
"RTN","SPNRPCJ",48,0)
 .S ADMDT=$$GET1^DIQ(45,IEN_",",2,"I")
"RTN","SPNRPCJ",49,0)
 .;JAS 2/20/07 - DBIA Modifications
"RTN","SPNRPCJ",50,0)
 .;S DISDT=$P($G(^DGPT(IEN,70)),U,1)
"RTN","SPNRPCJ",51,0)
 .S DISDT=$$GET1^DIQ(45,IEN_",",70,"I")
"RTN","SPNRPCJ",52,0)
 .S DISLOC=$P($G(^DGPT(IEN,70)),U,6)
"RTN","SPNRPCJ",53,0)
 .I +DISLOC S DISLOC=$P($G(^DIC(45.6,DISLOC,0)),U,1)
"RTN","SPNRPCJ",54,0)
 .I DISLOC="" S DISLOC="-----------"
"RTN","SPNRPCJ",55,0)
 .;GET adm location and bed from DGPM
"RTN","SPNRPCJ",56,0)
 .D DGPM
"RTN","SPNRPCJ",57,0)
 .D BLDUTIL
"RTN","SPNRPCJ",58,0)
 Q
"RTN","SPNRPCJ",59,0)
DGPM ;get adm location and bed
"RTN","SPNRPCJ",60,0)
 ;JAS - 05/15/08 - DEFECT 1090
"RTN","SPNRPCJ",61,0)
 ;S ADMIEN="" F  S ADMIEN=$O(^DGPM("B",ADMDT,ADMIEN)) Q:(ADMIEN="")!('+ADMIEN)  D
"RTN","SPNRPCJ",62,0)
 S ADMIEN=0 F  S ADMIEN=$O(^DGPM("B",ADMDT,ADMIEN)) Q:(ADMIEN="")!('+ADMIEN)  D
"RTN","SPNRPCJ",63,0)
 .I $P($G(^DGPM(ADMIEN,0)),U,3)'=DFN Q  ;safty check for same patient
"RTN","SPNRPCJ",64,0)
 .I $P($G(^DGPM(ADMIEN,0)),U,2)'=1 Q  ;not an admission movement
"RTN","SPNRPCJ",65,0)
 .S ADMLOC=$P($G(^DGPM(ADMIEN,0)),U,6)  ;ward pointer value
"RTN","SPNRPCJ",66,0)
 .I +ADMLOC S ADMLOC=$P($G(^DIC(42,ADMLOC,0)),U,1)  ;ward
"RTN","SPNRPCJ",67,0)
 .S ADMBED=$P($G(^DGPM(ADMIEN,0)),U,7)  ;Bed pointer value
"RTN","SPNRPCJ",68,0)
 .I +ADMBED S ADMBED=$P($G(^DG(405.4,ADMBED,0)),U,1)  ;Bed
"RTN","SPNRPCJ",69,0)
 .Q
"RTN","SPNRPCJ",70,0)
 Q
"RTN","SPNRPCJ",71,0)
 ;
"RTN","SPNRPCJ",72,0)
 ;
"RTN","SPNRPCJ",73,0)
BLDUTIL ;build TMP in Rev date order based on sort type
"RTN","SPNRPCJ",74,0)
 I TYPE="" S TYPE=1  ;sort by admission dt if null
"RTN","SPNRPCJ",75,0)
 I TYPE=2 Q:$G(DISDT)=""  ;sorted by discharge and not discharge date
"RTN","SPNRPCJ",76,0)
 S SORTBY=$S(TYPE=1:ADMDT,1:DISDT)
"RTN","SPNRPCJ",77,0)
 S REVDT=9999999.9999-SORTBY  ;Set the sort date up in rev order
"RTN","SPNRPCJ",78,0)
 I CUTDATE>SORTBY Q
"RTN","SPNRPCJ",79,0)
 S Y=ADMDT D DD^%DT S SHWADM=Y  ;adm dt in human format
"RTN","SPNRPCJ",80,0)
 S Y=DISDT D DD^%DT S SHWDIS=Y  ;dis dt in human format
"RTN","SPNRPCJ",81,0)
 S ^TMP($J,"UTIL",REVDT)=SHWADM_U_ADMLOC_U_ADMBED_U_SHWDIS_U_DISLOC_U_"DGPT("_IEN
"RTN","SPNRPCJ",82,0)
 S DXLS=$$GET1^DIQ(45,IEN_",",79)
"RTN","SPNRPCJ",83,0)
 S ICD2=$$GET1^DIQ(45,IEN_",",79.16)
"RTN","SPNRPCJ",84,0)
 S ICD3=$$GET1^DIQ(45,IEN_",",79.17)
"RTN","SPNRPCJ",85,0)
 S ICD4=$$GET1^DIQ(45,IEN_",",79.18)
"RTN","SPNRPCJ",86,0)
 S ICD5=$$GET1^DIQ(45,IEN_",",79.19)
"RTN","SPNRPCJ",87,0)
 S ^TMP($J,"UTIL",REVDT,1)="ICD1^"_DXLS_"^"_ICD2_"^"_ICD3_"^"_ICD4_"^"_ICD5
"RTN","SPNRPCJ",88,0)
 S ICD6=$$GET1^DIQ(45,IEN_",",79.201)
"RTN","SPNRPCJ",89,0)
 S ICD7=$$GET1^DIQ(45,IEN_",",79.21)
"RTN","SPNRPCJ",90,0)
 S ICD8=$$GET1^DIQ(45,IEN_",",79.22)
"RTN","SPNRPCJ",91,0)
 S ICD9=$$GET1^DIQ(45,IEN_",",79.23)
"RTN","SPNRPCJ",92,0)
 S ICD10=$$GET1^DIQ(45,IEN_",",79.24)
"RTN","SPNRPCJ",93,0)
 S ^TMP($J,"UTIL",REVDT,2)="ICD2^"_ICD6_"^"_ICD7_"^"_ICD8_"^"_ICD9_"^"_ICD10
"RTN","SPNRPCJ",94,0)
 S (SHWADM,ADMLOC,ADMBED,SHWDIS,DISLOC)=""
"RTN","SPNRPCJ",95,0)
 Q
"RTN","SPNRPCJ",96,0)
 ;.Q:DESPDT<CUTDATE
"RTN","SPNRPCJ",97,0)
 ;.S Y=DESPDT D DD^%DT S SHOWDT=Y
"RTN","SPNRPCJ",98,0)
 ;.S REVDT=9999999-DESPDT
"RTN","SPNRPCJ",99,0)
 ;.S CNT=CNT+1
"RTN","SPNRPCJ",100,0)
 ;.S ^TMP($J,"UTIL",REVDT,CNT)=VACLASNA_U_VACLASDS_U_SHOWDT_U_"PSRX("_RXNUM
"RTN","SPNRPCJ",101,0)
 Q
"RTN","SPNRPCJ",102,0)
 ;
"RTN","SPNRPCJ",103,0)
 ;
"RTN","SPNRPCJ",104,0)
RESORT ;
"RTN","SPNRPCJ",105,0)
 S CNT=""
"RTN","SPNRPCJ",106,0)
 S REVDT=""
"RTN","SPNRPCJ",107,0)
 F  S REVDT=$O(^TMP($J,"UTIL",REVDT)) Q:(REVDT="")!('+REVDT)  D
"RTN","SPNRPCJ",108,0)
 .S CNT=CNT+1
"RTN","SPNRPCJ",109,0)
 .S ^TMP($J,CNT)=$G(^TMP($J,"UTIL",REVDT))_"^EOL999"
"RTN","SPNRPCJ",110,0)
 .S CNT=CNT+1
"RTN","SPNRPCJ",111,0)
 .S ^TMP($J,CNT)=$G(^TMP($J,"UTIL",REVDT,1))_"^EOL999"
"RTN","SPNRPCJ",112,0)
 .S CNT=CNT+1
"RTN","SPNRPCJ",113,0)
 .S ^TMP($J,CNT)=$G(^TMP($J,"UTIL",REVDT,2))_"^EOL999"
"RTN","SPNRPCJ",114,0)
 .Q
"RTN","SPNRPCJ",115,0)
 K ^TMP($J,"UTIL")  ;CLEAN OUT THE TEMP GLOBAL
"RTN","SPNRPCJ",116,0)
 Q
"RTN","SPNRPCL")
0^60^B16794514
"RTN","SPNRPCL",1,0)
SPNRPCL ;SD/WDE - Returns Lab test results for the complete blood count;JUL 01, 2008
"RTN","SPNRPCL",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNRPCL",3,0)
 ;
"RTN","SPNRPCL",4,0)
 ;   INTEGRATION REFERENCE INQUIRY #4245
"RTN","SPNRPCL",5,0)
 ;   INTEGRATION REFERENCE INQUIRY #4246
"RTN","SPNRPCL",6,0)
 ;
"RTN","SPNRPCL",7,0)
 ;Note that this routine does not list all of the drugs that
"RTN","SPNRPCL",8,0)
 ; spnrpce does.  This one is a shorter list.
"RTN","SPNRPCL",9,0)
 ;     dfn is ien of the pt
"RTN","SPNRPCL",10,0)
 ;     cutdate is the date to start collection data from
"RTN","SPNRPCL",11,0)
 ;     root is the sorted data in latest date of test first
"RTN","SPNRPCL",12,0)
 ;
"RTN","SPNRPCL",13,0)
COL(ROOT,ICN,CUTDATE) ;
"RTN","SPNRPCL",14,0)
 S X=CUTDATE D ^%DT S CUTDATE=Y
"RTN","SPNRPCL",15,0)
 K ^TMP($J)
"RTN","SPNRPCL",16,0)
 S ROOT=$NA(^TMP($J))
"RTN","SPNRPCL",17,0)
 ;********************************
"RTN","SPNRPCL",18,0)
 Q:$G(ICN)=""
"RTN","SPNRPCL",19,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNRPCL",20,0)
 Q:$G(DFN)=""
"RTN","SPNRPCL",21,0)
 ;********************************
"RTN","SPNRPCL",22,0)
 S LRDFN=$$LRDFN^LRPXAPIU(DFN) Q:LRDFN'>0
"RTN","SPNRPCL",23,0)
 D NEWT
"RTN","SPNRPCL",24,0)
 K SPNA,SPNB,SPNC,SPND,ITEMS,MORE,DATA,SPNCNT,SPNA,DATA,SPNREV,SPNTST,TESTS,Y,SPNDT
"RTN","SPNRPCL",25,0)
 K UPPER,LOWERM,UNIT,HILOW,VALUE,SPNZZZ,SPNX,ZZZ,Z,Y,TESTS,SPN,DFN,COL
"RTN","SPNRPCL",26,0)
 K LRDFN  ;WDE
"RTN","SPNRPCL",27,0)
 Q
"RTN","SPNRPCL",28,0)
NEWT ;
"RTN","SPNRPCL",29,0)
 K ^TMP($J),ITMES,TESTS
"RTN","SPNRPCL",30,0)
 K TESTS
"RTN","SPNRPCL",31,0)
 ;S DFN=141471   ;HAS TEST GROUPS 70,72 ONLY DAYT42 ACCOUNT
"RTN","SPNRPCL",32,0)
 ;S DFN=142920  ;HAS TEST GROUPS 70, 72 AND 73
"RTN","SPNRPCL",33,0)
 ; THIS WORKS D RESULTS^LRPXAPI(.ZZZ,DFN,"C",10,,"S=72") BUT I DONT HAVE THE NAME OF THE TEST
"RTN","SPNRPCL",34,0)
 ;get the test that the patient has received
"RTN","SPNRPCL",35,0)
 ;^LAB(61,70,0)=BLOOD^0X000^^^B^20
"RTN","SPNRPCL",36,0)
 ;^LAB(61,71,0)=URINE^7X100^^^U^15
"RTN","SPNRPCL",37,0)
 ;^LAB(61,72,0)=SERUM^0X500^^^S^4
"RTN","SPNRPCL",38,0)
 ;^LAB(61,73,0)=PLASMA^0X400^^^P^6
"RTN","SPNRPCL",39,0)
 ;^LAB(61,74,0)=CEREBROSPINAL FLUID^X1000^^  NOT INCLUDED IN THIS REPORT
"RTN","SPNRPCL",40,0)
 ;D TESTS^LRPXAPI(.TESTS,DFN)
"RTN","SPNRPCL",41,0)
 K SPNA,SPNB,SPNC,SPND
"RTN","SPNRPCL",42,0)
 S SPNCNT=0
"RTN","SPNRPCL",43,0)
 D TESTS^LRPXAPI(.SPNA,DFN,,,,"S=70")
"RTN","SPNRPCL",44,0)
 S SPN=0 F  S SPN=$O(SPNA(SPN)) Q:(SPN="")!('+SPN)  S SPNCNT=SPNCNT+1 S TESTS(SPN)=$G(SPNA(SPN))
"RTN","SPNRPCL",45,0)
 D TESTS^LRPXAPI(.SPNB,DFN,,,,"S=72")
"RTN","SPNRPCL",46,0)
 S SPN=0 F  S SPN=$O(SPNB(SPN)) Q:(SPN="")!('+SPN)  S SPNCNT=SPNCNT+1 S TESTS(SPN)=$G(SPNB(SPN))
"RTN","SPNRPCL",47,0)
 D TESTS^LRPXAPI(.SPNC,DFN,,,,"S=73")
"RTN","SPNRPCL",48,0)
 S SPN=0 F  S SPN=$O(SPNC(SPN)) Q:(SPN="")!('+SPN)  S SPNCNT=SPNCNT+1 S TESTS(SPN)=$G(SPNC(SPN))
"RTN","SPNRPCL",49,0)
 K SPNA,SPNB,SPNC
"RTN","SPNRPCL",50,0)
 F  D  Q:'MORE
"RTN","SPNRPCL",51,0)
  . D RESULTS^LRPXAPI(.ITEMS,DFN,"C",100,.MORE)
"RTN","SPNRPCL",52,0)
  . M ^TMP("SPN",$J)=ITEMS
"RTN","SPNRPCL",53,0)
  ;NOW RESORT THE DATA AND BUILD THE STRING WE WANT
"RTN","SPNRPCL",54,0)
  ;            "-3050303 5270")=3050303^5270^1^61.1^^82400.0000!!!3216!!!5270^2936^72!60!!!^^^^55
"RTN","SPNRPCL",55,0)
  K ITEMS
"RTN","SPNRPCL",56,0)
  S SPNCNT=0,DATA=""
"RTN","SPNRPCL",57,0)
  S SPNA=0 F  S SPNA=$O(^TMP("SPN",$J,SPNA)) Q:SPNA=""  D
"RTN","SPNRPCL",58,0)
 .S DATA=$G(^TMP("SPN",$J,SPNA))
"RTN","SPNRPCL",59,0)
 .Q:DATA=""
"RTN","SPNRPCL",60,0)
 .S SPNREV="-"_$P(DATA,U,1)  ;MINUS DATE THING
"RTN","SPNRPCL",61,0)
 .I $P(DATA,U,1)<CUTDATE Q
"RTN","SPNRPCL",62,0)
 .S Y=$P(DATA,U,1) D DD^%DT S SPNDT=Y
"RTN","SPNRPCL",63,0)
 .S SPNTST=$P(DATA,U,2)
"RTN","SPNRPCL",64,0)
 .Q:$G(TESTS(SPNTST))=""  ;IS NOT A TEST THAT WE WANT
"RTN","SPNRPCL",65,0)
 .S SPNTENA=$P($G(TESTS(SPNTST)),U,2)
"RTN","SPNRPCL",66,0)
 .;SCREEN FOR TEST WE WANT
"RTN","SPNRPCL",67,0)
 .S COL=0
"RTN","SPNRPCL",68,0)
 .I COL=0 I SPNTENA["WBC" S COL=1
"RTN","SPNRPCL",69,0)
 .I COL=0 I SPNTENA["HGB" S COL=1
"RTN","SPNRPCL",70,0)
 .I COL=0 I SPNTENA["HCT" S COL=1
"RTN","SPNRPCL",71,0)
 .I COL=0 I SPNTENA["PROTEIN" S COL=1
"RTN","SPNRPCL",72,0)
 .I COL=0 I SPNTENA["WINTROB" S COL=1
"RTN","SPNRPCL",73,0)
 .I COL=0 I SPNTENA["WESTERGR" S COL=1
"RTN","SPNRPCL",74,0)
 .I COL=0 I SPNTENA["ESR" S COL=1
"RTN","SPNRPCL",75,0)
 .I COL=0 I SPNTENA["C-REACTIVE" S COL=1
"RTN","SPNRPCL",76,0)
 .I COL=0 I SPNTENA["CRP" S COL=1
"RTN","SPNRPCL",77,0)
 .I COL=0 I SPNTENA["ZINC" S COL=1
"RTN","SPNRPCL",78,0)
 .I COL=0 I SPNTENA["VITAMIN A" S COL=1
"RTN","SPNRPCL",79,0)
 .I COL=0 I SPNTENA["VITAMIN C" S COL=1
"RTN","SPNRPCL",80,0)
 .I COL=0 I SPNTENA["VITAMIN E" S COL=1
"RTN","SPNRPCL",81,0)
 .I COL=0 I SPNTENA["LYMPHS" S COL=1
"RTN","SPNRPCL",82,0)
 .I COL=0 I SPNTENA["TRANSTHYRE" S COL=1
"RTN","SPNRPCL",83,0)
 .I COL=0 I SPNTENA["ALBUMI" S COL=1
"RTN","SPNRPCL",84,0)
 .I COL=0 I SPNTENA["TRANSFERRIN" S COL=1
"RTN","SPNRPCL",85,0)
 .Q:COL=0  ;TEST DOES NOT MAKE IT
"RTN","SPNRPCL",86,0)
 .S LOWER=$P(DATA,"!",5)  ;lower range
"RTN","SPNRPCL",87,0)
 .S UPPER=$P(DATA,"!",6)  ;upper range
"RTN","SPNRPCL",88,0)
 .S SPNZZZ=$P(DATA,U,8) S UNIT=$P(SPNZZZ,"!",7) K SPNZZZ
"RTN","SPNRPCL",89,0)
 .S ZZ="" F Z=1:1:$L(UNIT) I $E(UNIT,Z)'=" " S ZZ=ZZ_$E(UNIT,Z)  ;Strip off the blanks
"RTN","SPNRPCL",90,0)
 .S UNIT=ZZ K ZZ,X
"RTN","SPNRPCL",91,0)
 .S HILOW=$P(DATA,U,5)
"RTN","SPNRPCL",92,0)
 .S VALUE=$P(DATA,U,4)
"RTN","SPNRPCL",93,0)
 .S SPNCNT=SPNCNT+1
"RTN","SPNRPCL",94,0)
 .S ^TMP($J,"BEFORE",SPNREV,SPNCNT)=SPNDT_U_SPNTENA_U_VALUE_U_HILOW_U_UNIT_U_LOWER_U_UPPER_U_"EOL999"
"RTN","SPNRPCL",95,0)
 .K SPNTENA,LOWER,UPPER,UNIT,SPNTENA,HILOW,VALUE,DATA
"RTN","SPNRPCL",96,0)
REDO ;RESORT THE TEMP GLOBAL
"RTN","SPNRPCL",97,0)
 S SPNCNT=0
"RTN","SPNRPCL",98,0)
 S SPNREV="" F  S SPNREV=$O(^TMP($J,"BEFORE",SPNREV)) Q:SPNREV=""  S SPNX=0 F  S SPNX=$O(^TMP($J,"BEFORE",SPNREV,SPNX)) Q:SPNX=""  D
"RTN","SPNRPCL",99,0)
 .S SPNCNT=SPNCNT+1
"RTN","SPNRPCL",100,0)
 .S ^TMP($J,SPNCNT)=$G(^TMP($J,"BEFORE",SPNREV,SPNX))
"RTN","SPNRPCL",101,0)
 K ^TMP($J,"BEFORE")
"RTN","SPNRPCL",102,0)
 K ^TMP("SPN",$J)
"RTN","SPNRPCM")
0^61^B21192373
"RTN","SPNRPCM",1,0)
SPNRPCM ;SD/WDE - Returns Lab test results for CYTOPATHOLOGY;JUL 28, 2008
"RTN","SPNRPCM",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNRPCM",3,0)
 ;
"RTN","SPNRPCM",4,0)
 ;   INTEGRATION REFERENCE INQUIRY #4245
"RTN","SPNRPCM",5,0)
 ;   INTEGRATION REFERENCE INQUIRY #4246
"RTN","SPNRPCM",6,0)
 ;
"RTN","SPNRPCM",7,0)
 ;     dfn is ien of the pt
"RTN","SPNRPCM",8,0)
 ;     cutdate is the date to start collection data from
"RTN","SPNRPCM",9,0)
 ;     root is the sorted data in latest date of test first
"RTN","SPNRPCM",10,0)
 ;  loops through the lr file and looks at these specific subscripts
"RTN","SPNRPCM",11,0)
 ;              "CY"
"RTN","SPNRPCM",12,0)
 ;
"RTN","SPNRPCM",13,0)
 ;==============================================================================
"RTN","SPNRPCM",14,0)
COL(ROOT,ICN,SDATE) ;
"RTN","SPNRPCM",15,0)
 K ^TMP($J)
"RTN","SPNRPCM",16,0)
 K ARRAY
"RTN","SPNRPCM",17,0)
 S ROOT=$NA(^TMP($J))
"RTN","SPNRPCM",18,0)
 ;***************************
"RTN","SPNRPCM",19,0)
 Q:$G(ICN)=""
"RTN","SPNRPCM",20,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNRPCM",21,0)
 Q:DFN=""
"RTN","SPNRPCM",22,0)
 ;****************************
"RTN","SPNRPCM",23,0)
 ;NEWT(ROOT,ICN,SDATE,EDATE)     ;
"RTN","SPNRPCM",24,0)
 D NOW^%DTC S EDATE=X
"RTN","SPNRPCM",25,0)
 S X=SDATE S %DT="T" D ^%DT S SDATE=Y
"RTN","SPNRPCM",26,0)
 ;ONLY THE BEGINNING DATE IS PASSED IN.  COLLECT DATA FROM THAT DATE UPTO THE CURRENT DATE.
"RTN","SPNRPCM",27,0)
 K ^TMP($J)
"RTN","SPNRPCM",28,0)
 K ^TMP("SPN",$J)
"RTN","SPNRPCM",29,0)
 K ITEMS
"RTN","SPNRPCM",30,0)
 ;***************************
"RTN","SPNRPCM",31,0)
 Q:$G(ICN)=""
"RTN","SPNRPCM",32,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNRPCM",33,0)
 Q:DFN=""
"RTN","SPNRPCM",34,0)
 ;
"RTN","SPNRPCM",35,0)
 S LRDFN=$$LRDFN^LRPXAPIU(DFN)  ;
"RTN","SPNRPCM",36,0)
 F  D  Q:'MORE
"RTN","SPNRPCM",37,0)
 . D RESULTS^LRPXAPI(.ITEMS,DFN,"A",,.MORE,,SDATE,EDATE)
"RTN","SPNRPCM",38,0)
 . M ^TMP("SPN",$J)=ITEMS
"RTN","SPNRPCM",39,0)
 K ITEMS
"RTN","SPNRPCM",40,0)
 ;
"RTN","SPNRPCM",41,0)
 S SPNXX=0 F A=1:1 S SPNXX=$O(^TMP("SPN",$J,SPNXX)) Q:SPNXX=""  D
"RTN","SPNRPCM",42,0)
 .S TSTDATA=$G(^TMP("SPN",$J,SPNXX))
"RTN","SPNRPCM",43,0)
 .S X=$P(TSTDATA,U,1)
"RTN","SPNRPCM",44,0)
 .S X=$$LRIDT^LRPXAPIU(X)
"RTN","SPNRPCM",45,0)
 .S ARRAY(X)=TSTDATA
"RTN","SPNRPCM",46,0)
 .;AT THIS POINT ARRAY ONLY CONTAINS THE TOP LEVEL DATA FOR THE TESTS DONE
"RTN","SPNRPCM",47,0)
 S SPNTDT=0 F  S SPNTDT=$O(ARRAY(SPNTDT)) Q:SPNTDT=""  D
"RTN","SPNRPCM",48,0)
 .S SPNDATA=$G(ARRAY(SPNTDT))
"RTN","SPNRPCM",49,0)
 .;check for accession number if no number pass up record
"RTN","SPNRPCM",50,0)
 .S SPNACC=$P($$REFVAL^LRPXAPI("LRDFN;CY;SPNTDT;0"),U,6)
"RTN","SPNRPCM",51,0)
 .I SPNACC="" K SPNDATA Q
"RTN","SPNRPCM",52,0)
 .;-------------------------------------------------------------
"RTN","SPNRPCM",53,0)
 .;S SPECIMEN=$P($G(^LR(LRDFN,"CY",RDATE,.1,1,0)),U,1)
"RTN","SPNRPCM",54,0)
 .;note that this is a multiple and we show all of the specimens in the BOSCP999 section
"RTN","SPNRPCM",55,0)
 .;and the first one is also on the BOR proportion of the data stream
"RTN","SPNRPCM",56,0)
 .;i collect boscp and the bor value here
"RTN","SPNRPCM",57,0)
 .S X="" S X=$P($$REFVAL^LRPXAPI("LRDFN;CY;SPNTDT;"".1"",0"),U,3)
"RTN","SPNRPCM",58,0)
 .S SPNSUB=0,SPNCOL=""
"RTN","SPNRPCM",59,0)
 .F SPN=1:1:X D
"RTN","SPNRPCM",60,0)
 ..S Y="" S Y=$P($$REFVAL^LRPXAPI("LRDFN;CY;SPNTDT;.1,SPN,0"),U,1)
"RTN","SPNRPCM",61,0)
 ..Q:Y=""
"RTN","SPNRPCM",62,0)
 ..S SPNSUB=SPNSUB+1 S ^TMP($J,"UTIL",SPNTDT,"G",SPNSUB)="BOSCP999^"_Y_U_"EOL999"
"RTN","SPNRPCM",63,0)
 ..I SPNCOL="" S SPNCOL=Y  ;the first one for the bor marker
"RTN","SPNRPCM",64,0)
 ..; this may seem back wards but it seems ok now at this point we have the first one for the bor stream
"RTN","SPNRPCM",65,0)
 .S SPNACC=$P($$REFVAL^LRPXAPI("LRDFN;CY;SPNTDT;0"),U,6)
"RTN","SPNRPCM",66,0)
 .K Y
"RTN","SPNRPCM",67,0)
 .S Y=$$LRIDT^LRPXAPIU(SPNTDT) D DD^%DT S SPNSHDT=Y
"RTN","SPNRPCM",68,0)
 .S SPNCNT=0
"RTN","SPNRPCM",69,0)
 .S SPNCNT=SPNCNT+1 S ^TMP($J,"UTIL",SPNTDT,"A",SPNCNT)="BOR999^"_SPNCOL_U_SPNSHDT_U_SPNACC_"^LR("_SPNTDT_"EOL999"
"RTN","SPNRPCM",70,0)
 .;now set up the MICROSCOPIC EXAMINATION text held at "cy",date,1.1
"RTN","SPNRPCM",71,0)
 .S SPNSCNT=1 S ^TMP($J,"UTIL",SPNTDT,"B",SPNSCNT)="BOME^EOL999"
"RTN","SPNRPCM",72,0)
 .S SPNLINZ=$P($$REFVAL^LRPXAPI("LRDFN;CY;SPNTDT;1.1,0"),U,3)
"RTN","SPNRPCM",73,0)
 .S SPNTXT="" F SPNZB=1:1:SPNLINZ D
"RTN","SPNRPCM",74,0)
 ..S X=$P($$REFVAL^LRPXAPI("LRDFN;CY;SPNTDT;1.1,SPNZB,0"),U,1)
"RTN","SPNRPCM",75,0)
 ..S SPNSCNT=SPNSCNT+1 S ^TMP($J,"UTIL",SPNTDT,"B",SPNSCNT)=X_"^EOL999"
"RTN","SPNRPCM",76,0)
 .;now set up the operative finding
"RTN","SPNRPCM",77,0)
 .S (SPNSCNT,SPNLINZ,SPNTXT,X,SPNZB)=""
"RTN","SPNRPCM",78,0)
 .S SPNSCNT=1 S ^TMP($J,"UTIL",SPNTDT,"C",SPNSCNT)="BOOF^EOL999"
"RTN","SPNRPCM",79,0)
 .S SPNLINZ=$P($$REFVAL^LRPXAPI("LRDFN;CY;SPNTDT;.4,0"),U,3)
"RTN","SPNRPCM",80,0)
 .S SPNTXT="" F SPNZB=1:1:SPNLINZ D
"RTN","SPNRPCM",81,0)
 ..S X=$P($$REFVAL^LRPXAPI("LRDFN;CY;SPNTDT;.4,SPNZB,0"),U,1)
"RTN","SPNRPCM",82,0)
 ..S SPNSCNT=SPNSCNT+1 S ^TMP($J,"UTIL",SPNTDT,"C",SPNSCNT)=X_"^EOL999"
"RTN","SPNRPCM",83,0)
 .;now set up the Postoperative Diagnosis
"RTN","SPNRPCM",84,0)
 .S (SPNSCNT,SPNLINZ,SPNTXT,X,SPNZB)=""
"RTN","SPNRPCM",85,0)
 .S SPNSCNT=1 S ^TMP($J,"UTIL",SPNTDT,"D",SPNSCNT)="BOPF^EOL999"
"RTN","SPNRPCM",86,0)
 .S SPNLINZ=$P($$REFVAL^LRPXAPI("LRDFN;CY;SPNTDT;.5,0"),U,3)
"RTN","SPNRPCM",87,0)
 .S SPNTXT="" F SPNZB=1:1:SPNLINZ D
"RTN","SPNRPCM",88,0)
 ..S X=$P($$REFVAL^LRPXAPI("LRDFN;CY;SPNTDT;.5,SPNZB,0"),U,1)
"RTN","SPNRPCM",89,0)
 ..S SPNSCNT=SPNSCNT+1 S ^TMP($J,"UTIL",SPNTDT,"D",SPNSCNT)=X_"^EOL999"
"RTN","SPNRPCM",90,0)
KILL ;
"RTN","SPNRPCM",91,0)
 K %DT,A,ACCE,B,COLSAMP,DATTAKE,DFN,EDATE,ICN,ITEMS,LINECT,ACCES,SITESPEC
"RTN","SPNRPCM",92,0)
 K LRDFN,MORE,ORGNAM,ORIEN,ORNUM,ORTEXT,ORTXIEN,ORTXLI,PROVIDER
"RTN","SPNRPCM",93,0)
 K RDATE,REPORDT,REPTYPE,SDATE,SITESPE,SITPC,SPNCNT,SPNTEST,SPNXX
"RTN","SPNRPCM",94,0)
 K SUBCNT,TEXT,TSTDATA,TXTCNT,VALUE,SPN,SPNACC,SPNCOL,SPNLINZ,SPNSCNT
"RTN","SPNRPCM",95,0)
 K SPNSHDT,SPNSUB,SPNTDT,SPNTXT,SPNZB,X,Y
"RTN","SPNRPCM",96,0)
 Q
"RTN","SPNRPCN")
0^62^B14508746
"RTN","SPNRPCN",1,0)
SPNRPCN ;SD/WDE - Returns Lab test results for SURGICAL PATHOLOGY;JUL 28, 2008
"RTN","SPNRPCN",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNRPCN",3,0)
 ;
"RTN","SPNRPCN",4,0)
 ;   INTEGRATION REFERENCE INQUIRY #4245
"RTN","SPNRPCN",5,0)
 ;   INTEGRATION REFERENCE INQUIRY #4246
"RTN","SPNRPCN",6,0)
 ;
"RTN","SPNRPCN",7,0)
 ;
"RTN","SPNRPCN",8,0)
 ;
"RTN","SPNRPCN",9,0)
COL(ROOT,ICN,SDATE) ;
"RTN","SPNRPCN",10,0)
 K ^TMP($J)
"RTN","SPNRPCN",11,0)
 K ^TMP("SPN",$J)
"RTN","SPNRPCN",12,0)
 K SPNRECS
"RTN","SPNRPCN",13,0)
 S ROOT=$NA(^TMP($J))
"RTN","SPNRPCN",14,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNRPCN",15,0)
 S LRDFN=$$LRDFN^LRPXAPIU(DFN)  ;
"RTN","SPNRPCN",16,0)
 D NOW^%DTC S EDATE=X
"RTN","SPNRPCN",17,0)
 S X=SDATE S %DT="T" D ^%DT S SDATE=Y
"RTN","SPNRPCN",18,0)
 F  D  Q:'MORE
"RTN","SPNRPCN",19,0)
 . D RESULTS^LRPXAPI(.ITEMS,DFN,"A",,.MORE,,SDATE,EDATE)
"RTN","SPNRPCN",20,0)
 . ;D RESULTS^LRPXAPI(.ITEMS,DFN,"A",,.MORE)
"RTN","SPNRPCN",21,0)
 . M ^TMP("SPN",$J)=ITEMS
"RTN","SPNRPCN",22,0)
 K ITEMS
"RTN","SPNRPCN",23,0)
MORE ;go through the test and check for the accession # at the "sp" subscript
"RTN","SPNRPCN",24,0)
 S SPNX="" F  S SPNX=$O(^TMP("SPN",$J,SPNX)) Q:SPNX=""  D
"RTN","SPNRPCN",25,0)
 .S SPNDTA=$G(^TMP("SPN",$J,SPNX))
"RTN","SPNRPCN",26,0)
 .S SPNX1=$P(SPNDTA,U,1)
"RTN","SPNRPCN",27,0)
 .S SPNRDT=$$LRIDT^LRPXAPIU(SPNX1)
"RTN","SPNRPCN",28,0)
 .S Z=$P($$REFVAL^LRPXAPI("LRDFN;SP;SPNRDT;0"),U,6)
"RTN","SPNRPCN",29,0)
 .I Z'="" S SPNRECS(SPNRDT)=Z_U_SPNX1
"RTN","SPNRPCN",30,0)
 ;Ok now only the records in spnrecs are the ones we want
"RTN","SPNRPCN",31,0)
 ;===========================================================
"RTN","SPNRPCN",32,0)
 S SPNTDT=0 F  S SPNTDT=$O(SPNRECS(SPNTDT)) Q:SPNTDT=""  D
"RTN","SPNRPCN",33,0)
 .S SPNCNT=0
"RTN","SPNRPCN",34,0)
 .S X="" S X=$P($$REFVAL^LRPXAPI("LRDFN;SP;SPNTDT;"".1"",0"),U,3)
"RTN","SPNRPCN",35,0)
 .;PUGET ERROR TRAP DEFECT 1058 (NEXT LINE) - 12/27/07
"RTN","SPNRPCN",36,0)
 .Q:X=""
"RTN","SPNRPCN",37,0)
 .S SPNSUB=0,SPNCOL=""
"RTN","SPNRPCN",38,0)
 .F SPN=1:1:X D
"RTN","SPNRPCN",39,0)
 ..S Y="" S Y=$P($$REFVAL^LRPXAPI("LRDFN;SP;SPNTDT;"".1"",SPN,0"),U,1)
"RTN","SPNRPCN",40,0)
 ..Q:Y=""
"RTN","SPNRPCN",41,0)
 ..I $L(Y) S SPNCSMP=Y S SPN=99999  ;throw out of spec loop we have one.
"RTN","SPNRPCN",42,0)
 .;----------------------------------------
"RTN","SPNRPCN",43,0)
 .S SPNCNT=SPNCNT+1
"RTN","SPNRPCN",44,0)
 .S Y=$$LRIDT^LRPXAPIU(SPNTDT) D DD^%DT S SPNDT=Y
"RTN","SPNRPCN",45,0)
 .S ^TMP($J,SPNTDT,"A",SPNCNT)="BOR999^"_SPNCSMP_U_Y_U_$P(SPNRECS(SPNTDT),U,1)_U_"LR("_LRDFN_",SP,"_SPNTDT_"^EOL999"
"RTN","SPNRPCN",46,0)
 .;----------------------------------------
"RTN","SPNRPCN",47,0)
 .S ^TMP($J,SPNTDT,"B",0)="BOGD999^EOL999"
"RTN","SPNRPCN",48,0)
 .S X="" S X=$P($$REFVAL^LRPXAPI("LRDFN;SP;SPNTDT;1,0"),U,3)
"RTN","SPNRPCN",49,0)
 .S SPNSUB=0
"RTN","SPNRPCN",50,0)
 .F SPN=1:1:X D
"RTN","SPNRPCN",51,0)
 ..S Y="" S Y=$P($$REFVAL^LRPXAPI("LRDFN;SP;SPNTDT;1,SPN,0"),U,1)
"RTN","SPNRPCN",52,0)
 ..S SPNSUB=SPNSUB+1 S ^TMP($J,SPNTDT,"B",SPNSUB)=Y_"^EOL999"
"RTN","SPNRPCN",53,0)
 ..Q:Y=""
"RTN","SPNRPCN",54,0)
 .;--------------------------------------------
"RTN","SPNRPCN",55,0)
 .;
"RTN","SPNRPCN",56,0)
 .S ^TMP($J,SPNTDT,"C",0)="BOMD999^EOL999"
"RTN","SPNRPCN",57,0)
 .S X="" S X=$P($$REFVAL^LRPXAPI("LRDFN;SP;SPNTDT;""1.1"",0"),U,3)
"RTN","SPNRPCN",58,0)
 .S SPNSUB=0
"RTN","SPNRPCN",59,0)
 .F SPN=1:1:X D
"RTN","SPNRPCN",60,0)
 ..S Y="" S Y=$P($$REFVAL^LRPXAPI("LRDFN;SP;SPNTDT;""1.1"",SPN,0"),U,1)
"RTN","SPNRPCN",61,0)
 ..S SPNSUB=SPNSUB+1 S ^TMP($J,SPNTDT,"C",SPNSUB)=Y_"^EOL999"
"RTN","SPNRPCN",62,0)
 ..Q:Y=""
"RTN","SPNRPCN",63,0)
 .;------------------------------------------------
"RTN","SPNRPCN",64,0)
 .;
"RTN","SPNRPCN",65,0)
 .S ^TMP($J,SPNTDT,"D",0)="BOF999^EOL999"
"RTN","SPNRPCN",66,0)
 .S X="" S X=$P($$REFVAL^LRPXAPI("LRDFN;SP;SPNTDT;"".4"",0"),U,3)
"RTN","SPNRPCN",67,0)
 .S SPNSUB=0
"RTN","SPNRPCN",68,0)
 .F SPN=1:1:X D
"RTN","SPNRPCN",69,0)
 ..S Y="" S Y=$P($$REFVAL^LRPXAPI("LRDFN;SP;SPNTDT;"".4"",SPN,0"),U,1)
"RTN","SPNRPCN",70,0)
 ..S SPNSUB=SPNSUB+1 S ^TMP($J,SPNTDT,"D",SPNSUB)=Y_"^EOL999"
"RTN","SPNRPCN",71,0)
 ..Q:Y=""
"RTN","SPNRPCN",72,0)
 .;------------------------------------------------
"RTN","SPNRPCN",73,0)
 .;
"RTN","SPNRPCN",74,0)
 .S ^TMP($J,SPNTDT,"E",0)="BOP999^EOL999"
"RTN","SPNRPCN",75,0)
 .S X="" S X=$P($$REFVAL^LRPXAPI("LRDFN;SP;SPNTDT;"".5"",0"),U,3)
"RTN","SPNRPCN",76,0)
 .S SPNSUB=0
"RTN","SPNRPCN",77,0)
 .F SPN=1:1:X D
"RTN","SPNRPCN",78,0)
 ..S Y="" S Y=$P($$REFVAL^LRPXAPI("LRDFN;SP;SPNTDT;"".5"",SPN,0"),U,1)
"RTN","SPNRPCN",79,0)
 ..S SPNSUB=SPNSUB+1 S ^TMP($J,SPNTDT,"E",SPNSUB)=Y_"^EOL999"
"RTN","SPNRPCN",80,0)
 ..Q:Y=""
"RTN","SPNRPCN",81,0)
 .;------------------------------------------------
"RTN","SPNRPCN",82,0)
 .;
"RTN","SPNRPCN",83,0)
 .S ^TMP($J,SPNTDT,"F",0)="BOSPD999^EOL999"
"RTN","SPNRPCN",84,0)
 .S X="" S X=$P($$REFVAL^LRPXAPI("LRDFN;SP;SPNTDT;""1.4"",0"),U,3)
"RTN","SPNRPCN",85,0)
 .S SPNSUB=0
"RTN","SPNRPCN",86,0)
 .F SPN=1:1:X D
"RTN","SPNRPCN",87,0)
 ..S Y="" S Y=$P($$REFVAL^LRPXAPI("LRDFN;SP;SPNTDT;""1.4"",SPN,0"),U,1)
"RTN","SPNRPCN",88,0)
 ..S SPNSUB=SPNSUB+1 S ^TMP($J,SPNTDT,"F",SPNSUB)=Y_"^EOL999"
"RTN","SPNRPCN",89,0)
 ..Q:Y=""
"RTN","SPNRPCN",90,0)
KILL ;
"RTN","SPNRPCN",91,0)
 K %DT,DFN,EDATE,LRDFN,MORE,SPN,SPNCNT,SPNCOL,SPNCSMP,SPNDT,SPNDATA
"RTN","SPNRPCN",92,0)
 K SPNSUB,SPNTDT,SPNX,SPNX1,X,Y,Z,SPNDTA,SPNRDT
"RTN","SPNRPCN",93,0)
 Q
"RTN","SPNRPCO")
0^63^B12699717
"RTN","SPNRPCO",1,0)
SPNRPCO ;SD/WDE - Returns Lab test results for MICROBIOLOGY;JUL 23, 2008
"RTN","SPNRPCO",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNRPCO",3,0)
 ;
"RTN","SPNRPCO",4,0)
 ;   INTEGRATION REFERENCE INQUIRY #4245
"RTN","SPNRPCO",5,0)
 ;   INTEGRATION REFERENCE INQUIRY #4246 ;
"RTN","SPNRPCO",6,0)
 ;
"RTN","SPNRPCO",7,0)
 ;
"RTN","SPNRPCO",8,0)
 ;     dfn is ien of the pt
"RTN","SPNRPCO",9,0)
 ;     cutdate is the date to start collection data from
"RTN","SPNRPCO",10,0)
 ;     root is the sorted data in latest date of test first
"RTN","SPNRPCO",11,0)
 ;  loops through the lr file and looks at these specific subscripts
"RTN","SPNRPCO",12,0)
 ;              "MI"
"RTN","SPNRPCO",13,0)
 ;
"RTN","SPNRPCO",14,0)
COL(ROOT,ICN,SPNSDT) ;
"RTN","SPNRPCO",15,0)
 ;
"RTN","SPNRPCO",16,0)
 K ^TMP($J)
"RTN","SPNRPCO",17,0)
 K SPNARRY
"RTN","SPNRPCO",18,0)
 S ROOT=$NA(^TMP($J))
"RTN","SPNRPCO",19,0)
 ;***************************
"RTN","SPNRPCO",20,0)
 Q:$G(ICN)=""
"RTN","SPNRPCO",21,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNRPCO",22,0)
 Q:DFN=""
"RTN","SPNRPCO",23,0)
 ;****************************
"RTN","SPNRPCO",24,0)
 ;NEWT(ROOT,ICN,SDATE,EDATE)     ;
"RTN","SPNRPCO",25,0)
 D NOW^%DTC S SPNEDT=X
"RTN","SPNRPCO",26,0)
 S X=SPNSDT S %DT="T" D ^%DT S SPNSDT=Y
"RTN","SPNRPCO",27,0)
 K Y,Y
"RTN","SPNRPCO",28,0)
 ;ONLY THE BEGINNING DATE IS PASSED IN.  COLLECT DATA FROM THAT DATE UP TO THE CURRENT DATE.
"RTN","SPNRPCO",29,0)
 K ^TMP($J)
"RTN","SPNRPCO",30,0)
 K ^TMP("SPN",$J)
"RTN","SPNRPCO",31,0)
 K SPNITEM
"RTN","SPNRPCO",32,0)
 ;***************************
"RTN","SPNRPCO",33,0)
 Q:$G(ICN)=""
"RTN","SPNRPCO",34,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNRPCO",35,0)
 Q:DFN=""
"RTN","SPNRPCO",36,0)
 S LRDFN=$$LRDFN^LRPXAPIU(DFN)
"RTN","SPNRPCO",37,0)
 F  D  Q:'MORE
"RTN","SPNRPCO",38,0)
  . D RESULTS^LRPXAPI(.SPNITEM,DFN,"M",,.MORE,,SPNSDT,SPNEDT)
"RTN","SPNRPCO",39,0)
  . M ^TMP("SPN",$J)=SPNITEM
"RTN","SPNRPCO",40,0)
 K SPNITEM
"RTN","SPNRPCO",41,0)
 ;
"RTN","SPNRPCO",42,0)
 S SPNXX=0 F A=1:1 S SPNXX=$O(^TMP("SPN",$J,SPNXX)) Q:SPNXX=""  D
"RTN","SPNRPCO",43,0)
 .S TSTDATA=$G(^TMP("SPN",$J,SPNXX))
"RTN","SPNRPCO",44,0)
 .S X=$P(TSTDATA,U,1)
"RTN","SPNRPCO",45,0)
 .S SPNARRY(X)=TSTDATA
"RTN","SPNRPCO",46,0)
 .;AT THIS POINT ARRAY ONLY CONTAINS THE TOP LEVEL DATA FOR THE TESTS DONE
"RTN","SPNRPCO",47,0)
 S SPNTEST=0 F  S SPNTEST=$O(SPNARRY(SPNTEST)) Q:SPNTEST=""  D
"RTN","SPNRPCO",48,0)
 .S SPNDATA=$G(SPNARRY(SPNTEST))
"RTN","SPNRPCO",49,0)
 .S SPNCNT=0
"RTN","SPNRPCO",50,0)
 .S RDATE=$P(SPNDATA,";",5)
"RTN","SPNRPCO",51,0)
 .K SITPC
"RTN","SPNRPCO",52,0)
 .S SITPC=$P($$REFVAL^LRPXAPI("LRDFN;MI;RDATE;0"),U,5)
"RTN","SPNRPCO",53,0)
 .S SITESPEC=$$SPECNM^LRPXAPIU(SITPC)
"RTN","SPNRPCO",54,0)
 .;Q:SITESPEC'["URINE"
"RTN","SPNRPCO",55,0)
 .S ACCES=$P($$REFVAL^LRPXAPI("LRDFN;MI;RDATE;0"),U,6)
"RTN","SPNRPCO",56,0)
 .S Y=$P($$REFVAL^LRPXAPI("LRDFN;MI;RDATE;0"),U,10) D DD^%DT S DATTAKE=Y
"RTN","SPNRPCO",57,0)
 .;
"RTN","SPNRPCO",58,0)
 .;
"RTN","SPNRPCO",59,0)
 .S X=$P($$REFVAL^LRPXAPI("LRDFN;MI;RDATE;0"),U,11) S COLSAMP=$$GET1^DIQ(62,X_",",.01)
"RTN","SPNRPCO",60,0)
 .I COLSAMP="" S COLSAMP="ERROR ON COLSAMP"
"RTN","SPNRPCO",61,0)
 .S REPTYPE=$P($$REFVAL^LRPXAPI("LRDFN;MI;RDATE;1"),U,2)
"RTN","SPNRPCO",62,0)
 .;S REPTYPE=$S(REPTYPE="P":"Preliminary",REPTYPE="F":"Final",1:"-----")
"RTN","SPNRPCO",63,0)
 .S Y=$P($$REFVAL^LRPXAPI("LRDFN;MI;RDATE;1"),U,1) D DD^%DT
"RTN","SPNRPCO",64,0)
 .S REPORDT=Y K X,Y
"RTN","SPNRPCO",65,0)
 .;
"RTN","SPNRPCO",66,0)
 .S SPNCNT=SPNCNT+1
"RTN","SPNRPCO",67,0)
 .S ^TMP($J,"UTIL",RDATE,"A",SPNCNT)="BOR999"_U_DATTAKE_U_ACCES_U_COLSAMP_U_SITESPEC_U_REPTYPE_U_REPORDT_U_"LR("_RDATE_U_"EOL999"
"RTN","SPNRPCO",68,0)
 .D BACTXT
"RTN","SPNRPCO",69,0)
 .D GRAM
"RTN","SPNRPCO",70,0)
KILL ;
"RTN","SPNRPCO",71,0)
 K A,ICN,ACCES,B,COLSAMP,DATTAKE,DFN,LRDFN,MORE,RDATE
"RTN","SPNRPCO",72,0)
 K REPORDT,REPTYPE,SITESPEC,SPNCNT,SPNCT,SPNDATA,SPNEDT
"RTN","SPNRPCO",73,0)
 K SPNGRM,SPNTEST,SPNTXT,SPNX,SPNXX,TSTDATA,C,%DT
"RTN","SPNRPCO",74,0)
 Q
"RTN","SPNRPCO",75,0)
GRAM ;
"RTN","SPNRPCO",76,0)
 ;now build the organism tests for this record date
"RTN","SPNRPCO",77,0)
 S SPNX=0
"RTN","SPNRPCO",78,0)
 S SPNGRM=$P($$REFVAL^LRPXAPI("LRDFN;MI;RDATE;2,0"),U,3)
"RTN","SPNRPCO",79,0)
 F A=1:1:SPNGRM D
"RTN","SPNRPCO",80,0)
 .S X=$P($$REFVAL^LRPXAPI("LRDFN;MI;RDATE;2,A,0"),U,1)
"RTN","SPNRPCO",81,0)
 .Q:X=""
"RTN","SPNRPCO",82,0)
 .S SPNX=SPNX+1 S ^TMP($J,"UTIL",RDATE,"CC",SPNX)="BOG999^"_X_U_"EOL999"
"RTN","SPNRPCO",83,0)
 Q
"RTN","SPNRPCO",84,0)
BACTXT ;----------
"RTN","SPNRPCO",85,0)
 ;build the BAC TEST REMARKS
"RTN","SPNRPCO",86,0)
 S SPNX=$P($$REFVAL^LRPXAPI("LRDFN;MI;RDATE;4,0"),U,3)  ;number of lines
"RTN","SPNRPCO",87,0)
 S SPNCT=0
"RTN","SPNRPCO",88,0)
 S SPNCT=SPNCT+1 S ^TMP($J,"UTIL",RDATE,"AA",SPNCT)="BOB999^EOL999"
"RTN","SPNRPCO",89,0)
 F B=1:1:SPNX D 
"RTN","SPNRPCO",90,0)
 .S SPNTXT=$P($$REFVAL^LRPXAPI("LRDFN;MI;RDATE;4,B,0"),U,1) D
"RTN","SPNRPCO",91,0)
 ..Q:SPNTXT=""
"RTN","SPNRPCO",92,0)
 ..S SPNCT=SPNCT+1 S ^TMP($J,"UTIL",RDATE,"AA",SPNCT)=SPNTXT_U_"EOL999"
"RTN","SPNRPCO",93,0)
 Q
"RTN","SPNRPCQ")
0^65^B6960635
"RTN","SPNRPCQ",1,0)
SPNRPCQ ;SD/WDE - Returns LAB TEST/DRUG NAMES;JUL 17, 2008
"RTN","SPNRPCQ",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNRPCQ",3,0)
 ;
"RTN","SPNRPCQ",4,0)
 ;
"RTN","SPNRPCQ",5,0)
 ;Pharmacy Reference to PSS50 DBIA #4533 TAG ZERO in line tag NDC
"RTN","SPNRPCQ",6,0)
 ;
"RTN","SPNRPCQ",7,0)
 ;Lab Reference to DBIA91-A CUSTODIAL PACKAGE: LAB SERVICE
"RTN","SPNRPCQ",8,0)
 ;Clinic Reference to DBIA 10040 Hospital Location file access
"RTN","SPNRPCQ",9,0)
 ;
"RTN","SPNRPCQ",10,0)
 ;Scheduling Reference to ^SC supported by IA# 10040
"RTN","SPNRPCQ",11,0)
 ;
"RTN","SPNRPCQ",12,0)
 ;Used to generate a list of selectable labs or drugs hospital location names
"RTN","SPNRPCQ",13,0)
 ;
"RTN","SPNRPCQ",14,0)
 ;
"RTN","SPNRPCQ",15,0)
 ;
"RTN","SPNRPCQ",16,0)
COL(ROOT,TYPE) ;
"RTN","SPNRPCQ",17,0)
 K ^TMP($J)
"RTN","SPNRPCQ",18,0)
 S ROOT=$NA(^TMP($J))
"RTN","SPNRPCQ",19,0)
 I (TYPE'="LAB")&(TYPE'="NDC")&(TYPE'="PROS")&(TYPE'="CLINIC") S ^TMP($J,1)="No tag by this name" Q
"RTN","SPNRPCQ",20,0)
 D @TYPE
"RTN","SPNRPCQ",21,0)
 K CNT,CODENAM,D,DES,DFN,DRGIEN
"RTN","SPNRPCQ",22,0)
 K DRGNAM,FDATE,HIUSERS,IEN,LAB,LOC
"RTN","SPNRPCQ",23,0)
 K OLDCNT,QLIST,TESTNAM,PTLIST,TESTNUM,TIUDA,VADRGCL
"RTN","SPNRPCQ",24,0)
 Q
"RTN","SPNRPCQ",25,0)
LAB ;-------------------------------------------------------------------
"RTN","SPNRPCQ",26,0)
 ;         Lab test names  (ORIG SPNLRR)
"RTN","SPNRPCQ",27,0)
 S CNT=0
"RTN","SPNRPCQ",28,0)
 S LAB=0 F  S LAB=$O(^LAB(60,LAB)) Q:(LAB="")!('+LAB)  D
"RTN","SPNRPCQ",29,0)
 .S LOC=$P($G(^LAB(60,LAB,0)),U,5)
"RTN","SPNRPCQ",30,0)
 .Q:LOC=""  ;LOCATION (DATA NAME) not defined in ^LAB(60.
"RTN","SPNRPCQ",31,0)
 .S TESTNAM=$P($G(^LAB(60,LAB,0)),U,1)
"RTN","SPNRPCQ",32,0)
 .S TESTNUM=$P(LOC,";",2)
"RTN","SPNRPCQ",33,0)
 .;S ^TMP($J,"UTIL",TESTNAM,CNT)=TESTNAM_U_TESTNUM  ;TMP IN ALPHA ORDER
"RTN","SPNRPCQ",34,0)
 .S ^TMP($J,"UTIL",TESTNAM,CNT)=TESTNUM_U_TESTNAM
"RTN","SPNRPCQ",35,0)
 .S CNT=CNT+1
"RTN","SPNRPCQ",36,0)
 .Q
"RTN","SPNRPCQ",37,0)
 S TESTNAM="",CNT=0
"RTN","SPNRPCQ",38,0)
 F  S TESTNAM=$O(^TMP($J,"UTIL",TESTNAM)) Q:TESTNAM=""  D
"RTN","SPNRPCQ",39,0)
 .S OLDCNT=0 F  S OLDCNT=$O(^TMP($J,"UTIL",TESTNAM,OLDCNT)) Q:'+OLDCNT  D
"RTN","SPNRPCQ",40,0)
 ..S CNT=CNT+1 S ^TMP($J,CNT)=$G(^TMP($J,"UTIL",TESTNAM,OLDCNT))_"^EOL999"
"RTN","SPNRPCQ",41,0)
 .Q
"RTN","SPNRPCQ",42,0)
 K ^TMP($J,"UTIL")
"RTN","SPNRPCQ",43,0)
 Q
"RTN","SPNRPCQ",44,0)
 ;---------------------------------------------------------------------
"RTN","SPNRPCQ",45,0)
NDC ;
"RTN","SPNRPCQ",46,0)
 ;RETURNS
"RTN","SPNRPCQ",47,0)
 ;      3085^ZYMACAP CAPS^NO VA DRUG CLASS^EOL999
"RTN","SPNRPCQ",48,0)
 ;      7241^ZYPREXA ZYDIS 15MG^CN709^EOL999
"RTN","SPNRPCQ",49,0)
 ;      6987^ZYPREXA ZYDIS 5MG TAB^CN709^EOL999
"RTN","SPNRPCQ",50,0)
 ;      3993^ZZACETAMINOPHEN 325mg SUPPOSITORY (ea)^NO VA DRUG CLASS^EOL999
"RTN","SPNRPCQ",51,0)
 ;          
"RTN","SPNRPCQ",52,0)
 ;
"RTN","SPNRPCQ",53,0)
 S SPNCNT=0
"RTN","SPNRPCQ",54,0)
 K ^TMP($J)
"RTN","SPNRPCQ",55,0)
 ; Next two lines added for defect SCI1025
"RTN","SPNRPCQ",56,0)
 ; D ZERO^PSS50(,"??",,,,"TMP")
"RTN","SPNRPCQ",57,0)
 S IDATE=DT
"RTN","SPNRPCQ",58,0)
 D ZERO^PSS50(,"??",IDATE,,,"TMP")
"RTN","SPNRPCQ",59,0)
 S SPNDRNA="" F  S SPNDRNA=$O(^TMP($J,"TMP","B",SPNDRNA)) Q:(SPNDRNA="")  D
"RTN","SPNRPCQ",60,0)
 .S SPNIEN=0 F  S SPNIEN=$O(^TMP($J,"TMP","B",SPNDRNA,SPNIEN)) Q:(SPNIEN="")!('+SPNIEN)  D
"RTN","SPNRPCQ",61,0)
 ..S SPNVADRG=$P($G(^TMP($J,"TMP",SPNIEN,2)),U,1)
"RTN","SPNRPCQ",62,0)
 ..S SPNCNT=SPNCNT+1
"RTN","SPNRPCQ",63,0)
 ..S ^TMP($J,SPNCNT)=SPNIEN_"^"_SPNDRNA_"^"_SPNVADRG_"^EOL999"
"RTN","SPNRPCQ",64,0)
 ..Q
"RTN","SPNRPCQ",65,0)
 .Q
"RTN","SPNRPCQ",66,0)
 K ^TMP($J,"TMP")
"RTN","SPNRPCQ",67,0)
 K SPNVADRG,SPNDRNA,SPNCNT,SPNIEN,IDATE
"RTN","SPNRPCQ",68,0)
 Q
"RTN","SPNRPCQ",69,0)
CLINIC ;
"RTN","SPNRPCQ",70,0)
 S CNT=0
"RTN","SPNRPCQ",71,0)
 S CLNAM=0
"RTN","SPNRPCQ",72,0)
 F  S CLNAM=$O(^SC("B",CLNAM)) Q:CLNAM=""  S IEN=0 F  S IEN=$O(^SC("B",CLNAM,IEN)) Q:(IEN="")!('+IEN)  D
"RTN","SPNRPCQ",73,0)
 .S CNT=CNT+1
"RTN","SPNRPCQ",74,0)
 .S ^TMP($J,CNT)=IEN_U_CLNAM_U_"EOL999"
"RTN","SPNRPCQ",75,0)
 K CLNAM,IEN,CNT
"RTN","SPNRPCW")
0^70^B13994447
"RTN","SPNRPCW",1,0)
SPNRPCW ;SD/WDE - Returns INFLUENZA Lab test results;JUL 28, 2008
"RTN","SPNRPCW",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNRPCW",3,0)
 ;
"RTN","SPNRPCW",4,0)
 ;
"RTN","SPNRPCW",5,0)
 ;   INTEGRATION REFERENCE INQUIRY #4245
"RTN","SPNRPCW",6,0)
 ;   INTEGRATION REFERENCE INQUIRY #4246
"RTN","SPNRPCW",7,0)
 ;   
"RTN","SPNRPCW",8,0)
 ;   
"RTN","SPNRPCW",9,0)
 ;     dfn is ien of the pt
"RTN","SPNRPCW",10,0)
 ;     root is the sorted data in latest date of test first
"RTN","SPNRPCW",11,0)
 ;
"RTN","SPNRPCW",12,0)
COL(ROOT,ICN,SDATE,EDATE) ;
"RTN","SPNRPCW",13,0)
 K TESTS
"RTN","SPNRPCW",14,0)
 K ^TMP($J)
"RTN","SPNRPCW",15,0)
 K ^TMP($J,"UTIL")
"RTN","SPNRPCW",16,0)
 ;JAS 07/28/08 Replaced all references to ^TMP("RESULTS",$J) to ^TMP("SPN",$J)
"RTN","SPNRPCW",17,0)
 ;             due to ^TMP structure violation found during SQA checklist.
"RTN","SPNRPCW",18,0)
 ;K ^TMP("RESULTS",$J)
"RTN","SPNRPCW",19,0)
 K ^TMP("SPN",$J)
"RTN","SPNRPCW",20,0)
 S ROOT=$NA(^TMP($J))
"RTN","SPNRPCW",21,0)
 S X=SDATE S %DT="T" D ^%DT S SDATE=Y
"RTN","SPNRPCW",22,0)
 S X1=SDATE,X2=-1 D C^%DTC S SDATE=X
"RTN","SPNRPCW",23,0)
 S X=EDATE S %DT="T" D ^%DT S EDATE=Y
"RTN","SPNRPCW",24,0)
 S SPNCNT=0
"RTN","SPNRPCW",25,0)
 S DFN=$$FLIP^SPNRPCIC(ICN)
"RTN","SPNRPCW",26,0)
 S LRDFN=$$LRDFN^LRPXAPIU(DFN) Q:LRDFN'>0
"RTN","SPNRPCW",27,0)
 D RESULTS^LRPXAPI(.ZZ,DFN,"M")
"RTN","SPNRPCW",28,0)
 F  D  Q:'MORE
"RTN","SPNRPCW",29,0)
  . D RESULTS^LRPXAPI(.ITEMS,DFN,"M",100,.MORE,,SDATE,EDATE)
"RTN","SPNRPCW",30,0)
  . ;M ^TMP("RESULTS",$J)=ITEMS
"RTN","SPNRPCW",31,0)
  . M ^TMP("SPN",$J)=ITEMS
"RTN","SPNRPCW",32,0)
 K ITEMS
"RTN","SPNRPCW",33,0)
 S ^TMP($J,"UTILA")="Beginning of MICRO"_U_"EOL999"
"RTN","SPNRPCW",34,0)
 ;S SPNTEST="" F  S SPNTEST=$O(^TMP("RESULTS",$J,SPNTEST)) Q:SPNTEST=""  D
"RTN","SPNRPCW",35,0)
 S SPNTEST="" F  S SPNTEST=$O(^TMP("SPN",$J,SPNTEST)) Q:SPNTEST=""  D
"RTN","SPNRPCW",36,0)
 .;S TSTDATA=$G(^TMP("RESULTS",$J,SPNTEST)) Q:TSTDATA=""
"RTN","SPNRPCW",37,0)
 .S TSTDATA=$G(^TMP("SPN",$J,SPNTEST)) Q:TSTDATA=""
"RTN","SPNRPCW",38,0)
 .S RDATE=$P(SPNTEST,";",3)
"RTN","SPNRPCW",39,0)
 .S SPUTSCEN=$P($$REFVAL^LRPXAPI("LRDFN;MI;RDATE;1"),U,5)
"RTN","SPNRPCW",40,0)
 .;Q:SPUTSCEN=""
"RTN","SPNRPCW",41,0)
 .K SITPC
"RTN","SPNRPCW",42,0)
 .S SITPC=$P($$REFVAL^LRPXAPI("LRDFN;MI;RDATE;0"),U,5)
"RTN","SPNRPCW",43,0)
 .S SITESPEC=$$SPECNM^LRPXAPIU(SITPC)
"RTN","SPNRPCW",44,0)
 .S ACCES=$P($G(TSTDATA),U,11)
"RTN","SPNRPCW",45,0)
 .S DATTAKE=$P(TSTDATA,U,1) S FMDATE=DATTAKE S Y=DATTAKE D DD^%DT S DATTAKE=Y
"RTN","SPNRPCW",46,0)
 .S ^TMP($J,"UTILA",RDATE,"A",0)="BOR999"_U_DATTAKE_U_ACCES_U_SITESPEC_U_SPUTSCEN_U_"EOL999"
"RTN","SPNRPCW",47,0)
 .;
"RTN","SPNRPCW",48,0)
 .;
"RTN","SPNRPCW",49,0)
 .;set up the virology rpt remarks
"RTN","SPNRPCW",50,0)
 .S ^TMP($J,"UTILA",RDATE,"B","VIROLOGY REMARKS",0)="BOS_VIROLOGY_RPT_RMKS"_U_"EOL999"
"RTN","SPNRPCW",51,0)
 .S ^TMP($J,"UTILA",RDATE,"B","VIROLOGY REMARKS",9999999)="EOS_VIROLOGY_RPT_RMKS"_U_"EOL999"
"RTN","SPNRPCW",52,0)
 .S (VIRLINE,LINE,DATA)=""
"RTN","SPNRPCW",53,0)
 .S VIRLINE=$P($$REFVAL^LRPXAPI("LRDFN;MI;RDATE;18,0"),U,4)
"RTN","SPNRPCW",54,0)
 .S LINE=0 F LINE=1:1:VIRLINE S DATA=$$REFVAL^LRPXAPI("LRDFN;MI;RDATE;18,LINE,0") D
"RTN","SPNRPCW",55,0)
 ..S ^TMP($J,"UTILA",RDATE,"B","VIROLOGY REMARKS",LINE)=DATA_U_"EOL999"
"RTN","SPNRPCW",56,0)
 .;
"RTN","SPNRPCW",57,0)
 .;now get the virus information
"RTN","SPNRPCW",58,0)
 .;
"RTN","SPNRPCW",59,0)
 .S (VIRLINE,LINE,DATA)=""
"RTN","SPNRPCW",60,0)
 .S ^TMP($J,"UTILA",RDATE,"C","VIRUS",0)="BOS_VIRUS"_U_"EOL999"
"RTN","SPNRPCW",61,0)
 .S ^TMP($J,"UTILA",RDATE,"C","VIRUS",999999)="EOS_VIRUS"_U_"EOL999"
"RTN","SPNRPCW",62,0)
 .S VIRLINE=$P($$REFVAL^LRPXAPI("LRDFN;MI;RDATE;17,0"),U,4)
"RTN","SPNRPCW",63,0)
 .S LINE=0 F LINE=1:1:VIRLINE S DATA=$$REFVAL^LRPXAPI("LRDFN;MI;RDATE;17,LINE,0") D
"RTN","SPNRPCW",64,0)
 ..S VIRX=$$BUGNM^LRPXAPIU(DATA)
"RTN","SPNRPCW",65,0)
 ..S ^TMP($J,"UTILA",RDATE,"C","VIRUS",LINE)=VIRX_U_"EOL999"
"RTN","SPNRPCW",66,0)
 .S ^TMP($J,"UTILA",RDATE,"D","ZZZZZZZZZZZ",99999999999)="EOR999"_U_"EOL999"
"RTN","SPNRPCW",67,0)
 ;K ^TMP("RESULTS",$J) K ITEMS
"RTN","SPNRPCW",68,0)
 K ^TMP("SPN",$J) K ITEMS
"RTN","SPNRPCW",69,0)
 D COL^SPNRPCW2(ICN,SDATE,EDATE)
"RTN","SPNRPCW",70,0)
ZAP ;
"RTN","SPNRPCW",71,0)
 K SDATE,EDATE,SUC,CNT,RDATE,LRDFN,SPUTSCEN,ASSES,COLSAMP,REVDT,DATREC
"RTN","SPNRPCW",72,0)
 K REPORDT,REPOTYP,SITESPEC,SPUTSCEN,VIROLSTA,PROVIDER,VIRUS,VIRUSNA
"RTN","SPNRPCW",73,0)
 K VIROIEN,VIROTST,VIRRPIEN,VIRORPT,DATA,SUBCNT,DFN
"RTN","SPNRPCW",74,0)
 K ASSES,CNT,CNT2,COL,COM,COMMET,DATA
"RTN","SPNRPCW",75,0)
 K DATA2,DFN,DTREPTAK,DTSPETAK,EDATE
"RTN","SPNRPCW",76,0)
 K FIELD,FIELD2,FIELDNA,LRDFN,RDATE
"RTN","SPNRPCW",77,0)
 K SPECTYP,SUB,SUBCNT,TST,Y
"RTN","SPNRPCW",78,0)
 K X,VIRUSIEN,VIROLDT,LASTCNT,DATTAKE,%DT,ACCES,FMDATE,LINE,MORE
"RTN","SPNRPCW",79,0)
 K SPNCNT,SPNTEST,TSTDATA,VIRLINE,VIRX,X1,X2,ZZ,A,COLTIME
"RTN","SPNRPCW",80,0)
 K REPDATE,SHOWDT,SITSPEC,SPNTEST,T,TSTNAM,TSTNUM,VALUE,WHATEST
"RTN","SPNRPCW",81,0)
 Q
"RTN","SPNRPCW2")
0^71^B20809166
"RTN","SPNRPCW2",1,0)
SPNRPCW2 ;SD/WDE - Returns INFLUENZA Lab test results "CH" NODE;JUL 28, 2008
"RTN","SPNRPCW2",2,0)
 ;;3.0;Spinal Cord Dysfunction;;OCT 01, 2006;Build 39
"RTN","SPNRPCW2",3,0)
 ;
"RTN","SPNRPCW2",4,0)
 ;   INTEGRATION REFERENCE INQUIRY #4245
"RTN","SPNRPCW2",5,0)
 ;   INTEGRATION REFERENCE INQUIRY #4246
"RTN","SPNRPCW2",6,0)
 ;    
"RTN","SPNRPCW2",7,0)
 ;    
"RTN","SPNRPCW2",8,0)
 ;     dfn is ien of the pt
"RTN","SPNRPCW2",9,0)
 ;     root is the sorted data in latest date of test first
"RTN","SPNRPCW2",10,0)
 ;
"RTN","SPNRPCW2",11,0)
 ;this routine is called from spnrpcw
"RTN","SPNRPCW2",12,0)
 ;and is not meant to run alone
"RTN","SPNRPCW2",13,0)
COL(ICN,SDATE,EDATE) ;
"RTN","SPNRPCW2",14,0)
 ;dates are converted in spnrpcw
"RTN","SPNRPCW2",15,0)
 ;****************************
"RTN","SPNRPCW2",16,0)
 ;K ASSES,CNT,CNT2,COL,COM,COMMET,DATA,DATA2,DFN,DTREPTAK,DTSPETAK,EDATE,FIELD,FIELD2,FIELDNA,ICN,LASTCNT,LRDFN,RDATE
"RTN","SPNRPCW2",17,0)
 ;K SDATE,SPECTYP,SUB,SUBCNT,TST,Y
"RTN","SPNRPCW2",18,0)
NEWT ;
"RTN","SPNRPCW2",19,0)
 K TESTS,ITEMS,ZZZ
"RTN","SPNRPCW2",20,0)
 D TESTS^LRPXAPI(.TESTS,DFN,"C",,,,SDATE,EDATE)
"RTN","SPNRPCW2",21,0)
 ;NOW STRIP OUT ALL TEST BUT THE INFLUENZA TEST
"RTN","SPNRPCW2",22,0)
 S T=0 F  S T=$O(TESTS(T)) Q:T=""  I $P(TESTS(T),U,2)'["INFLUEN" K TESTS(T)
"RTN","SPNRPCW2",23,0)
 ;NOW STRIP OUT ALL TEST BUT THE PARA INFLUENZA TEST
"RTN","SPNRPCW2",24,0)
 S T=0 F  S T=$O(TESTS(T)) Q:T=""  I $P(TESTS(T),U,2)["PARA" K TESTS(T)
"RTN","SPNRPCW2",25,0)
 ;PUGET ERROR TRAP DEFECT 1058 (NEXT LINE) - 12/27/07
"RTN","SPNRPCW2",26,0)
 Q:$D(TESTS)'=11
"RTN","SPNRPCW2",27,0)
 F  D  Q:'MORE
"RTN","SPNRPCW2",28,0)
  . D RESULTS^LRPXAPI(.ITEMS,DFN,"C",,.MORE,,SDATE,EDATE)
"RTN","SPNRPCW2",29,0)
  . M ^TMP("SPN",$J)=ITEMS
"RTN","SPNRPCW2",30,0)
 K ITEMS  ;just whats in the table
"RTN","SPNRPCW2",31,0)
 ;at this point we have the test and all of the patients test given now strip out the results we don't want
"RTN","SPNRPCW2",32,0)
 ;based on the values of the test number compared to the tests(#)
"RTN","SPNRPCW2",33,0)
 S SPNTEST=0 F  S SPNTEST=$O(^TMP("SPN",$J,SPNTEST)) Q:SPNTEST=""  D
"RTN","SPNRPCW2",34,0)
 .S WHATEST=$P($G(^TMP("SPN",$J,SPNTEST)),U,2)
"RTN","SPNRPCW2",35,0)
 .I $G(TESTS(WHATEST))="" K ^TMP("SPN",$J,SPNTEST)
"RTN","SPNRPCW2",36,0)
 ;NOW GROUP THE DATES
"RTN","SPNRPCW2",37,0)
 ;                          -2870206 1202")=2870206^1202^1^NEG^
"RTN","SPNRPCW2",38,0)
 ;                     "-2870206 1558")=2870206^1558^1^^
"RTN","SPNRPCW2",39,0)
 ;                    "-2870206 1559")=2870206^1559^1^^
"RTN","SPNRPCW2",40,0)
 ;                     "-2870206 881")=2870206^881^1^NEG^
"RTN","SPNRPCW2",41,0)
 ;                     "-2870227 1202")=2870227^1202^1^NEG^
"RTN","SPNRPCW2",42,0)
 ;                    "-2870227 1558")=2870227^1558^1^^
"RTN","SPNRPCW2",43,0)
 ;                     "-2870227 1559")=2870227^1559^1^^
"RTN","SPNRPCW2",44,0)
 ;                      "-2870227 881")=2870227^881^1^NEG^
"RTN","SPNRPCW2",45,0)
GROUP ;
"RTN","SPNRPCW2",46,0)
 S SPNCNT=0
"RTN","SPNRPCW2",47,0)
 S ^TMP($J,"UTILB")="Beginning of CHEM"_U_"EOL999"
"RTN","SPNRPCW2",48,0)
 K ARRAY
"RTN","SPNRPCW2",49,0)
 S SPNTEST=0 F A=1:1 S SPNTEST=$O(^TMP("SPN",$J,SPNTEST)) Q:SPNTEST=""  D
"RTN","SPNRPCW2",50,0)
 .S X=$P(^TMP("SPN",$J,SPNTEST),U,1)
"RTN","SPNRPCW2",51,0)
 .S ARRAY(X)=$G(^TMP("SPN",$J,SPNTEST))
"RTN","SPNRPCW2",52,0)
 .S ARRAY(X,A)=$G(^TMP("SPN",$J,SPNTEST))
"RTN","SPNRPCW2",53,0)
 ;NOW DATES ARE GROUPED
"RTN","SPNRPCW2",54,0)
 S COLTIME=0 F  S COLTIME=$O(ARRAY(COLTIME)) Q:COLTIME=""  D
"RTN","SPNRPCW2",55,0)
 .K ZZZ D SPEC^LRPXAPI(.ZZZ,DFN,COLTIME,"A")
"RTN","SPNRPCW2",56,0)
 .S ACCES=$P($G(ZZZ("S")),U,6)
"RTN","SPNRPCW2",57,0)
 .S RDATE=$P($G(ZZZ("S")),U,1)
"RTN","SPNRPCW2",58,0)
 .S Y=RDATE D DD^%DT S SHOWDT=Y
"RTN","SPNRPCW2",59,0)
 .S Y=$P($G(ZZZ("S")),U,3) D DD^%DT S REPDATE=Y
"RTN","SPNRPCW2",60,0)
 .S X=$P($G(ZZZ("S")),U,5)
"RTN","SPNRPCW2",61,0)
 .I $G(X) S SITSPEC=$$SPECNM^LRPXAPIU(X)
"RTN","SPNRPCW2",62,0)
 .I $G(SITSPEC)="" S SITSPEC="--"
"RTN","SPNRPCW2",63,0)
 .S SPNCNT=SPNCNT+1
"RTN","SPNRPCW2",64,0)
 .S ^TMP($J,"UTILB",-RDATE,"A",SPNCNT)="BOR999"_U_SHOWDT_U_REPDATE_U_SITSPEC_U_ACCES_U_"EOL999"
"RTN","SPNRPCW2",65,0)
 .;
"RTN","SPNRPCW2",66,0)
 .S SPNCNT=SPNCNT+1
"RTN","SPNRPCW2",67,0)
 .S ^TMP($J,"UTILB",-RDATE,"B",SPNCNT)="BOS_INFLUENZA_TESTS"_U_"EOL999"
"RTN","SPNRPCW2",68,0)
 .S ^TMP($J,"UTILB",-RDATE,"B",999999)="EOS_INFLUENZA_TESTS"_U_"EOL999"
"RTN","SPNRPCW2",69,0)
 .S TST=0 F  S TST=$O(ARRAY(COLTIME,TST)) Q:TST=""  D
"RTN","SPNRPCW2",70,0)
 ..S TSTNUM=$P($G(ARRAY(COLTIME,TST)),U,2) S TSTNAM=$$TESTNM^LRPXAPIU(TSTNUM)
"RTN","SPNRPCW2",71,0)
 ..S VALUE=$P($G(ARRAY(COLTIME,TST)),U,4)
"RTN","SPNRPCW2",72,0)
 ..S SPNCNT=SPNCNT+1
"RTN","SPNRPCW2",73,0)
 ..S ^TMP($J,"UTILB",-RDATE,"B",SPNCNT)=TSTNAM_U_VALUE_U_"EOL999"
"RTN","SPNRPCW2",74,0)
 .;
"RTN","SPNRPCW2",75,0)
 .;get order tests
"RTN","SPNRPCW2",76,0)
 .S LRIDT=$$LRIDT^LRPXAPIU(RDATE)
"RTN","SPNRPCW2",77,0)
 .S ^TMP($J,"UTILB",-RDATE,"C",0)="BOS_TEST_ORDERED"_U_"EOL999"
"RTN","SPNRPCW2",78,0)
 .S ^TMP($J,"UTILB",-RDATE,"C",99999)="EOS_TEST_ORDERED"_U_"EOL999"
"RTN","SPNRPCW2",79,0)
 .S VIRLINE=$P($$REFVAL^LRPXAPI("LRDFN;CH;LRIDT;""ORUT"",0"),U,4)
"RTN","SPNRPCW2",80,0)
 .S LINE=0 F LINE=1:1:VIRLINE S DATA=$$REFVAL^LRPXAPI("LRDFN;CH;LRIDT;""ORUT"",LINE,0") D
"RTN","SPNRPCW2",81,0)
 ..S ^TMP($J,"UTILB",-RDATE,"C",LINE)=DATA_U_"EOL999"
"RTN","SPNRPCW2",82,0)
 .;
"RTN","SPNRPCW2",83,0)
 .;get comments
"RTN","SPNRPCW2",84,0)
 .S SPNCNT=1
"RTN","SPNRPCW2",85,0)
 .S ^TMP($J,"UTILB",-RDATE,"D",SPNCNT)="BOS_CHEM_COMMENTS"_U_"EOL999"
"RTN","SPNRPCW2",86,0)
 .S ^TMP($J,"UTILB",-RDATE,"D",99999)="EOS_CHEM_COMMENTS"_U_"EOL999"
"RTN","SPNRPCW2",87,0)
 .S COM="" F  S COM=$O(ZZZ("C",COM)) Q:COM=""  S SPNCNT=SPNCNT+1 S ^TMP($J,"UTILB",-RDATE,"D",SPNCNT)=$G(ZZZ("C",COM))_U_"EOL999"
"RTN","SPNRPCW2",88,0)
 .S ^TMP($J,"UTILB",-RDATE,"D",999999)="EOR999"_U_"EOL999"
"RTN","SPNRPCW2",89,0)
 .K ZZZ,VIRLINE,COM
"RTN","SPNRPCW2",90,0)
 .Q
"RTN","SPNRPCW2",91,0)
KILL ;
"RTN","SPNRPCW2",92,0)
 K ASSES,CNT,CNT2,COL,COM,COMMET,DATA,DATA2,DFN,DTREPTAK,DTSPETAK,EDATE,FIELD,FIELD2,FIELDNA,ICN,LASTCNT,LRDFN,RDATE
"RTN","SPNRPCW2",93,0)
 K SDATE,SPECTYP,SUB,SUBCNT,TST,Y,ARRAY,LINE,LRIDT,COM,SPNCNT,RDATE,LRDFN
"RTN","SPNRPCW2",94,0)
 K SDATE,EDATE,SUC,CNT,RDATE,LRDFN,SPUTSCEN,ASSES,COLSAMP,REVDT,DATREC
"RTN","SPNRPCW2",95,0)
 K REPORDT,REPOTYP,SITESPEC,SPUTSCEN,VIROLSTA,PROVIDER,VIRUS,VIRUSNA
"RTN","SPNRPCW2",96,0)
 K VIROIEN,VIROTST,VIRRPIEN,VIRORPT,DATA,SUBCNT,DFN
"RTN","SPNRPCW2",97,0)
 K ASSES,CNT,CNT2,COL,COM,COMMET,DATA
"RTN","SPNRPCW2",98,0)
 K DATA2,DFN,DTREPTAK,DTSPETAK,EDATE
"RTN","SPNRPCW2",99,0)
 K FIELD,FIELD2,FIELDNA,LRDFN,RDATE
"RTN","SPNRPCW2",100,0)
 K SPECTYP,SUB,SUBCNT,TST,Y
"RTN","SPNRPCW2",101,0)
 K X,VIRUSIEN,VIROLDT,LASTCNT,DATTAKE,%DT,ACCES,FMDATE,LINE,MORE
"RTN","SPNRPCW2",102,0)
 K SPNCNT,SPNTEST,TSTDATA,VIRLINE,VIRX,X1,X2,ZZ,A,COLTIME
"RTN","SPNRPCW2",103,0)
 K REPDATE,SHOWDT,SITSPEC,SPNTEST,T,TSTNAM,TSTNUM,VALUE,WHATEST,X1,X2
"RTN","SPNRPCW2",104,0)
 Q
"VER")
8.0^22.0
**END**
**END**
