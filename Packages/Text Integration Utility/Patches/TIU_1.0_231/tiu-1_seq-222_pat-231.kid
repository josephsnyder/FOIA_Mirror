Released TIU*1*231 SEQ #222
Extracted from mail message
**KIDS**:TIU*1.0*231^

**INSTALL NAME**
TIU*1.0*231
"BLD",7350,0)
TIU*1.0*231^TEXT INTEGRATION UTILITIES^0^3080103^y
"BLD",7350,1,0)
^^2^2^3080102^
"BLD",7350,1,1,0)
Utility to analyze problems that may have been caused by the installation 
"BLD",7350,1,2,0)
of patch TIU*1.0*215.  Runs upon install and also as a stand alone option.
"BLD",7350,4,0)
^9.64PA^^
"BLD",7350,6)
6^
"BLD",7350,6.3)
63
"BLD",7350,"ABPKG")
n
"BLD",7350,"INI")

"BLD",7350,"INID")
n^n^
"BLD",7350,"INIT")
INS^TIU215F
"BLD",7350,"KRN",0)
^9.67PA^8989.52^19
"BLD",7350,"KRN",.4,0)
.4
"BLD",7350,"KRN",.401,0)
.401
"BLD",7350,"KRN",.402,0)
.402
"BLD",7350,"KRN",.403,0)
.403
"BLD",7350,"KRN",.5,0)
.5
"BLD",7350,"KRN",.84,0)
.84
"BLD",7350,"KRN",3.6,0)
3.6
"BLD",7350,"KRN",3.8,0)
3.8
"BLD",7350,"KRN",9.2,0)
9.2
"BLD",7350,"KRN",9.8,0)
9.8
"BLD",7350,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",7350,"KRN",9.8,"NM",1,0)
TIU215F^^0^B46816253
"BLD",7350,"KRN",9.8,"NM",2,0)
TIU215R^^0^B65000557
"BLD",7350,"KRN",9.8,"NM","B","TIU215F",1)

"BLD",7350,"KRN",9.8,"NM","B","TIU215R",2)

"BLD",7350,"KRN",19,0)
19
"BLD",7350,"KRN",19,"NM",0)
^9.68A^5^5
"BLD",7350,"KRN",19,"NM",1,0)
TIU MAIN MENU MGR^^3
"BLD",7350,"KRN",19,"NM",2,0)
TIU 215 ANALYSIS^^0
"BLD",7350,"KRN",19,"NM",3,0)
TIU215 ANALYZE PROBLEMS^^0
"BLD",7350,"KRN",19,"NM",4,0)
TIU215 OUTPUT TEXT FILES^^0
"BLD",7350,"KRN",19,"NM",5,0)
TIU215 VIEW SURGERY CASE^^0
"BLD",7350,"KRN",19,"NM","B","TIU 215 ANALYSIS",2)

"BLD",7350,"KRN",19,"NM","B","TIU MAIN MENU MGR",1)

"BLD",7350,"KRN",19,"NM","B","TIU215 ANALYZE PROBLEMS",3)

"BLD",7350,"KRN",19,"NM","B","TIU215 OUTPUT TEXT FILES",4)

"BLD",7350,"KRN",19,"NM","B","TIU215 VIEW SURGERY CASE",5)

"BLD",7350,"KRN",19.1,0)
19.1
"BLD",7350,"KRN",101,0)
101
"BLD",7350,"KRN",409.61,0)
409.61
"BLD",7350,"KRN",771,0)
771
"BLD",7350,"KRN",870,0)
870
"BLD",7350,"KRN",8989.51,0)
8989.51
"BLD",7350,"KRN",8989.52,0)
8989.52
"BLD",7350,"KRN",8994,0)
8994
"BLD",7350,"KRN","B",.4,.4)

"BLD",7350,"KRN","B",.401,.401)

"BLD",7350,"KRN","B",.402,.402)

"BLD",7350,"KRN","B",.403,.403)

"BLD",7350,"KRN","B",.5,.5)

"BLD",7350,"KRN","B",.84,.84)

"BLD",7350,"KRN","B",3.6,3.6)

"BLD",7350,"KRN","B",3.8,3.8)

"BLD",7350,"KRN","B",9.2,9.2)

"BLD",7350,"KRN","B",9.8,9.8)

"BLD",7350,"KRN","B",19,19)

"BLD",7350,"KRN","B",19.1,19.1)

"BLD",7350,"KRN","B",101,101)

"BLD",7350,"KRN","B",409.61,409.61)

"BLD",7350,"KRN","B",771,771)

"BLD",7350,"KRN","B",870,870)

"BLD",7350,"KRN","B",8989.51,8989.51)

"BLD",7350,"KRN","B",8989.52,8989.52)

"BLD",7350,"KRN","B",8994,8994)

"BLD",7350,"PRE")
TIU215F
"BLD",7350,"QDEF")
^^^^^^^^^^YES
"BLD",7350,"QUES",0)
^9.62^3^3
"BLD",7350,"QUES",1,0)
POS1
"BLD",7350,"QUES",1,1)
Y
"BLD",7350,"QUES",1,"A")
Did you install patch TIU*1.0*215
"BLD",7350,"QUES",1,"M")

"BLD",7350,"QUES",2,0)
POS2
"BLD",7350,"QUES",2,1)
D^3070101:DT:EX
"BLD",7350,"QUES",2,"A")
Enter a date equal or prior to the date patch was installed
"BLD",7350,"QUES",2,"M")
D POS2^TIU215F
"BLD",7350,"QUES",3,0)
POS3
"BLD",7350,"QUES",3,1)
D^:DT:EX
"BLD",7350,"QUES",3,"A")
Enter date patch was backed out
"BLD",7350,"QUES",3,"M")
D POS3^TIU215F
"BLD",7350,"QUES","B","POS1",1)

"BLD",7350,"QUES","B","POS2",2)

"BLD",7350,"QUES","B","POS3",3)

"BLD",7350,"REQB",0)
^9.611^1^1
"BLD",7350,"REQB",1,0)
TIU*1.0*236^1
"BLD",7350,"REQB","B","TIU*1.0*236",1)

"INIT")
INS^TIU215F
"KRN",19,10823,-1)
3^1
"KRN",19,10823,0)
TIU MAIN MENU MGR^Text Integration Utilities (MIS Manager)^^M^^^^^^^y^TEXT INTEGRATION UTILITIES^^1^^^1
"KRN",19,10823,1,0)
^19.06^1^1^3071109^^^^
"KRN",19,10823,1,1,0)
Main Text Integration Utilities menu for MIS Managers.
"KRN",19,10823,10,0)
^19.01IP^21^21
"KRN",19,10823,10,21,0)
13119^14^14
"KRN",19,10823,10,21,"^")
TIU 215 ANALYSIS
"KRN",19,10823,15)

"KRN",19,10823,20)
S GMRPEN=1 D EDITSAVE^TIUEDI2(.DUZ)
"KRN",19,10823,26)
W !!,$$CENTER^TIULS("--- MIS Managers Menu ---")
"KRN",19,10823,99)
60983,42697
"KRN",19,10823,99.1)
60940,46533
"KRN",19,10823,"U")
TEXT INTEGRATION UTILITIES (MI
"KRN",19,13119,-1)
0^2
"KRN",19,13119,0)
TIU 215 ANALYSIS^TIU 215 ANALYSIS^^M^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",19,13119,1,0)
^19.06^2^2^3071205^^^^
"KRN",19,13119,1,1,0)
These options will provide analysis tools to research problems caused by 
"KRN",19,13119,1,2,0)
patch TIU*1.0*215.
"KRN",19,13119,10,0)
^19.01IP^3^3
"KRN",19,13119,10,1,0)
13120^A^1
"KRN",19,13119,10,1,"^")
TIU215 ANALYZE PROBLEMS
"KRN",19,13119,10,2,0)
13121^V^2
"KRN",19,13119,10,2,"^")
TIU215 VIEW SURGERY CASE
"KRN",19,13119,10,3,0)
13122^T^3
"KRN",19,13119,10,3,"^")
TIU215 OUTPUT TEXT FILES
"KRN",19,13119,99)
60983,42697
"KRN",19,13119,"U")
TIU 215 ANALYSIS
"KRN",19,13120,-1)
0^3
"KRN",19,13120,0)
TIU215 ANALYZE PROBLEMS^ANALYZE POTENTIAL SURGERY TIU PROBLEMS^^R^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",19,13120,1,0)
^^2^2^3071205^
"KRN",19,13120,1,1,0)
Compares Surgery case to TIU and sends potential problems to screen or 
"KRN",19,13120,1,2,0)
hard copy device.
"KRN",19,13120,25)
EN^TIU215F
"KRN",19,13120,"U")
ANALYZE POTENTIAL SURGERY TIU 
"KRN",19,13121,-1)
0^5
"KRN",19,13121,0)
TIU215 VIEW SURGERY CASE^VIEW SINGLE SURGERY CASE USING CASE #^^R^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",19,13121,1,0)
^^2^2^3071205^
"KRN",19,13121,1,1,0)
View the contents of the Surgery case contained in the Surgery file.  
"KRN",19,13121,1,2,0)
Outpput to screen or hard copy device.
"KRN",19,13121,25)
ASK^TIU215F
"KRN",19,13121,"U")
VIEW SINGLE SURGERY CASE USING
"KRN",19,13122,-1)
0^4
"KRN",19,13122,0)
TIU215 OUTPUT TEXT FILES^SEND ANALYSIS OUTPUT TO TEXT FILE^^R^^^^^^^^TEXT INTEGRATION UTILITIES
"KRN",19,13122,1,0)
^^2^2^3071205^
"KRN",19,13122,1,1,0)
Compares Surgery case to TIU and sends potential problems to a VMS 
"KRN",19,13122,1,2,0)
file for input into Microsoft Word Compare.
"KRN",19,13122,25)
EN^TIU215R
"KRN",19,13122,"U")
SEND ANALYSIS OUTPUT TO TEXT F
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",470,-1)
1^1
"PKG",470,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",470,20,0)
^9.402P^^
"PKG",470,22,0)
^9.49I^1^1
"PKG",470,22,1,0)
1.0^3010801^3010806^66481
"PKG",470,22,1,"PAH",1,0)
231^3080103^101036
"PKG",470,22,1,"PAH",1,1,0)
^^2^2^3080103
"PKG",470,22,1,"PAH",1,1,1,0)
Utility to analyze problems that may have been caused by the installation 
"PKG",470,22,1,"PAH",1,1,2,0)
of patch TIU*1.0*215.  Runs upon install and also as a stand alone option.
"PRE")
TIU215F
"QUES","POS1",0)
Y
"QUES","POS1","A")
Did you install patch TIU*1.0*215
"QUES","POS1","M")

"QUES","POS2",0)
D^3070101:DT:EX
"QUES","POS2","A")
Enter a date equal or prior to the date patch was installed
"QUES","POS2","M")
D POS2^TIU215F
"QUES","POS3",0)
D^:DT:EX
"QUES","POS3","A")
Enter date patch was backed out
"QUES","POS3","M")
D POS3^TIU215F
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","TIU215F")
0^1^B46816253^n/a
"RTN","TIU215F",1,0)
TIU215F ;VMP/ELR - Utililty to analyze problems cause by PATCH tiu*1.0*215 ; 7/25/2007
"RTN","TIU215F",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**231**;Jun 20, 1997;Build 63
"RTN","TIU215F",3,0)
 ;COMPARE CHECKSUMS BETWEEN TIU AND SURGERY TO TRY AND FIND RECORDS WHERE THE ADDENDUM WAS NOT FILED IN TIU
"RTN","TIU215F",4,0)
 ; DBIA 4502 TO ACCESS SURGERY FILE
"RTN","TIU215F",5,0)
 ; DBIA 5025 ACCESS ROUTINE SROANR
"RTN","TIU215F",6,0)
 ; DBIA 5024 ACCESS ROUTINE SRONRPT
"RTN","TIU215F",7,0)
ENV ;DUMMY ENVIRONMENT CHECK TO GET ROUTINE LOADED FOR USE IN INSTALL QUESTIONS
"RTN","TIU215F",8,0)
 Q
"RTN","TIU215F",9,0)
STRT ;
"RTN","TIU215F",10,0)
 Q
"RTN","TIU215F",11,0)
 W !!!
"RTN","TIU215F",12,0)
 W !,"1. ANALYZE POTENTIAL SURGERY/TIU PROBLEMS"
"RTN","TIU215F",13,0)
 W !,"2. VIEW SINGLE SURGERY CASE USING CASE #"
"RTN","TIU215F",14,0)
 W !,"3, SEND OUTPUT TO TEXT FILES"
"RTN","TIU215F",15,0)
 S DIR("A")="SELECT 1 OR 2 OR 3"
"RTN","TIU215F",16,0)
 S DIR(0)=("N^1:3")
"RTN","TIU215F",17,0)
 D ^DIR
"RTN","TIU215F",18,0)
 I $D(DIRUT) K DIRUT Q
"RTN","TIU215F",19,0)
 K DIR
"RTN","TIU215F",20,0)
 G EN:Y=1
"RTN","TIU215F",21,0)
 G ASK:Y=2
"RTN","TIU215F",22,0)
 D ^TIU215R G STRT
"RTN","TIU215F",23,0)
 Q
"RTN","TIU215F",24,0)
EN NEW SRTN,TIUDA,TIUVAL,TIUCHKSU,SRVAL,SRCHKSUM,TIUDT,SRTNA,TIUEND
"RTN","TIU215F",25,0)
 NEW TIUA,TIUDAD,TIUDFN,TIUDONE,TIUNAM,TIUND,TIUX,TIUERR
"RTN","TIU215F",26,0)
 S U="^"
"RTN","TIU215F",27,0)
 K ^TMP("TIUSNIR",$J),^TMP("SRNIR",$J)
"RTN","TIU215F",28,0)
 S DIR("A")="Enter a date equal or prior to the date patch was installed"
"RTN","TIU215F",29,0)
 S DIR(0)="D^:DT:EX"
"RTN","TIU215F",30,0)
 D ^DIR
"RTN","TIU215F",31,0)
 K DIR
"RTN","TIU215F",32,0)
 I $D(DIRUT) K DIRUT G STRT
"RTN","TIU215F",33,0)
 S TIUDT=+Y
"RTN","TIU215F",34,0)
 S DIR("A")="Enter date patch was backed out"
"RTN","TIU215F",35,0)
 S DIR(0)="D^"_TIUDT_":DT:EX"
"RTN","TIU215F",36,0)
 D ^DIR
"RTN","TIU215F",37,0)
 K DIR
"RTN","TIU215F",38,0)
 I $D(DIRUT) K DIRUT G STRT
"RTN","TIU215F",39,0)
 S TIUEND=+Y
"RTN","TIU215F",40,0)
EN1 ;
"RTN","TIU215F",41,0)
 NEW TIUCNT S TIUCNT=0
"RTN","TIU215F",42,0)
 D HD
"RTN","TIU215F",43,0)
 G EN2:$G(TIUDT)'>0
"RTN","TIU215F",44,0)
 S TIUDT=TIUDT-.0001
"RTN","TIU215F",45,0)
 F  S TIUDT=$O(^SRF("AC",TIUDT)) Q:'$L(TIUDT)  Q:TIUDT\1>TIUEND  D
"RTN","TIU215F",46,0)
 . S TIUA=0 F  S TIUA=$O(^SRF("AC",TIUDT,TIUA)) Q:TIUA'>0  D
"RTN","TIU215F",47,0)
 . . S TIUDONE="" D CHK,CHK1
"RTN","TIU215F",48,0)
 I $D(XPDQUES),$G(XPDQUES("POS1"))=1 D BULL
"RTN","TIU215F",49,0)
EN2 I $D(XPDQUES),$G(XPDQUES("POS1"))'=1 D MSG H .5
"RTN","TIU215F",50,0)
 I $G(TIUERR)=1 D BULL1("It looks like you did not back out patch TIU*1.0*215")
"RTN","TIU215F",51,0)
 I $D(XPDQUES) Q
"RTN","TIU215F",52,0)
 G STRT
"RTN","TIU215F",53,0)
CHK S SRTN=TIUA
"RTN","TIU215F",54,0)
 S TIUDA=$P($G(^SRF(SRTN,"TIU")),"^",2)
"RTN","TIU215F",55,0)
 Q:+TIUDA'>0
"RTN","TIU215F",56,0)
 ;DONT EVALUATE UNDICTATED
"RTN","TIU215F",57,0)
 Q:$P($G(^TIU(8925,TIUDA,0)),U,5)=1
"RTN","TIU215F",58,0)
 S TIUDFN=$P($G(^TIU(8925,TIUDA,0)),U,2)
"RTN","TIU215F",59,0)
 K ^TMP("TIUSNIR",$J),^TMP("SRNIR",$J)
"RTN","TIU215F",60,0)
 D RPT^SRONRPT(SRTN)
"RTN","TIU215F",61,0)
 ;STRIP OUT SUBFILE DATA
"RTN","TIU215F",62,0)
 S TIUX=0
"RTN","TIU215F",63,0)
 F  S TIUX=$O(^TIU(8925,+TIUDA,"TEXT",TIUX)) Q:TIUX=""  D
"RTN","TIU215F",64,0)
 . S ^TMP("TIUSNIR",$J,TIUDA,TIUX)=$G(^TIU(8925,+TIUDA,"TEXT",TIUX,0))
"RTN","TIU215F",65,0)
 S TIUVAL="^TMP(""TIUSNIR"","_$J_","_+TIUDA_")"
"RTN","TIU215F",66,0)
 S TIUCHKSU=$$CHKSUM^XUSESIG1(TIUVAL)
"RTN","TIU215F",67,0)
 S SRVAL="^TMP(""SRNIR"","_$J_","_+SRTN_")"
"RTN","TIU215F",68,0)
 S SRCHKSUM=$$CHKSUM^XUSESIG1(SRVAL)
"RTN","TIU215F",69,0)
 I $G(TIUCHKSU)=$G(SRCHKSUM) Q
"RTN","TIU215F",70,0)
 D SETLN("NIR")
"RTN","TIU215F",71,0)
 K @TIUVAL,@SRVAL
"RTN","TIU215F",72,0)
 Q
"RTN","TIU215F",73,0)
CHK1 ;
"RTN","TIU215F",74,0)
 S TIUDA=$P($G(^SRF(SRTN,"TIU")),"^",4)
"RTN","TIU215F",75,0)
 Q:+TIUDA'>0
"RTN","TIU215F",76,0)
 ;DONT EVALUATE UNDICTATED
"RTN","TIU215F",77,0)
 Q:$P($G(^TIU(8925,TIUDA,0)),U,5)=1
"RTN","TIU215F",78,0)
 K ^TMP("TIUSNIR",$J),^TMP("SRANE",$J)
"RTN","TIU215F",79,0)
 D RPT^SROANR(SRTN)
"RTN","TIU215F",80,0)
 ;STRIP OUT SUBFILE DATA
"RTN","TIU215F",81,0)
 S TIUX=0
"RTN","TIU215F",82,0)
 F  S TIUX=$O(^TIU(8925,+TIUDA,"TEXT",TIUX)) Q:TIUX=""  D
"RTN","TIU215F",83,0)
 . S ^TMP("TIUSNIR",$J,TIUDA,TIUX)=$G(^TIU(8925,+TIUDA,"TEXT",TIUX,0))
"RTN","TIU215F",84,0)
 S TIUVAL="^TMP(""TIUSNIR"","_$J_","_+TIUDA_")"
"RTN","TIU215F",85,0)
 S TIUCHKSU=$$CHKSUM^XUSESIG1(TIUVAL)
"RTN","TIU215F",86,0)
 S SRVAL="^TMP(""SRANE"","_$J_","_+SRTN_")"
"RTN","TIU215F",87,0)
 S SRCHKSUM=$$CHKSUM^XUSESIG1(SRVAL)
"RTN","TIU215F",88,0)
 I $G(TIUCHKSU)=$G(SRCHKSUM) Q
"RTN","TIU215F",89,0)
 D SETLN("ANES")
"RTN","TIU215F",90,0)
 K @TIUVAL,@SRVAL
"RTN","TIU215F",91,0)
 Q
"RTN","TIU215F",92,0)
NAM NEW DFN
"RTN","TIU215F",93,0)
 Q:$G(TIUDONE)=1
"RTN","TIU215F",94,0)
 S TIUNAM=$P($G(^TIU(8925,TIUDA,0)),U,2)
"RTN","TIU215F",95,0)
 S DFN=TIUNAM D DEM^VADPT
"RTN","TIU215F",96,0)
 I $D(XPDQUES) S TIUNAM=$E(VADM(1))_VA("BID")
"RTN","TIU215F",97,0)
 E  S TIUNAM=$E(VADM(1),1,20)
"RTN","TIU215F",98,0)
 S Y=$P($G(^TIU(8925,TIUDA,13)),U,1)
"RTN","TIU215F",99,0)
 D DD^%DT S TIUND=Y
"RTN","TIU215F",100,0)
 S TIUDONE=1
"RTN","TIU215F",101,0)
 Q
"RTN","TIU215F",102,0)
ASK S DIR(0)="P^130"
"RTN","TIU215F",103,0)
 S DIR("A")="ENTER THE CASE NUMBER AS `NNNNNN"
"RTN","TIU215F",104,0)
 D ^DIR
"RTN","TIU215F",105,0)
 I $D(DIRUT) K DIRUT G STRT
"RTN","TIU215F",106,0)
 S SRTN=+Y
"RTN","TIU215F",107,0)
 D ^%ZIS G ASK:$G(POP)=1
"RTN","TIU215F",108,0)
 N TIUERR S TIUERR=""
"RTN","TIU215F",109,0)
 D SRHDR
"RTN","TIU215F",110,0)
 U IO
"RTN","TIU215F",111,0)
 W !,SRHDR
"RTN","TIU215F",112,0)
 W !,?4,"PRINTED BY TIU215F UTILITY***** NURSE INTRAOPERATIVE REPORT - CASE #"_SRTN
"RTN","TIU215F",113,0)
 ;D CSUM I $G(TIUERR)=1 W !!,"******It looks like you did not back out patch TIU*1.0*215*****",!
"RTN","TIU215F",114,0)
RPT  D RPT^SRONRPT(SRTN) S DFN=$P(^SRF(SRTN,0),"^")
"RTN","TIU215F",115,0)
 S SRI=0 F  S SRI=$O(^TMP("SRNIR",$J,SRTN,SRI)) Q:'SRI  D
"RTN","TIU215F",116,0)
 .W !,^TMP("SRNIR",$J,SRTN,SRI),!
"RTN","TIU215F",117,0)
 I $Y'=0 W @IOF
"RTN","TIU215F",118,0)
 G RPTX:$P($G(^SRF(SRTN,"TIU")),"^",4)'>0
"RTN","TIU215F",119,0)
 S TIUDA=$P($G(^SRF(SRTN,"TIU")),"^",4) G RPTX:$P($G(^TIU(8925,TIUDA,0)),U,5)=1
"RTN","TIU215F",120,0)
 W !,SRHDR
"RTN","TIU215F",121,0)
 W !,?3,"PRINTED BY TIU215F UTILITY***** ANESTHESIA REPORT - CASE #"_SRTN
"RTN","TIU215F",122,0)
 I $G(TIUERR)=1 W !!,"******It looks like you did not back out patch TIU*1.0*215*****",!
"RTN","TIU215F",123,0)
 D RPT^SROANR(SRTN)
"RTN","TIU215F",124,0)
 S DFN=$P(^SRF(SRTN,0),"^")
"RTN","TIU215F",125,0)
 S SRI=0 F  S SRI=$O(^TMP("SRANE",$J,SRTN,SRI)) Q:'SRI  D
"RTN","TIU215F",126,0)
 .W !,^TMP("SRANE",$J,SRTN,SRI),!
"RTN","TIU215F",127,0)
RPTX D ^%ZISC
"RTN","TIU215F",128,0)
 K SRAGE,SRDIV,SRHDR,SRI,SRLOC,SRPRINT,SRSDATE,TIUERR,VADM,VA,POP,SREST,SRP,SRPOS,SRTN,VAINDT
"RTN","TIU215F",129,0)
 G ASK
"RTN","TIU215F",130,0)
SRHDR S DFN=$P(^SRF(SRTN,0),"^") D DEM^VADPT
"RTN","TIU215F",131,0)
 S Y=$E($P(^SRF(SRTN,0),"^",9),1,7) D D^DIQ S SRSDATE=Y
"RTN","TIU215F",132,0)
 S SRHDR=" "_VADM(1)_" ("_VA("PID")_")   Case #"_SRTN_" - "_SRSDATE
"RTN","TIU215F",133,0)
 Q
"RTN","TIU215F",134,0)
HD NEW HD1,HD2,HD3,HD4,HD5,TIUI,Y
"RTN","TIU215F",135,0)
 S HD1="DIFFERENCE IN CHECKSUMS BETWEEN SURGERY & TIU "
"RTN","TIU215F",136,0)
 S HD2="RUN DATE " D NOW^%DTC S Y=% D DD^%DT S HD2=HD2_Y K %
"RTN","TIU215F",137,0)
 S HD3="START DATE " S Y=TIUDT D DD^%DT S HD3=HD3_Y
"RTN","TIU215F",138,0)
 S HD4="END DATE " S Y=TIUEND D DD^%DT S HD4=HD4_Y
"RTN","TIU215F",139,0)
 S HD5="TYPE  CASE #",$E(HD5,37)=" ",HD5=HD5_"TIU NOTE DATE",$E(HD5,57)=" ",HD5=HD5_"PATIENT "
"RTN","TIU215F",140,0)
 I '$D(XPDQUES) W !,HD1,!,HD2,!,HD3,!,HD4,!,HD5 Q
"RTN","TIU215F",141,0)
 F TIUI=HD1,HD2,HD3,HD4,HD5 S TIUCNT=TIUCNT+1,^TMP("TIU215F",$J,TIUCNT)=TIUI
"RTN","TIU215F",142,0)
 Q
"RTN","TIU215F",143,0)
SETLN(A) ;
"RTN","TIU215F",144,0)
 NEW TIULN
"RTN","TIU215F",145,0)
 S TIUCNT=TIUCNT+1
"RTN","TIU215F",146,0)
 S TIULN=A,$E(TIULN,5)=" "
"RTN","TIU215F",147,0)
 S TIULN=TIULN_" "_SRTN
"RTN","TIU215F",148,0)
 S TIUDAD=0,TIUDAD=$O(^TIU(8925,"DAD",TIUDA,TIUDAD))
"RTN","TIU215F",149,0)
 I +TIUDAD>0 S TIULN=TIULN_"  TIU REPORT HAS ADDENDUM"
"RTN","TIU215F",150,0)
 D NAM
"RTN","TIU215F",151,0)
 S $E(TIULN,37)=" ",TIULN=TIULN_TIUND,$E(TIULN,57)=" ",TIULN=TIULN_TIUNAM
"RTN","TIU215F",152,0)
 I '$D(XPDQUES) W !,TIULN Q
"RTN","TIU215F",153,0)
 S ^TMP("TIU215F",$J,TIUCNT)=TIULN
"RTN","TIU215F",154,0)
 Q
"RTN","TIU215F",155,0)
INS ;ENTRY POINT FOR INSTALL
"RTN","TIU215F",156,0)
 S TIUDT=$G(XPDQUES("POS2"))
"RTN","TIU215F",157,0)
 S TIUEND=$G(XPDQUES("POS3"))
"RTN","TIU215F",158,0)
 K ^TMP("TIU215F",$J)
"RTN","TIU215F",159,0)
 ;D CSUM
"RTN","TIU215F",160,0)
 G EN1
"RTN","TIU215F",161,0)
BULL ; Bulletin of analysis
"RTN","TIU215F",162,0)
 N XMSUB,XMTEXT,XMY,XMDUZ,DIFROM,XMZ,XMMG
"RTN","TIU215F",163,0)
 I $G(TIUCNT)'>5 S ^TMP("TIU215F",$J,6)="No discrepencies found in date range"
"RTN","TIU215F",164,0)
 S XMSUB="ANALYSIS OF POTENTIAL PROBLEMS CAUSED BY PATCH TIU*1.0*215 " K XMY
"RTN","TIU215F",165,0)
 S XMTEXT="^TMP(""TIU215F"",$J,"
"RTN","TIU215F",166,0)
 S XMY($S(DUZ:DUZ,1:.5))=""
"RTN","TIU215F",167,0)
 S XMDUZ=.5 D NOW^%DTC
"RTN","TIU215F",168,0)
 D ^XMD
"RTN","TIU215F",169,0)
 K ^TMP("TIU215F",$J),XMY,XMTEXT,XMSUB
"RTN","TIU215F",170,0)
 Q
"RTN","TIU215F",171,0)
BULL1(A) ; Bulletin
"RTN","TIU215F",172,0)
 S TIUCNT=TIUCNT+1
"RTN","TIU215F",173,0)
 N XMSUB,XMTEXT,XMY,XMDUZ,DIFROM,XMZ,XMMG
"RTN","TIU215F",174,0)
 S XMSUB="ANALYSIS OF POTENTIAL PROBLEMS CAUSED BY PATCH TIU*1.0*215" K XMY
"RTN","TIU215F",175,0)
 S XMTEXT="^TMP(""TIU215F"",$J,"
"RTN","TIU215F",176,0)
 S ^TMP("TIU215F",$J,TIUCNT)=A
"RTN","TIU215F",177,0)
 S XMY($S(DUZ:DUZ,1:.5))=""
"RTN","TIU215F",178,0)
 S XMDUZ=.5 D NOW^%DTC
"RTN","TIU215F",179,0)
 D ^XMD
"RTN","TIU215F",180,0)
 K ^TMP("TIU215F",$J),XMY,XMTEXT,XMSUB
"RTN","TIU215F",181,0)
 Q
"RTN","TIU215F",182,0)
POS2 I $G(XPDQUES("POS1"))'=1 K DIR Q
"RTN","TIU215F",183,0)
 Q
"RTN","TIU215F",184,0)
POS3 I $G(XPDQUES("POS1"))'=1 K DIR Q
"RTN","TIU215F",185,0)
 S DIR(0)="D^"_$G(XPDQUES("POS2"))_":DT:EX"
"RTN","TIU215F",186,0)
 Q
"RTN","TIU215F",187,0)
CSUM Q  I $D(^%ZOSF("RSUM1")) N X,Y S TIUERR="",X="TIULP" X ^%ZOSF("RSUM1") I Y'="47310116" S TIUERR=1
"RTN","TIU215F",188,0)
 Q
"RTN","TIU215F",189,0)
MSG NEW TIUMSG S TIUMSG="No analysis performed, you entered patch not loaded. "
"RTN","TIU215F",190,0)
 I +$O(^XPD(9.7,"B","TIU*1.0*215",0)) S TIUMSG=TIUMSG_"But it is in your install file"
"RTN","TIU215F",191,0)
 D BULL1(TIUMSG)
"RTN","TIU215F",192,0)
 Q 
"RTN","TIU215R")
0^2^B65000557^n/a
"RTN","TIU215R",1,0)
TIU215R ;VMP/RJT - Utililty to analyze problems cause by PATCH TIU*1.0*215 ; 7/25/2007
"RTN","TIU215R",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**231**;Jun 20, 1997;Build 63
"RTN","TIU215R",3,0)
 ; DBIA 4502 TO ACCESS SURGERY FILE
"RTN","TIU215R",4,0)
 ; DBIA 5025 ACCESS ROUTINE SROANR
"RTN","TIU215R",5,0)
 ; DBIA 5024 ACCESS ROUTINE SRONRP
"RTN","TIU215R",6,0)
STRT ;
"RTN","TIU215R",7,0)
 W !!
"RTN","TIU215R",8,0)
EN NEW SRTN,TIUDA,TIUVAL,TIUCHKSU,SRVAL,SRCHKSUM,TIUDT,SRTNA,TIUEND,TIUACNT,TIUER,TIUFDEL,TIUADEL
"RTN","TIU215R",9,0)
 NEW TIUA,TIUDAD,TIUDFN,TIUDONE,TIUNAM,TIUND,TIUX,TIUERR,SURFNAME,TIUFNAME,TIUPATH,SURFILEN,TIUFILEN
"RTN","TIU215R",10,0)
 NEW TIUIO,SURIO,TIUCPF,TIUAIO,TIUANAME
"RTN","TIU215R",11,0)
 S U="^",SURFILEN=1,TIUFILEN=1,TIUACNT=0
"RTN","TIU215R",12,0)
 K ^TMP("TIUSNIR",$J),^TMP("SRNIR",$J)
"RTN","TIU215R",13,0)
 S DIR("A")="Enter a begin date to start searching Surgery cases "
"RTN","TIU215R",14,0)
 S DIR(0)="D^:DT:EX"
"RTN","TIU215R",15,0)
 D ^DIR
"RTN","TIU215R",16,0)
 I $D(DIRUT) K DIRUT Q
"RTN","TIU215R",17,0)
 K DIR
"RTN","TIU215R",18,0)
 S TIUDT=+Y
"RTN","TIU215R",19,0)
 S DIR("A")="Enter date patch was backed out"
"RTN","TIU215R",20,0)
 S DIR(0)="D^"_TIUDT_":DT:EX"
"RTN","TIU215R",21,0)
 D ^DIR
"RTN","TIU215R",22,0)
 K DIR
"RTN","TIU215R",23,0)
 I $D(DIRUT) K DIRUT G STRT
"RTN","TIU215R",24,0)
 S TIUEND=+Y
"RTN","TIU215R",25,0)
 S DIR("A")="Enter the maximum number of cases per file"
"RTN","TIU215R",26,0)
 S DIR(0)="N^5:50"
"RTN","TIU215R",27,0)
 D ^DIR
"RTN","TIU215R",28,0)
 K DIR
"RTN","TIU215R",29,0)
 I $D(DIRUT) K DIRUT G STRT
"RTN","TIU215R",30,0)
 S TIUCPF=Y
"RTN","TIU215R",31,0)
PATH ;
"RTN","TIU215R",32,0)
 K TIUFDEL
"RTN","TIU215R",33,0)
 S DIR("A")="Enter the path of the output files"
"RTN","TIU215R",34,0)
 S DIR(0)="F"
"RTN","TIU215R",35,0)
 S DIR("?")=" "
"RTN","TIU215R",36,0)
 S DIR("?",1)="Enter file path as USER$:[<DIRECTORY NAME>]"
"RTN","TIU215R",37,0)
 D ^DIR
"RTN","TIU215R",38,0)
 I $D(DIRUT) K DIRUT G STRT
"RTN","TIU215R",39,0)
 S TIUPATH=Y
"RTN","TIU215R",40,0)
 K DIR
"RTN","TIU215R",41,0)
 S DIR("A")="Surgery output file (without file extension)"
"RTN","TIU215R",42,0)
 S DIR(0)="F"
"RTN","TIU215R",43,0)
 D ^DIR
"RTN","TIU215R",44,0)
 K DIR
"RTN","TIU215R",45,0)
 I $D(DIRUT) K DIRUT G PATH
"RTN","TIU215R",46,0)
 S SURFNAME=Y
"RTN","TIU215R",47,0)
 D OPENS I POP'=0 G PATH
"RTN","TIU215R",48,0)
 S TIUFDEL(SURFNAME_SURFILEN_".TXT")=""
"RTN","TIU215R",49,0)
 D CLOSE^%ZISH("SUR"_SURFILEN)
"RTN","TIU215R",50,0)
 S DIR("A")="TIU output file (without file extension)"
"RTN","TIU215R",51,0)
 S DIR(0)="F"
"RTN","TIU215R",52,0)
 D ^DIR I $D(DIRUT) S TIUER=$$DEL^%ZISH(TIUPATH,$NA(TIUFDEL)) D ERR:'TIUER K DIR,DIRUT G PATH
"RTN","TIU215R",53,0)
 S TIUFNAME=Y
"RTN","TIU215R",54,0)
 K DIR
"RTN","TIU215R",55,0)
 D OPENT I POP'=0 S TIUER=$$DEL^%ZISH(TIUPATH,$NA(TIUFDEL)) D ERR:'TIUER K DIR G PATH
"RTN","TIU215R",56,0)
 S TIUFDEL(TIUFNAME_TIUFILEN_".TXT")=""
"RTN","TIU215R",57,0)
 D CLOSE^%ZISH("TIU"_TIUFILEN)
"RTN","TIU215R",58,0)
 S DIR("A")="TIU Addenda output file (without file extension)"
"RTN","TIU215R",59,0)
 S DIR(0)="F"
"RTN","TIU215R",60,0)
 D ^DIR I $D(DIRUT) S TIUER=$$DEL^%ZISH(TIUPATH,$NA(TIUFDEL)) D ERR:'TIUER K DIR,DIRUT G PATH
"RTN","TIU215R",61,0)
 S TIUANAME=Y
"RTN","TIU215R",62,0)
 K DIR
"RTN","TIU215R",63,0)
 D OPENA I POP'=0 S TIUER=$$DEL^%ZISH(TIUPATH,$NA(TIUFDEL)) D ERR:'TIUER K DIR G PATH
"RTN","TIU215R",64,0)
 S TIUADEL(TIUANAME_TIUFILEN_".TXT")=""
"RTN","TIU215R",65,0)
 D CLOSE^%ZISH("TIUA"_TIUFILEN)
"RTN","TIU215R",66,0)
 W !!!,"Processing...",!
"RTN","TIU215R",67,0)
 S TIUIO=TIUPATH_TIUFNAME,SURIO=TIUPATH_SURFNAME,TIUAIO=TIUPATH_TIUANAME
"RTN","TIU215R",68,0)
 K TIUFDEL
"RTN","TIU215R",69,0)
EN1 ;
"RTN","TIU215R",70,0)
 NEW TIUCNT,TIURECNT,SURRECNT,TIUCOUNT,SURDT,SURDONE S TIUCNT=0,TIURECNT=0,SURRECNT=0,TIUCOUNT=0
"RTN","TIU215R",71,0)
 ; LOOP THROUGH SURGERY CASES WITHIN DATE RANGE
"RTN","TIU215R",72,0)
 S (TIUDT,SURDT)=TIUDT-.0001
"RTN","TIU215R",73,0)
 F  S SURDT=$O(^SRF("AC",SURDT)) Q:'$L(SURDT)  Q:SURDT\1>TIUEND  D
"RTN","TIU215R",74,0)
 . S TIUA=0 F  S TIUA=$O(^SRF("AC",SURDT,TIUA)) Q:TIUA'>0  D
"RTN","TIU215R",75,0)
 . . S SURDONE="" D CHK,CHK1
"RTN","TIU215R",76,0)
 I TIUACNT=0 S TIUER=$$DEL^%ZISH(TIUPATH,$NA(TIUADEL))
"RTN","TIU215R",77,0)
EN2 ; 
"RTN","TIU215R",78,0)
 W !,"There were "_TIUCOUNT_" records found to be discrepant.",!
"RTN","TIU215R",79,0)
 Q
"RTN","TIU215R",80,0)
 ; BUILD TMP GLOBALS AND COMPARE NIR CASES
"RTN","TIU215R",81,0)
CHK S SRTN=TIUA
"RTN","TIU215R",82,0)
 S TIUDA=$P($G(^SRF(SRTN,"TIU")),"^",2)
"RTN","TIU215R",83,0)
 Q:+TIUDA'>0
"RTN","TIU215R",84,0)
 ;DONT EVALUATE UNDICTATED
"RTN","TIU215R",85,0)
 Q:$P($G(^TIU(8925,TIUDA,0)),U,5)=1
"RTN","TIU215R",86,0)
 S TIUDFN=$P($G(^TIU(8925,TIUDA,0)),U,2)
"RTN","TIU215R",87,0)
 K ^TMP("TIUSNIR",$J),^TMP("SRNIR",$J)
"RTN","TIU215R",88,0)
 D RPT^SRONRPT(SRTN)
"RTN","TIU215R",89,0)
 ;STRIP OUT SUBFILE DATA
"RTN","TIU215R",90,0)
 S TIUX=0
"RTN","TIU215R",91,0)
 F  S TIUX=$O(^TIU(8925,+TIUDA,"TEXT",TIUX)) Q:TIUX=""  D
"RTN","TIU215R",92,0)
 . S ^TMP("TIUSNIR",$J,TIUDA,TIUX)=$G(^TIU(8925,+TIUDA,"TEXT",TIUX,0))
"RTN","TIU215R",93,0)
 S TIUVAL="^TMP(""TIUSNIR"","_$J_","_+TIUDA_")"
"RTN","TIU215R",94,0)
 S TIUCHKSU=$$CHKSUM^XUSESIG1(TIUVAL)
"RTN","TIU215R",95,0)
 S SRVAL="^TMP(""SRNIR"","_$J_","_+SRTN_")"
"RTN","TIU215R",96,0)
 S SRCHKSUM=$$CHKSUM^XUSESIG1(SRVAL)
"RTN","TIU215R",97,0)
 I $G(TIUCHKSU)=$G(SRCHKSUM) Q
"RTN","TIU215R",98,0)
 D NRPT
"RTN","TIU215R",99,0)
 S TIURECNT=TIURECNT+1,SURRECNT=SURRECNT+1,TIUCOUNT=TIUCOUNT+1
"RTN","TIU215R",100,0)
 K @TIUVAL,@SRVAL
"RTN","TIU215R",101,0)
 Q
"RTN","TIU215R",102,0)
CHK1 ; COMPARE ANESTHESIA REPORTS
"RTN","TIU215R",103,0)
 S TIUDA=$P($G(^SRF(SRTN,"TIU")),"^",4)
"RTN","TIU215R",104,0)
 Q:+TIUDA'>0
"RTN","TIU215R",105,0)
 ;DONT EVALUATE UNDICTATED
"RTN","TIU215R",106,0)
 Q:$P($G(^TIU(8925,TIUDA,0)),U,5)=1
"RTN","TIU215R",107,0)
 K ^TMP("TIUSRANE",$J),^TMP("SRANE",$J)
"RTN","TIU215R",108,0)
 D RPT^SROANR(SRTN)
"RTN","TIU215R",109,0)
 ;STRIP OUT SUBFILE DATA
"RTN","TIU215R",110,0)
 S TIUX=0
"RTN","TIU215R",111,0)
 F  S TIUX=$O(^TIU(8925,+TIUDA,"TEXT",TIUX)) Q:TIUX=""  D
"RTN","TIU215R",112,0)
 . S ^TMP("TIUSRANE",$J,TIUDA,TIUX)=$G(^TIU(8925,+TIUDA,"TEXT",TIUX,0))
"RTN","TIU215R",113,0)
 S TIUVAL="^TMP(""TIUSRANE"","_$J_","_+TIUDA_")"
"RTN","TIU215R",114,0)
 S TIUCHKSU=$$CHKSUM^XUSESIG1(TIUVAL)
"RTN","TIU215R",115,0)
 S SRVAL="^TMP(""SRANE"","_$J_","_+SRTN_")"
"RTN","TIU215R",116,0)
 S SRCHKSUM=$$CHKSUM^XUSESIG1(SRVAL)
"RTN","TIU215R",117,0)
 I $G(TIUCHKSU)=$G(SRCHKSUM) Q
"RTN","TIU215R",118,0)
 D ARPT
"RTN","TIU215R",119,0)
 S TIURECNT=TIURECNT+1,SURRECNT=SURRECNT+1,TIUCOUNT=TIUCOUNT+1
"RTN","TIU215R",120,0)
 K @TIUVAL,@SRVAL
"RTN","TIU215R",121,0)
 Q
"RTN","TIU215R",122,0)
NRPT  D RPT^SRONRPT(SRTN) S DFN=$P(^SRF(SRTN,0),"^")
"RTN","TIU215R",123,0)
 D SRHDR
"RTN","TIU215R",124,0)
 D:SURRECNT=TIUCPF NEWSFILE
"RTN","TIU215R",125,0)
 ;D CLOSE^%ZISH("TIU"_TIUFILEN)
"RTN","TIU215R",126,0)
 D OPEN^%ZISH("SUR"_SURFILEN,TIUPATH,SURFNAME_SURFILEN_".TXT","A")
"RTN","TIU215R",127,0)
 U SURIO_SURFILEN_".TXT"
"RTN","TIU215R",128,0)
 W !!!!!!,SRHDR
"RTN","TIU215R",129,0)
 W !,?4,"PRINTED BY TIU215R UTILITY***** NURSE INTRAOPERATIVE REPORT - CASE #"_SRTN
"RTN","TIU215R",130,0)
 S SRI=0 F  S SRI=$O(^TMP("SRNIR",$J,SRTN,SRI)) Q:'SRI  D
"RTN","TIU215R",131,0)
 .W !,^TMP("SRNIR",$J,SRTN,SRI),!
"RTN","TIU215R",132,0)
 D SRHDR
"RTN","TIU215R",133,0)
 D:TIURECNT=TIUCPF NEWTFILE
"RTN","TIU215R",134,0)
 D CLOSE^%ZISH("SUR"_SURFILEN)
"RTN","TIU215R",135,0)
 D OPEN^%ZISH("TIU"_TIUFILEN,TIUPATH,TIUFNAME_TIUFILEN_".TXT","A")
"RTN","TIU215R",136,0)
 U TIUIO_TIUFILEN_".TXT"
"RTN","TIU215R",137,0)
 I +TIUDA'>0 G NE
"RTN","TIU215R",138,0)
 W !!!!!!,SRHDR
"RTN","TIU215R",139,0)
 W !,?4,"PRINTED BY TIU215R UTILITY***** NURSE INTRAOPERATIVE REPORT - CASE #"_SRTN
"RTN","TIU215R",140,0)
 S SRI=0 F  S SRI=$O(^TMP("TIUSNIR",$J,TIUDA,SRI)) Q:'SRI  D
"RTN","TIU215R",141,0)
 .W !,^TMP("TIUSNIR",$J,TIUDA,SRI),!
"RTN","TIU215R",142,0)
 S TIUDAD=$O(^TIU(8925,"DAD",TIUDA,0))
"RTN","TIU215R",143,0)
 I +TIUDAD>0 D CLOSE^%ZISH("TIU"_TIUFILEN),ADDENDA
"RTN","TIU215R",144,0)
NE D CLOSE^%ZISH("TIU"_TIUFILEN)
"RTN","TIU215R",145,0)
 D KIL
"RTN","TIU215R",146,0)
 Q
"RTN","TIU215R",147,0)
ARPT ;
"RTN","TIU215R",148,0)
 D SRHDR
"RTN","TIU215R",149,0)
 D:SURRECNT=TIUCPF NEWSFILE
"RTN","TIU215R",150,0)
 ;D CLOSE^%ZISH("TIU"_TIUFILEN)
"RTN","TIU215R",151,0)
 D OPEN^%ZISH("SUR"_SURFILEN,TIUPATH,SURFNAME_SURFILEN_".TXT","A")
"RTN","TIU215R",152,0)
 U SURIO_SURFILEN_".TXT"
"RTN","TIU215R",153,0)
 W !,SRHDR
"RTN","TIU215R",154,0)
 W !,?3,"PRINTED BY TIU215R UTILITY***** ANESTHESIA REPORT - CASE #"_SRTN
"RTN","TIU215R",155,0)
 D RPT^SROANR(SRTN)
"RTN","TIU215R",156,0)
 S DFN=$P(^SRF(SRTN,0),"^")
"RTN","TIU215R",157,0)
 S SRI=0 F  S SRI=$O(^TMP("SRANE",$J,SRTN,SRI)) Q:'SRI  D
"RTN","TIU215R",158,0)
 .W !,^TMP("SRANE",$J,SRTN,SRI),!
"RTN","TIU215R",159,0)
 D SRHDR
"RTN","TIU215R",160,0)
 D:TIURECNT=TIUCPF NEWTFILE
"RTN","TIU215R",161,0)
 D CLOSE^%ZISH("SUR"_SURFILEN)
"RTN","TIU215R",162,0)
 D OPEN^%ZISH("TIU"_TIUFILEN,TIUPATH,TIUFNAME_TIUFILEN_".TXT","A")
"RTN","TIU215R",163,0)
 U TIUIO_TIUFILEN_".TXT"
"RTN","TIU215R",164,0)
 I +TIUDA'>0 G AE
"RTN","TIU215R",165,0)
 W !!!!!!,SRHDR
"RTN","TIU215R",166,0)
 W !,?3,"PRINTED BY TIU215R UTILITY***** ANESTHESIA REPORT - CASE #"_SRTN
"RTN","TIU215R",167,0)
 S SRI=0 F  S SRI=$O(^TMP("TIUSRANE",$J,TIUDA,SRI)) Q:'SRI  D
"RTN","TIU215R",168,0)
 .W !,^TMP("TIUSRANE",$J,TIUDA,SRI),!
"RTN","TIU215R",169,0)
 S TIUDAD=$O(^TIU(8925,"DAD",TIUDA,0))
"RTN","TIU215R",170,0)
 I +TIUDAD>0 D CLOSE^%ZISH("TIU"_TIUFILEN),ADDENDA
"RTN","TIU215R",171,0)
AE D CLOSE^%ZISH("TIU"_TIUFILEN)
"RTN","TIU215R",172,0)
 D KIL
"RTN","TIU215R",173,0)
 Q
"RTN","TIU215R",174,0)
KIL K SRHDR,SRI,SRSDATE,VADM,VA,POP,VAINDT
"RTN","TIU215R",175,0)
 Q
"RTN","TIU215R",176,0)
ERR W !,"UNABLE TO CLEAN UP FILES ON ^ ABORT" Q
"RTN","TIU215R",177,0)
SRHDR NEW DFN,Y
"RTN","TIU215R",178,0)
 S DFN=$P(^SRF(SRTN,0),"^") D DEM^VADPT
"RTN","TIU215R",179,0)
 S Y=$E($P(^SRF(SRTN,0),"^",9),1,7) D D^DIQ S SRSDATE=Y
"RTN","TIU215R",180,0)
 S SRHDR=" "_VADM(1)_" ("_VA("PID")_")   Case #"_SRTN_" - "_SRSDATE
"RTN","TIU215R",181,0)
 Q
"RTN","TIU215R",182,0)
ADDENDA ;
"RTN","TIU215R",183,0)
 N TIUI,TIUDAD S TIUI=0,TIUDAD=0,TIUACNT=1
"RTN","TIU215R",184,0)
 D OPEN^%ZISH("TIUA"_TIUFILEN,TIUPATH,TIUANAME_TIUFILEN_".TXT","A")
"RTN","TIU215R",185,0)
 U TIUAIO_TIUFILEN_".TXT"
"RTN","TIU215R",186,0)
 W !!!!,"**************************************************************************",!,SRHDR
"RTN","TIU215R",187,0)
 W !,?4,"PRINTED BY TIU215F UTILITY***** TIU ADDENDA - CASE #"_SRTN,!,"**************************************************************************",!
"RTN","TIU215R",188,0)
  ; Loop through all addenda for that note
"RTN","TIU215R",189,0)
 F  S TIUDAD=$O(^TIU(8925,"DAD",TIUDA,TIUDAD)) Q:TIUDAD'>0  D
"RTN","TIU215R",190,0)
 . W !!,?2,"ADDENDUM #"_TIUDAD,!,?2,"-----------------------------------------" S TIUI=0
"RTN","TIU215R",191,0)
 . ; Loop through entire addendum
"RTN","TIU215R",192,0)
 . F  S TIUI=$O(^TIU(8925,TIUDAD,"TEXT",TIUI)) Q:TIUI'>0  D
"RTN","TIU215R",193,0)
 . . W !,$G(^TIU(8925,TIUDAD,"TEXT",TIUI,0))
"RTN","TIU215R",194,0)
 D CLOSE^%ZISH("TIUA"_TIUFILEN)
"RTN","TIU215R",195,0)
 Q
"RTN","TIU215R",196,0)
NEWSFILE ;
"RTN","TIU215R",197,0)
 D CLOSE^%ZISH("SUR"_SURFILEN) S SURFILEN=SURFILEN+1,SURRECNT=0
"RTN","TIU215R",198,0)
 D OPEN^%ZISH("SUR"_SURFILEN,TIUPATH,SURFNAME_SURFILEN_".TXT","W")
"RTN","TIU215R",199,0)
 Q
"RTN","TIU215R",200,0)
NEWTFILE ;
"RTN","TIU215R",201,0)
 D CLOSE^%ZISH("TIU"_TIUFILEN) S TIUFILEN=TIUFILEN+1,TIURECNT=0
"RTN","TIU215R",202,0)
 D OPEN^%ZISH("TIU"_TIUFILEN,TIUPATH,TIUFNAME_TIUFILEN_".TXT","W")
"RTN","TIU215R",203,0)
 Q
"RTN","TIU215R",204,0)
OPENS ;
"RTN","TIU215R",205,0)
 D OPEN^%ZISH("SUR"_SURFILEN,TIUPATH,SURFNAME_SURFILEN_".TXT","W")
"RTN","TIU215R",206,0)
 I POP'=0 W !,"Error opening Surgery output file.",!
"RTN","TIU215R",207,0)
 Q
"RTN","TIU215R",208,0)
OPENT ;
"RTN","TIU215R",209,0)
 D OPEN^%ZISH("TIU"_TIUFILEN,TIUPATH,TIUFNAME_TIUFILEN_".TXT","W")
"RTN","TIU215R",210,0)
 I POP'=0 W !,"Error opening TIU output file.",!
"RTN","TIU215R",211,0)
 Q
"RTN","TIU215R",212,0)
OPENA ;
"RTN","TIU215R",213,0)
 D OPEN^%ZISH("TIUA"_TIUFILEN,TIUPATH,TIUANAME_TIUFILEN_".TXT","W")
"RTN","TIU215R",214,0)
 I POP'=0 W !,"Error opening TIU Addendum output file.",!
"RTN","TIU215R",215,0)
 Q
"VER")
8.0^22.0
"BLD",7350,6)
^222
**END**
**END**
