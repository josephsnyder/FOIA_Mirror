Released TIU*1*233 SEQ #229
Extracted from mail message
**KIDS**:TIU*1.0*233^

**INSTALL NAME**
TIU*1.0*233
"BLD",7363,0)
TIU*1.0*233^TEXT INTEGRATION UTILITIES^0^3081215^y
"BLD",7363,1,0)
^^6^6^3071023^
"BLD",7363,1,1,0)
This patch includes fixes for the following Remedy tickets:
"BLD",7363,1,2,0)
 
"BLD",7363,1,3,0)
 HD69299 - ID SIGNER/CO-SIGNER
"BLD",7363,1,4,0)
 HD99628 - Spacebar option not working after patch TIU*1*173 
"BLD",7363,1,5,0)
 HD69093 - Can not print warning for addendum
"BLD",7363,1,6,0)
 HD94265 - Can not delete duplicate UNDICTATED Opertion Report
"BLD",7363,4,0)
^9.64PA^^
"BLD",7363,6)
2^
"BLD",7363,6.3)
3
"BLD",7363,"KRN",0)
^9.67PA^8989.52^19
"BLD",7363,"KRN",.4,0)
.4
"BLD",7363,"KRN",.401,0)
.401
"BLD",7363,"KRN",.402,0)
.402
"BLD",7363,"KRN",.403,0)
.403
"BLD",7363,"KRN",.5,0)
.5
"BLD",7363,"KRN",.84,0)
.84
"BLD",7363,"KRN",3.6,0)
3.6
"BLD",7363,"KRN",3.8,0)
3.8
"BLD",7363,"KRN",9.2,0)
9.2
"BLD",7363,"KRN",9.8,0)
9.8
"BLD",7363,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",7363,"KRN",9.8,"NM",1,0)
TIUADCL^^0^B70211240
"BLD",7363,"KRN",9.8,"NM",2,0)
TIUPRPN1^^0^B56280511
"BLD",7363,"KRN",9.8,"NM",3,0)
TIURD^^0^B47466045
"BLD",7363,"KRN",9.8,"NM",4,0)
TIURS1^^0^B73623745
"BLD",7363,"KRN",9.8,"NM","B","TIUADCL",1)

"BLD",7363,"KRN",9.8,"NM","B","TIUPRPN1",2)

"BLD",7363,"KRN",9.8,"NM","B","TIURD",3)

"BLD",7363,"KRN",9.8,"NM","B","TIURS1",4)

"BLD",7363,"KRN",19,0)
19
"BLD",7363,"KRN",19.1,0)
19.1
"BLD",7363,"KRN",101,0)
101
"BLD",7363,"KRN",409.61,0)
409.61
"BLD",7363,"KRN",771,0)
771
"BLD",7363,"KRN",870,0)
870
"BLD",7363,"KRN",8989.51,0)
8989.51
"BLD",7363,"KRN",8989.52,0)
8989.52
"BLD",7363,"KRN",8994,0)
8994
"BLD",7363,"KRN","B",.4,.4)

"BLD",7363,"KRN","B",.401,.401)

"BLD",7363,"KRN","B",.402,.402)

"BLD",7363,"KRN","B",.403,.403)

"BLD",7363,"KRN","B",.5,.5)

"BLD",7363,"KRN","B",.84,.84)

"BLD",7363,"KRN","B",3.6,3.6)

"BLD",7363,"KRN","B",3.8,3.8)

"BLD",7363,"KRN","B",9.2,9.2)

"BLD",7363,"KRN","B",9.8,9.8)

"BLD",7363,"KRN","B",19,19)

"BLD",7363,"KRN","B",19.1,19.1)

"BLD",7363,"KRN","B",101,101)

"BLD",7363,"KRN","B",409.61,409.61)

"BLD",7363,"KRN","B",771,771)

"BLD",7363,"KRN","B",870,870)

"BLD",7363,"KRN","B",8989.51,8989.51)

"BLD",7363,"KRN","B",8989.52,8989.52)

"BLD",7363,"KRN","B",8994,8994)

"BLD",7363,"QUES",0)
^9.62^^
"BLD",7363,"REQB",0)
^9.611^3^3
"BLD",7363,"REQB",1,0)
TIU*1.0*173^1
"BLD",7363,"REQB",2,0)
TIU*1.0*184^1
"BLD",7363,"REQB",3,0)
TIU*1.0*234^1
"BLD",7363,"REQB","B","TIU*1.0*173",1)

"BLD",7363,"REQB","B","TIU*1.0*184",2)

"BLD",7363,"REQB","B","TIU*1.0*234",3)

"MBREQ")
0
"PKG",588,-1)
1^1
"PKG",588,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",588,20,0)
^9.402P^^
"PKG",588,22,0)
^9.49I^1^1
"PKG",588,22,1,0)
1.0^2970620^2971202^1
"PKG",588,22,1,"PAH",1,0)
233^3081215^520645574
"PKG",588,22,1,"PAH",1,1,0)
^^6^6^3081215
"PKG",588,22,1,"PAH",1,1,1,0)
This patch includes fixes for the following Remedy tickets:
"PKG",588,22,1,"PAH",1,1,2,0)
 
"PKG",588,22,1,"PAH",1,1,3,0)
 HD69299 - ID SIGNER/CO-SIGNER
"PKG",588,22,1,"PAH",1,1,4,0)
 HD99628 - Spacebar option not working after patch TIU*1*173 
"PKG",588,22,1,"PAH",1,1,5,0)
 HD69093 - Can not print warning for addendum
"PKG",588,22,1,"PAH",1,1,6,0)
 HD94265 - Can not delete duplicate UNDICTATED Opertion Report
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","TIUADCL")
0^1^B70211240^B69967595
"RTN","TIUADCL",1,0)
TIUADCL ; SLC/AJB - UNK Addenda Cleanup ; 10/01/04
"RTN","TIUADCL",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**173,233**;Jun 20, 1997;Build 3
"RTN","TIUADCL",3,0)
 ;
"RTN","TIUADCL",4,0)
 ; Cleanup Utility for OPERATION REPORT addenda.
"RTN","TIUADCL",5,0)
 ; Finds parentless/unknown addenda and attaches to user
"RTN","TIUADCL",6,0)
 ; selected parent.
"RTN","TIUADCL",7,0)
 ;
"RTN","TIUADCL",8,0)
 Q
"RTN","TIUADCL",9,0)
EN ; main entry point for TIU UNK ADDENDA CLEANUP
"RTN","TIUADCL",10,0)
 N DTR1,TIUQUIT
"RTN","TIUADCL",11,0)
 D DTRANGE(.DTR1) Q:$D(TIUQUIT)
"RTN","TIUADCL",12,0)
 D EN^VALM("TIU UNK ADDENDA CLEANUP")
"RTN","TIUADCL",13,0)
 Q
"RTN","TIUADCL",14,0)
EXIT ;
"RTN","TIUADCL",15,0)
 D XQORM
"RTN","TIUADCL",16,0)
 Q
"RTN","TIUADCL",17,0)
HDR ; sets header
"RTN","TIUADCL",18,0)
 N HDR
"RTN","TIUADCL",19,0)
 S HDR="UNKNOWN ADDENDA from "_$$FMTE^XLFDT(DTR1("BEGDT"),"D")_" to "_$$FMTE^XLFDT(DTR1("ENDDT"),"D")
"RTN","TIUADCL",20,0)
 S VALMHDR(1)=$$SETSTR^VALM1(HDR,"",(IOM-$L(HDR))/2,$L(HDR))
"RTN","TIUADCL",21,0)
 D XQORM
"RTN","TIUADCL",22,0)
 Q
"RTN","TIUADCL",23,0)
HELP ; help code
"RTN","TIUADCL",24,0)
 N DIR
"RTN","TIUADCL",25,0)
 I X="?" S DIR("A")="Enter RETURN to continue or '^' to exit",DIR(0)="E"
"RTN","TIUADCL",26,0)
 D FULL^VALM1
"RTN","TIUADCL",27,0)
 W !!,"The following actions are available:"
"RTN","TIUADCL",28,0)
 W !,"Browse a Document  - View a selected document (if authorized)"
"RTN","TIUADCL",29,0)
 W !,"Change View        - Modify search criteria"
"RTN","TIUADCL",30,0)
 W !,"Detailed Display   - View detailed display of a document (if authorized)"
"RTN","TIUADCL",31,0)
 W !,"Find Parent        - Find available OPERATION REPORTS to assign as parent",!
"RTN","TIUADCL",32,0)
 I $D(DIR("A")) D ^DIR
"RTN","TIUADCL",33,0)
 S VALMBCK="R"
"RTN","TIUADCL",34,0)
 Q
"RTN","TIUADCL",35,0)
INIT ; finds unknown addenda & creates list
"RTN","TIUADCL",36,0)
 N ADDENDUM,STRTDT,TIUDA,TIU
"RTN","TIUADCL",37,0)
 S TIU("IOCUOFF")=$C(27)_"[?25l",TIU("IOCUON")=$C(27)_"[?25h"
"RTN","TIUADCL",38,0)
 W TIU("IOCUOFF")
"RTN","TIUADCL",39,0)
 W !!,"Searching for the documents."
"RTN","TIUADCL",40,0)
 S ADDENDUM=$$CHKFILE(8925.1,"ADDENDUM","I $P(^(0),U,4)=""DOC"""),TIUDA="",STRTDT=DTR1("BEGDT"),VALMCNT=0
"RTN","TIUADCL",41,0)
 F  S STRTDT=$O(^TIU(8925,"F",STRTDT)) Q:STRTDT=""!(STRTDT>DTR1("ENDDT"))  F  S TIUDA=$O(^TIU(8925,"F",STRTDT,TIUDA)) Q:TIUDA=""  I +$G(^TIU(8925,TIUDA,0))=ADDENDUM,'+$P($G(^TIU(8925,TIUDA,0)),U,6) D
"RTN","TIUADCL",42,0)
 . N DISPLAY
"RTN","TIUADCL",43,0)
 . S VALMCNT=VALMCNT+1 W:VALMCNT#3=0 "."
"RTN","TIUADCL",44,0)
 . S DISPLAY=$$SETSTR^VALM1(VALMCNT,"",1,4)
"RTN","TIUADCL",45,0)
 . S DISPLAY=$$SETSTR^VALM1($$PATIENT^TIU144($P($G(^TIU(8925,TIUDA,0)),U,2)),DISPLAY,6,38)
"RTN","TIUADCL",46,0)
 . S DISPLAY=$$SETSTR^VALM1(TIUDA,DISPLAY,40,50)
"RTN","TIUADCL",47,0)
 . S DISPLAY=$$SETSTR^VALM1($$FDATE^VALM1($$GET1^DIQ(8925,TIUDA,1201,"I")),DISPLAY,52,62)
"RTN","TIUADCL",48,0)
 . S DISPLAY=$$SETSTR^VALM1($$GET1^DIQ(8925,TIUDA,.05),DISPLAY,62,73)
"RTN","TIUADCL",49,0)
 . S DISPLAY=$$SETSTR^VALM1("NO",DISPLAY,74,76)
"RTN","TIUADCL",50,0)
 . D SET^VALM10(VALMCNT,DISPLAY,TIUDA)
"RTN","TIUADCL",51,0)
 I VALMCNT=0 D
"RTN","TIUADCL",52,0)
 . D SET^VALM10(2,$$SETSTR^VALM1("No records found to satisfy search criteria.","",(IOM-$L("No records found to satisfy search criteria."))/2,$L("No records found to satisfy search criteria.")),0)
"RTN","TIUADCL",53,0)
 Q
"RTN","TIUADCL",54,0)
XQORM ; default action for list manager
"RTN","TIUADCL",55,0)
 S XQORM("#")=$O(^ORD(101,"B","TIU UNK ADDENDA SELECT",0))_U_"1:"_VALMCNT
"RTN","TIUADCL",56,0)
 Q
"RTN","TIUADCL",57,0)
ACTIONS ; user selectable actions
"RTN","TIUADCL",58,0)
 N ACTION,TIUCONT
"RTN","TIUADCL",59,0)
 D   I ACTION=-1 S VALMBCK="R" Q
"RTN","TIUADCL",60,0)
 . N DIR,DIRUT,POP,X,Y
"RTN","TIUADCL",61,0)
 . S DIR(0)=$S(VALM("TITLE")="TIU/Surgery Cleanup":"SA^1:Browse Document;2:Detailed Display;3:Find Parent",1:"SA^1:Browse Document;2:Detailed Display;3:Attach to Parent")
"RTN","TIUADCL",62,0)
 . S DIR("A")="Select Action: "
"RTN","TIUADCL",63,0)
 . S DIR("B")=$S(VALM("TITLE")="TIU/Surgery Cleanup":"Find Parent",1:"Attach to Parent")
"RTN","TIUADCL",64,0)
 . S DIR("L",1)="1.   Browse a Document"
"RTN","TIUADCL",65,0)
 . S DIR("L",2)=$S(VALM("TITLE")="TIU/Surgery Cleanup":"2.   Detailed Display                   3.   Find Parent",1:"2.   Detailed Display                   3.   Attach to Parent")
"RTN","TIUADCL",66,0)
 . S DIR("L",4)=""
"RTN","TIUADCL",67,0)
 . S DIR("L")="Enter selection by typing the name, number, or abbreviation"
"RTN","TIUADCL",68,0)
 . S DIR("?",1)="The following actions are available:"
"RTN","TIUADCL",69,0)
 . S DIR("?",2)=""
"RTN","TIUADCL",70,0)
 . S DIR("?",3)="Browse a Document  - View a selected document (if authorized)"
"RTN","TIUADCL",71,0)
 . S DIR("?",4)="Detailed Display   - Detailed View of a selected document (if authorized)"
"RTN","TIUADCL",72,0)
 . S DIR("?")=$S(VALM("TITLE")="TIU/Surgery Cleanup":"Find Parent        - Find OPERATION REPORT to attach as parent",1:"Attach to Parent   - Attach selected addenda to parent")
"RTN","TIUADCL",73,0)
 . F  D ^DIR D  Q:$G(TIUCONT)!$D(DIRUT)
"RTN","TIUADCL",74,0)
 . . I VALM("TITLE")="Operation Reports",$$MULTI("TIUDOCS")>1,+Y=3 D  Q
"RTN","TIUADCL",75,0)
 . . . W !!,"You may only attach addenda to one parent at a time."
"RTN","TIUADCL",76,0)
 . . . W !,"Select only one parent for this action.",!
"RTN","TIUADCL",77,0)
 . . . I $$READ^TIUU("EA","Press <RETURN> to continue")
"RTN","TIUADCL",78,0)
 . . I $$MULTI("TIUDOCS")>1,(+Y=1!(+Y=2)) D  Q
"RTN","TIUADCL",79,0)
 . . . W !!,"You may only view one document at a time."
"RTN","TIUADCL",80,0)
 . . . W !,"Select only one document for this action.",!
"RTN","TIUADCL",81,0)
 . . . I $$READ^TIUU("EA","Press <RETURN> to continue")
"RTN","TIUADCL",82,0)
 . . S TIUCONT=1
"RTN","TIUADCL",83,0)
 . I VALM("TITLE")="TIU/Surgery Cleanup" S ACTION=$S(+Y=1:"BROWSE",+Y=2:"DETDISP",+Y=3:"FNDPRNT",Y=U:-1,1:-1)
"RTN","TIUADCL",84,0)
 . E  S ACTION=$S(+Y=1:"BROWSE",+Y=2:"DETDISP",+Y=3:"ATTACH^TIUADCL1",Y=U:-1,1:-1)
"RTN","TIUADCL",85,0)
 I $G(TIUCONT)=1 D @ACTION
"RTN","TIUADCL",86,0)
 S VALMBCK=$S(ACTION="ATTACH^TIUADCL1":"Q",1:"R")
"RTN","TIUADCL",87,0)
 Q
"RTN","TIUADCL",88,0)
BROWSE ; browse document
"RTN","TIUADCL",89,0)
 N TIUDA S TIUDA=+$$ONEDOC()
"RTN","TIUADCL",90,0)
 D EN^VALM("TIU BROWSE FOR READ ONLY")
"RTN","TIUADCL",91,0)
 Q
"RTN","TIUADCL",92,0)
CHKFILE(FILE,NAME,SCREEN) ; checks entry in file and returns IEN
"RTN","TIUADCL",93,0)
 ; VMP/RJT - *233 - added Forget Lookup Value flag to DIC call since its affecting the value in the ^DISV global (spacebar return function)
"RTN","TIUADCL",94,0)
 N DIC,X,Y S DIC=FILE,DIC(0)="FX",DIC("S")=$G(SCREEN),X=NAME D ^DIC
"RTN","TIUADCL",95,0)
 Q +Y
"RTN","TIUADCL",96,0)
CHNGVIEW ; allows user to change search parameters
"RTN","TIUADCL",97,0)
 D FULL^VALM1
"RTN","TIUADCL",98,0)
 W @IOF
"RTN","TIUADCL",99,0)
 I VALM("TITLE")="TIU/Surgery Cleanup" D  I $D(TIUQUIT) S VALMBCK="R" Q
"RTN","TIUADCL",100,0)
 . D DTRANGE(.DTR1) Q:$D(TIUQUIT)
"RTN","TIUADCL",101,0)
 . D CLEAN^VALM10,INIT,HDR S VALMBG=1
"RTN","TIUADCL",102,0)
 I VALM("TITLE")="Operation Reports" D  I $D(TIUQUIT) S VALMBCK="R" Q
"RTN","TIUADCL",103,0)
 . D DTRANGE(.DTR2) Q:$D(TIUQUIT)
"RTN","TIUADCL",104,0)
 . D CLEAN^VALM10,INIT^TIUADCL1,HDR^TIUADCL1 S VALMBG=1
"RTN","TIUADCL",105,0)
 Q
"RTN","TIUADCL",106,0)
DATE(TIUDT,TIUSEQ) ; if date is year entry only, appends Jan 01/Dec 31@2400 respectively
"RTN","TIUADCL",107,0)
 I TIUDT["0000" S TIUDT=TIUDT/10000,TIUDT=TIUDT_$S(TIUSEQ=1:"0101",TIUSEQ=2:"1231")
"RTN","TIUADCL",108,0)
 I TIUSEQ=2 S TIUDT=TIUDT_".24"
"RTN","TIUADCL",109,0)
 Q TIUDT
"RTN","TIUADCL",110,0)
DTRANGE(DTRANGE) ; prompts user for date range input
"RTN","TIUADCL",111,0)
 N %DT,CNT,POP,X,Y
"RTN","TIUADCL",112,0)
 S %DT="AE",%DT(0)=$$NOW^XLFDT*-1
"RTN","TIUADCL",113,0)
 W @IOF
"RTN","TIUADCL",114,0)
 F CNT=1:1:2 D
"RTN","TIUADCL",115,0)
 . S %DT("A")=$S(CNT=1:"START WITH REFERENCE DATE:  ",CNT=2:"     GO TO REFERENCE DATE:  ")
"RTN","TIUADCL",116,0)
 . S %DT("B")=$S(CNT=1:"Jan 01, 2003",CNT=2:$P($$HTE^XLFDT($H),"@"))
"RTN","TIUADCL",117,0)
 . D ^%DT
"RTN","TIUADCL",118,0)
 . I Y=-1 S CNT=2,TIUQUIT=1 Q
"RTN","TIUADCL",119,0)
 . I CNT=1 S DTRANGE("BEGDT")=$$DATE(Y,CNT),%DT(0)=DTRANGE("BEGDT") Q
"RTN","TIUADCL",120,0)
 . S DTRANGE("ENDDT")=$$DATE(Y,CNT),X=$P($$NOW^XLFDT,".")_".24" I DTRANGE("ENDDT")>X S CNT=1 W !!,?42,"Future dates are not allowed.",!
"RTN","TIUADCL",121,0)
 Q
"RTN","TIUADCL",122,0)
DETDISP ; detailed display
"RTN","TIUADCL",123,0)
 N D0,DIROUT,RSTRCTD,TIUDA,TIUD,TIUDATA,TIUGDATA,TIUSEL,TIUI,TIUQUIT,Y
"RTN","TIUADCL",124,0)
 S TIUDA=+$$ONEDOC()
"RTN","TIUADCL",125,0)
 D
"RTN","TIUADCL",126,0)
 . N TIUVIEW
"RTN","TIUADCL",127,0)
 . D CLEAR^VALM1
"RTN","TIUADCL",128,0)
 . S TIUVIEW=$$CANDO^TIULP(TIUDA,"VIEW")
"RTN","TIUADCL",129,0)
 . I +TIUVIEW'>0 D  Q
"RTN","TIUADCL",130,0)
 . . W !!,$C(7),$P(TIUVIEW,U,2),!
"RTN","TIUADCL",131,0)
 . . I $$READ^TIUU("EA","Press <RETURN> to continue")
"RTN","TIUADCL",132,0)
 . S RSTRCTD=$$DOCRES^TIULRR(TIUDA)
"RTN","TIUADCL",133,0)
 . I RSTRCTD D  Q
"RTN","TIUADCL",134,0)
 . . W !!,$C(7),"Ok, no harm done...",!
"RTN","TIUADCL",135,0)
 . . I $$READ^TIUU("EA","Press <RETURN> to continue")
"RTN","TIUADCL",136,0)
 . D EN^TIUAUDIT
"RTN","TIUADCL",137,0)
 . I +$G(TIUQUIT) D FIXLSTNW^TIULM Q
"RTN","TIUADCL",138,0)
 K VALMY S VALMBCK="R"
"RTN","TIUADCL",139,0)
 Q
"RTN","TIUADCL",140,0)
FNDPRNT ; executes LM for TIU UNK ADDENDA ATTACH
"RTN","TIUADCL",141,0)
 N PARENT,TIUDISP,TIUTMP
"RTN","TIUADCL",142,0)
 D EN^TIUADCL1
"RTN","TIUADCL",143,0)
 S TIUTMP=""
"RTN","TIUADCL",144,0)
 F  S TIUTMP=$O(TIUDOCS(TIUTMP)) Q:TIUTMP=""  D
"RTN","TIUADCL",145,0)
 . S TIUDISP=@VALMAR@(TIUTMP,0)
"RTN","TIUADCL",146,0)
 . S PARENT=+$P($G(^TIU(8925,TIUDOCS(TIUTMP),0)),U,6)
"RTN","TIUADCL",147,0)
 . S TIUDISP=$$SETSTR^VALM1($S(PARENT=0:"NO",PARENT>0:"#"_PARENT),TIUDISP,74,80)
"RTN","TIUADCL",148,0)
 . D SET^VALM10(TIUTMP,TIUDISP,TIUDOCS(TIUTMP))
"RTN","TIUADCL",149,0)
 D RE^VALM4
"RTN","TIUADCL",150,0)
 Q
"RTN","TIUADCL",151,0)
MULTI(TIUCHK) ;
"RTN","TIUADCL",152,0)
 N TIUCNT,TIUTMP
"RTN","TIUADCL",153,0)
 S TIUCNT=0,TIUTMP=""
"RTN","TIUADCL",154,0)
 F  S TIUTMP=$O(@TIUCHK@(TIUTMP)) Q:TIUTMP=""  S TIUCNT=TIUCNT+1
"RTN","TIUADCL",155,0)
 Q TIUCNT
"RTN","TIUADCL",156,0)
ONEDOC() ;
"RTN","TIUADCL",157,0)
 N TIUTMP
"RTN","TIUADCL",158,0)
 S TIUTMP=""
"RTN","TIUADCL",159,0)
 F  S TIUTMP=$O(TIUDOCS(TIUTMP)) Q:+TIUTMP
"RTN","TIUADCL",160,0)
 Q TIUDOCS(TIUTMP)
"RTN","TIUADCL",161,0)
SELECT(ACTION) ; selects document(s) and calls ACTION
"RTN","TIUADCL",162,0)
 N TIUDOCS,TIUSEL,TIUQUIT
"RTN","TIUADCL",163,0)
 D FULL^VALM1
"RTN","TIUADCL",164,0)
 I VALMCNT=0 W !,"No documents to select." H 3 Q
"RTN","TIUADCL",165,0)
 S TIUSEL=$P(XQORNOD(0),"=",2)
"RTN","TIUADCL",166,0)
 I TIUSEL="" D  Q:$D(TIUQUIT)
"RTN","TIUADCL",167,0)
 . I VALMLST=1 S TIUDOCS(1)=$O(@VALMAR@("IDX",1,"")) Q
"RTN","TIUADCL",168,0)
 . N DIR,X,Y
"RTN","TIUADCL",169,0)
 . S DIR("A")="Select Document(s): (1-"_VALMLST_") "
"RTN","TIUADCL",170,0)
 . S DIR(0)="LAC^1:"_VALMLST
"RTN","TIUADCL",171,0)
 . D ^DIR I $D(DIRUT)!(Y=U) S TIUQUIT=1 Q
"RTN","TIUADCL",172,0)
 . S TIUSEL=Y(0)
"RTN","TIUADCL",173,0)
 I $A($E(TIUSEL,$L(TIUSEL)))<48!($A($E(TIUSEL,$L(TIUSEL)))>57) S TIUSEL=$E(TIUSEL,1,$L(TIUSEL)-1)
"RTN","TIUADCL",174,0)
 F X=1:1  Q:$P(TIUSEL,",",X)=""  D
"RTN","TIUADCL",175,0)
 . N TIUCNT
"RTN","TIUADCL",176,0)
 . I $P(TIUSEL,",",X)["-" F TIUCNT=+$P(TIUSEL,",",X):1:$P($P(TIUSEL,",",X),"-",2) S:TIUCNT<VALMLST TIUDOCS(TIUCNT)=$O(@VALMAR@("IDX",TIUCNT,""))
"RTN","TIUADCL",177,0)
 . E  S:$P(TIUSEL,",",X)'>VALMLST TIUDOCS($P(TIUSEL,",",X))=$O(@VALMAR@("IDX",$P(TIUSEL,",",X),""))
"RTN","TIUADCL",178,0)
 I $$MULTI("TIUDOCS")>1,VALM("TITLE")="Operation Reports" D  Q
"RTN","TIUADCL",179,0)
 . W !!,"You may not select multiple OPERATION Reports to view or attach addenda to."
"RTN","TIUADCL",180,0)
 . W !,"Select only one document to view or attach addenda.",!
"RTN","TIUADCL",181,0)
 . I $$READ^TIUU("EA","Press <RETURN> to continue")
"RTN","TIUADCL",182,0)
 . S VALMBCK="R"
"RTN","TIUADCL",183,0)
 I $$MULTI("TIUDOCS")>1,(ACTION="BROWSE"!(ACTION="DETDISP")) D  Q
"RTN","TIUADCL",184,0)
 . W !!,"You may only view one document at a time."
"RTN","TIUADCL",185,0)
 . W !,"Select only one document for this action.",!
"RTN","TIUADCL",186,0)
 . I $$READ^TIUU("EA","Press <RETURN> to continue")
"RTN","TIUADCL",187,0)
 I VALM("TITLE")'="Operation Reports" S VALMBCK="R"
"RTN","TIUADCL",188,0)
 S TIUDOCS="" F  S TIUDOCS=$O(TIUDOCS(TIUDOCS)) Q:TIUDOCS=""  I $$GET1^DIQ(8925,TIUDOCS(TIUDOCS),.06)'="" K TIUDOCS(TIUDOCS)
"RTN","TIUADCL",189,0)
 I $D(TIUDOCS)'>1 S VALMBCK="R" Q
"RTN","TIUADCL",190,0)
 D @ACTION
"RTN","TIUADCL",191,0)
 Q
"RTN","TIUPRPN1")
0^2^B56280511^B54770889
"RTN","TIUPRPN1",1,0)
TIUPRPN1 ;SLC/JER - Print SF 509-Progress Notes ;11/23/07
"RTN","TIUPRPN1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**45,52,87,100,162,182,211,222,234,233**;Jun 20, 1997;Build 3
"RTN","TIUPRPN1",3,0)
 ;
"RTN","TIUPRPN1",4,0)
 ; EXTERNAL REFERENCE - DBIA 10040  ^SC(D0,0)
"RTN","TIUPRPN1",5,0)
 ; 
"RTN","TIUPRPN1",6,0)
PRINT(TIUFLAG,TIUSPG) ; Print Document
"RTN","TIUPRPN1",7,0)
 ; ^TMP("TIUPR",$J) is array of records to be printed
"RTN","TIUPRPN1",8,0)
 ; TIUFLAG=1 --> Chart Copy     TIUSPG=1 --> Contiguous
"RTN","TIUPRPN1",9,0)
 ; TIUFLAG=0 --> Work Copy      TIUSPG=0 --> Fresh Page- each note
"RTN","TIUPRPN1",10,0)
 ; TIUCONT=1 --> Continue printing
"RTN","TIUPRPN1",11,0)
 ; TIUCONT1=1 --> Write "Continue to next/from previous-page" msgs
"RTN","TIUPRPN1",12,0)
 ; TIUPFNBR ---> Print Form # like vice 509
"RTN","TIUPRPN1",13,0)
 ; TIUMISC=TIUFLAG_U_TIUPFNBR_U_TIUDA
"RTN","TIUPRPN1",14,0)
 N CONT,TIUASK,TIUI,TIUJ,TIUKID,TIUPAGE,TIUFOOT,TIUK,TIUDA,TIUCONT,TIUPGRP,TIUTYP
"RTN","TIUPRPN1",15,0)
 N TIUPFHDR,TIUPFNBR,TIUMISC,TIUCONT1,TIUIDONE,TMP
"RTN","TIUPRPN1",16,0)
 S TIUFLAG=+$G(TIUFLAG),TIUSPG=+$G(TIUSPG)
"RTN","TIUPRPN1",17,0)
 S (CONT,TIUCONT)=1,(TIUASK,TIUCONT1)=0
"RTN","TIUPRPN1",18,0)
 S TIUI=0 F  S TIUI=$O(^TMP("TIUPR",$J,TIUI)) Q:TIUI=""  D  Q:'TIUCONT
"RTN","TIUPRPN1",19,0)
 . N DFN,TIU
"RTN","TIUPRPN1",20,0)
 . ; -- P182 TIUI has form PGRP$PFHDR;DFN with PGRP possibly 0, and
"RTN","TIUPRPN1",21,0)
 . ;    PFHDR possibly null (see TIURA):
"RTN","TIUPRPN1",22,0)
 . S TIUPGRP=+$P(TIUI,"$"),TIUPFHDR=$P($P(TIUI,";"),"$",2)
"RTN","TIUPRPN1",23,0)
 . I TIUPFHDR']"" S TIUPFHDR="Progress Notes"
"RTN","TIUPRPN1",24,0)
 . S DFN=$P(TIUI,";",2)
"RTN","TIUPRPN1",25,0)
 . I $G(TIUPGRP)>2 S TIUSPG=0
"RTN","TIUPRPN1",26,0)
 . D PATPN^TIULV(.TIUFOOT,DFN)
"RTN","TIUPRPN1",27,0)
 . I +$G(TIUSPG) D HEADER^TIUPRPN2(.TIUFOOT,TIUFLAG,.TIUPFHDR,TIUCONT1)
"RTN","TIUPRPN1",28,0)
 . ; Use TIUJ="" (not TIUJ=0), to print "complete" notes w/o sigdt:
"RTN","TIUPRPN1",29,0)
 . S TIUJ="" F  S TIUJ=$O(^TMP("TIUPR",$J,TIUI,TIUJ)) Q:TIUJ=""  D  Q:'TIUCONT
"RTN","TIUPRPN1",30,0)
 . . S TIUK=0 F  S TIUK=$O(^TMP("TIUPR",$J,TIUI,TIUJ,TIUK)) Q:'TIUK  D  Q:'TIUCONT
"RTN","TIUPRPN1",31,0)
 . . . S TIUCONT1=0 S TIUPFNBR=^TMP("TIUPR",$J,TIUI,TIUJ,TIUK)
"RTN","TIUPRPN1",32,0)
 . . . ; Note: TIUPFNBR may be null
"RTN","TIUPRPN1",33,0)
 . . . ;P182 Set TIUMISC BEFORE quitting if deleted
"RTN","TIUPRPN1",34,0)
 . . . S TIUDA=TIUK,TIUMISC=TIUFLAG_U_TIUPFNBR_U_TIUDA
"RTN","TIUPRPN1",35,0)
 . . . ; Quit docmt if deleted:
"RTN","TIUPRPN1",36,0)
 . . . I '$D(^TIU(8925,+TIUDA,0)) D  Q
"RTN","TIUPRPN1",37,0)
 . . . . S TIUCONT=$$SETCONT(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN1",38,0)
 . . . . W !!,"NOTE DATED:",!,"Document #",TIUDA," for ",$G(TIUFOOT("PNMP")),!,"no longer exists in the TIU DOCUMENT file.",!!!
"RTN","TIUPRPN1",39,0)
 . . . . S TIUCONT=$$SETCONT(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT))
"RTN","TIUPRPN1",40,0)
 . . . N TIUROOT
"RTN","TIUPRPN1",41,0)
 . . . I '+$G(TIUSPG) D HEADER^TIUPRPN2(.TIUFOOT,TIUFLAG,.TIUPFHDR,TIUCONT1)
"RTN","TIUPRPN1",42,0)
 . . . K ^TMP("TIULQ",$J)
"RTN","TIUPRPN1",43,0)
 . . . D EXTRACT^TIULQ(+TIUDA,"^TMP(""TIULQ"",$J)",.TIUERR,"","",1)
"RTN","TIUPRPN1",44,0)
 . . . I +$G(TIUERR) W !,$P(TIUERR,U,2) Q
"RTN","TIUPRPN1",45,0)
 . . . Q:'$D(^TMP("TIULQ",$J))
"RTN","TIUPRPN1",46,0)
 . . . S TIUROOT="^TMP(""TIULQ"",$J,"_TIUDA_")"
"RTN","TIUPRPN1",47,0)
 . . . D REPORT(TIUROOT,.TIUFOOT,TIUMISC,.TIUCONT) Q:'TIUCONT
"RTN","TIUPRPN1",48,0)
 . . . D IDKIDS(TIUROOT,.TIUFOOT,TIUMISC,TIUCONT1,.TIUCONT) Q:'TIUCONT
"RTN","TIUPRPN1",49,0)
 . . . I '+$G(TIUKID),'+$G(TIUSPG) S TIUCONT1=0 S TIUCONT=$$SETCONT(.TIUFOOT,TIUMISC,TIUCONT1,1,$G(TIUROOT))
"RTN","TIUPRPN1",50,0)
 . Q:'TIUCONT
"RTN","TIUPRPN1",51,0)
 . I $E(IOST,1,2)="C-" S TIUCONT=$$STOP^TIUPRPN2() Q:'TIUCONT
"RTN","TIUPRPN1",52,0)
 . I '+$G(TIUKID),+$G(TIUSPG),$E(IOST,1,2)'="C-" S TIUCONT1=0 S TIUCONT=$$SETCONT(.TIUFOOT,TIUMISC,TIUCONT1,1,$G(TIUROOT))
"RTN","TIUPRPN1",53,0)
 Q
"RTN","TIUPRPN1",54,0)
 ;
"RTN","TIUPRPN1",55,0)
REPORT(TIUROOT,TIUFOOT,TIUMISC,TIUCONT,TIUIDEND) ; Report Text
"RTN","TIUPRPN1",56,0)
 ; Requires array TIUFOOT, vars TIUMISC, TIUCONT
"RTN","TIUPRPN1",57,0)
 ; Requires TIUROOT =
"RTN","TIUPRPN1",58,0)
 ; ^TMP("TIULQ",$J,NOTEIFN) for parent/stand-alone note, or
"RTN","TIUPRPN1",59,0)
 ; ^TMP("TIULQ",$J,NOTEIFN,"ZADD",ADDMIFN) for addendum, or
"RTN","TIUPRPN1",60,0)
 ; ^TMP("TIULQ",$J,NOTEIFN,"ZZID",KIDSEQ#,IDKIDIFN) for ID kid, or
"RTN","TIUPRPN1",61,0)
 ; ^TMP("TIULQ",$J,NOTEIFN,"ZZID",KIDSEQ#,IDKIDIFN,"ZADD",KIDADDMIFN)
"RTN","TIUPRPN1",62,0)
 ;       for ID kid addm.
"RTN","TIUPRPN1",63,0)
 N DIW,DIWF,DIWL,DIWR,DIWT,TIUERR,TIU,TIUI,X,Z,LOC
"RTN","TIUPRPN1",64,0)
 N REFDT,TITLE,LOINCNM,ADT,HLOC,SUBJ
"RTN","TIUPRPN1",65,0)
 N TIUDA,TIUCONT1,HASIDKID,HASIDDAD
"RTN","TIUPRPN1",66,0)
 S TIUDA=$P(TIUMISC,U,3),TIUCONT1=0
"RTN","TIUPRPN1",67,0)
 S TIUCONT=$$SETCONT(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN1",68,0)
 S HASIDKID=$G(^TMP("TIULQ",$J,TIUDA,"ZZID",0)) ;how many ID kids
"RTN","TIUPRPN1",69,0)
 S HASIDDAD=$S(TIUROOT["ZZID":1,1:0)
"RTN","TIUPRPN1",70,0)
 I HASIDKID W "<< Interdisciplinary Note - Begin >>",!
"RTN","TIUPRPN1",71,0)
 I HASIDDAD W "<< Interdisciplinary Note - Cont. >>",!
"RTN","TIUPRPN1",72,0)
 W $S('HASIDKID&'HASIDDAD:"NOTE DATED: ",1:"ENTRY DATED: ")
"RTN","TIUPRPN1",73,0)
 S REFDT=@TIUROOT@(1301,"I")
"RTN","TIUPRPN1",74,0)
 W $$DATE^TIULS(REFDT,"MM/DD/CCYY HR:MIN")
"RTN","TIUPRPN1",75,0)
 S TITLE=@TIUROOT@(.01,"E"),LOINCNM=@TIUROOT@(89261,"E")
"RTN","TIUPRPN1",76,0)
 W !,"LOCAL TITLE: ",$$UP^XLFSTR(TITLE),!
"RTN","TIUPRPN1",77,0)
 I $L(LOINCNM)>1 W "STANDARD TITLE: ",$$UP^XLFSTR(LOINCNM),!
"RTN","TIUPRPN1",78,0)
 S LOC=$G(@TIUROOT@(1205,"I"))
"RTN","TIUPRPN1",79,0)
 I +LOC D
"RTN","TIUPRPN1",80,0)
 . W $S($P(^SC(LOC,0),U,3)="W":"ADMITTED: ",1:"VISIT: ")
"RTN","TIUPRPN1",81,0)
 . S ADT=$G(@TIUROOT@(.07,"I"))
"RTN","TIUPRPN1",82,0)
 . W $$DATE^TIULS(ADT,"MM/DD/CCYY HR:MIN")
"RTN","TIUPRPN1",83,0)
 . S HLOC=$G(@TIUROOT@(1205,"E"))
"RTN","TIUPRPN1",84,0)
 . W " ",HLOC
"RTN","TIUPRPN1",85,0)
 S SUBJ=$G(@TIUROOT@(1701,"E"))
"RTN","TIUPRPN1",86,0)
 I SUBJ]"" W !,"SUBJECT: ",^("E"),! ; @TIUROOT@(1701,"E")
"RTN","TIUPRPN1",87,0)
 S TIUCONT1=1
"RTN","TIUPRPN1",88,0)
 I $D(@TIUROOT@("PROBLEM")) D  Q:'TIUCONT
"RTN","TIUPRPN1",89,0)
 . S TIUCONT=$$SETCONT(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN1",90,0)
 . W !,"ASSOCIATED PROBLEMS:"
"RTN","TIUPRPN1",91,0)
 . N TIUI S TIUI=0
"RTN","TIUPRPN1",92,0)
 . F  S TIUI=$O(@TIUROOT@("PROBLEM",TIUI)) Q:'TIUI  D  Q:'TIUCONT
"RTN","TIUPRPN1",93,0)
 ..W !,^(TIUI,0) ; @TIUROOT@("PROBLEM",TIUI,0) 
"RTN","TIUPRPN1",94,0)
 ..S TIUCONT=$$SETCONT(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN1",95,0)
 W !
"RTN","TIUPRPN1",96,0)
 S TIUI=0,DIWF="WN",DIWL=1,DIWR=79 K ^UTILITY($J,"W")
"RTN","TIUPRPN1",97,0)
 F  S TIUI=$O(@TIUROOT@("TEXT",TIUI)) Q:TIUI'>0  D  Q:'TIUCONT  ; D ^DIWW
"RTN","TIUPRPN1",98,0)
 . S TIUCONT=$$SETCONT(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN1",99,0)
 . S X=@TIUROOT@("TEXT",TIUI,0) S:X="" X=" " D ^DIWP
"RTN","TIUPRPN1",100,0)
 D ^DIWW K ^UTILITY($J,"W")
"RTN","TIUPRPN1",101,0)
 Q:'TIUCONT
"RTN","TIUPRPN1",102,0)
 D GETSIG(TIUROOT,.TIUSIG)
"RTN","TIUPRPN1",103,0)
 S TIUCONT=$$SETCONT(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN1",104,0)
 W !
"RTN","TIUPRPN1",105,0)
 D SIGBLK^TIUPRPN8(.TIUFOOT,TIUMISC,TIUCONT1,.TIUCONT,.TIUSIG,TIUROOT)
"RTN","TIUPRPN1",106,0)
 Q:'TIUCONT
"RTN","TIUPRPN1",107,0)
ADDENDA ; Fall through and do Addenda of docmt TIUDA
"RTN","TIUPRPN1",108,0)
 N DIW,DIWF,DIWL,DIWR,DIWT,X,Z,TIUI,TIUADD,ADDMRDT
"RTN","TIUPRPN1",109,0)
 S TIUADD=0,DIWF="WN",DIWL=1,DIWR=79 K ^UTILITY($J,"W")
"RTN","TIUPRPN1",110,0)
 ; VM/RJT - *233 - quit if addendum status is unreleased (=3)
"RTN","TIUPRPN1",111,0)
 F  S TIUADD=$O(@TIUROOT@("ZADD",TIUADD)) Q:TIUADD'>0  Q:$P($G(^TIU(8925,TIUADD,0)),U,5)=3  D  Q:'TIUCONT
"RTN","TIUPRPN1",112,0)
 . S TIUCONT=$$SETCONT(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN1",113,0)
 . S ADDMRDT=@TIUROOT@("ZADD",TIUADD,1301,"I")
"RTN","TIUPRPN1",114,0)
 . W !!,$$DATE^TIULS(ADDMRDT,"MM/DD/CCYY HR:MIN"),?21,"ADDENDUM"
"RTN","TIUPRPN1",115,0)
 . W ?39,"STATUS: ",@TIUROOT@("ZADD",TIUADD,.05,"E") ;P162
"RTN","TIUPRPN1",116,0)
 . S TIUI=0
"RTN","TIUPRPN1",117,0)
 . F  S TIUI=$O(@TIUROOT@("ZADD",TIUADD,"TEXT",TIUI)) Q:TIUI'>0  D  Q:'TIUCONT
"RTN","TIUPRPN1",118,0)
 . . S TIUCONT=$$SETCONT(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN1",119,0)
 . . S X=@TIUROOT@("ZADD",TIUADD,"TEXT",TIUI,0) S:X="" X=" " D ^DIWP
"RTN","TIUPRPN1",120,0)
 . D ^DIWW
"RTN","TIUPRPN1",121,0)
 . Q:'TIUCONT
"RTN","TIUPRPN1",122,0)
 . N TIUADRT
"RTN","TIUPRPN1",123,0)
 . S TIUADRT=$P(TIUROOT,")")_",""ZADD"","_TIUADD_")"
"RTN","TIUPRPN1",124,0)
 . D GETSIG(TIUADRT,.TIUSIG)
"RTN","TIUPRPN1",125,0)
 . D SIGBLK^TIUPRPN8(.TIUFOOT,TIUMISC,TIUCONT1,.TIUCONT,.TIUSIG,TIUADRT)
"RTN","TIUPRPN1",126,0)
 ; Need ! in front for amended notes:
"RTN","TIUPRPN1",127,0)
 I $G(TIUIDEND) W !,"<< Interdisciplinary Note - End >>",!
"RTN","TIUPRPN1",128,0)
 K ^UTILITY($J,"W")
"RTN","TIUPRPN1",129,0)
 ; Write 2 linefeeds between records
"RTN","TIUPRPN1",130,0)
 S:$E(IOST,1,2)="C-" TIUCONT=$$STOP^TIUFLP1,TIUASK=1
"RTN","TIUPRPN1",131,0)
 W:TIUCONT !!
"RTN","TIUPRPN1",132,0)
 Q
"RTN","TIUPRPN1",133,0)
 ;
"RTN","TIUPRPN1",134,0)
IDKIDS(TIUROOT,TIUFOOT,TIUMISC,TIUCONT1,TIUCONT) ; Print ID kids
"RTN","TIUPRPN1",135,0)
 ;of docmt TIUDA (each kid does its own addenda)
"RTN","TIUPRPN1",136,0)
 N TIUL,KIDDA,TIUDA,TIUSORT,TIUIDRT,TIUIDEND
"RTN","TIUPRPN1",137,0)
 S TIUDA=$P(TIUMISC,U,3),TIUIDEND=0
"RTN","TIUPRPN1",138,0)
 S TIUL=0
"RTN","TIUPRPN1",139,0)
 F  S TIUL=$O(^TMP("TIULQ",$J,TIUDA,"ZZID",TIUL)) Q:'TIUL  D  Q:'TIUCONT
"RTN","TIUPRPN1",140,0)
 . S KIDDA=$O(^TMP("TIULQ",$J,TIUDA,"ZZID",TIUL,0))
"RTN","TIUPRPN1",141,0)
 . I +$$MEMBEROF^TIUPR222(+$G(^TIU(8925,+KIDDA,0)),"FORM LETTERS") D  Q  ; hand off to TIUFLP1 (Form Letter Print)
"RTN","TIUPRPN1",142,0)
 . . I '+$G(TIUKID),'+$G(TIUSPG) S TIUCONT1=0 S TIUCONT=$$SETCONT(.TIUFOOT,TIUMISC,TIUCONT1,1,$G(TIUROOT))
"RTN","TIUPRPN1",143,0)
 . . I 'TIUCONT!'CONT Q
"RTN","TIUPRPN1",144,0)
 . . I $E(IOST,1,2)="C-",'+TIUASK S CONT=$$STOP^TIUFLP1,TIUCONT=CONT Q:'+CONT
"RTN","TIUPRPN1",145,0)
 . . S TIUASK=0,TIUKID=1 D IDKID^TIUFLP1(TIUDA,KIDDA)
"RTN","TIUPRPN1",146,0)
 . S TIUMISC=TIUFLAG_U_TIUPFNBR_U_KIDDA
"RTN","TIUPRPN1",147,0)
 . S TIUIDRT="^TMP(""TIULQ"",$J,"_TIUDA_",""ZZID"","_TIUL_","_KIDDA_")"
"RTN","TIUPRPN1",148,0)
 . I '$O(^TMP("TIULQ",$J,TIUDA,"ZZID",TIUL)) S TIUIDEND=1
"RTN","TIUPRPN1",149,0)
 . D REPORT(TIUIDRT,.TIUFOOT,TIUMISC,.TIUCONT,TIUIDEND)
"RTN","TIUPRPN1",150,0)
 Q
"RTN","TIUPRPN1",151,0)
 ;
"RTN","TIUPRPN1",152,0)
GETSIG(TIUROOT,TIUSIG) ; Get signature info from TIULQ global;
"RTN","TIUPRPN1",153,0)
 ; Set info into TIUSIG array **100**
"RTN","TIUPRPN1",154,0)
 ; Requires array name TIUROOT; passes back array TIUSIG
"RTN","TIUPRPN1",155,0)
 ; TIUROOT = ^TMP("TIULQ",$J,NOTEIFN) for parent note, or
"RTN","TIUPRPN1",156,0)
 ;           ^TMP("TIULQ",$J,NOTEIFN,"ZADD",ADDMIFN) for addendum, or
"RTN","TIUPRPN1",157,0)
 ;           ^TMP("TIULQ",$J,NOTEIFN,"ZZID",IDKIDIFN) for ID kid.
"RTN","TIUPRPN1",158,0)
 ; Signature should be on bottom of form, Addenda on Subsequent pages
"RTN","TIUPRPN1",159,0)
 N TIULINE S $P(TIULINE,"-",81)=""
"RTN","TIUPRPN1",160,0)
 S TIUSIG("AUTHOR")=$G(@TIUROOT@(1202,"I"))_";"_$G(^("E"))
"RTN","TIUPRPN1",161,0)
 S TIUSIG("EXPSIGNR")=$G(@TIUROOT@(1204,"I"))_";"_$G(^("E"))
"RTN","TIUPRPN1",162,0)
 S TIUSIG("EXPCOSNR")=$G(@TIUROOT@(1208,"I"))_";"_$G(^("E"))
"RTN","TIUPRPN1",163,0)
 S TIUSIG("SIGNDATE")=$G(@TIUROOT@(1501,"I"))
"RTN","TIUPRPN1",164,0)
 S TIUSIG("SIGNEDBY")=$G(@TIUROOT@(1502,"I"))_";"_$G(^("E"))
"RTN","TIUPRPN1",165,0)
 S TIUSIG("SIGNNAME")=$G(@TIUROOT@(1503,"E"))
"RTN","TIUPRPN1",166,0)
 S TIUSIG("SIGTITL")=$G(@TIUROOT@(1504,"E"))
"RTN","TIUPRPN1",167,0)
 S TIUSIG("SIGNMODE")=$G(@TIUROOT@(1505,"I"))_";"_$G(^("E"))
"RTN","TIUPRPN1",168,0)
 S TIUSIG("COSGDATE")=$G(@TIUROOT@(1507,"I"))
"RTN","TIUPRPN1",169,0)
 S TIUSIG("COSGEDBY")=$G(@TIUROOT@(1508,"I"))_";"_$G(^("E"))
"RTN","TIUPRPN1",170,0)
 S TIUSIG("COSGNAME")=$G(@TIUROOT@(1509,"E"))
"RTN","TIUPRPN1",171,0)
 S TIUSIG("COSGTITL")=$G(@TIUROOT@(1510,"E"))
"RTN","TIUPRPN1",172,0)
 S TIUSIG("COSGMODE")=$G(@TIUROOT@(1511,"I"))_";"_$G(^("E"))
"RTN","TIUPRPN1",173,0)
 S TIUSIG("SIGCHRT")=$G(@TIUROOT@(1512,"I"))_";"_$G(^("E"))
"RTN","TIUPRPN1",174,0)
 S TIUSIG("COSCHRT")=$G(@TIUROOT@(1513,"I"))_";"_$G(^("E"))
"RTN","TIUPRPN1",175,0)
 ; -- P182 Set Admin Clos Date:
"RTN","TIUPRPN1",176,0)
 S TIUSIG("ADMINCDT")=$G(@TIUROOT@(1606,"I"))_";"_$G(^("E"))
"RTN","TIUPRPN1",177,0)
 Q
"RTN","TIUPRPN1",178,0)
 ;
"RTN","TIUPRPN1",179,0)
SETCONT(TIUFOOT,TIUMISC,TIUCONT1,TIUHEAD,TIUROOT) ;Does footer
"RTN","TIUPRPN1",180,0)
 ;and returns TIUCONT
"RTN","TIUPRPN1",181,0)
 ; Requires array TIUFOOT, vars TIUMISC,TIUCONT1; optional TIUHEAD
"RTN","TIUPRPN1",182,0)
 ; Optional TIUROOT
"RTN","TIUPRPN1",183,0)
 Q $$FOOTER^TIUPRPN2(.TIUFOOT,TIUMISC,TIUCONT1,TIUHEAD,$G(TIUROOT))
"RTN","TIURD")
0^3^B47466045^B45915368
"RTN","TIURD",1,0)
TIURD ; SLC/JER - Reassign actions ;4/25/05
"RTN","TIURD",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**4,58,61,100,109,173,184,233**;Jun 20, 1997;Build 3
"RTN","TIURD",3,0)
 ;
"RTN","TIURD",4,0)
 ; Call to $$TIUREAS^MDAPI covered by IA# 3378
"RTN","TIURD",5,0)
 ; $$TIUREAS^MDAPI went out with MD 1.0, which was not mandated, so
"RTN","TIURD",6,0)
 ;checks are made for its existence before it is called.
"RTN","TIURD",7,0)
REASSIGN ; Reassign selected Documents
"RTN","TIURD",8,0)
 N TIUCHNG,TIULST,TIUI,RSTRCTD,TIUDAARY
"RTN","TIURD",9,0)
 I '$D(VALMY) D EN^VALM2(XQORNOD(0))
"RTN","TIURD",10,0)
 S TIUI=0
"RTN","TIURD",11,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D  Q:$D(DIROUT)
"RTN","TIURD",12,0)
 . N TIUDA,DFN,TIU,TIUDATA,TIUVIEW
"RTN","TIURD",13,0)
 . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI))
"RTN","TIURD",14,0)
 . S TIUDA=+$P(TIUDATA,U,2) S RSTRCTD=$$DOCRES^TIULRR(TIUDA)
"RTN","TIURD",15,0)
 . W !!,"Processing Item #",TIUI,"..."
"RTN","TIURD",16,0)
 . I $$CANTSURG(TIUDA) H 1 Q  ;not permitted for surgery reports
"RTN","TIURD",17,0)
 . I RSTRCTD D  Q
"RTN","TIURD",18,0)
 . . W !!,$C(7),"Ok, no harm done...",! ; Echo denial message
"RTN","TIURD",19,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURD",20,0)
 . I +$$HASIMG^TIURB2(TIUDA) D IMGNOTE^TIURB2 Q
"RTN","TIURD",21,0)
 . S TIUVIEW=$$CANDO^TIULP(TIUDA,"VIEW")
"RTN","TIURD",22,0)
 . I '+TIUVIEW D  Q
"RTN","TIURD",23,0)
 . . W !!,$C(7),$C(7),$C(7),$P(TIUVIEW,U,2),!
"RTN","TIURD",24,0)
 . . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIURD",25,0)
 . S TIUDAARY(TIUI)=TIUDA
"RTN","TIURD",26,0)
 . S TIUCHNG=0
"RTN","TIURD",27,0)
 . D EN^VALM("TIU REASSIGN")
"RTN","TIURD",28,0)
 . I +$G(TIUCHNG) D
"RTN","TIURD",29,0)
 . . S TIULST=$G(TIULST)_$S($G(TIULST)]"":",",1:"")_TIUI
"RTN","TIURD",30,0)
 ; -- Rebuild list: --
"RTN","TIURD",31,0)
 S TIUCHNG("RBLD")=1
"RTN","TIURD",32,0)
 D UPRBLD^TIURL(.TIUCHNG) K VALMY
"RTN","TIURD",33,0)
 S VALMBCK="R"
"RTN","TIURD",34,0)
 D VMSG^TIURS1($G(TIULST),.TIUDAARY,"reassigned")
"RTN","TIURD",35,0)
 Q
"RTN","TIURD",36,0)
 ;
"RTN","TIURD",37,0)
REASSIG1 ; Single record reassign
"RTN","TIURD",38,0)
 N TIUAUTH,TIURSSG,TIUNAME,DA,DR,DIE,TIUTYPE,TIUEDIT,TIUADD,TIUPROMO,TIUY
"RTN","TIURD",39,0)
 N TIUD0,TIUD12,TIUD13,TIUD14,TIUODA,TIUOUT K ^TMP("TIURTRCT",$J)
"RTN","TIURD",40,0)
 D FULL^VALM1
"RTN","TIURD",41,0)
 I $$CANTSURG(TIUDA) H 3 Q  ;not permitted for surgery reports
"RTN","TIURD",42,0)
 L +^TIU(8925,+TIUDA):1
"RTN","TIURD",43,0)
 E  W !?5,$C(7),$C(7),$C(7),"Another user is editing this entry." S TIUY=$$READ^TIUU("EA","Press RETURN to continue...") Q
"RTN","TIURD",44,0)
 ; Authorized? NO: echo why not & quit
"RTN","TIURD",45,0)
 I +$$HASIMG^TIURB2(TIUDA) D IMGNOTE^TIURB2 Q
"RTN","TIURD",46,0)
 I +$$ISADDNDM^TIULC1(TIUDA) D  I 1
"RTN","TIURD",47,0)
 . N TIUDAD
"RTN","TIURD",48,0)
 . S TIUDAD=+$P(^TIU(8925,TIUDA,0),U,6)
"RTN","TIURD",49,0)
 . I +$$DADORKID^TIUGBR(TIUDAD) D
"RTN","TIURD",50,0)
 . . S TIURSSG="0^You must first detach the ORIGINAL interdisciplinary entry."
"RTN","TIURD",51,0)
 E  I $$DADORKID^TIUGBR(TIUDA) D  I 1
"RTN","TIURD",52,0)
 . S TIURSSG="0^You must first detach interdisciplinary entries."
"RTN","TIURD",53,0)
 I '$D(TIURSSG) S TIURSSG=$$CANDO^TIULP(+TIUDA,"REASSIGN")
"RTN","TIURD",54,0)
 I +$G(TIURSSG)'>0 D  G REASS1X
"RTN","TIURD",55,0)
 . W !!,$C(7),$C(7),$C(7),$P(TIURSSG,U,2),!
"RTN","TIURD",56,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIURD",57,0)
 S TIUD0(0)=$G(^TIU(8925,+TIUDA,0)),TIUD12(0)=$G(^(12))
"RTN","TIURD",58,0)
 S TIUD13(0)=$G(^TIU(8925,+TIUDA,13)),TIUD14(0)=$G(^(14))
"RTN","TIURD",59,0)
 S TIUTYPE=$P(TIUD0(0),U)
"RTN","TIURD",60,0)
 S TIUNAME=$$PNAME^TIULC1(+TIUTYPE)
"RTN","TIURD",61,0)
 S TIUAUTH=$P(TIUD12(0),U,2)
"RTN","TIURD",62,0)
 W !,$C(7)
"RTN","TIURD",63,0)
 S TIUY=$$READ^TIUU("YO","Are you sure you want to REASSIGN this "_TIUNAME,"NO","^D REAS1^TIUDIRH")
"RTN","TIURD",64,0)
 I +TIUY'>0 S TIUOUT=1 G REASS1X
"RTN","TIURD",65,0)
 I +$P(TIUD0(0),U,5)>5 D  G:+$G(TIUOUT) REASS1X
"RTN","TIURD",66,0)
 . W !!,$C(7),$C(7),"The status of this document is: ",$$UP^XLFSTR($$STATUS^TIULC(TIUDA))
"RTN","TIURD",67,0)
 . I +$$GETSIG^TIURD2'>0 S TIUOUT=1
"RTN","TIURD",68,0)
 . W !
"RTN","TIURD",69,0)
 ; Addendum? YES: Ask intended action is move, swap with original, or
"RTN","TIURD",70,0)
 ; replace original
"RTN","TIURD",71,0)
 S TIUADD=$$ISADDNDM^TIULC1(+TIUDA)
"RTN","TIURD",72,0)
 I +TIUADD D  G REASS1X
"RTN","TIURD",73,0)
 . D REASSIGA
"RTN","TIURD",74,0)
 D REASSIGO^TIURD3
"RTN","TIURD",75,0)
REASS1X L -^TIU(8925,+TIUDA):1
"RTN","TIURD",76,0)
 I +$G(TIUOUT),+$G(TIUODA),+$G(TIUDA),$D(TIUD0(0)) D RECOVER^TIURD4(TIUODA,TIUDA,.TIUD0) S TIUDA=TIUODA
"RTN","TIURD",77,0)
 ; Remove additional signers who haven't signed from retracted original
"RTN","TIURD",78,0)
 I '+$G(TIUOUT),+$G(TIUODA) D
"RTN","TIURD",79,0)
 . I +$O(^TIU(8925.7,"B",+$G(TIUODA),0)) D DELSGNRS^TIURD4(TIUODA,1)
"RTN","TIURD",80,0)
 . D ALERTDEL^TIUALRT(TIUODA)
"RTN","TIURD",81,0)
 I '+$G(TIUOUT),+$G(TIUODA),+$$ISA^TIULX(+$G(TIUD0(0)),+$$CLASS^TIUCP) D
"RTN","TIURD",82,0)
 . N TIUCPY,TIUNVSTR
"RTN","TIURD",83,0)
 . Q:'$L($T(TIUREAS^MDAPI))
"RTN","TIURD",84,0)
 . S TIUNVSTR=$P(TIUD12(1),U,11)_";"_$P(TIUD0(1),U,7)
"RTN","TIURD",85,0)
 . S TIUNVSTR=TIUNVSTR_";"_$P(TIUD0(1),U,13)
"RTN","TIURD",86,0)
 . S TIUCPY=$$TIUREAS^MDAPI(+$P(TIUD0(0),U,2),+$P(TIUD14(0),U,5),+TIUODA,+$P(TIUD0(1),U,2),+$P($G(^TIU(8925,TIUDA,14)),U,5),TIUNVSTR,TIUDA)
"RTN","TIURD",87,0)
 D SEND^TIUALRT(TIUDA)
"RTN","TIURD",88,0)
 S VALMBCK=$S(+$G(TIUCHNG):"Q",1:"R") K ^TMP("TIURTRCT",$J)
"RTN","TIURD",89,0)
 Q
"RTN","TIURD",90,0)
 ;
"RTN","TIURD",91,0)
REASSIGO ; Reassign an original Document
"RTN","TIURD",92,0)
 G REASSIGO^TIURD3
"RTN","TIURD",93,0)
 ;
"RTN","TIURD",94,0)
REASSIGA ;Reassign an Addendum to an original DS
"RTN","TIURD",95,0)
 N TIUACT,TIUSET S TIUCHNG=0
"RTN","TIURD",96,0)
 W !,"Please choose the appropriate action for this Addendum:"
"RTN","TIURD",97,0)
 S TIUSET="M:move addendum to a different document"
"RTN","TIURD",98,0)
 S TIUSET=TIUSET_";P:promote addendum as document for another visit"
"RTN","TIURD",99,0)
 S TIUSET=TIUSET_";R:replace parent document with this addendum"
"RTN","TIURD",100,0)
 S TIUSET=TIUSET_";S:swap this addendum with its parent document"
"RTN","TIURD",101,0)
 S TIUACT=$$READ^TIUU("S^"_TIUSET,"Select Reassign Action","move")
"RTN","TIURD",102,0)
 I $P(TIUACT,U)="M" D MOVEADD^TIURD1(TIUDA) Q
"RTN","TIURD",103,0)
 I $P(TIUACT,U)="P" D PROMOTE^TIURD1(TIUDA) Q
"RTN","TIURD",104,0)
 I $P(TIUACT,U)="R" D REPLACE^TIURD1(TIUDA) Q
"RTN","TIURD",105,0)
 I $P(TIUACT,U)="S" D SWAPADD^TIURD1(TIUDA)
"RTN","TIURD",106,0)
 Q
"RTN","TIURD",107,0)
 ;
"RTN","TIURD",108,0)
CLAPPLNK ; Re-link selected Documents to different Client Records
"RTN","TIURD",109,0)
 N TIUCHNG,TIULST,TIUDA,DFN,TIU,TIUDATA,TIUEDIT,TIUI,TIUY,Y,DIROUT,TIUPOP
"RTN","TIURD",110,0)
 N TIUDAARY
"RTN","TIURD",111,0)
 I '$D(VALMY) D EN^VALM2(XQORNOD(0))
"RTN","TIURD",112,0)
 S TIUI=0 D FULL^VALM1
"RTN","TIURD",113,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D  Q:$D(DIROUT)
"RTN","TIURD",114,0)
 . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI))
"RTN","TIURD",115,0)
 . S TIUDA=+$P(TIUDATA,U,2),TIUDAARY(TIUI)=TIUDA
"RTN","TIURD",116,0)
 . S TIUCHNG=0
"RTN","TIURD",117,0)
 . W !!,"Processing Item #",TIUI,"..."
"RTN","TIURD",118,0)
 . D CLAPPLN1(TIUDA)
"RTN","TIURD",119,0)
 . I +$G(TIUCHNG)=1 D
"RTN","TIURD",120,0)
 . . S TIULST=$G(TIULST)_$S($G(TIULST)]"":", ",1:"")_TIUI
"RTN","TIURD",121,0)
 S TIUCHNG("REFRESH")=1
"RTN","TIURD",122,0)
 D UPRBLD^TIURL(.TIUCHNG,.VALMY) K VALMY
"RTN","TIURD",123,0)
 S VALMBCK="R"
"RTN","TIURD",124,0)
 D VMSG^TIURS1($G(TIULST),.TIUDAARY,"re-linked")
"RTN","TIURD",125,0)
 Q
"RTN","TIURD",126,0)
 ;
"RTN","TIURD",127,0)
CLAPPLN1(TIUDA) ; Re-link a single record to the client application
"RTN","TIURD",128,0)
 N TIUREASX,CANLNK,ACTION,ISPRF,OLDLINK
"RTN","TIURD",129,0)
 I '$D(^TIU(8925,TIUDA,0)) D  Q
"RTN","TIURD",130,0)
 . W !!,$C(7),"Document no longer exists.",!
"RTN","TIURD",131,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIURD",132,0)
 I $$CANTSURG(TIUDA) H 3 Q  ;not permitted for surgery reports
"RTN","TIURD",133,0)
 S ISPRF=$$ISPRFDOC^TIUPRF(TIUDA) ;Patient Record Flag
"RTN","TIURD",134,0)
 I ISPRF S ACTION="LINK TO FLAG",OLDLINK=$$GETLINK^DGPFAPI1(TIUDA)
"RTN","TIURD",135,0)
 I 'ISPRF S ACTION="LINK WITH REQUEST",OLDLINK=$P($G(^TIU(8925,TIUDA,14)),U,5)
"RTN","TIURD",136,0)
 I +$$ISADDNDM^TIULC1(TIUDA) D  Q
"RTN","TIURD",137,0)
 . W !!,$C(7),"Links for ADDENDA can't be independently changed.",!
"RTN","TIURD",138,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIURD",139,0)
 S TIUREASX=$$REASSIGN^TIULC1(+$G(^TIU(8925,TIUDA,0)))
"RTN","TIURD",140,0)
 I TIUREASX']"" D  Q
"RTN","TIURD",141,0)
 . W !!,$C(7),"No PACKAGE REASSIGNMENT ACTION Defined.",!
"RTN","TIURD",142,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIURD",143,0)
 I $$DADORKID^TIUGBR(TIUDA) D  Q  ;**100**
"RTN","TIURD",144,0)
 . S CANLNK="0^You must first detach interdisciplinary entries"
"RTN","TIURD",145,0)
 . W !!,$C(7),$C(7),"You must first detach interdisciplinary entries",!
"RTN","TIURD",146,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIURD",147,0)
 S CANLNK=$$CANDO^TIULP(+TIUDA,ACTION)
"RTN","TIURD",148,0)
 I +CANLNK'>0 D  Q
"RTN","TIURD",149,0)
 . W !!,$C(7),$C(7),$P(CANLNK,U,2),!
"RTN","TIURD",150,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIURD",151,0)
 X TIUREASX
"RTN","TIURD",152,0)
 I ISPRF,OLDLINK'=$$GETLINK^DGPFAPI1(TIUDA) S TIUCHNG=1
"RTN","TIURD",153,0)
 I 'ISPRF,$P($G(^TIU(8925,TIUDA,14)),U,5)'=OLDLINK S TIUCHNG=1
"RTN","TIURD",154,0)
 Q
"RTN","TIURD",155,0)
 ;
"RTN","TIURD",156,0)
CANTSURG(TIUDA) ; If TIUDA is surg docmt, write can't do this action and
"RTN","TIURD",157,0)
 ;return 1 for can't do it P184
"RTN","TIURD",158,0)
 N TIUY,CANT,TIUPDA,TIUDA2 S CANT=0,TIUPDA=0,TIUDA2=0
"RTN","TIURD",159,0)
 ; VMP/RJT - *233 - Do not allow action on addenda of Surgical documents 
"RTN","TIURD",160,0)
 D
"RTN","TIURD",161,0)
 . I +$$ISADDNDM^TIULC1(TIUDA) S TIUDA2=+$P($G(^TIU(8925,TIUDA,0)),U,6) Q
"RTN","TIURD",162,0)
 . S TIUDA2=TIUDA
"RTN","TIURD",163,0)
 D ISSURG^TIUSROI(.TIUY,+$G(^TIU(8925,TIUDA2,0)))
"RTN","TIURD",164,0)
 I '+TIUY Q CANT
"RTN","TIURD",165,0)
 S CANT=1 W !,"This action is no longer permitted for SURGICAL REPORTS"
"RTN","TIURD",166,0)
 Q CANT
"RTN","TIURS1")
0^4^B73623745^B72987985
"RTN","TIURS1",1,0)
TIURS1 ; SLC/JER - Additional /es/ actions ;1/18/05
"RTN","TIURS1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**7,36,58,100,109,142,156,184,233**;Jun 20, 1997;Build 3
"RTN","TIURS1",3,0)
 ;12/11/00 Moved ELSIG,MULTIPRN,LIST here from TIURS
"RTN","TIURS1",4,0)
ELSIG ; Sign rec
"RTN","TIURS1",5,0)
 N TIULST,TIUSLST,TIURJCT,TIUES,TIUI,X,X1,Y,TIUDAARY,TIUCHNG
"RTN","TIURS1",6,0)
 I '$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIURS1",7,0)
 I $P(TIUPRM0,U,2)'>0 W !,"Electronic signature not yet enabled." H 3 G ELSIGX
"RTN","TIURS1",8,0)
 I '$D(VALMY) D EN^VALM2(XQORNOD(0))
"RTN","TIURS1",9,0)
 S TIUI=0 I $D(VALMY)>9 D CLEAR^VALM1
"RTN","TIURS1",10,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D
"RTN","TIURS1",11,0)
 . N TIU0,TIU12,TIUSTAT,TIUEVNT,TIUTYPE,TIUPOP,TIU15,TIUDPRM
"RTN","TIURS1",12,0)
 . N ASK,SIGNER,COSIGNER,XTRASGNR,TIUDATA,TIUDA,RSTRCTD
"RTN","TIURS1",13,0)
 . S (ASK,TIUPOP)=0
"RTN","TIURS1",14,0)
 . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI))
"RTN","TIURS1",15,0)
 . S TIUDA=$P(TIUDATA,U,2) S RSTRCTD=$$DOCRES^TIULRR(TIUDA)
"RTN","TIURS1",16,0)
 . I RSTRCTD D  Q
"RTN","TIURS1",17,0)
 . . W !!,$C(7),"Ok, no harm done...",! ; Echo denial message
"RTN","TIURS1",18,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURS1",19,0)
 . S TIU0=$G(^TIU(8925,+TIUDA,0)),TIU12=$G(^(12)),TIU15=$G(^(15))
"RTN","TIURS1",20,0)
 . S SIGNER=$S(+$P(TIU12,U,4):$P(TIU12,U,4),1:$P(TIU12,U,2))
"RTN","TIURS1",21,0)
 . S COSIGNER=$P(TIU12,U,8)
"RTN","TIURS1",22,0)
 . I (DUZ'=SIGNER),(DUZ'=COSIGNER) S XTRASGNR=+$O(^TIU(8925.7,"AE",+TIUDA,+DUZ,0))
"RTN","TIURS1",23,0)
 . S TIUSTAT=+$P(TIU0,U,5)
"RTN","TIURS1",24,0)
 . S TIUTYPE=$$PNAME^TIULC1(+TIU0)
"RTN","TIURS1",25,0)
 . S TIUEVNT=$S(TIUSTAT'>5:"SIGNATURE",+$G(XTRASGNR):"SIGNATURE",1:"COSIGNATURE")
"RTN","TIURS1",26,0)
 . D DOCPRM^TIULC1(+TIU0,.TIUDPRM,TIUDA)
"RTN","TIURS1",27,0)
 . S ASK=$$CANDO^TIULP(TIUDA,TIUEVNT)
"RTN","TIURS1",28,0)
 . I +ASK>0 D
"RTN","TIURS1",29,0)
 . . L +^TIU(8925,+TIUDA):1
"RTN","TIURS1",30,0)
 . . E  S ASK="0^ Another user is editing this entry."
"RTN","TIURS1",31,0)
 . I +ASK'>0,$P(ASK,U,2)]"" D  I 1
"RTN","TIURS1",32,0)
 . . D FULL^VALM1
"RTN","TIURS1",33,0)
 . . W !!,"Item #",TIUI,": ",$P(ASK,U,2),! K VALMY(TIUI)
"RTN","TIURS1",34,0)
 . . W !,"Removed from signature list.",!
"RTN","TIURS1",35,0)
 . . I $$READ^TIUU("FOA","Press RETURN to continue...")
"RTN","TIURS1",36,0)
 . E  D
"RTN","TIURS1",37,0)
 . . ;If document is a clinical procedures title AND (P184) this is not an additional signature, check if clinical
"RTN","TIURS1",38,0)
 . . ;procedure fields are required.  If the fields are required, prompt for
"RTN","TIURS1",39,0)
 . . ;them and don't permit the user to sign unless the fields are defined.
"RTN","TIURS1",40,0)
 . . I '$G(XTRASGNR),+$$ISA^TIULX(+TIU0,+$$CLASS^TIUCP),$$REQCPF^TIULP(+$P($G(^TIU(8925,+TIUDA,14)),U,5)) D  Q:+TIUPOP
"RTN","TIURS1",41,0)
 . . . N TIUCPFLD
"RTN","TIURS1",42,0)
 . . . W !!,"Item #",TIUI,": ",TIUTYPE," for "
"RTN","TIURS1",43,0)
 . . . W $$PTNAME^TIULC1($P(TIU0,U,2))," will need Procedure Summary Code and Date/Time Performed..."
"RTN","TIURS1",44,0)
 . . . I $G(^TIU(8925,+TIUDA,702)),$P(^(702),U)]"",$P(^(702),U,2)]"" S TIUCPFLD=1 Q
"RTN","TIURS1",45,0)
 . . . S TIUCPFLD=$$ASKCPF^TIURS(TIUDA)
"RTN","TIURS1",46,0)
 . . . I +TIUCPFLD'>0 D
"RTN","TIURS1",47,0)
 . . . . S TIUPOP=1
"RTN","TIURS1",48,0)
 . . . . W !!,"Item #",TIUI,": MUST have a Procedure Summary Code and Date/Time Performed",!,"before you may sign."
"RTN","TIURS1",49,0)
 . . . . W !!,"Removed from signature list.",!
"RTN","TIURS1",50,0)
 . . . . I $$READ^TIUU("FOA","Press RETURN to continue...")
"RTN","TIURS1",51,0)
 . . ; VMP/RJT - *233
"RTN","TIURS1",52,0)
 . . I $S(+$$REQCOSIG^TIULP(+TIU0,+TIUDA,DUZ):1,+$P(TIU15,U,6):1,1:0),(+$P(TIU12,U,8)'>0),'+$G(XTRASGNR)   D  Q:+TIUPOP
"RTN","TIURS1",53,0)
 . . . N COSIGNER
"RTN","TIURS1",54,0)
 . . . W !!,"Item #",TIUI,": ",TIUTYPE," for "
"RTN","TIURS1",55,0)
 . . . W $$PTNAME^TIULC1($P(TIU0,U,2))," will need cosignature..."
"RTN","TIURS1",56,0)
 . . . S COSIGNER=$$ASKCSNR^TIURS(TIUDA,DUZ)
"RTN","TIURS1",57,0)
 . . . I +COSIGNER'>0 D
"RTN","TIURS1",58,0)
 . . . . S TIUPOP=1
"RTN","TIURS1",59,0)
 . . . . W !!,"Item #",TIUI,": MUST have a cosigner, before you may sign."
"RTN","TIURS1",60,0)
 . . . . W !!,"Removed from signature list.",!
"RTN","TIURS1",61,0)
 . . . . I $$READ^TIUU("FOA","Press RETURN to continue...")
"RTN","TIURS1",62,0)
 . . N TIU,TIUY
"RTN","TIURS1",63,0)
 . . D EN^VALM("TIU SIGN/COSIGN")
"RTN","TIURS1",64,0)
 I $D(TIUSLST)'>9 D  G ELSIGX
"RTN","TIURS1",65,0)
 . S VALMSG="** Signature List Empty...Nothing signed. **"
"RTN","TIURS1",66,0)
 I $D(TIUSLST)>9 D
"RTN","TIURS1",67,0)
 . N TIUIO
"RTN","TIURS1",68,0)
 . S TIUES=$$ASKSIG^TIULA1
"RTN","TIURS1",69,0)
 . I '+TIUES S VALMSG="** Nothing Signed. **" D FIXLSTNW^TIULM Q
"RTN","TIURS1",70,0)
 . D FULL^VALM1
"RTN","TIURS1",71,0)
 . D MULTIPRN(.TIUSLST,.TIUIO)
"RTN","TIURS1",72,0)
 . S TIUI=0 F  S TIUI=$O(TIUSLST(TIUI)) Q:+TIUI'>0  D
"RTN","TIURS1",73,0)
 . . N TIUPY,XTRASGNR
"RTN","TIURS1",74,0)
 . . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI)),TIUDA=$P(TIUDATA,U,2)
"RTN","TIURS1",75,0)
 . . S TIUDAARY(TIUI)=TIUDA
"RTN","TIURS1",76,0)
 . . S TIULST=$G(TIULST)_$S($G(TIULST)]"":",",1:"")_TIUI
"RTN","TIURS1",77,0)
 . . S XTRASGNR=+$P(TIUSLST(TIUI),U,3)
"RTN","TIURS1",78,0)
 . . I +$G(XTRASGNR) D ADDSIG^TIURS1(TIUDA,XTRASGNR)
"RTN","TIURS1",79,0)
 . . I '+$G(XTRASGNR) D ES^TIURS(TIUDA,TIUES)
"RTN","TIURS1",80,0)
 . . I +TIUSLST(TIUI),(TIUIO]"") D RPC^TIUPD(.TIUPY,TIUDA,TIUIO,$P(TIUSLST(TIUI),U,2))
"RTN","TIURS1",81,0)
 . D FULL^VALM1
"RTN","TIURS1",82,0)
ELSIGX I $G(TIUCHNG("ADDM"))!$G(TIUCHNG("DELETE")) S TIUCHNG("RBLD")=1
"RTN","TIURS1",83,0)
 E  S TIUCHNG("UPDATE")=1
"RTN","TIURS1",84,0)
 D UPRBLD^TIURL(.TIUCHNG,.VALMY) K VALMY
"RTN","TIURS1",85,0)
 S VALMBCK="R"
"RTN","TIURS1",86,0)
 D VMSG($G(TIULST),.TIUDAARY,"signed")
"RTN","TIURS1",87,0)
 Q
"RTN","TIURS1",88,0)
VMSG(TIULST,TIUDAARY,ACTION) ; Set VALMSG for messagebar, bold changed items
"RTN","TIURS1",89,0)
 N TIUI,LINENO,ACTFIRST
"RTN","TIURS1",90,0)
 S ACTFIRST=$S(ACTION="Encounter Data Edited":1,ACTION="Signers identified/edited":1,ACTION="Title changed":1,1:0)
"RTN","TIURS1",91,0)
 I TIULST']"" D  Q
"RTN","TIURS1",92,0)
 . I ACTFIRST S VALMSG="** No changes made. **" Q
"RTN","TIURS1",93,0)
 . S VALMSG="** Nothing "_ACTION_". **"
"RTN","TIURS1",94,0)
 I ACTION="copied" S ACTION="copied; See end of list"
"RTN","TIURS1",95,0)
 S TIULST=$$NEWLST(TIULST,.TIUDAARY)
"RTN","TIURS1",96,0)
 I TIULST]"" D
"RTN","TIURS1",97,0)
 . I ACTFIRST D  Q
"RTN","TIURS1",98,0)
 . . S VALMSG="** "_ACTION_" for item"_$S($L(TIULST,",")>1:"s ",$L(TIULST,"-")>1:"s ",1:" ")_TIULST_". **"
"RTN","TIURS1",99,0)
 . S VALMSG="** Item"_$S($L(TIULST,",")>1:"s ",$L(TIULST,"-")>1:"s ",1:" ")_TIULST_" "_ACTION_". **"
"RTN","TIURS1",100,0)
 I TIULST']"" D
"RTN","TIURS1",101,0)
 . I ACTFIRST D  Q
"RTN","TIURS1",102,0)
 . . S VALMSG="** "_ACTION_"; item(s) no longer in list. **"
"RTN","TIURS1",103,0)
 . S VALMSG="** Item"_$S($L(TIULST,",")>1:"s ",$L(TIULST,"-")>1:"s ",1:" ")_TIULST_" "_ACTION_", no longer in list. **"
"RTN","TIURS1",104,0)
 . ;S VALMSG="** Item(s) "_ACTION_", no longer in list. **"
"RTN","TIURS1",105,0)
 Q:$G(^TMP("TIUR",$J,"RTN"))="TIUROR"
"RTN","TIURS1",106,0)
 F TIUI=1:1 S LINENO=$P(TIULST,", ",TIUI) Q:'LINENO  D
"RTN","TIURS1",107,0)
 . D CNTRL^VALM10(LINENO,1,$G(VALM("RM")),IOINHI,IOINORM)
"RTN","TIURS1",108,0)
 Q
"RTN","TIURS1",109,0)
NEWLST(TIULST,TIUDAARY) ; Return TIULST with updated item numbers
"RTN","TIURS1",110,0)
 N TIUI,TIULNO,TIUDA,TIUNLNO,TIUNLST
"RTN","TIURS1",111,0)
 S TIUNLST=""
"RTN","TIURS1",112,0)
 F TIUI=1:1 S TIULNO=$P(TIULST,",",TIUI) Q:'TIULNO  D
"RTN","TIURS1",113,0)
 . S TIUDA=TIUDAARY(TIULNO),TIUNLNO=$O(^TMP("TIUR",$J,"IEN",TIUDA,0))
"RTN","TIURS1",114,0)
 . I TIUNLNO S TIUNLST=$G(TIUNLST)_$S($G(TIUNLST)]"":", ",1:"")_TIUNLNO
"RTN","TIURS1",115,0)
 Q TIUNLST
"RTN","TIURS1",116,0)
 ;
"RTN","TIURS1",117,0)
MULTIPRN(TIUSLST,TIUIO) ; ask device
"RTN","TIURS1",118,0)
 N TIUI,TIUASK,TIUION,TIUPOK,IO,TIUPLIST,TIUSCRN S (TIUI,TIUPOK)=0
"RTN","TIURS1",119,0)
 F  S TIUI=$O(TIUSLST(TIUI)) Q:TIUI'>0!+TIUPOK  S:+TIUSLST(TIUI) TIUPOK=1
"RTN","TIURS1",120,0)
 I '+TIUPOK S TIUIO="" Q
"RTN","TIURS1",121,0)
 S TIUPLIST=$$LIST(.TIUSLST)
"RTN","TIURS1",122,0)
 W !!,"Please specify the device for printing item"
"RTN","TIURS1",123,0)
 W $S(TIUPLIST[",":"s",TIUPLIST["-":"s",1:""),": ",TIUPLIST,!!
"RTN","TIURS1",124,0)
 S TIUSCRN="I $L($G(^%ZIS(1,+Y,""TYPE""))),("";HFS;MT;BAR;VTRM;RES;CHAN;IMPC;""'[("";""_^(""TYPE"")_"";""))"
"RTN","TIURS1",125,0)
 S TIUION=$$DEVICE^TIUDEV(.TIUIO,"LAST","N",TIUSCRN,"Q")
"RTN","TIURS1",126,0)
 I '$L(TIUION) S TIUIO=""
"RTN","TIURS1",127,0)
 D ^%ZISC
"RTN","TIURS1",128,0)
 Q
"RTN","TIURS1",129,0)
LIST(LIST) ; build print list
"RTN","TIURS1",130,0)
 N TIUY,TIUI S TIUI=0
"RTN","TIURS1",131,0)
 F  S TIUI=$O(LIST(TIUI)) Q:+TIUI'>0  D
"RTN","TIURS1",132,0)
 . S:+LIST(TIUI) TIUY=$G(TIUY)_$S($G(TIUY)]"":", ",1:"")_TIUI
"RTN","TIURS1",133,0)
 Q $G(TIUY)
"RTN","TIURS1",134,0)
 ;
"RTN","TIURS1",135,0)
ADDSIG(TIUDA,DA) ; Apply extra signatures to a document
"RTN","TIURS1",136,0)
 N DIE,DR
"RTN","TIURS1",137,0)
 S DIE=8925.7
"RTN","TIURS1",138,0)
 S DR=".04////"_$$NOW^TIULC_";.05////"_DUZ_";.06///^S X=$$SIGNAME^TIULS("_DUZ_");.07///^S X=$$SIGTITL^TIULS("_DUZ_");.08////E"
"RTN","TIURS1",139,0)
 D ^DIE
"RTN","TIURS1",140,0)
 D SEND^TIUALRT(TIUDA)
"RTN","TIURS1",141,0)
 Q
"RTN","TIURS1",142,0)
CNVPOST ; Change Titles/Convert Postings
"RTN","TIURS1",143,0)
 N TIUI,TIULST,Y,TIUVIEW,TIUCHNG,TIUDAARY
"RTN","TIURS1",144,0)
 I $G(TIUGLINK) W !,"Please finish attaching the interdisciplinary note before changing title.",! H 3 Q
"RTN","TIURS1",145,0)
 I '$D(VALMY) D EN^VALM2(XQORNOD(0))
"RTN","TIURS1",146,0)
 S TIUI=0
"RTN","TIURS1",147,0)
 I +$O(VALMY(0)) D FULL^VALM1
"RTN","TIURS1",148,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D  Q:$D(DIROUT)
"RTN","TIURS1",149,0)
 . N TIU,TIUDA,DFN,TIUDATA,VALMY,XQORM,TIUVIEW,RSTRCTD
"RTN","TIURS1",150,0)
 . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI))
"RTN","TIURS1",151,0)
 . S TIUDA=+$P(TIUDATA,U,2) S RSTRCTD=$$DOCRES^TIULRR(TIUDA)
"RTN","TIURS1",152,0)
 . I RSTRCTD D  Q
"RTN","TIURS1",153,0)
 . . W !!,$C(7),"Ok, no harm done...",! ; Echo denial message
"RTN","TIURS1",154,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURS1",155,0)
 . S TIUVIEW=$$CANDO^TIULP(TIUDA,"VIEW")
"RTN","TIURS1",156,0)
 . I +TIUVIEW'>0 D  Q  ; Exclude records user can't view
"RTN","TIURS1",157,0)
 . . W !!,$C(7),$P(TIUVIEW,U,2),! ; Echo denial message
"RTN","TIURS1",158,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURS1",159,0)
 . S TIUCHNG=0
"RTN","TIURS1",160,0)
 . D EN^VALM("TIU CHANGE TITLE")
"RTN","TIURS1",161,0)
 . S TIUDAARY(TIUI)=TIUDA
"RTN","TIURS1",162,0)
 . I +$G(TIUCHNG) S TIULST=$G(TIULST)_$S($G(TIULST)]"":",",1:"")_TIUI
"RTN","TIURS1",163,0)
 ; -- Update list: --
"RTN","TIURS1",164,0)
 S TIUCHNG("UPDATE")=1
"RTN","TIURS1",165,0)
 D UPRBLD^TIURL(.TIUCHNG,.VALMY) K VALMY
"RTN","TIURS1",166,0)
 S VALMBCK="R"
"RTN","TIURS1",167,0)
 D VMSG($G(TIULST),.TIUDAARY,"Title changed")
"RTN","TIURS1",168,0)
 Q
"RTN","TIURS1",169,0)
CNVPOST1 ; Convert Single Posting to another title
"RTN","TIURS1",170,0)
 N TIUD0,DIE,DR,TIUTITL,CHKSUM,TIUCHTTL,TIUCLSS,TIUCON,TIUQUIT
"RTN","TIURS1",171,0)
 N DA,X,Y
"RTN","TIURS1",172,0)
 ; Added TIUCON for **142
"RTN","TIURS1",173,0)
 S TIUD0=$G(^TIU(8925,TIUDA,0)),TIUCHNG=0
"RTN","TIURS1",174,0)
 ; Added TIUNOCS for **142
"RTN","TIURS1",175,0)
 D FULL^VALM1
"RTN","TIURS1",176,0)
 I +TIUD0=81 S TIUCHTTL="0^You may not change the TITLE of an ADDENDUM."
"RTN","TIURS1",177,0)
 I '$D(TIUCHTTL) S TIUCHTTL=$$CANDO^TIULP(TIUDA,"CHANGE TITLE")
"RTN","TIURS1",178,0)
 I +TIUCHTTL,$$DADORKID^TIUGBR(TIUDA) S TIUCHTTL="0^Interdisciplinary entries must be detached before changing titles." ;**100
"RTN","TIURS1",179,0)
 I +TIUCHTTL'>0 D  Q
"RTN","TIURS1",180,0)
 . W !!,$C(7),$P(TIUCHTTL,U,2),! ; Echo denial
"RTN","TIURS1",181,0)
 . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURS1",182,0)
 L +^TIU(8925,TIUDA,0):1
"RTN","TIURS1",183,0)
 E  D  Q
"RTN","TIURS1",184,0)
 . W !!?5,$C(7),"Another user is editing this entry.",! ; Echo denial
"RTN","TIURS1",185,0)
 . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURS1",186,0)
 S TIUTITL=$$ASKTITLE^TIULA3(+$$CLINDOC^TIULC1(+TIUD0,TIUDA),+TIUD0)
"RTN","TIURS1",187,0)
 S TIUCLSS=$$CLASS^TIUCNSLT()
"RTN","TIURS1",188,0)
 S TIUCON=+$$ISA^TIULX(TIUTITL,TIUCLSS)
"RTN","TIURS1",189,0)
 I TIUCON=1,+TIUD0'=TIUTITL D CHANGE^TIUCNSLT(TIUDA,"",.TIUNOCS)
"RTN","TIURS1",190,0)
 I $G(TIUNOCS)=-1 D  G POST1Q
"RTN","TIURS1",191,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...")  ; **142
"RTN","TIURS1",192,0)
 ;*184->
"RTN","TIURS1",193,0)
 D CONSCT^TIUCNSLT(TIUDA,+TIUD0,TIUTITL)
"RTN","TIURS1",194,0)
 D PRFCT^TIUPRF1(+TIUD0,TIUTITL,TIUDA)
"RTN","TIURS1",195,0)
 ;<-*184
"RTN","TIURS1",196,0)
 I $G(TIUQUIT)=1 G POST1Q
"RTN","TIURS1",197,0)
 S DIE=8925,DA=TIUDA
"RTN","TIURS1",198,0)
 S DR=".01////^S X="_TIUTITL_";.04////^S X="_$$DOCCLASS^TIULC1(TIUTITL)
"RTN","TIURS1",199,0)
 D ^DIE
"RTN","TIURS1",200,0)
 I +$G(^TIU(8925,+TIUDA,0))'=+TIUD0 S TIUCHNG=1
"RTN","TIURS1",201,0)
 S CHKSUM=+$$CHKSUM^TIULC("^TIU(8925,"_+TIUDA_",""TEXT"")")
"RTN","TIURS1",202,0)
 D AUDIT^TIUEDI1(TIUDA,CHKSUM,CHKSUM)
"RTN","TIURS1",203,0)
POST1Q ;clean up, linetag put in with *171
"RTN","TIURS1",204,0)
 L -^TIU(8925,TIUDA,0)
"RTN","TIURS1",205,0)
 K TIUNOCS
"RTN","TIURS1",206,0)
 Q
"VER")
8.0^22.0
"BLD",7363,6)
^229
**END**
**END**
