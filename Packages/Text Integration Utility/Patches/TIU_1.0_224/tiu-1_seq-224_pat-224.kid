Released TIU*1*224 SEQ #224
Extracted from mail message
**KIDS**:TIU*1.0*224^

**INSTALL NAME**
TIU*1.0*224
"BLD",7307,0)
TIU*1.0*224^TEXT INTEGRATION UTILITIES^0^3071017^y
"BLD",7307,1,0)
^^9^9^3071017^
"BLD",7307,1,1,0)
Fix the following defects
"BLD",7307,1,2,0)
HD 169774  UPDATE OF 8925.1 "ACL" INDEX
"BLD",7307,1,3,0)
HD 71187 UNDEFINED STATUS+9^TIUR
"BLD",7307,1,4,0)
HD 69681 DIFFERENCE IN PRINTING IDENTIFIED SIGNERS
"BLD",7307,1,5,0)
HD 69457 UNDEFINED UPRBLD+38^TIURL
"BLD",7307,1,6,0)
HD 209427 LM rebuild list does not display properly after a line is 
"BLD",7307,1,7,0)
deleted.
"BLD",7307,1,8,0)
 
"BLD",7307,1,9,0)
HD 71015 UNDEFINED SETREC+7^TIURL
"BLD",7307,4,0)
^9.64PA^^
"BLD",7307,6)
1^
"BLD",7307,6.3)
7
"BLD",7307,"ABPKG")
n
"BLD",7307,"KRN",0)
^9.67PA^8989.52^19
"BLD",7307,"KRN",.4,0)
.4
"BLD",7307,"KRN",.401,0)
.401
"BLD",7307,"KRN",.402,0)
.402
"BLD",7307,"KRN",.403,0)
.403
"BLD",7307,"KRN",.5,0)
.5
"BLD",7307,"KRN",.84,0)
.84
"BLD",7307,"KRN",3.6,0)
3.6
"BLD",7307,"KRN",3.8,0)
3.8
"BLD",7307,"KRN",9.2,0)
9.2
"BLD",7307,"KRN",9.8,0)
9.8
"BLD",7307,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",7307,"KRN",9.8,"NM",1,0)
TIUR^^0^B40522374
"BLD",7307,"KRN",9.8,"NM",2,0)
TIURM^^0^B24432420
"BLD",7307,"KRN",9.8,"NM",3,0)
TIUDD1^^0^B57939687
"BLD",7307,"KRN",9.8,"NM",4,0)
TIUPRPN8^^0^B30690125
"BLD",7307,"KRN",9.8,"NM",5,0)
TIURL^^0^B17883225
"BLD",7307,"KRN",9.8,"NM","B","TIUDD1",3)
 
"BLD",7307,"KRN",9.8,"NM","B","TIUPRPN8",4)
 
"BLD",7307,"KRN",9.8,"NM","B","TIUR",1)
 
"BLD",7307,"KRN",9.8,"NM","B","TIURL",5)
 
"BLD",7307,"KRN",9.8,"NM","B","TIURM",2)
 
"BLD",7307,"KRN",19,0)
19
"BLD",7307,"KRN",19.1,0)
19.1
"BLD",7307,"KRN",101,0)
101
"BLD",7307,"KRN",409.61,0)
409.61
"BLD",7307,"KRN",771,0)
771
"BLD",7307,"KRN",870,0)
870
"BLD",7307,"KRN",8989.51,0)
8989.51
"BLD",7307,"KRN",8989.52,0)
8989.52
"BLD",7307,"KRN",8994,0)
8994
"BLD",7307,"KRN","B",.4,.4)
 
"BLD",7307,"KRN","B",.401,.401)
 
"BLD",7307,"KRN","B",.402,.402)
 
"BLD",7307,"KRN","B",.403,.403)
 
"BLD",7307,"KRN","B",.5,.5)
 
"BLD",7307,"KRN","B",.84,.84)
 
"BLD",7307,"KRN","B",3.6,3.6)
 
"BLD",7307,"KRN","B",3.8,3.8)
 
"BLD",7307,"KRN","B",9.2,9.2)
 
"BLD",7307,"KRN","B",9.8,9.8)
 
"BLD",7307,"KRN","B",19,19)
 
"BLD",7307,"KRN","B",19.1,19.1)
 
"BLD",7307,"KRN","B",101,101)
 
"BLD",7307,"KRN","B",409.61,409.61)
 
"BLD",7307,"KRN","B",771,771)
 
"BLD",7307,"KRN","B",870,870)
 
"BLD",7307,"KRN","B",8989.51,8989.51)
 
"BLD",7307,"KRN","B",8989.52,8989.52)
 
"BLD",7307,"KRN","B",8994,8994)
 
"BLD",7307,"QDEF")
^^^^^^^^^^YES
"BLD",7307,"QUES",0)
^9.62^^
"BLD",7307,"REQB",0)
^9.611^5^5
"BLD",7307,"REQB",1,0)
TIU*1.0*163^1
"BLD",7307,"REQB",2,0)
TIU*1.0*182^1
"BLD",7307,"REQB",3,0)
TIU*1.0*207^1
"BLD",7307,"REQB",4,0)
TIU*1.0*100^1
"BLD",7307,"REQB",5,0)
TIU*1.0*216^1
"BLD",7307,"REQB","B","TIU*1.0*100",4)
 
"BLD",7307,"REQB","B","TIU*1.0*163",1)
 
"BLD",7307,"REQB","B","TIU*1.0*182",2)
 
"BLD",7307,"REQB","B","TIU*1.0*207",3)
 
"BLD",7307,"REQB","B","TIU*1.0*216",5)
 
"MBREQ")
0
"PKG",470,-1)
1^1
"PKG",470,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",470,20,0)
^9.402P^^
"PKG",470,22,0)
^9.49I^1^1
"PKG",470,22,1,0)
1.0^3010801^3010806^66481
"PKG",470,22,1,"PAH",1,0)
224^3071017^101036
"PKG",470,22,1,"PAH",1,1,0)
^^9^9^3071017
"PKG",470,22,1,"PAH",1,1,1,0)
Fix the following defects
"PKG",470,22,1,"PAH",1,1,2,0)
HD 169774  UPDATE OF 8925.1 "ACL" INDEX
"PKG",470,22,1,"PAH",1,1,3,0)
HD 71187 UNDEFINED STATUS+9^TIUR
"PKG",470,22,1,"PAH",1,1,4,0)
HD 69681 DIFFERENCE IN PRINTING IDENTIFIED SIGNERS
"PKG",470,22,1,"PAH",1,1,5,0)
HD 69457 UNDEFINED UPRBLD+38^TIURL
"PKG",470,22,1,"PAH",1,1,6,0)
HD 209427 LM rebuild list does not display properly after a line is 
"PKG",470,22,1,"PAH",1,1,7,0)
deleted.
"PKG",470,22,1,"PAH",1,1,8,0)
 
"PKG",470,22,1,"PAH",1,1,9,0)
HD 71015 UNDEFINED SETREC+7^TIURL
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","TIUDD1")
0^3^B57939687^B41241397
"RTN","TIUDD1",1,0)
TIUDD1 ; SLC/JER - XREFs for file 8925.1 ;19-OCT-2001 10:05:37 [7/28/04 9:08am]
"RTN","TIUDD1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**7,51,115,163,224**;Jun 20, 1997;Build 7
"RTN","TIUDD1",3,0)
SACL(X,FLD) ; Set logic for ACL cross-reference
"RTN","TIUDD1",4,0)
 ; Called from fields .01 (NAME), .07 (STATUS), .03 (PRINT NAME),
"RTN","TIUDD1",5,0)
 ; .02 (ABBREVIATION), and Subfield .01 of ITEM sub-file
"RTN","TIUDD1",6,0)
 N TIUCLASS,TIUSTTS,TIUTTL
"RTN","TIUDD1",7,0)
 I FLD=10.01 D
"RTN","TIUDD1",8,0)
 . ; Include only TITLES in the index
"RTN","TIUDD1",9,0)
 . I $P($G(^TIU(8925.1,+X,0)),U,4)'="DOC" Q
"RTN","TIUDD1",10,0)
 . S TIUSTTS=$P($G(^TIU(8925.1,+X,0)),U,7)
"RTN","TIUDD1",11,0)
 . ; Include only TEST or ACTIVE titles
"RTN","TIUDD1",12,0)
 . I $S(TIUSTTS=10:0,TIUSTTS=11:0,1:1) Q
"RTN","TIUDD1",13,0)
 . S TIUTTL=$P($G(^TIU(8925.1,+X,0)),U)
"RTN","TIUDD1",14,0)
 . Q:TIUTTL']""
"RTN","TIUDD1",15,0)
 . ; First build x-ref for Clinical Documents & Immediate descendents
"RTN","TIUDD1",16,0)
 . S TIUCLASS=+$$CLINDOC^TIULC1(+X)
"RTN","TIUDD1",17,0)
 . I TIUCLASS'>0 Q
"RTN","TIUDD1",18,0)
 . S ^TIU(8925.1,"ACL",TIUCLASS,TIUTTL,+X)=""
"RTN","TIUDD1",19,0)
 . S ^TIU(8925.1,"ACL",38,TIUTTL,+X)=""
"RTN","TIUDD1",20,0)
 . D SACLKWIC(TIUTTL,TIUCLASS,+X)
"RTN","TIUDD1",21,0)
 . ; Now build x-ref for document classes
"RTN","TIUDD1",22,0)
 . S TIUCLASS=+$$DOCCLASS^TIULC1(+X)
"RTN","TIUDD1",23,0)
 . I TIUCLASS'>0 Q
"RTN","TIUDD1",24,0)
 . S ^TIU(8925.1,"ACL",TIUCLASS,TIUTTL,+X)=""
"RTN","TIUDD1",25,0)
 . D SACLKWIC(TIUTTL,TIUCLASS,+X)
"RTN","TIUDD1",26,0)
 ; For Abbreviation and Print Name fields, just set the Synonym subscript
"RTN","TIUDD1",27,0)
 I $S(FLD=.02:1,FLD=.03:1,1:0) D  Q
"RTN","TIUDD1",28,0)
 . N TIUDA
"RTN","TIUDD1",29,0)
 . Q:X']""
"RTN","TIUDD1",30,0)
 . S TIUDA=$S(+$G(DA(1)):+$G(DA(1)),1:+$G(DA))
"RTN","TIUDD1",31,0)
 . I $P($G(^TIU(8925.1,+TIUDA,0)),U,4)'="DOC" Q
"RTN","TIUDD1",32,0)
 . S TIUSTTS=$P($G(^TIU(8925.1,+TIUDA,0)),U,7)
"RTN","TIUDD1",33,0)
 . ;VMPELR P 224 allow the update of inactive titles
"RTN","TIUDD1",34,0)
 . ; Include only TEST or ACTIVE or INACTIVE TITLES
"RTN","TIUDD1",35,0)
 . I $S(TIUSTTS=10:0,TIUSTTS=11:0,TIUSTTS=13:0,1:1) Q
"RTN","TIUDD1",36,0)
 . S TIUTTL=$P($G(^TIU(8925.1,+TIUDA,0)),U)
"RTN","TIUDD1",37,0)
 . Q:TIUTTL']""
"RTN","TIUDD1",38,0)
 . S X=$$UP^XLFSTR(X)
"RTN","TIUDD1",39,0)
 . Q:X=TIUTTL
"RTN","TIUDD1",40,0)
 . S TIUTTL=X_"  <"_TIUTTL_">"
"RTN","TIUDD1",41,0)
 . ; First build x-ref for Clinical Documents & Immediate descendents
"RTN","TIUDD1",42,0)
 . S TIUCLASS=+$$CLINDOC^TIULC1(+TIUDA)
"RTN","TIUDD1",43,0)
 . I TIUCLASS'>0 Q
"RTN","TIUDD1",44,0)
 . S ^TIU(8925.1,"ACL",TIUCLASS,TIUTTL,+TIUDA)=""
"RTN","TIUDD1",45,0)
 . S ^TIU(8925.1,"ACL",38,TIUTTL,+TIUDA)=""
"RTN","TIUDD1",46,0)
 . ; Now build x-ref for document classes
"RTN","TIUDD1",47,0)
 . S TIUCLASS=+$$DOCCLASS^TIULC1(+TIUDA)
"RTN","TIUDD1",48,0)
 . I TIUCLASS'>0 Q
"RTN","TIUDD1",49,0)
 . S ^TIU(8925.1,"ACL",TIUCLASS,TIUTTL,+TIUDA)=""
"RTN","TIUDD1",50,0)
 I FLD=.07 D  Q
"RTN","TIUDD1",51,0)
 . N TIUDA
"RTN","TIUDD1",52,0)
 . S TIUDA=$S(+$G(DA(1)):+$G(DA(1)),1:+$G(DA))
"RTN","TIUDD1",53,0)
 . I $P($G(^TIU(8925.1,+TIUDA,0)),U,4)'="DOC" Q
"RTN","TIUDD1",54,0)
 . S TIUSTTS=$P($G(^TIU(8925.1,+TIUDA,0)),U,7)
"RTN","TIUDD1",55,0)
 . ; Include only TEST or ACTIVE titles
"RTN","TIUDD1",56,0)
 . I $S(TIUSTTS=10:0,TIUSTTS=11:0,1:1) Q
"RTN","TIUDD1",57,0)
 . S TIUTTL=$P($G(^TIU(8925.1,+TIUDA,0)),U)
"RTN","TIUDD1",58,0)
 . Q:TIUTTL']""
"RTN","TIUDD1",59,0)
 . ; First build x-ref for Clinical Documents & Immediate descendents
"RTN","TIUDD1",60,0)
 . S TIUCLASS=+$$CLINDOC^TIULC1(+TIUDA)
"RTN","TIUDD1",61,0)
 . I TIUCLASS'>0 Q
"RTN","TIUDD1",62,0)
 . S ^TIU(8925.1,"ACL",TIUCLASS,TIUTTL,+TIUDA)=""
"RTN","TIUDD1",63,0)
 . S ^TIU(8925.1,"ACL",38,TIUTTL,+TIUDA)=""
"RTN","TIUDD1",64,0)
 . D SACLKWIC(TIUTTL,TIUCLASS,+TIUDA)
"RTN","TIUDD1",65,0)
 . ; Now build x-ref for document classes
"RTN","TIUDD1",66,0)
 . S TIUCLASS=+$$DOCCLASS^TIULC1(+TIUDA)
"RTN","TIUDD1",67,0)
 . I TIUCLASS'>0 Q
"RTN","TIUDD1",68,0)
 . S ^TIU(8925.1,"ACL",TIUCLASS,TIUTTL,+TIUDA)=""
"RTN","TIUDD1",69,0)
 . D SACLKWIC(TIUTTL,TIUCLASS,+TIUDA)
"RTN","TIUDD1",70,0)
 I FLD=.01 D
"RTN","TIUDD1",71,0)
 . N TIUDA
"RTN","TIUDD1",72,0)
 . S TIUDA=$S(+$G(DA(1)):+$G(DA(1)),1:+$G(DA))
"RTN","TIUDD1",73,0)
 . I $P($G(^TIU(8925.1,+TIUDA,0)),U,4)'="DOC" Q
"RTN","TIUDD1",74,0)
 . S TIUSTTS=$P($G(^TIU(8925.1,+TIUDA,0)),U,7)
"RTN","TIUDD1",75,0)
 . ; Include only TEST or ACTIVE OR inactive titles
"RTN","TIUDD1",76,0)
 . I $S(TIUSTTS=10:0,TIUSTTS=11:0,TIUSTTS=13:0,1:1) Q
"RTN","TIUDD1",77,0)
 . ; First build x-ref for Clinical Documents & Immediate descendents
"RTN","TIUDD1",78,0)
 . S TIUCLASS=+$$CLINDOC^TIULC1(+TIUDA)
"RTN","TIUDD1",79,0)
 . I TIUCLASS'>0 Q
"RTN","TIUDD1",80,0)
 . S ^TIU(8925.1,"ACL",TIUCLASS,X,+TIUDA)=""
"RTN","TIUDD1",81,0)
 . S ^TIU(8925.1,"ACL",38,X,+TIUDA)=""
"RTN","TIUDD1",82,0)
 . S TIUABV=$P($G(^TIU(8925.1,+TIUDA,0)),U,2)
"RTN","TIUDD1",83,0)
 . I TIUABV]"" S TIUABV=TIUABV_"  <"_X_">" S ^TIU(8925.1,"ACL",TIUCLASS,TIUABV,+TIUDA)="",^TIU(8925.1,"ACL",38,TIUABV,+TIUDA)=""
"RTN","TIUDD1",84,0)
 . S TIUPN=$P($G(^TIU(8925.1,+TIUDA,0)),U,3)
"RTN","TIUDD1",85,0)
 . I TIUPN]"" S TIUPN=TIUPN_"  <"_X_">" S ^TIU(8925.1,"ACL",TIUCLASS,TIUPN,+TIUDA)="",^TIU(8925.1,"ACL",38,TIUPN,+TIUDA)=""
"RTN","TIUDD1",86,0)
 . D SACLKWIC(X,TIUCLASS,+TIUDA)
"RTN","TIUDD1",87,0)
 . ; Now build x-ref for document classes
"RTN","TIUDD1",88,0)
 . S TIUCLASS=+$$DOCCLASS^TIULC1(+TIUDA)
"RTN","TIUDD1",89,0)
 . I TIUCLASS'>0 Q
"RTN","TIUDD1",90,0)
 . S ^TIU(8925.1,"ACL",TIUCLASS,X,+TIUDA)=""
"RTN","TIUDD1",91,0)
 . ;VMP/ELR PATCH 224 ADDED NEXT 4 LINES
"RTN","TIUDD1",92,0)
 . S TIUABV=$P($G(^TIU(8925.1,+TIUDA,0)),U,2)
"RTN","TIUDD1",93,0)
 . I TIUABV]"" S TIUABV=TIUABV_"  <"_X_">" S ^TIU(8925.1,"ACL",TIUCLASS,TIUABV,+TIUDA)=""
"RTN","TIUDD1",94,0)
 . S TIUPN=$P($G(^TIU(8925.1,+TIUDA,0)),U,3)
"RTN","TIUDD1",95,0)
 . I TIUPN]"" S TIUPN=TIUPN_"  <"_X_">" S ^TIU(8925.1,"ACL",TIUCLASS,TIUPN,+TIUDA)=""
"RTN","TIUDD1",96,0)
 . D SACLKWIC(X,TIUCLASS,+TIUDA)
"RTN","TIUDD1",97,0)
 Q
"RTN","TIUDD1",98,0)
SACLKWIC(X,TIUCLASS,TIUDA) ; Set logic for KWIC analog
"RTN","TIUDD1",99,0)
 N TIUI,TIUJ,TIUC S TIUI=1
"RTN","TIUDD1",100,0)
 F TIUJ=1:1:$L(X)+1 D
"RTN","TIUDD1",101,0)
 . S TIUC=$E(X,TIUJ)
"RTN","TIUDD1",102,0)
 . I "(,.?! '-/&:;)"[TIUC S TIUC=$E($E(X,TIUI,TIUJ-1),1,30),TIUI=TIUJ+1
"RTN","TIUDD1",103,0)
 . I  I $L(TIUC)>2,(^DD("KWIC")'[TIUC),(TIUC'=X) S (^TIU(8925.1,"ACL",TIUCLASS,TIUC_"  <"_X_">",TIUDA),^TIU(8925.1,"ACL",38,TIUC_"  <"_X_">",TIUDA))=""
"RTN","TIUDD1",104,0)
 Q
"RTN","TIUDD1",105,0)
KACL(X,FLD) ; KILL Logic for ACL cross-reference
"RTN","TIUDD1",106,0)
 N TIUCLASS,TIUTTL,TIUDA
"RTN","TIUDD1",107,0)
 I FLD=10.01 D
"RTN","TIUDD1",108,0)
 . ; First remove x-ref for Clinical Documents & Immediate descendents
"RTN","TIUDD1",109,0)
 . S TIUCLASS=+$$CLINDOC^TIULC1(+X)
"RTN","TIUDD1",110,0)
 . S TIUTTL=$P($G(^TIU(8925.1,+X,0)),U)
"RTN","TIUDD1",111,0)
 . Q:TIUTTL']""
"RTN","TIUDD1",112,0)
 . Q:X=TIUTTL
"RTN","TIUDD1",113,0)
 . K ^TIU(8925.1,"ACL",TIUCLASS,TIUTTL,+X)
"RTN","TIUDD1",114,0)
 . K ^TIU(8925.1,"ACL",38,TIUTTL,+X)
"RTN","TIUDD1",115,0)
 . D KACLKWIC(TIUTTL,TIUCLASS,+X)
"RTN","TIUDD1",116,0)
 . ; Now remove x-ref for document classes
"RTN","TIUDD1",117,0)
 . S TIUCLASS=+$$DOCCLASS^TIULC1(+X)
"RTN","TIUDD1",118,0)
 . K ^TIU(8925.1,"ACL",TIUCLASS,TIUTTL,+X)
"RTN","TIUDD1",119,0)
 . D KACLKWIC(TIUTTL,TIUCLASS,+X)
"RTN","TIUDD1",120,0)
 I $S(FLD=.02:1,FLD=.03:1,1:0) D  Q
"RTN","TIUDD1",121,0)
 . N TIUDA
"RTN","TIUDD1",122,0)
 . Q:X']""
"RTN","TIUDD1",123,0)
 . S TIUDA=$S(+$G(DA(1)):+$G(DA(1)),1:+$G(DA))
"RTN","TIUDD1",124,0)
 . I $P($G(^TIU(8925.1,+TIUDA,0)),U,4)'="DOC" Q
"RTN","TIUDD1",125,0)
 . S TIUSTTS=$P($G(^TIU(8925.1,+TIUDA,0)),U,7)
"RTN","TIUDD1",126,0)
 . ; Include only TEST or ACTIVE or INACTIVE titles
"RTN","TIUDD1",127,0)
 . I $S(TIUSTTS=10:0,TIUSTTS=11:0,TIUSTTS=13:0,1:1) Q
"RTN","TIUDD1",128,0)
 . S TIUTTL=$P($G(^TIU(8925.1,+TIUDA,0)),U)
"RTN","TIUDD1",129,0)
 . Q:TIUTTL']""
"RTN","TIUDD1",130,0)
 . S TIUTTL=X_"  <"_TIUTTL_">"
"RTN","TIUDD1",131,0)
 . ; First build x-ref for Clinical Documents & Immediate descendents
"RTN","TIUDD1",132,0)
 . S TIUCLASS=+$$CLINDOC^TIULC1(+TIUDA)
"RTN","TIUDD1",133,0)
 . I TIUCLASS'>0 Q
"RTN","TIUDD1",134,0)
 . K ^TIU(8925.1,"ACL",TIUCLASS,TIUTTL,+TIUDA)
"RTN","TIUDD1",135,0)
 . K ^TIU(8925.1,"ACL",38,TIUTTL,+TIUDA)
"RTN","TIUDD1",136,0)
 . ; Now build x-ref for document classes
"RTN","TIUDD1",137,0)
 . S TIUCLASS=+$$DOCCLASS^TIULC1(+TIUDA)
"RTN","TIUDD1",138,0)
 . I TIUCLASS'>0 Q
"RTN","TIUDD1",139,0)
 . K ^TIU(8925.1,"ACL",TIUCLASS,TIUTTL,+TIUDA)
"RTN","TIUDD1",140,0)
 I FLD=.07 D
"RTN","TIUDD1",141,0)
 . N TIUDA
"RTN","TIUDD1",142,0)
 . S TIUDA=$S(+$G(DA(1)):+$G(DA(1)),1:+$G(DA))
"RTN","TIUDD1",143,0)
 . ; First remove x-ref for Clinical Documents & Immediate descendents
"RTN","TIUDD1",144,0)
 . S TIUCLASS=+$$CLINDOC^TIULC1(+TIUDA)
"RTN","TIUDD1",145,0)
 . S TIUTTL=$P($G(^TIU(8925.1,+TIUDA,0)),U)
"RTN","TIUDD1",146,0)
 . Q:TIUTTL']""
"RTN","TIUDD1",147,0)
 . K ^TIU(8925.1,"ACL",TIUCLASS,TIUTTL,+TIUDA)
"RTN","TIUDD1",148,0)
 . K ^TIU(8925.1,"ACL",38,TIUTTL,+TIUDA)
"RTN","TIUDD1",149,0)
 . D KACLKWIC(TIUTTL,TIUCLASS,+TIUDA)
"RTN","TIUDD1",150,0)
 . ; Now remove x-ref for document classes
"RTN","TIUDD1",151,0)
 . S TIUCLASS=+$$DOCCLASS^TIULC1(+TIUDA)
"RTN","TIUDD1",152,0)
 . K ^TIU(8925.1,"ACL",TIUCLASS,TIUTTL,+TIUDA)
"RTN","TIUDD1",153,0)
 . D KACLKWIC(TIUTTL,TIUCLASS,+TIUDA)
"RTN","TIUDD1",154,0)
 I FLD=.01 D
"RTN","TIUDD1",155,0)
 . N TIUDA,TIUABV,TIUPN
"RTN","TIUDD1",156,0)
 . S TIUDA=$S(+$G(DA(1)):+$G(DA(1)),1:+$G(DA))
"RTN","TIUDD1",157,0)
 . ; First remove x-ref for Clinical Documents & Immediate descendents
"RTN","TIUDD1",158,0)
 . S TIUCLASS=+$$CLINDOC^TIULC1(+TIUDA)
"RTN","TIUDD1",159,0)
 . K ^TIU(8925.1,"ACL",TIUCLASS,X,+TIUDA)
"RTN","TIUDD1",160,0)
 . K ^TIU(8925.1,"ACL",38,X,+TIUDA)
"RTN","TIUDD1",161,0)
 . S TIUABV=$P($G(^TIU(8925.1,+TIUDA,0)),U,2)
"RTN","TIUDD1",162,0)
 . I TIUABV]"" S TIUABV=TIUABV_"  <"_X_">" K ^TIU(8925.1,"ACL",TIUCLASS,TIUABV,+TIUDA),^TIU(8925.1,"ACL",38,TIUABV,+TIUDA)
"RTN","TIUDD1",163,0)
 . S TIUPN=$P($G(^TIU(8925.1,+TIUDA,0)),U,3)
"RTN","TIUDD1",164,0)
 . I TIUPN]"" S TIUPN=TIUPN_"  <"_X_">" K ^TIU(8925.1,"ACL",TIUCLASS,TIUPN,+TIUDA),^TIU(8925.1,"ACL",38,TIUPN,+TIUDA)
"RTN","TIUDD1",165,0)
 . D KACLKWIC(X,TIUCLASS,+TIUDA)
"RTN","TIUDD1",166,0)
 . ; Now remove x-ref for document classes
"RTN","TIUDD1",167,0)
 . S TIUCLASS=+$$DOCCLASS^TIULC1(+TIUDA)
"RTN","TIUDD1",168,0)
 . K ^TIU(8925.1,"ACL",TIUCLASS,X,+TIUDA)
"RTN","TIUDD1",169,0)
 . ;VMP/ELR PATCH 224 ADDED NEXT 4 LINES
"RTN","TIUDD1",170,0)
 . S TIUABV=$P($G(^TIU(8925.1,+TIUDA,0)),U,2)
"RTN","TIUDD1",171,0)
 . I TIUABV]"" S TIUABV=TIUABV_"  <"_X_">" K ^TIU(8925.1,"ACL",TIUCLASS,TIUABV,+TIUDA)
"RTN","TIUDD1",172,0)
 . S TIUPN=$P($G(^TIU(8925.1,+TIUDA,0)),U,3)
"RTN","TIUDD1",173,0)
 . I TIUPN]"" S TIUPN=TIUPN_"  <"_X_">" K ^TIU(8925.1,"ACL",TIUCLASS,TIUPN,+TIUDA)
"RTN","TIUDD1",174,0)
 . D KACLKWIC(X,TIUCLASS,+TIUDA)
"RTN","TIUDD1",175,0)
 Q
"RTN","TIUDD1",176,0)
KACLKWIC(X,TIUCLASS,TIUDA) ; KILL Logic for KWIC analog
"RTN","TIUDD1",177,0)
 N TIUI,TIUJ,TIUC S TIUI=1
"RTN","TIUDD1",178,0)
 F TIUJ=1:1:$L(X)+1 D
"RTN","TIUDD1",179,0)
 . S TIUC=$E(X,TIUJ)
"RTN","TIUDD1",180,0)
 . I "(,.?! '-/&:;)"[TIUC S TIUC=$E($E(X,TIUI,TIUJ-1),1,30),TIUI=TIUJ+1
"RTN","TIUDD1",181,0)
 . I  I $L(TIUC)>2 K ^TIU(8925.1,"ACL",TIUCLASS,TIUC_"  <"_X_">",TIUDA),^TIU(8925.1,"ACL",38,TIUC_"  <"_X_">",TIUDA)
"RTN","TIUDD1",182,0)
 Q 
"RTN","TIUPRPN8")
0^4^B30690125^B28910137
"RTN","TIUPRPN8",1,0)
TIUPRPN8 ;SLC/MAM - Print SF 509-Progress Notes, Cont ;11/10/04 [1/4/05 12:17pm]
"RTN","TIUPRPN8",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**100,176,157,182,224**;Jun 20, 1997;Build 7
"RTN","TIUPRPN8",3,0)
 ;
"RTN","TIUPRPN8",4,0)
SIGBLK(TIUFOOT,TIUMISC,TIUCONT1,TIUCONT,TIUSIG,TIUROOT) ; Print signature block info
"RTN","TIUPRPN8",5,0)
 ; Requires array TIUFOOT, requires TIUMISC
"RTN","TIUPRPN8",6,0)
 ; Requires TIUCONT1
"RTN","TIUPRPN8",7,0)
 ; Receives TIUCONT by ref (req'd)
"RTN","TIUPRPN8",8,0)
 ; Receives array TIUSIG by ref, required.
"RTN","TIUPRPN8",9,0)
 ; Requires TIUROOT
"RTN","TIUPRPN8",10,0)
 N TIUDA,TIUFLAG
"RTN","TIUPRPN8",11,0)
 S TIUCONT=1,TIUDA=$P(TIUMISC,U,3),TIUFLAG=$P(TIUMISC,U)
"RTN","TIUPRPN8",12,0)
 ;S TIUGROOT=$NA(^TMP("TIULQ",$J,TIUDA))
"RTN","TIUPRPN8",13,0)
 ; -- P182 Don't marked admin signed notes as draft:
"RTN","TIUPRPN8",14,0)
 I '+TIUSIG("SIGNDATE"),'+TIUSIG("ADMINCDT") D  Q:'TIUCONT
"RTN","TIUPRPN8",15,0)
 . W "**DRAFT COPY - DRAFT COPY -- ABOVE NOTE IS UNSIGNED--"
"RTN","TIUPRPN8",16,0)
 . W " DRAFT COPY - DRAFT COPY**",!
"RTN","TIUPRPN8",17,0)
 . S TIUCONT=$$SETCONT^TIUPRPN1(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT))
"RTN","TIUPRPN8",18,0)
 ;I TIUSIG("SIGNEDBY")]"",(+TIUSIG("SIGNEDBY")'=+TIUSIG("AUTHOR"))  D
"RTN","TIUPRPN8",19,0)
 ;. W ?21,"Author:      ",$P(TIUSIG("AUTHOR"),";",2),!
"RTN","TIUPRPN8",20,0)
 I +TIUSIG("SIGNDATE") D  Q:'TIUCONT
"RTN","TIUPRPN8",21,0)
 . S TIUCONT=$$SETCONT^TIUPRPN1(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN8",22,0)
 . W ?18,"Signed by:",$S($P(TIUSIG("SIGNMODE"),";")="C":" /s/  ",1:" /es/ "),?34,$S(TIUSIG("SIGNNAME")]"":TIUSIG("SIGNNAME"),1:$P(TIUSIG("SIGNEDBY"),";",2))
"RTN","TIUPRPN8",23,0)
 . I $L(TIUSIG("SIGTITL"))>45 D
"RTN","TIUPRPN8",24,0)
 . . N TIUFT
"RTN","TIUPRPN8",25,0)
 . . D WRAP^TIUFLD(TIUSIG("SIGTITL"),45)
"RTN","TIUPRPN8",26,0)
 . . W !?34,$G(TIUFT(1))
"RTN","TIUPRPN8",27,0)
 . . W !?39,$G(TIUFT(2))
"RTN","TIUPRPN8",28,0)
 . I $L(TIUSIG("SIGTITL"))<46,TIUSIG("SIGTITL")]"" W !?34,TIUSIG("SIGTITL")
"RTN","TIUPRPN8",29,0)
 . W !?34,$$DATE^TIULS(+TIUSIG("SIGNDATE"),"MM/DD/CCYY HR:MIN")
"RTN","TIUPRPN8",30,0)
 . I '+$G(TIUFLAG)!($E(IOST)="C-") D
"RTN","TIUPRPN8",31,0)
 . . I $P($$BEEP^TIULC1(+TIUSIG("SIGNEDBY")),U) W !?34,"Analog Pager: ",$P($$BEEP^TIULC1(+TIUSIG("SIGNEDBY")),U)
"RTN","TIUPRPN8",32,0)
 . . I $P($$BEEP^TIULC1(+TIUSIG("SIGNEDBY")),U,2) W !?34,"Digital Pager: ",$P($$BEEP^TIULC1(+TIUSIG("SIGNEDBY")),U,2)
"RTN","TIUPRPN8",33,0)
 I $P(TIUSIG("SIGNMODE"),";")="C" D  Q:'TIUCONT
"RTN","TIUPRPN8",34,0)
 . S TIUCONT=$$SETCONT^TIUPRPN1(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN8",35,0)
 . N TIUONCH
"RTN","TIUPRPN8",36,0)
 . S TIUONCH=$P(TIUSIG("SIGCHRT"),";",2)
"RTN","TIUPRPN8",37,0)
 . I TIUONCH']"" S TIUONCH=$P(TIUSIG("COSCHRT"),";",2)
"RTN","TIUPRPN8",38,0)
 . W !?2,"Marked signed on chart by:",?34,$G(TIUONCH)
"RTN","TIUPRPN8",39,0)
 ; -- If signer is not author, write "for the author":
"RTN","TIUPRPN8",40,0)
 ;    P182 SIGNEDBY may =";" and follow null even when no signer:
"RTN","TIUPRPN8",41,0)
 ;I TIUSIG("SIGNEDBY")]"",(+TIUSIG("SIGNEDBY")'=+TIUSIG("AUTHOR"))  D
"RTN","TIUPRPN8",42,0)
 I TIUSIG("SIGNEDBY")]"",(TIUSIG("SIGNEDBY")'=";"),(+TIUSIG("SIGNEDBY")'=+TIUSIG("AUTHOR"))  D
"RTN","TIUPRPN8",43,0)
 . N TIUSIGTL
"RTN","TIUPRPN8",44,0)
 . W !?34,"for ",$P(TIUSIG("AUTHOR"),";",2)
"RTN","TIUPRPN8",45,0)
 . S TIUSIGTL=$$GET1^DIQ(200,$P(TIUSIG("AUTHOR"),";",1),20.3)
"RTN","TIUPRPN8",46,0)
 . I $D(TIUSIGTL) D
"RTN","TIUPRPN8",47,0)
 . . N TIUFT
"RTN","TIUPRPN8",48,0)
 . . D WRAP^TIUFLD(TIUSIGTL,45)
"RTN","TIUPRPN8",49,0)
 . . W !?34,$G(TIUFT(1))
"RTN","TIUPRPN8",50,0)
 . . W !?39,$G(TIUFT(2))
"RTN","TIUPRPN8",51,0)
 I $G(@TIUROOT@(.05,"E"))="UNCOSIGNED" D
"RTN","TIUPRPN8",52,0)
 . W !?34,"**REQUIRES COSIGNATURE**",!
"RTN","TIUPRPN8",53,0)
 ;I +$G(TIUADD) S TIUGROOT=$NA(^TMP("TIULQ",$J,TIUDA,"ZADD",TIUADD))
"RTN","TIUPRPN8",54,0)
 I +$D(@TIUROOT@("EXTRASGNR")) D  Q:'TIUCONT  ;**100** added the quit
"RTN","TIUPRPN8",55,0)
 . N TIUI S TIUI=0
"RTN","TIUPRPN8",56,0)
 . S TIUCONT=$$SETCONT^TIUPRPN1(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN8",57,0)
 . F  S TIUI=$O(@TIUROOT@("EXTRASGNR",TIUI)) Q:'TIUI  D
"RTN","TIUPRPN8",58,0)
 . . W !!?4,"Receipt Acknowledged By:"
"RTN","TIUPRPN8",59,0)
 . . ;VMP/ELR P224 ADDED code to print awaiting signature and expected additional signer name
"RTN","TIUPRPN8",60,0)
 . . I +$G(@TIUROOT@("EXTRASGNR",TIUI,"DATE"))'>0 D  Q
"RTN","TIUPRPN8",61,0)
 . . . W !,?4,"* AWAITING SIGNATURE *",?30,$G(@TIUROOT@("EXTRASGNR",TIUI,"EXPNAME"))
"RTN","TIUPRPN8",62,0)
 . . I TIUI>1 S TIUCONT=$$SETCONT^TIUPRPN1(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN8",63,0)
 . . W !?29,"/es/ ",$G(@TIUROOT@("EXTRASGNR",TIUI,"NAME"))
"RTN","TIUPRPN8",64,0)
 . . I $L($G(@TIUROOT@("EXTRASGNR",TIUI,"TITLE")))>45 D
"RTN","TIUPRPN8",65,0)
 . . . N TIUFT
"RTN","TIUPRPN8",66,0)
 . . . D WRAP^TIUFLD($G(@TIUROOT@("EXTRASGNR",TIUI,"TITLE")),45)
"RTN","TIUPRPN8",67,0)
 . . . W !?34,$G(TIUFT(1))
"RTN","TIUPRPN8",68,0)
 . . . W !?39,$G(TIUFT(2))
"RTN","TIUPRPN8",69,0)
 . . I $L($G(@TIUROOT@("EXTRASGNR",TIUI,"TITLE")))<46 W !?34,$G(@TIUROOT@("EXTRASGNR",TIUI,"TITLE"))
"RTN","TIUPRPN8",70,0)
 . . I $G(@TIUROOT@("EXTRASGNR",TIUI,"EXTRA")),$G(@TIUROOT@("EXTRASGNR",TIUI,"EXPIEN"))'=$G(@TIUROOT@("EXTRASGNR",TIUI,"EXTRA")) D
"RTN","TIUPRPN8",71,0)
 . . . W !?30,"for ",$P($G(@TIUROOT@("EXTRASGNR",TIUI,"EXPNAME")),",",2)
"RTN","TIUPRPN8",72,0)
 . . . W " ",$P($G(@TIUROOT@("EXTRASGNR",TIUI,"EXPNAME")),",")
"RTN","TIUPRPN8",73,0)
 . . W !?34,$$DATE^TIULS($G(@TIUROOT@("EXTRASGNR",TIUI,"DATE")),"MM/DD/CCYY HR:MIN")
"RTN","TIUPRPN8",74,0)
 . . I '+$G(TIUFLAG)!($E(IOST)="C-") D
"RTN","TIUPRPN8",75,0)
 . . . N BEEP
"RTN","TIUPRPN8",76,0)
 . . . S BEEP=$$BEEP^TIULC1(+$G(@TIUROOT@("EXTRASGNR",TIUI,"EXTRA")))
"RTN","TIUPRPN8",77,0)
 . . . I +BEEP W !?34,"Analog Pager:  ",$P(BEEP,U)
"RTN","TIUPRPN8",78,0)
 . . . I +$P(BEEP,U,2) W !?34,"Digital Pager: ",$P(BEEP,U,2)
"RTN","TIUPRPN8",79,0)
 . ;K @TIUROOT@("EXTRASGNR") ;**100** commented out
"RTN","TIUPRPN8",80,0)
 ;I +TIUSIG("COSGDATE"),(+TIUSIG("COSGEDBY")'=+TIUSIG("SIGNEDBY")) D  Q:'TIUCONT
"RTN","TIUPRPN8",81,0)
 I +TIUSIG("COSGDATE") D  Q:'TIUCONT
"RTN","TIUPRPN8",82,0)
 . S TIUCONT=$$SETCONT^TIUPRPN1(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN8",83,0)
 . W !!?16,"Cosigned by:",$S($P(TIUSIG("COSGMODE"),";")="C":" /s/  ",1:" /es/ "),?34,$S(TIUSIG("COSGNAME")]"":TIUSIG("COSGNAME"),1:$P(TIUSIG("COSGEDBY"),";",2))
"RTN","TIUPRPN8",84,0)
 . I $L(TIUSIG("COSGTITL"))>45 D
"RTN","TIUPRPN8",85,0)
 . . N TIUFT
"RTN","TIUPRPN8",86,0)
 . . D WRAP^TIUFLD(TIUSIG("COSGTITL"),45)
"RTN","TIUPRPN8",87,0)
 . . W !?34,$G(TIUFT(1))
"RTN","TIUPRPN8",88,0)
 . . W !?39,$G(TIUFT(2))
"RTN","TIUPRPN8",89,0)
 . I $L(TIUSIG("COSGTITL"))<46 W !?34,TIUSIG("COSGTITL")
"RTN","TIUPRPN8",90,0)
 . W !?34,$$DATE^TIULS(+TIUSIG("COSGDATE"),"MM/DD/CCYY HR:MIN")
"RTN","TIUPRPN8",91,0)
 . I '+$G(TIUFLAG)!($E(IOST)="C-") D
"RTN","TIUPRPN8",92,0)
 . . I $P($$BEEP^TIULC1(+TIUSIG("COSGEDBY")),U) W !?34,"Analog Pager: ",$P($$BEEP^TIULC1(+TIUSIG("COSGEDBY")),U)
"RTN","TIUPRPN8",93,0)
 . . I $P($$BEEP^TIULC1(+TIUSIG("COSGEDBY")),U,2) W !?34,"Digital Pager: ",$P($$BEEP^TIULC1(+TIUSIG("COSGEDBY")),U,2)
"RTN","TIUPRPN8",94,0)
 ;I +TIUSIG("COSCHRT"),$P(TIUSIG("COSGMODE"),";")="C" D  Q:'TIUCONT
"RTN","TIUPRPN8",95,0)
 I $P(TIUSIG("COSGMODE"),";")="C" D  Q:'TIUCONT
"RTN","TIUPRPN8",96,0)
 . S TIUCONT=$$SETCONT^TIUPRPN1(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT)) Q:'TIUCONT
"RTN","TIUPRPN8",97,0)
 . W !,"Marked cosigned on chart by:",?34,$P(TIUSIG("COSCHRT"),";",2)
"RTN","TIUPRPN8",98,0)
 W !
"RTN","TIUPRPN8",99,0)
 ;K TIUCONT1 ; kills the cont on next page msgs since no longer in middle
"RTN","TIUPRPN8",100,0)
 ;of a note.  **100** moved down to amend code
"RTN","TIUPRPN8",101,0)
AMEND ; signature blocks of amender
"RTN","TIUPRPN8",102,0)
 ;N TIUY S TIUY=4 ;I don't think we need TIUY anymore **100**
"RTN","TIUPRPN8",103,0)
 I '$G(@TIUROOT@(1601,"I")) K TIUCONT1 Q
"RTN","TIUPRPN8",104,0)
 S TIUCONT=$$SETCONT^TIUPRPN1(.TIUFOOT,TIUMISC,TIUCONT1,0,$G(TIUROOT))
"RTN","TIUPRPN8",105,0)
 K TIUCONT1 Q:'TIUCONT
"RTN","TIUPRPN8",106,0)
 I +$G(@TIUROOT@(1601,"I")) D
"RTN","TIUPRPN8",107,0)
 . W !!?12,"Amendment Filed:",?34,$$DATE^TIULS(@TIUROOT@(1601,"I"),"MM/DD/CCYY HR:MIN")
"RTN","TIUPRPN8",108,0)
 . I $G(@TIUROOT@(1603,"E"))']"" D
"RTN","TIUPRPN8",109,0)
 . . W !!?29 F TIUI=1:1:40 W "_"
"RTN","TIUPRPN8",110,0)
 . . W !?29,$$SIGNAME^TIULS(@TIUROOT@(1602,"I"))
"RTN","TIUPRPN8",111,0)
 . . W !?29,$$SIGTITL^TIULS(@TIUROOT@(1602,"I"))
"RTN","TIUPRPN8",112,0)
 . I $G(@TIUROOT@(1604,"E"))]"" D
"RTN","TIUPRPN8",113,0)
 . . W !?29,"/es/",?34,@TIUROOT@(1604,"E")
"RTN","TIUPRPN8",114,0)
 . . W !?34,@TIUROOT@(1605,"E")
"RTN","TIUPRPN8",115,0)
 Q
"RTN","TIUPRPN8",116,0)
 ;
"RTN","TIUR")
0^1^B40522374^B39996639
"RTN","TIUR",1,0)
TIUR ; SLC/JER - Integrated Document Review ;11/01/03
"RTN","TIUR",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**74,79,58,100,113,112,207,224**;Jun 20, 1997;Build 7
"RTN","TIUR",3,0)
 ; 11/30/00 Moved PUTLIST & ADDELMNT to TIUR1
"RTN","TIUR",4,0)
MAKELIST(TIUCLASS,TIUCHVW) ; Get Search Criteria
"RTN","TIUR",5,0)
 N DIRUT,DTOUT,DUOUT,TIUI,SCREEN,STATUS,TIUTYP,TIUSTAT,TIUEDFLT,TIUDCL
"RTN","TIUR",6,0)
 N TIUDPRMT,TIUPICT,TIUOUT,STATWORD,STATIFN,NOWFLAG,TIUSC207,TIU1DOC
"RTN","TIUR",7,0)
 K DIROUT
"RTN","TIUR",8,0)
 D INITRR^TIULRR(0)
"RTN","TIUR",9,0)
 ;  TIURPN used in Order Entry 2.5, OR OE/RR MENU CLIN:
"RTN","TIUR",10,0)
 I +$G(ORVP),(+$G(TIUCHVW)'>0) D EN^TIURPN(TIUCLASS,+ORVP) Q
"RTN","TIUR",11,0)
STATUS S STATUS=$$STAT
"RTN","TIUR",12,0)
 ;VMP/ELR changed status ck from <0 TO <1 to account for entering an *  p224
"RTN","TIUR",13,0)
 I +STATUS<1 S VALMQUIT=1 Q
"RTN","TIUR",14,0)
 S TIUI=0
"RTN","TIUR",15,0)
 F  S TIUI=$O(TIUSTAT(TIUI)) Q:'TIUI!(+$G(TIUOUT))  D
"RTN","TIUR",16,0)
 . I $P($G(TIUSTAT(TIUI)),U,3)="" S TIUOUT=1 Q
"RTN","TIUR",17,0)
 . S STATIFN=$O(^TIU(8925.6,"B",$$UPPER^TIULS($P(TIUSTAT(TIUI),U,3)),0))
"RTN","TIUR",18,0)
 . Q:'STATIFN
"RTN","TIUR",19,0)
 . S STATUS("IFNS")=$G(STATUS("IFNS"))_STATIFN_";"
"RTN","TIUR",20,0)
 I +$G(TIUOUT) S VALMQUIT=1 Q
"RTN","TIUR",21,0)
 S TIUI=1,STATWORD=$$UPPER^TIULS($P(TIUSTAT(1),U,3))
"RTN","TIUR",22,0)
 I +$G(TIUSTAT(4))'>0 F  S TIUI=$O(TIUSTAT(TIUI)) Q:+TIUI'>0  D
"RTN","TIUR",23,0)
 . S STATWORD=STATWORD_$S(TIUI=+TIUSTAT(1):" & ",1:", ")_$$UPPER^TIULS($P(TIUSTAT(TIUI),U,3))
"RTN","TIUR",24,0)
 I +$G(TIUSTAT(4))>0 S STATWORD=$S($P(TIUSTAT(4),U,4)="ALL":"ALL",1:STATWORD_", OTHER")
"RTN","TIUR",25,0)
 S STATUS("WORDS")=STATWORD
"RTN","TIUR",26,0)
DOCTYPE ; Select Document Type(s)
"RTN","TIUR",27,0)
 ; TIU207-If only 1 docytyp and have been to screen prompt then go back another level to avoid loop with next prompt.
"RTN","TIUR",28,0)
 I $G(TIUSC207)=1,$G(TIU1DOC)=1 D  G STATUS
"RTN","TIUR",29,0)
 .S (TIUSC207,TIU1DOC)=0
"RTN","TIUR",30,0)
 S (TIUSC207,TIU1DOC)=0
"RTN","TIUR",31,0)
 N TIUDCL K TIUPICT
"RTN","TIUR",32,0)
 I $S(('$D(TIUQUIK)&'$D(ORVP)):1,($D(ORVP)&+$G(TIUCHVW)):1,1:0) D SELTYP^TIULA(TIUCLASS,.TIUTYP,"A","LAST","DOC",0,.TIUDCL,.TIUPICT)
"RTN","TIUR",33,0)
 S TIU1DOC=+$P($G(^TIU(8925.1,+TIUCLASS,10,0)),U,3)
"RTN","TIUR",34,0)
 ; SELTYP sets array ^TMP("TIUTYP",$J);
"RTN","TIUR",35,0)
 ; SELTYP used to set data into TIUTYP array
"RTN","TIUR",36,0)
 ; Now TIUTYP just ="^TMP("TIUTYP",$J)"
"RTN","TIUR",37,0)
 I $S($D(TIUQUIK):1,($D(ORVP)&'+$G(TIUCHVW)):1,1:0) D SELTYP^TIULA(TIUCLASS,.TIUTYP,"F","ALL","DOC",0)
"RTN","TIUR",38,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIUR",39,0)
 I +$G(@TIUTYP)'>0,'$D(TIUQUIK) G STATUS
"RTN","TIUR",40,0)
SCREEN ;
"RTN","TIUR",41,0)
 S TIUSC207=1
"RTN","TIUR",42,0)
 N TIUNAME,TIUOVER
"RTN","TIUR",43,0)
 S TIUNAME=$P($G(^VA(200,+DUZ,0)),U)
"RTN","TIUR",44,0)
 I $D(TIUQUIK) D  I 1 ; all my unsigned TIUQUIK=1
"RTN","TIUR",45,0)
 . I $G(TIUQUIK)=3 S SCREEN(1)="ALL^ANY" Q
"RTN","TIUR",46,0)
 . S SCREEN(1)="AAU^"_DUZ_U_TIUNAME
"RTN","TIUR",47,0)
 . S:$G(TIUQUIK)=1 SCREEN(2)="ASUP^"_DUZ
"RTN","TIUR",48,0)
 . S SCREEN="ALL"
"RTN","TIUR",49,0)
 E  I $D(ORVP),'+$G(TIUCHVW) S SCREEN(1)="APT^"_+ORVP_U_$P($G(^DPT(+ORVP,0)),U) I 1
"RTN","TIUR",50,0)
 S TIUOVER=""
"RTN","TIUR",51,0)
 E  D SELCAT^TIULA1(.SCREEN,"A","AUTHOR",.TIUOVER)
"RTN","TIUR",52,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIUR",53,0)
 I $D(SCREEN)'>9 K @TIUTYP G DOCTYPE
"RTN","TIUR",54,0)
 I $D(@TIUTYP)'>9 W !,$C(7),"You must select one or more TITLES..." G SCREEN
"RTN","TIUR",55,0)
 I $G(SCREEN(1))="ALL^ANY",+$G(ORVP) S SCREEN(1)="APT^"_+$G(ORVP)_U_$P($G(^DPT(+$G(ORVP),0)),U)
"RTN","TIUR",56,0)
 D CHECKADD
"RTN","TIUR",57,0)
ERLY S TIUEDFLT=$S(TIUCLASS=3:"T-2",TIUCLASS=244:"T-30",1:"T-7")
"RTN","TIUR",58,0)
 S TIUDPRMT=$S(TIUCLASS=244:"Discharge",1:"Reference")
"RTN","TIUR",59,0)
 S TIUEDT=$S($D(TIUQUIK):1,$D(ORVP)&(+$G(TIUCHVW)'>0):$$FMADD^XLFDT(DT,$S($D(^DPT(+$G(ORVP),.1))'>0:-180,1:-30)),1:$P($$EDATE^TIULA(TIUDPRMT,"",TIUEDFLT),U))
"RTN","TIUR",60,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIUR",61,0)
 I TIUEDT'>0 G SCREEN
"RTN","TIUR",62,0)
 S TIULDT=$S($D(TIUQUIK):9999999,$D(ORVP)&(+$G(TIUCHVW)'>0):+$$NOW^XLFDT,1:$P($$LDATE^TIULA(TIUDPRMT),U))
"RTN","TIUR",63,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIUR",64,0)
 I TIULDT'>0 G ERLY
"RTN","TIUR",65,0)
 I TIUEDT>TIULDT D SWAP(.TIUEDT,.TIULDT)
"RTN","TIUR",66,0)
 I $L(TIULDT,".")=1 D EXPRANGE(.TIUEDT,.TIULDT)
"RTN","TIUR",67,0)
 ; -- Reset late date to NOW on rebuild:
"RTN","TIUR",68,0)
 S NOWFLAG=$S(TIULDT-$$NOW^XLFDT<.0001:1,1:0)
"RTN","TIUR",69,0)
 I '$G(TIURBLD) W !,"Searching for the documents."
"RTN","TIUR",70,0)
 D BUILD(TIUCLASS,.STATUS,.SCREEN,TIUEDT,TIULDT,NOWFLAG) ;11/30/00 removed param TIUTYP since BUILD uses global now.
"RTN","TIUR",71,0)
 ; -- If attaching ID note & changed view,
"RTN","TIUR",72,0)
 ;    update video for line to be attached: --
"RTN","TIUR",73,0)
 I $G(TIUGLINK) D RESTOREG^TIULM(.TIUGLINK)
"RTN","TIUR",74,0)
 ;K @TIUTYP ;11/30/00 keep ^TMP("TIUTYP",$J) for rebuild
"RTN","TIUR",75,0)
 Q
"RTN","TIUR",76,0)
STAT() ; Determine status
"RTN","TIUR",77,0)
 N TIUY
"RTN","TIUR",78,0)
 I +$G(TIUQUIK) D  G STATX
"RTN","TIUR",79,0)
 . S TIUY=$$SELSTAT^TIULA(.TIUSTAT,"F",$S(TIUQUIK=1:"UNSIGNED,UNCOSIGNED",TIUQUIK>1:"UNDICTATED,UNTRANSCRIBED"))
"RTN","TIUR",80,0)
 I $D(ORVP),'+$G(TIUCHVW) D  G STATX
"RTN","TIUR",81,0)
 . S TIUY=$$SELSTAT^TIULA(.TIUSTAT,"F","COMPLETED")
"RTN","TIUR",82,0)
 S TIUY=$$SELSTAT^TIULA(.TIUSTAT,"A",$$DFLTSTAT^TIURM(DUZ))
"RTN","TIUR",83,0)
STATX Q TIUY
"RTN","TIUR",84,0)
CHECKADD ; Checks whether Addendum is included in the list of types
"RTN","TIUR",85,0)
 N TIUI,HIT,NUMTYPS
"RTN","TIUR",86,0)
 S (TIUI,HIT)=0
"RTN","TIUR",87,0)
 F  S TIUI=$O(^TMP("TIUTYP",$J,TIUI)) Q:+TIUI'>0!+HIT  I $$UP^XLFSTR(^TMP("TIUTYP",$J,TIUI))["ADDENDUM" S HIT=1
"RTN","TIUR",88,0)
 S NUMTYPS=^TMP("TIUTYP",$J)
"RTN","TIUR",89,0)
 I +HIT'>0 S ^TMP("TIUTYP",$J,NUMTYPS+1)=+^TMP("TIUTYP",$J,NUMTYPS)+1_U_"81^Addendum^NOT PICKED",^TMP("TIUTYP",$J)=^TMP("TIUTYP",$J)+1
"RTN","TIUR",90,0)
 Q
"RTN","TIUR",91,0)
 ;
"RTN","TIUR",92,0)
SWAP(TIUX,TIUY) ; Swap variables
"RTN","TIUR",93,0)
 N TIUTMP S TIUTMP=TIUX,TIUX=TIUY,TIUY=TIUTMP
"RTN","TIUR",94,0)
 Q
"RTN","TIUR",95,0)
EXPRANGE(TIUX,TIUY) ; Expand late date to include time
"RTN","TIUR",96,0)
 ;P74 If user entered date/time = T, then numerical date time is FIRST ^ PIECE ONLY of TIUX & TIUY.
"RTN","TIUR",97,0)
 I $P(TIUY,U)=DT S TIUY=$$NOW^XLFDT I 1
"RTN","TIUR",98,0)
 E  S TIUY=$P(TIUY,U)_"."_235959 ;P74 Add seconds
"RTN","TIUR",99,0)
 Q
"RTN","TIUR",100,0)
BUILD(TIUCLASS,STATUS,SCREEN,EARLY,LATE,NOWFLAG) ; Build List.
"RTN","TIUR",101,0)
 ;11/30/00 - removed param TYPES. 12/3 added param TIUCLASS
"RTN","TIUR",102,0)
 ; BUILD (GATHER) uses docmt type info from ^TMP("TIUTYP",$J)
"RTN","TIUR",103,0)
 N TIUDT,TIUI,TIUK
"RTN","TIUR",104,0)
 N TIUT,TIUTP,XREF,TIUS,TIUPREF
"RTN","TIUR",105,0)
 S TIUPREF=$$PERSPRF^TIULE(DUZ),(TIUK,VALMCNT)=0
"RTN","TIUR",106,0)
 K ^TMP("TIUR",$J),^TMP("TIURIDX",$J),^TMP("TIUI",$J)
"RTN","TIUR",107,0)
 ; If user entered NOW at first build, update NOW for rebuild;
"RTN","TIUR",108,0)
 ; Save data in ^TMP("TIURIDX",$J,0) for rebuild:
"RTN","TIUR",109,0)
 I $G(TIURBLD),$G(NOWFLAG) S LATE=$$NOW^XLFDT
"RTN","TIUR",110,0)
 S ^TMP("TIURIDX",$J,0)=+EARLY_U_+LATE_U_$G(STATUS("IFNS"))_U_NOWFLAG
"RTN","TIUR",111,0)
 S ^TMP("TIUR",$J,"RTN")="TIUR"
"RTN","TIUR",112,0)
 S ^TMP("TIUR",$J,"TITLE OVERRIDE")=$G(TIUOVER)
"RTN","TIUR",113,0)
 I '$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIUR",114,0)
 S EARLY=9999999-+$G(EARLY),LATE=9999999-$S(+$G(LATE):+$G(LATE),1:3333333)
"RTN","TIUR",115,0)
 F  S TIUK=$O(SCREEN(TIUK)) Q:TIUK'>0  D
"RTN","TIUR",116,0)
 . I $G(SCREEN)'="ALL" S SCREEN=$G(TIUK)
"RTN","TIUR",117,0)
 . S XREF=$P(SCREEN(TIUK),U)
"RTN","TIUR",118,0)
 . I XREF'="ASUB" D
"RTN","TIUR",119,0)
 . . S TIUI=$S(XREF'="APRB":$P(SCREEN(TIUK),U,2),1:$$UPPER^TIULS($P(SCREEN(TIUK),U,3)))
"RTN","TIUR",120,0)
 . . D GATHER^TIUR1(TIUI,TIUPREF,TIUCLASS,STATUS("IFNS"),EARLY,LATE,XREF,SCREEN)
"RTN","TIUR",121,0)
 . I XREF="ASUB" D
"RTN","TIUR",122,0)
 . . S TIUI=$O(^TIU(8925,XREF,$P(SCREEN(TIUK),U,2)),-1)
"RTN","TIUR",123,0)
 . . F  S TIUI=$O(^TIU(8925,XREF,TIUI)) Q:TIUI=""!(TIUI'[$P(SCREEN(TIUK),U,2))  D GATHER^TIUR1(TIUI,TIUPREF,TIUCLASS,STATUS("IFNS"),EARLY,LATE,XREF,SCREEN)
"RTN","TIUR",124,0)
 D PUTLIST^TIUR2(TIUPREF,TIUCLASS,.STATUS,.SCREEN)
"RTN","TIUR",125,0)
 K ^TMP("TIUI",$J)
"RTN","TIUR",126,0)
 Q
"RTN","TIUR",127,0)
 ;
"RTN","TIUR",128,0)
CLEAN ; Clean up your mess!
"RTN","TIUR",129,0)
 K ^TMP("TIUR",$J),^TMP("TIURIDX",$J) D CLEAN^VALM10,KILLRR^TIULRR
"RTN","TIUR",130,0)
 K VALMY
"RTN","TIUR",131,0)
 K ^TMP("TIUTYP",$J)
"RTN","TIUR",132,0)
 Q
"RTN","TIUR",133,0)
 ;
"RTN","TIUR",134,0)
RBLD ; Rebuild list after actions 11/30/00
"RTN","TIUR",135,0)
 N TIUEXP,TIUR0,TIURIDX0,TIUSCRN,TMP,TIUEDT,TIULDT,TIUSTAT
"RTN","TIUR",136,0)
 N TIURBLD,TIUI,TIUCLASS,NOWFLAG
"RTN","TIUR",137,0)
 S TIURBLD=1
"RTN","TIUR",138,0)
 D FIXLSTNW^TIULM ;restore video for elements added to end of list
"RTN","TIUR",139,0)
 I +$O(^TMP("TIUR",$J,"EXPAND",0)) D
"RTN","TIUR",140,0)
 . M TIUEXP=^TMP("TIUR",$J,"EXPAND")
"RTN","TIUR",141,0)
 S TIUR0=^TMP("TIUR",$J,0),TIURIDX0=^TMP("TIURIDX",$J,0)
"RTN","TIUR",142,0)
 S TIUSCRN=$P(TIUR0,U,3,99),TIUCLASS=^TMP("TIUR",$J,"CLASS")
"RTN","TIUR",143,0)
 S TIUI=1
"RTN","TIUR",144,0)
 F  S TMP=$P(TIUSCRN,";",TIUI) Q:TMP=""  D
"RTN","TIUR",145,0)
 . S TIUSCRN(TIUI)=TMP,TIUI=TIUI+1
"RTN","TIUR",146,0)
 S TIUSCRN=$L(TIUSCRN,";")
"RTN","TIUR",147,0)
 S STATUS("WORDS")=$P(TIUR0,U,2)
"RTN","TIUR",148,0)
 S STATUS("IFNS")=$P(TIURIDX0,U,3)
"RTN","TIUR",149,0)
 S TIUEDT=$P(TIURIDX0,U),TIULDT=$P(TIURIDX0,U,2),NOWFLAG=+$P(TIURIDX0,U,4)
"RTN","TIUR",150,0)
 ;VMP/ELR ADDED THE FOLLOWING LINE IN PATCH 224
"RTN","TIUR",151,0)
 S TIUSCRN="ALL"
"RTN","TIUR",152,0)
 D BUILD(TIUCLASS,.STATUS,.TIUSCRN,TIUEDT,TIULDT,NOWFLAG)
"RTN","TIUR",153,0)
 ; Reexpand previously expanded items:
"RTN","TIUR",154,0)
 D RELOAD^TIUROR1(.TIUEXP)
"RTN","TIUR",155,0)
 D BREATHE^TIUROR1(1)
"RTN","TIUR",156,0)
 Q
"RTN","TIURL")
0^5^B17883225^B16440544
"RTN","TIURL",1,0)
TIURL ; SLC/JER - List Management Library ;2/21/01
"RTN","TIURL",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**88,100,224**;Jun 20, 1997;Build 7
"RTN","TIURL",3,0)
 ; 11/14/00 Moved UPDATEID, etc to TIURL1
"RTN","TIURL",4,0)
 ;
"RTN","TIURL",5,0)
UPRBLD(TIUCHNG,ITEMS) ; Refreshes, updates, or rebuilds the list
"RTN","TIURL",6,0)
 ;after various actions. Also restores video.
"RTN","TIURL",7,0)
 ; Receives optional arrays TIUCHNG, ITEMS by ref.
"RTN","TIURL",8,0)
 ; Checks TIUCHNG("RBLD"),TIUCHNG("UPDATE"), & TIUCHNG("REFRESH");
"RTN","TIURL",9,0)
 ;does nothing if none of these is defined.
"RTN","TIURL",10,0)
 ; Items in ITEMS list are updated (depending on TIUCHNG), and
"RTN","TIURL",11,0)
 ;their video attributes are restored.
"RTN","TIURL",12,0)
 N TIUI,TIUREC,TIUJ,RTN
"RTN","TIURL",13,0)
 S RTN=$G(^TMP("TIUR",$J,"RTN"))
"RTN","TIURL",14,0)
 ; -- Restore video attributes for selected items:
"RTN","TIURL",15,0)
 ;    (Rebuild code, except for TIUROR, does its own video restore)
"RTN","TIURL",16,0)
 I '$G(TIUCHNG("RBLD"))!(RTN="TIUROR") D
"RTN","TIURL",17,0)
 . S TIUJ=0
"RTN","TIURL",18,0)
 . F  S TIUJ=$O(ITEMS(TIUJ)) Q:'TIUJ  D
"RTN","TIURL",19,0)
 . . Q:TIUJ=$P($G(TIUGLINK),U,2)  ; Don't restore midattach ID child
"RTN","TIURL",20,0)
 . . D RESTORE^VALM10(TIUJ)
"RTN","TIURL",21,0)
 ; -- If TIUROR screen needs changes, it is always
"RTN","TIURL",22,0)
 ;    rebuilt, not updated:
"RTN","TIURL",23,0)
 I RTN="TIUROR",$G(TIUCHNG("UPDATE")) S TIUCHNG("RBLD")=1
"RTN","TIURL",24,0)
 ;VMP/ELR ADDED THE FOLLOWING 2 LINES IN PATCH 224
"RTN","TIURL",25,0)
 I RTN="TIUR",$G(TIUCHNG("UPDATE")) S TIUCHNG("RBLD")=1
"RTN","TIURL",26,0)
 I RTN="TIURM",$G(TIUCHNG("UPDATE")) S TIUCHNG("RBLD")=1
"RTN","TIURL",27,0)
 ; -- Rebuild, Update, or Refresh list:
"RTN","TIURL",28,0)
 ;    (In cases (e.g.browse) where more than one action
"RTN","TIURL",29,0)
 ;    was performed, TIUCHNG("RBLD") may coexist w TIUCHNG("UPDATE"),
"RTN","TIURL",30,0)
 ;    etc., so order is important.)
"RTN","TIURL",31,0)
 I $G(TIUCHNG("RBLD")) D  Q
"RTN","TIURL",32,0)
 . W !,"Rebuilding the list..."
"RTN","TIURL",33,0)
 . I RTN="TIUROR" D RBLD^TIUROR Q
"RTN","TIURL",34,0)
 . ; -- If not in 2b, pause for feedback ("Rebuilding",
"RTN","TIURL",35,0)
 . ;    "Entry deleted", etc):
"RTN","TIURL",36,0)
 . H 2
"RTN","TIURL",37,0)
 . I RTN="TIURM" D RBLD^TIURM Q
"RTN","TIURL",38,0)
 . I RTN="TIURPTTL" D RBLD^TIURPTTL Q
"RTN","TIURL",39,0)
 . I RTN="TIURTITL" D RBLD^TIURTITL Q
"RTN","TIURL",40,0)
 . I RTN="TIUR" D RBLD^TIUR
"RTN","TIURL",41,0)
 I $G(TIUCHNG("UPDATE")),$D(ITEMS) D  Q
"RTN","TIURL",42,0)
 . S TIUI=""
"RTN","TIURL",43,0)
 . W !,"Updating the list..."
"RTN","TIURL",44,0)
 . F  S TIUI=$O(ITEMS(TIUI)) Q:'TIUI  D
"RTN","TIURL",45,0)
 . . D SETREC(TIUI,.TIUREC)
"RTN","TIURL",46,0)
 . . ;VMP/ELR ADDED THE FOLLOWING LINE IN PATCH 224
"RTN","TIURL",47,0)
 . . I $G(TIUREC)="" Q
"RTN","TIURL",48,0)
 . . S ^TMP("TIUR",$J,TIUI,0)=TIUREC
"RTN","TIURL",49,0)
 I $G(TIUCHNG("REFRESH")) D  Q
"RTN","TIURL",50,0)
 . W !,"Refreshing the list..."
"RTN","TIURL",51,0)
 Q
"RTN","TIURL",52,0)
 ;
"RTN","TIURL",53,0)
SETREC(LINENO,TIUREC,PFIXFLAG) ; Update line LINENO with [new prefix], new flds
"RTN","TIURL",54,0)
 ; Combined fields so that SETREC works for MIS as well as
"RTN","TIURL",55,0)
 ;CLINICIAN LM templates
"RTN","TIURL",56,0)
 ; PFIXFLAG=1: update prefix (as well as other flds).
"RTN","TIURL",57,0)
 ; New prefix is for unexpanded state of line.
"RTN","TIURL",58,0)
 N DIC,DIQ,DA,DR,TIUR,ADT,DDT,LCT,AUT,AMD,EDT,SDT,TIULST4
"RTN","TIURL",59,0)
 N MOM,DOC,MISEDT,ITEMNODE
"RTN","TIURL",60,0)
 S ITEMNODE=^TMP("TIURIDX",$J,LINENO)
"RTN","TIURL",61,0)
 S DA=+$P(ITEMNODE,U,2)
"RTN","TIURL",62,0)
 S DIQ="TIUR",DIC=8925,DIQ(0)="IE"
"RTN","TIURL",63,0)
 S DR=".01;.02;.05;.07;.08;.1;1202;1204;1208;1209;1301;1307;1501;1507"
"RTN","TIURL",64,0)
 D EN^DIQ1 Q:$D(TIUR)'>9
"RTN","TIURL",65,0)
 S DOC=$$PNAME^TIULC1(+TIUR(8925,DA,.01,"I"))
"RTN","TIURL",66,0)
 I DOC="Addendum" D
"RTN","TIURL",67,0)
 . S MOM=+$P(^TIU(8925,DA,0),U,6)
"RTN","TIURL",68,0)
 . S DOC=DOC_" to "_$$PNAME^TIULC1(+$G(^TIU(8925,MOM,0)))
"RTN","TIURL",69,0)
 S TIULST4=$E($P($G(^DPT(TIUR(8925,DA,.02,"I"),0)),U,9),6,9)
"RTN","TIURL",70,0)
 S TIULST4="("_$E(TIUR(8925,DA,.02,"E"))_TIULST4_")"
"RTN","TIURL",71,0)
 S ADT=$$DATE^TIULS(TIUR(8925,DA,.07,"I"),"MM/DD/YY")
"RTN","TIURL",72,0)
 S DDT=$$DATE^TIULS(TIUR(8925,DA,.08,"I"),"MM/DD/YY")
"RTN","TIURL",73,0)
 S AMD=$$NAME^TIULS(TIUR(8925,DA,1208,"E"),"LAST, FI MI")
"RTN","TIURL",74,0)
 S AUT=$$NAME^TIULS(TIUR(8925,DA,1202,"E"),"LAST, FI MI")
"RTN","TIURL",75,0)
 S EDT=$$DATE^TIULS(TIUR(8925,DA,1301,"I"),"MM/DD/YY")
"RTN","TIURL",76,0)
 S MISEDT=$$DATE^TIULS(TIUR(8925,DA,1307,"I"),"MM/DD/YY")
"RTN","TIURL",77,0)
 S SDT=$S(+TIUR(8925,DA,1507,"I"):TIUR(8925,DA,1507,"I"),TIUR(8925,DA,.05,"I")'<7:+TIUR(8925,DA,1501,"I"),1:"")
"RTN","TIURL",78,0)
 S SDT=$$DATE^TIULS(SDT,"MM/DD/YY")
"RTN","TIURL",79,0)
 S LCT=$G(TIUR(8925,DA,.1,"E"))
"RTN","TIURL",80,0)
 ; -- Set prefix_patient/title into ^TMP("TIUR",$J,LINENO,0),
"RTN","TIURL",81,0)
 ;    then into TIUREC: --
"RTN","TIURL",82,0)
 I $G(PFIXFLAG) D SETPT^TIURL1(LINENO)
"RTN","TIURL",83,0)
 S TIUREC=^TMP("TIUR",$J,LINENO,0)
"RTN","TIURL",84,0)
 ; -- Set other fields into TIUREC: --
"RTN","TIURL",85,0)
 S TIUREC=$$SETFLD^VALM1(LINENO,TIUREC,"NUMBER")
"RTN","TIURL",86,0)
 S TIUREC=$$SETFLD^VALM1($$LOWER^TIULS(TIUR(8925,DA,.05,"E")),TIUREC,"STATUS")
"RTN","TIURL",87,0)
 S TIUREC=$$SETFLD^VALM1(TIULST4,TIUREC,"LAST I/LAST 4")
"RTN","TIURL",88,0)
 S TIUREC=$$SETFLD^VALM1(DOC,TIUREC,"DOCUMENT TYPE")
"RTN","TIURL",89,0)
 S:$D(VALMDDF("ADMISSION DATE")) TIUREC=$$SETFLD^VALM1(ADT,TIUREC,"ADMISSION DATE")
"RTN","TIURL",90,0)
 S:$D(VALMDDF("DISCH DATE")) TIUREC=$$SETFLD^VALM1(AMD,TIUREC,"DISCH DATE")
"RTN","TIURL",91,0)
 S:$D(VALMDDF("DICT DATE")) TIUREC=$$SETFLD^VALM1(MISEDT,TIUREC,"DICT DATE")
"RTN","TIURL",92,0)
 S:$D(VALMDDF("LINE COUNT")) TIUREC=$$SETFLD^VALM1(LCT,TIUREC,"LINE COUNT")
"RTN","TIURL",93,0)
 S:$D(VALMDDF("REF DATE")) TIUREC=$$SETFLD^VALM1(EDT,TIUREC,"REF DATE")
"RTN","TIURL",94,0)
 S:$D(VALMDDF("SIG DATE")) TIUREC=$$SETFLD^VALM1(SDT,TIUREC,"SIG DATE")
"RTN","TIURL",95,0)
 S TIUREC=$$SETFLD^VALM1(AUT,TIUREC,"AUTHOR")
"RTN","TIURL",96,0)
 S:$D(VALMDDF("COSIGNER")) TIUREC=$$SETFLD^VALM1(AMD,TIUREC,"COSIGNER")
"RTN","TIURL",97,0)
 S:$D(VALMDDF("ATTENDING")) TIUREC=$$SETFLD^VALM1(AMD,TIUREC,"ATTENDING")
"RTN","TIURL",98,0)
 S ^TMP("TIUR",$J,LINENO,0)=TIUREC
"RTN","TIURL",99,0)
 Q
"RTN","TIURM")
0^2^B24432420^B23965891
"RTN","TIURM",1,0)
TIURM ; SLC/JER - MIS Document Review ;9/24/03
"RTN","TIURM",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**74,79,58,100,113,216,224**;Jun 20, 1997;Build 7
"RTN","TIURM",3,0)
 ;12/7/00 split TIURM into TIURM & TIURM1
"RTN","TIURM",4,0)
MAKELIST(TIUCLASS) ; Get Search Criteria
"RTN","TIURM",5,0)
 N DIRUT,DTOUT,DUOUT,TIUI,STATUS,TIUTYP,TIUSTAT,TIUEDFLT,TIUDCL
"RTN","TIURM",6,0)
 N TIUDPRMT,STATWORD,STATIFN,NOWFLAG,TIUK
"RTN","TIURM",7,0)
 K DIROUT
"RTN","TIURM",8,0)
 D INITRR^TIULRR(0)
"RTN","TIURM",9,0)
DIVISION ; Select Division(s)
"RTN","TIURM",10,0)
 D SELDIV^TIULA
"RTN","TIURM",11,0)
 I SELDIV'>0 S VALMQUIT=1 Q
"RTN","TIURM",12,0)
 I $D(TIUDI) D
"RTN","TIURM",13,0)
 . S TIUK=0 F  S TIUK=$O(TIUDI(TIUK)) Q:'TIUK  D
"RTN","TIURM",14,0)
 . . S TIUDI("ENTRIES")=$G(TIUDI("ENTRIES"))_TIUK_";"
"RTN","TIURM",15,0)
 E  S TIUDI("ENTRIES")="ALL DIVISIONS"
"RTN","TIURM",16,0)
STATUS S STATUS=$S($D(TIUQUIK):$$SELSTAT^TIULA(.TIUSTAT,"F","UNSIGNED,UNCOSIGNED"),1:$$SELSTAT^TIULA(.TIUSTAT,"A",$$DFLTSTAT(DUZ)))
"RTN","TIURM",17,0)
 ;VMP/ELR changed status ck from <0 TO <1 to account for entering an *  p224
"RTN","TIURM",18,0)
 I +STATUS<1 S VALMQUIT=1 Q
"RTN","TIURM",19,0)
 S TIUI=0
"RTN","TIURM",20,0)
 F  S TIUI=$O(TIUSTAT(TIUI)) Q:'TIUI  D
"RTN","TIURM",21,0)
 . S STATIFN=$O(^TIU(8925.6,"B",$$UPPER^TIULS($P(TIUSTAT(TIUI),U,3)),0))
"RTN","TIURM",22,0)
 . Q:'STATIFN
"RTN","TIURM",23,0)
 . S STATUS("IFNS")=$G(STATUS("IFNS"))_STATIFN_";"
"RTN","TIURM",24,0)
 S TIUI=1,STATWORD=$$UPPER^TIULS($P(TIUSTAT(1),U,3))
"RTN","TIURM",25,0)
 I +$G(TIUSTAT(4))'>0 F  S TIUI=$O(TIUSTAT(TIUI)) Q:+TIUI'>0  D
"RTN","TIURM",26,0)
 . S STATWORD=STATWORD_$S(TIUI=+TIUSTAT(1):" & ",1:", ")_$$UPPER^TIULS($P(TIUSTAT(TIUI),U,3))
"RTN","TIURM",27,0)
 I +$G(TIUSTAT(4))>0 S STATWORD=$S($P(TIUSTAT(4),U,4)="ALL":"ALL",1:STATWORD_", OTHER")
"RTN","TIURM",28,0)
 S STATUS("WORDS")=STATWORD
"RTN","TIURM",29,0)
DOCTYPE ; Select Document Type(s)
"RTN","TIURM",30,0)
 N TIUDCL
"RTN","TIURM",31,0)
 ; -- Ask user for docmt types and set ^TMP("TIUTYP",$J):
"RTN","TIURM",32,0)
 D SELTYP^TIULA(TIUCLASS,.TIUTYP,"A","LAST","DOC",0,.TIUDCL)
"RTN","TIURM",33,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIURM",34,0)
 I +$G(@TIUTYP)'>0,'$D(TIUQUIK) K @TIUTYP G STATUS
"RTN","TIURM",35,0)
 D CHECKADD
"RTN","TIURM",36,0)
ERLY S TIUEDFLT=$S(TIUCLASS=3:"T-2",TIUCLASS=244:"T-30",1:"T-7")
"RTN","TIURM",37,0)
 S TIUDPRMT="Entry"
"RTN","TIURM",38,0)
 S TIUEDT=$S($D(TIUQUIK):1,1:$$EDATE^TIULA(TIUDPRMT,"",TIUEDFLT))
"RTN","TIURM",39,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIURM",40,0)
 I TIUEDT'>0 K @TIUTYP G DOCTYPE
"RTN","TIURM",41,0)
LATE S TIULDT=$S($D(TIUQUIK):9999999,1:$$LDATE^TIULA(TIUDPRMT))
"RTN","TIURM",42,0)
 I +$G(DIROUT) S VALMQUIT=1 Q
"RTN","TIURM",43,0)
 I TIULDT'>0 G ERLY
"RTN","TIURM",44,0)
 I TIUEDT>TIULDT D SWAP(.TIUEDT,.TIULDT)
"RTN","TIURM",45,0)
 I $L(TIULDT,".")=1 D EXPRANGE(.TIUEDT,.TIULDT) ; P74.  Add late date time whether or not late date is same as early date.
"RTN","TIURM",46,0)
 ; -- Reset late date to NOW on rebuild:
"RTN","TIURM",47,0)
 S NOWFLAG=$S(TIULDT-$$NOW^XLFDT<.0001:1,1:0)
"RTN","TIURM",48,0)
 I '$G(TIURBLD) W !,"Searching for the documents."
"RTN","TIURM",49,0)
 D BUILD(TIUCLASS,.STATUS,TIUEDT,TIULDT,NOWFLAG,.TIUDI)
"RTN","TIURM",50,0)
 ; -- If attaching ID note & changed view,
"RTN","TIURM",51,0)
 ;    update video for line to be attached: --
"RTN","TIURM",52,0)
 I $G(TIUGLINK) D RESTOREG^TIULM(.TIUGLINK)
"RTN","TIURM",53,0)
 K TIUDI,SELDIV
"RTN","TIURM",54,0)
 Q
"RTN","TIURM",55,0)
CHECKADD ; Checks whether Addendum is included in the list of types
"RTN","TIURM",56,0)
 N TIUI,HIT,NUMTYPS
"RTN","TIURM",57,0)
 S (TIUI,HIT)=0
"RTN","TIURM",58,0)
 F  S TIUI=$O(^TMP("TIUTYP",$J,TIUI)) Q:+TIUI'>0!+HIT  I $$UP^XLFSTR(^TMP("TIUTYP",$J,TIUI))["ADDENDUM" S HIT=1
"RTN","TIURM",59,0)
 S NUMTYPS=^TMP("TIUTYP",$J)
"RTN","TIURM",60,0)
 I +HIT'>0 S ^TMP("TIUTYP",$J,NUMTYPS+1)=+^TMP("TIUTYP",$J,NUMTYPS)+1_U_"81^Addendum^NOT PICKED",^TMP("TIUTYP",$J)=^TMP("TIUTYP",$J)+1
"RTN","TIURM",61,0)
 Q
"RTN","TIURM",62,0)
SWAP(TIUX,TIUY) ; Swap any two variables
"RTN","TIURM",63,0)
 N TIUTMP S TIUTMP=TIUX,TIUX=TIUY,TIUY=TIUTMP
"RTN","TIURM",64,0)
 Q
"RTN","TIURM",65,0)
EXPRANGE(TIUX,TIUY) ; Expand late date to include time
"RTN","TIURM",66,0)
 ;P74 If user entered date/time = T, then numerical date time is FIRST ^ PIECE ONLY of TIUX & TIUY.
"RTN","TIURM",67,0)
 I $P(TIUY,U)=DT S TIUY=$$NOW^XLFDT I 1
"RTN","TIURM",68,0)
 E  S TIUY=$P(TIUY,U)_"."_235959 ;P74 Add seconds
"RTN","TIURM",69,0)
 Q
"RTN","TIURM",70,0)
BUILD(TIUCLASS,STATUS,EARLY,LATE,NOWFLAG,TIUDI) ; Build List
"RTN","TIURM",71,0)
 N TIUPREF
"RTN","TIURM",72,0)
 S TIUPREF=$$PERSPRF^TIULE(DUZ)
"RTN","TIURM",73,0)
 K ^TMP("TIUR",$J),^TMP("TIURIDX",$J),^TMP("TIUI",$J)
"RTN","TIURM",74,0)
 ; If user entered NOW at first build, update NOW for rebuild;
"RTN","TIURM",75,0)
 ; Save data in ^TMP("TIURIDX",$J,0) for rebuild:
"RTN","TIURM",76,0)
 I $G(TIURBLD),$G(NOWFLAG) S LATE=$$NOW^XLFDT
"RTN","TIURM",77,0)
 S ^TMP("TIURIDX",$J,0)=+EARLY_U_+LATE_U_$G(STATUS("IFNS"))_U_NOWFLAG
"RTN","TIURM",78,0)
 S ^TMP("TIUR",$J,"RTN")="TIURM"
"RTN","TIURM",79,0)
 I '$D(TIUPRM0)!'$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIURM",80,0)
 S EARLY=+$G(EARLY,0),LATE=+$G(LATE,3333333)
"RTN","TIURM",81,0)
 D GATHER^TIURM1(TIUPREF,TIUCLASS,STATUS("IFNS"),EARLY,LATE,.TIUDI)
"RTN","TIURM",82,0)
 D PUTLIST^TIURM1(TIUPREF,TIUCLASS,.STATUS,.TIUDI)
"RTN","TIURM",83,0)
 K ^TMP("TIUI",$J)
"RTN","TIURM",84,0)
 Q
"RTN","TIURM",85,0)
CLEAN ; Clean up your mess!
"RTN","TIURM",86,0)
 K ^TMP("TIUR",$J),^TMP("TIURIDX",$J) D CLEAN^VALM10,KILLRR^TIULRR
"RTN","TIURM",87,0)
 K VALMY
"RTN","TIURM",88,0)
 K ^TMP("TIUTYP",$J)
"RTN","TIURM",89,0)
 Q
"RTN","TIURM",90,0)
URGENCY(TIUDA) ; What is the urgency of the current document
"RTN","TIURM",91,0)
 N TIUY,TIUD0,TIUDSTAT,TIUDURG
"RTN","TIURM",92,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUDSTAT=$P(TIUD0,U,5)
"RTN","TIURM",93,0)
 S TIUDURG=$P(TIUD0,U,9)
"RTN","TIURM",94,0)
 S TIUY=$S(TIUDSTAT<7:$S(TIUDURG="P":1,1:2),1:3)
"RTN","TIURM",95,0)
 Q TIUY
"RTN","TIURM",96,0)
DFLTSTAT(USER) ; Set default STATUS for current user
"RTN","TIURM",97,0)
 N TIUMIS,TIUMD,TIUY,TIUDPRM D DOCPRM^TIULC1(244,.TIUDPRM)
"RTN","TIURM",98,0)
 S TIUMIS=$$ISA^USRLM(DUZ,"MEDICAL INFORMATION SECTION")
"RTN","TIURM",99,0)
 I +TIUMIS,+$P($G(TIUDPRM(0)),U,3) S TIUY="UNVERIFIED" G DFLTX
"RTN","TIURM",100,0)
 I $$ISA^USRLM(DUZ,"PROVIDER") S TIUY="COMPLETED" G DFLTX
"RTN","TIURM",101,0)
 S TIUY="COMPLETED"
"RTN","TIURM",102,0)
DFLTX Q TIUY
"RTN","TIURM",103,0)
 ;
"RTN","TIURM",104,0)
RBLD ; Rebuild list after actions 11/30/00
"RTN","TIURM",105,0)
 N TIUEXP,TIUR0,TIURIDX0,TIUEDT,TIULDT
"RTN","TIURM",106,0)
 N TIURBLD,TIUI,TIUCLASS,TIUDI,TIUSCRN
"RTN","TIURM",107,0)
 S TIURBLD=1
"RTN","TIURM",108,0)
 D FIXLSTNW^TIULM ;restore video for elements added to end of list
"RTN","TIURM",109,0)
 I +$O(^TMP("TIUR",$J,"EXPAND",0)) D
"RTN","TIURM",110,0)
 . M TIUEXP=^TMP("TIUR",$J,"EXPAND")
"RTN","TIURM",111,0)
 S TIUR0=^TMP("TIUR",$J,0),TIURIDX0=^TMP("TIURIDX",$J,0)
"RTN","TIURM",112,0)
 S TIUCLASS=^TMP("TIUR",$J,"CLASS")
"RTN","TIURM",113,0)
 S STATUS("WORDS")=$P(TIUR0,U,2)
"RTN","TIURM",114,0)
 S STATUS("IFNS")=$P(TIURIDX0,U,3)
"RTN","TIURM",115,0)
 S TIUEDT=$P(TIURIDX0,U),TIULDT=$P(TIURIDX0,U,2),NOWFLAG=+$P(TIURIDX0,U,4)
"RTN","TIURM",116,0)
 M TIUDI=^TMP("TIUR",$J,"DIV")
"RTN","TIURM",117,0)
 ;VMP/ELR ADDED THE FOLLOWING LINE IN PATCH 224
"RTN","TIURM",118,0)
 S TIUSCRN="ALL"
"RTN","TIURM",119,0)
 D BUILD(TIUCLASS,.STATUS,TIUEDT,TIULDT,NOWFLAG,.TIUDI)
"RTN","TIURM",120,0)
 ; Reexpand previously expanded items:
"RTN","TIURM",121,0)
 D RELOAD^TIUROR1(.TIUEXP)
"RTN","TIURM",122,0)
 D BREATHE^TIUROR1(1)
"RTN","TIURM",123,0)
 Q
"VER")
8.0^22.0
"BLD",7307,6)
^224
**END**
**END**
