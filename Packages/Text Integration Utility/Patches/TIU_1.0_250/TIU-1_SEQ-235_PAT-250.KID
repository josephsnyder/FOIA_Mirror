Released TIU*1*250 SEQ #235
Extracted from mail message
**KIDS**:TIU*1.0*250^

**INSTALL NAME**
TIU*1.0*250
"BLD",7486,0)
TIU*1.0*250^TEXT INTEGRATION UTILITIES^0^3100520^y
"BLD",7486,1,0)
^^2^2^3100422^
"BLD",7486,1,1,0)
The description of this patch may be found in the National Patch Module
"BLD",7486,1,2,0)
under TIU*1*250.
"BLD",7486,4,0)
^9.64PA^8925^1
"BLD",7486,4,8925,0)
8925
"BLD",7486,4,8925,2,0)
^9.641^8925^1
"BLD",7486,4,8925,2,8925,0)
TIU DOCUMENT  (File-top level)
"BLD",7486,4,8925,2,8925,1,0)
^9.6411^1801^1
"BLD",7486,4,8925,2,8925,1,1801,0)
VBC LINE COUNT
"BLD",7486,4,8925,222)
y^n^p^^^^n^^n
"BLD",7486,4,8925,224)

"BLD",7486,4,"APDD",8925,8925)

"BLD",7486,4,"APDD",8925,8925,1801)

"BLD",7486,4,"B",8925,8925)

"BLD",7486,6)
8^
"BLD",7486,6.3)
14
"BLD",7486,"ABPKG")
n
"BLD",7486,"KRN",0)
^9.67PA^779.2^20
"BLD",7486,"KRN",.4,0)
.4
"BLD",7486,"KRN",.401,0)
.401
"BLD",7486,"KRN",.402,0)
.402
"BLD",7486,"KRN",.402,"NM",0)
^9.68A^1^1
"BLD",7486,"KRN",.402,"NM",1,0)
TIU ENTER/EDIT SURGICAL REPORT    FILE #8925^8925^0
"BLD",7486,"KRN",.402,"NM","B","TIU ENTER/EDIT SURGICAL REPORT    FILE #8925",1)

"BLD",7486,"KRN",.403,0)
.403
"BLD",7486,"KRN",.5,0)
.5
"BLD",7486,"KRN",.84,0)
.84
"BLD",7486,"KRN",3.6,0)
3.6
"BLD",7486,"KRN",3.8,0)
3.8
"BLD",7486,"KRN",9.2,0)
9.2
"BLD",7486,"KRN",9.8,0)
9.8
"BLD",7486,"KRN",9.8,"NM",0)
^9.68A^9^9
"BLD",7486,"KRN",9.8,"NM",1,0)
TIULC^^0^B38158718
"BLD",7486,"KRN",9.8,"NM",2,0)
TIURVBC^^0^B95963171
"BLD",7486,"KRN",9.8,"NM",3,0)
TIUT^^0^B23453629
"BLD",7486,"KRN",9.8,"NM",4,0)
TIUSRV^^0^B53540919
"BLD",7486,"KRN",9.8,"NM",5,0)
TIUSRVPT^^0^B17935611
"BLD",7486,"KRN",9.8,"NM",6,0)
TIURC^^0^B21953215
"BLD",7486,"KRN",9.8,"NM",7,0)
TIULA^^0^B46858989
"BLD",7486,"KRN",9.8,"NM",8,0)
TIURE^^0^B35855160
"BLD",7486,"KRN",9.8,"NM",9,0)
TIUPEVN1^^0^B24180473
"BLD",7486,"KRN",9.8,"NM","B","TIULA",7)

"BLD",7486,"KRN",9.8,"NM","B","TIULC",1)

"BLD",7486,"KRN",9.8,"NM","B","TIUPEVN1",9)

"BLD",7486,"KRN",9.8,"NM","B","TIURC",6)

"BLD",7486,"KRN",9.8,"NM","B","TIURE",8)

"BLD",7486,"KRN",9.8,"NM","B","TIURVBC",2)

"BLD",7486,"KRN",9.8,"NM","B","TIUSRV",4)

"BLD",7486,"KRN",9.8,"NM","B","TIUSRVPT",5)

"BLD",7486,"KRN",9.8,"NM","B","TIUT",3)

"BLD",7486,"KRN",19,0)
19
"BLD",7486,"KRN",19,"NM",0)
^9.68A^3^3
"BLD",7486,"KRN",19,"NM",1,0)
TIU VBC LINE COUNT REPORT^^0
"BLD",7486,"KRN",19,"NM",2,0)
TIU MAIN MENU MGR^^2
"BLD",7486,"KRN",19,"NM",3,0)
TIU MAIN MENU TRANSCRIPTION^^2
"BLD",7486,"KRN",19,"NM","B","TIU MAIN MENU MGR",2)

"BLD",7486,"KRN",19,"NM","B","TIU MAIN MENU TRANSCRIPTION",3)

"BLD",7486,"KRN",19,"NM","B","TIU VBC LINE COUNT REPORT",1)

"BLD",7486,"KRN",19.1,0)
19.1
"BLD",7486,"KRN",101,0)
101
"BLD",7486,"KRN",409.61,0)
409.61
"BLD",7486,"KRN",771,0)
771
"BLD",7486,"KRN",779.2,0)
779.2
"BLD",7486,"KRN",870,0)
870
"BLD",7486,"KRN",8989.51,0)
8989.51
"BLD",7486,"KRN",8989.51,"NM",0)
^9.68A^1^1
"BLD",7486,"KRN",8989.51,"NM",1,0)
TIU USER CLASS FOR VBC^^0
"BLD",7486,"KRN",8989.51,"NM","B","TIU USER CLASS FOR VBC",1)

"BLD",7486,"KRN",8989.52,0)
8989.52
"BLD",7486,"KRN",8994,0)
8994
"BLD",7486,"KRN","B",.4,.4)

"BLD",7486,"KRN","B",.401,.401)

"BLD",7486,"KRN","B",.402,.402)

"BLD",7486,"KRN","B",.403,.403)

"BLD",7486,"KRN","B",.5,.5)

"BLD",7486,"KRN","B",.84,.84)

"BLD",7486,"KRN","B",3.6,3.6)

"BLD",7486,"KRN","B",3.8,3.8)

"BLD",7486,"KRN","B",9.2,9.2)

"BLD",7486,"KRN","B",9.8,9.8)

"BLD",7486,"KRN","B",19,19)

"BLD",7486,"KRN","B",19.1,19.1)

"BLD",7486,"KRN","B",101,101)

"BLD",7486,"KRN","B",409.61,409.61)

"BLD",7486,"KRN","B",771,771)

"BLD",7486,"KRN","B",779.2,779.2)

"BLD",7486,"KRN","B",870,870)

"BLD",7486,"KRN","B",8989.51,8989.51)

"BLD",7486,"KRN","B",8989.52,8989.52)

"BLD",7486,"KRN","B",8994,8994)

"BLD",7486,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",7486,"QUES",0)
^9.62^^
"BLD",7486,"REQB",0)
^9.611^6^6
"BLD",7486,"REQB",1,0)
TEXT INTEGRATION UTILITIES 1.0^2
"BLD",7486,"REQB",2,0)
TIU*1.0*100^2
"BLD",7486,"REQB",3,0)
TIU*1.0*223^2
"BLD",7486,"REQB",4,0)
TIU*1.0*211^2
"BLD",7486,"REQB",5,0)
TIU*1.0*182^2
"BLD",7486,"REQB",6,0)
TIU*1.0*232^2
"BLD",7486,"REQB","B","TEXT INTEGRATION UTILITIES 1.0",1)

"BLD",7486,"REQB","B","TIU*1.0*100",2)

"BLD",7486,"REQB","B","TIU*1.0*182",5)

"BLD",7486,"REQB","B","TIU*1.0*211",4)

"BLD",7486,"REQB","B","TIU*1.0*223",3)

"BLD",7486,"REQB","B","TIU*1.0*232",6)

"FIA",8925)
TIU DOCUMENT
"FIA",8925,0)
^TIU(8925,
"FIA",8925,0,0)
8925IsP
"FIA",8925,0,1)
y^n^p^^^^n^^n
"FIA",8925,0,10)

"FIA",8925,0,11)

"FIA",8925,0,"RLRO")

"FIA",8925,0,"VR")
1.0^TIU
"FIA",8925,8925)
1
"FIA",8925,8925,1801)

"IX",8925,8925,"VBC",0)
8925^VBC^Optimize reporting of VBC Line count by date range.^R^^R^IR^I^8925^^^^^LS
"IX",8925,8925,"VBC",.1,0)
^^2^2^3090723^
"IX",8925,8925,"VBC",.1,1,0)
This multi-field cross-reference by Entry Date/Time and VBC Line Count is 
"IX",8925,8925,"VBC",.1,2,0)
included to optimize verification of billing for transcription.
"IX",8925,8925,"VBC",1)
S ^TIU(8925,"VBC",$E(X(1),1,14),$E(X(2),1,6),DA)=""
"IX",8925,8925,"VBC",2)
K ^TIU(8925,"VBC",$E(X(1),1,14),$E(X(2),1,6),DA)
"IX",8925,8925,"VBC",2.5)
K ^TIU(8925,"VBC")
"IX",8925,8925,"VBC",11.1,0)
^.114IA^2^2
"IX",8925,8925,"VBC",11.1,1,0)
1^F^8925^1201^14^1^F^Entry Date/Time
"IX",8925,8925,"VBC",11.1,1,3)

"IX",8925,8925,"VBC",11.1,2,0)
2^F^8925^1801^6^2^F^Visible Black Character Lines
"IX",8925,8925,"VBC",11.1,2,3)

"KRN",.402,2178,-1)
0^1
"KRN",.402,2178,0)
TIU ENTER/EDIT SURGICAL REPORT^3100305.1206^@^8925^^@^3100305
"KRN",.402,2178,"DIAB",2,0,8925,3)
AUTHOR/DICTATOR//^S X=$$PERSNAME^TIULC1($S($D(TIUAUTH):+TIUAUTH,1:+DUZ));T;REQ
"KRN",.402,2178,"DIAB",2,0,8925,6)
ATTENDING PHYSICIAN;"ATTENDING SURGEON";REQ
"KRN",.402,2178,"DIAB",3,0,8925,5)
ENTERED BY//^S X=TIUTRBR;"TRANSCRIPTIONIST"
"KRN",.402,2178,"DIAB",5,0,8925,6)
ATTENDING PHYSICIAN;"ATTENDING SURGEON"
"KRN",.402,2178,"DIAB",9,0,8925,2)
1301//NOW;"OPERATION DATE/TIME"
"KRN",.402,2178,"DR",1,8925)
.02////^S X=DFN;.03////^S X=$P($G(TIU("VISIT")),U);.07////^S X=$P($G(TIU("EDT")),U);.08////^S X=$P($G(TIU("LDT")),U);1401////^S X=$P($G(TIU("AD#")),U);I '+$G(TIUBY) S Y="@1";I +$P($G(^TIU(8925,+DA,12)),U,5) S Y="@13";
"KRN",.402,2178,"DR",1,8925,1)
1205////^S X=$P($G(TIU("LOC")),U);@13;I +$G(^TIU(8925,+DA,13)) S Y="@14";1301////^S X=$$NOW^TIULC;@14;I +$P($G(^TIU(8925,+DA,12)),U,2) S Y="@1";1202////^S X=$S($D(TIUAUTH):+TIUAUTH,1:+$G(DUZ));@1;I +$G(TIUBY) S Y="@2";
"KRN",.402,2178,"DR",1,8925,2)
I $P($G(^SC(+$G(TIU("LOC")),0)),U,3)="W" S Y="@3";1205////^S X=$P($G(TIU("LOC")),U);S Y="@4";@3;1205//^S X=$P($G(TIU("LOC")),U,2);@4;Q;Q;1301OPERATION DATE/TIME~//NOW;
"KRN",.402,2178,"DR",1,8925,3)
I +$$DATENOTE^TIULA3($$DATE^TIULS(X,"MM/DD/YY@HR:MIN:SEC"))'>0 S Y="@4";1202R~T~//^S X=$$PERSNAME^TIULC1($S($D(TIUAUTH):+TIUAUTH,1:+DUZ));
"KRN",.402,2178,"DR",1,8925,4)
I +$G(TIUAUTH),(+$P(^TIU(8925,+DA,12),U,2)'=+$G(TIUAUTH)) S TIU("SVC")=$$PROVSVC^TIULV(+$P(^(12),U,2)),TIUAUTH=+$P(^TIU(8925,+DA,12),U,2);@2;I +$$PROVIDER^TIUPXAP1(DUZ,DT)>0 S Y="@5";S TIUTRBR=+$P($G(^TIU(8925,+DA,13)),U,2);
"KRN",.402,2178,"DR",1,8925,5)
I +TIUTRBR>0 S TIUTRBR=$$PERSNAME^TIULC1(TIUTRBR);I +$$EMPTYDOC^TIULF(DA) S TIUTRBR=$$PERSNAME^TIULC1(DUZ);1302TRANSCRIPTIONIST~//^S X=TIUTRBR;K TIUTRBR;@5;I +$P($G(^TIU(8925,+DA,12)),U) S Y="@6";1201////^S X=$$NOW^TIULC;@6;
"KRN",.402,2178,"DR",1,8925,6)
I +$$PROVIDER^TIUPXAP1(DUZ,DT)'>0 S Y="@7";1209R~ATTENDING SURGEON~;S Y="@8";@7;1209ATTENDING SURGEON~;@8;1204////^S X=$$WHOSIGNS^TIULC1(DA);1208////^S X=$$WHOCOSIG^TIULC1(DA);
"KRN",.402,2178,"DR",1,8925,7)
1506////^S X=$S(+$P($G(^TIU(8925,+DA,12)),U,4)=+$P($G(^(12)),U,9):0,1:1);1404;1402;I +$P($G(TIUPREF),U,8)'>0,($G(^TIU(8925,+DA,17))']"") S Y="@10";1701;@10;I $P($G(^TIU(8925,+DA,13)),U,3)="D" S Y="@12";1303////^S X="D";@12;
"KRN",.402,2178,"DR",1,8925,8)
I +$P($G(^TIU(8925,+DA,12)),U,5) S Y="@15";1212////^S X=+$G(DUZ(2));S Y="@16";@15;1212////^S X=+$$DIVISION^TIULC1(+$P($G(^TIU(8925,+DA,12)),U,5));@16;
"KRN",19,10368,-1)
2^2
"KRN",19,10368,0)
TIU MAIN MENU MGR^Text Integration Utilities (MIS Manager)^^M^10000000182^^^^^^y^516^^1^^^1
"KRN",19,10368,10,0)
^19.01IP^22^22
"KRN",19,10368,10,22,0)
13759^15^15
"KRN",19,10368,10,22,"^")
TIU VBC LINE COUNT REPORT
"KRN",19,10368,"U")
TEXT INTEGRATION UTILITIES (MI
"KRN",19,10369,-1)
2^3
"KRN",19,10369,0)
TIU MAIN MENU TRANSCRIPTION^Text Integration Utilities (Transcriptionist)^^M^11712^^^^^^y^516^^1^^^1
"KRN",19,10369,10,0)
^19.01IP^6^6
"KRN",19,10369,10,6,0)
13759^6^6
"KRN",19,10369,10,6,"^")
TIU VBC LINE COUNT REPORT
"KRN",19,10369,"U")
TEXT INTEGRATION UTILITIES (TR
"KRN",19,13759,-1)
0^1
"KRN",19,13759,0)
TIU VBC LINE COUNT REPORT^Transcription Billing Verification Report^^A^^^^^^^^TEXT INTEGRATION UTILITIES^^1
"KRN",19,13759,1,0)
^19.06^3^3^3090727^^^
"KRN",19,13759,1,1,0)
This option produces a report for the verification of transcription 
"KRN",19,13759,1,2,0)
bills, using the Visible Black Character counting method described in VHA 
"KRN",19,13759,1,3,0)
Directive 2008-042.
"KRN",19,13759,20)
D MAIN^TIURVBC
"KRN",19,13759,"U")
TRANSCRIPTION BILLING VERIFICA
"KRN",8989.51,602,-1)
0^1
"KRN",8989.51,602,0)
TIU USER CLASS FOR VBC^User Class for VBC Line Counts^^^User Class for VBC Line Counts
"KRN",8989.51,602,1)
P^8930^Select the Class of Users for whom VBC Line counts will be reported.
"KRN",8989.51,602,2)

"KRN",8989.51,602,3)
I +$P($G(^USR(8930,+Y,0)),U,3)=1
"KRN",8989.51,602,20,0)
^^18^18^3100423^
"KRN",8989.51,602,20,1,0)
This parameter identifies the User Class whose members should have Visible
"KRN",8989.51,602,20,2,0)
Black Character Line Counts reported for the TIU documents which they 
"KRN",8989.51,602,20,3,0)
enter (e.g., Contract Transcriptionists).
"KRN",8989.51,602,20,4,0)
 
"KRN",8989.51,602,20,5,0)
If defined, the TIU Billing Verification Report will include documents
"KRN",8989.51,602,20,6,0)
entered by members of this class. If left undefined, the TIU Billing
"KRN",8989.51,602,20,7,0)
Verification Report will include any document entered by a person who is
"KRN",8989.51,602,20,8,0)
neither the author or expected cosigner (which could include in-house
"KRN",8989.51,602,20,9,0)
transcriptionists, secretaries, technicians, or students, who
"KRN",8989.51,602,20,10,0)
"ghost-write" documents on behalf of licensed providers, who in turn must
"KRN",8989.51,602,20,11,0)
review/sign the content).
"KRN",8989.51,602,20,12,0)
 
"KRN",8989.51,602,20,13,0)
If you discover that the Billing Verification Report at your station 
"KRN",8989.51,602,20,14,0)
includes an unacceptable number of documents entered by users whose work
"KRN",8989.51,602,20,15,0)
should not be included in the report, you can "filter the noise" by 
"KRN",8989.51,602,20,16,0)
identifying a User Class using this parameter, and making sure that only 
"KRN",8989.51,602,20,17,0)
the people whose work should be reported are added as members to that 
"KRN",8989.51,602,20,18,0)
User Class.
"KRN",8989.51,602,30,0)
^8989.513I^2^2
"KRN",8989.51,602,30,1,0)
1^4
"KRN",8989.51,602,30,2,0)
2^4.2
"MBREQ")
0
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"ORD",20,8989.51)
8989.51;20;;;PAR1E1^XPDTA2;PAR1F1^XPDIA3;PAR1E1^XPDIA3;PAR1F2^XPDIA3;;PAR1DEL^XPDIA3(%)
"ORD",20,8989.51,0)
PARAMETER DEFINITION
"PKG",516,-1)
1^1
"PKG",516,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",516,20,0)
^9.402P^^
"PKG",516,22,0)
^9.49I^1^1
"PKG",516,22,1,0)
1.0^2970620^2970815^11712
"PKG",516,22,1,"PAH",1,0)
250^3100520^10000000196
"PKG",516,22,1,"PAH",1,1,0)
^^2^2^3100520
"PKG",516,22,1,"PAH",1,1,1,0)
The description of this patch may be found in the National Patch Module
"PKG",516,22,1,"PAH",1,1,2,0)
under TIU*1*250.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
9
"RTN","TIULA")
0^7^B46858989^B43272352
"RTN","TIULA",1,0)
TIULA ; SLC/JER - Interactive Library functions ;04/23/10  09:00
"RTN","TIULA",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**79,113,250**;Jun 20, 1997;Build 14
"RTN","TIULA",3,0)
 ;
"RTN","TIULA",4,0)
 ; ICR #10142    - EN^DDIOL Routine
"RTN","TIULA",5,0)
 ;     #10006    - DIC Routine & DIC, X, & Y local vars
"RTN","TIULA",6,0)
 ;     #10026    - DIR Routine & DIR, X, & Y local vars
"RTN","TIULA",7,0)
 ;     #10112    - $$PRIM^VASITE, $$SITE^VASITE Routines
"RTN","TIULA",8,0)
 ;     #664      - DIVISION^VAUTOMA Routine & VAUTD local var
"RTN","TIULA",9,0)
 ;     #10140    - XQORM, EN^XQORM Routine & XQORM local var
"RTN","TIULA",10,0)
 ;
"RTN","TIULA",11,0)
PATIENT(TIUSSN) ; Select a patient
"RTN","TIULA",12,0)
 N X,DIC,Y S:$G(TIUSSN)]"" X=TIUSSN
"RTN","TIULA",13,0)
 S DIC=2,DIC(0)=$S($G(TIUSSN)']"":"AEMQ",1:"MX") D ^DIC
"RTN","TIULA",14,0)
 Q Y
"RTN","TIULA",15,0)
SELDIV ; Get document division(s)
"RTN","TIULA",16,0)
 ;
"RTN","TIULA",17,0)
 ; Output - SELDIV  -1= user ^ at prompt if multidivisional
"RTN","TIULA",18,0)
 ;                   0= institution file pointer missing for
"RTN","TIULA",19,0)
 ;                      division entry
"RTN","TIULA",20,0)
 ;                   1= successful division selection
"RTN","TIULA",21,0)
 ;          BADDIV    = comma-delimited list of bad divisions (if any)
"RTN","TIULA",22,0)
 ;          TIUDI(  undefined= user <cr> for all divisions or ^ at prompt
"RTN","TIULA",23,0)
 ;                             if multidivisional
"RTN","TIULA",24,0)
 ;                  defined= user selected one or more divisions if
"RTN","TIULA",25,0)
 ;                           multidivisional, or pre-selection of
"RTN","TIULA",26,0)
 ;                           division file entry if not multidivisional;
"RTN","TIULA",27,0)
 ;                           i.e.: TIUDI(file #40.8 ien)= Institution
"RTN","TIULA",28,0)
 ;                           file pointer for file #40.8 entry
"RTN","TIULA",29,0)
 N TIUI,VAUTD,Y
"RTN","TIULA",30,0)
 K SELDIV,TIUDI,BADDIV
"RTN","TIULA",31,0)
 ; -- Determine if facility is multidivisional
"RTN","TIULA",32,0)
 I $P($G(^DG(43,1,"GL")),U,2) D
"RTN","TIULA",33,0)
 . D DIVISION^VAUTOMA
"RTN","TIULA",34,0)
 . I Y<0 S SELDIV=-1 Q
"RTN","TIULA",35,0)
 . I VAUTD=1 S SELDIV=1 Q
"RTN","TIULA",36,0)
 . S TIUI=0 F  S TIUI=$O(VAUTD(TIUI)) Q:'TIUI  D ONE(TIUI,.VAUTD)
"RTN","TIULA",37,0)
 E  D
"RTN","TIULA",38,0)
 . S TIUI=$$PRIM^VASITE D ONE(TIUI,.VAUTD)
"RTN","TIULA",39,0)
 Q
"RTN","TIULA",40,0)
ONE(TIUI,VAUTD) ; Input - TIUI  Medical Center Division file (#40.8) IEN
"RTN","TIULA",41,0)
 N TIUIFP
"RTN","TIULA",42,0)
 S TIUIFP=$P($$SITE^VASITE(,TIUI),U) I TIUIFP>0 D
"RTN","TIULA",43,0)
 . S TIUDI(TIUI)=TIUIFP,SELDIV=1
"RTN","TIULA",44,0)
 E  D
"RTN","TIULA",45,0)
 . S SELDIV=0,BADDIV=$G(BADDIV)_$S($L($G(BADDIV)):", ",1:"")_$G(VAUTD(TIUI))
"RTN","TIULA",46,0)
 Q
"RTN","TIULA",47,0)
 ;
"RTN","TIULA",48,0)
SELSVC(TIUSVCS) ;Select Services
"RTN","TIULA",49,0)
 ; Input  -- None
"RTN","TIULA",50,0)
 ; Output -- 1=Successful and 0=Failure
"RTN","TIULA",51,0)
 ;           TIUSVCS  Service Selection Array
"RTN","TIULA",52,0)
 N TIUCNT,TIUSVCI,Y
"RTN","TIULA",53,0)
 S TIUCNT=0
"RTN","TIULA",54,0)
 F  Q:'$$ASKSVC(.TIUSVCS,TIUCNT,.TIUSVCI)  D
"RTN","TIULA",55,0)
 . S TIUSVCS(+TIUSVCI)=""
"RTN","TIULA",56,0)
 . S TIUCNT=TIUCNT+1
"RTN","TIULA",57,0)
 . S TIUSVCI=""
"RTN","TIULA",58,0)
 I $G(TIUSVCI)=-1 S Y=0 G SELSVCQ
"RTN","TIULA",59,0)
 I $G(TIUSVCI)="ALL" S TIUSVCS="ALL"
"RTN","TIULA",60,0)
 S Y=1
"RTN","TIULA",61,0)
SELSVCQ Q +$G(Y)
"RTN","TIULA",62,0)
 ;
"RTN","TIULA",63,0)
ASKSVC(TIUSVCS,TIUCNT,TIUSVCI) ;Ask Service
"RTN","TIULA",64,0)
 ; Input  -- TIUSVCS  Service Selection Array
"RTN","TIULA",65,0)
 ;           TIUCNT   Number of Services Selected
"RTN","TIULA",66,0)
 ; Output -- 1=Successful and 0=Failure
"RTN","TIULA",67,0)
 ;           TIUSVCI  Service/Section file (#49) IEN
"RTN","TIULA",68,0)
 N DIR,DTOUT,DUOUT,X,Y
"RTN","TIULA",69,0)
 S DIR(0)="PAO^49:AEMQ^K:'$$CHKSVC^TIULA(.TIUSVCS,+Y) X"
"RTN","TIULA",70,0)
 S DIR("PRE")="I X="""",'$G(TIUCNT),'$D(DTOUT) S TIUSVCI=""ALL"""
"RTN","TIULA",71,0)
 S DIR("A")="Select "_$S($G(TIUCNT):"another ",1:"")_"service: "_$S('$G(TIUCNT):"ALL// ",1:"")
"RTN","TIULA",72,0)
 I '$G(TIUCNT) S DIR("?")="   OR enter Return for ALL services." W !
"RTN","TIULA",73,0)
 D ^DIR
"RTN","TIULA",74,0)
 I Y>0 S TIUSVCI=+Y
"RTN","TIULA",75,0)
 I $D(DTOUT)!($D(DUOUT)) S TIUSVCI=-1
"RTN","TIULA",76,0)
 Q $S($G(TIUSVCI)>0:1,1:0)
"RTN","TIULA",77,0)
 ;
"RTN","TIULA",78,0)
CHKSVC(TIUSVCS,TIUSVCI) ;Check Selected Service
"RTN","TIULA",79,0)
 ; Input  -- TIUSVCS  Service Selection Array
"RTN","TIULA",80,0)
 ;           TIUSVCI  Service file (#49) IEN
"RTN","TIULA",81,0)
 ; Output -- 1=Successful and 0=Failure
"RTN","TIULA",82,0)
 N Y
"RTN","TIULA",83,0)
 S Y=1
"RTN","TIULA",84,0)
 ;Check if Service has already been selected
"RTN","TIULA",85,0)
 I $D(TIUSVCS(TIUSVCI)) D EN^DDIOL("This Service has already been selected.","","!?5") S Y=0
"RTN","TIULA",86,0)
 Q +$G(Y)
"RTN","TIULA",87,0)
 ;
"RTN","TIULA",88,0)
SELSTAT(Y,PARM,DEF) ; Select Signature status
"RTN","TIULA",89,0)
 N I,XQORM,X,TIUY
"RTN","TIULA",90,0)
 S XQORM=+$O(^ORD(101,"B","TIU STATUS MENU",0))_";ORD(101,"
"RTN","TIULA",91,0)
 I +XQORM'>0 W !,"Status selection unavailable." S TIUY=-1 G STATX
"RTN","TIULA",92,0)
 S XQORM(0)=$G(PARM),XQORM("A")="Select Status: "
"RTN","TIULA",93,0)
 I $S(PARM="F":1,PARM="R":1,1:0) S X=DEF
"RTN","TIULA",94,0)
 S XQORM("B")=DEF D ^XQORM
"RTN","TIULA",95,0)
 S TIUY=$G(Y)
"RTN","TIULA",96,0)
 I +$G(Y)=1,(+$G(Y(1))=7) S Y=2,Y(2)="8^4843^amended^8"
"RTN","TIULA",97,0)
STATX Q TIUY
"RTN","TIULA",98,0)
SELSCRN(DEF) ; Select Review Screen
"RTN","TIULA",99,0)
 N DIC,XQORM,X,Y
"RTN","TIULA",100,0)
 S DIC=101,DIC(0)="X",X="TIU REVIEW SCREEN MENU" D ^DIC
"RTN","TIULA",101,0)
 I +Y>0 D
"RTN","TIULA",102,0)
 . S XQORM=+Y_";ORD(101,",XQORM(0)="1A",XQORM("A")="Select Category: "
"RTN","TIULA",103,0)
 . S XQORM("S")="I 1 X:$D(^ORD(101,+$P(^ORD(101,DA(1),10,DA,0),U),24)) ^(24)"
"RTN","TIULA",104,0)
 . S XQORM("B")=DEF D ^XQORM
"RTN","TIULA",105,0)
 . I +Y,($D(Y)>9) D
"RTN","TIULA",106,0)
 . . S Y=$S(Y(1)["Author":"AAU",Y(1)["Patient":"APT",Y(1)["Spec":"ATS",Y(1)["Transcrip":"ATC",Y(1)["All":"ALL",Y(1)["Subject":"ASUB",Y(1)["Service":"ASVC",Y(1)["Location":"ALOC",1:"")
"RTN","TIULA",107,0)
 . . I +$G(Y(1))'>0,(X'="^^"),(X'="^") D  Q
"RTN","TIULA",108,0)
 . . . W !,"^^-jumps not allowed from this prompt." S Y=-1
"RTN","TIULA",109,0)
 . . S:Y'="ALL" Y=Y_U_$$SELPAR(Y)
"RTN","TIULA",110,0)
 . . S:Y="ALL" Y=Y_U_"ANY"
"RTN","TIULA",111,0)
 Q Y
"RTN","TIULA",112,0)
SELPAR(DEF) ; Select an author or patient or...
"RTN","TIULA",113,0)
 N DIC,X,Y
"RTN","TIULA",114,0)
 I DEF="ASUB" S Y=$$ASKSUBJ^TIULA1 G SELPARX
"RTN","TIULA",115,0)
 S DIC=$S(DEF="APT":2,DEF="ATS":45.7,DEF="ASVC":123.5,1:200)
"RTN","TIULA",116,0)
 S DIC(0)="AEMQ"
"RTN","TIULA",117,0)
 S DIC("A")="Select "_$S(DEF="APT":"PATIENT",DEF="AAU":"AUTHOR",DEF="ATS":"TREATING SPECIALTY",DEF="ATC":"TRANSCRIPTIONIST",DEF="ASVC":"SERVICE",1:"ATTENDING PHYSICIAN")_": "
"RTN","TIULA",118,0)
 I DEF="ARP" S DIC("S")="I $$ISA^USRLA(+$G(Y),""PROVIDER"")"
"RTN","TIULA",119,0)
 D ^DIC K DIC("S") I +Y>0 D
"RTN","TIULA",120,0)
 . I $S(DEF="APT"&'$D(^TIU(8925,"C",+Y)):1,DEF="AAU"&'$D(^TIU(8925,"CA",+Y)):1,DEF="ARP"&'$D(^TIU(8925,"CR",+Y)):1,1:0) W !,"No entries for ",$P(Y,U,2) S Y=0
"RTN","TIULA",121,0)
SELPARX Q Y
"RTN","TIULA",122,0)
EDATE(PRMPT,STATUS,DFLT) ; Get early date
"RTN","TIULA",123,0)
 N X,Y,TIUPRMT,TIUDFLT
"RTN","TIULA",124,0)
 I $G(STATUS)=4 S Y=1 Q Y
"RTN","TIULA",125,0)
 S TIUPRMT=" Start "_$S($L($G(PRMPT)):PRMPT_" ",1:"")_"Date [Time]: "
"RTN","TIULA",126,0)
 S TIUDFLT=$S($L($G(DFLT)):DFLT,1:"T-30")
"RTN","TIULA",127,0)
 S Y=$$READ^TIUU("DOA^::AET",TIUPRMT,TIUDFLT)
"RTN","TIULA",128,0)
 Q Y
"RTN","TIULA",129,0)
LDATE(PRMPT,STATUS,DFLT) ; Get late date
"RTN","TIULA",130,0)
 N X,Y,TIUPRMT,TIUDFLT
"RTN","TIULA",131,0)
 I $G(STATUS)=4 S Y=9999999 Q Y
"RTN","TIULA",132,0)
 S TIUPRMT="Ending "_$S($L($G(PRMPT)):PRMPT_" ",1:"")_"Date [Time]: "
"RTN","TIULA",133,0)
 S TIUDFLT=$S($L($G(DFLT)):DFLT,1:"NOW")
"RTN","TIULA",134,0)
 S Y=$$READ^TIUU("DOA^::AET",TIUPRMT,TIUDFLT)
"RTN","TIULA",135,0)
 Q Y
"RTN","TIULA",136,0)
CATEGORY() ; Select Service Category
"RTN","TIULA",137,0)
 N DIR,X,Y
"RTN","TIULA",138,0)
 S DIR(0)="9000010,.07",DIR("A")="Select SERVICE CATEGORY"
"RTN","TIULA",139,0)
 D ^DIR
"RTN","TIULA",140,0)
 Q Y_U_Y(0)
"RTN","TIULA",141,0)
SELTYP(DA,RETURN,PARM,DFLT,TYPE,MODE,DCLASS,PICK) ; Select Document Types
"RTN","TIULA",142,0)
 N I,J,X,XQORM,CURTYP,Y
"RTN","TIULA",143,0)
 I '$D(RETURN) S RETURN=$NA(^TMP("TIUTYP",$J)) K @RETURN
"RTN","TIULA",144,0)
 ; TIUK is STATIC
"RTN","TIULA",145,0)
 ;I +MODE D DOCLIST^TIULA1(DA,.RETURN,PARM,DFLT) Q:+RETURN'<0
"RTN","TIULA",146,0)
 ; *** ADD CALL TO PERSONAL DOCUMENT LISTER HERE
"RTN","TIULA",147,0)
 N:'$D(TIUK) TIUK S TIUK=+$G(TIUK)
"RTN","TIULA",148,0)
 I $G(DFLT)="LAST" D
"RTN","TIULA",149,0)
 . S DFLT=$O(^DISV(DUZ,"XQORM",DA_";TIU(8925.1,",0))
"RTN","TIULA",150,0)
 . S DFLT=$S(+DFLT:$G(^DISV(DUZ,"XQORM",DA_";TIU(8925.1,",DFLT)),1:"")
"RTN","TIULA",151,0)
 I $G(TYPE)']"" S TYPE="DOC"
"RTN","TIULA",152,0)
 I $G(MODE)']"" S MODE=1 ; Default is ASK
"RTN","TIULA",153,0)
 S XQORM=DA_";TIU(8925.1,",XQORM(0)=$S(+$P($G(^TIU(8925.1,+DA,10,0)),U,3)=1:"F",1:$G(PARM,"AD"))
"RTN","TIULA",154,0)
 I XQORM(0)["D" S XQORM("H")="W !!,$$CENTER^TIULS(""--- ""_$P(^TIU(8925.1,+DA,0),U,3)_"" ---""),!"
"RTN","TIULA",155,0)
 I $S(XQORM(0)="F":1,XQORM(0)="R":1,1:0) S X=$S(DFLT]"":DFLT,1:"ALL")
"RTN","TIULA",156,0)
 S:$G(DFLT)]"" XQORM("B")=DFLT
"RTN","TIULA",157,0)
 S XQORM("A")="Select "_$S(XQORM(0)["D":"Document",1:$P(^TIU(8925.1,+DA,0),U,3))_$S($P(^TIU(8925.1,+DA,0),U,4)="DOC":" Component",1:" Type")_$S(+XQORM(0)'=1:"(s)",1:"")_": "
"RTN","TIULA",158,0)
 ; If screening inactive titles proves to be correct, remove comment
"RTN","TIULA",159,0)
 ; from the line below:
"RTN","TIULA",160,0)
 ; S XQORM("S")="I +$$CANPICK^TIULP(+$G(^TIU(8925.1,+DA(1),10,+DA,0)))>0"
"RTN","TIULA",161,0)
 D EN^XQORM
"RTN","TIULA",162,0)
 I +Y'>0,($D(@RETURN)'>9) S @RETURN=Y Q
"RTN","TIULA",163,0)
 I (PARM["A"),(+$G(@RETURN)'>0) M PICK=Y
"RTN","TIULA",164,0)
 S I=0 F  S I=$O(Y(I)) Q:+I'>0  D
"RTN","TIULA",165,0)
 . N TYPMATCH
"RTN","TIULA",166,0)
 . S J=+$P(Y(I),U,2),CURTYP=$P($G(^TIU(8925.1,+J,0)),U,4)
"RTN","TIULA",167,0)
 . I CURTYP="DC" S DCLASS=+$G(DCLASS)+1,DCLASS(DCLASS)=J
"RTN","TIULA",168,0)
 . I  I TYPE="DOC",(PARM["A"),(+$O(^TIU(8925.1,+J,10,0))'>0) W !!,"The Document Class ",$P(^TIU(8925.1,+J,0),U)," has no active titles at present..."
"RTN","TIULA",169,0)
 . S TYPMATCH=$$TYPMATCH^TIULA1(TYPE,CURTYP)
"RTN","TIULA",170,0)
 . I +TYPMATCH>0 D
"RTN","TIULA",171,0)
 . . S TIUK=+$G(TIUK)+1,@RETURN@(TIUK)=Y(I),@RETURN=TIUK
"RTN","TIULA",172,0)
 . I $S('+$G(TYPMATCH):1,CURTYP="CL":1,1:0),+$O(^TIU(8925.1,+J,10,0))>0 D SELTYP(+J,.RETURN,$S(MODE=1:$G(PARM),1:"F"),$S(MODE=1:"LAST",1:"ALL"),TYPE,MODE,.DCLASS,.PICK)
"RTN","TIULA",173,0)
 Q
"RTN","TIULC")
0^1^B38158718^B28717551
"RTN","TIULC",1,0)
TIULC ; SLC/JER - Computational functions ;08/06/2009
"RTN","TIULC",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**3,9,19,23,53,93,109,182,250**;Jun 20, 1997;Build 14
"RTN","TIULC",3,0)
 ;
"RTN","TIULC",4,0)
 ; ICR #2054    - ^%DT
"RTN","TIULC",5,0)
 ;     #10000   - NOW^%DTC Routine & %H, %I Local Vars
"RTN","TIULC",6,0)
 ;     #10003   - %DT Local Var
"RTN","TIULC",7,0)
 ;     #10103   - $$FMDIFF^XLFDT
"RTN","TIULC",8,0)
 ;
"RTN","TIULC",9,0)
LINECNT(DA) ; Compute line count for document record
"RTN","TIULC",10,0)
 N CPL,CCNT S CPL=$S(+$P($G(TIUPRM0),U,3)>0:$P(TIUPRM0,U,3),1:60)
"RTN","TIULC",11,0)
 Q $$CHARCNT(DA)\CPL
"RTN","TIULC",12,0)
CHARCNT(DA) ; Compute character count for a record
"RTN","TIULC",13,0)
 N TIUI
"RTN","TIULC",14,0)
 N:'$D(CCNT) CCNT ; Character count is static
"RTN","TIULC",15,0)
 S TIUI=0 F  S TIUI=$O(^TIU(8925,DA,"TEXT",TIUI)) Q:+TIUI'>0  D
"RTN","TIULC",16,0)
 . S CCNT=+$G(CCNT)+$L($$STRIP^TIULS(^TIU(8925,DA,"TEXT",TIUI,0)))
"RTN","TIULC",17,0)
 S TIUI=0
"RTN","TIULC",18,0)
 F  S TIUI=$O(^TIU(8925,"DAD",DA,TIUI)) Q:+TIUI'>0!+$$ISADDNDM^TIULC1(+TIUI)  S CCNT=$$CHARCNT(TIUI)
"RTN","TIULC",19,0)
 Q +$G(CCNT)
"RTN","TIULC",20,0)
VBCLINES(DA,ROOT) ; Compute the Visible Black Character (VBC) Line Count for a document
"RTN","TIULC",21,0)
 Q $FN(($$VBCCNT(DA,$G(ROOT,"^TIU(8925,"_DA_",""TEXT"")"))/65),"",2)
"RTN","TIULC",22,0)
VBCCNT(DA,ROOT) ; Compute Visible Black Character (VBC) Count for a record
"RTN","TIULC",23,0)
 N TIUVBC,TIUI S ROOT=$G(ROOT,"^TIU(8925,"_DA_",""TEXT"")")
"RTN","TIULC",24,0)
 N:'$D(VBCCNT) VBCCNT
"RTN","TIULC",25,0)
 S TIUVBC=$$VBC
"RTN","TIULC",26,0)
 S TIUI=0
"RTN","TIULC",27,0)
 F  S TIUI=$O(@ROOT@(TIUI)) Q:+TIUI'>0  D
"RTN","TIULC",28,0)
 . N TIUL,TIUJ S TIUL=$G(@ROOT@(TIUI,0)),TIUJ=0
"RTN","TIULC",29,0)
 . F TIUJ=1:1:$L(TIUL) D
"RTN","TIULC",30,0)
 . . N TIUC S TIUC=$E(TIUL,TIUJ)
"RTN","TIULC",31,0)
 . . S:TIUVBC[TIUC VBCCNT=+$G(VBCCNT)+1
"RTN","TIULC",32,0)
 S TIUI=0
"RTN","TIULC",33,0)
 I ROOT["^TIU(8925," D
"RTN","TIULC",34,0)
 . F  S TIUI=$O(^TIU(8925,"DAD",DA,TIUI)) Q:+TIUI'>0!+$$ISADDNDM^TIULC1(+TIUI)  S CCNT=$$VBCCNT(TIUI)
"RTN","TIULC",35,0)
 Q +$G(VBCCNT)
"RTN","TIULC",36,0)
VBC() ; Return string of Visible Black Characters (VBC)
"RTN","TIULC",37,0)
 Q "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz~!@#$%^&*()_+{}|:<>?÷±`1234567890-=[]\;',./"""
"RTN","TIULC",38,0)
STATUS(DA) ; Evaluate Status of Reports
"RTN","TIULC",39,0)
 N NODE12,NODE13,NODE15,NODE16,AMENDED,STATUS,SIGNED,COSIGNED,PURGED
"RTN","TIULC",40,0)
 N VERIFIED,RELEASED,SIGNER,COSIGNER,SIGSTAT,TYPE,REQVER,REQREL,REQCOS
"RTN","TIULC",41,0)
 N DELETED,TIUDPARM,ADMINCL
"RTN","TIULC",42,0)
 S STATUS=""
"RTN","TIULC",43,0)
 S TYPE=$S($D(TIUTYP(1)):$P(TIUTYP(1),U,2),1:+$G(^TIU(8925,+DA,0)))
"RTN","TIULC",44,0)
 D DOCPRM^TIULC1(TYPE,.TIUDPARM,DA)
"RTN","TIULC",45,0)
 S REQVER=$$REQVER(+DA,+$P($G(TIUDPARM(0)),U,3))
"RTN","TIULC",46,0)
 S REQREL=+$P($G(TIUDPARM(0)),U,2)
"RTN","TIULC",47,0)
 S NODE12=$G(^TIU(8925,+DA,12)),NODE13=$G(^TIU(8925,+DA,13))
"RTN","TIULC",48,0)
 S NODE15=$G(^TIU(8925,+DA,15)),NODE16=$G(^TIU(8925,+DA,16))
"RTN","TIULC",49,0)
 S SIGNED=+$P(NODE15,U),COSIGNED=+$P(NODE15,U,7),REQCOS=+$P(NODE15,U,6)
"RTN","TIULC",50,0)
 S SIGNER=+$P(NODE12,U,2),COSIGNER=+$P(NODE12,U,4)
"RTN","TIULC",51,0)
 S ADMINCL=+$P(NODE16,U,6) ;P182
"RTN","TIULC",52,0)
 S AMENDED=+$P(NODE16,U),PURGED=+$P(NODE16,U,9),DELETED=+$P(NODE16,U,11)
"RTN","TIULC",53,0)
 S RELEASED=+$P(NODE13,U,4),VERIFIED=+$P(NODE13,U,5)
"RTN","TIULC",54,0)
 I PURGED S STATUS="purged" G STATUSX
"RTN","TIULC",55,0)
 I DELETED S STATUS="deleted" G STATUSX
"RTN","TIULC",56,0)
 I AMENDED S STATUS="amended" G STATUSX
"RTN","TIULC",57,0)
 I +$$ISA^TIULX(+TYPE,+$$CLASS^TIUCP),'SIGNER S STATUS="undictated" G STATUSX
"RTN","TIULC",58,0)
 I '+NODE12,+NODE13 S STATUS="untranscribed" G STATUSX
"RTN","TIULC",59,0)
 I REQREL,'RELEASED S STATUS="unreleased" G STATUSX
"RTN","TIULC",60,0)
 I REQVER,'VERIFIED S STATUS="unverified" G STATUSX
"RTN","TIULC",61,0)
 I SIGNED,$S('REQCOS:1,COSIGNED:1,1:0) S STATUS="completed" G STATUSX
"RTN","TIULC",62,0)
 I ADMINCL S STATUS="completed" G STATUSX
"RTN","TIULC",63,0)
 I 'SIGNED S STATUS="unsigned" G STATUSX
"RTN","TIULC",64,0)
 I REQCOS,'COSIGNED S STATUS="uncosigned"
"RTN","TIULC",65,0)
STATUSX Q STATUS
"RTN","TIULC",66,0)
REQVER(TIUDA,TIUVPRM) ; Evaluate conditions of verification requirement
"RTN","TIULC",67,0)
 N TIUD0,TIUD13,TIUD15,TIUY
"RTN","TIULC",68,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUD13=$G(^(13)),TIUD15=$G(^(15))
"RTN","TIULC",69,0)
 I +$G(TIUVPRM)'>0!(+$P(TIUD13,U,5)>0) S TIUY=0 G REQVX
"RTN","TIULC",70,0)
 I +$G(TIUVPRM)>0,+$G(TIUD15) S TIUY=0 G REQVX
"RTN","TIULC",71,0)
 I +$G(TIUVPRM)=1 S TIUY=1 G REQVX
"RTN","TIULC",72,0)
 I +$G(TIUVPRM)=2,($P(TIUD13,U,3)="U") S TIUY=1 G REQVX
"RTN","TIULC",73,0)
 I +$G(TIUVPRM)=3,($P(TIUD13,U,3)="D") S TIUY=1
"RTN","TIULC",74,0)
REQVX Q +$G(TIUY)
"RTN","TIULC",75,0)
PRCDNC(DA,SCREEN) ; Determine sort precedence of each record
"RTN","TIULC",76,0)
 N SIGNED,URGENCY
"RTN","TIULC",77,0)
 S URGENCY=$P($G(^TIU(8925,+DA,0)),U,9)
"RTN","TIULC",78,0)
 I +$$SIGNED(DA,.SCREEN)'>0 S Y=$S(URGENCY="P":1,1:2)
"RTN","TIULC",79,0)
 E  S Y=3
"RTN","TIULC",80,0)
 Q Y
"RTN","TIULC",81,0)
PURGE(TIUDA) ; Checks whether or not a given Document should be purged
"RTN","TIULC",82,0)
 N TIUEDT,TIUY S TIUY=0
"RTN","TIULC",83,0)
 ; if parameters not in symbol table, get them
"RTN","TIULC",84,0)
 I '$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIULC",85,0)
 ; exit if no Archive/purge grace period defined
"RTN","TIULC",86,0)
 I +$P(TIUPRM0,U,4)'>0 G PURGEX
"RTN","TIULC",87,0)
 S TIUEDT=$P($G(^TIU(8925,TIUDA,12)),U)
"RTN","TIULC",88,0)
 I +TIUEDT'>0 G PURGEX ;Transcription date blank
"RTN","TIULC",89,0)
 I +$$ISPN^TIULX(+$G(^TIU(8925,+TIUDA,0))) G PURGEX ; PN's exempt
"RTN","TIULC",90,0)
 I +$$ISADDNDM^TIULC1(+TIUDA),+$$ISPN^TIULX(+$G(^TIU(8925,+$P(^TIU(8925,+TIUDA,0),U,6),0))) G PURGEX ; Addenda to Progress Notes exempt
"RTN","TIULC",91,0)
 I +$P($G(^TIU(8925,+TIUDA,0)),U,5)<7 G PURGEX ;Incomplete--don't purge
"RTN","TIULC",92,0)
 I +$P($G(^TIU(8925,TIUDA,16)),U,4)>0 G PURGEX ;Document already purged
"RTN","TIULC",93,0)
 I $$FMDIFF^XLFDT(DT,TIUEDT)>+$P(TIUPRM0,U,4) S TIUY=1
"RTN","TIULC",94,0)
PURGEX Q TIUY
"RTN","TIULC",95,0)
OVERDUE(TIUDA) ; Checks whether or not a given document is overdue
"RTN","TIULC",96,0)
 N TIUD0,TIUDATE,TIUY,TIUDPRM S TIUY=0,TIUD0=$G(^TIU(8925,TIUDA,0))
"RTN","TIULC",97,0)
 ; if parameters not in symbol table, get them
"RTN","TIULC",98,0)
 I '$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIULC",99,0)
 D DOCPRM^TIULC1(+TIUD0,.TIUDPRM,TIUDA)
"RTN","TIULC",100,0)
 ; exit if no signature grace period defined
"RTN","TIULC",101,0)
 I +$P(TIUPRM0,U,5)'>0 G OVERX
"RTN","TIULC",102,0)
 I '$D(TIUDPRM) G OVERX
"RTN","TIULC",103,0)
 S TIUDATE=$S($$REQVER(TIUDA,+$P(TIUDPRM(0),U,3)):$P($G(^TIU(8925,+TIUDA,13)),U,5),$P(TIUDPRM(0),U,2):$P($G(^TIU(8925,+TIUDA,13)),U,4),1:$P($G(^TIU(8925,+TIUDA,12)),U))
"RTN","TIULC",104,0)
 G:+TIUDATE'>0 OVERX
"RTN","TIULC",105,0)
 I $$FMDIFF^XLFDT(DT,TIUDATE)>$P(TIUPRM0,U,5),(+$P($G(^TIU(8925,+TIUDA,0)),U,5)>4),(+$P($G(^TIU(8925,+TIUDA,0)),U,5)<7) S TIUY=1
"RTN","TIULC",106,0)
OVERX Q TIUY
"RTN","TIULC",107,0)
NOW() ; Extrinsic function returning current date/time to nearest .01 second
"RTN","TIULC",108,0)
 N %,%H,%I,X
"RTN","TIULC",109,0)
 D NOW^%DTC
"RTN","TIULC",110,0)
 Q %
"RTN","TIULC",111,0)
IDATE(X) ; Recieves date in external format, returns internal format
"RTN","TIULC",112,0)
 N %DT,Y
"RTN","TIULC",113,0)
 I ($L(X," ")=2),(X?1.2N1P1.2N1P1.2N1" "1.2N.E) S X=$TR(X," ","@")
"RTN","TIULC",114,0)
 S %DT="TSP" D ^%DT
"RTN","TIULC",115,0)
 Q Y
"RTN","TIULC",116,0)
SIGNED(TIUDA,SCREEN) ; Check whether document requires signature or
"RTN","TIULC",117,0)
 ; cosignature on user-sensitive basis
"RTN","TIULC",118,0)
 N Y S Y=0 ; Initialize return value to FALSE
"RTN","TIULC",119,0)
 ; If archived/purged return TRUE
"RTN","TIULC",120,0)
 I +$P($G(^TIU(8925,+TIUDA,16)),U,9) S Y=1 G SIGNEDX
"RTN","TIULC",121,0)
 ; If OPTION is Act on MY Unsigned Documents, check
"RTN","TIULC",122,0)
 ; whether his/her signature is present
"RTN","TIULC",123,0)
 I $P($G(SCREEN(1)),U)="AAU",($P($G(SCREEN(2)),U)="ASUP") D  G SIGNEDX
"RTN","TIULC",124,0)
 . ; If dictated by user and signed return TRUE
"RTN","TIULC",125,0)
 . I $P($G(^TIU(8925,+TIUDA,12)),U,4)=DUZ,(+$P($G(^(15)),U)>0) S Y=1
"RTN","TIULC",126,0)
 . ; If user is Expected Cosigner and cosigned, return TRUE
"RTN","TIULC",127,0)
 . I $P($G(^TIU(8925,+TIUDA,12)),U,8)=DUZ,(+$P($G(^(15)),U,7)>0) S Y=1
"RTN","TIULC",128,0)
 ; Otherwise check search criteria to determine signature status
"RTN","TIULC",129,0)
 I $P($G(SCREEN(1)),U)="AAU",+$P($G(^TIU(8925,+TIUDA,15)),U) S Y=1 G SIGNEDX
"RTN","TIULC",130,0)
 I $P($G(SCREEN(1)),U)="ASUP",+$P($G(^TIU(8925,+TIUDA,15)),U,7) S Y=1 G SIGNEDX
"RTN","TIULC",131,0)
 I +$P($G(^TIU(8925,+TIUDA,15)),U),+$P($G(^(15)),U,7) S Y=1
"RTN","TIULC",132,0)
SIGNEDX Q Y
"RTN","TIULC",133,0)
BLANK(TIUDA) ; Reads a given document for blank lines
"RTN","TIULC",134,0)
 ; Returns: 1:Record contains 1 or more blanks
"RTN","TIULC",135,0)
 ;          0:Record contains no blanks
"RTN","TIULC",136,0)
 N BLANK,TIUI,Y S (TIUI,Y)=0
"RTN","TIULC",137,0)
 I '$D(TIUPRM1) D SETPARM^TIULE
"RTN","TIULC",138,0)
 I $P($G(TIUPRM1),U,6)']"" G BLANKX
"RTN","TIULC",139,0)
 S BLANK=$P(TIUPRM1,U,6)
"RTN","TIULC",140,0)
 F  S TIUI=$O(^TIU(8925,TIUDA,"TEXT",TIUI)) Q:+TIUI'>0  D
"RTN","TIULC",141,0)
 . I $G(^TIU(8925,TIUDA,"TEXT",TIUI,0))[BLANK S Y=1
"RTN","TIULC",142,0)
BLANKX Q Y
"RTN","TIULC",143,0)
CHKSUM(TIUROOT,TIUY) ; Calculates checksum for a record
"RTN","TIULC",144,0)
 N TIUI,X S TIUI=0,TIUY=+$G(TIUY)
"RTN","TIULC",145,0)
 F  S TIUI=$O(@TIUROOT@(TIUI)) Q:+TIUI'>0  D
"RTN","TIULC",146,0)
 . S X=$G(@TIUROOT@(TIUI,0))
"RTN","TIULC",147,0)
 . N TIUJ
"RTN","TIULC",148,0)
 . F TIUJ=1:1:$L(X) S TIUY=+$G(TIUY)+(($A(X,TIUJ)*TIUI)*TIUJ)
"RTN","TIULC",149,0)
 S TIUI=0
"RTN","TIULC",150,0)
 F  S TIUI=$O(^TIU(8925,"DAD",+$P(TIUROOT,",",2),TIUI)) Q:+TIUI'>0  D
"RTN","TIULC",151,0)
 . I +$$ISADDNDM^TIULC1(+TIUI) Q
"RTN","TIULC",152,0)
 . S TIUY=+$G(TIUY)+$$CHKSUM("^TIU(8925,"_+TIUI_",""TEXT"")",TIUY)
"RTN","TIULC",153,0)
 Q +$G(TIUY)
"RTN","TIUPEVN1")
0^9^B24180473^B19909119
"RTN","TIUPEVN1",1,0)
TIUPEVN1 ; SLC/JER - Event logger Cont'd ;05/20/10  14:09
"RTN","TIUPEVN1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**81,250**;Jun 20, 1997;Build 14
"RTN","TIUPEVN1",3,0)
 ;
"RTN","TIUPEVN1",4,0)
 ; ICR #10006    - ^DIC Routine & DIC, DLAYGO, X, & Y local vars
"RTN","TIUPEVN1",5,0)
 ;     #10018    - ^DIE Routine & DIE, DA, DR, DTOUT, & DUOUT local vars
"RTN","TIUPEVN1",6,0)
 ;     #10004    - EN^DIQ Routine & DIC, DA, X, & Y local vars
"RTN","TIUPEVN1",7,0)
 ;     #10015    - EN^DIQ1 Routine & DIC, DIQ, DA, & DR local vars
"RTN","TIUPEVN1",8,0)
 ;     #10081    - SETUP^XQALERT Routine & XQADATA, XQAID, XQAMSG, & XQAROU  local vars
"RTN","TIUPEVN1",9,0)
 ;
"RTN","TIUPEVN1",10,0)
FIELDS(EVNTDA,MSG) ; ---- Log missing/incorrect field errors for
"RTN","TIUPEVN1",11,0)
 ;                      specific fields in UPLOAD LOG file (#8925.4),
"RTN","TIUPEVN1",12,0)
 ;                      in multiple fl. TIU*1*81 moved from TIUPEVNT
"RTN","TIUPEVN1",13,0)
 N TIUI S TIUI=0
"RTN","TIUPEVN1",14,0)
 F  S TIUI=$O(MSG("DIERR",TIUI)) Q:+TIUI'>0  D
"RTN","TIUPEVN1",15,0)
 . N DA,DR,DIC,DIE,DLAYGO,X,Y S DIC="^TIU(8925.4,"_EVNTDA_",1,",DIC(0)="L"
"RTN","TIUPEVN1",16,0)
 . I '$D(MSG("DIERR",TIUI,"PARAM","FILE")) Q
"RTN","TIUPEVN1",17,0)
 . S ^TIU(8925.4,EVNTDA,1,0)="^8925.42^^",DA(1)=EVNTDA
"RTN","TIUPEVN1",18,0)
 . S DLAYGO=8925.42,X=""""_MSG("DIERR",TIUI,"PARAM","FILE")_""""
"RTN","TIUPEVN1",19,0)
 . D ^DIC Q:+Y'>0
"RTN","TIUPEVN1",20,0)
 . S DIE=DIC,DA(1)=EVNTDA,DA=+Y
"RTN","TIUPEVN1",21,0)
 . S DR=".02///"_+$G(MSG("DIERR",TIUI,"PARAM","IENS"))_";.03///"_$G(MSG("DIERR",TIUI,"PARAM","FIELD"))_";.04///"_$G(MSG("DIERR",TIUI,"PARAM",3))
"RTN","TIUPEVN1",22,0)
 . D ^DIE,FLDALRT(EVNTDA,DA,$P($G(^TIU(8925.4,+EVNTDA,0)),U,4))
"RTN","TIUPEVN1",23,0)
 Q
"RTN","TIUPEVN1",24,0)
FLDALRT(EVNTDA,EVNTDA1,ERRMSG) ; ---- Send alerts for missing field errors
"RTN","TIUPEVN1",25,0)
 ;                              TIU*1*81 moved from TIUPEVNT
"RTN","TIUPEVN1",26,0)
 N XQA,XQAID,XQADATA,XQAMSG,XQAKILL,XQAROU,TIUI,TIUSUB,TYPE,EVNTDA10
"RTN","TIUPEVN1",27,0)
 N NOTEDA,NOTE0
"RTN","TIUPEVN1",28,0)
 ; ---- TIU*1*81 If this is a TIU docmt, get its title for TYPE
"RTN","TIUPEVN1",29,0)
 S EVNTDA10=$G(^TIU(8925.4,EVNTDA,1,EVNTDA1,0))
"RTN","TIUPEVN1",30,0)
 I $P(EVNTDA10,U)=8925 D
"RTN","TIUPEVN1",31,0)
 . S NOTEDA=$P(EVNTDA10,U,2),NOTE0=$G(^TIU(8925,NOTEDA,0)),TYPE=+NOTE0
"RTN","TIUPEVN1",32,0)
 . ; ---- TIU*1*81 If note is addendum, get type of parent note instead
"RTN","TIUPEVN1",33,0)
 . I +$$ISADDNDM^TIULC1(NOTEDA) S TYPE=+$$DADTYPE^TIUPUTC(NOTEDA)
"RTN","TIUPEVN1",34,0)
 ; ---- else get TYPE from $HDR line, e.g. Progress Notes (3)
"RTN","TIUPEVN1",35,0)
 I $G(TYPE)'>0 S TYPE=+$G(TIUREC("TYPE"))
"RTN","TIUPEVN1",36,0)
 I TYPE D WHOGETS^TIUPEVN1(.XQA,TYPE)
"RTN","TIUPEVN1",37,0)
 ; ---- If no docmt def param recipients found, try site recipients
"RTN","TIUPEVN1",38,0)
 I $D(XQA)'>9 D
"RTN","TIUPEVN1",39,0)
 . S TIUI=$O(^TIU(8925.99,"B",+$G(DUZ(2)),0)) S:+TIUI'>0 TIUI=+$O(^TIU(8925.99,0))
"RTN","TIUPEVN1",40,0)
 . S TIUSUB=0 F  S TIUSUB=$O(^TIU(8925.99,+TIUI,2,TIUSUB)) Q:TIUSUB'>0  D
"RTN","TIUPEVN1",41,0)
 . . S XQA($G(^TIU(8925.99,+TIUI,2,TIUSUB,0)))=""
"RTN","TIUPEVN1",42,0)
 Q:$D(XQA)'>9
"RTN","TIUPEVN1",43,0)
 S XQAID="TIUERR"_","_EVNTDA_","_EVNTDA1
"RTN","TIUPEVN1",44,0)
 S XQAMSG=ERRMSG
"RTN","TIUPEVN1",45,0)
 W:'$D(ZTQUEUED) !!,XQAMSG
"RTN","TIUPEVN1",46,0)
 S XQADATA=ERRMSG_";"_EVNTDA_";"_EVNTDA1
"RTN","TIUPEVN1",47,0)
 S XQAROU="FLDISP^TIUPEVN1" ; TIU*1*81 moved from TIUPEVNT
"RTN","TIUPEVN1",48,0)
 D SETUP^XQALERT
"RTN","TIUPEVN1",49,0)
 Q
"RTN","TIUPEVN1",50,0)
FLDISP ; ---- Alert follow-up action for missing field errors
"RTN","TIUPEVN1",51,0)
        ;      TIU*1*81 moved from TIUPEVNT
"RTN","TIUPEVN1",52,0)
 N DIE,DA,DR,EVNTDA,EVNTDA1,EVNTREC,TIUFIX,TIULINK S TIUFIX=0
"RTN","TIUPEVN1",53,0)
 S EVNTDA=+$P(XQADATA,";",2),EVNTDA1=+$P(XQADATA,";",3)
"RTN","TIUPEVN1",54,0)
 S EVNTREC=$G(^TIU(8925.4,EVNTDA,1,EVNTDA1,0)) Q:+EVNTREC'>0
"RTN","TIUPEVN1",55,0)
 S DIE=$P(EVNTREC,U),DA=$P(EVNTREC,U,2)
"RTN","TIUPEVN1",56,0)
 S DR=$P(EVNTREC,U,3)_"//"_$P(EVNTREC,U,4)
"RTN","TIUPEVN1",57,0)
 S TIUFIX=$$FIXED(DIE,+DA,+DR)
"RTN","TIUPEVN1",58,0)
 I +TIUFIX>0 D  Q
"RTN","TIUPEVN1",59,0)
 . W:TIUFIX=1 !!,"Missing field already filled in by another method..."
"RTN","TIUPEVN1",60,0)
 . W:TIUFIX=2 !!,"Record #",DA," has been deleted by an authorized user..."
"RTN","TIUPEVN1",61,0)
 . W !,"  Nothing left to resolve." H 3
"RTN","TIUPEVN1",62,0)
 . S XQAKILL=0 D FLDRSLV(EVNTDA)
"RTN","TIUPEVN1",63,0)
 W !!,"You may now enter the correct information:",!
"RTN","TIUPEVN1",64,0)
 W !,$P(XQADATA,";"),!
"RTN","TIUPEVN1",65,0)
 D RECDISP(DIE,DA)
"RTN","TIUPEVN1",66,0)
 I DIE=8925,(+DR=1405) D
"RTN","TIUPEVN1",67,0)
 . N TIUREASX,TIUDA
"RTN","TIUPEVN1",68,0)
 . S TIUDA=+DA
"RTN","TIUPEVN1",69,0)
 . S TIUREASX=$$REASSIGN^TIULC1(+$G(^TIU(8925,+TIUDA,0)))
"RTN","TIUPEVN1",70,0)
 . I TIUREASX]"" X TIUREASX S TIULINK=1
"RTN","TIUPEVN1",71,0)
 I '+$G(TIULINK) D ^DIE
"RTN","TIUPEVN1",72,0)
 ; ---- If TIU Document, do post-filing action send signature alerts
"RTN","TIUPEVN1",73,0)
 I DIE="^TIU(8925," D
"RTN","TIUPEVN1",74,0)
 . N TIUREC,TIUPOST,DR,DIE,TYPE,TIUD12,TIUD13,TIUEBY,TIUAU,TIUEC
"RTN","TIUPEVN1",75,0)
 . S TYPE=$S(+$$ISADDNDM^TIULC1(DA):+$G(^TIU(8925,+$P(^TIU(8925,DA,0),U,6),0)),1:+$G(^TIU(8925,DA,0)))
"RTN","TIUPEVN1",76,0)
 . S TIUPOST=$$POSTFILE^TIULC1(TYPE)
"RTN","TIUPEVN1",77,0)
 . S TIUREC("#")=DA
"RTN","TIUPEVN1",78,0)
 . I TIUPOST]"" X TIUPOST I 1
"RTN","TIUPEVN1",79,0)
 . ;if not entered by the author or expected cosigner record VBC Line Count
"RTN","TIUPEVN1",80,0)
 . S TIUD12=$G(^TIU(8925,DA,12)),TIUD13=$G(^(13))
"RTN","TIUPEVN1",81,0)
 . S TIUEBY=$P(TIUD13,U,2),TIUAU=$P(TIUD12,U,2),TIUEC=$P(TIUD13,U,8)
"RTN","TIUPEVN1",82,0)
 . I ((+TIUEBY>0)&(+TIUAU>0))&((TIUEBY'=TIUAU)&(TIUEBY'=TIUEC)) D LINES^TIUSRVPT(DA)
"RTN","TIUPEVN1",83,0)
 . D SEND^TIUALRT(DA)
"RTN","TIUPEVN1",84,0)
 S TIUFIX=$$FIXED(DIE,+DA,+DR)
"RTN","TIUPEVN1",85,0)
 I +$G(TIUFIX)'>0 K XQAKILL Q
"RTN","TIUPEVN1",86,0)
 S XQAKILL=0
"RTN","TIUPEVN1",87,0)
 ; ---- If field is fixed, evaluate whether whole event is resolved
"RTN","TIUPEVN1",88,0)
 D FLDRSLV(EVNTDA)
"RTN","TIUPEVN1",89,0)
 Q
"RTN","TIUPEVN1",90,0)
RECDISP(DIC,DA) ; ---- Call DIQ to display the existing record
"RTN","TIUPEVN1",91,0)
 ;              TIU*1*81 moved from TIUPEVNT
"RTN","TIUPEVN1",92,0)
 N X,Y,DIQ,DR
"RTN","TIUPEVN1",93,0)
 I '+$$READ^TIUU("Y","Display ENTIRE existing record","NO") Q
"RTN","TIUPEVN1",94,0)
 W ! S DIC=$G(^DIC(DIC,0,"GL"))
"RTN","TIUPEVN1",95,0)
 D EN^DIQ
"RTN","TIUPEVN1",96,0)
 Q
"RTN","TIUPEVN1",97,0)
FIXED(DIC,DA,DR) ; ---- Evaluate whether the field has been filled in
"RTN","TIUPEVN1",98,0)
 ;                      TIU*1*81 moved from TIUPEVNT
"RTN","TIUPEVN1",99,0)
 N DIQ,X,Y,TIUY,TIUFIX S TIUY=0,DIQ="TIUFIX",DIQ(0)="IN"
"RTN","TIUPEVN1",100,0)
 I '$D(^TIU(8925,DA,0)) S TIUY=2 G FIXX
"RTN","TIUPEVN1",101,0)
 D EN^DIQ1 I $D(TIUFIX) S TIUY=1
"RTN","TIUPEVN1",102,0)
FIXX Q TIUY
"RTN","TIUPEVN1",103,0)
FLDRSLV(ERRDA) ; ---- Evaluate missing field errors; mark resolved
"RTN","TIUPEVN1",104,0)
 ;              TIU*1*81 moved from TIUPEVNT
"RTN","TIUPEVN1",105,0)
 N TIUK,TIUFLD,RSLVED
"RTN","TIUPEVN1",106,0)
 S TIUK=0,RSLVED=1
"RTN","TIUPEVN1",107,0)
 ; ---- TIU*1*81 Mark resolved only if ALL missing fields are fixed
"RTN","TIUPEVN1",108,0)
 F  S TIUK=$O(^TIU(8925.4,+ERRDA,1,TIUK)) Q:+TIUK'>0  Q:'RSLVED  D
"RTN","TIUPEVN1",109,0)
 . N DIC,DIQ,DA,DR S DA=TIUK,DIC="^TIU(8925.4,"_+ERRDA_",1,"
"RTN","TIUPEVN1",110,0)
 . S DR=".01:.04",DIQ="TIUFLD(" D EN^DIQ1 Q:$D(TIUFLD)'>9
"RTN","TIUPEVN1",111,0)
 . I '$$FIXED(8925,+$G(TIUFLD(8925.42,DA,.02)),+$G(TIUFLD(8925.42,DA,.03)))=1 S RSLVED=0
"RTN","TIUPEVN1",112,0)
 Q:'RSLVED
"RTN","TIUPEVN1",113,0)
 N DIE,DR
"RTN","TIUPEVN1",114,0)
 S DA=+ERRDA,DIE=8925.4,DR=".06////1;.07////"_$$NOW^TIULC D ^DIE
"RTN","TIUPEVN1",115,0)
 Q
"RTN","TIUPEVN1",116,0)
 ;
"RTN","TIUPEVN1",117,0)
WHOGETS(TIUY,TIUTYP) ; ---- Who gets filing error/missing field alerts;
"RTN","TIUPEVN1",118,0)
 ;                      Get 8925.95 (document parameter) recipients.
"RTN","TIUPEVN1",119,0)
 ; ---- TIUTYP is title IFN in 8925.1 if valid title was uploaded, else
"RTN","TIUPEVN1",120,0)
 ;             is IFN of entry from $HDR line:     e.g. PROGRESS NOTES
"RTN","TIUPEVN1",121,0)
 ;      Starts at initial TIUTYP; goes up hierarchy til it finds entry.
"RTN","TIUPEVN1",122,0)
 ; ---- TIU*1*81 Don't new TIUDAD HERE!
"RTN","TIUPEVN1",123,0)
 N TIUI,TIUJ
"RTN","TIUPEVN1",124,0)
 ; ---- TIU*1*81 TIUTITLE is killed before missing fld alerts are sent,
"RTN","TIUPEVN1",125,0)
 ;      so don't use it here
"RTN","TIUPEVN1",126,0)
 Q:+$G(TIUTYP)'>0
"RTN","TIUPEVN1",127,0)
 S TIUI=$O(^TIU(8925.95,"B",+TIUTYP,0))
"RTN","TIUPEVN1",128,0)
 ; ---- If TIUTYP has docmt parameter, get recipients and don't look
"RTN","TIUPEVN1",129,0)
 ;      further up:
"RTN","TIUPEVN1",130,0)
 I +TIUI D  Q
"RTN","TIUPEVN1",131,0)
 . S TIUJ=0
"RTN","TIUPEVN1",132,0)
 . F  S TIUJ=$O(^TIU(8925.95,+TIUI,4,+TIUJ)) Q:+TIUJ'>0  D
"RTN","TIUPEVN1",133,0)
 . . N TIUDUZ
"RTN","TIUPEVN1",134,0)
 . . S TIUDUZ=+$G(^TIU(8925.95,+TIUI,4,+TIUJ,0)) Q:+TIUDUZ'>0
"RTN","TIUPEVN1",135,0)
 . . S TIUY(TIUDUZ)=""
"RTN","TIUPEVN1",136,0)
 ; ---- If none found, try further up
"RTN","TIUPEVN1",137,0)
 S TIUDAD=$O(^TIU(8925.1,"AD",+TIUTYP,0))
"RTN","TIUPEVN1",138,0)
 I +TIUDAD D WHOGETS(.TIUY,TIUDAD)
"RTN","TIUPEVN1",139,0)
 Q
"RTN","TIURC")
0^6^B21953215^B19778021
"RTN","TIURC",1,0)
TIURC ; SLC/JER - Additional Review screen actions ;02/25/10  08:52
"RTN","TIURC",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**1,4,36,48,67,79,58,100,182,232,250**;Jun 20, 1997;Build 14
"RTN","TIURC",3,0)
 ;
"RTN","TIURC",4,0)
 ; ICR #10018    - ^DIE Routine & DIE, DA, DR, DTOUT, & DUOUT Local Vars
"RTN","TIURC",5,0)
 ;     #10117    - EN^VALM, CLEAR^VALM1, & FULL^VALM1  Routines & VALM("ENTITY"),
"RTN","TIURC",6,0)
 ;                 VALMBCK, VALMY, & VALMY( Local Vars
"RTN","TIURC",7,0)
 ;     #10119    - EN^VALM2 Routine & XQORNOD(0) Local Var
"RTN","TIURC",8,0)
 ;
"RTN","TIURC",9,0)
VERIFY ; Verify Documents
"RTN","TIURC",10,0)
 N TIUCHNG,TIUDATA,TIUI,TIUY,Y,DIROUT,TIULST,TIUDAARY
"RTN","TIURC",11,0)
 I '$D(VALMY) D EN^VALM2(XQORNOD(0))
"RTN","TIURC",12,0)
 S TIUI=0
"RTN","TIURC",13,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D  Q:$D(DIROUT)
"RTN","TIURC",14,0)
 . N TIU,TIUDATA,TIUDA,RSTRCTD
"RTN","TIURC",15,0)
 . S TIUDATA=$G(^TMP("TIURIDX",$J,TIUI))
"RTN","TIURC",16,0)
 . S TIUDA=+$P(TIUDATA,U,2) S RSTRCTD=$$DOCRES^TIULRR(TIUDA)
"RTN","TIURC",17,0)
 . I RSTRCTD D  Q
"RTN","TIURC",18,0)
 . . W !!,$C(7),"Ok, no harm done...",!
"RTN","TIURC",19,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURC",20,0)
 . S TIUDAARY(TIUI)=TIUDA
"RTN","TIURC",21,0)
 . S TIUCHNG=0
"RTN","TIURC",22,0)
 . D EN^VALM("TIU VERIFY")
"RTN","TIURC",23,0)
 . K ^TMP("TIUVIEW",$J)
"RTN","TIURC",24,0)
 . I +$G(TIUCHNG) D
"RTN","TIURC",25,0)
 . . S TIULST=$G(TIULST)_$S($G(TIULST)]"":",",1:"")_TIUI
"RTN","TIURC",26,0)
 ; -- Update or Rebuild list, restore video:
"RTN","TIURC",27,0)
 I $G(TIUCHNG("ADDM"))!$G(TIUCHNG("DELETE")) S TIUCHNG("RBLD")=1
"RTN","TIURC",28,0)
 E  S TIUCHNG("UPDATE")=1
"RTN","TIURC",29,0)
 D UPRBLD^TIURL(.TIUCHNG,.VALMY) K VALMY
"RTN","TIURC",30,0)
 S VALMBCK="R"
"RTN","TIURC",31,0)
 D VMSG^TIURS1($G(TIULST),.TIUDAARY,"verified/unverified")
"RTN","TIURC",32,0)
 Q
"RTN","TIURC",33,0)
VERIFY1 ; Single record verify
"RTN","TIURC",34,0)
 ; Receives TIUDA
"RTN","TIURC",35,0)
 N DA,DIE,DR,TIUTYP,TIUQUIT,TIUT0,TIUTNM,TIUVERX
"RTN","TIURC",36,0)
 S TIUTYP=+$G(^TIU(8925,+TIUDA,0)),TIUT0=$G(^TIU(8925.1,+TIUTYP,0))
"RTN","TIURC",37,0)
 S TIUTNM=$$PNAME^TIULC1(+TIUTYP)
"RTN","TIURC",38,0)
 S TIUTYP(1)="1^"_+TIUTYP_U_TIUTNM_U
"RTN","TIURC",39,0)
 I $$DADORKID^TIUGBR(TIUDA) D  Q
"RTN","TIURC",40,0)
 . W !!,$C(7),"This ",TIUTNM," is an interdisciplinary entry.",!,"ID entries must be verified prior to attaching.",!
"RTN","TIURC",41,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIURC",42,0)
 I +$P($G(^TIU(8925,+TIUDA,15)),U)!+$P($G(^(15)),U,7) D  Q
"RTN","TIURC",43,0)
 . W !!,$C(7),"This ",TIUTNM," is already signed.",!
"RTN","TIURC",44,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIURC",45,0)
 ; -- Can't verify admin closed docmts (P182):
"RTN","TIURC",46,0)
 I +$P($G(^TIU(8925,+TIUDA,16)),U,6) D  Q
"RTN","TIURC",47,0)
 . W !!,$C(7),"This ",TIUTNM," is already closed.",!
"RTN","TIURC",48,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") W ""
"RTN","TIURC",49,0)
 I +$P($G(^TIU(8925,+TIUDA,13)),U,5) D  Q
"RTN","TIURC",50,0)
 . W !!,"This ",TIUTNM," is already verified."
"RTN","TIURC",51,0)
 . S TIUY=$$READ^TIUU("YO","Do you want to UNVERIFY this "_TIUTNM,"NO","^D UNVER^TIUDIRH")
"RTN","TIURC",52,0)
 . I TIUY W !,TIUTNM," UNVERIFIED" D
"RTN","TIURC",53,0)
 . . S DA=TIUDA,DIE=8925,DR=".05///UNVERIFIED;1305///@;1306///@" D ^DIE
"RTN","TIURC",54,0)
 . . W "." S TIUCHNG=1
"RTN","TIURC",55,0)
 . . D ALERTDEL^TIUALRT(TIUDA)
"RTN","TIURC",56,0)
 N DUOUT,DIROUT,DTOUT
"RTN","TIURC",57,0)
 S TIUY=$$READ^TIUU("YO","Do you want to edit this "_TIUTNM,"NO")
"RTN","TIURC",58,0)
 I +TIUY D
"RTN","TIURC",59,0)
 . ;VMP/ELR ADDED NEXT 2 LINES TO PROHIBIT EDIT OF SURGERY WHILE VERIFYING
"RTN","TIURC",60,0)
 . NEW TIUMSG S TIUMSG=$$CANDO^TIULP(TIUDA,"EDIT RECORD") I +TIUMSG'>0 D  Q
"RTN","TIURC",61,0)
 . . W !!,$C(7),$P(TIUMSG,U,2),!
"RTN","TIURC",62,0)
 . D GETTIU^TIULD(.TIU,TIUDA),CLEAR^VALM1
"RTN","TIURC",63,0)
 . D DIE^TIUEDI4(TIUDA,.TIUQUIT) ; **100**
"RTN","TIURC",64,0)
 . I $S(+$G(TIUQUIT):1,$D(DUOUT):1,$D(DIROUT):1,$D(DTOUT):1,1:0) Q
"RTN","TIURC",65,0)
 . D RELEASE^TIUT(TIUDA)
"RTN","TIURC",66,0)
 I +TIUY'>0,$S(+$G(TIUQUIT):1,$D(DUOUT):1,$D(DIROUT):1,$D(DTOUT):1,1:0) Q
"RTN","TIURC",67,0)
 S TIUY=$$READ^TIUU("YO","VERIFY this "_TIUTNM,"NO","^D VER^TIUDIRH")
"RTN","TIURC",68,0)
 I 'TIUY W !,TIUTNM," NOT VERIFIED." Q
"RTN","TIURC",69,0)
 S DA=TIUDA,DIE=8925,DR=".05///UNSIGNED;1305////"_$$NOW^TIULC_";1306////"_$G(DUZ) D ^DIE
"RTN","TIURC",70,0)
 S TIUCHNG=1,TIUVERX=$$VERIFY^TIULC1(+$G(^TIU(8925,+TIUDA,0)))
"RTN","TIURC",71,0)
 I TIUVERX]"" X TIUVERX
"RTN","TIURC",72,0)
 I +DA W !,TIUTNM," VERIFIED." D MAIN^TIUPD(DA,"V"),SEND^TIUALRT(DA)
"RTN","TIURC",73,0)
 Q
"RTN","TIURC",74,0)
ADD ; Add Document
"RTN","TIURC",75,0)
 N TIUONCE,TIUNDA,TIUCLASS,TIUCREAT,TIUITEM,LINENO,VALMY,TIUCHNG,RSTRCTD
"RTN","TIURC",76,0)
 ; OK to new TIUCHNG here, this is not used in browse.
"RTN","TIURC",77,0)
 S TIUONCE=1
"RTN","TIURC",78,0)
 S TIUCLASS=$S($G(VALM("ENTITY"))="Progress Note":3,$G(VALM("ENTITY"))="Discharge Summary":244,1:38)
"RTN","TIURC",79,0)
 D FULL^VALM1
"RTN","TIURC",80,0)
 I +$G(DFN) D  Q:+$G(RSTRCTD)
"RTN","TIURC",81,0)
 . S RSTRCTD=$$PTRES^TIULRR(DFN)
"RTN","TIURC",82,0)
 . I RSTRCTD D  Q
"RTN","TIURC",83,0)
 . . W !!,$C(7),"Ok, no harm done...",!
"RTN","TIURC",84,0)
 . . I $$READ^TIUU("EA","RETURN to continue...") ; pause
"RTN","TIURC",85,0)
 ; -- MAIN^TIUEDIT looks like:
"RTN","TIURC",86,0)
 ;    MAIN(TIUCLASS,SUCCESS,DFN,TIUTITLE,EVNTFLAG,NOSAVE,
"RTN","TIURC",87,0)
 ;         TIUNDA,TIUSNGL,TIUCHNG)
"RTN","TIURC",88,0)
 ;    i.e. TIUTITLE,EVNTFLAG,NOSAVE,TIUSNGL are null
"RTN","TIURC",89,0)
 D MAIN^TIUEDIT(TIUCLASS,.TIUCREAT,+$G(DFN),"","","",.TIUNDA,"",.TIUCHNG)
"RTN","TIURC",90,0)
 I $G(TIUCHNG("DELETE"))!$G(TIUCHNG("ADDM"))!$G(TIUCHNG("EXIST"))!$G(TIUCHNG("AVAIL")) S TIUCHNG("RBLD")=1
"RTN","TIURC",91,0)
 I +$O(TIUNDA(0))'>0 S TIUCHNG("REFRESH")=1 G ADDX
"RTN","TIURC",92,0)
 ; -- If in TIU OE/RR REVIEW PN, rebuild list and quit:
"RTN","TIURC",93,0)
 I $G(^TMP("TIUR",$J,"RTN"))="TIUROR" S TIUCHNG("RBLD")=1 G ADDX
"RTN","TIURC",94,0)
 ; -- If in Review Notes by Patient (no review screen),
"RTN","TIURC",95,0)
 ;    or rebuilding, don't add elements to end of screen:
"RTN","TIURC",96,0)
 I '$D(^TMP("TIUR",$J,"RTN")) G ADDX
"RTN","TIURC",97,0)
 I $G(TIUCHNG("RBLD")) G ADDX
"RTN","TIURC",98,0)
 ; -- If in an integrated docmts option, add one line
"RTN","TIURC",99,0)
 ;    to screen for each new docmt, refresh list, and quit:
"RTN","TIURC",100,0)
 S TIUNDA=0
"RTN","TIURC",101,0)
 F  S TIUNDA=$O(TIUNDA(TIUNDA)) Q:+TIUNDA'>0  D
"RTN","TIURC",102,0)
 . S TIUITEM=+$G(^TMP("TIUR",$J,0))
"RTN","TIURC",103,0)
 . ; -- Don't add if editing existing docmt which is already in list:
"RTN","TIURC",104,0)
 . S LINENO=$O(^TMP("TIUR",$J,"IEN",TIUNDA,0))
"RTN","TIURC",105,0)
 . I LINENO D  Q
"RTN","TIURC",106,0)
 . . S VALMY(LINENO)="",TIUCHNG("UPDATE")=1
"RTN","TIURC",107,0)
 . D ADDELMNT^TIUR2(TIUNDA,+TIUITEM,1)
"RTN","TIURC",108,0)
 S TIUCHNG("REFRESH")=1
"RTN","TIURC",109,0)
ADDX D UPRBLD^TIURL(.TIUCHNG,.VALMY)
"RTN","TIURC",110,0)
 Q
"RTN","TIURC",111,0)
COPY1 ; -- Call to COPY1 for backward compatibility
"RTN","TIURC",112,0)
 G COPY1^TIURC1
"RTN","TIURC",113,0)
 Q
"RTN","TIURE")
0^8^B35855160^B29422878
"RTN","TIURE",1,0)
TIURE ; SLC/JER - Error handler actions ;04/23/10  15:11
"RTN","TIURE",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**3,21,81,131,113,184,250**;Jun 20, 1997;Build 14
"RTN","TIURE",3,0)
 ;
"RTN","TIURE",4,0)
 ; ICR #10018    - ^DIE Routine & DIE, DA, DR, DTOUT, & DUOUT local vars
"RTN","TIURE",5,0)
 ;     #10010    - EN1^DIP Routine & BY, DIC, FLDS, FR, L, TO, & IOP local vars
"RTN","TIURE",6,0)
 ;     #10028    - EN^DIWE Routine & DIC & DWPK local vars
"RTN","TIURE",7,0)
 ;     #10118    - EN^VALM, CLEAR^VALM1, & FULL^VALM1  Routines & VALM("ENTITY"),
"RTN","TIURE",8,0)
 ;                 VALMBCK, VALMY, & VALMY( Local Vars
"RTN","TIURE",9,0)
 ;     #10119    - EN^VALM2 Routine & XQORNOD(0) Local Var
"RTN","TIURE",10,0)
 ;     #10081    - DELETEA^XQALERT Routine & XQAKILL & XQAID local vars
"RTN","TIURE",11,0)
 ;
"RTN","TIURE",12,0)
PRINT ; Print Buffer record associated w/unresolved filing error
"RTN","TIURE",13,0)
 N TIUDA,TIUDATA,TIUI,DIROUT,ZTDESC,ZTRTN
"RTN","TIURE",14,0)
 I '$D(VALMY) D EN^VALM2(XQORNOD(0))
"RTN","TIURE",15,0)
 S TIUI=0
"RTN","TIURE",16,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D  Q:$D(DIROUT)
"RTN","TIURE",17,0)
 . S TIUDATA=$G(^TMP("TIUERRIDX",$J,TIUI))
"RTN","TIURE",18,0)
 . S (TIUDA,TIUDA(TIUI))=+$P(TIUDATA,U,3) D RESTORE^TIULM(+$O(@VALMAR@("PICK",TIUI,0)))
"RTN","TIURE",19,0)
 . I +TIUDA'>0!'$D(^TIU(8925.2,+TIUDA,0))!+$P(^TIU(8925.4,+$P(TIUDATA,U,2),0),U,6) W !!,"Item #",+TIUI," is already resolved." K TIUDA(TIUI) H 3 Q
"RTN","TIURE",20,0)
 I $D(TIUDA)'<9 D
"RTN","TIURE",21,0)
 . S ZTRTN="PRINT1^TIURE",ZTDESC="Print Report Buffer"
"RTN","TIURE",22,0)
 . D CLEAR^VALM1,DEVICE^TIUPRDS
"RTN","TIURE",23,0)
 . S TIUI=$$READ^TIUU("FOA","Press RETURN to continue...")
"RTN","TIURE",24,0)
 K VALMY S VALMBCK="R"
"RTN","TIURE",25,0)
 Q
"RTN","TIURE",26,0)
PRINT1 ; Print a single buffer record
"RTN","TIURE",27,0)
 N DIC,TIUI,FLDS,FR,TO,L,BY,IOP S TIUI=0
"RTN","TIURE",28,0)
 F  S TIUI=$O(TIUDA(TIUI)) Q:+TIUI'>0  D
"RTN","TIURE",29,0)
 . S IOP=$S($D(ZTIO):ZTIO,$D(ION):ION,1:"") Q:IOP']""
"RTN","TIURE",30,0)
 . S DIC="^TIU(8925.2,",FLDS="[TIU PRINT REPORT BUFFER]",L=0
"RTN","TIURE",31,0)
 . S BY=.01,(FR,TO)=+$G(^TIU(8925.2,+TIUDA(TIUI),0))
"RTN","TIURE",32,0)
 . D EN1^DIP
"RTN","TIURE",33,0)
 Q
"RTN","TIURE",34,0)
EDIT ; Edit Buffer record associated w/unresolved filing error
"RTN","TIURE",35,0)
 N TIUDA,BUFDA,TIUDATA,TIUI,DIROUT,TIUDI
"RTN","TIURE",36,0)
 I '$D(VALMY) D EN^VALM2(XQORNOD(0))
"RTN","TIURE",37,0)
 S TIUI=0
"RTN","TIURE",38,0)
 F  S TIUI=$O(VALMY(TIUI)) Q:+TIUI'>0  D  Q:$D(DIROUT)
"RTN","TIURE",39,0)
 . N VALMY
"RTN","TIURE",40,0)
 . S TIUDATA=$G(^TMP("TIUERRIDX",$J,TIUI))
"RTN","TIURE",41,0)
 . S BUFDA=+$P(TIUDATA,U,3)
"RTN","TIURE",42,0)
 . W !!,"Resolving Event #",TIUI
"RTN","TIURE",43,0)
 . S TIUDA=+$P(TIUDATA,U,2)
"RTN","TIURE",44,0)
 . D EN^VALM("TIU DISPLAY FILING EVENT")
"RTN","TIURE",45,0)
 . D RESTORE^TIULM(+$O(@VALMAR@("PICK",TIUI,0)))
"RTN","TIURE",46,0)
 W !,"Refreshing the list."
"RTN","TIURE",47,0)
 M TIUDI=^TMP("TIUERR",$J,"DIV")
"RTN","TIURE",48,0)
 D BUILD^TIUELST($P(^TMP("TIUERR",$J,0),U,2),$P(^(0),U,3),TIUEDT,TIULDT,.TIUDI)
"RTN","TIURE",49,0)
 K VALMY S:'$D(VALMBCK) VALMBCK="R"
"RTN","TIURE",50,0)
 Q
"RTN","TIURE",51,0)
EDIT1 ; Single record edit
"RTN","TIURE",52,0)
 ; Receives TIUDATA
"RTN","TIURE",53,0)
 N DIC,ERRDA,ERRTYPE,RETRY,DWPK K XQAKILL
"RTN","TIURE",54,0)
 D FULL^VALM1
"RTN","TIURE",55,0)
 I '$D(TIUPRM0)!'$D(TIUPRM1) D SETPARM^TIULE
"RTN","TIURE",56,0)
 S ERRDA=+$P(TIUDATA,U,2),ERRTYPE=$P(^TIU(8925.4,+ERRDA,0),U,8)
"RTN","TIURE",57,0)
 I +ERRTYPE=0 W !!,"Item #",+TIUDATA," was a successful filing event." H 3 Q
"RTN","TIURE",58,0)
 I +ERRTYPE=1 D FILERR(ERRDA)
"RTN","TIURE",59,0)
 I +ERRTYPE=2 D FLDERR(ERRDA)
"RTN","TIURE",60,0)
 Q
"RTN","TIURE",61,0)
FILERR(ERRDA) ; Resolve filing errors
"RTN","TIURE",62,0)
 N DIC,DIRUT,DWPK,TIUI,INQUIRE,BUFDA,TIUTYPE,RESCODE,TIUDONE
"RTN","TIURE",63,0)
 N TIUEVNT,TIUSKIP,ERR0,RETRY,STATUS,PRFILERR
"RTN","TIURE",64,0)
 ; Set TIUEVNT for PN resolve code:
"RTN","TIURE",65,0)
 S TIUEVNT=+ERRDA
"RTN","TIURE",66,0)
 S TIUI=0,ERR0=$G(^TIU(8925.4,TIUEVNT,0)),STATUS=$P(ERR0,U,6)
"RTN","TIURE",67,0)
 I STATUS=1 W !,"Error has already been resolved.",! Q
"RTN","TIURE",68,0)
 S BUFDA=+$P(ERR0,U,5) I +BUFDA'>0 Q
"RTN","TIURE",69,0)
 I TIUEVNT D  I +$G(TIUDONE)!$G(TIUSKIP) G FILEX
"RTN","TIURE",70,0)
 . D WRITEHDR^TIUPEVNT(TIUEVNT)
"RTN","TIURE",71,0)
 . S TIUTYPE=$P(ERR0,U,3)
"RTN","TIURE",72,0)
 . I $L(TIUTYPE) S TIUTYPE=+$$WHATYPE^TIUPUTPN(TIUTYPE)
"RTN","TIURE",73,0)
 . I TIUTYPE>0 S RESCODE=$$FIXCODE^TIULC1(+TIUTYPE)
"RTN","TIURE",74,0)
 . ;E  S RESCODE="D GETPAT^TIUCHLP"
"RTN","TIURE",75,0)
 . I $G(RESCODE)]"" D  Q
"RTN","TIURE",76,0)
 . . W ! S INQUIRE=$$READ^TIUU("YO","Inquire to patient record","YES","^D INQRHELP^TIUPEVNT")
"RTN","TIURE",77,0)
 . . I $D(DIRUT) S TIUSKIP=1 Q
"RTN","TIURE",78,0)
 . . I +INQUIRE X RESCODE
"RTN","TIURE",79,0)
 . W !!,"Filing error resolution code could not be found for this document type.",!,"Please edit the buffered data directly and refile."
"RTN","TIURE",80,0)
 W !!,"You may now edit the buffered upload data in an attempt to resolve error:",!,$P(ERR0,U,4),!
"RTN","TIURE",81,0)
 I '$$READ^TIUU("EA","Press RETURN to continue and edit the buffer or '^' to exit: ") G FILEX
"RTN","TIURE",82,0)
 S DIC="^TIU(8925.2,"_+BUFDA_",""TEXT"",",DWPK=1 D EN^DIWE
"RTN","TIURE",83,0)
 S RETRY=$$READ^TIUU("YO","Now would you like to retry the filer","YES","^D FIL^TIUDIRH")
"RTN","TIURE",84,0)
 I +RETRY D
"RTN","TIURE",85,0)
 . S PRFILERR=1 ; Tell Patient Record Flag lookup to get flag link
"RTN","TIURE",86,0)
 . D ALERTDEL^TIUPEVNT(+BUFDA),RESOLVE^TIUPEVNT(TIUEVNT)
"RTN","TIURE",87,0)
 . K TIUDONE
"RTN","TIURE",88,0)
 . D FILE^TIUUPLD(+BUFDA)
"RTN","TIURE",89,0)
 . I '$G(TIUDONE) W !,"Old error marked resolved; new error created.  New error may take several more",!,"seconds to file, and may not be within current date/time range.",! H 5
"RTN","TIURE",90,0)
FILEX S VALMBCK="Q" ;TIU*1*81 resolving twice creates errors so don't permit.
"RTN","TIURE",91,0)
 Q
"RTN","TIURE",92,0)
FLDERR(EVNTDA) ; Resolve field errors
"RTN","TIURE",93,0)
 N DIE,DA,DR,ERRDESC,EVNTDA1,EVNTREC,TIUFIX,ERR0,STATUS
"RTN","TIURE",94,0)
 S EVNTDA1=0
"RTN","TIURE",95,0)
 S ERR0=^TIU(8925.4,+EVNTDA,0),STATUS=$P(ERR0,U,6)
"RTN","TIURE",96,0)
 I STATUS=1 W "Error has already been resolved",! Q  ;TIU*1*81
"RTN","TIURE",97,0)
 S ERRDESC=$P(ERR0,U,4)
"RTN","TIURE",98,0)
 W !!,"You may now enter the correct information:",!
"RTN","TIURE",99,0)
 W !,ERRDESC
"RTN","TIURE",100,0)
 F  S EVNTDA1=$O(^TIU(8925.4,EVNTDA,1,EVNTDA1)) Q:+EVNTDA1'>0  D
"RTN","TIURE",101,0)
 . S EVNTREC=$G(^TIU(8925.4,EVNTDA,1,EVNTDA1,0)) Q:+EVNTREC'>0
"RTN","TIURE",102,0)
 . S DIE=$P(EVNTREC,U),DA=$P(EVNTREC,U,2)
"RTN","TIURE",103,0)
 . S DR=$P(EVNTREC,U,3)_"//"_$P(EVNTREC,U,4)
"RTN","TIURE",104,0)
 . I $$FIXED^TIUPEVN1(DIE,+DA,+DR) Q  ;P81 don't ask if already fixed; moved from TIUPEVNT
"RTN","TIURE",105,0)
 . D ^DIE
"RTN","TIURE",106,0)
 . ; P81 If missing field was just corrected, delete alert for that field:
"RTN","TIURE",107,0)
 . S TIUFIX=$$FIXED^TIUPEVN1(DIE,+DA,+DR) ; TIU*1*81 moved from TIUPEVNT
"RTN","TIURE",108,0)
 . I +TIUFIX=1 N XQAKILL,XQAID S XQAKILL=0,XQAID="TIUERR,"_+EVNTDA_","_+EVNTDA1 D DELETEA^XQALERT
"RTN","TIURE",109,0)
 . ; If entry is a TIU Document, do Post-filing action and SEND^TIUALRT
"RTN","TIURE",110,0)
 . I DIE="^TIU(8925," D
"RTN","TIURE",111,0)
 . . N TIUPOST,TIUREC,DR,DIE,TIUD12,TIUD13,TIUAU,TIUEC,TIUEBY
"RTN","TIURE",112,0)
 . . S TIUPOST=$$POSTFILE^TIULC1(+$G(^TIU(8925,DA,0)))
"RTN","TIURE",113,0)
 . . S TIUREC("#")=DA
"RTN","TIURE",114,0)
 . . I TIUPOST]"" X TIUPOST I 1
"RTN","TIURE",115,0)
 . . ;if not entered by the author or expected cosigner record VBC Line Count
"RTN","TIURE",116,0)
 . . S TIUD12=$G(^TIU(8925,DA,12)),TIUD13=$G(^(13))
"RTN","TIURE",117,0)
 . . S TIUEBY=$P(TIUD13,U,2),TIUAU=$P(TIUD12,U,2),TIUEC=$P(TIUD13,U,8)
"RTN","TIURE",118,0)
 . . I ((+TIUEBY>0)&(+TIUAU>0))&((TIUEBY'=TIUAU)&(TIUEBY'=TIUEC)) D LINES^TIUSRVPT(DA)
"RTN","TIURE",119,0)
 . . D SEND^TIUALRT(DA)
"RTN","TIURE",120,0)
 D FLDRSLV^TIUPEVN1(EVNTDA) ; TIU*1*81 moved from TIUPEVNT
"RTN","TIURE",121,0)
 Q
"RTN","TIURVBC")
0^2^B95963171^n/a
"RTN","TIURVBC",1,0)
TIURVBC ;ISL/JER - Visible Black Character Line Count Report ;05/20/10  12:43
"RTN","TIURVBC",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**250**;Jun 20, 1997;Build 14
"RTN","TIURVBC",3,0)
 ;
"RTN","TIURVBC",4,0)
 ; ICR #2055     - $$EXTERNAL^DILFD
"RTN","TIURVBC",5,0)
 ;     #2056     - $$GET1^DIQ
"RTN","TIURVBC",6,0)
 ;     #3799     - $$FMTE^XLFDT
"RTN","TIURVBC",7,0)
 ;     #4558     - $$LEAP^XLFDT3
"RTN","TIURVBC",8,0)
 ;     #4631     - $$NOW^XLFDT
"RTN","TIURVBC",9,0)
 ;     #10000    - %, %I, %T, %Y Local vars
"RTN","TIURVBC",10,0)
 ;     #10063    - ^%ZTLOAD
"RTN","TIURVBC",11,0)
 ;     #10086    - ^%ZIS Routine & IO, IOF, ION, IOSL, & IOST Local Vars
"RTN","TIURVBC",12,0)
 ;     #10089    - ^%ZISC Routine & IO("Q") Local Var
"RTN","TIURVBC",13,0)
 ;     #10104    - $$LOW^XLFSTR, $$UP^XLFSTR
"RTN","TIURVBC",14,0)
 ;     #10112    - $$NAME^VASITE, $$SITE^VASITE
"RTN","TIURVBC",15,0)
 ;     #10114    - %ZIS Local Var
"RTN","TIURVBC",16,0)
 ;
"RTN","TIURVBC",17,0)
MAIN ; Main subroutine
"RTN","TIURVBC",18,0)
 N DIC,DIRUT,BADDIV,SELDIV,TIUEDT,TIULDT,TIUDI,VAUTD,ZTRTN,%I,%T,%Y,POP,TIU1TR,TIUTR,TIUSONLY
"RTN","TIURVBC",19,0)
 S TIUTR=0
"RTN","TIURVBC",20,0)
 W !!,$$CENTER^TIULS("--- Transcription Billing Verification Report ---"),!
"RTN","TIURVBC",21,0)
 D SELDIV^TIULA Q:SELDIV=-1
"RTN","TIURVBC",22,0)
 I +SELDIV=0 D  Q:'$D(TIUDI)
"RTN","TIURVBC",23,0)
 . W !!,"Inconsistencies found between the MEDICAL CENTER DIVISION FILE, the INSTITUTION"
"RTN","TIURVBC",24,0)
 . W !,"FILE and/or STATION NUMBER (TIME SENSITIVE) FILE for the:",!!,$S($G(BADDIV)]"":BADDIV_" division"_$S($L(BADDIV,",")>1:"s",1:""),1:"a division you selected"),"."
"RTN","TIURVBC",25,0)
 . W !!,"Please contact the National Support team."
"RTN","TIURVBC",26,0)
 . I '$D(TIUDI) W ! S:'$$READ^TIUU("E") DIRUT=1
"RTN","TIURVBC",27,0)
 I $D(TIUDI) D
"RTN","TIURVBC",28,0)
 . N TIUK
"RTN","TIURVBC",29,0)
 . S TIUK=0 F  S TIUK=$O(TIUDI(TIUK)) Q:'TIUK  D
"RTN","TIURVBC",30,0)
 . . S TIUDI("INST",TIUDI(TIUK))=TIUK
"RTN","TIURVBC",31,0)
 . . S TIUDI("ENTRIES")=$G(TIUDI("ENTRIES"))_TIUK_";"
"RTN","TIURVBC",32,0)
 E  S TIUDI("ENTRIES")="ALL DIVISIONS"
"RTN","TIURVBC",33,0)
 W !
"RTN","TIURVBC",34,0)
 S TIU1TR=$$READ^TIUU("YA","Specific Transcriptionist(s)? ","NO","Indicate whether you would like to run the report for one or more specific Transcriptionists.")
"RTN","TIURVBC",35,0)
 I $D(DIRUT) Q
"RTN","TIURVBC",36,0)
 I +TIU1TR D TRNSEL(.TIUTR) Q:'+$G(TIUTR)!+$G(DIROUT)
"RTN","TIURVBC",37,0)
 W !
"RTN","TIURVBC",38,0)
 S TIUSONLY=$$READ^TIUU("YA","Print Summary Page Only? ","NO","Indicate whether you would like to see only the Summary Page (i.e., no Details).")
"RTN","TIURVBC",39,0)
 I $D(DIRUT) Q
"RTN","TIURVBC",40,0)
 W !
"RTN","TIURVBC",41,0)
 S TIUEDT=+$$EDATE^TIULA("Transcription","",$$DFLTDT("E"))
"RTN","TIURVBC",42,0)
 W !
"RTN","TIURVBC",43,0)
 I TIUEDT'>0 Q
"RTN","TIURVBC",44,0)
 S TIULDT=+$$LDATE^TIULA("Transcription","",$$DFLTDT("L"))
"RTN","TIURVBC",45,0)
 W !
"RTN","TIURVBC",46,0)
 I TIULDT'>0 Q
"RTN","TIURVBC",47,0)
 S ZTRTN="ENTRY^TIURVBC"
"RTN","TIURVBC",48,0)
DEVICE ; Device handling
"RTN","TIURVBC",49,0)
 ; Call with: ZTRTN
"RTN","TIURVBC",50,0)
 N %ZIS
"RTN","TIURVBC",51,0)
 S %ZIS="Q" D ^%ZIS Q:POP
"RTN","TIURVBC",52,0)
 G:$D(IO("Q")) QUE
"RTN","TIURVBC",53,0)
NOQUE ; Call report directly
"RTN","TIURVBC",54,0)
 D @ZTRTN
"RTN","TIURVBC",55,0)
 Q
"RTN","TIURVBC",56,0)
QUE ; Queue output
"RTN","TIURVBC",57,0)
 N %,ZTDTH,ZTIO,ZTSAVE,ZTSK
"RTN","TIURVBC",58,0)
 Q:'$D(ZTRTN)
"RTN","TIURVBC",59,0)
 K IO("Q") F %="DA","DFN","TIU*" S ZTSAVE(%)=""
"RTN","TIURVBC",60,0)
 S:'$D(ZTDESC) ZTDESC="PRINT TRANSCRIPTION BILLING REPORT" S ZTIO=ION
"RTN","TIURVBC",61,0)
 D ^%ZTLOAD W !,$S($D(ZTSK):"Request Queued!",1:"Request Cancelled!")
"RTN","TIURVBC",62,0)
 K ZTSK,ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE
"RTN","TIURVBC",63,0)
 D HOME^%ZIS
"RTN","TIURVBC",64,0)
 Q
"RTN","TIURVBC",65,0)
TRNSEL(TIUY) ; Select Transcriptionists
"RTN","TIURVBC",66,0)
 N DIRUT,TIUQUIT,TIUPRSN,TIUI,TIUPRMT,TIUVBCUC,TIUSCRN,TIUHLP S (TIUY,TIUI,TIUQUIT)=0
"RTN","TIURVBC",67,0)
 ; Identify User Class for VBC Line Count
"RTN","TIURVBC",68,0)
 S TIUVBCUC=$$GET^XPAR("DIV.`"_DUZ(2)_"^SYS","TIU USER CLASS FOR VBC")
"RTN","TIURVBC",69,0)
 S TIUHLP="Please choose a "_$S(+TIUVBCUC:"KNOWN ",1:"")_"Transcriptionist (Duplicates not allowed)."
"RTN","TIURVBC",70,0)
 S TIUSCRN="I '$D(TIUY(""I"",+Y))"_$S(+TIUVBCUC:",$$ISA^USRLM(+Y,TIUVBCUC)",1:"")
"RTN","TIURVBC",71,0)
 W !!,"Select Transcriptionist(s):",!
"RTN","TIURVBC",72,0)
 F  D  Q:+TIUQUIT
"RTN","TIURVBC",73,0)
 . S TIUI=TIUI+1,TIUPRMT=$J(TIUI,3)_")  "
"RTN","TIURVBC",74,0)
 . S TIUPRSN=$$READ^TIUU("PAO^200:AEMQ",TIUPRMT,"",TIUHLP,TIUSCRN)
"RTN","TIURVBC",75,0)
 . I +TIUPRSN'>0 S TIUQUIT=1 Q
"RTN","TIURVBC",76,0)
 . S TIUY=TIUI,TIUY(TIUI)=TIUPRSN,TIUY("I",+TIUPRSN)=TIUI
"RTN","TIURVBC",77,0)
 W !
"RTN","TIURVBC",78,0)
 Q
"RTN","TIURVBC",79,0)
ENTRY ; Build & Print Report
"RTN","TIURVBC",80,0)
 N TIUA
"RTN","TIURVBC",81,0)
 S TIUA=$NA(^TMP("TIURVBC",$J)) K @TIUA
"RTN","TIURVBC",82,0)
 U IO
"RTN","TIURVBC",83,0)
 D GATHER(.TIUDI,TIUA,TIUEDT,TIULDT,.TIUTR)
"RTN","TIURVBC",84,0)
 D REPORT(TIUA,TIUEDT,TIULDT,TIUSONLY)
"RTN","TIURVBC",85,0)
 K @TIUA
"RTN","TIURVBC",86,0)
 D ^%ZISC
"RTN","TIURVBC",87,0)
 Q
"RTN","TIURVBC",88,0)
DFLTDT(EORL) ; Compute default early or late date
"RTN","TIURVBC",89,0)
 N DOM,MON,YR,FMDT,DFLTDT
"RTN","TIURVBC",90,0)
 S YR=$E(DT,1,3),MON=$E(DT,4,5),DOM=$E(DT,6,7)
"RTN","TIURVBC",91,0)
 I DOM<15 D  I 1
"RTN","TIURVBC",92,0)
 . I +MON=1 S MON=12,YR=YR-1
"RTN","TIURVBC",93,0)
 . E  S MON=MON-1 S:$L(MON)=1 MON="0"_MON
"RTN","TIURVBC",94,0)
 . S DOM=$S(EORL="E":"01",1:$$LDOM(MON,YR))
"RTN","TIURVBC",95,0)
 . S FMDT=YR_MON_DOM_$S(EORL="L":".2359",1:"")
"RTN","TIURVBC",96,0)
 E  D
"RTN","TIURVBC",97,0)
 . I EORL="E" S DOM="01",FMDT=YR_MON_DOM
"RTN","TIURVBC",98,0)
 . E  S DFLTDT="NOW"
"RTN","TIURVBC",99,0)
 I $G(DFLTDT)'="NOW" S DFLTDT=$$FMTE^XLFDT(FMDT)
"RTN","TIURVBC",100,0)
 Q DFLTDT
"RTN","TIURVBC",101,0)
LDOM(MON,YR) ; Calculate last day of month MON
"RTN","TIURVBC",102,0)
 N LEAP,LDOMS S YR=1700+YR,LEAP=$$LEAP^XLFDT3(YR)
"RTN","TIURVBC",103,0)
 S LDOMS="31^"_(LEAP+28)_"^31^30^31^30^31^31^30^31^30^31"
"RTN","TIURVBC",104,0)
 Q $P(LDOMS,U,MON)
"RTN","TIURVBC",105,0)
GATHER(TIUDI,TIUA,TIUEDT,TIULDT,TIUTR) ; Gather records that satisfy criteria
"RTN","TIURVBC",106,0)
 N TIUTDT,TIUVBCUC
"RTN","TIURVBC",107,0)
 ; Insure inclusive early date/time by subtracting one minute before $ORDER
"RTN","TIURVBC",108,0)
 S TIUTDT=$$FMADD^XLFDT(TIUEDT,0,0,-1)
"RTN","TIURVBC",109,0)
 ; Insure inclusive end date/time by appending time of 23:59 if time not indicated
"RTN","TIURVBC",110,0)
 I $L(TIULDT,".")=1 S $P(TIULDT,".",2)="2359"
"RTN","TIURVBC",111,0)
 F  S TIUTDT=$O(^TIU(8925,"VBC",TIUTDT)) Q:+TIUTDT'>0!(+TIUTDT>TIULDT)  D
"RTN","TIURVBC",112,0)
 . N TIUVBC S TIUVBC=0
"RTN","TIURVBC",113,0)
 . F  S TIUVBC=$O(^TIU(8925,"VBC",TIUTDT,TIUVBC)) Q:+TIUVBC'>0  D
"RTN","TIURVBC",114,0)
 . . N TIUDA S TIUDA=0
"RTN","TIURVBC",115,0)
 . . F  S TIUDA=$O(^TIU(8925,"VBC",TIUTDT,TIUVBC,TIUDA)) Q:+TIUDA'>0  D
"RTN","TIURVBC",116,0)
 . . . N TIUAUTH,TIUD0,TIUD12,TIUD13,TIUD14,TIUDIV,TIUEBY,TIUPTNM,TIUTITLE,TIUSVC,TIUPTL4
"RTN","TIURVBC",117,0)
 . . . S TIUD0=$G(^TIU(8925,TIUDA,0)),TIUD12=$G(^(12)),TIUD13=$G(^(13)),TIUD14=$G(^(14))
"RTN","TIURVBC",118,0)
 . . . S TIUAUTH=$P(TIUD12,U,2),TIUDIV=$P(TIUD12,U,12),TIUEBY=$P(TIUD13,U,2)
"RTN","TIURVBC",119,0)
 . . . S TIUSVC=$P(TIUD14,U,4)
"RTN","TIURVBC",120,0)
 . . . I TIUAUTH=TIUEBY Q
"RTN","TIURVBC",121,0)
 . . . I +$G(TIUTR),'$D(TIUTR("I",+TIUEBY)) Q
"RTN","TIURVBC",122,0)
 . . . I $S(TIUDI("ENTRIES")="ALL DIVISIONS":0,$D(TIUDI("INST",+TIUDIV)):0,1:1) Q
"RTN","TIURVBC",123,0)
 . . . ; Identify User Class for VBC Line Count
"RTN","TIURVBC",124,0)
 . . . S TIUVBCUC=$$GET^XPAR($S(TIUDIV]"":"DIV.`"_TIUDIV_"^",1:"")_"SYS","TIU USER CLASS FOR VBC")
"RTN","TIURVBC",125,0)
 . . . ; If User Class defined & document not entered by a member, quit to next document
"RTN","TIURVBC",126,0)
 . . . I TIUVBCUC]"",'+$$ISA^USRLM(TIUEBY,TIUVBCUC) Q
"RTN","TIURVBC",127,0)
 . . . S TIUSVC=$S(TIUSVC]"":$E($$EXTERNAL^DILFD(8925,1404,"",TIUSVC),1,8),1:"UNKNOWN")
"RTN","TIURVBC",128,0)
 . . . S TIUDIV=$S(TIUDIV]"":$$EXTERNAL^DILFD(8925,1212,"",TIUDIV),1:"DIVISION UNKNOWN")
"RTN","TIURVBC",129,0)
 . . . S TIUEBY=$S(TIUEBY]"":$$LOW^XLFSTR($$INITIALS(TIUEBY)),1:"n/a")
"RTN","TIURVBC",130,0)
 . . . S TIUTITLE=$E($$PNAME^TIULC1($P(TIUD0,U)),1,23)
"RTN","TIURVBC",131,0)
 . . . S TIUAUTH=$S(TIUAUTH]"":$$UP^XLFSTR($$INITIALS(TIUAUTH)),1:"N/A")
"RTN","TIURVBC",132,0)
 . . . S TIUPTL4=$E($$GET1^DIQ(2,$P(TIUD0,U,2),.09),6,9) S:TIUPTL4']"" TIUPTL4="UNKN"
"RTN","TIURVBC",133,0)
 . . . S TIUPTNM=$E($$NAME^TIULS($$PTNAME^TIULC1($P(TIUD0,U,2)),"LAST,FIRST MI"),1,19)_"|"_TIUPTL4
"RTN","TIURVBC",134,0)
 . . . S @TIUA@(TIUDIV,TIUEBY,TIUTDT,TIUDA)=TIUTITLE_U_TIUPTNM_U_TIUAUTH_U_TIUVBC_U_TIUSVC
"RTN","TIURVBC",135,0)
 Q
"RTN","TIURVBC",136,0)
INITIALS(TIUX) ; Get Person's initials from file 200
"RTN","TIURVBC",137,0)
 N TIUY S TIUY=$$GET1^DIQ(200,TIUX,1)
"RTN","TIURVBC",138,0)
 Q $S($L(TIUY):TIUY,1:$$NAME^TIULS($$PERSNAME^TIULC1(TIUX),"FIMILI"))
"RTN","TIURVBC",139,0)
REPORT(TIUA,TIUEDT,TIULDT,TIUSONLY) ; Generate report
"RTN","TIURVBC",140,0)
 N TIUDIV,TIUDVBC,TIUDCNT,TIUSVBC,TIUSCNT,TIURTM,DIRUT,DTOUT,TIUSITE,TIUCAT,TIUI,TIUPG
"RTN","TIURVBC",141,0)
 N TIUSHDR,EQLN S $P(EQLN,"-",11)="",TIUPG=0,TIUSONLY=+$G(TIUSONLY)
"RTN","TIURVBC",142,0)
 I $D(ZTQUEUED) S ZTREQ="@" ; Tell TaskMan to delete Task log entry
"RTN","TIURVBC",143,0)
 U IO
"RTN","TIURVBC",144,0)
 S TIURTM=$$NOW^XLFDT,TIUSITE=$S($$NAME^VASITE]"":$$NAME^VASITE,1:$P($$SITE^VASITE,U,2))
"RTN","TIURVBC",145,0)
 I '$D(@TIUA) D  Q
"RTN","TIURVBC",146,0)
 . D HEADER("",TIURTM,TIUEDT,TIULDT,.TIUPG)
"RTN","TIURVBC",147,0)
 . W:$$CONTINUE("",TIURTM,TIUEDT,TIULDT,.TIUPG) !
"RTN","TIURVBC",148,0)
 . W:$$CONTINUE("",TIURTM,TIUEDT,TIULDT,.TIUPG) "No Documents Transcribed for selected Division(s) & Date Range...",!
"RTN","TIURVBC",149,0)
 . I ($E(IOST)="C"),($E(IOSL,1,3)'=999) S:'+$$STOP^TIUU("",1) DIRUT=1
"RTN","TIURVBC",150,0)
 S (TIUDIV,TIUSVBC,TIUSCNT)=0
"RTN","TIURVBC",151,0)
 F  S TIUDIV=$O(@TIUA@(TIUDIV)) Q:TIUDIV']""  D  Q:$D(DIRUT)
"RTN","TIURVBC",152,0)
 . N TIUDTVBC,TIUEBY,TIUEBVBC,TIUEBCNT S TIUEBY="",(TIUDVBC,TIUDCNT)=0
"RTN","TIURVBC",153,0)
 . D:'TIUSONLY HEADER(TIUDIV,TIURTM,TIUEDT,TIULDT,.TIUPG)
"RTN","TIURVBC",154,0)
 . F  S TIUEBY=$O(@TIUA@(TIUDIV,TIUEBY)) Q:TIUEBY']""  D  Q:$D(DIRUT)
"RTN","TIURVBC",155,0)
 . . N TIUTDT S (TIUDTVBC,TIUTDT)=0
"RTN","TIURVBC",156,0)
 . . S TIUEBCNT=+$P($G(@TIUA@(0,"EBY",TIUEBY)),U)
"RTN","TIURVBC",157,0)
 . . S TIUEBVBC=+$P($G(@TIUA@(0,"EBY",TIUEBY)),U,2)
"RTN","TIURVBC",158,0)
 . . W:'TIUSONLY&$$CONTINUE(TIUDIV,TIURTM,TIUEDT,TIULDT,.TIUPG) TIUEBY
"RTN","TIURVBC",159,0)
 . . F  S TIUTDT=$O(@TIUA@(TIUDIV,TIUEBY,TIUTDT)) Q:TIUTDT'>0  D  Q:$D(DIRUT)
"RTN","TIURVBC",160,0)
 . . . N TIUDA S TIUDA=0
"RTN","TIURVBC",161,0)
 . . . F  S TIUDA=$O(@TIUA@(TIUDIV,TIUEBY,TIUTDT,TIUDA)) Q:TIUDA'>0  D  Q:$D(DIRUT)
"RTN","TIURVBC",162,0)
 . . . . N TIUD,TIUTITLE,TIUPTNM,TIUAUTH,TIUVBC,TIUSVC
"RTN","TIURVBC",163,0)
 . . . . S TIUD=$G(@TIUA@(TIUDIV,TIUEBY,TIUTDT,TIUDA))
"RTN","TIURVBC",164,0)
 . . . . S TIUTITLE=$P(TIUD,U),TIUPTNM=$P(TIUD,U,2),TIUAUTH=$P(TIUD,U,3),TIUVBC=$P(TIUD,U,4),TIUSVC=$P(TIUD,U,5)
"RTN","TIURVBC",165,0)
 . . . . S TIUDVBC=TIUDVBC+TIUVBC,TIUDCNT=TIUDCNT+1,@TIUA@(0,"Division",TIUDIV)=TIUDCNT_U_TIUDVBC
"RTN","TIURVBC",166,0)
 . . . . S TIUEBVBC=TIUEBVBC+TIUVBC,TIUEBCNT=TIUEBCNT+1,@TIUA@(0,"EBY",TIUEBY)=TIUEBCNT_U_TIUEBVBC
"RTN","TIURVBC",167,0)
 . . . . S TIUSVBC=TIUSVBC+TIUVBC,TIUSCNT=TIUSCNT+1,@TIUA@(0,"Station",TIUSITE)=TIUSCNT_U_TIUSVBC
"RTN","TIURVBC",168,0)
 . . . . S TIUDTVBC=TIUDTVBC+TIUVBC ; Transcriber total for this division
"RTN","TIURVBC",169,0)
 . . . . W:'TIUSONLY&$$CONTINUE(TIUDIV,TIURTM,TIUEDT,TIULDT,.TIUPG) ?5,$$DATE^TIULS(TIUTDT,"MM/DD/YY"),?14,TIUTITLE,?39,$P(TIUPTNM,"|"),?59,"(",$P(TIUPTNM,"|",2),")",?66,TIUAUTH,?70,$J(TIUVBC,10,2),!
"RTN","TIURVBC",170,0)
 . . Q:$D(DIRUT)
"RTN","TIURVBC",171,0)
 . . W:'TIUSONLY&$$CONTINUE(TIUDIV,TIURTM,TIUEDT,TIULDT,.TIUPG) ?70,EQLN,!
"RTN","TIURVBC",172,0)
 . . W:'TIUSONLY&$$CONTINUE(TIUDIV,TIURTM,TIUEDT,TIULDT,.TIUPG) ?42,"Total for Transcriber ",$J(TIUEBY,3)," = ",?70,$J(TIUDTVBC,10,2),!
"RTN","TIURVBC",173,0)
 . . W:'TIUSONLY&$$CONTINUE(TIUDIV,TIURTM,TIUEDT,TIULDT,.TIUPG) !
"RTN","TIURVBC",174,0)
 . Q:$D(DIRUT)
"RTN","TIURVBC",175,0)
 . W:'TIUSONLY&$$CONTINUE(TIUDIV,TIURTM,TIUEDT,TIULDT,.TIUPG) ?70,EQLN,!
"RTN","TIURVBC",176,0)
 . W:'TIUSONLY&$$CONTINUE(TIUDIV,TIURTM,TIUEDT,TIULDT,.TIUPG) ?49,"Total for Division = ",?70,$J(TIUDVBC,10,2),!
"RTN","TIURVBC",177,0)
 . I 'TIUSONLY,($E(IOST)="C"),($E(IOSL,1,3)'=999) S:'+$$STOP^TIUU("",1) DIRUT=1
"RTN","TIURVBC",178,0)
 I $D(DIRUT)!'$D(@TIUA@(0)) Q
"RTN","TIURVBC",179,0)
 ;Summarize
"RTN","TIURVBC",180,0)
 S TIUCAT="",TIUSHDR="SUMMARY for "_TIUSITE
"RTN","TIURVBC",181,0)
 D HEADER(TIUSHDR,TIURTM,TIUEDT,TIULDT,.TIUPG)
"RTN","TIURVBC",182,0)
 F  S TIUCAT=$O(@TIUA@(0,TIUCAT)) Q:TIUCAT']""  D  Q:$D(DIRUT)
"RTN","TIURVBC",183,0)
 . W:$$CONTINUE(TIUSHDR,TIURTM,TIUEDT,TIULDT,.TIUPG) !,$S(TIUCAT="EBY":"Transcriber",1:TIUCAT)," Totals",!
"RTN","TIURVBC",184,0)
 . S TIUI="" F  S TIUI=$O(@TIUA@(0,TIUCAT,TIUI)) Q:TIUI']""  D
"RTN","TIURVBC",185,0)
 . . N TIUR S TIUR=@TIUA@(0,TIUCAT,TIUI)
"RTN","TIURVBC",186,0)
 . . W:$$CONTINUE(TIUSHDR,TIURTM,TIUEDT,TIULDT,.TIUPG) ?2,TIUI,?48,$P(TIUR,U),?70,$J($P(TIUR,U,2),10,2),!
"RTN","TIURVBC",187,0)
 I ($E(IOST)="C"),($E(IOSL,1,3)'=999) S:'+$$STOP^TIUU("",1) DIRUT=1
"RTN","TIURVBC",188,0)
 Q
"RTN","TIURVBC",189,0)
CONTINUE(TIUDIV,TIURTM,TIUEDT,TIULDT,TIUPG) ; Evaluate relative page position
"RTN","TIURVBC",190,0)
 N TIUY S TIUY=1
"RTN","TIURVBC",191,0)
 I $Y'>(IOSL-3) G CONTX
"RTN","TIURVBC",192,0)
 I $E(IOST)="C" S TIUY=+$$READ^TIUU("E") I $D(DIRUT)!(TIUY'>0) G CONTX
"RTN","TIURVBC",193,0)
 D HEADER(TIUDIV,TIURTM,TIUEDT,TIULDT,.TIUPG)
"RTN","TIURVBC",194,0)
CONTX Q TIUY
"RTN","TIURVBC",195,0)
HEADER(DIVISION,TIURTM,TIUEDT,TIULDT,TIUPG) ; Write Report Header
"RTN","TIURVBC",196,0)
 N TIULINE,TIUDTR S $P(TIULINE,"=",81)="",TIUDTR=$$DATE^TIULS(TIUEDT,"MM/DD/CCYY")_" to "_$$DATE^TIULS(TIULDT,"MM/DD/CCYY")
"RTN","TIURVBC",197,0)
 S TIUPG=TIUPG+1
"RTN","TIURVBC",198,0)
 W @IOF D JUSTIFY^TIUU("Page "_TIUPG,"R") W !
"RTN","TIURVBC",199,0)
 W TIULINE,! D JUSTIFY^TIUU($$TITLE^TIUU("TRANSCRIPTION BILLING REPORT"),"C") W !
"RTN","TIURVBC",200,0)
 D JUSTIFY^TIUU(DIVISION,"C")
"RTN","TIURVBC",201,0)
 W !
"RTN","TIURVBC",202,0)
 W "for Documents Transcribed: ",TIUDTR,?55,"Printed: ",$$DATE^TIULS(TIURTM,"MM/DD/CCYY HR:MIN"),!
"RTN","TIURVBC",203,0)
 W !
"RTN","TIURVBC",204,0)
 I DIVISION'["SUMMARY" W "Tran",?5,"Date",?14,"Title",?39,"Patient",?66,"Aut",?71,"VBC Lines",!
"RTN","TIURVBC",205,0)
 W TIULINE,!
"RTN","TIURVBC",206,0)
 E  W "Category",?48,"Documents",?71,"VBC Lines",!,TIULINE
"RTN","TIURVBC",207,0)
 Q
"RTN","TIUSRV")
0^4^B53540919^B49262888
"RTN","TIUSRV",1,0)
TIUSRV ; SLC/JER - Silent server functions ;09/08/2009
"RTN","TIUSRV",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**1,19,28,87,61,100,109,113,112,184,211,250**;Jun 20, 1997;Build 14
"RTN","TIUSRV",3,0)
 ;
"RTN","TIUSRV",4,0)
 ; ICR #10088    - ENDR^%ZISS Routine & IOINORM, IORVOFF, IORVON Local Vars
"RTN","TIUSRV",5,0)
 ;     #10015    - EN^DIQ1 Routine & DA, DIC,DIQ, & DR Local Vars
"RTN","TIUSRV",6,0)
 ;     #10116    - $$SETSTR^VALM1
"RTN","TIUSRV",7,0)
 ;     #10117    - CNTRL^VALM10,SET^VALM10 & VALM("LINES"), VALMAR, VALMCNT,
"RTN","TIUSRV",8,0)
 ;                 VALMEVL, & VALMQUIT Local Vars
"RTN","TIUSRV",9,0)
 ;     #10104    - $$UP^XLFSTR
"RTN","TIUSRV",10,0)
 ;
"RTN","TIUSRV",11,0)
RPC(TIUY,TIUDA,REASSIGN) ; RPC for DT
"RTN","TIUSRV",12,0)
 N VALMAR,TIUGDATA,TIUGWHOL K ^TMP("TIUAUDIT",$J)
"RTN","TIUSRV",13,0)
 S TIUY=$NA(^TMP("TIUAUDIT",$J))
"RTN","TIUSRV",14,0)
 D GET(TIUDA,1,+$G(REASSIGN))
"RTN","TIUSRV",15,0)
 K ^TMP("VALM VIDEO",$J)
"RTN","TIUSRV",16,0)
 Q
"RTN","TIUSRV",17,0)
GET(TIUDA,HUSH,REASSIGN) ; Build List
"RTN","TIUSRV",18,0)
 N TIUI,TIUL,TIUREC,TIUDADD,X,TIUCPF,ONBROWSE
"RTN","TIUSRV",19,0)
 S (TIUDADD,TIUI,VALMCNT)=0,HUSH=+$G(HUSH)
"RTN","TIUSRV",20,0)
 N DA,DIC,DIQ,DR,TIUNAME K ^TMP("TIUAUDIT",$J)
"RTN","TIUSRV",21,0)
 I '$D(TIUPRM0) D SETPARM^TIULE
"RTN","TIUSRV",22,0)
 I '$D(IOINORM) S X="IOINORM;IOIHI;IORVON;IORVOFF;IOUON;IOUOFF;IOBON;IOBOFF" D ENDR^%ZISS
"RTN","TIUSRV",23,0)
 S:'$D(VALMAR) VALMAR="^TMP(""TIUAUDIT"",$J)"
"RTN","TIUSRV",24,0)
 S VALMEVL=+$G(VALMEVL)
"RTN","TIUSRV",25,0)
 I '$D(^TIU(8925,+TIUDA,0)) S VALMQUIT=1 Q
"RTN","TIUSRV",26,0)
 ; if the document has an OnBrowse Event, execute it
"RTN","TIUSRV",27,0)
 S ONBROWSE=$$ONBROWSE^TIULC1(+$G(^TIU(8925,+TIUDA,0)))
"RTN","TIUSRV",28,0)
 I $L(ONBROWSE) D LOADSUPP(ONBROWSE,TIUDA,.VALMCNT)
"RTN","TIUSRV",29,0)
 ;Set a flag to indicate whether or not a Title is a member of the
"RTN","TIUSRV",30,0)
 ;Clinical Procedures Class (1=Yes and 0=No)
"RTN","TIUSRV",31,0)
 S TIUCPF=+$$ISA^TIULX(+$G(^TIU(8925,TIUDA,0)),+$$CLASS^TIUCP)
"RTN","TIUSRV",32,0)
 S DIC=8925,DIQ="TIUREC(",DA=TIUDA
"RTN","TIUSRV",33,0)
 S DR=".01;.02;.05;.07:.1;1201;1202;1204;1208;1212;1301;1302;1305;1306;1501;1502;1505;1507;1508;1511;1601:1602;1610:1612;1701;1801;89261"
"RTN","TIUSRV",34,0)
 ;If the document is a member of the Clinical Procedures Class, include the
"RTN","TIUSRV",35,0)
 ;Procedure Summary Code field and the Date/Time Performed field
"RTN","TIUSRV",36,0)
 I TIUCPF S DR=DR_";70201;70202"
"RTN","TIUSRV",37,0)
 D EN^DIQ1
"RTN","TIUSRV",38,0)
 S TIUI="" F  S TIUI=$O(TIUREC(8925,+TIUDA,TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRV",39,0)
 . I $G(TIUREC(8925,+TIUDA,TIUI))']"" S TIUREC(8925,+TIUDA,TIUI)="None"
"RTN","TIUSRV",40,0)
 . E  S TIUREC(8925,+TIUDA,TIUI)=$$UP^XLFSTR(TIUREC(8925,+TIUDA,TIUI))
"RTN","TIUSRV",41,0)
 I $D(TIUREC)>9 D
"RTN","TIUSRV",42,0)
 . D SOURCE(.TIUREC,HUSH,.VALMCNT,TIUCPF)
"RTN","TIUSRV",43,0)
 . I '+$G(REASSIGN) D PROBLEM(TIUDA,.VALMCNT) D:$$ISPRFDOC^TIUPRF(TIUDA) LKDETAIL^TIUPRF3(TIUDA,.VALMCNT) D EDIT(TIUDA,.VALMCNT)
"RTN","TIUSRV",44,0)
 . D REASSIGN^TIUSRV1(TIUDA,+$G(REASSIGN),.VALMCNT) Q:+$G(REASSIGN)
"RTN","TIUSRV",45,0)
 . D IDLINK^TIUSRV1(TIUDA,.VALMCNT)
"RTN","TIUSRV",46,0)
 . D SIGN(.TIUREC,.VALMCNT)
"RTN","TIUSRV",47,0)
 . I +$O(^TIU(8925.7,"B",TIUDA,0)) D XTRASIGN(TIUDA,.VALMCNT)
"RTN","TIUSRV",48,0)
 . I $D(^TIU(8925,+TIUDA,16)) D PRIVACY(.TIUREC,.VALMCNT)
"RTN","TIUSRV",49,0)
 . D BODY(TIUDA,.VALMCNT)
"RTN","TIUSRV",50,0)
 S:+$G(VALMCNT)<$G(VALM("LINES")) VALMCNT=$G(VALM("LINES"))
"RTN","TIUSRV",51,0)
 Q
"RTN","TIUSRV",52,0)
LOADSUPP(METHOD,TIUDA,TIUL)     ; Execute OnBrowse/Load Supplementary data
"RTN","TIUSRV",53,0)
 N TIUY,TIUI S TIUI=0
"RTN","TIUSRV",54,0)
 X METHOD I '$D(@TIUY) Q
"RTN","TIUSRV",55,0)
 S TIUL=TIUL+1
"RTN","TIUSRV",56,0)
 D SET(TIUL,1,"Requesting Package Information ",$G(IORVON),$G(IORVOFF))
"RTN","TIUSRV",57,0)
 S TIUL=TIUL+1 D BLANK(TIUL)
"RTN","TIUSRV",58,0)
 F  S TIUI=$O(@TIUY@(TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRV",59,0)
 . S TIUL=+$G(TIUL)+1 D SET(TIUL,1,@TIUY@(TIUI))
"RTN","TIUSRV",60,0)
 S TIUL=TIUL+1 D BLANK(TIUL) S TIUL=TIUL+1
"RTN","TIUSRV",61,0)
 K @TIUY
"RTN","TIUSRV",62,0)
 Q
"RTN","TIUSRV",63,0)
SOURCE(TIUREC,HUSH,TIUL,TIUCPF) ; Source Info
"RTN","TIUSRV",64,0)
 W:'+$G(HUSH) !!,"Opening "_TIUREC(8925,+TIUDA,.01)_" record for review..."
"RTN","TIUSRV",65,0)
 S TIUL=TIUL+1
"RTN","TIUSRV",66,0)
 D SET(TIUL,1,"Source Information ",$G(IORVON),$G(IORVOFF))
"RTN","TIUSRV",67,0)
 D SET(TIUL+1,2," Standard Title: "_$G(TIUREC(8925,TIUDA,89261)))
"RTN","TIUSRV",68,0)
 D SET(TIUL+2,2," Reference Date: "_$G(TIUREC(8925,TIUDA,1301)))
"RTN","TIUSRV",69,0)
 D SET(TIUL+3,2,"     Entry Date: "_$G(TIUREC(8925,TIUDA,1201)))
"RTN","TIUSRV",70,0)
 D SET(TIUL+4,2,"Expected Signer: "_$G(TIUREC(8925,TIUDA,1204)))
"RTN","TIUSRV",71,0)
 D SET(TIUL+5,2,"        Urgency: "_$G(TIUREC(8925,TIUDA,.09)))
"RTN","TIUSRV",72,0)
 D SET(TIUL+6,2,"     Line Count: "_$G(TIUREC(8925,TIUDA,.1)))
"RTN","TIUSRV",73,0)
 D SET(TIUL+7,2,"       Division: "_$G(TIUREC(8925,TIUDA,1212)))
"RTN","TIUSRV",74,0)
 D SET(TIUL+8,2,"        Subject: "_$G(TIUREC(8925,TIUDA,1701)))
"RTN","TIUSRV",75,0)
 ;If the document is a member of the Clinical Procedures Class, include the
"RTN","TIUSRV",76,0)
 ;Procedure Summary Code field and the Date/Time Performed field
"RTN","TIUSRV",77,0)
 I $G(TIUCPF) D
"RTN","TIUSRV",78,0)
 . D BLANK(TIUL+9)
"RTN","TIUSRV",79,0)
 . D SET(TIUL+10,2,"Procedure Summary Code: "_$G(TIUREC(8925,TIUDA,70201)))
"RTN","TIUSRV",80,0)
 . D SET(TIUL+11,2,"   Date/Time Performed: "_$G(TIUREC(8925,TIUDA,70202)))
"RTN","TIUSRV",81,0)
 D SET(TIUL+1,40,"            Author: "_$G(TIUREC(8925,TIUDA,1202)))
"RTN","TIUSRV",82,0)
 D SET(TIUL+2,40,"        Entered By: "_$G(TIUREC(8925,TIUDA,1302)))
"RTN","TIUSRV",83,0)
 D SET(TIUL+3,40," Expected Cosigner: "_$G(TIUREC(8925,TIUDA,1208)))
"RTN","TIUSRV",84,0)
 D SET(TIUL+4,40,"   Document Status: "_$G(TIUREC(8925,TIUDA,.05)))
"RTN","TIUSRV",85,0)
 D SET(TIUL+5,40,"    TIU Document #: "_+$G(TIUDA))
"RTN","TIUSRV",86,0)
 D SET(TIUL+6,40,"    VBC Line Count: "_$G(TIUREC(8925,TIUDA,1801)))
"RTN","TIUSRV",87,0)
 S TIUL=$S(+$G(TIUCPF):TIUL+11,1:TIUL+8)
"RTN","TIUSRV",88,0)
 Q
"RTN","TIUSRV",89,0)
PROBLEM(TIUDA,TIUL) ; Problems
"RTN","TIUSRV",90,0)
 N TIUI,DR,DIC,DIQ,TIUPROB S TIUI=0
"RTN","TIUSRV",91,0)
 S TIUL=TIUL+1 D BLANK(TIUL) S TIUL=TIUL+1
"RTN","TIUSRV",92,0)
 D SET(TIUL,1,"Associated Problems ",$G(IORVON),$G(IORVOFF))
"RTN","TIUSRV",93,0)
 I '+$O(^TIU(8925.9,"B",+TIUDA,0)) D SET(TIUL,25,"No linked problems.")
"RTN","TIUSRV",94,0)
 F  S TIUI=$O(^TIU(8925.9,"B",TIUDA,TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRV",95,0)
 . S DA=TIUI,DR=".02;.05",DIC="^TIU(8925.9,",DIQ="TIUPROB"
"RTN","TIUSRV",96,0)
 . D EN^DIQ1 Q:$D(TIUPROB)'>9
"RTN","TIUSRV",97,0)
 . S TIUL=TIUL+1
"RTN","TIUSRV",98,0)
 . D SET(TIUL,19,$$MIXED^TIULS($G(TIUPROB(8925.9,TIUI,.05))))
"RTN","TIUSRV",99,0)
 . D SET(TIUL,60,$G(TIUPROB(8925.9,TIUI,.02)))
"RTN","TIUSRV",100,0)
 Q
"RTN","TIUSRV",101,0)
EDIT(TIUDA,TIUL) ; Edits
"RTN","TIUSRV",102,0)
 N TIUI,DR,DIC,DIQ,TIUED S TIUI=0
"RTN","TIUSRV",103,0)
 S TIUL=TIUL+1 D BLANK(TIUL) S TIUL=TIUL+1
"RTN","TIUSRV",104,0)
 D SET(TIUL,1,"Edit Information ",$G(IORVON),$G(IORVOFF))
"RTN","TIUSRV",105,0)
 I '+$O(^TIU(8925.5,"B",+TIUDA,0)) D SET(TIUL,22,"No edits since entry.")
"RTN","TIUSRV",106,0)
 F  S TIUI=$O(^TIU(8925.5,"B",TIUDA,TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRV",107,0)
 . S DA=TIUI,DR=".02:03",DIC="^TIU(8925.5,",DIQ="TIUED"
"RTN","TIUSRV",108,0)
 . D EN^DIQ1 Q:$D(TIUED)'>9!($G(TIUED(8925.5,TIUI,.02))']"")
"RTN","TIUSRV",109,0)
 . S TIUL=TIUL+1
"RTN","TIUSRV",110,0)
 . D SET(TIUL,2,"      Edit Date: "_$G(TIUED(8925.5,TIUI,.02)))
"RTN","TIUSRV",111,0)
 . D SET(TIUL,44,"     Edited By: "_$G(TIUED(8925.5,TIUI,.03)))
"RTN","TIUSRV",112,0)
 Q
"RTN","TIUSRV",113,0)
SIGN(TIUREC,TIUL) ; Signature
"RTN","TIUSRV",114,0)
 S TIUL=TIUL+1 D BLANK(TIUL) S TIUL=TIUL+1
"RTN","TIUSRV",115,0)
 D SET(TIUL,1,"Signature Information ",$G(IORVON),$G(IORVOFF))
"RTN","TIUSRV",116,0)
 D SET(TIUL+1,2,"    Signed Date: "_$G(TIUREC(8925,TIUDA,1501)))
"RTN","TIUSRV",117,0)
 D SET(TIUL+3,2,"  Cosigned Date: "_$G(TIUREC(8925,TIUDA,1507)))
"RTN","TIUSRV",118,0)
 D SET(TIUL+1,40,"         Signed By: "_$G(TIUREC(8925,TIUDA,1502)))
"RTN","TIUSRV",119,0)
 D SET(TIUL+2,40,"    Signature Mode: "_$G(TIUREC(8925,TIUDA,1505)))
"RTN","TIUSRV",120,0)
 D SET(TIUL+3,40,"       Cosigned By: "_$G(TIUREC(8925,TIUDA,1508)))
"RTN","TIUSRV",121,0)
 D SET(TIUL+4,40,"  Cosignature Mode: "_$G(TIUREC(8925,TIUDA,1511)))
"RTN","TIUSRV",122,0)
 S TIUL=TIUL+4
"RTN","TIUSRV",123,0)
 Q
"RTN","TIUSRV",124,0)
XTRASIGN(TIUDA,TIUL) ; Additional signers
"RTN","TIUSRV",125,0)
 N TIUI,DA,DR,DIC,DIQ,TIUXTRA
"RTN","TIUSRV",126,0)
 S TIUI=0
"RTN","TIUSRV",127,0)
 S TIUL=TIUL+1 D BLANK(TIUL) S TIUL=TIUL+1
"RTN","TIUSRV",128,0)
 D SET(TIUL,1,"Receipt Acknowledged By ",$G(IORVON),$G(IORVOFF))
"RTN","TIUSRV",129,0)
 F  S TIUI=$O(^TIU(8925.7,"B",TIUDA,TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRV",130,0)
 . S DA=TIUI,DR=".03:.08",DIC="^TIU(8925.7,",DIQ="TIUXTRA"
"RTN","TIUSRV",131,0)
 . D EN^DIQ1 Q:$D(TIUXTRA)'>9
"RTN","TIUSRV",132,0)
 . S TIUL=TIUL+1
"RTN","TIUSRV",133,0)
 . D SET(TIUL,2,"    Signed Date: "_$G(TIUXTRA(8925.7,DA,.04)))
"RTN","TIUSRV",134,0)
 . D SET(TIUL,40,"         Signed By: "_$G(TIUXTRA(8925.7,DA,.06)))
"RTN","TIUSRV",135,0)
 . S TIUL=TIUL+1
"RTN","TIUSRV",136,0)
 . D SET(TIUL,2,"Expected Signer: "_$G(TIUXTRA(8925.7,DA,.03)))
"RTN","TIUSRV",137,0)
 . D SET(TIUL,40,"    Signature Mode: "_$G(TIUXTRA(8925.7,DA,.08)))
"RTN","TIUSRV",138,0)
 Q
"RTN","TIUSRV",139,0)
PRIVACY(TIUREC,TIUL) ; Privacy Act
"RTN","TIUSRV",140,0)
 S TIUL=TIUL+1 D BLANK(TIUL) S TIUL=TIUL+1
"RTN","TIUSRV",141,0)
 D SET(TIUL,1,"Privacy Act Information ",$G(IORVON),$G(IORVOFF))
"RTN","TIUSRV",142,0)
 S TIUL=TIUL+1
"RTN","TIUSRV",143,0)
 D SET(TIUL,2,"   Amended Date: "_$G(TIUREC(8925,TIUDA,1601)))
"RTN","TIUSRV",144,0)
 D SET(TIUL,40,"        Amended By: "_$G(TIUREC(8925,TIUDA,1602)))
"RTN","TIUSRV",145,0)
 S TIUL=TIUL+1
"RTN","TIUSRV",146,0)
 D SET(TIUL,2,"   Deleted Date: "_$G(TIUREC(8925,TIUDA,1611)))
"RTN","TIUSRV",147,0)
 D SET(TIUL,40,"        Deleted By: "_$G(TIUREC(8925,TIUDA,1610)))
"RTN","TIUSRV",148,0)
 S TIUL=TIUL+1
"RTN","TIUSRV",149,0)
 D SET(TIUL,2,"         Reason: "_$G(TIUREC(8925,TIUDA,1612)))
"RTN","TIUSRV",150,0)
 Q
"RTN","TIUSRV",151,0)
BODY(TIUDA,TIUL) ; body of document
"RTN","TIUSRV",152,0)
 N CANSEE
"RTN","TIUSRV",153,0)
 S TIUL=TIUL+1 D BLANK(TIUL) S TIUL=TIUL+1
"RTN","TIUSRV",154,0)
 D SET(TIUL,1,"Document Body ",$G(IORVON),$G(IORVOFF))
"RTN","TIUSRV",155,0)
 S TIUL=TIUL+1 D BLANK(TIUL)
"RTN","TIUSRV",156,0)
 S CANSEE=$$CANDO^TIULP(TIUDA,"VIEW")
"RTN","TIUSRV",157,0)
 I '+CANSEE D NOSEE(CANSEE,.TIUL) Q
"RTN","TIUSRV",158,0)
 I '$D(TIUGDATA) S TIUGDATA=$$IDDATA^TIURECL1(TIUDA)
"RTN","TIUSRV",159,0)
 D LOADREC^TIUBR1(TIUDA,.TIUL,TIUGDATA,$G(TIUGWHOL))
"RTN","TIUSRV",160,0)
 K ^TMP("TIU ADDENDUM",$J)
"RTN","TIUSRV",161,0)
 Q
"RTN","TIUSRV",162,0)
ISCOMP(DA) ; Evaluate whether a given record is a component
"RTN","TIUSRV",163,0)
 N TIUY,TIUTYP
"RTN","TIUSRV",164,0)
 S TIUTYP=+$G(^TIU(8925,DA,0))
"RTN","TIUSRV",165,0)
 S TIUY=$S($P($G(^TIU(8925.1,+TIUTYP,0)),U,4)="CO":1,1:0)
"RTN","TIUSRV",166,0)
 Q TIUY
"RTN","TIUSRV",167,0)
NOSEE(CANSEE,TIUJ) ; When the user shouldn't see the data...
"RTN","TIUSRV",168,0)
 S TIUJ=+$G(TIUJ)+1
"RTN","TIUSRV",169,0)
 D SET(TIUJ,2,$P(CANSEE,U,2))
"RTN","TIUSRV",170,0)
 Q
"RTN","TIUSRV",171,0)
SET(TIULINE,TIUCOL,TIUTEXT,ON,OFF) ; set display info in array
"RTN","TIUSRV",172,0)
 D:'$D(@VALMAR@(TIULINE,0)) BLANK(.TIULINE)
"RTN","TIUSRV",173,0)
 D SET^VALM10(.TIULINE,$$SETSTR^VALM1(.TIUTEXT,@VALMAR@(TIULINE,0),.TIUCOL,$L(TIUTEXT)))
"RTN","TIUSRV",174,0)
 D:$G(ON)]""!($G(OFF)]"") CNTRL^VALM10(.TIULINE,.TIUCOL,$L(TIUTEXT),$G(ON),$G(OFF))
"RTN","TIUSRV",175,0)
 W:'(TIULINE#5)&'+$G(HUSH) "."
"RTN","TIUSRV",176,0)
 Q
"RTN","TIUSRV",177,0)
 ;
"RTN","TIUSRV",178,0)
BLANK(TIULINE) ; blank line
"RTN","TIUSRV",179,0)
 D SET^VALM10(.TIULINE,$J("",80))
"RTN","TIUSRV",180,0)
 Q
"RTN","TIUSRVPT")
0^5^B17935611^B14550631
"RTN","TIUSRVPT",1,0)
TIUSRVPT ; SLC/JER - Set Methods for Documents ;03/02/10  09:59
"RTN","TIUSRVPT",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**122,175,186,210,223,250**;Jun 20, 1997;Build 14
"RTN","TIUSRVPT",3,0)
 ;
"RTN","TIUSRVPT",4,0)
 ; ICR #10018    - DIE Routine & DIE, DR, & DA Local Vars
"RTN","TIUSRVPT",5,0)
 ;     #10103    - $$FMADD^XLFDT,$$NOW^XLFDT
"RTN","TIUSRVPT",6,0)
 ;
"RTN","TIUSRVPT",7,0)
SETTEXT(TIUY,TIUDA,TIUX,SUPPRESS) ; Save Text - use Buffered I/O
"RTN","TIUSRVPT",8,0)
 N PAGES,PAGE S TIUY=0,SUPPRESS=$G(SUPPRESS,0)
"RTN","TIUSRVPT",9,0)
 I $S(+$G(TIUDA)'>0:1,'$D(^TIU(8925,+TIUDA,0)):1,1:0) D  Q
"RTN","TIUSRVPT",10,0)
 . S TIUY="0^0^0^Attempt to file data in a Nonexistent Entry."
"RTN","TIUSRVPT",11,0)
 . D ERROR(TIUY)
"RTN","TIUSRVPT",12,0)
 S PAGE=$P($G(TIUX("HDR")),U),PAGES=$P($G(TIUX("HDR")),U,2)
"RTN","TIUSRVPT",13,0)
 I $S('PAGE:1,'PAGES:1,1:0) D  Q
"RTN","TIUSRVPT",14,0)
 . S TIUY="0^0^0^Invalid text block header"
"RTN","TIUSRVPT",15,0)
 . D ERROR(TIUY)
"RTN","TIUSRVPT",16,0)
 ; I PAGE=1 D MERGTEMP^TIUEDI1(TIUDA) K ^TIU(8925,+TIUDA,"TEMP"),^("TEXT")
"RTN","TIUSRVPT",17,0)
 I PAGE=1 K ^TIU(8925,+TIUDA,"TEMP")
"RTN","TIUSRVPT",18,0)
 M ^TIU(8925,+TIUDA,"TEMP")=TIUX("TEXT")
"RTN","TIUSRVPT",19,0)
 ;if done, commit changes
"RTN","TIUSRVPT",20,0)
 I 'SUPPRESS,(PAGE=PAGES),$D(^TIU(8925,TIUDA,"TEMP")) D
"RTN","TIUSRVPT",21,0)
 . N TIUC,TIUI,TIU,TIUD12,TIUAU,TIUEC S (TIUC,TIUI)=0
"RTN","TIUSRVPT",22,0)
 . F  S TIUI=$O(^TIU(8925,TIUDA,"TEMP",TIUI)) Q:+TIUI'>0  D
"RTN","TIUSRVPT",23,0)
 . . S TIUC=TIUC+1
"RTN","TIUSRVPT",24,0)
 . I TIUC>0 S ^TIU(8925,TIUDA,"TEMP",0)="^^"_TIUC_U_TIUC_U_DT_"^^"
"RTN","TIUSRVPT",25,0)
 . D GETTIU^TIULD(.TIU,TIUDA)
"RTN","TIUSRVPT",26,0)
 . K ^TIU(8925,TIUDA,"TEXT")
"RTN","TIUSRVPT",27,0)
 . S TIUC=0 F  S TIUC=$O(^TIU(8925,"DAD",TIUDA,TIUC)) Q:+TIUC'>0  D
"RTN","TIUSRVPT",28,0)
 . . I +$$ISADDNDM^TIULC1(+TIUC) Q
"RTN","TIUSRVPT",29,0)
 . . K ^TIU(8925,+TIUC,"TEXT")
"RTN","TIUSRVPT",30,0)
 . D MERGTEXT^TIUEDI1(+TIUDA,.TIU)
"RTN","TIUSRVPT",31,0)
 . K ^TIU(8925,TIUDA,"TEMP")
"RTN","TIUSRVPT",32,0)
 . ; If user is neither author or expected cosigner, file VBC Line count
"RTN","TIUSRVPT",33,0)
 . S TIUD12=$G(^TIU(8925,TIUDA,12)),TIUAU=$P(TIUD12,U,2),TIUEC=$P(TIUD12,U,8)
"RTN","TIUSRVPT",34,0)
 . I (TIUAU]""),(DUZ'=TIUAU) D
"RTN","TIUSRVPT",35,0)
 . . I (TIUEC]""),(DUZ=TIUEC) Q
"RTN","TIUSRVPT",36,0)
 . . D LINES(TIUDA)
"RTN","TIUSRVPT",37,0)
 ; Acknowledge success / ask for next page
"RTN","TIUSRVPT",38,0)
 S TIUY=TIUDA_U_PAGE_U_PAGES
"RTN","TIUSRVPT",39,0)
 Q
"RTN","TIUSRVPT",40,0)
LINES(DA) ; Compute/file VBC Line count
"RTN","TIUSRVPT",41,0)
 N DIE,DR S DIE="^TIU(8925,",DR=".1///"_$$LINECNT^TIULC(DA)_";1801///"_$$VBCLINES^TIULC(+DA)
"RTN","TIUSRVPT",42,0)
 D ^DIE
"RTN","TIUSRVPT",43,0)
 Q
"RTN","TIUSRVPT",44,0)
ADMNCLOS(TIUY,TIUDA,MODE,PERSON) ; Post Administrative Closure Information
"RTN","TIUSRVPT",45,0)
 N TIUX,TIUI,TIUCLBY,TIUCLTTL,TIUCAPT
"RTN","TIUSRVPT",46,0)
 I '$D(^TIU(8925,TIUDA)) S TIUY="0^Attempt to file data in a Nonexistent Entry." Q
"RTN","TIUSRVPT",47,0)
 S MODE=$G(MODE,"S")
"RTN","TIUSRVPT",48,0)
 S TIUCAPT=$S("ES"[MODE:"  Electronically Filed: ",1:"Administrative Closure: ")
"RTN","TIUSRVPT",49,0)
 S PERSON=$G(PERSON,DUZ)
"RTN","TIUSRVPT",50,0)
 S TIUCLBY=$$SIGNAME^TIULS(PERSON)
"RTN","TIUSRVPT",51,0)
 S TIUCLTTL=$$SIGTITL^TIULS(PERSON)
"RTN","TIUSRVPT",52,0)
 S TIUX(.05)=7
"RTN","TIUSRVPT",53,0)
 S TIUX(1606)=$G(DT)
"RTN","TIUSRVPT",54,0)
 S TIUX(1607)=TIUCLBY
"RTN","TIUSRVPT",55,0)
 S TIUX(1608)=TIUCLTTL
"RTN","TIUSRVPT",56,0)
 S TIUX(1613)=MODE
"RTN","TIUSRVPT",57,0)
 D FILE^TIUSRVP(.TIUY,TIUDA,.TIUX)
"RTN","TIUSRVPT",58,0)
 S TIUI=$P($G(^TIU(8925,TIUDA,"TEXT",0)),U,3)+1
"RTN","TIUSRVPT",59,0)
 ;If scanned document set document body to informational text
"RTN","TIUSRVPT",60,0)
 I MODE="S" D
"RTN","TIUSRVPT",61,0)
 . S ^TIU(8925,+TIUDA,"TEXT",TIUI,0)=" ",TIUI=TIUI+1
"RTN","TIUSRVPT",62,0)
 . S ^TIU(8925,+TIUDA,"TEXT",TIUI,0)="                           *** SCANNED DOCUMENT ***",TIUI=TIUI+1
"RTN","TIUSRVPT",63,0)
 . S ^TIU(8925,+TIUDA,"TEXT",TIUI,0)="                            SIGNATURE NOT REQUIRED",TIUI=TIUI+1
"RTN","TIUSRVPT",64,0)
 . S ^TIU(8925,+TIUDA,"TEXT",TIUI,0)=" ",TIUI=TIUI+1
"RTN","TIUSRVPT",65,0)
 S ^TIU(8925,TIUDA,"TEXT",TIUI,0)=" ",TIUI=TIUI+1
"RTN","TIUSRVPT",66,0)
 S ^TIU(8925,TIUDA,"TEXT",TIUI,0)=TIUCAPT_$$DATE^TIULS(DT,"MM/DD/CCYY"),TIUI=TIUI+1
"RTN","TIUSRVPT",67,0)
 S ^TIU(8925,TIUDA,"TEXT",TIUI,0)="                    by: "_TIUCLBY,TIUI=TIUI+1
"RTN","TIUSRVPT",68,0)
 S ^TIU(8925,TIUDA,"TEXT",TIUI,0)="                        "_TIUCLTTL
"RTN","TIUSRVPT",69,0)
 S ^TIU(8925,+TIUDA,"TEXT",0)="^^"_TIUI_U_TIUI_U_DT_"^^"
"RTN","TIUSRVPT",70,0)
 D ALERTDEL^TIUALRT(TIUDA)
"RTN","TIUSRVPT",71,0)
 ; post-signature action for administratively closed docs
"RTN","TIUSRVPT",72,0)
 N TIUCONS,TIUSTIS,TIUTTL,TIUPSIG,DA S TIUCONS=-1
"RTN","TIUSRVPT",73,0)
 D ISCNSLT^TIUCNSLT(.TIUCONS,+$G(^TIU(8925,TIUDA,0)))
"RTN","TIUSRVPT",74,0)
 S TIUSTIS=$P($G(^TIU(8925,TIUDA,0)),U,5)
"RTN","TIUSRVPT",75,0)
 S TIUTTL=+$G(^TIU(8925,+TIUDA,0)),TIUPSIG=$$POSTSIGN^TIULC1(TIUTTL)
"RTN","TIUSRVPT",76,0)
 I +$L(TIUPSIG) S DA=TIUDA X TIUPSIG
"RTN","TIUSRVPT",77,0)
 I TIUCONS,TIUSTIS=7,$$HASKIDS^TIUSRVLI(TIUDA) D
"RTN","TIUSRVPT",78,0)
 . N SEQUENCE,TIUKIDS,TIUINT,TIUK
"RTN","TIUSRVPT",79,0)
 . S SEQUENCE="D",TIUKIDS="TIUKIDS",TIUINT=0,TIUK=0
"RTN","TIUSRVPT",80,0)
 . D SETKIDS^TIUSRVLI(TIUKIDS,TIUDA,TIUINT)
"RTN","TIUSRVPT",81,0)
 . F  S TIUK=$O(TIUKIDS(TIUK)) Q:'TIUK  D
"RTN","TIUSRVPT",82,0)
 . . I $P(TIUKIDS(TIUK),U,7)="completed" X TIUPSIG
"RTN","TIUSRVPT",83,0)
 Q
"RTN","TIUSRVPT",84,0)
ERROR(ECODE) ; Register AUTOSAVE Error
"RTN","TIUSRVPT",85,0)
 N ERRDT S ERRDT=+$$NOW^XLFDT
"RTN","TIUSRVPT",86,0)
 Q:+$G(^XTMP("TIUERR","COUNT"))'<100
"RTN","TIUSRVPT",87,0)
 I '$D(^XTMP("TIUERR",0)) D
"RTN","TIUSRVPT",88,0)
 . S ^XTMP("TIUERR",0)=$$FMADD^XLFDT(DT,90)_U_DT
"RTN","TIUSRVPT",89,0)
 S ^XTMP("TIUERR",ERRDT,"ECODE")=ECODE
"RTN","TIUSRVPT",90,0)
 S ^XTMP("TIUERR",ERRDT,"USER")=DUZ
"RTN","TIUSRVPT",91,0)
 S ^XTMP("TIUERR",ERRDT,"TIUDA")=$G(TIUDA,"UNDEFINED")
"RTN","TIUSRVPT",92,0)
 S ^XTMP("TIUERR",ERRDT,"TIUHDR")=$G(TIUX("HDR"))
"RTN","TIUSRVPT",93,0)
 S ^XTMP("TIUERR",ERRDT,"XWBHDR")=$G(XWBS1("HDR"))
"RTN","TIUSRVPT",94,0)
 S ^XTMP("TIUERR","COUNT")=$G(^XTMP("TIUERR","COUNT"))+1
"RTN","TIUSRVPT",95,0)
 Q
"RTN","TIUT")
0^3^B23453629^B18525033
"RTN","TIUT",1,0)
TIUT ; SLC/JER - Release from or Send back to transcription ;03/04/10  09:29
"RTN","TIUT",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**3,4,32,100,250**;Jun 20, 1997;Build 14
"RTN","TIUT",3,0)
 ;
"RTN","TIUT",4,0)
 ; ICR #2053    - ^DIE
"RTN","TIUT",5,0)
 ;     #2324    - $$ISA^USRLM
"RTN","TIUT",6,0)
 ;     #10076   - ^XUSEC("TIU AUTOVERIFY",DUZ) Global Var
"RTN","TIUT",7,0)
 ;
"RTN","TIUT",8,0)
SENDBACK(DA) ; Send Document back to transcription
"RTN","TIUT",9,0)
 N DIE,DR,TIUTYP,TIUSBOK
"RTN","TIUT",10,0)
 I $$DADORKID^TIUGBR(DA) S TIUSBOK="0^You cannot send back interdisciplinary entries. They must be detached first."
"RTN","TIUT",11,0)
 I '$D(TIUSBOK) S TIUSBOK=$$CANDO^TIULP(DA,"SEND BACK")
"RTN","TIUT",12,0)
 I +TIUSBOK'>0 D  Q
"RTN","TIUT",13,0)
 . W !,$C(7),$P(TIUSBOK,U,2) ; Echo denial message
"RTN","TIUT",14,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") W "" ; pause
"RTN","TIUT",15,0)
 L +^TIU(8925,+DA):1
"RTN","TIUT",16,0)
 E  W !?5,$C(7),"Another user is editing this entry." H 3 Q
"RTN","TIUT",17,0)
 S TIUTYP=$P($P(^TIU(8925.1,+^TIU(8925,+DA,0),0),U),U)
"RTN","TIUT",18,0)
 I +$$CANSEND^TIULP1(DA) D
"RTN","TIUT",19,0)
 . S DR=".05///UNRELEASED;1501///@;1306///@;1305///@;1304///@",DIE=8925 D ^DIE
"RTN","TIUT",20,0)
 . W !,TIUTYP," Sent Back." H 2
"RTN","TIUT",21,0)
 . D SENDTRAN^TIUALRT(DA) S TIUCHNG=1
"RTN","TIUT",22,0)
 . ; D UPDTIRT^TIUIRT(.TIU,+DA)
"RTN","TIUT",23,0)
 E  D
"RTN","TIUT",24,0)
 . W !,$C(7),$C(7),$C(7),TIUTYP," Not Sent Back." H 2
"RTN","TIUT",25,0)
 L -^TIU(8925,+DA)
"RTN","TIUT",26,0)
 Q
"RTN","TIUT",27,0)
RELEASE(DA,TIUREL) ; Release Document from transcription
"RTN","TIUT",28,0)
 ; TIUREL=1 ==> Document released
"RTN","TIUT",29,0)
 N DADTYP,DIE,DR,TIUD0,TIUTYP,TIUTNM,TIULINE,TIUDPRM
"RTN","TIUT",30,0)
 S TIUD0=$G(^TIU(8925,+DA,0)),TIUTYP=+TIUD0,TIUTNM=$$PNAME^TIULC1(TIUTYP)
"RTN","TIUT",31,0)
 ; If status is beyond unsigned quit
"RTN","TIUT",32,0)
 I +$P(TIUD0,U,5)>5 Q
"RTN","TIUT",33,0)
 ; If a document is already released quit
"RTN","TIUT",34,0)
 I +$P($G(^TIU(8925,DA,13)),U,4) Q
"RTN","TIUT",35,0)
 ;S TIUREL=$S($G(TIUREL)]"":+$G(TIUREL),+$P($G(^TIU(8925,DA,13)),U,4):1,1:0)
"RTN","TIUT",36,0)
 D DOCPRM^TIULC1(TIUTYP,.TIUDPRM,DA)
"RTN","TIUT",37,0)
 ; If Release is required, and not automatic, prompt user to determine
"RTN","TIUT",38,0)
 ; whether document is ready...
"RTN","TIUT",39,0)
 I '+$G(TIUREL),+$P($G(TIUDPRM(0)),U,2) D  Q:'+TIUREL
"RTN","TIUT",40,0)
 . S TIUREL=$$READ^TIUU("YO","Is this "_TIUTNM_" ready to release from DRAFT","YES","^D REL^TIUDIRH")
"RTN","TIUT",41,0)
 . I '+TIUREL W !," NOT RELEASED." H 2
"RTN","TIUT",42,0)
 ; If release is not required, release automatically this assures alerts
"RTN","TIUT",43,0)
 ; printing, etc. happen appropriately, even for documents where release
"RTN","TIUT",44,0)
 ; from draft is not a "normal" processing step
"RTN","TIUT",45,0)
 I '+$G(TIUREL),'+$P($G(TIUDPRM(0)),U,2) S TIUREL=1
"RTN","TIUT",46,0)
 I +$G(TIUREL) D
"RTN","TIUT",47,0)
 . N TIUVBC,TIUAU,TIUEBY,TIUEC,TIUD12,TIUD13
"RTN","TIUT",48,0)
 . L +^TIU(8925,+DA):1
"RTN","TIUT",49,0)
 . E  W:'$D(ZTQUEUED) !?5,$C(7),"Another user is editing this entry." H 3 Q
"RTN","TIUT",50,0)
 . S TIUD12=$G(^TIU(8925,DA,12)),TIUD13=$G(^(13))
"RTN","TIUT",51,0)
 . S TIUAU=$P(TIUD12,U,2),TIUEC=$P(TIUD12,U,8),TIUEBY=$P(TIUD13,U,2)
"RTN","TIUT",52,0)
 . S TIULINE=$$LINECNT^TIULC(DA),TIUVBC=$$VBCLINES^TIULC(+DA)
"RTN","TIUT",53,0)
 . S DR=".05///"_$S(+$$REQVER^TIULC(+DA,+$P($G(TIUDPRM(0)),U,3)):"UNVERIFIED",1:"UNSIGNED")
"RTN","TIUT",54,0)
 . S DR=DR_";.1////"_TIULINE
"RTN","TIUT",55,0)
 . ; If entered by someone other than the author or expected cosigner, store VBC Line Count
"RTN","TIUT",56,0)
 . I (TIUEBY]""),(TIUAU]""),(TIUEBY'=TIUAU) D
"RTN","TIUT",57,0)
 . . I (TIUEC]""),(TIUEBY=TIUEC) Q
"RTN","TIUT",58,0)
 . . S DR=DR_";1801////"_TIUVBC
"RTN","TIUT",59,0)
 . ; If verification is required and user holds autoverify key, stuff
"RTN","TIUT",60,0)
 . ; verifying clerk and verification date
"RTN","TIUT",61,0)
 . I +$$REQVER^TIULC(+DA,+$P($G(TIUDPRM(0)),U,3)),+$D(^XUSEC("TIU AUTOVERIFY",DUZ)) S DR=DR_";1306////"_DUZ_";1305////"_$$NOW^TIULC
"RTN","TIUT",62,0)
 . S DR=DR_";1304////"_$$NOW^TIULC,DIE=8925 D ^DIE
"RTN","TIUT",63,0)
 . L -^TIU(8925,+DA)
"RTN","TIUT",64,0)
 . I '$D(ZTQUEUED),+$$ISA^USRLM(DUZ,"TRANSCRIPTIONIST") W !,"LINES TYPED: ",TIULINE W:DR[";1801////" !?2,"VBC LINES: ",TIUVBC
"RTN","TIUT",65,0)
 I '$D(ZTQUEUED),(+$P($G(TIUDPRM(0)),U,2)=1) W !,$$PNAME^TIULC1(TIUTYP),$S(+$G(TIUREL):" Released.",1:" Unreleased.") H 2
"RTN","TIUT",66,0)
 I +$G(TIUREL) D
"RTN","TIUT",67,0)
 . N TIURELX
"RTN","TIUT",68,0)
 . S TIURELX=$$RELEASE^TIULC1(+TIUD0)
"RTN","TIUT",69,0)
 . I TIURELX]"" X TIURELX
"RTN","TIUT",70,0)
 . I +$P($G(TIUDPRM(0)),U,8)'>0 D MAIN^TIUPD(+DA,"R")
"RTN","TIUT",71,0)
 . D ALERTDEL^TIUALRT(DA)
"RTN","TIUT",72,0)
 . ;If the document does not require verification, or if the document
"RTN","TIUT",73,0)
 . ;does require verification, but the user holds the AUTOVERIFY key,
"RTN","TIUT",74,0)
 . ;send alerts
"RTN","TIUT",75,0)
 . I $S('+$$REQVER^TIULC(+DA,+$P($G(TIUDPRM(0)),U,3)):1,(+$$REQVER^TIULC(+DA,+$P($G(TIUDPRM(0)),U,3))&$D(^XUSEC("TIU AUTOVERIFY",+DUZ))):1,1:0) D SEND^TIUALRT(DA)
"RTN","TIUT",76,0)
 Q
"RTN","TIUT",77,0)
VERIFY(DA) ; Evaluate requirements for verification, prompt as appropriate
"RTN","TIUT",78,0)
 N DADTYP,TIUTYP,TIUDPRM,TIUTNM,TIUD13,TIUY
"RTN","TIUT",79,0)
 S TIUD13=$G(^TIU(8925,+DA,13))
"RTN","TIUT",80,0)
 S TIUTYP=+$G(^TIU(8925,+DA,0))
"RTN","TIUT",81,0)
 ; I +$$ISADDNDM^TIULC1(DA) D  I 1
"RTN","TIUT",82,0)
 ; . S DADTYP=+$G(^TIU(8925,+$P(^TIU(8925,+DA,0),U,6),0))
"RTN","TIUT",83,0)
 ; . D DOCPRM^TIULC1(DADTYP,.TIUDPRM)
"RTN","TIUT",84,0)
 D DOCPRM^TIULC1(TIUTYP,.TIUDPRM,+DA)
"RTN","TIUT",85,0)
 ; If verification isn't required, or if the user is not authorized to
"RTN","TIUT",86,0)
 ; verify the document, then quit
"RTN","TIUT",87,0)
 I '$D(TIUDPRM(0)) Q
"RTN","TIUT",88,0)
 I '+$$REQVER^TIULC(+DA,+$P(TIUDPRM(0),U,3)) Q
"RTN","TIUT",89,0)
 I '+$$CANDO^TIULP(+DA,"VERIFICATION") Q
"RTN","TIUT",90,0)
 S TIUTNM=$$PNAME^TIULC1(TIUTYP)
"RTN","TIUT",91,0)
 I +$P(TIUD13,U,5) D  I 1
"RTN","TIUT",92,0)
 . W !!,"This "_TIUTNM_" is already verified."
"RTN","TIUT",93,0)
 . S TIUY=$$READ^TIUU("YO","Do you want to UNVERIFY this "_TIUTNM,"NO","^D UNVER^TIUDIRH")
"RTN","TIUT",94,0)
 . I +TIUY W !," UNVERIFIED." D
"RTN","TIUT",95,0)
 . . N DIE,DR
"RTN","TIUT",96,0)
 . . S DIE=8925,DR="1305///@;1306///@" D ^DIE W "."
"RTN","TIUT",97,0)
 . . D ALERTDEL^TIUALRT(DA)
"RTN","TIUT",98,0)
 E  D
"RTN","TIUT",99,0)
 . N DIE,DR,TIUVERX
"RTN","TIUT",100,0)
 . S TIUY=$$READ^TIUU("YO","VERIFY this "_TIUTNM,"NO","^D VER^TIUDIRH")
"RTN","TIUT",101,0)
 . I '+TIUY W !," NOT VERIFIED." Q
"RTN","TIUT",102,0)
 . S DIE=8925,DR=".05///UNSIGNED;1305////"_+$G(DT)_";1306////"_DUZ D ^DIE
"RTN","TIUT",103,0)
 . I +DA W !," VERIFIED." D MAIN^TIUPD(+DA,"V"),SEND^TIUALRT(DA)
"RTN","TIUT",104,0)
 . S TIUVERX=$$VERIFY^TIULC1(+TIUTYP) I TIUVERX]"" X TIUVERX
"RTN","TIUT",105,0)
 Q
"VER")
8.0^22.0
"^DD",8925,8925,1801,0)
VBC LINE COUNT^NJ9,2^^18;1^K:+X'=X!(X>100000)!(X<0)!(X?.E1"."3.N) X
"^DD",8925,8925,1801,3)
Type a number between 0 and 100000, 2 Decimal Digits
"^DD",8925,8925,1801,21,0)
^^8^8^3090804^
"^DD",8925,8925,1801,21,1,0)
A VBC Line is defined as the total number of characters you can see with
"^DD",8925,8925,1801,21,2,0)
the naked eye, divided by 65. It includes any character contained within a
"^DD",8925,8925,1801,21,3,0)
header or footer. Spaces, carriage returns, and hidden format
"^DD",8925,8925,1801,21,4,0)
instructions, such as bold, underline, text boxes, printer configurations,
"^DD",8925,8925,1801,21,5,0)
spell check, etc., are not counted in the total character count. A VBC
"^DD",8925,8925,1801,21,6,0)
Line is calculated by counting all visual characters and simply dividing
"^DD",8925,8925,1801,21,7,0)
the total number of characters by 65 to arrive at the number of defined
"^DD",8925,8925,1801,21,8,0)
lines.
"^DD",8925,8925,1801,"DT")
3090804
"BLD",7486,6)
^235
**END**
**END**
