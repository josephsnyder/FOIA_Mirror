Released OOPS*2*15 SEQ #16
Extracted from mail message
**KIDS**:OOPS*2.0*15^

**INSTALL NAME**
OOPS*2.0*15
"BLD",7619,0)
OOPS*2.0*15^ASISTS^0^3080725^y
"BLD",7619,1,0)
^^2^2^3080430^
"BLD",7619,1,1,0)
This patch contains new privacy act functionality identified by the
"BLD",7619,1,2,0)
ASISTS customer, required modifications to the CA-7, and minor bug fixes.
"BLD",7619,4,0)
^9.64PA^2261.24^6
"BLD",7619,4,2260,0)
2260
"BLD",7619,4,2260,2,0)
^9.641^2260.095^2
"BLD",7619,4,2260,2,2260,0)
ASISTS ACCIDENT REPORTING  (File-top level)
"BLD",7619,4,2260,2,2260,1,0)
^9.6411^144^15
"BLD",7619,4,2260,2,2260,1,90,0)
DATE/TIME STUB CREATED
"BLD",7619,4,2260,2,2260,1,142,0)
DATE/TIME WORK STOPPED
"BLD",7619,4,2260,2,2260,1,143,0)
DATE PAY STOPPED
"BLD",7619,4,2260,2,2260,1,144,0)
DATE 45 DAY PERIOD BEGAN
"BLD",7619,4,2260,2,2260,1,145,0)
DATE/TIME RETURNED TO WORK
"BLD",7619,4,2260,2,2260,1,253,0)
DATE/TIME WORK STOPPED
"BLD",7619,4,2260,2,2260,1,254,0)
DATE/TIME PAY STOPPED
"BLD",7619,4,2260,2,2260,1,256,0)
DATE/TIME RETURNED TO WORK
"BLD",7619,4,2260,2,2260,1,354,0)
WEATHER FACTOR
"BLD",7619,4,2260,2,2260,1,355,0)
SOURCE OF INCIDENT
"BLD",7619,4,2260,2,2260,1,356,0)
CAUSE OF INCIDENT
"BLD",7619,4,2260,2,2260,1,357,0)
ADDITIONAL CAUSE OF INCIDENT
"BLD",7619,4,2260,2,2260,1,358,0)
PREVENTIVE METHOD
"BLD",7619,4,2260,2,2260,1,359,0)
STATUS OF CORRECTIVE ACTION
"BLD",7619,4,2260,2,2260,1,360,0)
SEVERITY OF INJURY
"BLD",7619,4,2260,2,2260.095,0)
INCIDENT OUTCOME  (sub-file)
"BLD",7619,4,2260,2,2260.095,1,0)
^9.6411^8^2
"BLD",7619,4,2260,2,2260.095,1,6,0)
DATE OUTCOME CREATED
"BLD",7619,4,2260,2,2260.095,1,8,0)
LAST EDIT DATE
"BLD",7619,4,2260,222)
y^n^p^^^^n^^n
"BLD",7619,4,2260,224)

"BLD",7619,4,2261.21,0)
2261.21
"BLD",7619,4,2261.21,222)
y^n^f^^n^^y^o^n
"BLD",7619,4,2261.22,0)
2261.22
"BLD",7619,4,2261.22,222)
y^n^f^^n^^y^o^n
"BLD",7619,4,2261.24,0)
2261.24
"BLD",7619,4,2261.24,222)
y^n^f^^n^^y^o^n
"BLD",7619,4,2262,0)
2262
"BLD",7619,4,2262,2,0)
^9.641^2262.315^1
"BLD",7619,4,2262,2,2262.315,0)
OSHA MONTH/YEAR  (sub-file)
"BLD",7619,4,2262,2,2262.315,1,0)
^9.6411^.01^1
"BLD",7619,4,2262,2,2262.315,1,.01,0)
OSHA MONTH/YEAR
"BLD",7619,4,2262,222)
y^n^p^^^^n^^n
"BLD",7619,4,2262,224)

"BLD",7619,4,2264,0)
2264
"BLD",7619,4,2264,2,0)
^9.641^2264^1
"BLD",7619,4,2264,2,2264,0)
ASISTS COMPENSATION CLAIM (CA7)  (File-top level)
"BLD",7619,4,2264,2,2264,1,0)
^9.6411^98^1
"BLD",7619,4,2264,2,2264,1,98,0)
DATE CA7 RCVD FROM EMP
"BLD",7619,4,2264,222)
y^n^p^^^^n^^n
"BLD",7619,4,2264,224)

"BLD",7619,4,"APDD",2260,2260)

"BLD",7619,4,"APDD",2260,2260,90)

"BLD",7619,4,"APDD",2260,2260,142)

"BLD",7619,4,"APDD",2260,2260,143)

"BLD",7619,4,"APDD",2260,2260,144)

"BLD",7619,4,"APDD",2260,2260,145)

"BLD",7619,4,"APDD",2260,2260,253)

"BLD",7619,4,"APDD",2260,2260,254)

"BLD",7619,4,"APDD",2260,2260,256)

"BLD",7619,4,"APDD",2260,2260,354)

"BLD",7619,4,"APDD",2260,2260,355)

"BLD",7619,4,"APDD",2260,2260,356)

"BLD",7619,4,"APDD",2260,2260,357)

"BLD",7619,4,"APDD",2260,2260,358)

"BLD",7619,4,"APDD",2260,2260,359)

"BLD",7619,4,"APDD",2260,2260,360)

"BLD",7619,4,"APDD",2260,2260.095)

"BLD",7619,4,"APDD",2260,2260.095,6)

"BLD",7619,4,"APDD",2260,2260.095,8)

"BLD",7619,4,"APDD",2262,2262.315)

"BLD",7619,4,"APDD",2262,2262.315,.01)

"BLD",7619,4,"APDD",2264,2264)

"BLD",7619,4,"APDD",2264,2264,98)

"BLD",7619,4,"B",2260,2260)

"BLD",7619,4,"B",2261.21,2261.21)

"BLD",7619,4,"B",2261.22,2261.22)

"BLD",7619,4,"B",2261.24,2261.24)

"BLD",7619,4,"B",2262,2262)

"BLD",7619,4,"B",2264,2264)

"BLD",7619,6.3)
9
"BLD",7619,"ABNS",0)
^9.66A^^
"BLD",7619,"ABPKG")
y^n
"BLD",7619,"KRN",0)
^9.67PA^8989.52^19
"BLD",7619,"KRN",.4,0)
.4
"BLD",7619,"KRN",.401,0)
.401
"BLD",7619,"KRN",.402,0)
.402
"BLD",7619,"KRN",.403,0)
.403
"BLD",7619,"KRN",.5,0)
.5
"BLD",7619,"KRN",.84,0)
.84
"BLD",7619,"KRN",3.6,0)
3.6
"BLD",7619,"KRN",3.6,"NM",0)
^9.68A^1^1
"BLD",7619,"KRN",3.6,"NM",1,0)
OOPS INCIDENT OUTCOME REQUIRED^^0
"BLD",7619,"KRN",3.6,"NM","B","OOPS INCIDENT OUTCOME REQUIRED",1)

"BLD",7619,"KRN",3.8,0)
3.8
"BLD",7619,"KRN",9.2,0)
9.2
"BLD",7619,"KRN",9.8,0)
9.8
"BLD",7619,"KRN",9.8,"NM",0)
^9.68A^10^10
"BLD",7619,"KRN",9.8,"NM",1,0)
OOPSGUI0^^0^B43188883
"BLD",7619,"KRN",9.8,"NM",2,0)
OOPSGUI1^^0^B34497400
"BLD",7619,"KRN",9.8,"NM",3,0)
OOPSGUI4^^0^B65551682
"BLD",7619,"KRN",9.8,"NM",4,0)
OOPSGUI5^^0^B38468044
"BLD",7619,"KRN",9.8,"NM",5,0)
OOPSGUI8^^0^B50811506
"BLD",7619,"KRN",9.8,"NM",6,0)
OOPSGUID^^0^B67336971
"BLD",7619,"KRN",9.8,"NM",7,0)
OOPSGUIF^^0^B34611208
"BLD",7619,"KRN",9.8,"NM",8,0)
OOPSMBUL^^0^B24446634
"BLD",7619,"KRN",9.8,"NM",9,0)
OOPSUTL4^^0^B56676889
"BLD",7619,"KRN",9.8,"NM",10,0)
OOPSGUIT^^0^B80073431
"BLD",7619,"KRN",9.8,"NM","B","OOPSGUI0",1)

"BLD",7619,"KRN",9.8,"NM","B","OOPSGUI1",2)

"BLD",7619,"KRN",9.8,"NM","B","OOPSGUI4",3)

"BLD",7619,"KRN",9.8,"NM","B","OOPSGUI5",4)

"BLD",7619,"KRN",9.8,"NM","B","OOPSGUI8",5)

"BLD",7619,"KRN",9.8,"NM","B","OOPSGUID",6)

"BLD",7619,"KRN",9.8,"NM","B","OOPSGUIF",7)

"BLD",7619,"KRN",9.8,"NM","B","OOPSGUIT",10)

"BLD",7619,"KRN",9.8,"NM","B","OOPSMBUL",8)

"BLD",7619,"KRN",9.8,"NM","B","OOPSUTL4",9)

"BLD",7619,"KRN",19,0)
19
"BLD",7619,"KRN",19.1,0)
19.1
"BLD",7619,"KRN",101,0)
101
"BLD",7619,"KRN",409.61,0)
409.61
"BLD",7619,"KRN",771,0)
771
"BLD",7619,"KRN",870,0)
870
"BLD",7619,"KRN",8989.51,0)
8989.51
"BLD",7619,"KRN",8989.52,0)
8989.52
"BLD",7619,"KRN",8994,0)
8994
"BLD",7619,"KRN","B",.4,.4)

"BLD",7619,"KRN","B",.401,.401)

"BLD",7619,"KRN","B",.402,.402)

"BLD",7619,"KRN","B",.403,.403)

"BLD",7619,"KRN","B",.5,.5)

"BLD",7619,"KRN","B",.84,.84)

"BLD",7619,"KRN","B",3.6,3.6)

"BLD",7619,"KRN","B",3.8,3.8)

"BLD",7619,"KRN","B",9.2,9.2)

"BLD",7619,"KRN","B",9.8,9.8)

"BLD",7619,"KRN","B",19,19)

"BLD",7619,"KRN","B",19.1,19.1)

"BLD",7619,"KRN","B",101,101)

"BLD",7619,"KRN","B",409.61,409.61)

"BLD",7619,"KRN","B",771,771)

"BLD",7619,"KRN","B",870,870)

"BLD",7619,"KRN","B",8989.51,8989.51)

"BLD",7619,"KRN","B",8989.52,8989.52)

"BLD",7619,"KRN","B",8994,8994)

"BLD",7619,"QUES",0)
^9.62^^
"BLD",7619,"REQB",0)
^9.611^1^1
"BLD",7619,"REQB",1,0)
OOPS*2.0*11^2
"BLD",7619,"REQB","B","OOPS*2.0*11",1)

"DATA",2261.21,1,0)
Snow/Ice^A
"DATA",2261.21,2,0)
Dust Storm^B
"DATA",2261.21,3,0)
Lightning^C
"DATA",2261.21,4,0)
High Temperature^D
"DATA",2261.21,5,0)
Low Temperature^E
"DATA",2261.21,6,0)
Humidity^F
"DATA",2261.21,7,0)
Fog^H
"DATA",2261.21,8,0)
Rain^J
"DATA",2261.21,9,0)
Windstorm^N
"DATA",2261.21,10,0)
Weather - N.E.C.^P
"DATA",2261.21,11,0)
Weather Not a Factor^Z
"DATA",2261.22,1,0)
Unpowered Equipment, Furnishings, Supplies^01AA
"DATA",2261.22,2,0)
Powered Equipment, Appliances, Machines^11AA
"DATA",2261.22,3,0)
Building Material, Feature or Condition^33AA
"DATA",2261.22,4,0)
Toxic Substance, Radiation Source^44AA
"DATA",2261.22,5,0)
Vehicle^77AA
"DATA",2261.22,6,0)
Person^81AA
"DATA",2261.22,7,0)
Patient Handling^82ZZ
"DATA",2261.24,1,0)
Training^A
"DATA",2261.24,2,0)
More Staff^B
"DATA",2261.24,3,0)
Motivation^C
"DATA",2261.24,4,0)
Better Equipment or Material^D
"DATA",2261.24,5,0)
Better Planning/Coordination^E
"DATA",2261.24,6,0)
Improved written Procedures^F
"DATA",2261.24,7,0)
More Funds for Hazard Elimination^G
"DATA",2261.24,8,0)
Personnel Action^H
"DATA",2261.24,9,0)
Preventive - N.E.C.^I
"DATA",2261.24,10,0)
None^Z
"FIA",2260)
ASISTS ACCIDENT REPORTING
"FIA",2260,0)
^OOPS(2260,
"FIA",2260,0,0)
2260I
"FIA",2260,0,1)
y^n^p^^^^n^^n
"FIA",2260,0,10)

"FIA",2260,0,11)

"FIA",2260,0,"RLRO")

"FIA",2260,0,"VR")
2.0^OOPS
"FIA",2260,2260)
1
"FIA",2260,2260,90)

"FIA",2260,2260,142)

"FIA",2260,2260,143)

"FIA",2260,2260,144)

"FIA",2260,2260,145)

"FIA",2260,2260,253)

"FIA",2260,2260,254)

"FIA",2260,2260,256)

"FIA",2260,2260,354)

"FIA",2260,2260,355)

"FIA",2260,2260,356)

"FIA",2260,2260,357)

"FIA",2260,2260,358)

"FIA",2260,2260,359)

"FIA",2260,2260,360)

"FIA",2260,2260.095)
1
"FIA",2260,2260.095,6)

"FIA",2260,2260.095,8)

"FIA",2261.21)
ASISTS INCIDENT WEATHER FACTORS
"FIA",2261.21,0)
^OOPS(2261.21,
"FIA",2261.21,0,0)
2261.21
"FIA",2261.21,0,1)
y^n^f^^n^^y^o^n
"FIA",2261.21,0,10)

"FIA",2261.21,0,11)

"FIA",2261.21,0,"RLRO")

"FIA",2261.21,0,"VR")
2.0^OOPS
"FIA",2261.21,2261.21)
0
"FIA",2261.22)
ASISTS INCIDENT SOURCE
"FIA",2261.22,0)
^OOPS(2261.22,
"FIA",2261.22,0,0)
2261.22
"FIA",2261.22,0,1)
y^n^f^^n^^y^o^n
"FIA",2261.22,0,10)

"FIA",2261.22,0,11)

"FIA",2261.22,0,"RLRO")

"FIA",2261.22,0,"VR")
2.0^OOPS
"FIA",2261.22,2261.22)
0
"FIA",2261.24)
ASISTS PREVENTION METHODS
"FIA",2261.24,0)
^OOPS(2261.24,
"FIA",2261.24,0,0)
2261.24
"FIA",2261.24,0,1)
y^n^f^^n^^y^o^n
"FIA",2261.24,0,10)

"FIA",2261.24,0,11)

"FIA",2261.24,0,"RLRO")

"FIA",2261.24,0,"VR")
2.0^OOPS
"FIA",2261.24,2261.24)
0
"FIA",2262)
ASISTS SITE PARAMETER
"FIA",2262,0)
^OOPS(2262,
"FIA",2262,0,0)
2262
"FIA",2262,0,1)
y^n^p^^^^n^^n
"FIA",2262,0,10)

"FIA",2262,0,11)

"FIA",2262,0,"RLRO")

"FIA",2262,0,"VR")
2.0^OOPS
"FIA",2262,2262)
1
"FIA",2262,2262.03)
1
"FIA",2262,2262.03,15)

"FIA",2262,2262.315)
1
"FIA",2262,2262.315,.01)

"FIA",2264)
ASISTS COMPENSATION CLAIM (CA7)
"FIA",2264,0)
^OOPS(2264,
"FIA",2264,0,0)
2264
"FIA",2264,0,1)
y^n^p^^^^n^^n
"FIA",2264,0,10)

"FIA",2264,0,11)

"FIA",2264,0,"RLRO")

"FIA",2264,0,"VR")
2.0^OOPS
"FIA",2264,2264)
1
"FIA",2264,2264,98)

"KRN",3.6,288,-1)
0^1
"KRN",3.6,288,0)
OOPS INCIDENT OUTCOME REQUIRED^ASISTS - Incident Outcome Required
"KRN",3.6,288,1,0)
^3.61A^8^8^3080505^^^^
"KRN",3.6,288,1,1,0)
A new incident has been entered or an existing incident has been
"KRN",3.6,288,1,2,0)
modified where the Initial Return to Work Status for the incident
"KRN",3.6,288,1,3,0)
is "Days Away Work" or "Job Transfer/Restriction".
"KRN",3.6,288,1,4,0)
 
"KRN",3.6,288,1,5,0)
The Case Number is: |1|
"KRN",3.6,288,1,6,0)
 
"KRN",3.6,288,1,7,0)
An entry in the Classify Incident Outcome option is required to  
"KRN",3.6,288,1,8,0)
record the dates and the incident outcome for this case. 
"KRN",3.6,288,3,0)
^3.63^4^4^3080505^^^^
"KRN",3.6,288,3,1,0)
This bulletin is sent to the safety group when the response to the
"KRN",3.6,288,3,2,0)
INITIAL RETURN TO WORK STATUS field is "Days Away Work" or 
"KRN",3.6,288,3,3,0)
"Job Transfer/Restriction". It notifies the Safety officer that
"KRN",3.6,288,3,4,0)
Incident Outcome information must be entered for this incident.
"KRN",3.6,288,4,0)
^3.64A^1^1
"KRN",3.6,288,4,1,0)
1
"KRN",3.6,288,4,1,1,0)
^3.65^1^1^3080505^^^^
"KRN",3.6,288,4,1,1,1,0)
Case number of incident
"MBREQ")
0
"ORD",2,3.6)
3.6;2;1;;BUL^XPDTA1;;BULE1^XPDIA1;;;BULDEL^XPDIA1
"ORD",2,3.6,0)
BULLETIN
"PKG",472,-1)
1^1
"PKG",472,0)
ASISTS^OOPS^Automated Safety Incident Surveillance Tracking System
"PKG",472,20,0)
^9.402P^^
"PKG",472,22,0)
^9.49I^1^1
"PKG",472,22,1,0)
2.0^3020709^3030401^66481
"PKG",472,22,1,"PAH",1,0)
15^3080725
"PKG",472,22,1,"PAH",1,1,0)
^^2^2^3080725
"PKG",472,22,1,"PAH",1,1,1,0)
This patch contains new privacy act functionality identified by the
"PKG",472,22,1,"PAH",1,1,2,0)
ASISTS customer, required modifications to the CA-7, and minor bug fixes.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
10
"RTN","OOPSGUI0")
0^1^B43188883^B41861346
"RTN","OOPSGUI0",1,0)
OOPSGUI0 ;WIOFO/LLH-RPC routines ;01/02/02
"RTN","OOPSGUI0",2,0)
 ;;2.0;ASISTS;**2,4,7,15**;Jun 03, 2002;Build 9
"RTN","OOPSGUI0",3,0)
 ;
"RTN","OOPSGUI0",4,0)
GETCASE(RESULTS,PERSON,CSTAT,PSTAT,CALL,OPT) ; Subroutine for Case Selection
"RTN","OOPSGUI0",5,0)
 ; Returns a list of cases that can be displayed for selection
"RTN","OOPSGUI0",6,0)
 ; RESULTS = return array containing, CASE#^IEN^NAME^DATE TIME OCCUR
"RTN","OOPSGUI0",7,0)
 ; PERSON  = 0^ if no person selected
"RTN","OOPSGUI0",8,0)
 ;           1^PERSON INVOLVED NAME
"RTN","OOPSGUI0",9,0)
 ;           2^SUPERVISOR DUZ
"RTN","OOPSGUI0",10,0)
 ;           3^USER SSN
"RTN","OOPSGUI0",11,0)
 ;           4^CASE NUMBER
"RTN","OOPSGUI0",12,0)
 ; CSTAT   = #^#^#^#  0^1^2^3 0=open, 1=closed, 2=deleted, 3=replaced
"RTN","OOPSGUI0",13,0)
 ;           99^ if all Case Status should be included
"RTN","OOPSGUI0",14,0)
 ;           CSTAT is only set programatically
"RTN","OOPSGUI0",15,0)
 ; PSTAT   = 0^  if all personnel status types should be included
"RTN","OOPSGUI0",16,0)
 ;           #^#^#^ for each personnel status selected
"RTN","OOPSGUI0",17,0)
 ; CALL    = Calling menu, used to assure proper access
"RTN","OOPSGUI0",18,0)
 ; OPT     = Option called from, used to assure proper access
"RTN","OOPSGUI0",19,0)
 ; 
"RTN","OOPSGUI0",20,0)
 K ^TMP("OOPSCASE",DUZ)
"RTN","OOPSGUI0",21,0)
 N ARR,CNUM,OOPSDA,PER,STA,SUP,VIEWSUP,VIEWEMP,VALSSN
"RTN","OOPSGUI0",22,0)
 I $G(PERSON)="" Q
"RTN","OOPSGUI0",23,0)
 I +PERSON=1 D GETPER,SORT G EXIT
"RTN","OOPSGUI0",24,0)
 I +PERSON=4 D  G EXIT
"RTN","OOPSGUI0",25,0)
 . S CNUM=$P($G(PERSON),U,2) I '$G(CNUM) Q
"RTN","OOPSGUI0",26,0)
 . S OOPSDA=$O(^OOPS(2260,"B",CNUM,"")) I '$G(OOPSDA) D  Q
"RTN","OOPSGUI0",27,0)
 .. S ^TMP("OOPSCASE",DUZ,1)="No Cases Selectable"
"RTN","OOPSGUI0",28,0)
 .. S RESULTS=$NA(^TMP("OOPSCASE",DUZ))
"RTN","OOPSGUI0",29,0)
 ..; S RESULTS(0)="No Cases Selectable"
"RTN","OOPSGUI0",30,0)
 . S STA=$$GET1^DIQ(2260,OOPSDA,51,"I")
"RTN","OOPSGUI0",31,0)
 . I +CSTAT'=99,(CSTAT'[STA_"^") Q  ;allow only selected case status
"RTN","OOPSGUI0",32,0)
 . I $$CALLER() S ARR(CNUM)=OOPSDA
"RTN","OOPSGUI0",33,0)
 . D SORT
"RTN","OOPSGUI0",34,0)
 S CNUM=0
"RTN","OOPSGUI0",35,0)
 F  S CNUM=$O(^OOPS(2260,"B",CNUM)) Q:CNUM=""  D
"RTN","OOPSGUI0",36,0)
 . S OOPSDA=""
"RTN","OOPSGUI0",37,0)
 . F  S OOPSDA=$O(^OOPS(2260,"B",CNUM,OOPSDA)) Q:OOPSDA=""  D
"RTN","OOPSGUI0",38,0)
 .. I +PERSON=3 D  Q:'VIEWEMP
"RTN","OOPSGUI0",39,0)
 ... S VIEWEMP=1,VALSSN=$P($G(PERSON),U,2)
"RTN","OOPSGUI0",40,0)
 ... I $$GET1^DIQ(2260,OOPSDA,5,"I")'=VALSSN  D
"RTN","OOPSGUI0",41,0)
 .... S VIEWEMP=0
"RTN","OOPSGUI0",42,0)
 .... S ^TMP("OOPSCASE",DUZ,1)="No Cases Selectable"
"RTN","OOPSGUI0",43,0)
 .... S RESULTS=$NA(^TMP("OOPSCASE",DUZ))
"RTN","OOPSGUI0",44,0)
 .. S STA=$$GET1^DIQ(2260,OOPSDA,51,"I")
"RTN","OOPSGUI0",45,0)
 .. I +CSTAT'=99,(CSTAT'[STA_"^") Q  ;allow only selected case status
"RTN","OOPSGUI0",46,0)
 .. S PER=$$GET1^DIQ(2260,OOPSDA,2,"I")
"RTN","OOPSGUI0",47,0)
 .. I (+PSTAT)&(PSTAT'[(PER_"^")) Q      ;allow only selected per status
"RTN","OOPSGUI0",48,0)
 .. I +PERSON=2 D  Q:'VIEWSUP
"RTN","OOPSGUI0",49,0)
 ... S VIEWSUP=1,SUP=$P(PERSON,U,2)
"RTN","OOPSGUI0",50,0)
 ... I $$GET1^DIQ(2260,OOPSDA,53,"I")'=SUP,($$GET1^DIQ(2260,OOPSDA,53.1,"I")'=SUP) D  Q
"RTN","OOPSGUI0",51,0)
 ....; S RESULTS(0)="No Cases Selectable",VIEWSUP=0
"RTN","OOPSGUI0",52,0)
 .... S ^TMP("OOPSCASE",DUZ,1)="No Cases Selectable",VIEWSUP=0
"RTN","OOPSGUI0",53,0)
 .... S RESULTS=$NA(^TMP("OOPSCASE",DUZ))
"RTN","OOPSGUI0",54,0)
 .. I $$CALLER() S CNUM=$$GET1^DIQ(2260,OOPSDA,.01),ARR(CNUM)=OOPSDA
"RTN","OOPSGUI0",55,0)
 D SORT
"RTN","OOPSGUI0",56,0)
EXIT ; quit the routine
"RTN","OOPSGUI0",57,0)
 Q
"RTN","OOPSGUI0",58,0)
GETPER ; Person Name passed in, match
"RTN","OOPSGUI0",59,0)
 ; See above for documentation
"RTN","OOPSGUI0",60,0)
 N NM
"RTN","OOPSGUI0",61,0)
 S OOPSDA="",NM=$P(PERSON,U,2)
"RTN","OOPSGUI0",62,0)
 F  S OOPSDA=$O(^OOPS(2260,"C",NM,OOPSDA)) Q:OOPSDA=""  D
"RTN","OOPSGUI0",63,0)
 . S STA=$$GET1^DIQ(2260,OOPSDA,51,"I")
"RTN","OOPSGUI0",64,0)
 . I +CSTAT'=99,(CSTAT'[STA_"^") Q  ;allow only selected case status
"RTN","OOPSGUI0",65,0)
 . S PER=$$GET1^DIQ(2260,OOPSDA,2,"I")
"RTN","OOPSGUI0",66,0)
 . I (+PSTAT)&(PSTAT'[(PER_"^")) Q      ;allow only selected per status
"RTN","OOPSGUI0",67,0)
 . I $$CALLER() S CNUM=$$GET1^DIQ(2260,OOPSDA,.01),ARR(CNUM)=OOPSDA
"RTN","OOPSGUI0",68,0)
 Q
"RTN","OOPSGUI0",69,0)
CALLER() ; Check to make sure case should be included
"RTN","OOPSGUI0",70,0)
 N EES,ESTAT,FLD,INC,SIG,SSN,VIEWC
"RTN","OOPSGUI0",71,0)
 S VIEWC=1
"RTN","OOPSGUI0",72,0)
 S INC=$$GET1^DIQ(2260,OOPSDA,52,"I")
"RTN","OOPSGUI0",73,0)
 ; get users SSN 
"RTN","OOPSGUI0",74,0)
 S SSN=$$GET1^DIQ(200,DUZ,9)
"RTN","OOPSGUI0",75,0)
 ; make sure user cannot access claim from any menu but Employee
"RTN","OOPSGUI0",76,0)
 I CALL'="E",($$GET1^DIQ(2260,OOPSDA,5,"I")=SSN) S VIEWC=0 Q VIEWC
"RTN","OOPSGUI0",77,0)
 ; Claim already sent to DOL, can't edit, Caller / Option doesnt matter
"RTN","OOPSGUI0",78,0)
 ; unless the Option = "CHGCASE"
"RTN","OOPSGUI0",79,0)
 ; Patch 4 llh - should also be able to create amendment.  NOTE: Case
"RTN","OOPSGUI0",80,0)
 ;               status should always = open
"RTN","OOPSGUI0",81,0)
 ; patch 7 llh - allow access if also opt=iocome
"RTN","OOPSGUI0",82,0)
 I ($$GET1^DIQ(2260,OOPSDA,66)'=""),(OPT'="CHGCASE"),(OPT'="PRINTCA"),(OPT'=2162),(OPT'="CRAMEND"),(OPT'="IOCOME") S VIEWC=0 Q VIEWC
"RTN","OOPSGUI0",83,0)
 ; for any option from the supervisor menu
"RTN","OOPSGUI0",84,0)
 I CALL="S" D  I 'VIEWC Q VIEWC
"RTN","OOPSGUI0",85,0)
 . I $$GET1^DIQ(2260,OOPSDA,53,"I")'=DUZ,($$GET1^DIQ(2260,OOPSDA,53.1,"I")'=DUZ) S VIEWC=0 Q
"RTN","OOPSGUI0",86,0)
 ; if opt = 2162
"RTN","OOPSGUI0",87,0)
 I OPT=2162 D  Q VIEWC
"RTN","OOPSGUI0",88,0)
 . I $$GET1^DIQ(2260,OOPSDA,51,"I")=1 S VIEWC=0  ; closed, can't edit
"RTN","OOPSGUI0",89,0)
 . ; signed SO, coming from Supervisor menu, cant access
"RTN","OOPSGUI0",90,0)
 . I (CALL="S"),+$$EDSTA^OOPSUTL1(OOPSDA,"O") S VIEWC=0
"RTN","OOPSGUI0",91,0)
 . I CALL="H" D
"RTN","OOPSGUI0",92,0)
 .. I $P($$EDSTA^OOPSUTL1(OOPSDA,"S"),U,3)!(+$$EDSTA^OOPSUTL1(OOPSDA,"O")) S VIEWC=0
"RTN","OOPSGUI0",93,0)
 . I CALL="W" D
"RTN","OOPSGUI0",94,0)
 .. I +$$EDSTA^OOPSUTL1(OOPSDA,"O") S VIEWC=0   ;safety signed cant see
"RTN","OOPSGUI0",95,0)
 ; if opt = CA1 only return/allow CA1's, caller doesnt matter
"RTN","OOPSGUI0",96,0)
 I OPT="CA1",INC'=1 S VIEWC=0 Q VIEWC
"RTN","OOPSGUI0",97,0)
 ; if opt = CA2 only return/allow CA2's, caller doesnt matter
"RTN","OOPSGUI0",98,0)
 I OPT="CA2",INC'=2 S VIEWC=0 Q VIEWC
"RTN","OOPSGUI0",99,0)
 I CALL="E" D  Q VIEWC
"RTN","OOPSGUI0",100,0)
 . I '$$ISEMP^OOPSUTL4(OOPSDA) S VIEWC=0 Q
"RTN","OOPSGUI0",101,0)
 . I '$G(SSN) S VIEWC=0 Q
"RTN","OOPSGUI0",102,0)
 . I $D(^OOPS(2260,"SSN",SSN))<1 S VIEWC=0 Q
"RTN","OOPSGUI0",103,0)
 . ; user SSN must = case IEN from Employee menu
"RTN","OOPSGUI0",104,0)
 . I $$GET1^DIQ(2260,OOPSDA,5,"I")'=SSN S VIEWC=0 Q
"RTN","OOPSGUI0",105,0)
 . S SIG=$$EDSTA^OOPSUTL1(OOPSDA,"S")
"RTN","OOPSGUI0",106,0)
 . I (OPT'="PRINTCA"),$P(SIG,U,INC) S VIEWC=0 Q
"RTN","OOPSGUI0",107,0)
 I CALL="S" D  Q VIEWC
"RTN","OOPSGUI0",108,0)
 . ; not Super or Sec Super, can't access form, regardless of form type
"RTN","OOPSGUI0",109,0)
 . I $$GET1^DIQ(2260,OOPSDA,53,"I")'=DUZ&($$GET1^DIQ(2260,OOPSDA,53.1,"I")'=DUZ) S VIEWC=0 Q
"RTN","OOPSGUI0",110,0)
 . ; Supervisor cannot complete their own form.
"RTN","OOPSGUI0",111,0)
 . I $$GET1^DIQ(2260,OOPSDA,5,"I")=SSN S VIEWC=0 Q
"RTN","OOPSGUI0",112,0)
 . I OPT="CA1"!(OPT="CA2") D  Q
"RTN","OOPSGUI0",113,0)
 .. ; if form CA, must be employee to complete
"RTN","OOPSGUI0",114,0)
 .. I '$$ISEMP^OOPSUTL4(OOPSDA) S VIEWC=0 Q
"RTN","OOPSGUI0",115,0)
 .. ; commented out next 2 lines, ? whether wanted by TAG 11/1/01 llh
"RTN","OOPSGUI0",116,0)
 .. ; Employee hasn't signed, super can't get to
"RTN","OOPSGUI0",117,0)
 .. ; I '$P($$EDSTA^OOPSUTL1(OOPSDA,"E"),U,INC) S VIEWC=0 Q
"RTN","OOPSGUI0",118,0)
 .. ; Supervisor has signed, can't re-edit
"RTN","OOPSGUI0",119,0)
 .. I $P($$EDSTA^OOPSUTL1(OOPSDA,"S"),U,INC) S VIEWC=0 Q
"RTN","OOPSGUI0",120,0)
 I CALL="O"!(CALL="W")!(CALL="H") D  Q VIEWC
"RTN","OOPSGUI0",121,0)
 . I OPT="CA1"!(OPT="CA2") D  Q
"RTN","OOPSGUI0",122,0)
 .. I '$$ISEMP^OOPSUTL4(OOPSDA) S VIEWC=0 Q
"RTN","OOPSGUI0",123,0)
 . I OPT="WCSIGN" D  Q
"RTN","OOPSGUI0",124,0)
 .. S ESTAT=$$EDSTA^OOPSUTL1(OOPSDA,"E")
"RTN","OOPSGUI0",125,0)
 .. I '$$ISEMP^OOPSUTL4(OOPSDA) S VIEWC=0 Q
"RTN","OOPSGUI0",126,0)
 .. I CALL'="W",$P(ESTAT,U,INC) S VIEWC=0 Q
"RTN","OOPSGUI0",127,0)
 .. I CALL="W" D
"RTN","OOPSGUI0",128,0)
 ... S FLD=$S(INC=1:119,INC=2:221,1:"") I 'FLD S VIEWC=0 Q
"RTN","OOPSGUI0",129,0)
 ... S EES=$$GET1^DIQ(2260,OOPSDA,FLD,"I")
"RTN","OOPSGUI0",130,0)
 ... ; employee hasn't signed, ok for WC to sign
"RTN","OOPSGUI0",131,0)
 ... I 'EES Q
"RTN","OOPSGUI0",132,0)
 ... ; employee signed, not signed by person accessing claim, no access
"RTN","OOPSGUI0",133,0)
 ... I EES'=DUZ S VIEWC=0 Q
"RTN","OOPSGUI0",134,0)
 ... I $P($$EDSTA^OOPSUTL1(OOPSDA,"S"),U,INC) S VIEWC=0 ;Sup Sign, no acc
"RTN","OOPSGUI0",135,0)
 . I OPT="WCEMPSIGN" D  Q
"RTN","OOPSGUI0",136,0)
 .. N CALLER,SVIEW
"RTN","OOPSGUI0",137,0)
 .. S CALLER=CALL
"RTN","OOPSGUI0",138,0)
 .. I $$GET1^DIQ(2260,OOPSDA,51,"I") S VIEWC=0 Q    ; claim must be open
"RTN","OOPSGUI0",139,0)
 .. ;V2_P15 02/13/08 llh - remove requirement Safety or Occ Health must sign first
"RTN","OOPSGUI0",140,0)
 .. ;I $$GET1^DIQ(2260,OOPSDA,77)="" S VIEWC=0 Q
"RTN","OOPSGUI0",141,0)
 .. ;I $$GET1^DIQ(2260,OOPSDA,80)="" S VIEWC=0 Q
"RTN","OOPSGUI0",142,0)
 .. S SVIEW=$$SCR^OOPSWCSE(OOPSDA) I 'SVIEW S VIEWC=0 Q
"RTN","OOPSGUI0",143,0)
 I CALL="U" D  Q VIEWC
"RTN","OOPSGUI0",144,0)
 . I '+$$EDSTA^OOPSUTL1(OOPSDA,"O") S VIEWC=0 Q
"RTN","OOPSGUI0",145,0)
 . I '$P($$EDSTA^OOPSUTL1(OOPSDA,"S"),U,3) S VIEWC=0 Q
"RTN","OOPSGUI0",146,0)
 Q VIEWC
"RTN","OOPSGUI0",147,0)
SORT ; put cases in reverse number order
"RTN","OOPSGUI0",148,0)
 N CN,CNUM,OOPSDA,SSN,DOI
"RTN","OOPSGUI0",149,0)
 S ^TMP("OOPSCASE",DUZ,0)="",CNUM="",CN=1
"RTN","OOPSGUI0",150,0)
 I '$D(ARR) S RESULTS(0)="No Cases Selectable"  D
"RTN","OOPSGUI0",151,0)
 . S ^TMP("OOPSCASE",DUZ,1)="No Cases Selectable",VIEWSUP=0
"RTN","OOPSGUI0",152,0)
 . S RESULTS=$NA(^TMP("OOPSCASE",DUZ))
"RTN","OOPSGUI0",153,0)
 F  S CNUM=$O(ARR(CNUM),-1) Q:CNUM=""  D
"RTN","OOPSGUI0",154,0)
 . S OOPSDA=ARR(CNUM)
"RTN","OOPSGUI0",155,0)
 . S NM=$$GET1^DIQ(2260,OOPSDA,1)
"RTN","OOPSGUI0",156,0)
 . S DOI=$$GET1^DIQ(2260,OOPSDA,4)
"RTN","OOPSGUI0",157,0)
 . S SSN=$$GET1^DIQ(2260,OOPSDA,5)
"RTN","OOPSGUI0",158,0)
 . I CALL="U" S (NM,DOI,SSN)=""
"RTN","OOPSGUI0",159,0)
 . S ^TMP("OOPSCASE",DUZ,CN)=CNUM_U_DOI_U_NM_U_OOPSDA_U_SSN_$C(10),CN=CN+1
"RTN","OOPSGUI0",160,0)
 S RESULTS=$NA(^TMP("OOPSCASE",DUZ))
"RTN","OOPSGUI0",161,0)
 Q
"RTN","OOPSGUI1")
0^2^B34497400^B34207574
"RTN","OOPSGUI1",1,0)
OOPSGUI1 ;WIOFO/LLH-RPC routines ;9/3/01
"RTN","OOPSGUI1",2,0)
 ;;2.0;ASISTS;**4,8,7,11,15**;Jun 03, 2002;Build 9
"RTN","OOPSGUI1",3,0)
 ;
"RTN","OOPSGUI1",4,0)
OPT(RESULTS,INP) ; Returns the ASISTS GUI Menus user has access to
"RTN","OOPSGUI1",5,0)
 ;      INP      - Input String containing the version of GUI making call
"RTN","OOPSGUI1",6,0)
 ;  RESUTLS      - return value for broker call
"RTN","OOPSGUI1",7,0)
 ;                 P1 = 1 DUZ defined
"RTN","OOPSGUI1",8,0)
 ;                 P2 = 1 Emp Health menu accessible
"RTN","OOPSGUI1",9,0)
 ;                 P3 = 1 Employee menu accessible
"RTN","OOPSGUI1",10,0)
 ;                 P4 = 1 Supervisor menu accessible
"RTN","OOPSGUI1",11,0)
 ;                 P5 = 1 Safety Officer menu accessible
"RTN","OOPSGUI1",12,0)
 ;                 P6 = 1 Union menu accessible
"RTN","OOPSGUI1",13,0)
 ;                 P7 = 1 Workers' Comp menu accessible
"RTN","OOPSGUI1",14,0)
 ;                 P8 = SSN from New Person file for user
"RTN","OOPSGUI1",15,0)
 ;                 P9 = server version #
"RTN","OOPSGUI1",16,0)
 ;
"RTN","OOPSGUI1",17,0)
 N CNT,MENU,OPT,PRIM,SM,VER
"RTN","OOPSGUI1",18,0)
 S CNT=1
"RTN","OOPSGUI1",19,0)
 I 'DUZ S RESULTS="0^^^^^^^" Q
"RTN","OOPSGUI1",20,0)
 S RESULTS=DUZ_"^0^0^0^0^0^0^"
"RTN","OOPSGUI1",21,0)
 ;V2_P15 - changed version to 15
"RTN","OOPSGUI1",22,0)
 S VER="2.15.1.0"        ;Define version check patch #4
"RTN","OOPSGUI1",23,0)
 I $G(INP)=""!($G(INP)'=VER) Q
"RTN","OOPSGUI1",24,0)
 S PRIM=$$GET1^DIQ(200,DUZ,201)     ; get primary menu
"RTN","OOPSGUI1",25,0)
 I $G(PRIM)'="" S MENU(PRIM)=""
"RTN","OOPSGUI1",26,0)
 S SM=0
"RTN","OOPSGUI1",27,0)
 F  S SM=$O(^VA(200,DUZ,203,SM))  Q:SM'>0  D
"RTN","OOPSGUI1",28,0)
 . S OPT=$$GET1^DIQ(19,$P($G(^VA(200,DUZ,203,SM,0)),U),.01)
"RTN","OOPSGUI1",29,0)
 . I $G(OPT)'="" S MENU(OPT)=""
"RTN","OOPSGUI1",30,0)
 I $D(MENU("OOPS GUI EMPLOYEE HEALTH MENU")) S $P(RESULTS,U,2)=1
"RTN","OOPSGUI1",31,0)
 I $D(MENU("OOPS GUI EMPLOYEE")) S $P(RESULTS,U,3)=1
"RTN","OOPSGUI1",32,0)
 I $D(MENU("OOPS GUI SUPERVISOR MENU")) S $P(RESULTS,U,4)=1
"RTN","OOPSGUI1",33,0)
 I $D(MENU("OOPS GUI SAFETY OFFICER MENU")) S $P(RESULTS,U,5)=1
"RTN","OOPSGUI1",34,0)
 I $D(MENU("OOPS GUI UNION MENU")) S $P(RESULTS,U,6)=1
"RTN","OOPSGUI1",35,0)
 I $D(MENU("OOPS GUI WORKERS' COMP MENU")) S $P(RESULTS,U,7)=1
"RTN","OOPSGUI1",36,0)
 I +$$ACCESS^XQCHK(DUZ,"OOPS GUI EMPLOYEE") S $P(RESULTS,U,3)=1
"RTN","OOPSGUI1",37,0)
 S $P(RESULTS,U,8)=$$GET1^DIQ(200,DUZ,9)
"RTN","OOPSGUI1",38,0)
 S $P(RESULTS,U,9)=VER              ;return the version defined above.
"RTN","OOPSGUI1",39,0)
 Q
"RTN","OOPSGUI1",40,0)
SETSIGN(RESULTS,INPUT,SIGN) ; This subroutine validates that the signature
"RTN","OOPSGUI1",41,0)
 ;                         can be entered and is valid
"RTN","OOPSGUI1",42,0)
 ;  Input:   INPUT - Contains the IEN of the ASISTS case, the form type,
"RTN","OOPSGUI1",43,0)
 ;                   and the field number.  The field number is used
"RTN","OOPSGUI1",44,0)
 ;                   to trigger what validation should be preformed on
"RTN","OOPSGUI1",45,0)
 ;                   the fields in the form so that the signature can
"RTN","OOPSGUI1",46,0)
 ;                   be applied. The fourth parameter is a special flag
"RTN","OOPSGUI1",47,0)
 ;                   indicating the Workers Comp is signing for employee
"RTN","OOPSGUI1",48,0)
 ;                   Format is IEN^FORM^FIELD^WCFLAG
"RTN","OOPSGUI1",49,0)
 ;            SIGN - contains the signature test to be encrypted.
"RTN","OOPSGUI1",50,0)
 ; Output: RESULTS - is an array containing a list of fields that did
"RTN","OOPSGUI1",51,0)
 ;                   not pass the data validation and must be corrected
"RTN","OOPSGUI1",52,0)
 ;                   prior to applying a signature.
"RTN","OOPSGUI1",53,0)
 N CALL,DTIME,FDUZ,FDT,FLD,IEN,INC,FORM,ESIG,VALID,CALLER,WOK
"RTN","OOPSGUI1",54,0)
 N DR,DA,DIE,WCFLG
"RTN","OOPSGUI1",55,0)
 S IEN=$P($G(INPUT),U),FORM=$P($G(INPUT),U,2),FLD=$P($G(INPUT),U,3)
"RTN","OOPSGUI1",56,0)
 I '$G(IEN)!('$G(FLD)) S RESULTS(1)="User not Authorized to sign form" Q
"RTN","OOPSGUI1",57,0)
 I FLD=45!(FLD=170)!(FLD=266) S CALL="S"
"RTN","OOPSGUI1",58,0)
 I FLD=49!(FLD=77) S CALL="O"
"RTN","OOPSGUI1",59,0)
 ; Patch 5 ll - added !(FLD=313)!(FLD=320)
"RTN","OOPSGUI1",60,0)
 I FLD=68!(FLD=313)!(FLD=320) S CALL="W"
"RTN","OOPSGUI1",61,0)
 I FLD=80 S CALL="H"
"RTN","OOPSGUI1",62,0)
 ; Patch 5 llh - added !(FLD=310)
"RTN","OOPSGUI1",63,0)
 I FLD=120!(FLD=222)!(FLD=310) S CALL="E"
"RTN","OOPSGUI1",64,0)
 S WCFLG=$P($G(INPUT),U,4)
"RTN","OOPSGUI1",65,0)
 I WCFLG'="W" D
"RTN","OOPSGUI1",66,0)
 .; Patch 5 llh - moved non fld check logic to separate line
"RTN","OOPSGUI1",67,0)
 .; added stuff to check if dual benefits have been signed
"RTN","OOPSGUI1",68,0)
 .I (FLD=120!(FLD=222)) D
"RTN","OOPSGUI1",69,0)
 ..I ($$GET1^DIQ(2260,IEN,71,"I")'="Y") D  Q
"RTN","OOPSGUI1",70,0)
 ...S RESULTS(1)="Claim cannot be signed until the Bill of Rights Statement is understood."
"RTN","OOPSGUI1",71,0)
 ...D WCPBOR^OOPSMBUL(IEN)
"RTN","OOPSGUI1",72,0)
 ;..Commented out Patch 11 cvw
"RTN","OOPSGUI1",73,0)
 ;..I $$GET1^DIQ(2260,IEN,310)="" D  Q
"RTN","OOPSGUI1",74,0)
 ;...S RESULTS(1)="Claim cannot be signed until the Dual Benefits form has been signed."
"RTN","OOPSGUI1",75,0)
 ; check to make sure PAID fields (also Service) not "", if "" get data
"RTN","OOPSGUI1",76,0)
 D CHKPAID
"RTN","OOPSGUI1",77,0)
 S VALID=0
"RTN","OOPSGUI1",78,0)
 S INC=$$GET1^DIQ(2260,IEN,52,"I")
"RTN","OOPSGUI1",79,0)
 ; Patch 5 llh - added ,(FLD'>300)
"RTN","OOPSGUI1",80,0)
 I (FLD'=77),(FLD'=80),(FLD'>300) D  I 'VALID Q
"RTN","OOPSGUI1",81,0)
 .D VALIDATE^OOPSGUI9(IEN,FORM,CALL,.VALID)
"RTN","OOPSGUI1",82,0)
 I $G(SIGN)="" S RESULTS(1)="No Signature Entered" Q
"RTN","OOPSGUI1",83,0)
 S VALID=$$VALIDATE($$DECRYP^XUSRB1(SIGN))
"RTN","OOPSGUI1",84,0)
 I 'VALID D  Q
"RTN","OOPSGUI1",85,0)
 .I $P($G(^VA(200,DUZ,20)),"^",4)="" S RESULTS(1)="No Electronic Signature on File" Q
"RTN","OOPSGUI1",86,0)
 .S RESULTS(1)="Invalid Signature Entered."
"RTN","OOPSGUI1",87,0)
SIGN ; All field validated, file signature
"RTN","OOPSGUI1",88,0)
 I FLD=77 S FDUZ=76,FDT=78             ; Safety approve WC sign
"RTN","OOPSGUI1",89,0)
 I FLD=80 S FDUZ=79,FDT=81             ; EH approve WC sign
"RTN","OOPSGUI1",90,0)
 I FLD=120 S FDUZ=119,FDT=121          ; Employee sign CA1
"RTN","OOPSGUI1",91,0)
 I FLD=222 S FDUZ=221,FDT=223          ; Employee sign CA2
"RTN","OOPSGUI1",92,0)
 I FLD=170 S FDUZ=169,FDT=171          ; Super sign CA1
"RTN","OOPSGUI1",93,0)
 I FLD=266 S FDUZ=265,FDT=267          ; Super sign CA2
"RTN","OOPSGUI1",94,0)
 I FLD=45 S FDUZ=44,FDT=46             ; Super sign 2162
"RTN","OOPSGUI1",95,0)
 I FLD=49 S FDUZ=48,FDT=50             ; Safety sign 2162
"RTN","OOPSGUI1",96,0)
 I FLD=68 S FDUZ=67,FDT=69,WOK=1       ; WC approve to DOL
"RTN","OOPSGUI1",97,0)
 ; patch 5 llh - added next 2 lines (may need more)
"RTN","OOPSGUI1",98,0)
 I FLD=310 S FDUZ=309,FDT=311          ; Emp sign Dual Benefits
"RTN","OOPSGUI1",99,0)
 I FLD=313 S FDUZ=312,FDT=314          ; WC sign Dual Benefits
"RTN","OOPSGUI1",100,0)
 D NOW^%DTC S DTIME=%
"RTN","OOPSGUI1",101,0)
 K DR S DIE="^OOPS(2260,",DA=IEN
"RTN","OOPSGUI1",102,0)
 S DR=FDUZ_"////^S X=+DUZ;"_FLD_"////^S X=ESIG;"_FDT_"////^S X=DTIME"
"RTN","OOPSGUI1",103,0)
 D ^DIE
"RTN","OOPSGUI1",104,0)
 I $G(Y)'="" Q
"RTN","OOPSGUI1",105,0)
 I FLD=68 D WCP^OOPSMBUL(IEN,"S")
"RTN","OOPSGUI1",106,0)
 I FLD=120!(FLD=222) S CALLER=CALL D EMP^OOPSVAL1
"RTN","OOPSGUI1",107,0)
 I FLD=45 D SAFETY^OOPSMBUL(IEN)
"RTN","OOPSGUI1",108,0)
 I (FLD=170)!(FLD=266) D SUPS^OOPSMBUL(IEN),UNION^OOPSMBUL(IEN)
"RTN","OOPSGUI1",109,0)
 Q
"RTN","OOPSGUI1",110,0)
VALIDATE(X) ; Validate Electronic Sign code
"RTN","OOPSGUI1",111,0)
 ;  Input:  X - contains the signature to be validated
"RTN","OOPSGUI1",112,0)
 ; Output: VSIGN - contains a 1 if a valid e-signature, a 0 if not valid
"RTN","OOPSGUI1",113,0)
 N VSIGN
"RTN","OOPSGUI1",114,0)
 S VSIGN=0
"RTN","OOPSGUI1",115,0)
 D HASH^XUSHSHP
"RTN","OOPSGUI1",116,0)
 I X'="",(X=$P($G(^VA(200,DUZ,20)),"^",4)) S VSIGN=1,ESIG=X
"RTN","OOPSGUI1",117,0)
 Q VSIGN
"RTN","OOPSGUI1",118,0)
CHKPAID ; check to make sure PAID fields have data, if not populate
"RTN","OOPSGUI1",119,0)
 ; this subroutine can be removed when go completely to GUI
"RTN","OOPSGUI1",120,0)
 N DA,DIE,DR,CAT,FLD,IEN200,OCCD,PAY,PAYP,RET,SAL,SERV,SSN
"RTN","OOPSGUI1",121,0)
 I $$GET1^DIQ(2260,IEN,60)="" D
"RTN","OOPSGUI1",122,0)
 .S FLD=26,RET="",RET=$$PAID^OOPSUTL1(IEN,FLD)
"RTN","OOPSGUI1",123,0)
 .S RET=$S(RET="FULL CSRS":"CSRS",RET="FERS":"FERS",1:"OTHER")
"RTN","OOPSGUI1",124,0)
 .S DIE="^OOPS(2260,",DA=IEN,DR="60///^S X=RET" D ^DIE
"RTN","OOPSGUI1",125,0)
 I $$GET1^DIQ(2260,IEN,86)="" D
"RTN","OOPSGUI1",126,0)
 .S SERV="",SSN=$$GET1^DIQ(2260,IEN,5,"I")
"RTN","OOPSGUI1",127,0)
 .I $G(SSN) S IEN200=$O(^VA(200,"SSN",SSN,""))
"RTN","OOPSGUI1",128,0)
 .I $G(IEN200) S SERV=$$GET1^DIQ(200,IEN200,29)
"RTN","OOPSGUI1",129,0)
 .S DIE="^OOPS(2260,",DA=IEN,DR="86///^S X=SERV" D ^DIE
"RTN","OOPSGUI1",130,0)
 I $$GET1^DIQ(2260,IEN,166)="" D
"RTN","OOPSGUI1",131,0)
 .S FLD=28,SAL="",SAL=$$PAID^OOPSUTL1(IEN,FLD)
"RTN","OOPSGUI1",132,0)
 .S DIE="^OOPS(2260,",DA=IEN,DR="166///^S X=SAL" D ^DIE
"RTN","OOPSGUI1",133,0)
 I $$GET1^DIQ(2260,IEN,167)="" D
"RTN","OOPSGUI1",134,0)
 .S FLD=19,PAY="",PAY=$$PAID^OOPSUTL1(IEN,FLD)
"RTN","OOPSGUI1",135,0)
 .S PAY=$S(PAY="PER ANNUM":"ANNUAL",PAY="PER HOUR":"HOURLY","PER DIEM":"DAILY","BIWEEKLY":"BI-WEEKLY",1:"")
"RTN","OOPSGUI1",136,0)
 .S DIE="^OOPS(2260,",DA=IEN,DR="167///^S X=PAY" D ^DIE
"RTN","OOPSGUI1",137,0)
 I $$GET1^DIQ(2260,IEN,63)="",($$GET1^DIQ(2260,IEN,2,"I")<3) D
"RTN","OOPSGUI1",138,0)
 .S CAT=$$GET1^DIQ(2260,IEN,2,"I")
"RTN","OOPSGUI1",139,0)
 .I CAT=1 S PAYP=$$PAID^OOPSUTL1(IEN,20) I $G(PAYP)'="" S PAYP=$$PAYP^OOPSUTL1(PAYP)
"RTN","OOPSGUI1",140,0)
 .I CAT=2 S PAYP="VO"
"RTN","OOPSGUI1",141,0)
 .S DIE="^OOPS(2260,",DA=IEN,DR="63///^S X=PAYP" D ^DIE
"RTN","OOPSGUI1",142,0)
 I $$GET1^DIQ(2260,IEN,111)="" D
"RTN","OOPSGUI1",143,0)
 .S FLD=16,OCCD="",OCCD=$$PAID^OOPSUTL1(IEN,FLD)
"RTN","OOPSGUI1",144,0)
 .S DIE="^OOPS(2260,",DA=IEN,DR="111///^S X=OCCD" D ^DIE
"RTN","OOPSGUI1",145,0)
 Q
"RTN","OOPSGUI1",146,0)
VALEMP(RESULTS,INPUT) ; This broker call should be used if the Pay
"RTN","OOPSGUI1",147,0)
 ;                 Plan = "OT" (other) to determine if the claim
"RTN","OOPSGUI1",148,0)
 ;                 can be successfully submitted to DOL.  The PERSONNEL
"RTN","OOPSGUI1",149,0)
 ;                 STATUS is assumed to equal 1 (employee)
"RTN","OOPSGUI1",150,0)
 S IEN=$P($G(INPUT),U,2),FORM=$P($G(INPUT),U)
"RTN","OOPSGUI1",151,0)
 I '$G(IEN)!($G(FORM)="") S RESULTS="Invalid Input, cannot continue." Q
"RTN","OOPSGUI1",152,0)
 I $$VALEMP^OOPSUTL6 S RESULTS="Valid" Q
"RTN","OOPSGUI1",153,0)
 S RESULTS="Invalid data on claim"
"RTN","OOPSGUI1",154,0)
 Q
"RTN","OOPSGUI4")
0^3^B65551682^B55460170
"RTN","OOPSGUI4",1,0)
OOPSGUI4 ;WIOFO/LLH-RPC BROKER CALLS ;10/02/01
"RTN","OOPSGUI4",2,0)
 ;;2.0;ASISTS;**4,8,7,11,15**;Jun 03, 2002;Build 9
"RTN","OOPSGUI4",3,0)
 ;
"RTN","OOPSGUI4",4,0)
PAID(RESULTS,NAME) ; retrieves PAID employee and data from file 450
"RTN","OOPSGUI4",5,0)
 ;  Input:    NAME - the Employee Name or partial name Passed in
"RTN","OOPSGUI4",6,0)
 ; Output: RESULTS - array containing PAID fields in the order returned
"RTN","OOPSGUI4",7,0)
 ;                   from FIND^DIC
"RTN","OOPSGUI4",8,0)
 ;
"RTN","OOPSGUI4",9,0)
 N IEN200,LP,PAY,PAYP,PHONE,OCCDESC,RET,SAL,SSN,X,STATE,SERV,SAMEFLG
"RTN","OOPSGUI4",10,0)
 N IEN450
"RTN","OOPSGUI4",11,0)
 I NAME="" S RESULTS(1)="^NO SSN OR NAME PROVIDED" Q
"RTN","OOPSGUI4",12,0)
 S X=NAME,SAMEFLG=0
"RTN","OOPSGUI4",13,0)
 D FIND^DIC(450,,"@;.01;6;8;10;13;16EI;31;32;38;186.1;186.2;186;186.4;458I;30","MPS",X,500)
"RTN","OOPSGUI4",14,0)
 I $G(DIERR) D CLEAN^DILF Q
"RTN","OOPSGUI4",15,0)
 I $P(^TMP("DILIST",$J,0),U)=0 S RESULTS(0)="^NO PAID EMPLOYEE FOUND" Q
"RTN","OOPSGUI4",16,0)
 F LP=0:0 S LP=$O(^TMP("DILIST",$J,LP)) Q:LP=""  D
"RTN","OOPSGUI4",17,0)
 .; cannot pick yourself if selecting case,use SSN to see if DUZ matches
"RTN","OOPSGUI4",18,0)
 .S SSN=$TR($P($G(^TMP("DILIST",$J,LP,0)),U,4),"-","")
"RTN","OOPSGUI4",19,0)
 .I $G(SSN) S IEN200=$O(^VA(200,"SSN",SSN,""))
"RTN","OOPSGUI4",20,0)
 .; 12/29/03 llh - also cannot pick a person from the PAID file with
"RTN","OOPSGUI4",21,0)
 .;                a pseudo SSN (one that begins with 000)
"RTN","OOPSGUI4",22,0)
 .I $E(SSN,1,3)="000" Q
"RTN","OOPSGUI4",23,0)
 .I DUZ=IEN200 S SAMEFLG=1 Q
"RTN","OOPSGUI4",24,0)
 .;V2_P15 if terminated from New person, don't include
"RTN","OOPSGUI4",25,0)
 .I $$GET1^DIQ(200,IEN200,9.2)'="" Q
"RTN","OOPSGUI4",26,0)
 .;V2_P15 - moved/modified next line up from below & if separated from PAID, Q
"RTN","OOPSGUI4",27,0)
 .S IEN450=$P(^TMP("DILIST",$J,LP,0),U)
"RTN","OOPSGUI4",28,0)
 .I $$GET1^DIQ(450,IEN450,80,"I")="Y" Q
"RTN","OOPSGUI4",29,0)
 .S RESULTS(LP)=^TMP("DILIST",$J,LP,0)
"RTN","OOPSGUI4",30,0)
 .S $P(RESULTS(LP),U,5)=$E($P(RESULTS(LP),U,5),1,45)
"RTN","OOPSGUI4",31,0)
 .;V2_P15 restrict output of OCCUPATION SERIES & TITLE to 30 characters
"RTN","OOPSGUI4",32,0)
 .S $P(RESULTS(LP),U,7)=$E($P(RESULTS(LP),U,7),1,30)
"RTN","OOPSGUI4",33,0)
 .S $P(RESULTS(LP),U,8)=$E($P($G(RESULTS(LP)),U,8),1,4)
"RTN","OOPSGUI4",34,0)
 .S PHONE=""  ; ,SSN=$TR($P($G(RESULTS(LP)),U,4),"-","")
"RTN","OOPSGUI4",35,0)
 .I $G(IEN200) S PHONE=$P($G(^VA(200,IEN200,.13)),U)
"RTN","OOPSGUI4",36,0)
 .I $TR(PHONE,"(,)-^*/# &%@!","")'?10N S PHONE=""  ;Must be 10 char
"RTN","OOPSGUI4",37,0)
 .S RESULTS(LP)=RESULTS(LP)_U_PHONE
"RTN","OOPSGUI4",38,0)
 .I $G(IEN450) D
"RTN","OOPSGUI4",39,0)
 ..S PAYP=$$GET1^DIQ(450,IEN450,20) I $G(PAYP)'="" S PAYP=$$PAYP^OOPSUTL1(PAYP)
"RTN","OOPSGUI4",40,0)
 ..S SAL=$$GET1^DIQ(450,IEN450,28)
"RTN","OOPSGUI4",41,0)
 ..S RET=$$GET1^DIQ(450,IEN450,26) I $G(RET)'="" S RET=$S(RET="FULL CSRS":"CSRS",RET="FERS":"FERS",1:"OTHER")
"RTN","OOPSGUI4",42,0)
 ..S PAY=$$GET1^DIQ(450,IEN450,19) I $G(PAY)'="" S PAY=$S(PAY="PER ANNUM":"ANNUAL",PAY="PER HOUR":"HOURLY","PER DIEM":"DAILY","BIWEEKLY":"BI-WEEKLY",1:"")
"RTN","OOPSGUI4",43,0)
 ..S OCCDESC=$E($$GET1^DIQ(450,IEN450,16),1,30)
"RTN","OOPSGUI4",44,0)
 .S SERV="" I $G(IEN200) S SERV=$$GET1^DIQ(200,IEN200,29)
"RTN","OOPSGUI4",45,0)
 .S RESULTS(LP)=RESULTS(LP)_U_PAY_U_SAL_U_RET_U_PAYP_U_OCCDESC_U_SERV
"RTN","OOPSGUI4",46,0)
 I SAMEFLG,'$D(RESULTS) S RESULTS(0)="^CANNOT CREATE CASE FOR YOURSELF"
"RTN","OOPSGUI4",47,0)
 KILL DIERR,^TMP("DILIST",$J)
"RTN","OOPSGUI4",48,0)
 Q
"RTN","OOPSGUI4",49,0)
 ;
"RTN","OOPSGUI4",50,0)
ASISTS(RESULTS,NAME) ; Lookup on ASISTS Accident Reporting file_2260
"RTN","OOPSGUI4",51,0)
 ;  Input:  - Name or partial name of person to lookup on
"RTN","OOPSGUI4",52,0)
 ; Output:  - array with name of person, sex, DOB, and SSN
"RTN","OOPSGUI4",53,0)
 ;
"RTN","OOPSGUI4",54,0)
 N ARR,I,X,SAMEFLG
"RTN","OOPSGUI4",55,0)
 K ^TMP("DILIST",$J)
"RTN","OOPSGUI4",56,0)
 I NAME="" S RESULTS(0)="^NO SSN OR NAME PROVIDED" Q
"RTN","OOPSGUI4",57,0)
 S X=NAME,SAMEFLG=0
"RTN","OOPSGUI4",58,0)
 ; patch 5 llh - added the 3 indices
"RTN","OOPSGUI4",59,0)
 D FIND^DIC(2260,,"@;1;7;6;5","PSMC",X,500,"C^SSN^BS5")
"RTN","OOPSGUI4",60,0)
 I $G(DIERR) D CLEAN^DILF Q
"RTN","OOPSGUI4",61,0)
 I $P(^TMP("DILIST",$J,0),"^")=0 S RESULTS(1)="^NO ASISTS CASE FOUND" Q
"RTN","OOPSGUI4",62,0)
 F I=0:0 S I=$O(^TMP("DILIST",$J,I)) Q:I=""  D
"RTN","OOPSGUI4",63,0)
 .I DUZ=$P(^TMP("DILIST",$J,I,0),U) S SAMEFLG=1 Q
"RTN","OOPSGUI4",64,0)
 .I $D(ARR($P(^TMP("DILIST",$J,I,0),U,2))) Q
"RTN","OOPSGUI4",65,0)
 .S ARR($P(^TMP("DILIST",$J,I,0),U,2))=""
"RTN","OOPSGUI4",66,0)
 .S RESULTS(I)=^TMP("DILIST",$J,I,0)
"RTN","OOPSGUI4",67,0)
 I SAMEFLG,'$D(RESULTS) S RESULTS(0)="^CANNOT CREATE CASE FOR YOURSELF"
"RTN","OOPSGUI4",68,0)
 I '$D(RESULTS) S RESULTS(0)="^NO SELECTABLE CASES FOUND"
"RTN","OOPSGUI4",69,0)
 K DIERR,^TMP("DILIST",$J)
"RTN","OOPSGUI4",70,0)
 Q
"RTN","OOPSGUI4",71,0)
PER(RESULTS,NAME) ; Lookup for Non-Paid Employee (New Person file_
"RTN","OOPSGUI4",72,0)
 ;  Input:  - Name or partial name of person to lookup on
"RTN","OOPSGUI4",73,0)
 ; Output:  - array with name of new person, sex, DOB, and SSN
"RTN","OOPSGUI4",74,0)
 ;
"RTN","OOPSGUI4",75,0)
 N I,SSN,X,SAMEFLG,IEN200
"RTN","OOPSGUI4",76,0)
 K ^TMP("DILIST",$J)
"RTN","OOPSGUI4",77,0)
 I NAME="" S RESULTS(0)="^NO SSN OR NAME PROVIDED" Q
"RTN","OOPSGUI4",78,0)
 S X=NAME,SAMEFLG=0
"RTN","OOPSGUI4",79,0)
 D FIND^DIC(200,,"@;.01;4;5;9;29","PSMC",X,500)
"RTN","OOPSGUI4",80,0)
 I $G(DIERR) D CLEAN^DILF Q
"RTN","OOPSGUI4",81,0)
 I $P(^TMP("DILIST",$J,0),"^")=0 S RESULTS(1)="^NO NEW PERSON FOUND" Q
"RTN","OOPSGUI4",82,0)
 F I=0:0 S I=$O(^TMP("DILIST",$J,I)) Q:I=""  D
"RTN","OOPSGUI4",83,0)
 .; make sure not a PAID Employee
"RTN","OOPSGUI4",84,0)
 .S SSN=$P(^TMP("DILIST",$J,I,0),U,5)
"RTN","OOPSGUI4",85,0)
 .I $G(SSN),$$FIND1^DIC(450,"","MX",SSN) Q
"RTN","OOPSGUI4",86,0)
 .;V2_P15 modified for HD0000000152026
"RTN","OOPSGUI4",87,0)
 .S IEN200=$P(^TMP("DILIST",$J,I,0),U)
"RTN","OOPSGUI4",88,0)
 .I DUZ=IEN200 S SAMEFLG=1 Q
"RTN","OOPSGUI4",89,0)
 .;V2_P15 if terminated from New person, don't include
"RTN","OOPSGUI4",90,0)
 .I $$GET1^DIQ(200,IEN200,9.2)'="" Q
"RTN","OOPSGUI4",91,0)
 .S RESULTS(I)=^TMP("DILIST",$J,I,0)
"RTN","OOPSGUI4",92,0)
 I SAMEFLG,'$D(RESULTS) S RESULTS(0)="^CANNOT CREATE CASE FOR YOURSELF"
"RTN","OOPSGUI4",93,0)
 I '$D(RESULTS) S RESULTS(0)="^NO SELECTABLE CASES FOUND"
"RTN","OOPSGUI4",94,0)
 K DIERR,^TMP("DILIST",$J)
"RTN","OOPSGUI4",95,0)
 Q
"RTN","OOPSGUI4",96,0)
SUPER(RESULTS,NAME,EMPSSN) ; Lookup for Supervisors or anyone from the New 
"RTN","OOPSGUI4",97,0)
 ;                 Person file.  This broker call will also be used to
"RTN","OOPSGUI4",98,0)
 ;                 lookup Union representatives for the Enter/Edit
"RTN","OOPSGUI4",99,0)
 ;                 Union Information.
"RTN","OOPSGUI4",100,0)
 ;  Input:    NAME - Name or partial name of person to lookup on
"RTN","OOPSGUI4",101,0)
 ;             SSN - SSN of the Person Involved if called from 2162
"RTN","OOPSGUI4",102,0)
 ; Output: RESULTS - array with name of new person, sex, DOB, and SSN
"RTN","OOPSGUI4",103,0)
 ;
"RTN","OOPSGUI4",104,0)
 N I,SSN,SAME,STR,X
"RTN","OOPSGUI4",105,0)
 K ^TMP("DILIST",$J)
"RTN","OOPSGUI4",106,0)
 I NAME="" S RESULTS(1)="^NO SSN OR NAME PROVIDED" Q
"RTN","OOPSGUI4",107,0)
 S X=NAME,SAME=0
"RTN","OOPSGUI4",108,0)
 D FIND^DIC(200,,".01;9","PSCM",X,500)
"RTN","OOPSGUI4",109,0)
 I $G(DIERR) D CLEAN^DILF Q
"RTN","OOPSGUI4",110,0)
 I $P(^TMP("DILIST",$J,0),"^")=0 S RESULTS(1)="^NO NEW PERSON FOUND" Q
"RTN","OOPSGUI4",111,0)
 F I=0:0 S I=$O(^TMP("DILIST",$J,I)) Q:I=""  D
"RTN","OOPSGUI4",112,0)
 .;V2_P15 llh, if person is terminated, do not return them in the array
"RTN","OOPSGUI4",113,0)
 .;Remedy ticket HD0000000206374
"RTN","OOPSGUI4",114,0)
 .S STR=$G(^TMP("DILIST",$J,I,0))
"RTN","OOPSGUI4",115,0)
 .I $$GET1^DIQ(200,$P(STR,U,1),9.2)'="" Q
"RTN","OOPSGUI4",116,0)
 .I $G(EMPSSN)'="",($P(STR,U,3)=$G(EMPSSN)) S SAME=1 Q
"RTN","OOPSGUI4",117,0)
 .S RESULTS(I)=STR
"RTN","OOPSGUI4",118,0)
 I SAME,'$D(RESULTS) S RESULTS(1)="^CANNOT BE SUPERVISOR FOR YOUR CLAIM"
"RTN","OOPSGUI4",119,0)
 I '$D(RESULTS) S RESULTS(1)="^NO VALID SELECTION"
"RTN","OOPSGUI4",120,0)
 K DIERR,^TMP("DILIST",$J)
"RTN","OOPSGUI4",121,0)
 Q
"RTN","OOPSGUI4",122,0)
 ;
"RTN","OOPSGUI4",123,0)
LOAD(RESULTS,ARR) ; Create new OOPS record
"RTN","OOPSGUI4",124,0)
 ;  Input:     ARR  - contains data entered from the Create Accident/
"RTN","OOPSGUI4",125,0)
 ;                    Illness Report Option
"RTN","OOPSGUI4",126,0)
 ; Output:  RESULTS - status message
"RTN","OOPSGUI4",127,0)
 ;
"RTN","OOPSGUI4",128,0)
 N ASUB,CAT,DA,DATE,DIC,DR,ERROR,FLDS,FNUM,FYEAR,IEN2260,LP,NUM,PCE,SSN,X
"RTN","OOPSGUI4",129,0)
 N LIST,CNT,DLAYGO
"RTN","OOPSGUI4",130,0)
 S CAT=""
"RTN","OOPSGUI4",131,0)
 I $G(ARR(2)) S CAT=ARR(2)
"RTN","OOPSGUI4",132,0)
 I $G(ARR(5)) S SSN=ARR(5)
"RTN","OOPSGUI4",133,0)
 D NOW^%DTC
"RTN","OOPSGUI4",134,0)
 S DATE=X
"RTN","OOPSGUI4",135,0)
 S FYEAR=""
"RTN","OOPSGUI4",136,0)
 S FYEAR=$$FYEAR^OOPSCSN(X)
"RTN","OOPSGUI4",137,0)
 S NUM=$$NEWR^OOPSCSN(FYEAR)
"RTN","OOPSGUI4",138,0)
 K DD,DO
"RTN","OOPSGUI4",139,0)
 S DLAYGO=2260,DIC="^OOPS(2260,"
"RTN","OOPSGUI4",140,0)
 S DIC(0)="QLZ"
"RTN","OOPSGUI4",141,0)
 S X=NUM
"RTN","OOPSGUI4",142,0)
 D FILE^DICN
"RTN","OOPSGUI4",143,0)
 I Y<0 S (RESULTS,RESULTS(0))="UNABLE TO CREATE RECORD" Q
"RTN","OOPSGUI4",144,0)
 S IEN2260=+Y
"RTN","OOPSGUI4",145,0)
 S DIE="^OOPS(2260,"
"RTN","OOPSGUI4",146,0)
 S DA=IEN2260
"RTN","OOPSGUI4",147,0)
 S LIST="1,2,3,4,5,6,7,8,9,10,11,12,14,15,16,17,18,52,60,63,86,90,335,"
"RTN","OOPSGUI4",148,0)
 S LIST=LIST_"336,338,339,349,350,351,352,"
"RTN","OOPSGUI4",149,0)
 I ARR(52)="Injury" S LIST=LIST_",111,166,167"
"RTN","OOPSGUI4",150,0)
 I ARR(52)="Illness/Disease" S LIST=LIST_",208,334"
"RTN","OOPSGUI4",151,0)
 F CNT=1:1 S FNUM=$P(LIST,",",CNT) Q:FNUM=""  I $G(ARR(FNUM))'="" D VAL(DA,FNUM,ARR(FNUM))
"RTN","OOPSGUI4",152,0)
 K DR S DIE="^OOPS(2260,",DA=IEN2260,DR=""
"RTN","OOPSGUI4",153,0)
 S DR(1,2260,1)="1///^S X=ARR(1)"
"RTN","OOPSGUI4",154,0)
 S DR(1,2260,2)="2///^S X=ARR(2)"
"RTN","OOPSGUI4",155,0)
 S DR(1,2260,3)="3///^S X=ARR(3)"
"RTN","OOPSGUI4",156,0)
 S DR(1,2260,4)="4///^S X=ARR(4)"
"RTN","OOPSGUI4",157,0)
 S DR(1,2260,5)="5///^S X=ARR(5)"
"RTN","OOPSGUI4",158,0)
 S DR(1,2260,6)="6///^S X=ARR(6)"
"RTN","OOPSGUI4",159,0)
 S DR(1,2260,7)="7///^S X=ARR(7)"
"RTN","OOPSGUI4",160,0)
 S DR(1,2260,8)="8///^S X=ARR(8)"
"RTN","OOPSGUI4",161,0)
 S DR(1,2260,9)="9///^S X=ARR(9)"
"RTN","OOPSGUI4",162,0)
 S DR(1,2260,10)="10///^S X=ARR(10)"
"RTN","OOPSGUI4",163,0)
 S DR(1,2260,12)="11///^S X=ARR(11)"
"RTN","OOPSGUI4",164,0)
 S DR(1,2260,15)="12///^S X=ARR(12)"
"RTN","OOPSGUI4",165,0)
 S DR(1,2260,18)="13////^S X=ARR(13)"     ; sending pointer
"RTN","OOPSGUI4",166,0)
 S DR(1,2260,21)="14///^S X=ARR(14)"
"RTN","OOPSGUI4",167,0)
 S DR(1,2260,24)="15///^S X=ARR(15)"
"RTN","OOPSGUI4",168,0)
 S DR(1,2260,27)="16///^S X=ARR(16)"
"RTN","OOPSGUI4",169,0)
 S DR(1,2260,30)="17///^S X=ARR(17)"
"RTN","OOPSGUI4",170,0)
 S DR(1,2260,33)="18///^S X=ARR(18)"
"RTN","OOPSGUI4",171,0)
 S DR(1,2260,36)="52///^S X=ARR(52)"
"RTN","OOPSGUI4",172,0)
 S DR(1,2260,39)="53////^S X=ARR(53)"     ; send pointer
"RTN","OOPSGUI4",173,0)
 S DR(1,2260,42)="53.1////^S X=ARR(22)"   ; send pointer
"RTN","OOPSGUI4",174,0)
 S DR(1,2260,45)="56////^S X=ARR(48)"     ; send pointer
"RTN","OOPSGUI4",175,0)
 S DR(1,2260,48)="60///^S X=ARR(60)"
"RTN","OOPSGUI4",176,0)
 S DR(1,2260,51)="63///^S X=ARR(63)"
"RTN","OOPSGUI4",177,0)
 S DR(1,2260,54)="86///^S X=ARR(86)"
"RTN","OOPSGUI4",178,0)
 S DR(1,2260,57)="90///^S X=ARR(90)"
"RTN","OOPSGUI4",179,0)
 S DR(1,2260,58)="335///^S X=ARR(169)"
"RTN","OOPSGUI4",180,0)
 S DR(1,2260,59)="336///^S X=ARR(170)"
"RTN","OOPSGUI4",181,0)
 I ARR(52)="Injury" D
"RTN","OOPSGUI4",182,0)
 .S DR(1,2260,60)="111///^S X=ARR(19)"
"RTN","OOPSGUI4",183,0)
 .S DR(1,2260,63)="166///^S X=ARR(166)"
"RTN","OOPSGUI4",184,0)
 .S DR(1,2260,67)="167///^S X=ARR(167)"
"RTN","OOPSGUI4",185,0)
 I ARR(52)="Illness/Disease" D
"RTN","OOPSGUI4",186,0)
 .S DR(1,2260,60)="208///^S X=ARR(19)"
"RTN","OOPSGUI4",187,0)
 .S DR(1,2260,61)="334///^S X=ARR(168)"
"RTN","OOPSGUI4",188,0)
 ; patch 11 - new OSHA 300 questions
"RTN","OOPSGUI4",189,0)
 S DR(1,2260,70)="349///^S X=ARR(171)"
"RTN","OOPSGUI4",190,0)
 S DR(1,2260,71)="339///^S X=ARR(172)"
"RTN","OOPSGUI4",191,0)
 S DR(1,2260,72)="338///^S X=ARR(173)"
"RTN","OOPSGUI4",192,0)
 S DR(1,2260,73)="350///^S X=ARR(174)"
"RTN","OOPSGUI4",193,0)
 S DR(1,2260,74)="351///^S X=ARR(175)"
"RTN","OOPSGUI4",194,0)
 S DR(1,2260,75)="352///^S X=ARR(176)"
"RTN","OOPSGUI4",195,0)
 ; V2P15 new field
"RTN","OOPSGUI4",196,0)
 S DR(1,2260,76)="360///^S X=ARR(177)"
"RTN","OOPSGUI4",197,0)
 D ^DIE
"RTN","OOPSGUI4",198,0)
 ;V2_P15 - if INITIAL RETURN TO WORK STATUS = Days Away work or Job Transfer/Restriction
"RTN","OOPSGUI4",199,0)
 ;send a new bulletin
"RTN","OOPSGUI4",200,0)
 I ARR(176)="DAYS AWAY WORK"!(ARR(176)="Job Transfer/Restriction") D CIO^OOPSMBUL(IEN2260)
"RTN","OOPSGUI4",201,0)
 D CASE^OOPSMBUL(IEN2260) D:(CAT=1)!(CAT=6) BOR^OOPSMBUL(IEN2260):$D(^VA(200,"SSN",SSN))
"RTN","OOPSGUI4",202,0)
 K DR S DIE="^OOPS(2260,",DA=IEN2260,DR="51///0" D ^DIE
"RTN","OOPSGUI4",203,0)
 K DIE,DR,DA
"RTN","OOPSGUI4",204,0)
 S (RESULTS,RESULTS(1))="OK" S:$G(ERROR)]"" (RESULTS,RESULTS(1))=ERROR
"RTN","OOPSGUI4",205,0)
 S RESULTS(2)=$P(^OOPS(2260,IEN2260,0),"^")
"RTN","OOPSGUI4",206,0)
 Q
"RTN","OOPSGUI4",207,0)
DELETE ;Delete incomplete case
"RTN","OOPSGUI4",208,0)
 N DIK,DA
"RTN","OOPSGUI4",209,0)
 S DIK="^OOPS(2260,",DA=IEN2260
"RTN","OOPSGUI4",210,0)
 D ^DIK
"RTN","OOPSGUI4",211,0)
 Q
"RTN","OOPSGUI4",212,0)
VAL(DA,FIELD,VALUE) ;Validate Input
"RTN","OOPSGUI4",213,0)
 ;  Input:   DA  - IEN of the ASISTS record
"RTN","OOPSGUI4",214,0)
 ;        FIELD  - field number for data to be validated
"RTN","OOPSGUI4",215,0)
 ;        VALUE  - data to be validated
"RTN","OOPSGUI4",216,0)
 ; Output:
"RTN","OOPSGUI4",217,0)
 ;        none
"RTN","OOPSGUI4",218,0)
 N X
"RTN","OOPSGUI4",219,0)
 D VAL^DIE(2260,DA,FIELD,"",VALUE,.X)
"RTN","OOPSGUI4",220,0)
 I X=U D
"RTN","OOPSGUI4",221,0)
 .S:$G(ERROR)]"" ERROR=ERROR_","
"RTN","OOPSGUI4",222,0)
 .S ERROR=$G(ERROR)_$$GET1^DID(2260,FIELD,"","LABEL")_U_VALUE
"RTN","OOPSGUI4",223,0)
 .; set the data to nil so filing will not bomb
"RTN","OOPSGUI4",224,0)
 .S ARR(FIELD)=""
"RTN","OOPSGUI4",225,0)
 Q
"RTN","OOPSGUI4",226,0)
DUP(RESULTS,SSN) ; Duplicate Case error checking broker call
"RTN","OOPSGUI4",227,0)
 ;  Input:    INPUT - SSN of current ASISTS case number
"RTN","OOPSGUI4",228,0)
 ; Output:  RESULTS - return array with case information
"RTN","OOPSGUI4",229,0)
 ;
"RTN","OOPSGUI4",230,0)
 N CN,DT,IEN,NM,TYPE
"RTN","OOPSGUI4",231,0)
 S IEN="",CN=0
"RTN","OOPSGUI4",232,0)
 S RESULTS(CN)="NO MATCHES FOUND"
"RTN","OOPSGUI4",233,0)
 F  S IEN=$O(^OOPS(2260,"SSN",SSN,IEN)) Q:IEN=""  D
"RTN","OOPSGUI4",234,0)
 .I $$GET1^DIQ(2260,IEN,51,"I") Q        ;case not open, don't include
"RTN","OOPSGUI4",235,0)
 .S NM=$$GET1^DIQ(2260,IEN,1)
"RTN","OOPSGUI4",236,0)
 .S TYPE=$$GET1^DIQ(2260,IEN,"3:.01")
"RTN","OOPSGUI4",237,0)
 .S DT=$$GET1^DIQ(2260,IEN,4)
"RTN","OOPSGUI4",238,0)
 .S RESULTS(CN)=NM_"  "_DT_"  "_TYPE
"RTN","OOPSGUI4",239,0)
 .S CN=CN+1,(NM,TYPE,DT)=""
"RTN","OOPSGUI4",240,0)
 Q
"RTN","OOPSGUI5")
0^4^B38468044^B70896751
"RTN","OOPSGUI5",1,0)
OOPSGUI5 ;WIOFO/CVW-RPC routines ;10/11/01
"RTN","OOPSGUI5",2,0)
 ;;2.0;ASISTS;**2,8,7,11,15**;Jun 03, 2002;Build 9
"RTN","OOPSGUI5",3,0)
EDIT(RESULTS,INPUT,ARR) ;
"RTN","OOPSGUI5",4,0)
 ;  Input: INPUT - IEN^FORM where IEN = ASISTS IEN or "NEW" if user
"RTN","OOPSGUI5",5,0)
 ;                 creating a new CA7. FORM="CA1","CA2","2162" or "CA7"
"RTN","OOPSGUI5",6,0)
 ;      SENDPARM - Array with data from client, saved into File 2260. 
"RTN","OOPSGUI5",7,0)
 ; Output:  RESULTS - Array containing the results of the store/save.
"RTN","OOPSGUI5",8,0)
 ;   NOTE:  Patch 5 llh - added FILE variable based on form being
"RTN","OOPSGUI5",9,0)
 ;                        passed in so that a CA7 could also be handled.
"RTN","OOPSGUI5",10,0)
 N IEN,FILE,FORM,DIE,DA,DR
"RTN","OOPSGUI5",11,0)
 S IEN=$P($G(INPUT),U,1),FORM=$P($G(INPUT),U,2)
"RTN","OOPSGUI5",12,0)
 I $G(FORM)="" S (RESULTS,RESULTS(1))="-2^No form type" Q
"RTN","OOPSGUI5",13,0)
 S FILE=2260 I FORM="CA7" S FILE=2264
"RTN","OOPSGUI5",14,0)
 I '$D(^OOPS(FILE,$G(IEN),0))&($G(IEN)'="NEW") D  Q
"RTN","OOPSGUI5",15,0)
 . S (RESULTS,RESULTS(1))="-1^IEN:"_IEN_" not found in file "_FILE
"RTN","OOPSGUI5",16,0)
 I "CA1^CA2^CA7^2162"'[FORM D  Q
"RTN","OOPSGUI5",17,0)
 . S (RESULTS,RESULTS(1))="-2^FORM:"_FORM_" not valid, must be CA1,CA2, or 2162"
"RTN","OOPSGUI5",18,0)
 S RESULTS(1)="UPDATE FAILED"
"RTN","OOPSGUI5",19,0)
 I FORM="CA1" D SAVECA1
"RTN","OOPSGUI5",20,0)
 I FORM="CA2" D SAVECA2
"RTN","OOPSGUI5",21,0)
 ;V2_P15 Moved entire subroutine SAVE2162 to OOPSGUID due to size of OOPSGUI5
"RTN","OOPSGUI5",22,0)
 I FORM="2162" D SAVE2162^OOPSGUID
"RTN","OOPSGUI5",23,0)
 I FORM="CA7" D SAVECA7^OOPSGUID
"RTN","OOPSGUI5",24,0)
 Q
"RTN","OOPSGUI5",25,0)
SAVECA1 ;
"RTN","OOPSGUI5",26,0)
 K DR S DIE="^OOPS(2260,",DA=IEN,DR=""
"RTN","OOPSGUI5",27,0)
 S DR(1,2260,1)="53////^S X=ARR(7)"
"RTN","OOPSGUI5",28,0)
 S DR(1,2260,2)="53.1////^S X=ARR(8)"
"RTN","OOPSGUI5",29,0)
 S DR(1,2260,3)="60///^S X=ARR(14)"
"RTN","OOPSGUI5",30,0)
 S DR(1,2260,4)="61///^S X=ARR(15)"
"RTN","OOPSGUI5",31,0)
 S DR(1,2260,5)="62////^S X=ARR(16)"
"RTN","OOPSGUI5",32,0)
 S DR(1,2260,6)="70///^S X=ARR(22)"
"RTN","OOPSGUI5",33,0)
 S DR(1,2260,7)="73///^S X=ARR(25)"
"RTN","OOPSGUI5",34,0)
 S DR(1,2260,8)="12///^S X=ARR(36)"
"RTN","OOPSGUI5",35,0)
 S DR(1,2260,11)="8///^S X=ARR(39)"
"RTN","OOPSGUI5",36,0)
 S DR(1,2260,12)="9///^S X=ARR(40)"
"RTN","OOPSGUI5",37,0)
 S DR(1,2260,13)="10///^S X=ARR(41)"
"RTN","OOPSGUI5",38,0)
 S DR(1,2260,14)="11///^S X=ARR(42)"
"RTN","OOPSGUI5",39,0)
 S DR(1,2260,15)="107///^S X=ARR(43)"
"RTN","OOPSGUI5",40,0)
 S DR(1,2260,16)="108///^S X=ARR(44)"
"RTN","OOPSGUI5",41,0)
 S DR(1,2260,17)="109///^S X=ARR(45)"
"RTN","OOPSGUI5",42,0)
 S DR(1,2260,18)="110///^S X=ARR(46)"
"RTN","OOPSGUI5",43,0)
 S DR(1,2260,19)="111///^S X=ARR(47)"
"RTN","OOPSGUI5",44,0)
 S DR(1,2260,20)="112///^S X=ARR(48)"
"RTN","OOPSGUI5",45,0)
 S DR(1,2260,21)="113///^S X=ARR(49)"
"RTN","OOPSGUI5",46,0)
 S DR(1,2260,22)="114///^S X=ARR(50)"
"RTN","OOPSGUI5",47,0)
 S DR(1,2260,24)="123///^S X=ARR(60)"
"RTN","OOPSGUI5",48,0)
 S DR(1,2260,25)="124///^S X=ARR(61)"
"RTN","OOPSGUI5",49,0)
 S DR(1,2260,26)="126///^S X=ARR(62)"
"RTN","OOPSGUI5",50,0)
 S DR(1,2260,27)="130///^S X=ARR(63)"
"RTN","OOPSGUI5",51,0)
 S DR(1,2260,28)="131///^S X=ARR(64)"
"RTN","OOPSGUI5",52,0)
 S DR(1,2260,29)="132///^S X=ARR(65)"
"RTN","OOPSGUI5",53,0)
 S DR(1,2260,30)="133///^S X=ARR(66)"
"RTN","OOPSGUI5",54,0)
 S DR(1,2260,31)="134///^S X=ARR(67)"
"RTN","OOPSGUI5",55,0)
 S DR(1,2260,32)="138///^S X=ARR(70)"
"RTN","OOPSGUI5",56,0)
 S DR(1,2260,33)="139///^S X=ARR(71)"
"RTN","OOPSGUI5",57,0)
 S DR(1,2260,34)="140///^S X=ARR(72)"
"RTN","OOPSGUI5",58,0)
 S DR(1,2260,35)="141///^S X=ARR(73)"
"RTN","OOPSGUI5",59,0)
 S DR(1,2260,36)="142///^S X=ARR(74)"
"RTN","OOPSGUI5",60,0)
 D ^DIE I '($D(Y)=0) Q
"RTN","OOPSGUI5",61,0)
 K DR S DIE="^OOPS(2260,",DA=IEN,DR=""
"RTN","OOPSGUI5",62,0)
 S DR(1,2260,37)="143///^S X=ARR(75)"
"RTN","OOPSGUI5",63,0)
 S DR(1,2260,38)="144///^S X=ARR(76)"
"RTN","OOPSGUI5",64,0)
 S DR(1,2260,39)="145///^S X=ARR(77)"
"RTN","OOPSGUI5",65,0)
 S DR(1,2260,40)="146///^S X=ARR(78)"
"RTN","OOPSGUI5",66,0)
 S DR(1,2260,41)="147///^S X=ARR(79)"
"RTN","OOPSGUI5",67,0)
 S DR(1,2260,42)="148///^S X=ARR(80)"
"RTN","OOPSGUI5",68,0)
 S DR(1,2260,43)="149///^S X=ARR(81)"
"RTN","OOPSGUI5",69,0)
 S DR(1,2260,44)="150///^S X=ARR(82)"
"RTN","OOPSGUI5",70,0)
 S DR(1,2260,45)="151///^S X=ARR(83)"
"RTN","OOPSGUI5",71,0)
 S DR(1,2260,46)="152///^S X=ARR(84)"
"RTN","OOPSGUI5",72,0)
 S DR(1,2260,47)="153///^S X=ARR(85)"
"RTN","OOPSGUI5",73,0)
 S DR(1,2260,48)="154///^S X=ARR(86)"
"RTN","OOPSGUI5",74,0)
 S DR(1,2260,49)="155///^S X=ARR(87)"
"RTN","OOPSGUI5",75,0)
 S DR(1,2260,50)="156///^S X=ARR(88)"
"RTN","OOPSGUI5",76,0)
 S DR(1,2260,51)="157///^S X=ARR(89)"
"RTN","OOPSGUI5",77,0)
 S DR(1,2260,52)="158///^S X=ARR(90)"
"RTN","OOPSGUI5",78,0)
 S DR(1,2260,53)="159///^S X=ARR(91)"
"RTN","OOPSGUI5",79,0)
 S DR(1,2260,54)="160///^S X=ARR(92)"
"RTN","OOPSGUI5",80,0)
 S DR(1,2260,55)="161///^S X=ARR(93)"
"RTN","OOPSGUI5",81,0)
 S DR(1,2260,56)="162///^S X=ARR(94)"
"RTN","OOPSGUI5",82,0)
 S DR(1,2260,57)="163///^S X=ARR(95)"
"RTN","OOPSGUI5",83,0)
 S DR(1,2260,58)="165.1///^S X=ARR(96)"
"RTN","OOPSGUI5",84,0)
 S DR(1,2260,59)="165.2///^S X=ARR(97)"
"RTN","OOPSGUI5",85,0)
 S DR(1,2260,60)="166///^S X=ARR(98)"
"RTN","OOPSGUI5",86,0)
 S DR(1,2260,61)="167///^S X=ARR(99)"
"RTN","OOPSGUI5",87,0)
 S DR(1,2260,62)="168///^S X=ARR(100)"
"RTN","OOPSGUI5",88,0)
 S DR(1,2260,63)="172///^S X=ARR(104)"
"RTN","OOPSGUI5",89,0)
 S DR(1,2260,64)="173///^S X=ARR(105)"
"RTN","OOPSGUI5",90,0)
 S DR(1,2260,65)="173.1///^S X=ARR(106)"
"RTN","OOPSGUI5",91,0)
 S DR(1,2260,66)="174///^S X=ARR(107)"
"RTN","OOPSGUI5",92,0)
 S DR(1,2260,67)="175///^S X=ARR(108)"
"RTN","OOPSGUI5",93,0)
 S DR(1,2260,68)="176///^S X=ARR(109)"
"RTN","OOPSGUI5",94,0)
 S DR(1,2260,69)="177///^S X=ARR(110)"
"RTN","OOPSGUI5",95,0)
 S DR(1,2260,70)="178///^S X=ARR(111)"
"RTN","OOPSGUI5",96,0)
 S DR(1,2260,71)="179///^S X=ARR(112)"
"RTN","OOPSGUI5",97,0)
 S DR(1,2260,72)="180///^S X=ARR(113)"
"RTN","OOPSGUI5",98,0)
 S DR(1,2260,73)="181///^S X=ARR(114)"
"RTN","OOPSGUI5",99,0)
 S DR(1,2260,74)="182///^S X=ARR(115)"
"RTN","OOPSGUI5",100,0)
 S DR(1,2260,75)="183///^S X=ARR(116)"
"RTN","OOPSGUI5",101,0)
 S DR(1,2260,76)="184///^S X=ARR(117)"
"RTN","OOPSGUI5",102,0)
 S DR(1,2260,77)="185///^S X=ARR(118)"
"RTN","OOPSGUI5",103,0)
 S DR(1,2260,78)="330///^S X=ARR(119)"
"RTN","OOPSGUI5",104,0)
 S DR(1,2260,79)="331///^S X=ARR(120)"
"RTN","OOPSGUI5",105,0)
 S DR(1,2260,80)="332///^S X=ARR(121)"
"RTN","OOPSGUI5",106,0)
 ; patch 11 - added REASON FOR DISPUTE CODE
"RTN","OOPSGUI5",107,0)
 S DR(1,2260,81)="347///^S X=ARR(122)"
"RTN","OOPSGUI5",108,0)
 D ^DIE I $D(Y)=0 S RESULTS(1)="UPDATE COMPLETED"
"RTN","OOPSGUI5",109,0)
 Q
"RTN","OOPSGUI5",110,0)
SAVECA2 ;
"RTN","OOPSGUI5",111,0)
 K DR S DIE="^OOPS(2260,",DA=IEN,DR=""
"RTN","OOPSGUI5",112,0)
 S DR(1,2260,1)="60///^S X=ARR(14)"
"RTN","OOPSGUI5",113,0)
 S DR(1,2260,5)="61///^S X=ARR(15)"
"RTN","OOPSGUI5",114,0)
 S DR(1,2260,7)="62////^S X=ARR(16)"
"RTN","OOPSGUI5",115,0)
 S DR(1,2260,10)="70///^S X=ARR(22)"
"RTN","OOPSGUI5",116,0)
 S DR(1,2260,15)="73///^S X=ARR(25)"
"RTN","OOPSGUI5",117,0)
 S DR(1,2260,20)="12///^S X=ARR(38)"
"RTN","OOPSGUI5",118,0)
 S DR(1,2260,25)="8///^S X=ARR(41)"
"RTN","OOPSGUI5",119,0)
 S DR(1,2260,30)="9///^S X=ARR(42)"
"RTN","OOPSGUI5",120,0)
 S DR(1,2260,35)="10///^S X=ARR(43)"
"RTN","OOPSGUI5",121,0)
 S DR(1,2260,40)="11///^S X=ARR(44)"
"RTN","OOPSGUI5",122,0)
 S DR(1,2260,41)="126///^S X=ARR(36)"
"RTN","OOPSGUI5",123,0)
 S DR(1,2260,45)="207///^S X=ARR(45)"
"RTN","OOPSGUI5",124,0)
 S DR(1,2260,50)="208///^S X=ARR(46)"
"RTN","OOPSGUI5",125,0)
 S DR(1,2260,55)="209///^S X=ARR(47)"
"RTN","OOPSGUI5",126,0)
 S DR(1,2260,60)="210///^S X=ARR(48)"
"RTN","OOPSGUI5",127,0)
 S DR(1,2260,65)="211///^S X=ARR(49)"
"RTN","OOPSGUI5",128,0)
 S DR(1,2260,70)="212///^S X=ARR(50)"
"RTN","OOPSGUI5",129,0)
 S DR(1,2260,75)="213///^S X=ARR(51)"
"RTN","OOPSGUI5",130,0)
 S DR(1,2260,80)="214///^S X=ARR(52)"
"RTN","OOPSGUI5",131,0)
 D ^DIE I '($D(Y)=0) Q
"RTN","OOPSGUI5",132,0)
 K DR S DIE="^OOPS(2260,",DA=IEN,DR=""
"RTN","OOPSGUI5",133,0)
 S DR(1,2260,85)="215///^S X=ARR(53)"
"RTN","OOPSGUI5",134,0)
 S DR(1,2260,90)="225///^S X=ARR(57)"
"RTN","OOPSGUI5",135,0)
 S DR(1,2260,95)="226///^S X=ARR(58)"
"RTN","OOPSGUI5",136,0)
 S DR(1,2260,100)="227///^S X=ARR(59)"
"RTN","OOPSGUI5",137,0)
 S DR(1,2260,105)="230///^S X=ARR(60)"
"RTN","OOPSGUI5",138,0)
 S DR(1,2260,110)="231///^S X=ARR(61)"
"RTN","OOPSGUI5",139,0)
 S DR(1,2260,115)="232///^S X=ARR(62)"
"RTN","OOPSGUI5",140,0)
 S DR(1,2260,120)="233///^S X=ARR(63)"
"RTN","OOPSGUI5",141,0)
 S DR(1,2260,125)="234///^S X=ARR(64)"
"RTN","OOPSGUI5",142,0)
 S DR(1,2260,130)="237///^S X=ARR(67)"
"RTN","OOPSGUI5",143,0)
 S DR(1,2260,135)="238///^S X=ARR(68)"
"RTN","OOPSGUI5",144,0)
 S DR(1,2260,140)="239///^S X=ARR(69)"
"RTN","OOPSGUI5",145,0)
 S DR(1,2260,145)="240///^S X=ARR(70)"
"RTN","OOPSGUI5",146,0)
 S DR(1,2260,150)="241///^S X=ARR(71)"
"RTN","OOPSGUI5",147,0)
 S DR(1,2260,155)="242///^S X=ARR(72)"
"RTN","OOPSGUI5",148,0)
 S DR(1,2260,160)="243///^S X=ARR(73)"
"RTN","OOPSGUI5",149,0)
 S DR(1,2260,165)="244///^S X=ARR(74)"
"RTN","OOPSGUI5",150,0)
 S DR(1,2260,170)="245///^S X=ARR(75)"
"RTN","OOPSGUI5",151,0)
 S DR(1,2260,175)="246///^S X=ARR(76)"
"RTN","OOPSGUI5",152,0)
 S DR(1,2260,180)="247///^S X=ARR(77)"
"RTN","OOPSGUI5",153,0)
 S DR(1,2260,185)="248///^S X=ARR(78)"
"RTN","OOPSGUI5",154,0)
 S DR(1,2260,190)="249///^S X=ARR(79)"
"RTN","OOPSGUI5",155,0)
 S DR(1,2260,192)="250///^S X=ARR(80)"
"RTN","OOPSGUI5",156,0)
 S DR(1,2260,195)="251///^S X=ARR(81)"
"RTN","OOPSGUI5",157,0)
 S DR(1,2260,200)="252///^S X=ARR(82)"
"RTN","OOPSGUI5",158,0)
 S DR(1,2260,205)="253///^S X=ARR(83)"
"RTN","OOPSGUI5",159,0)
 D ^DIE I '($D(Y)=0) Q
"RTN","OOPSGUI5",160,0)
 K DR S DIE="^OOPS(2260,",DA=IEN,DR=""
"RTN","OOPSGUI5",161,0)
 S DR(1,2260,210)="254///^S X=ARR(84)"
"RTN","OOPSGUI5",162,0)
 S DR(1,2260,215)="255///^S X=ARR(85)"
"RTN","OOPSGUI5",163,0)
 S DR(1,2260,220)="256///^S X=ARR(86)"
"RTN","OOPSGUI5",164,0)
 S DR(1,2260,225)="258///^S X=ARR(87)"
"RTN","OOPSGUI5",165,0)
 S DR(1,2260,230)="259///^S X=ARR(88)"
"RTN","OOPSGUI5",166,0)
 S DR(1,2260,235)="260///^S X=ARR(89)"
"RTN","OOPSGUI5",167,0)
 S DR(1,2260,240)="261///^S X=ARR(90)"
"RTN","OOPSGUI5",168,0)
 S DR(1,2260,245)="262///^S X=ARR(91)"
"RTN","OOPSGUI5",169,0)
 S DR(1,2260,250)="263///^S X=ARR(92)"
"RTN","OOPSGUI5",170,0)
 S DR(1,2260,255)="264///^S X=ARR(93)"
"RTN","OOPSGUI5",171,0)
 S DR(1,2260,260)="268///^S X=ARR(97)"
"RTN","OOPSGUI5",172,0)
 S DR(1,2260,265)="269///^S X=ARR(98)"
"RTN","OOPSGUI5",173,0)
 S DR(1,2260,270)="269.1///^S X=ARR(99)"
"RTN","OOPSGUI5",174,0)
 S DR(1,2260,275)="270///^S X=ARR(100)"
"RTN","OOPSGUI5",175,0)
 ; Patch 5 llh - added new fields
"RTN","OOPSGUI5",176,0)
 S DR(1,2260,276)="330///^S X=ARR(101)"
"RTN","OOPSGUI5",177,0)
 S DR(1,2260,277)="331///^S X=ARR(102)"
"RTN","OOPSGUI5",178,0)
 D ^DIE I $D(Y)=0 S RESULTS(1)="UPDATE COMPLETED"
"RTN","OOPSGUI5",179,0)
 Q
"RTN","OOPSGUI8")
0^5^B50811506^B46205454
"RTN","OOPSGUI8",1,0)
OOPSGUI8 ;WIOFO/LLH-RPC Broker calls for GUI ;10/23/01
"RTN","OOPSGUI8",2,0)
 ;;2.0;ASISTS;**8,7,11,15**;Jun 03, 2002;Build 9
"RTN","OOPSGUI8",3,0)
 ;
"RTN","OOPSGUI8",4,0)
EN1(RESULTS,INPUT) ; Entry point for routine
"RTN","OOPSGUI8",5,0)
 ;  Input:  INPUT contains the IEN of the ASISTS record and the 
"RTN","OOPSGUI8",6,0)
 ;          calling menu, in the format IEN^CALLING MENU
"RTN","OOPSGUI8",7,0)
 ; Output:  RESULTS contains status messages back to the client. 
"RTN","OOPSGUI8",8,0)
 ;          RESULTS(0) will = either 1 or 0.  1 if ok for form to be
"RTN","OOPSGUI8",9,0)
 ;          signed by calling menu option, 0 if not ok.  The RESULTS
"RTN","OOPSGUI8",10,0)
 ;          array with status message will start at 1.
"RTN","OOPSGUI8",11,0)
 ;
"RTN","OOPSGUI8",12,0)
 N CALL,CN,DIC,IEN,FORM,PRM1,PRM2,SIGN,Y
"RTN","OOPSGUI8",13,0)
 S CN=1
"RTN","OOPSGUI8",14,0)
 S IEN=$P($G(INPUT),U),CALL=$P($G(INPUT),U,2)
"RTN","OOPSGUI8",15,0)
 S FORM=$$GET1^DIQ(2260,IEN,52,"I")
"RTN","OOPSGUI8",16,0)
 S FORM=$S(FORM=1:"CA1",FORM=2:"CA2",1:"")
"RTN","OOPSGUI8",17,0)
 S PRM1=$S(CALL="O":"Safety Officer",CALL="H":"Occupational Health",1:0)
"RTN","OOPSGUI8",18,0)
 S PRM2=PRM1_" approves the WCP signing for the Employee: "
"RTN","OOPSGUI8",19,0)
 S SIGN=""
"RTN","OOPSGUI8",20,0)
 I '$G(IEN)!($G(FORM)="")!($G(CALL)="") D  Q
"RTN","OOPSGUI8",21,0)
 . S RESULTS(0)=0
"RTN","OOPSGUI8",22,0)
 . S RESULTS(1)="Missing Information, Cannot Continue"
"RTN","OOPSGUI8",23,0)
 I CALL="W" G WCPS4E
"RTN","OOPSGUI8",24,0)
 S RESULTS(0)=$$VALID()
"RTN","OOPSGUI8",25,0)
 I RESULTS(0) S RESULTS(CN)=PRM2,CN=CN+1
"RTN","OOPSGUI8",26,0)
 G EXIT
"RTN","OOPSGUI8",27,0)
WCPS4E ; allow WCP to sign for employee if all approvals given
"RTN","OOPSGUI8",28,0)
 N CONT,EHS,SIGN,SOS,VALID,VIEW
"RTN","OOPSGUI8",29,0)
 S SIGN=0,VALID=0,VIEW=1
"RTN","OOPSGUI8",30,0)
 ; V2_P15 - all code related to safety and occ health signing is obsolete, commented out
"RTN","OOPSGUI8",31,0)
 ;S SOS=$$GET1^DIQ(2260,IEN,76,"I")
"RTN","OOPSGUI8",32,0)
 ;S EHS=$$GET1^DIQ(2260,IEN,79,"I")
"RTN","OOPSGUI8",33,0)
 ;S CONT=$S(DUZ=SOS:"S",DUZ=EHS:"H",1:"")
"RTN","OOPSGUI8",34,0)
 ;I (CONT="S")!(CONT="H") D
"RTN","OOPSGUI8",35,0)
 ;. S RESULTS(CN)="You have approved as "_$S(CONT="S":"Safety Officer",CONT="H":"Occ Health Rep",1:"")
"RTN","OOPSGUI8",36,0)
 ;. S RESULTS(CN)=RESULTS(0)_" and cannot sign as Employee.",CN=CN+1
"RTN","OOPSGUI8",37,0)
 ;. S RESULTS(CN)="Three different individuals must be involved."
"RTN","OOPSGUI8",38,0)
 ;. S VIEW=0
"RTN","OOPSGUI8",39,0)
 ;I '$G(SOS) S VIEW=0 D
"RTN","OOPSGUI8",40,0)
 ;. S RESULTS(CN)="Safety Officer has not approved WCP signing for employee.",CN=CN+1
"RTN","OOPSGUI8",41,0)
 ;I '$G(EHS) S VIEW=0 D
"RTN","OOPSGUI8",42,0)
 ;. S RESULTS(CN)="Occupational Health has not approved WCP signing for employee.",CN=CN+1
"RTN","OOPSGUI8",43,0)
 I VIEW D
"RTN","OOPSGUI8",44,0)
 . ; Allow clearing WCP signature, employee may be able to sign
"RTN","OOPSGUI8",45,0)
 . I $$GET1^DIQ(2260,IEN,119,"I") D CLRES^OOPSUTL1(IEN,"E",FORM)
"RTN","OOPSGUI8",46,0)
 . ;V2P15 - needed to change the logic in the remaining code due to new functionality where
"RTN","OOPSGUI8",47,0)
 . ;        Safety and Occ Health do not need to approve prior to WC signing for employee.
"RTN","OOPSGUI8",48,0)
 . ;        Must now check required fields are completed before letting WC sign.
"RTN","OOPSGUI8",49,0)
 . ;D VALIDATE^OOPSUTL4(IEN,FORM,"E",.VALID)
"RTN","OOPSGUI8",50,0)
 . ;V2_P15 llh - modifed for patch 15 - RESULTS will contain the list of invalid fields if any
"RTN","OOPSGUI8",51,0)
 . ;             from OOPSGUI9.  If all fields ok, set RESULTS(0) to indicate that by setting =1
"RTN","OOPSGUI8",52,0)
 . S RESULTS(0)="The following required fields must be completed before signing"
"RTN","OOPSGUI8",53,0)
 . D VALIDATE^OOPSGUI9(IEN,FORM,"E",.VALID)
"RTN","OOPSGUI8",54,0)
 . ;I 'VALID S RESULTS(CN)="All required fields not completed",CN=CN+1 Q
"RTN","OOPSGUI8",55,0)
 . I VALID S RESULTS(0)=1
"RTN","OOPSGUI8",56,0)
 . I CALL="W" N CALLER S CALLER="E"
"RTN","OOPSGUI8",57,0)
 . D EMP^OOPSVAL1
"RTN","OOPSGUI8",58,0)
EXIT ;
"RTN","OOPSGUI8",59,0)
 Q
"RTN","OOPSGUI8",60,0)
VALID() ; make sure same person is not signing for both safety and EH and if
"RTN","OOPSGUI8",61,0)
 ; signed from menu option being called not needed again - so quit
"RTN","OOPSGUI8",62,0)
 N CONT,EHAPP,ERR,SOAPP,VALID
"RTN","OOPSGUI8",63,0)
 S VALID=1,ERR=0
"RTN","OOPSGUI8",64,0)
 ;
"RTN","OOPSGUI8",65,0)
 S SOAPP=$P($G(^OOPS(2260,IEN,"WCSE")),U)
"RTN","OOPSGUI8",66,0)
 S EHAPP=$P($G(^OOPS(2260,IEN,"WCSE")),U,4)
"RTN","OOPSGUI8",67,0)
 S CONT=$S(DUZ=SOAPP:"S",DUZ=EHAPP:"H",1:"")
"RTN","OOPSGUI8",68,0)
 I CALL="O" D
"RTN","OOPSGUI8",69,0)
 . I CONT="S" S ERR=1
"RTN","OOPSGUI8",70,0)
 . I $G(EHAPP)=DUZ S ERR=2
"RTN","OOPSGUI8",71,0)
 . I $G(SOAPP)&($G(CONT)="") S ERR=3
"RTN","OOPSGUI8",72,0)
 I CALL="H" D
"RTN","OOPSGUI8",73,0)
 . I CONT="H" S ERR=1
"RTN","OOPSGUI8",74,0)
 . I $G(SOAPP)=DUZ S ERR=2
"RTN","OOPSGUI8",75,0)
 . I $G(EHAPP)&($G(CONT)="") S ERR=3
"RTN","OOPSGUI8",76,0)
 I ERR=1 D
"RTN","OOPSGUI8",77,0)
 . S RESULTS(CN)="You have signed as "
"RTN","OOPSGUI8",78,0)
 . S RESULTS(CN)=RESULTS(CN)_PRM1
"RTN","OOPSGUI8",79,0)
 . S RESULTS(CN)=RESULTS(CN)_", Cannot sign."
"RTN","OOPSGUI8",80,0)
 . S CN=CN+1,VALID=0
"RTN","OOPSGUI8",81,0)
 I ERR=2 D
"RTN","OOPSGUI8",82,0)
 . S RESULTS(CN)="You have already signed as "
"RTN","OOPSGUI8",83,0)
 . S RESULTS(CN)=RESULTS(CN)_$S(CALL="O":"Occupational Health",CALL="H":"Safety Officer",1:0)_".",CN=CN+1
"RTN","OOPSGUI8",84,0)
 . S RESULTS(CN)="Both signatures cannot be made by the same person."
"RTN","OOPSGUI8",85,0)
 . S CN=CN+1,VALID=0
"RTN","OOPSGUI8",86,0)
 I ERR=3 D
"RTN","OOPSGUI8",87,0)
 . S RESULTS(CN)=PRM1_" has already signed, re-signing is not required."
"RTN","OOPSGUI8",88,0)
 . S CN=CN+1,VALID=0
"RTN","OOPSGUI8",89,0)
 Q VALID
"RTN","OOPSGUI8",90,0)
CSIGN(RESULTS,IEN,FORM,CALL) ; Clears Signature from form
"RTN","OOPSGUI8",91,0)
 ;
"RTN","OOPSGUI8",92,0)
 ;   Input:     IEN - IEN of the ASISTS case to have the
"RTN","OOPSGUI8",93,0)
 ;                    signature cleared from
"RTN","OOPSGUI8",94,0)
 ;             FORM - the Form to clear the signature from, 2162,
"RTN","OOPSGUI8",95,0)
 ;                    CA1 or CA2 or CA7 (CA7 added V2 patch 5)
"RTN","OOPSGUI8",96,0)
 ;             CALL - the calling menu
"RTN","OOPSGUI8",97,0)
 ;  Output: RESULTS - single value with status message
"RTN","OOPSGUI8",98,0)
 ;
"RTN","OOPSGUI8",99,0)
 S RESULTS="Clearing Signatures"
"RTN","OOPSGUI8",100,0)
 I ('$G(IEN))!($G(FORM)="")!($G(CALL)="") S RESULTS="FAILED"
"RTN","OOPSGUI8",101,0)
 ; V2 Patch 5 llh - added logic for CA7
"RTN","OOPSGUI8",102,0)
 I FORM'="CA7" D CLRES^OOPSUTL1(IEN,CALL,FORM)
"RTN","OOPSGUI8",103,0)
 I FORM="CA7" D CLRES^OOPSGUIS(IEN,CALL,FORM)
"RTN","OOPSGUI8",104,0)
 S RESULTS="CLEARED"
"RTN","OOPSGUI8",105,0)
 Q
"RTN","OOPSGUI8",106,0)
DTFC(RESULTS,DATE,FLAG) ; Reformat Date/Time
"RTN","OOPSGUI8",107,0)
 ;  Input  - Date to be reformatted
"RTN","OOPSGUI8",108,0)
 ;         - Flag to be used
"RTN","OOPSGUI8",109,0)
 ; Output  - RESULTS contains the reformatted date
"RTN","OOPSGUI8",110,0)
 ;
"RTN","OOPSGUI8",111,0)
 N X,%DT            ; patch 11 - added %DT
"RTN","OOPSGUI8",112,0)
 S FLAG=+$G(FLAG)
"RTN","OOPSGUI8",113,0)
 I DATE=""!(FLAG="") S (RESULTS,RESULTS(1))="" Q
"RTN","OOPSGUI8",114,0)
 S X=DATE,%DT="T" D ^%DT
"RTN","OOPSGUI8",115,0)
 S DATE=Y,X="NOW"
"RTN","OOPSGUI8",116,0)
 D ^%DT
"RTN","OOPSGUI8",117,0)
 I $S(DATE=-1:1,FLAG<0:Y<DATE,FLAG>0:DATE>Y,1:0) S DATE=-1
"RTN","OOPSGUI8",118,0)
 I DATE=-1 S (RESULTS,RESULTS(1))="DATE ERROR" Q
"RTN","OOPSGUI8",119,0)
 S (RESULTS,RESULTS(1))=$$FMTE^XLFDT(DATE,5)
"RTN","OOPSGUI8",120,0)
 Q
"RTN","OOPSGUI8",121,0)
GETNOI(RESULTS,OPT) ; Broker Call to retrieve NOI Codes
"RTN","OOPSGUI8",122,0)
 ;  Input:     OPT - Either CA1 or CA2 to indicate which codes should be
"RTN","OOPSGUI8",123,0)
 ;                   retrieved.  If CA1 must start with T, otherwise CA2
"RTN","OOPSGUI8",124,0)
 ; Output: RESULTS - NOI Description and Code
"RTN","OOPSGUI8",125,0)
 N NOI,DES,CODE,CN
"RTN","OOPSGUI8",126,0)
 S DES="",CN=0
"RTN","OOPSGUI8",127,0)
 F  S DES=$O(^OOPS(2263.3,"B",DES)) Q:DES=""  S NOI="" F  S NOI=$O(^OOPS(2263.3,"B",DES,NOI)) Q:NOI=""  D
"RTN","OOPSGUI8",128,0)
 . S CODE=$P(^OOPS(2263.3,NOI,0),U,2)
"RTN","OOPSGUI8",129,0)
 . I OPT="CA1",($E(CODE,1)="T") S RESULTS(CN)=NOI_":"_DES_" - "_CODE
"RTN","OOPSGUI8",130,0)
 . I OPT="CA2",($E(CODE,1)'="T") S RESULTS(CN)=NOI_":"_DES_" - "_CODE
"RTN","OOPSGUI8",131,0)
 . S CN=CN+1
"RTN","OOPSGUI8",132,0)
 Q
"RTN","OOPSGUI8",133,0)
ZIPCHK(RESULTS,DATA) ; patch 5 - validate zip code against file 5.12
"RTN","OOPSGUI8",134,0)
 ;                 to ensure zip in file and has correct state.
"RTN","OOPSGUI8",135,0)
 ;
"RTN","OOPSGUI8",136,0)
 ;  Input:    DATA - contains ZIP CODE^STATE NAME
"RTN","OOPSGUI8",137,0)
 ; Output: RESULTS - returns message with validation results
"RTN","OOPSGUI8",138,0)
 ;
"RTN","OOPSGUI8",139,0)
 N STATE,VALSTATE,VALZIP,ZIP,ZZIP
"RTN","OOPSGUI8",140,0)
 S ZIP=$P($G(DATA),U,1),STATE=$P($G(DATA),U,2)
"RTN","OOPSGUI8",141,0)
 S RESULTS=""
"RTN","OOPSGUI8",142,0)
 I '$G(ZIP)!($G(STATE)="") S RESULTS="MISSING PARAMETERS" Q
"RTN","OOPSGUI8",143,0)
 D POSTAL^XIPUTIL(ZIP,.ZZIP)
"RTN","OOPSGUI8",144,0)
 I $G(ZZIP("ERROR"))'="" S RESULTS="ZIP CODE NOT FOUND" Q
"RTN","OOPSGUI8",145,0)
 I STATE'=ZZIP("STATE") S RESULTS="STATE MISMATCH ON ZIP" Q
"RTN","OOPSGUI8",146,0)
 S RESULTS="VALID ZIP/STATE"
"RTN","OOPSGUI8",147,0)
 Q
"RTN","OOPSGUI8",148,0)
AMEND(RESULTS,OLDIEN) ; File new Amended Case
"RTN","OOPSGUI8",149,0)
 ;  Input:  OLDIEN - The ASISTS IEN for the case to have an
"RTN","OOPSGUI8",150,0)
 ;                   amendment created for.
"RTN","OOPSGUI8",151,0)
 ; Output: RESULTS - Single value with the new case number
"RTN","OOPSGUI8",152,0)
 ;
"RTN","OOPSGUI8",153,0)
 N DLAYGO
"RTN","OOPSGUI8",154,0)
 Q:$P(^OOPS(2260,OLDIEN,0),"^",6)'=0   ;defensive code, should not occur
"RTN","OOPSGUI8",155,0)
 S NUM=$P(^OOPS(2260,OLDIEN,0),U,1),SUF=$E(NUM,11)
"RTN","OOPSGUI8",156,0)
 S $P(^OOPS(2260,OLDIEN,0),U,6)=3
"RTN","OOPSGUI8",157,0)
 S NUM=$E(NUM,1,10)_$S(SUF="":"A",1:$CHAR($ASCII(SUF)+1))
"RTN","OOPSGUI8",158,0)
 K DD,DO
"RTN","OOPSGUI8",159,0)
 S DLAYGO=2260,DIC="^OOPS(2260,",DIC(0)="QLZ",X=NUM
"RTN","OOPSGUI8",160,0)
 D FILE^DICN G:Y=-1 DONE
"RTN","OOPSGUI8",161,0)
 S NEWIEN=+Y
"RTN","OOPSGUI8",162,0)
 MERGE ^OOPS(2260,NEWIEN)=^OOPS(2260,OLDIEN)
"RTN","OOPSGUI8",163,0)
 S OOP=^OOPS(2260,NEWIEN,0)
"RTN","OOPSGUI8",164,0)
 S $P(OOP,U,1)=NUM,$P(OOP,U,6)=0,$P(OOP,U,11)="",$P(OOP,U,19)=""
"RTN","OOPSGUI8",165,0)
 S ^OOPS(2260,NEWIEN,0)=OOP,$P(^OOPS(2260,NEWIEN,"CA"),U,6)=""
"RTN","OOPSGUI8",166,0)
 S DIK="^OOPS(2260,",DA=NEWIEN D IX^DIK
"RTN","OOPSGUI8",167,0)
 K ^OOPS(2260,NEWIEN,"2162ES")
"RTN","OOPSGUI8",168,0)
 K ^OOPS(2260,NEWIEN,"CA1ES")
"RTN","OOPSGUI8",169,0)
 K ^OOPS(2260,NEWIEN,"CA2ES")
"RTN","OOPSGUI8",170,0)
 N IEN,X,WCPDUZ,WOK
"RTN","OOPSGUI8",171,0)
 S WCPDUZ=$P($G(^OOPS(2260,NEWIEN,"WCES")),U)
"RTN","OOPSGUI8",172,0)
 I $G(WCPDUZ) S WOK=1,X=WCPDUZ,IEN=OLDIEN D WK^OOPSUTL1
"RTN","OOPSGUI8",173,0)
 K ^OOPS(2260,NEWIEN,"WCES")
"RTN","OOPSGUI8",174,0)
 S RESULTS=NUM
"RTN","OOPSGUI8",175,0)
DONE K DA,DIC,OLDIEN,NEWIEN,NUM,SUF,X,Y,DIK,OOP
"RTN","OOPSGUI8",176,0)
 Q
"RTN","OOPSGUI8",177,0)
SETDLOC(RESULTS,P1,DATA) ; files the detail location records
"RTN","OOPSGUI8",178,0)
 ;  Input - P1 is the Location record IEN concatenated with the station
"RTN","OOPSGUI8",179,0)
 ;              subrecord IEN. EX.  38^600  
"RTN","OOPSGUI8",180,0)
 ;          DATA is a # subscripted array containing the detail loc data
"RTN","OOPSGUI8",181,0)
 ;          in the format - detail location description^Detail Loc IEN  
"RTN","OOPSGUI8",182,0)
 ; Output - RESULTS indicating the success of the filing.
"RTN","OOPSGUI8",183,0)
 N CNT,IENS,FILE,LV1,LV2,LOC,MSG,REC,RECNO,STAFDA,STR
"RTN","OOPSGUI8",184,0)
 S BAD=0,FILE=2261.4,LOC=$P(P1,U),STA=$P(P1,U,2),RESULTS=""
"RTN","OOPSGUI8",185,0)
 I $D(DATA)<10 S RESULTS="NO DATA TO FILE, CANNOT CONTINUE" Q
"RTN","OOPSGUI8",186,0)
 I '$G(STA) S RESULTS="NO STATION SENT, COULDN'T FILE" Q
"RTN","OOPSGUI8",187,0)
 I '$G(LOC) S RESULTS="NO LOCATION SENT, COULDN'T FILE" Q
"RTN","OOPSGUI8",188,0)
 I '$D(^OOPS(FILE,LOC,1,"B",STA)) D  I BAD Q
"RTN","OOPSGUI8",189,0)
 .S IENS="+1,"_LOC_",",STAFDA(2261.43,IENS,.01)=STA
"RTN","OOPSGUI8",190,0)
 .D UPDATE^DIE("","STAFDA","IENS","MSG")
"RTN","OOPSGUI8",191,0)
 .I $D(MSG("DIERR")) D
"RTN","OOPSGUI8",192,0)
 ..S RESULTS="PROBLEM FILING NEW STATION SUBRECORD",BAD=1
"RTN","OOPSGUI8",193,0)
 ;KILL THE DETAIL LOCATION REC FOR STATION AND LOCATION PASSED IN
"RTN","OOPSGUI8",194,0)
 S DIENS=$O(^OOPS(FILE,"E",STA,LOC,"")),LV1=$O(^OOPS(FILE,LOC,0))
"RTN","OOPSGUI8",195,0)
 I $G(DIENS) D
"RTN","OOPSGUI8",196,0)
 .S LV2=$O(^OOPS(FILE,LOC,LV1,DIENS,0))
"RTN","OOPSGUI8",197,0)
 .I $G(LV2) K ^OOPS(FILE,LOC,LV1,DIENS,LV2)
"RTN","OOPSGUI8",198,0)
 .I $D(^OOPS(FILE,"F",DIENS,LOC)) K ^OOPS(FILE,"F",DIENS,LOC)
"RTN","OOPSGUI8",199,0)
 ;RE-FILE THE DETAIL LOCATION LEVEL RECORD
"RTN","OOPSGUI8",200,0)
 K STAFDA S CNT=0,RECNO=0,REC=""
"RTN","OOPSGUI8",201,0)
 F  S REC=$O(DATA(REC)) Q:REC=""  D
"RTN","OOPSGUI8",202,0)
 .S STR=DATA(REC),RECNO=$P(STR,U,2),CNT=CNT+1
"RTN","OOPSGUI8",203,0)
 .I RECNO="" S RECNO=CNT
"RTN","OOPSGUI8",204,0)
 .S IENS="+"_RECNO_","_DIENS_","_LOC_","
"RTN","OOPSGUI8",205,0)
 .S STAFDA(2261.431,IENS,.01)=$P(STR,U,1)
"RTN","OOPSGUI8",206,0)
 D UPDATE^DIE("E","STAFDA","IENS","MSG")
"RTN","OOPSGUI8",207,0)
 I '$D(MSG) S RESULTS="Filing Successful"
"RTN","OOPSGUI8",208,0)
 K MSG,STR,Y,X,%DT
"RTN","OOPSGUI8",209,0)
 Q
"RTN","OOPSGUID")
0^6^B67336971^B30022126
"RTN","OOPSGUID",1,0)
OOPSGUID ;WIOFO/LLH-RPC routine for GET/SET CA7 ;04/29/04
"RTN","OOPSGUID",2,0)
 ;;2.0;ASISTS;**8,15**;Jun 03, 2002;Build 9
"RTN","OOPSGUID",3,0)
 ;
"RTN","OOPSGUID",4,0)
SAVECA7 ; saves CA7 data to database
"RTN","OOPSGUID",5,0)
 S (RESULTS,RESULTS(1),RESULTS(2))=""
"RTN","OOPSGUID",6,0)
 I $G(IEN)="NEW" D NEWCA7 I $P(RESULTS(2),U,2)'="CA7 Created" Q
"RTN","OOPSGUID",7,0)
 ;
"RTN","OOPSGUID",8,0)
 S RESULTS(1)=IEN_U_"UPDATE FAILED"
"RTN","OOPSGUID",9,0)
 K DR S DIE="^OOPS(2264,",DA=IEN,DR=""
"RTN","OOPSGUID",10,0)
 S DR(1,2264,1)="1///^S X=ARR(6)"
"RTN","OOPSGUID",11,0)
 S DR(1,2264,2)="2////^S X=ARR(7)"
"RTN","OOPSGUID",12,0)
 S DR(1,2264,3)="3///^S X=ARR(8)"
"RTN","OOPSGUID",13,0)
 S DR(1,2264,4)="4///^S X=ARR(9)"
"RTN","OOPSGUID",14,0)
 S DR(1,2264,5)="5////^S X=ARR(10)"
"RTN","OOPSGUID",15,0)
 S DR(1,2264,6)="6///^S X=ARR(11)"
"RTN","OOPSGUID",16,0)
 S DR(1,2264,7)="7///^S X=ARR(12)"
"RTN","OOPSGUID",17,0)
 S DR(1,2264,8)="8///^S X=ARR(13)"
"RTN","OOPSGUID",18,0)
 S DR(1,2264,11)="9///^S X=ARR(14)"
"RTN","OOPSGUID",19,0)
 S DR(1,2264,12)="10///^S X=ARR(15)"
"RTN","OOPSGUID",20,0)
 S DR(1,2264,13)="11///^S X=ARR(16)"
"RTN","OOPSGUID",21,0)
 S DR(1,2264,14)="12///^S X=ARR(17)"
"RTN","OOPSGUID",22,0)
 S DR(1,2264,15)="13///^S X=ARR(18)"
"RTN","OOPSGUID",23,0)
 S DR(1,2264,16)="14///^S X=ARR(19)"
"RTN","OOPSGUID",24,0)
 S DR(1,2264,17)="15///^S X=ARR(20)"
"RTN","OOPSGUID",25,0)
 S DR(1,2264,18)="16///^S X=ARR(21)"
"RTN","OOPSGUID",26,0)
 S DR(1,2264,19)="17///^S X=ARR(22)"
"RTN","OOPSGUID",27,0)
 S DR(1,2264,20)="18///^S X=ARR(23)"
"RTN","OOPSGUID",28,0)
 S DR(1,2264,21)="19///^S X=ARR(24)"
"RTN","OOPSGUID",29,0)
 S DR(1,2264,22)="20///^S X=ARR(25)"
"RTN","OOPSGUID",30,0)
 S DR(1,2264,24)="21///^S X=ARR(26)"
"RTN","OOPSGUID",31,0)
 S DR(1,2264,25)="22///^S X=ARR(27)"
"RTN","OOPSGUID",32,0)
 S DR(1,2264,26)="23///^S X=ARR(28)"
"RTN","OOPSGUID",33,0)
 S DR(1,2264,27)="24///^S X=ARR(29)"
"RTN","OOPSGUID",34,0)
 S DR(1,2264,28)="25///^S X=ARR(30)"
"RTN","OOPSGUID",35,0)
 S DR(1,2264,29)="27///^S X=ARR(31)"
"RTN","OOPSGUID",36,0)
 S DR(1,2264,30)="28///^S X=ARR(32)"
"RTN","OOPSGUID",37,0)
 S DR(1,2264,31)="29///^S X=ARR(33)"
"RTN","OOPSGUID",38,0)
 S DR(1,2264,32)="30///^S X=ARR(34)"
"RTN","OOPSGUID",39,0)
 S DR(1,2264,33)="31///^S X=ARR(35)"
"RTN","OOPSGUID",40,0)
 S DR(1,2264,34)="32///^S X=ARR(36)"
"RTN","OOPSGUID",41,0)
 S DR(1,2264,35)="33///^S X=ARR(37)"
"RTN","OOPSGUID",42,0)
 S DR(1,2264,36)="34///^S X=ARR(38)"
"RTN","OOPSGUID",43,0)
 S DR(1,2264,37)="35///^S X=ARR(39)"
"RTN","OOPSGUID",44,0)
 S DR(1,2264,38)="36///^S X=ARR(40)"
"RTN","OOPSGUID",45,0)
 S DR(1,2264,39)="37///^S X=ARR(41)"
"RTN","OOPSGUID",46,0)
 S DR(1,2264,40)="38///^S X=ARR(42)"
"RTN","OOPSGUID",47,0)
 S DR(1,2264,41)="39///^S X=ARR(43)"
"RTN","OOPSGUID",48,0)
 S DR(1,2264,42)="40///^S X=ARR(44)"
"RTN","OOPSGUID",49,0)
 S DR(1,2264,43)="41///^S X=ARR(45)"
"RTN","OOPSGUID",50,0)
 S DR(1,2264,44)="41.3///^S X=ARR(46)"
"RTN","OOPSGUID",51,0)
 S DR(1,2264,45)="41.6///^S X=ARR(47)"
"RTN","OOPSGUID",52,0)
 S DR(1,2264,46)="42///^S X=ARR(48)"
"RTN","OOPSGUID",53,0)
 S DR(1,2264,47)="43///^S X=ARR(49)"
"RTN","OOPSGUID",54,0)
 S DR(1,2264,48)="44///^S X=ARR(50)"
"RTN","OOPSGUID",55,0)
 S DR(1,2264,49)="45///^S X=ARR(51)"
"RTN","OOPSGUID",56,0)
 S DR(1,2264,50)="46///^S X=ARR(52)"
"RTN","OOPSGUID",57,0)
 S DR(1,2264,51)="47///^S X=ARR(53)"
"RTN","OOPSGUID",58,0)
 S DR(1,2264,52)="48///^S X=ARR(54)"
"RTN","OOPSGUID",59,0)
 S DR(1,2264,53)="49///^S X=ARR(55)"
"RTN","OOPSGUID",60,0)
 S DR(1,2264,54)="50///^S X=ARR(56)"
"RTN","OOPSGUID",61,0)
 S DR(1,2264,55)="51///^S X=ARR(57)"
"RTN","OOPSGUID",62,0)
 D ^DIE
"RTN","OOPSGUID",63,0)
 I '($D(Y)=0) Q
"RTN","OOPSGUID",64,0)
 K DR S DIE="^OOPS(2264,",DA=IEN,DR=""
"RTN","OOPSGUID",65,0)
 S DR(1,2264,56)="52///^S X=ARR(58)"
"RTN","OOPSGUID",66,0)
 S DR(1,2264,57)="53///^S X=ARR(59)"
"RTN","OOPSGUID",67,0)
 S DR(1,2264,58)="54///^S X=ARR(60)"
"RTN","OOPSGUID",68,0)
 S DR(1,2264,59)="56///^S X=ARR(61)"
"RTN","OOPSGUID",69,0)
 S DR(1,2264,60)="57///^S X=ARR(62)"
"RTN","OOPSGUID",70,0)
 S DR(1,2264,61)="58///^S X=ARR(63)"
"RTN","OOPSGUID",71,0)
 S DR(1,2264,62)="59///^S X=ARR(64)"
"RTN","OOPSGUID",72,0)
 S DR(1,2264,63)="60///^S X=ARR(65)"
"RTN","OOPSGUID",73,0)
 S DR(1,2264,64)="62///^S X=ARR(66)"
"RTN","OOPSGUID",74,0)
 S DR(1,2264,65)="63///^S X=ARR(67)"
"RTN","OOPSGUID",75,0)
 S DR(1,2264,66)="64///^S X=ARR(68)"
"RTN","OOPSGUID",76,0)
 S DR(1,2264,67)="65///^S X=ARR(69)"
"RTN","OOPSGUID",77,0)
 S DR(1,2264,68)="67///^S X=ARR(70)"
"RTN","OOPSGUID",78,0)
 S DR(1,2264,69)="68///^S X=ARR(71)"
"RTN","OOPSGUID",79,0)
 S DR(1,2264,70)="69///^S X=ARR(72)"
"RTN","OOPSGUID",80,0)
 S DR(1,2264,71)="70///^S X=ARR(73)"
"RTN","OOPSGUID",81,0)
 S DR(1,2264,72)="71///^S X=ARR(74)"
"RTN","OOPSGUID",82,0)
 S DR(1,2264,73)="72///^S X=ARR(75)"
"RTN","OOPSGUID",83,0)
 S DR(1,2264,74)="73///^S X=ARR(76)"
"RTN","OOPSGUID",84,0)
 S DR(1,2264,75)="74///^S X=ARR(77)"
"RTN","OOPSGUID",85,0)
 S DR(1,2264,76)="75///^S X=ARR(78)"
"RTN","OOPSGUID",86,0)
 S DR(1,2264,77)="76///^S X=ARR(79)"
"RTN","OOPSGUID",87,0)
 S DR(1,2264,78)="78///^S X=ARR(80)"
"RTN","OOPSGUID",88,0)
 S DR(1,2264,79)="79///^S X=ARR(81)"
"RTN","OOPSGUID",89,0)
 S DR(1,2264,80)="80///^S X=ARR(82)"
"RTN","OOPSGUID",90,0)
 S DR(1,2264,81)="81///^S X=ARR(83)"
"RTN","OOPSGUID",91,0)
 S DR(1,2264,82)="82///^S X=ARR(84)"
"RTN","OOPSGUID",92,0)
 S DR(1,2264,83)="83///^S X=ARR(85)"
"RTN","OOPSGUID",93,0)
 S DR(1,2264,84)="84///^S X=ARR(86)"
"RTN","OOPSGUID",94,0)
 S DR(1,2264,85)="85///^S X=ARR(87)"
"RTN","OOPSGUID",95,0)
 S DR(1,2264,86)="86///^S X=ARR(88)"
"RTN","OOPSGUID",96,0)
 S DR(1,2264,87)="87///^S X=ARR(89)"
"RTN","OOPSGUID",97,0)
 S DR(1,2264,88)="88///^S X=ARR(90)"
"RTN","OOPSGUID",98,0)
 S DR(1,2264,89)="89///^S X=ARR(91)"
"RTN","OOPSGUID",99,0)
 S DR(1,2264,90)="90///^S X=ARR(92)"
"RTN","OOPSGUID",100,0)
 S DR(1,2264,91)="91///^S X=ARR(93)"
"RTN","OOPSGUID",101,0)
 S DR(1,2264,92)="92///^S X=ARR(94)"
"RTN","OOPSGUID",102,0)
 S DR(1,2264,93)="93///^S X=ARR(95)"
"RTN","OOPSGUID",103,0)
 S DR(1,2264,94)="94///^S X=ARR(96)"
"RTN","OOPSGUID",104,0)
 ; V2_P15, added new field llh
"RTN","OOPSGUID",105,0)
 S DR(1,2264,95)="98///^S X=ARR(97)"
"RTN","OOPSGUID",106,0)
 D ^DIE
"RTN","OOPSGUID",107,0)
 ;Check the return of ^DIE
"RTN","OOPSGUID",108,0)
 I $D(Y)=0 S RESULTS(1)=IEN_U_ARR(0)_U_"UPDATE COMPLETED"
"RTN","OOPSGUID",109,0)
 Q
"RTN","OOPSGUID",110,0)
NEWCA7 ; need to file the CA7 first, then file the remaining data
"RTN","OOPSGUID",111,0)
 N ACLAIM,CA7,DLAYGO,DR,DIC,I,X
"RTN","OOPSGUID",112,0)
 S CA7=""
"RTN","OOPSGUID",113,0)
 I '$G(ARR(3)) S (RESULTS,RESULTS(1))="No ASISTS IEN, cannot file" Q
"RTN","OOPSGUID",114,0)
 I '$D(^OOPS(2260,ARR(3),0)) D  Q
"RTN","OOPSGUID",115,0)
 . S (RESULTS,RESULTS(1))="ASISTS claim not on file, cannot continue"
"RTN","OOPSGUID",116,0)
 S ACLAIM=$$GET1^DIQ(2260,ARR(3),.01)
"RTN","OOPSGUID",117,0)
 I $G(ACLAIM)="" D  Q
"RTN","OOPSGUID",118,0)
 . S (RESULTS,RESULTS(1))="No ASISTS claim number, cannot continue"
"RTN","OOPSGUID",119,0)
 S ARR(0)=$$CA7NUM()
"RTN","OOPSGUID",120,0)
 I $G(ARR(0))="" D  Q
"RTN","OOPSGUID",121,0)
 . S (RESULTS,RESULTS(1))="Could not build CA7 Number, cannot continue"
"RTN","OOPSGUID",122,0)
 S ARR(1)=$$NOW()
"RTN","OOPSGUID",123,0)
 K DD,DO S DLAYGO=2264,DIC="^OOPS(2264,",DIC(0)="L",X=ARR(0)
"RTN","OOPSGUID",124,0)
 S DIC("DR")=".3////^S X=ARR(1);.5////^S X=DUZ;.7////^S X=ARR(3);.8////^S X=ARR(4);.9////^S X=ARR(5)"
"RTN","OOPSGUID",125,0)
 D FILE^DICN I +Y>0 D
"RTN","OOPSGUID",126,0)
 . S (RESULTS,RESULTS(2))=IEN_U_"CA7 Created"
"RTN","OOPSGUID",127,0)
 . S IEN=+Y
"RTN","OOPSGUID",128,0)
 Q
"RTN","OOPSGUID",129,0)
CA7NUM() ; gets next CA-7 number
"RTN","OOPSGUID",130,0)
 N CASE,NUM,CA7TEST
"RTN","OOPSGUID",131,0)
 S CA7TEST=ACLAIM_"-CA7"
"RTN","OOPSGUID",132,0)
 S CASE="^OOPS(2264,"_"""B"""_","""_CA7TEST_""")"
"RTN","OOPSGUID",133,0)
 F  S CASE=$Q(@CASE) Q:$P(CASE,",",3)'[ACLAIM  S CA7=$P(CASE,",",3)
"RTN","OOPSGUID",134,0)
 S NUM=$P(CA7,"-",4)+1,NUM=$E("000",1,3-$L(NUM))_NUM
"RTN","OOPSGUID",135,0)
 Q $P(CA7TEST,"-",1,3)_"-"_NUM
"RTN","OOPSGUID",136,0)
 ;
"RTN","OOPSGUID",137,0)
NOW() ; returns current date and time
"RTN","OOPSGUID",138,0)
 N %,%I,%H,X
"RTN","OOPSGUID",139,0)
 D NOW^%DTC
"RTN","OOPSGUID",140,0)
 Q %
"RTN","OOPSGUID",141,0)
DUAL(RESULTS,INPUT,DATA) ; new sub for filing DUAL node fields - 
"RTN","OOPSGUID",142,0)
 ;                         need to add parameters back
"RTN","OOPSGUID",143,0)
 ; for the Dual Benefit form answered from the CA1 or CA2
"RTN","OOPSGUID",144,0)
 ;
"RTN","OOPSGUID",145,0)
 ; Input:  INPUT - IEN^FORM; first piece is the record identifier
"RTN","OOPSGUID",146,0)
 ;                           2nd piece is the form, CA1 or CA2
"RTN","OOPSGUID",147,0)
 ;          DATA - data string, p1=fld 303, p2=304, p3=305, p4=306
"RTN","OOPSGUID",148,0)
 ;                 p5=307, p6=308
"RTN","OOPSGUID",149,0)
 ;                 data does not include electronic signature fields
"RTN","OOPSGUID",150,0)
 ;                 for the node 
"RTN","OOPSGUID",151,0)
 ;
"RTN","OOPSGUID",152,0)
 N ARR,CN,DA,DIE,DR,LP,IEN
"RTN","OOPSGUID",153,0)
 S RESULTS="No Changes Filed"
"RTN","OOPSGUID",154,0)
 S IEN=$P($G(INPUT),U)
"RTN","OOPSGUID",155,0)
 I '$G(IEN) S RESULTS="No IEN passed in - save failed" Q
"RTN","OOPSGUID",156,0)
 K DR S DIE="^OOPS(2260,",DA=IEN,DR=""
"RTN","OOPSGUID",157,0)
 I '$L($TR(DATA,"^","")) S RESULTS="No data to save" Q
"RTN","OOPSGUID",158,0)
 F LP=1:1:6 S ARR(LP)=$P($G(DATA),U,LP)
"RTN","OOPSGUID",159,0)
 S DR(1,2260,1)="303///^S X=ARR(1)"
"RTN","OOPSGUID",160,0)
 S DR(1,2260,2)="304///^S X=ARR(2)"
"RTN","OOPSGUID",161,0)
 S DR(1,2260,3)="305///^S X=ARR(3)"
"RTN","OOPSGUID",162,0)
 S DR(1,2260,4)="306///^S X=ARR(4)"
"RTN","OOPSGUID",163,0)
 S DR(1,2260,5)="307///^S X=ARR(5)"
"RTN","OOPSGUID",164,0)
 S DR(1,2260,6)="308///^S X=ARR(6)"
"RTN","OOPSGUID",165,0)
 D ^DIE
"RTN","OOPSGUID",166,0)
 I $D(Y)=0 S RESULTS="UPDATE COMPLETED"
"RTN","OOPSGUID",167,0)
 Q
"RTN","OOPSGUID",168,0)
SAVE2162 ; V2_P15 moved entire SAVE2162 subroutine from OOPSGUI5 to here
"RTN","OOPSGUID",169,0)
 ; due to size of OOPSGUI5
"RTN","OOPSGUID",170,0)
 K DR S DIE="^OOPS(2260,",DA=IEN,DR=""
"RTN","OOPSGUID",171,0)
 S DR(1,2260,1)="3///^S X=ARR(3)"
"RTN","OOPSGUID",172,0)
 S DR(1,2260,2)="5///^S X=ARR(5)"
"RTN","OOPSGUID",173,0)
 S DR(1,2260,3)="6///^S X=ARR(6)"
"RTN","OOPSGUID",174,0)
 S DR(1,2260,4)="7///^S X=ARR(7)"
"RTN","OOPSGUID",175,0)
 S DR(1,2260,5)="8///^S X=ARR(8)"
"RTN","OOPSGUID",176,0)
 S DR(1,2260,7)="9///^S X=ARR(9)"
"RTN","OOPSGUID",177,0)
 S DR(1,2260,9)="10///^S X=ARR(10)"
"RTN","OOPSGUID",178,0)
 S DR(1,2260,12)="11///^S X=ARR(11)"
"RTN","OOPSGUID",179,0)
 S DR(1,2260,15)="12///^S X=ARR(12)"
"RTN","OOPSGUID",180,0)
 S DR(1,2260,18)="13////^S X=ARR(13)"
"RTN","OOPSGUID",181,0)
 S DR(1,2260,21)="14///^S X=ARR(14)"
"RTN","OOPSGUID",182,0)
 S DR(1,2260,24)="15///^S X=ARR(15)"
"RTN","OOPSGUID",183,0)
 S DR(1,2260,27)="16///^S X=ARR(16)"
"RTN","OOPSGUID",184,0)
 S DR(1,2260,30)="17///^S X=ARR(17)"
"RTN","OOPSGUID",185,0)
 S DR(1,2260,33)="18///^S X=ARR(18)"
"RTN","OOPSGUID",186,0)
 S DR(1,2260,36)="26///^S X=ARR(19)"
"RTN","OOPSGUID",187,0)
 S DR(1,2260,39)="27////^S X=ARR(20)"
"RTN","OOPSGUID",188,0)
 S DR(1,2260,42)="29///^S X=ARR(21)"
"RTN","OOPSGUID",189,0)
 S DR(1,2260,45)="29.5///^S X=ARR(22)"
"RTN","OOPSGUID",190,0)
 S DR(1,2260,48)="30///^S X=ARR(23)"
"RTN","OOPSGUID",191,0)
 S DR(1,2260,51)="30.1///^S X=ARR(24)"
"RTN","OOPSGUID",192,0)
 S DR(1,2260,54)="31///^S X=ARR(25)"
"RTN","OOPSGUID",193,0)
 S DR(1,2260,57)="32///^S X=ARR(26)"
"RTN","OOPSGUID",194,0)
 S DR(1,2260,60)="33///^S X=ARR(27)"
"RTN","OOPSGUID",195,0)
 S DR(1,2260,63)="34///^S X=ARR(28)"
"RTN","OOPSGUID",196,0)
 S DR(1,2260,66)="35///^S X=ARR(29)"
"RTN","OOPSGUID",197,0)
 S DR(1,2260,69)="36///^S X=ARR(30)"
"RTN","OOPSGUID",198,0)
 S DR(1,2260,72)="37///^S X=ARR(31)"
"RTN","OOPSGUID",199,0)
 S DR(1,2260,75)="38///^S X=ARR(32)"
"RTN","OOPSGUID",200,0)
 S DR(1,2260,78)="41///^S X=ARR(33)"
"RTN","OOPSGUID",201,0)
 S DR(1,2260,81)="42///^S X=ARR(34)"
"RTN","OOPSGUID",202,0)
 S DR(1,2260,84)="42.5///^S X=ARR(35)"
"RTN","OOPSGUID",203,0)
 S DR(1,2260,87)="43///^S X=ARR(36)"
"RTN","OOPSGUID",204,0)
 S DR(1,2260,90)="53////^S X=ARR(45)"
"RTN","OOPSGUID",205,0)
 S DR(1,2260,93)="53.1////^S X=ARR(46)"
"RTN","OOPSGUID",206,0)
 S DR(1,2260,96)="60///^S X=ARR(52)"
"RTN","OOPSGUID",207,0)
 S DR(1,2260,99)="61///^S X=ARR(53)"
"RTN","OOPSGUID",208,0)
 S DR(1,2260,102)="62///^S X=ARR(54)"
"RTN","OOPSGUID",209,0)
 S DR(1,2260,105)="63///^S X=ARR(55)"
"RTN","OOPSGUID",210,0)
 S DR(1,2260,108)="70///^S X=ARR(60)"
"RTN","OOPSGUID",211,0)
 S DR(1,2260,111)="73///^S X=ARR(63)"
"RTN","OOPSGUID",212,0)
 S DR(1,2260,114)="82///^S X=ARR(72)"
"RTN","OOPSGUID",213,0)
 S DR(1,2260,117)="83////^S X=ARR(73)"
"RTN","OOPSGUID",214,0)
 S DR(1,2260,120)="84///^S X=ARR(74)"
"RTN","OOPSGUID",215,0)
 S DR(1,2260,123)="85///^S X=ARR(75)"
"RTN","OOPSGUID",216,0)
 S DR(1,2260,126)="86///^S X=ARR(76)"
"RTN","OOPSGUID",217,0)
 S DR(1,2260,129)="87///^S X=ARR(77)"
"RTN","OOPSGUID",218,0)
 S DR(1,2260,132)="88///^S X=ARR(78)"
"RTN","OOPSGUID",219,0)
 S DR(1,2260,135)="89///^S X=ARR(79)"
"RTN","OOPSGUID",220,0)
 S DR(1,2260,136)="335///^S X=ARR(85)"
"RTN","OOPSGUID",221,0)
 S DR(1,2260,138)="336///^S X=ARR(86)"
"RTN","OOPSGUID",222,0)
 S DR(1,2260,140)="337///^S X=ARR(87)"
"RTN","OOPSGUID",223,0)
 D ^DIE I '($D(Y)=0) Q
"RTN","OOPSGUID",224,0)
 S DR(1,2260,142)="338///^S X=ARR(88)"
"RTN","OOPSGUID",225,0)
 S DR(1,2260,144)="339///^S X=ARR(89)"
"RTN","OOPSGUID",226,0)
 S DR(1,2260,146)="340///^S X=ARR(90)"
"RTN","OOPSGUID",227,0)
 S DR(1,2260,148)="341///^S X=ARR(91)"
"RTN","OOPSGUID",228,0)
 S DR(1,2260,150)="342///^S X=ARR(92)"
"RTN","OOPSGUID",229,0)
 S DR(1,2260,152)="343///^S X=ARR(93)"
"RTN","OOPSGUID",230,0)
 S DR(1,2260,154)="344///^S X=ARR(94)"
"RTN","OOPSGUID",231,0)
 S DR(1,2260,156)="345///^S X=ARR(95)"
"RTN","OOPSGUID",232,0)
 S DR(1,2260,158)="346///^S X=ARR(96)"
"RTN","OOPSGUID",233,0)
 S DR(1,2260,159)="334///^S X=ARR(97)"
"RTN","OOPSGUID",234,0)
 S DR(1,2260,160)="348///^S X=ARR(98)"
"RTN","OOPSGUID",235,0)
 S DR(1,2260,161)="349///^S X=ARR(99)"
"RTN","OOPSGUID",236,0)
 S DR(1,2260,162)="350///^S X=ARR(100)"
"RTN","OOPSGUID",237,0)
 S DR(1,2260,163)="351///^S X=ARR(101)"
"RTN","OOPSGUID",238,0)
 S DR(1,2260,164)="352///^S X=ARR(102)"
"RTN","OOPSGUID",239,0)
 ; V2_P15 new fields
"RTN","OOPSGUID",240,0)
 S DR(1,2260,165)="354///^S X=ARR(103)"
"RTN","OOPSGUID",241,0)
 S DR(1,2260,166)="355///^S X=ARR(104)"
"RTN","OOPSGUID",242,0)
 S DR(1,2260,167)="356///^S X=ARR(105)"
"RTN","OOPSGUID",243,0)
 S DR(1,2260,168)="357///^S X=ARR(106)"
"RTN","OOPSGUID",244,0)
 S DR(1,2260,169)="358///^S X=ARR(107)"
"RTN","OOPSGUID",245,0)
 S DR(1,2260,170)="359///^S X=ARR(108)"
"RTN","OOPSGUID",246,0)
 D ^DIE I $D(Y)=0 S RESULTS(1)="UPDATE COMPLETED"
"RTN","OOPSGUID",247,0)
 ; V2_15 send new bulletin if the INITIAL RETURN TO WORK STATUS is one of 2 values below
"RTN","OOPSGUID",248,0)
 I ARR(102)="DAYS AWAY WORK"!(ARR(102)="Job Transfer/Restriction") D CIO^OOPSMBUL(IEN)
"RTN","OOPSGUID",249,0)
 Q
"RTN","OOPSGUIF")
0^7^B34611208^B31912751
"RTN","OOPSGUIF",1,0)
OOPSGUIF ;WIOFO/LLH-RPC routine for OSHA Log ;11/5/01
"RTN","OOPSGUIF",2,0)
 ;;2.0;ASISTS;**6,7,11,15**;Jun 03, 2002;Build 9
"RTN","OOPSGUIF",3,0)
 ;
"RTN","OOPSGUIF",4,0)
OSHA(RESULTS,INPUT,CALL) ; get the data
"RTN","OOPSGUIF",5,0)
 ;   Input:  INPUT - contains 4 values, the START AND END DATE, 
"RTN","OOPSGUIF",6,0)
 ;                   STATION, and INCLUDE NAME ON REPORT.  The Date of
"RTN","OOPSGUIF",7,0)
 ;                   Occ (fld #4) is used to in/exclude claims from the
"RTN","OOPSGUIF",8,0)
 ;                   report.  If Include name = Y, then names are
"RTN","OOPSGUIF",9,0)
 ;                   printed, else they will not,and if Station='ALL'
"RTN","OOPSGUIF",10,0)
 ;                   then all claims are included, if not 'All', then
"RTN","OOPSGUIF",11,0)
 ;                   only 1 station is included.
"RTN","OOPSGUIF",12,0)
 ;            CALL - Contains the calling menu.  If caller = "U"nion
"RTN","OOPSGUIF",13,0)
 ;                   name is excluded from printing.
"RTN","OOPSGUIF",14,0)
 ; Output: RESULTS - the results array passes data back to the client.
"RTN","OOPSGUIF",15,0)
 N CN,DA,IEN,INCNA,OCC,OOPS,PERSON,SDATE,STDT,STA,ENDDT,EDATE,X,Y
"RTN","OOPSGUIF",16,0)
 N GONE,LOST,DOI,CAX,FILL,TYPE
"RTN","OOPSGUIF",17,0)
 K ^TMP($J,"OSHA")
"RTN","OOPSGUIF",18,0)
 S CN=1,RESULTS(0)="Processing..."
"RTN","OOPSGUIF",19,0)
 S STDT=$P($G(INPUT),U),ENDDT=$P($G(INPUT),U,2)
"RTN","OOPSGUIF",20,0)
 S STA=$P($G(INPUT),U,3)
"RTN","OOPSGUIF",21,0)
 S INCNA=$P($G(INPUT),U,4)
"RTN","OOPSGUIF",22,0)
 I (STDT="")!(ENDDT="")!(STA="")!(INCNA="") D  Q
"RTN","OOPSGUIF",23,0)
 . S RESULTS(0)="Input parameters missing, cannot run report." Q
"RTN","OOPSGUIF",24,0)
 S (SDATE,EDATE)=""
"RTN","OOPSGUIF",25,0)
 S X=STDT D ^%DT S SDATE=Y
"RTN","OOPSGUIF",26,0)
 S X=ENDDT D ^%DT S EDATE=Y
"RTN","OOPSGUIF",27,0)
 ; SDATE made last time in day prior so start date correct
"RTN","OOPSGUIF",28,0)
 S SDATE=(SDATE-1)_".9999",EDATE=EDATE_".9999"
"RTN","OOPSGUIF",29,0)
 S LP="",IEN=""
"RTN","OOPSGUIF",30,0)
 F LP=SDATE:0 S LP=$O(^OOPS(2260,"AD",LP)) Q:(LP'>0)!(LP>EDATE)  D
"RTN","OOPSGUIF",31,0)
 . F  S IEN=$O(^OOPS(2260,"AD",LP,IEN)) Q:IEN'>0  D
"RTN","OOPSGUIF",32,0)
 .. I $$GET1^DIQ(2260,IEN,88,"I")'="Y" Q
"RTN","OOPSGUIF",33,0)
 .. I $$GET1^DIQ(2260,IEN,51,"I")>1 Q
"RTN","OOPSGUIF",34,0)
 .. S STATION=$P(^OOPS(2260,IEN,"2162A"),U,9)
"RTN","OOPSGUIF",35,0)
 .. I $G(STA)'="A",(STATION'=STA) Q
"RTN","OOPSGUIF",36,0)
 .. K OOPS,ARR S DIC="^OOPS(2260,"
"RTN","OOPSGUIF",37,0)
 .. S DR=".01;1;3;4;15;30;33;52;63;86;89"
"RTN","OOPSGUIF",38,0)
 .. S DA=IEN,DIQ="OOPS",DIQ(0)="IE" D EN^DIQ1
"RTN","OOPSGUIF",39,0)
 .. S CAX=OOPS(2260,IEN,52,"I")
"RTN","OOPSGUIF",40,0)
 .. S DOI=OOPS(2260,IEN,4,"I"),DOI=$P($$FMTE^XLFDT(DOI,2),"@")
"RTN","OOPSGUIF",41,0)
 .. ; PER A. BIERENBAUM, GET OCC DESC 5/13/02
"RTN","OOPSGUIF",42,0)
 .. S OCC=$$OCCDESC(IEN)
"RTN","OOPSGUIF",43,0)
 .. ; S OCC=OOPS(2260,IEN,63,"E")_$E(OOPS(2260,IEN,15,"E"),1,4)
"RTN","OOPSGUIF",44,0)
 .. S GONE=OOPS(2260,IEN,89,"I"),GONE=$S(GONE="Y":"X",1:"")
"RTN","OOPSGUIF",45,0)
 .. S LOST=OOPS(2260,IEN,33,"I")
"RTN","OOPSGUIF",46,0)
 .. S LOST=$S(LOST="Y":"X^",LOST="N":"^X",1:"^X")
"RTN","OOPSGUIF",47,0)
 .. S TYPE=OOPS(2260,IEN,3,"I")
"RTN","OOPSGUIF",48,0)
 .. I TYPE>10&(TYPE<15) S PERSON="Privacy Case"
"RTN","OOPSGUIF",49,0)
 .. S PERSON=OOPS(2260,IEN,1,"E") I CALL="Union"!(INCNA="N") S PERSON=""
"RTN","OOPSGUIF",50,0)
 .. S ARR=OOPS(2260,IEN,.01,"E")_U_DOI_U
"RTN","OOPSGUIF",51,0)
 .. S ARR=ARR_PERSON_U_OCC_U_$E(OOPS(2260,IEN,86,"E"),1,35)_U
"RTN","OOPSGUIF",52,0)
 .. S ARR=ARR_OOPS(2260,IEN,3,"E")_U_OOPS(2260,IEN,30,"E")_U
"RTN","OOPSGUIF",53,0)
 .. S FILL="" I CAX=2 S FILL="^^^"
"RTN","OOPSGUIF",54,0)
 .. S ARR=ARR_FILL_GONE_U_LOST
"RTN","OOPSGUIF",55,0)
 .. S ^TMP($J,"OSHA",CN)=ARR,CN=CN+1
"RTN","OOPSGUIF",56,0)
 S RESULTS=$NA(^TMP($J,"OSHA"))
"RTN","OOPSGUIF",57,0)
 Q
"RTN","OOPSGUIF",58,0)
NSTICK(RESULTS,INPUT,CALL) ; NeedleStick Log get data logic
"RTN","OOPSGUIF",59,0)
 ;   Input:  INPUT - contains 4 values, the START DATE, END DATE, 
"RTN","OOPSGUIF",60,0)
 ;                   STATION, and INCLUDE NAME ON REPORT.  The Date of
"RTN","OOPSGUIF",61,0)
 ;                   Occurrence (field #4) will be used to include/
"RTN","OOPSGUIF",62,0)
 ;                   exclude claims from the report.  If the Include
"RTN","OOPSGUIF",63,0)
 ;                   name is = Y then the names will be printed, if no
"RTN","OOPSGUIF",64,0)
 ;                   they will not, and if the Station = 'ALL' then any
"RTN","OOPSGUIF",65,0)
 ;                   claim will be include, if not 'All', but the
"RTN","OOPSGUIF",66,0)
 ;                   station number then only 1 station is included.
"RTN","OOPSGUIF",67,0)
 ;            CALL - Contains the calling menu.  This will be used
"RTN","OOPSGUIF",68,0)
 ;                   to exclude the name from printing if the caller
"RTN","OOPSGUIF",69,0)
 ;                   is 'U'nion.
"RTN","OOPSGUIF",70,0)
 ; Output: RESULTS - the results array passes the data back to the
"RTN","OOPSGUIF",71,0)
 ;                   client.
"RTN","OOPSGUIF",72,0)
 N CN,DA,IEN,INCNA,OCC,PERSON,SDATE,STDT,STA,ENDDT,EDATE,X,Y
"RTN","OOPSGUIF",73,0)
 N LOST,DOI,OOPS,TYPE
"RTN","OOPSGUIF",74,0)
 K ^TMP($J,"NS")
"RTN","OOPSGUIF",75,0)
 S CN=1,RESULTS(0)="Processing..."
"RTN","OOPSGUIF",76,0)
 S STDT=$P($G(INPUT),U),ENDDT=$P($G(INPUT),U,2)
"RTN","OOPSGUIF",77,0)
 S STA=$P($G(INPUT),U,3)
"RTN","OOPSGUIF",78,0)
 S INCNA=$P($G(INPUT),U,4)
"RTN","OOPSGUIF",79,0)
 I (STDT="")!(ENDDT="")!(STA="")!(INCNA="") D  Q
"RTN","OOPSGUIF",80,0)
 . S RESULTS(0)="Input parameters missing, cannot run report." Q
"RTN","OOPSGUIF",81,0)
 S (SDATE,EDATE)=""
"RTN","OOPSGUIF",82,0)
 S X=STDT D ^%DT S SDATE=Y
"RTN","OOPSGUIF",83,0)
 S X=ENDDT D ^%DT S EDATE=Y
"RTN","OOPSGUIF",84,0)
 ; SDATE made last time in day prior so start date correct
"RTN","OOPSGUIF",85,0)
 S SDATE=(SDATE-1)_".9999",EDATE=EDATE_".9999"
"RTN","OOPSGUIF",86,0)
 S LP="",IEN=""
"RTN","OOPSGUIF",87,0)
 F LP=SDATE:0 S LP=$O(^OOPS(2260,"AD",LP)) Q:(LP'>0)!(LP>EDATE)  D
"RTN","OOPSGUIF",88,0)
 . F  S IEN=$O(^OOPS(2260,"AD",LP,IEN)) Q:IEN'>0  D
"RTN","OOPSGUIF",89,0)
 .. ; exclude deleted, replaced by amendment cases
"RTN","OOPSGUIF",90,0)
 .. I $$GET1^DIQ(2260,IEN,51,"I")>1 Q
"RTN","OOPSGUIF",91,0)
 .. S STATION=$P(^OOPS(2260,IEN,"2162A"),U,9)
"RTN","OOPSGUIF",92,0)
 .. I $G(STA)'="A",(STATION'=STA) Q
"RTN","OOPSGUIF",93,0)
 .. ; if Type Incident not = Hollow Bore Needlestick, Sharps Exposure,
"RTN","OOPSGUIF",94,0)
 .. ; Exposure to Body Fluids/Splash, Suture Needlestick don't include
"RTN","OOPSGUIF",95,0)
 .. S TYPE=$$GET1^DIQ(2260,IEN,3,"I")
"RTN","OOPSGUIF",96,0)
 .. I TYPE<11!(TYPE>14) Q
"RTN","OOPSGUIF",97,0)
 .. ; now get the data and put in array.
"RTN","OOPSGUIF",98,0)
 .. K OOPS,ARR S DIC="^OOPS(2260,"
"RTN","OOPSGUIF",99,0)
 .. ; V2_P15 02/19/08 llh - added field 352 to use for lost time
"RTN","OOPSGUIF",100,0)
 .. S DR=".01;1;3;4;15;14;29;30;33;37;38;51;52;82;86;108;352"
"RTN","OOPSGUIF",101,0)
 .. S DA=IEN,DIQ="OOPS",DIQ(0)="IE" D EN^DIQ1
"RTN","OOPSGUIF",102,0)
 .. S DOI=OOPS(2260,IEN,4,"E")
"RTN","OOPSGUIF",103,0)
 .. ; PER A. BIERENBAUM, USE OCC DESC 5/13/02
"RTN","OOPSGUIF",104,0)
 .. S OCC=$$OCCDESC(IEN)
"RTN","OOPSGUIF",105,0)
 .. ; S OCC=$E(OOPS(2260,IEN,15,"E"),1,4)
"RTN","OOPSGUIF",106,0)
 .. ; patch 7 remove lost time
"RTN","OOPSGUIF",107,0)
 .. ; S LOST=OOPS(2260,IEN,33,"E")
"RTN","OOPSGUIF",108,0)
 .. ; V2_P15 02/19/08 llh - now indicating lost time
"RTN","OOPSGUIF",109,0)
 .. S LOST="No" I $G(OOPS(2260,IEN,352,"I"))="A" S LOST="Yes"
"RTN","OOPSGUIF",110,0)
 .. S INJILL=OOPS(2260,IEN,52,"I")
"RTN","OOPSGUIF",111,0)
 .. S INJILL=$S(INJILL=1:"Injury",INJILL=2:"Illness",1:"")
"RTN","OOPSGUIF",112,0)
 .. ; patch 7 - only print privacy case in name field - all cases
"RTN","OOPSGUIF",113,0)
 .. S PERSON="Privacy Case"
"RTN","OOPSGUIF",114,0)
 .. ; S PERSON=OOPS(2260,IEN,1,"E")
"RTN","OOPSGUIF",115,0)
 .. I CALL="Union"!(INCNA="N") S PERSON=""
"RTN","OOPSGUIF",116,0)
 .. S ARR=IEN_U_OOPS(2260,IEN,.01,"E")_U_DOI_U_PERSON_U_INJILL_U
"RTN","OOPSGUIF",117,0)
 .. S ARR=ARR_OOPS(2260,IEN,51,"E")_U_OCC_U_$E(OOPS(2260,DA,14,"E"),1,4)
"RTN","OOPSGUIF",118,0)
 .. S ARR=ARR_U_OOPS(2260,IEN,86,"E")_U
"RTN","OOPSGUIF",119,0)
 .. S ARR=ARR_OOPS(2260,IEN,3,"E")_U_OOPS(2260,IEN,108,"E")
"RTN","OOPSGUIF",120,0)
 .. S ARR=ARR_U_OOPS(2260,IEN,30,"E")_U_$E(OOPS(2260,IEN,29,"E"),1,45)_U
"RTN","OOPSGUIF",121,0)
 .. S ARR=ARR_$E(OOPS(2260,IEN,37,"E"),1,50)_U
"RTN","OOPSGUIF",122,0)
 .. S ARR=ARR_$E(OOPS(2260,IEN,38,"E"),1,50)_U_OOPS(2260,IEN,82,"E")
"RTN","OOPSGUIF",123,0)
 .. ;V2_P15 02/19/08 llh - added lost
"RTN","OOPSGUIF",124,0)
 .. S ARR=ARR_U_LOST
"RTN","OOPSGUIF",125,0)
 .. S ^TMP($J,"NS",CN)=ARR K ARR
"RTN","OOPSGUIF",126,0)
 .. S CN=CN+1
"RTN","OOPSGUIF",127,0)
 S RESULTS=$NA(^TMP($J,"NS"))
"RTN","OOPSGUIF",128,0)
 Q
"RTN","OOPSGUIF",129,0)
OCCDESC(IEN) ;Get Occupation Description
"RTN","OOPSGUIF",130,0)
 ;
"RTN","OOPSGUIF",131,0)
 ;  Input:  IEN - IEN of the ASISTS Case number to get the Occ Desc
"RTN","OOPSGUIF",132,0)
 ; Output:      - will be the Occupation description
"RTN","OOPSGUIF",133,0)
 ;
"RTN","OOPSGUIF",134,0)
 N INC,FLD
"RTN","OOPSGUIF",135,0)
 S INC=$$GET1^DIQ(2260,IEN,52,"I")
"RTN","OOPSGUIF",136,0)
 S FLD=$S(INC=1:111,INC=2:208,1:"")
"RTN","OOPSGUIF",137,0)
 I 'FLD Q ""
"RTN","OOPSGUIF",138,0)
 Q $$GET1^DIQ(2260,IEN,FLD)
"RTN","OOPSGUIF",139,0)
DSPUTE ; Reason for Dispute Report - called from DSPUTE^OOPSGUIR
"RTN","OOPSGUIF",140,0)
 ; code in DSPUTE^OOPSGUIF requires case to be a CA1
"RTN","OOPSGUIF",141,0)
 N BLK36,DIS,DSPCD,F174
"RTN","OOPSGUIF",142,0)
 S F174=$$GET1^DIQ(2260,IEN,174,"I")      ; determines lost time or not
"RTN","OOPSGUIF",143,0)
 S F174=$S(F174=3:"LT",1:"NLT")
"RTN","OOPSGUIF",144,0)
 S DIS=$$GET1^DIQ(2260,IEN,165.2,"I"),DSPCD=$$GET1^DIQ(2260,IEN,347)
"RTN","OOPSGUIF",145,0)
 I $G(DIS)="" S DIS="N"
"RTN","OOPSGUIF",146,0)
 I DIS="N" S DSPCD="zCase not disputed, no dispute code expected"
"RTN","OOPSGUIF",147,0)
 I (DIS="Y"),DSPCD="" S DSPCD="zCase disputed, no dispute code entered"
"RTN","OOPSGUIF",148,0)
 ;if data in State the reason in detail question and case controverted
"RTN","OOPSGUIF",149,0)
 ;don't count, otherwise report number of entries in free text field
"RTN","OOPSGUIF",150,0)
 S BLK36=""
"RTN","OOPSGUIF",151,0)
 I DIS="Y",($P($G(^OOPS(2260,IEN,"CA1K",0)),U,3)) D
"RTN","OOPSGUIF",152,0)
 .I $$GET1^DIQ(2260,IEN,165.1,"I")="Y" Q
"RTN","OOPSGUIF",153,0)
 .S BLK36="zBlk 36 also has text entered"
"RTN","OOPSGUIF",154,0)
 S:'$D(ARR(DSPCD,F174)) ARR(DSPCD,F174)=0
"RTN","OOPSGUIF",155,0)
 S ARR(DSPCD,F174)=ARR(DSPCD,F174)+1
"RTN","OOPSGUIF",156,0)
 I BLK36'="" D
"RTN","OOPSGUIF",157,0)
 .S:'$D(ARR(BLK36,F174)) ARR(BLK36,F174)=0
"RTN","OOPSGUIF",158,0)
 .S ARR(BLK36,F174)=ARR(BLK36,F174)+1
"RTN","OOPSGUIF",159,0)
 Q
"RTN","OOPSGUIT")
0^10^B80073431^B78632335
"RTN","OOPSGUIT",1,0)
OOPSGUIT ;WIOFO/LLH-RPC Rtn for Type of Incident rpt ;11/5/01 
"RTN","OOPSGUIT",2,0)
 ;;2.0;ASISTS;**4,7,11,15**;Jun 03, 2002;Build 9
"RTN","OOPSGUIT",3,0)
 ;
"RTN","OOPSGUIT",4,0)
ENT(RESULTS,TRPT,CSTAT,STDT,ENDDT,LTNTT,STAT,PSTAT) ;
"RTN","OOPSGUIT",5,0)
 N DATA,CNT,CS,CS1,EDATE,OOPS,LOST,LP,SDATE,TOT,RPTTY
"RTN","OOPSGUIT",6,0)
 N STATION,LOSTTIME,NODE,OOPDA,PER,X,Y
"RTN","OOPSGUIT",7,0)
 S RPTTY=$$REPORT(),CS=$S(CSTAT="O":0,CSTAT="C":1,1:"")
"RTN","OOPSGUIT",8,0)
 S LOST=$S(LTNTT="L":"Y",1:""),(SDATE,EDATE)=""
"RTN","OOPSGUIT",9,0)
 S X=STDT D ^%DT S SDATE=Y,X=ENDDT D ^%DT S EDATE=Y
"RTN","OOPSGUIT",10,0)
 S SDATE=(SDATE-1)_".9999",EDATE=EDATE_".9999",LP="",OOPDA=""
"RTN","OOPSGUIT",11,0)
 F LP=SDATE:0 S LP=$O(^OOPS(2260,"AD",LP)) Q:(LP'>0)!(LP>EDATE)  D
"RTN","OOPSGUIT",12,0)
 .F  S OOPDA=$O(^OOPS(2260,"AD",LP,OOPDA)) Q:OOPDA'>0  D
"RTN","OOPSGUIT",13,0)
 ..S OOPS(0)=$G(^OOPS(2260,OOPDA,0))
"RTN","OOPSGUIT",14,0)
 ..S CS1=$P(OOPS(0),U,6)
"RTN","OOPSGUIT",15,0)
 ..I $G(CS1)>1 Q               ; only open & closed cases
"RTN","OOPSGUIT",16,0)
 ..I (CS'=""),(CS'=CS1) Q      ; if 'All cases, case status must match
"RTN","OOPSGUIT",17,0)
 ..S PER=$$GET1^DIQ(2260,OOPDA,2,"I")
"RTN","OOPSGUIT",18,0)
 ..I (+PSTAT)&(PSTAT'[(PER_"^")) Q
"RTN","OOPSGUIT",19,0)
 ..S STATION=$$GET1^DIQ(2260,OOPDA,13,"I")
"RTN","OOPSGUIT",20,0)
 ..I STAT'="A",(STATION'=STAT) Q
"RTN","OOPSGUIT",21,0)
 ..S LOSTTIME=""
"RTN","OOPSGUIT",22,0)
 ..I $O(^OOPS(2260,OOPDA,"OUTC","AC","A","A","")) S LOSTTIME="Y"
"RTN","OOPSGUIT",23,0)
 ..I LOST="Y",(LOSTTIME'="Y") Q
"RTN","OOPSGUIT",24,0)
 ..I RPTTY=3 D
"RTN","OOPSGUIT",25,0)
 ...N INC S INC=$$GET1^DIQ(2260,OOPDA,RPTTY_":.01")
"RTN","OOPSGUIT",26,0)
 ...I $G(INC)="" S INC="Unknown"
"RTN","OOPSGUIT",27,0)
 ...S:$D(DATA(INC))=0 DATA(INC)=0 S DATA(INC)=DATA(INC)+1
"RTN","OOPSGUIT",28,0)
 ..I RPTTY=15 D
"RTN","OOPSGUIT",29,0)
 ...N DIC,DR,DA,DIQ,FLD,NAME,OCC,IEN450,X,Y
"RTN","OOPSGUIT",30,0)
 ...S NAME=$$GET1^DIQ(2260,OOPDA,1),FLD=16
"RTN","OOPSGUIT",31,0)
 ...S DIC="^PRSPC(",DIC(0)="Z",X=NAME D ^DIC
"RTN","OOPSGUIT",32,0)
 ...I Y>0 D
"RTN","OOPSGUIT",33,0)
 ....K DIQ S DR=FLD,DA=+Y,IEN450=+Y,DIQ="OOPS",DIQ(0)="IE"
"RTN","OOPSGUIT",34,0)
 ....D EN^DIQ1 K DIQ
"RTN","OOPSGUIT",35,0)
 ...S OCC=$$GET1^DIQ(2260,OOPDA,15,"I")
"RTN","OOPSGUIT",36,0)
 ...I $G(IEN450),$G(OCC)'="",(OCC=$E($G(OOPS(450,IEN450,FLD,"I")),1,4)) D
"RTN","OOPSGUIT",37,0)
 ....S OCC=OCC_" - "_OOPS(450,IEN450,FLD,"E")
"RTN","OOPSGUIT",38,0)
 ...I $G(OCC)="" S OCC="Unknown"
"RTN","OOPSGUIT",39,0)
 ...S:$D(DATA(OCC))=0 DATA(OCC)=0 S DATA(OCC)=DATA(OCC)+1
"RTN","OOPSGUIT",40,0)
 ..I RPTTY=29 D
"RTN","OOPSGUIT",41,0)
 ...N CHAR S CHAR=$$GET1^DIQ(2260,OOPDA,RPTTY_":.01")
"RTN","OOPSGUIT",42,0)
 ...I $G(CHAR)="" S CHAR="Unknown"
"RTN","OOPSGUIT",43,0)
 ...S:$D(DATA(CHAR))=0 DATA(CHAR)=0 S DATA(CHAR)=DATA(CHAR)+1
"RTN","OOPSGUIT",44,0)
 ..I RPTTY=86 D
"RTN","OOPSGUIT",45,0)
 ...N SERV S SERV=$$GET1^DIQ(2260,OOPDA,RPTTY_":.01")
"RTN","OOPSGUIT",46,0)
 ...I $G(SERV)="" S SERV="Unknown"
"RTN","OOPSGUIT",47,0)
 ...S:$D(DATA(SERV))=0 DATA(SERV)=0 S DATA(SERV)=DATA(SERV)+1
"RTN","OOPSGUIT",48,0)
 ..I RPTTY=30 D
"RTN","OOPSGUIT",49,0)
 ...N BODY S BODY=$$GET1^DIQ(2260,OOPDA,RPTTY_":1")
"RTN","OOPSGUIT",50,0)
 ...F I=1:1 Q:$P($T(BODY+I),";",3)="Q"  I $P($T(BODY+I),";",4)[(U_BODY_U) S BODY=$P($T(BODY+I),";",3) Q
"RTN","OOPSGUIT",51,0)
 ...I $G(BODY)="" S BODY="Unknown"
"RTN","OOPSGUIT",52,0)
 ...S:$D(DATA(BODY))=0 DATA(BODY)=0 S DATA(BODY)=DATA(BODY)+1
"RTN","OOPSGUIT",53,0)
 ..I RPTTY=999 D
"RTN","OOPSGUIT",54,0)
 ...N DOI,DOW
"RTN","OOPSGUIT",55,0)
 ...S DOI=$$GET1^DIQ(2260,OOPDA,4,"I"),DOW=$$DOW^XLFDT(DOI)
"RTN","OOPSGUIT",56,0)
 ...S DOW=$S(DOW="Friday":"6Friday",DOW="Monday":"2Monday",DOW="Saturday":"7Saturday",DOW="Sunday":"1Sunday",DOW="Thursday":"5Thursday",DOW="Tuesday":"3Tuesday",DOW="Wednesday":"4Wednesday",1:"Unk")
"RTN","OOPSGUIT",57,0)
 ...I $G(DOI)="" S DOI="Unknown"
"RTN","OOPSGUIT",58,0)
 ...S:$D(DATA(DOW))=0 DATA(DOW)=0 S DATA(DOW)=DATA(DOW)+1
"RTN","OOPSGUIT",59,0)
 ..I RPTTY=9999 D
"RTN","OOPSGUIT",60,0)
 ...N LABEL,TDOI,TIME S TDOI=$P($$GET1^DIQ(2260,OOPDA,4),"@",2)
"RTN","OOPSGUIT",61,0)
 ...I $G(TDOI)="" S TDOI="Unknown"
"RTN","OOPSGUIT",62,0)
 ...I TDOI'="Unknown" D
"RTN","OOPSGUIT",63,0)
 ....I +$P(TDOI,":")&($P(TDOI,":")'=24) S TIME=$P(TDOI,":")
"RTN","OOPSGUIT",64,0)
 ....E  S TIME=24
"RTN","OOPSGUIT",65,0)
 ....S LABEL=TIME_":"_"00 - "_TIME_":59"
"RTN","OOPSGUIT",66,0)
 ...I TDOI="Unknown" S LABEL="Unknown"
"RTN","OOPSGUIT",67,0)
 ...S:$D(DATA(LABEL))=0 DATA(LABEL)=0 S DATA(LABEL)=DATA(LABEL)+1
"RTN","OOPSGUIT",68,0)
 S TOT=1,NODE="",CNT=0
"RTN","OOPSGUIT",69,0)
 F  S NODE=$O(DATA(NODE)) Q:NODE=""  S RESULTS(TOT)=NODE_"^"_DATA(NODE),CNT=CNT+$P(RESULTS(TOT),U,2),TOT=TOT+1
"RTN","OOPSGUIT",70,0)
 I CNT S RESULTS(0)=CNT
"RTN","OOPSGUIT",71,0)
 Q
"RTN","OOPSGUIT",72,0)
REPORT() ; Get Fld # to sort on
"RTN","OOPSGUIT",73,0)
 I TRPT="Type of Incidents" S RPTTY=3
"RTN","OOPSGUIT",74,0)
 I TRPT="Occupation Code" S RPTTY=15
"RTN","OOPSGUIT",75,0)
 I TRPT="Characterization of Injury" S RPTTY=29
"RTN","OOPSGUIT",76,0)
 I TRPT="Service" S RPTTY=86
"RTN","OOPSGUIT",77,0)
 I TRPT="Body Parts" S RPTTY=30
"RTN","OOPSGUIT",78,0)
 I TRPT="Day of Week" S RPTTY=999
"RTN","OOPSGUIT",79,0)
 I TRPT="Time of Day" S RPTTY=9999
"RTN","OOPSGUIT",80,0)
 Q RPTTY
"RTN","OOPSGUIT",81,0)
BODY ; group the body parts to min # of columns
"RTN","OOPSGUIT",82,0)
 ;;Abdomen;^BA^V5^VI^V4^V3^VL^VM^VS^
"RTN","OOPSGUIT",83,0)
 ;;Arm(s) Lower;^AS^AB^A4^A6^A3^A5^
"RTN","OOPSGUIT",84,0)
 ;;Arm(s) Upper;^AX^AZ^A2^A1^
"RTN","OOPSGUIT",85,0)
 ;;Back (Lumbar Region);^BL^
"RTN","OOPSGUIT",86,0)
 ;;Back (Upper);^BU^
"RTN","OOPSGUIT",87,0)
 ;;Chest;^BC^RS^
"RTN","OOPSGUIT",88,0)
 ;;Ear(s);^H4^C2^H3^C1^
"RTN","OOPSGUIT",89,0)
 ;;Elbow;^EB^ES^
"RTN","OOPSGUIT",90,0)
 ;;Eye(s);^H2^C4^H1^C3^
"RTN","OOPSGUIT",91,0)
 ;;Face;^CK^HC^HF^CJ^HM^CM^HN^CN^CD^CT^
"RTN","OOPSGUIT",92,0)
 ;;Foot,Includes Toes;^PB^G2^G3^G4^PS^G1^
"RTN","OOPSGUIT",93,0)
 ;;Hand(s),Includes fingers;^F2^F8^MB^F4^F6^TB^FB^FS^F1^F7^MS^F3^F5^TS^
"RTN","OOPSGUIT",94,0)
 ;;Knees;^KB^KS^
"RTN","OOPSGUIT",95,0)
 ;;Leg(s), lower;^L4^L3^
"RTN","OOPSGUIT",96,0)
 ;;Leg(s), upper;^LX^LZ^
"RTN","OOPSGUIT",97,0)
 ;;Neck;^HK^CL^CR^
"RTN","OOPSGUIT",98,0)
 ;;Not Elsewhere Classified;^XZ^L2^LB^BZ^XX^VN^RP^LS^L1^
"RTN","OOPSGUIT",99,0)
 ;;Reproductive Organs;^B2^B4^BP^VR^B1^B3^B5^
"RTN","OOPSGUIT",100,0)
 ;;Ribs;^RB^RC^
"RTN","OOPSGUIT",101,0)
 ;;Shoulder;^R2^R4^SB^R1^R3^SS^
"RTN","OOPSGUIT",102,0)
 ;;Skull/Head;^CB^HX^HZ^CX^CZ^HS^CC^CS^
"RTN","OOPSGUIT",103,0)
 ;;Spinal Cord;^VC^RV^
"RTN","OOPSGUIT",104,0)
 ;;Thorax;^VH^V2^V1^
"RTN","OOPSGUIT",105,0)
 ;;Trunk;^BS^RZ^BX^VX^VZ^RX^BW^
"RTN","OOPSGUIT",106,0)
 ;;Q
"RTN","OOPSGUIT",107,0)
 Q
"RTN","OOPSGUIT",108,0)
ACCID(RESULTS,INPUT,CALL) ; Print Accident Report Status report - get data
"RTN","OOPSGUIT",109,0)
 ;  Input: INPUT - START,END DATE, & STATION. Format is STARTDATE^ 
"RTN","OOPSGUIT",110,0)
 ;           ENDDATE^STA^CASESTATUS.  STA is A or IEN of station,
"RTN","OOPSGUIT",111,0)
 ;           case status = open 'O', closed 'C', or both 'A'.
"RTN","OOPSGUIT",112,0)
 ;         CALL - calling menu. Excludes name if called from Union menu
"RTN","OOPSGUIT",113,0)
 ; Output:  - RESULTS contains the data to be displayed in the report
"RTN","OOPSGUIT",114,0)
 N ARR,CN,IEN,SDATE,SIGN,SIGSTR,STDT,STA,ENDDT,EDATE,X,Y,SUPSTR,EMPSTR
"RTN","OOPSGUIT",115,0)
 N CASE,CAT,DOI,EMP,INC,ISEMP,PERSON,SAF,SSN,SSN1,SP,SUP,WCP,PCE
"RTN","OOPSGUIT",116,0)
 ; patch 4 llh - select by case status ; patch 11, get super's name
"RTN","OOPSGUIT",117,0)
 N CS,STATUS,SUPER,S48,S6,S20,S12
"RTN","OOPSGUIT",118,0)
 S S48="                                                "
"RTN","OOPSGUIT",119,0)
 S S6="      ",S12="            ",S20="                    "
"RTN","OOPSGUIT",120,0)
 K ^TMP($J,"ACCID")
"RTN","OOPSGUIT",121,0)
 S CN=1,RESULTS(0)="Processing..."
"RTN","OOPSGUIT",122,0)
 S STDT=$P($G(INPUT),U),ENDDT=$P($G(INPUT),U,2)
"RTN","OOPSGUIT",123,0)
 S STA=$P($G(INPUT),U,3),STATUS=$P($G(INPUT),U,4)
"RTN","OOPSGUIT",124,0)
 I (STDT="")!(ENDDT="")!(STA="")!(STATUS="") D  Q
"RTN","OOPSGUIT",125,0)
 .S RESULTS(0)="Input parameters missing, cannot run report." Q
"RTN","OOPSGUIT",126,0)
 S STATUS=$S(STATUS="O":0,STATUS="C":1,1:"")
"RTN","OOPSGUIT",127,0)
 S (SDATE,EDATE)=""
"RTN","OOPSGUIT",128,0)
 S X=STDT D ^%DT S SDATE=Y
"RTN","OOPSGUIT",129,0)
 S X=ENDDT D ^%DT S EDATE=Y
"RTN","OOPSGUIT",130,0)
 S SDATE=(SDATE-1)_".9999",EDATE=EDATE_".9999"
"RTN","OOPSGUIT",131,0)
 S SSN="" I CALL="Employee" S SSN=$$GET1^DIQ(200,DUZ,9)
"RTN","OOPSGUIT",132,0)
 S LP="",IEN=""
"RTN","OOPSGUIT",133,0)
 F LP=SDATE:0 S LP=$O(^OOPS(2260,"AD",LP)) Q:(LP'>0)!(LP>EDATE)  D
"RTN","OOPSGUIT",134,0)
 .F  S IEN=$O(^OOPS(2260,"AD",LP,IEN)) Q:IEN'>0  D
"RTN","OOPSGUIT",135,0)
 ..S CS=$$GET1^DIQ(2260,IEN,51,"I")
"RTN","OOPSGUIT",136,0)
 ..I $G(CS)>1 Q               ; exclude deleted, amended cases
"RTN","OOPSGUIT",137,0)
 ..I (STATUS'=""),(CS'=STATUS) Q  ; if 'All cases, status must match
"RTN","OOPSGUIT",138,0)
 ..S STATION=$P(^OOPS(2260,IEN,"2162A"),U,9)
"RTN","OOPSGUIT",139,0)
 ..I $G(STA)'="A",STATION'=STA Q
"RTN","OOPSGUIT",140,0)
 ..I (CALL="Supervisor"),($$GET1^DIQ(2260,IEN,53,"I")'=DUZ&($$GET1^DIQ(2260,IEN,53.1,"I")'=DUZ)) Q
"RTN","OOPSGUIT",141,0)
 ..S (ARR,CASE,PERSON,SSN1,DOI,INC,CAT,WCP,EMP,SUP,SUPER,SAF,SP)=""
"RTN","OOPSGUIT",142,0)
 ..S CASE=$$GET1^DIQ(2260,IEN,.01),SUPER=$$GET1^DIQ(2260,IEN,53)
"RTN","OOPSGUIT",143,0)
 ..S (PERSON,SSN1)=""
"RTN","OOPSGUIT",144,0)
 ..;V2_P15 - changed the SSN display for privacy act concerns
"RTN","OOPSGUIT",145,0)
 ..I CALL'="Union" S PERSON=$E($$GET1^DIQ(2260,IEN,1),1,30),SSN1="xxx-xx-"_$E($$GET1^DIQ(2260,IEN,5),8,12)
"RTN","OOPSGUIT",146,0)
 ..S INC=$$GET1^DIQ(2260,IEN,52,"I"),DOI=$$GET1^DIQ(2260,IEN,4)
"RTN","OOPSGUIT",147,0)
 ..S CAT=$$GET1^DIQ(2260,IEN,2,"I")
"RTN","OOPSGUIT",148,0)
 ..; patch 4 llh - get case status title
"RTN","OOPSGUIT",149,0)
 ..S CS=$S(CS=0:"Open",CS=1:"Closed",1:"") I SSN1="" S SSN1="           "
"RTN","OOPSGUIT",150,0)
 ..S ARR=" ",^TMP($J,"ACCID",CN)=ARR,CN=CN+1,ARR=""
"RTN","OOPSGUIT",151,0)
 ..S ARR="Case Number   Name                                 SSN              Case Status    Date/Time of Incident"
"RTN","OOPSGUIT",152,0)
 ..S ^TMP($J,"ACCID",CN)=ARR,CN=CN+1,ARR=""
"RTN","OOPSGUIT",153,0)
 ..S PERSON=PERSON_"                            ",PERSON=$E(PERSON,1,37)
"RTN","OOPSGUIT",154,0)
 ..I $L(CASE)=10 S CASE=CASE_" "
"RTN","OOPSGUIT",155,0)
 ..;patch 4 llh - pad case status title if needed for alignment
"RTN","OOPSGUIT",156,0)
 ..I $L(CS)=4 S CS=CS_"  "
"RTN","OOPSGUIT",157,0)
 ..S ARR=CASE_"   "_PERSON_SSN1_"      "_CS_"         "_DOI
"RTN","OOPSGUIT",158,0)
 ..S ^TMP($J,"ACCID",CN)=ARR,CN=CN+1,ARR=""
"RTN","OOPSGUIT",159,0)
 ..I CALL="Employee" Q:SSN'=SSN1
"RTN","OOPSGUIT",160,0)
 ..S ISEMP=$$ISEMP^OOPSUTL4(IEN)
"RTN","OOPSGUIT",161,0)
 ..I 'ISEMP S ISEMP="N/A("_$E($$GET1^DIQ(2260,IEN,2,"E"),1,10)_")"
"RTN","OOPSGUIT",162,0)
 ..S SIGN="",SIGSTR="^^^^^^"
"RTN","OOPSGUIT",163,0)
 ..S SIGN=$P($$EDSTA^OOPSUTL1(IEN,"E"),U,INC)
"RTN","OOPSGUIT",164,0)
 ..S $P(SIGSTR,U,INC)=$S('SIGN:"Un-Signed",SIGN:"Signed",1:"")
"RTN","OOPSGUIT",165,0)
 ..I 'ISEMP S $P(SIGSTR,U,INC)=ISEMP
"RTN","OOPSGUIT",166,0)
 ..S (SIGN,PCE,SUPSTR)=""
"RTN","OOPSGUIT",167,0)
 ..S SIGN=$$EDSTA^OOPSUTL1(IEN,"S"),PCE=INC+2
"RTN","OOPSGUIT",168,0)
 ..I ISEMP S $P(SIGSTR,U,PCE)=$S('$P(SIGN,U,INC):"Un-Signed",$P(SIGN,U,INC):"Signed",1:"")
"RTN","OOPSGUIT",169,0)
 ..S $P(SIGSTR,U,5)=$S($P(SIGN,U,3):"Signed",1:"Un-Signed")
"RTN","OOPSGUIT",170,0)
 ..S SIGN="",SIGN=$$EDSTA^OOPSUTL1(IEN,"O")
"RTN","OOPSGUIT",171,0)
 ..S $P(SIGSTR,U,6)=$S($P(SIGN,U):"Signed",1:"Un-Signed")
"RTN","OOPSGUIT",172,0)
 ..S SIGN="",SIGN=$$GET1^DIQ(2260,IEN,68)
"RTN","OOPSGUIT",173,0)
 ..S $P(SIGSTR,U,7)=$S((($P(SIGN,U)="")&ISEMP):"Un-Signed",($P(SIGN,U)'=""):"Signed",1:"")
"RTN","OOPSGUIT",174,0)
 ..F I=1:1:7 I $P(SIGSTR,U,I)="Signed" D
"RTN","OOPSGUIT",175,0)
 ...I I=1 S $P(SIGSTR,U,1)=$$FMTE^XLFDT(($$GET1^DIQ(2260,IEN,121,"I")),"2DZ")
"RTN","OOPSGUIT",176,0)
 ...I I=2 S $P(SIGSTR,U,2)=$$FMTE^XLFDT(($$GET1^DIQ(2260,IEN,223,"I")),"2DZ")
"RTN","OOPSGUIT",177,0)
 ...I I=3 S $P(SIGSTR,U,3)=$$FMTE^XLFDT(($$GET1^DIQ(2260,IEN,171,"I")),"2DZ")_" "
"RTN","OOPSGUIT",178,0)
 ...I I=4 S $P(SIGSTR,U,4)=$$FMTE^XLFDT(($$GET1^DIQ(2260,IEN,267,"I")),"2DZ")_" "
"RTN","OOPSGUIT",179,0)
 ...I I=5 S $P(SIGSTR,U,5)=$$FMTE^XLFDT(($$GET1^DIQ(2260,IEN,46,"I")),"2DZ")
"RTN","OOPSGUIT",180,0)
 ...I I=6 S $P(SIGSTR,U,6)=$$FMTE^XLFDT(($$GET1^DIQ(2260,IEN,50,"I")),"2DZ")
"RTN","OOPSGUIT",181,0)
 ...I I=7 S $P(SIGSTR,U,7)=$$FMTE^XLFDT(($$GET1^DIQ(2260,IEN,69,"I")),"2DZ")
"RTN","OOPSGUIT",182,0)
 ..S ARR=S48_"          "_"CA1"_S12_"CA2"_S12_"2162"_S12_"WCP"
"RTN","OOPSGUIT",183,0)
 ..S ^TMP($J,"ACCID",CN)=ARR,CN=CN+1,ARR=""
"RTN","OOPSGUIT",184,0)
 ..S ARR=S48_"          "_"---"_S12_"---"_S12_"----"_S12_"---"
"RTN","OOPSGUIT",185,0)
 ..S ^TMP($J,"ACCID",CN)=ARR,CN=CN+1,ARR=""
"RTN","OOPSGUIT",186,0)
 ..S EMPSTR=S20_S20_"     Employee:    "
"RTN","OOPSGUIT",187,0)
 ..I INC=1 S ARR=EMPSTR_$P(SIGSTR,U,1)
"RTN","OOPSGUIT",188,0)
 ..I INC=2 S ARR=EMPSTR_S12_"   "_$P(SIGSTR,U,2)
"RTN","OOPSGUIT",189,0)
 ..S ^TMP($J,"ACCID",CN)=ARR,CN=CN+1,ARR=""
"RTN","OOPSGUIT",190,0)
 ..; patch 11 - add supervisors name
"RTN","OOPSGUIT",191,0)
 ..I $G(SUPER)'="" S SUPSTR=SUPER_", Supervisor:    " F I=1:1:58 Q:$L(SUPSTR)>57  S SUPSTR=" "_SUPSTR
"RTN","OOPSGUIT",192,0)
 ..E  S SUPSTR=S20_S20_"   Supervisor:    "
"RTN","OOPSGUIT",193,0)
 ..I 'ISEMP S SUPSTR=SUPSTR_"         "
"RTN","OOPSGUIT",194,0)
 ..I INC=1 D
"RTN","OOPSGUIT",195,0)
 ...I $P(SIGSTR,U,3)="Signed" S ARR=SUPSTR_$P(SIGSTR,U,3)_S6_S12_$P(SIGSTR,U,5)
"RTN","OOPSGUIT",196,0)
 ...E  S ARR=SUPSTR_$P(SIGSTR,U,3)_S20_" "_$P(SIGSTR,U,5)
"RTN","OOPSGUIT",197,0)
 ..I INC=2 D
"RTN","OOPSGUIT",198,0)
 ...I $P(SIGSTR,U,4)="Signed" S ARR=SUPSTR_S12_"   "_$P(SIGSTR,U,4)_"   "_$P(SIGSTR,U,5)
"RTN","OOPSGUIT",199,0)
 ...E  S ARR=SUPSTR_S12_"   "_$P(SIGSTR,U,4)_S6_$P(SIGSTR,U,5)
"RTN","OOPSGUIT",200,0)
 ..S ^TMP($J,"ACCID",CN)=ARR,CN=CN+1,ARR=""
"RTN","OOPSGUIT",201,0)
 ..S ARR=S20_S12_"       Safety Officer:"_S20_S12_"  "_$P(SIGSTR,U,6)
"RTN","OOPSGUIT",202,0)
 ..S ^TMP($J,"ACCID",CN)=ARR,CN=CN+1,ARR=""
"RTN","OOPSGUIT",203,0)
 ..S ARR=S20_S12_"        Workers' Comp:"_S48_"  "_$P(SIGSTR,U,7)
"RTN","OOPSGUIT",204,0)
 ..S ^TMP($J,"ACCID",CN)=ARR,CN=CN+1,ARR=""
"RTN","OOPSGUIT",205,0)
 S RESULTS=$NA(^TMP($J,"ACCID"))
"RTN","OOPSGUIT",206,0)
 Q
"RTN","OOPSMBUL")
0^8^B24446634^B21801077
"RTN","OOPSMBUL",1,0)
OOPSMBUL ;HIRMFO/REL-Bulletin ;3/30/98
"RTN","OOPSMBUL",2,0)
 ;;2.0;ASISTS;**2,4,15**;Jun 03, 2002;Build 9
"RTN","OOPSMBUL",3,0)
 Q
"RTN","OOPSMBUL",4,0)
MFAC ;
"RTN","OOPSMBUL",5,0)
 N NIEN,NGRP,TEST
"RTN","OOPSMBUL",6,0)
 S NIEN=$$GET1^DIQ(2260,IEN,13,"I")
"RTN","OOPSMBUL",7,0)
 S NGRP=GRP_" - "_$$GET1^DIQ(4,NIEN,99,"E")
"RTN","OOPSMBUL",8,0)
 S TEST=$$FIND1^DIC(3.8,"","AMX",NGRP)
"RTN","OOPSMBUL",9,0)
 I TEST S GRP=NGRP
"RTN","OOPSMBUL",10,0)
 D GRP
"RTN","OOPSMBUL",11,0)
 Q
"RTN","OOPSMBUL",12,0)
CASE(IEN) ;
"RTN","OOPSMBUL",13,0)
 N CN,SUP,SUP2,Y,GRP
"RTN","OOPSMBUL",14,0)
 S XMB="OOPS CASE",X0=$G(^OOPS(2260,IEN,0)) K XMY
"RTN","OOPSMBUL",15,0)
 S CN=$P(X0,U,1),SUP=$P(X0,U,8),XMY(SUP)=""
"RTN","OOPSMBUL",16,0)
 S SUP2=$P(X0,U,9) I SUP2>0 S XMY(SUP2)=""
"RTN","OOPSMBUL",17,0)
 S XMB(3)=CN
"RTN","OOPSMBUL",18,0)
 ; V2 - 05/09/02 LLH - add whether inj or illness
"RTN","OOPSMBUL",19,0)
 S XMB(6)=$$GET1^DIQ(2260,IEN,52)
"RTN","OOPSMBUL",20,0)
 ; Patch 8 - added display of supervisors name to bulletin
"RTN","OOPSMBUL",21,0)
 S XMB(4)=$$GET1^DIQ(200,SUP,.01,"E")
"RTN","OOPSMBUL",22,0)
 I SUP2>0 S XMB(5)=$$GET1^DIQ(200,SUP2,.01,"E")
"RTN","OOPSMBUL",23,0)
 S Y=$P(X0,U,5) D DD^%DT S XMB(2)=Y
"RTN","OOPSMBUL",24,0)
 S Y=$P(X0,U,3)
"RTN","OOPSMBUL",25,0)
 S GRP="OOPS INJURY"
"RTN","OOPSMBUL",26,0)
 D MFAC
"RTN","OOPSMBUL",27,0)
 S GRP="OOPS UNION"
"RTN","OOPSMBUL",28,0)
 D MFAC
"RTN","OOPSMBUL",29,0)
 I $P(X0,U,4)>10 S GRP="OOPS EH" D MFAC
"RTN","OOPSMBUL",30,0)
 ; next 2 lines restrict access to delivered message - 060303 LLH
"RTN","OOPSMBUL",31,0)
 S XMBODY="",XMINSTR("FLAGS")="IX"
"RTN","OOPSMBUL",32,0)
 D TASKBULL^XMXAPI(DUZ,"OOPS CASE",.XMB,XMBODY,.XMY,.XMINSTR)
"RTN","OOPSMBUL",33,0)
 Q
"RTN","OOPSMBUL",34,0)
SAFETY(IEN) ; Safety Officer Bulletin
"RTN","OOPSMBUL",35,0)
 N GRP
"RTN","OOPSMBUL",36,0)
 S XMB="OOPS SAFETY",X0=$G(^OOPS(2260,IEN,0)) K XMY
"RTN","OOPSMBUL",37,0)
 S XMB(1)=$P(X0,U,2)
"RTN","OOPSMBUL",38,0)
 S XMB(3)=$P(X0,U,1)
"RTN","OOPSMBUL",39,0)
 S Y=$P(X0,U,5) D DD^%DT S XMB(2)=Y
"RTN","OOPSMBUL",40,0)
 S GRP="OOPS SAFETY"
"RTN","OOPSMBUL",41,0)
 D MFAC
"RTN","OOPSMBUL",42,0)
 D ^XMB K XMB,XMY,XMM,XMDT
"RTN","OOPSMBUL",43,0)
 Q
"RTN","OOPSMBUL",44,0)
CIO(IEN) ; OOPS INCIDENT OUTCOME REQUIRED BULLETIN
"RTN","OOPSMBUL",45,0)
 ;this bulletin is sent to the safety officer when the response to the 
"RTN","OOPSMBUL",46,0)
 ;INITIAL RETURN TO WORK STATUS (field #352) is "Days Away Work" or 
"RTN","OOPSMBUL",47,0)
 ;"Job Transfer/Transfer"
"RTN","OOPSMBUL",48,0)
 ;Input:  IEN of the ASISTS case
"RTN","OOPSMBUL",49,0)
 N GRP,XMB,X0
"RTN","OOPSMBUL",50,0)
 S XMB="OOPS INCIDENT OUTCOME REQUIRED",X0=$G(^OOPS(2260,IEN,0)) K XMY
"RTN","OOPSMBUL",51,0)
 S XMB(1)=$P(X0,U,1)
"RTN","OOPSMBUL",52,0)
 S GRP="OOPS SAFETY"
"RTN","OOPSMBUL",53,0)
 D MFAC
"RTN","OOPSMBUL",54,0)
 D ^XMB K XMB,XMY,XMM,XMDT
"RTN","OOPSMBUL",55,0)
 Q
"RTN","OOPSMBUL",56,0)
CLSCASE(IEN) ; Bulletin to Safety & WC whenever a case is closed
"RTN","OOPSMBUL",57,0)
 ;  01/02/04 Patch 4, llh
"RTN","OOPSMBUL",58,0)
 ;  Input
"RTN","OOPSMBUL",59,0)
 ;    IEN - Internal record number
"RTN","OOPSMBUL",60,0)
 ;
"RTN","OOPSMBUL",61,0)
 N GRP
"RTN","OOPSMBUL",62,0)
 K XMB,XMY,X0
"RTN","OOPSMBUL",63,0)
 S XMB="OOPS CASE CLOSE NOTIFICATION"
"RTN","OOPSMBUL",64,0)
 S X0=$P($G(^OOPS(2260,IEN,0),"CASE UNDEFINED"),U)
"RTN","OOPSMBUL",65,0)
 S XMB(1)=X0                             ; case number
"RTN","OOPSMBUL",66,0)
 S XMB(2)=$$GET1^DIQ(200,DUZ,.01,"E")    ; name of user closing case
"RTN","OOPSMBUL",67,0)
 S XMB(3)=$$FMTE^XLFDT($$DT^XLFDT())     ; today's date
"RTN","OOPSMBUL",68,0)
 S GRP="OOPS WCP" D MFAC
"RTN","OOPSMBUL",69,0)
 D ^XMB
"RTN","OOPSMBUL",70,0)
 S GRP="OOPS SAFETY" D MFAC
"RTN","OOPSMBUL",71,0)
 D ^XMB K XMB,XMY,XMM,XMDT,X0
"RTN","OOPSMBUL",72,0)
 Q
"RTN","OOPSMBUL",73,0)
WCPBOR(IEN) ; Employee does not understand bill of rights, sent msg to wcp
"RTN","OOPSMBUL",74,0)
 ; Input
"RTN","OOPSMBUL",75,0)
 ;   IEN - Internal record number
"RTN","OOPSMBUL",76,0)
 ;
"RTN","OOPSMBUL",77,0)
 N GRP,X0
"RTN","OOPSMBUL",78,0)
 S X0=$G(^OOPS(2260,IEN,0)) K XMY
"RTN","OOPSMBUL",79,0)
 S XMB(1)=$P(X0,U,2)
"RTN","OOPSMBUL",80,0)
 S XMB="OOPS WCPBOR"
"RTN","OOPSMBUL",81,0)
 S GRP="OOPS WCP"
"RTN","OOPSMBUL",82,0)
 D MFAC
"RTN","OOPSMBUL",83,0)
 D ^XMB K XMB,XMY,XMM,XMDT
"RTN","OOPSMBUL",84,0)
 Q
"RTN","OOPSMBUL",85,0)
CONSENT(IEN,UNIREP) ; Employee consented to union notification, 
"RTN","OOPSMBUL",86,0)
 ;                 send msg to union
"RTN","OOPSMBUL",87,0)
 ; Input
"RTN","OOPSMBUL",88,0)
 ;    IEN - Internal record number
"RTN","OOPSMBUL",89,0)
 ; UNIREP - IEN from file 200 of the Union Rep - used to send bulletin
"RTN","OOPSMBUL",90,0)
 ;
"RTN","OOPSMBUL",91,0)
 N GRP,X0,XA
"RTN","OOPSMBUL",92,0)
 S X0=$G(^OOPS(2260,IEN,0))
"RTN","OOPSMBUL",93,0)
 S XA=$G(^OOPS(2260,IEN,"2162A")) K XMY
"RTN","OOPSMBUL",94,0)
 S XMY(UNIREP)=""
"RTN","OOPSMBUL",95,0)
 S XMB(1)=$P(X0,U),Y=$P(X0,U,5) D DD^%DT S XMB(2)=Y
"RTN","OOPSMBUL",96,0)
 S XMB(3)=$$GET1^DIQ(2260,IEN,52)
"RTN","OOPSMBUL",97,0)
 S XMB(4)=$$GET1^DIQ(2260,IEN,2)
"RTN","OOPSMBUL",98,0)
 S XMB(5)=$$GET1^DIQ(2260,IEN,7)
"RTN","OOPSMBUL",99,0)
 S XMB(6)=$$GET1^DIQ(2260,IEN,13,"I")
"RTN","OOPSMBUL",100,0)
 S XMB(7)=$E($$GET1^DIQ(2260,IEN,18),1,28)
"RTN","OOPSMBUL",101,0)
 S XMB(8)=$$GET1^DIQ(2260,IEN,14)
"RTN","OOPSMBUL",102,0)
 S XMB(9)=$P(XA,U,12)_"/"_$P(XA,U,13)
"RTN","OOPSMBUL",103,0)
 S XMB(10)=$E($$GET1^DIQ(2260,IEN,53),1,23)
"RTN","OOPSMBUL",104,0)
 S XMB(11)=$E($$GET1^DIQ(2260,IEN,53.1),1,28)
"RTN","OOPSMBUL",105,0)
 S XMB(12)=$E($$GET1^DIQ(2260,IEN,3),1,23)
"RTN","OOPSMBUL",106,0)
 S XMDUZ=.5
"RTN","OOPSMBUL",107,0)
 S XMB="OOPS CONSENT"
"RTN","OOPSMBUL",108,0)
 D ^XMB K XMB,XMY,XMM,XMDT,XMDUZ
"RTN","OOPSMBUL",109,0)
 Q
"RTN","OOPSMBUL",110,0)
WCP(IEN,ACT) ; Bulletin to Super when WC edits or WX signs CA1/CA2
"RTN","OOPSMBUL",111,0)
 ; Input
"RTN","OOPSMBUL",112,0)
 ;   IEN - Internal record number
"RTN","OOPSMBUL",113,0)
 ;   ACT -
"RTN","OOPSMBUL",114,0)
 ;    "E" = Edited by the WC personnel
"RTN","OOPSMBUL",115,0)
 ;    "S" = Signed by the WC personnel
"RTN","OOPSMBUL",116,0)
 ;
"RTN","OOPSMBUL",117,0)
 N SUP,SUP2,Y
"RTN","OOPSMBUL",118,0)
 S XMB=$S(ACT="E":"OOPS WC EDITED",ACT="S":"OOPS WC SIGNED",1:"")
"RTN","OOPSMBUL",119,0)
 I $G(XMB)="" Q
"RTN","OOPSMBUL",120,0)
 S X0=$G(^OOPS(2260,IEN,0)) K XMY
"RTN","OOPSMBUL",121,0)
 S SUP=$P(X0,U,8),XMY(SUP)=""
"RTN","OOPSMBUL",122,0)
 S SUP2=$P(X0,U,9) I $G(SUP2) S XMY(SUP2)=""
"RTN","OOPSMBUL",123,0)
 S XMB(1)=$P(X0,U,2)
"RTN","OOPSMBUL",124,0)
 S XMB(2)=$P(X0,U,1)
"RTN","OOPSMBUL",125,0)
 S Y=$P(X0,U,5) D DD^%DT S XMB(3)=Y
"RTN","OOPSMBUL",126,0)
 S XMDUZ=.5
"RTN","OOPSMBUL",127,0)
 D ^XMB K XMB,XMY,XMM,XMDT,X0,XMDUZ
"RTN","OOPSMBUL",128,0)
 Q
"RTN","OOPSMBUL",129,0)
SUPS(IEN) ; Bulletin to WC when Supervisor signs CA1/CA2
"RTN","OOPSMBUL",130,0)
 ; Patch 8
"RTN","OOPSMBUL",131,0)
 N SUP,SUP2,FORM,GRP,Y
"RTN","OOPSMBUL",132,0)
 S XMB="OOPS WORKERS COMP",X0=$G(^OOPS(2260,IEN,0)) K XMY
"RTN","OOPSMBUL",133,0)
 S SUP=$P(X0,U,8),XMY(SUP)=""
"RTN","OOPSMBUL",134,0)
 S SUP2=$P(X0,U,9) I $G(SUP2) S XMY(SUP2)=""
"RTN","OOPSMBUL",135,0)
 S XMB(1)=$P(X0,U,2)
"RTN","OOPSMBUL",136,0)
 S XMB(2)=$P(X0,U,1)
"RTN","OOPSMBUL",137,0)
 S Y=$P(X0,U,5) D DD^%DT S XMB(3)=Y
"RTN","OOPSMBUL",138,0)
 S FORM=$P(X0,U,7)
"RTN","OOPSMBUL",139,0)
 S FORM=$S(FORM=1:"CA1ES",FORM=2:"CA2ES",1:"")
"RTN","OOPSMBUL",140,0)
 I FORM="" Q
"RTN","OOPSMBUL",141,0)
 S Y=$P(^OOPS(2260,IEN,FORM),U,6) D DD^%DT S XMB(4)=Y
"RTN","OOPSMBUL",142,0)
 S GRP="OOPS WCP"
"RTN","OOPSMBUL",143,0)
 D MFAC
"RTN","OOPSMBUL",144,0)
 D ^XMB K XMB,XMY,XMM,XMDT,X0
"RTN","OOPSMBUL",145,0)
 Q
"RTN","OOPSMBUL",146,0)
UNION(IEN) ; Union  Bulletin
"RTN","OOPSMBUL",147,0)
 N GRP,Y
"RTN","OOPSMBUL",148,0)
 S XMB="OOPS SUPERVISOR",X0=$G(^OOPS(2260,IEN,0)) K XMY
"RTN","OOPSMBUL",149,0)
 S XMB(3)=$P(X0,U,1)
"RTN","OOPSMBUL",150,0)
 S Y=$P(X0,U,5) D DD^%DT S XMB(2)=Y
"RTN","OOPSMBUL",151,0)
 S GRP="OOPS UNION"
"RTN","OOPSMBUL",152,0)
 D MFAC
"RTN","OOPSMBUL",153,0)
 D ^XMB K XMB,XMY,XMM,XMDT
"RTN","OOPSMBUL",154,0)
 Q
"RTN","OOPSMBUL",155,0)
EMP(IEN) ; Employee notification to supervisor
"RTN","OOPSMBUL",156,0)
 N GRP,SUP,SUP2
"RTN","OOPSMBUL",157,0)
 S XMB="OOPS EMPLOYEE",X0=$G(^OOPS(2260,IEN,0)) K XMY
"RTN","OOPSMBUL",158,0)
 S XMB(3)=$P(X0,U,1)
"RTN","OOPSMBUL",159,0)
 S Y=$P(X0,U,5) D DD^%DT S XMB(2)=Y
"RTN","OOPSMBUL",160,0)
 S SUP=$P(X0,U,8),XMY(SUP)=""
"RTN","OOPSMBUL",161,0)
 S SUP2=$P(X0,U,9) I SUP2>0 S XMY(SUP2)=""
"RTN","OOPSMBUL",162,0)
 S GRP="OOPS INJURY"
"RTN","OOPSMBUL",163,0)
 D MFAC
"RTN","OOPSMBUL",164,0)
 D ^XMB K XMY,XMM,XMDT
"RTN","OOPSMBUL",165,0)
 S GRP="OOPS UNION"
"RTN","OOPSMBUL",166,0)
 D MFAC
"RTN","OOPSMBUL",167,0)
 S XMDUZ=.5
"RTN","OOPSMBUL",168,0)
 D ^XMB K XMB,XMY,XMM,XMDT,XMDUZ
"RTN","OOPSMBUL",169,0)
 Q
"RTN","OOPSMBUL",170,0)
BOR(IEN) ; Employee Bill of Rights
"RTN","OOPSMBUL",171,0)
 N EMP
"RTN","OOPSMBUL",172,0)
 S XMB="OOPS BILL OF RIGHTS" K XMY
"RTN","OOPSMBUL",173,0)
 S EMP=$O(^VA(200,"SSN",SSN,0)),XMY(EMP)=""
"RTN","OOPSMBUL",174,0)
 D ^XMB K XMB,XMY,XMM,XMDT
"RTN","OOPSMBUL",175,0)
 Q
"RTN","OOPSMBUL",176,0)
GRP ; Get Mail group Members for GRP
"RTN","OOPSMBUL",177,0)
 I GRP="" Q
"RTN","OOPSMBUL",178,0)
 S XMY("I:G."_GRP)=""
"RTN","OOPSMBUL",179,0)
 Q
"RTN","OOPSUTL4")
0^9^B56676889^B55894258
"RTN","OOPSUTL4",1,0)
OOPSUTL4 ;HINES/WAA-Utilities Routines ;3/24/98
"RTN","OOPSUTL4",2,0)
 ;;2.0;ASISTS;**7,15**;Jun 03, 2002;Build 9
"RTN","OOPSUTL4",3,0)
DTVAL(DATE,FLD1,FLD2) ;
"RTN","OOPSUTL4",4,0)
 ; this subroutine called from ^DD so date error checking on fields
"RTN","OOPSUTL4",5,0)
 ; 143, 144, 145 (if CA1) and 254, 255 (if CA2).  returns a valid date 
"RTN","OOPSUTL4",6,0)
 ; (one passed in) if a date in FLD2 and is > than date passed in (DATE).
"RTN","OOPSUTL4",7,0)
 ;  Inputs:   DATE - date entered in prompt
"RTN","OOPSUTL4",8,0)
 ;            FLD1 - field of prompt date entered in
"RTN","OOPSUTL4",9,0)
 ;            FLD2 - field of date to be checked against
"RTN","OOPSUTL4",10,0)
 ; Outputs:   VAL  - contains valid date passed in if true & "" if false
"RTN","OOPSUTL4",11,0)
 N DTE2,VAL
"RTN","OOPSUTL4",12,0)
 S VAL=DATE,DTE2=""
"RTN","OOPSUTL4",13,0)
 I '$G(IEN) S IEN=$G(DA)
"RTN","OOPSUTL4",14,0)
 I IEN S DTE2=$$GET1^DIQ(2260,IEN,FLD2,"I")
"RTN","OOPSUTL4",15,0)
 I %DT'["R" S DTE2=DTE2\1
"RTN","OOPSUTL4",16,0)
 I DTE2>DATE!'$G(DTE2) S VAL=""
"RTN","OOPSUTL4",17,0)
 I 'VAL D
"RTN","OOPSUTL4",18,0)
 .;V2_P15 changed direct writes with call to EN^DDIOL
"RTN","OOPSUTL4",19,0)
 .I '$G(DTE2) D EN^DDIOL($$GET1^DID(2260,FLD2,"","LABEL")_" cannot be blank if date entered in "_$$GET1^DID(2260,FLD1,"","LABEL"),"","!!!?5")
"RTN","OOPSUTL4",20,0)
 .D EN^DDIOL($$GET1^DID(2260,FLD1,"","LABEL")_" must be on or after the "_$$GET1^DID(2260,FLD2,"","LABEL"),"","!!!?5")
"RTN","OOPSUTL4",21,0)
 Q VAL
"RTN","OOPSUTL4",22,0)
VALIDATE(IEN,FORM,CALLER,VALID) ;
"RTN","OOPSUTL4",23,0)
 ; Input: IEN    = Internal Entry Number of entry in file 2260
"RTN","OOPSUTL4",24,0)
 ;        FORM   = 2162,CA1, or CA2
"RTN","OOPSUTL4",25,0)
 ;        CALLER = "E" employee
"RTN","OOPSUTL4",26,0)
 ;               = "S" supervisor
"RTN","OOPSUTL4",27,0)
 ;               = "O" safety officer
"RTN","OOPSUTL4",28,0)
 ;               = "W" worker's comp personnel
"RTN","OOPSUTL4",29,0)
 ;        WCEMP  = from menu if 1 - need to execute emp validation
"RTN","OOPSUTL4",30,0)
 ;        VALID  = RESERVED FOR OUTPUT DATA
"RTN","OOPSUTL4",31,0)
 ; Output:VALID  = 1 ALL REQUIRED DATA FOR FORM IS COMPLETE
"RTN","OOPSUTL4",32,0)
 ;               = 0 DATA IS MISSING
"RTN","OOPSUTL4",33,0)
 N LIST,FLD,CNT,CHK
"RTN","OOPSUTL4",34,0)
 S (FLD,LIST)=""
"RTN","OOPSUTL4",35,0)
 S VALID=1,CHK=0,WCEMP=$G(WCEMP,0)
"RTN","OOPSUTL4",36,0)
 W !,"Validating data on form ",FORM,"."
"RTN","OOPSUTL4",37,0)
 I CALLER="E"!$G(WCEMP) D EMP
"RTN","OOPSUTL4",38,0)
 I CALLER="S" D SUP
"RTN","OOPSUTL4",39,0)
 I CALLER="O" D SOF
"RTN","OOPSUTL4",40,0)
 I CALLER="W" D WCP
"RTN","OOPSUTL4",41,0)
 F CNT=1:1 S FLD=$P(LIST,",",CNT) Q:FLD=""  D
"RTN","OOPSUTL4",42,0)
 .N LOC,NODE,PCE,BADFLD,TEXT,WP
"RTN","OOPSUTL4",43,0)
 .S BADFLD=1,WP=0
"RTN","OOPSUTL4",44,0)
 .S LOC=$$GET1^DID(2260,FLD,"","GLOBAL SUBSCRIPT LOCATION")
"RTN","OOPSUTL4",45,0)
 .S NODE=$P(LOC,";"),PCE=$P(LOC,";",2)
"RTN","OOPSUTL4",46,0)
 .I PCE=0 D  ;Work processing field
"RTN","OOPSUTL4",47,0)
 ..I '$D(^OOPS(2260,IEN,NODE,1,0)) S (BADFLD,VALID)=0
"RTN","OOPSUTL4",48,0)
 ..S WP=1
"RTN","OOPSUTL4",49,0)
 ..Q
"RTN","OOPSUTL4",50,0)
 .I PCE'=0  I $P($G(^OOPS(2260,IEN,NODE)),U,PCE)="" S (BADFLD,VALID)=0
"RTN","OOPSUTL4",51,0)
 .I 'BADFLD D  ; Display error messaged about fields not filled.
"RTN","OOPSUTL4",52,0)
 ..I 'CHK W !!,"The following fields must be completed before the "_FORM_" can be signed.",! S CHK=1
"RTN","OOPSUTL4",53,0)
 ..I WP D  ;Is this a wp field and where to get title
"RTN","OOPSUTL4",54,0)
 ...N NODE
"RTN","OOPSUTL4",55,0)
 ...S NODE=2260_".0"_FLD
"RTN","OOPSUTL4",56,0)
 ...; patch 11 - fix bug on fld 40, node '= 2260.040, it's 2260.01
"RTN","OOPSUTL4",57,0)
 ...I FLD=40 S NODE="2260.01"
"RTN","OOPSUTL4",58,0)
 ...S TEXT=$$GET1^DID(NODE,".01","","TITLE")
"RTN","OOPSUTL4",59,0)
 ..I 'WP S TEXT=$$GET1^DID(2260,FLD,"","TITLE") I $G(TEXT)="" S TEXT=$$GET1^DID(2260,FLD,"","LABEL")
"RTN","OOPSUTL4",60,0)
 ..; patch 2.7 - if body part affected - indicate the form
"RTN","OOPSUTL4",61,0)
 ..I FLD=30,(TEXT'="") S TEXT=TEXT_" (FORM 2162)"
"RTN","OOPSUTL4",62,0)
 ..W !,TEXT
"RTN","OOPSUTL4",63,0)
 I FORM="CA1"&(CALLER="E"!$G(WCEMP)) D   ; fld 110 check on Emp CA1 only
"RTN","OOPSUTL4",64,0)
 .I $$GET1^DIQ(2260,IEN,110,"I")<($$GET1^DIQ(2260,IEN,4,"I")\1) S VALID=0 D
"RTN","OOPSUTL4",65,0)
 ..W !?5,$$GET1^DID(2260,110,"","LABEL")_" must be on or after the "_$$GET1^DID(2260,4,"","LABEL")
"RTN","OOPSUTL4",66,0)
DTCHK ; Date error checking that may be missed w/input transform
"RTN","OOPSUTL4",67,0)
 ; patch 11 - Additional error checking has been added for CA2 field 214
"RTN","OOPSUTL4",68,0)
 I FORM=2162!(CALLER="O")!$G(WCEMP) Q
"RTN","OOPSUTL4",69,0)
 K CNT,FLD,LIST
"RTN","OOPSUTL4",70,0)
 N DATE,DTE1,DTE2,TITLE,EMPDOB
"RTN","OOPSUTL4",71,0)
 ; patch 11 - need to make sure 215 not before 214 on employee part
"RTN","OOPSUTL4",72,0)
 I CALLER="E",FORM="CA2" D  Q
"RTN","OOPSUTL4",73,0)
 .S DTE1=$$GET1^DIQ(2260,IEN,215,"I")
"RTN","OOPSUTL4",74,0)
 .S DTE2=$$GET1^DIQ(2260,IEN,214,"I")
"RTN","OOPSUTL4",75,0)
 .S EMPDOB=$$GET1^DIQ(2260,IEN,6,"I")
"RTN","OOPSUTL4",76,0)
 .I $$FMDIFF^XLFDT(DTE2,EMPDOB,2)<0 S VALID=0 D
"RTN","OOPSUTL4",77,0)
 ..W !?5,$$GET1^DID(2260,214,"","LABEL")_" must be on or after the "_$$GET1^DID(2260,6,"","LABEL")
"RTN","OOPSUTL4",78,0)
 .I $$FMDIFF^XLFDT(DTE1,DTE2,2)<0 S VALID=0 D
"RTN","OOPSUTL4",79,0)
 ..W !?5,$$GET1^DID(2260,215,"","LABEL")_" must be on or after the "_$$GET1^DID(2260,214,"","LABEL")
"RTN","OOPSUTL4",80,0)
 ; End of checks from Employee CA2
"RTN","OOPSUTL4",81,0)
 I FORM="CA1" D
"RTN","OOPSUTL4",82,0)
 .S LIST="142,161,175"
"RTN","OOPSUTL4",83,0)
 .S (DATE,DTE1)=$$GET1^DIQ(2260,IEN,4,"I")
"RTN","OOPSUTL4",84,0)
 .S TITLE=$$GET1^DID(2260,4,"","LABEL")
"RTN","OOPSUTL4",85,0)
 I FORM="CA2" D
"RTN","OOPSUTL4",86,0)
 .S LIST="215,250,252,253,255"
"RTN","OOPSUTL4",87,0)
 .S (DATE,DTE1)=$$GET1^DIQ(2260,IEN,214,"I")
"RTN","OOPSUTL4",88,0)
 .S TITLE=$$GET1^DID(2260,214,"","LABEL")
"RTN","OOPSUTL4",89,0)
 F CNT=1:1 S FLD=$P(LIST,",",CNT) Q:FLD=""  D
"RTN","OOPSUTL4",90,0)
 .S DTE2=$$GET1^DIQ(2260,IEN,FLD,"I") I FLD'=142 S DTE2=DTE2\1,DTE1=DATE\1
"RTN","OOPSUTL4",91,0)
 .I $G(DTE2),DTE2<DTE1 D  S VALID=0
"RTN","OOPSUTL4",92,0)
 ..W !?5,$$GET1^DID(2260,FLD,"","LABEL")_" must be on or after the "_TITLE
"RTN","OOPSUTL4",93,0)
 ; Need specific check on DATE/TIME STOPPED WORK
"RTN","OOPSUTL4",94,0)
 I FORM="CA1" D
"RTN","OOPSUTL4",95,0)
 .S LIST="143,144,145",DATE=$$GET1^DIQ(2260,IEN,142,"I")
"RTN","OOPSUTL4",96,0)
 .S TITLE=$$GET1^DID(2260,142,"","LABEL")
"RTN","OOPSUTL4",97,0)
 I FORM="CA2" D
"RTN","OOPSUTL4",98,0)
 .S LIST="254,256",DATE=$$GET1^DIQ(2260,IEN,253,"I")
"RTN","OOPSUTL4",99,0)
 .S TITLE=$$GET1^DID(2260,253,"","LABEL")
"RTN","OOPSUTL4",100,0)
 F CNT=1:1 S FLD=$P(LIST,",",CNT) Q:FLD=""  D
"RTN","OOPSUTL4",101,0)
 .S DTE2=$$GET1^DIQ(2260,IEN,FLD,"I"),DTE1=DATE D
"RTN","OOPSUTL4",102,0)
 ..I FLD=143!(FLD=144) S DTE1=DATE\1,DTE2=DTE2\1
"RTN","OOPSUTL4",103,0)
 ..I (DTE1>DTE2),$G(DTE2) D  S VALID=0
"RTN","OOPSUTL4",104,0)
 ...W !?5,$$GET1^DID(2260,FLD,"","LABEL")_" must be on or after the "_TITLE
"RTN","OOPSUTL4",105,0)
 ..I '$G(DTE1),$G(DTE2) D  S VALID=0
"RTN","OOPSUTL4",106,0)
 ...W !?5,TITLE_" cannot be blank if date in "_$$GET1^DID(2260,FLD,"","LABEL")
"RTN","OOPSUTL4",107,0)
 Q
"RTN","OOPSUTL4",108,0)
EMP ; Address fields are now all pulled from the 2162A node
"RTN","OOPSUTL4",109,0)
 ; added fields 126 & 181,183-185 to lists below - patch 8
"RTN","OOPSUTL4",110,0)
 I FORM="CA1" S LIST="8,9,10,11,12,108,109,110,111,112,113,114,126,181,183,184,185"
"RTN","OOPSUTL4",111,0)
 ; added field 213 - ASISTS V2.0
"RTN","OOPSUTL4",112,0)
 I FORM="CA2" S LIST="8,9,10,11,12,126,208,213,209,214,215,216,217"
"RTN","OOPSUTL4",113,0)
 Q
"RTN","OOPSUTL4",114,0)
SUP ;
"RTN","OOPSUTL4",115,0)
 N F165
"RTN","OOPSUTL4",116,0)
 I FORM="2162" D F2162 I $$ISEMP^OOPSUTL4(IEN) S LIST=LIST_",33" Q
"RTN","OOPSUTL4",117,0)
 S LIST="30,"
"RTN","OOPSUTL4",118,0)
 I FORM="CA1" D
"RTN","OOPSUTL4",119,0)
 .S LIST=LIST_"4,60,130,131,132,133,134,138,139,140,146,148,150,"
"RTN","OOPSUTL4",120,0)
 .S LIST=LIST_"162,163,172,173,174,175,176,177,178,179,"
"RTN","OOPSUTL4",121,0)
 .S LIST=LIST_"180,181,183,184,185,"
"RTN","OOPSUTL4",122,0)
 .I $$GET1^DIQ(2260,IEN,150,"I")="Y" S LIST=LIST_"151,152,153,154,155,"
"RTN","OOPSUTL4",123,0)
 .; V2.0 added required fields missed in patch 8
"RTN","OOPSUTL4",124,0)
 .I $$GET1^DIQ(2260,IEN,146)="No" S LIST=LIST_"147,"
"RTN","OOPSUTL4",125,0)
 .I $$GET1^DIQ(2260,IEN,148)="Yes" S LIST=LIST_"149,"
"RTN","OOPSUTL4",126,0)
 .I $$GET1^DIQ(2260,IEN,163)="No" S LIST=LIST_"164,"
"RTN","OOPSUTL4",127,0)
 .S F165=$G(^OOPS(2260,IEN,"CA1K",0))
"RTN","OOPSUTL4",128,0)
 .I $G(F165)'="",($P(F165,U,4)'=0) S LIST=LIST_"165,"
"RTN","OOPSUTL4",129,0)
 I FORM="CA2" D
"RTN","OOPSUTL4",130,0)
 .S LIST=LIST_"230,231,232,233,234,237,238,239,240,241,"
"RTN","OOPSUTL4",131,0)
 .S LIST=LIST_"242,243,244,251,252,255,258,60,268,269,"
"RTN","OOPSUTL4",132,0)
 .; below for ASISTS V2.0, needed for roll and scroll also
"RTN","OOPSUTL4",133,0)
 .; added next line, need to get 3rd party if 258 = y
"RTN","OOPSUTL4",134,0)
 .I $$GET1^DIQ(2260,IEN,258,"I")="Y" S LIST=LIST_"259,260,261,262,263,"
"RTN","OOPSUTL4",135,0)
 ; V2.0 if field 60="other" (3)  then 61 required for both CA1 & CA2
"RTN","OOPSUTL4",136,0)
 I $$GET1^DIQ(2260,IEN,60,"I")=3 S LIST=LIST_"61,"
"RTN","OOPSUTL4",137,0)
 ; need to check physician information
"RTN","OOPSUTL4",138,0)
 D PHYCHK^OOPSGUI9
"RTN","OOPSUTL4",139,0)
 Q
"RTN","OOPSUTL4",140,0)
SOF ;
"RTN","OOPSUTL4",141,0)
 I FORM="2162" D F2162 S LIST=LIST_",55,47"
"RTN","OOPSUTL4",142,0)
 Q
"RTN","OOPSUTL4",143,0)
WCP ; Get required fields for Workers Comp
"RTN","OOPSUTL4",144,0)
 I FORM="2162" D F2162 Q
"RTN","OOPSUTL4",145,0)
 S LIST="5,6,7,15,62,70,73,"
"RTN","OOPSUTL4",146,0)
 I FORM="CA1" D
"RTN","OOPSUTL4",147,0)
 . S LIST=LIST_"123,124,"
"RTN","OOPSUTL4",148,0)
 . ; flds 166 & 167 only required if personnel status = 1
"RTN","OOPSUTL4",149,0)
 . I $$GET1^DIQ(2260,IEN,2,"I")=1 S LIST=LIST_"166,167,"
"RTN","OOPSUTL4",150,0)
 I FORM="CA2" D
"RTN","OOPSUTL4",151,0)
 . S LIST=LIST_"226,227,"
"RTN","OOPSUTL4",152,0)
 D SUP
"RTN","OOPSUTL4",153,0)
 Q
"RTN","OOPSUTL4",154,0)
F2162 ; Set required fields for form 2162 - doesn't matter which menu
"RTN","OOPSUTL4",155,0)
 ; coming from, Supervisor, Safety, WC (for EDIT REPORT OF INCIDENT)
"RTN","OOPSUTL4",156,0)
 N TYP,SAF
"RTN","OOPSUTL4",157,0)
 I FORM'="2162" Q
"RTN","OOPSUTL4",158,0)
 S LIST="26,27,28,29,30,31"
"RTN","OOPSUTL4",159,0)
 S TYP=$$GET1^DIQ(2260,IEN,"3:.01","E")
"RTN","OOPSUTL4",160,0)
 I "^Sharps Exposure^Hollow Bore Needlestick^Suture Needlestick^"[TYP D
"RTN","OOPSUTL4",161,0)
 . S LIST=LIST_",34,35,36,37,38,82"
"RTN","OOPSUTL4",162,0)
 I $$GET1^DIQ(2260,IEN,"38:2","I")="N" S LIST=LIST_",83"
"RTN","OOPSUTL4",163,0)
 I "^Exposure to Body Fluids/Splash^"[TYP D
"RTN","OOPSUTL4",164,0)
 . S LIST=LIST_",34,39,40,41"
"RTN","OOPSUTL4",165,0)
 I $$GET1^DIQ(2260,IEN,3,"I")<11 Q
"RTN","OOPSUTL4",166,0)
 I $$GET1^DIQ(2260,IEN,42.5,"I")="Y" S LIST=LIST_",42"
"RTN","OOPSUTL4",167,0)
 S SAF=$$GET1^DIQ(2260,IEN,43,"I")
"RTN","OOPSUTL4",168,0)
 S LIST=$S(SAF="Y":LIST_",84,87",SAF="N":LIST_",85",1:LIST)
"RTN","OOPSUTL4",169,0)
 S LIST=LIST_",47"
"RTN","OOPSUTL4",170,0)
 Q
"RTN","OOPSUTL4",171,0)
UP(IN) ; Translate all lower to upper
"RTN","OOPSUTL4",172,0)
 N OUT
"RTN","OOPSUTL4",173,0)
 S OUT=$TR(IN,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","OOPSUTL4",174,0)
 Q OUT
"RTN","OOPSUTL4",175,0)
VCHAR(IN) ; Check to make sure no invalid characters have been used
"RTN","OOPSUTL4",176,0)
 ;   input  - IN, data entered by user
"RTN","OOPSUTL4",177,0)
 ;  output  - VALID, if invalid characters used, = 0
"RTN","OOPSUTL4",178,0)
 N VALID
"RTN","OOPSUTL4",179,0)
 S VALID=1
"RTN","OOPSUTL4",180,0)
 I IN'=$TR(IN,"~`@#$%*_|\}{[]><","") S VALID=0
"RTN","OOPSUTL4",181,0)
 Q VALID
"RTN","OOPSUTL4",182,0)
ISEMP(IEN) ; Determine if PERSONNEL STATUS = employee
"RTN","OOPSUTL4",183,0)
 ;  Input -  IEN     = internal Entry Number of case in File 2260
"RTN","OOPSUTL4",184,0)
 ;           CAT     = Personnel Status of Case in File 2260
"RTN","OOPSUTL4",185,0)
 ;           TST     = valid Personnel status categories for employee
"RTN","OOPSUTL4",186,0)
 ;  Output - EMP     = 1 Personnel status indicates employee
"RTN","OOPSUTL4",187,0)
 ;                     0 Personnel status indicates non-employee
"RTN","OOPSUTL4",188,0)
 NEW CAT,TST,EMP
"RTN","OOPSUTL4",189,0)
 S EMP=0
"RTN","OOPSUTL4",190,0)
 S CAT=$$GET1^DIQ(2260,IEN,2,"I")
"RTN","OOPSUTL4",191,0)
 ; 12/16/01 V2.0 removed personnel types 7,8,9,10
"RTN","OOPSUTL4",192,0)
 S TST=",1,2,6,"
"RTN","OOPSUTL4",193,0)
 I TST[(","_CAT_",") S EMP=1
"RTN","OOPSUTL4",194,0)
 Q EMP
"RTN","OOPSUTL4",195,0)
FUT(DATE) ; Check for dates prior to Date of Inj/Ill
"RTN","OOPSUTL4",196,0)
 N DAT,VIEW,FORM
"RTN","OOPSUTL4",197,0)
 S VIEW=1
"RTN","OOPSUTL4",198,0)
 S FORM=$$GET1^DIQ(2260,IEN,52,"I")
"RTN","OOPSUTL4",199,0)
 S DAT=$$GET1^DIQ(2260,IEN,4,"I")
"RTN","OOPSUTL4",200,0)
 I (DATE<$P(DAT,".")),FORM=1 D
"RTN","OOPSUTL4",201,0)
 . W !!?6,"This date cannot be prior to DATE/TIME INJURY OCCURRED entered on 2162.",! S VIEW=0
"RTN","OOPSUTL4",202,0)
 Q VIEW
"RTN","OOPSUTL4",203,0)
WP(OPFLD) ; Patch 8 - determine number of characters in WP fields that are
"RTN","OOPSUTL4",204,0)
 ;         limited to 532 characters & if invalid characters are present
"RTN","OOPSUTL4",205,0)
 ;  Input    IEN - Internal Record ID of Case
"RTN","OOPSUTL4",206,0)
 ;         OPFLD - Field number of WP field to be calculated
"RTN","OOPSUTL4",207,0)
 ; Output    OPT - Total number of characters in all lines of WP field
"RTN","OOPSUTL4",208,0)
 ;                 concatenated to VALID. ex: 165^1 or 180^0
"RTN","OOPSUTL4",209,0)
 ;         VALID - indicates whether invalid characters were detected
"RTN","OOPSUTL4",210,0)
 N DATA,DIWL,DIWR,DIWF,OPGLB,OPI,OPNODE,OPT,OPC,VALID
"RTN","OOPSUTL4",211,0)
 S VALID=1
"RTN","OOPSUTL4",212,0)
 K ^UTILITY($J,"W")
"RTN","OOPSUTL4",213,0)
 S DIWL=1,DIWR="",DIWF="|C264",OPT=0
"RTN","OOPSUTL4",214,0)
 S OPNODE=$P($$GET1^DID(2260,OPFLD,"","GLOBAL SUBSCRIPT LOCATION"),";")
"RTN","OOPSUTL4",215,0)
 S OPI=0 F  S OPI=$O(^OOPS(2260,IEN,OPNODE,OPI)) Q:'OPI  S X=$G(^OOPS(2260,IEN,OPNODE,OPI,0)) D:X]"" ^DIWP
"RTN","OOPSUTL4",216,0)
 I $G(^UTILITY($J,"W",1))+0 D
"RTN","OOPSUTL4",217,0)
 . S OPI=0 F OPC=1:1 S OPI=$O(^UTILITY($J,"W",1,OPI)) Q:'OPI  D
"RTN","OOPSUTL4",218,0)
 .. S DATA=^UTILITY($J,"W",1,OPI,0)
"RTN","OOPSUTL4",219,0)
 .. I DATA'=$TR(DATA,"~`@#$%^*_|\}{[]><","") S VALID=0
"RTN","OOPSUTL4",220,0)
 .. S OPT=OPT+$L(DATA)
"RTN","OOPSUTL4",221,0)
 K ^UTILITY($J,"W"),X
"RTN","OOPSUTL4",222,0)
 Q OPT_U_VALID
"UP",2260,2260.095,-1)
2260^OUTC
"UP",2260,2260.095,0)
2260.095
"UP",2262,2262.315,-2)
2262^1
"UP",2262,2262.315,-1)
2262.03^2
"UP",2262,2262.315,0)
2262.315
"VER")
8.0^22.0
"^DD",2260,2260,90,0)
DATE/TIME STUB CREATED^DX^^0;20^S %DT="ETXR" D ^%DT S X=Y K:Y<1 X K %DT
"^DD",2260,2260,90,3)
Enter the Date and Time the Incident Occurred.
"^DD",2260,2260,90,21,0)
^^2^2^3011015^
"^DD",2260,2260,90,21,1,0)
This field will capture the Date and Time that the initial Stub record (Create
"^DD",2260,2260,90,21,2,0)
Accident/Illness Report) was filed in the system.
"^DD",2260,2260,90,"DT")
3061129
"^DD",2260,2260,142,0)
DATE/TIME WORK STOPPED^DX^^CA1F;13^S %DT="ERX",%DT(0)="-NOW" D ^%DT S X=Y K:Y<1 X,%DT I $G(X),$P($G(^OOPS(2260,DA,0)),U,5)>X D EN^DDIOL("DATE WORK STOPPED cannot be prior to DATE/TIME OF OCCURRENCE","","!!?5") K X,%DT
"^DD",2260,2260,142,3)
Enter the date and time the employee stopped work.
"^DD",2260,2260,142,21,0)
^.001^1^1^3011031^^^^
"^DD",2260,2260,142,21,1,0)
This is the date and time the employee stopped work due to the injury. (Injury)
"^DD",2260,2260,142,"DT")
3080626
"^DD",2260,2260,143,0)
DATE PAY STOPPED^DX^^CA1G;1^S %DT="ETX",%DT(0)="-NOW" D ^%DT S X=Y K:Y<1 X,%DT I $G(X),'$$DTVAL^OOPSUTL4(X,143,142) K X,%DT
"^DD",2260,2260,143,3)
Enter the date the employee's pay stopped.
"^DD",2260,2260,143,21,0)
^^1^1^2980410^
"^DD",2260,2260,143,21,1,0)
This is the date the employee's pay stopped. (Injury)
"^DD",2260,2260,143,"DT")
3080626
"^DD",2260,2260,144,0)
DATE 45 DAY PERIOD BEGAN^DX^^CA1G;2^S %DT="ETX",%DT(0)="-NOW" D ^%DT S X=Y K:Y<1 X,%DT I $G(X),'$$DTVAL^OOPSUTL4(X,144,142) K X,%DT
"^DD",2260,2260,144,3)
Enter the date the 45 day period began.
"^DD",2260,2260,144,21,0)
^^1^1^2980410^
"^DD",2260,2260,144,21,1,0)
This is the date the 45 day period began for COP. (Injury)
"^DD",2260,2260,144,"DT")
3080626
"^DD",2260,2260,145,0)
DATE/TIME RETURNED TO WORK^DX^^CA1G;3^S %DT="ERX",%DT(0)="-NOW" D ^%DT S X=Y K:Y<1 X,%DT I $G(X),'$$DTVAL^OOPSUTL4(X,145,142) K X,%DT
"^DD",2260,2260,145,3)
Enter the date and time the employee returned to work.
"^DD",2260,2260,145,21,0)
^^1^1^2980430^^
"^DD",2260,2260,145,21,1,0)
This is the date and time the employee returned to work. (Injury)
"^DD",2260,2260,145,"DT")
3080626
"^DD",2260,2260,253,0)
DATE/TIME WORK STOPPED^DX^^CA2J;9^S %DT="ETR",%DT(0)="-NOW" D ^%DT S X=Y K:Y<1 X,%DT I $G(X),$P($G(^OOPS(2260,DA,"CA2B")),U,6)>X D EN^DDIOL("DATE/TIME WORK STOPPED cannot be prior to DATE FIRST AWARE OF ILLNESS","","!!?5") K X,%DT
"^DD",2260,2260,253,3)
Enter the date and time the employee stopped work.
"^DD",2260,2260,253,21,0)
^^1^1^2980430^^
"^DD",2260,2260,253,21,1,0)
This is the date and time the employee stopped work due to the condition. (Illness/disease)
"^DD",2260,2260,253,"DT")
3080626
"^DD",2260,2260,254,0)
DATE/TIME PAY STOPPED^DX^^CA2J;10^S %DT="ETR",%DT(0)="-NOW" D ^%DT S X=Y K:Y<1 X,%DT I $G(X),'$$DTVAL^OOPSUTL4(X,254,253) K X,%DT
"^DD",2260,2260,254,3)
Enter the date/time the employee's pay stopped.
"^DD",2260,2260,254,21,0)
^^1^1^2980430^^^
"^DD",2260,2260,254,21,1,0)
This is the date and time the employee's pay stopped. (Illness/disease)
"^DD",2260,2260,254,"DT")
3080626
"^DD",2260,2260,256,0)
DATE/TIME RETURNED TO WORK^DX^^CA2J;12^S %DT="ERX",%DT(0)="-NOW" D ^%DT S X=Y K:Y<1 X,%DT I $G(X),'$$DTVAL^OOPSUTL4(X,256,253) K X,%DT
"^DD",2260,2260,256,3)
Enter the date/time the employee returned to work.
"^DD",2260,2260,256,21,0)
^^1^1^2980430^^
"^DD",2260,2260,256,21,1,0)
This is the date and time the employee returned to work. (Illness/disease)
"^DD",2260,2260,256,"DT")
3080626
"^DD",2260,2260,354,0)
WEATHER FACTOR^P2261.21'^OOPS(2261.21,^2162M;1^Q
"^DD",2260,2260,354,3)
Enter the weather condition most affecting the cause of incident.
"^DD",2260,2260,354,21,0)
^^1^1^3080305^
"^DD",2260,2260,354,21,1,0)
This field contains the weather condition at the time of the incident.
"^DD",2260,2260,354,"DT")
3080305
"^DD",2260,2260,355,0)
SOURCE OF INCIDENT^P2261.22'^OOPS(2261.22,^2162M;2^Q
"^DD",2260,2260,355,3)
Enter the most probably source of the cause of the incident.
"^DD",2260,2260,355,21,0)
^.001^1^1^3080305^^
"^DD",2260,2260,355,21,1,0)
This field is the most relevant source of the Incident.
"^DD",2260,2260,355,"DT")
3080305
"^DD",2260,2260,356,0)
CAUSE OF INCIDENT^S^AA:Equipment or Environment;BA:Person;CA:Nature;FA:Cause Unknown;^2162M;3^Q
"^DD",2260,2260,356,3)
Enter the primary cause of the accident
"^DD",2260,2260,356,21,0)
^^1^1^3080305^
"^DD",2260,2260,356,21,1,0)
This is the most probable cause of the accident
"^DD",2260,2260,356,"DT")
3080305
"^DD",2260,2260,357,0)
ADDITIONAL CAUSE OF INCIDENT^S^AA:Equipment or Environment;BA:Person;CA:Nature;ZZ:No additional Cause;^2162M;4^Q
"^DD",2260,2260,357,3)
Enter an additional cause of the incident.
"^DD",2260,2260,357,21,0)
^^1^1^3080305^
"^DD",2260,2260,357,21,1,0)
This field will contain the secondary cause of the incident.
"^DD",2260,2260,357,"DT")
3080305
"^DD",2260,2260,358,0)
PREVENTIVE METHOD^P2261.24'^OOPS(2261.24,^2162M;5^Q
"^DD",2260,2260,358,3)
Enter the method that would have best prevented the incident.
"^DD",2260,2260,358,21,0)
^^1^1^3080305^
"^DD",2260,2260,358,21,1,0)
This field contains the most likely way to have prevented the incident.
"^DD",2260,2260,358,"DT")
3080305
"^DD",2260,2260,359,0)
STATUS OF CORRECTIVE ACTION^S^A:Taken;B:Requested and Anticipated;C:Requested;D:None;^2162M;6^Q
"^DD",2260,2260,359,3)
Enter the status of any corrective action recommended.
"^DD",2260,2260,359,21,0)
^.001^2^2^3080305^^
"^DD",2260,2260,359,21,1,0)
This field contains the status of any recommended corrective action to
"^DD",2260,2260,359,21,2,0)
be taken.
"^DD",2260,2260,359,"DT")
3080305
"^DD",2260,2260,360,0)
SEVERITY OF INJURY^S^1:No Treatment Required;2:First Aid Only;3:Medical Treatment;4:Disabling Injury;5:Fatality;^2162M;7^Q
"^DD",2260,2260,360,3)
Enter the severity of the injury.
"^DD",2260,2260,360,21,0)
^^1^1^3080306^
"^DD",2260,2260,360,21,1,0)
This field indicates how devastating the injury was to the individual.
"^DD",2260,2260,360,"DT")
3080306
"^DD",2260,2260.095,6,0)
DATE OUTCOME CREATED^DX^^0;7^S %DT="ETXR" D ^%DT S X=Y K:Y<1 X K %DT
"^DD",2260,2260.095,6,3)
Enter the date the incident outcome was created.
"^DD",2260,2260.095,6,21,0)
^.001^2^2^3041122^^
"^DD",2260,2260.095,6,21,1,0)
This system generated date will store the date this incident outcome
"^DD",2260,2260.095,6,21,2,0)
was created.
"^DD",2260,2260.095,6,"DT")
3061129
"^DD",2260,2260.095,8,0)
LAST EDIT DATE^DX^^0;9^S %DT="ETXR" D ^%DT S X=Y K:Y<1 X K %DT
"^DD",2260,2260.095,8,3)
Enter the date the incident record was last edited
"^DD",2260,2260.095,8,21,0)
^^2^2^3041122^
"^DD",2260,2260.095,8,21,1,0)
The application will automatically store the date the incident outcome
"^DD",2260,2260.095,8,21,2,0)
record was edited.
"^DD",2260,2260.095,8,"DT")
3061129
"^DD",2261.21,2261.21,0)
FIELD^^1^2
"^DD",2261.21,2261.21,0,"DDA")
N
"^DD",2261.21,2261.21,0,"DT")
3080305
"^DD",2261.21,2261.21,0,"IX","B",2261.21,.01)

"^DD",2261.21,2261.21,0,"NM","ASISTS INCIDENT WEATHER FACTORS")

"^DD",2261.21,2261.21,0,"PT",2260,354)

"^DD",2261.21,2261.21,.01,0)
WEATHER FACTOR^RF^^0;1^K:$L(X)>20!($L(X)<3)!'(X'?1P.E) X
"^DD",2261.21,2261.21,.01,.1)

"^DD",2261.21,2261.21,.01,1,0)
^.1
"^DD",2261.21,2261.21,.01,1,1,0)
2261.21^B
"^DD",2261.21,2261.21,.01,1,1,1)
S ^OOPS(2261.21,"B",$E(X,1,30),DA)=""
"^DD",2261.21,2261.21,.01,1,1,2)
K ^OOPS(2261.21,"B",$E(X,1,30),DA)
"^DD",2261.21,2261.21,.01,3)
Enter 3-20 characters that define the weather condition name.
"^DD",2261.21,2261.21,.01,21,0)
^.001^1^1^3080305^^
"^DD",2261.21,2261.21,.01,21,1,0)
This field contains the weather factor contributing to the incident.
"^DD",2261.21,2261.21,.01,"DT")
3080305
"^DD",2261.21,2261.21,1,0)
WEATHER FACTOR CODE^RF^^0;2^K:$L(X)>4!($L(X)<1) X
"^DD",2261.21,2261.21,1,3)
Enter 1-4 characters for the weather code.
"^DD",2261.21,2261.21,1,21,0)
^.001^1^1^3080305^^
"^DD",2261.21,2261.21,1,21,1,0)
This field contains the weather factor code.
"^DD",2261.21,2261.21,1,"DT")
3080305
"^DD",2261.22,2261.22,0)
FIELD^^1^2
"^DD",2261.22,2261.22,0,"DDA")
N
"^DD",2261.22,2261.22,0,"DT")
3080305
"^DD",2261.22,2261.22,0,"IX","B",2261.22,.01)

"^DD",2261.22,2261.22,0,"NM","ASISTS INCIDENT SOURCE")

"^DD",2261.22,2261.22,0,"PT",2260,355)

"^DD",2261.22,2261.22,.01,0)
SOURCE OF INCIDENT^RF^^0;1^K:$L(X)>45!($L(X)<3)!'(X'?1P.E) X
"^DD",2261.22,2261.22,.01,1,0)
^.1
"^DD",2261.22,2261.22,.01,1,1,0)
2261.22^B
"^DD",2261.22,2261.22,.01,1,1,1)
S ^OOPS(2261.22,"B",$E(X,1,30),DA)=""
"^DD",2261.22,2261.22,.01,1,1,2)
K ^OOPS(2261.22,"B",$E(X,1,30),DA)
"^DD",2261.22,2261.22,.01,3)
Answer must be 3-45 characters in length.
"^DD",2261.22,2261.22,.01,21,0)
^.001^1^1^3080305^^
"^DD",2261.22,2261.22,.01,21,1,0)
This field contains the incident source.
"^DD",2261.22,2261.22,.01,"DT")
3080305
"^DD",2261.22,2261.22,1,0)
INCIDENT SOURCE CODE^RF^^0;2^K:$L(X)>10!($L(X)<4) X
"^DD",2261.22,2261.22,1,3)
Enter 4-10 characters to define the incident source code.
"^DD",2261.22,2261.22,1,21,0)
^^1^1^3080305^
"^DD",2261.22,2261.22,1,21,1,0)
This field contains the code defining the primary source causing the incident.
"^DD",2261.22,2261.22,1,"DT")
3080305
"^DD",2261.24,2261.24,0)
FIELD^^1^2
"^DD",2261.24,2261.24,0,"DDA")
N
"^DD",2261.24,2261.24,0,"DT")
3080305
"^DD",2261.24,2261.24,0,"IX","B",2261.24,.01)

"^DD",2261.24,2261.24,0,"NM","ASISTS PREVENTION METHODS")

"^DD",2261.24,2261.24,0,"PT",2260,358)

"^DD",2261.24,2261.24,.01,0)
PREVENTION METHOD^RF^^0;1^K:$L(X)>35!($L(X)<1)!'(X'?1P.E) X
"^DD",2261.24,2261.24,.01,1,0)
^.1
"^DD",2261.24,2261.24,.01,1,1,0)
2261.24^B
"^DD",2261.24,2261.24,.01,1,1,1)
S ^OOPS(2261.24,"B",$E(X,1,30),DA)=""
"^DD",2261.24,2261.24,.01,1,1,2)
K ^OOPS(2261.24,"B",$E(X,1,30),DA)
"^DD",2261.24,2261.24,.01,3)
Answer must be 1-35 characters in length.
"^DD",2261.24,2261.24,.01,21,0)
^.001^2^2^3080305^^^
"^DD",2261.24,2261.24,.01,21,1,0)
This field contains the best preventative method that could have been 
"^DD",2261.24,2261.24,.01,21,2,0)
employed to prevent the incident.
"^DD",2261.24,2261.24,.01,"DT")
3080305
"^DD",2261.24,2261.24,1,0)
PREVENTION CODE^RF^^0;2^K:$L(X)>5!($L(X)<1) X
"^DD",2261.24,2261.24,1,3)
Enter 1-5 characters for the best prevention method used.
"^DD",2261.24,2261.24,1,21,0)
^^2^2^3080305^
"^DD",2261.24,2261.24,1,21,1,0)
This field contains the best preventative method code that could have
"^DD",2261.24,2261.24,1,21,2,0)
been used to prevent the incident.
"^DD",2261.24,2261.24,1,"DT")
3080305
"^DD",2262,2262.03,15,0)
OSHA MONTH/YEAR^2262.315DA^^2;0
"^DD",2262,2262.03,15,21,0)
^.001^3^3^3041122^^
"^DD",2262,2262.03,15,21,1,0)
This subfile is for storing the average number of employees and the total
"^DD",2262,2262.03,15,21,2,0)
hours worked by employees on a monthly basis.  This information is used
"^DD",2262,2262.03,15,21,3,0)
on the OSHA 300A Summary report.
"^DD",2262,2262.315,0)
OSHA MONTH/YEAR SUB-FIELD^^2^3
"^DD",2262,2262.315,0,"NM","OSHA MONTH/YEAR")

"^DD",2262,2262.315,.01,0)
OSHA MONTH/YEAR^DX^^0;1^S %DT="EMX" D ^%DT S X=Y K:Y<1 X K %DT
"^DD",2262,2262.315,.01,1,0)
^.1
"^DD",2262,2262.315,.01,1,1,0)
2262.315^B
"^DD",2262,2262.315,.01,1,1,1)
S ^OOPS(2262,DA(2),1,DA(1),2,"B",$E(X,1,30),DA)=""
"^DD",2262,2262.315,.01,1,1,2)
K ^OOPS(2262,DA(2),1,DA(1),2,"B",$E(X,1,30),DA)
"^DD",2262,2262.315,.01,3)
Enter the month and year for the Employee data.
"^DD",2262,2262.315,.01,21,0)
^^1^1^3041122^
"^DD",2262,2262.315,.01,21,1,0)
This is the Month and Year in the format MM/YYYY for the employee data.
"^DD",2262,2262.315,.01,"DT")
3061129
"^DD",2264,2264,98,0)
DATE CA7 RCVD FROM EMP^D^^CA7S15A;1^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",2264,2264,98,3)
Enter the date you received the form from the employee.
"^DD",2264,2264,98,21,0)
^.001^2^2^3080429^
"^DD",2264,2264,98,21,1,0)
This field contains the date the CA7 form was received from
"^DD",2264,2264,98,21,2,0)
the employee.
"^DD",2264,2264,98,"DT")
3080122
"^DIC",2261.21,2261.21,0)
ASISTS INCIDENT WEATHER FACTORS^2261.21
"^DIC",2261.21,2261.21,0,"GL")
^OOPS(2261.21,
"^DIC",2261.21,2261.21,"%",0)
^1.005^^
"^DIC",2261.21,2261.21,"%D",0)
^^2^2^3080305^
"^DIC",2261.21,2261.21,"%D",1,0)
This file contains the weather conditions that contributed to the
"^DIC",2261.21,2261.21,"%D",2,0)
Incident.
"^DIC",2261.21,"B","ASISTS INCIDENT WEATHER FACTORS",2261.21)

"^DIC",2261.22,2261.22,0)
ASISTS INCIDENT SOURCE^2261.22
"^DIC",2261.22,2261.22,0,"GL")
^OOPS(2261.22,
"^DIC",2261.22,2261.22,"%D",0)
^^1^1^3080305^
"^DIC",2261.22,2261.22,"%D",1,0)
This file contains the list of valid sources causing the incident.
"^DIC",2261.22,"B","ASISTS INCIDENT SOURCE",2261.22)

"^DIC",2261.24,2261.24,0)
ASISTS PREVENTION METHODS^2261.24
"^DIC",2261.24,2261.24,0,"GL")
^OOPS(2261.24,
"^DIC",2261.24,2261.24,"%D",0)
^^2^2^3080305^
"^DIC",2261.24,2261.24,"%D",1,0)
This file contains the list of prevention methods that could be used
"^DIC",2261.24,2261.24,"%D",2,0)
to avoid another incident.
"^DIC",2261.24,"B","ASISTS PREVENTION METHODS",2261.24)

"BLD",7619,6)
^16
**END**
**END**
