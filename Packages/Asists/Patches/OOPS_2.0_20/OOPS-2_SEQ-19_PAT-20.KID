EMERGENCY Released OOPS*2*20 SEQ #19
Extracted from mail message
**KIDS**:OOPS*2.0*20^

**INSTALL NAME**
OOPS*2.0*20
"BLD",8100,0)
OOPS*2.0*20^ASISTS^0^3090615^y
"BLD",8100,1,0)
^^5^5^3090615^^^
"BLD",8100,1,1,0)
This patch contains a modification to address an issue with the OSHA
"BLD",8100,1,2,0)
300 Log.    A field has been added to collect data that will
"BLD",8100,1,3,0)
used to populate Column F in the OSHA 300 log.  This will enable
"BLD",8100,1,4,0)
facilities to have complete control over information in that field
"BLD",8100,1,5,0)
to eliminate OSHA citations.
"BLD",8100,4,0)
^9.64PA^2260^1
"BLD",8100,4,2260,0)
2260
"BLD",8100,4,2260,2,0)
^9.641^2260^1
"BLD",8100,4,2260,2,2260,0)
ASISTS ACCIDENT REPORTING  (File-top level)
"BLD",8100,4,2260,2,2260,1,0)
^9.6411^384^1
"BLD",8100,4,2260,2,2260,1,384,0)
OSHA 300 COLUMN F
"BLD",8100,4,2260,222)
y^n^p^^^^n^^n
"BLD",8100,4,2260,224)

"BLD",8100,4,"APDD",2260,2260)

"BLD",8100,4,"APDD",2260,2260,384)

"BLD",8100,4,"B",2260,2260)

"BLD",8100,6)
1^
"BLD",8100,6.3)
2
"BLD",8100,"ABNS",0)
^9.66A^^
"BLD",8100,"ABPKG")
n
"BLD",8100,"KRN",0)
^9.67PA^779.2^20
"BLD",8100,"KRN",.4,0)
.4
"BLD",8100,"KRN",.401,0)
.401
"BLD",8100,"KRN",.402,0)
.402
"BLD",8100,"KRN",.403,0)
.403
"BLD",8100,"KRN",.5,0)
.5
"BLD",8100,"KRN",.84,0)
.84
"BLD",8100,"KRN",3.6,0)
3.6
"BLD",8100,"KRN",3.6,"NM",0)
^9.68A^^0
"BLD",8100,"KRN",3.8,0)
3.8
"BLD",8100,"KRN",3.8,"NM",0)
^9.68A^^0
"BLD",8100,"KRN",9.2,0)
9.2
"BLD",8100,"KRN",9.8,0)
9.8
"BLD",8100,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",8100,"KRN",9.8,"NM",1,0)
OOPSGUI1^^0^B34497263
"BLD",8100,"KRN",9.8,"NM",2,0)
OOPSGUID^^0^B67922733
"BLD",8100,"KRN",9.8,"NM",3,0)
OOPSGUIR^^0^B70518771
"BLD",8100,"KRN",9.8,"NM","B","OOPSGUI1",1)

"BLD",8100,"KRN",9.8,"NM","B","OOPSGUID",2)

"BLD",8100,"KRN",9.8,"NM","B","OOPSGUIR",3)

"BLD",8100,"KRN",19,0)
19
"BLD",8100,"KRN",19,"NM",0)
^9.68A^^0
"BLD",8100,"KRN",19.1,0)
19.1
"BLD",8100,"KRN",19.1,"NM",0)
^9.68A^^0
"BLD",8100,"KRN",101,0)
101
"BLD",8100,"KRN",409.61,0)
409.61
"BLD",8100,"KRN",771,0)
771
"BLD",8100,"KRN",779.2,0)
779.2
"BLD",8100,"KRN",870,0)
870
"BLD",8100,"KRN",8989.51,0)
8989.51
"BLD",8100,"KRN",8989.52,0)
8989.52
"BLD",8100,"KRN",8994,0)
8994
"BLD",8100,"KRN",8994,"NM",0)
^9.68A^^0
"BLD",8100,"KRN","B",.4,.4)

"BLD",8100,"KRN","B",.401,.401)

"BLD",8100,"KRN","B",.402,.402)

"BLD",8100,"KRN","B",.403,.403)

"BLD",8100,"KRN","B",.5,.5)

"BLD",8100,"KRN","B",.84,.84)

"BLD",8100,"KRN","B",3.6,3.6)

"BLD",8100,"KRN","B",3.8,3.8)

"BLD",8100,"KRN","B",9.2,9.2)

"BLD",8100,"KRN","B",9.8,9.8)

"BLD",8100,"KRN","B",19,19)

"BLD",8100,"KRN","B",19.1,19.1)

"BLD",8100,"KRN","B",101,101)

"BLD",8100,"KRN","B",409.61,409.61)

"BLD",8100,"KRN","B",771,771)

"BLD",8100,"KRN","B",779.2,779.2)

"BLD",8100,"KRN","B",870,870)

"BLD",8100,"KRN","B",8989.51,8989.51)

"BLD",8100,"KRN","B",8989.52,8989.52)

"BLD",8100,"KRN","B",8994,8994)

"BLD",8100,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",8100,"QUES",0)
^9.62^^
"BLD",8100,"REQB",0)
^9.611^1^1
"BLD",8100,"REQB",1,0)
OOPS*2.0*18^2
"BLD",8100,"REQB","B","OOPS*2.0*18",1)

"FIA",2260)
ASISTS ACCIDENT REPORTING
"FIA",2260,0)
^OOPS(2260,
"FIA",2260,0,0)
2260I
"FIA",2260,0,1)
y^n^p^^^^n^^n
"FIA",2260,0,10)

"FIA",2260,0,11)

"FIA",2260,0,"RLRO")

"FIA",2260,0,"VR")
2.0^OOPS
"FIA",2260,2260)
1
"FIA",2260,2260,384)

"MBREQ")
0
"PKG",472,-1)
1^1
"PKG",472,0)
ASISTS^OOPS^Automated Safety Incident Surveillance Tracking System
"PKG",472,20,0)
^9.402P^^
"PKG",472,22,0)
^9.49I^1^1
"PKG",472,22,1,0)
2.0^3020709^3030401^66481
"PKG",472,22,1,"PAH",1,0)
20^3090615
"PKG",472,22,1,"PAH",1,1,0)
^^5^5^3090615
"PKG",472,22,1,"PAH",1,1,1,0)
This patch contains a modification to address an issue with the OSHA
"PKG",472,22,1,"PAH",1,1,2,0)
300 Log.    A field has been added to collect data that will
"PKG",472,22,1,"PAH",1,1,3,0)
used to populate Column F in the OSHA 300 log.  This will enable
"PKG",472,22,1,"PAH",1,1,4,0)
facilities to have complete control over information in that field
"PKG",472,22,1,"PAH",1,1,5,0)
to eliminate OSHA citations.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","OOPSGUI1")
0^1^B34497263^B34497502
"RTN","OOPSGUI1",1,0)
OOPSGUI1 ;WIOFO/LLH-RPC routines ;9/3/01
"RTN","OOPSGUI1",2,0)
 ;;2.0;ASISTS;**4,8,7,11,15,18,20**;Jun 03, 2002;Build 2
"RTN","OOPSGUI1",3,0)
 ;
"RTN","OOPSGUI1",4,0)
OPT(RESULTS,INP) ; Returns the ASISTS GUI Menus user has access to
"RTN","OOPSGUI1",5,0)
 ;      INP      - Input String containing the version of GUI making call
"RTN","OOPSGUI1",6,0)
 ;  RESUTLS      - return value for broker call
"RTN","OOPSGUI1",7,0)
 ;                 P1 = 1 DUZ defined
"RTN","OOPSGUI1",8,0)
 ;                 P2 = 1 Emp Health menu accessible
"RTN","OOPSGUI1",9,0)
 ;                 P3 = 1 Employee menu accessible
"RTN","OOPSGUI1",10,0)
 ;                 P4 = 1 Supervisor menu accessible
"RTN","OOPSGUI1",11,0)
 ;                 P5 = 1 Safety Officer menu accessible
"RTN","OOPSGUI1",12,0)
 ;                 P6 = 1 Union menu accessible
"RTN","OOPSGUI1",13,0)
 ;                 P7 = 1 Workers' Comp menu accessible
"RTN","OOPSGUI1",14,0)
 ;                 P8 = SSN from New Person file for user
"RTN","OOPSGUI1",15,0)
 ;                 P9 = server version #
"RTN","OOPSGUI1",16,0)
 ;
"RTN","OOPSGUI1",17,0)
 N CNT,MENU,OPT,PRIM,SM,VER
"RTN","OOPSGUI1",18,0)
 S CNT=1
"RTN","OOPSGUI1",19,0)
 I 'DUZ S RESULTS="0^^^^^^^" Q
"RTN","OOPSGUI1",20,0)
 S RESULTS=DUZ_"^0^0^0^0^0^0^"
"RTN","OOPSGUI1",21,0)
 ;V2_P20 - changed version to 20
"RTN","OOPSGUI1",22,0)
 S VER="2.20.1.0"        ;Define version check patch #4
"RTN","OOPSGUI1",23,0)
 I $G(INP)=""!($G(INP)'=VER) Q
"RTN","OOPSGUI1",24,0)
 S PRIM=$$GET1^DIQ(200,DUZ,201)     ; get primary menu
"RTN","OOPSGUI1",25,0)
 I $G(PRIM)'="" S MENU(PRIM)=""
"RTN","OOPSGUI1",26,0)
 S SM=0
"RTN","OOPSGUI1",27,0)
 F  S SM=$O(^VA(200,DUZ,203,SM))  Q:SM'>0  D
"RTN","OOPSGUI1",28,0)
 . S OPT=$$GET1^DIQ(19,$P($G(^VA(200,DUZ,203,SM,0)),U),.01)
"RTN","OOPSGUI1",29,0)
 . I $G(OPT)'="" S MENU(OPT)=""
"RTN","OOPSGUI1",30,0)
 I $D(MENU("OOPS GUI EMPLOYEE HEALTH MENU")) S $P(RESULTS,U,2)=1
"RTN","OOPSGUI1",31,0)
 I $D(MENU("OOPS GUI EMPLOYEE")) S $P(RESULTS,U,3)=1
"RTN","OOPSGUI1",32,0)
 I $D(MENU("OOPS GUI SUPERVISOR MENU")) S $P(RESULTS,U,4)=1
"RTN","OOPSGUI1",33,0)
 I $D(MENU("OOPS GUI SAFETY OFFICER MENU")) S $P(RESULTS,U,5)=1
"RTN","OOPSGUI1",34,0)
 I $D(MENU("OOPS GUI UNION MENU")) S $P(RESULTS,U,6)=1
"RTN","OOPSGUI1",35,0)
 I $D(MENU("OOPS GUI WORKERS' COMP MENU")) S $P(RESULTS,U,7)=1
"RTN","OOPSGUI1",36,0)
 I +$$ACCESS^XQCHK(DUZ,"OOPS GUI EMPLOYEE") S $P(RESULTS,U,3)=1
"RTN","OOPSGUI1",37,0)
 S $P(RESULTS,U,8)=$$GET1^DIQ(200,DUZ,9)
"RTN","OOPSGUI1",38,0)
 S $P(RESULTS,U,9)=VER              ;return the version defined above.
"RTN","OOPSGUI1",39,0)
 Q
"RTN","OOPSGUI1",40,0)
SETSIGN(RESULTS,INPUT,SIGN) ; This subroutine validates that the signature
"RTN","OOPSGUI1",41,0)
 ;                         can be entered and is valid
"RTN","OOPSGUI1",42,0)
 ;  Input:   INPUT - Contains the IEN of the ASISTS case, the form type,
"RTN","OOPSGUI1",43,0)
 ;                   and the field number.  The field number is used
"RTN","OOPSGUI1",44,0)
 ;                   to trigger what validation should be preformed on
"RTN","OOPSGUI1",45,0)
 ;                   the fields in the form so that the signature can
"RTN","OOPSGUI1",46,0)
 ;                   be applied. The fourth parameter is a special flag
"RTN","OOPSGUI1",47,0)
 ;                   indicating the Workers Comp is signing for employee
"RTN","OOPSGUI1",48,0)
 ;                   Format is IEN^FORM^FIELD^WCFLAG
"RTN","OOPSGUI1",49,0)
 ;            SIGN - contains the signature test to be encrypted.
"RTN","OOPSGUI1",50,0)
 ; Output: RESULTS - is an array containing a list of fields that did
"RTN","OOPSGUI1",51,0)
 ;                   not pass the data validation and must be corrected
"RTN","OOPSGUI1",52,0)
 ;                   prior to applying a signature.
"RTN","OOPSGUI1",53,0)
 N CALL,DTIME,FDUZ,FDT,FLD,IEN,INC,FORM,ESIG,VALID,CALLER,WOK
"RTN","OOPSGUI1",54,0)
 N DR,DA,DIE,WCFLG
"RTN","OOPSGUI1",55,0)
 S IEN=$P($G(INPUT),U),FORM=$P($G(INPUT),U,2),FLD=$P($G(INPUT),U,3)
"RTN","OOPSGUI1",56,0)
 I '$G(IEN)!('$G(FLD)) S RESULTS(1)="User not Authorized to sign form" Q
"RTN","OOPSGUI1",57,0)
 I FLD=45!(FLD=170)!(FLD=266) S CALL="S"
"RTN","OOPSGUI1",58,0)
 I FLD=49!(FLD=77) S CALL="O"
"RTN","OOPSGUI1",59,0)
 ; Patch 5 ll - added !(FLD=313)!(FLD=320)
"RTN","OOPSGUI1",60,0)
 I FLD=68!(FLD=313)!(FLD=320) S CALL="W"
"RTN","OOPSGUI1",61,0)
 I FLD=80 S CALL="H"
"RTN","OOPSGUI1",62,0)
 ; Patch 5 llh - added !(FLD=310)
"RTN","OOPSGUI1",63,0)
 I FLD=120!(FLD=222)!(FLD=310) S CALL="E"
"RTN","OOPSGUI1",64,0)
 S WCFLG=$P($G(INPUT),U,4)
"RTN","OOPSGUI1",65,0)
 I WCFLG'="W" D
"RTN","OOPSGUI1",66,0)
 .; Patch 5 llh - moved non fld check logic to separate line
"RTN","OOPSGUI1",67,0)
 .; added stuff to check if dual benefits have been signed
"RTN","OOPSGUI1",68,0)
 .I (FLD=120!(FLD=222)) D
"RTN","OOPSGUI1",69,0)
 ..I ($$GET1^DIQ(2260,IEN,71,"I")'="Y") D  Q
"RTN","OOPSGUI1",70,0)
 ...S RESULTS(1)="Claim cannot be signed until the Bill of Rights Statement is understood."
"RTN","OOPSGUI1",71,0)
 ...D WCPBOR^OOPSMBUL(IEN)
"RTN","OOPSGUI1",72,0)
 ;..Commented out Patch 11 cvw
"RTN","OOPSGUI1",73,0)
 ;..I $$GET1^DIQ(2260,IEN,310)="" D  Q
"RTN","OOPSGUI1",74,0)
 ;...S RESULTS(1)="Claim cannot be signed until the Dual Benefits form has been signed."
"RTN","OOPSGUI1",75,0)
 ; check to make sure PAID fields (also Service) not "", if "" get data
"RTN","OOPSGUI1",76,0)
 D CHKPAID
"RTN","OOPSGUI1",77,0)
 S VALID=0
"RTN","OOPSGUI1",78,0)
 S INC=$$GET1^DIQ(2260,IEN,52,"I")
"RTN","OOPSGUI1",79,0)
 ; Patch 5 llh - added ,(FLD'>300)
"RTN","OOPSGUI1",80,0)
 I (FLD'=77),(FLD'=80),(FLD'>300) D  I 'VALID Q
"RTN","OOPSGUI1",81,0)
 .D VALIDATE^OOPSGUI9(IEN,FORM,CALL,.VALID)
"RTN","OOPSGUI1",82,0)
 I $G(SIGN)="" S RESULTS(1)="No Signature Entered" Q
"RTN","OOPSGUI1",83,0)
 S VALID=$$VALIDATE($$DECRYP^XUSRB1(SIGN))
"RTN","OOPSGUI1",84,0)
 I 'VALID D  Q
"RTN","OOPSGUI1",85,0)
 .I $P($G(^VA(200,DUZ,20)),"^",4)="" S RESULTS(1)="No Electronic Signature on File" Q
"RTN","OOPSGUI1",86,0)
 .S RESULTS(1)="Invalid Signature Entered."
"RTN","OOPSGUI1",87,0)
SIGN ; All field validated, file signature
"RTN","OOPSGUI1",88,0)
 I FLD=77 S FDUZ=76,FDT=78             ; Safety approve WC sign
"RTN","OOPSGUI1",89,0)
 I FLD=80 S FDUZ=79,FDT=81             ; EH approve WC sign
"RTN","OOPSGUI1",90,0)
 I FLD=120 S FDUZ=119,FDT=121          ; Employee sign CA1
"RTN","OOPSGUI1",91,0)
 I FLD=222 S FDUZ=221,FDT=223          ; Employee sign CA2
"RTN","OOPSGUI1",92,0)
 I FLD=170 S FDUZ=169,FDT=171          ; Super sign CA1
"RTN","OOPSGUI1",93,0)
 I FLD=266 S FDUZ=265,FDT=267          ; Super sign CA2
"RTN","OOPSGUI1",94,0)
 I FLD=45 S FDUZ=44,FDT=46             ; Super sign 2162
"RTN","OOPSGUI1",95,0)
 I FLD=49 S FDUZ=48,FDT=50             ; Safety sign 2162
"RTN","OOPSGUI1",96,0)
 I FLD=68 S FDUZ=67,FDT=69,WOK=1       ; WC approve to DOL
"RTN","OOPSGUI1",97,0)
 ; patch 5 llh - added next 2 lines (may need more)
"RTN","OOPSGUI1",98,0)
 I FLD=310 S FDUZ=309,FDT=311          ; Emp sign Dual Benefits
"RTN","OOPSGUI1",99,0)
 I FLD=313 S FDUZ=312,FDT=314          ; WC sign Dual Benefits
"RTN","OOPSGUI1",100,0)
 D NOW^%DTC S DTIME=%
"RTN","OOPSGUI1",101,0)
 K DR S DIE="^OOPS(2260,",DA=IEN
"RTN","OOPSGUI1",102,0)
 S DR=FDUZ_"////^S X=+DUZ;"_FLD_"////^S X=ESIG;"_FDT_"////^S X=DTIME"
"RTN","OOPSGUI1",103,0)
 D ^DIE
"RTN","OOPSGUI1",104,0)
 I $G(Y)'="" Q
"RTN","OOPSGUI1",105,0)
 I FLD=68 D WCP^OOPSMBUL(IEN,"S")
"RTN","OOPSGUI1",106,0)
 I FLD=120!(FLD=222) S CALLER=CALL D EMP^OOPSVAL1
"RTN","OOPSGUI1",107,0)
 I FLD=45 D SAFETY^OOPSMBUL(IEN)
"RTN","OOPSGUI1",108,0)
 I (FLD=170)!(FLD=266) D SUPS^OOPSMBUL(IEN),UNION^OOPSMBUL(IEN)
"RTN","OOPSGUI1",109,0)
 Q
"RTN","OOPSGUI1",110,0)
VALIDATE(X) ; Validate Electronic Sign code
"RTN","OOPSGUI1",111,0)
 ;  Input:  X - contains the signature to be validated
"RTN","OOPSGUI1",112,0)
 ; Output: VSIGN - contains a 1 if a valid e-signature, a 0 if not valid
"RTN","OOPSGUI1",113,0)
 N VSIGN
"RTN","OOPSGUI1",114,0)
 S VSIGN=0
"RTN","OOPSGUI1",115,0)
 D HASH^XUSHSHP
"RTN","OOPSGUI1",116,0)
 I X'="",(X=$P($G(^VA(200,DUZ,20)),"^",4)) S VSIGN=1,ESIG=X
"RTN","OOPSGUI1",117,0)
 Q VSIGN
"RTN","OOPSGUI1",118,0)
CHKPAID ; check to make sure PAID fields have data, if not populate
"RTN","OOPSGUI1",119,0)
 ; this subroutine can be removed when go completely to GUI
"RTN","OOPSGUI1",120,0)
 N DA,DIE,DR,CAT,FLD,IEN200,OCCD,PAY,PAYP,RET,SAL,SERV,SSN
"RTN","OOPSGUI1",121,0)
 I $$GET1^DIQ(2260,IEN,60)="" D
"RTN","OOPSGUI1",122,0)
 .S FLD=26,RET="",RET=$$PAID^OOPSUTL1(IEN,FLD)
"RTN","OOPSGUI1",123,0)
 .S RET=$S(RET="FULL CSRS":"CSRS",RET="FERS":"FERS",1:"OTHER")
"RTN","OOPSGUI1",124,0)
 .S DIE="^OOPS(2260,",DA=IEN,DR="60///^S X=RET" D ^DIE
"RTN","OOPSGUI1",125,0)
 I $$GET1^DIQ(2260,IEN,86)="" D
"RTN","OOPSGUI1",126,0)
 .S SERV="",SSN=$$GET1^DIQ(2260,IEN,5,"I")
"RTN","OOPSGUI1",127,0)
 .I $G(SSN) S IEN200=$O(^VA(200,"SSN",SSN,""))
"RTN","OOPSGUI1",128,0)
 .I $G(IEN200) S SERV=$$GET1^DIQ(200,IEN200,29)
"RTN","OOPSGUI1",129,0)
 .S DIE="^OOPS(2260,",DA=IEN,DR="86///^S X=SERV" D ^DIE
"RTN","OOPSGUI1",130,0)
 I $$GET1^DIQ(2260,IEN,166)="" D
"RTN","OOPSGUI1",131,0)
 .S FLD=28,SAL="",SAL=$$PAID^OOPSUTL1(IEN,FLD)
"RTN","OOPSGUI1",132,0)
 .S DIE="^OOPS(2260,",DA=IEN,DR="166///^S X=SAL" D ^DIE
"RTN","OOPSGUI1",133,0)
 I $$GET1^DIQ(2260,IEN,167)="" D
"RTN","OOPSGUI1",134,0)
 .S FLD=19,PAY="",PAY=$$PAID^OOPSUTL1(IEN,FLD)
"RTN","OOPSGUI1",135,0)
 .S PAY=$S(PAY="PER ANNUM":"ANNUAL",PAY="PER HOUR":"HOURLY","PER DIEM":"DAILY","BIWEEKLY":"BI-WEEKLY",1:"")
"RTN","OOPSGUI1",136,0)
 .S DIE="^OOPS(2260,",DA=IEN,DR="167///^S X=PAY" D ^DIE
"RTN","OOPSGUI1",137,0)
 I $$GET1^DIQ(2260,IEN,63)="",($$GET1^DIQ(2260,IEN,2,"I")<3) D
"RTN","OOPSGUI1",138,0)
 .S CAT=$$GET1^DIQ(2260,IEN,2,"I")
"RTN","OOPSGUI1",139,0)
 .I CAT=1 S PAYP=$$PAID^OOPSUTL1(IEN,20) I $G(PAYP)'="" S PAYP=$$PAYP^OOPSUTL1(PAYP)
"RTN","OOPSGUI1",140,0)
 .I CAT=2 S PAYP="VO"
"RTN","OOPSGUI1",141,0)
 .S DIE="^OOPS(2260,",DA=IEN,DR="63///^S X=PAYP" D ^DIE
"RTN","OOPSGUI1",142,0)
 I $$GET1^DIQ(2260,IEN,111)="" D
"RTN","OOPSGUI1",143,0)
 .S FLD=16,OCCD="",OCCD=$$PAID^OOPSUTL1(IEN,FLD)
"RTN","OOPSGUI1",144,0)
 .S DIE="^OOPS(2260,",DA=IEN,DR="111///^S X=OCCD" D ^DIE
"RTN","OOPSGUI1",145,0)
 Q
"RTN","OOPSGUI1",146,0)
VALEMP(RESULTS,INPUT) ; This broker call should be used if the Pay
"RTN","OOPSGUI1",147,0)
 ;                 Plan = "OT" (other) to determine if the claim
"RTN","OOPSGUI1",148,0)
 ;                 can be successfully submitted to DOL.  The PERSONNEL
"RTN","OOPSGUI1",149,0)
 ;                 STATUS is assumed to equal 1 (employee)
"RTN","OOPSGUI1",150,0)
 S IEN=$P($G(INPUT),U,2),FORM=$P($G(INPUT),U)
"RTN","OOPSGUI1",151,0)
 I '$G(IEN)!($G(FORM)="") S RESULTS="Invalid Input, cannot continue." Q
"RTN","OOPSGUI1",152,0)
 I $$VALEMP^OOPSUTL6 S RESULTS="Valid" Q
"RTN","OOPSGUI1",153,0)
 S RESULTS="Invalid data on claim"
"RTN","OOPSGUI1",154,0)
 Q
"RTN","OOPSGUID")
0^2^B67922733^B67336971
"RTN","OOPSGUID",1,0)
OOPSGUID ;WIOFO/LLH-RPC routine for GET/SET CA7 ;04/29/04
"RTN","OOPSGUID",2,0)
 ;;2.0;ASISTS;**8,15,20**;Jun 03, 2002;Build 2
"RTN","OOPSGUID",3,0)
 ;
"RTN","OOPSGUID",4,0)
SAVECA7 ; saves CA7 data to database
"RTN","OOPSGUID",5,0)
 S (RESULTS,RESULTS(1),RESULTS(2))=""
"RTN","OOPSGUID",6,0)
 I $G(IEN)="NEW" D NEWCA7 I $P(RESULTS(2),U,2)'="CA7 Created" Q
"RTN","OOPSGUID",7,0)
 ;
"RTN","OOPSGUID",8,0)
 S RESULTS(1)=IEN_U_"UPDATE FAILED"
"RTN","OOPSGUID",9,0)
 K DR S DIE="^OOPS(2264,",DA=IEN,DR=""
"RTN","OOPSGUID",10,0)
 S DR(1,2264,1)="1///^S X=ARR(6)"
"RTN","OOPSGUID",11,0)
 S DR(1,2264,2)="2////^S X=ARR(7)"
"RTN","OOPSGUID",12,0)
 S DR(1,2264,3)="3///^S X=ARR(8)"
"RTN","OOPSGUID",13,0)
 S DR(1,2264,4)="4///^S X=ARR(9)"
"RTN","OOPSGUID",14,0)
 S DR(1,2264,5)="5////^S X=ARR(10)"
"RTN","OOPSGUID",15,0)
 S DR(1,2264,6)="6///^S X=ARR(11)"
"RTN","OOPSGUID",16,0)
 S DR(1,2264,7)="7///^S X=ARR(12)"
"RTN","OOPSGUID",17,0)
 S DR(1,2264,8)="8///^S X=ARR(13)"
"RTN","OOPSGUID",18,0)
 S DR(1,2264,11)="9///^S X=ARR(14)"
"RTN","OOPSGUID",19,0)
 S DR(1,2264,12)="10///^S X=ARR(15)"
"RTN","OOPSGUID",20,0)
 S DR(1,2264,13)="11///^S X=ARR(16)"
"RTN","OOPSGUID",21,0)
 S DR(1,2264,14)="12///^S X=ARR(17)"
"RTN","OOPSGUID",22,0)
 S DR(1,2264,15)="13///^S X=ARR(18)"
"RTN","OOPSGUID",23,0)
 S DR(1,2264,16)="14///^S X=ARR(19)"
"RTN","OOPSGUID",24,0)
 S DR(1,2264,17)="15///^S X=ARR(20)"
"RTN","OOPSGUID",25,0)
 S DR(1,2264,18)="16///^S X=ARR(21)"
"RTN","OOPSGUID",26,0)
 S DR(1,2264,19)="17///^S X=ARR(22)"
"RTN","OOPSGUID",27,0)
 S DR(1,2264,20)="18///^S X=ARR(23)"
"RTN","OOPSGUID",28,0)
 S DR(1,2264,21)="19///^S X=ARR(24)"
"RTN","OOPSGUID",29,0)
 S DR(1,2264,22)="20///^S X=ARR(25)"
"RTN","OOPSGUID",30,0)
 S DR(1,2264,24)="21///^S X=ARR(26)"
"RTN","OOPSGUID",31,0)
 S DR(1,2264,25)="22///^S X=ARR(27)"
"RTN","OOPSGUID",32,0)
 S DR(1,2264,26)="23///^S X=ARR(28)"
"RTN","OOPSGUID",33,0)
 S DR(1,2264,27)="24///^S X=ARR(29)"
"RTN","OOPSGUID",34,0)
 S DR(1,2264,28)="25///^S X=ARR(30)"
"RTN","OOPSGUID",35,0)
 S DR(1,2264,29)="27///^S X=ARR(31)"
"RTN","OOPSGUID",36,0)
 S DR(1,2264,30)="28///^S X=ARR(32)"
"RTN","OOPSGUID",37,0)
 S DR(1,2264,31)="29///^S X=ARR(33)"
"RTN","OOPSGUID",38,0)
 S DR(1,2264,32)="30///^S X=ARR(34)"
"RTN","OOPSGUID",39,0)
 S DR(1,2264,33)="31///^S X=ARR(35)"
"RTN","OOPSGUID",40,0)
 S DR(1,2264,34)="32///^S X=ARR(36)"
"RTN","OOPSGUID",41,0)
 S DR(1,2264,35)="33///^S X=ARR(37)"
"RTN","OOPSGUID",42,0)
 S DR(1,2264,36)="34///^S X=ARR(38)"
"RTN","OOPSGUID",43,0)
 S DR(1,2264,37)="35///^S X=ARR(39)"
"RTN","OOPSGUID",44,0)
 S DR(1,2264,38)="36///^S X=ARR(40)"
"RTN","OOPSGUID",45,0)
 S DR(1,2264,39)="37///^S X=ARR(41)"
"RTN","OOPSGUID",46,0)
 S DR(1,2264,40)="38///^S X=ARR(42)"
"RTN","OOPSGUID",47,0)
 S DR(1,2264,41)="39///^S X=ARR(43)"
"RTN","OOPSGUID",48,0)
 S DR(1,2264,42)="40///^S X=ARR(44)"
"RTN","OOPSGUID",49,0)
 S DR(1,2264,43)="41///^S X=ARR(45)"
"RTN","OOPSGUID",50,0)
 S DR(1,2264,44)="41.3///^S X=ARR(46)"
"RTN","OOPSGUID",51,0)
 S DR(1,2264,45)="41.6///^S X=ARR(47)"
"RTN","OOPSGUID",52,0)
 S DR(1,2264,46)="42///^S X=ARR(48)"
"RTN","OOPSGUID",53,0)
 S DR(1,2264,47)="43///^S X=ARR(49)"
"RTN","OOPSGUID",54,0)
 S DR(1,2264,48)="44///^S X=ARR(50)"
"RTN","OOPSGUID",55,0)
 S DR(1,2264,49)="45///^S X=ARR(51)"
"RTN","OOPSGUID",56,0)
 S DR(1,2264,50)="46///^S X=ARR(52)"
"RTN","OOPSGUID",57,0)
 S DR(1,2264,51)="47///^S X=ARR(53)"
"RTN","OOPSGUID",58,0)
 S DR(1,2264,52)="48///^S X=ARR(54)"
"RTN","OOPSGUID",59,0)
 S DR(1,2264,53)="49///^S X=ARR(55)"
"RTN","OOPSGUID",60,0)
 S DR(1,2264,54)="50///^S X=ARR(56)"
"RTN","OOPSGUID",61,0)
 S DR(1,2264,55)="51///^S X=ARR(57)"
"RTN","OOPSGUID",62,0)
 D ^DIE
"RTN","OOPSGUID",63,0)
 I '($D(Y)=0) Q
"RTN","OOPSGUID",64,0)
 K DR S DIE="^OOPS(2264,",DA=IEN,DR=""
"RTN","OOPSGUID",65,0)
 S DR(1,2264,56)="52///^S X=ARR(58)"
"RTN","OOPSGUID",66,0)
 S DR(1,2264,57)="53///^S X=ARR(59)"
"RTN","OOPSGUID",67,0)
 S DR(1,2264,58)="54///^S X=ARR(60)"
"RTN","OOPSGUID",68,0)
 S DR(1,2264,59)="56///^S X=ARR(61)"
"RTN","OOPSGUID",69,0)
 S DR(1,2264,60)="57///^S X=ARR(62)"
"RTN","OOPSGUID",70,0)
 S DR(1,2264,61)="58///^S X=ARR(63)"
"RTN","OOPSGUID",71,0)
 S DR(1,2264,62)="59///^S X=ARR(64)"
"RTN","OOPSGUID",72,0)
 S DR(1,2264,63)="60///^S X=ARR(65)"
"RTN","OOPSGUID",73,0)
 S DR(1,2264,64)="62///^S X=ARR(66)"
"RTN","OOPSGUID",74,0)
 S DR(1,2264,65)="63///^S X=ARR(67)"
"RTN","OOPSGUID",75,0)
 S DR(1,2264,66)="64///^S X=ARR(68)"
"RTN","OOPSGUID",76,0)
 S DR(1,2264,67)="65///^S X=ARR(69)"
"RTN","OOPSGUID",77,0)
 S DR(1,2264,68)="67///^S X=ARR(70)"
"RTN","OOPSGUID",78,0)
 S DR(1,2264,69)="68///^S X=ARR(71)"
"RTN","OOPSGUID",79,0)
 S DR(1,2264,70)="69///^S X=ARR(72)"
"RTN","OOPSGUID",80,0)
 S DR(1,2264,71)="70///^S X=ARR(73)"
"RTN","OOPSGUID",81,0)
 S DR(1,2264,72)="71///^S X=ARR(74)"
"RTN","OOPSGUID",82,0)
 S DR(1,2264,73)="72///^S X=ARR(75)"
"RTN","OOPSGUID",83,0)
 S DR(1,2264,74)="73///^S X=ARR(76)"
"RTN","OOPSGUID",84,0)
 S DR(1,2264,75)="74///^S X=ARR(77)"
"RTN","OOPSGUID",85,0)
 S DR(1,2264,76)="75///^S X=ARR(78)"
"RTN","OOPSGUID",86,0)
 S DR(1,2264,77)="76///^S X=ARR(79)"
"RTN","OOPSGUID",87,0)
 S DR(1,2264,78)="78///^S X=ARR(80)"
"RTN","OOPSGUID",88,0)
 S DR(1,2264,79)="79///^S X=ARR(81)"
"RTN","OOPSGUID",89,0)
 S DR(1,2264,80)="80///^S X=ARR(82)"
"RTN","OOPSGUID",90,0)
 S DR(1,2264,81)="81///^S X=ARR(83)"
"RTN","OOPSGUID",91,0)
 S DR(1,2264,82)="82///^S X=ARR(84)"
"RTN","OOPSGUID",92,0)
 S DR(1,2264,83)="83///^S X=ARR(85)"
"RTN","OOPSGUID",93,0)
 S DR(1,2264,84)="84///^S X=ARR(86)"
"RTN","OOPSGUID",94,0)
 S DR(1,2264,85)="85///^S X=ARR(87)"
"RTN","OOPSGUID",95,0)
 S DR(1,2264,86)="86///^S X=ARR(88)"
"RTN","OOPSGUID",96,0)
 S DR(1,2264,87)="87///^S X=ARR(89)"
"RTN","OOPSGUID",97,0)
 S DR(1,2264,88)="88///^S X=ARR(90)"
"RTN","OOPSGUID",98,0)
 S DR(1,2264,89)="89///^S X=ARR(91)"
"RTN","OOPSGUID",99,0)
 S DR(1,2264,90)="90///^S X=ARR(92)"
"RTN","OOPSGUID",100,0)
 S DR(1,2264,91)="91///^S X=ARR(93)"
"RTN","OOPSGUID",101,0)
 S DR(1,2264,92)="92///^S X=ARR(94)"
"RTN","OOPSGUID",102,0)
 S DR(1,2264,93)="93///^S X=ARR(95)"
"RTN","OOPSGUID",103,0)
 S DR(1,2264,94)="94///^S X=ARR(96)"
"RTN","OOPSGUID",104,0)
 ; V2_P15, added new field llh
"RTN","OOPSGUID",105,0)
 S DR(1,2264,95)="98///^S X=ARR(97)"
"RTN","OOPSGUID",106,0)
 D ^DIE
"RTN","OOPSGUID",107,0)
 ;Check the return of ^DIE
"RTN","OOPSGUID",108,0)
 I $D(Y)=0 S RESULTS(1)=IEN_U_ARR(0)_U_"UPDATE COMPLETED"
"RTN","OOPSGUID",109,0)
 Q
"RTN","OOPSGUID",110,0)
NEWCA7 ; need to file the CA7 first, then file the remaining data
"RTN","OOPSGUID",111,0)
 N ACLAIM,CA7,DLAYGO,DR,DIC,I,X
"RTN","OOPSGUID",112,0)
 S CA7=""
"RTN","OOPSGUID",113,0)
 I '$G(ARR(3)) S (RESULTS,RESULTS(1))="No ASISTS IEN, cannot file" Q
"RTN","OOPSGUID",114,0)
 I '$D(^OOPS(2260,ARR(3),0)) D  Q
"RTN","OOPSGUID",115,0)
 . S (RESULTS,RESULTS(1))="ASISTS claim not on file, cannot continue"
"RTN","OOPSGUID",116,0)
 S ACLAIM=$$GET1^DIQ(2260,ARR(3),.01)
"RTN","OOPSGUID",117,0)
 I $G(ACLAIM)="" D  Q
"RTN","OOPSGUID",118,0)
 . S (RESULTS,RESULTS(1))="No ASISTS claim number, cannot continue"
"RTN","OOPSGUID",119,0)
 S ARR(0)=$$CA7NUM()
"RTN","OOPSGUID",120,0)
 I $G(ARR(0))="" D  Q
"RTN","OOPSGUID",121,0)
 . S (RESULTS,RESULTS(1))="Could not build CA7 Number, cannot continue"
"RTN","OOPSGUID",122,0)
 S ARR(1)=$$NOW()
"RTN","OOPSGUID",123,0)
 K DD,DO S DLAYGO=2264,DIC="^OOPS(2264,",DIC(0)="L",X=ARR(0)
"RTN","OOPSGUID",124,0)
 S DIC("DR")=".3////^S X=ARR(1);.5////^S X=DUZ;.7////^S X=ARR(3);.8////^S X=ARR(4);.9////^S X=ARR(5)"
"RTN","OOPSGUID",125,0)
 D FILE^DICN I +Y>0 D
"RTN","OOPSGUID",126,0)
 . S (RESULTS,RESULTS(2))=IEN_U_"CA7 Created"
"RTN","OOPSGUID",127,0)
 . S IEN=+Y
"RTN","OOPSGUID",128,0)
 Q
"RTN","OOPSGUID",129,0)
CA7NUM() ; gets next CA-7 number
"RTN","OOPSGUID",130,0)
 N CASE,NUM,CA7TEST
"RTN","OOPSGUID",131,0)
 S CA7TEST=ACLAIM_"-CA7"
"RTN","OOPSGUID",132,0)
 S CASE="^OOPS(2264,"_"""B"""_","""_CA7TEST_""")"
"RTN","OOPSGUID",133,0)
 F  S CASE=$Q(@CASE) Q:$P(CASE,",",3)'[ACLAIM  S CA7=$P(CASE,",",3)
"RTN","OOPSGUID",134,0)
 S NUM=$P(CA7,"-",4)+1,NUM=$E("000",1,3-$L(NUM))_NUM
"RTN","OOPSGUID",135,0)
 Q $P(CA7TEST,"-",1,3)_"-"_NUM
"RTN","OOPSGUID",136,0)
 ;
"RTN","OOPSGUID",137,0)
NOW() ; returns current date and time
"RTN","OOPSGUID",138,0)
 N %,%I,%H,X
"RTN","OOPSGUID",139,0)
 D NOW^%DTC
"RTN","OOPSGUID",140,0)
 Q %
"RTN","OOPSGUID",141,0)
DUAL(RESULTS,INPUT,DATA) ; new sub for filing DUAL node fields - 
"RTN","OOPSGUID",142,0)
 ;                         need to add parameters back
"RTN","OOPSGUID",143,0)
 ; for the Dual Benefit form answered from the CA1 or CA2
"RTN","OOPSGUID",144,0)
 ;
"RTN","OOPSGUID",145,0)
 ; Input:  INPUT - IEN^FORM; first piece is the record identifier
"RTN","OOPSGUID",146,0)
 ;                           2nd piece is the form, CA1 or CA2
"RTN","OOPSGUID",147,0)
 ;          DATA - data string, p1=fld 303, p2=304, p3=305, p4=306
"RTN","OOPSGUID",148,0)
 ;                 p5=307, p6=308
"RTN","OOPSGUID",149,0)
 ;                 data does not include electronic signature fields
"RTN","OOPSGUID",150,0)
 ;                 for the node 
"RTN","OOPSGUID",151,0)
 ;
"RTN","OOPSGUID",152,0)
 N ARR,CN,DA,DIE,DR,LP,IEN
"RTN","OOPSGUID",153,0)
 S RESULTS="No Changes Filed"
"RTN","OOPSGUID",154,0)
 S IEN=$P($G(INPUT),U)
"RTN","OOPSGUID",155,0)
 I '$G(IEN) S RESULTS="No IEN passed in - save failed" Q
"RTN","OOPSGUID",156,0)
 K DR S DIE="^OOPS(2260,",DA=IEN,DR=""
"RTN","OOPSGUID",157,0)
 I '$L($TR(DATA,"^","")) S RESULTS="No data to save" Q
"RTN","OOPSGUID",158,0)
 F LP=1:1:6 S ARR(LP)=$P($G(DATA),U,LP)
"RTN","OOPSGUID",159,0)
 S DR(1,2260,1)="303///^S X=ARR(1)"
"RTN","OOPSGUID",160,0)
 S DR(1,2260,2)="304///^S X=ARR(2)"
"RTN","OOPSGUID",161,0)
 S DR(1,2260,3)="305///^S X=ARR(3)"
"RTN","OOPSGUID",162,0)
 S DR(1,2260,4)="306///^S X=ARR(4)"
"RTN","OOPSGUID",163,0)
 S DR(1,2260,5)="307///^S X=ARR(5)"
"RTN","OOPSGUID",164,0)
 S DR(1,2260,6)="308///^S X=ARR(6)"
"RTN","OOPSGUID",165,0)
 D ^DIE
"RTN","OOPSGUID",166,0)
 I $D(Y)=0 S RESULTS="UPDATE COMPLETED"
"RTN","OOPSGUID",167,0)
 Q
"RTN","OOPSGUID",168,0)
SAVE2162 ; V2_P15 moved entire SAVE2162 subroutine from OOPSGUI5 to here
"RTN","OOPSGUID",169,0)
 ; due to size of OOPSGUI5
"RTN","OOPSGUID",170,0)
 K DR S DIE="^OOPS(2260,",DA=IEN,DR=""
"RTN","OOPSGUID",171,0)
 S DR(1,2260,1)="3///^S X=ARR(3)"
"RTN","OOPSGUID",172,0)
 S DR(1,2260,2)="5///^S X=ARR(5)"
"RTN","OOPSGUID",173,0)
 S DR(1,2260,3)="6///^S X=ARR(6)"
"RTN","OOPSGUID",174,0)
 S DR(1,2260,4)="7///^S X=ARR(7)"
"RTN","OOPSGUID",175,0)
 S DR(1,2260,5)="8///^S X=ARR(8)"
"RTN","OOPSGUID",176,0)
 S DR(1,2260,7)="9///^S X=ARR(9)"
"RTN","OOPSGUID",177,0)
 S DR(1,2260,9)="10///^S X=ARR(10)"
"RTN","OOPSGUID",178,0)
 S DR(1,2260,12)="11///^S X=ARR(11)"
"RTN","OOPSGUID",179,0)
 S DR(1,2260,15)="12///^S X=ARR(12)"
"RTN","OOPSGUID",180,0)
 S DR(1,2260,18)="13////^S X=ARR(13)"
"RTN","OOPSGUID",181,0)
 S DR(1,2260,21)="14///^S X=ARR(14)"
"RTN","OOPSGUID",182,0)
 S DR(1,2260,24)="15///^S X=ARR(15)"
"RTN","OOPSGUID",183,0)
 S DR(1,2260,27)="16///^S X=ARR(16)"
"RTN","OOPSGUID",184,0)
 S DR(1,2260,30)="17///^S X=ARR(17)"
"RTN","OOPSGUID",185,0)
 S DR(1,2260,33)="18///^S X=ARR(18)"
"RTN","OOPSGUID",186,0)
 S DR(1,2260,36)="26///^S X=ARR(19)"
"RTN","OOPSGUID",187,0)
 S DR(1,2260,39)="27////^S X=ARR(20)"
"RTN","OOPSGUID",188,0)
 S DR(1,2260,42)="29///^S X=ARR(21)"
"RTN","OOPSGUID",189,0)
 S DR(1,2260,45)="29.5///^S X=ARR(22)"
"RTN","OOPSGUID",190,0)
 S DR(1,2260,48)="30///^S X=ARR(23)"
"RTN","OOPSGUID",191,0)
 S DR(1,2260,51)="30.1///^S X=ARR(24)"
"RTN","OOPSGUID",192,0)
 S DR(1,2260,54)="31///^S X=ARR(25)"
"RTN","OOPSGUID",193,0)
 S DR(1,2260,57)="32///^S X=ARR(26)"
"RTN","OOPSGUID",194,0)
 S DR(1,2260,60)="33///^S X=ARR(27)"
"RTN","OOPSGUID",195,0)
 S DR(1,2260,63)="34///^S X=ARR(28)"
"RTN","OOPSGUID",196,0)
 S DR(1,2260,66)="35///^S X=ARR(29)"
"RTN","OOPSGUID",197,0)
 S DR(1,2260,69)="36///^S X=ARR(30)"
"RTN","OOPSGUID",198,0)
 S DR(1,2260,72)="37///^S X=ARR(31)"
"RTN","OOPSGUID",199,0)
 S DR(1,2260,75)="38///^S X=ARR(32)"
"RTN","OOPSGUID",200,0)
 S DR(1,2260,78)="41///^S X=ARR(33)"
"RTN","OOPSGUID",201,0)
 S DR(1,2260,81)="42///^S X=ARR(34)"
"RTN","OOPSGUID",202,0)
 S DR(1,2260,84)="42.5///^S X=ARR(35)"
"RTN","OOPSGUID",203,0)
 S DR(1,2260,87)="43///^S X=ARR(36)"
"RTN","OOPSGUID",204,0)
 S DR(1,2260,90)="53////^S X=ARR(45)"
"RTN","OOPSGUID",205,0)
 S DR(1,2260,93)="53.1////^S X=ARR(46)"
"RTN","OOPSGUID",206,0)
 S DR(1,2260,96)="60///^S X=ARR(52)"
"RTN","OOPSGUID",207,0)
 S DR(1,2260,99)="61///^S X=ARR(53)"
"RTN","OOPSGUID",208,0)
 S DR(1,2260,102)="62///^S X=ARR(54)"
"RTN","OOPSGUID",209,0)
 S DR(1,2260,105)="63///^S X=ARR(55)"
"RTN","OOPSGUID",210,0)
 S DR(1,2260,108)="70///^S X=ARR(60)"
"RTN","OOPSGUID",211,0)
 S DR(1,2260,111)="73///^S X=ARR(63)"
"RTN","OOPSGUID",212,0)
 S DR(1,2260,114)="82///^S X=ARR(72)"
"RTN","OOPSGUID",213,0)
 S DR(1,2260,117)="83////^S X=ARR(73)"
"RTN","OOPSGUID",214,0)
 S DR(1,2260,120)="84///^S X=ARR(74)"
"RTN","OOPSGUID",215,0)
 S DR(1,2260,123)="85///^S X=ARR(75)"
"RTN","OOPSGUID",216,0)
 S DR(1,2260,126)="86///^S X=ARR(76)"
"RTN","OOPSGUID",217,0)
 S DR(1,2260,129)="87///^S X=ARR(77)"
"RTN","OOPSGUID",218,0)
 S DR(1,2260,132)="88///^S X=ARR(78)"
"RTN","OOPSGUID",219,0)
 S DR(1,2260,135)="89///^S X=ARR(79)"
"RTN","OOPSGUID",220,0)
 S DR(1,2260,136)="335///^S X=ARR(85)"
"RTN","OOPSGUID",221,0)
 S DR(1,2260,138)="336///^S X=ARR(86)"
"RTN","OOPSGUID",222,0)
 S DR(1,2260,140)="337///^S X=ARR(87)"
"RTN","OOPSGUID",223,0)
 D ^DIE I '($D(Y)=0) Q
"RTN","OOPSGUID",224,0)
 S DR(1,2260,142)="338///^S X=ARR(88)"
"RTN","OOPSGUID",225,0)
 S DR(1,2260,144)="339///^S X=ARR(89)"
"RTN","OOPSGUID",226,0)
 S DR(1,2260,146)="340///^S X=ARR(90)"
"RTN","OOPSGUID",227,0)
 S DR(1,2260,148)="341///^S X=ARR(91)"
"RTN","OOPSGUID",228,0)
 S DR(1,2260,150)="342///^S X=ARR(92)"
"RTN","OOPSGUID",229,0)
 S DR(1,2260,152)="343///^S X=ARR(93)"
"RTN","OOPSGUID",230,0)
 S DR(1,2260,154)="344///^S X=ARR(94)"
"RTN","OOPSGUID",231,0)
 S DR(1,2260,156)="345///^S X=ARR(95)"
"RTN","OOPSGUID",232,0)
 S DR(1,2260,158)="346///^S X=ARR(96)"
"RTN","OOPSGUID",233,0)
 S DR(1,2260,159)="334///^S X=ARR(97)"
"RTN","OOPSGUID",234,0)
 S DR(1,2260,160)="348///^S X=ARR(98)"
"RTN","OOPSGUID",235,0)
 S DR(1,2260,161)="349///^S X=ARR(99)"
"RTN","OOPSGUID",236,0)
 S DR(1,2260,162)="350///^S X=ARR(100)"
"RTN","OOPSGUID",237,0)
 S DR(1,2260,163)="351///^S X=ARR(101)"
"RTN","OOPSGUID",238,0)
 S DR(1,2260,164)="352///^S X=ARR(102)"
"RTN","OOPSGUID",239,0)
 ; V2_P15 new fields
"RTN","OOPSGUID",240,0)
 S DR(1,2260,165)="354///^S X=ARR(103)"
"RTN","OOPSGUID",241,0)
 S DR(1,2260,166)="355///^S X=ARR(104)"
"RTN","OOPSGUID",242,0)
 S DR(1,2260,167)="356///^S X=ARR(105)"
"RTN","OOPSGUID",243,0)
 S DR(1,2260,168)="357///^S X=ARR(106)"
"RTN","OOPSGUID",244,0)
 S DR(1,2260,169)="358///^S X=ARR(107)"
"RTN","OOPSGUID",245,0)
 S DR(1,2260,170)="359///^S X=ARR(108)"
"RTN","OOPSGUID",246,0)
 ; v2_P20 new field for Column F on the OSHA 300 log
"RTN","OOPSGUID",247,0)
 S DR(1,2260,171)="384///^S X=ARR(109)"
"RTN","OOPSGUID",248,0)
 D ^DIE I $D(Y)=0 S RESULTS(1)="UPDATE COMPLETED"
"RTN","OOPSGUID",249,0)
 ; V2_15 send new bulletin if the INITIAL RETURN TO WORK STATUS is one of 2 values below
"RTN","OOPSGUID",250,0)
 I ARR(102)="DAYS AWAY WORK"!(ARR(102)="Job Transfer/Restriction") D CIO^OOPSMBUL(IEN)
"RTN","OOPSGUID",251,0)
 Q
"RTN","OOPSGUIR")
0^3^B70518771^B67711787
"RTN","OOPSGUIR",1,0)
OOPSGUIR ;WIOFO/LLH-RPC routine for misc reports ; 6/11/09 10:32am
"RTN","OOPSGUIR",2,0)
 ;;2.0;ASISTS;**8,7,11,14,20**;Jun 03, 2002;Build 2
"RTN","OOPSGUIR",3,0)
 ;
"RTN","OOPSGUIR",4,0)
ENT(RESULTS,INPUT,CALL) ; get the data for the report
"RTN","OOPSGUIR",5,0)
 ;   Input:  INPUT - contains 3 values, the START AND END DATE, 
"RTN","OOPSGUIR",6,0)
 ;                   STATION. The Date of Occ (fld #4) is used to 
"RTN","OOPSGUIR",7,0)
 ;                   in/exclude claims from the report. If Station='ALL'
"RTN","OOPSGUIR",8,0)
 ;                   then all claims are included, if not 'All', then
"RTN","OOPSGUIR",9,0)
 ;                   only 1 station is included.
"RTN","OOPSGUIR",10,0)
 ;            CALL - contains the report call which will invoke
"RTN","OOPSGUIR",11,0)
 ;                   the appropriate M call 
"RTN","OOPSGUIR",12,0)
 ; Output: RESULTS - the results array passes data back to the client.
"RTN","OOPSGUIR",13,0)
 N CAX,FI,LP,MENU,SDATE,STDT,STA,STATION,ENDDT,EDATE,TAG,X,Y,%DT
"RTN","OOPSGUIR",14,0)
 S RESULTS(0)="Processing..."
"RTN","OOPSGUIR",15,0)
 S STDT=$P($G(INPUT),U),ENDDT=$P($G(INPUT),U,2)
"RTN","OOPSGUIR",16,0)
 S STA=$P($G(INPUT),U,3),TAG=CALL
"RTN","OOPSGUIR",17,0)
 I (STDT="")!(ENDDT="")!(STA="")!(TAG="") D  Q
"RTN","OOPSGUIR",18,0)
 . S RESULTS(0)="Input parameters missing, cannot run report." Q
"RTN","OOPSGUIR",19,0)
 K ^TMP($J,TAG)
"RTN","OOPSGUIR",20,0)
 S (SDATE,EDATE,MENU)=""
"RTN","OOPSGUIR",21,0)
 S X=STDT D ^%DT S SDATE=Y
"RTN","OOPSGUIR",22,0)
 S X=ENDDT D ^%DT S EDATE=Y
"RTN","OOPSGUIR",23,0)
 ; SDATE made last time in day prior so start date correct
"RTN","OOPSGUIR",24,0)
 I TAG="LOG300U" S TAG="LOG300",MENU="U"
"RTN","OOPSGUIR",25,0)
 S SDATE=(SDATE-1)+.9999,EDATE=EDATE_".9999"
"RTN","OOPSGUIR",26,0)
 D @TAG
"RTN","OOPSGUIR",27,0)
 Q
"RTN","OOPSGUIR",28,0)
SERVICE ; Service/Detail Location report - patch 11
"RTN","OOPSGUIR",29,0)
DSPUTE ; Reason for Dispute report. Patch 11
"RTN","OOPSGUIR",30,0)
FLD174 ; Report compiles filing instruction result counts
"RTN","OOPSGUIR",31,0)
FLD332 ; Use this tag for Reason for Controvert report. Patch 11
"RTN","OOPSGUIR",32,0)
 N ARR,CODE,CN,LP,IEN,I,GOON,P2,TX
"RTN","OOPSGUIR",33,0)
 S LP="",IEN="",CN=0
"RTN","OOPSGUIR",34,0)
 I TAG="FLD174" D
"RTN","OOPSGUIR",35,0)
 .S CODE=$P($G(^DD(2260,174,0)),U,3)
"RTN","OOPSGUIR",36,0)
 .F I=1:1 S LP=$P(CODE,";",I) Q:$G(LP)=""  I $P(LP,":",2)'="" S ARR(LP)=0
"RTN","OOPSGUIR",37,0)
 .S ARR(I_":No Data Entered")=0
"RTN","OOPSGUIR",38,0)
 I TAG="FLD332" D
"RTN","OOPSGUIR",39,0)
 .F I=1:1 Q:'$D(^OOPS(2262.4,I))  S ARR(I_":"_$P(^OOPS(2262.4,I,0),U))=0
"RTN","OOPSGUIR",40,0)
 .S ARR(98_":Blk 36 also has text entered")=0
"RTN","OOPSGUIR",41,0)
 .S ARR(99_":Controvert question checked Yes, but no Controvert Code entered")=0
"RTN","OOPSGUIR",42,0)
 F LP=SDATE:0 S LP=$O(^OOPS(2260,"AD",LP)) Q:(LP'>0)!(LP>EDATE)  D
"RTN","OOPSGUIR",43,0)
 .F  S IEN=$O(^OOPS(2260,"AD",LP,IEN)) Q:IEN'>0  D
"RTN","OOPSGUIR",44,0)
 ..I $$GET1^DIQ(2260,IEN,51,"I")>1 Q      ;only allow open/closed cases
"RTN","OOPSGUIR",45,0)
 ..S CAX=$$GET1^DIQ(2260,IEN,52,"I")
"RTN","OOPSGUIR",46,0)
 ..I TAG'="SERVICE"&(CAX=2) Q                       ;only allow CA1's
"RTN","OOPSGUIR",47,0)
 ..S STATION=$P(^OOPS(2260,IEN,"2162A"),U,9)
"RTN","OOPSGUIR",48,0)
 ..I ($G(STA)'="A"),(STATION'=STA) Q        ;get correct station
"RTN","OOPSGUIR",49,0)
 ..;patch 11 - sent to OOPSGUIF due to size this routine
"RTN","OOPSGUIR",50,0)
 ..I TAG="DSPUTE" D DSPUTE^OOPSGUIF
"RTN","OOPSGUIR",51,0)
 ..I TAG="SERVICE" D SERVICE^OOPSGUIU
"RTN","OOPSGUIR",52,0)
 ..; Filing instructions report
"RTN","OOPSGUIR",53,0)
 ..I TAG="FLD174" D
"RTN","OOPSGUIR",54,0)
 ...S FI=$$GET1^DIQ(2260,IEN,174,"I")_":"_$$GET1^DIQ(2260,IEN,174)
"RTN","OOPSGUIR",55,0)
 ...I $$GET1^DIQ(2260,IEN,174)="" S FI=I_":No Data Entered"
"RTN","OOPSGUIR",56,0)
 ...S ARR(FI)=ARR(FI)+1
"RTN","OOPSGUIR",57,0)
 ...;patch 11 - Reason for controvert report
"RTN","OOPSGUIR",58,0)
 ..I TAG="FLD332" D
"RTN","OOPSGUIR",59,0)
 ...;first Agency Controvert must = "Y" to be counted
"RTN","OOPSGUIR",60,0)
 ...S GOON=$$GET1^DIQ(2260,IEN,165.1,"I") I $G(GOON)'="Y" D  Q
"RTN","OOPSGUIR",61,0)
 ....S:'$D(ARR("999:Case not controverted, no controvert code expected")) ARR("999:Case not controverted, no controvert code expected")=0
"RTN","OOPSGUIR",62,0)
 ....S ARR("999:Case not controverted, no controvert code expected")=ARR("999:Case not controverted, no controvert code expected")+1
"RTN","OOPSGUIR",63,0)
 ...S FI=$$GET1^DIQ(2260,IEN,332,"I")_":"_$$GET1^DIQ(2260,IEN,332)
"RTN","OOPSGUIR",64,0)
 ...I $$GET1^DIQ(2260,IEN,332)="" S FI=99_":Controvert question checked Yes, but no Controvert Code entered"
"RTN","OOPSGUIR",65,0)
 ...S ARR(FI)=ARR(FI)+1
"RTN","OOPSGUIR",66,0)
 ...I $G(^OOPS(2260,IEN,"CA1K",1,0))'="" D
"RTN","OOPSGUIR",67,0)
 ....;if case is diputed, don't count in Controvert rpt - quit
"RTN","OOPSGUIR",68,0)
 ....S GOON=$$GET1^DIQ(2260,IEN,165.2,"I") I $G(GOON)="Y" Q
"RTN","OOPSGUIR",69,0)
 ....S ARR(98_":Blk 36 also has text entered")=ARR(98_":Blk 36 also has text entered")+1
"RTN","OOPSGUIR",70,0)
 I TAG'="DSPUTE",(TAG'="SERVICE") D
"RTN","OOPSGUIR",71,0)
 .S CN=0,FI="",P2=""
"RTN","OOPSGUIR",72,0)
 .F  S FI=$O(ARR(FI)) Q:FI=""  D
"RTN","OOPSGUIR",73,0)
 ..S CN=$P(FI,":"),P2=$P(FI,":",2),CODE=0
"RTN","OOPSGUIR",74,0)
 ..I TAG="FLD332" S TX=$O(^OOPS(2262.4,"B",P2,"")) I $G(TX) S CODE=$P(^OOPS(2262.4,TX,0),U,2)
"RTN","OOPSGUIR",75,0)
 ..S ^TMP($J,TAG,CN)=P2_U_CODE_U_ARR(FI)
"RTN","OOPSGUIR",76,0)
 ..; rearrange 'bogus' Controvert Codes for report formating
"RTN","OOPSGUIR",77,0)
 ..I TAG="FLD332",(CN>97) S ^TMP($J,TAG,CN)=U_P2_U_ARR(FI)
"RTN","OOPSGUIR",78,0)
 I TAG="SERVICE" D CMPLSRV^OOPSGUIU
"RTN","OOPSGUIR",79,0)
 I TAG="DSPUTE" D DSPUTE^OOPSGUIU
"RTN","OOPSGUIR",80,0)
 S RESULTS=$NA(^TMP($J,TAG))
"RTN","OOPSGUIR",81,0)
 Q
"RTN","OOPSGUIR",82,0)
SUM300A ; Summary of Work-related injuries and illness report
"RTN","OOPSGUIR",83,0)
 N CN,EMP,FAC,HRS,STATE,STR
"RTN","OOPSGUIR",84,0)
 N COLG,COLH,COLI,COLJ,COLK,COLL,COLM
"RTN","OOPSGUIR",85,0)
 S (COLG,COLH,COLI,COLJ,COLK,COLL)=0
"RTN","OOPSGUIR",86,0)
 S (COLM(1),COLM(2),COLM(3),COLM(4),COLM(5),COLM(6))=0
"RTN","OOPSGUIR",87,0)
 S ^TMP($J,TAG,0)="No worksheet data for this station."
"RTN","OOPSGUIR",88,0)
 S FAC=$$GET1^DIQ(4,STA,.01,"E")
"RTN","OOPSGUIR",89,0)
 K ARR D STATINFO^OOPSGUI3(.ARR,STA) I $D(ARR) D
"RTN","OOPSGUIR",90,0)
 .S STATE=$P($G(ARR(0)),U,3)
"RTN","OOPSGUIR",91,0)
 .I $G(STATE)'="" D
"RTN","OOPSGUIR",92,0)
 ..S STATE=$O(^DIC(5,"B",STATE,""))
"RTN","OOPSGUIR",93,0)
 ..S $P(ARR(0),U,3)=$P(^DIC(5,STATE,0),U,2)
"RTN","OOPSGUIR",94,0)
 .S ^TMP($J,TAG,0)=FAC_U_ARR(0)
"RTN","OOPSGUIR",95,0)
 K ARR D SITEPGET^OOPSGUI6(.ARR,"OSHA300") I $D(ARR) D 
"RTN","OOPSGUIR",96,0)
 .S CN=0 F  S CN=$O(ARR(CN)) Q:CN=""  D
"RTN","OOPSGUIR",97,0)
 ..I $P(ARR(CN),U,11)'=STA Q
"RTN","OOPSGUIR",98,0)
 ..S STR=$P($P(ARR(CN),U,1)," = ",2)
"RTN","OOPSGUIR",99,0)
 ..S STR=$P(ARR(CN),U,3)_U_$P(ARR(CN),U,4)_U_$P(ARR(CN),U,6)_U
"RTN","OOPSGUIR",100,0)
 ..S STR=STR_$P(ARR(CN),U,7)_U_$P(ARR(CN),U,8)
"RTN","OOPSGUIR",101,0)
 ..S ^TMP($J,TAG,0)=^TMP($J,TAG,0)_U_STR
"RTN","OOPSGUIR",102,0)
 K ARR,DATA S DATA=""
"RTN","OOPSGUIR",103,0)
 D EMPHRS,DETAIL
"RTN","OOPSGUIR",104,0)
 Q
"RTN","OOPSGUIR",105,0)
IRWSHT ; Incidence Rates Worksheet Report
"RTN","OOPSGUIR",106,0)
 N COLHI,EMP,HRS
"RTN","OOPSGUIR",107,0)
 S ^TMP($J,TAG,1)="No Worksheet Data for this Station"
"RTN","OOPSGUIR",108,0)
 S COLHI=0
"RTN","OOPSGUIR",109,0)
 K ARR,DATA S DATA=""
"RTN","OOPSGUIR",110,0)
 D EMPHRS,DETAIL
"RTN","OOPSGUIR",111,0)
 Q
"RTN","OOPSGUIR",112,0)
DETAIL ; now get employee information
"RTN","OOPSGUIR",113,0)
LOG300 ; entry point for the OSHA 300 LOG
"RTN","OOPSGUIR",114,0)
 N CN,CASES,COLF,DOI,FLD,IEN,INC,STATION,TYPE
"RTN","OOPSGUIR",115,0)
 S DOI=SDATE,CASES=0,CN=1
"RTN","OOPSGUIR",116,0)
 F  S DOI=$O(^OOPS(2260,"AF",DOI)) Q:(DOI>EDATE)!(DOI="")  S IEN=0 D
"RTN","OOPSGUIR",117,0)
 .F  S IEN=$O(^OOPS(2260,"AF",DOI,"Y",IEN)) Q:IEN=""  D
"RTN","OOPSGUIR",118,0)
 ..S STATION=$P(^OOPS(2260,IEN,"2162A"),U,9) I $G(STATION)'=STA Q
"RTN","OOPSGUIR",119,0)
 ..I $P(^OOPS(2260,IEN,0),U,6)>1 Q
"RTN","OOPSGUIR",120,0)
 ..S CASES=CASES+1
"RTN","OOPSGUIR",121,0)
 ..I TAG="IRWSHT" D
"RTN","OOPSGUIR",122,0)
 ...I $D(^OOPS(2260,IEN,"OUTC","AC","A","J"))!$D(^OOPS(2260,IEN,"OUTC","AC","A","A")) S COLHI=COLHI+1
"RTN","OOPSGUIR",123,0)
 ..I TAG="SUM300A" D FLD95
"RTN","OOPSGUIR",124,0)
 ..I TAG="LOG300" D FLD95 D
"RTN","OOPSGUIR",125,0)
 ...S ARR(1)=$$GET1^DIQ(2260,IEN,.01),ARR(2)=$$GET1^DIQ(2260,IEN,1)
"RTN","OOPSGUIR",126,0)
 ...I $$GET1^DIQ(2260,IEN,337,"I")="Y" S ARR(2)="Privacy Case"
"RTN","OOPSGUIR",127,0)
 ...S TYPE=$$GET1^DIQ(2260,IEN,3,"I")
"RTN","OOPSGUIR",128,0)
 ...I TYPE>10&(TYPE<15) S ARR(2)="Privacy Case"
"RTN","OOPSGUIR",129,0)
 ...I MENU="U" S ARR(2)=""
"RTN","OOPSGUIR",130,0)
 ...S INC=$$GET1^DIQ(2260,IEN,52,"I"),FLD=$S(INC=1:111,INC=2:208,1:"")
"RTN","OOPSGUIR",131,0)
 ...S ARR(3)=$$GET1^DIQ(2260,IEN,FLD)
"RTN","OOPSGUIR",132,0)
 ...S ARR(4)=$P($$FMTE^XLFDT(($$GET1^DIQ(2260,IEN,4,"I")),2),"@")
"RTN","OOPSGUIR",133,0)
 ...S ARR(5)=$$GET1^DIQ(2260,IEN,27,"E")
"RTN","OOPSGUIR",134,0)
 ...;v2_P20 changed field to populate ARR(6) - Coluum F OSHA 300 log
"RTN","OOPSGUIR",135,0)
 ...S COLF=$$GET1^DIQ(2260,IEN,384),ARR(6)=COLF
"RTN","OOPSGUIR",136,0)
 ...I (SDATE<3081231.9999&(EDATE>3081231.9999)) S ARR(6)=COLF
"RTN","OOPSGUIR",137,0)
 ...I EDATE<3090101&(COLF="") S ARR(6)=$$GET1^DIQ(2260,IEN,3)_";"_$$GET1^DIQ(2260,IEN,30)
"RTN","OOPSGUIR",138,0)
 ...S DATA=ARR(1)_U_ARR(2)_U_ARR(3)_U_ARR(4)_U_ARR(5)_U_ARR(6)_U_ARR(7)_U
"RTN","OOPSGUIR",139,0)
 ...S DATA=DATA_ARR(8)_U_ARR(9)_U_ARR(10)
"RTN","OOPSGUIR",140,0)
 ...S ^TMP($J,TAG,CN)=DATA,CN=CN+1
"RTN","OOPSGUIR",141,0)
 I TAG="IRWSHT" S ^TMP($J,TAG,1)=CASES_U_COLHI_U_HRS
"RTN","OOPSGUIR",142,0)
 I TAG="SUM300A" D
"RTN","OOPSGUIR",143,0)
 .S DATA=CASES_U_EMP_U_HRS_U_COLG_U_COLH_U_COLI_U_COLJ_U_COLK_U_COLL_U
"RTN","OOPSGUIR",144,0)
 .S DATA=DATA_COLM(1)_U_COLM(2)_U_COLM(3)_U_COLM(4)_U_COLM(5)_U_COLM(6)
"RTN","OOPSGUIR",145,0)
 .S ^TMP($J,TAG,1)=DATA
"RTN","OOPSGUIR",146,0)
 S RESULTS=$NA(^TMP($J,TAG))
"RTN","OOPSGUIR",147,0)
 K ARR,DATA
"RTN","OOPSGUIR",148,0)
 Q
"RTN","OOPSGUIR",149,0)
FLD95 ; use OUTC subrecord to retrieve data
"RTN","OOPSGUIR",150,0)
 N AVAIL,ED,SD,S0,INC,ILL,DAYA,DAYJ,DAYS,IEN95,OC,OUTC,S95,TDAY
"RTN","OOPSGUIR",151,0)
 S S0=$G(^OOPS(2260,IEN,0)),INC=$P(S0,U,7)
"RTN","OOPSGUIR",152,0)
 S ILL=$P($G(^OOPS(2260,IEN,"2162B")),U,15)
"RTN","OOPSGUIR",153,0)
 S TDAY=$$HTFM^XLFDT(+$H)
"RTN","OOPSGUIR",154,0)
 ; add days away & job transfer up only to 180 for log, 4 300A get all
"RTN","OOPSGUIR",155,0)
 S (DAYA,DAYJ,TAWAY)=0,IEN95=0
"RTN","OOPSGUIR",156,0)
 F  S IEN95=$O(^OOPS(2260,IEN,"OUTC",IEN95)) Q:IEN95'>0  D
"RTN","OOPSGUIR",157,0)
 .S S95=$G(^OOPS(2260,IEN,"OUTC",IEN95,0))
"RTN","OOPSGUIR",158,0)
 .S SD=$P(S95,U,1),ED=$P(S95,U,2),OC=$P(S95,U,3),DAYS=0
"RTN","OOPSGUIR",159,0)
 .I $P(S95,U,11)="D" Q      ; entry is deleted
"RTN","OOPSGUIR",160,0)
 .;patch 11 - added logic that if TAG=LOG300 include all incident days
"RTN","OOPSGUIR",161,0)
 .;           up to 180, else 300A, only include date range incidents
"RTN","OOPSGUIR",162,0)
 .I (TAG="SUM300A"),(EDATE<SD) Q
"RTN","OOPSGUIR",163,0)
 .I $G(OC)'="" S OUTC(OC)=""
"RTN","OOPSGUIR",164,0)
 .I TAG="SUM300A" D
"RTN","OOPSGUIR",165,0)
 ..I $G(ED)=""!($G(ED)>EDATE) S DAYS=$$FMDIFF^XLFDT(EDATE,SD,1)+1
"RTN","OOPSGUIR",166,0)
 .I TAG="LOG300",($G(ED)="") S DAYS=$$FMDIFF^XLFDT(TDAY,SD,1)+1
"RTN","OOPSGUIR",167,0)
 .I '$G(DAYS) S DAYS=$S(OC="A":$P(S95,U,4),OC="J":$P(S95,U,5),1:0)
"RTN","OOPSGUIR",168,0)
 .I DAYA+DAYJ>179 Q
"RTN","OOPSGUIR",169,0)
 .S AVAIL=0
"RTN","OOPSGUIR",170,0)
 .I DAYS>179 S AVAIL=(180-(DAYA+DAYJ))
"RTN","OOPSGUIR",171,0)
 .I (DAYS<180) D
"RTN","OOPSGUIR",172,0)
 ..I (DAYS+DAYA+DAYJ)<180 S AVAIL=DAYS
"RTN","OOPSGUIR",173,0)
 ..I (DAYS+DAYA+DAYJ)>180 S AVAIL=(180-(DAYA+DAYJ))
"RTN","OOPSGUIR",174,0)
 .I $G(OC)="A" S DAYA=DAYA+AVAIL
"RTN","OOPSGUIR",175,0)
 .I $G(OC)="J" S DAYJ=DAYJ+AVAIL
"RTN","OOPSGUIR",176,0)
 I TAG="SUM300A" D
"RTN","OOPSGUIR",177,0)
 .S:$G(INC)=1 COLM(1)=COLM(1)+1
"RTN","OOPSGUIR",178,0)
 .I INC=2 D
"RTN","OOPSGUIR",179,0)
 ..I $G(ILL) S COLM(ILL)=COLM(ILL)+1
"RTN","OOPSGUIR",180,0)
 ..I '$G(ILL) S COLM(6)=COLM(6)+1
"RTN","OOPSGUIR",181,0)
 .S COLK=COLK+DAYA,COLL=COLL+DAYJ
"RTN","OOPSGUIR",182,0)
 .I $D(OUTC("D")) S COLG=COLG+1 Q
"RTN","OOPSGUIR",183,0)
 .I $D(OUTC("A")) S COLH=COLH+1 Q
"RTN","OOPSGUIR",184,0)
 .I $D(OUTC("J")) S COLI=COLI+1 Q
"RTN","OOPSGUIR",185,0)
 .I $D(OUTC("O")) S COLJ=COLJ+1 Q
"RTN","OOPSGUIR",186,0)
 I TAG="LOG300" D
"RTN","OOPSGUIR",187,0)
 .S ARR(7)="",ARR(10)="",(ARR(8),ARR(9))=0
"RTN","OOPSGUIR",188,0)
 .I INC=1 S ARR(10)=1
"RTN","OOPSGUIR",189,0)
 .I INC=2 S:$G(ILL) ARR(10)=ILL S:'$G(ILL) ARR(10)=6
"RTN","OOPSGUIR",190,0)
 .S ARR(8)=DAYA,ARR(9)=DAYJ
"RTN","OOPSGUIR",191,0)
 .I $D(OUTC("D")) S ARR(7)="D" S (ARR(8),ARR(9))=0 Q
"RTN","OOPSGUIR",192,0)
 .I $D(OUTC("A")) S ARR(7)="A" Q
"RTN","OOPSGUIR",193,0)
 .I $D(OUTC("J")) S ARR(7)="J" Q
"RTN","OOPSGUIR",194,0)
 .I $D(OUTC("O")) S ARR(7)="O" Q
"RTN","OOPSGUIR",195,0)
 Q
"RTN","OOPSGUIR",196,0)
EMPHRS ; get Total Num Employees and Hours worked
"RTN","OOPSGUIR",197,0)
 N CASES,ED,LV1,LV2,MON,OK,PAR,SD,SIEN,STR,WS,X,X1,X2
"RTN","OOPSGUIR",198,0)
 S (EMP,HRS,WS)=0
"RTN","OOPSGUIR",199,0)
 S PAR="^OOPS(2262,0)",PAR=$Q(@PAR),PAR=$Q(@PAR)
"RTN","OOPSGUIR",200,0)
 S LV1=$P(PAR,",",2),LV2=$P(PAR,",",3)
"RTN","OOPSGUIR",201,0)
 S SIEN=$O(^OOPS(2262,LV1,LV2,"B",STA,-1)) Q:SIEN=""
"RTN","OOPSGUIR",202,0)
 ; get month range to make sure all emp numbers and hours are entered
"RTN","OOPSGUIR",203,0)
 S SDATE=SDATE\1
"RTN","OOPSGUIR",204,0)
 S SD=$E(SDATE,1,5)_"00"_$E(SDATE,8,$L(SDATE))
"RTN","OOPSGUIR",205,0)
 S ED=$E(EDATE,1,5)_"00"_$E(EDATE,8,$L(EDATE))
"RTN","OOPSGUIR",206,0)
 S X1=$E(ED,1,3),X2=$E(SD,1,3)
"RTN","OOPSGUIR",207,0)
 I X1>X2 D
"RTN","OOPSGUIR",208,0)
 .S OK=0,X=(X1-X2) S:X>1 OK=(X-1)*12
"RTN","OOPSGUIR",209,0)
 .S OK=OK+((12-$E(SD,4,5))+1)+$E(ED,4,5)
"RTN","OOPSGUIR",210,0)
 I X1=X2 S OK=($E(ED,4,5)-$E(SD,4,5))+1
"RTN","OOPSGUIR",211,0)
 S MON=OK
"RTN","OOPSGUIR",212,0)
 F  S WS=$O(^OOPS(2262,LV1,LV2,SIEN,2,WS)) Q:(WS'>0)  D
"RTN","OOPSGUIR",213,0)
 .S STR=^OOPS(2262,LV1,LV2,SIEN,2,WS,0)
"RTN","OOPSGUIR",214,0)
 .I ($P(STR,U)'<SD)&($P(STR,U)'>ED) D
"RTN","OOPSGUIR",215,0)
 ..I ($P(STR,U,2)="")!($P(STR,U,3)="") Q
"RTN","OOPSGUIR",216,0)
 ..S EMP=EMP+$P(STR,U,2),HRS=HRS+$P(STR,U,3),OK=OK-1
"RTN","OOPSGUIR",217,0)
 I '$G(OK) S EMP=EMP/MON
"RTN","OOPSGUIR",218,0)
 I $G(OK) S (EMP,HRS)="INCOMPLETE DATA"
"RTN","OOPSGUIR",219,0)
 Q
"VER")
8.0^22.0
"^DD",2260,2260,384,0)
OSHA 300 COLUMN F^F^^2162R;1^K:$L(X)>100!($L(X)<3) X
"^DD",2260,2260,384,3)
Answer must be 3-100 characters in length.
"^DD",2260,2260,384,21,0)
^.001^2^2^3090609^^
"^DD",2260,2260,384,21,1,0)
This field will contain a brief description of the incident that will
"^DD",2260,2260,384,21,2,0)
be used to populate column F of the OSHA 300 Log report.
"^DD",2260,2260,384,"DT")
3090601
"BLD",8100,6)
^19
**END**
**END**
