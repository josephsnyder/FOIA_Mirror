Released PRS*4*117 SEQ #106
Extracted from mail message
**KIDS**:PRS*4.0*117^

**INSTALL NAME**
PRS*4.0*117
"BLD",7507,0)
PRS*4.0*117^PAID^0^3080825^y
"BLD",7507,4,0)
^9.64PA^^0
"BLD",7507,6.3)
32
"BLD",7507,"ABPKG")
n
"BLD",7507,"KRN",0)
^9.67PA^8989.52^19
"BLD",7507,"KRN",.4,0)
.4
"BLD",7507,"KRN",.401,0)
.401
"BLD",7507,"KRN",.402,0)
.402
"BLD",7507,"KRN",.403,0)
.403
"BLD",7507,"KRN",.403,"NM",0)
^9.68A^^0
"BLD",7507,"KRN",.5,0)
.5
"BLD",7507,"KRN",.84,0)
.84
"BLD",7507,"KRN",3.6,0)
3.6
"BLD",7507,"KRN",3.8,0)
3.8
"BLD",7507,"KRN",9.2,0)
9.2
"BLD",7507,"KRN",9.8,0)
9.8
"BLD",7507,"KRN",9.8,"NM",0)
^9.68A^113^25
"BLD",7507,"KRN",9.8,"NM",2,0)
PRS8AC^^0^B65735984
"BLD",7507,"KRN",9.8,"NM",3,0)
PRS8CR^^0^B10991558
"BLD",7507,"KRN",9.8,"NM",6,0)
PRS8EX^^0^B44421441
"BLD",7507,"KRN",9.8,"NM",9,0)
PRS8HR^^0^B28258360
"BLD",7507,"KRN",9.8,"NM",10,0)
PRS8HROT^^0^B2971143
"BLD",7507,"KRN",9.8,"NM",16,0)
PRS8MT^^0^B47758629
"BLD",7507,"KRN",9.8,"NM",19,0)
PRS8OTFF^^0^B12892610
"BLD",7507,"KRN",9.8,"NM",20,0)
PRS8PP^^0^B69982353
"BLD",7507,"KRN",9.8,"NM",22,0)
PRS8ST^^0^B44078747
"BLD",7507,"KRN",9.8,"NM",28,0)
PRS8VW^^0^B16147800
"BLD",7507,"KRN",9.8,"NM",30,0)
PRS8VW2^^0^B25129714
"BLD",7507,"KRN",9.8,"NM",32,0)
PRS8WE^^0^B43083909
"BLD",7507,"KRN",9.8,"NM",63,0)
PRS8UP^^0^B37177110
"BLD",7507,"KRN",9.8,"NM",92,0)
PRS8OC^^0^B43576335
"BLD",7507,"KRN",9.8,"NM",99,0)
PRSROT11^^0^B16245069
"BLD",7507,"KRN",9.8,"NM",101,0)
PRS8MISC^^0^B19788515
"BLD",7507,"KRN",9.8,"NM",102,0)
PRSA8BNI^^0^B31924622
"BLD",7507,"KRN",9.8,"NM",103,0)
PRSA8BTH^^0^B19035559
"BLD",7507,"KRN",9.8,"NM",104,0)
PRSATE^^0^B81195394
"BLD",7507,"KRN",9.8,"NM",105,0)
PRSATE0^^0^B16488191
"BLD",7507,"KRN",9.8,"NM",109,0)
PRSATE4^^0^B6816347
"BLD",7507,"KRN",9.8,"NM",110,0)
PRSATE5^^0^B25791034
"BLD",7507,"KRN",9.8,"NM",111,0)
PRSATPP^^0^B14151243
"BLD",7507,"KRN",9.8,"NM",112,0)
PRSATPE^^0^B68629448
"BLD",7507,"KRN",9.8,"NM",113,0)
PRSASR^^0^B51691703
"BLD",7507,"KRN",9.8,"NM","B","PRS8AC",2)

"BLD",7507,"KRN",9.8,"NM","B","PRS8CR",3)

"BLD",7507,"KRN",9.8,"NM","B","PRS8EX",6)

"BLD",7507,"KRN",9.8,"NM","B","PRS8HR",9)

"BLD",7507,"KRN",9.8,"NM","B","PRS8HROT",10)

"BLD",7507,"KRN",9.8,"NM","B","PRS8MISC",101)

"BLD",7507,"KRN",9.8,"NM","B","PRS8MT",16)

"BLD",7507,"KRN",9.8,"NM","B","PRS8OC",92)

"BLD",7507,"KRN",9.8,"NM","B","PRS8OTFF",19)

"BLD",7507,"KRN",9.8,"NM","B","PRS8PP",20)

"BLD",7507,"KRN",9.8,"NM","B","PRS8ST",22)

"BLD",7507,"KRN",9.8,"NM","B","PRS8UP",63)

"BLD",7507,"KRN",9.8,"NM","B","PRS8VW",28)

"BLD",7507,"KRN",9.8,"NM","B","PRS8VW2",30)

"BLD",7507,"KRN",9.8,"NM","B","PRS8WE",32)

"BLD",7507,"KRN",9.8,"NM","B","PRSA8BNI",102)

"BLD",7507,"KRN",9.8,"NM","B","PRSA8BTH",103)

"BLD",7507,"KRN",9.8,"NM","B","PRSASR",113)

"BLD",7507,"KRN",9.8,"NM","B","PRSATE",104)

"BLD",7507,"KRN",9.8,"NM","B","PRSATE0",105)

"BLD",7507,"KRN",9.8,"NM","B","PRSATE4",109)

"BLD",7507,"KRN",9.8,"NM","B","PRSATE5",110)

"BLD",7507,"KRN",9.8,"NM","B","PRSATPE",112)

"BLD",7507,"KRN",9.8,"NM","B","PRSATPP",111)

"BLD",7507,"KRN",9.8,"NM","B","PRSROT11",99)

"BLD",7507,"KRN",19,0)
19
"BLD",7507,"KRN",19,"NM",0)
^9.68A^20^7
"BLD",7507,"KRN",19,"NM",14,0)
PRSRFI EMP TOUR HR DISP^^0
"BLD",7507,"KRN",19,"NM",15,0)
PRSRSU EMP TOUR HR DISP^^0
"BLD",7507,"KRN",19,"NM",16,0)
PRSRTK EMP TOUR HR DISP^^0
"BLD",7507,"KRN",19,"NM",17,0)
PRSRFI-PAID SYSTEM REPORTS^^2
"BLD",7507,"KRN",19,"NM",18,0)
PRSA TK MEN-EMP^^2
"BLD",7507,"KRN",19,"NM",19,0)
PRSRSU-PAID SYSTEM REPORTS^^2
"BLD",7507,"KRN",19,"NM",20,0)
PRSA TK TOUR-EDIT^^0
"BLD",7507,"KRN",19,"NM","B","PRSA TK MEN-EMP",18)

"BLD",7507,"KRN",19,"NM","B","PRSA TK TOUR-EDIT",20)

"BLD",7507,"KRN",19,"NM","B","PRSRFI EMP TOUR HR DISP",14)

"BLD",7507,"KRN",19,"NM","B","PRSRFI-PAID SYSTEM REPORTS",17)

"BLD",7507,"KRN",19,"NM","B","PRSRSU EMP TOUR HR DISP",15)

"BLD",7507,"KRN",19,"NM","B","PRSRSU-PAID SYSTEM REPORTS",19)

"BLD",7507,"KRN",19,"NM","B","PRSRTK EMP TOUR HR DISP",16)

"BLD",7507,"KRN",19.1,0)
19.1
"BLD",7507,"KRN",101,0)
101
"BLD",7507,"KRN",409.61,0)
409.61
"BLD",7507,"KRN",771,0)
771
"BLD",7507,"KRN",870,0)
870
"BLD",7507,"KRN",8989.51,0)
8989.51
"BLD",7507,"KRN",8989.52,0)
8989.52
"BLD",7507,"KRN",8994,0)
8994
"BLD",7507,"KRN","B",.4,.4)

"BLD",7507,"KRN","B",.401,.401)

"BLD",7507,"KRN","B",.402,.402)

"BLD",7507,"KRN","B",.403,.403)

"BLD",7507,"KRN","B",.5,.5)

"BLD",7507,"KRN","B",.84,.84)

"BLD",7507,"KRN","B",3.6,3.6)

"BLD",7507,"KRN","B",3.8,3.8)

"BLD",7507,"KRN","B",9.2,9.2)

"BLD",7507,"KRN","B",9.8,9.8)

"BLD",7507,"KRN","B",19,19)

"BLD",7507,"KRN","B",19.1,19.1)

"BLD",7507,"KRN","B",101,101)

"BLD",7507,"KRN","B",409.61,409.61)

"BLD",7507,"KRN","B",771,771)

"BLD",7507,"KRN","B",870,870)

"BLD",7507,"KRN","B",8989.51,8989.51)

"BLD",7507,"KRN","B",8989.52,8989.52)

"BLD",7507,"KRN","B",8994,8994)

"BLD",7507,"QDEF")
^^^^^^^^^^YES
"BLD",7507,"QUES",0)
^9.62^^
"BLD",7507,"REQB",0)
^9.611^3^2
"BLD",7507,"REQB",2,0)
PRS*4.0*116^1
"BLD",7507,"REQB",3,0)
PRS*4.0*114^1
"BLD",7507,"REQB","B","PRS*4.0*114",3)

"BLD",7507,"REQB","B","PRS*4.0*116",2)

"KRN",19,5868,-1)
0^20
"KRN",19,5868,0)
PRSA TK TOUR-EDIT^Enter/Edit Employee Tour of Duty^^R^^^^^^^^
"KRN",19,5868,1,0)
^^8^8^3080821^
"KRN",19,5868,1,1,0)
This option allows the user to enter or edit a Tour of Duty for an
"KRN",19,5868,1,2,0)
employee for this pay period, the last one, or the next.  Various warnings
"KRN",19,5868,1,3,0)
are provided if there are problems identified with the tour.  If tour
"KRN",19,5868,1,4,0)
overlaps exist (e.g. Sat 11:30PM-8:00AM and Sun MID-8:30AM), then the tour
"KRN",19,5868,1,5,0)
can not be saved.  When editing the "Next" pay period tour or creating a
"KRN",19,5868,1,6,0)
"Permanent" tour, no overlap can exist between day 1 and day 14.  The user
"KRN",19,5868,1,7,0)
must wait until the next pay period is opened or select "Temporary" to
"KRN",19,5868,1,8,0)
create this type of tour.
"KRN",19,5868,25)
PRSATE
"KRN",19,5868,99)
55223,59683
"KRN",19,5868,"U")
ENTER/EDIT EMPLOYEE TOUR OF DU
"KRN",19,5908,-1)
2^18
"KRN",19,5908,0)
PRSA TK MEN-EMP^Employee Data^^M^100831^^^^^^^
"KRN",19,5908,10,0)
^19.01IP^15^15
"KRN",19,5908,10,11,0)
5868^4
"KRN",19,5908,10,11,"^")
PRSA TK TOUR-EDIT
"KRN",19,5908,10,15,0)
13174^10
"KRN",19,5908,10,15,"^")
PRSRTK EMP TOUR HR DISP
"KRN",19,5908,"U")
EMPLOYEE DATA
"KRN",19,5990,-1)
2^19
"KRN",19,5990,0)
PRSRSU-PAID SYSTEM REPORTS^Employee Reports^^M^100831^^^^^^^408
"KRN",19,5990,10,0)
^19.01IP^8^8
"KRN",19,5990,10,8,0)
13173^8
"KRN",19,5990,10,8,"^")
PRSRSU EMP TOUR HR DISP
"KRN",19,5990,"U")
EMPLOYEE REPORTS
"KRN",19,6004,-1)
2^17
"KRN",19,6004,0)
PRSRFI-PAID SYSTEM REPORTS^Employee Reports^^M^100831^^^^^^^408
"KRN",19,6004,10,0)
^19.01IP^8^8
"KRN",19,6004,10,8,0)
13172^8
"KRN",19,6004,10,8,"^")
PRSRFI EMP TOUR HR DISP
"KRN",19,6004,"U")
EMPLOYEE REPORTS
"KRN",19,13172,-1)
0^14
"KRN",19,13172,0)
PRSRFI EMP TOUR HR DISP^Display Employee Tour Hours^^R^^^^^^^^
"KRN",19,13172,1,0)
^19.06^4^4^3080709^^^
"KRN",19,13172,1,1,0)
This option allows payroll to view any employee's tour of duty number, 
"KRN",19,13172,1,2,0)
tour of duty hours, tour hours on each day and 8B normal hours. The Tour
"KRN",19,13172,1,3,0)
Hours column contains a total of any tour hours that fall on that day.  
"KRN",19,13172,1,4,0)
So, two day tours will contribute hours to both days on which they fall.
"KRN",19,13172,25)
TOURHRP^PRSA8BTH
"KRN",19,13172,"U")
DISPLAY EMPLOYEE TOUR HOURS
"KRN",19,13173,-1)
0^15
"KRN",19,13173,0)
PRSRSU EMP TOUR HR DISP^Display Employee Tour Hours^^R^^^^^^^^
"KRN",19,13173,1,0)
^19.06^5^5^3080709^^^
"KRN",19,13173,1,1,0)
This option allows T&A supervisors to view employee's tour of duty number,
"KRN",19,13173,1,2,0)
tour of duty hours, tour hours on each day and 8B normal hours for a
"KRN",19,13173,1,3,0)
selected pay period within the T&L units assigned to them. The Tour Hours
"KRN",19,13173,1,4,0)
column contains a total of any tour hours that fall on that day.  So, two
"KRN",19,13173,1,5,0)
day tours will contribute hours to both days on which they fall.
"KRN",19,13173,25)
TOURHRS^PRSA8BTH
"KRN",19,13173,"U")
DISPLAY EMPLOYEE TOUR HOURS
"KRN",19,13174,-1)
0^16
"KRN",19,13174,0)
PRSRTK EMP TOUR HR DISP^Display Employee Tour Hours^^R^^^^^^^^
"KRN",19,13174,1,0)
^19.06^5^5^3080709^^
"KRN",19,13174,1,1,0)
This option allows timekeepers to view employee's tour of duty number,
"KRN",19,13174,1,2,0)
tour of duty hours, tour hours on each day and 8B normal hours for a
"KRN",19,13174,1,3,0)
selected pay period within the T&L units assigned to them. The Tour Hours
"KRN",19,13174,1,4,0)
column contains a total of any tour hours that fall on that day.  So, two
"KRN",19,13174,1,5,0)
day tours will contribute hours to both days on which they fall.
"KRN",19,13174,25)
TOURHRT^PRSA8BTH
"KRN",19,13174,"U")
DISPLAY EMPLOYEE TOUR HOURS
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",408,-1)
1^1
"PKG",408,0)
PAID^PRS^PAID
"PKG",408,20,0)
^9.402P^^
"PKG",408,22,0)
^9.49I^1^1
"PKG",408,22,1,0)
4.0^2950912^2960130
"PKG",408,22,1,"PAH",1,0)
117^3080825^13198
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
25
"RTN","PRS8AC")
0^2^B65735984^B64260454
"RTN","PRS8AC",1,0)
PRS8AC ;HISC/MRL-DECOMPOSITION, ACTIVITY STRING ;03/26/08
"RTN","PRS8AC",2,0)
 ;;4.0;PAID;**40,45,54,52,69,75,90,96,112,117**;Sep 21, 1995;Build 32
"RTN","PRS8AC",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRS8AC",4,0)
 ;
"RTN","PRS8AC",5,0)
 ;The primary purpose of this routine is to create the activity
"RTN","PRS8AC",6,0)
 ;string [the "W" node] for each day of activity.  While creating
"RTN","PRS8AC",7,0)
 ;this string certain counts will also be tallied.  These include
"RTN","PRS8AC",8,0)
 ;Standby, On-Call and the various absence categories.  Actual
"RTN","PRS8AC",9,0)
 ;Call Back hrs are also counted in this routine for the purpose
"RTN","PRS8AC",10,0)
 ;of reducing the OC later on in the process.
"RTN","PRS8AC",11,0)
 ;
"RTN","PRS8AC",12,0)
 ;Called by Routines:  PRS8EX, PRS8ST.
"RTN","PRS8AC",13,0)
 ;
"RTN","PRS8AC",14,0)
 Q:VAR=""
"RTN","PRS8AC",15,0)
 I $S($P(V,"^",1)="":1,$P(V,"^",2)="":1,1:0) Q  ;no times
"RTN","PRS8AC",16,0)
 S Q=0
"RTN","PRS8AC",17,0)
 I DY>0,DY<15 D  G END:Q
"RTN","PRS8AC",18,0)
 .I DAY(DY,"OFF"),"LSWARUHFGDrZq"[VAR S Q=1 ;exc invalid day off VAR
"RTN","PRS8AC",19,0)
 K OC,FLAG
"RTN","PRS8AC",20,0)
 ;
"RTN","PRS8AC",21,0)
 S DAYZ=DAY(DY,"W")_$G(DAY(DY,"N")),MTM=0
"RTN","PRS8AC",22,0)
 S DAYH=$G(DAY(DY,"HOL"))_$G(DAY(DY+1,"HOL")) ;holiday node
"RTN","PRS8AC",23,0)
 N DAYR
"RTN","PRS8AC",24,0)
 S DAYR=DAY(DY,"r")_$G(DAY(DY,"rN")) ; Recess
"RTN","PRS8AC",25,0)
 ;
"RTN","PRS8AC",26,0)
 ;P 45 FIREFIGHTERS F NODE TO TRACK ADDITIONAL FF HRS
"RTN","PRS8AC",27,0)
 S DAYF=$G(DAY(DY,"F"))
"RTN","PRS8AC",28,0)
 ;
"RTN","PRS8AC",29,0)
 F T=+V:1:+$P(V,"^",2) D
"RTN","PRS8AC",30,0)
 .I +VAR,$E(DAYH,T),$E(DAYZ,T)?1A Q  ;no override holiday
"RTN","PRS8AC",31,0)
 .; Don't override Recess but allow Unscheduled Regular (VAR=4)
"RTN","PRS8AC",32,0)
 .I +VAR,VAR'=4,$E(DAYR,T)="r" Q  ; don't override Recess
"RTN","PRS8AC",33,0)
 .I VAR="A"&(JURY=1) S VAR="J"
"RTN","PRS8AC",34,0)
 .S VAR1=VAR Q:VAR1=""  S DAYZ(1)=$E(DAYZ,T)
"RTN","PRS8AC",35,0)
 .I "HhJLSARWMNUnVXYTFGDZq"[VAR1,$E(DAYZ,T)="m" Q
"RTN","PRS8AC",36,0)
 .I T=+V,"12345E"[VAR1 S DAY(DY,"DWK")=1 ;count days worked
"RTN","PRS8AC",37,0)
 .I T=+V,"Vh"[VAR1,TYP["I" S DAY(DY,"DWK")=1 ;count days worked for cop
"RTN","PRS8AC",38,0)
 .I "JLSWNnARUXYFGDZq"[VAR1,T'>96,'$E(DAYZ,T) Q  ;invalid outside tour
"RTN","PRS8AC",39,0)
 .; Regular employees can't earn ct/use ot during work
"RTN","PRS8AC",40,0)
 .I +NAWS'=9,"EOPQT4"[VAR1,T'>96,$E(DAYZ,T) Q
"RTN","PRS8AC",41,0)
 .; 9mo AWS checks
"RTN","PRS8AC",42,0)
 .I +NAWS=9,"PQT"[VAR1,T'>96,$E(DAYZ,T) Q  ;can't earn ct/use ot during work
"RTN","PRS8AC",43,0)
 .; Allow CT/OT/UN/ON if posted over Recess otherwise don't allow
"RTN","PRS8AC",44,0)
 .I +NAWS=9,"4OECQ"[VAR1,T'>96,$E(DAYZ,T),$E(DAYR,T)'="r" S $E(DAYR,T)=VAR1 Q
"RTN","PRS8AC",45,0)
 .I "OE"[VAR1,"BC"[DAYZ(1),$L(DAYZ(1)) D  ; Change OT or CT to CB/SB OT
"RTN","PRS8AC",46,0)
 ..S VAR1=$C($A($E(DAYZ,T))+32)
"RTN","PRS8AC",47,0)
 ..I $E(DAYZ,T)="C",VAR="E" S VAR1="t" ; Comp time on on-call = "t"
"RTN","PRS8AC",48,0)
 .I "BC"[VAR1,DAYZ(1)="O",$L(DAYZ(1)) D  ; Change CB/SB to CB/SB OT
"RTN","PRS8AC",49,0)
 ..S VAR1=$C($A($E(VAR1))+32)
"RTN","PRS8AC",50,0)
 .I "Hh"[VAR1 D  Q:VAR1="H"
"RTN","PRS8AC",51,0)
 ..S DAYH=$E(DAYH,0,T-1)_$S(VAR1="H":1,$E(DAYZ,T)&($E(DAYZ,T)'=4)!(TYP["I")!(TYP["P"&(TYP["N"!(TYP["H")))!(VAR1="h"):2,1:0)_$E(DAYH,T+1,999) ;holiday node
"RTN","PRS8AC",52,0)
 ..I VAR1="h" S VAR1="O" ;convert HW to OT
"RTN","PRS8AC",53,0)
 ..I VAR="h",$E(DAYZ,T)=5 S FLAG=5
"RTN","PRS8AC",54,0)
 .I $E(DAYZ,T)=5,"ALSRUFGDZq"[VAR1 S VAR1=$E(DAYZ,T)
"RTN","PRS8AC",55,0)
 .I $E(DAYZ,T)="-","BbCctes"[VAR1 Q  ;unavail for oc/sb or sch ot/ct
"RTN","PRS8AC",56,0)
 .;
"RTN","PRS8AC",57,0)
 .I VAR'="r" D
"RTN","PRS8AC",58,0)
 ..S DAYZ=$E(DAYZ,0,T-1)_VAR1_$E(DAYZ,T+1,999)
"RTN","PRS8AC",59,0)
 ..I $E($G(DAY(DY-1,"N")),T)'="",VAR1'=$E($G(DAY(DY-1,"N")),T) D
"RTN","PRS8AC",60,0)
 ...S DAY(DY-1,"N")=$E(DAY(DY-1,"N"),0,T-1)_VAR1_$E(DAY(DY-1,"N"),T+1,999) ;save VAR
"RTN","PRS8AC",61,0)
 ..; When processing tour time also copy tour into DAYR
"RTN","PRS8AC",62,0)
 ..I "1235"[VAR1 D
"RTN","PRS8AC",63,0)
 ...S DAYR=$E(DAYZ,0,T-1)_VAR1_$E(DAYZ,T+1,999)
"RTN","PRS8AC",64,0)
 ...I $E($G(DAY(DY-1,"N")),T)'="",VAR1'=$E($G(DAY(DY-1,"N")),T) D
"RTN","PRS8AC",65,0)
 ....S DAY(DY-1,"rN")=$E(DAY(DY-1,"rN"),0,T-1)_VAR1_$E(DAY(DY-1,"rN"),T+1,999)
"RTN","PRS8AC",66,0)
 .;
"RTN","PRS8AC",67,0)
 .; The following check will record Recess and will then update VAR1 to 0 which
"RTN","PRS8AC",68,0)
 .; will result in the normally scheduled tour being marked as being no tour.
"RTN","PRS8AC",69,0)
 .; This will allow Unscheduled Regular, OT and CT to be posted over the tour.
"RTN","PRS8AC",70,0)
 .I VAR="r" D
"RTN","PRS8AC",71,0)
 ..S DAYR=$E(DAYR,0,T-1)_VAR1_$E(DAYR,T+1,999)
"RTN","PRS8AC",72,0)
 ..S DAYZ=$E(DAYZ,0,T-1)_0_$E(DAYZ,T+1,999) ; Overwrite tour
"RTN","PRS8AC",73,0)
 ..I $E($G(DAY(DY-1,"rN")),T)'="",VAR1'=$E($G(DAY(DY-1,"rN")),T) D
"RTN","PRS8AC",74,0)
 ...S DAY(DY-1,"rN")=$E(DAY(DY-1,"rN"),0,T-1)_VAR1_$E(DAY(DY-1,"rN"),T+1,999)
"RTN","PRS8AC",75,0)
 ...S DAY(DY-1,"N")=$E(DAY(DY-1,"N"),0,T-1)_0_$E(DAY(DY-1,"N"),T+1,999)
"RTN","PRS8AC",76,0)
 ..S Y=48 D SET ; Count Recess
"RTN","PRS8AC",77,0)
 .;
"RTN","PRS8AC",78,0)
 .I VAR1="J" S Y=5 D SET ;set authorized absence for jury duty
"RTN","PRS8AC",79,0)
 .I VAR1="M" S Y=5 D SET ; authorized absence for ML
"RTN","PRS8AC",80,0)
 .;ot on non-premium T&L
"RTN","PRS8AC",81,0)
 .I ("Eocb"[VAR1!(VAR1="O"&'$E(DAYH,T)))&("^^10^11^12^13^15^16^17^"[("^"_$P(V,"^",4)_"^"))!(VAR1=5&("ALSRUFGDZq"[VAR))!(VAR1=4&(TYP["P"!(TYP["I"&(TYP["N"!(TYP["H"!($$HYBRID^PRSAENT1($G(DFN)))))))&("^7^9^11^12^14^17^"[("^"_$P(V,"^",4)_"^"))) D
"RTN","PRS8AC",82,0)
 ..Q:$E(DAY(DY,"P"),T)=5&("ALSRUFGDZq"'[VAR)
"RTN","PRS8AC",83,0)
 ..I $D(FLAG) S FLAG=VAR1,VAR1=5
"RTN","PRS8AC",84,0)
 ..N CODE D
"RTN","PRS8AC",85,0)
 ...I "^7^8^12^"[("^"_$P(V,"^",4)_"^")&(TYP["N"!(TYP["H")!($$HYBRID^PRSAENT1($G(DFN)))) S CODE="N" Q
"RTN","PRS8AC",86,0)
 ...I "^7^8^12^"[("^"_$P(V,"^",4)_"^")&(PMP'="")&("^S^T^U^V^"[(U_PMP_U)) S CODE="N" Q
"RTN","PRS8AC",87,0)
 ...I $P(V,"^",4)=11,($$HYBRID^PRSAENT1($G(DFN))) S CODE="N" Q
"RTN","PRS8AC",88,0)
 ...I $P(V,"^",4)=11&(PMP'="")&("^S^T^U^V^"[(U_PMP_U)) S CODE="N" Q
"RTN","PRS8AC",89,0)
 ...I "^7^8^9^11^"[("^"_$P(V,"^",4)_"^")&(TYP'["N")&(TYP'["H")&('$$HYBRID^PRSAENT1($G(DFN))) S CODE="n" Q
"RTN","PRS8AC",90,0)
 ...I "^7^8^9^11^"[("^"_$P(V,"^",4)_"^")&("^S^T^U^V^"'[(U_PMP_U)) S CODE="n" Q
"RTN","PRS8AC",91,0)
 ...I $P(V,"^",4)=17 S CODE="N" Q  ; Code 17 - OT/CT with premiums 
"RTN","PRS8AC",92,0)
 ...I VAR1=5 S CODE=VAR Q
"RTN","PRS8AC",93,0)
 ...S CODE=1
"RTN","PRS8AC",94,0)
 ..S DAY(DY,"P")=$E(DAY(DY,"P"),0,T-1)_CODE_$E(DAY(DY,"P"),T+1,999)
"RTN","PRS8AC",95,0)
 .I "ALSRUFGDZq"[VAR,VAR1=5 S VAR1=VAR
"RTN","PRS8AC",96,0)
 .I $D(FLAG) S VAR1=FLAG K FLAG
"RTN","PRS8AC",97,0)
 .;
"RTN","PRS8AC",98,0)
FOPTHR .; part time hrs (PT/PH 8b codes) for CODE O firefighters
"RTN","PRS8AC",99,0)
 .I +VAR1,"Ff"[TYP,PMP="O",(NH=448!(NH>320&(NH(1)'=NH(2)))) S Y=32 D SET
"RTN","PRS8AC",100,0)
 .;
"RTN","PRS8AC",101,0)
FRCPTHR .; part time hrs (PT/PH 8b codes) for code R & C firefighters
"RTN","PRS8AC",102,0)
 .; don't include UNSCHEDULED REGULAR (var1=4)
"RTN","PRS8AC",103,0)
 .I +VAR1,VAR1'=4,"Ff"[TYP,"RC"[PMP S Y=32 D SET
"RTN","PRS8AC",104,0)
 .;
"RTN","PRS8AC",105,0)
 .;patch 45 & 54
"RTN","PRS8AC",106,0)
 .; Set non pay hrs in the basic tour for firefighters with premium
"RTN","PRS8AC",107,0)
 .;pay indicator of C.
"RTN","PRS8AC",108,0)
 .I "nW"[VAR1,"Ff"[TYP,"C"=PMP D
"RTN","PRS8AC",109,0)
 ..;
"RTN","PRS8AC",110,0)
 ..;  Y designates location in WK array where NT/NH will be stored.
"RTN","PRS8AC",111,0)
 ..;  F node was set to 1 for periods of addtl ff hrs during 1st pass 
"RTN","PRS8AC",112,0)
 ..;  thru scheduled ToD.  Count NT/NH if this is not addtl ff hrs.
"RTN","PRS8AC",113,0)
 ..;
"RTN","PRS8AC",114,0)
 ..I '$E(DAY(DY,"F"),T) S Y=47 D SET
"RTN","PRS8AC",115,0)
 .S S="LSWnAREUP HYXOVQTFGDZq" I S[VAR1&(DY>0&(DY<15)!(DY=0&(T>96))) D  ;save in WK array
"RTN","PRS8AC",116,0)
 ..S S(1)=$F(S,VAR1)-1
"RTN","PRS8AC",117,0)
 ..S S=$P("1^2^3^4^5^6^0^8^0^9^24^42^43^0^33^54^19^44^45^46^53^55","^",S(1)) ;WK location
"RTN","PRS8AC",118,0)
 ..Q:S=0
"RTN","PRS8AC",119,0)
 ..; Patch *40 removed A (authorized absence) from leave counted in LU.
"RTN","PRS8AC",120,0)
 ..; LU is only used to determine if night differential granted for
"RTN","PRS8AC",121,0)
 ..; leave should be backed out.
"RTN","PRS8AC",122,0)
 ..I TYP'["D","LSRUFGDZq"[VAR1 S LU=LU+1 ;increment leave counter
"RTN","PRS8AC",123,0)
 ..; p117 decrement total leave count for leave outside of pp
"RTN","PRS8AC",124,0)
 ..I TYP'["D","LSRUFGDZq"[VAR1,((DY=0)&(T<97))!((DY=14)&(T>96)),LU>0 S LU=LU-1
"RTN","PRS8AC",125,0)
 ..S Y=S D SET S:TYP["D" Q=1
"RTN","PRS8AC",126,0)
 ..K S,VAR1
"RTN","PRS8AC",127,0)
 ;
"RTN","PRS8AC",128,0)
 S DAY(DY,"W")=$E(DAYZ,1,96) ;todays activity
"RTN","PRS8AC",129,0)
 S DAY(DY,"N")=$E(DAYZ,97,999) ;tomorrows activity from today/if any
"RTN","PRS8AC",130,0)
 S DAY(DY,"r")=$E(DAYR,1,96) ; Today's Recess
"RTN","PRS8AC",131,0)
 S DAY(DY,"rN")=$E(DAYR,97,999) ; Tomorrow's Recess/if any
"RTN","PRS8AC",132,0)
 S:$E(DAY(DY,"P"),97,999)'="" DAY(DY,"P1")=$E(DAY(DY,"P"),97,999) ;non-prem ot for next day
"RTN","PRS8AC",133,0)
 S DAY(DY,"P")=$E(DAY(DY,"P"),1,96) ;non-prem ot for today
"RTN","PRS8AC",134,0)
 I DAY(DY,"N")?1"0"."0",DAY(DY,"rN")'["r" S DAY(DY,"N")=""
"RTN","PRS8AC",135,0)
 S DAY(DY,"HOL")=$E(DAYH,1,96)
"RTN","PRS8AC",136,0)
 ;
"RTN","PRS8AC",137,0)
 ;P 45 FIREFIGHTER ADDITIONAL FIREFIGHTER HRS NODE FOR THIS DAY
"RTN","PRS8AC",138,0)
 I $G(PRS8AFFH) D
"RTN","PRS8AC",139,0)
 .  N PRSFFHR,PRSF1,PRSF2,PRSF3,SEG1,SEG2
"RTN","PRS8AC",140,0)
 .;
"RTN","PRS8AC",141,0)
 .;GET THE POSITIONAL START AND STOPS FOR THIS SEGMENT
"RTN","PRS8AC",142,0)
 .  S SEG1=$P(V,U,1),SEG2=$P(V,U,2)
"RTN","PRS8AC",143,0)
 .;EXISTING PORTION OF F NODE UP TO CURRENT SEGMENT
"RTN","PRS8AC",144,0)
 .  S PRSF1=$E(DAYF,1,SEG1-1)
"RTN","PRS8AC",145,0)
 .;CURRENT SEGMENT UP TO END OF DAY
"RTN","PRS8AC",146,0)
 .  S PRSF2=$E(DAYZ,SEG1,SEG2)
"RTN","PRS8AC",147,0)
 .;CURRENT F NODE PAST CURRENT SEGMENT TO END OF THE TOUR WHICH
"RTN","PRS8AC",148,0)
 .;MAY FALL IN TODAY OR NEXT DAY.
"RTN","PRS8AC",149,0)
 .S PRSF3=$E(DAYF,SEG2+1,999)
"RTN","PRS8AC",150,0)
 .;
"RTN","PRS8AC",151,0)
 .;UPDATE THE DAY ARRAY AND THE TMP GLOBAL WITH WORK STRING.
"RTN","PRS8AC",152,0)
 .;EACH CHAR THAT IS SET TO 1 REPRESENTS A 15 MIN SEGMENT THAT
"RTN","PRS8AC",153,0)
 .;THE FIREFIGHTER WAS SCHEDULED FOR ADDITIONAL FF HRS.
"RTN","PRS8AC",154,0)
 .;FOR TOURS CROSSING MIDNIGHT THIS STRING WILL BE LONGER THAN 96
"RTN","PRS8AC",155,0)
 .;CHARACTERS. CHARACTERS IN POSITIONS PAST 96 REPRESENT TIMES PAST
"RTN","PRS8AC",156,0)
 .;MIDNIGHT OF THE CURRENT DAY (TOMORROW).
"RTN","PRS8AC",157,0)
 .S PRSFFHR=PRSF1_PRSF2_PRSF3
"RTN","PRS8AC",158,0)
 .S DAY(DY,"F")=PRSFFHR
"RTN","PRS8AC",159,0)
 .S ^TMP($J,"PRS8",DY,"F")=PRSFFHR
"RTN","PRS8AC",160,0)
 ;
"RTN","PRS8AC",161,0)
 I DY<15 S X=$E(DAYH,97,999) I X'?."0" S ^TMP($J,"PRS8",DY+1,"HOL")=X_$E($G(^TMP($J,"PRS8",DY+1,"HOL")),$L(X)+1,999),DAY(DY+1,"HOL")=X
"RTN","PRS8AC",162,0)
 ;
"RTN","PRS8AC",163,0)
MOVE ; --- entry point for just moving previous days hrs to today
"RTN","PRS8AC",164,0)
 I $D(DAY(DY-1,"N")),$L(DAY(DY-1,"N")) D
"RTN","PRS8AC",165,0)
 .S X=DAY(DY-1,"N")_$E(DAY(DY,"W"),$L(DAY(DY-1,"N"))+1,96)
"RTN","PRS8AC",166,0)
 .S DAY(DY,"W")=X
"RTN","PRS8AC",167,0)
 I $D(DAY(DY-1,"P1")),$L(DAY(DY-1,"P1")) D
"RTN","PRS8AC",168,0)
 .S X=DAY(DY-1,"P1")_$E(DAY(DY,"P"),$L(DAY(DY-1,"P1"))+1,96)
"RTN","PRS8AC",169,0)
 .S DAY(DY,"P")=X
"RTN","PRS8AC",170,0)
 I $D(DAY(DY-1,"rN")),$L(DAY(DY-1,"rN")) D
"RTN","PRS8AC",171,0)
 .S X=DAY(DY-1,"rN")_$E(DAY(DY,"r"),$L(DAY(DY-1,"rN"))+1,96)
"RTN","PRS8AC",172,0)
 .S DAY(DY,"r")=X
"RTN","PRS8AC",173,0)
 ;
"RTN","PRS8AC",174,0)
END ; --- all done here
"RTN","PRS8AC",175,0)
 K CNT,OC,Q,S,SB,SL,SLP,T,VAR1,X,Y Q
"RTN","PRS8AC",176,0)
 ;
"RTN","PRS8AC",177,0)
SET ; --- set WK variable
"RTN","PRS8AC",178,0)
 I (DY=0&(T<97))!(DY=14&(T>96))!(DY>14) Q
"RTN","PRS8AC",179,0)
 S ZZ=WK,WK=$S(DY>7:2,1:1)
"RTN","PRS8AC",180,0)
 I TYP'["D",DY=7,T>96 S WK=2
"RTN","PRS8AC",181,0)
 S $P(WK(WK),"^",Y)=$P(WK(WK),"^",Y)+1
"RTN","PRS8AC",182,0)
 ;
"RTN","PRS8AC",183,0)
 ; The passing of Public Law 106-554 allows taking ML in hours.
"RTN","PRS8AC",184,0)
 ; ML will now be recorded in 15 minute segments in the WK(3) array
"RTN","PRS8AC",185,0)
 ; for employees entitled to take ML in hours.  PRS*4.0*69
"RTN","PRS8AC",186,0)
 ;
"RTN","PRS8AC",187,0)
 I VAR1="M",$$MLINHRS^PRSAENT(DFN) D
"RTN","PRS8AC",188,0)
 . S WK=3,Y=11
"RTN","PRS8AC",189,0)
 . S $P(WK(WK),"^",Y)=$P(WK(WK),"^",Y)+1
"RTN","PRS8AC",190,0)
 ;
"RTN","PRS8AC",191,0)
 ; IF a part-time employee and they have either LWOP or Non-Pay
"RTN","PRS8AC",192,0)
 ; THEN decrement total hours for the week and the pay period.
"RTN","PRS8AC",193,0)
 ; PRS*4.0*52.
"RTN","PRS8AC",194,0)
 ;
"RTN","PRS8AC",195,0)
 I "Wn"[VAR1,TYP["P" S TH=TH-1,TH(WK)=TH(WK)-1
"RTN","PRS8AC",196,0)
 S WK=ZZ Q
"RTN","PRS8CR")
0^3^B10991558^B10818384
"RTN","PRS8CR",1,0)
PRS8CR ;HISC/MRL-DECOMPOSITION, CREATE STRING ;01/17/07
"RTN","PRS8CR",2,0)
 ;;4.0;PAID;**2,6,45,69,112,117**;Sep 21, 1995;Build 32
"RTN","PRS8CR",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRS8CR",4,0)
 ;
"RTN","PRS8CR",5,0)
 ;This routine take the information contained in the WK array
"RTN","PRS8CR",6,0)
 ;and creates the activity string to be passed to Austin.  The
"RTN","PRS8CR",7,0)
 ;WK(1) node contains those items pertaining to Week 1 activity,
"RTN","PRS8CR",8,0)
 ;WK(2) contains those items pertaining to Week 2 activity and
"RTN","PRS8CR",9,0)
 ;WK(3) contains the Miscellaneous information shown on the bottom
"RTN","PRS8CR",10,0)
 ;of the timecard.
"RTN","PRS8CR",11,0)
 ;
"RTN","PRS8CR",12,0)
 ;Called by Routines:  PRS8DR
"RTN","PRS8CR",13,0)
 ;
"RTN","PRS8CR",14,0)
 ;Variable S contains the lengths of each of the Values for the
"RTN","PRS8CR",15,0)
 ;different time codes.  Used to format values with leading and
"RTN","PRS8CR",16,0)
 ;trailing zero's
"RTN","PRS8CR",17,0)
 N MLINHRS
"RTN","PRS8CR",18,0)
 S MLINHRS=$$MLINHRS^PRSAENT(DFN)
"RTN","PRS8CR",19,0)
 S S="3333333333333333333333333333333334436232333333333333333"
"RTN","PRS8CR",20,0)
 S E(1)="ANSKWDNOAURTCECUUNNANBSPSASBSCDADBDCTFOAOBOCYAOKOMRARBRCHAHBHCPTPAONYDHDVCEA  EB  TATCFAFCADNTRSSRSDNDCFCHCPCR"
"RTN","PRS8CR",21,0)
 S E(2)="ALSLWPNPABRLCTCOUSNRNSSQSESFSGDEDFDGTGOEOFOGYEOSOURERFRGHLHMHNPHPBCLYHHOVSEC  ED  TBTDFBFDAFNHRNSSSHNUCGCICQCS"
"RTN","PRS8CR",22,0)
 S E(3)="NLDWINTLLULNLDDTTOLAMLCAPCCYRRFFFECD"
"RTN","PRS8CR",23,0)
 K V S V="" F I=1,2,3 S V(I)=""
"RTN","PRS8CR",24,0)
 ;
"RTN","PRS8CR",25,0)
 ;Next section gets Week 1 and Week 2 data and stores in V(WK)
"RTN","PRS8CR",26,0)
 F J=1,2 F I=1:1:38,40,42:1:55 S X=+$P(WK(J),"^",I) I X]"" D
"RTN","PRS8CR",27,0)
 .; Don't report PT/PT for nurses on AWS schedules
"RTN","PRS8CR",28,0)
 .Q:$E(AC,2)=1&($P(C0,U,16)=72)&(I=32)  ; 36/40 AWS
"RTN","PRS8CR",29,0)
 .Q:$E(AC,2)=2&($P(C0,U,16)=80)&(I=32)  ; 9month AWS
"RTN","PRS8CR",30,0)
 .;
"RTN","PRS8CR",31,0)
 .I TYP'["D",I'=38,I'=40 D QH
"RTN","PRS8CR",32,0)
 .I TYP["D" S X=+X_"0"
"RTN","PRS8CR",33,0)
 .I TYP["Pd",$E(ENT,2)'="D",$P(WK(J),"^",32)="",V(J)="" S V(J)=V(J)_$S(J=1:"PT000",J=2:"PH000",1:"") ;for p/t drs put PT,PH in 8B string even if they are 0 (PT+PH=NH)
"RTN","PRS8CR",34,0)
 .I I=32,TYP["P",TYP["N",TYP'["B"!(TYP["H"),'X D  Q
"RTN","PRS8CR",35,0)
 ..S X=$E("0000000",0,+$E(S,I)-$L(X))_X
"RTN","PRS8CR",36,0)
 ..S V(J)=V(J)_$E(E(J),I+(I-1),I*2)_X
"RTN","PRS8CR",37,0)
 ..Q
"RTN","PRS8CR",38,0)
 .I I=37,$P(C0,"^",20)="P",$P(C0,"^",21)="U" D
"RTN","PRS8CR",39,0)
 ..S X=$E("0000000",0,+$E(S,I)-$L(X))_X
"RTN","PRS8CR",40,0)
 ..I 'X S V(J)=V(J)_$E(E(J),I+(I-1),I*2)_X
"RTN","PRS8CR",41,0)
 ..Q
"RTN","PRS8CR",42,0)
 .S X=+X I I=32,TYP["Pd",X=0 S X=1
"RTN","PRS8CR",43,0)
 .Q:'X
"RTN","PRS8CR",44,0)
 .I I=32,TYP["Pd",X=1 S X=0
"RTN","PRS8CR",45,0)
 .I I=38!(I=40) D
"RTN","PRS8CR",46,0)
 ..S Z=X,X=4*$P(WK(J),"^",I+1) D QH
"RTN","PRS8CR",47,0)
 ..S X=($E("00",0,$E(S,I)-$L(Z))_+Z)_($E("000",0,$E(S,I+1)-$L(+X))_+X) ;combine env. diff. % and hours
"RTN","PRS8CR",48,0)
 ..Q
"RTN","PRS8CR",49,0)
 .E  S X=$E("0000000",0,+$E(S,I)-$L(X))_+X
"RTN","PRS8CR",50,0)
 .I +X S V(J)=V(J)_$E(E(J),I+(I-1),I*2)_X,V=V+X
"RTN","PRS8CR",51,0)
 ;
"RTN","PRS8CR",52,0)
 ;Now we get miscellaneous data
"RTN","PRS8CR",53,0)
 ;
"RTN","PRS8CR",54,0)
 S S="22134446114423146"
"RTN","PRS8CR",55,0)
 F I=1:1:17 S X=$P(WK(3),"^",I) I X'="" D
"RTN","PRS8CR",56,0)
 .I I=11 D
"RTN","PRS8CR",57,0)
 . . I MLINHRS D QH ; Convert to 1/4 hours.
"RTN","PRS8CR",58,0)
 . . I MLINHRS=0 S X=X_"0" ; Convert to 1/4 hours.
"RTN","PRS8CR",59,0)
 .S X=$E("000000",0,+$E(S,I)-$L(X))_X
"RTN","PRS8CR",60,0)
 .I $D(X) S V(3)=V(3)_$E(E(3),I+(I-1),I*2)_X,V=V+X
"RTN","PRS8CR",61,0)
 ;
"RTN","PRS8CR",62,0)
 ;finish up
"RTN","PRS8CR",63,0)
 ;
"RTN","PRS8CR",64,0)
 S VAL="" I $L(V(1))!($L(V(2)))!($L(V(3))) S X=V(1)_V(2)_V(3)_"CD"_$E("000000",0,6-$L(+V))_+V,VAL=X
"RTN","PRS8CR",65,0)
 ;
"RTN","PRS8CR",66,0)
STUB ; --- enter here to create stub only
"RTN","PRS8CR",67,0)
 I '($D(VAL)#2) S VAL=""
"RTN","PRS8CR",68,0)
 ; code below to add CP field to STUB record (32nd position)
"RTN","PRS8CR",69,0)
 S CPFX=""
"RTN","PRS8CR",70,0)
 S CPFX=$P($G(^PRST(458,PY,"E",DFN,0)),"^",6) ;get CP from 458
"RTN","PRS8CR",71,0)
 I CPFX="" S CPFX=$P($G(^PRSPC(DFN,1)),"^",7) ;if 458 null get from 450
"RTN","PRS8CR",72,0)
 I "0"[CPFX S CPFX=" " ;if it is 0 or "" set CPFX = " "
"RTN","PRS8CR",73,0)
 S PPE=$G(^PRST(458,+PY,0)),PPE=$P(PPE,"^",1),PPI=+PY D ^PRSAXSR
"RTN","PRS8CR",74,0)
 S VAL=HDR_CPFX_VAL ;decomp no longer saves 8B in 5 node (6/95)
"RTN","PRS8CR",75,0)
 K I,J,S Q
"RTN","PRS8CR",76,0)
 ;
"RTN","PRS8CR",77,0)
QH ; --- for persons paid hourly/convert to Quarter Hours
"RTN","PRS8CR",78,0)
 ;
"RTN","PRS8CR",79,0)
 I I'=37 S X1=X#4,X=X\4_+X1 K X1
"RTN","PRS8CR",80,0)
 Q
"RTN","PRS8EX")
0^6^B44421441^B42573837
"RTN","PRS8EX",1,0)
PRS8EX ;HISC/MRL,WCIOFO/SAB-DECOMPOSITION, EXCEPTIONS ;6/11/2008
"RTN","PRS8EX",2,0)
 ;;4.0;PAID;**2,40,56,69,111,112,117**;Sep 21, 1995;Build 32
"RTN","PRS8EX",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRS8EX",4,0)
 ;
"RTN","PRS8EX",5,0)
 ;This routine is used to process most exceptions to the normal
"RTN","PRS8EX",6,0)
 ;tod.  It is used, for example, to determine whether or not the
"RTN","PRS8EX",7,0)
 ;employee is entitled to such exceptions as Leave, OT, etc.,
"RTN","PRS8EX",8,0)
 ;and then calls ^PRS8AC to process them.
"RTN","PRS8EX",9,0)
 ;
"RTN","PRS8EX",10,0)
 ;Called by Routines:  PRS8ST
"RTN","PRS8EX",11,0)
 ;
"RTN","PRS8EX",12,0)
 S TT=$P(V,"^",3) ;type of time
"RTN","PRS8EX",13,0)
 I TT="OT",+$P(V,"^",4)=8,$E(ENT,18) S TT="TT" ;ot in travel status
"RTN","PRS8EX",14,0)
 I TT="CT",$P(V,"^",4)=16 S TT="CQ" ;credit hours earned
"RTN","PRS8EX",15,0)
 I TT="CU",$P(V,"^",4)=16 S TT="CS" ;credit hours used
"RTN","PRS8EX",16,0)
 I TT="HW",$E(ENT,1,2)="0D" S TT="RG"
"RTN","PRS8EX",17,0)
 I TT="OT",TYP["P",TYP'["B" S TT="RG" ;To convert Pt ot to RG
"RTN","PRS8EX",18,0)
 I TT="HW",TYP'["D",+V,+$P(V,"^",2) D
"RTN","PRS8EX",19,0)
 .I $P(V,"^",2)-V-1<8 D  ; <2 hrs HW
"RTN","PRS8EX",20,0)
 ..S ^TMP($J,"PRS8",DY,"HW")=$G(^TMP($J,"PRS8",DY,"HW"))_$P(V,U,1,2)_U
"RTN","PRS8EX",21,0)
 ..Q
"RTN","PRS8EX",22,0)
 .I TYP["P",$P(V,"^",2)>96 S LEN=$P(V,"^",2)-96 D  ;two day tour of HW for part timers
"RTN","PRS8EX",23,0)
 ..S ^TMP($J,"PRS8",DY+1,"HWK")=$G(^TMP($J,"PRS8",DY+1,"HWK"))_1_U_LEN_U
"RTN","PRS8EX",24,0)
 ..K LEN
"RTN","PRS8EX",25,0)
 ..Q
"RTN","PRS8EX",26,0)
 .I TYP["P",TYP["N"!(TYP["H"),'$E(DAY(DY,"W"),+V) D  ; part time nurses, uscheduled HW.
"RTN","PRS8EX",27,0)
 ..S ^TMP($J,"PRS8",DY,"HWK")=$G(^TMP($J,"PRS8",DY,"HWK"))_$P(V,U,1,2)_U
"RTN","PRS8EX",28,0)
 ..Q
"RTN","PRS8EX",29,0)
 .Q
"RTN","PRS8EX",30,0)
 S X="^AL^SL^WP^NP^AA^RL^CU^CT^CP^HX^ML^TR^TV^OT^RG^TT^SB^ON^NL^HW^CB^AD^DL^RS^CH^CQ^CS" ;code
"RTN","PRS8EX",31,0)
 S X=($F(X,"^"_TT)\3)+4,(X,TT(1))=$P($T(ACT+X),";;",2) ;parameters
"RTN","PRS8EX",32,0)
 S GO=0 I '+X!($E(ENT,+X)) S GO=1 ;entitlement exists-continue
"RTN","PRS8EX",33,0)
 I TT="RG",$E(ENT,2)'=0 S GO=1 ;intermittent
"RTN","PRS8EX",34,0)
 I TT="RG"!(TT="CP"),$E(ENT,2)="D" S DAY(DY,"DWK")=1 ;intrmtnt-count days worked (for RG or CP)
"RTN","PRS8EX",35,0)
 I TT="OT",'GO,$E(ENT,13)!$E(ENT,14) S GO=1 ;entitled to ot
"RTN","PRS8EX",36,0)
 I TT="UN" S GO=1,VAR="-" ;unavailable
"RTN","PRS8EX",37,0)
 I TYP["W",TT="RG",$P(V,"^",4)=7 D
"RTN","PRS8EX",38,0)
 .;wage grade employee working regular unscheduled hours for
"RTN","PRS8EX",39,0)
 .;shift coverage (7) can get shift differential based on the higher
"RTN","PRS8EX",40,0)
 .;of the unscheduled tour's shift or their normal shift.
"RTN","PRS8EX",41,0)
 .;The unscheduled tour and corresponding differential will be saved
"RTN","PRS8EX",42,0)
 .;in the "SD" node and used by PRS8PP when differentials are
"RTN","PRS8EX",43,0)
 .;computed.
"RTN","PRS8EX",44,0)
 .N ST,EN,SD,MID
"RTN","PRS8EX",45,0)
 .S ST=$P(V,"^"),EN=$P(V,"^",2) Q:'ST!'EN
"RTN","PRS8EX",46,0)
 .S MID=ST+EN/2
"RTN","PRS8EX",47,0)
 .; check for 2day tour and if found use combined tour (recompute MID)
"RTN","PRS8EX",48,0)
 .; to determine appropriate shift differential.
"RTN","PRS8EX",49,0)
 .; if start is 1 (midnight) then check previous day for a similar tour
"RTN","PRS8EX",50,0)
 .; that ended at 96 (midnight).
"RTN","PRS8EX",51,0)
 . I ST=1 D
"RTN","PRS8EX",52,0)
 .. N PRSI,PRSX
"RTN","PRS8EX",53,0)
 .. S PRSX=$G(^TMP($J,"PRS8",DY-1,2))
"RTN","PRS8EX",54,0)
 .. F PRSI=1:1:7 Q:$P(PRSX,U,(PRSI-1)*4+1)=""  D
"RTN","PRS8EX",55,0)
 ... I $P(PRSX,U,(PRSI-1)*4+2)=96,$P(PRSX,U,(PRSI-1)*4+3)="RG",$P(PRSX,U,(PRSI-1)*4+4)=7 S MID=($P(PRSX,U,(PRSI-1)*4+1)+EN+96)/2
"RTN","PRS8EX",56,0)
 .; if end is 96 (midnight) then check next day for a similar tour that
"RTN","PRS8EX",57,0)
 .; starts at 1 (midnight).
"RTN","PRS8EX",58,0)
 . I EN=96 D
"RTN","PRS8EX",59,0)
 .. N PRSI,PRSX
"RTN","PRS8EX",60,0)
 .. S PRSX=$G(^TMP($J,"PRS8",DY+1,2))
"RTN","PRS8EX",61,0)
 .. F PRSI=1:1:7 Q:$P(PRSX,U,(PRSI-1)*4+1)=""  D
"RTN","PRS8EX",62,0)
 ... I $P(PRSX,U,(PRSI-1)*4+1)=1,$P(PRSX,U,(PRSI-1)*4+3)="RG",$P(PRSX,U,(PRSI-1)*4+4)=7 S MID=(ST+$P(PRSX,U,(PRSI-1)*4+2)+96)/2
"RTN","PRS8EX",63,0)
 .; determine shift differential (if any) based on unscheduled tour hours
"RTN","PRS8EX",64,0)
 .S SD=0
"RTN","PRS8EX",65,0)
 .I MID<32.5 S SD=3 ; majority of tour before 8a
"RTN","PRS8EX",66,0)
 .I MID>60.5,MID'>94.5 S SD=2 ; majority of tour after 3p, upto 11:30p
"RTN","PRS8EX",67,0)
 .I MID>94.5,MID<128.5 S SD=3 ; majority of tour after 11:30p, before 8a
"RTN","PRS8EX",68,0)
 .; use employee's normal shift if higher than shift based on hours
"RTN","PRS8EX",69,0)
 .I TOUR>1,TOUR>SD S SD=TOUR
"RTN","PRS8EX",70,0)
 .S:SD ^TMP($J,"PRS8",DY,"SD")=$G(^TMP($J,"PRS8",DY,"SD"))_ST_U_EN_U_SD_U
"RTN","PRS8EX",71,0)
 .Q
"RTN","PRS8EX",72,0)
 I (TT="OT"!(TT="RG")!(TT="CT")),"^13^14^"[("^"_$P(V,"^",4)_"^")!($P(V,"^",4)=12&(TYP["N"!(TYP["H"))) D
"RTN","PRS8EX",73,0)
 .S ^TMP($J,"PRS8",DY,"CB")=$G(^TMP($J,"PRS8",DY,"CB"))_$P(V,"^",1,2)_"^"
"RTN","PRS8EX",74,0)
 .Q
"RTN","PRS8EX",75,0)
 I TYP'["D",TT="HX"!(TT="HW") S GO=1 ;process holiday excused/worked
"RTN","PRS8EX",76,0)
 G END:'GO ;nothing to process
"RTN","PRS8EX",77,0)
 I TT'="UN" S VAR=$P(X,"^",3) ;increment time code
"RTN","PRS8EX",78,0)
 I '$S(VAR'="W":1,'CYA:1,DY<CYA:1,1:0) D
"RTN","PRS8EX",79,0)
 .S WPCY=1 ;flag to save WOP in hours from 1/1 for calendar year adjustment
"RTN","PRS8EX",80,0)
 I TYP'["D" D  G END ;process hourly people and quit
"RTN","PRS8EX",81,0)
 .; The following 2 lines commented out because for Employees that are
"RTN","PRS8EX",82,0)
 .; non-daily tour (TYP'["D"), policy is has been described that all
"RTN","PRS8EX",83,0)
 .; ML/COP has to be posted by time-keeper.
"RTN","PRS8EX",84,0)
 .; If this changes, then uncomment these lines, remove the line adding
"RTN","PRS8EX",85,0)
 .; military leave and COP that follows, and refer to routine PRS8UP.
"RTN","PRS8EX",86,0)
 .; I VAR="M" S ^TMP($J,"PRS8",DY,"ML")=1,MILV=1 ;military leave taken
"RTN","PRS8EX",87,0)
 .; I VAR="V" S ^TMP($J,"PRS8",DY,"CP")=1,WCMP=1 ;cont of pay indicator
"RTN","PRS8EX",88,0)
 .I DY>0,DY<15 D
"RTN","PRS8EX",89,0)
 ..; Post ML for employees who are charged in days.
"RTN","PRS8EX",90,0)
 ..I VAR="M",$$MLINHRS^PRSAENT(DFN)=0 D
"RTN","PRS8EX",91,0)
 ...S X=$P(TT(1),"^",4) D SET ; military leave & auth. absence
"RTN","PRS8EX",92,0)
 ..I VAR="V",'$G(^TMP($J,"PRS8",DY,"CP")) S X="M",^TMP($J,"PRS8",DY,"CP")=1 D SET ; COP
"RTN","PRS8EX",93,0)
 ..Q
"RTN","PRS8EX",94,0)
 .D ^PRS8AC ;update activity string
"RTN","PRS8EX",95,0)
 .Q
"RTN","PRS8EX",96,0)
 ; Employees with daily tours (TYP["D")
"RTN","PRS8EX",97,0)
 I DY>0,DY<15,VAR="M" S X=$P(TT(1),"^",4) D SET S X=5 D SET G END ;military leave & auth. absence
"RTN","PRS8EX",98,0)
 I DY>0,DY<15,$$HOLIDAY^PRS8UT(PY,DFN,DY) D  G END ;holiday-no charge
"RTN","PRS8EX",99,0)
 .I TT="RG" S DAY(DY,"W")=VAR,X=$S('$E(ENT,TOUR+21):9,1:TOUR+28) D SET ; If worked on holiday count it.
"RTN","PRS8EX",100,0)
 .Q
"RTN","PRS8EX",101,0)
 S D=DY
"RTN","PRS8EX",102,0)
 I TT="NP"!($P(DAY(D,0),"^",2)'=1) S DAY(D,"W")=VAR,X=$P(TT(1),"^",4) I X'="",DY>0,DY<15 D SET I VAR="V" S X="M" D SET I VAR="V",TYP["DI",$E(ENT,2)="D" S X=9 D SET ; IF INT RESDNT PAID IN DAYS HAS COP POSTED PAY UN/US ALSO
"RTN","PRS8EX",103,0)
 D ENCAP^PRS8EX0
"RTN","PRS8EX",104,0)
 ;
"RTN","PRS8EX",105,0)
END ; --- all done here     
"RTN","PRS8EX",106,0)
 K A,D,DD,GO,TT,X,Z
"RTN","PRS8EX",107,0)
 Q
"RTN","PRS8EX",108,0)
 ;
"RTN","PRS8EX",109,0)
SET ; --- enter here to set without VAL defined
"RTN","PRS8EX",110,0)
 ; Quit if this day has already been counted through the encapsulation
"RTN","PRS8EX",111,0)
 ; check that is performed in ENCAP^PRS8EX0.
"RTN","PRS8EX",112,0)
 Q:$D(^TMP($J,"PRS8",DY,2,0))
"RTN","PRS8EX",113,0)
 ;
"RTN","PRS8EX",114,0)
 Q:X="K"&($P(V,"^",1)>96)!((X="K")&($D(^TMP($J,"PRS8",DY,"ML"))))  S ^TMP($J,"PRS8",DY,"ML")=1 ;stop counting ML twice for two day tours & split tours, but allow PC
"RTN","PRS8EX",115,0)
 I +X S $P(WK(WK),"^",+X)=$P(WK(WK),"^",+X)+1
"RTN","PRS8EX",116,0)
 E  S X=$A(X)-64,$P(WK(3),"^",+X)=$P(WK(3),"^",+X)+1
"RTN","PRS8EX",117,0)
 Q
"RTN","PRS8EX",118,0)
 ;
"RTN","PRS8EX",119,0)
ACT ; --- define variable X for action
"RTN","PRS8EX",120,0)
 ;     - piece 1 = entitlement (ENT) string $Extract to check
"RTN","PRS8EX",121,0)
 ;     -       2 = Literal name of exception
"RTN","PRS8EX",122,0)
 ;     -       3 = Time String code (DAY(X,"W"))
"RTN","PRS8EX",123,0)
 ;;
"RTN","PRS8EX",124,0)
 ;;30^Annual Leave^L^1
"RTN","PRS8EX",125,0)
 ;;31^Sick Leave^S^2
"RTN","PRS8EX",126,0)
 ;;33^Without Pay^W^3
"RTN","PRS8EX",127,0)
 ;;36^Non-Pay Status^n^4
"RTN","PRS8EX",128,0)
 ;;35^Authorized Absence^A^5
"RTN","PRS8EX",129,0)
 ;;30^Restored Leave^R^6
"RTN","PRS8EX",130,0)
 ;;28^Comp Used^U^8
"RTN","PRS8EX",131,0)
 ;;28^Comp Earned^E^7
"RTN","PRS8EX",132,0)
 ;;37^Continuation of Pay^V^33
"RTN","PRS8EX",133,0)
 ;;38^Holiday Excused^H
"RTN","PRS8EX",134,0)
 ;;34^Military Leave^M^K
"RTN","PRS8EX",135,0)
 ;;0^Training^X^43
"RTN","PRS8EX",136,0)
 ;;0^Travel^Y^42
"RTN","PRS8EX",137,0)
 ;;12^Overtime^O
"RTN","PRS8EX",138,0)
 ;;2^Unscheduled^4^9
"RTN","PRS8EX",139,0)
 ;;18^OT in Travel Status^T
"RTN","PRS8EX",140,0)
 ;;29^Standby^B
"RTN","PRS8EX",141,0)
 ;;26^On-Call^C
"RTN","PRS8EX",142,0)
 ;;36^Nonpay A/L^N^A
"RTN","PRS8EX",143,0)
 ;;38^Holiday Worked^h
"RTN","PRS8EX",144,0)
 ;;31^Care and Bereavement^F^44
"RTN","PRS8EX",145,0)
 ;;31^Adoption^G^45
"RTN","PRS8EX",146,0)
 ;;35^Donor Leave^D^46
"RTN","PRS8EX",147,0)
 ;;5^Recess^r^48
"RTN","PRS8EX",148,0)
 ;;4^Comp Time for Travel Used^Z^53
"RTN","PRS8EX",149,0)
 ;;28^Credit Hours Earned^Q^54
"RTN","PRS8EX",150,0)
 ;;28^Credit Hours Used^q^55
"RTN","PRS8HR")
0^9^B28258360^B28258844
"RTN","PRS8HR",1,0)
PRS8HR ;WCIOFO/JAH - DECOMPOSITION, HOURS ;7/14/2008
"RTN","PRS8HR",2,0)
 ;;4.0;PAID;**2,22,29,42,52,102,108,112,117**;Sep 21, 1995;Build 32
"RTN","PRS8HR",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRS8HR",4,0)
 ;
"RTN","PRS8HR",5,0)
 ;This routine is called by ^PRS8PP (premium pay calculator)
"RTN","PRS8HR",6,0)
 ;=====================================================================
"RTN","PRS8HR",7,0)
 ; ** indicates incompleted comments
"RTN","PRS8HR",8,0)
 ;
"RTN","PRS8HR",9,0)
 ;VARIABLE DEFINITION
"RTN","PRS8HR",10,0)
 ;
"RTN","PRS8HR",11,0)
 ; TYP   =  contains codes representing type of employee.
"RTN","PRS8HR",12,0)
 ;          It's a composite code string w/ characters that
"RTN","PRS8HR",13,0)
 ;          represent pay plan, duty basis, & normal hours.
"RTN","PRS8HR",14,0)
 ;    CODE  REPRESENTS      CODE   REPRESENTS
"RTN","PRS8HR",15,0)
 ;     D     daily            f     firefighter
"RTN","PRS8HR",16,0)
 ;     W     wagegrade        P     part-time
"RTN","PRS8HR",17,0)
 ;     N     nurse            d     doctor
"RTN","PRS8HR",18,0)
 ;     B     baylor plan      dR    doctor/resident or intern
"RTN","PRS8HR",19,0)
 ;     H     Nurse Hybrid     ""    *
"RTN","PRS8HR",20,0)
 ;     I     intermittent
"RTN","PRS8HR",21,0)
 ; VAL   =  Single char code represents employee's work status for
"RTN","PRS8HR",22,0)
 ;          current 15 min increment.
"RTN","PRS8HR",23,0)
 ; FLX   =  Flex tour indicator.
"RTN","PRS8HR",24,0)
 ; TH(W) =  Tour Hours for week 1, TH(1) & week 2, TH(2)
"RTN","PRS8HR",25,0)
 ; TH    =  Tour Hours
"RTN","PRS8HR",26,0)
 ; HTP   =  PAYABLE hours worked today.
"RTN","PRS8HR",27,0)
 ; HT    =  Hours worked today.
"RTN","PRS8HR",28,0)
 ; AV    =  String w/ most normal types of time (see bottom of PRS8EX)
"RTN","PRS8HR",29,0)
 ;          does NOT contain premium times or unscheduled time (OoEes4)
"RTN","PRS8HR",30,0)
 ;====================================================================
"RTN","PRS8HR",31,0)
 ;
"RTN","PRS8HR",32,0)
 S AV="1235nHMLSWNARUXYVJFGDZq"
"RTN","PRS8HR",33,0)
 ;
"RTN","PRS8HR",34,0)
 ;   Loop thru each quarter hour segment of day.
"RTN","PRS8HR",35,0)
 ;   Check for times in AV array.
"RTN","PRS8HR",36,0)
 ;   Proceed w/ calculation if Overtime worked on Holiday.
"RTN","PRS8HR",37,0)
 ;
"RTN","PRS8HR",38,0)
 F M=1:1:96 D
"RTN","PRS8HR",39,0)
 .  S VAL=$E(D,M)
"RTN","PRS8HR",40,0)
 .;
"RTN","PRS8HR",41,0)
 .;    If non premium type of time or (overtime on holiday)
"RTN","PRS8HR",42,0)
 .;
"RTN","PRS8HR",43,0)
 .  I AV[VAL!(VAL="O"&($E(DAY(DAY,"HOL"),M)=2)) D CALC
"RTN","PRS8HR",44,0)
 Q
"RTN","PRS8HR",45,0)
 ;
"RTN","PRS8HR",46,0)
 ;%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
"RTN","PRS8HR",47,0)
 ;
"RTN","PRS8HR",48,0)
CALC ; --- Entry point for calculating placement of time
"RTN","PRS8HR",49,0)
 ;
"RTN","PRS8HR",50,0)
 ;     Set up variables for calculations and comparisons in this routine
"RTN","PRS8HR",51,0)
 ;
"RTN","PRS8HR",52,0)
 N HOLWKD,HOLEX,HOLWKEX
"RTN","PRS8HR",53,0)
 D ^PRS8HRSV
"RTN","PRS8HR",54,0)
 ;
"RTN","PRS8HR",55,0)
 ;     IF intermittent employee on continuation of pay OR overtime on 
"RTN","PRS8HR",56,0)
 ;     holiday THEN increment Pay Period tour hours and current weeks 
"RTN","PRS8HR",57,0)
 ;     tour hours.
"RTN","PRS8HR",58,0)
 ;
"RTN","PRS8HR",59,0)
 I TYP["I",VAL["V"!(VAL="O"&(HOLWKD)) S TH=TH+1,TH(W)=TH(W)+1
"RTN","PRS8HR",60,0)
 ;
"RTN","PRS8HR",61,0)
 ;     IF part time doctor & total hours = 80 & type of
"RTN","PRS8HR",62,0)
 ;     time is unscheduled, overtime, comptime THEN quit
"RTN","PRS8HR",63,0)
 ;
"RTN","PRS8HR",64,0)
 I TYP["d",TYP["P",TH=320,"4OosEe"[VAL Q
"RTN","PRS8HR",65,0)
 ;
"RTN","PRS8HR",66,0)
 ;     IF INT doctor & total hours = 80 THEN quit
"RTN","PRS8HR",67,0)
 ;
"RTN","PRS8HR",68,0)
 I TYP["I",$E(AC,1)="L",TH=320,"4OosEe"[VAL Q
"RTN","PRS8HR",69,0)
 ;
"RTN","PRS8HR",70,0)
 ;     IF type of time is anything but Leave Without Pay "W" or Non-Pay "n"
"RTN","PRS8HR",71,0)
 ;     THEN increment total hrs HT & increment HTP.  Also update
"RTN","PRS8HR",72,0)
 ;     ^TMP global for reference during the processing of On-Call (PRS8OC).
"RTN","PRS8HR",73,0)
 ;
"RTN","PRS8HR",74,0)
 I "Wn"'[VAL S HT=HT+1,HTP=HTP+1,^TMP($J,"PRS8",DAY,"HT")=HT
"RTN","PRS8HR",75,0)
 ;
"RTN","PRS8HR",76,0)
 ;---------------------------------------------------------
"RTN","PRS8HR",77,0)
 ;     IF entitled to VCS commission sales & normal time(1) ??(2,3)
"RTN","PRS8HR",78,0)
 ;     & holiday excused set X to type of time=Piece Worker Hol excused.
"RTN","PRS8HR",79,0)
 ;     Then IF part time set X to part time hours code.
"RTN","PRS8HR",80,0)
 ;
"RTN","PRS8HR",81,0)
 I $E(ENT,38),"123"[VAL,HOLEX S X=36 D CHK^PRS8HRSV D  Q:X
"RTN","PRS8HR",82,0)
 .  I TYP["P" S X=32 D CHK^PRS8HRSV
"RTN","PRS8HR",83,0)
 ;
"RTN","PRS8HR",84,0)
 ;---------------------------------------------------------------
"RTN","PRS8HR",85,0)
 ;
"RTN","PRS8HR",86,0)
 ;     Don't mess w/ fire fighters
"RTN","PRS8HR",87,0)
 ;
"RTN","PRS8HR",88,0)
 Q:"Ff"[TYP
"RTN","PRS8HR",89,0)
 ;
"RTN","PRS8HR",90,0)
 S GO=0
"RTN","PRS8HR",91,0)
 ;     IF compressed tour & parttime & tour hours are over 80
"RTN","PRS8HR",92,0)
 ;     OR tour hours = 80 & it's overtime, comptime, or unscheduled reg.
"RTN","PRS8HR",93,0)
 ;
"RTN","PRS8HR",94,0)
 ; Check for FT
"RTN","PRS8HR",95,0)
 I $E(AC,2)=1,NH>319,("OoseE4"[VAL) S GO=1
"RTN","PRS8HR",96,0)
 ;
"RTN","PRS8HR",97,0)
 ; Check for week
"RTN","PRS8HR",98,0)
 I (TH(W)>160&("OoseE4"[VAL))!(TH(W)=160&("OosEe4"[VAL)) S GO=1
"RTN","PRS8HR",99,0)
 ;
"RTN","PRS8HR",100,0)
 ; Check for day
"RTN","PRS8HR",101,0)
 I HT>32,"OoseE4"[VAL S GO=1
"RTN","PRS8HR",102,0)
 ;
"RTN","PRS8HR",103,0)
 ;     Following segment is concerned w/ variations of part time
"RTN","PRS8HR",104,0)
 ;     employees (TYP["P"), & 1 baylor (TYP["B").
"RTN","PRS8HR",105,0)
 ;-------------------------------------------------------------------
"RTN","PRS8HR",106,0)
 ;
"RTN","PRS8HR",107,0)
 ;     Doctor over 8 hours
"RTN","PRS8HR",108,0)
 ;
"RTN","PRS8HR",109,0)
 I TYP["Pd",HT>32 S GO=0 ; part-time doctors PT + PH must = NH
"RTN","PRS8HR",110,0)
 ;
"RTN","PRS8HR",111,0)
 I TYP["P",HOLWKD S GO=0
"RTN","PRS8HR",112,0)
 ;
"RTN","PRS8HR",113,0)
 ;     Baylor plan & ct/ot/s
"RTN","PRS8HR",114,0)
 ;
"RTN","PRS8HR",115,0)
 I TYP["B","EeOos"[VAL S GO=1
"RTN","PRS8HR",116,0)
 ;
"RTN","PRS8HR",117,0)
 ;-------------------------------------------------------------------
"RTN","PRS8HR",118,0)
 ;     GO set in cases where employee maybe eligible for OT
"RTN","PRS8HR",119,0)
 ;     due to over > 8/day OR > 40/week.
"RTN","PRS8HR",120,0)
 ;
"RTN","PRS8HR",121,0)
 S X=0 I GO D TH^PRS8HRSV D OVER840^PRS8HROT Q
"RTN","PRS8HR",122,0)
 ;
"RTN","PRS8HR",123,0)
 ;-------------------------------------------------------------------
"RTN","PRS8HR",124,0)
 ;-------------------------------------------------------------------
"RTN","PRS8HR",125,0)
 ;     GO not set for compressed schedule of at least 80 hrs.
"RTN","PRS8HR",126,0)
 ;     GO not set for non compressed schedule of over 40 hrs.
"RTN","PRS8HR",127,0)
 ;     IF GO is set and we are evaluating normal hours or
"RTN","PRS8HR",128,0)
 ;     HOLIDAY OVERTIME use NORMHRS to increment TIME
"RTN","PRS8HR",129,0)
 ;     in week array.  THEN QUIT.
"RTN","PRS8HR",130,0)
 ;
"RTN","PRS8HR",131,0)
 S GO=1
"RTN","PRS8HR",132,0)
 I FLX="C",NH>319 S GO=0
"RTN","PRS8HR",133,0)
 I FLX'="C",NH(WK)>160,TYP'["Pd" S GO=0 ;IF pt-doctor don't set GO=0
"RTN","PRS8HR",134,0)
 I GO,"1235nHMLSWNARUXYVJFGDZq"[VAL!(VAL="O"&(HOLWKD)) S X=32 D CHK^PRS8HRSV Q
"RTN","PRS8HR",135,0)
 ;
"RTN","PRS8HR",136,0)
 ;--------------------------------------------------------------------
"RTN","PRS8HR",137,0)
 ;   Check employees with Normal hours less than 80. (Baylor NH=320)
"RTN","PRS8HR",138,0)
 ;
"RTN","PRS8HR",139,0)
 I NH'>319!(($E(AC,2)=2)&(NH=320)) D TH^PRS8HRSV D  Q
"RTN","PRS8HR",140,0)
 .I FLX="C" D  Q:X
"RTN","PRS8HR",141,0)
 ..;
"RTN","PRS8HR",142,0)
 ..; For PT employees review hours worked to determine X
"RTN","PRS8HR",143,0)
 ..I "OosEe4"'[VAL S X=32  ; All tour time = PT/PH
"RTN","PRS8HR",144,0)
 ..;
"RTN","PRS8HR",145,0)
 ..; Checks for CT
"RTN","PRS8HR",146,0)
 ..I "Ee"[VAL D
"RTN","PRS8HR",147,0)
 ...; <8/DAY & <40/WK  = UN/US
"RTN","PRS8HR",148,0)
 ...I HT'>32,TH(W)'>160 S X=9 Q
"RTN","PRS8HR",149,0)
 ...S X=7 ; CE/CT
"RTN","PRS8HR",150,0)
 ..;
"RTN","PRS8HR",151,0)
 ..; Checks for all other types of time
"RTN","PRS8HR",152,0)
 ..I "Oos4"[VAL D
"RTN","PRS8HR",153,0)
 ...I HT>32 S X=TOUR+15 Q  ; DA/DE
"RTN","PRS8HR",154,0)
 ...I TH(W)>160 S X=TOUR+19 Q  ; OA/OE
"RTN","PRS8HR",155,0)
 ...S X=9 ; UN/US
"RTN","PRS8HR",156,0)
 ..D CHK^PRS8HRSV
"RTN","PRS8HR",157,0)
 .;
"RTN","PRS8HR",158,0)
 .;     Under 8/day, 40/week, and not coded as overtime or comptime
"RTN","PRS8HR",159,0)
 .;     or overtime on holiday.
"RTN","PRS8HR",160,0)
 .;
"RTN","PRS8HR",161,0)
 .; Checks for non-compressed employees
"RTN","PRS8HR",162,0)
 .I HT'>32,TH(W)'>160,"OoseE"'[VAL!(VAL="O"&(HOLWKD)) S X=0 D  Q:X
"RTN","PRS8HR",163,0)
 ..;
"RTN","PRS8HR",164,0)
 ..;    Not intermittent, normal hours and not unscheduled reg. 
"RTN","PRS8HR",165,0)
 ..;    TIME gets parttime hours.
"RTN","PRS8HR",166,0)
 ..;
"RTN","PRS8HR",167,0)
 ..I TYP'["I",AV[VAL,VAL'=4 S X=32 D CHK^PRS8HRSV Q
"RTN","PRS8HR",168,0)
 ..;
"RTN","PRS8HR",169,0)
 ..;    All else fails - TIME gets unscheduled regular.
"RTN","PRS8HR",170,0)
 ..;
"RTN","PRS8HR",171,0)
 ..S X=9 D CHK^PRS8HRSV Q
"RTN","PRS8HR",172,0)
 .;
"RTN","PRS8HR",173,0)
 .;     Part time doctor w/ unscheduled reg. TIME gets unscheduled reg.
"RTN","PRS8HR",174,0)
 .; 
"RTN","PRS8HR",175,0)
 .I TYP["P",TYP["d",VAL=4 S X=9 D CHK^PRS8HRSV Q
"RTN","PRS8HR",176,0)
 .;
"RTN","PRS8HR",177,0)
 .;     Over 8/day
"RTN","PRS8HR",178,0)
 .;
"RTN","PRS8HR",179,0)
 .I HT>32 D G8^PRS8HRSV Q:X
"RTN","PRS8HR",180,0)
 .;
"RTN","PRS8HR",181,0)
 .;     For all time left except comptime set TIME to appropriate OT
"RTN","PRS8HR",182,0)
 .;     unless comptime has been worked earlier in the week making
"RTN","PRS8HR",183,0)
 .;     the total hours less than 40, then TIME gets unscheduled reg.
"RTN","PRS8HR",184,0)
 .;     COMPTIME OVER 8/DAY WILL BE CREDITED HERE
"RTN","PRS8HR",185,0)
 .;
"RTN","PRS8HR",186,0)
 .S X=$S("Ee"'[VAL:TOUR+19,(TH(W)'>160)&(HT'>32):9,1:7)
"RTN","PRS8HR",187,0)
 .I TYP["P",VAL[4,TH(W)'>160,HT'>32 S X=9
"RTN","PRS8HR",188,0)
 .I TYP["P",VAL="O",TH(W)'>160,HT'>32 S X=9
"RTN","PRS8HR",189,0)
 .D CHK^PRS8HRSV
"RTN","PRS8HR",190,0)
 Q
"RTN","PRS8HROT")
0^10^B2971143^B3467629
"RTN","PRS8HROT",1,0)
PRS8HROT ;JAH/WCIOFO-Calc time over 8/day &/or 40/week ;07/14/2008
"RTN","PRS8HROT",2,0)
 ;;4.0;PAID;**29,42,52,102,117**;Sep 21, 1995;Build 32
"RTN","PRS8HROT",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRS8HROT",4,0)
 ;
"RTN","PRS8HROT",5,0)
OVER840 ;
"RTN","PRS8HROT",6,0)
 ;     If overtime coded & either holiday worked or holiday excused
"RTN","PRS8HROT",7,0)
 ;     Then set type of time to Holiday Hrs (shift Day, 2 or 3).
"RTN","PRS8HROT",8,0)
 ;
"RTN","PRS8HROT",9,0)
 I VAL="O",HOLWKEX S X=TOUR+28 D CHK^PRS8HRSV Q:X
"RTN","PRS8HROT",10,0)
 ;
"RTN","PRS8HROT",11,0)
 ;     If > 8 hrs & not compressed ** results of G8
"RTN","PRS8HROT",12,0)
 ;
"RTN","PRS8HROT",13,0)
 I HT>32 D G8^PRS8HRSV Q:X
"RTN","PRS8HROT",14,0)
 ;
"RTN","PRS8HROT",15,0)
 I "1235nHMLSWNARUXYVJFGDZq"[VAL,NH>319 Q
"RTN","PRS8HROT",16,0)
 ;
"RTN","PRS8HROT",17,0)
 ;     If Baylor Plan
"RTN","PRS8HROT",18,0)
 ;
"RTN","PRS8HROT",19,0)
 I TYP["B" D  Q:X
"RTN","PRS8HROT",20,0)
 .;
"RTN","PRS8HROT",21,0)
 .;     IF weeks hours greater than 8 & TIME not coded as comp-time
"RTN","PRS8HROT",22,0)
 .;     THEN set TIME to OT-Total Hrs (shift Day, 2 or 3)
"RTN","PRS8HROT",23,0)
 .;
"RTN","PRS8HROT",24,0)
 .I HT>32 S X=$S("Ee"'[VAL:TOUR+19,1:7) D CHK^PRS8HRSV Q:X
"RTN","PRS8HROT",25,0)
 .;
"RTN","PRS8HROT",26,0)
 .;     IF Total Hours for the current week are <= 40 
"RTN","PRS8HROT",27,0)
 .;     THEN TIME gets unscheduled regular.
"RTN","PRS8HROT",28,0)
 .;
"RTN","PRS8HROT",29,0)
 .I TH(W)'>160 S X=9 D CHK^PRS8HRSV Q:X
"RTN","PRS8HROT",30,0)
 .;
"RTN","PRS8HROT",31,0)
 .;     IF Total Hours for the current week ARE > 40
"RTN","PRS8HROT",32,0)
 .;       AND total hours for today are <= 8
"RTN","PRS8HROT",33,0)
 .;         AND Time is not comp-time
"RTN","PRS8HROT",34,0)
 .;         THEN Time gets Unscheduled regular.
"RTN","PRS8HROT",35,0)
 .;
"RTN","PRS8HROT",36,0)
 .I TH(W)>160,HT<33,"Ee"'[VAL S X=9 D CHK^PRS8HRSV Q:X
"RTN","PRS8HROT",37,0)
 ;
"RTN","PRS8HROT",38,0)
 ;     IF not comp-time THEN Time = Overtime, otherwise
"RTN","PRS8HROT",39,0)
 ;     part timers get unscheduled reg until 8/day, 40/week
"RTN","PRS8HROT",40,0)
 ;     UNSCHEDULED REGULAR WILL BE CODED AS OT for over 8/day
"RTN","PRS8HROT",41,0)
 ;
"RTN","PRS8HROT",42,0)
 S X=$S("Ee"'[VAL:TOUR+19,1:7)
"RTN","PRS8HROT",43,0)
 D CHK^PRS8HRSV
"RTN","PRS8HROT",44,0)
 ;
"RTN","PRS8HROT",45,0)
 ;-------------------------------------------------------------------
"RTN","PRS8HROT",46,0)
 Q
"RTN","PRS8MISC")
0^101^B19788515^B19784550
"RTN","PRS8MISC",1,0)
PRS8MISC ;HISC/DAD,RM,RS-MISCELLANEOUS ADJUSTMENTS TO TIME CARD ;9/12/2006
"RTN","PRS8MISC",2,0)
 ;;4.0;PAID;**56,68,80,111,117**;Sep 21, 1995;Build 32
"RTN","PRS8MISC",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRS8MISC",4,0)
 N ABUT,D,DY,M,NOTIME,PEROWK,WEEK
"RTN","PRS8MISC",5,0)
 S (PEROWK,NOTIME,PEROT,NOOT)=0 F DY=0:1:15 D
"RTN","PRS8MISC",6,0)
 .S WEEK=$S(DY>7:2,1:1)
"RTN","PRS8MISC",7,0)
 .S X=$G(^TMP($J,"PRS8",DY,2)),Y=$G(^("W"))
"RTN","PRS8MISC",8,0)
 .F M=1:1:96 S X=$E(Y,M) Q:'$L(X)  D  ; check for CB/FF OT and sleep time
"RTN","PRS8MISC",9,0)
 ..I "4EO"'[X!(X="O"&($E($G(^TMP($J,"PRS8",DY,"HOL")),M)=2)) S NOOT=0 ; set up periods of OT for PPD
"RTN","PRS8MISC",10,0)
 ..E  D
"RTN","PRS8MISC",11,0)
 ...S:'NOOT PEROT=PEROT+1,PEROT(PEROT)=DY_"^"_M_"^",NOOT=1
"RTN","PRS8MISC",12,0)
 ...S PEROT(PEROT)=PEROT(PEROT)_X
"RTN","PRS8MISC",13,0)
 ...Q
"RTN","PRS8MISC",14,0)
 ..I (TYP'["Ff"),SST,$E(ENT,27) D  ; set up per. of work for sleep time
"RTN","PRS8MISC",15,0)
 ...I "123OmosEeBbCctQ"'[X S NOTIME=0
"RTN","PRS8MISC",16,0)
 ...E  D
"RTN","PRS8MISC",17,0)
 ....S:'NOTIME PEROWK=PEROWK+1,PEROWK(PEROWK)=DY_U_M_U_M_U,NOTIME=1
"RTN","PRS8MISC",18,0)
 ....S $P(PEROWK(PEROWK),U,3)=M+(96*(DY-PEROWK(PEROWK)))
"RTN","PRS8MISC",19,0)
 ....S PEROWK(PEROWK)=PEROWK(PEROWK)_X
"RTN","PRS8MISC",20,0)
 ....S:$L($P(PEROWK(PEROWK),"^",4))=96 NOTIME=0
"RTN","PRS8MISC",21,0)
 ....Q
"RTN","PRS8MISC",22,0)
 ...Q
"RTN","PRS8MISC",23,0)
 ..Q
"RTN","PRS8MISC",24,0)
 .;holiday worked < 2 hrs
"RTN","PRS8MISC",25,0)
 .I DY<15,$E(ENT,TOUR+21) S HW=$G(^TMP($J,"PRS8",DY,"HW")) I HW]"" D
"RTN","PRS8MISC",26,0)
 ..S W=$G(^TMP($J,"PRS8",DY,"W"))
"RTN","PRS8MISC",27,0)
 ..S W1=$G(^TMP($J,"PRS8",DY-1,"W"))
"RTN","PRS8MISC",28,0)
 ..S W2=$G(^TMP($J,"PRS8",DY+1,"W"))
"RTN","PRS8MISC",29,0)
 ..F X=1:2 S Y=$P(HW,"^",X,X+1) Q:Y'>0  D
"RTN","PRS8MISC",30,0)
 ...N X,START,STOP,T,TT,Z,DD
"RTN","PRS8MISC",31,0)
 ...S START=+Y,STOP=$P(Y,"^",2),T=START,TT=$S(T>96:T-96,1:T)
"RTN","PRS8MISC",32,0)
 ...; Look back to determine if the segment of time currently being
"RTN","PRS8MISC",33,0)
 ...; checked abuts another segment of a Tour of Duty.  Ignore meals.
"RTN","PRS8MISC",34,0)
 ...S (ABUT,Z,X)=0
"RTN","PRS8MISC",35,0)
 ...I STOP-START+1<8 D
"RTN","PRS8MISC",36,0)
 ....F Z=1:1 D  Q:X=0
"RTN","PRS8MISC",37,0)
 .....S DD=Z I T>96 S X=0 Q
"RTN","PRS8MISC",38,0)
 .....I TT-DD>0 S X=$E(W,TT-DD)
"RTN","PRS8MISC",39,0)
 .....E  S X=$E(W1,96+T-DD)
"RTN","PRS8MISC",40,0)
 .....I "Cc123"[X,"01"[$E($G(^TMP($J,"PRS8",$S(TT-DD>0:DY,1:DY-1),"HOL")),$S(TT-DD>0:TT-DD,1:96+T-DD)) S X=0 ; Abuts HX
"RTN","PRS8MISC",41,0)
 .....I X="O",$E($G(^TMP($J,"PRS8",$S(TT-DD>0:DY,1:DY-1),"HOL")),$S(TT-DD>0:TT-DD,1:96+T-DD))=2 S X=0,ABUT=1 ; Abuts another segment of work
"RTN","PRS8MISC",42,0)
 ....;
"RTN","PRS8MISC",43,0)
 ....; Look forward to determine if the segment of time currently being
"RTN","PRS8MISC",44,0)
 ....; checked abuts another segment of a Tour of Duty.  Ignore meals.
"RTN","PRS8MISC",45,0)
 ....S ZZ=Z S:X=0&Z ZZ=ZZ-1 S X=0,T=STOP,TT=$S(T>96:T-96,1:T)
"RTN","PRS8MISC",46,0)
 ....F Z=1:1 D  Q:X=0
"RTN","PRS8MISC",47,0)
 .....S DD=STOP-START+1+ZZ+Z
"RTN","PRS8MISC",48,0)
 .....I T+Z'>96 S X=$E(W,T+Z)
"RTN","PRS8MISC",49,0)
 .....E  S X=$E(W2,T-96+Z)
"RTN","PRS8MISC",50,0)
 .....I "Cc123"[X,"01"[$E($G(^TMP($J,"PRS8",$S(T+Z'>96:DY,1:DY+1),"HOL")),$S(T+Z'>96:T+Z,1:T-96+Z)) S X=0 ; Abuts HX
"RTN","PRS8MISC",51,0)
 .....I X="O",$E($G(^TMP($J,"PRS8",$S(T+Z'>96:DY,1:DY-1),"HOL")),$S(T+Z'>96:T+Z,1:T-96+Z))=2 S X=0,ABUT=1 Q  ; Abuts another segment of work
"RTN","PRS8MISC",52,0)
 ...;
"RTN","PRS8MISC",53,0)
 ...; Loops to determine how much time we might need to add.
"RTN","PRS8MISC",54,0)
 ...S START=+Y,STOP=$P(Y,"^",2),T=START,TT=$S(T>96:T-96,1:T)
"RTN","PRS8MISC",55,0)
 ...S (Z,X)=0 F Z=1:1:8-(STOP-START+1) D  Q:X=0
"RTN","PRS8MISC",56,0)
 ....S DD=Z I T>96 S X=0 Q
"RTN","PRS8MISC",57,0)
 ....I TT-DD>0 S X=$E(W,TT-DD)
"RTN","PRS8MISC",58,0)
 ....E  S X=$E(W1,96+T-DD)
"RTN","PRS8MISC",59,0)
 ....I "Cc123m"[X,"01"[$E($G(^TMP($J,"PRS8",$S(TT-DD>0:DY,1:DY-1),"HOL")),$S(TT-DD>0:TT-DD,1:96+T-DD)) S X=0 ; HX becomes time off
"RTN","PRS8MISC",60,0)
 ....I X="O",$E($G(^TMP($J,"PRS8",$S(TT-DD>0:DY,1:DY-1),"HOL")),$S(TT-DD>0:TT-DD,1:96+T-DD))'=2 Q  ;S X=0,Z=8 ; non-holiday OT stops the check for <2hr HW
"RTN","PRS8MISC",61,0)
 ....I X="" S X=0
"RTN","PRS8MISC",62,0)
 ....Q
"RTN","PRS8MISC",63,0)
 ...S ZZ=Z S:X=0&Z ZZ=ZZ-1 S X=0,T=STOP,TT=$S(T>96:T-96,1:T)
"RTN","PRS8MISC",64,0)
 ...F Z=1:1:8-(STOP-START+1+ZZ) D  Q:X=0
"RTN","PRS8MISC",65,0)
 ....S DD=STOP-START+1+ZZ+Z
"RTN","PRS8MISC",66,0)
 ....I T+Z'>96 S X=$E(W,T+Z)
"RTN","PRS8MISC",67,0)
 ....E  S X=$E(W2,T-96+Z),PLUS=1
"RTN","PRS8MISC",68,0)
 ....I "Cc123m"[X,"01"[$E($G(^TMP($J,"PRS8",$S(T+Z'>96:DY,1:DY+1),"HOL")),$S(T+Z'>96:T+Z,1:T-96+Z)) S X=0 ; HX becomes time off
"RTN","PRS8MISC",69,0)
 ....I X="O",$E($G(^TMP($J,"PRS8",$S(T+Z'>96:DY,1:DY-1),"HOL")),$S(T+Z'>96:T+Z,1:T-96+Z))'=2 Q  ;S X=0,Z=8 ; non-holiday OT stops the check for <2hr HW
"RTN","PRS8MISC",70,0)
 ....Q
"RTN","PRS8MISC",71,0)
 ...S Z=ZZ+Z-(X=0&Z)
"RTN","PRS8MISC",72,0)
 ...I STOP-START+1+Z<8,'ABUT D
"RTN","PRS8MISC",73,0)
 ....S D=DY,P=TOUR+28,Y=8-(STOP-START+1+Z)
"RTN","PRS8MISC",74,0)
 ....S TL=$G(^TMP($J,"PRS8",D,0)),TL=4*($P(TL,"^",8)+$P(TL,"^",14))
"RTN","PRS8MISC",75,0)
 ....I Y+$P(WK($S(D>7:2,1:1)),"^",P)>TL S Y=TL-$P(WK($S(D>7:2,1:1)),"^",P)
"RTN","PRS8MISC",76,0)
 ....I $D(PLUS),T>96 S D=D+1
"RTN","PRS8MISC",77,0)
 ....D:Y SET
"RTN","PRS8MISC",78,0)
 ....Q
"RTN","PRS8MISC",79,0)
 ...Q
"RTN","PRS8MISC",80,0)
 ..Q
"RTN","PRS8MISC",81,0)
 .Q
"RTN","PRS8MISC",82,0)
 K PLUS G ^PRS8MSC0
"RTN","PRS8MISC",83,0)
 ;
"RTN","PRS8MISC",84,0)
SET ; Set sleep time into WK arrary
"RTN","PRS8MISC",85,0)
 Q:D<1!(D>14)
"RTN","PRS8MISC",86,0)
 S WEEK=$S(D>7:2,1:1)
"RTN","PRS8MISC",87,0)
 S $P(WK(WEEK),"^",P)=$P(WK(WEEK),"^",P)+Y
"RTN","PRS8MISC",88,0)
 Q
"RTN","PRS8MT")
0^16^B47758629^B44975495
"RTN","PRS8MT",1,0)
PRS8MT ;HISC/MRL-DECOMPOSITION, MEALTIME ;03/10/08
"RTN","PRS8MT",2,0)
 ;;4.0;PAID;**2,40,69,102,109,112,116,117**;Sep 21, 1995;Build 32
"RTN","PRS8MT",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRS8MT",4,0)
 ;
"RTN","PRS8MT",5,0)
 ;This routine is used to determine placement of mealtime where
"RTN","PRS8MT",6,0)
 ;necessary.
"RTN","PRS8MT",7,0)
 ;
"RTN","PRS8MT",8,0)
 ;Called by Routines:  PRS8ST
"RTN","PRS8MT",9,0)
 ;
"RTN","PRS8MT",10,0)
MULT ; --- checking 1 node
"RTN","PRS8MT",11,0)
 I $$HOLIDAY^PRS8UT(PY,DFN,MDY),$G(^PRST(458,PY,"E",DFN,"D",MDY,2))["MID^MID^ON" Q  ;don't add meal if mid-mid on-call on a holiday, quit routine
"RTN","PRS8MT",12,0)
 S TWO=DAY(MDY,"TWO")
"RTN","PRS8MT",13,0)
 S S=1 D SET D:'Q  I TWO S S=2 D SET D:'Q
"RTN","PRS8MT",14,0)
 .S D1="",$P(D1,"0",193)="",V(1)=97,V(2)=0
"RTN","PRS8MT",15,0)
 .F I=1:3:28 S V=$P(N,"^",I,I+2) Q:$P(V,"^",1)=""  D
"RTN","PRS8MT",16,0)
 ..S X=$P(V,"^",3) I "^^6^7^3^8^"'[("^"_X_"^") Q  ;quit if not NH
"RTN","PRS8MT",17,0)
 ..F M=$P(V,"^"):1:$P(V,"^",2) D  ; build up tour
"RTN","PRS8MT",18,0)
 ...S D1=$E(D1,1,M-1)_$S(X=""!(X=3):1,X=6:2,1:3)_$E(D1,M+1,192)
"RTN","PRS8MT",19,0)
 ...I V(1)>M S V(1)=M
"RTN","PRS8MT",20,0)
 ...I V(2)<M S V(2)=M
"RTN","PRS8MT",21,0)
 ..Q
"RTN","PRS8MT",22,0)
 .D:V(2) GETY
"RTN","PRS8MT",23,0)
 .F I="N","W" F J=MDY,MDY+1 S X=$G(DAY(J,I)) D
"RTN","PRS8MT",24,0)
 ..I X'="" S ^TMP($J,"PRS8",J,I)=X
"RTN","PRS8MT",25,0)
 ..Q
"RTN","PRS8MT",26,0)
 .Q
"RTN","PRS8MT",27,0)
 ;
"RTN","PRS8MT",28,0)
END ; --- all done here
"RTN","PRS8MT",29,0)
 K A,B,C,D,DIF,DIF1,J,L,M,M1,MID,MT,N,PM,T,SPL,SPLX,USE,V(1),V(2),VT,X,X1,X2,Y
"RTN","PRS8MT",30,0)
 Q
"RTN","PRS8MT",31,0)
 ;
"RTN","PRS8MT",32,0)
GETY ; --- this is where Y (placement of mealtime) is defined
"RTN","PRS8MT",33,0)
 S X=$E(D,V(1),V(2)),D1=$E(D1,V(1),V(2))
"RTN","PRS8MT",34,0)
 N ORIGX,RECESS
"RTN","PRS8MT",35,0)
 S ORIGX=X ; Original copy of codes in X and
"RTN","PRS8MT",36,0)
 S RECESS=DAY(MDY,"r")_$G(DAY(MDY,"rN"))
"RTN","PRS8MT",37,0)
 S RECESS=$E(RECESS,V(1),V(2)) ; load any Recess
"RTN","PRS8MT",38,0)
 I X["5" D
"RTN","PRS8MT",39,0)
 . N DAYP
"RTN","PRS8MT",40,0)
 . ; loop thru string X and replace 5s by a leave code if one exists
"RTN","PRS8MT",41,0)
 . S DAYP=$E(DAY(MDY,"P"),V(1),V(2)) ; leave may be hidden here
"RTN","PRS8MT",42,0)
 . F M=1:1:$L(X) D
"RTN","PRS8MT",43,0)
 . . I $E(X,M)=5,$E(DAYP,M)'=0 S $E(X,M)=$E(DAYP,M)
"RTN","PRS8MT",44,0)
 S MID=V(2)-V(1)+1-MT\2,MID=MID+V(1) ;middle of tour
"RTN","PRS8MT",45,0)
 S PM=+$P($G(^PRST(457.1,+$P(DAY(MDY,0),"^",$S(S=1:2,1:13)),0)),"^",7) ;0=non=prem meal/1=prem. meal
"RTN","PRS8MT",46,0)
 S X1=$E(X),Q=1
"RTN","PRS8MT",47,0)
 F M=1:1:$L(X) D  Q:'Q
"RTN","PRS8MT",48,0)
 .S Y=$E(X,M)
"RTN","PRS8MT",49,0)
 .I "1235C"[Y,"1235C"[X1 Q  ; scheduled work time
"RTN","PRS8MT",50,0)
 .I "4OC"[Y,$E(RECESS,M)="r" S Q=0 Q  ; Work performed while on Recess (9mo AWS)
"RTN","PRS8MT",51,0)
 .I Y'="O",Y'=X1 S Q=0 Q  ; not same type of time, and non-OT
"RTN","PRS8MT",52,0)
 .I Y="O",($E(DAY($S(V(1)+M-1<97:MDY,1:MDY+1),"HOL"),$S(V(1)+M-1<97:V(1)+M-1,1:V(1)+M-1-96))'=2) S Q=0 Q  ; OT indicating non-holiday worked gets no meal
"RTN","PRS8MT",53,0)
 .I Y="O",($E(DAY($S(V(1)+M-1<97:MDY,1:MDY+1),"HOL"),$S(V(1)+M-1<97:V(1)+M-1,1:V(1)+M-1-96))=2),"123C"[X1 S Q=0 Q  ; OT indicating holiday worked and Excused.
"RTN","PRS8MT",54,0)
 .Q
"RTN","PRS8MT",55,0)
 I X["0" D
"RTN","PRS8MT",56,0)
 .I RECESS'["r" S SPL=$TR(X,"1235"),SPLX=$TR(X,SPL,$TR($J("",$L(SPL))," "))
"RTN","PRS8MT",57,0)
 .I RECESS["r" S SPL=$TR(X,"01235"),SPLX=$TR(X,SPL,$TR($J("",$L(SPL))," "))
"RTN","PRS8MT",58,0)
 .I SPLX="" S Q=1
"RTN","PRS8MT",59,0)
 ;
"RTN","PRS8MT",60,0)
 K M
"RTN","PRS8MT",61,0)
 ;--- one activity for entire tour
"RTN","PRS8MT",62,0)
 I Q S Q=0 D  F M=1:1:MT S M(M)=Y+M-1
"RTN","PRS8MT",63,0)
 .I V(1)>24,V(2)<73 S Y=MID Q  ;no premium time involved/ meal in middle
"RTN","PRS8MT",64,0)
 .S Q=0 D  ;check for all premium
"RTN","PRS8MT",65,0)
 ..I V(1)<25,V(2)<25 S Q=1 Q  ;all hours before 6am
"RTN","PRS8MT",66,0)
 ..I V(1)>72,V(2)>72,V(2)'>120 S Q=1 Q  ;all hours after 6pm
"RTN","PRS8MT",67,0)
 .I Q S Y=MID Q  ; all time premium time/ meal in middle
"RTN","PRS8MT",68,0)
 .I PM S Y=0 D
"RTN","PRS8MT",69,0)
 ..I V(2)>72 S Y=73-$S(V(2)-73>MT&(V(1)'>73):0,V(1)<25!(V(2)'<121):73,1:MT-(V(2)-73))
"RTN","PRS8MT",70,0)
 ..I 'Y,V(1)<25 S Y=$S(25-V(1)>MT:25-MT,1:V(1))
"RTN","PRS8MT",71,0)
 ..I 'Y S Y=$S(121-V(1)>MT:121-MT,1:V(1))
"RTN","PRS8MT",72,0)
 .E  S Y=0 D
"RTN","PRS8MT",73,0)
 ..I V(2)>72 S Y=$S(73-MT>V(1):73-MT,V(1)<25!(V(2)'<121):0,1:V(1))
"RTN","PRS8MT",74,0)
 ..I 'Y,V(1)<25 S Y=$S(V(2)-MT>24:25,1:V(2)-MT+1)
"RTN","PRS8MT",75,0)
 ..I 'Y S Y=$S(V(2)-MT>120:121,1:V(2)-MT+1)
"RTN","PRS8MT",76,0)
 .I 'Y S Y=MID
"RTN","PRS8MT",77,0)
 .Q
"RTN","PRS8MT",78,0)
 ; --- multiple activities per tour
"RTN","PRS8MT",79,0)
 E  D
"RTN","PRS8MT",80,0)
 .S Z=$TR(X,"1235"),X=$TR(X,Z,$TR($J("",$L(Z))," ","0"))
"RTN","PRS8MT",81,0)
 .;
"RTN","PRS8MT",82,0)
 .; if leave posted > or = to tour length + mt (ie didn't post around 
"RTN","PRS8MT",83,0)
 .; lunch) it was resulting in OT (ZRIK strips HOL, OC, & no tour time)
"RTN","PRS8MT",84,0)
 .;
"RTN","PRS8MT",85,0)
 .N ZRIK
"RTN","PRS8MT",86,0)
 .S ZRIK=$TR(Z,"HC0") I MT>0,$L(ZRIK)'<(($P(DAY(DAY,0),"^",8)*4)+MT) S X="",$P(X,"1",$L(ZRIK)+1)="" ;if leave posted > or = to tour length + mt (ie didn't post around lunch) it was resulting in OT (ZRIK strips HOL & OC)
"RTN","PRS8MT",87,0)
 .Q:X?1"0"."0"&(RECESS'["r")
"RTN","PRS8MT",88,0)
 .S M=0 F A=1,2 Q:M=MT  F B=MID,MID+1,MID-1:-1:V(1),MID+2:1:V(2) D  Q:M=MT
"RTN","PRS8MT",89,0)
 ..Q:'$E(X,B-V(1)+1)
"RTN","PRS8MT",90,0)
 ..I A=1,PM,B<25!(B>72&(B<121)) S M=M+1,M(M)=B
"RTN","PRS8MT",91,0)
 ..I A=1,'PM,B>24&(B<73)!(B>120) S M=M+1,M(M)=B
"RTN","PRS8MT",92,0)
 ..I A=2 S M=M+1,M(M)=B
"RTN","PRS8MT",93,0)
 ..Q
"RTN","PRS8MT",94,0)
 .Q
"RTN","PRS8MT",95,0)
 Q:'$O(M(0))
"RTN","PRS8MT",96,0)
Y ; --- this is where meals get placed in string
"RTN","PRS8MT",97,0)
 F Y=0:0 S Y=$O(M(Y)) Q:Y'>0  D
"RTN","PRS8MT",98,0)
 . N ORIGAC ; original activity code
"RTN","PRS8MT",99,0)
 . S M=M(Y),(X,ORIGAC)=$E(D,M),X=$S(X="J":"A",X=5:$E(DAY(MDY,"P"),M),1:X)
"RTN","PRS8MT",100,0)
 . ; If a 9mo AWS works during Recess don't place meal over that type of time
"RTN","PRS8MT",101,0)
 . I +NAWS=9 D  ; 9mo AWS nurses
"RTN","PRS8MT",102,0)
 . . ; If extra work (UN,OT,CT) was posted over the entire tour including the meal time
"RTN","PRS8MT",103,0)
 . . ; don't include meal time in the W node or you will reduce the extra work count.
"RTN","PRS8MT",104,0)
 . . ; Set X=0 to reduce the Recess count below.
"RTN","PRS8MT",105,0)
 . . I "4OECQ"[ORIGAC&($L(ORIGX)=$L($TR(ORIGX,"1235"))) S X=0 Q
"RTN","PRS8MT",106,0)
 . . ;
"RTN","PRS8MT",107,0)
 . . ; If extra work posted over tour time that wasn't covered by Recess it will
"RTN","PRS8MT",108,0)
 . . ; be stored in the r node.  If this time exists, add that time back into the 
"RTN","PRS8MT",109,0)
 . . ; W node instead of the meal time.
"RTN","PRS8MT",110,0)
 . . I "1235"[ORIGAC,"4OEC"[$E(RECESS,M-V(1)+1) D  Q
"RTN","PRS8MT",111,0)
 . . . S D=$E(D,0,M-1)_$E(RECESS,M-V(1)+1)_$E(D,M+1,999)
"RTN","PRS8MT",112,0)
 . . . S ORIGX=$E(ORIGX,1,M-V(1)-1)_$E(RECESS,M-V(1)+1)_$E(ORIGX,M-V(1)+2,999)
"RTN","PRS8MT",113,0)
 . . ;
"RTN","PRS8MT",114,0)
 . . ; For everything else, update D and ORIGX
"RTN","PRS8MT",115,0)
 . . S D=$E(D,0,M-1)_"m"_$E(D,M+1,999)
"RTN","PRS8MT",116,0)
 . . S ORIGX=$E(ORIGX,M-V(1)-1)_"m"_$E(ORIGX,M-V(1)+2,999)
"RTN","PRS8MT",117,0)
 . ;
"RTN","PRS8MT",118,0)
 . ; All employees other than 9mo AWS
"RTN","PRS8MT",119,0)
 . I +NAWS'=9 S D=$E(D,0,M-1)_"m"_$E(D,M+1,999)
"RTN","PRS8MT",120,0)
 . ;
"RTN","PRS8MT",121,0)
 . ; The following line has been updated to include a check for Recess as the 48th piece.
"RTN","PRS8MT",122,0)
 . ; Recess will be designated as a zero (0).
"RTN","PRS8MT",123,0)
 . S X=$S(X'="M":$F("LSWnAR*U************************V********YXFGD*0****Z*q",X)-1,1:5)
"RTN","PRS8MT",124,0)
 . ;
"RTN","PRS8MT",125,0)
 . ; Firefighter checks
"RTN","PRS8MT",126,0)
 . I "Ff"[TYP,NH'=480!(NH(1)'=NH(2)) S X=32
"RTN","PRS8MT",127,0)
 . ;I X'=4,CYA2806>0 S CYA2806=CYA2806-1 ; << ADDED-> DROP LUNCH FROM CY ALSO>>
"RTN","PRS8MT",128,0)
 . Q:X'>0
"RTN","PRS8MT",129,0)
 . Q:MDY=0&(M(Y)<96)!(MDY=14&(M(Y)>97))
"RTN","PRS8MT",130,0)
 . S W=$S(MDY<8:1,1:2) I MDY=7&(M(Y)>96) S W=2
"RTN","PRS8MT",131,0)
 . I $P(WK(W),"^",+X)>0 S $P(WK(W),"^",+X)=$P(WK(W),"^",+X)-1 ;subtract
"RTN","PRS8MT",132,0)
 . ;
"RTN","PRS8MT",133,0)
 . ; If Military Leave subtract the mealtime out of the WK(3) array.
"RTN","PRS8MT",134,0)
 . I ORIGAC="M",$P(WK(3),U,11)>0 S $P(WK(3),U,11)=$P(WK(3),U,11)-1
"RTN","PRS8MT",135,0)
 . ;I WPCYA>0 S WPCYA=WPCYA-1 ;lunch from total << AND FROM CA TOTAL >>
"RTN","PRS8MT",136,0)
 . ; PRS*4*40 added 8 (U), 44 (F), 45 (G), 46 (D) to following line
"RTN","PRS8MT",137,0)
 . ; because PRS8AC also increments LU for those types of time
"RTN","PRS8MT",138,0)
 . I +X,"^1^2^6^8^44^45^46^53^55^"[("^"_+X_"^") S LU=LU-1 ;reduce leave used
"RTN","PRS8MT",139,0)
 . I +X,"^3^"[("^"_+X_"^"),"P"[TYP S TH=TH+1,TH(W)=TH(W)+1
"RTN","PRS8MT",140,0)
 . Q
"RTN","PRS8MT",141,0)
 S DAY(MDY,"W")=$E(D,1,96)
"RTN","PRS8MT",142,0)
 S X=$E(D,97,999) I $L(X) D
"RTN","PRS8MT",143,0)
 .I $D(DAY(MDY+1,"W")) S DAY(MDY+1,"W")=X_$E(DAY(MDY+1,"W"),$L(X)+1,999)
"RTN","PRS8MT",144,0)
 .S DAY(MDY,"N")=X
"RTN","PRS8MT",145,0)
 Q
"RTN","PRS8MT",146,0)
 ;
"RTN","PRS8MT",147,0)
SET ; --- set up for processing
"RTN","PRS8MT",148,0)
 K A,B S (A,B,Q,Y)=0
"RTN","PRS8MT",149,0)
 S MT=$G(DAY(MDY,"MT"_S)) I MT'>0 S Q=1 Q  ; mealtime for tour?
"RTN","PRS8MT",150,0)
 S D=DAY(MDY,"W")_$G(DAY(MDY,"N")) ; get daily activity
"RTN","PRS8MT",151,0)
 S N=DAY(MDY,S*S) ; get tour
"RTN","PRS8MT",152,0)
 Q
"RTN","PRS8OC")
0^92^B43576335^B43489130
"RTN","PRS8OC",1,0)
PRS8OC ;HISC/MGD-DECOMPOSITION, ON-CALL ;02/27/07
"RTN","PRS8OC",2,0)
 ;;4.0;PAID;**63,92,112,117**;Sep 21, 1995;Build 32
"RTN","PRS8OC",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRS8OC",4,0)
 ;
"RTN","PRS8OC",5,0)
 ;The following MUMPS code is used to credit the appropriate
"RTN","PRS8OC",6,0)
 ;categories on the timecard for work performed while On-Call.
"RTN","PRS8OC",7,0)
 ;All hours during which an individual is identified as being
"RTN","PRS8OC",8,0)
 ;On-Call are credited to blocks YD and YH (On Call Hrs) on
"RTN","PRS8OC",9,0)
 ;the timecard.  Hours during an On-Call episode where an
"RTN","PRS8OC",10,0)
 ;individual is actually called in to perform work are credited
"RTN","PRS8OC",11,0)
 ;to blocks YA and YE (Sch CB OT) as appropriate.  This credit
"RTN","PRS8OC",12,0)
 ;is given under the 2-hour minimum rule.  When OT work is
"RTN","PRS8OC",13,0)
 ;performed during On-Call the actual On-Call Hours reported
"RTN","PRS8OC",14,0)
 ;are reduced by the ACTUAL number of hours worked (not by the
"RTN","PRS8OC",15,0)
 ;2-hour minimum).
"RTN","PRS8OC",16,0)
 ;
"RTN","PRS8OC",17,0)
 ;Called by Routines: PRS8ST
"RTN","PRS8OC",18,0)
 ;
"RTN","PRS8OC",19,0)
 ;C = On-Call
"RTN","PRS8OC",20,0)
 ;c = OT during OC
"RTN","PRS8OC",21,0)
 ;t = CT during OC
"RTN","PRS8OC",22,0)
 ;
"RTN","PRS8OC",23,0)
 S (I,D)=$S(T'>96:DAY,1:(DAY+1))
"RTN","PRS8OC",24,0)
 S OC=$G(OC),OC(DAY)=$G(OC(DAY)),OC(DAY+1)=$G(OC(DAY+1)) ;oc variables
"RTN","PRS8OC",25,0)
 S CC=$G(CC),CC(DAY)=$G(CC(DAY)),CC(DAY+1)=$G(CC(DAY+1)) ;CT on OC count
"RTN","PRS8OC",26,0)
 S Y=35,Y(1)=1 D SET
"RTN","PRS8OC",27,0)
 I VAR1="C" D:OC!(CC) OCS ;on-call episode (ot OR ct)
"RTN","PRS8OC",28,0)
 S:"ct"[VAR1 OC=OC+1,OC(D)=OC(D)+1 S:VAR1="t" CC=CC+1,CC(D)=CC(D)+1
"RTN","PRS8OC",29,0)
 I "ct"[VAR1,DAY>0,DAY<15 S CBCK(WK)=CBCK(WK)+1 ;count actual CB hrs
"RTN","PRS8OC",30,0)
 Q:'OK!('$D(OC))
"RTN","PRS8OC",31,0)
 I OC S Y=23 D OCS ;get rest of them
"RTN","PRS8OC",32,0)
 K OC,CC,Y,D Q
"RTN","PRS8OC",33,0)
 ;
"RTN","PRS8OC",34,0)
OCS ; --- set On-Call minimum hours
"RTN","PRS8OC",35,0)
 ;set YA/YE for PPI="W" or "V" else set OT
"RTN","PRS8OC",36,0)
 I +NAWS=0 S Y=$S(CC:7,'DOUB:TOUR+19,1:23)
"RTN","PRS8OC",37,0)
 I +NAWS S Y=$S(CC:7,1:TOUR+19)
"RTN","PRS8OC",38,0)
 ;
"RTN","PRS8OC",39,0)
 N X,Z,DD,TT,CCCNT,NEXTT,OCCNT,TIMECNT
"RTN","PRS8OC",40,0)
 S TT=$S(T>96:T-96,1:T),TIMECNT=0
"RTN","PRS8OC",41,0)
 S X=$E(DAY($S(T>96:DAY+1,1:DAY),"W"),TT)
"RTN","PRS8OC",42,0)
 ;
"RTN","PRS8OC",43,0)
 ; If the current segment is the last of the On-Call OR the last of
"RTN","PRS8OC",44,0)
 ; the On-Call Callback and the next time segment is Unavailable ("-")
"RTN","PRS8OC",45,0)
 ; or not a type of work ("0") check to see if OT/reg sched is prior
"RTN","PRS8OC",46,0)
 ; to on call worked.
"RTN","PRS8OC",47,0)
 ;
"RTN","PRS8OC",48,0)
 S NEXTT=$S(T+1>96:T-95,1:TT+1) ; Next time segment
"RTN","PRS8OC",49,0)
 I "C"[X!(("ct"[X)&("-0"[$E($S(T+1>96:DAY(DAY+1,"W"),1:DAY(DAY,"W")),NEXTT))) D
"RTN","PRS8OC",50,0)
 .K XH S X=0 F Z=1:1:8-(OC(DAY)+$G(OC(DAY+1))) D  Q:"01"[X
"RTN","PRS8OC",51,0)
 ..S DD=OC(DAY)+OC(DAY+1)+Z
"RTN","PRS8OC",52,0)
 ..I TT-DD>0 S X=$E(DAY(DAY,"W"),TT-DD) S:X="O"&($E(DAY(DAY,"HOL"),TT-DD)=2) X="h"
"RTN","PRS8OC",53,0)
 ..E  S X=$E(DAY(DAY-1,"W"),96+T-DD) S:X="O"&($E(DAY(DAY-1,"HOL"),96+T-DD)=2) X="h"
"RTN","PRS8OC",54,0)
 ..I "123nHMLSWNARXYFGDUZq"[X S X=1 Q  ; on call abuts a reg sched TOD.
"RTN","PRS8OC",55,0)
 ..E  I "EOhoscteQ"[X D  ; on call abuts time worked outside posted TOD.
"RTN","PRS8OC",56,0)
 ...I "ct"'[X S TIMECNT=TIMECNT+1 ; Time already counted in WK(). 
"RTN","PRS8OC",57,0)
 ...S XH=$S(X'="h":0,1:1),X=2
"RTN","PRS8OC",58,0)
 ..E  S X=0
"RTN","PRS8OC",59,0)
 ..Q
"RTN","PRS8OC",60,0)
 .Q
"RTN","PRS8OC",61,0)
 E  D  ; Check to see if OT/reg sched is after on call worked
"RTN","PRS8OC",62,0)
 .K XH S X=0 F Z=1:1:8-(OC(DAY)+$G(OC(DAY+1))) D  Q:"01"[X
"RTN","PRS8OC",63,0)
 ..S DD=OC(DAY)+OC(DAY+1)+Z
"RTN","PRS8OC",64,0)
 ..I T+Z'>96 S X=$E(DAY(DAY,"W"),T+Z) S:X="O"&($E(DAY(DAY,"HOL"),T+Z)=2) X="h"
"RTN","PRS8OC",65,0)
 ..E  S X=$E(DAY(DAY+1,"W"),T-96+Z) S:X="O"&($E(DAY(DAY+1,"HOL"),T-96+Z)=2) X="h"
"RTN","PRS8OC",66,0)
 ..I "123nHMLSWNARXYFGDUZq"[X S X=1 Q  ; on call abuts a reg sched TOD.
"RTN","PRS8OC",67,0)
 ..E  I "EOhoscteQ"[X D
"RTN","PRS8OC",68,0)
 ...I "ct"'[X S TIMECNT=TIMECNT+1 ; Time already counted in WK(). 
"RTN","PRS8OC",69,0)
 ...S XH=$S(X'="h":0,1:1),X=2
"RTN","PRS8OC",70,0)
 ..E  S X=0
"RTN","PRS8OC",71,0)
 ..Q
"RTN","PRS8OC",72,0)
 .Q
"RTN","PRS8OC",73,0)
 I $G(XH)'="" S:XH=1!'X Z=Z-1,X=2
"RTN","PRS8OC",74,0)
 ;
"RTN","PRS8OC",75,0)
 ; Check if Scheduled Call-Back OT crosses Midnight
"RTN","PRS8OC",76,0)
 ;
"RTN","PRS8OC",77,0)
 I '$D(CRSMID(D)),$E(DAY(DAY,"W"),1)="c",$E(DAY(DAY-1,"W"),96)="c" S FG=0 D  Q:FG=1
"RTN","PRS8OC",78,0)
 .S CRSMID(D)=1
"RTN","PRS8OC",79,0)
 .I OC<7 D  Q:FG=1
"RTN","PRS8OC",80,0)
 ..; crosses midnight, check if its <2 hours, CRSMID variable set to 
"RTN","PRS8OC",81,0)
 ..; only do on segment that cross mid, not others
"RTN","PRS8OC",82,0)
 ..S CNTR=0 F CX=1:1:8-OC S:$E(DAY(DAY-1,"W"),97-CX)="c" CNTR=CNTR+1
"RTN","PRS8OC",83,0)
 ..I OC+CNTR'>8 D
"RTN","PRS8OC",84,0)
 ...S Y(1)=$S(X=1:OC,1:8-CNTR)
"RTN","PRS8OC",85,0)
 ...I +NAWS=0 D CHOL ; Process everyone but AWS nurses
"RTN","PRS8OC",86,0)
 ...I +NAWS D CHOL1 ; Process AWS nurses
"RTN","PRS8OC",87,0)
 ...S (OC,OC(D),CC,CC(D))=0,FG=1
"RTN","PRS8OC",88,0)
 ..Q
"RTN","PRS8OC",89,0)
 ;
"RTN","PRS8OC",90,0)
 ; Check if Comp Time crosses Midnight
"RTN","PRS8OC",91,0)
 ;
"RTN","PRS8OC",92,0)
 I '$D(CRSMID(D)),$E(DAY(DAY,"W"),1)="t",$E(DAY(DAY-1,"W"),96)="t" S FG=0 D  Q:FG=1
"RTN","PRS8OC",93,0)
 .S CRSMID(D)=1
"RTN","PRS8OC",94,0)
 .I OC<7 D  Q:FG=1
"RTN","PRS8OC",95,0)
 ..; crosses midnight, check if its <2 hours, CRSMID variable set to 
"RTN","PRS8OC",96,0)
 ..; only do on segment that cross mid, not others
"RTN","PRS8OC",97,0)
 ..S CNTR=0 F CX=1:1:8-OC S:$E(DAY(DAY-1,"W"),97-CX)="t" CNTR=CNTR+1
"RTN","PRS8OC",98,0)
 ..I OC+CNTR'>8 D
"RTN","PRS8OC",99,0)
 ...S Y(1)=$S(X=1:OC,1:8-CNTR)
"RTN","PRS8OC",100,0)
 ...I +NAWS=0 D CHOL ; Process everyone but AWS nurses
"RTN","PRS8OC",101,0)
 ...I +NAWS D CHOL1 ; Process AWS nurses
"RTN","PRS8OC",102,0)
 ...S (OC,OC(D),CC,CC(D))=0,FG=1
"RTN","PRS8OC",103,0)
 ..Q
"RTN","PRS8OC",104,0)
 ;
"RTN","PRS8OC",105,0)
 I CC>0,CC<OC D  ;SPLIT SEGMENT, MUST DO TWICE (FOR CT THEN FOR OT)
"RTN","PRS8OC",106,0)
 .F I=DAY:1:(DAY+1) I OC(I) D
"RTN","PRS8OC",107,0)
 ..S (OCCNT,CCCNT)=0
"RTN","PRS8OC",108,0)
 ..I X=2,OC(I)+TIMECNT<8 D   ; Add time if 2 hour minimum was not met.
"RTN","PRS8OC",109,0)
 ...S TIMECNT=8-OC(I)-TIMECNT ; Amount of time short of the 2 hour min.
"RTN","PRS8OC",110,0)
 ...;
"RTN","PRS8OC",111,0)
 ...; If TIMECNT is an even number divide needed time equally among the
"RTN","PRS8OC",112,0)
 ...; CT and OT.
"RTN","PRS8OC",113,0)
 ...I TIMECNT#2=0 S CCCNT=TIMECNT/2,OCCNT=TIMECNT/2
"RTN","PRS8OC",114,0)
 ...;
"RTN","PRS8OC",115,0)
 ...; If TIMECNT is not an even number divide the time needed as equally
"RTN","PRS8OC",116,0)
 ...; as possible among the CT and OT w/ remaining 15 minutes going to OC.
"RTN","PRS8OC",117,0)
 ...I TIMECNT#2=1 S CCCNT=TIMECNT\2,OCCNT=(TIMECNT\2)+1
"RTN","PRS8OC",118,0)
 ...;
"RTN","PRS8OC",119,0)
 ..S Y(1)=$S(X=2:CC(I)+CCCNT,X:CC(I),OC(I)>7:CC(I),1:4),Y=7
"RTN","PRS8OC",120,0)
 ..I +NAWS=0 D CHOL ; Process everyone but AWS nurses
"RTN","PRS8OC",121,0)
 ..I +NAWS D CHOL1 ; Process AWS nurses
"RTN","PRS8OC",122,0)
 ..S Y(1)=$S(X=2:OC(I)-CC(I)+OCCNT,X:OC(I)-CC(I),OC(I)>7:OC(I)-CC(I),1:4)
"RTN","PRS8OC",123,0)
 ..S Y=$S('DOUB:TOUR+19,1:23)
"RTN","PRS8OC",124,0)
 ..I +NAWS=0 D CHOL ; Process everyone but AWS nurses
"RTN","PRS8OC",125,0)
 ..I +NAWS D CHOL1 ; Process AWS nurses
"RTN","PRS8OC",126,0)
 ..Q
"RTN","PRS8OC",127,0)
 .Q
"RTN","PRS8OC",128,0)
 E  D  ;NOT SPLIT SEGMENT
"RTN","PRS8OC",129,0)
 .F I=DAY:1:(DAY+1) I OC(I) D
"RTN","PRS8OC",130,0)
 ..I OC(I)<8,X=2 D
"RTN","PRS8OC",131,0)
 ...I T'=96 S OC(I)=8-TIMECNT
"RTN","PRS8OC",132,0)
 ...I T=96,"ct"'[$E(DAY(DAY+1,"W"),1) S OC(I)=8-TIMECNT
"RTN","PRS8OC",133,0)
 ..S Y(1)=$S(X:OC(I),OC(I)>7:OC(I),1:8)
"RTN","PRS8OC",134,0)
 ..I +NAWS=0 D CHOL ; Process everyone but AWS nurses
"RTN","PRS8OC",135,0)
 ..I +NAWS D CHOL1 ; Process AWS nurses
"RTN","PRS8OC",136,0)
 ..Q
"RTN","PRS8OC",137,0)
 .Q
"RTN","PRS8OC",138,0)
 K OC,CC Q
"RTN","PRS8OC",139,0)
 ;
"RTN","PRS8OC",140,0)
CHOL ; --- Check for Holiday Callback
"RTN","PRS8OC",141,0)
 S TMP=Y,Y=0
"RTN","PRS8OC",142,0)
 ; Don't convert Overtime to Comptime
"RTN","PRS8OC",143,0)
 I TMP'=7,$E(ENT,25),$$HOLIDAY^PRS8UT(PY,DFN,+D) S Y=24 ;ot on actual hol
"RTN","PRS8OC",144,0)
 I 'Y,$E($G(DAY(I,"HOL")),$S(T>96:(T-96),1:T)) S Y=TOUR+28 ;holiday callback
"RTN","PRS8OC",145,0)
 I 'Y S Y=TMP
"RTN","PRS8OC",146,0)
 D SET S Y=$S(CC:7,'DOUB:TOUR+19,1:23)
"RTN","PRS8OC",147,0)
 Q
"RTN","PRS8OC",148,0)
 ;
"RTN","PRS8OC",149,0)
SET ; --- set WK array
"RTN","PRS8OC",150,0)
 S W=$S(I<8:1,1:2)
"RTN","PRS8OC",151,0)
 I I<1!(I>14) Q
"RTN","PRS8OC",152,0)
 I Y(1)>32,'DOUB,$P(C0,"^",12)="N",Y'=7 D
"RTN","PRS8OC",153,0)
 .S $P(WK(W),"^",TOUR+15)=$P(WK(W),"^",TOUR+15)+(Y(1)-32)
"RTN","PRS8OC",154,0)
 .S $P(WK(W),"^",Y)=$P(WK(W),"^",Y)+32 ;if FLSA=N set >8 = DA
"RTN","PRS8OC",155,0)
 E  S $P(WK(W),"^",Y)=$P(WK(W),"^",Y)+Y(1)
"RTN","PRS8OC",156,0)
 Q
"RTN","PRS8OC",157,0)
 ;
"RTN","PRS8OC",158,0)
CHOL1 ; Checks for AWS nurses
"RTN","PRS8OC",159,0)
 N HT,J,K,T2ADD
"RTN","PRS8OC",160,0)
 S K=0,TMP=Y,Y=0
"RTN","PRS8OC",161,0)
 S T2ADD=$S(CC:Y(1)-CC,1:Y(1)-OC-CC)
"RTN","PRS8OC",162,0)
 ; Apply normal checks for OT on Hol and Hol Callback
"RTN","PRS8OC",163,0)
 I TMP'=7,$E(ENT,25),$$HOLIDAY^PRS8UT(PY,DFN,+D) S Y=24 ;ot on actual hol
"RTN","PRS8OC",164,0)
 I 'Y,$E($G(DAY(I,"HOL")),$S(T>96:(T-96),1:T)) S Y=TOUR+28 ;holiday callback
"RTN","PRS8OC",165,0)
 I 'Y S Y=TMP
"RTN","PRS8OC",166,0)
 I Y=24!(Y=(TOUR+28)) D SET Q
"RTN","PRS8OC",167,0)
 ; If not OT on Hol or Hol Callback Determine if we are setting OT or CT
"RTN","PRS8OC",168,0)
 S K=$S(Y=7:CC,1:OC)
"RTN","PRS8OC",169,0)
 F J=1:1:K D AWSWK ; Update actual time worked
"RTN","PRS8OC",170,0)
 F J=1:1:T2ADD D AWSWK ; Update time added to reach 2 hour min
"RTN","PRS8OC",171,0)
 Q
"RTN","PRS8OC",172,0)
 ;
"RTN","PRS8OC",173,0)
AWSWK ; Determine what type of time to add based on 8/day and 40/wk
"RTN","PRS8OC",174,0)
 S HT=+$G(^TMP($J,"PRS8",D,"HT"))
"RTN","PRS8OC",175,0)
 I HT'<32 S Y=$S(Y'=7:TOUR+15,1:Y) D SET1 Q
"RTN","PRS8OC",176,0)
 I TH(W)'<160 S Y=$S(Y'=7:TOUR+19,1:Y) D SET1 Q
"RTN","PRS8OC",177,0)
 I HT<32,TH(W)<160 S Y=9 D SET1
"RTN","PRS8OC",178,0)
 Q
"RTN","PRS8OC",179,0)
 ;
"RTN","PRS8OC",180,0)
SET1 ; Set WK array for AWS nurses
"RTN","PRS8OC",181,0)
 S $P(WK(W),"^",Y)=$P(WK(W),"^",Y)+1
"RTN","PRS8OC",182,0)
 Q:HT'<32
"RTN","PRS8OC",183,0)
 S TH=TH+1,TH(WK)=TH(WK)+1
"RTN","PRS8OC",184,0)
 S ^TMP($J,"PRS8",DAY,"HT")=HT+1
"RTN","PRS8OC",185,0)
 Q
"RTN","PRS8OTFF")
0^19^B12892610^B12536879
"RTN","PRS8OTFF",1,0)
PRS8OTFF ;WCIOFO/MGD-OVERTIME/UNSCH FOR CODE R,C FIREFIGHTERS ;01/11/08
"RTN","PRS8OTFF",2,0)
 ;;4.0;PAID;**45,54,102,117**;Sep 21, 1995;Build 32
"RTN","PRS8OTFF",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRS8OTFF",4,0)
 ;
"RTN","PRS8OTFF",5,0)
 ;  routine called from PRS8ST when a premium pay indicator for
"RTN","PRS8OTFF",6,0)
 ;  a firefighter is R or C.
"RTN","PRS8OTFF",7,0)
 ;
"RTN","PRS8OTFF",8,0)
FFOTUN ;CALCULATE CODE R AND C FIREFIGHTERS OVERTIME AND UNSCHEDULED REGULAR
"RTN","PRS8OTFF",9,0)
 ;
"RTN","PRS8OTFF",10,0)
 N SCHWRK,XTRAWRK
"RTN","PRS8OTFF",11,0)
 ;
"RTN","PRS8OTFF",12,0)
 ;Count up scheduled and unscheduled work for week 1 and 2
"RTN","PRS8OTFF",13,0)
 ;
"RTN","PRS8OTFF",14,0)
 D WORKCNT(.SCHWRK,.XTRAWRK,.XWRK)
"RTN","PRS8OTFF",15,0)
 ;
"RTN","PRS8OTFF",16,0)
 ; Determine overtime and unscheduled based on 53/106 hour rule
"RTN","PRS8OTFF",17,0)
 ; and update the week array with OA/OE, RA/RE and UN/US.
"RTN","PRS8OTFF",18,0)
 ; Code C and R firefighters overtime calculation is the same
"RTN","PRS8OTFF",19,0)
 ; whether on compressed tour or not.
"RTN","PRS8OTFF",20,0)
 ;
"RTN","PRS8OTFF",21,0)
 D CALCOT(.SCHWRK,.XTRAWRK,.XWRK)
"RTN","PRS8OTFF",22,0)
 ;
"RTN","PRS8OTFF",23,0)
 Q
"RTN","PRS8OTFF",24,0)
 ;
"RTN","PRS8OTFF",25,0)
 ;==============================================================
"RTN","PRS8OTFF",26,0)
 ;
"RTN","PRS8OTFF",27,0)
WORKCNT(SCHWRK,XTRAWRK,XWRK) ;
"RTN","PRS8OTFF",28,0)
 ;
"RTN","PRS8OTFF",29,0)
 ;VARIABLE LIST
"RTN","PRS8OTFF",30,0)
 ; DAY: current day of pay period--1 through 14 and 1st day of next (15)
"RTN","PRS8OTFF",31,0)
 ; WEEK: Week 1 or 2 of pay period--days 1-7 are week 1, 8-14 week 2.
"RTN","PRS8OTFF",32,0)
 ; QHRCNT: Counter for a single Quarter Hour segment of day.  There are
"RTN","PRS8OTFF",33,0)
 ;         96 quarter hours in a 24 hour day.
"RTN","PRS8OTFF",34,0)
 ; EXCSTR: 96 char day string with exceptions
"RTN","PRS8OTFF",35,0)
 ; WRKSTR: 96 char string with work codes.
"RTN","PRS8OTFF",36,0)
 ; AFFSTR: 96 char string with additional fire fighter hour segments
"RTN","PRS8OTFF",37,0)
 ;         coded with 1's.
"RTN","PRS8OTFF",38,0)
 ; XWRK: string of extra work time
"RTN","PRS8OTFF",39,0)
 ; QHTCODE: Time code for a single quarter hour segment. 
"RTN","PRS8OTFF",40,0)
 ;    1:scheduled work        A:annual leave      S:sick leave, 
"RTN","PRS8OTFF",41,0)
 ;    W:leave without pay     n:non pay status    U:comp used, 
"RTN","PRS8OTFF",42,0)
 ;    E:comp earned           M:military leave    X:training, 
"RTN","PRS8OTFF",43,0)
 ;    Y:travel                O:overtime          4:unscheduled,
"RTN","PRS8OTFF",44,0)
 ;    T:ot in travel          B:standby           C:on call,
"RTN","PRS8OTFF",45,0)
 ;    N:non pay annual lv     h:holiday worked    F:Care and Bereavement
"RTN","PRS8OTFF",46,0)
 ;    G:adoption              D:donor leave       R:restored annual leave
"RTN","PRS8OTFF",47,0)
 ;    M:military leave        J:jury duty         n:non pay time
"RTN","PRS8OTFF",48,0)
 ;    V:continuation of pay   e:sched comp earn   s:scheduled OT
"RTN","PRS8OTFF",49,0)
 ;     Note:  T:overtime for travel  is counted elsewhere so it can not
"RTN","PRS8OTFF",50,0)
 ;            also be recounted as overtime here.
"RTN","PRS8OTFF",51,0)
 ;
"RTN","PRS8OTFF",52,0)
 N DAY,WEEK,QHRCNT,QHRSEG,WRKSTR,QHTCODE,HOLIDAY
"RTN","PRS8OTFF",53,0)
 ;
"RTN","PRS8OTFF",54,0)
 ;Initialize scheduled work and xtra work counters
"RTN","PRS8OTFF",55,0)
 ;
"RTN","PRS8OTFF",56,0)
 F WEEK=1:1:2 S (SCHWRK(WEEK),XTRAWRK(WEEK))=0,XWRK(WEEK)=""
"RTN","PRS8OTFF",57,0)
 ;
"RTN","PRS8OTFF",58,0)
 ;Loop through Each day of the pay period
"RTN","PRS8OTFF",59,0)
 ;
"RTN","PRS8OTFF",60,0)
 F DAY=1:1:14 D
"RTN","PRS8OTFF",61,0)
 .S WEEK=$S(DAY>7:2,1:1)
"RTN","PRS8OTFF",62,0)
 .S WRKSTR=$G(^TMP($J,"PRS8",DAY,"W")) ; work node includes addt ff hrs.
"RTN","PRS8OTFF",63,0)
 .;
"RTN","PRS8OTFF",64,0)
 .; loop through each 15 min increment of the current day 
"RTN","PRS8OTFF",65,0)
 .; totaling scheduled and unscheduled work
"RTN","PRS8OTFF",66,0)
 .;
"RTN","PRS8OTFF",67,0)
 .F QHRCNT=1:1:96 S QHTCODE=$E(WRKSTR,QHRCNT) Q:'$L(QHTCODE)  D
"RTN","PRS8OTFF",68,0)
 . . ;
"RTN","PRS8OTFF",69,0)
 . . ; SET HOLIDAY TO 0,1,2 FOR NO HOLIDAY, HOL EXUSED, OR HOLIDAY WORKED
"RTN","PRS8OTFF",70,0)
 . . ;
"RTN","PRS8OTFF",71,0)
 . . S HOLIDAY=$$HOLIDAY(QHRCNT,DAY)
"RTN","PRS8OTFF",72,0)
 . . ;
"RTN","PRS8OTFF",73,0)
 . . ; INCREMENT SCHEDULED WORK IF ACCOUNTED FOR WITH APPROPRIATE CODE.
"RTN","PRS8OTFF",74,0)
 . . I "1SLWAUXYBCFGDJRMVnZq"[QHTCODE!(QHTCODE="O"&(HOLIDAY=2)) D
"RTN","PRS8OTFF",75,0)
 . . . S SCHWRK(WEEK)=SCHWRK(WEEK)+1
"RTN","PRS8OTFF",76,0)
 . . ;
"RTN","PRS8OTFF",77,0)
 . . ; Increment any unscheduled work or unscheduled CT or OT
"RTN","PRS8OTFF",78,0)
 . . I "4EeOs"[QHTCODE&(HOLIDAY<1) D
"RTN","PRS8OTFF",79,0)
 . . . S XTRAWRK(WEEK)=XTRAWRK(WEEK)+1
"RTN","PRS8OTFF",80,0)
 . . . S XWRK(WEEK)=XWRK(WEEK)_QHTCODE
"RTN","PRS8OTFF",81,0)
 ;
"RTN","PRS8OTFF",82,0)
 Q
"RTN","PRS8OTFF",83,0)
 ;
"RTN","PRS8OTFF",84,0)
 ;==============================================================
"RTN","PRS8OTFF",85,0)
 ;
"RTN","PRS8OTFF",86,0)
CALCOT(SW,XW,XWS) ;
"RTN","PRS8OTFF",87,0)
 ; Update the week array with overtime
"RTN","PRS8OTFF",88,0)
 ;
"RTN","PRS8OTFF",89,0)
 ;Possible permutations of Scheduled and Unscheduled
"RTN","PRS8OTFF",90,0)
 ;                          |
"RTN","PRS8OTFF",91,0)
 ;                        53|HRS
"RTN","PRS8OTFF",92,0)
 ;                          |
"RTN","PRS8OTFF",93,0)
 ; 1.  SSSSSSSSSSSSSSSSSSSSS|SSSSSSSSS
"RTN","PRS8OTFF",94,0)
 ; 2.  SSSSSSSSSSSSSSSSSSSSS|SSSSSUUUUUUUUUUUU
"RTN","PRS8OTFF",95,0)
 ; 3.  SSSSSSSSSSSSSSSSSSSSS|UUUUUUUUUUUUU
"RTN","PRS8OTFF",96,0)
 ; 4.  SSSSSSSSSSSSSSSSUUUUU|UUUUUUUUUUU
"RTN","PRS8OTFF",97,0)
 ; 5.  SSSSSSSSSSSSSSSSSS   |
"RTN","PRS8OTFF",98,0)
 ; 6.  SSSSSSSSSSSSUUU      |
"RTN","PRS8OTFF",99,0)
 ;
"RTN","PRS8OTFF",100,0)
 ; |------------------------------------------|
"RTN","PRS8OTFF",101,0)
 ; |  After Patch 85          |<= 212 |> 212  |
"RTN","PRS8OTFF",102,0)
 ; |------------------------------------------|
"RTN","PRS8OTFF",103,0)
 ; |Code|    Type of Time     | Piece | Piece |
"RTN","PRS8OTFF",104,0)
 ; |------------------------------------------|
"RTN","PRS8OTFF",105,0)
 ; | ** |All Scheduled Time   |       |  26   |
"RTN","PRS8OTFF",106,0)
 ; | 4  |Unscheduled Regular  |   9   |  20   |
"RTN","PRS8OTFF",107,0)
 ; | E  |Comp Time Earned     |   9   |   7   |
"RTN","PRS8OTFF",108,0)
 ; | e  |Scheduled Comp Time  |   9   |  20   |
"RTN","PRS8OTFF",109,0)
 ; | O  |Overtime             |   9   |  20   |
"RTN","PRS8OTFF",110,0)
 ; | s  |Scheduled Overtime   |   9   |  20   |
"RTN","PRS8OTFF",111,0)
 ; |------------------------------------------|
"RTN","PRS8OTFF",112,0)
 ;
"RTN","PRS8OTFF",113,0)
 N I,P,WEEK,Y,Z
"RTN","PRS8OTFF",114,0)
 F WEEK=1:1:2 D
"RTN","PRS8OTFF",115,0)
 . ;
"RTN","PRS8OTFF",116,0)
 . ; Post Regular Scheduled Hours In Excess of 53 as RA/RE
"RTN","PRS8OTFF",117,0)
 . ; Scenarios 1 & 2
"RTN","PRS8OTFF",118,0)
 . I SW(WEEK)>212 D
"RTN","PRS8OTFF",119,0)
 . . S Y=SW(WEEK)-212,P=26 D SET
"RTN","PRS8OTFF",120,0)
 . ;
"RTN","PRS8OTFF",121,0)
 . ; Post Extra Hours per chart.  Scenarios 2,3,4 & 6
"RTN","PRS8OTFF",122,0)
 . I $L(XWS(WEEK))>0 D
"RTN","PRS8OTFF",123,0)
 . . S Y=1
"RTN","PRS8OTFF",124,0)
 . . ;
"RTN","PRS8OTFF",125,0)
 . . ; step thru extra time segments
"RTN","PRS8OTFF",126,0)
 . . F I=1:1:$L(XWS(WEEK)) D
"RTN","PRS8OTFF",127,0)
 . . . S Z=$E(XWS(WEEK),I)
"RTN","PRS8OTFF",128,0)
 . . . S P=$S(SW(WEEK)+I'>212:9,Z="E":7,Z="e":20,Z="s":20,1:20)
"RTN","PRS8OTFF",129,0)
 . . . D SET
"RTN","PRS8OTFF",130,0)
 . . . ;
"RTN","PRS8OTFF",131,0)
 . . . ; If Scheduled OT or CT after 53 hours, also count as Unscheduled Regular
"RTN","PRS8OTFF",132,0)
 . . . I P=26 S P=9 D SET
"RTN","PRS8OTFF",133,0)
 Q
"RTN","PRS8OTFF",134,0)
 ;
"RTN","PRS8OTFF",135,0)
 ;==============================================================
"RTN","PRS8OTFF",136,0)
 ;
"RTN","PRS8OTFF",137,0)
SET ; Set sleep time into WK array
"RTN","PRS8OTFF",138,0)
 S $P(WK(WEEK),"^",P)=$P(WK(WEEK),"^",P)+Y
"RTN","PRS8OTFF",139,0)
 Q
"RTN","PRS8OTFF",140,0)
 ;
"RTN","PRS8OTFF",141,0)
 ;==============================================================
"RTN","PRS8OTFF",142,0)
 ;
"RTN","PRS8OTFF",143,0)
HOLIDAY(TIMESEG,DAY) ;
"RTN","PRS8OTFF",144,0)
 ;INPUT:
"RTN","PRS8OTFF",145,0)
 ; DAY--day of pay period 1 through 14 or 15 for 1st day of next pp
"RTN","PRS8OTFF",146,0)
 ; TIMESEG--position in 96 character day string (1 to 96)
"RTN","PRS8OTFF",147,0)
 ;OUTPUT:
"RTN","PRS8OTFF",148,0)
 ;  code for holiday worked, holiday exused or neither from the
"RTN","PRS8OTFF",149,0)
 ;  ^TMP($J,"PRS8",DAY,"HOL") global
"RTN","PRS8OTFF",150,0)
 ;      holiday worked coded: 2 
"RTN","PRS8OTFF",151,0)
 ;      holiday exused coded: 1
"RTN","PRS8OTFF",152,0)
 ;      neither coded: 0
"RTN","PRS8OTFF",153,0)
 ;
"RTN","PRS8OTFF",154,0)
 Q $E($G(^TMP($J,"PRS8",DAY,"HOL")),TIMESEG)
"RTN","PRS8PP")
0^20^B69982353^B69818276
"RTN","PRS8PP",1,0)
PRS8PP ;HISC/MRL,WIRMFO/MGD-DECOMP, PREMIUM PAYS ;05/10/07
"RTN","PRS8PP",2,0)
 ;;4.0;PAID;**22,40,75,92,96,112,117**;Sep 21, 1995;Build 32
"RTN","PRS8PP",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRS8PP",4,0)
 ;
"RTN","PRS8PP",5,0)
 ;This routine is the entry point for determining certain premium
"RTN","PRS8PP",6,0)
 ;pays for an employee.  Included are overtime (OT), 
"RTN","PRS8PP",7,0)
 ;night differential (ND), unscheduled hours (UH), etc.
"RTN","PRS8PP",8,0)
 ;
"RTN","PRS8PP",9,0)
 ;Called by Routines:  PRS8ST
"RTN","PRS8PP",10,0)
 ;
"RTN","PRS8PP",11,0)
 S D=DAY(DAY,"W") ;                Daily activity string.
"RTN","PRS8PP",12,0)
 S W=$S(DAY<8:1,1:2) ;             Week.
"RTN","PRS8PP",13,0)
 I D?1"0"."0" Q  ;                 No activity this date.
"RTN","PRS8PP",14,0)
 S NDC=1,(HT,HTP,HTFFOT)=0 ;       Counter for hrs worked this 
"RTN","PRS8PP",15,0)
 ;                                 day (HT=Hours total).
"RTN","PRS8PP",16,0)
 N HYBRID ;                        HYBRID under P.L 107-135
"RTN","PRS8PP",17,0)
 S HYBRID=$$HYBRID^PRSAENT1($G(DFN))
"RTN","PRS8PP",18,0)
 D ^PRS8HR ;                       calculate Norm hrs first
"RTN","PRS8PP",19,0)
 F M=1:1:96 S VAL=$E(D,M) I VAL'=0 D  ;loop thru minutes of day
"RTN","PRS8PP",20,0)
 .S DH=DAY(DAY,"DH1")
"RTN","PRS8PP",21,0)
 .I TWO,M'<+$P(DAY(DAY,"TWO"),"^",2) S DH=DAY(DAY,"DH2") ;    Daily hrs.
"RTN","PRS8PP",22,0)
 .I NDC,"CWB"'[VAL D ND ;                                        Get ND.
"RTN","PRS8PP",23,0)
 .I TYP["B",+VAL Q  ;                  Baylor get no premium during tod.
"RTN","PRS8PP",24,0)
 .I "1234OosEe"'[VAL Q  ;                 Don't chk for non-work status.
"RTN","PRS8PP",25,0)
 .S X=$E(D,M,96) ;                                     Remainder of day.
"RTN","PRS8PP",26,0)
 .I X?1N.N,X'[4 Q  ;                      No hrs left other than normal.
"RTN","PRS8PP",27,0)
 .I "J123MLSWNARXYOFGD"'[VAL!(VAL="O"&($E(DAY(DAY,"HOL"),M)'=2)) S AV="OosEe" D CALC^PRS8HR
"RTN","PRS8PP",28,0)
 K AV,D,GO,M,NDC,X,X1,J1,J2 Q
"RTN","PRS8PP",29,0)
 ;
"RTN","PRS8PP",30,0)
ND ; --- compute ND
"RTN","PRS8PP",31,0)
 ; Process wagegrade
"RTN","PRS8PP",32,0)
 I TYP["W" D  Q
"RTN","PRS8PP",33,0)
 . ; process WG scheduled time
"RTN","PRS8PP",34,0)
 . I "J23LSARMXYUVFGDZq"[VAL!(VAL="O"&($E(DAY(DAY,"HOL"),M)=2)) D
"RTN","PRS8PP",35,0)
 . . N DAT,DAYN,FND,M1,NODE,SC,TS
"RTN","PRS8PP",36,0)
 . . ; find tour segment that contains the time and get it's special code
"RTN","PRS8PP",37,0)
 . . S FND=0,SC="" ; FND true if found in schedule, SC = special code 
"RTN","PRS8PP",38,0)
 . . ; look in schedule of current day for M and previous day for M+96
"RTN","PRS8PP",39,0)
 . . ; (in 2day tour, previous day's schedules >96 are Today's activity)
"RTN","PRS8PP",40,0)
 . . F DAYN=DAY,DAY-1 D  Q:FND
"RTN","PRS8PP",41,0)
 . . . S M1=$S(DAYN=DAY:M,1:M+96)
"RTN","PRS8PP",42,0)
 . . . ; loop thru both tours in day
"RTN","PRS8PP",43,0)
 . . . F NODE=1,4 S DAT=$G(^TMP($J,"PRS8",DAYN,NODE)) Q:DAT=""  D  Q:FND
"RTN","PRS8PP",44,0)
 . . . . ; loop thru tour segments in tour
"RTN","PRS8PP",45,0)
 . . . . F TS=1:1:7 Q:$P(DAT,U,(TS-1)*3+1)=""  D  Q:FND
"RTN","PRS8PP",46,0)
 . . . . . ; check if time contained in tour segment
"RTN","PRS8PP",47,0)
 . . . . . I M1'<$P(DAT,U,(TS-1)*3+1),M1'>$P(DAT,U,(TS-1)*3+2) S FND=1,SC=$P(DAT,U,(TS-1)*3+3)
"RTN","PRS8PP",48,0)
 . . ;
"RTN","PRS8PP",49,0)
 . . ; if time not found in any schedule, base SC on value of variable
"RTN","PRS8PP",50,0)
 . . ;   TOUR for Today (or previous day when no scheduled tour Today).
"RTN","PRS8PP",51,0)
 . . I 'FND S SC=$S($G(^TMP($J,"PRS8",DAY,1))=""&(DAY(DAY-1,"TOUR")>1):DAY(DAY-1,"TOUR")+4,1:TOUR+4)
"RTN","PRS8PP",52,0)
 . . Q:"^6^7^"'[(U_SC_U)  ; tour segment not coded for shift 2 or 3
"RTN","PRS8PP",53,0)
 . . S X=(SC-4)+8 ; determine where to store in WK array
"RTN","PRS8PP",54,0)
 . . I $E(ENT,X-4) D SET ; if employee entitled then store result
"RTN","PRS8PP",55,0)
 . ;
"RTN","PRS8PP",56,0)
 . ; process WG unscheduled time
"RTN","PRS8PP",57,0)
 . I VAL=4!(VAL="O") D
"RTN","PRS8PP",58,0)
 . . N T,SD
"RTN","PRS8PP",59,0)
 . . ; unscheduled regular tours for 'shift coverage' that are eligible
"RTN","PRS8PP",60,0)
 . . ;   for shift 2 or 3 differential were saved in "SD" by PRS8EX.
"RTN","PRS8PP",61,0)
 . . S SD=$G(^TMP($J,"PRS8",DAY,"SD"))
"RTN","PRS8PP",62,0)
 . . Q:SD=""
"RTN","PRS8PP",63,0)
 . . ; see if time belongs to a tour saved in "SD" and if so use the
"RTN","PRS8PP",64,0)
 . . ;   associated shift (2 or 3)
"RTN","PRS8PP",65,0)
 . . S SD(1)=0 ; init shift
"RTN","PRS8PP",66,0)
 . . F T=1:3 S SD(0)=$P(SD,U,T,T+2) Q:SD(0)=""!(SD(0)?1."^")  D  Q:SD(1)
"RTN","PRS8PP",67,0)
 . . . I M'<+SD(0),M'>$P(SD(0),"^",2) S SD(1)=$P(SD(0),"^",3)
"RTN","PRS8PP",68,0)
 . . I SD(1) S X=SD(1)+8 I $E(ENT,X-4) D SET
"RTN","PRS8PP",69,0)
 ;
"RTN","PRS8PP",70,0)
 ; Process Other Employees (non-Wage Grade)
"RTN","PRS8PP",71,0)
 ;
"RTN","PRS8PP",72,0)
 ; Not entitled to ND
"RTN","PRS8PP",73,0)
 I '$E(ENT,6) Q
"RTN","PRS8PP",74,0)
 ;
"RTN","PRS8PP",75,0)
 ; not entitled to ND if No Premium Pay tour
"RTN","PRS8PP",76,0)
 I $P(DAY(DAY,1),"^",3)=8 Q
"RTN","PRS8PP",77,0)
 ;
"RTN","PRS8PP",78,0)
 ; check if time segment could be eligible for ND
"RTN","PRS8PP",79,0)
 I $$NOTND(TYP,DAY,M) Q
"RTN","PRS8PP",80,0)
 ;
"RTN","PRS8PP",81,0)
 S AV="J1234ALSRMUEOosecbVXYFGDZq"
"RTN","PRS8PP",82,0)
 ;
"RTN","PRS8PP",83,0)
 ; Grant ND for time before 6a/after 6p or anytime when nurse/hybrid
"RTN","PRS8PP",84,0)
 ; works tour coverage
"RTN","PRS8PP",85,0)
 I M<25!(M>72)!($E(DAY(DAY,"P"),M)="N"&(TYP["N"!(TYP["H")!(HYBRID))),AV[VAL D
"RTN","PRS8PP",86,0)
 . ; The Hybrids defined in Public Law 107-135 will only receive Night
"RTN","PRS8PP",87,0)
 . ; Differential time for OT and CT worked between 6 p.m. and 6 a.m.
"RTN","PRS8PP",88,0)
 . Q:HYBRID!(PMP'=""&("^S^T^U^V^"[(U_PMP_U)))&(M'<25&(M'>72))
"RTN","PRS8PP",89,0)
 . ; Tour time between 6 p.m. and 6 a.m. counts toward ND
"RTN","PRS8PP",90,0)
 . N DAT,DAYN,FND,M1,NODE,SC,TS,TOT
"RTN","PRS8PP",91,0)
 . ; find tour segment that contains the time and get it's special code
"RTN","PRS8PP",92,0)
 . S FND=0,SC="" ; FND true if found in schedule, SC = special code 
"RTN","PRS8PP",93,0)
 . S TOT="" ; Type Of Time
"RTN","PRS8PP",94,0)
 . ; look in schedule of current day for M and previous day for M+96
"RTN","PRS8PP",95,0)
 . ; (in 2day tour, previous day's schedules >96 are Today's activity)
"RTN","PRS8PP",96,0)
 . F DAYN=DAY,DAY-1 D  Q:FND
"RTN","PRS8PP",97,0)
 . . S M1=$S(DAYN=DAY:M,1:M+96)
"RTN","PRS8PP",98,0)
 . . S DAT=$G(^TMP($J,"PRS8",DAYN,2)) D  Q:FND
"RTN","PRS8PP",99,0)
 . . . ; loop thru tour segments in exceptions
"RTN","PRS8PP",100,0)
 . . . F TS=1:1:7 Q:$P(DAT,U,(TS-1)*4+1)=""  D  Q:FND
"RTN","PRS8PP",101,0)
 . . . . ; check if time contained in exception segment
"RTN","PRS8PP",102,0)
 . . . . I M1'<$P(DAT,U,(TS-1)*4+1),M1'>$P(DAT,U,(TS-1)*4+2) D
"RTN","PRS8PP",103,0)
 . . . . . S TOT=$P(DAT,U,(TS-1)*4+3)
"RTN","PRS8PP",104,0)
 . . . . . ; On-Call and Recess are the only types of exceptions
"RTN","PRS8PP",105,0)
 . . . . . ; where OT, CT and RG can be posted for the same 15 minute
"RTN","PRS8PP",106,0)
 . . . . . ; segment of time, so don't stop searching if you find these.
"RTN","PRS8PP",107,0)
 . . . . . I TOT="ON"!(TOT="RS") S TOT="" Q
"RTN","PRS8PP",108,0)
 . . . . . S FND=1,SC=$P(DAT,U,(TS-1)*4+4)
"RTN","PRS8PP",109,0)
 . . . . . Q
"RTN","PRS8PP",110,0)
 . Q:TOT="OT"&("^11^12^17^"'[(U_SC_U))  ; Pre-Scheduled & Tour Coverage & OT/CT With Premiums
"RTN","PRS8PP",111,0)
 . Q:TOT="CT"&("^12^17^"'[(U_SC_U))     ; Tour Coverage & OT/CT With Premiums
"RTN","PRS8PP",112,0)
 . ; Code 17 - OT/CT with premiums only get ND for 6p-6a
"RTN","PRS8PP",113,0)
 . Q:TOT="OT"!(TOT="CT")!(TOT="RG")&(SC=17)&((M'<25)&(M'>72))
"RTN","PRS8PP",114,0)
 . Q:TOT="RG"&(SC'=7)&(SC'=17)          ; Shift Coverage & OT/CT With Premiums
"RTN","PRS8PP",115,0)
 . S X=10
"RTN","PRS8PP",116,0)
 . ; for 36/40 AWS, premium time resulting from their tour 
"RTN","PRS8PP",117,0)
 . ; will be mapped to Night Differential-AWS (ND/NU) and
"RTN","PRS8PP",118,0)
 . ; Paid at the AAC with the 1872 divisor for the hourly rate (36*52)
"RTN","PRS8PP",119,0)
 . I +NAWS=36,("OEc"'[VAL!(TOT="HW")) S X=51
"RTN","PRS8PP",120,0)
 . D SET
"RTN","PRS8PP",121,0)
 . ; keep leave count since it may need to be backed out by PRS8MSC0
"RTN","PRS8PP",122,0)
 . I "LSRUFGDZq"[VAL S WKL(WK)=WKL(WK)+1
"RTN","PRS8PP",123,0)
 ;
"RTN","PRS8PP",124,0)
 ; Nurse can get ND for 6a-6p time when part of tour with 4+ hrs in 6p-6a
"RTN","PRS8PP",125,0)
 ; check is made when M=24 (just before 6am) or M=73 (just after 6pm).
"RTN","PRS8PP",126,0)
 ; if tour eligible (4+ hours in 'night' time) then ND is granted for
"RTN","PRS8PP",127,0)
 ; the portion of the tour that falls within the 'day' time.
"RTN","PRS8PP",128,0)
 I TYP["N"!(TYP["H"),M=73!(M=24),AV_"m"[VAL D
"RTN","PRS8PP",129,0)
 . N C,J,Q,X,X1,X2,XD
"RTN","PRS8PP",130,0)
 . ;
"RTN","PRS8PP",131,0)
 . ; quit if 'day' time is for tour coverage since already counted
"RTN","PRS8PP",132,0)
 . I $E(DAY(DAY,"P"),$S(M=73:72,1:25))="N" Q
"RTN","PRS8PP",133,0)
 . ;
"RTN","PRS8PP",134,0)
 . ; first check if tour has at least 4 hours of 'night' (6pm-6am) time
"RTN","PRS8PP",135,0)
 . S XD=$S(M=24:-1,1:1) ; loop direction, [6am back, 6pm forward]
"RTN","PRS8PP",136,0)
 . S X1=M,X2=X1+(XD*15) ; start and stop of 4 hour range
"RTN","PRS8PP",137,0)
 . ; loop thru tour 'night' time - stop if tour ends or after 4 hours
"RTN","PRS8PP",138,0)
 . S C=1 ; init flag, false when tour has less than 4 hours of 'night'
"RTN","PRS8PP",139,0)
 . F J=X1:XD:X2 D  Q:'C
"RTN","PRS8PP",140,0)
 . . I AV_"m"'[$E(D,J) S C=0 Q  ; inappropriate type of time
"RTN","PRS8PP",141,0)
 . . I $$NOTND(TYP,DAY,J) S C=0 Q
"RTN","PRS8PP",142,0)
 . . ; scheduled TOD considered as separate from covered TOD
"RTN","PRS8PP",143,0)
 . . I $E(DAY(DAY,"P"),M)'=$E(DAY(DAY,"P"),J) S C=0 Q
"RTN","PRS8PP",144,0)
 . ;
"RTN","PRS8PP",145,0)
 . Q:'C  ; tour not eligible (less than 4 hours of 'night')
"RTN","PRS8PP",146,0)
 . ;
"RTN","PRS8PP",147,0)
 . ; loop thru day time (6am-6pm) portion of tour and grant ND
"RTN","PRS8PP",148,0)
 . ; don't pay ND for meal-time (m) but continue loop
"RTN","PRS8PP",149,0)
 . S XD=$S(M=24:1,1:-1) ; loop direction [6am forward, 6pm back]
"RTN","PRS8PP",150,0)
 . S X1=M+XD,X2=X1+(47*XD) ; start and stop for day time (12 hours)
"RTN","PRS8PP",151,0)
 . S Q=0 ; init flag, true when end of tour reached
"RTN","PRS8PP",152,0)
 . F J=X1:XD:X2 D  Q:Q
"RTN","PRS8PP",153,0)
 . . I AV_"m"'[$E(D,J) S Q=1 Q  ;    inappropriate time
"RTN","PRS8PP",154,0)
 . . I $$NOTND(TYP,DAY,J) S Q=1 Q
"RTN","PRS8PP",155,0)
 . . ; scheduled TOD considered as separate from covered TOD
"RTN","PRS8PP",156,0)
 . . I $E(DAY(DAY,"P"),M)'=$E(DAY(DAY,"P"),J) S Q=1 Q
"RTN","PRS8PP",157,0)
 . . ; grant ND (unless meal-time, etc.), keep count of leave since it
"RTN","PRS8PP",158,0)
 . . ;   may need to be backed out by PRS8MSC0
"RTN","PRS8PP",159,0)
 . . I AV[$E(D,J) D
"RTN","PRS8PP",160,0)
 . . . S X=10
"RTN","PRS8PP",161,0)
 . . . ; For 36/46 AWS nurses ND for Holiday Worked (HA/HL) and normal
"RTN","PRS8PP",162,0)
 . . . ; tour time will be reported as Night Differential-AWS (ND/NU)
"RTN","PRS8PP",163,0)
 . . . I +NAWS=36 D
"RTN","PRS8PP",164,0)
 . . . . I $E(DAY(DAY,"HOL"),J)=2 S X=51 Q  ; Holiday Worked
"RTN","PRS8PP",165,0)
 . . . . I "OEc"'[VAL S X=51 ; Tour time
"RTN","PRS8PP",166,0)
 . . . D SET
"RTN","PRS8PP",167,0)
 . . . S:"LSRUFGDZq"[$E(D,J) WKL(WK)=WKL(WK)+1
"RTN","PRS8PP",168,0)
 ;
"RTN","PRS8PP",169,0)
 Q
"RTN","PRS8PP",170,0)
 ;
"RTN","PRS8PP",171,0)
SETJ ; --- set week node (J variable defined)
"RTN","PRS8PP",172,0)
 Q:$E(D,J)="m"
"RTN","PRS8PP",173,0)
 ;
"RTN","PRS8PP",174,0)
SET ; --- actually set the piece
"RTN","PRS8PP",175,0)
 S $P(WK(WK),"^",X)=$P(WK(WK),"^",X)+1
"RTN","PRS8PP",176,0)
 Q
"RTN","PRS8PP",177,0)
 ;
"RTN","PRS8PP",178,0)
NOTND(PRSTY,PRSDY,PRSTM) ; Not Eligible Night Differential
"RTN","PRS8PP",179,0)
 ; in PRSTY  type of employee
"RTN","PRS8PP",180,0)
 ;    PRSDY  day (1-14)
"RTN","PRS8PP",181,0)
 ;    PRSTM  time segment (1-96)
"RTN","PRS8PP",182,0)
 ; returns 0 or 1 (True when not eligible for ND)
"RTN","PRS8PP",183,0)
 ;
"RTN","PRS8PP",184,0)
 N VAL
"RTN","PRS8PP",185,0)
 S VAL=$E(DAY(PRSDY,"W"),PRSTM)
"RTN","PRS8PP",186,0)
 ;
"RTN","PRS8PP",187,0)
 ; not entitled to ND
"RTN","PRS8PP",188,0)
 I ($E(DAY(PRSDY,"P"),PRSTM)=5) Q 1
"RTN","PRS8PP",189,0)
 ;
"RTN","PRS8PP",190,0)
 ; OT on non-premium T&L
"RTN","PRS8PP",191,0)
 I "EOosecb"[VAL,$E(DAY(PRSDY,"P"),PRSTM),VAL'="O"!(VAL="O"&($E(DAY(PRSDY,"HOL"),PRSTM)'=2)) Q 1
"RTN","PRS8PP",192,0)
 ;
"RTN","PRS8PP",193,0)
 ; Nurses do not get ND for OT that is not for ND Tour Coverage
"RTN","PRS8PP",194,0)
 I "Ecb"[VAL!(VAL="O"&'$E(DAY(PRSDY,"HOL"),PRSTM)),PRSTY["N"!(PRSTY["H")!(HYBRID)!("^S^T^U^V^"[(U_PMP_U)),$E(DAY(PRSDY,"P"),PRSTM)'="N" Q 1
"RTN","PRS8PP",195,0)
 ;
"RTN","PRS8PP",196,0)
 ; Baylor gets no ND for work time on regularly scheduled day
"RTN","PRS8PP",197,0)
 I TYP["B","^1^7^8^14^"[("^"_DAY_"^"),"1234ALSRMUNVXYFGDZq"[VAL Q 1
"RTN","PRS8PP",198,0)
 ;
"RTN","PRS8PP",199,0)
 ; GS Employees do not get ND for OT that is not Pre-Scheduled
"RTN","PRS8PP",200,0)
 I "Ecb"[VAL!(VAL="O"&'$E(DAY(PRSDY,"HOL"),PRSTM)),PRSTY'["N",PRSTY'["H",'HYBRID,("^S^T^U^V^"'[(U_PMP_U)),$E(DAY(PRSDY,"P"),PRSTM)'="n" Q 1
"RTN","PRS8PP",201,0)
 ;
"RTN","PRS8PP",202,0)
 ; Unsch Reg time needs to be Pre-scheduled to get ND
"RTN","PRS8PP",203,0)
 I VAL=4,PRSTY["P"!(PRSTY["I"&(PRSTY["N"!(PRSTY["H"))),"Nn"'[$E(DAY(PRSDY,"P"),PRSTM) Q 1
"RTN","PRS8PP",204,0)
 Q 0 ; did not fail any of the checks
"RTN","PRS8ST")
0^22^B44078747^B44290795
"RTN","PRS8ST",1,0)
PRS8ST ;HISC/MGD-DECOMPOSITION, START-UP ;05/09/07
"RTN","PRS8ST",2,0)
 ;;4.0;PAID;**45,92,102,112,117**;Sep 21, 1995;Build 32
"RTN","PRS8ST",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRS8ST",4,0)
 ;
"RTN","PRS8ST",5,0)
 ;This routine is the one which actually gets everything moving.
"RTN","PRS8ST",6,0)
 ;It moves the information from the ^TMP global into a local array
"RTN","PRS8ST",7,0)
 ;[DAY(DAY)] for the three day period it's working with.  It then
"RTN","PRS8ST",8,0)
 ;processes that information internally and, where necessary, by
"RTN","PRS8ST",9,0)
 ;calling certain external processes.
"RTN","PRS8ST",10,0)
 ;
"RTN","PRS8ST",11,0)
 ;Called by Routines:  PRS8SU
"RTN","PRS8ST",12,0)
 ;
"RTN","PRS8ST",13,0)
 K SBY F DAY=1:1:14 D
"RTN","PRS8ST",14,0)
 .K DAY(DAY-2)
"RTN","PRS8ST",15,0)
 .S LP=$S(DAY=1:"0,1,2",1:(DAY+1)),JURY=0
"RTN","PRS8ST",16,0)
 .F II=1:1 S DY=$P(LP,",",II) Q:DY=""  D
"RTN","PRS8ST",17,0)
 ..F J=0,1,2,4,10,"CP","DH1","DH2","HOL","ML","MT1","MT2","OFF","P","TOUR","TWO","W","r" D
"RTN","PRS8ST",18,0)
 ...S DAY(DY,J)=$G(^TMP($J,"PRS8",DY,J))
"RTN","PRS8ST",19,0)
 ...;
"RTN","PRS8ST",20,0)
 ...;P 45 INITIALIZE THE "F" NODE HERE BY SIMPLY COPYING THE 
"RTN","PRS8ST",21,0)
 ...;THE "W" NODE FROM TEMP--FOR TESTING PURPOSES.
"RTN","PRS8ST",22,0)
 ...;THE NODE SHOULD BE INITIALIZED BY COPYING THE "F" NODE
"RTN","PRS8ST",23,0)
 ...;FROM THE TEMP GLOBAL.
"RTN","PRS8ST",24,0)
 ...S DAY(DY,"F")=$G(^TMP($J,"PRS8",DY,"W"))
"RTN","PRS8ST",25,0)
 .F II=1:1 S DY=$P(LP,",",II) Q:DY=""  D
"RTN","PRS8ST",26,0)
 ..S WK=$S(DY<8:1,1:2)
"RTN","PRS8ST",27,0)
 ..S TOUR=$S(TYP'["W":1,+DAY(DY,"TOUR"):+DAY(DY,"TOUR"),1:+TOUR(WK))
"RTN","PRS8ST",28,0)
 ..D MOVE^PRS8AC
"RTN","PRS8ST",29,0)
 ..S N=DAY(DY,2),WK=$S(DY<8:1,1:2) ;exception node/week
"RTN","PRS8ST",30,0)
 ..I N["UN" S X1="UN" D 2 ;unavailable
"RTN","PRS8ST",31,0)
 ..I N["HX" S X1="HX" D 2 ;holiday excused
"RTN","PRS8ST",32,0)
 ..I N["ON" S X1="ON" D 2 ;on-call
"RTN","PRS8ST",33,0)
 ..I N["SB" S X1="SB" D 2 ;standby
"RTN","PRS8ST",34,0)
 ..; Process the scheduled tours
"RTN","PRS8ST",35,0)
 ..S N=DAY(DY,1),DH=DAY(DY,"DH1"),NN=1 D  I DAY(DY,"TWO") S N=DAY(DY,4),DH=DAY(DY,"DH2"),NN=4 D
"RTN","PRS8ST",36,0)
 ...S QT=0 F PRS8=1:3 S V=$P(N,"^",PRS8,PRS8+2) Q:QT  D
"RTN","PRS8ST",37,0)
 ....N PRS8AFFH S PRS8AFFH=0 ;fire fighter additional hours flag
"RTN","PRS8ST",38,0)
 ....S X=$P(DAY(DY,NN),"^",PRS8,999)
"RTN","PRS8ST",39,0)
 ....I X="" S QT=1 Q  ;nothing left to check
"RTN","PRS8ST",40,0)
 ....I X?1"^"."^" S QT=1 Q  ;only ^ left
"RTN","PRS8ST",41,0)
 ....;
"RTN","PRS8ST",42,0)
 ....; X = 9 is special tour CODE FOR FF ADDTL HRS.
"RTN","PRS8ST",43,0)
 ....; It gets converted to 'f'
"RTN","PRS8ST",44,0)
 ....S X=$P(V,"^",3),VAR=1 I X S VAR=$E("se1BC235f",+X) I '+VAR D ENT Q:Q
"RTN","PRS8ST",45,0)
 ....;if this segment is addt ff hrs then save a variable to signify
"RTN","PRS8ST",46,0)
 ....;that, but convert the time back to a 1 to use in the W node.
"RTN","PRS8ST",47,0)
 ....I "Ff"[TYP,VAR="f" S (PRS8AFFH,VAR)=1
"RTN","PRS8ST",48,0)
 ....;
"RTN","PRS8ST",49,0)
 ....I VAR,TYP'["W" S VAR=$S(VAR=5:5,1:1) ;only wg need shifts
"RTN","PRS8ST",50,0)
 ....S JURY=$G(^TMP($J,"PRS8",DY,2)) I JURY'="" D
"RTN","PRS8ST",51,0)
 .....F J=4,8,12,16,20,24,28 S:$P(JURY,"^",J)=6 JURY=1 Q
"RTN","PRS8ST",52,0)
 ....D ^PRS8AC ;build "W" node
"RTN","PRS8ST",53,0)
 ..; Process the exceptions
"RTN","PRS8ST",54,0)
 ..S N=DAY(DY,2),WK=$S(DY<8:1,1:2) ;exception node/week
"RTN","PRS8ST",55,0)
 ..S QT=0
"RTN","PRS8ST",56,0)
 ..; If there are Recess exceptions, process them first
"RTN","PRS8ST",57,0)
 ..I N["RS" D
"RTN","PRS8ST",58,0)
 ...; Since Recess will reduce hours worked in the week add P to TYP
"RTN","PRS8ST",59,0)
 ...I TYP'["P" S TYP=TYP_"P"
"RTN","PRS8ST",60,0)
 ...F PRS8=1:4:25 S V=$P(N,"^",PRS8,PRS8+3) Q:QT  D
"RTN","PRS8ST",61,0)
 ....Q:$P(V,"^",3)'="RS"
"RTN","PRS8ST",62,0)
 ....I TYP["D",$P(V,"^",3)="" S QT=1 Q  ;doctor
"RTN","PRS8ST",63,0)
 ....I TYP'["D",'+V,$P(V,"^",3)="" S QT=1 Q  ;all others
"RTN","PRS8ST",64,0)
 ....S X=$P(V,"^",3)
"RTN","PRS8ST",65,0)
 ....I "^UN^ON^SB^HX^"'[("^"_X_"^") D ^PRS8EX
"RTN","PRS8ST",66,0)
 ...;
"RTN","PRS8ST",67,0)
 ...; Process all other types of exceptions
"RTN","PRS8ST",68,0)
 ..S QT=0
"RTN","PRS8ST",69,0)
 ..F PRS8=1:4:25 S V=$P(N,"^",PRS8,PRS8+3) Q:QT  D
"RTN","PRS8ST",70,0)
 ...Q:$P(V,"^",3)="RS"
"RTN","PRS8ST",71,0)
 ...I TYP["D",$P(V,"^",3)="" S QT=1 Q  ;doctor
"RTN","PRS8ST",72,0)
 ...I TYP'["D",'+V,$P(V,"^",3)="" S QT=1 Q  ;all others
"RTN","PRS8ST",73,0)
 ...S X=$P(V,"^",3)
"RTN","PRS8ST",74,0)
 ...I "^UN^ON^SB^HX^"'[("^"_X_"^") D ^PRS8EX
"RTN","PRS8ST",75,0)
 ..;
"RTN","PRS8ST",76,0)
 ..S ^TMP($J,"PRS8",DY,"W")=DAY(DY,"W") ;save in ^TMP
"RTN","PRS8ST",77,0)
 ..S ^TMP($J,"PRS8",DY,"P")=DAY(DY,"P") ;save non-prem ot in ^TMP
"RTN","PRS8ST",78,0)
 ..S ^TMP($J,"PRS8",DY,"HOL")=DAY(DY,"HOL") ;holiday
"RTN","PRS8ST",79,0)
 ..S ^TMP($J,"PRS8",DY,"r")=DAY(DY,"r") ; Recess for 9mo AWS nurse
"RTN","PRS8ST",80,0)
 .S WK=$S(DAY<8:1,1:2),OFF=+DAY(DAY,"OFF") ;week/day off
"RTN","PRS8ST",81,0)
 .S TOUR=$S(TYP'["W":1,+DAY(DAY,"TOUR"):+DAY(DAY,"TOUR"),1:+TOUR(WK))
"RTN","PRS8ST",82,0)
 .I TYP["I",DAY>0,DAY<15,$G(DAY(DAY,"DWK")) D  ;days worked
"RTN","PRS8ST",83,0)
 ..S DWK=DWK+1 ;count days worked
"RTN","PRS8ST",84,0)
 ..I CYA,DAY'<CYA S CAMISC=CAMISC+1 ;calendar year adjustment (CA)
"RTN","PRS8ST",85,0)
 .S MDY=+DAY D ^PRS8MT I +DAY=1 S MDY=0 D ^PRS8MT
"RTN","PRS8ST",86,0)
 .Q
"RTN","PRS8ST",87,0)
 ;
"RTN","PRS8ST",88,0)
 ;make DAY array available for prior, current, and next day
"RTN","PRS8ST",89,0)
 F DAY=1:1:14 D
"RTN","PRS8ST",90,0)
 .; I AWS Nurse check to see if hour counts need to be adjusted
"RTN","PRS8ST",91,0)
 .S WK=$S(DAY<8:1,1:2)
"RTN","PRS8ST",92,0)
 .; For each week, TYP should not contain "P" unless:
"RTN","PRS8ST",93,0)
 .; 36/40 AWS has NP or WP
"RTN","PRS8ST",94,0)
 .;   9mo AWS has Recess
"RTN","PRS8ST",95,0)
 .I +NAWS,(DAY=1!(DAY=8)) S TYP=$TR(TYP,"P","") D NAWS
"RTN","PRS8ST",96,0)
 .;
"RTN","PRS8ST",97,0)
 .K DAY(DAY-2)
"RTN","PRS8ST",98,0)
 .S LP=$S(DAY=1:"0,1,2",1:(DAY+1))
"RTN","PRS8ST",99,0)
 .F II=1:1 S DY=$P(LP,",",II) Q:DY=""  D
"RTN","PRS8ST",100,0)
 ..F J=0,1,2,4,10,"CP","DH1","DH2","HOL","ML","MT1","MT2","OFF","P","TOUR","TWO","W","F","r" S DAY(DY,J)=$G(^TMP($J,"PRS8",DY,J))
"RTN","PRS8ST",101,0)
 .;
"RTN","PRS8ST",102,0)
 .S WK=$S(DAY<8:1,1:2),OFF=+DAY(DAY,"OFF") ;week/day off
"RTN","PRS8ST",103,0)
 .S TOUR=$S(TYP'["W":1,+DAY(DAY,"TOUR"):+DAY(DAY,"TOUR"),1:+TOUR(WK))
"RTN","PRS8ST",104,0)
 .;
"RTN","PRS8ST",105,0)
 .I ((TYP["I")!(TYP["P")),DAY>0,DAY<15 D  ;FOR CY
"RTN","PRS8ST",106,0)
 ..I $S('CYA:1,DAY<CYA:1,1:0) Q  ;quit if no calendar year adjustment
"RTN","PRS8ST",107,0)
 ..S IIX=0 I $E(ENT,2)'="D" F II=1:1:$L(DAY(DAY,"W")) D
"RTN","PRS8ST",108,0)
 ...I "4E"[$E(DAY(DAY,"W"),II) S IIX=IIX+1
"RTN","PRS8ST",109,0)
 ...S CYA2806=CYA2806+("ALSUMRVW1235OscXYFGDZq"[$E(DAY(DAY,"W"),II))
"RTN","PRS8ST",110,0)
 ...S:(IIX<33)&(FLX'="C"&(TH(WK)+IIX<163))!(FLX="C"&(TH+IIX<323)) CYA2806=CYA2806+("4E"[$E(DAY(DAY,"W"),II))
"RTN","PRS8ST",111,0)
 ...;SF2806 adjustment (CY) (163 & 323 because mt subtracted)
"RTN","PRS8ST",112,0)
 .;
"RTN","PRS8ST",113,0)
 .I CYA,DAY'<CYA,DAY(DAY,"W")["W" D  ;count wop in hours for CA
"RTN","PRS8ST",114,0)
 ..F II=1:1:$L(DAY(DAY,"W")) S WPCYA=WPCYA+("W"=$E(DAY(DAY,"W"),II))
"RTN","PRS8ST",115,0)
 .;
"RTN","PRS8ST",116,0)
 .I TYP'["D",DAY(DAY,"W")'?1"0"."0" D ^PRS8PP ;nightdiff/shift premiums
"RTN","PRS8ST",117,0)
 .;
"RTN","PRS8ST",118,0)
 .F T=1:1:96 S VAR1=$E(DAY(DAY,"W"),T) S OK=0 D
"RTN","PRS8ST",119,0)
 ..I "BbCct"[VAR1 D  ; process on-call/standby
"RTN","PRS8ST",120,0)
 ...I T=96!("BbCct"'[$E(DAY(DAY,"W"),T+1)) S OK=T
"RTN","PRS8ST",121,0)
 ...I DOUB D ^PRS8OC,^PRS8SB Q  ;Prem. Pay of "W" or "V"
"RTN","PRS8ST",122,0)
 ...I VAR1'=""&("Cct"[VAR1) D ^PRS8OC Q  ;compute on-call/2hr minimum
"RTN","PRS8ST",123,0)
 ...I "Bb"[VAR1 D ^PRS8SB ;standby
"RTN","PRS8ST",124,0)
 .I $G(SBY) D UP^PRS8SB
"RTN","PRS8ST",125,0)
 .;
"RTN","PRS8ST",126,0)
 .Q
"RTN","PRS8ST",127,0)
 ;
"RTN","PRS8ST",128,0)
 ;P 45 CODE O firefighters use PRS8MISC to calculated overtime
"RTN","PRS8ST",129,0)
 ;but code R and C firefighters use routine PRS8OTFF.
"RTN","PRS8ST",130,0)
 ;
"RTN","PRS8ST",131,0)
 I "Ff"[TYP&("RC"[PMP) D
"RTN","PRS8ST",132,0)
 .  D ^PRS8OTFF
"RTN","PRS8ST",133,0)
 E  D
"RTN","PRS8ST",134,0)
 .  D ^PRS8MISC
"RTN","PRS8ST",135,0)
 K DH,DY,I,J,JURY,K,K1,LP,N,NN,OFF,PRS8L,TOUR,V,VAR,WG,X,Y,Y1
"RTN","PRS8ST",136,0)
 D ^PRS8WE ;Weekend premiums
"RTN","PRS8ST",137,0)
 D ^PRS8UP ;finish up Misc and non-time related activities
"RTN","PRS8ST",138,0)
 Q
"RTN","PRS8ST",139,0)
 ;
"RTN","PRS8ST",140,0)
ENT ; --- check entitlement to activity for 1 node non-norm hrs
"RTN","PRS8ST",141,0)
 S Q=0
"RTN","PRS8ST",142,0)
 I '$E(ENT,$P("12^28^^29^26^^^29","^",+X)) S Q=1 ;entitlement string
"RTN","PRS8ST",143,0)
 ;PATCH 45: ADD CHECK FOR FIRE FIGHTER ADDITIONAL HOURS
"RTN","PRS8ST",144,0)
 ;SINCE THIS TYPE OF TIME IS NOT IN THE ENTITLEMENT TABLE
"RTN","PRS8ST",145,0)
 ;IT IS SET UP WITH TOUR IND. WITH CODE 9
"RTN","PRS8ST",146,0)
 I "Ff"[TYP,X=9 S Q=0
"RTN","PRS8ST",147,0)
 Q:X'=12  I TYP["W",TOUR>1,$E(ENT,11+TOUR) S Q=0
"RTN","PRS8ST",148,0)
 Q
"RTN","PRS8ST",149,0)
 ;
"RTN","PRS8ST",150,0)
2 ; --- get 2 node unavailable/oncall and standby
"RTN","PRS8ST",151,0)
 F PRS8=1:4:25 S V=$P(N,"^",PRS8,PRS8+2) Q:$P(V,"^",1)=""  D
"RTN","PRS8ST",152,0)
 .S X=$P(V,"^",3) I X=X1 D ^PRS8EX
"RTN","PRS8ST",153,0)
 K PRS8,X,V
"RTN","PRS8ST",154,0)
 Q
"RTN","PRS8ST",155,0)
 ;
"RTN","PRS8ST",156,0)
NAWS ; NAWS Nurse Alternate Work Schedules
"RTN","PRS8ST",157,0)
 ; If any NP or WP has been incurred for a nurse on the 36/40 AWS,
"RTN","PRS8ST",158,0)
 ; adjust their hours worked counts.  40 hrs/wk will now be used to 
"RTN","PRS8ST",159,0)
 ; determine their qualification for OT and CT.  Check piece 16 of
"RTN","PRS8ST",160,0)
 ; 0 node as NH will have been updated to 320 in PRS8SU.
"RTN","PRS8ST",161,0)
 ;
"RTN","PRS8ST",162,0)
 I +NAWS=36 D
"RTN","PRS8ST",163,0)
 .Q:$P(WK(WK),U,3)=""&($P(WK(WK),U,4)="")
"RTN","PRS8ST",164,0)
 .S TH(WK)=144-($P(WK(WK),U,3)+$P(WK(WK),U,4)) ; Adjust Total Hours per week
"RTN","PRS8ST",165,0)
 .S TH=TH(1)+TH(2) ; Adjust Total Hours per pay period
"RTN","PRS8ST",166,0)
 .S NH(WK)=144,NH=288 ; Adjust Normal Hours
"RTN","PRS8ST",167,0)
 .I TYP'["P" S TYP=TYP_"P" ; Make them into a PT employee
"RTN","PRS8ST",168,0)
 .S $E(ENT,2)=1 ; Make employee eligible for UN/US
"RTN","PRS8ST",169,0)
 ;
"RTN","PRS8ST",170,0)
 ; If any Recess has occurred for a nurse on the 9month AWS, adjust 
"RTN","PRS8ST",171,0)
 ; their hours worked counts.  These employees will be treated as PT
"RTN","PRS8ST",172,0)
 ; in determining the eligibility for OT/CT.
"RTN","PRS8ST",173,0)
 ;
"RTN","PRS8ST",174,0)
 I +NAWS=9 D
"RTN","PRS8ST",175,0)
 .Q:$P(WK(WK),U,48)=""
"RTN","PRS8ST",176,0)
 .S TH(WK)=TH(WK)-$P(WK(WK),U,48) ; Adjust total hours per week
"RTN","PRS8ST",177,0)
 .S TH=TH(1)+TH(2) ; Adjust Total Hours
"RTN","PRS8ST",178,0)
 .I TYP'["P" S TYP=TYP_"P" ; Adjust TYP to represent a PT employee
"RTN","PRS8ST",179,0)
 Q
"RTN","PRS8UP")
0^63^B37177110^B29951722
"RTN","PRS8UP",1,0)
PRS8UP ;HISC/MRL,JAH/WIRMFO-DECOMPOSITION, UPDATE TOTALS ;7/10/08
"RTN","PRS8UP",2,0)
 ;;4.0;PAID;**6,21,30,45,117**;Sep 21, 1995;Build 32
"RTN","PRS8UP",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRS8UP",4,0)
 ;
"RTN","PRS8UP",5,0)
 ;This routine is used to collect information related to
"RTN","PRS8UP",6,0)
 ;weekly activity which is unrelated to actual time, including
"RTN","PRS8UP",7,0)
 ;VCS Sales, Environmental Differential, Hazard Pay, 
"RTN","PRS8UP",8,0)
 ;Lump Sum Data, etc.
"RTN","PRS8UP",9,0)
 ;
"RTN","PRS8UP",10,0)
 ;Called by Routines:  PRS8ST
"RTN","PRS8UP",11,0)
 ;
"RTN","PRS8UP",12,0)
 ; -- VCS Sales (VC, VS)/Fee Basis (FE)
"RTN","PRS8UP",13,0)
 ;
"RTN","PRS8UP",14,0)
 ; If there is data (X) on the VCS sales node.  (Both VCS sales and
"RTN","PRS8UP",15,0)
 ; Fee Basis data is stored on this node).  Then we need to check to
"RTN","PRS8UP",16,0)
 ; see if the employee's pay plan is F=Fee Basis or U=VCS Sales.
"RTN","PRS8UP",17,0)
 ;
"RTN","PRS8UP",18,0)
 ;
"RTN","PRS8UP",19,0)
 ; If we're dealing w/ previous pay period where an employee
"RTN","PRS8UP",20,0)
 ; has changed pay plans, we need to check their pay plan for the 
"RTN","PRS8UP",21,0)
 ; pay period we are dealing with.
"RTN","PRS8UP",22,0)
 N PAYPDTMP,PPLOLD
"RTN","PRS8UP",23,0)
 S PAYPDTMP=$G(^PRST(458,+PY,0)) ;pay period we're working with.
"RTN","PRS8UP",24,0)
 S PPLOLD=$$OLDPP^PRS8UT(PAYPDTMP,+DFN) ;pay plan from PAYPDTMP.
"RTN","PRS8UP",25,0)
 S PPL=$P($G(^PRSPC(+DFN,0)),"^",21) ;pay plan in master record.
"RTN","PRS8UP",26,0)
 ;
"RTN","PRS8UP",27,0)
 ;if we find an old pay plan and it's different than the master record
"RTN","PRS8UP",28,0)
 ;use the old pay plan to determine VCS or FEE.
"RTN","PRS8UP",29,0)
 I PPLOLD'=0,(PPL'=PPLOLD) S PPL=PPLOLD
"RTN","PRS8UP",30,0)
 ;
"RTN","PRS8UP",31,0)
 S X=$G(^PRST(458,+PY,"E",+DFN,2)),(T,T(1),T(2))=0
"RTN","PRS8UP",32,0)
 I PPL'="F",X'="" F I=1:1:14 S V=+$P(X,"^",I),W=$S(I<8:1,1:2),T(W)=T(W)+V
"RTN","PRS8UP",33,0)
 I PPL'="F" F I=1,2 I $D(T(I)) D
"RTN","PRS8UP",34,0)
 .S X1=$P(T(I),".",2)
"RTN","PRS8UP",35,0)
 .S X1=X1_$E("00",0,2-$L(X1)) ;2 numbers for cents (X1)
"RTN","PRS8UP",36,0)
 .S X=+$P(T(I),".",1)
"RTN","PRS8UP",37,0)
 .S X=X_X1 I '+X Q  ;no value/don't report
"RTN","PRS8UP",38,0)
 .S $P(WK(I),"^",37)=X
"RTN","PRS8UP",39,0)
 S X=$G(^PRST(458,+PY,"E",+DFN,2))
"RTN","PRS8UP",40,0)
 I PPL="F",X'="" F I=1:1:14 S V=+$P(X,"^",I),T=T+V
"RTN","PRS8UP",41,0)
 I PPL="F",$D(T) D
"RTN","PRS8UP",42,0)
 .S X1=$P(T,".",2)
"RTN","PRS8UP",43,0)
 .S X1=X1_$E("00",0,2-$L(X1))
"RTN","PRS8UP",44,0)
 .S X=+$P(T,".",1)
"RTN","PRS8UP",45,0)
 .S X=X_X1 I '+X Q  ;if no value, don't save
"RTN","PRS8UP",46,0)
 .S $P(WK(3),"^",17)=X
"RTN","PRS8UP",47,0)
 K I,PPL,T,V,W,X,X1
"RTN","PRS8UP",48,0)
 ;
"RTN","PRS8UP",49,0)
 ; -- Environmental Differential (EA, EC)
"RTN","PRS8UP",50,0)
 ; -- Hazardous Duty Pay (EB, ED)
"RTN","PRS8UP",51,0)
 ;
"RTN","PRS8UP",52,0)
 S X=$G(^PRST(458,+PY,"E",+DFN,4))
"RTN","PRS8UP",53,0)
 F I=1,3,5,7,9,11 S Y=+$P(X,"^",I) D
"RTN","PRS8UP",54,0)
 .I I=1!(I=7) S T=0,W=1+(I=7)
"RTN","PRS8UP",55,0)
 .S Y=$G(^PRST(457.6,+Y,0)) Q:Y=""
"RTN","PRS8UP",56,0)
 .S Y=+$P(Y,"^",3) Q:'Y
"RTN","PRS8UP",57,0)
 .S Y=$E("00",0,2-$L(Y))_Y ;percentage
"RTN","PRS8UP",58,0)
 .S Y(1)=+$P(X,"^",I+1) Q:'Y(1)
"RTN","PRS8UP",59,0)
 .S Y(1)=$E("000",0,3-$L(Y(1)))_Y(1) ;hours
"RTN","PRS8UP",60,0)
 .S T=T+1
"RTN","PRS8UP",61,0)
 .I T<3 S $P(WK(W),"^",36+(T*2))=Y,$P(WK(W),"^",37+(T*2))=Y(1)
"RTN","PRS8UP",62,0)
 .K Y
"RTN","PRS8UP",63,0)
 K I,T,W,X,Y
"RTN","PRS8UP",64,0)
 ;
"RTN","PRS8UP",65,0)
 ;PRS4*117 CT Trav Earnd Wk 1&2. Convert file decimal to 1/4 hr integer
"RTN","PRS8UP",66,0)
 ;
"RTN","PRS8UP",67,0)
 N CTTNODE,CTTW1,CTTW2 S CTTNODE=$G(^PRST(458,+PY,"E",+DFN,6))
"RTN","PRS8UP",68,0)
 S CTTW1=+$P(CTTNODE,U)*100/.25\100
"RTN","PRS8UP",69,0)
 S CTTW2=+$P(CTTNODE,U,2)*100/.25\100
"RTN","PRS8UP",70,0)
 I CTTW1>0 S $P(WK(1),"^",52)=CTTW1
"RTN","PRS8UP",71,0)
 I CTTW2>0 S $P(WK(2),"^",52)=CTTW2
"RTN","PRS8UP",72,0)
 ;
"RTN","PRS8UP",73,0)
 ;PRS4*117 Move Credit Hours back to the comptime buckets.
"RTN","PRS8UP",74,0)
 ;   Credit hours still reported under comptime 8B codes but are
"RTN","PRS8UP",75,0)
 ;   split out during decomp so appropriate rules are applied 
"RTN","PRS8UP",76,0)
 ;   for credit hours. When credit hours 8B code reporting is 
"RTN","PRS8UP",77,0)
 ;   implemented this code should be removed.[credit hours future use]
"RTN","PRS8UP",78,0)
 ;
"RTN","PRS8UP",79,0)
 ;     { begin credit hours move to ct buckets
"RTN","PRS8UP",80,0)
 ;
"RTN","PRS8UP",81,0)
 ;       For week 1 & 2, add credit hours to comptime buckets and zero 
"RTN","PRS8UP",82,0)
 ;       out credit hours buckets.
"RTN","PRS8UP",83,0)
 ;
"RTN","PRS8UP",84,0)
 F I=1,2 D
"RTN","PRS8UP",85,0)
 .;      add
"RTN","PRS8UP",86,0)
 .  S $P(WK(I),U,7)=$P(WK(I),U,7)+$P(WK(I),U,54)
"RTN","PRS8UP",87,0)
 .  S $P(WK(I),U,8)=$P(WK(I),U,8)+$P(WK(I),U,55)
"RTN","PRS8UP",88,0)
 .;
"RTN","PRS8UP",89,0)
 .;      zero out
"RTN","PRS8UP",90,0)
 .  S $P(WK(I),U,54)=""
"RTN","PRS8UP",91,0)
 .  S $P(WK(I),U,55)=""
"RTN","PRS8UP",92,0)
 ;
"RTN","PRS8UP",93,0)
 ;      end credit hours move to ct buckets }
"RTN","PRS8UP",94,0)
 ;
"RTN","PRS8UP",95,0)
 ; -- Lump Sum Data (LY, LH, LD, DT)
"RTN","PRS8UP",96,0)
 ;
"RTN","PRS8UP",97,0)
 S (X,Y)=$G(^PRST(458,+PY,"E",+DFN,3)),(C,T(1),T(2),T(3))=""
"RTN","PRS8UP",98,0)
 I X'="" F I=2,3,4 S T(I-1)=+$P(X,"^",I) I +T(I-1) S C=1
"RTN","PRS8UP",99,0)
 I C F I=1,2,3 I +T(I) D
"RTN","PRS8UP",100,0)
 .S X1="."_$P(T(I),".",2)\.25 ;turn % into quarter hours
"RTN","PRS8UP",101,0)
 .S X=+$P(T(I),".",1)
"RTN","PRS8UP",102,0)
 .S X=X_+X1 I '+X Q
"RTN","PRS8UP",103,0)
 .S $P(WK(3),"^",4+I)=X
"RTN","PRS8UP",104,0)
 S X=$P(Y,"^",5)
"RTN","PRS8UP",105,0)
 I X?7N S X=$E(X,4,7)_$E(X,2,3),$P(WK(3),"^",8)=X
"RTN","PRS8UP",106,0)
 K I,C,T,X ;clean up/save new T&L as Y (if there)
"RTN","PRS8UP",107,0)
 ;
"RTN","PRS8UP",108,0)
 ; -- T&L Change (TL)
"RTN","PRS8UP",109,0)
 ;
"RTN","PRS8UP",110,0)
 S X=$P(Y,"^") I $L(X)=3 S $P(WK(3),"^",4)=X
"RTN","PRS8UP",111,0)
 K X
"RTN","PRS8UP",112,0)
 ;
"RTN","PRS8UP",113,0)
 ; -- Optional Withholding Tax (TO)
"RTN","PRS8UP",114,0)
 ;
"RTN","PRS8UP",115,0)
 I $P(Y,"^",7)="Y" S $P(WK(3),"^",9)=1
"RTN","PRS8UP",116,0)
 ;
"RTN","PRS8UP",117,0)
 ; -- Foreign Cola (LA)
"RTN","PRS8UP",118,0)
 ;
"RTN","PRS8UP",119,0)
 I $P(Y,"^",8)="Y" S $P(WK(3),"^",10)=2
"RTN","PRS8UP",120,0)
 ;
"RTN","PRS8UP",121,0)
 ; -- Payment Records (RR)
"RTN","PRS8UP",122,0)
 ;
"RTN","PRS8UP",123,0)
 I $P(Y,"^",6)="Y" S $P(WK(3),"^",15)=1
"RTN","PRS8UP",124,0)
 ;
"RTN","PRS8UP",125,0)
 ; -- Days Worked (DW)
"RTN","PRS8UP",126,0)
 ;
"RTN","PRS8UP",127,0)
 I DWK,TYP["I" S $P(WK(3),"^",2)=+DWK
"RTN","PRS8UP",128,0)
 ;
"RTN","PRS8UP",129,0)
 ; -- Calendar Year Adjustment (CA)
"RTN","PRS8UP",130,0)
 ;
"RTN","PRS8UP",131,0)
 ; I $D(WPCY) S X=WPCYA S X=(X\4)_"0",$P(WK(3),"^",12)=X K WPCY,WPCYA
"RTN","PRS8UP",132,0)
 I $D(WPCY) D
"RTN","PRS8UP",133,0)
 . S X=WPCYA S:$E(ENT,1,2)["H" X=(X\4) I +X S X=X_"0",$P(WK(3),"^",12)=X
"RTN","PRS8UP",134,0)
 . K WPCY,WPCYA
"RTN","PRS8UP",135,0)
 E  S X=+CAMISC I TYP["I",+X S X=X_"0",$P(WK(3),"^",12)=X
"RTN","PRS8UP",136,0)
 ;
"RTN","PRS8UP",137,0)
 ; -- Days Worked [SF 2806] (CY)
"RTN","PRS8UP",138,0)
 ;
"RTN","PRS8UP",139,0)
 I CYA2806'=0 S X=+CYA2806 I (TYP["I"!(TYP["P")),TYP'["B",+X S:"56U"'[$P(C0,"^",21) X=(X\4)_(X#4),$P(WK(3),"^",14)=X
"RTN","PRS8UP",140,0)
 E  S X=+CAMISC I TYP["I",+X S:"56U"'[$P(C0,"^",21) X=X_"0",$P(WK(3),"^",14)=X
"RTN","PRS8UP",141,0)
 ;
"RTN","PRS8UP",142,0)
 ; -- Fire Fighter Normal Hours (FF)
"RTN","PRS8UP",143,0)
 ;      Sum PT from week 1 with PH from week 2 and copy into FF
"RTN","PRS8UP",144,0)
 ;
"RTN","PRS8UP",145,0)
 S $P(WK(3),"^",16)=""
"RTN","PRS8UP",146,0)
 I "Ff"[TYP,(("RC"[PMP)!(NH=448)!(NH>320&(NH(1)'=NH(2)))) D
"RTN","PRS8UP",147,0)
 .  F I=1,2 D
"RTN","PRS8UP",148,0)
 ..    S X=+$P(WK(I),"^",32)
"RTN","PRS8UP",149,0)
 ..    I +X S $P(WK(3),"^",16)=$P(WK(3),"^",16)+X
"RTN","PRS8UP",150,0)
 ;
"RTN","PRS8UP",151,0)
 S X=$P(WK(3),"^",16)
"RTN","PRS8UP",152,0)
 I X S $P(WK(3),"^",16)=(X\4)_(X#4) ;quarter hours
"RTN","PRS8UP",153,0)
 K I,X,Y
"RTN","PRS8UP",154,0)
 ;
"RTN","PRS8UP",155,0)
 ; -- reduce OC by OT where applicable
"RTN","PRS8UP",156,0)
 F I=1,2 I $P(WK(I),"^",35),+$G(CBCK(I)) D
"RTN","PRS8UP",157,0)
 .S $P(WK(I),"^",35)=$P(WK(I),"^",35)-CBCK(I)
"RTN","PRS8UP",158,0)
 ;
"RTN","PRS8UP",159,0)
 ; -- Military Leave (ML)
"RTN","PRS8UP",160,0)
 ;I $G(MILV) S P=11 D DAYS
"RTN","PRS8UP",161,0)
 ;
"RTN","PRS8UP",162,0)
 ; -- Work Comp [Count COP days] (PC)
"RTN","PRS8UP",163,0)
 I $G(WCMP) S P=13 D DAYS
"RTN","PRS8UP",164,0)
 ;
"RTN","PRS8UP",165,0)
END ; --- all done here
"RTN","PRS8UP",166,0)
 Q
"RTN","PRS8UP",167,0)
 ;
"RTN","PRS8UP",168,0)
DAYS ; --- count total number of days for ML and PC
"RTN","PRS8UP",169,0)
 K NODE S NODE=$P("ML^^CP","^",P-10),(NODE(1),NODE(2))=""
"RTN","PRS8UP",170,0)
 F D=1:1:14 D
"RTN","PRS8UP",171,0)
 .S NODE(1)=NODE(1)_+$G(^TMP($J,"PRS8",D,NODE))
"RTN","PRS8UP",172,0)
 .S NODE(2)=NODE(2)_+$G(^TMP($J,"PRS8",D,"OFF"))
"RTN","PRS8UP",173,0)
 .I $E(NODE(1),D) D SET ;save day in WK(3)
"RTN","PRS8UP",174,0)
 S NODE(1)=$E("0*",1+$G(^TMP($J,"PRS8",0,NODE)))_NODE(1)_$E("0*",1+$G(^TMP($J,"PRS8",15,NODE))) ; assume ML/CP has been counted for past/future ppd
"RTN","PRS8UP",175,0)
 S NODE(2)=+$G(^TMP($J,"PRS8",0,"OFF"))_NODE(2)_+$G(^TMP($J,"PRS8",15,"OFF")) ; set off days for past/future ppd
"RTN","PRS8UP",176,0)
 S F=1 ;F=Forward check needed
"RTN","PRS8UP",177,0)
 F I=2:1:15 S X=$E(NODE(1),I),X1=$E(NODE(2),I) D
"RTN","PRS8UP",178,0)
 .I 'X1 S F=$S(X="*":I,1:-1) ;go forward into next week
"RTN","PRS8UP",179,0)
 .S (C,Q)=0 I X1,X'="*",$E(NODE(1),I-1)="*" F J=F+1:1:15 Q:Q  D  ; X'="*"" ==> X=1 for NODE="ML" if there is a problem with the counting of ML when the orders specify days off are not to be counted.
"RTN","PRS8UP",180,0)
 ..S X=$E(NODE(1),J),X1=$E(NODE(2),J)
"RTN","PRS8UP",181,0)
 ..I 'X1,X=0 S Q=1 Q  ;worked
"RTN","PRS8UP",182,0)
 ..I X="*" S Q=1,C=J-2 Q  ;military leave
"RTN","PRS8UP",183,0)
 ..I J=15,$E(NODE(1),J+1)="*" S Q=1,C=14 Q  ; if last day in ppd, and there is ML/CP on the first day of next ppd, then count this ML/CP
"RTN","PRS8UP",184,0)
 .I C F J=I-1:1:C S D=J D SET ;save off days in pp
"RTN","PRS8UP",185,0)
 Q
"RTN","PRS8UP",186,0)
 ;
"RTN","PRS8UP",187,0)
SET ; --- set WK(3) Node for ML
"RTN","PRS8UP",188,0)
 S $P(WK(3),"^",+P)=$P(WK(3),"^",+P)+1
"RTN","PRS8UP",189,0)
 S NODE(1)=$E(NODE(1),0,D-1)_"*"_$E(NODE(1),D+1,99)
"RTN","PRS8UP",190,0)
 Q
"RTN","PRS8VW")
0^28^B16147800^B15727436
"RTN","PRS8VW",1,0)
PRS8VW ;WCIOFO/JAH - DECOMPOSITION, VIEW RESULTS ;01/11/08
"RTN","PRS8VW",2,0)
 ;;4.0;PAID;**2,6,27,45,112,117**;Sep 21, 1995;Build 32
"RTN","PRS8VW",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRS8VW",4,0)
 ;
"RTN","PRS8VW",5,0)
 ;This routine is used to view the results of the decomposition.
"RTN","PRS8VW",6,0)
 ;The variables VAL and VALOLD must be passed.  VAL is the current
"RTN","PRS8VW",7,0)
 ;decomposition string.  VALOLD, which may be null, is the results
"RTN","PRS8VW",8,0)
 ;of a previous decomposition run (what's in the 5 node of file 458
"RTN","PRS8VW",9,0)
 ;prior to running decomposition).
"RTN","PRS8VW",10,0)
 ;
"RTN","PRS8VW",11,0)
 ;Called by Routines:  PRS8, PRS8DR
"RTN","PRS8VW",12,0)
 S (NEW,VAL)=$G(VAL),(OLD,VALOLD)=$G(VALOLD)
"RTN","PRS8VW",13,0)
 N DASH1,DASH2
"RTN","PRS8VW",14,0)
 S $P(DASH1,"-",79)="-",$P(DASH2,"=",79)="="
"RTN","PRS8VW",15,0)
 I +$E(NEW,2,4) S NEW=$E(VAL,33,999) ; 33rd position because CP field
"RTN","PRS8VW",16,0)
 I +$E(OLD,2,4) S OLD=$E(VALOLD,33,999) ;is added(either "C","F"or" ")
"RTN","PRS8VW",17,0)
 D E
"RTN","PRS8VW",18,0)
 W @IOF
"RTN","PRS8VW",19,0)
 I "C"'[$E(IOST) D
"RTN","PRS8VW",20,0)
 .S X="Decomposition of Time" W ?(80-$L(X)/2),X,!
"RTN","PRS8VW",21,0)
 .D NOW^%DTC S Y=% X ^DD("DD")
"RTN","PRS8VW",22,0)
 .S X=$G(^VA(200,+$G(DUZ),0)),TR="User:  "_$S($P(X,"^",1)'="":$P(X,"^",1),1:"Unknown")
"RTN","PRS8VW",23,0)
 .S TR=TR_"                                                                               "
"RTN","PRS8VW",24,0)
 .S X="Run Date: "_Y,TR=$E(TR,1,(79-$L(X)))_X
"RTN","PRS8VW",25,0)
 S X=$P(C0,"^",1)_" [SSN: "_$P(C0,"^",9)_"]" W !,X
"RTN","PRS8VW",26,0)
 S X="Pay Period: "_(^PRST(458,+PY,0)) W ?(79-$L(X)),$P(X,"^",1)
"RTN","PRS8VW",27,0)
 D CTID
"RTN","PRS8VW",28,0)
 W !,DASH2
"RTN","PRS8VW",29,0)
 W !,"Loc.",?10,"Data Element",?44,"Code",?52,"Old Value",?67,"New Value"
"RTN","PRS8VW",30,0)
 W !,"----",?10,"------------",?44,"----",?52,"---------",?67,"---------"
"RTN","PRS8VW",31,0)
 K I,L,X,USED
"RTN","PRS8VW",32,0)
 D ^PRS8VW1
"RTN","PRS8VW",33,0)
 D STUB
"RTN","PRS8VW",34,0)
 I "C"'[$E(IOST) D
"RTN","PRS8VW",35,0)
 .W !,DASH1
"RTN","PRS8VW",36,0)
 .W !,TR
"RTN","PRS8VW",37,0)
 D ONE^PRS8CV,^%ZISC Q
"RTN","PRS8VW",38,0)
 ;
"RTN","PRS8VW",39,0)
CERT ; entry point to show supervisor result of decomp before certifying
"RTN","PRS8VW",40,0)
 N DASH1,DASH2
"RTN","PRS8VW",41,0)
 S $P(DASH1,"-",79)="-",$P(DASH2,"=",79)="="
"RTN","PRS8VW",42,0)
 S (NEW,VAL)=$G(VAL)
"RTN","PRS8VW",43,0)
 I +$E(NEW,2,4) S NEW=$E(VAL,33,999) ;because CP field is added to STUB
"RTN","PRS8VW",44,0)
 D E2
"RTN","PRS8VW",45,0)
 W @IOF
"RTN","PRS8VW",46,0)
 I "C"'[$E(IOST) D
"RTN","PRS8VW",47,0)
 .S X="Decomposition of Time" W ?(80-$L(X)/2),X,!
"RTN","PRS8VW",48,0)
 .D NOW^%DTC S Y=% X ^DD("DD")
"RTN","PRS8VW",49,0)
 .S X=$G(^VA(200,+$G(DUZ),0)),TR="User:  "_$S($P(X,"^",1)'="":$P(X,"^",1),1:"Unknown")
"RTN","PRS8VW",50,0)
 .S TR=TR_"                                                                               "
"RTN","PRS8VW",51,0)
 .S X="Run Date: "_Y,TR=$E(TR,1,(79-$L(X)))_X
"RTN","PRS8VW",52,0)
 S H="PAY PERIOD SUMMARY" W !,$J(H,40+($L(H)/2)),!
"RTN","PRS8VW",53,0)
 S X=$P(C0,"^",1)_" [SSN: "_$E($P(C0,"^",9))_"XXXX"_$E($P(C0,"^",9),6,9)_"]" W !,X
"RTN","PRS8VW",54,0)
 S X="Pay Period: "_(^PRST(458,+PY,0)) W ?(79-$L(X)),$P(X,"^",1)
"RTN","PRS8VW",55,0)
 D CTID
"RTN","PRS8VW",56,0)
 W !,DASH2
"RTN","PRS8VW",57,0)
 W !
"RTN","PRS8VW",58,0)
 K I,L,X,USED
"RTN","PRS8VW",59,0)
 D ^PRS8VW2
"RTN","PRS8VW",60,0)
 I "C"'[$E(IOST) D
"RTN","PRS8VW",61,0)
 .W !,DASH1
"RTN","PRS8VW",62,0)
 .W !,TR
"RTN","PRS8VW",63,0)
 K H,R,Z Q
"RTN","PRS8VW",64,0)
E2 ; --- create E array
"RTN","PRS8VW",65,0)
 S E(1)="ANSKWDNOAURTCECUUNNANBSPSASBSCDADBDCTFOAOBOCYAOKOMRARBRCHAHBHCPTPAONYDHDVCEAEBTATCFAFCADNTRSSRSDNDCFCHCPCR"
"RTN","PRS8VW",66,0)
 S E(2)="ALSLWPNPABRLCTCOUSNRNSSQSESFSGDEDFDGTGOEOFOGYEOSOURERFRGHLHMHNPHPBCLYHHOVSECEDTBTDFBFDAFNHRNSSSHNUCGCICQCS"
"RTN","PRS8VW",67,0)
 S E(3)="NLDWMLCAPCCYFE" Q
"RTN","PRS8VW",68,0)
STUB ; --- show stub record
"RTN","PRS8VW",69,0)
 S X1=$G(HDR),X2=$E(VAL,1,32)
"RTN","PRS8VW",70,0)
 I X1="" S X1=$E(VALOLD,1,32)
"RTN","PRS8VW",71,0)
 I X1="" S X1=X2
"RTN","PRS8VW",72,0)
 I $L(X1)<$L(X2) S X1=X2
"RTN","PRS8VW",73,0)
 W !!,"STUB RECORD >>>>> ",$S(X1'="":X1,1:"Not Available At this Time...") Q
"RTN","PRS8VW",74,0)
 ;
"RTN","PRS8VW",75,0)
E ; --- create E array
"RTN","PRS8VW",76,0)
 S E(1)="ANSKWDNOAURTCECUUNNANBSPSASBSCDADBDCTFOAOBOCYAOKOMRARBRCHAHBHCPTPAONYDHDVCEAEBTATCFAFCADNTRSSRSDNDCFCHCPCR"
"RTN","PRS8VW",77,0)
 S E(2)="ALSLWPNPABRLCTCOUSNRNSSQSESFSGDEDFDGTGOEOFOGYEOSOURERFRGHLHMHNPHPBCLYHHOVSECEDTBTDFBFDAFNHRNSSSHNUCGCICQCS"
"RTN","PRS8VW",78,0)
 S E(3)="NLDWINTLLULNLDDTTOLAMLCAPCCYRRFFFECD" Q
"RTN","PRS8VW",79,0)
CTID ; compressed tour indicator display
"RTN","PRS8VW",80,0)
 ; in - PY (pay period ien), DFN (employee ien)
"RTN","PRS8VW",81,0)
 N FLX,FLXP
"RTN","PRS8VW",82,0)
 S FLX=$P($G(^PRST(458,+PY,"E",DFN,0)),U,6) ; for current pay period
"RTN","PRS8VW",83,0)
 S FLXP=$P($G(^PRST(458,+PY-1,"E",DFN,0)),U,6) ; for previous pay period
"RTN","PRS8VW",84,0)
 I FLX]"",FLX'="0" D
"RTN","PRS8VW",85,0)
 . W !,"This is a ",$$EXTERNAL^DILFD(458.01,5,"",FLX)," tour!"
"RTN","PRS8VW",86,0)
 I FLX]"",FLXP]"",FLX'=FLXP D
"RTN","PRS8VW",87,0)
 . W !,"Note: The Compressed Tour Indicator has been changed since"
"RTN","PRS8VW",88,0)
 . W !,"      the previous pay period (from "
"RTN","PRS8VW",89,0)
 . W $$EXTERNAL^DILFD(458.01,5,"",FLXP)
"RTN","PRS8VW",90,0)
 . W " to ",$$EXTERNAL^DILFD(458.01,5,"",FLX),")."
"RTN","PRS8VW",91,0)
 Q
"RTN","PRS8VW2")
0^30^B25129714^B23384902
"RTN","PRS8VW2",1,0)
PRS8VW2 ;WCIOFO/JAH - DECOMPOSITION, VIEW RESULTS ;01/11/08
"RTN","PRS8VW2",2,0)
 ;;4.0;PAID;**6,32,34,45,69,112,117**;Sep 21, 1995;Build 32
"RTN","PRS8VW2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRS8VW2",4,0)
 ; 
"RTN","PRS8VW2",5,0)
 ; This routine is used to show the results of the decomp to
"RTN","PRS8VW2",6,0)
 ; the supervisor before certification.  It takes the values
"RTN","PRS8VW2",7,0)
 ; in the 8B string (NEW) and prints each type of time with the
"RTN","PRS8VW2",8,0)
 ; amount in a more readable format (ie - value in 8B = OE163,
"RTN","PRS8VW2",9,0)
 ; would print -->    Week 1    Overtime    16.75
"RTN","PRS8VW2",10,0)
 ; Called from CERT+18^PRS8VW, a continuation from that entry point.
"RTN","PRS8VW2",11,0)
 ;
"RTN","PRS8VW2",12,0)
 S CHECK=0
"RTN","PRS8VW2",13,0)
 ;
"RTN","PRS8VW2",14,0)
EN ;
"RTN","PRS8VW2",15,0)
 S E=E(1),W="Week 1",LOC=1 D SHOW
"RTN","PRS8VW2",16,0)
 S E=E(2),W="Week 2",LOC=2 D SHOW
"RTN","PRS8VW2",17,0)
 S E=E(3),W="Misc",LOC=0 D SHOW
"RTN","PRS8VW2",18,0)
 I 'CHECK,"C"'[$E(IOST) D
"RTN","PRS8VW2",19,0)
 .W !,DASH1
"RTN","PRS8VW2",20,0)
 .W !,TR
"RTN","PRS8VW2",21,0)
 K %,CHECK,D,E,I,L,LOC,USED,W,X,Y Q
"RTN","PRS8VW2",22,0)
 ;
"RTN","PRS8VW2",23,0)
SHOW ; --- show information
"RTN","PRS8VW2",24,0)
 F I=1:2 S X=$E(E,I,I+1) Q:X=""  D
"RTN","PRS8VW2",25,0)
 .I $D(USED(X)) Q
"RTN","PRS8VW2",26,0)
 .S USED(X)=""
"RTN","PRS8VW2",27,0)
 .S X(1)=$F(NEW,X)
"RTN","PRS8VW2",28,0)
 .I 'CHECK,'X(1) Q  ;not in string
"RTN","PRS8VW2",29,0)
 .I CHECK S LOC(1)=(I\2+1) S:'LOC LOC(1)=LOC(1)+50 D
"RTN","PRS8VW2",30,0)
 ..S FOUND(LOC(1))=$G(FOUND(LOC(1)))
"RTN","PRS8VW2",31,0)
 ..S $P(FOUND(LOC(1)),"^",$S(LOC<2:1,1:4))=X
"RTN","PRS8VW2",32,0)
 .;
"RTN","PRS8VW2",33,0)
 .;read from tables below
"RTN","PRS8VW2",34,0)
 .;
"RTN","PRS8VW2",35,0)
 .S Y=$P($T(@$E(X)),";;",2)
"RTN","PRS8VW2",36,0)
 .S Y(1)=$F(Y,$E(X,2)_":")
"RTN","PRS8VW2",37,0)
 .S Y=$P($E(Y,Y(1),999),":",1,2)
"RTN","PRS8VW2",38,0)
 .I 'CHECK W !,W,?15,$P($T(TYP+Y),";;",2)
"RTN","PRS8VW2",39,0)
 .S X=X(1),X1=52 D CON
"RTN","PRS8VW2",40,0)
 Q
"RTN","PRS8VW2",41,0)
 ;
"RTN","PRS8VW2",42,0)
CON ; --- convert to proper format
"RTN","PRS8VW2",43,0)
 I '+X S X=$E("00000000000",1,+$P(Y,":",2))
"RTN","PRS8VW2",44,0)
 I X,X1=52 S (X,Z)=$E(NEW,X(1),X(1)+$P(Y,":",2)-1)
"RTN","PRS8VW2",45,0)
 I I=73!(W="Misc"&(I=13)) S R=X/100 W ?50,$J(R,6,2) Q
"RTN","PRS8VW2",46,0)
 I W="Misc",I=3 S X=X*10
"RTN","PRS8VW2",47,0)
 S R=$E(X,1,$L(X)-1)_$S($E(X,$L(X))=3:".75",$E(X,$L(X))=2:".5",$E(X,$L(X))=1:".25",1:"") W ?50,$J(R,6,2) Q
"RTN","PRS8VW2",48,0)
 Q
"RTN","PRS8VW2",49,0)
 ;
"RTN","PRS8VW2",50,0)
 ; This internal table stores types of time codes and their
"RTN","PRS8VW2",51,0)
 ; corresponding descriptions and TT8B value field lengths. Each
"RTN","PRS8VW2",52,0)
 ; single char line label below is the 1st char of a type of time code.
"RTN","PRS8VW2",53,0)
 ; The text on the corresponding line contains '^' delimited
"RTN","PRS8VW2",54,0)
 ; pieces.  The 1st char of those pieces is the 2nd char of a type of
"RTN","PRS8VW2",55,0)
 ; time.  The text description for that time code is given by the
"RTN","PRS8VW2",56,0)
 ; the number in the 2nd ':' delimited piece.  That number indicates
"RTN","PRS8VW2",57,0)
 ; the line number below the label TYP in routine PRS8VW2.  The 3rd
"RTN","PRS8VW2",58,0)
 ; ':' delimited piece is the length of the time code's value in the
"RTN","PRS8VW2",59,0)
 ; TT8B String.
"RTN","PRS8VW2",60,0)
 ;
"RTN","PRS8VW2",61,0)
A ;;N:1:3^U:5:3^L:1:3^B:5:3^D:63:3^F:63:3
"RTN","PRS8VW2",62,0)
C ;;E:7:3^U:8:3^T:7:3^O:8:3^L:34:4^A:55:4^Y:57:3^D:60:6^F:70:3^G:70:3^H:71:3^I:71:3^P:72:3^Q:72:3^R:73:3^S:73:3
"RTN","PRS8VW2",63,0)
D ;;A:16:3^B:17:3^C:18:3^E:16:3^F:17:3^G:18:3^W:45:2^T:48:6
"RTN","PRS8VW2",64,0)
E ;;A:38:5^B:40:5^C:38:5^D:40:5
"RTN","PRS8VW2",65,0)
F ;;F:59:4^A:61:3^B:61:3^C:62:3^D:62:3^E:64:6
"RTN","PRS8VW2",66,0)
H ;;A:29:3^B:30:3^C:31:3^L:29:3^M:30:3^N:31:3^D:36:3^O:36:3
"RTN","PRS8VW2",67,0)
I ;;N:46:1
"RTN","PRS8VW2",68,0)
L ;;U:48:4^N:49:4^D:50:4^A:53:1
"RTN","PRS8VW2",69,0)
M ;;L:54:4
"RTN","PRS8VW2",70,0)
N ;;O:4:3^A:10:3^B:11:3^P:4:3^R:10:3^S:11:3^L:44:2^T:65:3^H:65:3^D:69:3^U:69:3
"RTN","PRS8VW2",71,0)
O ;;A:20:3^B:21:3^C:22:3^K:24:3^M:25:3^N:34:4^E:20:3^F:21:3^G:22:3^S:24:3^U:25:3
"RTN","PRS8VW2",72,0)
P ;;T:32:3^A:33:3^H:32:3^B:33:3^C:56:2
"RTN","PRS8VW2",73,0)
R ;;T:6:3^A:26:3^B:27:3^C:28:3^L:6:3^E:26:3^F:27:3^G:28:3^R:58:1^S:66:3^N:66:3
"RTN","PRS8VW2",74,0)
S ;;K:2:3^P:12:3^A:13:3^B:14:3^C:15:3^L:2:3^Q:12:3^E:13:3^F:14:3^G:15:3^R:67:3^S:67:3^D:68:3^H:68:3
"RTN","PRS8VW2",75,0)
T ;;F:19:3^A:42:3^C:43:3^G:19:3^B:42:3^D:43:3^L:47:3^O:52:1
"RTN","PRS8VW2",76,0)
U ;;N:9:3^S:9:3
"RTN","PRS8VW2",77,0)
V ;;C:37:6^S:37:6
"RTN","PRS8VW2",78,0)
W ;;D:3:3^P:3:3
"RTN","PRS8VW2",79,0)
Y ;;A:23:3^D:35:4^E:23:3^H:35:4
"RTN","PRS8VW2",80,0)
 ;
"RTN","PRS8VW2",81,0)
TYP ; literal values of activities (actual name)
"RTN","PRS8VW2",82,0)
 ;;Annual Leave
"RTN","PRS8VW2",83,0)
 ;;Sick Leave
"RTN","PRS8VW2",84,0)
 ;;Leave Without Pay
"RTN","PRS8VW2",85,0)
 ;;Non-Pay Time
"RTN","PRS8VW2",86,0)
 ;;Authorized Absence
"RTN","PRS8VW2",87,0)
 ;;Restored Annual Leave
"RTN","PRS8VW2",88,0)
 ;;Comp Time Earned
"RTN","PRS8VW2",89,0)
 ;;Comp Time Used
"RTN","PRS8VW2",90,0)
 ;;Unscheduled Regular
"RTN","PRS8VW2",91,0)
 ;;Night Differential-2
"RTN","PRS8VW2",92,0)
 ;;Night Differential-3
"RTN","PRS8VW2",93,0)
 ;;Saturday Premium
"RTN","PRS8VW2",94,0)
 ;;Sunday Premium-D
"RTN","PRS8VW2",95,0)
 ;;Sunday Premium-2
"RTN","PRS8VW2",96,0)
 ;;Sunday Premium-3
"RTN","PRS8VW2",97,0)
 ;;Overtime Hrs > 8 Day-D
"RTN","PRS8VW2",98,0)
 ;;Overtime Hrs > 8 Day-2
"RTN","PRS8VW2",99,0)
 ;;Overtime Hrs > 8 Day-3
"RTN","PRS8VW2",100,0)
 ;;Travel OT-FLSA
"RTN","PRS8VW2",101,0)
 ;;Overtime Total Hours-D
"RTN","PRS8VW2",102,0)
 ;;Overtime Total Hours-2
"RTN","PRS8VW2",103,0)
 ;;Overtime Total Hours-3
"RTN","PRS8VW2",104,0)
 ;;Scheduled Call-Back OT
"RTN","PRS8VW2",105,0)
 ;;Overtime on Holiday
"RTN","PRS8VW2",106,0)
 ;;Sleep Time
"RTN","PRS8VW2",107,0)
 ;;Reg Hrs @ Overtime Rate-D
"RTN","PRS8VW2",108,0)
 ;;Reg Hrs @ Overtime Rate-2
"RTN","PRS8VW2",109,0)
 ;;Reg Hrs @ Overtime Rate-3
"RTN","PRS8VW2",110,0)
 ;;Holiday Hours-D
"RTN","PRS8VW2",111,0)
 ;;Holiday Hours-2
"RTN","PRS8VW2",112,0)
 ;;Holiday Hours-3
"RTN","PRS8VW2",113,0)
 ;;Part Time Hours
"RTN","PRS8VW2",114,0)
 ;;Continuation of Pay
"RTN","PRS8VW2",115,0)
 ;;Standby Hours
"RTN","PRS8VW2",116,0)
 ;;On-Call Hours
"RTN","PRS8VW2",117,0)
 ;;Pieceworker Holiday Excused
"RTN","PRS8VW2",118,0)
 ;;VCS Sales
"RTN","PRS8VW2",119,0)
 ;;Environmental Differential
"RTN","PRS8VW2",120,0)
 ;;
"RTN","PRS8VW2",121,0)
 ;;Hazardous Duty Pay
"RTN","PRS8VW2",122,0)
 ;;
"RTN","PRS8VW2",123,0)
 ;;Travel
"RTN","PRS8VW2",124,0)
 ;;Training
"RTN","PRS8VW2",125,0)
 ;;Non-Pay Annual Leave
"RTN","PRS8VW2",126,0)
 ;;Days Worked
"RTN","PRS8VW2",127,0)
 ;;Insurance
"RTN","PRS8VW2",128,0)
 ;;T&L Change
"RTN","PRS8VW2",129,0)
 ;;Lump Sum Units-D
"RTN","PRS8VW2",130,0)
 ;;Lump Sum Units-2
"RTN","PRS8VW2",131,0)
 ;;Lump Sum Units-3
"RTN","PRS8VW2",132,0)
 ;;Lump Sum Expiration Date
"RTN","PRS8VW2",133,0)
 ;;Optional Withholding Tax
"RTN","PRS8VW2",134,0)
 ;;Foreign Cola
"RTN","PRS8VW2",135,0)
 ;;Military Leave
"RTN","PRS8VW2",136,0)
 ;;Calendar Year Adjustment
"RTN","PRS8VW2",137,0)
 ;;Workers Compensation
"RTN","PRS8VW2",138,0)
 ;;SF 2806 Adjustment
"RTN","PRS8VW2",139,0)
 ;;Payment Record Requested
"RTN","PRS8VW2",140,0)
 ;;Fire Fighter Normal Hours
"RTN","PRS8VW2",141,0)
 ;;Control Data
"RTN","PRS8VW2",142,0)
 ;;Care and Bereavement
"RTN","PRS8VW2",143,0)
 ;;Adoption
"RTN","PRS8VW2",144,0)
 ;;Donor Leave
"RTN","PRS8VW2",145,0)
 ;;Fee Basis
"RTN","PRS8VW2",146,0)
 ;;Base Tour Non Pay Hours
"RTN","PRS8VW2",147,0)
 ;;Recess
"RTN","PRS8VW2",148,0)
 ;;Saturday Premium-AWS
"RTN","PRS8VW2",149,0)
 ;;Sunday Premium-AWS
"RTN","PRS8VW2",150,0)
 ;;Night Differential-AWS
"RTN","PRS8VW2",151,0)
 ;;Comp Time for Travel Earned
"RTN","PRS8VW2",152,0)
 ;;Comp Time for Travel Used
"RTN","PRS8VW2",153,0)
 ;;Credit Hours Earned
"RTN","PRS8VW2",154,0)
 ;;Credit Hours Used
"RTN","PRS8WE")
0^32^B43083909^B42455203
"RTN","PRS8WE",1,0)
PRS8WE ;WCIOFO/MGD-DECOMPOSITION, WEEKEND PREMIUM ;01/31/08
"RTN","PRS8WE",2,0)
 ;;4.0;PAID;**42,65,74,75,90,92,96,117**;Sep 21, 1995;Build 32
"RTN","PRS8WE",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRS8WE",4,0)
 ;
"RTN","PRS8WE",5,0)
 ;This routine is used to determine the payment of Saturday and
"RTN","PRS8WE",6,0)
 ;Sunday Premium pays to entitled employees.
"RTN","PRS8WE",7,0)
 ;
"RTN","PRS8WE",8,0)
 ;Called by Routine PRS8ST
"RTN","PRS8WE",9,0)
 ;
"RTN","PRS8WE",10,0)
 N DAY,HYBRID,SAT2DT,SATNOSUN
"RTN","PRS8WE",11,0)
 S HYBRID=$S(+DFN'="":$$HYBRID^PRSAENT1(DFN),1:0)
"RTN","PRS8WE",12,0)
 ;
"RTN","PRS8WE",13,0)
 ; The variable SATNOSUN has been added for employees who are now
"RTN","PRS8WE",14,0)
 ; eligible to receive Saturday Premium but not Sunday Premium under
"RTN","PRS8WE",15,0)
 ; Public Law 108-170.
"RTN","PRS8WE",16,0)
 S SATNOSUN=$S($E(ENT,8,9)="10":1,1:0)
"RTN","PRS8WE",17,0)
 ;
"RTN","PRS8WE",18,0)
 ; Compute Sunday Premium Pay.  Check SATNOSUN employees
"RTN","PRS8WE",19,0)
 I $E(ENT,9)!(TYP["B")!(HYBRID)!(SATNOSUN) F DAY=1,8,15 D WPD
"RTN","PRS8WE",20,0)
 ;
"RTN","PRS8WE",21,0)
 ; Compute Saturday Premium Pay
"RTN","PRS8WE",22,0)
 I $E(ENT,8)!(TYP["B")!(HYBRID) F DAY=7,14 D WPD
"RTN","PRS8WE",23,0)
 ;
"RTN","PRS8WE",24,0)
 Q
"RTN","PRS8WE",25,0)
 ;
"RTN","PRS8WE",26,0)
WPD ; Weekend Premium for Day
"RTN","PRS8WE",27,0)
 ; input
"RTN","PRS8WE",28,0)
 ;   DAY - day in pay period (1,7,8,14, or 15)
"RTN","PRS8WE",29,0)
 ;   SAT2DT(day) - if defined for day, it equals the time segment (1-96)
"RTN","PRS8WE",30,0)
 ;                 just before the start of a 2-day tour that begins on
"RTN","PRS8WE",31,0)
 ;                 a Saturday and has already received Sunday premium.
"RTN","PRS8WE",32,0)
 ;                 Defined during computation of Sunday premiums and
"RTN","PRS8WE",33,0)
 ;                 used during computation of Saturday premiums to
"RTN","PRS8WE",34,0)
 ;                 prevent payment of both premiums for same period.
"RTN","PRS8WE",35,0)
 ;   TYP, ENT, etc...
"RTN","PRS8WE",36,0)
 ; output
"RTN","PRS8WE",37,0)
 ;   WK()
"RTN","PRS8WE",38,0)
 ;
"RTN","PRS8WE",39,0)
 N AV,D,END,H,M,P,TP,TV
"RTN","PRS8WE",40,0)
 ;
"RTN","PRS8WE",41,0)
 ; determine type of weekend premium.
"RTN","PRS8WE",42,0)
 S TP=$S("^7^14^"[(U_DAY_U):"SAT","^1^8^15^"[(U_DAY_U):"SUN",1:"")
"RTN","PRS8WE",43,0)
 Q:TP=""  ; invalid day (must be Sat. or Sun.)
"RTN","PRS8WE",44,0)
 ;
"RTN","PRS8WE",45,0)
 ; determine types of time in a 'tour'
"RTN","PRS8WE",46,0)
 S TV=$$TV
"RTN","PRS8WE",47,0)
 ;
"RTN","PRS8WE",48,0)
 ; determine types of time that might be eligible for premium
"RTN","PRS8WE",49,0)
 S AV=$$AV
"RTN","PRS8WE",50,0)
 ;
"RTN","PRS8WE",51,0)
 ; load info for day
"RTN","PRS8WE",52,0)
 S D(DAY)=$G(^TMP($J,"PRS8",DAY,"W"))
"RTN","PRS8WE",53,0)
 Q:D(DAY)?1"0"."0"  ; no activity on day
"RTN","PRS8WE",54,0)
 S P(DAY)=$G(^TMP($J,"PRS8",DAY,"P"))
"RTN","PRS8WE",55,0)
 S H(DAY)=$G(^TMP($J,"PRS8",DAY,"HOL"))
"RTN","PRS8WE",56,0)
 ;
"RTN","PRS8WE",57,0)
 ; loop thru activity string to find start of 'tour'
"RTN","PRS8WE",58,0)
 S M=1
"RTN","PRS8WE",59,0)
 S END=$S($G(SAT2DT(DAY))>0:SAT2DT(DAY),1:96)
"RTN","PRS8WE",60,0)
 F  D  Q:M=END  S M=M+1
"RTN","PRS8WE",61,0)
 . I TV'[$E(D(DAY),M),$E(H(DAY),M)'=2 Q
"RTN","PRS8WE",62,0)
 . ; found start of a 'tour'
"RTN","PRS8WE",63,0)
 . ; loop thru 'tour' activity and count the premium
"RTN","PRS8WE",64,0)
 . N CNT
"RTN","PRS8WE",65,0)
 . ;
"RTN","PRS8WE",66,0)
 . ; if the 'tour' starts at beginning of day then check if it is part
"RTN","PRS8WE",67,0)
 . ; of a 2-day 'tour' that actually started on the previous day
"RTN","PRS8WE",68,0)
 . I DAY>1,M=1 D
"RTN","PRS8WE",69,0)
 . . N CLASS,DYP,Z
"RTN","PRS8WE",70,0)
 . . S CLASS=$$CTS($E(D(DAY),M),$E(H(DAY),M))
"RTN","PRS8WE",71,0)
 . . S DYP=DAY-1
"RTN","PRS8WE",72,0)
 . . S D(DYP)=$G(^TMP($J,"PRS8",DYP,"W"))
"RTN","PRS8WE",73,0)
 . . S P(DYP)=$G(^TMP($J,"PRS8",DYP,"P"))
"RTN","PRS8WE",74,0)
 . . S H(DYP)=$G(^TMP($J,"PRS8",DYP,"HOL"))
"RTN","PRS8WE",75,0)
 . . Q:$$CTS($E(D(DYP),96),$E(H(DYP),96))'=CLASS  ; not same 'tour'
"RTN","PRS8WE",76,0)
 . . ; Hybrids defined by Public Law P.L. 107-135 only get Saturday
"RTN","PRS8WE",77,0)
 . . ; or Sunday premium for CT/OT/UN worked on Saturday or Sunday
"RTN","PRS8WE",78,0)
 . . Q:HYBRID&(TP="SAT")&($$CTS($E(D(DYP),96),$E(H(DYP),96))="X")
"RTN","PRS8WE",79,0)
 . . I CLASS="R",'$$TDT(DYP) Q  ; can't be same scheduled tour
"RTN","PRS8WE",80,0)
 . . ; If SATNOSUN and the day is a Sunday quit
"RTN","PRS8WE",81,0)
 . . Q:SATNOSUN&("^1^8^15^"[(U_DAY_U))
"RTN","PRS8WE",82,0)
 . . ; loop backward from midnight thru previous day's portion of tour
"RTN","PRS8WE",83,0)
 . . S Z=96
"RTN","PRS8WE",84,0)
 . . F  D  Q:Z=1  S Z=Z-1 Q:$$CTS($E(D(DYP),Z),$E(H(DYP),Z))'=CLASS
"RTN","PRS8WE",85,0)
 . . . I AV[$E(D(DYP),Z)!($E(D(DYP),Z)="O"&($E(H(DYP),Z)=2)) D COUNT^PRS8WE2(DYP,Z)
"RTN","PRS8WE",86,0)
 . . ; if Sun. premium then save Z to avoid recount of these Sat. hours
"RTN","PRS8WE",87,0)
 . . ;   when/if Sat. premium is calculated
"RTN","PRS8WE",88,0)
 . . ;
"RTN","PRS8WE",89,0)
 . . I TP="SUN" S SAT2DT(DYP)=Z
"RTN","PRS8WE",90,0)
 . ;
"RTN","PRS8WE",91,0)
 . ; If SATNOSUN and tour crossed mid onto Sunday set TP=SAT
"RTN","PRS8WE",92,0)
 . I M=1&("^1^8^"[(U_DAY_U)),SATNOSUN D
"RTN","PRS8WE",93,0)
 . . I AV[$E($G(^TMP($J,"PRS8",DAY-1,"W")),96) S TP="SAT"
"RTN","PRS8WE",94,0)
 . ;
"RTN","PRS8WE",95,0)
 . ; loop forward thru current day's portion of tour
"RTN","PRS8WE",96,0)
 . I DAY<15 F  D  Q:M=END  S M=M+1 Q:TV'[$E(D(DAY),M)&($E(H(DAY),M)'=2)
"RTN","PRS8WE",97,0)
 . . I AV[$E(D(DAY),M)!($E(D(DAY),M)="O"&($E(H(DAY),M)=2)) D COUNT^PRS8WE2(DAY,M)
"RTN","PRS8WE",98,0)
 . . ;
"RTN","PRS8WE",99,0)
 . . ; If checking for SATNOSUN quit when tour crossing midnight ends
"RTN","PRS8WE",100,0)
 . . I SATNOSUN&(TP="SAT")&("^1^8^15^"[(U_DAY_U))&(AV'[$E(D(DAY),M+1)) D SAVE^PRS8WE2 S M=END Q
"RTN","PRS8WE",101,0)
 . ;
"RTN","PRS8WE",102,0)
 . ; If counting Sat Prem for SATNOSUN and Day is a Sunday there is no
"RTN","PRS8WE",103,0)
 . ; need to check for the tour crossing midnight onto Monday
"RTN","PRS8WE",104,0)
 . Q:SATNOSUN&(TP="SAT")&("^1^8^15^"[(U_DAY_U))
"RTN","PRS8WE",105,0)
 . ;
"RTN","PRS8WE",106,0)
 . ; If SATNOSUN and DAY=14 and M<96 check remainder of tour for work
"RTN","PRS8WE",107,0)
 . I SATNOSUN&(DAY=14)&(M<96) D
"RTN","PRS8WE",108,0)
 . . F M=M:1:96 D
"RTN","PRS8WE",109,0)
 . . . I AV[$E(D(DAY),M)!($E(D(DAY),M)="O"&($E(H(DAY),M)=2)) D COUNT^PRS8WE2(DAY,M)
"RTN","PRS8WE",110,0)
 . ;
"RTN","PRS8WE",111,0)
 . ; If tour lasted until end of day then check if it is part of
"RTN","PRS8WE",112,0)
 . ; a 2-day tour that extends into next day
"RTN","PRS8WE",113,0)
 . I DAY<15,M=96,'SATNOSUN,(TV[$E(D(DAY),M))!($E(H(DAY),M)=2) D
"RTN","PRS8WE",114,0)
 . . N CLASS,DYN,Z
"RTN","PRS8WE",115,0)
 . . S CLASS=$$CTS($E(D(DAY),96),$E(H(DAY),96))
"RTN","PRS8WE",116,0)
 . . S DYN=DAY+1
"RTN","PRS8WE",117,0)
 . . S D(DYN)=$G(^TMP($J,"PRS8",DYN,"W"))
"RTN","PRS8WE",118,0)
 . . S P(DYN)=$G(^TMP($J,"PRS8",DYN,"P"))
"RTN","PRS8WE",119,0)
 . . S H(DYN)=$G(^TMP($J,"PRS8",DYN,"HOL"))
"RTN","PRS8WE",120,0)
 . . Q:$$CTS($E(D(DYN),1),$E(H(DYN),1))'=CLASS  ; not same 'tour'
"RTN","PRS8WE",121,0)
 . . ; Hybrids defined by Public Law P.L. 107-135 only get Saturday
"RTN","PRS8WE",122,0)
 . . ; or Sunday premium for CT/OT/UN worked on Saturday or Sunday
"RTN","PRS8WE",123,0)
 . . Q:HYBRID&(TP="SUN")&($$CTS($E(D(DYN),1),$E(H(DYN),1))="X")
"RTN","PRS8WE",124,0)
 . . I CLASS="R",'$$TDT(DAY) Q  ; can't be same scheduled tour
"RTN","PRS8WE",125,0)
 . . ; loop forward from midnight thru next day's portion of tour
"RTN","PRS8WE",126,0)
 . . S Z=1
"RTN","PRS8WE",127,0)
 . . F  D  Q:Z=96  S Z=Z+1 Q:$$CTS($E(D(DYN),Z),$E(H(DYN),Z))'=CLASS
"RTN","PRS8WE",128,0)
 . . . I AV[$E(D(DYN),Z)!($E(D(DYN),Z)="O"&($E(H(DYN),Z)=2)) D COUNT^PRS8WE2(DYN,Z)
"RTN","PRS8WE",129,0)
 . ;
"RTN","PRS8WE",130,0)
 . ; post premium time for tour to WK()
"RTN","PRS8WE",131,0)
 . D SAVE^PRS8WE2
"RTN","PRS8WE",132,0)
 Q
"RTN","PRS8WE",133,0)
 ;
"RTN","PRS8WE",134,0)
TV() ; List types of time in a 'tour'
"RTN","PRS8WE",135,0)
 N PRSX
"RTN","PRS8WE",136,0)
 ; for regular time
"RTN","PRS8WE",137,0)
 S PRSX="LRSFGDUAJMWNnVH1234XYmZq"
"RTN","PRS8WE",138,0)
 ; for OT/CT
"RTN","PRS8WE",139,0)
 S PRSX=PRSX_$S(TYP["B":"EeOs",TYP["N"!(TYP["H"):"EetOoscbT",1:"")
"RTN","PRS8WE",140,0)
 I HYBRID S PRSX=PRSX_"EetOoscbT"
"RTN","PRS8WE",141,0)
 ; for employees covered by PL 108-170
"RTN","PRS8WE",142,0)
 I PMP'=""&("^S^T^U^V^"[(U_PMP_U)) D
"RTN","PRS8WE",143,0)
 . I $E(ENT,28),PRSX'["Eet" S PRSX=PRSX_"Eet"
"RTN","PRS8WE",144,0)
 . I $E(ENT,12),PRSX'["Oos" S PRSX=PRSX_"Oos"
"RTN","PRS8WE",145,0)
 . I $E(ENT,17),PRSX'["c" S PRSX=PRSX_"c"
"RTN","PRS8WE",146,0)
 . I $E(ENT,29),PRSX'["b" S PRSX=PRSX_"b"
"RTN","PRS8WE",147,0)
 . I $E(ENT,18),PRSX'["T" S PRSX=PRSX_"T"
"RTN","PRS8WE",148,0)
 Q PRSX
"RTN","PRS8WE",149,0)
 ;
"RTN","PRS8WE",150,0)
AV() ; List types of time that might be eligible for premium pay
"RTN","PRS8WE",151,0)
 N PRSX
"RTN","PRS8WE",152,0)
 ; for regular time
"RTN","PRS8WE",153,0)
 S PRSX=$S(TYP["B":"",1:"1234XY")
"RTN","PRS8WE",154,0)
 ; for OT/CT
"RTN","PRS8WE",155,0)
 S PRSX=PRSX_$S(TYP["B":"EeOos",TYP["N"!(TYP["H"):"EeOosc",1:"")
"RTN","PRS8WE",156,0)
 I HYBRID S PRSX=PRSX_"EeOosc"
"RTN","PRS8WE",157,0)
 ; for employees covered by PL 108-170
"RTN","PRS8WE",158,0)
 I PMP'=""&("^S^T^U^V^"[(U_PMP_U)) D
"RTN","PRS8WE",159,0)
 . I $E(ENT,28),PRSX'["Ee" S PRSX=PRSX_"Ee"
"RTN","PRS8WE",160,0)
 . I $E(ENT,12),PRSX'["Oos" S PRSX=PRSX_"Oos"
"RTN","PRS8WE",161,0)
 . I $E(ENT,17),PRSX'["c" S PRSX=PRSX_"c"
"RTN","PRS8WE",162,0)
 Q PRSX
"RTN","PRS8WE",163,0)
 ;
"RTN","PRS8WE",164,0)
CTS(XW,XH) ; Return class of a time segment
"RTN","PRS8WE",165,0)
 ; input XW = type of time in activity ("W") string
"RTN","PRS8WE",166,0)
 ;       XH = value in holiday ("H")  string
"RTN","PRS8WE",167,0)
 ; returns class
"RTN","PRS8WE",168,0)
 ;    "R"  regular scheduled
"RTN","PRS8WE",169,0)
 ;    "X"  extra (ot/ct) or unscheduled reg.
"RTN","PRS8WE",170,0)
 ;    "N"  not worked (includes on-call, standby when not called back)
"RTN","PRS8WE",171,0)
 Q $S(("LRSFGDUAJMWNnVH123XYmZq"[XW)!((XW="O")&(XH=2)):"R",("EetscbT4"[XW)!((XW="O")&(XH'=2)):"X",1:"N")
"RTN","PRS8WE",172,0)
 ;
"RTN","PRS8WE",173,0)
TDT(DAYN) ; Two-Day Tour extrinsic variable
"RTN","PRS8WE",174,0)
 ; input
"RTN","PRS8WE",175,0)
 ;   DAYN = day # (0-15) being checked for at least one sch. 2-day tour
"RTN","PRS8WE",176,0)
 ; returns 0 (false) or 1 (true)
"RTN","PRS8WE",177,0)
 N RET
"RTN","PRS8WE",178,0)
 S RET=0 ; assume no scheduled 2-day tour of duty
"RTN","PRS8WE",179,0)
 S X=$G(^TMP($J,"PRS8",DAYN,0))
"RTN","PRS8WE",180,0)
 F I=2,13 I $P(X,U,I),$P($G(^PRST(457.1,$P(X,U,I),0)),U,5)="Y" S RET=1
"RTN","PRS8WE",181,0)
 Q RET
"RTN","PRS8WE",182,0)
 ;
"RTN","PRS8WE",183,0)
 ;PRS8WE
"RTN","PRSA8BNI")
0^102^B31924622^B27323554
"RTN","PRSA8BNI",1,0)
PRSA8BNI ;WOIFO/JAH - Tour Hours vs 8B Norm Hrs Report ;7/9/08
"RTN","PRSA8BNI",2,0)
 ;;4.0;PAID;**116,117**;Sep 21, 1995;Build 32
"RTN","PRSA8BNI",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRSA8BNI",4,0)
 Q
"RTN","PRSA8BNI",5,0)
 ;
"RTN","PRSA8BNI",6,0)
GETPP() ;prompt for pay period
"RTN","PRSA8BNI",7,0)
 N DIC,X,Y,PPI,DTOUT
"RTN","PRSA8BNI",8,0)
 S DIC="^PRST(458,",DIC(0)="AEQM",DIC("A")="Select PAY PERIOD: "
"RTN","PRSA8BNI",9,0)
 W !
"RTN","PRSA8BNI",10,0)
 D ^DIC
"RTN","PRSA8BNI",11,0)
 S PPI=+Y
"RTN","PRSA8BNI",12,0)
 I $D(DTOUT)!(+Y'>0) S PPI=0
"RTN","PRSA8BNI",13,0)
 Q PPI
"RTN","PRSA8BNI",14,0)
NOTOURS() ;return true if user wants to see data from employees with
"RTN","PRSA8BNI",15,0)
 ;        no tour of duty set up yet
"RTN","PRSA8BNI",16,0)
 ;        otherwise return 0 or -1 for abort
"RTN","PRSA8BNI",17,0)
 ;
"RTN","PRSA8BNI",18,0)
 N DIR,DIRUT,Y
"RTN","PRSA8BNI",19,0)
 S DIR(0)="Y"
"RTN","PRSA8BNI",20,0)
 S DIR("B")="N"
"RTN","PRSA8BNI",21,0)
 S DIR("A")="Include employees with no tour of duty entered"
"RTN","PRSA8BNI",22,0)
 D ^DIR
"RTN","PRSA8BNI",23,0)
 Q:$D(DIRUT) -1
"RTN","PRSA8BNI",24,0)
 Q +Y
"RTN","PRSA8BNI",25,0)
 ;
"RTN","PRSA8BNI",26,0)
NOTCARD() ;return true if user wants to see data from employees with
"RTN","PRSA8BNI",27,0)
 ;  no timecard on file, ie no entry for pp in 458
"RTN","PRSA8BNI",28,0)
 ;  otherwise return 0 or -1 for abort
"RTN","PRSA8BNI",29,0)
 ;
"RTN","PRSA8BNI",30,0)
 N DIR,DIRUT,Y
"RTN","PRSA8BNI",31,0)
 S DIR(0)="Y"
"RTN","PRSA8BNI",32,0)
 S DIR("B")="N"
"RTN","PRSA8BNI",33,0)
 S DIR("A")="Include employees with no timecard on file"
"RTN","PRSA8BNI",34,0)
 D ^DIR
"RTN","PRSA8BNI",35,0)
 Q:$D(DIRUT) -1
"RTN","PRSA8BNI",36,0)
 Q +Y
"RTN","PRSA8BNI",37,0)
SHONOTES() ;return true if user wants to see footnotes that describe
"RTN","PRSA8BNI",38,0)
 ; the columns in the report at the end of the report
"RTN","PRSA8BNI",39,0)
 ;
"RTN","PRSA8BNI",40,0)
 N DIR,DIRUT,Y
"RTN","PRSA8BNI",41,0)
 S DIR(0)="Y"
"RTN","PRSA8BNI",42,0)
 S DIR("B")="N"
"RTN","PRSA8BNI",43,0)
 S DIR("A")="Include report footnotes"
"RTN","PRSA8BNI",44,0)
 D ^DIR
"RTN","PRSA8BNI",45,0)
 Q:$D(DIRUT) -1
"RTN","PRSA8BNI",46,0)
 Q +Y
"RTN","PRSA8BNI",47,0)
DAILYHRS() ;return true if user wants to see tour hours for each day
"RTN","PRSA8BNI",48,0)
 ;  otherwise return 0 or -1 for abort
"RTN","PRSA8BNI",49,0)
 ;
"RTN","PRSA8BNI",50,0)
 N DIR,DIRUT,Y
"RTN","PRSA8BNI",51,0)
 S DIR(0)="Y"
"RTN","PRSA8BNI",52,0)
 S DIR("B")="N"
"RTN","PRSA8BNI",53,0)
 S DIR("A")="Include employees daily tour hours"
"RTN","PRSA8BNI",54,0)
 D ^DIR
"RTN","PRSA8BNI",55,0)
 Q:$D(DIRUT) -1
"RTN","PRSA8BNI",56,0)
 Q +Y
"RTN","PRSA8BNI",57,0)
 ;
"RTN","PRSA8BNI",58,0)
TRHDR ;
"RTN","PRSA8BNI",59,0)
 W !!,?7,"Day",?12,"ToD #*",?19,"Tour Week 1",?34,"Hours*",?47,"ToD #*",?54,"Tour Week 2",?69,"Hours*"
"RTN","PRSA8BNI",60,0)
 W !,?7,"---",?12,"-----",?19,"-----------",?34,"-----",?47,"-----",?54,"-----------",?69,"-----"
"RTN","PRSA8BNI",61,0)
 Q
"RTN","PRSA8BNI",62,0)
EMPINFO(PRSENAME,PRSSN,HRS) ;
"RTN","PRSA8BNI",63,0)
 W !!?2,PRSENAME,?26,PRSSN,?44,$P(HRS,U),?55,$P(HRS,U,2)
"RTN","PRSA8BNI",64,0)
 I $G(DUZ(0))="@" W ?63,PRSIEN
"RTN","PRSA8BNI",65,0)
 Q
"RTN","PRSA8BNI",66,0)
HDR(PG,TSTAMP,END,FORWHO,PPE,PPRANGE,OPT) ;
"RTN","PRSA8BNI",67,0)
 S PG=PG+1
"RTN","PRSA8BNI",68,0)
 W @IOF
"RTN","PRSA8BNI",69,0)
 N H1,H2,B,OPTHDR
"RTN","PRSA8BNI",70,0)
 S H1="VA TIME & ATTENDANCE REPORT "_FORWHO_"--"_TSTAMP
"RTN","PRSA8BNI",71,0)
 S B=$E("               ",1,(IOM-$L(H1))\2-3-$L(PG))
"RTN","PRSA8BNI",72,0)
 S OPTHDR=$S($G(OPT)>0:"Display Employee Tour Hours",1:"Tour Hrs Don't Match 8B Normal Hrs")
"RTN","PRSA8BNI",73,0)
 S H2=OPTHDR_": PP "_PPE_" ("_PPRANGE_")"
"RTN","PRSA8BNI",74,0)
 W !,?(IOM-$L(H1)\2),H1,B,"p",PG,!,?(IOM-$L(H2)\2),H2
"RTN","PRSA8BNI",75,0)
 Q:END
"RTN","PRSA8BNI",76,0)
 W !!,?2,"EMPLOYEE NAME",?26,"    SSN",?40,"8B NRM HRS   ToD HRS*"
"RTN","PRSA8BNI",77,0)
 I $G(DUZ(0))="@" W ?63,"IEN 450"
"RTN","PRSA8BNI",78,0)
 W !?2,"======================",?26,"===========",?40,"==========   ======="
"RTN","PRSA8BNI",79,0)
 I $G(DUZ(0))="@" W "   ======="
"RTN","PRSA8BNI",80,0)
 Q
"RTN","PRSA8BNI",81,0)
 ;
"RTN","PRSA8BNI",82,0)
RET(TSTAMP) ;
"RTN","PRSA8BNI",83,0)
 I ($E(IOST,1,2)'="C-")!($D(ZTQUEUED)) D HDR(.PG,TSTAMP,0,FORWHO,PPE,PPRANGE) Q 0
"RTN","PRSA8BNI",84,0)
 ;
"RTN","PRSA8BNI",85,0)
 N OUT
"RTN","PRSA8BNI",86,0)
 S OUT=$$ASK^PRSLIB00(1)
"RTN","PRSA8BNI",87,0)
 I 'OUT D HDR(.PG,TSTAMP,0,FORWHO,PPE,PPRANGE)
"RTN","PRSA8BNI",88,0)
 Q OUT
"RTN","PRSA8BNI",89,0)
GETHOURS(PPI,PRSIEN) ; Return TOUR HOURS AND NORMAL HOURS
"RTN","PRSA8BNI",90,0)
 N MATCH,HRS,NH,ENT,ENTPTR,DFN,TH
"RTN","PRSA8BNI",91,0)
 I $G(PPI)'>0!($G(PRSIEN)'>0) Q 1
"RTN","PRSA8BNI",92,0)
 S MATCH=1
"RTN","PRSA8BNI",93,0)
 S NH=-1
"RTN","PRSA8BNI",94,0)
 S ENTPTR=$P($G(^PRST(458,PPI,"E",PRSIEN,0)),U,5)
"RTN","PRSA8BNI",95,0)
 I ENTPTR'="" D
"RTN","PRSA8BNI",96,0)
 .  S ENT=$P($G(^PRST(457.5,ENTPTR,1)),U)
"RTN","PRSA8BNI",97,0)
 .  S NH=$E($G(^PRST(458,PPI,"E",PRSIEN,5)),26,27)
"RTN","PRSA8BNI",98,0)
 .  Q:NH="00"
"RTN","PRSA8BNI",99,0)
 .  I +NH'>0 S NH=$P($G(^PRSPC(PRSIEN,0)),U,50)
"RTN","PRSA8BNI",100,0)
 I $G(ENT)="" S DFN=PRSIEN D ^PRSAENT
"RTN","PRSA8BNI",101,0)
 I $G(ENT)'="",$E(ENT)'="D",($E(ENT,1,2)'="0D") D
"RTN","PRSA8BNI",102,0)
 .  D TOURHRS^PRSARC07(.HRS,PPI,PRSIEN)
"RTN","PRSA8BNI",103,0)
 .  S TH=($G(HRS("W1"))+$G(HRS("W2")))
"RTN","PRSA8BNI",104,0)
 Q NH_U_TH
"RTN","PRSA8BNI",105,0)
 ;
"RTN","PRSA8BNI",106,0)
REPDONE(OUT,TLECNT,TSTAMP,DAILYHRS,GRANDTOT) ; report done display page
"RTN","PRSA8BNI",107,0)
 ;
"RTN","PRSA8BNI",108,0)
 I TLECNT=0 D HDR(.PG,TSTAMP,1,FORWHO,PPE,PPRANGE) W !,"NO T&L UNITS WERE FOUND ASSIGNED TO YOU THAT COULD BE CHECKED." Q
"RTN","PRSA8BNI",109,0)
 I 'OUT,$Y>(IOSL-24) S OUT=$$ASK^PRSLIB00(1) D HDR(.PG,TSTAMP,1,FORWHO,PPE,PPRANGE)
"RTN","PRSA8BNI",110,0)
 I OUT W !!,"********REPORT ABORTED*********"
"RTN","PRSA8BNI",111,0)
 E  W !!,"REPORT COMPLETED.  TOTAL MISMATCHES FOUND:  ",GRANDTOT
"RTN","PRSA8BNI",112,0)
 D FOOTNOTE(DAILYHRS)
"RTN","PRSA8BNI",113,0)
 Q
"RTN","PRSA8BNI",114,0)
FOOTNOTE(DAILYHRS) ; display notes about the report
"RTN","PRSA8BNI",115,0)
 W !,"================================================================="
"RTN","PRSA8BNI",116,0)
 N TXT,I
"RTN","PRSA8BNI",117,0)
 W !
"RTN","PRSA8BNI",118,0)
 F I=1:1 S TXT=$P($T(ALLFT+I),";",3) Q:TXT=""  W !,TXT
"RTN","PRSA8BNI",119,0)
 I DAILYHRS D
"RTN","PRSA8BNI",120,0)
 .  F I=1:1 S TXT=$P($T(DAILYFT+I),";",3) Q:TXT=""  W !,TXT
"RTN","PRSA8BNI",121,0)
 Q
"RTN","PRSA8BNI",122,0)
ALLFT ;;
"RTN","PRSA8BNI",123,0)
 ;;                   FOOTNOTES TO REPORT HEADINGS
"RTN","PRSA8BNI",124,0)
 ;;                   ============================
"RTN","PRSA8BNI",125,0)
 ;;*ToD HRS (Tour of Duty Hours) The total Tour of Duty hours that fall within the
"RTN","PRSA8BNI",126,0)
 ;;--------  two week pay period, beginning midnight Saturday.  Hours that cross 
"RTN","PRSA8BNI",127,0)
 ;;          midnight from a tour that starts on the last day of a pay period will
"RTN","PRSA8BNI",128,0)
 ;;          appear on the following pay period.
"RTN","PRSA8BNI",129,0)
 ;;.....................................................................
"RTN","PRSA8BNI",130,0)
DAILYFT ;;
"RTN","PRSA8BNI",131,0)
 ;;*Hours   (DAILY TOUR HOURS) This column contains actual tour hours that fall
"RTN","PRSA8BNI",132,0)
 ;;------    on that day from the 24 hour period beginning at midnight.  A two day
"RTN","PRSA8BNI",133,0)
 ;;          tour will contribute hours to each day the tour falls on.  Hours 
"RTN","PRSA8BNI",134,0)
 ;;          that cross midnight from a tour that starts on the last day of a pay
"RTN","PRSA8BNI",135,0)
 ;;          period will appear on the following pay period.
"RTN","PRSA8BNI",136,0)
 ;;.....................................................................
"RTN","PRSA8BNI",137,0)
 ;;*ToD #   (Tour of Duty Number) The tour's entry number in the Tour 
"RTN","PRSA8BNI",138,0)
 ;;------   of Duty file (#457.1) 
"RTN","PRSA8BNI",139,0)
 ;;.....................................................................
"RTN","PRSA8BTH")
0^103^B19035559^n/a
"RTN","PRSA8BTH",1,0)
PRSA8BTH ;WOIFO/JAH - Tour Hours Display ;7/9/08
"RTN","PRSA8BTH",2,0)
 ;;4.0;PAID;**117**;Sep 21, 1995;Build 32
"RTN","PRSA8BTH",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRSA8BTH",4,0)
 Q
"RTN","PRSA8BTH",5,0)
 ;
"RTN","PRSA8BTH",6,0)
TOURHRP ;Tour Hours Display for payroll
"RTN","PRSA8BTH",7,0)
 N PRSTLV,FORWHO,TLS
"RTN","PRSA8BTH",8,0)
 S PRSTLV=7
"RTN","PRSA8BTH",9,0)
 S TLS=0
"RTN","PRSA8BTH",10,0)
 S FORWHO="for Payroll"
"RTN","PRSA8BTH",11,0)
 ;
"RTN","PRSA8BTH",12,0)
TOURHRT ; Tour hours display for timekeeper
"RTN","PRSA8BTH",13,0)
 I $G(PRSTLV)'>0 N TLS,PRSTLV,FORWHO S TLS=1,PRSTLV=2,FORWHO="for Timekeeper"
"RTN","PRSA8BTH",14,0)
 ;
"RTN","PRSA8BTH",15,0)
TOURHRS ; Tour hours for T&L supervisor
"RTN","PRSA8BTH",16,0)
 I $G(PRSTLV)'>0 N PRSTLV,TLS,FORWHO S TLS=1,PRSTLV=3,FORWHO="for T&A Supervisor"
"RTN","PRSA8BTH",17,0)
 ;
"RTN","PRSA8BTH",18,0)
 N DIR,DIRUT,Y,PPI,PPE,NOTOUR,NOTCARD,PPRANGE,DAILYHRS,EP,SP,SDT,EDT
"RTN","PRSA8BTH",19,0)
 N SHONOTES,PRSIEN,TLI
"RTN","PRSA8BTH",20,0)
 S PRSIEN=0
"RTN","PRSA8BTH",21,0)
 I TLS=1 D
"RTN","PRSA8BTH",22,0)
 .  D ^PRSAUTL
"RTN","PRSA8BTH",23,0)
 .  Q:TLS=1&($G(TLI)="")
"RTN","PRSA8BTH",24,0)
 .  S PRSIEN=$$SELEMP(TLE)
"RTN","PRSA8BTH",25,0)
 E  D
"RTN","PRSA8BTH",26,0)
 .  S PRSIEN=$$SELEMP(0)
"RTN","PRSA8BTH",27,0)
 Q:TLS=1&($G(TLI)="")!(PRSIEN'>0)
"RTN","PRSA8BTH",28,0)
 ;
"RTN","PRSA8BTH",29,0)
 S PPI=$$GETPP^PRSA8BNI()
"RTN","PRSA8BTH",30,0)
 Q:PPI'>0
"RTN","PRSA8BTH",31,0)
 S PPE=$P($G(^PRST(458,PPI,0)),U)
"RTN","PRSA8BTH",32,0)
 S SDT=$P($G(^PRST(458,PPI,2)),U)
"RTN","PRSA8BTH",33,0)
 S EDT=$P($G(^PRST(458,PPI,2)),U,14)
"RTN","PRSA8BTH",34,0)
 S SP=$L(SDT," ")
"RTN","PRSA8BTH",35,0)
 S EP=$L(EDT," ")
"RTN","PRSA8BTH",36,0)
 S PPRANGE=$P(SDT," ",SP)_" thru "_$P(EDT," ",EP)
"RTN","PRSA8BTH",37,0)
 ;
"RTN","PRSA8BTH",38,0)
 S SHONOTES=$$SHONOTES^PRSA8BNI() ; want to see footnotes to display?
"RTN","PRSA8BTH",39,0)
 Q:SHONOTES<0
"RTN","PRSA8BTH",40,0)
 ;
"RTN","PRSA8BTH",41,0)
 N %ZIS,POP,IOP,ZTSK
"RTN","PRSA8BTH",42,0)
 S %ZIS="MQ"
"RTN","PRSA8BTH",43,0)
 D ^%ZIS
"RTN","PRSA8BTH",44,0)
 Q:POP
"RTN","PRSA8BTH",45,0)
 I $D(IO("Q")) D
"RTN","PRSA8BTH",46,0)
 .  K IO("Q")
"RTN","PRSA8BTH",47,0)
 .  N ZTDESC,ZTRTN,ZTSAVE
"RTN","PRSA8BTH",48,0)
 .  S ZTDESC="PAID REPORT: TOUR HOURS DISPLAY"
"RTN","PRSA8BTH",49,0)
 .  S ZTRTN="TOUR8B^PRSA8BTH(PRSIEN)"
"RTN","PRSA8BTH",50,0)
 .  S ZTSAVE("PRSTLV")=""
"RTN","PRSA8BTH",51,0)
 .  S ZTSAVE("PRSIEN")=""
"RTN","PRSA8BTH",52,0)
 .  S ZTSAVE("TLE")=""
"RTN","PRSA8BTH",53,0)
 .  S ZTSAVE("PPI")=""
"RTN","PRSA8BTH",54,0)
 .  S ZTSAVE("PPE")=""
"RTN","PRSA8BTH",55,0)
 .  S ZTSAVE("TLS")=""
"RTN","PRSA8BTH",56,0)
 .  S ZTSAVE("PPRANGE")=""
"RTN","PRSA8BTH",57,0)
 .  S ZTSAVE("FORWHO")=""
"RTN","PRSA8BTH",58,0)
 .  S ZTSAVE("SHONOTES")=""
"RTN","PRSA8BTH",59,0)
 .  D ^%ZTLOAD
"RTN","PRSA8BTH",60,0)
 .  I $D(ZTSK) W !,"Task ",ZTSK," Queued."
"RTN","PRSA8BTH",61,0)
 E  D
"RTN","PRSA8BTH",62,0)
 .  D TOUR8B(PRSIEN)
"RTN","PRSA8BTH",63,0)
 K PRSTLV
"RTN","PRSA8BTH",64,0)
 D ^%ZISC K %ZIS,IOP
"RTN","PRSA8BTH",65,0)
 W ! S OUT=$$ASK^PRSLIB00(1)
"RTN","PRSA8BTH",66,0)
 Q
"RTN","PRSA8BTH",67,0)
 ;
"RTN","PRSA8BTH",68,0)
SELEMP(TLE) ;Select employee by T&L or any employee if TLE = 0
"RTN","PRSA8BTH",69,0)
 ;
"RTN","PRSA8BTH",70,0)
 N DIC,EMPLOYEE,D,Y
"RTN","PRSA8BTH",71,0)
 S DIC("A")="Select EMPLOYEE: "
"RTN","PRSA8BTH",72,0)
 S DIC(0)="AEQM"
"RTN","PRSA8BTH",73,0)
 S DIC="^PRSPC("
"RTN","PRSA8BTH",74,0)
 I TLE]0 D
"RTN","PRSA8BTH",75,0)
 . S D="ATL"_TLE
"RTN","PRSA8BTH",76,0)
 . S DIC("S")="I $P(^(0),""^"",8)=TLE"
"RTN","PRSA8BTH",77,0)
 . D IX^DIC
"RTN","PRSA8BTH",78,0)
 E  D
"RTN","PRSA8BTH",79,0)
 . D ^DIC
"RTN","PRSA8BTH",80,0)
 S EMPLOYEE=+Y
"RTN","PRSA8BTH",81,0)
 Q EMPLOYEE
"RTN","PRSA8BTH",82,0)
 ;
"RTN","PRSA8BTH",83,0)
TOUR8B(PRSIEN) ;
"RTN","PRSA8BTH",84,0)
 U IO
"RTN","PRSA8BTH",85,0)
 N DFN,OUT,TLECNT,TSTAMP,Y,%,%I,PG,ATL,ENT
"RTN","PRSA8BTH",86,0)
 N EMPNODE,PRSENAME,HRS,EMPND1,SEPIND,WEEKHRS,PRSD,PRSSN
"RTN","PRSA8BTH",87,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","PRSA8BTH",88,0)
 D NOW^%DTC S Y=% D DD^%DT S TSTAMP=$P(Y,":",1,2)
"RTN","PRSA8BTH",89,0)
 S (OUT,PG)=0
"RTN","PRSA8BTH",90,0)
 D HDR^PRSA8BNI(.PG,TSTAMP,0,FORWHO,PPE,PPRANGE,1)
"RTN","PRSA8BTH",91,0)
 ;  skip Extended LWOP or anyone without a timecard
"RTN","PRSA8BTH",92,0)
 I $G(^PRST(458,PPI,"E",PRSIEN,0))="" D  Q
"RTN","PRSA8BTH",93,0)
 .  W !,"Employee doesn't have a timecard in this pay period"
"RTN","PRSA8BTH",94,0)
 I $P($G(^PRST(458,PPI,"E",PRSIEN,"D",1,0)),U,2)="" D  Q
"RTN","PRSA8BTH",95,0)
 .  W !,"Employee doesn't have a tour of duty in this pay period" Q
"RTN","PRSA8BTH",96,0)
 ;
"RTN","PRSA8BTH",97,0)
 ; Try to get employee entitlement from the pay period being displayed
"RTN","PRSA8BTH",98,0)
 ; otherwise we'll have to settle for current entitlement
"RTN","PRSA8BTH",99,0)
 N ENTPOINT
"RTN","PRSA8BTH",100,0)
 S ENTPOINT=$P($G(^PRST(458,PPI,"E",PRSIEN,"D",1,0)),U,5)
"RTN","PRSA8BTH",101,0)
 I ENTPOINT>0 D
"RTN","PRSA8BTH",102,0)
 .  S ENT=$G(^PRST(457.5,ENTPOINT,0))
"RTN","PRSA8BTH",103,0)
 I $G(ENT)="" D
"RTN","PRSA8BTH",104,0)
 .  S DFN=PRSIEN D ^PRSAENT
"RTN","PRSA8BTH",105,0)
 I $E(ENT)="D"!($E(ENT,1,2)="0D") D  Q
"RTN","PRSA8BTH",106,0)
 .  W !,"This employee is on daily tours with no tour hours"
"RTN","PRSA8BTH",107,0)
 S EMPNODE=$G(^PRSPC(PRSIEN,0))
"RTN","PRSA8BTH",108,0)
 S EMPND1=$G(^PRSPC(PRSIEN,1))
"RTN","PRSA8BTH",109,0)
 S SEPIND=$P(EMPND1,U,33)
"RTN","PRSA8BTH",110,0)
 Q:EMPNODE=""!(SEPIND="Y")
"RTN","PRSA8BTH",111,0)
 ; call to get tour hours and 8b normal hours for the pay period, but
"RTN","PRSA8BTH",112,0)
 ; if no 8b string on file then normal hours are current normal hrs.
"RTN","PRSA8BTH",113,0)
 S WEEKHRS=$$GETHOURS^PRSA8BNI(PPI,PRSIEN)
"RTN","PRSA8BTH",114,0)
 S PRSENAME=$P($G(^PRSPC(PRSIEN,0)),U)
"RTN","PRSA8BTH",115,0)
 S PRSSN=$P($G(^PRSPC(PRSIEN,0)),U,9)
"RTN","PRSA8BTH",116,0)
 S PRSSN=$S(PRSTLV=7:$E(PRSSN,1,3)_"-"_$E(PRSSN,4,5),PRSTLV'<2:$E(PRSSN,1)_"XX-XX",1:"XXX-XX")_"-"_$E(PRSSN,6,9)
"RTN","PRSA8BTH",117,0)
 D EMPINFO^PRSA8BNI(PRSENAME,PRSSN,WEEKHRS)
"RTN","PRSA8BTH",118,0)
 ;  show the actual tour hours for each day
"RTN","PRSA8BTH",119,0)
 N HRS,I
"RTN","PRSA8BTH",120,0)
 D TOURHRS^PRSARC07(.HRS,PPI,PRSIEN)
"RTN","PRSA8BTH",121,0)
 D TRHDR^PRSA8BNI
"RTN","PRSA8BTH",122,0)
 F PRSD=1:1:7 D  Q:OUT
"RTN","PRSA8BTH",123,0)
 .  I $Y>(IOSL-4) S OUT=$$RET^PRSA8BNI(TSTAMP) Q:OUT  D EMPINFO^PRSA8BNI(PRSENAME,PRSSN,WEEKHRS),TRHDR^PRSA8BNI
"RTN","PRSA8BTH",124,0)
 .  Q:OUT
"RTN","PRSA8BTH",125,0)
 .  D TOURDISP^PRSA8BNH(PPI,PRSIEN,PRSD,.HRS)
"RTN","PRSA8BTH",126,0)
 I SHONOTES S OUT=$$ASK^PRSLIB00() I 'OUT W @IOF D FOOTNOTE^PRSA8BNI(1)
"RTN","PRSA8BTH",127,0)
 Q
"RTN","PRSASR")
0^113^B51691703^B51171967
"RTN","PRSASR",1,0)
PRSASR ;HISC/MGD,WOIFO/JAH/PLT - Supervisor Certification ;02/05/2005
"RTN","PRSASR",2,0)
 ;;4.0;PAID;**2,7,8,22,37,43,82,93,112,117**;Sep 21, 1995;Build 32
"RTN","PRSASR",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRSASR",4,0)
 ;
"RTN","PRSASR",5,0)
 ;Called by Pay Per Cert Option on T&A Superv menu. Timecard 4 each 
"RTN","PRSASR",6,0)
 ;employee in this supervs T&L is displayed.  Superv prompted at each 
"RTN","PRSASR",7,0)
 ;display as to whether card is ready 4 certification. Cards that r
"RTN","PRSASR",8,0)
 ;ready r saved in ^TMP.  After this review--elect sign code is 
"RTN","PRSASR",9,0)
 ;required to release approved cards to payroll. Upon ES
"RTN","PRSASR",10,0)
 ; 8b, exceptions, & ot warnings r stored & timecard status 
"RTN","PRSASR",11,0)
 ;changed to 'P'--'released to payroll' 
"RTN","PRSASR",12,0)
 ;
"RTN","PRSASR",13,0)
 ;=====================================================================
"RTN","PRSASR",14,0)
 ;
"RTN","PRSASR",15,0)
 ;Set up reverse video ON & OFF for tour error highlighting
"RTN","PRSASR",16,0)
 N IORVOFF,IORVON,IOINHI,IOINORM,IOBOFF,IOBON,RESP
"RTN","PRSASR",17,0)
 S X="IORVOFF;IORVON;IOBOFF;IOBON;IOINHI;IOINORM" D ENDR^%ZISS
"RTN","PRSASR",18,0)
 ;
"RTN","PRSASR",19,0)
 N MIDPP,DUMMY
"RTN","PRSASR",20,0)
 S MIDPP="In middle of Pay Period; Cannot Certify & Release."
"RTN","PRSASR",21,0)
 W:$E(IOST,1,2)="C-" @IOF W !?26,"VA TIME & ATTENDANCE SYSTEM"
"RTN","PRSASR",22,0)
 W !?27,"SUPERVISORY CERTIFICATION"
"RTN","PRSASR",23,0)
 S PRSTLV=3 D ^PRSAUTL G:TLI<1 EX
"RTN","PRSASR",24,0)
 D NOW^%DTC
"RTN","PRSASR",25,0)
 S DT=%\1,APDT=%,Y=$G(^PRST(458,"AD",DT)),PPI=$P(Y,"^",1),DAY=$P(Y,"^",2)
"RTN","PRSASR",26,0)
 I DAY>5,DAY<11 W $C(7),!!,MIDPP G EX
"RTN","PRSASR",27,0)
 I DAY<6 S X1=DT,X2=-7 D C^%DTC S PPI=$P($G(^PRST(458,"AD",X)),"^",1) G:'PPI EX
"RTN","PRSASR",28,0)
 ;     -----------------------------------------
"RTN","PRSASR",29,0)
P0 ;PDT     = string of pay period dates with format - Sun 29-Sep-96^
"RTN","PRSASR",30,0)
 ;PDTI    = string of pay period dates in fileman format.
"RTN","PRSASR",31,0)
 ;PPI     = pay period internal entry number in file 458.
"RTN","PRSASR",32,0)
 ;GLOB    = global reference for employees pay period record
"RTN","PRSASR",33,0)
 ;          returned from $$AVAILREC & passed to UNLOCK.
"RTN","PRSASR",34,0)
 ;     -----------------------------------------
"RTN","PRSASR",35,0)
 ;
"RTN","PRSASR",36,0)
 S PDT=$G(^PRST(458,PPI,2)),PDTI=$G(^(1)),QT=0 K ^TMP($J)
"RTN","PRSASR",37,0)
 ;
"RTN","PRSASR",38,0)
 ;     -----------------------------------------
"RTN","PRSASR",39,0)
 ;Loop thru this supervisor's T&L unit on x-ref in 450.
"RTN","PRSASR",40,0)
 ;$$availrec() ensures there's data & node with employee's 
"RTN","PRSASR",41,0)
 ;pay period record is NOT locked, then locks node.
"RTN","PRSASR",42,0)
 ;Call to CHK checks for needed approvals for current employee
"RTN","PRSASR",43,0)
 ;If supervisor decides record is not ready, during this call,
"RTN","PRSASR",44,0)
 ;then node is unlocked.  Records that super accepts for release
"RTN","PRSASR",45,0)
 ;are not unlocked until they are processed thru temp global
"RTN","PRSASR",46,0)
 ;& their status' are updated.
"RTN","PRSASR",47,0)
 ;     ---------------------------------------------------
"RTN","PRSASR",48,0)
 ;
"RTN","PRSASR",49,0)
 S NN="",CKS=1
"RTN","PRSASR",50,0)
 F  S NN=$O(^PRSPC("ATL"_TLE,NN)) Q:NN=""  F DFN=0:0 S DFN=$O(^PRSPC("ATL"_TLE,NN,DFN)) Q:DFN<1  I $$AVAILREC^PRSLIB00("SUP",.GLOB) D CHK I QT G T0
"RTN","PRSASR",51,0)
 ;
"RTN","PRSASR",52,0)
 ;     ---------------------------------------------------
"RTN","PRSASR",53,0)
 ;Loop through T&L unit file x-ref 2 c if this supervisor certifies
"RTN","PRSASR",54,0)
 ;payperiod data for other supervisors of other T&L units.  If so
"RTN","PRSASR",55,0)
 ;process after ensuring node to be certified is available.
"RTN","PRSASR",56,0)
 ;     ---------------------------------------------------
"RTN","PRSASR",57,0)
 ;
"RTN","PRSASR",58,0)
 S CKS=0
"RTN","PRSASR",59,0)
 F VA2=0:0 S VA2=$$TLSUP Q:VA2<1  S SSN=$$SSN I SSN'="" S DFN=$$DFN S Z=$P($G(^PRSPC(+DFN,0)),"^",8) I Z'="",Z'=TLE,$$AVAILREC^PRSLIB00("SUP",.GLOB) D CHK I QT G EX:'$T,T0
"RTN","PRSASR",60,0)
 ;
"RTN","PRSASR",61,0)
 ;     ---------------------------------------------------
"RTN","PRSASR",62,0)
T0 I $D(^TMP($J,"E")) G T1
"RTN","PRSASR",63,0)
 W !!,"No records have been selected for certification."
"RTN","PRSASR",64,0)
 S DUMMY=$$ASK^PRSLIB00(1) G EX
"RTN","PRSASR",65,0)
 ;
"RTN","PRSASR",66,0)
 ;     ---------------------------------------------------
"RTN","PRSASR",67,0)
 ;
"RTN","PRSASR",68,0)
T1 ;if supervisor signs off then update all records in tmp
"RTN","PRSASR",69,0)
 ;otherwise remove any auto posting.
"RTN","PRSASR",70,0)
 D ^PRSAES I ESOK D
"RTN","PRSASR",71,0)
 .D NOW^%DTC S APDT=%
"RTN","PRSASR",72,0)
 .F DFN=0:0 S DFN=$O(^TMP($J,"E",DFN)) Q:DFN<1  S VAL=$G(^(DFN)) D PROC
"RTN","PRSASR",73,0)
 I 'ESOK D
"RTN","PRSASR",74,0)
 .F DFN=0:0 S DFN=$O(^TMP($J,"E",DFN)) Q:DFN<1  D
"RTN","PRSASR",75,0)
 ..D AUTOPINI^PRS8(PPI,DFN)
"RTN","PRSASR",76,0)
 D EX
"RTN","PRSASR",77,0)
 Q
"RTN","PRSASR",78,0)
 ;
"RTN","PRSASR",79,0)
 ;     ---------------------------------------------------
"RTN","PRSASR",80,0)
CHK ; Check for needed approvals
"RTN","PRSASR",81,0)
 N PRSENT,PRSWOC
"RTN","PRSASR",82,0)
 S STAT=$P($G(^PRST(458,PPI,"E",DFN,0)),"^",2) I "PX"[STAT Q
"RTN","PRSASR",83,0)
 I USR=DFN Q:'$D(^XUSEC("PRSA SIGN",DUZ))
"RTN","PRSASR",84,0)
 E  I CKS S SSN=$P($G(^PRSPC(DFN,0)),"^",9) I SSN S EDUZ=+$O(^VA(200,"SSN",SSN,0)) I $D(^PRST(455.5,"AS",EDUZ,TLI)) Q:$P($G(^PRST(455.5,TLI,"S",EDUZ,0)),"^",2)'=TLE
"RTN","PRSASR",85,0)
 S HDR=0 D HDR,^PRSAENT S PRSENT=ENT
"RTN","PRSASR",86,0)
 ;
"RTN","PRSASR",87,0)
 ;Loop to display tour, exceptions(leave, etc..) & errors.
"RTN","PRSASR",88,0)
 ;
"RTN","PRSASR",89,0)
 S (XF,X9)=0
"RTN","PRSASR",90,0)
 F DAY=1:1:14 D TOURERR($P(PDT,"^",DAY),.X9,.XF) D:$Y>(IOSL-6)&(DAY<14) HDR G:QT O1
"RTN","PRSASR",91,0)
 ;
"RTN","PRSASR",92,0)
 ;Display VCS commission sales, if applicable
"RTN","PRSASR",93,0)
 S Z=$G(^PRST(458,PPI,"E",DFN,2))
"RTN","PRSASR",94,0)
 I Z'="" D:$Y>(IOSL-11) HDR Q:QT  D VCS^PRSASR1
"RTN","PRSASR",95,0)
 ;
"RTN","PRSASR",96,0)
 ;
"RTN","PRSASR",97,0)
 S Z=$G(^PRST(458,PPI,"E",DFN,4))
"RTN","PRSASR",98,0)
 I Z'="" D:$Y>(IOSL-9) HDR Q:QT  D ED^PRSASR1
"RTN","PRSASR",99,0)
 I XF W !,IORVON,"Serious error; cannot release.",IORVOFF S QT=$$ASK^PRSLIB00() Q
"RTN","PRSASR",100,0)
 S QT=$$ASK^PRSLIB00() Q:QT
"RTN","PRSASR",101,0)
 ;
"RTN","PRSASR",102,0)
 ;PRS8 call creates & stores 8B string in employees attendance
"RTN","PRSASR",103,0)
 ;record.  Later, under a payroll option, string will be
"RTN","PRSASR",104,0)
 ;transmitted to Austin.
"RTN","PRSASR",105,0)
 ;
"RTN","PRSASR",106,0)
 N NN D ONE^PRS8 S C0=$G(^PRSPC(DFN,0)),PY=PPI D CERT^PRS8VW S QT=0
"RTN","PRSASR",107,0)
 ;
"RTN","PRSASR",108,0)
 ;Show OT (approve-vs-8B) warning & save in TMP.
"RTN","PRSASR",109,0)
 N WK,OTERR,O8,OA
"RTN","PRSASR",110,0)
 F WK=1:1:2 D
"RTN","PRSASR",111,0)
 .  D WARNSUP^PRSAOTT(PPE,DFN,VAL,WK,.OTERR,.O8,.OA)
"RTN","PRSASR",112,0)
 .  I OTERR S ^TMP($J,"OT",DFN,WK)=O8_"^"_OA
"RTN","PRSASR",113,0)
 ;
"RTN","PRSASR",114,0)
 ;warning message for rs/rn and on type of time
"RTN","PRSASR",115,0)
 I $E(PRSENT,5) D
"RTN","PRSASR",116,0)
 . I @($TR($$CD8B^PRSU1B2(VAL,"RS^3^RN^3",1),U,"+")_"-("_$TR($$RSHR^PRSU1B2(DFN,PPI),U,"+")_")") W !,?3,"WARNING: The total scheduled recess hours for this pay period does not match the total RS/RN posted."
"RTN","PRSASR",117,0)
 . I $G(PRSWOC)]"" W !,?3,"Warning: The entire tour for day# ",PRSWOC," is posted RECESS. The On-Call will be paid unless posted UNAVAILABLE."
"RTN","PRSASR",118,0)
 . QUIT
"RTN","PRSASR",119,0)
 ;
"RTN","PRSASR",120,0)
LD ; Check for changes to the Labor Distribution Codes made during the pay
"RTN","PRSASR",121,0)
 ; period.
"RTN","PRSASR",122,0)
 I $D(^PRST(458,PPI,"E",DFN,"LDAUD")) D LD^PRSASR1
"RTN","PRSASR",123,0)
 ;     ---------------------------------------------------
"RTN","PRSASR",124,0)
OK ;Prompt Supervisor to release timecard.  If yes, store in ^TMP(.
"RTN","PRSASR",125,0)
 ;If supervisor answers no then bypass & unlock record.
"RTN","PRSASR",126,0)
 ;     ---------------------------------------------------
"RTN","PRSASR",127,0)
 W !!,IORVON,"Release to Payroll?",IORVOFF," "
"RTN","PRSASR",128,0)
 R X:DTIME S:'$T!(X["^") QT=1 Q:QT  S:X="" X="*" S X=$TR(X,"yesno","YESNO")
"RTN","PRSASR",129,0)
 I $P("YES",X,1)'="",$P("NO",X,1)'="" W $C(7)," Answer YES or NO" G OK
"RTN","PRSASR",130,0)
 I X?1"Y".E S ^TMP($J,"E",DFN)=VAL
"RTN","PRSASR",131,0)
 E  D
"RTN","PRSASR",132,0)
 .  D AUTOPINI^PRS8(PPI,DFN) ; remove any auto posting
"RTN","PRSASR",133,0)
 .  D UNLOCK^PRSLIB00(GLOB) ; unlock record
"RTN","PRSASR",134,0)
 .  K ^TMP($J,"LOCK",DFN) ;clean out of local lock list.
"RTN","PRSASR",135,0)
O1 Q
"RTN","PRSASR",136,0)
 ;
"RTN","PRSASR",137,0)
PROC ; Set Approval, file any exceptions & update 8B string
"RTN","PRSASR",138,0)
 ;
"RTN","PRSASR",139,0)
 ; get employees entitlement string in variable A1
"RTN","PRSASR",140,0)
 D ^PRSAENT
"RTN","PRSASR",141,0)
 ;
"RTN","PRSASR",142,0)
 ; set approvals
"RTN","PRSASR",143,0)
 S $P(^PRST(458,PPI,"E",DFN,0),"^",3,5)=DUZ_"^"_APDT_"^"_A1
"RTN","PRSASR",144,0)
 ; VCS approval
"RTN","PRSASR",145,0)
 I $D(^PRST(458,PPI,"E",DFN,2)) S $P(^(2),"^",17,18)=DUZ_"^"_APDT
"RTN","PRSASR",146,0)
 ;
"RTN","PRSASR",147,0)
 ; loop thru any exceptions & file in 458.5
"RTN","PRSASR",148,0)
 I $D(^TMP($J,"X",DFN)) S K="" F  S K=$O(^TMP($J,"X",DFN,K)) Q:K=""  S DAY=$P(K," ",1),X1=$P(PDTI,"^",DAY),X2=$G(^(K)) D ^PRSATPF
"RTN","PRSASR",149,0)
 ;
"RTN","PRSASR",150,0)
 ; file overtime warnings
"RTN","PRSASR",151,0)
 F WK=1:1:2 I $G(^TMP($J,"OT",DFN,WK))'="" D
"RTN","PRSASR",152,0)
 .  S O8=$P(^TMP($J,"OT",DFN,WK),"^")
"RTN","PRSASR",153,0)
 .  S OA=$P(^TMP($J,"OT",DFN,WK),"^",2)
"RTN","PRSASR",154,0)
 .  D FILEOTW^PRSAOTTF(PPI,DFN,WK,O8,OA)
"RTN","PRSASR",155,0)
 ;
"RTN","PRSASR",156,0)
 ;set 8b string & change status of timecard to payroll
"RTN","PRSASR",157,0)
 S ^PRST(458,PPI,"E",DFN,5)=VAL S $P(^PRST(458,PPI,"E",DFN,0),"^",2)="P"
"RTN","PRSASR",158,0)
 ;
"RTN","PRSASR",159,0)
 ; If employee is a PT Phys w/ memo update hours credited
"RTN","PRSASR",160,0)
 D PTP^PRSASR1(DFN,PPI)
"RTN","PRSASR",161,0)
 ;
"RTN","PRSASR",162,0)
 ;unlock employees time card record
"RTN","PRSASR",163,0)
 S GLOB="^PRST(458,"_PPI_","_"""E"""_","_DFN_",0)"
"RTN","PRSASR",164,0)
 D UNLOCK^PRSLIB00(GLOB)
"RTN","PRSASR",165,0)
 K ^TMP($J,"LOCK",DFN) ;clean out of local lock list.
"RTN","PRSASR",166,0)
 Q
"RTN","PRSASR",167,0)
 ;
"RTN","PRSASR",168,0)
 ;%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
"RTN","PRSASR",169,0)
 ;
"RTN","PRSASR",170,0)
HDR ; Display Header
"RTN","PRSASR",171,0)
 I HDR S QT=$$ASK^PRSLIB00() Q:QT
"RTN","PRSASR",172,0)
 S X=$G(^PRSPC(DFN,0)) W !,@IOF,?3,$P(X,"^",1) S X=$P(X,"^",9) I X W ?68,$E(X),"XX-XX-",$E(X,6,9) S HDR=1
"RTN","PRSASR",173,0)
 W !,?6,"Date",?20,"Scheduled Tour",?40,"Tour Exceptions",?63,IORVON,"Tour Errors",IORVOFF
"RTN","PRSASR",174,0)
 W !?3 F I=1:1:72 W "-"
"RTN","PRSASR",175,0)
 Q
"RTN","PRSASR",176,0)
 ;====================================================================
"RTN","PRSASR",177,0)
HDR2 ; Display Header don't quit
"RTN","PRSASR",178,0)
 N HOLD
"RTN","PRSASR",179,0)
 S HOLD=$$ASK^PRSLIB00(1)
"RTN","PRSASR",180,0)
 S X=$G(^PRSPC(DFN,0)) W !,@IOF,?3,$P(X,"^",1) S X=$P(X,"^",9) I X W ?68,$E(X),"XX-XX-",$E(X,6,9)
"RTN","PRSASR",181,0)
 W !,?6,"Date",?20,"Scheduled Tour",?40,"Tour Exceptions",?63,IORVON,"Tour Errors",IORVOFF
"RTN","PRSASR",182,0)
 W !?3 F I=1:1:72 W "-"
"RTN","PRSASR",183,0)
 Q
"RTN","PRSASR",184,0)
 ;====================================================================
"RTN","PRSASR",185,0)
 ;
"RTN","PRSASR",186,0)
EX ; clean up variables & unlock any leftover time card nodes
"RTN","PRSASR",187,0)
 N EMPREC
"RTN","PRSASR",188,0)
 S EMPREC=""
"RTN","PRSASR",189,0)
 F  S EMPREC=$O(^TMP($J,"LOCK",EMPREC))  Q:EMPREC=""  D
"RTN","PRSASR",190,0)
 .  S GLOB="^PRST(458,"_PPI_","_"""E"""_","_EMPREC_",0)"
"RTN","PRSASR",191,0)
 .  D UNLOCK^PRSLIB00(GLOB)
"RTN","PRSASR",192,0)
 K ^TMP($J) G KILL^XUSCLEAN
"RTN","PRSASR",193,0)
 Q
"RTN","PRSASR",194,0)
 ;
"RTN","PRSASR",195,0)
 ;
"RTN","PRSASR",196,0)
 ;These extrinsic functions simply remove lengthy code from long, 
"RTN","PRSASR",197,0)
 ;single line, nested loop.
"RTN","PRSASR",198,0)
 ;     ---------------------------------------------------
"RTN","PRSASR",199,0)
TLSUP() ;get next supervisor who certifies other supervisors
"RTN","PRSASR",200,0)
 Q $O(^PRST(455.5,"ASX",TLE,VA2))
"RTN","PRSASR",201,0)
 ;     ---------------------------------------------------
"RTN","PRSASR",202,0)
SSN() ;get ssn of supervisor to be certified by this supervisor.
"RTN","PRSASR",203,0)
 Q $P($G(^VA(200,VA2,1)),"^",9)
"RTN","PRSASR",204,0)
 ;     ---------------------------------------------------
"RTN","PRSASR",205,0)
DFN() ;get internal entry number of supvisor of other T&L 2b approved
"RTN","PRSASR",206,0)
 ;by current supervisor.
"RTN","PRSASR",207,0)
 Q $O(^PRSPC("SSN",SSN,0))
"RTN","PRSASR",208,0)
 ;====================================================================
"RTN","PRSASR",209,0)
TOURERR(DTE,X9,XF) ;DISPLAY TOUR & ERRORS
"RTN","PRSASR",210,0)
 ;
"RTN","PRSASR",211,0)
 N IORVOFF,IORVON,RESP,ERRLEN
"RTN","PRSASR",212,0)
 S X="IORVOFF;IORVON" D ENDR^%ZISS
"RTN","PRSASR",213,0)
 D F1^PRSADP1,^PRSATPE
"RTN","PRSASR",214,0)
 F K=1:1 Q:'$D(Y1(K))&'$D(Y2(K))  D
"RTN","PRSASR",215,0)
 . I $Y>(IOSL-4) D HDR2
"RTN","PRSASR",216,0)
 . W:K>1 !
"RTN","PRSASR",217,0)
 . W:$D(Y1(K)) ?21,Y1(K)
"RTN","PRSASR",218,0)
 . W:$P($G(Y2(K)),"^")'="" ?45,$P(Y2(K),"^",1)
"RTN","PRSASR",219,0)
 . I $P($G(Y2(K)),"^",2)'="" W:$X>44 ! W ?45,$P(Y2(K),"^",2)
"RTN","PRSASR",220,0)
 W:Y3'="" !?10,Y3
"RTN","PRSASR",221,0)
 I $D(ER) S:FATAL XF=1 F K=0:0 S K=$O(ER(K)) Q:K<1  D
"RTN","PRSASR",222,0)
 .  I $Y>(IOSL-4) D HDR2
"RTN","PRSASR",223,0)
 .  S ERRLEN=$S($P(ER(K),U,2)'="":$L(ER(K)),1:$L($P($G(ER(K)),U))+1)
"RTN","PRSASR",224,0)
 .  W:X9!((ERRLEN+1)>(IOM-$X)) !
"RTN","PRSASR",225,0)
 .  W ?(IOM-(ERRLEN+1)),IORVON
"RTN","PRSASR",226,0)
 .  W:$P(ER(K),"^",2)'="" $P(ER(K),"^",2)
"RTN","PRSASR",227,0)
 .  W " ",$P(ER(K),"^",1),IORVOFF
"RTN","PRSASR",228,0)
 .  S X9=0 S:'XF ^TMP($J,"X",DFN,DAY_" "_K)=ER(K)
"RTN","PRSASR",229,0)
 .  Q
"RTN","PRSASR",230,0)
 Q
"RTN","PRSATE")
0^104^B81195394^B81258209
"RTN","PRSATE",1,0)
PRSATE ;WCIOFO/JAH/PLT - Enter/Edit Employee (emp) Tour of Duty (ToD) ;03/15/2005
"RTN","PRSATE",2,0)
 ;;4.0;PAID;**8,11,27,45,55,93,112,117**;Sep 21, 1995;Build 32
"RTN","PRSATE",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRSATE",4,0)
 ;
"RTN","PRSATE",5,0)
 ;ppi=ien of 450, ppi=ien of 458, ppe=pp (yy-mm)
"RTN","PRSATE",6,0)
 ;tli = ien of t&l, tlu=t&l # (nnn), prstlv=2 for timekeeper user
"RTN","PRSATE",7,0)
 N PPI,PPE,PRSTLV,TLI,TLE,DFN
"RTN","PRSATE",8,0)
 S PRSTLV=2 D ^PRSAUTL Q:TLI<1
"RTN","PRSATE",9,0)
 F  S DFN=$$GETEMP^PRSATE6(TLE) Q:DFN<1  D
"RTN","PRSATE",10,0)
 . S PPI=$P(^PRST(458,0),"^",3),PPE=$P($G(^PRST(458,PPI,0)),"^",1)
"RTN","PRSATE",11,0)
 . D TOUREDIT(DFN,PPI,PPE,TLI,TLE,PRSTLV)
"RTN","PRSATE",12,0)
 Q
"RTN","PRSATE",13,0)
 ;
"RTN","PRSATE",14,0)
TOUREDIT(DFN,PPI,PPE,TLI,TLE,PRSTLV) ;
"RTN","PRSATE",15,0)
 N C0,NH,FLX,PMP,PP,PB,ENT,SRT,WTL,TYP,Z,TD,ERROR,NOERROR,PRSDAY,PRSETD
"RTN","PRSATE",16,0)
 ;
"RTN","PRSATE",17,0)
 ;   Entitlement lookup leaks many variables.  Following R used in 
"RTN","PRSATE",18,0)
 ;   this routine but may be looked up again despite the fact they R 
"RTN","PRSATE",19,0)
 ;   leaked by ^PRSAENT.  See PRSAENT for further doc.
"RTN","PRSATE",20,0)
 ;
"RTN","PRSATE",21,0)
 ;    C0=emps 0 node in file 450    NH= emps 8B normal hrs
"RTN","PRSATE",22,0)
 ;    FLX= compressed/flextime code (0=none,C=compressed,F=flextime)
"RTN","PRSATE",23,0)
 ;    PMP= premium pay indicator 
"RTN","PRSATE",24,0)
 ;      ( D=entitled Sun., F=entitled Sat./Sun.,
"RTN","PRSATE",25,0)
 ;        E=entitled variable Sat./Sun. premium pay,
"RTN","PRSATE",26,0)
 ;        G=entitled variable Sun. prem pay, X=title 5 emps
"RTN","PRSATE",27,0)
 ;        R,C,O=different types of firefighters)
"RTN","PRSATE",28,0)
 ;  * PP= emps pay plan
"RTN","PRSATE",29,0)
 ;    DB = pay basis-1:full,2:part,3:intermit
"RTN","PRSATE",30,0)
 ;    ENT= 39 char entitlement string
"RTN","PRSATE",31,0)
 ;  Entitlement lookup.
"RTN","PRSATE",32,0)
 D ^PRSAENT I ENT="" D ERROR(1) S OUT=1 Q
"RTN","PRSATE",33,0)
 ;
"RTN","PRSATE",34,0)
 ; Display header/Ask pp (NOL^PRSATE2 returns SRT = Current, Next, Last)
"RTN","PRSATE",35,0)
 D NOW^%DTC S NOW=% K %
"RTN","PRSATE",36,0)
 W:$E(IOST,1,2)="C-" @IOF
"RTN","PRSATE",37,0)
 W !?26,"VA TIME & ATTENDANCE SYSTEM"
"RTN","PRSATE",38,0)
 W !?29,"EMPLOYEE TOUR OF DUTY"
"RTN","PRSATE",39,0)
 D HDR^PRSADP1,NOL^PRSATE2
"RTN","PRSATE",40,0)
 Q:SRT="^"
"RTN","PRSATE",41,0)
 I SRT="L" S PPI=PPI-1,PPE=$P($G(^PRST(458,PPI,0)),"^",1)
"RTN","PRSATE",42,0)
 ;
"RTN","PRSATE",43,0)
 ;  Get emp's flexitime code
"RTN","PRSATE",44,0)
 S FLX=$$FLEXIND^PRSATE6(PPI,DFN,SRT)
"RTN","PRSATE",45,0)
 ;  Is emp entitled reg. shed. hrs.?
"RTN","PRSATE",46,0)
 I $E(ENT,1)="0" D
"RTN","PRSATE",47,0)
 .  S Z=$E(ENT,2),TD=$S(Z="D":3,1:4) D NONE
"RTN","PRSATE",48,0)
 E  D
"RTN","PRSATE",49,0)
 .;
"RTN","PRSATE",50,0)
 .;    initialize t&l for this ToD
"RTN","PRSATE",51,0)
 .;
"RTN","PRSATE",52,0)
 .  S WTL=TLI
"RTN","PRSATE",53,0)
 .  I "NL"[SRT D
"RTN","PRSATE",54,0)
 ..    S TYP=0
"RTN","PRSATE",55,0)
 .  E  D
"RTN","PRSATE",56,0)
 ..    S TYP=$$ISTEMPTR()
"RTN","PRSATE",57,0)
 ..;
"RTN","PRSATE",58,0)
 ..;  For temp ToDs--ask user for T&L ToD will be worked
"RTN","PRSATE",59,0)
 ..;  Quit if we don't get a valid T&L unit.
"RTN","PRSATE",60,0)
 ..;
"RTN","PRSATE",61,0)
 ..    I TYP S WTL=$$ASKTLWRK^PRSATE6(TLE)
"RTN","PRSATE",62,0)
 .;
"RTN","PRSATE",63,0)
 .;  Save current ToD in case user aborts with an unacceptable ToD.
"RTN","PRSATE",64,0)
 .;
"RTN","PRSATE",65,0)
 .   D SAVETOUR^PRSATE6(PPI,DFN)
"RTN","PRSATE",66,0)
 .;
"RTN","PRSATE",67,0)
 .  I WTL'<1,TYP'["^" D 
"RTN","PRSATE",68,0)
 ..    D A1
"RTN","PRSATE",69,0)
 ..;
"RTN","PRSATE",70,0)
 ..; verify firefighter ToD after compressed ind. edit.  Don't accept 
"RTN","PRSATE",71,0)
 ..; ToD until its within guidlines. If TK force exits, restore old ToD.
"RTN","PRSATE",72,0)
 ..;
"RTN","PRSATE",73,0)
 ..  S NOERROR=0
"RTN","PRSATE",74,0)
 ..  F  D  Q:NOERROR
"RTN","PRSATE",75,0)
 ...    N ERROR D FFTOUR^PRSATE6(PPI,DFN,SRT,.ERROR)
"RTN","PRSATE",76,0)
 ...    I $$ISERRORS^PRSATE6(.ERROR) D
"RTN","PRSATE",77,0)
 ....      I $$ASKTOFIX^PRSATE6() D
"RTN","PRSATE",78,0)
 .....        D A1
"RTN","PRSATE",79,0)
 ....      E  D
"RTN","PRSATE",80,0)
 .....        D RESTORE^PRSATE6(PPI,DFN) S NOERROR=1
"RTN","PRSATE",81,0)
 ...    E  D
"RTN","PRSATE",82,0)
 ....      S NOERROR=1
"RTN","PRSATE",83,0)
 K NOW Q
"RTN","PRSATE",84,0)
 ;
"RTN","PRSATE",85,0)
ISTEMPTR() ; IS TEMPORARY ToD ?
"RTN","PRSATE",86,0)
 ; Ask user if ToD is temp or perm & convert TYP to true false flag
"RTN","PRSATE",87,0)
 ;    Permanent set TYP=0,  Temporary set TYP=true (1)
"RTN","PRSATE",88,0)
 ; 
"RTN","PRSATE",89,0)
 S TYP=$$ASKTEMP^PRSATE6() I TYP'["^" S TYP=$E(TYP,1)="T",WTL=TLI
"RTN","PRSATE",90,0)
 Q TYP
"RTN","PRSATE",91,0)
 ;
"RTN","PRSATE",92,0)
A1 ; Set up for emps ToD look up. Screen allows Daily ToDs & days off 
"RTN","PRSATE",93,0)
 ; for daily emps.  Everyone else gets days off & all other ToDs.
"RTN","PRSATE",94,0)
 ; Screen further ensures ToD is available either to all t&ls 
"RTN","PRSATE",95,0)
 ; or to t&l that this emp is working in.
"RTN","PRSATE",96,0)
 ;
"RTN","PRSATE",97,0)
 N DIC,X
"RTN","PRSATE",98,0)
 S DIC="^PRST(457.1,",DIC(0)="AEQMN"
"RTN","PRSATE",99,0)
 S DIC("S")="I "_$S($E(ENT,1)="D":"Y<3",1:"Y>5!(Y=1)")_",$P(^PRST(457.1,+Y,0),U,4)!($D(^PRST(457.1,+Y,""T"",""B"",WTL)))"
"RTN","PRSATE",100,0)
 ;
"RTN","PRSATE",101,0)
 ; Setup a fixed or varying ToD.  Compressed ToDs must be varying;
"RTN","PRSATE",102,0)
 ; ask TK about all others.
"RTN","PRSATE",103,0)
 ;
"RTN","PRSATE",104,0)
 S DB=$P(C0,U,10) I FLX="C"!("KM"[PP&(DB=1)&(NH=72)) D
"RTN","PRSATE",105,0)
 .   D VAR
"RTN","PRSATE",106,0)
 E  D
"RTN","PRSATE",107,0)
 .  S X=$$ASKFIXED()
"RTN","PRSATE",108,0)
 .  Q:X="^"
"RTN","PRSATE",109,0)
 .  I X="N" D
"RTN","PRSATE",110,0)
 ..    D VAR
"RTN","PRSATE",111,0)
 .  E  D FX
"RTN","PRSATE",112,0)
 K DB Q
"RTN","PRSATE",113,0)
 ;
"RTN","PRSATE",114,0)
FX ; Fixed ToD
"RTN","PRSATE",115,0)
FX1 S DIC("A")="Select TOUR OF DUTY: "
"RTN","PRSATE",116,0)
 W ! D ^DIC
"RTN","PRSATE",117,0)
 Q:Y'>0
"RTN","PRSATE",118,0)
 S TD=+Y
"RTN","PRSATE",119,0)
 ;check overlap
"RTN","PRSATE",120,0)
 K PRSDAY,PRSETD
"RTN","PRSATE",121,0)
 F DAY=1:1:14 S $P(PRSETD,U,DAY)=$S(DAY#7<2:1,1:TD) D
"RTN","PRSATE",122,0)
 . N TOLD
"RTN","PRSATE",123,0)
 . S PRSDAY(DAY)=$P($G(^PRST(458,PPI,"E",DFN,"D",DAY,0)),U,1,4),$P(TOLD,U,DAY)=$S(SRT="N"&($P(^(0),U,3)):$P(^(0),U,4),1:$P(^(0),U,2)) S:DAY#7>1 $P(PRSDAY(DAY),U,6)=$P($G(^(0)),U,13),$P(PRSDAY(DAY),U,7,999)=$G(^(4))
"RTN","PRSATE",124,0)
 . D PRSDAY^PRSATE0
"RTN","PRSATE",125,0)
 . QUIT
"RTN","PRSATE",126,0)
 D ENT^PRSATE5 I $G(PRSERR) K PRSERR G FX1
"RTN","PRSATE",127,0)
 S Y=$G(^PRST(457.1,TD,1)),TDH=$P(^(0),"^",6),HRS=TDH*10
"RTN","PRSATE",128,0)
 S (ZENT,STR)=""
"RTN","PRSATE",129,0)
 D OT^PRSATP,VS^PRSATE0
"RTN","PRSATE",130,0)
 I STR'="" W *7,!!,STR G FX
"RTN","PRSATE",131,0)
 I '$D(^PRST(458,PPI,"E",DFN,"D",0)) S ^(0)="^458.02^14^14"
"RTN","PRSATE",132,0)
 I SRT="N" D
"RTN","PRSATE",133,0)
 .  D F1
"RTN","PRSATE",134,0)
 E  D
"RTN","PRSATE",135,0)
 .  F DAY=2:1:6,9:1:13 D SET
"RTN","PRSATE",136,0)
 .  S TD=1,(Y,TDH)="" F DAY=1,7,8,14 D SET
"RTN","PRSATE",137,0)
 .  W "  ... done" D:HRS'=NH ERROR(2,NH,HRS)
"RTN","PRSATE",138,0)
 .  D T2
"RTN","PRSATE",139,0)
 . QUIT
"RTN","PRSATE",140,0)
 D HOL,RS K HRS,STR
"RTN","PRSATE",141,0)
 Q
"RTN","PRSATE",142,0)
 ;
"RTN","PRSATE",143,0)
 ;
"RTN","PRSATE",144,0)
F1 F DAY=2:1:6,9:1:13 D NX
"RTN","PRSATE",145,0)
 S TD=1 F DAY=1,7,8,14 D NX
"RTN","PRSATE",146,0)
 W "  ... done"
"RTN","PRSATE",147,0)
 D:HRS'=NH ERROR(2,NH,HRS)
"RTN","PRSATE",148,0)
 Q
"RTN","PRSATE",149,0)
 ;
"RTN","PRSATE",150,0)
VAR ; Variable ToD
"RTN","PRSATE",151,0)
 D ^PRSATE0
"RTN","PRSATE",152,0)
 I SRT'="N" D T2
"RTN","PRSATE",153,0)
 D HOL,RS
"RTN","PRSATE",154,0)
 Q
"RTN","PRSATE",155,0)
 ;
"RTN","PRSATE",156,0)
NONE ; No ToD
"RTN","PRSATE",157,0)
 N TYP2,UPDT,Y,TDH
"RTN","PRSATE",158,0)
 W !!,"This is an intermittent employee with no specified tour."
"RTN","PRSATE",159,0)
 W !!,"Time records will now be updated to indicate this."
"RTN","PRSATE",160,0)
 I '$D(^PRST(458,PPI,"E",DFN,"D",0)) S ^(0)="^458.02^14^14"
"RTN","PRSATE",161,0)
 I '$$PERM^PRSALIB(PPI,DFN) D
"RTN","PRSATE",162,0)
 .  W !!,"Not all tour days are assigned a permanent status."
"RTN","PRSATE",163,0)
 .  I $$UPDTQ^PRSALIB(),$$TMPST^PRSALIB(.TYP2) D UPDSTAT^PRSALIB(PPI,DFN,TYP2)
"RTN","PRSATE",164,0)
 S (Y,TDH)="",TYP=0,WTL=TLI
"RTN","PRSATE",165,0)
 I SRT="N" D
"RTN","PRSATE",166,0)
 .  F DAY=1:1:14 D NX
"RTN","PRSATE",167,0)
 E  D
"RTN","PRSATE",168,0)
 .  F DAY=1:1:14 D SET
"RTN","PRSATE",169,0)
 W "  ... done"
"RTN","PRSATE",170,0)
 D HOL,RS
"RTN","PRSATE",171,0)
 Q
"RTN","PRSATE",172,0)
 ;
"RTN","PRSATE",173,0)
 ;
"RTN","PRSATE",174,0)
RS ; Get Comp Ind
"RTN","PRSATE",175,0)
 S Y=$G(^PRST(458,PPI,"E",DFN,0))
"RTN","PRSATE",176,0)
 S FLX=$S((SRT="N")&($P(Y,U,7)]""):$P(Y,U,7),1:$P(Y,U,6))
"RTN","PRSATE",177,0)
 S DIR(0)="SAM^C:Compressed;F:Flexitime;0:None"
"RTN","PRSATE",178,0)
 S DIR("A")="Compressed Tour Indicator: "
"RTN","PRSATE",179,0)
 S DIR("B")=$S(FLX="C":"Compressed",FLX="F":"Flexitime",1:"None")
"RTN","PRSATE",180,0)
 D ^DIR K DIR I "^C^F^0^"'[(U_Y_U) S Y=FLX
"RTN","PRSATE",181,0)
 ;
"RTN","PRSATE",182,0)
 ;  Intermittent employee cannot have compressed tour.
"RTN","PRSATE",183,0)
 ;
"RTN","PRSATE",184,0)
 I $P(C0,U,10)=3,Y="C" D  G RS
"RTN","PRSATE",185,0)
 .   W *7,!?5,"Compressed tour not valid for this employee."
"RTN","PRSATE",186,0)
 ;
"RTN","PRSATE",187,0)
 I Y="F" S Z=0 D  I Z G RS
"RTN","PRSATE",188,0)
 .S PAY=$P(C0,U,21),PB=$P(C0,U,20)
"RTN","PRSATE",189,0)
 .I "0123456789GU"'[PAY S Z=1
"RTN","PRSATE",190,0)
 .I PAY="G",PB'=2 S Z=1
"RTN","PRSATE",191,0)
 .I PAY="U","27EXT"'[PB S Z=1
"RTN","PRSATE",192,0)
 .I Z W *7,!?5,"Flexitime not valid for this employee."
"RTN","PRSATE",193,0)
 .Q
"RTN","PRSATE",194,0)
 S $P(^PRST(458,PPI,"E",DFN,0),U,$S(SRT="N":7,1:6))=Y
"RTN","PRSATE",195,0)
 I $D(^PRST(458,"ATC",DFN)) D UPD^PRSASAL
"RTN","PRSATE",196,0)
 K PAY,ZENT Q
"RTN","PRSATE",197,0)
 ;
"RTN","PRSATE",198,0)
 ;
"RTN","PRSATE",199,0)
NX ; Set Next ToD
"RTN","PRSATE",200,0)
 S Z=$G(^PRST(458,PPI,"E",DFN,"D",DAY,0))
"RTN","PRSATE",201,0)
 Q:$P(Z,"^",2)=TD&('$P(Z,"^",3))
"RTN","PRSATE",202,0)
 ;
"RTN","PRSATE",203,0)
 S $P(Z,"^",3,4)="2^"_TD,$P(Z,"^",10,11)=DUZ_"^"_NOW
"RTN","PRSATE",204,0)
 S ^PRST(458,PPI,"E",DFN,"D",DAY,0)=Z,^PRST(458,"ATC",DFN,PPI,DAY)=""
"RTN","PRSATE",205,0)
 Q
"RTN","PRSATE",206,0)
 ;
"RTN","PRSATE",207,0)
 ;
"RTN","PRSATE",208,0)
SET ; Set ToD
"RTN","PRSATE",209,0)
 N ZLASTPP
"RTN","PRSATE",210,0)
 S U="^"
"RTN","PRSATE",211,0)
 ;
"RTN","PRSATE",212,0)
 ; Get Zero node of emp pp rec, Old ToD, & Prior scheduled ToD.
"RTN","PRSATE",213,0)
 ; ZLASTPP is true if a ToD present on this day last pp.
"RTN","PRSATE",214,0)
 ;
"RTN","PRSATE",215,0)
 S Z=$G(^PRST(458,PPI,"E",DFN,"D",DAY,0))
"RTN","PRSATE",216,0)
 S ZLASTPP=$P($G(^PRST(458,PPI-1,"E",DFN,"D",DAY,0)),U,2)'=""
"RTN","PRSATE",217,0)
 S OLD=$P(Z,U,2),SCH=$P(Z,U,4)
"RTN","PRSATE",218,0)
 ;
"RTN","PRSATE",219,0)
 ; Quit if old ToD=this ToD & emp rec start/stop=ToD file start/stop.
"RTN","PRSATE",220,0)
 ;
"RTN","PRSATE",221,0)
 Q:(OLD=TD)&($G(^PRST(458,PPI,"E",DFN,"D",DAY,1))=Y)
"RTN","PRSATE",222,0)
 ;
"RTN","PRSATE",223,0)
 ; Z is updated with new ToD info & replaces the emp ToD record.
"RTN","PRSATE",224,0)
 ;
"RTN","PRSATE",225,0)
 S $P(Z,U,8)=TDH
"RTN","PRSATE",226,0)
 S $P(Z,U,10,11)=DUZ_U_NOW
"RTN","PRSATE",227,0)
 I $P(Z,U,12) S $P(Z,U,12)="" ; remove holiday flag
"RTN","PRSATE",228,0)
 ;
"RTN","PRSATE",229,0)
 ; Temp ToD, store T&L ToD will be worked if it's not emp's usual t&l.
"RTN","PRSATE",230,0)
 ;
"RTN","PRSATE",231,0)
 I TYP S:TLI'=WTL $P(Z,U,9)=WTL
"RTN","PRSATE",232,0)
 ;
"RTN","PRSATE",233,0)
 ; No existing ToD on this day.
"RTN","PRSATE",234,0)
 ;
"RTN","PRSATE",235,0)
 I OLD="" D
"RTN","PRSATE",236,0)
 .  S $P(Z,U,1,3)=DAY_U_TD_U_TYP
"RTN","PRSATE",237,0)
 .  I ZLASTPP D S0
"RTN","PRSATE",238,0)
 E  D
"RTN","PRSATE",239,0)
 .;
"RTN","PRSATE",240,0)
 .;  clean out postings and other ToD info since ToD is changing
"RTN","PRSATE",241,0)
 .;
"RTN","PRSATE",242,0)
 .  D CLEANTOD(PPI,DFN,DAY,TD)
"RTN","PRSATE",243,0)
 .;
"RTN","PRSATE",244,0)
 .;
"RTN","PRSATE",245,0)
 .;
"RTN","PRSATE",246,0)
 .  S:SCH $P(Z,U,5,7)="^^"
"RTN","PRSATE",247,0)
 .  I SCH="" D
"RTN","PRSATE",248,0)
 ..    S $P(Z,U,2,4)=TD_U_TYP_U_OLD
"RTN","PRSATE",249,0)
 ..    D S0
"RTN","PRSATE",250,0)
 .  E  D
"RTN","PRSATE",251,0)
 ..    I SCH=TD D
"RTN","PRSATE",252,0)
 ...      S $P(Z,U,2,4)=TD_"^^"
"RTN","PRSATE",253,0)
 ...      K ^PRST(458,"ATC",DFN,PPI,DAY)
"RTN","PRSATE",254,0)
 ..    E  D
"RTN","PRSATE",255,0)
 ...      S $P(Z,U,2,3)=TD_U_TYP
"RTN","PRSATE",256,0)
 ...      D S0
"RTN","PRSATE",257,0)
 ;
"RTN","PRSATE",258,0)
 D S1
"RTN","PRSATE",259,0)
 K OLD,SCH Q
"RTN","PRSATE",260,0)
 ;
"RTN","PRSATE",261,0)
 ;
"RTN","PRSATE",262,0)
 ; Set up x-ref for supervisor approval of ToD change
"RTN","PRSATE",263,0)
 ;
"RTN","PRSATE",264,0)
S0 S ^PRST(458,"ATC",DFN,PPI,DAY)=""
"RTN","PRSATE",265,0)
 Q
"RTN","PRSATE",266,0)
 ;
"RTN","PRSATE",267,0)
 ;
"RTN","PRSATE",268,0)
S1 ;
"RTN","PRSATE",269,0)
 S ^PRST(458,PPI,"E",DFN,"D",DAY,0)=Z S:Y'="" ^(1)=Y
"RTN","PRSATE",270,0)
 Q
"RTN","PRSATE",271,0)
 ;
"RTN","PRSATE",272,0)
 ;
"RTN","PRSATE",273,0)
T2 ; Ask if second ToD
"RTN","PRSATE",274,0)
 N X
"RTN","PRSATE",275,0)
 ;
"RTN","PRSATE",276,0)
 ;  Don't ask for Daily ToDs
"RTN","PRSATE",277,0)
 ;
"RTN","PRSATE",278,0)
 Q:$E(ENT,1)="D"
"RTN","PRSATE",279,0)
 ;
"RTN","PRSATE",280,0)
 S X=$$ASK2NDTR()
"RTN","PRSATE",281,0)
 Q:X'="Y"  G ^PRSATE4
"RTN","PRSATE",282,0)
 ;
"RTN","PRSATE",283,0)
 ;
"RTN","PRSATE",284,0)
HOL ; Determine if Holiday within ToD
"RTN","PRSATE",285,0)
 N DAY
"RTN","PRSATE",286,0)
 D ^PRSAPPH
"RTN","PRSATE",287,0)
 Q:'$D(HOL)
"RTN","PRSATE",288,0)
 S TT="HX",DUP=1
"RTN","PRSATE",289,0)
 D E^PRSAPPH K DUP,HOL,TT
"RTN","PRSATE",290,0)
 Q
"RTN","PRSATE",291,0)
 ;
"RTN","PRSATE",292,0)
 ;
"RTN","PRSATE",293,0)
CLEANTOD(PPI,DFN,DAY,TD) ; CLEAN OUT TOUR
"RTN","PRSATE",294,0)
 N PRSDT,MIEN
"RTN","PRSATE",295,0)
 K ^PRST(458,PPI,"E",DFN,"D",DAY,1),^(2),^(3),^(10) I TD<5 K ^(4) S $P(Z,U,13,15)="^^"
"RTN","PRSATE",296,0)
 ; if employee is PTP with active memo then reset the ESR day
"RTN","PRSATE",297,0)
 S PRSDT=$P($G(^PRST(458,PPI,1)),U,DAY)
"RTN","PRSATE",298,0)
 S MIEN=$$MIEN^PRSPUT1(DFN,PRSDT)
"RTN","PRSATE",299,0)
 I MIEN D
"RTN","PRSATE",300,0)
 . N PRSFDA
"RTN","PRSATE",301,0)
 . S PRSFDA(458.02,DAY_","_DFN_","_PPI_",",146)="3" ; status = resubmit
"RTN","PRSATE",302,0)
 . S PRSFDA(458.02,DAY_","_DFN_","_PPI_",",148)="Tour Changed" ; remarks
"RTN","PRSATE",303,0)
 . D FILE^DIE("","PRSFDA"),MSG^DIALOG()
"RTN","PRSATE",304,0)
 Q
"RTN","PRSATE",305,0)
 ;
"RTN","PRSATE",306,0)
 ;
"RTN","PRSATE",307,0)
ERROR(NUM,VAR1,VAR2) ;
"RTN","PRSATE",308,0)
 W *7,!!
"RTN","PRSATE",309,0)
 I NUM=1 W "Employee has no Pay Entitlement table entry."
"RTN","PRSATE",310,0)
 I NUM=2 D
"RTN","PRSATE",311,0)
 .  Q:$G(NH)=112
"RTN","PRSATE",312,0)
 .  W "Warning: Normal Hours are ",$G(VAR1),"; Tour Hours are ",$G(VAR2)
"RTN","PRSATE",313,0)
 Q
"RTN","PRSATE",314,0)
 ;
"RTN","PRSATE",315,0)
 ;
"RTN","PRSATE",316,0)
ASKFIXED() ;GET USER'S YES OR NO RESPONSE TO FIXED ToD QUESTION
"RTN","PRSATE",317,0)
 N DIR,DIRUT,Y
"RTN","PRSATE",318,0)
 S DIR("A")="Do you wish to enter a fixed Mon-Fri Tour"
"RTN","PRSATE",319,0)
 S DIR(0)="Y"
"RTN","PRSATE",320,0)
 S DIR("?")="Answer NO to create any other type of tour."
"RTN","PRSATE",321,0)
 S DIR("?",1)="Fixed tours are Monday - Friday with the same hours."
"RTN","PRSATE",322,0)
 D ^DIR
"RTN","PRSATE",323,0)
 Q $S(Y=1:"Y",Y=0:"N",1:"^")
"RTN","PRSATE",324,0)
 ;
"RTN","PRSATE",325,0)
 ;
"RTN","PRSATE",326,0)
ASK2NDTR() ;GET USER'S YES OR NO RESPONSE TO 2nd ToD QUESTION
"RTN","PRSATE",327,0)
 N DIR,DIRUT,Y
"RTN","PRSATE",328,0)
 S DIR("A")="Do you wish to enter a Second Tour"_$S($G(SRT)="X":"",1:" for any Day")
"RTN","PRSATE",329,0)
 S DIR(0)="Y"
"RTN","PRSATE",330,0)
 S DIR("B")="N"
"RTN","PRSATE",331,0)
 S DIR("?",1)="Answer Yes to add a second tour.  No to continue."
"RTN","PRSATE",332,0)
 S DIR("?")="Enter ^ to escape and cancel this tour change."
"RTN","PRSATE",333,0)
 D ^DIR
"RTN","PRSATE",334,0)
 Q $S(Y=1:"Y",Y=0:"N",1:"^")
"RTN","PRSATE",335,0)
 ;
"RTN","PRSATE",336,0)
 ;
"RTN","PRSATE0")
0^105^B16488191^B9347970
"RTN","PRSATE0",1,0)
PRSATE0 ;WCIOFO/PLT - Data Validate for Edit Variable Tours ;7/18/08  14:37
"RTN","PRSATE0",2,0)
 ;;4.0;PAID;**112,117**;Sep 21, 1995;Build 32
"RTN","PRSATE0",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRSATE0",4,0)
 ;
"RTN","PRSATE0",5,0)
 S TOLD="" F K=1:1:14 S Z=$P($G(^PRST(458,PPI,"E",DFN,"D",K,0)),"^",2),$P(TOLD,"^",K)=Z I SRT="N",$P($G(^(0)),"^",3) S $P(TOLD,"^",K)=$P(^(0),"^",4)
"RTN","PRSATE0",6,0)
 K K S ^PRST(458,PPI,"E",DFN,"T")=TOLD D DT^PRSATE2
"RTN","PRSATE0",7,0)
 N DDSFILE,DA,DR,PRSAERR,DDSBR
"RTN","PRSATE0",8,0)
 S DDSFILE=458,DDSFILE(1)=458.01,DA(1)=PPI,DA=DFN
"RTN","PRSATE0",9,0)
 S DR="[PRSA TE EDIT]" D ^DDS K DS Q:$D(PRSAERR)
"RTN","PRSATE0",10,0)
 S TNEW=$G(^PRST(458,PPI,"E",DFN,"T")) K ^PRST(458,PPI,"E",DFN,"T")
"RTN","PRSATE0",11,0)
 I '$D(^PRST(458,PPI,"E",DFN,"D",0)) S ^(0)="^458.02^14^14"
"RTN","PRSATE0",12,0)
 F DAY=1:1:14 S TD=$P(TNEW,"^",DAY) I TD>0 D S1
"RTN","PRSATE0",13,0)
 K TNEW,TOLD
"RTN","PRSATE0",14,0)
 QUIT
"RTN","PRSATE0",15,0)
 ;
"RTN","PRSATE0",16,0)
S1 ; Set Tour if necessary
"RTN","PRSATE0",17,0)
 I TD=$P(TOLD,"^",DAY),$G(^PRST(457.1,+TD,1))=$G(^PRST(457.1,+$P(TOLD,"^",DAY),1)) Q
"RTN","PRSATE0",18,0)
 I SRT'="N" S Y=$G(^PRST(457.1,TD,1)),TDH=$P(^(0),"^",6) D SET^PRSATE Q
"RTN","PRSATE0",19,0)
 D NX^PRSATE
"RTN","PRSATE0",20,0)
 QUIT
"RTN","PRSATE0",21,0)
 ;
"RTN","PRSATE0",22,0)
VS ; Validate tour segments
"RTN","PRSATE0",23,0)
 S TRG=0 F K=1:3:19 Q:$P(Y,"^",K)=""  S Z=$P(Y,"^",K+2) S:'Z TRG=1 I Z D
"RTN","PRSATE0",24,0)
 . S Z=$P($G(^PRST(457.2,Z,0)),"^",2) I Z="RG" S TRG=1 Q
"RTN","PRSATE0",25,0)
 . I ZENT'[Z S STR="Tour Indicator contains type of time to which employee is not entitled."
"RTN","PRSATE0",26,0)
 . QUIT
"RTN","PRSATE0",27,0)
 QUIT
"RTN","PRSATE0",28,0)
 ;
"RTN","PRSATE0",29,0)
VAL ; Validate Tour
"RTN","PRSATE0",30,0)
 K PRSETD,PRSDAY
"RTN","PRSATE0",31,0)
 F DAY=1:1:14 S $P(PRSETD,U,DAY)=$$GET^DDSVAL(DIE,.DA,DAY+200)
"RTN","PRSATE0",32,0)
 G:TOLD=PRSETD VAL2
"RTN","PRSATE0",33,0)
 ;tour overlap validate
"RTN","PRSATE0",34,0)
 ;load prsday(day) before save
"RTN","PRSATE0",35,0)
 F DAY=1:1:14 S PRSDAY(DAY)=$P($G(^PRST(458,PPI,"E",DFN,"D",DAY,0)),U,1,4),$P(PRSDAY(DAY),U,6)=$P($G(^(0)),U,13),$P(PRSDAY(DAY),U,7,999)=$G(^(4)) D PRSDAY
"RTN","PRSATE0",36,0)
 ;check tour overlap
"RTN","PRSATE0",37,0)
 D ENT^PRSATE5 I $G(PRSERR) S DDSERROR=1,DDSBR=PRSERR+10_"^1^1" K PRSERR QUIT
"RTN","PRSATE0",38,0)
 ;
"RTN","PRSATE0",39,0)
VAL2 N NAWS,SNAWS,TDT S (ZENT,STR)="" K PRSAERR D OT^PRSATP S DB=$P(C0,U,10) I "KM"[PP,DB=1,NH=72 S NAWS=1
"RTN","PRSATE0",40,0)
 S (HRS,TRS,TDT)=0 F DAY=1:1:14 D  QUIT:STR'=""
"RTN","PRSATE0",41,0)
 . S TD=$P(PRSETD,U,DAY),Z=$P($G(^PRST(457.1,+TD,0)),"^",6) S:Z HRS=HRS+Z S Y=$G(^(1))
"RTN","PRSATE0",42,0)
 . I DAY=7!(DAY=14)&'TDT S TDT=$P($G(^PRST(457.1,+TD,0)),U,5)="Y"
"RTN","PRSATE0",43,0)
 . I $D(NAWS) S:Z'=12&Z NAWS=0 S $P(SNAWS,U,DAY)=TD I Z=12 S NAWS(DAY-1\7+1)=$G(NAWS(DAY-1\7+1))+1
"RTN","PRSATE0",44,0)
 . D VS S:TRG TRS=TRS+1
"RTN","PRSATE0",45,0)
 . QUIT
"RTN","PRSATE0",46,0)
 G:STR'="" V1
"RTN","PRSATE0",47,0)
 I FLX="C",TRS>9 S STR="Warning: Compressed Schedule has more than 9 Tours!" D HLP^DDSUTL(.STR)
"RTN","PRSATE0",48,0)
 I NH'=HRS,NH'=112 S STR="Warning: Normal Hours are "_NH_"; Tour Hours are "_HRS D HLP^DDSUTL(.STR)
"RTN","PRSATE0",49,0)
 I $D(NAWS) D
"RTN","PRSATE0",50,0)
 .I $G(NAWS(1))'=3!($G(NAWS(2))'=3)!'NAWS S STR=$P($T(NAWS1),";",3) D HLP^DDSUTL(.STR)
"RTN","PRSATE0",51,0)
 .D TOURHRS^PRSARC07(.HRS,PPI,DFN,SNAWS)
"RTN","PRSATE0",52,0)
 .I $G(HRS("W1"))'=36!($G(HRS("W2"))'=36) S STR=$P($T(NAWS2),";",3) D HLP^DDSUTL(.STR)
"RTN","PRSATE0",53,0)
 .I $G(TDT) S STR=$P($T(NAWS3),";",3) D HLP^DDSUTL(.STR)
"RTN","PRSATE0",54,0)
 K K,STR,TRG,TRS QUIT
"RTN","PRSATE0",55,0)
 ;
"RTN","PRSATE0",56,0)
PRSDAY ;update prsday with new data (like codes in label set of prsate)
"RTN","PRSATE0",57,0)
 I $P(PRSDAY(DAY),U,2)="" S $P(PRSDAY(DAY),U,1,3)=DAY_U_$P(PRSETD,U,DAY)_U_TYP QUIT:SRT'="N"
"RTN","PRSATE0",58,0)
 I SRT="N" S $P(PRSDAY(DAY),"^",3,4)="2^"_$P(PRSETD,U,DAY) QUIT
"RTN","PRSATE0",59,0)
 I $P(TOLD,U,DAY)=$P(PRSETD,U,DAY),$P($$TOUR^PRSATE5($P(PRSETD,U,DAY)),"~",2)=$G(^PRST(458,PPI,"E",DFN,"D",DAY,1)) QUIT
"RTN","PRSATE0",60,0)
 I $P(PRSDAY(DAY),U,4)="" S $P(PRSDAY(DAY),U,2,4)=$P(PRSETD,U,DAY)_U_TYP_U_$P(PRSDAY(DAY),U,2)
"RTN","PRSATE0",61,0)
 E  I $P(PRSDAY(DAY),U,4)=$P(PRSETD,U,DAY) S $P(PRSDAY(DAY),U,2,4)=$P(PRSETD,U,DAY)_"^^"
"RTN","PRSATE0",62,0)
 E  S $P(PRSDAY(DAY),U,2,3)=$P(PRSETD,U,DAY)_U_TYP
"RTN","PRSATE0",63,0)
 QUIT
"RTN","PRSATE0",64,0)
 ;
"RTN","PRSATE0",65,0)
 ;allow to file, ddserror is kill after set = 1, all other checks are aborted
"RTN","PRSATE0",66,0)
V1 S (DDSERROR,PRSAERR)=1 D HLP^DDSUTL(.STR) K DDSERROR Q
"RTN","PRSATE0",67,0)
NAWS1 ;;Warning: There are not three 12 hour tours in week 1 and/or week 2 for this AWS 36/40 Nurse
"RTN","PRSATE0",68,0)
NAWS2 ;;Warning: Hours in week 1 and/or week 2 are not 36 for this AWS 36/40 Nurse.
"RTN","PRSATE0",69,0)
NAWS3 ;;Warning: Tour overlaps two administrative work weeks for this 36/40 Nurse.
"RTN","PRSATE4")
0^109^B6816347^B5046941
"RTN","PRSATE4",1,0)
PRSATE4 ;WCIOFO/PLT - Second Tour Entry ;7/23/08  10:12
"RTN","PRSATE4",2,0)
 ;;4.0;PAID;**117**;Sep 21, 1995;Build 32
"RTN","PRSATE4",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRSATE4",4,0)
 ;
"RTN","PRSATE4",5,0)
 W:'TYP !!,"Warning: This second tour will be temporary and will not carry forward."
"RTN","PRSATE4",6,0)
 R !!,"For which Day (1-14) do you wish to enter a second Tour? ",DAY:DTIME Q:'$T!(DAY["^")
"RTN","PRSATE4",7,0)
 I DAY'?1.2N!(DAY<1)!(DAY>14) W *7,!!,"Enter a Day Number from 1 to 14." G PRSATE4
"RTN","PRSATE4",8,0)
 S TD=$P($G(^PRST(458,PPI,"E",DFN,"D",DAY,0)),"^",13) G:'TD P0
"RTN","PRSATE4",9,0)
 W !!,"Existing Second Tour ",$P($G(^PRST(457.1,TD,0)),"^",1)," is being deleted."
"RTN","PRSATE4",10,0)
 D DELSTD(PPI,DFN,DAY)
"RTN","PRSATE4",11,0)
P0 I $P($G(^PRST(458,PPI,"E",DFN,"D",DAY,0)),"^",2)<6 W *7,!!,"A second Tour is not valid on this day." G PRSATE4
"RTN","PRSATE4",12,0)
P K DIC S DIC="^PRST(455.5,",DIC(0)="AEQM",DIC("A")="T&L on which Tour will be worked: ",DIC("B")=TLE W ! D ^DIC Q:Y<1  K DIC S WTL=+Y
"RTN","PRSATE4",13,0)
P1 S DIC="^PRST(457.1,",DIC(0)="AEQMN"
"RTN","PRSATE4",14,0)
 S DIC("S")="I Y>5,$P(^PRST(457.1,+Y,0),U,4)!($D(^PRST(457.1,+Y,""T"",""B"",WTL)))"
"RTN","PRSATE4",15,0)
 S DIC("A")="Select TOUR OF DUTY: " W ! D ^DIC K DIC Q:Y'>0
"RTN","PRSATE4",16,0)
 S TD=+Y
"RTN","PRSATE4",17,0)
 ;tour overlap check
"RTN","PRSATE4",18,0)
 K PRSDAY S PRSDAY(DAY)=$P(^PRST(458,PPI,"E",DFN,"D",DAY,0),U,1,4),$P(PRSDAY(DAY),U,6)=TD,$P(PRSDAY(DAY),U,7,999)=$P($$TOUR^PRSATE5(TD),"~",2,999)
"RTN","PRSATE4",19,0)
 D PPTDOL^PRSATE5(SRT,PPI,DFN,DAY,.PRSDAY,3) I $G(PRSERR) K PRSERR G P1
"RTN","PRSATE4",20,0)
 K PRSDAY S Y=$G(^PRST(457.1,TD,1)),TDH=$P(^(0),"^",6)
"RTN","PRSATE4",21,0)
 S (ZENT,STR)="" D OT^PRSATP,VS^PRSATE0 I STR'="" W *7,!!,STR G P1
"RTN","PRSATE4",22,0)
 D DELSTD(PPI,DFN,DAY)
"RTN","PRSATE4",23,0)
 S $P(^PRST(458,PPI,"E",DFN,"D",DAY,0),"^",13,15)=TD_"^"_TDH_"^"_$S(WTL=TLI:"",1:WTL),^(4)=Y
"RTN","PRSATE4",24,0)
 S ^PRST(458,"ATC",DFN,PPI,DAY)=""
"RTN","PRSATE4",25,0)
 S HRS=0 F Y=1:1:14 S Z=$P($G(^PRST(458,PPI,"E",DFN,"D",Y,0)),"^",8) S:Z HRS=HRS+Z S Z=$P($G(^(0)),"^",14) S:Z HRS=HRS+Z
"RTN","PRSATE4",26,0)
 W "  ... done" D:HRS'=NH W1 Q
"RTN","PRSATE4",27,0)
W1 Q:NH=112  W *7,!!,"Warning: Normal Hours are "_NH_"; Tour Hours are "_HRS Q
"RTN","PRSATE4",28,0)
 ;
"RTN","PRSATE4",29,0)
 ;PPI=ien of 458, dnf=ien of 450, day = 1,2...14
"RTN","PRSATE4",30,0)
DELSTD(PPI,DFN,DAY) ;delete secondary tour
"RTN","PRSATE4",31,0)
 S $P(^PRST(458,PPI,"E",DFN,"D",DAY,0),"^",13,15)="^^" K ^(2),^(3),^(4),^(10)
"RTN","PRSATE4",32,0)
 QUIT
"RTN","PRSATE5")
0^110^B25791034^B2581921
"RTN","PRSATE5",1,0)
PRSATE5 ;WCIOFO/PLT-Check for Tour Overlap ;7/8/08  14:34
"RTN","PRSATE5",2,0)
 ;;4.0;PAID;**117**;Sep 21, 1995;Build 32
"RTN","PRSATE5",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRSATE5",4,0)
 ;
"RTN","PRSATE5",5,0)
ENT ;tour overlap check for all 14 days in file of a pp and an employee
"RTN","PRSATE5",6,0)
 N DAY
"RTN","PRSATE5",7,0)
 K PRSERR F DAY=1:1:14 D PPTDOL(SRT,PPI,DFN,DAY,.PRSDAY,1) QUIT:$G(PRSERR)
"RTN","PRSATE5",8,0)
 QUIT
"RTN","PRSATE5",9,0)
 ;
"RTN","PRSATE5",10,0)
 ;srt=l for last pp, c for current, n for next, x for transmitted pp
"RTN","PRSATE5",11,0)
 ;ppi=ien for file # 458
"RTN","PRSATE5",12,0)
 ;dfn=ien of file #450
"RTN","PRSATE5",13,0)
 ;day=day number 1, 2,...14
"RTN","PRSATE5",14,0)
 ;.prsday(day) pass by '.' - local pp tour data retrived if defined
"RTN","PRSATE5",15,0)
 ;^1=day #, ^2= tour ien of 457.1, ^3=temporary tour? 0,1,2 (next pp),
"RTN","PRSATE5",16,0)
 ;^4= prior tour ien of 457.1
"RTN","PRSATE5",17,0)
 ;^5=1 if secondary tour overlapped, ^6=secondary ien of 471.1
"RTN","PRSATE5",18,0)
 ;^7,999=secondary tour hour segment
"RTN","PRSATE5",19,0)
 ;prsc=1 check day-1 only (used all days check in pp)
"RTN","PRSATE5",20,0)
 ;    >1 check day-1 and day+1 (used one day check)
"RTN","PRSATE5",21,0)
PPTDOL(SRT,PPI,DFN,DAY,PRSDAY,PRSC) ;tour check for one day in a pp, define prserr=day if overlapped
"RTN","PRSATE5",22,0)
 N A,B,C,I,PRS0,PRS1,PRS4,PRS71
"RTN","PRSATE5",23,0)
 I '$G(PRSDAY(DAY)) S PRS0=$G(^PRST(458,PPI,"E",DFN,"D",DAY,0)),PRS1=$G(^(1)),PRS4=$G(^(4))
"RTN","PRSATE5",24,0)
 E  S PRS0=PRSDAY(DAY),PRS1=$P($$TOUR($P(PRS0,U,2)),"~",2,999),PRS4=$P($$TOUR($P(PRS0,U,6)),"~",2,999)
"RTN","PRSATE5",25,0)
 D:SRT="N" NPP D:"LCX"[SRT LCPP:PRS1]""
"RTN","PRSATE5",26,0)
 QUIT
"RTN","PRSATE5",27,0)
 ;
"RTN","PRSATE5",28,0)
NPP ;next pp (no secondary tour)
"RTN","PRSATE5",29,0)
 S PRS71=$S($P(PRS0,U,3):$P(PRS0,U,4),1:$P(PRS0,U,2)),A=$$TOUR(PRS71),B=$$DAYT(PPI,DFN,SRT,DAY-1,.PRSDAY)
"RTN","PRSATE5",30,0)
 ;if day-1 is a two-day tour
"RTN","PRSATE5",31,0)
 I $P(B,"~")="Y",$$TOUROL($P(A,"~",2),$P(B,"~",2),4) D ERR(DAY,DAY-1,1) G:$G(PRSERR)=DAY NEXIT
"RTN","PRSATE5",32,0)
 I DAY=1,$P(B,"~",3)="Y",$$TOUROL($P(A,"~",2),$P(B,"~",4),4) D ERR(DAY,DAY-1,3) G:$G(PRSERR)=DAY NEXIT
"RTN","PRSATE5",33,0)
 ;if day is a two-day tour
"RTN","PRSATE5",34,0)
 I $P(A,"~")="Y",DAY=14!(PRSC>1) S C=$$DAYT(PPI,DFN,SRT,DAY+1,.PRSDAY) I $$TOUROL($P(A,"~",2),$P(C,"~",2),3) D ERR(DAY,DAY+1,1) G:$G(PRSERR)=DAY NEXIT
"RTN","PRSATE5",35,0)
NEXIT QUIT
"RTN","PRSATE5",36,0)
 ;
"RTN","PRSATE5",37,0)
LCPP ;last, current or transmitted pp
"RTN","PRSATE5",38,0)
 ;check tour and secondary tours for the day
"RTN","PRSATE5",39,0)
 I PRS4]"",$$TOUROL(PRS1,PRS4,"") D ERR(DAY,DAY,"") G:$G(PRSERR)=DAY LCEXIT
"RTN","PRSATE5",40,0)
 ;day-1 tour or secondary is two-day tour
"RTN","PRSATE5",41,0)
 S B=$$DAYT(PPI,DFN,SRT,DAY-1,.PRSDAY)
"RTN","PRSATE5",42,0)
 F I=1,3 I $P(B,"~",I)="Y",$$TOUROL(PRS1,$P(B,"~",I+1),4) D ERR(DAY,DAY-1,I) G:$G(PRSERR)=DAY LCEXIT
"RTN","PRSATE5",43,0)
 I PRS4]"" F I=1,3 I $P(B,"~",I)="Y",$$TOUROL(PRS4,$P(B,"~",I+1),4) D ERR(DAY,DAY-1,I+1) G:$G(PRSERR)=DAY LCEXIT
"RTN","PRSATE5",44,0)
 QUIT:DAY'=14&(PRSC=1)
"RTN","PRSATE5",45,0)
 ;day tour or secondary is two day tour
"RTN","PRSATE5",46,0)
 S PRS71=$P(PRS0,U,2),A=$$TOUR(PRS71),PRS71=$P(PRS0,U,$S($G(PRSDAY(DAY)):6,1:13)),B=$$TOUR(PRS71)
"RTN","PRSATE5",47,0)
 QUIT:$P(A,"~")'="Y"&($P(B,"~")'="Y")
"RTN","PRSATE5",48,0)
 ;check day+1 including day 14
"RTN","PRSATE5",49,0)
 S C=$$DAYT(PPI,DFN,SRT,DAY+1,.PRSDAY) QUIT:$P(C,"~",2)=""
"RTN","PRSATE5",50,0)
 I $P(A,"~")="Y" F I=2,4 I $P(C,"~",I)]"",$$TOUROL(PRS1,$P(C,"~",I),3) D ERR(DAY,DAY+1,I-1) G:$G(PRSERR)=DAY LCEXIT
"RTN","PRSATE5",51,0)
 I $P(B,"~")="Y" F I=2,4 I $P(C,"~",I)]"",$$TOUROL(PRS4,$P(C,"~",I),3) D ERR(DAY,DAY+1,I) G:$G(PRSERR)=DAY LCEXIT
"RTN","PRSATE5",52,0)
LCEXIT QUIT
"RTN","PRSATE5",53,0)
 ;
"RTN","PRSATE5",54,0)
 ;a= ien of file #457.1
"RTN","PRSATE5",55,0)
TOUR(A) ;ef: ~1=y if two day tour, ~2,999 =tour string
"RTN","PRSATE5",56,0)
 QUIT:A<1 "~"
"RTN","PRSATE5",57,0)
 QUIT $P($G(^PRST(457.1,A,0)),U,5)_"~"_$G(^(1))
"RTN","PRSATE5",58,0)
 ;
"RTN","PRSATE5",59,0)
 ;ppi= ien of 458, dfn= ien of 458
"RTN","PRSATE5",60,0)
 ;a=l(ast), c(urrent), n(ext), x(transmit) pp
"RTN","PRSATE5",61,0)
 ;b=day # (0,1,2,...13,14,15) of the pp
"RTN","PRSATE5",62,0)
 ;.prsday = pass by '.'
"RTN","PRSATE5",63,0)
DAYT(PPI,DFN,A,B,PRSDAY) ;ef: ~1=y if two-day tour, ~2 - tour string, ~3=y if two-day tour of secondary, ~4=secondary tour
"RTN","PRSATE5",64,0)
 N C,D,E,F,G
"RTN","PRSATE5",65,0)
 S C=$S(B=0&(A'="N"):PPI-1,B=15&("LX"[A):PPI+1,1:PPI),D=$S(B=0:14,B=15:1,1:B)
"RTN","PRSATE5",66,0)
 I PPI=C,$G(PRSDAY(D)) S E=$G(PRSDAY(D)) QUIT:A="N"&B!(A="C"&(B=15)) $$TOUR($S($P(E,U,3):$P(E,U,4),1:$P(E,U,2)))  QUIT $$TOUR($P(E,U,2))_"~"_$P($$TOUR($P(E,U,6)),"~")_"~"_$P(E,U,7,999)
"RTN","PRSATE5",67,0)
 S E=$G(^PRST(458,C,"E",DFN,"D",D,0)),F=$G(^(1))_"~"_$G(^(4)),G=$P(E,U,13)
"RTN","PRSATE5",68,0)
 QUIT:A="N"&B!(A="C"&(B=15)) $$TOUR($S($P(E,U,3):$P(E,U,4),1:$P(E,U,2)))
"RTN","PRSATE5",69,0)
 QUIT $P($$TOUR($P(E,U,2)),"~")_"~"_$P(F,"~")_$S(G:"~"_$P($$TOUR(G),"~")_"~"_$P(F,"~",2),1:"")
"RTN","PRSATE5",70,0)
 ;
"RTN","PRSATE5",71,0)
 ;
"RTN","PRSATE5",72,0)
 ;tour of duty overlap check
"RTN","PRSATE5",73,0)
 ;a=string of tour of duty, b=string of dour of duty
"RTN","PRSATE5",74,0)
 ;string of tour of duty = start time^end time^special code^start time^...
"RTN","PRSATE5",75,0)
 ;c - parameter is for checking tour string b against string a with options
"RTN","PRSATE5",76,0)
 ;c = "" check tour string b against a
"RTN","PRSATE5",77,0)
 ;c = 1 checked for first day tour of b only, 2 for second day only
"RTN","PRSATE5",78,0)
 ;c = 3 checked for first day tour of b as second day, 4 for second day as first day
"RTN","PRSATE5",79,0)
 ;c = 2 and 4 are only for b tour string with two-day tour
"RTN","PRSATE5",80,0)
TOUROL(A,B,C) ;ef: =0 if not overlapped, =1 if overlapped
"RTN","PRSATE5",81,0)
 N D,E,F,G,I,X,Y,Z
"RTN","PRSATE5",82,0)
 ;connect hour segments in a and set start/end militay time in array d
"RTN","PRSATE5",83,0)
 S Z=0,E=0 F I=1:1 S X=$P(A,U,I) QUIT:$P(A,U,I,999)=""  I I#3'=0 S Y=I>1 D MIL^PRSATIM S:Y<Z E=2400 S Z=Y,Y=E+Y S D(Y)=$G(D(Y))_(I#3) K:$G(D(Y))=21 D(Y)
"RTN","PRSATE5",84,0)
 ;set hour segments in b to f with military time
"RTN","PRSATE5",85,0)
 S (Z,E,G)=0,F="" F I=1:1 S X=$P(B,U,I) QUIT:$P(B,U,I,999)=""  I I#3'=0 S Y=I>1 D MIL^PRSATIM S:Y<Z E=2400 S Z=Y,Y=E+Y,G=G+1,$P(F,U,G)=Y
"RTN","PRSATE5",86,0)
 ;connect hour segments, that is remove same end/start time
"RTN","PRSATE5",87,0)
 F I=2:2 QUIT:$P(F,U,I)=""  S:$P(F,U,I)=$P(F,U,I+1) $P(F,U,I,I+2)=$P(F,U,I+2),I=I-2
"RTN","PRSATE5",88,0)
 ;select first day hour segments from f and put in d if c#2=1, second day hour segmentd from f to d if c#2=0
"RTN","PRSATE5",89,0)
 S D=F I C S:C#2=0 D="" F I=1:2 QUIT:$P(F,U,I)=""  I C#2=1&($P(F,U,I)>2359)!(C#2=0&($P(F,U,I+1)>2400)) S:C#2=1 D=$P(F,U,1,I-1) S:C#2=0 D=$P(F,U,I,999) QUIT
"RTN","PRSATE5",90,0)
 ;add 2400 to hour segment of first day tour if c=3 and -2400 to hour segment of second day tour if c=4
"RTN","PRSATE5",91,0)
 I C>2 F I=1:1 QUIT:$P(D,U,I)=""  S $P(D,U,I)=$S(C=4:-2400,1:2400)+$P(D,U,I) S:D<0&(I=1)&(C=4) $P(D,U,1)=0 I $P(D,U,I)>4800 S $P(D,U,I)=4800 QUIT
"RTN","PRSATE5",92,0)
 ;check overlap
"RTN","PRSATE5",93,0)
 S C=0 F I=1:2 S E=$P(D,U,I) QUIT:E=""!C  S G=$O(D(E)),C=$S(G'=$O(D($P(D,U,I+1)-1)):1,'G:0,D(G)'=1:1,1:0)
"RTN","PRSATE5",94,0)
 QUIT C
"RTN","PRSATE5",95,0)
 ;
"RTN","PRSATE5",96,0)
 ;a = day number, b=day number
"RTN","PRSATE5",97,0)
 ;c="" if a=b a's primary, a's secondary
"RTN","PRSATE5",98,0)
 ;c=1 a's primary, b's primary tour, =3 a's primary, b's secondary
"RTN","PRSATE5",99,0)
 ;c=2 a's secondary, b's primary, =4 a's secondary, b's secondary
"RTN","PRSATE5",100,0)
ERR(A,B,C) ;define prserr=a
"RTN","PRSATE5",101,0)
 N D,E,F,PPID
"RTN","PRSATE5",102,0)
 S F=PPE S:SRT="N" F=$P($$DTPP^PRSU1B2($P($$PPDT^PRSU1B2(PPE,1),U,4)+14,"H"),U,2)
"RTN","PRSATE5",103,0)
 S PPID=$S(SRT="X":"Xmitted",SRT="C":"Current",SRT="N":"Next",1:"Last")
"RTN","PRSATE5",104,0)
 I A'=B S D(1)="ERROR: "_PPID_"-PP "_F_", Day "_A_" "_$S(C#2=1:"Primary",1:"Secondary")_" overlaps Day "_$S(B=0:14,B=15:1,1:B)_" "_$S(C<3:"Primary",1:"Secondary")_$S(A=1&(B=0):" of prior PP",A=14&(B=15):" of next PP",1:"")
"RTN","PRSATE5",105,0)
 E  S D(1)="ERROR: "_PPID_"-PP "_F_", Day "_A_" Secondary Tour overlaps Primary Tour"
"RTN","PRSATE5",106,0)
 S PRSERR=A I '$D(DDSFILE) D EN^DDIOL(.D) QUIT
"RTN","PRSATE5",107,0)
 D HLP^DDSUTL(.D)
"RTN","PRSATE5",108,0)
 QUIT
"RTN","PRSATPE")
0^112^B68629448^B68842972
"RTN","PRSATPE",1,0)
PRSATPE ;WOIFO/PLT - Find Exceptions ;12/3/07
"RTN","PRSATPE",2,0)
 ;;4.0;PAID;**26,34,69,102,112,116,117**;Sep 21, 1995;Build 32
"RTN","PRSATPE",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRSATPE",4,0)
 K ER S (ECNT,FATAL)=0,X0=$G(^PRST(458,PPI,"E",DFN,"D",DAY,0)),STAT=$P($G(^(10)),"^",1)
"RTN","PRSATPE",5,0)
 N MLTIME S MLTIME=0
"RTN","PRSATPE",6,0)
 S TC=$P(X0,"^",2) I 'TC S ER(1)=$P($T(ERTX+1),";;",2),FATAL=1 G EX
"RTN","PRSATPE",7,0)
 ;
"RTN","PRSATPE",8,0)
 ;ensure Normal Hrs = tour hrs for hourly employees
"RTN","PRSATPE",9,0)
 I DAY=14 I '$$HRSMATCH(PPI,DFN) S FATAL=1,ERR=20 D ERR3640 G EX
"RTN","PRSATPE",10,0)
 ;
"RTN","PRSATPE",11,0)
 I "1 3 4"'[TC,STAT="" S ER(1)=$P($T(ERTX+2),";;",2),FATAL=1 G EX
"RTN","PRSATPE",12,0)
 ;
"RTN","PRSATPE",13,0)
 ;  Validate NAWS 36/40 nurse tours--can't certify if errors
"RTN","PRSATPE",14,0)
 I DAY=7!(DAY=14),$$NAWS3640(DFN,PPI) D
"RTN","PRSATPE",15,0)
 .  I $$SAT2DAY(DAY/7,DFN,PPI) S FATAL=1,ERR=16 D ERR3640
"RTN","PRSATPE",16,0)
 .  I $$THREE12(DAY/7,DFN,PPI) S FATAL=1,ERR=$S(DAY=7:18,1:19) D ERR3640
"RTN","PRSATPE",17,0)
 I DAY=1,$$NAWS3640(DFN,PPI) D
"RTN","PRSATPE",18,0)
 .  I $$CARRYOVR(DFN,PPI) S FATAL=1,ERR=17 D ERR3640
"RTN","PRSATPE",19,0)
 I FATAL G EX
"RTN","PRSATPE",20,0)
 ;
"RTN","PRSATPE",21,0)
 S X2=$G(^PRST(458,PPI,"E",DFN,"D",DAY,2)) G:X2="" EX S X1=$G(^(1)),X4=$G(^(4)),K=$P($G(^(10)),U,4)
"RTN","PRSATPE",22,0)
 ;check recess entire day having un-unavailable posted for all scheduled on-on call
"RTN","PRSATPE",23,0)
 I $E($G(PRSENT),5),K=2,X2["^RS" D
"RTN","PRSATPE",24,0)
 . F K=1:3 QUIT:$P(X1,U,K,999)=""  S Z=$P(X1,U,K+2) I Z,$P($G(^PRST(457.2,Z,0)),"^",2)="ON",X2'[($P(X1,U,K,K+1)_"^UN") S PRSWOC=$G(PRSWOC)_DAY_"," QUIT
"RTN","PRSATPE",25,0)
 . I $G(PRSWOC)'[(DAY_",") F K=1:3 QUIT:$P(X4,U,K,999)=""  S Z=$P(X4,U,K+2) I Z,$P($G(^PRST(457.2,Z,0)),"^",2)="ON",X2'[($P(X4,U,K,K+1)_"^UN") S PRSWOC=$G(PRSWOC)_DAY_"," QUIT
"RTN","PRSATPE",26,0)
 . QUIT
"RTN","PRSATPE",27,0)
 ;
"RTN","PRSATPE",28,0)
 K TM I X2["OT"!(X2["CT") D TM
"RTN","PRSATPE",29,0)
 K T,TRS F K=1:3 Q:$P(X1,"^",K)=""  S Z=$P(X1,"^",K+2) I $S('Z:1,1:$P($G(^PRST(457.2,Z,0)),"^",2)="RG") D
"RTN","PRSATPE",30,0)
 .S X=$P(X1,"^",K,K+1) D CNV^PRSATIM S Z1=$P(Y,"^",1),Z2=$P(Y,"^",2) D V0
"RTN","PRSATPE",31,0)
 .I Z1'="",$G(T(Z1))="*" K T(Z1) S T(Z2)="*" Q
"RTN","PRSATPE",32,0)
 .S T(Z1)="",T(Z2)="*" Q
"RTN","PRSATPE",33,0)
 I X4'="" F K=1:3 Q:$P(X4,"^",K)=""  S Z=$P(X4,"^",K+2) I $S('Z:1,1:$P($G(^PRST(457.2,Z,0)),"^",2)="RG") D
"RTN","PRSATPE",34,0)
 .S X=$P(X4,"^",K,K+1) D CNV^PRSATIM S Z1=$P(Y,"^",1),Z2=$P(Y,"^",2) D V0
"RTN","PRSATPE",35,0)
 .I Z1'="",$G(T(Z1))="*" K T(Z1) S T(Z2)="*" Q
"RTN","PRSATPE",36,0)
 .S T(Z1)="",T(Z2)="*" Q
"RTN","PRSATPE",37,0)
 ;
"RTN","PRSATPE",38,0)
 ;find rs-type of time segments of trs array in x2 posted string
"RTN","PRSATPE",39,0)
 I X2["^RS" F K=1:4:25 QUIT:$P(X2,U,K,999)=""  S X=$P(X2,"^",K,K+1) I "^"'[X,$P(X2,"^",K+2)="RS" D
"RTN","PRSATPE",40,0)
 . S TT=$P(X2,"^",K+2) D CNV^PRSATIM S Z1=$P(Y,"^",1),Z2=$P(Y,"^",2) D V1
"RTN","PRSATPE",41,0)
 . I Z1'="",$G(TRS(Z1))="*" K TRS(Z1) S TRS(Z2)="*" QUIT
"RTN","PRSATPE",42,0)
 . S TRS(Z1)="",TRS(Z2)="*"
"RTN","PRSATPE",43,0)
 . QUIT
"RTN","PRSATPE",44,0)
 ; Checks for Daily employees
"RTN","PRSATPE",45,0)
 I "^"[$P(X2,"^",1,2) S TT=$P(X2,"^",3),K=1,DN=0,Y0="" G L0
"RTN","PRSATPE",46,0)
 F K=1:4:25 S X=$P(X2,"^",K,K+1) I "^"'[X D
"RTN","PRSATPE",47,0)
 . N Z3,Z4
"RTN","PRSATPE",48,0)
 . S TT=$P(X2,"^",K+2)
"RTN","PRSATPE",49,0)
 . D CNV^PRSATIM S Y0=Y,Z1=$P(Y,"^",1),Z2=$P(Y,"^",2) D V1 S TIM=Z2-Z1/60
"RTN","PRSATPE",50,0)
 . S Z3=Z1,Z4=Z2
"RTN","PRSATPE",51,0)
 . I TT="ML" S MLTIME=MLTIME+TIM
"RTN","PRSATPE",52,0)
 . S Z1=$O(T(Z1)) S:Z1'="" Z1=T(Z1)
"RTN","PRSATPE",53,0)
 . S Z2=$O(T(Z2-1)) S:Z2'="" Z2=T(Z2)
"RTN","PRSATPE",54,0)
 . ;trs=1 if absolute outside rs, 2 if absolute inside rs, 3 if overlap (in/outside) rs and inside tour of duty
"RTN","PRSATPE",55,0)
 . ;if exception segment start/ending time outside tour of duty, reset z3 and z4
"RTN","PRSATPE",56,0)
 . I Z1]""!(Z2]""),X2["^RS" S:Z1=""&(Z2="*") Z3=$O(T(Z3)) S:Z1="*"&(Z2="") Z4=$O(T(Z3)) S Z3=$O(TRS(Z3)) S:Z3]"" Z3=TRS(Z3) S Z4=$O(TRS(Z4-1)) S:Z4]"" Z4=TRS(Z4) S TRS=$S(Z3=""&(Z4=""):1,Z3="*"&(Z4="*"):2,1:3)
"RTN","PRSATPE",57,0)
 . I TT="UN" D UN^PRSATPH QUIT
"RTN","PRSATPE",58,0)
 . I "CT OT ON SB RG"[TT D OT QUIT
"RTN","PRSATPE",59,0)
 . D LV QUIT
"RTN","PRSATPE",60,0)
 ;
"RTN","PRSATPE",61,0)
 ; Check for a minimum of 1 hour ML
"RTN","PRSATPE",62,0)
 ;
"RTN","PRSATPE",63,0)
 I TT="ML",MLTIME<1 S ER(1)=$P($T(ERTX+14),";;",2),FATAL=1 G EX
"RTN","PRSATPE",64,0)
 ;
"RTN","PRSATPE",65,0)
EX Q
"RTN","PRSATPE",66,0)
V0 I Z2>Z1 S:$O(T(""))'<Z2 Z1=Z1+1440,Z2=Z2+1440 Q
"RTN","PRSATPE",67,0)
 S Z2=Z2+1440 Q
"RTN","PRSATPE",68,0)
V1 S DN=0 I Z2>Z1 Q:"CT OT ON SB UN RG"[TT  S:$O(T(""))'<Z2 Z1=Z1+1440,Z2=Z2+1440,DN=2 Q
"RTN","PRSATPE",69,0)
 S Z2=Z2+1440,DN=1 Q
"RTN","PRSATPE",70,0)
OT ; Check OT/CT Request
"RTN","PRSATPE",71,0)
 I Z1'=""!(Z2'="") D O2 I $G(ERR)=6 S FATAL=1 D ERR
"RTN","PRSATPE",72,0)
 I DN=1,$O(T(1440))="" D NX^PRSATPH
"RTN","PRSATPE",73,0)
 I 'DN,$O(T(""))=""!($P(Y0,"^",1)'>$O(T(""))) D PR^PRSATPH
"RTN","PRSATPE",74,0)
 I "ON SB RG"[TT Q
"RTN","PRSATPE",75,0)
 ; check status of request(s)
"RTN","PRSATPE",76,0)
 S DTI=$P($G(^PRST(458,PPI,1)),U,DAY) Q:'DTI
"RTN","PRSATPE",77,0)
 S STAT="" ; init highest status var
"RTN","PRSATPE",78,0)
 S DA=0 F  S DA=$O(^PRST(458.2,"AD",DFN,DTI,DA)) Q:'DA  D  Q:STAT="A"
"RTN","PRSATPE",79,0)
 . S Z=$G(^PRST(458.2,DA,0))
"RTN","PRSATPE",80,0)
 . Q:$P(Z,"^",5)'=TT  ; ignore different type
"RTN","PRSATPE",81,0)
 . I $F("RSA",$P(Z,U,8))>$F("RSA",STAT) S STAT=$P(Z,U,8) ; higher status
"RTN","PRSATPE",82,0)
 I STAT="" S ERR=3 D ERR Q  ; none with requested or higher status
"RTN","PRSATPE",83,0)
 I STAT'="A" D  Q  ; none approved
"RTN","PRSATPE",84,0)
 . S ERR=$S(STAT="R":8,1:9) D ERR
"RTN","PRSATPE",85,0)
 . ; check posted hours vs requested since no approved request
"RTN","PRSATPE",86,0)
 . S TM(TT,"R")=$G(TM(TT,"R"))-TIM I TM(TT,"R")<0 S ERR=7 D ERR
"RTN","PRSATPE",87,0)
 ; check posted hours vs approved since we have an approved request
"RTN","PRSATPE",88,0)
 S TM(TT,"A")=$G(TM(TT,"A"))-TIM I TM(TT,"A")<0 S ERR=13 D ERR
"RTN","PRSATPE",89,0)
 Q
"RTN","PRSATPE",90,0)
O2 ; Check for valid with-in tour or cross-tour situations
"RTN","PRSATPE",91,0)
 I TT="ON"&(X2["HX") Q
"RTN","PRSATPE",92,0)
 ;I "OT CT"[TT,TIM'>1 Q
"RTN","PRSATPE",93,0)
 ;none-leave hours are inside tour hours, but quit if inside rs hours
"RTN","PRSATPE",94,0)
 QUIT:$G(TRS)=2!(TT="HW"&(X2["^RS"))  S ERR=6 QUIT
"RTN","PRSATPE",95,0)
TM ; Get OT,CT request,approve times
"RTN","PRSATPE",96,0)
 S DTI=$P($G(^PRST(458,PPI,1)),"^",DAY),DA=0 Q:'DTI
"RTN","PRSATPE",97,0)
T1 S DA=$O(^PRST(458.2,"AD",DFN,DTI,DA)) I 'DA Q
"RTN","PRSATPE",98,0)
 S Z=$G(^PRST(458.2,DA,0)),STAT=$P(Z,"^",8) I STAT'="","XD"[STAT G T1
"RTN","PRSATPE",99,0)
 S TT=$P(Z,"^",5) I TT'="OT",TT'="CT" G T1
"RTN","PRSATPE",100,0)
 S TM(TT,"R")=$G(TM(TT,"R"))+$P(Z,"^",6) ; requested sum
"RTN","PRSATPE",101,0)
 I STAT="A" S TM(TT,"A")=$G(TM(TT,"A"))+$P(Z,"^",6) ; approved sum
"RTN","PRSATPE",102,0)
 G T1
"RTN","PRSATPE",103,0)
LV ; Check Leave Request
"RTN","PRSATPE",104,0)
 I TC=3!(TC=4) Q
"RTN","PRSATPE",105,0)
 I TC=1,TT="HW" Q
"RTN","PRSATPE",106,0)
 ;leave hours are (overlap) outside tour hours or (overlap) inside recess hours
"RTN","PRSATPE",107,0)
 I ($G(TRS)'=1&(TT="HW")&$G(TRS)) QUIT
"RTN","PRSATPE",108,0)
 I Z1'="*"!(Z2'="*")!($G(TRS)'=1&(TT'="RS")&$G(TRS)) S ERR=5,FATAL=1 D ERR
"RTN","PRSATPE",109,0)
 ;
"RTN","PRSATPE",110,0)
L0 N REMARK S REMARK=$P(X2,"^",K+3)
"RTN","PRSATPE",111,0)
 Q:REMARK&(REMARK'=15&(REMARK'=16))
"RTN","PRSATPE",112,0)
 I "HX"[TT D HENCAP
"RTN","PRSATPE",113,0)
 ;no leave request for non-leave hour and rs types
"RTN","PRSATPE",114,0)
 QUIT:"RG CP NP HX HW TR TV RS"[TT
"RTN","PRSATPE",115,0)
 S DTI=$P($G(^PRST(458,PPI,1)),"^",DAY) Q:'DTI  S (DT1,DT2)=DTI
"RTN","PRSATPE",116,0)
 I DN D D2 S:DN=2 DT1=DT2
"RTN","PRSATPE",117,0)
 S DTIN=9999999-DT2,DA=0
"RTN","PRSATPE",118,0)
 F KK=0:0 S KK=$O(^PRST(458.1,"AD",DFN,KK)) G:KK=""!(KK>DTIN) L3 F DA=0:0 S DA=$O(^PRST(458.1,"AD",DFN,KK,DA)) Q:DA=""  I ^(DA)'>DT1 D L1 G:LF L4
"RTN","PRSATPE",119,0)
 Q
"RTN","PRSATPE",120,0)
L1 S Z=$G(^PRST(458.1,DA,0)),LF=0 Q:$P(Z,"^",7)'=TT  S STAT=$P(Z,"^",9) I "XD"[STAT Q
"RTN","PRSATPE",121,0)
 G:Y0="" L2 S Z1=$P(Y0,"^",1),Z2=$P(Y0,"^",2)
"RTN","PRSATPE",122,0)
 S X=$P(Z,"^",4)_"^"_$P(Z,"^",6) D CNV^PRSATIM
"RTN","PRSATPE",123,0)
 I $P(Z,"^",3)=DT1,$P(Y,"^",1)>Z1 Q
"RTN","PRSATPE",124,0)
 I $P(Z,"^",5)=DT2,$P(Y,"^",2)<Z2 Q
"RTN","PRSATPE",125,0)
L2 I STAT'="A" S ERR=4 D ERR
"RTN","PRSATPE",126,0)
 S LF=1 Q
"RTN","PRSATPE",127,0)
L3 S ERR=3 D ERR Q
"RTN","PRSATPE",128,0)
L4 Q
"RTN","PRSATPE",129,0)
D2 I DAY<14 S DT2=$P($G(^PRST(458,PPI,1)),"^",DAY+1) Q
"RTN","PRSATPE",130,0)
 N X1,X2 S X1=DT1,X2=1 D C^%DTC S DT2=X Q
"RTN","PRSATPE",131,0)
 ;
"RTN","PRSATPE",132,0)
HENCAP ; Check for Holiday encapsulated by non-pay
"RTN","PRSATPE",133,0)
 N DAH,DBH,HOL,QUIT
"RTN","PRSATPE",134,0)
 S (DAH,DBH,HOL,QUIT)=""
"RTN","PRSATPE",135,0)
 D HENCAP^PRSATP4(PPI,DFN,DAY,.DBH,.HOL,.DAH,.QUIT)
"RTN","PRSATPE",136,0)
 Q:QUIT
"RTN","PRSATPE",137,0)
 Q:HOL=""
"RTN","PRSATPE",138,0)
 S ERR=15 D ERR Q  ; Holiday in current PP
"RTN","PRSATPE",139,0)
 Q
"RTN","PRSATPE",140,0)
NAWS3640(PRSEMP,PPI) ; return true if NAWS 36/40 Nurse for this PPI
"RTN","PRSATPE",141,0)
 N EMPNODE,PAYPLAN,DTYBASIS,NORMHRS,S8
"RTN","PRSATPE",142,0)
 S S8=$G(^PRST(458,PPI,"E",PRSEMP,5))
"RTN","PRSATPE",143,0)
 I S8'="",($E(S8,26,27)'=72!("KM"'[$E(S8,28))!($E(S8,29)'=1)) Q 0
"RTN","PRSATPE",144,0)
 S EMPNODE=$G(^PRSPC(PRSEMP,0))
"RTN","PRSATPE",145,0)
 S PAYPLAN=$P(EMPNODE,U,21)
"RTN","PRSATPE",146,0)
 S DTYBASIS=$P(EMPNODE,U,10)
"RTN","PRSATPE",147,0)
 S NORMHRS=$P(EMPNODE,U,16)
"RTN","PRSATPE",148,0)
 Q "KM"[PAYPLAN&(DTYBASIS=1)&(NORMHRS=72)
"RTN","PRSATPE",149,0)
SAT2DAY(WK,PRSIEN,PPI) ;
"RTN","PRSATPE",150,0)
 N HRS,SUNTRHRS,SAT2DAY,PRSD
"RTN","PRSATPE",151,0)
 S SAT2DAY=0
"RTN","PRSATPE",152,0)
 S PRSD=$S(WK=1:7,1:14)
"RTN","PRSATPE",153,0)
 S SAT2DAY=$P($G(^PRST(458,PPI,"E",PRSIEN,"D",PRSD,0)),"^",2)
"RTN","PRSATPE",154,0)
 I SAT2DAY>0 S SAT2DAY=$P($G(^PRST(457.1,SAT2DAY,0)),U,5)="Y"
"RTN","PRSATPE",155,0)
 Q SAT2DAY
"RTN","PRSATPE",156,0)
CARRYOVR(PRSIEN,PPI) ; true if hours are coming in from last pp
"RTN","PRSATPE",157,0)
 N PRIORSAT,SAT2DAY
"RTN","PRSATPE",158,0)
 S SAT2DAY=0
"RTN","PRSATPE",159,0)
 S PRIORSAT=$P($G(^PRST(458,PPI-1,"E",PRSIEN,"D",14,0)),U,2)
"RTN","PRSATPE",160,0)
 I PRIORSAT>0 S SAT2DAY=$P($G(^PRST(457.1,PRIORSAT,0)),U,5)="Y"
"RTN","PRSATPE",161,0)
 Q SAT2DAY
"RTN","PRSATPE",162,0)
THREE12(WK,PRSIEN,PPI) ;
"RTN","PRSATPE",163,0)
 N PRSD,TOURDTY,COUNT,ST,EN
"RTN","PRSATPE",164,0)
 S COUNT=0
"RTN","PRSATPE",165,0)
 S ST=$S(WK=1:1,1:8),EN=$S(WK=1:7,1:14)
"RTN","PRSATPE",166,0)
 F PRSD=ST:1:EN D
"RTN","PRSATPE",167,0)
 . S TOURDTY=$P($G(^PRST(458,PPI,"E",PRSIEN,"D",PRSD,0)),"^",2)
"RTN","PRSATPE",168,0)
 . I $P($G(^PRST(457.1,TOURDTY,0)),U,6)=12 S COUNT=COUNT+1
"RTN","PRSATPE",169,0)
 I COUNT'=3 Q 1
"RTN","PRSATPE",170,0)
 N HRS
"RTN","PRSATPE",171,0)
 D TOURHRS^PRSARC07(.HRS,PPI,PRSIEN)
"RTN","PRSATPE",172,0)
 Q:(HRS($S(WK=1:"W1",1:"W2"))'=36) 1
"RTN","PRSATPE",173,0)
 Q 0
"RTN","PRSATPE",174,0)
HRSMATCH(PPI,DFN) ; Return true if hourly employee tour hrs '= 8B normal hrs
"RTN","PRSATPE",175,0)
 N MATCH,HRS,NH,ENT,ENTPTR
"RTN","PRSATPE",176,0)
 I $G(PPI)'>0!($G(DFN)'>0) Q 1
"RTN","PRSATPE",177,0)
 S MATCH=1
"RTN","PRSATPE",178,0)
 S NH=-1
"RTN","PRSATPE",179,0)
 S ENTPTR=$P($G(^PRST(458,PPI,"E",DFN,0)),U,5)
"RTN","PRSATPE",180,0)
 I ENTPTR'="" D
"RTN","PRSATPE",181,0)
 .  S ENT=$P($G(^PRST(457.5,ENTPTR,1)),U)
"RTN","PRSATPE",182,0)
 .  S NH=$E($G(^PRST(458,PPI,"E",DFN,5)),26,27)
"RTN","PRSATPE",183,0)
 .  Q:NH="00"
"RTN","PRSATPE",184,0)
 .  I +NH'>0 S NH=$P($G(^PRSPC(DFN,0)),U,50)
"RTN","PRSATPE",185,0)
 I $G(ENT)="" D ^PRSAENT
"RTN","PRSATPE",186,0)
 I $G(ENT)'="",$E(ENT)'="D",($E(ENT,1,2)'="0D"),$G(NH)'=112 D
"RTN","PRSATPE",187,0)
 .  D TOURHRS^PRSARC07(.HRS,PPI,DFN)
"RTN","PRSATPE",188,0)
 .  I ($G(HRS("W1"))+$G(HRS("W2")))'=+$G(NH) S MATCH=0
"RTN","PRSATPE",189,0)
 Q MATCH
"RTN","PRSATPE",190,0)
 ;
"RTN","PRSATPE",191,0)
ERR ; Set Error
"RTN","PRSATPE",192,0)
 S ECNT=ECNT+1,ER(ECNT)=TT_$P($T(ERTX+ERR),";;",2)_"^"_$P(X2,"^",K) Q
"RTN","PRSATPE",193,0)
ERR3640 ; Set NAWS (36/40) Errors and errors not related to a single segment
"RTN","PRSATPE",194,0)
 S ECNT=ECNT+1,ER(ECNT)=$P($T(ERTX+ERR),";;",2) Q
"RTN","PRSATPE",195,0)
ERTX ;;
"RTN","PRSATPE",196,0)
1 ;;No Tour Entered^
"RTN","PRSATPE",197,0)
2 ;;No Time Posted^
"RTN","PRSATPE",198,0)
3 ;; not Requested
"RTN","PRSATPE",199,0)
4 ;; Requested but not Approved
"RTN","PRSATPE",200,0)
5 ;; Posted outside of Tour Hours or within Recess Hours
"RTN","PRSATPE",201,0)
6 ;; Posted within Tour Hours or outside of Recess Hours
"RTN","PRSATPE",202,0)
7 ;; Posted exceeds Requested Hours
"RTN","PRSATPE",203,0)
8 ;; Requested but pending Supervisor Approval
"RTN","PRSATPE",204,0)
9 ;; Supervisor Approved but pending Director Approval
"RTN","PRSATPE",205,0)
10 ;; Overlaps with the start of the next day's Tour
"RTN","PRSATPE",206,0)
11 ;; Overlaps with the prior day's Tour
"RTN","PRSATPE",207,0)
12 ;; can only be posted against OT, CT, ON, & SB in Tour
"RTN","PRSATPE",208,0)
13 ;; Posted exceeds Approved Hours
"RTN","PRSATPE",209,0)
14 ;; The minimum charge for Military Leave is one hour
"RTN","PRSATPE",210,0)
15 ;; was encapsulated by non-pay
"RTN","PRSATPE",211,0)
16 ;;36/40 AWS nurse has a 2 day tour on Saturday^
"RTN","PRSATPE",212,0)
17 ;;36/40 AWS nurse has tour carryover from prior pp^
"RTN","PRSATPE",213,0)
18 ;;36/40 AWS nurse must have 3 12 hr tours in week 1^
"RTN","PRSATPE",214,0)
19 ;;36/40 AWS nurse must have 3 12 hr tours in week 2^
"RTN","PRSATPE",215,0)
20 ;;Normal/Tour hrs unequal^
"RTN","PRSATPP")
0^111^B14151243^B8587383
"RTN","PRSATPP",1,0)
PRSATPP ;WCIOFO/PLT - Timekeeper Prior PP Post Time ;7/29/08  15:44
"RTN","PRSATPP",2,0)
 ;;4.0;PAID;**117**;Sep 21, 1995;Build 32
"RTN","PRSATPP",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRSATPP",4,0)
 ;
"RTN","PRSATPP",5,0)
 S PRSTLV=2 D ^PRSAUTL G:TLI<1 EX
"RTN","PRSATPP",6,0)
 S X=$P(^PRST(455.5,TLI,0),"^",3) D NOW^%DTC S NOW=%,DT=%\1
"RTN","PRSATPP",7,0)
D1 S %DT="AEPX",%DT("A")="Posting Date: ",%DT(0)=-DT W ! D ^%DT
"RTN","PRSATPP",8,0)
 G:Y<1 EX S D1=Y S Y=$G(^PRST(458,"AD",D1)),PPI=$P(Y,"^",1),DAY=$P(Y,"^",2)
"RTN","PRSATPP",9,0)
 I PPI="" W !!,*7,"Pay Period is Not Open Yet!" G EX
"RTN","PRSATPP",10,0)
 S PPE=$P($G(^PRST(458,PPI,0)),"^",1),DTE=$P($G(^PRST(458,PPI,2)),"^",DAY),DTI=$P($G(^(1)),"^",DAY)
"RTN","PRSATPP",11,0)
NME K DIC S DIC("A")="Select EMPLOYEE: ",DIC("S")="I $P(^(0),""^"",8)=TLE,$D(^PRST(458,PPI,""E"",+Y))",DIC(0)="AEQM",DIC="^PRSPC(",D="ATL"_TLE W ! D IX^DIC S DFN=+Y K DIC
"RTN","PRSATPP",12,0)
 G:DFN<1 EX
"RTN","PRSATPP",13,0)
 D ^PRSAENT I ENT="" W *7,!!,"Employee has no Pay Entitlement table entry." G EX
"RTN","PRSATPP",14,0)
 S STAT=$P($G(^PRST(458,PPI,"E",DFN,0)),"^",2) I "T"[STAT W *7,!!,"Employee still open for regular posting." G NME
"RTN","PRSATPP",15,0)
 I STAT'="X" W !!,*7,"Card in Payroll and not transmitted; request return of card." G NME
"RTN","PRSATPP",16,0)
 K AUR S L2=0 F L1=0,1,2,10,3,4 S Z=$G(^PRST(458,PPI,"E",DFN,"D",DAY,L1)),L2=L2+1 S:Z'="" AUR(L2)=Z
"RTN","PRSATPP",17,0)
 S STAT=$P($G(AUR(4)),"^",1) D POST
"RTN","PRSATPP",18,0)
 S (Z,L2)=0 F L1=0,1,2,10,3,4 S L2=L2+1 I $G(^PRST(458,PPI,"E",DFN,"D",DAY,L1))'=$G(AUR(L2)) S Z=1
"RTN","PRSATPP",19,0)
 I Z S AUT="T",AUS="R" D ^PRSAUD I $G(AUR(7))["^" S L2=0 F L1=0,1,2,10,3,4 S L2=L2+1 K ^PRST(458,PPI,"E",DFN,"D",DAY,L1) I $D(AUR(L2)) S ^(L1)=AUR(L2)
"RTN","PRSATPP",20,0)
 G NME
"RTN","PRSATPP",21,0)
 ;
"RTN","PRSATPP",22,0)
POST ;start posting
"RTN","PRSATPP",23,0)
 N DDSFILE,PRSDAY,PRSDN,PRSERR,SRT
"RTN","PRSATPP",24,0)
 S SRT="X",PRSDN=DAY
"RTN","PRSATPP",25,0)
 S TC=$P($G(^PRST(458,PPI,"E",DFN,"D",DAY,0)),"^",2),TC2=$P($G(^(0)),"^",13)
"RTN","PRSATPP",26,0)
 D ^PRSADP1,LP,^PRSATP2 G:'TC T1
"RTN","PRSATPP",27,0)
T0 R !!,"Do you wish to change Scheduled Tour? N// ",X:DTIME Q:'$T!(X["^")  S:X="" X="N" S X=$TR(X,"yesno","YESNO")
"RTN","PRSATPP",28,0)
 I $P("YES",X,1)'="",$P("NO",X,1)'="" W *7," Answer YES or NO" G T0
"RTN","PRSATPP",29,0)
 G:X?1"N".E T3
"RTN","PRSATPP",30,0)
T1 ; Get new tour
"RTN","PRSATPP",31,0)
 S TYP=1,WTL=TLI
"RTN","PRSATPP",32,0)
 S DIC="^PRST(455.5,",DIC(0)="AEQM",DIC("A")="T&L on which Tour will be worked: ",DIC("B")=TLE W ! D ^DIC Q:Y<1  K DIC S WTL=+Y
"RTN","PRSATPP",33,0)
 S DIC="^PRST(457.1,",DIC(0)="AEQMN"
"RTN","PRSATPP",34,0)
 S DIC("S")="I "_$S($E(ENT,1)="D":"Y<3",1:"Y>5!(Y=1)")_",$P(^PRST(457.1,+Y,0),U,4)!($D(^PRST(457.1,+Y,""T"",""B"",WTL)))"
"RTN","PRSATPP",35,0)
 S DIC("A")="Select TOUR OF DUTY: " W ! D ^DIC K DIC G:Y'>0 T2
"RTN","PRSATPP",36,0)
 S TD=+Y
"RTN","PRSATPP",37,0)
 ;tour overlap check
"RTN","PRSATPP",38,0)
 K PRSDAY S PRSDAY(DAY)=$P($G(^PRST(458,PPI,"E",DFN,"D",DAY,0)),U,1,4),$P(PRSDAY(DAY),U,2)=TD,$P(PRSDAY(DAY),U,6)=$P($G(^(0)),U,13),$P(PRSDAY(DAY),U,7,999)=$G(^(4))
"RTN","PRSATPP",39,0)
 D PPTDOL^PRSATE5(SRT,PPI,DFN,DAY,.PRSDAY,3) I $G(PRSERR) K PRSERR G T1
"RTN","PRSATPP",40,0)
 S Y=$G(^PRST(457.1,TD,1)),TDH=$P(^(0),"^",6) D SET^PRSATE,HOL^PRSATE S TC=TD
"RTN","PRSATPP",41,0)
T2 ;ask secondary tour
"RTN","PRSATPP",42,0)
 G:$E(ENT,1)="D" T21
"RTN","PRSATPP",43,0)
 S X=$$ASK2NDTR^PRSATE() G:X'="Y" T21 D
"RTN","PRSATPP",44,0)
 . N TD,TC,TC2
"RTN","PRSATPP",45,0)
 . S TD=$P($G(^PRST(458,PPI,"E",DFN,"D",DAY,0)),"^",13)
"RTN","PRSATPP",46,0)
 . I TD W !!,"Existing Second Tour ",$P($G(^PRST(457.1,TD,0)),"^",1)," is being deleted." D DELSTD^PRSATE4(PPI,DFN,DAY)
"RTN","PRSATPP",47,0)
 . QUIT
"RTN","PRSATPP",48,0)
 I $P($G(^PRST(458,PPI,"E",DFN,"D",DAY,0)),"^",2)<6 W *7,!!,"A second Tour is not valid on this day." G T21
"RTN","PRSATPP",49,0)
 K PRSDAY,PRSERR D
"RTN","PRSATPP",50,0)
 . N DAY
"RTN","PRSATPP",51,0)
 . S DAY=PRSDN D P^PRSATE4
"RTN","PRSATPP",52,0)
 . QUIT
"RTN","PRSATPP",53,0)
 ;
"RTN","PRSATPP",54,0)
T21 S DAY=PRSDN,TC=$P($G(^PRST(458,PPI,"E",DFN,"D",DAY,0)),"^",2),TD=TC,TC2=$P($G(^(0)),"^",13)
"RTN","PRSATPP",55,0)
 D ^PRSADP1,LP,^PRSATP2
"RTN","PRSATPP",56,0)
T3 G P1^PRSATP:TC=1,P3^PRSATP:TC=4,P0^PRSATP
"RTN","PRSATPP",57,0)
 ;
"RTN","PRSATPP",58,0)
LP W !!,"Enter '^' to bypass this employee." W ! Q
"RTN","PRSATPP",59,0)
EX G KILL^XUSCLEAN
"RTN","PRSROT11")
0^99^B16245069^B16238575
"RTN","PRSROT11",1,0)
PRSROT11 ;HISC/JH-IND. OR ALL EMPLOYEE OT/CT REPORT (Continued) ;7/18/97
"RTN","PRSROT11",2,0)
 ;;4.0;PAID;**2,21,28,34,114,117**;Sep 21, 1995;Build 32
"RTN","PRSROT11",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRSROT11",4,0)
 ;
"RTN","PRSROT11",5,0)
 ; CP = "|"  CP = column PIPE character (used for vertical columns)
"RTN","PRSROT11",6,0)
 ;
"RTN","PRSROT11",7,0)
 N CP
"RTN","PRSROT11",8,0)
 S CP="|"
"RTN","PRSROT11",9,0)
 S ORG=$S($D(ORG):$E(ORG,1,12),1:"")
"RTN","PRSROT11",10,0)
 D HDR1
"RTN","PRSROT11",11,0)
 S (PP(1),NAM(1),DAY(1),DATT(1))="",DATE(1)=0
"RTN","PRSROT11",12,0)
 F I=1:1:2 S (SAL(I),COMP(I),COMPU(I),OTH(I),OTP(I))=0
"RTN","PRSROT11",13,0)
 S PP=""
"RTN","PRSROT11",14,0)
 F I=0:0 S PP=$O(^TMP($J,"OT/CP",PP)) Q:PP=""  S SW(1)=0 D  Q:POUT
"RTN","PRSROT11",15,0)
 .;
"RTN","PRSROT11",16,0)
 .  S DATT=0
"RTN","PRSROT11",17,0)
 .  F I=0:0 S DATT=$O(^TMP($J,"OT/CP",PP,DATT)) Q:DATT'>0  D  Q:POUT
"RTN","PRSROT11",18,0)
 ..;
"RTN","PRSROT11",19,0)
 ..  S INX=0
"RTN","PRSROT11",20,0)
 ..  F I=0:0 S INX=$O(^TMP($J,"OT/CP",PP,DATT,INX)) Q:INX']""  D  Q:POUT
"RTN","PRSROT11",21,0)
 ...;
"RTN","PRSROT11",22,0)
 ...  S NAM=""
"RTN","PRSROT11",23,0)
 ...  F I=0:0 S NAM=$O(^TMP($J,"OT/CP",PP,DATT,INX,NAM)) Q:NAM=""  S SW(3)=0 D  Q:POUT
"RTN","PRSROT11",24,0)
 ....  S D0=0
"RTN","PRSROT11",25,0)
 ....  F I=0:0 S D0=$O(^TMP($J,"OT/CP",PP,DATT,INX,NAM,D0)) Q:D0'>0  S TIME=$G(^(D0)) Q:TIME=""  D  Q:POUT
"RTN","PRSROT11",26,0)
 .....;
"RTN","PRSROT11",27,0)
 .....  D:($Y>(IOSL-5)) HDR Q:POUT
"RTN","PRSROT11",28,0)
 .....  D VLIN0:PP'=PP(1)
"RTN","PRSROT11",29,0)
 .....  W !,CP,$S(PP'=PP(1):$J($P(PP,"-",2),2),1:""),?4,CP,$S(DATT'=DATT(1):DATT,1:""),?14,CP,NAM,?39,CP
"RTN","PRSROT11",30,0)
 .....  I PRSTLV=3 W $E($P(TIME,"^")),"XX-XX-",$E($P(TIME,"^"),8,11),?52,CP
"RTN","PRSROT11",31,0)
 .....  I PRSTLV=7 W $P(TIME,"^"),?52,CP
"RTN","PRSROT11",32,0)
 .....  W $J($P(TIME,"^",2),10,2),?64,CP,$J($P(TIME,"^",3),12,2),?79,CP,$J($P(TIME,"^",4),12,2),?94,CP
"RTN","PRSROT11",33,0)
 .....  W $J($P(TIME,"^",5),12,2),?109,CP,$J($P(TIME,"^",6),17,2),?131,CP
"RTN","PRSROT11",34,0)
 .....  S SAL(1)=SAL(1)+$P(TIME,"^",2),COMPU(1)=COMPU(1)+$P(TIME,"^",3),COMP(1)=COMP(1)+$P(TIME,"^",4),OTH(1)=OTH(1)+$P(TIME,"^",5),OTP(1)=OTP(1)+$P(TIME,"^",6),SW(1)=SW(1)+1
"RTN","PRSROT11",35,0)
 .....  S SAL(2)=SAL(2)+$P(TIME,"^",2),COMPU(2)=COMPU(2)+$P(TIME,"^",3),COMP(2)=COMP(2)+$P(TIME,"^",4),OTH(2)=OTH(2)+$P(TIME,"^",5),OTP(2)=OTP(2)+$P(TIME,"^",6)
"RTN","PRSROT11",36,0)
 .....  Q
"RTN","PRSROT11",37,0)
 ....  S PP(1)=PP,DATT(1)=DATT,NAM(1)=NAM,DATE(1)=DATE Q
"RTN","PRSROT11",38,0)
 ....  Q
"RTN","PRSROT11",39,0)
 ...  Q
"RTN","PRSROT11",40,0)
 ..  Q
"RTN","PRSROT11",41,0)
 .  Q:POUT  I SW(1) D
"RTN","PRSROT11",42,0)
 ..    W !
"RTN","PRSROT11",43,0)
 ..    D TABLANK0,ROWSEP
"RTN","PRSROT11",44,0)
 .  D TABLANK0
"RTN","PRSROT11",45,0)
 .  W " P/P-Totals:"
"RTN","PRSROT11",46,0)
 .  D WTOT(1)
"RTN","PRSROT11",47,0)
 .  S (SAL(1),COMPU(1),COMP(1),OTH(1),OTP(1))=0
"RTN","PRSROT11",48,0)
 .  Q
"RTN","PRSROT11",49,0)
 Q:POUT
"RTN","PRSROT11",50,0)
 I SW(1) D
"RTN","PRSROT11",51,0)
 .  D VLIN0
"RTN","PRSROT11",52,0)
 .  D VLINUND
"RTN","PRSROT11",53,0)
 ;
"RTN","PRSROT11",54,0)
 D TABLANK0
"RTN","PRSROT11",55,0)
 W ?44,"TOTALS:"
"RTN","PRSROT11",56,0)
 D WTOT(2)
"RTN","PRSROT11",57,0)
 I IOSL<66 D VLIN0
"RTN","PRSROT11",58,0)
 Q
"RTN","PRSROT11",59,0)
WTOT(PERIOD) ;Write out pay period totals (1) OR running totals.
"RTN","PRSROT11",60,0)
 S I=PERIOD
"RTN","PRSROT11",61,0)
 W ?53,$J(SAL(I),10,2)
"RTN","PRSROT11",62,0)
 W ?65,$J(COMPU(I),12,2)
"RTN","PRSROT11",63,0)
 W ?80,$J(COMP(I),12,2)
"RTN","PRSROT11",64,0)
 W ?95,$J(OTH(I),12,2)
"RTN","PRSROT11",65,0)
 W ?110,$J(OTP(I),17,2),?131,CP
"RTN","PRSROT11",66,0)
 Q
"RTN","PRSROT11",67,0)
CHK S X1=DATE,X2=DATE(1) D ^%DTC Q
"RTN","PRSROT11",68,0)
HDR S CODE="O001",FOOT="VA TIME & ATTENDANCE SYSTEM"
"RTN","PRSROT11",69,0)
 D VLIDSH0,FOOT1^PRSRUT0
"RTN","PRSROT11",70,0)
 I $E(IOST,1,2)="C-" S DIR(0)="E" D ^DIR K DIR I $D(DIRUT) S POUT=1
"RTN","PRSROT11",71,0)
 Q:POUT
"RTN","PRSROT11",72,0)
 W @IOF
"RTN","PRSROT11",73,0)
HDR1 N CP S CP="|"
"RTN","PRSROT11",74,0)
 W !?(IOM-$L(^TMP($J,"OT/CP")))/2,^TMP($J,"OT/CP"),?(IOM-14),"DATE: ",DAT
"RTN","PRSROT11",75,0)
 S X="T&L: "_$P(TLE(1),U)_"  Employee: "_$S(SW:"ALL",1:$P(PRSRY,U,2))
"RTN","PRSROT11",76,0)
 S X=X_"  Year: "_YEAR_"  Payperiod"
"RTN","PRSROT11",77,0)
 S X=X_$S(PPE(1)=PPE(2):": "_PPE(1),1:"s: "_PPE(1)_" to "_PPE(2))
"RTN","PRSROT11",78,0)
 W !,?(IOM-$L(X)/2-1),X,!
"RTN","PRSROT11",79,0)
 W !,CP,"P/P",?4,CP,?7,"DATE",?14,CP,?25,"NAME",?39,CP,?44,"SSN",?52,CP,?54,"GROSS PAY",?64,CP,?67,"CT/CH USED",?79,CP,?82,"CT/CH BAL",?94,CP,?97,"OVER/T HRS",?109,CP,?118,"OVER/T PAY",?131,CP D VLIDSH0 Q
"RTN","PRSROT11",80,0)
 ;
"RTN","PRSROT11",81,0)
VLIDSH0 ;
"RTN","PRSROT11",82,0)
 W !,"|---|---------|------------------------|------------|-----------|--------------|--------------|--------------|---------------------|" Q
"RTN","PRSROT11",83,0)
 ;
"RTN","PRSROT11",84,0)
VLIN0 ;
"RTN","PRSROT11",85,0)
 W !
"RTN","PRSROT11",86,0)
 D TABLANK0,TABLANK1
"RTN","PRSROT11",87,0)
 Q
"RTN","PRSROT11",88,0)
 ;
"RTN","PRSROT11",89,0)
VLINUND ;use leading blank columns & trailing row separator.
"RTN","PRSROT11",90,0)
 W ! D TABLANK0,ROWSEP Q
"RTN","PRSROT11",91,0)
 ;
"RTN","PRSROT11",92,0)
TABLANK0 ;leading blank columns with vertical slash for column breaks.
"RTN","PRSROT11",93,0)
 N CP S CP="|"
"RTN","PRSROT11",94,0)
 W CP,?4,CP,?14,CP,?39,CP Q
"RTN","PRSROT11",95,0)
 ;
"RTN","PRSROT11",96,0)
TABLANK1 ;2nd half of blank columns w/ vertical slash for column breaks.
"RTN","PRSROT11",97,0)
 N CP S CP="|"
"RTN","PRSROT11",98,0)
 W ?52,CP,?64,CP,?79,CP,?94,CP,?109,CP,?131,CP Q
"RTN","PRSROT11",99,0)
 ;
"RTN","PRSROT11",100,0)
ROWSEP ;row separator (2nd half of line)
"RTN","PRSROT11",101,0)
 N CP S CP="|"
"RTN","PRSROT11",102,0)
 W ?52,CP," --------- ",CP,"     ------- "
"RTN","PRSROT11",103,0)
 W ?79,CP,"     ------- "
"RTN","PRSROT11",104,0)
 W ?94,CP,"     ------- "
"RTN","PRSROT11",105,0)
 W ?109,CP,"       ---------- "
"RTN","PRSROT11",106,0)
 W ?131,CP,!
"RTN","PRSROT11",107,0)
 Q
"VER")
8.0^22.0
"BLD",7507,6)
^106
**END**
**END**
