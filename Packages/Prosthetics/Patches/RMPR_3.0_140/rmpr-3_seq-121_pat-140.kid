Released RMPR*3*140 SEQ #121
Extracted from mail message
**KIDS**:RMPR*3.0*140^

**INSTALL NAME**
RMPR*3.0*140
"BLD",6716,0)
RMPR*3.0*140^PROSTHETICS^0^3080206^y
"BLD",6716,1,0)
^^6^6^3071016^
"BLD",6716,1,1,0)
1. Add notification to LIST OPEN PURCHASE CARD TRANSACTION report to
"BLD",6716,1,2,0)
   identify "dangling" amendments. 
"BLD",6716,1,3,0)
 
"BLD",6716,1,4,0)
2. Purge Suspense records undefined error: EN1+5^RMPR8PG
"BLD",6716,1,5,0)
 
"BLD",6716,1,6,0)
3. HOME OXYGEN PRESCRIPTION DATE in add/edit not defaulting
"BLD",6716,4,0)
^9.64PA^^
"BLD",6716,6.3)
10
"BLD",6716,"ABPKG")
n
"BLD",6716,"KRN",0)
^9.67PA^8989.52^19
"BLD",6716,"KRN",.4,0)
.4
"BLD",6716,"KRN",.401,0)
.401
"BLD",6716,"KRN",.402,0)
.402
"BLD",6716,"KRN",.403,0)
.403
"BLD",6716,"KRN",.5,0)
.5
"BLD",6716,"KRN",.84,0)
.84
"BLD",6716,"KRN",3.6,0)
3.6
"BLD",6716,"KRN",3.8,0)
3.8
"BLD",6716,"KRN",9.2,0)
9.2
"BLD",6716,"KRN",9.8,0)
9.8
"BLD",6716,"KRN",9.8,"NM",0)
^9.68A^9^5
"BLD",6716,"KRN",9.8,"NM",1,0)
RMPR4OPN^^0^B19109411
"BLD",6716,"KRN",9.8,"NM",2,0)
RMPR4LOP^^0^B22111692
"BLD",6716,"KRN",9.8,"NM",7,0)
RMPR8PG^^0^B6676473
"BLD",6716,"KRN",9.8,"NM",8,0)
RMPR4C21^^0^B14352551
"BLD",6716,"KRN",9.8,"NM",9,0)
RMPOPED^^0^B85650773
"BLD",6716,"KRN",9.8,"NM","B","RMPOPED",9)

"BLD",6716,"KRN",9.8,"NM","B","RMPR4C21",8)

"BLD",6716,"KRN",9.8,"NM","B","RMPR4LOP",2)

"BLD",6716,"KRN",9.8,"NM","B","RMPR4OPN",1)

"BLD",6716,"KRN",9.8,"NM","B","RMPR8PG",7)

"BLD",6716,"KRN",19,0)
19
"BLD",6716,"KRN",19,"NM",0)
^9.68A^^
"BLD",6716,"KRN",19.1,0)
19.1
"BLD",6716,"KRN",101,0)
101
"BLD",6716,"KRN",409.61,0)
409.61
"BLD",6716,"KRN",771,0)
771
"BLD",6716,"KRN",870,0)
870
"BLD",6716,"KRN",8989.51,0)
8989.51
"BLD",6716,"KRN",8989.52,0)
8989.52
"BLD",6716,"KRN",8994,0)
8994
"BLD",6716,"KRN","B",.4,.4)

"BLD",6716,"KRN","B",.401,.401)

"BLD",6716,"KRN","B",.402,.402)

"BLD",6716,"KRN","B",.403,.403)

"BLD",6716,"KRN","B",.5,.5)

"BLD",6716,"KRN","B",.84,.84)

"BLD",6716,"KRN","B",3.6,3.6)

"BLD",6716,"KRN","B",3.8,3.8)

"BLD",6716,"KRN","B",9.2,9.2)

"BLD",6716,"KRN","B",9.8,9.8)

"BLD",6716,"KRN","B",19,19)

"BLD",6716,"KRN","B",19.1,19.1)

"BLD",6716,"KRN","B",101,101)

"BLD",6716,"KRN","B",409.61,409.61)

"BLD",6716,"KRN","B",771,771)

"BLD",6716,"KRN","B",870,870)

"BLD",6716,"KRN","B",8989.51,8989.51)

"BLD",6716,"KRN","B",8989.52,8989.52)

"BLD",6716,"KRN","B",8994,8994)

"BLD",6716,"QUES",0)
^9.62^^
"BLD",6716,"REQB",0)
^9.611^8^3
"BLD",6716,"REQB",6,0)
RMPR*3.0*75^2
"BLD",6716,"REQB",7,0)
RMPR*3.0*62^2
"BLD",6716,"REQB",8,0)
RMPR*3.0*110^2
"BLD",6716,"REQB","B","RMPR*3.0*110",8)

"BLD",6716,"REQB","B","RMPR*3.0*62",7)

"BLD",6716,"REQB","B","RMPR*3.0*75",6)

"MBREQ")
0
"PKG",101,-1)
1^1
"PKG",101,0)
PROSTHETICS^RMPR^PROSTHETICS VERSION 3.0 ALPHA
"PKG",101,20,0)
^9.402P^^0
"PKG",101,22,0)
^9.49I^1^1
"PKG",101,22,1,0)
3.0^2960209^2960214
"PKG",101,22,1,"PAH",1,0)
140^3080206
"PKG",101,22,1,"PAH",1,1,0)
^^6^6^3080206
"PKG",101,22,1,"PAH",1,1,1,0)
1. Add notification to LIST OPEN PURCHASE CARD TRANSACTION report to
"PKG",101,22,1,"PAH",1,1,2,0)
   identify "dangling" amendments. 
"PKG",101,22,1,"PAH",1,1,3,0)
 
"PKG",101,22,1,"PAH",1,1,4,0)
2. Purge Suspense records undefined error: EN1+5^RMPR8PG
"PKG",101,22,1,"PAH",1,1,5,0)
 
"PKG",101,22,1,"PAH",1,1,6,0)
3. HOME OXYGEN PRESCRIPTION DATE in add/edit not defaulting
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","RMPOPED")
0^9^B85650773^B85905941
"RTN","RMPOPED",1,0)
RMPOPED ;EDS/MDB,DDW,RVD - HOME OXYGEN MISC FILE EDITS ;7/24/98
"RTN","RMPOPED",2,0)
 ;;3.0;PROSTHETICS;**29,44,41,52,77,110,140**;Feb 09, 1996;Build 10
"RTN","RMPOPED",3,0)
 ;
"RTN","RMPOPED",4,0)
 ; HNC - patch 52
"RTN","RMPOPED",5,0)
 ;                 modified SITECHK sub
"RTN","RMPOPED",6,0)
 ;                 X will be undefined from GETS^DIQ if field is null
"RTN","RMPOPED",7,0)
 ;                 added $G.
"RTN","RMPOPED",8,0)
 ;RVD - patch #77  use Fileman to set items that are not Primary item
"RTN","RMPOPED",9,0)
 ;                 to 'N' in order to set correctly the 'AC' cross-ref.
"RTN","RMPOPED",10,0)
 Q
"RTN","RMPOPED",11,0)
UNLOCK I $D(RMPODFN) L -^RMPR(665,RMPODFN)
"RTN","RMPOPED",12,0)
 Q
"RTN","RMPOPED",13,0)
EXIT D KILL^XUSCLEAN
"RTN","RMPOPED",14,0)
 D UNLOCK
"RTN","RMPOPED",15,0)
 Q
"RTN","RMPOPED",16,0)
 ;
"RTN","RMPOPED",17,0)
KEY ;user must have the RMPRSUPERVISOR key in order to add a new patient.
"RTN","RMPOPED",18,0)
 ;option name is EDIT HOME OXYGEN PATIENT
"RTN","RMPOPED",19,0)
 N KEY
"RTN","RMPOPED",20,0)
 S KEY=$O(^DIC(19.1,"B","RMPRSUPERVISOR",0))
"RTN","RMPOPED",21,0)
 I '$D(^VA(200,DUZ,51,KEY)) D  Q
"RTN","RMPOPED",22,0)
 . W !!,"You do not hold the RMPSUPERVISOR key!!"
"RTN","RMPOPED",23,0)
 G PAT
"RTN","RMPOPED",24,0)
 ;
"RTN","RMPOPED",25,0)
SITE ; Editing of Home Oxygen site parameter file.
"RTN","RMPOPED",26,0)
 K DIC,DIE,DA,DR,DD,RMPOXITE
"RTN","RMPOPED",27,0)
 S DIC="^RMPR(669.9,",DIC(0)="QEAMLZ",DIC("A")="Select SITE: "
"RTN","RMPOPED",28,0)
 D ^DIC Q:Y<0!$$QUIT
"RTN","RMPOPED",29,0)
 K DIC("A")
"RTN","RMPOPED",30,0)
 S (DA,RMPOXITE)=+Y
"RTN","RMPOPED",31,0)
 ; Lock it...
"RTN","RMPOPED",32,0)
 L +^RMPR(669.9,RMPOXITE):2
"RTN","RMPOPED",33,0)
 I '$T D  G SITE
"RTN","RMPOPED",34,0)
 . W ?10,$C(7)_Y(0,0)_" -- record in use. Try again later."
"RTN","RMPOPED",35,0)
 ; Edit it
"RTN","RMPOPED",36,0)
 S DIE=DIC,DR="60;61;62;65" D ^DIE Q:$$EQUIT
"RTN","RMPOPED",37,0)
 ; Edit FCP
"RTN","RMPOPED",38,0)
 K DIC,DA,DD,DR,DIE
"RTN","RMPOPED",39,0)
 ;
"RTN","RMPOPED",40,0)
 ; Done.  Unlock
"RTN","RMPOPED",41,0)
 L -^RMPR(669.9,RMPOXITE)
"RTN","RMPOPED",42,0)
 G SITE
"RTN","RMPOPED",43,0)
 ;
"RTN","RMPOPED",44,0)
FCPHLP ; Executable help for FCP multiple in 669.9
"RTN","RMPOPED",45,0)
 ;
"RTN","RMPOPED",46,0)
 Q
"RTN","RMPOPED",47,0)
FCPIX ; Input transform for FCP multiple in 669.9
"RTN","RMPOPED",48,0)
 ;
"RTN","RMPOPED",49,0)
 Q:'$D(X)
"RTN","RMPOPED",50,0)
 I $L(X)>30!($L(X)<3) K X Q
"RTN","RMPOPED",51,0)
 S ZST=$P(^RMPR(669.9,D0,4),U,1),RMPOX=X
"RTN","RMPOPED",52,0)
 D FIND^DIC(420.01,","_ZST_",",".01;","M",X,1,,,,"X")
"RTN","RMPOPED",53,0)
 S X=$S($D(X("DILIST","ID",1,.01)):X("DILIST","ID",1,.01),1:RMPOX)
"RTN","RMPOPED",54,0)
 K X("DILIST"),RMPOX
"RTN","RMPOPED",55,0)
 I $G(ZST),('$D(^PRC(420,+ZST,1,"B",X))) W !,"Control Point is not a valid IFCAP FCP.." K X
"RTN","RMPOPED",56,0)
 Q
"RTN","RMPOPED",57,0)
ACT ;activate/inactivate a home oxygen patient
"RTN","RMPOPED",58,0)
 ;Set up site variables.
"RTN","RMPOPED",59,0)
 D HOSITE^RMPOUTL0 I QUIT D EXIT Q
"RTN","RMPOPED",60,0)
 W @IOF
"RTN","RMPOPED",61,0)
 ;
"RTN","RMPOPED",62,0)
ACT1 ;Toggle ACTIVATE/INACTIVATE functions.
"RTN","RMPOPED",63,0)
 N NAME K DIC,DA
"RTN","RMPOPED",64,0)
 S DIC="^RMPR(665,",DIC(0)="QEAMZ" D ^DIC I Y<0!$$QUIT D EXIT Q
"RTN","RMPOPED",65,0)
 S DIE=DIC,DA=+Y,NAME=Y(0,0)
"RTN","RMPOPED",66,0)
 L +^RMPR(665,DA):2
"RTN","RMPOPED",67,0)
 I '$T D  G ACT1
"RTN","RMPOPED",68,0)
 . W ?10,$C(7)_Y(0,0)_" -- record in use. Try later."
"RTN","RMPOPED",69,0)
 ;If the patient has never been activated, quit.
"RTN","RMPOPED",70,0)
 I $P($G(^RMPR(665,DA,"RMPOA")),U,2)="" D  G ACT1
"RTN","RMPOPED",71,0)
 . W !!,$C(7)_NAME_" has not been added as a Home Oxygen patient."
"RTN","RMPOPED",72,0)
 . W !,"Please add using the ""Add/Edit Home Oxygen Patient"" option."
"RTN","RMPOPED",73,0)
 ;If the patient is active, perform inactivation actions.
"RTN","RMPOPED",74,0)
 I $P($G(^RMPR(665,DA,"RMPOA")),U,3)="" D INACTVT^RMPOPED G ACT1
"RTN","RMPOPED",75,0)
 ;If the patient is inactive, perform activation actions.
"RTN","RMPOPED",76,0)
 I $P($G(^RMPR(665,DA,"RMPOA")),U,3)'="" D ACTVT^RMPOPED G ACT1
"RTN","RMPOPED",77,0)
 Q
"RTN","RMPOPED",78,0)
INACTVT ; Inactivate the patient if user wants to.
"RTN","RMPOPED",79,0)
 ; Confirm if the user wants to proceed.
"RTN","RMPOPED",80,0)
 K DIR S DIR(0)="YO",DIR("B")="NO"
"RTN","RMPOPED",81,0)
 S DIR("A")="Are you sure you want to inactivate "_NAME_" ?" D ^DIR
"RTN","RMPOPED",82,0)
 Q:(Y<1)!$$QUIT
"RTN","RMPOPED",83,0)
 S DR="19.5//TODAY;19.6;19.7////"_DUZ,DIE("NO^")="BACK"
"RTN","RMPOPED",84,0)
 D ^DIE
"RTN","RMPOPED",85,0)
 Q
"RTN","RMPOPED",86,0)
 ;
"RTN","RMPOPED",87,0)
ACTVT ;Activate the patient if the user wants to.
"RTN","RMPOPED",88,0)
 K DIR S DIR(0)="YO",DIR("B")="NO"
"RTN","RMPOPED",89,0)
 S DIR("A")="Are you sure you want to reactivate "_NAME_" ?" D ^DIR
"RTN","RMPOPED",90,0)
 Q:(Y<1)!$$QUIT
"RTN","RMPOPED",91,0)
 S DR="19.2//TODAY;19.5///@;19.6///@;19.7///@"
"RTN","RMPOPED",92,0)
 S DIE("NO^")="BACK"
"RTN","RMPOPED",93,0)
 D ^DIE
"RTN","RMPOPED",94,0)
 Q
"RTN","RMPOPED",95,0)
PAT ;Add/Edit Home Oxygen Patient
"RTN","RMPOPED",96,0)
 S QUIT=0
"RTN","RMPOPED",97,0)
 D HOSITE^RMPOUTL0
"RTN","RMPOPED",98,0)
 I '$D(RMPOXITE)!QUIT D EXIT Q
"RTN","RMPOPED",99,0)
LOOP ;
"RTN","RMPOPED",100,0)
 S QUIT=0
"RTN","RMPOPED",101,0)
 D LOOKUP I QUIT!'$D(RMPODFN) D EXIT Q
"RTN","RMPOPED",102,0)
 D EDBLK I QUIT D EXIT Q
"RTN","RMPOPED",103,0)
 D UNLOCK G LOOP
"RTN","RMPOPED",104,0)
EDBLK ;
"RTN","RMPOPED",105,0)
 D SITECHK Q:QUIT
"RTN","RMPOPED",106,0)
 D DEMOG Q:QUIT
"RTN","RMPOPED",107,0)
 D RX Q:QUIT
"RTN","RMPOPED",108,0)
 D ITEM
"RTN","RMPOPED",109,0)
 Q
"RTN","RMPOPED",110,0)
 ;called by ^RMPOBIL1, providing RMPOPATN as the X variable
"RTN","RMPOPED",111,0)
EDIT ;From Billing...
"RTN","RMPOPED",112,0)
 I '$D(RMPODFN) S RMPODFN=$TR($G(RMPOPATN),"`")
"RTN","RMPOPED",113,0)
 Q:'$D(^RMPR(665,+RMPODFN,0))
"RTN","RMPOPED",114,0)
 W !,"EDITING "_$P(^DPT(RMPODFN,0),U)_"...",!
"RTN","RMPOPED",115,0)
 S QUIT=0,DA=RMPODFN
"RTN","RMPOPED",116,0)
 L +^RMPR(665,DA):2
"RTN","RMPOPED",117,0)
 I '$T W !!?10,*7," << Record in use. Try later. >>" Q
"RTN","RMPOPED",118,0)
 D EDBLK,EXIT
"RTN","RMPOPED",119,0)
 Q
"RTN","RMPOPED",120,0)
LOOKUP ;First look-up the patient
"RTN","RMPOPED",121,0)
 K DIC,DIE,DA,DR,RMPODFN
"RTN","RMPOPED",122,0)
 W !!! S DIC="^RMPR(665,",DIC(0)="LQEAMZ"
"RTN","RMPOPED",123,0)
 D ^DIC Q:(Y<0)!$$QUIT
"RTN","RMPOPED",124,0)
CONT S (RMPODFN,DA)=+Y
"RTN","RMPOPED",125,0)
 L +^RMPR(665,DA):2
"RTN","RMPOPED",126,0)
 I '$T W !!?10,*7," << Record in use. Try later. >>" G LOOKUP
"RTN","RMPOPED",127,0)
 Q
"RTN","RMPOPED",128,0)
 ;
"RTN","RMPOPED",129,0)
QUIT() S QUIT=$D(DTOUT)!$D(DUOUT)!$D(DIROUT) Q QUIT
"RTN","RMPOPED",130,0)
EQUIT() S QUIT=$D(DTOUT)!$D(Y) Q QUIT
"RTN","RMPOPED",131,0)
LJ(S,W,C) ; LEFT JUSTIFY S IN A FIELD W WIDE PADDING WITH CHAR F
"RTN","RMPOPED",132,0)
 ;
"RTN","RMPOPED",133,0)
 S C=$G(C," ")   ;DEFAULT PAD CHAR IS SPACE
"RTN","RMPOPED",134,0)
 S $P(S,C,W-$L(S)+$L(S,C))=""
"RTN","RMPOPED",135,0)
 Q S
"RTN","RMPOPED",136,0)
 ;
"RTN","RMPOPED",137,0)
SITECHK ;If user chooses patient from site different from billing site
"RTN","RMPOPED",138,0)
 ;
"RTN","RMPOPED",139,0)
 S Y=$P($G(^RMPR(665,RMPODFN,"RMPOA")),U,7)
"RTN","RMPOPED",140,0)
 Q:Y=RMPOXITE    ;Site is the same.. 
"RTN","RMPOPED",141,0)
 I Y="" D SET Q   ;Site not defined, stuff RMPOXITE...
"RTN","RMPOPED",142,0)
 ; Site is different...
"RTN","RMPOPED",143,0)
 S IENS=RMPODFN_","
"RTN","RMPOPED",144,0)
 D GETS^DIQ(665,IENS,19.12,"E","X")
"RTN","RMPOPED",145,0)
 W !!,"Patient's Home Oxygen Contract Location (HOCL) is "
"RTN","RMPOPED",146,0)
 W $G(X(665,IENS,19.12,"E"))
"RTN","RMPOPED",147,0)
 W !,"You are working on billing for HOCL "_RMPO("NAME"),!
"RTN","RMPOPED",148,0)
 K DIR S DIR(0)="Y",DIR("B")="NO"
"RTN","RMPOPED",149,0)
 S DIR("A")="Should I change this patient's HOCL to "_RMPO("NAME")
"RTN","RMPOPED",150,0)
 D ^DIR Q:$$QUIT!(Y=0)
"RTN","RMPOPED",151,0)
 D SET
"RTN","RMPOPED",152,0)
 Q
"RTN","RMPOPED",153,0)
SET ;
"RTN","RMPOPED",154,0)
 K DIE,DR,DA
"RTN","RMPOPED",155,0)
 S DA=RMPODFN
"RTN","RMPOPED",156,0)
 ;W "HERE,RMPOXITE=",RMPOXITE
"RTN","RMPOPED",157,0)
 S DIE="^RMPR(665,",DR="19.12////"_RMPOXITE D ^DIE
"RTN","RMPOPED",158,0)
 Q
"RTN","RMPOPED",159,0)
 ;
"RTN","RMPOPED",160,0)
DEMOG ;First edit the patient's basic fields
"RTN","RMPOPED",161,0)
 ;
"RTN","RMPOPED",162,0)
 K DIE,DR,DA
"RTN","RMPOPED",163,0)
 S DA=RMPODFN
"RTN","RMPOPED",164,0)
 S DIE="^RMPR(665,",DR="19.1" D ^DIE Q:$$EQUIT
"RTN","RMPOPED",165,0)
 S RMPOELIG=$P($G(^RMPR(665,RMPODFN,"RMPOA")),U)
"RTN","RMPOPED",166,0)
 K DR S DR="19.11"_$S(RMPOELIG="D":"",1:"///@")_";19.12"
"RTN","RMPOPED",167,0)
 D ^DIE Q:$$EQUIT
"RTN","RMPOPED",168,0)
 K DR S Y=DT X ^DD("DD") S DR="19.2//"_Y D ^DIE Q:$$QUIT
"RTN","RMPOPED",169,0)
 Q
"RTN","RMPOPED",170,0)
 ;
"RTN","RMPOPED",171,0)
RX ;Edit the Rx Data
"RTN","RMPOPED",172,0)
 ;
"RTN","RMPOPED",173,0)
 N RXD,RXDI
"RTN","RMPOPED",174,0)
 K DIC,DIE,DA,DR
"RTN","RMPOPED",175,0)
 S DIC="^RMPR(665,"_RMPODFN_",""RMPOB"",",DIC(0)="AEQLZ"
"RTN","RMPOPED",176,0)
 S DA(1)=RMPODFN,DIC("P")="665.193D"
"RTN","RMPOPED",177,0)
 S RXD=$O(^RMPR(665,DA(1),"RMPOB","B",""),-1) D:RXD
"RTN","RMPOPED",178,0)
 . S DIC("B")=$$FMTE^XLFDT(RXD)
"RTN","RMPOPED",179,0)
 D ^DIC Q:Y<0!$$QUIT
"RTN","RMPOPED",180,0)
 S DIE=DIC,DA=+Y,DR=".01;2//^D EXPIRE^RMPOBIL4;3" D ^DIE Q:$$EQUIT
"RTN","RMPOPED",181,0)
 Q
"RTN","RMPOPED",182,0)
 ;
"RTN","RMPOPED",183,0)
ITEM ;Add/Edit Items
"RTN","RMPOPED",184,0)
 ;
"RTN","RMPOPED",185,0)
 ; Display items
"RTN","RMPOPED",186,0)
 D ITEMD
"RTN","RMPOPED",187,0)
 ; If no items on file, then only allow ADD PRIMARY ITEM
"RTN","RMPOPED",188,0)
 I '$D(IEN) D ITEMP Q:QUIT!(ITEM="")  G ITEM
"RTN","RMPOPED",189,0)
 ; ask for ACTION, quit if <return>, timeout, etc
"RTN","RMPOPED",190,0)
 S ITMACT=$$ITEMO Q:$$QUIT!(ITMACT="")
"RTN","RMPOPED",191,0)
 ; if they entered 'A', do ADD ITEM, then edit it
"RTN","RMPOPED",192,0)
 I ITMACT="A" D ITEMA Q:QUIT!(ITEM="")  D ITEME Q:QUIT  G ITEM
"RTN","RMPOPED",193,0)
 ; if they entered 'D', select an item, then delete it
"RTN","RMPOPED",194,0)
 I ITMACT="D" D ITEMS Q:QUIT!(ITEM="")  D ITEMK G ITEM
"RTN","RMPOPED",195,0)
 ; if they entered 'E', select an item, then edit it
"RTN","RMPOPED",196,0)
 I ITMACT="E" D ITEMS Q:QUIT!(ITEM="")  D ITEME Q:QUIT  G ITEM
"RTN","RMPOPED",197,0)
 G ITEM
"RTN","RMPOPED",198,0)
 Q
"RTN","RMPOPED",199,0)
ITEMP ; Add Primary Item
"RTN","RMPOPED",200,0)
 W !!,$C(7)_"No items found, please enter PRIMARY ITEM",!
"RTN","RMPOPED",201,0)
 D ITEMA Q:QUIT!(ITEM="")
"RTN","RMPOPED",202,0)
 S PI="///Y" D ITEME K PI
"RTN","RMPOPED",203,0)
 Q
"RTN","RMPOPED",204,0)
ITEMA ; Add Items
"RTN","RMPOPED",205,0)
 S ITEM=""
"RTN","RMPOPED",206,0)
 K DIC S DIC="^RMPR(661,",DIC(0)="AEQMZ" D ^DIC Q:Y<0!$$QUIT
"RTN","RMPOPED",207,0)
 K DD,DO,DA,DIC
"RTN","RMPOPED",208,0)
 S DIC="^RMPR(665,"_RMPODFN_",""RMPOC"",",DIC(0)="L"
"RTN","RMPOPED",209,0)
 S DIC("P")=$P(^DD(665,19.4,0),U,2),DA(1)=RMPODFN,X=+Y
"RTN","RMPOPED",210,0)
 D FILE^DICN I Y>0 S IEN=$G(IEN)+1,IEN(IEN)=+Y,ITEM=IEN
"RTN","RMPOPED",211,0)
 Q
"RTN","RMPOPED",212,0)
ITEMS ; Select Item
"RTN","RMPOPED",213,0)
 ; Return ITEM = index into both ITEMS and IEN arrays
"RTN","RMPOPED",214,0)
 I IEN=1 S ITEM=1 W "  ",$E(ITEMS(1),1,33) Q
"RTN","RMPOPED",215,0)
 K DIR
"RTN","RMPOPED",216,0)
 S ITEM=""
"RTN","RMPOPED",217,0)
 S DIR(0)="NO^1:"_IEN,DIR("A")="Select an ITEM"
"RTN","RMPOPED",218,0)
 S DIR("?")="Select an item from the list"
"RTN","RMPOPED",219,0)
 M DIR("?")=ITEMS
"RTN","RMPOPED",220,0)
 D ^DIR Q:Y'>0!$$QUIT
"RTN","RMPOPED",221,0)
 S ITEM=+Y W "  ",$E(ITEMS(ITEM),1,33)
"RTN","RMPOPED",222,0)
 Q
"RTN","RMPOPED",223,0)
ITEME ; Edit an Item
"RTN","RMPOPED",224,0)
 N FCP,DFCP,RMCPTHCP,RMCPRENT K DIE,DA,DR,RMCPT
"RTN","RMPOPED",225,0)
 S DA(1)=RMPODFN,DA=IEN(ITEM),DIE="^RMPR(665,"_DA(1)_",""RMPOC"","
"RTN","RMPOPED",226,0)
 D ITEMEP Q:QUIT
"RTN","RMPOPED",227,0)
 S DR=".01R;6R" D ^DIE Q:$$EQUIT!('$D(DA))
"RTN","RMPOPED",228,0)
 S RMCPTHCP=$P($G(^RMPR(665,RMPODFN,"RMPOC",DA,0)),U,7)
"RTN","RMPOPED",229,0)
 S RMCPT=$P($G(^RMPR(661.1,RMCPTHCP,4)),U,1) S DR=""
"RTN","RMPOPED",230,0)
 S RMCPRENT=$P($G(^RMPR(661.1,RMCPTHCP,5)),U,1)
"RTN","RMPOPED",231,0)
 I RMCPT["RR",(RMCPRENT=1) S DR="11;"
"RTN","RMPOPED",232,0)
 I RMCPT["QH" S DR=DR_"12;"
"RTN","RMPOPED",233,0)
 S DR=DR_"1R;2R;3R;4;7;8;9R" K RMCPRENT,RMCPTHCP
"RTN","RMPOPED",234,0)
 D ^DIE I $D(DA),$D(RMCPT),(RMCPT'["RR") S $P(^RMPR(665,DA(1),"RMPOC",DA,0),U,12)=""
"RTN","RMPOPED",235,0)
 I $D(DA),$D(RMCPT),(RMCPT'["QH") S $P(^RMPR(665,DA(1),"RMPOC",DA,0),U,13)=""
"RTN","RMPOPED",236,0)
 Q:$$EQUIT
"RTN","RMPOPED",237,0)
 ; Kludge to "point" to file 420
"RTN","RMPOPED",238,0)
 S DFCP=$P(^RMPR(665,RMPODFN,"RMPOC",IEN(ITEM),0),U,6)
"RTN","RMPOPED",239,0)
 F  D  Q:(FCP>0)!QUIT
"RTN","RMPOPED",240,0)
 . S FCP=$$GETFCP^RMPOBILU(DFCP) Q:QUIT
"RTN","RMPOPED",241,0)
 . I FCP<0 W $C(7)_"REQUIRED FIELD!"
"RTN","RMPOPED",242,0)
 I FCP>0 S DR="5///"_$P(FCP,U,2) D ^DIE Q:$$EQUIT
"RTN","RMPOPED",243,0)
 ; End Kludge
"RTN","RMPOPED",244,0)
 ;S DR="7:9" D ^DIE Q:$$EQUIT
"RTN","RMPOPED",245,0)
 Q
"RTN","RMPOPED",246,0)
ITEMEP ; Primary Item edit...
"RTN","RMPOPED",247,0)
 N PIEN,PFLG,RMDA,RMNO
"RTN","RMPOPED",248,0)
 S RMDA=DA,DR="10" D ^DIE Q:$$QUIT
"RTN","RMPOPED",249,0)
 I $P(^RMPR(665,RMPODFN,"RMPOC",RMDA,0),U,11)'="Y" Q
"RTN","RMPOPED",250,0)
 ; Logic to control toggling of Primary Item flag...
"RTN","RMPOPED",251,0)
 S RMNO="N"
"RTN","RMPOPED",252,0)
 F RMX=0:0 S RMX=$O(^RMPR(665,RMPODFN,"RMPOC",RMX)) Q:RMX'>0  D
"RTN","RMPOPED",253,0)
 . Q:RMDA=RMX
"RTN","RMPOPED",254,0)
 . S DA=RMX,DR="10///^S X=RMNO" D ^DIE
"RTN","RMPOPED",255,0)
 S DA=RMDA
"RTN","RMPOPED",256,0)
 Q
"RTN","RMPOPED",257,0)
PIEN(DFN) ; FIND PRIMARY ITEM
"RTN","RMPOPED",258,0)
 ; RETURN IEN OF P.I. IN MULTIPLE ^ IEN IN FILE 661
"RTN","RMPOPED",259,0)
 N X,PIEN
"RTN","RMPOPED",260,0)
 S X=0,PIEN=0
"RTN","RMPOPED",261,0)
 F  S X=$O(^RMPR(665,DFN,"RMPOC",X)) Q:X'>0  D  Q:PIEN
"RTN","RMPOPED",262,0)
 . S:$P(^RMPR(665,DFN,"RMPOC",X,0),U,11)="Y" PIEN=X
"RTN","RMPOPED",263,0)
 S:PIEN PIEN=PIEN_U_$P(^RMPR(665,DFN,"RMPOC",PIEN,0),U,1)
"RTN","RMPOPED",264,0)
 Q PIEN
"RTN","RMPOPED",265,0)
ITEMD ; Display Items
"RTN","RMPOPED",266,0)
 N I,Z,PIF,ITMNM,VDRNM
"RTN","RMPOPED",267,0)
 K IEN,ITEMS S I=0
"RTN","RMPOPED",268,0)
 Q:$O(^RMPR(665,RMPODFN,"RMPOC",0))'>0
"RTN","RMPOPED",269,0)
 W !!,"The following items are already in this patient's template:",!
"RTN","RMPOPED",270,0)
 F IEN=1:1 S I=$O(^RMPR(665,RMPODFN,"RMPOC",I)) Q:I'>0  D
"RTN","RMPOPED",271,0)
 . S Z=^RMPR(665,RMPODFN,"RMPOC",I,0)
"RTN","RMPOPED",272,0)
 . S PIF=$S($P(Z,U,11)="Y":"*",1:" ")
"RTN","RMPOPED",273,0)
 . S ITMNM=$$ITEMNM($P(Z,U)),VDRNM=$$VDRNM($P(Z,U,2))
"RTN","RMPOPED",274,0)
 .; K X S IENS=$P(Z,U)_","
"RTN","RMPOPED",275,0)
 .; D GETS^DIQ(661,IENS,.01,"","X") S ITMNM=$E(X(661,IENS,.01),1,33)
"RTN","RMPOPED",276,0)
 .; S IENS=$P(Z,U,2)_",",VDRNM="<< VENDOR NOT DEFINED >>"
"RTN","RMPOPED",277,0)
 .; I IENS'="," D GETS^DIQ(440,IENS,.01,"","X") S VDRNM=X(440,IENS,.01)
"RTN","RMPOPED",278,0)
 . S IEN(IEN)=I
"RTN","RMPOPED",279,0)
 . S ITEMS(IEN)=" "_PIF_$J(IEN,4)_"  "_$$LJ(ITMNM,38)_$E(VDRNM,1,30)
"RTN","RMPOPED",280,0)
 . W !,ITEMS(IEN)
"RTN","RMPOPED",281,0)
 W !!," * = Primary Item",!
"RTN","RMPOPED",282,0)
 S IEN=IEN-1
"RTN","RMPOPED",283,0)
 Q
"RTN","RMPOPED",284,0)
ITEMNM(ITM) ; RETURN ITEM NAME
"RTN","RMPOPED",285,0)
 S IENS=ITM_","
"RTN","RMPOPED",286,0)
 D GETS^DIQ(661,IENS,.01,"","X")
"RTN","RMPOPED",287,0)
 Q $E(X(661,IENS,.01),1,33)
"RTN","RMPOPED",288,0)
VDRNM(VDR) ; RETURN VENDOR NAME
"RTN","RMPOPED",289,0)
 I VDR="" Q "<< VENDOR NOT DEFINED >>"
"RTN","RMPOPED",290,0)
 S IENS=VDR_"," D GETS^DIQ(440,IENS,.01,"","X")
"RTN","RMPOPED",291,0)
 Q X(440,IENS,.01)
"RTN","RMPOPED",292,0)
ITEMK ; Delete an Item
"RTN","RMPOPED",293,0)
 ;
"RTN","RMPOPED",294,0)
 K DIR S DIR(0)="Y",DIR("A")="Are you SURE you want to delete this item"
"RTN","RMPOPED",295,0)
 S DIR("B")="NO" D ^DIR Q:Y'>0
"RTN","RMPOPED",296,0)
 K DIK,DA
"RTN","RMPOPED",297,0)
 S DA(1)=RMPODFN,DA=IEN(ITEM),DIK="^RMPR(665,"_DA(1)_",""RMPOC"","
"RTN","RMPOPED",298,0)
 D ^DIK W "  ...deleted!"
"RTN","RMPOPED",299,0)
 Q
"RTN","RMPOPED",300,0)
ITEMO() ; Choose Option
"RTN","RMPOPED",301,0)
 K DIR
"RTN","RMPOPED",302,0)
 S DIR(0)="SBO^A:Add;D:Delete;E:Edit",DIR("A")="Select ACTION" D ^DIR
"RTN","RMPOPED",303,0)
 Q Y
"RTN","RMPOPED",304,0)
 Q
"RTN","RMPR4C21")
0^8^B14352551^B13266518
"RTN","RMPR4C21",1,0)
RMPR4C21 ;PHX/HNB-CANCEL A PURCHASE CARD TRANSACTION;3/1/1996
"RTN","RMPR4C21",2,0)
 ;;3.0;PROSTHETICS;**3,20,62,140**;Feb 09, 1996;Build 10
"RTN","RMPR4C21",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RMPR4C21",4,0)
 ;RVD patch #62 - pce interface
"RTN","RMPR4C21",5,0)
 ;
"RTN","RMPR4C21",6,0)
EN ;entry point for Cancel a Transaction Option
"RTN","RMPR4C21",7,0)
 D DIV4^RMPRSIT G:$D(X) EXIT
"RTN","RMPR4C21",8,0)
 W !!,"You may also make a selection by Purchase Card Transaction"
"RTN","RMPR4C21",9,0)
 W !,"(Example, PC number), or Bank Authorization Number (6 digit number).",!
"RTN","RMPR4C21",10,0)
 S DIC("A")="Select PATIENT: "
"RTN","RMPR4C21",11,0)
 S DIC("S")="I $D(^(4)) I ('$P(^(0),U,8)&'$P(^(0),U,5)),($P(^(0),U,14)=RMPR(""STA""))"
"RTN","RMPR4C21",12,0)
 S DIC="^RMPR(664,",DIC(0)="AEQMN",DIC("W")="D EN2^RMPR4D1"
"RTN","RMPR4C21",13,0)
 D ^DIC G:Y<0 EXIT S RMPRA=+Y K R90
"RTN","RMPR4C21",14,0)
CL S B2=^RMPR(664,RMPRA,0) G:$P(B2,U,8) M4 G:$P(B2,U,5) M6
"RTN","RMPR4C21",15,0)
 L +^RMPR(664,RMPRA,0):1 I $T=0 W !,?5,$C(7),"Someone else is Editing this entry!" G EXIT
"RTN","RMPR4C21",16,0)
 K DIC,Y,DA S X=$P(B2,U,7),DIC=424,DIC(0)="MZ"
"RTN","RMPR4C21",17,0)
 D ^DIC S $P(B2,U,7)=+Y
"RTN","RMPR4C21",18,0)
 S RMPRDFN=$P(^RMPR(664,RMPRA,0),U,2),RMPRWO=$P(^(0),U,15),RMPRDA=$P(^(0),U,17)
"RTN","RMPR4C21",19,0)
 S DFN=RMPRDFN D DEM^VADPT
"RTN","RMPR4C21",20,0)
 S RMPRSSNE=VA("PID")
"RTN","RMPR4C21",21,0)
 D ^RMPR4LI
"RTN","RMPR4C21",22,0)
A W !!,"Do you really want to CANCEL this Transaction" S %=0 D YN^DICN G:%<0!(%=2) EXIT G:%=0 H
"RTN","RMPR4C21",23,0)
 ;call IFCAP to cancel
"RTN","RMPR4C21",24,0)
 S X=1
"RTN","RMPR4C21",25,0)
 S RMPR442=$P($G(^RMPR(664,RMPRA,4)),U,6)
"RTN","RMPR4C21",26,0)
 I RMPR442="" G BYPASS
"RTN","RMPR4C21",27,0)
 I $P($G(^PRC(442,RMPR442,7)),U)=45 W !!,"Purchase Card CANCELLED in IFCAP, will cancel open Pros PC order, hit return" R X:10 G BYPASS
"RTN","RMPR4C21",28,0)
 D CAN^PRCH7B(.X,RMPRA,RMPR442,0)
"RTN","RMPR4C21",29,0)
 I X="^" W !!,"NOT CANCELED You must say YES to 'Approve and print Amendment number'" G EXIT
"RTN","RMPR4C21",30,0)
 K RMPR442,X
"RTN","RMPR4C21",31,0)
BYPASS S RMPRAR=$S($P(^RMPR(664,RMPRA,0),U,12)'="":$P(^(0),U,12),1:""),$P(^(0),U,12)=""
"RTN","RMPR4C21",32,0)
 D:RMPRAR'="" K660
"RTN","RMPR4C21",33,0)
 Q:$G(RMPRA)'>0
"RTN","RMPR4C21",34,0)
 S R1=0 F  S R1=$O(^RMPR(664,RMPRA,1,R1)) Q:R1'>0  S RMPRAR=$S($P(^RMPR(664,RMPRA,1,R1,0),U,13)'="":$P(^(0),U,13),1:""),$P(^(0),U,13)="" G:RMPRAR="" M3 D K660
"RTN","RMPR4C21",35,0)
C58 ;CLOSE OUT
"RTN","RMPR4C21",36,0)
 I $D(RMPRWO),RMPRWO D  D CA0^RMPR29M(RMPRDA,RMPRA)
"RTN","RMPR4C21",37,0)
 .S $P(^RMPR(664.2,RMPRWO,0),U,16,17)="" F DA=0:0 S DA=$O(^RMPR(664.2,RMPRWO,1,"AC",RMPRA,DA)) Q:DA'>0  S DIK="^RMPR(664.2,"_RMPRWO_",1,",DA(1)=RMPRWO D ^DIK
"RTN","RMPR4C21",38,0)
 ;
"RTN","RMPR4C21",39,0)
 G K664
"RTN","RMPR4C21",40,0)
K660 ;DELETE APPLIANCE/REPAIR RECORDS
"RTN","RMPR4C21",41,0)
 D SS660 Q:$G(RMPRAR)'>0
"RTN","RMPR4C21",42,0)
 ;modified by #62
"RTN","RMPR4C21",43,0)
 ;call pce delete if patient encounter was recorded
"RTN","RMPR4C21",44,0)
 I $D(^RMPR(660,RMPRAR,10)),$P(^RMPR(660,RMPRAR,10),U,12) D
"RTN","RMPR4C21",45,0)
 .S RMCHK=0
"RTN","RMPR4C21",46,0)
 .S RMCHK=$$PCED^RMPRPCEP(RMPRAR)
"RTN","RMPR4C21",47,0)
 S DA=RMPRAR,DIK="^RMPR(660," D ^DIK W "."
"RTN","RMPR4C21",48,0)
 K RMPRAR
"RTN","RMPR4C21",49,0)
 Q
"RTN","RMPR4C21",50,0)
SS660 ;
"RTN","RMPR4C21",51,0)
 ;
"RTN","RMPR4C21",52,0)
 Q
"RTN","RMPR4C21",53,0)
K664 ;CANCEL FLAG
"RTN","RMPR4C21",54,0)
 S $P(^RMPR(664,RMPRA,0),"^",5)=DT,$P(^RMPR(664,RMPRA,2),"^",2)=DUZ
"RTN","RMPR4C21",55,0)
 S DA=RMPRA,DR="3.1",DIE="^RMPR(664," D ^DIE
"RTN","RMPR4C21",56,0)
 W !,$C(7),$C(7),"Transaction Canceled and Deleted..." H 2 D LINK^RMPRS
"RTN","RMPR4C21",57,0)
 ;
"RTN","RMPR4C21",58,0)
EXIT L:$D(RMPRA) -^RMPR(664,RMPRA,0)
"RTN","RMPR4C21",59,0)
 N RMPR,RMPRSITE D KILL^XUSCLEAN
"RTN","RMPR4C21",60,0)
 K LINE,RMPRAMIS,RMPRA,RMPRAR,RMPRCNT
"RTN","RMPR4C21",61,0)
 K RMPRI,RMPRIT,RMPRIT1,RMPRU,RMPRX,X,PRCS,DIE,PRCSX,RMPRDFN,RMPRNAM
"RTN","RMPR4C21",62,0)
 K RMPRSSN,DR,PRC,RMPRC,DIC,DIK,%,R1,DA,B2,RMPRCK,DIC
"RTN","RMPR4C21",63,0)
 K DIK,I,Y,RAC,R90,RMPRN,^TMP($J)
"RTN","RMPR4C21",64,0)
 Q
"RTN","RMPR4C21",65,0)
H W !,"By entering Yes, will Delete the transaction in Prosthetics." G A
"RTN","RMPR4C21",66,0)
H2 W !,"By entering Yes, will Cancel the Transaction , and NOT UPDATE the 10-2319." G M3A
"RTN","RMPR4C21",67,0)
M3 W !,$C(7),$C(7),"TRANSACTION MISSING APPLIANCE/REPAIR RECORD!"
"RTN","RMPR4C21",68,0)
M3A W !,"Do you still want to CANCEL this Transaction" S %=0 D YN^DICN G:%<0!(%=2) EXIT G:%=0 H2 G C58
"RTN","RMPR4C21",69,0)
M4 W !,$C(7),$C(7),"This Transacion has already been Closed!" G EXIT
"RTN","RMPR4C21",70,0)
M6 W !,$C(7),$C(7),"This transaction has already been Canceled!" G EXIT
"RTN","RMPR4LOP")
0^2^B22111692^B20891011
"RTN","RMPR4LOP",1,0)
RMPR4LOP ;PHX/HNB - LIST OPEN PURCHASE CARD TRANSACTIONS ;3/1/1996
"RTN","RMPR4LOP",2,0)
 ;;3.0;PROSTHETICS;**3,20,140**;Feb 09, 1996;Build 10
"RTN","RMPR4LOP",3,0)
 ;sort by originator, assistance from Long Beach PVB
"RTN","RMPR4LOP",4,0)
 W !,"This report lists Open Purchase Card Transactions created in the"
"RTN","RMPR4LOP",5,0)
 W !,"Prosthetics Package."
"RTN","RMPR4LOP",6,0)
 W !!,"This report is sorted by Transaction Date and Initiator.",!
"RTN","RMPR4LOP",7,0)
 W !,"The PC # column is the abbreviated Purchase Card Transaction Number,"
"RTN","RMPR4LOP",8,0)
 W !,"Example:  644-PC546, would display as 546.",!!
"RTN","RMPR4LOP",9,0)
START K ^TMP($J) D DIV4^RMPRSIT G:$D(X) EX S RMPRCOUN=0 D HOME^%ZIS W !! S %DT("A")="Starting Date: ",%DT="AEPX" D ^%DT S RMPRBDT=Y G:Y<0 EX
"RTN","RMPR4LOP",10,0)
 S %DT("A")="Ending Date: ",%DT="AEX" D ^%DT G:Y<0 EX I RMPRBDT>Y W !,$C(7),"Invalid Date Range Selection!!" G START
"RTN","RMPR4LOP",11,0)
 S RMPREDT=Y,Y=RMPRBDT D DD^%DT S RMPRX=Y,Y=RMPREDT D DD^%DT S RMPRY=Y
"RTN","RMPR4LOP",12,0)
 S %ZIS="MQ" K IOP D ^%ZIS G:POP EX
"RTN","RMPR4LOP",13,0)
 I '$D(IO("Q")) U IO G PRINT
"RTN","RMPR4LOP",14,0)
 S ZTDESC="OPEN 2421PC TRANSACTIONS",ZTRTN="PRINT^RMPR4LOP",ZTSAVE("RMPRBDT")="",ZTSAVE("RMPREDT")="",ZTSAVE("RMPRX")="",ZTSAVE("RMPRY")="",ZTSAVE("RMPR(")=""
"RTN","RMPR4LOP",15,0)
 D ^%ZTLOAD W:$D(ZTSK) !,"REQUEST QUEUED!" H 1 G EX
"RTN","RMPR4LOP",16,0)
PRINT S X1=RMPRBDT,X2=-1 D C^%DTC S RO=X,RP=0,PAGE=1,RMPRCOUN=0,INIC="",RMPREND="" I IOST["C-" D WAIT^DICD
"RTN","RMPR4LOP",17,0)
 F  S RO=$O(^RMPR(664,"B",RO)) Q:RO'>0  Q:RO>RMPREDT  F  S RP=$O(^RMPR(664,"B",RO,RP)) Q:RP'>0  D CK
"RTN","RMPR4LOP",18,0)
 S (RP,RMPROBL,CNT)=""
"RTN","RMPR4LOP",19,0)
 F  S RMPROBL=$O(^TMP($J,RMPROBL)) Q:RMPROBL'>0  Q:RMPREND=1  D  I RMPREND'=1 W !,?71,"=========",!,?65,"Total ",$J($FN(CNT,"P",2),9) S CNT=0 H 1
"RTN","RMPR4LOP",20,0)
 .F  S RP=$O(^TMP($J,RMPROBL,RP)) Q:RP'>0  Q:RMPREND=1  S INIB=$P(^VA(200,$P(^RMPR(664,RP,0),U,9),0),U,1) D WRI
"RTN","RMPR4LOP",21,0)
 I $D(RMPREDT)&(RMPRCOUN=0) W @IOF D HDR W $C(7),!!,"NO SELECTIONS MADE DURING THIS DATE RANGE!!"
"RTN","RMPR4LOP",22,0)
 ;
"RTN","RMPR4LOP",23,0)
EXIT I $E(IOST)["C"&($Y<20) F  W ! Q:$Y>20
"RTN","RMPR4LOP",24,0)
 I $D(RMPREDT),'$D(DTOUT),'$D(DUOUT),$E(IOST)["C",'$D(RMPRFLL),RMPREND'=1 S DIR(0)="E" D ^DIR
"RTN","RMPR4LOP",25,0)
EX K RMPREND,RMPROBL,RMPRFLL,RMPRFLG,DUOUT,DIR,RO,RP,RMPRY,RMPRCOUN,RMPRX,RMPRBDT,RMPREDT,RMPRCK,%DT,X,Y,PAGE,IT,ZTSK,^TMP($J),PRCIEN D ^%ZISC
"RTN","RMPR4LOP",26,0)
 K CNT,DTOUT,ROBL,X1,X2,RMPR,%ZIS,INIC,INIB
"RTN","RMPR4LOP",27,0)
 Q
"RTN","RMPR4LOP",28,0)
CK ;check record, apply screen
"RTN","RMPR4LOP",29,0)
 Q:'$D(^RMPR(664,RP,0))
"RTN","RMPR4LOP",30,0)
 ;vendor, purchase card, cancelation date, close-out date
"RTN","RMPR4LOP",31,0)
 Q:$P(^RMPR(664,RP,0),U,4)=""!($P($G(^(4)),U,1)="")!($P(^(0),U,5)'="")!($P(^(0),U,8)'="")
"RTN","RMPR4LOP",32,0)
 Q:$P(^RMPR(664,RP,0),U,14)'=""&($P(^(0),U,14)'=RMPR("STA"))
"RTN","RMPR4LOP",33,0)
 S RMPROBL=$P(^RMPR(664,RP,0),U,9)
"RTN","RMPR4LOP",34,0)
 Q:'RMPROBL
"RTN","RMPR4LOP",35,0)
 S ^TMP($J,RMPROBL,RP)="",RMPRCOUN=RMPRCOUN+1
"RTN","RMPR4LOP",36,0)
 Q
"RTN","RMPR4LOP",37,0)
WRI I '$D(RMPRFLG)!(INIC'=INIB) D HDR W !,"Initiator: ",INIB,!,"Patient",?14,"SSN",?19,"Purchase Card",?36,"Date",?43,"PC #",?50,"Vendor",?62,"Item",?70,"Item Cost",!,RMPR("L")
"RTN","RMPR4LOP",38,0)
 W !,$E($P(^DPT($P(^RMPR(664,RP,0),U,2),0),U,1),1,12)
"RTN","RMPR4LOP",39,0)
 W ?14,$E($P(^DPT($P(^RMPR(664,RP,0),U,2),0),U,9),6,9)
"RTN","RMPR4LOP",40,0)
 W ?19
"RTN","RMPR4LOP",41,0)
 I DUZ=$P(^RMPR(664,RP,0),U,9)!($D(^XUSEC("RMPR FCP MANAGER",DUZ))) W $$DEC^RMPR4LI($P(^RMPR(664,RP,4),U,1),$P(^RMPR(664,RP,0),U,9),RP)
"RTN","RMPR4LOP",42,0)
 E  W "encrypted"
"RTN","RMPR4LOP",43,0)
 S RD=$P(^RMPR(664,RP,0),U,1),PRCIEN=$P(^RMPR(664,RP,4),U,6)
"RTN","RMPR4LOP",44,0)
  S RD=$P(RD,"."),RD=$E(RD,4,5)_"/"_$E(RD,6,7)
"RTN","RMPR4LOP",45,0)
 W ?36,RD I PRCIEN,($P($G(^PRC(442,PRCIEN,7)),U)=45) W "#"
"RTN","RMPR4LOP",46,0)
 W ?43,$P(^RMPR(664,RP,4),U,5)
"RTN","RMPR4LOP",47,0)
 W ?50
"RTN","RMPR4LOP",48,0)
 W:+$P(^RMPR(664,RP,0),U,4) $E($P(^PRC(440,$P(^RMPR(664,RP,0),U,4),0),U,1),1,10)
"RTN","RMPR4LOP",49,0)
 D ITE
"RTN","RMPR4LOP",50,0)
 S INIC=INIB
"RTN","RMPR4LOP",51,0)
 Q
"RTN","RMPR4LOP",52,0)
ITE I '$D(^RMPR(664,RP,1))&($P(^RMPR(664,RP,0),U,12)) W ?61,"*DELIVERY",?71,$J($FN($P(^RMPR(660,$P(^RMPR(664,RP,0),U,12),0),U,16),"P",2),9) S RMPRFLG=1
"RTN","RMPR4LOP",53,0)
 I  S CNT=CNT+$P(^RMPR(660,$P(^RMPR(664,RP,0),U,12),0),U,16) D:$Y>(IOSL-6) HDR Q
"RTN","RMPR4LOP",54,0)
 I $P(^RMPR(664,RP,0),U,12)'="" W ?61,"*SHIPPING",?71,$J($FN($P(^RMPR(660,$P(^RMPR(664,RP,0),U,12),0),U,17),"P",2),9),!
"RTN","RMPR4LOP",55,0)
 I  S CNT=CNT+$P(^RMPR(660,$P(^RMPR(664,RP,0),U,12),0),U,17)
"RTN","RMPR4LOP",56,0)
 S (IT)=0
"RTN","RMPR4LOP",57,0)
 F  S IT=$O(^RMPR(664,RP,1,IT)) Q:IT'>0!($D(DUOUT))!($D(DTOUT))  W:IT>1 ! W ?61,$E($P(^PRC(441,$P(^RMPR(661,$P(^RMPR(664,RP,1,IT,0),U,1),0),U,1),0),U,2),1,10) Q:$P(^RMPR(664,RP,1,IT,0),U,13)=""  D COST
"RTN","RMPR4LOP",58,0)
 Q
"RTN","RMPR4LOP",59,0)
COST W ?71
"RTN","RMPR4LOP",60,0)
 W $J($FN($P(^RMPR(660,$P(^RMPR(664,RP,1,IT,0),U,13),0),U,16),"P",2),9)
"RTN","RMPR4LOP",61,0)
 S CNT=CNT+$P(^RMPR(660,$P(^RMPR(664,RP,1,IT,0),U,13),0),U,16)
"RTN","RMPR4LOP",62,0)
 S RMPRFLG=1
"RTN","RMPR4LOP",63,0)
 I $E(IOST)["C"&($Y>(IOSL-6)) W ! S DIR(0)="E" D ^DIR S:Y<1 RMPREND=1 Q:Y=""  S:Y<1 RMPRFLL=1 Q:Y<1  S:$D(DTOUT) RMPREND=1 Q:$D(DTOUT)  D HDR Q
"RTN","RMPR4LOP",64,0)
 I $Y>(IOSL-6) K RMPRFLG
"RTN","RMPR4LOP",65,0)
 Q
"RTN","RMPR4LOP",66,0)
 ;header
"RTN","RMPR4LOP",67,0)
 I $E(IOST)["C"&($Y<20) F  W ! Q:$Y>20
"RTN","RMPR4LOP",68,0)
 I INIC'=""!(PAGE'=1)&(INIC'=INIB)&($E(IOST)["C") S DIR(0)="E" D ^DIR
"RTN","RMPR4LOP",69,0)
HDR I PAGE'=1!($E(IOST)["C") W @IOF
"RTN","RMPR4LOP",70,0)
 I $E(IOST)["C" W @IOF G EXIT:X="^"
"RTN","RMPR4LOP",71,0)
 W !,RMPRX_"-",RMPRY," Open 2421PC Transactions     "_"STA "_$$STA^RMPRUTIL,?72,"PAGE ",PAGE,!,"# = PURCHASE CARD Order CANCELLED on IFCAP SYSTEM",! S PAGE=PAGE+1 Q
"RTN","RMPR4OPN")
0^1^B19109411^B17951150
"RTN","RMPR4OPN",1,0)
RMPR4OPN ;PHX/HNB - LIST OPEN PURCHASE CARD TRANSACTIONS ;3/1/1996
"RTN","RMPR4OPN",2,0)
 ;;3.0;PROSTHETICS;**3,20,140**;Feb 09, 1996;Build 10
"RTN","RMPR4OPN",3,0)
 W !,"This report lists Open Purchase Card Transactions created in the"
"RTN","RMPR4OPN",4,0)
 W !,"Prosthetics Package."
"RTN","RMPR4OPN",5,0)
 W !!
"RTN","RMPR4OPN",6,0)
START K ^TMP($J) D DIV4^RMPRSIT G:$D(X) EX S RMPRCOUN=0 D HOME^%ZIS W !! S %DT("A")="Starting Date: ",%DT="AEPX" D ^%DT S RMPRBDT=Y G:Y<0 EX
"RTN","RMPR4OPN",7,0)
 S %DT("A")="Ending Date: ",%DT="AEX" D ^%DT G:Y<0 EX I RMPRBDT>Y W !,$C(7),"Invalid Date Range Selection!!" G START
"RTN","RMPR4OPN",8,0)
 S RMPREDT=Y,Y=RMPRBDT D DD^%DT S RMPRX=Y,Y=RMPREDT D DD^%DT S RMPRY=Y
"RTN","RMPR4OPN",9,0)
 S %ZIS="MQ" K IOP D ^%ZIS G:POP EX
"RTN","RMPR4OPN",10,0)
 I '$D(IO("Q")) U IO G PRINT
"RTN","RMPR4OPN",11,0)
 S ZTDESC="OPEN 2421PC TRANSACTIONS",ZTRTN="PRINT^RMPR4OPN",ZTSAVE("RMPRBDT")="",ZTSAVE("RMPREDT")="",ZTSAVE("RMPRX")="",ZTSAVE("RMPRY")="",ZTSAVE("RMPR(""STA"")")=""
"RTN","RMPR4OPN",12,0)
 D ^%ZTLOAD W:$D(ZTSK) !,"REQUEST QUEUED!" H 1 G EX
"RTN","RMPR4OPN",13,0)
PRINT S X1=RMPRBDT,X2=-1 D C^%DTC S RO=X,RP=0,PAGE=1,RMPRCOUN=0,RMPREND="" I IOST["C-" D WAIT^DICD
"RTN","RMPR4OPN",14,0)
 F  S RO=$O(^RMPR(664,"B",RO)) Q:RO'>0  Q:RO>RMPREDT  F  S RP=$O(^RMPR(664,"B",RO,RP)) Q:RP'>0  D CK
"RTN","RMPR4OPN",15,0)
 S (RP,RMPROBL,CNT)="" F  S RMPROBL=$O(^TMP($J,RMPROBL)) Q:RMPROBL'>0  Q:RMPREND=1  F  S RP=$O(^TMP($J,RMPROBL,RP)) Q:RP'>0  Q:RMPREND=1  D WRI
"RTN","RMPR4OPN",16,0)
 I $D(RMPREDT)&(RMPRCOUN=0) W @IOF D HDR W $C(7),!!,"NO SELECTIONS MADE DURING THIS DATE RANGE!!"
"RTN","RMPR4OPN",17,0)
 I $D(RMPREDT),RMPRCOUN>0,RMPREND'=1 W !,?71,"=========",!,?65,"Total ",$J($FN(CNT,"P",2),9) H 1
"RTN","RMPR4OPN",18,0)
EXIT I $E(IOST)["C"&($Y<20) F  W ! Q:$Y>20
"RTN","RMPR4OPN",19,0)
 I $D(RMPREDT),'$D(DTOUT),'$D(DUOUT),$E(IOST)["C",'$D(RMPRFLL),RMPREND'=1 S DIR(0)="E" D ^DIR
"RTN","RMPR4OPN",20,0)
EX K RMPREND,RMPROBL,RMPRFLL,RMPRFLG,DUOUT,DIR,RO,RP,RMPRY,RMPRCOUN,RMPRX,RMPRBDT,RMPREDT,RMPRCK,%DT,X,Y,PAGE,IT,ZTSK,^TMP($J),PRCIEN D ^%ZISC
"RTN","RMPR4OPN",21,0)
 K CNT,DTOUT,ROBL,X1,X2,RMPR,%ZIS
"RTN","RMPR4OPN",22,0)
 Q
"RTN","RMPR4OPN",23,0)
CK ;check record, apply screen
"RTN","RMPR4OPN",24,0)
 Q:'$D(^RMPR(664,RP,0))
"RTN","RMPR4OPN",25,0)
 ;vendor, purchase card, cancelation date, close-out date
"RTN","RMPR4OPN",26,0)
 Q:$P(^RMPR(664,RP,0),U,4)=""!($P($G(^(4)),U,1)="")!($P(^(0),U,5)'="")!($P(^(0),U,8)'="")
"RTN","RMPR4OPN",27,0)
 Q:$P(^RMPR(664,RP,0),U,14)'=""&($P(^(0),U,14)'=RMPR("STA"))
"RTN","RMPR4OPN",28,0)
 S ROBL=$P($G(^RMPR(664,RP,4)),U,1)
"RTN","RMPR4OPN",29,0)
 S RMPROBL=$$DEC^RMPR4LI($P(^RMPR(664,RP,4),U,1),$P(^RMPR(664,RP,0),U,9),RP)
"RTN","RMPR4OPN",30,0)
 S ^TMP($J,RMPROBL,RP)="",RMPRCOUN=RMPRCOUN+1
"RTN","RMPR4OPN",31,0)
 Q
"RTN","RMPR4OPN",32,0)
WRI I '$D(RMPRFLG) D HDR W !,"Patient",?14,"SSN",?19,"Purchase Card",?36,"Date",?43,"PC #",?50,"Vendor",?62,"Item",?70,"Item Cost"
"RTN","RMPR4OPN",33,0)
 W !,$E($P(^DPT($P(^RMPR(664,RP,0),U,2),0),U,1),1,12)
"RTN","RMPR4OPN",34,0)
 W ?14,$E($P(^DPT($P(^RMPR(664,RP,0),U,2),0),U,9),6,9)
"RTN","RMPR4OPN",35,0)
 W ?19
"RTN","RMPR4OPN",36,0)
 I DUZ=$P(^RMPR(664,RP,0),U,9)!($D(^XUSEC("RMPR FCP MANAGER",DUZ))) W $$DEC^RMPR4LI($P(^RMPR(664,RP,4),U,1),$P(^RMPR(664,RP,0),U,9),RP)
"RTN","RMPR4OPN",37,0)
 E  W "encrypted"
"RTN","RMPR4OPN",38,0)
 S RD=$P(^RMPR(664,RP,0),U,1),PRCIEN=$P(^RMPR(664,RP,4),U,6)
"RTN","RMPR4OPN",39,0)
 S RD=$P(RD,"."),RD=$E(RD,4,5)_"/"_$E(RD,6,7)
"RTN","RMPR4OPN",40,0)
 W ?36,RD I PRCIEN,($P($G(^PRC(442,PRCIEN,7)),U)=45) W "#"
"RTN","RMPR4OPN",41,0)
 W ?43,$P(^RMPR(664,RP,4),U,5)
"RTN","RMPR4OPN",42,0)
 W ?50
"RTN","RMPR4OPN",43,0)
 W:+$P(^RMPR(664,RP,0),U,4) $E($P(^PRC(440,$P(^RMPR(664,RP,0),U,4),0),U,1),1,10)
"RTN","RMPR4OPN",44,0)
 D ITE
"RTN","RMPR4OPN",45,0)
 Q
"RTN","RMPR4OPN",46,0)
ITE I '$D(^RMPR(664,RP,1))&($P(^RMPR(664,RP,0),U,12)) W ?61,"*DELIVERY",?71,$J($FN($P(^RMPR(660,$P(^RMPR(664,RP,0),U,12),0),U,16),"P",2),9) S RMPRFLG=1
"RTN","RMPR4OPN",47,0)
 I  S CNT=CNT+$P(^RMPR(660,$P(^RMPR(664,RP,0),U,12),0),U,16) D:$Y>(IOSL-6) HDR Q
"RTN","RMPR4OPN",48,0)
 I $P(^RMPR(664,RP,0),U,12)'="" W ?61,"*SHIPPING",?71,$J($FN($P(^RMPR(660,$P(^RMPR(664,RP,0),U,12),0),U,17),"P",2),9),!
"RTN","RMPR4OPN",49,0)
 I  S CNT=CNT+$P(^RMPR(660,$P(^RMPR(664,RP,0),U,12),0),U,17)
"RTN","RMPR4OPN",50,0)
 S (IT)=0
"RTN","RMPR4OPN",51,0)
 F  S IT=$O(^RMPR(664,RP,1,IT)) Q:IT'>0!($D(DUOUT))!($D(DTOUT))  W:IT>1 ! W ?61,$E($P(^PRC(441,$P(^RMPR(661,$P(^RMPR(664,RP,1,IT,0),U,1),0),U,1),0),U,2),1,10) Q:$P(^RMPR(664,RP,1,IT,0),U,13)=""  D COST
"RTN","RMPR4OPN",52,0)
 Q
"RTN","RMPR4OPN",53,0)
COST W ?71
"RTN","RMPR4OPN",54,0)
 W $J($FN($P(^RMPR(660,$P(^RMPR(664,RP,1,IT,0),U,13),0),U,16),"P",2),9)
"RTN","RMPR4OPN",55,0)
 S CNT=CNT+$P(^RMPR(660,$P(^RMPR(664,RP,1,IT,0),U,13),0),U,16)
"RTN","RMPR4OPN",56,0)
 S RMPRFLG=1
"RTN","RMPR4OPN",57,0)
 I $E(IOST)["C"&($Y>(IOSL-6)) W ! S DIR(0)="E" D ^DIR S:Y<1 RMPREND=1 Q:Y=""  S:Y<1 RMPRFLL=1 Q:Y<1  S:$D(DTOUT) RMPREND=1 Q:$D(DTOUT)  D HDR Q
"RTN","RMPR4OPN",58,0)
 I $Y>(IOSL-6) K RMPRFLG
"RTN","RMPR4OPN",59,0)
 Q
"RTN","RMPR4OPN",60,0)
HDR I PAGE'=1!($E(IOST)["C") W @IOF
"RTN","RMPR4OPN",61,0)
 W !,RMPRX_"-",RMPRY," Open 2421PC Transactions     "_"STA "_$$STA^RMPRUTIL,?72,"PAGE ",PAGE,!,"# = PURCHASE CARD Order CANCELLED on IFCAP SYSTEM",! S PAGE=PAGE+1 Q
"RTN","RMPR8PG")
0^7^B6676473^B6481133
"RTN","RMPR8PG",1,0)
RMPR8PG ;PHX,HOIFO/JLT,SPS-PURGE 668 SUSPENSE FILE ;8/29/1994
"RTN","RMPR8PG",2,0)
 ;;3.0;PROSTHETICS;**5,75,140**;Feb 09, 1996;Build 10
"RTN","RMPR8PG",3,0)
 ;
"RTN","RMPR8PG",4,0)
 ;02/03/06 Added code to delete the pointer in 664.1 field .05 when a 
"RTN","RMPR8PG",5,0)
 ;record is purged.
"RTN","RMPR8PG",6,0)
 ;
"RTN","RMPR8PG",7,0)
EN D DIV4^RMPRSIT Q:$D(X)
"RTN","RMPR8PG",8,0)
EN2 K %ZIS,IOP,ZTIO S %ZIS="MQ",%ZIS("B")="" D ^%ZIS G:POP END
"RTN","RMPR8PG",9,0)
 ;I IOST["C-" W !,$C(7),"YOU MAY NOT SELECT YOUR TERMINAL" G EN2
"RTN","RMPR8PG",10,0)
 I $D(IO("Q")) S ZTRTN="EN1^RMPR8PG",ZTDESC="PURGE 668 SUSPENSE FILE" F RD="I","RMPRIEN","RMPRDT","ION","RMPR(","RMPRSITE" S ZTSAVE(RD)=""
"RTN","RMPR8PG",11,0)
 I $D(IO("Q")) K IO("Q") D ^%ZTLOAD W !,"<REQUEST QUEUED!>" G EXIT
"RTN","RMPR8PG",12,0)
EN1 S (I,RMPRIEN,RDEL)=0,RMPRDT=$P(^RMPR(669.9,RMPRSITE,0),U,8) G:RMPRDT'>89 END
"RTN","RMPR8PG",13,0)
 S X1=DT,X2=-RMPRDT D C^%DTC S RMPRDT=X I RMPRDT<$O(^RMPR(668,"B",""))!('$O(^RMPR(668,0))) G END
"RTN","RMPR8PG",14,0)
 S DIS(0)="I $P(^RMPR(668,D0,0),U,7)=RMPR(""STA"")",IOP=ION,DIC="^RMPR(668,",FLDS=".01;C1,1;C20;L17,2,3,6;C45;L15,5;C65,4;C1,7;C1",BY="5",FR=$S($D(^RMPR(668,"B")):$O(^RMPR(668,"B","")),1:2890101)
"RTN","RMPR8PG",15,0)
 S TO=RMPRDT,DHD="Purge Suspense File Entries from Station/Division "_RMPR("STA") D EN1^DIP
"RTN","RMPR8PG",16,0)
 N RMPR6641
"RTN","RMPR8PG",17,0)
 F  S RMPRIEN=$O(^RMPR(668,RMPRIEN)) Q:RMPRIEN'>0  I $P($G(^RMPR(668,RMPRIEN,0)),U,7)=RMPR("STA") I ($P(^RMPR(668,RMPRIEN,0),U,5))&($P(^(0),U,5)<RMPRDT) S DA=RMPRIEN,DIC="^RMPR(668," S DA=RMPRIEN,DIK=DIC D ^DIK D  S RDEL=RDEL+1
"RTN","RMPR8PG",18,0)
 . S RMPR6641=0 F  S RMPR6641=$O(^RMPR(664.1,"SUS",DA,RMPR6641)) Q:RMPR6641'>0  D
"RTN","RMPR8PG",19,0)
 .. I $D(^RMPR(664.1,RMPR6641,0)) S $P(^(0),U,8)=""
"RTN","RMPR8PG",20,0)
END I $G(RDEL)<1 W !!,"No Suspense entries purged."
"RTN","RMPR8PG",21,0)
 I $G(RDEL)>1 W !!,RDEL," Suspense entries purged."
"RTN","RMPR8PG",22,0)
 I $G(RDEL)=1 W !!,RDEL,"Suspense entry purged. "
"RTN","RMPR8PG",23,0)
EXIT ;common exit point
"RTN","RMPR8PG",24,0)
 K I,RD,X,DIS,%ZIS,X1,X2,RMPRIEN,RMPRDT,RMPR6641,RDEL,DIC,DIK,DA,RL,BY,DHD,DHIT,FLDS,FR,TO D ^%ZISC Q
"VER")
8.0^22.0
"BLD",6716,6)
^121
**END**
**END**
