Released RMPR*3*148 SEQ #124
Extracted from mail message
**KIDS**:RMPR*3.0*148^

**INSTALL NAME**
RMPR*3.0*148
"BLD",6991,0)
RMPR*3.0*148^PROSTHETICS^0^3080606^y
"BLD",6991,1,0)
^^2^2^3080606^
"BLD",6991,1,1,0)
1. Home Oxygen Billing Transaction editing error:
"BLD",6991,1,2,0)
      <UNDEFINED>COMMON+6^RMPOLM1
"BLD",6991,4,0)
^9.64PA^^
"BLD",6991,6.3)
1
"BLD",6991,"ABPKG")
n
"BLD",6991,"KRN",0)
^9.67PA^8989.52^19
"BLD",6991,"KRN",.4,0)
.4
"BLD",6991,"KRN",.401,0)
.401
"BLD",6991,"KRN",.402,0)
.402
"BLD",6991,"KRN",.403,0)
.403
"BLD",6991,"KRN",.5,0)
.5
"BLD",6991,"KRN",.84,0)
.84
"BLD",6991,"KRN",3.6,0)
3.6
"BLD",6991,"KRN",3.8,0)
3.8
"BLD",6991,"KRN",9.2,0)
9.2
"BLD",6991,"KRN",9.8,0)
9.8
"BLD",6991,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",6991,"KRN",9.8,"NM",1,0)
RMPOPED^^0^B86271815
"BLD",6991,"KRN",9.8,"NM","B","RMPOPED",1)

"BLD",6991,"KRN",19,0)
19
"BLD",6991,"KRN",19.1,0)
19.1
"BLD",6991,"KRN",101,0)
101
"BLD",6991,"KRN",409.61,0)
409.61
"BLD",6991,"KRN",771,0)
771
"BLD",6991,"KRN",870,0)
870
"BLD",6991,"KRN",8989.51,0)
8989.51
"BLD",6991,"KRN",8989.52,0)
8989.52
"BLD",6991,"KRN",8994,0)
8994
"BLD",6991,"KRN","B",.4,.4)

"BLD",6991,"KRN","B",.401,.401)

"BLD",6991,"KRN","B",.402,.402)

"BLD",6991,"KRN","B",.403,.403)

"BLD",6991,"KRN","B",.5,.5)

"BLD",6991,"KRN","B",.84,.84)

"BLD",6991,"KRN","B",3.6,3.6)

"BLD",6991,"KRN","B",3.8,3.8)

"BLD",6991,"KRN","B",9.2,9.2)

"BLD",6991,"KRN","B",9.8,9.8)

"BLD",6991,"KRN","B",19,19)

"BLD",6991,"KRN","B",19.1,19.1)

"BLD",6991,"KRN","B",101,101)

"BLD",6991,"KRN","B",409.61,409.61)

"BLD",6991,"KRN","B",771,771)

"BLD",6991,"KRN","B",870,870)

"BLD",6991,"KRN","B",8989.51,8989.51)

"BLD",6991,"KRN","B",8989.52,8989.52)

"BLD",6991,"KRN","B",8994,8994)

"BLD",6991,"QUES",0)
^9.62^^
"BLD",6991,"REQB",0)
^9.611^1^1
"BLD",6991,"REQB",1,0)
RMPR*3.0*140^2
"BLD",6991,"REQB","B","RMPR*3.0*140",1)

"MBREQ")
0
"PKG",101,-1)
1^1
"PKG",101,0)
PROSTHETICS^RMPR^PROSTHETICS VERSION 3.0 ALPHA
"PKG",101,20,0)
^9.402P^^0
"PKG",101,22,0)
^9.49I^1^1
"PKG",101,22,1,0)
3.0^2960209^2960214
"PKG",101,22,1,"PAH",1,0)
148^3080606
"PKG",101,22,1,"PAH",1,1,0)
^^2^2^3080606
"PKG",101,22,1,"PAH",1,1,1,0)
1. Home Oxygen Billing Transaction editing error:
"PKG",101,22,1,"PAH",1,1,2,0)
      <UNDEFINED>COMMON+6^RMPOLM1
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","RMPOPED")
0^1^B86271815^B85650773
"RTN","RMPOPED",1,0)
RMPOPED ;EDS/MDB,DDW,RVD - HOME OXYGEN MISC FILE EDITS ;7/24/98
"RTN","RMPOPED",2,0)
 ;;3.0;PROSTHETICS;**29,44,41,52,77,110,140,148**;Feb 09, 1996;Build 1
"RTN","RMPOPED",3,0)
 ;
"RTN","RMPOPED",4,0)
 ; HNC - patch 52
"RTN","RMPOPED",5,0)
 ;                 modified SITECHK sub
"RTN","RMPOPED",6,0)
 ;                 X will be undefined from GETS^DIQ if field is null
"RTN","RMPOPED",7,0)
 ;                 added $G.
"RTN","RMPOPED",8,0)
 ;RVD - patch #77  use Fileman to set items that are not Primary item
"RTN","RMPOPED",9,0)
 ;                 to 'N' in order to set correctly the 'AC' cross-ref.
"RTN","RMPOPED",10,0)
 Q
"RTN","RMPOPED",11,0)
UNLOCK I $D(RMPODFN) L -^RMPR(665,RMPODFN)
"RTN","RMPOPED",12,0)
 Q
"RTN","RMPOPED",13,0)
EXIT K DIC,DIE,DIR,DIK,X,Y,Z,DR,DA,DD,DO,D0,DTOUT,DIROUT,DUOUT,DIRUT,QUIT,DFN,ITEM,ITEMS,IEN,IENS,ITMACT,ITM,C,S,W,PI,VDR,ZST
"RTN","RMPOPED",14,0)
 D UNLOCK
"RTN","RMPOPED",15,0)
 Q
"RTN","RMPOPED",16,0)
 ;
"RTN","RMPOPED",17,0)
KEY ;user must have the RMPRSUPERVISOR key in order to add a new patient.
"RTN","RMPOPED",18,0)
 ;option name is EDIT HOME OXYGEN PATIENT
"RTN","RMPOPED",19,0)
 N KEY
"RTN","RMPOPED",20,0)
 S KEY=$O(^DIC(19.1,"B","RMPRSUPERVISOR",0))
"RTN","RMPOPED",21,0)
 I '$D(^VA(200,DUZ,51,KEY)) D  Q
"RTN","RMPOPED",22,0)
 . W !!,"You do not hold the RMPSUPERVISOR key!!"
"RTN","RMPOPED",23,0)
 G PAT
"RTN","RMPOPED",24,0)
 ;
"RTN","RMPOPED",25,0)
SITE ; Editing of Home Oxygen site parameter file.
"RTN","RMPOPED",26,0)
 K DIC,DIE,DA,DR,DD,RMPOXITE
"RTN","RMPOPED",27,0)
 S DIC="^RMPR(669.9,",DIC(0)="QEAMLZ",DIC("A")="Select SITE: "
"RTN","RMPOPED",28,0)
 D ^DIC Q:Y<0!$$QUIT
"RTN","RMPOPED",29,0)
 K DIC("A")
"RTN","RMPOPED",30,0)
 S (DA,RMPOXITE)=+Y
"RTN","RMPOPED",31,0)
 ; Lock it...
"RTN","RMPOPED",32,0)
 L +^RMPR(669.9,RMPOXITE):2
"RTN","RMPOPED",33,0)
 I '$T D  G SITE
"RTN","RMPOPED",34,0)
 . W ?10,$C(7)_Y(0,0)_" -- record in use. Try again later."
"RTN","RMPOPED",35,0)
 ; Edit it
"RTN","RMPOPED",36,0)
 S DIE=DIC,DR="60;61;62;65" D ^DIE Q:$$EQUIT
"RTN","RMPOPED",37,0)
 ; Edit FCP
"RTN","RMPOPED",38,0)
 K DIC,DA,DD,DR,DIE
"RTN","RMPOPED",39,0)
 ;
"RTN","RMPOPED",40,0)
 ; Done.  Unlock
"RTN","RMPOPED",41,0)
 L -^RMPR(669.9,RMPOXITE)
"RTN","RMPOPED",42,0)
 G SITE
"RTN","RMPOPED",43,0)
 ;
"RTN","RMPOPED",44,0)
FCPHLP ; Executable help for FCP multiple in 669.9
"RTN","RMPOPED",45,0)
 ;
"RTN","RMPOPED",46,0)
 Q
"RTN","RMPOPED",47,0)
FCPIX ; Input transform for FCP multiple in 669.9
"RTN","RMPOPED",48,0)
 ;
"RTN","RMPOPED",49,0)
 Q:'$D(X)
"RTN","RMPOPED",50,0)
 I $L(X)>30!($L(X)<3) K X Q
"RTN","RMPOPED",51,0)
 S ZST=$P(^RMPR(669.9,D0,4),U,1),RMPOX=X
"RTN","RMPOPED",52,0)
 D FIND^DIC(420.01,","_ZST_",",".01;","M",X,1,,,,"X")
"RTN","RMPOPED",53,0)
 S X=$S($D(X("DILIST","ID",1,.01)):X("DILIST","ID",1,.01),1:RMPOX)
"RTN","RMPOPED",54,0)
 K X("DILIST"),RMPOX
"RTN","RMPOPED",55,0)
 I $G(ZST),('$D(^PRC(420,+ZST,1,"B",X))) W !,"Control Point is not a valid IFCAP FCP.." K X
"RTN","RMPOPED",56,0)
 Q
"RTN","RMPOPED",57,0)
ACT ;activate/inactivate a home oxygen patient
"RTN","RMPOPED",58,0)
 ;Set up site variables.
"RTN","RMPOPED",59,0)
 D HOSITE^RMPOUTL0 I QUIT D EXIT Q
"RTN","RMPOPED",60,0)
 W @IOF
"RTN","RMPOPED",61,0)
 ;
"RTN","RMPOPED",62,0)
ACT1 ;Toggle ACTIVATE/INACTIVATE functions.
"RTN","RMPOPED",63,0)
 N NAME K DIC,DA
"RTN","RMPOPED",64,0)
 S DIC="^RMPR(665,",DIC(0)="QEAMZ" D ^DIC I Y<0!$$QUIT D EXIT Q
"RTN","RMPOPED",65,0)
 S DIE=DIC,DA=+Y,NAME=Y(0,0)
"RTN","RMPOPED",66,0)
 L +^RMPR(665,DA):2
"RTN","RMPOPED",67,0)
 I '$T D  G ACT1
"RTN","RMPOPED",68,0)
 . W ?10,$C(7)_Y(0,0)_" -- record in use. Try later."
"RTN","RMPOPED",69,0)
 ;If the patient has never been activated, quit.
"RTN","RMPOPED",70,0)
 I $P($G(^RMPR(665,DA,"RMPOA")),U,2)="" D  G ACT1
"RTN","RMPOPED",71,0)
 . W !!,$C(7)_NAME_" has not been added as a Home Oxygen patient."
"RTN","RMPOPED",72,0)
 . W !,"Please add using the ""Add/Edit Home Oxygen Patient"" option."
"RTN","RMPOPED",73,0)
 ;If the patient is active, perform inactivation actions.
"RTN","RMPOPED",74,0)
 I $P($G(^RMPR(665,DA,"RMPOA")),U,3)="" D INACTVT^RMPOPED G ACT1
"RTN","RMPOPED",75,0)
 ;If the patient is inactive, perform activation actions.
"RTN","RMPOPED",76,0)
 I $P($G(^RMPR(665,DA,"RMPOA")),U,3)'="" D ACTVT^RMPOPED G ACT1
"RTN","RMPOPED",77,0)
 Q
"RTN","RMPOPED",78,0)
INACTVT ; Inactivate the patient if user wants to.
"RTN","RMPOPED",79,0)
 ; Confirm if the user wants to proceed.
"RTN","RMPOPED",80,0)
 K DIR S DIR(0)="YO",DIR("B")="NO"
"RTN","RMPOPED",81,0)
 S DIR("A")="Are you sure you want to inactivate "_NAME_" ?" D ^DIR
"RTN","RMPOPED",82,0)
 Q:(Y<1)!$$QUIT
"RTN","RMPOPED",83,0)
 S DR="19.5//TODAY;19.6;19.7////"_DUZ,DIE("NO^")="BACK"
"RTN","RMPOPED",84,0)
 D ^DIE
"RTN","RMPOPED",85,0)
 Q
"RTN","RMPOPED",86,0)
 ;
"RTN","RMPOPED",87,0)
ACTVT ;Activate the patient if the user wants to.
"RTN","RMPOPED",88,0)
 K DIR S DIR(0)="YO",DIR("B")="NO"
"RTN","RMPOPED",89,0)
 S DIR("A")="Are you sure you want to reactivate "_NAME_" ?" D ^DIR
"RTN","RMPOPED",90,0)
 Q:(Y<1)!$$QUIT
"RTN","RMPOPED",91,0)
 S DR="19.2//TODAY;19.5///@;19.6///@;19.7///@"
"RTN","RMPOPED",92,0)
 S DIE("NO^")="BACK"
"RTN","RMPOPED",93,0)
 D ^DIE
"RTN","RMPOPED",94,0)
 Q
"RTN","RMPOPED",95,0)
PAT ;Add/Edit Home Oxygen Patient
"RTN","RMPOPED",96,0)
 S QUIT=0
"RTN","RMPOPED",97,0)
 D HOSITE^RMPOUTL0
"RTN","RMPOPED",98,0)
 I '$D(RMPOXITE)!QUIT D EXIT Q
"RTN","RMPOPED",99,0)
LOOP ;
"RTN","RMPOPED",100,0)
 S QUIT=0
"RTN","RMPOPED",101,0)
 D LOOKUP I QUIT!'$D(RMPODFN) D EXIT Q
"RTN","RMPOPED",102,0)
 D EDBLK I QUIT D EXIT Q
"RTN","RMPOPED",103,0)
 D UNLOCK G LOOP
"RTN","RMPOPED",104,0)
EDBLK ;
"RTN","RMPOPED",105,0)
 D SITECHK Q:QUIT
"RTN","RMPOPED",106,0)
 D DEMOG Q:QUIT
"RTN","RMPOPED",107,0)
 D RX Q:QUIT
"RTN","RMPOPED",108,0)
 D ITEM
"RTN","RMPOPED",109,0)
 Q
"RTN","RMPOPED",110,0)
 ;called by ^RMPOBIL1, providing RMPOPATN as the X variable
"RTN","RMPOPED",111,0)
EDIT ;From Billing...
"RTN","RMPOPED",112,0)
 I '$D(RMPODFN) S RMPODFN=$TR($G(RMPOPATN),"`")
"RTN","RMPOPED",113,0)
 Q:'$D(^RMPR(665,+RMPODFN,0))
"RTN","RMPOPED",114,0)
 W !,"EDITING "_$P(^DPT(RMPODFN,0),U)_"...",!
"RTN","RMPOPED",115,0)
 S QUIT=0,DA=RMPODFN
"RTN","RMPOPED",116,0)
 L +^RMPR(665,DA):2
"RTN","RMPOPED",117,0)
 I '$T W !!?10,*7," << Record in use. Try later. >>" Q
"RTN","RMPOPED",118,0)
 D EDBLK,EXIT
"RTN","RMPOPED",119,0)
 Q
"RTN","RMPOPED",120,0)
LOOKUP ;First look-up the patient
"RTN","RMPOPED",121,0)
 K DIC,DIE,DA,DR,RMPODFN
"RTN","RMPOPED",122,0)
 W !!! S DIC="^RMPR(665,",DIC(0)="LQEAMZ"
"RTN","RMPOPED",123,0)
 D ^DIC Q:(Y<0)!$$QUIT
"RTN","RMPOPED",124,0)
CONT S (RMPODFN,DA)=+Y
"RTN","RMPOPED",125,0)
 L +^RMPR(665,DA):2
"RTN","RMPOPED",126,0)
 I '$T W !!?10,*7," << Record in use. Try later. >>" G LOOKUP
"RTN","RMPOPED",127,0)
 Q
"RTN","RMPOPED",128,0)
 ;
"RTN","RMPOPED",129,0)
QUIT() S QUIT=$D(DTOUT)!$D(DUOUT)!$D(DIROUT) Q QUIT
"RTN","RMPOPED",130,0)
EQUIT() S QUIT=$D(DTOUT)!$D(Y) Q QUIT
"RTN","RMPOPED",131,0)
LJ(S,W,C) ; LEFT JUSTIFY S IN A FIELD W WIDE PADDING WITH CHAR F
"RTN","RMPOPED",132,0)
 ;
"RTN","RMPOPED",133,0)
 S C=$G(C," ")   ;DEFAULT PAD CHAR IS SPACE
"RTN","RMPOPED",134,0)
 S $P(S,C,W-$L(S)+$L(S,C))=""
"RTN","RMPOPED",135,0)
 Q S
"RTN","RMPOPED",136,0)
 ;
"RTN","RMPOPED",137,0)
SITECHK ;If user chooses patient from site different from billing site
"RTN","RMPOPED",138,0)
 ;
"RTN","RMPOPED",139,0)
 S Y=$P($G(^RMPR(665,RMPODFN,"RMPOA")),U,7)
"RTN","RMPOPED",140,0)
 Q:Y=RMPOXITE    ;Site is the same.. 
"RTN","RMPOPED",141,0)
 I Y="" D SET Q   ;Site not defined, stuff RMPOXITE...
"RTN","RMPOPED",142,0)
 ; Site is different...
"RTN","RMPOPED",143,0)
 S IENS=RMPODFN_","
"RTN","RMPOPED",144,0)
 D GETS^DIQ(665,IENS,19.12,"E","X")
"RTN","RMPOPED",145,0)
 W !!,"Patient's Home Oxygen Contract Location (HOCL) is "
"RTN","RMPOPED",146,0)
 W $G(X(665,IENS,19.12,"E"))
"RTN","RMPOPED",147,0)
 W !,"You are working on billing for HOCL "_RMPO("NAME"),!
"RTN","RMPOPED",148,0)
 K DIR S DIR(0)="Y",DIR("B")="NO"
"RTN","RMPOPED",149,0)
 S DIR("A")="Should I change this patient's HOCL to "_RMPO("NAME")
"RTN","RMPOPED",150,0)
 D ^DIR Q:$$QUIT!(Y=0)
"RTN","RMPOPED",151,0)
 D SET
"RTN","RMPOPED",152,0)
 Q
"RTN","RMPOPED",153,0)
SET ;
"RTN","RMPOPED",154,0)
 K DIE,DR,DA
"RTN","RMPOPED",155,0)
 S DA=RMPODFN
"RTN","RMPOPED",156,0)
 ;W "HERE,RMPOXITE=",RMPOXITE
"RTN","RMPOPED",157,0)
 S DIE="^RMPR(665,",DR="19.12////"_RMPOXITE D ^DIE
"RTN","RMPOPED",158,0)
 Q
"RTN","RMPOPED",159,0)
 ;
"RTN","RMPOPED",160,0)
DEMOG ;First edit the patient's basic fields
"RTN","RMPOPED",161,0)
 ;
"RTN","RMPOPED",162,0)
 K DIE,DR,DA
"RTN","RMPOPED",163,0)
 S DA=RMPODFN
"RTN","RMPOPED",164,0)
 S DIE="^RMPR(665,",DR="19.1" D ^DIE Q:$$EQUIT
"RTN","RMPOPED",165,0)
 S RMPOELIG=$P($G(^RMPR(665,RMPODFN,"RMPOA")),U)
"RTN","RMPOPED",166,0)
 K DR S DR="19.11"_$S(RMPOELIG="D":"",1:"///@")_";19.12"
"RTN","RMPOPED",167,0)
 D ^DIE Q:$$EQUIT
"RTN","RMPOPED",168,0)
 K DR S Y=DT X ^DD("DD") S DR="19.2//"_Y D ^DIE Q:$$QUIT
"RTN","RMPOPED",169,0)
 Q
"RTN","RMPOPED",170,0)
 ;
"RTN","RMPOPED",171,0)
RX ;Edit the Rx Data
"RTN","RMPOPED",172,0)
 ;
"RTN","RMPOPED",173,0)
 N RXD,RXDI
"RTN","RMPOPED",174,0)
 K DIC,DIE,DA,DR
"RTN","RMPOPED",175,0)
 S DIC="^RMPR(665,"_RMPODFN_",""RMPOB"",",DIC(0)="AEQLZ"
"RTN","RMPOPED",176,0)
 S DA(1)=RMPODFN,DIC("P")="665.193D"
"RTN","RMPOPED",177,0)
 S RXD=$O(^RMPR(665,DA(1),"RMPOB","B",""),-1) D:RXD
"RTN","RMPOPED",178,0)
 . S DIC("B")=$$FMTE^XLFDT(RXD)
"RTN","RMPOPED",179,0)
 D ^DIC Q:Y<0!$$QUIT
"RTN","RMPOPED",180,0)
 S DIE=DIC,DA=+Y,DR=".01;2//^D EXPIRE^RMPOBIL4;3" D ^DIE Q:$$EQUIT
"RTN","RMPOPED",181,0)
 Q
"RTN","RMPOPED",182,0)
 ;
"RTN","RMPOPED",183,0)
ITEM ;Add/Edit Items
"RTN","RMPOPED",184,0)
 ;
"RTN","RMPOPED",185,0)
 ; Display items
"RTN","RMPOPED",186,0)
 D ITEMD
"RTN","RMPOPED",187,0)
 ; If no items on file, then only allow ADD PRIMARY ITEM
"RTN","RMPOPED",188,0)
 I '$D(IEN) D ITEMP Q:QUIT!(ITEM="")  G ITEM
"RTN","RMPOPED",189,0)
 ; ask for ACTION, quit if <return>, timeout, etc
"RTN","RMPOPED",190,0)
 S ITMACT=$$ITEMO Q:$$QUIT!(ITMACT="")
"RTN","RMPOPED",191,0)
 ; if they entered 'A', do ADD ITEM, then edit it
"RTN","RMPOPED",192,0)
 I ITMACT="A" D ITEMA Q:QUIT!(ITEM="")  D ITEME Q:QUIT  G ITEM
"RTN","RMPOPED",193,0)
 ; if they entered 'D', select an item, then delete it
"RTN","RMPOPED",194,0)
 I ITMACT="D" D ITEMS Q:QUIT!(ITEM="")  D ITEMK G ITEM
"RTN","RMPOPED",195,0)
 ; if they entered 'E', select an item, then edit it
"RTN","RMPOPED",196,0)
 I ITMACT="E" D ITEMS Q:QUIT!(ITEM="")  D ITEME Q:QUIT  G ITEM
"RTN","RMPOPED",197,0)
 G ITEM
"RTN","RMPOPED",198,0)
 Q
"RTN","RMPOPED",199,0)
ITEMP ; Add Primary Item
"RTN","RMPOPED",200,0)
 W !!,$C(7)_"No items found, please enter PRIMARY ITEM",!
"RTN","RMPOPED",201,0)
 D ITEMA Q:QUIT!(ITEM="")
"RTN","RMPOPED",202,0)
 S PI="///Y" D ITEME K PI
"RTN","RMPOPED",203,0)
 Q
"RTN","RMPOPED",204,0)
ITEMA ; Add Items
"RTN","RMPOPED",205,0)
 S ITEM=""
"RTN","RMPOPED",206,0)
 K DIC S DIC="^RMPR(661,",DIC(0)="AEQMZ" D ^DIC Q:Y<0!$$QUIT
"RTN","RMPOPED",207,0)
 K DD,DO,DA,DIC
"RTN","RMPOPED",208,0)
 S DIC="^RMPR(665,"_RMPODFN_",""RMPOC"",",DIC(0)="L"
"RTN","RMPOPED",209,0)
 S DIC("P")=$P(^DD(665,19.4,0),U,2),DA(1)=RMPODFN,X=+Y
"RTN","RMPOPED",210,0)
 D FILE^DICN I Y>0 S IEN=$G(IEN)+1,IEN(IEN)=+Y,ITEM=IEN
"RTN","RMPOPED",211,0)
 Q
"RTN","RMPOPED",212,0)
ITEMS ; Select Item
"RTN","RMPOPED",213,0)
 ; Return ITEM = index into both ITEMS and IEN arrays
"RTN","RMPOPED",214,0)
 I IEN=1 S ITEM=1 W "  ",$E(ITEMS(1),1,33) Q
"RTN","RMPOPED",215,0)
 K DIR
"RTN","RMPOPED",216,0)
 S ITEM=""
"RTN","RMPOPED",217,0)
 S DIR(0)="NO^1:"_IEN,DIR("A")="Select an ITEM"
"RTN","RMPOPED",218,0)
 S DIR("?")="Select an item from the list"
"RTN","RMPOPED",219,0)
 M DIR("?")=ITEMS
"RTN","RMPOPED",220,0)
 D ^DIR Q:Y'>0!$$QUIT
"RTN","RMPOPED",221,0)
 S ITEM=+Y W "  ",$E(ITEMS(ITEM),1,33)
"RTN","RMPOPED",222,0)
 Q
"RTN","RMPOPED",223,0)
ITEME ; Edit an Item
"RTN","RMPOPED",224,0)
 N FCP,DFCP,RMCPTHCP,RMCPRENT K DIE,DA,DR,RMCPT
"RTN","RMPOPED",225,0)
 S DA(1)=RMPODFN,DA=IEN(ITEM),DIE="^RMPR(665,"_DA(1)_",""RMPOC"","
"RTN","RMPOPED",226,0)
 D ITEMEP Q:QUIT
"RTN","RMPOPED",227,0)
 S DR=".01R;6R" D ^DIE Q:$$EQUIT!('$D(DA))
"RTN","RMPOPED",228,0)
 S RMCPTHCP=$P($G(^RMPR(665,RMPODFN,"RMPOC",DA,0)),U,7)
"RTN","RMPOPED",229,0)
 S RMCPT=$P($G(^RMPR(661.1,RMCPTHCP,4)),U,1) S DR=""
"RTN","RMPOPED",230,0)
 S RMCPRENT=$P($G(^RMPR(661.1,RMCPTHCP,5)),U,1)
"RTN","RMPOPED",231,0)
 I RMCPT["RR",(RMCPRENT=1) S DR="11;"
"RTN","RMPOPED",232,0)
 I RMCPT["QH" S DR=DR_"12;"
"RTN","RMPOPED",233,0)
 S DR=DR_"1R;2R;3R;4;7;8;9R" K RMCPRENT,RMCPTHCP
"RTN","RMPOPED",234,0)
 D ^DIE I $D(DA),$D(RMCPT),(RMCPT'["RR") S $P(^RMPR(665,DA(1),"RMPOC",DA,0),U,12)=""
"RTN","RMPOPED",235,0)
 I $D(DA),$D(RMCPT),(RMCPT'["QH") S $P(^RMPR(665,DA(1),"RMPOC",DA,0),U,13)=""
"RTN","RMPOPED",236,0)
 Q:$$EQUIT
"RTN","RMPOPED",237,0)
 ; Kludge to "point" to file 420
"RTN","RMPOPED",238,0)
 S DFCP=$P(^RMPR(665,RMPODFN,"RMPOC",IEN(ITEM),0),U,6)
"RTN","RMPOPED",239,0)
 F  D  Q:(FCP>0)!QUIT
"RTN","RMPOPED",240,0)
 . S FCP=$$GETFCP^RMPOBILU(DFCP) Q:QUIT
"RTN","RMPOPED",241,0)
 . I FCP<0 W $C(7)_"REQUIRED FIELD!"
"RTN","RMPOPED",242,0)
 I FCP>0 S DR="5///"_$P(FCP,U,2) D ^DIE Q:$$EQUIT
"RTN","RMPOPED",243,0)
 ; End Kludge
"RTN","RMPOPED",244,0)
 ;S DR="7:9" D ^DIE Q:$$EQUIT
"RTN","RMPOPED",245,0)
 Q
"RTN","RMPOPED",246,0)
ITEMEP ; Primary Item edit...
"RTN","RMPOPED",247,0)
 N PIEN,PFLG,RMDA,RMNO
"RTN","RMPOPED",248,0)
 S RMDA=DA,DR="10" D ^DIE Q:$$QUIT
"RTN","RMPOPED",249,0)
 I $P(^RMPR(665,RMPODFN,"RMPOC",RMDA,0),U,11)'="Y" Q
"RTN","RMPOPED",250,0)
 ; Logic to control toggling of Primary Item flag...
"RTN","RMPOPED",251,0)
 S RMNO="N"
"RTN","RMPOPED",252,0)
 F RMX=0:0 S RMX=$O(^RMPR(665,RMPODFN,"RMPOC",RMX)) Q:RMX'>0  D
"RTN","RMPOPED",253,0)
 . Q:RMDA=RMX
"RTN","RMPOPED",254,0)
 . S DA=RMX,DR="10///^S X=RMNO" D ^DIE
"RTN","RMPOPED",255,0)
 S DA=RMDA
"RTN","RMPOPED",256,0)
 Q
"RTN","RMPOPED",257,0)
PIEN(DFN) ; FIND PRIMARY ITEM
"RTN","RMPOPED",258,0)
 ; RETURN IEN OF P.I. IN MULTIPLE ^ IEN IN FILE 661
"RTN","RMPOPED",259,0)
 N X,PIEN
"RTN","RMPOPED",260,0)
 S X=0,PIEN=0
"RTN","RMPOPED",261,0)
 F  S X=$O(^RMPR(665,DFN,"RMPOC",X)) Q:X'>0  D  Q:PIEN
"RTN","RMPOPED",262,0)
 . S:$P(^RMPR(665,DFN,"RMPOC",X,0),U,11)="Y" PIEN=X
"RTN","RMPOPED",263,0)
 S:PIEN PIEN=PIEN_U_$P(^RMPR(665,DFN,"RMPOC",PIEN,0),U,1)
"RTN","RMPOPED",264,0)
 Q PIEN
"RTN","RMPOPED",265,0)
ITEMD ; Display Items
"RTN","RMPOPED",266,0)
 N I,Z,PIF,ITMNM,VDRNM
"RTN","RMPOPED",267,0)
 K IEN,ITEMS S I=0
"RTN","RMPOPED",268,0)
 Q:$O(^RMPR(665,RMPODFN,"RMPOC",0))'>0
"RTN","RMPOPED",269,0)
 W !!,"The following items are already in this patient's template:",!
"RTN","RMPOPED",270,0)
 F IEN=1:1 S I=$O(^RMPR(665,RMPODFN,"RMPOC",I)) Q:I'>0  D
"RTN","RMPOPED",271,0)
 . S Z=^RMPR(665,RMPODFN,"RMPOC",I,0)
"RTN","RMPOPED",272,0)
 . S PIF=$S($P(Z,U,11)="Y":"*",1:" ")
"RTN","RMPOPED",273,0)
 . S ITMNM=$$ITEMNM($P(Z,U)),VDRNM=$$VDRNM($P(Z,U,2))
"RTN","RMPOPED",274,0)
 .; K X S IENS=$P(Z,U)_","
"RTN","RMPOPED",275,0)
 .; D GETS^DIQ(661,IENS,.01,"","X") S ITMNM=$E(X(661,IENS,.01),1,33)
"RTN","RMPOPED",276,0)
 .; S IENS=$P(Z,U,2)_",",VDRNM="<< VENDOR NOT DEFINED >>"
"RTN","RMPOPED",277,0)
 .; I IENS'="," D GETS^DIQ(440,IENS,.01,"","X") S VDRNM=X(440,IENS,.01)
"RTN","RMPOPED",278,0)
 . S IEN(IEN)=I
"RTN","RMPOPED",279,0)
 . S ITEMS(IEN)=" "_PIF_$J(IEN,4)_"  "_$$LJ(ITMNM,38)_$E(VDRNM,1,30)
"RTN","RMPOPED",280,0)
 . W !,ITEMS(IEN)
"RTN","RMPOPED",281,0)
 W !!," * = Primary Item",!
"RTN","RMPOPED",282,0)
 S IEN=IEN-1
"RTN","RMPOPED",283,0)
 Q
"RTN","RMPOPED",284,0)
ITEMNM(ITM) ; RETURN ITEM NAME
"RTN","RMPOPED",285,0)
 S IENS=ITM_","
"RTN","RMPOPED",286,0)
 D GETS^DIQ(661,IENS,.01,"","X")
"RTN","RMPOPED",287,0)
 Q $E(X(661,IENS,.01),1,33)
"RTN","RMPOPED",288,0)
VDRNM(VDR) ; RETURN VENDOR NAME
"RTN","RMPOPED",289,0)
 I VDR="" Q "<< VENDOR NOT DEFINED >>"
"RTN","RMPOPED",290,0)
 S IENS=VDR_"," D GETS^DIQ(440,IENS,.01,"","X")
"RTN","RMPOPED",291,0)
 Q X(440,IENS,.01)
"RTN","RMPOPED",292,0)
ITEMK ; Delete an Item
"RTN","RMPOPED",293,0)
 ;
"RTN","RMPOPED",294,0)
 K DIR S DIR(0)="Y",DIR("A")="Are you SURE you want to delete this item"
"RTN","RMPOPED",295,0)
 S DIR("B")="NO" D ^DIR Q:Y'>0
"RTN","RMPOPED",296,0)
 K DIK,DA
"RTN","RMPOPED",297,0)
 S DA(1)=RMPODFN,DA=IEN(ITEM),DIK="^RMPR(665,"_DA(1)_",""RMPOC"","
"RTN","RMPOPED",298,0)
 D ^DIK W "  ...deleted!"
"RTN","RMPOPED",299,0)
 Q
"RTN","RMPOPED",300,0)
ITEMO() ; Choose Option
"RTN","RMPOPED",301,0)
 K DIR
"RTN","RMPOPED",302,0)
 S DIR(0)="SBO^A:Add;D:Delete;E:Edit",DIR("A")="Select ACTION" D ^DIR
"RTN","RMPOPED",303,0)
 Q Y
"RTN","RMPOPED",304,0)
 Q
"VER")
8.0^22.0
"BLD",6991,6)
^124
**END**
**END**
