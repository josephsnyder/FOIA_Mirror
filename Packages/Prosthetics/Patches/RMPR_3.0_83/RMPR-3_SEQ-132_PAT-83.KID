Released RMPR*3*83 SEQ #132
Extracted from mail message
**KIDS**:RMPR*3.0*83^

**INSTALL NAME**
RMPR*3.0*83
"BLD",4834,0)
RMPR*3.0*83^PROSTHETICS^0^3090713^y
"BLD",4834,4,0)
^9.64PA^668^1
"BLD",4834,4,668,0)
668
"BLD",4834,4,668,2,0)
^9.641^668^1
"BLD",4834,4,668,2,668,0)
PROSTHETIC SUSPENSE  (File-top level)
"BLD",4834,4,668,2,668,1,0)
^9.6411^27^1
"BLD",4834,4,668,2,668,1,27,0)
ORDERING PROVIDER
"BLD",4834,4,668,222)
y^n^p^^^^n^^n
"BLD",4834,4,668,224)

"BLD",4834,4,"APDD",668,668)

"BLD",4834,4,"APDD",668,668,27)

"BLD",4834,4,"B",668,668)

"BLD",4834,6)
23^
"BLD",4834,6.3)
20
"BLD",4834,"ABPKG")
n
"BLD",4834,"INID")
^
"BLD",4834,"INIT")

"BLD",4834,"KRN",0)
^9.67PA^8989.52^19
"BLD",4834,"KRN",.4,0)
.4
"BLD",4834,"KRN",.4,"NM",0)
^9.68A^^
"BLD",4834,"KRN",.401,0)
.401
"BLD",4834,"KRN",.402,0)
.402
"BLD",4834,"KRN",.403,0)
.403
"BLD",4834,"KRN",.5,0)
.5
"BLD",4834,"KRN",.84,0)
.84
"BLD",4834,"KRN",3.6,0)
3.6
"BLD",4834,"KRN",3.8,0)
3.8
"BLD",4834,"KRN",9.2,0)
9.2
"BLD",4834,"KRN",9.8,0)
9.8
"BLD",4834,"KRN",9.8,"NM",0)
^9.68A^11^8
"BLD",4834,"KRN",9.8,"NM",3,0)
RMPREOU^^0^B19592813
"BLD",4834,"KRN",9.8,"NM",5,0)
RMPREO^^0^B10452539
"BLD",4834,"KRN",9.8,"NM",6,0)
RMPRFC3^^0^B5404403
"BLD",4834,"KRN",9.8,"NM",7,0)
RMPRFC4^^0^B13693524
"BLD",4834,"KRN",9.8,"NM",8,0)
RMPREOL^^0^B12020197
"BLD",4834,"KRN",9.8,"NM",9,0)
RMPR9VR^^0^B5833491
"BLD",4834,"KRN",9.8,"NM",10,0)
RMPRFC5^^0^B202840
"BLD",4834,"KRN",9.8,"NM",11,0)
RMPRHL7A^^0^B34526281
"BLD",4834,"KRN",9.8,"NM","B","RMPR9VR",9)

"BLD",4834,"KRN",9.8,"NM","B","RMPREO",5)

"BLD",4834,"KRN",9.8,"NM","B","RMPREOL",8)

"BLD",4834,"KRN",9.8,"NM","B","RMPREOU",3)

"BLD",4834,"KRN",9.8,"NM","B","RMPRFC3",6)

"BLD",4834,"KRN",9.8,"NM","B","RMPRFC4",7)

"BLD",4834,"KRN",9.8,"NM","B","RMPRFC5",10)

"BLD",4834,"KRN",9.8,"NM","B","RMPRHL7A",11)

"BLD",4834,"KRN",19,0)
19
"BLD",4834,"KRN",19,"NM",0)
^9.68A^^
"BLD",4834,"KRN",19.1,0)
19.1
"BLD",4834,"KRN",101,0)
101
"BLD",4834,"KRN",101,"NM",0)
^9.68A^^0
"BLD",4834,"KRN",409.61,0)
409.61
"BLD",4834,"KRN",771,0)
771
"BLD",4834,"KRN",870,0)
870
"BLD",4834,"KRN",8989.51,0)
8989.51
"BLD",4834,"KRN",8989.52,0)
8989.52
"BLD",4834,"KRN",8994,0)
8994
"BLD",4834,"KRN","B",.4,.4)

"BLD",4834,"KRN","B",.401,.401)

"BLD",4834,"KRN","B",.402,.402)

"BLD",4834,"KRN","B",.403,.403)

"BLD",4834,"KRN","B",.5,.5)

"BLD",4834,"KRN","B",.84,.84)

"BLD",4834,"KRN","B",3.6,3.6)

"BLD",4834,"KRN","B",3.8,3.8)

"BLD",4834,"KRN","B",9.2,9.2)

"BLD",4834,"KRN","B",9.8,9.8)

"BLD",4834,"KRN","B",19,19)

"BLD",4834,"KRN","B",19.1,19.1)

"BLD",4834,"KRN","B",101,101)

"BLD",4834,"KRN","B",409.61,409.61)

"BLD",4834,"KRN","B",771,771)

"BLD",4834,"KRN","B",870,870)

"BLD",4834,"KRN","B",8989.51,8989.51)

"BLD",4834,"KRN","B",8989.52,8989.52)

"BLD",4834,"KRN","B",8994,8994)

"BLD",4834,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",4834,"QUES",0)
^9.62^^
"BLD",4834,"REQB",0)
^9.611^1^1
"BLD",4834,"REQB",1,0)
GMRC*3.0*44^2
"BLD",4834,"REQB","B","GMRC*3.0*44",1)

"FIA",668)
PROSTHETIC SUSPENSE
"FIA",668,0)
^RMPR(668,
"FIA",668,0,0)
668ID
"FIA",668,0,1)
y^n^p^^^^n^^n
"FIA",668,0,10)

"FIA",668,0,11)

"FIA",668,0,"RLRO")

"FIA",668,0,"VR")
3.0^RMPR
"FIA",668,668)
1
"FIA",668,668,27)

"MBREQ")
0
"PKG",101,-1)
1^1
"PKG",101,0)
PROSTHETICS^RMPR^PROSTHETICS VERSION 3.0 ALPHA
"PKG",101,20,0)
^9.402P^^0
"PKG",101,22,0)
^9.49I^1^1
"PKG",101,22,1,0)
3.0^2960209^2960214
"PKG",101,22,1,"PAH",1,0)
83^3090713^448
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
8
"RTN","RMPR9VR")
0^9^B5833491^B5492507
"RTN","RMPR9VR",1,0)
RMPR9VR ;HOIFO/SPS - VIEW CONSULT REQUESTS FOR GUI;01/29/03  11:38
"RTN","RMPR9VR",2,0)
 ;;3.0;PROSTHETICS;**59,83**;Feb 09, 1996;Build 20
"RTN","RMPR9VR",3,0)
 ;
"RTN","RMPR9VR",4,0)
 ;HNC #83 add free text ordering provider, results(1) call utility
"RTN","RMPR9VR",5,0)
 ;
"RTN","RMPR9VR",6,0)
A1(RMPRA) G A2
"RTN","RMPR9VR",7,0)
EN(RESULTS,RMPRA) ; -- Broker callback to get list to display
"RTN","RMPR9VR",8,0)
A2 ;
"RTN","RMPR9VR",9,0)
 I '$D(^RMPR(668,RMPRA,0)) S RESULTS(0)="NOTHING TO REPORT" G EXIT
"RTN","RMPR9VR",10,0)
 K ADATE,PDAY
"RTN","RMPR9VR",11,0)
 ; ORDER DATE/SUSPENSE DATE
"RTN","RMPR9VR",12,0)
 S RESULTS(0)=$P(^RMPR(668,RMPRA,0),U,1),RESULTS(0)=$$DAT1^RMPRUTL1(RESULTS(0))
"RTN","RMPR9VR",13,0)
 ; REQUESTOR
"RTN","RMPR9VR",14,0)
 S RESULTS(1)=$P($G(^RMPR(668,RMPRA,0)),U,11)
"RTN","RMPR9VR",15,0)
 I RESULTS(1)'="" S RESULTS(1)=$$WHO^RMPREOU(RESULTS(1))
"RTN","RMPR9VR",16,0)
 I RESULTS(1)="" S RESULTS(1)=$$WHO^RMPREOU("",12,RMPRA)
"RTN","RMPR9VR",17,0)
 ; SUSPENDED BY
"RTN","RMPR9VR",18,0)
 S RESULTS(2)=$P($G(^RMPR(668,RMPRA,0)),U,4)
"RTN","RMPR9VR",19,0)
 I RESULTS(2)'="" S RESULTS(2)=$P(^VA(200,RESULTS(2),0),U)
"RTN","RMPR9VR",20,0)
 ; INITIAL ACTION DATE
"RTN","RMPR9VR",21,0)
 S RESULTS(3)=$P(^RMPR(668,RMPRA,0),U,9),RESULTS(3)=$$DAT1^RMPRUTL1(RESULTS(3))
"RTN","RMPR9VR",22,0)
 ; COMPLETION DATE
"RTN","RMPR9VR",23,0)
 S RESULTS(4)=$P($G(^RMPR(668,RMPRA,0)),U,5)
"RTN","RMPR9VR",24,0)
 I RESULTS(4)>0 S RESULTS(4)=$$DAT1^RMPRUTL1(RESULTS(4))
"RTN","RMPR9VR",25,0)
EXIT Q
"RTN","RMPR9VR",26,0)
A3(RMPRA) G A4 ;display description
"RTN","RMPR9VR",27,0)
EN2(RESULTS,RMPRA) ;
"RTN","RMPR9VR",28,0)
A4 I '$D(^RMPR(668,RMPRA,0)) S RESULTS(0)="NOTHING TO REPORT" G EXIT
"RTN","RMPR9VR",29,0)
 I '$D(^RMPR(668,RMPRA,2,0)) S RESULTS(0)="NOTHING TO REPORT" G EXIT
"RTN","RMPR9VR",30,0)
 S (RMPRD,I)=0
"RTN","RMPR9VR",31,0)
 F  S RMPRD=$O(^RMPR(668,RMPRA,2,RMPRD)) Q:RMPRD'>0  D
"RTN","RMPR9VR",32,0)
 .S RESULTS(I)=^RMPR(668,RMPRA,2,RMPRD,0)
"RTN","RMPR9VR",33,0)
 .S I=I+1
"RTN","RMPR9VR",34,0)
 Q
"RTN","RMPR9VR",35,0)
A5(RMPRA) G A6 ;display Initial Action Note
"RTN","RMPR9VR",36,0)
EN3(RESULTS,RMPRA) ;
"RTN","RMPR9VR",37,0)
A6 I '$D(^RMPR(668,RMPRA,0)) S RESULTS(0)="NOTHING TO REPORT" G EXIT
"RTN","RMPR9VR",38,0)
 I '$D(^RMPR(668,RMPRA,3,0)) S RESULTS(0)="NOTHING TO REPORT" G EXIT
"RTN","RMPR9VR",39,0)
 S (RMPRD,I)=0
"RTN","RMPR9VR",40,0)
 F  S RMPRD=$O(^RMPR(668,RMPRA,3,RMPRD)) Q:RMPRD'>0  D
"RTN","RMPR9VR",41,0)
 .S RESULTS(I)=^RMPR(668,RMPRA,3,RMPRD,0)
"RTN","RMPR9VR",42,0)
 .S I=I+1
"RTN","RMPR9VR",43,0)
 Q
"RTN","RMPR9VR",44,0)
A7(RMPRA) G A8 ;display Completion Note
"RTN","RMPR9VR",45,0)
EN4(RESULTS,RMPRA) ;
"RTN","RMPR9VR",46,0)
A8 I '$D(^RMPR(668,RMPRA,0)) S RESULTS(0)="NOTHING TO REPORT" G EXIT
"RTN","RMPR9VR",47,0)
 I '$D(^RMPR(668,RMPRA,4,0)) S RESULTS(0)="NOTHING TO REPORT" G EXIT
"RTN","RMPR9VR",48,0)
 S (RMPRD,I)=0
"RTN","RMPR9VR",49,0)
 F  S RMPRD=$O(^RMPR(668,RMPRA,4,RMPRD)) Q:RMPRD'>0  D
"RTN","RMPR9VR",50,0)
 .S RESULTS(I)=^RMPR(668,RMPRA,4,RMPRD,0)
"RTN","RMPR9VR",51,0)
 .S I=I+1
"RTN","RMPR9VR",52,0)
 Q
"RTN","RMPREO")
0^5^B10452539^B9728753
"RTN","RMPREO",1,0)
RMPREO ;HINES/HNC  SUSPENSE PROCESSING ; 10-MARCH-2005
"RTN","RMPREO",2,0)
 ;;3.0;PROSTHETICS;**45,55,83**;Feb 09, 1996;Build 20
"RTN","RMPREO",3,0)
 ;
"RTN","RMPREO",4,0)
 ;HNC #83, add free text ordering provider 3/10/05
"RTN","RMPREO",5,0)
 ;
"RTN","RMPREO",6,0)
EN ; -- main entry point for RMPREO
"RTN","RMPREO",7,0)
 D ^%ZISC
"RTN","RMPREO",8,0)
 N STRING,CLREND,COLUMN,LINE,ON,OFF
"RTN","RMPREO",9,0)
 ;get patient to test with
"RTN","RMPREO",10,0)
 K ^TMP($J,"RMPREO")
"RTN","RMPREO",11,0)
 K ^TMP($J,"RMPREOEE")
"RTN","RMPREO",12,0)
 ;ask station
"RTN","RMPREO",13,0)
 I '$D(RMPR) D DIV4^RMPRSIT Q:$D(X)
"RTN","RMPREO",14,0)
 I '$D(RMPRDFN) D GETPAT^RMPRUTIL Q:'$D(RMPRDFN)
"RTN","RMPREO",15,0)
 D EN^VALM("RMPREO")
"RTN","RMPREO",16,0)
 Q
"RTN","RMPREO",17,0)
 ;
"RTN","RMPREO",18,0)
HDR ; -- header code
"RTN","RMPREO",19,0)
 N VA,VADM
"RTN","RMPREO",20,0)
 S DFN=RMPRDFN
"RTN","RMPREO",21,0)
 D DEM^VADPT
"RTN","RMPREO",22,0)
 ;S VALMHDR(1)="Suspense Processing"
"RTN","RMPREO",23,0)
 S VALMHDR(1)="Open/Pending/Closed Suspense for "_$$LOWER^VALM1(VADM(1))_"  ("_$P(VADM(2),U,2)_")"
"RTN","RMPREO",24,0)
 D KVAR^VADPT
"RTN","RMPREO",25,0)
 Q
"RTN","RMPREO",26,0)
 ;
"RTN","RMPREO",27,0)
INIT ; -- init variables and list array
"RTN","RMPREO",28,0)
 K ^TMP($J,"RMPREO"),^TMP($J,"RMPREOEE")
"RTN","RMPREO",29,0)
 D HDR
"RTN","RMPREO",30,0)
 N RMPRA,CDATE,LINE,X
"RTN","RMPREO",31,0)
 ;start loop
"RTN","RMPREO",32,0)
 ;
"RTN","RMPREO",33,0)
 K ADATE,PDAY
"RTN","RMPREO",34,0)
 S RMPRA="",VALMCNT=0,RRX=""
"RTN","RMPREO",35,0)
 ;reverse order display
"RTN","RMPREO",36,0)
 F  S RMPRA=$O(^RMPR(668,"C",RMPRDFN,RMPRA),-1) Q:RMPRA=""  D
"RTN","RMPREO",37,0)
 .I $P(^RMPR(668,RMPRA,0),U,10)="X" Q
"RTN","RMPREO",38,0)
 .S VALMCNT=VALMCNT+1,LINE=VALMCNT
"RTN","RMPREO",39,0)
 .S RRX=$$SETFLD^VALM1(LINE,RRX,"LINE")
"RTN","RMPREO",40,0)
 .S CDATE=$P(^RMPR(668,RMPRA,0),U,1),CDATE=$$DAT1^RMPRUTL1(CDATE)
"RTN","RMPREO",41,0)
 .S RRX=$$SETFLD^VALM1(CDATE,RRX,"DATE")
"RTN","RMPREO",42,0)
 .S WHO1=""
"RTN","RMPREO",43,0)
 .I $P(^RMPR(668,RMPRA,0),U,11)'="" S WHO1=$$WHO^RMPREOU($P(^RMPR(668,RMPRA,0),U,11),12,RMPRA)
"RTN","RMPREO",44,0)
 .I $P($G(^RMPR(668,RMPRA,"IFC1")),U,3)'="" S WHO1=$$WHO^RMPREOU("",12,RMPRA)
"RTN","RMPREO",45,0)
 .;
"RTN","RMPREO",46,0)
 .S RRX=$$SETFLD^VALM1(WHO1,RRX,"WHO")
"RTN","RMPREO",47,0)
 .K WHO,WHO1
"RTN","RMPREO",48,0)
 .;type
"RTN","RMPREO",49,0)
 .S TYPE=$$TYPE^RMPREOU(RMPRA,8)
"RTN","RMPREO",50,0)
 .S RRX=$$SETFLD^VALM1(TYPE,RRX,"TYPE")
"RTN","RMPREO",51,0)
 .;display description if manual
"RTN","RMPREO",52,0)
 .;
"RTN","RMPREO",53,0)
 .S RRX=$$SETFLD^VALM1($$DES^RMPREOU(RMPRA,22),RRX,"DES")
"RTN","RMPREO",54,0)
 .;init activation date
"RTN","RMPREO",55,0)
 .S ADATE="",PDAY="",WRKDAY=""
"RTN","RMPREO",56,0)
 .S ADATE=$P(^RMPR(668,RMPRA,0),U,9)
"RTN","RMPREO",57,0)
 .I ADATE'="" S (PDAY,WRKDAY)=$$WRKDAY^RMPREOU(RMPRA)
"RTN","RMPREO",58,0)
 .I ADATE="" S (PDAY,WRKDAY)=$$CWRKDAY^RMPREOU(RMPRA)
"RTN","RMPREO",59,0)
 .S RRX=$$SETFLD^VALM1($$DAT1^RMPRUTL1(ADATE),RRX,"INITIAL ACTION DATE")
"RTN","RMPREO",60,0)
 .I ADATE'="" S CDAY=$$PDAY^RMPREOU(RMPRA) I CDAY>7 S PDAY="*"_WRKDAY
"RTN","RMPREO",61,0)
 .I ADATE=""&(WRKDAY>5) S PDAY="@"_WRKDAY
"RTN","RMPREO",62,0)
 .S RRX=$$SETFLD^VALM1(PDAY,RRX,"PDAY")
"RTN","RMPREO",63,0)
 .K ADATE,PDAY,WRKDAY,CDAY
"RTN","RMPREO",64,0)
 .;S R660=""
"RTN","RMPREO",65,0)
 .;F  S R660=$O(^RMPR(668,RMPRA,6,"B",R660)) Q:R660'>0  D
"RTN","RMPREO",66,0)
 .; .S RRX=$$SETFLD^VALM1($$ITEM^RMPREOU(R660,17),RRX,"ITEM")
"RTN","RMPREO",67,0)
 .S RRX=$$SETFLD^VALM1($$STATUS^RMPREOU(RMPRA,7),RRX,"STATUS")
"RTN","RMPREO",68,0)
 .S ^TMP($J,"RMPREO",LINE,0)=RRX
"RTN","RMPREO",69,0)
 .S ^TMP($J,"RMPREOEE",LINE,0)=RMPRA
"RTN","RMPREO",70,0)
 Q
"RTN","RMPREO",71,0)
 ;
"RTN","RMPREO",72,0)
 ;
"RTN","RMPREO",73,0)
SET(STRING,LINE,COLUMN,CLREND,ON,OFF) ;set array
"RTN","RMPREO",74,0)
 I '$D(@VALMAR@(LINE,0)) D SET^VALM10(LINE,$J("",80))
"RTN","RMPREO",75,0)
 D SET^VALM10(LINE,$$SETSTR^VALM1(STRING,@VALMAR@(LINE,0),COLUMN,CLREND))
"RTN","RMPREO",76,0)
 I $G(ON)]""!($G(OFF)]"") D CNTRL^VALM10(LINE,COLUMN,$L(STRING),ON,OFF)
"RTN","RMPREO",77,0)
 Q
"RTN","RMPREO",78,0)
 ;
"RTN","RMPREO",79,0)
 ;
"RTN","RMPREO",80,0)
HELP ; -- help code
"RTN","RMPREO",81,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","RMPREO",82,0)
 Q
"RTN","RMPREO",83,0)
 ;
"RTN","RMPREO",84,0)
EXIT ; -- exit code
"RTN","RMPREO",85,0)
 ;NOT XUSCLEAN
"RTN","RMPREO",86,0)
 K ^TMP($J,"RMPREO")
"RTN","RMPREO",87,0)
 K RMPRDFN
"RTN","RMPREO",88,0)
 Q
"RTN","RMPREO",89,0)
 ;
"RTN","RMPREO",90,0)
EXPND ; -- expand code
"RTN","RMPREO",91,0)
 Q
"RTN","RMPREO",92,0)
 ;
"RTN","RMPREOL")
0^8^B12020197^B11453654
"RTN","RMPREOL",1,0)
RMPREOL ;HINES/RVD  SUSPENSE PROCESSING/LINK TO 2319 ; 14-AUG-2001
"RTN","RMPREOL",2,0)
 ;;3.0;PROSTHETICS;**62,83**;Feb 09, 1996;Build 20
"RTN","RMPREOL",3,0)
 ;
"RTN","RMPREOL",4,0)
 ;HNC #83 add free text ordering provider 3/11/05
"RTN","RMPREOL",5,0)
 ;
"RTN","RMPREOL",6,0)
 ; RVD patch #62 - new routine for suspense list template.
"RTN","RMPREOL",7,0)
 ;                 if link to 2319 record is needed. 
"RTN","RMPREOL",8,0)
EN ; -- main entry point for RMPREO
"RTN","RMPREOL",9,0)
 D ^%ZISC
"RTN","RMPREOL",10,0)
 N STRING,CLREND,COLUMN,LINE,ON,OFF
"RTN","RMPREOL",11,0)
 ;get patient to test with
"RTN","RMPREOL",12,0)
 K ^TMP($J,"RMPREO")
"RTN","RMPREOL",13,0)
 K ^TMP($J,"RMPREOEE")
"RTN","RMPREOL",14,0)
 ;ask station
"RTN","RMPREOL",15,0)
 I '$D(RMPR) D DIV4^RMPRSIT Q:$D(X)
"RTN","RMPREOL",16,0)
 I '$D(RMPRDFN) D GETPAT^RMPRUTIL Q:'$D(RMPRDFN)
"RTN","RMPREOL",17,0)
 D EN^VALM("RMPREO LINK 2319")
"RTN","RMPREOL",18,0)
 Q
"RTN","RMPREOL",19,0)
 ;
"RTN","RMPREOL",20,0)
HDR ; -- header code
"RTN","RMPREOL",21,0)
 N VA,VADM
"RTN","RMPREOL",22,0)
 S DFN=RMPRDFN
"RTN","RMPREOL",23,0)
 D DEM^VADPT
"RTN","RMPREOL",24,0)
 ;S VALMHDR(1)="Suspense Processing"
"RTN","RMPREOL",25,0)
 S VALMHDR(1)="Open/Pending/Closed Suspense for "_$$LOWER^VALM1(VADM(1))_"  ("_$P(VADM(2),U,2)_")"
"RTN","RMPREOL",26,0)
 D KVAR^VADPT
"RTN","RMPREOL",27,0)
 K ^TMP($J,"RMPREO"),^TMP($J,"RMPREOEE")
"RTN","RMPREOL",28,0)
 Q
"RTN","RMPREOL",29,0)
 ;
"RTN","RMPREOL",30,0)
INIT ; -- init variables and list array
"RTN","RMPREOL",31,0)
 K ^TMP($J,"RMPREO"),^TMP($J,"RMPREOEE")
"RTN","RMPREOL",32,0)
 D HDR
"RTN","RMPREOL",33,0)
 N RMPRA,CDATE,LINE,X
"RTN","RMPREOL",34,0)
 ;start loop
"RTN","RMPREOL",35,0)
 ;
"RTN","RMPREOL",36,0)
 K ADATE,PDAY
"RTN","RMPREOL",37,0)
 S RMPRA="",VALMCNT=0,RRX=""
"RTN","RMPREOL",38,0)
 ;reverse order display
"RTN","RMPREOL",39,0)
 F  S RMPRA=$O(^RMPR(668,"C",RMPRDFN,RMPRA),-1) Q:RMPRA=""  D
"RTN","RMPREOL",40,0)
 .I $P(^RMPR(668,RMPRA,0),U,10)="X" Q
"RTN","RMPREOL",41,0)
 .I $G(RMSUCLFG),'$D(RM68LINK(RMPRA)) Q
"RTN","RMPREOL",42,0)
 .S VALMCNT=VALMCNT+1,LINE=VALMCNT
"RTN","RMPREOL",43,0)
 .S RRX=$$SETFLD^VALM1(LINE,RRX,"LINE")
"RTN","RMPREOL",44,0)
 .S CDATE=$P(^RMPR(668,RMPRA,0),U,1),CDATE=$$DAT1^RMPRUTL1(CDATE)
"RTN","RMPREOL",45,0)
 .S RRX=$$SETFLD^VALM1(CDATE,RRX,"DATE")
"RTN","RMPREOL",46,0)
 .S WHO1=""
"RTN","RMPREOL",47,0)
 .I $P(^RMPR(668,RMPRA,0),U,11)'="" S WHO1=$$WHO^RMPREOU($P(^RMPR(668,RMPRA,0),U,11),12)
"RTN","RMPREOL",48,0)
 .I $P($G(^RMPR(668,RMPRA,"IFC1")),U,3)'="" S WHO1=$$WHO^RMPREOU("",12,RMPRA)
"RTN","RMPREOL",49,0)
 .;
"RTN","RMPREOL",50,0)
 .S RRX=$$SETFLD^VALM1(WHO1,RRX,"WHO")
"RTN","RMPREOL",51,0)
 .K WHO,WHO1
"RTN","RMPREOL",52,0)
 .;type
"RTN","RMPREOL",53,0)
 .S TYPE=$$TYPE^RMPREOU(RMPRA,8)
"RTN","RMPREOL",54,0)
 .S RRX=$$SETFLD^VALM1(TYPE,RRX,"TYPE")
"RTN","RMPREOL",55,0)
 .;display description if manual
"RTN","RMPREOL",56,0)
 .;
"RTN","RMPREOL",57,0)
 .S RRX=$$SETFLD^VALM1($$DES^RMPREOU(RMPRA,22),RRX,"DES")
"RTN","RMPREOL",58,0)
 .;init activation date
"RTN","RMPREOL",59,0)
 .S ADATE="",PDAY="",WRKDAY=""
"RTN","RMPREOL",60,0)
 .S ADATE=$P(^RMPR(668,RMPRA,0),U,9)
"RTN","RMPREOL",61,0)
 .I ADATE'="" S (PDAY,WRKDAY)=$$WRKDAY^RMPREOU(RMPRA)
"RTN","RMPREOL",62,0)
 .I ADATE="" S (PDAY,WRKDAY)=$$CWRKDAY^RMPREOU(RMPRA)
"RTN","RMPREOL",63,0)
 .S RRX=$$SETFLD^VALM1($$DAT1^RMPRUTL1(ADATE),RRX,"INITIAL ACTION DATE")
"RTN","RMPREOL",64,0)
 .I ADATE'="" S CDAY=$$PDAY^RMPREOU(RMPRA) I CDAY>7 S PDAY="*"_WRKDAY
"RTN","RMPREOL",65,0)
 .I ADATE=""&(WRKDAY>5) S PDAY="@"_WRKDAY
"RTN","RMPREOL",66,0)
 .S RRX=$$SETFLD^VALM1(PDAY,RRX,"PDAY")
"RTN","RMPREOL",67,0)
 .K ADATE,PDAY,WRKDAY,CDAY
"RTN","RMPREOL",68,0)
 .;S R660=""
"RTN","RMPREOL",69,0)
 .;F  S R660=$O(^RMPR(668,RMPRA,6,"B",R660)) Q:R660'>0  D
"RTN","RMPREOL",70,0)
 .; .S RRX=$$SETFLD^VALM1($$ITEM^RMPREOU(R660,17),RRX,"ITEM")
"RTN","RMPREOL",71,0)
 .S RRX=$$SETFLD^VALM1($$STATUS^RMPREOU(RMPRA,7),RRX,"STATUS")
"RTN","RMPREOL",72,0)
 .S ^TMP($J,"RMPREO",LINE,0)=RRX
"RTN","RMPREOL",73,0)
 .S ^TMP($J,"RMPREOEE",LINE,0)=RMPRA
"RTN","RMPREOL",74,0)
 Q
"RTN","RMPREOL",75,0)
 ;
"RTN","RMPREOL",76,0)
 ;
"RTN","RMPREOL",77,0)
SET(STRING,LINE,COLUMN,CLREND,ON,OFF) ;set array
"RTN","RMPREOL",78,0)
 I '$D(@VALMAR@(LINE,0)) D SET^VALM10(LINE,$J("",80))
"RTN","RMPREOL",79,0)
 D SET^VALM10(LINE,$$SETSTR^VALM1(STRING,@VALMAR@(LINE,0),COLUMN,CLREND))
"RTN","RMPREOL",80,0)
 I $G(ON)]""!($G(OFF)]"") D CNTRL^VALM10(LINE,COLUMN,$L(STRING),ON,OFF)
"RTN","RMPREOL",81,0)
 Q
"RTN","RMPREOL",82,0)
 ;
"RTN","RMPREOL",83,0)
 ;
"RTN","RMPREOL",84,0)
HELP ; -- help code
"RTN","RMPREOL",85,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","RMPREOL",86,0)
 Q
"RTN","RMPREOL",87,0)
 ;
"RTN","RMPREOL",88,0)
EXIT ; -- exit code
"RTN","RMPREOL",89,0)
 ;NOT XUSCLEAN
"RTN","RMPREOL",90,0)
 ;added by patch #62
"RTN","RMPREOL",91,0)
 ;if transaction still exist for linking, print message and re-link
"RTN","RMPREOL",92,0)
 I $D(^TMP($J,"RMPRPCE")) D  G:RMENTSUS="L" EN
"RTN","RMPREOL",93,0)
 .S RMQUIT=0
"RTN","RMPREOL",94,0)
 .W @IOF D SMESS0^RMPRPCEL,CDIR^RMPRPCEL
"RTN","RMPREOL",95,0)
 K ^TMP($J,"RMPREO"),^TMP($J,"RMPREOEE")
"RTN","RMPREOL",96,0)
 Q
"RTN","RMPREOL",97,0)
 ;
"RTN","RMPREOL",98,0)
EXPND ; -- expand code
"RTN","RMPREOL",99,0)
 Q
"RTN","RMPREOU")
0^3^B19592813^B17695537
"RTN","RMPREOU",1,0)
RMPREOU ;HINES/HNC -Suspense Processing Utility  ;2-2-2000
"RTN","RMPREOU",2,0)
 ;;3.0;PROSTHETICS;**45,55,59,135,83**;Feb 09, 1996;Build 20
"RTN","RMPREOU",3,0)
 ; Add new function for working days M-F.
"RTN","RMPREOU",4,0)
 ;
"RTN","RMPREOU",5,0)
 ;HNC - #83, add free text ordering provider to tag WHO 3/11/05
"RTN","RMPREOU",6,0)
 ;
"RTN","RMPREOU",7,0)
 Q
"RTN","RMPREOU",8,0)
 ;
"RTN","RMPREOU",9,0)
ITEM(DA,RL) ;psas hcpcs space item name
"RTN","RMPREOU",10,0)
 ;parm 1=ien 660
"RTN","RMPREOU",11,0)
 ;parm 2=string length
"RTN","RMPREOU",12,0)
 N DIC,DIQ,DR,ITEM
"RTN","RMPREOU",13,0)
 S DIC=660,DIQ="RE",DR="4:4.5",DIQ(0)="EN" D EN^DIQ1
"RTN","RMPREOU",14,0)
 S ITEM=$G(RE(660,DA,4.5,"E"))_" "_$G(RE(660,DA,4,"E"))
"RTN","RMPREOU",15,0)
 I $G(RL) S ITEM=$E(ITEM,0,RL)
"RTN","RMPREOU",16,0)
 K RE Q ITEM
"RTN","RMPREOU",17,0)
 ;
"RTN","RMPREOU",18,0)
 Q
"RTN","RMPREOU",19,0)
PWRKDAY(DA)     ;working days between init action and current dateM-F.
"RTN","RMPREOU",20,0)
 ;holidays are counted as working days
"RTN","RMPREOU",21,0)
 ;parm 1=ien 668, DA
"RTN","RMPREOU",22,0)
 ;
"RTN","RMPREOU",23,0)
 N RMTO,RB,RE
"RTN","RMPREOU",24,0)
 S RB=$P($G(^RMPR(668,DA,0)),U,9)
"RTN","RMPREOU",25,0)
 Q:RB="" 0
"RTN","RMPREOU",26,0)
 S RE=DT
"RTN","RMPREOU",27,0)
 Q:RE="" 0
"RTN","RMPREOU",28,0)
 D WDAY
"RTN","RMPREOU",29,0)
 Q RMTO
"RTN","RMPREOU",30,0)
 Q
"RTN","RMPREOU",31,0)
 ;
"RTN","RMPREOU",32,0)
TYPE(DA,RL) ;type of consult, suspense
"RTN","RMPREOU",33,0)
 ;parm 1=ien 668
"RTN","RMPREOU",34,0)
 ;parm 2=string length optional
"RTN","RMPREOU",35,0)
 N DIC,DIQ,DR,TYPE
"RTN","RMPREOU",36,0)
 S DIC=668,DIQ="RE",DR=9,DIQ(0)="EN" D EN^DIQ1
"RTN","RMPREOU",37,0)
 S TYPE=$G(RE(668,DA,9,"E"))
"RTN","RMPREOU",38,0)
 I $G(RL) S TYPE=$E(TYPE,0,RL)
"RTN","RMPREOU",39,0)
 K RE Q TYPE
"RTN","RMPREOU",40,0)
 ;
"RTN","RMPREOU",41,0)
 ;
"RTN","RMPREOU",42,0)
 Q
"RTN","RMPREOU",43,0)
PDAY(DA) ;days between create and init action
"RTN","RMPREOU",44,0)
 ;parm 1=ien 668
"RTN","RMPREOU",45,0)
 N PDAY,X1,X2
"RTN","RMPREOU",46,0)
 S PDAY=""
"RTN","RMPREOU",47,0)
 S X2=$P($G(^RMPR(668,DA,0)),U,1)
"RTN","RMPREOU",48,0)
 Q:X2="" PDAY
"RTN","RMPREOU",49,0)
 S X1=$P($G(^RMPR(668,DA,0)),U,9)
"RTN","RMPREOU",50,0)
 I X1="" S:$D(RMPRCD) X1=RMPRCD
"RTN","RMPREOU",51,0)
 ;Q:X1="" PDAY
"RTN","RMPREOU",52,0)
 D ^%DTC
"RTN","RMPREOU",53,0)
 Q X
"RTN","RMPREOU",54,0)
 ;
"RTN","RMPREOU",55,0)
 Q
"RTN","RMPREOU",56,0)
DES(DA,RL) ;description for manual
"RTN","RMPREOU",57,0)
 ;parm 1=ien 668
"RTN","RMPREOU",58,0)
 ;parm 2=string length optional
"RTN","RMPREOU",59,0)
 N DES
"RTN","RMPREOU",60,0)
 S DES=$G(^RMPR(668,DA,2,1,0))
"RTN","RMPREOU",61,0)
 I DES="" Q DES
"RTN","RMPREOU",62,0)
 I $G(RL) S DES=$E(DES,0,RL)
"RTN","RMPREOU",63,0)
 Q DES
"RTN","RMPREOU",64,0)
 ;
"RTN","RMPREOU",65,0)
STATUS(DA,RL) ;status of suspense, open, pending, closed
"RTN","RMPREOU",66,0)
 N DIC,DIQ,DR,STATUS
"RTN","RMPREOU",67,0)
 S DIC=668,DIQ="RE",DR=14,DIQ(0)="EN" D EN^DIQ1
"RTN","RMPREOU",68,0)
 S STATUS=$G(RE(668,DA,14,"E"))
"RTN","RMPREOU",69,0)
 I STATUS="" S STATUS="UNKNOWN"
"RTN","RMPREOU",70,0)
 I $G(RL) S STATUS=$E(STATUS,0,RL)
"RTN","RMPREOU",71,0)
 K RE Q STATUS
"RTN","RMPREOU",72,0)
 ;
"RTN","RMPREOU",73,0)
WHO(DA,RL,RMPRA) ;requestor or provider
"RTN","RMPREOU",74,0)
 ;DA ien to file 200
"RTN","RMPREOU",75,0)
 ;RL length of return string
"RTN","RMPREOU",76,0)
 ;RMPRA ien to file 668
"RTN","RMPREOU",77,0)
 N DIC,DIQ,DR,WHO
"RTN","RMPREOU",78,0)
 S WHO=""
"RTN","RMPREOU",79,0)
 I DA="" S WHO=$P($G(^RMPR(668,RMPRA,"IFC1")),U,3)
"RTN","RMPREOU",80,0)
 I (WHO'="")&($G(RL)'="") S WHO=$E(WHO,0,RL)
"RTN","RMPREOU",81,0)
 I WHO'="" Q WHO
"RTN","RMPREOU",82,0)
 S DIC=200,DIQ="RE",DR=.01,DIQ(0)="EN" D EN^DIQ1
"RTN","RMPREOU",83,0)
 S WHO=$G(RE(200,DA,.01,"E"))
"RTN","RMPREOU",84,0)
 I $G(RL) S WHO=$E(WHO,0,RL)
"RTN","RMPREOU",85,0)
 K RE Q WHO
"RTN","RMPREOU",86,0)
 ;
"RTN","RMPREOU",87,0)
 Q
"RTN","RMPREOU",88,0)
NUM ;pick number from list
"RTN","RMPREOU",89,0)
 K DIR S DIR(0)="LO^"_VALMBG_":"_VALMLST D ^DIR
"RTN","RMPREOU",90,0)
 Q
"RTN","RMPREOU",91,0)
 ;
"RTN","RMPREOU",92,0)
NUM2 ;pick a single number from a list
"RTN","RMPREOU",93,0)
 K DIR S DIR(0)="N^"_VALMBG_":"_VALMLST D ^DIR
"RTN","RMPREOU",94,0)
 Q
"RTN","RMPREOU",95,0)
 ;
"RTN","RMPREOU",96,0)
WRKDAY(DA)        ;working days between create and init action M-F.
"RTN","RMPREOU",97,0)
 ;holidays are counted as working days
"RTN","RMPREOU",98,0)
 ;parm 1=ien 668, DA
"RTN","RMPREOU",99,0)
 ;
"RTN","RMPREOU",100,0)
 N RMTO,RB,RE
"RTN","RMPREOU",101,0)
 S RB=$P($G(^RMPR(668,DA,0)),U,1)
"RTN","RMPREOU",102,0)
 Q:RB="" 0
"RTN","RMPREOU",103,0)
 S RE=$P($G(^RMPR(668,DA,0)),U,9)
"RTN","RMPREOU",104,0)
 Q:RE="" 0
"RTN","RMPREOU",105,0)
 D WDAY
"RTN","RMPREOU",106,0)
 Q RMTO
"RTN","RMPREOU",107,0)
CWRKDAY(DA) ;working days based on today for open records.
"RTN","RMPREOU",108,0)
 ;holidays are counted as working days
"RTN","RMPREOU",109,0)
 ;parm 1=ien 668, DA
"RTN","RMPREOU",110,0)
 N RMTO,RB,RE
"RTN","RMPREOU",111,0)
 S RB=$P($G(^RMPR(668,DA,0)),U,1)
"RTN","RMPREOU",112,0)
 Q:RB="" 0
"RTN","RMPREOU",113,0)
 S RE=DT
"RTN","RMPREOU",114,0)
 D WDAY
"RTN","RMPREOU",115,0)
 Q RMTO
"RTN","RMPREOU",116,0)
CANWKDY(DA) ;*135 working days between create and cancel date for cancel w/o initial action records.
"RTN","RMPREOU",117,0)
 ;holidays are counted as working days
"RTN","RMPREOU",118,0)
 ;parm 1=ien 668, DA
"RTN","RMPREOU",119,0)
 N RMTO,RB,RE
"RTN","RMPREOU",120,0)
 S RB=$P($G(^RMPR(668,DA,0)),U)
"RTN","RMPREOU",121,0)
 Q:RB="" 0
"RTN","RMPREOU",122,0)
 S RE=$P(^RMPR(668,DA,5),U)
"RTN","RMPREOU",123,0)
 Q:RE="" 0
"RTN","RMPREOU",124,0)
 D WDAY
"RTN","RMPREOU",125,0)
 Q RMTO
"RTN","RMPREOU",126,0)
WDAY ;       RB - begining date
"RTN","RMPREOU",127,0)
 ;       RE - ending date
"RTN","RMPREOU",128,0)
 ;Return variable:
"RTN","RMPREOU",129,0)
 ;       RMTO - working days
"RTN","RMPREOU",130,0)
 ;Changed 03/26/03 to make a call to XUWORKDY to not count Holidays
"RTN","RMPREOU",131,0)
 ;In order to not couont Holidays the site must keep the Holiday file 
"RTN","RMPREOU",132,0)
 ;current.
"RTN","RMPREOU",133,0)
 S RMTO=$$EN^XUWORKDY(RB,RE)
"RTN","RMPREOU",134,0)
 Q
"RTN","RMPREOU",135,0)
 ;Set days as Monday the FIRST day and so on:
"RTN","RMPREOU",136,0)
 ;       Monday    = 1
"RTN","RMPREOU",137,0)
 ;       Sunday    = 7
"RTN","RMPREOU",138,0)
 ;If invalid dates, return ZERO.
"RTN","RMPREOU",139,0)
 N X,Y,RMB,RME,RMTOT,RDSDAY,RDEDAY,RBCA,RNOB,RMNOD,RECA,RNO
"RTN","RMPREOU",140,0)
1 S X1=RE,X2=RB D ^%DTC S RMNOD=X
"RTN","RMPREOU",141,0)
 S (RMTO,RMTOT,RECA)=0
"RTN","RMPREOU",142,0)
 S X=RB D DW^%DTC S RMB=X
"RTN","RMPREOU",143,0)
 S X=RE D DW^%DTC S RME=X
"RTN","RMPREOU",144,0)
 I (RB=RE)!(RB>RE)!(RMNOD'>0) Q
"RTN","RMPREOU",145,0)
 ;Get the FIRST set of Monday to Sunday days.
"RTN","RMPREOU",146,0)
 S RDSDAY=$S(RMB["MON":1,RMB["TUE":2,RMB["WED":3,RMB["THU":4,RMB["FRI":5,RMB["SAT":6,RMB["SUN":7,1:0)
"RTN","RMPREOU",147,0)
 S RNOB=$S(RDSDAY=1:4,RDSDAY=2:3,RDSDAY=3:2,RDSDAY=4:1,1:0)
"RTN","RMPREOU",148,0)
 I RNOB=4,RMNOD<7 S RNOB=$S(RMNOD=1:1,RMNOD=2:2,RMNOD=3:3,1:4)
"RTN","RMPREOU",149,0)
 I RNOB=3,RMNOD<6 S RNOB=$S(RMNOD=1:1,RMNOD=2:2,1:3)
"RTN","RMPREOU",150,0)
 I RNOB=2,RMNOD<5 S RNOB=$S(RMNOD=1:1,1:2)
"RTN","RMPREOU",151,0)
 S RBCA=7-RDSDAY
"RTN","RMPREOU",152,0)
 S RMNOD=RMNOD-RBCA
"RTN","RMPREOU",153,0)
 ;Get the SECOND set of Monday to Sunday days.
"RTN","RMPREOU",154,0)
 S RDEDAY=$S(RME["MON":1,RME["TUE":2,RME["WED":3,RME["THU":4,RME["FRI":5,RME["SAT":6,RME["SUN":7,1:0)
"RTN","RMPREOU",155,0)
 I RMNOD>0 D
"RTN","RMPREOU",156,0)
 .S RECA=$S(RDEDAY=7:5,RDEDAY=6:5,1:RDEDAY)
"RTN","RMPREOU",157,0)
 .S RMNOD=RMNOD-RDEDAY
"RTN","RMPREOU",158,0)
 ;
"RTN","RMPREOU",159,0)
 ;calculate totals
"RTN","RMPREOU",160,0)
 S RMTOT=RMTOT+RNOB+RECA
"RTN","RMPREOU",161,0)
 I RMNOD>0,RMNOD<6 S RMTOT=RMTOT+RMNOD
"RTN","RMPREOU",162,0)
 I RMNOD=6 S RMTOT=RMTOT+RMNOD-1
"RTN","RMPREOU",163,0)
 I RMNOD=7 S RMTOT=RMTOT+RMNOD-2
"RTN","RMPREOU",164,0)
 ;if the FIRST and SECOND set of Monday to Sunday total is
"RTN","RMPREOU",165,0)
 ;still greater than 7 days, exclude Saturday and Sunday - don't count.
"RTN","RMPREOU",166,0)
 I RMNOD>7 S RMTOT=RMTOT+(RMNOD-((RMNOD/7)*2))
"RTN","RMPREOU",167,0)
 S RMTO=$J(RMTOT,0,0)
"RTN","RMPREOU",168,0)
END ;
"RTN","RMPRFC3")
0^6^B5404403^n/a
"RTN","RMPRFC3",1,0)
RMPRFC3 ;HINES CIOFO/HNC - Process IFC HL7 ; 2/6/09
"RTN","RMPRFC3",2,0)
 ;;3.0;PROSTHETICS;**83**;Feb 09,1996;Build 20
"RTN","RMPRFC3",3,0)
 ;
"RTN","RMPRFC3",4,0)
 ;
"RTN","RMPRFC3",5,0)
 ;Helen Corkwell-new flow 3/9/05
"RTN","RMPRFC3",6,0)
 ;
"RTN","RMPRFC3",7,0)
 ; Patch 83 - 
"RTN","RMPRFC3",8,0)
 ;          - Prohibit filing data in 668 if code runs at sending site
"RTN","RMPRFC3",9,0)
 ;          - Exit if NW record in consults and 668; and if DC and is dup
"RTN","RMPRFC3",10,0)
 ; 
"RTN","RMPRFC3",11,0)
 Q
"RTN","RMPRFC3",12,0)
EN ;process IFC responses
"RTN","RMPRFC3",13,0)
 ;load message in ^TMP
"RTN","RMPRFC3",14,0)
 K ^TMP("RMPRIF",$J)
"RTN","RMPRFC3",15,0)
 N HLNODE,SEG,I  ;production code
"RTN","RMPRFC3",16,0)
 F I=1:1 X HLNEXT Q:HLQUIT'>0  D
"RTN","RMPRFC3",17,0)
 .I $P(HLNODE,"|")="OBX" D
"RTN","RMPRFC3",18,0)
 ..S ^TMP("RMPRIF",$J,"OBX",$P(HLNODE,"|",2),$P(HLNODE,"|",5))=$E(HLNODE,5,999)
"RTN","RMPRFC3",19,0)
 .I $P(HLNODE,"|")="NTE" D
"RTN","RMPRFC3",20,0)
 ..S ^TMP("RMPRIF",$J,"NTE",$P(HLNODE,"|",2))=$E(HLNODE,5,999)
"RTN","RMPRFC3",21,0)
 .I "OBXNTE"'[$P(HLNODE,"|") D
"RTN","RMPRFC3",22,0)
 ..S ^TMP("RMPRIF",$J,$P(HLNODE,"|"))=$E(HLNODE,5,999)
"RTN","RMPRFC3",23,0)
 ;
"RTN","RMPRFC3",24,0)
CHK ;
"RTN","RMPRFC3",25,0)
 ;DC does not have a OBR segment, must check status first
"RTN","RMPRFC3",26,0)
 ;
"RTN","RMPRFC3",27,0)
 ;
"RTN","RMPRFC3",28,0)
 ;is it a NW or DC order?
"RTN","RMPRFC3",29,0)
 I '$D(^TMP("RMPRIF",$J,"ORC")) G EXIT
"RTN","RMPRFC3",30,0)
 S RMPRST=$P(^TMP("RMPRIF",$J,"ORC"),"|",1)
"RTN","RMPRFC3",31,0)
 I RMPRST="OD" S RMPRST=$P(^TMP("RMPRIF",$J,"ORC"),"|",5)
"RTN","RMPRFC3",32,0)
 I (RMPRST'="NW")&(RMPRST'="DC") G EXIT
"RTN","RMPRFC3",33,0)
 ;
"RTN","RMPRFC3",34,0)
 I '$D(^TMP("RMPRIF",$J,"OBR"))&(RMPRST'="DC") G EXIT
"RTN","RMPRFC3",35,0)
 I RMPRST="NW"&($P($G(^TMP("RMPRIF",$J,"OBR")),"|",4)'["PROSTHETICS IFC") G EXIT
"RTN","RMPRFC3",36,0)
 ;
"RTN","RMPRFC3",37,0)
 ;is it a discontinued order? does it have a consult ien?
"RTN","RMPRFC3",38,0)
 ;is there a local consult ien? has it already been filed in 668?
"RTN","RMPRFC3",39,0)
 I RMPRST="NW" D
"RTN","RMPRFC3",40,0)
 .S RMPR123=$P(^TMP("RMPRIF",$J,"OBR"),"|",2)
"RTN","RMPRFC3",41,0)
 .S RMPR123I=$P(RMPR123,U,1),RMPRISIT=$P(RMPR123,U,2)
"RTN","RMPRFC3",42,0)
 ;
"RTN","RMPRFC3",43,0)
 I RMPRST="DC" D
"RTN","RMPRFC3",44,0)
 .S RMPR123=$P(^TMP("RMPRIF",$J,"ORC"),"|",3)
"RTN","RMPRFC3",45,0)
 .S RMPR123I=$P(RMPR123,U,1),RMPRISIT=$P(RMPR123,U,2)
"RTN","RMPRFC3",46,0)
 .S RMPR123A=RMPR123I
"RTN","RMPRFC3",47,0)
TST ;
"RTN","RMPRFC3",48,0)
 ;Consult IEN
"RTN","RMPRFC3",49,0)
 I RMPRST="NW" D
"RTN","RMPRFC3",50,0)
 .S RMPR123A=$O(^GMR(123,"AIFC",RMPRISIT,RMPR123I,0))
"RTN","RMPRFC3",51,0)
 ;
"RTN","RMPRFC3",52,0)
 I RMPR123A="" G EXIT
"RTN","RMPRFC3",53,0)
 ;added check, when HL7 link is down possible to get mult NW msg
"RTN","RMPRFC3",54,0)
 ;8/23/05 hnc
"RTN","RMPRFC3",55,0)
 ; modified check, EXIT imm. on NW message, loop On 668 "D" xref to determine if dup DC
"RTN","RMPRFC3",56,0)
 ; 13 MAR 09  DDA
"RTN","RMPRFC3",57,0)
 I RMPRST="NW" G:$D(^RMPR(668,"D",RMPR123A)) EXIT
"RTN","RMPRFC3",58,0)
 I RMPRST="DC" S RMPRDPDC=0 D
"RTN","RMPRFC3",59,0)
 .S RMPRDCIN="" F  S RMPRDCIN=$O(^RMPR(668,"D",RMPR123A,RMPRDCIN)) Q:RMPRDCIN=""  D
"RTN","RMPRFC3",60,0)
 ..S:^RMPR(668,RMPRDCIN,2,1,0)["****DISCONTINUED****" RMPRDPDC=1
"RTN","RMPRFC3",61,0)
 ..Q
"RTN","RMPRFC3",62,0)
 .Q
"RTN","RMPRFC3",63,0)
 I $G(RMPRDPDC)=1 G EXIT
"RTN","RMPRFC3",64,0)
 S ^TMP("RMPRIF",$J,"GOODTOGO")="OKAY"
"RTN","RMPRFC3",65,0)
 G EN^RMPRFC4
"RTN","RMPRFC3",66,0)
 Q
"RTN","RMPRFC3",67,0)
 ;
"RTN","RMPRFC3",68,0)
EXIT ;common exit point
"RTN","RMPRFC3",69,0)
 K ^TMP("RMPRIF",$J)
"RTN","RMPRFC3",70,0)
 G EXIT^RMPRFC4
"RTN","RMPRFC3",71,0)
 ;END
"RTN","RMPRFC4")
0^7^B13693524^n/a
"RTN","RMPRFC4",1,0)
RMPRFC4 ;HINES CIOFO/HNC - Create 668 Record; 2/06/09
"RTN","RMPRFC4",2,0)
 ;;3.0;PROSTHETICS;**83**;Feb 09, 1996;Build 20
"RTN","RMPRFC4",3,0)
 ;
"RTN","RMPRFC4",4,0)
 ;Helen Corkwell-new flow 3/9/05
"RTN","RMPRFC4",5,0)
 ;
"RTN","RMPRFC4",6,0)
 ; Patch 83 v18 - DC consult w/no 668 record error fixed
"RTN","RMPRFC4",7,0)
 ; Patch 83 v19 - DC consult properly display ****Discontinued**** in 668
"RTN","RMPRFC4",8,0)
 ;                NW no longer errors if there is no ICD9 data
"RTN","RMPRFC4",9,0)
 Q
"RTN","RMPRFC4",10,0)
EN ;
"RTN","RMPRFC4",11,0)
 ;RMPRISIT is station ien to 4
"RTN","RMPRFC4",12,0)
 ;RMPR123A is consult ien to 123
"RTN","RMPRFC4",13,0)
 ;RMPRFORM is form type other
"RTN","RMPRFC4",14,0)
 ;RMPRTYPE is IFC new with patch
"RTN","RMPRFC4",15,0)
 ;RMPRSTAT is status, open
"RTN","RMPRFC4",16,0)
 ;RMPROPRO is ordering provider free text
"RTN","RMPRFC4",17,0)
 ;RMPRMPI is Master Patient Index
"RTN","RMPRFC4",18,0)
 ;RMPRDFN is DFN
"RTN","RMPRFC4",19,0)
 I RMPRST="NW" D
"RTN","RMPRFC4",20,0)
 .S RMPRMPI=$P($G(^TMP("RMPRIF",$J,"PID")),"|",2)
"RTN","RMPRFC4",21,0)
 .S RMPRDFN=$$GETDFN^MPIF001(RMPRMPI)
"RTN","RMPRFC4",22,0)
 I $D(^TMP("RMPRIF",$J,"OBX",1)) D
"RTN","RMPRFC4",23,0)
 . D TRIMWP^RMPRFC5($NA(^TMP("RMPRIF",$J,"OBX",1)),5)
"RTN","RMPRFC4",24,0)
 ;return sample
"RTN","RMPRFC4",25,0)
 ;^TMP("RMPRIF",570428439,"OBX",1,1) = Test #2
"RTN","RMPRFC4",26,0)
 ;
"RTN","RMPRFC4",27,0)
 ;ICD9
"RTN","RMPRFC4",28,0)
 I RMPRST="NW" D
"RTN","RMPRFC4",29,0)
 .S RMPRPD9=$P($G(^TMP("RMPRIF",$J,"OBX",2,1)),"|",5)
"RTN","RMPRFC4",30,0)
 .I RMPRPD9="" S RMPRICD9=""
"RTN","RMPRFC4",31,0)
 .I RMPRPD9'="" S RMPRICD9=$P(RMPRPD9,U,1)
"RTN","RMPRFC4",32,0)
 .I RMPRICD9="" S RMPRICD=""
"RTN","RMPRFC4",33,0)
 .I RMPRICD9'="" S RMPRICD=$$ICDDX^ICDCODE(RMPRICD9,DT)
"RTN","RMPRFC4",34,0)
 .;date rx written
"RTN","RMPRFC4",35,0)
 .S RMPRDRXW=$P($G(^TMP("RMPRIF",$J,"OBR")),"|",6)
"RTN","RMPRFC4",36,0)
 .I RMPRDRXW'="" S RMPRDRXW=$$FMDATE^HLFNC(RMPRDRXW)
"RTN","RMPRFC4",37,0)
 .;
"RTN","RMPRFC4",38,0)
 .S RMPRFORM=9
"RTN","RMPRFC4",39,0)
 .S RMPRTYPE=9
"RTN","RMPRFC4",40,0)
 .S RMPRSTAT="O"
"RTN","RMPRFC4",41,0)
 .S RMPROPRO=$P($G(^TMP("RMPRIF",$J,"OBR")),"|",16)
"RTN","RMPRFC4",42,0)
 .I RMPROPRO'="" S RMPROPRO=$P(RMPROPRO,U,1)_","_$P(RMPROPRO,U,2)_" "_$P(RMPROPRO,U,3)
"RTN","RMPRFC4",43,0)
 ;discontinued data from 1st 668 record
"RTN","RMPRFC4",44,0)
 I RMPRST="DC" D
"RTN","RMPRFC4",45,0)
 .S RMPR668=0
"RTN","RMPRFC4",46,0)
 .S RMPR668=$O(^RMPR(668,"D",RMPR123A,RMPR668))
"RTN","RMPRFC4",47,0)
 .I RMPR668="" S ^TMP("RMPRIF",$J,"RMPR668")="NOT DEFINED" Q
"RTN","RMPRFC4",48,0)
 .S RMPRICD=$P($G(^RMPR(668,RMPR668,8)),U,3)
"RTN","RMPRFC4",49,0)
 .S RMPRDIAG=$P($G(^RMPR(668,RMPR668,8)),U,2)
"RTN","RMPRFC4",50,0)
 .S RMPROPRO=$P($G(^RMPR(668,RMPR668,"IFC1")),U,3)
"RTN","RMPRFC4",51,0)
 .S RMPRDRXW=$P($G(^RMPR(668,RMPR668,0)),U,16)
"RTN","RMPRFC4",52,0)
 .S RMPRDFN=$P($G(^RMPR(668,RMPR668,0)),U,2)
"RTN","RMPRFC4",53,0)
 .; STATION NEEDS TO BE SAME AS ORIGINAL IFC, NOT WHAT IS IN ORC SEGMENT
"RTN","RMPRFC4",54,0)
 .S RMPRISIT=$P($G(^RMPR(668,RMPR668,0)),U,7)
"RTN","RMPRFC4",55,0)
 .S RMPRTYPE=10
"RTN","RMPRFC4",56,0)
 .S RMPRSTAT="O"
"RTN","RMPRFC4",57,0)
 .S RMPRFORM=9
"RTN","RMPRFC4",58,0)
 ;create new record
"RTN","RMPRFC4",59,0)
 ;
"RTN","RMPRFC4",60,0)
 I +$G(RMPRDFN)'>0 G EXIT  ;No patient
"RTN","RMPRFC4",61,0)
 ;
"RTN","RMPRFC4",62,0)
 I $D(^TMP("RMPRIF",$J,"RMPR668")) G EXIT
"RTN","RMPRFC4",63,0)
 D NOW^%DTC S X=%
"RTN","RMPRFC4",64,0)
 S DIC="^RMPR(668,",DIC(0)="L"
"RTN","RMPRFC4",65,0)
 K DD,DO D FILE^DICN
"RTN","RMPRFC4",66,0)
 S RMPRA=+Y
"RTN","RMPRFC4",67,0)
 ;
"RTN","RMPRFC4",68,0)
 S DA=+Y,DIE=DIC
"RTN","RMPRFC4",69,0)
 S DR="1////^S X=RMPRDFN;3////^S X=RMPRFORM;8////^S X=.5;2////^S X=RMPRISIT;9////^S X=RMPRTYPE;14////^S X=RMPRSTAT"
"RTN","RMPRFC4",70,0)
 D ^DIE
"RTN","RMPRFC4",71,0)
 ;
"RTN","RMPRFC4",72,0)
 ;check for discontinued or new
"RTN","RMPRFC4",73,0)
 ;
"RTN","RMPRFC4",74,0)
 I RMPRST="NW" D
"RTN","RMPRFC4",75,0)
 .S DR="27////^S X=RMPROPRO;20////^S X=RMPR123A;1.6////^S X=+RMPRICD;1.5////^S X=$P(RMPRPD9,U,2);22////^S X=RMPRDRXW"
"RTN","RMPRFC4",76,0)
 .D ^DIE
"RTN","RMPRFC4",77,0)
 ;
"RTN","RMPRFC4",78,0)
 I RMPRST="DC" D
"RTN","RMPRFC4",79,0)
 .S DR="27////^S X=RMPROPRO;20////^S X=RMPR123A;1.6////^S X=+RMPRICD;1.5////^S X=RMPRDIAG;22////^S X=RMPRDRXW"
"RTN","RMPRFC4",80,0)
 .D ^DIE
"RTN","RMPRFC4",81,0)
 ;
"RTN","RMPRFC4",82,0)
 ;for a new order
"RTN","RMPRFC4",83,0)
 ;Description of Item/Services
"RTN","RMPRFC4",84,0)
 I RMPRST="NW" D
"RTN","RMPRFC4",85,0)
 .S ^RMPR(668,RMPRA,2,0)="^^^"_DT_"^"
"RTN","RMPRFC4",86,0)
 .S RMPRL=0,RMPRLN=0
"RTN","RMPRFC4",87,0)
 .F  S RMPRL=$O(^TMP("RMPRIF",$J,"OBX",1,RMPRL)) Q:RMPRL=""  D
"RTN","RMPRFC4",88,0)
 .. S RMPRLN=RMPRLN+1,^RMPR(668,RMPRA,2,RMPRLN,0)=^TMP("RMPRIF",$J,"OBX",1,RMPRL)
"RTN","RMPRFC4",89,0)
 .S $P(^RMPR(668,RMPRA,2,0),"^",3)=RMPRLN
"RTN","RMPRFC4",90,0)
 ;
"RTN","RMPRFC4",91,0)
 I RMPRST="DC" D
"RTN","RMPRFC4",92,0)
 .S ^RMPR(668,RMPRA,2,0)="^^^"_DT_"^"
"RTN","RMPRFC4",93,0)
 .S ^RMPR(668,RMPRA,2,1,0)="****DISCONTINUED****"
"RTN","RMPRFC4",94,0)
 .S $P(^RMPR(668,RMPRA,2,0),"^",3)=1
"RTN","RMPRFC4",95,0)
 ;
"RTN","RMPRFC4",96,0)
EXIT ;
"RTN","RMPRFC4",97,0)
 ;Clean up here
"RTN","RMPRFC4",98,0)
 K ^TMP("RMPRIF",$J)
"RTN","RMPRFC4",99,0)
 K RMPRST,RMPRA,RMPRLN,RMPRL
"RTN","RMPRFC4",100,0)
 K RMPR123,RMPR123A,RMPR123I,RMPRISIT
"RTN","RMPRFC4",101,0)
 K RMPRFORM,RMPRTYPE,RMPRSTAT,RMPROPRO,RMPRDFN,RMPRMPI,RMPRPD9,RMPRICD9
"RTN","RMPRFC4",102,0)
 K RMPRDRXW,RMPRDIAG,RMPR668,RMPRICD
"RTN","RMPRFC4",103,0)
 K RMPRDCIN,RMPRDPDC
"RTN","RMPRFC4",104,0)
 Q
"RTN","RMPRFC5")
0^10^B202840^n/a
"RTN","RMPRFC5",1,0)
RMPRFC5 ;HINES CIOFO/HNC - Utility     ; 3/22/05
"RTN","RMPRFC5",2,0)
 ;;3.0;PROSTHETICS;**83**;Feb 09, 1996;Build 20
"RTN","RMPRFC5",3,0)
 ;
"RTN","RMPRFC5",4,0)
TRIMWP(ARRAY,PIECE) ;OBX segments so that only comment remains
"RTN","RMPRFC5",5,0)
 ; Input:
"RTN","RMPRFC5",6,0)
 ;   ARRAY  = the array in which the segments are contained
"RTN","RMPRFC5",7,0)
 ;      ex. ^TMP("RMPRIF",541083753,"OBX",3,3)=3|TX|^COMMENTS^|3|text "
"RTN","RMPRFC5",8,0)
 ;   PIECE  = the piece in the array where the text lives
"RTN","RMPRFC5",9,0)
 ; 
"RTN","RMPRFC5",10,0)
 ; Output:
"RTN","RMPRFC5",11,0)
 ;   trimmed array 
"RTN","RMPRFC5",12,0)
 ;     ex. ^TMP("RMPRIF",541083753,"OBX",3,3)="text"
"RTN","RMPRFC5",13,0)
 ;
"RTN","RMPRFC5",14,0)
 N I S I=0
"RTN","RMPRFC5",15,0)
 F  S I=$O(@(ARRAY)@(I)) Q:'I  D
"RTN","RMPRFC5",16,0)
 . S @(ARRAY)@(I)=$P(@(ARRAY)@(I),"|",PIECE)
"RTN","RMPRFC5",17,0)
 Q
"RTN","RMPRFC5",18,0)
 Q
"RTN","RMPRFC5",19,0)
EXIT ;
"RTN","RMPRFC5",20,0)
 Q
"RTN","RMPRHL7A")
0^11^B34526281^B33495720
"RTN","RMPRHL7A",1,0)
RMPRHL7A ;HINES CIOFO/HNC - Receive HL-7 CPRS Message, parse into components and store in File 668 ;3/13/00
"RTN","RMPRHL7A",2,0)
 ;;3.0;PROSTHETICS;**45,78,83**;Feb 09, 1996;Build 20
"RTN","RMPRHL7A",3,0)
 ;
"RTN","RMPRHL7A",4,0)
 ;Patch #78 - 09/25/03 - TH - Add multiple DG1 and ZCL segments.
"RTN","RMPRHL7A",5,0)
 ;Patch #83 - 03/02/09 - DDA - Add check in OBR to screen out IFCs generated locally.
"RTN","RMPRHL7A",6,0)
 ;
"RTN","RMPRHL7A",7,0)
 Q
"RTN","RMPRHL7A",8,0)
URG(X) ;Return Urgency give Z-code from HL-7 segment; see ORC+9
"RTN","RMPRHL7A",9,0)
 S X=$S(X="S":"STAT",X="R":"ROUTINE",X="ZT":"TODAY",X="Z24":"WITHIN 24 HOURS",X="Z48":"WITHIN 48 HOURS",X="Z72":"WITHIN 72 HOURS",X="ZW":"WITHIN 1 WEEK",X="ZM":"WITHIN 1 MONTH",X="ZNA":"NEXT AVAILABLE",1:X)
"RTN","RMPRHL7A",10,0)
 I $E(X,1)="Z" S X=$S(X="ZT":"TODAY",X="ZE":"EMERGENCY",1:"")
"RTN","RMPRHL7A",11,0)
 Q X
"RTN","RMPRHL7A",12,0)
 ;
"RTN","RMPRHL7A",13,0)
ORC(RMPRORC) ;Get fields from ORC segment and set into RMPR variables
"RTN","RMPRHL7A",14,0)
 S ^TMP("SPS","HL7",2)=RMPRORC
"RTN","RMPRHL7A",15,0)
 ;RMPRTRLC=ORC control code from HL7 Table 119
"RTN","RMPRHL7A",16,0)
 ;RMPRURGI=priority/urgency     RMPRPLCR=who entered the order
"RTN","RMPRHL7A",17,0)
 ;RMPRORNP=provider             RMPRNATO=nature of order
"RTN","RMPRHL7A",18,0)
 ;RMPRAD=date of request        RMPROCR=order request reason
"RTN","RMPRHL7A",19,0)
 ;RMPR RMPRORFN=oe/rr file number
"RTN","RMPRHL7A",20,0)
 ;RMPRO=file 668 IEN - if not a new order
"RTN","RMPRHL7A",21,0)
 ;RMPRS38=order status - taken from Table 38, HL7 standard
"RTN","RMPRHL7A",22,0)
 I $E(RMPRMSG,1,6)'="ORC|NW" S RMPRQT=1 Q
"RTN","RMPRHL7A",23,0)
 S RMPRTRLC=$P(RMPRORC,"|",2)
"RTN","RMPRHL7A",24,0)
 S RMPRORFN=$P(RMPRORC,"|",3)
"RTN","RMPRHL7A",25,0)
 S RMPRORFN=$P($P(RMPRORFN,"^",1),";",1)
"RTN","RMPRHL7A",26,0)
 S RMPRAPP=$P($P(RMPRORC,"|",3),"^",2)
"RTN","RMPRHL7A",27,0)
 S RMPRS38=$P(RMPRORC,"|",6)
"RTN","RMPRHL7A",28,0)
 S RMPRURGI=$P($P(RMPRORC,"|",8),"^",6)
"RTN","RMPRHL7A",29,0)
 S RMPRPLCR=$P(RMPRORC,"|",11)
"RTN","RMPRHL7A",30,0)
 S RMPRORNP=$P(RMPRORC,"|",13)
"RTN","RMPRHL7A",31,0)
 I $L(RMPRURGI) S RMPRURGI=$$URG(RMPRURGI)
"RTN","RMPRHL7A",32,0)
 S RMPRO=+$P($P(RMPRORC,"|",4),"^",1)
"RTN","RMPRHL7A",33,0)
 N RMPRODT S RMPRODT=$P(RMPRORC,"|",16)
"RTN","RMPRHL7A",34,0)
 S RMPRAD=$$FMDATE^RMPRHL7(RMPRODT)
"RTN","RMPRHL7A",35,0)
 S RMPROCR=$P(RMPRORC,"|",17)
"RTN","RMPRHL7A",36,0)
 S RMPRNATO=$P(RMPROCR,"^",5)
"RTN","RMPRHL7A",37,0)
 Q
"RTN","RMPRHL7A",38,0)
OBR(RMPROBR) ;Get fields from OBR segment and set into RMPR variables
"RTN","RMPRHL7A",39,0)
 ;RMPRSS=type of consult, field 9, 1-4 if NO, then not prosthetics
"RTN","RMPRHL7A",40,0)
 ;Must have 99CON in RMPR99C.
"RTN","RMPRHL7A",41,0)
 ;
"RTN","RMPRHL7A",42,0)
 ;RMPRODT=observation date/time
"RTN","RMPRHL7A",43,0)
 ;RMPRPRI=procedure from file ^ORD(101,
"RTN","RMPRHL7A",44,0)
 ;
"RTN","RMPRHL7A",45,0)
 N RMPR99C
"RTN","RMPRHL7A",46,0)
 S RMPR99C=$P($P(RMPROBR,"|",5),"^",6)
"RTN","RMPRHL7A",47,0)
 I RMPR99C'="99CON" S RMPRSS="NO",RMPRQT=1 Q
"RTN","RMPRHL7A",48,0)
 S RMPRSST=$P($P(RMPROBR,"|",5),"^",4)
"RTN","RMPRHL7A",49,0)
 S RMPRSS=$P(^GMR(123.5,RMPRSST,0),U,1) D
"RTN","RMPRHL7A",50,0)
 .;translate to set of codes
"RTN","RMPRHL7A",51,0)
 .I RMPRSS["PROSTHETICS IFC" S RMPRSS="NO" Q
"RTN","RMPRHL7A",52,0)
 .I RMPRSS["PROSTHETICS REQUEST" S RMPRSS=1 Q
"RTN","RMPRHL7A",53,0)
 .I RMPRSS["CONTACT LENS REQUEST" S RMPRSS=3 Q
"RTN","RMPRHL7A",54,0)
 .I RMPRSS["HOME OXYGEN REQUEST" S RMPRSS=4 Q
"RTN","RMPRHL7A",55,0)
 .I RMPRSS["EYEGLASS REQUEST" S RMPRSS=2 Q
"RTN","RMPRHL7A",56,0)
 .;then not prosthetics
"RTN","RMPRHL7A",57,0)
 .S RMPRSS="NO"
"RTN","RMPRHL7A",58,0)
 ;
"RTN","RMPRHL7A",59,0)
 I RMPRSS="NO" S RMPRQT=1 Q
"RTN","RMPRHL7A",60,0)
 ;
"RTN","RMPRHL7A",61,0)
 S RMPRODT=$P(RMPROBR,"|",7)
"RTN","RMPRHL7A",62,0)
 I RMPRODT]"" S RMPRODT=$$FMDATE^RMPRHL7(RMPRODT)
"RTN","RMPRHL7A",63,0)
 S RMPRATN=$P(RMPROBR,"|",20)
"RTN","RMPRHL7A",64,0)
 S RMPRSTDT=$P(RMPROBR,"|",23)
"RTN","RMPRHL7A",65,0)
 S RMPRSTDT=$$FMDATE^RMPRHL7(RMPRSTDT)
"RTN","RMPRHL7A",66,0)
 S RMPRS668=$P(RMPROBR,"|",26)
"RTN","RMPRHL7A",67,0)
 S RMPRINTR=$P(RMPROBR,"|",33)
"RTN","RMPRHL7A",68,0)
 Q
"RTN","RMPRHL7A",69,0)
 ;
"RTN","RMPRHL7A",70,0)
DG1(RMPRDG1) ;Get fields from DG1 and ZCL segments
"RTN","RMPRHL7A",71,0)
 ; RMPRSID = Set ID
"RTN","RMPRHL7A",72,0)
 ; RMPRDIAG = pointer to ICD DIAGNOSIS (#80)
"RTN","RMPRHL7A",73,0)
 ; RMPRCI = Outpat. Classification Type
"RTN","RMPRHL7A",74,0)
 ; RMPRVAL = Value of each SC or EI - 0,1,Null.
"RTN","RMPRHL7A",75,0)
 S RMPRMSG=MSG(RMPRDG1)
"RTN","RMPRHL7A",76,0)
 S RMPRSID=$P(RMPRMSG,"|",2)
"RTN","RMPRHL7A",77,0)
 I $P(RMPRMSG,"|",1)="DG1" D
"RTN","RMPRHL7A",78,0)
 . S RMPRDIAG=$P($P(RMPRMSG,"|",4),"^",1)
"RTN","RMPRHL7A",79,0)
 . S RMPRMSG1(RMPRSID,1)=RMPRDIAG
"RTN","RMPRHL7A",80,0)
 I $P(RMPRMSG,"|",1)="ZCL" D
"RTN","RMPRHL7A",81,0)
 . S RMPRCI=$P(RMPRMSG,"|",3)
"RTN","RMPRHL7A",82,0)
 . S RMPRVAL=$P(RMPRMSG,"|",4)
"RTN","RMPRHL7A",83,0)
 . S RMPRMSG1(RMPRSID,RMPRCI+1)=RMPRVAL
"RTN","RMPRHL7A",84,0)
 Q 
"RTN","RMPRHL7A",85,0)
 ;
"RTN","RMPRHL7A",86,0)
ZSV(RMPRZSV) ;Get service from ZSV segment
"RTN","RMPRHL7A",87,0)
 S RMPRZSS=$P($P(RMPRZSV,"|",2),"^",4)
"RTN","RMPRHL7A",88,0)
 ;Set the service if ZSV provided
"RTN","RMPRHL7A",89,0)
 I $L($P(RMPRZSV,"|",3)) S RMPROTXT=$P(RMPRZSV,"|",3) ;consult type
"RTN","RMPRHL7A",90,0)
 Q
"RTN","RMPRHL7A",91,0)
 ;
"RTN","RMPRHL7A",92,0)
OBX(RMPROBX) ;Get fields from OBX segment and set into RMPR variables
"RTN","RMPRHL7A",93,0)
 ;RMPRVTYP=Value type from table 668-i.e. TX(text), ST(string data),etc.
"RTN","RMPRHL7A",94,0)
 ;RMPROID=observation id identifying value in seg. 5
"RTN","RMPRHL7A",95,0)
 ;RMPRVAL=observation value coded by segment 3
"RTN","RMPRHL7A",96,0)
 ;RMPRPRDG=provisional diagnosis
"RTN","RMPRHL7A",97,0)
 ;free text or code^free text^I9C
"RTN","RMPRHL7A",98,0)
 S RMPRMSG=MSG(RMPROBX)
"RTN","RMPRHL7A",99,0)
 S RMPRVTYP=$P(RMPRMSG,"|",3),RMPROID=$P($P(RMPRMSG,"|",4),"^",2)
"RTN","RMPRHL7A",100,0)
 S RMPRVAL=$P(RMPROID,"^",3)
"RTN","RMPRHL7A",101,0)
 I RMPROID="REASON FOR REQUEST" D
"RTN","RMPRHL7A",102,0)
 .S RMPRRFQ(1)=$P(RMPRMSG,"|",6)
"RTN","RMPRHL7A",103,0)
 .S LN=0 F  S LN=$O(MSG(RMPROBX,LN)) Q:LN=""  S RMPRRFQ(LN+1)=MSG(RMPROBX,LN)
"RTN","RMPRHL7A",104,0)
 .Q
"RTN","RMPRHL7A",105,0)
 I RMPROID="PROVISIONAL DIAGNOSIS" D  Q
"RTN","RMPRHL7A",106,0)
 . I RMPRVTYP="TX" S RMPRPRDG=$P(RMPRMSG,"|",6) Q
"RTN","RMPRHL7A",107,0)
 . I RMPRVTYP="CE" D  Q
"RTN","RMPRHL7A",108,0)
 .. N PRDXSEG S PRDXSEG=$P(RMPRMSG,"|",6)
"RTN","RMPRHL7A",109,0)
 .. S RMPRPRDG=$P(PRDXSEG,"^",2)_" ("_$P(PRDXSEG,"^")_")"
"RTN","RMPRHL7A",110,0)
 .. S RMPRPRCD=$P(PRDXSEG,"^")
"RTN","RMPRHL7A",111,0)
 I RMPROID["COMMENT" D
"RTN","RMPRHL7A",112,0)
 .S RMPRCMT(1)=$P(RMPRMSG,"|",6)
"RTN","RMPRHL7A",113,0)
 .S LN=0 F  S LN=$O(MSG(RMPROBX,NL)) Q:LN=""  S RMPRCMT(LN+1)=MSG(RMPROBX,LN)
"RTN","RMPRHL7A",114,0)
 .Q
"RTN","RMPRHL7A",115,0)
 K LN
"RTN","RMPRHL7A",116,0)
 Q
"RTN","RMPRHL7A",117,0)
 ;
"RTN","RMPRHL7A",118,0)
EN(MSG) ;Entry point from protocol RMPR RECEIVE
"RTN","RMPRHL7A",119,0)
 ;
"RTN","RMPRHL7A",120,0)
 ;MSG = local array which contains the HL-7 segments
"RTN","RMPRHL7A",121,0)
 ;RMPRFAC=sending facility
"RTN","RMPRHL7A",122,0)
 ;RMPRMTP=message type
"RTN","RMPRHL7A",123,0)
 N DFN,RMPRACT,RMPRADD,RMPRFAC,RMPRMTP,RMPRPNM,RMPRO,RMPROCR,RMPRORNP
"RTN","RMPRHL7A",124,0)
 N RMPRORFN,RMPRPLCR,RMPRRB,RMPRSEND,RMPRSTS,RMPRTRLC,RMPRWARD,ORIFN
"RTN","RMPRHL7A",125,0)
 N RMPRTRLC,RMPRAD,ORC,RMPRSBR,RMPRZSS,RMPRSS,RMPRSST,RMPROTXT
"RTN","RMPRHL7A",126,0)
 N RMPRMSGO
"RTN","RMPRHL7A",127,0)
 S RMPRMSG="",RMPRNOD=0,RMPRI=0
"RTN","RMPRHL7A",128,0)
 F  S RMPRNOD=$O(MSG(RMPRNOD)) Q:RMPRNOD=""  S RMPRMSG=MSG(RMPRNOD) I $E(RMPRMSG,1,3)="MSH" D  Q
"RTN","RMPRHL7A",129,0)
 .S RMPRSEND=$P(RMPRMSG,"|",3),RMPRFAC=$P(RMPRMSG,"|",4),RMPRMTP=$P(RMPRMSG,"|",9)
"RTN","RMPRHL7A",130,0)
 .Q
"RTN","RMPRHL7A",131,0)
 ;RMPRQT, stop flag in loop
"RTN","RMPRHL7A",132,0)
 S RMPRMSG="",RMPRNOD=0,RMPRQT=0,N=0
"RTN","RMPRHL7A",133,0)
 F  S RMPRNOD=$O(MSG(RMPRNOD)) Q:RMPRNOD=""  Q:RMPRQT=1  S RMPRMSG=MSG(RMPRNOD) D
"RTN","RMPRHL7A",134,0)
 .I $E(RMPRMSG,1,3)="PID" D PID^RMPRHL7U(RMPRMSG) Q
"RTN","RMPRHL7A",135,0)
 .I $E(RMPRMSG,1,3)="PV1" D PV1^RMPRHL7U(RMPRMSG) Q
"RTN","RMPRHL7A",136,0)
 .;look at ORC|NW for new order
"RTN","RMPRHL7A",137,0)
 .I $E(RMPRMSG,1,3)="ORC" D ORC(RMPRMSG) Q
"RTN","RMPRHL7A",138,0)
 .I RMPRQT=1 Q
"RTN","RMPRHL7A",139,0)
 .I $E(RMPRMSG,1,3)="OBR" D OBR(RMPRMSG) I RMPRSS="NO" S RMPRQT=1 K RMPRSS Q
"RTN","RMPRHL7A",140,0)
 .I RMPRQT=1 Q
"RTN","RMPRHL7A",141,0)
 .;Patch #78 - Add multiple DG1 and ZCL segments
"RTN","RMPRHL7A",142,0)
 .I $E(RMPRMSG,1,3)="DG1"!($E(RMPRMSG,1,3)="ZCL") D DG1(RMPRNOD) Q
"RTN","RMPRHL7A",143,0)
 .;look at ZSV for Prosthetic (4)
"RTN","RMPRHL7A",144,0)
 .I $E(RMPRMSG,1,3)="ZSV" D ZSV(RMPRMSG) Q
"RTN","RMPRHL7A",145,0)
 .I $E(RMPRMSG,1,3)="OBX" D OBX(RMPRNOD) Q
"RTN","RMPRHL7A",146,0)
 .;I $E(RMPRMSG,1,3)="NTE" D NTE^RMPRHL7U(.MSG,RMPRNOD,RMPRO,RMPRTRLC) Q
"RTN","RMPRHL7A",147,0)
 .Q
"RTN","RMPRHL7A",148,0)
 K N
"RTN","RMPRHL7A",149,0)
 ;check for new order, NW, and a prosthetic consult in RMPRSS
"RTN","RMPRHL7A",150,0)
 I '$D(RMPRTRLC) D EXIT^RMPRHL7U Q
"RTN","RMPRHL7A",151,0)
 I RMPRTRLC'="NW" D EXIT^RMPRHL7U Q
"RTN","RMPRHL7A",152,0)
 I '$D(RMPRSS) D EXIT^RMPRHL7U Q
"RTN","RMPRHL7A",153,0)
 I RMPRSS="NO" D EXIT^RMPRHL7U Q
"RTN","RMPRHL7A",154,0)
 ;
"RTN","RMPRHL7A",155,0)
 D NEW^RMPRHL7B
"RTN","RMPRHL7A",156,0)
 ;
"RTN","RMPRHL7A",157,0)
 I '$D(RMPRO) D REJECT^RMPRHL7U(.MSG,"unable to file order"),EXIT^RMPRHL7U Q
"RTN","RMPRHL7A",158,0)
 ;
"RTN","RMPRHL7A",159,0)
 D RTN(RMPRORFN,.RMPRO)
"RTN","RMPRHL7A",160,0)
 ;
"RTN","RMPRHL7A",161,0)
 D EXIT^RMPRHL7U
"RTN","RMPRHL7A",162,0)
 Q
"RTN","RMPRHL7A",163,0)
 ;
"RTN","RMPRHL7A",164,0)
RTN(RMPRORN,RMPRO) ;Put ^OR(100, ien for order into ^RMPR(668, 
"RTN","RMPRHL7A",165,0)
 S DA=RMPRO
"RTN","RMPRHL7A",166,0)
 S DIE="^RMPR(668,",DR="19////^S X=RMPRORN"
"RTN","RMPRHL7A",167,0)
 L +^RMPR(668,RMPRO) D ^DIE L -^RMPR(668,RMPRO)
"RTN","RMPRHL7A",168,0)
 K DIE,DR
"RTN","RMPRHL7A",169,0)
 ; set file 123 ien
"RTN","RMPRHL7A",170,0)
 S RMPRGMRC=$$PKGID^ORX8($P(^RMPR(668,RMPRO,0),U,14))
"RTN","RMPRHL7A",171,0)
 I RMPRGMRC["GMRC" S $P(^RMPR(668,RMPRO,0),U,15)=+RMPRGMRC
"RTN","RMPRHL7A",172,0)
 E  D REJECT^RMPRHL7U(.MSG),EXIT^RMPRHL7U
"RTN","RMPRHL7A",173,0)
 Q
"VER")
8.0^22.0
"^DD",668,668,27,0)
ORDERING PROVIDER^F^^IFC1;3^K:$L(X)>50!($L(X)<1) X
"^DD",668,668,27,3)
Answer must be 1-50 characters in length.
"^DD",668,668,27,21,0)
^.001^2^2^3040624^^
"^DD",668,668,27,21,1,0)
Provider who ordered the entry for Inter-facility Consults (IFC).  
"^DD",668,668,27,21,2,0)
This is a free text field.
"^DD",668,668,27,"DT")
3040624
"BLD",4834,6)
^132
**END**
**END**
