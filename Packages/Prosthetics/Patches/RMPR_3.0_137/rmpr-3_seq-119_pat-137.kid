Released RMPR*3*137 SEQ #119
Extracted from mail message
**KIDS**:RMPR*3.0*137^

**INSTALL NAME**
RMPR*3.0*137
"BLD",6614,0)
RMPR*3.0*137^PROSTHETICS^0^3070814^y
"BLD",6614,1,0)
^^8^8^3070814^
"BLD",6614,1,1,0)
1. Ship charges not removed during CPO when using '@' or '0.00'.
"BLD",6614,1,2,0)
 
"BLD",6614,1,3,0)
2. L code grouping calculator problem when viewing screen 4 of 2319.
"BLD",6614,1,4,0)
 
"BLD",6614,1,5,0)
3. 2319 not displaying pre patient merged 660 records.
"BLD",6614,1,6,0)
 
"BLD",6614,1,7,0)
4. List Open Purchase Card transactions by Initiator report has POs
"BLD",6614,1,8,0)
   cancelled in GUI.
"BLD",6614,4,0)
^9.64PA^^
"BLD",6614,6.3)
5
"BLD",6614,"ABPKG")
n
"BLD",6614,"KRN",0)
^9.67PA^8989.52^19
"BLD",6614,"KRN",.4,0)
.4
"BLD",6614,"KRN",.401,0)
.401
"BLD",6614,"KRN",.402,0)
.402
"BLD",6614,"KRN",.403,0)
.403
"BLD",6614,"KRN",.5,0)
.5
"BLD",6614,"KRN",.84,0)
.84
"BLD",6614,"KRN",3.6,0)
3.6
"BLD",6614,"KRN",3.8,0)
3.8
"BLD",6614,"KRN",9.2,0)
9.2
"BLD",6614,"KRN",9.8,0)
9.8
"BLD",6614,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",6614,"KRN",9.8,"NM",1,0)
RMPR4E21^^0^B62022503
"BLD",6614,"KRN",9.8,"NM",2,0)
RMPRPAT2^^0^B27661338
"BLD",6614,"KRN",9.8,"NM",3,0)
RMPRPRT1^^0^B24629697
"BLD",6614,"KRN",9.8,"NM",4,0)
RMPOBIL5^^0^B15887146
"BLD",6614,"KRN",9.8,"NM",5,0)
RMPR121B^^0^B18046242
"BLD",6614,"KRN",9.8,"NM","B","RMPOBIL5",4)

"BLD",6614,"KRN",9.8,"NM","B","RMPR121B",5)

"BLD",6614,"KRN",9.8,"NM","B","RMPR4E21",1)

"BLD",6614,"KRN",9.8,"NM","B","RMPRPAT2",2)

"BLD",6614,"KRN",9.8,"NM","B","RMPRPRT1",3)

"BLD",6614,"KRN",19,0)
19
"BLD",6614,"KRN",19.1,0)
19.1
"BLD",6614,"KRN",101,0)
101
"BLD",6614,"KRN",409.61,0)
409.61
"BLD",6614,"KRN",771,0)
771
"BLD",6614,"KRN",870,0)
870
"BLD",6614,"KRN",8989.51,0)
8989.51
"BLD",6614,"KRN",8989.52,0)
8989.52
"BLD",6614,"KRN",8994,0)
8994
"BLD",6614,"KRN","B",.4,.4)

"BLD",6614,"KRN","B",.401,.401)

"BLD",6614,"KRN","B",.402,.402)

"BLD",6614,"KRN","B",.403,.403)

"BLD",6614,"KRN","B",.5,.5)

"BLD",6614,"KRN","B",.84,.84)

"BLD",6614,"KRN","B",3.6,3.6)

"BLD",6614,"KRN","B",3.8,3.8)

"BLD",6614,"KRN","B",9.2,9.2)

"BLD",6614,"KRN","B",9.8,9.8)

"BLD",6614,"KRN","B",19,19)

"BLD",6614,"KRN","B",19.1,19.1)

"BLD",6614,"KRN","B",101,101)

"BLD",6614,"KRN","B",409.61,409.61)

"BLD",6614,"KRN","B",771,771)

"BLD",6614,"KRN","B",870,870)

"BLD",6614,"KRN","B",8989.51,8989.51)

"BLD",6614,"KRN","B",8989.52,8989.52)

"BLD",6614,"KRN","B",8994,8994)

"BLD",6614,"QUES",0)
^9.62^^
"BLD",6614,"REQB",0)
^9.611^2^2
"BLD",6614,"REQB",1,0)
RMPR*3.0*75^2
"BLD",6614,"REQB",2,0)
RMPR*3.0*133^2
"BLD",6614,"REQB","B","RMPR*3.0*133",2)

"BLD",6614,"REQB","B","RMPR*3.0*75",1)

"MBREQ")
0
"PKG",101,-1)
1^1
"PKG",101,0)
PROSTHETICS^RMPR^PROSTHETICS VERSION 3.0 ALPHA
"PKG",101,20,0)
^9.402P^^0
"PKG",101,22,0)
^9.49I^1^1
"PKG",101,22,1,0)
3.0^2960209^2960214
"PKG",101,22,1,"PAH",1,0)
137^3070814
"PKG",101,22,1,"PAH",1,1,0)
^^8^8^3070814
"PKG",101,22,1,"PAH",1,1,1,0)
1. Ship charges not removed during CPO when using '@' or '0.00'.
"PKG",101,22,1,"PAH",1,1,2,0)
 
"PKG",101,22,1,"PAH",1,1,3,0)
2. L code grouping calculator problem when viewing screen 4 of 2319.
"PKG",101,22,1,"PAH",1,1,4,0)
 
"PKG",101,22,1,"PAH",1,1,5,0)
3. 2319 not displaying pre patient merged 660 records.
"PKG",101,22,1,"PAH",1,1,6,0)
 
"PKG",101,22,1,"PAH",1,1,7,0)
4. List Open Purchase Card transactions by Initiator report has POs
"PKG",101,22,1,"PAH",1,1,8,0)
   cancelled in GUI.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","RMPOBIL5")
0^4^B15887146^B13391809
"RTN","RMPOBIL5",1,0)
RMPOBIL5 ;(NG)/DUG - HOME OXYGEN BILLING TRANSACTIONS ;7/24/98
"RTN","RMPOBIL5",2,0)
 ;;3.0;PROSTHETICS;**29,99,137**;Feb 09, 1996;Build 5
"RTN","RMPOBIL5",3,0)
 N RMPRMERG S RMPRMERG=0
"RTN","RMPOBIL5",4,0)
 S (RC,RA,AN,ANS,RK,RZ)=0 D HDR
"RTN","RMPOBIL5",5,0)
 F  S RA=$O(^RMPR(660,"AC",RMPRDFN,RA)) Q:RA=""  D
"RTN","RMPOBIL5",6,0)
 . S AN=""
"RTN","RMPOBIL5",7,0)
 . F  S AN=$O(^RMPR(660,"AC",RMPRDFN,RA,AN)) Q:AN=""  D
"RTN","RMPOBIL5",8,0)
 . . I $D(^RMPO(665.72,"AC",AN))>0 S RC=RC+1,IT(RC)=AN
"RTN","RMPOBIL5",9,0)
 ;Check for merged accounts
"RTN","RMPOBIL5",10,0)
 I $D(^XDRM("B",RMPRDFN_";DPT(")) D
"RTN","RMPOBIL5",11,0)
 . S RMPRMERG=$O(^XDRM("B",RMPRDFN_";DPT(",RMPRMERG)) Q:RMPRMERG=""
"RTN","RMPOBIL5",12,0)
 . S RMPRMERG=+^XDRM(RMPRMERG,0) Q:RMPRMERG=0  D
"RTN","RMPOBIL5",13,0)
 .. S RA=0
"RTN","RMPOBIL5",14,0)
 .. F  S RA=$O(^RMPR(660,"AC",RMPRMERG,RA)) Q:RA=""  D
"RTN","RMPOBIL5",15,0)
 ... S AN=""
"RTN","RMPOBIL5",16,0)
 ... F  S AN=$O(^RMPR(660,"AC",RMPRMERG,RA,AN)) Q:AN=""  D
"RTN","RMPOBIL5",17,0)
 .... I $D(^RMPO(665.72,"AC",AN))>0 S RC=RC+1,IT(RC)=AN
"RTN","RMPOBIL5",18,0)
 G:'$D(IT) END
"RTN","RMPOBIL5",19,0)
DIS ;DISPLAY APPLIANCES OR REPAIRS
"RTN","RMPOBIL5",20,0)
 I $G(RK)="" S (RC,RK)=""
"RTN","RMPOBIL5",21,0)
 I RK+1'>RC S RK=RK+1,AN=+IT(RK) D  G:$$XIT EXIT G DIS
"RTN","RMPOBIL5",22,0)
 . S Y=^RMPR(660,AN,0) D PRT,OVER:((IOSL-4)<$Y)
"RTN","RMPOBIL5",23,0)
END I RC=0 W !,"No home oxygen items for this veteran!",!! H 3 G EXIT
"RTN","RMPOBIL5",24,0)
 E  D  G EXIT
"RTN","RMPOBIL5",25,0)
 .I RC>0 D  I $G(RK)+1'>$G(RC) D DIS
"RTN","RMPOBIL5",26,0)
 . . W !!,"End of Home Oxygen records for this veteran!" D OVER
"RTN","RMPOBIL5",27,0)
 .I $G(RC)="" Q
"RTN","RMPOBIL5",28,0)
EXIT Q:'$D(RMPRDFN)
"RTN","RMPOBIL5",29,0)
 W ! K I,J,L,R0,IT,RA
"RTN","RMPOBIL5",30,0)
 I $D(DUOUT)!($D(DTOUT)) G ASK1^RMPRPAT
"RTN","RMPOBIL5",31,0)
 S FL=4 G ASK2^RMPRPAT
"RTN","RMPOBIL5",32,0)
 K RMPRCNUM,TRANS,TRANS1,TYPE,VEN
"RTN","RMPOBIL5",33,0)
 K AMIS,AN,CST,DATE,DEL,DUOUT,DTOUT,FL,FRM,PAGE,QTY,RC,REM,RZ,RK,SN,STA
"RTN","RMPOBIL5",34,0)
 Q
"RTN","RMPOBIL5",35,0)
XIT() Q '$D(ANS)!(ANS=U)!($D(DUOUT))!($D(DTOUT))
"RTN","RMPOBIL5",36,0)
PRT S DATE=$P(Y,U,3),TYPE=$P(Y,U,6),QTY=$P(Y,U,7)
"RTN","RMPOBIL5",37,0)
 S VEN=$P(Y,U,9),TRANS=$P(Y,U,4),STA=$P(Y,U,10),SN=$P(Y,U,11)
"RTN","RMPOBIL5",38,0)
 S DEL=$P(Y,U,12)
"RTN","RMPOBIL5",39,0)
 S CST=$S($P(Y,U,16)'="":$P(Y,U,16),$D(^RMPR(660,AN,"LB")):$P(^RMPR(660,AN,"LB"),U,9),1:"")
"RTN","RMPOBIL5",40,0)
 ;form requested on
"RTN","RMPOBIL5",41,0)
 S FRM=$P(Y,U,13),REM=$P(Y,U,18)
"RTN","RMPOBIL5",42,0)
 S DATE=$E(DATE,4,5)_"/"_$E(DATE,6,7)_"/"_$E(DATE,2,3)
"RTN","RMPOBIL5",43,0)
 ;S TYPE=$S(TYPE="":"",$D(^RMPR(661,TYPE,0)):$P(^(0),U,1),1:"")
"RTN","RMPOBIL5",44,0)
 S TYPE=$P($G(^RMPR(660,AN,1)),U,4)
"RTN","RMPOBIL5",45,0)
 S AMIS=$P(Y,U,15),VEN=$S(VEN="":"",$D(^PRC(440,VEN,0)):$P(^(0),U,1),1:"")
"RTN","RMPOBIL5",46,0)
 I $D(^RMPR(660.1,"AC",AN)),$P(^RMPR(660.1,$O(^RMPR(660.1,"AC",AN,0)),0),U,11)]"" S AMIS=AMIS_"+"
"RTN","RMPOBIL5",47,0)
 S TRANS=$S(TRANS]"":TRANS,1:""),TRANS1=""
"RTN","RMPOBIL5",48,0)
 S:TRANS="X" TRANS1=TRANS,TRANS=""
"RTN","RMPOBIL5",49,0)
 S DEL=$E(DEL,4,5)_"/"_$E(DEL,6,7)_"/"_$E(DEL,2,3) S:DEL="//" DEL=""
"RTN","RMPOBIL5",50,0)
 W !,RK,". ",DATE,?13,QTY,?17
"RTN","RMPOBIL5",51,0)
 ;W AMIS_$S(TYPE'="":$E($P(^PRC(441,TYPE,0),U,2),1,10),$P(Y,U,26)="D":"DELIVERY",$P(Y,U,26)="P":"PICKUP",$P(Y,U,17):"SHIPPING",1:"")
"RTN","RMPOBIL5",52,0)
 W AMIS_$S(TYPE'="":$E($P($G(^RMPR(661.1,TYPE,0)),U,2),1,10),$P(Y,U,26)="D":"DELIVERY",$P(Y,U,26)="P":"PICKUP",$P(Y,U,17):"SHIPPING",1:"")
"RTN","RMPOBIL5",53,0)
 ;W:$D(^RMPR(660,$P(IT(RK),U,1),"HST")) $E($P(^("HST"),U,1),1,10)
"RTN","RMPOBIL5",54,0)
 I TYPE=""&($D(^RMPR(660,$P(IT(RK),U,1),"HST"))) W $E($P(^("HST"),U,1),1,10)
"RTN","RMPOBIL5",55,0)
 W ?30,TRANS,?31,TRANS1
"RTN","RMPOBIL5",56,0)
 ;display source of procurement for 2529-3 under vendor header
"RTN","RMPOBIL5",57,0)
 I $D(RMPRLPRO) W ?33,RMPRLPRO
"RTN","RMPOBIL5",58,0)
 K RMPRLPRO
"RTN","RMPOBIL5",59,0)
 I VEN'="" W ?33,$E(VEN,1,10)
"RTN","RMPOBIL5",60,0)
 W:$D(^RMPR(660,$P(IT(RK),U,1),"HST")) $E($P(^("HST"),U,3),1,10)
"RTN","RMPOBIL5",61,0)
 W:STA'="" ?45,$P(^DIC(4,STA,99),U,1)
"RTN","RMPOBIL5",62,0)
 W ?50,$E(SN,1,9),?60,DEL
"RTN","RMPOBIL5",63,0)
 W ?71,$J($FN($S(CST'="":CST,$P(Y,U,17):$P(Y,U,17),1:""),"T",2),9)
"RTN","RMPOBIL5",64,0)
 W:REM]"" !,?3,REM
"RTN","RMPOBIL5",65,0)
 I $P(IT(RK),U,2)="" S IT(RK)=IT(RK)_"^"_RZ
"RTN","RMPOBIL5",66,0)
 Q
"RTN","RMPOBIL5",67,0)
OVER N ANS
"RTN","RMPOBIL5",68,0)
 S RZ=RK W !,"+=Turned-In  *=Historical Data  I=Initial  X=Repair  S=Spare  R=Replacement",!,"Enter 1-",RK," to show full entry, '^' to exit or `return` to continue.  " R ANS:DTIME S:'$T ANS="^"
"RTN","RMPOBIL5",69,0)
 I ANS="^^" S ANS="^" G ASK1^RMPRPAT Q
"RTN","RMPOBIL5",70,0)
 I ANS="^" G ASK1^RMPRPAT Q
"RTN","RMPOBIL5",71,0)
 I ANS="",RK+1'>RC D HDR Q
"RTN","RMPOBIL5",72,0)
 I ANS="" Q
"RTN","RMPOBIL5",73,0)
 I ANS'?1N.N!(ANS>RK)!(+ANS=0)!(+ANS'=ANS) W $C(7),!," Must be between 1 and ",RK," to be valid" G OVER
"RTN","RMPOBIL5",74,0)
 I ANS>0,(ANS<(RK+1)) S AN=ANS,RZ=RK D ^RMPRPAT3
"RTN","RMPOBIL5",75,0)
 S RK=$P(IT(ANS),U,2)
"RTN","RMPOBIL5",76,0)
 Q
"RTN","RMPOBIL5",77,0)
HDR ;Print Header, Screen 4
"RTN","RMPOBIL5",78,0)
 W @IOF
"RTN","RMPOBIL5",79,0)
 S PAGE=3
"RTN","RMPOBIL5",80,0)
 W !,$E(RMPRNAM,1,20),?23,"SSN: "
"RTN","RMPOBIL5",81,0)
 W $E(RMPRSSN,1,3)_"-"_$E(RMPRSSN,4,5)_"-"_$E(RMPRSSN,6,10)
"RTN","RMPOBIL5",82,0)
 W ?42,"DOB: "
"RTN","RMPOBIL5",83,0)
 S Y=RMPRDOB X ^DD("DD") W Y K Y
"RTN","RMPOBIL5",84,0)
 W ?61,"CLAIM# ",$G(RMPRCNUM)
"RTN","RMPOBIL5",85,0)
 W !?4,"Date",?12,"Qty",?19,"HCPCS",?28,"Type",?34,"Vendor",?45,"Sta",?50,"Serial",?58,"Delivery Date",?72,"Tot Cost"
"RTN","RMPOBIL5",86,0)
 Q
"RTN","RMPR121B")
0^5^B18046242^B16065280
"RTN","RMPR121B",1,0)
RMPR121B ;PHX/HNC -POST GUI PURCHASE ORDER TRANSACTION ;3/1/2003
"RTN","RMPR121B",2,0)
 ;;3.0;PROSTHETICS;**90,75,137**;FEB 09,1996;Build 5
"RTN","RMPR121B",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","RMPR121B",4,0)
A1(SIG,RMPRA,RMPRSITE) S RMPRGUI=1 G A2
"RTN","RMPR121B",5,0)
GUI(RESULT,SIG,RMPRA,RMPRSITE,RMPRPTR) ;
"RTN","RMPR121B",6,0)
A2 I (SIG="")!($E(SIG)="^") S RESULT=1_"^"_"Not Valid, Try Again..." Q
"RTN","RMPR121B",7,0)
 K RESULT D SIGN
"RTN","RMPR121B",8,0)
 Q
"RTN","RMPR121B",9,0)
 ;
"RTN","RMPR121B",10,0)
SIGN ; Validate /es/-code
"RTN","RMPR121B",11,0)
 ;
"RTN","RMPR121B",12,0)
 S X=SIG
"RTN","RMPR121B",13,0)
 S RMPRY=0
"RTN","RMPR121B",14,0)
 D HASH^XUSHSHP I X]"",(X=$P($G(^VA(200,+DUZ,20)),U,4)) S RMPRY=1
"RTN","RMPR121B",15,0)
 I RMPRY=0 S RESULT=1_"^"_"Checked signature Not Valid, Try Again..." Q
"RTN","RMPR121B",16,0)
 ;
"RTN","RMPR121B",17,0)
 S RMPRV=$P(^RMPR(664,RMPRA,0),U,4)
"RTN","RMPR121B",18,0)
 S RMPRPER=$P(^RMPR(664,RMPRA,2),U,6)/100
"RTN","RMPR121B",19,0)
 D GUIVAR
"RTN","RMPR121B",20,0)
 S PRCRMPR=1,X=1,PRCRMPR=1
"RTN","RMPR121B",21,0)
 D UP1^PRCH7PUC(.X,PRCA,PRCB,PRCC,PRCSITE,PRCVEN,PRCRMPR)
"RTN","RMPR121B",22,0)
 I X="^" D C664 G QUIT
"RTN","RMPR121B",23,0)
 S PRC442=$P(^RMPR(664,RMPRA,4),U,6)
"RTN","RMPR121B",24,0)
 I $P(^PRC(442,PRC442,7),U,1)'=6 G QUT
"RTN","RMPR121B",25,0)
 S $P(^RMPR(664,RMPRA,0),U,5)="",$P(^RMPR(664,RMPRA,2),U)="",$P(^RMPR(664,RMPRA,2),U,2)=""
"RTN","RMPR121B",26,0)
 I $D(RMPRPSC) S $P(^RMPR(664,RMPRA,2),U,5)=RMPRPSC
"RTN","RMPR121B",27,0)
 S DA=RMPRA,DIK="^RMPR(664," D IX1^DIK
"RTN","RMPR121B",28,0)
 ;get AMIS grouper number
"RTN","RMPR121B",29,0)
 L +^RMPR(669.9,RMPRSITE,0):999 I $T=0 S RMPRG=DT_99 G GGC
"RTN","RMPR121B",30,0)
 S RMPRG=$P(^RMPR(669.9,RMPRSITE,0),U,7),RMPRG=RMPRG-1,$P(^(0),U,7)=RMPRG L -^RMPR(669.9,RMPRSITE,0)
"RTN","RMPR121B",31,0)
 ;
"RTN","RMPR121B",32,0)
GGC S B2=0
"RTN","RMPR121B",33,0)
 F  S B2=$O(^RMPR(664,RMPRA,1,B2)) Q:B2'>0  D R19^RMPR121C
"RTN","RMPR121B",34,0)
 K RMPRDP
"RTN","RMPR121B",35,0)
 ; Shipping Record
"RTN","RMPR121B",36,0)
 I +RMPRSH'>0 G NS
"RTN","RMPR121B",37,0)
 K DD,DO S X=DT,DIC="^RMPR(660,",DIC(0)="LZ" D FILE^DICN K DIC,D0 S (RMPR660,DA)=+Y
"RTN","RMPR121B",38,0)
 S RMPRTRN=$P(^RMPR(664,RMPRA,4),U,5)
"RTN","RMPR121B",39,0)
 S $P(^RMPR(660,RMPR660,4),U,3)=RMPRV
"RTN","RMPR121B",40,0)
 S ^RMPR(660,RMPR660,0)=DT_U_RMPRDFN_U_DT_"^X^^^^^"_U_RMPR("STA")_"^^^14"_U_RMPRS_"^^"_RMPRSH_"^"_RMPRSH_"^^^^^",^("AMS")=RMPRG,^("AM")=U_U_RMPRDIS_U_RMPRSC,$P(^(0),U,27)=DUZ
"RTN","RMPR121B",41,0)
 ; /SPS Removed the following 2 lines for 75 may re-use at a later time
"RTN","RMPR121B",42,0)
 ; I $D(RMPRWO),RMPRWO S $P(^("AM"),U,2)=1 D
"RTN","RMPR121B",43,0)
 ;.I $D(^RMPR(664.2,RMPRWO,0)) S $P(^(0),U,6)=$P(^(0),U,6)+RMPRSH
"RTN","RMPR121B",44,0)
 S:$D(RMPRDELN) ^RMPR(660,RMPR660,3)=RMPRDELN S ^(1)=RMPRTRN
"RTN","RMPR121B",45,0)
 S DIK="^RMPR(660," D IX1^DIK S $P(^RMPR(664,RMPRA,0),U,12)=RMPR660 K RMPRDP
"RTN","RMPR121B",46,0)
NS S $P(^RMPR(664,RMPRA,2),U,4)="2421PC"
"RTN","RMPR121B",47,0)
 S RESULT=0_"^"_"PO COMPLETE"
"RTN","RMPR121B",48,0)
 S ^TMP("SPS",0)=RMPRPTR
"RTN","RMPR121B",49,0)
 I RMPRPTR=0 D ^RMPR4P21
"RTN","RMPR121B",50,0)
 I +RMPRPTR>0 D EN1^RMPR4P21(RMPRPTR)
"RTN","RMPR121B",51,0)
 Q
"RTN","RMPR121B",52,0)
QUIT ; Quit where IFCAP encountered a problem
"RTN","RMPR121B",53,0)
 S RESULT=1_"^"_"**STAND BY**  Your IFCAP order may be canceled due to a lack of funds. If you can immediately get an increase of funds re-enter your e-sig and complete this PO.  IF YOU LEAVE THIS SCREEN YOUR PO WILL BE LOST"
"RTN","RMPR121B",54,0)
 Q
"RTN","RMPR121B",55,0)
QUT ;
"RTN","RMPR121B",56,0)
 S RESULT="1^IFCAP did not update your Purchase Order, Please Log out and start over."
"RTN","RMPR121B",57,0)
 Q
"RTN","RMPR121B",58,0)
GUIVAR ; Get variable setup from the GUI application
"RTN","RMPR121B",59,0)
 ; Setup Site Variables
"RTN","RMPR121B",60,0)
 D INF^RMPRSIT
"RTN","RMPR121B",61,0)
 ; Shipping info
"RTN","RMPR121B",62,0)
 S $P(^RMPR(664,RMPRA,0),U,14)=RMPR("STA")
"RTN","RMPR121B",63,0)
 S (R1,RMPRCT,RMPRQT,RMPRTO,RMPRI,RMPRR)=0
"RTN","RMPR121B",64,0)
 S RMPRSH=$S($P(^RMPR(664,RMPRA,0),U,10):$P(^(0),U,10),1:"")
"RTN","RMPR121B",65,0)
 F  S R1=$O(^RMPR(664,RMPRA,1,R1)) Q:R1'>0  D
"RTN","RMPR121B",66,0)
 .S RB=^RMPR(664,RMPRA,1,R1,0)
"RTN","RMPR121B",67,0)
 .S RMPRCT=$P(RB,U,3)
"RTN","RMPR121B",68,0)
 .S RMPRQT=$P(RB,U,4)
"RTN","RMPR121B",69,0)
 .S RMPRR=$P(RB,U,8) ;REMARKS
"RTN","RMPR121B",70,0)
 .S RMPRTO=RMPRTO+$J(RMPRCT*RMPRQT,0,2)
"RTN","RMPR121B",71,0)
 S RMPRTOTC=$P($G(^RMPR(664,RMPRA,4)),U,3)
"RTN","RMPR121B",72,0)
 S RMPRPCD=$P(^RMPR(664,RMPRA,4),U,1),$P(^RMPR(664,RMPRA,4),U,1)=$$ENC^RMPR4LI(RMPRPCD,DUZ,RMPRA)
"RTN","RMPR121B",73,0)
 S PRCA=RMPRA
"RTN","RMPR121B",74,0)
 S PRCB=$P(^RMPR(664,RMPRA,4),U,6)
"RTN","RMPR121B",75,0)
 S PRCC=RMPRTOTC
"RTN","RMPR121B",76,0)
 S PRCSITE=$P(^RMPR(664,RMPRA,0),U,14)
"RTN","RMPR121B",77,0)
 S PRCVEN=$P(^RMPR(664,RMPRA,0),U,4)
"RTN","RMPR121B",78,0)
 S RMPRDFN=$P(^RMPR(664,RMPRA,0),U,2)
"RTN","RMPR121B",79,0)
 S RMPRPPA=$P(^VA(200,DUZ,1),U,9)
"RTN","RMPR121B",80,0)
 ; Setup Delivery to Variables
"RTN","RMPR121B",81,0)
 S RMPRY(0)=$P($G(^RMPR(664,RMPRA,3)),U)
"RTN","RMPR121B",82,0)
TST S RMPRY=$S(RMPRY(0)="VETERAN":1,RMPRY(0)="PROSTHETICS":2,RMPRY(0)="OTHER LOCATION AT THIS SITE":3,RMPRY(0)="OTHER LOCATION NOT AT THIS SITE":4,1:"")
"RTN","RMPR121B",83,0)
 D DELIV^RMPR121A
"RTN","RMPR121B",84,0)
 Q
"RTN","RMPR121B",85,0)
C664 ;CANCEL 664 ENTRY WHEN IFCAP IS CANCELLED
"RTN","RMPR121B",86,0)
 S $P(^RMPR(664,RMPRA,0),U,5)=$P(^RMPR(664,RMPRA,0),U),$P(^RMPR(664,RMPRA,2),U,2)=+DUZ
"RTN","RMPR121B",87,0)
 S WDS="INSUFF FUNDS CANCEL",DA=RMPRA,DR="3.1////^S X=WDS",DIE="^RMPR(664," D ^DIE K WDS
"RTN","RMPR121B",88,0)
 Q
"RTN","RMPR4E21")
0^1^B62022503^B60269025
"RTN","RMPR4E21",1,0)
RMPR4E21 ;PHX/HNC - CLOSE OUT PURCHASE CARD TRANSACTION ;3/1/1996
"RTN","RMPR4E21",2,0)
 ;;3.0;PROSTHETICS;**3,12,26,28,30,34,41,45,62,111,78,114,118,133,137**;Feb 09, 1996;Build 5
"RTN","RMPR4E21",3,0)
 ;TH  Patch #78 - 08/04/03 - Add shipment date. Call routine ^RMPR4E23
"RTN","RMPR4E21",4,0)
 ;RVD patch #62 - PCE processing and link to suspense
"RTN","RMPR4E21",5,0)
 ;
"RTN","RMPR4E21",6,0)
 ;I '$D(^PRC(440.5,"H",DUZ)) W !!,"You are not an authorized Purchase Card User, CONTACT FISCAL!" Q
"RTN","RMPR4E21",7,0)
START I '$D(RMPR) D DIV4^RMPRSIT Q:$D(X)
"RTN","RMPR4E21",8,0)
CL K ^TMP($J,"RMPRPCE")
"RTN","RMPR4E21",9,0)
 K DIC S DIC="664",DIC(0)="AEQM",DIC("W")="D EN2^RMPR4D1",DIC("A")="Select PATIENT: "
"RTN","RMPR4E21",10,0)
 S DIC("S")="I $D(^(4)) I ('$P(^(0),U,8)&'$P(^(0),U,5)),($P(^(0),U,14)=RMPR(""STA""))"
"RTN","RMPR4E21",11,0)
 W !!,"You may also make a selection by Purchase Card Transaction"
"RTN","RMPR4E21",12,0)
 W !,"(Example, PO number), or Bank Authorization Number (6 digit number).",!
"RTN","RMPR4E21",13,0)
 D ^DIC S (DA,RMPRA)=+Y I Y=-1 G EXIT
"RTN","RMPR4E21",14,0)
 K DIC G:$P(^RMPR(664,RMPRA,0),U,8) M4 G:$P(^(0),U,5) M6
"RTN","RMPR4E21",15,0)
 L +^RMPR(664,RMPRA,0):1 I $T=0 W !,?5,$C(7),"Someone else is Editing this entry!" G EXIT
"RTN","RMPR4E21",16,0)
 ;get amis grouper number RGRP1
"RTN","RMPR4E21",17,0)
 S RGRP=0,RGRP1=""
"RTN","RMPR4E21",18,0)
 S RGRP=$O(^RMPR(664,RMPRA,1,RGRP)) G:'RGRP BRK S RGRPP=$P($G(^RMPR(664,RMPRA,1,RGRP,0)),U,13) I 'RGRPP W !!,$C(7),"ERROR** This transaction was not posted to 2319, please contact your IRM..",!! S DIR(0)="E" D ^DIR G EXIT
"RTN","RMPR4E21",19,0)
 S RGRP1=$P($G(^RMPR(660,RGRPP,"AMS")),U,1)
"RTN","RMPR4E21",20,0)
 S (RMPRDFN,DFN)=$P(^RMPR(664,RMPRA,0),U,2),RMPRWO=$P(^(0),U,15),RMPRDA=$P(^(0),U,17)
"RTN","RMPR4E21",21,0)
 D DEM^VADPT S RMPRSSNE=VA("PID"),RMPRSSN=+VADM(2),RMPRNAM=VADM(1) K VADM
"RTN","RMPR4E21",22,0)
 ;set original value before close-out
"RTN","RMPR4E21",23,0)
 K ^TMP("RM",$J),RM(RMPRA),RHCED S RMPRF=2
"RTN","RMPR4E21",24,0)
 K %X,%Y S %X="^RMPR(664,RMPRA,",%Y="^TMP("_"""RM"""_",$J,RMPRA," D %XY^%RCR
"RTN","RMPR4E21",25,0)
 S RM(RMPRA,0)=$G(^RMPR(664,RMPRA,0)),RM(RMPRA,2)=$G(^(2)),RM(RMPRA,4)=$G(^(4))
"RTN","RMPR4E21",26,0)
 S RMPER=$P(RM(RMPRA,2),U,6),RMBAN=$P(RM(RMPRA,4),U,2),RMSHI=$P(RM(RMPRA,0),U,11),RMSHIEN=$P(RM(RMPRA,0),U,12)
"RTN","RMPR4E21",27,0)
 S:RMSHI=""!(RMSHI+0=0) RMSHI=0
"RTN","RMPR4E21",28,0)
 ;added by #62
"RTN","RMPR4E21",29,0)
 ;collect all items and previous linkage to suspense.
"RTN","RMPR4E21",30,0)
 I $G(RMSHIEN) S:'$D(^RMPR(660,RMSHIEN,10)) RM60LINK(RMSHIEN)=""
"RTN","RMPR4E21",31,0)
 D COL^RMPRPCEL
"RTN","RMPR4E21",32,0)
 ;
"RTN","RMPR4E21",33,0)
L ;**** ask for final posting *****************************************
"RTN","RMPR4E21",34,0)
 D ^RMPR4LI N DIR K RFLG
"RTN","RMPR4E21",35,0)
 S DIR("A")="Ready to Reconcile and Close-Out Transaction",DIR("B")="NO",DIR(0)="Y"
"RTN","RMPR4E21",36,0)
 S DIR("?")="You may now Close-out and Post this Transaction. Please answer Yes or No."
"RTN","RMPR4E21",37,0)
 D ^DIR I Y["^"!($D(DTOUT)) W !,"Transaction NOT Closed-Out!" S:$D(^TMP("RM",$J)) RFLG=1 G:$D(RFLG) POST1 G KTMP
"RTN","RMPR4E21",38,0)
 I Y=1 G POST1
"RTN","RMPR4E21",39,0)
 ;***add/edit transaction**********************************************
"RTN","RMPR4E21",40,0)
L1 K DIR S DIR(0)="FO",DIR("A")="Select ITEM"
"RTN","RMPR4E21",41,0)
 S DIR("?")="^S RFL=1 D ZDSP^RMPR421A"
"RTN","RMPR4E21",42,0)
 D ^DIR G:(Y="^")!(Y="") DS G:$D(DTOUT) L
"RTN","RMPR4E21",43,0)
 G:$D(DIRUT)&($D(^RMPR(664,RMPRA,1))) L
"RTN","RMPR4E21",44,0)
 S DIC=661,DIC(0)="ENMZ" D ^DIC I +Y'>0 W !,"** No Item selected.." G DS
"RTN","RMPR4E21",45,0)
 G:$D(DTOUT)!$D(DUOUT) L
"RTN","RMPR4E21",46,0)
 D PROC G L1
"RTN","RMPR4E21",47,0)
 ;***process items*******************************************************
"RTN","RMPR4E21",48,0)
PROC N NEW S HY=+Y I $D(^RMPR(664,RMPRA,1,"B",+Y)) S DA=$O(^RMPR(664,RMPRA,1,"B",+Y,0)) G CHK
"RTN","RMPR4E21",49,0)
FILE S Y=HY,NUM=$P(^RMPR(664,RMPRA,1,0),U,4)+1,$P(^(0),U,4)=NUM,$P(^(0),U,3)=$P(^(0),U,3)+1,^RMPR(664,RMPRA,1,NUM,0)=+Y,DA=NUM,^RMPR(664,RMPRA,1,"B",+Y,NUM)="" S NEW=1
"RTN","RMPR4E21",50,0)
ENT K DR,DQ S DA(1)=RMPRA,DIE="^RMPR(664,"_RMPRA_",1,"
"RTN","RMPR4E21",51,0)
 ;S DR=$S($D(NEW):"",1:".01;")
"RTN","RMPR4E21",52,0)
 I '$D(NEW),($P(^RMPR(664,RMPRA,1,DA,0),U,7)="") S $P(^(0),U,7)=$P(^(0),U,3)
"RTN","RMPR4E21",53,0)
 S:'$D(NEW) RMDACA=$P(^RMPR(664,RMPRA,1,DA,0),U,13)
"RTN","RMPR4E21",54,0)
 S R4DA=DA
"RTN","RMPR4E21",55,0)
 S DR="8;S RMTYPE=$P(^RMPR(664,RMPRA,1,R4DA,0),U,9);9;.01;"
"RTN","RMPR4E21",56,0)
 S DR=DR_"16R;1;14;17;15;3R;"
"RTN","RMPR4E21",57,0)
 I $D(NEW) S DR=DR_"2R~UNIT COST;"
"RTN","RMPR4E21",58,0)
 E  S DR=DR_"6R;",RHCNEW=$P($G(^RMPR(664,RMPRA,1,R4DA,0)),U,16)
"RTN","RMPR4E21",59,0)
 S DR=DR_"4R~UNIT OF ISSUE;7;11////C" D ^DIE
"RTN","RMPR4E21",60,0)
 I $D(NEW) S:$G(DA) ^TMP("RM",$J,"N",R4DA)=$G(^RMPR(664,RMPRA,1,R4DA,0))
"RTN","RMPR4E21",61,0)
 E  S:'$G(DA)&(RMDACA) ^TMP("RM",$J,"C",RMDACA)="" I $G(DA) S ^TMP("RM",$J,"E",DA)=$G(^RMPR(664,RMPRA,1,DA,0)),RHCOLD=$P(^RMPR(664,RMPRA,1,DA,0),U,16),RD660=$P(^(0),U,13) I RHCNEW'=RHCOLD D
"RTN","RMPR4E21",62,0)
 .S RHCED=1
"RTN","RMPR4E21",63,0)
 .I $D(RD660)&(RD660) S DIE="^RMPR(660,",DA=RD660,DR="4.5///^S X=$G(RHCOLD)" D ^DIE
"RTN","RMPR4E21",64,0)
 I $D(R4DA),$P($G(^RMPR(664,RMPRA,1,R4DA,0)),U,10)=4 S DA=R4DA,DR=10 D ^DIE
"RTN","RMPR4E21",65,0)
 ;check for Type of Transaction and update the cpt modifier.
"RTN","RMPR4E21",66,0)
 I $D(R4DA),$D(RMTYPE) S RDATA=RMTYPE_"^"_RMPRA_"^"_R4DA D CHKCPT^RMPR4UTL(RDATA)
"RTN","RMPR4E21",67,0)
 Q:$D(DTOUT)  K NUM,R4DA,DA,Y,DR,RD660,RHCOLD,RHCNEW,DIE,RDATA,RMTYPE Q
"RTN","RMPR4E21",68,0)
CHK ;ADD DUPLICATE LINE ITEM
"RTN","RMPR4E21",69,0)
 K DIR,Y S DIR(0)="S^Y:YES;N:NO",DIR("A")="DO YOU WANT TO ADD A DUPLICATE ITEM?",DIR("B")="NO" D ^DIR Q:$D(DIRUT)!($D(DTOUT))  I (X["Y")!(X["y") G FILE
"RTN","RMPR4E21",70,0)
 S RD=0 F RDA=0:0 S RDA=$O(^RMPR(664,RMPRA,1,"B",HY,RDA)) Q:RDA'>0  S RD=RD+1
"RTN","RMPR4E21",71,0)
LKP I RD>1 D  Q:$D(DIRUT)!$D(DTOUT)  I '$D(RD(+Y)) W $C(7) G LKP
"RTN","RMPR4E21",72,0)
 .F RDA=0:0 S RDA=$O(^RMPR(664,RMPRA,1,"B",HY,RDA)) Q:RDA'>0  S RD(RDA)=^RMPR(664,RMPRA,1,RDA,0) W !?5,RDA,?10,$P(^PRC(441,$P(^RMPR(661,$P(RD(RDA),U),0),U),0),U,2),"  $",$S($P(RD(RDA),U,7)'="":$P(RD(RDA),U,7),1:$P(RD(RDA),U,3))
"RTN","RMPR4E21",73,0)
 .K DIR,Y S DIR(0)="N" D ^DIR I +Y S DA=+Y
"RTN","RMPR4E21",74,0)
 G ENT
"RTN","RMPR4E21",75,0)
 ;
"RTN","RMPR4E21",76,0)
DS ;**** update shipping cost, % discount and bank authorization ********
"RTN","RMPR4E21",77,0)
 S (RMPERF,RMBANF,RMSHIF)=0
"RTN","RMPR4E21",78,0)
 I $P(^RMPR(664,RMPRA,0),U,11)="",$P(^(0),U,10) S $P(^(0),U,11)=$P(RM(RMPRA,0),U,10)
"RTN","RMPR4E21",79,0)
 S DA=RMPRA,DIE="^RMPR(664,",DR="12;17;26" D ^DIE
"RTN","RMPR4E21",80,0)
 S:+$P(^RMPR(664,RMPRA,0),U,11)=0 $P(^(0),U,11)=0
"RTN","RMPR4E21",81,0)
 I RMPER'=$P(^RMPR(664,RMPRA,2),U,6) S RMPERF=1
"RTN","RMPR4E21",82,0)
 I RMBAN'=$P(^RMPR(664,RMPRA,4),U,2) S RMBANF=1
"RTN","RMPR4E21",83,0)
 I RMSHI'=$P(^RMPR(664,RMPRA,0),U,11)!($P(^(0),U,11)=0&$P(^(0),U,12)) S RMSHIF=1
"RTN","RMPR4E21",84,0)
CHK1 ;delete imcomplete items
"RTN","RMPR4E21",85,0)
 S DIK="^RMPR(664,"_RMPRA_",1,",DA(1)=RMPRA F I=0:0 S I=$O(^RMPR(664,RMPRA,1,I)) Q:I'>0  S RMPRI=$G(^(I,0)) I $P(RMPRI,U,3)=""!($P(RMPRI,U,4)="")!($P(RMPRI,U,5)="") S DA=I D ^DIK
"RTN","RMPR4E21",86,0)
 G L ;go back to select ITEM
"RTN","RMPR4E21",87,0)
 ;*************************************************************
"RTN","RMPR4E21",88,0)
POST1 ;SET AMOUNT FOR IFCAP AMENDMENT.
"RTN","RMPR4E21",89,0)
 S (R1,RMPR("AMT"),AMT,DCT,RMPRTO)=0
"RTN","RMPR4E21",90,0)
 I $D(^RMPR(664,RMPRA,2)),$P(^(2),U,6) S DCT=$P(^(2),U,6),DCT=DCT/100
"RTN","RMPR4E21",91,0)
 F RI=0:0 S RI=$O(^RMPR(664,RMPRA,1,RI)) Q:RI'>0  D
"RTN","RMPR4E21",92,0)
 .N RMACT
"RTN","RMPR4E21",93,0)
 .S RMX=$G(^RMPR(664,RMPRA,1,RI,0)),RMACT=$P(RMX,U,7),RMQTY=$P(RMX,U,4)
"RTN","RMPR4E21",94,0)
 .I DCT S RMTOT=$S(RMACT=0!(RMACT>0):RMACT-$J(RMACT*DCT,0,2)*RMQTY,1:$P(RMX,U,3)-$J($P(RMX,U,3)*DCT,0,2)*RMQTY)
"RTN","RMPR4E21",95,0)
 .I 'DCT S RMTOT=$S(RMACT=0!(RMACT>0):RMACT*RMQTY,1:$P(RMX,U,3)*RMQTY)
"RTN","RMPR4E21",96,0)
 .S RMPR("AMT")=RMPR("AMT")+RMTOT,RMPRTO=RMPR("AMT")
"RTN","RMPR4E21",97,0)
 S RMPRSH=$S($P(^RMPR(664,RMPRA,0),U,11)=0:0,$P(^RMPR(664,RMPRA,0),U,11):$P(^(0),U,11),$P(^RMPR(664,RMPRA,0),U,10):$P(^(0),U,10),1:"")
"RTN","RMPR4E21",98,0)
 D CHECK^RMPRCT I '$D(RMPRTO) W !,"***** NOT CLOSED-OUT !!!!" G KTMP
"RTN","RMPR4E21",99,0)
 ;**************************************************************
"RTN","RMPR4E21",100,0)
 ;check 4;3,2;8&2;9&4;6 call PRCH7C if needed
"RTN","RMPR4E21",101,0)
 ;if total amount has not changed, then don't need to call ammend
"RTN","RMPR4E21",102,0)
 ;if it is an early record with no ifcap order then don't call ammend
"RTN","RMPR4E21",103,0)
 ;set the reprint flag
"RTN","RMPR4E21",104,0)
 I $FN($P(^RMPR(664,RMPRA,4),U,3),"P",2)'=$FN(RMPRTO+RMPRSH,"P",2)&($P(^(2),U,9)="")!($P(^(2),U,9)'="")&($FN($P(^(2),U,9),"P",2)'=$FN(RMPRTO+RMPRSH,"P",2)) D  I (X=0)&'$D(^TMP("RM",$J)) W !!,"**** NOT CLOSED-OUT!! ****" G KTMP
"RTN","RMPR4E21",105,0)
 .;call IFCAP AMMEND
"RTN","RMPR4E21",106,0)
 .S RMPR442=$P(^RMPR(664,RMPRA,4),U,6) I RMPR442="" Q
"RTN","RMPR4E21",107,0)
 .D AMEND^PRCH7C(RMPR442,RMPRTO+RMPRSH)
"RTN","RMPR4E21",108,0)
 .I X=1 S $P(^RMPR(664,RMPRA,2),U,8)=DUZ,$P(^RMPR(664,RMPRA,2),U,9)=RMPRTO+RMPRSH,$P(^RMPR(664,RMPRA,2),U,10)=1
"RTN","RMPR4E21",109,0)
 .I X'=1 S $P(^RMPR(664,RMPRA,2),U,10)=""
"RTN","RMPR4E21",110,0)
 ;do posting to 660
"RTN","RMPR4E21",111,0)
 I $D(^TMP("RM",$J))!$G(RMSHIF)!$G(RMPERF)!$G(RMBANF) D POST2^RMPR4M
"RTN","RMPR4E21",112,0)
 I $D(RMPRWO),$D(^RMPR(664.2,+RMPRWO,0)) S $P(^("AM"),U,2)=1 S $P(^RMPR(664.2,+RMPRWO,0),U,7)=$P(^(0),U,7)+RMPRSH D DA0^RMPR29M(RMPRDA,RMPRA),POST^RMPR29U
"RTN","RMPR4E21",113,0)
 G:$D(RFLG) EXIT
"RTN","RMPR4E21",114,0)
 ;go to exit in above line if not close-out.
"RTN","RMPR4E21",115,0)
 ;close-out remarks
"RTN","RMPR4E21",116,0)
 W ! S DIE="^RMPR(664,",DA=RMPRA,DR="8.1" D ^DIE S RMPRCC=$P($G(^RMPR(664,RMPRA,2)),U,3)
"RTN","RMPR4E21",117,0)
 F  S R1=$O(^RMPR(664,RMPRA,1,R1)) Q:R1'>0  I $D(^(R1,0)) D
"RTN","RMPR4E21",118,0)
 .N RM660
"RTN","RMPR4E21",119,0)
 .S RM660=$P($G(^(0)),U,13) I RM660,$P($G(^RMPR(660,RM660,0)),U,18)'[RMPRCC S $P(^(0),U,18)=$P(^(0),U,18)_" "_RMPRCC
"RTN","RMPR4E21",120,0)
 ;
"RTN","RMPR4E21",121,0)
EX ;***reindex record in 664 here
"RTN","RMPR4E21",122,0)
 L -^RMPR(664,RMPRA,0)
"RTN","RMPR4E21",123,0)
 ;IFCAP final charge payment
"RTN","RMPR4E21",124,0)
 S RMPR442=$P(^RMPR(664,RMPRA,4),U,6) ;don't call recon if it is an early record, no ifcap order.
"RTN","RMPR4E21",125,0)
 D:RMPR442'="" RECON^PRCH7C(RMPR442,DUZ)
"RTN","RMPR4E21",126,0)
 I (X=0)&(RMPR442'="") W !!,"**** TRANSACTION NOT CLOSED-OUT!! ****" G EX1
"RTN","RMPR4E21",127,0)
 S $P(^RMPR(664,RMPRA,4),U,4)=RMPRTO+RMPRSH
"RTN","RMPR4E21",128,0)
 ;set close out date 
"RTN","RMPR4E21",129,0)
 D NOW^%DTC S $P(^RMPR(664,RMPRA,0),U,8)=%
"RTN","RMPR4E21",130,0)
 ;set closed by
"RTN","RMPR4E21",131,0)
 S $P(^RMPR(664,RMPRA,2),U,7)=DUZ,DA=$P(^RMPR(664,RMPRA,0),U,12)
"RTN","RMPR4E21",132,0)
 I DA'="" S $P(^RMPR(660,DA,0),U,12)=%,DIK="^RMPR(660," D IX1^DIK
"RTN","RMPR4E21",133,0)
 S RMPR660=0,DA="",DIK="^RMPR(660,"
"RTN","RMPR4E21",134,0)
 F  S RMPR660=$O(^RMPR(664,RMPRA,1,RMPR660)) Q:RMPR660'>0  D
"RTN","RMPR4E21",135,0)
 .;get pointer from item mult
"RTN","RMPR4E21",136,0)
 .S DA=$P(^RMPR(664,RMPRA,1,RMPR660,0),U,13)
"RTN","RMPR4E21",137,0)
 .;set delivery date
"RTN","RMPR4E21",138,0)
 .I DA'="" S $P(^RMPR(660,DA,0),U,12)=DT D IX1^DIK
"RTN","RMPR4E21",139,0)
 .;Patch #78 - Get IFCAP Transaction Date and prompt for Shipment Date
"RTN","RMPR4E21",140,0)
 .I DA'="" S SKPSHDT=1 D ^RMPR4E23 K SKPSHDT
"RTN","RMPR4E21",141,0)
EX1 ;
"RTN","RMPR4E21",142,0)
 I $D(RM60LINK) D
"RTN","RMPR4E21",143,0)
 . F I=0:0 S I=$O(RM60LINK(I)) Q:I'>0  D
"RTN","RMPR4E21",144,0)
 .. I '$D(^RMPR(660,I,0)) K RM60LINK(I)
"RTN","RMPR4E21",145,0)
 ;added by #62
"RTN","RMPR4E21",146,0)
 D:$D(RM68FG)=1 AUTO^RMPRPCEL D:$D(RM68FG)>1 MAN^RMPRPCEL
"RTN","RMPR4E21",147,0)
 ;
"RTN","RMPR4E21",148,0)
 D EXIT
"RTN","RMPR4E21",149,0)
 W !!,"Enter Next Transaction to Close-out, or <RETURN> to continue."
"RTN","RMPR4E21",150,0)
 G CL
"RTN","RMPR4E21",151,0)
 ;
"RTN","RMPR4E21",152,0)
EXIT ;KILL VARIABLES AND EXIT ROUTINE
"RTN","RMPR4E21",153,0)
 L:$D(RMPRA) -^RMPR(664,RMPRA,0)
"RTN","RMPR4E21",154,0)
 K ^TMP($J),^TMP("RM")
"RTN","RMPR4E21",155,0)
 K RGRP,RGRP1,RGRPP,RMBAN,RMBANF
"RTN","RMPR4E21",156,0)
 N RMPR,RMPRSITE D KILL^XUSCLEAN
"RTN","RMPR4E21",157,0)
 Q
"RTN","RMPR4E21",158,0)
 ;
"RTN","RMPR4E21",159,0)
KTMP S DIK="^RMPR(664,"_RMPRA_",1,",DA(1)=RMPRA F I=0:0 S I=$O(^TMP("RM",$J,"N",I)) Q:I'>0  S DA=I D ^DIK
"RTN","RMPR4E21",160,0)
 S %X="^TMP("_"""RM"""_",$J,RMPRA,",%Y="^RMPR(664,RMPRA," D %XY^%RCR G EX1
"RTN","RMPR4E21",161,0)
BRK W !,$C(7),"INCOMPLETE RECORD..file 664..entry..",RMPRA,"...PLEASE CONTACT YOUR IRM or CANCEL THIS ENTRY!!!" G EX1
"RTN","RMPR4E21",162,0)
UNK W !,$C(7),"UNKNOWN 2319 RECORD TO UPDATE, 2319 NOT UPDATED!" G EXIT
"RTN","RMPR4E21",163,0)
M4 W !,$C(7),"This Transaction has already been CLOSED!" G EXIT
"RTN","RMPR4E21",164,0)
M6 W !,$C(7),"This Transaction has been CANCELED!" G EXIT
"RTN","RMPRPAT2")
0^2^B27661338^B25940466
"RTN","RMPRPAT2",1,0)
RMPRPAT2 ;PHX/RFM/JLT/HNC-DISPLAY PATIENT ITEM ACTIVITY ;10/19/1993
"RTN","RMPRPAT2",2,0)
 ;;3.0;PROSTHETICS;**32,34,29,44,99,75,137**;Feb 09, 1996;Build 5
"RTN","RMPRPAT2",3,0)
 D HDR N RMPRMERG S RMPRMERG=0
"RTN","RMPRPAT2",4,0)
 S (RA,AN,ANS,RK,RZ)=0 K ^TMP($J,"TT"),^TMP($J,"AG"),IT
"RTN","RMPRPAT2",5,0)
 MERGE ^TMP($J,"TT")=^RMPR(660,"AC",RMPRDFN)
"RTN","RMPRPAT2",6,0)
 ;Check for merged accounts
"RTN","RMPRPAT2",7,0)
 I $D(^XDRM("B",RMPRDFN_";DPT(")) D
"RTN","RMPRPAT2",8,0)
 . S RMPRMERG=$O(^XDRM("B",RMPRDFN_";DPT(",RMPRMERG)) Q:RMPRMERG=""
"RTN","RMPRPAT2",9,0)
 . S RMPRMERG=+^XDRM(RMPRMERG,0) Q:RMPRMERG=0
"RTN","RMPRPAT2",10,0)
 . MERGE ^TMP($J,"TT")=^RMPR(660,"AC",RMPRMERG)
"RTN","RMPRPAT2",11,0)
 S B=0
"RTN","RMPRPAT2",12,0)
 F  S B=$O(^TMP($J,"TT",B)) Q:B'>0  D
"RTN","RMPRPAT2",13,0)
 . S BC=0
"RTN","RMPRPAT2",14,0)
 . F  S BC=$O(^TMP($J,"TT",B,BC)) Q:BC'>0  D
"RTN","RMPRPAT2",15,0)
 . .Q:$P($G(^RMPR(660,BC,0)),U,10)'=RMPR("STA")
"RTN","RMPRPAT2",16,0)
 . .S GN=$P($G(^RMPR(660,BC,"AMS")),U,1)
"RTN","RMPRPAT2",17,0)
 . .S ND=$P($G(^RMPR(660,BC,1)),U,4)
"RTN","RMPRPAT2",18,0)
 . .I ND S ND=$P(^RMPR(661.1,ND,0),U,8)
"RTN","RMPRPAT2",19,0)
 . .S:ND="" ND=2
"RTN","RMPRPAT2",20,0)
 . .S:GN="" GN=BC
"RTN","RMPRPAT2",21,0)
 . .S ^TMP($J,"AG",GN,ND,BC)=B
"RTN","RMPRPAT2",22,0)
 S B=""
"RTN","RMPRPAT2",23,0)
 F  S B=$O(^TMP($J,"AG",B)) Q:+B=0  D
"RTN","RMPRPAT2",24,0)
 .S BC=""
"RTN","RMPRPAT2",25,0)
 .F  S BC=$O(^TMP($J,"AG",B,BC)) Q:BC'>0  D
"RTN","RMPRPAT2",26,0)
 . .Q:BC=2
"RTN","RMPRPAT2",27,0)
 . .MERGE ^TMP($J,"AGG")=^TMP($J,"AG",B)
"RTN","RMPRPAT2",28,0)
 . .S HC="",GTCST=0
"RTN","RMPRPAT2",29,0)
 . .K HCC1
"RTN","RMPRPAT2",30,0)
 . .F  S HC=$O(^TMP($J,"AGG",HC)) Q:HC'>0  D
"RTN","RMPRPAT2",31,0)
 . . .S HCC=0
"RTN","RMPRPAT2",32,0)
 . . .;changes for Surgical Implants
"RTN","RMPRPAT2",33,0)
 . . .S BDC=""
"RTN","RMPRPAT2",34,0)
 . . .F BDC=1:1 S HCC=$O(^TMP($J,"AGG",HC,HCC)) Q:HCC'>0  D
"RTN","RMPRPAT2",35,0)
 . . . .S GTCST=GTCST+$P(^RMPR(660,HCC,0),U,16)
"RTN","RMPRPAT2",36,0)
 . . . .I BDC=1&(HC'=2) S HCC1=HCC
"RTN","RMPRPAT2",37,0)
 . . . .I BDC'=1 K ^TMP($J,"TT",^TMP($J,"AGG",HC,HCC),HCC)
"RTN","RMPRPAT2",38,0)
 . . . .I HC=2 K ^TMP($J,"TT",^TMP($J,"AGG",HC,HCC),HCC)
"RTN","RMPRPAT2",39,0)
 . .I $G(HCC1) S $P(^TMP($J,"TT",^TMP($J,"AGG",1,HCC1),HCC1),U,3)=GTCST K HCC1
"RTN","RMPRPAT2",40,0)
 . .K GTCST,^TMP($J,"AGG")
"RTN","RMPRPAT2",41,0)
 K ^TMP($J,"AG"),BDC
"RTN","RMPRPAT2",42,0)
 S B=0,RC=1
"RTN","RMPRPAT2",43,0)
 F  S B=$O(^TMP($J,"TT",B)) Q:B'>0  D
"RTN","RMPRPAT2",44,0)
 .S RK=0
"RTN","RMPRPAT2",45,0)
 .F  S RK=$O(^TMP($J,"TT",B,RK)) Q:RK'>0  D
"RTN","RMPRPAT2",46,0)
 . .Q:$D(^RMPO(665.72,"AC",RK))
"RTN","RMPRPAT2",47,0)
 . .S IT(RC)=RK
"RTN","RMPRPAT2",48,0)
 . .I $P(^TMP($J,"TT",B,RK),U,3) S $P(IT(RC),U,3)=$P(^TMP($J,"TT",B,RK),U,3)
"RTN","RMPRPAT2",49,0)
 . .S RC=RC+1
"RTN","RMPRPAT2",50,0)
 S RK=0,RZ=0
"RTN","RMPRPAT2",51,0)
 K ^TMP($J,"TT"),B
"RTN","RMPRPAT2",52,0)
 ;
"RTN","RMPRPAT2",53,0)
 G:'$D(IT) END
"RTN","RMPRPAT2",54,0)
DIS ;DISPLAY APPLIANCES OR REPAIRS
"RTN","RMPRPAT2",55,0)
 I $G(RK)="" S RK="",RC=""
"RTN","RMPRPAT2",56,0)
 I (RK+1'>RC)&($G(IT(RK+1))) S RK=RK+1 S AN=+IT(RK),Y=^RMPR(660,AN,0) D PRT,OVER:((IOSL-4)<$Y) G:'$D(ANS)!(ANS=U)!($D(DUOUT))!($D(DTOUT)) EXIT G DIS
"RTN","RMPRPAT2",57,0)
END I RC=0 W !,"No Appliances or Repairs exist for this veteran!",!! H 3 G EXIT
"RTN","RMPRPAT2",58,0)
 ;
"RTN","RMPRPAT2",59,0)
 I RC>0 W !!,"End of Appliance/Repair records for this veteran!" D OVER I $G(RK)+1'>$G(RC)&($G(IT($G(RK)+1))) D DIS
"RTN","RMPRPAT2",60,0)
 ;
"RTN","RMPRPAT2",61,0)
EXIT K I,J,L,R0,IT,RA
"RTN","RMPRPAT2",62,0)
 Q:'$D(RMPRDFN)
"RTN","RMPRPAT2",63,0)
 W !
"RTN","RMPRPAT2",64,0)
 I $D(DUOUT)!($D(DTOUT)) G ASK1^RMPRPAT
"RTN","RMPRPAT2",65,0)
 S FL=4 G ASK2^RMPRPAT
"RTN","RMPRPAT2",66,0)
 Q
"RTN","RMPRPAT2",67,0)
PRT S DATE=$P(Y,U,3),TYPE=$P(Y,U,6),QTY=$P(Y,U,7)
"RTN","RMPRPAT2",68,0)
 S VEN=$P(Y,U,9),TRANS=$P(Y,U,4),STA=$P(Y,U,10),SN=$P(Y,U,11)
"RTN","RMPRPAT2",69,0)
 S DEL=$P(Y,U,12)
"RTN","RMPRPAT2",70,0)
 S CST=$S($P(Y,U,16)'="":$P(Y,U,16),$D(^RMPR(660,AN,"LB")):$P(^RMPR(660,AN,"LB"),U,9),1:"")
"RTN","RMPRPAT2",71,0)
 ;lab source of procurement
"RTN","RMPRPAT2",72,0)
 I $D(^RMPR(660,AN,"LB")) S RMPRLPRO=$P(^("LB"),U,3) D
"RTN","RMPRPAT2",73,0)
 .I RMPRLPRO="O" S RMPRLPRO="ORTHOTIC" Q
"RTN","RMPRPAT2",74,0)
 .I RMPRLPRO="R" S RMPRLPRO="RESTORATION" Q
"RTN","RMPRPAT2",75,0)
 .I RMPRLPRO="S" S RMPRLPRO="SHOE" Q
"RTN","RMPRPAT2",76,0)
 .I RMPRLPRO="W" S RMPRLPRO="WHEELCHAIR" Q
"RTN","RMPRPAT2",77,0)
 .I RMPRLPRO="N" S RMPRLPRO="FOOT CENTER" Q
"RTN","RMPRPAT2",78,0)
 .I RMPRLPRO="D" S RMPRLPRO="DDC" Q
"RTN","RMPRPAT2",79,0)
 ;form requested on
"RTN","RMPRPAT2",80,0)
 S FRM=$P(Y,U,13),REM=$P(Y,U,18)
"RTN","RMPRPAT2",81,0)
 S DATE=$E(DATE,4,5)_"/"_$E(DATE,6,7)_"/"_$E(DATE,2,3)
"RTN","RMPRPAT2",82,0)
 S TYPE=$P($G(^RMPR(660,AN,1)),U,4)
"RTN","RMPRPAT2",83,0)
 ;S TYPE=$S(TYPE="":"",$D(^RMPR(661,TYPE,0)):$P(^(0),U,1),1:"")
"RTN","RMPRPAT2",84,0)
 S AMIS=$P(Y,U,15),VEN=$S(VEN="":"",$D(^PRC(440,VEN,0)):$P(^(0),U,1),1:"")
"RTN","RMPRPAT2",85,0)
 I $D(^RMPR(660.1,"AC",AN)),$P(^RMPR(660.1,$O(^RMPR(660.1,"AC",AN,0)),0),U,11)]"" S AMIS=AMIS_"+"
"RTN","RMPRPAT2",86,0)
 S TRANS=$S(TRANS]"":TRANS,1:""),TRANS1="" S:TRANS="X" TRANS1=TRANS,TRANS=""
"RTN","RMPRPAT2",87,0)
 S DEL=$E(DEL,4,5)_"/"_$E(DEL,6,7)_"/"_$E(DEL,2,3) S:DEL="//" DEL=""
"RTN","RMPRPAT2",88,0)
 W !,RK,". ",DATE,?13,QTY,?17
"RTN","RMPRPAT2",89,0)
 ;W AMIS_$S(TYPE'="":$E($P(^PRC(441,TYPE,0),U,2),1,10),$P(Y,U,26)="D":"DELIVERY",$P(Y,U,26)="P":"PICKUP",$P(Y,U,17):"SHIPPING",1:"")
"RTN","RMPRPAT2",90,0)
 W AMIS_$S(TYPE'="":$E($P($G(^RMPR(661.1,TYPE,0)),U,2),1,10),$P(Y,U,26)="D":"DELIVERY",$P(Y,U,26)="P":"PICKUP",$P(Y,U,17):"SHIPPING",1:"")
"RTN","RMPRPAT2",91,0)
 ;historical item
"RTN","RMPRPAT2",92,0)
 I TYPE=""&($D(^RMPR(660,$P(IT(RK),U,1),"HST"))) W $E($P(^("HST"),U,1),1,10)
"RTN","RMPRPAT2",93,0)
 W ?30,TRANS,?31,TRANS1
"RTN","RMPRPAT2",94,0)
 ;display source of procurement for 2529-3 under vendor header
"RTN","RMPRPAT2",95,0)
 I $D(RMPRLPRO) W ?33,RMPRLPRO
"RTN","RMPRPAT2",96,0)
 ;I '$D(RMPRLPRO),VEN'="" W ?33,$E(VEN,1,10)
"RTN","RMPRPAT2",97,0)
 I VEN'="" W ?33,$E(VEN,1,10)
"RTN","RMPRPAT2",98,0)
 K RMPRLPRO
"RTN","RMPRPAT2",99,0)
 ;historical vendor
"RTN","RMPRPAT2",100,0)
 W:$D(^RMPR(660,$P(IT(RK),U,1),"HST")) $E($P(^("HST"),U,3),1,10)
"RTN","RMPRPAT2",101,0)
 W:STA'="" ?45,$P(^DIC(4,STA,99),U,1)
"RTN","RMPRPAT2",102,0)
 W ?50,$E(SN,1,9),?60,DEL
"RTN","RMPRPAT2",103,0)
 I $P(IT(RK),U,3) S CST=$P(IT(RK),U,3)
"RTN","RMPRPAT2",104,0)
 W ?71,$J($FN($S(CST'="":CST,$P(Y,U,17):$P(Y,U,17),1:""),"T",2),9)
"RTN","RMPRPAT2",105,0)
 W:REM]"" !,?3,REM
"RTN","RMPRPAT2",106,0)
 I $P(IT(RK),U,2)="" S $P(IT(RK),U,2)=RZ
"RTN","RMPRPAT2",107,0)
 Q
"RTN","RMPRPAT2",108,0)
OVER ;
"RTN","RMPRPAT2",109,0)
 N ANS
"RTN","RMPRPAT2",110,0)
 S RZ=RK W !,"+=Turned-In  *=Historical Data  I=Initial  X=Repair  S=Spare  R=Replacement",!,"Enter 1-",RK," to show full entry, '^' to exit or `return` to continue.  " R ANS:DTIME S:'$T ANS="^"
"RTN","RMPRPAT2",111,0)
 I ANS="^^" S ANS="^" G ASK1^RMPRPAT Q
"RTN","RMPRPAT2",112,0)
 I ANS="^" G ASK1^RMPRPAT Q
"RTN","RMPRPAT2",113,0)
 I ANS="",RK+1'>RC&($G(IT(RK+1))) D HDR Q
"RTN","RMPRPAT2",114,0)
 I ANS="" Q
"RTN","RMPRPAT2",115,0)
 I ANS'?1N.N!(ANS>RK)!(+ANS=0)!(+ANS'=ANS) W $C(7),!," Must be between 1 and ",RK," to be valid" G OVER
"RTN","RMPRPAT2",116,0)
 I ANS>0,(ANS<(RK+1)) S AN=ANS,RZ=RK D ^RMPRPAT3
"RTN","RMPRPAT2",117,0)
 S RK=$P(IT(ANS),U,2)
"RTN","RMPRPAT2",118,0)
 Q
"RTN","RMPRPAT2",119,0)
HDR ;Print Header, Screen 4
"RTN","RMPRPAT2",120,0)
 W @IOF
"RTN","RMPRPAT2",121,0)
 S PAGE=3
"RTN","RMPRPAT2",122,0)
 W !,$E(RMPRNAM,1,20),?23,"SSN: "
"RTN","RMPRPAT2",123,0)
 W $E(RMPRSSN,1,3)_"-"_$E(RMPRSSN,4,5)_"-"_$E(RMPRSSN,6,10)
"RTN","RMPRPAT2",124,0)
 W ?42,"DOB: "
"RTN","RMPRPAT2",125,0)
 S Y=RMPRDOB X ^DD("DD") W Y K Y
"RTN","RMPRPAT2",126,0)
 W ?61,"CLAIM# ",$G(RMPRCNUM)
"RTN","RMPRPAT2",127,0)
 W !?4,"Date",?12,"Qty",?19,"HCPCS",?28,"Type",?34,"Vendor",?45,"Sta",?50,"Serial",?58,"Delivery Date",?72,"Tot Cost"
"RTN","RMPRPAT2",128,0)
 Q
"RTN","RMPRPRT1")
0^3^B24629697^B21363701
"RTN","RMPRPRT1",1,0)
RMPRPRT1 ;PHX/HNB-CONTINUATION OF PRINT 2319 ;10/19/1993
"RTN","RMPRPRT1",2,0)
 ;;3.0;PROSTHETICS;**10,99,137**;Feb 09, 1996;Build 5
"RTN","RMPRPRT1",3,0)
 ;CALLED BY END^RMPRPRT
"RTN","RMPRPRT1",4,0)
 ;VARIABLES REQUIRED: R5 - A STRING ARRAY HOLDING PATIENT'S PROSTHETIC
"RTN","RMPRPRT1",5,0)
 ;                         DISABILITY CODE INFORMATION
"RTN","RMPRPRT1",6,0)
 N RMPRMERG S RMPRMERG=0
"RTN","RMPRPRT1",7,0)
 I $D(^XDRM("B",RMPRDFN_";DPT(")) D
"RTN","RMPRPRT1",8,0)
 . S RMPRMERG=$O(^XDRM("B",RMPRDFN_";DPT(",RMPRMERG)) Q:RMPRMERG=""
"RTN","RMPRPRT1",9,0)
 . S RMPRMERG=+^XDRM(RMPRMERG,0)
"RTN","RMPRPRT1",10,0)
 I $Y>(IOSL-6) W @IOF D HDR^RMPRPRT
"RTN","RMPRPRT1",11,0)
 W !!,"PSC Issue Card: " S J=0 W !
"RTN","RMPRPRT1",12,0)
 F I=1:1 D  Q:J'>0
"RTN","RMPRPRT1",13,0)
 .I $Y>(IOSL-6) W @IOF D HDR^RMPRPRT
"RTN","RMPRPRT1",14,0)
 .S J=$O(R5(5,J)) Q:J=""!(J?.A)  Q:$G(J)<1 
"RTN","RMPRPRT1",15,0)
 .S L=$P(R5(5,J,0),U,1) ;S L=$P(R5(5,J,0),U,1) 
"RTN","RMPRPRT1",16,0)
 .W $E(L,4,5)_"-"_$E(L,6,7)_"-"_$E(L,2,3),?17,"Appl: ",$S($D(^RMPR(661,+$P(R5(5,J,0),U,4),0)):$E($P(^PRC(441,+$P(^(0),U),0),U,2),1,37),1:"UNKNOWN"),?66,"SN: ",$P(R5(5,J,0),U,3),!
"RTN","RMPRPRT1",17,0)
 I I=1 W "NONE LISTED",!
"RTN","RMPRPRT1",18,0)
 W !,"Clothing Allowance: ",!
"RTN","RMPRPRT1",19,0)
 I $D(R5(6)),$O(R5(6,0))>0 D
"RTN","RMPRPRT1",20,0)
 .F RI=0:0 S RI=$O(^RMPR(665,RMPRDFN,6,"B",RI)) Q:RI'>0  D
"RTN","RMPRPRT1",21,0)
 ..S RA=$O(^RMPR(665,RMPRDFN,6,"B",RI,0))
"RTN","RMPRPRT1",22,0)
 ..S RR5=R5(6,RA,0),RR5=RR5
"RTN","RMPRPRT1",23,0)
 ..;D  I $Y>(IOSL-6) W @IOF D HDR^RMPRPRT
"RTN","RMPRPRT1",24,0)
 ..W ?22,"DATE: ",$E(RR5,4,5)_"-"_$E(RR5,6,7)_"-"_$E(RR5,2,3)
"RTN","RMPRPRT1",25,0)
 ..W "  ",$S($P(RR5,U,2)["E":"ELIGIBLE",$P(RR5,U,2)["N":"NOT-ELIGIBLE",1:"")
"RTN","RMPRPRT1",26,0)
 ..W "  ",$S($P(RR5,U,3)["S":"STATIC",$P(RR5,U,3)["N":"NON-STATIC",1:"")
"RTN","RMPRPRT1",27,0)
 ..I $P(RR5,U,5) S Y=$P(RR5,U,5) D DD^%DT W !,?22,"Date of Exam: ",Y W:$P(RR5,U,6) "  Examiner: ",$E($P(^VA(200,$P(RR5,U,6),0),U,1),1,30)
"RTN","RMPRPRT1",28,0)
 ..W !,?22,"Desc: "
"RTN","RMPRPRT1",29,0)
 ..W $S($D(R5(6,RA,1)):$P(R5(6,RA,1),U),1:""),!
"RTN","RMPRPRT1",30,0)
 ..I $Y>(IOSL-6) W @IOF D HDR^RMPRPRT
"RTN","RMPRPRT1",31,0)
 I '$D(R5(6)),$P(R5(0),U,6)="" W "NONE LISTED",!
"RTN","RMPRPRT1",32,0)
 S RO=0
"RTN","RMPRPRT1",33,0)
 F  S RO=$O(^RMPR(667,"C",RMPRDFN,RO)) Q:RO'>0  D  I $Y>(IOSL-6) W @IOF D HDR^RMPRPRT
"RTN","RMPRPRT1",34,0)
 .Q:$P(^RMPR(667,RO,2),U,1)=0
"RTN","RMPRPRT1",35,0)
 .W:'$D(RMPRFLG) !,"Automobile(s):",?15,"Make",?27,"Model",?39,"Vehical ID #",?62,"Date Processed"
"RTN","RMPRPRT1",36,0)
 .W:'$P(^RMPR(667,RO,0),U,6)'="" !?15,$E($P(^RMPR(667.2,$P(^RMPR(667,RO,0),U,6),0),U,1),1,11),?27,$E($P(^RMPR(667,RO,0),U,7),1,10),?39,$P(^RMPR(667,RO,0),U,1) S Y=$P(^RMPR(667,RO,0),U,8) D DD^%DT W ?64,Y S RMPRFLG=1
"RTN","RMPRPRT1",37,0)
 I '$D(RMPRFLG) W !,"Automobile(s): NONE LISTED"
"RTN","RMPRPRT1",38,0)
 W !,"Items Returned: "
"RTN","RMPRPRT1",39,0)
 I $D(^RMPR(665,RMPRDFN,7,0)) D OLD^RMPRPAT1
"RTN","RMPRPRT1",40,0)
 I $D(^RMPR(660.1,"C",RMPRDFN)) S RO=0 F  S RO=$O(^RMPR(660.1,"C",RMPRDFN,RO)) Q:RO'>0  D WRIL^RMPRPAT1
"RTN","RMPRPRT1",41,0)
 I '$D(^RMPR(660.1,"C",RMPRDFN)) W "NONE LISTED"
"RTN","RMPRPRT1",42,0)
 ;W !!,"Items on loan: " I $D(^RMPR(660.1,"C",RMPRDFN)) S RO=0 F  S RO=$O(^RMPR(660.1,"C",RMPRDFN,RO)) Q:RO=""  D WRIL^RMPRPAT1
"RTN","RMPRPRT1",43,0)
 W !!,"Other Data: " S J=0 F I=1:1 S J=$O(R5(4,J)) Q:J=""!(J?.A)  W !?5,R5(4,J,0) I $Y>(IOSL-6) W @IOF D HDR^RMPRPRT
"RTN","RMPRPRT1",44,0)
 I I=1 W "NONE LISTED"
"RTN","RMPRPRT1",45,0)
 I $Y>(IOSL-6) W @IOF D HDR^RMPRPRT
"RTN","RMPRPRT1",46,0)
 W !,"RECORD OF APPLIANCES/REPAIRS: " D HDRH S RC=0,(RA,AN)=""
"RTN","RMPRPRT1",47,0)
 S RA=""
"RTN","RMPRPRT1",48,0)
 F  S RA=$O(^RMPR(660,"AC",RMPRDFN,RA)) Q:RA'>0  S AN="" F  S AN=$O(^RMPR(660,"AC",RMPRDFN,RA,AN)) Q:AN'>0  S RC=RC+1,Y=^RMPR(660,AN,0) D PRT I $Y>(IOSL-6) W @IOF D HDR^RMPRPRT
"RTN","RMPRPRT1",49,0)
 S RA=""
"RTN","RMPRPRT1",50,0)
 I RMPRMERG D
"RTN","RMPRPRT1",51,0)
 . F  S RA=$O(^RMPR(660,"AC",RMPRMERG,RA)) Q:RA'>0  S AN="" F  S AN=$O(^RMPR(660,"AC",RMPRMERG,RA,AN)) Q:AN'>0  S RC=RC+1,Y=^RMPR(660,AN,0) D PRT I $Y>(IOSL-6) W @IOF D HDR^RMPRPRT
"RTN","RMPRPRT1",52,0)
 I RC=0 W !,"No Appliances or Repairs exist for this veteran!",!!
"RTN","RMPRPRT1",53,0)
 E  W !!,"End of Appliance/Repair records for this veteran!",!!," *Historical Item"
"RTN","RMPRPRT1",54,0)
EXIT K I,IT,J,L,RC,K,RA,AN,DATE,TYPE,QTY,VEN,TRANS,TRANS1,STA,SN,DEL,CST,FRM,REM,R0,RMPRE,RMPRFLG,RO,Y G EXIT^RMPRPRT
"RTN","RMPRPRT1",55,0)
HDRH W !!?4,"DATE",?13,"QTY",?17," HCPCS DESC",?29,"N R ",?33,"VENDOR",?45,"STA",?50,"SERIAL NBR",?62,"DELIVERED",?72,"COST",!
"RTN","RMPRPRT1",56,0)
 F L=1:1:79 W "-"
"RTN","RMPRPRT1",57,0)
 Q
"RTN","RMPRPRT1",58,0)
PRT S DATE=$P(Y,U,3),TYPE=$P(Y,U,6),QTY=$P(Y,U,7),VEN=$P(Y,U,9),TRANS=$P(Y,U,4),STA=$P(Y,U,10),SN=$P(Y,U,11),DEL=$P(Y,U,12),AMIS=$P(Y,U,15)
"RTN","RMPRPRT1",59,0)
 ;include 2529-3 data
"RTN","RMPRPRT1",60,0)
 S CST=$S($P(Y,U,16)'="":$P(Y,U,16),$D(^RMPR(660,AN,"LB")):$P(^RMPR(660,AN,"LB"),U,9),1:"")
"RTN","RMPRPRT1",61,0)
 ;vendor 2529-3
"RTN","RMPRPRT1",62,0)
 I $D(^RMPR(660,AN,"LB")) S RMPRLPRO=$P(^("LB"),U,3) D
"RTN","RMPRPRT1",63,0)
 .I RMPRLPRO="O" S RMPRLPRO="ORTHOTIC" Q
"RTN","RMPRPRT1",64,0)
 .I RMPRLPRO="R" S RMPRLPRO="RESTROATION" Q
"RTN","RMPRPRT1",65,0)
 .I RMPRLPRO="S" S RMPRLPRO="SHOE" Q
"RTN","RMPRPRT1",66,0)
 .I RMPRLPRO="W" S RMPRLPRO="WHEELCHAIR" Q
"RTN","RMPRPRT1",67,0)
 .I RMPRLPRO="N" S RMPRLPRO="FOOT CENTER" Q
"RTN","RMPRPRT1",68,0)
 .I RMPRLPRO="D" S RMPRLPRO="DDC" Q
"RTN","RMPRPRT1",69,0)
 S FRM=$P(Y,U,13),REM=$P(Y,U,18),DATE=$E(DATE,4,5)_"/"_$E(DATE,6,7)_"/"_$E(DATE,2,3)
"RTN","RMPRPRT1",70,0)
 ;S TYPE=$S(TYPE="":"",$D(^RMPR(661,TYPE,0)):$P(^(0),U,1),1:"")
"RTN","RMPRPRT1",71,0)
 S TYPE=$P($G(^RMPR(660,AN,1)),U,4)
"RTN","RMPRPRT1",72,0)
 S VEN=$S(VEN="":"",$D(^PRC(440,VEN,0)):$P(^(0),U,1),1:"")
"RTN","RMPRPRT1",73,0)
 S TRANS=$S(TRANS]"":TRANS,1:""),TRANS1="" S:TRANS="X" TRANS1=TRANS,TRANS=""
"RTN","RMPRPRT1",74,0)
 S DEL=$E(DEL,4,5)_"/"_$E(DEL,6,7)_"/"_$E(DEL,2,3) S:DEL="//" DEL=""
"RTN","RMPRPRT1",75,0)
 W !,RC,". ",DATE,?13,QTY,?17
"RTN","RMPRPRT1",76,0)
 W AMIS_$S(TYPE'="":$E($P($G(^RMPR(661.1,TYPE,0)),U,2),1,10),$P(Y,U,26)="D":"DELIVERY",$P(Y,U,26)="P":"PICKUP",$P(Y,U,17):"SHIPPING",1:"")
"RTN","RMPRPRT1",77,0)
 ;AMIS_$S(TYPE'="":$E($P(^PRC(441,TYPE,0),U,2),1,10),$P(Y,U,26)="D":"DELIVERY",$P(Y,U,26)="P":"PICKUP",$P(Y,U,17):"SHIPPING",1:"")
"RTN","RMPRPRT1",78,0)
 ;I TYPE=""&($D(^RMPR(660,$P(IT(RK),U,1),"HST"))) W $E($P(^("HST"),U,1),1,10)
"RTN","RMPRPRT1",79,0)
 W ?29,TRANS,?31,TRANS1
"RTN","RMPRPRT1",80,0)
 ;display source of procurement 2529-3 under vendor header
"RTN","RMPRPRT1",81,0)
 I $D(RMPRLPRO) W ?33,RMPRLPRO
"RTN","RMPRPRT1",82,0)
 K RMPRLPRO
"RTN","RMPRPRT1",83,0)
 I VEN'="" W ?33,$E(VEN,1,10)
"RTN","RMPRPRT1",84,0)
 W ?45,$P(^DIC(4,STA,99),U,1),?50,$E(SN,1,10),?62,DEL,?72,$J($S(CST'="":CST,$P(Y,U,17):$P(Y,U,17),1:""),0,2)
"RTN","RMPRPRT1",85,0)
 W:REM]"" !,?5,"REMARKS: ",REM I $Y+6>IOSL D HDR^RMPRPRT,HDRH
"RTN","RMPRPRT1",86,0)
 S (DATE,TYPE,QTY,VEN,TRANS,TRANS1,STA,SN,DEL,CST,FRM,REM)=""
"RTN","RMPRPRT1",87,0)
 Q
"VER")
8.0^22.0
"BLD",6614,6)
^119
**END**
**END**
