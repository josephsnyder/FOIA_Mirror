Released RMPR*3*145 SEQ #125
Extracted from mail message
**KIDS**:RMPR*3.0*145^

**INSTALL NAME**
RMPR*3.0*145
"BLD",6928,0)
RMPR*3.0*145^PROSTHETICS^0^3080918^y
"BLD",6928,1,0)
^^7^7^3080402^
"BLD",6928,1,1,0)
1. Duplicate encounters when editing
"BLD",6928,1,2,0)
 
"BLD",6928,1,3,0)
2. EDIT INVENTORY ITEM - not allow edit of VENDOR
"BLD",6928,1,4,0)
 
"BLD",6928,1,5,0)
3. Discontinue Prosthetic PCE's
"BLD",6928,1,6,0)
 
"BLD",6928,1,7,0)
4. Eliminate rejected Prosthetic PCE's
"BLD",6928,4,0)
^9.64PA^^
"BLD",6928,6.3)
6
"BLD",6928,"ABPKG")
n
"BLD",6928,"INIT")
FIXPCE^RMPR145P
"BLD",6928,"KRN",0)
^9.67PA^8989.52^19
"BLD",6928,"KRN",.4,0)
.4
"BLD",6928,"KRN",.401,0)
.401
"BLD",6928,"KRN",.402,0)
.402
"BLD",6928,"KRN",.403,0)
.403
"BLD",6928,"KRN",.5,0)
.5
"BLD",6928,"KRN",.84,0)
.84
"BLD",6928,"KRN",3.6,0)
3.6
"BLD",6928,"KRN",3.8,0)
3.8
"BLD",6928,"KRN",9.2,0)
9.2
"BLD",6928,"KRN",9.8,0)
9.8
"BLD",6928,"KRN",9.8,"NM",0)
^9.68A^6^6
"BLD",6928,"KRN",9.8,"NM",1,0)
RMPRE29^^0^B41735714
"BLD",6928,"KRN",9.8,"NM",2,0)
RMPRPIY6^^0^B78861327
"BLD",6928,"KRN",9.8,"NM",3,0)
RMPRPCEA^^0^B54655199
"BLD",6928,"KRN",9.8,"NM",4,0)
RMPRPCEB^^0^B22940686
"BLD",6928,"KRN",9.8,"NM",5,0)
RMPRPCED^^0^B22387004
"BLD",6928,"KRN",9.8,"NM",6,0)
RMPR145P^^0^B7974832
"BLD",6928,"KRN",9.8,"NM","B","RMPR145P",6)

"BLD",6928,"KRN",9.8,"NM","B","RMPRE29",1)

"BLD",6928,"KRN",9.8,"NM","B","RMPRPCEA",3)

"BLD",6928,"KRN",9.8,"NM","B","RMPRPCEB",4)

"BLD",6928,"KRN",9.8,"NM","B","RMPRPCED",5)

"BLD",6928,"KRN",9.8,"NM","B","RMPRPIY6",2)

"BLD",6928,"KRN",19,0)
19
"BLD",6928,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",6928,"KRN",19,"NM",1,0)
RMPR PCE BACKGROUND TASK^^0
"BLD",6928,"KRN",19,"NM","B","RMPR PCE BACKGROUND TASK",1)

"BLD",6928,"KRN",19.1,0)
19.1
"BLD",6928,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",6928,"KRN",101,0)
101
"BLD",6928,"KRN",409.61,0)
409.61
"BLD",6928,"KRN",771,0)
771
"BLD",6928,"KRN",870,0)
870
"BLD",6928,"KRN",8989.51,0)
8989.51
"BLD",6928,"KRN",8989.52,0)
8989.52
"BLD",6928,"KRN",8994,0)
8994
"BLD",6928,"KRN","B",.4,.4)

"BLD",6928,"KRN","B",.401,.401)

"BLD",6928,"KRN","B",.402,.402)

"BLD",6928,"KRN","B",.403,.403)

"BLD",6928,"KRN","B",.5,.5)

"BLD",6928,"KRN","B",.84,.84)

"BLD",6928,"KRN","B",3.6,3.6)

"BLD",6928,"KRN","B",3.8,3.8)

"BLD",6928,"KRN","B",9.2,9.2)

"BLD",6928,"KRN","B",9.8,9.8)

"BLD",6928,"KRN","B",19,19)

"BLD",6928,"KRN","B",19.1,19.1)

"BLD",6928,"KRN","B",101,101)

"BLD",6928,"KRN","B",409.61,409.61)

"BLD",6928,"KRN","B",771,771)

"BLD",6928,"KRN","B",870,870)

"BLD",6928,"KRN","B",8989.51,8989.51)

"BLD",6928,"KRN","B",8989.52,8989.52)

"BLD",6928,"KRN","B",8994,8994)

"BLD",6928,"QUES",0)
^9.62^^
"BLD",6928,"REQB",0)
^9.611^3^3
"BLD",6928,"REQB",1,0)
RMPR*3.0*61^2
"BLD",6928,"REQB",2,0)
RMPR*3.0*142^2
"BLD",6928,"REQB",3,0)
RMPR*3.0*141^2
"BLD",6928,"REQB","B","RMPR*3.0*141",3)

"BLD",6928,"REQB","B","RMPR*3.0*142",2)

"BLD",6928,"REQB","B","RMPR*3.0*61",1)

"INIT")
FIXPCE^RMPR145P
"KRN",19,11313,-1)
0^1
"KRN",19,11313,0)
RMPR PCE BACKGROUND TASK^PROSTHETICS PCE BACKGROUND TASK^** NO LONGER USED**^R^^^^^^^^PROSTHETICS
"KRN",19,11313,1,0)
^19.06^5^5^3080311^^
"KRN",19,11313,1,1,0)
This is a nightly job that process the patient encounter to PCE module.
"KRN",19,11313,1,2,0)
This option should be tasked to run at night when prosthetics' users are
"KRN",19,11313,1,3,0)
off or prosthetics' activities are minimal.  A mail message will be
"KRN",19,11313,1,4,0)
forwarded to the RMPR INVENTORY mail group when the task job processed
"KRN",19,11313,1,5,0)
to completion.
"KRN",19,11313,25)
OPTION^RMPRPCEB
"KRN",19,11313,"U")
PROSTHETICS PCE BACKGROUND TAS
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",101,-1)
1^1
"PKG",101,0)
PROSTHETICS^RMPR^PROSTHETICS VERSION 3.0 ALPHA
"PKG",101,20,0)
^9.402P^^0
"PKG",101,22,0)
^9.49I^1^1
"PKG",101,22,1,0)
3.0^2960209^2960214
"PKG",101,22,1,"PAH",1,0)
145^3080918
"PKG",101,22,1,"PAH",1,1,0)
^^7^7^3080918
"PKG",101,22,1,"PAH",1,1,1,0)
1. Duplicate encounters when editing
"PKG",101,22,1,"PAH",1,1,2,0)
 
"PKG",101,22,1,"PAH",1,1,3,0)
2. EDIT INVENTORY ITEM - not allow edit of VENDOR
"PKG",101,22,1,"PAH",1,1,4,0)
 
"PKG",101,22,1,"PAH",1,1,5,0)
3. Discontinue Prosthetic PCE's
"PKG",101,22,1,"PAH",1,1,6,0)
 
"PKG",101,22,1,"PAH",1,1,7,0)
4. Eliminate rejected Prosthetic PCE's
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","RMPR145P")
0^6^B7974832^n/a
"RTN","RMPR145P",1,0)
RMPR145P ;VM/RB - FIX PROBLEM PCE ENCOUNTERS FROM FILE #660 ITEMS ;03/27/08
"RTN","RMPR145P",2,0)
 ;;3.0;Prosthetics;**145**;13/27/08;Build 6
"RTN","RMPR145P",3,0)
 ;;
"RTN","RMPR145P",4,0)
 Q
"RTN","RMPR145P",5,0)
FIXPCE ;1. Post install to correct 'action required' PCE Encounters created
"RTN","RMPR145P",6,0)
 ;   from Prosthetic items via nightly PCE interface and edit/delete
"RTN","RMPR145P",7,0)
 ;   issues/orders. 
"RTN","RMPR145P",8,0)
 ;
"RTN","RMPR145P",9,0)
BUILD K ^XTMP("RMPR145P") D NOW^%DTC S RMSTART=%
"RTN","RMPR145P",10,0)
 S ^XTMP("RMPR145P","START COMPILE")=RMSTART
"RTN","RMPR145P",11,0)
 S ^XTMP("RMPR145P","END COMPILE")="RUNNING"
"RTN","RMPR145P",12,0)
 S ^XTMP("RMPR145P",0)=$$FMADD^XLFDT(RMSTART,90)_"^"_RMSTART
"RTN","RMPR145P",13,0)
0 ;FIND 660 RECORDS WITH PCE LINKS
"RTN","RMPR145P",14,0)
 S IEN=0,U="^",XX=0,TOT=0
"RTN","RMPR145P",15,0)
1 S IEN=$O(^RMPR(660,IEN)) G EXIT:IEN=""!(IEN]"@")
"RTN","RMPR145P",16,0)
 S R=$G(^RMPR(660,IEN,0)),DFN=$P(R,U,2),R10=$G(^RMPR(660,IEN,10))
"RTN","RMPR145P",17,0)
 ;I $E($P(R,U),1,3)<306 G 1
"RTN","RMPR145P",18,0)
 G:DFN="" 1 S PNAME=$P(^DPT(DFN,0),U,1)
"RTN","RMPR145P",19,0)
 I R=""!(R10="") G 1
"RTN","RMPR145P",20,0)
 S VISIEN=$P(R10,U,12) I VISIEN="" G 1
"RTN","RMPR145P",21,0)
 S RV=$G(^AUPNVSIT(VISIEN,0)) I RV="" G 1
"RTN","RMPR145P",22,0)
 S RV8=$G(^AUPNVSIT(VISIEN,800))
"RTN","RMPR145P",23,0)
2 ;check for required contaminants in associated encounter
"RTN","RMPR145P",24,0)
 S PCEIEN=$O(^SCE("AVSIT",VISIEN,0)) I PCEIEN="" G 1
"RTN","RMPR145P",25,0)
 S PCE0=$G(^SCE(PCEIEN,0)) I PCE0="" G 1
"RTN","RMPR145P",26,0)
 I $P(PCE0,U,12)'=14 G 1
"RTN","RMPR145P",27,0)
EVAL ;beginning of evaluation criteria for 'action required'
"RTN","RMPR145P",28,0)
 S SDOE=PCEIEN
"RTN","RMPR145P",29,0)
 S SDOE0=$$GETOE^SDOE(SDOE),SDIV=$P(SDOE0,U,11)
"RTN","RMPR145P",30,0)
 D DEM^VADPT M SDDPT=VADM
"RTN","RMPR145P",31,0)
 K SDX D CLASK^SDCO2(PCEIEN,.SDX)
"RTN","RMPR145P",32,0)
 I '$D(SDX) G 1
"RTN","RMPR145P",33,0)
 S SDI=0,ERR=0,SDXX="" F  S SDI=$O(SDX(SDI)) Q:'SDI  I $P(SDX(SDI),U,2)="" S SDX="" D  I SDX'="" S ERR=1,^XTMP("RMPR145P",660,IEN,99,SDI)=SDX(SDI)_U_SDX,SDXX=SDXX_U_SDI
"RTN","RMPR145P",34,0)
 . I '$D(^SD(409.41,SDI,0)) S SDX="Classification required"  S:'$D(TOT(SDI)) TOT(SDI)=0 S TOT(SDI)=TOT(SDI)+1 Q  ;W !,SDX Q
"RTN","RMPR145P",35,0)
 . S SDX=$P($G(^SD(409.41,SDI,0)),U,1)_" classification required" S:'$D(TOT(SDI)) TOT(SDI)=0 S TOT(SDI)=TOT(SDI)+1 ;W !,SDX
"RTN","RMPR145P",36,0)
 I ERR=1 S TOT=TOT+1 D
"RTN","RMPR145P",37,0)
 . S ^XTMP("RMPR145P",660,IEN,10)=R
"RTN","RMPR145P",38,0)
 . S ^XTMP("RMPR145P",660,IEN,10)=R10
"RTN","RMPR145P",39,0)
 . S ^XTMP("RMPR145P",660,IEN,11)=RV
"RTN","RMPR145P",40,0)
 . S ^XTMP("RMPR145P",660,IEN,12)=RV8
"RTN","RMPR145P",41,0)
 . S ^XTMP("RMPR145P",660,IEN,13)=PCE0
"RTN","RMPR145P",42,0)
 . ;W !!,IEN,?15,PNAME,!,R,!,R10,!,VISIEN,!,RV,!,RV8,!,PCEIEN,!,PCE0,!,SDXX
"RTN","RMPR145P",43,0)
 . F I=1:1:7 I $P(RV8,U,I)="" S XX=80000+I,DA=VISIEN,DR=XX_"////^S X=0",DIE="^AUPNVSIT(" D ^DIE
"RTN","RMPR145P",44,0)
 . S DA=PCEIEN,DR=".12////^S X=2",DIE="^SCE(" D ^DIE
"RTN","RMPR145P",45,0)
 G 1
"RTN","RMPR145P",46,0)
EXIT ;
"RTN","RMPR145P",47,0)
 ;S II=0 W !
"RTN","RMPR145P",48,0)
 ;F  S II=$O(TOT(II)) Q:II=""  D
"RTN","RMPR145P",49,0)
 ;. S ENM=$P($G(^SD(409.41,II,0)),U)
"RTN","RMPR145P",50,0)
 ;. W !,ENM," classification required",?50,TOT(II)
"RTN","RMPR145P",51,0)
 ;W !!,"TOTAL 'ACTION REQUIRED' ENCOUNTERS CORRECTED:  ",TOT
"RTN","RMPR145P",52,0)
 D NOW^%DTC S RMEND=%
"RTN","RMPR145P",53,0)
 M ^XTMP("RMPR145P","ERRS")=TOT
"RTN","RMPR145P",54,0)
 S ^XTMP("RMPR145P","END COMPILE")=RMEND
"RTN","RMPR145P",55,0)
 K RMEND,RMSTART,IEN,XX,TOT,R,R10,DFN,PCEIEN,VISIEN,PNAME,RV,RV8,PCE0,SDOE,SDOE0,SDIV,VADM,SDDPT,SDX,SDI
"RTN","RMPR145P",56,0)
 K ERR,SDXX,TOT,I,DA,DR,DIE,II,ENM
"RTN","RMPR145P",57,0)
 Q
"RTN","RMPRE29")
0^1^B41735714^B43174042
"RTN","RMPRE29",1,0)
RMPRE29 ;PHX/JLT,RVD-EDIT 2319 ;10/2/03  13:04
"RTN","RMPRE29",2,0)
 ;;3.0;PROSTHETICS;**36,41,51,57,62,74,81,61,145**;Feb 09, 1996;Build 6
"RTN","RMPRE29",3,0)
 ;
"RTN","RMPRE29",4,0)
 ;RVD patch #62 - call PCE API to update patient care encounter.
"RTN","RMPRE29",5,0)
 ;              - add a screen display if no changes to the HCPCS.
"RTN","RMPRE29",6,0)
 ;RVD patch #74 - call $$STATCHK^ICPTAPIU to check if CPT Code is 
"RTN","RMPRE29",7,0)
 ;                active for a given date.
"RTN","RMPRE29",8,0)
 ;RVD patch #81 - roll back patch RMPR*3.0*74 and returns the screen
"RTN","RMPRE29",9,0)
 ;                to the STATUS field of file #661.1.
"RTN","RMPRE29",10,0)
 ;RVD patch #61 - added screen not to process stock issue entries.
"RTN","RMPRE29",11,0)
 ;uses DBIA # 1995 & 1997.
"RTN","RMPRE29",12,0)
 W ! S DIC="^RMPR(660,",DIC(0)="AEMQZ",DIC("A")="Select PATIENT: "
"RTN","RMPRE29",13,0)
 S DIC("W")="D EN^RMPRD1",RMEND=0
"RTN","RMPRE29",14,0)
 S DIC("S")="I ($P(^(0),U,6)!($P(^(0),U,26)'="""")),($P(^(0),U,13)'=11)" W !
"RTN","RMPRE29",15,0)
 D ^DIC G:+Y'>0 EXIT L +^RMPR(660,+Y,0):1 I $T=0 W !,?5,$C(7),"Someone else is Editing this entry!" G EXIT
"RTN","RMPRE29",16,0)
 ;S (RMPRDA,DA)=+Y,DIE=DIC,DR="[RMPRE2319]" D ^DIE L -^RMPR(660,DA,0)
"RTN","RMPRE29",17,0)
 S DIE=DIC,(RMPRDA,DA)=+Y
"RTN","RMPRE29",18,0)
TYP1 ;edit type of transaction....
"RTN","RMPRE29",19,0)
 S R1(0)=$G(^RMPR(660,RMPRDA,0)),R1(1)=$G(^(1)),R1("AM")=$G(^("AM"))
"RTN","RMPRE29",20,0)
 S RMTOTCOS=$P(R1(0),U,16)
"RTN","RMPRE29",21,0)
 S (RMHCPC,RMHCOLD)=$P(R1(1),U,4),(RMTYPE,RMTYPS)=$P(R1(0),U,4),(RMCAT,RMCATS)=$P(R1("AM"),U,3),(RMSPE,RMSPES)=$P(R1("AM"),U,4),RMSOUR=$P(R1(1),U,14)
"RTN","RMPRE29",22,0)
TRAN K DIR S DIR(0)="660,2"
"RTN","RMPRE29",23,0)
 ;S DIR("A")="Enter Type of Transaction: "
"RTN","RMPRE29",24,0)
 S:$D(RMTYPS) DIR("B")=$S(RMTYPS="I":"INITIAL",RMTYPS="X":"REPAIR",RMTYPS="R":"REPLACE",RMTYPS="S":"SPARE",1:"")
"RTN","RMPRE29",25,0)
 D ^DIR
"RTN","RMPRE29",26,0)
 I $D(DUOUT)!$D(DTOUT) S RMEND=1 D SETED2 G QED2
"RTN","RMPRE29",27,0)
 I Y="" W !,"Please enter type of Transaction!!" G TRAN
"RTN","RMPRE29",28,0)
 S $P(R1(0),U,4)=Y,RMTYPE=Y
"RTN","RMPRE29",29,0)
 S RMTYPS=$S(Y="I":"INITIAL",Y="X":"REPAIR",Y="R":"REPLACE",Y="S":"SPARE",1:"")
"RTN","RMPRE29",30,0)
PCAT K DIR S DIR(0)="660,62"
"RTN","RMPRE29",31,0)
 S:$D(RMCATS) DIR("B")=$S(RMCATS=1:"SC/OP",RMCATS=2:"SC/IP",RMCATS=3:"NSC/IP",RMCATS=4:"NSC/OP",1:"")
"RTN","RMPRE29",32,0)
 D ^DIR
"RTN","RMPRE29",33,0)
 I $D(DUOUT)!$D(DTOUT) S RMEND=1 D SETED2 G QED2
"RTN","RMPRE29",34,0)
 I Y="" W !,"Please enter Patient Category!!" G PCAT
"RTN","RMPRE29",35,0)
 S RMCAT=Y
"RTN","RMPRE29",36,0)
 S $P(R1("AM"),U,3)=Y,RMCATS=$S(Y=1:"SC/OP",Y=2:"SC/IP",Y=3:"NSC/IP",Y=4:"NSC/OP",1:"")
"RTN","RMPRE29",37,0)
 K DIR I RMCAT<4 S $P(R1("AM"),U,4)="" G HCPC
"RTN","RMPRE29",38,0)
 S DIR(0)="660,63"
"RTN","RMPRE29",39,0)
 S:$D(RMSPES) DIR("B")=$S(RMSPES=1:"SPECIAL LEGISLATION",RMSPES=2:"A&A",RMSPES=3:"PHC",RMSPES=4:"ELIGIBILITY REFORM",1:"")
"RTN","RMPRE29",40,0)
 I RMCAT=4 D ^DIR I $D(DUOUT)!$D(DTOUT) S RMEND=1 D SETED2 G QED2
"RTN","RMPRE29",41,0)
 I RMCAT=4 S $P(R1("AM"),U,4)=Y,RMSPE=Y,RMSPES=$S(Y=1:"SPECIAL LEGISLATION",Y=2:"A&A",Y=3:"PHC",Y=4:"ELIGIBILITY REFORM",1:"")
"RTN","RMPRE29",42,0)
 K DIR
"RTN","RMPRE29",43,0)
 ;
"RTN","RMPRE29",44,0)
HCPC ;set type and ask item and HCPCS
"RTN","RMPRE29",45,0)
 D SETED2
"RTN","RMPRE29",46,0)
 ;ask source
"RTN","RMPRE29",47,0)
 N SRC
"RTN","RMPRE29",48,0)
 S SRC=$P(R1(0),U,14)
"RTN","RMPRE29",49,0)
 S DIE("NO^")="BACK"
"RTN","RMPRE29",50,0)
 S DR="12;4;4.5" D ^DIE
"RTN","RMPRE29",51,0)
 K DIE("NO^")
"RTN","RMPRE29",52,0)
 I $D(DUOUT)!$D(DTOUT)!$D(Y) S RMEND=1 G QED2
"RTN","RMPRE29",53,0)
 S R1(0)=$G(^RMPR(660,RMPRDA,0)),R1(1)=$G(^(1))
"RTN","RMPRE29",54,0)
 I $P(R1(0),U,14)'=SRC S RMHCOLD=""
"RTN","RMPRE29",55,0)
 S RMHCPC=$P(R1(1),U,4)
"RTN","RMPRE29",56,0)
 W !,"OLD CPT MODIFER: ",$P(R1(1),U,6)
"RTN","RMPRE29",57,0)
 ;if HCPCS was changed, Modifier must be changed
"RTN","RMPRE29",58,0)
 I RMHCOLD'=RMHCPC D
"RTN","RMPRE29",59,0)
 .S RDA=RMHCPC_"^"_$P(R1(0),U,4)_"^"_$P(R1(0),U,14)_"^"_660
"RTN","RMPRE29",60,0)
 .D CPT^RMPRCPTU(RDA) S $P(^RMPR(660,RMPRDA,1),U,6)=RMCPT
"RTN","RMPRE29",61,0)
 .W !,"NEW CPT MODIFIER: ",RMCPT
"RTN","RMPRE29",62,0)
 ;if HCPCS the same, ask user if want to edit modifier.
"RTN","RMPRE29",63,0)
 E  D
"RTN","RMPRE29",64,0)
 .S DIR(0)="Y",DIR("B")="N",DIR("A")="Would you like to edit the CPT Modifier "
"RTN","RMPRE29",65,0)
 .D ^DIR Q:$D(DUOUT)!$D(DTOUT)
"RTN","RMPRE29",66,0)
 .I (Y>0) D
"RTN","RMPRE29",67,0)
 ..S RDA=RMHCPC_"^"_$P(R1(0),U,4)_"^"_$P(R1(0),U,14)_"^"_660
"RTN","RMPRE29",68,0)
 ..D CPT^RMPRCPTU(RDA) S $P(^RMPR(660,RMPRDA,1),U,6)=RMCPT
"RTN","RMPRE29",69,0)
 ..K DIR
"RTN","RMPRE29",70,0)
 ..W:RMCPT=$P(R1(1),U,6) !!,"***Based on the information given above, CPT modifier string has not changed!!!",!
"RTN","RMPRE29",71,0)
 ..W:RMCPT'=$P(R1(1),U,6) !,"NEW CPT MODIFIER: ",RMCPT
"RTN","RMPRE29",72,0)
 S DR="7;5;14;9;21;16;28" D ^DIE
"RTN","RMPRE29",73,0)
 I RMTOTCOS'=$P(^RMPR(660,DA,0),U,16) S DR="35////^S X=DUZ;36////^S X=DT" D ^DIE
"RTN","RMPRE29",74,0)
 I $D(DTOUT)!('$G(Y))!($D(DUOUT)) D CHK
"RTN","RMPRE29",75,0)
QED2 ;
"RTN","RMPRE29",76,0)
 Q:$D(RMPREDT)
"RTN","RMPRE29",77,0)
 ;modified by #62
"RTN","RMPRE29",78,0)
 ;call PCE API to update patient care encounter.
"RTN","RMPRE29",79,0)
 ;PCE UPDATE REMOVED *145
"RTN","RMPRE29",80,0)
 ;I $D(^RMPR(660,RMPRDA,10)),$P(^RMPR(660,RMPRDA,10),U,12) D
"RTN","RMPRE29",81,0)
 ;.S RMCHK=$$SENDPCE^RMPRPCEA(RMPRDA)
"RTN","RMPRE29",82,0)
 ;.I RMCHK<1 H 3
"RTN","RMPRE29",83,0)
 L -^RMPR(660,RMPRDA,0)
"RTN","RMPRE29",84,0)
 K DIR W ! S DIR(0)="Y",DIR("A")="Would You like to Edit another Entry (Y/N) " D ^DIR
"RTN","RMPRE29",85,0)
 G:'$D(DTOUT)&(Y>0) RMPRE29
"RTN","RMPRE29",86,0)
EXIT ;
"RTN","RMPRE29",87,0)
 N RMPR,RMPRSITE D KILL^XUSCLEAN
"RTN","RMPRE29",88,0)
 K DIC,DIE,DIR,%,X,Y
"RTN","RMPRE29",89,0)
 Q
"RTN","RMPRE29",90,0)
SETED2 ;set 660
"RTN","RMPRE29",91,0)
 S ^RMPR(660,DA,0)=R1(0),^RMPR(660,DA,1)=R1(1),^RMPR(660,DA,"AM")=R1("AM")
"RTN","RMPRE29",92,0)
 S DIK="^RMPR(660,",DA=RMPRDA D IX1^DIK K DIC
"RTN","RMPRE29",93,0)
 D CHK
"RTN","RMPRE29",94,0)
 Q
"RTN","RMPRE29",95,0)
 ;
"RTN","RMPRE29",96,0)
QUICK ;quick edit for HCPCS and type
"RTN","RMPRE29",97,0)
 K RMCPT
"RTN","RMPRE29",98,0)
 W ! S DIC="^RMPR(660,",DIC(0)="AEMNQZ",DIC("A")="Select NUMBER, or Patient: "
"RTN","RMPRE29",99,0)
 S DIC("W")="D EN^RMPRD1"
"RTN","RMPRE29",100,0)
 S DIC("S")="I $P(^(0),U,6)!($P(^(0),U,26)'="""")" W !
"RTN","RMPRE29",101,0)
 D ^DIC G:+Y'>0 EXIT L +^RMPR(660,+Y,0):1 I $T=0 W !,?5,$C(7),"Someone else is Editing this entry!" G EXIT
"RTN","RMPRE29",102,0)
 ;add source
"RTN","RMPRE29",103,0)
 S (RMPRDA,DA)=+Y,DIE=DIC,DR="2;4.5"
"RTN","RMPRE29",104,0)
 S R1(0)=$G(^RMPR(660,DA,0)),R1(1)=$G(^RMPR(660,DA,1))
"RTN","RMPRE29",105,0)
 S RMTYPE=$P(R1(0),U,4),RMSOUR=$P(R1(0),U,14)
"RTN","RMPRE29",106,0)
 S RMHCOLD=$P(R1(1),U,4)
"RTN","RMPRE29",107,0)
 D ^DIE G:$D(DUOUT)!$D(DTOUT)!$D(DIROUT)!$D(Y) SET
"RTN","RMPRE29",108,0)
 S RMHCNEW=$P($G(^RMPR(660,DA,1)),U,4)
"RTN","RMPRE29",109,0)
 S RMTYPE=$P($G(^RMPR(660,DA,0)),U,4)
"RTN","RMPRE29",110,0)
 S RDA=RMHCNEW_"^"_RMTYPE_"^"_RMSOUR_"^"_660
"RTN","RMPRE29",111,0)
 W !,"OLD CPT MODIFER: ",$P(R1(1),U,6)
"RTN","RMPRE29",112,0)
 I RMHCOLD'=RMHCNEW D
"RTN","RMPRE29",113,0)
 .D CPT^RMPRCPTU(RDA)
"RTN","RMPRE29",114,0)
 .W !,"NEW CPT MODIFIER: ",RMCPT
"RTN","RMPRE29",115,0)
 .S $P(^RMPR(660,DA,1),U,6)=RMCPT
"RTN","RMPRE29",116,0)
 I RMHCOLD=RMHCNEW D
"RTN","RMPRE29",117,0)
 .W ! S DIR("B")="N",DIR(0)="Y",DIR("A")="Would You like to Edit CPT MODIFIER " D ^DIR
"RTN","RMPRE29",118,0)
 .I $D(DTOUT)!('$G(Y)) K DIR Q
"RTN","RMPRE29",119,0)
 .D CPT^RMPRCPTU(RDA)
"RTN","RMPRE29",120,0)
 .W:RMCPT=$P(R1(1),U,6) !!,"***Based on the information given above, CPT modifier string has not changed!!!",!
"RTN","RMPRE29",121,0)
 .W:RMCPT'=$P(R1(1),U,6) !,"NEW CPT MODIFIER: ",RMCPT
"RTN","RMPRE29",122,0)
 .S $P(^RMPR(660,DA,1),U,6)=RMCPT
"RTN","RMPRE29",123,0)
SET K DIR D CHK
"RTN","RMPRE29",124,0)
 ;modified by #62
"RTN","RMPRE29",125,0)
 ;call PCE API to update patient care encounter
"RTN","RMPRE29",126,0)
 ;PCE UPDATE REMOVED *144
"RTN","RMPRE29",127,0)
 ;I $D(^RMPR(660,RMPRDA,10)),$P(^RMPR(660,RMPRDA,10),U,12) D
"RTN","RMPRE29",128,0)
 ;.S RMCHK=$$SENDPCE^RMPRPCEA(RMPRDA)
"RTN","RMPRE29",129,0)
 ;.I RMCHK<1 H 3
"RTN","RMPRE29",130,0)
 W ! S DIR(0)="Y",DIR("A")="Would You like to Edit another Entry (Y/N)" D ^DIR
"RTN","RMPRE29",131,0)
 G:'$D(DTOUT)&(Y>0) QUICK^RMPRE29
"RTN","RMPRE29",132,0)
 L -^RMPR(660,RMPRDA,0)
"RTN","RMPRE29",133,0)
 D KILL^XUSCLEAN Q
"RTN","RMPRE29",134,0)
 ;
"RTN","RMPRE29",135,0)
CHK ;check for transaction changes
"RTN","RMPRE29",136,0)
 S RMTYPE=$P($G(^RMPR(660,RMPRDA,0)),U,4)
"RTN","RMPRE29",137,0)
 S RMHCPC=$P($G(^RMPR(660,RMPRDA,1)),U,4) Q:'$G(RMHCPC)
"RTN","RMPRE29",138,0)
 S RMCPT1=$P($G(^RMPR(661.1,RMHCPC,4)),U,1)
"RTN","RMPRE29",139,0)
 S RMCPT=$P($G(^RMPR(660,RMPRDA,1)),U,6)
"RTN","RMPRE29",140,0)
 I ((RMTYPE="R")!(RMTYPE="X")),(RMCPT'["RP"),($G(^RMPR(661.1,RMHCPC,4))["RP") D ADDRP
"RTN","RMPRE29",141,0)
 I ((RMTYPE="I")!(RMTYPE="S")),(RMCPT["RP") D DELRP
"RTN","RMPRE29",142,0)
 I (RMSOUR="C"),(RMCPT["RR") D DELNU
"RTN","RMPRE29",143,0)
 I (RMSOUR="C"),(RMCPT'["RR"),(RMCPT1["NU"),(RMCPT'["N") D ADDNU
"RTN","RMPRE29",144,0)
 K RMHCPC,RMCI,RMC,RMCLEN,RMLPIECE,RMF,RMFPIECE,RMTYPE,RMPRA,R4DA Q
"RTN","RMPRE29",145,0)
 ;return to EDIT option
"RTN","RMPRE29",146,0)
DELRP ;logic for deleting 'RP' modifier with transaction change.
"RTN","RMPRE29",147,0)
 F RMCI=1:1:8 S RMC=$P(RMCPT,",",RMCI) I RMC="RP" S $P(RMCPT,",",RMCI)="" D
"RTN","RMPRE29",148,0)
 .S RMF=$F(RMCPT,",,"),RMFPIECE=$E(RMCPT,1,RMF-2)
"RTN","RMPRE29",149,0)
 .S RMLPIECE=$E(RMCPT,RMF,32),RMCPT=RMFPIECE_RMLPIECE,RMCLEN=$L(RMCPT)
"RTN","RMPRE29",150,0)
 .I $E(RMCPT,1)="," S RMCPT=$E(RMCPT,2,RMCLEN)
"RTN","RMPRE29",151,0)
 .I $E(RMCPT,RMCLEN)="," S RMCPT=$E(RMCPT,1,RMCLEN-1)
"RTN","RMPRE29",152,0)
 .S $P(^RMPR(660,RMPRDA,1),U,6)=RMCPT
"RTN","RMPRE29",153,0)
 Q
"RTN","RMPRE29",154,0)
DELNU ;logic for deleting 'NU' modifier.
"RTN","RMPRE29",155,0)
 F RMCI=1:1:8 S RMC=$P(RMCPT,",",RMCI) I RMC="NU" S $P(RMCPT,",",RMCI)="" D
"RTN","RMPRE29",156,0)
 .S RMF=$F(RMCPT,",,"),RMFPIECE=$E(RMCPT,1,RMF-2)
"RTN","RMPRE29",157,0)
 .S RMLPIECE=$E(RMCPT,RMF,32),RMCPT=RMFPIECE_RMLPIECE,RMCLEN=$L(RMCPT)
"RTN","RMPRE29",158,0)
 .I $E(RMCPT,1)="," S RMCPT=$E(RMCPT,2,RMCLEN)
"RTN","RMPRE29",159,0)
 .I $E(RMCPT,RMCLEN)="," S RMCPT=$E(RMCPT,1,RMCLEN-1)
"RTN","RMPRE29",160,0)
 .S $P(^RMPR(660,RMPRDA,1),U,6)=RMCPT
"RTN","RMPRE29",161,0)
 Q
"RTN","RMPRE29",162,0)
 ;
"RTN","RMPRE29",163,0)
ADDRP ;logic for adding 'RP' modifier with transaction change.
"RTN","RMPRE29",164,0)
 S RMCPT=RMCPT_",RP" S $P(^RMPR(660,RMPRDA,1),U,6)=RMCPT
"RTN","RMPRE29",165,0)
 Q
"RTN","RMPRE29",166,0)
ADDNU ;logic for adding 'NU' modifier.
"RTN","RMPRE29",167,0)
 S RMCPT=RMCPT_",NU" S $P(^RMPR(660,RMPRDA,1),U,6)=RMCPT
"RTN","RMPRE29",168,0)
 Q
"RTN","RMPRE29",169,0)
 ;END
"RTN","RMPRPCEA")
0^3^B54655199^B53901671
"RTN","RMPRPCEA",1,0)
RMPRPCEA ;HCIOFO/RVD - Prosthetics/PCE Interface; 05/31/01
"RTN","RMPRPCEA",2,0)
 ;;3.0;PROSTHETICS;**62,82,78,114,120,128,131,133,145**;Feb 09, 1996;Build 6
"RTN","RMPRPCEA",3,0)
 ;
"RTN","RMPRPCEA",4,0)
 ; RMS  10/1/03 Patch 78 - Change Service connected, and environmental
"RTN","RMPRPCEA",5,0)
 ;                         indicators (Agent Orange, Ionizing Radiation,
"RTN","RMPRPCEA",6,0)
 ;                         Environmental Contaminants, Military Sexual
"RTN","RMPRPCEA",7,0)
 ;                         Trauma, Head/Neck Cancer, and Combat Veteran
"RTN","RMPRPCEA",8,0)
 ;                         Status) to come from new BA fields if they
"RTN","RMPRPCEA",9,0)
 ;                         exist.
"RTN","RMPRPCEA",10,0)
 ;
"RTN","RMPRPCEA",11,0)
 ;This routine contains the code for sending a Prosthetic visit to PCE.
"RTN","RMPRPCEA",12,0)
 ;
"RTN","RMPRPCEA",13,0)
 ;DBIA #1889-A  - this API is used to add, edit and delete the
"RTN","RMPRPCEA",14,0)
 ;                of encounter, provider, diagnosis and procedure
"RTN","RMPRPCEA",15,0)
 ;                data to VISIT and V files in the PCE module.
"RTN","RMPRPCEA",16,0)
 ; 04/23/2004 KAM RMPR*3*82 Make Background Message more Robust
"RTN","RMPRPCEA",17,0)
 ;
"RTN","RMPRPCEA",18,0)
 ;RMIE60 - ien in file #660
"RTN","RMPRPCEA",19,0)
SENDPCE(RMIE60) ; send a Prosthetic Visit to PCE.
"RTN","RMPRPCEA",20,0)
 ; D NEWVAR subroutine removed for functionality  01/31/05  WLC
"RTN","RMPRPCEA",21,0)
 ;
"RTN","RMPRPCEA",22,0)
 ;QUIT entered below to stop PCE processing for items
"RTN","RMPRPCEA",23,0)
 Q 1
"RTN","RMPRPCEA",24,0)
 N RMPCE,RME2,RMSENT,RMLOCK,RMERR,RMPKG,RMSRC,RMDIAG,RMQTY
"RTN","RMPRPCEA",25,0)
 N RMSCAT,RMPROC,RMUPD,RMIEPCE,RMHLOC,RMLOC,RMPAT,RMDATE,RMINST
"RTN","RMPRPCEA",26,0)
 N RMETYP,RMCDAT,RMPCAT,RMDANOW,DIE,DA,DIC,RMAO,RMEC,RMIR,DFN,RMSCON
"RTN","RMPRPCEA",27,0)
 N RMMST,RMHNC,RMCBV,RMPRTPCE,STOP
"RTN","RMPRPCEA",28,0)
 ; PATCH 78, RMS - 10/1/2003, Billing aware related variables
"RTN","RMPRPCEA",29,0)
 N RMBASCON,RMBAAO,RMBAIR,RMBAEC,RMBAMST,RMBAHNC,RMBACBV,RMBAICD9,RMLOOP
"RTN","RMPRPCEA",30,0)
 N RMPROV,RMCPDT,DXERR,SICD
"RTN","RMPRPCEA",31,0)
 ;
"RTN","RMPRPCEA",32,0)
 S RMERR=1
"RTN","RMPRPCEA",33,0)
 S RMSRC="PROSTHETICS DATA"
"RTN","RMPRPCEA",34,0)
 S RMPKG=$O(^DIC(9.4,"B","PROSTHETICS",0))
"RTN","RMPRPCEA",35,0)
 I '$G(RMPKG) S RMERR=-2 G SENDPCEX
"RTN","RMPRPCEA",36,0)
 S RMSTA=$P(^RMPR(660,RMIE60,0),U,10)
"RTN","RMPRPCEA",37,0)
 S (RMLOC,RERRMSG,RERRMSG2)=""
"RTN","RMPRPCEA",38,0)
 F I=0:0 S I=$O(^RMPR(669.9,"C",RMSTA,I)) Q:I'>0  D
"RTN","RMPRPCEA",39,0)
 .I ($D(^RMPR(669.9,I,0))),($D(^RMPR(669.9,I,"PCE"))) S RMLOC=$P(^RMPR(669.9,I,"PCE"),U,3)
"RTN","RMPRPCEA",40,0)
 ;exit if Hospital Location (clinic) not defined.
"RTN","RMPRPCEA",41,0)
 I '$G(RMLOC) D  G SENDPCEX
"RTN","RMPRPCEA",42,0)
 .S RMERR=-2
"RTN","RMPRPCEA",43,0)
 .;RMPR*3*82 04/23/2004 KAM Added next 8 lines
"RTN","RMPRPCEA",44,0)
 .N SPACES,VNAME,ENDAT
"RTN","RMPRPCEA",45,0)
 .S VNAME=$$GET1^DIQ(2,$P(^RMPR(660,RMIE60,0),U,2),.01)
"RTN","RMPRPCEA",46,0)
 .S ENDAT=$$GET1^DIQ(660,RMIE60,.01),SPACES=""
"RTN","RMPRPCEA",47,0)
 .I $G(ENDAT)="" S ENDAT=" No Entry Data Found"
"RTN","RMPRPCEA",48,0)
 .F I=1:1:42-($L(VNAME)+$L(ENDAT)) S SPACES=$G(SPACES)_" "
"RTN","RMPRPCEA",49,0)
 .S RERRMSG="              *** NAME = "_VNAME_"   ENTRY DATE = "_ENDAT_SPACES
"RTN","RMPRPCEA",50,0)
 .I $G(RMSTA),$D(^DIC(4,RMSTA,99)) S RMSTAW=$P(^DIC(4,RMSTA,99),U)
"RTN","RMPRPCEA",51,0)
 .S RERRMSG=RERRMSG_"              *** Clinic is not defined....Please ask your ADPAC to enter a prosthetics      *** clinic in the Prosthetics Site Parameters file for station # = "_$G(RMSTAW)
"RTN","RMPRPCEA",52,0)
 .S RERRMSG2="         *** Using option 'Enter/Edit Station Site Parameters'"
"RTN","RMPRPCEA",53,0)
 .W !,"*** Clinic is not defined....."
"RTN","RMPRPCEA",54,0)
 .W !,"*** Please ask your ADPAC to enter a prosthetics clinic in the"
"RTN","RMPRPCEA",55,0)
 .W !,"*** Prosthetics Site Parameters file for station # = ",RMSTAW
"RTN","RMPRPCEA",56,0)
 .W !,"*** Using option 'Enter/Edit Station Site Parameters'"
"RTN","RMPRPCEA",57,0)
 S RMSENT=0,RMLOCK=0
"RTN","RMPRPCEA",58,0)
 ; initialize temp file.
"RTN","RMPRPCEA",59,0)
 K ^TMP("RMPRPCE1",$J),RMSTAW
"RTN","RMPRPCEA",60,0)
 ;
"RTN","RMPRPCEA",61,0)
 ; get the visit data (#660) and place in temp file.
"RTN","RMPRPCEA",62,0)
 D GETDATA G:$G(DXERR) SENDPCEX   ;quit if inactive diagnosis RMPR*120
"RTN","RMPRPCEA",63,0)
 ;don't create a PCE encounter if Date of Death is before the transaction
"RTN","RMPRPCEA",64,0)
 I $D(VADM(6)),$P(VADM(6),U,1),$P(VADM(6),U,1)<(RMDATE) G SENDPCEX
"RTN","RMPRPCEA",65,0)
 ;
"RTN","RMPRPCEA",66,0)
 ; build the temp file for sending to PCE
"RTN","RMPRPCEA",67,0)
 D BUILD
"RTN","RMPRPCEA",68,0)
 ;
"RTN","RMPRPCEA",69,0)
 ; now send
"RTN","RMPRPCEA",70,0)
 D SENDIT
"RTN","RMPRPCEA",71,0)
 ;
"RTN","RMPRPCEA",72,0)
SENDPCEX ; exit point
"RTN","RMPRPCEA",73,0)
 ;
"RTN","RMPRPCEA",74,0)
 ; clear the temp file
"RTN","RMPRPCEA",75,0)
 K ^TMP("RMPRPCE1",$J)
"RTN","RMPRPCEA",76,0)
 ;
"RTN","RMPRPCEA",77,0)
 ; return
"RTN","RMPRPCEA",78,0)
 Q RMERR
"RTN","RMPRPCEA",79,0)
 ;
"RTN","RMPRPCEA",80,0)
GETDATA ; get the visit data and place in temp file
"RTN","RMPRPCEA",81,0)
 K RMDA,RMDA2
"RTN","RMPRPCEA",82,0)
 S RMDA=$NA(^TMP("RMPRPCE1",$J,"RM"))
"RTN","RMPRPCEA",83,0)
 D GETS^DIQ(660,RMIE60_",","*","I",RMDA,"")
"RTN","RMPRPCEA",84,0)
 S RMDA2=$NA(^TMP("RMPRPCE1",$J,"RM",660,RMIE60_","))
"RTN","RMPRPCEA",85,0)
 D NOW^%DTC
"RTN","RMPRPCEA",86,0)
 S RMDANOW=%
"RTN","RMPRPCEA",87,0)
 S RMDATE=@RMDA2@(.01,"I"),RMDATE=RMDATE_"."_$P(%,".",2)
"RTN","RMPRPCEA",88,0)
 S (DFN,RMPAT)=@RMDA2@(.02,"I")
"RTN","RMPRPCEA",89,0)
 S RMHLOC=RMLOC
"RTN","RMPRPCEA",90,0)
 S RMINST=@RMDA2@(8.11,"I")
"RTN","RMPRPCEA",91,0)
 S RMPCAT=@RMDA2@(62,"I")
"RTN","RMPRPCEA",92,0)
 S RMSCON=0
"RTN","RMPRPCEA",93,0)
 I (RMPCAT=1)!(RMPCAT=2) S RMSCON=1
"RTN","RMPRPCEA",94,0)
 ;==============================
"RTN","RMPRPCEA",95,0)
 S RMSCAT="A"
"RTN","RMPRPCEA",96,0)
 S RMETYP="P"
"RTN","RMPRPCEA",97,0)
 S RMUSER=@RMDA2@(27,"I")
"RTN","RMPRPCEA",98,0)
 S RMDIAG=@RMDA2@(8.8,"I")
"RTN","RMPRPCEA",99,0)
 S RMPROC=@RMDA2@(4.1,"I")
"RTN","RMPRPCEA",100,0)
 S RMPROV=@RMDA2@(8.6,"I")
"RTN","RMPRPCEA",101,0)
 S RMCPDT=@RMDA2@(8.4,"I")
"RTN","RMPRPCEA",102,0)
 S RMQTY=@RMDA2@(5,"I")
"RTN","RMPRPCEA",103,0)
 S RMCDAT=@RMDA2@(10,"I")
"RTN","RMPRPCEA",104,0)
 S (RMPCE,RMIEPCE)=@RMDA2@(8.12,"I")
"RTN","RMPRPCEA",105,0)
 ; PATCH 78, RMS - 10/1/2003, billing aware related variables
"RTN","RMPRPCEA",106,0)
 K RMBAICD9,RMBAAO,RMBASCON,RMBAAIR,RMBAEC,RMBAMST,RMBAHNC,RMBACBV
"RTN","RMPRPCEA",107,0)
 I '$D(^RMPR(660,RMIE60,"BA1")) G GTDT  ; no BA data, skip retrieval
"RTN","RMPRPCEA",108,0)
 F RMLOOP=30:1:33 D
"RTN","RMPRPCEA",109,0)
 . N RMBAREC S RMBAREC=RMLOOP-29
"RTN","RMPRPCEA",110,0)
 . S RMBAICD9(RMBAREC)=@RMDA2@(RMLOOP,"I"),SICD=RMBAICD9(RMBAREC) I SICD'="" S:$P($G(^ICD9(SICD,0)),U,9) DXERR=1
"RTN","RMPRPCEA",111,0)
 . S RMBAAO(RMBAREC)=@RMDA2@((RMLOOP+.1),"I")
"RTN","RMPRPCEA",112,0)
 . S RMBAIR(RMBAREC)=@RMDA2@((RMLOOP+.2),"I")
"RTN","RMPRPCEA",113,0)
 . S RMBASCON(RMBAREC)=@RMDA2@((RMLOOP+.3),"I")
"RTN","RMPRPCEA",114,0)
 . S RMBAEC(RMBAREC)=@RMDA2@((RMLOOP+.4),"I")
"RTN","RMPRPCEA",115,0)
 . S RMBAMST(RMBAREC)=@RMDA2@((RMLOOP+.5),"I")
"RTN","RMPRPCEA",116,0)
 . S RMBAHNC(RMBAREC)=@RMDA2@((RMLOOP+.6),"I")
"RTN","RMPRPCEA",117,0)
 . S RMBACBV(RMBAREC)=@RMDA2@((RMLOOP+.7),"I")
"RTN","RMPRPCEA",118,0)
 ; Retrieve order number
"RTN","RMPRPCEA",119,0)
GTDT S RMPTR123=@RMDA2@(8.9,"I")
"RTN","RMPRPCEA",120,0)
 S RMODENT=$$GET1^DIQ(123,RMPTR123_",",.03)
"RTN","RMPRPCEA",121,0)
 ;get Date of Death.
"RTN","RMPRPCEA",122,0)
 D DEM^VADPT
"RTN","RMPRPCEA",123,0)
 ;get Agent Orange and Radiation.
"RTN","RMPRPCEA",124,0)
 D SVC^VADPT S RMAO=VASV(2),RMIR=VASV(3)
"RTN","RMPRPCEA",125,0)
 ;get environmental contaminants.
"RTN","RMPRPCEA",126,0)
 S RMEC=$$GET1^DIQ(2,DFN,.322013,"I") I RMEC="Y" S RMEC=1
"RTN","RMPRPCEA",127,0)
 S:RMEC'=1 RMEC=0
"RTN","RMPRPCEA",128,0)
 ;
"RTN","RMPRPCEA",129,0)
 S RMMST="",RMCBV="",RMHNC=""
"RTN","RMPRPCEA",130,0)
 Q
"RTN","RMPRPCEA",131,0)
 ;
"RTN","RMPRPCEA",132,0)
BUILD ; now build array for passing data to PCE
"RTN","RMPRPCEA",133,0)
 K ^TMP("RMPRPCE1",$J,"PXAPI"),RMAPI
"RTN","RMPRPCEA",134,0)
 S RMAPI=$NA(^TMP("RMPRPCE1",$J,"PXAPI"))
"RTN","RMPRPCEA",135,0)
 ; ---------encounter date/time----------------
"RTN","RMPRPCEA",136,0)
 S @RMAPI@("ENCOUNTER",1,"ENC D/T")=RMDATE
"RTN","RMPRPCEA",137,0)
 ; --------------patient-----------------------
"RTN","RMPRPCEA",138,0)
 S @RMAPI@("ENCOUNTER",1,"PATIENT")=RMPAT
"RTN","RMPRPCEA",139,0)
 ; ---------------clinic-----------------------
"RTN","RMPRPCEA",140,0)
 S @RMAPI@("ENCOUNTER",1,"HOS LOC")=RMHLOC
"RTN","RMPRPCEA",141,0)
 ; -------------checkout date/time-------------
"RTN","RMPRPCEA",142,0)
 S @RMAPI@("ENCOUNTER",1,"CHECKOUT D/T")=RMDATE
"RTN","RMPRPCEA",143,0)
 ; ------------agent orange--------------------
"RTN","RMPRPCEA",144,0)
 S @RMAPI@("ENCOUNTER",1,"AO")=RMAO
"RTN","RMPRPCEA",145,0)
 ;--------------ionizing radiation-------------
"RTN","RMPRPCEA",146,0)
 S @RMAPI@("ENCOUNTER",1,"IR")=RMIR
"RTN","RMPRPCEA",147,0)
 ;-----------environmental contaminants--------
"RTN","RMPRPCEA",148,0)
 S @RMAPI@("ENCOUNTER",1,"EC")=RMEC
"RTN","RMPRPCEA",149,0)
 ; --------------service connected--------------
"RTN","RMPRPCEA",150,0)
 S @RMAPI@("ENCOUNTER",1,"SC")=RMSCON
"RTN","RMPRPCEA",151,0)
 ; ------------Military Sexual Trauma----------
"RTN","RMPRPCEA",152,0)
 S @RMAPI@("ENCOUNTER",1,"MST")=RMMST
"RTN","RMPRPCEA",153,0)
 ; -------------Head/Neck Cancer---------------
"RTN","RMPRPCEA",154,0)
 S @RMAPI@("ENCOUNTER",1,"HNC")=RMHNC
"RTN","RMPRPCEA",155,0)
 ; --------------Combat Veteran---------
"RTN","RMPRPCEA",156,0)
 S @RMAPI@("ENCOUNTER",1,"CV")=RMCBV
"RTN","RMPRPCEA",157,0)
 ; --------------service category--------------
"RTN","RMPRPCEA",158,0)
 S @RMAPI@("ENCOUNTER",1,"SERVICE CATEGORY")=RMSCAT
"RTN","RMPRPCEA",159,0)
 ; ---------------encounter type---------------
"RTN","RMPRPCEA",160,0)
 S @RMAPI@("ENCOUNTER",1,"ENCOUNTER TYPE")=RMETYP
"RTN","RMPRPCEA",161,0)
 ; ------------primary provider----------------
"RTN","RMPRPCEA",162,0)
 S @RMAPI@("PROVIDER",1,"NAME")=RMUSER
"RTN","RMPRPCEA",163,0)
 ; ----------------diagnosis------------------
"RTN","RMPRPCEA",164,0)
 S @RMAPI@("DX/PL",1,"DIAGNOSIS")=RMDIAG
"RTN","RMPRPCEA",165,0)
 S @RMAPI@("DX/PL",1,"PRIMARY")=1
"RTN","RMPRPCEA",166,0)
 ; -------------- procedures -----------------
"RTN","RMPRPCEA",167,0)
 S @RMAPI@("PROCEDURE",1,"PROCEDURE")=RMPROC
"RTN","RMPRPCEA",168,0)
 ; ---------------- Quantity -----------------
"RTN","RMPRPCEA",169,0)
 S @RMAPI@("PROCEDURE",1,"QTY")=RMQTY
"RTN","RMPRPCEA",170,0)
 ; -------------- Procedures -----------------
"RTN","RMPRPCEA",171,0)
 I ($D(RMBAICD9(1))&($P($G(RMBAICD9(1)),U)=""))!('$D(RMBAICD9(1))) D  Q
"RTN","RMPRPCEA",172,0)
 . S @RMAPI@("PROCEDURE",1,"DIAGNOSIS")=RMDIAG
"RTN","RMPRPCEA",173,0)
 ;
"RTN","RMPRPCEA",174,0)
 F RMLOOP=1:1:99 Q:$G(RMBAICD9(RMLOOP))=""  D
"RTN","RMPRPCEA",175,0)
 . S @RMAPI@("DX/PL",RMLOOP,"DIAGNOSIS")=$G(RMBAICD9(RMLOOP))
"RTN","RMPRPCEA",176,0)
 . S @RMAPI@("DX/PL",RMLOOP,"PL AO")=$G(RMBAAO(RMLOOP))
"RTN","RMPRPCEA",177,0)
 . S @RMAPI@("DX/PL",RMLOOP,"PL IR")=$G(RMBAIR(RMLOOP))
"RTN","RMPRPCEA",178,0)
 . S @RMAPI@("DX/PL",RMLOOP,"PL SC")=$G(RMBASCON(RMLOOP))
"RTN","RMPRPCEA",179,0)
 . S @RMAPI@("DX/PL",RMLOOP,"PL EC")=$G(RMBAEC(RMLOOP))
"RTN","RMPRPCEA",180,0)
 . S @RMAPI@("DX/PL",RMLOOP,"PL MST")=$G(RMBAMST(RMLOOP))
"RTN","RMPRPCEA",181,0)
 . S @RMAPI@("DX/PL",RMLOOP,"PL HNC")=$G(RMBAHNC(RMLOOP))
"RTN","RMPRPCEA",182,0)
 . S @RMAPI@("DX/PL",RMLOOP,"PL CV")=$G(RMBACBV(RMLOOP))
"RTN","RMPRPCEA",183,0)
 . I RMLOOP=1 D  Q
"RTN","RMPRPCEA",184,0)
 . . S @RMAPI@("DX/PL",RMLOOP,"PRIMARY")=RMLOOP
"RTN","RMPRPCEA",185,0)
 . . S RMDIAG=$G(RMBAICD9(RMLOOP))
"RTN","RMPRPCEA",186,0)
 . . S @RMAPI@("PROCEDURE",1,"DIAGNOSIS")=$G(RMBAICD9(RMLOOP))
"RTN","RMPRPCEA",187,0)
 . S @RMAPI@("PROCEDURE",1,"DIAGNOSIS "_RMLOOP)=$G(RMBAICD9(RMLOOP))  ; only one procedure per send
"RTN","RMPRPCEA",188,0)
 ;
"RTN","RMPRPCEA",189,0)
 ; -----------------procedures----------------
"RTN","RMPRPCEA",190,0)
 S @RMAPI@("PROCEDURE",1,"PROCEDURE")=RMPROC
"RTN","RMPRPCEA",191,0)
 S @RMAPI@("PROCEDURE",1,"ORD PROVIDER")=RMPROV
"RTN","RMPRPCEA",192,0)
 S @RMAPI@("PROCEDURE",1,"EVENT D/T")=RMCPDT
"RTN","RMPRPCEA",193,0)
 ; ------------- Order Reference -------------
"RTN","RMPRPCEA",194,0)
 S @RMAPI@("PROCEDURE",1,"ORD REFERENCE")=RMODENT
"RTN","RMPRPCEA",195,0)
 ; -----------------Quantity------------------
"RTN","RMPRPCEA",196,0)
 S @RMAPI@("PROCEDURE",1,"QTY")=RMQTY
"RTN","RMPRPCEA",197,0)
 ; -----------------diagnosis-----------------
"RTN","RMPRPCEA",198,0)
 S @RMAPI@("PROCEDURE",1,"DIAGNOSIS")=RMDIAG
"RTN","RMPRPCEA",199,0)
 Q
"RTN","RMPRPCEA",200,0)
 ;
"RTN","RMPRPCEA",201,0)
SENDIT ; send the data to PCE. API (1891)
"RTN","RMPRPCEA",202,0)
 K RMPROB,RMPRTPCE,RMPCE
"RTN","RMPRPCEA",203,0)
 S (RMPRCPER,RMPROB,STOP)=0
"RTN","RMPRPCEA",204,0)
 D PRV^RMPRPCED
"RTN","RMPRPCEA",205,0)
 ; call the PCE package API.
"RTN","RMPRPCEA",206,0)
 I RMERR'<1 S RMERR=$$DATA2PCE^PXAPI($NA(^TMP("RMPRPCE1",$J,"PXAPI")),RMPKG,RMSRC,.RMPCE,RMUSER,0,,"",.RMPROB)
"RTN","RMPRPCEA",207,0)
 ;To check for returned error messages, list the RMPROB array.
"RTN","RMPRPCEA",208,0)
 I RMERR<1 W !,"File #660 IEN="_RMIE60_" - Error in PCE interface !!!"
"RTN","RMPRPCEA",209,0)
 ;delete PCE entry if Provider and CPT CODE error, but send an error
"RTN","RMPRPCEA",210,0)
 ;message to RMPR PCE mailgroup.
"RTN","RMPRPCEA",211,0)
 I $D(RMPROB($J)) D CHECK^RMPRPCED
"RTN","RMPRPCEA",212,0)
 I $G(RMPCE),$G(RMPRCPER) S RMPRTPCE=RJ_"^"_RMHLOC,RMCHK=$$DELVFILE^PXAPI("ALL",.RMPCE,RMPKG,RMSRC,0,0,"") Q
"RTN","RMPRPCEA",213,0)
 ;
"RTN","RMPRPCEA",214,0)
 Q:'$G(RMPCE)
"RTN","RMPRPCEA",215,0)
 ;update PCE pointer and date last sent in #660.
"RTN","RMPRPCEA",216,0)
 K RMUPD
"RTN","RMPRPCEA",217,0)
 S RMUPD(660,RMIE60_",",8.12)=RMPCE
"RTN","RMPRPCEA",218,0)
 S RMUPD(660,RMIE60_",",8.13)=RMDANOW
"RTN","RMPRPCEA",219,0)
 D FILE^DIE("","RMUPD","")
"RTN","RMPRPCEA",220,0)
 Q
"RTN","RMPRPCEA",221,0)
 ;
"RTN","RMPRPCEB")
0^4^B22940686^B22025437
"RTN","RMPRPCEB",1,0)
RMPRPCEB ;HIN/RVD-PROS PCE BACKGROUND UTILITY ; 1/23/04 8:09am
"RTN","RMPRPCEB",2,0)
 ;;3.0;PROSTHETICS;**62,69,77,82,78,114,120,133,142,145**;Feb 09, 1996;Build 6
"RTN","RMPRPCEB",3,0)
 ;
"RTN","RMPRPCEB",4,0)
 ;RVD patch #69 - add STATION in the error message.
"RTN","RMPRPCEB",5,0)
 ;                QUIT if no data in specified date range.
"RTN","RMPRPCEB",6,0)
 ;RVD patch #77 - only create 1 PCE entry for the same pt & same day.
"RTN","RMPRPCEB",7,0)
 ;
"RTN","RMPRPCEB",8,0)
 ;KAM Patch #82 06/21/2004 - Add more robust text to 'Missing
"RTN","RMPRPCEB",9,0)
 ;                           Prosthetics Clinic PCE error message
"RTN","RMPRPCEB",10,0)
 ;
"RTN","RMPRPCEB",11,0)
 ;WLC Patch #78 02/03/3005 - added NEW statement for error message
"RTN","RMPRPCEB",12,0)
 ;                           variables defined for Patch 82.
"RTN","RMPRPCEB",13,0)
 ;
"RTN","RMPRPCEB",14,0)
 W !,"Invalid Entry Point.....",!
"RTN","RMPRPCEB",15,0)
 Q
"RTN","RMPRPCEB",16,0)
OPTION ;entry point for menu option
"RTN","RMPRPCEB",17,0)
 Q
"RTN","RMPRPCEB",18,0)
TASK ;entry point for task job to send pros encounters to PCE.
"RTN","RMPRPCEB",19,0)
 ;Quit entered below so if site tasks job it will never run
"RTN","RMPRPCEB",20,0)
 Q
"RTN","RMPRPCEB",21,0)
 N RERRMSG,RERRMSG2  ; correction for patch 82  02/03/05 WLC
"RTN","RMPRPCEB",22,0)
 S IO=0,RMAIL=1,SVDUZ=DUZ,DUZ=.5
"RTN","RMPRPCEB",23,0)
 S Y=DT D DD^%DT S RMRDAT=Y K RMX,RMXMT,^TMP($J)
"RTN","RMPRPCEB",24,0)
 D NOW^%DTC S RMSTDT=%
"RTN","RMPRPCEB",25,0)
 S X="T-90" D ^%DT S RM90DAY=Y
"RTN","RMPRPCEB",26,0)
 S RMBIEN=$O(^RMPR(660,"B",RM90DAY))
"RTN","RMPRPCEB",27,0)
 Q:RMBIEN=""
"RTN","RMPRPCEB",28,0)
 S (RMENDT,RFLDAT)=0
"RTN","RMPRPCEB",29,0)
 F RS=0:0 S RS=$O(^RMPR(669.9,RS)) Q:RS'>0  D PCEFLG
"RTN","RMPRPCEB",30,0)
 S RI=$O(^RMPR(660,"B",RMBIEN,0))-1     ;starts at proper ien RMPR*120
"RTN","RMPRPCEB",31,0)
 F  S RI=$O(^RMPR(660,RI)) Q:RI'>0  D
"RTN","RMPRPCEB",32,0)
 .S RM600=$G(^RMPR(660,RI,0))
"RTN","RMPRPCEB",33,0)
 .I $P(RM600,U,2)="" Q
"RTN","RMPRPCEB",34,0)
 .S RM611=$G(^RMPR(660,RI,1))
"RTN","RMPRPCEB",35,0)
 .S RM610=$G(^RMPR(660,RI,10))
"RTN","RMPRPCEB",36,0)
 .Q:$P(RM600,U,15)
"RTN","RMPRPCEB",37,0)
 .Q:$P(RM600,U,17)
"RTN","RMPRPCEB",38,0)
 .Q:'$P(RM610,U,8)
"RTN","RMPRPCEB",39,0)
 .S RMSTA=$P(RM600,U,10)
"RTN","RMPRPCEB",40,0)
 .;quit if already been processed.
"RTN","RMPRPCEB",41,0)
 .Q:$P(RM610,U,12)
"RTN","RMPRPCEB",42,0)
 .Q:(RMSTA="")!('$D(RSTAFLG(RMSTA)))
"RTN","RMPRPCEB",43,0)
 .Q:'$P(RM611,U,4)!'$P(RM600,U,22)
"RTN","RMPRPCEB",44,0)
 .S RMDATE=$P(RM600,U,1),RMDFN=$P(RM600,U,2)
"RTN","RMPRPCEB",45,0)
 .S RMICD9=$P(RM610,U,8) I RMICD9'="" Q:$P($G(^ICD9(RMICD9,0)),U,9)  ;quit if DX code inactive RMPR*120
"RTN","RMPRPCEB",46,0)
 .Q:$D(^TMP($J,RMSTA,RMDATE,RMDFN))
"RTN","RMPRPCEB",47,0)
 .S RMPROCF=0
"RTN","RMPRPCEB",48,0)
 .F J=0:0 S J=$O(^RMPR(660,"C",RMDFN,J)) Q:J'>0  D
"RTN","RMPRPCEB",49,0)
 ..S RMJ60=$G(^RMPR(660,J,0)),RMJDT=$P(RMJ60,U,1),RMJST=$P(RMJ60,U,10)
"RTN","RMPRPCEB",50,0)
 ..Q:(RMJST'=RMSTA)!(RMJDT'=RMDATE)
"RTN","RMPRPCEB",51,0)
 ..S RMJ610=$G(^RMPR(660,J,10)),RMJ12=$P(RMJ610,U,12)
"RTN","RMPRPCEB",52,0)
 ..I $G(RMJ12) S RMPROCF=1
"RTN","RMPRPCEB",53,0)
 .;don't process if PCE data was process for the same day.
"RTN","RMPRPCEB",54,0)
 .Q:$G(RMPROCF)
"RTN","RMPRPCEB",55,0)
 .S ^TMP($J,RMSTA,RMDATE,RMDFN,RI)=""
"RTN","RMPRPCEB",56,0)
 ;
"RTN","RMPRPCEB",57,0)
 D PROC
"RTN","RMPRPCEB",58,0)
 I '$D(^TMP($J,"RMPRERR")) D
"RTN","RMPRPCEB",59,0)
 .S ^TMP($J,"RMPR",5)="***** NO ERROR TO REPORT !!!!!"
"RTN","RMPRPCEB",60,0)
 S RMSUBI=4 D BUILD D:$D(^XMB(3.8,"B","RMPR PCE")) MES1,MES2
"RTN","RMPRPCEB",61,0)
 G EXIT
"RTN","RMPRPCEB",62,0)
 ;
"RTN","RMPRPCEB",63,0)
PCEFLG ;
"RTN","RMPRPCEB",64,0)
 S:$D(^RMPR(669.9,RS,"PCE")) RFLDAT=$P($G(^RMPR(669.9,RS,"PCE")),U,2)
"RTN","RMPRPCEB",65,0)
 S:'$D(^RMPR(669.9,RS,"PCE")) RFLDAT=0
"RTN","RMPRPCEB",66,0)
 S RSTAFLG($P(^RMPR(669.9,RS,0),U,2))=RFLDAT
"RTN","RMPRPCEB",67,0)
 S $P(^RMPR(669.9,RS,"PCE"),U,1)=RMSTDT
"RTN","RMPRPCEB",68,0)
 Q
"RTN","RMPRPCEB",69,0)
 ;
"RTN","RMPRPCEB",70,0)
PROC ;process
"RTN","RMPRPCEB",71,0)
 F RS=0:0 S RS=$O(^TMP($J,RS)) Q:RS'>0  F RII=0:0 S RII=$O(^TMP($J,RS,RII)) Q:RII'>0  F RJ=0:0 S RJ=$O(^TMP($J,RS,RII,RJ)) Q:RJ'>0  S RK=$O(^TMP($J,RS,RII,RJ,0)) D
"RTN","RMPRPCEB",72,0)
 .;call PCE Interface
"RTN","RMPRPCEB",73,0)
 .S RMIE60RK=RK
"RTN","RMPRPCEB",74,0)
 .S RMC=$$SENDPCE^RMPRPCEA(RK)
"RTN","RMPRPCEB",75,0)
 . I RMC<1 D
"RTN","RMPRPCEB",76,0)
 ..S RSNAM="        "
"RTN","RMPRPCEB",77,0)
 ..I $G(RS),$D(^DIC(4,RS,0)) S RSNAM=$E($P(^DIC(4,RS,0),U,1),1,8)
"RTN","RMPRPCEB",78,0)
 ..S ^TMP($J,"RMPRERR",RK)="Station: "_RSNAM_", File #660 IEN="_RK_" - Error in PCE interface!!!"
"RTN","RMPRPCEB",79,0)
 ..;Added next line for RMPR*3*82
"RTN","RMPRPCEB",80,0)
 ..I '$G(RMLOC) S ^TMP($J,"RMPRERR",RK)=^TMP($J,"RMPRERR",RK)_$G(RERRMSG)_$G(RERRMSG2)
"RTN","RMPRPCEB",81,0)
 ..I $D(RMPROB($J,1))!$D(RMPROB($J,2)) D
"RTN","RMPRPCEB",82,0)
 ...S (R2,R3,RMMESS)="",R6I=RK,RC=0
"RTN","RMPRPCEB",83,0)
 ...F R1=0:0 S R1=$O(RMPROB($J,R1)) Q:R1'>0  S RC=RC+1 F  S R2=$O(RMPROB($J,R1,"ERROR1",R2)) Q:R2=""  F  S R3=$O(RMPROB($J,R1,"ERROR1",R2,R3)) Q:R3=""  D
"RTN","RMPRPCEB",84,0)
 ....F R4=0:0 S R4=$O(RMPROB($J,R1,"ERROR1",R2,R3,R4)) Q:R4'>0  D
"RTN","RMPRPCEB",85,0)
 .....S RMMESS=RMPROB($J,R1,"ERROR1",R2,R3,R4),RMK=R6I_"."_RC,^TMP($J,"RMPRERR",RMK)="    ???? "_$E(RMMESS,1,999)
"RTN","RMPRPCEB",86,0)
 .....K RMPROB($J,R1,"ERROR1",R2,R3,R4)
"RTN","RMPRPCEB",87,0)
 K RMPROB
"RTN","RMPRPCEB",88,0)
 Q
"RTN","RMPRPCEB",89,0)
 ;
"RTN","RMPRPCEB",90,0)
MES1 ;
"RTN","RMPRPCEB",91,0)
 S XMY("G.RMPR PCE")="",XMDUZ=.5,XMTEXT="^TMP($J,""RMPR"","
"RTN","RMPRPCEB",92,0)
 S XMSUB="PROSTHETICS PCE BACKGROUND MESSAGE"
"RTN","RMPRPCEB",93,0)
 S ^TMP($J,"RMPR",1)="Run Date: "_RMRDAT
"RTN","RMPRPCEB",94,0)
 S ^TMP($J,"RMPR",2)="This is a notification from the Prosthetics Department........"
"RTN","RMPRPCEB",95,0)
 S ^TMP($J,"RMPR",3)=""
"RTN","RMPRPCEB",96,0)
 S ^TMP($J,"RMPR",4)=""
"RTN","RMPRPCEB",97,0)
 Q
"RTN","RMPRPCEB",98,0)
MES2 ;
"RTN","RMPRPCEB",99,0)
 S ^TMP($J,"RMPR",RMSUBI+2)=""
"RTN","RMPRPCEB",100,0)
 I $D(^TMP($J,"RMPRERR")) S ^TMP($J,"RMPR",RMSUBI+3)="*** Please contact your PCE Coordinator or IRM ***"
"RTN","RMPRPCEB",101,0)
 I '$D(^TMP($J,"RMPRERR")) S ^TMP($J,"RMPR",RMSUBI+3)=""
"RTN","RMPRPCEB",102,0)
 S ^TMP($J,"RMPR",RMSUBI+4)=""
"RTN","RMPRPCEB",103,0)
 S ^TMP($J,"RMPR",RMSUBI+5)="Thank You!!!"
"RTN","RMPRPCEB",104,0)
 S ^TMP($J,"RMPR",RMSUBI+6)=""
"RTN","RMPRPCEB",105,0)
 S ^TMP($J,"RMPR",RMSUBI+7)="PROSTHETICS DEPARTMENT"
"RTN","RMPRPCEB",106,0)
 D ^XMD
"RTN","RMPRPCEB",107,0)
 D NOW^%DTC
"RTN","RMPRPCEB",108,0)
 ;if task finish to completion and;
"RTN","RMPRPCEB",109,0)
 ;if no errors, set the PCE end date of the background job in #669.9.
"RTN","RMPRPCEB",110,0)
 F RS=0:0 S RS=$O(^RMPR(669.9,RS)) Q:RS'>0  S $P(^RMPR(669.9,RS,"PCE"),U,2)=%
"RTN","RMPRPCEB",111,0)
 Q
"RTN","RMPRPCEB",112,0)
 ;
"RTN","RMPRPCEB",113,0)
BUILD ;
"RTN","RMPRPCEB",114,0)
 F I=0:0 S I=$O(^TMP($J,"RMPRERR",I)) Q:I'>0  D
"RTN","RMPRPCEB",115,0)
 .S RMMAIL=^TMP($J,"RMPRERR",I)
"RTN","RMPRPCEB",116,0)
 .S RMSUBI=RMSUBI+1
"RTN","RMPRPCEB",117,0)
 .S ^TMP($J,"RMPR",RMSUBI)=RMMAIL
"RTN","RMPRPCEB",118,0)
 Q
"RTN","RMPRPCEB",119,0)
 ;
"RTN","RMPRPCEB",120,0)
EXIT ;MAIN EXIT POINT
"RTN","RMPRPCEB",121,0)
 K ^TMP($J)
"RTN","RMPRPCEB",122,0)
 S DUZ=SVDUZ
"RTN","RMPRPCEB",123,0)
 N RMPRSITE,RMPR D KILL^XUSCLEAN
"RTN","RMPRPCEB",124,0)
 Q
"RTN","RMPRPCED")
0^5^B22387004^B21933910
"RTN","RMPRPCED",1,0)
RMPRPCED ;Hines OIFO/RVD - Prosthetics/660/668/PCE DELETE ;7/30/02  09:39
"RTN","RMPRPCED",2,0)
 ;;3.0;PROSTHETICS;**62,70,121,131,141,145**;Feb 09, 1996;Build 6
"RTN","RMPRPCED",3,0)
 ;RVD 7/1/02 - patch #70 - new RMPR variables before calling PCE.
"RTN","RMPRPCED",4,0)
 ;
"RTN","RMPRPCED",5,0)
 ; This routine contains the code for deleting a Prosthetic visit in PCE.
"RTN","RMPRPCED",6,0)
 ;
"RTN","RMPRPCED",7,0)
 ;DBIA #1890  - this API is used to delete data from the VISIT file
"RTN","RMPRPCED",8,0)
 ;              (9000010) and V files from PCE module.
"RTN","RMPRPCED",9,0)
 ;DBIA #10048 - fileman read on file 9.4.
"RTN","RMPRPCED",10,0)
 ;
"RTN","RMPRPCED",11,0)
DEL(RMIE60) ;delete PCE visit.
"RTN","RMPRPCED",12,0)
 D NEWVAR
"RTN","RMPRPCED",13,0)
 S (RMLOCK,RMERR)=0
"RTN","RMPRPCED",14,0)
 G DEL68  ;Skip PCE delete for encounters created from items
"RTN","RMPRPCED",15,0)
 I '$P($G(^RMPR(660,RMIE60,10)),U,12) G DEL68
"RTN","RMPRPCED",16,0)
 S RMSRC="PROSTHETICS DATA"
"RTN","RMPRPCED",17,0)
 S X="PROSTHETICS",DIC="^DIC(9.4," D ^DIC
"RTN","RMPRPCED",18,0)
 I '$D(Y)!(Y<0) S RMERR=-1 G DELX
"RTN","RMPRPCED",19,0)
 S RMPKG=+Y
"RTN","RMPRPCED",20,0)
 I 'RMPKG S RMERR=-1 G DELX
"RTN","RMPRPCED",21,0)
 ;
"RTN","RMPRPCED",22,0)
 ; get PCE IEn from file #660.
"RTN","RMPRPCED",23,0)
 S RMPCE=$P($G(^RMPR(660,RMIE60,10)),U,12)
"RTN","RMPRPCED",24,0)
 I 'RMPCE S RMERR=-1 G DELX
"RTN","RMPRPCED",25,0)
 I '$D(^AUPNVSIT(RMPCE,0)) G DEL68
"RTN","RMPRPCED",26,0)
 ;
"RTN","RMPRPCED",27,0)
DELVF ; Remove all workload data from the PCE visit file & related V files.
"RTN","RMPRPCED",28,0)
 ; check if the visit is already in PCE and remove workload,
"RTN","RMPRPCED",29,0)
 ; (sending RMPKG and RMSRC to ensure that only data that originally
"RTN","RMPRPCED",30,0)
 ; came from PROSTHETICS will be removed).
"RTN","RMPRPCED",31,0)
 ;
"RTN","RMPRPCED",32,0)
 N RMPR,REDO,VEJD
"RTN","RMPRPCED",33,0)
 S REDO=0
"RTN","RMPRPCED",34,0)
DELVF1 S RMCHK=$$DELVFILE^PXAPI("ALL",.RMPCE,RMPKG,RMSRC,0,0,"")
"RTN","RMPRPCED",35,0)
 I RMCHK'=1 D  I REDO=1 G DELVF1
"RTN","RMPRPCED",36,0)
 . Q:$P($G(^AUPNVSIT(RMPCE,0)),U,9)'=1!REDO
"RTN","RMPRPCED",37,0)
 . S VEJD=$O(^VEJD(19610.5,"B",RMPCE,0)) Q:VEJD=""
"RTN","RMPRPCED",38,0)
 . ;kill remaining dependent (DSS) to visit
"RTN","RMPRPCED",39,0)
 . S DA=VEJD,DIK="^VEJD(19610.5," D ^DIK
"RTN","RMPRPCED",40,0)
 . K DA,DIK
"RTN","RMPRPCED",41,0)
 . I $P(^AUPNVSIT(RMPCE,0),U,9)=0 S REDO=1
"RTN","RMPRPCED",42,0)
 I RMCHK'=1 W !!,"*** Error in deleting PCE visit !!",! S RMERR=-1 G DELX
"RTN","RMPRPCED",43,0)
 ;
"RTN","RMPRPCED",44,0)
DEL68 ; delete PCE info in file #668.
"RTN","RMPRPCED",45,0)
 S RMAMIS=$G(^RMPR(660,RMIE60,"AMS"))
"RTN","RMPRPCED",46,0)
 S RMIE68=$O(^RMPR(668,"F",RMIE60,0)) G:RMIE68="" DEL60
"RTN","RMPRPCED",47,0)
 L +^RMPR(668,RMIE68):3 I $T=0 D ERR68 G DELX
"RTN","RMPRPCED",48,0)
 S DA=$O(^RMPR(668,RMIE68,10,"B",RMIE60,0))
"RTN","RMPRPCED",49,0)
 S DA(1)=RMIE68,DIK="^RMPR(668,"_DA(1)_",10," D ^DIK
"RTN","RMPRPCED",50,0)
 S RMAMIEN=$O(^RMPR(668,RMIE68,11,"B",RMAMIS,0))
"RTN","RMPRPCED",51,0)
 S RMCNT=0
"RTN","RMPRPCED",52,0)
 F I=0:0 S I=$O(^RMPR(668,RMIE68,10,"B",I)) Q:I'>0  D
"RTN","RMPRPCED",53,0)
 .S RMAMIS68=$G(^RMPR(660,I,"AMS")) S:RMAMIS68=RMAMIS RMCNT=RMCNT+1
"RTN","RMPRPCED",54,0)
 ;if no other line item of the same GROUPER #, then delete.
"RTN","RMPRPCED",55,0)
 I RMCNT=1,RMAMIEN D
"RTN","RMPRPCED",56,0)
 .S DA=RMAMIEN
"RTN","RMPRPCED",57,0)
 .S DA(1)=RMIE68,DIK="^RMPR(668,"_DA(1)_",11,"
"RTN","RMPRPCED",58,0)
 .D ^DIK
"RTN","RMPRPCED",59,0)
 L -^RMPR(668,RMIE68)
"RTN","RMPRPCED",60,0)
 ;
"RTN","RMPRPCED",61,0)
DEL60 ; delete PCE info in file #660.
"RTN","RMPRPCED",62,0)
 ; lock file #660
"RTN","RMPRPCED",63,0)
 L +^RMPR(660,RMIE60,10):3 I $T=0 D ERR60 G DELX
"RTN","RMPRPCED",64,0)
 S RMARR(660,RMIE60_",",8.12)="@"
"RTN","RMPRPCED",65,0)
 S RMARR(660,RMIE60_",",8.13)="@"
"RTN","RMPRPCED",66,0)
 D FILE^DIE("","RMARR","")
"RTN","RMPRPCED",67,0)
 L -^RMPR(660,RMIE60,10)
"RTN","RMPRPCED",68,0)
 ;
"RTN","RMPRPCED",69,0)
 ; exit delete
"RTN","RMPRPCED",70,0)
DELX Q RMERR
"RTN","RMPRPCED",71,0)
 ;
"RTN","RMPRPCED",72,0)
ERR68 ; print error if unable to delete/update file #668.
"RTN","RMPRPCED",73,0)
 W !!,"*** File #668 is locked, IEN = ",RMIE68,", PLEASE contact your IRM!!",!!
"RTN","RMPRPCED",74,0)
 L -^RMPR(668,RMIE68)
"RTN","RMPRPCED",75,0)
 S RMERR=-1
"RTN","RMPRPCED",76,0)
 Q
"RTN","RMPRPCED",77,0)
ERR60 ; print error if unable to delete/update file #660.
"RTN","RMPRPCED",78,0)
 W !!,"*** File #660 is locked, IEN = ",RMIE60,", PLEASE contact your IRM!!",!!
"RTN","RMPRPCED",79,0)
 S RMERR=-1
"RTN","RMPRPCED",80,0)
 Q
"RTN","RMPRPCED",81,0)
 ;
"RTN","RMPRPCED",82,0)
CHECK ;check for return error from PCE
"RTN","RMPRPCED",83,0)
 ;input variable RMPROB
"RTN","RMPRPCED",84,0)
 I $D(RMPROB($J,1))!$D(RMPROB($J,2)) D
"RTN","RMPRPCED",85,0)
 .S (R2,R3,RMMESS)=""
"RTN","RMPRPCED",86,0)
 .F R1=0:0 S R1=$O(RMPROB($J,R1)) Q:R1'>0  F  S R2=$O(RMPROB($J,R1,"ERROR1",R2)) Q:R2=""  F  S R3=$O(RMPROB($J,R1,"ERROR1",R2,R3)) Q:R3=""  D
"RTN","RMPRPCED",87,0)
 ..F R4=0:0 S R4=$O(RMPROB($J,R1,"ERROR1",R2,R3,R4)) Q:R4'>0  D
"RTN","RMPRPCED",88,0)
 ...S RMMESS=RMPROB($J,R1,"ERROR1",R2,R3,R4)
"RTN","RMPRPCED",89,0)
 ...W:RMMESS'="" !,"???? ",RMMESS
"RTN","RMPRPCED",90,0)
 ...I (RMMESS["CPT")!(RMMESS["Provider") S RMPRCPER=1
"RTN","RMPRPCED",91,0)
 Q
"RTN","RMPRPCED",92,0)
 ;
"RTN","RMPRPCED",93,0)
PRV ;PROVIDER VALIDATION PRIOR TO PCE INTERFACE CALL
"RTN","RMPRPCED",94,0)
 K PXAA,PXADI,PXAERR N PXAVDATE,PXAERRF
"RTN","RMPRPCED",95,0)
 S PXAA("NAME")=^TMP("RMPRPCE1",$J,"PXAPI","PROVIDER",1,"NAME"),PXAVDATE=$P(^TMP("RMPRPCE1",$J,"PXAPI","ENCOUNTER",1,"ENC D/T"),".")
"RTN","RMPRPCED",96,0)
 ;CHECKER
"RTN","RMPRPCED",97,0)
 ;----Missing a pointer to providers name
"RTN","RMPRPCED",98,0)
 I $G(PXAA("NAME"))']"" D  G PRVX:$G(STOP)
"RTN","RMPRPCED",99,0)
 .S STOP=1 ;--USED TO STOP DO LOOP
"RTN","RMPRPCED",100,0)
 .S PXAERRF=1 ;--FLAG INDICATES THERE IS AN ERR
"RTN","RMPRPCED",101,0)
 .S PXADI("DIALOG")=8390001.001
"RTN","RMPRPCED",102,0)
 .S PXAERR(9)="NAME"
"RTN","RMPRPCED",103,0)
 .S PXAERR(11)=$G(PXAA("NAME"))
"RTN","RMPRPCED",104,0)
 .S PXAERR(12)="You are missing a pointer to the NEW PERSON file #200 that represents the Provider's name"
"RTN","RMPRPCED",105,0)
 ;
"RTN","RMPRPCED",106,0)
 ;----Not a pointer to NEW PERSON file#200
"RTN","RMPRPCED",107,0)
 I $G(PXAA("NAME"))'["@" D 01^PXAIUPRV($G(PXAA("NAME"))) I $G(PXAIVAL)=1 K PXAIVAL,PXCA("ERROR") D  G PRVX:$G(STOP)
"RTN","RMPRPCED",108,0)
 .S STOP=1
"RTN","RMPRPCED",109,0)
 .S PXAERRF=1
"RTN","RMPRPCED",110,0)
 .S PXADI("DIALOG")=8390001.001
"RTN","RMPRPCED",111,0)
 .S PXAERR(9)="NAME"
"RTN","RMPRPCED",112,0)
 .S PXAERR(11)=$G(PXAA("NAME"))
"RTN","RMPRPCED",113,0)
 .S PXAERR(12)=PXAERR(11)_" is NOT a pointer value to the NEW PERSON file #200 for Provider"
"RTN","RMPRPCED",114,0)
 ;
"RTN","RMPRPCED",115,0)
 ;----Not have an active person class
"RTN","RMPRPCED",116,0)
 N CLASS
"RTN","RMPRPCED",117,0)
 S CLASS=+$$GET^XUA4A72($G(PXAA("NAME")),PXAVDATE) I CLASS<0 D
"RTN","RMPRPCED",118,0)
 .S STOP=1
"RTN","RMPRPCED",119,0)
 .S PXAERRF=1
"RTN","RMPRPCED",120,0)
 .S PXADI("DIALOG")=8390001.001
"RTN","RMPRPCED",121,0)
 .S PXAERR(9)="NAME"
"RTN","RMPRPCED",122,0)
 .S PXAERR(11)=$G(PXAA("NAME"))
"RTN","RMPRPCED",123,0)
 .S PXAERR(12)="The Provider does not have an ACTIVE person class!"
"RTN","RMPRPCED",124,0)
PRVX I STOP D
"RTN","RMPRPCED",125,0)
 . S RMERR=0 K RMPCE
"RTN","RMPRPCED",126,0)
 . S RMPROB($J,2,"ERROR1","PROVIDER","NAME",1)=PXAERR(12)
"RTN","RMPRPCED",127,0)
 K PXAERR,PXAERRF,PXADI,PXAA
"RTN","RMPRPCED",128,0)
 Q
"RTN","RMPRPCED",129,0)
NEWVAR ; new variables
"RTN","RMPRPCED",130,0)
 N Y
"RTN","RMPRPCED",131,0)
 N I,RMCHK,RMKI,RMSUB,RMARR,DIE,DA,DIC,RMAMIS,RMAMIS68,DIK,RMCNT,RMAMIEN
"RTN","RMPRPCED",132,0)
 Q
"RTN","RMPRPIY6")
0^2^B78861327^B78793890
"RTN","RMPRPIY6",1,0)
RMPRPIY6 ;HINES OIFO/ODJ - EI - Edit Locations and Items ;10/7/02  14:46
"RTN","RMPRPIY6",2,0)
 ;;3.0;PROSTHETICS;**61,145**;Feb 09, 1996;Build 6
"RTN","RMPRPIY6",3,0)
 Q
"RTN","RMPRPIY6",4,0)
 ;
"RTN","RMPRPIY6",5,0)
 ;***** EI - Edit Inventory ITEM
"RTN","RMPRPIY6",6,0)
 ;           option RMPR INV EDIT
"RTN","RMPRPIY6",7,0)
 ;           Replaces EI option in old PIP (cf ^RMPR5NEE)
"RTN","RMPRPIY6",8,0)
 ;           no inputs required
"RTN","RMPRPIY6",9,0)
 ;           other than standard VISTA vars. (DUZ, etc)
"RTN","RMPRPIY6",10,0)
 ;
"RTN","RMPRPIY6",11,0)
EI N RMPRERR,RMPRSTN,RMPREXC,RMPR5,RMPR1,RMPR11,RMPRVEND,RMPRTVAL,RMPR9M
"RTN","RMPRPIY6",12,0)
 N RMPRQTY,RMPRREO,RMPR4,RMPR6,RMPR7,RMPR7M,RMPR6M,RMPR4M,RMPRGLAM
"RTN","RMPRPIY6",13,0)
 N RMPR69,RMPR6I,RMPRGLQ,RMPRLCN,RMPRUCST,RMPROVAL,RMPRHCPC,RMPR5P
"RTN","RMPRPIY6",14,0)
 N RMPR11M,RMPR11I,RMPR441,RMPRUNI
"RTN","RMPRPIY6",15,0)
 ;
"RTN","RMPRPIY6",16,0)
 ;***** STN - call prompt for Site/Station
"RTN","RMPRPIY6",17,0)
STN S RMPROVAL=$G(RMPRSTN("IEN"))
"RTN","RMPRPIY6",18,0)
 W @IOF S RMPRERR=$$STN^RMPRPIY1(.RMPRSTN,.RMPREXC)
"RTN","RMPRPIY6",19,0)
 I RMPRERR G EIX
"RTN","RMPRPIY6",20,0)
 I RMPREXC'="" G EIX
"RTN","RMPRPIY6",21,0)
 I RMPROVAL'=RMPRSTN("IEN") K RMPR1,RMPR11,RMPR5,RMPRLCN
"RTN","RMPRPIY6",22,0)
 ;
"RTN","RMPRPIY6",23,0)
 ;***** HCPCS - call prompts for selecting HCPCS and Item
"RTN","RMPRPIY6",24,0)
HCPCS W !!,"Editing Inventory Items.",!
"RTN","RMPRPIY6",25,0)
 S RMPROVAL=$G(RMPR1("IEN"))
"RTN","RMPRPIY6",26,0)
 K RMPR1,RMPR11,RMPR5,RMPRLCN,RMPREXC,RMPRERR,RMPRUNI
"RTN","RMPRPIY6",27,0)
 D HCPCS^RMPRPIY7(RMPRSTN("IEN"),$G(RMPR1("HCPCS")),.RMPR1,.RMPR11,.RMPREXC)
"RTN","RMPRPIY6",28,0)
 I RMPREXC="T" G EIX
"RTN","RMPRPIY6",29,0)
 I RMPREXC="P" G STN
"RTN","RMPRPIY6",30,0)
 I RMPREXC="^" D  G EIX
"RTN","RMPRPIY6",31,0)
 . W !,"** No HCPCS selected." H 1
"RTN","RMPRPIY6",32,0)
 . Q
"RTN","RMPRPIY6",33,0)
 I $G(RMPR11("IEN"))'="" G HCPCS4
"RTN","RMPRPIY6",34,0)
HCPCS3 D ITEM^RMPRPIYP(RMPRSTN("IEN"),$G(RMPR1("HCPCS")),.RMPR11,.RMPREXC)
"RTN","RMPRPIY6",35,0)
 I RMPREXC="T" G EIX
"RTN","RMPRPIY6",36,0)
 I RMPREXC="P" G HCPCS
"RTN","RMPRPIY6",37,0)
 I RMPREXC="^" G HCPCS
"RTN","RMPRPIY6",38,0)
 ;
"RTN","RMPRPIY6",39,0)
 ; display selected HCPCS and item and continue
"RTN","RMPRPIY6",40,0)
HCPCS4 W !!,"HCPCS: "_RMPR1("HCPCS")_" "_RMPR1("SHORT DESC")
"RTN","RMPRPIY6",41,0)
 K RMPR11I S RMPRERR=$$ETOI^RMPRPIX1(.RMPR11,.RMPR11I)
"RTN","RMPRPIY6",42,0)
HCPCS4A K RMPR441,RMHCC
"RTN","RMPRPIY6",43,0)
 S RMPR441("IEN")=RMPR11I("ITEM MASTER IEN")
"RTN","RMPRPIY6",44,0)
 S:RMPR11I("ITEM MASTER IEN")'="" RMPRERR=$$GET^RMPRPIXD(.RMPR441)
"RTN","RMPRPIY6",45,0)
 D MASIT^RMPRPIY1(.RMPR441,.RMPREXC)
"RTN","RMPRPIY6",46,0)
 I RMPREXC="T" G EIX
"RTN","RMPRPIY6",47,0)
 I RMPREXC="P" G HCPCS
"RTN","RMPRPIY6",48,0)
 I RMPREXC="^" G HCPCS
"RTN","RMPRPIY6",49,0)
 I RMPR441("IEN")'=RMPR11I("ITEM MASTER IEN") D
"RTN","RMPRPIY6",50,0)
 . K RMPR11M
"RTN","RMPRPIY6",51,0)
 . S RMPR11M("IEN")=RMPR11("IEN")
"RTN","RMPRPIY6",52,0)
 . S RMPR11M("ITEM MASTER IEN")=RMPR441("IEN")
"RTN","RMPRPIY6",53,0)
 . S RMPRERR=$$UPD^RMPRPIX1(.RMPR11M)
"RTN","RMPRPIY6",54,0)
 . K RMPR11
"RTN","RMPRPIY6",55,0)
 . S RMPR11("IEN")=RMPR11M("IEN")
"RTN","RMPRPIY6",56,0)
 . S RMPRERR=$$GET^RMPRPIX1(.RMPR11)
"RTN","RMPRPIY6",57,0)
 . S RMPR11I("ITEM MASTER IEN")=RMPR441("IEN")
"RTN","RMPRPIY6",58,0)
 . K RMPR441,RMPR11M
"RTN","RMPRPIY6",59,0)
 . Q
"RTN","RMPRPIY6",60,0)
 ;
"RTN","RMPRPIY6",61,0)
 ; edit PIP Item desc.
"RTN","RMPRPIY6",62,0)
HCPCS5 D ITED^RMPRPIY1(.RMPR11,.RMPREXC)
"RTN","RMPRPIY6",63,0)
 I RMPREXC="T" G EIX
"RTN","RMPRPIY6",64,0)
 I RMPREXC="^" G HCPCS
"RTN","RMPRPIY6",65,0)
 I RMPREXC="P" G HCPCS4A
"RTN","RMPRPIY6",66,0)
 ;
"RTN","RMPRPIY6",67,0)
 ; Lock the current stock 661.7 file at HCPCS Item level as we may be
"RTN","RMPRPIY6",68,0)
 ; reducing or increasing the quantity on hand
"RTN","RMPRPIY6",69,0)
CURSTL L +^RMPR(661.7,"XSHIDS",RMPRSTN("IEN"),RMPR11("HCPCS"),RMPR11("ITEM")):5 E  W !,"PROSTHETIC CURRENT STOCK record for HCPCS item open by someone else" G LOCN
"RTN","RMPRPIY6",70,0)
 ;
"RTN","RMPRPIY6",71,0)
 ;***** CURST - call prompt for current stock record
"RTN","RMPRPIY6",72,0)
CURST S RMPRLCN="" K RMPR5
"RTN","RMPRPIY6",73,0)
 D PVEN^RMPRPIYR(RMPRSTN("IEN"),.RMPRLCN,RMPR11("HCPCS"),RMPR11("ITEM"),.RMPR6,.RMPR7,.RMPREXC)
"RTN","RMPRPIY6",74,0)
 I RMPREXC="T" G EIU
"RTN","RMPRPIY6",75,0)
 I RMPREXC="P" D UNLOCK G HCPCS5
"RTN","RMPRPIY6",76,0)
 I RMPREXC="^" K RMPR6,RMPR7 G RLOC
"RTN","RMPRPIY6",77,0)
 I $G(RMPR7("IEN"))="" G RLOC
"RTN","RMPRPIY6",78,0)
 S RMPRQTY=RMPR7("QUANTITY")
"RTN","RMPRPIY6",79,0)
 S RMPRTVAL=RMPR7("VALUE")
"RTN","RMPRPIY6",80,0)
 I RMPR7("QUANTITY")<1 S RMPRUCST=0
"RTN","RMPRPIY6",81,0)
 E  S RMPRUCST=+$J(RMPR7("VALUE")/RMPR7("QUANTITY"),0,6)
"RTN","RMPRPIY6",82,0)
 S:$D(RMPR7("UNIT")) RMPRUNI("IEN")=RMPR7("UNIT")
"RTN","RMPRPIY6",83,0)
 S:$D(RMPR7("UNIT NAME")) RMPRUNI("NAME")=RMPR7("UNIT NAME")
"RTN","RMPRPIY6",84,0)
 S RMPRERR=$$VNDIEN^RMPRPIX6(.RMPR6)
"RTN","RMPRPIY6",85,0)
 S RMPRVEND("IEN")=RMPR6("VENDOR IEN")
"RTN","RMPRPIY6",86,0)
 S RMPRVEND("NAME")=RMPR6("VENDOR")
"RTN","RMPRPIY6",87,0)
 S RMPR5("IEN")=RMPRLCN
"RTN","RMPRPIY6",88,0)
 S RMPRERR=$$GET^RMPRPIX5(.RMPR5)
"RTN","RMPRPIY6",89,0)
 G LOCN
"RTN","RMPRPIY6",90,0)
 ;
"RTN","RMPRPIY6",91,0)
 ;***** RLOC - if no receipt selected get def. loc. from reorder file
"RTN","RMPRPIY6",92,0)
RLOC D LOCN^RMPRPIYQ(RMPRSTN("IEN"),.RMPR11,.RMPR5,.RMPREXC)
"RTN","RMPRPIY6",93,0)
 I RMPREXC="T" G EIU
"RTN","RMPRPIY6",94,0)
 G LOCN
"RTN","RMPRPIY6",95,0)
 ;
"RTN","RMPRPIY6",96,0)
 ;***** LOCN - call prompt for Location
"RTN","RMPRPIY6",97,0)
LOCN K RMPR5P M RMPR5P=RMPR5
"RTN","RMPRPIY6",98,0)
 S RMPRLCN=$$LOC1^RMPRPIYB(RMPRSTN("IEN"))
"RTN","RMPRPIY6",99,0)
 I RMPRLCN D  G REO
"RTN","RMPRPIY6",100,0)
 . I $G(RMPR5("IEN"))="" D
"RTN","RMPRPIY6",101,0)
 .. S RMPR5("IEN")=RMPRLCN
"RTN","RMPRPIY6",102,0)
 .. S RMPRERR=$$GET^RMPRPIX5(.RMPR5)
"RTN","RMPRPIY6",103,0)
 .. Q
"RTN","RMPRPIY6",104,0)
 . W !,"Location: "_RMPR5("NAME")
"RTN","RMPRPIY6",105,0)
 . Q
"RTN","RMPRPIY6",106,0)
LOCN1 W ! D LOCNM^RMPRPIY7(RMPRSTN("IEN"),.RMPR5,.RMPREXC)
"RTN","RMPRPIY6",107,0)
 I RMPREXC="P" D UNLOCK G HCPCS5
"RTN","RMPRPIY6",108,0)
 I RMPREXC="^" G EIU
"RTN","RMPRPIY6",109,0)
 I RMPREXC="T" G EIU
"RTN","RMPRPIY6",110,0)
 S RMPRLCN=RMPR5("IEN")
"RTN","RMPRPIY6",111,0)
 ;
"RTN","RMPRPIY6",112,0)
 ;***** REO - call prompt for Re-Order Quantity (661.4)
"RTN","RMPRPIY6",113,0)
REO K RMPR4
"RTN","RMPRPIY6",114,0)
 S RMPR4("IEN")=$O(^RMPR(661.4,"ASLHI",RMPRSTN("IEN"),RMPRLCN,RMPR11("HCPCS"),RMPR11("ITEM"),""))
"RTN","RMPRPIY6",115,0)
 I RMPR4("IEN")="" D
"RTN","RMPRPIY6",116,0)
 . S RMPR4("IEN")=$O(^RMPR(661.4,"ASLHI",RMPRSTN("IEN"),RMPR5("IEN"),RMPR11("HCPCS"),RMPR11("ITEM"),""))
"RTN","RMPRPIY6",117,0)
 . Q
"RTN","RMPRPIY6",118,0)
 I RMPR4("IEN")="" D
"RTN","RMPRPIY6",119,0)
 . S RMPR4("RE-ORDER QTY")=0
"RTN","RMPRPIY6",120,0)
 . Q
"RTN","RMPRPIY6",121,0)
 E  D
"RTN","RMPRPIY6",122,0)
 . S RMPRERR=$$GET^RMPRPIX4(.RMPR4)
"RTN","RMPRPIY6",123,0)
 . Q
"RTN","RMPRPIY6",124,0)
 S RMPRREO=RMPR4("RE-ORDER QTY")
"RTN","RMPRPIY6",125,0)
REO1 ;
"RTN","RMPRPIY6",126,0)
 I '$D(RMPR5P) K RMPR5P M RMPR5P=RMPR5
"RTN","RMPRPIY6",127,0)
 D REO^RMPRPIY5(.RMPRREO,.RMPREXC)
"RTN","RMPRPIY6",128,0)
 I RMPREXC="P" D UNLOCK G HCPCS5
"RTN","RMPRPIY6",129,0)
 I RMPREXC="^" G EIU
"RTN","RMPRPIY6",130,0)
 I RMPREXC="T" G EIU
"RTN","RMPRPIY6",131,0)
 I RMPRREO'=RMPR4("RE-ORDER QTY")!(RMPR4("IEN")="")!(RMPR5("IEN")'=RMPR5P("IEN")) D
"RTN","RMPRPIY6",132,0)
 . K RMPR4M
"RTN","RMPRPIY6",133,0)
 . S RMPR4M("RE-ORDER QTY")=RMPRREO
"RTN","RMPRPIY6",134,0)
 . I RMPR4("IEN")="" D
"RTN","RMPRPIY6",135,0)
 .. S RMPRERR=$$CRE^RMPRPIX4(.RMPR4M,.RMPR11,.RMPR5)
"RTN","RMPRPIY6",136,0)
 .. Q
"RTN","RMPRPIY6",137,0)
 . E  D
"RTN","RMPRPIY6",138,0)
 .. S RMPR4M("IEN")=RMPR4("IEN")
"RTN","RMPRPIY6",139,0)
 .. S RMPRERR=$$UPD^RMPRPIX4(.RMPR4M,,)
"RTN","RMPRPIY6",140,0)
 .. Q
"RTN","RMPRPIY6",141,0)
 . Q
"RTN","RMPRPIY6",142,0)
 I '$D(RMPR6) G TRANSX ;only editing reorder level
"RTN","RMPRPIY6",143,0)
 ;
"RTN","RMPRPIY6",144,0)
 ;***** SRC - call prompt for SOURCE.
"RTN","RMPRPIY6",145,0)
SRC S (RMPRBCK,RMPRSRC)=$P(^RMPR(661.11,RMPR11("IEN"),0),U,5)
"RTN","RMPRPIY6",146,0)
 D SRC^RMPRPIY5(.RMPRSRC,.RMPREXC)
"RTN","RMPRPIY6",147,0)
 I RMPREXC="P" G SRC
"RTN","RMPRPIY6",148,0)
 I RMPREXC="^" D UNLOCK G HCPCS
"RTN","RMPRPIY6",149,0)
 I RMPREXC="T" G EIU
"RTN","RMPRPIY6",150,0)
 I RMPRSRC'=RMPRBCK S $P(^RMPR(661.11,RMPR11("IEN"),0),U,5)=RMPRSRC
"RTN","RMPRPIY6",151,0)
 ;***** QTY - call prompt for Quantity
"RTN","RMPRPIY6",152,0)
QTY D QTY^RMPRPIY5(.RMPRQTY,.RMPREXC)
"RTN","RMPRPIY6",153,0)
 I RMPREXC="P" G REO
"RTN","RMPRPIY6",154,0)
 I RMPREXC="^" D UNLOCK G HCPCS
"RTN","RMPRPIY6",155,0)
 I RMPREXC="T" G EIU
"RTN","RMPRPIY6",156,0)
 S RMPRQTY=+$G(RMPRQTY)
"RTN","RMPRPIY6",157,0)
 ;
"RTN","RMPRPIY6",158,0)
 ;***** UCST - call prompt for Unit Cost
"RTN","RMPRPIY6",159,0)
UCST D UCST^RMPRPIY5(.RMPRUCST,.RMPREXC)
"RTN","RMPRPIY6",160,0)
 I RMPREXC="P" G QTY
"RTN","RMPRPIY6",161,0)
 I RMPREXC="^" D UNLOCK G HCPCS
"RTN","RMPRPIY6",162,0)
 I RMPREXC="T" G EIU
"RTN","RMPRPIY6",163,0)
 S RMPRUCST=$J(RMPRUCST,0,2)
"RTN","RMPRPIY6",164,0)
 ;
"RTN","RMPRPIY6",165,0)
 ;***** TVAL - Total Value - use if Unit Cost not used
"RTN","RMPRPIY6",166,0)
TVAL I RMPRUCST D  G VEND
"RTN","RMPRPIY6",167,0)
 . S RMPRTVAL=$J(RMPRQTY*RMPRUCST,0,2)
"RTN","RMPRPIY6",168,0)
 . W !,"TOTAL COST OF QUANTITY: "_RMPRTVAL
"RTN","RMPRPIY6",169,0)
 . Q
"RTN","RMPRPIY6",170,0)
 D TVAL^RMPRPIY5(.RMPRTVAL,.RMPREXC)
"RTN","RMPRPIY6",171,0)
 I RMPREXC="P" G UCST
"RTN","RMPRPIY6",172,0)
 I RMPREXC="^" D UNLOCK G HCPCS
"RTN","RMPRPIY6",173,0)
 I RMPREXC="T" G EIU
"RTN","RMPRPIY6",174,0)
 ;
"RTN","RMPRPIY6",175,0)
 ;***** VEND - call prompt for Vendor
"RTN","RMPRPIY6",176,0)
 ;VENDOR edit removed 3/1/08 per Karen Blum
"RTN","RMPRPIY6",177,0)
VEND ;D VEND^RMPRPIY5(.RMPRVEND,.RMPREXC)
"RTN","RMPRPIY6",178,0)
 ;I RMPREXC="P" G UCST
"RTN","RMPRPIY6",179,0)
 ;I RMPREXC="^" D UNLOCK G HCPCS
"RTN","RMPRPIY6",180,0)
 ;I RMPREXC="T" G EIU
"RTN","RMPRPIY6",181,0)
 ;
"RTN","RMPRPIY6",182,0)
 ;
"RTN","RMPRPIY6",183,0)
 ;***** UNIT - call prompt for UNIT OF ISSUE
"RTN","RMPRPIY6",184,0)
UNIT D UNIT^RMPRPIY5(.RMPRUNI,.RMPREXC)
"RTN","RMPRPIY6",185,0)
 I RMPREXC="P" G UCST
"RTN","RMPRPIY6",186,0)
 I RMPREXC="^" D UNLOCK G HCPCS
"RTN","RMPRPIY6",187,0)
 I RMPREXC="T" G EIU
"RTN","RMPRPIY6",188,0)
 S RMPRUNI("UNIT")=RMPRUNI("IEN")
"RTN","RMPRPIY6",189,0)
 ;
"RTN","RMPRPIY6",190,0)
 ;***** TRANS - Modify current stock record
"RTN","RMPRPIY6",191,0)
TRANS K RMPR7M,RMPR6M
"RTN","RMPRPIY6",192,0)
 ;
"RTN","RMPRPIY6",193,0)
 I $G(RMHCC) D TRANS^RMPRPIXF G HAL
"RTN","RMPRPIY6",194,0)
 ;
"RTN","RMPRPIY6",195,0)
 K RMPR6I
"RTN","RMPRPIY6",196,0)
 S RMPRERR=$$ETOI^RMPRPIX6(.RMPR6,.RMPR6I)
"RTN","RMPRPIY6",197,0)
 ;
"RTN","RMPRPIY6",198,0)
 ;if unit of issue changed
"RTN","RMPRPIY6",199,0)
 I RMPRUNI("UNIT")'=RMPR7("UNIT") S RMPR7M("UNIT")=RMPRUNI("UNIT") D
"RTN","RMPRPIY6",200,0)
 . S RMPR7M("IEN")=RMPR7("IEN")
"RTN","RMPRPIY6",201,0)
 . S RMPRERR=$$UPD^RMPRPIX7(.RMPR7M,)
"RTN","RMPRPIY6",202,0)
 ; Modify Location in 661.6 and 661.7 if changed
"RTN","RMPRPIY6",203,0)
 I RMPR6I("LOCATION")'=RMPR5("IEN") D
"RTN","RMPRPIY6",204,0)
 . S RMPR6M("LOCATION")=RMPR5("IEN")
"RTN","RMPRPIY6",205,0)
 . S RMPR6M("IEN")=RMPR6("IEN")
"RTN","RMPRPIY6",206,0)
 . S RMPRERR=$$UPD^RMPRPIX6(.RMPR6M,)
"RTN","RMPRPIY6",207,0)
 . S RMPR7M("LOCATION")=RMPR5("IEN")
"RTN","RMPRPIY6",208,0)
 . S RMPR7M("IEN")=RMPR7("IEN")
"RTN","RMPRPIY6",209,0)
 . S RMPRERR=$$UPD^RMPRPIX7(.RMPR7M,)
"RTN","RMPRPIY6",210,0)
 . K RMPR6M,RMPR7M
"RTN","RMPRPIY6",211,0)
 . Q
"RTN","RMPRPIY6",212,0)
 ;
"RTN","RMPRPIY6",213,0)
 ; Modify Quantity or Value in current stock 661.7 record, the
"RTN","RMPRPIY6",214,0)
 ; transaction record 661.6 and running balance 661.9, if changed
"RTN","RMPRPIY6",215,0)
 I +RMPRQTY'=+RMPR7("QUANTITY")!(+RMPRTVAL'=+RMPR7("VALUE")) D
"RTN","RMPRPIY6",216,0)
 . K RMPR69,RMPR9M
"RTN","RMPRPIY6",217,0)
 . I RMPR6I("TRAN TYPE")=9 D
"RTN","RMPRPIY6",218,0)
 .. S RMPR69("TRANS IEN")=RMPR6("IEN")
"RTN","RMPRPIY6",219,0)
 .. S RMPRERR=$$GET^RMPRPIXB(.RMPR69)
"RTN","RMPRPIY6",220,0)
 .. Q
"RTN","RMPRPIY6",221,0)
 . S (RMPR9M("TQTY"),RMPR9M("TCST"),RMPRGLQ,RMPRGLAM)=0
"RTN","RMPRPIY6",222,0)
 . I +RMPRQTY'=+RMPR7("QUANTITY") D  Q:RMPR7M("QUANTITY")<0
"RTN","RMPRPIY6",223,0)
 .. S RMPR6M("QUANTITY")=RMPRQTY
"RTN","RMPRPIY6",224,0)
 .. S RMPRGLQ=RMPRQTY-RMPR7("QUANTITY")
"RTN","RMPRPIY6",225,0)
 ..; S RMPR7M("QUANTITY")=RMPR7("QUANTITY")+RMPRGLQ
"RTN","RMPRPIY6",226,0)
 .. S RMPR7M("QUANTITY")=RMPRQTY
"RTN","RMPRPIY6",227,0)
 .. S RMPR9M("TQTY")=RMPRGLQ
"RTN","RMPRPIY6",228,0)
 .. S:$D(RMPR69) RMPR69("GAIN/LOSS")=RMPR69("GAIN/LOSS")+RMPRGLQ
"RTN","RMPRPIY6",229,0)
 .. Q
"RTN","RMPRPIY6",230,0)
 . I +RMPRTVAL'=+RMPR7("VALUE") D
"RTN","RMPRPIY6",231,0)
 .. S RMPR6M("VALUE")=RMPRTVAL
"RTN","RMPRPIY6",232,0)
 .. S RMPRGLAM=RMPRTVAL-RMPR7("VALUE")
"RTN","RMPRPIY6",233,0)
 .. S RMPR7M("VALUE")=RMPR7("VALUE")+RMPRGLAM,RMPR7M("VALUE")=$J(RMPR7M("VALUE"),0,2)
"RTN","RMPRPIY6",234,0)
 .. S RMPR9M("TCST")=RMPRGLAM
"RTN","RMPRPIY6",235,0)
 .. S:$D(RMPR69) RMPR69("GAIN/LOSS VALUE")=RMPR69("GAIN/LOSS VALUE")+RMPRGLAM
"RTN","RMPRPIY6",236,0)
 .. Q
"RTN","RMPRPIY6",237,0)
 . S RMPR7M("IEN")=RMPR7("IEN")
"RTN","RMPRPIY6",238,0)
 . S RMPRERR=$$UPD^RMPRPIX7(.RMPR7M,)
"RTN","RMPRPIY6",239,0)
 . S RMPR6M("IEN")=RMPR6("IEN")
"RTN","RMPRPIY6",240,0)
 . S RMPRERR=$$UPD^RMPRPIX6(.RMPR6M,)
"RTN","RMPRPIY6",241,0)
 . I $D(RMPR69) S RMPRERR=$$UPD^RMPRPIXB(.RMPR69)
"RTN","RMPRPIY6",242,0)
 . S RMPR9M("STA")=RMPRSTN("IEN")
"RTN","RMPRPIY6",243,0)
 . S RMPR9M("HCP")=RMPR11("HCPCS")
"RTN","RMPRPIY6",244,0)
 . S RMPR9M("ITE")=RMPR11("ITEM")
"RTN","RMPRPIY6",245,0)
 . S RMPRERR=$$DTIEN^RMPRPIX6(.RMPR6)
"RTN","RMPRPIY6",246,0)
 . S RMPR9M("RDT")=$P(RMPR6("DATE&TIME"),".",1)
"RTN","RMPRPIY6",247,0)
 . S RMPRERR=$$UPCR^RMPRPIXJ(.RMPR9M)
"RTN","RMPRPIY6",248,0)
 . K RMPR7M,RMPR6M,RMPR9M
"RTN","RMPRPIY6",249,0)
 . Q
"RTN","RMPRPIY6",250,0)
 I $D(RMPR7M("QUANTITY")),RMPR7M("QUANTITY")<1 D  G QTY
"RTN","RMPRPIY6",251,0)
 . W !,"The quantity cannot be allowed because it would cause a",!
"RTN","RMPRPIY6",252,0)
 . W "negative on hand quantity.",!
"RTN","RMPRPIY6",253,0)
 . W "Please check your inventory and use the reconciliation option",!
"RTN","RMPRPIY6",254,0)
 . W "as needed.",!
"RTN","RMPRPIY6",255,0)
 . Q
"RTN","RMPRPIY6",256,0)
TRANSX I 'RMPRERR D
"RTN","RMPRPIY6",257,0)
 . W !!,"** Item "
"RTN","RMPRPIY6",258,0)
 . W RMPR11("HCPCS-ITEM")
"RTN","RMPRPIY6",259,0)
 . W " was "
"RTN","RMPRPIY6",260,0)
 . W "Edited by "
"RTN","RMPRPIY6",261,0)
 . W $$GETUSR^RMPRPIU0(DUZ)
"RTN","RMPRPIY6",262,0)
 . W:$D(RMPRGLQ) ": ("_$S(RMPRGLQ>0:"+",1:"")_RMPRGLQ_")"
"RTN","RMPRPIY6",263,0)
 . W " @ Location ",RMPR5("NAME")
"RTN","RMPRPIY6",264,0)
 . Q
"RTN","RMPRPIY6",265,0)
 E  D
"RTN","RMPRPIY6",266,0)
 . W !!,"** The Item could not be modified due to a problem - please contact support"
"RTN","RMPRPIY6",267,0)
 . Q
"RTN","RMPRPIY6",268,0)
 D UNLOCK
"RTN","RMPRPIY6",269,0)
HAL H 2
"RTN","RMPRPIY6",270,0)
 K RMPRTVAL,RMPRUCST,RMPR6,RMPR7,RMPRVEND,RMPRQTY,RMPRREO,RMPRGLQ,RMPRGLAM
"RTN","RMPRPIY6",271,0)
 G HCPCS
"RTN","RMPRPIY6",272,0)
 ;
"RTN","RMPRPIY6",273,0)
 ;***** exit points
"RTN","RMPRPIY6",274,0)
EIU D UNLOCK
"RTN","RMPRPIY6",275,0)
EIX D KILL^XUSCLEAN
"RTN","RMPRPIY6",276,0)
 Q
"RTN","RMPRPIY6",277,0)
UNLOCK L -^RMPR(661.7,"XSHIDS",RMPRSTN("IEN"),RMPR11("HCPCS"),RMPR11("ITEM"))
"RTN","RMPRPIY6",278,0)
 Q
"VER")
8.0^22.0
"BLD",6928,6)
^125
**END**
**END**
