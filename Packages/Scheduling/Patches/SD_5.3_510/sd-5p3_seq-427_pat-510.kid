Released SD*5.3*510 SEQ #427
Extracted from mail message
**KIDS**:SD*5.3*510^

**INSTALL NAME**
SD*5.3*510
"BLD",7249,0)
SD*5.3*510^SCHEDULING^0^3071121^y
"BLD",7249,1,0)
^^3^3^3070507^
"BLD",7249,1,1,0)
Outpatient Encounter Workload Statistics report includes non-count clinic 
"BLD",7249,1,2,0)
encounters and it should not.  There is also a fix to the Trend of 
"BLD",7249,1,3,0)
Facility Uniques by 12 Month report for an <Undefined> error.
"BLD",7249,4,0)
^9.64PA^^
"BLD",7249,6.3)
3
"BLD",7249,"ABPKG")
n
"BLD",7249,"KRN",0)
^9.67PA^8989.52^19
"BLD",7249,"KRN",.4,0)
.4
"BLD",7249,"KRN",.401,0)
.401
"BLD",7249,"KRN",.402,0)
.402
"BLD",7249,"KRN",.403,0)
.403
"BLD",7249,"KRN",.5,0)
.5
"BLD",7249,"KRN",.84,0)
.84
"BLD",7249,"KRN",3.6,0)
3.6
"BLD",7249,"KRN",3.8,0)
3.8
"BLD",7249,"KRN",9.2,0)
9.2
"BLD",7249,"KRN",9.8,0)
9.8
"BLD",7249,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",7249,"KRN",9.8,"NM",1,0)
SCRPW6^^0^B35815887
"BLD",7249,"KRN",9.8,"NM",2,0)
SCRPW8^^0^B71377994
"BLD",7249,"KRN",9.8,"NM",3,0)
SCRPW9^^0^B57569587
"BLD",7249,"KRN",9.8,"NM",4,0)
SCRPW24^^0^B81563044
"BLD",7249,"KRN",9.8,"NM","B","SCRPW24",4)

"BLD",7249,"KRN",9.8,"NM","B","SCRPW6",1)

"BLD",7249,"KRN",9.8,"NM","B","SCRPW8",2)

"BLD",7249,"KRN",9.8,"NM","B","SCRPW9",3)

"BLD",7249,"KRN",19,0)
19
"BLD",7249,"KRN",19.1,0)
19.1
"BLD",7249,"KRN",101,0)
101
"BLD",7249,"KRN",409.61,0)
409.61
"BLD",7249,"KRN",771,0)
771
"BLD",7249,"KRN",870,0)
870
"BLD",7249,"KRN",8989.51,0)
8989.51
"BLD",7249,"KRN",8989.52,0)
8989.52
"BLD",7249,"KRN",8994,0)
8994
"BLD",7249,"KRN","B",.4,.4)

"BLD",7249,"KRN","B",.401,.401)

"BLD",7249,"KRN","B",.402,.402)

"BLD",7249,"KRN","B",.403,.403)

"BLD",7249,"KRN","B",.5,.5)

"BLD",7249,"KRN","B",.84,.84)

"BLD",7249,"KRN","B",3.6,3.6)

"BLD",7249,"KRN","B",3.8,3.8)

"BLD",7249,"KRN","B",9.2,9.2)

"BLD",7249,"KRN","B",9.8,9.8)

"BLD",7249,"KRN","B",19,19)

"BLD",7249,"KRN","B",19.1,19.1)

"BLD",7249,"KRN","B",101,101)

"BLD",7249,"KRN","B",409.61,409.61)

"BLD",7249,"KRN","B",771,771)

"BLD",7249,"KRN","B",870,870)

"BLD",7249,"KRN","B",8989.51,8989.51)

"BLD",7249,"KRN","B",8989.52,8989.52)

"BLD",7249,"KRN","B",8994,8994)

"BLD",7249,"QUES",0)
^9.62^^
"BLD",7249,"REQB",0)
^9.611^2^2
"BLD",7249,"REQB",1,0)
SD*5.3*351^2
"BLD",7249,"REQB",2,0)
SD*5.3*466^2
"BLD",7249,"REQB","B","SD*5.3*351",1)

"BLD",7249,"REQB","B","SD*5.3*466",2)

"MBREQ")
0
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813
"PKG",16,22,1,"PAH",1,0)
510^3071121
"PKG",16,22,1,"PAH",1,1,0)
^^3^3^3071121
"PKG",16,22,1,"PAH",1,1,1,0)
Outpatient Encounter Workload Statistics report includes non-count clinic 
"PKG",16,22,1,"PAH",1,1,2,0)
encounters and it should not.  There is also a fix to the Trend of 
"PKG",16,22,1,"PAH",1,1,3,0)
Facility Uniques by 12 Month report for an <Undefined> error.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","SCRPW24")
0^4^B81563044^B79231987
"RTN","SCRPW24",1,0)
SCRPW24 ;RENO/KEITH - ACRP Ad Hoc Report (cont.) ;06/19/99
"RTN","SCRPW24",2,0)
 ;;5.3;Scheduling;**144,163,180,254,243,295,329,351,510**;AUG 13, 1993;Build 3
"RTN","SCRPW24",3,0)
 ;06/19/99 ACS - Added CPT modifier API calls
"RTN","SCRPW24",4,0)
 ;
"RTN","SCRPW24",5,0)
 ;11/26/03 RLC - 329 fixes primary/secondary dx problem with report
"RTN","SCRPW24",6,0)
 ;
"RTN","SCRPW24",7,0)
APAC(SDX) ;Get all procedure codes
"RTN","SCRPW24",8,0)
 ;K SDX N SDY,SDI D GETCPT^SDOE(SDOE,"SDY") S SDI=0 F  S SDI=$O(SDY(SDI)) Q:'SDI  S SDX=$P(SDY(SDI),U),SDX=SDX_U_$P($G(^ICPT(+SDX,0)),U)_U_$P(SDY(SDI),U,16) I $L($P(SDX,U,2)) D APOTR S SDX(SDI)=SDX
"RTN","SCRPW24",9,0)
 D APAC^SCRPW241(.SDX)
"RTN","SCRPW24",10,0)
 D NX Q
"RTN","SCRPW24",11,0)
 ;
"RTN","SCRPW24",12,0)
APOTR ;Transform procedure external value
"RTN","SCRPW24",13,0)
 ;S $P(SDX,U,2)=$P(SDX,U,2)_" "_$P(^ICPT(+SDX,0),U,2) Q
"RTN","SCRPW24",14,0)
 D APOTR^SCRPW241(.SDX)
"RTN","SCRPW24",15,0)
 Q
"RTN","SCRPW24",16,0)
 ;
"RTN","SCRPW24",17,0)
APAP(SDX) ;Get ambulatory procedures (no E&M codes)
"RTN","SCRPW24",18,0)
 ;K SDX N SDY,SDI D GETCPT^SDOE(SDOE,"SDY") S SDI=0 F  S SDI=$O(SDY(SDI)) Q:'SDI  S SDX=$P(SDY(SDI),U) I '$D(^IBE(357.69,"B",SDX)) S SDX=SDX_U_$P($G(^ICPT(+SDX,0)),U) I $L($P(SDX,U,2)) D APOTR S SDX(SDI)=SDX
"RTN","SCRPW24",19,0)
 D APAP^SCRPW241(.SDX)
"RTN","SCRPW24",20,0)
 D NX Q
"RTN","SCRPW24",21,0)
 ;
"RTN","SCRPW24",22,0)
APEM(SDX) ;Get evaluation and management codes
"RTN","SCRPW24",23,0)
 ;K SDX N SDY,SDI D GETCPT^SDOE(SDOE,"SDY") S SDI=0 F  S SDI=$O(SDY(SDI)) Q:'SDI  S SDX=$P(SDY(SDI),U) I $D(^IBE(357.69,"B",SDX)) S SDX=SDX_U_$P($G(^ICPT(+SDX,0)),U) I $L($P(SDX,U,2)) D APOTR S SDX(SDI)=SDX
"RTN","SCRPW24",24,0)
 D APEM^SCRPW241(.SDX)
"RTN","SCRPW24",25,0)
 D NX Q
"RTN","SCRPW24",26,0)
 ;
"RTN","SCRPW24",27,0)
CLCG(SDX) ;Get clinic group
"RTN","SCRPW24",28,0)
 K SDX S SDX=$P(SDOE0,U,4) I SDX S SDX=$P($G(^SC(SDX,0)),U,31) I SDX,$D(^SD(409.67,SDX)) S SDX=SDX_U_$P(^SD(409.67,SDX,0),U) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",29,0)
 D NX Q
"RTN","SCRPW24",30,0)
 ;
"RTN","SCRPW24",31,0)
CLCN(SDX) ;Get clinic name
"RTN","SCRPW24",32,0)
 K SDX S SDX=$P(SDOE0,U,4) I SDX S SDX=SDX_U_$P($G(^SC(SDX,0)),U) I $L($P(SDX,U,2)) S SDX(1)=SDX
"RTN","SCRPW24",33,0)
 D NX Q
"RTN","SCRPW24",34,0)
 ;
"RTN","SCRPW24",35,0)
CLCS(SDX) ;Get clinic service
"RTN","SCRPW24",36,0)
 K SDX S SDX=$P(SDOE0,U,4) I SDX S SDX=$P($G(^SC(SDX,0)),U,8) D FST(.SDX,44,9) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",37,0)
 D NX Q
"RTN","SCRPW24",38,0)
 ;
"RTN","SCRPW24",39,0)
DXAD(SDX) ;Get all diagnoses
"RTN","SCRPW24",40,0)
 K SDX N SDY,SDI D GETDX^SDOE(SDOE,"SDY") S SDI=0 F  S SDI=$O(SDY(SDI)) Q:'SDI  S SDX=$P(SDY(SDI),U) I SDX S SDX=SDX_U_$P($$ICDDX^ICDCODE(+SDX,+SDOE0),U,2) I $L($P(SDX,U,2)) D DXOTR S SDX(SDI)=SDX
"RTN","SCRPW24",41,0)
 D NX Q
"RTN","SCRPW24",42,0)
 ;
"RTN","SCRPW24",43,0)
DXOTR ;Transform diagnosis external value
"RTN","SCRPW24",44,0)
 N ENCDT
"RTN","SCRPW24",45,0)
 S ENCDT=+$G(SDOE0)
"RTN","SCRPW24",46,0)
 I 'ENCDT D
"RTN","SCRPW24",47,0)
 .I '$G(SDOE) S ENCDT=$$NOW^XLFDT() Q
"RTN","SCRPW24",48,0)
 .N SDY
"RTN","SCRPW24",49,0)
 .D GETGEN^SDOE(SDOE,"SDY")
"RTN","SCRPW24",50,0)
 .S ENCDT=+$G(SDY(0))
"RTN","SCRPW24",51,0)
 .K SDY
"RTN","SCRPW24",52,0)
 S SDX=SDX_" "_$P($$ICDDX^ICDCODE(+SDX,ENCDT),U,4) Q
"RTN","SCRPW24",53,0)
 ;
"RTN","SCRPW24",54,0)
DXGS(SDX,SDZ) ;Get GAF score
"RTN","SCRPW24",55,0)
 K SDX N SDI,SDY S SDY=$S(SDZ="H":$P($P(SDOE0,U),"."),1:DT)_.9999,SDY=9999999-SDY,SDY=$O(^YSD(627.8,"AX5",$P(SDOE0,U,2),SDY))
"RTN","SCRPW24",56,0)
 I SDY S SDI=$O(^YSD(627.8,"AX5",$P(SDOE0,U,2),SDY,""),-1) I SDI S SDX=+$P($G(^YSD(627.8,SDI,60)),U,3) I SDX S SDX(1)=SDX_U_SDX
"RTN","SCRPW24",57,0)
 D NX Q
"RTN","SCRPW24",58,0)
 ;
"RTN","SCRPW24",59,0)
DXGSQ(SDI) ;Set up GAF help text
"RTN","SCRPW24",60,0)
 S SDIRQ("?",1)="Specify a value representing the Global Assessment of Functioning (GAF) score."
"RTN","SCRPW24",61,0)
 I SDI="H" S SDIRQ("?")="Status as of the encounter date/time is used to determine 'historical' values."
"RTN","SCRPW24",62,0)
 I SDI="C" S SDIRQ("?")="Status as of the report run date is used to determine 'current' values."
"RTN","SCRPW24",63,0)
 Q
"RTN","SCRPW24",64,0)
 ;
"RTN","SCRPW24",65,0)
DXPD(SDX) ;Get primary diagnosis
"RTN","SCRPW24",66,0)
 ;K SDX N SDY,SDI D GETDX^SDOE(SDOE,"SDY") S SDI=0 F  S SDI=$O(SDY(SDI)) Q:'SDI  S SDX=$P(SDY(SDI),U) I SDX,$P(SDY(SDI),U,12)="P" S SDX=SDX_U_$P($$ICDDX^ICDCODE(+SDX),U,2) I $L($P(SDX,U,3)) D DXOTR S SDX(SDI)=SDX Q
"RTN","SCRPW24",67,0)
 ;SD*5.3*329 fixes problem of report not working for primary dx
"RTN","SCRPW24",68,0)
 K SDX N SDY,SDI D GETDX^SDOE(SDOE,"SDY") S SDI=0 F  S SDI=$O(SDY(SDI)) Q:'SDI  S SDX=$P(SDY(SDI),U) I SDX,$P(SDY(SDI),U,12)="P" S SDX=SDX_U_$P($$ICDDX^ICDCODE(+SDX,+SDOE0),U,2) I $L($P(SDX,U,2)) D DXOTR S SDX(SDI)=SDX
"RTN","SCRPW24",69,0)
 D NX Q
"RTN","SCRPW24",70,0)
 ;
"RTN","SCRPW24",71,0)
DXSD(SDX) ;Get secondary diagnoses
"RTN","SCRPW24",72,0)
 ;K SDX N SDY,SDI D GETDX^SDOE(SDOE,"SDY") S SDI=0 F  S SDI=$O(SDY(SDI)) Q:'SDI  S SDX=$P(SDY(SDI),U) I SDX,$P(SDY(SDI),U,12)'="P" S SDX=SDX_U_$P($$ICDDX^ICDCODE(+SDX),U,2) I $L($P(SDX,U,3)) D DXOTR S SDX(SDI)=SDX
"RTN","SCRPW24",73,0)
 ;SD*5.3*329 fixes problem of report not working for secondary dx
"RTN","SCRPW24",74,0)
 K SDX N SDY,SDI D GETDX^SDOE(SDOE,"SDY") S SDI=0 F  S SDI=$O(SDY(SDI)) Q:'SDI  S SDX=$P(SDY(SDI),U) I SDX,$P(SDY(SDI),U,12)'="P" S SDX=SDX_U_$P($$ICDDX^ICDCODE(+SDX,+SDOE0),U,2) I $L($P(SDX,U,2)) D DXOTR S SDX(SDI)=SDX
"RTN","SCRPW24",75,0)
 D NX Q
"RTN","SCRPW24",76,0)
 ;
"RTN","SCRPW24",77,0)
ENED(SDX,SDZ) ;Get enrollment date
"RTN","SCRPW24",78,0)
 K SDX N SDY S SDY=$$ENROL($S(SDZ="H":+SDOE0,1:DT)) I SDY S (SDX,Y)=$P(SDY,U) X ^DD("DD") S SDX(1)=SDX_U_Y
"RTN","SCRPW24",79,0)
 D NX Q
"RTN","SCRPW24",80,0)
 ;
"RTN","SCRPW24",81,0)
ENEF(SDX,SDZ) ;Get enrollment effective date
"RTN","SCRPW24",82,0)
 K SDX N SDY S SDY=$$ENROL($S(SDZ="H":+SDOE0,1:DT)) I SDY S (SDX,Y)=$P(SDY,U,8) X ^DD("DD") S SDX(1)=SDX_U_Y
"RTN","SCRPW24",83,0)
 D NX Q
"RTN","SCRPW24",84,0)
 ;
"RTN","SCRPW24",85,0)
ENEP(SDX,SDZ) ;Get enrollment priority
"RTN","SCRPW24",86,0)
 K SDX N SDY S SDY=$$ENROL($S(SDZ="H":+SDOE0,1:DT)) I SDY S SDX=$P(SDY,U,7) D FST(.SDX,27.11,.07) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",87,0)
 D NX Q
"RTN","SCRPW24",88,0)
 ;
"RTN","SCRPW24",89,0)
ENES(SDX,SDZ) ;Get enrollment status
"RTN","SCRPW24",90,0)
 K SDX N SDY S SDY=$$ENROL($S(SDZ="H":+SDOE0,1:DT)) I SDY S SDX=$P(SDY,U,4),SDX=SDX_U_$$EXTERNAL^DILFD(27.11,.04,"F",SDX) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",91,0)
 D NX Q
"RTN","SCRPW24",92,0)
 ;
"RTN","SCRPW24",93,0)
ENFR(SDX,SDZ) ;Get enrollment facility received
"RTN","SCRPW24",94,0)
 K SDX N SDY S SDY=$$ENROL($S(SDZ="H":+SDOE0,1:DT)) I SDY S SDX=$P(SDY,U,6) I SDX S SDX=SDX_U_$P($G(^DIC(4,SDX,0)),U) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",95,0)
 D NX Q
"RTN","SCRPW24",96,0)
 ;
"RTN","SCRPW24",97,0)
ENSE(SDX,SDZ) ;Get enrollment source of enrollment
"RTN","SCRPW24",98,0)
 K SDX N SDY S SDY=$$ENROL($S(SDZ="H":+SDOE0,1:DT)) I SDY S SDX=$P(SDY,U,3) D FST(.SDX,27.11,.03) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",99,0)
 D NX Q
"RTN","SCRPW24",100,0)
 ;
"RTN","SCRPW24",101,0)
ENQ(SDZ) ;Set up help text for enrollment
"RTN","SCRPW24",102,0)
 I SDZ="H" S SDIRQ("?")="Enrollment status as of the encounter date/time is used for 'historical' values."
"RTN","SCRPW24",103,0)
 I SDZ="C" S SDIRQ("?")="Enrollment status as of the report run date is used for 'current' values."
"RTN","SCRPW24",104,0)
 Q
"RTN","SCRPW24",105,0)
 ;
"RTN","SCRPW24",106,0)
OEAT(SDX) ;Get encounter appointment type
"RTN","SCRPW24",107,0)
 K SDX S SDX=$P(SDOE0,U,10) I SDX S SDX=SDX_U_$P($G(^SD(409.1,SDX,0)),U) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",108,0)
 D NX Q
"RTN","SCRPW24",109,0)
 ;
"RTN","SCRPW24",110,0)
OEDV(SDX) ;Get encounter division
"RTN","SCRPW24",111,0)
 K SDX S SDX=$P(SDOE0,U,11) I SDX S SDX=SDX_U_$P($G(^DG(40.8,SDX,0)),U) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",112,0)
 D NX Q
"RTN","SCRPW24",113,0)
 ;
"RTN","SCRPW24",114,0)
OEEE(SDX) ;Get encounter eligibility
"RTN","SCRPW24",115,0)
 K SDX S SDX=$P(SDOE0,U,13) I SDX S SDX=SDX_U_$P($G(^DIC(8,SDX,0)),U) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",116,0)
 D NX Q
"RTN","SCRPW24",117,0)
 ;
"RTN","SCRPW24",118,0)
OEOP(SDX) ;Get encounter originating process type
"RTN","SCRPW24",119,0)
 K SDX S SDX=$P(SDOE0,U,8) D FST(.SDX,409.68,.08) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",120,0)
 D NX Q
"RTN","SCRPW24",121,0)
 ;
"RTN","SCRPW24",122,0)
OEPA(SDX) ;Get encounter patient
"RTN","SCRPW24",123,0)
 K SDX S DFN=$P(SDOE0,U,2) I DFN D DEM^VADPT I $L(VADM(1)) S SDX(1)=DFN_U_VADM(1)
"RTN","SCRPW24",124,0)
 D NX Q
"RTN","SCRPW24",125,0)
 ;
"RTN","SCRPW24",126,0)
OEES(SDX) ;Get encounter status
"RTN","SCRPW24",127,0)
 K SDX S SDX=$P(SDOE0,U,12) I SDX S SDX=SDX_U_$P($G(^SD(409.63,SDX,0)),U) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",128,0)
 D NX Q
"RTN","SCRPW24",129,0)
 ;
"RTN","SCRPW24",130,0)
OETS(SDX) ;Get transmission status
"RTN","SCRPW24",131,0)
 K SDX S SDX(1)=$$STX^SCRPW8(SDOE,SDOE0) Q
"RTN","SCRPW24",132,0)
 ;
"RTN","SCRPW24",133,0)
TSQ(DIR) ;Set up DIR array for transmission status question
"RTN","SCRPW24",134,0)
 K DIR S DIR("A")="Select transmission status",DIR("?")="This value represents the transmission status of the encounter record."
"RTN","SCRPW24",135,0)
 S DIR(0)="SO^0:Not checked-out;1:No transmission record;2:Not required, not transmitted;3:Rejected for transmission;4:Awaiting transmission;5:Transmitted, no acknowledgment;6:Transmitted, rejected;7:Transmitted, error;8:Transmitted, accepted"
"RTN","SCRPW24",136,0)
 Q
"RTN","SCRPW24",137,0)
 ;
"RTN","SCRPW24",138,0)
CLQ(DIR,SDZ) ;Set up DIR array for classification questions
"RTN","SCRPW24",139,0)
 K DIR S SDZ=$S(SDZ="A":"Agent Orange exposure",SDZ="I":"ionizing radiation exposure",SDZ="S":"service connected condition",1:"environmental contaminants exposure")
"RTN","SCRPW24",140,0)
 S DIR(0)="SO^1:YES;0:NO",DIR("A")="Treatment related to "_SDZ,DIR("?")="Indicates if treatment was related to "_SDZ Q
"RTN","SCRPW24",141,0)
 ;
"RTN","SCRPW24",142,0)
OECL(SDX,SDZ) ;Get classification values
"RTN","SCRPW24",143,0)
 K SDX N SDY S SDZ=$S(SDZ="A":1,SDZ="I":2,SDZ="S":3,SDZ="E":4,1:"") I SDZ D CLASK^SDCO2(SDOE,.SDY) S SDX=$P($G(SDY(SDZ)),U,2) I $L(SDX) S SDX(1)=$S(SDX=1:"1^YES",1:"0^NO")
"RTN","SCRPW24",144,0)
 D NX Q
"RTN","SCRPW24",145,0)
 ;
"RTN","SCRPW24",146,0)
OEOU(SDX) ;Get option used to create
"RTN","SCRPW24",147,0)
 K SDX S SDX=+$P(SDOE0,U,5),SDX=+$P($G(^AUPNVSIT(SDX,0)),U,24)
"RTN","SCRPW24",148,0)
 N SDY D GETS^DIQ(19,SDX,.01,"","SDY")
"RTN","SCRPW24",149,0)
 S SDX=SDX_U_SDY(19,SDX_",",.01) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",150,0)
 D NX Q
"RTN","SCRPW24",151,0)
 ;
"RTN","SCRPW24",152,0)
SUQ(DIR) ;Set up DIR() array for Scheduled/unscheduled question
"RTN","SCRPW24",153,0)
 K DIR S DIR("A")="Select outpatient activity type",DIR("?",1)="Only pre-scheduled appointments will be reflected as SCHEDULED.  All other",DIR("?",2)="types of activity (add/edits, registrations, walkins or unscheduled activity)"
"RTN","SCRPW24",154,0)
 S DIR("?")="will be reflected as UNSCHEDULED.",DIR(0)="SO^S:SCHEDULED;U:UNSCHEDULED" Q
"RTN","SCRPW24",155,0)
 ;
"RTN","SCRPW24",156,0)
OESU(SDX) ;Get scheduled/unscheduled status
"RTN","SCRPW24",157,0)
 N SDAP0 K SDX S SDX(1)=""
"RTN","SCRPW24",158,0)
 I $P(SDOE0,U,8)=1 D  Q:$L(SDX(1))
"RTN","SCRPW24",159,0)
 .S SDAP0=$G(^DPT(+$P(SDOE0,U,2),"S",+SDOE0,0))
"RTN","SCRPW24",160,0)
 .Q:$P(SDAP0,U,20)'=SDOE  Q:$P(SDAP0,U,7)=4
"RTN","SCRPW24",161,0)
 .S SDX(1)="S^SCHEDULED" Q
"RTN","SCRPW24",162,0)
 S SDX(1)="U^UNSCHEDULED" Q
"RTN","SCRPW24",163,0)
 ;
"RTN","SCRPW24",164,0)
PCPR(SDX,SDZ) ;Get primary care provider
"RTN","SCRPW24",165,0)
 ;Required input: SDZ="C" for current, "H" for historical
"RTN","SCRPW24",166,0)
 K SDX S SDX=$S(SDZ="C":$$OUTPTPR^SDUTL3(+$P(SDOE0,U,2)),1:$$OUTPTPR^SDUTL3(+$P(SDOE0,U,2),+$P(SDOE0,U))) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",167,0)
 D NX Q
"RTN","SCRPW24",168,0)
 ;
"RTN","SCRPW24",169,0)
PCTM(SDX,SDZ) ;Get priamry care team
"RTN","SCRPW24",170,0)
 ;Required input: SDZ="C" for current, "H" for historical
"RTN","SCRPW24",171,0)
 K SDX S SDX=$S(SDZ="C":$$OUTPTTM^SDUTL3(+$P(SDOE0,U,2)),1:$$OUTPTTM^SDUTL3(+$P(SDOE0,U,2),+$P(SDOE0,U))) S:$L($P(SDX,U,2)) SDX(1)=SDX
"RTN","SCRPW24",172,0)
 D NX Q
"RTN","SCRPW24",173,0)
 ;
"RTN","SCRPW24",174,0)
PDPA(SDX) ;Get patient age
"RTN","SCRPW24",175,0)
 K SDX S DFN=$P(SDOE0,U,2) I DFN D DEM^VADPT I VADM(4)=+VADM(4) S SDX(1)=VADM(4)_U_VADM(4)
"RTN","SCRPW24",176,0)
 D NX Q
"RTN","SCRPW24",177,0)
 ;
"RTN","SCRPW24",178,0)
PDPS(SDX) ;Get patient sex
"RTN","SCRPW24",179,0)
 K SDX S DFN=$P(SDOE0,U,2) I DFN D DEM^VADPT I $L($P(VADM(5),U,2)) S SDX(1)=VADM(5)
"RTN","SCRPW24",180,0)
 D NX Q
"RTN","SCRPW24",181,0)
 ;
"RTN","SCRPW24",182,0)
PDSC(SDX) ;Get patient state/county
"RTN","SCRPW24",183,0)
 K SDX S DFN=$P(SDOE0,U,2) I DFN D ADD^VADPT I $L($P(VAPA(7),U,2)) S SDX(1)=$P(VAPA(5),U)_";"_$P(VAPA(7),U)_U_$P(VAPA(5),U,2)_" / "_$P(VAPA(7),U,2)
"RTN","SCRPW24",184,0)
 D NX Q
"RTN","SCRPW24",185,0)
 ;
"RTN","SCRPW24",186,0)
PDZC(SDX) ;Get patient zip code
"RTN","SCRPW24",187,0)
 K SDX S DFN=$P(SDOE0,U,2) I DFN D ADD^VADPT I $L(VAPA(6)) S SDX(1)=VAPA(6)_U_VAPA(6)
"RTN","SCRPW24",188,0)
 D NX Q
"RTN","SCRPW24",189,0)
 ;
"RTN","SCRPW24",190,0)
ENROL(SDATE)  ;Get enrollment record (most recent to encounter date)
"RTN","SCRPW24",191,0)
 N SDY,SDI,X1,X2,X,%Y S:SDATE#1=0 SDATE=SDATE+.9999 S SDI=0 F  S SDI=$O(^DGEN(27.11,"C",+$P(SDOE0,U,2),SDI)) Q:'SDI  S SDY=$G(^DGEN(27.11,SDI,0)),SDY($P($P(^DGEN(27.11,SDI,"U"),U,1),".",1))=SDY  ;SD/510 changed logic to use date/time entered
"RTN","SCRPW24",192,0)
 S SDI=$O(SDY(SDATE),-1) Q:'SDI ""  S X1=$P($P(SDOE0,U),"."),X2=SDI D ^%DTC Q SDY(SDI)
"RTN","SCRPW24",193,0)
 ;
"RTN","SCRPW24",194,0)
NX S:$D(SDX)<10 SDX(1)="~~~NONE~~~^~~~NONE~~~" Q
"RTN","SCRPW24",195,0)
 ;
"RTN","SCRPW24",196,0)
FST(SDX,SDFI,SDFE) ;Field set transform
"RTN","SCRPW24",197,0)
 Q:'$L(SDX)  N SDY,SDI D FIELD^DID(SDFI,SDFE,"","POINTER","SDY") S SDY=SDY("POINTER") F SDI=1:1:$L(SDY,";") I SDX=$P($P(SDY,";",SDI),":") S SDX=SDX_U_$P($P(SDY,";",SDI),":",2) Q
"RTN","SCRPW24",198,0)
 Q
"RTN","SCRPW6")
0^1^B35815887^B35810056
"RTN","SCRPW6",1,0)
SCRPW6 ;RENO/KEITH - Trend of Facility Uniques by 12 Month Date Ranges ; 15 Jul 98  02:38PM
"RTN","SCRPW6",2,0)
 ;;5.3;Scheduling;**139,144,466,510**;AUG 13, 1993;Build 3
"RTN","SCRPW6",3,0)
 N SDDIV,SDI,SDSTA,DIR D TITL^SCRPW50("Trend of Facility Uniques by 12 Month Date Ranges") G:'$$DIVA^SCRPW17(.SDDIV) EXIT
"RTN","SCRPW6",4,0)
 D SUBT^SCRPW50("**** Status Selection ****")
"RTN","SCRPW6",5,0)
 S DIR(0)="S^1:Checked Out (Outpatients);2:Checked Out (Inpatients);3:Checked Out (Out/Inpatients)",DIR("A")="Select Status",DIR("B")="1"
"RTN","SCRPW6",6,0)
 D ^DIR I $D(DTOUT)!$D(DUOUT)!(+Y<0) G EXIT
"RTN","SCRPW6",7,0)
 S SDSTA=$S(Y=1:2,Y=2:8,1:"2^8")
"RTN","SCRPW6",8,0)
QUE W !!,"This report requires 132 column output.",!
"RTN","SCRPW6",9,0)
 N ZTSAVE F X="SDDIV","SDDIV(","SDDNU(","SDSTA" S ZTSAVE(X)=""
"RTN","SCRPW6",10,0)
 D EN^XUTMDEVQ("UNIQ^SCRPW6","Trend Facility Uniques",.ZTSAVE),DISP0^SCRPW23 Q
"RTN","SCRPW6",11,0)
UNIQ ;Calculate/print uniques
"RTN","SCRPW6",12,0)
 S (SDOUT,SDSTOP)=0,SDLINE="",SDPAGE=1,$P(SDLINE,"-",133)="" D NOW^%DTC S Y=% X ^DD("DD") S SDPNOW=$P(Y,":",1,2),SDMD=$O(SDDIV(0)),SDMD=$O(SDDIV(SDMD)) S:$P(SDDIV,U,2)="ALL DIVISIONS" SDMD=1
"RTN","SCRPW6",13,0)
 K ^TMP("SCRPW",$J) S SDBDT=$E(DT,1,3)-5_$E(DT,4,5)_"00",SDEDT=$E(DT,1,5)_"00",SDXEDT=$E(DT,1,3)-1_$E(DT,4,5)_"00" D OENC G:SDOUT EXIT
"RTN","SCRPW6",14,0)
 S SDIV="" F  S SDIV=$O(^TMP("SCRPW",$J,SDIV)) Q:SDIV=""  D STOP Q:SDOUT  D
"RTN","SCRPW6",15,0)
 .S SDDT=SDBDT,SDXDT=$$YDTINC(SDDT),^TMP("SCRPW",$J,SDIV,"YR","MAX")=0 D LOOK
"RTN","SCRPW6",16,0)
 .F  S SDDT=$$DTINC(SDDT) Q:SDDT>SDXEDT  S SDXDT=$$YDTINC(SDDT) D LOOK I ^TMP("SCRPW",$J,SDIV,"YR",SDDT)>^TMP("SCRPW",$J,SDIV,"YR","MAX") S ^TMP("SCRPW",$J,SDIV,"YR","MAX")=^TMP("SCRPW",$J,SDIV,"YR",SDDT)
"RTN","SCRPW6",17,0)
 G:SDOUT EXIT D:$E(IOST)="C" DISP0^SCRPW23 I '$D(^TMP("SCRPW",$J)) D HDR G:SDOUT EXIT S SDX="No activity found within selected report parameters!" W !!?(IOM-$L(SDX)\2),SDX G EXIT
"RTN","SCRPW6",18,0)
 I $P(SDDIV,U,2)="SELECTED DIVISIONS" D
"RTN","SCRPW6",19,0)
 .S SDI=0 F  S SDI=$O(SDDIV(SDI)) Q:'SDI  S SDIV(SDDIV(SDI))=SDI
"RTN","SCRPW6",20,0)
 .Q
"RTN","SCRPW6",21,0)
 I $P(SDDIV,U,2)="ALL DIVISIONS" D
"RTN","SCRPW6",22,0)
 .S SDI=0 F  S SDI=$O(^TMP("SCRPW",$J,SDI)) Q:'SDI  S SDX=$P($G(^DG(40.8,SDI,0)),U) S:'$L(SDX) SDX="***UNKNOWN***" S SDIV(SDX)=SDI
"RTN","SCRPW6",23,0)
 .Q
"RTN","SCRPW6",24,0)
 S:$D(SDIV)'>1 SDIV($P(SDDIV,U,2))=$P(SDDIV,U,3)
"RTN","SCRPW6",25,0)
 G:SDOUT EXIT D:$E(IOST)="C" DISP0^SCRPW23 S SDIVN="" F  S SDIVN=$O(SDIV(SDIVN)) Q:SDIVN=""!SDOUT  S SDIV=SDIV(SDIVN) D DPRT(.SDIV)
"RTN","SCRPW6",26,0)
 G:SDOUT EXIT S SDMD=0,SDMD=$O(^TMP("SCRPW",$J,SDMD)),SDMD=$O(^TMP("SCRPW",$J,SDMD)) I SDMD S SDIV=0 D DPRT(.SDIV)
"RTN","SCRPW6",27,0)
 I $E(IOST)="C",'SDOUT W ! N DIR S DIR(0)="E" D ^DIR
"RTN","SCRPW6",28,0)
 ;
"RTN","SCRPW6",29,0)
EXIT K SDIV,SDIVN,SDMD,SDOUT,SDSTOP,SDDIV,SDBDT,SDCT,SDDFN,SDDT,SDEDT,SDFIG,SDI,SDLINE,SDMAX,SDMO,SDOE,SDOE0,SDPAGE,SDPNOW,SDXDT,SDXEDT,SDXMO,SDXYR,SDYR,Y,%,SDX,SDFIG1,DTOUT,DUOUT,X,Y D END^SCRPW50 Q
"RTN","SCRPW6",30,0)
 ;
"RTN","SCRPW6",31,0)
DPRT(SDIV) ;Print division
"RTN","SCRPW6",32,0)
 K SDTIT D DHDR^SCRPW46(SDIV,1,.SDTIT) I '$D(^TMP("SCRPW",$J,SDIV)) S SDX="No activity within report parameters found for this division!" D HDR Q:SDOUT  W !!?(IOM-$L(SDX)\2),SDX Q
"RTN","SCRPW6",33,0)
 S SDDT=SDBDT D FIG,HDR,HD1 Q:SDOUT  D LINE(SDDT) F  S SDDT=$O(^TMP("SCRPW",$J,SDIV,"YR",SDDT)) Q:'SDDT!SDOUT  D LINE(SDDT)
"RTN","SCRPW6",34,0)
 D:$Y>($S(IOSL<80:IOSL,1:80)-5) HDR Q:SDOUT  F  W ! Q:$Y>($S(IOSL<80:IOSL,1:80)-6)
"RTN","SCRPW6",35,0)
 W !?25,"Uniques in this report are based on OUTPATIENT ENCOUNTER file records with a"
"RTN","SCRPW6",36,0)
 W !?25,"status of '"_$S(SDSTA=2:"",SDSTA=8:"inpatient appointment ",1:"Out/Inpatient ")_"checked out'.  This excludes any 'action required' activity."
"RTN","SCRPW6",37,0)
 Q
"RTN","SCRPW6",38,0)
 ;
"RTN","SCRPW6",39,0)
DIV(SDD) ;Check division
"RTN","SCRPW6",40,0)
 ;Required input: MEDICAL CENTER DIVISION pointer
"RTN","SCRPW6",41,0)
 Q:'SDDIV 1
"RTN","SCRPW6",42,0)
 Q $D(SDDIV(SDD))
"RTN","SCRPW6",43,0)
 ;
"RTN","SCRPW6",44,0)
SET(SDIV) ;Set TMP global
"RTN","SCRPW6",45,0)
 S SDSTOP=SDSTOP+1 D:SDSTOP#2000=0 STOP Q:SDOUT
"RTN","SCRPW6",46,0)
 Q:'SDIV  D SET1(SDIV) D:SDMD SET1(0) Q
"RTN","SCRPW6",47,0)
 ;
"RTN","SCRPW6",48,0)
SET1(SDIV) S ^TMP("SCRPW",$J,SDIV,"PT",SDDFN,$E(SDDT,1,5)_"00")="" Q
"RTN","SCRPW6",49,0)
 ;
"RTN","SCRPW6",50,0)
OENC S SDXDT=SDBDT,SDDFN=0
"RTN","SCRPW6",51,0)
 F  S SDDFN=$O(^SCE("ADFN",SDDFN)) Q:'SDDFN  S SDDT=SDXDT F  S SDDT=$O(^SCE("ADFN",SDDFN,SDDT)) Q:'SDDT!(SDDT>SDEDT)  D OENC1
"RTN","SCRPW6",52,0)
 Q
"RTN","SCRPW6",53,0)
 ;
"RTN","SCRPW6",54,0)
OENC1 S SDOE=0 F  S SDOE=$O(^SCE("ADFN",SDDFN,SDDT,SDOE)) Q:'SDOE  S SDOE0=$$GETOE^SDOE(SDOE) I $$OE(SDOE0,SDSTA) S SDIV=$P(SDOE0,U,11) I SDIV,$$DIV(SDIV) D SET(SDIV)
"RTN","SCRPW6",55,0)
 Q
"RTN","SCRPW6",56,0)
 ;
"RTN","SCRPW6",57,0)
OE(SDOE0,SDSTA) ;Evaluate (in)outpatient encounter
"RTN","SCRPW6",58,0)
 ;Required input: SDOE0=OUTPATIENT ENCOUNTER zeroeth node
"RTN","SCRPW6",59,0)
 ;                SDSTA=2 -outpatient,8 -inpatient, 2^8 -both
"RTN","SCRPW6",60,0)
 ;Output: '1' if checked out "parent" encounter, '0' otherwise
"RTN","SCRPW6",61,0)
 I $P(SDOE0,U,4),$P($G(^SC($P(SDOE0,U,4),0)),U,17)="Y" Q 0
"RTN","SCRPW6",62,0)
 S SDSTA=$G(SDSTA,2),SDSTA="^"_SDSTA_"^"
"RTN","SCRPW6",63,0)
 Q:'$P(SDOE0,U,6)&(SDSTA[$P(SDOE0,U,12))&($P(SDOE0,U,7)'="") 1
"RTN","SCRPW6",64,0)
 Q 0
"RTN","SCRPW6",65,0)
 ;
"RTN","SCRPW6",66,0)
STOP ;Check for stop task request
"RTN","SCRPW6",67,0)
 S:$G(ZTQUEUED) (SDOUT,ZTSTOP)=$S($$S^%ZTLOAD:1,1:0) Q
"RTN","SCRPW6",68,0)
 ;
"RTN","SCRPW6",69,0)
HDR D STOP Q:SDOUT  I $E(IOST)="C" N DIR S DIR(0)="E" D ^DIR S SDOUT=Y'=1 Q:SDOUT
"RTN","SCRPW6",70,0)
 W:SDPAGE>1!($E(IOST)="C") $$XY^SCRPW50(IOF,1,0) W:$X $$XY^SCRPW50("",0,0) W SDLINE,!?36,"<*>  TREND OF FACILITY UNIQUES BY 12 MONTH DATE RANGES  <*>"
"RTN","SCRPW6",71,0)
 N SDI S SDI=$S(SDSTA=2:"Checked Out - Outpatients",SDSTA=8:"Checked Out - Inpatients",1:"Checked Out - Out/Inpatients") W !,?53,SDI ;?(132-SDI\2),SDI
"RTN","SCRPW6",72,0)
 S SDI=0 F  S SDI=$O(SDTIT(SDI)) Q:'SDI  W !?(132-$L(SDTIT(SDI))\2),SDTIT(SDI)
"RTN","SCRPW6",73,0)
 W !,SDLINE,!,"Date printed: ",SDPNOW,?125,"Page: ",SDPAGE,!,SDLINE S SDPAGE=SDPAGE+1 Q
"RTN","SCRPW6",74,0)
 ;
"RTN","SCRPW6",75,0)
HD1 Q:SDOUT  W !!,"12 mo. date range",?23,"Uniques",?32,"| Histogram (each ""*"" equals ",SDFIG," unique",$S(SDFIG=1:"",1:"s"),")",!,$E(SDLINE,1,SDFIG1) Q
"RTN","SCRPW6",76,0)
 ;
"RTN","SCRPW6",77,0)
DTINC(SDDT) ;Increment date by one month
"RTN","SCRPW6",78,0)
 ;Required input: SDDT=date
"RTN","SCRPW6",79,0)
 ;Output: next month to examine
"RTN","SCRPW6",80,0)
 Q:$E(SDDT,4,5)=12 $E(SDDT,1,3)+1_"0100"
"RTN","SCRPW6",81,0)
 Q $E(SDDT,1,5)+1_"00"
"RTN","SCRPW6",82,0)
 ;
"RTN","SCRPW6",83,0)
LOOK S ^TMP("SCRPW",$J,SDIV,"YR",SDDT)=0,SDDFN=0 F  S SDDFN=$O(^TMP("SCRPW",$J,SDIV,"PT",SDDFN)) Q:'SDDFN  D L1
"RTN","SCRPW6",84,0)
 Q
"RTN","SCRPW6",85,0)
 ;
"RTN","SCRPW6",86,0)
L1 I $D(^TMP("SCRPW",$J,SDIV,"PT",SDDFN,SDDT)) D LSET Q
"RTN","SCRPW6",87,0)
 S SDX=$O(^TMP("SCRPW",$J,SDIV,"PT",SDDFN,SDDT)) I SDX,SDX<SDXDT D LSET
"RTN","SCRPW6",88,0)
 Q
"RTN","SCRPW6",89,0)
 ;
"RTN","SCRPW6",90,0)
LSET S ^TMP("SCRPW",$J,SDIV,"YR",SDDT)=^TMP("SCRPW",$J,SDIV,"YR",SDDT)+1 Q
"RTN","SCRPW6",91,0)
 ;
"RTN","SCRPW6",92,0)
YDTINC(SDDT) ;Increment date by one year
"RTN","SCRPW6",93,0)
 ;Required input: SDDT=date
"RTN","SCRPW6",94,0)
 ;Output: date + 1 year
"RTN","SCRPW6",95,0)
 Q $E(SDDT,1,3)+1_$E(SDDT,4,7)
"RTN","SCRPW6",96,0)
 ;
"RTN","SCRPW6",97,0)
FIG S SDMAX=^TMP("SCRPW",$J,SDIV,"YR","MAX") F SDFIG=1,10,25,50,100,250,500,1000,2500,5000,10000 Q:SDMAX/SDFIG<99
"RTN","SCRPW6",98,0)
 S SDFIG1=34+(SDMAX\SDFIG) S:SDFIG1<73 SDFIG1=73 Q
"RTN","SCRPW6",99,0)
 ;
"RTN","SCRPW6",100,0)
LINE(SDDT) ;Print statistics line
"RTN","SCRPW6",101,0)
 ;Required input: SDDT=date
"RTN","SCRPW6",102,0)
 D:$Y>(IOSL-3) HDR,HD1 Q:SDOUT  S SDCT=^TMP("SCRPW",$J,SDIV,"YR",SDDT),SDMO=$E(SDDT,4,5),SDYR=(17+$E(SDDT))_$E(SDDT,2,3),SDXMO=SDMO-1 S:SDXMO=0 SDXMO=12 S:$L(SDXMO)=1 SDXMO=0_SDXMO
"RTN","SCRPW6",103,0)
 S SDXYR=$S(SDXMO=12:SDYR,1:SDYR+1)
"RTN","SCRPW6",104,0)
 W !,SDMO,"/",SDYR," thru ",SDXMO,"/",SDXYR,?24,$J(SDCT,6,0),?32,"| " F SDI=1:1:(SDCT\SDFIG) W "*"
"RTN","SCRPW6",105,0)
 Q
"RTN","SCRPW8")
0^2^B71377994^B65233961
"RTN","SCRPW8",1,0)
SCRPW8 ;RENO/KEITH - Outpatient Encounter Workload Statistics ; 04 Feb 99  4:53 PM
"RTN","SCRPW8",2,0)
 ;;5.3;Scheduling;**139,145,144,176,339,466,510**;AUG 13, 1993;Build 3
"RTN","SCRPW8",3,0)
QS ;Queue outpatient encounter workload report
"RTN","SCRPW8",4,0)
 D PARM^SCRPW9 Q
"RTN","SCRPW8",5,0)
 ;
"RTN","SCRPW8",6,0)
PST ;Print stats
"RTN","SCRPW8",7,0)
 N X,Y,%
"RTN","SCRPW8",8,0)
 D NOW^%DTC S Y=% X ^DD("DD") S SDPAGE=1,SDPNOW=$P(Y,":",1,2),SDDT=SDDTF,SDMC=$O(^DG(43,0)),SDMC=$G(^DG(43,+SDMC,"GL")),SDMD=$P(SDMC,U,2),(SDOUT,SDSTOP,SDFF)=0
"RTN","SCRPW8",9,0)
 S SDDNAM=$P($G(^DG(40.8,+$$PRIM^VASITE(),0)),U,7),SDDNAM=$$GET1^DIQ(4,+SDDNAM,.01) S:'$L(SDDNAM) SDDNAM=$P($G(^DG(40.8,+$P(SDMC,U,3),0)),U)
"RTN","SCRPW8",10,0)
 F I="SCRPW","SCRPWD","SCRPWC" K ^TMP(I,$J)
"RTN","SCRPW8",11,0)
 F  S SDDT=$O(^SCE("B",SDDT)) Q:'SDDT!(SDDT>SDDTL)!SDOUT  S SDOE=0 D
"RTN","SCRPW8",12,0)
 .F  S SDOE=$O(^SCE("B",SDDT,SDOE)) Q:'SDOE!SDOUT  S SDOE0=$$GETOE^SDOE(SDOE) I $L(SDOE0),'$P(SDOE0,U,6),$P(SDOE0,U,2),$P(SDOE0,U,11),$P(SDOE0,U,12) S SDDIV=$$DIV(),SDCG=$$CLGR() D COUNT
"RTN","SCRPW8",13,0)
 .Q
"RTN","SCRPW8",14,0)
 I '$D(^TMP("SCRPW",$J)) D XHDR S SDX="No activity found within the parameters specified." W !!?(80-$L(SDX)\2),SDX G EXIT
"RTN","SCRPW8",15,0)
 F SDS1="SCRPW","SCRPWD","SCRPWC" S SDS2="" F  S SDS2=$O(^TMP(SDS1,$J,SDS2)) Q:SDS2=""!SDOUT  D STCT
"RTN","SCRPW8",16,0)
 G:SDOUT EXIT D:$E(IOST)="C" DISP0^SCRPW23
"RTN","SCRPW8",17,0)
 F SDS1="SCRPW","SCRPWD","SCRPWC" S SDS2="" F  S SDS2=$O(^TMP(SDS1,$J,SDS2)) Q:SDS2=""!SDOUT  D PRPT
"RTN","SCRPW8",18,0)
 G:SDOUT EXIT
"RTN","SCRPW8",19,0)
 D:SDZ(0) DPRT^SCRPW9("SCRPW",SDDNAM) G:SDOUT EXIT D:SDUL UNARL^SCRPW9("SCRPW",SDDNAM) G EXIT
"RTN","SCRPW8",20,0)
 ;
"RTN","SCRPW8",21,0)
STCT S (SDUNCO,SDCT,DFN)=0 D STOP Q:SDOUT
"RTN","SCRPW8",22,0)
 F  S DFN=$O(^TMP(SDS1,$J,SDS2,"VISIT","ACC",DFN)) Q:'DFN  S SDUNCO=SDUNCO+1,SDDT=0 F  S SDDT=$O(^TMP(SDS1,$J,SDS2,"VISIT","ACC",DFN,SDDT)) Q:'SDDT  S SDCT=SDCT+1
"RTN","SCRPW8",23,0)
 S ^TMP(SDS1,$J,SDS2,"UNIQUE","UNCO")=SDUNCO,^TMP(SDS1,$J,SDS2,"VISIT","OWK")=SDCT,(SDUNAR,SDCT,DFN)=0
"RTN","SCRPW8",24,0)
 S DFN=0 F  S DFN=$O(^TMP(SDS1,$J,SDS2,"VISIT","OWK",DFN)) Q:'DFN  D NCT1
"RTN","SCRPW8",25,0)
 S DFN=0 F  S DFN=$O(^TMP(SDS1,$J,SDS2,"VISIT","NWK",DFN)) Q:'DFN  D CT1
"RTN","SCRPW8",26,0)
 S ^TMP(SDS1,$J,SDS2,"UNIQUE","UNAR")=SDUNAR,^TMP(SDS1,$J,SDS2,"VISIT","NWK")=SDCT Q
"RTN","SCRPW8",27,0)
 ;
"RTN","SCRPW8",28,0)
PRPT ;Print statistics page
"RTN","SCRPW8",29,0)
 D STOP Q:SDOUT
"RTN","SCRPW8",30,0)
 S SDCT=0 F SDI=1,2,3,11,14,"8-CC" S SDCT=SDCT+$G(^TMP(SDS1,$J,SDS2,SDI))
"RTN","SCRPW8",31,0)
 D XHDR Q:SDOUT  D SHDR("O U T P A T I E N T   E N C O U N T E R   W O R K L O A D") Q:SDOUT  F SDI=11,14,3,1 D LIST(SDI) Q:SDOUT
"RTN","SCRPW8",32,0)
 I $D(^TMP(SDS1,$J,SDS2,2)) D:$Y>(IOSL-4) XHDR Q:SDOUT  W !?10,"CHECKED OUT" S SDI=0 F  S SDI=$O(^TMP(SDS1,$J,SDS2,2,SDI)) Q:'SDI!SDOUT  S SDSTAT=$O(^TMP(SDS1,$J,SDS2,2,SDI,"")) D COT
"RTN","SCRPW8",33,0)
 I $D(^TMP(SDS1,$J,SDS2,"8-CC")) D:$Y>(IOSL-4) XHDR Q:SDOUT  W !?10,"INPATIENT APPOINTMENT" S SDI=0 F  S SDI=$O(^TMP(SDS1,$J,SDS2,"8-CC",SDI)) Q:'SDI!SDOUT  S SDSTAT=$O(^TMP(SDS1,$J,SDS2,"8-CC",SDI,"")) D IAP
"RTN","SCRPW8",34,0)
 D TOT S (SDI,SDCT)=0 F SDI=4,5,6,7,"8-NC",9,12,13 S SDCT=SDCT+$G(^TMP(SDS1,$J,SDS2,SDI))
"RTN","SCRPW8",35,0)
 W !! D SHDR("N O N - W O R K L O A D") Q:SDOUT  F SDI="8-NC",12,4,6,5,7,9,10,13 D LIST(SDI) Q:SDOUT
"RTN","SCRPW8",36,0)
 D TOT W !! D SHDR(($$HD2()_"   O U T P A T I E N T   V I S I T S")) Q:SDOUT  S SDCT=^TMP(SDS1,$J,SDS2,"VISIT","NWK")+^TMP(SDS1,$J,SDS2,"VISIT","OWK")
"RTN","SCRPW8",37,0)
 D:$Y>(IOSL-4) XHDR Q:SDOUT  W !?10,"Act. Req./not accepted visits",?47,$J(^TMP(SDS1,$J,SDS2,"VISIT","NWK"),12),?62,$J($S(SDCT=0:0,1:(^TMP(SDS1,$J,SDS2,"VISIT","NWK")*100/SDCT)),8,2)
"RTN","SCRPW8",38,0)
 D:$Y>(IOSL-4) XHDR Q:SDOUT  W !?10,"Transmitted, accepted visits",?47,$J(^TMP(SDS1,$J,SDS2,"VISIT","OWK"),12),?62,$J($S(SDCT=0:0,1:(^TMP(SDS1,$J,SDS2,"VISIT","OWK")*100/SDCT)),8,2)
"RTN","SCRPW8",39,0)
 D TOT
"RTN","SCRPW8",40,0)
 W !! D SHDR(($$HD2()_"   O U T P A T I E N T   U N I Q U E S")) Q:SDOUT
"RTN","SCRPW8",41,0)
 S SDUNCO=^TMP(SDS1,$J,SDS2,"UNIQUE","UNCO"),SDUNAR=^TMP(SDS1,$J,SDS2,"UNIQUE","UNAR"),SDCT=SDUNCO+SDUNAR
"RTN","SCRPW8",42,0)
 D:$Y>(IOSL-4) XHDR Q:SDOUT  W !?10,"Act. Req./not accepted unique pts.",?47,$J(SDUNAR,12),?62,$J($S(SDCT=0:0,1:SDUNAR*100/SDCT),8,2)
"RTN","SCRPW8",43,0)
 D:$Y>(IOSL-4) XHDR Q:SDOUT  W !?10,"Transmitted, accepted unique pts.",?47,$J(SDUNCO,12),?62,$J($S(SDCT=0:0,1:SDUNCO*100/SDCT),8,2) D TOT
"RTN","SCRPW8",44,0)
 Q
"RTN","SCRPW8",45,0)
 ;
"RTN","SCRPW8",46,0)
XHDR I $E(IOST)="C",SDPAGE>1 N DIR S DIR(0)="E" D ^DIR S SDOUT=Y'=1 Q:SDOUT
"RTN","SCRPW8",47,0)
 S SDLINE="",$P(SDLINE,"-",81)="" W:SDPAGE>1!($E(IOST)="C") $$XY^SCRPW50(IOF,1,0) W:$X $$XY^SCRPW50("",0,0) W SDLINE,!?15,"<*>  OUTPATIENT ENCOUNTER WORKLOAD STATISTICS  <*>"
"RTN","SCRPW8",48,0)
 I $D(^TMP("SCRPW",$J)) S X=$$HD1() W !?(80-$L(X)\2),X
"RTN","SCRPW8",49,0)
 W !,SDLINE,!,"For encounter dates ",SDDTPF," to ",SDDTPL,!,"Date printed: ",SDPNOW,?(74-$L(SDPAGE)),"Page: ",SDPAGE,!,SDLINE,! S SDPAGE=SDPAGE+1
"RTN","SCRPW8",50,0)
 Q
"RTN","SCRPW8",51,0)
 ;
"RTN","SCRPW8",52,0)
EXIT K SDTOE0,SDUNCO,SDUNAR,SDCT,DFN,SDDT,SDDTF,SDDTL,SDDTPF,SDDTPL,SDI,SDLINE,SDOE,SDOE0,SDPNOW,SDSTAT,SDSTX,SDTOE,SDTOEE,SDTOE1,SDTX,SDTXS,SDX,SDZ,DTOUT,X,Y,ZTDESC,ZTRTN,ZTSAVE
"RTN","SCRPW8",53,0)
 D KVA^VADPT K X1,X2,SDH,SDHL,SDPNAM,SDSSN,SDPAGE,SDPT0,SDUL,DUOUT,SDARCT,SDST,SDPNOW,SDMD,SDMC,SDDIV,SDDNAM,SDS1,SDS2,SDCG,SDCLGR F I="SCRPW","SCRPWD","SCRPWC" K ^TMP(I,$J)
"RTN","SCRPW8",54,0)
 K I,SDFF,SDOUT,SDSTOP,SDNCOU D END^SCRPW50 Q
"RTN","SCRPW8",55,0)
 ;
"RTN","SCRPW8",56,0)
HD1() ;Report subheader 1
"RTN","SCRPW8",57,0)
 Q $S(SDS1="SCRPW":"For station: ",SDS1="SCRPWD":"For division: ",1:"For clinic group: ")_SDS2
"RTN","SCRPW8",58,0)
 ;
"RTN","SCRPW8",59,0)
HD2() ;Report subheader 2
"RTN","SCRPW8",60,0)
 Q $S(SDS1="SCRPW":"F A C I L I T Y",SDS1="SCRPWD":"D I V I S I O N",1:"C L I N I C   G R O U P")
"RTN","SCRPW8",61,0)
 ;
"RTN","SCRPW8",62,0)
DIV() ;Return division name
"RTN","SCRPW8",63,0)
 N X S X=$P($G(^DG(40.8,+$P(SDOE0,U,11),0)),U) Q $S('$L(X):"***UNKNOWN***",1:X)
"RTN","SCRPW8",64,0)
 ;
"RTN","SCRPW8",65,0)
CLGR() ;Return CLINIC GROUP pointer
"RTN","SCRPW8",66,0)
 N X S X=$P($G(^SC(+$P(SDOE0,U,4),0)),U,31),X=$P($G(^SD(409.67,+X,0)),U) Q $S('$L(X):"***NONE ASSIGNED***",1:X)
"RTN","SCRPW8",67,0)
 ;
"RTN","SCRPW8",68,0)
NCT1 I '$D(^TMP(SDS1,$J,SDS2,"VISIT","ACC",DFN)) S SDUNAR=SDUNAR+1 D:SDUL&(SDS1="SCRPW") UL("OWK")
"RTN","SCRPW8",69,0)
 S SDDT=0 F  S SDDT=$O(^TMP(SDS1,$J,SDS2,"VISIT","OWK",DFN,SDDT)) Q:'SDDT  I '$D(^TMP(SDS1,$J,SDS2,"VISIT","ACC",DFN,SDDT)) S SDCT=SDCT+1
"RTN","SCRPW8",70,0)
 Q
"RTN","SCRPW8",71,0)
 ;
"RTN","SCRPW8",72,0)
CT1 I '$D(^TMP(SDS1,$J,SDS2,"VISIT","OWK",DFN)),'$D(^TMP(SDS1,$J,SDS2,"VISIT","ACC",DFN)) S SDUNAR=SDUNAR+1 D:SDUL&(SDS1="SCRPW") UL("NWK")
"RTN","SCRPW8",73,0)
 S SDDT=0 F  S SDDT=$O(^TMP(SDS1,$J,SDS2,"VISIT","NWK",DFN,SDDT)) Q:'SDDT  I '$D(^TMP(SDS1,$J,SDS2,"VISIT","OWK",DFN,SDDT)),'$D(^TMP(SDS1,$J,SDS2,"VISIT","ACC",DFN,SDDT)) S SDCT=SDCT+1
"RTN","SCRPW8",74,0)
 Q
"RTN","SCRPW8",75,0)
 ;
"RTN","SCRPW8",76,0)
UL(SDI) D ^VADPT S SDDT=0 F  S SDDT=$O(^TMP(SDS1,$J,SDS2,"VISIT",SDI,DFN,SDDT)) Q:'SDDT  S ^TMP(SDS1,$J,SDS2,"VISIT","UNARL",VADM(1),DFN,$P(VADM(2),U),SDDT)=""
"RTN","SCRPW8",77,0)
 Q
"RTN","SCRPW8",78,0)
 ;
"RTN","SCRPW8",79,0)
TOT W !?47,"============  =========",!?39,"TOTAL:",?47,$J(SDCT,12),?64,"100.00" Q
"RTN","SCRPW8",80,0)
 ;
"RTN","SCRPW8",81,0)
SHDR(SDTX) D:$Y>(IOSL-6) XHDR Q:SDOUT  W !!?(80-$L(SDTX)\2),SDTX,!?(80-$L(SDTX)\2) F SDX=1:1:$L(SDTX) W "-"
"RTN","SCRPW8",82,0)
 W !!?39,"Status",?54,"Count",?63,"Percent",!?10,"-----------------------------------  ------------  ---------" Q
"RTN","SCRPW8",83,0)
 ;
"RTN","SCRPW8",84,0)
LIST(SDI) Q:'$D(^TMP(SDS1,$J,SDS2,SDI))  D:$Y>(IOSL-4) XHDR Q:SDOUT
"RTN","SCRPW8",85,0)
 W !?10,$P(^SD(409.63,+SDI,0),U),?47,$J(^TMP(SDS1,$J,SDS2,SDI),12),?62,$J($S(SDCT=0:0,1:(^TMP(SDS1,$J,SDS2,SDI)*100/SDCT)),8,2)
"RTN","SCRPW8",86,0)
 Q
"RTN","SCRPW8",87,0)
 ;
"RTN","SCRPW8",88,0)
COT D:$Y>(IOSL-4) XHDR Q:SDOUT  W !?15,SDSTAT,?47,$J(^TMP(SDS1,$J,SDS2,2,SDI,SDSTAT),12),?62,$J($S(SDCT=0:0,1:(^TMP(SDS1,$J,SDS2,2,SDI,SDSTAT)*100/SDCT)),8,2) Q
"RTN","SCRPW8",89,0)
 ;
"RTN","SCRPW8",90,0)
IAP D:$Y>(IOSL-4) XHDR Q:SDOUT  W !?15,SDSTAT,?47,$J(^TMP(SDS1,$J,SDS2,"8-CC",SDI,SDSTAT),12),?62,$J($S(SDCT=0:0,1:(^TMP(SDS1,$J,SDS2,"8-CC",SDI,SDSTAT)*100/SDCT)),8,2) Q
"RTN","SCRPW8",91,0)
STOP ;Check for stop task request
"RTN","SCRPW8",92,0)
 S:$G(ZTQUEUED) (SDOUT,ZTSTOP)=$S($$S^%ZTLOAD:1,1:0) Q
"RTN","SCRPW8",93,0)
 ;
"RTN","SCRPW8",94,0)
COUNT ;Count encounters
"RTN","SCRPW8",95,0)
 S SDNCOU=$P($G(^SC(+$P(SDOE0,U,4),0)),U,17),SDNCOU=$S(SDNCOU="Y":1,1:0)
"RTN","SCRPW8",96,0)
 S SDSTOP=SDSTOP+1 I SDSTOP#3000=0 D STOP Q:SDOUT
"RTN","SCRPW8",97,0)
 D C1("SCRPW",SDDNAM) D:SDMD C1("SCRPWD",SDDIV) D:SDCLGR C1("SCRPWC",SDCG) Q
"RTN","SCRPW8",98,0)
 ;
"RTN","SCRPW8",99,0)
C1(SDS1,SDS2) ;Set ^TMP global
"RTN","SCRPW8",100,0)
 ;Required input: SDS1,SDS2=subscript values
"RTN","SCRPW8",101,0)
 ;Because there is only 1 status (8) for INPATIENTS, 8-NC is used to
"RTN","SCRPW8",102,0)
 ;distinguish the non-count clinics from the count clinics, 8-CC.
"RTN","SCRPW8",103,0)
 S DFN=$P(SDOE0,U,2),SDSTAT=+$P(SDOE0,U,12) I SDSTAT=8 S SDSTAT=$S(SDNCOU:SDSTAT_"-NC",1:SDSTAT_"-CC")
"RTN","SCRPW8",104,0)
 I SDZ(0),SDZ(4)=SDDIV,SDS1="SCRPW" D DETAIL
"RTN","SCRPW8",105,0)
 S ^TMP(SDS1,$J,SDS2,SDSTAT)=$G(^TMP(SDS1,$J,SDS2,SDSTAT))+1
"RTN","SCRPW8",106,0)
 Q:SDSTAT=4  Q:(+SDSTAT=8)&($P(SDSTAT,"-",2)="NC")  D:"114238"[+SDSTAT VIS Q
"RTN","SCRPW8",107,0)
 ;
"RTN","SCRPW8",108,0)
VIS S ^TMP(SDS1,$J,SDS2,"VISIT",$S(SDSTAT=2:"OWK",(+SDSTAT=8)&('SDNCOU):"OWK",1:"NWK"),DFN,$P(SDDT,"."))="" Q:(+SDSTAT'=2)&(+SDSTAT'=8)
"RTN","SCRPW8",109,0)
 I +SDSTAT=8,$P(SDOE0,U,7)="" D  Q
"RTN","SCRPW8",110,0)
 .S ^TMP(SDS1,$J,SDS2,SDSTAT,10,"Action Required")=$G(^TMP(SDS1,$J,SDS2,SDSTAT,10,"Action Required"))+1
"RTN","SCRPW8",111,0)
 S SDSTX=$$STX(SDOE,SDOE0),^TMP(SDS1,$J,SDS2,SDSTAT,$P(SDSTX,U),$P(SDSTX,U,2))=$G(^TMP(SDS1,$J,SDS2,SDSTAT,$P(SDSTX,U),$P(SDSTX,U,2)))+1
"RTN","SCRPW8",112,0)
 Q:$P(SDSTX,U)'=8  S ^TMP(SDS1,$J,SDS2,"VISIT","ACC",DFN,$P(SDDT,"."))=""
"RTN","SCRPW8",113,0)
 Q
"RTN","SCRPW8",114,0)
 ;
"RTN","SCRPW8",115,0)
STX(SDOE,SDOE0) ;Determine transmission status
"RTN","SCRPW8",116,0)
 ;Required input: SDOE=OUTPATIENT ENCOUNTER record IFN
"RTN","SCRPW8",117,0)
 ;Required input: SDOE0=zeroeth node of OUTPATIENT ENCOUNTER
"RTN","SCRPW8",118,0)
 N SDTOE,SDTOEE
"RTN","SCRPW8",119,0)
 Q:($P(SDOE0,U,12)'=2)&($P(SDOE0,U,12)'=8) "0^Not checked-out^Not checked-out"
"RTN","SCRPW8",120,0)
 S SDTOE=$O(^SD(409.73,"AENC",SDOE,0)) Q:'SDTOE!'$D(^SD(409.73,+SDTOE,0)) "1^No transmission record^No tx. record"
"RTN","SCRPW8",121,0)
 S SDTOE1=$G(^SD(409.73,SDTOE,1)),SDTOE0=^SD(409.73,SDTOE,0) I '$P(SDTOE0,U,4),'$P(SDTOE1,U) Q "2^Not required, not transmitted^Not req., not tx."
"RTN","SCRPW8",122,0)
 ; SD*5.3*339 added second I SDTOEE below
"RTN","SCRPW8",123,0)
 S SDTOEE=$O(^SD(409.75,"B",SDTOE,0)) I SDTOEE S SDTOEE=$P($G(^SD(409.75,SDTOEE,0)),U,2) I SDTOEE S SDTOEE=$P($G(^SD(409.76,SDTOEE,0)),U,2) Q:SDTOEE="V" "3^Rejected for transmission^Rejected for tx."
"RTN","SCRPW8",124,0)
 Q:'$P(SDTOE1,U) "4^Awaiting transmission^Awaiting tx."
"RTN","SCRPW8",125,0)
 S SDTXS=$P(SDTOE1,U,5) Q:'$L(SDTXS) "5^Transmitted, no acknowledgment^Tx., no ack."
"RTN","SCRPW8",126,0)
 Q:SDTXS="R" "6^Transmitted, rejected^Tx., rejected"
"RTN","SCRPW8",127,0)
 Q:SDTXS'="A" "7^Transmitted, error^Tx., error"
"RTN","SCRPW8",128,0)
 Q "8^Transmitted, accepted^Tx., accepted"
"RTN","SCRPW8",129,0)
 ;
"RTN","SCRPW8",130,0)
DETAIL ;Set global for detailed list
"RTN","SCRPW8",131,0)
 N SDIF S SDIF=0
"RTN","SCRPW8",132,0)
 D ^VADPT S SDPNAM=VADM(1),SDSSN=$P(VADM(2),U)
"RTN","SCRPW8",133,0)
 I SDZ(1)="U",+SDSTAT'=4,'SDNCOU S:"114238"[+SDSTAT ^TMP(SDS1,$J,SDS2,"DETAIL",SDPNAM,DFN,SDSSN)="" Q
"RTN","SCRPW8",134,0)
 I SDZ(1)="V",+SDSTAT'=4,'SDNCOU S:"114238"[+SDSTAT ^TMP(SDS1,$J,SDS2,"DETAIL",SDPNAM,DFN,SDSSN,$P(SDDT,"."))="" Q
"RTN","SCRPW8",135,0)
 Q:'$D(SDZ(2))  ; SD*5.3*339
"RTN","SCRPW8",136,0)
 I SDZ(2)'=2,SDZ(2)=+SDSTAT D  I SDIF Q
"RTN","SCRPW8",137,0)
 .I (SDZ(2)=8) Q:$P(SDSTAT,"-",2)="CC"  I SDZ(3)'=9 S SDIF=1 Q
"RTN","SCRPW8",138,0)
 .D DSET S SDIF=1
"RTN","SCRPW8",139,0)
 Q:("28"'[SDZ(2))!("28"'[+SDSTAT)  Q:SDZ(2)'=+SDSTAT  D  I SDIF Q
"RTN","SCRPW8",140,0)
 .I +SDSTAT=8,$P(SDSTAT,"-",2)="NC" S SDIF=1 Q
"RTN","SCRPW8",141,0)
 .I 'SDZ(3) D DSET S SDIF=1
"RTN","SCRPW8",142,0)
 D:+$$STX(SDOE,SDOE0)=SDZ(3) DSET Q
"RTN","SCRPW8",143,0)
 ;
"RTN","SCRPW8",144,0)
DSET S ^TMP(SDS1,$J,SDS2,"DETAIL",SDPNAM,DFN,SDSSN,SDDT,SDOE)=+$P(SDOE0,U,4) Q
"RTN","SCRPW9")
0^3^B57569587^B56812091
"RTN","SCRPW9",1,0)
SCRPW9 ;RENO/KEITH - Outpatient Encounter Workload Statistics (cont.) ; 15 Jul 98  02:38PM
"RTN","SCRPW9",2,0)
 ;;5.3;Scheduling;**139,144,339,466,510**;AUG 13, 1993;Build 3
"RTN","SCRPW9",3,0)
UNARL(SDS1,SDS2) ;Print list of 'action required'/not accepted uniques
"RTN","SCRPW9",4,0)
 ;Required input: SDS1,SDS2=subscript values
"RTN","SCRPW9",5,0)
 S SDPAGE=1 D UHDR Q:SDOUT  I '$D(^TMP(SDS1,$J,SDS2,"VISIT","UNARL")) W !!,"No 'action required'/not accepted unique patients identified." Q
"RTN","SCRPW9",6,0)
 S SDARCT=0,SDPNAM="" F  S SDPNAM=$O(^TMP(SDS1,$J,SDS2,"VISIT","UNARL",SDPNAM)) Q:SDPNAM=""!SDOUT  S DFN=0 F  S DFN=$O(^TMP(SDS1,$J,SDS2,"VISIT","UNARL",SDPNAM,DFN)) Q:'DFN!SDOUT  D UNP
"RTN","SCRPW9",7,0)
 Q:SDOUT  D:$Y>(IOSL-3) UHDR Q:SDOUT  W !!,SDARCT," 'action required'/not accepted unique patient",$S(SDARCT=1:"",1:"s")," identified." Q
"RTN","SCRPW9",8,0)
 ;
"RTN","SCRPW9",9,0)
UNP S SDSSN=$O(^TMP(SDS1,$J,SDS2,"VISIT","UNARL",SDPNAM,DFN,"")) D:$Y>(IOSL-4) UHDR Q:SDOUT  W !,$E(SDPNAM,1,18),?20,SDSSN
"RTN","SCRPW9",10,0)
 S SDARCT=SDARCT+1,(SDDT,SDI)=0 F  S SDDT=$O(^TMP(SDS1,$J,SDS2,"VISIT","UNARL",SDPNAM,DFN,SDSSN,SDDT)) Q:'SDDT!SDOUT  D:$Y>(IOSL-4) UHDR Q:SDOUT  S Y=SDDT X ^DD("DD") W:SDI ! W ?31,Y S SDI=1 D UNP1
"RTN","SCRPW9",11,0)
 Q
"RTN","SCRPW9",12,0)
 ;
"RTN","SCRPW9",13,0)
UNP1 N SDII,SDDT1 S SDII=0,SDDT1=SDDT F  S SDDT1=$O(^SCE("ADFN",DFN,SDDT1)) Q:'SDDT1!(SDDT1>(SDDT+.9999))!SDOUT  D
"RTN","SCRPW9",14,0)
 .S SDOE=0 F  S SDOE=$O(^SCE("ADFN",DFN,SDDT1,SDOE)) Q:'SDOE!SDOUT  S SDOE0=$$GETOE^SDOE(SDOE) I $L(SDOE0),'$P(SDOE0,U,6) D UNP2
"RTN","SCRPW9",15,0)
 .Q
"RTN","SCRPW9",16,0)
 Q
"RTN","SCRPW9",17,0)
 ;
"RTN","SCRPW9",18,0)
UNP2 N SDCL,SDST Q:'$P(SDOE0,U,4)  S SDCL=$P($G(^SC($P(SDOE0,U,4),0)),U),SDST=$P(SDOE0,U,12) Q:$P($G(^SC($P(SDOE0,U,4),0)),U,17)="Y"  Q:'SDST!(SDST=12)  S SDST=$S("28"'[SDST:$P(^SD(409.63,SDST,0),U),1:$P($$STX^SCRPW8(SDOE,SDOE0),U,3))
"RTN","SCRPW9",19,0)
 D:$Y>(IOSL-4) UHDR Q:SDOUT  W:SDII ! W ?44,$E(SDCL,1,17),?63,$E(SDST,1,17) S SDII=SDII+1 Q
"RTN","SCRPW9",20,0)
 ;
"RTN","SCRPW9",21,0)
UHDR I $E(IOST)="C" N DIR S DIR(0)="E" D ^DIR S SDOUT=Y'=1 Q:SDOUT
"RTN","SCRPW9",22,0)
 D STOP^SCRPW8 Q:SDOUT
"RTN","SCRPW9",23,0)
 W $$XY^SCRPW50(IOF,1,0),SDLINE,!?8,"<*>  LIST OF 'ACTION REQUIRED'/NOT ACCEPTED UNIQUE PATIENTS  <*>",!?(66-$L(SDDNAM)\2),"For station: ",SDDNAM
"RTN","SCRPW9",24,0)
 W !,SDLINE,!,"For encounter dates ",SDDTPF," to ",SDDTPL,!,"Date printed: ",SDPNOW,?(74-$L(SDPAGE)),"Page: ",SDPAGE,!,SDLINE,! S SDPAGE=SDPAGE+1
"RTN","SCRPW9",25,0)
 W:$D(^TMP(SDS1,$J,SDS2,"VISIT","UNARL")) !,"Name:",?20,"SSN:",?31,"Date:",?44,"Location:",?63,"Reason:",! Q
"RTN","SCRPW9",26,0)
 ;
"RTN","SCRPW9",27,0)
DETAIL ;Ask questions for detail of encounters or uniques for a division
"RTN","SCRPW9",28,0)
 K SDZ S SDZ(0)=0 K DIR S DIR(0)="Y",DIR("A")="Would you like to print a detailed list of activity for a division",DIR("B")="NO" W ! D ^DIR I $D(DTOUT)!$D(DUOUT) S SDZ(0)=-1 Q
"RTN","SCRPW9",29,0)
 S SDZ(0)=Y Q:'Y  W !!!,$C(7),"   WARNING: Selection high activity areas will result in lengthy output!",!
"RTN","SCRPW9",30,0)
 K DIR S DIR(0)="S^U:UNIQUES;V:VISITS;E:ENCOUNTERS",DIR("A")="Select type of list" D ^DIR I $D(DTOUT)!$D(DUOUT) S SDZ(0)=-1 Q
"RTN","SCRPW9",31,0)
 S SDZ(1)=Y G:Y'="E" ZDIV
"RTN","SCRPW9",32,0)
DET1 K DIC S DIC="^SD(409.63,",DIC(0)="AEMQ",DIC("S")="I Y<4!(Y=8!(Y=12!(Y=14)))",DIC("A")="Select encounter status: " W ! D ^DIC I $D(DTOUT)!$D(DUOUT)!($G(Y)<1) S SDZ(0)=-1 Q
"RTN","SCRPW9",33,0)
 S SDZ(2)=$P(Y,U) G:(SDZ(2)'=2)&(SDZ(2)'=8) ZDIV K DIR S DIR("A")="Select transmission status for "_$S(SDZ(2)=2:"CHECKED OUT",1:"INPATIENT APPOINTMENT")_" encounters"
"RTN","SCRPW9",34,0)
 S DIR(0)="S^A:All transmission statuses;1:No transmission record;2:Not required, not transmitted;3:Rejected for transmission;4:Awaiting transmission;"
"RTN","SCRPW9",35,0)
 S DIR(0)=DIR(0)_"5:Transmitted, no acknowledgment;6:Transmitted, rejected;7:Transmitted, error;8:Transmitted, accepted"
"RTN","SCRPW9",36,0)
 I SDZ(2)=8 S DIR(0)=DIR(0)_";9:Non-Count (not transmitted)"
"RTN","SCRPW9",37,0)
 W ! D ^DIR I $D(DTOUT)!$D(DUOUT) S SDZ(0)=-1 Q  ;SD*5.3*339 add sub-zero
"RTN","SCRPW9",38,0)
 S SDZ(3)=+Y
"RTN","SCRPW9",39,0)
ZDIV ;Get division for detail
"RTN","SCRPW9",40,0)
 I '$P($G(^DG(43,1,"GL")),U,2) S SDZ(4)=$P(^DG(40.8,$$PRIM^VASITE(),0),U) Q
"RTN","SCRPW9",41,0)
 K DIC S DIC="^DG(40.8,",DIC("A")="Select Medical Center division for detail: ",DIC(0)="AEMQ" W ! D ^DIC I $D(DTOUT)!$D(DUOUT) S SDZ(0)=-1 Q
"RTN","SCRPW9",42,0)
 I Y<1 W $C(7),"    Required for patient detail!" G ZDIV
"RTN","SCRPW9",43,0)
 S SDZ(4)=$P(Y,U,2) Q
"RTN","SCRPW9",44,0)
 ;
"RTN","SCRPW9",45,0)
DPRT(SDS1,SDS2) ;Detail print
"RTN","SCRPW9",46,0)
 ;Required input: SDS1,SDS2=subscript values
"RTN","SCRPW9",47,0)
 K SDH S SDPAGE=1,SDH(1)="<*>  DETAILED LIST OF DIVISION "_$S(SDZ(1)="U":"UNIQUES",SDZ(1)="V":"VISITS",1:"ENCOUNTERS")_"  <*>",SDH(2)="For division: "_SDZ(4)
"RTN","SCRPW9",48,0)
 I $G(SDZ(2)) S SDH(3)="Encounters with "_$P(^SD(409.63,SDZ(2),0),U)_" status"
"RTN","SCRPW9",49,0)
 I $G(SDZ(2))'="","28"[SDZ(2) S SDH(4)="Transmission status: "_$P($T(TXS+SDZ(3)),";",2)
"RTN","SCRPW9",50,0)
 D DHDR Q:SDOUT  I '$D(^TMP(SDS1,$J,SDS2,"DETAIL")) W !,"No records found in this category." Q
"RTN","SCRPW9",51,0)
 S SDCT=0 D @SDZ(1) Q
"RTN","SCRPW9",52,0)
 ;
"RTN","SCRPW9",53,0)
U ;Print uniques
"RTN","SCRPW9",54,0)
 S SDPNAM="" F  S SDPNAM=$O(^TMP(SDS1,$J,SDS2,"DETAIL",SDPNAM)) Q:SDPNAM=""!SDOUT  S DFN=0 F  S DFN=$O(^TMP(SDS1,$J,SDS2,"DETAIL",SDPNAM,DFN)) Q:'DFN!SDOUT  D U1
"RTN","SCRPW9",55,0)
 Q:SDOUT  W !!,SDCT," uniques identified." Q
"RTN","SCRPW9",56,0)
 ;
"RTN","SCRPW9",57,0)
U1 S SDCT=SDCT+1,SDSSN=$O(^TMP(SDS1,$J,SDS2,"DETAIL",SDPNAM,DFN,"")) D:$Y>(IOSL-4) DHDR Q:SDOUT  W !,$E(SDPNAM,1,18),?21,SDSSN Q
"RTN","SCRPW9",58,0)
 ;
"RTN","SCRPW9",59,0)
V ;Print visits
"RTN","SCRPW9",60,0)
 S SDPNAM="" F  S SDPNAM=$O(^TMP(SDS1,$J,SDS2,"DETAIL",SDPNAM)) Q:SDPNAM=""!SDOUT  S DFN=0 F  S DFN=$O(^TMP(SDS1,$J,SDS2,"DETAIL",SDPNAM,DFN)) Q:'DFN!SDOUT  S SDSSN=$O(^TMP(SDS1,$J,SDS2,"DETAIL",SDPNAM,DFN,"")) D V1
"RTN","SCRPW9",61,0)
 Q:SDOUT  W !!,SDCT," visits identified." Q
"RTN","SCRPW9",62,0)
 ;
"RTN","SCRPW9",63,0)
V1 D:$Y>(IOSL-4) DHDR Q:SDOUT  W !,$E(SDPNAM,1,18),?21,SDSSN S (SDDT,SDI)=0 F  S SDDT=$O(^TMP(SDS1,$J,SDS2,"DETAIL",SDPNAM,DFN,SDSSN,SDDT)) Q:'SDDT!SDOUT  D
"RTN","SCRPW9",64,0)
 .D:$Y>(IOSL-3) DHDR Q:SDOUT  S Y=SDDT X ^DD("DD") W:SDI ! W ?32,Y S SDCT=SDCT+1,SDI=SDI+1
"RTN","SCRPW9",65,0)
 .Q
"RTN","SCRPW9",66,0)
 Q
"RTN","SCRPW9",67,0)
 ;
"RTN","SCRPW9",68,0)
E ;Print encounters
"RTN","SCRPW9",69,0)
 S SDPNAM="" F  S SDPNAM=$O(^TMP(SDS1,$J,SDS2,"DETAIL",SDPNAM)) Q:SDPNAM=""!SDOUT  S DFN=0 F  S DFN=$O(^TMP(SDS1,$J,SDS2,"DETAIL",SDPNAM,DFN)) Q:'DFN!SDOUT  S SDSSN=$O(^TMP(SDS1,$J,SDS2,"DETAIL",SDPNAM,DFN,"")) D E1
"RTN","SCRPW9",70,0)
 Q:SDOUT  W !!,SDCT," encounters identified." Q
"RTN","SCRPW9",71,0)
 ;
"RTN","SCRPW9",72,0)
E1 D:$Y>(IOSL-4) DHDR Q:SDOUT  W !,$E(SDPNAM,1,18),?21,SDSSN
"RTN","SCRPW9",73,0)
 S (SDDT,SDI)=0 F  S SDDT=$O(^TMP(SDS1,$J,SDS2,"DETAIL",SDPNAM,DFN,SDSSN,SDDT)) Q:'SDDT!SDOUT  S SDOE=0 F  S SDOE=$O(^TMP(SDS1,$J,SDS2,"DETAIL",SDPNAM,DFN,SDSSN,SDDT,SDOE)) Q:'SDOE!SDOUT  D E2
"RTN","SCRPW9",74,0)
 Q
"RTN","SCRPW9",75,0)
 ;
"RTN","SCRPW9",76,0)
E2 D:$Y>(IOSL-3) DHDR Q:SDOUT  S SDHL=^TMP(SDS1,$J,SDS2,"DETAIL",SDPNAM,DFN,SDSSN,SDDT,SDOE),SDHL=$P($G(^SC(+SDHL,0)),U),Y=SDDT X ^DD("DD") W:SDI ! W ?32,$P(Y,":",1,2),?50,SDHL S SDCT=SDCT+1,SDI=SDI+1 Q
"RTN","SCRPW9",77,0)
 ;
"RTN","SCRPW9",78,0)
DHDR I $E(IOST)="C" N DIR S DIR(0)="E" D ^DIR S SDOUT=Y'=1 Q:SDOUT
"RTN","SCRPW9",79,0)
 D STOP^SCRPW8 Q:SDOUT
"RTN","SCRPW9",80,0)
 W $$XY^SCRPW50(IOF,1,0),SDLINE S I=0 F  S I=$O(SDH(I)) Q:'I  W !?(80-$L(SDH(I))\2),SDH(I)
"RTN","SCRPW9",81,0)
 W !,SDLINE,!,"For date range: ",SDDTPF," to ",SDDTPL,!,"Date printed: ",SDPNOW,?(74-$L(SDPAGE)),"Page: ",SDPAGE,!,SDLINE,! S SDPAGE=SDPAGE+1 Q
"RTN","SCRPW9",82,0)
 ;
"RTN","SCRPW9",83,0)
TXS ;All transmission statuses
"RTN","SCRPW9",84,0)
 ;No transmission record
"RTN","SCRPW9",85,0)
 ;Not required, not transmitted
"RTN","SCRPW9",86,0)
 ;Rejected for transmission
"RTN","SCRPW9",87,0)
 ;Awaiting transmission
"RTN","SCRPW9",88,0)
 ;Transmitted, no acknowledgment
"RTN","SCRPW9",89,0)
 ;Transmitted, rejected
"RTN","SCRPW9",90,0)
 ;Transmitted, error
"RTN","SCRPW9",91,0)
 ;Transmitted, accepted
"RTN","SCRPW9",92,0)
 ;Non-Count (not transmitted)
"RTN","SCRPW9",93,0)
 ;
"RTN","SCRPW9",94,0)
PARM ;Prompt for report parameters
"RTN","SCRPW9",95,0)
 D TITL^SCRPW50("Outpatient Encounter Workload Statistics")
"RTN","SCRPW9",96,0)
 N %DT,DIR,DIC D SUBT^SCRPW50("*** Date Range Selection ***")
"RTN","SCRPW9",97,0)
FDT W ! S %DT="AEPX",%DT("A")="Beginning date:  FIRST// ",%DT(0)=2961001 D ^%DT G:X=U!$D(DTOUT) EXIT^SCRPW8 I X="" S (Y,SDDTF)=2961001 X ^DD("DD") W "  ",Y,! S SDDTPF=Y G LDT
"RTN","SCRPW9",98,0)
 G:Y<1 FDT S SDDTF=Y X ^DD("DD") S SDDTPF=Y W !
"RTN","SCRPW9",99,0)
LDT S %DT("A")="Ending date:  LAST// " D ^%DT G:X=U!$D(DTOUT) EXIT^SCRPW8 I X="" S X1=DT,X2=-1 D C^%DTC S (Y,SDDTL)=X X ^DD("DD") W "  ",Y,! S SDDTPL=Y G ASK
"RTN","SCRPW9",100,0)
 I Y<SDDTF W !!,$C(7),"Ending date must be after beginning date!",! G LDT
"RTN","SCRPW9",101,0)
 G:Y<1 LDT S SDDTL=Y X ^DD("DD") S SDDTPL=Y,SDDTL=SDDTL_".999999"
"RTN","SCRPW9",102,0)
ASK D SUBT^SCRPW50("*** Additional Detail Selection ***")
"RTN","SCRPW9",103,0)
 W ! K DIR S DIR(0)="Y",DIR("A")="Break out workload by clinic group",DIR("B")="NO",DIR("?")="Specify if subtotals by encounter location CLINIC GROUP should be provided." D ^DIR G:$D(DTOUT)!$D(DUOUT) EXIT^SCRPW8 S SDCLGR=Y
"RTN","SCRPW9",104,0)
 D DETAIL^SCRPW9 W ! G:SDZ(0)=-1 EXIT^SCRPW8
"RTN","SCRPW9",105,0)
 K DIR S DIR(0)="Y",DIR("A")="List facility 'action required'/not accepted unique patients",DIR("B")="NO" D ^DIR G:$D(DTOUT)!$D(DUOUT) EXIT^SCRPW8 S SDUL=Y W !
"RTN","SCRPW9",106,0)
QUE S ZTRTN="PST^SCRPW8",ZTDESC="Outpatient Encounter Workload" F SDI="SDCLGR","SDDTF","SDDTPF","SDDTL","SDDTPL","SDUL","SDDUL","SDZ(" S ZTSAVE(SDI)=""
"RTN","SCRPW9",107,0)
 D EN^XUTMDEVQ(ZTRTN,ZTDESC,.ZTSAVE) G EXIT^SCRPW8
"VER")
8.0^22.0
"BLD",7249,6)
^427
**END**
**END**
