Released SD*5.3*540 SEQ #440
Extracted from mail message
**KIDS**:SD*5.3*540^

**INSTALL NAME**
SD*5.3*540
"BLD",7651,0)
SD*5.3*540^SCHEDULING^0^3080826^y
"BLD",7651,1,0)
^^2^2^3080811^
"BLD",7651,1,1,0)
Fixes to the Clinic Utilization Statistical Summary and Clinic Workload 
"BLD",7651,1,2,0)
reports.
"BLD",7651,4,0)
^9.64PA^^
"BLD",7651,6.3)
2
"BLD",7651,"ABPKG")
n
"BLD",7651,"KRN",0)
^9.67PA^8989.52^19
"BLD",7651,"KRN",.4,0)
.4
"BLD",7651,"KRN",.4,"NM",0)
^9.68A^^
"BLD",7651,"KRN",.401,0)
.401
"BLD",7651,"KRN",.402,0)
.402
"BLD",7651,"KRN",.403,0)
.403
"BLD",7651,"KRN",.5,0)
.5
"BLD",7651,"KRN",.84,0)
.84
"BLD",7651,"KRN",3.6,0)
3.6
"BLD",7651,"KRN",3.8,0)
3.8
"BLD",7651,"KRN",9.2,0)
9.2
"BLD",7651,"KRN",9.8,0)
9.8
"BLD",7651,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",7651,"KRN",9.8,"NM",1,0)
SCRPW3^^0^B47829254
"BLD",7651,"KRN",9.8,"NM",2,0)
SDCWL3^^0^B15781152
"BLD",7651,"KRN",9.8,"NM","B","SCRPW3",1)

"BLD",7651,"KRN",9.8,"NM","B","SDCWL3",2)

"BLD",7651,"KRN",19,0)
19
"BLD",7651,"KRN",19.1,0)
19.1
"BLD",7651,"KRN",101,0)
101
"BLD",7651,"KRN",409.61,0)
409.61
"BLD",7651,"KRN",771,0)
771
"BLD",7651,"KRN",870,0)
870
"BLD",7651,"KRN",8989.51,0)
8989.51
"BLD",7651,"KRN",8989.52,0)
8989.52
"BLD",7651,"KRN",8994,0)
8994
"BLD",7651,"KRN","B",.4,.4)

"BLD",7651,"KRN","B",.401,.401)

"BLD",7651,"KRN","B",.402,.402)

"BLD",7651,"KRN","B",.403,.403)

"BLD",7651,"KRN","B",.5,.5)

"BLD",7651,"KRN","B",.84,.84)

"BLD",7651,"KRN","B",3.6,3.6)

"BLD",7651,"KRN","B",3.8,3.8)

"BLD",7651,"KRN","B",9.2,9.2)

"BLD",7651,"KRN","B",9.8,9.8)

"BLD",7651,"KRN","B",19,19)

"BLD",7651,"KRN","B",19.1,19.1)

"BLD",7651,"KRN","B",101,101)

"BLD",7651,"KRN","B",409.61,409.61)

"BLD",7651,"KRN","B",771,771)

"BLD",7651,"KRN","B",870,870)

"BLD",7651,"KRN","B",8989.51,8989.51)

"BLD",7651,"KRN","B",8989.52,8989.52)

"BLD",7651,"KRN","B",8994,8994)

"BLD",7651,"QDEF")
^^^^YES^^^^^^YES
"BLD",7651,"QUES",0)
^9.62^^
"BLD",7651,"REQB",0)
^9.611^1^1
"BLD",7651,"REQB",1,0)
SD*5.3*194^2
"BLD",7651,"REQB","B","SD*5.3*194",1)

"MBREQ")
0
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813
"PKG",16,22,1,"PAH",1,0)
540^3080826
"PKG",16,22,1,"PAH",1,1,0)
^^2^2^3080826
"PKG",16,22,1,"PAH",1,1,1,0)
Fixes to the Clinic Utilization Statistical Summary and Clinic Workload 
"PKG",16,22,1,"PAH",1,1,2,0)
reports.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","SCRPW3")
0^1^B47829254^B47598974
"RTN","SCRPW3",1,0)
SCRPW3 ;RENO/KEITH - Clinic Utilization Statistical Summary (cont.) ; 14 May 99 10:45 PM
"RTN","SCRPW3",2,0)
 ;;5.3;Scheduling;**139,144,184,194,540**;AUG 13, 1993;Build 2
"RTN","SCRPW3",3,0)
START ;Print statistics
"RTN","SCRPW3",4,0)
 F  S SDCLN=$O(^TMP("SCRPW",$J,SDIV,1,SDCLN)) Q:SDCLN=""!SDOUT  S SDCL=0 F  S SDCL=$O(^TMP("SCRPW",$J,SDIV,1,SDCLN,SDCL)) Q:'SDCL!SDOUT  D CLINE
"RTN","SCRPW3",5,0)
 Q:SDOUT  D:$Y>(IOSL-12) FOOT^SCRPW2,HDR^SCRPW2 Q:SDOUT  W ! F SDI=1:1:8 W ?(22+(SDI*10)),"--------"
"RTN","SCRPW3",6,0)
 W ?112,"---------  ---------",!,"*** CLINIC TOTALS ***" S SDCT=SDTAP_U_SDTOB_U_SDTSL_U_SDTNS_U_SDTVSL_U_SDTNSVS_U_SDTOS
"RTN","SCRPW3",7,0)
 D F1 D FOOT^SCRPW2 Q:'$D(^TMP("SCRPW",$J,SDIV,2))
"RTN","SCRPW3",8,0)
 D HDR^SCRPW2 Q:SDOUT  W !!,"*** PROVIDER SUMMARY (based on clinic default provider definition) ***"
"RTN","SCRPW3",9,0)
 S SDPRN="" F  S SDPRN=$O(^TMP("SCRPW",$J,SDIV,2,SDPRN)) Q:SDPRN=""!SDOUT  S SDPR=0 F  S SDPR=$O(^TMP("SCRPW",$J,SDIV,2,SDPRN,SDPR)) Q:'SDPR!SDOUT  D PLINE
"RTN","SCRPW3",10,0)
 Q:SDOUT  D FOOT^SCRPW2
"RTN","SCRPW3",11,0)
 Q
"RTN","SCRPW3",12,0)
 ;
"RTN","SCRPW3",13,0)
STOP ;Check for stop task request
"RTN","SCRPW3",14,0)
 S:$G(ZTQUEUED) (SDOUT,ZTSTOP)=$S($$S^%ZTLOAD:1,1:0)
"RTN","SCRPW3",15,0)
 Q
"RTN","SCRPW3",16,0)
 ;
"RTN","SCRPW3",17,0)
AC ;Evaluate all clinics
"RTN","SCRPW3",18,0)
 S SDCL=0 F  S SDCL=$O(^SC(SDCL)) Q:'SDCL  S SDCL0=^SC(SDCL,0),SDIV=$P(SDCL0,U,15),SDAC=0 I $$DIV() D STOP Q:SDOUT  D A1 D:SDAC CNT,SET
"RTN","SCRPW3",19,0)
 Q
"RTN","SCRPW3",20,0)
 ;
"RTN","SCRPW3",21,0)
A1 Q:$P(SDCL0,U,3)'="C"  S SDCLI=$G(^SC(SDCL,"I")) Q:(($P(SDCLI,U)>0)&($P(SDCLI,U)<SDBDAY)&($P(SDCLI,U,2)=""!($P(SDCLI,U,2)>SDEDAY)))  S SDAC=1
"RTN","SCRPW3",22,0)
 Q
"RTN","SCRPW3",23,0)
 ;
"RTN","SCRPW3",24,0)
SC ;Evaluate selected clinics
"RTN","SCRPW3",25,0)
 S SDCL=0 F  S SDCL=$O(SDCL(SDCL)) Q:'SDCL  S SDCL0=^SC(SDCL,0),SDIV=$P(SDCL0,U,15),SDAC=0 I $$DIV() D STOP Q:SDOUT  D A1 D:SDAC CNT,SET
"RTN","SCRPW3",26,0)
 Q
"RTN","SCRPW3",27,0)
 ;
"RTN","SCRPW3",28,0)
RC ;Evaluate a range of clinics
"RTN","SCRPW3",29,0)
 S SDCLN=$O(SDCL("")),SDECL=$O(SDCL(SDCLN)),SDCL=SDCL(SDCLN),SDCL0=^SC(SDCL,0),SDIV=$P(SDCL0,U,15),SDAC=0 I $$DIV() D STOP Q:SDOUT  D A1 D:SDAC CNT,SET
"RTN","SCRPW3",30,0)
 F  S SDCLN=$O(^SC("B",SDCLN)) Q:(SDCLN=""!(SDCLN]SDECL))  S SDCL=0 F  S SDCL=$O(^SC("B",SDCLN,SDCL)) Q:'SDCL  S SDCL0=^SC(SDCL,0),SDIV=$P(SDCL0,U,15),SDAC=0 I $$DIV() D STOP Q:SDOUT  D A1 D:SDAC CNT,SET
"RTN","SCRPW3",31,0)
 Q
"RTN","SCRPW3",32,0)
 ;
"RTN","SCRPW3",33,0)
RS ;Evaluate a range of stop codes
"RTN","SCRPW3",34,0)
 S SDBCS=$O(SDCL("")),SDECS=$O(SDCL(SDBCS)),SDCL=0 S:'SDECS SDECS=SDBCS F  S SDCL=$O(^SC(SDCL)) Q:'SDCL  S SDCL0=^SC(SDCL,0),SDIV=$P(SDCL0,U,15),SDAC=0 I $$DIV() D STOP Q:SDOUT  D A1 D:SDAC RC1
"RTN","SCRPW3",35,0)
 Q
"RTN","SCRPW3",36,0)
 ;
"RTN","SCRPW3",37,0)
RC1 S SDCSC=$P(SDCL0,U,7),SDCSC=$P($G(^DIC(40.7,+SDCSC,0)),U,2) Q:('SDCSC!(SDCSC<SDBCS!(SDCSC>SDECS)))  D CNT,SET
"RTN","SCRPW3",38,0)
 Q
"RTN","SCRPW3",39,0)
 ;
"RTN","SCRPW3",40,0)
CG ;Evaluate by clinic group
"RTN","SCRPW3",41,0)
 S SDCG=$O(SDCL(0)),SDCL=0 F  S SDCL=$O(^SC("ASCRPW",SDCG,SDCL)) Q:'SDCL  S SDCL0=^SC(SDCL,0),SDIV=$P(SDCL0,U,15),SDAC=0 I $$DIV() D STOP Q:SDOUT  D A1 D:SDAC CNT,SET
"RTN","SCRPW3",42,0)
 Q
"RTN","SCRPW3",43,0)
 ;
"RTN","SCRPW3",44,0)
DIV() ;Check division
"RTN","SCRPW3",45,0)
 S:'$L(SDIV) SDIV=$$PRIM^VASITE()
"RTN","SCRPW3",46,0)
 Q:'SDDIV 1  Q $D(SDDIV(+SDIV))
"RTN","SCRPW3",47,0)
 ;
"RTN","SCRPW3",48,0)
CNT ;Evaluate a clinic
"RTN","SCRPW3",49,0)
 S SDDAY=SDBDAY-1,(SDVSL,SDAP,SDF1,SDOB,SDSL,SDNS,SDNSVS,SDOS)=0,SDLAP=$P($G(^SC(SDCL,"SL")),U)
"RTN","SCRPW3",50,0)
 D SPAT(SDCL,SDBDAY,SDMAX),CCPAT S SDOB=SDAP-SDSL S:SDOB<0 SDOB=0
"RTN","SCRPW3",51,0)
 Q
"RTN","SCRPW3",52,0)
 ;
"RTN","SCRPW3",53,0)
CCPAT ;Count clinic patterns and patients
"RTN","SCRPW3",54,0)
 F  S SDDAY=$O(^TMP(SDSUB,$J,SDCL,"ST",SDDAY)) Q:('SDDAY!(SDDAY>SDEDAY))  D CTPAT(SDDAY)
"RTN","SCRPW3",55,0)
 S SDDAY=SDBDAY F  S SDDAY=$O(^SC(SDCL,"S",SDDAY)) Q:('SDDAY!(SDDAY>SDEDAY))  S SDI=0 F  S SDI=$O(^SC(SDCL,"S",SDDAY,1,SDI)) Q:'SDI  S SDCP0=$G(^SC(SDCL,"S",SDDAY,1,SDI,0)) D:$L(SDCP0) ACT
"RTN","SCRPW3",56,0)
 Q
"RTN","SCRPW3",57,0)
 ;
"RTN","SCRPW3",58,0)
CTPAT(SDDAY) ;Count slots in availability pattern and master pattern
"RTN","SCRPW3",59,0)
 ;Input: SDDAY=date to evaluate
"RTN","SCRPW3",60,0)
 N SDPATT,SDPCT
"RTN","SCRPW3",61,0)
 S SDPATT=$E($G(^TMP(SDSUB,$J,SDCL,"ST",SDDAY,1)),6,999) Q:SDPATT'["["
"RTN","SCRPW3",62,0)
 S SDF1=1,SDOS=SDOS+$$PCT(SDPATT)
"RTN","SCRPW3",63,0)
 S SDPATT=$E($G(^SC(SDCL,"OST",SDDAY,1)),6,999) I $L(SDPATT) S SDSL=SDSL+$$PCT(SDPATT) Q
"RTN","SCRPW3",64,0)
 N X,%H,%T,%Y,SDDW,SDMPDT
"RTN","SCRPW3",65,0)
 S X=SDDAY D H^%DTC S SDDW="T"_%Y,SDMPDT=$O(^SC(SDCL,SDDW,SDDAY))
"RTN","SCRPW3",66,0)
 I SDMPDT S SDPATT=$G(^SC(SDCL,SDDW,SDMPDT,1)),SDPCT=$$PCT(SDPATT) I SDPCT S SDSL=SDSL+SDPCT
"RTN","SCRPW3",67,0)
 Q
"RTN","SCRPW3",68,0)
 ;
"RTN","SCRPW3",69,0)
PCT(SDPATT) ;Pattern count
"RTN","SCRPW3",70,0)
 ;Input: SDPATT=pattern to evaluate
"RTN","SCRPW3",71,0)
 N X,I S X=0
"RTN","SCRPW3",72,0)
 S SDPATT=$TR(SDPATT," |[]","")
"RTN","SCRPW3",73,0)
 F I=1:1:$L(SDPATT) S X=X+$G(SD($E(SDPATT,I)))
"RTN","SCRPW3",74,0)
 Q X
"RTN","SCRPW3",75,0)
 ;
"RTN","SCRPW3",76,0)
SET ;Set stats into ^TMP global
"RTN","SCRPW3",77,0)
 S SDPR=0 I SDF1 S SDPR=$O(^SC("ADPR",SDCL,SDPR)),SDPR=$P($G(^SC(SDCL,"PR",+SDPR,0)),U) I SDPR S SDPRN=$P($G(^VA(200,SDPR,0)),U) S:'$L(SDPRN) SDPR=0
"RTN","SCRPW3",78,0)
 D SET1(SDIV) D:SDMD SET1(0)
"RTN","SCRPW3",79,0)
 Q
"RTN","SCRPW3",80,0)
 ;
"RTN","SCRPW3",81,0)
SET1(SDIV) S ^TMP("SCRPW",$J,SDIV,1,$P(SDCL0,U),SDCL)=$S('SDF1:"",1:SDAP_U_SDOB_U_SDSL_U_SDNS_U_SDVSL_U_SDNSVS_U_SDOS)
"RTN","SCRPW3",82,0)
 Q:'SDPR  S SDPCT=$G(^TMP("SCRPW",$J,SDIV,2,SDPRN,SDPR))
"RTN","SCRPW3",83,0)
 S ^TMP("SCRPW",$J,SDIV,2,SDPRN,SDPR)=($P(SDPCT,U)+SDAP)_U_($P(SDPCT,U,2)+SDOB)_U_($P(SDPCT,U,3)+SDSL)_U_($P(SDPCT,U,4)+SDNS)_U_($P(SDPCT,U,5)+SDVSL)_U_($P(SDPCT,U,6)+SDNSVS)_U_($P(SDPCT,U,7)+SDOS)
"RTN","SCRPW3",84,0)
 Q
"RTN","SCRPW3",85,0)
 ;
"RTN","SCRPW3",86,0)
CLINE ;Print a clinic statistics line
"RTN","SCRPW3",87,0)
 D:$Y>(IOSL-12) FOOT^SCRPW2,HDR^SCRPW2 Q:SDOUT  S SDCT=^TMP("SCRPW",$J,SDIV,1,SDCLN,SDCL) W !!,SDCLN I '$L(SDCT) W "  (No ava. found)" Q
"RTN","SCRPW3",88,0)
 D F1 S SDTAP=SDTAP+SDAP,SDTOB=SDTOB+SDOB,SDTSL=SDTSL+SDSL,SDTNS=SDTNS+SDNS,SDTVSL=SDTVSL+SDVSL,SDTNSVS=SDTNSVS+SDNSVS,SDTOS=SDTOS+SDOS
"RTN","SCRPW3",89,0)
 Q
"RTN","SCRPW3",90,0)
 ;
"RTN","SCRPW3",91,0)
F1 S SDAP=$P(SDCT,U),SDOB=$P(SDCT,U,2),SDSL=$P(SDCT,U,3),SDNS=$P(SDCT,U,4),SDVSL=$P(SDCT,U,5),SDNSVS=$P(SDCT,U,6),SDOS=$P(SDCT,U,7)
"RTN","SCRPW3",92,0)
 W ?32,$J(SDAP,8),?42,$J(SDVSL,8),?52,$J(SDNS,8),?62,$J(SDNSVS,8),?72,$J(SDOB,8),?82,$J(SDOS,8),?92,$J((SDSL-SDAP-SDVSL),8)
"RTN","SCRPW3",93,0)
 S SDCAP=SDSL W ?102,$J(SDCAP,8),?112,$J($S(SDCAP=0:0,1:(SDAP+SDVSL*100)/SDCAP),8,2),"%"
"RTN","SCRPW3",94,0)
 W ?123,$J($S(SDCAP=0:0,1:((SDAP+SDVSL-SDNS-SDNSVS)*100)/SDCAP),8,2),"%"
"RTN","SCRPW3",95,0)
 Q
"RTN","SCRPW3",96,0)
 ;
"RTN","SCRPW3",97,0)
PLINE ;Print a provider statistics line
"RTN","SCRPW3",98,0)
 D:$Y>(IOSL-12) FOOT^SCRPW2,HDR^SCRPW2 Q:SDOUT  S SDCT=^TMP("SCRPW",$J,SDIV,2,SDPRN,SDPR) W !!,SDPRN,"  (",SDPR,")" D F1
"RTN","SCRPW3",99,0)
 Q
"RTN","SCRPW3",100,0)
 ;
"RTN","SCRPW3",101,0)
ACT ;Count appointments, addl. variable appt. slots and no-shows
"RTN","SCRPW3",102,0)
 Q:$P(SDCP0,U,9)="C"  ;Quit if cancelled
"RTN","SCRPW3",103,0)
 S SDPLAP=$P(SDCP0,U,2),SDPESL=0 I SDLAP,SDPLAP>SDLAP S SDPESL=SDPLAP\SDLAP-1,SDVSL=SDVSL+SDPESL
"RTN","SCRPW3",104,0)
 Q:'SDCP0  ;SD*5.3*540
"RTN","SCRPW3",105,0)
 S SDAP=SDAP+1,SDF1=1
"RTN","SCRPW3",106,0)
 S SDPAS=^DPT($P(SDCP0,U),"S",SDDAY,0),SDPAS=$P(SDPAS,U,2) Q:SDPAS=""  S:"NA"[SDPAS SDNS=SDNS+1,SDNSVS=SDNSVS+SDPESL
"RTN","SCRPW3",107,0)
 Q
"RTN","SCRPW3",108,0)
 ;
"RTN","SCRPW3",109,0)
SPAT(SC,SDSTRTDT,MAX,SDS) ;Set patterns into ^TMP (modified clone of OVR^SDAUT1)
"RTN","SCRPW3",110,0)
 ;Input: SC=clinic ifn
"RTN","SCRPW3",111,0)
 ;Input: SDSTRTDT=start date for gathering patterns
"RTN","SCRPW3",112,0)
 ;Input: MAX=number of days beyond start date to gather patterns
"RTN","SCRPW3",113,0)
 ;Input: SDS=array namespace subscript value (optional)
"RTN","SCRPW3",114,0)
 ;Output: array of clinic current availability patterns in
"RTN","SCRPW3",115,0)
 ;        ^TMP(SDS,$J,clinic_ifn,"ST",date,1)
"RTN","SCRPW3",116,0)
 ;
"RTN","SCRPW3",117,0)
 S SDS=$G(SDS) S:'$L(SDS) SDS="SDTMP" K ^TMP(SDS,$J)
"RTN","SCRPW3",118,0)
 N SI,SDIN,SDRE,SDSOH,ENDATE,X,X1,X2,SM,I,D,J,Y,SS,DAY
"RTN","SCRPW3",119,0)
 S SDIN=$G(^SC(SC,"I")),SDRE=$P(SDIN,U,2),SDIN=$P(SDIN,U)
"RTN","SCRPW3",120,0)
 S DAY="SU^MO^TU^WE^TH^FR^SA"
"RTN","SCRPW3",121,0)
 S SI=$P($G(^SC(SC,"SL")),U,6),SI=$S(SI<3:4,1:SI)
"RTN","SCRPW3",122,0)
 S SDSOH=$S('$D(^SC(SC,"SL")):0,$P(^SC(SC,"SL"),"^",8)']"":0,1:1)
"RTN","SCRPW3",123,0)
 S X1=SDSTRTDT,X2=MAX,SDIN=$G(SDIN) D C^%DTC S ENDATE=X,X=SDSTRTDT
"RTN","SCRPW3",124,0)
EN1 S:$O(^SC(SC,"T",0))>X X=$O(^SC(SC,"T",0))
"RTN","SCRPW3",125,0)
 S Y=$$DOW^XLFDT(X,1),I=Y+32,SM=X,D=Y D WM
"RTN","SCRPW3",126,0)
 K J F Y=0:1:6 I $D(^SC(+SC,"T"_Y)) S J(Y)=""
"RTN","SCRPW3",127,0)
 I '$D(J) D  Q
"RTN","SCRPW3",128,0)
 .S D=SDSTRTDT-1 F  S D=$O(^SC(SC,"ST",D)) Q:'D!(D>ENDATE)  D
"RTN","SCRPW3",129,0)
 ..S X=$G(^SC(SC,"ST",D,1)) S:$L(X) ^TMP(SDS,$J,SC,"ST",D,1)=X Q
"RTN","SCRPW3",130,0)
 .Q
"RTN","SCRPW3",131,0)
X1 Q:X>ENDATE  S X1=X\100_28
"RTN","SCRPW3",132,0)
 I '$$ACTIVE(X,SDIN,SDRE) S X1=X,X2=1 D C^%DTC G X1
"RTN","SCRPW3",133,0)
W S X=X\1
"RTN","SCRPW3",134,0)
 I $D(^SC(+SC,"ST",X,1)) S ^TMP(SDS,$J,SC,"ST",X,1)=^SC(+SC,"ST",X,1) G W1
"RTN","SCRPW3",135,0)
 I '$D(^SC(SC,"ST",X,1)) S Y=D#7 G L:'$D(J(Y)),H:$D(^HOLIDAY(X))&('SDSOH) S SS=$O(^SC(SC,"T"_Y,X)) G L:SS<1,L:^SC(SC,"T"_Y,SS,1)="" D
"RTN","SCRPW3",136,0)
 .S ^TMP(SDS,$J,SC,"ST",X\1,1)=$P(DAY,U,Y+1)_" "_$E(X,6,7)_$J("",SI+SI-6)_^SC(SC,"T"_Y,SS,1) Q
"RTN","SCRPW3",137,0)
W1 D WM:X>SM
"RTN","SCRPW3",138,0)
L Q:X>ENDATE  S X=X+1,D=D+1 G W:X'>X1 S X2=X-X1 D C^%DTC G X1
"RTN","SCRPW3",139,0)
 ;
"RTN","SCRPW3",140,0)
H S ^TMP(SDS,$J,SC,"ST",X,1)="   "_$E(X,6,7)_"    "_$P(^(X,0),U,2) G W1
"RTN","SCRPW3",141,0)
 ;
"RTN","SCRPW3",142,0)
WM S SM=$S($E(X,4,5)[12:$E(X,1,3)+1_"01",1:$E(X,1,3)_$E(X,4,5)+1)_"00" Q
"RTN","SCRPW3",143,0)
 ;
"RTN","SCRPW3",144,0)
ACTIVE(X,SDIN,SDRE) ;Determine if the clinic is active on a given date
"RTN","SCRPW3",145,0)
 ;Input: X=date to be examined
"RTN","SCRPW3",146,0)
 ;Input: SDIN=clinic inactive date
"RTN","SCRPW3",147,0)
 ;Input: SDRE=clinic reactivate date
"RTN","SCRPW3",148,0)
 ;Output: '1'=active, '0'=inactive
"RTN","SCRPW3",149,0)
 Q:'SDIN 1  Q:X<SDIN 1  Q:'SDRE 0  Q:X<SDRE 0  Q 1
"RTN","SDCWL3")
0^2^B15781152^B15525979
"RTN","SDCWL3",1,0)
SDCWL3 ;ALB/MLI - CLINIC WORKLOAD REPORT CONTINUATION ; 25 MAY 88
"RTN","SDCWL3",2,0)
 ;;5.3;Scheduling;**540**;Aug 13, 1993;Build 2
"RTN","SDCWL3",3,0)
SET Q:'$D(^SC(I,"S"))!'$D(^(0))!($O(^("S",SDBD))="")!($O(^(SDBD))>SDED)  S SDST=^SC(I,0),SDN=$P(SDST,U),SDSC=$P(SDST,U,7),SDDIV=$S(+$P(SDST,U,15):$P(SDST,U,15),1:$O(^DG(40.8,0))) I SDSC']"" S ^TMP($J,"ERR",1,SDN)="" Q
"RTN","SDCWL3",4,0)
 I 'VAUTD,'$D(VAUTD(SDDIV)) Q
"RTN","SDCWL3",5,0)
 S SDSC=$S($D(^DIC(40.7,SDSC,0)):$P(^(0),U,2),1:0) I 'SDSC S ^TMP($J,"ERR",2,SDN)="" Q
"RTN","SDCWL3",6,0)
 I SDSC=900 S ^TMP($J,"ERR",3,SDN)="" Q
"RTN","SDCWL3",7,0)
 S SDCR=$S($D(^DIC(40.7,+$P(^SC(I,0),"^",18),0)):$P(^(0),"^",2),1:0) I SDCR>899,(SDCR<908) S ^TMP($J,"ERR",4,SDN)=""
"RTN","SDCWL3",8,0)
 I SDS="S" S (SDF1,SDF2)=0 S:SDALL!$D(SDCL(SDSC)) ^TMP($J,"SC",SDSC,SDN,0)="",SDF1=1 I SDCR,SDCR'=SDSC I (SDALL!$D(SDCL(SDCR))) S SDF2=1,^TMP($J,"SC",SDCR,SDN,1)=""
"RTN","SDCWL3",9,0)
 S:SDS="C" SDF1=1 I SDS="S",'SDF1,'SDF2 Q
"RTN","SDCWL3",10,0)
 ;SD*5.3*540 - added Q:'DFN in 2nd FOR loop
"RTN","SDCWL3",11,0)
 F J=SDBD:0 S J=$O(^SC(I,"S",J)) Q:'J!(J>SDED)  F K=0:0 S K=$O(^SC(I,"S",J,1,K)) Q:'K  I $D(^(K,0)) S DFN=$P(^(0),U) Q:'DFN  S SDOB=$S('$D(^("OB")):0,^("OB")]"":1,1:0) I $D(^DPT(DFN,0)),$D(^("S",J,0)) D PRO^SDCWL2
"RTN","SDCWL3",12,0)
 S SDOB=0 F J=SDBD:0 S J=$O(^DPT("ASDCN",I,J)) Q:'J!(J>SDED)  F K=0:0 S K=$O(^DPT("ASDCN",I,J,K)) Q:'K  I $D(^DPT(K,"S",J,0)),$S($P(^(0),U,2)["C":1,+^(0)'=I:1,1:0) S DFN=K,SDAS="C" D
"RTN","SDCWL3",13,0)
 .S Y=0 F  S Y=$O(^SC(I,"S",J,1,Y)) Q:'Y  I $D(^(Y,0)),DFN=+^(0) Q
"RTN","SDCWL3",14,0)
 .D:'Y PRO1^SDCWL2
"RTN","SDCWL3",15,0)
 Q
"RTN","SDCWL3",16,0)
ERR W @IOF S SDPG=SDPG+1,SDFL=0 W !?37,"***ERRORS***",?70,"PAGE: ",$J(SDPG,4) I $D(^TMP($J,"ERR",1)) W !!,"No stop code assigned to the following clinics:" S I=0 F I1=0:0 S I=$O(^TMP($J,"ERR",1,I)) Q:I=""  W !?3,I S SDFL=1
"RTN","SDCWL3",17,0)
 I $D(^TMP($J,"ERR",2)) W !!,"Invalid pointer to stop code file for the following clinics:" S I=0 F I1=0:0 S I=$O(^TMP($J,"ERR",2,I)) Q:I=""  W !?3,I S SDFL=1
"RTN","SDCWL3",18,0)
 I SDFL W !!,"***APPTS MADE TO CLINICS ABOVE WERE NOT INCLUDED IN WORKLOAD COMPUTATIONS***"
"RTN","SDCWL3",19,0)
 S SDFL=0 I $D(^TMP($J,"ERR",3)) W !!,"Stop code between 900 and 907 assigned to the following clinics:" S I=0 F I1=0:0 S I=$O(^TMP($J,"ERR",3,I)) Q:I=""  W !?3,I S SDFL=1
"RTN","SDCWL3",20,0)
 I $D(^TMP($J,"ERR",4)) W !!,"Credit stop code between 900 and 907 assigned to the following clinics:" S I=0 F I1=0:0 S I=$O(^TMP($J,"ERR",4,I)) Q:I=""  W !?3,I S SDFL=1
"RTN","SDCWL3",21,0)
 I SDFL W !,"***THESE STOP CODES MUST BE CHANGED TO ACTIVE STOP CODES***",!,"***THEY WERE INCLUDED IN WORKLOAD***"
"RTN","SDCWL3",22,0)
 Q
"RTN","SDCWL3",23,0)
LEG I SD1 F S=$Y:1:(IOSL-10) W !
"RTN","SDCWL3",24,0)
 I SD1 W ! F S=3:1:6 W !?11,$P($T(LEG+S),";;",2)
"RTN","SDCWL3",25,0)
 S SD1=1 Q
"RTN","SDCWL3",26,0)
 ;;TOTAL PATIENTS SEEN = SCHED + UNSCHED + INPAT + OVERBOOKS + ADD/EDITS
"RTN","SDCWL3",27,0)
 ;;
"RTN","SDCWL3",28,0)
 ;;CANCELLED APPTS AND NO-SHOWS ARE NOT INCLUDED IN THE ABOVE TOTALS AND
"RTN","SDCWL3",29,0)
 ;;              ARE GIVEN FOR STATISTICAL PURPOSES ONLY.
"RTN","SDCWL3",30,0)
NONE W @IOF,"***CLINIC WORKLOAD REPORTS HAVE RUN -- NO MATCHES FOUND***",!!!,"DATE RANGE: ",SDB,"-",SDE,!,"  DATE RUN: ",SDNOW,!,"SORTED BY ",$S(SDS="C":"CLINIC",1:"STOP CODE"),"(S): ",$S(SDALL!VAUTC:"ALL",1:"") Q:(SDALL!VAUTC)
"RTN","SDCWL3",31,0)
 I SDS="S" F I=0:0 S I=$O(SDCL(I)) Q:'I  W I,", "
"RTN","SDCWL3",32,0)
 I SDS="C" F I=0:0 S I=$O(VAUTC(I)) Q:'I  W VAUTC(I),", "
"RTN","SDCWL3",33,0)
 W !,"FOR DIVISION(S): " W:VAUTD "ALL" I 'VAUTD F I=0:0 S I=$O(VAUTD(I)) Q:'I  W VAUTD(I),", "
"RTN","SDCWL3",34,0)
 Q
"VER")
8.0^22.0
"BLD",7651,6)
^440
**END**
**END**
