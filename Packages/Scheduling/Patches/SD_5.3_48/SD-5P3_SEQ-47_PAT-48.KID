Released SD*5.3*48 SEQ #47
Extracted from mail message
**KIDS**:SD*5.3*48^

**INSTALL NAME**
SD*5.3*48
"BLD",137,0)
SD*5.3*48^SCHEDULING^0^2960910^n
"BLD",137,1,0)
^^5^5^2960809^
"BLD",137,1,1,0)
This contains fixes related to output fixes for the PCMM software
"BLD",137,1,2,0)
(distributed as SD*5.3*41).
"BLD",137,1,3,0)
 
"BLD",137,1,4,0)
Both SD*5.3*41 and SD*5.3*45 must be installed prior to loading this
"BLD",137,1,5,0)
patch.
"BLD",137,4,0)
^9.64PA^^
"BLD",137,"INIT")
SD5348PT
"BLD",137,"KRN",0)
^9.67PA^8994^14
"BLD",137,"KRN",.4,0)
.4
"BLD",137,"KRN",.401,0)
.401
"BLD",137,"KRN",.402,0)
.402
"BLD",137,"KRN",.403,0)
.403
"BLD",137,"KRN",.5,0)
.5
"BLD",137,"KRN",.84,0)
.84
"BLD",137,"KRN",3.6,0)
3.6
"BLD",137,"KRN",9.2,0)
9.2
"BLD",137,"KRN",9.8,0)
9.8
"BLD",137,"KRN",9.8,"NM",0)
^9.68A^12^10
"BLD",137,"KRN",9.8,"NM",1,0)
SCRPEC3^^0^B8325277
"BLD",137,"KRN",9.8,"NM",2,0)
SCRPTP^^0^B23918318
"BLD",137,"KRN",9.8,"NM",4,0)
SCRPPAT2^^0^B26271126
"BLD",137,"KRN",9.8,"NM",6,0)
SCAPMCU1^^0^B30175311
"BLD",137,"KRN",9.8,"NM",7,0)
SCMCTPM^^0^B34670268
"BLD",137,"KRN",9.8,"NM",8,0)
SCRPTM^^0^B27616425
"BLD",137,"KRN",9.8,"NM",9,0)
SD5348EN^^0^B2713535
"BLD",137,"KRN",9.8,"NM",10,0)
SD5348PT^^0^B4312148
"BLD",137,"KRN",9.8,"NM",11,0)
SCRPTP3^^0^B24840745
"BLD",137,"KRN",9.8,"NM",12,0)
SCRPTA^^0^B27808175
"BLD",137,"KRN",9.8,"NM","B","SCAPMCU1",6)

"BLD",137,"KRN",9.8,"NM","B","SCMCTPM",7)

"BLD",137,"KRN",9.8,"NM","B","SCRPEC3",1)

"BLD",137,"KRN",9.8,"NM","B","SCRPPAT2",4)

"BLD",137,"KRN",9.8,"NM","B","SCRPTA",12)

"BLD",137,"KRN",9.8,"NM","B","SCRPTM",8)

"BLD",137,"KRN",9.8,"NM","B","SCRPTP",2)

"BLD",137,"KRN",9.8,"NM","B","SCRPTP3",11)

"BLD",137,"KRN",9.8,"NM","B","SD5348EN",9)

"BLD",137,"KRN",9.8,"NM","B","SD5348PT",10)

"BLD",137,"KRN",19,0)
19
"BLD",137,"KRN",19.1,0)
19.1
"BLD",137,"KRN",101,0)
101
"BLD",137,"KRN",409.61,0)
409.61
"BLD",137,"KRN",8994,0)
8994
"BLD",137,"KRN","B",.4,.4)

"BLD",137,"KRN","B",.401,.401)

"BLD",137,"KRN","B",.402,.402)

"BLD",137,"KRN","B",.403,.403)

"BLD",137,"KRN","B",.5,.5)

"BLD",137,"KRN","B",.84,.84)

"BLD",137,"KRN","B",3.6,3.6)

"BLD",137,"KRN","B",9.2,9.2)

"BLD",137,"KRN","B",9.8,9.8)

"BLD",137,"KRN","B",19,19)

"BLD",137,"KRN","B",19.1,19.1)

"BLD",137,"KRN","B",101,101)

"BLD",137,"KRN","B",409.61,409.61)

"BLD",137,"KRN","B",8994,8994)

"BLD",137,"PRE")
SD5348EN
"BLD",137,"QUES",0)
^9.62^^
"INIT")
SD5348PT
"OER",16,0)
16^SD^^M.A.S.^
"OER",16,1,0)
^100.9951PA^2^2
"OER",16,1,1,0)
103
"OER",16,1,1,1,0)
^100.99511PA^1^1
"OER",16,1,1,1,1,0)
101
"OER",16,1,2,0)
645
"OER",16,1,2,1,0)
^100.99511PA^1^1
"OER",16,1,2,1,1,0)
121
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813
"PKG",16,22,1,"PAH",1,0)
48^2960910^10866
"PKG",16,22,1,"PAH",1,1,0)
^^5^5^2960917
"PKG",16,22,1,"PAH",1,1,1,0)
This contains fixes related to output fixes for the PCMM software
"PKG",16,22,1,"PAH",1,1,2,0)
(distributed as SD*5.3*41).
"PKG",16,22,1,"PAH",1,1,3,0)
 
"PKG",16,22,1,"PAH",1,1,4,0)
Both SD*5.3*41 and SD*5.3*45 must be installed prior to loading this
"PKG",16,22,1,"PAH",1,1,5,0)
patch.
"PRE")
SD5348EN
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
10
"RTN","SCAPMCU1")
0^6^B30175311
"RTN","SCAPMCU1",1,0)
SCAPMCU1 ;ALB/REW - TEAM API UTILITIES ; 30 Jun 95
"RTN","SCAPMCU1",2,0)
 ;;5.3;Scheduling;**41,45,48**;AUG 13, 1993
"RTN","SCAPMCU1",3,0)
 ;;1.0
"RTN","SCAPMCU1",4,0)
INIT(SCOK) ; setup date array &  error arrays if none passed in
"RTN","SCAPMCU1",5,0)
 ;  VARIABLES SET:
"RTN","SCAPMCU1",6,0)
 ;     SCOK - SET TO 0 IF ERROR
"RTN","SCAPMCU1",7,0)
 ;
"RTN","SCAPMCU1",8,0)
 ;  Makes sure the following are defined:
"RTN","SCAPMCU1",9,0)
 ;   scbegin,scend,scincl,@scdates('begin'),@scdates@('end'),@scdates@('incl') - defaults are today & inclusive
"RTN","SCAPMCU1",10,0)
 ;
"RTN","SCAPMCU1",11,0)
 ;    Note: you should NEW the above just before making this call
"RTN","SCAPMCU1",12,0)
 ;                     ---
"RTN","SCAPMCU1",13,0)
 S (SCN,SCESEQ,SCLSEQ)=0
"RTN","SCAPMCU1",14,0)
 IF '$L($G(SCERR)) K ^TMP("SCERR",$J) S SCERR="^TMP(""SCERR"",$J)"
"RTN","SCAPMCU1",15,0)
 IF '$L($G(SCLIST)) S SCLIST="^TMP(""SC TMP LIST"",$J)" K ^TMP("SC TMP LIST",$J)
"RTN","SCAPMCU1",16,0)
 IF (SCERR="SCERR")!(SCERR="SCLIST")!((SCERR'?1A1.7AN)&(SCERR'?1"^"1A.20E)) D  S SCOK=0
"RTN","SCAPMCU1",17,0)
 . S SCPARM("ERROR ARRAY")=$G(SCERR,"Undefined")
"RTN","SCAPMCU1",18,0)
 . D ERR^SCAPMCU1(.SCESEQ,4045101,.SCPARM,"",.SCERR)
"RTN","SCAPMCU1",19,0)
 IF SCLIST="SCERR"!(SCLIST="SCLIST")!((SCLIST'?1A1.7AN.1"(".60E)&(SCLIST'?1"^"1A1.7AN.1"(".60E)) S SCOK=0 D  S SCOK=0
"RTN","SCAPMCU1",20,0)
 . S SCPARM("OUTPUT ARRAY")=$G(SCLIST,"Undefined")
"RTN","SCAPMCU1",21,0)
 . D ERR^SCAPMCU1(.SCESEQ,4045101,.SCPARM,"",.SCERR)
"RTN","SCAPMCU1",22,0)
 S:'$D(SCDATES)!($G(SCDATES)="") SCDATES="SCDTS"
"RTN","SCAPMCU1",23,0)
 S SCBEGIN=$G(@SCDATES@("BEGIN"),DT),SCBEGIN=$S(SCBEGIN:SCBEGIN,1:DT)
"RTN","SCAPMCU1",24,0)
 S SCEND=$G(@SCDATES@("END"),DT),SCEND=$S(SCEND:SCEND,1:DT)
"RTN","SCAPMCU1",25,0)
 S SCINCL=$G(@SCDATES@("INCL"),1)
"RTN","SCAPMCU1",26,0)
 S (SCN,SCESEQ,SCLSEQ)=0
"RTN","SCAPMCU1",27,0)
 S:'$D(@SCDATES@("BEGIN")) @SCDATES@("BEGIN")=SCBEGIN
"RTN","SCAPMCU1",28,0)
 S:'$D(@SCDATES@("END")) @SCDATES@("END")=SCEND
"RTN","SCAPMCU1",29,0)
 S:'$D(@SCDATES@("INCL")) @SCDATES@("INCL")=SCINCL
"RTN","SCAPMCU1",30,0)
 Q
"RTN","SCAPMCU1",31,0)
 ;
"RTN","SCAPMCU1",32,0)
PCPOSCNT(SCTP,DATE,PCONLY) ;this is a more efficient count of PC patients assigned to position
"RTN","SCAPMCU1",33,0)
 ; Input: SCTP - ien to 404.57
"RTN","SCAPMCU1",34,0)
 ;        DATE - date of concern, default=DT
"RTN","SCAPMCU1",35,0)
 ;        PCONLY - 1= must be pc, 0=all assignments 1=DEFAULT
"RTN","SCAPMCU1",36,0)
 ;returns count of patient assignments or -1 if error
"RTN","SCAPMCU1",37,0)
 N SCPTPA,SCCNT
"RTN","SCAPMCU1",38,0)
 Q:'$G(SCTP) -1
"RTN","SCAPMCU1",39,0)
 S DATE=$G(DATE,DT)
"RTN","SCAPMCU1",40,0)
 S:'$L($G(PCONLY)) PCONLY=1
"RTN","SCAPMCU1",41,0)
 S (SCPTPA,SCCNT)=0
"RTN","SCAPMCU1",42,0)
 F  S SCPTPA=$O(^SCPT(404.43,"APTPA",SCTP,SCPTPA)) Q:'SCPTPA  D
"RTN","SCAPMCU1",43,0)
 .S HISTIEN=0
"RTN","SCAPMCU1",44,0)
 .F  S HISTIEN=$O(^SCPT(404.43,"APTPA",SCTP,SCPTPA,HISTIEN)) Q:'HISTIEN  D
"RTN","SCAPMCU1",45,0)
 ..S SCNODE=$G(^SCPT(404.43,HISTIEN,0))
"RTN","SCAPMCU1",46,0)
 ..Q:$P(SCNODE,U,4)&($P(SCNODE,U,4)<DATE)
"RTN","SCAPMCU1",47,0)
 ..Q:$P(SCNODE,U,3)>DATE
"RTN","SCAPMCU1",48,0)
 ..Q:PCONLY&('$P(SCNODE,U,5))  ;pc role is not 1 or 2
"RTN","SCAPMCU1",49,0)
 ..S SCCNT=SCCNT+1
"RTN","SCAPMCU1",50,0)
 Q SCCNT
"RTN","SCAPMCU1",51,0)
 ;
"RTN","SCAPMCU1",52,0)
TEAMCNT(SCTM,DATE) ;this is a more efficient version of the count
"RTN","SCAPMCU1",53,0)
 N DFN,SCCNT,SCNODE,HISTIEN
"RTN","SCAPMCU1",54,0)
 Q:'$G(SCTM) 0
"RTN","SCAPMCU1",55,0)
 S DATE=$G(DATE,DT)
"RTN","SCAPMCU1",56,0)
 S (DFN,SCCNT)=0
"RTN","SCAPMCU1",57,0)
 F  S DFN=$O(^SCPT(404.42,"ATMPT",SCTM,DFN)) Q:'DFN  D
"RTN","SCAPMCU1",58,0)
 .S HISTIEN=0
"RTN","SCAPMCU1",59,0)
 .F  S HISTIEN=$O(^SCPT(404.42,"ATMPT",SCTM,DFN,HISTIEN)) Q:'HISTIEN  D
"RTN","SCAPMCU1",60,0)
 ..S SCNODE=$G(^SCPT(404.42,HISTIEN,0))
"RTN","SCAPMCU1",61,0)
 ..Q:$P(SCNODE,U,9)&($P(SCNODE,U,9)<DATE)
"RTN","SCAPMCU1",62,0)
 ..Q:$P(SCNODE,U,2)>DATE
"RTN","SCAPMCU1",63,0)
 ..S SCCNT=SCCNT+1
"RTN","SCAPMCU1",64,0)
 Q SCCNT
"RTN","SCAPMCU1",65,0)
 ;
"RTN","SCAPMCU1",66,0)
TEAMCNT2(SCTM,DATE) ;this is the count of patients assigned to the team on a date
"RTN","SCAPMCU1",67,0)
 ; Input: SCTM - ien to 404.51
"RTN","SCAPMCU1",68,0)
 ;        DATE - date of concern, default=DT
"RTN","SCAPMCU1",69,0)
 N SCX,SCDATES,SCTEAMS,SCERR,X
"RTN","SCAPMCU1",70,0)
 S SCDATES("BEGIN")=$G(DATE,DT)
"RTN","SCAPMCU1",71,0)
 S SCDATES("END")=SCDATES("BEGIN")
"RTN","SCAPMCU1",72,0)
 S SCX=$$PTTM^SCAPMC(SCTM,"SCDATES","^TMP(""SCTEAMS"",$J,""CNT"")","SCERRX")
"RTN","SCAPMCU1",73,0)
 IF 'SCX S X=-SCX
"RTN","SCAPMCU1",74,0)
 ELSE  D
"RTN","SCAPMCU1",75,0)
 .S DFN=0
"RTN","SCAPMCU1",76,0)
 .F X=0:1 S DFN=$O(^TMP("SCTEAMS",$J,"CNT","SCPTA",DFN)) Q:'DFN
"RTN","SCAPMCU1",77,0)
 K ^TMP("SCTEAMS",$J,"CNT")
"RTN","SCAPMCU1",78,0)
 Q X
"RTN","SCAPMCU1",79,0)
ACTHISTB(FILE,IEN) ;boolean active function
"RTN","SCAPMCU1",80,0)
 ;MOVED TO SCAPMCU2
"RTN","SCAPMCU1",81,0)
 Q $$ACTHISTB^SCAPMCU2(.FILE,.IEN)
"RTN","SCAPMCU1",82,0)
ACTHIST(FILE,IEN,SCDATES,SCERR) ;is entry active for a time period?
"RTN","SCAPMCU1",83,0)
 ;MOVED TO SCAPMCU2
"RTN","SCAPMCU1",84,0)
 Q $$ACTHIST^SCAPMCU2(.FILE,.IEN,.SCDATES,.SCERR)
"RTN","SCAPMCU1",85,0)
 ;
"RTN","SCAPMCU1",86,0)
LASTDATE(FILE,IEN) ;gets last date for team or position from 404.52,404.58,404.59 - uses DATES function below
"RTN","SCAPMCU1",87,0)
 ; Input Parameters:
"RTN","SCAPMCU1",88,0)
 ;    File = either 404.52 or 404.58 or 404.59
"RTN","SCAPMCU1",89,0)
 ;    IEN  = pointer to team(404.51) or team position(404.57)
"RTN","SCAPMCU1",90,0)
 ; Returned:
"RTN","SCAPMCU1",91,0)
 ;  -1 if error,o/w latest date defined 0=no historical dates
"RTN","SCAPMCU1",92,0)
 N SCX
"RTN","SCAPMCU1",93,0)
 S SCX=$$DATES(.FILE,.IEN,3990101) ; gets dates as of 1/1/2999
"RTN","SCAPMCU1",94,0)
 Q $S($P(SCX,U,1)<0:-1,$P(SCX,U,3):$P(SCX,U,3),1:+$P(SCX,U,2))
"RTN","SCAPMCU1",95,0)
 ;
"RTN","SCAPMCU1",96,0)
DATES(FILE,IEN,DATE) ;used by files 404.52, 404.58 & 404.59 to return latest activation date & inactivation date for a practitioner or team or team position for a given date 
"RTN","SCAPMCU1",97,0)
 ; Input Parameters:
"RTN","SCAPMCU1",98,0)
 ;    File = either 404.52 or 404.58 or 404.59
"RTN","SCAPMCU1",99,0)
 ;    IEN  = pointer to team(404.51) or team position(404.57)
"RTN","SCAPMCU1",100,0)
 ;    DATE = default=DT
"RTN","SCAPMCU1",101,0)
 ;  Returned:
"RTN","SCAPMCU1",102,0)
 ;  status^actdate^inactdate^scien^first actdate? [1=yes/null=no]
"RTN","SCAPMCU1",103,0)
ST N ROOT,EFFDT,STATUS,ACTDT,INACTDT,X,FUTURE,PREVDT,SCTODAY,PREVST,SCSTAT,SCIEN,SCLAST
"RTN","SCAPMCU1",104,0)
 S:'$G(DATE) DATE=DT
"RTN","SCAPMCU1",105,0)
 S STATUS=-1,SCTODAY=0
"RTN","SCAPMCU1",106,0)
 S SCSTAT=1
"RTN","SCAPMCU1",107,0)
 G:('$G(FILE))!("^404.52^404.58^404.59^"'[$G(FILE))!('$G(IEN)) QTDATES
"RTN","SCAPMCU1",108,0)
 S ROOT="^SCTM("_FILE_",""AIDT"",IEN,SCSTAT"
"RTN","SCAPMCU1",109,0)
 S EFFDT=-DATE
"RTN","SCAPMCU1",110,0)
 S X=ROOT_")"
"RTN","SCAPMCU1",111,0)
 ;if there is an active x-ref
"RTN","SCAPMCU1",112,0)
 IF $D(@X) D
"RTN","SCAPMCU1",113,0)
 .;if today is an activation date
"RTN","SCAPMCU1",114,0)
 .IF $D(@X@(EFFDT)) S ACTDT=-EFFDT
"RTN","SCAPMCU1",115,0)
 .;if today is not an activation date get previous one
"RTN","SCAPMCU1",116,0)
 .ELSE  D
"RTN","SCAPMCU1",117,0)
 ..S ACTDT=-$O(@X@(EFFDT))
"RTN","SCAPMCU1",118,0)
 .;if no activation in past get one in future
"RTN","SCAPMCU1",119,0)
 .S:'$G(ACTDT) ACTDT=-$O(@X@(EFFDT),-1),FUTURE=1
"RTN","SCAPMCU1",120,0)
 .S SCSTAT=0
"RTN","SCAPMCU1",121,0)
 .S INACTDT=$O(@X@(-(ACTDT-.000001)),-1),INACTDT=$S(INACTDT:-INACTDT,1:INACTDT)
"RTN","SCAPMCU1",122,0)
 .S STATUS=$$DTCHK^SCAPU1(DATE,DATE,0,ACTDT,INACTDT)
"RTN","SCAPMCU1",123,0)
 .S SCSTAT=STATUS
"RTN","SCAPMCU1",124,0)
 .S X=ROOT_","_$S(SCSTAT:-ACTDT,1:-INACTDT)_")"
"RTN","SCAPMCU1",125,0)
 .S SCIEN=$O(@X@(0))
"RTN","SCAPMCU1",126,0)
 ELSE  D
"RTN","SCAPMCU1",127,0)
 .S STATUS=0
"RTN","SCAPMCU1",128,0)
QTDATES Q STATUS_U_$G(ACTDT)_U_$G(INACTDT)_U_$G(SCIEN)_U_$G(FUTURE)
"RTN","SCAPMCU1",129,0)
 ;
"RTN","SCAPMCU1",130,0)
ERR(SEQ,ERNUM,PARMS,OUTPUT,SCER) ;-- process errors
"RTN","SCAPMCU1",131,0)
 ;if no dialog entry 4040000 will be processed
"RTN","SCAPMCU1",132,0)
 S ERNUM=$G(ERNUM,4040000)
"RTN","SCAPMCU1",133,0)
 S:'$$GET1^DIQ(.84,$G(ERNUM)_",",.01) ERNUM=4040000
"RTN","SCAPMCU1",134,0)
 IF SCER]"" D
"RTN","SCAPMCU1",135,0)
 . S SEQ=$G(SEQ,0)+1
"RTN","SCAPMCU1",136,0)
 . S SCER(SEQ)=ERNUM
"RTN","SCAPMCU1",137,0)
 . S @SCER@(0)=$G(@SCER@(0))+1
"RTN","SCAPMCU1",138,0)
 .D BLD^DIALOG(.ERNUM,.PARMS,.OUTPUT,.SCER)
"RTN","SCAPMCU1",139,0)
 Q
"RTN","SCAPMCU1",140,0)
 ;
"RTN","SCAPMCU1",141,0)
OKTMPOS(TEAM,POSITION,DATE) ;validate legitimate position in a team for a dt
"RTN","SCAPMCU1",142,0)
 ; used in screen for pc practitioner position of patient team assngt
"RTN","SCAPMCU1",143,0)
 ;
"RTN","SCAPMCU1",144,0)
 ; TEAM - ien of team file
"RTN","SCAPMCU1",145,0)
 ; POSITION - ien of team position file
"RTN","SCAPMCU1",146,0)
 ; DATE     - date of interest
"RTN","SCAPMCU1",147,0)
 ; return 1 if ok, 0 ow
"RTN","SCAPMCU1",148,0)
 ;
"RTN","SCAPMCU1",149,0)
CHK ;
"RTN","SCAPMCU1",150,0)
 N SCTP,SCOK,SCPOS0
"RTN","SCAPMCU1",151,0)
 S SCOK=0
"RTN","SCAPMCU1",152,0)
 S:'$L($G(SCERR)) SCERR="^TMP(""SCERR"",$J)"
"RTN","SCAPMCU1",153,0)
 IF '$D(^SCTM(404.51,+$G(TEAM),0)) D  G QTOKTP
"RTN","SCAPMCU1",154,0)
 . S SCPARM("TEAM")=$G(TEAM,"Undefined")
"RTN","SCAPMCU1",155,0)
 . D ERR^SCAPMCU1(.SCESEQ,4045101,.SCPARM,"",.SCERR)
"RTN","SCAPMCU1",156,0)
 IF '$D(^SCTM(404.57,+$G(POSITION),0)) D  G QTOKTP
"RTN","SCAPMCU1",157,0)
 . S SCPARM("POSITION")=$G(POSITION,"Undefined")
"RTN","SCAPMCU1",158,0)
 . D ERR^SCAPMCU1(.SCESEQ,4045101,.SCPARM,"",.SCERR)
"RTN","SCAPMCU1",159,0)
 IF '$G(DATE) D  G QTOKTP
"RTN","SCAPMCU1",160,0)
 . S SCPARM("DATE")=$G(DATE,"Undefined")
"RTN","SCAPMCU1",161,0)
 . D ERR^SCAPMCU1(.SCESEQ,4045101,.SCPARM,"",.SCERR)
"RTN","SCAPMCU1",162,0)
 S SCPOS0=$G(^SCTM(404.57,POSITION,0))
"RTN","SCAPMCU1",163,0)
 ;if position not linked to team
"RTN","SCAPMCU1",164,0)
 G QTOKTP:$P(SCPOS0,U,2)'=TEAM
"RTN","SCAPMCU1",165,0)
 ;if not active position
"RTN","SCAPMCU1",166,0)
 G QTOKTP:'$$DATES(404.59,POSITION,DATE)
"RTN","SCAPMCU1",167,0)
 S SCOK=1
"RTN","SCAPMCU1",168,0)
QTOKTP Q SCOK
"RTN","SCAPMCU1",169,0)
RSNDICS(EVCODE) ; -- called by input transform and screen logic for type of reason
"RTN","SCAPMCU1",170,0)
 ; Input: EVCODE = event code (e.g. ZM1)
"RTN","SCAPMCU1",171,0)
 ;  Used to check for fields that point to Scheduling Reason File
"RTN","SCAPMCU1",172,0)
 ;    Piece = Piece number of zero node of 
"RTN","SCAPMCU1",173,0)
 Q $P(^SD(403.43,$P(^(0),U,2),0),U,1)=EVCODE
"RTN","SCAPMCU1",174,0)
 ;
"RTN","SCAPMCU1",175,0)
OKPREC(TEAM) ; - called by screen logic for preceptor position file (#.1) of team position (#404.57) file
"RTN","SCAPMCU1",176,0)
 ;  Input; TEAM = Pointer to team file (#404.51) for team position with preceptor
"RTN","SCAPMCU1",177,0)
 ; requires position being assigned to be a possible preceptor position
"RTN","SCAPMCU1",178,0)
 ;  AND that position is from the same team as the supervised position
"RTN","SCAPMCU1",179,0)
 Q ($P(^SCTM(404.57,Y,0),U,12))&($P(^SCTM(404.57,Y,0),U,2)=TEAM)
"RTN","SCMCTPM")
0^7^B34670268
"RTN","SCMCTPM",1,0)
SCMCTPM ;ALB/REW - Patient Position Changes MailMessages ; 26 Mar 1996
"RTN","SCMCTPM",2,0)
 ;;5.3;Scheduling;**41,45,48**;AUG 13, 1993
"RTN","SCMCTPM",3,0)
 ;1
"RTN","SCMCTPM",4,0)
MAIL ;Do Patient Team Changes MailMan Message
"RTN","SCMCTPM",5,0)
 ; - called by SCMC PT TEAM CHANGES MAIL MESSAGE protocol
"RTN","SCMCTPM",6,0)
 G:$G(SCNOMAIL) END  ;- flag can be set to stop message generation
"RTN","SCMCTPM",7,0)
 N XMDUZ,XMY,XMSUB,XMTEXT,VA,VAERR,XMZ,Y,ZTQUEUED
"RTN","SCMCTPM",8,0)
 N SCTMAR,SCSTAT,DFN,SCNODE,SCY,SCSPACE,SCPAD,SCTPXM,SCLNCNT,SCTPDT,SCPTNM
"RTN","SCMCTPM",9,0)
 S ZTQUEUED=1
"RTN","SCMCTPM",10,0)
 S $P(SCSPACE," ",80)=""
"RTN","SCMCTPM",11,0)
 ;   SCTMAR - ARRAY OF TEAMS (before & after)
"RTN","SCMCTPM",12,0)
 S:SCTMAF SCTMAR(SCTMAF)=""
"RTN","SCMCTPM",13,0)
 S:SCTMB4 SCTMAR(SCTMB4)=""
"RTN","SCMCTPM",14,0)
 S:'SCTPAF SCSTAT="DELETED"
"RTN","SCMCTPM",15,0)
 S:'SCTPB4 SCSTAT="NEW"
"RTN","SCMCTPM",16,0)
 S:SCTPB4&SCTPAF SCSTAT="CHANGED"
"RTN","SCMCTPM",17,0)
 S DFN=$S(SCSTAT="DELETED":+$G(^SCPT(404.42,+SCPTTPB4,0)),1:+$G(^SCPT(404.42,+SCPTTPAF,0)))
"RTN","SCMCTPM",18,0)
 ;set xmy array for practitioners in positions receiving TMchg notices
"RTN","SCMCTPM",19,0)
 G:'$$PCMMXMY^SCAPMC25(3,DFN,"SCTMAR","SCTPDT",0) END
"RTN","SCMCTPM",20,0)
 ;D EN^DDIOL("Sending "_SCSTAT_" Patient-Position Assignment Message")
"RTN","SCMCTPM",21,0)
 D PID^VADPT6
"RTN","SCMCTPM",22,0)
 S SCPTNM=$P(^DPT(DFN,0),U,1)
"RTN","SCMCTPM",23,0)
 S XMSUB=SCSTAT_" PATIENT-POSITION ASSIGNMENT for "_SCPTNM_" ("_VA("PID")_")",XMTEXT="^TMP($J,""SCTPXM"",",SCLNCNT=0
"RTN","SCMCTPM",24,0)
 IF SCSTAT="NEW" D
"RTN","SCMCTPM",25,0)
 .D SETLN("Current Patient Team Data:")
"RTN","SCMCTPM",26,0)
 .D SETLN("==========================")
"RTN","SCMCTPM",27,0)
 .F SCX=1:1:9 D
"RTN","SCMCTPM",28,0)
 ..D SETLN($$TEXT(404.43,SCPTTPAF,SCX,SCSPACE,1))
"RTN","SCMCTPM",29,0)
 IF SCSTAT="DELETED" D
"RTN","SCMCTPM",30,0)
 .D SETLN("Previous Patient Team Data:")
"RTN","SCMCTPM",31,0)
 .D SETLN("===========================")
"RTN","SCMCTPM",32,0)
 .F SCX=1:1:9 S SCFLD=SCX*.01 D
"RTN","SCMCTPM",33,0)
 ..D SETLN($$TEXT(404.43,SCPTTPB4,SCX,SCSPACE,1))
"RTN","SCMCTPM",34,0)
 IF SCSTAT="CHANGED" D
"RTN","SCMCTPM",35,0)
 .D SETLN("Fields: "_$E(SCSPACE,1,19)_"Previous Data:           Current Patient Data:")
"RTN","SCMCTPM",36,0)
 .D SETLN("=======================================================================")
"RTN","SCMCTPM",37,0)
 .F SCX=1:1:9 S SCFLD=SCX*.01 D
"RTN","SCMCTPM",38,0)
 ..N SCLAB2,SCY,SCZ
"RTN","SCMCTPM",39,0)
 ..S SCY=$$TEXT(404.43,SCPTTPB4,SCX,SCSPACE,1)
"RTN","SCMCTPM",40,0)
 ..S:'$L(SCY) SCLAB2=2
"RTN","SCMCTPM",41,0)
 ..S SCZ=$$TEXT(404.43,SCPTTPAF,SCX,SCSPACE,+$G(SCLAB2))
"RTN","SCMCTPM",42,0)
 ..D:$L(SCY)!($L(SCZ)) SETLN(SCY_$E(SCSPACE,1,(52-$L(SCY)))_SCZ)
"RTN","SCMCTPM",43,0)
 S SCLNCNT=$$PCMAIL^SCMCMM(DFN,"^TMP($J,""SCTPXM"")",DT)
"RTN","SCMCTPM",44,0)
 S XMDUZ=$G(DUZ,.5)
"RTN","SCMCTPM",45,0)
 D ^XMD
"RTN","SCMCTPM",46,0)
END K ^TMP($J,"SCTPXM")
"RTN","SCMCTPM",47,0)
 Q
"RTN","SCMCTPM",48,0)
 ;
"RTN","SCMCTPM",49,0)
SETLN(TEXT) ;
"RTN","SCMCTPM",50,0)
 Q:$G(TEXT)=""
"RTN","SCMCTPM",51,0)
 ; increments SCLNCNT, adds text to scTPxm(sclncnt)
"RTN","SCMCTPM",52,0)
 S SCLNCNT=SCLNCNT+1
"RTN","SCMCTPM",53,0)
 S ^TMP($J,"SCTPXM",SCLNCNT)=TEXT
"RTN","SCMCTPM",54,0)
 Q
"RTN","SCMCTPM",55,0)
 ;
"RTN","SCMCTPM",56,0)
TEXT(SCFILE,SCNODE,SCPC,SCSPACE,SCLAB) ;returns fldname & external value
"RTN","SCMCTPM",57,0)
 ;returns fldname & external value
"RTN","SCMCTPM",58,0)
 ;   Note- Only works for non wp fields of standard numbering conventions
"RTN","SCMCTPM",59,0)
 ;   SCFLILE =FILENUM
"RTN","SCMCTPM",60,0)
 ;   SCNODE  = 0 NODE
"RTN","SCMCTPM",61,0)
 ;   SCPC    = piece of node
"RTN","SCMCTPM",62,0)
 ;   SCSPACE = 80 SPACES
"RTN","SCMCTPM",63,0)
 ;   SCLAB = 1 if print field name
"RTN","SCMCTPM",64,0)
 N SCX,SCINT,SCFLD
"RTN","SCMCTPM",65,0)
 S SCX=""
"RTN","SCMCTPM",66,0)
 S SCINT=$P(SCNODE,U,SCPC)
"RTN","SCMCTPM",67,0)
 G:SCINT="" QTTXT
"RTN","SCMCTPM",68,0)
 S SCFLD=SCPC*.01
"RTN","SCMCTPM",69,0)
 ;;;
"RTN","SCMCTPM",70,0)
 IF $G(SCLAB) D
"RTN","SCMCTPM",71,0)
 .S SCX=$$DDNAME^SCMCRU(SCFILE,SCFLD)_":"
"RTN","SCMCTPM",72,0)
 .S:$G(SCLAB)=1 SCX=SCX_$E(SCSPACE,1,(27-$L(SCX)))
"RTN","SCMCTPM",73,0)
 .S:$G(SCLAB)=2 SCX=SCX_$E(SCSPACE,1,(52-$L(SCX)))
"RTN","SCMCTPM",74,0)
 S:SCINT]"" SCX=SCX_$$EXTERNAL^DILFD(SCFILE,SCFLD,"",SCINT)
"RTN","SCMCTPM",75,0)
QTTXT Q SCX
"RTN","SCMCTPM",76,0)
DDNAME(FILE,FIELD) ;return the fieldname
"RTN","SCMCTPM",77,0)
 N SCX
"RTN","SCMCTPM",78,0)
 D FIELD^DID(FILE,FIELD,"","LABEL","SCX")
"RTN","SCMCTPM",79,0)
 Q $G(SCX("LABEL"))
"RTN","SCMCTPM",80,0)
 ;
"RTN","SCMCTPM",81,0)
MAILLST(SCTP,SCFIELDA,SCDATE,SCNEWTP,SCOLDTP,SCBADTP) ;
"RTN","SCMCTPM",82,0)
 ; Input:
"RTN","SCMCTPM",83,0)
 ;    SCTP     - Pointer to Team Position File (#404.57)
"RTN","SCMCTPM",84,0)
 ;    SCFIELDA - Field array with internal values
"RTN","SCMCTPM",85,0)
 ;    SCDATE   - Effective Date
"RTN","SCMCTPM",86,0)
 ;    SCNEWTP  - DFN array of newly assigned to position
"RTN","SCMCTPM",87,0)
 ;    SCOLDTP  - DFN array of previously assigned to position
"RTN","SCMCTPM",88,0)
 ;    SCBADTP  - DFN array of patients unassignable to position
"RTN","SCMCTPM",89,0)
 ;
"RTN","SCMCTPM",90,0)
 G:$G(SCNOMAIL) QTMULT  ;- flag can be set to stop message generation
"RTN","SCMCTPM",91,0)
 G:'$D(SCNEWTP) QTMULT
"RTN","SCMCTPM",92,0)
 G:'$O(@SCNEWTP@(0)) QTMULT  ;if no new assignments
"RTN","SCMCTPM",93,0)
 N XMDUZ,XMY,XMSUB,XMTEXT,VA,VAERR,XMZ,Y,SCTPDT,ZTQUEUED
"RTN","SCMCTPM",94,0)
 N SCTPNM,DFN,SCOK,SCPTNM,SCFLD,SCNODE,SCNDX,SCSPACE,SCE,SCB,SCTMNM,SCDELTEM,SCDETAIL
"RTN","SCMCTPM",95,0)
 S ZTQUEUED=1
"RTN","SCMCTPM",96,0)
 S SCDELTEM=1 ;ok to delete tmp global
"RTN","SCMCTPM",97,0)
 IF $D(SCFIELDA) D
"RTN","SCMCTPM",98,0)
 .IF $D(SCFIELDA(.03)) S SCB=SCFIELDA(.03)
"RTN","SCMCTPM",99,0)
 .IF $D(SCFIELDA(.04)) S SCE=SCFIELDA(.04)
"RTN","SCMCTPM",100,0)
 S SCB=$G(SCB,DT)
"RTN","SCMCTPM",101,0)
 S SCE=$G(SCE,DT)
"RTN","SCMCTPM",102,0)
 S $P(SCSPACE," ",80)=""
"RTN","SCMCTPM",103,0)
 S SCTPDT("BEGIN")=$S(SCB<SCDATE:SCB,1:SCDATE)
"RTN","SCMCTPM",104,0)
 S SCTPDT("END")=$S(SCE>SCDATE:SCE,1:SCDATE)
"RTN","SCMCTPM",105,0)
 S SCTPDT("INCL")=0
"RTN","SCMCTPM",106,0)
 S SCTPNM=$P($G(^SCTM(404.57,+SCTP,0)),U,1)
"RTN","SCMCTPM",107,0)
 S XMSUB="Multiple PATIENT-POSITION ASSIGNMENT for "_SCTPNM,XMTEXT="^TMP($J,""SCTPXM"",",SCLNCNT=0
"RTN","SCMCTPM",108,0)
 D EN^DDIOL("Sending Multiple Patient-Position Assignment Message")
"RTN","SCMCTPM",109,0)
 S SCOK=1
"RTN","SCMCTPM",110,0)
 S SCTPNM=$P($G(^SCTM(404.57,+SCTP,0)),U,1)
"RTN","SCMCTPM",111,0)
 S SCTMNM=$P($G(^SCTM(404.51,+$P($G(^SCTM(404.57,+SCTP,0)),U,2),0)),U,1)
"RTN","SCMCTPM",112,0)
 D SETLN("Team:                  "_SCTMNM)
"RTN","SCMCTPM",113,0)
 D SETLN("Position:              "_SCTPNM)
"RTN","SCMCTPM",114,0)
 S Y=SCDATE X ^DD("DD")
"RTN","SCMCTPM",115,0)
 D SETLN("Effective Date:        "_Y)
"RTN","SCMCTPM",116,0)
 D SETLN(" ")
"RTN","SCMCTPM",117,0)
 IF $D(SCFIELDA) D
"RTN","SCMCTPM",118,0)
 .F SCNDX=1:1:14 S SCFLD=SCNDX*.01 IF $D(SCFIELDA(SCFLD)) D
"RTN","SCMCTPM",119,0)
 ..S $P(SCNODE,U,SCNDX)=SCFIELDA(SCFLD)
"RTN","SCMCTPM",120,0)
 ..D SETLN($$TEXT(404.43,SCNODE,SCNDX,SCSPACE,1))
"RTN","SCMCTPM",121,0)
 D SETLN(" ")
"RTN","SCMCTPM",122,0)
 D SETLN("There has been a new position assignment for the following patients:")
"RTN","SCMCTPM",123,0)
 S DFN=0
"RTN","SCMCTPM",124,0)
NEW F  S DFN=$O(@SCNEWTP@(DFN)) Q:'DFN  D
"RTN","SCMCTPM",125,0)
 .S:$$PCMMXMY^SCAPMC25(3,DFN,,"SCTPDT",0) SCOK=0
"RTN","SCMCTPM",126,0)
 .D PID^VADPT6
"RTN","SCMCTPM",127,0)
 .S SCPTNM=$P(^DPT(DFN,0),U,1)
"RTN","SCMCTPM",128,0)
 .S ^TMP("SCTP MAIL LST",$J,SCTP,1,DFN)=("    "_SCPTNM_" ("_VA("PID")_")")
"RTN","SCMCTPM",129,0)
 .S ^TMP("SCTP MAIL LST",$J,SCTP,1,"B",SCPTNM,DFN)=""
"RTN","SCMCTPM",130,0)
 S SCPTNM=""
"RTN","SCMCTPM",131,0)
 F  S SCPTNM=$O(^TMP("SCTP MAIL LST",$J,SCTP,1,"B",SCPTNM)) Q:SCPTNM']""  D
"RTN","SCMCTPM",132,0)
 .S DFN=0
"RTN","SCMCTPM",133,0)
 .F  S DFN=$O(^TMP("SCTP MAIL LST",$J,SCTP,1,"B",SCPTNM,DFN)) Q:'DFN  D
"RTN","SCMCTPM",134,0)
 ..S SCDETAIL=$G(^TMP("SCTP MAIL LST",$J,SCTP,1,DFN)) Q:SCDETAIL']""  D SETLN(SCDETAIL)
"RTN","SCMCTPM",135,0)
BAD IF $O(@SCBADTP@(0)) D
"RTN","SCMCTPM",136,0)
 .D SETLN(" ")
"RTN","SCMCTPM",137,0)
 .D SETLN("There has been NO new position assignment for the following patients:")
"RTN","SCMCTPM",138,0)
 .S DFN=0
"RTN","SCMCTPM",139,0)
 .F  S DFN=$O(@SCBADTP@(DFN)) Q:'DFN  D
"RTN","SCMCTPM",140,0)
 ..S:$$PCMMXMY^SCAPMC25(3,DFN,,"SCTPDT",0) SCOK=0
"RTN","SCMCTPM",141,0)
 ..S SCPTNM=$P(^DPT(DFN,0),U,1)
"RTN","SCMCTPM",142,0)
 ..D PID^VADPT6
"RTN","SCMCTPM",143,0)
 ..S ^TMP("SCTP MAIL LST",$J,SCTP,2,DFN)=("    "_SCPTNM_" ("_VA("PID")_")")
"RTN","SCMCTPM",144,0)
 ..S ^TMP("SCTP MAIL LST",$J,SCTP,2,"B",SCPTNM,DFN)=""
"RTN","SCMCTPM",145,0)
 .S SCPTNM=""
"RTN","SCMCTPM",146,0)
 .F  S SCPTNM=$O(^TMP("SCTP MAIL LST",$J,SCTP,2,"B",SCPTNM)) Q:SCPTNM']""  D
"RTN","SCMCTPM",147,0)
 ..S DFN=0
"RTN","SCMCTPM",148,0)
 ..F  S DFN=$O(^TMP("SCTP MAIL LST",$J,SCTP,2,"B",SCPTNM,DFN)) Q:'DFN  D
"RTN","SCMCTPM",149,0)
 ...S SCDETAIL=$G(^TMP("SCTP MAIL LST",$J,SCTP,2,DFN)) Q:SCDETAIL']""  D SETLN(SCDETAIL)
"RTN","SCMCTPM",150,0)
 S XMDUZ=$G(DUZ,.5)
"RTN","SCMCTPM",151,0)
 D ^XMD
"RTN","SCMCTPM",152,0)
QTMULT K:$G(SCDELTEM) ^TMP("SCTP MAIL LST",$J,SCTP)
"RTN","SCMCTPM",153,0)
 K ^TMP($J,"SCTPXM")
"RTN","SCMCTPM",154,0)
 Q
"RTN","SCRPEC3")
0^1^B8325277
"RTN","SCRPEC3",1,0)
SCRPEC3 ;ALB/CMM - Detail List of Pts & Enroll Clinics ;01/17/96
"RTN","SCRPEC3",2,0)
 ;;5.3;Scheduling;**41,48**;AUG 13, 1993
"RTN","SCRPEC3",3,0)
 ;
"RTN","SCRPEC3",4,0)
 ;Detailed Listing of Patients and Their Enrolled Clinics Report
"RTN","SCRPEC3",5,0)
 ;
"RTN","SCRPEC3",6,0)
FIND ;
"RTN","SCRPEC3",7,0)
 N TIEN,OKAY,PTLIST,ERR
"RTN","SCRPEC3",8,0)
 I TEAM=1 D TALL^SCRPPAT3 ;get all teams for all divisions selected
"RTN","SCRPEC3",9,0)
 S TIEN=0,PTLIST="^TMP(""SCLIST"","_$J_")",ERR="ERROR"
"RTN","SCRPEC3",10,0)
 K @PTLIST
"RTN","SCRPEC3",11,0)
 F  S TIEN=$O(TEAM(TIEN)) Q:TIEN=""!(TIEN'?.N)  D
"RTN","SCRPEC3",12,0)
 .K @PTLIST,@ERR
"RTN","SCRPEC3",13,0)
 .S OKAY=$$PTTM^SCAPMC2(TIEN,"",.PTLIST,.ERR)
"RTN","SCRPEC3",14,0)
 .Q:'OKAY
"RTN","SCRPEC3",15,0)
 .D PAT^SCRPEC2(TIEN,.PTLIST)
"RTN","SCRPEC3",16,0)
 K @PTLIST
"RTN","SCRPEC3",17,0)
 Q
"RTN","SCRPEC3",18,0)
 ;
"RTN","SCRPEC3",19,0)
PRINTIT(STORE,IOP,TITL) ;
"RTN","SCRPEC3",20,0)
 ;print title
"RTN","SCRPEC3",21,0)
 D OPEN^SCRPU3
"RTN","SCRPEC3",22,0)
 N INS,EINST,ETEAM,TEAM,ECLN,CLINIC,PAGE,FIRST,PTIEN,PTNAME
"RTN","SCRPEC3",23,0)
 S PAGE=1,STOP=0
"RTN","SCRPEC3",24,0)
 D TITLE^SCRPU3(.PAGE,TITL)
"RTN","SCRPEC3",25,0)
 S (INS,EINST)=""
"RTN","SCRPEC3",26,0)
 S FIRST=0
"RTN","SCRPEC3",27,0)
 F  S EINST=$O(@STORE@("I",EINST)) Q:EINST=""!(STOP)  D
"RTN","SCRPEC3",28,0)
 .S INS=$O(@STORE@("I",EINST,INS))
"RTN","SCRPEC3",29,0)
 .Q:INS=""
"RTN","SCRPEC3",30,0)
 .I FIRST,IOST'?1"C-".E D NEWP1^SCRPU3(.PAGE,TITL)
"RTN","SCRPEC3",31,0)
 .I FIRST,IOST?1"C-".E D HOLD^SCRPU3(.PAGE,TITL)
"RTN","SCRPEC3",32,0)
 .Q:STOP
"RTN","SCRPEC3",33,0)
 .I IOST'?1"C-".E,$Y>(IOSL-8) D NEWP1^SCRPU3(.PAGE,TITL)
"RTN","SCRPEC3",34,0)
 .I IOST?1"C-".E,$Y>(IOSL-8) D HOLD^SCRPU3(.PAGE,TITL)
"RTN","SCRPEC3",35,0)
 .Q:STOP!INS=""
"RTN","SCRPEC3",36,0)
 .W !,$G(@STORE@(INS)) ;write institution
"RTN","SCRPEC3",37,0)
 .S FIRST=1
"RTN","SCRPEC3",38,0)
 .S (ETEAM,TEAM)=""
"RTN","SCRPEC3",39,0)
 .F  W ! S ETEAM=$O(@STORE@("T",INS,ETEAM)) Q:ETEAM=""!(STOP)  D
"RTN","SCRPEC3",40,0)
 ..S TEAM=$O(@STORE@("T",INS,ETEAM,""))
"RTN","SCRPEC3",41,0)
 ..I IOST'?1"C-".E,$Y>(IOSL-8) D NEWP1^SCRPU3(.PAGE,TITL) W:'STOP !,$G(@STORE@(INS))
"RTN","SCRPEC3",42,0)
 ..I IOST?1"C-".E,$Y>(IOSL-8) D HOLD^SCRPU3(.PAGE,TITL) W:'STOP !,$G(@STORE@(INS))
"RTN","SCRPEC3",43,0)
 ..I STOP Q
"RTN","SCRPEC3",44,0)
 ..W !!,$G(@STORE@(INS,TEAM)) ;write team
"RTN","SCRPEC3",45,0)
 ..S (ECLN,CLINIC)=0
"RTN","SCRPEC3",46,0)
 ..F  S ECLN=$O(@STORE@("C",INS,TEAM,ECLN)) Q:ECLN=""!(STOP)  D
"RTN","SCRPEC3",47,0)
 ...S CLINIC=$O(@STORE@("C",INS,TEAM,ECLN,""))
"RTN","SCRPEC3",48,0)
 ...W !
"RTN","SCRPEC3",49,0)
 ...D CHEAD^SCRPEC2(INS,TEAM,CLINIC)
"RTN","SCRPEC3",50,0)
 ...S PTNAME=""
"RTN","SCRPEC3",51,0)
 ...F  S PTNAME=$O(@STORE@("PT",INS,TEAM,CLINIC,PTNAME)) Q:PTNAME=""!(STOP)  D
"RTN","SCRPEC3",52,0)
 ....S PTIEN=$O(@STORE@("PT",INS,TEAM,CLINIC,PTNAME,""))
"RTN","SCRPEC3",53,0)
 ....I IOST'?1"C-".E,$Y>(IOSL-8) D NEWP1^SCRPU3(.PAGE,TITL) Q:STOP  W !,$G(@STORE@(INS)),!!,$G(@STORE@(INS,TEAM)),! D CHEAD^SCRPEC2(INS,TEAM,CLINIC)
"RTN","SCRPEC3",54,0)
 ....I IOST?1"C-".E,$Y>(IOSL-8) D HOLD^SCRPU3(.PAGE,TITL) Q:STOP  W !,$G(@STORE@(INS)),!!,$G(@STORE@(INS,TEAM)),! D CHEAD^SCRPEC2(INS,TEAM,CLINIC)
"RTN","SCRPEC3",55,0)
 ....Q:STOP
"RTN","SCRPEC3",56,0)
 ....W !,$G(@STORE@(INS,TEAM,CLINIC,PTIEN))
"RTN","SCRPEC3",57,0)
 D CLOSE^SCRPU3
"RTN","SCRPEC3",58,0)
 Q
"RTN","SCRPEC3",59,0)
 ;
"RTN","SCRPPAT2")
0^4^B26271126
"RTN","SCRPPAT2",1,0)
SCRPPAT2 ;ALB/CMM - Practitioner's Patients ;02/20/96
"RTN","SCRPPAT2",2,0)
 ;;5.3;Scheduling;**41,48**;AUG 13, 1993
"RTN","SCRPPAT2",3,0)
 ;
"RTN","SCRPPAT2",4,0)
 ;Listing of Practitioner's Patients
"RTN","SCRPPAT2",5,0)
 ;
"RTN","SCRPPAT2",6,0)
DRIVE ;
"RTN","SCRPPAT2",7,0)
 ;driver module
"RTN","SCRPPAT2",8,0)
 N PRAC,INF,ARRY,ERROR,NXT,OKAY,PIEN
"RTN","SCRPPAT2",9,0)
 S ARRY="^TMP(""SCARRAY"","_$J_")",ERROR="ERR"
"RTN","SCRPPAT2",10,0)
 K @ARRY,@ERROR
"RTN","SCRPPAT2",11,0)
 I PRACT=1 D ALL^SCRPPAT3 ;all practitioners selected
"RTN","SCRPPAT2",12,0)
 S NXT=0
"RTN","SCRPPAT2",13,0)
 F  S NXT=$O(PRACT(NXT)) Q:NXT=""!(NXT'?.N)  D
"RTN","SCRPPAT2",14,0)
 .I PRACT=0 S PIEN=NXT
"RTN","SCRPPAT2",15,0)
 .I PRACT=1 S PIEN=$P(PRACT(NXT),"^")
"RTN","SCRPPAT2",16,0)
 .K @ARRY,@ERROR
"RTN","SCRPPAT2",17,0)
 .S OKAY=$$PTPR^SCAPMC14(PIEN,"","","",ARRY,ERROR) ;patients for practitioner
"RTN","SCRPPAT2",18,0)
 .I '+OKAY Q
"RTN","SCRPPAT2",19,0)
 .D LOOPPT(ARRY,PIEN) ;loop through patients for practitioner
"RTN","SCRPPAT2",20,0)
 K @ARRY,@ERROR
"RTN","SCRPPAT2",21,0)
 Q
"RTN","SCRPPAT2",22,0)
 ;
"RTN","SCRPPAT2",23,0)
LOOPPT(ARY,PRAC) ;loop through patients for practitioner
"RTN","SCRPPAT2",24,0)
 ;ARY - array of patients for selected practitioner
"RTN","SCRPPAT2",25,0)
 ;PRAC - practitioner ien
"RTN","SCRPPAT2",26,0)
 N NXT,PIEN,TPIEN,PNAME,TPIEN,NODE,PTP,TPI,TPN,CLIEN,CNAME,PTA,PTAN,TIEN
"RTN","SCRPPAT2",27,0)
 N PC,TNODE,TNAME,PINF,POSN
"RTN","SCRPPAT2",28,0)
 S NXT=0
"RTN","SCRPPAT2",29,0)
 F  S NXT=$O(@ARY@(NXT)) Q:NXT=""!(NXT'?.N)  D
"RTN","SCRPPAT2",30,0)
 .S NODE=$G(@ARY@(NXT))
"RTN","SCRPPAT2",31,0)
 .Q:NODE=""
"RTN","SCRPPAT2",32,0)
 .S PIEN=+$P(NODE,"^") ;ien of patient file entry
"RTN","SCRPPAT2",33,0)
 .S TPIEN=+$P(NODE,"^",3) ;ien of patient team position assignment
"RTN","SCRPPAT2",34,0)
 .S PTP=$G(^SCPT(404.43,TPIEN,0))
"RTN","SCRPPAT2",35,0)
 .Q:PTP=""
"RTN","SCRPPAT2",36,0)
 .S PTA=+$P(PTP,"^") ;patient team assignment ien (404.42)
"RTN","SCRPPAT2",37,0)
 .S PTAN=$G(^SCPT(404.42,PTA,0))
"RTN","SCRPPAT2",38,0)
 .Q:PTAN=""
"RTN","SCRPPAT2",39,0)
 .S TIEN=+$P(PTAN,"^",3) ;team file ien (404.51)
"RTN","SCRPPAT2",40,0)
 .I '$D(TEAM(TIEN))&(TEAM'=1) Q  ;not a selected team
"RTN","SCRPPAT2",41,0)
 .S TNODE=$G(^SCTM(404.51,TIEN,0))
"RTN","SCRPPAT2",42,0)
 .Q:TNODE=""
"RTN","SCRPPAT2",43,0)
 .S TNAME=$P(TNODE,"^") ;team name
"RTN","SCRPPAT2",44,0)
 .S TPI=+$P(PTP,"^",2) ;Team Position file ien (404.57)
"RTN","SCRPPAT2",45,0)
 .S TPN=$G(^SCTM(404.57,TPI,0))
"RTN","SCRPPAT2",46,0)
 .Q:TPN=""
"RTN","SCRPPAT2",47,0)
 .S POSN=$P(TPN,"^") ;position name
"RTN","SCRPPAT2",48,0)
 .S CLIEN=+$P(TPN,"^",9) ;associated clinic ien
"RTN","SCRPPAT2",49,0)
 .D CECHK(CLIEN,.CNAME,PIEN) ;is patient enrolled in associated clinic?
"RTN","SCRPPAT2",50,0)
 .;S CNAME=$P($G(^SC(CLIEN,0)),"^") ;clinic name
"RTN","SCRPPAT2",51,0)
 .S PC=$S($P(PTP,"^",5)=0:0,1:1) ;primary care position 1or2-yes/0-no
"RTN","SCRPPAT2",52,0)
 .S PNAME=$P($G(^VA(200,+PRAC,0)),"^") ;practitioner name
"RTN","SCRPPAT2",53,0)
 .Q:PNAME=""
"RTN","SCRPPAT2",54,0)
 .;
"RTN","SCRPPAT2",55,0)
 .S PINF=PIEN_"^"_$$PDATA^SCRPEC(PIEN,CLIEN,1)
"RTN","SCRPPAT2",56,0)
 .;$$PDATA returns pt name,pid,mt,pelig,status,status date,last appt,nxt appt
"RTN","SCRPPAT2",57,0)
 .;
"RTN","SCRPPAT2",58,0)
 .D FORMAT(CNAME,PINF,PC,TIEN,TNAME,PRAC,PNAME,POSN,TPI) ;formats data for display
"RTN","SCRPPAT2",59,0)
 Q
"RTN","SCRPPAT2",60,0)
 ;
"RTN","SCRPPAT2",61,0)
CECHK(CLIEN,CNAME,PIEN) ;
"RTN","SCRPPAT2",62,0)
 ;CLIEN - clinic ien
"RTN","SCRPPAT2",63,0)
 ;CNAME - clinic name returned if patient is enrolled in clien clinic
"RTN","SCRPPAT2",64,0)
 ;PIEN - patien ien
"RTN","SCRPPAT2",65,0)
 ;
"RTN","SCRPPAT2",66,0)
 N EN,NODE
"RTN","SCRPPAT2",67,0)
 S CNAME=""
"RTN","SCRPPAT2",68,0)
 I $D(^DPT(PIEN,"DE","B",CLIEN)) D
"RTN","SCRPPAT2",69,0)
 .;enrolled at one time, check if discharged
"RTN","SCRPPAT2",70,0)
 .S EN=$O(^DPT(PIEN,"DE","B",CLIEN,""))
"RTN","SCRPPAT2",71,0)
 .S NODE=$G(^DPT(PIEN,"DE",EN,0))
"RTN","SCRPPAT2",72,0)
 .Q:NODE=""
"RTN","SCRPPAT2",73,0)
 .I $P(NODE,"^",3)="" S CNAME=$P($G(^SC(CLIEN,0)),"^") ;clinic name
"RTN","SCRPPAT2",74,0)
 .I $P(NODE,"^",3)'="",$P(NODE,"^",3)>DT S CNAME=$P($G(^SC(CLIEN,0)),"^") ;clinic name
"RTN","SCRPPAT2",75,0)
 Q
"RTN","SCRPPAT2",76,0)
 ;
"RTN","SCRPPAT2",77,0)
FORMAT(CNAME,PINF,PC,TIEN,TNAME,PRAC,PNAME,POSN,TPI) ; format data for display
"RTN","SCRPPAT2",78,0)
 ;CNAME - clinic name
"RTN","SCRPPAT2",79,0)
 ;PINF - patient/clinic data
"RTN","SCRPPAT2",80,0)
 ;PC - primary care 1/0
"RTN","SCRPPAT2",81,0)
 ;TIEN - team file ien (#404.51)
"RTN","SCRPPAT2",82,0)
 ;TNAME - team name
"RTN","SCRPPAT2",83,0)
 ;PRAC - practitioner ien (#200)
"RTN","SCRPPAT2",84,0)
 ;PNAME - practitioner name
"RTN","SCRPPAT2",85,0)
 ;POSN - position name
"RTN","SCRPPAT2",86,0)
 ;TPI - team position ien (#404.57)
"RTN","SCRPPAT2",87,0)
 ;
"RTN","SCRPPAT2",88,0)
 N IIEN,INAME,ERR
"RTN","SCRPPAT2",89,0)
 S ERR=$$SETUP^SCRPPAT3(.IIEN,.INAME,TIEN,TNAME,PRAC,PNAME,POSN,TPI)
"RTN","SCRPPAT2",90,0)
 I ERR Q
"RTN","SCRPPAT2",91,0)
 ;
"RTN","SCRPPAT2",92,0)
 I SORT=1 D STOR(IIEN,TIEN,PRAC,PINF,PNAME,TNAME,TPI) ;sort division,team,practitioner
"RTN","SCRPPAT2",93,0)
 I SORT=2 D STOR(IIEN,PRAC,TIEN,PINF,PNAME,TNAME,TPI) ;sort division,practitioner,team
"RTN","SCRPPAT2",94,0)
 ;
"RTN","SCRPPAT2",95,0)
 Q
"RTN","SCRPPAT2",96,0)
 ;
"RTN","SCRPPAT2",97,0)
STOR(IIEN,SEC,TRD,PINF,PNAME,TNAME,TPI) ;
"RTN","SCRPPAT2",98,0)
 ;IIEN - ien institution
"RTN","SCRPPAT2",99,0)
 ;SEC - second sort subscript, IEN team or IEN practitioner
"RTN","SCRPPAT2",100,0)
 ;TRD - third sort subscript, IEN team or IEN practitioner
"RTN","SCRPPAT2",101,0)
 ;PINF - patient/clinic info
"RTN","SCRPPAT2",102,0)
 ;PNAME - practitioner name
"RTN","SCRPPAT2",103,0)
 ;TNAME - team name
"RTN","SCRPPAT2",104,0)
 ;TPI - team position ien
"RTN","SCRPPAT2",105,0)
 ;
"RTN","SCRPPAT2",106,0)
 N PIEN,PTNAME,PID
"RTN","SCRPPAT2",107,0)
 S PIEN=+$P(PINF,"^") ;patient ien 
"RTN","SCRPPAT2",108,0)
 S PTNAME=$E($P(PINF,"^",2),1,15) ;patient name
"RTN","SCRPPAT2",109,0)
 I $D(@STORE@("PT",IIEN,SEC,TRD,TPI,PTNAME,PIEN)) Q
"RTN","SCRPPAT2",110,0)
 ;
"RTN","SCRPPAT2",111,0)
 S @STORE@("PT",IIEN,SEC,TRD,TPI,PTNAME,PIEN)=""
"RTN","SCRPPAT2",112,0)
 ;
"RTN","SCRPPAT2",113,0)
 I '$D(@STORE@("PTOT",IIEN,SEC,TRD,PIEN)) D
"RTN","SCRPPAT2",114,0)
 .;count each unique patient for any given practitioner for grand total
"RTN","SCRPPAT2",115,0)
 .S @STORE@("PTOT",IIEN,SEC,TRD,PIEN)=""
"RTN","SCRPPAT2",116,0)
 .S @STORE@("TOTAL",IIEN,PRAC,0)=$G(@STORE@("TOTAL",IIEN,PRAC,0))+1 ;patient count by practitioner
"RTN","SCRPPAT2",117,0)
 ;
"RTN","SCRPPAT2",118,0)
 S @STORE@("TOTAL",IIEN,PRAC,TIEN,TPI)=$G(@STORE@("TOTAL",IIEN,PRAC,TIEN,TPI))+1 ;patient count by practitioner and team
"RTN","SCRPPAT2",119,0)
 ;
"RTN","SCRPPAT2",120,0)
 S @STORE@(IIEN,SEC,TRD,TPI,PIEN)=PTNAME
"RTN","SCRPPAT2",121,0)
 S PID=$P(PINF,"^",3),PID=$TR(PID,"-","")
"RTN","SCRPPAT2",122,0)
 S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),18)=$E(PID,6,10) ;last 4 pid - 5 places is for any pseudo
"RTN","SCRPPAT2",123,0)
 S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),25)=$P(PINF,"^",4) ;means test status
"RTN","SCRPPAT2",124,0)
 S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),29)=$P(PINF,"^",5) ;eligibility
"RTN","SCRPPAT2",125,0)
 S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),40)=$P(PINF,"^",6) ;patient status
"RTN","SCRPPAT2",126,0)
 S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),45)=$P(PINF,"^",8) ;last appt
"RTN","SCRPPAT2",127,0)
 S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),55)=$P(PINF,"^",9) ;nxt appt
"RTN","SCRPPAT2",128,0)
 S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),65)=$E(CNAME,1,15) ;clinic
"RTN","SCRPPAT2",129,0)
 ;
"RTN","SCRPPAT2",130,0)
 Q
"RTN","SCRPPAT2",131,0)
 ;
"RTN","SCRPTA")
0^12^B27808175
"RTN","SCRPTA",1,0)
SCRPTA ;ALB/CMM - Patient Listing w/Team Assignment Data ;02/22/96
"RTN","SCRPTA",2,0)
 ;;5.3;Scheduling;**41,48**;AUG 13, 1993
"RTN","SCRPTA",3,0)
 ;
"RTN","SCRPTA",4,0)
 ;Patient Listing w/Team Assignment Data Report
"RTN","SCRPTA",5,0)
 ;
"RTN","SCRPTA",6,0)
PROMPTS ;
"RTN","SCRPTA",7,0)
 ;Prompt for Institution, Team, Role, Practitioner and Print device
"RTN","SCRPTA",8,0)
 ;
"RTN","SCRPTA",9,0)
 N PRNT,QTIME,NUMBER
"RTN","SCRPTA",10,0)
 K VAUTD,VAUTT,VAUTR,VAUTP,VAUTPP,SCUP
"RTN","SCRPTA",11,0)
 S QTIME=""
"RTN","SCRPTA",12,0)
 D INST^SCRPU1 I Y=-1 G ERR
"RTN","SCRPTA",13,0)
 K Y D PRMTT^SCRPU1 I '$D(VAUTT) G ERR
"RTN","SCRPTA",14,0)
 K Y D ROLE^SCRPU1 I '$D(VAUTR) G ERR
"RTN","SCRPTA",15,0)
 K Y S VAUTPP="" D PRACT^SCRPU1 K VAUTPP I '$D(VAUTP) G ERR
"RTN","SCRPTA",16,0)
 S PRNT=$$PDEVICE^SCRPU3()
"RTN","SCRPTA",17,0)
 I PRNT=-1 G ERR
"RTN","SCRPTA",18,0)
 I PRNT["Q;" S QTIME=$$GETTIME^SCRPU3()
"RTN","SCRPTA",19,0)
 I QTIME=-1 G ERR
"RTN","SCRPTA",20,0)
 I PRNT'?1"Q;".E S PRNT="Q;"_PRNT
"RTN","SCRPTA",21,0)
 K Y
"RTN","SCRPTA",22,0)
 S NUMBER=$$ENTRY2(.VAUTD,.VAUTT,.VAUTR,.VAUTP,PRNT,QTIME)
"RTN","SCRPTA",23,0)
 I NUMBER>0 W !!,"Print queued, task number: ",NUMBER
"RTN","SCRPTA",24,0)
 Q
"RTN","SCRPTA",25,0)
 ;
"RTN","SCRPTA",26,0)
ENTRY2(INST,TEAM,ROLE,PRACT,IOP,ZTDTH) ;
"RTN","SCRPTA",27,0)
 ;Second entry point for GUI to use
"RTN","SCRPTA",28,0)
 ;Input Parameters:
"RTN","SCRPTA",29,0)
 ;INST - institutions selected (variable and array)
"RTN","SCRPTA",30,0)
 ;TEAM - teams selected (variable and array)
"RTN","SCRPTA",31,0)
 ;ROLE - roles selected (variable and array)
"RTN","SCRPTA",32,0)
 ;PRACT - practitioners selected (variable and array)
"RTN","SCRPTA",33,0)
 ;IOP - print device
"RTN","SCRPTA",34,0)
 ;ZTDTH - queue time (optional)
"RTN","SCRPTA",35,0)
 ;
"RTN","SCRPTA",36,0)
 ;validate parameters
"RTN","SCRPTA",37,0)
 I '$D(INST)!'$D(TEAM)!'$D(ROLE)!'$D(PRACT)!'$D(IOP)!(IOP="") Q
"RTN","SCRPTA",38,0)
 ;
"RTN","SCRPTA",39,0)
 N NUMBER
"RTN","SCRPTA",40,0)
 S IOST=$P(IOP,"^",2),IOP=$P(IOP,"^")
"RTN","SCRPTA",41,0)
 I IOP?1"Q;".E S IOP=$P(IOP,"Q;",2)
"RTN","SCRPTA",42,0)
 I IOST?1"C-".E D QENTRY G RET
"RTN","SCRPTA",43,0)
 I ZTDTH="" S ZTDTH=$H
"RTN","SCRPTA",44,0)
 S ZTRTN="QENTRY^SCRPTA"
"RTN","SCRPTA",45,0)
 S ZTDESC="Patient Listing w/Team Assignment",ZTIO=IOP
"RTN","SCRPTA",46,0)
 N II
"RTN","SCRPTA",47,0)
 F II="INST","TEAM","ROLE","INST(","TEAM(","PRACT","PRACT(","ROLE(","IOP" S ZTSAVE(II)=""
"RTN","SCRPTA",48,0)
 D ^%ZTLOAD
"RTN","SCRPTA",49,0)
RET S NUMBER=0
"RTN","SCRPTA",50,0)
 I $D(ZTSK) S NUMBER=ZTSK
"RTN","SCRPTA",51,0)
 D EXIT1
"RTN","SCRPTA",52,0)
 Q NUMBER
"RTN","SCRPTA",53,0)
 ;
"RTN","SCRPTA",54,0)
QENTRY ;
"RTN","SCRPTA",55,0)
 ;driver entry point
"RTN","SCRPTA",56,0)
 S TITL="Patient Listing w/Team Assignment Data"
"RTN","SCRPTA",57,0)
 S STORE="^TMP("_$J_",""SCRPTA"")"
"RTN","SCRPTA",58,0)
 K @STORE
"RTN","SCRPTA",59,0)
 S @STORE=0
"RTN","SCRPTA",60,0)
 I TEAM=1 D TALL^SCRPPAT3 S TEAM=0
"RTN","SCRPTA",61,0)
 D FIND
"RTN","SCRPTA",62,0)
 I $O(@STORE@(0))="" S NODATA=$$NODATA^SCRPU3(TITL)
"RTN","SCRPTA",63,0)
 I '$D(NODATA) D PRINTIT(STORE,IOP,TITL)
"RTN","SCRPTA",64,0)
 D EXIT2
"RTN","SCRPTA",65,0)
 Q
"RTN","SCRPTA",66,0)
 ;
"RTN","SCRPTA",67,0)
ERR ;
"RTN","SCRPTA",68,0)
EXIT1 ;
"RTN","SCRPTA",69,0)
 K ZTDTH,ZTRTN,ZTDESC,ZTSK,ZTIO,ZTSAVE,Y,SCUP
"RTN","SCRPTA",70,0)
 Q
"RTN","SCRPTA",71,0)
 ;
"RTN","SCRPTA",72,0)
EXIT2 ;
"RTN","SCRPTA",73,0)
 K @STORE
"RTN","SCRPTA",74,0)
 K STOP,STORE,TITL,IOP,TEAM,INST,ROLE,NODATA,PRACT
"RTN","SCRPTA",75,0)
 Q
"RTN","SCRPTA",76,0)
 ;
"RTN","SCRPTA",77,0)
FIND ;
"RTN","SCRPTA",78,0)
 N NXT,TLIST,TERR,CNT,ERR1,TNODE,NODE1,PIEN,PTAIEN
"RTN","SCRPTA",79,0)
 S NXT=0,TLIST="^TMP("_$J_",""SCRPTA"",""LIST1"")",TERR="ERR1"
"RTN","SCRPTA",80,0)
 K @TLIST,@TERR
"RTN","SCRPTA",81,0)
 F  S NXT=$O(TEAM(NXT)) Q:NXT=""!(NXT'?.N)  D
"RTN","SCRPTA",82,0)
 .S ERR1=$$PTTM^SCAPMC2(NXT,,.TLIST,.TERR) ;Patients assigned to team NXT
"RTN","SCRPTA",83,0)
 .Q:ERR1=0
"RTN","SCRPTA",84,0)
 .S CNT=0
"RTN","SCRPTA",85,0)
 .F  S CNT=$O(@TLIST@(CNT)) Q:CNT=""!(CNT'?.N)  D
"RTN","SCRPTA",86,0)
 ..S TNODE=$G(@TLIST@(CNT))
"RTN","SCRPTA",87,0)
 ..Q:TNODE=""
"RTN","SCRPTA",88,0)
 ..S PIEN=+$P(TNODE,"^") ;patient ien
"RTN","SCRPTA",89,0)
 ..S PTAIEN=+$P(TNODE,"^",3) ;ien Patient Team Assignment #404.42
"RTN","SCRPTA",90,0)
 ..D CHK^SCRPTA2(PTAIEN,PIEN)
"RTN","SCRPTA",91,0)
 .K @TLIST,@TERR
"RTN","SCRPTA",92,0)
 K @TLIST,@TERR
"RTN","SCRPTA",93,0)
 Q
"RTN","SCRPTA",94,0)
 ;
"RTN","SCRPTA",95,0)
PRINTIT(STORE,IOP,TITL) ;
"RTN","SCRPTA",96,0)
 D OPEN^SCRPU3
"RTN","SCRPTA",97,0)
 N NXT,PAGE,NPAGE,INTN,TMN,INT,TM,PRN,PR,NEW,POS
"RTN","SCRPTA",98,0)
 S (NPAGE,STOP)=0,PAGE=1,(INTN,NEW)=""
"RTN","SCRPTA",99,0)
 D SHEAD ;setup headers
"RTN","SCRPTA",100,0)
 D TITLE^SCRPU3(.PAGE,TITL) ;write title
"RTN","SCRPTA",101,0)
 F  S INTN=$O(@STORE@("I",INTN)) Q:INTN=""!(STOP)  D
"RTN","SCRPTA",102,0)
 .S INT=$O(@STORE@("I",INTN,"")) ;institution
"RTN","SCRPTA",103,0)
 .Q:INT=""
"RTN","SCRPTA",104,0)
 .I '$D(NEW),(IOST'?1"C-".E) D NEWP1^SCRPU3(.PAGE,TITL)
"RTN","SCRPTA",105,0)
 .I '$D(NEW),(IOST?1"C-".E) D HOLD^SCRPU3(.PAGE,TITL)
"RTN","SCRPTA",106,0)
 .Q:STOP
"RTN","SCRPTA",107,0)
 .W !,$G(@STORE@(INT))
"RTN","SCRPTA",108,0)
 .K NEW
"RTN","SCRPTA",109,0)
 .S TMN=""
"RTN","SCRPTA",110,0)
 .F  S TMN=$O(@STORE@("T",INT,TMN)) Q:TMN=""!(STOP)  D
"RTN","SCRPTA",111,0)
 ..S TM=$O(@STORE@("T",INT,TMN,"")) ;team
"RTN","SCRPTA",112,0)
 ..Q:TM=""
"RTN","SCRPTA",113,0)
 ..I (IOST'?1"C-".E),$Y>(IOSL-8) D NEWP1^SCRPU3(.PAGE,TITL) W:'STOP !,$G(@STORE@(INT))
"RTN","SCRPTA",114,0)
 ..I (IOST?1"C-".E),$Y>(IOSL-8) D HOLD^SCRPU3(.PAGE,TITL) W:'STOP !,$G(@STORE@(INT))
"RTN","SCRPTA",115,0)
 ..Q:STOP
"RTN","SCRPTA",116,0)
 ..W !!,$G(@STORE@(INT,TM))
"RTN","SCRPTA",117,0)
 ..I (IOST'?1"C-".E),$Y>(IOSL-10) D NEWP1^SCRPU3(.PAGE,TITL) W:'STOP !,$G(@STORE@(INT)),!!,$G(@STORE@(INT,TM))
"RTN","SCRPTA",118,0)
 ..I (IOST?1"C-".E),$Y>(IOSL-10) D HOLD^SCRPU3(.PAGE,TITL) W:'STOP !,$G(@STORE@(INT)),!!,$G(@STORE@(INT,TM))
"RTN","SCRPTA",119,0)
 ..Q:STOP
"RTN","SCRPTA",120,0)
 ..S PRN=""
"RTN","SCRPTA",121,0)
 ..D HEADER
"RTN","SCRPTA",122,0)
 ..F  S PRN=$O(@STORE@("P",INT,TM,PRN)) Q:PRN=""!(STOP)  D
"RTN","SCRPTA",123,0)
 ...S PR=$O(@STORE@("P",INT,TM,PRN,"")) ;practitioner
"RTN","SCRPTA",124,0)
 ...Q:PR=""
"RTN","SCRPTA",125,0)
 ...S POS=""
"RTN","SCRPTA",126,0)
 ...F  S POS=$O(@STORE@("P",INT,TM,PRN,PR,POS)) Q:POS=""!(STOP)  D
"RTN","SCRPTA",127,0)
 ....D PRNT(INT,TM,PR,POS)
"RTN","SCRPTA",128,0)
 D CLOSE^SCRPU3
"RTN","SCRPTA",129,0)
 Q
"RTN","SCRPTA",130,0)
 ;
"RTN","SCRPTA",131,0)
PRNT(INT,TM,PR,POS) ;
"RTN","SCRPTA",132,0)
 ;INT - institution ien
"RTN","SCRPTA",133,0)
 ;TM - team ien
"RTN","SCRPTA",134,0)
 ;PR - practitioner ien
"RTN","SCRPTA",135,0)
 ;POS - position ien
"RTN","SCRPTA",136,0)
 ;
"RTN","SCRPTA",137,0)
 N PTIEN
"RTN","SCRPTA",138,0)
 S PTIEN=""
"RTN","SCRPTA",139,0)
 F  S PTIEN=$O(@STORE@(INT,TM,PR,POS,PTIEN)) Q:PTIEN=""  D
"RTN","SCRPTA",140,0)
 .I (IOST'?1"C-".E),$Y>(IOSL-4) D NEWP1^SCRPU3(.PAGE,TITL) W:'STOP !,$G(@STORE@(INT)),!!,$G(@STORE@(INT,TM)) D HEADER
"RTN","SCRPTA",141,0)
 .I (IOST?1"C-".E),$Y>(IOSL-4) D HOLD^SCRPU3(.PAGE,TITL) W:'STOP !,$G(@STORE@(INT)),!!,$G(@STORE@(INT,TM)) D HEADER
"RTN","SCRPTA",142,0)
 .Q:STOP
"RTN","SCRPTA",143,0)
 .W !,$G(@STORE@(INT,TM,PR,POS,PTIEN))
"RTN","SCRPTA",144,0)
 Q
"RTN","SCRPTA",145,0)
 ;
"RTN","SCRPTA",146,0)
HEADER ;
"RTN","SCRPTA",147,0)
 ;write column headers
"RTN","SCRPTA",148,0)
 N EN
"RTN","SCRPTA",149,0)
 W !
"RTN","SCRPTA",150,0)
 F EN="H1","H2","H3" D
"RTN","SCRPTA",151,0)
 .W !,$G(@STORE@(EN))
"RTN","SCRPTA",152,0)
 Q
"RTN","SCRPTA",153,0)
SHEAD ;
"RTN","SCRPTA",154,0)
 ;setup column headers
"RTN","SCRPTA",155,0)
 S @STORE@("H2")="Pt Name"
"RTN","SCRPTA",156,0)
 S $E(@STORE@("H2"),23)="Pt ID"
"RTN","SCRPTA",157,0)
 S $E(@STORE@("H2"),30)="Practitioner"
"RTN","SCRPTA",158,0)
 S $E(@STORE@("H2"),52)="Position"
"RTN","SCRPTA",159,0)
 S $E(@STORE@("H1"),70)="Date"
"RTN","SCRPTA",160,0)
 S $E(@STORE@("H2"),70)="Assigned"
"RTN","SCRPTA",161,0)
 S $P(@STORE@("H3"),"=",81)=""
"RTN","SCRPTA",162,0)
 Q
"RTN","SCRPTM")
0^8^B27616425
"RTN","SCRPTM",1,0)
SCRPTM ;ALB/CMM - List of Team's Members Report ;01/29/96
"RTN","SCRPTM",2,0)
 ;;5.3;Scheduling;**41,48**;AUG 13, 1993
"RTN","SCRPTM",3,0)
 ;
"RTN","SCRPTM",4,0)
 ;List of Team's Members Report
"RTN","SCRPTM",5,0)
 ;
"RTN","SCRPTM",6,0)
PROMPTS ;
"RTN","SCRPTM",7,0)
 ;Prompt for Institution, Team, Date Range, User Class, Role
"RTN","SCRPTM",8,0)
 ;and Print device
"RTN","SCRPTM",9,0)
 ;
"RTN","SCRPTM",10,0)
 N VAUTD,VAUTT,VAUTUC,VAUTR,QTIME,RANG,PRNT,NUMBER
"RTN","SCRPTM",11,0)
 K VAUTD,VAUTT,VAUTUC,VAUTR,SCUP
"RTN","SCRPTM",12,0)
 S QTIME=""
"RTN","SCRPTM",13,0)
 D INST^SCRPU1 I Y=-1 G ERR
"RTN","SCRPTM",14,0)
 K Y D PRMTT^SCRPU1 I '$D(VAUTT) G ERR
"RTN","SCRPTM",15,0)
 K Y S RANG=$$DTRANG^SCRPU2() I +RANG=-1 G ERR
"RTN","SCRPTM",16,0)
 K Y D USER^SCRPU1 I '$D(VAUTUC)&($P($G(^SD(404.91,1,"PCMM")),"^")=1) G ERR
"RTN","SCRPTM",17,0)
 K Y D ROLE^SCRPU1 I '$D(VAUTR) G ERR
"RTN","SCRPTM",18,0)
 S PRNT=$$PDEVICE^SCRPU3()
"RTN","SCRPTM",19,0)
 I PRNT=-1 G ERR
"RTN","SCRPTM",20,0)
 I PRNT["Q;" S QTIME=$$GETTIME^SCRPU3()
"RTN","SCRPTM",21,0)
 I QTIME=-1 G ERR
"RTN","SCRPTM",22,0)
 I PRNT'?1"Q;".E S PRNT="Q;"_PRNT
"RTN","SCRPTM",23,0)
 K Y
"RTN","SCRPTM",24,0)
 S NUMBER=$$ENTRY2(.VAUTD,.VAUTT,.VAUTUC,.VAUTR,RANG,PRNT,QTIME)
"RTN","SCRPTM",25,0)
 I NUMBER>0 W !!,"Print queued, task number: ",NUMBER
"RTN","SCRPTM",26,0)
 Q
"RTN","SCRPTM",27,0)
 ;
"RTN","SCRPTM",28,0)
ENTRY2(INST,TEAM,USERC,ROLE,RANGE,IOP,ZTDTH) ;
"RTN","SCRPTM",29,0)
 ;Second entry point for GUI to use
"RTN","SCRPTM",30,0)
 ;Input Parameters:
"RTN","SCRPTM",31,0)
 ;INST - institutions selected (variable and array)
"RTN","SCRPTM",32,0)
 ;TEAM - teams selected (variable and array)
"RTN","SCRPTM",33,0)
 ;USERC - user classes selected (variable and array)
"RTN","SCRPTM",34,0)
 ;ROLE - roles selected (variable and array)
"RTN","SCRPTM",35,0)
 ;RANGE - date range selected (begin date ^ end date)
"RTN","SCRPTM",36,0)
 ;IOP - print device
"RTN","SCRPTM",37,0)
 ;ZTDTH - queue time (optional)
"RTN","SCRPTM",38,0)
 ;
"RTN","SCRPTM",39,0)
 ;validate parameters
"RTN","SCRPTM",40,0)
 I '$D(INST)!'$D(TEAM)!'$D(ROLE)!'$D(RANGE)!'$D(IOP)!(IOP="") Q
"RTN","SCRPTM",41,0)
 ;
"RTN","SCRPTM",42,0)
 N NUMBER
"RTN","SCRPTM",43,0)
 S IOST=$P(IOP,"^",2),IOP=$P(IOP,"^")
"RTN","SCRPTM",44,0)
 I IOP?1"Q;".E S IOP=$P(IOP,"Q;",2)
"RTN","SCRPTM",45,0)
 I IOST?1"C-".E D QENTRY G RET
"RTN","SCRPTM",46,0)
 I ZTDTH="" S ZTDTH=$H
"RTN","SCRPTM",47,0)
 S ZTRTN="QENTRY^SCRPTM"
"RTN","SCRPTM",48,0)
 S ZTDESC="List of Team's Members",ZTIO=IOP
"RTN","SCRPTM",49,0)
 N II
"RTN","SCRPTM",50,0)
 F II="INST","TEAM","USERC","ROLE","INST(","TEAM(","USERC(","ROLE(","RANGE","IOP" S ZTSAVE(II)=""
"RTN","SCRPTM",51,0)
 D ^%ZTLOAD
"RTN","SCRPTM",52,0)
RET S NUMBER=0
"RTN","SCRPTM",53,0)
 I $D(ZTSK) S NUMBER=ZTSK
"RTN","SCRPTM",54,0)
 D EXIT1
"RTN","SCRPTM",55,0)
 Q NUMBER
"RTN","SCRPTM",56,0)
 ;
"RTN","SCRPTM",57,0)
QENTRY ;
"RTN","SCRPTM",58,0)
 ;driver entry point
"RTN","SCRPTM",59,0)
 S TITL="Team's Members Report"
"RTN","SCRPTM",60,0)
 S STORE="^TMP("_$J_",""SCRPTM"")"
"RTN","SCRPTM",61,0)
 K @STORE
"RTN","SCRPTM",62,0)
 S @STORE=0
"RTN","SCRPTM",63,0)
 I TEAM=1 D TALL^SCRPPAT3 S TEAM=0
"RTN","SCRPTM",64,0)
 D DRIVE
"RTN","SCRPTM",65,0)
 I $O(@STORE@(0))="" S NODATA=$$NODATA^SCRPU3(TITL)
"RTN","SCRPTM",66,0)
 I '$D(NODATA) D PRINTIT(STORE,IOP,TITL)
"RTN","SCRPTM",67,0)
 D EXIT2
"RTN","SCRPTM",68,0)
 Q
"RTN","SCRPTM",69,0)
 ;
"RTN","SCRPTM",70,0)
ERR ;
"RTN","SCRPTM",71,0)
EXIT1 ;
"RTN","SCRPTM",72,0)
 K ZTDTH,ZTRTN,ZTDESC,ZTSK,ZTIO,ZTSAVE,SCUP
"RTN","SCRPTM",73,0)
 Q
"RTN","SCRPTM",74,0)
EXIT2 ;
"RTN","SCRPTM",75,0)
 K @STORE
"RTN","SCRPTM",76,0)
 K STOP,STORE,TITL,IOP,TEAM,INST,NODATA,RANGE,ROLE,USERC
"RTN","SCRPTM",77,0)
 Q
"RTN","SCRPTM",78,0)
 ;
"RTN","SCRPTM",79,0)
DRIVE ;
"RTN","SCRPTM",80,0)
 N TM,EN,EN2,NODE,OKAY,PLIST,ERR,RDATE,TROL,TUSE
"RTN","SCRPTM",81,0)
 S TM="",ERR="ERRORS",PLIST="LIST"
"RTN","SCRPTM",82,0)
 K @ERR,@PLIST
"RTN","SCRPTM",83,0)
 F  S TM=$O(^SCTM(404.57,"C",TM)) Q:TM=""  D
"RTN","SCRPTM",84,0)
 .;$O through team position file
"RTN","SCRPTM",85,0)
 .I '$D(TEAM(TM))&(TEAM'=1) Q
"RTN","SCRPTM",86,0)
 .;Q above, not a selected team
"RTN","SCRPTM",87,0)
 .;selected team
"RTN","SCRPTM",88,0)
 .S RDATE("BEGIN")=$P(RANGE,"^")
"RTN","SCRPTM",89,0)
 .S RDATE("END")=$P(RANGE,"^",2)
"RTN","SCRPTM",90,0)
 .S RDATE("INCL")=0
"RTN","SCRPTM",91,0)
 .I ROLE=1 S OKAY=$$PRTM^SCAPMC1(TM,"RDATE","","",PLIST,ERR)
"RTN","SCRPTM",92,0)
 .I ROLE'=1 S OKAY=$$PRTM^SCAPMC1(TM,"RDATE","","ROLE",PLIST,ERR)
"RTN","SCRPTM",93,0)
 .I OKAY,$D(@PLIST@(0)) D PULL^SCRPTM2(TM,.PLIST)
"RTN","SCRPTM",94,0)
 .K @PLIST,@ERR
"RTN","SCRPTM",95,0)
 .I $D(USERC),(USERC'=1) S OKAY=$$PRTM^SCAPMC1(TM,"RDATE","USERC","",PLIST,ERR)
"RTN","SCRPTM",96,0)
 .I OKAY D PULL^SCRPTM2(TM,.PLIST)
"RTN","SCRPTM",97,0)
 .K @PLIST,@ERR
"RTN","SCRPTM",98,0)
 K @PLIST,@ERR
"RTN","SCRPTM",99,0)
 Q
"RTN","SCRPTM",100,0)
 ;
"RTN","SCRPTM",101,0)
PRINTIT(STORE,IOP,TITL) ;
"RTN","SCRPTM",102,0)
 D OPEN^SCRPU3
"RTN","SCRPTM",103,0)
 N INST,EINST,ETEAM,TEM,EPRACT,PRACT,PAGE,NXT,NPAGE,CNT,HEAD,POS
"RTN","SCRPTM",104,0)
 S (EINST,INST)="",(NPAGE,STOP,HEAD)=0,PAGE=1
"RTN","SCRPTM",105,0)
 D TITLE^SCRPU3(.PAGE,TITL)
"RTN","SCRPTM",106,0)
 F  S EINST=$O(@STORE@("I",EINST)) Q:EINST=""!(STOP)  D
"RTN","SCRPTM",107,0)
 .S INST=$O(@STORE@("I",EINST,INST))
"RTN","SCRPTM",108,0)
 .Q:INST=""
"RTN","SCRPTM",109,0)
 .I 'NPAGE W !,$G(@STORE@(INST)) ;write institution line
"RTN","SCRPTM",110,0)
 .S (ETEAM,TEM)=""
"RTN","SCRPTM",111,0)
 .F  S ETEAM=$O(@STORE@("T",INST,ETEAM)) Q:ETEAM=""!(STOP)  D
"RTN","SCRPTM",112,0)
 ..S TEM=$O(@STORE@("T",INST,ETEAM,0))
"RTN","SCRPTM",113,0)
 ..I TEM="" Q
"RTN","SCRPTM",114,0)
 ..S NXT="H"
"RTN","SCRPTM",115,0)
 ..I NPAGE,(IOST'?1"C-".E) D NEWP^SCRPTM2(INST,TEM,TITL,.PAGE,.HEAD) S NPAGE=0
"RTN","SCRPTM",116,0)
 ..I NPAGE,(IOST?1"C-".E) D HOLD1^SCRPTM2(.PAGE,TITL,INST,TEM,.HEAD) S NPAGE=0
"RTN","SCRPTM",117,0)
 ..I STOP Q
"RTN","SCRPTM",118,0)
 ..I IOST'?1"C-".E,$Y>(IOSL-5) D NEWP^SCRPTM2(INST,TEM,TITL,.PAGE,.HEAD)
"RTN","SCRPTM",119,0)
 ..I IOST?1"C-".E,$Y>(IOSL-5) D HOLD1^SCRPTM2(.PAGE,TITL,INST,TEM,.HEAD)
"RTN","SCRPTM",120,0)
 ..I STOP Q
"RTN","SCRPTM",121,0)
 ..W !
"RTN","SCRPTM",122,0)
 ..F  S NXT=$O(@STORE@(INST,TEM,NXT)) Q:NXT'?1"H".E!(STOP)  D
"RTN","SCRPTM",123,0)
 ...I 'HEAD W !,$G(@STORE@(INST,TEM,NXT)) S HEAD=0 ;writes team info
"RTN","SCRPTM",124,0)
 ..S (EPRACT,PRACT)=""
"RTN","SCRPTM",125,0)
 ..W ! ;extra line between members and practioner list
"RTN","SCRPTM",126,0)
 ..F  S EPRACT=$O(@STORE@("PN",INST,TEM,EPRACT)) Q:EPRACT=""!(STOP)  D
"RTN","SCRPTM",127,0)
 ...F  S PRACT=$O(@STORE@("PN",INST,TEM,EPRACT,PRACT)) Q:PRACT=""!(STOP)  D
"RTN","SCRPTM",128,0)
 ....I PRACT="" Q
"RTN","SCRPTM",129,0)
 ....S POS=""
"RTN","SCRPTM",130,0)
 ....F  S POS=$O(@STORE@("PN",INST,TEM,EPRACT,PRACT,POS)) Q:POS=""!(STOP)  D
"RTN","SCRPTM",131,0)
 .....D PRNTD(INST,TEM,PRACT,POS,TITL,.PAGE,.HEAD)
"RTN","SCRPTM",132,0)
 .....W ! ;seperated positions
"RTN","SCRPTM",133,0)
 ....W ! ;seperates practitioners
"RTN","SCRPTM",134,0)
 .S NPAGE=1
"RTN","SCRPTM",135,0)
 D CLOSE^SCRPU3
"RTN","SCRPTM",136,0)
 Q
"RTN","SCRPTM",137,0)
 ;
"RTN","SCRPTM",138,0)
PRNTD(INST,TEM,PRACT,POS,TITL,PAGE,HEAD) ;
"RTN","SCRPTM",139,0)
 ;
"RTN","SCRPTM",140,0)
 N CNT
"RTN","SCRPTM",141,0)
 S CNT=""
"RTN","SCRPTM",142,0)
 F  S CNT=$O(@STORE@(INST,TEM,PRACT,POS,CNT)) Q:CNT=""!(STOP)  D
"RTN","SCRPTM",143,0)
 .I IOST'?1"C-".E,$Y>(IOSL-8) D NEWP^SCRPTM2(INST,TEM,TITL,.PAGE,.HEAD)
"RTN","SCRPTM",144,0)
 .I IOST?1"C-".E,$Y>(IOSL-8) D HOLD1^SCRPTM2(.PAGE,TITL,INST,TEM,.HEAD)
"RTN","SCRPTM",145,0)
 .I STOP Q
"RTN","SCRPTM",146,0)
 .W !,$G(@STORE@(INST,TEM,PRACT,POS,CNT))
"RTN","SCRPTM",147,0)
 Q
"RTN","SCRPTP")
0^2^B23918318
"RTN","SCRPTP",1,0)
SCRPTP ;ALB/CMM - List of Team's Patients ;02/29/96
"RTN","SCRPTP",2,0)
 ;;5.3;Scheduling;**41,48**;AUG 13, 1993
"RTN","SCRPTP",3,0)
 ;
"RTN","SCRPTP",4,0)
PROMPTS ;Prompt for Institution, Team, Role, Patient Status and Print device
"RTN","SCRPTP",5,0)
 N QTIME,PRNT,VAUTD,VAUTT,VAUTR,VAUTPS,NUMBER
"RTN","SCRPTP",6,0)
 K SCUP
"RTN","SCRPTP",7,0)
 S QTIME=""
"RTN","SCRPTP",8,0)
 D INST^SCRPU1 I Y=-1 G ERR
"RTN","SCRPTP",9,0)
 K Y D PRMTT^SCRPU1 I '$D(VAUTT) G ERR
"RTN","SCRPTP",10,0)
 K Y D ROLE^SCRPU1 I '$D(VAUTR) G ERR
"RTN","SCRPTP",11,0)
 K Y D PTSTAT^SCRPU2 I '$D(VAUTPS) G ERR
"RTN","SCRPTP",12,0)
 K Y S SORT=$$SORT2^SCRPU2()
"RTN","SCRPTP",13,0)
 I SORT<1 G ERR
"RTN","SCRPTP",14,0)
 S PRNT=$$PDEVICE^SCRPU3()
"RTN","SCRPTP",15,0)
 I PRNT=-1 G ERR
"RTN","SCRPTP",16,0)
 I PRNT["Q;" S QTIME=$$GETTIME^SCRPU3()
"RTN","SCRPTP",17,0)
 I QTIME=-1 G ERR
"RTN","SCRPTP",18,0)
 I PRNT'?1"Q;".E S PRNT="Q;"_PRNT
"RTN","SCRPTP",19,0)
 S NUMBER=$$ENTRY2(.VAUTD,.VAUTT,.VAUTR,VAUTPS,SORT,PRNT,QTIME)
"RTN","SCRPTP",20,0)
 I NUMBER>0 W !!,"Print queued, task number: ",NUMBER
"RTN","SCRPTP",21,0)
 Q
"RTN","SCRPTP",22,0)
 ;
"RTN","SCRPTP",23,0)
ENTRY2(INST,TEAM,ROLE,PSTAT,SORT,IOP,ZTDTH) ;Second entry point for GUI to use
"RTN","SCRPTP",24,0)
 ;INST - institutions selected (variable and array)
"RTN","SCRPTP",25,0)
 ;TEAM - teams selected (variable and array)
"RTN","SCRPTP",26,0)
 ;ROLE - roles selected (variable and array)
"RTN","SCRPTP",27,0)
 ;PSTAT - patient status - 1=all or OPT or AC
"RTN","SCRPTP",28,0)
 ;SORT - 1=d,t,ptname 2=d,t,last 4 Pt ID 3=d,t,pract,pt name 4=d,t,pract,last 4 Pt ID
"RTN","SCRPTP",29,0)
 ;IOP - print device
"RTN","SCRPTP",30,0)
 ;ZTDTH - queue time (optional)
"RTN","SCRPTP",31,0)
 ;
"RTN","SCRPTP",32,0)
 ;validate parameters
"RTN","SCRPTP",33,0)
 I '$D(INST)!'$D(TEAM)!'$D(ROLE)!'$D(PSTAT)!'$D(SORT)!'$D(IOP)!(IOP="") Q
"RTN","SCRPTP",34,0)
 N NUMBER
"RTN","SCRPTP",35,0)
 S IOST=$P(IOP,"^",2),IOP=$P(IOP,"^")
"RTN","SCRPTP",36,0)
 I IOP?1"Q;".E S IOP=$P(IOP,"Q;",2)
"RTN","SCRPTP",37,0)
 I IOST?1"C-".E D QENTRY G RET
"RTN","SCRPTP",38,0)
 I ZTDTH="" S ZTDTH=$H
"RTN","SCRPTP",39,0)
 S ZTRTN="QENTRY^SCRPTP"
"RTN","SCRPTP",40,0)
 S ZTDESC="List of Team's Patients",ZTIO=IOP
"RTN","SCRPTP",41,0)
 N II
"RTN","SCRPTP",42,0)
 F II="INST","TEAM","ROLE","ROLE(","SORT","PSTAT","INST(","TEAM(","IOP" S ZTSAVE(II)=""
"RTN","SCRPTP",43,0)
 D ^%ZTLOAD
"RTN","SCRPTP",44,0)
RET S NUMBER=0
"RTN","SCRPTP",45,0)
 I $D(ZTSK) S NUMBER=ZTSK
"RTN","SCRPTP",46,0)
 D EXIT1
"RTN","SCRPTP",47,0)
 Q NUMBER
"RTN","SCRPTP",48,0)
 ;
"RTN","SCRPTP",49,0)
QENTRY ;driver entry point
"RTN","SCRPTP",50,0)
 S TITL="List of Team's Patients",STORE="^TMP("_$J_",""SCRPTP"")"
"RTN","SCRPTP",51,0)
 K @STORE
"RTN","SCRPTP",52,0)
 S @STORE=0
"RTN","SCRPTP",53,0)
 D FIND
"RTN","SCRPTP",54,0)
 I $O(@STORE@(0))="" S NODATA=$$NODATA^SCRPU3(TITL)
"RTN","SCRPTP",55,0)
 I '$D(NODATA) D PRINTIT^SCRPTP2(STORE,IOP,TITL)
"RTN","SCRPTP",56,0)
 D EXIT2
"RTN","SCRPTP",57,0)
 Q
"RTN","SCRPTP",58,0)
ERR ;
"RTN","SCRPTP",59,0)
EXIT1 ;
"RTN","SCRPTP",60,0)
 K ZTDTH,ZTRTN,ZTDESC,ZTSK,ZTIO,ZTSAVE,SCUP
"RTN","SCRPTP",61,0)
 Q
"RTN","SCRPTP",62,0)
EXIT2 ;
"RTN","SCRPTP",63,0)
 K @STORE
"RTN","SCRPTP",64,0)
 K STOP,STORE,TITL,IOP,TEAM,INST,ROLE,PSTAT,SORT,NODATA
"RTN","SCRPTP",65,0)
 Q
"RTN","SCRPTP",66,0)
FIND ;
"RTN","SCRPTP",67,0)
 N TIEN,ERR,LIST,OKAY
"RTN","SCRPTP",68,0)
 I TEAM=1 D TALL^SCRPPAT3 ;gets all teams for all divisions selected
"RTN","SCRPTP",69,0)
 S TIEN="",LIST="^TMP("_$J_",""SCRPTP ARRAY"")",ERR="ERROR"
"RTN","SCRPTP",70,0)
 K @LIST,@ERR
"RTN","SCRPTP",71,0)
 F  S TIEN=$O(TEAM(TIEN)) Q:TIEN=""  D
"RTN","SCRPTP",72,0)
 .;TIEN - team ien
"RTN","SCRPTP",73,0)
 .S OKAY=$$PTTM^SCAPMC2(TIEN,"",LIST,ERR)
"RTN","SCRPTP",74,0)
 .; gets all patients for given team
"RTN","SCRPTP",75,0)
 .D HITS^SCRPTP3(LIST,TIEN)
"RTN","SCRPTP",76,0)
 .K @LIST,@ERR
"RTN","SCRPTP",77,0)
 K @LIST,@ERR
"RTN","SCRPTP",78,0)
 Q
"RTN","SCRPTP",79,0)
TINF(TIEN) ;team information
"RTN","SCRPTP",80,0)
 ;TIEN - team ien
"RTN","SCRPTP",81,0)
 ;returns: institution ien ^ team name ^ primary care ^ team phone
"RTN","SCRPTP",82,0)
 N PC,PHONE,TNODE,TNAME
"RTN","SCRPTP",83,0)
 S TNODE=$G(^SCTM(404.51,TIEN,0))
"RTN","SCRPTP",84,0)
 S TNAME=$P(TNODE,"^") ;team name
"RTN","SCRPTP",85,0)
 S PC=$S($P(TNODE,"^",5)=1:"YES",1:"NO") ;primary care team
"RTN","SCRPTP",86,0)
 S PHONE=$P(TNODE,"^",2) ;team phone
"RTN","SCRPTP",87,0)
 S INS=+$P(TNODE,"^",7) ;institution ien
"RTN","SCRPTP",88,0)
 D TDESC^SCRPITP2(TIEN,INS) ;gets team description
"RTN","SCRPTP",89,0)
 Q INS_"^"_TNAME_"^"_PC_"^"_PHONE
"RTN","SCRPTP",90,0)
 ;
"RTN","SCRPTP",91,0)
PST(PTIEN,CLIEN) ;
"RTN","SCRPTP",92,0)
 ;PTIEN - patient ien
"RTN","SCRPTP",93,0)
 ;CLIEN - associated clinic ien
"RTN","SCRPTP",94,0)
 ;returns 1=selected patient status, 0=not selected patient status
"RTN","SCRPTP",95,0)
 ;
"RTN","SCRPTP",96,0)
 N EN,NXT,FOUND,ENODE
"RTN","SCRPTP",97,0)
 S EN="",(FOUND,NXT)=0
"RTN","SCRPTP",98,0)
 Q:'$D(^DPT(PTIEN,"DE","B",CLIEN)) FOUND
"RTN","SCRPTP",99,0)
 S EN=$O(^DPT(PTIEN,"DE","B",CLIEN,""))
"RTN","SCRPTP",100,0)
 I EN=""&(PSTAT=1) S FOUND=1 Q FOUND
"RTN","SCRPTP",101,0)
 Q:EN=""!'$D(^DPT(PTIEN,"DE",EN,1)) FOUND
"RTN","SCRPTP",102,0)
 F  S NXT=$O(^DPT(PTIEN,"DE",EN,1,NXT)) Q:(FOUND)!(NXT="")!(NXT'?.N)  D
"RTN","SCRPTP",103,0)
 .;check if active enrollment
"RTN","SCRPTP",104,0)
 .S ENODE=$G(^DPT(PTIEN,"DE",EN,1,NXT,0))
"RTN","SCRPTP",105,0)
 .I $P(ENODE,"^",3)'="",$P(ENODE,"^",3)<DT+1!$P(ENODE,"^")>DT Q  ;not active enrollment
"RTN","SCRPTP",106,0)
 .;                      ^ discharge date     ^ enrollment date
"RTN","SCRPTP",107,0)
 .Q:$P(ENODE,"^",2)'=$E(PSTAT,1)&(PSTAT'=1)  ;not selected patient status
"RTN","SCRPTP",108,0)
 .S FOUND=1
"RTN","SCRPTP",109,0)
 Q FOUND
"RTN","SCRPTP",110,0)
 ;
"RTN","SCRPTP",111,0)
FORMAT(INS,TIEN,PTIEN,PTNAME,PID,PIEN,PNAME,CNAME,LAST,NEXT) ;Format column information
"RTN","SCRPTP",112,0)
 ;INS - Institution ien
"RTN","SCRPTP",113,0)
 ;TIEN - team ien
"RTN","SCRPTP",114,0)
 ;PTIEN - patient ien
"RTN","SCRPTP",115,0)
 ;PTNAME - patient name
"RTN","SCRPTP",116,0)
 ;PID - last 4 PID - includes pseudo notation as 5th
"RTN","SCRPTP",117,0)
 ;PIEN - practitioner ien
"RTN","SCRPTP",118,0)
 ;PNAME - practitioner name
"RTN","SCRPTP",119,0)
 ;CNAME - clinic name
"RTN","SCRPTP",120,0)
 ;LAST - last appointment
"RTN","SCRPTP",121,0)
 ;NEXT - next appointment
"RTN","SCRPTP",122,0)
 ;
"RTN","SCRPTP",123,0)
 N SEC,TRD
"RTN","SCRPTP",124,0)
 I PNAME="" S PNAME="[BAD DATA]"
"RTN","SCRPTP",125,0)
 I PTNAME="" S PTNAME="[BAD DATA]"
"RTN","SCRPTP",126,0)
 I PID="" S PID="****"
"RTN","SCRPTP",127,0)
 S @STORE@("P",INS,TIEN,PNAME,PIEN)="" ;practitioner
"RTN","SCRPTP",128,0)
 S @STORE@("PT",INS,TIEN,PTNAME,PTIEN)="" ;patient
"RTN","SCRPTP",129,0)
 S @STORE@("PID",INS,TIEN,PID,PTIEN)="" ;last 4 pid
"RTN","SCRPTP",130,0)
 N TRD
"RTN","SCRPTP",131,0)
 I (SORT=1)!(SORT=2) S SEC=PTIEN,TRD=PIEN ;sort doesn't include practitioner
"RTN","SCRPTP",132,0)
 I (SORT=3)!(SORT=4) S SEC=PIEN,TRD=PTIEN ;sort includes practitioner
"RTN","SCRPTP",133,0)
 S @STORE@(INS,TIEN,SEC,TRD)=PTNAME ;patient name
"RTN","SCRPTP",134,0)
 S $E(@STORE@(INS,TIEN,SEC,TRD),17)=PID ;last 4 pid
"RTN","SCRPTP",135,0)
 S $E(@STORE@(INS,TIEN,SEC,TRD),23)=PNAME ;practitioner name
"RTN","SCRPTP",136,0)
 S $E(@STORE@(INS,TIEN,SEC,TRD),45)=LAST ;last appointment
"RTN","SCRPTP",137,0)
 S $E(@STORE@(INS,TIEN,SEC,TRD),55)=NEXT ;next appointment
"RTN","SCRPTP",138,0)
 S $E(@STORE@(INS,TIEN,SEC,TRD),65)=CNAME ;clinic name
"RTN","SCRPTP",139,0)
 Q
"RTN","SCRPTP3")
0^11^B24840745
"RTN","SCRPTP3",1,0)
SCRPTP3 ;ALB/CMM - List of Team's Patients ;02/29/96
"RTN","SCRPTP3",2,0)
 ;;5.3;Scheduling;**41,48**;AUG 13, 1993
"RTN","SCRPTP3",3,0)
 ;
"RTN","SCRPTP3",4,0)
 ;List of Team's Patients Report
"RTN","SCRPTP3",5,0)
 ;
"RTN","SCRPTP3",6,0)
HITS(ARRY,TIEN) ;
"RTN","SCRPTP3",7,0)
 ;ARRY - list of patients for a given team
"RTN","SCRPTP3",8,0)
 ;TIEN - team ien
"RTN","SCRPTP3",9,0)
 ;
"RTN","SCRPTP3",10,0)
 N PTIEN,PIEN,PTNAME,PNAME,PTAI,NXT,NODE,CIEN,CNAME,INAME,INST,LAST,NEXT
"RTN","SCRPTP3",11,0)
 N PAIEN,PC,PHONE,PNODE,PTPA,PTPAN,ROL,PID,TINFO,TNAME,TPIEN,TPNODE
"RTN","SCRPTP3",12,0)
 N CNT,TPA,FLAG,DFN,VA,VAERR
"RTN","SCRPTP3",13,0)
 S NXT=0
"RTN","SCRPTP3",14,0)
 F  S NXT=$O(@ARRY@(NXT)) Q:NXT=""!(NXT'?.N)  D
"RTN","SCRPTP3",15,0)
 .S NODE=$G(@ARRY@(NXT))
"RTN","SCRPTP3",16,0)
 .Q:NODE=""
"RTN","SCRPTP3",17,0)
 .S PTIEN=+$P(NODE,"^") ;patient ien
"RTN","SCRPTP3",18,0)
 .S PTNAME=$E($P(NODE,"^",2),1,15) ;patient name
"RTN","SCRPTP3",19,0)
 .S PTAI=+$P(NODE,"^",3) ;patient team assignment ien (#404.42)
"RTN","SCRPTP3",20,0)
 .;
"RTN","SCRPTP3",21,0)
 .S PNODE=$G(^DPT(PTIEN,0))
"RTN","SCRPTP3",22,0)
 .Q:PNODE=""
"RTN","SCRPTP3",23,0)
 .S DFN=PTIEN
"RTN","SCRPTP3",24,0)
 .D PID^VADPT6
"RTN","SCRPTP3",25,0)
 .S PID=VA("BID")
"RTN","SCRPTP3",26,0)
 .;
"RTN","SCRPTP3",27,0)
 .S TPA=$$TPAR(PTAI,"")
"RTN","SCRPTP3",28,0)
 .I TPA'=-1 D
"RTN","SCRPTP3",29,0)
 ..S PIEN=$P(TPA,"^")
"RTN","SCRPTP3",30,0)
 ..S PNAME=$P(TPA,"^",2)
"RTN","SCRPTP3",31,0)
 ..S CNAME=$P(TPA,"^",3)
"RTN","SCRPTP3",32,0)
 ..S LAST=$P(TPA,"^",4)
"RTN","SCRPTP3",33,0)
 ..S NEXT=$P(TPA,"^",5)
"RTN","SCRPTP3",34,0)
 ..;
"RTN","SCRPTP3",35,0)
 ..S FLAG="Y"
"RTN","SCRPTP3",36,0)
 ..S TINFO=$$TINF^SCRPTP(TIEN) ;team information
"RTN","SCRPTP3",37,0)
 ..S INST=+$P(TINFO,"^") ;institution ien
"RTN","SCRPTP3",38,0)
 ..S INAME=$P($G(^DIC(4,INST,0)),"^") ;institution name
"RTN","SCRPTP3",39,0)
 ..S PHONE=$P(TINFO,"^",4) ;team phone
"RTN","SCRPTP3",40,0)
 ..S PC=$P(TINFO,"^",3) ;primary care?
"RTN","SCRPTP3",41,0)
 ..S TNAME=$P(TINFO,"^",2) ;team name
"RTN","SCRPTP3",42,0)
 ..;
"RTN","SCRPTP3",43,0)
 ..D TFORMAT^SCRPTP2(INST,INAME,TIEN,TNAME,PHONE,PC)
"RTN","SCRPTP3",44,0)
 ..D FORMAT^SCRPTP(INST,TIEN,PTIEN,PTNAME,PID,PIEN,PNAME,CNAME,LAST,NEXT)
"RTN","SCRPTP3",45,0)
 .;
"RTN","SCRPTP3",46,0)
 .;check for other assignments
"RTN","SCRPTP3",47,0)
 .N TPIN
"RTN","SCRPTP3",48,0)
 .S CNT=""
"RTN","SCRPTP3",49,0)
 .F  S CNT=$O(^SCPT(404.43,"B",PTAI,CNT)) Q:CNT=""!(CNT'?.N)  D
"RTN","SCRPTP3",50,0)
 ..S TPIN=$$TPAR(PTAI,CNT)
"RTN","SCRPTP3",51,0)
 ..Q:TPIN=-1
"RTN","SCRPTP3",52,0)
 ..S PIEN=$P(TPIN,"^")
"RTN","SCRPTP3",53,0)
 ..S PNAME=$P(TPIN,"^",2)
"RTN","SCRPTP3",54,0)
 ..S CNAME=$P(TPIN,"^",3)
"RTN","SCRPTP3",55,0)
 ..S LAST=$P(TPIN,"^",4)
"RTN","SCRPTP3",56,0)
 ..S NEXT=$P(TPIN,"^",5)
"RTN","SCRPTP3",57,0)
 ..I '$D(FLAG) D
"RTN","SCRPTP3",58,0)
 ...S TINFO=$$TINF^SCRPTP(TIEN) ;team information
"RTN","SCRPTP3",59,0)
 ...S INST=+$P(TINFO,"^") ;institution ien
"RTN","SCRPTP3",60,0)
 ...S INAME=$P($G(^DIC(4,INST,0)),"^") ;institution name
"RTN","SCRPTP3",61,0)
 ...S PHONE=$P(TINFO,"^",4) ;team phone
"RTN","SCRPTP3",62,0)
 ...S PC=$P(TINFO,"^",3) ;primary care?
"RTN","SCRPTP3",63,0)
 ...S TNAME=$P(TINFO,"^",2) ;team name
"RTN","SCRPTP3",64,0)
 ...;
"RTN","SCRPTP3",65,0)
 ...D TFORMAT^SCRPTP2(INST,INAME,TIEN,TNAME,PHONE,PC)
"RTN","SCRPTP3",66,0)
 ..D FORMAT^SCRPTP(INST,TIEN,PTIEN,PTNAME,PID,PIEN,PNAME,CNAME,LAST,NEXT)
"RTN","SCRPTP3",67,0)
 Q
"RTN","SCRPTP3",68,0)
 ;
"RTN","SCRPTP3",69,0)
TPAR(PTAI,START) ;
"RTN","SCRPTP3",70,0)
 N PTPA,TPIEN,TPNODE,ROL,CNAME,CIEN,ENROLL,OKAY,PNAME,NEXT,LAST,PAIEN
"RTN","SCRPTP3",71,0)
 I '$D(^SCPT(404.43,"B",PTAI)) Q "0^[Not Assigned]"
"RTN","SCRPTP3",72,0)
 ; ^ no patient team position assignment
"RTN","SCRPTP3",73,0)
 IF START="" D
"RTN","SCRPTP3",74,0)
 .S PTPA=$O(^SCPT(404.43,"B",PTAI,START))
"RTN","SCRPTP3",75,0)
 ELSE  D
"RTN","SCRPTP3",76,0)
 .S PTPA=START
"RTN","SCRPTP3",77,0)
 I PTPA="" Q "0^[Not Assigned]"
"RTN","SCRPTP3",78,0)
 S PTPAN=$G(^SCPT(404.43,PTPA,0)) ;patient team position assignment node
"RTN","SCRPTP3",79,0)
 I PTPAN=""!(PTPAN=0) Q "0^[Not Assigned]"
"RTN","SCRPTP3",80,0)
 I $P(PTPAN,"^",4)'="",$P(PTPAN,"^",4)<DT Q -1
"RTN","SCRPTP3",81,0)
 S TPIEN=+$P(PTPAN,"^",2) ;team position ien (#404.57)
"RTN","SCRPTP3",82,0)
 I '$D(^SCTM(404.57,TPIEN,0)) Q "0^[Not Assigned]"
"RTN","SCRPTP3",83,0)
 S TPNODE=$G(^SCTM(404.57,TPIEN,0))
"RTN","SCRPTP3",84,0)
 I TPNODE="" Q "0^[Not Assigned]"
"RTN","SCRPTP3",85,0)
 S ROL=+$P(TPNODE,"^",3) ;role for position (ien)
"RTN","SCRPTP3",86,0)
 Q:'$D(ROLE(ROL))&(ROLE'=1) -1
"RTN","SCRPTP3",87,0)
 ; ^ not a selected role
"RTN","SCRPTP3",88,0)
 ;
"RTN","SCRPTP3",89,0)
 S CIEN=+$P(TPNODE,"^",9) ;associated clinic ien
"RTN","SCRPTP3",90,0)
 S CNAME=$E($P($G(^SC(CIEN,0)),"^"),1,15) ;clinic name
"RTN","SCRPTP3",91,0)
 ;check patient status
"RTN","SCRPTP3",92,0)
 S OKAY=""
"RTN","SCRPTP3",93,0)
 I CIEN>0&(PSTAT'=1) S OKAY=$$PST^SCRPTP(PTIEN,CIEN)
"RTN","SCRPTP3",94,0)
 Q:(CIEN>0)&('OKAY)&(PSTAT'=1) -1
"RTN","SCRPTP3",95,0)
 ; ^ not selected patient status
"RTN","SCRPTP3",96,0)
 ;
"RTN","SCRPTP3",97,0)
 S ENROLL=$$ENRL(PTIEN,CIEN) ;enrolled in associated clinic
"RTN","SCRPTP3",98,0)
 I 'ENROLL S CNAME="",CIEN=0
"RTN","SCRPTP3",99,0)
 ;
"RTN","SCRPTP3",100,0)
 S PAIEN=$$CHK(TPIEN)
"RTN","SCRPTP3",101,0)
 I +PAIEN'=0 S PIEN=+PAIEN,PNAME=$P(PAIEN,"^",2) ; practitioner's name
"RTN","SCRPTP3",102,0)
 I +PAIEN=0 S PIEN=0,PNAME="["_$E($P(TPNODE,U,1),1,20)_"]"
"RTN","SCRPTP3",103,0)
 ;
"RTN","SCRPTP3",104,0)
 S (NEXT,LAST)=""
"RTN","SCRPTP3",105,0)
 I +CIEN>0 S NEXT=$$GETNEXT^SCRPU3(PTIEN,CIEN) ;next appointment
"RTN","SCRPTP3",106,0)
 I +CIEN>0 S LAST=$$GETLAST^SCRPU3(PTIEN,CIEN) ;last appointment
"RTN","SCRPTP3",107,0)
 ;
"RTN","SCRPTP3",108,0)
 Q PIEN_"^"_PNAME_"^"_CNAME_"^"_NEXT_"^"_LAST
"RTN","SCRPTP3",109,0)
 ;
"RTN","SCRPTP3",110,0)
ENRL(PTIEN,CLIEN) ;
"RTN","SCRPTP3",111,0)
 ;
"RTN","SCRPTP3",112,0)
 N FOUND,ENODE,EN,NXT
"RTN","SCRPTP3",113,0)
 S FOUND=0
"RTN","SCRPTP3",114,0)
 Q:'$D(^DPT(PTIEN,"DE","B",CLIEN)) FOUND
"RTN","SCRPTP3",115,0)
 S EN=$O(^DPT(PTIEN,"DE","B",CLIEN,""))
"RTN","SCRPTP3",116,0)
 Q:EN=""!'$D(^DPT(PTIEN,"DE",EN,1)) FOUND
"RTN","SCRPTP3",117,0)
 S NXT=""
"RTN","SCRPTP3",118,0)
 F  S NXT=$O(^DPT(PTIEN,"DE",EN,1,NXT)) Q:(FOUND)!(NXT="")!(NXT'?.N)  D
"RTN","SCRPTP3",119,0)
 .;check if active enrollment
"RTN","SCRPTP3",120,0)
 .S ENODE=$G(^DPT(PTIEN,"DE",EN,1,NXT,0))
"RTN","SCRPTP3",121,0)
 .I $P(ENODE,"^",3)'="",$P(ENODE,"^",3)<DT+1!$P(ENODE,"^")>DT Q  ;not active enrollment
"RTN","SCRPTP3",122,0)
 .;                      ^ discharge date     ^ enrollment date
"RTN","SCRPTP3",123,0)
 .S FOUND=1
"RTN","SCRPTP3",124,0)
 Q FOUND
"RTN","SCRPTP3",125,0)
 ;
"RTN","SCRPTP3",126,0)
CHK(TPIEN) ;assigned to a position
"RTN","SCRPTP3",127,0)
 ;TPIEN - ien of 404.57 Team Position file
"RTN","SCRPTP3",128,0)
 ;returns:  ien of 200 New Person file
"RTN","SCRPTP3",129,0)
 N EN,PLIST,PERR,ERR,NAME
"RTN","SCRPTP3",130,0)
 S PLIST="PLST",PERR="PRR"
"RTN","SCRPTP3",131,0)
 K @PLIST,@PERR
"RTN","SCRPTP3",132,0)
 S ERR=$$PRTP^SCAPMC8(TPIEN,,.PLIST,.PERR)
"RTN","SCRPTP3",133,0)
 I '$D(@PERR) D
"RTN","SCRPTP3",134,0)
 .S EN=$P($G(@PLIST@(1)),"^") ;ien of new person file
"RTN","SCRPTP3",135,0)
 .S NAME=$P($G(@PLIST@(1)),"^",2) ; new person name
"RTN","SCRPTP3",136,0)
 K @PLIST,@PERR
"RTN","SCRPTP3",137,0)
 Q EN_"^"_NAME
"RTN","SCRPTP3",138,0)
 ;
"RTN","SD5348EN")
0^9^B2713535
"RTN","SD5348EN",1,0)
SD5348EN ;ALB/REW - SD*5.3*48 Environment Checker ; 7 JUN 1996
"RTN","SD5348EN",2,0)
 ;;5.3;Scheduling;**48**;AUG 13, 1993
"RTN","SD5348EN",3,0)
EN ;entry point
"RTN","SD5348EN",4,0)
 W !,"SD*5.3*48 Installation Requirements:",!
"RTN","SD5348EN",5,0)
 IF $D(XPDABORT)#2 W !!?4,"*** Warning: Because variable XPDABORT exists, SD*5.3*48 will not install."
"RTN","SD5348EN",6,0)
 N SCX,SCPATCH,SCROUT,SCCOMM,SC2LINE,SC2DATA,SCGLOB,SC2CHECK,SCARR,SCSUB
"RTN","SD5348EN",7,0)
 W !,">>> Checking Programmer Variables:"
"RTN","SD5348EN",8,0)
 IF +$G(DUZ)'>0!($G(DUZ(0))'="@")!($G(U)'="^")!('$D(DT)) D  Q
"RTN","SD5348EN",9,0)
 . S XPDABORT=2
"RTN","SD5348EN",10,0)
 . W !,"You must first initialize Programmer Environment by running ^XUP",!
"RTN","SD5348EN",11,0)
 ELSE  D
"RTN","SD5348EN",12,0)
 . W " ...Ok"
"RTN","SD5348EN",13,0)
PKGCHK ;check package file entries
"RTN","SD5348EN",14,0)
 W !,">>> Checking PACKAGE File Entries:"
"RTN","SD5348EN",15,0)
 F SCX=1:1 S SCPATCH=$P($T(PACKAGE+SCX),";;",2) Q:'$L(SCPATCH)  D
"RTN","SD5348EN",16,0)
 .N SCPKG,SCVER,SCPTC,SCPKGI,SCVERI
"RTN","SD5348EN",17,0)
 .W !,?5,SCPATCH
"RTN","SD5348EN",18,0)
 .IF '$$PATCH^XPDUTL(SCPATCH) D
"RTN","SD5348EN",19,0)
 ..S XPDABORT=2
"RTN","SD5348EN",20,0)
 ..W:$G(XPDABORT) !,"Missing Required (Package/Patch) Entry: ",SCPATCH
"RTN","SD5348EN",21,0)
 .ELSE  D
"RTN","SD5348EN",22,0)
 ..W " ...Ok"
"RTN","SD5348EN",23,0)
 ;check patched routines
"RTN","SD5348EN",24,0)
 W:$D(XPDABORT) !,">>> SD*5.3*48 Aborted in Environment Checker"
"RTN","SD5348EN",25,0)
 W:'$D(XPDABORT) !!,">>> Environment is Ok"
"RTN","SD5348EN",26,0)
 Q
"RTN","SD5348EN",27,0)
 ;
"RTN","SD5348EN",28,0)
PACKAGE ;
"RTN","SD5348EN",29,0)
 ;;SD*5.3*41
"RTN","SD5348EN",30,0)
 ;;SD*5.3*45
"RTN","SD5348PT")
0^10^B4312148
"RTN","SD5348PT",1,0)
SD5348PT ;ALB/REW - SD*5.3*48 Post-init Checker ; 7 Aug 1996
"RTN","SD5348PT",2,0)
 ;;5.3;Scheduling;**48**;AUG 13, 1993
"RTN","SD5348PT",3,0)
EN ;entry point
"RTN","SD5348PT",4,0)
 ;look through patient file's DD for potentially problematic ID nodes
"RTN","SD5348PT",5,0)
 N SCFILE,SCFLG2
"RTN","SD5348PT",6,0)
 D MES^XPDUTL("     Any command that 'talks' in the background will cause problems.")
"RTN","SD5348PT",7,0)
 D MES^XPDUTL("        Using EN^DDIOL is OK.")
"RTN","SD5348PT",8,0)
 D MES^XPDUTL("        Using the WRITE command will cause problems.")
"RTN","SD5348PT",9,0)
 D BMES^XPDUTL("     Please review each of the ID nodes displayed below: ")
"RTN","SD5348PT",10,0)
 F SCFILE=2,44,404.51,200 D
"RTN","SD5348PT",11,0)
 .D IDCHK(SCFILE)
"RTN","SD5348PT",12,0)
 IF $G(SCFLG2) D
"RTN","SD5348PT",13,0)
 .D BMES^XPDUTL("     Please review asterisked nodes closely (they don't contain DDIOL).")
"RTN","SD5348PT",14,0)
 .D MES^XPDUTL("     Replace any WRITE commands with ones that use 'EN^DDIOL'.")
"RTN","SD5348PT",15,0)
 D BMES^XPDUTL("Prior to making any changes to File #200, Contact IRMFO Customer Support.")
"RTN","SD5348PT",16,0)
 Q
"RTN","SD5348PT",17,0)
 ;
"RTN","SD5348PT",18,0)
IDCHK(FILE) ;look through a file's DD for potential ID nodes that 'talk'
"RTN","SD5348PT",19,0)
 N SCSUB,SCND,SCFL,SCFLG3,SCSTAR
"RTN","SD5348PT",20,0)
 S SCSUB=""
"RTN","SD5348PT",21,0)
 D FILE^DID(FILE,"","NAME","SCFL")
"RTN","SD5348PT",22,0)
 D MES^XPDUTL(" ")
"RTN","SD5348PT",23,0)
 D BMES^XPDUTL(">>> WRITE-Type ID nodes in "_SCFL("NAME")_" File (#"_FILE_"):")
"RTN","SD5348PT",24,0)
 F  S SCSUB=$O(^DD(FILE,0,"ID",SCSUB)) Q:SCSUB=""  S SCND=$G(^(SCSUB)) D
"RTN","SD5348PT",25,0)
 .S SCFLG3=1 ;has one id-write node
"RTN","SD5348PT",26,0)
 .N SCFLG
"RTN","SD5348PT",27,0)
 .Q:(SCSUB=+SCSUB)  ;FileMan correctly handles these entries
"RTN","SD5348PT",28,0)
 .IF SCND'["^DDIOL" D
"RTN","SD5348PT",29,0)
 ..S SCFLG=1
"RTN","SD5348PT",30,0)
 ..S SCFLG2=1
"RTN","SD5348PT",31,0)
 .D MES^XPDUTL($S($G(SCFLG):"  ***",1:"     ")_"  ^DD("_FILE_",0,""ID"","_SCSUB_"):")
"RTN","SD5348PT",32,0)
 .D MES^XPDUTL("          "_SCND)
"RTN","SD5348PT",33,0)
 D:'$G(SCFLG3) MES^XPDUTL("    ...none.")  
"RTN","SD5348PT",34,0)
 Q
"RTN","SD5348PT",35,0)
 ;
"VER")
8.0^21.0
**END**
**END**
