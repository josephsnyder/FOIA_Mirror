Released SD*5.3*520 SEQ #435
Extracted from mail message
**KIDS**:SD*5.3*520^

**INSTALL NAME**
SD*5.3*520
"BLD",7308,0)
SD*5.3*520^SCHEDULING^0^3080516^y
"BLD",7308,1,0)
^^4^4^3080507^
"BLD",7308,1,1,0)
This patch corrects
"BLD",7308,1,2,0)
1 The Associated Clinic display for PCMM reports.
"BLD",7308,1,3,0)
2 The display of appointment information on PCMM reports.
"BLD",7308,1,4,0)
3 Correct lookup if position IEN is 1.
"BLD",7308,4,0)
^9.64PA^404.57^1
"BLD",7308,4,404.57,0)
404.57
"BLD",7308,4,404.57,2,0)
^9.641^404.57^2
"BLD",7308,4,404.57,2,404.57,0)
TEAM POSITION  (File-top level)
"BLD",7308,4,404.57,2,404.57,1,0)
^9.6411^.09^1
"BLD",7308,4,404.57,2,404.57,1,.09,0)
ASSOCIATED CLINIC
"BLD",7308,4,404.57,2,404.575,0)
ASSOCIATED CLINICS  (sub-file)
"BLD",7308,4,404.57,2,404.575,1,0)
^9.6411^.01^1
"BLD",7308,4,404.57,2,404.575,1,.01,0)
ASSOCIATED CLINICS
"BLD",7308,4,404.57,222)
y^n^p^^^^n^^n
"BLD",7308,4,404.57,224)

"BLD",7308,4,"APDD",404.57,404.57)

"BLD",7308,4,"APDD",404.57,404.57,.09)

"BLD",7308,4,"APDD",404.57,404.575)

"BLD",7308,4,"APDD",404.57,404.575,.01)

"BLD",7308,4,"B",404.57,404.57)

"BLD",7308,6)
13^
"BLD",7308,6.3)
26
"BLD",7308,"INID")
^n
"BLD",7308,"INIT")
POST^SD53P520
"BLD",7308,"KRN",0)
^9.67PA^8989.52^19
"BLD",7308,"KRN",.4,0)
.4
"BLD",7308,"KRN",.401,0)
.401
"BLD",7308,"KRN",.402,0)
.402
"BLD",7308,"KRN",.403,0)
.403
"BLD",7308,"KRN",.5,0)
.5
"BLD",7308,"KRN",.5,"NM",0)
^9.68A^^
"BLD",7308,"KRN",.84,0)
.84
"BLD",7308,"KRN",3.6,0)
3.6
"BLD",7308,"KRN",3.8,0)
3.8
"BLD",7308,"KRN",9.2,0)
9.2
"BLD",7308,"KRN",9.8,0)
9.8
"BLD",7308,"KRN",9.8,"NM",0)
^9.68A^25^21
"BLD",7308,"KRN",9.8,"NM",1,0)
SCAPMC14^^0^B8228150
"BLD",7308,"KRN",9.8,"NM",2,0)
SCAPMC29^^0^B5381891
"BLD",7308,"KRN",9.8,"NM",3,0)
SCAPMC30^^0^B6119989
"BLD",7308,"KRN",9.8,"NM",4,0)
SCAPMC9^^0^B5296004
"BLD",7308,"KRN",9.8,"NM",5,0)
SCRPEC^^0^B12978896
"BLD",7308,"KRN",9.8,"NM",6,0)
SCRPITP^^0^B25285896
"BLD",7308,"KRN",9.8,"NM",7,0)
SCRPITP2^^0^B23670971
"BLD",7308,"KRN",9.8,"NM",12,0)
SCRPPAT2^^0^B44698538
"BLD",7308,"KRN",9.8,"NM",13,0)
SCRPPAT3^^0^B33197824
"BLD",7308,"KRN",9.8,"NM",14,0)
SCRPRAC2^^0^B21302300
"BLD",7308,"KRN",9.8,"NM",15,0)
SCRPSLT^^0^B27323544
"BLD",7308,"KRN",9.8,"NM",16,0)
SCRPSLT2^^0^B34006267
"BLD",7308,"KRN",9.8,"NM",17,0)
SCRPTM^^0^B34769251
"BLD",7308,"KRN",9.8,"NM",18,0)
SCRPTM2^^0^B23722266
"BLD",7308,"KRN",9.8,"NM",19,0)
SCRPTP^^0^B37396149
"BLD",7308,"KRN",9.8,"NM",20,0)
SCRPTP2^^0^B34599932
"BLD",7308,"KRN",9.8,"NM",21,0)
SCRPTP3^^0^B16177961
"BLD",7308,"KRN",9.8,"NM",22,0)
SCRPU1^^0^B24892950
"BLD",7308,"KRN",9.8,"NM",23,0)
SCRPU2^^0^B22140264
"BLD",7308,"KRN",9.8,"NM",24,0)
SCMCDD2^^0^B3853809
"BLD",7308,"KRN",9.8,"NM",25,0)
SCRPBK11^^0^B14197732
"BLD",7308,"KRN",9.8,"NM","B","SCAPMC14",1)

"BLD",7308,"KRN",9.8,"NM","B","SCAPMC29",2)

"BLD",7308,"KRN",9.8,"NM","B","SCAPMC30",3)

"BLD",7308,"KRN",9.8,"NM","B","SCAPMC9",4)

"BLD",7308,"KRN",9.8,"NM","B","SCMCDD2",24)

"BLD",7308,"KRN",9.8,"NM","B","SCRPBK11",25)

"BLD",7308,"KRN",9.8,"NM","B","SCRPEC",5)

"BLD",7308,"KRN",9.8,"NM","B","SCRPITP",6)

"BLD",7308,"KRN",9.8,"NM","B","SCRPITP2",7)

"BLD",7308,"KRN",9.8,"NM","B","SCRPPAT2",12)

"BLD",7308,"KRN",9.8,"NM","B","SCRPPAT3",13)

"BLD",7308,"KRN",9.8,"NM","B","SCRPRAC2",14)

"BLD",7308,"KRN",9.8,"NM","B","SCRPSLT",15)

"BLD",7308,"KRN",9.8,"NM","B","SCRPSLT2",16)

"BLD",7308,"KRN",9.8,"NM","B","SCRPTM",17)

"BLD",7308,"KRN",9.8,"NM","B","SCRPTM2",18)

"BLD",7308,"KRN",9.8,"NM","B","SCRPTP",19)

"BLD",7308,"KRN",9.8,"NM","B","SCRPTP2",20)

"BLD",7308,"KRN",9.8,"NM","B","SCRPTP3",21)

"BLD",7308,"KRN",9.8,"NM","B","SCRPU1",22)

"BLD",7308,"KRN",9.8,"NM","B","SCRPU2",23)

"BLD",7308,"KRN",19,0)
19
"BLD",7308,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",7308,"KRN",19,"NM",1,0)
SC PCMM DETAIL LIST PTS^^0
"BLD",7308,"KRN",19,"NM","B","SC PCMM DETAIL LIST PTS",1)

"BLD",7308,"KRN",19.1,0)
19.1
"BLD",7308,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",7308,"KRN",101,0)
101
"BLD",7308,"KRN",409.61,0)
409.61
"BLD",7308,"KRN",771,0)
771
"BLD",7308,"KRN",870,0)
870
"BLD",7308,"KRN",8989.51,0)
8989.51
"BLD",7308,"KRN",8989.52,0)
8989.52
"BLD",7308,"KRN",8994,0)
8994
"BLD",7308,"KRN","B",.4,.4)

"BLD",7308,"KRN","B",.401,.401)

"BLD",7308,"KRN","B",.402,.402)

"BLD",7308,"KRN","B",.403,.403)

"BLD",7308,"KRN","B",.5,.5)

"BLD",7308,"KRN","B",.84,.84)

"BLD",7308,"KRN","B",3.6,3.6)

"BLD",7308,"KRN","B",3.8,3.8)

"BLD",7308,"KRN","B",9.2,9.2)

"BLD",7308,"KRN","B",9.8,9.8)

"BLD",7308,"KRN","B",19,19)

"BLD",7308,"KRN","B",19.1,19.1)

"BLD",7308,"KRN","B",101,101)

"BLD",7308,"KRN","B",409.61,409.61)

"BLD",7308,"KRN","B",771,771)

"BLD",7308,"KRN","B",870,870)

"BLD",7308,"KRN","B",8989.51,8989.51)

"BLD",7308,"KRN","B",8989.52,8989.52)

"BLD",7308,"KRN","B",8994,8994)

"BLD",7308,"QDEF")
^^^^^^^^^^YES
"BLD",7308,"QUES",0)
^9.62^^
"BLD",7308,"REQB",0)
^9.611^10^8
"BLD",7308,"REQB",1,0)
SD*5.3*297^1
"BLD",7308,"REQB",3,0)
SD*5.3*112^1
"BLD",7308,"REQB",4,0)
SD*5.3*431^1
"BLD",7308,"REQB",6,0)
SD*5.3*210^1
"BLD",7308,"REQB",7,0)
SD*5.3*433^1
"BLD",7308,"REQB",8,0)
SD*5.3*130^1
"BLD",7308,"REQB",9,0)
SD*5.3*526^1
"BLD",7308,"REQB",10,0)
SD*5.3*107^1
"BLD",7308,"REQB","B","SD*5.3*107",10)

"BLD",7308,"REQB","B","SD*5.3*112",3)

"BLD",7308,"REQB","B","SD*5.3*130",8)

"BLD",7308,"REQB","B","SD*5.3*210",6)

"BLD",7308,"REQB","B","SD*5.3*297",1)

"BLD",7308,"REQB","B","SD*5.3*431",4)

"BLD",7308,"REQB","B","SD*5.3*433",7)

"BLD",7308,"REQB","B","SD*5.3*526",9)

"FIA",404.57)
TEAM POSITION
"FIA",404.57,0)
^SCTM(404.57,
"FIA",404.57,0,0)
404.57IA
"FIA",404.57,0,1)
y^n^p^^^^n^^n
"FIA",404.57,0,10)

"FIA",404.57,0,11)

"FIA",404.57,0,"RLRO")

"FIA",404.57,0,"VR")
5.3^SD
"FIA",404.57,404.57)
1
"FIA",404.57,404.57,.09)

"FIA",404.57,404.57,5)

"FIA",404.57,404.575)
1
"FIA",404.57,404.575,.01)

"INIT")
POST^SD53P520
"KRN",19,2916263,-1)
0^1
"KRN",19,2916263,0)
SC PCMM DETAIL LIST PTS^Detailed Patient Assignments^TEMPORARILY DISABLED UNTIL PATCH SD*5.3*535^R^^^^^^^^SCHEDULING^^
"KRN",19,2916263,1,0)
^19.06^6^6^3080421^^
"KRN",19,2916263,1,1,0)
This report lists patients and the clinics in which they are enrolled.  
"KRN",19,2916263,1,2,0)
This report may be used prior to team/position assignments in order to
"KRN",19,2916263,1,3,0)
help validate clinic enrollments.  The report can be printed for those 
"KRN",19,2916263,1,4,0)
patients who are assigned to the team for primary care or for those
"KRN",19,2916263,1,5,0)
patients who are assigned to the team for something other than primary
"KRN",19,2916263,1,6,0)
care.
"KRN",19,2916263,20)

"KRN",19,2916263,25)
PROMPTS^SCRPEC
"KRN",19,2916263,99)
56693,59580
"KRN",19,2916263,99.1)
58437,14480
"KRN",19,2916263,"U")
DETAILED PATIENT ASSIGNMENTS
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813^2930930
"PKG",16,22,1,"PAH",1,0)
520^3080516^520645551
"PKG",16,22,1,"PAH",1,1,0)
^^4^4^3080516
"PKG",16,22,1,"PAH",1,1,1,0)
This patch corrects
"PKG",16,22,1,"PAH",1,1,2,0)
1 The Associated Clinic display for PCMM reports.
"PKG",16,22,1,"PAH",1,1,3,0)
2 The display of appointment information on PCMM reports.
"PKG",16,22,1,"PAH",1,1,4,0)
3 Correct lookup if position IEN is 1.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
22
"RTN","SCAPMC14")
0^1^B8228150^B7296482
"RTN","SCAPMC14",1,0)
SCAPMC14 ;ALB/REW - Team API's: PTPR ; JUN 30, 1995
"RTN","SCAPMC14",2,0)
 ;;5.3;Scheduling;**41,520**;AUG 13, 1993;Build 26
"RTN","SCAPMC14",3,0)
 ;;1.0
"RTN","SCAPMC14",4,0)
PTPR(SC200,SCDATES,SCPURPA,SCROLEA,SCLIST,SCERR,SCYESCL) ; -- list patients for a pract (scyescl NOT supported)
"RTN","SCAPMC14",5,0)
 ; input:
"RTN","SCAPMC14",6,0)
 ; SC200 = ien of NEW PERSON file(#200) [required]
"RTN","SCAPMC14",7,0)
 ;  SCDATES("BEGIN") = begin date to search (inclusive)
"RTN","SCAPMC14",8,0)
 ;                       [default: TODAY]
"RTN","SCAPMC14",9,0)
 ;        ("END")   = end date to search (inclusive)
"RTN","SCAPMC14",10,0)
 ;                      [default: TODAY]
"RTN","SCAPMC14",11,0)
 ;        ("INCL")  = 1: only use patients who were assigned to
"RTN","SCAPMC14",12,0)
 ;                       team for entire date range
"RTN","SCAPMC14",13,0)
 ;                    0: anytime in date range
"RTN","SCAPMC14",14,0)
 ;                      [default: 1] 
"RTN","SCAPMC14",15,0)
 ;  SCPURPA -array of pointers to team purpose file 403.47
"RTN","SCAPMC14",16,0)
 ;          if none are defined - returns all teams
"RTN","SCAPMC14",17,0)
 ;          if @SCPURPA@('exclude') is defined - exclude listed teams
"RTN","SCAPMC14",18,0)
 ;  SCROLEA-array of pointer to 403.46 (per SCPURPA)
"RTN","SCAPMC14",19,0)
 ;  SCLIST -array name to store list
"RTN","SCAPMC14",20,0)
 ;          [ex. ^TMP("SCPT",$J)]
"RTN","SCAPMC14",21,0)
 ;        
"RTN","SCAPMC14",22,0)
 ;  SCERR = array NAME to store error messages.
"RTN","SCAPMC14",23,0)
 ;          [ex. ^TMP("ORXX",$J)]
"RTN","SCAPMC14",24,0)
 ;  SCYESCL = Boolean to indicate 1=use associated clinics 0=don't
"RTN","SCAPMC14",25,0)
 ;            default=0
"RTN","SCAPMC14",26,0)
 ;
"RTN","SCAPMC14",27,0)
 ;
"RTN","SCAPMC14",28,0)
 ; Output:
"RTN","SCAPMC14",29,0)
 ;  SCLIST() = array of patients
"RTN","SCAPMC14",30,0)
 ;             Format:
"RTN","SCAPMC14",31,0)
 ;               Subscript: Sequential # from 1 to n
"RTN","SCAPMC14",32,0)
 ;               Piece     Description
"RTN","SCAPMC14",33,0)
 ;                 1       IEN of PATIENT file entry
"RTN","SCAPMC14",34,0)
 ;                 2       Name of patient
"RTN","SCAPMC14",35,0)
 ;                 3       IEN of Pt Team Posit Asment if position=source
"RTN","SCAPMC14",36,0)
 ;                 4       Activation Date
"RTN","SCAPMC14",37,0)
 ;                 5       Inactivation Date
"RTN","SCAPMC14",38,0)
 ;                 6       Source 1=Clinic, Null=Position
"RTN","SCAPMC14",39,0)
 ;                 7       IEN of Clinic if clinic=source
"RTN","SCAPMC14",40,0)
 ;
"RTN","SCAPMC14",41,0)
 ;  SCERR() = Array of DIALOG file messages(errors) .
"RTN","SCAPMC14",42,0)
 ;  @SCERR@(0) = number of errors, undefined if none
"RTN","SCAPMC14",43,0)
 ;             Format:
"RTN","SCAPMC14",44,0)
 ;               Subscript: Sequential # from 1 to n
"RTN","SCAPMC14",45,0)
 ;               Piece     Description
"RTN","SCAPMC14",46,0)
 ;                 1       IEN of DIALOG file
"RTN","SCAPMC14",47,0)
 ;  Returned: 1 if ok, 0 if error
"RTN","SCAPMC14",48,0)
 ;
"RTN","SCAPMC14",49,0)
 ;
"RTN","SCAPMC14",50,0)
ST N SCTM,SCPTA,SCPTA0,SCOK,SCX,NODE,TPACT,TPINACT,SCTEMP,SCTP,SCUSR
"RTN","SCAPMC14",51,0)
 N SCLSEQ,SCN,SCESEQ,SCPARM,SCP,SCBEGIN,SCEND,SCINCL,SCDTS
"RTN","SCAPMC14",52,0)
 ; -- initialize control variables
"RTN","SCAPMC14",53,0)
 G:'$$OKDATA PRACQ
"RTN","SCAPMC14",54,0)
 ; -- get list of positions for practitioner
"RTN","SCAPMC14",55,0)
 G:'$$TPPR^SCAPMC(SC200,SCDATES,.SCPURPA,.SCROLEA,"SCTEMP",.SCERR) PRACQ
"RTN","SCAPMC14",56,0)
 G:'$G(SCTEMP(0)) PRACQ
"RTN","SCAPMC14",57,0)
 S SCTP=0
"RTN","SCAPMC14",58,0)
 ;get list of patients for each position
"RTN","SCAPMC14",59,0)
 F SCX=1:1 S NODE=$G(SCTEMP(SCX)),SCTP=+NODE Q:'SCTP  D  Q:'SCOK
"RTN","SCAPMC14",60,0)
 .S TPACT=$P(SCTEMP(SCX),U,5)
"RTN","SCAPMC14",61,0)
 .S TPINACT=$P(SCTEMP(SCX),U,6)
"RTN","SCAPMC14",62,0)
 .N SCDTPR
"RTN","SCAPMC14",63,0)
 .S SCDTPR("BEGIN")=$S(TPACT>@SCDATES@("BEGIN"):TPACT,1:@SCDATES@("BEGIN"))
"RTN","SCAPMC14",64,0)
 .S SCDTPR("END")=$S('TPINACT:@SCDATES@("END"),(TPINACT<@SCDATES@("END")):TPINACT,1:@SCDATES@("END"))
"RTN","SCAPMC14",65,0)
 .S SCDTPR("INCL")=@SCDATES@("INCL")
"RTN","SCAPMC14",66,0)
 .S SCOK=$$PTTP^SCAPMC(SCTP,"SCDTPR",.SCLIST,.SCERR)
"RTN","SCAPMC14",67,0)
 .Q:'SCOK
"RTN","SCAPMC14",68,0)
 .Q:'SCYESCL
"RTN","SCAPMC14",69,0)
 .;S SC44=$P($G(^SCTM(404.57,+SCTP,0)),U,9)
"RTN","SCAPMC14",70,0)
 .;Q:'SC44
"RTN","SCAPMC14",71,0)
 .N CNAME,SC44
"RTN","SCAPMC14",72,0)
 .D SETASCL^SCRPRAC2(SCTP,.CNAME,.SC44)
"RTN","SCAPMC14",73,0)
 .N SCCNT S SCCNT=0
"RTN","SCAPMC14",74,0)
 .F  S SCCNT=$O(SC44(SCCNT)) Q:SCCNT=""  S SCOK=$$PTCL^SCAPMC(SC44(SCCNT),"SCDTPR",.SCLIST,.SCERR)
"RTN","SCAPMC14",75,0)
PRACQ Q $G(@SCERR@(0))<1
"RTN","SCAPMC14",76,0)
 ;
"RTN","SCAPMC14",77,0)
OKDATA() ;setup/check variables
"RTN","SCAPMC14",78,0)
 N SCOK
"RTN","SCAPMC14",79,0)
 S SCOK=1
"RTN","SCAPMC14",80,0)
 S SCYESCL=$G(SCYESCL,0)
"RTN","SCAPMC14",81,0)
 D INIT^SCAPMCU1(.SCOK) ; set default dates & error array (if undefined)
"RTN","SCAPMC14",82,0)
 IF '$D(^VA(200,+$G(SC200),0)) D  S SCOK=0
"RTN","SCAPMC14",83,0)
 . S SCPARM("PRACT")=$G(SC200,"Undefined")
"RTN","SCAPMC14",84,0)
 . D ERR^SCAPMCU1(.SCESEQ,4045101,.SCPARM,"",.SCERR)
"RTN","SCAPMC14",85,0)
 ; -- is it a valid DFN passed (Error # 20001 in DIALOG file)
"RTN","SCAPMC14",86,0)
 IF '$D(^VA(200,+SC200,0)) D   S SCOK=0
"RTN","SCAPMC14",87,0)
 . S SCPARM("PRACT")=SC200
"RTN","SCAPMC14",88,0)
 . D ERR^SCAPMCU1(SCESEQ,20001,.SCPARM,"",.SCERR)
"RTN","SCAPMC14",89,0)
 Q SCOK
"RTN","SCAPMC14",90,0)
 ;
"RTN","SCAPMC29")
0^2^B5381891^B9093400
"RTN","SCAPMC29",1,0)
SCAPMC29 ;ALB/REW - TEAM APIs:CLPT  ; 2/17/00 1:33pm
"RTN","SCAPMC29",2,0)
 ;;5.3;Scheduling;**41,210,520**;AUG 13, 1993;Build 26
"RTN","SCAPMC29",3,0)
 ;;1.0
"RTN","SCAPMC29",4,0)
CLPT(DFN,SCDATES,SCTEAMA,SCLIST,SCERR) ;clinics for patient
"RTN","SCAPMC29",5,0)
 ; input:
"RTN","SCAPMC29",6,0)
 ;  DFN = ien of PATIENT <FILE#2> [required]
"RTN","SCAPMC29",7,0)
 ;  SCDATES("BEGIN") = begin date to search (inclusive)
"RTN","SCAPMC29",8,0)
 ;                       [default: TODAY]
"RTN","SCAPMC29",9,0)
 ;         ("END")   = end date to search (inclusive)
"RTN","SCAPMC29",10,0)
 ;                       [default: TODAY]
"RTN","SCAPMC29",11,0)
 ;         ("INCL")  = 1: only use pracitioners who were on
"RTN","SCAPMC29",12,0)
 ;                       team for entire date range
"RTN","SCAPMC29",13,0)
 ;                     0: anytime in date range
"RTN","SCAPMC29",14,0)
 ;                      [default: 1] 
"RTN","SCAPMC29",15,0)
 ;  SCTEAMA= array of teams to include reverse with scposa('exclude')
"RTN","SCAPMC29",16,0)
 ;  SCERR = array NAME to store error messages.
"RTN","SCAPMC29",17,0)
 ;          [ex. ^TMP("ORXX",$J)]
"RTN","SCAPMC29",18,0)
 ;
"RTN","SCAPMC29",19,0)
 ; Output:
"RTN","SCAPMC29",20,0)
 ;  SCLIST() = array of clinics
"RTN","SCAPMC29",21,0)
 ;             Format:
"RTN","SCAPMC29",22,0)
 ;               Subscript: Sequential # from 1 to n
"RTN","SCAPMC29",23,0)
 ;               Piece     Description
"RTN","SCAPMC29",24,0)
 ;                 1       IEN of HOSPITAL LOCATION file entry (#44)
"RTN","SCAPMC29",25,0)
 ;                 2       Name of CLINIC
"RTN","SCAPMC29",26,0)
 ;                 3       ENROLLMENT DATE
"RTN","SCAPMC29",27,0)
 ;                 4       DISCHARGE DATE
"RTN","SCAPMC29",28,0)
 ;                 5       OPT OR AC
"RTN","SCAPMC29",29,0)
 ;                 6       REVIEW DATE
"RTN","SCAPMC29",30,0)
 ;
"RTN","SCAPMC29",31,0)
 ;  SCERR()  = Array of DIALOG file messages(errors) .
"RTN","SCAPMC29",32,0)
 ;  @SCERR(0)= Number of error(s), UNDEFINED if no errors
"RTN","SCAPMC29",33,0)
 ;             Foramt:
"RTN","SCAPMC29",34,0)
 ;               Subscript: Sequential # from 1 to n
"RTN","SCAPMC29",35,0)
 ;               Piece     Description
"RTN","SCAPMC29",36,0)
 ;                 1       IEN of DIALOG file
"RTN","SCAPMC29",37,0)
 ;   Returned: 1 if ok, 0 if error
"RTN","SCAPMC29",38,0)
 ;
"RTN","SCAPMC29",39,0)
 ; -- initialize control variables
"RTN","SCAPMC29",40,0)
 ;
"RTN","SCAPMC29",41,0)
ST N SCX,SCS,SC44,SCACOPT,SCTM,SCPOSA,SCTP
"RTN","SCAPMC29",42,0)
 N SCLSEQ,SCN,SCESEQ,SCPARM,SCP,SCBEGIN,SCEND,SCINCL,SCDTS,SCOK,SCS,SCND,SCACT,SCINACT,SCREVDT,SCCLNM
"RTN","SCAPMC29",43,0)
 G:'$$OKDATA PTCLQ ; check/setup variables
"RTN","SCAPMC29",44,0)
 IF $L($G(SCTEAMA)) D
"RTN","SCAPMC29",45,0)
 .S SCTM=0
"RTN","SCAPMC29",46,0)
 .F  S SCTM=$O(@SCTEAMA@(SCTM)) Q:'SCTM  D  Q:'SCX
"RTN","SCAPMC29",47,0)
 ..S SCX=$$TPTM^SCAPMC(SCTM,SCDATES,,,"SCPOSAX",.SCERR)
"RTN","SCAPMC29",48,0)
 .F SCX=1:1 S SCTP=+$G(SCPOSAX(SCX)) Q:'SCTP  S SCPOSA(SCTP)=""
"RTN","SCAPMC29",49,0)
 .S:$D(@SCTEAMA@("EXCLUDE")) SCPOSA("EXCLUDE")=""
"RTN","SCAPMC29",50,0)
 ;S SCX=0 F  S SCX=$O(^DPT(DFN,"DE",SCX)) Q:'SCX  D
"RTN","SCAPMC29",51,0)
 ;.S SC44=+$G(^DPT(DFN,"DE",SCX,0))
"RTN","SCAPMC29",52,0)
 ;.Q:'SC44
"RTN","SCAPMC29",53,0)
 ;.Q:'$$OKCLIN(SC44,.SCPOSA)
"RTN","SCAPMC29",54,0)
 ;.S SCCLNM=$P($G(^SC(SC44,0)),U,1)
"RTN","SCAPMC29",55,0)
 ;.S SCS=0 F  S SCS=$O(^DPT(DFN,"DE",SCX,1,SCS)) Q:'SCS  D
"RTN","SCAPMC29",56,0)
 ;..S SCND=$G(^DPT(DFN,"DE",SCX,1,SCS,0))
"RTN","SCAPMC29",57,0)
 ;..S SCACT=$P(SCND,U,1)
"RTN","SCAPMC29",58,0)
 ;..S SCINACT=$P(SCND,U,3)
"RTN","SCAPMC29",59,0)
 ;..Q:'$$DTCHK^SCAPU1(SCBEGIN,SCEND,SCINCL,SCACT,SCINACT)
"RTN","SCAPMC29",60,0)
 ;..S SCACOPT=$P(SCND,U,2)
"RTN","SCAPMC29",61,0)
 ;..S SCREVDT=$P(SCND,U,5)
"RTN","SCAPMC29",62,0)
 ;..S SCN=$G(@SCLIST@(0),0)+1
"RTN","SCAPMC29",63,0)
 ;..;bp/ar nois brx-1298-12323 prevent undefined variable error
"RTN","SCAPMC29",64,0)
 ;..;New code begins
"RTN","SCAPMC29",65,0)
 ;..Q:'SCACT
"RTN","SCAPMC29",66,0)
 ;..Q:'SCN
"RTN","SCAPMC29",67,0)
 ;.;End of brx-1298-12323
"RTN","SCAPMC29",68,0)
 ;..S @SCLIST@(0)=SCN
"RTN","SCAPMC29",69,0)
 ;..S @SCLIST@(SCN)=SC44_U_SCCLNM_U_SCACT_U_SCINACT_U_SCACOPT_U_SCREVDT
"RTN","SCAPMC29",70,0)
 ;..S @SCLIST@("SCCL",SC44,SCACT,SCN)=""
"RTN","SCAPMC29",71,0)
PTCLQ Q $G(@SCERR@(0))<1
"RTN","SCAPMC29",72,0)
 ;
"RTN","SCAPMC29",73,0)
OKCLIN(SC44,SCPOSA) ;is clinic ok, given position array
"RTN","SCAPMC29",74,0)
 N SCOK,SCTP
"RTN","SCAPMC29",75,0)
 IF '$D(SCPOSA) S SCOK=1 G QTOKC
"RTN","SCAPMC29",76,0)
 S (SCOK,SCTP)=0
"RTN","SCAPMC29",77,0)
 F  S SCTP=$O(^SCTM(404.57,"E",+SC44,SCTP)) Q:'SCTP  S:$$OKARRAY^SCAPU1(.SCPOSA,SCTP) SCOK=1
"RTN","SCAPMC29",78,0)
QTOKC Q SCOK
"RTN","SCAPMC29",79,0)
 ;
"RTN","SCAPMC29",80,0)
OKDATA() ;check/setup variables - return 1 if ok; 0 if error
"RTN","SCAPMC29",81,0)
 N SCOK
"RTN","SCAPMC29",82,0)
 S SCOK=1
"RTN","SCAPMC29",83,0)
 D INIT^SCAPMCU1(.SCOK) ; set default dates & error array (if undefined)
"RTN","SCAPMC29",84,0)
 IF '$D(^DPT(+$G(DFN),0)) D  S SCOK=0
"RTN","SCAPMC29",85,0)
 . S SCPARM("PATIENT")=$G(DFN,"Undefined")
"RTN","SCAPMC29",86,0)
 . D ERR^SCAPMCU1(.SCESEQ,4045101,.SCPARM,"",.SCERR)
"RTN","SCAPMC29",87,0)
 Q SCOK
"RTN","SCAPMC30")
0^3^B6119989^B6119891
"RTN","SCAPMC30",1,0)
SCAPMC30 ;ALB/REW - TEAM APIs:TPCL  ; 30 Jun 95
"RTN","SCAPMC30",2,0)
 ;;5.3;Scheduling;**41,520**;AUG 13, 1993;Build 26
"RTN","SCAPMC30",3,0)
 ;;1.0
"RTN","SCAPMC30",4,0)
TPCL(SC44,SCDATES,SCPOSA,SCUSRA,SCPURPA,SCROLEA,SCLIST,SCERR) ;  -- list of positions for a clinic
"RTN","SCAPMC30",5,0)
 ; input:
"RTN","SCAPMC30",6,0)
 ;  SC44 = ien of HOSPITAL LOCATION <FILE#44> [required]
"RTN","SCAPMC30",7,0)
 ; SCDATES("BEGIN") = begin date to search (inclusive)
"RTN","SCAPMC30",8,0)
 ;                      [default: TODAY]
"RTN","SCAPMC30",9,0)
 ;        ("END")   = end date to search (inclusive)
"RTN","SCAPMC30",10,0)
 ;                      [default: TODAY]
"RTN","SCAPMC30",11,0)
 ;        ("INCL")  = 1: only use patients who were assigned to
"RTN","SCAPMC30",12,0)
 ;                       team for entire date range
"RTN","SCAPMC30",13,0)
 ;                    0: anytime in date range
"RTN","SCAPMC30",14,0)
 ;                      [default: 1] 
"RTN","SCAPMC30",15,0)
 ;  SCPOSA -array of pointers to team position - 404.57 (per SCPURPA)
"RTN","SCAPMC30",16,0)
 ;  SCUSRA -array of pointers to user file - 8930 (per SCPURPA array)
"RTN","SCAPMC30",17,0)
 ;  SCPURPA -array of pointers to team purpose file 403.47
"RTN","SCAPMC30",18,0)
 ;          if none are defined - returns all teams
"RTN","SCAPMC30",19,0)
 ;          if @SCPURPA@('exclude') is defined - exclude listed teams
"RTN","SCAPMC30",20,0)
 ;  SCROLEA - array of pointers to std position file 403.46 (per SCPURPA)
"RTN","SCAPMC30",21,0)
 ;  SCLIST -array name to store list
"RTN","SCAPMC30",22,0)
 ;          [ex. ^TMP("SCPT",$J)]
"RTN","SCAPMC30",23,0)
 ;        
"RTN","SCAPMC30",24,0)
 ;  SCERR = array NAME to store error messages.
"RTN","SCAPMC30",25,0)
 ;          [ex. ^TMP("ORXX",$J)]
"RTN","SCAPMC30",26,0)
 ;
"RTN","SCAPMC30",27,0)
 ; Output:
"RTN","SCAPMC30",28,0)
 ;  SCLIST() = array of positions (includes SCTP xref)
"RTN","SCAPMC30",29,0)
 ;             Format:
"RTN","SCAPMC30",30,0)
 ;               Subscript: Sequential # from 1 to n
"RTN","SCAPMC30",31,0)
 ;               Piece     Description
"RTN","SCAPMC30",32,0)
 ;                 1       IEN of TEAM POSITION File (#404.57)
"RTN","SCAPMC30",33,0)
 ;                 2       Name of Position
"RTN","SCAPMC30",34,0)
 ;                 3       IEN of Team #404.51
"RTN","SCAPMC30",35,0)
 ;                 4       IEN of file #404.59 (Tm Pos History)
"RTN","SCAPMC30",36,0)
 ;                 5       current effective date
"RTN","SCAPMC30",37,0)
 ;                 6       current inactivate date (if any)
"RTN","SCAPMC30",38,0)
 ;                 7       pointer to 403.46 (role)
"RTN","SCAPMC30",39,0)
 ;                 8       Name of Standard Role
"RTN","SCAPMC30",40,0)
 ;                 9       pointer to User Class (#8930)
"RTN","SCAPMC30",41,0)
 ;                10       Name of User Class
"RTN","SCAPMC30",42,0)
 ;                Subscript: "SCTP",SCTM,IEN =""
"RTN","SCAPMC30",43,0)
 ;
"RTN","SCAPMC30",44,0)
 ;  SCERR() = Array of DIALOG file messages(errors) .
"RTN","SCAPMC30",45,0)
 ;  @SCERR@(0) = number of errors, undefined if none
"RTN","SCAPMC30",46,0)
 ;             Format:
"RTN","SCAPMC30",47,0)
 ;               Subscript: Sequential # from 1 to n
"RTN","SCAPMC30",48,0)
 ;               Piece     Description
"RTN","SCAPMC30",49,0)
 ;                 1       IEN of DIALOG file
"RTN","SCAPMC30",50,0)
 ;  Returned: 1 if ok, 0 if error
"RTN","SCAPMC30",51,0)
 ; Other:
"RTN","SCAPMC30",52,0)
 ;  SCACTHIS =  status (-1:err|0:inact|1:act)^404.52 ien ^actdt^inacdt
"RTN","SCAPMC30",53,0)
 ;
"RTN","SCAPMC30",54,0)
 ;
"RTN","SCAPMC30",55,0)
ST N SCPTTP,SCPTTP0,SCTP,SCR,SCACTHIS,SCTM,SCND,SCU,SCOK,SCP,SCTPCL
"RTN","SCAPMC30",56,0)
 N SCLSEQ,SCN,SCESEQ,SCPARM,SCBEGIN,SCEND,SCINCL,SCDTS
"RTN","SCAPMC30",57,0)
 ; -- initialize control variables
"RTN","SCAPMC30",58,0)
 S SCOK=1
"RTN","SCAPMC30",59,0)
 G:'$$OKDATA CLTPQ
"RTN","SCAPMC30",60,0)
 S SCTP=0 F  S SCTP=$O(^SCTM(404.57,"E",SC44,SCTP)) Q:'SCTP  D  Q:'SCOK
"RTN","SCAPMC30",61,0)
 .S SCTP0=$G(^SCTM(404.57,SCTP,0))
"RTN","SCAPMC30",62,0)
 .IF '$L(SCTP0) D
"RTN","SCAPMC30",63,0)
 ..S SCPARM("POSITION")=$G(SCTP,"Undefined")
"RTN","SCAPMC30",64,0)
 ..S SCPARM("CLINIC")=$G(SC44,"Undefined")
"RTN","SCAPMC30",65,0)
 ..D ERR^SCAPMCU1(.SCESEQ,4045101,.SCPARM,"",.SCERR)
"RTN","SCAPMC30",66,0)
 .S SCTM=$P($G(^SCTM(404.57,SCTP,0)),U,2)
"RTN","SCAPMC30",67,0)
 .S SCP=$P(^SCTM(404.51,+SCTM,0),U,3)
"RTN","SCAPMC30",68,0)
 .Q:'$$OKARRAY^SCAPU1(.SCPURPA,.SCP)
"RTN","SCAPMC30",69,0)
 .S SCR=+$P(^SCTM(404.57,SCTP,0),U,3)
"RTN","SCAPMC30",70,0)
 .Q:'$$OKARRAY^SCAPU1(.SCROLEA,.SCR)
"RTN","SCAPMC30",71,0)
 .S SCACTHIS=$$ACTHIST^SCAPMCU2(404.59,SCTP,SCDATES,SCERR,"SCTPCL")
"RTN","SCAPMC30",72,0)
 .Q:'SCACTHIS
"RTN","SCAPMC30",73,0)
 .D BLD^SCAPMC24(.SCLIST,SCTM,SCTP,SCACTHIS,SCR)
"RTN","SCAPMC30",74,0)
CLTPQ Q $G(@SCERR@(0))<1
"RTN","SCAPMC30",75,0)
 ;
"RTN","SCAPMC30",76,0)
OKDATA() ;check/setup variables - return 1 if ok; 0 if error
"RTN","SCAPMC30",77,0)
 N SCOK
"RTN","SCAPMC30",78,0)
 S SCOK=1
"RTN","SCAPMC30",79,0)
 D INIT^SCAPMCU1(.SCOK) ; set default dates & error array (if undefined)
"RTN","SCAPMC30",80,0)
 IF '$D(^SC(+$G(SC44),0)) D  S SCOK=0
"RTN","SCAPMC30",81,0)
 . S SCPARM("CLINIC")=$G(SC44,"Undefined")
"RTN","SCAPMC30",82,0)
 . D ERR^SCAPMCU1(.SCESEQ,4045101,.SCPARM,"",.SCERR)
"RTN","SCAPMC30",83,0)
 Q SCOK
"RTN","SCAPMC9")
0^4^B5296004^B5295919
"RTN","SCAPMC9",1,0)
SCAPMC9 ;ALB/REW - Team API's:PRCL ; JUN 26, 1995
"RTN","SCAPMC9",2,0)
 ;;5.3;Scheduling;**41,112,520**;AUG 13, 1993;Build 26
"RTN","SCAPMC9",3,0)
 ;;1.0
"RTN","SCAPMC9",4,0)
PRCL(SC44,SCDATES,SCPOSA,SCUSRA,SCROLEA,SCLIST,SCERR) ;-- list of practitioners for clinic
"RTN","SCAPMC9",5,0)
 ; input:
"RTN","SCAPMC9",6,0)
 ;  SC44 = ien of CLINIC <FILE#44> [required]
"RTN","SCAPMC9",7,0)
 ;  SCDATES("BEGIN") = begin date to search (inclusive)
"RTN","SCAPMC9",8,0)
 ;                       [default: TODAY]
"RTN","SCAPMC9",9,0)
 ;         ("END")   = end date to search (inclusive)
"RTN","SCAPMC9",10,0)
 ;                       [default: TODAY]
"RTN","SCAPMC9",11,0)
 ;         ("INCL")  = 1: only use pracitioners who were on
"RTN","SCAPMC9",12,0)
 ;                       team for entire date range
"RTN","SCAPMC9",13,0)
 ;                     0: anytime in date range
"RTN","SCAPMC9",14,0)
 ;                      [default: 1] 
"RTN","SCAPMC9",15,0)
 ;  SCPOSA= array of positions to include reverse with scposa('exclude')
"RTN","SCAPMC9",16,0)
 ;  SCUSRA= array of usr classes included reverse with scusra('exclude')
"RTN","SCAPMC9",17,0)
 ;  SCROLEA= array of roles included reverse with SCROLEA('exclude')
"RTN","SCAPMC9",18,0)
 ;  SCERR = array NAME to store error messages.
"RTN","SCAPMC9",19,0)
 ;          [ex. ^TMP("ORXX",$J)]
"RTN","SCAPMC9",20,0)
 ;
"RTN","SCAPMC9",21,0)
 ; Output:
"RTN","SCAPMC9",22,0)
 ;  SCLIST() = array of practitioners
"RTN","SCAPMC9",23,0)
 ;             Format:
"RTN","SCAPMC9",24,0)
 ;               Subscript: Sequential # from 1 to n
"RTN","SCAPMC9",25,0)
 ;               Piece     Description
"RTN","SCAPMC9",26,0)
 ;                 1       IEN of NEW PERSON file entry (#200)
"RTN","SCAPMC9",27,0)
 ;                 2       Name of person
"RTN","SCAPMC9",28,0)
 ;                 3       IEN of TEAM POSITION file (#404.57)
"RTN","SCAPMC9",29,0)
 ;                 4       Name of Position
"RTN","SCAPMC9",30,0)
 ;                 5       IEN OF USR CLASS(#8930) of POSITION (#404.57)
"RTN","SCAPMC9",31,0)
 ;                 6       USR Class Name
"RTN","SCAPMC9",32,0)
 ;                 7       IEN of STANDARD POSITION (#403.46)
"RTN","SCAPMC9",33,0)
 ;                 8       Standard Role (Position) Name
"RTN","SCAPMC9",34,0)
 ;                 9       Activation Date for 404.52 (not 404.59!)
"RTN","SCAPMC9",35,0)
 ;                 10      Inactivation Date for 404.52
"RTN","SCAPMC9",36,0)
 ;                 11      IEN of Position Ass History (404.52)
"RTN","SCAPMC9",37,0)
 ;                 12      IEN of Preceptor Position
"RTN","SCAPMC9",38,0)
 ;                 13      Name of Preceptor Position
"RTN","SCAPMC9",39,0)
 ;  @sclist@('scpr',sc200,sctp,scact,scn)=""
"RTN","SCAPMC9",40,0)
 ;
"RTN","SCAPMC9",41,0)
 ;  SCERR() = Array of DIALOG file messages(errors) .
"RTN","SCAPMC9",42,0)
 ;             Foramt:
"RTN","SCAPMC9",43,0)
 ;  @SCERR@(0) = Number of errors, undefined if none
"RTN","SCAPMC9",44,0)
 ;               Subscript: Sequential # from 1 to n
"RTN","SCAPMC9",45,0)
 ;               Piece     Description
"RTN","SCAPMC9",46,0)
 ;                 1       IEN of DIALOG file
"RTN","SCAPMC9",47,0)
 ;   Returned: 1 if ok, 0 if error
"RTN","SCAPMC9",48,0)
 ;
"RTN","SCAPMC9",49,0)
 ;
"RTN","SCAPMC9",50,0)
ST N SCPOSNM,SCTP,SCPOS0,SCOK,SCND,SCU,SCR,SCPRCL
"RTN","SCAPMC9",51,0)
 N SCLSEQ,SCN,SCESEQ,SCPARM,SCP,SCBEGIN,SCEND,SCINCL,SCDTS
"RTN","SCAPMC9",52,0)
 ; -- initialize control variables
"RTN","SCAPMC9",53,0)
 G:'$$OKDATA PRACQ ; check/setup variables
"RTN","SCAPMC9",54,0)
 ; -- loop through team positions
"RTN","SCAPMC9",55,0)
 S SCTP=0
"RTN","SCAPMC9",56,0)
 F  S SCTP=$O(^SCTM(404.57,"E",SC44,SCTP)) Q:SCTP=""  D
"RTN","SCAPMC9",57,0)
 .Q:'$$OKARRAY^SCAPU1(.SCPOSA,SCTP)
"RTN","SCAPMC9",58,0)
 .S SCND=$G(^SCTM(404.57,SCTP,0))
"RTN","SCAPMC9",59,0)
 .S SCU=$P(SCND,U,13)
"RTN","SCAPMC9",60,0)
 .Q:'$$OKUSRCL^SCAPU1(.SCUSRA,SCU)
"RTN","SCAPMC9",61,0)
 .S SCR=$P(SCND,U,3)
"RTN","SCAPMC9",62,0)
 .Q:'$$OKARRAY^SCAPU1(.SCROLEA,.SCR)
"RTN","SCAPMC9",63,0)
 .IF 'SCTP D  Q
"RTN","SCAPMC9",64,0)
 ..S SCPARM("Position")=$G(SCTP,"Undefined")
"RTN","SCAPMC9",65,0)
 ..D ERR^SCAPMCU1(.SCESEQ,4045101,.SCPARM,"",SCERR)
"RTN","SCAPMC9",66,0)
 .ELSE  D
"RTN","SCAPMC9",67,0)
 ..S SCX=$$ACTHIST^SCAPMCU2(404.52,SCTP,SCDATES,.SCERR,"SCPRCL")
"RTN","SCAPMC9",68,0)
 ..S:SCX X=$$PRTP^SCAPMC8(SCTP,SCDATES,.SCLIST,.SCERR)
"RTN","SCAPMC9",69,0)
PRACQ Q $G(@SCERR@(0))<1
"RTN","SCAPMC9",70,0)
OKDATA() ;check/setup variables - return 1 if ok/ 0 if error
"RTN","SCAPMC9",71,0)
 N SCOK
"RTN","SCAPMC9",72,0)
 S SCOK=1
"RTN","SCAPMC9",73,0)
 D INIT^SCAPMCU1(.SCOK) ; set default dates & error array (if undefined)
"RTN","SCAPMC9",74,0)
 ;
"RTN","SCAPMC9",75,0)
 IF '$D(^SC(+$G(SC44),0)) D  S SCOK=0
"RTN","SCAPMC9",76,0)
 . S SCPARM("CLINIC")=$G(SC44,"Undefined")
"RTN","SCAPMC9",77,0)
 . D ERR^SCAPMCU1(.SCESEQ,4045101,.SCPARM,"",.SCERR)
"RTN","SCAPMC9",78,0)
 Q SCOK
"RTN","SCMCDD2")
0^24^B3853809^B3853753
"RTN","SCMCDD2",1,0)
SCMCDD2 ;ALB/REW - DD Calls used by PCMM ; 27 March 1996
"RTN","SCMCDD2",2,0)
 ;;5.3;Scheduling;**41,107,520**;AUG 13, 1993;Build 26
"RTN","SCMCDD2",3,0)
 ;1
"RTN","SCMCDD2",4,0)
USEPCDEF(SCCL) ;how should pc practitioner be used for clinic
"RTN","SCMCDD2",5,0)
 ; return 2=always default 1=default if no provider listed 0 -never
"RTN","SCMCDD2",6,0)
 Q 2
"RTN","SCMCDD2",7,0)
SETSCTM(SCTP,SCCL,SCTMNM) ;create 'TEAM' x-ref for Hospital Location File (#44)
"RTN","SCMCDD2",8,0)
 ; x=sccl, da=sctp sctmnm=name of team
"RTN","SCMCDD2",9,0)
 Q:'$G(SCTP)!('$G(SCCL))
"RTN","SCMCDD2",10,0)
 S SCTMNM=$G(SCTMNM,$P(^SCTM(404.51,+$P(^SCTM(404.57,SCTP,0),U,2),0),U))
"RTN","SCMCDD2",11,0)
 S:$L(SCTMNM) ^SC("TEAM",SCTMNM,+SCCL)=""
"RTN","SCMCDD2",12,0)
 Q
"RTN","SCMCDD2",13,0)
 ;
"RTN","SCMCDD2",14,0)
KILLSCTM(SCTP,SCCL,SCTMNM) ;kill 'TEAM' x-ref for File #44 (if no other positions from team have this as associated clinic)
"RTN","SCMCDD2",15,0)
 ; x=sccl, da=sctp sctmnm=name of team
"RTN","SCMCDD2",16,0)
 N SCTM
"RTN","SCMCDD2",17,0)
 Q:'$G(SCTP)!('$G(SCCL))
"RTN","SCMCDD2",18,0)
 S SCTM=+$P(^SCTM(404.57,SCTP,0),U,2)
"RTN","SCMCDD2",19,0)
 S SCTMNM=$G(SCTMNM,$P(^SCTM(404.51,+SCTM,0),U))
"RTN","SCMCDD2",20,0)
 K:$L(SCTMNM)&('$$OKTMCL(SCTM,SCTP,SCCL)) ^SC("TEAM",SCTMNM,+SCCL)
"RTN","SCMCDD2",21,0)
 Q
"RTN","SCMCDD2",22,0)
OKTMCL(SCTM,SCTP,SCCL) ;does team have another position with this clinic as an assoicated clinic?
"RTN","SCMCDD2",23,0)
 N SCXTP,SCOK
"RTN","SCMCDD2",24,0)
 S SCOK=0
"RTN","SCMCDD2",25,0)
 S SCXTP=0
"RTN","SCMCDD2",26,0)
 F  S SCXTP=$O(^SCTM(404.57,"E",SCCL,SCXTP)) Q:('SCXTP)!(SCXTP=SCTP)  D
"RTN","SCMCDD2",27,0)
 .I $P(^SCTM(404.57,SCXTP,0),U,2)'=SCTM Q
"RTN","SCMCDD2",28,0)
 .S SCOK=1
"RTN","SCMCDD2",29,0)
 Q SCOK
"RTN","SCMCDD2",30,0)
STSCTMNM(SCTM,SCTMNM) ;if team name changes - set for 'TEAM' xrefs for file#44
"RTN","SCMCDD2",31,0)
 ; sctm=da sctmnm=x
"RTN","SCMCDD2",32,0)
 Q:'$G(SCTM)!(SCTMNM="")
"RTN","SCMCDD2",33,0)
 N SCTPNM,SCCL
"RTN","SCMCDD2",34,0)
 S SCTPNM=""
"RTN","SCMCDD2",35,0)
 F  S SCTPNM=$O(^SCTM(404.57,"ATMPOS",SCTM,SCTPNM)) Q:SCTPNM=""  D
"RTN","SCMCDD2",36,0)
 .S SCTP=$O(^SCTM(404.57,"ATMPOS",SCTM,SCTPNM,0)) ;note: name is unique
"RTN","SCMCDD2",37,0)
 .S SCCL=$P($G(^SCTM(404.57,+SCTP,0)),U,9)
"RTN","SCMCDD2",38,0)
 .D:SCCL SETSCTM(SCTP,SCCL,SCTMNM)
"RTN","SCMCDD2",39,0)
 Q
"RTN","SCMCDD2",40,0)
KLSCTMNM(SCTM,SCTMNM) ;if team name changes - kill 'TEAM' xrefs for file #44
"RTN","SCMCDD2",41,0)
 ; sctm=da sctmnm=x
"RTN","SCMCDD2",42,0)
 Q:'$G(SCTM)!(SCTMNM="")
"RTN","SCMCDD2",43,0)
 N SCTPNM,SCCL
"RTN","SCMCDD2",44,0)
 S SCTPNM=""
"RTN","SCMCDD2",45,0)
 F  S SCTPNM=$O(^SCTM(404.57,"ATMPOS",SCTM,SCTPNM)) Q:SCTPNM=""  D
"RTN","SCMCDD2",46,0)
 .S SCTP=$O(^SCTM(404.57,"ATMPOS",SCTM,SCTPNM,0)) ;note: name is unique
"RTN","SCMCDD2",47,0)
 .S SCCL=$P($G(^SCTM(404.57,+SCTP,0)),U,9)
"RTN","SCMCDD2",48,0)
 .K:SCCL ^SC("TEAM",SCTMNM)
"RTN","SCMCDD2",49,0)
 Q
"RTN","SCRPBK11")
0^25^B14197732^B14197603
"RTN","SCRPBK11",1,0)
SCRPBK11 ;MJK/ALB - RPC Broker Utilities ; 27 FEB 96
"RTN","SCRPBK11",2,0)
 ;;5.3;Scheduling;**41,520**;AUG 13, 1993;Build 26
"RTN","SCRPBK11",3,0)
 ;
"RTN","SCRPBK11",4,0)
GETSEL(SCDATA,SCTYPE,SCIEN) ; 
"RTN","SCRPBK11",5,0)
 ; -- get SELECTION entity data for details form
"RTN","SCRPBK11",6,0)
 ;
"RTN","SCRPBK11",7,0)
 ;  input:  SCTYPE       := type of autolink (DIVISIOND, TEAM, ectc.)
"RTN","SCRPBK11",8,0)
 ;          SCIEN        := ien of entity
"RTN","SCRPBK11",9,0)
 ; output:  SCDATA(1..n) := info about entity
"RTN","SCRPBK11",10,0)
 ;
"RTN","SCRPBK11",11,0)
 ; -- SEE BOTTOM OF SCRPBK FOR VARIABLE DEFINITIONS
"RTN","SCRPBK11",12,0)
 ;
"RTN","SCRPBK11",13,0)
 ; Related RPC: SCRP FILE ENTRY GETSELECTION
"RTN","SCRPBK11",14,0)
 ;                    
"RTN","SCRPBK11",15,0)
 N SC0,SCI,SCINC
"RTN","SCRPBK11",16,0)
 S SCINC=0,SCID=+SCIEN
"RTN","SCRPBK11",17,0)
 ;
"RTN","SCRPBK11",18,0)
 IF SCTYPE="DIVISION" D DIV G GETSELQ
"RTN","SCRPBK11",19,0)
 ;
"RTN","SCRPBK11",20,0)
 IF SCTYPE="TEAM" D TEAM G GETSELQ
"RTN","SCRPBK11",21,0)
 ;
"RTN","SCRPBK11",22,0)
 IF SCTYPE="PRACTITIONER" D PRAC G GETSELQ
"RTN","SCRPBK11",23,0)
 ;
"RTN","SCRPBK11",24,0)
 IF SCTYPE="ROLE" D ROLE G GETSELQ
"RTN","SCRPBK11",25,0)
 ;
"RTN","SCRPBK11",26,0)
 IF SCTYPE="CLINIC" D CLIN G GETSELQ
"RTN","SCRPBK11",27,0)
 ;
"RTN","SCRPBK11",28,0)
 IF SCTYPE="USERCLASS" D USER G GETSELQ
"RTN","SCRPBK11",29,0)
 ;
"RTN","SCRPBK11",30,0)
GETSELQ Q
"RTN","SCRPBK11",31,0)
 ;
"RTN","SCRPBK11",32,0)
SET(X,INC,SCDATA) ; -- set value in return array
"RTN","SCRPBK11",33,0)
 S INC=$G(INC)+1,SCDATA(INC)=X
"RTN","SCRPBK11",34,0)
 Q
"RTN","SCRPBK11",35,0)
 ;
"RTN","SCRPBK11",36,0)
DIV ; -- get division details
"RTN","SCRPBK11",37,0)
 D SET("Teams in  Division:",.SCINC,.SCDATA)
"RTN","SCRPBK11",38,0)
 D SET("------------------",.SCINC,.SCDATA)
"RTN","SCRPBK11",39,0)
 S SCI=0 F  S SCI=$O(^SCTM(404.51,"AINST",SCID,SCI)) Q:'SCI  D
"RTN","SCRPBK11",40,0)
 . D SET($P($G(^SCTM(404.51,SCI,0)),U),.SCINC,.SCDATA)
"RTN","SCRPBK11",41,0)
 Q
"RTN","SCRPBK11",42,0)
 ;
"RTN","SCRPBK11",43,0)
TEAM ; -- get team description
"RTN","SCRPBK11",44,0)
 N SC,SCFLE,SCIEN,SCDEF
"RTN","SCRPBK11",45,0)
 S SCFLE=404.51,SCIEN=SCID_",",SCDEF="<none specified>"
"RTN","SCRPBK11",46,0)
 D GETS^DIQ(SCFLE,SCID_",",50,"","SC")
"RTN","SCRPBK11",47,0)
 D SET("Team Description:",.SCINC,.SCDATA)
"RTN","SCRPBK11",48,0)
 D SET("-----------------",.SCINC,.SCDATA)
"RTN","SCRPBK11",49,0)
 IF $O(SC(SCFLE,SCIEN,50,0)) D
"RTN","SCRPBK11",50,0)
 . S SCI=0 F  S SCI=$O(SC(SCFLE,SCIEN,50,SCI)) Q:'SCI  S X=SC(SCFLE,SCIEN,50,SCI) D
"RTN","SCRPBK11",51,0)
 . . D SET(X,.SCINC,.SCDATA)
"RTN","SCRPBK11",52,0)
 ELSE  D
"RTN","SCRPBK11",53,0)
 . D SET(SCDEF,.SCINC,.SCDATA)
"RTN","SCRPBK11",54,0)
 Q
"RTN","SCRPBK11",55,0)
 ;
"RTN","SCRPBK11",56,0)
PRAC ; -- get practitioner details
"RTN","SCRPBK11",57,0)
 N SC,SCFLE,SCIEN,SCDEF
"RTN","SCRPBK11",58,0)
 S SCFLE=200,SCIEN=SCID_",",SCDEF="<none specified>"
"RTN","SCRPBK11",59,0)
 D GETS^DIQ(SCFLE,SCID_",","1;8;28","","SC")
"RTN","SCRPBK11",60,0)
 D SET(" Initials: "_$S($G(SC(SCFLE,SCIEN,1))]"":SC(SCFLE,SCIEN,1),1:SCDEF),.SCINC,.SCDATA)
"RTN","SCRPBK11",61,0)
 D SET("Mail Code: "_$S($G(SC(SCFLE,SCIEN,28))]"":SC(SCFLE,SCIEN,28),1:SCDEF),.SCINC,.SCDATA)
"RTN","SCRPBK11",62,0)
 D SET("    Title: "_$S($G(SC(SCFLE,SCIEN,8))]"":SC(SCFLE,SCIEN,8),1:SCDEF),.SCINC,.SCDATA)
"RTN","SCRPBK11",63,0)
 Q
"RTN","SCRPBK11",64,0)
 ;
"RTN","SCRPBK11",65,0)
ROLE ; -- get standard role description
"RTN","SCRPBK11",66,0)
 N SC,SCFLE,SCIEN,SCDEF
"RTN","SCRPBK11",67,0)
 S SCFLE=403.46,SCIEN=SCID_",",SCDEF="<none specified>"
"RTN","SCRPBK11",68,0)
 D GETS^DIQ(SCFLE,SCID_",",1,"","SC")
"RTN","SCRPBK11",69,0)
 D SET("Role Description:",.SCINC,.SCDATA)
"RTN","SCRPBK11",70,0)
 D SET("-----------------",.SCINC,.SCDATA)
"RTN","SCRPBK11",71,0)
 IF $O(SC(SCFLE,SCIEN,1,0)) D
"RTN","SCRPBK11",72,0)
 . S SCI=0 F  S SCI=$O(SC(SCFLE,SCIEN,1,SCI)) Q:'SCI  S X=SC(SCFLE,SCIEN,1,SCI) D
"RTN","SCRPBK11",73,0)
 . . D SET(X,.SCINC,.SCDATA)
"RTN","SCRPBK11",74,0)
 ELSE  D
"RTN","SCRPBK11",75,0)
 . D SET(SCDEF,.SCINC,.SCDATA)
"RTN","SCRPBK11",76,0)
 Q
"RTN","SCRPBK11",77,0)
 ;
"RTN","SCRPBK11",78,0)
CLIN ; -- get clinic details
"RTN","SCRPBK11",79,0)
 N SC,SCFLE,SCIEN,SCDEF
"RTN","SCRPBK11",80,0)
 S SCFLE=44,SCIEN=SCID_",",SCDEF="<none specified>"
"RTN","SCRPBK11",81,0)
 D GETS^DIQ(SCFLE,SCID_",","1;3.5","","SC")
"RTN","SCRPBK11",82,0)
 D SET("Abbreviation: "_$S($G(SC(SCFLE,SCIEN,1))]"":SC(SCFLE,SCIEN,1),1:SCDEF),.SCINC,.SCDATA)
"RTN","SCRPBK11",83,0)
 D SET("    Division: "_$S($G(SC(SCFLE,SCIEN,3.5))]"":SC(SCFLE,SCIEN,3.5),1:SCDEF),.SCINC,.SCDATA)
"RTN","SCRPBK11",84,0)
 D SET(" ",.SCINC,.SCDATA)
"RTN","SCRPBK11",85,0)
 D SET("Associated Teams and Positions:",.SCINC,.SCDATA)
"RTN","SCRPBK11",86,0)
 D SET("-------------------------------",.SCINC,.SCDATA)
"RTN","SCRPBK11",87,0)
 S SCI=0 F  S SCI=$O(^SCTM(404.57,"E",SCID,SCI)) Q:'SCI  D
"RTN","SCRPBK11",88,0)
 . S X=$G(^SCTM(404.57,SCI,0))
"RTN","SCRPBK11",89,0)
 . D SET("      Team: "_$P($G(^SCTM(404.51,+$P(X,U,2),0)),U),.SCINC,.SCDATA)
"RTN","SCRPBK11",90,0)
 . D SET("  Position: "_$P(X,U),.SCINC,.SCDATA)
"RTN","SCRPBK11",91,0)
 . D SET(" ",.SCINC,.SCDATA)
"RTN","SCRPBK11",92,0)
 Q
"RTN","SCRPBK11",93,0)
 ;
"RTN","SCRPBK11",94,0)
USER ; -- get user class details
"RTN","SCRPBK11",95,0)
 D SET("No additional information available at this time. ",.SCINC,.SCDATA)
"RTN","SCRPBK11",96,0)
 Q
"RTN","SCRPBK11",97,0)
 ;
"RTN","SCRPEC")
0^5^B12978896^B15607236
"RTN","SCRPEC",1,0)
SCRPEC ;ALB/CMM - Detail List of Pts & Enroll Clinics ; 29 Jun 99  04:11PM
"RTN","SCRPEC",2,0)
 ;;5.3;Scheduling;**41,140,174,177,431,526,520**;AUG 13, 1993;Build 26
"RTN","SCRPEC",3,0)
 ;
"RTN","SCRPEC",4,0)
 ;Detailed Listing of Patients and Their Enrolled Clinics Report
"RTN","SCRPEC",5,0)
 ;
"RTN","SCRPEC",6,0)
PROMPTS ;
"RTN","SCRPEC",7,0)
 ;Prompt for Institution, Team, Clinic, Assigned or Unassigned to Primary
"RTN","SCRPEC",8,0)
 ;Care, and Print device
"RTN","SCRPEC",9,0)
 ;
"RTN","SCRPEC",10,0)
 N VAUTD,VAUTT,VAUTC,VAUTA,QTIME,PRNT
"RTN","SCRPEC",11,0)
 K VAUTD,VAUTT,VAUTC,VAUTA,VAUTCA,SCUP
"RTN","SCRPEC",12,0)
 S QTIME=""
"RTN","SCRPEC",13,0)
 W ! D INST^SCRPU1 I Y=-1 G ERR
"RTN","SCRPEC",14,0)
 W ! K Y D PRMTT^SCRPU1 I '$D(VAUTT) G ERR
"RTN","SCRPEC",15,0)
 ;S VAUTCA="" ;allows for selection of any clinic in one of the selected divisions
"RTN","SCRPEC",16,0)
 W ! K Y D CLINIC^SCRPU1 I '$D(VAUTC) G ERR
"RTN","SCRPEC",17,0)
 W ! K Y D ASSUN^SCRPU2 I '$D(VAUTA) G ERR
"RTN","SCRPEC",18,0)
 W !!,"This report requires 132 column output!"
"RTN","SCRPEC",19,0)
 D QUE(.VAUTD,.VAUTT,.VAUTC,.VAUTA) Q
"RTN","SCRPEC",20,0)
 ;
"RTN","SCRPEC",21,0)
QUE(INST,TEAM,CLINIC,ASSUN) ;queue report
"RTN","SCRPEC",22,0)
 ;Input Parameters: 
"RTN","SCRPEC",23,0)
 ;INST - institutions selected (variable and array) 
"RTN","SCRPEC",24,0)
 ;TEAM - teams selected (variable and array) 
"RTN","SCRPEC",25,0)
 ;CLINIC - clinics selected (variable and array) 
"RTN","SCRPEC",26,0)
 ;ASSUN - Assigned or Unassigned to PC
"RTN","SCRPEC",27,0)
 N ZTSAVE,II
"RTN","SCRPEC",28,0)
 F II="INST","TEAM","CLINIC","ASSUN","INST(","TEAM(","CLINIC(" S ZTSAVE(II)=""
"RTN","SCRPEC",29,0)
 W ! D EN^XUTMDEVQ("QENTRY^SCRPEC","Detailed Patient Enrollments",.ZTSAVE)
"RTN","SCRPEC",30,0)
 Q
"RTN","SCRPEC",31,0)
 ;
"RTN","SCRPEC",32,0)
ENTRY2(INST,TEAM,CLINIC,ASSUN,IOP,ZTDTH) ;
"RTN","SCRPEC",33,0)
 ;Second entry point for GUI to use
"RTN","SCRPEC",34,0)
 ;Input Parameters:
"RTN","SCRPEC",35,0)
 ;INST - institutions selected (variable and array)
"RTN","SCRPEC",36,0)
 ;TEAM - teams selected (variable and array)
"RTN","SCRPEC",37,0)
 ;CLINIC - clinics selected (variable and array)
"RTN","SCRPEC",38,0)
 ;ASSUN - Assigned or Unassigned to PC
"RTN","SCRPEC",39,0)
 ;IOP - print device
"RTN","SCRPEC",40,0)
 ;ZTDTH - queue time (optional)
"RTN","SCRPEC",41,0)
 ;
"RTN","SCRPEC",42,0)
 ;validate parameters
"RTN","SCRPEC",43,0)
 I '$D(INST)!'$D(TEAM)!'$D(CLINIC)!'$D(ASSUN)!'$D(IOP)!(IOP="") Q
"RTN","SCRPEC",44,0)
 ;
"RTN","SCRPEC",45,0)
 N NUMBER
"RTN","SCRPEC",46,0)
 S IOST=$P(IOP,"^",2),IOP=$P(IOP,"^")
"RTN","SCRPEC",47,0)
 I IOP?1"Q;".E S IOP=$P(IOP,"Q;",2)
"RTN","SCRPEC",48,0)
 I IOST?1"C-".E D QENTRY G RET
"RTN","SCRPEC",49,0)
 I ZTDTH="" S ZTDTH=$H
"RTN","SCRPEC",50,0)
 S ZTRTN="QENTRY^SCRPEC"
"RTN","SCRPEC",51,0)
 S ZTDESC="Detailed Patient List & Enrolled Clinics",ZTIO=IOP
"RTN","SCRPEC",52,0)
 N II
"RTN","SCRPEC",53,0)
 F II="INST","TEAM","CLINIC","ASSUN","INST(","TEAM(","CLINIC(","IOP" S ZTSAVE(II)=""
"RTN","SCRPEC",54,0)
 D ^%ZTLOAD
"RTN","SCRPEC",55,0)
RET S NUMBER=0
"RTN","SCRPEC",56,0)
 I $D(ZTSK) S NUMBER=ZTSK
"RTN","SCRPEC",57,0)
 D EXIT1
"RTN","SCRPEC",58,0)
 Q NUMBER
"RTN","SCRPEC",59,0)
 ;
"RTN","SCRPEC",60,0)
QENTRY ;
"RTN","SCRPEC",61,0)
 ;driver entry point
"RTN","SCRPEC",62,0)
 S VAUTTN=""
"RTN","SCRPEC",63,0)
 S TITL="Detailed Patient Assignments - "_$S(ASSUN=1:"Assigned PC",1:"Not Assigned PC")
"RTN","SCRPEC",64,0)
 S STORE="^TMP("_$J_",""SCRPEC"")"
"RTN","SCRPEC",65,0)
 K @STORE
"RTN","SCRPEC",66,0)
 S @STORE=0
"RTN","SCRPEC",67,0)
 D FIND^SCRPEC3
"RTN","SCRPEC",68,0)
 I $O(@STORE@(0))="" S NODATA=$$NODATA^SCRPU3(TITL)
"RTN","SCRPEC",69,0)
 I '$D(NODATA) D HEADER^SCRPEC2,PRINTIT^SCRPEC3(STORE,TITL)
"RTN","SCRPEC",70,0)
 D EXIT2
"RTN","SCRPEC",71,0)
 Q
"RTN","SCRPEC",72,0)
 ;
"RTN","SCRPEC",73,0)
ERR ;
"RTN","SCRPEC",74,0)
EXIT1 ;
"RTN","SCRPEC",75,0)
 K ZTSAVE,ZTSK,ZTIO,ZTDTH,ZTRTN,ZTDESC,VAUTCA,SCUP
"RTN","SCRPEC",76,0)
 Q
"RTN","SCRPEC",77,0)
EXIT2 ;
"RTN","SCRPEC",78,0)
 K @STORE
"RTN","SCRPEC",79,0)
 K STORE,VAUTTN,PAGE,TITL,IOP,TITL,NODATA,CLINIC,ASSUN,INST,TEAM,STOP
"RTN","SCRPEC",80,0)
 Q
"RTN","SCRPEC",81,0)
 ;
"RTN","SCRPEC",82,0)
PDATA(DFN,CLNEN,CNAME,FLAG) ;
"RTN","SCRPEC",83,0)
 ;Collect and format data for report
"RTN","SCRPEC",84,0)
 ;
"RTN","SCRPEC",85,0)
 N NODE,NAME,PID,PELIG,MT,PSTAT,STATD,DATA,LAST,NEXT
"RTN","SCRPEC",86,0)
 S DATA=""
"RTN","SCRPEC",87,0)
 S NODE=$G(^DPT(DFN,0))
"RTN","SCRPEC",88,0)
 S NAME=$P(NODE,"^") ;patient name
"RTN","SCRPEC",89,0)
 S PID=$P($G(^DPT(DFN,.36)),"^",3),PID=$TR(PID,"-","") ;PID without '-'s
"RTN","SCRPEC",90,0)
 S MT=$$LST^DGMTU(DFN),MT=$P(MT,"^",4)  ;means test status SD*5.3*431
"RTN","SCRPEC",91,0)
 S PELIG=$$ELIG^SCRPU3(DFN) ;primary eligibility
"RTN","SCRPEC",92,0)
 S PSTAT="N/A"
"RTN","SCRPEC",93,0)
 S STATD=""
"RTN","SCRPEC",94,0)
 S LAST=$$GETLAST^SCRPU3(DFN,.CLNEN) ;last Clinic appointment
"RTN","SCRPEC",95,0)
 S NEXT=$$GETNEXT^SCRPU3(DFN,.CLNEN) ;next clinic appointment
"RTN","SCRPEC",96,0)
 ;I '$D(FLAG) S DATA=$$FORMAT^SCRPEC2(PTIEN,INS,TIEN,PDATA,CNAME,CIEN)
"RTN","SCRPEC",97,0)
 I '$D(FLAG) S DATA=$$FORMAT^SCRPEC2(NAME,PID,MT,PELIG,PSTAT,STATD,LAST,NEXT,CNAME),DATA=$E(NAME,1,12)_"^"_DATA
"RTN","SCRPEC",98,0)
 I $D(FLAG) S DATA=$E(NAME,1,12)_"^"_PID_"^"_MT_"^"_PELIG_"^"_PSTAT_"^"_STATD_"^"_LAST_"^"_NEXT
"RTN","SCRPEC",99,0)
 Q DATA
"RTN","SCRPEC",100,0)
 ;
"RTN","SCRPITP")
0^6^B25285896^B23110919
"RTN","SCRPITP",1,0)
SCRPITP ;ALB/CMM - Individual Team Profile ; 29 Jun 99  04:11PM
"RTN","SCRPITP",2,0)
 ;;5.3;Scheduling;**41,52,177,520**;AUG 13, 1993;Build 26
"RTN","SCRPITP",3,0)
 ;
"RTN","SCRPITP",4,0)
 ;Individual Team Profile
"RTN","SCRPITP",5,0)
 ;
"RTN","SCRPITP",6,0)
PROMPTS ;
"RTN","SCRPITP",7,0)
 ;Prompt for Institution, Team, and Print device
"RTN","SCRPITP",8,0)
 ;
"RTN","SCRPITP",9,0)
 N QTIME,PRNT,VAUTD,VAUTT,Y,NUMBER
"RTN","SCRPITP",10,0)
 K VAUTD,VAUTT,SCUP
"RTN","SCRPITP",11,0)
 S QTIME=""
"RTN","SCRPITP",12,0)
 W ! D INST^SCRPU1 I Y=-1 G ERR
"RTN","SCRPITP",13,0)
 W ! K Y D PRMTT^SCRPU1 I '$D(VAUTT) G ERR
"RTN","SCRPITP",14,0)
 W !!,"This report requires 132 column output!"
"RTN","SCRPITP",15,0)
 D QUE(.VAUTD,.VAUTT) Q
"RTN","SCRPITP",16,0)
 ;
"RTN","SCRPITP",17,0)
QUE(INST,TEAM) ;queue report
"RTN","SCRPITP",18,0)
 ;Input Parameters: 
"RTN","SCRPITP",19,0)
 ;INST - institutions selected (variable and array) 
"RTN","SCRPITP",20,0)
 ;TEAM - teams selected (variable and array)
"RTN","SCRPITP",21,0)
 N ZTSAVE,II
"RTN","SCRPITP",22,0)
 F II="INST","TEAM","INST(","TEAM(" S ZTSAVE(II)=""
"RTN","SCRPITP",23,0)
 W ! D EN^XUTMDEVQ("QENTRY^SCRPITP","Individual Team Profile",.ZTSAVE)
"RTN","SCRPITP",24,0)
 Q
"RTN","SCRPITP",25,0)
 ;
"RTN","SCRPITP",26,0)
ENTRY2(INST,TEAM,IOP,ZTDTH) ;
"RTN","SCRPITP",27,0)
 ;Second entry point for GUI to use
"RTN","SCRPITP",28,0)
 ;Input Parameters:
"RTN","SCRPITP",29,0)
 ;INST - institutions selected (variable and array)
"RTN","SCRPITP",30,0)
 ;TEAM - teams selected (variable and array)
"RTN","SCRPITP",31,0)
 ;IOP - print device
"RTN","SCRPITP",32,0)
 ;ZTDTH - queue time (optional)
"RTN","SCRPITP",33,0)
 ;
"RTN","SCRPITP",34,0)
 ;validate parameters
"RTN","SCRPITP",35,0)
 I '$D(INST)!'$D(TEAM)!'$D(IOP)!(IOP="") Q
"RTN","SCRPITP",36,0)
 ;
"RTN","SCRPITP",37,0)
 N NUMBER
"RTN","SCRPITP",38,0)
 S IOST=$P(IOP,"^",2),IOP=$P(IOP,"^")
"RTN","SCRPITP",39,0)
 I IOP?1"Q;".E S IOP=$P(IOP,"Q;",2)
"RTN","SCRPITP",40,0)
 I IOST?1"C-".E D QENTRY G RET
"RTN","SCRPITP",41,0)
 I ZTDTH="" S ZTDTH=$H
"RTN","SCRPITP",42,0)
 S ZTRTN="QENTRY^SCRPITP"
"RTN","SCRPITP",43,0)
 S ZTDESC="iIndividual Team Profile",ZTIO=IOP
"RTN","SCRPITP",44,0)
 N II
"RTN","SCRPITP",45,0)
 F II="INST","TEAM","INST(","TEAM(","IOP" S ZTSAVE(II)=""
"RTN","SCRPITP",46,0)
 D ^%ZTLOAD
"RTN","SCRPITP",47,0)
RET S NUMBER=0
"RTN","SCRPITP",48,0)
 I $D(ZTSK) S NUMBER=ZTSK
"RTN","SCRPITP",49,0)
 D EXIT1
"RTN","SCRPITP",50,0)
 Q NUMBER
"RTN","SCRPITP",51,0)
 ;
"RTN","SCRPITP",52,0)
QENTRY ;
"RTN","SCRPITP",53,0)
 ;driver entry point
"RTN","SCRPITP",54,0)
 S TITL="Individual Team Profile"
"RTN","SCRPITP",55,0)
 S STORE="^TMP("_$J_",""SCRPITP"")"
"RTN","SCRPITP",56,0)
 K @STORE
"RTN","SCRPITP",57,0)
 S @STORE=0
"RTN","SCRPITP",58,0)
 I TEAM=1 D TALL^SCRPPAT3 S TEAM=0
"RTN","SCRPITP",59,0)
 D FIND
"RTN","SCRPITP",60,0)
 I $O(@STORE@(0))="" S NODATA=$$NODATA^SCRPU3(TITL)
"RTN","SCRPITP",61,0)
 I '$D(NODATA) D PRINTIT(STORE,TITL)
"RTN","SCRPITP",62,0)
 D EXIT2
"RTN","SCRPITP",63,0)
 Q
"RTN","SCRPITP",64,0)
 ;
"RTN","SCRPITP",65,0)
ERR ;
"RTN","SCRPITP",66,0)
EXIT1 ;
"RTN","SCRPITP",67,0)
 K ZTDTH,ZTRTN,ZTDESC,ZTSK,ZTIO,ZTSAVE
"RTN","SCRPITP",68,0)
 Q
"RTN","SCRPITP",69,0)
 ;
"RTN","SCRPITP",70,0)
EXIT2 ;
"RTN","SCRPITP",71,0)
 K @STORE
"RTN","SCRPITP",72,0)
 K STOP,STORE,TITL,IOP,TEAM,INST,NODATA
"RTN","SCRPITP",73,0)
 Q
"RTN","SCRPITP",74,0)
 ;
"RTN","SCRPITP",75,0)
FIND ;
"RTN","SCRPITP",76,0)
 N TM,EN,NODE,TMP,TPNAME
"RTN","SCRPITP",77,0)
 S TM="" K ^TMP("SCRATCH",$J)
"RTN","SCRPITP",78,0)
 F  S TM=$O(^SCTM(404.57,"C",TM)) Q:TM=""  D
"RTN","SCRPITP",79,0)
 .;$O through team position file
"RTN","SCRPITP",80,0)
 .I '$D(TEAM(TM))&(TEAM'=1) Q
"RTN","SCRPITP",81,0)
 .;Q above, not a selected team
"RTN","SCRPITP",82,0)
 .;selected team
"RTN","SCRPITP",83,0)
 .S EN=""
"RTN","SCRPITP",84,0)
 .F  S EN=$O(^SCTM(404.57,"C",TM,EN)) Q:EN=""  D
"RTN","SCRPITP",85,0)
 ..I '$D(^SCTM(404.57,EN,0)) Q
"RTN","SCRPITP",86,0)
 ..S NODE=$G(^SCTM(404.57,EN,0))
"RTN","SCRPITP",87,0)
 ..Q:NODE=""
"RTN","SCRPITP",88,0)
 ..;active or inactive position
"RTN","SCRPITP",89,0)
 ..S TMP=$$DATES^SCAPMCU1(404.59,EN,DT)
"RTN","SCRPITP",90,0)
 ..S TPNAME=$P(NODE,U) S:'$L(TPNAME) TPNAME="~~~"
"RTN","SCRPITP",91,0)
 ..S ^TMP("SCRATCH",$J,TPNAME,EN)=NODE
"RTN","SCRPITP",92,0)
 ..I +TMP S ^TMP("SCRATCH",$J,TM,TPNAME,EN)=NODE
"RTN","SCRPITP",93,0)
 ..Q
"RTN","SCRPITP",94,0)
 .Q
"RTN","SCRPITP",95,0)
 S TM=""
"RTN","SCRPITP",96,0)
 F  S TM=$O(^TMP("SCRATCH",$J,TM)) Q:TM=""  S TPNAME="" D
"RTN","SCRPITP",97,0)
 .F  S TPNAME=$O(^TMP("SCRATCH",$J,TM,TPNAME)) Q:TPNAME=""  S EN="" D
"RTN","SCRPITP",98,0)
 ..F  S EN=$O(^TMP("SCRATCH",$J,TM,TPNAME,EN)) Q:EN=""  D
"RTN","SCRPITP",99,0)
 ...S NODE=^TMP("SCRATCH",$J,TM,TPNAME,EN)
"RTN","SCRPITP",100,0)
 ...D KEEP^SCRPITP2(NODE,EN,TM)
"RTN","SCRPITP",101,0)
 ...Q
"RTN","SCRPITP",102,0)
 ..Q
"RTN","SCRPITP",103,0)
 .Q
"RTN","SCRPITP",104,0)
 Q
"RTN","SCRPITP",105,0)
 ;
"RTN","SCRPITP",106,0)
PRINTIT(STORE,TITL) ;
"RTN","SCRPITP",107,0)
 N INST,EINST,ETEAM,TEM,NEW,PAGE,TNAME,TIEN,EN,SUB,POS,CIEN,INF,ACL
"RTN","SCRPITP",108,0)
 S (INST,EINST)="",STOP=0,(PAGE,NEW)=1 W:$E(IOST)="C" @IOF
"RTN","SCRPITP",109,0)
 D FORHEAD^SCRPITP2
"RTN","SCRPITP",110,0)
 F  S EINST=$O(@STORE@("I",EINST)) Q:EINST=""!(STOP)  D
"RTN","SCRPITP",111,0)
 .S INST=$O(@STORE@("I",EINST,""))
"RTN","SCRPITP",112,0)
 .I INST="" Q
"RTN","SCRPITP",113,0)
 .I STOP Q
"RTN","SCRPITP",114,0)
 .;write team info
"RTN","SCRPITP",115,0)
 .S TNAME=""
"RTN","SCRPITP",116,0)
 .F  S TNAME=$O(@STORE@("T",INST,TNAME)) Q:TNAME=""!(STOP)  D
"RTN","SCRPITP",117,0)
 ..D:NEW TITLE^SCRPU3(.PAGE,TITL,132)
"RTN","SCRPITP",118,0)
 ..I 'NEW,$E(IOST)'="C" D NEWP1^SCRPU3(.PAGE,TITL,132)
"RTN","SCRPITP",119,0)
 ..I 'NEW,$E(IOST)="C" D HOLD^SCRPU3(.PAGE,TITL,132)
"RTN","SCRPITP",120,0)
 ..W !,$G(@STORE@(INST)),! S NEW=""
"RTN","SCRPITP",121,0)
 ..S TIEN=$O(@STORE@("T",INST,TNAME,""))
"RTN","SCRPITP",122,0)
 ..I TIEN="" Q
"RTN","SCRPITP",123,0)
 ..F SUB="TI","D" D
"RTN","SCRPITP",124,0)
 ...Q:STOP
"RTN","SCRPITP",125,0)
 ...I '$D(@STORE@(INST,TIEN,SUB)) Q
"RTN","SCRPITP",126,0)
 ...S EN=""
"RTN","SCRPITP",127,0)
 ...F  S EN=$O(@STORE@(INST,TIEN,SUB,EN)) Q:EN=""!(STOP)  D
"RTN","SCRPITP",128,0)
 ....I IOST'?1"C-".E,$Y>(IOSL-5) D NEWP1^SCRPU3(.PAGE,TITL,132)
"RTN","SCRPITP",129,0)
 ....I IOST?1"C-".E,$Y>(IOSL-5) D HOLD^SCRPU3(.PAGE,TITL,132)
"RTN","SCRPITP",130,0)
 ....I STOP Q
"RTN","SCRPITP",131,0)
 ....I '$D(NEW) W !,$G(@STORE@(INST)),!,$G(@STORE@(INST,TIEN)),!
"RTN","SCRPITP",132,0)
 ....W !,$G(@STORE@(INST,TIEN,SUB,EN))
"RTN","SCRPITP",133,0)
 ...W !
"RTN","SCRPITP",134,0)
 ..;write position info
"RTN","SCRPITP",135,0)
 ..S POS=""
"RTN","SCRPITP",136,0)
 ..I $Y<IOSL-10 D COLUMN^SCRPITP2
"RTN","SCRPITP",137,0)
 ..F  S POS=$O(@STORE@(INST,TIEN,"P",POS)) Q:POS=""!(STOP)  D
"RTN","SCRPITP",138,0)
 ...W !,$G(@STORE@(INST,TIEN,"P",POS))
"RTN","SCRPITP",139,0)
 ...S ACL=""
"RTN","SCRPITP",140,0)
 ...F  S ACL=$O(@STORE@(INST,TIEN,"P",POS,ACL)) Q:ACL=""!(STOP)  D
"RTN","SCRPITP",141,0)
 ....W !,$G(@STORE@(INST,TIEN,"P",POS,ACL))
"RTN","SCRPITP",142,0)
 ....I IOST'?1"C-".E,$Y>(IOSL-5) D NEWP1^SCRPU3(.PAGE,TITL,132) Q:STOP  D CONT^SCRPITP2
"RTN","SCRPITP",143,0)
 ....I IOST?1"C-".E,$Y>(IOSL-5) D HOLD^SCRPU3(.PAGE,TITL,132) Q:STOP  D CONT^SCRPITP2
"RTN","SCRPITP",144,0)
 ....I STOP Q
"RTN","SCRPITP",145,0)
 ...;W !,$G(@STORE@(INST,TIEN,"P",POS))
"RTN","SCRPITP",146,0)
 ...;W !,$G(@STORE@(INST,TIEN,"P",POS,ACL))
"RTN","SCRPITP",147,0)
 ...W !
"RTN","SCRPITP",148,0)
 I 'STOP,$E(IOST)="C" N DIR S DIR(0)="E" W ! D ^DIR
"RTN","SCRPITP",149,0)
 Q
"RTN","SCRPITP2")
0^7^B23670971^B21590194
"RTN","SCRPITP2",1,0)
SCRPITP2 ;ALB/CMM - Individual Team Profile Continued ;7/25/99  18:24
"RTN","SCRPITP2",2,0)
 ;;5.3;Scheduling;**41,177,520**;AUG 13, 1993;Build 26
"RTN","SCRPITP2",3,0)
 ;
"RTN","SCRPITP2",4,0)
 ;Individual Team Profile
"RTN","SCRPITP2",5,0)
 ;
"RTN","SCRPITP2",6,0)
KEEP(TNODE,TPOS,TM,SCEN) ;
"RTN","SCRPITP2",7,0)
 ;TNODE - zero node of the team position file entry TPOS
"RTN","SCRPITP2",8,0)
 ;TPOS - ien of team position file entry TNODE
"RTN","SCRPITP2",9,0)
 ;TM - ien of team
"RTN","SCRPITP2",10,0)
 ;
"RTN","SCRPITP2",11,0)
 N POS,PPC,CLIEN,PCLIN,MAX,ROL,CIEN,DIV
"RTN","SCRPITP2",12,0)
 N SCRDATE,SCI,PROVLIST,SCPROV,SCPTASS,ERR
"RTN","SCRPITP2",13,0)
 ;
"RTN","SCRPITP2",14,0)
 D TEAM(TM,.DIV)
"RTN","SCRPITP2",15,0)
 ;
"RTN","SCRPITP2",16,0)
 S POS=$P(TNODE,"^") ;position name
"RTN","SCRPITP2",17,0)
 S ROL=$P($G(^SD(403.46,+$P(TNODE,"^",3),0)),"^") ;standard position
"RTN","SCRPITP2",18,0)
 S PPC=$S($P(TNODE,"^",4)'=1:"NPC",+$$OKPREC3^SCMCLK(TPOS,DT)>0:" AP",1:"PCP") ;primary care position
"RTN","SCRPITP2",19,0)
 S MAX=$P(TNODE,"^",8)
"RTN","SCRPITP2",20,0)
 ;
"RTN","SCRPITP2",21,0)
 S SCRDATE="SCRDATE",(SCRDATE("BEGIN"),SCRDATE("END"))=DT,SCRDATE("INCL")=0
"RTN","SCRPITP2",22,0)
 S SCI="PROVLIST",SCI=$$PRTP^SCAPMC(TPOS,.SCRDATE,SCI,"ERR",1,0)
"RTN","SCRPITP2",23,0)
 S SCPROV=$P($G(PROVLIST(1)),U,2)
"RTN","SCRPITP2",24,0)
 S SCPTASS=$$PCPOSCNT^SCAPMCU1(TPOS,DT,0)
"RTN","SCRPITP2",25,0)
 ;
"RTN","SCRPITP2",26,0)
 ;D FORMAT(POS,PPC,MAX,DIV,TM,TPOS,ROL,SCPROV,SCPTASS)
"RTN","SCRPITP2",27,0)
 ;
"RTN","SCRPITP2",28,0)
 D SETASCL^SCRPRAC2(TPOS,.CNAME,.CLIEN)
"RTN","SCRPITP2",29,0)
 S CNAME=$G(CNAME(0))
"RTN","SCRPITP2",30,0)
 ;S CIEN=+$P(TNODE,"^",9) ;clinic ien ;USING MULTIPLE WITH SD*5.3*520
"RTN","SCRPITP2",31,0)
 ;S PCLIN=""
"RTN","SCRPITP2",32,0)
 ;I CIEN>0 S PCLIN=$P($G(^SC(CIEN,0)),"^") ;associated clinic
"RTN","SCRPITP2",33,0)
 ;
"RTN","SCRPITP2",34,0)
 D FORMAT(POS,PPC,MAX,DIV,TM,TPOS,ROL,CNAME,SCPROV,SCPTASS)
"RTN","SCRPITP2",35,0)
 N AC
"RTN","SCRPITP2",36,0)
 S AC=0
"RTN","SCRPITP2",37,0)
 F  S AC=$O(CNAME(AC)) Q:AC=""  D FORMATAC(POS,DIV,TM,TPOS,CNAME(AC))
"RTN","SCRPITP2",38,0)
 K CNAME
"RTN","SCRPITP2",39,0)
 Q
"RTN","SCRPITP2",40,0)
 ;
"RTN","SCRPITP2",41,0)
TEAM(TM,DIV) ;
"RTN","SCRPITP2",42,0)
 ;
"RTN","SCRPITP2",43,0)
 N TMN,TNAME,TDIV,TPHONE,TPC,TSERV,STAT,PUR,MAX,CUR
"RTN","SCRPITP2",44,0)
 S TMN=$G(^SCTM(404.51,TM,0)) ;zero node of team file
"RTN","SCRPITP2",45,0)
 S TNAME=$P(TMN,"^") ;team name
"RTN","SCRPITP2",46,0)
 S DIV=+$P(TMN,"^",7) ;division ien
"RTN","SCRPITP2",47,0)
 S TDIV=$P($G(^DIC(4,DIV,0)),"^") ;team division
"RTN","SCRPITP2",48,0)
 S TPHONE=$P(TMN,"^",2) ;team phone
"RTN","SCRPITP2",49,0)
 S TPC=+$P(TMN,"^",5) ;Primary Care Team ien
"RTN","SCRPITP2",50,0)
 S TSERV=$P($G(^DIC(49,+$P(TMN,"^",6),0)),"^") ;Service/section
"RTN","SCRPITP2",51,0)
 S STAT=$S(+$$ACTTM^SCMCTMU(TM)=1:"ACTIVE",1:"INACTIVE") ;Team status
"RTN","SCRPITP2",52,0)
 S PUR=$P($G(^SD(403.47,+$P(TMN,"^",3),0)),"^")
"RTN","SCRPITP2",53,0)
 S MAX=$P(TMN,"^",8)
"RTN","SCRPITP2",54,0)
 S CUR=$$TEAMCNT^SCAPMCU1(TM,DT)
"RTN","SCRPITP2",55,0)
 D TFORMAT(TNAME,DIV,TDIV,TM,TPHONE,TPC,TSERV,STAT,PUR,MAX,CUR)
"RTN","SCRPITP2",56,0)
 ;
"RTN","SCRPITP2",57,0)
 ;GET TEAM DESCRIPTION (WORD PROCESSING FIELD)
"RTN","SCRPITP2",58,0)
 D TDESC(TM,DIV)
"RTN","SCRPITP2",59,0)
 Q
"RTN","SCRPITP2",60,0)
TDESC(TEM,DIV) ;
"RTN","SCRPITP2",61,0)
 ;gets team description - word processing field
"RTN","SCRPITP2",62,0)
 Q:'$O(^SCTM(404.51,TEM,"D",0))
"RTN","SCRPITP2",63,0)
 N EN
"RTN","SCRPITP2",64,0)
 S EN=0
"RTN","SCRPITP2",65,0)
 S @STORE@(DIV,TEM,"D",0)="Team Description: "
"RTN","SCRPITP2",66,0)
 S @STORE@(DIV,TEM,"D",.5)=""
"RTN","SCRPITP2",67,0)
 F  S EN=$O(^SCTM(404.51,TEM,"D",EN)) Q:EN=""  D
"RTN","SCRPITP2",68,0)
 .S @STORE@(DIV,TEM,"D",EN)=$G(^SCTM(404.51,TEM,"D",EN,0))
"RTN","SCRPITP2",69,0)
 Q
"RTN","SCRPITP2",70,0)
 ;
"RTN","SCRPITP2",71,0)
TFORMAT(TNAME,DIV,TDIV,TM,TPHONE,TPC,TSERV,STAT,PUR,MAX,CUR) ;
"RTN","SCRPITP2",72,0)
 ;
"RTN","SCRPITP2",73,0)
 I TNAME="" S TNAME="[BAD DATA]"
"RTN","SCRPITP2",74,0)
 I TDIV="" S TDIV="[BAD DATA]"
"RTN","SCRPITP2",75,0)
 S @STORE@("I",TDIV,DIV)=""
"RTN","SCRPITP2",76,0)
 S @STORE@("T",DIV,TNAME,TM)=""
"RTN","SCRPITP2",77,0)
 S @STORE@(DIV)="Division: "_TDIV
"RTN","SCRPITP2",78,0)
 ;
"RTN","SCRPITP2",79,0)
 S @STORE@(DIV,TM,"TI",1)="Team Name: "_TNAME
"RTN","SCRPITP2",80,0)
 S $E(@STORE@(DIV,TM,"TI",1),44)="Service/Section: "_$E(TSERV,1,30)
"RTN","SCRPITP2",81,0)
 S $E(@STORE@(DIV,TM,"TI",1),(120-$L(TPHONE)))="Team Phone: "_TPHONE
"RTN","SCRPITP2",82,0)
 S @STORE@(DIV,TM,"TI",2)=""
"RTN","SCRPITP2",83,0)
 S @STORE@(DIV,TM,"TI",3)="Team Settings:"
"RTN","SCRPITP2",84,0)
 S @STORE@(DIV,TM,"TI",4)=""
"RTN","SCRPITP2",85,0)
 S @STORE@(DIV,TM,"TI",5)="Status: "_STAT
"RTN","SCRPITP2",86,0)
 S $E(@STORE@(DIV,TM,"TI",5),19)="Maximum Patients: "_MAX
"RTN","SCRPITP2",87,0)
 S $E(@STORE@(DIV,TM,"TI",5),47)="Unique Patients Assigned: "_CUR
"RTN","SCRPITP2",88,0)
 S $E(@STORE@(DIV,TM,"TI",5),83)="Purpose: "_$E(PUR,1,35)
"RTN","SCRPITP2",89,0)
 S @STORE@(DIV,TM,"TI",6)=""
"RTN","SCRPITP2",90,0)
 I CUR+1>MAX S @STORE@(DIV,TM,"TI",7)="This team is not accepting patients."
"RTN","SCRPITP2",91,0)
 I CUR<MAX,CUR'=MAX S @STORE@(DIV,TM,"TI",7)="This team is still accepting patients."
"RTN","SCRPITP2",92,0)
 Q
"RTN","SCRPITP2",93,0)
 ;
"RTN","SCRPITP2",94,0)
FORMAT(POS,PPC,MAX,DIV,TM,TPOS,ROL,CNAME,SCPROV,SCPTASS) ;
"RTN","SCRPITP2",95,0)
 ;
"RTN","SCRPITP2",96,0)
 I POS="" S POS="[BAD DATA]"
"RTN","SCRPITP2",97,0)
 S @STORE@(DIV,TM,"P",POS)=$E(POS,1,24) ;position
"RTN","SCRPITP2",98,0)
 S $E(@STORE@(DIV,TM,"P",POS),27)=$E(SCPROV,1,24) ;provider
"RTN","SCRPITP2",99,0)
 S $E(@STORE@(DIV,TM,"P",POS),53)=$E(ROL,1,24) ;standard role
"RTN","SCRPITP2",100,0)
 S $E(@STORE@(DIV,TM,"P",POS),77)=PPC ;primary care yes/no
"RTN","SCRPITP2",101,0)
 S $E(@STORE@(DIV,TM,"P",POS),82)=$J(MAX,6,0) ;number of patients allowed
"RTN","SCRPITP2",102,0)
 S $E(@STORE@(DIV,TM,"P",POS),92)=$J(SCPTASS,6,0) ;patients assigned
"RTN","SCRPITP2",103,0)
 S $E(@STORE@(DIV,TM,"P",POS),103)=$E(CNAME,1,30)
"RTN","SCRPITP2",104,0)
 Q
"RTN","SCRPITP2",105,0)
 ;
"RTN","SCRPITP2",106,0)
FORMATAC(POS,DIV,TM,TPOS,CNAME) ;clinic name
"RTN","SCRPITP2",107,0)
 S $E(@STORE@(DIV,TM,"P",POS,AC),103)=$E(CNAME,1,30)
"RTN","SCRPITP2",108,0)
 Q
"RTN","SCRPITP2",109,0)
 ;
"RTN","SCRPITP2",110,0)
FORHEAD ;
"RTN","SCRPITP2",111,0)
 S @STORE@("C",2)="Team Position"
"RTN","SCRPITP2",112,0)
 S $E(@STORE@("C",2),27)="Provider Name"
"RTN","SCRPITP2",113,0)
 S $E(@STORE@("C",2),53)="Standard Role"
"RTN","SCRPITP2",114,0)
 S $E(@STORE@("C",2),77)="PC?"
"RTN","SCRPITP2",115,0)
 S $E(@STORE@("C",1),82)="Patients"
"RTN","SCRPITP2",116,0)
 S $E(@STORE@("C",2),82)="Allowed"
"RTN","SCRPITP2",117,0)
 S $E(@STORE@("C",1),92)="Patients"
"RTN","SCRPITP2",118,0)
 S $E(@STORE@("C",2),92)="Assigned"
"RTN","SCRPITP2",119,0)
 S $E(@STORE@("C",2),103)="Associated Clinic"
"RTN","SCRPITP2",120,0)
 S $P(@STORE@("C",3),"=",133)=""
"RTN","SCRPITP2",121,0)
 Q
"RTN","SCRPITP2",122,0)
 ;
"RTN","SCRPITP2",123,0)
CONT ;Team continuation header
"RTN","SCRPITP2",124,0)
 W !,"Team '",TNAME,"' continued..."
"RTN","SCRPITP2",125,0)
COLUMN ;
"RTN","SCRPITP2",126,0)
 I STOP Q
"RTN","SCRPITP2",127,0)
 N EN
"RTN","SCRPITP2",128,0)
 S EN=0
"RTN","SCRPITP2",129,0)
 F  S EN=$O(@STORE@("C",EN)) Q:EN=""  D
"RTN","SCRPITP2",130,0)
 .W !,$G(@STORE@("C",EN))
"RTN","SCRPITP2",131,0)
 Q
"RTN","SCRPITP2",132,0)
 ;
"RTN","SCRPPAT2")
0^12^B44698538^B28347716
"RTN","SCRPPAT2",1,0)
SCRPPAT2 ;ALB/CMM - Practitioner's Patients ; 12/12/00 3:46pm
"RTN","SCRPPAT2",2,0)
 ;;5.3;Scheduling;**41,48,174,181,177,231,433,297,526,520**;AUG 13, 1993;Build 26
"RTN","SCRPPAT2",3,0)
 ;
"RTN","SCRPPAT2",4,0)
 ;Listing of Practitioner's Patients
"RTN","SCRPPAT2",5,0)
 ;
"RTN","SCRPPAT2",6,0)
DRIVE ;
"RTN","SCRPPAT2",7,0)
 ;driver module
"RTN","SCRPPAT2",8,0)
 N PRAC,INF,ARRY,ERROR,NXT,OKAY,PIEN,TPRC
"RTN","SCRPPAT2",9,0)
 S ARRY="^TMP(""SCARRAY"","_$J_")",ERROR="ERR"
"RTN","SCRPPAT2",10,0)
 S TPRC="^TMP(""SCRP"",$J,""PRACT"")" M @TPRC=PRACT
"RTN","SCRPPAT2",11,0)
 K @ARRY,@ERROR,PRACT
"RTN","SCRPPAT2",12,0)
 I @TPRC=1 D ALL^SCRPPAT3 ;all practitioners selected
"RTN","SCRPPAT2",13,0)
 S NXT=0
"RTN","SCRPPAT2",14,0)
 F  S NXT=$O(@TPRC@(NXT)) Q:NXT=""!(NXT'?.N)  D
"RTN","SCRPPAT2",15,0)
 .I @TPRC=0 S PIEN=NXT
"RTN","SCRPPAT2",16,0)
 .I @TPRC=1 S PIEN=$P(@TPRC@(NXT),"^")
"RTN","SCRPPAT2",17,0)
 .K @ARRY,@ERROR
"RTN","SCRPPAT2",18,0)
 .S OKAY=$$PTPR^SCAPMC14(PIEN,"","","",ARRY,ERROR) ;patients for practitioner
"RTN","SCRPPAT2",19,0)
 .I '+OKAY Q
"RTN","SCRPPAT2",20,0)
 .D LOOPPT(ARRY,PIEN) ;loop through patients for practitioner
"RTN","SCRPPAT2",21,0)
 K @ARRY,@ERROR,@TPRC
"RTN","SCRPPAT2",22,0)
 K:SUMM @STORE@("PT")
"RTN","SCRPPAT2",23,0)
 Q
"RTN","SCRPPAT2",24,0)
 ;
"RTN","SCRPPAT2",25,0)
LOOPPT(ARY,PRAC) ;loop through patients for practitioner
"RTN","SCRPPAT2",26,0)
 ;ARY - array of patients for selected practitioner
"RTN","SCRPPAT2",27,0)
 ;PRAC - practitioner ien
"RTN","SCRPPAT2",28,0)
 N NXT,PIEN,TPIEN,PNAME,TPIEN,NODE,PTP,TPI,TPN,CLIEN,PTA,PTAN,TIEN
"RTN","SCRPPAT2",29,0)
 N PC,TNODE,TNAME,PINF,POSN,PRCP,CNAME
"RTN","SCRPPAT2",30,0)
 S NXT=0
"RTN","SCRPPAT2",31,0)
 F  S NXT=$O(@ARY@(NXT)) Q:NXT=""!(NXT'?.N)  D
"RTN","SCRPPAT2",32,0)
 .S NODE=$G(@ARY@(NXT))
"RTN","SCRPPAT2",33,0)
 .Q:NODE=""
"RTN","SCRPPAT2",34,0)
 .S PIEN=+$P(NODE,"^") ;ien of patient file entry
"RTN","SCRPPAT2",35,0)
 .S TPIEN=+$P(NODE,"^",3) ;ien of patient team position assignment
"RTN","SCRPPAT2",36,0)
 .S PTP=$G(^SCPT(404.43,TPIEN,0))
"RTN","SCRPPAT2",37,0)
 .Q:PTP=""
"RTN","SCRPPAT2",38,0)
 .S PTA=+$P(PTP,"^") ;patient team assignment ien (404.42)
"RTN","SCRPPAT2",39,0)
 .S PTAN=$G(^SCPT(404.42,PTA,0))
"RTN","SCRPPAT2",40,0)
 .Q:PTAN=""
"RTN","SCRPPAT2",41,0)
 .S TIEN=+$P(PTAN,"^",3) ;team file ien (404.51)
"RTN","SCRPPAT2",42,0)
 .I $G(TEAM)'=1,'$D(TEAM(TIEN)) Q  ;not a selected team
"RTN","SCRPPAT2",43,0)
 .S TNODE=$G(^SCTM(404.51,TIEN,0))
"RTN","SCRPPAT2",44,0)
 .Q:TNODE=""  I $G(INST)'=1,'$D(INST(+$P(TNODE,U,7))) Q
"RTN","SCRPPAT2",45,0)
 .S TNAME=$P(TNODE,"^") ;team name
"RTN","SCRPPAT2",46,0)
 .S TPI=+$P(PTP,"^",2) ;Team Position file ien (404.57)
"RTN","SCRPPAT2",47,0)
 .S TPN=$G(^SCTM(404.57,TPI,0))
"RTN","SCRPPAT2",48,0)
 .Q:TPN=""
"RTN","SCRPPAT2",49,0)
 .I $G(ROLE)'=1,'$D(ROLE(+$P(TPN,U,3))) Q  ;not a selected role
"RTN","SCRPPAT2",50,0)
 .S POSN=$P(TPN,"^") ;position name
"RTN","SCRPPAT2",51,0)
 .D SETASCL^SCRPRAC2(TPI,.CNAME,.CLIEN)  ;get clinics from multiple
"RTN","SCRPPAT2",52,0)
 .;S CLIEN=+$P(TPN,"^",9) ;associated clinic ien
"RTN","SCRPPAT2",53,0)
 .;commented next line off - clinic enrollment no longer needed SD*5.3*433
"RTN","SCRPPAT2",54,0)
 .;D CECHK(CLIEN,.CNAME,PIEN) ;is patient enrolled in associated clinic?
"RTN","SCRPPAT2",55,0)
 .;S CNAME=$P($G(^SC(CLIEN,0)),"^")  ; SD*5.3*433 remove enroll check
"RTN","SCRPPAT2",56,0)
 .S PC=$S($P(PTP,"^",5)=0:0,1:1) ;primary care position 1or2-yes/0-no
"RTN","SCRPPAT2",57,0)
 .S PNAME=$P($G(^VA(200,+PRAC,0)),"^") ;practitioner name
"RTN","SCRPPAT2",58,0)
 .Q:PNAME=""
"RTN","SCRPPAT2",59,0)
 .S PRCP=$P($$OKPREC2^SCMCLK(TPI,DT),U,2)
"RTN","SCRPPAT2",60,0)
 .D GETPINF(PIEN,.CLIEN,.PINF)  ;get patient information and appointments
"RTN","SCRPPAT2",61,0)
 .S CNAME=$G(CNAME(0))  ;first line will capture position information
"RTN","SCRPPAT2",62,0)
 .S PINF=$G(PINF(0))
"RTN","SCRPPAT2",63,0)
 .I PINF=""  D 
"RTN","SCRPPAT2",64,0)
 ..S PINF=PIEN_"^"_$$PDATA^SCRPEC(PIEN,CNAME,CNAME,1)
"RTN","SCRPPAT2",65,0)
 .D FORMAT(CNAME,PINF,PC,TIEN,TNAME,PRAC,PNAME,POSN,TPI,PRCP)
"RTN","SCRPPAT2",66,0)
 .D SETFORM(PIEN,.CNAME,.PINF)
"RTN","SCRPPAT2",67,0)
SETFORM(PIEN,CNAME,PINF)  ;Format for clinic info only for multiples
"RTN","SCRPPAT2",68,0)
 N SCCNT
"RTN","SCRPPAT2",69,0)
 S SCCNT=0 F  S SCCNT=$O(PINF(SCCNT)) Q:SCCNT=""  D FORMATAC(CNAME(SCCNT),PINF(SCCNT),PC,TIEN,TNAME,PRAC,PNAME,POSN,TPI,PRCP)
"RTN","SCRPPAT2",70,0)
 Q
"RTN","SCRPPAT2",71,0)
GETPINF(PIEN,CLIEN,PINF)  ;get patient info 
"RTN","SCRPPAT2",72,0)
 N SCCNT
"RTN","SCRPPAT2",73,0)
 S SCCNT="" F  S SCCNT=$O(CLIEN(SCCNT)) Q:SCCNT=""  D 
"RTN","SCRPPAT2",74,0)
 .S PINF(SCCNT)=PIEN_"^"_$$PDATA^SCRPEC(PIEN,CLIEN(SCCNT),CNAME(SCCNT),1)
"RTN","SCRPPAT2",75,0)
 Q
"RTN","SCRPPAT2",76,0)
 ;
"RTN","SCRPPAT2",77,0)
CECHK(CLIEN,CNAME,PIEN) ;should no longer be used as of patch SD*5.3*433
"RTN","SCRPPAT2",78,0)
 ;CLIEN - clinic ien
"RTN","SCRPPAT2",79,0)
 ;CNAME - clinic name returned if patient is enrolled in clien clinic
"RTN","SCRPPAT2",80,0)
 ;PIEN - patien ien
"RTN","SCRPPAT2",81,0)
 ;
"RTN","SCRPPAT2",82,0)
 N EN,NODE
"RTN","SCRPPAT2",83,0)
 S CNAME=""
"RTN","SCRPPAT2",84,0)
 I $D(^DPT(PIEN,"DE","B",CLIEN)) D
"RTN","SCRPPAT2",85,0)
 .;enrolled at one time, check if discharged
"RTN","SCRPPAT2",86,0)
 .S EN=$O(^DPT(PIEN,"DE","B",CLIEN,""))
"RTN","SCRPPAT2",87,0)
 .S NODE=$G(^DPT(PIEN,"DE",EN,0))
"RTN","SCRPPAT2",88,0)
 .Q:NODE=""
"RTN","SCRPPAT2",89,0)
 .I $P(NODE,"^",3)="" S CNAME=$P($G(^SC(CLIEN,0)),"^") ;clinic name
"RTN","SCRPPAT2",90,0)
 .I $P(NODE,"^",3)'="",$P(NODE,"^",3)>DT S CNAME=$P($G(^SC(CLIEN,0)),"^") ;clinic name
"RTN","SCRPPAT2",91,0)
 Q
"RTN","SCRPPAT2",92,0)
 ;
"RTN","SCRPPAT2",93,0)
FORMAT(CNAME,PINF,PC,TIEN,TNAME,PRAC,PNAME,POSN,TPI,PRCP) ; format data for display
"RTN","SCRPPAT2",94,0)
 ;CNAME - clinic name
"RTN","SCRPPAT2",95,0)
 ;PINF - patient/clinic data
"RTN","SCRPPAT2",96,0)
 ;PC - primary care 1/0
"RTN","SCRPPAT2",97,0)
 ;TIEN - team file ien (#404.51)
"RTN","SCRPPAT2",98,0)
 ;TNAME - team name
"RTN","SCRPPAT2",99,0)
 ;PRAC - practitioner ien (#200)
"RTN","SCRPPAT2",100,0)
 ;PNAME - practitioner name
"RTN","SCRPPAT2",101,0)
 ;POSN - position name
"RTN","SCRPPAT2",102,0)
 ;TPI - team position ien (#404.57)
"RTN","SCRPPAT2",103,0)
 ;PRCP - preceptor name
"RTN","SCRPPAT2",104,0)
 ;
"RTN","SCRPPAT2",105,0)
 N IIEN,INAME,ERR
"RTN","SCRPPAT2",106,0)
 S ERR=$$SETUP^SCRPPAT3(.IIEN,.INAME,TIEN,TNAME,PRAC,PNAME,POSN,TPI,PRCP)
"RTN","SCRPPAT2",107,0)
 I ERR Q
"RTN","SCRPPAT2",108,0)
 ;
"RTN","SCRPPAT2",109,0)
 I SORT=1 D STOR(IIEN,TIEN,PRAC,PINF,PNAME,TNAME,TPI) ;sort division,team,practitioner
"RTN","SCRPPAT2",110,0)
 I SORT=2 D STOR(IIEN,PRAC,TIEN,PINF,PNAME,TNAME,TPI) ;sort division,practitioner,team
"RTN","SCRPPAT2",111,0)
 I SORT=3 D STOR(1,PRAC,1,PINF,PNAME,"T3",TPI)
"RTN","SCRPPAT2",112,0)
 Q
"RTN","SCRPPAT2",113,0)
 ;
"RTN","SCRPPAT2",114,0)
FORMATAC(CNAME,PINF,PC,TIEN,TNAME,PRAC,PNAME,POSN,TPI,PRCP) ; format data for display
"RTN","SCRPPAT2",115,0)
 ;CNAME - clinic name
"RTN","SCRPPAT2",116,0)
 ;PINF - patient/clinic data
"RTN","SCRPPAT2",117,0)
 ;PC - primary care 1/0
"RTN","SCRPPAT2",118,0)
 ;TIEN - team file ien (#404.51)
"RTN","SCRPPAT2",119,0)
 ;TNAME - team name
"RTN","SCRPPAT2",120,0)
 ;PRAC - practitioner ien (#200)
"RTN","SCRPPAT2",121,0)
 ;PNAME - practitioner name
"RTN","SCRPPAT2",122,0)
 ;POSN - position name
"RTN","SCRPPAT2",123,0)
 ;TPI - team position ien (#404.57)
"RTN","SCRPPAT2",124,0)
 ;PRCP - preceptor name
"RTN","SCRPPAT2",125,0)
 ;
"RTN","SCRPPAT2",126,0)
 N IIEN,INAME,ERR
"RTN","SCRPPAT2",127,0)
 S ERR=$$SETUP^SCRPPAT3(.IIEN,.INAME,TIEN,TNAME,PRAC,PNAME,POSN,TPI,PRCP)
"RTN","SCRPPAT2",128,0)
 I ERR Q
"RTN","SCRPPAT2",129,0)
 ;
"RTN","SCRPPAT2",130,0)
 I SORT=1 D STORA(IIEN,TIEN,PRAC,PINF,PNAME,TNAME,TPI,SCCNT) ;sort division,team,practitioner
"RTN","SCRPPAT2",131,0)
 I SORT=2 D STORA(IIEN,PRAC,TIEN,PINF,PNAME,TNAME,TPI,SCCNT) ;sort division,practitioner,team
"RTN","SCRPPAT2",132,0)
 I SORT=3 D STORA(1,PRAC,1,PINF,PNAME,"T3",TPI,SCCNT)
"RTN","SCRPPAT2",133,0)
 Q
"RTN","SCRPPAT2",134,0)
 ;
"RTN","SCRPPAT2",135,0)
STOR(IIEN,SEC,TRD,PINF,PNAME,TNAME,TPI,SCCNT) ;
"RTN","SCRPPAT2",136,0)
 ;IIEN - ien institution
"RTN","SCRPPAT2",137,0)
 ;SEC - second sort subscript, IEN team or IEN practitioner
"RTN","SCRPPAT2",138,0)
 ;TRD - third sort subscript, IEN team or IEN practitioner
"RTN","SCRPPAT2",139,0)
 ;PINF - patient/clinic info
"RTN","SCRPPAT2",140,0)
 ;PNAME - practitioner name
"RTN","SCRPPAT2",141,0)
 ;TNAME - team name
"RTN","SCRPPAT2",142,0)
 ;TPI - team position ien
"RTN","SCRPPAT2",143,0)
 ;
"RTN","SCRPPAT2",144,0)
 N PIEN,PTNAME,PID
"RTN","SCRPPAT2",145,0)
 S PIEN=+$P(PINF,"^") ;patient ien 
"RTN","SCRPPAT2",146,0)
 S PTNAME=$E($P(PINF,"^",2),1,10) ;patient name
"RTN","SCRPPAT2",147,0)
 Q:$D(@STORE@("PT",IIEN,SEC,TRD,TPI,PTNAME,PIEN))
"RTN","SCRPPAT2",148,0)
 S @STORE@("PT",IIEN,SEC,TRD,TPI,PTNAME,PIEN)=""
"RTN","SCRPPAT2",149,0)
 I 'SUMM,'$D(@STORE@("PTOT",IIEN,SEC,TRD,PIEN)) D
"RTN","SCRPPAT2",150,0)
 .;count each unique patient for any given practitioner for grand total
"RTN","SCRPPAT2",151,0)
 .S @STORE@("PTOT",IIEN,SEC,TRD,PIEN)=""
"RTN","SCRPPAT2",152,0)
 .S @STORE@("TOTAL",IIEN,PRAC,0)=$G(@STORE@("TOTAL",IIEN,PRAC,0))+1 ;patient count by practitioner
"RTN","SCRPPAT2",153,0)
 ;
"RTN","SCRPPAT2",154,0)
 S @STORE@("TOTAL",IIEN,PRAC,$S(SORT=3:1,1:TIEN),TPI)=$G(@STORE@("TOTAL",IIEN,PRAC,$S(SORT=3:1,1:TIEN),TPI))+1 ;patient count by practitioner and team
"RTN","SCRPPAT2",155,0)
 Q:SUMM
"RTN","SCRPPAT2",156,0)
 ;
"RTN","SCRPPAT2",157,0)
 S @STORE@(IIEN,SEC,TRD,TPI,PIEN)=PTNAME
"RTN","SCRPPAT2",158,0)
 S PID=$P(PINF,"^",3),PID=$TR(PID,"-","")
"RTN","SCRPPAT2",159,0)
 S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),13)=PID ;ssn
"RTN","SCRPPAT2",160,0)
 S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),25)=$P(PINF,"^",4) ;means test status
"RTN","SCRPPAT2",161,0)
 S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),31)=$P(PINF,"^",5) ;eligibility
"RTN","SCRPPAT2",162,0)
 ;Removed by patch 174
"RTN","SCRPPAT2",163,0)
 ;S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),40)=$P(PINF,"^",6) ;patient status
"RTN","SCRPPAT2",164,0)
 S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),42)=$P(PINF,"^",8) ;last appt
"RTN","SCRPPAT2",165,0)
 S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),54)=$P(PINF,"^",9) ;nxt appt
"RTN","SCRPPAT2",166,0)
 S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),66)=$E(CNAME,1,15) ;clinic
"RTN","SCRPPAT2",167,0)
 Q
"RTN","SCRPPAT2",168,0)
STORA(IIEN,SEC,TRD,PINF,PNAME,TNAME,TPI,SCCNT) ;
"RTN","SCRPPAT2",169,0)
 I '$D(@STORE@(IIEN,SEC,TRD,TPI,PIEN,SCCNT))  D
"RTN","SCRPPAT2",170,0)
 .S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN,SCCNT),42)=$P(PINF,"^",8) ;last appt
"RTN","SCRPPAT2",171,0)
 .S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN,SCCNT),54)=$P(PINF,"^",9) ;nxt appt
"RTN","SCRPPAT2",172,0)
 .S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN,SCCNT),66)=$E(CNAME,1,15) ;clinic
"RTN","SCRPPAT2",173,0)
 .Q
"RTN","SCRPPAT2",174,0)
 Q 
"RTN","SCRPPAT3")
0^13^B33197824^B30801448
"RTN","SCRPPAT3",1,0)
SCRPPAT3 ;ALB/CMM - Practitioner's Patients ; 8/30/99 3:14pm
"RTN","SCRPPAT3",2,0)
 ;;5.3;Scheduling;**41,52,148,174,181,177,297,526,520**;AUG 13, 1993;Build 26
"RTN","SCRPPAT3",3,0)
 ;
"RTN","SCRPPAT3",4,0)
 ;Listing of Practitioner's Patients
"RTN","SCRPPAT3",5,0)
 ;
"RTN","SCRPPAT3",6,0)
PAT(INS,SEC,TRD,SEC3,ST3,ST4,POS) ;
"RTN","SCRPPAT3",7,0)
 ;writes patients for position/practitioner
"RTN","SCRPPAT3",8,0)
 N PTN,PT,FIRST
"RTN","SCRPPAT3",9,0)
 S PTN="",FIRST=1
"RTN","SCRPPAT3",10,0)
 I SUMM D TOTAL1^SCRPPAT3(INS,SEC,TRD,POS) Q  ;Summary only
"RTN","SCRPPAT3",11,0)
 F  S PTN=$O(@STORE@("PT",INS,SEC,TRD,POS,PTN)) Q:PTN=""!(STOP)  D
"RTN","SCRPPAT3",12,0)
 .S PT=0
"RTN","SCRPPAT3",13,0)
 .F  S PT=$O(@STORE@("PT",INS,SEC,TRD,POS,PTN,PT)) Q:'PT!(STOP)  D
"RTN","SCRPPAT3",14,0)
 ..I FIRST D HEADER S FIRST=0
"RTN","SCRPPAT3",15,0)
 ..W !,$G(@STORE@(INS,SEC,TRD,POS,PT)) ;print patient detail line
"RTN","SCRPPAT3",16,0)
 ..;I FIRST D HEADER S FIRST=0
"RTN","SCRPPAT3",17,0)
 ..N SCCN
"RTN","SCRPPAT3",18,0)
 ..S SCCN=""
"RTN","SCRPPAT3",19,0)
 ..F  S SCCN=$O(@STORE@(INS,SEC,TRD,POS,PT,SCCN)) Q:SCCN=""  D
"RTN","SCRPPAT3",20,0)
 ...W !,$G(@STORE@(INS,SEC,TRD,POS,PT,SCCN)) ;print patient detail line
"RTN","SCRPPAT3",21,0)
 ...I (IOST'?1"C-".E),$Y>(IOSL-5) S MORE=0 D NEWP1^SCRPU3(.PAGE,TITL) D:'STOP HEAD2(INS,SEC,TRD,SEC3,ST3,ST4,POS) D:(('FIRST&'STOP)!($G(SORT)=3)) HEADER
"RTN","SCRPPAT3",22,0)
 ...I (IOST?1"C-".E),$Y>(IOSL-5) S MORE=0 D HOLD^SCRPU3(.PAGE,TITL) D:'STOP HEAD2(INS,SEC,TRD,SEC3,ST3,ST4,POS) D:'FIRST&'STOP HEADER
"RTN","SCRPPAT3",23,0)
 ...Q:STOP
"RTN","SCRPPAT3",24,0)
 ...;I FIRST D HEADER S FIRST=0
"RTN","SCRPPAT3",25,0)
 ...Q
"RTN","SCRPPAT3",26,0)
 ..Q
"RTN","SCRPPAT3",27,0)
 .Q
"RTN","SCRPPAT3",28,0)
 Q
"RTN","SCRPPAT3",29,0)
 ;
"RTN","SCRPPAT3",30,0)
SPRINT(STORE,IOP,TITL,SORT) ; Summary Print Only
"RTN","SCRPPAT3",31,0)
 ;STORE - global location of data
"RTN","SCRPPAT3",32,0)
 ;IOP - device to print to
"RTN","SCRPPAT3",33,0)
 ;TITL - title of report
"RTN","SCRPPAT3",34,0)
 ;SORT - sort order 1-div,team,pract/2-div,pract,team
"RTN","SCRPPAT3",35,0)
 ;
"RTN","SCRPPAT3",36,0)
 N PAGE
"RTN","SCRPPAT3",37,0)
 S PAGE=1,STOP=0
"RTN","SCRPPAT3",38,0)
 D OPEN^SCRPU3
"RTN","SCRPPAT3",39,0)
 Q:$G(POP)
"RTN","SCRPPAT3",40,0)
 D TITLE^SCRPU3(.PAGE,TITL)
"RTN","SCRPPAT3",41,0)
 D CLOSE^SCRPU3
"RTN","SCRPPAT3",42,0)
 Q
"RTN","SCRPPAT3",43,0)
 ;
"RTN","SCRPPAT3",44,0)
TOTAL1(INS,SEC,TRD,POS) ;
"RTN","SCRPPAT3",45,0)
 ;print team/practitioner total
"RTN","SCRPPAT3",46,0)
 N TEM,PRC
"RTN","SCRPPAT3",47,0)
 I SORT=1 S TEM=SEC,PRC=TRD
"RTN","SCRPPAT3",48,0)
 I SORT=2!(SORT=3) S TEM=TRD,PRC=SEC
"RTN","SCRPPAT3",49,0)
 W !!,$G(@STORE@("TH",INS,PRC,TEM,POS)),$G(@STORE@("TOTAL",INS,PRC,TEM,POS))
"RTN","SCRPPAT3",50,0)
 Q
"RTN","SCRPPAT3",51,0)
 ;
"RTN","SCRPPAT3",52,0)
HEAD2(INS,SEC,TRD,SEC3,ST3,ST4,POS) ;
"RTN","SCRPPAT3",53,0)
 I (SEC3="""TN""")&($D(@ST4@(INS,TRD,SEC))) D
"RTN","SCRPPAT3",54,0)
 .W !,$G(@ST3@(INS,SEC)) ;write team (sort 1)
"RTN","SCRPPAT3",55,0)
 .W !,$G(@STORE@(INS))
"RTN","SCRPPAT3",56,0)
 .W !,$G(@ST4@(INS,TRD,SEC,POS)) ;write practitioner (sort 2)
"RTN","SCRPPAT3",57,0)
 .I $L($G(@STORE@("PN",INS,TRD,SEC,POS,"PRCP"))) W !,@STORE@("PN",INS,TRD,SEC,POS,"PRCP")
"RTN","SCRPPAT3",58,0)
 .W !
"RTN","SCRPPAT3",59,0)
 I (SEC3="""PN""")&($D(@ST3@(INS,SEC,TRD))) D
"RTN","SCRPPAT3",60,0)
 .W !,$G(@ST3@(INS,SEC,TRD,POS)) ;write practitioner (sort 1)
"RTN","SCRPPAT3",61,0)
 .I $G(SORT)'=3 I $L($G(@STORE@("PN",INS,SEC,TRD,POS,"PRCP"))) W !,@STORE@("PN",INS,SEC,TRD,POS,"PRCP")
"RTN","SCRPPAT3",62,0)
 .I $G(SORT)'=3 W !,$G(@ST4@(INS,TRD)) ;write team (sort 2)
"RTN","SCRPPAT3",63,0)
 .W !,$G(@STORE@(INS))
"RTN","SCRPPAT3",64,0)
 Q
"RTN","SCRPPAT3",65,0)
 ;
"RTN","SCRPPAT3",66,0)
HEADER ;
"RTN","SCRPPAT3",67,0)
 Q:$G(MORE)
"RTN","SCRPPAT3",68,0)
 I SORT=3 S MORE=1
"RTN","SCRPPAT3",69,0)
 N NXT
"RTN","SCRPPAT3",70,0)
 F NXT="H1","H2","H3" W !,$G(@STORE@(NXT))
"RTN","SCRPPAT3",71,0)
 W !
"RTN","SCRPPAT3",72,0)
 Q
"RTN","SCRPPAT3",73,0)
 ;
"RTN","SCRPPAT3",74,0)
SHEAD ;
"RTN","SCRPPAT3",75,0)
 S @STORE@("H2")="Pt Name"
"RTN","SCRPPAT3",76,0)
 S $E(@STORE@("H2"),15)="Pt ID"
"RTN","SCRPPAT3",77,0)
 S $E(@STORE@("H1"),25)="M.T."
"RTN","SCRPPAT3",78,0)
 S $E(@STORE@("H2"),25)="Stat"
"RTN","SCRPPAT3",79,0)
 S $E(@STORE@("H1"),31)="Prim"
"RTN","SCRPPAT3",80,0)
 S $E(@STORE@("H2"),31)="Elig"
"RTN","SCRPPAT3",81,0)
 ;Removed by patch 174
"RTN","SCRPPAT3",82,0)
 ;S $E(@STORE@("H1"),39)="Pat"
"RTN","SCRPPAT3",83,0)
 ;S $E(@STORE@("H2"),39)="Stat"
"RTN","SCRPPAT3",84,0)
 S $E(@STORE@("H1"),42)="Last"
"RTN","SCRPPAT3",85,0)
 S $E(@STORE@("H2"),42)="Appt"
"RTN","SCRPPAT3",86,0)
 S $E(@STORE@("H1"),54)="Next"
"RTN","SCRPPAT3",87,0)
 S $E(@STORE@("H2"),54)="Appt"
"RTN","SCRPPAT3",88,0)
 S $E(@STORE@("H2"),66)="Clinic"
"RTN","SCRPPAT3",89,0)
 S $P(@STORE@("H3"),"=",81)=""
"RTN","SCRPPAT3",90,0)
 Q
"RTN","SCRPPAT3",91,0)
ALL ;
"RTN","SCRPPAT3",92,0)
 ;get all practitioners for all teams selected
"RTN","SCRPPAT3",93,0)
 I TEAM=1 D TALL ;all teams selected
"RTN","SCRPPAT3",94,0)
 N TIEN,OKAY,XLIST,YLIST,SCTP,SCI,SCDT
"RTN","SCRPPAT3",95,0)
 S TIEN=""
"RTN","SCRPPAT3",96,0)
 F  S TIEN=$O(TEAM(TIEN)) Q:TIEN=""!(TIEN'?.N)  D
"RTN","SCRPPAT3",97,0)
 .I $D(TEAM(TIEN)) D
"RTN","SCRPPAT3",98,0)
 ..K XLIST
"RTN","SCRPPAT3",99,0)
 ..S OKAY=$$TPTM^SCAPMC(TIEN,"","","","XLIST","ERROR")
"RTN","SCRPPAT3",100,0)
 ..S SCTP=0 F  S SCTP=$O(XLIST("SCTP",TIEN,SCTP)) Q:'SCTP  D
"RTN","SCRPPAT3",101,0)
 ...K YLIST S SCDT="SCDT",(SCDT("BEGIN"),SCDT("END"))=DT,SCDT("INCL")=0
"RTN","SCRPPAT3",102,0)
 ...S OKAY=$$PRTP^SCAPMC(SCTP,.SCDT,"YLIST","ERROR",1,0)
"RTN","SCRPPAT3",103,0)
 ...S SCI=0 F  S SCI=$O(YLIST(SCI)) Q:'SCI  D
"RTN","SCRPPAT3",104,0)
 ....S @TPRC@(0)=$G(@TPRC@(0))+1
"RTN","SCRPPAT3",105,0)
 ....S @TPRC@(@TPRC@(0))=YLIST(SCI)
"RTN","SCRPPAT3",106,0)
 Q
"RTN","SCRPPAT3",107,0)
 ;
"RTN","SCRPPAT3",108,0)
TALL ;
"RTN","SCRPPAT3",109,0)
 ;get all active team for divisions selected
"RTN","SCRPPAT3",110,0)
 N NXT,IIEN,NODE
"RTN","SCRPPAT3",111,0)
 S NXT=0,IIEN=""
"RTN","SCRPPAT3",112,0)
 ;$O through team file and find all active teams for selected divisions
"RTN","SCRPPAT3",113,0)
 F  S IIEN=$O(^SCTM(404.51,"AINST",IIEN)) Q:IIEN=""  D
"RTN","SCRPPAT3",114,0)
 .I INST=1!$D(INST(IIEN)) D
"RTN","SCRPPAT3",115,0)
 ..S TIEN=0
"RTN","SCRPPAT3",116,0)
 ..F  S TIEN=$O(^SCTM(404.51,"AINST",IIEN,TIEN)) Q:TIEN=""  D
"RTN","SCRPPAT3",117,0)
 ...I $$ACTTM^SCMCTMU(TIEN) S TEAM(TIEN)=""
"RTN","SCRPPAT3",118,0)
 Q
"RTN","SCRPPAT3",119,0)
 ;
"RTN","SCRPPAT3",120,0)
SETUP(IIEN,INAME,TIEN,TNAME,PRAC,PNAME,POSN,TPI,PRCP) ;
"RTN","SCRPPAT3",121,0)
 ;setup data
"RTN","SCRPPAT3",122,0)
 S IIEN=+$P($G(^SCTM(404.51,TIEN,0)),"^",7) ;institution ien
"RTN","SCRPPAT3",123,0)
 S INAME=$P($G(^DIC(4,IIEN,0)),"^") ;institution name
"RTN","SCRPPAT3",124,0)
 I INAME="" S INAME="[BAD DATA]"
"RTN","SCRPPAT3",125,0)
 ;
"RTN","SCRPPAT3",126,0)
 I PNAME="" S PNAME="[BAD DATA]"
"RTN","SCRPPAT3",127,0)
 I TNAME="" S TNAME="[BAD DATA]"
"RTN","SCRPPAT3",128,0)
 I $G(SORT)=3 S IIEN=1,TIEN=1
"RTN","SCRPPAT3",129,0)
 I '$D(@STORE@("PN",IIEN,PRAC,TIEN,TPI)) S @STORE@("PN",IIEN,PRAC,TIEN,TPI)="Practitioner: "_PNAME_$S(SORT=3:"",1:" ("_POSN_")")
"RTN","SCRPPAT3",130,0)
 I $L(PRCP) S @STORE@("PN",IIEN,PRAC,TIEN,TPI,"PRCP")="   Preceptor: "_PRCP
"RTN","SCRPPAT3",131,0)
 I '$D(@STORE@("TN",IIEN,$S($G(SORT)=3:1,1:TIEN))) S @STORE@("TN",IIEN,$S($G(SORT)=3:1,1:TIEN))="        Team: "_TNAME
"RTN","SCRPPAT3",132,0)
 ;
"RTN","SCRPPAT3",133,0)
 I '$D(@STORE@("I",$S($G(SORT)=3:"S3",1:INAME),IIEN)) S @STORE@("I",$S($G(SORT)=3:"S3",1:INAME),IIEN)="",@STORE@(IIEN)=$S(SORT=3:"",1:"    Division: "_INAME)
"RTN","SCRPPAT3",134,0)
 S @STORE@("T",IIEN,$S($G(SORT)=3:"T3",1:TNAME),$S($G(SORT)=3:1,1:TIEN))=""
"RTN","SCRPPAT3",135,0)
 I '$D(@STORE@("P",IIEN,PNAME,PRAC,TPI)) S @STORE@("P",IIEN,PNAME,PRAC,TPI)=""
"RTN","SCRPPAT3",136,0)
 I '$D(@STORE@("TOTAL",IIEN,PRAC,0)) S @STORE@("TOTAL",IIEN,PRAC,0)=0
"RTN","SCRPPAT3",137,0)
 I '$D(@STORE@("TOTAL",IIEN,PRAC,TIEN)) S @STORE@("TOTAL",IIEN,PRAC,TIEN)=0
"RTN","SCRPPAT3",138,0)
 ;
"RTN","SCRPPAT3",139,0)
 S @STORE@("TH",IIEN,PRAC)="Patient Count for "_PNAME_": "
"RTN","SCRPPAT3",140,0)
 S @STORE@("TH",IIEN,PRAC,TIEN,TPI)="Patient Count for "_PNAME_": "
"RTN","SCRPPAT3",141,0)
 N SCX
"RTN","SCRPPAT3",142,0)
 S SCX=$E(PNAME,1,22),$E(SCX,25)=$E(POSN,1,22),$E(SCX,49)=$E(TNAME,1,22)
"RTN","SCRPPAT3",143,0)
 S @STORE@("SUM0",IIEN,PRAC,TIEN,TPI)=SCX
"RTN","SCRPPAT3",144,0)
 ;
"RTN","SCRPPAT3",145,0)
 S @STORE@("TH",IIEN)="** Note: Patient Panel Count is a count of unique patients for each practitioner"
"RTN","SCRPPAT3",146,0)
 Q 0
"RTN","SCRPRAC2")
0^14^B21302300^B19064401
"RTN","SCRPRAC2",1,0)
SCRPRAC2 ;ALB/CMM - Practitioner Demographics continued ; 29 Jun 99  04:11PM
"RTN","SCRPRAC2",2,0)
 ;;5.3;Scheduling;**41,177,520**;AUG 13, 1993;Build 26
"RTN","SCRPRAC2",3,0)
 ;
"RTN","SCRPRAC2",4,0)
 ;Practitioner Demographics Report
"RTN","SCRPRAC2",5,0)
 ;
"RTN","SCRPRAC2",6,0)
GATHER(PARRAY,PRAC) ;
"RTN","SCRPRAC2",7,0)
 ;get practitioner data
"RTN","SCRPRAC2",8,0)
 N ANODE,TIEN,PNAME,POS,STROL,USCL,TNAME,MAX,PHONE,ASSIGN,ROOM,SERV
"RTN","SCRPRAC2",9,0)
 N NODE,PIEN,CNAME,PCLASS,PRCP,PRCPCNT,SCLN,SCI,NXT,PRCPCT,PRCPOS
"RTN","SCRPRAC2",10,0)
 N PRCPTE,SCDT,SCRATCH
"RTN","SCRPRAC2",11,0)
 S NXT=0
"RTN","SCRPRAC2",12,0)
 F  S NXT=$O(@PARRAY@(NXT)) Q:NXT=""!(NXT'?.N)  D
"RTN","SCRPRAC2",13,0)
 .S (PNAME,PHONE,SERV,ROOM)=""
"RTN","SCRPRAC2",14,0)
 .D PINFO(PRAC,.PNAME,.PHONE,.ROOM,.SERV)
"RTN","SCRPRAC2",15,0)
 .;get provider name, office phone, room, service/section, person class
"RTN","SCRPRAC2",16,0)
 .;
"RTN","SCRPRAC2",17,0)
 .S ANODE=$G(@PARRAY@(NXT))
"RTN","SCRPRAC2",18,0)
 .Q:ANODE=""
"RTN","SCRPRAC2",19,0)
 .S PIEN=+$P(ANODE,"^") ;position ien
"RTN","SCRPRAC2",20,0)
 .;
"RTN","SCRPRAC2",21,0)
 .;Get precepted provider information
"RTN","SCRPRAC2",22,0)
 .S PRCPCNT=0
"RTN","SCRPRAC2",23,0)
 .S SCDT="SCDT",(SCDT("BEGIN"),SCDT("END"))="DT",SCDT("INCL")=0
"RTN","SCRPRAC2",24,0)
 .K ^TMP("SCRATCH",$J),^TMP("SCRATCH1",$J) S SCI="^TMP(""SCRATCH1"",$J)"
"RTN","SCRPRAC2",25,0)
 .S SCI=$$PRECHIS^SCMCLK(PIEN,.SCDT,SCI),SCI=0
"RTN","SCRPRAC2",26,0)
 .F  S SCI=$O(^TMP("SCRATCH1",$J,SCI)) Q:'SCI  D
"RTN","SCRPRAC2",27,0)
 ..N SCPRCD,SCTP
"RTN","SCRPRAC2",28,0)
 ..S SCPRCD=^TMP("SCRATCH1",$J,SCI),SCTP=$P(SCPRCD,U,3)
"RTN","SCRPRAC2",29,0)
 ..S PRCPTE=$P(SCPRCD,U,2) S:'$L(PRCPTE) PRCPTE="[unknown]"
"RTN","SCRPRAC2",30,0)
 ..S PRCPOS=$P($G(SCRATCH(1)),U,4)
"RTN","SCRPRAC2",31,0)
 ..S PRCPCT=$$PCPOSCNT^SCAPMCU1(SCTP,DT,0)
"RTN","SCRPRAC2",32,0)
 ..S PRCPCNT=PRCPCNT+PRCPCT
"RTN","SCRPRAC2",33,0)
 ..S ^TMP("SCRATCH",$J,PRCPTE,SCTP)=PRCPOS_U_PRCPCT
"RTN","SCRPRAC2",34,0)
 ..Q
"RTN","SCRPRAC2",35,0)
 .;
"RTN","SCRPRAC2",36,0)
 .S POS=$P(ANODE,"^",2) ;position name
"RTN","SCRPRAC2",37,0)
 .S STROL=$P(ANODE,"^",8) ;standard role name
"RTN","SCRPRAC2",38,0)
 .S USCL=$P(ANODE,"^",10) ;user class name
"RTN","SCRPRAC2",39,0)
 .S NODE=$G(^SCTM(404.57,PIEN,0))
"RTN","SCRPRAC2",40,0)
 .S MAX=$P(NODE,"^",8) ;max patient assignments to position
"RTN","SCRPRAC2",41,0)
 .S ASSIGN=+$$PCPOSCNT^SCAPMCU1(PIEN,DT,0) ;assigned patients
"RTN","SCRPRAC2",42,0)
 .N CNAME,SCCLIEN
"RTN","SCRPRAC2",43,0)
 .D SETASCL(PIEN,.CNAME,.SCCLIEN) ;associated clinics
"RTN","SCRPRAC2",44,0)
 .;
"RTN","SCRPRAC2",45,0)
 .;Get preceptor
"RTN","SCRPRAC2",46,0)
 .S PRCP=$P($$OKPREC2^SCMCLK(PIEN,DT),U,2)
"RTN","SCRPRAC2",47,0)
 .;
"RTN","SCRPRAC2",48,0)
 .S TIEN=+$P(ANODE,"^",3) ;team ien
"RTN","SCRPRAC2",49,0)
 .S TNAME=$P($G(^SCTM(404.51,TIEN,0)),"^") ;team name
"RTN","SCRPRAC2",50,0)
 .;
"RTN","SCRPRAC2",51,0)
 .;Set array for output
"RTN","SCRPRAC2",52,0)
 .S SCLN=0
"RTN","SCRPRAC2",53,0)
 .D SET1("Name",PNAME),SET2("Serv./Sect.",SERV)
"RTN","SCRPRAC2",54,0)
 .D SET1("Team",TNAME),SET2("Position",POS)
"RTN","SCRPRAC2",55,0)
 .D SET1("Role",STROL),SET2("User Class",USCL)
"RTN","SCRPRAC2",56,0)
 .D SET1("Room",ROOM),SET2("Pts. Allowed",MAX)
"RTN","SCRPRAC2",57,0)
 .D SET1("Phone",PHONE),SET2("Pts. Assigned",ASSIGN)
"RTN","SCRPRAC2",58,0)
 .I $L($G(PRCP)) D SET3(1,"Preceptor: "_PRCP)
"RTN","SCRPRAC2",59,0)
 .D SET3(4,"Assoc. Clinic: ")
"RTN","SCRPRAC2",60,0)
 .D SETCNAME(.CNAME)
"RTN","SCRPRAC2",61,0)
 .I $L(PCLASS(1)) D
"RTN","SCRPRAC2",62,0)
 ..D SET3(4,"Person"),SET3(5,"Class: "_PCLASS(1)) D
"RTN","SCRPRAC2",63,0)
 ..I $L(PCLASS(2)) D SET3(15,PCLASS(2)) D
"RTN","SCRPRAC2",64,0)
 ...I $L(PCLASS(3)) D SET3(18,PCLASS(3))
"RTN","SCRPRAC2",65,0)
 ...Q
"RTN","SCRPRAC2",66,0)
 ..Q
"RTN","SCRPRAC2",67,0)
 .Q:'$D(^TMP("SCRATCH",$J))
"RTN","SCRPRAC2",68,0)
 .D SET3(1,"")
"RTN","SCRPRAC2",69,0)
 .D SET4("Precepted Provider","Precepted Position","Pts. Precepted")
"RTN","SCRPRAC2",70,0)
 .S SCI="",$P(SCI,"-",31)="" D SET4(SCI,SCI,$E(SCI,1,14))
"RTN","SCRPRAC2",71,0)
 .S PRCPTE="" F  S PRCPTE=$O(^TMP("SCRATCH",$J,PRCPTE)) Q:PRCPTE=""  D
"RTN","SCRPRAC2",72,0)
 ..S SCTP=0 F  S SCTP=$O(^TMP("SCRATCH",$J,PRCPTE,SCTP)) Q:'SCTP  D
"RTN","SCRPRAC2",73,0)
 ...S PRCPOS=^TMP("SCRATCH",$J,PRCPTE,SCTP)
"RTN","SCRPRAC2",74,0)
 ...S PRCPCT=+$P(PRCPOS,U,2),PRCPOS=$P(PRCPOS,U)
"RTN","SCRPRAC2",75,0)
 ...D SET4(PRCPTE,PRCPOS,PRCPCT_"  ")
"RTN","SCRPRAC2",76,0)
 ...Q
"RTN","SCRPRAC2",77,0)
 ..Q
"RTN","SCRPRAC2",78,0)
 .D SET3(1,"") S SCI="  Total precepted patients: "_PRCPCNT
"RTN","SCRPRAC2",79,0)
 .S $E(SCI,37)=$J(("Total assigned/precepted patients: "_(PRCPCNT+ASSIGN)),42)
"RTN","SCRPRAC2",80,0)
 .D SET3(1,SCI)
"RTN","SCRPRAC2",81,0)
 .K ^TMP("SCRATCH",$J),^TMP("SCRATCH1",$J)
"RTN","SCRPRAC2",82,0)
 .Q
"RTN","SCRPRAC2",83,0)
 Q
"RTN","SCRPRAC2",84,0)
 ;
"RTN","SCRPRAC2",85,0)
SETASCL(PIEN,CNAME,SCCLIEN) ;SET ASSOCIATED CLINICS
"RTN","SCRPRAC2",86,0)
 N I,CNT1
"RTN","SCRPRAC2",87,0)
 S CNT1=0,I=0
"RTN","SCRPRAC2",88,0)
 F  S I=$O(^SCTM(404.57,PIEN,5,I)) Q:'I  D
"RTN","SCRPRAC2",89,0)
 .S SCCLIEN(CNT1)=I,CNAME(CNT1)=$P($G(^SC(I,0)),U),CNT1=CNT1+1
"RTN","SCRPRAC2",90,0)
 Q
"RTN","SCRPRAC2",91,0)
SET1(LABEL,VALUE) ;Set output line
"RTN","SCRPRAC2",92,0)
 S SCLN=SCLN+1
"RTN","SCRPRAC2",93,0)
 S @STORE@(PNAME,PIEN,SCLN)=$J(LABEL,9)_": "_$E(VALUE,1,26)
"RTN","SCRPRAC2",94,0)
 Q
"RTN","SCRPRAC2",95,0)
 ;
"RTN","SCRPRAC2",96,0)
SET2(LABEL,VALUE) ;Set second column of output line
"RTN","SCRPRAC2",97,0)
 S $E(@STORE@(PNAME,PIEN,SCLN),40)=$J(LABEL,13)_": "_$E(VALUE,1,26)
"RTN","SCRPRAC2",98,0)
 Q
"RTN","SCRPRAC2",99,0)
 ;
"RTN","SCRPRAC2",100,0)
SET3(COL,VALUE) ;Set output line
"RTN","SCRPRAC2",101,0)
 N SCX
"RTN","SCRPRAC2",102,0)
 S SCLN=SCLN+1,SCX="",$E(SCX,COL)=$E(VALUE,1,(80-(COL-1)))
"RTN","SCRPRAC2",103,0)
 S @STORE@(PNAME,PIEN,SCLN)=SCX
"RTN","SCRPRAC2",104,0)
 Q
"RTN","SCRPRAC2",105,0)
 ;
"RTN","SCRPRAC2",106,0)
SET4(V1,V2,V3) ;Set output line
"RTN","SCRPRAC2",107,0)
 S SCLN=SCLN+1,V1="  "_V1,$E(V1,35)=V2,$E(V1,67)=$J(V3,14)
"RTN","SCRPRAC2",108,0)
 S @STORE@(PNAME,PIEN,SCLN)=V1
"RTN","SCRPRAC2",109,0)
 Q
"RTN","SCRPRAC2",110,0)
 ;
"RTN","SCRPRAC2",111,0)
SETCNAME(CNAME) ;associated clinics 
"RTN","SCRPRAC2",112,0)
 N A
"RTN","SCRPRAC2",113,0)
 S A="" F  S A=$O(CNAME(A)) Q:A=""  D SET3(12,CNAME(A))
"RTN","SCRPRAC2",114,0)
 Q
"RTN","SCRPRAC2",115,0)
 ;
"RTN","SCRPRAC2",116,0)
PINFO(VAE,PRACT,OPH,ROOM,SERV) ;
"RTN","SCRPRAC2",117,0)
 ;practitioner information from new person file
"RTN","SCRPRAC2",118,0)
 S PRACT=$P($G(^VA(200,VAE,0)),"^") ;practitioner name
"RTN","SCRPRAC2",119,0)
 S OPH=$P($G(^VA(200,VAE,.13)),"^",2) ;office phone
"RTN","SCRPRAC2",120,0)
 S ROOM=$P($G(^VA(200,VAE,.14)),"^") ;room
"RTN","SCRPRAC2",121,0)
 S SERV=$P($G(^VA(200,VAE,5)),"^") ;service/section ien
"RTN","SCRPRAC2",122,0)
 S SERV=$P($G(^DIC(49,+SERV,0)),"^") ;service/section name
"RTN","SCRPRAC2",123,0)
 S PCLASS=$$GET^XUA4A72(VAE) ;Person class
"RTN","SCRPRAC2",124,0)
 N SCI F SCI=1,2,3 S PCLASS(SCI)=$P(PCLASS,U,(SCI+1))
"RTN","SCRPRAC2",125,0)
 Q
"RTN","SCRPSLT")
0^15^B27323544^B25417054
"RTN","SCRPSLT",1,0)
SCRPSLT ;ALB/CMM - Summary Listing of Teams ; 29 Jun 99  04:11PM
"RTN","SCRPSLT",2,0)
 ;;5.3;Scheduling;**41,52,177,231,520**;AUG 13, 1993;Build 26
"RTN","SCRPSLT",3,0)
 ;
"RTN","SCRPSLT",4,0)
 ;Summary Listing of Teams Report
"RTN","SCRPSLT",5,0)
 ;
"RTN","SCRPSLT",6,0)
PROMPTS ;
"RTN","SCRPSLT",7,0)
 ;Prompt for Institution, Team, Role and Print device
"RTN","SCRPSLT",8,0)
 ;
"RTN","SCRPSLT",9,0)
 N VAUTD,VAUTT,VAUTR,QTIME,PRNT,NUMBER
"RTN","SCRPSLT",10,0)
 K VAUTD,VAUTT,VAUTR,SCUP
"RTN","SCRPSLT",11,0)
 S QTIME=""
"RTN","SCRPSLT",12,0)
 W ! D INST^SCRPU1 I Y=-1 G ERR
"RTN","SCRPSLT",13,0)
 W ! K Y D PRMTT^SCRPU1 I '$D(VAUTT) G ERR
"RTN","SCRPSLT",14,0)
 W ! K Y D ROLE^SCRPU1 I '$D(VAUTR) G ERR
"RTN","SCRPSLT",15,0)
 W !!,"This report requires 132 column output!"
"RTN","SCRPSLT",16,0)
 D QUE(.VAUTD,.VAUTT,.VAUTR) Q
"RTN","SCRPSLT",17,0)
 ;
"RTN","SCRPSLT",18,0)
QUE(INST,TEAM,ROLE) ;queue report
"RTN","SCRPSLT",19,0)
 ;Input Parameters: 
"RTN","SCRPSLT",20,0)
 ;INST - institutions selected (variable and array) 
"RTN","SCRPSLT",21,0)
 ;TEAM - teams selected (variable and array) 
"RTN","SCRPSLT",22,0)
 ;ROLE - roles selected (variable and array)
"RTN","SCRPSLT",23,0)
 N ZTSAVE,II
"RTN","SCRPSLT",24,0)
 F II="INST","TEAM","ROLE","INST(","TEAM(","ROLE(" S ZTSAVE(II)=""
"RTN","SCRPSLT",25,0)
 W ! D EN^XUTMDEVQ("QENTRY^SCRPSLT","Summary Listing of Teams",.ZTSAVE)
"RTN","SCRPSLT",26,0)
 Q
"RTN","SCRPSLT",27,0)
 ;
"RTN","SCRPSLT",28,0)
ENTRY2(INST,TEAM,ROLE,IOP,ZTDTH) ;
"RTN","SCRPSLT",29,0)
 ;Second entry point for GUI to use
"RTN","SCRPSLT",30,0)
 ;Input Parameters:
"RTN","SCRPSLT",31,0)
 ;INST - institutions selected (variable and array)
"RTN","SCRPSLT",32,0)
 ;TEAM - teams selected (variable and array)
"RTN","SCRPSLT",33,0)
 ;ROLE - roles selected (variable and array)
"RTN","SCRPSLT",34,0)
 ;IOP - print device
"RTN","SCRPSLT",35,0)
 ;ZTDTH - queue time (optional)
"RTN","SCRPSLT",36,0)
 ;
"RTN","SCRPSLT",37,0)
 ;validate parameters
"RTN","SCRPSLT",38,0)
 I '$D(INST)!'$D(TEAM)!'$D(ROLE)!'$D(IOP)!(IOP="") Q
"RTN","SCRPSLT",39,0)
 ;
"RTN","SCRPSLT",40,0)
 N NUMBER
"RTN","SCRPSLT",41,0)
 S IOST=$P(IOP,"^",2),IOP=$P(IOP,"^")
"RTN","SCRPSLT",42,0)
 I IOP?1"Q;".E S IOP=$P(IOP,"Q;",2)
"RTN","SCRPSLT",43,0)
 I IOST?1"C-".E D QENTRY G RET
"RTN","SCRPSLT",44,0)
 I ZTDTH="" S ZTDTH=$H
"RTN","SCRPSLT",45,0)
 S ZTRTN="QENTRY^SCRPSLT"
"RTN","SCRPSLT",46,0)
 S ZTDESC="Summary Listing Of Teams",ZTIO=IOP
"RTN","SCRPSLT",47,0)
 N II
"RTN","SCRPSLT",48,0)
 F II="INST","TEAM","ROLE","INST(","TEAM(","ROLE(","IOP" S ZTSAVE(II)=""
"RTN","SCRPSLT",49,0)
 D ^%ZTLOAD
"RTN","SCRPSLT",50,0)
RET S NUMBER=0
"RTN","SCRPSLT",51,0)
 I $D(ZTSK) S NUMBER=ZTSK
"RTN","SCRPSLT",52,0)
 D EXIT1
"RTN","SCRPSLT",53,0)
 Q NUMBER
"RTN","SCRPSLT",54,0)
 ;
"RTN","SCRPSLT",55,0)
QENTRY ;
"RTN","SCRPSLT",56,0)
 ;driver entry point
"RTN","SCRPSLT",57,0)
 S TITL="Summary Listing of Teams"
"RTN","SCRPSLT",58,0)
 S STORE="^TMP("_$J_",""SCRPSLT"")"
"RTN","SCRPSLT",59,0)
 K @STORE
"RTN","SCRPSLT",60,0)
 S @STORE=0
"RTN","SCRPSLT",61,0)
 I TEAM=1 D TALL^SCRPPAT3 S TEAM=0
"RTN","SCRPSLT",62,0)
 D FIND
"RTN","SCRPSLT",63,0)
 I $O(@STORE@(0))="" S NODATA=$$NODATA^SCRPU3(TITL)
"RTN","SCRPSLT",64,0)
 I '$D(NODATA) D PRINTIT(STORE,TITL)
"RTN","SCRPSLT",65,0)
 D EXIT2
"RTN","SCRPSLT",66,0)
 Q
"RTN","SCRPSLT",67,0)
 ;
"RTN","SCRPSLT",68,0)
ERR ;
"RTN","SCRPSLT",69,0)
EXIT1 ;
"RTN","SCRPSLT",70,0)
 K ZTDTH,ZTRTN,ZTDESC,ZTSK,ZTIO,ZTSAVE,SCUP
"RTN","SCRPSLT",71,0)
 Q
"RTN","SCRPSLT",72,0)
 ;
"RTN","SCRPSLT",73,0)
EXIT2 ;
"RTN","SCRPSLT",74,0)
 K @STORE
"RTN","SCRPSLT",75,0)
 K STOP,STORE,TITL,IOP,TEAM,INST,ROLE,NODATA
"RTN","SCRPSLT",76,0)
 Q
"RTN","SCRPSLT",77,0)
 ;
"RTN","SCRPSLT",78,0)
FIND ;
"RTN","SCRPSLT",79,0)
 N TM,EN2,EN,ROL,NODE,TEND,ACT,INA,TPASS,TPCN,TMAX,TMP,TOA,TNPC
"RTN","SCRPSLT",80,0)
 S TM=""
"RTN","SCRPSLT",81,0)
 F  S TM=$O(^SCTM(404.57,"C",TM)) Q:TM=""  D
"RTN","SCRPSLT",82,0)
 .;$O through team position file
"RTN","SCRPSLT",83,0)
 .I '$D(TEAM(TM))&(TEAM'=1) Q
"RTN","SCRPSLT",84,0)
 .;Q above, not a selected team
"RTN","SCRPSLT",85,0)
 .;selected team
"RTN","SCRPSLT",86,0)
 .S EN=""
"RTN","SCRPSLT",87,0)
 .S TPASS(TM)=0,TMAX(TM)=0,TPCN(TM)=0
"RTN","SCRPSLT",88,0)
 .F  S EN=$O(^SCTM(404.57,"C",TM,EN)) Q:EN=""  D
"RTN","SCRPSLT",89,0)
 ..I '$D(^SCTM(404.57,EN,0)) Q
"RTN","SCRPSLT",90,0)
 ..S NODE=$G(^SCTM(404.57,EN,0))
"RTN","SCRPSLT",91,0)
 ..Q:NODE=""
"RTN","SCRPSLT",92,0)
 ..S ROL=+$P(NODE,"^",3) ;role ien
"RTN","SCRPSLT",93,0)
 ..I '$D(ROLE(ROL))&(ROLE'=1) Q
"RTN","SCRPSLT",94,0)
 ..;Q above not a selected role
"RTN","SCRPSLT",95,0)
 ..;find active position during date range
"RTN","SCRPSLT",96,0)
 ..S TMP=$$DATES^SCAPMCU1(404.52,EN,DT)
"RTN","SCRPSLT",97,0)
 ..I +TMP=0 Q
"RTN","SCRPSLT",98,0)
 ..S EN2=+$P(TMP,"^",4)
"RTN","SCRPSLT",99,0)
 ..D KEEP^SCRPSLT2(NODE,EN,EN2,ROL,TM,.TPCN,.TNPC)
"RTN","SCRPSLT",100,0)
 ..S TPASS(TM)=$$TEAMCNT^SCAPMCU1(TM,DT)
"RTN","SCRPSLT",101,0)
 ..S TMAX(TM)=+$P($G(^SCTM(404.51,+TM,0)),U,8)
"RTN","SCRPSLT",102,0)
 ..S TOA(TM)=TMAX(TM)-TPASS(TM) S:TOA(TM)<0 TOA(TM)=0
"RTN","SCRPSLT",103,0)
 ..D TEAMT^SCRPSLT2(TM,.TPASS,.TMAX,.TPCN,.TOA,.TNPC)
"RTN","SCRPSLT",104,0)
 Q
"RTN","SCRPSLT",105,0)
 ;
"RTN","SCRPSLT",106,0)
PRINTIT(STORE,TITL) ;
"RTN","SCRPSLT",107,0)
 N INST,EINST,ETEAM,TEM,EPRACT,PRACT,NXT,PAGE,NPAGE,NEW,POS,SCAC
"RTN","SCRPSLT",108,0)
 S (INST,EINST)="",(NPAGE,STOP)=0,PAGE=1 W:$E(IOST)="C" @IOF
"RTN","SCRPSLT",109,0)
 D TITLE^SCRPU3(.PAGE,TITL)
"RTN","SCRPSLT",110,0)
 D FORHEAD^SCRPSLT2
"RTN","SCRPSLT",111,0)
 F  S EINST=$O(@STORE@("I",EINST)) Q:EINST=""!(STOP)  D
"RTN","SCRPSLT",112,0)
 .S INST=$O(@STORE@("I",EINST,""))
"RTN","SCRPSLT",113,0)
 .I INST="" Q
"RTN","SCRPSLT",114,0)
 .S (TEM,ETEAM)=""
"RTN","SCRPSLT",115,0)
 .F  S ETEAM=$O(@STORE@("T",INST,ETEAM)) Q:ETEAM=""!(STOP)  D
"RTN","SCRPSLT",116,0)
 ..S TEM=$O(@STORE@("T",INST,ETEAM,""))
"RTN","SCRPSLT",117,0)
 ..I TEM="" Q
"RTN","SCRPSLT",118,0)
 ..K NEW
"RTN","SCRPSLT",119,0)
 ..I NPAGE,(IOST'?1"C-".E) D NEWP^SCRPSLT2(INST,TEM,TITL,.PAGE) S NEW=""
"RTN","SCRPSLT",120,0)
 ..I NPAGE,(IOST?1"C-".E) D HOLD1^SCRPSLT2(.PAGE,TITL,INST,TEM) S NEW=""
"RTN","SCRPSLT",121,0)
 ..S NPAGE=1 I STOP Q
"RTN","SCRPSLT",122,0)
 ..I IOST'?1"C-".E,$Y>(IOSL-8) D NEWP^SCRPSLT2(INST,TEM,TITL,.PAGE) S NEW=""
"RTN","SCRPSLT",123,0)
 ..I IOST?1"C-".E,$Y>(IOSL-8) D HOLD1^SCRPSLT2(.PAGE,TITL,INST,TEM) S NEW=""
"RTN","SCRPSLT",124,0)
 ..I STOP Q
"RTN","SCRPSLT",125,0)
 ..I '$D(NEW) D HEADER^SCRPSLT2(INST,TEM)
"RTN","SCRPSLT",126,0)
 ..S (PRACT,EPRACT)=""
"RTN","SCRPSLT",127,0)
 ..F  S EPRACT=$O(@STORE@("PN",INST,TEM,EPRACT)) Q:EPRACT=""!(STOP)  D
"RTN","SCRPSLT",128,0)
 ...S PRACT=$O(@STORE@("PN",INST,TEM,EPRACT,""))
"RTN","SCRPSLT",129,0)
 ...I PRACT="" Q
"RTN","SCRPSLT",130,0)
 ...S POS=""
"RTN","SCRPSLT",131,0)
 ...F  S POS=$O(@STORE@(INST,TEM,PRACT,POS)) Q:POS=""!(STOP)  D
"RTN","SCRPSLT",132,0)
 ....W !,$G(@STORE@(INST,TEM,PRACT,POS))
"RTN","SCRPSLT",133,0)
 ....S SCAC=""
"RTN","SCRPSLT",134,0)
 ....F  S SCAC=$O(@STORE@(INST,TEM,PRACT,POS,SCAC)) Q:SCAC=""!(STOP)  D
"RTN","SCRPSLT",135,0)
 .....W !,$G(@STORE@(INST,TEM,PRACT,POS,SCAC))
"RTN","SCRPSLT",136,0)
 .....I IOST'?1"C-".E,$Y>(IOSL-4) D NEWP^SCRPSLT2(INST,TEM,TITL,.PAGE)
"RTN","SCRPSLT",137,0)
 .....I IOST?1"C-".E,$Y>(IOSL-4) D HOLD1^SCRPSLT2(.PAGE,TITL,INST,TEM)
"RTN","SCRPSLT",138,0)
 .....I STOP Q
"RTN","SCRPSLT",139,0)
 ....;W !,$G(@STORE@(INST,TEM,PRACT,POS)) ;writes info
"RTN","SCRPSLT",140,0)
 ..Q:STOP
"RTN","SCRPSLT",141,0)
 ..I IOST'?1"C-".E,$Y>(IOSL-8) D NEWP^SCRPSLT2(INST,TEM,TITL,.PAGE,1)
"RTN","SCRPSLT",142,0)
 ..I IOST?1"C-".E,$Y>(IOSL-8) D HOLD1^SCRPSLT2(.PAGE,TITL,INST,TEM,1)
"RTN","SCRPSLT",143,0)
 ..D TOTAL^SCRPSLT2(INST,TEM)
"RTN","SCRPSLT",144,0)
 .I STOP Q
"RTN","SCRPSLT",145,0)
 .S NPAGE=1
"RTN","SCRPSLT",146,0)
 I 'STOP,$E(IOST)="C" N DIR S DIR(0)="E" D ^DIR
"RTN","SCRPSLT",147,0)
 Q
"RTN","SCRPSLT2")
0^16^B34006267^B31388193
"RTN","SCRPSLT2",1,0)
SCRPSLT2 ;ALB/CMM - Summary Listing of Teams Continued ; 9/15/99 10:43am
"RTN","SCRPSLT2",2,0)
 ;;5.3;Scheduling;**41,174,177,231,520**;AUG 13, 1993;Build 26
"RTN","SCRPSLT2",3,0)
 ;
"RTN","SCRPSLT2",4,0)
 ;Summary Listing of Teams Report
"RTN","SCRPSLT2",5,0)
 ;
"RTN","SCRPSLT2",6,0)
KEEP(TNODE,APOS,TPOS,ROL,TM,TPCN,TNPC) ;
"RTN","SCRPSLT2",7,0)
 ;TNODE - zero node of the team position file
"RTN","SCRPSLT2",8,0)
 ;APOS - ien of team position file
"RTN","SCRPSLT2",9,0)
 ;TPOS - ien of position assignment history file
"RTN","SCRPSLT2",10,0)
 ;ROL - ien of role
"RTN","SCRPSLT2",11,0)
 ;TM - ien of team
"RTN","SCRPSLT2",12,0)
 ;
"RTN","SCRPSLT2",13,0)
 N POS,TNAME,TPHONE,TPC,TDIV,TEN,TMN,DIV,PPC,PCLIN,VAE,PRACT,NPC,MAX
"RTN","SCRPSLT2",14,0)
 N PCN,ROLN,PRCTP,PRCPC,PRCNPC,PRCPTE,SCPC,SCNPC,XDAT,SCDT,SCI
"RTN","SCRPSLT2",15,0)
 ;
"RTN","SCRPSLT2",16,0)
 S TEN=+$P(TNODE,"^",2) ;team file pointer
"RTN","SCRPSLT2",17,0)
 S TMN=$G(^SCTM(404.51,TEN,0))
"RTN","SCRPSLT2",18,0)
 S TNAME=$P(TMN,"^") ;team name
"RTN","SCRPSLT2",19,0)
 S DIV=+$P(TMN,"^",7) ;division ien
"RTN","SCRPSLT2",20,0)
 S TDIV=$P($G(^DIC(4,DIV,0)),"^") ;team division
"RTN","SCRPSLT2",21,0)
 D KTEAM(TNAME,TDIV,TM,DIV)
"RTN","SCRPSLT2",22,0)
 ;
"RTN","SCRPSLT2",23,0)
 S POS=$P(TNODE,"^") ;position name
"RTN","SCRPSLT2",24,0)
 ;SD*5.3*231 - call SCMCLK to determine in AP or not
"RTN","SCRPSLT2",25,0)
 S PPC=$S($P(TNODE,"^",4)<1:"NPC",+$$OKPREC3^SCMCLK(APOS,DT)>0:" AP",1:"PCP") ;PC?
"RTN","SCRPSLT2",26,0)
 ;S PCLIN=$P($G(^SC(+$P(TNODE,"^",9),0)),"^") ;associated clinic
"RTN","SCRPSLT2",27,0)
 D SETASCL^SCRPRAC2(APOS,.PCLIN)
"RTN","SCRPSLT2",28,0)
 S PCLIN=$G(PCLIN(0))
"RTN","SCRPSLT2",29,0)
 S ROLN=$P($G(^SD(403.46,+ROL,0)),U) ;role name
"RTN","SCRPSLT2",30,0)
 ;
"RTN","SCRPSLT2",31,0)
 S (PRCPC,PRCNPC)="",SCI="^TMP(""SCRATCH"",$J)"
"RTN","SCRPSLT2",32,0)
 K @SCI
"RTN","SCRPSLT2",33,0)
 S (SCDT("BEGIN"),SCDT("END"))=DT,SCDT("INCL")=0,SCDT="SCDT"
"RTN","SCRPSLT2",34,0)
 S SCI=$$PRECHIS^SCMCLK(APOS,.SCDT,SCI)
"RTN","SCRPSLT2",35,0)
 I SCI=1 S SCI=0 F  S SCI=$O(^TMP("SCRATCH",$J,SCI)) Q:'SCI  D
"RTN","SCRPSLT2",36,0)
 .N SCPRCD
"RTN","SCRPSLT2",37,0)
 .S SCPRCD=^TMP("SCRATCH",$J,SCI),PRCPTE=$P(SCPRCD,U,3) Q:'PRCPTE
"RTN","SCRPSLT2",38,0)
 .S SCPC=$$PCPOSCNT^SCAPMCU1(PRCPTE,DT,1) ;precepted PC patients
"RTN","SCRPSLT2",39,0)
 .S:SCPC<0 SCPC=0 S PRCPC=PRCPC+SCPC
"RTN","SCRPSLT2",40,0)
 .S SCNPC=$$PCPOSCNT^SCAPMCU1(PRCPTE,DT,0) ;all precepted patients
"RTN","SCRPSLT2",41,0)
 .S:SCNPC<0 SCNPC=0 S SCNPC=SCNPC-SCPC S:SCNPC<0 SCNPC=0
"RTN","SCRPSLT2",42,0)
 .S PRCNPC=PRCNPC+SCNPC
"RTN","SCRPSLT2",43,0)
 .Q
"RTN","SCRPSLT2",44,0)
 ;
"RTN","SCRPSLT2",45,0)
 S XDAT=ROLN_U_PRCPC_U_PRCNPC ;extra data
"RTN","SCRPSLT2",46,0)
 ;
"RTN","SCRPSLT2",47,0)
 S VAE=+$P($G(^SCTM(404.52,TPOS,0)),"^",3) ;ien of new person file
"RTN","SCRPSLT2",48,0)
 S PRACT=$P($G(^VA(200,VAE,0)),"^") ;practitioner name
"RTN","SCRPSLT2",49,0)
 I PRACT="" S PRACT="[Not Assigned]"
"RTN","SCRPSLT2",50,0)
 ;
"RTN","SCRPSLT2",51,0)
 S MAX=+$P(TNODE,"^",8) I MAX<0 S MAX=0
"RTN","SCRPSLT2",52,0)
 S PCN=$$PCPOSCNT^SCAPMCU1(APOS,DT) S:PCN=-1 PCN=0
"RTN","SCRPSLT2",53,0)
 S TPCN(TM)=$G(TPCN(TM))+PCN
"RTN","SCRPSLT2",54,0)
 S NPC=$$PCPOSCNT^SCAPMCU1(APOS,DT,0) S:NPC=-1 NPC=0
"RTN","SCRPSLT2",55,0)
 S NPC=NPC-PCN S:NPC<0 NPC=0
"RTN","SCRPSLT2",56,0)
 S TNPC(TM)=$G(TNPC(TM))+NPC
"RTN","SCRPSLT2",57,0)
 ;
"RTN","SCRPSLT2",58,0)
 D FORMAT(APOS,POS,PCLIN,VAE,PRACT,PPC,DIV,TM,NPC,MAX,PCN,XDAT)
"RTN","SCRPSLT2",59,0)
 N SCAC
"RTN","SCRPSLT2",60,0)
 S SCAC=0
"RTN","SCRPSLT2",61,0)
 F  S SCAC=$O(PCLIN(SCAC)) Q:SCAC=""  D FORMATAC(APOS,POS,PCLIN(SCAC),VAE,DIV,TM)
"RTN","SCRPSLT2",62,0)
 Q
"RTN","SCRPSLT2",63,0)
 ;
"RTN","SCRPSLT2",64,0)
TEAMT(TM,TPASS,TMAX,TPCN,TOA,TNPC) ;
"RTN","SCRPSLT2",65,0)
 ;set team totals into global
"RTN","SCRPSLT2",66,0)
 S @STORE@("TOTALS",TM,"H1")="               Team Totals:"
"RTN","SCRPSLT2",67,0)
 S @STORE@("TOTALS",TM,"H2")="------------------------------------"
"RTN","SCRPSLT2",68,0)
 S @STORE@("TOTALS",TM,"H3")="  Primary Care Assignments: "_$J($G(TPCN(TM)),6,0)
"RTN","SCRPSLT2",69,0)
 S @STORE@("TOTALS",TM,"H4")="        Non-PC Assignments: "_$J($G(TNPC(TM)),6,0)
"RTN","SCRPSLT2",70,0)
 S @STORE@("TOTALS",TM,"H5")="  Unique Patients Assigned: "_$J($G(TPASS(TM)),6,0)
"RTN","SCRPSLT2",71,0)
 S @STORE@("TOTALS",TM,"H6")="  Maximum Patients Allowed: "_$J($G(TMAX(TM)),6,0)
"RTN","SCRPSLT2",72,0)
 S @STORE@("TOTALS",TM,"H7")="    Total Open Assignments: "_$J($G(TOA(TM)),6,0)
"RTN","SCRPSLT2",73,0)
 Q
"RTN","SCRPSLT2",74,0)
 ;
"RTN","SCRPSLT2",75,0)
FORMAT(APOS,POS,PCLIN,VAE,PRACT,PPC,DIV,TM,NPC,MX,PC,XDAT) ;
"RTN","SCRPSLT2",76,0)
 ;
"RTN","SCRPSLT2",77,0)
 NEW TMP
"RTN","SCRPSLT2",78,0)
 I PRACT="" S PRACT="Bad Data"
"RTN","SCRPSLT2",79,0)
 S @STORE@("PN",DIV,TM,PRACT,VAE)=""
"RTN","SCRPSLT2",80,0)
 S @STORE@(DIV,TM,VAE,APOS)=$E(PRACT,1,20) ;practitioner name
"RTN","SCRPSLT2",81,0)
 S $E(@STORE@(DIV,TM,VAE,APOS),23)=$E(POS,1,20) ;position
"RTN","SCRPSLT2",82,0)
 S $E(@STORE@(DIV,TM,VAE,APOS),45)=PPC ;PC?
"RTN","SCRPSLT2",83,0)
 S $E(@STORE@(DIV,TM,VAE,APOS),50)=$E($P(XDAT,U),1,20) ;role
"RTN","SCRPSLT2",84,0)
 S $E(@STORE@(DIV,TM,VAE,APOS),72)=$E(PCLIN,1,25) ;assoc. clinic
"RTN","SCRPSLT2",85,0)
 S $E(@STORE@(DIV,TM,VAE,APOS),99)=$J(MX,6,0) ;max pts.
"RTN","SCRPSLT2",86,0)
 S $E(@STORE@(DIV,TM,VAE,APOS),107)=$J(PC,5,0) ;PC pts.
"RTN","SCRPSLT2",87,0)
 S $E(@STORE@(DIV,TM,VAE,APOS),114)=$J(NPC,5,0) ;non-PC pts.
"RTN","SCRPSLT2",88,0)
 ;
"RTN","SCRPSLT2",89,0)
 ;bp/djb 'Precepted Patients' column should be zero for APs.
"RTN","SCRPSLT2",90,0)
 ;Old code begins
"RTN","SCRPSLT2",91,0)
 ;S $E(@STORE@(DIV,TM,VAE,APOS),121)=$J($P(XDAT,U,2),5,0) ;precept PC
"RTN","SCRPSLT2",92,0)
 ;S $E(@STORE@(DIV,TM,VAE,APOS),128)=$J($P(XDAT,U,3),5,0) ;precept NPC
"RTN","SCRPSLT2",93,0)
 ;Old code ends
"RTN","SCRPSLT2",94,0)
 ;New code begins
"RTN","SCRPSLT2",95,0)
 S (TMP(1),TMP(2))=0 I PPC'["AP" D  ;APs should be zero
"RTN","SCRPSLT2",96,0)
 .S TMP(1)=$P(XDAT,U,2)
"RTN","SCRPSLT2",97,0)
 .S TMP(2)=$P(XDAT,U,3)
"RTN","SCRPSLT2",98,0)
 S $E(@STORE@(DIV,TM,VAE,APOS),121)=$J(TMP(1),5,0) ;precepted PC
"RTN","SCRPSLT2",99,0)
 S $E(@STORE@(DIV,TM,VAE,APOS),128)=$J(TMP(2),5,0) ;precepted NPC
"RTN","SCRPSLT2",100,0)
 ;New code ends
"RTN","SCRPSLT2",101,0)
 Q
"RTN","SCRPSLT2",102,0)
FORMATAC(APOS,POS,PCLIN,VAE,DIV,TM) ;clinic multiples
"RTN","SCRPSLT2",103,0)
 S $E(@STORE@(DIV,TM,VAE,APOS,SCAC),72)=$E(PCLIN,1,30)
"RTN","SCRPSLT2",104,0)
 Q
"RTN","SCRPSLT2",105,0)
 ;
"RTN","SCRPSLT2",106,0)
TOTAL(INST,TEM) ;
"RTN","SCRPSLT2",107,0)
 ;Prints team totals
"RTN","SCRPSLT2",108,0)
 N NXT
"RTN","SCRPSLT2",109,0)
 S NXT=""
"RTN","SCRPSLT2",110,0)
 W !
"RTN","SCRPSLT2",111,0)
 F  S NXT=$O(@STORE@("TOTALS",TEM,NXT)) Q:NXT=""  D
"RTN","SCRPSLT2",112,0)
 .;bp/djb Stop displaying certain 'Team Totals:' lines.
"RTN","SCRPSLT2",113,0)
 .;New code begin
"RTN","SCRPSLT2",114,0)
 .Q:$G(@STORE@("TOTALS",TEM,NXT))["Unique Patients Assigned"
"RTN","SCRPSLT2",115,0)
 .Q:$G(@STORE@("TOTALS",TEM,NXT))["Maximum Patients Allowed"
"RTN","SCRPSLT2",116,0)
 .Q:$G(@STORE@("TOTALS",TEM,NXT))["Total Open Assignments"
"RTN","SCRPSLT2",117,0)
 .;New code end
"RTN","SCRPSLT2",118,0)
 .W !,$G(@STORE@("TOTALS",TEM,NXT))
"RTN","SCRPSLT2",119,0)
 W !
"RTN","SCRPSLT2",120,0)
 Q
"RTN","SCRPSLT2",121,0)
 ;
"RTN","SCRPSLT2",122,0)
KTEAM(TNAME,TDIV,TIEN,IEND) ;
"RTN","SCRPSLT2",123,0)
 ;store team information
"RTN","SCRPSLT2",124,0)
 I TNAME="" S TNAME="[BAD DATA]"
"RTN","SCRPSLT2",125,0)
 I TDIV="" S TDIV="[BAD DATA]"
"RTN","SCRPSLT2",126,0)
 S @STORE@("I",TDIV,IEND)=""
"RTN","SCRPSLT2",127,0)
 S @STORE@("T",IEND,TNAME,TIEN)=""
"RTN","SCRPSLT2",128,0)
 S @STORE@(IEND)=" Division: "_TDIV
"RTN","SCRPSLT2",129,0)
 S @STORE@(IEND,TIEN)="Team Name: "_TNAME
"RTN","SCRPSLT2",130,0)
 Q
"RTN","SCRPSLT2",131,0)
 ;
"RTN","SCRPSLT2",132,0)
FORHEAD ;
"RTN","SCRPSLT2",133,0)
 S @STORE@("H3")="Practitioner"
"RTN","SCRPSLT2",134,0)
 S $E(@STORE@("H3"),23)="Position"
"RTN","SCRPSLT2",135,0)
 S $E(@STORE@("H3"),45)="PC?"
"RTN","SCRPSLT2",136,0)
 S $E(@STORE@("H3"),50)="Standard Role"
"RTN","SCRPSLT2",137,0)
 S $E(@STORE@("H3"),72)="Associated Clinic"
"RTN","SCRPSLT2",138,0)
 S $E(@STORE@("H1"),101)="Max."
"RTN","SCRPSLT2",139,0)
 S $E(@STORE@("H2"),101)="Pts."
"RTN","SCRPSLT2",140,0)
 S $E(@STORE@("H3"),99)="Allow."
"RTN","SCRPSLT2",141,0)
 S $E(@STORE@("H1"),107)="--Assigned--"
"RTN","SCRPSLT2",142,0)
 S $E(@STORE@("H2"),107)="--Patients--"
"RTN","SCRPSLT2",143,0)
 S $E(@STORE@("H3"),107)="PC     NonPC"
"RTN","SCRPSLT2",144,0)
 S $E(@STORE@("H1"),121)="--Precepted-"
"RTN","SCRPSLT2",145,0)
 S $E(@STORE@("H2"),121)="--Patients--"
"RTN","SCRPSLT2",146,0)
 S $E(@STORE@("H3"),121)="PC     NonPC"
"RTN","SCRPSLT2",147,0)
 S $P(@STORE@("H4"),"=",133)=""
"RTN","SCRPSLT2",148,0)
 Q
"RTN","SCRPSLT2",149,0)
HEADER(INST,TEM,TEND) ;
"RTN","SCRPSLT2",150,0)
 N NXT
"RTN","SCRPSLT2",151,0)
 S NXT="H",TEND=$G(TEND)
"RTN","SCRPSLT2",152,0)
 W !!,@STORE@(INST)
"RTN","SCRPSLT2",153,0)
 W !!,@STORE@(INST,TEM)
"RTN","SCRPSLT2",154,0)
 I 'TEND F  S NXT=$O(@STORE@(NXT)) Q:NXT'?1"H".E  D
"RTN","SCRPSLT2",155,0)
 .W !,@STORE@(NXT)
"RTN","SCRPSLT2",156,0)
 W !
"RTN","SCRPSLT2",157,0)
 Q
"RTN","SCRPSLT2",158,0)
NEWP(INST,TEM,TITL,PAGE,TEND) ;
"RTN","SCRPSLT2",159,0)
 S TEND=$G(TEND)
"RTN","SCRPSLT2",160,0)
 D NEWP1^SCRPU3(.PAGE,TITL)
"RTN","SCRPSLT2",161,0)
 I STOP Q
"RTN","SCRPSLT2",162,0)
 D HEADER(INST,TEM,TEND)
"RTN","SCRPSLT2",163,0)
 Q
"RTN","SCRPSLT2",164,0)
HOLD1(PAGE,TITL,INST,TEM,TEND) ;
"RTN","SCRPSLT2",165,0)
 ;device is home, reached end of page
"RTN","SCRPSLT2",166,0)
 S TEND=$G(TEND)
"RTN","SCRPSLT2",167,0)
 D HOLD^SCRPU3(.PAGE,TITL)
"RTN","SCRPSLT2",168,0)
 I STOP Q
"RTN","SCRPSLT2",169,0)
 D HEADER(INST,TEM,TEND)
"RTN","SCRPSLT2",170,0)
 Q
"RTN","SCRPTM")
0^17^B34769251^B33079935
"RTN","SCRPTM",1,0)
SCRPTM ;ALB/CMM - List of Team's Members Report ; 29 Jun 99  04:11PM
"RTN","SCRPTM",2,0)
 ;;5.3;Scheduling;**41,48,52,181,177,520**;AUG 13, 1993;Build 26
"RTN","SCRPTM",3,0)
 ;
"RTN","SCRPTM",4,0)
 ;List of Team's Members Report
"RTN","SCRPTM",5,0)
 ;
"RTN","SCRPTM",6,0)
PROMPTS ;
"RTN","SCRPTM",7,0)
 ;Prompt for Institution, Team, Date Range, User Class, Role
"RTN","SCRPTM",8,0)
 ;and Print device
"RTN","SCRPTM",9,0)
 ;
"RTN","SCRPTM",10,0)
 N VAUTD,VAUTT,VAUTUC,VAUTR,QTIME,RANG,PRNT,NUMBER
"RTN","SCRPTM",11,0)
 K VAUTD,VAUTT,VAUTUC,VAUTR,SCUP
"RTN","SCRPTM",12,0)
 S QTIME=""
"RTN","SCRPTM",13,0)
 W ! D INST^SCRPU1 I Y=-1 G ERR
"RTN","SCRPTM",14,0)
 W ! K Y D PRMTT^SCRPU1 I '$D(VAUTT) G ERR
"RTN","SCRPTM",15,0)
 W ! K Y S RANG=$$DTRANG^SCRPU2() I +RANG=-1 G ERR
"RTN","SCRPTM",16,0)
 W ! K Y D USER^SCRPU1 I '$D(VAUTUC)&($P($G(^SD(404.91,1,"PCMM")),"^")=1) G ERR
"RTN","SCRPTM",17,0)
 W ! K Y D ROLE^SCRPU1 I '$D(VAUTR) G ERR
"RTN","SCRPTM",18,0)
 D QUE(.VAUTD,.VAUTT,.VAUTUC,.VAUTR,RANG) Q
"RTN","SCRPTM",19,0)
 ;
"RTN","SCRPTM",20,0)
QUE(INST,TEAM,USERC,ROLE,RANGE) ;queue report
"RTN","SCRPTM",21,0)
 ;Input Parameters: 
"RTN","SCRPTM",22,0)
 ;INST - institutions selected (variable and array) 
"RTN","SCRPTM",23,0)
 ;TEAM - teams selected (variable and array) 
"RTN","SCRPTM",24,0)
 ;USERC - user classes selected (variable and array) 
"RTN","SCRPTM",25,0)
 ;ROLE - roles selected (variable and array) 
"RTN","SCRPTM",26,0)
 ;RANGE - date range selected (begin date ^ end date)
"RTN","SCRPTM",27,0)
 N ZTSAVE,II
"RTN","SCRPTM",28,0)
 F II="INST","TEAM","USERC","ROLE","INST(","TEAM(","USERC(","ROLE(","RANGE" S ZTSAVE(II)=""
"RTN","SCRPTM",29,0)
 W ! D EN^XUTMDEVQ("QENTRY^SCRPTM","Team Member Listing",.ZTSAVE)
"RTN","SCRPTM",30,0)
 Q
"RTN","SCRPTM",31,0)
 ;
"RTN","SCRPTM",32,0)
ENTRY2(INST,TEAM,USERC,ROLE,RANGE,IOP,ZTDTH) ;
"RTN","SCRPTM",33,0)
 ;Second entry point for GUI to use
"RTN","SCRPTM",34,0)
 ;Input Parameters:
"RTN","SCRPTM",35,0)
 ;INST - institutions selected (variable and array)
"RTN","SCRPTM",36,0)
 ;TEAM - teams selected (variable and array)
"RTN","SCRPTM",37,0)
 ;USERC - user classes selected (variable and array)
"RTN","SCRPTM",38,0)
 ;ROLE - roles selected (variable and array)
"RTN","SCRPTM",39,0)
 ;RANGE - date range selected (begin date ^ end date)
"RTN","SCRPTM",40,0)
 ;IOP - print device
"RTN","SCRPTM",41,0)
 ;ZTDTH - queue time (optional)
"RTN","SCRPTM",42,0)
 ;
"RTN","SCRPTM",43,0)
 ;validate parameters
"RTN","SCRPTM",44,0)
 I '$D(INST)!'$D(TEAM)!'$D(ROLE)!'$D(RANGE)!'$D(IOP)!(IOP="") Q
"RTN","SCRPTM",45,0)
 ;
"RTN","SCRPTM",46,0)
 N NUMBER
"RTN","SCRPTM",47,0)
 S IOST=$P(IOP,"^",2),IOP=$P(IOP,"^")
"RTN","SCRPTM",48,0)
 I IOP?1"Q;".E S IOP=$P(IOP,"Q;",2)
"RTN","SCRPTM",49,0)
 I IOST?1"C-".E D QENTRY G RET
"RTN","SCRPTM",50,0)
 I ZTDTH="" S ZTDTH=$H
"RTN","SCRPTM",51,0)
 S ZTRTN="QENTRY^SCRPTM"
"RTN","SCRPTM",52,0)
 S ZTDESC="List of Team's Members",ZTIO=IOP
"RTN","SCRPTM",53,0)
 N II
"RTN","SCRPTM",54,0)
 F II="INST","TEAM","USERC","ROLE","INST(","TEAM(","USERC(","ROLE(","RANGE","IOP" S ZTSAVE(II)=""
"RTN","SCRPTM",55,0)
 D ^%ZTLOAD
"RTN","SCRPTM",56,0)
RET S NUMBER=0
"RTN","SCRPTM",57,0)
 I $D(ZTSK) S NUMBER=ZTSK
"RTN","SCRPTM",58,0)
 D EXIT1
"RTN","SCRPTM",59,0)
 Q NUMBER
"RTN","SCRPTM",60,0)
 ;
"RTN","SCRPTM",61,0)
QENTRY ;
"RTN","SCRPTM",62,0)
 ;driver entry point
"RTN","SCRPTM",63,0)
 S TITL="Team Member Listing"
"RTN","SCRPTM",64,0)
 S STORE="^TMP("_$J_",""SCRPTM"")"
"RTN","SCRPTM",65,0)
 K @STORE
"RTN","SCRPTM",66,0)
 S @STORE=0
"RTN","SCRPTM",67,0)
 D BUILD
"RTN","SCRPTM",68,0)
 I $O(@STORE@(0))="" S NODATA=$$NODATA^SCRPU3(TITL)
"RTN","SCRPTM",69,0)
 I '$D(NODATA) D PRINTIT(STORE,TITL)
"RTN","SCRPTM",70,0)
 D EXIT2
"RTN","SCRPTM",71,0)
 Q
"RTN","SCRPTM",72,0)
 ;
"RTN","SCRPTM",73,0)
ERR ;
"RTN","SCRPTM",74,0)
EXIT1 ;
"RTN","SCRPTM",75,0)
 K ZTDTH,ZTRTN,ZTDESC,ZTSK,ZTIO,ZTSAVE,SCUP
"RTN","SCRPTM",76,0)
 Q
"RTN","SCRPTM",77,0)
EXIT2 ;
"RTN","SCRPTM",78,0)
 K @STORE
"RTN","SCRPTM",79,0)
 K STOP,STORE,TITL,IOP,TEAM,INST,NODATA,RANGE,ROLE,USERC
"RTN","SCRPTM",80,0)
 Q
"RTN","SCRPTM",81,0)
 ;
"RTN","SCRPTM",82,0)
BUILD ;get report data
"RTN","SCRPTM",83,0)
 ;get all practitioners for all teams selected
"RTN","SCRPTM",84,0)
 I TEAM=1 D TALL ;all teams selected
"RTN","SCRPTM",85,0)
 N TIEN,OKAY,XLIST,YLIST,SCTP,SCI,SCDT,PLIST
"RTN","SCRPTM",86,0)
 S SCDT("BEGIN")=$P(RANGE,U),SCDT("END")=$P(RANGE,U,2)
"RTN","SCRPTM",87,0)
 S SCDT("INCL")=0,SCDT="SCDT"
"RTN","SCRPTM",88,0)
 S TIEN="",PLIST="^TMP(""SCRP"",$J,""LIST"")"
"RTN","SCRPTM",89,0)
 F  S TIEN=$O(TEAM(TIEN)) Q:TIEN=""!(TIEN'?.N)  D
"RTN","SCRPTM",90,0)
 .K XLIST,@PLIST
"RTN","SCRPTM",91,0)
 .S OKAY=$$TPTM^SCAPMC(TIEN,.SCDT,"","","XLIST","ERROR")
"RTN","SCRPTM",92,0)
 .S SCTP=0 F  S SCTP=$O(XLIST("SCTP",TIEN,SCTP)) Q:'SCTP  D
"RTN","SCRPTM",93,0)
 ..S SCTP0=$G(^SCTM(404.57,SCTP,0)) Q:'$L(SCTP0)
"RTN","SCRPTM",94,0)
 ..I ROLE'=1,'$D(ROLE(+$P(SCTP0,U,3))) Q  ;not a selected role
"RTN","SCRPTM",95,0)
 ..I $D(USERC),USERC'=1,'$D(USERC(+$P(SCTP0,U,13))) Q  ;not a selected user class
"RTN","SCRPTM",96,0)
 ..K YLIST
"RTN","SCRPTM",97,0)
 ..S OKAY=$$PRTP^SCAPMC(SCTP,.SCDT,"YLIST","ERROR",1,0)
"RTN","SCRPTM",98,0)
 ..S SCI=0 F  S SCI=$O(YLIST(SCI)) Q:'SCI  D
"RTN","SCRPTM",99,0)
 ...S @PLIST@(0)=$G(@PLIST@(0))+1
"RTN","SCRPTM",100,0)
 ...S @PLIST@(@PLIST@(0))=YLIST(SCI)
"RTN","SCRPTM",101,0)
 ...Q
"RTN","SCRPTM",102,0)
 ..Q
"RTN","SCRPTM",103,0)
 .I OKAY D PULL^SCRPTM2(TIEN,.PLIST)
"RTN","SCRPTM",104,0)
 .Q
"RTN","SCRPTM",105,0)
 Q
"RTN","SCRPTM",106,0)
 ;
"RTN","SCRPTM",107,0)
TALL ;
"RTN","SCRPTM",108,0)
 ;get all active team for divisions selected
"RTN","SCRPTM",109,0)
 N NXT,IIEN,NODE
"RTN","SCRPTM",110,0)
 S NXT=0,IIEN=""
"RTN","SCRPTM",111,0)
 ;$O through team file and find all active teams for selected divisions
"RTN","SCRPTM",112,0)
 F  S IIEN=$O(^SCTM(404.51,"AINST",IIEN)) Q:IIEN=""  D
"RTN","SCRPTM",113,0)
 .I INST=1!$D(INST(IIEN)) D
"RTN","SCRPTM",114,0)
 ..S TIEN=0
"RTN","SCRPTM",115,0)
 ..F  S TIEN=$O(^SCTM(404.51,"AINST",IIEN,TIEN)) Q:TIEN=""  D
"RTN","SCRPTM",116,0)
 ...I $$ACTTM^SCMCTMU(TIEN) S TEAM(TIEN)=""
"RTN","SCRPTM",117,0)
 Q
"RTN","SCRPTM",118,0)
 ;
"RTN","SCRPTM",119,0)
PRINTIT(STORE,TITL) ;
"RTN","SCRPTM",120,0)
 N INST,EINST,ETEAM,TEM,EPRACT,PRACT,PAGE,NXT,NPAGE,CNT,HEAD,POS
"RTN","SCRPTM",121,0)
 S EINST="",(NPAGE,STOP,HEAD)=0,PAGE=1 W:$E(IOST)="C" @IOF
"RTN","SCRPTM",122,0)
 D TITLE^SCRPU3(.PAGE,TITL)
"RTN","SCRPTM",123,0)
 F  S EINST=$O(@STORE@("I",EINST)) Q:EINST=""!(STOP)  D
"RTN","SCRPTM",124,0)
 .S INST=$O(@STORE@("I",EINST,""))
"RTN","SCRPTM",125,0)
 .Q:INST=""
"RTN","SCRPTM",126,0)
 .I 'NPAGE W !,$G(@STORE@(INST)) ;write institution line
"RTN","SCRPTM",127,0)
 .S (ETEAM,TEM)=""
"RTN","SCRPTM",128,0)
 .F  S ETEAM=$O(@STORE@("T",INST,ETEAM)) Q:ETEAM=""!(STOP)  D
"RTN","SCRPTM",129,0)
 ..S TEM=$O(@STORE@("T",INST,ETEAM,0))
"RTN","SCRPTM",130,0)
 ..I TEM="" Q
"RTN","SCRPTM",131,0)
 ..S NXT="H"
"RTN","SCRPTM",132,0)
 ..I NPAGE,(IOST'?1"C-".E) D NEWP^SCRPTM2(INST,TEM,TITL,.PAGE,.HEAD) S NPAGE=0
"RTN","SCRPTM",133,0)
 ..I NPAGE,(IOST?1"C-".E) D HOLD1^SCRPTM2(.PAGE,TITL,INST,TEM,.HEAD) S NPAGE=0
"RTN","SCRPTM",134,0)
 ..I STOP Q
"RTN","SCRPTM",135,0)
 ..I IOST'?1"C-".E,$Y>(IOSL-5) D NEWP^SCRPTM2(INST,TEM,TITL,.PAGE,.HEAD)
"RTN","SCRPTM",136,0)
 ..I IOST?1"C-".E,$Y>(IOSL-5) D HOLD1^SCRPTM2(.PAGE,TITL,INST,TEM,.HEAD)
"RTN","SCRPTM",137,0)
 ..I STOP Q
"RTN","SCRPTM",138,0)
 ..F  S NXT=$O(@STORE@(INST,TEM,NXT)) Q:NXT'?1"H".E!(STOP)  D
"RTN","SCRPTM",139,0)
 ...I 'HEAD W !,$G(@STORE@(INST,TEM,NXT)) S HEAD=0 ;writes team info
"RTN","SCRPTM",140,0)
 ..S (EPRACT,PRACT)=""
"RTN","SCRPTM",141,0)
 ..W ! ;extra line between members and practioner list
"RTN","SCRPTM",142,0)
 ..F  S EPRACT=$O(@STORE@("PN",INST,TEM,EPRACT)) Q:EPRACT=""!(STOP)  D
"RTN","SCRPTM",143,0)
 ...F  S PRACT=$O(@STORE@("PN",INST,TEM,EPRACT,PRACT)) Q:PRACT=""!(STOP)  D
"RTN","SCRPTM",144,0)
 ....I PRACT="" Q
"RTN","SCRPTM",145,0)
 ....S POS=""
"RTN","SCRPTM",146,0)
 ....F  S POS=$O(@STORE@("PN",INST,TEM,EPRACT,PRACT,POS)) Q:POS=""!(STOP)  D
"RTN","SCRPTM",147,0)
 .....D PRNTD(INST,TEM,PRACT,POS,TITL,.PAGE,.HEAD)
"RTN","SCRPTM",148,0)
 .....W ! ;seperated positions
"RTN","SCRPTM",149,0)
 ....W ! ;separates practitioners
"RTN","SCRPTM",150,0)
 .S NPAGE=1
"RTN","SCRPTM",151,0)
 I 'STOP,$E(IOST)="C" N DIR S DIR(0)="E" W ! D ^DIR
"RTN","SCRPTM",152,0)
 Q
"RTN","SCRPTM",153,0)
 ;
"RTN","SCRPTM",154,0)
PRNTD(INST,TEM,PRACT,POS,TITL,PAGE,HEAD) ;
"RTN","SCRPTM",155,0)
 ;
"RTN","SCRPTM",156,0)
 N CNT,SCAC
"RTN","SCRPTM",157,0)
 S CNT=""
"RTN","SCRPTM",158,0)
 I IOST'?1"C-".E,$Y>(IOSL-11) D NEWP^SCRPTM2(INST,TEM,TITL,.PAGE,.HEAD)
"RTN","SCRPTM",159,0)
 I IOST?1"C-".E,$Y>(IOSL-11) D HOLD1^SCRPTM2(.PAGE,TITL,INST,TEM,.HEAD)
"RTN","SCRPTM",160,0)
 I STOP Q
"RTN","SCRPTM",161,0)
 F  S CNT=$O(@STORE@(INST,TEM,PRACT,POS,CNT)) Q:CNT=""!(STOP)  D
"RTN","SCRPTM",162,0)
 .W !,$G(@STORE@(INST,TEM,PRACT,POS,CNT))
"RTN","SCRPTM",163,0)
 .S SCAC="" I CNT=4  D
"RTN","SCRPTM",164,0)
 ..F  S SCAC=$O(@STORE@(INST,TEM,PRACT,POS,4,SCAC)) Q:SCAC=""!(STOP)  D
"RTN","SCRPTM",165,0)
 ...W !,$G(@STORE@(INST,TEM,PRACT,POS,4,SCAC))
"RTN","SCRPTM",166,0)
 Q
"RTN","SCRPTM2")
0^18^B23722266^B21284139
"RTN","SCRPTM2",1,0)
SCRPTM2 ;ALB/CMM - List of Team's Members Report Continued;01/29/96 ; 29 Jun 99  04:11PM
"RTN","SCRPTM2",2,0)
 ;;5.3;Scheduling;**41,140,177,520**;AUG 13, 1993;Build 26
"RTN","SCRPTM2",3,0)
 ;
"RTN","SCRPTM2",4,0)
 ;List of Team's Members Report
"RTN","SCRPTM2",5,0)
 ;
"RTN","SCRPTM2",6,0)
PULL(TIEN,PLIST) ;
"RTN","SCRPTM2",7,0)
 ;TIEN - team file ien
"RTN","SCRPTM2",8,0)
 ;PLIST - array of positions and their practitioners
"RTN","SCRPTM2",9,0)
 ;
"RTN","SCRPTM2",10,0)
 N PNAME,TPIEN,ACT,INACT,RNAME,UNAME,CNT,NODE,TNODE,PCLIN,TNAME,SCI
"RTN","SCRPTM2",11,0)
 N TPHONE,TPC,INS,INAME,PRIEN,PRNAME,OPH,ROOM,SERV,TPNODE,PRCP,PCLASS
"RTN","SCRPTM2",12,0)
 ;
"RTN","SCRPTM2",13,0)
 S CNT=0
"RTN","SCRPTM2",14,0)
 F  S CNT=$O(@PLIST@(CNT)) Q:CNT=""!(CNT'?.N)  D
"RTN","SCRPTM2",15,0)
 .;get each practitioner/position
"RTN","SCRPTM2",16,0)
 .S NODE=$G(@PLIST@(CNT))
"RTN","SCRPTM2",17,0)
 .S TPIEN=+$P(NODE,"^",3) ;team position ien
"RTN","SCRPTM2",18,0)
 .S PNAME=$P(NODE,"^",4) ;position name
"RTN","SCRPTM2",19,0)
 .S ACT=$P(NODE,"^",9) ;active date (fm)
"RTN","SCRPTM2",20,0)
 .I ACT'=""&(ACT'=0) S ACT=$TR($$FMTE^XLFDT(ACT,"5DF")," ","0")
"RTN","SCRPTM2",21,0)
 .S INACT=$P(NODE,"^",10) ;inactive date (fm)
"RTN","SCRPTM2",22,0)
 .I INACT'=""&(INACT'=0) S INACT=$TR($$FMTE^XLFDT(INACT,"5DF")," ","0")
"RTN","SCRPTM2",23,0)
 .S RNAME=$P(NODE,"^",8) ;standard role name
"RTN","SCRPTM2",24,0)
 .S UNAME=$P(NODE,"^",6) ;user class name
"RTN","SCRPTM2",25,0)
 .S PRIEN=+$P(NODE,"^") ;practitioner ien
"RTN","SCRPTM2",26,0)
 .S PRNAME=$P(NODE,"^",2) ;practitioner name
"RTN","SCRPTM2",27,0)
 .;
"RTN","SCRPTM2",28,0)
 .;Get person class information
"RTN","SCRPTM2",29,0)
 .S PCLASS=$$GET^XUA4A72(PRIEN)
"RTN","SCRPTM2",30,0)
 .F SCI=1,2,3 S PCLASS(SCI)=$P(PCLASS,U,(SCI+1))
"RTN","SCRPTM2",31,0)
 .;
"RTN","SCRPTM2",32,0)
 .S TPNODE=$G(^SCTM(404.57,+TPIEN,0))
"RTN","SCRPTM2",33,0)
 .D SETASCL^SCRPRAC2(TPIEN,.PCLIN)
"RTN","SCRPTM2",34,0)
 .S PCLIN=$G(PCLIN(0))
"RTN","SCRPTM2",35,0)
 .;S PCLIN=+$P(TPNODE,"^",9) ;associated clinic ien
"RTN","SCRPTM2",36,0)
 .;S PCLIN=$P($G(^SC(PCLIN,0)),"^") ;associated clinic name
"RTN","SCRPTM2",37,0)
 .;
"RTN","SCRPTM2",38,0)
 .;Get preceptor
"RTN","SCRPTM2",39,0)
 .S PRCP=$P($$OKPREC2^SCMCLK(TPIEN,DT),U,2)
"RTN","SCRPTM2",40,0)
 .;
"RTN","SCRPTM2",41,0)
 .S TNODE=$G(^SCTM(404.51,TIEN,0)) ;team node
"RTN","SCRPTM2",42,0)
 .S TNAME=$P(TNODE,"^") ;team name
"RTN","SCRPTM2",43,0)
 .S TPHONE=$P(TNODE,"^",2) ;team phone
"RTN","SCRPTM2",44,0)
 .S TPC=$S($P(TNODE,"^",5)=1:"YES",1:"NO") ;primary care?
"RTN","SCRPTM2",45,0)
 .S INS=+$P(TNODE,"^",7) ;team division ien
"RTN","SCRPTM2",46,0)
 .S INAME=$P($G(^DIC(4,INS,0)),"^") ;team division name
"RTN","SCRPTM2",47,0)
 .D KTEAM(TNAME,TPHONE,TPC,INAME,TIEN,INS)
"RTN","SCRPTM2",48,0)
 .;
"RTN","SCRPTM2",49,0)
 .S OPH=$P($G(^VA(200,PRIEN,.13)),"^",2) ;office phone
"RTN","SCRPTM2",50,0)
 .S ROOM=$P($G(^VA(200,PRIEN,.14)),"^") ;room
"RTN","SCRPTM2",51,0)
 .S SERV=+$P($G(^VA(200,PRIEN,5)),"^") ;service/section ien
"RTN","SCRPTM2",52,0)
 .S SERV=$P($G(^DIC(49,SERV,0)),"^") ;service/section name
"RTN","SCRPTM2",53,0)
 .;
"RTN","SCRPTM2",54,0)
 .D FORMAT(PNAME,TPIEN,PCLIN,RNAME,UNAME,ACT,INACT,PRIEN,PRNAME,OPH,ROOM,SERV,INS,TIEN,PRCP,.PCLASS)
"RTN","SCRPTM2",55,0)
 .N SCAC
"RTN","SCRPTM2",56,0)
 .S SCAC=0
"RTN","SCRPTM2",57,0)
 .F  S SCAC=$O(PCLIN(SCAC)) Q:SCAC=""  D FORMATAC(INS,TIEN,PRIEN,TPIEN,PCLIN(SCAC))
"RTN","SCRPTM2",58,0)
 Q
"RTN","SCRPTM2",59,0)
 ;
"RTN","SCRPTM2",60,0)
KTEAM(TNAME,TPHONE,TPC,TDIV,TIEN,IEND) ;
"RTN","SCRPTM2",61,0)
 ;store team information
"RTN","SCRPTM2",62,0)
 I TDIV="" S TDIV="[BAD DATA]"
"RTN","SCRPTM2",63,0)
 I TNAME="" S TNAME="[BDA DATA]"
"RTN","SCRPTM2",64,0)
 S @STORE@("I",TDIV,IEND)=""
"RTN","SCRPTM2",65,0)
 S @STORE@("T",IEND,TNAME,TIEN)=""
"RTN","SCRPTM2",66,0)
 S @STORE@(IEND)="Division: "_TDIV
"RTN","SCRPTM2",67,0)
 S @STORE@(IEND,TIEN,"H1")="Team Name: "_TNAME
"RTN","SCRPTM2",68,0)
 S $E(@STORE@(IEND,TIEN,"H1"),40)="Team Phone: "_TPHONE
"RTN","SCRPTM2",69,0)
 S @STORE@(IEND,TIEN,"H2")="Primary Care Team: "_TPC
"RTN","SCRPTM2",70,0)
 S @STORE@(IEND,TIEN,"H3")=""
"RTN","SCRPTM2",71,0)
 S @STORE@(IEND,TIEN,"H4")="Members:"
"RTN","SCRPTM2",72,0)
 Q
"RTN","SCRPTM2",73,0)
 ;
"RTN","SCRPTM2",74,0)
FORMAT(POS,TPIEN,PCLIN,SPOS,UCLASS,BEG,END,PIEN,PRACT,OPH,ROOM,SERV,DIV,TEM,PRCP,PCLASS) ;
"RTN","SCRPTM2",75,0)
 ;POS - position name
"RTN","SCRPTM2",76,0)
 ;TPIEN - position ien
"RTN","SCRPTM2",77,0)
 ;PCLIN - associated clinic
"RTN","SCRPTM2",78,0)
 ;SPOS - standard  position
"RTN","SCRPTM2",79,0)
 ;UCLASS - user class
"RTN","SCRPTM2",80,0)
 ;BEG - begin date
"RTN","SCRPTM2",81,0)
 ;END - end date
"RTN","SCRPTM2",82,0)
 ;PIEN - ien of new person file
"RTN","SCRPTM2",83,0)
 ;PRACT - practitioner name
"RTN","SCRPTM2",84,0)
 ;OPH - office number
"RTN","SCRPTM2",85,0)
 ;ROOM - room
"RTN","SCRPTM2",86,0)
 ;SERV - service
"RTN","SCRPTM2",87,0)
 ;DIV - ien of division
"RTN","SCRPTM2",88,0)
 ;TEM - ien of team
"RTN","SCRPTM2",89,0)
 ;PRCP - preceptor
"RTN","SCRPTM2",90,0)
 ;PCLASS - person class
"RTN","SCRPTM2",91,0)
 ;
"RTN","SCRPTM2",92,0)
 N SCI
"RTN","SCRPTM2",93,0)
 I PRACT="" S PRACT="[BAD DATA]"
"RTN","SCRPTM2",94,0)
 S @STORE@("PN",DIV,TEM,PRACT,PIEN,TPIEN)=""
"RTN","SCRPTM2",95,0)
 S @STORE@(DIV,TEM,PIEN,TPIEN,1)=PRACT
"RTN","SCRPTM2",96,0)
 S $E(@STORE@(DIV,TEM,PIEN,TPIEN,1),35)="Position: "_POS
"RTN","SCRPTM2",97,0)
 S @STORE@(DIV,TEM,PIEN,TPIEN,2)="Standard Role: "_SPOS
"RTN","SCRPTM2",98,0)
 S @STORE@(DIV,TEM,PIEN,TPIEN,3)="User Class: "_UCLASS
"RTN","SCRPTM2",99,0)
 S @STORE@(DIV,TEM,PIEN,TPIEN,4)=SERV
"RTN","SCRPTM2",100,0)
 S $E(@STORE@(DIV,TEM,PIEN,TPIEN,4),35)="Assoc Clinic: "_PCLIN
"RTN","SCRPTM2",101,0)
 S @STORE@(DIV,TEM,PIEN,TPIEN,5)="Office Phone: "_OPH
"RTN","SCRPTM2",102,0)
 S $E(@STORE@(DIV,TEM,PIEN,TPIEN,5),35)="Room: "_ROOM
"RTN","SCRPTM2",103,0)
 S @STORE@(DIV,TEM,PIEN,TPIEN,6)="Begin Date: "_BEG
"RTN","SCRPTM2",104,0)
 S $E(@STORE@(DIV,TEM,PIEN,TPIEN,6),35)="End Date: "_END
"RTN","SCRPTM2",105,0)
 S SCI=7
"RTN","SCRPTM2",106,0)
 I $L(PRCP) S @STORE@(DIV,TEM,PIEN,TPIEN,SCI)="Preceptor: "_PRCP,SCI=8
"RTN","SCRPTM2",107,0)
 I $L(PCLASS(1)) S @STORE@(DIV,TEM,PIEN,TPIEN,SCI)="Person Class: "_PCLASS(1),SCI=SCI+1
"RTN","SCRPTM2",108,0)
 I $L(PCLASS(2)) S @STORE@(DIV,TEM,PIEN,TPIEN,SCI)="                 "_PCLASS(2),SCI=SCI+1
"RTN","SCRPTM2",109,0)
 I $L(PCLASS(3)) S @STORE@(DIV,TEM,PIEN,TPIEN,SCI)="                    "_PCLASS(3)
"RTN","SCRPTM2",110,0)
 Q
"RTN","SCRPTM2",111,0)
 ;
"RTN","SCRPTM2",112,0)
FORMATAC(DIV,TEM,PIEN,TPIEN,PCLIN) ;
"RTN","SCRPTM2",113,0)
 S $E(@STORE@(DIV,TEM,PIEN,TPIEN,4,SCAC),49)=$E(PCLIN,1,30)
"RTN","SCRPTM2",114,0)
 Q
"RTN","SCRPTM2",115,0)
 ;
"RTN","SCRPTM2",116,0)
NEWP(INST,TEM,TITL,PAGE,HEAD) ;
"RTN","SCRPTM2",117,0)
 ;new page
"RTN","SCRPTM2",118,0)
 D NEWP1^SCRPU3(.PAGE,TITL)
"RTN","SCRPTM2",119,0)
 D HEAD1(INST,TEM,.HEAD)
"RTN","SCRPTM2",120,0)
 Q
"RTN","SCRPTM2",121,0)
 ;
"RTN","SCRPTM2",122,0)
HEAD1(INST,TEM,HEAD) ;
"RTN","SCRPTM2",123,0)
 ;write headings
"RTN","SCRPTM2",124,0)
 W !,$G(@STORE@(INST))
"RTN","SCRPTM2",125,0)
 N NXT
"RTN","SCRPTM2",126,0)
 S NXT="H"
"RTN","SCRPTM2",127,0)
 F  S NXT=$O(@STORE@(INST,TEM,NXT)) Q:NXT'?1"H".E  D
"RTN","SCRPTM2",128,0)
 .W !,$G(@STORE@(INST,TEM,NXT))
"RTN","SCRPTM2",129,0)
 W ! ;extra line between MEMBERS and practitioner list
"RTN","SCRPTM2",130,0)
 S HEAD=1
"RTN","SCRPTM2",131,0)
 Q
"RTN","SCRPTM2",132,0)
HOLD1(PAGE,TITL,INST,TEM,HEAD) ;
"RTN","SCRPTM2",133,0)
 ;device is home, reached end of page
"RTN","SCRPTM2",134,0)
 D HOLD^SCRPU3(.PAGE,TITL)
"RTN","SCRPTM2",135,0)
 I STOP Q
"RTN","SCRPTM2",136,0)
 D HEAD1(INST,TEM,.HEAD)
"RTN","SCRPTM2",137,0)
 Q
"RTN","SCRPTP")
0^19^B37396149^B26905186
"RTN","SCRPTP",1,0)
SCRPTP ;ALB/CMM - List of Team's Patients ; 29 Jun 99  04:11PM
"RTN","SCRPTP",2,0)
 ;;5.3;Scheduling;**41,48,174,177,526,520**;AUG 13, 1993;Build 26
"RTN","SCRPTP",3,0)
 ;
"RTN","SCRPTP",4,0)
PROMPTS ;Prompt for Institution, Team, Role, Patient Status and Print device
"RTN","SCRPTP",5,0)
 N QTIME,PRNT,VAUTD,VAUTT,VAUTR,VAUTPS,NUMBER
"RTN","SCRPTP",6,0)
 K SCUP
"RTN","SCRPTP",7,0)
 S QTIME=""
"RTN","SCRPTP",8,0)
 W ! D INST^SCRPU1 I Y=-1 G ERR
"RTN","SCRPTP",9,0)
 W ! K Y D PRMTT^SCRPU1 I '$D(VAUTT) G ERR
"RTN","SCRPTP",10,0)
 W ! K Y D ROLE^SCRPU1 I '$D(VAUTR) G ERR
"RTN","SCRPTP",11,0)
 W ! K Y D PTSTAT^SCRPU2 I '$D(VAUTPS) G ERR
"RTN","SCRPTP",12,0)
 W ! K Y S SORT=$$SORT2^SCRPU2()
"RTN","SCRPTP",13,0)
 I SORT<1 G ERR
"RTN","SCRPTP",14,0)
 W !!,"This report requires 132 column output!"
"RTN","SCRPTP",15,0)
 D QUE(.VAUTD,.VAUTT,.VAUTR,VAUTPS,SORT) Q
"RTN","SCRPTP",16,0)
 ;
"RTN","SCRPTP",17,0)
QUE(INST,TEAM,ROLE,PSTAT,SORT,IOP,ZTDTH) ;queue report
"RTN","SCRPTP",18,0)
 ;INST - institutions selected (variable and array) 
"RTN","SCRPTP",19,0)
 ;TEAM - teams selected (variable and array) 
"RTN","SCRPTP",20,0)
 ;ROLE - roles selected (variable and array) 
"RTN","SCRPTP",21,0)
 ;PSTAT - patient status - 1=all or OPT or AC 
"RTN","SCRPTP",22,0)
 ;SORT - 1=d,t,ptname 2=d,t,Pt ID 3=d,t,pract,pt name 4=d,t,pract,Pt ID
"RTN","SCRPTP",23,0)
 N ZTSAVE,II
"RTN","SCRPTP",24,0)
 F II="INST","TEAM","ROLE","ROLE(","SORT","PSTAT","INST(","TEAM(" S ZTSAVE(II)=""
"RTN","SCRPTP",25,0)
 W ! D EN^XUTMDEVQ("QENTRY^SCRPTP","Team Patient Listing",.ZTSAVE)
"RTN","SCRPTP",26,0)
 Q
"RTN","SCRPTP",27,0)
 ;
"RTN","SCRPTP",28,0)
ENTRY2(INST,TEAM,ROLE,PSTAT,SORT,IOP,ZTDTH) ;Second entry point for GUI to use
"RTN","SCRPTP",29,0)
 ;INST - institutions selected (variable and array)
"RTN","SCRPTP",30,0)
 ;TEAM - teams selected (variable and array)
"RTN","SCRPTP",31,0)
 ;ROLE - roles selected (variable and array)
"RTN","SCRPTP",32,0)
 ;PSTAT - patient status - 1=all or OPT or AC
"RTN","SCRPTP",33,0)
 ;SORT - 1=d,t,ptname 2=d,t,Pt ID 3=d,t,pract,pt name 4=d,t,pract,Pt ID
"RTN","SCRPTP",34,0)
 ;IOP - print device
"RTN","SCRPTP",35,0)
 ;ZTDTH - queue time (optional)
"RTN","SCRPTP",36,0)
 ;
"RTN","SCRPTP",37,0)
 ;validate parameters
"RTN","SCRPTP",38,0)
 I '$D(INST)!'$D(TEAM)!'$D(ROLE)!'$D(PSTAT)!'$D(SORT)!'$D(IOP)!(IOP="") Q
"RTN","SCRPTP",39,0)
 N NUMBER
"RTN","SCRPTP",40,0)
 S IOST=$P(IOP,"^",2),IOP=$P(IOP,"^")
"RTN","SCRPTP",41,0)
 I IOP?1"Q;".E S IOP=$P(IOP,"Q;",2)
"RTN","SCRPTP",42,0)
 I IOST?1"C-".E D QENTRY G RET
"RTN","SCRPTP",43,0)
 I ZTDTH="" S ZTDTH=$H
"RTN","SCRPTP",44,0)
 S ZTRTN="QENTRY^SCRPTP"
"RTN","SCRPTP",45,0)
 S ZTDESC="List of Team's Patients",ZTIO=IOP
"RTN","SCRPTP",46,0)
 N II
"RTN","SCRPTP",47,0)
 F II="INST","TEAM","ROLE","ROLE(","SORT","PSTAT","INST(","TEAM(","IOP" S ZTSAVE(II)=""
"RTN","SCRPTP",48,0)
 D ^%ZTLOAD
"RTN","SCRPTP",49,0)
RET S NUMBER=0
"RTN","SCRPTP",50,0)
 I $D(ZTSK) S NUMBER=ZTSK
"RTN","SCRPTP",51,0)
 D EXIT1
"RTN","SCRPTP",52,0)
 Q NUMBER
"RTN","SCRPTP",53,0)
 ;
"RTN","SCRPTP",54,0)
QENTRY ;driver entry point
"RTN","SCRPTP",55,0)
 S TITL="Team Patient Listing",STORE="^TMP("_$J_",""SCRPTP"")"
"RTN","SCRPTP",56,0)
 K @STORE
"RTN","SCRPTP",57,0)
 S @STORE=0
"RTN","SCRPTP",58,0)
 D FIND
"RTN","SCRPTP",59,0)
 I $O(@STORE@(0))="" S NODATA=$$NODATA^SCRPU3(TITL)
"RTN","SCRPTP",60,0)
 I '$D(NODATA) D PRINTIT^SCRPTP2(STORE,TITL)
"RTN","SCRPTP",61,0)
 D EXIT2
"RTN","SCRPTP",62,0)
 Q
"RTN","SCRPTP",63,0)
ERR ;
"RTN","SCRPTP",64,0)
EXIT1 ;
"RTN","SCRPTP",65,0)
 K ZTDTH,ZTRTN,ZTDESC,ZTSK,ZTIO,ZTSAVE,SCUP
"RTN","SCRPTP",66,0)
 Q
"RTN","SCRPTP",67,0)
EXIT2 ;
"RTN","SCRPTP",68,0)
 K @STORE
"RTN","SCRPTP",69,0)
 K STOP,STORE,TITL,IOP,TEAM,INST,ROLE,PSTAT,SORT,NODATA
"RTN","SCRPTP",70,0)
 Q
"RTN","SCRPTP",71,0)
FIND ;
"RTN","SCRPTP",72,0)
 N TIEN,ERR,LIST,OKAY
"RTN","SCRPTP",73,0)
 I TEAM=1 D TALL^SCRPPAT3 ;gets all teams for all divisions selected
"RTN","SCRPTP",74,0)
 S TIEN="",LIST="^TMP("_$J_",""SCRPTP ARRAY"")",ERR="ERROR"
"RTN","SCRPTP",75,0)
 K @LIST,@ERR
"RTN","SCRPTP",76,0)
 F  S TIEN=$O(TEAM(TIEN)) Q:TIEN=""  D
"RTN","SCRPTP",77,0)
 .;TIEN - team ien
"RTN","SCRPTP",78,0)
 .S OKAY=$$PTTM^SCAPMC2(TIEN,"",LIST,ERR)
"RTN","SCRPTP",79,0)
 .; gets all patients for given team
"RTN","SCRPTP",80,0)
 .D HITS^SCRPTP3(LIST,TIEN)
"RTN","SCRPTP",81,0)
 .K @LIST,@ERR
"RTN","SCRPTP",82,0)
 K @LIST,@ERR
"RTN","SCRPTP",83,0)
 Q
"RTN","SCRPTP",84,0)
TINF(TIEN) ;team information
"RTN","SCRPTP",85,0)
 ;TIEN - team ien
"RTN","SCRPTP",86,0)
 ;returns: institution ien ^ team name ^ primary care ^ team phone
"RTN","SCRPTP",87,0)
 N PC,PHONE,TNODE,TNAME
"RTN","SCRPTP",88,0)
 S TNODE=$G(^SCTM(404.51,TIEN,0))
"RTN","SCRPTP",89,0)
 S TNAME=$P(TNODE,"^") ;team name
"RTN","SCRPTP",90,0)
 S PC=$S($P(TNODE,"^",5)=1:"YES",1:"NO") ;primary care team
"RTN","SCRPTP",91,0)
 S PHONE=$P(TNODE,"^",2) ;team phone
"RTN","SCRPTP",92,0)
 S INS=+$P(TNODE,"^",7) ;institution ien
"RTN","SCRPTP",93,0)
 D TDESC^SCRPITP2(TIEN,INS) ;gets team description
"RTN","SCRPTP",94,0)
 Q INS_"^"_TNAME_"^"_PC_"^"_PHONE
"RTN","SCRPTP",95,0)
 ;
"RTN","SCRPTP",96,0)
PST(PTIEN,CLIEN) ;
"RTN","SCRPTP",97,0)
 ;PTIEN - patient ien
"RTN","SCRPTP",98,0)
 ;CLIEN - associated clinic ien
"RTN","SCRPTP",99,0)
 ;returns 1=selected patient status, 0=not selected patient status
"RTN","SCRPTP",100,0)
 ;
"RTN","SCRPTP",101,0)
 N EN,NXT,FOUND,ENODE
"RTN","SCRPTP",102,0)
 S EN="",(FOUND,NXT)=0
"RTN","SCRPTP",103,0)
 Q:'$D(^DPT(PTIEN,"DE","B",CLIEN)) FOUND
"RTN","SCRPTP",104,0)
 S EN=$O(^DPT(PTIEN,"DE","B",CLIEN,""))
"RTN","SCRPTP",105,0)
 I EN=""&(PSTAT=1) S FOUND=1 Q FOUND
"RTN","SCRPTP",106,0)
 Q:EN=""!'$D(^DPT(PTIEN,"DE",EN,1)) FOUND
"RTN","SCRPTP",107,0)
 F  S NXT=$O(^DPT(PTIEN,"DE",EN,1,NXT)) Q:(FOUND)!(NXT="")!(NXT'?.N)  D
"RTN","SCRPTP",108,0)
 .;check if active enrollment
"RTN","SCRPTP",109,0)
 .S ENODE=$G(^DPT(PTIEN,"DE",EN,1,NXT,0))
"RTN","SCRPTP",110,0)
 .I $P(ENODE,"^",3)'="",$P(ENODE,"^",3)<DT+1!$P(ENODE,"^")>DT Q  ;not active enrollment
"RTN","SCRPTP",111,0)
 .;                      ^ discharge date     ^ enrollment date
"RTN","SCRPTP",112,0)
 .Q:$P(ENODE,"^",2)'=$E(PSTAT,1)&(PSTAT'=1)  ;not selected patient status
"RTN","SCRPTP",113,0)
 .S FOUND=1
"RTN","SCRPTP",114,0)
 Q FOUND
"RTN","SCRPTP",115,0)
 ;
"RTN","SCRPTP",116,0)
FORMAT(INS,TIEN,PTIEN,PTNAME,PID,PIEN,PNAME,CNAME,PINF,ROLN,PCAP) ;Format column information
"RTN","SCRPTP",117,0)
 ;INS - Institution ien
"RTN","SCRPTP",118,0)
 ;TIEN - team ien
"RTN","SCRPTP",119,0)
 ;PTIEN - patient ien
"RTN","SCRPTP",120,0)
 ;PTNAME - patient name
"RTN","SCRPTP",121,0)
 ;PID - SSN
"RTN","SCRPTP",122,0)
 ;PIEN - practitioner ien
"RTN","SCRPTP",123,0)
 ;PNAME - practitioner name
"RTN","SCRPTP",124,0)
 ;CNAME - clinic name
"RTN","SCRPTP",125,0)
 ;LAST - last appointment
"RTN","SCRPTP",126,0)
 ;NEXT - next appointment
"RTN","SCRPTP",127,0)
 ;ROLN - role name
"RTN","SCRPTP",128,0)
 ;PCAP - PC?
"RTN","SCRPTP",129,0)
 ;
"RTN","SCRPTP",130,0)
 N SEC,TRD
"RTN","SCRPTP",131,0)
 I PNAME="" S PNAME="[BAD DATA]"
"RTN","SCRPTP",132,0)
 I PTNAME="" S PTNAME="[BAD DATA]"
"RTN","SCRPTP",133,0)
 I PID="" S PID="*********"
"RTN","SCRPTP",134,0)
 S @STORE@("P",INS,TIEN,PNAME,PIEN)="" ;practitioner
"RTN","SCRPTP",135,0)
 S @STORE@("PT",INS,TIEN,PTNAME,PTIEN)="" ;patient
"RTN","SCRPTP",136,0)
 S @STORE@("PID",INS,TIEN,PID,PTIEN)=""
"RTN","SCRPTP",137,0)
 I (SORT=1)!(SORT=2) S SEC=PTIEN,TRD=PIEN ;sort doesn't include practitioner
"RTN","SCRPTP",138,0)
 I (SORT=3)!(SORT=4) S SEC=PIEN,TRD=PTIEN ;sort includes practitioner
"RTN","SCRPTP",139,0)
 S @STORE@(INS,TIEN,SEC,TRD)=$E(PTNAME,1,15) ;patient name
"RTN","SCRPTP",140,0)
 S $E(@STORE@(INS,TIEN,SEC,TRD),18)=PID ;9 digit pid
"RTN","SCRPTP",141,0)
 S $E(@STORE@(INS,TIEN,SEC,TRD),32)=$E(PNAME,1,22) ;practitioner name
"RTN","SCRPTP",142,0)
 S $E(@STORE@(INS,TIEN,SEC,TRD),56)=$E($G(ROLN),1,22) ;role name
"RTN","SCRPTP",143,0)
 S $E(@STORE@(INS,TIEN,SEC,TRD),80)=$G(PCAP) ;PC?
"RTN","SCRPTP",144,0)
 S $E(@STORE@(INS,TIEN,SEC,TRD),85)=$P(PINF,"^",8) ;last appointment
"RTN","SCRPTP",145,0)
 S $E(@STORE@(INS,TIEN,SEC,TRD),97)=$P(PINF,"^",9) ;next appointment
"RTN","SCRPTP",146,0)
 S $E(@STORE@(INS,TIEN,SEC,TRD),109)=$E(CNAME,1,24) ;clinic name
"RTN","SCRPTP",147,0)
 Q
"RTN","SCRPTP",148,0)
FORMATAC(SCCNT,CNAME,PINF,INS,TIEN,PTIEN,PTNAME,PID,PIEN,PNAME,ROLN,PCAP) ;Format MULTIPLES
"RTN","SCRPTP",149,0)
 ;INS - Institution ien
"RTN","SCRPTP",150,0)
 ;TIEN - team ien
"RTN","SCRPTP",151,0)
 ;PTIEN - patient ien
"RTN","SCRPTP",152,0)
 ;PTNAME - patient name
"RTN","SCRPTP",153,0)
 ;PID - last 4 PID - includes pseudo notation as 5th
"RTN","SCRPTP",154,0)
 ;PIEN - practitioner ien
"RTN","SCRPTP",155,0)
 ;PNAME - practitioner name
"RTN","SCRPTP",156,0)
 ;CNAME - clinic name
"RTN","SCRPTP",157,0)
 ;LAST - last appointment
"RTN","SCRPTP",158,0)
 ;NEXT - next appointment
"RTN","SCRPTP",159,0)
 ;ROLN - role name
"RTN","SCRPTP",160,0)
 ;PCAP - PC?
"RTN","SCRPTP",161,0)
 ;
"RTN","SCRPTP",162,0)
 N SEC,TRD
"RTN","SCRPTP",163,0)
 I PNAME="" S PNAME="[BAD DATA]"
"RTN","SCRPTP",164,0)
 I PTNAME="" S PTNAME="[BAD DATA]"
"RTN","SCRPTP",165,0)
 I PID="" S PID="****"
"RTN","SCRPTP",166,0)
 S @STORE@("P",INS,TIEN,PNAME,PIEN)="" ;practitioner
"RTN","SCRPTP",167,0)
 S @STORE@("PT",INS,TIEN,PTNAME,PTIEN)="" ;patient
"RTN","SCRPTP",168,0)
 S @STORE@("PID",INS,TIEN,PID,PTIEN)="" ;last 4 pid
"RTN","SCRPTP",169,0)
 N TRD
"RTN","SCRPTP",170,0)
 I (SORT=1)!(SORT=2) S SEC=PTIEN,TRD=PIEN ;sort doesn't include practitioner
"RTN","SCRPTP",171,0)
 I (SORT=3)!(SORT=4) S SEC=PIEN,TRD=PTIEN ;sort includes practitioner
"RTN","SCRPTP",172,0)
 I '$D(@STORE@(INS,TIEN,SEC,TRD,SCCNT))  D
"RTN","SCRPTP",173,0)
 .S $E(@STORE@(INS,TIEN,SEC,TRD,SCCNT),85)=$P(PINF,"^",8) ;last appointment
"RTN","SCRPTP",174,0)
 .S $E(@STORE@(INS,TIEN,SEC,TRD,SCCNT),97)=$P(PINF,"^",9) ;next appointment
"RTN","SCRPTP",175,0)
 .S $E(@STORE@(INS,TIEN,SEC,TRD,SCCNT),109)=$E(CNAME,1,24) ;clinic name
"RTN","SCRPTP",176,0)
 .Q
"RTN","SCRPTP",177,0)
 Q
"RTN","SCRPTP2")
0^20^B34599932^B31636644
"RTN","SCRPTP2",1,0)
SCRPTP2 ;ALB/CMM - List of Team's Patients ; 29 Jun 99  04:11PM
"RTN","SCRPTP2",2,0)
 ;;5.3;Scheduling;**41,53,52,174,177,231,526,520**;AUG 13, 1993;Build 26
"RTN","SCRPTP2",3,0)
 ;
"RTN","SCRPTP2",4,0)
 ;List of Team's Patients Report
"RTN","SCRPTP2",5,0)
 ;
"RTN","SCRPTP2",6,0)
TFORMAT(INST,INAME,TIEN,TNAME,PHONE,PC) ; Format team information
"RTN","SCRPTP2",7,0)
 ;INST - institution ien
"RTN","SCRPTP2",8,0)
 ;INAME - institution name
"RTN","SCRPTP2",9,0)
 ;TIEN - team ien
"RTN","SCRPTP2",10,0)
 ;TNAME - team name
"RTN","SCRPTP2",11,0)
 ;PHONE - team phone
"RTN","SCRPTP2",12,0)
 ;PC - primary care team (yes/no)
"RTN","SCRPTP2",13,0)
 ;
"RTN","SCRPTP2",14,0)
 I INAME="" S INAME="[BAD DATA]"
"RTN","SCRPTP2",15,0)
 I TNAME="" S TNAME="[BAD DATA]"
"RTN","SCRPTP2",16,0)
 S @STORE@("I",INAME,INST)=""
"RTN","SCRPTP2",17,0)
 S @STORE@("T",INST,TNAME,TIEN)=""
"RTN","SCRPTP2",18,0)
 S @STORE@(INST)="Division: "_INAME
"RTN","SCRPTP2",19,0)
 S @STORE@(INST,TIEN)="Team: "_TNAME
"RTN","SCRPTP2",20,0)
 S $E(@STORE@(INST,TIEN),45)="Team Phone: "_PHONE
"RTN","SCRPTP2",21,0)
 S @STORE@(INST,TIEN,1)="Primary Care Team: "_PC
"RTN","SCRPTP2",22,0)
 Q
"RTN","SCRPTP2",23,0)
 ;
"RTN","SCRPTP2",24,0)
PRINTIT(STORE,TITL) ;
"RTN","SCRPTP2",25,0)
 N INST,INAME,TNAME,TIEN
"RTN","SCRPTP2",26,0)
 S (NEW,PAGE)=1,STOP=0 W:$E(IOST)="C" @IOF
"RTN","SCRPTP2",27,0)
 D TITLE^SCRPU3(.PAGE,TITL,132) ;write title
"RTN","SCRPTP2",28,0)
 D SETH
"RTN","SCRPTP2",29,0)
 ;
"RTN","SCRPTP2",30,0)
 S INAME=""
"RTN","SCRPTP2",31,0)
 F  S INAME=$O(@STORE@("I",INAME)) Q:INAME=""!(STOP)  D
"RTN","SCRPTP2",32,0)
 .S INST=$O(@STORE@("I",INAME,""))
"RTN","SCRPTP2",33,0)
 .Q:INST=""
"RTN","SCRPTP2",34,0)
 .I ('NEW)&(IOST'?1"C-".E) D NEWP1^SCRPU3(.PAGE,TITL,132)
"RTN","SCRPTP2",35,0)
 .I ('NEW)&(IOST?1"C-".E) D HOLD^SCRPU3(.PAGE,TITL,132)
"RTN","SCRPTP2",36,0)
 .Q:STOP
"RTN","SCRPTP2",37,0)
 .W !,$G(@STORE@(INST)) ;write institution
"RTN","SCRPTP2",38,0)
 .S TNAME=""
"RTN","SCRPTP2",39,0)
 .F  S TNAME=$O(@STORE@("T",INST,TNAME)) Q:TNAME=""!(STOP)  D
"RTN","SCRPTP2",40,0)
 ..S TIEN=$O(@STORE@("T",INST,TNAME,""))
"RTN","SCRPTP2",41,0)
 ..Q:TIEN=""
"RTN","SCRPTP2",42,0)
 ..D TPRINT(INST,TIEN) ;writes team info
"RTN","SCRPTP2",43,0)
 ..Q:STOP
"RTN","SCRPTP2",44,0)
 ..;
"RTN","SCRPTP2",45,0)
 ..I (IOST'?1"C-".E)&($Y>(IOSL-4)) D NEWP1^SCRPU3(.PAGE,TITL,132)
"RTN","SCRPTP2",46,0)
 ..I (IOST?1"C-".E)&($Y>(IOSL-4)) D HOLD^SCRPU3(.PAGE,TITL,132)
"RTN","SCRPTP2",47,0)
 ..Q:STOP
"RTN","SCRPTP2",48,0)
 ..D HEADER
"RTN","SCRPTP2",49,0)
 ..I (SORT=3)!(SORT=4) D PRACT(INST,TIEN,.NEW)
"RTN","SCRPTP2",50,0)
 ..I (SORT=1)!(SORT=2) D PTP(INST,TIEN,.NEW)
"RTN","SCRPTP2",51,0)
 K NEW,PAGE
"RTN","SCRPTP2",52,0)
 I 'STOP,$E(IOST)="C" N DIR S DIR(0)="E" W ! D ^DIR
"RTN","SCRPTP2",53,0)
 Q
"RTN","SCRPTP2",54,0)
 ;
"RTN","SCRPTP2",55,0)
PRACT(INST,TIEN,NEW) ;Print by practitioner/patient
"RTN","SCRPTP2",56,0)
 N PNAME,PIEN,SEC2,ST1,TRD,TRDI
"RTN","SCRPTP2",57,0)
 S PNAME="",PIEN=""
"RTN","SCRPTP2",58,0)
 F  S PNAME=$O(@STORE@("P",INST,TIEN,PNAME)) Q:PNAME=""!(STOP)  D
"RTN","SCRPTP2",59,0)
 . F  S PIEN=$O(@STORE@("P",INST,TIEN,PNAME,PIEN)) Q:PIEN=""!(STOP)  D
"RTN","SCRPTP2",60,0)
 . . I (SORT=1)!(SORT=3) S SEC2="""PT""" ;sort by patient name
"RTN","SCRPTP2",61,0)
 . . I (SORT=2)!(SORT=4) S SEC2="""PID""" ;sort by last 4 PID
"RTN","SCRPTP2",62,0)
 . . S ST1=$E(STORE,1,$L(STORE)-1)_","_SEC2_")"
"RTN","SCRPTP2",63,0)
 . . I (IOST'?1"C-".E)&($Y>(IOSL-4)) D NEWP1^SCRPU3(.PAGE,TITL,132) D:'STOP HEADER
"RTN","SCRPTP2",64,0)
 . . Q:STOP
"RTN","SCRPTP2",65,0)
 . . I (IOST?1"C-".E)&($Y>(IOSL-4)) D HOLD^SCRPU3(.PAGE,TITL,132) D:'STOP HEADER
"RTN","SCRPTP2",66,0)
 . . Q:STOP
"RTN","SCRPTP2",67,0)
 . . S (TRDI,TRD)=""
"RTN","SCRPTP2",68,0)
 . . F  S TRD=$O(@ST1@(INST,TIEN,TRD)) Q:TRD=""!(STOP)  D
"RTN","SCRPTP2",69,0)
 . . . F  S TRDI=$O(@ST1@(INST,TIEN,TRD,TRDI)) Q:TRDI=""!(STOP)  D
"RTN","SCRPTP2",70,0)
 . . . . I (IOST'?1"C-".E)&($Y>(IOSL-4)) D NEWP1^SCRPU3(.PAGE,TITL,132) D:'STOP HEADER
"RTN","SCRPTP2",71,0)
 . . . . Q:STOP
"RTN","SCRPTP2",72,0)
 . . . . I (IOST?1"C-".E)&($Y>(IOSL-4)) D HOLD^SCRPU3(.PAGE,TITL,132) D:'STOP HEADER
"RTN","SCRPTP2",73,0)
 . . . . Q:STOP
"RTN","SCRPTP2",74,0)
 . . . . I $D(@STORE@(INST,TIEN,PIEN,TRDI)) W !,$G(@STORE@(INST,TIEN,PIEN,TRDI)) ;write column data
"RTN","SCRPTP2",75,0)
 . . . . N SCACL
"RTN","SCRPTP2",76,0)
 . . . . S SCACL="" F  S SCACL=$O(@STORE@(INST,TIEN,PIEN,TRDI,SCACL)) Q:SCACL=""  D
"RTN","SCRPTP2",77,0)
 . . . . . W !,$G(@STORE@(INST,TIEN,PIEN,TRDI,SCACL))
"RTN","SCRPTP2",78,0)
 . S NEW=0
"RTN","SCRPTP2",79,0)
 Q
"RTN","SCRPTP2",80,0)
 ;
"RTN","SCRPTP2",81,0)
PTP(INST,TIEN,NEW) ;Print by patient/practitioner
"RTN","SCRPTP2",82,0)
 N SEC2,ST1,TRDI,TRD,PNAME,PIEN
"RTN","SCRPTP2",83,0)
 I (SORT=1)!(SORT=3) S SEC2="""PT""" ;sort by patient name
"RTN","SCRPTP2",84,0)
 I (SORT=2)!(SORT=4) S SEC2="""PID""" ;sort by last 4 PID
"RTN","SCRPTP2",85,0)
 S ST1=$E(STORE,1,$L(STORE)-1)_","_SEC2_")"
"RTN","SCRPTP2",86,0)
 I (IOST'?1"C-".E)&($Y>(IOSL-4)) D NEWP1^SCRPU3(.PAGE,TITL,132)
"RTN","SCRPTP2",87,0)
 I (IOST?1"C-".E)&($Y>(IOSL-4)) D HOLD^SCRPU3(.PAGE,TITL,132)
"RTN","SCRPTP2",88,0)
 Q:STOP
"RTN","SCRPTP2",89,0)
 S (TRDI,TRD)=""
"RTN","SCRPTP2",90,0)
 F  S TRD=$O(@ST1@(INST,TIEN,TRD)) Q:TRD=""!(STOP)  D
"RTN","SCRPTP2",91,0)
 . F  S TRDI=$O(@ST1@(INST,TIEN,TRD,TRDI)) Q:TRDI=""!(STOP)  D
"RTN","SCRPTP2",92,0)
 . . I (IOST'?1"C-".E)&($Y>(IOSL-4)) D NEWP1^SCRPU3(.PAGE,TITL,132) D:'STOP HEADER
"RTN","SCRPTP2",93,0)
 . . Q:STOP
"RTN","SCRPTP2",94,0)
 . . I (IOST?1"C-".E)&($Y>(IOSL-4)) D HOLD^SCRPU3(.PAGE,TITL,132) D:'STOP HEADER
"RTN","SCRPTP2",95,0)
 . . Q:STOP
"RTN","SCRPTP2",96,0)
 . . S PNAME="",PIEN=""
"RTN","SCRPTP2",97,0)
 . . F  S PNAME=$O(@STORE@("P",INST,TIEN,PNAME)) Q:PNAME=""!(STOP)!(PIEN=0)  D
"RTN","SCRPTP2",98,0)
 . . . F  S PIEN=$O(@STORE@("P",INST,TIEN,PNAME,PIEN)) Q:PIEN=""!(STOP)  D
"RTN","SCRPTP2",99,0)
 . . . . I (IOST'?1"C-".E)&($Y>(IOSL-4)) D NEWP1^SCRPU3(.PAGE,TITL,132) D:'STOP HEADER
"RTN","SCRPTP2",100,0)
 . . . . Q:STOP
"RTN","SCRPTP2",101,0)
 . . . . I (IOST?1"C-".E)&($Y>(IOSL-4)) D HOLD^SCRPU3(.PAGE,TITL,132) D:'STOP HEADER
"RTN","SCRPTP2",102,0)
 . . . . Q:STOP
"RTN","SCRPTP2",103,0)
 . . . . I $D(@STORE@(INST,TIEN,TRDI,PIEN)) W !,$G(@STORE@(INST,TIEN,TRDI,PIEN)) ;write column data
"RTN","SCRPTP2",104,0)
 . . . . N SCACL
"RTN","SCRPTP2",105,0)
 . . . . S SCACL="" F  S SCACL=$O(@STORE@(INST,TIEN,TRDI,PIEN,SCACL)) Q:SCACL=""  D
"RTN","SCRPTP2",106,0)
 . . . . . W !,$G(@STORE@(INST,TIEN,TRDI,PIEN,SCACL))
"RTN","SCRPTP2",107,0)
 . S NEW=0
"RTN","SCRPTP2",108,0)
 Q
"RTN","SCRPTP2",109,0)
 ;
"RTN","SCRPTP2",110,0)
TPRINT(INST,TIEN) ;
"RTN","SCRPTP2",111,0)
 ;prints team data
"RTN","SCRPTP2",112,0)
 N NXT
"RTN","SCRPTP2",113,0)
 I (IOST'?1"C-".E)&($Y>(IOSL-13)) D NEWP1^SCRPU3(.PAGE,TITL,132) W:'STOP !,$G(@STORE@(INST))
"RTN","SCRPTP2",114,0)
 I (IOST?1"C-".E)&($Y>(IOSL-13)) D HOLD^SCRPU3(.PAGE,TITL,132) W:'STOP !,$G(@STORE@(INST))
"RTN","SCRPTP2",115,0)
 Q:STOP
"RTN","SCRPTP2",116,0)
 W !!,$G(@STORE@(INST,TIEN))
"RTN","SCRPTP2",117,0)
 S NXT=0
"RTN","SCRPTP2",118,0)
 W !,$G(@STORE@(INST,TIEN,1)) ;write team info
"RTN","SCRPTP2",119,0)
 Q:'$D(@STORE@(INST,TIEN,"D"))  W !
"RTN","SCRPTP2",120,0)
 S NXT=""
"RTN","SCRPTP2",121,0)
 ;write team description
"RTN","SCRPTP2",122,0)
 F  S NXT=$O(@STORE@(INST,TIEN,"D",NXT)) Q:NXT=""!(STOP)  D
"RTN","SCRPTP2",123,0)
 .I (IOST'?1"C-".E)&$Y>(IOSL-13) D NEWP1^SCRPU3(.PAGE,TITL,132) W:'STOP !,$G(@STORE@(INST))
"RTN","SCRPTP2",124,0)
 .I (IOST?1"C-".E)&$Y>(IOSL-13) D HOLD^SCRPU3(.PAGE,TITL,132) W:'STOP !,$G(@STORE@(INST))
"RTN","SCRPTP2",125,0)
 .Q:STOP
"RTN","SCRPTP2",126,0)
 .W !,$G(@STORE@(INST,TIEN,"D",NXT))
"RTN","SCRPTP2",127,0)
 W !!,"[Not Assigned] = Patient assigned to Team but not to a position/provider"
"RTN","SCRPTP2",128,0)
 W !,"[Inactive Position] = Patient assigned to Team & Position but has no active provider"
"RTN","SCRPTP2",129,0)
 Q
"RTN","SCRPTP2",130,0)
 ;
"RTN","SCRPTP2",131,0)
HEADER ;prints column headings
"RTN","SCRPTP2",132,0)
 N NXT
"RTN","SCRPTP2",133,0)
 F NXT="H1","H2","H3" D
"RTN","SCRPTP2",134,0)
 .W !,$G(@STORE@(NXT))
"RTN","SCRPTP2",135,0)
 Q
"RTN","SCRPTP2",136,0)
 ;
"RTN","SCRPTP2",137,0)
SETH ;sets column headings
"RTN","SCRPTP2",138,0)
 S @STORE@("H2")="Patient Name"
"RTN","SCRPTP2",139,0)
 S $E(@STORE@("H2"),18)="Pt ID"
"RTN","SCRPTP2",140,0)
 S $E(@STORE@("H2"),32)="Practitioner"
"RTN","SCRPTP2",141,0)
 S $E(@STORE@("H2"),56)="Role"
"RTN","SCRPTP2",142,0)
 S $E(@STORE@("H2"),80)="PC?"
"RTN","SCRPTP2",143,0)
 S $E(@STORE@("H1"),85)="Last"
"RTN","SCRPTP2",144,0)
 S $E(@STORE@("H2"),85)="Appt."
"RTN","SCRPTP2",145,0)
 S $E(@STORE@("H1"),97)="Next"
"RTN","SCRPTP2",146,0)
 S $E(@STORE@("H2"),97)="Appt."
"RTN","SCRPTP2",147,0)
 S $E(@STORE@("H2"),109)="Associated Clinic"
"RTN","SCRPTP2",148,0)
 S $P(@STORE@("H3"),"=",133)=""
"RTN","SCRPTP2",149,0)
 Q
"RTN","SCRPTP3")
0^21^B16177961^B27716649
"RTN","SCRPTP3",1,0)
SCRPTP3 ;ALB/CMM - List of Team's Patients ; 29 Jun 99  04:11PM
"RTN","SCRPTP3",2,0)
 ;;5.3;Scheduling;**41,48,98,177,231,433,526,520**;AUG 13, 1993;Build 26
"RTN","SCRPTP3",3,0)
 ;;DMR BP-OIFO Patch SD*5.3*526
"RTN","SCRPTP3",4,0)
 ;
"RTN","SCRPTP3",5,0)
 ;List of Team's Patients Report
"RTN","SCRPTP3",6,0)
 ;
"RTN","SCRPTP3",7,0)
HITS(ARRY,TIEN) ;
"RTN","SCRPTP3",8,0)
 ;ARRY - list of patients for a given team
"RTN","SCRPTP3",9,0)
 ;TIEN - team ien
"RTN","SCRPTP3",10,0)
 ;
"RTN","SCRPTP3",11,0)
 N PTIEN,PIEN,PTNAME,PNAME,PTAI,NXT,NODE,CIEN,CNAME,INAME,INST,LAST,NEXT
"RTN","SCRPTP3",12,0)
 N PAIEN,PC,PHONE,PNODE,PTPA,PTPAN,ROL,PID,TINFO,TNAME,TPIEN,TPNODE
"RTN","SCRPTP3",13,0)
 N CNT,TPA,FLAG,DFN,VA,VAERR,PCAP,ROLN
"RTN","SCRPTP3",14,0)
 S INACTIVE=0
"RTN","SCRPTP3",15,0)
 S NXT=0
"RTN","SCRPTP3",16,0)
 F  S NXT=$O(@ARRY@(NXT)) Q:NXT=""!(NXT'?.N)  D
"RTN","SCRPTP3",17,0)
 .S NODE=$G(@ARRY@(NXT))
"RTN","SCRPTP3",18,0)
 .Q:NODE=""
"RTN","SCRPTP3",19,0)
 .S PTIEN=+$P(NODE,"^") ;patient ien
"RTN","SCRPTP3",20,0)
 .S PTNAME=$P(NODE,"^",2) ;patient name
"RTN","SCRPTP3",21,0)
 .S PTAI=+$P(NODE,"^",3) ;patient team assignment ien (#404.42)
"RTN","SCRPTP3",22,0)
 .;
"RTN","SCRPTP3",23,0)
 .S PNODE=$G(^DPT(PTIEN,0))
"RTN","SCRPTP3",24,0)
 .Q:PNODE=""
"RTN","SCRPTP3",25,0)
 .S DFN=PTIEN
"RTN","SCRPTP3",26,0)
 .D PID^VADPT6
"RTN","SCRPTP3",27,0)
 .;S PID=VA("BID")
"RTN","SCRPTP3",28,0)
 .S PID=$E(VA("PID"),1,3)_$E(VA("PID"),5,6)_$E(VA("PID"),8,12)
"RTN","SCRPTP3",29,0)
 .;
"RTN","SCRPTP3",30,0)
 .N CNAME,PINF,CLIEN
"RTN","SCRPTP3",31,0)
 .S CNT=""
"RTN","SCRPTP3",32,0)
 .F  S CNT=$O(^SCPT(404.43,"B",PTAI,CNT)) Q:CNT=""!(CNT'?.N)  D
"RTN","SCRPTP3",33,0)
 ..D TPAR(PTAI,CNT,.PINF,.CNAME,.CLIEN,.PNAME,.ROLN,.PCAP)
"RTN","SCRPTP3",34,0)
 Q
"RTN","SCRPTP3",35,0)
 ;
"RTN","SCRPTP3",36,0)
TPAR(PTAI,START,PINF,CNAME,CLIEN,PNAME,ROLN,PCAP) ;
"RTN","SCRPTP3",37,0)
 N PTPA,TPIEN,TPNODE,ROL,CIEN,ENROLL,OKAY,NEXT,LAST,PAIEN
"RTN","SCRPTP3",38,0)
 I '$D(^SCPT(404.43,"B",PTAI)) Q "0^[Not Assigned]"
"RTN","SCRPTP3",39,0)
 ; ^ no patient team position assignment
"RTN","SCRPTP3",40,0)
 IF START="" D
"RTN","SCRPTP3",41,0)
 .S PTPA=$O(^SCPT(404.43,"B",PTAI,START))
"RTN","SCRPTP3",42,0)
 ELSE  D
"RTN","SCRPTP3",43,0)
 .S PTPA=START
"RTN","SCRPTP3",44,0)
 I PTPA="" Q "0^[Not Assigned]"
"RTN","SCRPTP3",45,0)
 S PTPAN=$G(^SCPT(404.43,PTPA,0))  ;patient team assignment
"RTN","SCRPTP3",46,0)
 I PTPAN=""!(PTPAN=0) Q "0^[Not Assigned]"
"RTN","SCRPTP3",47,0)
 I $P(PTPAN,"^",4)'="",$P(PTPAN,"^",4)<DT Q -1
"RTN","SCRPTP3",48,0)
 S TPIEN=+$P(PTPAN,"^",2) ;team position ien (#404.57)
"RTN","SCRPTP3",49,0)
 I '$D(^SCTM(404.57,TPIEN,0)) Q "0^[Not Assigned]"
"RTN","SCRPTP3",50,0)
 S TPNODE=$G(^SCTM(404.57,TPIEN,0))
"RTN","SCRPTP3",51,0)
 I TPNODE="" Q "0^[Not Assigned]"
"RTN","SCRPTP3",52,0)
 S ROL=+$P(TPNODE,"^",3) ;role for position (ien)
"RTN","SCRPTP3",53,0)
 Q:'$D(ROLE(ROL))&(ROLE'=1) -1
"RTN","SCRPTP3",54,0)
 ; ^ not a selected role
"RTN","SCRPTP3",55,0)
 S ROLN=$P($G(^SD(403.46,ROL,0)),U) ;role name
"RTN","SCRPTP3",56,0)
 ;
"RTN","SCRPTP3",57,0)
 S PCAP=$S($P(PTPAN,U,5)<1:"NPC",+$$OKPREC3^SCMCLK(TPIEN,DT)>0:" AP",1:"PCP") ;PC?
"RTN","SCRPTP3",58,0)
 ;
"RTN","SCRPTP3",59,0)
 D SETASCL^SCRPRAC2(TPIEN,.CNAME,.CLIEN)
"RTN","SCRPTP3",60,0)
 ;next two lines commented off - SD*5.3*433
"RTN","SCRPTP3",61,0)
 ;S ENROLL=$$ENRL(PTIEN,CIEN) ;enrolled in associated clinic
"RTN","SCRPTP3",62,0)
 ;I 'ENROLL S CNAME="",CIEN=0
"RTN","SCRPTP3",63,0)
 ;
"RTN","SCRPTP3",64,0)
 S PAIEN=$$CHK(TPIEN)
"RTN","SCRPTP3",65,0)
 I +PAIEN'=0 S PIEN=+PAIEN,PNAME=$P(PAIEN,"^",2) ; practitioner's name
"RTN","SCRPTP3",66,0)
 ;SD*5.3*231
"RTN","SCRPTP3",67,0)
 I +PAIEN=0 S PIEN=0,PNAME="[Inactive Position]"
"RTN","SCRPTP3",68,0)
 ;
"RTN","SCRPTP3",69,0)
 D GETPINF^SCRPPAT2(PTIEN,.CLIEN,.PINF)  ;get patient info
"RTN","SCRPTP3",70,0)
 S CNAME=$G(CNAME(0))
"RTN","SCRPTP3",71,0)
 S PINF=$G(PINF(0))
"RTN","SCRPTP3",72,0)
 I PINF="" D
"RTN","SCRPTP3",73,0)
 .S PINF=PIEN_"^"_$$PDATA^SCRPEC(PIEN,CNAME,CNAME,1)
"RTN","SCRPTP3",74,0)
 I INACTIVE S @STORE@(INS,TIEN,"INACT")=""
"RTN","SCRPTP3",75,0)
 S FLAG="Y"
"RTN","SCRPTP3",76,0)
 S TINFO=$$TINF^SCRPTP(TIEN) ;team information
"RTN","SCRPTP3",77,0)
 S INST=+$P(TINFO,"^") ;institution ien
"RTN","SCRPTP3",78,0)
 S INAME=$P($G(^DIC(4,INST,0)),"^") ;institution name
"RTN","SCRPTP3",79,0)
 S PHONE=$P(TINFO,"^",4) ;team phone
"RTN","SCRPTP3",80,0)
 S PC=$P(TINFO,"^",3) ;primary care?
"RTN","SCRPTP3",81,0)
 S TNAME=$P(TINFO,"^",2) ;team name
"RTN","SCRPTP3",82,0)
 D TFORMAT^SCRPTP2(INST,INAME,TIEN,TNAME,PHONE,PC)
"RTN","SCRPTP3",83,0)
 D FORMAT^SCRPTP(INS,TIEN,PTIEN,PTNAME,PID,PIEN,PNAME,CNAME,PINF,ROLN,PCAP)
"RTN","SCRPTP3",84,0)
 N SCCNT
"RTN","SCRPTP3",85,0)
 S SCCNT=0 F  S SCCNT=$O(CNAME(SCCNT)) Q:SCCNT=""  D FORMATAC^SCRPTP(SCCNT,CNAME(SCCNT),PINF(SCCNT),INS,TIEN,PTIEN,PTNAME,PID,PIEN,PNAME,ROLN,PCAP)
"RTN","SCRPTP3",86,0)
 Q
"RTN","SCRPTP3",87,0)
 ;
"RTN","SCRPTP3",88,0)
ENRL(PTIEN,CLIEN) ;FUNCTIONALITY DISABLED
"RTN","SCRPTP3",89,0)
 ;
"RTN","SCRPTP3",90,0)
 ;N FOUND,ENODE,EN,NXT
"RTN","SCRPTP3",91,0)
 ;S FOUND=0
"RTN","SCRPTP3",92,0)
 ;Q:'$D(^DPT(PTIEN,"DE","B",CLIEN)) FOUND
"RTN","SCRPTP3",93,0)
 ;S EN=$O(^DPT(PTIEN,"DE","B",CLIEN,""))
"RTN","SCRPTP3",94,0)
 ;Q:EN=""!'$D(^DPT(PTIEN,"DE",EN,1)) FOUND
"RTN","SCRPTP3",95,0)
 ;S NXT=""
"RTN","SCRPTP3",96,0)
 ;F  S NXT=$O(^DPT(PTIEN,"DE",EN,1,NXT)) Q:(FOUND)!(NXT="")!(NXT'?.N)  D
"RTN","SCRPTP3",97,0)
 ;check if active enrollment
"RTN","SCRPTP3",98,0)
 ;S ENODE=$G(^DPT(PTIEN,"DE",EN,1,NXT,0))
"RTN","SCRPTP3",99,0)
 ;I $P(ENODE,"^",3)'="",$P(ENODE,"^",3)<DT+1!$P(ENODE,"^")>DT Q  ;not active enrollment
"RTN","SCRPTP3",100,0)
 ;;                      ^ discharge date     ^ enrollment date
"RTN","SCRPTP3",101,0)
 S FOUND=0
"RTN","SCRPTP3",102,0)
 Q FOUND
"RTN","SCRPTP3",103,0)
 ;
"RTN","SCRPTP3",104,0)
CHK(TPIEN) ;assigned to a position
"RTN","SCRPTP3",105,0)
 ;TPIEN - ien of 404.57 Team Position file
"RTN","SCRPTP3",106,0)
 ;returns:  ien of 200 New Person file
"RTN","SCRPTP3",107,0)
 N EN,PLIST,PERR,ERR,NAME
"RTN","SCRPTP3",108,0)
 S PLIST="PLST",PERR="PRR"
"RTN","SCRPTP3",109,0)
 K @PLIST,@PERR
"RTN","SCRPTP3",110,0)
 S ERR=$$PRTP^SCAPMC8(TPIEN,,.PLIST,.PERR)
"RTN","SCRPTP3",111,0)
 I '$D(@PERR) D
"RTN","SCRPTP3",112,0)
 .S EN=$P($G(@PLIST@(1)),"^") ;ien of new person file
"RTN","SCRPTP3",113,0)
 .S NAME=$P($G(@PLIST@(1)),"^",2) ; new person name
"RTN","SCRPTP3",114,0)
 K @PLIST,@PERR
"RTN","SCRPTP3",115,0)
 Q EN_"^"_NAME
"RTN","SCRPTP3",116,0)
 ;
"RTN","SCRPU1")
0^22^B24892950^B24892812
"RTN","SCRPU1",1,0)
SCRPU1 ;ALB/CMM - GENERIC PROMPTS FOR PCMM REPORTS ;1/12/96
"RTN","SCRPU1",2,0)
 ;;5.3;Scheduling;**41,45,130,520**;AUG 13, 1993;Build 26
"RTN","SCRPU1",3,0)
 ;
"RTN","SCRPU1",4,0)
INST ;Prompt for institution
"RTN","SCRPU1",5,0)
 S VAUTVB="VAUTD",DIC="^DIC(4,",DIC("S")="I $D(^SCTM(404.51,""AINST"",+Y))"
"RTN","SCRPU1",6,0)
 S VAUTNI=2,VAUTSTR="Division"
"RTN","SCRPU1",7,0)
 G FIRST^VAUTOMA
"RTN","SCRPU1",8,0)
 ;
"RTN","SCRPU1",9,0)
PRMTT ;Prompt for team.  Set VAUTTN to allow not assigned to a team as a selection
"RTN","SCRPU1",10,0)
 I '$D(VAUTD) G ERR
"RTN","SCRPU1",11,0)
 S VAUTVB="VAUTT",DIC="^SCTM(404.51,",VAUTNI=2,VAUTSTR="Team",DIC("B")=""
"RTN","SCRPU1",12,0)
 S DIC("S")="I VAUTD=1!($D(VAUTD(+$P(^(0),U,7))))"
"RTN","SCRPU1",13,0)
 G FIRST
"RTN","SCRPU1",14,0)
 ;
"RTN","SCRPU1",15,0)
CLINIC ;Prompt for Clinic
"RTN","SCRPU1",16,0)
 I '$D(VAUTT)&'$D(VAUTCA) G ERR
"RTN","SCRPU1",17,0)
 S VAUTVB="VAUTC",VAUTSTR="Clinic",VAUTNI=2,DIC="^SC("
"RTN","SCRPU1",18,0)
 ;Set screen to only allow clinics and clinics that are associated to the teams selected
"RTN","SCRPU1",19,0)
 I '$D(VAUTCA) S DIC("S")="I $$CLSC^SCRPU1()"
"RTN","SCRPU1",20,0)
 ;VAUTCA allows for selection of any clinic in the selected
"RTN","SCRPU1",21,0)
 I $D(VAUTCA) S DIC("S")="I $$CLSC2^SCRPU1()"
"RTN","SCRPU1",22,0)
 G FIRST
"RTN","SCRPU1",23,0)
 ;
"RTN","SCRPU1",24,0)
USER ;Prompt for User Class
"RTN","SCRPU1",25,0)
 I '$D(VAUTT) G ERR
"RTN","SCRPU1",26,0)
 I $P($G(^SD(404.91,1,"PCMM")),"^")'=1 Q  ;user class turned off
"RTN","SCRPU1",27,0)
 S VAUTVB="VAUTUC",DIC="^USR(8930,",VAUTSTR="User Class",VAUTNI=2
"RTN","SCRPU1",28,0)
 S DIC("S")="I $$USRCL^SCRPU1"
"RTN","SCRPU1",29,0)
 G FIRST
"RTN","SCRPU1",30,0)
 ;
"RTN","SCRPU1",31,0)
USRCL() ;Screen for user class - must be related to teams selected
"RTN","SCRPU1",32,0)
 N STOP,ENT,NODE,TIEN
"RTN","SCRPU1",33,0)
 I '+$P(^(0),U,3) Q 0
"RTN","SCRPU1",34,0)
 ;check for active/exiting user class
"RTN","SCRPU1",35,0)
 S ENT=0,STOP=0
"RTN","SCRPU1",36,0)
 F  S ENT=$O(^SCTM(404.57,"AUSR",+Y,ENT)) Q:ENT=""!(STOP)  D
"RTN","SCRPU1",37,0)
 .S NODE=$G(^SCTM(404.57,ENT,0))
"RTN","SCRPU1",38,0)
 .I NODE="" S STOP=0 Q
"RTN","SCRPU1",39,0)
 .S TIEN=+$P(NODE,"^",2) ;team ien
"RTN","SCRPU1",40,0)
 .I $D(VAUTT(TIEN))!(VAUTT=1) S STOP=1 Q
"RTN","SCRPU1",41,0)
 .I VAUTT=""&(TIEN="") S STOP=1 Q  ;no team selected, no team assigned
"RTN","SCRPU1",42,0)
 .I VAUTT'=1&('$D(VAUTT(TIEN))) S STOP=0
"RTN","SCRPU1",43,0)
 Q STOP
"RTN","SCRPU1",44,0)
 ;
"RTN","SCRPU1",45,0)
ROLE ;Prompt for Role
"RTN","SCRPU1",46,0)
 I '$D(VAUTT) G ERR
"RTN","SCRPU1",47,0)
 S VAUTVB="VAUTR",DIC="^SD(403.46,",VAUTSTR="Role",VAUTNI=2
"RTN","SCRPU1",48,0)
 S DIC("S")="I $$RL^SCRPU1()"
"RTN","SCRPU1",49,0)
 G FIRST
"RTN","SCRPU1",50,0)
 ;
"RTN","SCRPU1",51,0)
RL() ;Screen for Role - screen on team
"RTN","SCRPU1",52,0)
 N EN,STOP,ACT,TEAM
"RTN","SCRPU1",53,0)
 S EN="",STOP=0
"RTN","SCRPU1",54,0)
 I $D(^SCTM(404.57,"AC",+Y)) D
"RTN","SCRPU1",55,0)
 .F  S EN=$O(^SCTM(404.57,"AC",+Y,EN)) Q:EN=""!(STOP)  D
"RTN","SCRPU1",56,0)
 ..S ACT=+$$ACTTP^SCMCTPU(EN) ;currently active?
"RTN","SCRPU1",57,0)
 ..I 'ACT!('$D(^SCTM(404.57,EN,0))) Q
"RTN","SCRPU1",58,0)
 ..S TEAM=$P(^SCTM(404.57,EN,0),"^",2)
"RTN","SCRPU1",59,0)
 ..I $D(VAUTT(TEAM))!(VAUTT=1) S STOP=1
"RTN","SCRPU1",60,0)
 ..I VAUTT=""&(TEAM="") S STOP=1
"RTN","SCRPU1",61,0)
 Q STOP
"RTN","SCRPU1",62,0)
 ;
"RTN","SCRPU1",63,0)
PRACT ; Prompt for One (set VAUTPO) or One,Many,All,None Practitioner(s)
"RTN","SCRPU1",64,0)
 I '$D(VAUTT) G ERR
"RTN","SCRPU1",65,0)
 S VAUTVB="VAUTP",VAUTSTR="Practitioner",VAUTNI=2,DIC="^VA(200,"
"RTN","SCRPU1",66,0)
 S DIC("S")="I $$PRACS^SCRPU1()"
"RTN","SCRPU1",67,0)
 G FIRST
"RTN","SCRPU1",68,0)
 ;
"RTN","SCRPU1",69,0)
PRACS() ;Practitioner screen - off of team selection
"RTN","SCRPU1",70,0)
 N EN,STOP,NODE,TEAM
"RTN","SCRPU1",71,0)
 S EN="",STOP=0
"RTN","SCRPU1",72,0)
 I '$D(^SCTM(404.52,"C",+Y)) Q 0
"RTN","SCRPU1",73,0)
 ;Position Assignment History file
"RTN","SCRPU1",74,0)
 F  S EN=$O(^SCTM(404.52,"C",+Y,EN)) Q:EN=""!(STOP)  D
"RTN","SCRPU1",75,0)
 .I '$D(^SCTM(404.52,EN)) Q
"RTN","SCRPU1",76,0)
 .S NODE=$G(^SCTM(404.52,EN,0))
"RTN","SCRPU1",77,0)
 .S TEAM=+$P($G(^SCTM(404.57,$P(NODE,"^"),0)),"^",2)
"RTN","SCRPU1",78,0)
 .I $P(NODE,"^",4),$D(VAUTT(TEAM)) S STOP=1
"RTN","SCRPU1",79,0)
 .I VAUTT=1 S STOP=1
"RTN","SCRPU1",80,0)
 Q STOP
"RTN","SCRPU1",81,0)
 ;
"RTN","SCRPU1",82,0)
FIRST ;
"RTN","SCRPU1",83,0)
 S DIC(0)="EQMNZ",DIC("A")="Select "_VAUTSTR_": " K @VAUTVB
"RTN","SCRPU1",84,0)
 S (@VAUTVB,Y)=0
"RTN","SCRPU1",85,0)
REDO W !,DIC("A") R X:DTIME G ERR:(X="^")!'$T D:X["?"!(X=""&('$G(SCOKNULL))) HELP^SCRPU3
"RTN","SCRPU1",86,0)
 G:$G(SCOKNULL)&(X="") QUIT
"RTN","SCRPU1",87,0)
 I X="A"!(X="ALL")&'$D(VAUTNA) S @VAUTVB=1 G QUIT
"RTN","SCRPU1",88,0)
 ;VAUTNA doesn't allow all to be selected
"RTN","SCRPU1",89,0)
 ;VAUTTN allows 'Not assigned to a team' as a selection
"RTN","SCRPU1",90,0)
 I X="N"!(X="NOT")!(X="NONE") I $D(VAUTTN)!($D(VAUTPP)) S @VAUTVB="" G QUIT
"RTN","SCRPU1",91,0)
 ;VAUTPP allows 'Not assigned to a practitioner' as a selection
"RTN","SCRPU1",92,0)
 S DIC("A")="Select another "_VAUTSTR_": " D ^DIC G:Y'>0 FIRST D SET
"RTN","SCRPU1",93,0)
 I '$D(VAUTPO) F VAI=1:0:19 W !,DIC("A") R X:DTIME G ERR:(X="")!(X="^")!'$T K Y D HELP^SCRPU3:X["?" S:$E(X)="-" VAUTX=X,X=$E(VAUTX,2,999) D ^DIC I Y>0 D SET G:VAX REDO S:'VAERR VAI=VAI+1
"RTN","SCRPU1",94,0)
 ;VAUTPO - only one practitioner allowed to be selected
"RTN","SCRPU1",95,0)
 G QUIT
"RTN","SCRPU1",96,0)
SET S VAX=0 I $D(VAUTX) S J=$S(VAUTNI=2:+Y,1:$P(Y(0),"^")) K VAUTX S VAERR=$S($D(@VAUTVB@(J)):0,1:1) W $S('VAERR:"...removed from list...",1:"...not on list...can't remove") Q:VAERR  S VAI=VAI-1 K @VAUTVB@(J) S:$O(@VAUTVB@(0))']"" VAX=1 Q
"RTN","SCRPU1",97,0)
 S VAERR=0 I $S($D(@VAUTVB@($P(Y(0),U))):1,$D(@VAUTVB@(+Y)):1,1:0) W !?3,*7,"You have already selected that ",VAUTSTR,".  Try again." S VAERR=1
"RTN","SCRPU1",98,0)
 S @VAUTVB@(+Y)=$P(Y(0),U)
"RTN","SCRPU1",99,0)
 Q
"RTN","SCRPU1",100,0)
 ;
"RTN","SCRPU1",101,0)
ERR S Y=-1 I $O(@VAUTVB@(0))="" K @VAUTVB I X="^" S SCUP=""
"RTN","SCRPU1",102,0)
QUIT S:'$D(Y) Y=1
"RTN","SCRPU1",103,0)
 I $D(@VAUTVB),VAUTSTR="Team",@VAUTVB=1 D:'$G(DGQUIET) EN^DDIOL("All Teams selected, this report may take some time...","","!,?10")
"RTN","SCRPU1",104,0)
 K DIC,J,VAERR,VAI,VAJ,VAJ1,VAX,VAUTNI,VAUTSTR,VAUTVB,X
"RTN","SCRPU1",105,0)
 Q
"RTN","SCRPU1",106,0)
 ;
"RTN","SCRPU1",107,0)
CLSC() ;screen on clinic selection, must be related to team prompt
"RTN","SCRPU1",108,0)
 I $P(^(0),U,3)'="C" Q 0
"RTN","SCRPU1",109,0)
 N TRUE,EN,TEAM
"RTN","SCRPU1",110,0)
 S TRUE=0,EN=""
"RTN","SCRPU1",111,0)
 F  S EN=$O(^SCTM(404.57,"E",+Y,EN)) Q:EN=""!(TRUE)  D
"RTN","SCRPU1",112,0)
 .S TEAM=+$P($G(^SCTM(404.57,EN,0)),"^",2)
"RTN","SCRPU1",113,0)
 .I $D(VAUTT(TEAM))!(VAUTT=1) S TRUE=1
"RTN","SCRPU1",114,0)
 I VAUTT="" S TRUE=1
"RTN","SCRPU1",115,0)
 Q TRUE
"RTN","SCRPU1",116,0)
 ;
"RTN","SCRPU1",117,0)
CLSC2() ;screen on clinic selection, must be a clinic
"RTN","SCRPU1",118,0)
 I $P(^(0),U,3)'="C" Q 0
"RTN","SCRPU1",119,0)
 Q 1
"RTN","SCRPU1",120,0)
 ;
"RTN","SCRPU1",121,0)
CLSC2OLD() ;screen on clinic selection, must be related to division prompt
"RTN","SCRPU1",122,0)
 I $P(^(0),U,3)'="C" Q 0
"RTN","SCRPU1",123,0)
 N TRUE,EN,INST,TDIV
"RTN","SCRPU1",124,0)
 S TRUE=0,EN=""
"RTN","SCRPU1",125,0)
 S TDIV=+$P(^(0),U,15) ;clinic's division
"RTN","SCRPU1",126,0)
 Q:TDIV=0 0
"RTN","SCRPU1",127,0)
 S INST=+$P(^DG(40.8,TDIV,0),U,7)
"RTN","SCRPU1",128,0)
 I '$D(VAUTD(INST))&(VAUTD'="") S TRUE=0
"RTN","SCRPU1",129,0)
 I $D(VAUTD(INST)) S TRUE=1
"RTN","SCRPU1",130,0)
 I VAUTD=1 S TRUE=1
"RTN","SCRPU1",131,0)
 Q TRUE
"RTN","SCRPU2")
0^23^B22140264^B22140204
"RTN","SCRPU2",1,0)
SCRPU2 ;ALB/CMM - GENERIC PROMPTS FOR PCMM REPORTS ; 12 Jan 99  1:23 PM
"RTN","SCRPU2",2,0)
 ;;5.3;Scheduling;**41,174,297,526,520**;AUG 13, 1993;Build 26
"RTN","SCRPU2",3,0)
 ;
"RTN","SCRPU2",4,0)
DTRANG(FIRST,SECOND) ;Date Range - begin date ^ end date => fileman format
"RTN","SCRPU2",5,0)
 ;FIRST - first prompt (not required)
"RTN","SCRPU2",6,0)
 ;SECOND - second prompt (not required)
"RTN","SCRPU2",7,0)
 N BDATE,EDATE,DIROUT,DUOUT,DTOUT
"RTN","SCRPU2",8,0)
 S EDATE=-1
"RTN","SCRPU2",9,0)
 S DIR(0)="D^::E",DIR("B")="Today"
"RTN","SCRPU2",10,0)
 I '$D(FIRST) S DIR("A")="Begin Date"
"RTN","SCRPU2",11,0)
 I $D(FIRST) S DIR("A")=FIRST
"RTN","SCRPU2",12,0)
 D ^DIR
"RTN","SCRPU2",13,0)
 I $D(DTOUT)!(X="Today") S BDATE=$P(DT,".")
"RTN","SCRPU2",14,0)
 I $D(DUOUT)!($D(DIROUT))  Q -1
"RTN","SCRPU2",15,0)
 S BDATE=+Y
"RTN","SCRPU2",16,0)
DEN I '$D(SECOND) S DIR("A")="End Date"
"RTN","SCRPU2",17,0)
 I $D(SECOND) S DIR("A")=SECOND
"RTN","SCRPU2",18,0)
 K DTOUT,X,Y
"RTN","SCRPU2",19,0)
 D ^DIR
"RTN","SCRPU2",20,0)
 I $D(DTOUT)!(X="Today") S EDATE=$P(DT,".")
"RTN","SCRPU2",21,0)
 I $D(DUOUT)!($D(DIROUT)) Q -1
"RTN","SCRPU2",22,0)
 S EDATE=+Y
"RTN","SCRPU2",23,0)
 I EDATE<BDATE W !,"End date can't occur before Begin Date",! G DEN
"RTN","SCRPU2",24,0)
 K X,Y,DIR
"RTN","SCRPU2",25,0)
 Q BDATE_"^"_EDATE
"RTN","SCRPU2",26,0)
 ;
"RTN","SCRPU2",27,0)
GTEAM(CLN,DFN) ;
"RTN","SCRPU2",28,0)
 ;given clinic and patient, find related team
"RTN","SCRPU2",29,0)
 N TPEN,FOUND,TEAM
"RTN","SCRPU2",30,0)
 S TPEN="",FOUND=0
"RTN","SCRPU2",31,0)
 F  S TPEN=$O(^SCTM(404.57,"E",CLN,TPEN)) Q:TPEN=""!(FOUND)  D
"RTN","SCRPU2",32,0)
 .S TEAM=$P(^SCTM(404.57,TPEN,0),"^",2)
"RTN","SCRPU2",33,0)
 .I $D(^SCPT(404.42,"APTTM",DFN,TEAM)) S FOUND=1
"RTN","SCRPU2",34,0)
 I FOUND=1 Q TEAM
"RTN","SCRPU2",35,0)
 Q FOUND
"RTN","SCRPU2",36,0)
 ;
"RTN","SCRPU2",37,0)
ASSUN ;
"RTN","SCRPU2",38,0)
 ;prompt for assigned or unassigned to Primary Care Team
"RTN","SCRPU2",39,0)
 N VAUTVB
"RTN","SCRPU2",40,0)
 S VAUTVB="VAUTA"
"RTN","SCRPU2",41,0)
 W !,"(A)ssigned or (U)nassigned Patients to Primary Care Team: "
"RTN","SCRPU2",42,0)
 R X:DTIME
"RTN","SCRPU2",43,0)
 I (X="^")!'$T G ERR
"RTN","SCRPU2",44,0)
 I (X'="A")&(X'="U") D HLP G ASSUN
"RTN","SCRPU2",45,0)
 I (X="")!(X["?") D HLP G ASSUN
"RTN","SCRPU2",46,0)
 I X="A" S @VAUTVB=1
"RTN","SCRPU2",47,0)
 I X="U" S @VAUTVB=0
"RTN","SCRPU2",48,0)
 K X
"RTN","SCRPU2",49,0)
 Q
"RTN","SCRPU2",50,0)
 ;
"RTN","SCRPU2",51,0)
PCLNHR() ;Prompt to Print Clinic Hours
"RTN","SCRPU2",52,0)
 S DIR("A")="Print Clinic Hours",DIR("B")="Y"
"RTN","SCRPU2",53,0)
 Q $$YESNO()
"RTN","SCRPU2",54,0)
 ;
"RTN","SCRPU2",55,0)
PCLNIN() ;Prompt to Print Clinic Information
"RTN","SCRPU2",56,0)
 S DIR("A")="Print Clinic Information",DIR("B")="Y"
"RTN","SCRPU2",57,0)
 Q $$YESNO()
"RTN","SCRPU2",58,0)
 ;
"RTN","SCRPU2",59,0)
SUMM() ;Prompt to Print Summary Only (y/n)
"RTN","SCRPU2",60,0)
 S DIR("A")="Print Summary Only",DIR("B")="N"
"RTN","SCRPU2",61,0)
 S DIR("?")="Enter 'Y' to have patient names excluded, 'N' to include patient names"
"RTN","SCRPU2",62,0)
 Q $$YESNO()
"RTN","SCRPU2",63,0)
 ;
"RTN","SCRPU2",64,0)
YESNO() ;Yes/No prompt
"RTN","SCRPU2",65,0)
 N X,DTOUT,DUOUT,DIROUT,Y
"RTN","SCRPU2",66,0)
 S DIR(0)="Y"
"RTN","SCRPU2",67,0)
 D ^DIR
"RTN","SCRPU2",68,0)
 I $D(DTOUT)!(X="") S Y=$S(DIR("B")="Y":1,1:0)
"RTN","SCRPU2",69,0)
 I $D(DUOUT)!($D(DIROUT)) S Y=-1
"RTN","SCRPU2",70,0)
 K DIR
"RTN","SCRPU2",71,0)
 Q +Y
"RTN","SCRPU2",72,0)
 ;
"RTN","SCRPU2",73,0)
PTSTAT ;Prompt for Patient Status (All, OPT, AC)
"RTN","SCRPU2",74,0)
 ;Modified by patch 172
"RTN","SCRPU2",75,0)
 S VAUTPS=1 Q
"RTN","SCRPU2",76,0)
 ;
"RTN","SCRPU2",77,0)
 N X,STAT,VAUTVB
"RTN","SCRPU2",78,0)
 S VAUTVB="VAUTPS"
"RTN","SCRPU2",79,0)
 W !,"Patient Status: ALL//"
"RTN","SCRPU2",80,0)
 R X:DTIME
"RTN","SCRPU2",81,0)
 I '$T!(X="")!(X="ALL") S @VAUTVB=1
"RTN","SCRPU2",82,0)
 I X="^" G ERR
"RTN","SCRPU2",83,0)
 I (X["?") D HLP2 G PTSTAT
"RTN","SCRPU2",84,0)
 I X="A"!(X="AC") S @VAUTVB="AC"
"RTN","SCRPU2",85,0)
 I X="O"!(X="OPT") S @VAUTVB="OPT"
"RTN","SCRPU2",86,0)
 I '$D(@VAUTVB) D HLP2 G PTSTAT
"RTN","SCRPU2",87,0)
 Q
"RTN","SCRPU2",88,0)
 ;
"RTN","SCRPU2",89,0)
HLP2 ;help prompt for Patient Status
"RTN","SCRPU2",90,0)
 W !,"Enter: ",!?10,"- A or AC for patients whose status is AC"
"RTN","SCRPU2",91,0)
 W !?10,"- O or OPT for patient whose status is OPT"
"RTN","SCRPU2",92,0)
 W !?10,"- Enter or ALL for both AC and OPT patients"
"RTN","SCRPU2",93,0)
 Q
"RTN","SCRPU2",94,0)
HLP ;
"RTN","SCRPU2",95,0)
 ;help prompt
"RTN","SCRPU2",96,0)
 W !,"Enter: ",!?5,"- A for patients assigned to the team as Primary Care"
"RTN","SCRPU2",97,0)
 W !?10,"- U for patients not assigned to the team as Primary Care"
"RTN","SCRPU2",98,0)
 Q
"RTN","SCRPU2",99,0)
 ;
"RTN","SCRPU2",100,0)
ERR S Y=-1 I $O(@VAUTVB@(0))="" K @VAUTVB
"RTN","SCRPU2",101,0)
QUIT S:'$D(Y) Y=1 K DIC,J,VAERR,VAI,VAJ,VAJ1,VAX,VAUTNI,VAUTSTR,VAUTVB,X
"RTN","SCRPU2",102,0)
 Q
"RTN","SCRPU2",103,0)
 ;
"RTN","SCRPU2",104,0)
SORT() ;
"RTN","SCRPU2",105,0)
 ;Prompt for sorting by Division, Team, Practitioner or Division, Practitioner, Team
"RTN","SCRPU2",106,0)
 ;
"RTN","SCRPU2",107,0)
EN1 N X
"RTN","SCRPU2",108,0)
 W !,"Sort By:",!?10,"[1] Division, Team, Practitioner",!?10,"[2] Division, Practitioner, Team"
"RTN","SCRPU2",109,0)
 W !?10,"[3] Practitioner,Associated Clinic"
"RTN","SCRPU2",110,0)
 W !!,"Select 1 or 2 or 3: "
"RTN","SCRPU2",111,0)
 R X:DTIME
"RTN","SCRPU2",112,0)
 I (X="^")!'$T Q 0
"RTN","SCRPU2",113,0)
 I (X'="1")&(X'="2")&(X'=3) D HLP3 G EN1
"RTN","SCRPU2",114,0)
 I (X["?")!(X="") D HLP3 G EN1
"RTN","SCRPU2",115,0)
 Q X
"RTN","SCRPU2",116,0)
HLP3 ;
"RTN","SCRPU2",117,0)
 ;help prompt
"RTN","SCRPU2",118,0)
 W !,"Enter: ",!?5,"- 1 to sort by Division, Team, Practitioner "
"RTN","SCRPU2",119,0)
 W !?10,"- 2 to sort by Division, Practitioner, Team"
"RTN","SCRPU2",120,0)
 Q
"RTN","SCRPU2",121,0)
 ;
"RTN","SCRPU2",122,0)
SORT2() ;Prompt for sorting by:
"RTN","SCRPU2",123,0)
 ;   [1] Division, Team, Patient Name
"RTN","SCRPU2",124,0)
 ;or [2] Division, Team, SSN
"RTN","SCRPU2",125,0)
 ;or [3] Division, Team, Practitioner, Patient Name
"RTN","SCRPU2",126,0)
 ;or [4] Division, Team, Practitioner, SSN
"RTN","SCRPU2",127,0)
 ;
"RTN","SCRPU2",128,0)
EN4 ;
"RTN","SCRPU2",129,0)
 N X
"RTN","SCRPU2",130,0)
 W !,"Sort By:",!?10,"[1] Division, Team, Patient Name"
"RTN","SCRPU2",131,0)
 W !?10,"[2] Division, Team, SSN"
"RTN","SCRPU2",132,0)
 W !?10,"[3] Division, Team, Practitioner, Patient Name"
"RTN","SCRPU2",133,0)
 W !?10,"[4] Division, Team, Practitioner, SSN"
"RTN","SCRPU2",134,0)
 W !!,"Select 1, 2, 3, or 4: "
"RTN","SCRPU2",135,0)
 R X:DTIME
"RTN","SCRPU2",136,0)
 I X=""!(X="^")!'$T Q 0
"RTN","SCRPU2",137,0)
 I (X'="1")&(X'="2")&(X'="3")&(X'="4") D HLP4 G EN4
"RTN","SCRPU2",138,0)
 I (X["?") D HLP4 G EN4
"RTN","SCRPU2",139,0)
 Q X
"RTN","SCRPU2",140,0)
HLP4 ;
"RTN","SCRPU2",141,0)
 ;help prompt
"RTN","SCRPU2",142,0)
 W !,"Enter: ",!?5,"- 1 to sort by Division, Team, Patient Name"
"RTN","SCRPU2",143,0)
 W !?10,"- 2 to sort by Division, Team, SSN"
"RTN","SCRPU2",144,0)
 W !?10,"- 3 to sort by Division, Team, Practitioner, Patient Name"
"RTN","SCRPU2",145,0)
 W !?10,"- 4 to sort by Division, Team, Practitioner, SSN"
"RTN","SCRPU2",146,0)
 Q
"RTN","SD53P520")
0^^B2396170^n/a
"RTN","SD53P520",1,0)
SD53P520 ;ALB/MJB - SD*5.3*520 POST INIT; Oct 04, 2006 ; 10/23/06 5:40pm  ; 12/28/07 9:29am
"RTN","SD53P520",2,0)
         ;;5.3;SCHEDULING;**520**;AUG 13, 1993;Build 26
"RTN","SD53P520",3,0)
 Q
"RTN","SD53P520",4,0)
POST ;delete inactivated "D" cross reference
"RTN","SD53P520",5,0)
 N SDA
"RTN","SD53P520",6,0)
 S SDA(1)="",SDA(2)="    SD*5.3*520 Post-Install starting.....",SDA(3)="" D ATADDQ
"RTN","SD53P520",7,0)
 N SDA
"RTN","SD53P520",8,0)
 S SDA(1)="",SDA(2)=" Deleting cross-reference definition of the Associated Clinic field(.09)"
"RTN","SD53P520",9,0)
 S SDA(3)=" in the TEAM POSITION file (# 404.57)"
"RTN","SD53P520",10,0)
 D DELIX^DDMOD(404.57,.09,1,"K") D ATADDQ
"RTN","SD53P520",11,0)
EN ;Entry point for indexing cross-reference definition for Associated Clinics multiple
"RTN","SD53P520",12,0)
 N SDA
"RTN","SD53P520",13,0)
 S SDA(1)="",SDA(2)=" indexing cross-reference E - of the Associated Clinics Multiple field(#5)"
"RTN","SD53P520",14,0)
 S SDA(3)=" in the TEAM POSITION file (# 404.57)"
"RTN","SD53P520",15,0)
 K DA,DIK
"RTN","SD53P520",16,0)
 S DA(1)=0
"RTN","SD53P520",17,0)
 F  S DA(1)=$O(^SCTM(404.57,DA(1))) Q:'DA(1)  D
"RTN","SD53P520",18,0)
 .Q:'$D(^SCTM(404.57,DA(1),5))
"RTN","SD53P520",19,0)
 .S DA="",DIK="^SCTM(404.57,"_DA(1)_",5,",DIK(1)=".01^E" D ENALL^DIK D ATADDQ
"RTN","SD53P520",20,0)
 N SDA
"RTN","SD53P520",21,0)
 S SDA(1)="",SDA(2)="    SD*5.3*520 Post-Install completed.....",SDA(3)="" D ATADDQ
"RTN","SD53P520",22,0)
 Q
"RTN","SD53P520",23,0)
ATADDQ ;
"RTN","SD53P520",24,0)
 D MES^XPDUTL(.SDA) K SDA
"RTN","SD53P520",25,0)
 Q
"RTN","SD53P520",26,0)
 ;
"UP",404.57,404.575,-1)
404.57^5
"UP",404.57,404.575,0)
404.575
"VER")
8.0^22.0
"^DD",404.57,404.57,.09,0)
ASSOCIATED CLINIC^P44'^SC(^0;9^Q
"^DD",404.57,404.57,.09,1,0)
^.1^^-1
"^DD",404.57,404.57,.09,1,2,0)
404.57^ASCTEAM^MUMPS
"^DD",404.57,404.57,.09,1,2,1)
D SETSCTM^SCMCDD2(DA,X)
"^DD",404.57,404.57,.09,1,2,2)
D KILLSCTM^SCMCDD2(DA,X)
"^DD",404.57,404.57,.09,1,2,"%D",0)
^^4^4^2960401^
"^DD",404.57,404.57,.09,1,2,"%D",1,0)
This edits the whole cross reference in the Hospital Location File (#44),
"^DD",404.57,404.57,.09,1,2,"%D",2,0)
'TEAM'.  This cross-reference allows users to use the team name to find
"^DD",404.57,404.57,.09,1,2,"%D",3,0)
clinics associated with the team's team positions.  See the 'ASCTEAM'
"^DD",404.57,404.57,.09,1,2,"%D",4,0)
cross-reference of the TEAM (#404.51) File's NAME (#.01) Field.
"^DD",404.57,404.57,.09,1,2,"DT")
2960401
"^DD",404.57,404.57,.09,3)
Field is no longer used 
"^DD",404.57,404.57,.09,12)
Allows only clinic locations.
"^DD",404.57,404.57,.09,12.1)
S DIC("S")="IF $P(^(0),""^"",3)=""C"""
"^DD",404.57,404.57,.09,21,0)
^^3^3^3080129^
"^DD",404.57,404.57,.09,21,1,0)
This field is no longer updated since the release of SD*5.3*297.
"^DD",404.57,404.57,.09,21,2,0)
 
"^DD",404.57,404.57,.09,21,3,0)
during various appointing and information processes.
"^DD",404.57,404.57,.09,23,0)
^^1^1^3080129^^
"^DD",404.57,404.57,.09,23,1,0)
NO LONGER UPDATED WITH RELEASE OF SD*5.3*297
"^DD",404.57,404.57,.09,"DT")
3080129
"^DD",404.57,404.57,5,0)
ASSOCIATED CLINICS^404.575PA^^5;0
"^DD",404.57,404.57,5,21,0)
^.001^2^2^3071127^^^
"^DD",404.57,404.57,5,21,1,0)
Multiple Entry of Associated Clinics. This replaces single value 
"^DD",404.57,404.57,5,21,2,0)
used before patch SD*5.3*297
"^DD",404.57,404.575,0)
ASSOCIATED CLINICS SUB-FIELD^^.01^1
"^DD",404.57,404.575,0,"NM","ASSOCIATED CLINICS")

"^DD",404.57,404.575,.01,0)
ASSOCIATED CLINICS^*P44'X^SC(^0;1^S DIC("S")="I $P(^(0),U,3)=""C""" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X I $D(X) S DINUM=X
"^DD",404.57,404.575,.01,1,0)
^.1
"^DD",404.57,404.575,.01,1,1,0)
404.575^B
"^DD",404.57,404.575,.01,1,1,1)
S ^SCTM(404.57,DA(1),5,"B",$E(X,1,30),DA)=""
"^DD",404.57,404.575,.01,1,1,2)
K ^SCTM(404.57,DA(1),5,"B",$E(X,1,30),DA)
"^DD",404.57,404.575,.01,1,2,0)
404.575^ASCTEAM^MUMPS
"^DD",404.57,404.575,.01,1,2,1)
D SETSCTM^SCMCDD2(DA(1),X)
"^DD",404.57,404.575,.01,1,2,2)
D KILLSCTM^SCMCDD2(DA(1),X)
"^DD",404.57,404.575,.01,1,2,"%D",0)
^^1^1^3031107^
"^DD",404.57,404.575,.01,1,2,"%D",1,0)
Set Team entry in Clinic file
"^DD",404.57,404.575,.01,1,2,"DT")
3031107
"^DD",404.57,404.575,.01,1,3,0)
404.57^E
"^DD",404.57,404.575,.01,1,3,1)
S ^SCTM(404.57,"E",$E(X,1,30),DA(1),DA)=""
"^DD",404.57,404.575,.01,1,3,2)
K ^SCTM(404.57,"E",$E(X,1,30),DA(1),DA)
"^DD",404.57,404.575,.01,1,3,"DT")
3071127
"^DD",404.57,404.575,.01,3)
Enter Clinic(s) associated with this position
"^DD",404.57,404.575,.01,12)
Only Clinics
"^DD",404.57,404.575,.01,12.1)
S DIC("S")="I $P(^(0),U,3)=""C"""
"^DD",404.57,404.575,.01,21,0)
^.001^3^3^3040402^^
"^DD",404.57,404.575,.01,21,1,0)
Clinics associated with this position
"^DD",404.57,404.575,.01,21,2,0)
Replaces single value field used before patch
"^DD",404.57,404.575,.01,21,3,0)
SD*5.3*297
"^DD",404.57,404.575,.01,"DT")
3071127
"BLD",7308,6)
^435
**END**
**END**
