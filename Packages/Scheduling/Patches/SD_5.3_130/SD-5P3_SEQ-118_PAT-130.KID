Released SD*5.3*130 SEQ #118
Extracted from mail message
**KIDS**:SD*5.3*130^

**INSTALL NAME**
SD*5.3*130
"BLD",605,0)
SD*5.3*130^SCHEDULING^0^2970807^n
"BLD",605,1,0)
^^1^1^2970825^^
"BLD",605,1,1,0)
See NPM for description.
"BLD",605,4,0)
^9.64PA^^
"BLD",605,"KRN",0)
^9.67PA^19^18
"BLD",605,"KRN",.4,0)
.4
"BLD",605,"KRN",.401,0)
.401
"BLD",605,"KRN",.402,0)
.402
"BLD",605,"KRN",.403,0)
.403
"BLD",605,"KRN",.5,0)
.5
"BLD",605,"KRN",.84,0)
.84
"BLD",605,"KRN",3.6,0)
3.6
"BLD",605,"KRN",3.8,0)
3.8
"BLD",605,"KRN",9.2,0)
9.2
"BLD",605,"KRN",9.8,0)
9.8
"BLD",605,"KRN",9.8,"NM",0)
^9.68A^10^10
"BLD",605,"KRN",9.8,"NM",1,0)
SCAPMC18^^0^B6575672
"BLD",605,"KRN",9.8,"NM",2,0)
SCMCCON^^0^B5568235
"BLD",605,"KRN",9.8,"NM",3,0)
SCMCEV1^^0^B12213060
"BLD",605,"KRN",9.8,"NM",4,0)
SCMCPM^^0^B6067527
"BLD",605,"KRN",9.8,"NM",5,0)
SCMCPM1^^0^B4331487
"BLD",605,"KRN",9.8,"NM",6,0)
SCMCTPM^^0^B35060487
"BLD",605,"KRN",9.8,"NM",7,0)
SCMCTPU^^0^B21252726
"BLD",605,"KRN",9.8,"NM",8,0)
SCRPU1^^0^B24892812
"BLD",605,"KRN",9.8,"NM",9,0)
SCMCTMM^^0^B39195599
"BLD",605,"KRN",9.8,"NM",10,0)
SCUTBK^^0^B10999430
"BLD",605,"KRN",9.8,"NM","B","SCAPMC18",1)

"BLD",605,"KRN",9.8,"NM","B","SCMCCON",2)

"BLD",605,"KRN",9.8,"NM","B","SCMCEV1",3)

"BLD",605,"KRN",9.8,"NM","B","SCMCPM",4)

"BLD",605,"KRN",9.8,"NM","B","SCMCPM1",5)

"BLD",605,"KRN",9.8,"NM","B","SCMCTMM",9)

"BLD",605,"KRN",9.8,"NM","B","SCMCTPM",6)

"BLD",605,"KRN",9.8,"NM","B","SCMCTPU",7)

"BLD",605,"KRN",9.8,"NM","B","SCRPU1",8)

"BLD",605,"KRN",9.8,"NM","B","SCUTBK",10)

"BLD",605,"KRN",19,0)
19
"BLD",605,"KRN",19.1,0)
19.1
"BLD",605,"KRN",101,0)
101
"BLD",605,"KRN",409.61,0)
409.61
"BLD",605,"KRN",771,0)
771
"BLD",605,"KRN",869.2,0)
869.2
"BLD",605,"KRN",870,0)
870
"BLD",605,"KRN",8994,0)
8994
"BLD",605,"KRN","B",.4,.4)

"BLD",605,"KRN","B",.401,.401)

"BLD",605,"KRN","B",.402,.402)

"BLD",605,"KRN","B",.403,.403)

"BLD",605,"KRN","B",.5,.5)

"BLD",605,"KRN","B",.84,.84)

"BLD",605,"KRN","B",3.6,3.6)

"BLD",605,"KRN","B",3.8,3.8)

"BLD",605,"KRN","B",9.2,9.2)

"BLD",605,"KRN","B",9.8,9.8)

"BLD",605,"KRN","B",19,19)

"BLD",605,"KRN","B",19.1,19.1)

"BLD",605,"KRN","B",101,101)

"BLD",605,"KRN","B",409.61,409.61)

"BLD",605,"KRN","B",771,771)

"BLD",605,"KRN","B",869.2,869.2)

"BLD",605,"KRN","B",870,870)

"BLD",605,"KRN","B",8994,8994)

"BLD",605,"QUES",0)
^9.62^^
"BLD",605,"REQB",0)
^9.611^1^1
"BLD",605,"REQB",1,0)
SD*5.3*100^2
"BLD",605,"REQB","B","SD*5.3*100",1)

"OER",16,0)
16^SD^^M.A.S.^
"OER",16,1,0)
^100.9951PA^2^2
"OER",16,1,1,0)
103
"OER",16,1,1,1,0)
^100.99511PA^1^1
"OER",16,1,1,1,1,0)
101
"OER",16,1,2,0)
645
"OER",16,1,2,1,0)
^100.99511PA^1^1
"OER",16,1,2,1,1,0)
121
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813
"PKG",16,22,1,"PAH",1,0)
130^2970807^12537
"PKG",16,22,1,"PAH",1,1,0)
^^1^1^2970829
"PKG",16,22,1,"PAH",1,1,1,0)
See NPM for description.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
10
"RTN","SCAPMC18")
0^1^B6575672
"RTN","SCAPMC18",1,0)
SCAPMC18 ;ALB/REW - Team APIs:ACPTCL ; 5 Jul 1995
"RTN","SCAPMC18",2,0)
 ;;5.3;Scheduling;**41,45,50,130**;AUG 13, 1993
"RTN","SCAPMC18",3,0)
 ;;1.0
"RTN","SCAPMC18",4,0)
ACPTCL(DFN,SCCL,SCFIELDA,SCACT,SCERR) ;add a patient to a team (pt tm assgn - #404.42
"RTN","SCAPMC18",5,0)
 ; input:
"RTN","SCAPMC18",6,0)
 ;  DFN     = pointer to PATIENT file (#2)
"RTN","SCAPMC18",7,0)
 ;  SCCL    = pointer to HOSPITAL LOCATION file (#44)
"RTN","SCAPMC18",8,0)
 ;  SCFIELDA= array of additional fields to be added
"RTN","SCAPMC18",9,0)
 ;  SCACT   = date to activate [default=DT]
"RTN","SCAPMC18",10,0)
 ;  SCERR = array NAME to store error messages.
"RTN","SCAPMC18",11,0)
 ;          [ex. ^TMP("ORXX",$J)]
"RTN","SCAPMC18",12,0)
 ;
"RTN","SCAPMC18",13,0)
 ; Output:
"RTN","SCAPMC18",14,0)
 ;  Returned = ien of enrollment multiple - 0 if none after^new?
"RTN","SCAPMC18",15,0)
 ;  SCERR() = Array of DIALOG file messages(errors).
"RTN","SCAPMC18",16,0)
 ;             Foramt:
"RTN","SCAPMC18",17,0)
 ;               Subscript: Sequential # from 1 to n
"RTN","SCAPMC18",18,0)
 ;               Piece     Description
"RTN","SCAPMC18",19,0)
 ;                 1       IEN of DIALOG file
"RTN","SCAPMC18",20,0)
 N SCPTCL,SCESEQ,SCPARM,SCIEN,SC,SCFLD,SCNEWCL,DIC,X,SCX,DLAYGO
"RTN","SCAPMC18",21,0)
 G:'$$OKDATA APTCLQ ;check/setup variables
"RTN","SCAPMC18",22,0)
 S SCPTCL=$$PTCLACT(DFN,SCCL,SCACT,.SCERR)
"RTN","SCAPMC18",23,0)
 IF SCPTCL G APTCLQ
"RTN","SCAPMC18",24,0)
 ELSE  D
"RTN","SCAPMC18",25,0)
 .S DIC="^DPT("_DFN_",""DE"","
"RTN","SCAPMC18",26,0)
 .S SCX=DIC_"0)"
"RTN","SCAPMC18",27,0)
 .L +@(SCX):5
"RTN","SCAPMC18",28,0)
 .IF '$T D:'$G(DGQUIET) EN^DDIOL("Enrollment being edited") Q
"RTN","SCAPMC18",29,0)
 .S DIC(0)="L"
"RTN","SCAPMC18",30,0)
 .S DIC("P")="2.001P"
"RTN","SCAPMC18",31,0)
 .S DA(1)=DFN
"RTN","SCAPMC18",32,0)
 .S X=SCCL
"RTN","SCAPMC18",33,0)
 .S DLAYGO=2
"RTN","SCAPMC18",34,0)
 .D FILE^DICN
"RTN","SCAPMC18",35,0)
 .IF (Y'>0) L -@(SCX)
"RTN","SCAPMC18",36,0)
 .S DIC=DIC_+Y_",1,"
"RTN","SCAPMC18",37,0)
 .S DIC("P")="2.011D"
"RTN","SCAPMC18",38,0)
 .S DA(1)=+Y
"RTN","SCAPMC18",39,0)
 .S DA(2)=DFN
"RTN","SCAPMC18",40,0)
 .S X=SCACT
"RTN","SCAPMC18",41,0)
 .IF $D(SCFIELDA) D
"RTN","SCAPMC18",42,0)
 ..K DIC("DR")
"RTN","SCAPMC18",43,0)
 ..S SCFLD=0
"RTN","SCAPMC18",44,0)
 ..F  S SCFLD=$O(@SCFIELDA@(SCFLD)) Q:'SCFLD  D
"RTN","SCAPMC18",45,0)
 ...S:'$D(DIC("DR")) DIC("DR")=SCFLD_"////"_@SCFIELDA@(SCFLD)
"RTN","SCAPMC18",46,0)
 ...S:$D(DIC("DR")) DIC("DR")=DIC("DR")_";"_SCFLD_"////"_@SCFIELDA@(SCFLD)
"RTN","SCAPMC18",47,0)
 .D FILE^DICN
"RTN","SCAPMC18",48,0)
 .S SCPTCL=$P(Y,U,2)
"RTN","SCAPMC18",49,0)
 .S SCNEWCL=$P(Y,U,3)
"RTN","SCAPMC18",50,0)
 .L -@(SCX)
"RTN","SCAPMC18",51,0)
APTCLQ Q +$G(SCPTCL)_U_+$G(SCNEWCL)
"RTN","SCAPMC18",52,0)
 ;
"RTN","SCAPMC18",53,0)
PTCLACT(DFN,SCCL,SCDT,SCERR) ;what is patient/clinic enrollment date on a given date-time? Return date or 0
"RTN","SCAPMC18",54,0)
 N SCDATES,SCCLLST,SCOK,SCDATES
"RTN","SCAPMC18",55,0)
 S SCOK=0
"RTN","SCAPMC18",56,0)
 S (SCDATES("BEGIN"),SCDATES("END"))=SCDT
"RTN","SCAPMC18",57,0)
 IF $$CLPT^SCAPMC(DFN,"SCDATES","","SCCLLST",.SCERR) S:$D(SCCLLST("SCCL",SCCL)) SCOK=$O(SCCLLST("SCCL",SCCL,0))
"RTN","SCAPMC18",58,0)
 Q SCOK
"RTN","SCAPMC18",59,0)
 ;
"RTN","SCAPMC18",60,0)
OKDATA() ;setup/check variables
"RTN","SCAPMC18",61,0)
 N SCOK
"RTN","SCAPMC18",62,0)
 S SCOK=1
"RTN","SCAPMC18",63,0)
 D INIT^SCAPMCU1(.SCOK)
"RTN","SCAPMC18",64,0)
 IF +$G(SCCL)'=$G(SCCL) D  S SCOK=0
"RTN","SCAPMC18",65,0)
 . S SCPARM("CLINIC")=$G(SCCL,"Undefined")
"RTN","SCAPMC18",66,0)
 . D ERR^SCAPMCU1(SCESEQ,4045101,.SCPARM,"",.SCERR)
"RTN","SCAPMC18",67,0)
 IF '$D(^SC(+$G(SCCL),0)) D  S SCOK=0
"RTN","SCAPMC18",68,0)
 . S SCPARM("CLINIC")=$G(SCCL,"Undefined")
"RTN","SCAPMC18",69,0)
 . D ERR^SCAPMCU1(SCESEQ,4045101,.SCPARM,"",.SCERR)
"RTN","SCAPMC18",70,0)
 IF '$D(^DPT(DFN,0)) D  S SCOK=0
"RTN","SCAPMC18",71,0)
 . S SCPARM("PATIENT")=DFN
"RTN","SCAPMC18",72,0)
 . D ERR^SCAPMCU1(SCESEQ,4045101,.SCPARM,"",.SCERR)
"RTN","SCAPMC18",73,0)
 S:'$G(SCACT) SCACT=DT
"RTN","SCAPMC18",74,0)
 Q SCOK
"RTN","SCMCCON")
0^2^B5568235
"RTN","SCMCCON",1,0)
SCMCCON ;ALB/REW - Patient Consult MailMessages ; 26 Mar 1996
"RTN","SCMCCON",2,0)
 ;;5.3;Scheduling;**41,87,100,130**;AUG 13, 1993
"RTN","SCMCCON",3,0)
 ;1
"RTN","SCMCCON",4,0)
MAIL(DFN,SCCLNM,ENORAP,DATE,SCTMCNA) ;Do Patient Team Changes MailMan Message
"RTN","SCMCCON",5,0)
 ;   DFN    - ien to PATIENT File
"RTN","SCMCCON",6,0)
 ;   SCCLNM - Name of Clinic
"RTN","SCMCCON",7,0)
 ;   ENORAP - Enrollment or Appointment? 1=Enrollment, 2=Appointment
"RTN","SCMCCON",8,0)
 ;   DATE   - Date of interest, Default =DT
"RTN","SCMCCON",9,0)
 ;   SCTMCNA- Array of teams affected
"RTN","SCMCCON",10,0)
 ;
"RTN","SCMCCON",11,0)
 ; - called by SCMC PT TEAM CHANGES MAIL MESSAGE protocol
"RTN","SCMCCON",12,0)
 G:$G(SCNOMAIL) END  ;- flag can be set to stop message generation
"RTN","SCMCCON",13,0)
 N XMDUZ,XMY,XMSUB,XMTEXT,VA,VAERR,XMZ,Y,SCCNXM
"RTN","SCMCCON",14,0)
 N SCTMAR,SCSTAT,SCNODE,SCY,SCSPACE,SCCNDTS,SCSTAT,SCTM
"RTN","SCMCCON",15,0)
 S SCCNDTS("BEGIN")=DATE,SCCNDTS("END")=DATE
"RTN","SCMCCON",16,0)
 S SCSTAT=$S(ENORAP=1:"Enrollment",(ENORAP=2):"Appointment",1:"")
"RTN","SCMCCON",17,0)
 S $P(SCSPACE," ",80)=""
"RTN","SCMCCON",18,0)
 ;   SCTMAR - ARRAY OF TEAMS (before & after)
"RTN","SCMCCON",19,0)
 ;set xmy array for practitioners in positions receiving consult notices
"RTN","SCMCCON",20,0)
 G:'$$PCMMXMY^SCAPMC25(4,DFN,SCTMCNA,"SCCMDTS",0) END
"RTN","SCMCCON",21,0)
 D:'$G(DGQUIET) EN^DDIOL("Sending Patient-Consult "_SCSTAT_" Message")
"RTN","SCMCCON",22,0)
 D PID^VADPT6
"RTN","SCMCCON",23,0)
 S SCPTNM=$P(^DPT(DFN,0),U,1)
"RTN","SCMCCON",24,0)
 S XMSUB=SCSTAT_" PATIENT-CLINIC "_SCSTAT_" for Patient ("_$E(SCPTNM,1)_VA("BID")_")",XMTEXT="SCCNXM(",SCLNCNT=0
"RTN","SCMCCON",25,0)
 D SETLN("This notice is sent because:")
"RTN","SCMCCON",26,0)
 D SETLN("  The patient had an "_SCSTAT_" to "_$G(SCCLNM)_" and")
"RTN","SCMCCON",27,0)
 D SETLN("  has restricted consults due to the following team assignment(s):")
"RTN","SCMCCON",28,0)
 S SCTM=0
"RTN","SCMCCON",29,0)
 F  S SCTM=$O(@SCTMCNA@(SCTM)) Q:'SCTM  D
"RTN","SCMCCON",30,0)
 .D SETLN("         "_@SCTMCNA@(SCTM))
"RTN","SCMCCON",31,0)
 S SCLNCNT=$$PCMAIL^SCMCMM(DFN,"SCCNXM",DT)
"RTN","SCMCCON",32,0)
 S XMDUZ=$G(DUZ,.5)
"RTN","SCMCCON",33,0)
 S XMY(XMDUZ)=""
"RTN","SCMCCON",34,0)
 D ^XMD
"RTN","SCMCCON",35,0)
END ;
"RTN","SCMCCON",36,0)
 Q
"RTN","SCMCCON",37,0)
 ;
"RTN","SCMCCON",38,0)
SETLN(TEXT) ;
"RTN","SCMCCON",39,0)
 Q:$G(TEXT)=""
"RTN","SCMCCON",40,0)
 ; increments SCLNCNT, adds text to sccnxm(sclncnt)
"RTN","SCMCCON",41,0)
 S SCLNCNT=SCLNCNT+1
"RTN","SCMCCON",42,0)
 S SCCNXM(SCLNCNT)=TEXT
"RTN","SCMCCON",43,0)
 Q
"RTN","SCMCCON",44,0)
 ;
"RTN","SCMCCON",45,0)
TEXT(SCFILE,SCNODE,SCPC,SCSPACE,SCLAB) ;returns fldname & external value
"RTN","SCMCCON",46,0)
 ;returns fldname & external value
"RTN","SCMCCON",47,0)
 ;   Note- Only works for non wp fields of standard numbering conventions
"RTN","SCMCCON",48,0)
 ;   SCFLILE =FILENUM
"RTN","SCMCCON",49,0)
 ;   SCNODE  = 0 NODE
"RTN","SCMCCON",50,0)
 ;   SCPC    = piece of node
"RTN","SCMCCON",51,0)
 ;   SCSPACE = 80 SPACES
"RTN","SCMCCON",52,0)
 ;   SCLAB = 1 if print field name
"RTN","SCMCCON",53,0)
 N SCX,SCINT,SCFLD
"RTN","SCMCCON",54,0)
 S SCX=""
"RTN","SCMCCON",55,0)
 S SCINT=$P(SCNODE,U,SCPC)
"RTN","SCMCCON",56,0)
 G:SCINT="" QTTXT
"RTN","SCMCCON",57,0)
 S SCFLD=SCPC*.01
"RTN","SCMCCON",58,0)
 ;;;
"RTN","SCMCCON",59,0)
 IF $G(SCLAB) D
"RTN","SCMCCON",60,0)
 .S SCX=$$DDNAME^SCMCTMM(SCFLD)_":"
"RTN","SCMCCON",61,0)
 .S:$G(SCLAB)=1 SCX=SCX_$E(SCSPACE,1,(23-$L(SCX)))
"RTN","SCMCCON",62,0)
 .S:$G(SCLAB)=2 SCX=SCX_$E(SCSPACE,1,(50-$L(SCX)))
"RTN","SCMCCON",63,0)
 S:SCINT]"" SCX=SCX_$$EXTERNAL^DILFD(SCFILE,SCFLD,"",SCINT)
"RTN","SCMCCON",64,0)
QTTXT Q SCX
"RTN","SCMCEV1")
0^3^B12213060
"RTN","SCMCEV1",1,0)
SCMCEV1 ;ALB/CMM - TEAM EVENT DRIVER UTILITIES ; 03/20/96
"RTN","SCMCEV1",2,0)
 ;;5.3;Scheduling;**41,130**;AUG 13, 1993
"RTN","SCMCEV1",3,0)
 ;
"RTN","SCMCEV1",4,0)
ENROLL(DFN,TIEN,ENDATE,DISDATE,CNAME) ;
"RTN","SCMCEV1",5,0)
 ;enroll DFN patient in team TIEN
"RTN","SCMCEV1",6,0)
 ;DFN - patient ien
"RTN","SCMCEV1",7,0)
 ;TIEN - team ien
"RTN","SCMCEV1",8,0)
 ;ENDATE - clinic enrollment date
"RTN","SCMCEV1",9,0)
 ;DISDATE - clinic discharge date
"RTN","SCMCEV1",10,0)
 ;CNAME - clinic name
"RTN","SCMCEV1",11,0)
 ;
"RTN","SCMCEV1",12,0)
 N OKAY,ERR,PUR,SC,SCERR,TNAME,TEXT
"RTN","SCMCEV1",13,0)
 S TNAME=$P($G(^SCTM(404.51,TIEN,0)),"^") ;team name
"RTN","SCMCEV1",14,0)
 S OKAY=$$ACPTTM^SCAPMC6(DFN,TIEN,,ENDATE,"ERR")
"RTN","SCMCEV1",15,0)
 I OKAY=0 Q
"RTN","SCMCEV1",16,0)
 ;okay = ien of 404.42
"RTN","SCMCEV1",17,0)
 S PUR(1,0)="Automatic Team Enrollment/Update via Clinic: "_CNAME
"RTN","SCMCEV1",18,0)
 I '$D(SCERR) D
"RTN","SCMCEV1",19,0)
 .D WP^DIE(404.42,+OKAY_",","1","A","PUR","SCERR")
"RTN","SCMCEV1",20,0)
 .S TEXT="Enrolled in Team: "_TNAME
"RTN","SCMCEV1",21,0)
 .D:'$G(DGQUIET) EN^DDIOL(TEXT,"","!,?10")
"RTN","SCMCEV1",22,0)
 K SCERR,ERR
"RTN","SCMCEV1",23,0)
 I $D(DISDATE) D
"RTN","SCMCEV1",24,0)
 .S PUR(1,0)="Automatic Team Discharge via Clinic: "_CNAME
"RTN","SCMCEV1",25,0)
 .Q:'$$POSASS^SCMCEV2(DFN,TIEN)
"RTN","SCMCEV1",26,0)
 .S OKAY=$$INPTTM^SCAPMC7(DFN,TIEN,DISDATE,"ERR")
"RTN","SCMCEV1",27,0)
 .I OKAY'=0 D
"RTN","SCMCEV1",28,0)
 ..D WP^DIE(404.42,+OKAY_",","1","A","PUR","SCERR")
"RTN","SCMCEV1",29,0)
 ..S TEXT="Discharged from Team: "_TNAME
"RTN","SCMCEV1",30,0)
 ..D:'$G(DGQUIET) EN^DDIOL(TEXT,"","!,?10")
"RTN","SCMCEV1",31,0)
 Q
"RTN","SCMCEV1",32,0)
 ;
"RTN","SCMCEV1",33,0)
UPDATE(DFN,TIEN,EDATE,DDATE,CNAME) ;
"RTN","SCMCEV1",34,0)
 ;update enrollment date/discharge date
"RTN","SCMCEV1",35,0)
 ;DFN - patient ien
"RTN","SCMCEV1",36,0)
 ;TIEN - team ien
"RTN","SCMCEV1",37,0)
 ;EDATE - enrollment date
"RTN","SCMCEV1",38,0)
 ;DDATE - discharge date
"RTN","SCMCEV1",39,0)
 ;CNAME - clinic name
"RTN","SCMCEV1",40,0)
 ;
"RTN","SCMCEV1",41,0)
 N TPA,TDATE,TEXT,TNAME
"RTN","SCMCEV1",42,0)
 S TNAME=$P($G(^SCTM(404.51,TIEN,0)),"^") ;team name
"RTN","SCMCEV1",43,0)
 I '$D(^SCPT(404.42,"AIDT",DFN,TIEN)) D ENROLL(TIEN,DFN,EDATE,DDATE,CNAME) Q
"RTN","SCMCEV1",44,0)
 ; ^ new enrollment
"RTN","SCMCEV1",45,0)
 S TDATE=$O(^SCPT(404.42,"AIDT",DFN,TIEN,"")) ; -team assignment date (most recent)
"RTN","SCMCEV1",46,0)
 S TPA=$O(^SCPT(404.42,"AIDT",DFN,TIEN,TDATE,"")) ; team assignment ien
"RTN","SCMCEV1",47,0)
 Q:'$D(^SCPT(404.42,+TPA,0))
"RTN","SCMCEV1",48,0)
 K SC($J,404.42),SCERR
"RTN","SCMCEV1",49,0)
 I EDATE'=0 D
"RTN","SCMCEV1",50,0)
 .S SC($J,404.42,TPA_",",.13)=DUZ
"RTN","SCMCEV1",51,0)
 .S SC($J,404.42,TPA_",",.14)=DT
"RTN","SCMCEV1",52,0)
 .S SC($J,404.42,TPA_",",.02)=$P(EDATE,".") ;date only
"RTN","SCMCEV1",53,0)
 .D FILE^DIE("","SC($J)","SCERR")
"RTN","SCMCEV1",54,0)
 .S PUR(1,0)="Automatic Team Update via Clinic:  "_CNAME
"RTN","SCMCEV1",55,0)
 .D WP^DIE(404.42,TPA_",","1","A","PUR","SCERR")
"RTN","SCMCEV1",56,0)
 .S TEXT="Update Team Enrollment "_TNAME
"RTN","SCMCEV1",57,0)
 .D:'$G(DGQUIET) EN^DDIOL(TEXT,"","!,?10")
"RTN","SCMCEV1",58,0)
 I +DDATE'=0 D
"RTN","SCMCEV1",59,0)
 .Q:'$$POSASS^SCMCEV2(DFN,TIEN)
"RTN","SCMCEV1",60,0)
 .; ^ assigned to a position
"RTN","SCMCEV1",61,0)
 .S OKAY=$$INPTTM^SCAPMC7(DFN,TPA,DDATE,"ERR") ; discharge from team
"RTN","SCMCEV1",62,0)
 .I OKAY'=0 D
"RTN","SCMCEV1",63,0)
 ..D WP^DIE(404.42,+OKAY_",","1","A","PUR","SCERR")
"RTN","SCMCEV1",64,0)
 ..S TEXT="Discharged from Team: "_TNAME
"RTN","SCMCEV1",65,0)
 ..D:'$G(DGQUIET) EN^DDIOL(TEXT,"","!,?10")
"RTN","SCMCEV1",66,0)
 Q
"RTN","SCMCEV1",67,0)
 ;
"RTN","SCMCEV1",68,0)
DELT(DFN,CLN) ;deleted clinic entry/enrollment date w/'@'
"RTN","SCMCEV1",69,0)
 ;DFN - patient ien
"RTN","SCMCEV1",70,0)
 ;CLN - clinic ien
"RTN","SCMCEV1",71,0)
 ;
"RTN","SCMCEV1",72,0)
 N CHECK,TM,EDATE,OKAY,CNAME,ERR,TEXT,TNAME
"RTN","SCMCEV1",73,0)
 S CNAME=$P($G(^SC(+CLN,0)),"^") ;clinic name
"RTN","SCMCEV1",74,0)
 S CHECK=$$CHK^SCMCEV2(DFN,CLN,2)
"RTN","SCMCEV1",75,0)
 ; ^ auto discharge okay
"RTN","SCMCEV1",76,0)
 Q:'+CHECK
"RTN","SCMCEV1",77,0)
 ;check if assigned to a position on team
"RTN","SCMCEV1",78,0)
 S TM=+$P(CHECK,"^",2) ;team ien
"RTN","SCMCEV1",79,0)
 S OKAY=$$POSASS^SCMCEV2(DFN,TM)
"RTN","SCMCEV1",80,0)
 Q:'OKAY
"RTN","SCMCEV1",81,0)
 ;delete entry
"RTN","SCMCEV1",82,0)
 S ERR=$$DELTE(DFN,TM)
"RTN","SCMCEV1",83,0)
 I ERR D
"RTN","SCMCEV1",84,0)
 .;deleted entry
"RTN","SCMCEV1",85,0)
 .S TNAME=$P($G(^SCTM(404.51,TM,0)),"^") ;team name
"RTN","SCMCEV1",86,0)
 .S TEXT="Deleted team "_TNAME_" assignment due to deleting clinic assignment"
"RTN","SCMCEV1",87,0)
 .D:'$G(DGQUIET) EN^DDIOL(TEXT,"","!,?10")
"RTN","SCMCEV1",88,0)
 Q
"RTN","SCMCEV1",89,0)
 ;
"RTN","SCMCEV1",90,0)
DELTE(DFN,TIEN) ;delete team assignment entry
"RTN","SCMCEV1",91,0)
 ;DFN - patient ien
"RTN","SCMCEV1",92,0)
 ;TIEN - team ien
"RTN","SCMCEV1",93,0)
 N PTA,ADATE,RET
"RTN","SCMCEV1",94,0)
 S RET=1
"RTN","SCMCEV1",95,0)
 S ADATE=$O(^SCPT(404.42,"AIDT",DFN,TIEN,-(DT+1)))
"RTN","SCMCEV1",96,0)
 I ADATE="" S RET=0 G EXD
"RTN","SCMCEV1",97,0)
 S PTA=$O(^SCPT(404.42,"AIDT",DFN,TIEN,ADATE,""))
"RTN","SCMCEV1",98,0)
 I PTA="" S RET=0 G EXD
"RTN","SCMCEV1",99,0)
 S DA=PTA,DIK="^SCPT(404.42,"
"RTN","SCMCEV1",100,0)
 D ^DIK
"RTN","SCMCEV1",101,0)
 K DA,DIK
"RTN","SCMCEV1",102,0)
EXD Q RET
"RTN","SCMCPM")
0^4^B6067527
"RTN","SCMCPM",1,0)
SCMCPM ;ALB/REW - Inpatient Activity MailMan Message ; 7 Mar 1996
"RTN","SCMCPM",2,0)
 ;;5.3;Scheduling;**41,87,100,130**;AUG 13, 1993
"RTN","SCMCPM",3,0)
 ;
"RTN","SCMCPM",4,0)
MAIL ;do Inpatient MailMan Message
"RTN","SCMCPM",5,0)
 N SCPMXM,SCPTNM,SCPMDT,SCPCPR,SCPCTM,SCPCAT,SCTRANS,XMDUZ,SCLNCNT,XMY,XMSUB,XMTEXT,VA,VAERR,SCTRANNM,XMZ,Y,SCORIGA,SCNODE,SCPHYND
"RTN","SCMCPM",6,0)
 S SCORIGA=$G(^DGPM(+$P(DGPMA,U,14),0))
"RTN","SCMCPM",7,0)
 S SCPMDT("BEGIN")=+DGPMA
"RTN","SCMCPM",8,0)
 S SCPMDT("END")=DT
"RTN","SCMCPM",9,0)
 S SCPMDT("INCL")=0
"RTN","SCMCPM",10,0)
 ;set xmy array for practitioners in positions receiving inpt notices
"RTN","SCMCPM",11,0)
 G:'$$PCMMXMY^SCAPMC25(2,DFN,,"SCPMDT",0) END
"RTN","SCMCPM",12,0)
 S SCTRANS=+$P(DGPMA,U,2),SCTRANNM=$P($G(^DG(405.3,SCTRANS,0)),U,1)
"RTN","SCMCPM",13,0)
 G:("^1^2^3^")'[(U_SCTRANS_U) END  ;must be admit,transfer or discharge
"RTN","SCMCPM",14,0)
 D:'$G(DGQUIET) EN^DDIOL("Sending INPATIENT "_SCTRANNM_" Message")
"RTN","SCMCPM",15,0)
 D PID^VADPT6
"RTN","SCMCPM",16,0)
 S SCPTNM=$P(^DPT(DFN,0),U,1)
"RTN","SCMCPM",17,0)
 S XMSUB="INPATIENT "_SCTRANNM_" for Patient ("_$E(SCPTNM,1)_VA("BID")_")",XMTEXT="SCPMXM(",SCLNCNT=0
"RTN","SCMCPM",18,0)
 D SETLN("Patient:                 "_SCPTNM_"("_VA("PID")_")")
"RTN","SCMCPM",19,0)
 D SETLN("Transaction:             "_SCTRANNM)
"RTN","SCMCPM",20,0)
 S Y=+DGPMA X ^DD("DD") D SETLN("Date/Time:               "_Y)
"RTN","SCMCPM",21,0)
 ;if movement is not original movement
"RTN","SCMCPM",22,0)
 IF DGPMA'=SCORIGA D
"RTN","SCMCPM",23,0)
 .S Y=+SCORIGA X ^DD("DD") D SETLN("Admission Date/Time:     "_Y)
"RTN","SCMCPM",24,0)
 D SETLN("Type of Movement:        "_$P($G(^DG(405.1,+$P(DGPMA,U,4),0)),U,1))
"RTN","SCMCPM",25,0)
 S SCNODE=$S(SCTRANS=3:DGPMP,1:DGPMA)
"RTN","SCMCPM",26,0)
 S VAIP("E")=$S($G(DGPMDA):+DGPMDA,1:$P(SCORIGA,U,14)) D IN5^VADPT
"RTN","SCMCPM",27,0)
 S SCPHYND=$S(SCTRANS=3:$G(VAIP(17,5)),1:$G(VAIP(14,5)))
"RTN","SCMCPM",28,0)
 D SETLN(" ")
"RTN","SCMCPM",29,0)
 D SETLN("Ward Location:           "_$S(SCTRANS=3:$P($G(VAIP(17,4)),U,2),1:$P($G(VAIP(14,4)),U,2)))
"RTN","SCMCPM",30,0)
 D SETLN("Room-Bed:                "_$S($L($P($G(^DPT(DFN,.101)),U,1)):$P(^(.101),U,1),1:$P($G(^DG(405.4,+$P(SCNODE,U,7),0)),U,1)))
"RTN","SCMCPM",31,0)
 D SETLN("Inpatient Provider:      "_$P(SCPHYND,U,2))
"RTN","SCMCPM",32,0)
 D SETLN("Admitting DX:            "_$P(SCORIGA,U,10))
"RTN","SCMCPM",33,0)
 S SCLNCNT=$$PCMAIL^SCMCMM(DFN,"SCPMXM",DT) ;standard pc info into mail
"RTN","SCMCPM",34,0)
 S XMDUZ=$G(DUZ,.5)
"RTN","SCMCPM",35,0)
 S XMY(XMDUZ)=""
"RTN","SCMCPM",36,0)
 D ^XMD
"RTN","SCMCPM",37,0)
 D KVAR^VADPT
"RTN","SCMCPM",38,0)
END ;
"RTN","SCMCPM",39,0)
 Q
"RTN","SCMCPM",40,0)
 ;
"RTN","SCMCPM",41,0)
SETLN(TEXT) ;
"RTN","SCMCPM",42,0)
 ; increments SCLNCNT, adds text to scpmxm(sclncnt)
"RTN","SCMCPM",43,0)
 S SCLNCNT=SCLNCNT+1
"RTN","SCMCPM",44,0)
 S SCPMXM(SCLNCNT)=TEXT
"RTN","SCMCPM",45,0)
 Q
"RTN","SCMCPM1")
0^5^B4331487
"RTN","SCMCPM1",1,0)
SCMCPM1 ;ALB/REW - Pt PC Team Assignment on Inpt Discharge ; 1 Apr 1996
"RTN","SCMCPM1",2,0)
 ;;5.3;Scheduling;**41,130**;AUG 13, 1993
"RTN","SCMCPM1",3,0)
 ;
"RTN","SCMCPM1",4,0)
PCMMDIS ; - called by 'SC ASSIGN PC TEAM ON DISCHARGE' which is 
"RTN","SCMCPM1",5,0)
 ;   called by the patient movement event driver
"RTN","SCMCPM1",6,0)
 Q:$D(ZTQUEUED)  ;interactive - quit if queued
"RTN","SCMCPM1",7,0)
 ;check if patient has a current PC team if no prompt to enroll
"RTN","SCMCPM1",8,0)
 Q:$P($G(DGPMA),U,2)'=3  ;must be a discharge
"RTN","SCMCPM1",9,0)
 Q:'$G(DFN)  ;should exist
"RTN","SCMCPM1",10,0)
 Q:'$P($G(^SD(404.91,1,"PCMM")),U,2)  ; check turn off flag
"RTN","SCMCPM1",11,0)
 N DIR,DIRUT,DIROUT,SCTMERR,DIC,X,Y,SCOK,SCX,SCOUTFLD,SCBADOUT
"RTN","SCMCPM1",12,0)
 D:'$G(DGQUIET) EN^DDIOL("Checking Primary Care Status...")
"RTN","SCMCPM1",13,0)
 ;display PC info, check if patient has a current PC team
"RTN","SCMCPM1",14,0)
 D PCMM^SCRPU4(DFN,DT)
"RTN","SCMCPM1",15,0)
 G:$$NMPCTM^SCAPMCU2(DFN,DT,1) END
"RTN","SCMCPM1",16,0)
 ;if not, check if patient has a PC team in the future
"RTN","SCMCPM1",17,0)
 S SCOK=$$YSPTTMPC^SCMCTMU2(DFN,DT)
"RTN","SCMCPM1",18,0)
 IF 'SCOK D  G END
"RTN","SCMCPM1",19,0)
 .D:'$G(DGQUIET) EN^DDIOL($P(SCOK,U,2))
"RTN","SCMCPM1",20,0)
 ;if not either, ask if they want to assign a patient to a PC team
"RTN","SCMCPM1",21,0)
 S DIR(0)="Y"
"RTN","SCMCPM1",22,0)
 S DIR("A")="Do you wish to assign patient to Primary Care"
"RTN","SCMCPM1",23,0)
 S DIR("B")="NO"
"RTN","SCMCPM1",24,0)
 D ^DIR
"RTN","SCMCPM1",25,0)
 G:'Y END
"RTN","SCMCPM1",26,0)
 S DIR(0)="Y"
"RTN","SCMCPM1",27,0)
 S DIR("A")="Do you wish to assign patient to a Primary Care Team"
"RTN","SCMCPM1",28,0)
 S DIR("B")="NO"
"RTN","SCMCPM1",29,0)
 D ^DIR
"RTN","SCMCPM1",30,0)
 IF 'Y D  G END
"RTN","SCMCPM1",31,0)
 .S SCOUTFLD(.04)=1
"RTN","SCMCPM1",32,0)
 .S SCX=$$ACOUTPT^SCAPMC20(DFN,"SCOUTFLD","SCBADOUT")
"RTN","SCMCPM1",33,0)
 .D:SCX&'($G(DGQUIET)) EN^DDIOL("Patient Assigned to Primary Care, but no Team Assigned...")
"RTN","SCMCPM1",34,0)
 S DIC="^SCTM(404.51,"
"RTN","SCMCPM1",35,0)
 S DIC(0)="AEMQZ"
"RTN","SCMCPM1",36,0)
 S DIC("S")="IF $$ACTTM^SCMCTMU(Y,DT)&($P($G(^SCTM(404.51,Y,0)),U,5))"
"RTN","SCMCPM1",37,0)
 ;  - select from active teams that can be PC Teams
"RTN","SCMCPM1",38,0)
 D ^DIC
"RTN","SCMCPM1",39,0)
 G:Y<1 END
"RTN","SCMCPM1",40,0)
 S SCTM=+Y
"RTN","SCMCPM1",41,0)
 ;setup fields
"RTN","SCMCPM1",42,0)
 S SCTMFLDS(.02)=DT
"RTN","SCMCPM1",43,0)
 S SCTMFLDS(.08)=1 ;primary care assignment
"RTN","SCMCPM1",44,0)
 S SCTMFLDS(.11)=$G(DUZ,.5)
"RTN","SCMCPM1",45,0)
 D NOW^%DTC S SCTMFLDS(.12)=%
"RTN","SCMCPM1",46,0)
 IF $$ACPTTM^SCAPMC(DFN,SCTM,"SCTMFLDS",DT,"SCTPTME") D
"RTN","SCMCPM1",47,0)
 .D:'$G(DGQUIET) EN^DDIOL("...PC Team Assignment Made")
"RTN","SCMCPM1",48,0)
END ;
"RTN","SCMCPM1",49,0)
 Q
"RTN","SCMCTMM")
0^9^B39195599
"RTN","SCMCTMM",1,0)
SCMCTMM ;ALB/REW - Patient Team Changes MailMessages ; 26 Mar 1996
"RTN","SCMCTMM",2,0)
 ;;5.3;Scheduling;**41,45,87,100,130**;AUG 13, 1993
"RTN","SCMCTMM",3,0)
 ;1
"RTN","SCMCTMM",4,0)
MAIL ;Do Patient Team Changes MailMan Message
"RTN","SCMCTMM",5,0)
 ; - called by SCMC PT TEAM CHANGES MAIL MESSAGE protocol
"RTN","SCMCTMM",6,0)
 G:$G(SCNOMAIL) END  ;- flag can be set to stop message generation
"RTN","SCMCTMM",7,0)
 N XMDUZ,XMY,XMSUB,XMTEXT,VA,VAERR,XMZ,Y,SCX,ZTQUEUED
"RTN","SCMCTMM",8,0)
 N SCTMAR,SCSTAT,DFN,SCNODE,SCY,SCSPACE,SCPAD,SCPHONE,SCB,SCE,SCB2,SCE2,SCTMDT,SCTMXM,SCPTNM,SCLNCNT
"RTN","SCMCTMM",9,0)
 S ZTQUEUED=1
"RTN","SCMCTMM",10,0)
 S $P(SCSPACE," ",80)=""
"RTN","SCMCTMM",11,0)
 ;   SCTMAR - ARRAY OF TEAMS (before & after)
"RTN","SCMCTMM",12,0)
 S:SCTMB4 SCTMAR(SCTMB4)=""
"RTN","SCMCTMM",13,0)
 S:SCTMAF SCTMAR(SCTMAF)=""
"RTN","SCMCTMM",14,0)
 IF 'SCTMAF D
"RTN","SCMCTMM",15,0)
 .S SCSTAT="DELETED",SCB=$P(SCTMB4,U,2),SCE=$S($P(SCPTTMB4,U,9):$P(SCPTTMB4,U,9),1:DT)
"RTN","SCMCTMM",16,0)
 IF 'SCTMB4 D
"RTN","SCMCTMM",17,0)
 .S SCSTAT="NEW",SCB=$P(SCTMAF,U,2),SCE=$S($P(SCPTTMAF,U,9):$P(SCPTTMAF,U,9),1:DT)
"RTN","SCMCTMM",18,0)
 IF SCTMB4&SCTMAF D
"RTN","SCMCTMM",19,0)
 .S SCSTAT="CHANGED"
"RTN","SCMCTMM",20,0)
 .S SCB=$P(SCTMB4,U,2),SCE=$S($P(SCPTTMB4,U,9):$P(SCPTTMB4,U,9),1:DT)
"RTN","SCMCTMM",21,0)
 .S SCB2=$P(SCTMAF,U,2),SCE2=$S($P(SCPTTMAF,U,9):$P(SCPTTMAF,U,9),1:DT)
"RTN","SCMCTMM",22,0)
 .S SCTMDT("BEGIN")=$S(SCB<SCB2:SCB,1:SCB2)
"RTN","SCMCTMM",23,0)
 .S SCTMDT("END")=$S(SCE>SCE2:SCE,1:SCE2)
"RTN","SCMCTMM",24,0)
 .S SCTMDT("INCL")=0
"RTN","SCMCTMM",25,0)
 IF SCSTAT="NEW"!(SCSTAT="DELETED") D
"RTN","SCMCTMM",26,0)
 .S SCTMDT("BEGIN")=SCB
"RTN","SCMCTMM",27,0)
 .S SCTMDT("END")=SCE
"RTN","SCMCTMM",28,0)
 .S SCTMDT("INCL")=0
"RTN","SCMCTMM",29,0)
 S DFN=$S(SCSTAT="DELETED":+SCPTTMB4,1:+SCPTTMAF)
"RTN","SCMCTMM",30,0)
 ;set xmy array for practitioners in positions receiving tmchg notices
"RTN","SCMCTMM",31,0)
 G:'$$PCMMXMY^SCAPMC25(3,DFN,"SCTMAR","SCTMDT",0) END
"RTN","SCMCTMM",32,0)
 D:'$G(DGQUIET) EN^DDIOL("Sending "_SCSTAT_" Patient-Team Assignment Message")
"RTN","SCMCTMM",33,0)
 D PID^VADPT6
"RTN","SCMCTMM",34,0)
 S SCPTNM=$P(^DPT(DFN,0),U,1)
"RTN","SCMCTMM",35,0)
 S XMSUB=SCSTAT_" PATIENT-TEAM ASSIGNMENT for Patient ("_$E(SCPTNM,1)_$G(VA("BID"))_")",XMTEXT="^TMP($J,""SCTMXM"",",SCLNCNT=0
"RTN","SCMCTMM",36,0)
 IF SCSTAT="NEW" D
"RTN","SCMCTMM",37,0)
 .D SETLN("Current Patient Team Data:")
"RTN","SCMCTMM",38,0)
 .D SETLN("==========================")
"RTN","SCMCTMM",39,0)
 .F SCX=1:1:14 D
"RTN","SCMCTMM",40,0)
 ..D SETLN($$TEXT(404.42,SCPTTMAF,SCX,SCSPACE,1))
"RTN","SCMCTMM",41,0)
 IF SCSTAT="DELETED" D
"RTN","SCMCTMM",42,0)
 .D SETLN("Previous Patient Team Data:")
"RTN","SCMCTMM",43,0)
 .D SETLN("===========================")
"RTN","SCMCTMM",44,0)
 .F SCX=1:1:14 S SCFLD=SCX*.01 D
"RTN","SCMCTMM",45,0)
 ..D SETLN($$TEXT(404.42,SCPTTMB4,SCX,SCSPACE,1))
"RTN","SCMCTMM",46,0)
 IF SCSTAT="CHANGED" D
"RTN","SCMCTMM",47,0)
 .D SETLN("Fields: "_$E(SCSPACE,1,15)_"Previous Data:             Current Patient Data:")
"RTN","SCMCTMM",48,0)
 .D SETLN("=======================================================================")
"RTN","SCMCTMM",49,0)
 .F SCX=1:1:14 S SCFLD=SCX*.01 D
"RTN","SCMCTMM",50,0)
 ..N SCLAB2,SCY,SCZ
"RTN","SCMCTMM",51,0)
 ..S SCY=$$TEXT(404.42,SCPTTMB4,SCX,SCSPACE,1)
"RTN","SCMCTMM",52,0)
 ..S:'$L(SCY) SCLAB2=2
"RTN","SCMCTMM",53,0)
 ..S SCZ=$$TEXT(404.42,SCPTTMAF,SCX,SCSPACE,+$G(SCLAB2))
"RTN","SCMCTMM",54,0)
 ..D:$L(SCY)!($L(SCZ)) SETLN(SCY_$E(SCSPACE,1,(50-$L(SCY)))_SCZ)
"RTN","SCMCTMM",55,0)
 S SCLNCNT=$$PCMAIL^SCMCMM(DFN,"^TMP($J,""SCTMXM"")",DT)
"RTN","SCMCTMM",56,0)
 S XMDUZ=$G(DUZ,.5)
"RTN","SCMCTMM",57,0)
 S XMY(XMDUZ)=""
"RTN","SCMCTMM",58,0)
 D ^XMD
"RTN","SCMCTMM",59,0)
END K ^TMP($J,"SCTMXM")
"RTN","SCMCTMM",60,0)
 Q
"RTN","SCMCTMM",61,0)
 ;
"RTN","SCMCTMM",62,0)
SETLN(TEXT) ;
"RTN","SCMCTMM",63,0)
 Q:$G(TEXT)=""
"RTN","SCMCTMM",64,0)
 ; increments SCLNCNT, adds text to sctmxm(sclncnt)
"RTN","SCMCTMM",65,0)
 S SCLNCNT=SCLNCNT+1
"RTN","SCMCTMM",66,0)
 S ^TMP($J,"SCTMXM",SCLNCNT)=TEXT
"RTN","SCMCTMM",67,0)
 Q
"RTN","SCMCTMM",68,0)
 ;
"RTN","SCMCTMM",69,0)
TEXT(SCFILE,SCNODE,SCPC,SCSPACE,SCLAB) ;returns fldname & external value
"RTN","SCMCTMM",70,0)
 ;returns fldname & external value
"RTN","SCMCTMM",71,0)
 ;   Note- Only works for non wp fields of standard numbering conventions
"RTN","SCMCTMM",72,0)
 ;   SCFLILE =FILENUM
"RTN","SCMCTMM",73,0)
 ;   SCNODE  = 0 NODE
"RTN","SCMCTMM",74,0)
 ;   SCPC    = piece of node
"RTN","SCMCTMM",75,0)
 ;   SCSPACE = 80 SPACES
"RTN","SCMCTMM",76,0)
 ;   SCLAB = 1 if print field name
"RTN","SCMCTMM",77,0)
 N SCX,SCINT,SCFLD
"RTN","SCMCTMM",78,0)
 S SCX=""
"RTN","SCMCTMM",79,0)
 S SCINT=$P(SCNODE,U,SCPC)
"RTN","SCMCTMM",80,0)
 G:SCINT="" QTTXT
"RTN","SCMCTMM",81,0)
 S SCFLD=SCPC*.01
"RTN","SCMCTMM",82,0)
 ;;;
"RTN","SCMCTMM",83,0)
 IF $G(SCLAB) D
"RTN","SCMCTMM",84,0)
 .S SCX=$$DDNAME(SCFILE,SCFLD)_":"
"RTN","SCMCTMM",85,0)
 .S:$G(SCLAB)=1 SCX=SCX_$E(SCSPACE,1,(23-$L(SCX)))
"RTN","SCMCTMM",86,0)
 .S:$G(SCLAB)=2 SCX=SCX_$E(SCSPACE,1,(50-$L(SCX)))
"RTN","SCMCTMM",87,0)
 S:SCINT]"" SCX=SCX_$$EXTERNAL^DILFD(SCFILE,SCFLD,"",SCINT)
"RTN","SCMCTMM",88,0)
QTTXT Q SCX
"RTN","SCMCTMM",89,0)
 ;
"RTN","SCMCTMM",90,0)
DDNAME(FILE,FIELD) ;return the fieldname
"RTN","SCMCTMM",91,0)
 N SCX
"RTN","SCMCTMM",92,0)
 D FIELD^DID(FILE,FIELD,"","LABEL","SCX")
"RTN","SCMCTMM",93,0)
 Q $G(SCX("LABEL"))
"RTN","SCMCTMM",94,0)
 ;
"RTN","SCMCTMM",95,0)
MAILLST(SCTM,SCFIELDA,SCDATE,SCNEWTM,SCOLDTM,SCBADTM) ;
"RTN","SCMCTMM",96,0)
 ; Input:
"RTN","SCMCTMM",97,0)
 ;    SCTM     - Pointer to Team File (#404.51)
"RTN","SCMCTMM",98,0)
 ;    SCFIELDA - Field array with internal values
"RTN","SCMCTMM",99,0)
 ;    SCDATE   - Effective Date
"RTN","SCMCTMM",100,0)
 ;    SCNEWTM  - DFN array of newly assigned to team
"RTN","SCMCTMM",101,0)
 ;    SCOLDTM  - DFN array of previously assigned to team
"RTN","SCMCTMM",102,0)
 ;    SCBADTM  - DFN array of patients unassignable to team
"RTN","SCMCTMM",103,0)
 ;
"RTN","SCMCTMM",104,0)
 G:$G(SCNOMAIL) QTMULT  ;- flag can be set to stop message generation
"RTN","SCMCTMM",105,0)
 G:'$D(SCNEWTM) QTMULT
"RTN","SCMCTMM",106,0)
 G:'$O(@SCNEWTM@(0)) QTMULT  ;if no new assignments
"RTN","SCMCTMM",107,0)
 N XMDUZ,XMY,XMSUB,XMTEXT,VA,VAERR,XMZ,Y,ZTQUEUED
"RTN","SCMCTMM",108,0)
 N SCTMNM,DFN,SCOK,SCPTNM,SCFLD,SCNODE,SCNDX,SCSPACE,SCE,SCB,SCTMDT,SCDELTEM
"RTN","SCMCTMM",109,0)
 S ZTQUEUED=1
"RTN","SCMCTMM",110,0)
 S SCDELTEM=1 ;ok to delete tmp global
"RTN","SCMCTMM",111,0)
 IF $D(SCFIELDA) D
"RTN","SCMCTMM",112,0)
 .IF $D(SCFIELDA(.02)) S SCB=SCFIELDA(.02)
"RTN","SCMCTMM",113,0)
 .IF $D(SCFIELDA(.09)) S SCE=SCFIELDA(.09)
"RTN","SCMCTMM",114,0)
 S SCB=$G(SCB,DT)
"RTN","SCMCTMM",115,0)
 S SCE=$G(SCE,DT)
"RTN","SCMCTMM",116,0)
 S $P(SCSPACE," ",80)=""
"RTN","SCMCTMM",117,0)
 S SCTMDT("BEGIN")=$S(SCB<SCDATE:SCB,1:SCDATE)
"RTN","SCMCTMM",118,0)
 S SCTMDT("END")=$S(SCE>SCDATE:SCE,1:SCDATE)
"RTN","SCMCTMM",119,0)
 S SCTMDT("INCL")=0
"RTN","SCMCTMM",120,0)
 S SCTMNM=$P($G(^SCTM(404.51,+SCTM,0)),U,1)
"RTN","SCMCTMM",121,0)
 S XMSUB="Multiple PATIENT-TEAM ASSIGNMENT for "_SCTMNM,XMTEXT="^TMP($J,""SCTMXM"",",SCLNCNT=0
"RTN","SCMCTMM",122,0)
 D:'$G(DGQUIET) EN^DDIOL("Sending Multiple Patient-Team Assignment Message")
"RTN","SCMCTMM",123,0)
 S SCOK=1
"RTN","SCMCTMM",124,0)
 S SCTMNM=$P($G(^SCTM(404.51,+SCTM,0)),U,1)
"RTN","SCMCTMM",125,0)
 D SETLN("Team:                  "_SCTMNM)
"RTN","SCMCTMM",126,0)
 S Y=SCDATE X ^DD("DD")
"RTN","SCMCTMM",127,0)
 D SETLN("Effective Date:        "_Y)
"RTN","SCMCTMM",128,0)
 D SETLN(" ")
"RTN","SCMCTMM",129,0)
 IF $D(SCFIELDA) D
"RTN","SCMCTMM",130,0)
 .F SCNDX=1:1:14 S SCFLD=SCNDX*.01 IF $D(SCFIELDA(SCFLD)) D
"RTN","SCMCTMM",131,0)
 ..S $P(SCNODE,U,SCNDX)=SCFIELDA(SCFLD)
"RTN","SCMCTMM",132,0)
 ..D SETLN($$TEXT(404.42,SCNODE,SCNDX,SCSPACE,1))
"RTN","SCMCTMM",133,0)
 D SETLN(" ")
"RTN","SCMCTMM",134,0)
 D SETLN("There has been a new team assignment for the following patients:")
"RTN","SCMCTMM",135,0)
 S DFN=0
"RTN","SCMCTMM",136,0)
 F  S DFN=$O(@SCNEWTM@(DFN)) Q:'DFN  D
"RTN","SCMCTMM",137,0)
 .S:$$PCMMXMY^SCAPMC25(3,DFN,,"SCTMDT",0) SCOK=0
"RTN","SCMCTMM",138,0)
 .D PID^VADPT6
"RTN","SCMCTMM",139,0)
 .S SCPTNM=$P(^DPT(DFN,0),U,1)
"RTN","SCMCTMM",140,0)
 .S ^TMP("SCTM MAIL LST",$J,SCTM,1,DFN)=("    "_SCPTNM_" ("_$G(VA("PID"))_")")
"RTN","SCMCTMM",141,0)
 .S ^TMP("SCTM MAIL LST",$J,SCTM,1,"B",SCPTNM,DFN)=""
"RTN","SCMCTMM",142,0)
 S SCPTNM=""
"RTN","SCMCTMM",143,0)
 F  S SCPTNM=$O(^TMP("SCTM MAIL LST",$J,SCTM,1,"B",SCPTNM)) Q:SCPTNM']""  D
"RTN","SCMCTMM",144,0)
 .S DFN=0
"RTN","SCMCTMM",145,0)
 .F  S DFN=$O(^TMP("SCTM MAIL LST",$J,SCTM,1,"B",SCPTNM,DFN)) Q:'DFN  D
"RTN","SCMCTMM",146,0)
 ..S SCDETAIL=$G(^TMP("SCTM MAIL LST",$J,SCTM,1,DFN)) Q:SCDETAIL']""  D SETLN(SCDETAIL)
"RTN","SCMCTMM",147,0)
BAD IF $S('$D(SCBADTM):0,1:$O(@SCBADTM@(0))) D
"RTN","SCMCTMM",148,0)
 .D SETLN(" ")
"RTN","SCMCTMM",149,0)
 .D SETLN("There has been NO new team assignment for the following patients:")
"RTN","SCMCTMM",150,0)
 .S DFN=0
"RTN","SCMCTMM",151,0)
 .F  S DFN=$O(@SCBADTM@(DFN)) Q:'DFN  D
"RTN","SCMCTMM",152,0)
 ..S:$$PCMMXMY^SCAPMC25(3,DFN,,"SCTMDT",0) SCOK=0
"RTN","SCMCTMM",153,0)
 ..S SCPTNM=$P(^DPT(DFN,0),U,1)
"RTN","SCMCTMM",154,0)
 ..D PID^VADPT6
"RTN","SCMCTMM",155,0)
 ..S ^TMP("SCTM MAIL LST",$J,SCTM,2,DFN)=("    "_SCPTNM_" ("_$G(VA("PID"))_")")
"RTN","SCMCTMM",156,0)
 ..S ^TMP("SCTM MAIL LST",$J,SCTM,2,"B",SCPTNM,DFN)=""
"RTN","SCMCTMM",157,0)
 .S SCPTNM=""
"RTN","SCMCTMM",158,0)
 .F  S SCPTNM=$O(^TMP("SCTM MAIL LST",$J,SCTM,2,"B",SCPTNM)) Q:SCPTNM']""  D
"RTN","SCMCTMM",159,0)
 ..S DFN=0
"RTN","SCMCTMM",160,0)
 ..F  S DFN=$O(^TMP("SCTM MAIL LST",$J,SCTM,2,"B",SCPTNM,DFN)) Q:'DFN  D
"RTN","SCMCTMM",161,0)
 ...S SCDETAIL=$G(^TMP("SCTM MAIL LST",$J,SCTM,2,DFN)) Q:SCDETAIL']""  D SETLN(SCDETAIL)
"RTN","SCMCTMM",162,0)
 S XMDUZ=$G(DUZ,.5)
"RTN","SCMCTMM",163,0)
 D ^XMD
"RTN","SCMCTMM",164,0)
QTMULT K:$G(SCDELTEM) ^TMP("SCTM MAIL LST",$J,SCTM)
"RTN","SCMCTMM",165,0)
 K ^TMP($J,"SCTMXM")
"RTN","SCMCTMM",166,0)
 Q
"RTN","SCMCTPM")
0^6^B35060487
"RTN","SCMCTPM",1,0)
SCMCTPM ;ALB/REW - Patient Position Changes MailMessages ; 26 Mar 1996
"RTN","SCMCTPM",2,0)
 ;;5.3;Scheduling;**41,45,48,87,100,130**;AUG 13, 1993
"RTN","SCMCTPM",3,0)
 ;1
"RTN","SCMCTPM",4,0)
MAIL ;Do Patient Team Changes MailMan Message
"RTN","SCMCTPM",5,0)
 ; - called by SCMC PT TEAM CHANGES MAIL MESSAGE protocol
"RTN","SCMCTPM",6,0)
 G:$G(SCNOMAIL) END  ;- flag can be set to stop message generation
"RTN","SCMCTPM",7,0)
 N XMDUZ,XMY,XMSUB,XMTEXT,VA,VAERR,XMZ,Y,ZTQUEUED
"RTN","SCMCTPM",8,0)
 N SCTMAR,SCSTAT,DFN,SCNODE,SCY,SCSPACE,SCPAD,SCTPXM,SCLNCNT,SCTPDT,SCPTNM
"RTN","SCMCTPM",9,0)
 S ZTQUEUED=1
"RTN","SCMCTPM",10,0)
 S $P(SCSPACE," ",80)=""
"RTN","SCMCTPM",11,0)
 ;   SCTMAR - ARRAY OF TEAMS (before & after)
"RTN","SCMCTPM",12,0)
 S:SCTMAF SCTMAR(SCTMAF)=""
"RTN","SCMCTPM",13,0)
 S:SCTMB4 SCTMAR(SCTMB4)=""
"RTN","SCMCTPM",14,0)
 S:'SCTPAF SCSTAT="DELETED"
"RTN","SCMCTPM",15,0)
 S:'SCTPB4 SCSTAT="NEW"
"RTN","SCMCTPM",16,0)
 S:SCTPB4&SCTPAF SCSTAT="CHANGED"
"RTN","SCMCTPM",17,0)
 S DFN=$S(SCSTAT="DELETED":+$G(^SCPT(404.42,+SCPTTPB4,0)),1:+$G(^SCPT(404.42,+SCPTTPAF,0)))
"RTN","SCMCTPM",18,0)
 ;set xmy array for practitioners in positions receiving TMchg notices
"RTN","SCMCTPM",19,0)
 G:'$$PCMMXMY^SCAPMC25(3,DFN,"SCTMAR","SCTPDT",0) END
"RTN","SCMCTPM",20,0)
 ;D:'$G(DGQUIET) EN^DDIOL("Sending "_SCSTAT_" Patient-Position Assignment Message")
"RTN","SCMCTPM",21,0)
 D PID^VADPT6
"RTN","SCMCTPM",22,0)
 S SCPTNM=$P(^DPT(DFN,0),U,1)
"RTN","SCMCTPM",23,0)
 S XMSUB=SCSTAT_" PATIENT-POSITION ASSIGNMENT for Patient ("_$E(SCPTNM,1)_$G(VA("BID"))_")",XMTEXT="^TMP($J,""SCTPXM"",",SCLNCNT=0
"RTN","SCMCTPM",24,0)
 IF SCSTAT="NEW" D
"RTN","SCMCTPM",25,0)
 .D SETLN("Current Patient Team Data:")
"RTN","SCMCTPM",26,0)
 .D SETLN("==========================")
"RTN","SCMCTPM",27,0)
 .F SCX=1:1:9 D
"RTN","SCMCTPM",28,0)
 ..D SETLN($$TEXT(404.43,SCPTTPAF,SCX,SCSPACE,1))
"RTN","SCMCTPM",29,0)
 IF SCSTAT="DELETED" D
"RTN","SCMCTPM",30,0)
 .D SETLN("Previous Patient Team Data:")
"RTN","SCMCTPM",31,0)
 .D SETLN("===========================")
"RTN","SCMCTPM",32,0)
 .F SCX=1:1:9 S SCFLD=SCX*.01 D
"RTN","SCMCTPM",33,0)
 ..D SETLN($$TEXT(404.43,SCPTTPB4,SCX,SCSPACE,1))
"RTN","SCMCTPM",34,0)
 IF SCSTAT="CHANGED" D
"RTN","SCMCTPM",35,0)
 .D SETLN("Fields: "_$E(SCSPACE,1,19)_"Previous Data:           Current Patient Data:")
"RTN","SCMCTPM",36,0)
 .D SETLN("=======================================================================")
"RTN","SCMCTPM",37,0)
 .F SCX=1:1:9 S SCFLD=SCX*.01 D
"RTN","SCMCTPM",38,0)
 ..N SCLAB2,SCY,SCZ
"RTN","SCMCTPM",39,0)
 ..S SCY=$$TEXT(404.43,SCPTTPB4,SCX,SCSPACE,1)
"RTN","SCMCTPM",40,0)
 ..S:'$L(SCY) SCLAB2=2
"RTN","SCMCTPM",41,0)
 ..S SCZ=$$TEXT(404.43,SCPTTPAF,SCX,SCSPACE,+$G(SCLAB2))
"RTN","SCMCTPM",42,0)
 ..D:$L(SCY)!($L(SCZ)) SETLN(SCY_$E(SCSPACE,1,(52-$L(SCY)))_SCZ)
"RTN","SCMCTPM",43,0)
 S SCLNCNT=$$PCMAIL^SCMCMM(DFN,"^TMP($J,""SCTPXM"")",DT)
"RTN","SCMCTPM",44,0)
 S XMDUZ=$G(DUZ,.5)
"RTN","SCMCTPM",45,0)
 D ^XMD
"RTN","SCMCTPM",46,0)
END K ^TMP($J,"SCTPXM")
"RTN","SCMCTPM",47,0)
 Q
"RTN","SCMCTPM",48,0)
 ;
"RTN","SCMCTPM",49,0)
SETLN(TEXT) ;
"RTN","SCMCTPM",50,0)
 Q:$G(TEXT)=""
"RTN","SCMCTPM",51,0)
 ; increments SCLNCNT, adds text to scTPxm(sclncnt)
"RTN","SCMCTPM",52,0)
 S SCLNCNT=SCLNCNT+1
"RTN","SCMCTPM",53,0)
 S ^TMP($J,"SCTPXM",SCLNCNT)=TEXT
"RTN","SCMCTPM",54,0)
 Q
"RTN","SCMCTPM",55,0)
 ;
"RTN","SCMCTPM",56,0)
TEXT(SCFILE,SCNODE,SCPC,SCSPACE,SCLAB) ;returns fldname & external value
"RTN","SCMCTPM",57,0)
 ;returns fldname & external value
"RTN","SCMCTPM",58,0)
 ;   Note- Only works for non wp fields of standard numbering conventions
"RTN","SCMCTPM",59,0)
 ;   SCFLILE =FILENUM
"RTN","SCMCTPM",60,0)
 ;   SCNODE  = 0 NODE
"RTN","SCMCTPM",61,0)
 ;   SCPC    = piece of node
"RTN","SCMCTPM",62,0)
 ;   SCSPACE = 80 SPACES
"RTN","SCMCTPM",63,0)
 ;   SCLAB = 1 if print field name
"RTN","SCMCTPM",64,0)
 N SCX,SCINT,SCFLD
"RTN","SCMCTPM",65,0)
 S SCX=""
"RTN","SCMCTPM",66,0)
 S SCINT=$P(SCNODE,U,SCPC)
"RTN","SCMCTPM",67,0)
 G:SCINT="" QTTXT
"RTN","SCMCTPM",68,0)
 S SCFLD=SCPC*.01
"RTN","SCMCTPM",69,0)
 ;;;
"RTN","SCMCTPM",70,0)
 IF $G(SCLAB) D
"RTN","SCMCTPM",71,0)
 .S SCX=$$DDNAME^SCMCRU(SCFILE,SCFLD)_":"
"RTN","SCMCTPM",72,0)
 .S:$G(SCLAB)=1 SCX=SCX_$E(SCSPACE,1,(27-$L(SCX)))
"RTN","SCMCTPM",73,0)
 .S:$G(SCLAB)=2 SCX=SCX_$E(SCSPACE,1,(52-$L(SCX)))
"RTN","SCMCTPM",74,0)
 S:SCINT]"" SCX=SCX_$$EXTERNAL^DILFD(SCFILE,SCFLD,"",SCINT)
"RTN","SCMCTPM",75,0)
QTTXT Q SCX
"RTN","SCMCTPM",76,0)
DDNAME(FILE,FIELD) ;return the fieldname
"RTN","SCMCTPM",77,0)
 N SCX
"RTN","SCMCTPM",78,0)
 D FIELD^DID(FILE,FIELD,"","LABEL","SCX")
"RTN","SCMCTPM",79,0)
 Q $G(SCX("LABEL"))
"RTN","SCMCTPM",80,0)
 ;
"RTN","SCMCTPM",81,0)
MAILLST(SCTP,SCFIELDA,SCDATE,SCNEWTP,SCOLDTP,SCBADTP) ;
"RTN","SCMCTPM",82,0)
 ; Input:
"RTN","SCMCTPM",83,0)
 ;    SCTP     - Pointer to Team Position File (#404.57)
"RTN","SCMCTPM",84,0)
 ;    SCFIELDA - Field array with internal values
"RTN","SCMCTPM",85,0)
 ;    SCDATE   - Effective Date
"RTN","SCMCTPM",86,0)
 ;    SCNEWTP  - DFN array of newly assigned to position
"RTN","SCMCTPM",87,0)
 ;    SCOLDTP  - DFN array of previously assigned to position
"RTN","SCMCTPM",88,0)
 ;    SCBADTP  - DFN array of patients unassignable to position
"RTN","SCMCTPM",89,0)
 ;
"RTN","SCMCTPM",90,0)
 G:$G(SCNOMAIL) QTMULT  ;- flag can be set to stop message generation
"RTN","SCMCTPM",91,0)
 G:'$D(SCNEWTP) QTMULT
"RTN","SCMCTPM",92,0)
 G:'$O(@SCNEWTP@(0)) QTMULT  ;if no new assignments
"RTN","SCMCTPM",93,0)
 N XMDUZ,XMY,XMSUB,XMTEXT,VA,VAERR,XMZ,Y,SCTPDT,ZTQUEUED
"RTN","SCMCTPM",94,0)
 N SCTPNM,DFN,SCOK,SCPTNM,SCFLD,SCNODE,SCNDX,SCSPACE,SCE,SCB,SCTMNM,SCDELTEM,SCDETAIL
"RTN","SCMCTPM",95,0)
 S ZTQUEUED=1
"RTN","SCMCTPM",96,0)
 S SCDELTEM=1 ;ok to delete tmp global
"RTN","SCMCTPM",97,0)
 IF $D(SCFIELDA) D
"RTN","SCMCTPM",98,0)
 .IF $D(SCFIELDA(.03)) S SCB=SCFIELDA(.03)
"RTN","SCMCTPM",99,0)
 .IF $D(SCFIELDA(.04)) S SCE=SCFIELDA(.04)
"RTN","SCMCTPM",100,0)
 S SCB=$G(SCB,DT)
"RTN","SCMCTPM",101,0)
 S SCE=$G(SCE,DT)
"RTN","SCMCTPM",102,0)
 S $P(SCSPACE," ",80)=""
"RTN","SCMCTPM",103,0)
 S SCTPDT("BEGIN")=$S(SCB<SCDATE:SCB,1:SCDATE)
"RTN","SCMCTPM",104,0)
 S SCTPDT("END")=$S(SCE>SCDATE:SCE,1:SCDATE)
"RTN","SCMCTPM",105,0)
 S SCTPDT("INCL")=0
"RTN","SCMCTPM",106,0)
 S SCTPNM=$P($G(^SCTM(404.57,+SCTP,0)),U,1)
"RTN","SCMCTPM",107,0)
 S XMSUB="Multiple PATIENT-POSITION ASSIGNMENT for "_SCTPNM,XMTEXT="^TMP($J,""SCTPXM"",",SCLNCNT=0
"RTN","SCMCTPM",108,0)
 D:'$G(DGQUIET) EN^DDIOL("Sending Multiple Patient-Position Assignment Message")
"RTN","SCMCTPM",109,0)
 S SCOK=1
"RTN","SCMCTPM",110,0)
 S SCTPNM=$P($G(^SCTM(404.57,+SCTP,0)),U,1)
"RTN","SCMCTPM",111,0)
 S SCTMNM=$P($G(^SCTM(404.51,+$P($G(^SCTM(404.57,+SCTP,0)),U,2),0)),U,1)
"RTN","SCMCTPM",112,0)
 D SETLN("Team:                  "_SCTMNM)
"RTN","SCMCTPM",113,0)
 D SETLN("Position:              "_SCTPNM)
"RTN","SCMCTPM",114,0)
 S Y=SCDATE X ^DD("DD")
"RTN","SCMCTPM",115,0)
 D SETLN("Effective Date:        "_Y)
"RTN","SCMCTPM",116,0)
 D SETLN(" ")
"RTN","SCMCTPM",117,0)
 IF $D(SCFIELDA) D
"RTN","SCMCTPM",118,0)
 .F SCNDX=1:1:14 S SCFLD=SCNDX*.01 IF $D(SCFIELDA(SCFLD)) D
"RTN","SCMCTPM",119,0)
 ..S $P(SCNODE,U,SCNDX)=SCFIELDA(SCFLD)
"RTN","SCMCTPM",120,0)
 ..D SETLN($$TEXT(404.43,SCNODE,SCNDX,SCSPACE,1))
"RTN","SCMCTPM",121,0)
 D SETLN(" ")
"RTN","SCMCTPM",122,0)
 D SETLN("There has been a new position assignment for the following patients:")
"RTN","SCMCTPM",123,0)
 S DFN=0
"RTN","SCMCTPM",124,0)
NEW F  S DFN=$O(@SCNEWTP@(DFN)) Q:'DFN  D
"RTN","SCMCTPM",125,0)
 .S:$$PCMMXMY^SCAPMC25(3,DFN,,"SCTPDT",0) SCOK=0
"RTN","SCMCTPM",126,0)
 .D PID^VADPT6
"RTN","SCMCTPM",127,0)
 .S SCPTNM=$P(^DPT(DFN,0),U,1)
"RTN","SCMCTPM",128,0)
 .S ^TMP("SCTP MAIL LST",$J,SCTP,1,DFN)=("    "_SCPTNM_" ("_$G(VA("PID"))_")")
"RTN","SCMCTPM",129,0)
 .S ^TMP("SCTP MAIL LST",$J,SCTP,1,"B",SCPTNM,DFN)=""
"RTN","SCMCTPM",130,0)
 S SCPTNM=""
"RTN","SCMCTPM",131,0)
 F  S SCPTNM=$O(^TMP("SCTP MAIL LST",$J,SCTP,1,"B",SCPTNM)) Q:SCPTNM']""  D
"RTN","SCMCTPM",132,0)
 .S DFN=0
"RTN","SCMCTPM",133,0)
 .F  S DFN=$O(^TMP("SCTP MAIL LST",$J,SCTP,1,"B",SCPTNM,DFN)) Q:'DFN  D
"RTN","SCMCTPM",134,0)
 ..S SCDETAIL=$G(^TMP("SCTP MAIL LST",$J,SCTP,1,DFN)) Q:SCDETAIL']""  D SETLN(SCDETAIL)
"RTN","SCMCTPM",135,0)
BAD IF $O(@SCBADTP@(0)) D
"RTN","SCMCTPM",136,0)
 .D SETLN(" ")
"RTN","SCMCTPM",137,0)
 .D SETLN("There has been NO new position assignment for the following patients:")
"RTN","SCMCTPM",138,0)
 .S DFN=0
"RTN","SCMCTPM",139,0)
 .F  S DFN=$O(@SCBADTP@(DFN)) Q:'DFN  D
"RTN","SCMCTPM",140,0)
 ..S:$$PCMMXMY^SCAPMC25(3,DFN,,"SCTPDT",0) SCOK=0
"RTN","SCMCTPM",141,0)
 ..S SCPTNM=$P(^DPT(DFN,0),U,1)
"RTN","SCMCTPM",142,0)
 ..D PID^VADPT6
"RTN","SCMCTPM",143,0)
 ..S ^TMP("SCTP MAIL LST",$J,SCTP,2,DFN)=("    "_SCPTNM_" ("_$G(VA("PID"))_")")
"RTN","SCMCTPM",144,0)
 ..S ^TMP("SCTP MAIL LST",$J,SCTP,2,"B",SCPTNM,DFN)=""
"RTN","SCMCTPM",145,0)
 .S SCPTNM=""
"RTN","SCMCTPM",146,0)
 .F  S SCPTNM=$O(^TMP("SCTP MAIL LST",$J,SCTP,2,"B",SCPTNM)) Q:SCPTNM']""  D
"RTN","SCMCTPM",147,0)
 ..S DFN=0
"RTN","SCMCTPM",148,0)
 ..F  S DFN=$O(^TMP("SCTP MAIL LST",$J,SCTP,2,"B",SCPTNM,DFN)) Q:'DFN  D
"RTN","SCMCTPM",149,0)
 ...S SCDETAIL=$G(^TMP("SCTP MAIL LST",$J,SCTP,2,DFN)) Q:SCDETAIL']""  D SETLN(SCDETAIL)
"RTN","SCMCTPM",150,0)
 S XMDUZ=$G(DUZ,.5)
"RTN","SCMCTPM",151,0)
 D ^XMD
"RTN","SCMCTPM",152,0)
QTMULT K:$G(SCDELTEM) ^TMP("SCTP MAIL LST",$J,SCTP)
"RTN","SCMCTPM",153,0)
 K ^TMP($J,"SCTPXM")
"RTN","SCMCTPM",154,0)
 Q
"RTN","SCMCTPU")
0^7^B21252726
"RTN","SCMCTPU",1,0)
SCMCTPU ;ALB/REW - Team Position Utilities ; 9 Jun 1995
"RTN","SCMCTPU",2,0)
 ;;5.3;Scheduling;**41,130**;AUG 13, 1993
"RTN","SCMCTPU",3,0)
 ;1
"RTN","SCMCTPU",4,0)
ACTPTTM(SCPTTM,SCDT) ;is the patient- team assignment currently active?
"RTN","SCMCTPU",5,0)
 ; Used by computed field #300 (CURRENTLY ACTIVE?) OF file #404.57
"RTN","SCMCTPU",6,0)
 ; Input:
"RTN","SCMCTPU",7,0)
 ;  SCPTTM  - Pointer to Patient Team Assignment file -404.42
"RTN","SCMCTPU",8,0)
 ;  SCDT  - Date to check for, Default=DT
"RTN","SCMCTPU",9,0)
 ; Returns
"RTN","SCMCTPU",10,0)
 ;   status^status change date
"RTN","SCMCTPU",11,0)
 ; status:
"RTN","SCMCTPU",12,0)
 ;   1  if after effective date and before inactive date
"RTN","SCMCTPU",13,0)
 ;   0  if not yet active or inactivated already
"RTN","SCMCTPU",14,0)
 ;   -1 if error
"RTN","SCMCTPU",15,0)
 ;999
"RTN","SCMCTPU",16,0)
 ;new code
"RTN","SCMCTPU",17,0)
 N SCOK,STATUS,EFFDT,SCNODE
"RTN","SCMCTPU",18,0)
 S:'$D(SCDT) SCDT=DT
"RTN","SCMCTPU",19,0)
 S SCNODE=$G(^SCPT(404.42,+SCPTTM,0))
"RTN","SCMCTPU",20,0)
 ;no act=-1,dt before act=0,no inact=1,dt after inact=0,o/w=1
"RTN","SCMCTPU",21,0)
 Q $S(('$P(SCNODE,U,2)):-1,(SCDT<$P(SCNODE,U,2)):0,('$P(SCNODE,U,9)):1,(SCDT>$P(SCNODE,U,9)):0,1:1)
"RTN","SCMCTPU",22,0)
 ;
"RTN","SCMCTPU",23,0)
ACTTP(SCTP,SCDT) ;is the team position currently active?
"RTN","SCMCTPU",24,0)
 ; Used by computed field #300 (CURRENTLY ACTIVE?) OF file #404.57
"RTN","SCMCTPU",25,0)
 ; Input:
"RTN","SCMCTPU",26,0)
 ;  SCTP  - Pointer to Team Position file #404.57
"RTN","SCMCTPU",27,0)
 ;  SCDT  - Date to check for, Default=DT
"RTN","SCMCTPU",28,0)
 ; Returns
"RTN","SCMCTPU",29,0)
 ;   status^status change date
"RTN","SCMCTPU",30,0)
 ; status:
"RTN","SCMCTPU",31,0)
 ;   1  if after effective date and before inactive date
"RTN","SCMCTPU",32,0)
 ;   0  if not yet active or inactivated
"RTN","SCMCTPU",33,0)
 ;   -1 if error
"RTN","SCMCTPU",34,0)
 ;
"RTN","SCMCTPU",35,0)
 ;new code
"RTN","SCMCTPU",36,0)
 N SCX,STATUS,EFFDT
"RTN","SCMCTPU",37,0)
 S:'$D(SCDT) SCDT=DT
"RTN","SCMCTPU",38,0)
 S SCX=$$DATES^SCAPMCU1(404.59,SCTP,SCDT)
"RTN","SCMCTPU",39,0)
 S STATUS=$P(SCX,U,1)
"RTN","SCMCTPU",40,0)
 S EFFDT=$S(STATUS=0:$P(SCX,U,3),(STATUS=1):$P(SCX,U,2),1:"")
"RTN","SCMCTPU",41,0)
QTACTTP Q STATUS_U_EFFDT
"RTN","SCMCTPU",42,0)
 ;
"RTN","SCMCTPU",43,0)
ITSCF(CRITERIA,REPORT,X) ;
"RTN","SCMCTPU",44,0)
 ;Input transform for 404.93
"RTN","SCMCTPU",45,0)
 ;CRITERIA - value of the .01 in 404.93 for entry DA
"RTN","SCMCTPU",46,0)
 ;REPORT - value of the .02 in 404.93 for entry DA
"RTN","SCMCTPU",47,0)
 ;X - value entered by user
"RTN","SCMCTPU",48,0)
 ;X is killed if duplicate
"RTN","SCMCTPU",49,0)
 ;
"RTN","SCMCTPU",50,0)
 Q:'$G(DA)!'$D(X)
"RTN","SCMCTPU",51,0)
 S:'$D(CRITERIA) CRITERIA=$P($G(^SD(404.93,DA,0)),U)
"RTN","SCMCTPU",52,0)
 S:'$D(REPORT)#2 REPORT=$P($G(^SD(404.93,DA,0)),U,2)
"RTN","SCMCTPU",53,0)
 I $D(^SD(404.93,"APRIM",CRITERIA,REPORT)) D
"RTN","SCMCTPU",54,0)
 .D:'$G(DGQUIET) EN^DDIOL("Duplicate Criteria Not Allowed for Same Report","","?5")
"RTN","SCMCTPU",55,0)
 .K X
"RTN","SCMCTPU",56,0)
 Q
"RTN","SCMCTPU",57,0)
 ;
"RTN","SCMCTPU",58,0)
AKEY(REPORT,SORT,X) ;
"RTN","SCMCTPU",59,0)
 ;Input transform for 404.92
"RTN","SCMCTPU",60,0)
 ;REPORT - value of the .01 in 404.92 for entry DA
"RTN","SCMCTPU",61,0)
 ;SORT - value of the .02 in 404.92 for entry DA
"RTN","SCMCTPU",62,0)
 ;X - value entered by user
"RTN","SCMCTPU",63,0)
 ;X is killed if duplicate
"RTN","SCMCTPU",64,0)
 ;
"RTN","SCMCTPU",65,0)
 Q:'$G(DA)!'$D(X)
"RTN","SCMCTPU",66,0)
 S:'$D(REPORT) REPORT=$P($G(^SD(404.92,DA,0)),U)
"RTN","SCMCTPU",67,0)
 S:'$D(SORT)#2 SORT=$P($G(^SD(404.92,DA,0)),U,2)
"RTN","SCMCTPU",68,0)
 I $D(^SD(404.92,"AKEY",REPORT,SORT)) D
"RTN","SCMCTPU",69,0)
 .D:'$G(DGQUIET) EN^DDIOL("Duplicate SORT BY TEXT Not Allowed for Same Report","","?5")
"RTN","SCMCTPU",70,0)
 .K X
"RTN","SCMCTPU",71,0)
 Q
"RTN","SCMCTPU",72,0)
 ;
"RTN","SCMCTPU",73,0)
IPTF(POSITION,TEAM,X) ;input transform for 404.57
"RTN","SCMCTPU",74,0)
 ;kills x if duplicate
"RTN","SCMCTPU",75,0)
 Q:'$G(DIUTIL)="VERIFY FIELDS"
"RTN","SCMCTPU",76,0)
 Q:'$G(DA)!'$D(X)
"RTN","SCMCTPU",77,0)
 S:'$D(POSITION) POSITION=$P($G(^SCTM(404.57,DA,0)),U,1)
"RTN","SCMCTPU",78,0)
 S:'$D(TEAM)#2 TEAM=$P($G(^SCTM(404.57,DA,0)),U,2)
"RTN","SCMCTPU",79,0)
 ;S:'$G(TEAM) TEAM=$O(^SCTM(404.51,"B",TEAM,0))
"RTN","SCMCTPU",80,0)
 IF $D(^SCTM(404.57,"APRIMARY",POSITION,TEAM)) D
"RTN","SCMCTPU",81,0)
 .D:'$G(DGQUIET) EN^DDIOL("Duplicate Team Positions Not Allowed","","?5")
"RTN","SCMCTPU",82,0)
 .K X
"RTN","SCMCTPU",83,0)
 Q
"RTN","SCMCTPU",84,0)
OKACTTP(SCNODE,ACTDT) ;input transform for position assigned date for 404.43
"RTN","SCMCTPU",85,0)
 ;
"RTN","SCMCTPU",86,0)
 N OK
"RTN","SCMCTPU",87,0)
 S OK=1
"RTN","SCMCTPU",88,0)
 ;must have input defined
"RTN","SCMCTPU",89,0)
 IF '$D(SCNODE)#2!('$G(ACTDT)) S OK=0_U_"Bad input data" G QTOKAC
"RTN","SCMCTPU",90,0)
 ;if inactivation exists must be after activation
"RTN","SCMCTPU",91,0)
 S:$P(SCNODE,U,4)&($P(SCNODE,U,4)<ACTDT) OK=0_U_"Inactivation date is after this date"
"RTN","SCMCTPU",92,0)
 ;position must be active during assignment activation
"RTN","SCMCTPU",93,0)
 S:'$$ACTTP(+$P(SCNODE,U,2),ACTDT) OK=0_U_"Position Not active on this date"
"RTN","SCMCTPU",94,0)
 S:1>$$ACTPTTM(+$P(SCNODE,U,1),ACTDT) OK=0_U_"No active Patient Team Assignment on this date"
"RTN","SCMCTPU",95,0)
QTOKAC Q OK
"RTN","SCMCTPU",96,0)
OKINTP(SCNODE,INACTDT) ;input transform for inactivation date for 404.43
"RTN","SCMCTPU",97,0)
 ;
"RTN","SCMCTPU",98,0)
 N OK
"RTN","SCMCTPU",99,0)
 S OK=1
"RTN","SCMCTPU",100,0)
 ;must have input defined
"RTN","SCMCTPU",101,0)
 IF '$D(SCNODE)#2!('$G(INACTDT)) S OK=0 G QTOKIN
"RTN","SCMCTPU",102,0)
 ;must have activation date
"RTN","SCMCTPU",103,0)
 S:'$P(SCNODE,U,3) OK=0_U_"No activation date in Pt Team Assignment"
"RTN","SCMCTPU",104,0)
 ;activation date can't be after inactivation
"RTN","SCMCTPU",105,0)
 S:$P(SCNODE,U,3)>INACTDT OK=0_U_"Activation date is after this date"
"RTN","SCMCTPU",106,0)
 ;inactivation must be during time when position is active
"RTN","SCMCTPU",107,0)
 S:'$$ACTTP(+$P(SCNODE,U,2),INACTDT) OK=0_U_"Inactivation date must be when position is active"
"RTN","SCMCTPU",108,0)
QTOKIN Q OK
"RTN","SCMCTPU",109,0)
 ;
"RTN","SCMCTPU",110,0)
OKTP(DA,SCX) ;used by team position field of 404.43
"RTN","SCMCTPU",111,0)
 N OK,SCTM,SCPTTMA,SCNODE
"RTN","SCMCTPU",112,0)
 S SCNODE=$G(^SCPT(404.43,DA,0))
"RTN","SCMCTPU",113,0)
 S OK=1
"RTN","SCMCTPU",114,0)
 ;must have input defined
"RTN","SCMCTPU",115,0)
 IF '$D(SCNODE)#2!('$G(SCX)) S OK=0 G QTOKTP
"RTN","SCMCTPU",116,0)
 S SCTM=$P($G(^SCTM(404.57,SCX,0)),U,2)
"RTN","SCMCTPU",117,0)
 S SCPTTMA=$P(SCNODE,U,1)
"RTN","SCMCTPU",118,0)
 S:$P($G(^SCPT(404.42,SCPTTMA,0)),U,3)'=SCTM OK=0_U_"Team Position Must be from Team in Pt Team Assignment"
"RTN","SCMCTPU",119,0)
QTOKTP Q OK
"RTN","SCMCTPU",120,0)
 ;
"RTN","SCMCTPU",121,0)
OKROLE(DA,SCX) ;used by role .05 field of 404.43
"RTN","SCMCTPU",122,0)
 N OK,SCNODE,SCPTTMA,SCPC
"RTN","SCMCTPU",123,0)
 S SCNODE=$G(^SCPT(404.43,DA,0))
"RTN","SCMCTPU",124,0)
 S OK=1
"RTN","SCMCTPU",125,0)
 ;must have input defined
"RTN","SCMCTPU",126,0)
 IF '$D(SCNODE)#2!('$D(SCX)) S OK=0_U_"Undefined Patient Team Data" G QTOKTP
"RTN","SCMCTPU",127,0)
 S SCPTTMA=$P(SCNODE,U,1)
"RTN","SCMCTPU",128,0)
 S:$P($G(^SCPT(404.42,SCPTTMA,0)),U,8)=1 SCPC=1
"RTN","SCMCTPU",129,0)
 ;if not a pc team & role is a pc role - not ok
"RTN","SCMCTPU",130,0)
 S:('$G(SCPC))&$G(SCX) OK=0_U_"PC Roles only allowed if Pt Team Assignment is for Primary Care"
"RTN","SCMCTPU",131,0)
QTOKRL Q OK
"RTN","SCMCTPU",132,0)
 ;
"RTN","SCMCTPU",133,0)
USEUSR() ;should user class functionality be employed?
"RTN","SCMCTPU",134,0)
 ;  Returned [1=Use USR Class,0=Don't)
"RTN","SCMCTPU",135,0)
 Q +$G(^SD(404.91,1,"PCMM"))
"RTN","SCMCTPU",136,0)
 ;
"RTN","SCMCTPU",137,0)
ACCLIN(SC44,DATE) ;is clinic active on this date?
"RTN","SCMCTPU",138,0)
 ;  Return: 1=Yes,0=N0
"RTN","SCMCTPU",139,0)
 N SCX
"RTN","SCMCTPU",140,0)
 S SCX=+$G(^SC(+$G(SC44),"I"))
"RTN","SCMCTPU",141,0)
 Q $S('SCX:1,(SCX>DATE):1,1:0)
"RTN","SCRPU1")
0^8^B24892812
"RTN","SCRPU1",1,0)
SCRPU1 ;ALB/CMM - GENERIC PROMPTS FOR PCMM REPORTS ;1/12/96
"RTN","SCRPU1",2,0)
 ;;5.3;Scheduling;**41,45,130**;AUG 13, 1993
"RTN","SCRPU1",3,0)
 ;
"RTN","SCRPU1",4,0)
INST ;Prompt for institution
"RTN","SCRPU1",5,0)
 S VAUTVB="VAUTD",DIC="^DIC(4,",DIC("S")="I $D(^SCTM(404.51,""AINST"",+Y))"
"RTN","SCRPU1",6,0)
 S VAUTNI=2,VAUTSTR="Division"
"RTN","SCRPU1",7,0)
 G FIRST^VAUTOMA
"RTN","SCRPU1",8,0)
 ;
"RTN","SCRPU1",9,0)
PRMTT ;Prompt for team.  Set VAUTTN to allow not assigned to a team as a selection
"RTN","SCRPU1",10,0)
 I '$D(VAUTD) G ERR
"RTN","SCRPU1",11,0)
 S VAUTVB="VAUTT",DIC="^SCTM(404.51,",VAUTNI=2,VAUTSTR="Team",DIC("B")=""
"RTN","SCRPU1",12,0)
 S DIC("S")="I VAUTD=1!($D(VAUTD(+$P(^(0),U,7))))"
"RTN","SCRPU1",13,0)
 G FIRST
"RTN","SCRPU1",14,0)
 ;
"RTN","SCRPU1",15,0)
CLINIC ;Prompt for Clinic
"RTN","SCRPU1",16,0)
 I '$D(VAUTT)&'$D(VAUTCA) G ERR
"RTN","SCRPU1",17,0)
 S VAUTVB="VAUTC",VAUTSTR="Clinic",VAUTNI=2,DIC="^SC("
"RTN","SCRPU1",18,0)
 ;Set screen to only allow clinics and clinics that are associated to the teams selected
"RTN","SCRPU1",19,0)
 I '$D(VAUTCA) S DIC("S")="I $$CLSC^SCRPU1()"
"RTN","SCRPU1",20,0)
 ;VAUTCA allows for selection of any clinic in the selected
"RTN","SCRPU1",21,0)
 I $D(VAUTCA) S DIC("S")="I $$CLSC2^SCRPU1()"
"RTN","SCRPU1",22,0)
 G FIRST
"RTN","SCRPU1",23,0)
 ;
"RTN","SCRPU1",24,0)
USER ;Prompt for User Class
"RTN","SCRPU1",25,0)
 I '$D(VAUTT) G ERR
"RTN","SCRPU1",26,0)
 I $P($G(^SD(404.91,1,"PCMM")),"^")'=1 Q  ;user class turned off
"RTN","SCRPU1",27,0)
 S VAUTVB="VAUTUC",DIC="^USR(8930,",VAUTSTR="User Class",VAUTNI=2
"RTN","SCRPU1",28,0)
 S DIC("S")="I $$USRCL^SCRPU1"
"RTN","SCRPU1",29,0)
 G FIRST
"RTN","SCRPU1",30,0)
 ;
"RTN","SCRPU1",31,0)
USRCL() ;Screen for user class - must be related to teams selected
"RTN","SCRPU1",32,0)
 N STOP,ENT,NODE,TIEN
"RTN","SCRPU1",33,0)
 I '+$P(^(0),U,3) Q 0
"RTN","SCRPU1",34,0)
 ;check for active/exiting user class
"RTN","SCRPU1",35,0)
 S ENT=0,STOP=0
"RTN","SCRPU1",36,0)
 F  S ENT=$O(^SCTM(404.57,"AUSR",+Y,ENT)) Q:ENT=""!(STOP)  D
"RTN","SCRPU1",37,0)
 .S NODE=$G(^SCTM(404.57,ENT,0))
"RTN","SCRPU1",38,0)
 .I NODE="" S STOP=0 Q
"RTN","SCRPU1",39,0)
 .S TIEN=+$P(NODE,"^",2) ;team ien
"RTN","SCRPU1",40,0)
 .I $D(VAUTT(TIEN))!(VAUTT=1) S STOP=1 Q
"RTN","SCRPU1",41,0)
 .I VAUTT=""&(TIEN="") S STOP=1 Q  ;no team selected, no team assigned
"RTN","SCRPU1",42,0)
 .I VAUTT'=1&('$D(VAUTT(TIEN))) S STOP=0
"RTN","SCRPU1",43,0)
 Q STOP
"RTN","SCRPU1",44,0)
 ;
"RTN","SCRPU1",45,0)
ROLE ;Prompt for Role
"RTN","SCRPU1",46,0)
 I '$D(VAUTT) G ERR
"RTN","SCRPU1",47,0)
 S VAUTVB="VAUTR",DIC="^SD(403.46,",VAUTSTR="Role",VAUTNI=2
"RTN","SCRPU1",48,0)
 S DIC("S")="I $$RL^SCRPU1()"
"RTN","SCRPU1",49,0)
 G FIRST
"RTN","SCRPU1",50,0)
 ;
"RTN","SCRPU1",51,0)
RL() ;Screen for Role - screen on team
"RTN","SCRPU1",52,0)
 N EN,STOP,ACT,TEAM
"RTN","SCRPU1",53,0)
 S EN="",STOP=0
"RTN","SCRPU1",54,0)
 I $D(^SCTM(404.57,"AC",+Y)) D
"RTN","SCRPU1",55,0)
 .F  S EN=$O(^SCTM(404.57,"AC",+Y,EN)) Q:EN=""!(STOP)  D
"RTN","SCRPU1",56,0)
 ..S ACT=+$$ACTTP^SCMCTPU(EN) ;currently active?
"RTN","SCRPU1",57,0)
 ..I 'ACT!('$D(^SCTM(404.57,EN,0))) Q
"RTN","SCRPU1",58,0)
 ..S TEAM=$P(^SCTM(404.57,EN,0),"^",2)
"RTN","SCRPU1",59,0)
 ..I $D(VAUTT(TEAM))!(VAUTT=1) S STOP=1
"RTN","SCRPU1",60,0)
 ..I VAUTT=""&(TEAM="") S STOP=1
"RTN","SCRPU1",61,0)
 Q STOP
"RTN","SCRPU1",62,0)
 ;
"RTN","SCRPU1",63,0)
PRACT ; Prompt for One (set VAUTPO) or One,Many,All,None Practitioner(s)
"RTN","SCRPU1",64,0)
 I '$D(VAUTT) G ERR
"RTN","SCRPU1",65,0)
 S VAUTVB="VAUTP",VAUTSTR="Practitioner",VAUTNI=2,DIC="^VA(200,"
"RTN","SCRPU1",66,0)
 S DIC("S")="I $$PRACS^SCRPU1()"
"RTN","SCRPU1",67,0)
 G FIRST
"RTN","SCRPU1",68,0)
 ;
"RTN","SCRPU1",69,0)
PRACS() ;Practitioner screen - off of team selection
"RTN","SCRPU1",70,0)
 N EN,STOP,NODE,TEAM
"RTN","SCRPU1",71,0)
 S EN="",STOP=0
"RTN","SCRPU1",72,0)
 I '$D(^SCTM(404.52,"C",+Y)) Q 0
"RTN","SCRPU1",73,0)
 ;Position Assignment History file
"RTN","SCRPU1",74,0)
 F  S EN=$O(^SCTM(404.52,"C",+Y,EN)) Q:EN=""!(STOP)  D
"RTN","SCRPU1",75,0)
 .I '$D(^SCTM(404.52,EN)) Q
"RTN","SCRPU1",76,0)
 .S NODE=$G(^SCTM(404.52,EN,0))
"RTN","SCRPU1",77,0)
 .S TEAM=+$P($G(^SCTM(404.57,$P(NODE,"^"),0)),"^",2)
"RTN","SCRPU1",78,0)
 .I $P(NODE,"^",4),$D(VAUTT(TEAM)) S STOP=1
"RTN","SCRPU1",79,0)
 .I VAUTT=1 S STOP=1
"RTN","SCRPU1",80,0)
 Q STOP
"RTN","SCRPU1",81,0)
 ;
"RTN","SCRPU1",82,0)
FIRST ;
"RTN","SCRPU1",83,0)
 S DIC(0)="EQMNZ",DIC("A")="Select "_VAUTSTR_": " K @VAUTVB
"RTN","SCRPU1",84,0)
 S (@VAUTVB,Y)=0
"RTN","SCRPU1",85,0)
REDO W !,DIC("A") R X:DTIME G ERR:(X="^")!'$T D:X["?"!(X=""&('$G(SCOKNULL))) HELP^SCRPU3
"RTN","SCRPU1",86,0)
 G:$G(SCOKNULL)&(X="") QUIT
"RTN","SCRPU1",87,0)
 I X="A"!(X="ALL")&'$D(VAUTNA) S @VAUTVB=1 G QUIT
"RTN","SCRPU1",88,0)
 ;VAUTNA doesn't allow all to be selected
"RTN","SCRPU1",89,0)
 ;VAUTTN allows 'Not assigned to a team' as a selection
"RTN","SCRPU1",90,0)
 I X="N"!(X="NOT")!(X="NONE") I $D(VAUTTN)!($D(VAUTPP)) S @VAUTVB="" G QUIT
"RTN","SCRPU1",91,0)
 ;VAUTPP allows 'Not assigned to a practitioner' as a selection
"RTN","SCRPU1",92,0)
 S DIC("A")="Select another "_VAUTSTR_": " D ^DIC G:Y'>0 FIRST D SET
"RTN","SCRPU1",93,0)
 I '$D(VAUTPO) F VAI=1:0:19 W !,DIC("A") R X:DTIME G ERR:(X="")!(X="^")!'$T K Y D HELP^SCRPU3:X["?" S:$E(X)="-" VAUTX=X,X=$E(VAUTX,2,999) D ^DIC I Y>0 D SET G:VAX REDO S:'VAERR VAI=VAI+1
"RTN","SCRPU1",94,0)
 ;VAUTPO - only one practitioner allowed to be selected
"RTN","SCRPU1",95,0)
 G QUIT
"RTN","SCRPU1",96,0)
SET S VAX=0 I $D(VAUTX) S J=$S(VAUTNI=2:+Y,1:$P(Y(0),"^")) K VAUTX S VAERR=$S($D(@VAUTVB@(J)):0,1:1) W $S('VAERR:"...removed from list...",1:"...not on list...can't remove") Q:VAERR  S VAI=VAI-1 K @VAUTVB@(J) S:$O(@VAUTVB@(0))']"" VAX=1 Q
"RTN","SCRPU1",97,0)
 S VAERR=0 I $S($D(@VAUTVB@($P(Y(0),U))):1,$D(@VAUTVB@(+Y)):1,1:0) W !?3,*7,"You have already selected that ",VAUTSTR,".  Try again." S VAERR=1
"RTN","SCRPU1",98,0)
 S @VAUTVB@(+Y)=$P(Y(0),U)
"RTN","SCRPU1",99,0)
 Q
"RTN","SCRPU1",100,0)
 ;
"RTN","SCRPU1",101,0)
ERR S Y=-1 I $O(@VAUTVB@(0))="" K @VAUTVB I X="^" S SCUP=""
"RTN","SCRPU1",102,0)
QUIT S:'$D(Y) Y=1
"RTN","SCRPU1",103,0)
 I $D(@VAUTVB),VAUTSTR="Team",@VAUTVB=1 D:'$G(DGQUIET) EN^DDIOL("All Teams selected, this report may take some time...","","!,?10")
"RTN","SCRPU1",104,0)
 K DIC,J,VAERR,VAI,VAJ,VAJ1,VAX,VAUTNI,VAUTSTR,VAUTVB,X
"RTN","SCRPU1",105,0)
 Q
"RTN","SCRPU1",106,0)
 ;
"RTN","SCRPU1",107,0)
CLSC() ;screen on clinic selection, must be related to team prompt
"RTN","SCRPU1",108,0)
 I $P(^(0),U,3)'="C" Q 0
"RTN","SCRPU1",109,0)
 N TRUE,EN,TEAM
"RTN","SCRPU1",110,0)
 S TRUE=0,EN=""
"RTN","SCRPU1",111,0)
 F  S EN=$O(^SCTM(404.57,"D",+Y,EN)) Q:EN=""!(TRUE)  D
"RTN","SCRPU1",112,0)
 .S TEAM=+$P($G(^SCTM(404.57,EN,0)),"^",2)
"RTN","SCRPU1",113,0)
 .I $D(VAUTT(TEAM))!(VAUTT=1) S TRUE=1
"RTN","SCRPU1",114,0)
 I VAUTT="" S TRUE=1
"RTN","SCRPU1",115,0)
 Q TRUE
"RTN","SCRPU1",116,0)
 ;
"RTN","SCRPU1",117,0)
CLSC2() ;screen on clinic selection, must be a clinic
"RTN","SCRPU1",118,0)
 I $P(^(0),U,3)'="C" Q 0
"RTN","SCRPU1",119,0)
 Q 1
"RTN","SCRPU1",120,0)
 ;
"RTN","SCRPU1",121,0)
CLSC2OLD() ;screen on clinic selection, must be related to division prompt
"RTN","SCRPU1",122,0)
 I $P(^(0),U,3)'="C" Q 0
"RTN","SCRPU1",123,0)
 N TRUE,EN,INST,TDIV
"RTN","SCRPU1",124,0)
 S TRUE=0,EN=""
"RTN","SCRPU1",125,0)
 S TDIV=+$P(^(0),U,15) ;clinic's division
"RTN","SCRPU1",126,0)
 Q:TDIV=0 0
"RTN","SCRPU1",127,0)
 S INST=+$P(^DG(40.8,TDIV,0),U,7)
"RTN","SCRPU1",128,0)
 I '$D(VAUTD(INST))&(VAUTD'="") S TRUE=0
"RTN","SCRPU1",129,0)
 I $D(VAUTD(INST)) S TRUE=1
"RTN","SCRPU1",130,0)
 I VAUTD=1 S TRUE=1
"RTN","SCRPU1",131,0)
 Q TRUE
"RTN","SCUTBK")
0^10^B10999430
"RTN","SCUTBK",1,0)
SCUTBK ;ALB/MJK - Scheduling Broker Utilities ;[ 03/21/95  4:13 PM ]
"RTN","SCUTBK",2,0)
 ;;5.3;Scheduling;**41,130**;AUG 13, 1993
"RTN","SCUTBK",3,0)
 ;
"RTN","SCUTBK",4,0)
 Q
"RTN","SCUTBK",5,0)
 ;
"RTN","SCUTBK",6,0)
CHK ; -- all broker callbacks pass thru here
"RTN","SCUTBK",7,0)
 Q
"RTN","SCUTBK",8,0)
 ;
"RTN","SCUTBK",9,0)
LISTC(SCDATA,SC) ; -- broker callback to get list data
"RTN","SCUTBK",10,0)
 N SCFILE,SCIENS,SCFIELDS,SCMAX,SCFROM,SCPART,SCXREF,SCREEN,SCID,SCVAL,SCROOT,SCERR,SCRSLT,SCFLD
"RTN","SCUTBK",11,0)
 D CHK
"RTN","SCUTBK",12,0)
 ; -- parse array to parameters
"RTN","SCUTBK",13,0)
 D PARSE(.SC)
"RTN","SCUTBK",14,0)
 S SCFLAGS=$G(SCFLAGS)_"PS"
"RTN","SCUTBK",15,0)
 ;
"RTN","SCUTBK",16,0)
 ; -- get specific field criteria  - screen code (below) left as reminder
"RTN","SCUTBK",17,0)
 ;IF $G(SC("DDFILE")),$G(SC("DDFIELD")),$D(^DD(SC("DDFILE"),SC("DDFIELD"),12.1)) D
"RTN","SCUTBK",18,0)
 ;. N DIC X ^(12.1) S:$D(DIC("S")) SCREEN=DIC("S")
"RTN","SCUTBK",19,0)
 ;
"RTN","SCUTBK",20,0)
 ; -- need to get from kernel broker somehow...
"RTN","SCUTBK",21,0)
 D TMP
"RTN","SCUTBK",22,0)
 ;
"RTN","SCUTBK",23,0)
 D LIST^DIC(SCFILE,SCIENS,SCFIELDS,SCFLAGS,SCMAX,.SCFROM,SCPART,SCXREF,SCREEN,SCID,"^TMP(""SCRSLT"",$J)","SCERR")
"RTN","SCUTBK",24,0)
 ;
"RTN","SCUTBK",25,0)
 N Y,I,N
"RTN","SCUTBK",26,0)
 ;
"RTN","SCUTBK",27,0)
 S N=0
"RTN","SCUTBK",28,0)
 IF $G(SCFROM)]"" D
"RTN","SCUTBK",29,0)
 . D SET("[Misc]")
"RTN","SCUTBK",30,0)
 . D SET("MORE"_U_SCFROM_U_SCFROM("IEN"))
"RTN","SCUTBK",31,0)
 ;
"RTN","SCUTBK",32,0)
 D SET("[Data]")
"RTN","SCUTBK",33,0)
 S I=0 F  S I=$O(^TMP("SCRSLT",$J,"DILIST",I)) Q:'I  D SET(^TMP("SCRSLT",$J,"DILIST",I,0))
"RTN","SCUTBK",34,0)
 ;
"RTN","SCUTBK",35,0)
 IF $D(SCERR) D
"RTN","SCUTBK",36,0)
 . D SET("[Errors]")
"RTN","SCUTBK",37,0)
 ;
"RTN","SCUTBK",38,0)
 M SCDATA=Y
"RTN","SCUTBK",39,0)
 Q
"RTN","SCUTBK",40,0)
 ;
"RTN","SCUTBK",41,0)
SET(X) ;
"RTN","SCUTBK",42,0)
 S N=N+1
"RTN","SCUTBK",43,0)
 S Y(N)=X
"RTN","SCUTBK",44,0)
 Q
"RTN","SCUTBK",45,0)
 ;
"RTN","SCUTBK",46,0)
PARSE(SC) ; -- array parsing
"RTN","SCUTBK",47,0)
 S SCFILE=$G(SC("FILE"))
"RTN","SCUTBK",48,0)
 S SCIENS=$G(SC("IENS"))
"RTN","SCUTBK",49,0)
 S SCFIELDS=$G(SC("FIELDS"))
"RTN","SCUTBK",50,0)
 S SCFLAGS=$G(SC("FLAGS"))
"RTN","SCUTBK",51,0)
 S SCMAX=$G(SC("MAX"),"*")
"RTN","SCUTBK",52,0)
 M SCFROM=SC("FROM")
"RTN","SCUTBK",53,0)
 S SCPART=$G(SC("PART"))
"RTN","SCUTBK",54,0)
 S SCXREF=$G(SC("XREF"))
"RTN","SCUTBK",55,0)
 S SCREEN=$G(SC("SCREEN"))
"RTN","SCUTBK",56,0)
 S SCID=$G(SC("ID"))
"RTN","SCUTBK",57,0)
 S SCROOT=$G(SC("ROOT"))
"RTN","SCUTBK",58,0)
 ; -- for find
"RTN","SCUTBK",59,0)
 S SCVAL=$G(SC("VALUE"))
"RTN","SCUTBK",60,0)
 Q
"RTN","SCUTBK",61,0)
 ;
"RTN","SCUTBK",62,0)
FILEC(SCDATA,SCMODE,SCROOT,SCIENS) ;
"RTN","SCUTBK",63,0)
 N SCRTN,SCFDA,SCERR,N,I
"RTN","SCUTBK",64,0)
 D CHK
"RTN","SCUTBK",65,0)
 D FDASET(.SCROOT,.SCFDA)
"RTN","SCUTBK",66,0)
 ; -- set up placeholder DINUM's if any
"RTN","SCUTBK",67,0)
 ; -- NOTE:  Can't use until multiple arrays can be passed by broker
"RTN","SCUTBK",68,0)
 ;S I="" F  S I=$O(SCIENS(I)) Q:I=""  S SCRTN(+I)=+SCIENS(I)
"RTN","SCUTBK",69,0)
 IF SCMODE="ADD" D
"RTN","SCUTBK",70,0)
 . D UPDATE^DIE("","SCFDA","SCRTN","SCERR")
"RTN","SCUTBK",71,0)
 ELSE  D
"RTN","SCUTBK",72,0)
 . D FILE^DIE("","SCFDA","SCERR")
"RTN","SCUTBK",73,0)
 S N=0
"RTN","SCUTBK",74,0)
 ;
"RTN","SCUTBK",75,0)
 D SETF("[Data]")
"RTN","SCUTBK",76,0)
 ; -- send back info on entry #'s for placeholders
"RTN","SCUTBK",77,0)
 S I=0 F  S I=$O(SCRTN(I)) Q:'I  D SETF("+"_I_U_SCRTN(I))
"RTN","SCUTBK",78,0)
 ;
"RTN","SCUTBK",79,0)
 IF $D(SCERR) D
"RTN","SCUTBK",80,0)
 . D SETF("[Errors]")
"RTN","SCUTBK",81,0)
 . D SETF("An error has occurred.")
"RTN","SCUTBK",82,0)
 Q
"RTN","SCUTBK",83,0)
 ;
"RTN","SCUTBK",84,0)
SETF(X) ;
"RTN","SCUTBK",85,0)
 S N=N+1
"RTN","SCUTBK",86,0)
 S SCDATA(N)=X
"RTN","SCUTBK",87,0)
 Q
"RTN","SCUTBK",88,0)
 ;
"RTN","SCUTBK",89,0)
FDASET(SCROOT,SCFDA) ;
"RTN","SCUTBK",90,0)
 N SCFILE,SCIEN,SCFIELD,SCVAL,SCERR,I
"RTN","SCUTBK",91,0)
 ;
"RTN","SCUTBK",92,0)
 S I=0
"RTN","SCUTBK",93,0)
 F  S I=$O(SCROOT(I)) Q:'I  S X=SCROOT(I) D
"RTN","SCUTBK",94,0)
 . S SCFILE=$P(X,U)
"RTN","SCUTBK",95,0)
 . S SCFIELD=$P(X,U,2)
"RTN","SCUTBK",96,0)
 . S SCIEN=$P(X,U,3)
"RTN","SCUTBK",97,0)
 . S SCVAL=$P(X,U,4)
"RTN","SCUTBK",98,0)
 . D FDA^DILF(SCFILE,SCIEN_",",SCFIELD,"",SCVAL,"SCFDA","SCERR")
"RTN","SCUTBK",99,0)
 Q
"RTN","SCUTBK",100,0)
 ;
"RTN","SCUTBK",101,0)
TMP ; -- temporary envrionment variables sets until kernel tools arrives
"RTN","SCUTBK",102,0)
 IF '$G(DUZ) D
"RTN","SCUTBK",103,0)
 . S DUZ=.5,DUZ(0)="@",U="^",DTIME=300
"RTN","SCUTBK",104,0)
 . D NOW^%DTC S DT=X
"RTN","SCUTBK",105,0)
 Q
"RTN","SCUTBK",106,0)
 ;
"RTN","SCUTBK",107,0)
VALC(SCDATA,SC) ; -- calls Database Validator
"RTN","SCUTBK",108,0)
 N SCFILE,SCIENS,SCFIELD,SCVALUE,SCVAL,SCRSLT,SCERR
"RTN","SCUTBK",109,0)
 D CHK
"RTN","SCUTBK",110,0)
 S SCFLAGS="E"
"RTN","SCUTBK",111,0)
 S SCFILE=$G(SC("FILE"))
"RTN","SCUTBK",112,0)
 S SCIENS=$G(SC("IENS"))
"RTN","SCUTBK",113,0)
 S SCFIELD=$G(SC("FIELD"))
"RTN","SCUTBK",114,0)
 S SCVAL=$G(SC("VALUE"))
"RTN","SCUTBK",115,0)
 ;
"RTN","SCUTBK",116,0)
 ; -- need to get from kernel broker somehow...
"RTN","SCUTBK",117,0)
 D TMP
"RTN","SCUTBK",118,0)
 ;
"RTN","SCUTBK",119,0)
 D VAL^DIE(SCFILE,SCIENS,SCFIELD,SCFLAGS,SCVAL,.SCRSLT,"","SCERR")
"RTN","SCUTBK",120,0)
 ;
"RTN","SCUTBK",121,0)
 N Y,N
"RTN","SCUTBK",122,0)
 S N=0
"RTN","SCUTBK",123,0)
 D SET("[FILLER]")
"RTN","SCUTBK",124,0)
 D SET("[Data]")
"RTN","SCUTBK",125,0)
 D SET($G(SCRSLT,U))
"RTN","SCUTBK",126,0)
 D SET($G(SCRSLT(0)))
"RTN","SCUTBK",127,0)
 ;
"RTN","SCUTBK",128,0)
 IF $D(SCERR) D
"RTN","SCUTBK",129,0)
 . D SET("[Errors]")
"RTN","SCUTBK",130,0)
 M SCDATA=Y
"RTN","SCUTBK",131,0)
 Q
"VER")
8.0^21.0
**END**
**END**
