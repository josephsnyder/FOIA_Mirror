Released SD*5.3*533 SEQ #442
Extracted from mail message
**KIDS**:SD*5.3*533^

**INSTALL NAME**
SD*5.3*533
"BLD",7643,0)
SD*5.3*533^SCHEDULING^0^3080908^y
"BLD",7643,1,0)
^^3^3^3080702^
"BLD",7643,1,1,0)
This patch corrects the Appointment Listing, so that clinic names print 
"BLD",7643,1,2,0)
and also corrects Set Up a Clinic so that a Midnight to 8am clinic can be 
"BLD",7643,1,3,0)
set up.
"BLD",7643,4,0)
^9.64PA^^
"BLD",7643,6.3)
5
"BLD",7643,"ABPKG")
n
"BLD",7643,"KRN",0)
^9.67PA^8989.52^19
"BLD",7643,"KRN",.4,0)
.4
"BLD",7643,"KRN",.401,0)
.401
"BLD",7643,"KRN",.402,0)
.402
"BLD",7643,"KRN",.403,0)
.403
"BLD",7643,"KRN",.5,0)
.5
"BLD",7643,"KRN",.84,0)
.84
"BLD",7643,"KRN",3.6,0)
3.6
"BLD",7643,"KRN",3.8,0)
3.8
"BLD",7643,"KRN",9.2,0)
9.2
"BLD",7643,"KRN",9.8,0)
9.8
"BLD",7643,"KRN",9.8,"NM",0)
^9.68A^2^1
"BLD",7643,"KRN",9.8,"NM",2,0)
SDCLAV1^^0^B55785540
"BLD",7643,"KRN",9.8,"NM","B","SDCLAV1",2)

"BLD",7643,"KRN",19,0)
19
"BLD",7643,"KRN",19.1,0)
19.1
"BLD",7643,"KRN",101,0)
101
"BLD",7643,"KRN",409.61,0)
409.61
"BLD",7643,"KRN",771,0)
771
"BLD",7643,"KRN",870,0)
870
"BLD",7643,"KRN",8989.51,0)
8989.51
"BLD",7643,"KRN",8989.52,0)
8989.52
"BLD",7643,"KRN",8994,0)
8994
"BLD",7643,"KRN","B",.4,.4)

"BLD",7643,"KRN","B",.401,.401)

"BLD",7643,"KRN","B",.402,.402)

"BLD",7643,"KRN","B",.403,.403)

"BLD",7643,"KRN","B",.5,.5)

"BLD",7643,"KRN","B",.84,.84)

"BLD",7643,"KRN","B",3.6,3.6)

"BLD",7643,"KRN","B",3.8,3.8)

"BLD",7643,"KRN","B",9.2,9.2)

"BLD",7643,"KRN","B",9.8,9.8)

"BLD",7643,"KRN","B",19,19)

"BLD",7643,"KRN","B",19.1,19.1)

"BLD",7643,"KRN","B",101,101)

"BLD",7643,"KRN","B",409.61,409.61)

"BLD",7643,"KRN","B",771,771)

"BLD",7643,"KRN","B",870,870)

"BLD",7643,"KRN","B",8989.51,8989.51)

"BLD",7643,"KRN","B",8989.52,8989.52)

"BLD",7643,"KRN","B",8994,8994)

"BLD",7643,"QDEF")
^^^^YES^^^^NO^^YES
"BLD",7643,"QUES",0)
^9.62^^
"BLD",7643,"REQB",0)
^9.611^2^1
"BLD",7643,"REQB",2,0)
SD*5.3*517^2
"BLD",7643,"REQB","B","SD*5.3*517",2)

"MBREQ")
0
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813
"PKG",16,22,1,"PAH",1,0)
533^3080908
"PKG",16,22,1,"PAH",1,1,0)
^^3^3^3080908
"PKG",16,22,1,"PAH",1,1,1,0)
This patch corrects the Appointment Listing, so that clinic names print 
"PKG",16,22,1,"PAH",1,1,2,0)
and also corrects Set Up a Clinic so that a Midnight to 8am clinic can be 
"PKG",16,22,1,"PAH",1,1,3,0)
set up.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","SDCLAV1")
0^2^B55785540^B53681023
"RTN","SDCLAV1",1,0)
SDCLAV1 ;ALB/LDB - OUTPUT PATTERNS (cont.) ; 9/1/00 10:57am
"RTN","SDCLAV1",2,0)
 ;;5.3;Scheduling;**140,167,168,76,383,463,490,517,533**;Aug 13, 1993;Build 5
"RTN","SDCLAV1",3,0)
 ;
"RTN","SDCLAV1",4,0)
 ;PATCH 383 STOPPED REPORT FROM CREATING AVAILIBILTY-TEH
"RTN","SDCLAV1",5,0)
 ;
"RTN","SDCLAV1",6,0)
S2 N I1,SC,SDAV,SDMED,SI,SL,SM,SS,STARTDAY,SDDD,YCNT,SDFRST
"RTN","SDCLAV1",7,0)
 S P=0 F D=0:0 S D=$O(^UTILITY($J,"SDNMS",D)) Q:D'>0!(SDUP)  S SDV="",SDZ2=SDBD F X5=0:0 S SDV=$O(^UTILITY($J,"SDNMS",D,SDV)) Q:SDV=""!SDUP  S SDC=$P(^UTILITY($J,"SDNMS",D,SDV),"^",3) D S ;Q:SDUP  ;D WR ;,SS
"RTN","SDCLAV1",8,0)
 Q
"RTN","SDCLAV1",9,0)
S1 S SD=^SC(SDC,0),D=$S($P(SD,"^",15):$P(SD,"^",15),1:$P(^DG(43,1,"GL"),"^",3)),SD5=0,SDNM=$P(SD,"^")
"RTN","SDCLAV1",10,0)
 S $P(^UTILITY($J,"SDNMS",D,SDNM),"^",3)=SDC Q
"RTN","SDCLAV1",11,0)
S I '$D(^SC(SDC,"SL")) D SDM,HDR W !!,"THIS CLINIC DOES NOT HAVE APPT. LENGTH" Q
"RTN","SDCLAV1",12,0)
 S (SDZ,SDZ2)=SDBD D SDM,HDR,TIME S SDZ=SDBD-1,SD0=0,SDMED=SDED+.9
"RTN","SDCLAV1",13,0)
 N X,SDSOH S SC=+SDC,SL=^SC(SC,"SL"),X=$P(SL,U,3),STARTDAY=$S($L(X):X,1:8),X=$P(SL,U,6),SI=$S(X="":4,X<3:4,X:X,1:4),X=SDBD,SDSOH=$P(SL,"^",8),SM=$S($E(X,4,5)[12:$E(X,1,3)+1_"01",1:$E(X,1,3)_$E(X,4,5)+1)_"00",SDZ=SDBD
"RTN","SDCLAV1",14,0)
 N POP S POP=0  ;SD/517
"RTN","SDCLAV1",15,0)
LOOP D SDM D:0&$E(SDZ,2,5)=$E(SDZ1,2,5) MON I $E(SDZ,2,5)'=$E(SDZ1,2,5) I 'SDUP D X1 I 'SDUP D A I 'SDUP D:SD0!($E(IOST,1,2)="C-") 3 I 'SDUP D WR I 'SDUP,$E(IOST,1,2)="C-" D 3
"RTN","SDCLAV1",16,0)
 D:POP MSG  ;SD/517
"RTN","SDCLAV1",17,0)
 I 'SDUP I X<SDED S (X,SDZ2)=$S($E(X,4,5)=12:$E(X,1,3)+1_"01",1:$E(X,1,5)+1)_"01",SDZ=X D SDM,HDR,TIME G LOOP
"RTN","SDCLAV1",18,0)
 D:POP MSG  ;SD/517
"RTN","SDCLAV1",19,0)
 Q
"RTN","SDCLAV1",20,0)
 ;
"RTN","SDCLAV1",21,0)
MSG ;Added SD/517
"RTN","SDCLAV1",22,0)
 D WARN
"RTN","SDCLAV1",23,0)
 Q
"RTN","SDCLAV1",24,0)
 ;
"RTN","SDCLAV1",25,0)
SS Q:SDUP  S SDZ=SDZ1,SD5=1
"RTN","SDCLAV1",26,0)
 D A Q:SDUP  D 3 Q:SDUP  D WR Q:SDUP  D:$E(IOST,1,2)="C-" 3 Q
"RTN","SDCLAV1",27,0)
MON Q:'$D(^SC(+SDC,"ST",SDZ,1))  S SDPT=^SC(+SDC,"ST",SDZ,1) D SDPT1
"RTN","SDCLAV1",28,0)
 Q
"RTN","SDCLAV1",29,0)
SDPT1 I YCNT+6>IOSL D:$E(IOST,1,2)="C-" 3 Q:SDUP  D HDR,TIME
"RTN","SDCLAV1",30,0)
 W !,SDPT S SDAP=SDZ-1 F Z=1:1 S SDAP=$O(^SC(SDC,"S",SDAP)) Q:SDAP'>0!(SDAP>(SDZ+.9999))!SDUP  D NM^SDCLAV0
"RTN","SDCLAV1",31,0)
 D YCNT
"RTN","SDCLAV1",32,0)
 Q
"RTN","SDCLAV1",33,0)
TIME ;SD/533 $Select defaults to 8 when Z5=0, so a Midnight to 8am clinic
"RTN","SDCLAV1",34,0)
 ;incorrectly prints available hours as 8am to 4pm instead of 0 to 8am
"RTN","SDCLAV1",35,0)
 ;Two new lines added to fix this and linetag T1 added at Write command
"RTN","SDCLAV1",36,0)
 ;S Z5=$P(^SC(+SDC,"SL"),U,3),SDT=$S(Z5:Z5,1:8),Z5=$P(^("SL"),U,6),SDI=$S(Z5="":4,Z5<3:4,Z5:Z5,1:4)
"RTN","SDCLAV1",37,0)
 S Z5=$P(^SC(+SDC,"SL"),U,3) I Z5=0 S SDT=0,Z5=$P(^("SL"),U,6),SDI=$S(Z5="":4,Z5<3:4,Z5:Z5,1:4) G T1
"RTN","SDCLAV1",38,0)
 S SDT=$S(Z5:Z5,1:8),Z5=$P(^SC(+SDC,"SL"),U,6),SDI=$S(Z5="":4,Z5<3:4,Z5:Z5,1:4)
"RTN","SDCLAV1",39,0)
T1 W !!," TIME",?SDI+SDI-1 F Z6=SDT:1:65\(SDI+SDI)+SDT W $E("|"_$S('Z6:0,1:(Z6-1#12+1))_"                 ",1,SDI+SDI)
"RTN","SDCLAV1",40,0)
 W !," DATE",?SDI+SDI-1,"|" K J F Z7=0:1:6 I $D(^SC(+SDC,"T"_Z7)) S J(Z7)=""
"RTN","SDCLAV1",41,0)
 S YCNT=YCNT+3
"RTN","SDCLAV1",42,0)
 F Z8=1:1:65\(SDI+SDI) W $J("|",SDI+SDI)
"RTN","SDCLAV1",43,0)
 Q
"RTN","SDCLAV1",44,0)
WR N X S (Y3,X1,SDC1,SD0)=0,C=SDZ2
"RTN","SDCLAV1",45,0)
 F S8=C:0 S SDC1=SDC1+1,C=$O(^UTILITY($J,"SDNMS",D,SDV,C)) Q:C'>0!(C>SDMED&('SD5))!SDUP  S SD0=1 D:SDC1=1 HDR1 S X=C D DW^%DTC S Y=C X ^DD("DD") S Y1=$P(Y,"@"),Y2=$P(Y,"@",2),X9=X W:Y1'=Y3 !!,?1,X9,?11,Y1 D WR1 Q:SDUP
"RTN","SDCLAV1",46,0)
 Q:SDUP  I 'SD0 D HDR1 W !!,"No appointments scheduled"
"RTN","SDCLAV1",47,0)
 D:SD0 WR2 S SDZ2=SDZ Q  ;SD/517
"RTN","SDCLAV1",48,0)
WR1 S X4="" F X1=0:0 S X4=$O(^UTILITY($J,"SDNMS",D,SDV,C,X4)) Q:X4=""!SDUP  S X6="" F X2=0:0 S X6=$O(^UTILITY($J,"SDNMS",D,SDV,C,X4,X6)) Q:X6=""  D W1
"RTN","SDCLAV1",49,0)
 Q
"RTN","SDCLAV1",50,0)
 ;
"RTN","SDCLAV1",51,0)
WR2 ;Added SD/517
"RTN","SDCLAV1",52,0)
 D 3 W @IOF D HDR1,DAT
"RTN","SDCLAV1",53,0)
 D A1^SDCLAV
"RTN","SDCLAV1",54,0)
 Q
"RTN","SDCLAV1",55,0)
 ;
"RTN","SDCLAV1",56,0)
HDR N X D NOW^%DTC S Y=$E(%,1,12) X ^DD("DD") S YCNT=1 W @IOF,!?52,Y D:$E(IOST,1,2)="P-" PG^SDCLAV
"RTN","SDCLAV1",57,0)
 I $D(^DG(43,1,"GL")),$P(^("GL"),"^",2) W !?30,$P(^DG(40.8,D,0),"^")
"RTN","SDCLAV1",58,0)
 W !?30,SDV,!?30,SDM,"  ",($E(SDZ,1,3)+1700) S YCNT=4 Q
"RTN","SDCLAV1",59,0)
HDR1 S SDZ2=$S(SDZ2=0:SDBD,SDZ2>SDED:SDED,1:SDZ2) W !!,?30,SDV,!,?30,$P(SDM1,"^",+$E(SDZ2,4,5)),"  ",($E(SDZ2,1,3)+1700) S YCNT=YCNT+3 Q
"RTN","SDCLAV1",60,0)
SDM S SDM1="JANUARY^FEBRUARY^MARCH^APRIL^MAY^JUNE^JULY^AUGUST^SEPTEMBER^OCTOBER^NOVEMBER^DECEMBER",SDM=$P(SDM1,"^",+($E(SDZ,4,5))) Q
"RTN","SDCLAV1",61,0)
W S SDUT=^UTILITY($J,"SDNMS",D,SDV,C,X4,X6) S D1="" F D8=2,3 S D1=$S($P(SDUT,"^",D8)]"":$P(SDUT,"^",D8),1:"")_D1
"RTN","SDCLAV1",62,0)
 W D1 Q
"RTN","SDCLAV1",63,0)
W1 ;added next 2 lines and changed 3rd line SD/517
"RTN","SDCLAV1",64,0)
 S X=C X ^DD("FUNC",2,1)
"RTN","SDCLAV1",65,0)
 I +^UTILITY($J,"SDNMS",D,SDV,C,X4,X6)=0 S X="**WARNING** "_X D W2 Q
"RTN","SDCLAV1",66,0)
 D TAB W:T ?10 W:'T ?11 W X,?20,X4,?51,X6 D MIN W ?61,"("_M1_") MINUTES" D W S Y3=Y1,X1=X9 I YCNT+6>IOSL D 3 Q:SDUP  D HDR1,DAT
"RTN","SDCLAV1",67,0)
 Q
"RTN","SDCLAV1",68,0)
 ;
"RTN","SDCLAV1",69,0)
W2 ;added SD/517
"RTN","SDCLAV1",70,0)
 S POP=1
"RTN","SDCLAV1",71,0)
 D TAB W:T ?1 W:'T ?2 W X,?23,X4,?51,X6 D MIN W ?61,"("_M1_") MINUTES" D W S Y3=Y1,X1=X9 I YCNT+6>IOSL D 3 Q:SDUP  D HDR1,DAT
"RTN","SDCLAV1",72,0)
 Q
"RTN","SDCLAV1",73,0)
WARN ;added SD/517
"RTN","SDCLAV1",74,0)
 W @IOF,! D:$E(IOST,1,2)="P-" PG^SDCLAV
"RTN","SDCLAV1",75,0)
 D HDR1,DAT
"RTN","SDCLAV1",76,0)
 W !!,"*************************************************************************"
"RTN","SDCLAV1",77,0)
 W !,"* WARNING: There is a data inconsistency or data corruption problem      *"
"RTN","SDCLAV1",78,0)
 W !,"* with one or more of the above appointments.  These appointments will   *"
"RTN","SDCLAV1",79,0)
 W !,"* have WARNING displayed to the left of the time.  Corrective action     *"
"RTN","SDCLAV1",80,0)
 W !,"* needs to be taken.  Please cancel any of the appointments above, which *"
"RTN","SDCLAV1",81,0)
 W !,"* have the WARNING display.  If any of them are valid appointments, they *"
"RTN","SDCLAV1",82,0)
 W !,"* will have to be re-entered via Appointment Management.                 *"
"RTN","SDCLAV1",83,0)
 W !,"**************************************************************************"
"RTN","SDCLAV1",84,0)
 D 3
"RTN","SDCLAV1",85,0)
 S POP=0
"RTN","SDCLAV1",86,0)
 Q
"RTN","SDCLAV1",87,0)
 ;
"RTN","SDCLAV1",88,0)
3 N X I $E(IOST,1,2)="C-" F X=$Y:1:IOSL-6 W ! D YCNT
"RTN","SDCLAV1",89,0)
 I  R !!,"PRESS RETURN TO CONTINUE OR ^ TO QUIT  ",SDU:DTIME S:SDU="^"!('$T) SDUP=1
"RTN","SDCLAV1",90,0)
 I YCNT+6'<IOSL,'SDUP W @IOF,! S YCNT=1 D:$E(IOST,1,2)="P-" PG^SDCLAV Q
"RTN","SDCLAV1",91,0)
 Q
"RTN","SDCLAV1",92,0)
A N X D:YCNT+13>IOSL 3 Q:SDUP  D INAC^SDCLAV W !!!,"FOR CLINIC AVAILABILITY PATTERNS:"
"RTN","SDCLAV1",93,0)
 W !!?4,"0-9 and j-z",?15," --denote available slots where j=10,k=11...z=26",!?12,"A-W",?15," --denote overbooks with A being the first slot to be overbooked",!?18,"and B being the second for that same time, etc."
"RTN","SDCLAV1",94,0)
 W !?6,"*,$,!,@,#",?15," --denote overbooks or appts. that fall outside of a clinic's",!?18,"regular hours" S YCNT=YCNT+8 Q
"RTN","SDCLAV1",95,0)
TAB W ! S:$L(X)>7 T=1 S:$L(X)<8 T=0 D YCNT Q
"RTN","SDCLAV1",96,0)
MIN S M1=+^UTILITY($J,"SDNMS",D,SDV,C,X4,X6) Q
"RTN","SDCLAV1",97,0)
DAT I $E($O(^UTILITY($J,"SDNMS",D,SDV,C)),2,7)=$E(C,2,7) W !,?1,X1,?11,Y1 D YCNT
"RTN","SDCLAV1",98,0)
 Q
"RTN","SDCLAV1",99,0)
X1 S X1=X\100_$P("31^28^31^30^31^30^31^31^30^31^30^31",U,$E(X,4,5))
"RTN","SDCLAV1",100,0)
 S X1=$$LEAP(X1) I X1>SDED S X1=SDED
"RTN","SDCLAV1",101,0)
 S SDMED=X1+.9,SDAP=X-.01 F  S SDAP=$O(^SC(SDC,"S",SDAP)) Q:SDAP'>0!(SDAP>(X1+.9999))!SDUP  D NM^SDCLAV0
"RTN","SDCLAV1",102,0)
 D DOW S SDDD=Y
"RTN","SDCLAV1",103,0)
WW ;
"RTN","SDCLAV1",104,0)
 I '$D(^SC(+SC,"ST",X,1)),$$CHKDT() S Y=SDDD#7 G L:'$D(J(Y)),H:$D(^HOLIDAY(X))&('SDSOH) S SS=+$O(^SC(+SC,"T"_Y,X)) G L:SS'>0,L:^(SS,1)="" D
"RTN","SDCLAV1",105,0)
 .S ^SC(+SC,"ST",$P(X,"."),1)=$E($P($T(DAY),U,Y+2),1,2)_" "_$E(X,6,7)_$J("",SI+SI-6)_^(1),^(0)=$P(X,".")
"RTN","SDCLAV1",106,0)
 ;SD*5.3*490 added GOTO command so dates prior to clinic start date no
"RTN","SDCLAV1",107,0)
 ;longer display on grid
"RTN","SDCLAV1",108,0)
 S SDAV=1 D:X>SM WM I $D(^SC(+SC,"ST",X,1)),^(1)["["!(^(1)["CANCELLED")!($D(^HOLIDAY(X))) G:X<$O(^SC(+SC,"T",0)) L W !,$E(^SC(+SC,"ST",X,1),1,80) D YCNT S:'$D(^HOLIDAY(X))&('SDAV) SDAV=1
"RTN","SDCLAV1",109,0)
 I YCNT+6>IOSL D 3 Q:SDUP  D HDR
"RTN","SDCLAV1",110,0)
L S X=X+1,SDDD=SDDD+1
"RTN","SDCLAV1",111,0)
 G WW:X'>X1 Q
"RTN","SDCLAV1",112,0)
 ;
"RTN","SDCLAV1",113,0)
WM W !?36 S Y=$E(X,1,5)_"00",SM=$S($E(X,4,5)[12:$E(X,1,3)+1_"01",1:$E(X,1,3)_$E(X,4,5)+1)_"00" D YCNT
"RTN","SDCLAV1",114,0)
DT W $$FMTE^XLFDT(Y) Q
"RTN","SDCLAV1",115,0)
 ;
"RTN","SDCLAV1",116,0)
DOW S Y=$$DOW^XLFDT(X,1) Q
"RTN","SDCLAV1",117,0)
YCNT S YCNT=YCNT+1 Q
"RTN","SDCLAV1",118,0)
 ;
"RTN","SDCLAV1",119,0)
DAY ;;^SUN^MON^TUES^WEDNES^THURS^FRI^SATUR
"RTN","SDCLAV1",120,0)
DIFF S X1=SDRE,X2=X D ^%DTC S SDDD=SDDD+X,X=SDRE,X1=X\100_28 Q
"RTN","SDCLAV1",121,0)
H S ^SC(+SC,"ST",X,1)="   "_$E(X,6,7)_"    "_$P(^(X,0),U,2),^(0)=X G WW
"RTN","SDCLAV1",122,0)
 ;
"RTN","SDCLAV1",123,0)
LEAP(SDEOM) ;Check for leap year, adjust if indicated
"RTN","SDCLAV1",124,0)
 ;Input: SDEOM=end of month date to adjust for leap year
"RTN","SDCLAV1",125,0)
 Q:$E(SDEOM,4,5)'="02" SDEOM  ; only adjust February
"RTN","SDCLAV1",126,0)
 N SDLEAP
"RTN","SDCLAV1",127,0)
 S SDLEAP=$$FMADD^XLFDT(SDEOM,1)
"RTN","SDCLAV1",128,0)
 Q $S($E(SDLEAP,4,5)="02":SDLEAP,1:SDEOM)
"RTN","SDCLAV1",129,0)
CHKDT() ;
"RTN","SDCLAV1",130,0)
 N Y,RET,SDFA
"RTN","SDCLAV1",131,0)
 I '$D(SDFRST(D,+SC)) D
"RTN","SDCLAV1",132,0)
 .; Create array of days that have a current template.
"RTN","SDCLAV1",133,0)
 .N %H,X,SDFMTDAY,SDAYCNT,SDAYI,SDST,SDAYCHK,SDAYNAM,SDAYNUM
"RTN","SDCLAV1",134,0)
 .S %H=$H
"RTN","SDCLAV1",135,0)
 .D YX^%DTC S SDFMTDAY=X
"RTN","SDCLAV1",136,0)
 .S SDAYCNT=0
"RTN","SDCLAV1",137,0)
 .F SDAYI=0:1:6 D
"RTN","SDCLAV1",138,0)
 ..Q:'$D(^SC(+SC,"T"_SDAYI))
"RTN","SDCLAV1",139,0)
 ..I $O(^SC(+SC,"T"_SDAYI,""),-1)'<SDFMTDAY S SDFRST(D,+SC,SDAYI)="",SDAYCNT=SDAYCNT+1
"RTN","SDCLAV1",140,0)
 .; Calculate first available date for each day that has current template.
"RTN","SDCLAV1",141,0)
 .S SDST=0,SDAYCHK=0
"RTN","SDCLAV1",142,0)
 .F  S SDST=$O(^SC(+SC,"ST",SDST)) Q:SDST=""!(SDAYCHK=SDAYCNT)  D
"RTN","SDCLAV1",143,0)
 ..S SDAYNAM=$E($G(^SC(+SC,"ST",SDST,1)),1,2)
"RTN","SDCLAV1",144,0)
 ..S SDAYNUM=$S(SDAYNAM="MO":1,SDAYNAM="TU":2,SDAYNAM="WE":3,SDAYNAM="TH":4,SDAYNAM="FR":5,SDAYNAM="SA":6,SDAYNAM="SU":0,1:"")
"RTN","SDCLAV1",145,0)
 ..Q:SDAYNUM=""
"RTN","SDCLAV1",146,0)
 ..Q:$G(SDFRST(D,+SC,SDAYNUM))'=""
"RTN","SDCLAV1",147,0)
 ..Q:'$D(^SC(+SC,"T"_SDAYNUM))
"RTN","SDCLAV1",148,0)
 ..S SDFRST(D,+SC,SDAYNUM)=SDST,SDAYCHK=SDAYCHK+1
"RTN","SDCLAV1",149,0)
 ; Get first avail date from array for particular day of week
"RTN","SDCLAV1",150,0)
 S Y=SDDD#7,RET=0
"RTN","SDCLAV1",151,0)
 S SDFA=$G(SDFRST(D,+SC,Y))
"RTN","SDCLAV1",152,0)
 I SDFA'="" D
"RTN","SDCLAV1",153,0)
 .S SDFA=$S(+$H>SDFA:+$H,1:SDFA)
"RTN","SDCLAV1",154,0)
 .I X'<SDFA S RET=1
"RTN","SDCLAV1",155,0)
 Q RET
"VER")
8.0^22.0
"BLD",7643,6)
^442
**END**
**END**
