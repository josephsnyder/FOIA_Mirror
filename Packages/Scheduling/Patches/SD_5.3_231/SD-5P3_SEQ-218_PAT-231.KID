Released SD*5.3*231 SEQ #218
Extracted from mail message
**KIDS**:SD*5.3*231^

**INSTALL NAME**
SD*5.3*231
"BLD",2498,0)
SD*5.3*231^SCHEDULING^0^3010515^y
"BLD",2498,1,0)
^^2^2^3010515^^
"BLD",2498,1,1,0)
The changes included in this patch are described in the description
"BLD",2498,1,2,0)
section of patch SD*5.3*231 in the National Patch Module.
"BLD",2498,4,0)
^9.64PA^^
"BLD",2498,"ABPKG")
n
"BLD",2498,"INID")
n^y^n
"BLD",2498,"INIT")
POST^SD53P231
"BLD",2498,"KRN",0)
^9.67PA^19^17
"BLD",2498,"KRN",.4,0)
.4
"BLD",2498,"KRN",.401,0)
.401
"BLD",2498,"KRN",.402,0)
.402
"BLD",2498,"KRN",.403,0)
.403
"BLD",2498,"KRN",.5,0)
.5
"BLD",2498,"KRN",.84,0)
.84
"BLD",2498,"KRN",3.6,0)
3.6
"BLD",2498,"KRN",3.8,0)
3.8
"BLD",2498,"KRN",9.2,0)
9.2
"BLD",2498,"KRN",9.8,0)
9.8
"BLD",2498,"KRN",9.8,"NM",0)
^9.68A^8^8
"BLD",2498,"KRN",9.8,"NM",1,0)
SD53P231^^0^B3082862
"BLD",2498,"KRN",9.8,"NM",2,0)
SCMCQK1^^0^B64757216
"BLD",2498,"KRN",9.8,"NM",3,0)
SCRPPAT2^^0^B26795324
"BLD",2498,"KRN",9.8,"NM",4,0)
SCRPSLT^^0^B25417054
"BLD",2498,"KRN",9.8,"NM",5,0)
SCRPSLT2^^0^B31388193
"BLD",2498,"KRN",9.8,"NM",6,0)
SCRPTP2^^0^B31636333
"BLD",2498,"KRN",9.8,"NM",7,0)
SCRPTP3^^0^B27766238
"BLD",2498,"KRN",9.8,"NM",8,0)
SCRPV1B^^0^B40452593
"BLD",2498,"KRN",9.8,"NM","B","SCMCQK1",2)

"BLD",2498,"KRN",9.8,"NM","B","SCRPPAT2",3)

"BLD",2498,"KRN",9.8,"NM","B","SCRPSLT",4)

"BLD",2498,"KRN",9.8,"NM","B","SCRPSLT2",5)

"BLD",2498,"KRN",9.8,"NM","B","SCRPTP2",6)

"BLD",2498,"KRN",9.8,"NM","B","SCRPTP3",7)

"BLD",2498,"KRN",9.8,"NM","B","SCRPV1B",8)

"BLD",2498,"KRN",9.8,"NM","B","SD53P231",1)

"BLD",2498,"KRN",19,0)
19
"BLD",2498,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",2498,"KRN",19,"NM",1,0)
SCMC PCMM HL7 REJECTS^^1^
"BLD",2498,"KRN",19,"NM","B","SCMC PCMM HL7 REJECTS",1)

"BLD",2498,"KRN",19.1,0)
19.1
"BLD",2498,"KRN",101,0)
101
"BLD",2498,"KRN",101,"NM",0)
^9.68A^^0
"BLD",2498,"KRN",409.61,0)
409.61
"BLD",2498,"KRN",771,0)
771
"BLD",2498,"KRN",870,0)
870
"BLD",2498,"KRN",8994,0)
8994
"BLD",2498,"KRN","B",.4,.4)

"BLD",2498,"KRN","B",.401,.401)

"BLD",2498,"KRN","B",.402,.402)

"BLD",2498,"KRN","B",.403,.403)

"BLD",2498,"KRN","B",.5,.5)

"BLD",2498,"KRN","B",.84,.84)

"BLD",2498,"KRN","B",3.6,3.6)

"BLD",2498,"KRN","B",3.8,3.8)

"BLD",2498,"KRN","B",9.2,9.2)

"BLD",2498,"KRN","B",9.8,9.8)

"BLD",2498,"KRN","B",19,19)

"BLD",2498,"KRN","B",19.1,19.1)

"BLD",2498,"KRN","B",101,101)

"BLD",2498,"KRN","B",409.61,409.61)

"BLD",2498,"KRN","B",771,771)

"BLD",2498,"KRN","B",870,870)

"BLD",2498,"KRN","B",8994,8994)

"BLD",2498,"PRE")
SD53P231
"BLD",2498,"QUES",0)
^9.62^^
"BLD",2498,"REQB",0)
^9.611^1^1
"BLD",2498,"REQB",1,0)
SD*5.3*177^2
"BLD",2498,"REQB","B","SD*5.3*177",1)

"INIT")
POST^SD53P231
"KRN",19,9821,-1)
1^1
"KRN",19,9821,0)
SCMC PCMM HL7 REJECTS
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2941102
"PKG",16,22,1,"PAH",1,0)
231^3010515
"PKG",16,22,1,"PAH",1,1,0)
^^2^2^3010515
"PKG",16,22,1,"PAH",1,1,1,0)
The changes included in this patch are described in the description
"PKG",16,22,1,"PAH",1,1,2,0)
section of patch SD*5.3*231 in the National Patch Module.
"PRE")
SD53P231
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
8
"RTN","SCMCQK1")
0^2^B64757216
"RTN","SCMCQK1",1,0)
SCMCQK1 ;ALB/REW - Single Pt Tm/Pt Tm Pos Assign and Discharge ; 1 Jul 1998
"RTN","SCMCQK1",2,0)
 ;;5.3;Scheduling;**148,177,231**;AUG 13, 1993
"RTN","SCMCQK1",3,0)
 ;
"RTN","SCMCQK1",4,0)
UNTP ;unassign patient from pc prac position
"RTN","SCMCQK1",5,0)
 IF '$G(SCTP) W !,"No position defined" Q
"RTN","SCMCQK1",6,0)
 N OK,SCER,SCCL,SCBEGIN,SCN,SCLIST,SCEND,SCINCL,SCLSEQ,SCDATES,SCDTS
"RTN","SCMCQK1",7,0)
 S OK=0
"RTN","SCMCQK1",8,0)
 W !,"About to Unassign "_$$NAME(DFN)_" from: ",!,?8,$$POSITION(SCTP)_" position   ["_$P($$GETPRTP^SCAPMCU2(SCTP,DT),U,2)_"]"
"RTN","SCMCQK1",9,0)
 S SCDISCH=$$DATE("D")
"RTN","SCMCQK1",10,0)
 G:SCDISCH<1 QTUNTP
"RTN","SCMCQK1",11,0)
 G:'$$CONFIRM() QTUNTP
"RTN","SCMCQK1",12,0)
 S OK=$$INPTSCTP^SCAPMC22(DFN,SCTP,SCDISCH,.SCER)
"RTN","SCMCQK1",13,0)
 G:OK'>0 QTUNTP
"RTN","SCMCQK1",14,0)
 S SCCL=$P($G(^SCTM(404.57,+$G(SCTP),0)),U,9)
"RTN","SCMCQK1",15,0)
 IF SCCL D DISCL
"RTN","SCMCQK1",16,0)
QTUNTP W !,"Position Unassignment "_$S(OK:"made.",1:"NOT made.")
"RTN","SCMCQK1",17,0)
 Q
"RTN","SCMCQK1",18,0)
 ;
"RTN","SCMCQK1",19,0)
ENRCL ;
"RTN","SCMCQK1",20,0)
 N SCRESTA,SCREST,SCCLNM,SCTM
"RTN","SCMCQK1",21,0)
 G:$$ACTCL(DFN,SCCL) QTECL
"RTN","SCMCQK1",22,0)
 W !!!,"The "_$$POSITION(SCTP)_" is associated with the ",$$CLINIC(SCCL)_" clinic."
"RTN","SCMCQK1",23,0)
 ; SCRESTA = Array of pt's teams causing restricted consults
"RTN","SCMCQK1",24,0)
 N SCRESTA
"RTN","SCMCQK1",25,0)
 S SCREST=$$RESTPT^SCAPMCU4(DFN,DT,"SCRESTA")
"RTN","SCMCQK1",26,0)
 IF SCREST D
"RTN","SCMCQK1",27,0)
 .N SCTM
"RTN","SCMCQK1",28,0)
 . S SCCLNM=Y
"RTN","SCMCQK1",29,0)
 . W !,?5,"Patient has restricted consults due to team assignment(s):"
"RTN","SCMCQK1",30,0)
 .S SCTM=0
"RTN","SCMCQK1",31,0)
 .F  S SCTM=$O(SCRESTA(SCTM)) Q:'SCTM  W !,?10,SCRESTA(SCTM)
"RTN","SCMCQK1",32,0)
 IF SCREST&'$G(SCOKCONS) D  G QTECL
"RTN","SCMCQK1",33,0)
 .W !,?5,"This patient may only be enrolled in clinics via"
"RTN","SCMCQK1",34,0)
 .W !,?15,"Edit Clinic Enrollment Data option"
"RTN","SCMCQK1",35,0)
 W !,"Do you wish to enroll the patient from this clinic on "
"RTN","SCMCQK1",36,0)
 S Y=SCASSDT X ^DD("DD") W Y,"?"
"RTN","SCMCQK1",37,0)
 IF $$YESNO() D
"RTN","SCMCQK1",38,0)
 .W !,"Clinic Enrollment"
"RTN","SCMCQK1",39,0)
 .IF $$ACPTCL^SCAPMC18(DFN,SCCL,,SCASSDT,"SCENER") W " made"
"RTN","SCMCQK1",40,0)
 .ELSE  W "NOT made"
"RTN","SCMCQK1",41,0)
QTECL Q
"RTN","SCMCQK1",42,0)
 ;
"RTN","SCMCQK1",43,0)
DISCL ;
"RTN","SCMCQK1",44,0)
 G:'$$ACTCL(DFN,SCCL) QTDCL
"RTN","SCMCQK1",45,0)
 W !,$$NAME(DFN)," is enrolled in the associated "_$$CLINIC(SCCL)_" clinic."
"RTN","SCMCQK1",46,0)
 W !,"Do you wish to discharge the patient from this clinic on "
"RTN","SCMCQK1",47,0)
 S Y=SCDISCH X ^DD("DD") W Y,"?"
"RTN","SCMCQK1",48,0)
 G:'$$YESNO() QTDCL
"RTN","SCMCQK1",49,0)
 N SDFN,SDCLN S SDFN=DFN,SDCLN=SCCL
"RTN","SCMCQK1",50,0)
 N DFN D ^SDCD
"RTN","SCMCQK1",51,0)
QTDCL Q
"RTN","SCMCQK1",52,0)
 ;
"RTN","SCMCQK1",53,0)
UNTM ;
"RTN","SCMCQK1",54,0)
 ;assign patient from pc team (and pc position if possible)
"RTN","SCMCQK1",55,0)
 N OK,SCER,SCBEGIN,SCN,SCLIST,SCEND,SCINCL,SCLSEQ,SCDATES,SCDTS,OK2,OK3
"RTN","SCMCQK1",56,0)
 S OK=0
"RTN","SCMCQK1",57,0)
 W !!,"About to Unassign "_$$NAME(DFN)_" from "_$$TEAMNM(SCTM)_" team"
"RTN","SCMCQK1",58,0)
 W:'SCTPSTAT !,?5,"AND from "_$$POSITION(SCTP)_" position  ["_$$WRITETP^SCMCDD1(SCTP)_"]"
"RTN","SCMCQK1",59,0)
 S SCDISCH=$$DATE("D")
"RTN","SCMCQK1",60,0)
 G:SCDISCH<1 QTUNTM
"RTN","SCMCQK1",61,0)
 G:'$$CONFIRM() QTUNTM
"RTN","SCMCQK1",62,0)
 IF 'SCTPSTAT D  G:OK2'>0 QTUNTM
"RTN","SCMCQK1",63,0)
 .W !,"PC assignment unassigned."
"RTN","SCMCQK1",64,0)
 .S OK2=$$INPTSCTP^SCAPMC22(DFN,SCTP,SCDISCH,.SCER)
"RTN","SCMCQK1",65,0)
 .IF OK2>0 D
"RTN","SCMCQK1",66,0)
 ..W "made."
"RTN","SCMCQK1",67,0)
 ..S SCCL=$P(^SCTM(404.57,SCTP,0),U,9)
"RTN","SCMCQK1",68,0)
 ..D:SCCL DISCL
"RTN","SCMCQK1",69,0)
 S OK3=$$ALLPOS()
"RTN","SCMCQK1",70,0)
 IF $$OKINPTTM^SCMCTMU2(DFN,SCTM,SCDISCH) D
"RTN","SCMCQK1",71,0)
 .S OK=$$INPTSCTM^SCAPMC7(DFN,SCTM,SCDISCH,.SCER)
"RTN","SCMCQK1",72,0)
 ELSE  D
"RTN","SCMCQK1",73,0)
 . W !,"Future/Current Patient-Position Assignment exists"
"RTN","SCMCQK1",74,0)
QTUNTM W !,"Team Unassignment "_$S(OK:"made",1:"NOT made.")
"RTN","SCMCQK1",75,0)
 Q
"RTN","SCMCQK1",76,0)
 ;
"RTN","SCMCQK1",77,0)
ALLPOS() ;unassign all patient-positions for team
"RTN","SCMCQK1",78,0)
 ; not stand-alone - needs dfn,sctm
"RTN","SCMCQK1",79,0)
 ;   return 1=No positions left assigned|0=At least 1 position assigned
"RTN","SCMCQK1",80,0)
 N OK,SCDT1,SCPTTPX,SCERRR,SCTP,SCCNT,SCPTTPI,SCLOC,SCNODE,SCPTTP2
"RTN","SCMCQK1",81,0)
 S SCDT1("BEGIN")=SCDISCH+1
"RTN","SCMCQK1",82,0)
 S SCDT1("END")=3990101
"RTN","SCMCQK1",83,0)
 S SCDT1("INCL")=0  ;anytime from now to future
"RTN","SCMCQK1",84,0)
 S OK=$$TPPT^SCAPMC23(DFN,"SCDT1",,,,,,"SCPTTPX",.SCERRR)
"RTN","SCMCQK1",85,0)
 S (SCTP,SCCNT)=0
"RTN","SCMCQK1",86,0)
 W !,"Checking for other position assignments to team..."
"RTN","SCMCQK1",87,0)
 F  S SCTP=$O(SCPTTPX("SCTP",SCTM,SCTP)) Q:'SCTP  S SCCNT=SCCNT+1 D
"RTN","SCMCQK1",88,0)
 .S SCPTTPI=$O(SCPTTPX("SCTP",SCTM,SCTP,9999999),-1)
"RTN","SCMCQK1",89,0)
 .S SCLOC=$O(SCPTTPX("SCTP",SCTM,SCTP,SCPTTPI,0))
"RTN","SCMCQK1",90,0)
 .S SCNODE=SCPTTPX(SCLOC)
"RTN","SCMCQK1",91,0)
 .S SCPTTP2(SCTP)=""
"RTN","SCMCQK1",92,0)
 .W !,?3,$P(SCNODE,U,2),"   ",$P(SCNODE,U,8)
"RTN","SCMCQK1",93,0)
 .IF $P(SCNODE,U,6)!(SCDISCH'>$P(SCNODE,U,5)) D
"RTN","SCMCQK1",94,0)
 ..W !,?5,"Unassignment date already exists or unassignment after assignment date"
"RTN","SCMCQK1",95,0)
 ..W !,?15,"- Correct via PCMM GUI"
"RTN","SCMCQK1",96,0)
 ..S OK=0
"RTN","SCMCQK1",97,0)
 W !,?5,$S(SCCNT:SCCNT,1:"No")_" current/future position assignment(s)"
"RTN","SCMCQK1",98,0)
 G:'OK!('SCCNT) QTALL
"RTN","SCMCQK1",99,0)
 W !!,"About to unassign the above patient-position assignments"
"RTN","SCMCQK1",100,0)
 IF '$$CONFIRM S OK=0 G QTALL
"RTN","SCMCQK1",101,0)
 S SCTP=0
"RTN","SCMCQK1",102,0)
 F  S SCTP=$O(SCPTTP2(SCTP)) Q:'SCTP  D  Q:'OK
"RTN","SCMCQK1",103,0)
 .S OK=$$INPTSCTP^SCAPMC22(DFN,SCTP,SCDISCH,.SCER)
"RTN","SCMCQK1",104,0)
 .W:'OK !,?10,"Problem with unassignment, correct via PCMM GUI"
"RTN","SCMCQK1",105,0)
QTALL Q OK
"RTN","SCMCQK1",106,0)
 ;
"RTN","SCMCQK1",107,0)
ASTM ;assign patient to PC team
"RTN","SCMCQK1",108,0)
 N DIC,Y,OK,SCTM,SCTMFLDS,SCER,SCBEGIN,SCN,SCLIST,SCEND,SCINCL,SCLSEQ,SCDATES,SCDTS
"RTN","SCMCQK1",109,0)
 S OK=0
"RTN","SCMCQK1",110,0)
 W !!,"About to Assign "_$$NAME(DFN)_" to a primary care team"
"RTN","SCMCQK1",111,0)
 S DIC="^SCTM(404.51,"
"RTN","SCMCQK1",112,0)
 S DIC(0)="AEMQZ"
"RTN","SCMCQK1",113,0)
 S DIC("S")="IF $$ACTTM^SCMCTMU(Y,DT)&($P($G(^SCTM(404.51,Y,0)),U,5))"
"RTN","SCMCQK1",114,0)
 ;  - select from active teams that can be PC Teams
"RTN","SCMCQK1",115,0)
 D ^DIC
"RTN","SCMCQK1",116,0)
 G:Y<1 QTASTM
"RTN","SCMCQK1",117,0)
 S SCTM=+Y
"RTN","SCMCQK1",118,0)
 S SCASSDT=$$DATE("A")
"RTN","SCMCQK1",119,0)
 G:SCASSDT<1 QTASTM
"RTN","SCMCQK1",120,0)
 S SCTMCT=$$TEAMCNT^SCAPMCU1(SCTM)
"RTN","SCMCQK1",121,0)
 S SCTMMAX=$P($$GETEAM^SCAPMCU3(SCTM),"^",8)
"RTN","SCMCQK1",122,0)
 I SCTMCT'<SCTMMAX  D  G:'$$YESNO2() QTASTM
"RTN","SCMCQK1",123,0)
 .W !,"This assignment will reach or exceeded the maximum set for this team."
"RTN","SCMCQK1",124,0)
 .W !,"Currently assigned: "_SCTMCT
"RTN","SCMCQK1",125,0)
 .W !,"Maximum set for team: "_SCTMMAX
"RTN","SCMCQK1",126,0)
 I SCTMCT<SCTMMAX,'$$CONFIRM() G QTASTM
"RTN","SCMCQK1",127,0)
 S SCTM=+Y
"RTN","SCMCQK1",128,0)
 ;setup fields
"RTN","SCMCQK1",129,0)
 S SCTMFLDS(.08)=1 ;primary care assignment
"RTN","SCMCQK1",130,0)
 S SCTMFLDS(.11)=$G(DUZ,.5)
"RTN","SCMCQK1",131,0)
 D NOW^%DTC S SCTMFLDS(.12)=%
"RTN","SCMCQK1",132,0)
 IF $$ACPTTM^SCAPMC(DFN,SCTM,"SCTMFLDS",SCASSDT,"SCTPTME") D
"RTN","SCMCQK1",133,0)
 .S SCSELECT=$$SELPOS()
"RTN","SCMCQK1",134,0)
 .D:$L(SCSELECT) ASTP ;prompt for position prompt
"RTN","SCMCQK1",135,0)
 .S OK=1
"RTN","SCMCQK1",136,0)
QTASTM W !,"Team Assignment "_$S(OK:"made",1:"NOT made.")
"RTN","SCMCQK1",137,0)
 Q
"RTN","SCMCQK1",138,0)
ASTP ;assign patient to PC practitioner
"RTN","SCMCQK1",139,0)
 N DIC,Y,OK,SCCL,X,SCTPFLDS,SCER,SCBEGIN,SCN,SCLIST,SCEND,SCINCL,SCLSEQ,SCDATES,SCDTS
"RTN","SCMCQK1",140,0)
 S OK=0
"RTN","SCMCQK1",141,0)
 W !!,"About to Assign "_$$NAME(DFN)_" to PC Position Assignment"
"RTN","SCMCQK1",142,0)
 ;lookup to display only position and [practitioner]
"RTN","SCMCQK1",143,0)
 IF SCSELECT="PRACT" D
"RTN","SCMCQK1",144,0)
 .S DIC("W")="N SCP1 S SCP1=$G(^SCTM(404.52,Y,0)) W ""    ["",$P($G(^VA(200,+$P(SCP1,U,3),0)),U,1),""]"""
"RTN","SCMCQK1",145,0)
 .S DIC("A")="POSITION's Current PRACTITIONER: "
"RTN","SCMCQK1",146,0)
 .S DIC="^SCTM(404.52,"
"RTN","SCMCQK1",147,0)
 .;Must be from team, must be activation,must not have future inactivation
"RTN","SCMCQK1",148,0)
 .S DIC("S")="I $$PRACSCR^SCMCQK1(Y)"
"RTN","SCMCQK1",149,0)
 .S D="C"
"RTN","SCMCQK1",150,0)
 ELSE  D
"RTN","SCMCQK1",151,0)
 .S DIC="^SCTM(404.57,"
"RTN","SCMCQK1",152,0)
 .S D="B"
"RTN","SCMCQK1",153,0)
 .S DIC("A")="POSITION's Name: "
"RTN","SCMCQK1",154,0)
 .S DIC("S")="I $$POSSCR^SCMCQK1(Y)"
"RTN","SCMCQK1",155,0)
 S DIC(0)="AEMQZ"
"RTN","SCMCQK1",156,0)
 D MIX^DIC1
"RTN","SCMCQK1",157,0)
 G:Y<1 QTASTP
"RTN","SCMCQK1",158,0)
 IF SCSELECT="PRACT" D
"RTN","SCMCQK1",159,0)
 .S SCTP=$P(Y,U,2)
"RTN","SCMCQK1",160,0)
 ELSE  D
"RTN","SCMCQK1",161,0)
 .S SCTP=$P(Y,U,1)
"RTN","SCMCQK1",162,0)
 S SCASSDT=$$DATE("A")
"RTN","SCMCQK1",163,0)
 G:SCASSDT<1 QTASTP
"RTN","SCMCQK1",164,0)
 G:'$$CONFIRM() QTASTP
"RTN","SCMCQK1",165,0)
 ;setup fields
"RTN","SCMCQK1",166,0)
 S SCTPFLDS(.03)=SCASSDT
"RTN","SCMCQK1",167,0)
 S SCTPFLDS(.05)=1 ;pc pract role
"RTN","SCMCQK1",168,0)
 S SCTPFLDS(.06)=$G(DUZ,.5)
"RTN","SCMCQK1",169,0)
 D NOW^%DTC S SCTPFLDS(.07)=%
"RTN","SCMCQK1",170,0)
 IF $$ACPTTP^SCAPMC21(DFN,SCTP,"SCTPFLDS",SCASSDT,"SCTPTME",0) D
"RTN","SCMCQK1",171,0)
 .S OK=1
"RTN","SCMCQK1",172,0)
 .S SCCL=$P(^SCTM(404.57,SCTP,0),U,9)
"RTN","SCMCQK1",173,0)
 .D:SCCL ENRCL
"RTN","SCMCQK1",174,0)
QTASTP W !,"Position Assignment "_$S(OK:"made",1:"NOT made.")
"RTN","SCMCQK1",175,0)
 Q
"RTN","SCMCQK1",176,0)
NAME(DFN) ;return patient name
"RTN","SCMCQK1",177,0)
 Q $P($G(^DPT(DFN,0)),U,1)
"RTN","SCMCQK1",178,0)
 ;
"RTN","SCMCQK1",179,0)
POSITION(SCTP) ;return position name
"RTN","SCMCQK1",180,0)
 Q $P($G(^SCTM(404.57,SCTP,0)),U,1)
"RTN","SCMCQK1",181,0)
 ;
"RTN","SCMCQK1",182,0)
TEAMNM(SCTM) ;return team name
"RTN","SCMCQK1",183,0)
 Q $P($G(^SCTM(404.51,SCTM,0)),U,1)
"RTN","SCMCQK1",184,0)
 ;
"RTN","SCMCQK1",185,0)
CLINIC(SCCL) ;return clinic name
"RTN","SCMCQK1",186,0)
 Q $P($G(^SC(+SCCL,0)),U,1)
"RTN","SCMCQK1",187,0)
 ;
"RTN","SCMCQK1",188,0)
YESNO() ;
"RTN","SCMCQK1",189,0)
 N DIR,X,Y
"RTN","SCMCQK1",190,0)
 S DIR(0)="Y",DIR("B")="YES"
"RTN","SCMCQK1",191,0)
 D ^DIR
"RTN","SCMCQK1",192,0)
 Q Y>0
"RTN","SCMCQK1",193,0)
 ;
"RTN","SCMCQK1",194,0)
YESNO2() ;
"RTN","SCMCQK1",195,0)
 N DIR,X,Y
"RTN","SCMCQK1",196,0)
 S DIR(0)="Y",DIR("B")="NO"
"RTN","SCMCQK1",197,0)
 S DIR("A")="Do you wish to continue with the assignment (Yes/No)?"
"RTN","SCMCQK1",198,0)
 D ^DIR
"RTN","SCMCQK1",199,0)
 Q Y>0
"RTN","SCMCQK1",200,0)
CONFIRM() ;confirmation call
"RTN","SCMCQK1",201,0)
 N DIR,X,Y
"RTN","SCMCQK1",202,0)
 S DIR("A")="Are you sure (Yes/No)"
"RTN","SCMCQK1",203,0)
 S DIR(0)="Y"
"RTN","SCMCQK1",204,0)
 D ^DIR
"RTN","SCMCQK1",205,0)
 Q +Y=1
"RTN","SCMCQK1",206,0)
 ;
"RTN","SCMCQK1",207,0)
SELPOS() ;return way to select position: 1=PRACT,2=POSIT,3=NONE
"RTN","SCMCQK1",208,0)
 N DIR,X,Y
"RTN","SCMCQK1",209,0)
 W !,"Choose way to select PC POSITION Assignment: "
"RTN","SCMCQK1",210,0)
 S DIR(0)="SO^0:NONE;1:BY PRACTITIONER ASSIGNMENT;2:BY POSITION ASSIGNMENT"
"RTN","SCMCQK1",211,0)
 S DIR("B")=1
"RTN","SCMCQK1",212,0)
 D ^DIR
"RTN","SCMCQK1",213,0)
 Q $S(Y'>0:"",+Y=1:"PRACT",1:"POSIT")
"RTN","SCMCQK1",214,0)
 ;
"RTN","SCMCQK1",215,0)
DATE(TYPE) ;return date type=A or D
"RTN","SCMCQK1",216,0)
 N DIR,X,Y
"RTN","SCMCQK1",217,0)
 S DIR("A")=$S(TYPE="A":"Assignment",1:"Unassignment")_" date: "
"RTN","SCMCQK1",218,0)
 S DIR(0)="DA^::EXP"
"RTN","SCMCQK1",219,0)
 S Y=$S($D(SCDISCH):SCDISCH,$D(SCASSDT):SCASSDT,(TYPE="A"):"TODAY",1:"TODAY-1")
"RTN","SCMCQK1",220,0)
 X ^DD("DD")
"RTN","SCMCQK1",221,0)
 S DIR("B")=Y
"RTN","SCMCQK1",222,0)
 D ^DIR
"RTN","SCMCQK1",223,0)
 Q Y
"RTN","SCMCQK1",224,0)
ACTCL(DFN,SCCL) ;is patient enrolled in clinic?
"RTN","SCMCQK1",225,0)
 N SCXX
"RTN","SCMCQK1",226,0)
 S SCXX=$O(^DPT(DFN,"DE","B",SCCL,9999),-1)
"RTN","SCMCQK1",227,0)
 Q $S('SCXX:0,($P(^DPT(DFN,"DE",+SCXX,0),U,2)="I"):0,1:1)
"RTN","SCMCQK1",228,0)
 ;
"RTN","SCMCQK1",229,0)
PRACSCR(SC40452) ;screen for for file 404.52
"RTN","SCMCQK1",230,0)
 N SCP,SCNODE,OK
"RTN","SCMCQK1",231,0)
 S SCP=$G(^SCTM(404.52,SC40452,0))
"RTN","SCMCQK1",232,0)
 S OK=0
"RTN","SCMCQK1",233,0)
 G:'SCP QTPP
"RTN","SCMCQK1",234,0)
 S SCNODE=$G(^SCTM(404.57,+SCP,0))
"RTN","SCMCQK1",235,0)
 S OK=$S($P(SCNODE,U,2)'=SCTM:0,'$P(SCNODE,U,4):0,($O(^SCTM(404.52,"AIDT",+SCP,1,""))'=-$P(SCP,U,2)):0,($O(^SCTM(404.52,"AIDT",+SCP,0,-$P(SCP,U,2)),-1)):0,($$ACTTP^SCMCTPU(+SCP)>0):1,1:0)
"RTN","SCMCQK1",236,0)
QTPP Q OK
"RTN","SCMCQK1",237,0)
 ;
"RTN","SCMCQK1",238,0)
POSSCR(SCTP) ;screen for file 404.57
"RTN","SCMCQK1",239,0)
 N SCNODE
"RTN","SCMCQK1",240,0)
 S SCNODE=$G(^SCTM(404.57,SCTP,0))
"RTN","SCMCQK1",241,0)
 Q $S($P(SCNODE,U,2)'=SCTM:0,'$P(SCNODE,U,4):0,($$ACTTP^SCMCTPU(SCTP)>0):1,1:0)
"RTN","SCRPPAT2")
0^3^B26795324
"RTN","SCRPPAT2",1,0)
SCRPPAT2 ;ALB/CMM - Practitioner's Patients ; 12/12/00 3:46pm
"RTN","SCRPPAT2",2,0)
 ;;5.3;Scheduling;**41,48,174,181,177,231**;AUG 13, 1993
"RTN","SCRPPAT2",3,0)
 ;
"RTN","SCRPPAT2",4,0)
 ;Listing of Practitioner's Patients
"RTN","SCRPPAT2",5,0)
 ;
"RTN","SCRPPAT2",6,0)
DRIVE ;
"RTN","SCRPPAT2",7,0)
 ;driver module
"RTN","SCRPPAT2",8,0)
 N PRAC,INF,ARRY,ERROR,NXT,OKAY,PIEN,TPRC
"RTN","SCRPPAT2",9,0)
 S ARRY="^TMP(""SCARRAY"","_$J_")",ERROR="ERR"
"RTN","SCRPPAT2",10,0)
 S TPRC="^TMP(""SCRP"",$J,""PRACT"")" M @TPRC=PRACT
"RTN","SCRPPAT2",11,0)
 K @ARRY,@ERROR,PRACT
"RTN","SCRPPAT2",12,0)
 I @TPRC=1 D ALL^SCRPPAT3 ;all practitioners selected
"RTN","SCRPPAT2",13,0)
 S NXT=0
"RTN","SCRPPAT2",14,0)
 F  S NXT=$O(@TPRC@(NXT)) Q:NXT=""!(NXT'?.N)  D
"RTN","SCRPPAT2",15,0)
 .I @TPRC=0 S PIEN=NXT
"RTN","SCRPPAT2",16,0)
 .I @TPRC=1 S PIEN=$P(@TPRC@(NXT),"^")
"RTN","SCRPPAT2",17,0)
 .K @ARRY,@ERROR
"RTN","SCRPPAT2",18,0)
 .S OKAY=$$PTPR^SCAPMC14(PIEN,"","","",ARRY,ERROR) ;patients for practitioner
"RTN","SCRPPAT2",19,0)
 .I '+OKAY Q
"RTN","SCRPPAT2",20,0)
 .D LOOPPT(ARRY,PIEN) ;loop through patients for practitioner
"RTN","SCRPPAT2",21,0)
 K @ARRY,@ERROR,@TPRC
"RTN","SCRPPAT2",22,0)
 K:SUMM @STORE@("PT")
"RTN","SCRPPAT2",23,0)
 Q
"RTN","SCRPPAT2",24,0)
 ;
"RTN","SCRPPAT2",25,0)
LOOPPT(ARY,PRAC) ;loop through patients for practitioner
"RTN","SCRPPAT2",26,0)
 ;ARY - array of patients for selected practitioner
"RTN","SCRPPAT2",27,0)
 ;PRAC - practitioner ien
"RTN","SCRPPAT2",28,0)
 N NXT,PIEN,TPIEN,PNAME,TPIEN,NODE,PTP,TPI,TPN,CLIEN,CNAME,PTA,PTAN,TIEN
"RTN","SCRPPAT2",29,0)
 N PC,TNODE,TNAME,PINF,POSN,PRCP
"RTN","SCRPPAT2",30,0)
 S NXT=0
"RTN","SCRPPAT2",31,0)
 F  S NXT=$O(@ARY@(NXT)) Q:NXT=""!(NXT'?.N)  D
"RTN","SCRPPAT2",32,0)
 .S NODE=$G(@ARY@(NXT))
"RTN","SCRPPAT2",33,0)
 .Q:NODE=""
"RTN","SCRPPAT2",34,0)
 .S PIEN=+$P(NODE,"^") ;ien of patient file entry
"RTN","SCRPPAT2",35,0)
 .S TPIEN=+$P(NODE,"^",3) ;ien of patient team position assignment
"RTN","SCRPPAT2",36,0)
 .S PTP=$G(^SCPT(404.43,TPIEN,0))
"RTN","SCRPPAT2",37,0)
 .Q:PTP=""
"RTN","SCRPPAT2",38,0)
 .S PTA=+$P(PTP,"^") ;patient team assignment ien (404.42)
"RTN","SCRPPAT2",39,0)
 .S PTAN=$G(^SCPT(404.42,PTA,0))
"RTN","SCRPPAT2",40,0)
 .Q:PTAN=""
"RTN","SCRPPAT2",41,0)
 .S TIEN=+$P(PTAN,"^",3) ;team file ien (404.51)
"RTN","SCRPPAT2",42,0)
 .I $G(TEAM)'=1,'$D(TEAM(TIEN)) Q  ;not a selected team
"RTN","SCRPPAT2",43,0)
 .S TNODE=$G(^SCTM(404.51,TIEN,0))
"RTN","SCRPPAT2",44,0)
 .Q:TNODE=""  I $G(INST)'=1,'$D(INST(+$P(TNODE,U,7))) Q
"RTN","SCRPPAT2",45,0)
 .S TNAME=$P(TNODE,"^") ;team name
"RTN","SCRPPAT2",46,0)
 .S TPI=+$P(PTP,"^",2) ;Team Position file ien (404.57)
"RTN","SCRPPAT2",47,0)
 .S TPN=$G(^SCTM(404.57,TPI,0))
"RTN","SCRPPAT2",48,0)
 .Q:TPN=""
"RTN","SCRPPAT2",49,0)
 .I $G(ROLE)'=1,'$D(ROLE(+$P(TPN,U,3))) Q  ;not a selected role
"RTN","SCRPPAT2",50,0)
 .S POSN=$P(TPN,"^") ;position name
"RTN","SCRPPAT2",51,0)
 .S CLIEN=+$P(TPN,"^",9) ;associated clinic ien
"RTN","SCRPPAT2",52,0)
 .D CECHK(CLIEN,.CNAME,PIEN) ;is patient enrolled in associated clinic?
"RTN","SCRPPAT2",53,0)
 .S PC=$S($P(PTP,"^",5)=0:0,1:1) ;primary care position 1or2-yes/0-no
"RTN","SCRPPAT2",54,0)
 .S PNAME=$P($G(^VA(200,+PRAC,0)),"^") ;practitioner name
"RTN","SCRPPAT2",55,0)
 .Q:PNAME=""
"RTN","SCRPPAT2",56,0)
 .S PRCP=$P($$OKPREC2^SCMCLK(TPI,DT),U,2)
"RTN","SCRPPAT2",57,0)
 .S PINF=PIEN_"^"_$$PDATA^SCRPEC(PIEN,CLIEN,1)
"RTN","SCRPPAT2",58,0)
 .;$$PDATA returns pt name,pid,mt,pelig,status,status date,last appt,nxt appt
"RTN","SCRPPAT2",59,0)
 .D FORMAT(CNAME,PINF,PC,TIEN,TNAME,PRAC,PNAME,POSN,TPI,PRCP) ;formats data for display
"RTN","SCRPPAT2",60,0)
 Q
"RTN","SCRPPAT2",61,0)
 ;
"RTN","SCRPPAT2",62,0)
CECHK(CLIEN,CNAME,PIEN) ;
"RTN","SCRPPAT2",63,0)
 ;CLIEN - clinic ien
"RTN","SCRPPAT2",64,0)
 ;CNAME - clinic name returned if patient is enrolled in clien clinic
"RTN","SCRPPAT2",65,0)
 ;PIEN - patien ien
"RTN","SCRPPAT2",66,0)
 ;
"RTN","SCRPPAT2",67,0)
 N EN,NODE
"RTN","SCRPPAT2",68,0)
 S CNAME=""
"RTN","SCRPPAT2",69,0)
 I $D(^DPT(PIEN,"DE","B",CLIEN)) D
"RTN","SCRPPAT2",70,0)
 .;enrolled at one time, check if discharged
"RTN","SCRPPAT2",71,0)
 .S EN=$O(^DPT(PIEN,"DE","B",CLIEN,""))
"RTN","SCRPPAT2",72,0)
 .S NODE=$G(^DPT(PIEN,"DE",EN,0))
"RTN","SCRPPAT2",73,0)
 .Q:NODE=""
"RTN","SCRPPAT2",74,0)
 .I $P(NODE,"^",3)="" S CNAME=$P($G(^SC(CLIEN,0)),"^") ;clinic name
"RTN","SCRPPAT2",75,0)
 .I $P(NODE,"^",3)'="",$P(NODE,"^",3)>DT S CNAME=$P($G(^SC(CLIEN,0)),"^") ;clinic name
"RTN","SCRPPAT2",76,0)
 Q
"RTN","SCRPPAT2",77,0)
 ;
"RTN","SCRPPAT2",78,0)
FORMAT(CNAME,PINF,PC,TIEN,TNAME,PRAC,PNAME,POSN,TPI,PRCP) ; format data for display
"RTN","SCRPPAT2",79,0)
 ;CNAME - clinic name
"RTN","SCRPPAT2",80,0)
 ;PINF - patient/clinic data
"RTN","SCRPPAT2",81,0)
 ;PC - primary care 1/0
"RTN","SCRPPAT2",82,0)
 ;TIEN - team file ien (#404.51)
"RTN","SCRPPAT2",83,0)
 ;TNAME - team name
"RTN","SCRPPAT2",84,0)
 ;PRAC - practitioner ien (#200)
"RTN","SCRPPAT2",85,0)
 ;PNAME - practitioner name
"RTN","SCRPPAT2",86,0)
 ;POSN - position name
"RTN","SCRPPAT2",87,0)
 ;TPI - team position ien (#404.57)
"RTN","SCRPPAT2",88,0)
 ;PRCP - preceptor name
"RTN","SCRPPAT2",89,0)
 ;
"RTN","SCRPPAT2",90,0)
 N IIEN,INAME,ERR
"RTN","SCRPPAT2",91,0)
 S ERR=$$SETUP^SCRPPAT3(.IIEN,.INAME,TIEN,TNAME,PRAC,PNAME,POSN,TPI,PRCP)
"RTN","SCRPPAT2",92,0)
 I ERR Q
"RTN","SCRPPAT2",93,0)
 ;
"RTN","SCRPPAT2",94,0)
 I SORT=1 D STOR(IIEN,TIEN,PRAC,PINF,PNAME,TNAME,TPI) ;sort division,team,practitioner
"RTN","SCRPPAT2",95,0)
 I SORT=2 D STOR(IIEN,PRAC,TIEN,PINF,PNAME,TNAME,TPI) ;sort division,practitioner,team
"RTN","SCRPPAT2",96,0)
 Q
"RTN","SCRPPAT2",97,0)
 ;
"RTN","SCRPPAT2",98,0)
STOR(IIEN,SEC,TRD,PINF,PNAME,TNAME,TPI) ;
"RTN","SCRPPAT2",99,0)
 ;IIEN - ien institution
"RTN","SCRPPAT2",100,0)
 ;SEC - second sort subscript, IEN team or IEN practitioner
"RTN","SCRPPAT2",101,0)
 ;TRD - third sort subscript, IEN team or IEN practitioner
"RTN","SCRPPAT2",102,0)
 ;PINF - patient/clinic info
"RTN","SCRPPAT2",103,0)
 ;PNAME - practitioner name
"RTN","SCRPPAT2",104,0)
 ;TNAME - team name
"RTN","SCRPPAT2",105,0)
 ;TPI - team position ien
"RTN","SCRPPAT2",106,0)
 ;
"RTN","SCRPPAT2",107,0)
 N PIEN,PTNAME,PID
"RTN","SCRPPAT2",108,0)
 S PIEN=+$P(PINF,"^") ;patient ien 
"RTN","SCRPPAT2",109,0)
 S PTNAME=$E($P(PINF,"^",2),1,15) ;patient name
"RTN","SCRPPAT2",110,0)
 Q:$D(@STORE@("PT",IIEN,SEC,TRD,TPI,PTNAME,PIEN))
"RTN","SCRPPAT2",111,0)
 S @STORE@("PT",IIEN,SEC,TRD,TPI,PTNAME,PIEN)=""
"RTN","SCRPPAT2",112,0)
 ;
"RTN","SCRPPAT2",113,0)
 I 'SUMM,'$D(@STORE@("PTOT",IIEN,SEC,TRD,PIEN)) D
"RTN","SCRPPAT2",114,0)
 .;count each unique patient for any given practitioner for grand total
"RTN","SCRPPAT2",115,0)
 .S @STORE@("PTOT",IIEN,SEC,TRD,PIEN)=""
"RTN","SCRPPAT2",116,0)
 .S @STORE@("TOTAL",IIEN,PRAC,0)=$G(@STORE@("TOTAL",IIEN,PRAC,0))+1 ;patient count by practitioner
"RTN","SCRPPAT2",117,0)
 ;
"RTN","SCRPPAT2",118,0)
 S @STORE@("TOTAL",IIEN,PRAC,TIEN,TPI)=$G(@STORE@("TOTAL",IIEN,PRAC,TIEN,TPI))+1 ;patient count by practitioner and team
"RTN","SCRPPAT2",119,0)
 Q:SUMM
"RTN","SCRPPAT2",120,0)
 ;
"RTN","SCRPPAT2",121,0)
 S @STORE@(IIEN,SEC,TRD,TPI,PIEN)=PTNAME
"RTN","SCRPPAT2",122,0)
 S PID=$P(PINF,"^",3),PID=$TR(PID,"-","")
"RTN","SCRPPAT2",123,0)
 S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),18)=$E(PID,6,10) ;last 4 pid - 5 places is for any pseudo
"RTN","SCRPPAT2",124,0)
 S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),25)=$P(PINF,"^",4) ;means test status
"RTN","SCRPPAT2",125,0)
 S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),31)=$P(PINF,"^",5) ;eligibility
"RTN","SCRPPAT2",126,0)
 ;Removed by patch 174
"RTN","SCRPPAT2",127,0)
 ;S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),40)=$P(PINF,"^",6) ;patient status
"RTN","SCRPPAT2",128,0)
 S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),42)=$P(PINF,"^",8) ;last appt
"RTN","SCRPPAT2",129,0)
 S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),54)=$P(PINF,"^",9) ;nxt appt
"RTN","SCRPPAT2",130,0)
 S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),66)=$E(CNAME,1,15) ;clinic
"RTN","SCRPPAT2",131,0)
 Q
"RTN","SCRPSLT")
0^4^B25417054
"RTN","SCRPSLT",1,0)
SCRPSLT ;ALB/CMM - Summary Listing of Teams ; 29 Jun 99  04:11PM
"RTN","SCRPSLT",2,0)
 ;;5.3;Scheduling;**41,52,177,231**;AUG 13, 1993
"RTN","SCRPSLT",3,0)
 ;
"RTN","SCRPSLT",4,0)
 ;Summary Listing of Teams Report
"RTN","SCRPSLT",5,0)
 ;
"RTN","SCRPSLT",6,0)
PROMPTS ;
"RTN","SCRPSLT",7,0)
 ;Prompt for Institution, Team, Role and Print device
"RTN","SCRPSLT",8,0)
 ;
"RTN","SCRPSLT",9,0)
 N VAUTD,VAUTT,VAUTR,QTIME,PRNT,NUMBER
"RTN","SCRPSLT",10,0)
 K VAUTD,VAUTT,VAUTR,SCUP
"RTN","SCRPSLT",11,0)
 S QTIME=""
"RTN","SCRPSLT",12,0)
 W ! D INST^SCRPU1 I Y=-1 G ERR
"RTN","SCRPSLT",13,0)
 W ! K Y D PRMTT^SCRPU1 I '$D(VAUTT) G ERR
"RTN","SCRPSLT",14,0)
 W ! K Y D ROLE^SCRPU1 I '$D(VAUTR) G ERR
"RTN","SCRPSLT",15,0)
 W !!,"This report requires 132 column output!"
"RTN","SCRPSLT",16,0)
 D QUE(.VAUTD,.VAUTT,.VAUTR) Q
"RTN","SCRPSLT",17,0)
 ;
"RTN","SCRPSLT",18,0)
QUE(INST,TEAM,ROLE) ;queue report
"RTN","SCRPSLT",19,0)
 ;Input Parameters: 
"RTN","SCRPSLT",20,0)
 ;INST - institutions selected (variable and array) 
"RTN","SCRPSLT",21,0)
 ;TEAM - teams selected (variable and array) 
"RTN","SCRPSLT",22,0)
 ;ROLE - roles selected (variable and array)
"RTN","SCRPSLT",23,0)
 N ZTSAVE,II
"RTN","SCRPSLT",24,0)
 F II="INST","TEAM","ROLE","INST(","TEAM(","ROLE(" S ZTSAVE(II)=""
"RTN","SCRPSLT",25,0)
 W ! D EN^XUTMDEVQ("QENTRY^SCRPSLT","Summary Listing of Teams",.ZTSAVE)
"RTN","SCRPSLT",26,0)
 Q
"RTN","SCRPSLT",27,0)
 ;
"RTN","SCRPSLT",28,0)
ENTRY2(INST,TEAM,ROLE,IOP,ZTDTH) ;
"RTN","SCRPSLT",29,0)
 ;Second entry point for GUI to use
"RTN","SCRPSLT",30,0)
 ;Input Parameters:
"RTN","SCRPSLT",31,0)
 ;INST - institutions selected (variable and array)
"RTN","SCRPSLT",32,0)
 ;TEAM - teams selected (variable and array)
"RTN","SCRPSLT",33,0)
 ;ROLE - roles selected (variable and array)
"RTN","SCRPSLT",34,0)
 ;IOP - print device
"RTN","SCRPSLT",35,0)
 ;ZTDTH - queue time (optional)
"RTN","SCRPSLT",36,0)
 ;
"RTN","SCRPSLT",37,0)
 ;validate parameters
"RTN","SCRPSLT",38,0)
 I '$D(INST)!'$D(TEAM)!'$D(ROLE)!'$D(IOP)!(IOP="") Q
"RTN","SCRPSLT",39,0)
 ;
"RTN","SCRPSLT",40,0)
 N NUMBER
"RTN","SCRPSLT",41,0)
 S IOST=$P(IOP,"^",2),IOP=$P(IOP,"^")
"RTN","SCRPSLT",42,0)
 I IOP?1"Q;".E S IOP=$P(IOP,"Q;",2)
"RTN","SCRPSLT",43,0)
 I IOST?1"C-".E D QENTRY G RET
"RTN","SCRPSLT",44,0)
 I ZTDTH="" S ZTDTH=$H
"RTN","SCRPSLT",45,0)
 S ZTRTN="QENTRY^SCRPSLT"
"RTN","SCRPSLT",46,0)
 S ZTDESC="Summary Listing Of Teams",ZTIO=IOP
"RTN","SCRPSLT",47,0)
 N II
"RTN","SCRPSLT",48,0)
 F II="INST","TEAM","ROLE","INST(","TEAM(","ROLE(","IOP" S ZTSAVE(II)=""
"RTN","SCRPSLT",49,0)
 D ^%ZTLOAD
"RTN","SCRPSLT",50,0)
RET S NUMBER=0
"RTN","SCRPSLT",51,0)
 I $D(ZTSK) S NUMBER=ZTSK
"RTN","SCRPSLT",52,0)
 D EXIT1
"RTN","SCRPSLT",53,0)
 Q NUMBER
"RTN","SCRPSLT",54,0)
 ;
"RTN","SCRPSLT",55,0)
QENTRY ;
"RTN","SCRPSLT",56,0)
 ;driver entry point
"RTN","SCRPSLT",57,0)
 S TITL="Summary Listing of Teams"
"RTN","SCRPSLT",58,0)
 S STORE="^TMP("_$J_",""SCRPSLT"")"
"RTN","SCRPSLT",59,0)
 K @STORE
"RTN","SCRPSLT",60,0)
 S @STORE=0
"RTN","SCRPSLT",61,0)
 I TEAM=1 D TALL^SCRPPAT3 S TEAM=0
"RTN","SCRPSLT",62,0)
 D FIND
"RTN","SCRPSLT",63,0)
 I $O(@STORE@(0))="" S NODATA=$$NODATA^SCRPU3(TITL)
"RTN","SCRPSLT",64,0)
 I '$D(NODATA) D PRINTIT(STORE,TITL)
"RTN","SCRPSLT",65,0)
 D EXIT2
"RTN","SCRPSLT",66,0)
 Q
"RTN","SCRPSLT",67,0)
 ;
"RTN","SCRPSLT",68,0)
ERR ;
"RTN","SCRPSLT",69,0)
EXIT1 ;
"RTN","SCRPSLT",70,0)
 K ZTDTH,ZTRTN,ZTDESC,ZTSK,ZTIO,ZTSAVE,SCUP
"RTN","SCRPSLT",71,0)
 Q
"RTN","SCRPSLT",72,0)
 ;
"RTN","SCRPSLT",73,0)
EXIT2 ;
"RTN","SCRPSLT",74,0)
 K @STORE
"RTN","SCRPSLT",75,0)
 K STOP,STORE,TITL,IOP,TEAM,INST,ROLE,NODATA
"RTN","SCRPSLT",76,0)
 Q
"RTN","SCRPSLT",77,0)
 ;
"RTN","SCRPSLT",78,0)
FIND ;
"RTN","SCRPSLT",79,0)
 N TM,EN2,EN,ROL,NODE,TEND,ACT,INA,TPASS,TPCN,TMAX,TMP,TOA,TNPC
"RTN","SCRPSLT",80,0)
 S TM=""
"RTN","SCRPSLT",81,0)
 F  S TM=$O(^SCTM(404.57,"C",TM)) Q:TM=""  D
"RTN","SCRPSLT",82,0)
 .;$O through team position file
"RTN","SCRPSLT",83,0)
 .I '$D(TEAM(TM))&(TEAM'=1) Q
"RTN","SCRPSLT",84,0)
 .;Q above, not a selected team
"RTN","SCRPSLT",85,0)
 .;selected team
"RTN","SCRPSLT",86,0)
 .S EN=""
"RTN","SCRPSLT",87,0)
 .S TPASS(TM)=0,TMAX(TM)=0,TPCN(TM)=0
"RTN","SCRPSLT",88,0)
 .F  S EN=$O(^SCTM(404.57,"C",TM,EN)) Q:EN=""  D
"RTN","SCRPSLT",89,0)
 ..I '$D(^SCTM(404.57,EN,0)) Q
"RTN","SCRPSLT",90,0)
 ..S NODE=$G(^SCTM(404.57,EN,0))
"RTN","SCRPSLT",91,0)
 ..Q:NODE=""
"RTN","SCRPSLT",92,0)
 ..S ROL=+$P(NODE,"^",3) ;role ien
"RTN","SCRPSLT",93,0)
 ..I '$D(ROLE(ROL))&(ROLE'=1) Q
"RTN","SCRPSLT",94,0)
 ..;Q above not a selected role
"RTN","SCRPSLT",95,0)
 ..;find active position during date range
"RTN","SCRPSLT",96,0)
 ..S TMP=$$DATES^SCAPMCU1(404.52,EN,DT)
"RTN","SCRPSLT",97,0)
 ..I +TMP=0 Q
"RTN","SCRPSLT",98,0)
 ..S EN2=+$P(TMP,"^",4)
"RTN","SCRPSLT",99,0)
 ..D KEEP^SCRPSLT2(NODE,EN,EN2,ROL,TM,.TPCN,.TNPC)
"RTN","SCRPSLT",100,0)
 ..S TPASS(TM)=$$TEAMCNT^SCAPMCU1(TM,DT)
"RTN","SCRPSLT",101,0)
 ..S TMAX(TM)=+$P($G(^SCTM(404.51,+TM,0)),U,8)
"RTN","SCRPSLT",102,0)
 ..S TOA(TM)=TMAX(TM)-TPASS(TM) S:TOA(TM)<0 TOA(TM)=0
"RTN","SCRPSLT",103,0)
 ..D TEAMT^SCRPSLT2(TM,.TPASS,.TMAX,.TPCN,.TOA,.TNPC)
"RTN","SCRPSLT",104,0)
 Q
"RTN","SCRPSLT",105,0)
 ;
"RTN","SCRPSLT",106,0)
PRINTIT(STORE,TITL) ;
"RTN","SCRPSLT",107,0)
 N INST,EINST,ETEAM,TEM,EPRACT,PRACT,NXT,PAGE,NPAGE,NEW,POS
"RTN","SCRPSLT",108,0)
 S (INST,EINST)="",(NPAGE,STOP)=0,PAGE=1 W:$E(IOST)="C" @IOF
"RTN","SCRPSLT",109,0)
 D TITLE^SCRPU3(.PAGE,TITL)
"RTN","SCRPSLT",110,0)
 D FORHEAD^SCRPSLT2
"RTN","SCRPSLT",111,0)
 F  S EINST=$O(@STORE@("I",EINST)) Q:EINST=""!(STOP)  D
"RTN","SCRPSLT",112,0)
 .S INST=$O(@STORE@("I",EINST,""))
"RTN","SCRPSLT",113,0)
 .I INST="" Q
"RTN","SCRPSLT",114,0)
 .S (TEM,ETEAM)=""
"RTN","SCRPSLT",115,0)
 .F  S ETEAM=$O(@STORE@("T",INST,ETEAM)) Q:ETEAM=""!(STOP)  D
"RTN","SCRPSLT",116,0)
 ..S TEM=$O(@STORE@("T",INST,ETEAM,""))
"RTN","SCRPSLT",117,0)
 ..I TEM="" Q
"RTN","SCRPSLT",118,0)
 ..K NEW
"RTN","SCRPSLT",119,0)
 ..I NPAGE,(IOST'?1"C-".E) D NEWP^SCRPSLT2(INST,TEM,TITL,.PAGE) S NEW=""
"RTN","SCRPSLT",120,0)
 ..I NPAGE,(IOST?1"C-".E) D HOLD1^SCRPSLT2(.PAGE,TITL,INST,TEM) S NEW=""
"RTN","SCRPSLT",121,0)
 ..S NPAGE=1 I STOP Q
"RTN","SCRPSLT",122,0)
 ..I IOST'?1"C-".E,$Y>(IOSL-8) D NEWP^SCRPSLT2(INST,TEM,TITL,.PAGE) S NEW=""
"RTN","SCRPSLT",123,0)
 ..I IOST?1"C-".E,$Y>(IOSL-8) D HOLD1^SCRPSLT2(.PAGE,TITL,INST,TEM) S NEW=""
"RTN","SCRPSLT",124,0)
 ..I STOP Q
"RTN","SCRPSLT",125,0)
 ..I '$D(NEW) D HEADER^SCRPSLT2(INST,TEM)
"RTN","SCRPSLT",126,0)
 ..S (PRACT,EPRACT)=""
"RTN","SCRPSLT",127,0)
 ..F  S EPRACT=$O(@STORE@("PN",INST,TEM,EPRACT)) Q:EPRACT=""!(STOP)  D
"RTN","SCRPSLT",128,0)
 ...S PRACT=$O(@STORE@("PN",INST,TEM,EPRACT,""))
"RTN","SCRPSLT",129,0)
 ...I PRACT="" Q
"RTN","SCRPSLT",130,0)
 ...S POS=""
"RTN","SCRPSLT",131,0)
 ...F  S POS=$O(@STORE@(INST,TEM,PRACT,POS)) Q:POS=""!(STOP)  D
"RTN","SCRPSLT",132,0)
 ....I IOST'?1"C-".E,$Y>(IOSL-4) D NEWP^SCRPSLT2(INST,TEM,TITL,.PAGE)
"RTN","SCRPSLT",133,0)
 ....I IOST?1"C-".E,$Y>(IOSL-4) D HOLD1^SCRPSLT2(.PAGE,TITL,INST,TEM)
"RTN","SCRPSLT",134,0)
 ....I STOP Q
"RTN","SCRPSLT",135,0)
 ....W !,$G(@STORE@(INST,TEM,PRACT,POS)) ;writes info
"RTN","SCRPSLT",136,0)
 ..Q:STOP
"RTN","SCRPSLT",137,0)
 ..I IOST'?1"C-".E,$Y>(IOSL-8) D NEWP^SCRPSLT2(INST,TEM,TITL,.PAGE,1)
"RTN","SCRPSLT",138,0)
 ..I IOST?1"C-".E,$Y>(IOSL-8) D HOLD1^SCRPSLT2(.PAGE,TITL,INST,TEM,1)
"RTN","SCRPSLT",139,0)
 ..D TOTAL^SCRPSLT2(INST,TEM)
"RTN","SCRPSLT",140,0)
 .I STOP Q
"RTN","SCRPSLT",141,0)
 .S NPAGE=1
"RTN","SCRPSLT",142,0)
 I 'STOP,$E(IOST)="C" N DIR S DIR(0)="E" D ^DIR
"RTN","SCRPSLT",143,0)
 Q
"RTN","SCRPSLT2")
0^5^B31388193
"RTN","SCRPSLT2",1,0)
SCRPSLT2 ;ALB/CMM - Summary Listing of Teams Continued ; 9/15/99 10:43am
"RTN","SCRPSLT2",2,0)
 ;;5.3;Scheduling;**41,174,177,231**;AUG 13, 1993
"RTN","SCRPSLT2",3,0)
 ;
"RTN","SCRPSLT2",4,0)
 ;Summary Listing of Teams Report
"RTN","SCRPSLT2",5,0)
 ;
"RTN","SCRPSLT2",6,0)
KEEP(TNODE,APOS,TPOS,ROL,TM,TPCN,TNPC) ;
"RTN","SCRPSLT2",7,0)
 ;TNODE - zero node of the team position file
"RTN","SCRPSLT2",8,0)
 ;APOS - ien of team position file
"RTN","SCRPSLT2",9,0)
 ;TPOS - ien of position assignment history file
"RTN","SCRPSLT2",10,0)
 ;ROL - ien of role
"RTN","SCRPSLT2",11,0)
 ;TM - ien of team
"RTN","SCRPSLT2",12,0)
 ;
"RTN","SCRPSLT2",13,0)
 N POS,TNAME,TPHONE,TPC,TDIV,TEN,TMN,DIV,PPC,PCLIN,VAE,PRACT,NPC,MAX
"RTN","SCRPSLT2",14,0)
 N PCN,ROLN,PRCTP,PRCPC,PRCNPC,PRCPTE,SCPC,SCNPC,XDAT,SCDT,SCI
"RTN","SCRPSLT2",15,0)
 ;
"RTN","SCRPSLT2",16,0)
 S TEN=+$P(TNODE,"^",2) ;team file pointer
"RTN","SCRPSLT2",17,0)
 S TMN=$G(^SCTM(404.51,TEN,0))
"RTN","SCRPSLT2",18,0)
 S TNAME=$P(TMN,"^") ;team name
"RTN","SCRPSLT2",19,0)
 S DIV=+$P(TMN,"^",7) ;division ien
"RTN","SCRPSLT2",20,0)
 S TDIV=$P($G(^DIC(4,DIV,0)),"^") ;team division
"RTN","SCRPSLT2",21,0)
 D KTEAM(TNAME,TDIV,TM,DIV)
"RTN","SCRPSLT2",22,0)
 ;
"RTN","SCRPSLT2",23,0)
 S POS=$P(TNODE,"^") ;position name
"RTN","SCRPSLT2",24,0)
 ;SD*5.3*231 - call SCMCLK to determine in AP or not
"RTN","SCRPSLT2",25,0)
 S PPC=$S($P(TNODE,"^",4)<1:"NPC",+$$OKPREC3^SCMCLK(APOS,DT)>1:" AP",1:"PCP") ;PC?
"RTN","SCRPSLT2",26,0)
 S PCLIN=$P($G(^SC(+$P(TNODE,"^",9),0)),"^") ;associated clinic
"RTN","SCRPSLT2",27,0)
 S ROLN=$P($G(^SD(403.46,+ROL,0)),U) ;role name
"RTN","SCRPSLT2",28,0)
 ;
"RTN","SCRPSLT2",29,0)
 S (PRCPC,PRCNPC)="",SCI="^TMP(""SCRATCH"",$J)"
"RTN","SCRPSLT2",30,0)
 K @SCI
"RTN","SCRPSLT2",31,0)
 S (SCDT("BEGIN"),SCDT("END"))=DT,SCDT("INCL")=0,SCDT="SCDT"
"RTN","SCRPSLT2",32,0)
 S SCI=$$PRECHIS^SCMCLK(APOS,.SCDT,SCI)
"RTN","SCRPSLT2",33,0)
 I SCI=1 S SCI=0 F  S SCI=$O(^TMP("SCRATCH",$J,SCI)) Q:'SCI  D
"RTN","SCRPSLT2",34,0)
 .N SCPRCD
"RTN","SCRPSLT2",35,0)
 .S SCPRCD=^TMP("SCRATCH",$J,SCI),PRCPTE=$P(SCPRCD,U,3) Q:'PRCPTE
"RTN","SCRPSLT2",36,0)
 .S SCPC=$$PCPOSCNT^SCAPMCU1(PRCPTE,DT,1) ;precepted PC patients
"RTN","SCRPSLT2",37,0)
 .S:SCPC<0 SCPC=0 S PRCPC=PRCPC+SCPC
"RTN","SCRPSLT2",38,0)
 .S SCNPC=$$PCPOSCNT^SCAPMCU1(PRCPTE,DT,0) ;all precepted patients
"RTN","SCRPSLT2",39,0)
 .S:SCNPC<0 SCNPC=0 S SCNPC=SCNPC-SCPC S:SCNPC<0 SCNPC=0
"RTN","SCRPSLT2",40,0)
 .S PRCNPC=PRCNPC+SCNPC
"RTN","SCRPSLT2",41,0)
 .Q
"RTN","SCRPSLT2",42,0)
 ;
"RTN","SCRPSLT2",43,0)
 S XDAT=ROLN_U_PRCPC_U_PRCNPC ;extra data
"RTN","SCRPSLT2",44,0)
 ;
"RTN","SCRPSLT2",45,0)
 S VAE=+$P($G(^SCTM(404.52,TPOS,0)),"^",3) ;ien of new person file
"RTN","SCRPSLT2",46,0)
 S PRACT=$P($G(^VA(200,VAE,0)),"^") ;practitioner name
"RTN","SCRPSLT2",47,0)
 I PRACT="" S PRACT="[Not Assigned]"
"RTN","SCRPSLT2",48,0)
 ;
"RTN","SCRPSLT2",49,0)
 S MAX=+$P(TNODE,"^",8) I MAX<0 S MAX=0
"RTN","SCRPSLT2",50,0)
 S PCN=$$PCPOSCNT^SCAPMCU1(APOS,DT) S:PCN=-1 PCN=0
"RTN","SCRPSLT2",51,0)
 S TPCN(TM)=$G(TPCN(TM))+PCN
"RTN","SCRPSLT2",52,0)
 S NPC=$$PCPOSCNT^SCAPMCU1(APOS,DT,0) S:NPC=-1 NPC=0
"RTN","SCRPSLT2",53,0)
 S NPC=NPC-PCN S:NPC<0 NPC=0
"RTN","SCRPSLT2",54,0)
 S TNPC(TM)=$G(TNPC(TM))+NPC
"RTN","SCRPSLT2",55,0)
 ;
"RTN","SCRPSLT2",56,0)
 D FORMAT(APOS,POS,PCLIN,VAE,PRACT,PPC,DIV,TM,NPC,MAX,PCN,XDAT)
"RTN","SCRPSLT2",57,0)
 Q
"RTN","SCRPSLT2",58,0)
 ;
"RTN","SCRPSLT2",59,0)
TEAMT(TM,TPASS,TMAX,TPCN,TOA,TNPC) ;
"RTN","SCRPSLT2",60,0)
 ;set team totals into global
"RTN","SCRPSLT2",61,0)
 S @STORE@("TOTALS",TM,"H1")="               Team Totals:"
"RTN","SCRPSLT2",62,0)
 S @STORE@("TOTALS",TM,"H2")="------------------------------------"
"RTN","SCRPSLT2",63,0)
 S @STORE@("TOTALS",TM,"H3")="  Primary Care Assignments: "_$J($G(TPCN(TM)),6,0)
"RTN","SCRPSLT2",64,0)
 S @STORE@("TOTALS",TM,"H4")="        Non-PC Assignments: "_$J($G(TNPC(TM)),6,0)
"RTN","SCRPSLT2",65,0)
 S @STORE@("TOTALS",TM,"H5")="  Unique Patients Assigned: "_$J($G(TPASS(TM)),6,0)
"RTN","SCRPSLT2",66,0)
 S @STORE@("TOTALS",TM,"H6")="  Maximum Patients Allowed: "_$J($G(TMAX(TM)),6,0)
"RTN","SCRPSLT2",67,0)
 S @STORE@("TOTALS",TM,"H7")="    Total Open Assignments: "_$J($G(TOA(TM)),6,0)
"RTN","SCRPSLT2",68,0)
 Q
"RTN","SCRPSLT2",69,0)
 ;
"RTN","SCRPSLT2",70,0)
FORMAT(APOS,POS,PCLIN,VAE,PRACT,PPC,DIV,TM,NPC,MX,PC,XDAT) ;
"RTN","SCRPSLT2",71,0)
 ;
"RTN","SCRPSLT2",72,0)
 NEW TMP
"RTN","SCRPSLT2",73,0)
 I PRACT="" S PRACT="Bad Data"
"RTN","SCRPSLT2",74,0)
 S @STORE@("PN",DIV,TM,PRACT,VAE)=""
"RTN","SCRPSLT2",75,0)
 S @STORE@(DIV,TM,VAE,APOS)=$E(PRACT,1,20) ;practitioner name
"RTN","SCRPSLT2",76,0)
 S $E(@STORE@(DIV,TM,VAE,APOS),23)=$E(POS,1,20) ;position
"RTN","SCRPSLT2",77,0)
 S $E(@STORE@(DIV,TM,VAE,APOS),45)=PPC ;PC?
"RTN","SCRPSLT2",78,0)
 S $E(@STORE@(DIV,TM,VAE,APOS),50)=$E($P(XDAT,U),1,20) ;role
"RTN","SCRPSLT2",79,0)
 S $E(@STORE@(DIV,TM,VAE,APOS),72)=$E(PCLIN,1,25) ;assoc. clinic
"RTN","SCRPSLT2",80,0)
 S $E(@STORE@(DIV,TM,VAE,APOS),99)=$J(MX,6,0) ;max pts.
"RTN","SCRPSLT2",81,0)
 S $E(@STORE@(DIV,TM,VAE,APOS),107)=$J(PC,5,0) ;PC pts.
"RTN","SCRPSLT2",82,0)
 S $E(@STORE@(DIV,TM,VAE,APOS),114)=$J(NPC,5,0) ;non-PC pts.
"RTN","SCRPSLT2",83,0)
 ;
"RTN","SCRPSLT2",84,0)
 ;bp/djb 'Precepted Patients' column should be zero for APs.
"RTN","SCRPSLT2",85,0)
 ;Old code begins
"RTN","SCRPSLT2",86,0)
 ;S $E(@STORE@(DIV,TM,VAE,APOS),121)=$J($P(XDAT,U,2),5,0) ;precept PC
"RTN","SCRPSLT2",87,0)
 ;S $E(@STORE@(DIV,TM,VAE,APOS),128)=$J($P(XDAT,U,3),5,0) ;precept NPC
"RTN","SCRPSLT2",88,0)
 ;Old code ends
"RTN","SCRPSLT2",89,0)
 ;New code begins
"RTN","SCRPSLT2",90,0)
 S (TMP(1),TMP(2))=0 I PPC'["AP" D  ;APs should be zero
"RTN","SCRPSLT2",91,0)
 .S TMP(1)=$P(XDAT,U,2)
"RTN","SCRPSLT2",92,0)
 .S TMP(2)=$P(XDAT,U,3)
"RTN","SCRPSLT2",93,0)
 S $E(@STORE@(DIV,TM,VAE,APOS),121)=$J(TMP(1),5,0) ;precepted PC
"RTN","SCRPSLT2",94,0)
 S $E(@STORE@(DIV,TM,VAE,APOS),128)=$J(TMP(2),5,0) ;precepted NPC
"RTN","SCRPSLT2",95,0)
 ;New code ends
"RTN","SCRPSLT2",96,0)
 Q
"RTN","SCRPSLT2",97,0)
 ;
"RTN","SCRPSLT2",98,0)
TOTAL(INST,TEM) ;
"RTN","SCRPSLT2",99,0)
 ;Prints team totals
"RTN","SCRPSLT2",100,0)
 N NXT
"RTN","SCRPSLT2",101,0)
 S NXT=""
"RTN","SCRPSLT2",102,0)
 W !
"RTN","SCRPSLT2",103,0)
 F  S NXT=$O(@STORE@("TOTALS",TEM,NXT)) Q:NXT=""  D
"RTN","SCRPSLT2",104,0)
 .;bp/djb Stop displaying certain 'Team Totals:' lines.
"RTN","SCRPSLT2",105,0)
 .;New code begin
"RTN","SCRPSLT2",106,0)
 .Q:$G(@STORE@("TOTALS",TEM,NXT))["Unique Patients Assigned"
"RTN","SCRPSLT2",107,0)
 .Q:$G(@STORE@("TOTALS",TEM,NXT))["Maximum Patients Allowed"
"RTN","SCRPSLT2",108,0)
 .Q:$G(@STORE@("TOTALS",TEM,NXT))["Total Open Assignments"
"RTN","SCRPSLT2",109,0)
 .;New code end
"RTN","SCRPSLT2",110,0)
 .W !,$G(@STORE@("TOTALS",TEM,NXT))
"RTN","SCRPSLT2",111,0)
 W !
"RTN","SCRPSLT2",112,0)
 Q
"RTN","SCRPSLT2",113,0)
 ;
"RTN","SCRPSLT2",114,0)
KTEAM(TNAME,TDIV,TIEN,IEND) ;
"RTN","SCRPSLT2",115,0)
 ;store team information
"RTN","SCRPSLT2",116,0)
 I TNAME="" S TNAME="[BAD DATA]"
"RTN","SCRPSLT2",117,0)
 I TDIV="" S TDIV="[BAD DATA]"
"RTN","SCRPSLT2",118,0)
 S @STORE@("I",TDIV,IEND)=""
"RTN","SCRPSLT2",119,0)
 S @STORE@("T",IEND,TNAME,TIEN)=""
"RTN","SCRPSLT2",120,0)
 S @STORE@(IEND)=" Division: "_TDIV
"RTN","SCRPSLT2",121,0)
 S @STORE@(IEND,TIEN)="Team Name: "_TNAME
"RTN","SCRPSLT2",122,0)
 Q
"RTN","SCRPSLT2",123,0)
 ;
"RTN","SCRPSLT2",124,0)
FORHEAD ;
"RTN","SCRPSLT2",125,0)
 S @STORE@("H3")="Practitioner"
"RTN","SCRPSLT2",126,0)
 S $E(@STORE@("H3"),23)="Position"
"RTN","SCRPSLT2",127,0)
 S $E(@STORE@("H3"),45)="PC?"
"RTN","SCRPSLT2",128,0)
 S $E(@STORE@("H3"),50)="Standard Role"
"RTN","SCRPSLT2",129,0)
 S $E(@STORE@("H3"),72)="Associated Clinic"
"RTN","SCRPSLT2",130,0)
 S $E(@STORE@("H1"),101)="Max."
"RTN","SCRPSLT2",131,0)
 S $E(@STORE@("H2"),101)="Pts."
"RTN","SCRPSLT2",132,0)
 S $E(@STORE@("H3"),99)="Allow."
"RTN","SCRPSLT2",133,0)
 S $E(@STORE@("H1"),107)="--Assigned--"
"RTN","SCRPSLT2",134,0)
 S $E(@STORE@("H2"),107)="--Patients--"
"RTN","SCRPSLT2",135,0)
 S $E(@STORE@("H3"),107)="PC     NonPC"
"RTN","SCRPSLT2",136,0)
 S $E(@STORE@("H1"),121)="--Precepted-"
"RTN","SCRPSLT2",137,0)
 S $E(@STORE@("H2"),121)="--Patients--"
"RTN","SCRPSLT2",138,0)
 S $E(@STORE@("H3"),121)="PC     NonPC"
"RTN","SCRPSLT2",139,0)
 S $P(@STORE@("H4"),"=",133)=""
"RTN","SCRPSLT2",140,0)
 Q
"RTN","SCRPSLT2",141,0)
HEADER(INST,TEM,TEND) ;
"RTN","SCRPSLT2",142,0)
 N NXT
"RTN","SCRPSLT2",143,0)
 S NXT="H",TEND=$G(TEND)
"RTN","SCRPSLT2",144,0)
 W !!,@STORE@(INST)
"RTN","SCRPSLT2",145,0)
 W !!,@STORE@(INST,TEM)
"RTN","SCRPSLT2",146,0)
 I 'TEND F  S NXT=$O(@STORE@(NXT)) Q:NXT'?1"H".E  D
"RTN","SCRPSLT2",147,0)
 .W !,@STORE@(NXT)
"RTN","SCRPSLT2",148,0)
 W !
"RTN","SCRPSLT2",149,0)
 Q
"RTN","SCRPSLT2",150,0)
NEWP(INST,TEM,TITL,PAGE,TEND) ;
"RTN","SCRPSLT2",151,0)
 S TEND=$G(TEND)
"RTN","SCRPSLT2",152,0)
 D NEWP1^SCRPU3(.PAGE,TITL)
"RTN","SCRPSLT2",153,0)
 I STOP Q
"RTN","SCRPSLT2",154,0)
 D HEADER(INST,TEM,TEND)
"RTN","SCRPSLT2",155,0)
 Q
"RTN","SCRPSLT2",156,0)
HOLD1(PAGE,TITL,INST,TEM,TEND) ;
"RTN","SCRPSLT2",157,0)
 ;device is home, reached end of page
"RTN","SCRPSLT2",158,0)
 S TEND=$G(TEND)
"RTN","SCRPSLT2",159,0)
 D HOLD^SCRPU3(.PAGE,TITL)
"RTN","SCRPSLT2",160,0)
 I STOP Q
"RTN","SCRPSLT2",161,0)
 D HEADER(INST,TEM,TEND)
"RTN","SCRPSLT2",162,0)
 Q
"RTN","SCRPTP2")
0^6^B31636333
"RTN","SCRPTP2",1,0)
SCRPTP2 ;ALB/CMM - List of Team's Patients ; 29 Jun 99  04:11PM
"RTN","SCRPTP2",2,0)
 ;;5.3;Scheduling;**41,53,52,174,177,231**;AUG 13, 1993
"RTN","SCRPTP2",3,0)
 ;
"RTN","SCRPTP2",4,0)
 ;List of Team's Patients Report
"RTN","SCRPTP2",5,0)
 ;
"RTN","SCRPTP2",6,0)
TFORMAT(INST,INAME,TIEN,TNAME,PHONE,PC) ; Format team information
"RTN","SCRPTP2",7,0)
 ;INST - institution ien
"RTN","SCRPTP2",8,0)
 ;INAME - institution name
"RTN","SCRPTP2",9,0)
 ;TIEN - team ien
"RTN","SCRPTP2",10,0)
 ;TNAME - team name
"RTN","SCRPTP2",11,0)
 ;PHONE - team phone
"RTN","SCRPTP2",12,0)
 ;PC - primary care team (yes/no)
"RTN","SCRPTP2",13,0)
 ;
"RTN","SCRPTP2",14,0)
 I INAME="" S INAME="[BAD DATA]"
"RTN","SCRPTP2",15,0)
 I TNAME="" S TNAME="[BAD DATA]"
"RTN","SCRPTP2",16,0)
 S @STORE@("I",INAME,INST)=""
"RTN","SCRPTP2",17,0)
 S @STORE@("T",INST,TNAME,TIEN)=""
"RTN","SCRPTP2",18,0)
 S @STORE@(INST)="Division: "_INAME
"RTN","SCRPTP2",19,0)
 S @STORE@(INST,TIEN)="Team: "_TNAME
"RTN","SCRPTP2",20,0)
 S $E(@STORE@(INST,TIEN),45)="Team Phone: "_PHONE
"RTN","SCRPTP2",21,0)
 S @STORE@(INST,TIEN,1)="Primary Care Team: "_PC
"RTN","SCRPTP2",22,0)
 Q
"RTN","SCRPTP2",23,0)
 ;
"RTN","SCRPTP2",24,0)
PRINTIT(STORE,TITL) ;
"RTN","SCRPTP2",25,0)
 N INST,INAME,TNAME,TIEN
"RTN","SCRPTP2",26,0)
 S (NEW,PAGE)=1,STOP=0 W:$E(IOST)="C" @IOF
"RTN","SCRPTP2",27,0)
 D TITLE^SCRPU3(.PAGE,TITL,132) ;write title
"RTN","SCRPTP2",28,0)
 D SETH
"RTN","SCRPTP2",29,0)
 ;
"RTN","SCRPTP2",30,0)
 S INAME=""
"RTN","SCRPTP2",31,0)
 F  S INAME=$O(@STORE@("I",INAME)) Q:INAME=""!(STOP)  D
"RTN","SCRPTP2",32,0)
 .S INST=$O(@STORE@("I",INAME,""))
"RTN","SCRPTP2",33,0)
 .Q:INST=""
"RTN","SCRPTP2",34,0)
 .I ('NEW)&(IOST'?1"C-".E) D NEWP1^SCRPU3(.PAGE,TITL,132)
"RTN","SCRPTP2",35,0)
 .I ('NEW)&(IOST?1"C-".E) D HOLD^SCRPU3(.PAGE,TITL,132)
"RTN","SCRPTP2",36,0)
 .Q:STOP
"RTN","SCRPTP2",37,0)
 .W !,$G(@STORE@(INST)) ;write institution
"RTN","SCRPTP2",38,0)
 .S TNAME=""
"RTN","SCRPTP2",39,0)
 .F  S TNAME=$O(@STORE@("T",INST,TNAME)) Q:TNAME=""!(STOP)  D
"RTN","SCRPTP2",40,0)
 ..S TIEN=$O(@STORE@("T",INST,TNAME,""))
"RTN","SCRPTP2",41,0)
 ..Q:TIEN=""
"RTN","SCRPTP2",42,0)
 ..D TPRINT(INST,TIEN) ;writes team info
"RTN","SCRPTP2",43,0)
 ..Q:STOP
"RTN","SCRPTP2",44,0)
 ..;
"RTN","SCRPTP2",45,0)
 ..I (IOST'?1"C-".E)&($Y>(IOSL-4)) D NEWP1^SCRPU3(.PAGE,TITL,132)
"RTN","SCRPTP2",46,0)
 ..I (IOST?1"C-".E)&($Y>(IOSL-4)) D HOLD^SCRPU3(.PAGE,TITL,132)
"RTN","SCRPTP2",47,0)
 ..Q:STOP
"RTN","SCRPTP2",48,0)
 ..D HEADER
"RTN","SCRPTP2",49,0)
 ..I (SORT=3)!(SORT=4) D PRACT(INST,TIEN,.NEW)
"RTN","SCRPTP2",50,0)
 ..I (SORT=1)!(SORT=2) D PTP(INST,TIEN,.NEW)
"RTN","SCRPTP2",51,0)
 K NEW,PAGE
"RTN","SCRPTP2",52,0)
 I 'STOP,$E(IOST)="C" N DIR S DIR(0)="E" W ! D ^DIR
"RTN","SCRPTP2",53,0)
 Q
"RTN","SCRPTP2",54,0)
 ;
"RTN","SCRPTP2",55,0)
PRACT(INST,TIEN,NEW) ;Print by practitioner/patient
"RTN","SCRPTP2",56,0)
 N PNAME,PIEN,SEC2,ST1,TRD,TRDI
"RTN","SCRPTP2",57,0)
 S PNAME="",PIEN=""
"RTN","SCRPTP2",58,0)
 F  S PNAME=$O(@STORE@("P",INST,TIEN,PNAME)) Q:PNAME=""!(STOP)  D
"RTN","SCRPTP2",59,0)
 . F  S PIEN=$O(@STORE@("P",INST,TIEN,PNAME,PIEN)) Q:PIEN=""!(STOP)  D
"RTN","SCRPTP2",60,0)
 . . I (SORT=1)!(SORT=3) S SEC2="""PT""" ;sort by patient name
"RTN","SCRPTP2",61,0)
 . . I (SORT=2)!(SORT=4) S SEC2="""PID""" ;sort by last 4 PID
"RTN","SCRPTP2",62,0)
 . . S ST1=$E(STORE,1,$L(STORE)-1)_","_SEC2_")"
"RTN","SCRPTP2",63,0)
 . . I (IOST'?1"C-".E)&($Y>(IOSL-4)) D NEWP1^SCRPU3(.PAGE,TITL,132) D:'STOP HEADER
"RTN","SCRPTP2",64,0)
 . . Q:STOP
"RTN","SCRPTP2",65,0)
 . . I (IOST?1"C-".E)&($Y>(IOSL-4)) D HOLD^SCRPU3(.PAGE,TITL,132) D:'STOP HEADER
"RTN","SCRPTP2",66,0)
 . . Q:STOP
"RTN","SCRPTP2",67,0)
 . . S (TRDI,TRD)=""
"RTN","SCRPTP2",68,0)
 . . F  S TRD=$O(@ST1@(INST,TIEN,TRD)) Q:TRD=""!(STOP)  D
"RTN","SCRPTP2",69,0)
 . . . F  S TRDI=$O(@ST1@(INST,TIEN,TRD,TRDI)) Q:TRDI=""!(STOP)  D
"RTN","SCRPTP2",70,0)
 . . . . I (IOST'?1"C-".E)&($Y>(IOSL-4)) D NEWP1^SCRPU3(.PAGE,TITL,132) D:'STOP HEADER
"RTN","SCRPTP2",71,0)
 . . . . Q:STOP
"RTN","SCRPTP2",72,0)
 . . . . I (IOST?1"C-".E)&($Y>(IOSL-4)) D HOLD^SCRPU3(.PAGE,TITL,132) D:'STOP HEADER
"RTN","SCRPTP2",73,0)
 . . . . Q:STOP
"RTN","SCRPTP2",74,0)
 . . . . I $D(@STORE@(INST,TIEN,PIEN,TRDI)) W !,$G(@STORE@(INST,TIEN,PIEN,TRDI)) ;write column data
"RTN","SCRPTP2",75,0)
 . S NEW=0
"RTN","SCRPTP2",76,0)
 Q
"RTN","SCRPTP2",77,0)
 ;
"RTN","SCRPTP2",78,0)
PTP(INST,TIEN,NEW) ;Print by patient/practitioner
"RTN","SCRPTP2",79,0)
 N SEC2,ST1,TRDI,TRD,PNAME,PIEN
"RTN","SCRPTP2",80,0)
 I (SORT=1)!(SORT=3) S SEC2="""PT""" ;sort by patient name
"RTN","SCRPTP2",81,0)
 I (SORT=2)!(SORT=4) S SEC2="""PID""" ;sort by last 4 PID
"RTN","SCRPTP2",82,0)
 S ST1=$E(STORE,1,$L(STORE)-1)_","_SEC2_")"
"RTN","SCRPTP2",83,0)
 I (IOST'?1"C-".E)&($Y>(IOSL-4)) D NEWP1^SCRPU3(.PAGE,TITL,132)
"RTN","SCRPTP2",84,0)
 I (IOST?1"C-".E)&($Y>(IOSL-4)) D HOLD^SCRPU3(.PAGE,TITL,132)
"RTN","SCRPTP2",85,0)
 Q:STOP
"RTN","SCRPTP2",86,0)
 S (TRDI,TRD)=""
"RTN","SCRPTP2",87,0)
 F  S TRD=$O(@ST1@(INST,TIEN,TRD)) Q:TRD=""!(STOP)  D
"RTN","SCRPTP2",88,0)
 . F  S TRDI=$O(@ST1@(INST,TIEN,TRD,TRDI)) Q:TRDI=""!(STOP)  D
"RTN","SCRPTP2",89,0)
 . . I (IOST'?1"C-".E)&($Y>(IOSL-4)) D NEWP1^SCRPU3(.PAGE,TITL,132) D:'STOP HEADER
"RTN","SCRPTP2",90,0)
 . . Q:STOP
"RTN","SCRPTP2",91,0)
 . . I (IOST?1"C-".E)&($Y>(IOSL-4)) D HOLD^SCRPU3(.PAGE,TITL,132) D:'STOP HEADER
"RTN","SCRPTP2",92,0)
 . . Q:STOP
"RTN","SCRPTP2",93,0)
 . . S PNAME="",PIEN=""
"RTN","SCRPTP2",94,0)
 . . F  S PNAME=$O(@STORE@("P",INST,TIEN,PNAME)) Q:PNAME=""!(STOP)!(PIEN=0)  D
"RTN","SCRPTP2",95,0)
 . . . F  S PIEN=$O(@STORE@("P",INST,TIEN,PNAME,PIEN)) Q:PIEN=""!(STOP)  D
"RTN","SCRPTP2",96,0)
 . . . . I (IOST'?1"C-".E)&($Y>(IOSL-4)) D NEWP1^SCRPU3(.PAGE,TITL,132) D:'STOP HEADER
"RTN","SCRPTP2",97,0)
 . . . . Q:STOP
"RTN","SCRPTP2",98,0)
 . . . . I (IOST?1"C-".E)&($Y>(IOSL-4)) D HOLD^SCRPU3(.PAGE,TITL,132) D:'STOP HEADER
"RTN","SCRPTP2",99,0)
 . . . . Q:STOP
"RTN","SCRPTP2",100,0)
 . . . . I $D(@STORE@(INST,TIEN,TRDI,PIEN)) W !,$G(@STORE@(INST,TIEN,TRDI,PIEN)) ;write column data
"RTN","SCRPTP2",101,0)
 . S NEW=0
"RTN","SCRPTP2",102,0)
 Q
"RTN","SCRPTP2",103,0)
 ;
"RTN","SCRPTP2",104,0)
TPRINT(INST,TIEN) ;
"RTN","SCRPTP2",105,0)
 ;prints team data
"RTN","SCRPTP2",106,0)
 N NXT
"RTN","SCRPTP2",107,0)
 I (IOST'?1"C-".E)&($Y>(IOSL-13)) D NEWP1^SCRPU3(.PAGE,TITL,132) W:'STOP !,$G(@STORE@(INST))
"RTN","SCRPTP2",108,0)
 I (IOST?1"C-".E)&($Y>(IOSL-13)) D HOLD^SCRPU3(.PAGE,TITL,132) W:'STOP !,$G(@STORE@(INST))
"RTN","SCRPTP2",109,0)
 Q:STOP
"RTN","SCRPTP2",110,0)
 W !!,$G(@STORE@(INST,TIEN))
"RTN","SCRPTP2",111,0)
 S NXT=0
"RTN","SCRPTP2",112,0)
 W !,$G(@STORE@(INST,TIEN,1)) ;write team info
"RTN","SCRPTP2",113,0)
 Q:'$D(@STORE@(INST,TIEN,"D"))  W !
"RTN","SCRPTP2",114,0)
 S NXT=""
"RTN","SCRPTP2",115,0)
 ;write team description
"RTN","SCRPTP2",116,0)
 F  S NXT=$O(@STORE@(INST,TIEN,"D",NXT)) Q:NXT=""!(STOP)  D
"RTN","SCRPTP2",117,0)
 .I (IOST'?1"C-".E)&$Y>(IOSL-13) D NEWP1^SCRPU3(.PAGE,TITL,132) W:'STOP !,$G(@STORE@(INST))
"RTN","SCRPTP2",118,0)
 .I (IOST?1"C-".E)&$Y>(IOSL-13) D HOLD^SCRPU3(.PAGE,TITL,132) W:'STOP !,$G(@STORE@(INST))
"RTN","SCRPTP2",119,0)
 .Q:STOP
"RTN","SCRPTP2",120,0)
 .W !,$G(@STORE@(INST,TIEN,"D",NXT))
"RTN","SCRPTP2",121,0)
 W !!,"[Not Assigned] = Patient assigned to Team but not to a position/provider"
"RTN","SCRPTP2",122,0)
 W !,"[Inactive Position] = Patient assigned to Team & Position but has no active provider"
"RTN","SCRPTP2",123,0)
 Q
"RTN","SCRPTP2",124,0)
 ;
"RTN","SCRPTP2",125,0)
HEADER ;prints column headings
"RTN","SCRPTP2",126,0)
 N NXT
"RTN","SCRPTP2",127,0)
 F NXT="H1","H2","H3" D
"RTN","SCRPTP2",128,0)
 .W !,$G(@STORE@(NXT))
"RTN","SCRPTP2",129,0)
 Q
"RTN","SCRPTP2",130,0)
 ;
"RTN","SCRPTP2",131,0)
SETH ;sets column headings
"RTN","SCRPTP2",132,0)
 S @STORE@("H2")="Patient Name"
"RTN","SCRPTP2",133,0)
 S $E(@STORE@("H2"),25)="Pt ID"
"RTN","SCRPTP2",134,0)
 S $E(@STORE@("H2"),32)="Practitioner"
"RTN","SCRPTP2",135,0)
 S $E(@STORE@("H2"),56)="Role"
"RTN","SCRPTP2",136,0)
 S $E(@STORE@("H2"),80)="PC?"
"RTN","SCRPTP2",137,0)
 S $E(@STORE@("H1"),85)="Last"
"RTN","SCRPTP2",138,0)
 S $E(@STORE@("H2"),85)="Appt."
"RTN","SCRPTP2",139,0)
 S $E(@STORE@("H1"),97)="Next"
"RTN","SCRPTP2",140,0)
 S $E(@STORE@("H2"),97)="Appt."
"RTN","SCRPTP2",141,0)
 S $E(@STORE@("H2"),109)="Associated Clinic"
"RTN","SCRPTP2",142,0)
 S $P(@STORE@("H3"),"=",133)=""
"RTN","SCRPTP2",143,0)
 Q
"RTN","SCRPTP3")
0^7^B27766238
"RTN","SCRPTP3",1,0)
SCRPTP3 ;ALB/CMM - List of Team's Patients ; 29 Jun 99  04:11PM
"RTN","SCRPTP3",2,0)
 ;;5.3;Scheduling;**41,48,98,177,231**;AUG 13, 1993
"RTN","SCRPTP3",3,0)
 ;
"RTN","SCRPTP3",4,0)
 ;List of Team's Patients Report
"RTN","SCRPTP3",5,0)
 ;
"RTN","SCRPTP3",6,0)
HITS(ARRY,TIEN) ;
"RTN","SCRPTP3",7,0)
 ;ARRY - list of patients for a given team
"RTN","SCRPTP3",8,0)
 ;TIEN - team ien
"RTN","SCRPTP3",9,0)
 ;
"RTN","SCRPTP3",10,0)
 N PTIEN,PIEN,PTNAME,PNAME,PTAI,NXT,NODE,CIEN,CNAME,INAME,INST,LAST,NEXT
"RTN","SCRPTP3",11,0)
 N PAIEN,PC,PHONE,PNODE,PTPA,PTPAN,ROL,PID,TINFO,TNAME,TPIEN,TPNODE
"RTN","SCRPTP3",12,0)
 N CNT,TPA,FLAG,DFN,VA,VAERR,PCAP,ROLN
"RTN","SCRPTP3",13,0)
 S INACTIVE=0
"RTN","SCRPTP3",14,0)
 S NXT=0
"RTN","SCRPTP3",15,0)
 F  S NXT=$O(@ARRY@(NXT)) Q:NXT=""!(NXT'?.N)  D
"RTN","SCRPTP3",16,0)
 .S NODE=$G(@ARRY@(NXT))
"RTN","SCRPTP3",17,0)
 .Q:NODE=""
"RTN","SCRPTP3",18,0)
 .S PTIEN=+$P(NODE,"^") ;patient ien
"RTN","SCRPTP3",19,0)
 .S PTNAME=$P(NODE,"^",2) ;patient name
"RTN","SCRPTP3",20,0)
 .S PTAI=+$P(NODE,"^",3) ;patient team assignment ien (#404.42)
"RTN","SCRPTP3",21,0)
 .;
"RTN","SCRPTP3",22,0)
 .S PNODE=$G(^DPT(PTIEN,0))
"RTN","SCRPTP3",23,0)
 .Q:PNODE=""
"RTN","SCRPTP3",24,0)
 .S DFN=PTIEN
"RTN","SCRPTP3",25,0)
 .D PID^VADPT6
"RTN","SCRPTP3",26,0)
 .S PID=VA("BID")
"RTN","SCRPTP3",27,0)
 .;
"RTN","SCRPTP3",28,0)
 .S TPA=$$TPAR(PTAI,"")
"RTN","SCRPTP3",29,0)
 .I TPA'=-1 D
"RTN","SCRPTP3",30,0)
 ..S PIEN=$P(TPA,"^")
"RTN","SCRPTP3",31,0)
 ..S PNAME=$P(TPA,"^",2)
"RTN","SCRPTP3",32,0)
 ..S CNAME=$P(TPA,"^",3)
"RTN","SCRPTP3",33,0)
 ..S LAST=$P(TPA,"^",4)
"RTN","SCRPTP3",34,0)
 ..S NEXT=$P(TPA,"^",5)
"RTN","SCRPTP3",35,0)
 ..;
"RTN","SCRPTP3",36,0)
 ..S FLAG="Y"
"RTN","SCRPTP3",37,0)
 ..S TINFO=$$TINF^SCRPTP(TIEN) ;team information
"RTN","SCRPTP3",38,0)
 ..S INST=+$P(TINFO,"^") ;institution ien
"RTN","SCRPTP3",39,0)
 ..S INAME=$P($G(^DIC(4,INST,0)),"^") ;institution name
"RTN","SCRPTP3",40,0)
 ..S PHONE=$P(TINFO,"^",4) ;team phone
"RTN","SCRPTP3",41,0)
 ..S PC=$P(TINFO,"^",3) ;primary care?
"RTN","SCRPTP3",42,0)
 ..S TNAME=$P(TINFO,"^",2) ;team name
"RTN","SCRPTP3",43,0)
 ..;
"RTN","SCRPTP3",44,0)
 ..D TFORMAT^SCRPTP2(INST,INAME,TIEN,TNAME,PHONE,PC)
"RTN","SCRPTP3",45,0)
 ..D FORMAT^SCRPTP(INST,TIEN,PTIEN,PTNAME,PID,PIEN,PNAME,CNAME,LAST,NEXT)
"RTN","SCRPTP3",46,0)
 .;
"RTN","SCRPTP3",47,0)
 .;check for other assignments
"RTN","SCRPTP3",48,0)
 .N TPIN
"RTN","SCRPTP3",49,0)
 .S CNT=""
"RTN","SCRPTP3",50,0)
 .F  S CNT=$O(^SCPT(404.43,"B",PTAI,CNT)) Q:CNT=""!(CNT'?.N)  D
"RTN","SCRPTP3",51,0)
 ..S TPIN=$$TPAR(PTAI,CNT)
"RTN","SCRPTP3",52,0)
 ..Q:TPIN=-1
"RTN","SCRPTP3",53,0)
 ..S PIEN=$P(TPIN,"^")
"RTN","SCRPTP3",54,0)
 ..S PNAME=$P(TPIN,"^",2)
"RTN","SCRPTP3",55,0)
 ..S CNAME=$P(TPIN,"^",3)
"RTN","SCRPTP3",56,0)
 ..S LAST=$P(TPIN,"^",4)
"RTN","SCRPTP3",57,0)
 ..S NEXT=$P(TPIN,"^",5)
"RTN","SCRPTP3",58,0)
 ..S ROLN=$P(TPIN,U,6)
"RTN","SCRPTP3",59,0)
 ..S PCAP=$P(TPIN,U,7)
"RTN","SCRPTP3",60,0)
 ..I '$D(FLAG) D
"RTN","SCRPTP3",61,0)
 ...S TINFO=$$TINF^SCRPTP(TIEN) ;team information
"RTN","SCRPTP3",62,0)
 ...S INST=+$P(TINFO,"^") ;institution ien
"RTN","SCRPTP3",63,0)
 ...S INAME=$P($G(^DIC(4,INST,0)),"^") ;institution name
"RTN","SCRPTP3",64,0)
 ...S PHONE=$P(TINFO,"^",4) ;team phone
"RTN","SCRPTP3",65,0)
 ...S PC=$P(TINFO,"^",3) ;primary care?
"RTN","SCRPTP3",66,0)
 ...S TNAME=$P(TINFO,"^",2) ;team name
"RTN","SCRPTP3",67,0)
 ...;
"RTN","SCRPTP3",68,0)
 ...D TFORMAT^SCRPTP2(INST,INAME,TIEN,TNAME,PHONE,PC)
"RTN","SCRPTP3",69,0)
 ..D FORMAT^SCRPTP(INST,TIEN,PTIEN,PTNAME,PID,PIEN,PNAME,CNAME,LAST,NEXT,ROLN,PCAP)
"RTN","SCRPTP3",70,0)
 I INACTIVE S @STORE@(INST,TIEN,"INACT")=""
"RTN","SCRPTP3",71,0)
 Q
"RTN","SCRPTP3",72,0)
 ;
"RTN","SCRPTP3",73,0)
TPAR(PTAI,START) ;
"RTN","SCRPTP3",74,0)
 N PTPA,TPIEN,TPNODE,ROL,CNAME,CIEN,ENROLL,OKAY,PNAME,NEXT,LAST,PAIEN
"RTN","SCRPTP3",75,0)
 N ROLN,PCAP
"RTN","SCRPTP3",76,0)
 I '$D(^SCPT(404.43,"B",PTAI)) Q "0^[Not Assigned]"
"RTN","SCRPTP3",77,0)
 ; ^ no patient team position assignment
"RTN","SCRPTP3",78,0)
 IF START="" D
"RTN","SCRPTP3",79,0)
 .S PTPA=$O(^SCPT(404.43,"B",PTAI,START))
"RTN","SCRPTP3",80,0)
 ELSE  D
"RTN","SCRPTP3",81,0)
 .S PTPA=START
"RTN","SCRPTP3",82,0)
 I PTPA="" Q "0^[Not Assigned]"
"RTN","SCRPTP3",83,0)
 S PTPAN=$G(^SCPT(404.43,PTPA,0)) ;patient team position assignment node
"RTN","SCRPTP3",84,0)
 I PTPAN=""!(PTPAN=0) Q "0^[Not Assigned]"
"RTN","SCRPTP3",85,0)
 I $P(PTPAN,"^",4)'="",$P(PTPAN,"^",4)<DT Q -1
"RTN","SCRPTP3",86,0)
 S TPIEN=+$P(PTPAN,"^",2) ;team position ien (#404.57)
"RTN","SCRPTP3",87,0)
 I '$D(^SCTM(404.57,TPIEN,0)) Q "0^[Not Assigned]"
"RTN","SCRPTP3",88,0)
 S TPNODE=$G(^SCTM(404.57,TPIEN,0))
"RTN","SCRPTP3",89,0)
 I TPNODE="" Q "0^[Not Assigned]"
"RTN","SCRPTP3",90,0)
 S ROL=+$P(TPNODE,"^",3) ;role for position (ien)
"RTN","SCRPTP3",91,0)
 Q:'$D(ROLE(ROL))&(ROLE'=1) -1
"RTN","SCRPTP3",92,0)
 ; ^ not a selected role
"RTN","SCRPTP3",93,0)
 S ROLN=$P($G(^SD(403.46,ROL,0)),U) ;role name
"RTN","SCRPTP3",94,0)
 ;
"RTN","SCRPTP3",95,0)
 S PCAP=$S($P(PTPAN,U,5)<1:"NPC",+$$OKPREC3^SCMCLK(TPIEN,DT)>0:" AP",1:"PCP") ;PC?
"RTN","SCRPTP3",96,0)
 ;
"RTN","SCRPTP3",97,0)
 S CIEN=+$P(TPNODE,"^",9) ;associated clinic ien
"RTN","SCRPTP3",98,0)
 S CNAME=$P($G(^SC(CIEN,0)),"^") ;clinic name
"RTN","SCRPTP3",99,0)
 ;check patient status
"RTN","SCRPTP3",100,0)
 S OKAY=""
"RTN","SCRPTP3",101,0)
 I CIEN>0&(PSTAT'=1) S OKAY=$$PST^SCRPTP(PTIEN,CIEN)
"RTN","SCRPTP3",102,0)
 Q:(CIEN>0)&('OKAY)&(PSTAT'=1) -1
"RTN","SCRPTP3",103,0)
 ; ^ not selected patient status
"RTN","SCRPTP3",104,0)
 ;
"RTN","SCRPTP3",105,0)
 S ENROLL=$$ENRL(PTIEN,CIEN) ;enrolled in associated clinic
"RTN","SCRPTP3",106,0)
 I 'ENROLL S CNAME="",CIEN=0
"RTN","SCRPTP3",107,0)
 ;
"RTN","SCRPTP3",108,0)
 S PAIEN=$$CHK(TPIEN)
"RTN","SCRPTP3",109,0)
 I +PAIEN'=0 S PIEN=+PAIEN,PNAME=$P(PAIEN,"^",2) ; practitioner's name
"RTN","SCRPTP3",110,0)
 ;SD*5.3*231
"RTN","SCRPTP3",111,0)
 I +PAIEN=0 S PIEN=0,PNAME="[Inactive Position]"
"RTN","SCRPTP3",112,0)
 ;
"RTN","SCRPTP3",113,0)
 S (NEXT,LAST)=""
"RTN","SCRPTP3",114,0)
 I +CIEN>0 S NEXT=$$GETNEXT^SCRPU3(PTIEN,CIEN) ;next appointment
"RTN","SCRPTP3",115,0)
 I +CIEN>0 S LAST=$$GETLAST^SCRPU3(PTIEN,CIEN) ;last appointment
"RTN","SCRPTP3",116,0)
 ;
"RTN","SCRPTP3",117,0)
 Q PIEN_U_PNAME_U_CNAME_U_LAST_U_NEXT_U_ROLN_U_PCAP
"RTN","SCRPTP3",118,0)
 ;
"RTN","SCRPTP3",119,0)
ENRL(PTIEN,CLIEN) ;
"RTN","SCRPTP3",120,0)
 ;
"RTN","SCRPTP3",121,0)
 N FOUND,ENODE,EN,NXT
"RTN","SCRPTP3",122,0)
 S FOUND=0
"RTN","SCRPTP3",123,0)
 Q:'$D(^DPT(PTIEN,"DE","B",CLIEN)) FOUND
"RTN","SCRPTP3",124,0)
 S EN=$O(^DPT(PTIEN,"DE","B",CLIEN,""))
"RTN","SCRPTP3",125,0)
 Q:EN=""!'$D(^DPT(PTIEN,"DE",EN,1)) FOUND
"RTN","SCRPTP3",126,0)
 S NXT=""
"RTN","SCRPTP3",127,0)
 F  S NXT=$O(^DPT(PTIEN,"DE",EN,1,NXT)) Q:(FOUND)!(NXT="")!(NXT'?.N)  D
"RTN","SCRPTP3",128,0)
 .;check if active enrollment
"RTN","SCRPTP3",129,0)
 .S ENODE=$G(^DPT(PTIEN,"DE",EN,1,NXT,0))
"RTN","SCRPTP3",130,0)
 .I $P(ENODE,"^",3)'="",$P(ENODE,"^",3)<DT+1!$P(ENODE,"^")>DT Q  ;not active enrollment
"RTN","SCRPTP3",131,0)
 .;                      ^ discharge date     ^ enrollment date
"RTN","SCRPTP3",132,0)
 .S FOUND=1
"RTN","SCRPTP3",133,0)
 Q FOUND
"RTN","SCRPTP3",134,0)
 ;
"RTN","SCRPTP3",135,0)
CHK(TPIEN) ;assigned to a position
"RTN","SCRPTP3",136,0)
 ;TPIEN - ien of 404.57 Team Position file
"RTN","SCRPTP3",137,0)
 ;returns:  ien of 200 New Person file
"RTN","SCRPTP3",138,0)
 N EN,PLIST,PERR,ERR,NAME
"RTN","SCRPTP3",139,0)
 S PLIST="PLST",PERR="PRR"
"RTN","SCRPTP3",140,0)
 K @PLIST,@PERR
"RTN","SCRPTP3",141,0)
 S ERR=$$PRTP^SCAPMC8(TPIEN,,.PLIST,.PERR)
"RTN","SCRPTP3",142,0)
 I '$D(@PERR) D
"RTN","SCRPTP3",143,0)
 .S EN=$P($G(@PLIST@(1)),"^") ;ien of new person file
"RTN","SCRPTP3",144,0)
 .S NAME=$P($G(@PLIST@(1)),"^",2) ; new person name
"RTN","SCRPTP3",145,0)
 K @PLIST,@PERR
"RTN","SCRPTP3",146,0)
 Q EN_"^"_NAME
"RTN","SCRPTP3",147,0)
 ;
"RTN","SCRPV1B")
0^8^B40452593
"RTN","SCRPV1B",1,0)
SCRPV1B ; bp/djb - PCMM Inconsistency Rpt - Print ; 9/13/99 3:23pm
"RTN","SCRPV1B",2,0)
 ;;5.3;Scheduling;**177,231**;AUG 13, 1993
"RTN","SCRPV1B",3,0)
 ;
"RTN","SCRPV1B",4,0)
EN ;
"RTN","SCRPV1B",5,0)
 NEW PAGE,QUIT
"RTN","SCRPV1B",6,0)
 S QUIT=0
"RTN","SCRPV1B",7,0)
 D HD
"RTN","SCRPV1B",8,0)
 D POSITION Q:QUIT
"RTN","SCRPV1B",9,0)
 D PATIENT
"RTN","SCRPV1B",10,0)
 Q
"RTN","SCRPV1B",11,0)
 ;
"RTN","SCRPV1B",12,0)
POSITION ;Print position inconsistencies.
"RTN","SCRPV1B",13,0)
 NEW NUM,POS,TM,TXT
"RTN","SCRPV1B",14,0)
 ;
"RTN","SCRPV1B",15,0)
 W !!,"POSITION INCONSISTENCIES"
"RTN","SCRPV1B",16,0)
 W !,"------------------------",!
"RTN","SCRPV1B",17,0)
 I '$D(^TMP("PCMM POSITION",$J)) W !?3,"No inconsistencies found." Q
"RTN","SCRPV1B",18,0)
 I SCMODE="B" D BRIEFPOS^SCRPV1B1 Q  ;Report type = Brief
"RTN","SCRPV1B",19,0)
 W !?3,"INCONSISTENCY"
"RTN","SCRPV1B",20,0)
 W !?6,"TEAM",?38,"POSITION",!
"RTN","SCRPV1B",21,0)
 ;
"RTN","SCRPV1B",22,0)
 ;Process the POSITION array
"RTN","SCRPV1B",23,0)
 S NUM=0
"RTN","SCRPV1B",24,0)
 F  S NUM=$O(^TMP("PCMM POSITION",$J,NUM)) Q:'NUM!QUIT  D  ;
"RTN","SCRPV1B",25,0)
 . S TXT=$T(TXT+NUM)
"RTN","SCRPV1B",26,0)
 . S TXT=$P(TXT,";",4)
"RTN","SCRPV1B",27,0)
 . I $Y>(IOSL-6) D PAUSE Q:QUIT
"RTN","SCRPV1B",28,0)
 . W !?3,TXT
"RTN","SCRPV1B",29,0)
 . S TM=""
"RTN","SCRPV1B",30,0)
 . F  S TM=$O(^TMP("PCMM POSITION",$J,NUM,TM)) Q:TM=""!QUIT  D
"RTN","SCRPV1B",31,0)
 .. S POS=""
"RTN","SCRPV1B",32,0)
 .. F  S POS=$O(^TMP("PCMM POSITION",$J,NUM,TM,POS)) Q:POS=""!QUIT  D
"RTN","SCRPV1B",33,0)
 ... I $Y>(IOSL-6) D PAUSE Q:QUIT
"RTN","SCRPV1B",34,0)
 ... W !,?6,TM,?38,POS
"RTN","SCRPV1B",35,0)
 Q
"RTN","SCRPV1B",36,0)
 ;
"RTN","SCRPV1B",37,0)
PATIENT ;Print patient inconsistencies
"RTN","SCRPV1B",38,0)
 ;
"RTN","SCRPV1B",39,0)
 I $Y>(IOSL-7) D PAUSE Q:QUIT
"RTN","SCRPV1B",40,0)
 W !!,"PATIENT INCONSISTENCIES"
"RTN","SCRPV1B",41,0)
 W !,"-----------------------",!
"RTN","SCRPV1B",42,0)
 I '$D(^TMP("PCMM PATIENT",$J)) D  Q
"RTN","SCRPV1B",43,0)
 . W !?3,"No inconsistencies found.",!
"RTN","SCRPV1B",44,0)
 I $Y>(IOSL-6) D PAUSE Q:QUIT
"RTN","SCRPV1B",45,0)
 I SCMODE="B" D BRIEFPT^SCRPV1B1 Q  ;Report type = Brief
"RTN","SCRPV1B",46,0)
 I SCMODE="DP" D PATIENT1 Q
"RTN","SCRPV1B",47,0)
 I SCMODE="DT" D PATIENT2 Q
"RTN","SCRPV1B",48,0)
 Q
"RTN","SCRPV1B",49,0)
 ;
"RTN","SCRPV1B",50,0)
PATIENT1 ;Patient printout sorted by patient name.
"RTN","SCRPV1B",51,0)
 NEW DFN,DFNNAM,NUM,POS,SSN,TM,TXT,VAR
"RTN","SCRPV1B",52,0)
 ;
"RTN","SCRPV1B",53,0)
 W !?3,"PATIENT",?41,"SSN"
"RTN","SCRPV1B",54,0)
 W !?6,"INCONSISTENCY"
"RTN","SCRPV1B",55,0)
 W !?9,"TEAM",?41,"POSITION",!
"RTN","SCRPV1B",56,0)
 ;
"RTN","SCRPV1B",57,0)
 ;Process the PATIENT array
"RTN","SCRPV1B",58,0)
 S DFNNAM=""
"RTN","SCRPV1B",59,0)
 F  S DFNNAM=$O(^TMP("PCMM PATIENT",$J,DFNNAM)) Q:DFNNAM=""!QUIT  D  ;
"RTN","SCRPV1B",60,0)
 . S DFN=0
"RTN","SCRPV1B",61,0)
 . F  S DFN=$O(^TMP("PCMM PATIENT",$J,DFNNAM,DFN)) Q:'DFN!QUIT  D  ;
"RTN","SCRPV1B",62,0)
 .. I $Y>(IOSL-6) D PAUSE Q:QUIT
"RTN","SCRPV1B",63,0)
 .. S SSN=$P($G(^DPT(DFN,0)),U,9)
"RTN","SCRPV1B",64,0)
 .. W !?3,DFNNAM,?41,SSN
"RTN","SCRPV1B",65,0)
 .. S NUM=0
"RTN","SCRPV1B",66,0)
 .. F  S NUM=$O(^TMP("PCMM PATIENT",$J,DFNNAM,DFN,NUM)) Q:'NUM!QUIT  D
"RTN","SCRPV1B",67,0)
 ... S VAR=0
"RTN","SCRPV1B",68,0)
 ... ;If number is 8.1, 8.2 or 8.3, substitute in 3 choices below.
"RTN","SCRPV1B",69,0)
 ... I NUM?1"8.".E S VAR=$P(NUM,".",2)
"RTN","SCRPV1B",70,0)
 ... S TXT=$T(TXT+(NUM\1))
"RTN","SCRPV1B",71,0)
 ... S TXT=$P(TXT,";",4)
"RTN","SCRPV1B",72,0)
 ... I VAR D  ;
"RTN","SCRPV1B",73,0)
 .... S VAR=$S(VAR=1:"Team Assignment",VAR=2:"Team",1:"Position")
"RTN","SCRPV1B",74,0)
 .... S TXT=$P(TXT,"[]",1)_VAR_$P(TXT,"[]",2)
"RTN","SCRPV1B",75,0)
 ... I $Y>(IOSL-6) D PAUSE Q:QUIT
"RTN","SCRPV1B",76,0)
 ... ;W !?6,(NUM\1),". ",TXT
"RTN","SCRPV1B",77,0)
 ... W !?6,TXT
"RTN","SCRPV1B",78,0)
 ... S TM=""
"RTN","SCRPV1B",79,0)
 ... F  S TM=$O(^TMP("PCMM PATIENT",$J,DFNNAM,DFN,NUM,TM)) Q:TM=""!QUIT  D
"RTN","SCRPV1B",80,0)
 .... S POS=""
"RTN","SCRPV1B",81,0)
 .... F  S POS=$O(^TMP("PCMM PATIENT",$J,DFNNAM,DFN,NUM,TM,POS)) Q:POS=""!QUIT  D
"RTN","SCRPV1B",82,0)
 ..... I $Y>(IOSL-6) D PAUSE Q:QUIT
"RTN","SCRPV1B",83,0)
 ..... W !?9,TM,?41,POS
"RTN","SCRPV1B",84,0)
 ..... ;
"RTN","SCRPV1B",85,0)
 ..... ;Print 404.43 IEN if SCIEN is set to 1 before calling ^SCRPV1.
"RTN","SCRPV1B",86,0)
 ..... I $G(SCIEN) D  ;
"RTN","SCRPV1B",87,0)
 ...... I $G(^TMP("PCMM PATIENT",$J,DFNNAM,DFN,NUM,TM,POS)) W ?72,^(POS)
"RTN","SCRPV1B",88,0)
 Q
"RTN","SCRPV1B",89,0)
 ;
"RTN","SCRPV1B",90,0)
PATIENT2 ;Patient printout sorted by inconsistency number and then team name.
"RTN","SCRPV1B",91,0)
 NEW DFN,DFNNAM,NUM,POS,SSN,TM,TXT,VAR
"RTN","SCRPV1B",92,0)
 ;
"RTN","SCRPV1B",93,0)
 W !,"INCONSISTENCY"
"RTN","SCRPV1B",94,0)
 W !?3,"TEAM"
"RTN","SCRPV1B",95,0)
 W !?6,"PATIENT",?38,"SSN",?50,"POSITION",!
"RTN","SCRPV1B",96,0)
 ;
"RTN","SCRPV1B",97,0)
 KILL ^TMP("PCMM PATIENT1",$J)
"RTN","SCRPV1B",98,0)
 ;
"RTN","SCRPV1B",99,0)
 ;Reorder PATIENT array
"RTN","SCRPV1B",100,0)
 S DFNNAM=""
"RTN","SCRPV1B",101,0)
 F  S DFNNAM=$O(^TMP("PCMM PATIENT",$J,DFNNAM)) Q:DFNNAM=""  D  ;
"RTN","SCRPV1B",102,0)
 . S DFN=0
"RTN","SCRPV1B",103,0)
 . F  S DFN=$O(^TMP("PCMM PATIENT",$J,DFNNAM,DFN)) Q:'DFN  D  ;
"RTN","SCRPV1B",104,0)
 .. S NUM=0
"RTN","SCRPV1B",105,0)
 .. F  S NUM=$O(^TMP("PCMM PATIENT",$J,DFNNAM,DFN,NUM)) Q:'NUM  D  ;
"RTN","SCRPV1B",106,0)
 ... S TM=""
"RTN","SCRPV1B",107,0)
 ... F  S TM=$O(^TMP("PCMM PATIENT",$J,DFNNAM,DFN,NUM,TM)) Q:TM=""  D
"RTN","SCRPV1B",108,0)
 .... S POS=""
"RTN","SCRPV1B",109,0)
 .... F  S POS=$O(^TMP("PCMM PATIENT",$J,DFNNAM,DFN,NUM,TM,POS)) Q:POS=""  D
"RTN","SCRPV1B",110,0)
 ..... S ^TMP("PCMM PATIENT1",$J,NUM,TM,DFNNAM,DFN,POS)=""
"RTN","SCRPV1B",111,0)
 ;
"RTN","SCRPV1B",112,0)
 ;Process new array
"RTN","SCRPV1B",113,0)
 S NUM=0
"RTN","SCRPV1B",114,0)
 F  S NUM=$O(^TMP("PCMM PATIENT1",$J,NUM)) Q:'NUM!QUIT  D  ;
"RTN","SCRPV1B",115,0)
 . S VAR=0
"RTN","SCRPV1B",116,0)
 . ;If number is 8.1, 8.2 or 8.3, substitute in 3 choices below.
"RTN","SCRPV1B",117,0)
 . I NUM?1"8.".E S VAR=$P(NUM,".",2)
"RTN","SCRPV1B",118,0)
 . S TXT=$T(TXT+(NUM\1))
"RTN","SCRPV1B",119,0)
 . S TXT=$P(TXT,";",4)
"RTN","SCRPV1B",120,0)
 . I VAR D  ;
"RTN","SCRPV1B",121,0)
 .. S VAR=$S(VAR=1:"Team Assignment",VAR=2:"Team",1:"Position")
"RTN","SCRPV1B",122,0)
 .. S TXT=$P(TXT,"[]",1)_VAR_$P(TXT,"[]",2)
"RTN","SCRPV1B",123,0)
 . ;
"RTN","SCRPV1B",124,0)
 . I $Y>(IOSL-6) D PAUSE Q:QUIT
"RTN","SCRPV1B",125,0)
 . W !,TXT
"RTN","SCRPV1B",126,0)
 . ;
"RTN","SCRPV1B",127,0)
 . S TM=""
"RTN","SCRPV1B",128,0)
 . F  S TM=$O(^TMP("PCMM PATIENT1",$J,NUM,TM)) Q:TM=""!QUIT  D  ;
"RTN","SCRPV1B",129,0)
 .. I $Y>(IOSL-6) D PAUSE Q:QUIT
"RTN","SCRPV1B",130,0)
 .. W !?3,TM
"RTN","SCRPV1B",131,0)
 .. S DFNNAM=""
"RTN","SCRPV1B",132,0)
 .. F  S DFNNAM=$O(^TMP("PCMM PATIENT1",$J,NUM,TM,DFNNAM)) Q:DFNNAM=""!QUIT  D  ;
"RTN","SCRPV1B",133,0)
 ... S DFN=0
"RTN","SCRPV1B",134,0)
 ... F  S DFN=$O(^TMP("PCMM PATIENT1",$J,NUM,TM,DFNNAM,DFN)) Q:'DFN!QUIT  D
"RTN","SCRPV1B",135,0)
 .... S POS=0
"RTN","SCRPV1B",136,0)
 .... F  S POS=$O(^TMP("PCMM PATIENT1",$J,NUM,TM,DFNNAM,DFN,POS)) Q:'POS!QUIT  D  ;
"RTN","SCRPV1B",137,0)
 ..... S SSN=$P($G(^DPT(DFN,0)),U,9)
"RTN","SCRPV1B",138,0)
 ..... I $Y>(IOSL-6) D PAUSE Q:QUIT
"RTN","SCRPV1B",139,0)
 ..... W !?6,DFNNAM,?38,SSN,?50,POS
"RTN","SCRPV1B",140,0)
 ;
"RTN","SCRPV1B",141,0)
 KILL ^TMP("PCMM PATIENT1",$J)
"RTN","SCRPV1B",142,0)
 Q
"RTN","SCRPV1B",143,0)
 ;
"RTN","SCRPV1B",144,0)
PAUSE ;Pause the display
"RTN","SCRPV1B",145,0)
 NEW ANS,COL,PGTXT
"RTN","SCRPV1B",146,0)
 S PAGE=PAGE+1
"RTN","SCRPV1B",147,0)
 I $G(ION)="HFS" Q
"RTN","SCRPV1B",148,0)
 S PGTXT="Page: "_PAGE
"RTN","SCRPV1B",149,0)
 S COL=(IOM-$L(PGTXT)-2)
"RTN","SCRPV1B",150,0)
 I $E(IOST,1,2)="P-" W @IOF,!?COL,PGTXT Q
"RTN","SCRPV1B",151,0)
 W !,"<RET> to continue, ^ to quit: "
"RTN","SCRPV1B",152,0)
 R ANS:DTIME S:'$T ANS="^" I ANS["^" S QUIT=1 Q
"RTN","SCRPV1B",153,0)
 W @IOF,!?COL,PGTXT
"RTN","SCRPV1B",154,0)
 Q
"RTN","SCRPV1B",155,0)
 ;
"RTN","SCRPV1B",156,0)
HD ;Heading
"RTN","SCRPV1B",157,0)
 NEW HD,LINE,NOW,TM,TMN
"RTN","SCRPV1B",158,0)
 ;
"RTN","SCRPV1B",159,0)
 S PAGE=1
"RTN","SCRPV1B",160,0)
 S HD="PCMM INCONSISTENCY REPORT"
"RTN","SCRPV1B",161,0)
 ;Adjust heading if going to the P-MESSAGE device
"RTN","SCRPV1B",162,0)
 I IOST["P-",IOST["MESSAGE" D  Q
"RTN","SCRPV1B",163,0)
 . W !?(78-$L(HD)\2),HD
"RTN","SCRPV1B",164,0)
 ;
"RTN","SCRPV1B",165,0)
 I $E(IOST,1,2)="P-" W !!
"RTN","SCRPV1B",166,0)
 E  W @IOF
"RTN","SCRPV1B",167,0)
 S $P(LINE,"=",IOM)=""
"RTN","SCRPV1B",168,0)
 W !?(IOM-$L(HD)\2),HD
"RTN","SCRPV1B",169,0)
 S NOW=$$NOW^XLFDT()
"RTN","SCRPV1B",170,0)
 I $P(NOW,".",2) S NOW=$P(NOW,".",1)_"."_$E($P(NOW,".",2),1,4)
"RTN","SCRPV1B",171,0)
 S HD=$$FMTE^XLFDT(NOW)
"RTN","SCRPV1B",172,0)
 W !?(IOM-$L(HD)\2),HD
"RTN","SCRPV1B",173,0)
 W !,LINE
"RTN","SCRPV1B",174,0)
 I SCTYPE("TM")="I" D  ;
"RTN","SCRPV1B",175,0)
 . W !,"See PCMM User Guide for detailed instructions."
"RTN","SCRPV1B",176,0)
 E  D  ;
"RTN","SCRPV1B",177,0)
 . W !,"Teams: "
"RTN","SCRPV1B",178,0)
 . I SCTYPE("TM")="A" W "All teams"
"RTN","SCRPV1B",179,0)
 . E  D  ;
"RTN","SCRPV1B",180,0)
 .. S TM=0
"RTN","SCRPV1B",181,0)
 .. F  S TM=$O(SCTM(TM)) Q:'TM  D  ;
"RTN","SCRPV1B",182,0)
 ... S TMN=$P($G(^SCTM(404.51,TM,0)),U,1)
"RTN","SCRPV1B",183,0)
 ... S:TMN']"" TMN="UNKNOWN"
"RTN","SCRPV1B",184,0)
 ... I ($L(TMN)+$X+2)>IOM W !?7
"RTN","SCRPV1B",185,0)
 ... W TMN
"RTN","SCRPV1B",186,0)
 ... I $O(SCTM(TM)) W ", "
"RTN","SCRPV1B",187,0)
 W !,LINE
"RTN","SCRPV1B",188,0)
 Q
"RTN","SCRPV1B",189,0)
 ;
"RTN","SCRPV1B",190,0)
TXT ;Inconsistencies
"RTN","SCRPV1B",191,0)
 ;;1;Position has no staff assigned
"RTN","SCRPV1B",192,0)
 ;;2;Patient has no PCP assigned
"RTN","SCRPV1B",193,0)
 ;;3;Patient has multiple PCPs assigned
"RTN","SCRPV1B",194,0)
 ;;4;AP & PCP are the same provider
"RTN","SCRPV1B",195,0)
 ;;5;AP is without a Preceptor
"RTN","SCRPV1B",196,0)
 ;;6;AP position is not designated for PC
"RTN","SCRPV1B",197,0)
 ;;7;PCP position is not designated for PC
"RTN","SCRPV1B",198,0)
 ;;8;Position assignment with inactive []
"RTN","SCRPV1B",199,0)
 Q
"RTN","SD53P231")
0^1^B3082862
"RTN","SD53P231",1,0)
SD53P231 ;ALB/RBS - Patch SD*5.3*231 Install Utility Routine ; 5/15/01 11:11am
"RTN","SD53P231",2,0)
 ;;5.3;Scheduling;**231**;AUG 13, 1993
"RTN","SD53P231",3,0)
 ;
"RTN","SD53P231",4,0)
 ;
"RTN","SD53P231",5,0)
ENV ;Main entry point for Environment check point.
"RTN","SD53P231",6,0)
 ;
"RTN","SD53P231",7,0)
 S XPDABORT=""
"RTN","SD53P231",8,0)
 D PROGCHK(.XPDABORT) ;checks programmer variables
"RTN","SD53P231",9,0)
 D PARMCHK(.XPDABORT) ;checks param file ien exists
"RTN","SD53P231",10,0)
 I XPDABORT="" K XPDABORT
"RTN","SD53P231",11,0)
 Q
"RTN","SD53P231",12,0)
 ;
"RTN","SD53P231",13,0)
PRE ;Main entry point for Pre-init items.
"RTN","SD53P231",14,0)
 ;
"RTN","SD53P231",15,0)
 Q
"RTN","SD53P231",16,0)
 ;
"RTN","SD53P231",17,0)
POST ;Main entry point for Post-init items.
"RTN","SD53P231",18,0)
 ;
"RTN","SD53P231",19,0)
 D POST1 ;Update Client/Server files
"RTN","SD53P231",20,0)
 Q
"RTN","SD53P231",21,0)
 ;
"RTN","SD53P231",22,0)
PROGCHK(XPDABORT) ;checks for necessary programmer variables
"RTN","SD53P231",23,0)
 ;
"RTN","SD53P231",24,0)
 I '$G(DUZ)!($G(DUZ(0))'="@")!('$G(DT))!($G(U)'="^") D
"RTN","SD53P231",25,0)
 .D BMES^XPDUTL("*****")
"RTN","SD53P231",26,0)
 .D MES^XPDUTL("Your programming variables are not set up properly.")
"RTN","SD53P231",27,0)
 .D MES^XPDUTL("Installation aborted.")
"RTN","SD53P231",28,0)
 .D MES^XPDUTL("*****")
"RTN","SD53P231",29,0)
 .S XPDABORT=2
"RTN","SD53P231",30,0)
 Q
"RTN","SD53P231",31,0)
 ;
"RTN","SD53P231",32,0)
PARMCHK(XPDABORT) ;checks for proper param file ien
"RTN","SD53P231",33,0)
 ;
"RTN","SD53P231",34,0)
 I '$D(^SCTM(404.44,1)) D
"RTN","SD53P231",35,0)
 .D BMES^XPDUTL("*****")
"RTN","SD53P231",36,0)
 .D MES^XPDUTL("Parameter file (#404.44) does not have proper IEN (1).")
"RTN","SD53P231",37,0)
 .D MES^XPDUTL("Installation aborted.")
"RTN","SD53P231",38,0)
 .D MES^XPDUTL("*****")
"RTN","SD53P231",39,0)
 .S XPDABORT=2
"RTN","SD53P231",40,0)
 Q
"RTN","SD53P231",41,0)
 ;
"RTN","SD53P231",42,0)
POST1 ;Update client/server files.
"RTN","SD53P231",43,0)
 ;
"RTN","SD53P231",44,0)
 I $$UPCLNLST^SCMCUT("SD*5.3*231^NullClient^1^0^0") D  Q
"RTN","SD53P231",45,0)
 .D MES^XPDUTL("Client/Server files updated.")
"RTN","SD53P231",46,0)
 ;
"RTN","SD53P231",47,0)
 D MES^XPDUTL("Client/Server files NOT updated.")
"RTN","SD53P231",48,0)
 Q
"VER")
8.0^22.0
**END**
**END**
