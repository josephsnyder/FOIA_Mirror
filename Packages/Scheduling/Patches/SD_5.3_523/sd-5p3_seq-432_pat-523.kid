Released SD*5.3*523 SEQ #432
Extracted from mail message
**KIDS**:SD*5.3*523^

**INSTALL NAME**
SD*5.3*523
"BLD",7488,0)
SD*5.3*523^SCHEDULING^0^3071217^y
"BLD",7488,1,0)
^^2^2^3071130^
"BLD",7488,1,1,0)
Fix several issues including problem with cancelling clinic availability, 
"BLD",7488,1,2,0)
the Clinic Assignment listing and the No Show report.
"BLD",7488,4,0)
^9.64PA^^
"BLD",7488,6.3)
6
"BLD",7488,"ABPKG")
n
"BLD",7488,"KRN",0)
^9.67PA^8989.52^19
"BLD",7488,"KRN",.4,0)
.4
"BLD",7488,"KRN",.401,0)
.401
"BLD",7488,"KRN",.402,0)
.402
"BLD",7488,"KRN",.403,0)
.403
"BLD",7488,"KRN",.5,0)
.5
"BLD",7488,"KRN",.84,0)
.84
"BLD",7488,"KRN",3.6,0)
3.6
"BLD",7488,"KRN",3.8,0)
3.8
"BLD",7488,"KRN",9.2,0)
9.2
"BLD",7488,"KRN",9.8,0)
9.8
"BLD",7488,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",7488,"KRN",9.8,"NM",1,0)
SDC^^0^B25530077
"BLD",7488,"KRN",9.8,"NM",2,0)
SDCLAS^^0^B18970304
"BLD",7488,"KRN",9.8,"NM",3,0)
SDLT^^0^B15803609
"BLD",7488,"KRN",9.8,"NM",4,0)
SDN1^^0^B21253578
"BLD",7488,"KRN",9.8,"NM",5,0)
SDNOS0^^0^B28179889
"BLD",7488,"KRN",9.8,"NM","B","SDC",1)

"BLD",7488,"KRN",9.8,"NM","B","SDCLAS",2)

"BLD",7488,"KRN",9.8,"NM","B","SDLT",3)

"BLD",7488,"KRN",9.8,"NM","B","SDN1",4)

"BLD",7488,"KRN",9.8,"NM","B","SDNOS0",5)

"BLD",7488,"KRN",19,0)
19
"BLD",7488,"KRN",19.1,0)
19.1
"BLD",7488,"KRN",101,0)
101
"BLD",7488,"KRN",409.61,0)
409.61
"BLD",7488,"KRN",771,0)
771
"BLD",7488,"KRN",870,0)
870
"BLD",7488,"KRN",8989.51,0)
8989.51
"BLD",7488,"KRN",8989.52,0)
8989.52
"BLD",7488,"KRN",8994,0)
8994
"BLD",7488,"KRN","B",.4,.4)

"BLD",7488,"KRN","B",.401,.401)

"BLD",7488,"KRN","B",.402,.402)

"BLD",7488,"KRN","B",.403,.403)

"BLD",7488,"KRN","B",.5,.5)

"BLD",7488,"KRN","B",.84,.84)

"BLD",7488,"KRN","B",3.6,3.6)

"BLD",7488,"KRN","B",3.8,3.8)

"BLD",7488,"KRN","B",9.2,9.2)

"BLD",7488,"KRN","B",9.8,9.8)

"BLD",7488,"KRN","B",19,19)

"BLD",7488,"KRN","B",19.1,19.1)

"BLD",7488,"KRN","B",101,101)

"BLD",7488,"KRN","B",409.61,409.61)

"BLD",7488,"KRN","B",771,771)

"BLD",7488,"KRN","B",870,870)

"BLD",7488,"KRN","B",8989.51,8989.51)

"BLD",7488,"KRN","B",8989.52,8989.52)

"BLD",7488,"KRN","B",8994,8994)

"BLD",7488,"QUES",0)
^9.62^^
"BLD",7488,"REQB",0)
^9.611^4^4
"BLD",7488,"REQB",1,0)
SD*5.3*398^2
"BLD",7488,"REQB",2,0)
SD*5.3*455^2
"BLD",7488,"REQB",3,0)
SD*5.3*487^2
"BLD",7488,"REQB",4,0)
SD*5.3*517^2
"BLD",7488,"REQB","B","SD*5.3*398",1)

"BLD",7488,"REQB","B","SD*5.3*455",2)

"BLD",7488,"REQB","B","SD*5.3*487",3)

"BLD",7488,"REQB","B","SD*5.3*517",4)

"MBREQ")
0
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813
"PKG",16,22,1,"PAH",1,0)
523^3071217
"PKG",16,22,1,"PAH",1,1,0)
^^2^2^3071217
"PKG",16,22,1,"PAH",1,1,1,0)
Fix several issues including problem with cancelling clinic availability, 
"PKG",16,22,1,"PAH",1,1,2,0)
the Clinic Assignment listing and the No Show report.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","SDC")
0^1^B25530077^B24948807
"RTN","SDC",1,0)
SDC ;MAN/GRR,ALB/LDB - CANCEL A CLINIC'S AVAILABILITY ; 3/2/05 2:11pm
"RTN","SDC",2,0)
 ;;5.3;Scheduling;**15,32,79,132,167,478,487,523**;Aug 13, 1993;Build 6
"RTN","SDC",3,0)
 N SDATA,SDCNHDL ; for evt dvr
"RTN","SDC",4,0)
SDC1 K SDLT,SDCP S NOAP="" D LO^DGUTL
"RTN","SDC",5,0)
 S DIC=44,DIC(0)="MEQA",DIC("S")="I $P(^(0),""^"",3)=""C"",'$G(^(""OOS""))",DIC("A")="Select CLINIC NAME: " D ^DIC K DIC("S"),DIC("A") G:'$D(^SC(+Y,"SL")) END^SDC0
"RTN","SDC",6,0)
 S SC=+Y,SL=^("SL"),%DT="AEXF",%DT("A")="CANCEL '"_$P(Y,U,2)_"' FOR WHAT DATE: " D ^%DT K %DT G:Y<0 END^SDC0 ;NAKED REFERNCE - ^SC(IFN,"SL")
"RTN","SDC",7,0)
 S (SD,CDATE)=Y,%=$P(SL,U,6),SI=$S(%="":4,%<3:4,%:%,1:4),%=$P(SL,U,3),STARTDAY=$S($L(%):%,1:8) D NOW^%DTC S SDTIME=%
"RTN","SDC",8,0)
 K SDRE,SDIN,SDRE1 I $D(^SC(SC,"I")) S SDIN=+^("I"),SDRE=+$P(^("I"),"^",2),Y=SDRE D:Y DTS^SDUTL S SDRE1=$S(SDRE:" to "_Y,1:"")
"RTN","SDC",9,0)
 I $S('$D(SDIN):0,SDIN'>0!(SDIN>SD):0,SDRE'>SD&(SDRE):0,1:1) W !,*7,"Clinic is inactive ",$S('SDRE:"as of ",1:"from ") S Y=SDIN D DTS^SDUTL W Y,SDRE1 G SDC1
"RTN","SDC",10,0)
 I '$D(^SC(SC,"ST",SD,1)) S DH="" D B S ^SC(SC,"ST",SD,1)=$P("SU^MO^TU^WE^TH^FR^SA",U,DOW+1)_" "_$E(SD,6,7)_$J("",SI+SI-6)_DH,^(0)=SD G N
"RTN","SDC",11,0)
 I ^(1)["CANCELLED" W !,"APPOINTMENTS HAVE ALREADY BEEN CANCELLED",!,*7 S ANS="N",SDTIME="*",SDV1=$S($P(^SC(SC,0),"^",15):$P(^(0),"^",15),1:+$O(^DG(40.8,0))) K SDX G ASKL^SDC0 ;NAKED REFERENCE - ^SC(IFN,"ST",Date,1)
"RTN","SDC",12,0)
N I '$F(^SC(SC,"ST",SD,1),"[") K:^(1)?2U.E ^SC(SC,"ST",SD) W !,*7,"CLINIC DOES NOT MEET ON THAT DAY" G SDC1 ; KILLs node if not holiday
"RTN","SDC",13,0)
 I $O(^SC(SC,"S",SD))\1-SD W *7,!?5,"NO APPOINTMENTS SCHEDULED" S NOAP=1 G W
"RTN","SDC",14,0)
 W !,"FIRST, I'LL LIST THE EXISTING APPOINTMENTS",!
"RTN","SDC",15,0)
 K DUOUT,DTOUT D ^SDC1 I $D(DUOUT)!$D(DTOUT) D END^SDC0 Q
"RTN","SDC",16,0)
 I ^SC(SC,"ST",SD,1)["X" G ^SDC2
"RTN","SDC",17,0)
W S DH=0,%="" W !,"WANT TO CANCEL THE WHOLE DAY" D YN^DICN I '% W !,"REPLY YES (Y) OR NO (N)" G W
"RTN","SDC",18,0)
 I %=1 G WP:$$COED^SDC4(SC,SD,SD+.2359,1),ALL
"RTN","SDC",19,0)
 Q:%<1
"RTN","SDC",20,0)
WP S %="" W !,"WANT TO CANCEL PART OF THE DAY" D YN^DICN I '% W !,"REPLY YES (Y) OR NO (N)" G WP
"RTN","SDC",21,0)
 Q:(%-1)
"RTN","SDC",22,0)
F R !,"STARTING TIME: ",X:DTIME Q:U[X  D TC^SDC2 G F:Y<0 S FR=Y,ST=%
"RTN","SDC",23,0)
T R !,"ENDING TIME: ",X:DTIME Q:U[X  D TC^SDC2 G T:Y<0 S SDHTO=X,TO=Y I TO'>FR W !,"Ending time must be greater than starting time",*7 G T
"RTN","SDC",24,0)
 I $$COED^SDC4(SC,FR,TO,1) K FR,SDHTO,TO,ST W ! G F
"RTN","SDC",25,0)
ROPT R !,"Reason for cancellation:  ",I:DTIME I I?1"?".E W !,"YOU MAY ENTER A MESSAGE CONCERNING THE CANCELLATION HERE" G ROPT
"RTN","SDC",26,0)
 N CANREM S CANREM=I
"RTN","SDC",27,0)
 Q:I["^"  I '$D(^SC(SC,"SDCAN",0)) S ^SC(SC,"SDCAN",0)="^44.05D^"_FR_"^1" G SKIP
"RTN","SDC",28,0)
 S A=^SC(SC,"SDCAN",0),SDCNT=$P(A,"^",4),^SC(SC,"SDCAN",0)=$P(A,"^",1,2)_"^"_FR_"^"_(SDCNT+1)
"RTN","SDC",29,0)
SKIP S ^SC(SC,"SDCAN",FR,0)=FR_"^"_SDHTO
"RTN","SDC",30,0)
 S NOAP=$S($O(^SC(SC,"S",(FR-.0001)))'>0:1,$O(^SC(SC,"S",(FR-.0001)))>TO:1,1:0) I 'NOAP S NOAP=$S($O(^SC(SC,"S",+$O(^SC(SC,"S",(FR-.0001))),0))="MES":1,1:0)
"RTN","SDC",31,0)
 S ^SC(SC,"S",FR,0)=FR,^("MES")="CANCELLED UNTIL "_X_$S(I?.P:"",1:" ("_I_")") D S S I=^(1),I=I_$J("",%-$L(I)),Y=""
"RTN","SDC",32,0)
 F X=0:2:% S DH=$E(I,X+SI+SI),P=$S(X<ST:DH_$E(I,X+1+SI+SI),X=%:$S(Y="[":Y,1:DH)_$E(I,X+1+SI+SI),1:$S(Y="["&(X=ST):"]",1:"X")_"X"),Y=$S(DH="]":"",DH="[":DH,1:Y),I=$E(I,1,X-1+SI+SI)_P_$E(I,X+2+SI+SI,999)
"RTN","SDC",33,0)
 S:'$F(I,"[") I5=$F(I,"X"),I=$E(I,1,(I5-2))_"["_$E(I,I5,999) K I5
"RTN","SDC",34,0)
 S DH=0,^(1)=I,FR=FR-.0001 G C ;NAKED REFERENCE - ^SC(IFN,"ST",Date,1)
"RTN","SDC",35,0)
S S ^("CAN")=^SC(SC,"ST",SD,1) Q
"RTN","SDC",36,0)
 ;
"RTN","SDC",37,0)
ALL N CANREM
"RTN","SDC",38,0)
 W !,"Reason for cancellation: " R CANREM:DTIME I $L(CANREM)>160!($L(CANREM)<3) W !,*7,"Reason must be between 3 to 160 characters long",! G ALL
"RTN","SDC",39,0)
 D S S ^(1)="   "_$E(SD,6,7)_"    **CANCELLED**",FR=SD,TO=SD+.9 ;NAKED REFERENCE - ^SC(IFN,"ST",Date,1)
"RTN","SDC",40,0)
C S FR=$O(^SC(SC,"S",FR)) I FR<1!(FR'<TO) W !!,"CANCELLED!  " K SDX G CHKEND^SDC0
"RTN","SDC",41,0)
 N TDH,TMPD,DIE,DR,NODE
"RTN","SDC",42,0)
 F I=0:0 S I=$O(^SC(SC,"S",FR,1,I)) Q:I'>0  D
"RTN","SDC",43,0)
 .S DFN=+^SC(SC,"S",FR,1,I,0),SDCNHDL=$$HANDLE^SDAMEVT(1)
"RTN","SDC",44,0)
 .D BEFORE^SDAMEVT(.SDATA,DFN,FR,SC,I,SDCNHDL)
"RTN","SDC",45,0)
 .S $P(^SC(SC,"S",FR,1,I,0),"^",9)="C"
"RTN","SDC",46,0)
 .S:$D(^DPT(DFN,"S",FR,0)) NODE=^(0)  ;added SD/523
"RTN","SDC",47,0)
 .Q:$P(NODE,U,1)'=SC                  ;added SD/523
"RTN","SDC",48,0)
 .S ^DPT("ASDCN",SC,FR,DFN)=""
"RTN","SDC",49,0)
 .S SDSC=SC,SDTTM=FR,SDPL=I,TDH=DH,TMPD=CANREM D CANCEL^SDCNSLT S DH=TDH ;SD/478
"RTN","SDC",50,0)
 .I $D(^DPT(DFN,"S",FR,0)),$P(^(0),"^",2)'["C" S $P(^(0),"^",2)="C",$P(^(0),"^",12)=DUZ,$P(^(0),"^",14)=SDTIME,DH=DH+1,TDH=DH,DIE="^DPT(DFN,"_"""S"""_",",DR="17///^S X=CANREM",DA=FR D ^DIE S DH=TDH D MORE
"RTN","SDC",51,0)
 G C
"RTN","SDC",52,0)
 ;
"RTN","SDC",53,0)
B S X=SD D DOW^SDM0 S DOW=Y,SS=+$O(^SC(SC,"T"_Y,X)) I $D(^(SS,1)),^(1)]"" S DH=^(1),DO=X+1,DA(1)=SC
"RTN","SDC",54,0)
 Q
"RTN","SDC",55,0)
MORE I $D(^SC("ARAD",SC,FR,DFN)) S ^(DFN)="N"
"RTN","SDC",56,0)
 S SDIV=$S($P(^SC(SC,0),"^",15)]"":$P(^(0),"^",15),1:" 1"),SDV1=$S(SDIV:SDIV,1:+$O(^DG(40.8,0))) I $D(^DPT("ASDPSD","C",SDIV,SC,FR,DFN)) K ^(DFN)
"RTN","SDC",57,0)
 S SDH=DH,SDTTM=FR,SDSC=SC,SDPL=I,SDRT="D" D RT^SDUTL
"RTN","SDC",58,0)
 S DH=SDH K SDH D CK1,EVT
"RTN","SDC",59,0)
 K SD1,SDIV,SDPL,SDRT,SDSC,SDTTM,SDX Q
"RTN","SDC",60,0)
CK1 S SDX=0 F SD1=FR\1:0 S SD1=$O(^DPT(DFN,"S",SD1)) Q:'SD1!((SD1\1)'=(FR\1))  I $P(^(SD1,0),"^",2)'["C",$P(^(0),"^",2)'["N" S SDX=1 Q
"RTN","SDC",61,0)
 Q:SDX  F SD1=2,4 I $D(^SC("AAS",SD1,FR\1,DFN)) S SDX=1 Q
"RTN","SDC",62,0)
 Q:SDX  IF $D(^SCE(+$$EXAE^SDOE(DFN,FR\1,FR\1),0)) S SDX=1
"RTN","SDC",63,0)
 Q:SDX  K ^DPT("ASDPSD","B",SDIV,FR\1,DFN) Q
"RTN","SDC",64,0)
 ;
"RTN","SDC",65,0)
EVT ; -- separate tag if need to NEW vars
"RTN","SDC",66,0)
 ; -- cancel event
"RTN","SDC",67,0)
 N FR,I,SDTIME,DH,SC
"RTN","SDC",68,0)
 D CANCEL^SDAMEVT(.SDATA,DFN,SDTTM,SDSC,SDPL,0,SDCNHDL) K SDATA,SDCNHDL
"RTN","SDC",69,0)
 Q
"RTN","SDCLAS")
0^2^B18970304^B18871590
"RTN","SDCLAS",1,0)
SDCLAS ;ALB/TMP,MRY - Clinic Assignment List Extract ;12/23/92  11:42
"RTN","SDCLAS",2,0)
 ;;5.3;Scheduling;**63,243,517,523**;Aug 13, 1993;Build 6
"RTN","SDCLAS",3,0)
 ;SD/517 CORRECTED ALL $NEXT FUNCTIONAL COMMANDS
"RTN","SDCLAS",4,0)
 S DIV="" D DIV^SDUTL I $T D CALST^SDDIV Q:Y<0
"RTN","SDCLAS",5,0)
 S:'$D(DTIME) DTIME=300 I '$D(DT) D DT^SDUTL
"RTN","SDCLAS",6,0)
 S SDIFN="",SDI=0,DIC="^SC(",DIC(0)="EFMQ",DIC("S")="I $P(^(0),U,3)=""C"",'$G(^(""OOS"")),$S(DIV="""":1,$P(^(0),U,15)=DIV:1,1:0)" D SELECT^SDCLAS0 K DIC Q:X["^"
"RTN","SDCLAS",7,0)
 S Y=DT D DTS^SDUTL S SDTS=Y
"RTN","SDCLAS",8,0)
OPT2 W !!,"Select 'As of' Date: ",SDTS," // " R X:DTIME Q:X["^"  I X']"" S SDTS=DT G OVR
"RTN","SDCLAS",9,0)
 S %DT(0)=-DT,%DT="EPX" D ^%DT K %DT
"RTN","SDCLAS",10,0)
 I Y'>0 W !,*7,"A date must be entered here to get a 'snapshot' of the clinic's enrollment as of",!,"  this date.  Date can not be in future." G OPT2
"RTN","SDCLAS",11,0)
 S SDTS=+Y
"RTN","SDCLAS",12,0)
OVR I SDSRT="C",SDSAV']"",SDIFN'="ALL",$S('$D(^SC(SDIFN,"I")):0,+^("I")=0:0,+^("I")>SDTS:0,+$P(^("I"),"^",2)'>SDTS&(+$P(^("I"),"^",2)'=0):0,1:1) W !,"Clinic ",$S(SDTS=DT:"is",1:"was")," inactive" W:SDTS<DT " on date selected" G END^SDCLAS1
"RTN","SDCLAS",13,0)
 W !!,*7,"This needs to be printed at 132 columns"
"RTN","SDCLAS",14,0)
 S PGM="START^SDCLAS",VAR="SDIFN^SDSRT^DIV^SDTS^SDSAV^SDFAST",VAL=SDIFN_"^"_SDSRT_"^"_DIV_"^"_SDTS_"^"_SDSAV_"^"_SDFAST D ZIS^DGUTQ Q:POP
"RTN","SDCLAS",15,0)
START K ^UTILITY($J) S SDSTOP=$S(SDSRT="S":SDIFN,1:""),SD1="",U="^" U IO G:SDIFN="ALL"!(SDSRT="S")!(SDSAV]"") ALL
"RTN","SDCLAS",16,0)
ONE S ONE=1 D INIT F SDAPPT=SDTS:0 S SDAPPT=$O(^SC(SDIFN,"S",SDAPPT)) Q:SDAPPT'>0  D PT
"RTN","SDCLAS",17,0)
 D:'SDFAST AEB^SDCLAS0 G ^SDCLAS1
"RTN","SDCLAS",18,0)
ALL S ONE=0 I SDSAV']"" S SDIFN=0 F  S SDIFN=$O(^SC(SDIFN)) Q:'SDIFN  I $P(^(SDIFN,0),"^",3)="C" D APPT
"RTN","SDCLAS",19,0)
 I SDSAV]"" D APART S SDIFN=0 F  S SDIFN=$O(SDZ(SDIFN)) Q:'SDIFN  I $D(^SC(SDIFN,0)),$P(^(0),"^",3)="C" D APPT
"RTN","SDCLAS",20,0)
 G ^SDCLAS1
"RTN","SDCLAS",21,0)
APPT D CHECK I 'POP K ^UTILITY($J,"PAT",SDIFN) D INIT F SDAPPT=SDTS:0 S SDAPPT=$O(^SC(SDIFN,"S",SDAPPT)) D:SDAPPT>0 PT I SDAPPT'>0 D:'SDFAST AEB^SDCLAS0 Q
"RTN","SDCLAS",22,0)
 Q
"RTN","SDCLAS",23,0)
PT S SD=0 F  S SD=$O(^SC(SDIFN,"S",SDAPPT,1,SD)) Q:'SD  Q:'$D(^(SD,0))  S DFN=+^(0) D PT1
"RTN","SDCLAS",24,0)
 Q
"RTN","SDCLAS",25,0)
PT1 I '$D(^UTILITY($J,"PAT",SDIFN,DFN)),$D(^DPT(DFN,0)),$D(^("S",SDAPPT,0)),$P(^(0),"^",2)=""!($P(^(0),"^",2)="I"),$S('$D(^DPT(DFN,.35)):1,'^(.35):1,1:0) D S,EXT^SDCLAS0
"RTN","SDCLAS",26,0)
 Q
"RTN","SDCLAS",27,0)
S S Y(0)=^DPT(DFN,0),SDACT=1,SDENR=0 D SET1
"RTN","SDCLAS",28,0)
 S I=0 F  S I=$O(^DPT(DFN,"DE","B",SDIFN,I)) Q:'I  I $D(^DPT(DFN,"DE",I,0)) D EDENR Q:SDENR
"RTN","SDCLAS",29,0)
 S ^UTILITY($J,"PAT",SDIFN,DFN)="" S:'$D(Y(1))!('SDENR) Y(1)="" I '$D(^UTILITY($J,"PAT"," ",DFN)) D MT S ^UTILITY($J,"PAT"," ",DFN)=$P(Y(0),"^",9)_"^"_SDELIG_"^"_SDZIP_"^"_$P(Y(0),"^",3)_U_SDMT
"RTN","SDCLAS",30,0)
 Q
"RTN","SDCLAS",31,0)
EDENR K Y(1) S I1=0 F  S I1=$O(^DPT(DFN,"DE",I,1,I1)) Q:'I1  S X=$P(^(I1,0),"^"),X(1)=$P(^(0),"^",3) Q:X>SDTS  S:'X(1)!(X(1)>SDTS) Y(1)=^(0),SDENR=1 Q:SDENR
"RTN","SDCLAS",32,0)
 Q
"RTN","SDCLAS",33,0)
SET1 S SDELIG=$S($D(^DPT(DFN,.36)):$P(^(.36),"^",1),1:""),SDELIG=$S($D(^DIC(8,+SDELIG,0)):SDELIG,1:""),SDELIG(1)=$S(SDELIG]"":$P(^(0),"^",5),1:""),SDZIP=$S($D(^DPT(DFN,.11)):$P(^(.11),"^",6),1:"")
"RTN","SDCLAS",34,0)
 Q
"RTN","SDCLAS",35,0)
MT ;
"RTN","SDCLAS",36,0)
 S SDMT="*" Q:SDELIG(1)']""  I SDELIG(1)="N" S SDMT="N" Q
"RTN","SDCLAS",37,0)
 S SDMT=$$LST^DGMTU(DFN) I SDMT']"" S SDMT=$S(SDELIG'=6:"A",1:"X") Q
"RTN","SDCLAS",38,0)
 S:$P(SDMT,U,2)>SDTS SDMT=$$LST^DGMTU(DFN,SDTS)
"RTN","SDCLAS",39,0)
 I $P(SDMT,U,4)="P" S SDMT=$$PA^DGMTUTL($P(SDMT,U)),SDMT=$S('$D(SDMT):"U",SDMT="MT":"C",SDMT="GMT":"G",1:"U")
"RTN","SDCLAS",40,0)
 E  S SDMT=$P(SDMT,U,4)
"RTN","SDCLAS",41,0)
 I SDMT="" S SDMT="X"
"RTN","SDCLAS",42,0)
 I SDMT="P" S SDMT="C"
"RTN","SDCLAS",43,0)
 I SDMT="R" S SDMT="U"
"RTN","SDCLAS",44,0)
 I SDMT="N" S SDMT="A"
"RTN","SDCLAS",45,0)
 D DOM^SDOPC4(DFN,SDTS_.9,.SDMT) I SDMT="X0" S SDMT="X"
"RTN","SDCLAS",46,0)
 K SDMT1 Q
"RTN","SDCLAS",47,0)
CHECK S POP=0 I SDSRT="S",SDSTOP'="ALL",$P(^SC(SDIFN,0),"^",7)'=SDSTOP S POP=1 Q
"RTN","SDCLAS",48,0)
 I $S(DIV="":1,$P(^SC(SDIFN,0),"^",15)=DIV:1,1:0),$S('$D(^SC(SDIFN,"I")):1,+^("I")=0:1,+^("I")>DT:1,+$P(^("I"),"^",2)'>DT&(+$P(^("I"),"^",2)'=0):1,1:0) Q
"RTN","SDCLAS",49,0)
 S POP=1 Q
"RTN","SDCLAS",50,0)
APART S SDZ="" F I=1:1 Q:$P(SDSAV,",",I)']""  S SDZ=$P(SDSAV,",",I) D:SDZ["--" SPLIT^SDCLAS0 I SDZ'["--" S:'$D(SDZ(+SDZ)) SDZ(+SDZ)=""
"RTN","SDCLAS",51,0)
 Q
"RTN","SDCLAS",52,0)
INIT F I1="SDENR","SDACT" S I2="^UTILITY("_$J_","""_I1_""","_SDIFN_")",@I2=0
"RTN","SDCLAS",53,0)
 Q
"RTN","SDLT")
0^3^B15803609^B15272019
"RTN","SDLT",1,0)
SDLT ;ALB/LDB - CANCELLATION LETTERS ; 14 Feb 2003
"RTN","SDLT",2,0)
 ;;5.3;Scheduling;**185,213,281,330,398,523**;Aug 13, 1993;Build 6
"RTN","SDLT",3,0)
 ;
"RTN","SDLT",4,0)
 ;**************************************************************************
"RTN","SDLT",5,0)
 ;                          MODIFICATIONS
"RTN","SDLT",6,0)
 ;                          
"RTN","SDLT",7,0)
 ;   DATE      PATCH     DEVELOPER  DESCRIPTION OF CHANGES
"RTN","SDLT",8,0)
 ; --------  ----------  ---------  ----------------------------------------
"RTN","SDLT",9,0)
 ; 02/14/03  SD*5.3*281  SAUNDERS   Print letters to confidential address if
"RTN","SDLT",10,0)
 ;                                  requested
"RTN","SDLT",11,0)
 ; 12/2/03   SD*5.3*330  LUNDEN     Remove form feed from PRT+0
"RTN","SDLT",12,0)
 ;
"RTN","SDLT",13,0)
 ;**************************************************************************
"RTN","SDLT",14,0)
 ;
"RTN","SDLT",15,0)
 ;WRITE GREETING AND OPENING TEXT OF LETTER
"RTN","SDLT",16,0)
PRT S DFN=$P(A,U,1)  ;SD*523
"RTN","SDLT",17,0)
 I $D(SDNOSH) I $D(^DPT(DFN,.1)) S POP=1 Q:POP  ;SD/523
"RTN","SDLT",18,0)
 S Y=DT D DTS^SDUTL
"RTN","SDLT",19,0)
 I +$G(SDFIRST)=0 W @IOF ;SD*5.3*330 Form feed only after letter #1
"RTN","SDLT",20,0)
 K SDFIRST
"RTN","SDLT",21,0)
 ;S SDFIRST=0
"RTN","SDLT",22,0)
 W !,?65,Y,!,?65,$$LAST4(A),!!!!
"RTN","SDLT",23,0)
 I 'SDFORM W !!!!! D ADDR W !!!!
"RTN","SDLT",24,0)
W1 W !,"Dear ",$S($P(^DPT(+A,0),"^",2)="M":"Mr. ",1:"Ms. ")
"RTN","SDLT",25,0)
 N DPTNAME
"RTN","SDLT",26,0)
 S DPTNAME("FILE")=2,DPTNAME("FIELD")=".01",DPTNAME("IENS")=(+A)_","
"RTN","SDLT",27,0)
 S X=$$NAMEFMT^XLFNAME(.DPTNAME,"G","M") W X,","
"RTN","SDLT",28,0)
 W !! K ^UTILITY($J,"W"),DIWF,DIWR,DIWF S DIWL=1,DIWF="C80WN" F Z0=0:0 S Z0=$O(^VA(407.5,SDLET,1,Z0)) Q:Z0'>0  S X=^(Z0,0) D ^DIWP
"RTN","SDLT",29,0)
 D ^DIWW K ^UTILITY($J,"W") Q
"RTN","SDLT",30,0)
WRAPP ;WRITE APPOINTMENT INFORMATION
"RTN","SDLT",31,0)
 S:$D(SC)&'$D(SDC) SDC=SC S SDCL=$P(^SC(+SDC,0),"^",1),SDCL=SDCL_" Clinic" D FORM
"RTN","SDLT",32,0)
 S SDX1=$S($D(SDX):SDX,1:X) S:$D(SDS) S=SDS F B=3,4,5 I $P(S,"^",B)]"" S SDCL=$S(B=3:"LAB",B=4:"XRAY",1:"EKG"),SDX=$P(S,"^",B) D FORM
"RTN","SDLT",33,0)
 S (SDX,X)=SDX1 Q
"RTN","SDLT",34,0)
FORM S:$D(SDX) X=SDX S SDHX=X D DW^%DTC S DOW=X,X=SDHX X ^DD("FUNC",2,1) S SDT0=X,SDDAT=$P("JAN^FEB^MAR^APR^MAY^JUN^JUL^AUG^SEP^OCT^NOV^DEC","^",$E(SDHX,4,5))_" "_+$E(SDHX,6,7)_", "_(1700+$E(SDHX,1,3)) W !?4,DOW,?14,$J(SDDAT,12)
"RTN","SDLT",35,0)
 W ?27,$J(SDT0,8)," ",SDCL I $D(SDLT)&($Y>(IOSL-8)) W @IOF
"RTN","SDLT",36,0)
 Q
"RTN","SDLT",37,0)
REST ;WRITE THE REMAINDER OF LETTER
"RTN","SDLT",38,0)
 I SDLET W !?12 K ^UTILITY($J,"W"),DIWL,DIWR,DIWF S DIWL=1,DIWF="C80WN" F Z5=0:0 S Z5=$O(^VA(407.5,SDLET,2,Z5)) Q:Z5'>0  S X=^(Z5,0) D ^DIWP
"RTN","SDLT",39,0)
 D ^DIWW K ^UTILITY($J,"W") Q:'SDFORM
"RTN","SDLT",40,0)
 F I=$Y:1:IOSL-12 W !
"RTN","SDLT",41,0)
 D ADDR Q
"RTN","SDLT",42,0)
ADDR K VAHOW S DFN=+A W !?12,$$FML^DGNFUNC(DFN) S VAHOW=2
"RTN","SDLT",43,0)
 I $D(^DG(43,1,"BT")),'$P(^("BT"),"^",3) S VAPA("P")=""
"RTN","SDLT",44,0)
 S X1=DT,X2=5 D C^%DTC I '$D(VAPA("P")) S (VATEST("ADD",9),VATEST("ADD",10))=X
"RTN","SDLT",45,0)
 D ADD^VADPT D
"RTN","SDLT",46,0)
 .;CHANGE STATE TO ABBR.
"RTN","SDLT",47,0)
 .N SDIENS,X
"RTN","SDLT",48,0)
 .I $D(^UTILITY("VAPA",$J,5)) S SDIENS=+^UTILITY("VAPA",$J,5)_",",X=$$GET1^DIQ(5,SDIENS,1),$P(^UTILITY("VAPA",$J,5),U,2)=X
"RTN","SDLT",49,0)
 .K SDIENS Q
"RTN","SDLT",50,0)
 N SDCCACT1,SDCCACT2
"RTN","SDLT",51,0)
 S SDCCACT1=^UTILITY("VAPA",$J,12),SDCCACT2=$P($G(^UTILITY("VAPA",$J,22,2)),"^",3)
"RTN","SDLT",52,0)
 ;if confidential address is not active for scheduling/appointment letters, print to regular address
"RTN","SDLT",53,0)
 I ($G(SDCCACT1)=0)!($G(SDCCACT2)'="Y") D
"RTN","SDLT",54,0)
 .F LL=1:1:4 W:^UTILITY("VAPA",$J,LL)]"" !,?12,^UTILITY("VAPA",$J,LL)
"RTN","SDLT",55,0)
 .W:^UTILITY("VAPA",$J,4)']"" ! I ^UTILITY("VAPA",$J,5)]"" W ", ",$P(^UTILITY("VAPA",$J,5),"^",2)
"RTN","SDLT",56,0)
 .I ^UTILITY("VAPA",$J,11)]"" W "  ",$P(^UTILITY("VAPA",$J,11),U,2)
"RTN","SDLT",57,0)
 ;if confidential address is active for scheduling/appointment letters, print to confidential address
"RTN","SDLT",58,0)
 I $G(SDCCACT1)=1,$G(SDCCACT2)="Y" D
"RTN","SDLT",59,0)
 .F LL=13:1:16 W:^UTILITY("VAPA",$J,LL)]"" !,?12,^UTILITY("VAPA",$J,LL)
"RTN","SDLT",60,0)
 .W:^UTILITY("VAPA",$J,16)']"" ! I ^UTILITY("VAPA",$J,17)]"" W ", ",$P(^UTILITY("VAPA",$J,17),"^",2)
"RTN","SDLT",61,0)
 .I ^UTILITY("VAPA",$J,18)]"" W "  ",$P(^UTILITY("VAPA",$J,18),U,2)
"RTN","SDLT",62,0)
 W ! D KVAR^VADPT Q
"RTN","SDLT",63,0)
 ;
"RTN","SDLT",64,0)
 ;
"RTN","SDLT",65,0)
LAST4(DFN) ;Return patient "last four"
"RTN","SDLT",66,0)
 N SDX
"RTN","SDLT",67,0)
 S SDX=$G(^DPT(+DFN,0))
"RTN","SDLT",68,0)
 Q $E(SDX)_$E($P(SDX,U,9),6,9)
"RTN","SDLT",69,0)
 ;
"RTN","SDLT",70,0)
BADADD ;Print patients with a Bad Address Indicator
"RTN","SDLT",71,0)
 I '$D(^TMP($J,"BADADD")) Q
"RTN","SDLT",72,0)
 N SDHDR,SDHDR1
"RTN","SDLT",73,0)
 W @IOF,$TR($J("",IOM)," ","*")
"RTN","SDLT",74,0)
 S SDHDR="BAD ADDRESS INDICATOR LIST" W !,?(IOM-$L(SDHDR)/2),SDHDR,!
"RTN","SDLT",75,0)
 S SDHDR1="** THE LETTER FOR THESE PATIENT(S) DID NOT PRINT DUE TO A BAD ADDRESS INDICATOR."
"RTN","SDLT",76,0)
 W !,"Last 4",!,"of SSN",?10,"Patient Name",!
"RTN","SDLT",77,0)
 W $TR($J("",IOM)," ","*")
"RTN","SDLT",78,0)
 N SDNAM,SDDFN
"RTN","SDLT",79,0)
 S SDNAM="" F  S SDNAM=$O(^TMP($J,"BADADD",SDNAM)) Q:SDNAM=""  D
"RTN","SDLT",80,0)
 . S SDDFN=0 F  S SDDFN=$O(^TMP($J,"BADADD",SDNAM,SDDFN)) Q:'SDDFN  D
"RTN","SDLT",81,0)
 . . W !,$$LAST4(SDDFN),?10,SDNAM
"RTN","SDLT",82,0)
 W !!,SDHDR1
"RTN","SDLT",83,0)
 Q
"RTN","SDN1")
0^4^B21253578^B20640360
"RTN","SDN1",1,0)
SDN1 ;BSN/GRR - NO-SHOW LETTERS ; 17 AUG 84  4:34 pm
"RTN","SDN1",2,0)
 ;;5.3;Scheduling;**330,340,398,455,523**;Aug 13, 1993;Build 6
"RTN","SDN1",3,0)
 N SDBAD
"RTN","SDN1",4,0)
 I ANS["Y"&($D(C)) F A=0:0 S A=$O(^UTILITY($J,A)) Q:A'>0  F C=0:0 S C=$O(^(A,C)) Q:C'>0  S SC=+^(C),SDLET="" S:$D(^SC(SC,"LTR")) SDLET=+^("LTR") S:SDLET ^UTILITY($J,"SDLT",SDLET,A,C)=^UTILITY($J,A,C) S:'SDLET ^UTILITY($J,"NO",A,C)=SC D KLL
"RTN","SDN1",5,0)
 S SDFORM=$S($D(^DG(40.8,SDV1,"LTR")):^("LTR"),1:"") G:ANS["Y"&($D(C)) LST
"RTN","SDN1",6,0)
BC K:$D(SDLT) C S:$D(SDLT) SDT=SDBD,DATEND=SDED K ^UTILITY($J) I $D(C) K VAUTC S (VAUTC,VAUTC(C))=""
"RTN","SDN1",7,0)
 I $D(VAUTC),'VAUTC F C=0:0 S C=$O(VAUTC(C)) Q:C'>0  D:$D(SDLT) LT D CHECK1 I $T D OVER
"RTN","SDN1",8,0)
 I $D(VAUTC),'VAUTC G LST
"RTN","SDN1",9,0)
LST1 F C=0:0 S C=$O(^SC(C)) Q:C'>0  D LT,CHECK1 I $T,$S(SDV1="":1,SDV=SDV1:1,SDV="":1,1:0),'$D(SDVAUTC(+C)),$D(^SC(C,"S")) D OVER
"RTN","SDN1",10,0)
LST N SDFIRST S SDFIRST=1
"RTN","SDN1",11,0)
 F SDLET=0:0 S SDLET=$O(^UTILITY($J,"SDLT",SDLET)) Q:SDLET'>0  F A=0:0 S A=$O(^UTILITY($J,"SDLT",SDLET,A)) Q:A'>0  I $S('$D(^DPT(A,.35)):1,$P(^(.35),"^",1)']"":1,1:0) N POP S POP=0 D ^SDLT Q:POP  D WR  ;SD*523 added quit
"RTN","SDN1",12,0)
 I $D(^UTILITY($J,"NO")) W @IOF F A=0:0 S A=$O(^UTILITY($J,"NO",A)) Q:A'>0  F A1=0:0 S A1=$O(^(A,A1)) Q:A1'>0  Q:$$BADADR^DGUTL3(A)  W !,$P(^DPT(A,0),"^")," ",$P(^(0),"^",9)," has failed to keep the following appointment(s):" D NDT
"RTN","SDN1",13,0)
 W:$D(^UTILITY($J,"NO")) !,"However, there are no letters assigned to the clinic(s).",!!
"RTN","SDN1",14,0)
 I $D(^TMP($J,"BADADD")) D BADADD^SDLT K ^TMP($J,"BADADD")
"RTN","SDN1",15,0)
 G END
"RTN","SDN1",16,0)
OVER S GDATE=SDT Q:'$D(^SC(C,"S"))  F J=0:0 S GDATE=$O(^SC(C,"S",GDATE)) Q:GDATE=""!(GDATE>(DATEND+.9999))  F K=0:0 S K=$O(^SC(C,"S",GDATE,1,K)) Q:K=""  I $D(^(K,0)) S DFN=+^(0) D CHECK
"RTN","SDN1",17,0)
 Q
"RTN","SDN1",18,0)
END K %,%DT,%IS,A,A0,A1,A2,ALL,ALS,ANS,BY,C,CDATE,DA,DFN,DGPGM,DGVAR,DH,DHD,DIC,DIS,DIV,DIW,DIWF,DIWL,DIWR,DIWT,DO,DOW,DN,DUPE,FLDS,F,F1,FR,GDATE,I,I1,L,L0,LET,MAX,MESS,MIN,NOAP,P,POP,SC,SD,SDFOR,SDLET,SDTIME,SI,SL,SS,ST,SDSTRTDT,TO,X,Y,ADDR,B
"RTN","SDN1",19,0)
 K CLIN,HX,LL,PDAT,S,TIME,Z,D,NDATE,ENDATE,J,SDMDT,SDMSTIME,X1,X2,SDTADE,SDADTB,SDRE,SDRE1,SDIN,SDIS,SDYES,CNN,SDT,DATEND,SDV1,K,SDR,SDJ1,^UTILITY($J),SD1,SD2,SDADD,SDC,SDCL,SDCMAX,SDCONS,SDD,SDDAT,SDDIF,SDDT,SDED,SDFORM,SDHX,SDINP,SDIP
"RTN","SDN1",20,0)
 K %ZIS,Y1,SDBD,SDCT,SDVAUTC,VAUTC,SDX,SDX1,SDNOSH,SDLT1,SDMSG,SDNODE,SDQ,SDRT,SDSOH,SDSTAT,SDT0,SDZSC,SM,SM1,STARTDAY,STIME,SDV,Z0,Z5 D CLOSE^DGUTQ Q
"RTN","SDN1",21,0)
CHECK I $S('$D(^DPT(DFN,.35)):1,$P(^(.35),"^",1)']"":1,1:0),$D(^DPT(DFN,"S",GDATE,0)),$S($P(^(0),U,2)="N":1,$P(^(0),U,2)="NA":1,$D(SDCP)&$P(^(0),"^",2)["C":1,1:0),$P(^(0),"^",14)=SDTIME!(SDTIME="*"),'$D(^DPT(DFN,.1)) D
"RTN","SDN1",22,0)
 .D BAD Q:SDBAD
"RTN","SDN1",23,0)
 .D SET
"RTN","SDN1",24,0)
 Q  ;above logic changed SD*5.3*455
"RTN","SDN1",25,0)
SET I SDLT1!SDLET S ^UTILITY($J,"SDLT",$S(SDLT1:SDLT1,1:SDLET),DFN,GDATE)=C_"^"_$P(^DPT(DFN,"S",GDATE,0),"^",10) Q
"RTN","SDN1",26,0)
 S ^UTILITY($J,"NO",DFN,GDATE)=C Q
"RTN","SDN1",27,0)
CHECK1 S SDV=$P(^SC(C,0),"^",15) I $P(^(0),"^",3)="C",$S('$D(^SC(C,"I")):1,'(+^("I")):1,+^("I")>DATEND:1,+$P(^("I"),"^",2)'>DATEND&(+$P(^("I"),"^",2)):1,1:0)
"RTN","SDN1",28,0)
 Q
"RTN","SDN1",29,0)
WR K CNN F J=0:0 S J=$O(^UTILITY($J,"SDLT",SDLET,A,J)) Q:J=""  S SDR=0,SDX=J,CNN(J)=^(J),CLIN=$P(^SC(+$P(CNN(J),"^",1),0),"^",1),SDC=+CNN(J),S=$S($D(^DPT(A,"S",J,0)):^(0),1:"") D WRAPP^SDLT,SET1
"RTN","SDN1",30,0)
 D:SDR SDR D REST^SDLT Q
"RTN","SDN1",31,0)
SDR W !!,"The appointment(s) have been rescheduled as follows:",!
"RTN","SDN1",32,0)
 F J=0:0 S J=$O(CNN(J)) Q:J=""  S SDX=$P(CNN(J),"^",2),SDC=$P(CNN(J),"^") I SDX S S=$S($D(^DPT(A,"S",SDX,0)):^(0),1:"") D WRAPP^SDLT
"RTN","SDN1",33,0)
 Q
"RTN","SDN1",34,0)
SET1 S:'SDR SDR=$S($P(CNN(J),"^",2)]"":1,1:0) Q
"RTN","SDN1",35,0)
 Q
"RTN","SDN1",36,0)
LT S:'SDLT1 SDLET=0 I $D(^SC(C,"LTR")),^("LTR") S SDLET=+^("LTR")
"RTN","SDN1",37,0)
 Q
"RTN","SDN1",38,0)
NDT W !?15,$P(^SC(+^UTILITY($J,"NO",A,A1),0),"^")," on " S Y=A1 D DT^DIQ Q
"RTN","SDN1",39,0)
KLL K ^UTILITY($J,A,C) Q
"RTN","SDN1",40,0)
BAD S SDBAD=$$BADADR^DGUTL3(+DFN)
"RTN","SDN1",41,0)
 S:SDBAD ^TMP($J,"BADADD",$P(^DPT(+DFN,0),"^"),+DFN)=""
"RTN","SDN1",42,0)
 Q
"RTN","SDNOS0")
0^5^B28179889^B27834725
"RTN","SDNOS0",1,0)
SDNOS0 ;ALB/LDB - NO SHOW REPORT ; 07 May 99 10:21 AM
"RTN","SDNOS0",2,0)
 ;;5.3;Scheduling;**20,194,410,517,523**;Aug 13, 1993;Build 6
"RTN","SDNOS0",3,0)
 D END1^SDNOS
"RTN","SDNOS0",4,0)
 S (SDV1,SDIN,SDNM,SDNM1)=0,SDDIVO=SDDIV
"RTN","SDNOS0",5,0)
 I $D(^DG(43,1,"GL")),$P(^("GL"),U,2) S SDV1=1
"RTN","SDNOS0",6,0)
 I SDDIV'="A" S (^UTILITY($J,"SDNO",SDDIV,"***TOT***"),^UTILITY($J,"SDNO",SDDIV,"***N***","***TOT***"),^UTILITY($J,"SDNO",SDDIV,"***NA***","***TOT***"),^UTILITY($J,"SDNO",SDDIV,"***SDNMS***"))=0
"RTN","SDNOS0",7,0)
 I SDDIV="A" D DIVRPT
"RTN","SDNOS0",8,0)
 I SDCL(1)="ALL" S SDCL=0 D SDCL
"RTN","SDNOS0",9,0)
 I SDCL(1)'="ALL" F SDSUB=0:0 S SDSUB=$O(SDCL(SDSUB)) Q:SDSUB=""  S SDCL=SDCL(SDSUB),SDLAB=$S(SDCL?.N1"*".E:"RANGE",1:"SDTST") D @SDLAB
"RTN","SDNOS0",10,0)
 S (P1,SDTOT,SDTOT1)=0,DGTCH="NO-SHOW REPORT^CLINIC^PAGE#",(SDEND,SDHD)=0
"RTN","SDNOS0",11,0)
 D ^SDNOS1
"RTN","SDNOS0",12,0)
 Q
"RTN","SDNOS0",13,0)
 ;
"RTN","SDNOS0",14,0)
DIVRPT F SDDIV=0:0 S SDDIV=$O(^DG(40.8,SDDIV)) Q:'SDDIV  S (^UTILITY($J,"SDNO",SDDIV,"***N***","***TOT***"),^UTILITY($J,"SDNO",SDDIV,"***NA***","***TOT***"),^UTILITY($J,"SDNO",SDDIV,"***TOT***"),^UTILITY($J,"SDNO",SDDIV,"***SDNMS***"))=0
"RTN","SDNOS0",15,0)
 Q
"RTN","SDNOS0",16,0)
 ;
"RTN","SDNOS0",17,0)
SDCL F SDZ=1:1 S SDCL=$O(^SC(SDCL)) Q:'SDCL  D SDTST
"RTN","SDNOS0",18,0)
 Q
"RTN","SDNOS0",19,0)
 ;
"RTN","SDNOS0",20,0)
SDTST S SDNM=0,SDCL1=^SC(SDCL,0) I $P(SDCL1,U,3)'="C" Q
"RTN","SDNOS0",21,0)
 I SDDIVO,SDCL(1),'$D(SDR1) D DATES Q
"RTN","SDNOS0",22,0)
 I $S((SDDIVO&'SDCL(1)&(SDDIVO=$P(SDCL1,U,15))):1,'SDDIVO:1,$D(SDR1)&SDDIVO&($P(SDCL1,U,15)=SDDIVO):1,'$P(SDCL1,U,15)&(SDDIVO=$P(^DG(43,1,"GL"),U,3)):1,'SDV1:1,1:0) S SDIN=0 D:$D(^SC(SDCL,"I")) INAC^SDNOS1A Q:SDIN  D DATES
"RTN","SDNOS0",23,0)
 Q
"RTN","SDNOS0",24,0)
 ;
"RTN","SDNOS0",25,0)
DATES S:'SDDIVO SDDIV=$S($P(SDCL1,U,15)&SDV1:$P(SDCL1,U,15),$D(^DG(43,"GL")):$P(^("GL"),U,3),1:$O(^DG(40.8,0)))
"RTN","SDNOS0",26,0)
 Q:$D(^UTILITY($J,"SDNO",SDDIV,$P(SDCL1,U),"***TOT***"))  S ^UTILITY($J,"SDNO",SDDIV,$P(SDCL1,U),"***TOT***")=0,^UTILITY($J,"SDNO",SDDIV,$P(SDCL1,U),"***SDNMS***")=0
"RTN","SDNOS0",27,0)
 S (SDEN,SDBEG)=0,SDBEG1=SDBD F SDZ1=1:1 S SDBEG1=$O(^SC(SDCL,"S",SDBEG1)) Q:SDBEG1'>0  D SDED Q:SDBEG!SDEN  D CHK
"RTN","SDNOS0",28,0)
 S ^UTILITY($J,"SDNO",SDDIV,"***SDNMS***")=SDNM+^UTILITY($J,"SDNO",SDDIV,"***SDNMS***")
"RTN","SDNOS0",29,0)
 Q
"RTN","SDNOS0",30,0)
 ;
"RTN","SDNOS0",31,0)
SDED S SDBEG=0,SDEN=0 I $D(SDED),(SDBEG1>(SDED+.99999)) S SDEN=1 Q
"RTN","SDNOS0",32,0)
 I '$D(SDED),(SDBEG1>(SDBD+.99999)) S SDBEG=1 Q
"RTN","SDNOS0",33,0)
 Q
"RTN","SDNOS0",34,0)
 ;Added 2nd Quit below SD/517
"RTN","SDNOS0",35,0)
 ;SD/523 - added Q:SDPAT="" to For loop
"RTN","SDNOS0",36,0)
CHK S SDAPP=0 F  S SDAPP=$O(^SC(SDCL,"S",SDBEG1,1,SDAPP)) Q:'SDAPP  Q:'$D(^(SDAPP,0))  I $D(^SC(SDCL,"S",SDBEG1,1,SDAPP))=10,$P(^(SDAPP,0),U,9)'="C" S SDPAT=$P(^SC(SDCL,"S",SDBEG1,1,SDAPP,0),U,1) Q:SDPAT=""  I $D(^DPT(SDPAT,"S",SDBEG1)) D CHK1
"RTN","SDNOS0",37,0)
 Q
"RTN","SDNOS0",38,0)
 ;
"RTN","SDNOS0",39,0)
CHK1 S SD="SD" F SDCHK=1,2,10,12,14 S @(SD_SDCHK)=$P(^DPT(SDPAT,"S",SDBEG1,0),U,SDCHK)
"RTN","SDNOS0",40,0)
 S:'SDDIVO&$P(SDCL1,U,15) SDDIV=$P(SDCL1,U,15) S:'SDDIVO&'$P(SDCL1,U,15) SDDIV=$O(^DG(40.8,0))
"RTN","SDNOS0",41,0)
 S:'$D(^UTILITY($J,"SDNO",SDDIV,$P(SDCL1,U),"***TOT***")) ^UTILITY($J,"SDNO",SDDIV,$P(SDCL1,U),"***TOT***")=0
"RTN","SDNOS0",42,0)
 I SDFMT=1 D
"RTN","SDNOS0",43,0)
 .I (SD2="N")!(SD2="NA"),$$NOSHOW(SDPAT,SDBEG1,SDCL,$G(^DPT(SDPAT,"S",SDBEG1,0)),SDAPP) D 
"RTN","SDNOS0",44,0)
 ..D SET,TOTAL Q
"RTN","SDNOS0",45,0)
 I SDFMT=2 D
"RTN","SDNOS0",46,0)
 .I (SD2=""&('$D(^SC(SDCL,"S",SDBEG1,1,SDAPP,"C"))))!(SD2="N")!(SD2="NA")!(SD2="NT"),$$NOSHOW(SDPAT,SDBEG1,SDCL,$G(DPT(SDPAT,"S",SDBEG1,0)),SDAPP) D
"RTN","SDNOS0",47,0)
 ..D SET,TOTAL Q
"RTN","SDNOS0",48,0)
 I SD2'["C" S SDNM=SDNM+1,^UTILITY($J,"SDNO",SDDIV,$P(SDCL1,U),"***SDNMS***")=SDNM
"RTN","SDNOS0",49,0)
 Q
"RTN","SDNOS0",50,0)
 ;
"RTN","SDNOS0",51,0)
SET S:$P(SDCL1,U,15)&SDDIVO&SDV1 SDDIV=$P(SDCL1,U,15) S ^UTILITY($J,"SDNO",SDDIV,$P(SDCL1,U),SDBEG1,$P(^DPT(SDPAT,0),U),+$P(^(0),U,9))=SD2_U_SD10_U_SD12
"RTN","SDNOS0",52,0)
 Q
"RTN","SDNOS0",53,0)
 ;
"RTN","SDNOS0",54,0)
TOTAL S ^UTILITY($J,"SDNO",SDDIV,$P(SDCL1,U),"***"_SD2_"***","***TOT***")=$S($D(^UTILITY($J,"SDNO",SDDIV,$P(SDCL1,U),"***"_SD2_"***","***TOT***")):^UTILITY($J,"SDNO",SDDIV,$P(SDCL1,U),"***"_SD2_"***","***TOT***")+1,1:1)
"RTN","SDNOS0",55,0)
 S ^UTILITY($J,"SDNO",SDDIV,$P(SDCL1,U),$P(SDBEG1,"."),"***"_SD2_"***","***TOT***")=$S($D(^UTILITY($J,"SDNO",SDDIV,$P(SDCL1,U),$P(SDBEG1,"."),"***"_SD2_"***","***TOT***")):^("***TOT***")+1,1:1)
"RTN","SDNOS0",56,0)
 S ^UTILITY($J,"SDNO",SDDIV,$P(SDCL1,U),"***TOT***")=$S($D(^UTILITY($J,"SDNO",SDDIV,$P(SDCL1,U),"***TOT***")):^UTILITY($J,"SDNO",SDDIV,$P(SDCL1,U),"***TOT***")+1,1:1)
"RTN","SDNOS0",57,0)
 S ^("***TOT***")=^UTILITY($J,"SDNO",SDDIV,"***TOT***")+1,^("***TOT***")=$S($D(^UTILITY($J,"SDNO",SDDIV,"***"_SD2_"***","***TOT***")):^UTILITY($J,"SDNO",SDDIV,"***"_SD2_"***","***TOT***")+1,1:1)
"RTN","SDNOS0",58,0)
 Q
"RTN","SDNOS0",59,0)
 ;
"RTN","SDNOS0",60,0)
RANGE S SDREST=$E(SDCL,$F(SDCL,"*"),$L(SDCL)),SDCL=$E(SDCL,1,($F(SDCL,"*")-2)),SDCL1=^SC(SDCL,0)
"RTN","SDNOS0",61,0)
 S:'SDDIVO SDDIV=$S($P(SDCL1,U,15):$P(SDCL1,U,15),'$P(SDCL1,U,15)&$D(^DG(43,"GL")):$P(^DG(43,"GL"),U,3),1:$O(^DG(40.8,0)))
"RTN","SDNOS0",62,0)
 S SDR1=1,SDR=$P(SDCL1,U) D SDTST K SDR1
"RTN","SDNOS0",63,0)
 S SDREST="1"_""""_SDREST_""""_".E" F SDCXX=1:1 S SDR=$O(^SC("B",SDR)) Q:'(SDR?@SDREST)!(SDR="")  S SDCL=$O(^SC("B",SDR,-1)) S SDR1=1 D RANGE1 K SDR1
"RTN","SDNOS0",64,0)
 Q
"RTN","SDNOS0",65,0)
 ;
"RTN","SDNOS0",66,0)
RANGE1 S:'SDDIVO SDDIV=$S($P(SDCL1,U,15):$P(SDCL1,U,15),'$P(SDCL1,U,15)&$D(^DG(43,"GL")):$P(^DG(43,"GL"),U,3),1:$O(^DG(40.8,0))) D SDTST
"RTN","SDNOS0",67,0)
 Q
"RTN","SDNOS0",68,0)
 ;
"RTN","SDNOS0",69,0)
NOSHOW(DFN,SDT,CIFN,PAT,DA) ;Input:  DFN=Patient IFN, SDT=Appointment D/T
"RTN","SDNOS0",70,0)
 ;  CIFN=Clinic IFN, PAT=Zero node of pat. appt., DA=Clinic appt. IFN
"RTN","SDNOS0",71,0)
 ;                        Output:  1 or 0 for noshow yes/no
"RTN","SDNOS0",72,0)
 N NSQUERY,NS S NS=1,NSQUERY=$$STATUS^SDAM1(DFN,SDT,CIFN,PAT,DA)
"RTN","SDNOS0",73,0)
 I $P(NSQUERY,";",3)["ACTION REQ" S NS=0
"RTN","SDNOS0",74,0)
NOSHOWQ Q NS
"VER")
8.0^22.0
"BLD",7488,6)
^432
**END**
**END**
