Released SD*5.3*107 SEQ #104
Extracted from mail message
**KIDS**:SD*5.3*107^

**INSTALL NAME**
SD*5.3*107
"BLD",157,0)
SD*5.3*107^SCHEDULING^0^2970313^n
"BLD",157,1,0)
^^2^2^2970317^^
"BLD",157,1,1,0)
Fixes a problem with PCMM team name changes not correctly updating
"BLD",157,1,2,0)
SC("TEAM" xref in file 44.  See NPM for complete description.
"BLD",157,4,0)
^9.64PA^404.51^1
"BLD",157,4,404.51,0)
404.51
"BLD",157,4,404.51,2,0)
^9.641^404.51^1
"BLD",157,4,404.51,2,404.51,0)
TEAM  (File-top level)
"BLD",157,4,404.51,2,404.51,1,0)
^9.6411^.01^1
"BLD",157,4,404.51,2,404.51,1,.01,0)
NAME
"BLD",157,4,404.51,222)
y^n^p^^^^n
"BLD",157,4,"APDD",404.51,404.51)

"BLD",157,4,"APDD",404.51,404.51,.01)

"BLD",157,4,"B",404.51,404.51)

"BLD",157,"INIT")
SD53107P
"BLD",157,"KRN",0)
^9.67PA^19^18
"BLD",157,"KRN",.4,0)
.4
"BLD",157,"KRN",.401,0)
.401
"BLD",157,"KRN",.402,0)
.402
"BLD",157,"KRN",.403,0)
.403
"BLD",157,"KRN",.5,0)
.5
"BLD",157,"KRN",.84,0)
.84
"BLD",157,"KRN",3.6,0)
3.6
"BLD",157,"KRN",3.8,0)
3.8
"BLD",157,"KRN",9.2,0)
9.2
"BLD",157,"KRN",9.8,0)
9.8
"BLD",157,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",157,"KRN",9.8,"NM",1,0)
SCMCDD1^^0^B22709019
"BLD",157,"KRN",9.8,"NM",2,0)
SCMCDD2^^0^B3853753
"BLD",157,"KRN",9.8,"NM","B","SCMCDD1",1)

"BLD",157,"KRN",9.8,"NM","B","SCMCDD2",2)

"BLD",157,"KRN",19,0)
19
"BLD",157,"KRN",19.1,0)
19.1
"BLD",157,"KRN",101,0)
101
"BLD",157,"KRN",409.61,0)
409.61
"BLD",157,"KRN",771,0)
771
"BLD",157,"KRN",869.2,0)
869.2
"BLD",157,"KRN",870,0)
870
"BLD",157,"KRN",8994,0)
8994
"BLD",157,"KRN","B",.4,.4)

"BLD",157,"KRN","B",.401,.401)

"BLD",157,"KRN","B",.402,.402)

"BLD",157,"KRN","B",.403,.403)

"BLD",157,"KRN","B",.5,.5)

"BLD",157,"KRN","B",.84,.84)

"BLD",157,"KRN","B",3.6,3.6)

"BLD",157,"KRN","B",3.8,3.8)

"BLD",157,"KRN","B",9.2,9.2)

"BLD",157,"KRN","B",9.8,9.8)

"BLD",157,"KRN","B",19,19)

"BLD",157,"KRN","B",19.1,19.1)

"BLD",157,"KRN","B",101,101)

"BLD",157,"KRN","B",409.61,409.61)

"BLD",157,"KRN","B",771,771)

"BLD",157,"KRN","B",869.2,869.2)

"BLD",157,"KRN","B",870,870)

"BLD",157,"KRN","B",8994,8994)

"BLD",157,"QUES",0)
^9.62^^
"BLD",157,"REQB",0)
^9.611^2^2
"BLD",157,"REQB",1,0)
SD*5.3*41^1
"BLD",157,"REQB",2,0)
SD*5.3*89^1
"BLD",157,"REQB","B","SD*5.3*41",1)

"BLD",157,"REQB","B","SD*5.3*89",2)

"FIA",404.51)
TEAM
"FIA",404.51,0)
^SCTM(404.51,
"FIA",404.51,0,0)
404.51
"FIA",404.51,0,1)
y^n^p^^^^n
"FIA",404.51,0,10)

"FIA",404.51,0,11)

"FIA",404.51,0,"RLRO")

"FIA",404.51,0,"VR")
5.3^SD
"FIA",404.51,404.51)
1
"FIA",404.51,404.51,.01)

"INIT")
SD53107P
"OER",16,0)
16^SD^^M.A.S.^
"OER",16,1,0)
^100.9951PA^2^2
"OER",16,1,1,0)
103
"OER",16,1,1,1,0)
^100.99511PA^1^1
"OER",16,1,1,1,1,0)
101
"OER",16,1,2,0)
645
"OER",16,1,2,1,0)
^100.99511PA^1^1
"OER",16,1,2,1,1,0)
121
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2941102
"PKG",16,22,1,"PAH",1,0)
107^2970313^70
"PKG",16,22,1,"PAH",1,1,0)
^^2^2^2970514
"PKG",16,22,1,"PAH",1,1,1,0)
Fixes a problem with PCMM team name changes not correctly updating
"PKG",16,22,1,"PAH",1,1,2,0)
SC("TEAM" xref in file 44.  See NPM for complete description.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","SCMCDD1")
0^1^B22709019
"RTN","SCMCDD1",1,0)
SCMCDD1 ;ALB/REW - DD Calls used by PCMM ; 6 November 1995
"RTN","SCMCDD1",2,0)
 ;;5.3;Scheduling;**41,89,107**;AUG 13, 1993
"RTN","SCMCDD1",3,0)
 ;1
"RTN","SCMCDD1",4,0)
WRITETP(SCTP) ;used by write node of 404.57
"RTN","SCMCDD1",5,0)
 N SCCL
"RTN","SCMCDD1",6,0)
 S SCCL=$P($G(^SCTM(404.57,+$G(SCTP),0)),U,9)
"RTN","SCMCDD1",7,0)
 Q $P($$GETPRTP^SCAPMCU2(SCTP,DT),U,2)_"  "_$P($G(^SC(+$G(SCCL),0)),U,1)
"RTN","SCMCDD1",8,0)
 ;
"RTN","SCMCDD1",9,0)
SETPTTM(SCPTTMA) ;delete
"RTN","SCMCDD1",10,0)
 Q
"RTN","SCMCDD1",11,0)
 ;
"RTN","SCMCDD1",12,0)
KILLPTTM(SCPTTMA) ;delete
"RTN","SCMCDD1",13,0)
 Q
"RTN","SCMCDD1",14,0)
 ;
"RTN","SCMCDD1",15,0)
AFTERTM(SCPTTM) ;called after update of 404.42
"RTN","SCMCDD1",16,0)
 N SCPTTMB4,SCPCTMB4,SCTMB4,SCTMNDB4,SCPTTMAF,SCPCTMAF,SCTMAF,X,SCFLD,SCX,SCTMNDAF,SCTMNMB4,Y
"RTN","SCMCDD1",17,0)
 Q:'$G(SCPTTM)
"RTN","SCMCDD1",18,0)
 S SCPTTMAF=$G(^SCPT(404.42,SCPTTM,0))
"RTN","SCMCDD1",19,0)
 S SCPCTMAF=$S(($P(SCPTTMAF,U,8)=1):1,1:0)
"RTN","SCMCDD1",20,0)
 S SCTMAF=$P(SCPTTMAF,U,3)
"RTN","SCMCDD1",21,0)
 S:SCTMAF SCTMNDAF=$G(^SCTM(404.51,SCTMAF,0))
"RTN","SCMCDD1",22,0)
 F X="SCPTTMB4","SCPCTMB4","SCTMB4","SCTMNMB4" S @X=$G(^TMP($J,"SCTMCHG",SCPTTM,X))
"RTN","SCMCDD1",23,0)
 F SCFLD=1:1:14 S SCX=$P(SCPTTMAF,U,SCFLD) S:SCX'="" ^TMP($J,"SCTMCHG",SCPTTM,"AF",(SCFLD*.01))=SCX
"RTN","SCMCDD1",24,0)
 S X=+$O(^ORD(101,"B","SCMC PATIENT TEAM CHANGES",0))_";ORD(101,"
"RTN","SCMCDD1",25,0)
 D:SCPTTMAF'=SCPTTMB4 EN^XQOR
"RTN","SCMCDD1",26,0)
 K ^TMP($J,"SCTMCHG",SCPTTM)
"RTN","SCMCDD1",27,0)
 Q
"RTN","SCMCDD1",28,0)
 ;
"RTN","SCMCDD1",29,0)
BEFORETM(SCPTTM) ;called before update of 404.42
"RTN","SCMCDD1",30,0)
 N SCPTTMB4,SCPCTMB4,SCTMB4,SCTMNDB4,X,SCFLD,SCX,SCY,DR,DIC,DA,DIQ
"RTN","SCMCDD1",31,0)
 Q:'$G(SCPTTM)
"RTN","SCMCDD1",32,0)
 S SCPTTMB4=$G(^SCPT(404.42,SCPTTM,0))
"RTN","SCMCDD1",33,0)
 S SCPCTMB4=$S(($P(SCPTTMB4,U,8)=1):1,1:0)
"RTN","SCMCDD1",34,0)
 S SCTMB4=$P(SCPTTMB4,U,3)
"RTN","SCMCDD1",35,0)
 S:SCTMB4 SCTMNDB4=$G(^SCTM(404.51,SCTMB4,0))
"RTN","SCMCDD1",36,0)
 F X="SCPTTMB4","SCPCTMB4","SCTMB4","SCTMNDB4" S ^TMP($J,"SCTMCHG",SCPTTM,X)=$G(@X)
"RTN","SCMCDD1",37,0)
 F SCY=1:1:14 S SCX=$P(SCPTTMB4,U,SCY) IF SCX'="" D
"RTN","SCMCDD1",38,0)
 .S SCFLD=SCY*.01
"RTN","SCMCDD1",39,0)
 .S ^TMP($J,"SCTMCHG",SCPTTM,"B4",SCFLD)=SCX
"RTN","SCMCDD1",40,0)
 Q
"RTN","SCMCDD1",41,0)
 ;
"RTN","SCMCDD1",42,0)
SETPC(SC1,SC2,SC3,SC4,DA)  ;APCPOS xref for 404.43
"RTN","SCMCDD1",43,0)
 ;DFN = Pointer to Patient File
"RTN","SCMCDD1",44,0)
 ;SC1 = pointer to 404.42
"RTN","SCMCDD1",45,0)
 ;SC2 = ROLE (1=pc practitioner,2=pc attending)
"RTN","SCMCDD1",46,0)
 ;SC3 = Activation Date
"RTN","SCMCDD1",47,0)
 ;SC4 = Team Position
"RTN","SCMCDD1",48,0)
 N DFN
"RTN","SCMCDD1",49,0)
 S DFN=$P($G(^SCPT(404.42,SC1,0)),U,1)
"RTN","SCMCDD1",50,0)
 S:DFN&SC1&SC2&SC3&SC4&DA ^SCPT(404.43,"APCPOS",DFN,SC2,SC3,SC4,DA)=""
"RTN","SCMCDD1",51,0)
 Q
"RTN","SCMCDD1",52,0)
KILLPC(SC1,SC2,SC3,SC4,DA) ;APCPOS xref for 404.43
"RTN","SCMCDD1",53,0)
 ;DFN = Pointer to Patient File
"RTN","SCMCDD1",54,0)
 ;SC1 = pointer to 404.42
"RTN","SCMCDD1",55,0)
 ;SC2 = ROLE (1=pc practitioner,2=pc attending)
"RTN","SCMCDD1",56,0)
 ;SC3 = Activation Date
"RTN","SCMCDD1",57,0)
 ;SC4 = Team Position
"RTN","SCMCDD1",58,0)
 N DFN
"RTN","SCMCDD1",59,0)
 S DFN=$P($G(^SCPT(404.42,SC1,0)),U,1)
"RTN","SCMCDD1",60,0)
 K:DFN&SC1&SC2&SC3&SC4&DA ^SCPT(404.43,"APCPOS",DFN,SC2,SC3,SC4,DA)
"RTN","SCMCDD1",61,0)
 Q
"RTN","SCMCDD1",62,0)
 ;
"RTN","SCMCDD1",63,0)
MAKEMANY(DFNA,SCOLDASS,SCBADASS,SCNEWASS) ;Not supported for use by PCMM Only - sets PC field to YES
"RTN","SCMCDD1",64,0)
 ;   DFNA    - DFN ARRAY
"RTN","SCMCDD1",65,0)
 ;   SCOLDASS - Subset of DFNA that were previously assigned
"RTN","SCMCDD1",66,0)
 ;   SCBADASS - Subset of DFNA that could not be assigned
"RTN","SCMCDD1",67,0)
 ;   SCNEWASS - Subset of DFNA that were newly assigned
"RTN","SCMCDD1",68,0)
 ;   Returned: total^new^old^bad
"RTN","SCMCDD1",69,0)
 ; Note: No input error checking!!
"RTN","SCMCDD1",70,0)
 N DFN,SCX,SCOUTFLD,SCBADOUT,SCOLDCNT,SCBADCNT,SCNEWCNT
"RTN","SCMCDD1",71,0)
 S (SCBADCNT,SCOLDCNT,SCNEWCNT)=0
"RTN","SCMCDD1",72,0)
 S DFN=0
"RTN","SCMCDD1",73,0)
 F  S DFN=$O(@DFNA@(DFN)) Q:'DFN  D
"RTN","SCMCDD1",74,0)
 .S SCOUTFLD(.04)=1
"RTN","SCMCDD1",75,0)
 .S SCX=$$ACOUTPT^SCAPMC20(DFN,"SCOUTFLD","SCBADOUT")
"RTN","SCMCDD1",76,0)
 .;SCX=OK?^p404.41^new?
"RTN","SCMCDD1",77,0)
 .IF 'SCX D
"RTN","SCMCDD1",78,0)
 ..S SCBADCNT=SCBADCNT+1
"RTN","SCMCDD1",79,0)
 ..S @SCBADASS@(DFN)=""
"RTN","SCMCDD1",80,0)
 .ELSE  D
"RTN","SCMCDD1",81,0)
 ..IF $P(SCX,U,3) D
"RTN","SCMCDD1",82,0)
 ...S SCNEWCNT=SCNEWCNT+1
"RTN","SCMCDD1",83,0)
 ...S @SCNEWASS@(DFN)=""
"RTN","SCMCDD1",84,0)
 ..ELSE  D
"RTN","SCMCDD1",85,0)
 ...S SCOLDCNT=SCOLDCNT+1
"RTN","SCMCDD1",86,0)
 ...S @SCOLDASS@(DFN)=""
"RTN","SCMCDD1",87,0)
 Q (SCOLDCNT+SCNEWCNT)_U_SCNEWCNT_U_SCOLDCNT_U_SCBADCNT
"RTN","SCMCDD1",88,0)
 ;
"RTN","SCMCDD1",89,0)
MAKEOUT(DA) ;used by 404.42 to create an outpatient profile entry (if there wasn't one) and set the PRIMARY CARE?(.04) field to YES
"RTN","SCMCDD1",90,0)
 ;  Returned (for de-bugging): ok?^ien of404.41^new?
"RTN","SCMCDD1",91,0)
 N SCNODE,SCX,DFN,SCOUTFLD
"RTN","SCMCDD1",92,0)
 S SCNODE=$G(^SCPT(404.42,+$G(DA),0))
"RTN","SCMCDD1",93,0)
 S DFN=$P(SCNODE,U,1)
"RTN","SCMCDD1",94,0)
 IF $P(SCNODE,U,8)=1 D  ;if assignment was to primary care
"RTN","SCMCDD1",95,0)
 .S SCOUTFLD(.04)=1
"RTN","SCMCDD1",96,0)
 .S SCX=$$ACOUTPT^SCAPMC20(DFN,"SCOUTFLD","SCBADOUT")
"RTN","SCMCDD1",97,0)
 Q $G(SCX)
"RTN","SCMCDD1",98,0)
 ;
"RTN","SCMCDD1",99,0)
AFTERTP(SCPTTP) ;called after update of 404.43
"RTN","SCMCDD1",100,0)
 N SCPTTPB4,SCPCTPB4,SCTPB4,SCTPNDB4,SCPTTPAF,SCPCTPAF,SCTPAF,X,SCFLD,SCX,SCTMB4,SCTMNDB4,SCTMNDAF,SCTMAF,SCPTNM,SCTPNDAF,SCTPNMB4,Y
"RTN","SCMCDD1",101,0)
 Q:'$G(SCPTTP)
"RTN","SCMCDD1",102,0)
 S SCPTTPAF=$G(^SCPT(404.43,SCPTTP,0))
"RTN","SCMCDD1",103,0)
 S SCPCTPAF=+$P(SCPTTPAF,U,5)
"RTN","SCMCDD1",104,0)
 S SCTPAF=$P(SCPTTPAF,U,2)
"RTN","SCMCDD1",105,0)
 S:SCTPAF SCTPNDAF=$G(^SCTM(404.57,SCTPAF,0))
"RTN","SCMCDD1",106,0)
 S:SCTPAF SCTMAF=$P(SCTPNDAF,U,2)
"RTN","SCMCDD1",107,0)
 S:SCTMAF SCTMNDAF=$G(^SCTM(404.51,SCTMAF,0))
"RTN","SCMCDD1",108,0)
 F X="SCPTTPB4","SCPCTPB4","SCTPB4","SCTPNMB4","SCTMB4","SCTMNDB4" S @X=$G(^TMP($J,"SCTPCHG",SCPTTP,X))
"RTN","SCMCDD1",109,0)
 F SCFLD=1:1:9 S SCX=$P(SCPTTPAF,U,SCFLD) S:SCX'="" ^TMP($J,"SCTPCHG",SCPTTP,"AF",(SCFLD*.01))=SCX
"RTN","SCMCDD1",110,0)
 S X=+$O(^ORD(101,"B","SCMC PATIENT TEAM POSITION CHANGES",0))_";ORD(101,"
"RTN","SCMCDD1",111,0)
 D:SCPTTPAF'=SCPTTPB4 EN^XQOR
"RTN","SCMCDD1",112,0)
 K ^TMP($J,"SCTPCHG",SCPTTP)
"RTN","SCMCDD1",113,0)
 Q
"RTN","SCMCDD1",114,0)
 ;
"RTN","SCMCDD1",115,0)
BEFORETP(SCPTTP) ;called before update of 404.43
"RTN","SCMCDD1",116,0)
 N SCPTTPB4,SCPCTPB4,SCTPB4,SCTPNDB4,X,SCFLD,SCX,SCY,DR,DIC,DA,DIQ,SCTMB4,SCTMNDAF,SCTMNDB4,SCTMNMB4
"RTN","SCMCDD1",117,0)
 Q:'$G(SCPTTP)
"RTN","SCMCDD1",118,0)
 S SCPTTPB4=$G(^SCPT(404.43,SCPTTP,0))
"RTN","SCMCDD1",119,0)
 Q:'SCPTTPB4
"RTN","SCMCDD1",120,0)
 S SCPCTPB4=+$P(SCPTTPB4,U,5)
"RTN","SCMCDD1",121,0)
 S SCTPB4=$P(SCPTTPB4,U,2)
"RTN","SCMCDD1",122,0)
 S:SCTPB4 SCTPNDB4=$G(^SCTM(404.57,SCTPB4,0))
"RTN","SCMCDD1",123,0)
 S:SCTPB4 SCTMB4=$P(SCTPNDB4,U,2)
"RTN","SCMCDD1",124,0)
 S:SCTMB4 SCTMNDB4=$G(^SCTM(404.51,SCTMB4,0))
"RTN","SCMCDD1",125,0)
 F X="SCPTTPB4","SCPCTPB4","SCTPB4","SCTPNDB4","SCTMNDB4","SCTMB4" S ^TMP($J,"SCTPCHG",SCPTTP,X)=$G(@X)
"RTN","SCMCDD1",126,0)
 F SCY=1:1:9 S SCX=$P(SCPTTPB4,U,SCY) IF SCX'="" D
"RTN","SCMCDD1",127,0)
 .S SCFLD=SCY*.01
"RTN","SCMCDD1",128,0)
 .S ^TMP($J,"SCTPCHG",SCPTTP,"B4",SCFLD)=SCX
"RTN","SCMCDD1",129,0)
 Q
"RTN","SCMCDD2")
0^2^B3853753
"RTN","SCMCDD2",1,0)
SCMCDD2 ;ALB/REW - DD Calls used by PCMM ; 27 March 1996
"RTN","SCMCDD2",2,0)
 ;;5.3;Scheduling;**41,107**;AUG 13, 1993
"RTN","SCMCDD2",3,0)
 ;1
"RTN","SCMCDD2",4,0)
USEPCDEF(SCCL) ;how should pc practitioner be used for clinic
"RTN","SCMCDD2",5,0)
 ; return 2=always default 1=default if no provider listed 0 -never
"RTN","SCMCDD2",6,0)
 Q 2
"RTN","SCMCDD2",7,0)
SETSCTM(SCTP,SCCL,SCTMNM) ;create 'TEAM' x-ref for Hospital Location File (#44)
"RTN","SCMCDD2",8,0)
 ; x=sccl, da=sctp sctmnm=name of team
"RTN","SCMCDD2",9,0)
 Q:'$G(SCTP)!('$G(SCCL))
"RTN","SCMCDD2",10,0)
 S SCTMNM=$G(SCTMNM,$P(^SCTM(404.51,+$P(^SCTM(404.57,SCTP,0),U,2),0),U))
"RTN","SCMCDD2",11,0)
 S:$L(SCTMNM) ^SC("TEAM",SCTMNM,+SCCL)=""
"RTN","SCMCDD2",12,0)
 Q
"RTN","SCMCDD2",13,0)
 ;
"RTN","SCMCDD2",14,0)
KILLSCTM(SCTP,SCCL,SCTMNM) ;kill 'TEAM' x-ref for File #44 (if no other positions from team have this as associated clinic)
"RTN","SCMCDD2",15,0)
 ; x=sccl, da=sctp sctmnm=name of team
"RTN","SCMCDD2",16,0)
 N SCTM
"RTN","SCMCDD2",17,0)
 Q:'$G(SCTP)!('$G(SCCL))
"RTN","SCMCDD2",18,0)
 S SCTM=+$P(^SCTM(404.57,SCTP,0),U,2)
"RTN","SCMCDD2",19,0)
 S SCTMNM=$G(SCTMNM,$P(^SCTM(404.51,+SCTM,0),U))
"RTN","SCMCDD2",20,0)
 K:$L(SCTMNM)&('$$OKTMCL(SCTM,SCTP,SCCL)) ^SC("TEAM",SCTMNM,+SCCL)
"RTN","SCMCDD2",21,0)
 Q
"RTN","SCMCDD2",22,0)
OKTMCL(SCTM,SCTP,SCCL) ;does team have another position with this clinic as an assoicated clinic?
"RTN","SCMCDD2",23,0)
 N SCXTP,SCOK
"RTN","SCMCDD2",24,0)
 S SCOK=0
"RTN","SCMCDD2",25,0)
 S SCXTP=0
"RTN","SCMCDD2",26,0)
 F  S SCXTP=$O(^SCTM(404.57,"D",SCCL,SCXTP)) Q:('SCXTP)!(SCXTP=SCTP)  D
"RTN","SCMCDD2",27,0)
 .I $P(^SCTM(404.57,SCXTP,0),U,2)'=SCTM Q
"RTN","SCMCDD2",28,0)
 .S SCOK=1
"RTN","SCMCDD2",29,0)
 Q SCOK
"RTN","SCMCDD2",30,0)
STSCTMNM(SCTM,SCTMNM) ;if team name changes - set for 'TEAM' xrefs for file#44
"RTN","SCMCDD2",31,0)
 ; sctm=da sctmnm=x
"RTN","SCMCDD2",32,0)
 Q:'$G(SCTM)!(SCTMNM="")
"RTN","SCMCDD2",33,0)
 N SCTPNM,SCCL
"RTN","SCMCDD2",34,0)
 S SCTPNM=""
"RTN","SCMCDD2",35,0)
 F  S SCTPNM=$O(^SCTM(404.57,"ATMPOS",SCTM,SCTPNM)) Q:SCTPNM=""  D
"RTN","SCMCDD2",36,0)
 .S SCTP=$O(^SCTM(404.57,"ATMPOS",SCTM,SCTPNM,0)) ;note: name is unique
"RTN","SCMCDD2",37,0)
 .S SCCL=$P($G(^SCTM(404.57,+SCTP,0)),U,9)
"RTN","SCMCDD2",38,0)
 .D:SCCL SETSCTM(SCTP,SCCL,SCTMNM)
"RTN","SCMCDD2",39,0)
 Q
"RTN","SCMCDD2",40,0)
KLSCTMNM(SCTM,SCTMNM) ;if team name changes - kill 'TEAM' xrefs for file #44
"RTN","SCMCDD2",41,0)
 ; sctm=da sctmnm=x
"RTN","SCMCDD2",42,0)
 Q:'$G(SCTM)!(SCTMNM="")
"RTN","SCMCDD2",43,0)
 N SCTPNM,SCCL
"RTN","SCMCDD2",44,0)
 S SCTPNM=""
"RTN","SCMCDD2",45,0)
 F  S SCTPNM=$O(^SCTM(404.57,"ATMPOS",SCTM,SCTPNM)) Q:SCTPNM=""  D
"RTN","SCMCDD2",46,0)
 .S SCTP=$O(^SCTM(404.57,"ATMPOS",SCTM,SCTPNM,0)) ;note: name is unique
"RTN","SCMCDD2",47,0)
 .S SCCL=$P($G(^SCTM(404.57,+SCTP,0)),U,9)
"RTN","SCMCDD2",48,0)
 .K:SCCL ^SC("TEAM",SCTMNM)
"RTN","SCMCDD2",49,0)
 Q
"RTN","SD53107P")
0^^B1361978
"RTN","SD53107P",1,0)
SD53107P ;ALB/REV - PST-INST SD*5.3*107 UPDATE ^SC("TEAM" XREF 3/10/97 
"RTN","SD53107P",2,0)
 ;;5.3;SCHEDULING;**107**;AUG 13, 1993
"RTN","SD53107P",3,0)
EN ;
"RTN","SD53107P",4,0)
 N SCCLTM,DIK
"RTN","SD53107P",5,0)
 D BMES^XPDUTL("Beginning cleanup of team cross-reference in")
"RTN","SD53107P",6,0)
 D MES^XPDUTL("Hospital Location file . . .")
"RTN","SD53107P",7,0)
 D KILLOLD
"RTN","SD53107P",8,0)
 D ADDNEW
"RTN","SD53107P",9,0)
 D BMES^XPDUTL("Cross-references corrected!")
"RTN","SD53107P",10,0)
 Q
"RTN","SD53107P",11,0)
 ;
"RTN","SD53107P",12,0)
KILLOLD ;  if team in SC("TEAM" not in 404.51, kill the XREF entry
"RTN","SD53107P",13,0)
 D BMES^XPDUTL("Removing invalid cross-references.")
"RTN","SD53107P",14,0)
 S SCCLTM=""
"RTN","SD53107P",15,0)
 F  S SCCLTM=$O(^SC("TEAM",SCCLTM)) Q:SCCLTM=""  D
"RTN","SD53107P",16,0)
 .I '$D(^SCTM(404.51,"B",SCCLTM)) K ^SC("TEAM",SCCLTM)
"RTN","SD53107P",17,0)
 Q
"RTN","SD53107P",18,0)
 ;
"RTN","SD53107P",19,0)
ADDNEW ;  make sure each team with assoc clinics has an SC("TEAM" xref
"RTN","SD53107P",20,0)
 D BMES^XPDUTL("Updating cross-references from TEAM file.")
"RTN","SD53107P",21,0)
 S DIK="^SCTM(404.51,",DIK(1)=".01^ASCTEAM" D ENALL^DIK
"RTN","SD53107P",22,0)
 Q
"RTN","SD53107P",23,0)
 ;
"VER")
8.0^21.0
"^DD",404.51,404.51,.01,0)
NAME^RFX^^0;1^K:$L(X)>30!(X?.N)!($L(X)<3)!'(X'?1P.E) X K:$S('$D(X):1,('$D(^SCTM(404.51,"B",X))):0,($G(DIUTIL)="VERIFY FIELDS"):0,1:1) X D:'$D(X) EN^DDIOL("Duplicate Team Names are not allowed.  Name must be 3-30 characters.")
"^DD",404.51,404.51,.01,1,0)
^.1
"^DD",404.51,404.51,.01,1,1,0)
404.51^B
"^DD",404.51,404.51,.01,1,1,1)
S ^SCTM(404.51,"B",$E(X,1,30),DA)=""
"^DD",404.51,404.51,.01,1,1,2)
K ^SCTM(404.51,"B",$E(X,1,30),DA)
"^DD",404.51,404.51,.01,1,2,0)
404.51^ASCTEAM^MUMPS
"^DD",404.51,404.51,.01,1,2,1)
D STSCTMNM^SCMCDD2(DA,X)
"^DD",404.51,404.51,.01,1,2,2)
D KLSCTMNM^SCMCDD2(DA,X)
"^DD",404.51,404.51,.01,1,2,"%D",0)
^^5^5^2970313^^^^
"^DD",404.51,404.51,.01,1,2,"%D",1,0)
This edits the whole cross reference in the Hospital Location File (#44),
"^DD",404.51,404.51,.01,1,2,"%D",2,0)
'TEAM'.  This cross-reference allows users to use the team name to find
"^DD",404.51,404.51,.01,1,2,"%D",3,0)
clinics associated with the team's team positions.  See the 'ASCTEAM'
"^DD",404.51,404.51,.01,1,2,"%D",4,0)
cross-reference in the TEAM POSITION File (#404.57) - in the 'ASSOCIATED
"^DD",404.51,404.51,.01,1,2,"%D",5,0)
CLINIC' (#.09) Field.
"^DD",404.51,404.51,.01,1,2,"DT")
2970313
"^DD",404.51,404.51,.01,3)
NAME MUST BE 3-30 CHARACTERS, NOT NUMERIC OR STARTING WITH PUNCTUATION
"^DD",404.51,404.51,.01,23,0)
^^1^1^2970307^^^^
"^DD",404.51,404.51,.01,23,1,0)
Place holder.  Integration issue.  Can another DHCP file be used?
"^DD",404.51,404.51,.01,"DT")
2970313
**END**
**END**
