Released SD*5.3*52 SEQ #86
Extracted from mail message
**KIDS**:SD*5.3*52^

**INSTALL NAME**
SD*5.3*52
"BLD",366,0)
SD*5.3*52^SCHEDULING^0^2970224^n
"BLD",366,1,0)
^^2^2^2970224^
"BLD",366,1,1,0)
PCMM Reporting Device problems.  For a complete description, please see
"BLD",366,1,2,0)
the NPM.
"BLD",366,4,0)
^9.64PA^^
"BLD",366,"KRN",0)
^9.67PA^19^18
"BLD",366,"KRN",.4,0)
.4
"BLD",366,"KRN",.401,0)
.401
"BLD",366,"KRN",.402,0)
.402
"BLD",366,"KRN",.403,0)
.403
"BLD",366,"KRN",.5,0)
.5
"BLD",366,"KRN",.84,0)
.84
"BLD",366,"KRN",3.6,0)
3.6
"BLD",366,"KRN",3.8,0)
3.8
"BLD",366,"KRN",9.2,0)
9.2
"BLD",366,"KRN",9.8,0)
9.8
"BLD",366,"KRN",9.8,"NM",0)
^9.68A^10^10
"BLD",366,"KRN",9.8,"NM",1,0)
SCRPEC3^^0^B8438599
"BLD",366,"KRN",9.8,"NM",2,0)
SCRPITP^^0^B18856182
"BLD",366,"KRN",9.8,"NM",3,0)
SCRPPAT^^0^B30536526
"BLD",366,"KRN",9.8,"NM",4,0)
SCRPPAT3^^0^B24884224
"BLD",366,"KRN",9.8,"NM",5,0)
SCRPRAC^^0^B14986422
"BLD",366,"KRN",9.8,"NM",6,0)
SCRPSLT^^0^B22330664
"BLD",366,"KRN",9.8,"NM",7,0)
SCRPTA^^0^B27987502
"BLD",366,"KRN",9.8,"NM",8,0)
SCRPTM^^0^B27790777
"BLD",366,"KRN",9.8,"NM",9,0)
SCRPTP2^^0^B26324992
"BLD",366,"KRN",9.8,"NM",10,0)
SCRPU3^^0^B17197226
"BLD",366,"KRN",9.8,"NM","B","SCRPEC3",1)

"BLD",366,"KRN",9.8,"NM","B","SCRPITP",2)

"BLD",366,"KRN",9.8,"NM","B","SCRPPAT",3)

"BLD",366,"KRN",9.8,"NM","B","SCRPPAT3",4)

"BLD",366,"KRN",9.8,"NM","B","SCRPRAC",5)

"BLD",366,"KRN",9.8,"NM","B","SCRPSLT",6)

"BLD",366,"KRN",9.8,"NM","B","SCRPTA",7)

"BLD",366,"KRN",9.8,"NM","B","SCRPTM",8)

"BLD",366,"KRN",9.8,"NM","B","SCRPTP2",9)

"BLD",366,"KRN",9.8,"NM","B","SCRPU3",10)

"BLD",366,"KRN",19,0)
19
"BLD",366,"KRN",19.1,0)
19.1
"BLD",366,"KRN",101,0)
101
"BLD",366,"KRN",409.61,0)
409.61
"BLD",366,"KRN",771,0)
771
"BLD",366,"KRN",869.2,0)
869.2
"BLD",366,"KRN",870,0)
870
"BLD",366,"KRN",8994,0)
8994
"BLD",366,"KRN","B",.4,.4)

"BLD",366,"KRN","B",.401,.401)

"BLD",366,"KRN","B",.402,.402)

"BLD",366,"KRN","B",.403,.403)

"BLD",366,"KRN","B",.5,.5)

"BLD",366,"KRN","B",.84,.84)

"BLD",366,"KRN","B",3.6,3.6)

"BLD",366,"KRN","B",3.8,3.8)

"BLD",366,"KRN","B",9.2,9.2)

"BLD",366,"KRN","B",9.8,9.8)

"BLD",366,"KRN","B",19,19)

"BLD",366,"KRN","B",19.1,19.1)

"BLD",366,"KRN","B",101,101)

"BLD",366,"KRN","B",409.61,409.61)

"BLD",366,"KRN","B",771,771)

"BLD",366,"KRN","B",869.2,869.2)

"BLD",366,"KRN","B",870,870)

"BLD",366,"KRN","B",8994,8994)

"BLD",366,"QUES",0)
^9.62^^
"BLD",366,"REQB",0)
^9.611^2^2
"BLD",366,"REQB",1,0)
SD*5.3*48^1
"BLD",366,"REQB",2,0)
SD*5.3*53^1
"BLD",366,"REQB","B","SD*5.3*48",1)

"BLD",366,"REQB","B","SD*5.3*53",2)

"OER",16,0)
16^SD^^M.A.S.^
"OER",16,1,0)
^100.9951PA^2^2
"OER",16,1,1,0)
103
"OER",16,1,1,1,0)
^100.99511PA^1^1
"OER",16,1,1,1,1,0)
101
"OER",16,1,2,0)
645
"OER",16,1,2,1,0)
^100.99511PA^1^1
"OER",16,1,2,1,1,0)
121
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813
"PKG",16,22,1,"PAH",1,0)
52^2970224
"PKG",16,22,1,"PAH",1,1,0)
^^2^2^2970224
"PKG",16,22,1,"PAH",1,1,1,0)
PCMM Reporting Device problems.  For a complete description, please see
"PKG",16,22,1,"PAH",1,1,2,0)
the NPM.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
10
"RTN","SCRPEC3")
0^1^B8438599
"RTN","SCRPEC3",1,0)
SCRPEC3 ;ALB/CMM - Detail List of Pts & Enroll Clinics ;01/17/96
"RTN","SCRPEC3",2,0)
 ;;5.3;Scheduling;**41,48,52**;AUG 13, 1993
"RTN","SCRPEC3",3,0)
 ;
"RTN","SCRPEC3",4,0)
 ;Detailed Listing of Patients and Their Enrolled Clinics Report
"RTN","SCRPEC3",5,0)
 ;
"RTN","SCRPEC3",6,0)
FIND ;
"RTN","SCRPEC3",7,0)
 N TIEN,OKAY,PTLIST,ERR
"RTN","SCRPEC3",8,0)
 I TEAM=1 D TALL^SCRPPAT3 ;get all teams for all divisions selected
"RTN","SCRPEC3",9,0)
 S TIEN=0,PTLIST="^TMP(""SCLIST"","_$J_")",ERR="ERROR"
"RTN","SCRPEC3",10,0)
 K @PTLIST
"RTN","SCRPEC3",11,0)
 F  S TIEN=$O(TEAM(TIEN)) Q:TIEN=""!(TIEN'?.N)  D
"RTN","SCRPEC3",12,0)
 .K @PTLIST,@ERR
"RTN","SCRPEC3",13,0)
 .S OKAY=$$PTTM^SCAPMC2(TIEN,"",.PTLIST,.ERR)
"RTN","SCRPEC3",14,0)
 .Q:'OKAY
"RTN","SCRPEC3",15,0)
 .D PAT^SCRPEC2(TIEN,.PTLIST)
"RTN","SCRPEC3",16,0)
 K @PTLIST
"RTN","SCRPEC3",17,0)
 Q
"RTN","SCRPEC3",18,0)
 ;
"RTN","SCRPEC3",19,0)
PRINTIT(STORE,IOP,TITL) ;
"RTN","SCRPEC3",20,0)
 ;print title
"RTN","SCRPEC3",21,0)
 D OPEN^SCRPU3
"RTN","SCRPEC3",22,0)
 Q:$G(POP)
"RTN","SCRPEC3",23,0)
 N INS,EINST,ETEAM,TEAM,ECLN,CLINIC,PAGE,FIRST,PTIEN,PTNAME
"RTN","SCRPEC3",24,0)
 S PAGE=1,STOP=0
"RTN","SCRPEC3",25,0)
 D TITLE^SCRPU3(.PAGE,TITL)
"RTN","SCRPEC3",26,0)
 S (INS,EINST)=""
"RTN","SCRPEC3",27,0)
 S FIRST=0
"RTN","SCRPEC3",28,0)
 F  S EINST=$O(@STORE@("I",EINST)) Q:EINST=""!(STOP)  D
"RTN","SCRPEC3",29,0)
 .S INS=$O(@STORE@("I",EINST,INS))
"RTN","SCRPEC3",30,0)
 .Q:INS=""
"RTN","SCRPEC3",31,0)
 .I FIRST,IOST'?1"C-".E D NEWP1^SCRPU3(.PAGE,TITL)
"RTN","SCRPEC3",32,0)
 .I FIRST,IOST?1"C-".E D HOLD^SCRPU3(.PAGE,TITL)
"RTN","SCRPEC3",33,0)
 .Q:STOP
"RTN","SCRPEC3",34,0)
 .I IOST'?1"C-".E,$Y>(IOSL-8) D NEWP1^SCRPU3(.PAGE,TITL)
"RTN","SCRPEC3",35,0)
 .I IOST?1"C-".E,$Y>(IOSL-8) D HOLD^SCRPU3(.PAGE,TITL)
"RTN","SCRPEC3",36,0)
 .Q:STOP!INS=""
"RTN","SCRPEC3",37,0)
 .W !,$G(@STORE@(INS)) ;write institution
"RTN","SCRPEC3",38,0)
 .S FIRST=1
"RTN","SCRPEC3",39,0)
 .S (ETEAM,TEAM)=""
"RTN","SCRPEC3",40,0)
 .F  W ! S ETEAM=$O(@STORE@("T",INS,ETEAM)) Q:ETEAM=""!(STOP)  D
"RTN","SCRPEC3",41,0)
 ..S TEAM=$O(@STORE@("T",INS,ETEAM,""))
"RTN","SCRPEC3",42,0)
 ..I IOST'?1"C-".E,$Y>(IOSL-8) D NEWP1^SCRPU3(.PAGE,TITL) W:'STOP !,$G(@STORE@(INS))
"RTN","SCRPEC3",43,0)
 ..I IOST?1"C-".E,$Y>(IOSL-8) D HOLD^SCRPU3(.PAGE,TITL) W:'STOP !,$G(@STORE@(INS))
"RTN","SCRPEC3",44,0)
 ..I STOP Q
"RTN","SCRPEC3",45,0)
 ..W !!,$G(@STORE@(INS,TEAM)) ;write team
"RTN","SCRPEC3",46,0)
 ..S (ECLN,CLINIC)=0
"RTN","SCRPEC3",47,0)
 ..F  S ECLN=$O(@STORE@("C",INS,TEAM,ECLN)) Q:ECLN=""!(STOP)  D
"RTN","SCRPEC3",48,0)
 ...S CLINIC=$O(@STORE@("C",INS,TEAM,ECLN,""))
"RTN","SCRPEC3",49,0)
 ...W !
"RTN","SCRPEC3",50,0)
 ...D CHEAD^SCRPEC2(INS,TEAM,CLINIC)
"RTN","SCRPEC3",51,0)
 ...S PTNAME=""
"RTN","SCRPEC3",52,0)
 ...F  S PTNAME=$O(@STORE@("PT",INS,TEAM,CLINIC,PTNAME)) Q:PTNAME=""!(STOP)  D
"RTN","SCRPEC3",53,0)
 ....S PTIEN=$O(@STORE@("PT",INS,TEAM,CLINIC,PTNAME,""))
"RTN","SCRPEC3",54,0)
 ....I IOST'?1"C-".E,$Y>(IOSL-8) D NEWP1^SCRPU3(.PAGE,TITL) Q:STOP  W !,$G(@STORE@(INS)),!!,$G(@STORE@(INS,TEAM)),! D CHEAD^SCRPEC2(INS,TEAM,CLINIC)
"RTN","SCRPEC3",55,0)
 ....I IOST?1"C-".E,$Y>(IOSL-8) D HOLD^SCRPU3(.PAGE,TITL) Q:STOP  W !,$G(@STORE@(INS)),!!,$G(@STORE@(INS,TEAM)),! D CHEAD^SCRPEC2(INS,TEAM,CLINIC)
"RTN","SCRPEC3",56,0)
 ....Q:STOP
"RTN","SCRPEC3",57,0)
 ....W !,$G(@STORE@(INS,TEAM,CLINIC,PTIEN))
"RTN","SCRPEC3",58,0)
 D CLOSE^SCRPU3
"RTN","SCRPEC3",59,0)
 Q
"RTN","SCRPEC3",60,0)
 ;
"RTN","SCRPITP")
0^2^B18856182
"RTN","SCRPITP",1,0)
SCRPITP ;ALB/CMM - Individual Team Profile ;02/02/96
"RTN","SCRPITP",2,0)
 ;;5.3;Scheduling;**41,52**;AUG 13, 1993
"RTN","SCRPITP",3,0)
 ;
"RTN","SCRPITP",4,0)
 ;Individual Team Profile
"RTN","SCRPITP",5,0)
 ;
"RTN","SCRPITP",6,0)
PROMPTS ;
"RTN","SCRPITP",7,0)
 ;Prompt for Institution, Team, and Print device
"RTN","SCRPITP",8,0)
 ;
"RTN","SCRPITP",9,0)
 N QTIME,PRNT,VAUTD,VAUTT,Y,NUMBER
"RTN","SCRPITP",10,0)
 K VAUTD,VAUTT,SCUP
"RTN","SCRPITP",11,0)
 S QTIME=""
"RTN","SCRPITP",12,0)
 D INST^SCRPU1 I Y=-1 G ERR
"RTN","SCRPITP",13,0)
 K Y D PRMTT^SCRPU1 I '$D(VAUTT) G ERR
"RTN","SCRPITP",14,0)
 S PRNT=$$PDEVICE^SCRPU3()
"RTN","SCRPITP",15,0)
 I PRNT=-1 G ERR
"RTN","SCRPITP",16,0)
 I PRNT["Q;" S QTIME=$$GETTIME^SCRPU3()
"RTN","SCRPITP",17,0)
 I QTIME=-1 G ERR
"RTN","SCRPITP",18,0)
 I PRNT'?1"Q;".E S PRNT="Q;"_PRNT
"RTN","SCRPITP",19,0)
 S NUMBER=$$ENTRY2(.VAUTD,.VAUTT,PRNT,QTIME)
"RTN","SCRPITP",20,0)
 I NUMBER>0 W !!,"Print queued, task number: ",NUMBER
"RTN","SCRPITP",21,0)
 Q
"RTN","SCRPITP",22,0)
 ;
"RTN","SCRPITP",23,0)
ENTRY2(INST,TEAM,IOP,ZTDTH) ;
"RTN","SCRPITP",24,0)
 ;Second entry point for GUI to use
"RTN","SCRPITP",25,0)
 ;Input Parameters:
"RTN","SCRPITP",26,0)
 ;INST - institutions selected (variable and array)
"RTN","SCRPITP",27,0)
 ;TEAM - teams selected (variable and array)
"RTN","SCRPITP",28,0)
 ;IOP - print device
"RTN","SCRPITP",29,0)
 ;ZTDTH - queue time (optional)
"RTN","SCRPITP",30,0)
 ;
"RTN","SCRPITP",31,0)
 ;validate parameters
"RTN","SCRPITP",32,0)
 I '$D(INST)!'$D(TEAM)!'$D(IOP)!(IOP="") Q
"RTN","SCRPITP",33,0)
 ;
"RTN","SCRPITP",34,0)
 N NUMBER
"RTN","SCRPITP",35,0)
 S IOST=$P(IOP,"^",2),IOP=$P(IOP,"^")
"RTN","SCRPITP",36,0)
 I IOP?1"Q;".E S IOP=$P(IOP,"Q;",2)
"RTN","SCRPITP",37,0)
 I IOST?1"C-".E D QENTRY G RET
"RTN","SCRPITP",38,0)
 I ZTDTH="" S ZTDTH=$H
"RTN","SCRPITP",39,0)
 S ZTRTN="QENTRY^SCRPITP"
"RTN","SCRPITP",40,0)
 S ZTDESC="Summary Listing Of Teams",ZTIO=IOP
"RTN","SCRPITP",41,0)
 N II
"RTN","SCRPITP",42,0)
 F II="INST","TEAM","INST(","TEAM(","IOP" S ZTSAVE(II)=""
"RTN","SCRPITP",43,0)
 D ^%ZTLOAD
"RTN","SCRPITP",44,0)
RET S NUMBER=0
"RTN","SCRPITP",45,0)
 I $D(ZTSK) S NUMBER=ZTSK
"RTN","SCRPITP",46,0)
 D EXIT1
"RTN","SCRPITP",47,0)
 Q NUMBER
"RTN","SCRPITP",48,0)
 ;
"RTN","SCRPITP",49,0)
QENTRY ;
"RTN","SCRPITP",50,0)
 ;driver entry point
"RTN","SCRPITP",51,0)
 S TITL="Primary Care Management Team Profile"
"RTN","SCRPITP",52,0)
 S STORE="^TMP("_$J_",""SCRPITP"")"
"RTN","SCRPITP",53,0)
 K @STORE
"RTN","SCRPITP",54,0)
 S @STORE=0
"RTN","SCRPITP",55,0)
 I TEAM=1 D TALL^SCRPPAT3 S TEAM=0
"RTN","SCRPITP",56,0)
 D FIND
"RTN","SCRPITP",57,0)
 I $O(@STORE@(0))="" S NODATA=$$NODATA^SCRPU3(TITL)
"RTN","SCRPITP",58,0)
 I '$D(NODATA) D PRINTIT(STORE,IOP,TITL)
"RTN","SCRPITP",59,0)
 D EXIT2
"RTN","SCRPITP",60,0)
 Q
"RTN","SCRPITP",61,0)
 ;
"RTN","SCRPITP",62,0)
ERR ;
"RTN","SCRPITP",63,0)
EXIT1 ;
"RTN","SCRPITP",64,0)
 K ZTDTH,ZTRTN,ZTDESC,ZTSK,ZTIO,ZTSAVE
"RTN","SCRPITP",65,0)
 Q
"RTN","SCRPITP",66,0)
 ;
"RTN","SCRPITP",67,0)
EXIT2 ;
"RTN","SCRPITP",68,0)
 K @STORE
"RTN","SCRPITP",69,0)
 K STOP,STORE,TITL,IOP,TEAM,INST,NODATA
"RTN","SCRPITP",70,0)
 Q
"RTN","SCRPITP",71,0)
 ;
"RTN","SCRPITP",72,0)
FIND ;
"RTN","SCRPITP",73,0)
 N TM,EN,NODE,TMP
"RTN","SCRPITP",74,0)
 S TM=""
"RTN","SCRPITP",75,0)
 F  S TM=$O(^SCTM(404.57,"C",TM)) Q:TM=""  D
"RTN","SCRPITP",76,0)
 .;$O through team position file
"RTN","SCRPITP",77,0)
 .I '$D(TEAM(TM))&(TEAM'=1) Q
"RTN","SCRPITP",78,0)
 .;Q above, not a selected team
"RTN","SCRPITP",79,0)
 .;selected team
"RTN","SCRPITP",80,0)
 .S EN=""
"RTN","SCRPITP",81,0)
 .F  S EN=$O(^SCTM(404.57,"C",TM,EN)) Q:EN=""  D
"RTN","SCRPITP",82,0)
 ..I '$D(^SCTM(404.57,EN,0)) Q
"RTN","SCRPITP",83,0)
 ..S NODE=$G(^SCTM(404.57,EN,0))
"RTN","SCRPITP",84,0)
 ..Q:NODE=""
"RTN","SCRPITP",85,0)
 ..;active or inactive position
"RTN","SCRPITP",86,0)
 ..S TMP=$$DATES^SCAPMCU1(404.59,EN,DT)
"RTN","SCRPITP",87,0)
 ..I +TMP D KEEP^SCRPITP2(NODE,EN,TM)
"RTN","SCRPITP",88,0)
 Q
"RTN","SCRPITP",89,0)
 ;
"RTN","SCRPITP",90,0)
PRINTIT(STORE,IOP,TITL) ;
"RTN","SCRPITP",91,0)
 D OPEN^SCRPU3
"RTN","SCRPITP",92,0)
 Q:$G(POP)
"RTN","SCRPITP",93,0)
 N INST,EINST,ETEAM,TEM,NEW,PAGE,TNAME,TIEN,EN,SUB,POS,CIEN,INF
"RTN","SCRPITP",94,0)
 S (INST,EINST)="",STOP=0,PAGE=1
"RTN","SCRPITP",95,0)
 D TITLE^SCRPU3(.PAGE,TITL)
"RTN","SCRPITP",96,0)
 D FORHEAD^SCRPITP2
"RTN","SCRPITP",97,0)
 F  S EINST=$O(@STORE@("I",EINST)) Q:EINST=""!(STOP)  D
"RTN","SCRPITP",98,0)
 .S INST=$O(@STORE@("I",EINST,""))
"RTN","SCRPITP",99,0)
 .I INST="" Q
"RTN","SCRPITP",100,0)
 .I $D(NEW),(IOST'?1"C-".E) D NEWP1^SCRPU3(.PAGE,TITL) K NEW
"RTN","SCRPITP",101,0)
 .I $D(NEW),(IOST?1"C-".E)  K NEW D HOLD^SCRPU3(.PAGE,TITL)
"RTN","SCRPITP",102,0)
 .I STOP Q
"RTN","SCRPITP",103,0)
 .S NEW=""
"RTN","SCRPITP",104,0)
 .W !,$G(@STORE@(INST)),!
"RTN","SCRPITP",105,0)
 .;write team info
"RTN","SCRPITP",106,0)
 .S TNAME=""
"RTN","SCRPITP",107,0)
 .F  S TNAME=$O(@STORE@("T",INST,TNAME)) Q:TNAME=""!(STOP)  D
"RTN","SCRPITP",108,0)
 ..S TIEN=$O(@STORE@("T",INST,TNAME,""))
"RTN","SCRPITP",109,0)
 ..I TIEN="" Q
"RTN","SCRPITP",110,0)
 ..F SUB="TI","D","PC","AC" D
"RTN","SCRPITP",111,0)
 ...Q:STOP
"RTN","SCRPITP",112,0)
 ...I '$D(@STORE@(INST,TIEN,SUB)) Q
"RTN","SCRPITP",113,0)
 ...S EN=""
"RTN","SCRPITP",114,0)
 ...F  S EN=$O(@STORE@(INST,TIEN,SUB,EN)) Q:EN=""!(STOP)  D
"RTN","SCRPITP",115,0)
 ....I IOST'?1"C-".E,$Y>(IOSL-8) D NEWP1^SCRPU3(.PAGE,TITL) S NEW=""
"RTN","SCRPITP",116,0)
 ....I IOST?1"C-".E,$Y>(IOSL-8) D HOLD^SCRPU3(.PAGE,TITL) S NEW=""
"RTN","SCRPITP",117,0)
 ....I STOP Q
"RTN","SCRPITP",118,0)
 ....I '$D(NEW) W !,$G(@STORE@(INST)),!,$G(@STORE@(INST,TIEN)),!
"RTN","SCRPITP",119,0)
 ....W !,$G(@STORE@(INST,TIEN,SUB,EN))
"RTN","SCRPITP",120,0)
 ...W !
"RTN","SCRPITP",121,0)
 ..;write position info
"RTN","SCRPITP",122,0)
 ..S POS=""
"RTN","SCRPITP",123,0)
 ..I $Y<IOSL-8 D COLUMN^SCRPITP2
"RTN","SCRPITP",124,0)
 ..F  S POS=$O(@STORE@(INST,TIEN,"P",POS)) Q:POS=""!(POS'?.N)!(STOP)  D
"RTN","SCRPITP",125,0)
 ...I IOST'?1"C-".E,$Y>(IOSL-8) D NEWP1^SCRPU3(.PAGE,TITL) Q:STOP  D COLUMN^SCRPITP2 S NEW=""
"RTN","SCRPITP",126,0)
 ...I IOST?1"C-".E,$Y>(IOSL-8) D HOLD^SCRPU3(.PAGE,TITL) Q:STOP  D COLUMN^SCRPITP2 S NEW=""
"RTN","SCRPITP",127,0)
 ...I STOP Q
"RTN","SCRPITP",128,0)
 ...W !,$G(@STORE@(INST,TIEN,"P",POS))
"RTN","SCRPITP",129,0)
 ..W !
"RTN","SCRPITP",130,0)
 D CLOSE^SCRPU3
"RTN","SCRPITP",131,0)
 Q
"RTN","SCRPITP",132,0)
 ;
"RTN","SCRPPAT")
0^3^B30536526
"RTN","SCRPPAT",1,0)
SCRPPAT ;ALB/CMM - Practitioner's Patients ;02/20/96
"RTN","SCRPPAT",2,0)
 ;;5.3;Scheduling;**41,52**;AUG 13, 1993
"RTN","SCRPPAT",3,0)
 ;
"RTN","SCRPPAT",4,0)
 ;Listing of Practitioner's Patients
"RTN","SCRPPAT",5,0)
 ;
"RTN","SCRPPAT",6,0)
PROMPTS ;
"RTN","SCRPPAT",7,0)
 ;Prompt for division, team, role, practitioner, summary only and print device
"RTN","SCRPPAT",8,0)
 ;
"RTN","SCRPPAT",9,0)
 N QTIME,PRNT,VAUTP,Y,VAUTD,VAUTT,VAUTR,VAUTS,SORT,NUMBER
"RTN","SCRPPAT",10,0)
 K SCUP
"RTN","SCRPPAT",11,0)
 S QTIME=""
"RTN","SCRPPAT",12,0)
 D INST^SCRPU1 I Y=-1 G ERR
"RTN","SCRPPAT",13,0)
 K Y D PRMTT^SCRPU1 I '$D(VAUTT) G ERR
"RTN","SCRPPAT",14,0)
 K Y D ROLE^SCRPU1 I '$D(VAUTR) G ERR
"RTN","SCRPPAT",15,0)
 D PRACT^SCRPU1 I '$D(VAUTP) G ERR
"RTN","SCRPPAT",16,0)
 S VAUTS=$$SUMM^SCRPU2() I VAUTS<0 G ERR
"RTN","SCRPPAT",17,0)
 S SORT=$$SORT^SCRPU2() I SORT<1 G ERR
"RTN","SCRPPAT",18,0)
 S PRNT=$$PDEVICE^SCRPU3()
"RTN","SCRPPAT",19,0)
 I PRNT=-1 G ERR
"RTN","SCRPPAT",20,0)
 I PRNT["Q;" S QTIME=$$GETTIME^SCRPU3()
"RTN","SCRPPAT",21,0)
 I QTIME=-1 G ERR
"RTN","SCRPPAT",22,0)
 I PRNT'?1"Q;".E S PRNT="Q;"_PRNT
"RTN","SCRPPAT",23,0)
 S NUMBER=$$ENTRY2(.VAUTD,.VAUTT,.VAUTR,.VAUTP,VAUTS,SORT,PRNT,QTIME)
"RTN","SCRPPAT",24,0)
 I NUMBER>0 W !!,"Print queued, task number: ",NUMBER
"RTN","SCRPPAT",25,0)
 Q
"RTN","SCRPPAT",26,0)
 ;
"RTN","SCRPPAT",27,0)
ENTRY2(INST,TEAM,ROLE,PRACT,SUMM,SORT,IOP,ZTDTH) ;
"RTN","SCRPPAT",28,0)
 ;Second entry point for GUI to use
"RTN","SCRPPAT",29,0)
 ;Input Parameters:
"RTN","SCRPPAT",30,0)
 ;INST - institutions selected (variable and array)
"RTN","SCRPPAT",31,0)
 ;TEAM - teams selected (variable and array)
"RTN","SCRPPAT",32,0)
 ;ROLE - roles selected (variable and array)
"RTN","SCRPPAT",33,0)
 ;PRACT - practitioners selected (ien new person file) - (variable and array)
"RTN","SCRPPAT",34,0)
 ;SUMM - summary info? y/n (1-yes/0-no) yes don't print patient data
"RTN","SCRPPAT",35,0)
 ;SORT - sort criteria (1-d,t,p/2-d,p,t)
"RTN","SCRPPAT",36,0)
 ;IOP - print device
"RTN","SCRPPAT",37,0)
 ;ZTDTH - queue time (optional)
"RTN","SCRPPAT",38,0)
 ;
"RTN","SCRPPAT",39,0)
 ;validate parameters
"RTN","SCRPPAT",40,0)
 I '$D(INST)!'$D(TEAM)!'$D(ROLE)!'$D(PRACT)!'$D(SUMM)!'$D(SORT)!'$D(IOP)!(IOP="") Q
"RTN","SCRPPAT",41,0)
 ;
"RTN","SCRPPAT",42,0)
 N NUMBER
"RTN","SCRPPAT",43,0)
 S IOST=$P(IOP,"^",2),IOP=$P(IOP,"^")
"RTN","SCRPPAT",44,0)
 I IOP?1"Q;".E S IOP=$P(IOP,"Q;",2)
"RTN","SCRPPAT",45,0)
 I IOST?1"C-".E D QENTRY G RET
"RTN","SCRPPAT",46,0)
 I ZTDTH="" S ZTDTH=$H
"RTN","SCRPPAT",47,0)
 S ZTRTN="QENTRY^SCRPPAT"
"RTN","SCRPPAT",48,0)
 S ZTDESC="Practitioner's Patients",ZTIO=IOP
"RTN","SCRPPAT",49,0)
 N II
"RTN","SCRPPAT",50,0)
 F II="IOSL","INST","INST(","TEAM","TEAM(","ROLE","ROLE(","PRACT(","PRACT","SUMM","IOP","SORT" S ZTSAVE(II)=""
"RTN","SCRPPAT",51,0)
 D ^%ZTLOAD
"RTN","SCRPPAT",52,0)
RET S NUMBER=0
"RTN","SCRPPAT",53,0)
 I $D(ZTSK) S NUMBER=ZTSK
"RTN","SCRPPAT",54,0)
 D EXIT1
"RTN","SCRPPAT",55,0)
 Q NUMBER
"RTN","SCRPPAT",56,0)
 ;
"RTN","SCRPPAT",57,0)
QENTRY ;
"RTN","SCRPPAT",58,0)
 ;driver entry point
"RTN","SCRPPAT",59,0)
 S TITL="Practitioner's Patients"
"RTN","SCRPPAT",60,0)
 I SUMM S TITL=TITL_" Summary Report"
"RTN","SCRPPAT",61,0)
 S STORE="^TMP("_$J_",""SCRPPAT"")"
"RTN","SCRPPAT",62,0)
 K @STORE
"RTN","SCRPPAT",63,0)
 S @STORE=0
"RTN","SCRPPAT",64,0)
 D DRIVE^SCRPPAT2
"RTN","SCRPPAT",65,0)
 I $O(@STORE@(0))="" S NODATA=$$NODATA^SCRPU3(TITL)
"RTN","SCRPPAT",66,0)
 I '$D(NODATA) D PRINTIT(STORE,IOP,TITL,SORT)
"RTN","SCRPPAT",67,0)
 D EXIT2
"RTN","SCRPPAT",68,0)
 Q
"RTN","SCRPPAT",69,0)
 ;
"RTN","SCRPPAT",70,0)
ERR ;
"RTN","SCRPPAT",71,0)
EXIT1 ;
"RTN","SCRPPAT",72,0)
 K ZTDTH,ZTRTN,ZTDESC,ZTSK,ZTIO,ZTSAVE,VAUTD,VAUTT,VAUTP,VAUTR
"RTN","SCRPPAT",73,0)
 K SCUP,VAUTS,SORT
"RTN","SCRPPAT",74,0)
 Q
"RTN","SCRPPAT",75,0)
 ;
"RTN","SCRPPAT",76,0)
EXIT2 ;
"RTN","SCRPPAT",77,0)
 K @STORE
"RTN","SCRPPAT",78,0)
 K STORE,TITL,IOP,PRACT,INST,TEAM,ROLE,SORT,SUMM,NODATA,STOP
"RTN","SCRPPAT",79,0)
 Q
"RTN","SCRPPAT",80,0)
 ;
"RTN","SCRPPAT",81,0)
PRINTIT(STORE,IOP,TITL,SORT) ; Print All Data
"RTN","SCRPPAT",82,0)
 ;STORE - global location of data
"RTN","SCRPPAT",83,0)
 ;IOP - device to print to
"RTN","SCRPPAT",84,0)
 ;TITL - title of report
"RTN","SCRPPAT",85,0)
 ;SORT - sort order 1-div,team,pract/2-div,pract,team
"RTN","SCRPPAT",86,0)
 ;
"RTN","SCRPPAT",87,0)
 N PAGE
"RTN","SCRPPAT",88,0)
 S PAGE=1,STOP=0
"RTN","SCRPPAT",89,0)
 D OPEN^SCRPU3
"RTN","SCRPPAT",90,0)
 Q:$G(POP)
"RTN","SCRPPAT",91,0)
 D TITLE^SCRPU3(.PAGE,TITL)
"RTN","SCRPPAT",92,0)
 D SHEAD^SCRPPAT3
"RTN","SCRPPAT",93,0)
 N SEC1,SEC2,SEC2,SEC3,SEC4,ST1,ST2,ST3,ST4
"RTN","SCRPPAT",94,0)
 I SORT=1 S SEC1="""T""",SEC2="""P""",SEC3="""TN""",SEC4="""PN"""
"RTN","SCRPPAT",95,0)
 I SORT=2 S SEC1="""P""",SEC2="""T""",SEC3="""PN""",SEC4="""TN"""
"RTN","SCRPPAT",96,0)
 N SEC,TRD,INS,INAME,SECN,TRDN,PT,FIRST
"RTN","SCRPPAT",97,0)
 S (INAME,INS)="",FIRST=1
"RTN","SCRPPAT",98,0)
 F  S INAME=$O(@STORE@("I",INAME)) Q:INAME=""!(STOP)  D
"RTN","SCRPPAT",99,0)
 .S INS=$O(@STORE@("I",INAME,""))
"RTN","SCRPPAT",100,0)
 .Q:INS=""
"RTN","SCRPPAT",101,0)
 .I 'FIRST,(IOST'?1"C-".E) D NEWP1^SCRPU3(.PAGE,TITL)
"RTN","SCRPPAT",102,0)
 .I 'FIRST,(IOST?1"C-".E) D HOLD^SCRPU3(.PAGE,TITL)
"RTN","SCRPPAT",103,0)
 .Q:STOP
"RTN","SCRPPAT",104,0)
 .W !,$G(@STORE@(INS))
"RTN","SCRPPAT",105,0)
 .S FIRST=0
"RTN","SCRPPAT",106,0)
 .S SECN="",ST1=$E(STORE,1,($L(STORE)-1))_","_SEC1_")"
"RTN","SCRPPAT",107,0)
 .F  S SECN=$O(@ST1@(INS,SECN)) Q:SECN=""!(STOP)  D
"RTN","SCRPPAT",108,0)
 ..S SEC=$O(@ST1@(INS,SECN,"")) ;ien of team or practitioner
"RTN","SCRPPAT",109,0)
 ..Q:SEC=""
"RTN","SCRPPAT",110,0)
 ..S ST3=$E(STORE,1,($L(STORE)-1))_","_SEC3_")"
"RTN","SCRPPAT",111,0)
 ..S TRDN="",ST2=$E(STORE,1,($L(STORE)-1))_","_SEC2_")"
"RTN","SCRPPAT",112,0)
 ..F  S TRDN=$O(@ST2@(INS,TRDN)) Q:TRDN=""!(STOP)  D
"RTN","SCRPPAT",113,0)
 ...S TRD=$O(@ST2@(INS,TRDN,"")) ;ien of team or practitioner
"RTN","SCRPPAT",114,0)
 ...Q:TRD=""
"RTN","SCRPPAT",115,0)
 ...;have first team and first practitioner ien
"RTN","SCRPPAT",116,0)
 ...S ST4=$E(STORE,1,($L(STORE)-1))_","_SEC4_")"
"RTN","SCRPPAT",117,0)
 ...D PRNT(ST4,ST3,SEC3,.PAGE,TITL,INS,SEC,TRD)
"RTN","SCRPPAT",118,0)
 .I 'STOP D TOTAL2^SCRPPAT3(INS)
"RTN","SCRPPAT",119,0)
 D CLOSE^SCRPU3
"RTN","SCRPPAT",120,0)
 Q
"RTN","SCRPPAT",121,0)
 ;
"RTN","SCRPPAT",122,0)
PRNT(ST4,ST3,SEC3,PAGE,TITL,INS,SEC,TRD) ;
"RTN","SCRPPAT",123,0)
 ;
"RTN","SCRPPAT",124,0)
 N POS
"RTN","SCRPPAT",125,0)
 I (SEC3="""PN""")&($D(@ST3@(INS,SEC,TRD))) D
"RTN","SCRPPAT",126,0)
 .;get each position for practitioner
"RTN","SCRPPAT",127,0)
 .S POS=""
"RTN","SCRPPAT",128,0)
 .F  S POS=$O(@ST3@(INS,SEC,TRD,POS)) Q:POS=""!(STOP)  D
"RTN","SCRPPAT",129,0)
 ..I (IOST'?1"C-".E),$Y>(IOSL-10) D NEWP1^SCRPU3(.PAGE,TITL) W:'STOP !,$G(@STORE@(INS))
"RTN","SCRPPAT",130,0)
 ..I (IOST?1"C-".E),$Y>(IOSL-10) D HOLD^SCRPU3(.PAGE,TITL) W:'STOP !,$G(@STORE@(INS))
"RTN","SCRPPAT",131,0)
 ..Q:STOP
"RTN","SCRPPAT",132,0)
 ..W !!,$G(@ST3@(INS,SEC,TRD,POS)) ;write practitioner (sort 1)
"RTN","SCRPPAT",133,0)
 ..W !!,$G(@ST4@(INS,TRD)) ;write team (sort 2)
"RTN","SCRPPAT",134,0)
 ..;$o through patients for practitioner on team
"RTN","SCRPPAT",135,0)
 ..D PAT^SCRPPAT3(INS,SEC,TRD,SEC3,ST3,ST4,POS)
"RTN","SCRPPAT",136,0)
 ..I 'STOP D TOTAL1^SCRPPAT3(INS,SEC,TRD,POS) ;print team/practitioner total
"RTN","SCRPPAT",137,0)
 ;
"RTN","SCRPPAT",138,0)
 I (SEC3="""TN""")&($D(@ST4@(INS,TRD,SEC))) D
"RTN","SCRPPAT",139,0)
 .I (IOST'?1"C-".E),$Y>(IOSL-10) D NEWP1^SCRPU3(.PAGE,TITL) W:'STOP !,$G(@STORE@(INS))
"RTN","SCRPPAT",140,0)
 .I (IOST?1"C-".E),$Y>(IOSL-10) D HOLD^SCRPU3(.PAGE,TITL) W:'STOP !,$G(@STORE@(INS))
"RTN","SCRPPAT",141,0)
 .Q:STOP
"RTN","SCRPPAT",142,0)
 .W !!,$G(@ST3@(INS,SEC)) ;write team (sort 1)
"RTN","SCRPPAT",143,0)
 .S POS=""
"RTN","SCRPPAT",144,0)
 .F  S POS=$O(@ST4@(INS,TRD,SEC,POS)) Q:POS=""!(STOP)  D
"RTN","SCRPPAT",145,0)
 ..W !!,$G(@ST4@(INS,TRD,SEC,POS)) ;write practitioner (sort 2)
"RTN","SCRPPAT",146,0)
 ..;$o through patients for practitioner on team
"RTN","SCRPPAT",147,0)
 ..D PAT^SCRPPAT3(INS,SEC,TRD,SEC3,ST3,ST4,POS)
"RTN","SCRPPAT",148,0)
 ..I 'STOP D TOTAL1^SCRPPAT3(INS,SEC,TRD,POS) ;print team/practitioner total
"RTN","SCRPPAT",149,0)
 Q
"RTN","SCRPPAT3")
0^4^B24884224
"RTN","SCRPPAT3",1,0)
SCRPPAT3 ;ALB/CMM - Practitioner's Patients ;02/20/96
"RTN","SCRPPAT3",2,0)
 ;;5.3;Scheduling;**41,52**;AUG 13, 1993
"RTN","SCRPPAT3",3,0)
 ;
"RTN","SCRPPAT3",4,0)
 ;Listing of Practitioner's Patients
"RTN","SCRPPAT3",5,0)
 ;
"RTN","SCRPPAT3",6,0)
PAT(INS,SEC,TRD,SEC3,ST3,ST4,POS) ;
"RTN","SCRPPAT3",7,0)
 ;writes patients for position/practitioner
"RTN","SCRPPAT3",8,0)
 N PTN,PT,FIRST
"RTN","SCRPPAT3",9,0)
 S PTN="",FIRST=1
"RTN","SCRPPAT3",10,0)
 I SUMM D TOTAL1^SCRPPAT3(INS,SEC,TRD,POS) Q  ;Summary only
"RTN","SCRPPAT3",11,0)
 F  S PTN=$O(@STORE@("PT",INS,SEC,TRD,POS,PTN)) Q:PTN=""!(STOP)  D
"RTN","SCRPPAT3",12,0)
 .S PT=$O(@STORE@("PT",INS,SEC,TRD,POS,PTN,""))
"RTN","SCRPPAT3",13,0)
 .Q:PT=""
"RTN","SCRPPAT3",14,0)
 .I (IOST'?1"C-".E),$Y>(IOSL-10) D NEWP1^SCRPU3(.PAGE,TITL) D:'STOP HEAD2(INS,SEC,TRD,SEC3,ST3,ST4,POS) D:'FIRST HEADER
"RTN","SCRPPAT3",15,0)
 .I (IOST?1"C-".E),$Y>(IOSL-10) D HOLD^SCRPU3(.PAGE,TITL) D:'STOP HEAD2(INS,SEC,TRD,SEC3,ST3,ST4,POS) D:'FIRST HEADER
"RTN","SCRPPAT3",16,0)
 .Q:STOP
"RTN","SCRPPAT3",17,0)
 .I FIRST D HEADER S FIRST=0
"RTN","SCRPPAT3",18,0)
 .W !,$G(@STORE@(INS,SEC,TRD,POS,PT)) ;print patient detail line
"RTN","SCRPPAT3",19,0)
 Q
"RTN","SCRPPAT3",20,0)
 ;
"RTN","SCRPPAT3",21,0)
SPRINT(STORE,IOP,TITL,SORT) ; Summary Print Only
"RTN","SCRPPAT3",22,0)
 ;STORE - global location of data
"RTN","SCRPPAT3",23,0)
 ;IOP - device to print to
"RTN","SCRPPAT3",24,0)
 ;TITL - title of report
"RTN","SCRPPAT3",25,0)
 ;SORT - sort order 1-div,team,pract/2-div,pract,team
"RTN","SCRPPAT3",26,0)
 ;
"RTN","SCRPPAT3",27,0)
 N PAGE
"RTN","SCRPPAT3",28,0)
 S PAGE=1,STOP=0
"RTN","SCRPPAT3",29,0)
 D OPEN^SCRPU3
"RTN","SCRPPAT3",30,0)
 Q:$G(POP)
"RTN","SCRPPAT3",31,0)
 D TITLE^SCRPU3(.PAGE,TITL)
"RTN","SCRPPAT3",32,0)
 D CLOSE^SCRPU3
"RTN","SCRPPAT3",33,0)
 Q
"RTN","SCRPPAT3",34,0)
 ;
"RTN","SCRPPAT3",35,0)
TOTAL1(INS,SEC,TRD,POS) ;
"RTN","SCRPPAT3",36,0)
 ;print team/practitioner total
"RTN","SCRPPAT3",37,0)
 N TEM,PRC
"RTN","SCRPPAT3",38,0)
 I SORT=1 S TEM=SEC,PRC=TRD
"RTN","SCRPPAT3",39,0)
 I SORT=2 S TEM=TRD,PRC=SEC
"RTN","SCRPPAT3",40,0)
 W !!,$G(@STORE@("TH",INS,PRC,TEM,POS)),$G(@STORE@("TOTAL",INS,PRC,TEM,POS))
"RTN","SCRPPAT3",41,0)
 W !!
"RTN","SCRPPAT3",42,0)
 Q
"RTN","SCRPPAT3",43,0)
 ;
"RTN","SCRPPAT3",44,0)
TOTAL2(INS) ;
"RTN","SCRPPAT3",45,0)
 ;print practitioners' totals
"RTN","SCRPPAT3",46,0)
 N PRC,FIRST
"RTN","SCRPPAT3",47,0)
 S PRC="",FIRST=1
"RTN","SCRPPAT3",48,0)
 F  S PRC=$O(@STORE@("TH",INS,PRC)) Q:PRC=""!(STOP)  D
"RTN","SCRPPAT3",49,0)
 .I (IOST'?1"C-".E),$Y>(IOSL-8) D NEWP1^SCRPU3(.PAGE,TITL)
"RTN","SCRPPAT3",50,0)
 .I (IOST?1"C-".E),$Y>(IOSL-8) D HOLD^SCRPU3(.PAGE,TITL)
"RTN","SCRPPAT3",51,0)
 .Q:STOP
"RTN","SCRPPAT3",52,0)
 .I FIRST W !,"Practitioner Patient Panel Totals:",! S FIRST=0
"RTN","SCRPPAT3",53,0)
 .W !!,$G(@STORE@("TH",INS,PRC)),$G(@STORE@("TOTAL",INS,PRC,0))
"RTN","SCRPPAT3",54,0)
 I 'STOP W !!,$G(@STORE@("TH",INS)),!
"RTN","SCRPPAT3",55,0)
 Q
"RTN","SCRPPAT3",56,0)
 ;
"RTN","SCRPPAT3",57,0)
HEAD2(INS,SEC,TRD,SEC3,ST3,ST4,POS) ;
"RTN","SCRPPAT3",58,0)
 I (SEC3="""TN""")&($D(@ST4@(INS,TRD,SEC))) D
"RTN","SCRPPAT3",59,0)
 .W !,$G(@ST3@(INS,SEC)) ;write team (sort 1)
"RTN","SCRPPAT3",60,0)
 .W !,$G(@ST4@(INS,TRD,SEC,POS)) ;write practitioner (sort 2)
"RTN","SCRPPAT3",61,0)
 I (SEC3="""PN""")&($D(@ST3@(INS,SEC,TRD))) D
"RTN","SCRPPAT3",62,0)
 .W !,$G(@ST3@(INS,SEC,TRD,POS)) ;write practitioner (sort 1)
"RTN","SCRPPAT3",63,0)
 .W !,$G(@ST4@(INS,TRD)) ;write team (sort 2)
"RTN","SCRPPAT3",64,0)
 Q
"RTN","SCRPPAT3",65,0)
 ;
"RTN","SCRPPAT3",66,0)
HEADER ;
"RTN","SCRPPAT3",67,0)
 N NXT
"RTN","SCRPPAT3",68,0)
 W !
"RTN","SCRPPAT3",69,0)
 F NXT="H1","H2","H3" W !,$G(@STORE@(NXT))
"RTN","SCRPPAT3",70,0)
 W !
"RTN","SCRPPAT3",71,0)
 Q
"RTN","SCRPPAT3",72,0)
 ;
"RTN","SCRPPAT3",73,0)
SHEAD ;
"RTN","SCRPPAT3",74,0)
 S @STORE@("H2")="Pt Name"
"RTN","SCRPPAT3",75,0)
 S $E(@STORE@("H2"),18)="Pt ID"
"RTN","SCRPPAT3",76,0)
 S $E(@STORE@("H1"),24)="M.T."
"RTN","SCRPPAT3",77,0)
 S $E(@STORE@("H2"),24)="Stat"
"RTN","SCRPPAT3",78,0)
 S $E(@STORE@("H2"),31)="Elig"
"RTN","SCRPPAT3",79,0)
 S $E(@STORE@("H1"),39)="Pat"
"RTN","SCRPPAT3",80,0)
 S $E(@STORE@("H2"),39)="Stat"
"RTN","SCRPPAT3",81,0)
 S $E(@STORE@("H1"),47)="Last"
"RTN","SCRPPAT3",82,0)
 S $E(@STORE@("H2"),47)="Appt"
"RTN","SCRPPAT3",83,0)
 S $E(@STORE@("H1"),57)="Nxt"
"RTN","SCRPPAT3",84,0)
 S $E(@STORE@("H2"),57)="Appt"
"RTN","SCRPPAT3",85,0)
 S $E(@STORE@("H2"),67)="Clinic"
"RTN","SCRPPAT3",86,0)
 S $P(@STORE@("H3"),"=",81)=""
"RTN","SCRPPAT3",87,0)
 Q
"RTN","SCRPPAT3",88,0)
ALL ;
"RTN","SCRPPAT3",89,0)
 ;get all practitioners for all teams selected
"RTN","SCRPPAT3",90,0)
 I TEAM=1 D TALL ;all teams selected
"RTN","SCRPPAT3",91,0)
 N TPRC,TIEN,OKAY
"RTN","SCRPPAT3",92,0)
 S TIEN=""
"RTN","SCRPPAT3",93,0)
 F  S TIEN=$O(TEAM(TIEN)) Q:TIEN=""!(TIEN'?.N)  D
"RTN","SCRPPAT3",94,0)
 .I $D(TEAM(TIEN)) D
"RTN","SCRPPAT3",95,0)
 ..S TPRC="PRACT"
"RTN","SCRPPAT3",96,0)
 ..S OKAY=$$PRTM^SCAPMC1(TIEN,"","","",.TPRC,"ERROR")
"RTN","SCRPPAT3",97,0)
 Q
"RTN","SCRPPAT3",98,0)
 ;
"RTN","SCRPPAT3",99,0)
TALL ;
"RTN","SCRPPAT3",100,0)
 ;get all active team for divisions selected
"RTN","SCRPPAT3",101,0)
 N NXT,IIEN,NODE
"RTN","SCRPPAT3",102,0)
 S NXT=0,IIEN=""
"RTN","SCRPPAT3",103,0)
 ;$O through team file and find all active teams for selected divisions
"RTN","SCRPPAT3",104,0)
 F  S IIEN=$O(^SCTM(404.51,"AINST",IIEN)) Q:IIEN=""  D
"RTN","SCRPPAT3",105,0)
 .I INST=1!$D(INST(IIEN)) D
"RTN","SCRPPAT3",106,0)
 ..S TIEN=0
"RTN","SCRPPAT3",107,0)
 ..F  S TIEN=$O(^SCTM(404.51,"AINST",IIEN,TIEN)) Q:TIEN=""  D
"RTN","SCRPPAT3",108,0)
 ...I $$ACTTM^SCMCTMU(TIEN) S TEAM(TIEN)=""
"RTN","SCRPPAT3",109,0)
 Q
"RTN","SCRPPAT3",110,0)
 ;
"RTN","SCRPPAT3",111,0)
SETUP(IIEN,INAME,TIEN,TNAME,PRAC,PNAME,POSN,TPI) ;
"RTN","SCRPPAT3",112,0)
 ;setup data
"RTN","SCRPPAT3",113,0)
 S IIEN=+$P($G(^SCTM(404.51,TIEN,0)),"^",7) ;institution ien
"RTN","SCRPPAT3",114,0)
 S INAME=$P($G(^DIC(4,IIEN,0)),"^") ;institution name
"RTN","SCRPPAT3",115,0)
 I INAME="" S INAME="[BAD DATA]"
"RTN","SCRPPAT3",116,0)
 ;
"RTN","SCRPPAT3",117,0)
 I PNAME="" S PNAME="[BAD DATA]"
"RTN","SCRPPAT3",118,0)
 I TNAME="" S TNAME="[BAD DATA]"
"RTN","SCRPPAT3",119,0)
 I '$D(@STORE@("PN",IIEN,PRAC,TIEN,TPI)) S @STORE@("PN",IIEN,PRAC,TIEN,TPI)="Practitioner: "_PNAME_" ("_POSN_")"
"RTN","SCRPPAT3",120,0)
 I '$D(@STORE@("TN",IIEN,TIEN)) S @STORE@("TN",IIEN,TIEN)="Team: "_TNAME
"RTN","SCRPPAT3",121,0)
 ;
"RTN","SCRPPAT3",122,0)
 I '$D(@STORE@("I",INAME,IIEN)) S @STORE@("I",INAME,IIEN)="",@STORE@(IIEN)="Division: "_INAME
"RTN","SCRPPAT3",123,0)
 I '$D(@STORE@("T",IIEN,TNAME,TIEN)) S @STORE@("T",IIEN,TNAME,TIEN)=""
"RTN","SCRPPAT3",124,0)
 I '$D(@STORE@("P",IIEN,PNAME,PRAC,TPI)) S @STORE@("P",IIEN,PNAME,PRAC,TPI)=""
"RTN","SCRPPAT3",125,0)
 I '$D(@STORE@("TOTAL",IIEN,PRAC,0)) S @STORE@("TOTAL",IIEN,PRAC,0)=0
"RTN","SCRPPAT3",126,0)
 I '$D(@STORE@("TOTAL",IIEN,PRAC,TIEN)) S @STORE@("TOTAL",IIEN,PRAC,TIEN)=0
"RTN","SCRPPAT3",127,0)
 ;
"RTN","SCRPPAT3",128,0)
 S @STORE@("TH",IIEN,PRAC)="Patient Panel Count for "_PNAME_": "
"RTN","SCRPPAT3",129,0)
 S @STORE@("TH",IIEN,PRAC,TIEN,TPI)="Patient Count for "_PNAME_" ("_POSN_") on Team "_TNAME_": "
"RTN","SCRPPAT3",130,0)
 ;
"RTN","SCRPPAT3",131,0)
 S @STORE@("TH",IIEN)="** Note: Patient Panel Count is a count of unique patients for each practitioner"
"RTN","SCRPPAT3",132,0)
 Q 0
"RTN","SCRPPAT3",133,0)
 ;
"RTN","SCRPRAC")
0^5^B14986422
"RTN","SCRPRAC",1,0)
SCRPRAC ;ALB/CMM - Practitioner Demographics ;02/08/96
"RTN","SCRPRAC",2,0)
 ;;5.3;Scheduling;**41,52**;AUG 13, 1993
"RTN","SCRPRAC",3,0)
 ;
"RTN","SCRPRAC",4,0)
 ;Practitioner Demographics Report
"RTN","SCRPRAC",5,0)
 ;
"RTN","SCRPRAC",6,0)
PROMPTS ;
"RTN","SCRPRAC",7,0)
 ;Prompt for Practioner and Print device
"RTN","SCRPRAC",8,0)
 ;
"RTN","SCRPRAC",9,0)
 K SCUP
"RTN","SCRPRAC",10,0)
 N QTIME,PRNT,VAUTP,Y,VAUTCI,NUMBER
"RTN","SCRPRAC",11,0)
 S QTIME=""
"RTN","SCRPRAC",12,0)
 S VAUTPO="" ;only can select one practitioner
"RTN","SCRPRAC",13,0)
 S VAUTNA="" ;all not allowed
"RTN","SCRPRAC",14,0)
 S VAUTT=1 ;all teams
"RTN","SCRPRAC",15,0)
 D PRACT^SCRPU1
"RTN","SCRPRAC",16,0)
 I '$D(VAUTP) G ERR
"RTN","SCRPRAC",17,0)
 S PRNT=$$PDEVICE^SCRPU3()
"RTN","SCRPRAC",18,0)
 I PRNT=-1 G ERR
"RTN","SCRPRAC",19,0)
 I PRNT["Q;" S QTIME=$$GETTIME^SCRPU3()
"RTN","SCRPRAC",20,0)
 I QTIME=-1 G ERR
"RTN","SCRPRAC",21,0)
 I PRNT'?1"Q;".E S PRNT="Q;"_PRNT
"RTN","SCRPRAC",22,0)
 S NUMBER=$$ENTRY2(.VAUTP,PRNT,QTIME)
"RTN","SCRPRAC",23,0)
 I NUMBER>0 W !!,"Print queued, task number: ",NUMBER
"RTN","SCRPRAC",24,0)
 Q
"RTN","SCRPRAC",25,0)
 ;
"RTN","SCRPRAC",26,0)
ENTRY2(PRACT,IOP,ZTDTH) ;
"RTN","SCRPRAC",27,0)
 ;Second entry point for GUI to use
"RTN","SCRPRAC",28,0)
 ;Input Parameters:
"RTN","SCRPRAC",29,0)
 ;PRACT - practitioner ien new person file
"RTN","SCRPRAC",30,0)
 ;IOP - print device
"RTN","SCRPRAC",31,0)
 ;ZTDTH - queue time (optional)
"RTN","SCRPRAC",32,0)
 ;
"RTN","SCRPRAC",33,0)
 ;validate parameters
"RTN","SCRPRAC",34,0)
 I '$D(PRACT)!'$D(IOP)!(IOP="") Q
"RTN","SCRPRAC",35,0)
 ;
"RTN","SCRPRAC",36,0)
 N NUMBER
"RTN","SCRPRAC",37,0)
 S IOST=$P(IOP,"^",2),IOP=$P(IOP,"^")
"RTN","SCRPRAC",38,0)
 I IOP?1"Q;".E S IOP=$P(IOP,"Q;",2)
"RTN","SCRPRAC",39,0)
 I IOST?1"C-".E D QENTRY G RET
"RTN","SCRPRAC",40,0)
 I ZTDTH="" S ZTDTH=$H
"RTN","SCRPRAC",41,0)
 S ZTRTN="QENTRY^SCRPRAC"
"RTN","SCRPRAC",42,0)
 S ZTDESC="Practitioner Demographics",ZTIO=IOP
"RTN","SCRPRAC",43,0)
 N II
"RTN","SCRPRAC",44,0)
 F II="PRACT(","PRACT","IOP" S ZTSAVE(II)=""
"RTN","SCRPRAC",45,0)
 D ^%ZTLOAD
"RTN","SCRPRAC",46,0)
RET S NUMBER=0
"RTN","SCRPRAC",47,0)
 I $D(ZTSK) S NUMBER=ZTSK
"RTN","SCRPRAC",48,0)
 D EXIT1
"RTN","SCRPRAC",49,0)
 Q NUMBER
"RTN","SCRPRAC",50,0)
 ;
"RTN","SCRPRAC",51,0)
QENTRY ;
"RTN","SCRPRAC",52,0)
 ;driver entry point
"RTN","SCRPRAC",53,0)
 S TITL="Practitioner Demographics"
"RTN","SCRPRAC",54,0)
 S STORE="^TMP("_$J_",""SCRPRAC"")"
"RTN","SCRPRAC",55,0)
 K @STORE
"RTN","SCRPRAC",56,0)
 S @STORE=0
"RTN","SCRPRAC",57,0)
 D DRIVE
"RTN","SCRPRAC",58,0)
 I $O(@STORE@(0))="" S NODATA=$$NODATA^SCRPU3(TITL)
"RTN","SCRPRAC",59,0)
 I '$D(NODATA) D PRINTIT(STORE,IOP,TITL)
"RTN","SCRPRAC",60,0)
 D EXIT2
"RTN","SCRPRAC",61,0)
 Q
"RTN","SCRPRAC",62,0)
 ;
"RTN","SCRPRAC",63,0)
ERR ;
"RTN","SCRPRAC",64,0)
EXIT1 ;
"RTN","SCRPRAC",65,0)
 K ZTDTH,ZTRTN,ZTDESC,ZTSK,ZTIO,ZTSAVE,VAUTPO,VAUTT,VAUTP,SCUP,VAUTNA
"RTN","SCRPRAC",66,0)
 Q
"RTN","SCRPRAC",67,0)
 ;
"RTN","SCRPRAC",68,0)
EXIT2 ;
"RTN","SCRPRAC",69,0)
 K @STORE
"RTN","SCRPRAC",70,0)
 K STORE,TITL,IOP,PRACT,NODATA,STOP
"RTN","SCRPRAC",71,0)
 Q
"RTN","SCRPRAC",72,0)
 ;
"RTN","SCRPRAC",73,0)
DRIVE ;
"RTN","SCRPRAC",74,0)
 ;driver module
"RTN","SCRPRAC",75,0)
 N PRAC,INF,ARRY,ERROR
"RTN","SCRPRAC",76,0)
 S ARRY="ARRAY",ERROR="ERR"
"RTN","SCRPRAC",77,0)
 K @ARRY,@ERROR
"RTN","SCRPRAC",78,0)
 S PRAC=$O(PRACT(0))
"RTN","SCRPRAC",79,0)
 Q:PRAC=""
"RTN","SCRPRAC",80,0)
 S INF=$$TPPR^SCAPMC12(PRAC,,,,ARRY,ERROR) ;get practitioner positions
"RTN","SCRPRAC",81,0)
 I INF=0 Q
"RTN","SCRPRAC",82,0)
 D GATHER^SCRPRAC2(.ARRY,PRAC)
"RTN","SCRPRAC",83,0)
 K @ERROR,@ARRY
"RTN","SCRPRAC",84,0)
 Q
"RTN","SCRPRAC",85,0)
 ;
"RTN","SCRPRAC",86,0)
PRINTIT(STORE,IOP,TITL) ;
"RTN","SCRPRAC",87,0)
 N TM,TPOS,NXT,PFLAG,PAGE,CIEN,ADAY
"RTN","SCRPRAC",88,0)
 K PFLAG
"RTN","SCRPRAC",89,0)
 S TPOS="",PAGE=1,STOP=0
"RTN","SCRPRAC",90,0)
 D OPEN^SCRPU3
"RTN","SCRPRAC",91,0)
 Q:$G(POP)
"RTN","SCRPRAC",92,0)
 D TITLE^SCRPU3(.PAGE,TITL)
"RTN","SCRPRAC",93,0)
 F  S TPOS=$O(@STORE@("P",TPOS)) Q:TPOS=""!(STOP)  D
"RTN","SCRPRAC",94,0)
 .S NXT=""
"RTN","SCRPRAC",95,0)
 .I IOST?1"C-".E,$Y>(IOSL-8) D HOLD^SCRPU3(.PAGE,TITL)
"RTN","SCRPRAC",96,0)
 .I IOST'?1"C-".E,$Y>(IOSL-8) D NEWP1^SCRPU3(.PAGE,TITL)
"RTN","SCRPRAC",97,0)
 .I STOP Q
"RTN","SCRPRAC",98,0)
 .F  S NXT=$O(@STORE@(TPOS,NXT)) Q:NXT=""!($D(PFLAG))!(STOP)  D
"RTN","SCRPRAC",99,0)
 ..W !,$G(@STORE@(TPOS,NXT))
"RTN","SCRPRAC",100,0)
 .S PFLAG=""
"RTN","SCRPRAC",101,0)
 .W !,""
"RTN","SCRPRAC",102,0)
 .S TM=""
"RTN","SCRPRAC",103,0)
 .F  S TM=$O(@STORE@(TPOS,TM)) Q:TM=""!(STOP)  D
"RTN","SCRPRAC",104,0)
 ..S NXT=""
"RTN","SCRPRAC",105,0)
 ..I IOST?1"C-".E,$Y>(IOSL-8) D HOLD^SCRPU3(.PAGE,TITL) Q:STOP  D HEAD^SCRPRAC2(TPOS)
"RTN","SCRPRAC",106,0)
 ..I IOST'?1"C-".E,$Y>(IOSL-8) D NEWP1^SCRPU3(.PAGE,TITL) Q:STOP  D HEAD^SCRPRAC2(TPOS)
"RTN","SCRPRAC",107,0)
 ..F  S NXT=$O(@STORE@(TPOS,TM,NXT)) Q:NXT=""!(STOP)  D
"RTN","SCRPRAC",108,0)
 ...W !,$G(@STORE@(TPOS,TM,NXT))
"RTN","SCRPRAC",109,0)
 ..;
"RTN","SCRPRAC",110,0)
 ..I '$D(@STORE@("C",TM)) Q
"RTN","SCRPRAC",111,0)
 ..;clinic data
"RTN","SCRPRAC",112,0)
 ..S CIEN=""
"RTN","SCRPRAC",113,0)
 ..F  S CIEN=$O(@STORE@("C",TM,CIEN)) Q:CIEN=""!(STOP)  D
"RTN","SCRPRAC",114,0)
 ...I IOST?1"C-".E,$Y>(IOSL-10) D HOLD^SCRPU3(.PAGE,TITL) Q:STOP  D HEAD^SCRPRAC2(TPOS)
"RTN","SCRPRAC",115,0)
 ...I IOST'?1"C-".E,$Y>(IOSL-10) D NEWP1^SCRPU3(.PAGE,TITL) Q:STOP  D HEAD^SCRPRAC2(TPOS)
"RTN","SCRPRAC",116,0)
 ...W !,$G(@STORE@(1,TM,TPOS,CIEN))
"RTN","SCRPRAC",117,0)
 D CLOSE^SCRPU3
"RTN","SCRPRAC",118,0)
 Q
"RTN","SCRPSLT")
0^6^B22330664
"RTN","SCRPSLT",1,0)
SCRPSLT ;ALB/CMM - Summary Listing of Teams ;02/01/96
"RTN","SCRPSLT",2,0)
 ;;5.3;Scheduling;**41,52**;AUG 13, 1993
"RTN","SCRPSLT",3,0)
 ;
"RTN","SCRPSLT",4,0)
 ;Summary Listing of Teams Report
"RTN","SCRPSLT",5,0)
 ;
"RTN","SCRPSLT",6,0)
PROMPTS ;
"RTN","SCRPSLT",7,0)
 ;Prompt for Institution, Team, Role and Print device
"RTN","SCRPSLT",8,0)
 ;
"RTN","SCRPSLT",9,0)
 N VAUTD,VAUTT,VAUTR,QTIME,PRNT,NUMBER
"RTN","SCRPSLT",10,0)
 K VAUTD,VAUTT,VAUTR,SCUP
"RTN","SCRPSLT",11,0)
 S QTIME=""
"RTN","SCRPSLT",12,0)
 D INST^SCRPU1 I Y=-1 G ERR
"RTN","SCRPSLT",13,0)
 K Y D PRMTT^SCRPU1 I '$D(VAUTT) G ERR
"RTN","SCRPSLT",14,0)
 K Y D ROLE^SCRPU1 I '$D(VAUTR) G ERR
"RTN","SCRPSLT",15,0)
 S PRNT=$$PDEVICE^SCRPU3()
"RTN","SCRPSLT",16,0)
 I PRNT=-1 G ERR
"RTN","SCRPSLT",17,0)
 I PRNT["Q;" S QTIME=$$GETTIME^SCRPU3()
"RTN","SCRPSLT",18,0)
 I QTIME=-1 G ERR
"RTN","SCRPSLT",19,0)
 I PRNT'?1"Q;".E S PRNT="Q;"_PRNT
"RTN","SCRPSLT",20,0)
 K Y
"RTN","SCRPSLT",21,0)
 S NUMBER=$$ENTRY2(.VAUTD,.VAUTT,.VAUTR,PRNT,QTIME)
"RTN","SCRPSLT",22,0)
 I NUMBER>0 W !!,"Print queued, task number: ",NUMBER
"RTN","SCRPSLT",23,0)
 Q
"RTN","SCRPSLT",24,0)
 ;
"RTN","SCRPSLT",25,0)
ENTRY2(INST,TEAM,ROLE,IOP,ZTDTH) ;
"RTN","SCRPSLT",26,0)
 ;Second entry point for GUI to use
"RTN","SCRPSLT",27,0)
 ;Input Parameters:
"RTN","SCRPSLT",28,0)
 ;INST - institutions selected (variable and array)
"RTN","SCRPSLT",29,0)
 ;TEAM - teams selected (variable and array)
"RTN","SCRPSLT",30,0)
 ;ROLE - roles selected (variable and array)
"RTN","SCRPSLT",31,0)
 ;IOP - print device
"RTN","SCRPSLT",32,0)
 ;ZTDTH - queue time (optional)
"RTN","SCRPSLT",33,0)
 ;
"RTN","SCRPSLT",34,0)
 ;validate parameters
"RTN","SCRPSLT",35,0)
 I '$D(INST)!'$D(TEAM)!'$D(ROLE)!'$D(IOP)!(IOP="") Q
"RTN","SCRPSLT",36,0)
 ;
"RTN","SCRPSLT",37,0)
 N NUMBER
"RTN","SCRPSLT",38,0)
 S IOST=$P(IOP,"^",2),IOP=$P(IOP,"^")
"RTN","SCRPSLT",39,0)
 I IOP?1"Q;".E S IOP=$P(IOP,"Q;",2)
"RTN","SCRPSLT",40,0)
 I IOST?1"C-".E D QENTRY G RET
"RTN","SCRPSLT",41,0)
 I ZTDTH="" S ZTDTH=$H
"RTN","SCRPSLT",42,0)
 S ZTRTN="QENTRY^SCRPSLT"
"RTN","SCRPSLT",43,0)
 S ZTDESC="Summary Listing Of Teams",ZTIO=IOP
"RTN","SCRPSLT",44,0)
 N II
"RTN","SCRPSLT",45,0)
 F II="INST","TEAM","ROLE","INST(","TEAM(","ROLE(","IOP" S ZTSAVE(II)=""
"RTN","SCRPSLT",46,0)
 D ^%ZTLOAD
"RTN","SCRPSLT",47,0)
RET S NUMBER=0
"RTN","SCRPSLT",48,0)
 I $D(ZTSK) S NUMBER=ZTSK
"RTN","SCRPSLT",49,0)
 D EXIT1
"RTN","SCRPSLT",50,0)
 Q NUMBER
"RTN","SCRPSLT",51,0)
 ;
"RTN","SCRPSLT",52,0)
QENTRY ;
"RTN","SCRPSLT",53,0)
 ;driver entry point
"RTN","SCRPSLT",54,0)
 S TITL="Summary Listing of Teams Report"
"RTN","SCRPSLT",55,0)
 S STORE="^TMP("_$J_",""SCRPSLT"")"
"RTN","SCRPSLT",56,0)
 K @STORE
"RTN","SCRPSLT",57,0)
 S @STORE=0
"RTN","SCRPSLT",58,0)
 I TEAM=1 D TALL^SCRPPAT3 S TEAM=0
"RTN","SCRPSLT",59,0)
 D FIND
"RTN","SCRPSLT",60,0)
 I $O(@STORE@(0))="" S NODATA=$$NODATA^SCRPU3(TITL)
"RTN","SCRPSLT",61,0)
 I '$D(NODATA) D PRINTIT(STORE,IOP,TITL)
"RTN","SCRPSLT",62,0)
 D EXIT2
"RTN","SCRPSLT",63,0)
 Q
"RTN","SCRPSLT",64,0)
 ;
"RTN","SCRPSLT",65,0)
ERR ;
"RTN","SCRPSLT",66,0)
EXIT1 ;
"RTN","SCRPSLT",67,0)
 K ZTDTH,ZTRTN,ZTDESC,ZTSK,ZTIO,ZTSAVE,SCUP
"RTN","SCRPSLT",68,0)
 Q
"RTN","SCRPSLT",69,0)
 ;
"RTN","SCRPSLT",70,0)
EXIT2 ;
"RTN","SCRPSLT",71,0)
 K @STORE
"RTN","SCRPSLT",72,0)
 K STOP,STORE,TITL,IOP,TEAM,INST,ROLE,NODATA
"RTN","SCRPSLT",73,0)
 Q
"RTN","SCRPSLT",74,0)
 ;
"RTN","SCRPSLT",75,0)
FIND ;
"RTN","SCRPSLT",76,0)
 N TM,EN2,EN,ROL,NODE,TEND,ACT,INA,TPASS,TPCN,TMAX,TMP,TOA
"RTN","SCRPSLT",77,0)
 S TM=""
"RTN","SCRPSLT",78,0)
 F  S TM=$O(^SCTM(404.57,"C",TM)) Q:TM=""  D
"RTN","SCRPSLT",79,0)
 .;$O through team position file
"RTN","SCRPSLT",80,0)
 .I '$D(TEAM(TM))&(TEAM'=1) Q
"RTN","SCRPSLT",81,0)
 .;Q above, not a selected team
"RTN","SCRPSLT",82,0)
 .;selected team
"RTN","SCRPSLT",83,0)
 .S EN=""
"RTN","SCRPSLT",84,0)
 .S TPASS(TM)=0,TMAX(TM)=0,TPCN(TM)=0
"RTN","SCRPSLT",85,0)
 .F  S EN=$O(^SCTM(404.57,"C",TM,EN)) Q:EN=""  D
"RTN","SCRPSLT",86,0)
 ..I '$D(^SCTM(404.57,EN,0)) Q
"RTN","SCRPSLT",87,0)
 ..S NODE=$G(^SCTM(404.57,EN,0))
"RTN","SCRPSLT",88,0)
 ..Q:NODE=""
"RTN","SCRPSLT",89,0)
 ..S ROL=+$P(NODE,"^",3) ;role ien
"RTN","SCRPSLT",90,0)
 ..I '$D(ROLE(ROL))&(ROLE'=1) Q
"RTN","SCRPSLT",91,0)
 ..;Q above not a selected role
"RTN","SCRPSLT",92,0)
 ..;find active position during date range
"RTN","SCRPSLT",93,0)
 ..S TMP=$$DATES^SCAPMCU1(404.52,EN,DT)
"RTN","SCRPSLT",94,0)
 ..I +TMP=0 S TMP="0^[Not Assigned]"
"RTN","SCRPSLT",95,0)
 ..S EN2=+$P(TMP,"^",4)
"RTN","SCRPSLT",96,0)
 ..D KEEP^SCRPSLT2(NODE,EN,EN2,ROL,TM,.TPASS,.TMAX,.TPCN)
"RTN","SCRPSLT",97,0)
 ..S TOA(TM)=$G(TMAX(TM))-$G(TPASS(TM))
"RTN","SCRPSLT",98,0)
 ..D TEAMT^SCRPSLT2(TM,.TPASS,.TMAX,.TPCN,.TOA)
"RTN","SCRPSLT",99,0)
 Q
"RTN","SCRPSLT",100,0)
 ;
"RTN","SCRPSLT",101,0)
PRINTIT(STORE,IOP,TITL) ;
"RTN","SCRPSLT",102,0)
 D OPEN^SCRPU3
"RTN","SCRPSLT",103,0)
 Q:$G(POP)
"RTN","SCRPSLT",104,0)
 N INST,EINST,ETEAM,TEM,EPRACT,PRACT,NXT,PAGE,NPAGE,NEW,POS
"RTN","SCRPSLT",105,0)
 S (INST,EINST)="",(NPAGE,STOP)=0,PAGE=1
"RTN","SCRPSLT",106,0)
 D TITLE^SCRPU3(.PAGE,TITL)
"RTN","SCRPSLT",107,0)
 D FORHEAD^SCRPSLT2
"RTN","SCRPSLT",108,0)
 F  S EINST=$O(@STORE@("I",EINST)) Q:EINST=""!(STOP)  D
"RTN","SCRPSLT",109,0)
 .S INST=$O(@STORE@("I",EINST,""))
"RTN","SCRPSLT",110,0)
 .I INST="" Q
"RTN","SCRPSLT",111,0)
 .S (TEM,ETEAM)=""
"RTN","SCRPSLT",112,0)
 .F  S ETEAM=$O(@STORE@("T",INST,ETEAM)) Q:ETEAM=""!(STOP)  D
"RTN","SCRPSLT",113,0)
 ..S TEM=$O(@STORE@("T",INST,ETEAM,""))
"RTN","SCRPSLT",114,0)
 ..I TEM="" Q
"RTN","SCRPSLT",115,0)
 ..K NEW
"RTN","SCRPSLT",116,0)
 ..I NPAGE,(IOST'?1"C-".E) D NEWP^SCRPSLT2(INST,TEM,TITL,.PAGE) S NPAGE=0,NEW=""
"RTN","SCRPSLT",117,0)
 ..I NPAGE,(IOST?1"C-".E) D HOLD1^SCRPSLT2(.PAGE,TITL,INST,TEM) S NPAGE=0,NEW=""
"RTN","SCRPSLT",118,0)
 ..I STOP Q
"RTN","SCRPSLT",119,0)
 ..I IOST'?1"C-".E,$Y>(IOSL-8) D NEWP^SCRPSLT2(INST,TEM,TITL,.PAGE) S NEW=""
"RTN","SCRPSLT",120,0)
 ..I IOST?1"C-".E,$Y>(IOSL-8) D HOLD1^SCRPSLT2(.PAGE,TITL,INST,TEM) S NEW=""
"RTN","SCRPSLT",121,0)
 ..I STOP Q
"RTN","SCRPSLT",122,0)
 ..I '$D(NEW) D HEADER^SCRPSLT2(INST,TEM)
"RTN","SCRPSLT",123,0)
 ..S (PRACT,EPRACT)=""
"RTN","SCRPSLT",124,0)
 ..F  S EPRACT=$O(@STORE@("PN",INST,TEM,EPRACT)) Q:EPRACT=""!(STOP)  D
"RTN","SCRPSLT",125,0)
 ...S PRACT=$O(@STORE@("PN",INST,TEM,EPRACT,""))
"RTN","SCRPSLT",126,0)
 ...I PRACT="" Q
"RTN","SCRPSLT",127,0)
 ...S POS=""
"RTN","SCRPSLT",128,0)
 ...F  S POS=$O(@STORE@(INST,TEM,PRACT,POS)) Q:POS=""!(STOP)  D
"RTN","SCRPSLT",129,0)
 ....I IOST'?1"C-".E,$Y>(IOSL-3) D NEWP^SCRPSLT2(INST,TEM,TITL,.PAGE)
"RTN","SCRPSLT",130,0)
 ....I IOST?1"C-".E,$Y>(IOSL-3) D HOLD1^SCRPSLT2(.PAGE,TITL,INST,TEM)
"RTN","SCRPSLT",131,0)
 ....I STOP Q
"RTN","SCRPSLT",132,0)
 ....W !,$G(@STORE@(INST,TEM,PRACT,POS)) ;writes info
"RTN","SCRPSLT",133,0)
 ..D TOTAL^SCRPSLT2(INST,TEM)
"RTN","SCRPSLT",134,0)
 .I STOP Q
"RTN","SCRPSLT",135,0)
 .S NPAGE=1
"RTN","SCRPSLT",136,0)
 D CLOSE^SCRPU3
"RTN","SCRPSLT",137,0)
 Q
"RTN","SCRPSLT",138,0)
 ;
"RTN","SCRPTA")
0^7^B27987502
"RTN","SCRPTA",1,0)
SCRPTA ;ALB/CMM - Patient Listing w/Team Assignment Data ;02/22/96
"RTN","SCRPTA",2,0)
 ;;5.3;Scheduling;**41,48,52**;AUG 13, 1993
"RTN","SCRPTA",3,0)
 ;
"RTN","SCRPTA",4,0)
 ;Patient Listing w/Team Assignment Data Report
"RTN","SCRPTA",5,0)
 ;
"RTN","SCRPTA",6,0)
PROMPTS ;
"RTN","SCRPTA",7,0)
 ;Prompt for Institution, Team, Role, Practitioner and Print device
"RTN","SCRPTA",8,0)
 ;
"RTN","SCRPTA",9,0)
 N PRNT,QTIME,NUMBER
"RTN","SCRPTA",10,0)
 K VAUTD,VAUTT,VAUTR,VAUTP,VAUTPP,SCUP
"RTN","SCRPTA",11,0)
 S QTIME=""
"RTN","SCRPTA",12,0)
 D INST^SCRPU1 I Y=-1 G ERR
"RTN","SCRPTA",13,0)
 K Y D PRMTT^SCRPU1 I '$D(VAUTT) G ERR
"RTN","SCRPTA",14,0)
 K Y D ROLE^SCRPU1 I '$D(VAUTR) G ERR
"RTN","SCRPTA",15,0)
 K Y S VAUTPP="" D PRACT^SCRPU1 K VAUTPP I '$D(VAUTP) G ERR
"RTN","SCRPTA",16,0)
 S PRNT=$$PDEVICE^SCRPU3()
"RTN","SCRPTA",17,0)
 I PRNT=-1 G ERR
"RTN","SCRPTA",18,0)
 I PRNT["Q;" S QTIME=$$GETTIME^SCRPU3()
"RTN","SCRPTA",19,0)
 I QTIME=-1 G ERR
"RTN","SCRPTA",20,0)
 I PRNT'?1"Q;".E S PRNT="Q;"_PRNT
"RTN","SCRPTA",21,0)
 K Y
"RTN","SCRPTA",22,0)
 S NUMBER=$$ENTRY2(.VAUTD,.VAUTT,.VAUTR,.VAUTP,PRNT,QTIME)
"RTN","SCRPTA",23,0)
 I NUMBER>0 W !!,"Print queued, task number: ",NUMBER
"RTN","SCRPTA",24,0)
 Q
"RTN","SCRPTA",25,0)
 ;
"RTN","SCRPTA",26,0)
ENTRY2(INST,TEAM,ROLE,PRACT,IOP,ZTDTH) ;
"RTN","SCRPTA",27,0)
 ;Second entry point for GUI to use
"RTN","SCRPTA",28,0)
 ;Input Parameters:
"RTN","SCRPTA",29,0)
 ;INST - institutions selected (variable and array)
"RTN","SCRPTA",30,0)
 ;TEAM - teams selected (variable and array)
"RTN","SCRPTA",31,0)
 ;ROLE - roles selected (variable and array)
"RTN","SCRPTA",32,0)
 ;PRACT - practitioners selected (variable and array)
"RTN","SCRPTA",33,0)
 ;IOP - print device
"RTN","SCRPTA",34,0)
 ;ZTDTH - queue time (optional)
"RTN","SCRPTA",35,0)
 ;
"RTN","SCRPTA",36,0)
 ;validate parameters
"RTN","SCRPTA",37,0)
 I '$D(INST)!'$D(TEAM)!'$D(ROLE)!'$D(PRACT)!'$D(IOP)!(IOP="") Q
"RTN","SCRPTA",38,0)
 ;
"RTN","SCRPTA",39,0)
 N NUMBER
"RTN","SCRPTA",40,0)
 S IOST=$P(IOP,"^",2),IOP=$P(IOP,"^")
"RTN","SCRPTA",41,0)
 I IOP?1"Q;".E S IOP=$P(IOP,"Q;",2)
"RTN","SCRPTA",42,0)
 I IOST?1"C-".E D QENTRY G RET
"RTN","SCRPTA",43,0)
 I ZTDTH="" S ZTDTH=$H
"RTN","SCRPTA",44,0)
 S ZTRTN="QENTRY^SCRPTA"
"RTN","SCRPTA",45,0)
 S ZTDESC="Patient Listing w/Team Assignment",ZTIO=IOP
"RTN","SCRPTA",46,0)
 N II
"RTN","SCRPTA",47,0)
 F II="INST","TEAM","ROLE","INST(","TEAM(","PRACT","PRACT(","ROLE(","IOP" S ZTSAVE(II)=""
"RTN","SCRPTA",48,0)
 D ^%ZTLOAD
"RTN","SCRPTA",49,0)
RET S NUMBER=0
"RTN","SCRPTA",50,0)
 I $D(ZTSK) S NUMBER=ZTSK
"RTN","SCRPTA",51,0)
 D EXIT1
"RTN","SCRPTA",52,0)
 Q NUMBER
"RTN","SCRPTA",53,0)
 ;
"RTN","SCRPTA",54,0)
QENTRY ;
"RTN","SCRPTA",55,0)
 ;driver entry point
"RTN","SCRPTA",56,0)
 S TITL="Patient Listing w/Team Assignment Data"
"RTN","SCRPTA",57,0)
 S STORE="^TMP("_$J_",""SCRPTA"")"
"RTN","SCRPTA",58,0)
 K @STORE
"RTN","SCRPTA",59,0)
 S @STORE=0
"RTN","SCRPTA",60,0)
 I TEAM=1 D TALL^SCRPPAT3 S TEAM=0
"RTN","SCRPTA",61,0)
 D FIND
"RTN","SCRPTA",62,0)
 I $O(@STORE@(0))="" S NODATA=$$NODATA^SCRPU3(TITL)
"RTN","SCRPTA",63,0)
 I '$D(NODATA) D PRINTIT(STORE,IOP,TITL)
"RTN","SCRPTA",64,0)
 D EXIT2
"RTN","SCRPTA",65,0)
 Q
"RTN","SCRPTA",66,0)
 ;
"RTN","SCRPTA",67,0)
ERR ;
"RTN","SCRPTA",68,0)
EXIT1 ;
"RTN","SCRPTA",69,0)
 K ZTDTH,ZTRTN,ZTDESC,ZTSK,ZTIO,ZTSAVE,Y,SCUP
"RTN","SCRPTA",70,0)
 Q
"RTN","SCRPTA",71,0)
 ;
"RTN","SCRPTA",72,0)
EXIT2 ;
"RTN","SCRPTA",73,0)
 K @STORE
"RTN","SCRPTA",74,0)
 K STOP,STORE,TITL,IOP,TEAM,INST,ROLE,NODATA,PRACT
"RTN","SCRPTA",75,0)
 Q
"RTN","SCRPTA",76,0)
 ;
"RTN","SCRPTA",77,0)
FIND ;
"RTN","SCRPTA",78,0)
 N NXT,TLIST,TERR,CNT,ERR1,TNODE,NODE1,PIEN,PTAIEN
"RTN","SCRPTA",79,0)
 S NXT=0,TLIST="^TMP("_$J_",""SCRPTA"",""LIST1"")",TERR="ERR1"
"RTN","SCRPTA",80,0)
 K @TLIST,@TERR
"RTN","SCRPTA",81,0)
 F  S NXT=$O(TEAM(NXT)) Q:NXT=""!(NXT'?.N)  D
"RTN","SCRPTA",82,0)
 .S ERR1=$$PTTM^SCAPMC2(NXT,,.TLIST,.TERR) ;Patients assigned to team NXT
"RTN","SCRPTA",83,0)
 .Q:ERR1=0
"RTN","SCRPTA",84,0)
 .S CNT=0
"RTN","SCRPTA",85,0)
 .F  S CNT=$O(@TLIST@(CNT)) Q:CNT=""!(CNT'?.N)  D
"RTN","SCRPTA",86,0)
 ..S TNODE=$G(@TLIST@(CNT))
"RTN","SCRPTA",87,0)
 ..Q:TNODE=""
"RTN","SCRPTA",88,0)
 ..S PIEN=+$P(TNODE,"^") ;patient ien
"RTN","SCRPTA",89,0)
 ..S PTAIEN=+$P(TNODE,"^",3) ;ien Patient Team Assignment #404.42
"RTN","SCRPTA",90,0)
 ..D CHK^SCRPTA2(PTAIEN,PIEN)
"RTN","SCRPTA",91,0)
 .K @TLIST,@TERR
"RTN","SCRPTA",92,0)
 K @TLIST,@TERR
"RTN","SCRPTA",93,0)
 Q
"RTN","SCRPTA",94,0)
 ;
"RTN","SCRPTA",95,0)
PRINTIT(STORE,IOP,TITL) ;
"RTN","SCRPTA",96,0)
 D OPEN^SCRPU3
"RTN","SCRPTA",97,0)
 Q:$G(POP)
"RTN","SCRPTA",98,0)
 N NXT,PAGE,NPAGE,INTN,TMN,INT,TM,PRN,PR,NEW,POS
"RTN","SCRPTA",99,0)
 S (NPAGE,STOP)=0,PAGE=1,(INTN,NEW)=""
"RTN","SCRPTA",100,0)
 D SHEAD ;setup headers
"RTN","SCRPTA",101,0)
 D TITLE^SCRPU3(.PAGE,TITL) ;write title
"RTN","SCRPTA",102,0)
 F  S INTN=$O(@STORE@("I",INTN)) Q:INTN=""!(STOP)  D
"RTN","SCRPTA",103,0)
 .S INT=$O(@STORE@("I",INTN,"")) ;institution
"RTN","SCRPTA",104,0)
 .Q:INT=""
"RTN","SCRPTA",105,0)
 .I '$D(NEW),(IOST'?1"C-".E) D NEWP1^SCRPU3(.PAGE,TITL)
"RTN","SCRPTA",106,0)
 .I '$D(NEW),(IOST?1"C-".E) D HOLD^SCRPU3(.PAGE,TITL)
"RTN","SCRPTA",107,0)
 .Q:STOP
"RTN","SCRPTA",108,0)
 .W !,$G(@STORE@(INT))
"RTN","SCRPTA",109,0)
 .K NEW
"RTN","SCRPTA",110,0)
 .S TMN=""
"RTN","SCRPTA",111,0)
 .F  S TMN=$O(@STORE@("T",INT,TMN)) Q:TMN=""!(STOP)  D
"RTN","SCRPTA",112,0)
 ..S TM=$O(@STORE@("T",INT,TMN,"")) ;team
"RTN","SCRPTA",113,0)
 ..Q:TM=""
"RTN","SCRPTA",114,0)
 ..I (IOST'?1"C-".E),$Y>(IOSL-8) D NEWP1^SCRPU3(.PAGE,TITL) W:'STOP !,$G(@STORE@(INT))
"RTN","SCRPTA",115,0)
 ..I (IOST?1"C-".E),$Y>(IOSL-8) D HOLD^SCRPU3(.PAGE,TITL) W:'STOP !,$G(@STORE@(INT))
"RTN","SCRPTA",116,0)
 ..Q:STOP
"RTN","SCRPTA",117,0)
 ..W !!,$G(@STORE@(INT,TM))
"RTN","SCRPTA",118,0)
 ..I (IOST'?1"C-".E),$Y>(IOSL-10) D NEWP1^SCRPU3(.PAGE,TITL) W:'STOP !,$G(@STORE@(INT)),!!,$G(@STORE@(INT,TM))
"RTN","SCRPTA",119,0)
 ..I (IOST?1"C-".E),$Y>(IOSL-10) D HOLD^SCRPU3(.PAGE,TITL) W:'STOP !,$G(@STORE@(INT)),!!,$G(@STORE@(INT,TM))
"RTN","SCRPTA",120,0)
 ..Q:STOP
"RTN","SCRPTA",121,0)
 ..S PRN=""
"RTN","SCRPTA",122,0)
 ..D HEADER
"RTN","SCRPTA",123,0)
 ..F  S PRN=$O(@STORE@("P",INT,TM,PRN)) Q:PRN=""!(STOP)  D
"RTN","SCRPTA",124,0)
 ...S PR=$O(@STORE@("P",INT,TM,PRN,"")) ;practitioner
"RTN","SCRPTA",125,0)
 ...Q:PR=""
"RTN","SCRPTA",126,0)
 ...S POS=""
"RTN","SCRPTA",127,0)
 ...F  S POS=$O(@STORE@("P",INT,TM,PRN,PR,POS)) Q:POS=""!(STOP)  D
"RTN","SCRPTA",128,0)
 ....D PRNT(INT,TM,PR,POS)
"RTN","SCRPTA",129,0)
 D CLOSE^SCRPU3
"RTN","SCRPTA",130,0)
 Q
"RTN","SCRPTA",131,0)
 ;
"RTN","SCRPTA",132,0)
PRNT(INT,TM,PR,POS) ;
"RTN","SCRPTA",133,0)
 ;INT - institution ien
"RTN","SCRPTA",134,0)
 ;TM - team ien
"RTN","SCRPTA",135,0)
 ;PR - practitioner ien
"RTN","SCRPTA",136,0)
 ;POS - position ien
"RTN","SCRPTA",137,0)
 ;
"RTN","SCRPTA",138,0)
 N PTIEN
"RTN","SCRPTA",139,0)
 S PTIEN=""
"RTN","SCRPTA",140,0)
 F  S PTIEN=$O(@STORE@(INT,TM,PR,POS,PTIEN)) Q:PTIEN=""  D
"RTN","SCRPTA",141,0)
 .I (IOST'?1"C-".E),$Y>(IOSL-4) D NEWP1^SCRPU3(.PAGE,TITL) W:'STOP !,$G(@STORE@(INT)),!!,$G(@STORE@(INT,TM)) D HEADER
"RTN","SCRPTA",142,0)
 .I (IOST?1"C-".E),$Y>(IOSL-4) D HOLD^SCRPU3(.PAGE,TITL) W:'STOP !,$G(@STORE@(INT)),!!,$G(@STORE@(INT,TM)) D HEADER
"RTN","SCRPTA",143,0)
 .Q:STOP
"RTN","SCRPTA",144,0)
 .W !,$G(@STORE@(INT,TM,PR,POS,PTIEN))
"RTN","SCRPTA",145,0)
 Q
"RTN","SCRPTA",146,0)
 ;
"RTN","SCRPTA",147,0)
HEADER ;
"RTN","SCRPTA",148,0)
 ;write column headers
"RTN","SCRPTA",149,0)
 N EN
"RTN","SCRPTA",150,0)
 W !
"RTN","SCRPTA",151,0)
 F EN="H1","H2","H3" D
"RTN","SCRPTA",152,0)
 .W !,$G(@STORE@(EN))
"RTN","SCRPTA",153,0)
 Q
"RTN","SCRPTA",154,0)
SHEAD ;
"RTN","SCRPTA",155,0)
 ;setup column headers
"RTN","SCRPTA",156,0)
 S @STORE@("H2")="Pt Name"
"RTN","SCRPTA",157,0)
 S $E(@STORE@("H2"),23)="Pt ID"
"RTN","SCRPTA",158,0)
 S $E(@STORE@("H2"),30)="Practitioner"
"RTN","SCRPTA",159,0)
 S $E(@STORE@("H2"),52)="Position"
"RTN","SCRPTA",160,0)
 S $E(@STORE@("H1"),70)="Date"
"RTN","SCRPTA",161,0)
 S $E(@STORE@("H2"),70)="Assigned"
"RTN","SCRPTA",162,0)
 S $P(@STORE@("H3"),"=",81)=""
"RTN","SCRPTA",163,0)
 Q
"RTN","SCRPTM")
0^8^B27790777
"RTN","SCRPTM",1,0)
SCRPTM ;ALB/CMM - List of Team's Members Report ;01/29/96
"RTN","SCRPTM",2,0)
 ;;5.3;Scheduling;**41,48,52**;AUG 13, 1993
"RTN","SCRPTM",3,0)
 ;
"RTN","SCRPTM",4,0)
 ;List of Team's Members Report
"RTN","SCRPTM",5,0)
 ;
"RTN","SCRPTM",6,0)
PROMPTS ;
"RTN","SCRPTM",7,0)
 ;Prompt for Institution, Team, Date Range, User Class, Role
"RTN","SCRPTM",8,0)
 ;and Print device
"RTN","SCRPTM",9,0)
 ;
"RTN","SCRPTM",10,0)
 N VAUTD,VAUTT,VAUTUC,VAUTR,QTIME,RANG,PRNT,NUMBER
"RTN","SCRPTM",11,0)
 K VAUTD,VAUTT,VAUTUC,VAUTR,SCUP
"RTN","SCRPTM",12,0)
 S QTIME=""
"RTN","SCRPTM",13,0)
 D INST^SCRPU1 I Y=-1 G ERR
"RTN","SCRPTM",14,0)
 K Y D PRMTT^SCRPU1 I '$D(VAUTT) G ERR
"RTN","SCRPTM",15,0)
 K Y S RANG=$$DTRANG^SCRPU2() I +RANG=-1 G ERR
"RTN","SCRPTM",16,0)
 K Y D USER^SCRPU1 I '$D(VAUTUC)&($P($G(^SD(404.91,1,"PCMM")),"^")=1) G ERR
"RTN","SCRPTM",17,0)
 K Y D ROLE^SCRPU1 I '$D(VAUTR) G ERR
"RTN","SCRPTM",18,0)
 S PRNT=$$PDEVICE^SCRPU3()
"RTN","SCRPTM",19,0)
 I PRNT=-1 G ERR
"RTN","SCRPTM",20,0)
 I PRNT["Q;" S QTIME=$$GETTIME^SCRPU3()
"RTN","SCRPTM",21,0)
 I QTIME=-1 G ERR
"RTN","SCRPTM",22,0)
 I PRNT'?1"Q;".E S PRNT="Q;"_PRNT
"RTN","SCRPTM",23,0)
 K Y
"RTN","SCRPTM",24,0)
 S NUMBER=$$ENTRY2(.VAUTD,.VAUTT,.VAUTUC,.VAUTR,RANG,PRNT,QTIME)
"RTN","SCRPTM",25,0)
 I NUMBER>0 W !!,"Print queued, task number: ",NUMBER
"RTN","SCRPTM",26,0)
 Q
"RTN","SCRPTM",27,0)
 ;
"RTN","SCRPTM",28,0)
ENTRY2(INST,TEAM,USERC,ROLE,RANGE,IOP,ZTDTH) ;
"RTN","SCRPTM",29,0)
 ;Second entry point for GUI to use
"RTN","SCRPTM",30,0)
 ;Input Parameters:
"RTN","SCRPTM",31,0)
 ;INST - institutions selected (variable and array)
"RTN","SCRPTM",32,0)
 ;TEAM - teams selected (variable and array)
"RTN","SCRPTM",33,0)
 ;USERC - user classes selected (variable and array)
"RTN","SCRPTM",34,0)
 ;ROLE - roles selected (variable and array)
"RTN","SCRPTM",35,0)
 ;RANGE - date range selected (begin date ^ end date)
"RTN","SCRPTM",36,0)
 ;IOP - print device
"RTN","SCRPTM",37,0)
 ;ZTDTH - queue time (optional)
"RTN","SCRPTM",38,0)
 ;
"RTN","SCRPTM",39,0)
 ;validate parameters
"RTN","SCRPTM",40,0)
 I '$D(INST)!'$D(TEAM)!'$D(ROLE)!'$D(RANGE)!'$D(IOP)!(IOP="") Q
"RTN","SCRPTM",41,0)
 ;
"RTN","SCRPTM",42,0)
 N NUMBER
"RTN","SCRPTM",43,0)
 S IOST=$P(IOP,"^",2),IOP=$P(IOP,"^")
"RTN","SCRPTM",44,0)
 I IOP?1"Q;".E S IOP=$P(IOP,"Q;",2)
"RTN","SCRPTM",45,0)
 I IOST?1"C-".E D QENTRY G RET
"RTN","SCRPTM",46,0)
 I ZTDTH="" S ZTDTH=$H
"RTN","SCRPTM",47,0)
 S ZTRTN="QENTRY^SCRPTM"
"RTN","SCRPTM",48,0)
 S ZTDESC="List of Team's Members",ZTIO=IOP
"RTN","SCRPTM",49,0)
 N II
"RTN","SCRPTM",50,0)
 F II="INST","TEAM","USERC","ROLE","INST(","TEAM(","USERC(","ROLE(","RANGE","IOP" S ZTSAVE(II)=""
"RTN","SCRPTM",51,0)
 D ^%ZTLOAD
"RTN","SCRPTM",52,0)
RET S NUMBER=0
"RTN","SCRPTM",53,0)
 I $D(ZTSK) S NUMBER=ZTSK
"RTN","SCRPTM",54,0)
 D EXIT1
"RTN","SCRPTM",55,0)
 Q NUMBER
"RTN","SCRPTM",56,0)
 ;
"RTN","SCRPTM",57,0)
QENTRY ;
"RTN","SCRPTM",58,0)
 ;driver entry point
"RTN","SCRPTM",59,0)
 S TITL="Team's Members Report"
"RTN","SCRPTM",60,0)
 S STORE="^TMP("_$J_",""SCRPTM"")"
"RTN","SCRPTM",61,0)
 K @STORE
"RTN","SCRPTM",62,0)
 S @STORE=0
"RTN","SCRPTM",63,0)
 I TEAM=1 D TALL^SCRPPAT3 S TEAM=0
"RTN","SCRPTM",64,0)
 D DRIVE
"RTN","SCRPTM",65,0)
 I $O(@STORE@(0))="" S NODATA=$$NODATA^SCRPU3(TITL)
"RTN","SCRPTM",66,0)
 I '$D(NODATA) D PRINTIT(STORE,IOP,TITL)
"RTN","SCRPTM",67,0)
 D EXIT2
"RTN","SCRPTM",68,0)
 Q
"RTN","SCRPTM",69,0)
 ;
"RTN","SCRPTM",70,0)
ERR ;
"RTN","SCRPTM",71,0)
EXIT1 ;
"RTN","SCRPTM",72,0)
 K ZTDTH,ZTRTN,ZTDESC,ZTSK,ZTIO,ZTSAVE,SCUP
"RTN","SCRPTM",73,0)
 Q
"RTN","SCRPTM",74,0)
EXIT2 ;
"RTN","SCRPTM",75,0)
 K @STORE
"RTN","SCRPTM",76,0)
 K STOP,STORE,TITL,IOP,TEAM,INST,NODATA,RANGE,ROLE,USERC
"RTN","SCRPTM",77,0)
 Q
"RTN","SCRPTM",78,0)
 ;
"RTN","SCRPTM",79,0)
DRIVE ;
"RTN","SCRPTM",80,0)
 N TM,EN,EN2,NODE,OKAY,PLIST,ERR,RDATE,TROL,TUSE
"RTN","SCRPTM",81,0)
 S TM="",ERR="ERRORS",PLIST="LIST"
"RTN","SCRPTM",82,0)
 K @ERR,@PLIST
"RTN","SCRPTM",83,0)
 F  S TM=$O(^SCTM(404.57,"C",TM)) Q:TM=""  D
"RTN","SCRPTM",84,0)
 .;$O through team position file
"RTN","SCRPTM",85,0)
 .I '$D(TEAM(TM))&(TEAM'=1) Q
"RTN","SCRPTM",86,0)
 .;Q above, not a selected team
"RTN","SCRPTM",87,0)
 .;selected team
"RTN","SCRPTM",88,0)
 .S RDATE("BEGIN")=$P(RANGE,"^")
"RTN","SCRPTM",89,0)
 .S RDATE("END")=$P(RANGE,"^",2)
"RTN","SCRPTM",90,0)
 .S RDATE("INCL")=0
"RTN","SCRPTM",91,0)
 .I ROLE=1 S OKAY=$$PRTM^SCAPMC1(TM,"RDATE","","",PLIST,ERR)
"RTN","SCRPTM",92,0)
 .I ROLE'=1 S OKAY=$$PRTM^SCAPMC1(TM,"RDATE","","ROLE",PLIST,ERR)
"RTN","SCRPTM",93,0)
 .I OKAY,$D(@PLIST@(0)) D PULL^SCRPTM2(TM,.PLIST)
"RTN","SCRPTM",94,0)
 .K @PLIST,@ERR
"RTN","SCRPTM",95,0)
 .I $D(USERC),(USERC'=1) S OKAY=$$PRTM^SCAPMC1(TM,"RDATE","USERC","",PLIST,ERR)
"RTN","SCRPTM",96,0)
 .I OKAY D PULL^SCRPTM2(TM,.PLIST)
"RTN","SCRPTM",97,0)
 .K @PLIST,@ERR
"RTN","SCRPTM",98,0)
 K @PLIST,@ERR
"RTN","SCRPTM",99,0)
 Q
"RTN","SCRPTM",100,0)
 ;
"RTN","SCRPTM",101,0)
PRINTIT(STORE,IOP,TITL) ;
"RTN","SCRPTM",102,0)
 D OPEN^SCRPU3
"RTN","SCRPTM",103,0)
 Q:$G(POP)
"RTN","SCRPTM",104,0)
 N INST,EINST,ETEAM,TEM,EPRACT,PRACT,PAGE,NXT,NPAGE,CNT,HEAD,POS
"RTN","SCRPTM",105,0)
 S (EINST,INST)="",(NPAGE,STOP,HEAD)=0,PAGE=1
"RTN","SCRPTM",106,0)
 D TITLE^SCRPU3(.PAGE,TITL)
"RTN","SCRPTM",107,0)
 F  S EINST=$O(@STORE@("I",EINST)) Q:EINST=""!(STOP)  D
"RTN","SCRPTM",108,0)
 .S INST=$O(@STORE@("I",EINST,INST))
"RTN","SCRPTM",109,0)
 .Q:INST=""
"RTN","SCRPTM",110,0)
 .I 'NPAGE W !,$G(@STORE@(INST)) ;write institution line
"RTN","SCRPTM",111,0)
 .S (ETEAM,TEM)=""
"RTN","SCRPTM",112,0)
 .F  S ETEAM=$O(@STORE@("T",INST,ETEAM)) Q:ETEAM=""!(STOP)  D
"RTN","SCRPTM",113,0)
 ..S TEM=$O(@STORE@("T",INST,ETEAM,0))
"RTN","SCRPTM",114,0)
 ..I TEM="" Q
"RTN","SCRPTM",115,0)
 ..S NXT="H"
"RTN","SCRPTM",116,0)
 ..I NPAGE,(IOST'?1"C-".E) D NEWP^SCRPTM2(INST,TEM,TITL,.PAGE,.HEAD) S NPAGE=0
"RTN","SCRPTM",117,0)
 ..I NPAGE,(IOST?1"C-".E) D HOLD1^SCRPTM2(.PAGE,TITL,INST,TEM,.HEAD) S NPAGE=0
"RTN","SCRPTM",118,0)
 ..I STOP Q
"RTN","SCRPTM",119,0)
 ..I IOST'?1"C-".E,$Y>(IOSL-5) D NEWP^SCRPTM2(INST,TEM,TITL,.PAGE,.HEAD)
"RTN","SCRPTM",120,0)
 ..I IOST?1"C-".E,$Y>(IOSL-5) D HOLD1^SCRPTM2(.PAGE,TITL,INST,TEM,.HEAD)
"RTN","SCRPTM",121,0)
 ..I STOP Q
"RTN","SCRPTM",122,0)
 ..W !
"RTN","SCRPTM",123,0)
 ..F  S NXT=$O(@STORE@(INST,TEM,NXT)) Q:NXT'?1"H".E!(STOP)  D
"RTN","SCRPTM",124,0)
 ...I 'HEAD W !,$G(@STORE@(INST,TEM,NXT)) S HEAD=0 ;writes team info
"RTN","SCRPTM",125,0)
 ..S (EPRACT,PRACT)=""
"RTN","SCRPTM",126,0)
 ..W ! ;extra line between members and practioner list
"RTN","SCRPTM",127,0)
 ..F  S EPRACT=$O(@STORE@("PN",INST,TEM,EPRACT)) Q:EPRACT=""!(STOP)  D
"RTN","SCRPTM",128,0)
 ...F  S PRACT=$O(@STORE@("PN",INST,TEM,EPRACT,PRACT)) Q:PRACT=""!(STOP)  D
"RTN","SCRPTM",129,0)
 ....I PRACT="" Q
"RTN","SCRPTM",130,0)
 ....S POS=""
"RTN","SCRPTM",131,0)
 ....F  S POS=$O(@STORE@("PN",INST,TEM,EPRACT,PRACT,POS)) Q:POS=""!(STOP)  D
"RTN","SCRPTM",132,0)
 .....D PRNTD(INST,TEM,PRACT,POS,TITL,.PAGE,.HEAD)
"RTN","SCRPTM",133,0)
 .....W ! ;seperated positions
"RTN","SCRPTM",134,0)
 ....W ! ;seperates practitioners
"RTN","SCRPTM",135,0)
 .S NPAGE=1
"RTN","SCRPTM",136,0)
 D CLOSE^SCRPU3
"RTN","SCRPTM",137,0)
 Q
"RTN","SCRPTM",138,0)
 ;
"RTN","SCRPTM",139,0)
PRNTD(INST,TEM,PRACT,POS,TITL,PAGE,HEAD) ;
"RTN","SCRPTM",140,0)
 ;
"RTN","SCRPTM",141,0)
 N CNT
"RTN","SCRPTM",142,0)
 S CNT=""
"RTN","SCRPTM",143,0)
 F  S CNT=$O(@STORE@(INST,TEM,PRACT,POS,CNT)) Q:CNT=""!(STOP)  D
"RTN","SCRPTM",144,0)
 .I IOST'?1"C-".E,$Y>(IOSL-8) D NEWP^SCRPTM2(INST,TEM,TITL,.PAGE,.HEAD)
"RTN","SCRPTM",145,0)
 .I IOST?1"C-".E,$Y>(IOSL-8) D HOLD1^SCRPTM2(.PAGE,TITL,INST,TEM,.HEAD)
"RTN","SCRPTM",146,0)
 .I STOP Q
"RTN","SCRPTM",147,0)
 .W !,$G(@STORE@(INST,TEM,PRACT,POS,CNT))
"RTN","SCRPTM",148,0)
 Q
"RTN","SCRPTP2")
0^9^B26324992
"RTN","SCRPTP2",1,0)
SCRPTP2 ;ALB/CMM - List of Team's Patients ;02/29/96
"RTN","SCRPTP2",2,0)
 ;;5.3;Scheduling;**41,53,52**;AUG 13, 1993
"RTN","SCRPTP2",3,0)
 ;
"RTN","SCRPTP2",4,0)
 ;List of Team's Patients Report
"RTN","SCRPTP2",5,0)
 ;
"RTN","SCRPTP2",6,0)
TFORMAT(INST,INAME,TIEN,TNAME,PHONE,PC) ; Format team information
"RTN","SCRPTP2",7,0)
 ;INST - institution ien
"RTN","SCRPTP2",8,0)
 ;INAME - institution name
"RTN","SCRPTP2",9,0)
 ;TIEN - team ien
"RTN","SCRPTP2",10,0)
 ;TNAME - team name
"RTN","SCRPTP2",11,0)
 ;PHONE - team phone
"RTN","SCRPTP2",12,0)
 ;PC - primary care team (yes/no)
"RTN","SCRPTP2",13,0)
 ;
"RTN","SCRPTP2",14,0)
 I INAME="" S INAME="[BAD DATA]"
"RTN","SCRPTP2",15,0)
 I TNAME="" S TNAME="[BAD DATA]"
"RTN","SCRPTP2",16,0)
 S @STORE@("I",INAME,INST)=""
"RTN","SCRPTP2",17,0)
 S @STORE@("T",INST,TNAME,TIEN)=""
"RTN","SCRPTP2",18,0)
 S @STORE@(INST)="Division: "_INAME
"RTN","SCRPTP2",19,0)
 S @STORE@(INST,TIEN)="Team: "_TNAME
"RTN","SCRPTP2",20,0)
 S $E(@STORE@(INST,TIEN),45)="Team Phone: "_PHONE
"RTN","SCRPTP2",21,0)
 S @STORE@(INST,TIEN,1)="Primary Care Team: "_PC
"RTN","SCRPTP2",22,0)
 Q
"RTN","SCRPTP2",23,0)
 ;
"RTN","SCRPTP2",24,0)
PRINTIT(STORE,IOP,TITL) ;
"RTN","SCRPTP2",25,0)
 D OPEN^SCRPU3
"RTN","SCRPTP2",26,0)
 Q:$G(POP)
"RTN","SCRPTP2",27,0)
 N INST,INAME,TNAME,TIEN
"RTN","SCRPTP2",28,0)
 S (NEW,PAGE)=1,STOP=0
"RTN","SCRPTP2",29,0)
 D TITLE^SCRPU3(.PAGE,TITL) ;write title
"RTN","SCRPTP2",30,0)
 D SETH
"RTN","SCRPTP2",31,0)
 ;
"RTN","SCRPTP2",32,0)
 S INAME=""
"RTN","SCRPTP2",33,0)
 F  S INAME=$O(@STORE@("I",INAME)) Q:INAME=""!(STOP)  D
"RTN","SCRPTP2",34,0)
 .S INST=$O(@STORE@("I",INAME,""))
"RTN","SCRPTP2",35,0)
 .Q:INST=""
"RTN","SCRPTP2",36,0)
 .I ('NEW)&(IOST'?1"C-".E) D NEWP1^SCRPU3(.PAGE,TITL)
"RTN","SCRPTP2",37,0)
 .I ('NEW)&(IOST?1"C-".E) D HOLD^SCRPU3(.PAGE,TITL)
"RTN","SCRPTP2",38,0)
 .Q:STOP
"RTN","SCRPTP2",39,0)
 .W !,$G(@STORE@(INST)) ;write institution
"RTN","SCRPTP2",40,0)
 .S TNAME=""
"RTN","SCRPTP2",41,0)
 .F  S TNAME=$O(@STORE@("T",INST,TNAME)) Q:TNAME=""!(STOP)  D
"RTN","SCRPTP2",42,0)
 ..S TIEN=$O(@STORE@("T",INST,TNAME,""))
"RTN","SCRPTP2",43,0)
 ..Q:TIEN=""
"RTN","SCRPTP2",44,0)
 ..D TPRINT(INST,TIEN) ;writes team info
"RTN","SCRPTP2",45,0)
 ..Q:STOP
"RTN","SCRPTP2",46,0)
 ..;
"RTN","SCRPTP2",47,0)
 ..I (IOST'?1"C-".E)&($Y>(IOSL-8)) D NEWP1^SCRPU3(.PAGE,TITL)
"RTN","SCRPTP2",48,0)
 ..I (IOST?1"C-".E)&($Y>(IOSL-8)) D HOLD^SCRPU3(.PAGE,TITL)
"RTN","SCRPTP2",49,0)
 ..Q:STOP
"RTN","SCRPTP2",50,0)
 ..D HEADER
"RTN","SCRPTP2",51,0)
 ..I (SORT=3)!(SORT=4) D PRACT(INST,TIEN,.NEW)
"RTN","SCRPTP2",52,0)
 ..I (SORT=1)!(SORT=2) D PTP(INST,TIEN,.NEW)
"RTN","SCRPTP2",53,0)
 K NEW,PAGE
"RTN","SCRPTP2",54,0)
 D CLOSE^SCRPU3
"RTN","SCRPTP2",55,0)
 Q
"RTN","SCRPTP2",56,0)
 ;
"RTN","SCRPTP2",57,0)
PRACT(INST,TIEN,NEW) ;Print by practitioner/patient
"RTN","SCRPTP2",58,0)
 N PNAME,PIEN,SEC2,ST1,TRD,TRDI
"RTN","SCRPTP2",59,0)
 S PNAME="",PIEN=""
"RTN","SCRPTP2",60,0)
 F  S PNAME=$O(@STORE@("P",INST,TIEN,PNAME)) Q:PNAME=""!(STOP)  D
"RTN","SCRPTP2",61,0)
 .S PIEN=$O(@STORE@("P",INST,TIEN,PNAME,""))
"RTN","SCRPTP2",62,0)
 .Q:PIEN=""
"RTN","SCRPTP2",63,0)
 .I (SORT=1)!(SORT=3) S SEC2="""PT""" ;sort by patient name
"RTN","SCRPTP2",64,0)
 .I (SORT=2)!(SORT=4) S SEC2="""PID""" ;sort by last 4 PID
"RTN","SCRPTP2",65,0)
 .S ST1=$E(STORE,1,$L(STORE)-1)_","_SEC2_")"
"RTN","SCRPTP2",66,0)
 .I (IOST'?1"C-".E)&($Y>(IOSL-8)) D NEWP1^SCRPU3(.PAGE,TITL) D:'STOP HEADER
"RTN","SCRPTP2",67,0)
 .I (IOST?1"C-".E)&($Y>(IOSL-8)) D HOLD^SCRPU3(.PAGE,TITL) D:'STOP HEADER
"RTN","SCRPTP2",68,0)
 .Q:STOP
"RTN","SCRPTP2",69,0)
 .S (TRDI,TRD)=""
"RTN","SCRPTP2",70,0)
 .F  S TRD=$O(@ST1@(INST,TIEN,TRD)) Q:TRD=""!(STOP)  D
"RTN","SCRPTP2",71,0)
 ..S TRDI=$O(@ST1@(INST,TIEN,TRD,""))
"RTN","SCRPTP2",72,0)
 ..Q:TRDI=""
"RTN","SCRPTP2",73,0)
 ..I (IOST'?1"C-".E)&($Y>(IOSL-8)) D NEWP1^SCRPU3(.PAGE,TITL) D:'STOP HEADER
"RTN","SCRPTP2",74,0)
 ..I (IOST?1"C-".E)&($Y>(IOSL-8)) D HOLD^SCRPU3(.PAGE,TITL) D:'STOP HEADER
"RTN","SCRPTP2",75,0)
 ..Q:STOP
"RTN","SCRPTP2",76,0)
 ..I $D(@STORE@(INST,TIEN,PIEN,TRDI)) W !,$G(@STORE@(INST,TIEN,PIEN,TRDI)) ;write column data
"RTN","SCRPTP2",77,0)
 .S NEW=0
"RTN","SCRPTP2",78,0)
 Q
"RTN","SCRPTP2",79,0)
 ;
"RTN","SCRPTP2",80,0)
PTP(INST,TIEN,NEW) ;Print by patient/practitioner
"RTN","SCRPTP2",81,0)
 N SEC2,ST1,TRDI,TRD,PNAME,PIEN
"RTN","SCRPTP2",82,0)
 I (SORT=1)!(SORT=3) S SEC2="""PT""" ;sort by patient name
"RTN","SCRPTP2",83,0)
 I (SORT=2)!(SORT=4) S SEC2="""PID""" ;sort by last 4 PID
"RTN","SCRPTP2",84,0)
 S ST1=$E(STORE,1,$L(STORE)-1)_","_SEC2_")"
"RTN","SCRPTP2",85,0)
 I (IOST'?1"C-".E)&($Y>(IOSL-8)) D NEWP1^SCRPU3(.PAGE,TITL)
"RTN","SCRPTP2",86,0)
 I (IOST?1"C-".E)&($Y>(IOSL-8)) D HOLD^SCRPU3(.PAGE,TITL)
"RTN","SCRPTP2",87,0)
 Q:STOP
"RTN","SCRPTP2",88,0)
 S (TRDI,TRD)=""
"RTN","SCRPTP2",89,0)
 F  S TRD=$O(@ST1@(INST,TIEN,TRD)) Q:TRD=""!(STOP)  D
"RTN","SCRPTP2",90,0)
 .S TRDI=$O(@ST1@(INST,TIEN,TRD,""))
"RTN","SCRPTP2",91,0)
 .Q:TRDI=""
"RTN","SCRPTP2",92,0)
 .I (IOST'?1"C-".E)&($Y>(IOSL-8)) D NEWP1^SCRPU3(.PAGE,TITL) D:'STOP HEADER
"RTN","SCRPTP2",93,0)
 .I (IOST?1"C-".E)&($Y>(IOSL-8)) D HOLD^SCRPU3(.PAGE,TITL) D:'STOP HEADER
"RTN","SCRPTP2",94,0)
 .Q:STOP
"RTN","SCRPTP2",95,0)
 .S PNAME="",PIEN=""
"RTN","SCRPTP2",96,0)
 .F  S PNAME=$O(@STORE@("P",INST,TIEN,PNAME)) Q:PNAME=""!(STOP)!(PIEN=0)  D
"RTN","SCRPTP2",97,0)
 ..S PIEN=$O(@STORE@("P",INST,TIEN,PNAME,""))
"RTN","SCRPTP2",98,0)
 ..Q:PIEN=""
"RTN","SCRPTP2",99,0)
 ..I (IOST'?1"C-".E)&($Y>(IOSL-8)) D NEWP1^SCRPU3(.PAGE,TITL) D:'STOP HEADER
"RTN","SCRPTP2",100,0)
 ..I (IOST?1"C-".E)&($Y>(IOSL-8)) D HOLD^SCRPU3(.PAGE,TITL) D:'STOP HEADER
"RTN","SCRPTP2",101,0)
 ..Q:STOP
"RTN","SCRPTP2",102,0)
 ..I $D(@STORE@(INST,TIEN,TRDI,PIEN)) W !,$G(@STORE@(INST,TIEN,TRDI,PIEN)) ;write column data
"RTN","SCRPTP2",103,0)
 .S NEW=0
"RTN","SCRPTP2",104,0)
 Q
"RTN","SCRPTP2",105,0)
 ;
"RTN","SCRPTP2",106,0)
TPRINT(INST,TIEN) ;
"RTN","SCRPTP2",107,0)
 ;prints team data
"RTN","SCRPTP2",108,0)
 N NXT
"RTN","SCRPTP2",109,0)
 I (IOST'?1"C-".E)&($Y>(IOSL-10)) D NEWP1^SCRPU3(.PAGE,TITL) W:'STOP !,$G(@STORE@(INST))
"RTN","SCRPTP2",110,0)
 I (IOST?1"C-".E)&($Y>(IOSL-10)) D HOLD^SCRPU3(.PAGE,TITL) W:'STOP !,$G(@STORE@(INST))
"RTN","SCRPTP2",111,0)
 Q:STOP
"RTN","SCRPTP2",112,0)
 W !!,$G(@STORE@(INST,TIEN))
"RTN","SCRPTP2",113,0)
 S NXT=0
"RTN","SCRPTP2",114,0)
 W !,$G(@STORE@(INST,TIEN,1)) ;write team info
"RTN","SCRPTP2",115,0)
 W !!
"RTN","SCRPTP2",116,0)
 S NXT=""
"RTN","SCRPTP2",117,0)
 ;write team description
"RTN","SCRPTP2",118,0)
 F  S NXT=$O(@STORE@(INST,TIEN,"D",NXT)) Q:NXT=""!(STOP)  D
"RTN","SCRPTP2",119,0)
 .I (IOST'?1"C-".E)&$Y>(IOSL-10) D NEWP1^SCRPU3(.PAGE,TITL) W:'STOP !,$G(@STORE@(INST))
"RTN","SCRPTP2",120,0)
 .I (IOST?1"C-".E)&$Y>(IOSL-10) D HOLD^SCRPU3(.PAGE,TITL) W:'STOP !,$G(@STORE@(INST))
"RTN","SCRPTP2",121,0)
 .Q:STOP
"RTN","SCRPTP2",122,0)
 .W !,$G(@STORE@(INST,TIEN,"D",NXT))
"RTN","SCRPTP2",123,0)
 W:'STOP !
"RTN","SCRPTP2",124,0)
 Q
"RTN","SCRPTP2",125,0)
 ;
"RTN","SCRPTP2",126,0)
HEADER ;prints column headings
"RTN","SCRPTP2",127,0)
 N NXT
"RTN","SCRPTP2",128,0)
 F NXT="H1","H2","H3" D
"RTN","SCRPTP2",129,0)
 .W !,$G(@STORE@(NXT))
"RTN","SCRPTP2",130,0)
 Q
"RTN","SCRPTP2",131,0)
 ;
"RTN","SCRPTP2",132,0)
SETH ;sets column headings
"RTN","SCRPTP2",133,0)
 S @STORE@("H2")="Pt Name"
"RTN","SCRPTP2",134,0)
 S $E(@STORE@("H2"),17)="Pt ID"
"RTN","SCRPTP2",135,0)
 S $E(@STORE@("H2"),24)="Practitioner"
"RTN","SCRPTP2",136,0)
 S $E(@STORE@("H1"),45)="Last"
"RTN","SCRPTP2",137,0)
 S $E(@STORE@("H2"),45)="Appt"
"RTN","SCRPTP2",138,0)
 S $E(@STORE@("H1"),55)="Next"
"RTN","SCRPTP2",139,0)
 S $E(@STORE@("H2"),55)="Appt"
"RTN","SCRPTP2",140,0)
 S $E(@STORE@("H2"),65)="Clinic"
"RTN","SCRPTP2",141,0)
 S $P(@STORE@("H3"),"=",81)=""
"RTN","SCRPTP2",142,0)
 Q
"RTN","SCRPU3")
0^10^B17197226
"RTN","SCRPU3",1,0)
SCRPU3 ;ALB/CMM - GENERIC UTILITIES ;1/16/96
"RTN","SCRPU3",2,0)
 ;;5.3;Scheduling;**41,45,52**;AUG 13, 1993
"RTN","SCRPU3",3,0)
 ;
"RTN","SCRPU3",4,0)
ELIG(DFN) ;
"RTN","SCRPU3",5,0)
 ;Gets Primary Eligibility
"RTN","SCRPU3",6,0)
 N PRIM
"RTN","SCRPU3",7,0)
 I '$D(^DPT(DFN,.36)) Q 0
"RTN","SCRPU3",8,0)
 I '$D(^DIC(8,+$P(^DPT(DFN,.36),"^"),0)) Q 0
"RTN","SCRPU3",9,0)
 S PRIM=$P($G(^DIC(8,$P($G(^DPT(DFN,.36)),"^"),0)),"^",9)
"RTN","SCRPU3",10,0)
 ;MAS Primary Eligibility Code
"RTN","SCRPU3",11,0)
 S PRIM=$P($G(^DIC(8.1,PRIM,0)),"^")
"RTN","SCRPU3",12,0)
 ;
"RTN","SCRPU3",13,0)
 S PRIM=$TR(PRIM,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","SCRPU3",14,0)
 I PRIM="NON-SERVICE CONNECTED" S PRIM="NSC"
"RTN","SCRPU3",15,0)
 I PRIM["SERVICE CONNECTED" S PRIM=$P(PRIM,"SERVICE CONNECTED")_"SC"_$P(PRIM,"SERVICE CONNECTED",2,999)
"RTN","SCRPU3",16,0)
 I PRIM["LESS THAN" S PRIM=$P(PRIM,"LESS THAN")_"<"_$P(PRIM,"LESS THAN",2,999)
"RTN","SCRPU3",17,0)
 I PRIM[" TO " S PRIM=$P(PRIM," TO ")_"-"_$P(PRIM," TO ",2,999)
"RTN","SCRPU3",18,0)
 I PRIM["%" S PRIM=$TR(PRIM,"%","")
"RTN","SCRPU3",19,0)
 S PRIM=$E(PRIM,1,9)
"RTN","SCRPU3",20,0)
 Q PRIM
"RTN","SCRPU3",21,0)
 ;
"RTN","SCRPU3",22,0)
GETNEXT(DFN,CLN) ;
"RTN","SCRPU3",23,0)
 ;Get next appointment for patient (DFN) at Clinic (CLN)
"RTN","SCRPU3",24,0)
 ;Returning the date in 00/00/00 format
"RTN","SCRPU3",25,0)
 N NEXT,APPT,FOUND
"RTN","SCRPU3",26,0)
 S APPT=DT,FOUND=0,NEXT=""
"RTN","SCRPU3",27,0)
 F  S APPT=$O(^DPT(DFN,"S",APPT)) Q:APPT=""!(FOUND)  D
"RTN","SCRPU3",28,0)
 .I CLN=+$G(^DPT(DFN,"S",APPT,0))&($P(^DPT(DFN,"S",APPT,0),"^",2)'["C") S FOUND=1,NEXT=$E(APPT,4,5)_"/"_$E(APPT,6,7)_"/"_$E(APPT,2,3)
"RTN","SCRPU3",29,0)
 Q NEXT
"RTN","SCRPU3",30,0)
 ;
"RTN","SCRPU3",31,0)
GETLAST(DFN,CLN) ;
"RTN","SCRPU3",32,0)
 ;Get last appointment for patient (DFN) at Clinic (CLN)
"RTN","SCRPU3",33,0)
 ;Returning the date in 00/00/00 format
"RTN","SCRPU3",34,0)
 N LAST,APPT,FOUND
"RTN","SCRPU3",35,0)
 S APPT=DT,FOUND=0,LAST=""
"RTN","SCRPU3",36,0)
 F  S APPT=$O(^DPT(DFN,"S",APPT),-1) Q:APPT=""!(APPT=0)!(FOUND)  D
"RTN","SCRPU3",37,0)
 .I CLN=+$G(^DPT(DFN,"S",APPT,0))&($P(^DPT(DFN,"S",APPT,0),"^",2)'["C") S FOUND=1,LAST=$E(APPT,4,5)_"/"_$E(APPT,6,7)_"/"_$E(APPT,2,3)
"RTN","SCRPU3",38,0)
 Q LAST
"RTN","SCRPU3",39,0)
 ;
"RTN","SCRPU3",40,0)
PDEVICE() ;
"RTN","SCRPU3",41,0)
 ;Generic Printer Call
"RTN","SCRPU3",42,0)
 N TION,POP
"RTN","SCRPU3",43,0)
 S %ZIS="QN" D ^%ZIS K %ZIS Q:POP!(ION="^") -1
"RTN","SCRPU3",44,0)
 S TION=ION
"RTN","SCRPU3",45,0)
 I $D(IO("Q")) S TION="Q;"_TION
"RTN","SCRPU3",46,0)
 Q TION_"^"_IOST
"RTN","SCRPU3",47,0)
 ;
"RTN","SCRPU3",48,0)
GETTIME() ;
"RTN","SCRPU3",49,0)
 ;Prompt for Queue Time
"RTN","SCRPU3",50,0)
 N X,Y
"RTN","SCRPU3",51,0)
 S DIR(0)="D^NOW::RE",DIR("A")="Start Time ",DIR("B")="NOW"
"RTN","SCRPU3",52,0)
 D ^DIR
"RTN","SCRPU3",53,0)
 I $D(DTOUT)!(X="") S Y=$H
"RTN","SCRPU3",54,0)
 I $D(DUOUT)!($D(DIROUT)) S Y=-1
"RTN","SCRPU3",55,0)
 K DIR,DTOUT,DUOUT,DIROUT
"RTN","SCRPU3",56,0)
 Q Y
"RTN","SCRPU3",57,0)
 ;
"RTN","SCRPU3",58,0)
HOLD(PAGE,TIT) ;
"RTN","SCRPU3",59,0)
 ;device is home, reached end of page
"RTN","SCRPU3",60,0)
 N X
"RTN","SCRPU3",61,0)
 W !!,"Press Any Key to Continue or '^' to Quit" R X:DTIME
"RTN","SCRPU3",62,0)
 I '$T!(X="^") S STOP=1 Q
"RTN","SCRPU3",63,0)
 D NEWP1(.PAGE,TIT)
"RTN","SCRPU3",64,0)
 Q
"RTN","SCRPU3",65,0)
 ;
"RTN","SCRPU3",66,0)
NEWP1(PAGE,TITL) ;
"RTN","SCRPU3",67,0)
 ;new page
"RTN","SCRPU3",68,0)
 ;
"RTN","SCRPU3",69,0)
 D STOPCHK^DGUTL
"RTN","SCRPU3",70,0)
 I $G(STOP) D STOPPED^DGUTL Q
"RTN","SCRPU3",71,0)
 W @IOF
"RTN","SCRPU3",72,0)
 S PAGE=PAGE+1
"RTN","SCRPU3",73,0)
 D TITLE(PAGE,TITL)
"RTN","SCRPU3",74,0)
 Q
"RTN","SCRPU3",75,0)
 ;
"RTN","SCRPU3",76,0)
TITLE(PG,TITL) ;
"RTN","SCRPU3",77,0)
 N PDATE,CEN
"RTN","SCRPU3",78,0)
 S PDATE=$E(DT,4,5)_"/"_$E(DT,6,7)_"/"_$E(DT,2,3)
"RTN","SCRPU3",79,0)
 W !,"Printed on: ",PDATE,?25,TITL,?70,"PAGE: ",PG,!
"RTN","SCRPU3",80,0)
 Q
"RTN","SCRPU3",81,0)
 ;
"RTN","SCRPU3",82,0)
CLOSE ;close device
"RTN","SCRPU3",83,0)
 D ^%ZISC
"RTN","SCRPU3",84,0)
 Q
"RTN","SCRPU3",85,0)
 ;
"RTN","SCRPU3",86,0)
OPEN ;opens device
"RTN","SCRPU3",87,0)
 IF IOST?1"C-".E D  Q  ;%zis has already been called via $$pdevice
"RTN","SCRPU3",88,0)
 .W @IOF
"RTN","SCRPU3",89,0)
 D ^%ZIS
"RTN","SCRPU3",90,0)
 Q:POP
"RTN","SCRPU3",91,0)
 U IO
"RTN","SCRPU3",92,0)
 Q
"RTN","SCRPU3",93,0)
 ;
"RTN","SCRPU3",94,0)
NODATA(TITL) ;
"RTN","SCRPU3",95,0)
 ;no data to print
"RTN","SCRPU3",96,0)
 ;returns 1
"RTN","SCRPU3",97,0)
 D OPEN
"RTN","SCRPU3",98,0)
 D TITLE(1,TITL)
"RTN","SCRPU3",99,0)
 W !,"No data to report"
"RTN","SCRPU3",100,0)
 D CLOSE
"RTN","SCRPU3",101,0)
 Q 1
"RTN","SCRPU3",102,0)
 ;
"RTN","SCRPU3",103,0)
HELP W:'$D(VAUTNA) !,"ENTER:",!?5,"- A or ALL for all ",VAUTSTR,"s, or"
"RTN","SCRPU3",104,0)
 W:($D(VAUTTN))&(VAUTSTR="TEAM") !?5,"- N or NOT for not assigned to a team or"
"RTN","SCRPU3",105,0)
 W:($D(VAUTPO))&(VAUTSTR="PRACTITIONER") !?5,"- N or NONE or NOT for not assigned to a Practitioner"
"RTN","SCRPU3",106,0)
 W !?5,"- Select individual "_VAUTSTR W:'$D(VAUTPO) " -- limit 20"
"RTN","SCRPU3",107,0)
 W !?5,"Imprecise selections will yield an additional prompt."
"RTN","SCRPU3",108,0)
 I $O(@VAUTVB@(0))]"" W !?5,"- An entry preceeded by a minus [-] sign to remove entry from list."
"RTN","SCRPU3",109,0)
 I $O(@VAUTVB@(0))]"" W !,"NOTE, you have already selected:" S VAJ=0 F VAJ1=0:0 S VAJ=$O(@VAUTVB@(VAJ)) Q:VAJ=""  W !?8,$S(VAUTNI=1:VAJ,1:@VAUTVB@(VAJ))
"RTN","SCRPU3",110,0)
 Q
"RTN","SCRPU3",111,0)
 ;
"RTN","SCRPU3",112,0)
CONV(ORIGA,NEWA) ;
"RTN","SCRPU3",113,0)
 ;ORIGA - original array - name(ien)=data
"RTN","SCRPU3",114,0)
 ;NEWA - new array - name(n)=ien^data
"RTN","SCRPU3",115,0)
 ;
"RTN","SCRPU3",116,0)
 N ENT,CNT
"RTN","SCRPU3",117,0)
 S ENT=0,CNT=0
"RTN","SCRPU3",118,0)
 S NEWA=ORIGA
"RTN","SCRPU3",119,0)
 F  S ENT=$O(ORIGA(ENT)) Q:ENT=""!(ENT'?.N)  D
"RTN","SCRPU3",120,0)
 .S CNT=CNT+1
"RTN","SCRPU3",121,0)
 .S NEWA(CNT)=ENT_"^"_ORIGA(ENT)
"RTN","SCRPU3",122,0)
 Q
"VER")
8.0^21.0
**END**
**END**
