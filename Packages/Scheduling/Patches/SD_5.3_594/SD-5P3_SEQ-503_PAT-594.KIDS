Released SD*5.3*594 SEQ #503
Extracted from mail message
**KIDS**:SD*5.3*594^

**INSTALL NAME**
SD*5.3*594
"BLD",9386,0)
SD*5.3*594^SCHEDULING^0^3130417^y
"BLD",9386,1,0)
^^7^7^3130417^
"BLD",9386,1,1,0)
This patch addresses two Electronic Waitlist(EWL) issues:
"BLD",9386,1,2,0)
 
"BLD",9386,1,3,0)
1. The system does not allow a user to create an appointment with an 
"BLD",9386,1,4,0)
   appointment date that is greater than 120 days from the desired date.
"BLD",9386,1,5,0)
 
"BLD",9386,1,6,0)
2. The current Electronic Waitlist (EWL) User Manual reflects incorrect 
"BLD",9386,1,7,0)
   instructions for canceling an appointment.
"BLD",9386,4,0)
^9.64PA^^
"BLD",9386,6.3)
3
"BLD",9386,"KRN",0)
^9.67PA^779.2^20
"BLD",9386,"KRN",.4,0)
.4
"BLD",9386,"KRN",.401,0)
.401
"BLD",9386,"KRN",.402,0)
.402
"BLD",9386,"KRN",.403,0)
.403
"BLD",9386,"KRN",.5,0)
.5
"BLD",9386,"KRN",.84,0)
.84
"BLD",9386,"KRN",3.6,0)
3.6
"BLD",9386,"KRN",3.8,0)
3.8
"BLD",9386,"KRN",9.2,0)
9.2
"BLD",9386,"KRN",9.8,0)
9.8
"BLD",9386,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",9386,"KRN",9.8,"NM",1,0)
SDM2A^^0^B20324106
"BLD",9386,"KRN",9.8,"NM","B","SDM2A",1)

"BLD",9386,"KRN",19,0)
19
"BLD",9386,"KRN",19.1,0)
19.1
"BLD",9386,"KRN",101,0)
101
"BLD",9386,"KRN",409.61,0)
409.61
"BLD",9386,"KRN",771,0)
771
"BLD",9386,"KRN",779.2,0)
779.2
"BLD",9386,"KRN",870,0)
870
"BLD",9386,"KRN",8989.51,0)
8989.51
"BLD",9386,"KRN",8989.52,0)
8989.52
"BLD",9386,"KRN",8994,0)
8994
"BLD",9386,"KRN","B",.4,.4)

"BLD",9386,"KRN","B",.401,.401)

"BLD",9386,"KRN","B",.402,.402)

"BLD",9386,"KRN","B",.403,.403)

"BLD",9386,"KRN","B",.5,.5)

"BLD",9386,"KRN","B",.84,.84)

"BLD",9386,"KRN","B",3.6,3.6)

"BLD",9386,"KRN","B",3.8,3.8)

"BLD",9386,"KRN","B",9.2,9.2)

"BLD",9386,"KRN","B",9.8,9.8)

"BLD",9386,"KRN","B",19,19)

"BLD",9386,"KRN","B",19.1,19.1)

"BLD",9386,"KRN","B",101,101)

"BLD",9386,"KRN","B",409.61,409.61)

"BLD",9386,"KRN","B",771,771)

"BLD",9386,"KRN","B",779.2,779.2)

"BLD",9386,"KRN","B",870,870)

"BLD",9386,"KRN","B",8989.51,8989.51)

"BLD",9386,"KRN","B",8989.52,8989.52)

"BLD",9386,"KRN","B",8994,8994)

"BLD",9386,"QDEF")
^^^^^^^^^^YES
"BLD",9386,"QUES",0)
^9.62^^
"BLD",9386,"REQB",0)
^9.611^1^1
"BLD",9386,"REQB",1,0)
SD*5.3*567^2
"BLD",9386,"REQB","B","SD*5.3*567",1)

"MBREQ")
0
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813
"PKG",16,22,1,"PAH",1,0)
594^3130417
"PKG",16,22,1,"PAH",1,1,0)
^^7^7^3130417
"PKG",16,22,1,"PAH",1,1,1,0)
This patch addresses two Electronic Waitlist(EWL) issues:
"PKG",16,22,1,"PAH",1,1,2,0)
 
"PKG",16,22,1,"PAH",1,1,3,0)
1. The system does not allow a user to create an appointment with an 
"PKG",16,22,1,"PAH",1,1,4,0)
   appointment date that is greater than 120 days from the desired date.
"PKG",16,22,1,"PAH",1,1,5,0)
 
"PKG",16,22,1,"PAH",1,1,6,0)
2. The current Electronic Waitlist (EWL) User Manual reflects incorrect 
"PKG",16,22,1,"PAH",1,1,7,0)
   instructions for canceling an appointment.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","SDM2A")
0^1^B20324106^B19430225
"RTN","SDM2A",1,0)
SDM2A ;ALB/OG - MAKE APPOINTMENT - overflow routine  ;24 Jun 2008 11:57 AM
"RTN","SDM2A",2,0)
 ;;5.3;Scheduling;**446,528,567,594**;Aug 13 1993;Build 3
"RTN","SDM2A",3,0)
 ;
"RTN","SDM2A",4,0)
 ;
"RTN","SDM2A",5,0)
WL(SC) ;Wait List Hook/teh patch 263 ;SD/327 passed 'SC'
"RTN","SDM2A",6,0)
 N DA,DIE,DR,SBEG,SCSR,SDDIV,SDINST,SDPAR,SDWLDA,SDWLDFN,SDWLSCL
"RTN","SDM2A",7,0)
 Q:$G(SC)'>0
"RTN","SDM2A",8,0)
 I '$D(^SC(SC)) Q
"RTN","SDM2A",9,0)
 S SDINST=""
"RTN","SDM2A",10,0)
 ;S SDINST=$$GET1^DIQ(44,SC_",",3,"I")  ; get Inst BEFORE
"RTN","SDM2A",11,0)
 S SDDIV=$$GET1^DIQ(44,SC_",",3.5,"I") S:SDDIV'="" SDINST=$$GET1^DIQ(40.8,SDDIV_",",.07,"I")
"RTN","SDM2A",12,0)
 I SDINST="" D  Q  ; sd/446
"RTN","SDM2A",13,0)
 .N DIR
"RTN","SDM2A",14,0)
 .D MESS2^SDWL120(SC)
"RTN","SDM2A",15,0)
 .W !,"No Institution/Division is associated with this Clinic."
"RTN","SDM2A",16,0)
 .W !,"Unable to create a Wait List Entry. Abandoning request."
"RTN","SDM2A",17,0)
 .W !!,"A message is being sent to the administrators mail group"
"RTN","SDM2A",18,0)
 .W !,"alerting them to the situation."
"RTN","SDM2A",19,0)
 .S DIR(0)="E" D ^DIR
"RTN","SDM2A",20,0)
 .Q
"RTN","SDM2A",21,0)
 S SDPAR=0
"RTN","SDM2A",22,0)
 ;create 409.32 entry
"RTN","SDM2A",23,0)
 I $D(^SDWL(409.32,"B",SC)) S SDWLSCL=$O(^SDWL(409.32,"B",SC,""))
"RTN","SDM2A",24,0)
 E  D
"RTN","SDM2A",25,0)
 .N DA,DIC,X,DIE,DR
"RTN","SDM2A",26,0)
 .S DIC(0)="LX",X=SC,DIC="^SDWL(409.32," D FILE^DICN
"RTN","SDM2A",27,0)
 .S SDWLSCL=DA
"RTN","SDM2A",28,0)
 .S DIE="^SDWL(409.32,"
"RTN","SDM2A",29,0)
 .S DR=".02////^S X=SDINST" D ^DIE
"RTN","SDM2A",30,0)
 .S DR="1////^S X=DT"
"RTN","SDM2A",31,0)
 .S DR=DR_";2////^S X=DUZ"
"RTN","SDM2A",32,0)
 .D ^DIE S SDPAR=1 ; flag indicating clinic parameter entry
"RTN","SDM2A",33,0)
 .; CREATE 409.3 with 120 flag
"RTN","SDM2A",34,0)
 S DIC(0)="LX",(X,SDWLDFN)=DFN,DIC="^SDWL(409.3," D FILE^DICN
"RTN","SDM2A",35,0)
 ; File just created so lock should never fail.
"RTN","SDM2A",36,0)
 F  L +^SDWL(409.3,DA):5 Q:$T  W !,"Unable to acquire a lock on the Wait List file" Q
"RTN","SDM2A",37,0)
 ; Update EWL variables.
"RTN","SDM2A",38,0)
 S SDWLDA=DA D EN^SDWLE11 ; get enrollee both SDWLDA and SDWLDFN have to be defined
"RTN","SDM2A",39,0)
 S DIE="^SDWL(409.3,"
"RTN","SDM2A",40,0)
 S DR="1////^S X=DT"
"RTN","SDM2A",41,0)
 S DR=DR_";2////^S X=SDINST"
"RTN","SDM2A",42,0)
 S DR=DR_";4////^S X=4"
"RTN","SDM2A",43,0)
 S DR=DR_";8////^S X=SDWLSCL"
"RTN","SDM2A",44,0)
 S DR=DR_";9////^S X=DUZ"
"RTN","SDM2A",45,0)
 S DR=DR_";10////^S X=""A"""
"RTN","SDM2A",46,0)
 S DR=DR_";11////^S X=2" ; by patient for this entry to avoid asking for provider
"RTN","SDM2A",47,0)
 S DR=DR_";14////^S X="""_$S($P($G(^DPT(SDWLDFN,.3)),U,1)="Y":$P(^DPT(SDWLDFN,.3),U,2),1:"")_""""
"RTN","SDM2A",48,0)
 S DR=DR_";15////^S X="_$S($P($G(^DPT(SDWLDFN,.3)),U,1)="Y":1,1:0)
"RTN","SDM2A",49,0)
 S DR=DR_";22////^S X=SDDATE"
"RTN","SDM2A",50,0)
 S DR=DR_";23////^S X=""O"""
"RTN","SDM2A",51,0)
 S DR=DR_";25////^S X="" > 120 days"""
"RTN","SDM2A",52,0)
 S DR=DR_";36////^S X=1"
"RTN","SDM2A",53,0)
 D ^DIE
"RTN","SDM2A",54,0)
 L -^SDWL(409.3,DA)
"RTN","SDM2A",55,0)
 S SDWLFLG=0 D MESS^SDWL120(SDWLDFN,SDWLDA,SDPAR)
"RTN","SDM2A",56,0)
 Q
"RTN","SDM2A",57,0)
 ;
"RTN","SDM2A",58,0)
WLCL120(SC,DESDT) ; Is there clinic availability within 120 days of desired date ; sd/446
"RTN","SDM2A",59,0)
 N SBEG,SD120
"RTN","SDM2A",60,0)
 Q:$$GET1^DIQ(44,SC,2502,"I")="Y" 1  ; Non-count clinic. Allow > 120 days.
"RTN","SDM2A",61,0)
 S SD120=0,SBEG=DESDT-1   ;SD*567 added Go next line
"RTN","SDM2A",62,0)
 F  S SBEG=$O(^SC(SC,"ST",SBEG)) Q:SBEG=""  G:'$D(^(1)) WL1 I $$HASAVSL(^SC(SC,"ST",SBEG,1)) D  Q
"RTN","SDM2A",63,0)
 .N X,DESDTH
"RTN","SDM2A",64,0)
 .S X=SBEG D H^%DTC S SBEG=%H
"RTN","SDM2A",65,0)
 .S X=DESDT D H^%DTC S DESDTH=%H
"RTN","SDM2A",66,0)
 .S SD120=(SBEG-DESDTH>120)
"RTN","SDM2A",67,0)
 .Q
"RTN","SDM2A",68,0)
 Q 'SD120
"RTN","SDM2A",69,0)
 ;
"RTN","SDM2A",70,0)
WL1 ; SD*567 check for bad record and delete if applicable
"RTN","SDM2A",71,0)
 I '$D(^SC(SC,"ST",SBEG,1)) I $D(^(9)) D DELETE
"RTN","SDM2A",72,0)
 Q 'SD120
"RTN","SDM2A",73,0)
 ;
"RTN","SDM2A",74,0)
DELETE ; SD*567 delete bad record
"RTN","SDM2A",75,0)
 S DA=SBEG,DA(1)=SC
"RTN","SDM2A",76,0)
 S DIK="^SC("_DA(1)_",""ST"","
"RTN","SDM2A",77,0)
 D ^DIK
"RTN","SDM2A",78,0)
 K DA,DIK
"RTN","SDM2A",79,0)
 Q
"RTN","SDM2A",80,0)
 ;
"RTN","SDM2A",81,0)
WLCL120A(SDWLAPDT,SDDATE1,SC) ;
"RTN","SDM2A",82,0)
 N %DT,DIR,X,X1,X2,Y,SDRET
"RTN","SDM2A",83,0)
 Q:$$GET1^DIQ(44,SC,2502,"I")="Y" 1  ; Non-count clinic. Allow > 120 days.
"RTN","SDM2A",84,0)
 S X=SDWLAPDT,%DT="TXF" D ^%DT
"RTN","SDM2A",85,0)
 Q:Y=-1 1
"RTN","SDM2A",86,0)
 S X1=Y,X2=SDDATE1 D ^%DTC
"RTN","SDM2A",87,0)
 I X'>120 Q 1
"RTN","SDM2A",88,0)
 S DIR(0)="Y",DIR("B")="YES"
"RTN","SDM2A",89,0)
 S DIR("A")="Add to EWL",DIR("A",1)="The date is more than 120 days beyond the Desired Date"
"RTN","SDM2A",90,0)
 W ! D ^DIR
"RTN","SDM2A",91,0)
 ;SD*5.3*594 allow appointment creation for appointments that have an appointment date
"RTN","SDM2A",92,0)
 ;that is greater than 120 days from the desired date.
"RTN","SDM2A",93,0)
 S SDRET=Y
"RTN","SDM2A",94,0)
 I SDRET=1 D WL(SC)
"RTN","SDM2A",95,0)
 I SDRET=0 Q 1
"RTN","SDM2A",96,0)
 Q 0
"RTN","SDM2A",97,0)
 ;
"RTN","SDM2A",98,0)
WLCLASK() ; No appointment availability warning. ; sd/446
"RTN","SDM2A",99,0)
 N DIR
"RTN","SDM2A",100,0)
 S DIR(0)="Y"
"RTN","SDM2A",101,0)
 S DIR("A",1)="No appointments are available within 120 days of the Desired Date."
"RTN","SDM2A",102,0)
 S DIR("A",2)="Do you want to place this patient on the Electronic Wait List"
"RTN","SDM2A",103,0)
 S DIR("A",3)="or change the desired date?"
"RTN","SDM2A",104,0)
 S DIR("A",4)=""
"RTN","SDM2A",105,0)
 S DIR("A",5)="Enter ""Y"" to place on EWL, ""N"" to go back"
"RTN","SDM2A",106,0)
 S DIR("A")="or ""^"" to return to the CLINIC: prompt. "
"RTN","SDM2A",107,0)
 W ! D ^DIR
"RTN","SDM2A",108,0)
 Q Y
"RTN","SDM2A",109,0)
 ;
"RTN","SDM2A",110,0)
HASAVSL(SCSR) ; Has available slots ; sd/446
"RTN","SDM2A",111,0)
 ; Look at CLINIC PATTERN CURRENT AVAILABILITY string (44.005/1)
"RTN","SDM2A",112,0)
 ; If there is 1-9,j-z within the [ ... ], there is availability for that day.
"RTN","SDM2A",113,0)
 N DIC,F,SDOK,X,Y
"RTN","SDM2A",114,0)
 ; Allow whatever if user has a key to overbook.
"RTN","SDM2A",115,0)
 S DIC="^VA(200,"_DUZ_",51,",X="SDOB" D ^DIC Q:Y'=-1 1
"RTN","SDM2A",116,0)
 S X="SDMOB" D ^DIC Q:Y'=-1 1
"RTN","SDM2A",117,0)
 Q:SCSR'["[" 0  ; No slots.
"RTN","SDM2A",118,0)
 S SCSR=$TR($E(SCSR,$F(SCSR,"[")-1,$L(SCSR))," |"),(SDOK,F)=0
"RTN","SDM2A",119,0)
 F  S F=$F(SCSR,"[",F) Q:'F  D  Q:SDOK
"RTN","SDM2A",120,0)
 .N I,SCSR0,SL
"RTN","SDM2A",121,0)
 .S SCSR0=$E(SCSR,F,$F(SCSR,"]",F)-2)
"RTN","SDM2A",122,0)
 .F I=1:1:$L(SCSR0) S SL=$E(SCSR0,I) I $A(SL)>105&($A(SL)<123)!SL S SDOK=1 Q  ; If SL=1-9,j-z slots are available
"RTN","SDM2A",123,0)
 .Q
"RTN","SDM2A",124,0)
 Q SDOK
"VER")
8.0^22.0
**END**
**END**

