Released SD*5.3*509 SEQ #462
Extracted from mail message
**KIDS**:SD*5.3*509^

**INSTALL NAME**
SD*5.3*509
"BLD",7435,0)
SD*5.3*509^SCHEDULING^0^3090219^y
"BLD",7435,1,0)
^^2^2^3090109^
"BLD",7435,1,1,0)
Corrects errors that occur when printing Routing Slips and Display Clinic
"BLD",7435,1,2,0)
Availability report.
"BLD",7435,4,0)
^9.64PA^^
"BLD",7435,6.3)
37
"BLD",7435,"ABPKG")
n
"BLD",7435,"KRN",0)
^9.67PA^8989.52^19
"BLD",7435,"KRN",.4,0)
.4
"BLD",7435,"KRN",.401,0)
.401
"BLD",7435,"KRN",.402,0)
.402
"BLD",7435,"KRN",.403,0)
.403
"BLD",7435,"KRN",.5,0)
.5
"BLD",7435,"KRN",.84,0)
.84
"BLD",7435,"KRN",3.6,0)
3.6
"BLD",7435,"KRN",3.8,0)
3.8
"BLD",7435,"KRN",9.2,0)
9.2
"BLD",7435,"KRN",9.8,0)
9.8
"BLD",7435,"KRN",9.8,"NM",0)
^9.68A^4^3
"BLD",7435,"KRN",9.8,"NM",1,0)
SDCLAV0^^0^B9891276
"BLD",7435,"KRN",9.8,"NM",2,0)
SDCLAV1^^0^B58999426
"BLD",7435,"KRN",9.8,"NM",4,0)
SDROUT0^^0^B23084570
"BLD",7435,"KRN",9.8,"NM","B","SDCLAV0",1)

"BLD",7435,"KRN",9.8,"NM","B","SDCLAV1",2)

"BLD",7435,"KRN",9.8,"NM","B","SDROUT0",4)

"BLD",7435,"KRN",19,0)
19
"BLD",7435,"KRN",19.1,0)
19.1
"BLD",7435,"KRN",101,0)
101
"BLD",7435,"KRN",409.61,0)
409.61
"BLD",7435,"KRN",771,0)
771
"BLD",7435,"KRN",870,0)
870
"BLD",7435,"KRN",8989.51,0)
8989.51
"BLD",7435,"KRN",8989.52,0)
8989.52
"BLD",7435,"KRN",8994,0)
8994
"BLD",7435,"KRN","B",.4,.4)

"BLD",7435,"KRN","B",.401,.401)

"BLD",7435,"KRN","B",.402,.402)

"BLD",7435,"KRN","B",.403,.403)

"BLD",7435,"KRN","B",.5,.5)

"BLD",7435,"KRN","B",.84,.84)

"BLD",7435,"KRN","B",3.6,3.6)

"BLD",7435,"KRN","B",3.8,3.8)

"BLD",7435,"KRN","B",9.2,9.2)

"BLD",7435,"KRN","B",9.8,9.8)

"BLD",7435,"KRN","B",19,19)

"BLD",7435,"KRN","B",19.1,19.1)

"BLD",7435,"KRN","B",101,101)

"BLD",7435,"KRN","B",409.61,409.61)

"BLD",7435,"KRN","B",771,771)

"BLD",7435,"KRN","B",870,870)

"BLD",7435,"KRN","B",8989.51,8989.51)

"BLD",7435,"KRN","B",8989.52,8989.52)

"BLD",7435,"KRN","B",8994,8994)

"BLD",7435,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",7435,"QUES",0)
^9.62^^
"BLD",7435,"REQB",0)
^9.611^6^3
"BLD",7435,"REQB",4,0)
SD*5.3*377^2
"BLD",7435,"REQB",5,0)
SD*5.3*529^2
"BLD",7435,"REQB",6,0)
SD*5.3*533^2
"BLD",7435,"REQB","B","SD*5.3*377",4)

"BLD",7435,"REQB","B","SD*5.3*529",5)

"BLD",7435,"REQB","B","SD*5.3*533",6)

"MBREQ")
0
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813
"PKG",16,22,1,"PAH",1,0)
509^3090219
"PKG",16,22,1,"PAH",1,1,0)
^^2^2^3090219
"PKG",16,22,1,"PAH",1,1,1,0)
Corrects errors that occur when printing Routing Slips and Display Clinic
"PKG",16,22,1,"PAH",1,1,2,0)
Availability report.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","SDCLAV0")
0^1^B9891276^B8953839
"RTN","SDCLAV0",1,0)
SDCLAV0 ;ALB/LDB - OUTPUT PATTERNS (cont.) ; 05 Mar 99 11:31 AM
"RTN","SDCLAV0",2,0)
 ;;5.3;Scheduling;**184,439,490,517,529,509**;Aug 13, 1993;Build 37
"RTN","SDCLAV0",3,0)
 ;SD/517 CHANGED FOR LOOPS
"RTN","SDCLAV0",4,0)
 I 'VAUTC S SDC=0 F  S SDC=$O(VAUTC(SDC)) Q:'SDC  S SDV=VAUTC(SDC) D:VAUTD!($D(VAUTD(+$P(^SC(SDC,0),"^",15))))!('$P(^(0),"^",15)&$D(VAUTD($P(^DG(43,1,"GL"),"^",3)))) S1
"RTN","SDCLAV0",5,0)
 I VAUTC S SDC=0 F  S SDC=$O(^SC(SDC)) Q:'SDC  I $P(^(SDC,0),"^",3)="C" D:VAUTD!($D(VAUTD(+$P(^(0),"^",15))))!('$P(^(0),"^",15)&$D(VAUTD($P(^DG(43,1,"GL"),"^",3)))) S1
"RTN","SDCLAV0",6,0)
 I $D(^UTILITY($J,"SDNMS")) D S2^SDCLAV1
"RTN","SDCLAV0",7,0)
 ;following line commented off per SD*529
"RTN","SDCLAV0",8,0)
 ;S DGTCH="CLINIC AVAILABILITY REPORT^CLINIC^PAGE#" D:$E(IOST,1,2)="P-" TP^DGUTL K SDBD,SDCI,SDED D END^SDCLAV Q
"RTN","SDCLAV0",9,0)
 D END^SDCLAV Q
"RTN","SDCLAV0",10,0)
S1 S SD=^SC(SDC,0),D=$S($P(SD,"^",15):$P(SD,"^",15),1:$P(^DG(43,1,"GL"),"^",3)),SD5=0,SDNM=$P(SD,"^")
"RTN","SDCLAV0",11,0)
 S $P(^UTILITY($J,"SDNMS",D,SDNM),"^",3)=SDC
"RTN","SDCLAV0",12,0)
 Q
"RTN","SDCLAV0",13,0)
NM ;called by SDCLAV1 - SD/517 CHANGED FOR LOOP
"RTN","SDCLAV0",14,0)
 S SDAP1=0 F  S SDAP1=$O(^SC(SDC,"S",SDAP,1,SDAP1)) Q:'SDAP1  D NM1
"RTN","SDCLAV0",15,0)
 K M1,SDN1,SDN2,SDN3,SDC3,SDAP1  ; SD*5.3*439 added Kill of local vars
"RTN","SDCLAV0",16,0)
 Q
"RTN","SDCLAV0",17,0)
NM1 I '$D(^SC(SDC,"S",SDAP,1,SDAP1,0)) N POP S POP=0,(SDN1,SDN2,SDN3)="" D CHECK,KILL Q  ;added SD/517
"RTN","SDCLAV0",18,0)
 I $P(^SC(SDC,"S",SDAP,1,SDAP1,0),U,1)="" D SETUTL Q   ;SD*509
"RTN","SDCLAV0",19,0)
 S SDN1=+^SC(SDC,"S",SDAP,1,SDAP1,0),M1=$P(^(0),"^",2),SDC3=$P(^(0),"^",9),SDN2=$P(^DPT(+SDN1,0),"^"),SDN3=$P(^(0),"^",9),SDN3=$S(SDN3="":"UNKNOWN",1:SDN3) I $D(SDCI) D NM2 Q
"RTN","SDCLAV0",20,0)
 ; SD*5.3*439 added quit if clinic in "S" node not = to selected clinic
"RTN","SDCLAV0",21,0)
 I '$D(SDCI),$D(^DPT(SDN1,"S",SDAP,0)),$P(^(0),"^",2)'["C",$P(^(0),"^",2)'="N",$P(^(0),"^",2)'="NA" Q:$P(^(0),U,1)'=SDC  D NM2 Q
"RTN","SDCLAV0",22,0)
 Q
"RTN","SDCLAV0",23,0)
 ;SD*5.3*490 do not display appts prior to clinic start date
"RTN","SDCLAV0",24,0)
NM2 Q:$P(SDAP,".",1)<$O(^SC(SDC,"T",0))  ;SD*5.3*490
"RTN","SDCLAV0",25,0)
 S:$D(^DPT(SDN1,"S",SDAP,0)) ^UTILITY($J,"SDNMS",D,SDV,SDAP,SDN2,SDN3)=M1_$S(($P(^DPT(SDN1,"S",SDAP,0),"^",2)["C"):"^*",SDC3="C":"^*",($P(^(0),"^",2)="N"):"^**",($P(^(0),"^",2)="NA"):"^**",1:"")
"RTN","SDCLAV0",26,0)
 S:$D(^DPT(SDN1,"S",SDAP,0)) $P(^UTILITY($J,"SDNMS",D,SDV,SDAP,SDN2,SDN3),"^",3)=$S($P(^DPT(SDN1,"S",SDAP,0),"^",7)=4:"***",1:"")
"RTN","SDCLAV0",27,0)
 Q
"RTN","SDCLAV0",28,0)
 ;
"RTN","SDCLAV0",29,0)
CHECK ;Added SD/517
"RTN","SDCLAV0",30,0)
 N SDIEN,NODE,NODE0,HDFN,HDNAM,HDSN,POP
"RTN","SDCLAV0",31,0)
 S SDIEN=0,NODE="",HDAP1=SDAP1
"RTN","SDCLAV0",32,0)
 F  S SDIEN=$O(^SCE("B",SDAP,SDIEN)) Q:'SDIEN  D
"RTN","SDCLAV0",33,0)
 .S NODE=^SCE(SDIEN,0)
"RTN","SDCLAV0",34,0)
 .Q:$P(NODE,U,4)'=SDC
"RTN","SDCLAV0",35,0)
 .S HDFN=$P(NODE,U,2),HDNAM=$P(^DPT(HDFN,0),U),HDSN=$P(^(0),U,9)
"RTN","SDCLAV0",36,0)
 .Q:$D(^UTILITY($J,"SDNMS",D,SDV,SDAP,HDNAM,HDSN))
"RTN","SDCLAV0",37,0)
 .S POP=0 D CHECK1 Q:POP
"RTN","SDCLAV0",38,0)
 .S SDN1=$P(NODE,U,2),SDN2=$P(^DPT(SDN1,0),U),SDN3=$P(^DPT(SDN1,0),U,9),M1="",SDC3=""
"RTN","SDCLAV0",39,0)
 .D NM2
"RTN","SDCLAV0",40,0)
 Q
"RTN","SDCLAV0",41,0)
 ;
"RTN","SDCLAV0",42,0)
CHECK1 ;Added SD/517
"RTN","SDCLAV0",43,0)
 S HDAP1=$O(^SC(SDC,"S",SDAP,1,HDAP1)) Q:'HDAP1
"RTN","SDCLAV0",44,0)
 Q:'$D(^SC(SDC,"S",SDAP,1,HDAP1,0))  S NODE0=^(0)
"RTN","SDCLAV0",45,0)
 I $P(NODE0,U,1)=HDFN S POP=1 Q
"RTN","SDCLAV0",46,0)
 Q
"RTN","SDCLAV0",47,0)
 ;
"RTN","SDCLAV0",48,0)
KILL K SDIEN,NODE,NODE0,POP,HDFN,HDNAM,HDSN,HDAP1  ;added SD/517
"RTN","SDCLAV0",49,0)
 Q
"RTN","SDCLAV0",50,0)
 ;
"RTN","SDCLAV0",51,0)
SETUTL ;SD*509 set Utility for null DFN, corrupt node will be deleted in SDCLAV1
"RTN","SDCLAV0",52,0)
 S (SDN1,SDN2,SDN3)="UNKNOWN",M1=0
"RTN","SDCLAV0",53,0)
 S ^UTILITY($J,"SDNMS",D,SDV,SDAP,SDN2,SDN3)=M1_"^"_SDC_"^"_SDAP1
"RTN","SDCLAV0",54,0)
 Q
"RTN","SDCLAV0",55,0)
 ;
"RTN","SDCLAV1")
0^2^B58999426^B55785540
"RTN","SDCLAV1",1,0)
SDCLAV1 ;ALB/LDB - OUTPUT PATTERNS (cont.) ; 9/1/00 10:57am
"RTN","SDCLAV1",2,0)
 ;;5.3;Scheduling;**140,167,168,76,383,463,490,517,533,509**;Aug 13, 1993;Build 37
"RTN","SDCLAV1",3,0)
 ;
"RTN","SDCLAV1",4,0)
 ;PATCH 383 STOPPED REPORT FROM CREATING AVAILIBILTY-TEH
"RTN","SDCLAV1",5,0)
 ;
"RTN","SDCLAV1",6,0)
S2 N I1,SC,SDAV,SDMED,SI,SL,SM,SS,STARTDAY,SDDD,YCNT,SDFRST
"RTN","SDCLAV1",7,0)
 S P=0 F D=0:0 S D=$O(^UTILITY($J,"SDNMS",D)) Q:D'>0!(SDUP)  S SDV="",SDZ2=SDBD F X5=0:0 S SDV=$O(^UTILITY($J,"SDNMS",D,SDV)) Q:SDV=""!SDUP  S SDC=$P(^UTILITY($J,"SDNMS",D,SDV),"^",3) D S ;Q:SDUP  ;D WR ;,SS
"RTN","SDCLAV1",8,0)
 Q
"RTN","SDCLAV1",9,0)
S1 S SD=^SC(SDC,0),D=$S($P(SD,"^",15):$P(SD,"^",15),1:$P(^DG(43,1,"GL"),"^",3)),SD5=0,SDNM=$P(SD,"^")
"RTN","SDCLAV1",10,0)
 S $P(^UTILITY($J,"SDNMS",D,SDNM),"^",3)=SDC Q
"RTN","SDCLAV1",11,0)
S I '$D(^SC(SDC,"SL")) D SDM,HDR W !!,"THIS CLINIC DOES NOT HAVE APPT. LENGTH" Q
"RTN","SDCLAV1",12,0)
 S (SDZ,SDZ2)=SDBD D SDM,HDR,TIME S SDZ=SDBD-1,SD0=0,SDMED=SDED+.9
"RTN","SDCLAV1",13,0)
 N X,SDSOH S SC=+SDC,SL=^SC(SC,"SL"),X=$P(SL,U,3),STARTDAY=$S($L(X):X,1:8),X=$P(SL,U,6),SI=$S(X="":4,X<3:4,X:X,1:4),X=SDBD,SDSOH=$P(SL,"^",8),SM=$S($E(X,4,5)[12:$E(X,1,3)+1_"01",1:$E(X,1,3)_$E(X,4,5)+1)_"00",SDZ=SDBD
"RTN","SDCLAV1",14,0)
 N POP S POP=0  ;SD/517
"RTN","SDCLAV1",15,0)
LOOP D SDM D:0&$E(SDZ,2,5)=$E(SDZ1,2,5) MON I $E(SDZ,2,5)'=$E(SDZ1,2,5) I 'SDUP D X1 I 'SDUP D A I 'SDUP D:SD0!($E(IOST,1,2)="C-") 3 I 'SDUP D WR I 'SDUP,$E(IOST,1,2)="C-" D 3
"RTN","SDCLAV1",16,0)
 D:POP MSG  ;SD/517
"RTN","SDCLAV1",17,0)
 I 'SDUP I X<SDED S (X,SDZ2)=$S($E(X,4,5)=12:$E(X,1,3)+1_"01",1:$E(X,1,5)+1)_"01",SDZ=X D SDM,HDR,TIME G LOOP
"RTN","SDCLAV1",18,0)
 D:POP MSG  ;SD/517
"RTN","SDCLAV1",19,0)
 Q
"RTN","SDCLAV1",20,0)
 ;
"RTN","SDCLAV1",21,0)
MSG ;Added SD/517
"RTN","SDCLAV1",22,0)
 D WARN
"RTN","SDCLAV1",23,0)
 Q
"RTN","SDCLAV1",24,0)
 ;
"RTN","SDCLAV1",25,0)
SS Q:SDUP  S SDZ=SDZ1,SD5=1
"RTN","SDCLAV1",26,0)
 D A Q:SDUP  D 3 Q:SDUP  D WR Q:SDUP  D:$E(IOST,1,2)="C-" 3 Q
"RTN","SDCLAV1",27,0)
MON Q:'$D(^SC(+SDC,"ST",SDZ,1))  S SDPT=^SC(+SDC,"ST",SDZ,1) D SDPT1
"RTN","SDCLAV1",28,0)
 Q
"RTN","SDCLAV1",29,0)
SDPT1 I YCNT+6>IOSL D:$E(IOST,1,2)="C-" 3 Q:SDUP  D HDR,TIME
"RTN","SDCLAV1",30,0)
 W !,SDPT S SDAP=SDZ-1 F Z=1:1 S SDAP=$O(^SC(SDC,"S",SDAP)) Q:SDAP'>0!(SDAP>(SDZ+.9999))!SDUP  D NM^SDCLAV0
"RTN","SDCLAV1",31,0)
 D YCNT
"RTN","SDCLAV1",32,0)
 Q
"RTN","SDCLAV1",33,0)
TIME ;SD/533 $Select defaults to 8 when Z5=0, so a Midnight to 8am clinic
"RTN","SDCLAV1",34,0)
 ;incorrectly prints available hours as 8am to 4pm instead of 0 to 8am
"RTN","SDCLAV1",35,0)
 ;Two new lines added to fix this and linetag T1 added at Write command
"RTN","SDCLAV1",36,0)
 ;S Z5=$P(^SC(+SDC,"SL"),U,3),SDT=$S(Z5:Z5,1:8),Z5=$P(^("SL"),U,6),SDI=$S(Z5="":4,Z5<3:4,Z5:Z5,1:4)
"RTN","SDCLAV1",37,0)
 S Z5=$P(^SC(+SDC,"SL"),U,3) I Z5=0 S SDT=0,Z5=$P(^("SL"),U,6),SDI=$S(Z5="":4,Z5<3:4,Z5:Z5,1:4) G T1
"RTN","SDCLAV1",38,0)
 S SDT=$S(Z5:Z5,1:8),Z5=$P(^SC(+SDC,"SL"),U,6),SDI=$S(Z5="":4,Z5<3:4,Z5:Z5,1:4)
"RTN","SDCLAV1",39,0)
T1 W !!," TIME",?SDI+SDI-1 F Z6=SDT:1:65\(SDI+SDI)+SDT W $E("|"_$S('Z6:0,1:(Z6-1#12+1))_"                 ",1,SDI+SDI)
"RTN","SDCLAV1",40,0)
 W !," DATE",?SDI+SDI-1,"|" K J F Z7=0:1:6 I $D(^SC(+SDC,"T"_Z7)) S J(Z7)=""
"RTN","SDCLAV1",41,0)
 S YCNT=YCNT+3
"RTN","SDCLAV1",42,0)
 F Z8=1:1:65\(SDI+SDI) W $J("|",SDI+SDI)
"RTN","SDCLAV1",43,0)
 Q
"RTN","SDCLAV1",44,0)
WR N X S (Y3,X1,SDC1,SD0)=0,C=SDZ2
"RTN","SDCLAV1",45,0)
 F S8=C:0 S SDC1=SDC1+1,C=$O(^UTILITY($J,"SDNMS",D,SDV,C)) Q:C'>0!(C>SDMED&('SD5))!SDUP  S SD0=1 D:SDC1=1 HDR1 S X=C D DW^%DTC S Y=C X ^DD("DD") S Y1=$P(Y,"@"),Y2=$P(Y,"@",2),X9=X W:Y1'=Y3 !!,?1,X9,?11,Y1 D WR1 Q:SDUP
"RTN","SDCLAV1",46,0)
 Q:SDUP  I 'SD0 D HDR1 W !!,"No appointments scheduled"
"RTN","SDCLAV1",47,0)
 D:SD0 WR2 S SDZ2=SDZ Q  ;SD/517
"RTN","SDCLAV1",48,0)
WR1 S X4="" F X1=0:0 S X4=$O(^UTILITY($J,"SDNMS",D,SDV,C,X4)) Q:X4=""!SDUP  S X6="" F X2=0:0 S X6=$O(^UTILITY($J,"SDNMS",D,SDV,C,X4,X6)) Q:X6=""  D W1
"RTN","SDCLAV1",49,0)
 Q
"RTN","SDCLAV1",50,0)
 ;
"RTN","SDCLAV1",51,0)
WR2 ;Added SD/517
"RTN","SDCLAV1",52,0)
 D 3 W @IOF D HDR1,DAT
"RTN","SDCLAV1",53,0)
 D A1^SDCLAV
"RTN","SDCLAV1",54,0)
 Q
"RTN","SDCLAV1",55,0)
 ;
"RTN","SDCLAV1",56,0)
HDR N X D NOW^%DTC S Y=$E(%,1,12) X ^DD("DD") S YCNT=1 W @IOF,!?52,Y D:$E(IOST,1,2)="P-" PG^SDCLAV
"RTN","SDCLAV1",57,0)
 I $D(^DG(43,1,"GL")),$P(^("GL"),"^",2) W !?30,$P(^DG(40.8,D,0),"^")
"RTN","SDCLAV1",58,0)
 W !?30,SDV,!?30,SDM,"  ",($E(SDZ,1,3)+1700) S YCNT=4 Q
"RTN","SDCLAV1",59,0)
HDR1 S SDZ2=$S(SDZ2=0:SDBD,SDZ2>SDED:SDED,1:SDZ2) W !!,?30,SDV,!,?30,$P(SDM1,"^",+$E(SDZ2,4,5)),"  ",($E(SDZ2,1,3)+1700) S YCNT=YCNT+3 Q
"RTN","SDCLAV1",60,0)
SDM S SDM1="JANUARY^FEBRUARY^MARCH^APRIL^MAY^JUNE^JULY^AUGUST^SEPTEMBER^OCTOBER^NOVEMBER^DECEMBER",SDM=$P(SDM1,"^",+($E(SDZ,4,5))) Q
"RTN","SDCLAV1",61,0)
W S SDUT=^UTILITY($J,"SDNMS",D,SDV,C,X4,X6) S D1="" F D8=2,3 S D1=$S($P(SDUT,"^",D8)]"":$P(SDUT,"^",D8),1:"")_D1
"RTN","SDCLAV1",62,0)
 W D1 Q
"RTN","SDCLAV1",63,0)
W1 ;added next 2 lines and changed 3rd line SD/517
"RTN","SDCLAV1",64,0)
 S X=C X ^DD("FUNC",2,1)  ;SD*509 added DO next line to delete corrupt node
"RTN","SDCLAV1",65,0)
 I +^UTILITY($J,"SDNMS",D,SDV,C,X4,X6)=0 D  Q:X4="UNKNOWN"  S X="**WARNING** "_X D W2 Q
"RTN","SDCLAV1",66,0)
 .Q:X4'="UNKNOWN"
"RTN","SDCLAV1",67,0)
 .S N1=^UTILITY($J,"SDNMS",D,SDV,C,X4,X6),SDC=$P(N1,U,2),SDAP1=$P(N1,U,3)
"RTN","SDCLAV1",68,0)
 .S DA(2)=SDC,DA(1)=C,DA=SDAP1
"RTN","SDCLAV1",69,0)
 .S DIK="^SC("_DA(2)_",""S"","_DA(1)_",1," D ^DIK
"RTN","SDCLAV1",70,0)
 .K DA,DIK,N1
"RTN","SDCLAV1",71,0)
 .Q
"RTN","SDCLAV1",72,0)
 D TAB W:T ?10 W:'T ?11 W X,?20,X4,?51,X6 D MIN W ?61,"("_M1_") MINUTES" D W S Y3=Y1,X1=X9 I YCNT+6>IOSL D 3 Q:SDUP  D HDR1,DAT
"RTN","SDCLAV1",73,0)
 Q
"RTN","SDCLAV1",74,0)
 ;
"RTN","SDCLAV1",75,0)
W2 ;added SD/517
"RTN","SDCLAV1",76,0)
 S POP=1
"RTN","SDCLAV1",77,0)
 D TAB W:T ?1 W:'T ?2 W X,?23,X4,?51,X6 D MIN W ?61,"("_M1_") MINUTES" D W S Y3=Y1,X1=X9 I YCNT+6>IOSL D 3 Q:SDUP  D HDR1,DAT
"RTN","SDCLAV1",78,0)
 Q
"RTN","SDCLAV1",79,0)
WARN ;added SD/517
"RTN","SDCLAV1",80,0)
 W @IOF,! D:$E(IOST,1,2)="P-" PG^SDCLAV
"RTN","SDCLAV1",81,0)
 D HDR1,DAT
"RTN","SDCLAV1",82,0)
 W !!,"*************************************************************************"
"RTN","SDCLAV1",83,0)
 W !,"* WARNING: There is a data inconsistency or data corruption problem      *"
"RTN","SDCLAV1",84,0)
 W !,"* with one or more of the above appointments.  These appointments will   *"
"RTN","SDCLAV1",85,0)
 W !,"* have WARNING displayed to the left of the time.  Corrective action     *"
"RTN","SDCLAV1",86,0)
 W !,"* needs to be taken.  Please cancel any of the appointments above, which *"
"RTN","SDCLAV1",87,0)
 W !,"* have the WARNING display.  If any of them are valid appointments, they *"
"RTN","SDCLAV1",88,0)
 W !,"* will have to be re-entered via Appointment Management.                 *"
"RTN","SDCLAV1",89,0)
 W !,"**************************************************************************"
"RTN","SDCLAV1",90,0)
 D 3
"RTN","SDCLAV1",91,0)
 S POP=0
"RTN","SDCLAV1",92,0)
 Q
"RTN","SDCLAV1",93,0)
 ;
"RTN","SDCLAV1",94,0)
3 N X I $E(IOST,1,2)="C-" F X=$Y:1:IOSL-6 W ! D YCNT
"RTN","SDCLAV1",95,0)
 I  R !!,"PRESS RETURN TO CONTINUE OR ^ TO QUIT  ",SDU:DTIME S:SDU="^"!('$T) SDUP=1
"RTN","SDCLAV1",96,0)
 I YCNT+6'<IOSL,'SDUP W @IOF,! S YCNT=1 D:$E(IOST,1,2)="P-" PG^SDCLAV Q
"RTN","SDCLAV1",97,0)
 Q
"RTN","SDCLAV1",98,0)
A N X D:YCNT+13>IOSL 3 Q:SDUP  D INAC^SDCLAV W !!!,"FOR CLINIC AVAILABILITY PATTERNS:"
"RTN","SDCLAV1",99,0)
 W !!?4,"0-9 and j-z",?15," --denote available slots where j=10,k=11...z=26",!?12,"A-W",?15," --denote overbooks with A being the first slot to be overbooked",!?18,"and B being the second for that same time, etc."
"RTN","SDCLAV1",100,0)
 W !?6,"*,$,!,@,#",?15," --denote overbooks or appts. that fall outside of a clinic's",!?18,"regular hours" S YCNT=YCNT+8 Q
"RTN","SDCLAV1",101,0)
TAB W ! S:$L(X)>7 T=1 S:$L(X)<8 T=0 D YCNT Q
"RTN","SDCLAV1",102,0)
MIN S M1=+^UTILITY($J,"SDNMS",D,SDV,C,X4,X6) Q
"RTN","SDCLAV1",103,0)
DAT I $E($O(^UTILITY($J,"SDNMS",D,SDV,C)),2,7)=$E(C,2,7) W !,?1,X1,?11,Y1 D YCNT
"RTN","SDCLAV1",104,0)
 Q
"RTN","SDCLAV1",105,0)
X1 S X1=X\100_$P("31^28^31^30^31^30^31^31^30^31^30^31",U,$E(X,4,5))
"RTN","SDCLAV1",106,0)
 S X1=$$LEAP(X1) I X1>SDED S X1=SDED
"RTN","SDCLAV1",107,0)
 S SDMED=X1+.9,SDAP=X-.01 F  S SDAP=$O(^SC(SDC,"S",SDAP)) Q:SDAP'>0!(SDAP>(X1+.9999))!SDUP  D NM^SDCLAV0
"RTN","SDCLAV1",108,0)
 D DOW S SDDD=Y
"RTN","SDCLAV1",109,0)
WW ;
"RTN","SDCLAV1",110,0)
 I '$D(^SC(+SC,"ST",X,1)),$$CHKDT() S Y=SDDD#7 G L:'$D(J(Y)),H:$D(^HOLIDAY(X))&('SDSOH) S SS=+$O(^SC(+SC,"T"_Y,X)) G L:SS'>0,L:^(SS,1)="" D
"RTN","SDCLAV1",111,0)
 .S ^SC(+SC,"ST",$P(X,"."),1)=$E($P($T(DAY),U,Y+2),1,2)_" "_$E(X,6,7)_$J("",SI+SI-6)_^(1),^(0)=$P(X,".")
"RTN","SDCLAV1",112,0)
 ;SD*5.3*490 added GOTO command so dates prior to clinic start date no
"RTN","SDCLAV1",113,0)
 ;longer display on grid
"RTN","SDCLAV1",114,0)
 S SDAV=1 D:X>SM WM I $D(^SC(+SC,"ST",X,1)),^(1)["["!(^(1)["CANCELLED")!($D(^HOLIDAY(X))) G:X<$O(^SC(+SC,"T",0)) L W !,$E(^SC(+SC,"ST",X,1),1,80) D YCNT S:'$D(^HOLIDAY(X))&('SDAV) SDAV=1
"RTN","SDCLAV1",115,0)
 I YCNT+6>IOSL D 3 Q:SDUP  D HDR
"RTN","SDCLAV1",116,0)
L S X=X+1,SDDD=SDDD+1
"RTN","SDCLAV1",117,0)
 G WW:X'>X1 Q
"RTN","SDCLAV1",118,0)
 ;
"RTN","SDCLAV1",119,0)
WM W !?36 S Y=$E(X,1,5)_"00",SM=$S($E(X,4,5)[12:$E(X,1,3)+1_"01",1:$E(X,1,3)_$E(X,4,5)+1)_"00" D YCNT
"RTN","SDCLAV1",120,0)
DT W $$FMTE^XLFDT(Y) Q
"RTN","SDCLAV1",121,0)
 ;
"RTN","SDCLAV1",122,0)
DOW S Y=$$DOW^XLFDT(X,1) Q
"RTN","SDCLAV1",123,0)
YCNT S YCNT=YCNT+1 Q
"RTN","SDCLAV1",124,0)
 ;
"RTN","SDCLAV1",125,0)
DAY ;;^SUN^MON^TUES^WEDNES^THURS^FRI^SATUR
"RTN","SDCLAV1",126,0)
DIFF S X1=SDRE,X2=X D ^%DTC S SDDD=SDDD+X,X=SDRE,X1=X\100_28 Q
"RTN","SDCLAV1",127,0)
H S ^SC(+SC,"ST",X,1)="   "_$E(X,6,7)_"    "_$P(^(X,0),U,2),^(0)=X G WW
"RTN","SDCLAV1",128,0)
 ;
"RTN","SDCLAV1",129,0)
LEAP(SDEOM) ;Check for leap year, adjust if indicated
"RTN","SDCLAV1",130,0)
 ;Input: SDEOM=end of month date to adjust for leap year
"RTN","SDCLAV1",131,0)
 Q:$E(SDEOM,4,5)'="02" SDEOM  ; only adjust February
"RTN","SDCLAV1",132,0)
 N SDLEAP
"RTN","SDCLAV1",133,0)
 S SDLEAP=$$FMADD^XLFDT(SDEOM,1)
"RTN","SDCLAV1",134,0)
 Q $S($E(SDLEAP,4,5)="02":SDLEAP,1:SDEOM)
"RTN","SDCLAV1",135,0)
CHKDT() ;
"RTN","SDCLAV1",136,0)
 N Y,RET,SDFA
"RTN","SDCLAV1",137,0)
 I '$D(SDFRST(D,+SC)) D
"RTN","SDCLAV1",138,0)
 .; Create array of days that have a current template.
"RTN","SDCLAV1",139,0)
 .N %H,X,SDFMTDAY,SDAYCNT,SDAYI,SDST,SDAYCHK,SDAYNAM,SDAYNUM
"RTN","SDCLAV1",140,0)
 .S %H=$H
"RTN","SDCLAV1",141,0)
 .D YX^%DTC S SDFMTDAY=X
"RTN","SDCLAV1",142,0)
 .S SDAYCNT=0
"RTN","SDCLAV1",143,0)
 .F SDAYI=0:1:6 D
"RTN","SDCLAV1",144,0)
 ..Q:'$D(^SC(+SC,"T"_SDAYI))
"RTN","SDCLAV1",145,0)
 ..I $O(^SC(+SC,"T"_SDAYI,""),-1)'<SDFMTDAY S SDFRST(D,+SC,SDAYI)="",SDAYCNT=SDAYCNT+1
"RTN","SDCLAV1",146,0)
 .; Calculate first available date for each day that has current template.
"RTN","SDCLAV1",147,0)
 .S SDST=0,SDAYCHK=0
"RTN","SDCLAV1",148,0)
 .F  S SDST=$O(^SC(+SC,"ST",SDST)) Q:SDST=""!(SDAYCHK=SDAYCNT)  D
"RTN","SDCLAV1",149,0)
 ..S SDAYNAM=$E($G(^SC(+SC,"ST",SDST,1)),1,2)
"RTN","SDCLAV1",150,0)
 ..S SDAYNUM=$S(SDAYNAM="MO":1,SDAYNAM="TU":2,SDAYNAM="WE":3,SDAYNAM="TH":4,SDAYNAM="FR":5,SDAYNAM="SA":6,SDAYNAM="SU":0,1:"")
"RTN","SDCLAV1",151,0)
 ..Q:SDAYNUM=""
"RTN","SDCLAV1",152,0)
 ..Q:$G(SDFRST(D,+SC,SDAYNUM))'=""
"RTN","SDCLAV1",153,0)
 ..Q:'$D(^SC(+SC,"T"_SDAYNUM))
"RTN","SDCLAV1",154,0)
 ..S SDFRST(D,+SC,SDAYNUM)=SDST,SDAYCHK=SDAYCHK+1
"RTN","SDCLAV1",155,0)
 ; Get first avail date from array for particular day of week
"RTN","SDCLAV1",156,0)
 S Y=SDDD#7,RET=0
"RTN","SDCLAV1",157,0)
 S SDFA=$G(SDFRST(D,+SC,Y))
"RTN","SDCLAV1",158,0)
 I SDFA'="" D
"RTN","SDCLAV1",159,0)
 .S SDFA=$S(+$H>SDFA:+$H,1:SDFA)
"RTN","SDCLAV1",160,0)
 .I X'<SDFA S RET=1
"RTN","SDCLAV1",161,0)
 Q RET
"RTN","SDROUT0")
0^4^B23084570^B20877493
"RTN","SDROUT0",1,0)
SDROUT0 ;BSN/GRR - ROUTING SLIPS BY CLINIC ;11/12/91  16:07
"RTN","SDROUT0",2,0)
 ;;5.3;Scheduling;**343,377,509**;Aug 13, 1993;Build 37
"RTN","SDROUT0",3,0)
GO S SDCNT=0 D GO1 G:ORDER=2!(ORDER=3) CLIN
"RTN","SDROUT0",4,0)
 F G=0:0 S I=$O(^UTILITY($J,I)) Q:I=""  F J=0:0 S J=$O(^UTILITY($J,I,J)) Q:J=""  S P=0 D HED^SDROUT2,HD^SDROUT2,CNT F K=0:0 S K=$O(^UTILITY($J,I,J,K)) D:K="" FUT Q:K=""  S L=0 F LL=0:0 S L=$O(^UTILITY($J,I,J,K,L)) Q:L=""  D LIN,X
"RTN","SDROUT0",5,0)
 W:IOF]"" !,@IOF G END^SDROUT1
"RTN","SDROUT0",6,0)
CNT S SDCNT=SDCNT+1 Q
"RTN","SDROUT0",7,0)
X I $P(^UTILITY($J,I,J,K,L),"^")]"" W !,?4,$P(^(L),"^") Q
"RTN","SDROUT0",8,0)
 I $D(^DPT(+J,.36)),$D(^DIC(8,+^DPT(+J,.36),0)),$P(^(0),"^",9)=13 W !,?4,"** COLLATERAL **"
"RTN","SDROUT0",9,0)
 Q
"RTN","SDROUT0",10,0)
GO1 S I=0 Q:'SDREP!(SDX'["ALL")!(SDSTART="0000")  I SDSTART?4N S SDZ=(SDSTART-1)/10000,SDZ=$P(SDZ,".",2),SDZ=SDZ_$E("0000",1,4-$L(SDZ)),I=" "_SDZ K SDZ Q
"RTN","SDROUT0",11,0)
 I '$D(^UTILITY($J,SDSTART)) S I=SDSTART Q
"RTN","SDROUT0",12,0)
 S SDZ=$A($E(SDSTART,$L(SDSTART))),I=$E(SDSTART,1,$L(SDSTART)-1)_$C(SDZ-1) K SDZ Q
"RTN","SDROUT0",13,0)
GOT S DFN=$P(^SC(SC,"S",GDATE,1,L,0),"^") S POP=1 D CKP Q:POP
"RTN","SDROUT0",14,0)
 S NAME=$P(^DPT(DFN,0),"^"),TDO=$P(^(0),"^",9),TDO=$E(TDO,8,9)_$E(TDO,6,7)
"RTN","SDROUT0",15,0)
 D ^SDROUT1 G TDO:ORDER=1,CLO:ORDER=2,PLOC:ORDER=3 D COL S ^UTILITY($J,NAME,DFN,GDATE,SC)=$S(V:"** COLLATERAL **",1:"") K V
"RTN","SDROUT0",16,0)
 Q
"RTN","SDROUT0",17,0)
TDO D COL S ^UTILITY($J," "_TDO,DFN,GDATE,SC)=$S(V:"** COLLATERAL **",1:"") Q
"RTN","SDROUT0",18,0)
CLO D COL S SCN=$S($D(^SC(SC,0)):$P(^(0),"^"),1:SC),^UTILITY($J,"A",SCN," "_TDO,DFN)=SC_$S(V:"^** COLLATERAL **",1:""),^UTILITY($J,"B",DFN,GDATE)=SC K V Q
"RTN","SDROUT0",19,0)
PLOC I VAUTC=0,'$D(VAUTC(SC)) Q
"RTN","SDROUT0",20,0)
 D COL
"RTN","SDROUT0",21,0)
 S SDLOC=$P($G(^SC(SC,0)),"^",11) I SDLOC="" S SDLOC="NOT DEFINED"
"RTN","SDROUT0",22,0)
 I SDLOC'=SDPLSRT,SDPLSRT'="ALL" Q
"RTN","SDROUT0",23,0)
 S ^UTILITY($J,"A",SDLOC," "_TDO,DFN)=SC_$S(V:"** COLLATERAL **",1:"")
"RTN","SDROUT0",24,0)
 S ^UTILITY($J,"B",DFN,GDATE)=SC
"RTN","SDROUT0",25,0)
 K V
"RTN","SDROUT0",26,0)
 Q
"RTN","SDROUT0",27,0)
COL S V=0 I $P(^SC(SC,"S",GDATE,1,L,0),"^",10)]"" S V=$P(^(0),"^",10),V=$S($D(^DIC(8,+V,0)):$P(^(0),"^",9)=13,1:0)
"RTN","SDROUT0",28,0)
 Q
"RTN","SDROUT0",29,0)
CKP I SDREP D CKP1 Q
"RTN","SDROUT0",30,0)
 I 'DFN S DA(2)=SC,DA(1)=GDATE,DA=L,DIK="^SC("_DA(2)_",""S"","_DA(1)_",1," D ^DIK S POP=1 K DA,DIK Q   ;SD*509 kill bad node when DFN is null
"RTN","SDROUT0",31,0)
 I $D(^DPT(DFN,"S",GDATE,0)),$P(^(0),"^",2)'["C",$S($D(SDI1):1,SDX["ALL":1,SDIQ=1:1,$P(^(0),"^",6)'["Y":1,1:0) S POP=0
"RTN","SDROUT0",32,0)
 Q
"RTN","SDROUT0",33,0)
CKP1 I 'DFN S DA(2)=SC,DA(1)=GDATE,DA=L,DIK="^SC("_DA(2)_",""S"","_DA(1)_",1," D ^DIK S POP=1 K DA,DIK Q   ;SD*509 kill bad node when DFN is null
"RTN","SDROUT0",34,0)
 I $S('$D(^DPT(DFN,"S",GDATE,0)):1,$P(^(0),"^",2)["C":1,1:0) S POP=1 Q
"RTN","SDROUT0",35,0)
 I SDX["ALL" S POP=0 Q
"RTN","SDROUT0",36,0)
 I $P(^DPT(DFN,"S",GDATE,0),"^",13)']""!($P(^(0),"^",13)=SDSTART) S POP=0,$P(^(0),"^",13)=SDSTART Q
"RTN","SDROUT0",37,0)
 S POP=1 Q
"RTN","SDROUT0",38,0)
LIN S X=K D TM W !,$J(X,8) I $D(^SC(L,0)) W ?11,$P(^(0),"^",1) D LOC W ?42,SDLOC K SDLOC D:$D(^DPT(J,"S",K,0)) SETP W:'$D(^DPT(J,"S",K,0)) ?70,"*DELETED*" D SCCOND^SDROUT2
"RTN","SDROUT0",39,0)
 W:'$D(^SC(L,0)) ?11,L
"RTN","SDROUT0",40,0)
 D:$Y>(IOSL-5) HED^SDROUT2 Q
"RTN","SDROUT0",41,0)
LOC S SDLOC=$P(^SC(L,0),"^",11) I SDLOC']"",$D(^DIC(4,+$$SITE^VASITE,"DIV")),^("DIV")="Y" S SDLOC=$S($P(^SC(L,0),"^",15)=DIV:"",$D(^DG(40.8,+$P(^SC(L,0),"^",15),0)):$P(^(0),"^",1),1:"")
"RTN","SDROUT0",42,0)
 Q
"RTN","SDROUT0",43,0)
FUT I $O(^DPT(J,"S",SDATE_".9"))>0 D HED2 F M=SDATE_".9":0 S M=$O(^DPT(J,"S",M)) Q:M=""  D:$Y>(IOSL-5) HED^SDROUT2 I $S($P(^DPT(J,"S",M,0),"^",2)']"":1,$P(^(0),"^",2)="I":1,1:0) D LIN2
"RTN","SDROUT0",44,0)
 I SDREP,SDX'["ALL" W !!,"DATE PRINTED  : " S Y=SDSTART D DTS^SDUTL W Y,!,"DATE REPRINTED: ",PRDATE Q
"RTN","SDROUT0",45,0)
 W !!,"DATE PRINTED: ",PRDATE Q
"RTN","SDROUT0",46,0)
LIN2 D LIN2^SDROUT1
"RTN","SDROUT0",47,0)
 S L=+^DPT(J,"S",M,0),X=M D TM S Y=M D DTS^SDUTL W !,Y,?11,$J(X,8),?20,$P(^SC(L,0),"^",1) D LOC W ?52,SDLOC K SDLOC
"RTN","SDROUT0",48,0)
 Q
"RTN","SDROUT0",49,0)
HED2 W !!,?9,"**FUTURE APPOINTMENTS**"
"RTN","SDROUT0",50,0)
 W !!,"  DATE",?11,"TIME",?21,"CLINIC",?55,"LOCATION",! Q
"RTN","SDROUT0",51,0)
TM I $P(X,".",2)']"" S X1=""
"RTN","SDROUT0",52,0)
 S X=$E($P(X,".",2)_"0000",1,4),%=X>1159 S:X>1259 X=X-1200 S X=X\100_":"_$E(X#100+100,2,3)_" "_$E("AP",%+1)_"M" Q
"RTN","SDROUT0",53,0)
SETP S $P(^DPT(J,"S",K,0),"^",6)="Y" I $P(^(0),"^",13)']"" S $P(^(0),"^",13)=DT
"RTN","SDROUT0",54,0)
 Q
"RTN","SDROUT0",55,0)
CLIN F G=0:0 S I=$O(^UTILITY($J,"A",I)) Q:I=""  S SDTD=0 F H=0:0 S SDTD=$O(^UTILITY($J,"A",I,SDTD)) Q:SDTD=""  F J=0:0 S J=$O(^UTILITY($J,"A",I,SDTD,J)) Q:J=""  I ^(J) S SC=+^(J),POP=1 D FIRST I 'POP S P=0 D HED^SDROUT2,HD^SDROUT2,CNT,TIME
"RTN","SDROUT0",56,0)
 W:IOF]"" !,@IOF G END^SDROUT1
"RTN","SDROUT0",57,0)
FIRST I ORDER=3 S POP=0 Q
"RTN","SDROUT0",58,0)
 F A=SDATE:0 S A=$O(^DPT(J,"S",A)) Q:(A'>0)!($P(A,".")'=SDATE)  I $P(^(A,0),"^",2)'["C" S SD=+^(0) I $D(^SC(SD,0)),$S(DIV="":1,$P(^SC(SD,0),"^",15)=DIV:1,1:0) S:SD=+SC POP=0 Q
"RTN","SDROUT0",59,0)
 Q
"RTN","SDROUT0",60,0)
TIME F K=0:0 S K=$O(^UTILITY($J,"B",J,K)) D:K="" FUT Q:K=""  S L=^(K) D LIN,X1
"RTN","SDROUT0",61,0)
 Q
"RTN","SDROUT0",62,0)
X1 I $P(^UTILITY($J,"A",I,SDTD,J),"^",2)]"" W !,?4,$P(^(J),"^",2) Q
"RTN","SDROUT0",63,0)
 I $D(^DPT(+J,.36)),$D(^DIC(8,+^DPT(+J,.36),0)),$P(^(0),"^",9)=13 W !,?4,"** COLLATERAL **"
"RTN","SDROUT0",64,0)
 Q
"RTN","SDROUT0",65,0)
 ;
"VER")
8.0^22.0
"BLD",7435,6)
^462
**END**
**END**
