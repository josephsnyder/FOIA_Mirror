Released SD*5.3*98 SEQ #93
Extracted from mail message
**KIDS**:SD*5.3*98^

**INSTALL NAME**
SD*5.3*98
"BLD",150,0)
SD*5.3*98^SCHEDULING^0^2970314^n
"BLD",150,1,0)
^^3^3^2970228^
"BLD",150,1,1,0)
This patch addresses a problem raised in NOIS ISA-0197-12151, where the
"BLD",150,1,2,0)
position of the data for two fields is reversed on the PCMM Team's
"BLD",150,1,3,0)
Patients report.  See NPM for complete description.
"BLD",150,4,0)
^9.64PA^^
"BLD",150,"ABPKG")
n
"BLD",150,"KRN",0)
^9.67PA^19^18
"BLD",150,"KRN",.4,0)
.4
"BLD",150,"KRN",.401,0)
.401
"BLD",150,"KRN",.402,0)
.402
"BLD",150,"KRN",.403,0)
.403
"BLD",150,"KRN",.5,0)
.5
"BLD",150,"KRN",.84,0)
.84
"BLD",150,"KRN",3.6,0)
3.6
"BLD",150,"KRN",3.8,0)
3.8
"BLD",150,"KRN",9.2,0)
9.2
"BLD",150,"KRN",9.8,0)
9.8
"BLD",150,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",150,"KRN",9.8,"NM",1,0)
SCRPTP3^^0^B24840844
"BLD",150,"KRN",9.8,"NM","B","SCRPTP3",1)

"BLD",150,"KRN",19,0)
19
"BLD",150,"KRN",19.1,0)
19.1
"BLD",150,"KRN",101,0)
101
"BLD",150,"KRN",409.61,0)
409.61
"BLD",150,"KRN",771,0)
771
"BLD",150,"KRN",869.2,0)
869.2
"BLD",150,"KRN",870,0)
870
"BLD",150,"KRN",8994,0)
8994
"BLD",150,"KRN","B",.4,.4)

"BLD",150,"KRN","B",.401,.401)

"BLD",150,"KRN","B",.402,.402)

"BLD",150,"KRN","B",.403,.403)

"BLD",150,"KRN","B",.5,.5)

"BLD",150,"KRN","B",.84,.84)

"BLD",150,"KRN","B",3.6,3.6)

"BLD",150,"KRN","B",3.8,3.8)

"BLD",150,"KRN","B",9.2,9.2)

"BLD",150,"KRN","B",9.8,9.8)

"BLD",150,"KRN","B",19,19)

"BLD",150,"KRN","B",19.1,19.1)

"BLD",150,"KRN","B",101,101)

"BLD",150,"KRN","B",409.61,409.61)

"BLD",150,"KRN","B",771,771)

"BLD",150,"KRN","B",869.2,869.2)

"BLD",150,"KRN","B",870,870)

"BLD",150,"KRN","B",8994,8994)

"BLD",150,"QUES",0)
^9.62^^
"BLD",150,"REQB",0)
^9.611^2^2
"BLD",150,"REQB",1,0)
SD*5.3*41^1
"BLD",150,"REQB",2,0)
SD*5.3*48^1
"BLD",150,"REQB","B","SD*5.3*41",1)

"BLD",150,"REQB","B","SD*5.3*48",2)

"OER",16,0)
16^SD^^M.A.S.^
"OER",16,1,0)
^100.9951PA^2^2
"OER",16,1,1,0)
103
"OER",16,1,1,1,0)
^100.99511PA^1^1
"OER",16,1,1,1,1,0)
101
"OER",16,1,2,0)
645
"OER",16,1,2,1,0)
^100.99511PA^1^1
"OER",16,1,2,1,1,0)
121
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2941102
"PKG",16,22,1,"PAH",1,0)
98^2970314
"PKG",16,22,1,"PAH",1,1,0)
^^3^3^2970303
"PKG",16,22,1,"PAH",1,1,1,0)
This patch addresses a problem raised in NOIS ISA-0197-12151, where the
"PKG",16,22,1,"PAH",1,1,2,0)
position of the data for two fields is reversed on the PCMM Team's
"PKG",16,22,1,"PAH",1,1,3,0)
Patients report.  See NPM for complete description.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","SCRPTP3")
0^1^B24840844
"RTN","SCRPTP3",1,0)
SCRPTP3 ;ALB/CMM - List of Team's Patients ;02/29/96
"RTN","SCRPTP3",2,0)
 ;;5.3;Scheduling;**41,48,98**;AUG 13, 1993
"RTN","SCRPTP3",3,0)
 ;
"RTN","SCRPTP3",4,0)
 ;List of Team's Patients Report
"RTN","SCRPTP3",5,0)
 ;
"RTN","SCRPTP3",6,0)
HITS(ARRY,TIEN) ;
"RTN","SCRPTP3",7,0)
 ;ARRY - list of patients for a given team
"RTN","SCRPTP3",8,0)
 ;TIEN - team ien
"RTN","SCRPTP3",9,0)
 ;
"RTN","SCRPTP3",10,0)
 N PTIEN,PIEN,PTNAME,PNAME,PTAI,NXT,NODE,CIEN,CNAME,INAME,INST,LAST,NEXT
"RTN","SCRPTP3",11,0)
 N PAIEN,PC,PHONE,PNODE,PTPA,PTPAN,ROL,PID,TINFO,TNAME,TPIEN,TPNODE
"RTN","SCRPTP3",12,0)
 N CNT,TPA,FLAG,DFN,VA,VAERR
"RTN","SCRPTP3",13,0)
 S NXT=0
"RTN","SCRPTP3",14,0)
 F  S NXT=$O(@ARRY@(NXT)) Q:NXT=""!(NXT'?.N)  D
"RTN","SCRPTP3",15,0)
 .S NODE=$G(@ARRY@(NXT))
"RTN","SCRPTP3",16,0)
 .Q:NODE=""
"RTN","SCRPTP3",17,0)
 .S PTIEN=+$P(NODE,"^") ;patient ien
"RTN","SCRPTP3",18,0)
 .S PTNAME=$E($P(NODE,"^",2),1,15) ;patient name
"RTN","SCRPTP3",19,0)
 .S PTAI=+$P(NODE,"^",3) ;patient team assignment ien (#404.42)
"RTN","SCRPTP3",20,0)
 .;
"RTN","SCRPTP3",21,0)
 .S PNODE=$G(^DPT(PTIEN,0))
"RTN","SCRPTP3",22,0)
 .Q:PNODE=""
"RTN","SCRPTP3",23,0)
 .S DFN=PTIEN
"RTN","SCRPTP3",24,0)
 .D PID^VADPT6
"RTN","SCRPTP3",25,0)
 .S PID=VA("BID")
"RTN","SCRPTP3",26,0)
 .;
"RTN","SCRPTP3",27,0)
 .S TPA=$$TPAR(PTAI,"")
"RTN","SCRPTP3",28,0)
 .I TPA'=-1 D
"RTN","SCRPTP3",29,0)
 ..S PIEN=$P(TPA,"^")
"RTN","SCRPTP3",30,0)
 ..S PNAME=$P(TPA,"^",2)
"RTN","SCRPTP3",31,0)
 ..S CNAME=$P(TPA,"^",3)
"RTN","SCRPTP3",32,0)
 ..S LAST=$P(TPA,"^",4)
"RTN","SCRPTP3",33,0)
 ..S NEXT=$P(TPA,"^",5)
"RTN","SCRPTP3",34,0)
 ..;
"RTN","SCRPTP3",35,0)
 ..S FLAG="Y"
"RTN","SCRPTP3",36,0)
 ..S TINFO=$$TINF^SCRPTP(TIEN) ;team information
"RTN","SCRPTP3",37,0)
 ..S INST=+$P(TINFO,"^") ;institution ien
"RTN","SCRPTP3",38,0)
 ..S INAME=$P($G(^DIC(4,INST,0)),"^") ;institution name
"RTN","SCRPTP3",39,0)
 ..S PHONE=$P(TINFO,"^",4) ;team phone
"RTN","SCRPTP3",40,0)
 ..S PC=$P(TINFO,"^",3) ;primary care?
"RTN","SCRPTP3",41,0)
 ..S TNAME=$P(TINFO,"^",2) ;team name
"RTN","SCRPTP3",42,0)
 ..;
"RTN","SCRPTP3",43,0)
 ..D TFORMAT^SCRPTP2(INST,INAME,TIEN,TNAME,PHONE,PC)
"RTN","SCRPTP3",44,0)
 ..D FORMAT^SCRPTP(INST,TIEN,PTIEN,PTNAME,PID,PIEN,PNAME,CNAME,LAST,NEXT)
"RTN","SCRPTP3",45,0)
 .;
"RTN","SCRPTP3",46,0)
 .;check for other assignments
"RTN","SCRPTP3",47,0)
 .N TPIN
"RTN","SCRPTP3",48,0)
 .S CNT=""
"RTN","SCRPTP3",49,0)
 .F  S CNT=$O(^SCPT(404.43,"B",PTAI,CNT)) Q:CNT=""!(CNT'?.N)  D
"RTN","SCRPTP3",50,0)
 ..S TPIN=$$TPAR(PTAI,CNT)
"RTN","SCRPTP3",51,0)
 ..Q:TPIN=-1
"RTN","SCRPTP3",52,0)
 ..S PIEN=$P(TPIN,"^")
"RTN","SCRPTP3",53,0)
 ..S PNAME=$P(TPIN,"^",2)
"RTN","SCRPTP3",54,0)
 ..S CNAME=$P(TPIN,"^",3)
"RTN","SCRPTP3",55,0)
 ..S LAST=$P(TPIN,"^",4)
"RTN","SCRPTP3",56,0)
 ..S NEXT=$P(TPIN,"^",5)
"RTN","SCRPTP3",57,0)
 ..I '$D(FLAG) D
"RTN","SCRPTP3",58,0)
 ...S TINFO=$$TINF^SCRPTP(TIEN) ;team information
"RTN","SCRPTP3",59,0)
 ...S INST=+$P(TINFO,"^") ;institution ien
"RTN","SCRPTP3",60,0)
 ...S INAME=$P($G(^DIC(4,INST,0)),"^") ;institution name
"RTN","SCRPTP3",61,0)
 ...S PHONE=$P(TINFO,"^",4) ;team phone
"RTN","SCRPTP3",62,0)
 ...S PC=$P(TINFO,"^",3) ;primary care?
"RTN","SCRPTP3",63,0)
 ...S TNAME=$P(TINFO,"^",2) ;team name
"RTN","SCRPTP3",64,0)
 ...;
"RTN","SCRPTP3",65,0)
 ...D TFORMAT^SCRPTP2(INST,INAME,TIEN,TNAME,PHONE,PC)
"RTN","SCRPTP3",66,0)
 ..D FORMAT^SCRPTP(INST,TIEN,PTIEN,PTNAME,PID,PIEN,PNAME,CNAME,LAST,NEXT)
"RTN","SCRPTP3",67,0)
 Q
"RTN","SCRPTP3",68,0)
 ;
"RTN","SCRPTP3",69,0)
TPAR(PTAI,START) ;
"RTN","SCRPTP3",70,0)
 N PTPA,TPIEN,TPNODE,ROL,CNAME,CIEN,ENROLL,OKAY,PNAME,NEXT,LAST,PAIEN
"RTN","SCRPTP3",71,0)
 I '$D(^SCPT(404.43,"B",PTAI)) Q "0^[Not Assigned]"
"RTN","SCRPTP3",72,0)
 ; ^ no patient team position assignment
"RTN","SCRPTP3",73,0)
 IF START="" D
"RTN","SCRPTP3",74,0)
 .S PTPA=$O(^SCPT(404.43,"B",PTAI,START))
"RTN","SCRPTP3",75,0)
 ELSE  D
"RTN","SCRPTP3",76,0)
 .S PTPA=START
"RTN","SCRPTP3",77,0)
 I PTPA="" Q "0^[Not Assigned]"
"RTN","SCRPTP3",78,0)
 S PTPAN=$G(^SCPT(404.43,PTPA,0)) ;patient team position assignment node
"RTN","SCRPTP3",79,0)
 I PTPAN=""!(PTPAN=0) Q "0^[Not Assigned]"
"RTN","SCRPTP3",80,0)
 I $P(PTPAN,"^",4)'="",$P(PTPAN,"^",4)<DT Q -1
"RTN","SCRPTP3",81,0)
 S TPIEN=+$P(PTPAN,"^",2) ;team position ien (#404.57)
"RTN","SCRPTP3",82,0)
 I '$D(^SCTM(404.57,TPIEN,0)) Q "0^[Not Assigned]"
"RTN","SCRPTP3",83,0)
 S TPNODE=$G(^SCTM(404.57,TPIEN,0))
"RTN","SCRPTP3",84,0)
 I TPNODE="" Q "0^[Not Assigned]"
"RTN","SCRPTP3",85,0)
 S ROL=+$P(TPNODE,"^",3) ;role for position (ien)
"RTN","SCRPTP3",86,0)
 Q:'$D(ROLE(ROL))&(ROLE'=1) -1
"RTN","SCRPTP3",87,0)
 ; ^ not a selected role
"RTN","SCRPTP3",88,0)
 ;
"RTN","SCRPTP3",89,0)
 S CIEN=+$P(TPNODE,"^",9) ;associated clinic ien
"RTN","SCRPTP3",90,0)
 S CNAME=$E($P($G(^SC(CIEN,0)),"^"),1,15) ;clinic name
"RTN","SCRPTP3",91,0)
 ;check patient status
"RTN","SCRPTP3",92,0)
 S OKAY=""
"RTN","SCRPTP3",93,0)
 I CIEN>0&(PSTAT'=1) S OKAY=$$PST^SCRPTP(PTIEN,CIEN)
"RTN","SCRPTP3",94,0)
 Q:(CIEN>0)&('OKAY)&(PSTAT'=1) -1
"RTN","SCRPTP3",95,0)
 ; ^ not selected patient status
"RTN","SCRPTP3",96,0)
 ;
"RTN","SCRPTP3",97,0)
 S ENROLL=$$ENRL(PTIEN,CIEN) ;enrolled in associated clinic
"RTN","SCRPTP3",98,0)
 I 'ENROLL S CNAME="",CIEN=0
"RTN","SCRPTP3",99,0)
 ;
"RTN","SCRPTP3",100,0)
 S PAIEN=$$CHK(TPIEN)
"RTN","SCRPTP3",101,0)
 I +PAIEN'=0 S PIEN=+PAIEN,PNAME=$P(PAIEN,"^",2) ; practitioner's name
"RTN","SCRPTP3",102,0)
 I +PAIEN=0 S PIEN=0,PNAME="["_$E($P(TPNODE,U,1),1,20)_"]"
"RTN","SCRPTP3",103,0)
 ;
"RTN","SCRPTP3",104,0)
 S (NEXT,LAST)=""
"RTN","SCRPTP3",105,0)
 I +CIEN>0 S NEXT=$$GETNEXT^SCRPU3(PTIEN,CIEN) ;next appointment
"RTN","SCRPTP3",106,0)
 I +CIEN>0 S LAST=$$GETLAST^SCRPU3(PTIEN,CIEN) ;last appointment
"RTN","SCRPTP3",107,0)
 ;
"RTN","SCRPTP3",108,0)
 Q PIEN_"^"_PNAME_"^"_CNAME_"^"_LAST_"^"_NEXT
"RTN","SCRPTP3",109,0)
 ;
"RTN","SCRPTP3",110,0)
ENRL(PTIEN,CLIEN) ;
"RTN","SCRPTP3",111,0)
 ;
"RTN","SCRPTP3",112,0)
 N FOUND,ENODE,EN,NXT
"RTN","SCRPTP3",113,0)
 S FOUND=0
"RTN","SCRPTP3",114,0)
 Q:'$D(^DPT(PTIEN,"DE","B",CLIEN)) FOUND
"RTN","SCRPTP3",115,0)
 S EN=$O(^DPT(PTIEN,"DE","B",CLIEN,""))
"RTN","SCRPTP3",116,0)
 Q:EN=""!'$D(^DPT(PTIEN,"DE",EN,1)) FOUND
"RTN","SCRPTP3",117,0)
 S NXT=""
"RTN","SCRPTP3",118,0)
 F  S NXT=$O(^DPT(PTIEN,"DE",EN,1,NXT)) Q:(FOUND)!(NXT="")!(NXT'?.N)  D
"RTN","SCRPTP3",119,0)
 .;check if active enrollment
"RTN","SCRPTP3",120,0)
 .S ENODE=$G(^DPT(PTIEN,"DE",EN,1,NXT,0))
"RTN","SCRPTP3",121,0)
 .I $P(ENODE,"^",3)'="",$P(ENODE,"^",3)<DT+1!$P(ENODE,"^")>DT Q  ;not active enrollment
"RTN","SCRPTP3",122,0)
 .;                      ^ discharge date     ^ enrollment date
"RTN","SCRPTP3",123,0)
 .S FOUND=1
"RTN","SCRPTP3",124,0)
 Q FOUND
"RTN","SCRPTP3",125,0)
 ;
"RTN","SCRPTP3",126,0)
CHK(TPIEN) ;assigned to a position
"RTN","SCRPTP3",127,0)
 ;TPIEN - ien of 404.57 Team Position file
"RTN","SCRPTP3",128,0)
 ;returns:  ien of 200 New Person file
"RTN","SCRPTP3",129,0)
 N EN,PLIST,PERR,ERR,NAME
"RTN","SCRPTP3",130,0)
 S PLIST="PLST",PERR="PRR"
"RTN","SCRPTP3",131,0)
 K @PLIST,@PERR
"RTN","SCRPTP3",132,0)
 S ERR=$$PRTP^SCAPMC8(TPIEN,,.PLIST,.PERR)
"RTN","SCRPTP3",133,0)
 I '$D(@PERR) D
"RTN","SCRPTP3",134,0)
 .S EN=$P($G(@PLIST@(1)),"^") ;ien of new person file
"RTN","SCRPTP3",135,0)
 .S NAME=$P($G(@PLIST@(1)),"^",2) ; new person name
"RTN","SCRPTP3",136,0)
 K @PLIST,@PERR
"RTN","SCRPTP3",137,0)
 Q EN_"^"_NAME
"RTN","SCRPTP3",138,0)
 ;
"VER")
8.0^21.0
**END**
**END**
