Released SD*5.3*561 SEQ #466
Extracted from mail message
**KIDS**:SD*5.3*561^

**INSTALL NAME**
SD*5.3*561
"BLD",8247,0)
SD*5.3*561^SCHEDULING^0^3100222^y
"BLD",8247,1,0)
^^7^7^3100222^
"BLD",8247,1,1,0)
Fix for several Recall Reminder issues: case sensitivity issue when 
"BLD",8247,1,2,0)
making a Recall Reminder entry, incorrect wording in message display in 
"BLD",8247,1,3,0)
CPRS, date range issue with Printing letters by team, an <Undefined> 
"BLD",8247,1,4,0)
error that occurs with Print Letters by Clinic or by Provider if an 
"BLD",8247,1,5,0)
up-arrow is entered at the date range prompt and extraneous text that 
"BLD",8247,1,6,0)
prints at the top of the Letter for Nonresponsive Patients and displaying 
"BLD",8247,1,7,0)
the full clinic name on the CPRS Cover Sheet.
"BLD",8247,4,0)
^9.64PA^^
"BLD",8247,6.3)
7
"BLD",8247,"ABPKG")
n
"BLD",8247,"KRN",0)
^9.67PA^779.2^20
"BLD",8247,"KRN",.4,0)
.4
"BLD",8247,"KRN",.401,0)
.401
"BLD",8247,"KRN",.402,0)
.402
"BLD",8247,"KRN",.403,0)
.403
"BLD",8247,"KRN",.5,0)
.5
"BLD",8247,"KRN",.84,0)
.84
"BLD",8247,"KRN",3.6,0)
3.6
"BLD",8247,"KRN",3.8,0)
3.8
"BLD",8247,"KRN",9.2,0)
9.2
"BLD",8247,"KRN",9.8,0)
9.8
"BLD",8247,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",8247,"KRN",9.8,"NM",1,0)
SDRR1^^0^B14295319
"BLD",8247,"KRN",9.8,"NM",2,0)
SDRRCLR2^^0^B10839141
"BLD",8247,"KRN",9.8,"NM",3,0)
SDRROR^^0^B4074384
"BLD",8247,"KRN",9.8,"NM",4,0)
SDRRRECL^^0^B85115679
"BLD",8247,"KRN",9.8,"NM","B","SDRR1",1)

"BLD",8247,"KRN",9.8,"NM","B","SDRRCLR2",2)

"BLD",8247,"KRN",9.8,"NM","B","SDRROR",3)

"BLD",8247,"KRN",9.8,"NM","B","SDRRRECL",4)

"BLD",8247,"KRN",19,0)
19
"BLD",8247,"KRN",19.1,0)
19.1
"BLD",8247,"KRN",101,0)
101
"BLD",8247,"KRN",409.61,0)
409.61
"BLD",8247,"KRN",771,0)
771
"BLD",8247,"KRN",779.2,0)
779.2
"BLD",8247,"KRN",870,0)
870
"BLD",8247,"KRN",8989.51,0)
8989.51
"BLD",8247,"KRN",8989.52,0)
8989.52
"BLD",8247,"KRN",8994,0)
8994
"BLD",8247,"KRN","B",.4,.4)

"BLD",8247,"KRN","B",.401,.401)

"BLD",8247,"KRN","B",.402,.402)

"BLD",8247,"KRN","B",.403,.403)

"BLD",8247,"KRN","B",.5,.5)

"BLD",8247,"KRN","B",.84,.84)

"BLD",8247,"KRN","B",3.6,3.6)

"BLD",8247,"KRN","B",3.8,3.8)

"BLD",8247,"KRN","B",9.2,9.2)

"BLD",8247,"KRN","B",9.8,9.8)

"BLD",8247,"KRN","B",19,19)

"BLD",8247,"KRN","B",19.1,19.1)

"BLD",8247,"KRN","B",101,101)

"BLD",8247,"KRN","B",409.61,409.61)

"BLD",8247,"KRN","B",771,771)

"BLD",8247,"KRN","B",779.2,779.2)

"BLD",8247,"KRN","B",870,870)

"BLD",8247,"KRN","B",8989.51,8989.51)

"BLD",8247,"KRN","B",8989.52,8989.52)

"BLD",8247,"KRN","B",8994,8994)

"BLD",8247,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",8247,"QUES",0)
^9.62^^
"BLD",8247,"REQB",0)
^9.611^1^1
"BLD",8247,"REQB",1,0)
SD*5.3*536^2
"BLD",8247,"REQB","B","SD*5.3*536",1)

"MBREQ")
0
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813
"PKG",16,22,1,"PAH",1,0)
561^3100222
"PKG",16,22,1,"PAH",1,1,0)
^^7^7^3100222
"PKG",16,22,1,"PAH",1,1,1,0)
Fix for several Recall Reminder issues: case sensitivity issue when 
"PKG",16,22,1,"PAH",1,1,2,0)
making a Recall Reminder entry, incorrect wording in message display in 
"PKG",16,22,1,"PAH",1,1,3,0)
CPRS, date range issue with Printing letters by team, an <Undefined> 
"PKG",16,22,1,"PAH",1,1,4,0)
error that occurs with Print Letters by Clinic or by Provider if an 
"PKG",16,22,1,"PAH",1,1,5,0)
up-arrow is entered at the date range prompt and extraneous text that 
"PKG",16,22,1,"PAH",1,1,6,0)
prints at the top of the Letter for Nonresponsive Patients and displaying 
"PKG",16,22,1,"PAH",1,1,7,0)
the full clinic name on the CPRS Cover Sheet.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","SDRR1")
0^1^B14295319^B13934931
"RTN","SDRR1",1,0)
SDRR1 ;10N20/MAH ;RECALL REMINDER ENTER EDIT 7/28/04
"RTN","SDRR1",2,0)
 ;;5.3;Scheduling;**536,561**;Aug 13, 1993;Build 7
"RTN","SDRR1",3,0)
EN ;Entry point
"RTN","SDRR1",4,0)
 ;Tag STR will determine if the patient has already been enter into open access
"RTN","SDRR1",5,0)
 ;This routine is SDRRCLR EVENT protocol which is put on to SDAM MENU
"RTN","SDRR1",6,0)
 ;protocol
"RTN","SDRR1",7,0)
 ;This routine does not kill off DFN
"RTN","SDRR1",8,0)
STR(SDFN) ;Start checking entries in 403.5 if there is a "b" goes to update - if not goes to NEW   
"RTN","SDRR1",9,0)
 N I,Y,CLINIC,C,D,KEY,KY,COMM
"RTN","SDRR1",10,0)
 S DFN=SDFN
"RTN","SDRR1",11,0)
 I '$D(^SD(403.5,"B",DFN)) W !,"No Clinic Recall on file",! S DIR(0)="Y",DIR("A")="Are you sure you want to add a Recall entry ",DIR("B")="NO" D ^DIR I Y'=1 G QUIT
"RTN","SDRR1",12,0)
 I $G(Y)>0 I '$D(^SD(403.5,"B",DFN)) G NEW
"RTN","SDRR1",13,0)
EN1 S C=0 F I=0:0 S I=$O(^SD(403.5,"B",DFN,I)) Q:'I  I $D(^SD(403.5,I,0)) S D=^(0),C=C+1 S ^TMP("SDRRCLR",$J,C)=I_"^"_D
"RTN","SDRR1",14,0)
 S (ER,OK)=0 W !,"CHOOSE FROM:" F I=0:0 S I=$O(^TMP("SDRRCLR",$J,I)) Q:'I   S CLINIC=$P($G(^TMP("SDRRCLR",$J,I)),"^",3) D
"RTN","SDRR1",15,0)
 .W !,$J(I,4),">  "
"RTN","SDRR1",16,0)
 .I CLINIC'="" S CLINIC=$$GET1^DIQ(44,CLINIC_",",.01)
"RTN","SDRR1",17,0)
 .I CLINIC="" S CLINIC="UNK. CLINIC"
"RTN","SDRR1",18,0)
 .S PROV=$P($G(^TMP("SDRRCLR",$J,I)),"^",6) I PROV'="" S PROV=$P($G(^SD(403.54,PROV,0)),"^",1) I PROV'="" S PROV=$$NAME^XUSER(PROV,"F")
"RTN","SDRR1",19,0)
 .I PROV="" S PROV="UNK. PROVIDER"
"RTN","SDRR1",20,0)
 .S RDT=$P(^TMP("SDRRCLR",$J,I),"^",7) S Y=RDT D DD^%DT S RDT=Y
"RTN","SDRR1",21,0)
 .S RS=$P(^TMP("SDRRCLR",$J,I),"^",11) S Y=RS D DD^%DT S RS=Y
"RTN","SDRR1",22,0)
 .S COMM="",COMM=$P(^TMP("SDRRCLR",$J,I),"^",8)
"RTN","SDRR1",23,0)
 .W "CLINIC:"_$E(CLINIC,1,15),?28," R/DATE:"_RDT,?53," NOTICE SENT:"_RS
"RTN","SDRR1",24,0)
 .W !,?5,"PROVIDER:"_$E(PROV,1,20) S Z=I I $G(COMM)]"" W !,?5,$G(COMM) S Z=I
"RTN","SDRR1",25,0)
 W !,"CHOOSE 1-",Z_" OR TYPE ""A"" TO ADD:" W:$D(^TMP("SDRRCLR",$J,I+1)) !,"OR '^' TO QUIT" W ": " R X:DTIME I $S('$T!(X["^"):1,X="":1,1:0) S ER=1 G QUIT
"RTN","SDRR1",26,0)
 ;CHECK PARAM IF NEEDED
"RTN","SDRR1",27,0)
 G QUIT:ER
"RTN","SDRR1",28,0)
 X ^%ZOSF("UPPERCASE") S X=Y  ;SD*561 convert lowercase to uppercase
"RTN","SDRR1",29,0)
 I X["A" G NEW
"RTN","SDRR1",30,0)
 S DA=$P($G(^TMP("SDRRCLR",$J,X)),"^",1) I DA="" K DA,C,CLINIC,PROV,RDT G EN1
"RTN","SDRR1",31,0)
 S (PROV1,KEY,FLAG)="" S PROV1=$P($G(^SD(403.5,DA,0)),"^",5) I PROV1'="" S KEY=$P($G(^SD(403.54,PROV1,0)),"^",7) D
"RTN","SDRR1",32,0)
 .I PROV1="" Q
"RTN","SDRR1",33,0)
 .I KEY="" Q
"RTN","SDRR1",34,0)
 .N VALUE
"RTN","SDRR1",35,0)
 .S VALUE=$$LKUP^XPDKEY(KEY) K KY D OWNSKEY^XUSRB(.KY,VALUE,DUZ)
"RTN","SDRR1",36,0)
 .I $P(KY(0),"^",1)=0 W !,?25,"**YOU DO NOT HAVE ACCESS TO THIS ENTRY**",!,?12,"PLEASE CHECK WITH YOUR ADPAC OR IRM TO GET THE PROPER SECURITY KEY" R X:3 K KEY,PROV1 D QUIT S FLAG=1
"RTN","SDRR1",37,0)
 .Q
"RTN","SDRR1",38,0)
 I FLAG=1 K FLAG Q
"RTN","SDRR1",39,0)
 ;END OF NEW CHANGE
"RTN","SDRR1",40,0)
 G UPDATE
"RTN","SDRR1",41,0)
 Q
"RTN","SDRR1",42,0)
 ;
"RTN","SDRR1",43,0)
NEW ;Adds new entry
"RTN","SDRR1",44,0)
 W !!,"*Must have Recall Date,approved Recall Clinic,Recall Provider and Type of Recall"
"RTN","SDRR1",45,0)
 S DIR(0)="Y",DIR("A")="Do you have this information",DIR("B")="NO" D ^DIR I Y'=1 G QUIT
"RTN","SDRR1",46,0)
 S (DIC,DIE)="^SD(403.5,",DIC(0)="LZ",X=DFN,DLAYGO=403.5 D FILE^DICN S NUM=+Y
"RTN","SDRR1",47,0)
 S DA=NUM,DR="[SDRR RECALL CARD ADD]",DIE("NO^")="Not Allowed" D ^DIE
"RTN","SDRR1",48,0)
 K DIC,DIE,DR,D0,DA,DLAYGO,NUM,PROV,X,Y,Z,OK,RDT,CLINIC,RS,KEY,COMM,DIR
"RTN","SDRR1",49,0)
 K ^TMP("SDRRCLR",$J)
"RTN","SDRR1",50,0)
 Q
"RTN","SDRR1",51,0)
UPDATE ;Asks for new data
"RTN","SDRR1",52,0)
 K DIC,DIE,DR S DIE="^SD(403.5,",DR="[SDRR RECALL CARD ADD]",DIE("NO^")="BACKOUTOK" D ^DIE
"RTN","SDRR1",53,0)
 K DIC,DIE,DR,D0,DA,DLAYGO,NUM,PROV,X,Y,Z,OK,RDT,CLINIC,RS,KEY,COMM
"RTN","SDRR1",54,0)
 D QUIT
"RTN","SDRR1",55,0)
 Q
"RTN","SDRR1",56,0)
SDAM ;Entry Point for Appointment Management protocol
"RTN","SDRR1",57,0)
 N ORACTION,ORVP,XQORQUIT,SDAMERR,SDCOAP,VALMY
"RTN","SDRR1",58,0)
 S VALMBCK=""
"RTN","SDRR1",59,0)
 D FULL^VALM1
"RTN","SDRR1",60,0)
 I SDAMTYP="P" W !!,VALMHDR(1),! D STR(SDFN)
"RTN","SDRR1",61,0)
 I SDAMTYP="C" D
"RTN","SDRR1",62,0)
 .D EN^VALM2(XQORNOD(0))
"RTN","SDRR1",63,0)
 .S SDCOAP=0 F  S SDCOAP=$O(VALMY(SDCOAP)) Q:'SDCOAP  D
"RTN","SDRR1",64,0)
 ..I $D(^TMP("SDAMIDX",$J,SDCOAP)) K SDAT S SDAT=^(SDCOAP) D
"RTN","SDRR1",65,0)
 ...W !!,^TMP("SDAM",$J,+SDAT,0),!
"RTN","SDRR1",66,0)
 ...D STR(+$P(SDAT,"^",2))
"RTN","SDRR1",67,0)
 S VALMBCK="R"
"RTN","SDRR1",68,0)
QUIT K PROV,CLINIC,X,Y,C,D,ER,OK,PROV1,KEY,RS,FLAG,DIR,DFN,DIR
"RTN","SDRR1",69,0)
 K ^TMP("SDRRCLR",$J)
"RTN","SDRR1",70,0)
 Q
"RTN","SDRRCLR2")
0^2^B10839141^B10431466
"RTN","SDRRCLR2",1,0)
SDRRCLR2 ;10N20/MAH- Recall Reminder ENTER EDIT 9/28/04
"RTN","SDRRCLR2",2,0)
 ;;5.3;Scheduling;**536,561**;Aug 13, 1993;Build 7
"RTN","SDRRCLR2",3,0)
 ;;THIS ROUTINE WILL USE OPTION SDRR CARD ADD
"RTN","SDRRCLR2",4,0)
STR ;Start checking entries in 403.5 if there is a "b" goes to update - if not goes to NEW   
"RTN","SDRRCLR2",5,0)
 N I,Y,CLINIC,C,D,KY,COMM
"RTN","SDRRCLR2",6,0)
 K ^TMP("SDRRCLR")
"RTN","SDRRCLR2",7,0)
 D ^DPTLK Q:Y<1
"RTN","SDRRCLR2",8,0)
 S DFN=+Y
"RTN","SDRRCLR2",9,0)
 I '$D(^SD(403.5,"B",DFN)) W !,"No Clinic Recall on file",! G NEW
"RTN","SDRRCLR2",10,0)
EN1 S C=0 F I=0:0 S I=$O(^SD(403.5,"B",DFN,I)) Q:'I  I $D(^SD(403.5,I,0)) S D=^(0),C=C+1 S ^TMP("SDRRCLR",$J,C)=I_"^"_D
"RTN","SDRRCLR2",11,0)
 S (ER,OK)=0 W !,"CHOOSE FROM:" F I=0:0 S I=$O(^TMP("SDRRCLR",$J,I)) Q:'I   S CLINIC=$P($G(^TMP("SDRRCLR",$J,I)),"^",3) D
"RTN","SDRRCLR2",12,0)
 .W !,$J(I,4),">  "
"RTN","SDRRCLR2",13,0)
 .I CLINIC'="" S CLINIC=$$GET1^DIQ(44,CLINIC_",",.01)
"RTN","SDRRCLR2",14,0)
 .I CLINIC="" S CLINIC="UNK. CLINIC"
"RTN","SDRRCLR2",15,0)
 .S PROV=$P($G(^TMP("SDRRCLR",$J,I)),"^",6) I PROV'="" S PROV=$P($G(^SD(403.54,PROV,0)),"^",1) I PROV'="" S PROV=$$NAME^XUSER(PROV,"F")
"RTN","SDRRCLR2",16,0)
 .I PROV="" S PROV="UNK. PROVIDER"
"RTN","SDRRCLR2",17,0)
 .S RDT=$P(^TMP("SDRRCLR",$J,I),"^",7) S Y=RDT D DD^%DT S RDT=Y
"RTN","SDRRCLR2",18,0)
 .S RS=$P(^TMP("SDRRCLR",$J,I),"^",11) S Y=RS D DD^%DT S RS=Y
"RTN","SDRRCLR2",19,0)
 .S COMM="",COMM=$P(^TMP("SDRRCLR",$J,I),"^",8)
"RTN","SDRRCLR2",20,0)
 .W ?1,"CLINIC:"_$E(CLINIC,1,15),?28," R/DATE:"_RDT,?53," NOTICE SENT:"_RS
"RTN","SDRRCLR2",21,0)
 .W !,?5,"PROVIDER:"_$E(PROV,1,20) S Z=I I $G(COMM)]"" W !,?5,$G(COMM) S Z=I
"RTN","SDRRCLR2",22,0)
 W !,"CHOOSE 1-",Z_" OR TYPE ""A"" TO ADD:" W:$D(^TMP("SDRRCLR",$J,I+1)) !,"OR '^' TO QUIT" W ": " R X:DTIME I $S('$T!(X["^"):1,X="":1,1:0) S ER=1 G QUIT
"RTN","SDRRCLR2",23,0)
 G QUIT:ER
"RTN","SDRRCLR2",24,0)
 X ^%ZOSF("UPPERCASE") S X=Y  ;SD*561 convert lowercase to uppercase
"RTN","SDRRCLR2",25,0)
 I X["A" G NEW
"RTN","SDRRCLR2",26,0)
 S DA=$P($G(^TMP("SDRRCLR",$J,X)),"^",1) I DA="" K DA,C,CLINIC,PROV,RDT G EN1
"RTN","SDRRCLR2",27,0)
 S (PROV1,KEY,FLAG)="" S PROV1=$P($G(^SD(403.5,DA,0)),"^",5) I PROV1'="" S KEY=$P($G(^SD(403.54,PROV1,0)),"^",7) D
"RTN","SDRRCLR2",28,0)
 .I PROV1="" Q
"RTN","SDRRCLR2",29,0)
 .I KEY="" Q
"RTN","SDRRCLR2",30,0)
 .N VALUE
"RTN","SDRRCLR2",31,0)
 .S VALUE=$$LKUP^XPDKEY(KEY) K KY D OWNSKEY^XUSRB(.KY,VALUE,DUZ)
"RTN","SDRRCLR2",32,0)
 .I $P(KY(0),"^",1)=0 W !,?25,"**YOU DO NOT HAVE ACCESS TO THIS ENTRY**",!,?12,"PLEASE CHECK WITH YOUR ADPAC OR IRM TO GET THE PROPER SECURITY KEY" R X:3 K KEY,PROV1 D QUIT S FLAG=1
"RTN","SDRRCLR2",33,0)
 .Q
"RTN","SDRRCLR2",34,0)
 I FLAG=1 K FLAG Q
"RTN","SDRRCLR2",35,0)
 ;END OF NEW CHANGE
"RTN","SDRRCLR2",36,0)
 G UPDATE
"RTN","SDRRCLR2",37,0)
 Q
"RTN","SDRRCLR2",38,0)
 ;
"RTN","SDRRCLR2",39,0)
 ;
"RTN","SDRRCLR2",40,0)
NEW ;Adds new entry
"RTN","SDRRCLR2",41,0)
 W !!,"*Must have Recall Date,approved Recall Clinic,Recall Provider and Type of Recall"
"RTN","SDRRCLR2",42,0)
 S DIR(0)="Y",DIR("A")="Do you have this information",DIR("B")="NO" D ^DIR I Y'=1 G QUIT
"RTN","SDRRCLR2",43,0)
 S (DIC,DIE)="^SD(403.5,",DIC(0)="LZ",X=DFN,DLAYGO=403.5 D FILE^DICN S NUM=+Y
"RTN","SDRRCLR2",44,0)
 S DA=NUM,DR="[SDRR RECALL CARD ADD]",DIE("NO^")="Not Allowed" D ^DIE
"RTN","SDRRCLR2",45,0)
 K DIC,DIE,DR,D0,DA,DLAYGO,NUM,PROV,X,Y,Z,OK,RDT,DIR
"RTN","SDRRCLR2",46,0)
 Q
"RTN","SDRRCLR2",47,0)
UPDATE ;Asks for new data
"RTN","SDRRCLR2",48,0)
 K DIC,DIE,DR S DIE="^SD(403.5,",DR="[SDRR RECALL CARD ADD]",DIE("NO^")="BACKOUTOK" D ^DIE
"RTN","SDRRCLR2",49,0)
 K DIC,DIE,DR,D0,DA,DLAYGO,NUM,PROV,X,Y,Z,OK,RDT
"RTN","SDRRCLR2",50,0)
 D QUIT
"RTN","SDRRCLR2",51,0)
 Q
"RTN","SDRRCLR2",52,0)
QUIT K PROV,CLINIC,X,Y,C,D,ER,OK,DFN,FLAG,RS,KEY,KEYIFN,PROV1,PTN,RDT,DIR
"RTN","SDRRCLR2",53,0)
 K ^TMP("SDRRCLR",$J)
"RTN","SDRRCLR2",54,0)
 Q
"RTN","SDRROR")
0^3^B4074384^B3486735
"RTN","SDRROR",1,0)
SDRROR ;10N20/MAH;Recall Reminder CPRS Display;01/15/2008
"RTN","SDRROR",2,0)
 ;;5.3;Scheduling;**536,561**;Aug 13, 1993;Build 7
"RTN","SDRROR",3,0)
 ;;This routine is called from ORWCV
"RTN","SDRROR",4,0)
 ;;and will be called if Outpatient Clinic param entry is either
"RTN","SDRROR",5,0)
 ;;null or cards
"RTN","SDRROR",6,0)
 ;VAR BEG,END,AND DFN WILL BE KILLED WITH OR ROUTINES
"RTN","SDRROR",7,0)
COVER ; GET RECALL DATES FOR A PATIENT
"RTN","SDRROR",8,0)
 ;At ORWCV TAG VST+24 ADD D COVER^SDRROR
"RTN","SDRROR",9,0)
 Q:BEG<1!(END<1)
"RTN","SDRROR",10,0)
 F RCIFN=0:0 S RCIFN=$O(^SD(403.5,"B",DFN,RCIFN)) Q:RCIFN<1  D
"RTN","SDRROR",11,0)
 .S RCX=$G(^SD(403.5,RCIFN,0)) Q:RCX=""
"RTN","SDRROR",12,0)
 .S RCDT=$P(RCX,U,6) Q:RCDT<BEG  Q:RCDT>END
"RTN","SDRROR",13,0)
 .S RCTYPE=$P(RCX,U,4),RCCLIN=$P(RCX,U,2)
"RTN","SDRROR",14,0)
 .S:RCTYPE]"" RCTYPE=$P($G(^SD(403.51,RCTYPE,0)),U,2)
"RTN","SDRROR",15,0)
 .S:RCCLIN]"" RCCLIN=$$GET1^DIQ(44,RCCLIN_",",.01)
"RTN","SDRROR",16,0)
 .S DATE1=RCDT S:$D(^TMP("ORVSTLIST",$J,RCDT)) DATE1=RCDT+.0001
"RTN","SDRROR",17,0)
 .S RCNODE="RECALL ("_RCTYPE_") "_RCCLIN,RCNODE=$E(RCNODE,1,45)
"RTN","SDRROR",18,0)
 .S ^TMP("ORVSTLIST",$J,DATE1,"R",1)="R;"_RCDT_";"_RCIFN_U_RCDT_U_RCNODE
"RTN","SDRROR",19,0)
 K RCIFN,RCX,RCTYPE,RCCLIN,RCDT,RCNODE,DATE1
"RTN","SDRROR",20,0)
 Q
"RTN","SDRROR",21,0)
RCDTL ; RECALL DETAILS At ORWCV TAG DTLVST+18 ADD I $P(APPTINFO,";")="R" D RCDTL^SDRROR
"RTN","SDRROR",22,0)
 S RPT(1)="The patient will be sent a letter prior to this date reminding them to make an"  ;SD*561 text changed to read 'prior to this date'
"RTN","SDRROR",23,0)
 S RPT(2)="appointment with the listed clinic."
"RTN","SDRROR",24,0)
 S RCIFN=$P(APPTINFO,";",3) Q:RCIFN=""
"RTN","SDRROR",25,0)
 S APPTINFO=$G(^SD(403.5,RCIFN,0)) Q:APPTINFO=""
"RTN","SDRROR",26,0)
 S COMM=$P(APPTINFO,U,7),FAST=$P(APPTINFO,U,8)
"RTN","SDRROR",27,0)
 S:FAST]"" FAST=$P($P(^DD(403.5,2.6,0),FAST_":",2),";")
"RTN","SDRROR",28,0)
 S RPT(3)="  "
"RTN","SDRROR",29,0)
 S:FAST]"" RPT(4)="Patient should be "_FAST
"RTN","SDRROR",30,0)
 S RPT($S(FAST]"":5,1:4))="Comment: "_COMM
"RTN","SDRROR",31,0)
 K RCIFN,COMM,FAST
"RTN","SDRROR",32,0)
 Q
"RTN","SDRRRECL")
0^4^B85115679^B83067983
"RTN","SDRRRECL",1,0)
SDRRRECL ;10N20/MAH;Recall Reminder Manual Printing; 09/20/2004
"RTN","SDRRRECL",2,0)
 ;;5.3;Scheduling;**536,561**;Aug 13, 1993;Build 7
"RTN","SDRRRECL",3,0)
 ;;This routine is called from SDRRCLRP 
"RTN","SDRRRECL",4,0)
 ;;If the site has set TYPE OF NOTIFICATION to LETTER this routine
"RTN","SDRRRECL",5,0)
 ;;will run.
"RTN","SDRRRECL",6,0)
 K TYPE
"RTN","SDRRRECL",7,0)
MEN ;SET UP WHAT ARE THEY WOULD LIKE TO PRINT FOR LETTERS
"RTN","SDRRRECL",8,0)
 K DIR,Y,DTOUT,DIROUT,DIRUT,DUOUT
"RTN","SDRRRECL",9,0)
 S DIR(0)="SO^1:Print Letters by Clinic;2:Print Letters by Provider;3:Print Letters by Team;4:Print a Letter by Patient;5:Print Letters for Nonresponsive Patients"
"RTN","SDRRRECL",10,0)
 W ! S DIR("A")="Please select what you are looking for"
"RTN","SDRRRECL",11,0)
 D ^DIR G:$D(DUOUT)!($D(DTOUT)!($D(DIRUT))) QUIT S Q=Y
"RTN","SDRRRECL",12,0)
 I Q=1 G EN
"RTN","SDRRRECL",13,0)
 I Q=2 G EN1
"RTN","SDRRRECL",14,0)
 I Q=3 G EN3
"RTN","SDRRRECL",15,0)
 I Q=4 G EN4
"RTN","SDRRRECL",16,0)
 I Q=5 G EN5
"RTN","SDRRRECL",17,0)
 Q
"RTN","SDRRRECL",18,0)
EN ;PRINT BY CLINIC
"RTN","SDRRRECL",19,0)
 S DIC="^SC(",DIC(0)="AEQMZ" D ^DIC Q:Y<0  S DIV=+Y G:Y<0 QUIT
"RTN","SDRRRECL",20,0)
 I '$D(^SD(403.52,"B",DIV)) W !,?5,"**NO RECALL LETTER ON FILE**" G QUIT
"RTN","SDRRRECL",21,0)
 D SELDT G:Y<0 QUIT  ;SD*561 quit if no date range entered
"RTN","SDRRRECL",22,0)
 S %ZIS="QM" D ^%ZIS G:POP QUIT I $D(IO("Q")) S ZTDESC="Print Recall Letters by Clinic",ZTRTN="DQD^SDRRRECL" S ZTSAVE("*")="" D ^%ZTLOAD G QUIT
"RTN","SDRRRECL",23,0)
DQD K ^TMP($J)
"RTN","SDRRRECL",24,0)
 U IO S D0=0 F  S D0=$O(^SD(403.5,"E",DIV,D0)) Q:D0=""  S DTA=$G(^SD(403.5,D0,0)) D:DTA]""
"RTN","SDRRRECL",25,0)
 .S TIME=""
"RTN","SDRRRECL",26,0)
 .I $P(^SD(403.5,D0,0),"^",9)>30 S TIME=$P(^SD(403.5,D0,0),"^",9) S TIME="**"_TIME_"**"
"RTN","SDRRRECL",27,0)
 .S LAB=$S($P($G(^SD(403.5,D0,0)),"^",8)="f":"Lab test(s) have been ordered that require you to FAST",$P(^SD(403.5,D0,0),"^",8)="n":"Lab test(s) have been ordered, which need to be done before an appointment is made",1:"")
"RTN","SDRRRECL",28,0)
 .S DFN=+DTA
"RTN","SDRRRECL",29,0)
 .Q:$P(DTA,U,6)<SDT!($P(DTA,U,6)>EDT)
"RTN","SDRRRECL",30,0)
 .Q:$$TESTPAT^VADPT(DFN)
"RTN","SDRRRECL",31,0)
 .D ADD^VADPT,DEM^VADPT
"RTN","SDRRRECL",32,0)
 .S STATE=$P(VAPA(5),"^",1),STATE=$$GET1^DIQ(5,STATE_",",1)
"RTN","SDRRRECL",33,0)
 .S PN=$P(VADM(1),U)
"RTN","SDRRRECL",34,0)
 .I $G(VADM(6),U)'="" Q
"RTN","SDRRRECL",35,0)
 .S CHECK=$$BADADR^DGUTL3 I CHECK>0 S XMSUB="Bad Address for Recall Reminder Patient",XMTEXT="SDRR(" D
"RTN","SDRRRECL",36,0)
 ..S XMY("G.SDRR BAD ADDRESS")="",XMDUZ=.5
"RTN","SDRRRECL",37,0)
 ..S SDRR(1)="Bad Address- card will not be printed for:"_"   "_PN_"   "_VA("BID")
"RTN","SDRRRECL",38,0)
 ..D ^XMD
"RTN","SDRRRECL",39,0)
 ..K XMY,XMSUB,XMTEXT,XMDUZ
"RTN","SDRRRECL",40,0)
 .;ADDED THE DATE INFORMATION
"RTN","SDRRRECL",41,0)
 .S $P(^SD(403.5,D0,0),"^",10)=DT
"RTN","SDRRRECL",42,0)
 .D PR
"RTN","SDRRRECL",43,0)
 D ^%ZISC G QUIT
"RTN","SDRRRECL",44,0)
 ;;done and tested
"RTN","SDRRRECL",45,0)
QUIT K ADTA,D0,DFN,DIC,DIR,DIRUT,DTA,I,L,PN,POP,Y,DIV,EDT,PR,SDT,FAST,TIME,ACC
"RTN","SDRRRECL",46,0)
 K LINE,LETTER,MESSAGE,TEST,DOD,CLINIC,FAIL,TEAM,LAB,SDRR,Q,%DT,%ZIS,CHECK,VA,ZTDESC,ZTIO,ZTRTN,ZTSAVE,STATE Q
"RTN","SDRRRECL",47,0)
 D KVAR^VADPT
"RTN","SDRRRECL",48,0)
 Q
"RTN","SDRRRECL",49,0)
SELDT S %DT="AEX",%DT("A")="Start with RECALL DATE: " D ^%DT Q:Y<0  S SDT=Y,%DT("A")="End with RECALL DATE: " D ^%DT I Y<SDT W $C(7),"  ??" G SELDT
"RTN","SDRRRECL",50,0)
 S EDT=Y Q
"RTN","SDRRRECL",51,0)
PR S LETTER=0
"RTN","SDRRRECL",52,0)
 W @IOF F L=1:1:11 W !
"RTN","SDRRRECL",53,0)
 W !?20,$P(PN,",",2)," ",$P(PN,",")
"RTN","SDRRRECL",54,0)
 I $P(VAPA(1),U)'="" W !?20,$P(VAPA(1),U)
"RTN","SDRRRECL",55,0)
 I $P(VAPA(2),U)'="" W !?20,$P(VAPA(2),U)
"RTN","SDRRRECL",56,0)
 I $P(VAPA(3),U)'="" W !?20,$P(VAPA(3),U)
"RTN","SDRRRECL",57,0)
 W !?20,$P(VAPA(4),U),", "_STATE_"  ",$P(VAPA(6),U)
"RTN","SDRRRECL",58,0)
 I $D(MESSAGE) W !!!!!,?25,MESSAGE
"RTN","SDRRRECL",59,0)
 I TIME'="" W !!!!?25,TIME
"RTN","SDRRRECL",60,0)
 I LAB'="" W !!,?25,"** "_LAB
"RTN","SDRRRECL",61,0)
 W !!!
"RTN","SDRRRECL",62,0)
 S:'$D(MESSAGE) LETTER=$O(^SD(403.52,"B",DIV,LETTER))
"RTN","SDRRRECL",63,0)
 I LETTER>0 S LINE=0 F  S LINE=$O(^SD(403.52,LETTER,1,LINE)) Q:'LINE  W !,?2,$P(^SD(403.52,LETTER,1,LINE,0),"^",1)
"RTN","SDRRRECL",64,0)
 K MESSAGE
"RTN","SDRRRECL",65,0)
 Q
"RTN","SDRRRECL",66,0)
EN1 ;print letters by provider
"RTN","SDRRRECL",67,0)
 S DIC="^SD(403.54,",DIC(0)="AEQMZ",DIC("A")="Select Provider: " D ^DIC G:Y<0 QUIT S PR=+Y
"RTN","SDRRRECL",68,0)
 D SELDT G:Y<0 QUIT  ;SD*5.3*561 quit if no date range entered
"RTN","SDRRRECL",69,0)
 S %ZIS="QM" D ^%ZIS G:POP QUIT I $D(IO("Q")) S ZTDESC="Print Recall Letters by Provider",ZTRTN="DQD1^SDRRRECL" S ZTSAVE("*")="" D ^%ZTLOAD G QUIT
"RTN","SDRRRECL",70,0)
DQD1 K ^TMP($J)
"RTN","SDRRRECL",71,0)
 U IO S D0=0 F  S D0=$O(^SD(403.5,"C",PR,D0)) Q:D0=""  S (CLINIC,FAIL)=0 S CLINIC=$P($G(^SD(403.5,D0,0)),"^",2) D
"RTN","SDRRRECL",72,0)
 .S DTA=$G(^SD(403.5,D0,0))
"RTN","SDRRRECL",73,0)
 .I CLINIC="" S FAIL=1 S MESSAGE="***NO CLINIC ON FILE**"
"RTN","SDRRRECL",74,0)
 .I CLINIC'=""  I '$D(^SD(403.52,"B",CLINIC))  S MESSAGE="***NO CLINIC LETTER ON FILE**" S FAIL=1
"RTN","SDRRRECL",75,0)
 .I CLINIC'="",(FAIL=0) S DIV=CLINIC S LETTER=0,LETTER=$O(^SD(403.52,"B",CLINIC,LETTER))
"RTN","SDRRRECL",76,0)
 .S TIME=""
"RTN","SDRRRECL",77,0)
 .I $P(^SD(403.5,D0,0),"^",9)>30 S TIME=$P(^SD(403.5,D0,0),"^",9) S TIME="**"_TIME_"**"
"RTN","SDRRRECL",78,0)
 .S LAB=$S($P($G(^SD(403.5,D0,0)),"^",8)="f":"Lab test(s) have been ordered that require you to FAST",$P(^SD(403.5,D0,0),"^",8)="n":"Lab test(s) have been ordered, which need to be done before an appointment is made",1:"")
"RTN","SDRRRECL",79,0)
 .S DFN=+DTA
"RTN","SDRRRECL",80,0)
 .Q:$P(DTA,U,6)<SDT!($P(DTA,U,6)>EDT)
"RTN","SDRRRECL",81,0)
 .Q:$$TESTPAT^VADPT(DFN)
"RTN","SDRRRECL",82,0)
 .D ADD^VADPT,DEM^VADPT
"RTN","SDRRRECL",83,0)
 .S STATE=$P(VAPA(5),"^",1),STATE=$$GET1^DIQ(5,STATE_",",1)
"RTN","SDRRRECL",84,0)
 .S PN=$P(VADM(1),U)
"RTN","SDRRRECL",85,0)
 .I $G(VADM(6),U)'="" Q
"RTN","SDRRRECL",86,0)
 .S CHECK=$$BADADR^DGUTL3 I CHECK>0 S XMSUB="Bad Address for Recall Reminder Patient",XMTEXT="SDRR(" D
"RTN","SDRRRECL",87,0)
 ..S XMY("G.SDRR BAD ADDRESS")="",XMDUZ=.5
"RTN","SDRRRECL",88,0)
 ..S SDRR(1)="Bad Address- card will not be printed for:"_"   "_PN_"   "_VA("BID")
"RTN","SDRRRECL",89,0)
 ..D ^XMD
"RTN","SDRRRECL",90,0)
 ..K XMY,XMSUB,XMTEXT,XMDUZ
"RTN","SDRRRECL",91,0)
 .;ADDED THE DATE INFORMATION
"RTN","SDRRRECL",92,0)
 .S $P(^SD(403.5,D0,0),"^",10)=DT
"RTN","SDRRRECL",93,0)
 .D PR
"RTN","SDRRRECL",94,0)
 D ^%ZISC G QUIT
"RTN","SDRRRECL",95,0)
EN3 ;PRINT LETTER FOR A TEAM
"RTN","SDRRRECL",96,0)
 W ! S DIC="^SD(403.55,",DIC(0)="AEQMZ",DIC("A")="Select Clinic Recall Team: " D ^DIC S TEAM=+Y K DIC G:Y<0 QUIT
"RTN","SDRRRECL",97,0)
 D SELDT G:Y<0 QUIT  ;SD*561 quit if no date range entered
"RTN","SDRRRECL",98,0)
 S %ZIS="QM" D ^%ZIS G:POP QUIT I $D(IO("Q")) S ZTDESC="Print Recall Letters for a Team",ZTRTN="DQD4^SDRRRECL" S ZTSAVE("*")="" D ^%ZTLOAD G QUIT
"RTN","SDRRRECL",99,0)
DQD4 S PR=0 F  S PR=$O(^SD(403.54,"C",TEAM,PR)) Q:'PR  S D0=0 D
"RTN","SDRRRECL",100,0)
 .F  S D0=$O(^SD(403.5,"C",PR,D0)) Q:D0=""  S (CLINIC,FAIL)=0 S CLINIC=$P($G(^SD(403.5,D0,0)),"^",2) D
"RTN","SDRRRECL",101,0)
 ..S DTA=$G(^SD(403.5,D0,0))
"RTN","SDRRRECL",102,0)
 ..I CLINIC="" S FAIL=1 S MESSAGE="***NO CLINIC ON FILE**"
"RTN","SDRRRECL",103,0)
 ..I CLINIC'=""  I '$D(^SD(403.52,"B",CLINIC))  S MESSAGE="***NO CLINIC LETTER ON FILE**" S FAIL=1
"RTN","SDRRRECL",104,0)
 ..I CLINIC'="",(FAIL=0) S DIV=CLINIC S LETTER=0,LETTER=$O(^SD(403.52,"B",CLINIC,LETTER))
"RTN","SDRRRECL",105,0)
 ..S TIME=""
"RTN","SDRRRECL",106,0)
 ..I $P(^SD(403.5,D0,0),"^",9)>30 S TIME=$P(^SD(403.5,D0,0),"^",9) S TIME="**"_TIME_"**"
"RTN","SDRRRECL",107,0)
 ..S LAB=$S($P($G(^SD(403.5,D0,0)),"^",8)="f":"Lab test(s) have been ordered that require you to FAST",$P(^SD(403.5,D0,0),"^",8)="n":"Lab test(s) have been ordered, which need to be done before an appointment is made",1:"")
"RTN","SDRRRECL",108,0)
 ..S DFN=+DTA
"RTN","SDRRRECL",109,0)
 ..Q:$P(DTA,U,6)<SDT!($P(DTA,U,6)>EDT)  ;SD*561 check selected date range
"RTN","SDRRRECL",110,0)
 ..Q:$$TESTPAT^VADPT(DFN)
"RTN","SDRRRECL",111,0)
 ..D ADD^VADPT,DEM^VADPT
"RTN","SDRRRECL",112,0)
 ..S STATE=$P(VAPA(5),"^",1),STATE=$$GET1^DIQ(5,STATE_",",1)
"RTN","SDRRRECL",113,0)
 ..S PN=$P(VADM(1),U)
"RTN","SDRRRECL",114,0)
 ..I $G(VADM(6),U)'="" Q
"RTN","SDRRRECL",115,0)
 ..S CHECK=$$BADADR^DGUTL3 I CHECK>0 S XMSUB="Bad Address for Recall Reminder Patient",XMTEXT="SDRR(" D
"RTN","SDRRRECL",116,0)
 ...S XMY("G.SDRR BAD ADDRESS")="",XMDUZ=.5
"RTN","SDRRRECL",117,0)
 ...S SDRR(1)="Bad Address- card will not be printed for:"_"   "_PN_"   "_VA("BID")
"RTN","SDRRRECL",118,0)
 ...D ^XMD
"RTN","SDRRRECL",119,0)
 ...K XMY,XMSUB,XMTEXT,XMDUZ
"RTN","SDRRRECL",120,0)
 ..;ADDED THE DATE INFORMATION
"RTN","SDRRRECL",121,0)
 ..S $P(^SD(403.5,D0,0),"^",10)=DT
"RTN","SDRRRECL",122,0)
 ..D PR
"RTN","SDRRRECL",123,0)
 D ^%ZISC G QUIT
"RTN","SDRRRECL",124,0)
 ;done and tested
"RTN","SDRRRECL",125,0)
EN4 ;PRINT LETTER FOR ONE PATIENT
"RTN","SDRRRECL",126,0)
 W ! S DIC="^SD(403.5,",DIC(0)="AEQMZ",DIC("A")="Select Patient: " D ^DIC S D0=+Y K DIC G:Y<0 QUIT
"RTN","SDRRRECL",127,0)
 S DIC="^SC(",DIC(0)="AEQMZ" D ^DIC Q:Y<0  S DIV=+Y K DIC G:Y<0 QUIT
"RTN","SDRRRECL",128,0)
 I '$D(^SD(403.52,"B",DIV)) W !,?5,"**NO RECALL LETTER ON FILE**" G QUIT
"RTN","SDRRRECL",129,0)
 S %ZIS="QM" D ^%ZIS G:POP QUIT I $D(IO("Q")) S ZTDESC="Print Recall Letters for a Patient",ZTRTN="DQD3^SDRRRECL" S ZTSAVE("*")="" D ^%ZTLOAD G QUIT
"RTN","SDRRRECL",130,0)
DQD3 K ^TMP($J)
"RTN","SDRRRECL",131,0)
 S DTA=$G(^SD(403.5,D0,0)) D:DTA]""
"RTN","SDRRRECL",132,0)
 .S TIME=""
"RTN","SDRRRECL",133,0)
 .I $P(^SD(403.5,D0,0),"^",9)>30 S TIME=$P(^SD(403.5,D0,0),"^",9) S TIME="**"_TIME_"**"
"RTN","SDRRRECL",134,0)
 .S LAB=$S($P($G(^SD(403.5,D0,0)),"^",8)="f":"Lab test(s) have been ordered that require you to FAST",$P(^SD(403.5,D0,0),"^",8)="n":"Lab test(s) have been ordered, which need to be done before an appointment is made",1:"")
"RTN","SDRRRECL",135,0)
 .S DFN=+DTA
"RTN","SDRRRECL",136,0)
 .Q:$$TESTPAT^VADPT(DFN)
"RTN","SDRRRECL",137,0)
 .D ADD^VADPT,DEM^VADPT
"RTN","SDRRRECL",138,0)
 .S STATE=$P(VAPA(5),"^",1),STATE=$$GET1^DIQ(5,STATE_",",1)
"RTN","SDRRRECL",139,0)
 .S PN=$P(VADM(1),U)
"RTN","SDRRRECL",140,0)
 .I $G(VADM(6),U)'="" Q
"RTN","SDRRRECL",141,0)
 .S CHECK=$$BADADR^DGUTL3 I CHECK>0 S XMSUB="Bad Address for Recall Reminder Patient",XMTEXT="SDRR(" D
"RTN","SDRRRECL",142,0)
 ..S XMY("G.SDRR BAD ADDRESS")="",XMDUZ=.5
"RTN","SDRRRECL",143,0)
 ..S SDRR(1)="Bad Address- card will not be printed for:"_"   "_PN_"   "_VA("BID")
"RTN","SDRRRECL",144,0)
 ..D ^XMD
"RTN","SDRRRECL",145,0)
 ..K XMY,XMSUB,XMTEXT,XMDUZ
"RTN","SDRRRECL",146,0)
 .;ADDED THE DATE INFORMATION
"RTN","SDRRRECL",147,0)
 .S $P(^SD(403.5,D0,0),"^",10)=DT
"RTN","SDRRRECL",148,0)
 .D PR
"RTN","SDRRRECL",149,0)
 D ^%ZISC G QUIT
"RTN","SDRRRECL",150,0)
EN5 ;Print LETTERS for Nonresponsive
"RTN","SDRRRECL",151,0)
 S TEAM=""
"RTN","SDRRRECL",152,0)
 S DIC="^SD(403.55,",DIC(0)="AEQMZ",DIC("A")="Select Clinic Recall Team: " D ^DIC S TEAM=+Y K DIC G:TEAM<0 QUIT
"RTN","SDRRRECL",153,0)
 S %ZIS="QM" D ^%ZIS G:POP QUIT I $D(IO("Q")) S ZTDESC="Print Recall Letters for Nonresponsive",ZTRTN="DQD5^SDRRRECL" S ZTSAVE("*")="" D ^%ZTLOAD G QUIT
"RTN","SDRRRECL",154,0)
DQD5 N CHKDATE
"RTN","SDRRRECL",155,0)
 ;SD*5.3*561 remove extraneous write command following $O on next line
"RTN","SDRRRECL",156,0)
 S PR=0,CHKDATE=5 F  S PR=$O(^SD(403.54,"C",TEAM,PR)) Q:'PR  D
"RTN","SDRRRECL",157,0)
 .S D0=0 F  S D0=$O(^SD(403.5,"C",PR,D0)) Q:'D0  S (CLINIC,FAIL)=0 S CLINIC=$P($G(^SD(403.5,D0,0)),"^",2) D
"RTN","SDRRRECL",158,0)
 ..I $P($G(^SD(403.5,D0,0)),"^",10)="" QUIT
"RTN","SDRRRECL",159,0)
 ..S RDATE=$P($G(^SD(403.5,D0,0)),"^",6) S CHECK=$$FMDIFF^XLFDT(RDATE,DT) I CHECK>CHKDATE K RDATE QUIT
"RTN","SDRRRECL",160,0)
 ..S DTA=$G(^SD(403.5,D0,0))
"RTN","SDRRRECL",161,0)
 ..I CLINIC="" S FAIL=1 S MESSAGE="***NO CLINIC ON FILE**"
"RTN","SDRRRECL",162,0)
 ..I CLINIC'=""  I '$D(^SD(403.52,"B",CLINIC))  S MESSAGE="***NO CLINIC LETTER ON FILE**" S FAIL=1
"RTN","SDRRRECL",163,0)
 ..I CLINIC'="",(FAIL=0) S DIV=CLINIC S LETTER=0,LETTER=$O(^SD(403.52,"B",CLINIC,LETTER))
"RTN","SDRRRECL",164,0)
 ..S TIME=""
"RTN","SDRRRECL",165,0)
 ..I $P(^SD(403.5,D0,0),"^",9)>30 S TIME=$P(^SD(403.5,D0,0),"^",9) S TIME="**"_TIME_"**"
"RTN","SDRRRECL",166,0)
 ..S LAB=$S($P($G(^SD(403.5,D0,0)),"^",8)="f":"Lab test(s) have been ordered that require you to FAST",$P(^SD(403.5,D0,0),"^",8)="n":"Lab test(s) have been ordered, which need to be done before an appointment is made",1:"")
"RTN","SDRRRECL",167,0)
 ..S DFN=+DTA
"RTN","SDRRRECL",168,0)
 ..Q:$$TESTPAT^VADPT(DFN)
"RTN","SDRRRECL",169,0)
 ..D ADD^VADPT,DEM^VADPT
"RTN","SDRRRECL",170,0)
 ..S STATE=$P(VAPA(5),"^",1),STATE=$$GET1^DIQ(5,STATE_",",1)
"RTN","SDRRRECL",171,0)
 ..S PN=$P(VADM(1),U)
"RTN","SDRRRECL",172,0)
 ..I $G(VADM(6),U)'="" Q
"RTN","SDRRRECL",173,0)
 ..S CHECK=$$BADADR^DGUTL3 I CHECK>0 S XMSUB="Bad Address for Recall Reminder Patient",XMTEXT="SDRR(" D
"RTN","SDRRRECL",174,0)
 ...S XMY("G.SDRR BAD ADDRESS")="",XMDUZ=.5
"RTN","SDRRRECL",175,0)
 ...S SDRR(1)="Bad Address- card will not be printed for:"_"   "_PN_"   "_VA("BID")
"RTN","SDRRRECL",176,0)
 ...D ^XMD
"RTN","SDRRRECL",177,0)
 ...K XMY,XMSUB,XMTEXT,XMDUZ
"RTN","SDRRRECL",178,0)
 ..;ADDED THE DATE INFORMATION
"RTN","SDRRRECL",179,0)
 ..S $P(^SD(403.5,D0,0),"^",13)=DT
"RTN","SDRRRECL",180,0)
 ..D PR
"RTN","SDRRRECL",181,0)
 D ^%ZISC G QUIT
"RTN","SDRRRECL",182,0)
 Q
"VER")
8.0^22.0
"BLD",8247,6)
^466
**END**
**END**
