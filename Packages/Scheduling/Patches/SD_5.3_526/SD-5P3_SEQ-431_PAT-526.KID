Released SD*5.3*526 SEQ #431
Extracted from mail message
**KIDS**:SD*5.3*526^

**INSTALL NAME**
SD*5.3*526
"BLD",6846,0)
SD*5.3*526^SCHEDULING^0^3080208^y
"BLD",6846,4,0)
^9.64PA^^
"BLD",6846,6.3)
8
"BLD",6846,"KRN",0)
^9.67PA^8989.52^19
"BLD",6846,"KRN",.4,0)
.4
"BLD",6846,"KRN",.4,"NM",0)
^9.68A^5^4
"BLD",6846,"KRN",.4,"NM",1,0)
SCMC EXTENDED    FILE #404.43^404.43^0
"BLD",6846,"KRN",.4,"NM",2,0)
SCMC INACTIVATED    FILE #404.43^404.43^0
"BLD",6846,"KRN",.4,"NM",4,0)
SCMC PENDING UNASSIGN    FILE #404.43^404.43^0
"BLD",6846,"KRN",.4,"NM",5,0)
SCMC PENDING UNASSIGN PAT    FILE #404.43^404.43^0
"BLD",6846,"KRN",.4,"NM","B","SCMC EXTENDED    FILE #404.43",1)

"BLD",6846,"KRN",.4,"NM","B","SCMC INACTIVATED    FILE #404.43",2)

"BLD",6846,"KRN",.4,"NM","B","SCMC PENDING UNASSIGN    FILE #404.43",4)

"BLD",6846,"KRN",.4,"NM","B","SCMC PENDING UNASSIGN PAT    FILE #404.43",5)

"BLD",6846,"KRN",.401,0)
.401
"BLD",6846,"KRN",.402,0)
.402
"BLD",6846,"KRN",.403,0)
.403
"BLD",6846,"KRN",.5,0)
.5
"BLD",6846,"KRN",.84,0)
.84
"BLD",6846,"KRN",3.6,0)
3.6
"BLD",6846,"KRN",3.8,0)
3.8
"BLD",6846,"KRN",9.2,0)
9.2
"BLD",6846,"KRN",9.8,0)
9.8
"BLD",6846,"KRN",9.8,"NM",0)
^9.68A^12^12
"BLD",6846,"KRN",9.8,"NM",1,0)
SCRPEC^^0^B15607236
"BLD",6846,"KRN",9.8,"NM",2,0)
SCRPTP3^^0^B27716649
"BLD",6846,"KRN",9.8,"NM",3,0)
SCRPTP^^0^B26905186
"BLD",6846,"KRN",9.8,"NM",4,0)
SCRPTP2^^0^B31636644
"BLD",6846,"KRN",9.8,"NM",5,0)
SCRPTA^^0^B26295531
"BLD",6846,"KRN",9.8,"NM",6,0)
SCRPTA2^^0^B29432244
"BLD",6846,"KRN",9.8,"NM",7,0)
SCRPEC2^^0^B29990471
"BLD",6846,"KRN",9.8,"NM",8,0)
SCMCTSK4^^0^B47932762
"BLD",6846,"KRN",9.8,"NM",9,0)
SCRPPAT2^^0^B28347716
"BLD",6846,"KRN",9.8,"NM",10,0)
SCRPPAT3^^0^B30801448
"BLD",6846,"KRN",9.8,"NM",11,0)
SCRPU2^^0^B22140204
"BLD",6846,"KRN",9.8,"NM",12,0)
SCMCTSK9^^0^B28610326
"BLD",6846,"KRN",9.8,"NM","B","SCMCTSK4",8)

"BLD",6846,"KRN",9.8,"NM","B","SCMCTSK9",12)

"BLD",6846,"KRN",9.8,"NM","B","SCRPEC",1)

"BLD",6846,"KRN",9.8,"NM","B","SCRPEC2",7)

"BLD",6846,"KRN",9.8,"NM","B","SCRPPAT2",9)

"BLD",6846,"KRN",9.8,"NM","B","SCRPPAT3",10)

"BLD",6846,"KRN",9.8,"NM","B","SCRPTA",5)

"BLD",6846,"KRN",9.8,"NM","B","SCRPTA2",6)

"BLD",6846,"KRN",9.8,"NM","B","SCRPTP",3)

"BLD",6846,"KRN",9.8,"NM","B","SCRPTP2",4)

"BLD",6846,"KRN",9.8,"NM","B","SCRPTP3",2)

"BLD",6846,"KRN",9.8,"NM","B","SCRPU2",11)

"BLD",6846,"KRN",19,0)
19
"BLD",6846,"KRN",19.1,0)
19.1
"BLD",6846,"KRN",101,0)
101
"BLD",6846,"KRN",409.61,0)
409.61
"BLD",6846,"KRN",771,0)
771
"BLD",6846,"KRN",870,0)
870
"BLD",6846,"KRN",8989.51,0)
8989.51
"BLD",6846,"KRN",8989.52,0)
8989.52
"BLD",6846,"KRN",8994,0)
8994
"BLD",6846,"KRN","B",.4,.4)

"BLD",6846,"KRN","B",.401,.401)

"BLD",6846,"KRN","B",.402,.402)

"BLD",6846,"KRN","B",.403,.403)

"BLD",6846,"KRN","B",.5,.5)

"BLD",6846,"KRN","B",.84,.84)

"BLD",6846,"KRN","B",3.6,3.6)

"BLD",6846,"KRN","B",3.8,3.8)

"BLD",6846,"KRN","B",9.2,9.2)

"BLD",6846,"KRN","B",9.8,9.8)

"BLD",6846,"KRN","B",19,19)

"BLD",6846,"KRN","B",19.1,19.1)

"BLD",6846,"KRN","B",101,101)

"BLD",6846,"KRN","B",409.61,409.61)

"BLD",6846,"KRN","B",771,771)

"BLD",6846,"KRN","B",870,870)

"BLD",6846,"KRN","B",8989.51,8989.51)

"BLD",6846,"KRN","B",8989.52,8989.52)

"BLD",6846,"KRN","B",8994,8994)

"BLD",6846,"QUES",0)
^9.62^^
"BLD",6846,"REQB",0)
^9.611^^
"KRN",.4,5180,-1)
0^4
"KRN",.4,5180,0)
SCMC PENDING UNASSIGN^3080207.1016^@^404.43^^@^3080207
"KRN",.4,5180,"DCL","404.43^.01")
!
"KRN",.4,5180,"DXS",1,9.2)
S DIP(101)=$S($D(^SCPT(404.42,I(100,0),0)):^(0),1:"") S X=$P(DIP(101),U,1),X=X S X=X,DIP(201)=$G(X) S X="DFN"
"KRN",.4,5180,"DXS",2,9)
X "N I,Y "_$P(^DD(404.43,.159,0),U,5,99) S DIP(1)=X S X=DIP(1) S:X X=$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3)
"KRN",.4,5180,"F",1)
.01;"Patient Name";L12;C1~-404.42,^SCPT(404.42,^^S I(0,0)=D0 S DIP(1)=$S($D(^SCPT(404.43,D0,0)):^(0),1:"") S X=$P(DIP(1),U,1),X=X S D(0)=+X;Z;".01:"~
"KRN",.4,5180,"F",2)
-404.42,-2,^DPT(^^S I(100,0)=D0 S DIP(101)=$S($D(^SCPT(404.42,D0,0)):^(0),1:"") S X=$P(DIP(101),U,1),X=X S D(0)=+X;Z;".01:"~-404.42,-2,.09;L10;C14;"SSN";~
"KRN",.4,5180,"F",3)
-404.42,-2,X DXS(1,9.2) S X1=DIP(201) S:X]""&(X?.ANP)&(X1'[U)&(X1'["$C(94)") DIPA($E(X,1,30))=X1 S X="" W X K DIP;X;Z;"SETPARAM(INTERNAL(PATIENT),"DFN")"~
"KRN",.4,5180,"F",4)
-404.57,^SCTM(404.57,^^S I(0,0)=D0 S DIP(1)=$S($D(^SCPT(404.43,D0,0)):^(0),1:"") S X=$P(DIP(1),U,2),X=X S D(0)=+X;Z;".02:"~
"KRN",.4,5180,"F",5)
-404.57,-404.51,^SCTM(404.51,^^S I(100,0)=D0 S DIP(101)=$S($D(^SCTM(404.57,D0,0)):^(0),1:"") S X=$P(DIP(101),U,2),X=X S D(0)=+X;Z;".02:"~
"KRN",.4,5180,"F",6)
-404.57,-404.51,.07;"Institution";L12;C26~-404.57,-404.51,.01;"PC Team";L12;C41~-404.57,304;"Provider";L15;C57~-404.57,.01;"Team Position";L14;C75~
"KRN",.4,5180,"F",7)
X DXS(2,9) W X K DIP;"Date Sched. to Inactivate";L10;C92;Z;"NUMDATE(SCHEDULED INACTIVATION DATE)"~
"KRN",.4,5180,"F",8)
D FUTAPP^SCMCTSK2(+$G(DIPA("DFN")));"Next Appt. Date/Clinic";C105;L27;Z;"D FUTAPP^SCMCTSK2(+$G(DIPA("DFN")))"~
"KRN",.4,5180,"H")
PATIENT TEAM POSITION ASSIGNMENT LIST
"KRN",.4,5180,"ROUOLD")
SCMCPT3
"KRN",.4,5182,-1)
0^1
"KRN",.4,5182,0)
SCMC EXTENDED^3080207.1019^@^404.43^^@^3080207
"KRN",.4,5182,"DCL","404.43^.01")
!
"KRN",.4,5182,"DXS",1,9)
X "N I,Y "_$P(^DD(404.43,.159,0),U,5,99) S DIP(1)=X S X=DIP(1) S:X X=$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3)
"KRN",.4,5182,"DXS",2,9.2)
S DIP(2)=$C(59)_$P($G(^DD(404.43,.13,0)),U,3),DIP(5)=$C(59)_$P($G(^DD(404.43,.13,0)),U,3),DIP(1)=$S($D(^SCPT(404.43,D0,0)):^(0),1:"")
"KRN",.4,5182,"DXS",2,9.3)
X DXS(2,9.2) S X=$P($P(DIP(2),$C(59)_$P(DIP(1),U,13)_":",2),$C(59)),DIP(3)=$G(X),DIP(4)=$G(X) S X=$P($P(DIP(5),$C(59)_$P(DIP(1),U,13)_":",2),$C(59))="OTHER"
"KRN",.4,5182,"DXS",2,9.4)
X DXS(2,9.3) S DIP(6)=$G(X) S X=" [",DIP(7)=$G(X) S X=$P(DIP(1),U,14),Y=X,X=DIP(7),X=X_Y_"]",DIP(8)=$G(X) S X=1,DIP(9)=$G(X) S X=""
"KRN",.4,5182,"F",1)
.01;"Patient";L10;C1~-404.42,^SCPT(404.42,^^S I(0,0)=D0 S DIP(1)=$S($D(^SCPT(404.43,D0,0)):^(0),1:"") S X=$P(DIP(1),U,1),X=X S D(0)=+X;Z;".01:"~
"KRN",.4,5182,"F",2)
-404.42,-2,^DPT(^^S I(100,0)=D0 S DIP(101)=$S($D(^SCPT(404.42,D0,0)):^(0),1:"") S X=$P(DIP(101),U,1),X=X S D(0)=+X;Z;".01:"~-404.42,-2,.09;"SSN";L10;C12~
"KRN",.4,5182,"F",3)
-404.57,^SCTM(404.57,^^S I(0,0)=D0 S DIP(1)=$S($D(^SCPT(404.43,D0,0)):^(0),1:"") S X=$P(DIP(1),U,2),X=X S D(0)=+X;Z;".02:"~
"KRN",.4,5182,"F",4)
-404.57,-404.51,^SCTM(404.51,^^S I(100,0)=D0 S DIP(101)=$S($D(^SCTM(404.57,D0,0)):^(0),1:"") S X=$P(DIP(101),U,2),X=X S D(0)=+X;Z;".02:"~
"KRN",.4,5182,"F",5)
-404.57,-404.51,.07;"Institution";L14;C24~-404.57,-404.51,.01;"PC Team";L15;C41~-404.57,304;"Provider/ Position";L15;C60~
"KRN",.4,5182,"F",6)
-404.57,306;"Preceptor/ Position";L15;C78~X DXS(1,9) W X K DIP;"Date Sched. for Inactivation/ Reason";L8;C96;Z;"NUMDATE(SCHEDULED INACTIVATION DATE)"~
"KRN",.4,5182,"F",7)
-404.57,^SCTM(404.57,^^S I(0,0)=D0 S DIP(1)=$S($D(^SCPT(404.43,D0,0)):^(0),1:"") S X=$P(DIP(1),U,2),X=X S D(0)=+X;Z;".02:"~-404.57,.01;"";C60;L14~
"KRN",.4,5182,"F",8)
-404.57,305;"";C78;L14~
"KRN",.4,5182,"F",9)
X DXS(2,9.4) S X=$S(DIP(6):DIP(8),DIP(9):X) S Y=X,X=DIP(3),X=X_Y W X K DIP;"";C96;L36;Z;"(#.13)_$S((#.13)="OTHER":" ["_(#.14)_"]",1:"")"~
"KRN",.4,5182,"H")
PATIENT TEAM POSITION ASSIGNMENT LIST
"KRN",.4,5184,-1)
0^2
"KRN",.4,5184,0)
SCMC INACTIVATED^3080207.1021^@^404.43^^@^3080207
"KRN",.4,5184,"DCL","404.42^.01")
!
"KRN",.4,5184,"DXS",1,9)
X DXS(1,9.3) S X=$P($P(DIP(8),$C(59)_$P(DIP(1),U,12)_":",2),$C(59)),X=$S(DIP(2):DIP(3),DIP(5):DIP(6),DIP(7):X)
"KRN",.4,5184,"DXS",1,9.2)
S DIP(8)=$C(59)_$P($G(^DD(404.43,.12,0)),U,3),DIP(1)=$S($D(^SCPT(404.43,D0,0)):^(0),1:"") S X=$P(DIP(1),U,12),X=X S X=X="NA",DIP(2)=$G(X) S X="NO APPT"
"KRN",.4,5184,"DXS",1,9.3)
X DXS(1,9.2) S DIP(3)=$G(X),DIP(4)=$G(X) S X=$P(DIP(1),U,12),X=X S X=X="DU",DIP(5)=$G(X) S X="DEATH",DIP(6)=$G(X) S X=1,DIP(7)=$G(X)
"KRN",.4,5184,"F",1)
-404.42,^SCPT(404.42,^^S I(0,0)=D0 S DIP(1)=$S($D(^SCPT(404.43,D0,0)):^(0),1:"") S X=$P(DIP(1),U,1),X=X S D(0)=+X;Z;".01:"~-404.42,.01;L12;C1;"Patient Name"~
"KRN",.4,5184,"F",2)
-404.42,-2,^DPT(^^S I(100,0)=D0 S DIP(101)=$S($D(^SCPT(404.42,D0,0)):^(0),1:"") S X=$P(DIP(101),U,1),X=X S D(0)=+X;Z;".01:"~-404.42,-2,.09;"SSN";L10;C14~
"KRN",.4,5184,"F",3)
-404.57,^SCTM(404.57,^^S I(0,0)=D0 S DIP(1)=$S($D(^SCPT(404.43,D0,0)):^(0),1:"") S X=$P(DIP(1),U,2),X=X S D(0)=+X;Z;".02:"~
"KRN",.4,5184,"F",4)
-404.57,-404.51,^SCTM(404.51,^^S I(100,0)=D0 S DIP(101)=$S($D(^SCTM(404.57,D0,0)):^(0),1:"") S X=$P(DIP(101),U,2),X=X S D(0)=+X;Z;".02:"~
"KRN",.4,5184,"F",5)
-404.57,-404.51,.07;"Institution";L12;C26~-404.57,-404.51,.01;"PC Team";L15;C42~
"KRN",.4,5184,"F",6)
-404.57,5,X "N I,Y "_$P(^DD(404.57,304,0),U,5,99) S DIP(101)=X S X=DIP(101) W X K DIP;L15;C60;"Provider/Team Position";Z;"CURRENT PRACTITIONER"~
"KRN",.4,5184,"F",7)
-404.57,5,X "N I,Y "_$P(^DD(404.57,306,0),U,5,99) S DIP(101)=X S X=DIP(101) W X K DIP;L15;C78;"Preceptor/Team Position";Z;"CURRENT PRECEPTOR"~
"KRN",.4,5184,"F",8)
S DIP(1)=$S($D(^SCPT(404.43,D0,0)):^(0),1:"") S X=$P(DIP(1),U,4) S:X X=$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3) W X K DIP;"Date PT Inactivated";l8;Z;"NUMDATE(POSITION UNASSIGNED DATE)"~
"KRN",.4,5184,"F",9)
X DXS(1,9) W X K DIP;"Reason Patient Inactivated";Z;"$S(INTERNAL(STATUS)="NA":"NO APPT",INTERNAL(STATUS)="DU":"DEATH",1:STATUS)"~
"KRN",.4,5184,"F",10)
-404.57,^SCTM(404.57,^^S I(0,0)=D0 S DIP(1)=$S($D(^SCPT(404.43,D0,0)):^(0),1:"") S X=$P(DIP(1),U,2),X=X S D(0)=+X;Z;".02:"~-404.57,.01;"";C60;L14~
"KRN",.4,5184,"F",11)
-404.57,305;"";C78;L14~
"KRN",.4,5184,"H")
PATIENT TEAM POSITION ASSIGNMENT LIST
"KRN",.4,5184,"ROUOLD")
SCMCPT5
"KRN",.4,5187,-1)
0^5
"KRN",.4,5187,0)
SCMC PENDING UNASSIGN PAT^3080207.1023^@^404.43^^@^3080207
"KRN",.4,5187,"DXS",1,9.2)
S DIP(101)=$S($D(^SCPT(404.42,I(100,0),0)):^(0),1:"") S X=$P(DIP(101),U,1),X=X S X=X,DIP(201)=$G(X) S X="DFN"
"KRN",.4,5187,"DXS",2,9)
X "N I,Y "_$P(^DD(404.43,.159,0),U,5,99) S DIP(1)=X S X=DIP(1) S:X X=$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3)
"KRN",.4,5187,"F",1)
.01;"Patient";L10;C1~-404.42,^SCPT(404.42,^^S I(0,0)=D0 S DIP(1)=$S($D(^SCPT(404.43,D0,0)):^(0),1:"") S X=$P(DIP(1),U,1),X=X S D(0)=+X;Z;".01:"~
"KRN",.4,5187,"F",2)
-404.42,-2,^DPT(^^S I(100,0)=D0 S DIP(101)=$S($D(^SCPT(404.42,D0,0)):^(0),1:"") S X=$P(DIP(101),U,1),X=X S D(0)=+X;Z;".01:"~-404.42,-2,.09;L10;C12;"SSN";~
"KRN",.4,5187,"F",3)
-404.42,-2,X DXS(1,9.2) S X1=DIP(201) S:X]""&(X?.ANP)&(X1'[U)&(X1'["$C(94)") DIPA($E(X,1,30))=X1 S X="" W X K DIP;X;Z;"SETPARAM(INTERNAL(PATIENT),"DFN")"~
"KRN",.4,5187,"F",4)
-404.57,^SCTM(404.57,^^S I(0,0)=D0 S DIP(1)=$S($D(^SCPT(404.43,D0,0)):^(0),1:"") S X=$P(DIP(1),U,2),X=X S D(0)=+X;Z;".02:"~
"KRN",.4,5187,"F",5)
-404.57,-404.51,^SCTM(404.51,^^S I(100,0)=D0 S DIP(101)=$S($D(^SCTM(404.57,D0,0)):^(0),1:"") S X=$P(DIP(101),U,2),X=X S D(0)=+X;Z;".02:"~
"KRN",.4,5187,"F",6)
-404.57,-404.51,.07;"Institution";L15;C24~-404.57,-404.51,.01;"PC Team";L12;C41~-404.57,304;"Provider";L15;C57~-404.57,.01;"Team Position";L14;C75~
"KRN",.4,5187,"F",7)
X DXS(2,9) W X K DIP;"Date Sched. to Inactivate";L10;C92;Z;"NUMDATE(SCHEDULED INACTIVATION DATE)"~
"KRN",.4,5187,"F",8)
D FUTAPP^SCMCTSK2(+$G(DIPA("DFN")));"Next Appt. Date/Clinic";C105;L27;Z;"D FUTAPP^SCMCTSK2(+$G(DIPA("DFN")))"~
"KRN",.4,5187,"H")
PATIENT TEAM POSITION ASSIGNMENT LIST
"MBREQ")
0
"ORD",5,.4)
.4;5;;;EDEOUT^DIFROMSO(.4,DA,"",XPDA);FPRE^DIFROMSI(.4,"",XPDA);EPRE^DIFROMSI(.4,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.4,DA,"",XPDA);DEL^DIFROMSK(.4,"",%)
"ORD",5,.4,0)
PRINT TEMPLATE
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813^2930930
"PKG",16,22,1,"PAH",1,0)
526^3080208
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
12
"RTN","SCMCTSK4")
0^8^B47932762^B48354390
"RTN","SCMCTSK4",1,0)
SCMCTSK4 ;ALB/JDS - PCMM Inactivation Reports ; 18 Apr 2003  9:36 AM
"RTN","SCMCTSK4",2,0)
 ;;5.3;Scheduling;**297,526**;AUG 13, 1993;Build 8
"RTN","SCMCTSK4",3,0)
 Q
"RTN","SCMCTSK4",4,0)
POSCHK ;
"RTN","SCMCTSK4",5,0)
 N NAME S NAME=$P($G(^SD(403.46,+$P(INFO,U,3),0)),U)
"RTN","SCMCTSK4",6,0)
 I "RESIDENT (PHYSICIAN)INTERN (PHYSICIAN)"[NAME S $P(DATA,U,3)=1 Q
"RTN","SCMCTSK4",7,0)
 I "NURSE PRACTITIONERPHYSICIAN ASSISTANT"[NAME S $P(DATA,U,3)=2 Q
"RTN","SCMCTSK4",8,0)
 I "PHYSICIAN-ATTENDINGPHYSICIAN-PRIMARY CARENURSE PRACTITIONERPHYSICIAN ASSISTANTPHYSICIAN-PSYCHIATRIST"[NAME D  Q
"RTN","SCMCTSK4",9,0)
 .S $P(DATA,U,3)=3
"RTN","SCMCTSK4",10,0)
 Q
"RTN","SCMCTSK4",11,0)
DIOBEG ;
"RTN","SCMCTSK4",12,0)
 N PG,DC
"RTN","SCMCTSK4",13,0)
 N Y,% W @IOF,!,$G(SCDHD) D NOW^%DTC S Y=% W:$X>(IOM-40) ! W ?(IOM-40)
"RTN","SCMCTSK4",14,0)
 W $P("JAN^FEB^MAR^APR^MAY^JUN^JUL^AUG^SEP^OCT^NOV^DEC",U,$E(Y,4,5))_" " W:Y#100 $J(Y#100\1,2)_"," W Y\10000+1700 W:Y#1 "  "_$E(Y_0,9,10)_":"_$E(Y_"000",11,12)
"RTN","SCMCTSK4",15,0)
 W ?(IOM-15),"PAGE: 1"
"RTN","SCMCTSK4",16,0)
 S Y="",$P(Y,"-",IOM)="" W !,Y,!!
"RTN","SCMCTSK4",17,0)
 W ?(IOM/2-24),"**** Report Parameters Selected ****",!
"RTN","SCMCTSK4",18,0)
 S SC="^TMP(""SC"",$J)"
"RTN","SCMCTSK4",19,0)
 S X=$$PPAR^SCMCTSK8(.SC,.SCT)
"RTN","SCMCTSK4",20,0)
 S (PG,DC)=1
"RTN","SCMCTSK4",21,0)
 F  Q:$Y>(IOSL-3)  W !
"RTN","SCMCTSK4",22,0)
 ;I IOST["C" W !! R SCX:DT I SCX[U S DIOUT=1
"RTN","SCMCTSK4",23,0)
 Q
"RTN","SCMCTSK4",24,0)
DIOEND ;print key
"RTN","SCMCTSK4",25,0)
 N Y,% W @IOF,!,$G(SCDHD) D NOW^%DTC S Y=% W:$X>(IOM-40) ! W ?(IOM-40)
"RTN","SCMCTSK4",26,0)
 W $P("JAN^FEB^MAR^APR^MAY^JUN^JUL^AUG^SEP^OCT^NOV^DEC",U,$E(Y,4,5))_" " W:Y#100 $J(Y#100\1,2)_"," W Y\10000+1700 W:Y#1 "  "_$E(Y_0,9,10)_":"_$E(Y_"000",11,12)
"RTN","SCMCTSK4",27,0)
 W ?(IOM-15),"PAGE: "_($G(DC)+1)
"RTN","SCMCTSK4",28,0)
 S Y="",$P(Y,"-",IOM)="" W !,Y,!!
"RTN","SCMCTSK4",29,0)
 W !,"   REPORT KEY"
"RTN","SCMCTSK4",30,0)
 W !,"   Field Name              Explanation of field name"
"RTN","SCMCTSK4",31,0)
 W !,"   Patient Name            Name of patient scheduled to be inactivated from their primary care team and position/provider"
"RTN","SCMCTSK4",32,0)
 W !,"   SSN                     Patient SSN."
"RTN","SCMCTSK4",33,0)
 W !,"   PC Team                 Patient's assigned Primary Care team in PCMM."
"RTN","SCMCTSK4",34,0)
 W !,"   Provider                Name of primary care practitioner/provider currently assigned to the patient.  This will be an"
"RTN","SCMCTSK4",35,0)
 W !,"                           Associate PC Provider if the patient is assigned to an AP, or it will be a Primary Care Provider"
"RTN","SCMCTSK4",36,0)
 W !,"                           (PCP) if the patient is not assigned to an Associate PC Provider (AP.)"
"RTN","SCMCTSK4",37,0)
 W !,"   Team Position           The name of the team position to which the current practitioner/provider is assigned."
"RTN","SCMCTSK4",38,0)
 W !,"   Institution/Division    Institution name, previously called Division, in which patient receives primary care."
"RTN","SCMCTSK4",39,0)
 W !,"   Sched Date for Inactiva Date patient will be inactivated from PCMM and their Primary Care team and provider/position"
"RTN","SCMCTSK4",40,0)
 W !,"                           panels. If the patient has a completed outpatient encounter with their current PCP or an"
"RTN","SCMCTSK4",41,0)
 W !,"                           assigned AP before this date, the patient will not be inactivated.  If the patient's"
"RTN","SCMCTSK4",42,0)
 W !,"                           inactivation date is extended for 60 days, with the PCMM Extend Patient's Inactivation Date"
"RTN","SCMCTSK4",43,0)
 W !,"                           option, the patient's inactivation will not occur until the new extended date for inactivation."
"RTN","SCMCTSK4",44,0)
 W !,"                           Note: There is a patient reassignment option, which allows an inactivated patient to be"
"RTN","SCMCTSK4",45,0)
 W !,"                           reactivated to their previous Primary Care team and position if they return for care."
"RTN","SCMCTSK4",46,0)
 W !,"   Next Appt Date          Patient is scheduled for an appointment on this date."
"RTN","SCMCTSK4",47,0)
 W !,"                           May indicate patient wants to continue their assignment to their Primary Care team and provider."
"RTN","SCMCTSK4",48,0)
 W !,"   Clinic for next Appt    The clinic in which the patient has their next scheduled appointment."
"RTN","SCMCTSK4",49,0)
 Q
"RTN","SCMCTSK4",50,0)
DIOEND1 ;print Key
"RTN","SCMCTSK4",51,0)
 N Y,% W @IOF,!,$G(SCDHD) D NOW^%DTC S Y=% W:$X>(IOM-40) ! W ?(IOM-40)
"RTN","SCMCTSK4",52,0)
 W $P("JAN^FEB^MAR^APR^MAY^JUN^JUL^AUG^SEP^OCT^NOV^DEC",U,$E(Y,4,5))_" " W:Y#100 $J(Y#100\1,2)_"," W Y\10000+1700 W:Y#1 "  "_$E(Y_0,9,10)_":"_$E(Y_"000",11,12)
"RTN","SCMCTSK4",53,0)
 W ?(IOM-15),"PAGE: "_($G(DC)+1)
"RTN","SCMCTSK4",54,0)
 S Y="",$P(Y,"-",IOM)="" W !,Y,!!
"RTN","SCMCTSK4",55,0)
 W !,"  REPORT KEY"
"RTN","SCMCTSK4",56,0)
 W !,"  Field Name              Explanation of field name"
"RTN","SCMCTSK4",57,0)
 W !,"  Patient Name            Name of patient scheduled to be inactivated from their primary care team and position/provider."
"RTN","SCMCTSK4",58,0)
 W !,"  SSN                     Patient SSN."
"RTN","SCMCTSK4",59,0)
 W !,"  Institution             Institution name, previously called Division, in which patient receives primary care."
"RTN","SCMCTSK4",60,0)
 W !,"  PC Team                 Patient's assigned Primary Care team in PCMM."
"RTN","SCMCTSK4",61,0)
 W !,"  Provider/               Name of Primary Care practitioner/provider currently assigned to the patient."
"RTN","SCMCTSK4",62,0)
 W !,"                          This may be an Associate PC Provider (AP,) if the patient is assigned to an AP, or"
"RTN","SCMCTSK4",63,0)
 W !,"                          it may be a Primary Care Provider (PCP) if the patient is not assigned to an"
"RTN","SCMCTSK4",64,0)
 W !,"                          Associate PC Provider (AP.)"
"RTN","SCMCTSK4",65,0)
 W !,"  Team Position           The name of the team position to which the current provider is assigned."
"RTN","SCMCTSK4",66,0)
 W !,"  Preceptor               Name of Preceptor/Primary Care Provider (PCP) if the patient is assigned to an Associate Provider."
"RTN","SCMCTSK4",67,0)
 W !,"                          If this field is blank then the patient is assigned to a PCP, who displays in the Provider field."
"RTN","SCMCTSK4",68,0)
 W !,"  Date Patient            Date patient was inactivated from PCMM and their Primary Care team and provider/position."
"RTN","SCMCTSK4",69,0)
 W !,"   Inactivated            Note: There is a PCMM patient re-assignment option."
"RTN","SCMCTSK4",70,0)
 W !,"  Reason Patient          Reason for patient's automated unassignment from their Primary Care team and provider/position."
"RTN","SCMCTSK4",71,0)
 W !,"   Inactivated            No Appt The patient has been assigned to their current Primary Care Provider (PCP) for"
"RTN","SCMCTSK4",72,0)
 W !,"                          12 months, and does not have a completed appointment encounter with their PCP or any assigned"
"RTN","SCMCTSK4",73,0)
 W !,"                          Associated Primary Care Provider (AP) within those 12 months.  Therefore, they are considered"
"RTN","SCMCTSK4",74,0)
 W !,"                          an inactive patient.  Alternatively, the patient has been assigned to their current PCP for at"
"RTN","SCMCTSK4",75,0)
 W !,"                          least 12 months, and does not have a completed appointment encounter with their PCP or any"
"RTN","SCMCTSK4",76,0)
 W !,"                          assigned Associated Primary Care Provider (AP) in the past 24 months. Therefore, they are"
"RTN","SCMCTSK4",77,0)
 W !,"                          considered an inactive patient."
"RTN","SCMCTSK4",78,0)
 W !,"                          Death - Patient's death, a date of death was entered in the Registration Package"
"RTN","SCMCTSK4",79,0)
 Q
"RTN","SCMCTSK4",80,0)
DIOEND2 ;print Key
"RTN","SCMCTSK9")
0^12^B28610326^B28705844
"RTN","SCMCTSK9",1,0)
SCMCTSK9 ;;BP/DMR - PCMM ; 18 Apr 2003  9:36 AM
"RTN","SCMCTSK9",2,0)
 ;;5.3;Scheduling;**297,526**;AUG 13, 1993;Build 8
"RTN","SCMCTSK9",3,0)
 Q
"RTN","SCMCTSK9",4,0)
EXTKEY ;
"RTN","SCMCTSK9",5,0)
 N Y,% W @IOF,!,$G(SCDHD) D NOW^%DTC S Y=% W:$X>(IOM-40) ! W ?(IOM-40)
"RTN","SCMCTSK9",6,0)
 W $P("JAN^FEB^MAR^APR^MAY^JUN^JUL^AUG^SEP^OCT^NOV^DEC",U,$E(Y,4,5))_" " W:Y#100 $J(Y#100\1,2)_"," W Y\10000+1700 W:Y#1 "  "_$E(Y_0,9,10)_":"_$E(Y_"000",11,12)
"RTN","SCMCTSK9",7,0)
 W ?(IOM-15),"PAGE: "_($G(DC)+1)
"RTN","SCMCTSK9",8,0)
 S Y="",$P(Y,"-",IOM)="" W !,Y,!!
"RTN","SCMCTSK9",9,0)
 W !,"Column Heading        Explanation of column headings"
"RTN","SCMCTSK9",10,0)
 W !
"RTN","SCMCTSK9",11,0)
 W !,"Patient Name          Name of patient scheduled to be inactivated from their primary care team and position/provider."
"RTN","SCMCTSK9",12,0)
 W !,"SSN                   SSN number."
"RTN","SCMCTSK9",13,0)
 W !,"Institution           Institution name, previously called Division, in which patient receives primary care."
"RTN","SCMCTSK9",14,0)
 W !,"PC Team               The patient's assigned Primary Care team in PCMM."
"RTN","SCMCTSK9",15,0)
 W !,"Provider/             Name of Associate Primary Care Provider (AP) assigned to patient, if there is one."
"RTN","SCMCTSK9",16,0)
 W !," Team Position        The name of the team position to which the Associate Primary Care Provider (AP) is assigned."
"RTN","SCMCTSK9",17,0)
 W !,"Current Preceptor/    Name of Primary Care Provider (PCP) assigned to patient.  Every Primary Care patient should"
"RTN","SCMCTSK9",18,0)
 W !," Team Position        be assigned to one PCP. The name of the team position to which the Primary Care Provider (PCP)"
"RTN","SCMCTSK9",19,0)
 W !,"                      is assigned."
"RTN","SCMCTSK9",20,0)
 W !,"Date Scheduled for    Date patient will be inactivated from PCMM and their Primary Care team and provider/position unless"
"RTN","SCMCTSK9",21,0)
 W !," Inactivation         they have a completed outpatient appointment encounter with their current PCP or AP before this date."
"RTN","SCMCTSK9",22,0)
 W !,"                      Note: There is a patient reassignment option, which allows an inactivated patient to be reactivated"
"RTN","SCMCTSK9",23,0)
 W !,"                      to their previous Primary Care team and position if they return for care."
"RTN","SCMCTSK9",24,0)
 W !,"Reason for Extended   The reason entered for extending the patient's time before inactivation from PC panels."
"RTN","SCMCTSK9",25,0)
 W !," Inactivation         Entry of this field is in the PCMM GUI, Patient drop down menu, and the Extend Patient's Date for"
"RTN","SCMCTSK9",26,0)
 W !,"                      Inactivation from PC Panels option."
"RTN","SCMCTSK9",27,0)
 Q
"RTN","SCMCTSK9",28,0)
EXTCHUI ;roll n scroll option to extend a patient
"RTN","SCMCTSK9",29,0)
 N DA,DIC,DIE,DR,SCTM,SCARRAY,SCHIGH,SCX,V1
"RTN","SCMCTSK9",30,0)
 S SCTM=0 F  D P1 Q:+SCTM<1
"RTN","SCMCTSK9",31,0)
 Q
"RTN","SCMCTSK9",32,0)
P1 D GCL S DIC="^SCTM(404.51,",DIC(0)="AEQMZ" D ^DIC S SCTM=+Y Q:+SCTM<1
"RTN","SCMCTSK9",33,0)
 W !,"Searching...",!
"RTN","SCMCTSK9",34,0)
 D EXTEND(.SCARRAY,SCTM)
"RTN","SCMCTSK9",35,0)
 I $G(^TMP("SCMCTSK9","OUT",$J,1))="<DATA>" W !,"No Patients to Extend..." D GCL Q
"RTN","SCMCTSK9",36,0)
 S SCHIGH=$O(^TMP("SCMCTSK9","OUT",$J,9999999),-1)
"RTN","SCMCTSK9",37,0)
 S SCX=999 F  Q:(SCX="^")!(SCX="")  D P2
"RTN","SCMCTSK9",38,0)
 Q
"RTN","SCMCTSK9",39,0)
P2 W !,"Select From:  ",!!
"RTN","SCMCTSK9",40,0)
 S V1=0 F  S V1=$O(^TMP("SCMCTSK9","OUT",$J,V1)) Q:'V1  D
"RTN","SCMCTSK9",41,0)
 . W $J(V1,2)_" ",$P(^TMP("SCMCTSK9","OUT",$J,V1),U,3),!
"RTN","SCMCTSK9",42,0)
 F  W !,"Select 1-",SCHIGH," " R SCX:DTIME Q:(SCX="^")!(SCX="")!((SCX'>SCHIGH)&(SCX>0))  D
"RTN","SCMCTSK9",43,0)
 . I $E(SCX,1)="?" W !,"Select 1-",SCHIGH," or '^' to exit" Q
"RTN","SCMCTSK9",44,0)
 . I (+SCX<1)!(+SCX>SCHIGH) W !,"Select a valid number" Q
"RTN","SCMCTSK9",45,0)
 I SCX'?1.9N Q
"RTN","SCMCTSK9",46,0)
 S DIE="^SCPT(404.43,"
"RTN","SCMCTSK9",47,0)
 S DA=$P(^TMP("SCMCTSK9","OUT",$J,SCX),U)
"RTN","SCMCTSK9",48,0)
 S DR=".13//DO NOT EXTEND;S Y=.16 I X=4 S Y=.14;.14;.16////"_DUZ
"RTN","SCMCTSK9",49,0)
 D ^DIE
"RTN","SCMCTSK9",50,0)
 Q
"RTN","SCMCTSK9",51,0)
EXTEND(DATA,SCTEAM) ;return list of patients to inactivate in next 60 days
"RTN","SCMCTSK9",52,0)
 ;IEN^POSITION^PATIENT^EXTENDED^REASON
"RTN","SCMCTSK9",53,0)
 K DATA,SCDATA,SDDATA
"RTN","SCMCTSK9",54,0)
 N CNT,I,J,K,A,POSA S CNT=1 S SCTEAM=$G(SCTEAM),^TMP("SCMCTSK9","OUT",$J,1)="<DATA>"
"RTN","SCMCTSK9",55,0)
 D DT^DICRW S X="T-9M" D ^%DT S STDT=Y
"RTN","SCMCTSK9",56,0)
 S X="T-21M" D ^%DT S TYDT=+Y  ;MAKE THIS 21
"RTN","SCMCTSK9",57,0)
 S POSA=""
"RTN","SCMCTSK9",58,0)
 F  S POSA=$O(^SCTM(404.57,"ATMPOS",+SCTEAM,POSA)) Q:POSA=""  D
"RTN","SCMCTSK9",59,0)
 .F POS=0:0 S POS=$O(^SCTM(404.57,"ATMPOS",+SCTEAM,POSA,POS)) Q:'POS  D POS
"RTN","SCMCTSK9",60,0)
EX1 S A="^TMP(""SCMCTSK9"",$J)",CNT=1 F  S A=$Q(@A) Q:A=""!($P(A,",",2)'=$J)  D
"RTN","SCMCTSK9",61,0)
 .S B=@A
"RTN","SCMCTSK9",62,0)
 .S ^TMP("SCMCTSK9","OUT",$J,CNT)=(+$P(B,U,3))_U_$TR($P($P(A,"(",4),","),$C(34))_U_$TR($P(B,U,2),$C(34))_U_$P($G(^SCPT(404.43,+$P(B,U,3),0)),U,13)_U_$P($G(^SCPT(404.43,+$P(B,U,3),0)),U,14)
"RTN","SCMCTSK9",63,0)
 .S CNT=CNT+1
"RTN","SCMCTSK9",64,0)
 Q
"RTN","SCMCTSK9",65,0)
POS I '$$DATES^SCAPMCU1(404.59,POS) Q   ;Not an active position
"RTN","SCMCTSK9",66,0)
 I '$P($G(^SCTM(404.57,POS,0)),U,4) Q  ;Not PC
"RTN","SCMCTSK9",67,0)
 ;get patients for this position
"RTN","SCMCTSK9",68,0)
 K ^TMP("SC TMP LIST",$J)
"RTN","SCMCTSK9",69,0)
 S X=$$PTTP^SCAPMC(POS,"",.SCLIST,.SCERR)
"RTN","SCMCTSK9",70,0)
 S J=0 F  S J=$O(@SCLIST@(J)) Q:'J  S SCDATA=^(J) D
"RTN","SCMCTSK9",71,0)
 .N J I $P(SCDATA,U,4)>STDT Q
"RTN","SCMCTSK9",72,0)
 .I '$P($G(^SCPT(404.43,+$P(SCDATA,U,3),0)),U,5) Q
"RTN","SCMCTSK9",73,0)
 .I '$P($G(^SCPT(404.43,+$P(SCDATA,U,3),0)),U,15) Q
"RTN","SCMCTSK9",74,0)
 .S DFN=+SCDATA
"RTN","SCMCTSK9",75,0)
 .D SEEN Q:SEEN
"RTN","SCMCTSK9",76,0)
 .S ^TMP("SCMCTSK9",$J,$P($G(^SCTM(404.57,POS,0)),U),$P(SCDATA,U,2),+SCDATA)=SCDATA,CNT=CNT+1
"RTN","SCMCTSK9",77,0)
 K @SCLIST
"RTN","SCMCTSK9",78,0)
 Q
"RTN","SCMCTSK9",79,0)
SEEN ;was patient seen
"RTN","SCMCTSK9",80,0)
 S SEEN=0
"RTN","SCMCTSK9",81,0)
 N SCPRO,I,PRECP,PRO
"RTN","SCMCTSK9",82,0)
 N X,SCPRDTS,SCPR
"RTN","SCMCTSK9",83,0)
 ;get list of providers for this position
"RTN","SCMCTSK9",84,0)
 S PROV=+$$GETPRTP^SCAPMCU2(POS,DT) S SCPRO(+PROV)=""
"RTN","SCMCTSK9",85,0)
 S SCPRDTS("BEGIN")=TYDT
"RTN","SCMCTSK9",86,0)
 S SCPRDTS("END")=DT
"RTN","SCMCTSK9",87,0)
 S X=$$PRTP^SCAPMC(POS,"SCPRDTS","SCPR")
"RTN","SCMCTSK9",88,0)
 F I=0:0 S I=$O(SCPR(I)) Q:'I  S SCPRO(+SCPR(I))=""
"RTN","SCMCTSK9",89,0)
 S PRECP=0 I $G(PREC),$G(PREC)'=POS S PRECP=+$$GETPRTP^SCAPMCU2(PREC,DT),SCPRO(+PRECP)=""
"RTN","SCMCTSK9",90,0)
 F I=TYDT:0 S I=$O(^SCE("ADFN",DFN,I)) Q:'I  D  Q:SEEN
"RTN","SCMCTSK9",91,0)
 .F J=0:0 S J=$O(^SCE("ADFN",DFN,I,J)) Q:'J  D  Q:SEEN
"RTN","SCMCTSK9",92,0)
 ..N VISIT S VISIT=+$P($G(^SCE(J,0)),U,5) I $G(^SCE(J,0))<$G(TYDT) Q
"RTN","SCMCTSK9",93,0)
 ..F PRO=0:0 S PRO=$O(SCPRO(PRO)) Q:'PRO  D  Q:SEEN
"RTN","SCMCTSK9",94,0)
 ...I $D(^SDD(409.44,"AO",J,$G(PRO))) S SEEN=1 Q  ;GET THE PROVIDERJ
"RTN","SCMCTSK9",95,0)
 ...N V F V=0:0 S V=$O(^AUPNVPRV("AD",VISIT,V)) Q:'V  I PRO=(+$G(^AUPNVPRV(V,0))) S SEEN=1 Q
"RTN","SCMCTSK9",96,0)
 Q
"RTN","SCMCTSK9",97,0)
GCL ;clean temp globals
"RTN","SCMCTSK9",98,0)
 K ^TMP("SCMCTSK9",$J)
"RTN","SCMCTSK9",99,0)
 K ^TMP("SCMCTSK9","OUT",$J)
"RTN","SCMCTSK9",100,0)
 Q
"RTN","SCRPEC")
0^1^B15607236^B15606899
"RTN","SCRPEC",1,0)
SCRPEC ;ALB/CMM - Detail List of Pts & Enroll Clinics ; 29 Jun 99  04:11PM
"RTN","SCRPEC",2,0)
 ;;5.3;Scheduling;**41,140,174,177,431,526**;AUG 13, 1993;Build 8
"RTN","SCRPEC",3,0)
 ;
"RTN","SCRPEC",4,0)
 ;Detailed Listing of Patients and Their Enrolled Clinics Report
"RTN","SCRPEC",5,0)
 ;
"RTN","SCRPEC",6,0)
PROMPTS ;
"RTN","SCRPEC",7,0)
 ;Prompt for Institution, Team, Clinic, Assigned or Unassigned to Primary
"RTN","SCRPEC",8,0)
 ;Care, and Print device
"RTN","SCRPEC",9,0)
 ;
"RTN","SCRPEC",10,0)
 N VAUTD,VAUTT,VAUTC,VAUTA,QTIME,PRNT
"RTN","SCRPEC",11,0)
 K VAUTD,VAUTT,VAUTC,VAUTA,VAUTCA,SCUP
"RTN","SCRPEC",12,0)
 S QTIME=""
"RTN","SCRPEC",13,0)
 W ! D INST^SCRPU1 I Y=-1 G ERR
"RTN","SCRPEC",14,0)
 W ! K Y D PRMTT^SCRPU1 I '$D(VAUTT) G ERR
"RTN","SCRPEC",15,0)
 ;S VAUTCA="" ;allows for selection of any clinic in one of the selected divisions
"RTN","SCRPEC",16,0)
 W ! K Y D CLINIC^SCRPU1 I '$D(VAUTC) G ERR
"RTN","SCRPEC",17,0)
 W ! K Y D ASSUN^SCRPU2 I '$D(VAUTA) G ERR
"RTN","SCRPEC",18,0)
 W !!,"This report requires 132 column output!"
"RTN","SCRPEC",19,0)
 D QUE(.VAUTD,.VAUTT,.VAUTC,.VAUTA) Q
"RTN","SCRPEC",20,0)
 ;
"RTN","SCRPEC",21,0)
QUE(INST,TEAM,CLINIC,ASSUN) ;queue report
"RTN","SCRPEC",22,0)
 ;Input Parameters: 
"RTN","SCRPEC",23,0)
 ;INST - institutions selected (variable and array) 
"RTN","SCRPEC",24,0)
 ;TEAM - teams selected (variable and array) 
"RTN","SCRPEC",25,0)
 ;CLINIC - clinics selected (variable and array) 
"RTN","SCRPEC",26,0)
 ;ASSUN - Assigned or Unassigned to PC
"RTN","SCRPEC",27,0)
 N ZTSAVE,II
"RTN","SCRPEC",28,0)
 F II="INST","TEAM","CLINIC","ASSUN","INST(","TEAM(","CLINIC(" S ZTSAVE(II)=""
"RTN","SCRPEC",29,0)
 W ! D EN^XUTMDEVQ("QENTRY^SCRPEC","Detailed Patient Enrollments",.ZTSAVE)
"RTN","SCRPEC",30,0)
 Q
"RTN","SCRPEC",31,0)
 ;
"RTN","SCRPEC",32,0)
ENTRY2(INST,TEAM,CLINIC,ASSUN,IOP,ZTDTH) ;
"RTN","SCRPEC",33,0)
 ;Second entry point for GUI to use
"RTN","SCRPEC",34,0)
 ;Input Parameters:
"RTN","SCRPEC",35,0)
 ;INST - institutions selected (variable and array)
"RTN","SCRPEC",36,0)
 ;TEAM - teams selected (variable and array)
"RTN","SCRPEC",37,0)
 ;CLINIC - clinics selected (variable and array)
"RTN","SCRPEC",38,0)
 ;ASSUN - Assigned or Unassigned to PC
"RTN","SCRPEC",39,0)
 ;IOP - print device
"RTN","SCRPEC",40,0)
 ;ZTDTH - queue time (optional)
"RTN","SCRPEC",41,0)
 ;
"RTN","SCRPEC",42,0)
 ;validate parameters
"RTN","SCRPEC",43,0)
 I '$D(INST)!'$D(TEAM)!'$D(CLINIC)!'$D(ASSUN)!'$D(IOP)!(IOP="") Q
"RTN","SCRPEC",44,0)
 ;
"RTN","SCRPEC",45,0)
 N NUMBER
"RTN","SCRPEC",46,0)
 S IOST=$P(IOP,"^",2),IOP=$P(IOP,"^")
"RTN","SCRPEC",47,0)
 I IOP?1"Q;".E S IOP=$P(IOP,"Q;",2)
"RTN","SCRPEC",48,0)
 I IOST?1"C-".E D QENTRY G RET
"RTN","SCRPEC",49,0)
 I ZTDTH="" S ZTDTH=$H
"RTN","SCRPEC",50,0)
 S ZTRTN="QENTRY^SCRPEC"
"RTN","SCRPEC",51,0)
 S ZTDESC="Detailed Patient List & Enrolled Clinics",ZTIO=IOP
"RTN","SCRPEC",52,0)
 N II
"RTN","SCRPEC",53,0)
 F II="INST","TEAM","CLINIC","ASSUN","INST(","TEAM(","CLINIC(","IOP" S ZTSAVE(II)=""
"RTN","SCRPEC",54,0)
 D ^%ZTLOAD
"RTN","SCRPEC",55,0)
RET S NUMBER=0
"RTN","SCRPEC",56,0)
 I $D(ZTSK) S NUMBER=ZTSK
"RTN","SCRPEC",57,0)
 D EXIT1
"RTN","SCRPEC",58,0)
 Q NUMBER
"RTN","SCRPEC",59,0)
 ;
"RTN","SCRPEC",60,0)
QENTRY ;
"RTN","SCRPEC",61,0)
 ;driver entry point
"RTN","SCRPEC",62,0)
 S VAUTTN=""
"RTN","SCRPEC",63,0)
 S TITL="Detailed Patient Assignments - "_$S(ASSUN=1:"Assigned PC",1:"Not Assigned PC")
"RTN","SCRPEC",64,0)
 S STORE="^TMP("_$J_",""SCRPEC"")"
"RTN","SCRPEC",65,0)
 K @STORE
"RTN","SCRPEC",66,0)
 S @STORE=0
"RTN","SCRPEC",67,0)
 D FIND^SCRPEC3
"RTN","SCRPEC",68,0)
 I $O(@STORE@(0))="" S NODATA=$$NODATA^SCRPU3(TITL)
"RTN","SCRPEC",69,0)
 I '$D(NODATA) D HEADER^SCRPEC2,PRINTIT^SCRPEC3(STORE,TITL)
"RTN","SCRPEC",70,0)
 D EXIT2
"RTN","SCRPEC",71,0)
 Q
"RTN","SCRPEC",72,0)
 ;
"RTN","SCRPEC",73,0)
ERR ;
"RTN","SCRPEC",74,0)
EXIT1 ;
"RTN","SCRPEC",75,0)
 K ZTSAVE,ZTSK,ZTIO,ZTDTH,ZTRTN,ZTDESC,VAUTCA,SCUP
"RTN","SCRPEC",76,0)
 Q
"RTN","SCRPEC",77,0)
EXIT2 ;
"RTN","SCRPEC",78,0)
 K @STORE
"RTN","SCRPEC",79,0)
 K STORE,VAUTTN,PAGE,TITL,IOP,TITL,NODATA,CLINIC,ASSUN,INST,TEAM,STOP
"RTN","SCRPEC",80,0)
 Q
"RTN","SCRPEC",81,0)
 ;
"RTN","SCRPEC",82,0)
PDATA(DFN,CLNEN,FLAG) ;
"RTN","SCRPEC",83,0)
 ;Collect and format data for report
"RTN","SCRPEC",84,0)
 ;
"RTN","SCRPEC",85,0)
 N NODE,NAME,PID,PELIG,MT,PSTAT,STATD,DATA,LAST,NEXT,CEN,CNAME
"RTN","SCRPEC",86,0)
 S DATA=""
"RTN","SCRPEC",87,0)
 S NODE=$G(^DPT(DFN,0))
"RTN","SCRPEC",88,0)
 S NAME=$P(NODE,"^") ;patient name
"RTN","SCRPEC",89,0)
 S PID=$P($G(^DPT(DFN,.36)),"^",3),PID=$TR(PID,"-","") ;PID without '-'s
"RTN","SCRPEC",90,0)
 S MT=$$LST^DGMTU(DFN),MT=$P(MT,"^",4)  ;means test status SD*5.3*431
"RTN","SCRPEC",91,0)
 S PELIG=$$ELIG^SCRPU3(DFN) ;primary eligibility
"RTN","SCRPEC",92,0)
 ;
"RTN","SCRPEC",93,0)
 S CNAME=$P($G(^SC(CLNEN,0)),"^")
"RTN","SCRPEC",94,0)
 S CEN=+$O(^DPT(DFN,"DE","B",CLNEN,""))
"RTN","SCRPEC",95,0)
 S NODE=$G(^DPT(DFN,"DE",CEN,1,1,0))
"RTN","SCRPEC",96,0)
 S PSTAT=$P(NODE,"^",2) S PSTAT=PSTAT_$S(PSTAT="A":"C",PSTAT="O":"PT",1:"") ;opt or ac status
"RTN","SCRPEC",97,0)
 I $P(NODE,"^")="" S STATD=""
"RTN","SCRPEC",98,0)
 I $P(NODE,"^")'="" S STATD=$TR($$FMTE^XLFDT($P(NODE,"^"),"5DF")," ","0") ;enrollment date
"RTN","SCRPEC",99,0)
 S LAST=$$GETLAST^SCRPU3(DFN,CLNEN) ;last clinic appointment
"RTN","SCRPEC",100,0)
 S NEXT=$$GETNEXT^SCRPU3(DFN,CLNEN) ;next clinic appointment
"RTN","SCRPEC",101,0)
 I '$D(FLAG) S DATA=$$FORMAT^SCRPEC2(NAME,PID,MT,PELIG,PSTAT,STATD,LAST,NEXT,CNAME),DATA=$E(NAME,1,12)_"^"_DATA
"RTN","SCRPEC",102,0)
 I $D(FLAG) S DATA=$E(NAME,1,12)_"^"_PID_"^"_MT_"^"_PELIG_"^"_PSTAT_"^"_STATD_"^"_LAST_"^"_NEXT
"RTN","SCRPEC",103,0)
 Q DATA
"RTN","SCRPEC",104,0)
 ;
"RTN","SCRPEC2")
0^7^B29990471^B30204099
"RTN","SCRPEC2",1,0)
SCRPEC2 ;ALB/CMM - Detail List of Pts & Enroll Clinics Continued ; 29 Jun 99  04:11PM
"RTN","SCRPEC2",2,0)
 ;;5.3;Scheduling;**41,140,174,177,526**;AUG 13, 1993;Build 8
"RTN","SCRPEC2",3,0)
 ;
"RTN","SCRPEC2",4,0)
 ;Detailed Listing of Patients and Their Enrolled Clinics Report
"RTN","SCRPEC2",5,0)
 ;
"RTN","SCRPEC2",6,0)
PAT(TIEN,PTLIST) ;
"RTN","SCRPEC2",7,0)
 ;TIEN - team ien
"RTN","SCRPEC2",8,0)
 ;PTLIST - array holding patients assigned to team TIEN
"RTN","SCRPEC2",9,0)
 ;
"RTN","SCRPEC2",10,0)
 N PTIEN,ENT,NODE,OKAY,CLLIST,ERR,PC
"RTN","SCRPEC2",11,0)
 S ENT=0,CLLIST="LIST2",ERR="ERROR2"
"RTN","SCRPEC2",12,0)
 K @CLLIST
"RTN","SCRPEC2",13,0)
 F  S ENT=$O(@PTLIST@(ENT)) Q:ENT=""!(ENT'?.N)  D
"RTN","SCRPEC2",14,0)
 .S NODE=$G(@PTLIST@(ENT))
"RTN","SCRPEC2",15,0)
 .Q:NODE=""
"RTN","SCRPEC2",16,0)
 .S PTIEN=+$P(NODE,"^") ;patient ien
"RTN","SCRPEC2",17,0)
 .S PC=$$PCASSIGN(PTIEN,TIEN)
"RTN","SCRPEC2",18,0)
 .Q:PC'=ASSUN  ;not selected assigned/unassigned primary care
"RTN","SCRPEC2",19,0)
 .K @CLLIST
"RTN","SCRPEC2",20,0)
 .S OKAY=$$CLPT^SCAPMC29(PTIEN,"","",.CLLIST,.ERR)
"RTN","SCRPEC2",21,0)
 .;all clinics for patient PTIEN
"RTN","SCRPEC2",22,0)
 .Q:'OKAY
"RTN","SCRPEC2",23,0)
 .D KEEP(TIEN,PTIEN,.CLLIST)
"RTN","SCRPEC2",24,0)
 K @CLLIST
"RTN","SCRPEC2",25,0)
 Q
"RTN","SCRPEC2",26,0)
 ;
"RTN","SCRPEC2",27,0)
KEEP(TIEN,PTIEN,CLLIST) ;keep data for report
"RTN","SCRPEC2",28,0)
 ;TIEN - team ien
"RTN","SCRPEC2",29,0)
 ;PTIEN - patient ien
"RTN","SCRPEC2",30,0)
 ;CLLIST - array holding clinics for patient PTIEN
"RTN","SCRPEC2",31,0)
 ;
"RTN","SCRPEC2",32,0)
 N ENT,TNAME,INS,NODE,INAME,PDATA,NODE,CIEN,CNAME,PNAME
"RTN","SCRPEC2",33,0)
 N SCPCPR,SCPCAP,SCI,PCLIST
"RTN","SCRPEC2",34,0)
 S TNAME=$P($G(^SCTM(404.51,TIEN,0)),"^") ;team name
"RTN","SCRPEC2",35,0)
 S INS=+$P($G(^SCTM(404.51,TIEN,0)),"^",7) ;institution ien
"RTN","SCRPEC2",36,0)
 S INAME=$P($G(^DIC(4,INS,0)),"^") ;institution name
"RTN","SCRPEC2",37,0)
 S PNAME=$P($G(^DPT(PTIEN,0)),"^") ;patient name
"RTN","SCRPEC2",38,0)
 K ^TMP("SC",$J,PTIEN)
"RTN","SCRPEC2",39,0)
 S SCI=$$GETALL^SCAPMCA(PTIEN) D
"RTN","SCRPEC2",40,0)
 .;Name of PC Provider
"RTN","SCRPEC2",41,0)
 .S SCPCPR=$P($G(^TMP("SC",$J,PTIEN,"PCPR",1)),U,2)
"RTN","SCRPEC2",42,0)
 .;Name of Associate Provider
"RTN","SCRPEC2",43,0)
 .S SCPCAP=$P($G(^TMP("SC",$J,PTIEN,"PCAP",1)),U,2)
"RTN","SCRPEC2",44,0)
 .Q
"RTN","SCRPEC2",45,0)
 ;
"RTN","SCRPEC2",46,0)
 S ENT=0
"RTN","SCRPEC2",47,0)
 F  S ENT=$O(@CLLIST@(ENT)) Q:ENT=""!(ENT'?.N)  D
"RTN","SCRPEC2",48,0)
 .S NODE=$G(@CLLIST@(ENT))
"RTN","SCRPEC2",49,0)
 .S CIEN=+$P(NODE,"^") ;clinic ien
"RTN","SCRPEC2",50,0)
 .I CLINIC'=1,'$D(CLINIC(CIEN)) Q
"RTN","SCRPEC2",51,0)
 .S CNAME=$P(NODE,"^",2) ;clinic name
"RTN","SCRPEC2",52,0)
 .D SETUP(INS,INAME,TIEN,TNAME,PTIEN,PNAME,CIEN,CNAME)
"RTN","SCRPEC2",53,0)
 .S PDATA=$$PDATA^SCRPEC(PTIEN,CIEN,1)
"RTN","SCRPEC2",54,0)
 .S $P(PDATA,U,9)=SCPCPR,$P(PDATA,U,10)=SCPCAP
"RTN","SCRPEC2",55,0)
 .;name^pid^mt^pelig^pstat^statd^last^next^pc prov.^assoc. prov.
"RTN","SCRPEC2",56,0)
 .D FORMAT(PTIEN,INS,TIEN,PDATA,CNAME,CIEN)
"RTN","SCRPEC2",57,0)
 Q
"RTN","SCRPEC2",58,0)
 ;
"RTN","SCRPEC2",59,0)
SETUP(INS,INAME,TIEN,TNAME,PTIEN,PNAME,CIEN,CNAME) ;
"RTN","SCRPEC2",60,0)
 ;INS - institution ien
"RTN","SCRPEC2",61,0)
 ;INAME - institution name
"RTN","SCRPEC2",62,0)
 ;TIEN - team ien
"RTN","SCRPEC2",63,0)
 ;TNAME - team name
"RTN","SCRPEC2",64,0)
 ;PTIEN - patient ien
"RTN","SCRPEC2",65,0)
 ;PNAME - patient name
"RTN","SCRPEC2",66,0)
 ;CIEN - clinic ien
"RTN","SCRPEC2",67,0)
 ;CNAME - clinic name
"RTN","SCRPEC2",68,0)
 ;
"RTN","SCRPEC2",69,0)
 I INAME="" S INAME="[BAD DATA]"
"RTN","SCRPEC2",70,0)
 I TNAME="" S TNAME="[BAD DATA]"
"RTN","SCRPEC2",71,0)
 I CNAME="" S CNAME="[BAD DATA]"
"RTN","SCRPEC2",72,0)
 I PNAME="" S PNAME="[BAD DATA]"
"RTN","SCRPEC2",73,0)
 I '$D(@STORE@("I",INAME,INS)) S @STORE@("I",INAME,INS)="",@STORE@(INS)="Division: "_INAME
"RTN","SCRPEC2",74,0)
 I '$D(@STORE@("T",INS,TNAME,TIEN)) S @STORE@("T",INS,TNAME,TIEN)="",@STORE@(INS,TIEN)="Team: "_TNAME
"RTN","SCRPEC2",75,0)
 I '$D(@STORE@("C",INS,TIEN,CNAME,CIEN)) S @STORE@("C",INS,TIEN,CNAME,CIEN)="" ;D HEADER(INS,TIEN,CIEN)
"RTN","SCRPEC2",76,0)
 I '$D(@STORE@("PT",INS,TIEN,CIEN,PNAME,PTIEN)) S @STORE@("PT",INS,TIEN,CIEN,PNAME,PTIEN)=""
"RTN","SCRPEC2",77,0)
 Q
"RTN","SCRPEC2",78,0)
 ;
"RTN","SCRPEC2",79,0)
PCASSIGN(DFN,TIEN) ;patient assigned to team as primary care
"RTN","SCRPEC2",80,0)
 ;DFN - patient ien
"RTN","SCRPEC2",81,0)
 ;TIEN - team ien
"RTN","SCRPEC2",82,0)
 ;1 - yes
"RTN","SCRPEC2",83,0)
 ;0 - no
"RTN","SCRPEC2",84,0)
 ;
"RTN","SCRPEC2",85,0)
 N ADATE,ENTRY,PC
"RTN","SCRPEC2",86,0)
 S PC=0
"RTN","SCRPEC2",87,0)
 I '$D(^SCPT(404.42,"AIDT",DFN,TIEN)) Q PC
"RTN","SCRPEC2",88,0)
 S ADATE=$O(^SCPT(404.42,"AIDT",DFN,TIEN,"")) ; -team assignemtn date
"RTN","SCRPEC2",89,0)
 S ENTRY=$O(^SCPT(404.42,"AIDT",DFN,TIEN,ADATE,"")) ;patient team assignemtn ien
"RTN","SCRPEC2",90,0)
 I $P($G(^SCPT(404.42,+ENTRY,0)),"^",8)=1 S PC=1
"RTN","SCRPEC2",91,0)
 Q PC
"RTN","SCRPEC2",92,0)
 ;
"RTN","SCRPEC2",93,0)
HEADER ;report column titles
"RTN","SCRPEC2",94,0)
 N HLD
"RTN","SCRPEC2",95,0)
 S HLD="H0"
"RTN","SCRPEC2",96,0)
 S $E(@STORE@("SUBHEADER",HLD),25)="M.T."
"RTN","SCRPEC2",97,0)
 S $E(@STORE@("SUBHEADER",HLD),31)="Prim"
"RTN","SCRPEC2",98,0)
 ;Removed by patch 174
"RTN","SCRPEC2",99,0)
 ;S $E(@STORE@("SUBHEADER",HLD),31)="Pat"
"RTN","SCRPEC2",100,0)
 ;S $E(@STORE@("SUBHEADER",HLD),36)="Status"
"RTN","SCRPEC2",101,0)
 S $E(@STORE@("SUBHEADER",HLD),42)="Last"
"RTN","SCRPEC2",102,0)
 S $E(@STORE@("SUBHEADER",HLD),54)="Next"
"RTN","SCRPEC2",103,0)
 S $E(@STORE@("SUBHEADER",HLD),66)="Enrolled"
"RTN","SCRPEC2",104,0)
 S $E(@STORE@("SUBHEADER",HLD),95)="Primary Care"
"RTN","SCRPEC2",105,0)
 S $E(@STORE@("SUBHEADER",HLD),115)="Associate"
"RTN","SCRPEC2",106,0)
 S HLD="H1"
"RTN","SCRPEC2",107,0)
 S @STORE@("SUBHEADER",HLD)="Patient Name"
"RTN","SCRPEC2",108,0)
 S $E(@STORE@("SUBHEADER",HLD),16)="Pt ID"
"RTN","SCRPEC2",109,0)
 S $E(@STORE@("SUBHEADER",HLD),25)="Stat"
"RTN","SCRPEC2",110,0)
 S $E(@STORE@("SUBHEADER",HLD),31)="Elig"
"RTN","SCRPEC2",111,0)
 ;Removed by patch 174
"RTN","SCRPEC2",112,0)
 ;S $E(@STORE@("SUBHEADER",HLD),31)="Stat"
"RTN","SCRPEC2",113,0)
 ;S $E(@STORE@("SUBHEADER",HLD),36)="Date"
"RTN","SCRPEC2",114,0)
 S $E(@STORE@("SUBHEADER",HLD),42)="Appt"
"RTN","SCRPEC2",115,0)
 S $E(@STORE@("SUBHEADER",HLD),54)="Appt"
"RTN","SCRPEC2",116,0)
 S $E(@STORE@("SUBHEADER",HLD),66)="Clinic"
"RTN","SCRPEC2",117,0)
 S $E(@STORE@("SUBHEADER",HLD),95)="Provider"
"RTN","SCRPEC2",118,0)
 S $E(@STORE@("SUBHEADER",HLD),115)="Provider"
"RTN","SCRPEC2",119,0)
 S HLD="H2"
"RTN","SCRPEC2",120,0)
 S $P(@STORE@("SUBHEADER",HLD),"=",133)=""
"RTN","SCRPEC2",121,0)
 Q
"RTN","SCRPEC2",122,0)
 ;
"RTN","SCRPEC2",123,0)
FORMAT(PTIEN,INS,TIEN,PDATA,CNAME,CIEN) ;format data for report
"RTN","SCRPEC2",124,0)
 ;PTIEN - patient ien
"RTN","SCRPEC2",125,0)
 ;INS - institution ien
"RTN","SCRPEC2",126,0)
 ;TIEN - team ien
"RTN","SCRPEC2",127,0)
 ;PDATA - pt name^pid^mt^pelig^pstat^statd^last^next^pc prov.^assoc. prov.
"RTN","SCRPEC2",128,0)
 ;CNAME - clinic name
"RTN","SCRPEC2",129,0)
 ;CIEN - clinic ien
"RTN","SCRPEC2",130,0)
 ;
"RTN","SCRPEC2",131,0)
 S @STORE@(INS,TIEN,CIEN,PTIEN)=$E($P(PDATA,"^"),1,12) ;patient name
"RTN","SCRPEC2",132,0)
 S $E(@STORE@(INS,TIEN,CIEN,PTIEN),14)=$P(PDATA,"^",2) ;primary long id 9 digit
"RTN","SCRPEC2",133,0)
 S $E(@STORE@(INS,TIEN,CIEN,PTIEN),26)=$P(PDATA,"^",3) ;means test category
"RTN","SCRPEC2",134,0)
 S $E(@STORE@(INS,TIEN,CIEN,PTIEN),31)=$P(PDATA,"^",4) ;primary eligibility
"RTN","SCRPEC2",135,0)
 ;Removed by patch 174
"RTN","SCRPEC2",136,0)
 ;S $E(@STORE@(INS,TIEN,CIEN,PTIEN),31)=$P(PDATA,"^",5) ;patient status
"RTN","SCRPEC2",137,0)
 ;S $E(@STORE@(INS,TIEN,CIEN,PTIEN),35)=$P(PDATA,"^",6) ;status date
"RTN","SCRPEC2",138,0)
 S $E(@STORE@(INS,TIEN,CIEN,PTIEN),42)=$P(PDATA,"^",7) ;last appointment
"RTN","SCRPEC2",139,0)
 S $E(@STORE@(INS,TIEN,CIEN,PTIEN),54)=$P(PDATA,"^",8) ;next appointment
"RTN","SCRPEC2",140,0)
 S $E(@STORE@(INS,TIEN,CIEN,PTIEN),66)=$E(CNAME,1,27) ;clinic name
"RTN","SCRPEC2",141,0)
 S $E(@STORE@(INS,TIEN,CIEN,PTIEN),95)=$E($P(PDATA,U,9),1,18) ;PC prov.
"RTN","SCRPEC2",142,0)
 S $E(@STORE@(INS,TIEN,CIEN,PTIEN),115)=$E($P(PDATA,U,10),1,18) ;Assoc. Prov.
"RTN","SCRPEC2",143,0)
 Q
"RTN","SCRPEC2",144,0)
 ;
"RTN","SCRPEC2",145,0)
CHEAD(INS,TEAM,CLINIC) ;
"RTN","SCRPEC2",146,0)
 ;column headings
"RTN","SCRPEC2",147,0)
 ;
"RTN","SCRPEC2",148,0)
 N EN,NEWP
"RTN","SCRPEC2",149,0)
 W !
"RTN","SCRPEC2",150,0)
 S NEWP=0
"RTN","SCRPEC2",151,0)
 I IOST'?1"C-".E,$Y+5>(IOSL-6) D NEWP1^SCRPU3(.PAGE,TITL) S NEWP=1
"RTN","SCRPEC2",152,0)
 I IOST?1"C-".E,$Y+5>(IOSL-6) D HOLD^SCRPU3(.PAGE,TITL) S NEWP=1
"RTN","SCRPEC2",153,0)
 I STOP Q
"RTN","SCRPEC2",154,0)
 I NEWP W !,$G(@STORE@(INS)),!!,$G(@STORE@(INS,TEAM)),!
"RTN","SCRPEC2",155,0)
CH2 F EN="H0","H1","H2" W !,$G(@STORE@("SUBHEADER",EN))
"RTN","SCRPEC2",156,0)
 Q
"RTN","SCRPEC2",157,0)
 ;
"RTN","SCRPPAT2")
0^9^B28347716^B29043068
"RTN","SCRPPAT2",1,0)
SCRPPAT2 ;ALB/CMM - Practitioner's Patients ; 12/12/00 3:46pm
"RTN","SCRPPAT2",2,0)
 ;;5.3;Scheduling;**41,48,174,181,177,231,433,297,526**;AUG 13, 1993;Build 8
"RTN","SCRPPAT2",3,0)
 ;
"RTN","SCRPPAT2",4,0)
 ;Listing of Practitioner's Patients
"RTN","SCRPPAT2",5,0)
 ;
"RTN","SCRPPAT2",6,0)
DRIVE ;
"RTN","SCRPPAT2",7,0)
 ;driver module
"RTN","SCRPPAT2",8,0)
 N PRAC,INF,ARRY,ERROR,NXT,OKAY,PIEN,TPRC
"RTN","SCRPPAT2",9,0)
 S ARRY="^TMP(""SCARRAY"","_$J_")",ERROR="ERR"
"RTN","SCRPPAT2",10,0)
 S TPRC="^TMP(""SCRP"",$J,""PRACT"")" M @TPRC=PRACT
"RTN","SCRPPAT2",11,0)
 K @ARRY,@ERROR,PRACT
"RTN","SCRPPAT2",12,0)
 I @TPRC=1 D ALL^SCRPPAT3 ;all practitioners selected
"RTN","SCRPPAT2",13,0)
 S NXT=0
"RTN","SCRPPAT2",14,0)
 F  S NXT=$O(@TPRC@(NXT)) Q:NXT=""!(NXT'?.N)  D
"RTN","SCRPPAT2",15,0)
 .I @TPRC=0 S PIEN=NXT
"RTN","SCRPPAT2",16,0)
 .I @TPRC=1 S PIEN=$P(@TPRC@(NXT),"^")
"RTN","SCRPPAT2",17,0)
 .K @ARRY,@ERROR
"RTN","SCRPPAT2",18,0)
 .S OKAY=$$PTPR^SCAPMC14(PIEN,"","","",ARRY,ERROR) ;patients for practitioner
"RTN","SCRPPAT2",19,0)
 .I '+OKAY Q
"RTN","SCRPPAT2",20,0)
 .D LOOPPT(ARRY,PIEN) ;loop through patients for practitioner
"RTN","SCRPPAT2",21,0)
 K @ARRY,@ERROR,@TPRC
"RTN","SCRPPAT2",22,0)
 K:SUMM @STORE@("PT")
"RTN","SCRPPAT2",23,0)
 Q
"RTN","SCRPPAT2",24,0)
 ;
"RTN","SCRPPAT2",25,0)
LOOPPT(ARY,PRAC) ;loop through patients for practitioner
"RTN","SCRPPAT2",26,0)
 ;ARY - array of patients for selected practitioner
"RTN","SCRPPAT2",27,0)
 ;PRAC - practitioner ien
"RTN","SCRPPAT2",28,0)
 N NXT,PIEN,TPIEN,PNAME,TPIEN,NODE,PTP,TPI,TPN,CLIEN,CNAME,PTA,PTAN,TIEN
"RTN","SCRPPAT2",29,0)
 N PC,TNODE,TNAME,PINF,POSN,PRCP
"RTN","SCRPPAT2",30,0)
 S NXT=0
"RTN","SCRPPAT2",31,0)
 F  S NXT=$O(@ARY@(NXT)) Q:NXT=""!(NXT'?.N)  D
"RTN","SCRPPAT2",32,0)
 .S NODE=$G(@ARY@(NXT))
"RTN","SCRPPAT2",33,0)
 .Q:NODE=""
"RTN","SCRPPAT2",34,0)
 .S PIEN=+$P(NODE,"^") ;ien of patient file entry
"RTN","SCRPPAT2",35,0)
 .S TPIEN=+$P(NODE,"^",3) ;ien of patient team position assignment
"RTN","SCRPPAT2",36,0)
 .S PTP=$G(^SCPT(404.43,TPIEN,0))
"RTN","SCRPPAT2",37,0)
 .Q:PTP=""
"RTN","SCRPPAT2",38,0)
 .S PTA=+$P(PTP,"^") ;patient team assignment ien (404.42)
"RTN","SCRPPAT2",39,0)
 .S PTAN=$G(^SCPT(404.42,PTA,0))
"RTN","SCRPPAT2",40,0)
 .Q:PTAN=""
"RTN","SCRPPAT2",41,0)
 .S TIEN=+$P(PTAN,"^",3) ;team file ien (404.51)
"RTN","SCRPPAT2",42,0)
 .I $G(TEAM)'=1,'$D(TEAM(TIEN)) Q  ;not a selected team
"RTN","SCRPPAT2",43,0)
 .S TNODE=$G(^SCTM(404.51,TIEN,0))
"RTN","SCRPPAT2",44,0)
 .Q:TNODE=""  I $G(INST)'=1,'$D(INST(+$P(TNODE,U,7))) Q
"RTN","SCRPPAT2",45,0)
 .S TNAME=$P(TNODE,"^") ;team name
"RTN","SCRPPAT2",46,0)
 .S TPI=+$P(PTP,"^",2) ;Team Position file ien (404.57)
"RTN","SCRPPAT2",47,0)
 .S TPN=$G(^SCTM(404.57,TPI,0))
"RTN","SCRPPAT2",48,0)
 .Q:TPN=""
"RTN","SCRPPAT2",49,0)
 .I $G(ROLE)'=1,'$D(ROLE(+$P(TPN,U,3))) Q  ;not a selected role
"RTN","SCRPPAT2",50,0)
 .S POSN=$P(TPN,"^") ;position name
"RTN","SCRPPAT2",51,0)
 .S CLIEN=+$P(TPN,"^",9) ;associated clinic ien
"RTN","SCRPPAT2",52,0)
 .;commented next line off - clinic enrollment no longer needed SD*5.3*433
"RTN","SCRPPAT2",53,0)
 .;D CECHK(CLIEN,.CNAME,PIEN) ;is patient enrolled in associated clinic?
"RTN","SCRPPAT2",54,0)
 .S CNAME=$P($G(^SC(CLIEN,0)),"^")  ; SD*5.3*433 remove enroll check
"RTN","SCRPPAT2",55,0)
 .S PC=$S($P(PTP,"^",5)=0:0,1:1) ;primary care position 1or2-yes/0-no
"RTN","SCRPPAT2",56,0)
 .S PNAME=$P($G(^VA(200,+PRAC,0)),"^") ;practitioner name
"RTN","SCRPPAT2",57,0)
 .Q:PNAME=""
"RTN","SCRPPAT2",58,0)
 .S PRCP=$P($$OKPREC2^SCMCLK(TPI,DT),U,2)
"RTN","SCRPPAT2",59,0)
 .S PINF=PIEN_"^"_$$PDATA^SCRPEC(PIEN,CLIEN,1)
"RTN","SCRPPAT2",60,0)
 .;$$PDATA returns pt name,pid,mt,pelig,status,status date,last appt,nxt appt
"RTN","SCRPPAT2",61,0)
 .D FORMAT(CNAME,PINF,PC,TIEN,TNAME,PRAC,PNAME,POSN,TPI,PRCP) ;formats data for display
"RTN","SCRPPAT2",62,0)
 Q
"RTN","SCRPPAT2",63,0)
 ;
"RTN","SCRPPAT2",64,0)
CECHK(CLIEN,CNAME,PIEN) ;
"RTN","SCRPPAT2",65,0)
 ;CLIEN - clinic ien
"RTN","SCRPPAT2",66,0)
 ;CNAME - clinic name returned if patient is enrolled in clien clinic
"RTN","SCRPPAT2",67,0)
 ;PIEN - patien ien
"RTN","SCRPPAT2",68,0)
 ;
"RTN","SCRPPAT2",69,0)
 N EN,NODE
"RTN","SCRPPAT2",70,0)
 S CNAME=""
"RTN","SCRPPAT2",71,0)
 I $D(^DPT(PIEN,"DE","B",CLIEN)) D
"RTN","SCRPPAT2",72,0)
 .;enrolled at one time, check if discharged
"RTN","SCRPPAT2",73,0)
 .S EN=$O(^DPT(PIEN,"DE","B",CLIEN,""))
"RTN","SCRPPAT2",74,0)
 .S NODE=$G(^DPT(PIEN,"DE",EN,0))
"RTN","SCRPPAT2",75,0)
 .Q:NODE=""
"RTN","SCRPPAT2",76,0)
 .I $P(NODE,"^",3)="" S CNAME=$P($G(^SC(CLIEN,0)),"^") ;clinic name
"RTN","SCRPPAT2",77,0)
 .I $P(NODE,"^",3)'="",$P(NODE,"^",3)>DT S CNAME=$P($G(^SC(CLIEN,0)),"^") ;clinic name
"RTN","SCRPPAT2",78,0)
 Q
"RTN","SCRPPAT2",79,0)
 ;
"RTN","SCRPPAT2",80,0)
FORMAT(CNAME,PINF,PC,TIEN,TNAME,PRAC,PNAME,POSN,TPI,PRCP) ; format data for display
"RTN","SCRPPAT2",81,0)
 ;CNAME - clinic name
"RTN","SCRPPAT2",82,0)
 ;PINF - patient/clinic data
"RTN","SCRPPAT2",83,0)
 ;PC - primary care 1/0
"RTN","SCRPPAT2",84,0)
 ;TIEN - team file ien (#404.51)
"RTN","SCRPPAT2",85,0)
 ;TNAME - team name
"RTN","SCRPPAT2",86,0)
 ;PRAC - practitioner ien (#200)
"RTN","SCRPPAT2",87,0)
 ;PNAME - practitioner name
"RTN","SCRPPAT2",88,0)
 ;POSN - position name
"RTN","SCRPPAT2",89,0)
 ;TPI - team position ien (#404.57)
"RTN","SCRPPAT2",90,0)
 ;PRCP - preceptor name
"RTN","SCRPPAT2",91,0)
 ;
"RTN","SCRPPAT2",92,0)
 N IIEN,INAME,ERR
"RTN","SCRPPAT2",93,0)
 S ERR=$$SETUP^SCRPPAT3(.IIEN,.INAME,TIEN,TNAME,PRAC,PNAME,POSN,TPI,PRCP)
"RTN","SCRPPAT2",94,0)
 I ERR Q
"RTN","SCRPPAT2",95,0)
 ;
"RTN","SCRPPAT2",96,0)
 I SORT=1 D STOR(IIEN,TIEN,PRAC,PINF,PNAME,TNAME,TPI) ;sort division,team,practitioner
"RTN","SCRPPAT2",97,0)
 I SORT=2 D STOR(IIEN,PRAC,TIEN,PINF,PNAME,TNAME,TPI) ;sort division,practitioner,team
"RTN","SCRPPAT2",98,0)
 I SORT=3 D STOR(1,PRAC,1,PINF,PNAME,"T3",TPI)
"RTN","SCRPPAT2",99,0)
 Q
"RTN","SCRPPAT2",100,0)
 ;
"RTN","SCRPPAT2",101,0)
STOR(IIEN,SEC,TRD,PINF,PNAME,TNAME,TPI) ;
"RTN","SCRPPAT2",102,0)
 ;IIEN - ien institution
"RTN","SCRPPAT2",103,0)
 ;SEC - second sort subscript, IEN team or IEN practitioner
"RTN","SCRPPAT2",104,0)
 ;TRD - third sort subscript, IEN team or IEN practitioner
"RTN","SCRPPAT2",105,0)
 ;PINF - patient/clinic info
"RTN","SCRPPAT2",106,0)
 ;PNAME - practitioner name
"RTN","SCRPPAT2",107,0)
 ;TNAME - team name
"RTN","SCRPPAT2",108,0)
 ;TPI - team position ien
"RTN","SCRPPAT2",109,0)
 ;
"RTN","SCRPPAT2",110,0)
 N PIEN,PTNAME,PID
"RTN","SCRPPAT2",111,0)
 S PIEN=+$P(PINF,"^") ;patient ien 
"RTN","SCRPPAT2",112,0)
 S PTNAME=$E($P(PINF,"^",2),1,10) ;patient name
"RTN","SCRPPAT2",113,0)
 Q:$D(@STORE@("PT",IIEN,SEC,TRD,TPI,PTNAME,PIEN))
"RTN","SCRPPAT2",114,0)
 S @STORE@("PT",IIEN,SEC,TRD,TPI,PTNAME,PIEN)=""
"RTN","SCRPPAT2",115,0)
 ;
"RTN","SCRPPAT2",116,0)
 I 'SUMM,'$D(@STORE@("PTOT",IIEN,SEC,TRD,PIEN)) D
"RTN","SCRPPAT2",117,0)
 .;count each unique patient for any given practitioner for grand total
"RTN","SCRPPAT2",118,0)
 .S @STORE@("PTOT",IIEN,SEC,TRD,PIEN)=""
"RTN","SCRPPAT2",119,0)
 .S @STORE@("TOTAL",IIEN,PRAC,0)=$G(@STORE@("TOTAL",IIEN,PRAC,0))+1 ;patient count by practitioner
"RTN","SCRPPAT2",120,0)
 ;
"RTN","SCRPPAT2",121,0)
 S @STORE@("TOTAL",IIEN,PRAC,$S(SORT=3:1,1:TIEN),TPI)=$G(@STORE@("TOTAL",IIEN,PRAC,$S(SORT=3:1,1:TIEN),TPI))+1 ;patient count by practitioner and team
"RTN","SCRPPAT2",122,0)
 Q:SUMM
"RTN","SCRPPAT2",123,0)
 ;
"RTN","SCRPPAT2",124,0)
 S @STORE@(IIEN,SEC,TRD,TPI,PIEN)=PTNAME
"RTN","SCRPPAT2",125,0)
 S PID=$P(PINF,"^",3),PID=$TR(PID,"-","")
"RTN","SCRPPAT2",126,0)
 S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),13)=PID ;ssn
"RTN","SCRPPAT2",127,0)
 S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),25)=$P(PINF,"^",4) ;means test status
"RTN","SCRPPAT2",128,0)
 S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),31)=$P(PINF,"^",5) ;eligibility
"RTN","SCRPPAT2",129,0)
 ;Removed by patch 174
"RTN","SCRPPAT2",130,0)
 ;S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),40)=$P(PINF,"^",6) ;patient status
"RTN","SCRPPAT2",131,0)
 S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),42)=$P(PINF,"^",8) ;last appt
"RTN","SCRPPAT2",132,0)
 S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),54)=$P(PINF,"^",9) ;nxt appt
"RTN","SCRPPAT2",133,0)
 S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),66)=$E(CNAME,1,15) ;clinic
"RTN","SCRPPAT2",134,0)
 Q
"RTN","SCRPPAT3")
0^10^B30801448^B30801721
"RTN","SCRPPAT3",1,0)
SCRPPAT3 ;ALB/CMM - Practitioner's Patients ; 8/30/99 3:14pm
"RTN","SCRPPAT3",2,0)
 ;;5.3;Scheduling;**41,52,148,174,181,177,297,526**;AUG 13, 1993;Build 8
"RTN","SCRPPAT3",3,0)
 ;
"RTN","SCRPPAT3",4,0)
 ;Listing of Practitioner's Patients
"RTN","SCRPPAT3",5,0)
 ;
"RTN","SCRPPAT3",6,0)
PAT(INS,SEC,TRD,SEC3,ST3,ST4,POS) ;
"RTN","SCRPPAT3",7,0)
 ;writes patients for position/practitioner
"RTN","SCRPPAT3",8,0)
 N PTN,PT,FIRST
"RTN","SCRPPAT3",9,0)
 S PTN="",FIRST=1
"RTN","SCRPPAT3",10,0)
 I SUMM D TOTAL1^SCRPPAT3(INS,SEC,TRD,POS) Q  ;Summary only
"RTN","SCRPPAT3",11,0)
 F  S PTN=$O(@STORE@("PT",INS,SEC,TRD,POS,PTN)) Q:PTN=""!(STOP)  D
"RTN","SCRPPAT3",12,0)
 .S PT=0
"RTN","SCRPPAT3",13,0)
 .F  S PT=$O(@STORE@("PT",INS,SEC,TRD,POS,PTN,PT)) Q:'PT!(STOP)  D
"RTN","SCRPPAT3",14,0)
 ..I (IOST'?1"C-".E),$Y>(IOSL-5) S MORE=0 D NEWP1^SCRPU3(.PAGE,TITL) D:'STOP HEAD2(INS,SEC,TRD,SEC3,ST3,ST4,POS) D:(('FIRST&'STOP)!($G(SORT)=3)) HEADER
"RTN","SCRPPAT3",15,0)
 ..I (IOST?1"C-".E),$Y>(IOSL-5) S MORE=0 D HOLD^SCRPU3(.PAGE,TITL) D:'STOP HEAD2(INS,SEC,TRD,SEC3,ST3,ST4,POS) D:'FIRST&'STOP HEADER
"RTN","SCRPPAT3",16,0)
 ..Q:STOP
"RTN","SCRPPAT3",17,0)
 ..I FIRST D HEADER S FIRST=0
"RTN","SCRPPAT3",18,0)
 ..W !,$G(@STORE@(INS,SEC,TRD,POS,PT)) ;print patient detail line
"RTN","SCRPPAT3",19,0)
 ..Q
"RTN","SCRPPAT3",20,0)
 .Q
"RTN","SCRPPAT3",21,0)
 Q
"RTN","SCRPPAT3",22,0)
 ;
"RTN","SCRPPAT3",23,0)
SPRINT(STORE,IOP,TITL,SORT) ; Summary Print Only
"RTN","SCRPPAT3",24,0)
 ;STORE - global location of data
"RTN","SCRPPAT3",25,0)
 ;IOP - device to print to
"RTN","SCRPPAT3",26,0)
 ;TITL - title of report
"RTN","SCRPPAT3",27,0)
 ;SORT - sort order 1-div,team,pract/2-div,pract,team
"RTN","SCRPPAT3",28,0)
 ;
"RTN","SCRPPAT3",29,0)
 N PAGE
"RTN","SCRPPAT3",30,0)
 S PAGE=1,STOP=0
"RTN","SCRPPAT3",31,0)
 D OPEN^SCRPU3
"RTN","SCRPPAT3",32,0)
 Q:$G(POP)
"RTN","SCRPPAT3",33,0)
 D TITLE^SCRPU3(.PAGE,TITL)
"RTN","SCRPPAT3",34,0)
 D CLOSE^SCRPU3
"RTN","SCRPPAT3",35,0)
 Q
"RTN","SCRPPAT3",36,0)
 ;
"RTN","SCRPPAT3",37,0)
TOTAL1(INS,SEC,TRD,POS) ;
"RTN","SCRPPAT3",38,0)
 ;print team/practitioner total
"RTN","SCRPPAT3",39,0)
 N TEM,PRC
"RTN","SCRPPAT3",40,0)
 I SORT=1 S TEM=SEC,PRC=TRD
"RTN","SCRPPAT3",41,0)
 I SORT=2!(SORT=3) S TEM=TRD,PRC=SEC
"RTN","SCRPPAT3",42,0)
 W !!,$G(@STORE@("TH",INS,PRC,TEM,POS)),$G(@STORE@("TOTAL",INS,PRC,TEM,POS))
"RTN","SCRPPAT3",43,0)
 Q
"RTN","SCRPPAT3",44,0)
 ;
"RTN","SCRPPAT3",45,0)
HEAD2(INS,SEC,TRD,SEC3,ST3,ST4,POS) ;
"RTN","SCRPPAT3",46,0)
 I (SEC3="""TN""")&($D(@ST4@(INS,TRD,SEC))) D
"RTN","SCRPPAT3",47,0)
 .W !,$G(@ST3@(INS,SEC)) ;write team (sort 1)
"RTN","SCRPPAT3",48,0)
 .W !,$G(@STORE@(INS))
"RTN","SCRPPAT3",49,0)
 .W !,$G(@ST4@(INS,TRD,SEC,POS)) ;write practitioner (sort 2)
"RTN","SCRPPAT3",50,0)
 .I $L($G(@STORE@("PN",INS,TRD,SEC,POS,"PRCP"))) W !,@STORE@("PN",INS,TRD,SEC,POS,"PRCP")
"RTN","SCRPPAT3",51,0)
 .W !
"RTN","SCRPPAT3",52,0)
 I (SEC3="""PN""")&($D(@ST3@(INS,SEC,TRD))) D
"RTN","SCRPPAT3",53,0)
 .W !,$G(@ST3@(INS,SEC,TRD,POS)) ;write practitioner (sort 1)
"RTN","SCRPPAT3",54,0)
 .I $G(SORT)'=3 I $L($G(@STORE@("PN",INS,SEC,TRD,POS,"PRCP"))) W !,@STORE@("PN",INS,SEC,TRD,POS,"PRCP")
"RTN","SCRPPAT3",55,0)
 .I $G(SORT)'=3 W !,$G(@ST4@(INS,TRD)) ;write team (sort 2)
"RTN","SCRPPAT3",56,0)
 .W !,$G(@STORE@(INS))
"RTN","SCRPPAT3",57,0)
 Q
"RTN","SCRPPAT3",58,0)
 ;
"RTN","SCRPPAT3",59,0)
HEADER ;
"RTN","SCRPPAT3",60,0)
 Q:$G(MORE)
"RTN","SCRPPAT3",61,0)
 I SORT=3 S MORE=1
"RTN","SCRPPAT3",62,0)
 N NXT
"RTN","SCRPPAT3",63,0)
 F NXT="H1","H2","H3" W !,$G(@STORE@(NXT))
"RTN","SCRPPAT3",64,0)
 W !
"RTN","SCRPPAT3",65,0)
 Q
"RTN","SCRPPAT3",66,0)
 ;
"RTN","SCRPPAT3",67,0)
SHEAD ;
"RTN","SCRPPAT3",68,0)
 S @STORE@("H2")="Pt Name"
"RTN","SCRPPAT3",69,0)
 S $E(@STORE@("H2"),15)="Pt ID"
"RTN","SCRPPAT3",70,0)
 S $E(@STORE@("H1"),25)="M.T."
"RTN","SCRPPAT3",71,0)
 S $E(@STORE@("H2"),25)="Stat"
"RTN","SCRPPAT3",72,0)
 S $E(@STORE@("H1"),31)="Prim"
"RTN","SCRPPAT3",73,0)
 S $E(@STORE@("H2"),31)="Elig"
"RTN","SCRPPAT3",74,0)
 ;Removed by patch 174
"RTN","SCRPPAT3",75,0)
 ;S $E(@STORE@("H1"),39)="Pat"
"RTN","SCRPPAT3",76,0)
 ;S $E(@STORE@("H2"),39)="Stat"
"RTN","SCRPPAT3",77,0)
 S $E(@STORE@("H1"),42)="Last"
"RTN","SCRPPAT3",78,0)
 S $E(@STORE@("H2"),42)="Appt"
"RTN","SCRPPAT3",79,0)
 S $E(@STORE@("H1"),54)="Next"
"RTN","SCRPPAT3",80,0)
 S $E(@STORE@("H2"),54)="Appt"
"RTN","SCRPPAT3",81,0)
 S $E(@STORE@("H2"),66)="Clinic"
"RTN","SCRPPAT3",82,0)
 S $P(@STORE@("H3"),"=",81)=""
"RTN","SCRPPAT3",83,0)
 Q
"RTN","SCRPPAT3",84,0)
ALL ;
"RTN","SCRPPAT3",85,0)
 ;get all practitioners for all teams selected
"RTN","SCRPPAT3",86,0)
 I TEAM=1 D TALL ;all teams selected
"RTN","SCRPPAT3",87,0)
 N TIEN,OKAY,XLIST,YLIST,SCTP,SCI,SCDT
"RTN","SCRPPAT3",88,0)
 S TIEN=""
"RTN","SCRPPAT3",89,0)
 F  S TIEN=$O(TEAM(TIEN)) Q:TIEN=""!(TIEN'?.N)  D
"RTN","SCRPPAT3",90,0)
 .I $D(TEAM(TIEN)) D
"RTN","SCRPPAT3",91,0)
 ..K XLIST
"RTN","SCRPPAT3",92,0)
 ..S OKAY=$$TPTM^SCAPMC(TIEN,"","","","XLIST","ERROR")
"RTN","SCRPPAT3",93,0)
 ..S SCTP=0 F  S SCTP=$O(XLIST("SCTP",TIEN,SCTP)) Q:'SCTP  D
"RTN","SCRPPAT3",94,0)
 ...K YLIST S SCDT="SCDT",(SCDT("BEGIN"),SCDT("END"))=DT,SCDT("INCL")=0
"RTN","SCRPPAT3",95,0)
 ...S OKAY=$$PRTP^SCAPMC(SCTP,.SCDT,"YLIST","ERROR",1,0)
"RTN","SCRPPAT3",96,0)
 ...S SCI=0 F  S SCI=$O(YLIST(SCI)) Q:'SCI  D
"RTN","SCRPPAT3",97,0)
 ....S @TPRC@(0)=$G(@TPRC@(0))+1
"RTN","SCRPPAT3",98,0)
 ....S @TPRC@(@TPRC@(0))=YLIST(SCI)
"RTN","SCRPPAT3",99,0)
 Q
"RTN","SCRPPAT3",100,0)
 ;
"RTN","SCRPPAT3",101,0)
TALL ;
"RTN","SCRPPAT3",102,0)
 ;get all active team for divisions selected
"RTN","SCRPPAT3",103,0)
 N NXT,IIEN,NODE
"RTN","SCRPPAT3",104,0)
 S NXT=0,IIEN=""
"RTN","SCRPPAT3",105,0)
 ;$O through team file and find all active teams for selected divisions
"RTN","SCRPPAT3",106,0)
 F  S IIEN=$O(^SCTM(404.51,"AINST",IIEN)) Q:IIEN=""  D
"RTN","SCRPPAT3",107,0)
 .I INST=1!$D(INST(IIEN)) D
"RTN","SCRPPAT3",108,0)
 ..S TIEN=0
"RTN","SCRPPAT3",109,0)
 ..F  S TIEN=$O(^SCTM(404.51,"AINST",IIEN,TIEN)) Q:TIEN=""  D
"RTN","SCRPPAT3",110,0)
 ...I $$ACTTM^SCMCTMU(TIEN) S TEAM(TIEN)=""
"RTN","SCRPPAT3",111,0)
 Q
"RTN","SCRPPAT3",112,0)
 ;
"RTN","SCRPPAT3",113,0)
SETUP(IIEN,INAME,TIEN,TNAME,PRAC,PNAME,POSN,TPI,PRCP) ;
"RTN","SCRPPAT3",114,0)
 ;setup data
"RTN","SCRPPAT3",115,0)
 S IIEN=+$P($G(^SCTM(404.51,TIEN,0)),"^",7) ;institution ien
"RTN","SCRPPAT3",116,0)
 S INAME=$P($G(^DIC(4,IIEN,0)),"^") ;institution name
"RTN","SCRPPAT3",117,0)
 I INAME="" S INAME="[BAD DATA]"
"RTN","SCRPPAT3",118,0)
 ;
"RTN","SCRPPAT3",119,0)
 I PNAME="" S PNAME="[BAD DATA]"
"RTN","SCRPPAT3",120,0)
 I TNAME="" S TNAME="[BAD DATA]"
"RTN","SCRPPAT3",121,0)
 I $G(SORT)=3 S IIEN=1,TIEN=1
"RTN","SCRPPAT3",122,0)
 I '$D(@STORE@("PN",IIEN,PRAC,TIEN,TPI)) S @STORE@("PN",IIEN,PRAC,TIEN,TPI)="Practitioner: "_PNAME_$S(SORT=3:"",1:" ("_POSN_")")
"RTN","SCRPPAT3",123,0)
 I $L(PRCP) S @STORE@("PN",IIEN,PRAC,TIEN,TPI,"PRCP")="   Preceptor: "_PRCP
"RTN","SCRPPAT3",124,0)
 I '$D(@STORE@("TN",IIEN,$S($G(SORT)=3:1,1:TIEN))) S @STORE@("TN",IIEN,$S($G(SORT)=3:1,1:TIEN))="        Team: "_TNAME
"RTN","SCRPPAT3",125,0)
 ;
"RTN","SCRPPAT3",126,0)
 I '$D(@STORE@("I",$S($G(SORT)=3:"S3",1:INAME),IIEN)) S @STORE@("I",$S($G(SORT)=3:"S3",1:INAME),IIEN)="",@STORE@(IIEN)=$S(SORT=3:"",1:"    Division: "_INAME)
"RTN","SCRPPAT3",127,0)
 S @STORE@("T",IIEN,$S($G(SORT)=3:"T3",1:TNAME),$S($G(SORT)=3:1,1:TIEN))=""
"RTN","SCRPPAT3",128,0)
 I '$D(@STORE@("P",IIEN,PNAME,PRAC,TPI)) S @STORE@("P",IIEN,PNAME,PRAC,TPI)=""
"RTN","SCRPPAT3",129,0)
 I '$D(@STORE@("TOTAL",IIEN,PRAC,0)) S @STORE@("TOTAL",IIEN,PRAC,0)=0
"RTN","SCRPPAT3",130,0)
 I '$D(@STORE@("TOTAL",IIEN,PRAC,TIEN)) S @STORE@("TOTAL",IIEN,PRAC,TIEN)=0
"RTN","SCRPPAT3",131,0)
 ;
"RTN","SCRPPAT3",132,0)
 S @STORE@("TH",IIEN,PRAC)="Patient Count for "_PNAME_": "
"RTN","SCRPPAT3",133,0)
 S @STORE@("TH",IIEN,PRAC,TIEN,TPI)="Patient Count for "_PNAME_": "
"RTN","SCRPPAT3",134,0)
 N SCX
"RTN","SCRPPAT3",135,0)
 S SCX=$E(PNAME,1,22),$E(SCX,25)=$E(POSN,1,22),$E(SCX,49)=$E(TNAME,1,22)
"RTN","SCRPPAT3",136,0)
 S @STORE@("SUM0",IIEN,PRAC,TIEN,TPI)=SCX
"RTN","SCRPPAT3",137,0)
 ;
"RTN","SCRPPAT3",138,0)
 S @STORE@("TH",IIEN)="** Note: Patient Panel Count is a count of unique patients for each practitioner"
"RTN","SCRPPAT3",139,0)
 Q 0
"RTN","SCRPTA")
0^5^B26295531^B26294838
"RTN","SCRPTA",1,0)
SCRPTA ;ALB/CMM - Patient Listing w/Team Assignment Data ; 29 Jun 99  04:11PM
"RTN","SCRPTA",2,0)
 ;;5.3;Scheduling;**41,48,52,114,174,181,177,526**;AUG 13, 1993;Build 8
"RTN","SCRPTA",3,0)
 ;
"RTN","SCRPTA",4,0)
 ;Patient Listing w/Team Assignment Data Report
"RTN","SCRPTA",5,0)
 ;
"RTN","SCRPTA",6,0)
PROMPTS ;
"RTN","SCRPTA",7,0)
 ;Prompt for Institution, Team, Role, Practitioner and Print device
"RTN","SCRPTA",8,0)
 ;
"RTN","SCRPTA",9,0)
 N PRNT,QTIME,NUMBER
"RTN","SCRPTA",10,0)
 K VAUTD,VAUTT,VAUTR,VAUTP,VAUTPP,SCUP
"RTN","SCRPTA",11,0)
 S QTIME=""
"RTN","SCRPTA",12,0)
 W ! D INST^SCRPU1 I Y=-1 G ERR
"RTN","SCRPTA",13,0)
 W ! K Y D PRMTT^SCRPU1 I '$D(VAUTT) G ERR
"RTN","SCRPTA",14,0)
 W ! K Y D ROLE^SCRPU1 I '$D(VAUTR) G ERR
"RTN","SCRPTA",15,0)
 W ! K Y S VAUTPP="" D PRACT^SCRPU1 K VAUTPP I '$D(VAUTP) G ERR
"RTN","SCRPTA",16,0)
 W !!,"This report requires 132 column output!"
"RTN","SCRPTA",17,0)
 D QUE(.VAUTD,.VAUTT,.VAUTR,.VAUTP) Q 
"RTN","SCRPTA",18,0)
 ;
"RTN","SCRPTA",19,0)
QUE(INST,TEAM,ROLE,PRACT) ; 
"RTN","SCRPTA",20,0)
 ;Input Parameters: 
"RTN","SCRPTA",21,0)
 ;INST - institutions selected (variable and array) 
"RTN","SCRPTA",22,0)
 ;TEAM - teams selected (variable and array) 
"RTN","SCRPTA",23,0)
 ;ROLE - roles selected (variable and array) 
"RTN","SCRPTA",24,0)
 ;PRACT - practitioners selected (variable and array) 
"RTN","SCRPTA",25,0)
 N ZTSAVE,II
"RTN","SCRPTA",26,0)
 F II="INST","TEAM","ROLE","INST(","TEAM(","PRACT","PRACT(","ROLE(" S ZTSAVE(II)=""
"RTN","SCRPTA",27,0)
 W ! D EN^XUTMDEVQ("QENTRY^SCRPTA","Patient Listing for Team Assignments",.ZTSAVE)
"RTN","SCRPTA",28,0)
 Q
"RTN","SCRPTA",29,0)
 ;
"RTN","SCRPTA",30,0)
ENTRY2(INST,TEAM,ROLE,PRACT,IOP,ZTDTH) ;
"RTN","SCRPTA",31,0)
 ;Second entry point for GUI to use
"RTN","SCRPTA",32,0)
 ;Input Parameters:
"RTN","SCRPTA",33,0)
 ;INST - institutions selected (variable and array)
"RTN","SCRPTA",34,0)
 ;TEAM - teams selected (variable and array)
"RTN","SCRPTA",35,0)
 ;ROLE - roles selected (variable and array)
"RTN","SCRPTA",36,0)
 ;PRACT - practitioners selected (variable and array)
"RTN","SCRPTA",37,0)
 ;IOP - print device
"RTN","SCRPTA",38,0)
 ;ZTDTH - queue time (optional)
"RTN","SCRPTA",39,0)
 ;
"RTN","SCRPTA",40,0)
 ;validate parameters
"RTN","SCRPTA",41,0)
 I '$D(INST)!'$D(TEAM)!'$D(ROLE)!'$D(PRACT)!'$D(IOP)!(IOP="") Q
"RTN","SCRPTA",42,0)
 ;
"RTN","SCRPTA",43,0)
 N NUMBER
"RTN","SCRPTA",44,0)
 S IOST=$P(IOP,"^",2),IOP=$P(IOP,"^")
"RTN","SCRPTA",45,0)
 I IOP?1"Q;".E S IOP=$P(IOP,"Q;",2)
"RTN","SCRPTA",46,0)
 I IOST?1"C-".E D QENTRY G RET
"RTN","SCRPTA",47,0)
 I ZTDTH="" S ZTDTH=$H
"RTN","SCRPTA",48,0)
 S ZTRTN="QENTRY^SCRPTA"
"RTN","SCRPTA",49,0)
 S ZTDESC="Patient Listing w/Team Assignment",ZTIO=IOP
"RTN","SCRPTA",50,0)
 N II
"RTN","SCRPTA",51,0)
 F II="INST","TEAM","ROLE","INST(","TEAM(","PRACT","PRACT(","ROLE(","IOP" S ZTSAVE(II)=""
"RTN","SCRPTA",52,0)
 D ^%ZTLOAD
"RTN","SCRPTA",53,0)
RET S NUMBER=0
"RTN","SCRPTA",54,0)
 I $D(ZTSK) S NUMBER=ZTSK
"RTN","SCRPTA",55,0)
 D EXIT1
"RTN","SCRPTA",56,0)
 Q NUMBER
"RTN","SCRPTA",57,0)
 ;
"RTN","SCRPTA",58,0)
QENTRY ;
"RTN","SCRPTA",59,0)
 ;driver entry point
"RTN","SCRPTA",60,0)
 S TITL="Patient Listing For Team Assignments"
"RTN","SCRPTA",61,0)
 S STORE="^TMP("_$J_",""SCRPTA"")"
"RTN","SCRPTA",62,0)
 K @STORE
"RTN","SCRPTA",63,0)
 S @STORE=0
"RTN","SCRPTA",64,0)
 I TEAM=1 D TALL^SCRPPAT3 S TEAM=0
"RTN","SCRPTA",65,0)
 D FIND
"RTN","SCRPTA",66,0)
 I $O(@STORE@(0))="" S NODATA=$$NODATA^SCRPU3(TITL)
"RTN","SCRPTA",67,0)
 I '$D(NODATA) D PRINTIT(STORE,TITL)
"RTN","SCRPTA",68,0)
 D EXIT2
"RTN","SCRPTA",69,0)
 Q
"RTN","SCRPTA",70,0)
 ;
"RTN","SCRPTA",71,0)
ERR ;
"RTN","SCRPTA",72,0)
EXIT1 ;
"RTN","SCRPTA",73,0)
 K ZTDTH,ZTRTN,ZTDESC,ZTSK,ZTIO,ZTSAVE,Y,SCUP
"RTN","SCRPTA",74,0)
 Q
"RTN","SCRPTA",75,0)
 ;
"RTN","SCRPTA",76,0)
EXIT2 ;
"RTN","SCRPTA",77,0)
 K @STORE
"RTN","SCRPTA",78,0)
 K STOP,STORE,TITL,IOP,TEAM,INST,ROLE,NODATA,PRACT
"RTN","SCRPTA",79,0)
 Q
"RTN","SCRPTA",80,0)
 ;
"RTN","SCRPTA",81,0)
FIND ;
"RTN","SCRPTA",82,0)
 N NXT,TLIST,TERR,CNT,ERR1,TNODE,NODE1,PIEN,PTAIEN
"RTN","SCRPTA",83,0)
 S NXT=0,TLIST="^TMP("_$J_",""SCRPTA"",""LIST1"")",TERR="ERR1"
"RTN","SCRPTA",84,0)
 K @TLIST,@TERR
"RTN","SCRPTA",85,0)
 F  S NXT=$O(TEAM(NXT)) Q:NXT=""!(NXT'?.N)  D
"RTN","SCRPTA",86,0)
 .S ERR1=$$PTTM^SCAPMC2(NXT,,.TLIST,.TERR) ;Patients assigned to team NXT
"RTN","SCRPTA",87,0)
 .Q:ERR1=0
"RTN","SCRPTA",88,0)
 .S CNT=0
"RTN","SCRPTA",89,0)
 .F  S CNT=$O(@TLIST@(CNT)) Q:CNT=""!(CNT'?.N)  D
"RTN","SCRPTA",90,0)
 ..S TNODE=$G(@TLIST@(CNT))
"RTN","SCRPTA",91,0)
 ..Q:TNODE=""
"RTN","SCRPTA",92,0)
 ..S PIEN=+$P(TNODE,"^") ;patient ien
"RTN","SCRPTA",93,0)
 ..S PTAIEN=+$P(TNODE,"^",3) ;ien Patient Team Assignment #404.42
"RTN","SCRPTA",94,0)
 ..D CHK^SCRPTA2(PTAIEN,PIEN)
"RTN","SCRPTA",95,0)
 .K @TLIST,@TERR
"RTN","SCRPTA",96,0)
 K @TLIST,@TERR
"RTN","SCRPTA",97,0)
 Q
"RTN","SCRPTA",98,0)
 ;
"RTN","SCRPTA",99,0)
PRINTIT(STORE,TITL) ;
"RTN","SCRPTA",100,0)
 N NXT,PAGE,NPAGE,INTN,TMN,INT,TM,PRN,PR,POS
"RTN","SCRPTA",101,0)
 S (NPAGE,STOP,PAGE)=0,INTN="" W:$E(IOST)="C" @IOF
"RTN","SCRPTA",102,0)
 D SHEAD ;setup headers
"RTN","SCRPTA",103,0)
 F  S INTN=$O(@STORE@("I",INTN)) Q:INTN=""!(STOP)  D
"RTN","SCRPTA",104,0)
 .S INT=$O(@STORE@("I",INTN,"")) ;institution
"RTN","SCRPTA",105,0)
 .Q:INT=""
"RTN","SCRPTA",106,0)
 .S TMN=""
"RTN","SCRPTA",107,0)
 .F  S TMN=$O(@STORE@("T",INT,TMN)) Q:TMN=""!(STOP)  D
"RTN","SCRPTA",108,0)
 ..S TM=$O(@STORE@("T",INT,TMN,"")) ;team
"RTN","SCRPTA",109,0)
 ..Q:TM=""
"RTN","SCRPTA",110,0)
 ..D NEWP1^SCRPU3(.PAGE,TITL,132) W !,$G(@STORE@(INT)),!!,$G(@STORE@(INT,TM))
"RTN","SCRPTA",111,0)
 ..Q:STOP
"RTN","SCRPTA",112,0)
 ..S PRN=""
"RTN","SCRPTA",113,0)
 ..D HEADER
"RTN","SCRPTA",114,0)
 ..F  S PRN=$O(@STORE@("P",INT,TM,PRN)) Q:PRN=""!(STOP)  D
"RTN","SCRPTA",115,0)
 ...S PR=$O(@STORE@("P",INT,TM,PRN,"")) ;practitioner
"RTN","SCRPTA",116,0)
 ...Q:PR=""
"RTN","SCRPTA",117,0)
 ...S POS=""
"RTN","SCRPTA",118,0)
 ...F  S POS=$O(@STORE@("P",INT,TM,PRN,PR,POS)) Q:POS=""!(STOP)  D
"RTN","SCRPTA",119,0)
 ....D PRNT(INT,TM,PR,POS)
"RTN","SCRPTA",120,0)
 I 'STOP,$E(IOST)="C" N DIR S DIR(0)="E" W ! D ^DIR
"RTN","SCRPTA",121,0)
 Q
"RTN","SCRPTA",122,0)
 ;
"RTN","SCRPTA",123,0)
PRNT(INT,TM,PR,POS) ;
"RTN","SCRPTA",124,0)
 ;INT - institution ien
"RTN","SCRPTA",125,0)
 ;TM - team ien
"RTN","SCRPTA",126,0)
 ;PR - practitioner ien
"RTN","SCRPTA",127,0)
 ;POS - position ien
"RTN","SCRPTA",128,0)
 ;
"RTN","SCRPTA",129,0)
 N PTIEN,PTNAME
"RTN","SCRPTA",130,0)
 S PTNAME=""
"RTN","SCRPTA",131,0)
 F  S PTNAME=$O(@STORE@(INT,TM,PR,POS,PTNAME)) Q:PTNAME=""!(STOP)  D
"RTN","SCRPTA",132,0)
 .S PTIEN=""
"RTN","SCRPTA",133,0)
 .F  S PTIEN=$O(@STORE@(INT,TM,PR,POS,PTNAME,PTIEN)) Q:PTIEN=""!(STOP)  D
"RTN","SCRPTA",134,0)
 ..I (IOST'?1"C-".E),$Y>(IOSL-4) D NEWP1^SCRPU3(.PAGE,TITL,132) W:'STOP !,$G(@STORE@(INT)),!!,$G(@STORE@(INT,TM)) D:'STOP HEADER
"RTN","SCRPTA",135,0)
 ..I (IOST?1"C-".E),$Y>(IOSL-4) D HOLD^SCRPU3(.PAGE,TITL,132) W:'STOP !,$G(@STORE@(INT)),!!,$G(@STORE@(INT,TM)) D:'STOP HEADER
"RTN","SCRPTA",136,0)
 ..Q:STOP
"RTN","SCRPTA",137,0)
 ..W !,$G(@STORE@(INT,TM,PR,POS,PTNAME,PTIEN))
"RTN","SCRPTA",138,0)
 .Q
"RTN","SCRPTA",139,0)
 Q
"RTN","SCRPTA",140,0)
 ;
"RTN","SCRPTA",141,0)
HEADER ;
"RTN","SCRPTA",142,0)
 ;write column headers
"RTN","SCRPTA",143,0)
 N EN
"RTN","SCRPTA",144,0)
 W !
"RTN","SCRPTA",145,0)
 F EN="H1","H2","H3" D
"RTN","SCRPTA",146,0)
 .W !,$G(@STORE@(EN))
"RTN","SCRPTA",147,0)
 Q
"RTN","SCRPTA",148,0)
SHEAD ;
"RTN","SCRPTA",149,0)
 ;setup column headers
"RTN","SCRPTA",150,0)
 S @STORE@("H2")="Patient Name"
"RTN","SCRPTA",151,0)
 S $E(@STORE@("H2"),19)="Pt ID"
"RTN","SCRPTA",152,0)
 S $E(@STORE@("H1"),31)="Date"
"RTN","SCRPTA",153,0)
 S $E(@STORE@("H2"),31)="Assigned"
"RTN","SCRPTA",154,0)
 S $E(@STORE@("H2"),43)="PC?"
"RTN","SCRPTA",155,0)
 S $E(@STORE@("H2"),49)="Practitioner"
"RTN","SCRPTA",156,0)
 S $E(@STORE@("H2"),70)="Position"
"RTN","SCRPTA",157,0)
 S $E(@STORE@("H2"),92)="Standard Role"
"RTN","SCRPTA",158,0)
 S $E(@STORE@("H2"),113)="Preceptor"
"RTN","SCRPTA",159,0)
 S $P(@STORE@("H3"),"=",133)=""
"RTN","SCRPTA",160,0)
 Q
"RTN","SCRPTA2")
0^6^B29432244^B30465773
"RTN","SCRPTA2",1,0)
SCRPTA2 ;ALB/CMM - Patient Listing w/Team Assignment Data ; 30 Jun 99  1:33 PM
"RTN","SCRPTA2",2,0)
 ;;5.3;Scheduling;**41,88,140,148,174,181,177,526**;AUG 13, 1993;Build 8
"RTN","SCRPTA2",3,0)
 ;
"RTN","SCRPTA2",4,0)
 ;Patient Listing w/Team Assignment Data Report continued
"RTN","SCRPTA2",5,0)
 ;
"RTN","SCRPTA2",6,0)
CHK(PTIEN,PIEN) ;assigned to a position
"RTN","SCRPTA2",7,0)
 ;PTIEN - ien of 404.42 Patient Team Assignment file
"RTN","SCRPTA2",8,0)
 ;PIEN - ien of patient file #2
"RTN","SCRPTA2",9,0)
 ;
"RTN","SCRPTA2",10,0)
 N NODE,START,TPIEN,TPNODE,ROL,PRAC,ROLN,PCAP,PRCN
"RTN","SCRPTA2",11,0)
 S START=""
"RTN","SCRPTA2",12,0)
 Q:'$D(^SCPT(404.43,"B",PTIEN))&(PRACT'="")
"RTN","SCRPTA2",13,0)
 I '$D(^SCPT(404.43,"B",PTIEN))&(PRACT="") D NOTA(PTIEN,PIEN) Q
"RTN","SCRPTA2",14,0)
 F  S START=$O(^SCPT(404.43,"B",PTIEN,START)) Q:START=""  D
"RTN","SCRPTA2",15,0)
 .S NODE=$G(^SCPT(404.43,START,0))
"RTN","SCRPTA2",16,0)
 .Q:NODE=""
"RTN","SCRPTA2",17,0)
 .Q:($P(NODE,"^",4)'="")&($P(NODE,"^",4)<DT)
"RTN","SCRPTA2",18,0)
 .; ^ not assigned currently
"RTN","SCRPTA2",19,0)
 .S PCAP=+$P(NODE,U,5)
"RTN","SCRPTA2",20,0)
 .S TPIEN=+$P(NODE,"^",2) ;team position ien (404.57)
"RTN","SCRPTA2",21,0)
 .I '$D(^SCTM(404.57,TPIEN,0)) D NOTA(PTIEN,PIEN) Q
"RTN","SCRPTA2",22,0)
 .S TPNODE=$G(^SCTM(404.57,TPIEN,0))
"RTN","SCRPTA2",23,0)
 .I TPNODE="" D NOTA(PTIEN,PIEN) Q
"RTN","SCRPTA2",24,0)
 .S PCAP=$S('PCAP:"NPC",+$$OKPREC3^SCMCLK(TPIEN,DT)>0:" AP",1:"PCP") ; PC?
"RTN","SCRPTA2",25,0)
 .S PRCN=$P($$OKPREC2^SCMCLK(TPIEN,DT),U,2)  ;preceptor name
"RTN","SCRPTA2",26,0)
 .;
"RTN","SCRPTA2",27,0)
 .S ROL=+$P(TPNODE,"^",3) ;role for position (ien)
"RTN","SCRPTA2",28,0)
 .Q:'$D(ROLE(ROL))&(ROLE'=1)  ;not a selected role
"RTN","SCRPTA2",29,0)
 .S ROLN=$P($G(^SD(403.46,ROL,0)),U) ;role name
"RTN","SCRPTA2",30,0)
 .;
"RTN","SCRPTA2",31,0)
 .S PRAC=$$PRACI(TPIEN) ;practitioner information
"RTN","SCRPTA2",32,0)
 .I +PRAC=-1 D NOTA(PTIEN,PIEN) Q
"RTN","SCRPTA2",33,0)
 .I (PRACT'=1)&('$D(PRACT(+PRAC)))&(+PRAC'=0) Q
"RTN","SCRPTA2",34,0)
 .; ^ not a selected practitioner
"RTN","SCRPTA2",35,0)
 .;
"RTN","SCRPTA2",36,0)
 .S POS=$P($G(^SCTM(404.57,TPIEN,0)),"^")
"RTN","SCRPTA2",37,0)
 .D FOUND2(START,NODE,TPIEN,POS,TPNODE,PRAC,PIEN,ROLN,PCAP,PRCN)
"RTN","SCRPTA2",38,0)
 Q
"RTN","SCRPTA2",39,0)
PRACI(TPIEN) ;
"RTN","SCRPTA2",40,0)
 ;TPIEN - team position ien (404.57)
"RTN","SCRPTA2",41,0)
 ;
"RTN","SCRPTA2",42,0)
 N EN,TPLIST,TPERR,NAME,POS,ERR,NPIEN,NODE,POSIEN
"RTN","SCRPTA2",43,0)
 S TPLIST="TPLST",TPERR="ERR2"
"RTN","SCRPTA2",44,0)
 K @TPLIST,@TPERR
"RTN","SCRPTA2",45,0)
 S ERR=$$PRTP^SCAPMC8(TPIEN,,.TPLIST,.TPERR)
"RTN","SCRPTA2",46,0)
 Q:ERR=0!($D(@TPERR)) -1
"RTN","SCRPTA2",47,0)
 S NODE=$G(@TPLIST@(1))
"RTN","SCRPTA2",48,0)
 Q:NODE="" "0^[Not Assigned]"
"RTN","SCRPTA2",49,0)
 S NAME=$P(NODE,"^",2) ;practitioner name
"RTN","SCRPTA2",50,0)
 S NPIEN=+$P(NODE,"^") ;practitioner ien
"RTN","SCRPTA2",51,0)
 S POS=$P(NODE,"^",4) ;position name
"RTN","SCRPTA2",52,0)
 S POSIEN=+$P(NODE,"^",3) ;position ien
"RTN","SCRPTA2",53,0)
 I POS="" S POS="[Not Assigned]",POSIEN=0
"RTN","SCRPTA2",54,0)
 I NAME="" S NAME="[Not Assigned]",NPIEN=0
"RTN","SCRPTA2",55,0)
 K @TPLIST,@TPERR
"RTN","SCRPTA2",56,0)
 Q NPIEN_"^"_NAME_"^"_POS_"^"_POSIEN
"RTN","SCRPTA2",57,0)
 ;
"RTN","SCRPTA2",58,0)
FOUND2(START,NODE,TPIEN,POS,TPNODE,PRAC,PIEN,ROLN,PCAP,PRCN) ;
"RTN","SCRPTA2",59,0)
 ;START - patient team assignment position ien
"RTN","SCRPTA2",60,0)
 ;NODE - patient team position assignment node
"RTN","SCRPTA2",61,0)
 ;TPIEN - team position ien (404.57)
"RTN","SCRPTA2",62,0)
 ;POS - team position
"RTN","SCRPTA2",63,0)
 ;TPNODE - team position node (404.57)
"RTN","SCRPTA2",64,0)
 ;PRAC - practitioner info. NAME IEN^NAME^POS^POSIEN
"RTN","SCRPTA2",65,0)
 ;ROLN - role name 
"RTN","SCRPTA2",66,0)
 ;PCAP - PC/AP/NPC assignment?
"RTN","SCRPTA2",67,0)
 ;PRCN - preceptor name
"RTN","SCRPTA2",68,0)
 ;
"RTN","SCRPTA2",69,0)
 N PTNAME,PID,ADATE
"RTN","SCRPTA2",70,0)
 S PTNAME=$P($G(^DPT(PIEN,0)),"^") ;patient name
"RTN","SCRPTA2",71,0)
 S PID=$P($G(^DPT(PIEN,.36)),"^",3),PID=$TR(PID,"-","")
"RTN","SCRPTA2",72,0)
 ;9 digit ssn SD*5.3*526 - dmr
"RTN","SCRPTA2",73,0)
 ;S PID=$E(PID,6,10) ;last four pid include 5th for pseudo notation
"RTN","SCRPTA2",74,0)
 ;
"RTN","SCRPTA2",75,0)
 S ADATE=$P(NODE,"^",3) ;position assignment date - fm format
"RTN","SCRPTA2",76,0)
 ;convert to external format
"RTN","SCRPTA2",77,0)
 I ADATE'="" S ADATE=$TR($$FMTE^XLFDT(ADATE,"5DF")," ","0")
"RTN","SCRPTA2",78,0)
 ;
"RTN","SCRPTA2",79,0)
 S PNAME=$P(PRAC,"^",2) ;practitioner name
"RTN","SCRPTA2",80,0)
 S PNIEN=$P(PRAC,"^") ;practitioner ien
"RTN","SCRPTA2",81,0)
 ;
"RTN","SCRPTA2",82,0)
 S TIEN=+$P(TPNODE,"^",2) ;ien team file 404.51
"RTN","SCRPTA2",83,0)
 S TMN=$G(^SCTM(404.51,TIEN,0))
"RTN","SCRPTA2",84,0)
 Q:TMN=""
"RTN","SCRPTA2",85,0)
 S TNAME=$P(TMN,"^") ;team name
"RTN","SCRPTA2",86,0)
 S PC=$P(TMN,"^",5) ;primary care team 1/0
"RTN","SCRPTA2",87,0)
 S IIEN=+$P(TMN,"^",7) ;institution ien
"RTN","SCRPTA2",88,0)
 S INAME=$P($G(^DIC(4,IIEN,0)),"^") ;institution
"RTN","SCRPTA2",89,0)
 ;
"RTN","SCRPTA2",90,0)
 D FORMAT(IIEN,INAME,TNAME,TIEN,PC,PTNAME,PID,PNAME,PNIEN,POS,TPIEN,ADATE,PIEN,ROLN,PCAP,PRCN)
"RTN","SCRPTA2",91,0)
 Q
"RTN","SCRPTA2",92,0)
 ;
"RTN","SCRPTA2",93,0)
FORMAT(IIEN,INAME,TNAME,TIEN,PC,PTNAME,PID,PNAME,PIEN,POS,TPIEN,ADATE,PTIEN,ROLN,PCAP,PRCN) ;
"RTN","SCRPTA2",94,0)
 ;IIEN - institution ien
"RTN","SCRPTA2",95,0)
 ;INAME - institution name
"RTN","SCRPTA2",96,0)
 ;TNAME - team name
"RTN","SCRPTA2",97,0)
 ;TIEN - team ien
"RTN","SCRPTA2",98,0)
 ;PC - primary care 1/0
"RTN","SCRPTA2",99,0)
 ;PTNAME - patient name
"RTN","SCRPTA2",100,0)
 ;PID - last 4 pid plus 5th pseudo
"RTN","SCRPTA2",101,0)
 ;PNAME - practitioner name
"RTN","SCRPTA2",102,0)
 ;PIEN - practitioner ien
"RTN","SCRPTA2",103,0)
 ;POS - position name
"RTN","SCRPTA2",104,0)
 ;TPIEN - position ien
"RTN","SCRPTA2",105,0)
 ;ADATE - assignment date
"RTN","SCRPTA2",106,0)
 ;PTIEN - patient ien
"RTN","SCRPTA2",107,0)
 ;ROLN - role name 
"RTN","SCRPTA2",108,0)
 ;PCAP - PC/AP/NPC assignment? 
"RTN","SCRPTA2",109,0)
 ;PRCN - preceptor name
"RTN","SCRPTA2",110,0)
 ;
"RTN","SCRPTA2",111,0)
 I INAME="" S INAME="[BAD DATA]"
"RTN","SCRPTA2",112,0)
 I TNAME="" S TNAME="[BAD DATA]"
"RTN","SCRPTA2",113,0)
 I PNAME="" S PNAME="[BAD DATA]"
"RTN","SCRPTA2",114,0)
 I '$D(@STORE@("I",INAME,IIEN)) S @STORE@("I",INAME,IIEN)=""
"RTN","SCRPTA2",115,0)
 I '$D(@STORE@("T",IIEN,TNAME,TIEN)) S @STORE@("T",IIEN,TNAME,TIEN)=""
"RTN","SCRPTA2",116,0)
 I '$D(@STORE@("P",IIEN,TIEN,PNAME,PIEN,TPIEN)) S @STORE@("P",IIEN,TIEN,PNAME,PIEN,TPIEN)=""
"RTN","SCRPTA2",117,0)
 S @STORE@(IIEN)="Division: "_INAME
"RTN","SCRPTA2",118,0)
 S @STORE@(IIEN,TIEN)="Team:  "_TNAME
"RTN","SCRPTA2",119,0)
 S $E(@STORE@(IIEN,TIEN),40)="Primary Care Team: "_$S(PC=1:"YES",1:"NO")
"RTN","SCRPTA2",120,0)
 ;
"RTN","SCRPTA2",121,0)
 S @STORE@(IIEN,TIEN,PIEN,TPIEN,PTNAME,PTIEN)=$E(PTNAME,1,17)
"RTN","SCRPTA2",122,0)
 S $E(@STORE@(IIEN,TIEN,PIEN,TPIEN,PTNAME,PTIEN),19)=PID
"RTN","SCRPTA2",123,0)
 S $E(@STORE@(IIEN,TIEN,PIEN,TPIEN,PTNAME,PTIEN),31)=ADATE
"RTN","SCRPTA2",124,0)
 S $E(@STORE@(IIEN,TIEN,PIEN,TPIEN,PTNAME,PTIEN),43)=PCAP
"RTN","SCRPTA2",125,0)
 S $E(@STORE@(IIEN,TIEN,PIEN,TPIEN,PTNAME,PTIEN),49)=$E(PNAME,1,21)
"RTN","SCRPTA2",126,0)
 S $E(@STORE@(IIEN,TIEN,PIEN,TPIEN,PTNAME,PTIEN),70)=$E(POS,1,20)
"RTN","SCRPTA2",127,0)
 S $E(@STORE@(IIEN,TIEN,PIEN,TPIEN,PTNAME,PTIEN),92)=$E(ROLN,1,20)
"RTN","SCRPTA2",128,0)
 S $E(@STORE@(IIEN,TIEN,PIEN,TPIEN,PTNAME,PTIEN),113)=$E(PRCN,1,20)
"RTN","SCRPTA2",129,0)
 Q
"RTN","SCRPTA2",130,0)
 ;
"RTN","SCRPTA2",131,0)
NOTA(PTIEN,PIEN) ;
"RTN","SCRPTA2",132,0)
 ;PTIEN - patient team assignment (#404.42)
"RTN","SCRPTA2",133,0)
 ;PIEN - patient ien
"RTN","SCRPTA2",134,0)
 N IIEN,INAME,TNAME,TIEN,PC,PTNAME,PID,PNAME,PNIEN,POSIEN,POS,TPIEN
"RTN","SCRPTA2",135,0)
 N ROLN,PCAP,PRCN,ADATE
"RTN","SCRPTA2",136,0)
 S POS="[Not Assigned]",POSIEN=0
"RTN","SCRPTA2",137,0)
 S PNAME="[Not Assigned]",PNIEN=0
"RTN","SCRPTA2",138,0)
 S (ROLN,PCAP,PRCN,ADATE)=""
"RTN","SCRPTA2",139,0)
 ;
"RTN","SCRPTA2",140,0)
 S PTNAME=$E($P($G(^DPT(PIEN,0)),"^"),1,20) ;patient name
"RTN","SCRPTA2",141,0)
 S PID=$P($G(^DPT(PIEN,.36)),"^",3),PID=$TR(PID,"-","")
"RTN","SCRPTA2",142,0)
 ;S PID=$E(PID,6,10) ;9 digit ssn patch 526
"RTN","SCRPTA2",143,0)
 ;
"RTN","SCRPTA2",144,0)
 S TIEN=+$P($G(^SCPT(404.42,PTIEN,0)),"^",3) ;team ien
"RTN","SCRPTA2",145,0)
 S TMN=$G(^SCTM(404.51,TIEN,0))
"RTN","SCRPTA2",146,0)
 Q:TMN=""
"RTN","SCRPTA2",147,0)
 S TNAME=$P(TMN,"^") ;team name
"RTN","SCRPTA2",148,0)
 S PC=$P(TMN,"^",5) ;primary care team 1/0
"RTN","SCRPTA2",149,0)
 S IIEN=+$P(TMN,"^",7) ;institution ien
"RTN","SCRPTA2",150,0)
 S INAME=$P($G(^DIC(4,IIEN,0)),"^") ;institution name
"RTN","SCRPTA2",151,0)
 ;
"RTN","SCRPTA2",152,0)
 D FORMAT(IIEN,INAME,TNAME,TIEN,PC,PTNAME,PID,PNAME,PNIEN,POS,POSIEN,ADATE,PIEN,ROLN,PCAP,PRCN)
"RTN","SCRPTA2",153,0)
 Q
"RTN","SCRPTP")
0^3^B26905186^B27026464
"RTN","SCRPTP",1,0)
SCRPTP ;ALB/CMM - List of Team's Patients ; 29 Jun 99  04:11PM
"RTN","SCRPTP",2,0)
 ;;5.3;Scheduling;**41,48,174,177,526**;AUG 13, 1993;Build 8
"RTN","SCRPTP",3,0)
 ;
"RTN","SCRPTP",4,0)
PROMPTS ;Prompt for Institution, Team, Role, Patient Status and Print device
"RTN","SCRPTP",5,0)
 N QTIME,PRNT,VAUTD,VAUTT,VAUTR,VAUTPS,NUMBER
"RTN","SCRPTP",6,0)
 K SCUP
"RTN","SCRPTP",7,0)
 S QTIME=""
"RTN","SCRPTP",8,0)
 W ! D INST^SCRPU1 I Y=-1 G ERR
"RTN","SCRPTP",9,0)
 W ! K Y D PRMTT^SCRPU1 I '$D(VAUTT) G ERR
"RTN","SCRPTP",10,0)
 W ! K Y D ROLE^SCRPU1 I '$D(VAUTR) G ERR
"RTN","SCRPTP",11,0)
 W ! K Y D PTSTAT^SCRPU2 I '$D(VAUTPS) G ERR
"RTN","SCRPTP",12,0)
 W ! K Y S SORT=$$SORT2^SCRPU2()
"RTN","SCRPTP",13,0)
 I SORT<1 G ERR
"RTN","SCRPTP",14,0)
 W !!,"This report requires 132 column output!"
"RTN","SCRPTP",15,0)
 D QUE(.VAUTD,.VAUTT,.VAUTR,VAUTPS,SORT) Q
"RTN","SCRPTP",16,0)
 ;
"RTN","SCRPTP",17,0)
QUE(INST,TEAM,ROLE,PSTAT,SORT,IOP,ZTDTH) ;queue report
"RTN","SCRPTP",18,0)
 ;INST - institutions selected (variable and array) 
"RTN","SCRPTP",19,0)
 ;TEAM - teams selected (variable and array) 
"RTN","SCRPTP",20,0)
 ;ROLE - roles selected (variable and array) 
"RTN","SCRPTP",21,0)
 ;PSTAT - patient status - 1=all or OPT or AC 
"RTN","SCRPTP",22,0)
 ;SORT - 1=d,t,ptname 2=d,t,Pt ID 3=d,t,pract,pt name 4=d,t,pract,Pt ID
"RTN","SCRPTP",23,0)
 N ZTSAVE,II
"RTN","SCRPTP",24,0)
 F II="INST","TEAM","ROLE","ROLE(","SORT","PSTAT","INST(","TEAM(" S ZTSAVE(II)=""
"RTN","SCRPTP",25,0)
 W ! D EN^XUTMDEVQ("QENTRY^SCRPTP","Team Patient Listing",.ZTSAVE)
"RTN","SCRPTP",26,0)
 Q
"RTN","SCRPTP",27,0)
 ;
"RTN","SCRPTP",28,0)
ENTRY2(INST,TEAM,ROLE,PSTAT,SORT,IOP,ZTDTH) ;Second entry point for GUI to use
"RTN","SCRPTP",29,0)
 ;INST - institutions selected (variable and array)
"RTN","SCRPTP",30,0)
 ;TEAM - teams selected (variable and array)
"RTN","SCRPTP",31,0)
 ;ROLE - roles selected (variable and array)
"RTN","SCRPTP",32,0)
 ;PSTAT - patient status - 1=all or OPT or AC
"RTN","SCRPTP",33,0)
 ;SORT - 1=d,t,ptname 2=d,t,Pt ID 3=d,t,pract,pt name 4=d,t,pract,Pt ID
"RTN","SCRPTP",34,0)
 ;IOP - print device
"RTN","SCRPTP",35,0)
 ;ZTDTH - queue time (optional)
"RTN","SCRPTP",36,0)
 ;
"RTN","SCRPTP",37,0)
 ;validate parameters
"RTN","SCRPTP",38,0)
 I '$D(INST)!'$D(TEAM)!'$D(ROLE)!'$D(PSTAT)!'$D(SORT)!'$D(IOP)!(IOP="") Q
"RTN","SCRPTP",39,0)
 N NUMBER
"RTN","SCRPTP",40,0)
 S IOST=$P(IOP,"^",2),IOP=$P(IOP,"^")
"RTN","SCRPTP",41,0)
 I IOP?1"Q;".E S IOP=$P(IOP,"Q;",2)
"RTN","SCRPTP",42,0)
 I IOST?1"C-".E D QENTRY G RET
"RTN","SCRPTP",43,0)
 I ZTDTH="" S ZTDTH=$H
"RTN","SCRPTP",44,0)
 S ZTRTN="QENTRY^SCRPTP"
"RTN","SCRPTP",45,0)
 S ZTDESC="List of Team's Patients",ZTIO=IOP
"RTN","SCRPTP",46,0)
 N II
"RTN","SCRPTP",47,0)
 F II="INST","TEAM","ROLE","ROLE(","SORT","PSTAT","INST(","TEAM(","IOP" S ZTSAVE(II)=""
"RTN","SCRPTP",48,0)
 D ^%ZTLOAD
"RTN","SCRPTP",49,0)
RET S NUMBER=0
"RTN","SCRPTP",50,0)
 I $D(ZTSK) S NUMBER=ZTSK
"RTN","SCRPTP",51,0)
 D EXIT1
"RTN","SCRPTP",52,0)
 Q NUMBER
"RTN","SCRPTP",53,0)
 ;
"RTN","SCRPTP",54,0)
QENTRY ;driver entry point
"RTN","SCRPTP",55,0)
 S TITL="Team Patient Listing",STORE="^TMP("_$J_",""SCRPTP"")"
"RTN","SCRPTP",56,0)
 K @STORE
"RTN","SCRPTP",57,0)
 S @STORE=0
"RTN","SCRPTP",58,0)
 D FIND
"RTN","SCRPTP",59,0)
 I $O(@STORE@(0))="" S NODATA=$$NODATA^SCRPU3(TITL)
"RTN","SCRPTP",60,0)
 I '$D(NODATA) D PRINTIT^SCRPTP2(STORE,TITL)
"RTN","SCRPTP",61,0)
 D EXIT2
"RTN","SCRPTP",62,0)
 Q
"RTN","SCRPTP",63,0)
ERR ;
"RTN","SCRPTP",64,0)
EXIT1 ;
"RTN","SCRPTP",65,0)
 K ZTDTH,ZTRTN,ZTDESC,ZTSK,ZTIO,ZTSAVE,SCUP
"RTN","SCRPTP",66,0)
 Q
"RTN","SCRPTP",67,0)
EXIT2 ;
"RTN","SCRPTP",68,0)
 K @STORE
"RTN","SCRPTP",69,0)
 K STOP,STORE,TITL,IOP,TEAM,INST,ROLE,PSTAT,SORT,NODATA
"RTN","SCRPTP",70,0)
 Q
"RTN","SCRPTP",71,0)
FIND ;
"RTN","SCRPTP",72,0)
 N TIEN,ERR,LIST,OKAY
"RTN","SCRPTP",73,0)
 I TEAM=1 D TALL^SCRPPAT3 ;gets all teams for all divisions selected
"RTN","SCRPTP",74,0)
 S TIEN="",LIST="^TMP("_$J_",""SCRPTP ARRAY"")",ERR="ERROR"
"RTN","SCRPTP",75,0)
 K @LIST,@ERR
"RTN","SCRPTP",76,0)
 F  S TIEN=$O(TEAM(TIEN)) Q:TIEN=""  D
"RTN","SCRPTP",77,0)
 .;TIEN - team ien
"RTN","SCRPTP",78,0)
 .S OKAY=$$PTTM^SCAPMC2(TIEN,"",LIST,ERR)
"RTN","SCRPTP",79,0)
 .; gets all patients for given team
"RTN","SCRPTP",80,0)
 .D HITS^SCRPTP3(LIST,TIEN)
"RTN","SCRPTP",81,0)
 .K @LIST,@ERR
"RTN","SCRPTP",82,0)
 K @LIST,@ERR
"RTN","SCRPTP",83,0)
 Q
"RTN","SCRPTP",84,0)
TINF(TIEN) ;team information
"RTN","SCRPTP",85,0)
 ;TIEN - team ien
"RTN","SCRPTP",86,0)
 ;returns: institution ien ^ team name ^ primary care ^ team phone
"RTN","SCRPTP",87,0)
 N PC,PHONE,TNODE,TNAME
"RTN","SCRPTP",88,0)
 S TNODE=$G(^SCTM(404.51,TIEN,0))
"RTN","SCRPTP",89,0)
 S TNAME=$P(TNODE,"^") ;team name
"RTN","SCRPTP",90,0)
 S PC=$S($P(TNODE,"^",5)=1:"YES",1:"NO") ;primary care team
"RTN","SCRPTP",91,0)
 S PHONE=$P(TNODE,"^",2) ;team phone
"RTN","SCRPTP",92,0)
 S INS=+$P(TNODE,"^",7) ;institution ien
"RTN","SCRPTP",93,0)
 D TDESC^SCRPITP2(TIEN,INS) ;gets team description
"RTN","SCRPTP",94,0)
 Q INS_"^"_TNAME_"^"_PC_"^"_PHONE
"RTN","SCRPTP",95,0)
 ;
"RTN","SCRPTP",96,0)
PST(PTIEN,CLIEN) ;
"RTN","SCRPTP",97,0)
 ;PTIEN - patient ien
"RTN","SCRPTP",98,0)
 ;CLIEN - associated clinic ien
"RTN","SCRPTP",99,0)
 ;returns 1=selected patient status, 0=not selected patient status
"RTN","SCRPTP",100,0)
 ;
"RTN","SCRPTP",101,0)
 N EN,NXT,FOUND,ENODE
"RTN","SCRPTP",102,0)
 S EN="",(FOUND,NXT)=0
"RTN","SCRPTP",103,0)
 Q:'$D(^DPT(PTIEN,"DE","B",CLIEN)) FOUND
"RTN","SCRPTP",104,0)
 S EN=$O(^DPT(PTIEN,"DE","B",CLIEN,""))
"RTN","SCRPTP",105,0)
 I EN=""&(PSTAT=1) S FOUND=1 Q FOUND
"RTN","SCRPTP",106,0)
 Q:EN=""!'$D(^DPT(PTIEN,"DE",EN,1)) FOUND
"RTN","SCRPTP",107,0)
 F  S NXT=$O(^DPT(PTIEN,"DE",EN,1,NXT)) Q:(FOUND)!(NXT="")!(NXT'?.N)  D
"RTN","SCRPTP",108,0)
 .;check if active enrollment
"RTN","SCRPTP",109,0)
 .S ENODE=$G(^DPT(PTIEN,"DE",EN,1,NXT,0))
"RTN","SCRPTP",110,0)
 .I $P(ENODE,"^",3)'="",$P(ENODE,"^",3)<DT+1!$P(ENODE,"^")>DT Q  ;not active enrollment
"RTN","SCRPTP",111,0)
 .;                      ^ discharge date     ^ enrollment date
"RTN","SCRPTP",112,0)
 .Q:$P(ENODE,"^",2)'=$E(PSTAT,1)&(PSTAT'=1)  ;not selected patient status
"RTN","SCRPTP",113,0)
 .S FOUND=1
"RTN","SCRPTP",114,0)
 Q FOUND
"RTN","SCRPTP",115,0)
 ;
"RTN","SCRPTP",116,0)
FORMAT(INS,TIEN,PTIEN,PTNAME,PID,PIEN,PNAME,CNAME,LAST,NEXT,ROLN,PCAP) ;Format column information
"RTN","SCRPTP",117,0)
 ;INS - Institution ien
"RTN","SCRPTP",118,0)
 ;TIEN - team ien
"RTN","SCRPTP",119,0)
 ;PTIEN - patient ien
"RTN","SCRPTP",120,0)
 ;PTNAME - patient name
"RTN","SCRPTP",121,0)
 ;PID -  SSN
"RTN","SCRPTP",122,0)
 ;PIEN - practitioner ien
"RTN","SCRPTP",123,0)
 ;PNAME - practitioner name
"RTN","SCRPTP",124,0)
 ;CNAME - clinic name
"RTN","SCRPTP",125,0)
 ;LAST - last appointment
"RTN","SCRPTP",126,0)
 ;NEXT - next appointment
"RTN","SCRPTP",127,0)
 ;ROLN - role name
"RTN","SCRPTP",128,0)
 ;PCAP - PC?
"RTN","SCRPTP",129,0)
 ;
"RTN","SCRPTP",130,0)
 N SEC,TRD
"RTN","SCRPTP",131,0)
 I PNAME="" S PNAME="[BAD DATA]"
"RTN","SCRPTP",132,0)
 I PTNAME="" S PTNAME="[BAD DATA]"
"RTN","SCRPTP",133,0)
 I PID="" S PID="*********"
"RTN","SCRPTP",134,0)
 S @STORE@("P",INS,TIEN,PNAME,PIEN)="" ;practitioner
"RTN","SCRPTP",135,0)
 S @STORE@("PT",INS,TIEN,PTNAME,PTIEN)="" ;patient
"RTN","SCRPTP",136,0)
 S @STORE@("PID",INS,TIEN,PID,PTIEN)=""
"RTN","SCRPTP",137,0)
 N TRD
"RTN","SCRPTP",138,0)
 I (SORT=1)!(SORT=2) S SEC=PTIEN,TRD=PIEN ;sort doesn't include practitioner
"RTN","SCRPTP",139,0)
 I (SORT=3)!(SORT=4) S SEC=PIEN,TRD=PTIEN ;sort includes practitioner
"RTN","SCRPTP",140,0)
 S @STORE@(INS,TIEN,SEC,TRD)=$E(PTNAME,1,15) ;patient name
"RTN","SCRPTP",141,0)
 S $E(@STORE@(INS,TIEN,SEC,TRD),18)=PID ;9 digit pid
"RTN","SCRPTP",142,0)
 S $E(@STORE@(INS,TIEN,SEC,TRD),32)=$E(PNAME,1,22) ;practitioner name
"RTN","SCRPTP",143,0)
 S $E(@STORE@(INS,TIEN,SEC,TRD),56)=$E($G(ROLN),1,22) ;role name
"RTN","SCRPTP",144,0)
 S $E(@STORE@(INS,TIEN,SEC,TRD),80)=$G(PCAP) ;PC?
"RTN","SCRPTP",145,0)
 S $E(@STORE@(INS,TIEN,SEC,TRD),85)=LAST ;last appointment
"RTN","SCRPTP",146,0)
 S $E(@STORE@(INS,TIEN,SEC,TRD),97)=NEXT ;next appointment
"RTN","SCRPTP",147,0)
 S $E(@STORE@(INS,TIEN,SEC,TRD),109)=$E(CNAME,1,24) ;clinic name
"RTN","SCRPTP",148,0)
 Q
"RTN","SCRPTP2")
0^4^B31636644^B31636333
"RTN","SCRPTP2",1,0)
SCRPTP2 ;ALB/CMM - List of Team's Patients ; 29 Jun 99  04:11PM
"RTN","SCRPTP2",2,0)
 ;;5.3;Scheduling;**41,53,52,174,177,231,526**;AUG 13, 1993;Build 8
"RTN","SCRPTP2",3,0)
 ;
"RTN","SCRPTP2",4,0)
 ;List of Team's Patients Report
"RTN","SCRPTP2",5,0)
 ;
"RTN","SCRPTP2",6,0)
TFORMAT(INST,INAME,TIEN,TNAME,PHONE,PC) ; Format team information
"RTN","SCRPTP2",7,0)
 ;INST - institution ien
"RTN","SCRPTP2",8,0)
 ;INAME - institution name
"RTN","SCRPTP2",9,0)
 ;TIEN - team ien
"RTN","SCRPTP2",10,0)
 ;TNAME - team name
"RTN","SCRPTP2",11,0)
 ;PHONE - team phone
"RTN","SCRPTP2",12,0)
 ;PC - primary care team (yes/no)
"RTN","SCRPTP2",13,0)
 ;
"RTN","SCRPTP2",14,0)
 I INAME="" S INAME="[BAD DATA]"
"RTN","SCRPTP2",15,0)
 I TNAME="" S TNAME="[BAD DATA]"
"RTN","SCRPTP2",16,0)
 S @STORE@("I",INAME,INST)=""
"RTN","SCRPTP2",17,0)
 S @STORE@("T",INST,TNAME,TIEN)=""
"RTN","SCRPTP2",18,0)
 S @STORE@(INST)="Division: "_INAME
"RTN","SCRPTP2",19,0)
 S @STORE@(INST,TIEN)="Team: "_TNAME
"RTN","SCRPTP2",20,0)
 S $E(@STORE@(INST,TIEN),45)="Team Phone: "_PHONE
"RTN","SCRPTP2",21,0)
 S @STORE@(INST,TIEN,1)="Primary Care Team: "_PC
"RTN","SCRPTP2",22,0)
 Q
"RTN","SCRPTP2",23,0)
 ;
"RTN","SCRPTP2",24,0)
PRINTIT(STORE,TITL) ;
"RTN","SCRPTP2",25,0)
 N INST,INAME,TNAME,TIEN
"RTN","SCRPTP2",26,0)
 S (NEW,PAGE)=1,STOP=0 W:$E(IOST)="C" @IOF
"RTN","SCRPTP2",27,0)
 D TITLE^SCRPU3(.PAGE,TITL,132) ;write title
"RTN","SCRPTP2",28,0)
 D SETH
"RTN","SCRPTP2",29,0)
 ;
"RTN","SCRPTP2",30,0)
 S INAME=""
"RTN","SCRPTP2",31,0)
 F  S INAME=$O(@STORE@("I",INAME)) Q:INAME=""!(STOP)  D
"RTN","SCRPTP2",32,0)
 .S INST=$O(@STORE@("I",INAME,""))
"RTN","SCRPTP2",33,0)
 .Q:INST=""
"RTN","SCRPTP2",34,0)
 .I ('NEW)&(IOST'?1"C-".E) D NEWP1^SCRPU3(.PAGE,TITL,132)
"RTN","SCRPTP2",35,0)
 .I ('NEW)&(IOST?1"C-".E) D HOLD^SCRPU3(.PAGE,TITL,132)
"RTN","SCRPTP2",36,0)
 .Q:STOP
"RTN","SCRPTP2",37,0)
 .W !,$G(@STORE@(INST)) ;write institution
"RTN","SCRPTP2",38,0)
 .S TNAME=""
"RTN","SCRPTP2",39,0)
 .F  S TNAME=$O(@STORE@("T",INST,TNAME)) Q:TNAME=""!(STOP)  D
"RTN","SCRPTP2",40,0)
 ..S TIEN=$O(@STORE@("T",INST,TNAME,""))
"RTN","SCRPTP2",41,0)
 ..Q:TIEN=""
"RTN","SCRPTP2",42,0)
 ..D TPRINT(INST,TIEN) ;writes team info
"RTN","SCRPTP2",43,0)
 ..Q:STOP
"RTN","SCRPTP2",44,0)
 ..;
"RTN","SCRPTP2",45,0)
 ..I (IOST'?1"C-".E)&($Y>(IOSL-4)) D NEWP1^SCRPU3(.PAGE,TITL,132)
"RTN","SCRPTP2",46,0)
 ..I (IOST?1"C-".E)&($Y>(IOSL-4)) D HOLD^SCRPU3(.PAGE,TITL,132)
"RTN","SCRPTP2",47,0)
 ..Q:STOP
"RTN","SCRPTP2",48,0)
 ..D HEADER
"RTN","SCRPTP2",49,0)
 ..I (SORT=3)!(SORT=4) D PRACT(INST,TIEN,.NEW)
"RTN","SCRPTP2",50,0)
 ..I (SORT=1)!(SORT=2) D PTP(INST,TIEN,.NEW)
"RTN","SCRPTP2",51,0)
 K NEW,PAGE
"RTN","SCRPTP2",52,0)
 I 'STOP,$E(IOST)="C" N DIR S DIR(0)="E" W ! D ^DIR
"RTN","SCRPTP2",53,0)
 Q
"RTN","SCRPTP2",54,0)
 ;
"RTN","SCRPTP2",55,0)
PRACT(INST,TIEN,NEW) ;Print by practitioner/patient
"RTN","SCRPTP2",56,0)
 N PNAME,PIEN,SEC2,ST1,TRD,TRDI
"RTN","SCRPTP2",57,0)
 S PNAME="",PIEN=""
"RTN","SCRPTP2",58,0)
 F  S PNAME=$O(@STORE@("P",INST,TIEN,PNAME)) Q:PNAME=""!(STOP)  D
"RTN","SCRPTP2",59,0)
 . F  S PIEN=$O(@STORE@("P",INST,TIEN,PNAME,PIEN)) Q:PIEN=""!(STOP)  D
"RTN","SCRPTP2",60,0)
 . . I (SORT=1)!(SORT=3) S SEC2="""PT""" ;sort by patient name
"RTN","SCRPTP2",61,0)
 . . I (SORT=2)!(SORT=4) S SEC2="""PID""" ;sort by last 4 PID
"RTN","SCRPTP2",62,0)
 . . S ST1=$E(STORE,1,$L(STORE)-1)_","_SEC2_")"
"RTN","SCRPTP2",63,0)
 . . I (IOST'?1"C-".E)&($Y>(IOSL-4)) D NEWP1^SCRPU3(.PAGE,TITL,132) D:'STOP HEADER
"RTN","SCRPTP2",64,0)
 . . Q:STOP
"RTN","SCRPTP2",65,0)
 . . I (IOST?1"C-".E)&($Y>(IOSL-4)) D HOLD^SCRPU3(.PAGE,TITL,132) D:'STOP HEADER
"RTN","SCRPTP2",66,0)
 . . Q:STOP
"RTN","SCRPTP2",67,0)
 . . S (TRDI,TRD)=""
"RTN","SCRPTP2",68,0)
 . . F  S TRD=$O(@ST1@(INST,TIEN,TRD)) Q:TRD=""!(STOP)  D
"RTN","SCRPTP2",69,0)
 . . . F  S TRDI=$O(@ST1@(INST,TIEN,TRD,TRDI)) Q:TRDI=""!(STOP)  D
"RTN","SCRPTP2",70,0)
 . . . . I (IOST'?1"C-".E)&($Y>(IOSL-4)) D NEWP1^SCRPU3(.PAGE,TITL,132) D:'STOP HEADER
"RTN","SCRPTP2",71,0)
 . . . . Q:STOP
"RTN","SCRPTP2",72,0)
 . . . . I (IOST?1"C-".E)&($Y>(IOSL-4)) D HOLD^SCRPU3(.PAGE,TITL,132) D:'STOP HEADER
"RTN","SCRPTP2",73,0)
 . . . . Q:STOP
"RTN","SCRPTP2",74,0)
 . . . . I $D(@STORE@(INST,TIEN,PIEN,TRDI)) W !,$G(@STORE@(INST,TIEN,PIEN,TRDI)) ;write column data
"RTN","SCRPTP2",75,0)
 . S NEW=0
"RTN","SCRPTP2",76,0)
 Q
"RTN","SCRPTP2",77,0)
 ;
"RTN","SCRPTP2",78,0)
PTP(INST,TIEN,NEW) ;Print by patient/practitioner
"RTN","SCRPTP2",79,0)
 N SEC2,ST1,TRDI,TRD,PNAME,PIEN
"RTN","SCRPTP2",80,0)
 I (SORT=1)!(SORT=3) S SEC2="""PT""" ;sort by patient name
"RTN","SCRPTP2",81,0)
 I (SORT=2)!(SORT=4) S SEC2="""PID""" ;sort by last 4 PID
"RTN","SCRPTP2",82,0)
 S ST1=$E(STORE,1,$L(STORE)-1)_","_SEC2_")"
"RTN","SCRPTP2",83,0)
 I (IOST'?1"C-".E)&($Y>(IOSL-4)) D NEWP1^SCRPU3(.PAGE,TITL,132)
"RTN","SCRPTP2",84,0)
 I (IOST?1"C-".E)&($Y>(IOSL-4)) D HOLD^SCRPU3(.PAGE,TITL,132)
"RTN","SCRPTP2",85,0)
 Q:STOP
"RTN","SCRPTP2",86,0)
 S (TRDI,TRD)=""
"RTN","SCRPTP2",87,0)
 F  S TRD=$O(@ST1@(INST,TIEN,TRD)) Q:TRD=""!(STOP)  D
"RTN","SCRPTP2",88,0)
 . F  S TRDI=$O(@ST1@(INST,TIEN,TRD,TRDI)) Q:TRDI=""!(STOP)  D
"RTN","SCRPTP2",89,0)
 . . I (IOST'?1"C-".E)&($Y>(IOSL-4)) D NEWP1^SCRPU3(.PAGE,TITL,132) D:'STOP HEADER
"RTN","SCRPTP2",90,0)
 . . Q:STOP
"RTN","SCRPTP2",91,0)
 . . I (IOST?1"C-".E)&($Y>(IOSL-4)) D HOLD^SCRPU3(.PAGE,TITL,132) D:'STOP HEADER
"RTN","SCRPTP2",92,0)
 . . Q:STOP
"RTN","SCRPTP2",93,0)
 . . S PNAME="",PIEN=""
"RTN","SCRPTP2",94,0)
 . . F  S PNAME=$O(@STORE@("P",INST,TIEN,PNAME)) Q:PNAME=""!(STOP)!(PIEN=0)  D
"RTN","SCRPTP2",95,0)
 . . . F  S PIEN=$O(@STORE@("P",INST,TIEN,PNAME,PIEN)) Q:PIEN=""!(STOP)  D
"RTN","SCRPTP2",96,0)
 . . . . I (IOST'?1"C-".E)&($Y>(IOSL-4)) D NEWP1^SCRPU3(.PAGE,TITL,132) D:'STOP HEADER
"RTN","SCRPTP2",97,0)
 . . . . Q:STOP
"RTN","SCRPTP2",98,0)
 . . . . I (IOST?1"C-".E)&($Y>(IOSL-4)) D HOLD^SCRPU3(.PAGE,TITL,132) D:'STOP HEADER
"RTN","SCRPTP2",99,0)
 . . . . Q:STOP
"RTN","SCRPTP2",100,0)
 . . . . I $D(@STORE@(INST,TIEN,TRDI,PIEN)) W !,$G(@STORE@(INST,TIEN,TRDI,PIEN)) ;write column data
"RTN","SCRPTP2",101,0)
 . S NEW=0
"RTN","SCRPTP2",102,0)
 Q
"RTN","SCRPTP2",103,0)
 ;
"RTN","SCRPTP2",104,0)
TPRINT(INST,TIEN) ;
"RTN","SCRPTP2",105,0)
 ;prints team data
"RTN","SCRPTP2",106,0)
 N NXT
"RTN","SCRPTP2",107,0)
 I (IOST'?1"C-".E)&($Y>(IOSL-13)) D NEWP1^SCRPU3(.PAGE,TITL,132) W:'STOP !,$G(@STORE@(INST))
"RTN","SCRPTP2",108,0)
 I (IOST?1"C-".E)&($Y>(IOSL-13)) D HOLD^SCRPU3(.PAGE,TITL,132) W:'STOP !,$G(@STORE@(INST))
"RTN","SCRPTP2",109,0)
 Q:STOP
"RTN","SCRPTP2",110,0)
 W !!,$G(@STORE@(INST,TIEN))
"RTN","SCRPTP2",111,0)
 S NXT=0
"RTN","SCRPTP2",112,0)
 W !,$G(@STORE@(INST,TIEN,1)) ;write team info
"RTN","SCRPTP2",113,0)
 Q:'$D(@STORE@(INST,TIEN,"D"))  W !
"RTN","SCRPTP2",114,0)
 S NXT=""
"RTN","SCRPTP2",115,0)
 ;write team description
"RTN","SCRPTP2",116,0)
 F  S NXT=$O(@STORE@(INST,TIEN,"D",NXT)) Q:NXT=""!(STOP)  D
"RTN","SCRPTP2",117,0)
 .I (IOST'?1"C-".E)&$Y>(IOSL-13) D NEWP1^SCRPU3(.PAGE,TITL,132) W:'STOP !,$G(@STORE@(INST))
"RTN","SCRPTP2",118,0)
 .I (IOST?1"C-".E)&$Y>(IOSL-13) D HOLD^SCRPU3(.PAGE,TITL,132) W:'STOP !,$G(@STORE@(INST))
"RTN","SCRPTP2",119,0)
 .Q:STOP
"RTN","SCRPTP2",120,0)
 .W !,$G(@STORE@(INST,TIEN,"D",NXT))
"RTN","SCRPTP2",121,0)
 W !!,"[Not Assigned] = Patient assigned to Team but not to a position/provider"
"RTN","SCRPTP2",122,0)
 W !,"[Inactive Position] = Patient assigned to Team & Position but has no active provider"
"RTN","SCRPTP2",123,0)
 Q
"RTN","SCRPTP2",124,0)
 ;
"RTN","SCRPTP2",125,0)
HEADER ;prints column headings
"RTN","SCRPTP2",126,0)
 N NXT
"RTN","SCRPTP2",127,0)
 F NXT="H1","H2","H3" D
"RTN","SCRPTP2",128,0)
 .W !,$G(@STORE@(NXT))
"RTN","SCRPTP2",129,0)
 Q
"RTN","SCRPTP2",130,0)
 ;
"RTN","SCRPTP2",131,0)
SETH ;sets column headings
"RTN","SCRPTP2",132,0)
 S @STORE@("H2")="Patient Name"
"RTN","SCRPTP2",133,0)
 S $E(@STORE@("H2"),18)="Pt ID"
"RTN","SCRPTP2",134,0)
 S $E(@STORE@("H2"),32)="Practitioner"
"RTN","SCRPTP2",135,0)
 S $E(@STORE@("H2"),56)="Role"
"RTN","SCRPTP2",136,0)
 S $E(@STORE@("H2"),80)="PC?"
"RTN","SCRPTP2",137,0)
 S $E(@STORE@("H1"),85)="Last"
"RTN","SCRPTP2",138,0)
 S $E(@STORE@("H2"),85)="Appt."
"RTN","SCRPTP2",139,0)
 S $E(@STORE@("H1"),97)="Next"
"RTN","SCRPTP2",140,0)
 S $E(@STORE@("H2"),97)="Appt."
"RTN","SCRPTP2",141,0)
 S $E(@STORE@("H2"),109)="Associated Clinic"
"RTN","SCRPTP2",142,0)
 S $P(@STORE@("H3"),"=",133)=""
"RTN","SCRPTP2",143,0)
 Q
"RTN","SCRPTP3")
0^2^B27716649^B26975202
"RTN","SCRPTP3",1,0)
SCRPTP3 ;ALB/CMM - List of Team's Patients ; 29 Jun 99  04:11PM
"RTN","SCRPTP3",2,0)
 ;;5.3;Scheduling;**41,48,98,177,231,433,526**;AUG 13, 1993;Build 8
"RTN","SCRPTP3",3,0)
 ;
"RTN","SCRPTP3",4,0)
 ;List of Team's Patients Report
"RTN","SCRPTP3",5,0)
 ;
"RTN","SCRPTP3",6,0)
HITS(ARRY,TIEN) ;
"RTN","SCRPTP3",7,0)
 ;ARRY - list of patients for a given team
"RTN","SCRPTP3",8,0)
 ;TIEN - team ien
"RTN","SCRPTP3",9,0)
 ;
"RTN","SCRPTP3",10,0)
 N PTIEN,PIEN,PTNAME,PNAME,PTAI,NXT,NODE,CIEN,CNAME,INAME,INST,LAST,NEXT
"RTN","SCRPTP3",11,0)
 N PAIEN,PC,PHONE,PNODE,PTPA,PTPAN,ROL,PID,TINFO,TNAME,TPIEN,TPNODE
"RTN","SCRPTP3",12,0)
 N CNT,TPA,FLAG,DFN,VA,VAERR,PCAP,ROLN
"RTN","SCRPTP3",13,0)
 S INACTIVE=0
"RTN","SCRPTP3",14,0)
 S NXT=0
"RTN","SCRPTP3",15,0)
 F  S NXT=$O(@ARRY@(NXT)) Q:NXT=""!(NXT'?.N)  D
"RTN","SCRPTP3",16,0)
 .S NODE=$G(@ARRY@(NXT))
"RTN","SCRPTP3",17,0)
 .Q:NODE=""
"RTN","SCRPTP3",18,0)
 .S PTIEN=+$P(NODE,"^") ;patient ien
"RTN","SCRPTP3",19,0)
 .S PTNAME=$P(NODE,"^",2) ;patient name
"RTN","SCRPTP3",20,0)
 .S PTAI=+$P(NODE,"^",3) ;patient team assignment ien (#404.42)
"RTN","SCRPTP3",21,0)
 .;
"RTN","SCRPTP3",22,0)
 .S PNODE=$G(^DPT(PTIEN,0))
"RTN","SCRPTP3",23,0)
 .Q:PNODE=""
"RTN","SCRPTP3",24,0)
 .S DFN=PTIEN
"RTN","SCRPTP3",25,0)
 .D PID^VADPT6
"RTN","SCRPTP3",26,0)
 .;DMR BP-OIFO PATCH SD*5.3*526
"RTN","SCRPTP3",27,0)
 .;S PID=VA("BID")
"RTN","SCRPTP3",28,0)
 .S PID=$E(VA("PID"),1,3)_$E(VA("PID"),5,6)_$E(VA("PID"),8,12)
"RTN","SCRPTP3",29,0)
 .;
"RTN","SCRPTP3",30,0)
 .S TPA=$$TPAR(PTAI,"")
"RTN","SCRPTP3",31,0)
 .I TPA'=-1 D
"RTN","SCRPTP3",32,0)
 ..S PIEN=$P(TPA,"^")
"RTN","SCRPTP3",33,0)
 ..S PNAME=$P(TPA,"^",2)
"RTN","SCRPTP3",34,0)
 ..S CNAME=$P(TPA,"^",3)
"RTN","SCRPTP3",35,0)
 ..S LAST=$P(TPA,"^",4)
"RTN","SCRPTP3",36,0)
 ..S NEXT=$P(TPA,"^",5)
"RTN","SCRPTP3",37,0)
 ..;
"RTN","SCRPTP3",38,0)
 ..S FLAG="Y"
"RTN","SCRPTP3",39,0)
 ..S TINFO=$$TINF^SCRPTP(TIEN) ;team information
"RTN","SCRPTP3",40,0)
 ..S INST=+$P(TINFO,"^") ;institution ien
"RTN","SCRPTP3",41,0)
 ..S INAME=$P($G(^DIC(4,INST,0)),"^") ;institution name
"RTN","SCRPTP3",42,0)
 ..S PHONE=$P(TINFO,"^",4) ;team phone
"RTN","SCRPTP3",43,0)
 ..S PC=$P(TINFO,"^",3) ;primary care?
"RTN","SCRPTP3",44,0)
 ..S TNAME=$P(TINFO,"^",2) ;team name
"RTN","SCRPTP3",45,0)
 ..;
"RTN","SCRPTP3",46,0)
 ..D TFORMAT^SCRPTP2(INST,INAME,TIEN,TNAME,PHONE,PC)
"RTN","SCRPTP3",47,0)
 ..D FORMAT^SCRPTP(INST,TIEN,PTIEN,PTNAME,PID,PIEN,PNAME,CNAME,LAST,NEXT)
"RTN","SCRPTP3",48,0)
 .;
"RTN","SCRPTP3",49,0)
 .;check for other assignments
"RTN","SCRPTP3",50,0)
 .N TPIN
"RTN","SCRPTP3",51,0)
 .S CNT=""
"RTN","SCRPTP3",52,0)
 .F  S CNT=$O(^SCPT(404.43,"B",PTAI,CNT)) Q:CNT=""!(CNT'?.N)  D
"RTN","SCRPTP3",53,0)
 ..S TPIN=$$TPAR(PTAI,CNT)
"RTN","SCRPTP3",54,0)
 ..Q:TPIN=-1
"RTN","SCRPTP3",55,0)
 ..S PIEN=$P(TPIN,"^")
"RTN","SCRPTP3",56,0)
 ..S PNAME=$P(TPIN,"^",2)
"RTN","SCRPTP3",57,0)
 ..S CNAME=$P(TPIN,"^",3)
"RTN","SCRPTP3",58,0)
 ..S LAST=$P(TPIN,"^",4)
"RTN","SCRPTP3",59,0)
 ..S NEXT=$P(TPIN,"^",5)
"RTN","SCRPTP3",60,0)
 ..S ROLN=$P(TPIN,U,6)
"RTN","SCRPTP3",61,0)
 ..S PCAP=$P(TPIN,U,7)
"RTN","SCRPTP3",62,0)
 ..I '$D(FLAG) D
"RTN","SCRPTP3",63,0)
 ...S TINFO=$$TINF^SCRPTP(TIEN) ;team information
"RTN","SCRPTP3",64,0)
 ...S INST=+$P(TINFO,"^") ;institution ien
"RTN","SCRPTP3",65,0)
 ...S INAME=$P($G(^DIC(4,INST,0)),"^") ;institution name
"RTN","SCRPTP3",66,0)
 ...S PHONE=$P(TINFO,"^",4) ;team phone
"RTN","SCRPTP3",67,0)
 ...S PC=$P(TINFO,"^",3) ;primary care?
"RTN","SCRPTP3",68,0)
 ...S TNAME=$P(TINFO,"^",2) ;team name
"RTN","SCRPTP3",69,0)
 ...;
"RTN","SCRPTP3",70,0)
 ...D TFORMAT^SCRPTP2(INST,INAME,TIEN,TNAME,PHONE,PC)
"RTN","SCRPTP3",71,0)
 ..D FORMAT^SCRPTP(INST,TIEN,PTIEN,PTNAME,PID,PIEN,PNAME,CNAME,LAST,NEXT,ROLN,PCAP)
"RTN","SCRPTP3",72,0)
 I INACTIVE S @STORE@(INST,TIEN,"INACT")=""
"RTN","SCRPTP3",73,0)
 Q
"RTN","SCRPTP3",74,0)
 ;
"RTN","SCRPTP3",75,0)
TPAR(PTAI,START) ;
"RTN","SCRPTP3",76,0)
 N PTPA,TPIEN,TPNODE,ROL,CNAME,CIEN,ENROLL,OKAY,PNAME,NEXT,LAST,PAIEN
"RTN","SCRPTP3",77,0)
 N ROLN,PCAP
"RTN","SCRPTP3",78,0)
 I '$D(^SCPT(404.43,"B",PTAI)) Q "0^[Not Assigned]"
"RTN","SCRPTP3",79,0)
 ; ^ no patient team position assignment
"RTN","SCRPTP3",80,0)
 IF START="" D
"RTN","SCRPTP3",81,0)
 .S PTPA=$O(^SCPT(404.43,"B",PTAI,START))
"RTN","SCRPTP3",82,0)
 ELSE  D
"RTN","SCRPTP3",83,0)
 .S PTPA=START
"RTN","SCRPTP3",84,0)
 I PTPA="" Q "0^[Not Assigned]"
"RTN","SCRPTP3",85,0)
 S PTPAN=$G(^SCPT(404.43,PTPA,0)) ;patient team position assignment node
"RTN","SCRPTP3",86,0)
 I PTPAN=""!(PTPAN=0) Q "0^[Not Assigned]"
"RTN","SCRPTP3",87,0)
 I $P(PTPAN,"^",4)'="",$P(PTPAN,"^",4)<DT Q -1
"RTN","SCRPTP3",88,0)
 S TPIEN=+$P(PTPAN,"^",2) ;team position ien (#404.57)
"RTN","SCRPTP3",89,0)
 I '$D(^SCTM(404.57,TPIEN,0)) Q "0^[Not Assigned]"
"RTN","SCRPTP3",90,0)
 S TPNODE=$G(^SCTM(404.57,TPIEN,0))
"RTN","SCRPTP3",91,0)
 I TPNODE="" Q "0^[Not Assigned]"
"RTN","SCRPTP3",92,0)
 S ROL=+$P(TPNODE,"^",3) ;role for position (ien)
"RTN","SCRPTP3",93,0)
 Q:'$D(ROLE(ROL))&(ROLE'=1) -1
"RTN","SCRPTP3",94,0)
 ; ^ not a selected role
"RTN","SCRPTP3",95,0)
 S ROLN=$P($G(^SD(403.46,ROL,0)),U) ;role name
"RTN","SCRPTP3",96,0)
 ;
"RTN","SCRPTP3",97,0)
 S PCAP=$S($P(PTPAN,U,5)<1:"NPC",+$$OKPREC3^SCMCLK(TPIEN,DT)>0:" AP",1:"PCP") ;PC?
"RTN","SCRPTP3",98,0)
 ;
"RTN","SCRPTP3",99,0)
 S CIEN=+$P(TPNODE,"^",9) ;associated clinic ien
"RTN","SCRPTP3",100,0)
 S CNAME=$P($G(^SC(CIEN,0)),"^") ;clinic name
"RTN","SCRPTP3",101,0)
 ;check patient status
"RTN","SCRPTP3",102,0)
 S OKAY=""
"RTN","SCRPTP3",103,0)
 I CIEN>0&(PSTAT'=1) S OKAY=$$PST^SCRPTP(PTIEN,CIEN)
"RTN","SCRPTP3",104,0)
 Q:(CIEN>0)&('OKAY)&(PSTAT'=1) -1
"RTN","SCRPTP3",105,0)
 ; ^ not selected patient status
"RTN","SCRPTP3",106,0)
 ;
"RTN","SCRPTP3",107,0)
 ;next two lines commented off - SD*5.3*433
"RTN","SCRPTP3",108,0)
 ;S ENROLL=$$ENRL(PTIEN,CIEN) ;enrolled in associated clinic
"RTN","SCRPTP3",109,0)
 ;I 'ENROLL S CNAME="",CIEN=0
"RTN","SCRPTP3",110,0)
 ;
"RTN","SCRPTP3",111,0)
 S PAIEN=$$CHK(TPIEN)
"RTN","SCRPTP3",112,0)
 I +PAIEN'=0 S PIEN=+PAIEN,PNAME=$P(PAIEN,"^",2) ; practitioner's name
"RTN","SCRPTP3",113,0)
 ;SD*5.3*231
"RTN","SCRPTP3",114,0)
 I +PAIEN=0 S PIEN=0,PNAME="[Inactive Position]"
"RTN","SCRPTP3",115,0)
 ;
"RTN","SCRPTP3",116,0)
 S (NEXT,LAST)=""
"RTN","SCRPTP3",117,0)
 I +CIEN>0 S NEXT=$$GETNEXT^SCRPU3(PTIEN,CIEN) ;next appointment
"RTN","SCRPTP3",118,0)
 I +CIEN>0 S LAST=$$GETLAST^SCRPU3(PTIEN,CIEN) ;last appointment
"RTN","SCRPTP3",119,0)
 ;
"RTN","SCRPTP3",120,0)
 Q PIEN_U_PNAME_U_CNAME_U_LAST_U_NEXT_U_ROLN_U_PCAP
"RTN","SCRPTP3",121,0)
 ;
"RTN","SCRPTP3",122,0)
ENRL(PTIEN,CLIEN) ;
"RTN","SCRPTP3",123,0)
 ;
"RTN","SCRPTP3",124,0)
 N FOUND,ENODE,EN,NXT
"RTN","SCRPTP3",125,0)
 S FOUND=0
"RTN","SCRPTP3",126,0)
 Q:'$D(^DPT(PTIEN,"DE","B",CLIEN)) FOUND
"RTN","SCRPTP3",127,0)
 S EN=$O(^DPT(PTIEN,"DE","B",CLIEN,""))
"RTN","SCRPTP3",128,0)
 Q:EN=""!'$D(^DPT(PTIEN,"DE",EN,1)) FOUND
"RTN","SCRPTP3",129,0)
 S NXT=""
"RTN","SCRPTP3",130,0)
 F  S NXT=$O(^DPT(PTIEN,"DE",EN,1,NXT)) Q:(FOUND)!(NXT="")!(NXT'?.N)  D
"RTN","SCRPTP3",131,0)
 .;check if active enrollment
"RTN","SCRPTP3",132,0)
 .S ENODE=$G(^DPT(PTIEN,"DE",EN,1,NXT,0))
"RTN","SCRPTP3",133,0)
 .I $P(ENODE,"^",3)'="",$P(ENODE,"^",3)<DT+1!$P(ENODE,"^")>DT Q  ;not active enrollment
"RTN","SCRPTP3",134,0)
 .;                      ^ discharge date     ^ enrollment date
"RTN","SCRPTP3",135,0)
 .S FOUND=1
"RTN","SCRPTP3",136,0)
 Q FOUND
"RTN","SCRPTP3",137,0)
 ;
"RTN","SCRPTP3",138,0)
CHK(TPIEN) ;assigned to a position
"RTN","SCRPTP3",139,0)
 ;TPIEN - ien of 404.57 Team Position file
"RTN","SCRPTP3",140,0)
 ;returns:  ien of 200 New Person file
"RTN","SCRPTP3",141,0)
 N EN,PLIST,PERR,ERR,NAME
"RTN","SCRPTP3",142,0)
 S PLIST="PLST",PERR="PRR"
"RTN","SCRPTP3",143,0)
 K @PLIST,@PERR
"RTN","SCRPTP3",144,0)
 S ERR=$$PRTP^SCAPMC8(TPIEN,,.PLIST,.PERR)
"RTN","SCRPTP3",145,0)
 I '$D(@PERR) D
"RTN","SCRPTP3",146,0)
 .S EN=$P($G(@PLIST@(1)),"^") ;ien of new person file
"RTN","SCRPTP3",147,0)
 .S NAME=$P($G(@PLIST@(1)),"^",2) ; new person name
"RTN","SCRPTP3",148,0)
 K @PLIST,@PERR
"RTN","SCRPTP3",149,0)
 Q EN_"^"_NAME
"RTN","SCRPTP3",150,0)
 ;
"RTN","SCRPU2")
0^11^B22140204^B22624198
"RTN","SCRPU2",1,0)
SCRPU2 ;ALB/CMM - GENERIC PROMPTS FOR PCMM REPORTS ; 12 Jan 99  1:23 PM
"RTN","SCRPU2",2,0)
 ;;5.3;Scheduling;**41,174,297,526**;AUG 13, 1993;Build 8
"RTN","SCRPU2",3,0)
 ;
"RTN","SCRPU2",4,0)
DTRANG(FIRST,SECOND) ;Date Range - begin date ^ end date => fileman format
"RTN","SCRPU2",5,0)
 ;FIRST - first prompt (not required)
"RTN","SCRPU2",6,0)
 ;SECOND - second prompt (not required)
"RTN","SCRPU2",7,0)
 N BDATE,EDATE,DIROUT,DUOUT,DTOUT
"RTN","SCRPU2",8,0)
 S EDATE=-1
"RTN","SCRPU2",9,0)
 S DIR(0)="D^::E",DIR("B")="Today"
"RTN","SCRPU2",10,0)
 I '$D(FIRST) S DIR("A")="Begin Date"
"RTN","SCRPU2",11,0)
 I $D(FIRST) S DIR("A")=FIRST
"RTN","SCRPU2",12,0)
 D ^DIR
"RTN","SCRPU2",13,0)
 I $D(DTOUT)!(X="Today") S BDATE=$P(DT,".")
"RTN","SCRPU2",14,0)
 I $D(DUOUT)!($D(DIROUT))  Q -1
"RTN","SCRPU2",15,0)
 S BDATE=+Y
"RTN","SCRPU2",16,0)
DEN I '$D(SECOND) S DIR("A")="End Date"
"RTN","SCRPU2",17,0)
 I $D(SECOND) S DIR("A")=SECOND
"RTN","SCRPU2",18,0)
 K DTOUT,X,Y
"RTN","SCRPU2",19,0)
 D ^DIR
"RTN","SCRPU2",20,0)
 I $D(DTOUT)!(X="Today") S EDATE=$P(DT,".")
"RTN","SCRPU2",21,0)
 I $D(DUOUT)!($D(DIROUT)) Q -1
"RTN","SCRPU2",22,0)
 S EDATE=+Y
"RTN","SCRPU2",23,0)
 I EDATE<BDATE W !,"End date can't occur before Begin Date",! G DEN
"RTN","SCRPU2",24,0)
 K X,Y,DIR
"RTN","SCRPU2",25,0)
 Q BDATE_"^"_EDATE
"RTN","SCRPU2",26,0)
 ;
"RTN","SCRPU2",27,0)
GTEAM(CLN,DFN) ;
"RTN","SCRPU2",28,0)
 ;given clinic and patient, find related team
"RTN","SCRPU2",29,0)
 N TPEN,FOUND,TEAM
"RTN","SCRPU2",30,0)
 S TPEN="",FOUND=0
"RTN","SCRPU2",31,0)
 F  S TPEN=$O(^SCTM(404.57,"D",CLN,TPEN)) Q:TPEN=""!(FOUND)  D
"RTN","SCRPU2",32,0)
 .S TEAM=$P(^SCTM(404.57,TPEN,0),"^",2)
"RTN","SCRPU2",33,0)
 .I $D(^SCPT(404.42,"APTTM",DFN,TEAM)) S FOUND=1
"RTN","SCRPU2",34,0)
 I FOUND=1 Q TEAM
"RTN","SCRPU2",35,0)
 Q FOUND
"RTN","SCRPU2",36,0)
 ;
"RTN","SCRPU2",37,0)
ASSUN ;
"RTN","SCRPU2",38,0)
 ;prompt for assigned or unassigned to Primary Care Team
"RTN","SCRPU2",39,0)
 N VAUTVB
"RTN","SCRPU2",40,0)
 S VAUTVB="VAUTA"
"RTN","SCRPU2",41,0)
 W !,"(A)ssigned or (U)nassigned Patients to Primary Care Team: "
"RTN","SCRPU2",42,0)
 R X:DTIME
"RTN","SCRPU2",43,0)
 I (X="^")!'$T G ERR
"RTN","SCRPU2",44,0)
 I (X'="A")&(X'="U") D HLP G ASSUN
"RTN","SCRPU2",45,0)
 I (X="")!(X["?") D HLP G ASSUN
"RTN","SCRPU2",46,0)
 I X="A" S @VAUTVB=1
"RTN","SCRPU2",47,0)
 I X="U" S @VAUTVB=0
"RTN","SCRPU2",48,0)
 K X
"RTN","SCRPU2",49,0)
 Q
"RTN","SCRPU2",50,0)
 ;
"RTN","SCRPU2",51,0)
PCLNHR() ;Prompt to Print Clinic Hours
"RTN","SCRPU2",52,0)
 S DIR("A")="Print Clinic Hours",DIR("B")="Y"
"RTN","SCRPU2",53,0)
 Q $$YESNO()
"RTN","SCRPU2",54,0)
 ;
"RTN","SCRPU2",55,0)
PCLNIN() ;Prompt to Print Clinic Information
"RTN","SCRPU2",56,0)
 S DIR("A")="Print Clinic Information",DIR("B")="Y"
"RTN","SCRPU2",57,0)
 Q $$YESNO()
"RTN","SCRPU2",58,0)
 ;
"RTN","SCRPU2",59,0)
SUMM() ;Prompt to Print Summary Only (y/n)
"RTN","SCRPU2",60,0)
 S DIR("A")="Print Summary Only",DIR("B")="N"
"RTN","SCRPU2",61,0)
 S DIR("?")="Enter 'Y' to have patient names excluded, 'N' to include patient names"
"RTN","SCRPU2",62,0)
 Q $$YESNO()
"RTN","SCRPU2",63,0)
 ;
"RTN","SCRPU2",64,0)
YESNO() ;Yes/No prompt
"RTN","SCRPU2",65,0)
 N X,DTOUT,DUOUT,DIROUT,Y
"RTN","SCRPU2",66,0)
 S DIR(0)="Y"
"RTN","SCRPU2",67,0)
 D ^DIR
"RTN","SCRPU2",68,0)
 I $D(DTOUT)!(X="") S Y=$S(DIR("B")="Y":1,1:0)
"RTN","SCRPU2",69,0)
 I $D(DUOUT)!($D(DIROUT)) S Y=-1
"RTN","SCRPU2",70,0)
 K DIR
"RTN","SCRPU2",71,0)
 Q +Y
"RTN","SCRPU2",72,0)
 ;
"RTN","SCRPU2",73,0)
PTSTAT ;Prompt for Patient Status (All, OPT, AC)
"RTN","SCRPU2",74,0)
 ;Modified by patch 172
"RTN","SCRPU2",75,0)
 S VAUTPS=1 Q
"RTN","SCRPU2",76,0)
 ;
"RTN","SCRPU2",77,0)
 N X,STAT,VAUTVB
"RTN","SCRPU2",78,0)
 S VAUTVB="VAUTPS"
"RTN","SCRPU2",79,0)
 W !,"Patient Status: ALL//"
"RTN","SCRPU2",80,0)
 R X:DTIME
"RTN","SCRPU2",81,0)
 I '$T!(X="")!(X="ALL") S @VAUTVB=1
"RTN","SCRPU2",82,0)
 I X="^" G ERR
"RTN","SCRPU2",83,0)
 I (X["?") D HLP2 G PTSTAT
"RTN","SCRPU2",84,0)
 I X="A"!(X="AC") S @VAUTVB="AC"
"RTN","SCRPU2",85,0)
 I X="O"!(X="OPT") S @VAUTVB="OPT"
"RTN","SCRPU2",86,0)
 I '$D(@VAUTVB) D HLP2 G PTSTAT
"RTN","SCRPU2",87,0)
 Q
"RTN","SCRPU2",88,0)
 ;
"RTN","SCRPU2",89,0)
HLP2 ;help prompt for Patient Status
"RTN","SCRPU2",90,0)
 W !,"Enter: ",!?10,"- A or AC for patients whose status is AC"
"RTN","SCRPU2",91,0)
 W !?10,"- O or OPT for patient whose status is OPT"
"RTN","SCRPU2",92,0)
 W !?10,"- Enter or ALL for both AC and OPT patients"
"RTN","SCRPU2",93,0)
 Q
"RTN","SCRPU2",94,0)
HLP ;
"RTN","SCRPU2",95,0)
 ;help prompt
"RTN","SCRPU2",96,0)
 W !,"Enter: ",!?5,"- A for patients assigned to the team as Primary Care"
"RTN","SCRPU2",97,0)
 W !?10,"- U for patients not assigned to the team as Primary Care"
"RTN","SCRPU2",98,0)
 Q
"RTN","SCRPU2",99,0)
 ;
"RTN","SCRPU2",100,0)
ERR S Y=-1 I $O(@VAUTVB@(0))="" K @VAUTVB
"RTN","SCRPU2",101,0)
QUIT S:'$D(Y) Y=1 K DIC,J,VAERR,VAI,VAJ,VAJ1,VAX,VAUTNI,VAUTSTR,VAUTVB,X
"RTN","SCRPU2",102,0)
 Q
"RTN","SCRPU2",103,0)
 ;
"RTN","SCRPU2",104,0)
SORT() ;
"RTN","SCRPU2",105,0)
 ;Prompt for sorting by Division, Team, Practitioner or Division, Practitioner, Team
"RTN","SCRPU2",106,0)
 ;
"RTN","SCRPU2",107,0)
EN1 N X
"RTN","SCRPU2",108,0)
 W !,"Sort By:",!?10,"[1] Division, Team, Practitioner",!?10,"[2] Division, Practitioner, Team"
"RTN","SCRPU2",109,0)
 W !?10,"[3] Practitioner,Associated Clinic"
"RTN","SCRPU2",110,0)
 W !!,"Select 1 or 2 or 3: "
"RTN","SCRPU2",111,0)
 R X:DTIME
"RTN","SCRPU2",112,0)
 I (X="^")!'$T Q 0
"RTN","SCRPU2",113,0)
 I (X'="1")&(X'="2")&(X'=3) D HLP3 G EN1
"RTN","SCRPU2",114,0)
 I (X["?")!(X="") D HLP3 G EN1
"RTN","SCRPU2",115,0)
 Q X
"RTN","SCRPU2",116,0)
HLP3 ;
"RTN","SCRPU2",117,0)
 ;help prompt
"RTN","SCRPU2",118,0)
 W !,"Enter: ",!?5,"- 1 to sort by Division, Team, Practitioner "
"RTN","SCRPU2",119,0)
 W !?10,"- 2 to sort by Division, Practitioner, Team"
"RTN","SCRPU2",120,0)
 Q
"RTN","SCRPU2",121,0)
 ;
"RTN","SCRPU2",122,0)
SORT2() ;Prompt for sorting by:
"RTN","SCRPU2",123,0)
 ;   [1] Division, Team, Patient Name
"RTN","SCRPU2",124,0)
 ;or [2] Division, Team, SSN
"RTN","SCRPU2",125,0)
 ;or [3] Division, Team, Practitioner, Patient Name
"RTN","SCRPU2",126,0)
 ;or [4] Division, Team, Practitioner, SSN
"RTN","SCRPU2",127,0)
 ;
"RTN","SCRPU2",128,0)
EN4 ;
"RTN","SCRPU2",129,0)
 N X
"RTN","SCRPU2",130,0)
 W !,"Sort By:",!?10,"[1] Division, Team, Patient Name"
"RTN","SCRPU2",131,0)
 W !?10,"[2] Division, Team, SSN"
"RTN","SCRPU2",132,0)
 W !?10,"[3] Division, Team, Practitioner, Patient Name"
"RTN","SCRPU2",133,0)
 W !?10,"[4] Division, Team, Practitioner, SSN"
"RTN","SCRPU2",134,0)
 W !!,"Select 1, 2, 3, or 4: "
"RTN","SCRPU2",135,0)
 R X:DTIME
"RTN","SCRPU2",136,0)
 I X=""!(X="^")!'$T Q 0
"RTN","SCRPU2",137,0)
 I (X'="1")&(X'="2")&(X'="3")&(X'="4") D HLP4 G EN4
"RTN","SCRPU2",138,0)
 I (X["?") D HLP4 G EN4
"RTN","SCRPU2",139,0)
 Q X
"RTN","SCRPU2",140,0)
HLP4 ;
"RTN","SCRPU2",141,0)
 ;help prompt
"RTN","SCRPU2",142,0)
 W !,"Enter: ",!?5,"- 1 to sort by Division, Team, Patient Name"
"RTN","SCRPU2",143,0)
 W !?10,"- 2 to sort by Division, Team, SSN"
"RTN","SCRPU2",144,0)
 W !?10,"- 3 to sort by Division, Team, Practitioner, Patient Name"
"RTN","SCRPU2",145,0)
 W !?10,"- 4 to sort by Division, Team, Practitioner, SSN"
"RTN","SCRPU2",146,0)
 Q
"VER")
8.0^22.0
"BLD",6846,6)
^431
**END**
**END**
