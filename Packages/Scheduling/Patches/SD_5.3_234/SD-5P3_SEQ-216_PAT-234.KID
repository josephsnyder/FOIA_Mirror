EMERGENCY Released SD*5.3*234 SEQ #216
Extracted from mail message
**KIDS**:SD*5.3*234^

**INSTALL NAME**
SD*5.3*234
"BLD",2570,0)
SD*5.3*234^SCHEDULING^0^3010403^y
"BLD",2570,1,0)
^^2^2^3010228^
"BLD",2570,1,1,0)
The changes included in this patch are described in the description
"BLD",2570,1,2,0)
section of patch SD*5.3*234 in the National Patch Module.
"BLD",2570,4,0)
^9.64PA^^
"BLD",2570,"INI")

"BLD",2570,"INID")
n^n^n
"BLD",2570,"INIT")
POST^SD53P234
"BLD",2570,"KRN",0)
^9.67PA^19^17
"BLD",2570,"KRN",.4,0)
.4
"BLD",2570,"KRN",.401,0)
.401
"BLD",2570,"KRN",.402,0)
.402
"BLD",2570,"KRN",.403,0)
.403
"BLD",2570,"KRN",.5,0)
.5
"BLD",2570,"KRN",.84,0)
.84
"BLD",2570,"KRN",3.6,0)
3.6
"BLD",2570,"KRN",3.8,0)
3.8
"BLD",2570,"KRN",9.2,0)
9.2
"BLD",2570,"KRN",9.8,0)
9.8
"BLD",2570,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",2570,"KRN",9.8,"NM",1,0)
SD53P234^^0^B57691032
"BLD",2570,"KRN",9.8,"NM","B","SD53P234",1)

"BLD",2570,"KRN",19,0)
19
"BLD",2570,"KRN",19.1,0)
19.1
"BLD",2570,"KRN",101,0)
101
"BLD",2570,"KRN",409.61,0)
409.61
"BLD",2570,"KRN",771,0)
771
"BLD",2570,"KRN",870,0)
870
"BLD",2570,"KRN",8994,0)
8994
"BLD",2570,"KRN","B",.4,.4)

"BLD",2570,"KRN","B",.401,.401)

"BLD",2570,"KRN","B",.402,.402)

"BLD",2570,"KRN","B",.403,.403)

"BLD",2570,"KRN","B",.5,.5)

"BLD",2570,"KRN","B",.84,.84)

"BLD",2570,"KRN","B",3.6,3.6)

"BLD",2570,"KRN","B",3.8,3.8)

"BLD",2570,"KRN","B",9.2,9.2)

"BLD",2570,"KRN","B",9.8,9.8)

"BLD",2570,"KRN","B",19,19)

"BLD",2570,"KRN","B",19.1,19.1)

"BLD",2570,"KRN","B",101,101)

"BLD",2570,"KRN","B",409.61,409.61)

"BLD",2570,"KRN","B",771,771)

"BLD",2570,"KRN","B",870,870)

"BLD",2570,"KRN","B",8994,8994)

"BLD",2570,"PRE")
SD53P234
"BLD",2570,"QUES",0)
^9.62^^
"BLD",2570,"REQB",0)
^9.611^^
"INIT")
POST^SD53P234
"MBREQ")
0
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2941102
"PKG",16,22,1,"PAH",1,0)
234^3010403^11748
"PKG",16,22,1,"PAH",1,1,0)
^^2^2^3010403
"PKG",16,22,1,"PAH",1,1,1,0)
The changes included in this patch are described in the description
"PKG",16,22,1,"PAH",1,1,2,0)
section of patch SD*5.3*234 in the National Patch Module.
"PRE")
SD53P234
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","SD53P234")
0^1^B57691032
"RTN","SD53P234",1,0)
SD53P234 ;ALB/RBS - Patch SD*5.3*234 Install Utility Routine ; 3/12/01 1:03pm
"RTN","SD53P234",2,0)
 ;;5.3;Scheduling;**234**;AUG 13, 1993
"RTN","SD53P234",3,0)
 ;
"RTN","SD53P234",4,0)
 ; * Note:  Patch SD*5.3*212 - Baseline Seeding must have been Run *
"RTN","SD53P234",5,0)
 ;
"RTN","SD53P234",6,0)
 ; This routine will search the PCMM HL7 TRANSMISSION (#404.471) file
"RTN","SD53P234",7,0)
 ;  for 'A'ccepted Status HL7's whose Transmission Date/Time fall
"RTN","SD53P234",8,0)
 ;   within the dates of Oct. 23, 2000 through Oct. 31, 2000.
"RTN","SD53P234",9,0)
 ; These HL7's will then have their Status changed to:
"RTN","SD53P234",10,0)
 ;  'M' (MARKED FOR RE-TRANSMIT) in the #404.471 file.
"RTN","SD53P234",11,0)
 ;
"RTN","SD53P234",12,0)
 ; The following criteria must be true:
"RTN","SD53P234",13,0)
 ;  1.  Must have a Baseline Run Date...
"RTN","SD53P234",14,0)
 ;      *** AND ***
"RTN","SD53P234",15,0)
 ;  1a. Baseline Run Date NOT GREATER THAN Oct. 31, 2000.
"RTN","SD53P234",16,0)
 ;  2.  BEGIN Date equals:  Oct. 22, 2000@23:59 = 3001022.2359
"RTN","SD53P234",17,0)
 ;                          *** OR ***
"RTN","SD53P234",18,0)
 ;                          the Baseline Run Date (whichever greater)
"RTN","SD53P234",19,0)
 ;  3.  END Date equals:    Nov.  1, 2000@00:00 = 3001101
"RTN","SD53P234",20,0)
 ;  4.  STATUS equals ACCEPTED
"RTN","SD53P234",21,0)
 ;      *** AND ***
"RTN","SD53P234",22,0)
 ;  4a. TRANSMISSION DATE/TIME is between the BEGIN & END dates
"RTN","SD53P234",23,0)
 ;
"RTN","SD53P234",24,0)
 ;
"RTN","SD53P234",25,0)
ENV ;Main entry point for Environment check point.
"RTN","SD53P234",26,0)
 S XPDABORT=""
"RTN","SD53P234",27,0)
 D PROGCHK(.XPDABORT) ;checks programmer variables
"RTN","SD53P234",28,0)
 D PARMCHK(.XPDABORT) ;checks param file ien exists
"RTN","SD53P234",29,0)
 ;
"RTN","SD53P234",30,0)
 N SCX
"RTN","SD53P234",31,0)
 I $D(^XTMP("SD53P234")) D  Q
"RTN","SD53P234",32,0)
 .S SCX=$G(^XTMP("SD53P234",0))
"RTN","SD53P234",33,0)
 .D BMES^XPDUTL("*****")
"RTN","SD53P234",34,0)
 .D MES^XPDUTL("The PCMM HL7 Missing Message Re-queue has already run on:  "_$$FMTE^XLFDT($P(SCX,U,2)))
"RTN","SD53P234",35,0)
 .D MES^XPDUTL("Transport global will be removed.  Install will Abort.")
"RTN","SD53P234",36,0)
 .D MES^XPDUTL("*****")
"RTN","SD53P234",37,0)
 .S XPDABORT=1  ;abort install & kill all transport globals
"RTN","SD53P234",38,0)
 I XPDABORT="" K XPDABORT
"RTN","SD53P234",39,0)
 ;
"RTN","SD53P234",40,0)
 Q
"RTN","SD53P234",41,0)
 ;
"RTN","SD53P234",42,0)
PRE ;Main entry point for Pre-init items.
"RTN","SD53P234",43,0)
 ;
"RTN","SD53P234",44,0)
 Q
"RTN","SD53P234",45,0)
 ;
"RTN","SD53P234",46,0)
POST ;Main entry point for Post-init items.
"RTN","SD53P234",47,0)
 ;
"RTN","SD53P234",48,0)
 Q:$D(^XTMP("SD53P234"))
"RTN","SD53P234",49,0)
 D SETUP       ;Setup ^XTMP audit global
"RTN","SD53P234",50,0)
 D POST1       ;Update Client/Server files
"RTN","SD53P234",51,0)
 D POST2       ;Search & MARK HL7's to be RE-TRANSMITTED
"RTN","SD53P234",52,0)
 Q
"RTN","SD53P234",53,0)
 ;
"RTN","SD53P234",54,0)
PROGCHK(XPDABORT) ;checks for necessary programmer variables
"RTN","SD53P234",55,0)
 ;
"RTN","SD53P234",56,0)
 I '$G(DUZ)!($G(DUZ(0))'="@")!('$G(DT))!($G(U)'="^") D
"RTN","SD53P234",57,0)
 .D BMES^XPDUTL("*****")
"RTN","SD53P234",58,0)
 .D MES^XPDUTL("Your programming variables are not set up properly.")
"RTN","SD53P234",59,0)
 .D MES^XPDUTL("Installation aborted.")
"RTN","SD53P234",60,0)
 .D MES^XPDUTL("*****")
"RTN","SD53P234",61,0)
 .S XPDABORT=2
"RTN","SD53P234",62,0)
 Q
"RTN","SD53P234",63,0)
 ;
"RTN","SD53P234",64,0)
PARMCHK(XPDABORT) ;checks for proper param file ien
"RTN","SD53P234",65,0)
 ;
"RTN","SD53P234",66,0)
 I '$D(^SCTM(404.44,1)) D
"RTN","SD53P234",67,0)
 .D BMES^XPDUTL("*****")
"RTN","SD53P234",68,0)
 .D MES^XPDUTL("PCMM Parameter file does not have proper IEN (1).")
"RTN","SD53P234",69,0)
 .D MES^XPDUTL("Installation aborted.")
"RTN","SD53P234",70,0)
 .D MES^XPDUTL("*****")
"RTN","SD53P234",71,0)
 .S XPDABORT=2
"RTN","SD53P234",72,0)
 Q
"RTN","SD53P234",73,0)
 ;
"RTN","SD53P234",74,0)
POST1 ;Update client/server files.
"RTN","SD53P234",75,0)
 ;
"RTN","SD53P234",76,0)
 I $$UPCLNLST^SCMCUT("SD*5.3*234^NullClient^1^0^0") D  Q
"RTN","SD53P234",77,0)
 .D MES^XPDUTL("Client/Server files updated.")
"RTN","SD53P234",78,0)
 ;
"RTN","SD53P234",79,0)
 D MES^XPDUTL("Client/Server files NOT updated.")
"RTN","SD53P234",80,0)
 Q
"RTN","SD53P234",81,0)
 ;
"RTN","SD53P234",82,0)
POST2 ;Loop (#404.471)-PCMM HL7 TRANSMISSION LOG file
"RTN","SD53P234",83,0)
 ; Search for HL7's with 'A'ccepted Status and Transmission D/T within
"RTN","SD53P234",84,0)
 ;  the Beginning and Ending date's.
"RTN","SD53P234",85,0)
 ;
"RTN","SD53P234",86,0)
 ; begin date, end date, Baseline Run date, message variables, totals
"RTN","SD53P234",87,0)
 N SCBDATE,SCEDATE,SCP212,SC1,SC2,SC3,SCTOT,SCTOTAL
"RTN","SD53P234",88,0)
 S (SC1,SC2,SC3)="",(SCP212,SCTOT,SCTOTAL)=0
"RTN","SD53P234",89,0)
 ;
"RTN","SD53P234",90,0)
 ; begin/end search dates - October 23, 2000 through October 31, 2000
"RTN","SD53P234",91,0)
 S SCBDATE=3001022.2359,SCEDATE=3001031.2359
"RTN","SD53P234",92,0)
 ;
"RTN","SD53P234",93,0)
 ; check for Baseline Run date
"RTN","SD53P234",94,0)
 D CHECK(.SCP212)
"RTN","SD53P234",95,0)
 Q:'SCP212
"RTN","SD53P234",96,0)
 ;
"RTN","SD53P234",97,0)
 ; search for messages to mark for retransmission
"RTN","SD53P234",98,0)
 D LOOP
"RTN","SD53P234",99,0)
 ; total up all HL7's
"RTN","SD53P234",100,0)
 D CNTZPC
"RTN","SD53P234",101,0)
 ; send user e-mail message...
"RTN","SD53P234",102,0)
 D MSG(SCTOT,SCTOTAL,"")
"RTN","SD53P234",103,0)
 ; setup ^XTMP totals
"RTN","SD53P234",104,0)
 N SCX
"RTN","SD53P234",105,0)
 S SCX=$G(^XTMP("SD53P234",0))    ;temp AUDIT global
"RTN","SD53P234",106,0)
 S $P(SCX,U,6)=SCTOT              ;log total HL7's retransmitted
"RTN","SD53P234",107,0)
 S $P(SCX,U,7)=SCTOTAL            ;Total HL7's since Baseline
"RTN","SD53P234",108,0)
 S ^XTMP("SD53P234",0)=SCX
"RTN","SD53P234",109,0)
 ;
"RTN","SD53P234",110,0)
 K ^TMP($J,"SD53P234")            ;clean up
"RTN","SD53P234",111,0)
 Q
"RTN","SD53P234",112,0)
 ; *** END OF PROCESSING ***
"RTN","SD53P234",113,0)
 ;
"RTN","SD53P234",114,0)
CNTZPC ; Total Number HL7's since Baseline Seeding to current date
"RTN","SD53P234",115,0)
 ; Output;  SCTOTAL = total HL7's since Baseline seeding
"RTN","SD53P234",116,0)
 ; 
"RTN","SD53P234",117,0)
 Q:'$D(^TMP($J,"SD53P234"))
"RTN","SD53P234",118,0)
 N SCSEQ
"RTN","SD53P234",119,0)
 S SCSEQ="" F  S SCSEQ=$O(^TMP($J,"SD53P234",SCSEQ)) Q:SCSEQ=""  S SCTOTAL=SCTOTAL+1
"RTN","SD53P234",120,0)
 Q
"RTN","SD53P234",121,0)
 ;
"RTN","SD53P234",122,0)
LOOP ;Loop thru PCMM HL7 TRANSMISSION LOG file and find every entry
"RTN","SD53P234",123,0)
 ; with STATUS="A", and re-transmit.
"RTN","SD53P234",124,0)
 ; Output;  SCTOT = total marked counter
"RTN","SD53P234",125,0)
 ;
"RTN","SD53P234",126,0)
 N SCARR,SCERR,SCTRANI,SCTRANDT,SCX
"RTN","SD53P234",127,0)
 S SCTRANI=0
"RTN","SD53P234",128,0)
 F  S SCTRANI=$O(^SCPT(404.471,"ASTAT","A",SCTRANI)) Q:SCTRANI=""  D
"RTN","SD53P234",129,0)
 .K SCARR,SCERR
"RTN","SD53P234",130,0)
 .S SCX=SCTRANI_","
"RTN","SD53P234",131,0)
 .D GETS^DIQ(404.471,SCX,".01;.02;.03;.04;.05","I","SCARR","SCERR")
"RTN","SD53P234",132,0)
 .Q:$D(SCERR)                             ;error
"RTN","SD53P234",133,0)
 .Q:$G(SCARR(404.471,SCX,.01,"I"))=""     ;message control ID null
"RTN","SD53P234",134,0)
 .Q:$G(SCARR(404.471,SCX,.02,"I"))=""     ;patient DFN null
"RTN","SD53P234",135,0)
 .Q:$G(SCARR(404.471,SCX,.03,"I"))=""     ;transmission date/time null
"RTN","SD53P234",136,0)
 .Q:$G(SCARR(404.471,SCX,.04,"I"))'="A"   ;status not equal "A"ccepted
"RTN","SD53P234",137,0)
 .Q:$G(SCARR(404.471,SCX,.05,"I"))=""     ;ACK received date/time null
"RTN","SD53P234",138,0)
 .S SCTRANDT=$G(SCARR(404.471,SCX,.03,"I"))
"RTN","SD53P234",139,0)
 .; count actual number of 404.49 ZPC unique Provider ID's
"RTN","SD53P234",140,0)
 .I SCTRANDT'<SCP212 D ZPC(SCTRANI)       ;count all HL7's fm Baseline
"RTN","SD53P234",141,0)
 .Q:SCTRANDT<SCBDATE                      ;begin date
"RTN","SD53P234",142,0)
 .Q:SCTRANDT>SCEDATE                      ;end date
"RTN","SD53P234",143,0)
 .;
"RTN","SD53P234",144,0)
 .D STATUS^SCMCHLRR(SCTRANI,"M")          ;change status to 'M'arked
"RTN","SD53P234",145,0)
 .S SCTOT=SCTOT+1                         ;total status changes
"RTN","SD53P234",146,0)
 Q
"RTN","SD53P234",147,0)
 ;
"RTN","SD53P234",148,0)
ZPC(TRANI) ; count number of (#404.49,ien) pointers to Provider ID's
"RTN","SD53P234",149,0)
 ;
"RTN","SD53P234",150,0)
 N SCSEQ,SCSEQI,SCZPCID
"RTN","SD53P234",151,0)
 S (SCSEQ,SCSEQI,SCZPCID)=""
"RTN","SD53P234",152,0)
 F  S SCSEQ=$O(^SCPT(404.471,TRANI,"ZPC","B",SCSEQ)) Q:SCSEQ=""  D
"RTN","SD53P234",153,0)
 .F  S SCSEQI=$O(^SCPT(404.471,TRANI,"ZPC","B",SCSEQ,SCSEQI)) Q:SCSEQI=""  D
"RTN","SD53P234",154,0)
 ..S SCZPCID=$P($G(^SCPT(404.471,TRANI,"ZPC",SCSEQI,0)),"^",2)
"RTN","SD53P234",155,0)
 ..Q:'$D(^SCPT(404.49,SCZPCID))
"RTN","SD53P234",156,0)
 ..S ^TMP($J,"SD53P234",SCZPCID)=""
"RTN","SD53P234",157,0)
 Q
"RTN","SD53P234",158,0)
 ;
"RTN","SD53P234",159,0)
MSG(SCTOT,SCTOTAL,SCXERR) ; send e-mail to user's
"RTN","SD53P234",160,0)
 ;
"RTN","SD53P234",161,0)
 N DIFROM,SCX,SCXSITE,SCSTIME,SCETIME,SCTEXT,XMY,XMDUZ,XMSUB,XMTEXT,XMDUN,XMZ
"RTN","SD53P234",162,0)
 S SCXSITE=$$SITE^VASITE
"RTN","SD53P234",163,0)
 S SCX=$G(^XTMP("SD53P234",0)),SCSTIME=$P(SCX,U,3)   ;start date/time
"RTN","SD53P234",164,0)
 S SCETIME=$$NOW^XLFDT(),$P(SCX,U,4)=SCETIME      ;end date/time
"RTN","SD53P234",165,0)
 S XMDUZ=.5,XMY(XMDUZ)="",XMY(DUZ)="",XMTEXT="SCTEXT("
"RTN","SD53P234",166,0)
 S XMY("G.PCMM TESTING@FORUM.VA.GOV")=""  ;e-mail all sites totals to
"RTN","SD53P234",167,0)
 S XMSUB="Patch SD*5.3*234 PCMM DATA NOT LOADED TO NPCD ("_$P(SCXSITE,U,3)_")"
"RTN","SD53P234",168,0)
 ;
"RTN","SD53P234",169,0)
 S SCTEXT(1)=""
"RTN","SD53P234",170,0)
 S SCTEXT(2)="          Facility Name:  "_$P(SCXSITE,"^",2)
"RTN","SD53P234",171,0)
 S SCTEXT(3)="         Station Number:  "_$P(SCXSITE,"^",3)
"RTN","SD53P234",172,0)
 S SCTEXT(4)=""
"RTN","SD53P234",173,0)
 S SCTEXT(5)="  Date/Time job started:  "_$$FMTE^XLFDT(SCSTIME)
"RTN","SD53P234",174,0)
 S SCTEXT(6)="  Date/Time job stopped:  "_$$FMTE^XLFDT(SCETIME)
"RTN","SD53P234",175,0)
 S SCTEXT(7)=""
"RTN","SD53P234",176,0)
 S SCTEXT(8)="Total HL7 messages Marked for Transmission to the AAC: "_SCTOT
"RTN","SD53P234",177,0)
 S SCTEXT(9)="Total Provider ID records created since Baseline Run Date("_$$FMTE^XLFDT(SCP212)_"): "_SCTOTAL
"RTN","SD53P234",178,0)
 I SCXERR]"" D
"RTN","SD53P234",179,0)
 .S SCTEXT(10)=""
"RTN","SD53P234",180,0)
 .S SCTEXT(11)="               * * * * E R R O R    E N C O U N T E R E D * * * *"
"RTN","SD53P234",181,0)
 .S SCTEXT(12)=""
"RTN","SD53P234",182,0)
 .S SCTEXT(13)=SC1
"RTN","SD53P234",183,0)
 .S SCTEXT(14)=SC2
"RTN","SD53P234",184,0)
 .S SCTEXT(15)=""
"RTN","SD53P234",185,0)
 D ^XMD
"RTN","SD53P234",186,0)
 S ^XTMP("SD53P234",0)=SCX    ;end date/time - temp audit global
"RTN","SD53P234",187,0)
 Q
"RTN","SD53P234",188,0)
 ;
"RTN","SD53P234",189,0)
CHECK(SCP212) ; Determine whether or not the Baseline has run.
"RTN","SD53P234",190,0)
 ; Input: None
"RTN","SD53P234",191,0)
 ; Output:
"RTN","SD53P234",192,0)
 ;   Function Value: Return date Baseline was run
"RTN","SD53P234",193,0)
 ;
"RTN","SD53P234",194,0)
 N SCX
"RTN","SD53P234",195,0)
 ; setup first line of error msg.
"RTN","SD53P234",196,0)
 S SC1="The PCMM HL7 Missing Message Re-queue Job was Aborted because:"
"RTN","SD53P234",197,0)
 I '$D(^SCTM(404.44,1)) D  Q
"RTN","SD53P234",198,0)
 .S SC2="  Missing PCMM Parameter file entry."
"RTN","SD53P234",199,0)
 .D MSG(0,0,1)
"RTN","SD53P234",200,0)
 ;
"RTN","SD53P234",201,0)
 K ^TMP($J,"SD53P234")
"RTN","SD53P234",202,0)
 S SCX=$$GET1^DIQ(404.44,"1,",17,"I","","^TMP($J,""SD53P234"")")
"RTN","SD53P234",203,0)
 I $D(^TMP($J,"SD53P234")) D  Q
"RTN","SD53P234",204,0)
 .S SC2="  FileMan Error retrieving data from PCMM Parameter file."
"RTN","SD53P234",205,0)
 .D MSG(0,0,1)
"RTN","SD53P234",206,0)
 .K ^TMP($J,"SD53P234")
"RTN","SD53P234",207,0)
 ;
"RTN","SD53P234",208,0)
 I SCX="" D  Q
"RTN","SD53P234",209,0)
 .S SC2="  No PCMM Baseline Run Date found in the PCMM Parameter file."
"RTN","SD53P234",210,0)
 .D MSG(0,0,1)
"RTN","SD53P234",211,0)
 ;
"RTN","SD53P234",212,0)
 ; If Baseline Run date Greater the End search date, Quit
"RTN","SD53P234",213,0)
 I SCX>SCEDATE D  Q
"RTN","SD53P234",214,0)
 .S SC2="  No PCMM HL7 Missing Message Retransmits required for your site."
"RTN","SD53P234",215,0)
 .S SCP212=SCX D MSG(0,0,1) S SCP212=0
"RTN","SD53P234",216,0)
 ;
"RTN","SD53P234",217,0)
 ; If Baseline Run date Greater than Begin Search date,
"RTN","SD53P234",218,0)
 ;  then use Baseline date
"RTN","SD53P234",219,0)
 I SCX>SCBDATE S SCBDATE=SCX
"RTN","SD53P234",220,0)
 ;
"RTN","SD53P234",221,0)
 S SCP212=SCX        ;Baseline Run Date
"RTN","SD53P234",222,0)
 Q
"RTN","SD53P234",223,0)
 ;
"RTN","SD53P234",224,0)
SETUP ; setup start processing time
"RTN","SD53P234",225,0)
 ; The ^XTMP global will be used as an audit trail for 30 days to
"RTN","SD53P234",226,0)
 ;  prevent this process from running more than once.
"RTN","SD53P234",227,0)
 ;  ^XTMP("SD53P234",0)=STRING
"RTN","SD53P234",228,0)
 ;  STRING = 7 fields of data delimited by "^" up-arrow
"RTN","SD53P234",229,0)
 ;       1 = purge date = date ^XTMP global will be purged
"RTN","SD53P234",230,0)
 ;       2 = run date   = date routine was run
"RTN","SD53P234",231,0)
 ;       3 = start d/t  = start date & time of processing
"RTN","SD53P234",232,0)
 ;       4 = stop d/t   = stop date & time of processing
"RTN","SD53P234",233,0)
 ;       5 = DUZ of User= ID # of user running process
"RTN","SD53P234",234,0)
 ;       6 = HL7 count  = Total number or HL7's marked for retransmit
"RTN","SD53P234",235,0)
 ;       7 = TOTAL HL7'S that should be loaded from original Baseline.
"RTN","SD53P234",236,0)
 ;
"RTN","SD53P234",237,0)
 N SCX
"RTN","SD53P234",238,0)
 S $P(SCX,U)=$$HTFM^XLFDT(+$H+30),$P(SCX,U,2)=$$DT^XLFDT()
"RTN","SD53P234",239,0)
 S $P(SCX,U,3)=$$NOW^XLFDT(),$P(SCX,U,5)=DUZ,$P(SCX,U,6)=0,$P(SCX,U,7)=0
"RTN","SD53P234",240,0)
 S ^XTMP("SD53P234",0)=SCX
"RTN","SD53P234",241,0)
 Q
"VER")
8.0^22.0
**END**
**END**
