Released SD*5.3*499 SEQ #433
Extracted from mail message
**KIDS**:SD*5.3*499^

**INSTALL NAME**
SD*5.3*499
"BLD",7485,0)
SD*5.3*499^SCHEDULING^0^3080326^y
"BLD",7485,1,0)
^^6^6^3080214^
"BLD",7485,1,1,0)
This patch adresses the following PCMM issues:
"BLD",7485,1,2,0)
- Proper unflagging both patients and providers if criteria are met
"BLD",7485,1,3,0)
- Verification of patients assigned to a position with changed providers
"BLD",7485,1,4,0)
- Multiple providers verification for a valid appointment
"BLD",7485,1,5,0)
- Any scheduled time on the 15th and the last day of a month for the SCMC
"BLD",7485,1,6,0)
  PCMM NIGHTLY TASK should generate expected messages. 
"BLD",7485,4,0)
^9.64PA^^
"BLD",7485,6)
2^
"BLD",7485,6.3)
21
"BLD",7485,"INIT")
POST^SD53P499
"BLD",7485,"KRN",0)
^9.67PA^8989.52^19
"BLD",7485,"KRN",.4,0)
.4
"BLD",7485,"KRN",.401,0)
.401
"BLD",7485,"KRN",.402,0)
.402
"BLD",7485,"KRN",.403,0)
.403
"BLD",7485,"KRN",.5,0)
.5
"BLD",7485,"KRN",.84,0)
.84
"BLD",7485,"KRN",3.6,0)
3.6
"BLD",7485,"KRN",3.8,0)
3.8
"BLD",7485,"KRN",9.2,0)
9.2
"BLD",7485,"KRN",9.8,0)
9.8
"BLD",7485,"KRN",9.8,"NM",0)
^9.68A^6^4
"BLD",7485,"KRN",9.8,"NM",3,0)
SCMCTSK1^^0^B79722253
"BLD",7485,"KRN",9.8,"NM",4,0)
SCMCTSK2^^0^B91467456
"BLD",7485,"KRN",9.8,"NM",5,0)
SCMCTSK3^^0^B82723614
"BLD",7485,"KRN",9.8,"NM",6,0)
SD53P499^^0^B8539155
"BLD",7485,"KRN",9.8,"NM","B","SCMCTSK1",3)

"BLD",7485,"KRN",9.8,"NM","B","SCMCTSK2",4)

"BLD",7485,"KRN",9.8,"NM","B","SCMCTSK3",5)

"BLD",7485,"KRN",9.8,"NM","B","SD53P499",6)

"BLD",7485,"KRN",19,0)
19
"BLD",7485,"KRN",19,"NM",0)
^9.68A^1^1
"BLD",7485,"KRN",19,"NM",1,0)
SCMC PCMM NIGHTLY TASK^^0
"BLD",7485,"KRN",19,"NM","B","SCMC PCMM NIGHTLY TASK",1)

"BLD",7485,"KRN",19.1,0)
19.1
"BLD",7485,"KRN",19.1,"NM",0)
^9.68A^^0
"BLD",7485,"KRN",101,0)
101
"BLD",7485,"KRN",409.61,0)
409.61
"BLD",7485,"KRN",771,0)
771
"BLD",7485,"KRN",870,0)
870
"BLD",7485,"KRN",8989.51,0)
8989.51
"BLD",7485,"KRN",8989.52,0)
8989.52
"BLD",7485,"KRN",8994,0)
8994
"BLD",7485,"KRN","B",.4,.4)

"BLD",7485,"KRN","B",.401,.401)

"BLD",7485,"KRN","B",.402,.402)

"BLD",7485,"KRN","B",.403,.403)

"BLD",7485,"KRN","B",.5,.5)

"BLD",7485,"KRN","B",.84,.84)

"BLD",7485,"KRN","B",3.6,3.6)

"BLD",7485,"KRN","B",3.8,3.8)

"BLD",7485,"KRN","B",9.2,9.2)

"BLD",7485,"KRN","B",9.8,9.8)

"BLD",7485,"KRN","B",19,19)

"BLD",7485,"KRN","B",19.1,19.1)

"BLD",7485,"KRN","B",101,101)

"BLD",7485,"KRN","B",409.61,409.61)

"BLD",7485,"KRN","B",771,771)

"BLD",7485,"KRN","B",870,870)

"BLD",7485,"KRN","B",8989.51,8989.51)

"BLD",7485,"KRN","B",8989.52,8989.52)

"BLD",7485,"KRN","B",8994,8994)

"BLD",7485,"QDEF")
^^^^NO^^^^NO^^YES
"BLD",7485,"QUES",0)
^9.62^^
"BLD",7485,"REQB",0)
^9.611^4^2
"BLD",7485,"REQB",3,0)
SD*5.3*527^2
"BLD",7485,"REQB",4,0)
SD*5.3*297^2
"BLD",7485,"REQB","B","SD*5.3*297",4)

"BLD",7485,"REQB","B","SD*5.3*527",3)

"INIT")
POST^SD53P499
"KRN",19,12075,-1)
0^1
"KRN",19,12075,0)
SCMC PCMM NIGHTLY TASK^PCMM NIGHTLY TASK^^R^^SC PCMM SETUP^^^^^^^^1^1
"KRN",19,12075,1,0)
^19.06^7^7^3080314^^
"KRN",19,12075,1,1,0)
This option should be scheduled once a day. It reviews Patient team assignments
"KRN",19,12075,1,2,0)
and flaggs them for inactivation if their assignment is NEW and they 
"KRN",19,12075,1,3,0)
have not been seen in the last year. It also flaggs ESTABLISHED patients 
"KRN",19,12075,1,4,0)
if they have not been seen more than two years. If there are not 
"KRN",19,12075,1,5,0)
appointments within 30 days since flagging the related patients are 
"KRN",19,12075,1,6,0)
inactivated on the closest 15th or the end of month process. Messages are 
"KRN",19,12075,1,7,0)
generated both on the 15th and on the last day of a month.
"KRN",19,12075,15)
N DTT S DTT=+$D(^XTMP("SCMCTSK2-"_$$HTFM^XLFDT($H,1),$J,"START")) N DT1 S DT1=$S(DTT>0:$$HTFM^XLFDT($H,1),1:$$HTFM^XLFDT($H-1,1)) S ^XTMP("SCMCTSK2-"_DT1,$J,"STOP")=$$HTE^XLFDT($H)
"KRN",19,12075,20)
S ^XTMP("SCMCTSK2-"_$$HTFM^XLFDT($H,1),0)=$$HTFM^XLFDT($H+7,1)_U_$$HTFM^XLFDT($H,1)_U_$J,^XTMP("SCMCTSK2-"_$$HTFM^XLFDT($H,1),$J,"START")=$$HTE^XLFDT($H)
"KRN",19,12075,25)
NIGHT^SCMCTSK2
"KRN",19,12075,"U")
PCMM NIGHTLY TASK
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813
"PKG",16,22,1,"PAH",1,0)
499^3080326^100892
"PKG",16,22,1,"PAH",1,1,0)
^^6^6^3080326
"PKG",16,22,1,"PAH",1,1,1,0)
This patch adresses the following PCMM issues:
"PKG",16,22,1,"PAH",1,1,2,0)
- Proper unflagging both patients and providers if criteria are met
"PKG",16,22,1,"PAH",1,1,3,0)
- Verification of patients assigned to a position with changed providers
"PKG",16,22,1,"PAH",1,1,4,0)
- Multiple providers verification for a valid appointment
"PKG",16,22,1,"PAH",1,1,5,0)
- Any scheduled time on the 15th and the last day of a month for the SCMC
"PKG",16,22,1,"PAH",1,1,6,0)
  PCMM NIGHTLY TASK should generate expected messages. 
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","SCMCTSK1")
0^3^B79722253^B77403484
"RTN","SCMCTSK1",1,0)
SCMCTSK1 ;ALB/JDS - PCMM Inactivations; 18 Apr 2003  9:36 AM ; 10/24/07 12:24pm  ; Compiled January 25, 2008 12:11:43  ; Compiled March 26, 2008 22:27:26
"RTN","SCMCTSK1",2,0)
 ;;5.3;Scheduling;**297,498,527,499**;AUG 13, 1993;Build 21
"RTN","SCMCTSK1",3,0)
 Q
"RTN","SCMCTSK1",4,0)
INACTIVE ;
"RTN","SCMCTSK1",5,0)
 ;Flag patients
"RTN","SCMCTSK1",6,0)
 N I,CNT,SC297,TPZ,TYDT,TEAMN,STDT,Q,SDDT,STDD S CNT=0
"RTN","SCMCTSK1",7,0)
 D DT^DICRW
"RTN","SCMCTSK1",8,0)
 N SD1 S SDDT="" F SD1=DT,DT-1 I $D(^XTMP("SCMCTSK2-"_SD1,$J,"START")) S SDDT=SD1 Q
"RTN","SCMCTSK1",9,0)
 I SDDT'>0 D DT^DICRW S SDDT=DT
"RTN","SCMCTSK1",10,0)
 S %DT="",X="T-11M" D ^%DT S STDD=+Y
"RTN","SCMCTSK1",11,0)
 S A="^SCPT(404.43,""ADFN""",L=""""""
"RTN","SCMCTSK1",12,0)
 S Q=A_")"
"RTN","SCMCTSK1",13,0)
 F  S Q=$Q(@Q) Q:Q'[A  D
"RTN","SCMCTSK1",14,0)
 .S ENTRY=+$P(Q,",",6)
"RTN","SCMCTSK1",15,0)
 .S ZERO=$G(^SCPT(404.43,+ENTRY,0))
"RTN","SCMCTSK1",16,0)
 .I $P(ZERO,U,15) Q
"RTN","SCMCTSK1",17,0)
 .S POS=+$P(ZERO,U,2)
"RTN","SCMCTSK1",18,0)
 .I $P(ZERO,U,4) Q  ;UNASS
"RTN","SCMCTSK1",19,0)
 .I '$P(ZERO,U,5) Q  ;Not PC
"RTN","SCMCTSK1",20,0)
 .I $P(ZERO,U,3)>STDD Q  ;<11 months
"RTN","SCMCTSK1",21,0)
 .I $P(ZERO,U,17) Q  ;React
"RTN","SCMCTSK1",22,0)
 .;get preceptor
"RTN","SCMCTSK1",23,0)
 .S PREC=$$DATES^SCAPMCU1(404.53,+POS),PREC=$S(PREC:$P($G(^SCTM(404.53,+$P(PREC,U,4),0)),U,6),1:+POS)
"RTN","SCMCTSK1",24,0)
 .S DFN=$P(Q,",",3)
"RTN","SCMCTSK1",25,0)
 .I $G(XPDIDTOT),('(DFN#5)) D UPDATE^XPDID(DFN)
"RTN","SCMCTSK1",26,0)
 .S TEAM=$P(Q,",",4),TEAMNM=$P($G(^SCTM(404.51,+TEAM,0)),U)
"RTN","SCMCTSK1",27,0)
 .N STDT S %DT="",X="T-12M" D ^%DT S STDT=+Y
"RTN","SCMCTSK1",28,0)
 .;N-new or E-est
"RTN","SCMCTSK1",29,0)
 .N NEW
"RTN","SCMCTSK1",30,0)
 .I $P(ZERO,U,3)<STDT S NEW=0
"RTN","SCMCTSK1",31,0)
 .E  S NEW=1
"RTN","SCMCTSK1",32,0)
 .N TYDT
"RTN","SCMCTSK1",33,0)
 .I NEW N STDT S %DT="",X="T-11M" D ^%DT S STDT=+Y D
"RTN","SCMCTSK1",34,0)
 ..S X1=STDT,X2=-7 D C^%DTC S TYDT=X
"RTN","SCMCTSK1",35,0)
 .I 'NEW N STDT S %DT="",X="T-23M" D ^%DT S STDT=+Y Q:$P(ZERO,U,3)'<STDT  D
"RTN","SCMCTSK1",36,0)
 ..S X1=STDT,X2=-7 D C^%DTC S TYDT=X
"RTN","SCMCTSK1",37,0)
 .N PROV,SEEN,PRECP D SEEN(DFN,POS,TYDT,SDDT,.PROV,.PRECP,.SEEN) Q:SEEN
"RTN","SCMCTSK1",38,0)
 .;flag
"RTN","SCMCTSK1",39,0)
 .S DIE="^SCPT(404.43,",DR=".15////"_SDDT,DA=ENTRY D ^DIE
"RTN","SCMCTSK1",40,0)
 .S TPZ=$G(^SCTM(404.57,+POS,2))
"RTN","SCMCTSK1",41,0)
 .I "TP"[$P(TPZ,U,9) I $G(PROV) S CNT=CNT+1,^TMP("SCF",$J,PROV,CNT,ENTRY)=""
"RTN","SCMCTSK1",42,0)
 .I $P(TPZ,U,10),$G(PRECP) S CNT=CNT+1,^TMP("SCF",$J,PRECP,CNT,ENTRY)=""
"RTN","SCMCTSK1",43,0)
 Q
"RTN","SCMCTSK1",44,0)
SEEN(DFN,POS,TYDT,SDDT,PROV,PROVP,SEEN) ;
"RTN","SCMCTSK1",45,0)
 S SEEN=0,PROVP=""
"RTN","SCMCTSK1",46,0)
 N SCPRO,I,PRO,X,SCPRDTS,SCPR,PREC
"RTN","SCMCTSK1",47,0)
 S PROV=+$$GETPRTP^SCAPMCU2(POS,SDDT)
"RTN","SCMCTSK1",48,0)
 S SCPRDTS("BEGIN")=TYDT,SCPRDTS("END")=SDDT,SCPRDTS("INCL")=0
"RTN","SCMCTSK1",49,0)
 S X=$$PRTP^SCAPMC(POS,"SCPRDTS","SCPR")
"RTN","SCMCTSK1",50,0)
 S I=0 F  S I=$O(SCPR(I)) Q:'I  S SCPRO(+SCPR(I))="",SCPRO(+SCPR(I),I)=$P(SCPR(I),U,9,10) D
"RTN","SCMCTSK1",51,0)
 .S PREC=$P(SCPR(I),U,12)
"RTN","SCMCTSK1",52,0)
 .I PREC,PREC'=POS S PROVP=+$$GETPRTP^SCAPMCU2(PREC,SDDT) S SCPRO(+PROVP)="" S SCPRO(+PROVP,I)=$P(SCPR(I),U,9,10)
"RTN","SCMCTSK1",53,0)
 F I=TYDT:0 S I=$O(^SCE("ADFN",DFN,I)) Q:'I  D  Q:SEEN
"RTN","SCMCTSK1",54,0)
 .S J=0 F  S J=$O(^SCE("ADFN",DFN,I,J)) Q:'J  D  Q:SEEN
"RTN","SCMCTSK1",55,0)
 ..N VISIT S VISIT=+$P($G(^SCE(J,0)),U,5) I $G(^SCE(J,0))<$G(TYDT) Q
"RTN","SCMCTSK1",56,0)
 ..S PRO=0 F  S PRO=$O(SCPRO(PRO)) Q:'PRO  D  Q:SEEN
"RTN","SCMCTSK1",57,0)
 ...I $D(^SDD(409.44,"AO",J,$G(PRO))) D CHK I SEEN=1 Q
"RTN","SCMCTSK1",58,0)
 ...N V F V=0:0 S V=$O(^AUPNVPRV("AD",VISIT,V)) Q:'V  I PRO=(+$G(^AUPNVPRV(V,0))) D CHK I SEEN=1 Q
"RTN","SCMCTSK1",59,0)
 Q
"RTN","SCMCTSK1",60,0)
CHK ;
"RTN","SCMCTSK1",61,0)
 N SDX S SDX="" F  S SDX=$O(SCPRO(PRO,SDX)) Q:SDX=""  D  Q:SEEN
"RTN","SCMCTSK1",62,0)
 .I $P(SCPRO(PRO,SDX),U,2)="" D  Q
"RTN","SCMCTSK1",63,0)
 ..I I'<$P(SCPRO(PRO,SDX),U) S SEEN=1
"RTN","SCMCTSK1",64,0)
 .I I'<TYDT&(I'>$P(SCPRO(PRO,SDX),U,2)) S SEEN=1
"RTN","SCMCTSK1",65,0)
 Q
"RTN","SCMCTSK1",66,0)
DIS ;disch
"RTN","SCMCTSK1",67,0)
 N ZERO S ZERO=$G(^SCPT(404.43,+ENTRY,0))
"RTN","SCMCTSK1",68,0)
 I $P(ZERO,U,4) Q
"RTN","SCMCTSK1",69,0)
 D DIS2^SCMCTSK7
"RTN","SCMCTSK1",70,0)
 Q
"RTN","SCMCTSK1",71,0)
CHKENR(DATA,INFO) ;check if patient enrolled in teamposition clinic
"RTN","SCMCTSK1",72,0)
 S DATA(0)=-1
"RTN","SCMCTSK1",73,0)
 Q
"RTN","SCMCTSK1",74,0)
EXTEND(DATA,SCTEAM) ;to inact. in next 60 days
"RTN","SCMCTSK1",75,0)
 ;IEN^POSITION^PATIENT^EXTENDED^REASON
"RTN","SCMCTSK1",76,0)
 K DATA,SCDATA,SDDATA
"RTN","SCMCTSK1",77,0)
 N CNT,I,J,K,A,POSA S CNT=1 S SCTEAM=$G(SCTEAM),DATA(1)="<DATA>"
"RTN","SCMCTSK1",78,0)
 D DT^DICRW
"RTN","SCMCTSK1",79,0)
 N SD1 S SDDT="" F SD1=DT,DT-1 I $D(^XTMP("SCMCTSK2-"_SD1,$J,"START")) S SDDT=SD1 Q
"RTN","SCMCTSK1",80,0)
 I SDDT'>0 D DT^DICRW S SDDT=DT
"RTN","SCMCTSK1",81,0)
 S X="T-9M" D ^%DT S STDT=Y
"RTN","SCMCTSK1",82,0)
 S X="T-21M" D ^%DT S TYDT=+Y  ;MAKE THIS 21
"RTN","SCMCTSK1",83,0)
 S POSA=""
"RTN","SCMCTSK1",84,0)
 S POS=+$P(SCTEAM,U,2) I POS D POS,EX1 Q
"RTN","SCMCTSK1",85,0)
 F  S POSA=$O(^SCTM(404.57,"ATMPOS",+SCTEAM,POSA)) Q:POSA=""  D  Q:CNT>100
"RTN","SCMCTSK1",86,0)
 .F POS=0:0 S POS=$O(^SCTM(404.57,"ATMPOS",+SCTEAM,POSA,POS)) Q:'POS  D POS Q:CNT>100
"RTN","SCMCTSK1",87,0)
 I CNT>100 S DATA(1)="TOO MANY" Q
"RTN","SCMCTSK1",88,0)
EX1 S A="SDDATA",CNT=1 F  S A=$Q(@A) Q:A=""  D
"RTN","SCMCTSK1",89,0)
 .S B=@A
"RTN","SCMCTSK1",90,0)
 .S DATA(CNT)=(+$P(B,U,3))_U_$TR($P($P(A,"(",2),","),$C(34))_U_$TR($P(B,U,2),$C(34))_U_$P($G(^SCPT(404.43,+$P(B,U,3),0)),U,13)_U_$P($G(^SCPT(404.43,+$P(B,U,3),0)),U,14)
"RTN","SCMCTSK1",91,0)
 .S CNT=CNT+1
"RTN","SCMCTSK1",92,0)
 Q
"RTN","SCMCTSK1",93,0)
POS I '$$DATES^SCAPMCU1(404.59,POS) Q  ;Position inact
"RTN","SCMCTSK1",94,0)
 I '$P($G(^SCTM(404.57,POS,0)),U,4) Q  ;Not PC
"RTN","SCMCTSK1",95,0)
 ;patients for position
"RTN","SCMCTSK1",96,0)
 K ^TMP("SC TMP LIST",$J)
"RTN","SCMCTSK1",97,0)
 S X=$$PTTP^SCAPMC(POS,"",.SCLIST,.SCERR)
"RTN","SCMCTSK1",98,0)
 S J=0 F  S J=$O(@SCLIST@(J)) Q:'J  S SCDATA=^(J) D
"RTN","SCMCTSK1",99,0)
 .N J I $P(SCDATA,U,4)>STDT Q
"RTN","SCMCTSK1",100,0)
 .I '$P($G(^SCPT(404.43,+$P(SCDATA,U,3),0)),U,5) Q
"RTN","SCMCTSK1",101,0)
 .I '$P($G(^SCPT(404.43,+$P(SCDATA,U,3),0)),U,15) Q
"RTN","SCMCTSK1",102,0)
 .S DFN=+SCDATA
"RTN","SCMCTSK1",103,0)
 .D SEEN(DFN,POS,TYDT,SDDT,.PROV,.PRECP,.SEEN) Q:SEEN
"RTN","SCMCTSK1",104,0)
 .S SDDATA($P($G(^SCTM(404.57,POS,0)),U),$P(SCDATA,U,2),+SCDATA)=SCDATA,CNT=CNT+1
"RTN","SCMCTSK1",105,0)
 K @SCLIST
"RTN","SCMCTSK1",106,0)
 Q
"RTN","SCMCTSK1",107,0)
FILE(RES,DATA) ;File data on FTEE
"RTN","SCMCTSK1",108,0)
 N I
"RTN","SCMCTSK1",109,0)
 F I=1:1 Q:'$D(DATA(I))  D
"RTN","SCMCTSK1",110,0)
 .S $P(DATA(I),U,7)=$TR($P(DATA(I),U,7),"[]")
"RTN","SCMCTSK1",111,0)
 .S ZERO=$G(^SCPT(404.43,+DATA(I),0))
"RTN","SCMCTSK1",112,0)
 .I $P(ZERO,U,13)=$P(DATA(I),U,6) I $P(ZERO,U,14)=$P(DATA(I),U,7) Q
"RTN","SCMCTSK1",113,0)
 .S FLDA(404.43,(+DATA(I))_",",.13)=$P(DATA(I),U,6)
"RTN","SCMCTSK1",114,0)
 .S FLDA(404.43,(+DATA(I))_",",.14)=$E($P(DATA(I),U,7),1,50)
"RTN","SCMCTSK1",115,0)
 .S FLDA(404.43,(+DATA(I))_",",.16)="`"_(+$G(DUZ))
"RTN","SCMCTSK1",116,0)
 I $O(FLDA(0)) D FILE^DIE("E","FLDA","ERR")
"RTN","SCMCTSK1",117,0)
 Q
"RTN","SCMCTSK1",118,0)
SCREEN ;Active assign. screen
"RTN","SCMCTSK1",119,0)
 N A S A=$G(^SCTM(404.52,D0,0))
"RTN","SCMCTSK1",120,0)
 N J S J=-(DT+1),J=$O(^SCTM(404.52,"AIDT",+A,1,J)) I J="" S X=0 Q
"RTN","SCMCTSK1",121,0)
 I '$P($G(^SCTM(404.57,+A,0)),U,4) Q  ;Not PC
"RTN","SCMCTSK1",122,0)
 I '$$DATES^SCAPMCU1(404.59,+A) Q   ;Not an active position
"RTN","SCMCTSK1",123,0)
 I $O(^SCTM(404.52,"AIDT",+A,0,-(DT+1)))<J S X=0 Q
"RTN","SCMCTSK1",124,0)
 I '$D(^SCTM(404.52,"AIDT",+A,1,J,D0)) S X=0 Q
"RTN","SCMCTSK1",125,0)
 S X=1 Q
"RTN","SCMCTSK1",126,0)
SUM(PR,POSI) ;get pos for prov
"RTN","SCMCTSK1",127,0)
 N I,INS,ZERO,SCA,TEAM,FTEE,Z
"RTN","SCMCTSK1",128,0)
 S I="",FTEE=0
"RTN","SCMCTSK1",129,0)
 F  S I=$O(^SCTM(404.52,"C",PR,I),-1) Q:'I  D
"RTN","SCMCTSK1",130,0)
 .S ZERO=$G(^SCTM(404.52,I,0)) Q:$D(SCA(+ZERO))  Q:(POSI=(+ZERO))  S SCA(+ZERO)=""
"RTN","SCMCTSK1",131,0)
 .S INS=$P($G(^SCTM(404.51,+$P($G(^SCTM(404.57,+ZERO,0)),U,2),0)),U,7)
"RTN","SCMCTSK1",132,0)
 .S ACTIVE=$$DATES^SCAPMCU1(404.52,+ZERO,DT+.5) Q:'ACTIVE
"RTN","SCMCTSK1",133,0)
 .S (Z,ZERO)=$G(^SCTM(404.52,+$P(ACTIVE,U,4),0)) Q:$P(Z,U,3)'=PR
"RTN","SCMCTSK1",134,0)
 .S ACTIVE=$$DATES^SCAPMCU1(404.59,+Z,DT+.5) Q:'ACTIVE
"RTN","SCMCTSK1",135,0)
 .S Z=$G(^SCTM(404.57,+Z,0))
"RTN","SCMCTSK1",136,0)
 .Q:'$P(Z,U,4)  ;Cannot be primary
"RTN","SCMCTSK1",137,0)
 .S TEAM=$G(^SCTM(404.51,+$P(Z,U,2),0))
"RTN","SCMCTSK1",138,0)
 .Q:'$P(TEAM,U,5)
"RTN","SCMCTSK1",139,0)
 .S FTEE=FTEE+$P(ZERO,U,9)
"RTN","SCMCTSK1",140,0)
 Q FTEE
"RTN","SCMCTSK1",141,0)
FTEECHK(DATA,PAIEN) ;check Ftee>1
"RTN","SCMCTSK1",142,0)
 N A S A=$G(^SCTM(404.52,+PAIEN,0)),FTEE=$$SUM(+$P(PAIEN,U,3),+A)
"RTN","SCMCTSK1",143,0)
 S DATA=0
"RTN","SCMCTSK1",144,0)
 S DATA=FTEE+$P(PAIEN,U,2)
"RTN","SCMCTSK1",145,0)
 Q
"RTN","SCMCTSK1",146,0)
SORT(DIPA,SDD) ;sort tmpl
"RTN","SCMCTSK1",147,0)
 N DIC
"RTN","SCMCTSK1",148,0)
 S DIC=4,DIC(0)="ZME"
"RTN","SCMCTSK1",149,0)
 S DIC("S")="I $D(^SCTM(404.51,""AINST"",+Y))"
"RTN","SCMCTSK1",150,0)
 S DIR("A")="Start with Institution",DIR("B")="FIRST",DIR(0)="F" D ^DIR
"RTN","SCMCTSK1",151,0)
 I X="FIRST" S DIPA("SI")="",DIPA("EI")="zzz",SDD=1 Q
"RTN","SCMCTSK1",152,0)
 D ^DIC I Y<0 S DIPA("SI")=X S SDD=X Q:SDD[U  D
"RTN","SCMCTSK1",153,0)
 .S DIR("A")="Go to Institutiton",DIR("B")="LAST" S DIR(0)="F" D ^DIR
"RTN","SCMCTSK1",154,0)
 .I X="LAST" S DIPA("EI")="zzz"
"RTN","SCMCTSK1",155,0)
 I Y>0 S DIPA("SI")=$P(Y(0),U),DIC(0)="AZQME",DIC("A")="Go to Institution: "
"RTN","SCMCTSK1",156,0)
 D ^DIC
"RTN","SCMCTSK1",157,0)
 I Y>0 S DIPA("EI")=$P(Y(0),U)
"RTN","SCMCTSK1",158,0)
 I Y<0 S DIPA("EI")=X S SDD=X Q:SDD[U
"RTN","SCMCTSK1",159,0)
 S SDD=1 Q
"RTN","SCMCTSK1",160,0)
FTEERPT ;FTEE REPORT
"RTN","SCMCTSK1",161,0)
 D FTERPT^SCMCTSK6 Q
"RTN","SCMCTSK1",162,0)
 Q
"RTN","SCMCTSK1",163,0)
POSCHK(DATA,INFO) ;
"RTN","SCMCTSK1",164,0)
 N PCLASS
"RTN","SCMCTSK1",165,0)
 ;TEAM POSITION IEN^PC^STANDARD POSITITION IEN
"RTN","SCMCTSK1",166,0)
 I '$P(INFO,U,3) S DATA="1^Role Must be Entered" Q
"RTN","SCMCTSK1",167,0)
 I $P(INFO,U,2) I '$P($G(^SD(403.46,+$P(INFO,U,3),0)),U,3) S DATA="1^This Role cannot provide Primary Care" Q
"RTN","SCMCTSK1",168,0)
 I $P(INFO,U,2),($P($G(^SD(403.46,+$P(INFO,U,3),0)),U,3)=2) I '$$DATES^SCAPMCU1(404.53,+INFO) S DATA="1^This Role cannot provide Primary Care unless Precepted" Q
"RTN","SCMCTSK1",169,0)
 S DATA=0
"RTN","SCMCTSK1",170,0)
 I ('INFO)!('$P(INFO,U,2)) Q
"RTN","SCMCTSK1",171,0)
 ;Is provider role acceptable?
"RTN","SCMCTSK1",172,0)
 S J=-(DT+1) S J=$O(^SCTM(404.52,"AIDT",+INFO,1,J)) Q:J=""
"RTN","SCMCTSK1",173,0)
 I $O(^SCTM(404.52,"AIDT",+INFO,0,-(DT+1)))<J Q
"RTN","SCMCTSK1",174,0)
 S K=0 S K=$O(^SCTM(404.52,"AIDT",+INFO,1,J,K)) Q:'K
"RTN","SCMCTSK1",175,0)
 S ZERO=$G(^SCTM(404.52,+K,0))
"RTN","SCMCTSK1",176,0)
 ;Get person class for provider
"RTN","SCMCTSK1",177,0)
 S PCLASS=$$GET^XUA4A72(+$P(ZERO,U,3))
"RTN","SCMCTSK1",178,0)
 ;IEN^Occupation^specialty^sub-specialty^Effective date^expiration date^VA Code^specialty code
"RTN","SCMCTSK1",179,0)
 I '$D(^SD(403.46,+$P(INFO,U,3),2,"B",+PCLASS)) S DATA="1^Person Class of "_$$GET1^DIQ(200,(+$P(ZERO,U,3))_",",.01)_" is not valid in this Role." D POSCHK^SCMCTSK4
"RTN","SCMCTSK1",180,0)
 Q
"RTN","SCMCTSK1",181,0)
SEED ;seed one patient/provider
"RTN","SCMCTSK1",182,0)
 W !,"To retransmit all patients for a given provider press return to select the provider",!!
"RTN","SCMCTSK1",183,0)
 N DIC,SCADT,SCDDT,SCPAI
"RTN","SCMCTSK1",184,0)
 S SC177=$$PDAT^SCMCGU("SD*5.3*177")
"RTN","SCMCTSK1",185,0)
 I +SC177=0 D  Q
"RTN","SCMCTSK1",186,0)
 . S SC2="  Unable to obtain SD*5.3*177 Installation Date."
"RTN","SCMCTSK1",187,0)
 . D MSG^SCMCCV6(SC1,SC2)
"RTN","SCMCTSK1",188,0)
 . Q
"RTN","SCMCTSK1",189,0)
 S DIC="^DPT(",DIC(0)="MEQA" D ^DIC G PRSEED:Y'>0
"RTN","SCMCTSK1",190,0)
 ;event filer for 1 patient
"RTN","SCMCTSK1",191,0)
 S SCDFN=+Y W !,SCDFN
"RTN","SCMCTSK1",192,0)
SCDFN S SC1="^SCPT(404.43,""APCPOS"",SCDFN,1)"
"RTN","SCMCTSK1",193,0)
 ;quit if no PC assign
"RTN","SCMCTSK1",194,0)
 Q:'$D(@SC1)
"RTN","SCMCTSK1",195,0)
 S SCADT=0
"RTN","SCMCTSK1",196,0)
 F  S SCADT=$O(@SC1@(SCADT)) Q:SCADT=""  D
"RTN","SCMCTSK1",197,0)
 .S SCTP=0
"RTN","SCMCTSK1",198,0)
 .F  S SCTP=$O(@SC1@(SCADT,SCTP)) Q:'SCTP  D
"RTN","SCMCTSK1",199,0)
 ..; quit if team position does not exist
"RTN","SCMCTSK1",200,0)
 ..Q:'$D(^SCTM(404.57,SCTP,0))
"RTN","SCMCTSK1",201,0)
 ..S SCPAI=0
"RTN","SCMCTSK1",202,0)
 ..F  S SCPAI=$O(@SC1@(SCADT,SCTP,SCPAI)) Q:'SCPAI  D
"RTN","SCMCTSK1",203,0)
 ...S SCDDT=$P($G(^SCPT(404.43,SCPAI,0)),U,4)
"RTN","SCMCTSK1",204,0)
 ...;quit if not active within date range
"RTN","SCMCTSK1",205,0)
 ...Q:$$DTCHK^SCAPU1(SC177,DT,0,SCADT,SCDDT)<1
"RTN","SCMCTSK1",206,0)
 ...N SCVAR S SCVAR=SCPAI_";SCPT(404.43,"
"RTN","SCMCTSK1",207,0)
 ...;add to HL7 event file
"RTN","SCMCTSK1",208,0)
 ...Q:$D(^SCPT(404.48,"AACXMIT",SCVAR))
"RTN","SCMCTSK1",209,0)
 ...Q:$$CHECK^SCMCHLB1(SCVAR)'=1
"RTN","SCMCTSK1",210,0)
 ...D ADD^SCMCHLE("NOW",SCVAR,SCDFN,SCTP)
"RTN","SCMCTSK1",211,0)
 Q
"RTN","SCMCTSK1",212,0)
PRSEED ;seed practitioner
"RTN","SCMCTSK1",213,0)
 N AH,SC177
"RTN","SCMCTSK1",214,0)
 S SC177=$$PDAT^SCMCGU("SD*5.3*177")
"RTN","SCMCTSK1",215,0)
 I +SC177=0 D  Q
"RTN","SCMCTSK1",216,0)
 . S SC2=" No SD*5.3*177 Installation Date."
"RTN","SCMCTSK1",217,0)
 . D MSG^SCMCCV6(SC1,SC2)
"RTN","SCMCTSK1",218,0)
 S DIC=200,DIC(0)="MEQA",DIC("A")="Select Provider: " D ^DIC Q:Y'>0
"RTN","SCMCTSK1",219,0)
 S SCPROV=+Y
"RTN","SCMCTSK1",220,0)
 F AH=0:0 S AH=$O(^SCTM(404.52,"C",SCPROV,AH)) Q:'AH  S TP=+$G(^SCTM(404.52,+AH,0)) D
"RTN","SCMCTSK1",221,0)
 . Q:$D(SCTP(TP))
"RTN","SCMCTSK1",222,0)
 . S SCTP(TP)=1
"RTN","SCMCTSK1",223,0)
 . F SCDFN=0:0 S SCDFN=$O(^SCPT(404.43,"ADFN",SCDFN)) Q:'SCDFN  I $D(^(SCDFN,TP)) I '$D(SCU(SCDFN)) D SCDFN S SCU(SCDFN)=1
"RTN","SCMCTSK1",224,0)
 . Q:'$P($G(^SCTM(404.57,TP,0)),U,4)
"RTN","SCMCTSK1",225,0)
 . S SCVAR=AH_";SCTM(404.52,"
"RTN","SCMCTSK1",226,0)
 . ;Quit if an event entry already exists
"RTN","SCMCTSK1",227,0)
 . N QUIT,I S QUIT=0
"RTN","SCMCTSK1",228,0)
 . F I=0:0 S I=$O(^SCPT(404.48,"AACXMIT",SCVAR,I)) Q:'I  I $P($G(^SCPT(404.48,I,0)),U,8) S QUIT=1 Q
"RTN","SCMCTSK1",229,0)
 . Q:QUIT
"RTN","SCMCTSK1",230,0)
 . D ADD^SCMCHLE("NOW",SCVAR,,AH,1)
"RTN","SCMCTSK1",231,0)
 Q
"RTN","SCMCTSK1",232,0)
INCON ;inconsistent PC assignments
"RTN","SCMCTSK1",233,0)
 N POS
"RTN","SCMCTSK1",234,0)
 D INCON^SCMCTSK3
"RTN","SCMCTSK1",235,0)
 Q
"RTN","SCMCTSK1",236,0)
INCONR ;inconsistent report
"RTN","SCMCTSK1",237,0)
 N BY
"RTN","SCMCTSK1",238,0)
 K ^TMP("SCMCTSK",$J)
"RTN","SCMCTSK1",239,0)
 S DIC="^SCTM(404.57,",(FLDS,BY)="[SCMC INCONSISTENT]",DIOBEG="D INCON^SCMCTSK1"
"RTN","SCMCTSK1",240,0)
 D EN1^DIP
"RTN","SCMCTSK1",241,0)
 Q
"RTN","SCMCTSK1",242,0)
INACTDT(PA) ;Scheduled inactivation date.
"RTN","SCMCTSK1",243,0)
 D INACT^SCMCTSK3 Q
"RTN","SCMCTSK1",244,0)
IU(DFN) ;is patient inactivity unassigned
"RTN","SCMCTSK1",245,0)
 Q $$IU^SCMCTSK3(DFN)
"RTN","SCMCTSK1",246,0)
 N I,A,B,DATA
"RTN","SCMCTSK2")
0^4^B91467456^B89984359
"RTN","SCMCTSK2",1,0)
SCMCTSK2 ;ALB/JDS - PCMM Inactivation Nightly Job; 18 Apr 2003  9:36 AM ; 10/24/07 12:23pm  ; Compiled November 21, 2007 13:32:47  ; Compiled March 17, 2008 15:27:15
"RTN","SCMCTSK2",2,0)
 ;;5.3;Scheduling;**297,498,527,499**;AUG 13, 1993;Build 21
"RTN","SCMCTSK2",3,0)
 Q
"RTN","SCMCTSK2",4,0)
NIGHT ;
"RTN","SCMCTSK2",5,0)
 N ENDDT,NOINAC,SIXM,FLGDT,L,PATDT,SEEN,SDDT
"RTN","SCMCTSK2",6,0)
 D DT^DICRW S SDDT=$P($G(^XTMP("SCMCTSK2-"_DT,0)),U,2)
"RTN","SCMCTSK2",7,0)
 I SDDT="" S SDDT=DT
"RTN","SCMCTSK2",8,0)
 S ALPHA=$G(^SCTM(404.44,1,1)),ALPHA=$P(ALPHA,U,8) I ALPHA<SDDT S ALPHA=0
"RTN","SCMCTSK2",9,0)
 ;if 'ALPHA NOINAC=1 except 15th and the Last Day of a Month (LDoM)
"RTN","SCMCTSK2",10,0)
 ;inact only on 15th and on LDoM
"RTN","SCMCTSK2",11,0)
 S NOINAC=0
"RTN","SCMCTSK2",12,0)
 I 'ALPHA  S X1=SDDT,X2=1 D C^%DTC I ($E(SDDT,6,7)'=15)&($E(SDDT,1,5)=$E(X,1,5)) S NOINAC=1
"RTN","SCMCTSK2",13,0)
 I 'ALPHA D INACTIVE^SCMCTSK1
"RTN","SCMCTSK2",14,0)
 S SIXM=$P($G(^SCTM(404.44,1,1)),U,9)
"RTN","SCMCTSK2",15,0)
 I SIXM D PRFLAG
"RTN","SCMCTSK2",16,0)
 I ALPHA D INACTIVE^SCMCTSK1
"RTN","SCMCTSK2",17,0)
 ;determine ENDDT-Inactn Date-30 days if flagged today
"RTN","SCMCTSK2",18,0)
 F DATE=0:0 S DATE=$O(^SCPT(404.43,"AFLG",DATE)) Q:'DATE  D
"RTN","SCMCTSK2",19,0)
 .F ENTRY=0:0 S ENTRY=$O(^SCPT(404.43,"AFLG",DATE,ENTRY)) Q:'ENTRY  D
"RTN","SCMCTSK2",20,0)
 ..S ZERO=$G(^SCPT(404.43,ENTRY,0)) Q:'ZERO
"RTN","SCMCTSK2",21,0)
 ..S DFN=+$G(^SCPT(404.42,+ZERO,0)) Q:'DFN
"RTN","SCMCTSK2",22,0)
 ..S POS=$P(ZERO,U,2)
"RTN","SCMCTSK2",23,0)
 ..I $P(ZERO,U,4) D UNFLG Q  ;unass.
"RTN","SCMCTSK2",24,0)
 ..S X1=DATE,X2=$S(ALPHA:+2,1:+30) D C^%DTC S ENDDT=X
"RTN","SCMCTSK2",25,0)
 ..N SDASS S SDASS=$P(ZERO,U,3)
"RTN","SCMCTSK2",26,0)
 ..;N-new or E-stbl.
"RTN","SCMCTSK2",27,0)
 ..;assig >12 months since flagging, not NEW, E-stbl)
"RTN","SCMCTSK2",28,0)
 ..N NEW
"RTN","SCMCTSK2",29,0)
 ..S NEW=0 S X1=DATE,X2=SDASS D ^%DTC I X<365 S NEW=1
"RTN","SCMCTSK2",30,0)
 ..I NEW S %DT="",X="T-12M" D ^%DT S STDT=+Y D
"RTN","SCMCTSK2",31,0)
 ...S X1=STDT,X2=-7 D C^%DTC S TYDT=X
"RTN","SCMCTSK2",32,0)
 ..I 'NEW S %DT="",X="T-24M" D ^%DT S STDT=+Y D
"RTN","SCMCTSK2",33,0)
 ...S X1=STDT,X2=-7 D C^%DTC S TYDT=X
"RTN","SCMCTSK2",34,0)
 ..;
"RTN","SCMCTSK2",35,0)
 ..I $P(ZERO,U,17) D UNFLG Q  ;react.
"RTN","SCMCTSK2",36,0)
 ..;get prec 
"RTN","SCMCTSK2",37,0)
 ..;S %DT="",X="T-12M" D ^%DT S STDT=+Y
"RTN","SCMCTSK2",38,0)
 ..;S PREC=$$DATES^SCAPMCU1(404.53,+POS),PREC=$S(PREC:$P($G(^SCTM(404.53,+$P(PREC,U,4),0)),U,6),1:+POS)
"RTN","SCMCTSK2",39,0)
 ..I '$P(ZERO,U,5) D UNFLG Q  ;Not PC
"RTN","SCMCTSK2",40,0)
 ..D SEEN^SCMCTSK1(DFN,POS,TYDT,SDDT,.PROV,.PRECP,.SEEN)
"RTN","SCMCTSK2",41,0)
 ..;S PC=$$GET^XUA4A72(+PROV)
"RTN","SCMCTSK2",42,0)
 ..I SEEN D UNFLG Q
"RTN","SCMCTSK2",43,0)
 ..I $P(ZERO,U,13) S X1=DATE,X2=$S(ALPHA:4,1:90) D C^%DTC S FLGDT=X I FLGDT>SDDT Q  ;do not inactivate yet; extended
"RTN","SCMCTSK2",44,0)
 ..I ('NOINAC)&(SDDT'<ENDDT) D DIS^SCMCTSK1
"RTN","SCMCTSK2",45,0)
 ;flag prov 6m after install sd/297
"RTN","SCMCTSK2",46,0)
 I NOINAC D:ALPHA BULL I '$D(^SCPT(404.43,"AFLG",SDDT)) K ^TMP($J,"SCMCTSK2") Q
"RTN","SCMCTSK2",47,0)
 ;flag prov 6m after install sd/297
"RTN","SCMCTSK2",48,0)
 I SIXM,SIXM'>SDDT D
"RTN","SCMCTSK2",49,0)
 .D PRINAC
"RTN","SCMCTSK2",50,0)
 .N FLDA
"RTN","SCMCTSK2",51,0)
 .S FLDA(404.44,"1,",19)=""
"RTN","SCMCTSK2",52,0)
 .D FILE^DIE("I","FLDA","ERR")
"RTN","SCMCTSK2",53,0)
 D BULL K ^TMP($J,"SCMCTSK2")
"RTN","SCMCTSK2",54,0)
 Q
"RTN","SCMCTSK2",55,0)
UNFLG ;Unflagging
"RTN","SCMCTSK2",56,0)
 N DR,DIE,DA
"RTN","SCMCTSK2",57,0)
 S DR=".15///@;.13///@;.12///@",DIE="^SCPT(404.43,",DA=ENTRY D ^DIE
"RTN","SCMCTSK2",58,0)
 Q
"RTN","SCMCTSK2",59,0)
PRFLAG ;flag incorrect provider pos
"RTN","SCMCTSK2",60,0)
 N POS
"RTN","SCMCTSK2",61,0)
 ;prov inact. has run once
"RTN","SCMCTSK2",62,0)
 I $P($G(^SCTM(404.44,1,1)),U,11)'="" Q
"RTN","SCMCTSK2",63,0)
 D PRFLAG^SCMCTSK3
"RTN","SCMCTSK2",64,0)
 Q
"RTN","SCMCTSK2",65,0)
PRINAC ;inact. flagged providers
"RTN","SCMCTSK2",66,0)
 N I,II
"RTN","SCMCTSK2",67,0)
 ;Prov inact. run already
"RTN","SCMCTSK2",68,0)
 I $G(SDDT)="" S SDDT=DT
"RTN","SCMCTSK2",69,0)
 S II=$P($G(^SCTM(404.44,1,1)),U,11) I II'="",II'=SDDT Q
"RTN","SCMCTSK2",70,0)
 F I=0:0 S I=$O(^SCTM(404.52,I)) Q:'I  S ZERO=$G(^(I,0)) I $P(ZERO,U,10) D
"RTN","SCMCTSK2",71,0)
 .;I $P(ZERO,U,10)>$G(ENDT) Q   ;not time yet
"RTN","SCMCTSK2",72,0)
 .I $O(^SCTM(404.52,"AIDT",+ZERO,0,-9999999))<(-$P(ZERO,U,2)) Q   ;inactivated
"RTN","SCMCTSK2",73,0)
 .;Check valid criteria
"RTN","SCMCTSK2",74,0)
 .S POS=+ZERO
"RTN","SCMCTSK2",75,0)
 .S PROV=+$$GETPRTP^SCAPMCU2(POS,SDDT)
"RTN","SCMCTSK2",76,0)
 .S PC=$$GET^XUA4A72(+PROV)
"RTN","SCMCTSK2",77,0)
 .S DR=".091///@",DIE="^SCTM(404.52,",DA=I D ^DIE  ;remove flag
"RTN","SCMCTSK2",78,0)
 .S ZERO1=$G(^SCTM(404.57,POS,0))
"RTN","SCMCTSK2",79,0)
 .I '$D(^SD(403.46,+$P(ZERO1,U,3),2,+PC)) D
"RTN","SCMCTSK2",80,0)
 ..;inactivation
"RTN","SCMCTSK2",81,0)
 ..S DIC="^SCTM(404.52,",X=+ZERO,DIC("DR")=".02////"_SDDT_";.03////"_$P(ZERO,U,3)_";.04////0;.05///EMPLOYEE LEAVES POSITION;.11////1"
"RTN","SCMCTSK2",82,0)
 ..S DIC(0)="LM" D ^DIC
"RTN","SCMCTSK2",83,0)
 ;only run inact. once
"RTN","SCMCTSK2",84,0)
 S $P(^SCTM(404.44,1,1),U,11)=SDDT
"RTN","SCMCTSK2",85,0)
 Q
"RTN","SCMCTSK2",86,0)
FUTAPP(DFN) ;print future appts
"RTN","SCMCTSK2",87,0)
 N TAB,SCDT0 S TAB=$X
"RTN","SCMCTSK2",88,0)
 I $G(SDDT)="" S SDDT=DT
"RTN","SCMCTSK2",89,0)
 S SCDT=SDDT+.24
"RTN","SCMCTSK2",90,0)
 F  S SCDT=$O(^DPT(DFN,"S",SCDT)) Q:'SCDT  D
"RTN","SCMCTSK2",91,0)
 . S SCDT0=$G(^DPT(DFN,"S",SCDT,0)) Q:$L($P(SCDT0,U,2))
"RTN","SCMCTSK2",92,0)
 . S CLIEN=$P(SCDT0,"^") Q:'CLIEN
"RTN","SCMCTSK2",93,0)
 . S Y=SCDT X ^DD("DD") W $E(Y_" ",1,17)_" "_$E($P($G(^SC(+CLIEN,0)),U),1,10)
"RTN","SCMCTSK2",94,0)
 Q
"RTN","SCMCTSK2",95,0)
GETASC(DATA,ENTRY) ;get assoc. clinics
"RTN","SCMCTSK2",96,0)
 N I,CNT S CNT=0
"RTN","SCMCTSK2",97,0)
 F I=0:0 S I=$O(^SCTM(404.57,+$G(ENTRY),5,I)) Q:'I  S CNT=CNT+1,DATA(CNT)=I_U_$P($G(^SC(I,0)),U)
"RTN","SCMCTSK2",98,0)
 Q
"RTN","SCMCTSK2",99,0)
SETASC(RESULT,DATA) ;set assoc. clinics
"RTN","SCMCTSK2",100,0)
 D SETASC^SCMCTSK7(.RESULT,DATA) Q
"RTN","SCMCTSK2",101,0)
MSG(SCTP,DFN) ;send inact. message
"RTN","SCMCTSK2",102,0)
 ;given valid positions get current practitioners
"RTN","SCMCTSK2",103,0)
 S SCLIST="SCL"
"RTN","SCMCTSK2",104,0)
 I $G(SDDT)="" S SDDT=DT
"RTN","SCMCTSK2",105,0)
 I "N"'[$P($G(^SCTM(404.57,SCTP,2)),U,9) D
"RTN","SCMCTSK2",106,0)
 .S SCOK=$$PRTP^SCAPMC(SCTP,"",.SCLIST,.SCERR)
"RTN","SCMCTSK2",107,0)
 .;if preceptor notice turned on for message type
"RTN","SCMCTSK2",108,0)
 I +$P($G(^SCTM(404.57,SCTP,2)),U,9) D
"RTN","SCMCTSK2",109,0)
 .S SCX=+$$OKPREC2^SCMCLK(SCTP,SDDT)
"RTN","SCMCTSK2",110,0)
 .;if preceptor duz returned, add to array
"RTN","SCMCTSK2",111,0)
 .I SCX S @SCLIST@("SCPR",SCX)=""
"RTN","SCMCTSK2",112,0)
 N XMY F I=0:0 S I=$O(@SCLIST@("SCPR",I)) Q:'I  S XMY(I)=""
"RTN","SCMCTSK2",113,0)
 S SCTEXT(1,0)="PATIENT "_$P($G(^DPT(DFN,0)),U)_" has been inactivated from PC team position "_$P($G(^SCTM(404.57,SCTP,0)),U)
"RTN","SCMCTSK2",114,0)
 S XMSUB="Provider's Inactivated Primary Care Patients" D ^XMD
"RTN","SCMCTSK2",115,0)
 Q
"RTN","SCMCTSK2",116,0)
BULL ;EOM Bulletin
"RTN","SCMCTSK2",117,0)
 N DISUPNO,BY,DHIT,HEAD
"RTN","SCMCTSK2",118,0)
 S DISUPNO=1,L=0
"RTN","SCMCTSK2",119,0)
 S XMSUB="Patients Scheduled for Inactivation from PC Panel"
"RTN","SCMCTSK2",120,0)
 S XMY("G.PCMM PATIENT/PROVIDER INACTIVE")=""
"RTN","SCMCTSK2",121,0)
 K ^TMP("SCMC",$J),^TMP("SCMCTXT",$J),^TMP("SCML",$J)
"RTN","SCMCTSK2",122,0)
 S XMTEXT="^TMP(""SCMCTXT"",$J," ;S @XMTEXT@(0)=""
"RTN","SCMCTSK2",123,0)
 S DIC="^SCPT(404.43,",BY="[SCMC FLAGGED BULLETIN]",FLDS="[SC BULLETIN]",CNT=0
"RTN","SCMCTSK2",124,0)
 S:0 FLDS="" S IOP="",DHD="@@",(FR,TO)="" D EN1^DIP
"RTN","SCMCTSK2",125,0)
 S ^TMP("SCMCTXT",$J,1,0)="There are "_$O(^TMP("SCMC",$J,""),-1)_" Patients scheduled for inactivation in next 30 days"
"RTN","SCMCTSK2",126,0)
 D LINES(1)
"RTN","SCMCTSK2",127,0)
 D ^XMD
"RTN","SCMCTSK2",128,0)
 D PRMAIL^SCMCTSK5(1)
"RTN","SCMCTSK2",129,0)
 F SCI=0:0 S SCI=$O(^TMP("SCF",$J,SCI)) Q:'SCI  D
"RTN","SCMCTSK2",130,0)
 .K XMY S XMY(SCI)="" K ^TMP("SCMC",$J),^TMP("SCMCTXT",$J)
"RTN","SCMCTSK2",131,0)
 .M ^TMP("SCMC",$J)=^TMP("SCF",$J,SCI)
"RTN","SCMCTSK2",132,0)
 .S XMSUB="Patients Scheduled for Inactivation from PC Panel"
"RTN","SCMCTSK2",133,0)
 .S XMTEXT="^TMP(""SCMCTXT"",$J,"
"RTN","SCMCTSK2",134,0)
 S DISUPNO=1
"RTN","SCMCTSK2",135,0)
 K ^TMP("SCMC",$J),^TMP("SCMCTXT")
"RTN","SCMCTSK2",136,0)
 I $G(NOINAC) K ^TMP($J,"SCMCTSK2") Q  ; SD/499
"RTN","SCMCTSK2",137,0)
 S XMSUB="Patients With Extended PCMM Inactivation Dates"
"RTN","SCMCTSK2",138,0)
 S XMY("G.PCMM PATIENT/PROVIDER INACTIVE")=""
"RTN","SCMCTSK2",139,0)
 K ^TMP("SCMC",$J)
"RTN","SCMCTSK2",140,0)
 S XMTEXT="^TMP(""SCMCTXT"",$J," ;S @XMTEXT@(0)=""
"RTN","SCMCTSK2",141,0)
 S DIC="^SCPT(404.43,",BY="[SCMC EXTENDED BULLETIN]",DHIT="S CNT=$G(CNT)+1,^TMP(""SCMC"",$J,CNT,D0)=""""",CNT=0
"RTN","SCMCTSK2",142,0)
 S FR=",,,",TO=FR,FLDS="",IOP="",DHD="@@" D EN1^DIP
"RTN","SCMCTSK2",143,0)
 S ^TMP("SCMCTXT",$J,1,0)="There are "_$O(^TMP("SCMC",$J,""),-1)_" Patients Extended from inactivation"
"RTN","SCMCTSK2",144,0)
 D LINES(3)
"RTN","SCMCTSK2",145,0)
 D ^XMD
"RTN","SCMCTSK2",146,0)
 D PRMAIL^SCMCTSK5(3)
"RTN","SCMCTSK2",147,0)
 S DISUPNO=1
"RTN","SCMCTSK2",148,0)
 K ^TMP("SCMC",$J),^TMP("SCMCTXT")
"RTN","SCMCTSK2",149,0)
 S XMSUB="Patients Automated Inactivations from PC Panels"
"RTN","SCMCTSK2",150,0)
 S XMY("G.PCMM PATIENT/PROVIDER INACTIVE")=""
"RTN","SCMCTSK2",151,0)
 K ^TMP("SCMC",$J)
"RTN","SCMCTSK2",152,0)
 S XMTEXT="^TMP(""SCMCTXT"",$J," ;S @XMTEXT@(0)=""
"RTN","SCMCTSK2",153,0)
 S DIC="^SCPT(404.43,",BY="[SCMC INACTIVATED]",DHIT="S CNT=$G(CNT)+1,^TMP(""SCMC"",$J,CNT,D0)=""""",CNT=0
"RTN","SCMCTSK2",154,0)
 S FLDS="",IOP="",DHD="@@",FR=",T-30,,",TO=",,,,," D EN1^DIP
"RTN","SCMCTSK2",155,0)
 S ^TMP("SCMCTXT",$J,1,0)="There are "_$O(^TMP("SCMC",$J,""),-1)_" Patients Inactivated in last 30 days"
"RTN","SCMCTSK2",156,0)
 D LINES(2)
"RTN","SCMCTSK2",157,0)
 D ^XMD
"RTN","SCMCTSK2",158,0)
 S DISUPNO=1
"RTN","SCMCTSK2",159,0)
 D PRMAIL^SCMCTSK5(2)
"RTN","SCMCTSK2",160,0)
 K ^TMP("SCMC",$J),^TMP("SCMCTXT")
"RTN","SCMCTSK2",161,0)
 I $P($G(^SCTM(404.44,1,1)),U,11)="" D
"RTN","SCMCTSK2",162,0)
 . S XMSUB="PC Providers Scheduled for Inactivation"
"RTN","SCMCTSK2",163,0)
 . S XMY("G.PCMM PATIENT/PROVIDER INACTIVE")=""
"RTN","SCMCTSK2",164,0)
 . K ^TMP("SCMC",$J)
"RTN","SCMCTSK2",165,0)
 . S XMTEXT="^TMP(""SCMCTXT"",$J,"
"RTN","SCMCTSK2",166,0)
 . S DIC="^SCTM(404.52,",BY="[SC PROVIDER FLAGGED BULLE]",DHIT="S CNT=$G(CNT)+1,^TMP(""SCMC"",$J,CNT,D0)=""""",CNT=0
"RTN","SCMCTSK2",167,0)
 . S FLDS="",IOP="",DHD="@@",FR="",TO="" D EN1^DIP
"RTN","SCMCTSK2",168,0)
 . D LINES(4)
"RTN","SCMCTSK2",169,0)
 . D ^XMD
"RTN","SCMCTSK2",170,0)
 . D PRMAIL^SCMCTSK5(4)
"RTN","SCMCTSK2",171,0)
 . D BULL^SCMCTSK6
"RTN","SCMCTSK2",172,0)
 Q
"RTN","SCMCTSK2",173,0)
LINES(TYPE) ;Lines of Bulletin
"RTN","SCMCTSK2",174,0)
 D LINES^SCMCTSK5(TYPE) Q
"RTN","SCMCTSK2",175,0)
ROLE(DATA,INFO) ;SCMC ROLE
"RTN","SCMCTSK2",176,0)
 N ROLE,TP,I
"RTN","SCMCTSK2",177,0)
 S ROLE=+$G(INFO),TP=+$P($G(INFO),U,2)
"RTN","SCMCTSK2",178,0)
 S DATA(0)="0^0^0"
"RTN","SCMCTSK2",179,0)
 I 'ROLE Q
"RTN","SCMCTSK2",180,0)
 I 'TP Q
"RTN","SCMCTSK2",181,0)
 S DATA(0)=+$P($G(^SD(403.46,ROLE,0)),U,3) ;I DATA(0)=3!(DATA(0)=0) S DATA(0)=DATA(0)_"^0^0" Q
"RTN","SCMCTSK2",182,0)
 I $$DATES^SCAPMCU1(404.53,+TP) S DATA(0)=DATA(0)_"^1^0" Q
"RTN","SCMCTSK2",183,0)
 N PREC S PREC=0
"RTN","SCMCTSK2",184,0)
 F I=0:0 S I=$O(^SCTM(404.53,"AD",TP,I)) Q:'I  D   Q:PREC
"RTN","SCMCTSK2",185,0)
 .I $D(^SCTM(404.53,"AD",TP,I,1)) I '$D(^(0)) S PREC=1
"RTN","SCMCTSK2",186,0)
 I PREC S DATA(0)=DATA(0)_"^0^1" Q
"RTN","SCMCTSK2",187,0)
 S DATA(0)=DATA(0)_"^0^0"
"RTN","SCMCTSK2",188,0)
 Q
"RTN","SCMCTSK2",189,0)
INRPT  ; REPORT
"RTN","SCMCTSK2",190,0)
 N DIOEND,SCDHD
"RTN","SCMCTSK2",191,0)
 D PROMPT^SCMCTSK3("** Date Range Selection **","DATE PATIENTS INACTIVATED FROM PC PANELS")
"RTN","SCMCTSK2",192,0)
 Q:'$D(^TMP("SC",$J,"XR"))
"RTN","SCMCTSK2",193,0)
 D UNASSIGN^SCMCTSK3
"RTN","SCMCTSK2",194,0)
 S Q=""""
"RTN","SCMCTSK2",195,0)
 S DIC="^SCPT(404.43," ;=0,BY="[SCMC INACTIVATION SORT]"
"RTN","SCMCTSK2",196,0)
 D BY
"RTN","SCMCTSK2",197,0)
 S (SCDHD,DHD)="AUTOMATED PATIENT INACTIVATION FROM PRIMARY CARE PANELS REPORT"
"RTN","SCMCTSK2",198,0)
 S DIOBEG="D DIOBEG^SCMCTSK4"
"RTN","SCMCTSK2",199,0)
 S DIOEND="D DIOEND1^SCMCTSK4"
"RTN","SCMCTSK2",200,0)
 S FLDS="[SCMC INACTIVATED]" ;,FR="?,,"_$TR(DIPA("SI"),","," "),TO="T,,"_$TR(DIPA("EI")_"z",","," ")
"RTN","SCMCTSK2",201,0)
 D EN1^DIP
"RTN","SCMCTSK2",202,0)
 Q
"RTN","SCMCTSK2",203,0)
IN30 ;inact. last month
"RTN","SCMCTSK2",204,0)
 N DIPA,SDD D SORT^SCMCTSK1(.DIPA,.SDD) Q:'SDD  ;SD/499
"RTN","SCMCTSK2",205,0)
 S Q=""""
"RTN","SCMCTSK2",206,0)
 S DIC="^SCPT(404.43,",L=0,BY="[SCMC INACTIVATION SORT]"
"RTN","SCMCTSK2",207,0)
 S DHD="Patients Inactivated from Primary Care Panels in the Past Month"
"RTN","SCMCTSK2",208,0)
 S FLDS="[SCMC INACTIVATED]",FR="T-31,,"_$TR(DIPA("SI"),","," "),TO="T,,"_$TR(DIPA("EI")_"z",","," ")
"RTN","SCMCTSK2",209,0)
 D EN1^DIP
"RTN","SCMCTSK2",210,0)
 Q
"RTN","SCMCTSK2",211,0)
EXRPT  ;EXTEND REPORT
"RTN","SCMCTSK2",212,0)
 K CLIN,TEAM,INST
"RTN","SCMCTSK2",213,0)
 D PROMPT^SCMCTSK3("PCMM Patients with Extended Inactivations","Scheduled Inactivation Date")
"RTN","SCMCTSK2",214,0)
 Q:'$D(^TMP("SC",$J,"XR"))
"RTN","SCMCTSK2",215,0)
 S Q="""",SORT=1
"RTN","SCMCTSK2",216,0)
 D EXTEND^SCMCTSK3
"RTN","SCMCTSK2",217,0)
 S DIC="^SCPT(404.43," ;,L=0,BY="[SCMC EXTENDED]"
"RTN","SCMCTSK2",218,0)
 S (SCDHD,DHD)="PCMM Patients with extended Inactivations"
"RTN","SCMCTSK2",219,0)
 S DIOBEG="D DIOBEG^SCMCTSK4",DIOEND="D EXTKEY^SCMCTSK9"
"RTN","SCMCTSK2",220,0)
 D BY
"RTN","SCMCTSK2",221,0)
 S FLDS="[SCMC EXTENDED]"
"RTN","SCMCTSK2",222,0)
 D EN1^DIP
"RTN","SCMCTSK2",223,0)
 Q 
"RTN","SCMCTSK2",224,0)
BY N DISPAR
"RTN","SCMCTSK2",225,0)
 S BY(0)="^TMP(""SCSORT"",$J)",L(0)=$O(^TMP("SC",$J,"SORT",99),-1)+1,DISPAR(0,1)="+",L=0 I $G(SCDHD)["FTEE" S DISPAR(0,1)="+#" ;BY="@'.01"
"RTN","SCMCTSK2",226,0)
 F I=1:1:$L(SORTN,U) S A=$P(SORTN,U,I) Q:'$L(A)  S $P(DISPAR(0,I),U,2)=";"_Q_A_": "_Q D
"RTN","SCMCTSK2",227,0)
 .I A["PATIENT" I (I>1)!($G(SCDHD)["Patients Scheduled for Inactivation from PC Panel") S $P(DISPAR(0,I),U)="@"
"RTN","SCMCTSK2",228,0)
 .I $G(SCDHD)["FTEE" D
"RTN","SCMCTSK2",229,0)
 ..I A["PROV" S $P(DISPAR(0,I),U)="@"
"RTN","SCMCTSK2",230,0)
 ..I I>1 I (A["CLI")!(A["POS") S $P(DISPAR(0,I),U)="@"_$P($G(DISPAR(0,I)),U)
"RTN","SCMCTSK2",231,0)
 S ZTSAVE("^TMP(""SC"",$J,")="",ZTSAVE("^TMP(""SCSORT"",$J,")=""
"RTN","SCMCTSK2",232,0)
 Q
"RTN","SCMCTSK2",233,0)
FLRPT  ;FLAGGED REPORT
"RTN","SCMCTSK2",234,0)
 D PROMPT^SCMCTSK3("Patients Scheduled for Inactivation from PC Panels","Date Scheduled for Inactivation")
"RTN","SCMCTSK2",235,0)
 Q:'$D(^TMP("SC",$J,"XR"))
"RTN","SCMCTSK2",236,0)
 D FLAGG^SCMCTSK3
"RTN","SCMCTSK2",237,0)
 S Q=""""
"RTN","SCMCTSK2",238,0)
 S DIC="^SCPT(404.43,",L=0
"RTN","SCMCTSK2",239,0)
 S (SCDHD,DHD)="Patients Scheduled for Inactivation from PC Panels"
"RTN","SCMCTSK2",240,0)
 D BY
"RTN","SCMCTSK2",241,0)
 S DIOBEG="D DIOBEG^SCMCTSK4"
"RTN","SCMCTSK2",242,0)
 S FLDS="[SCMC PENDING UNASSIGN]"
"RTN","SCMCTSK2",243,0)
 I $G(DISPAR(0,1))["PATIENT" S FLDS="[SCMC PENDING UNASSIGN PAT]"
"RTN","SCMCTSK2",244,0)
 S DIOEND="D DIOEND^SCMCTSK4"
"RTN","SCMCTSK2",245,0)
 D EN1^DIP
"RTN","SCMCTSK3")
0^5^B82723614^B78524925
"RTN","SCMCTSK3",1,0)
SCMCTSK3 ;ALB/JDS - PCMM Inactivation Reports ; 7/19/05 10:06am  ; Compiled June 7, 2007 13:57:55  ; Compiled February 12, 2008 11:46:47
"RTN","SCMCTSK3",2,0)
 ;;5.3;Scheduling;**297,499**;AUG 13, 1993;Build 21
"RTN","SCMCTSK3",3,0)
 Q
"RTN","SCMCTSK3",4,0)
SORTP  ;sort template
"RTN","SCMCTSK3",5,0)
 N DIC
"RTN","SCMCTSK3",6,0)
 S DIC=200,DIC(0)="ZME"
"RTN","SCMCTSK3",7,0)
 S DIC("S")="I $D(^SCTM(404.52,""C"",+Y))"
"RTN","SCMCTSK3",8,0)
 S DIR("A")="Start with Provider",DIR("B")="FIRST",DIR(0)="F" D ^DIR
"RTN","SCMCTSK3",9,0)
 I X="FIRST" S DIPA("SP")="",DIPA("EI")="zzz",X=1 Q
"RTN","SCMCTSK3",10,0)
 D ^DIC I Y<0 S DIPA("SP")=X Q:X[U  D
"RTN","SCMCTSK3",11,0)
 .S DIR("A")="Go to Provider",DIR("B")="LAST" S DIR(0)="F" D ^DIR
"RTN","SCMCTSK3",12,0)
 .I X="LAST" S DIPA("EP")="zzz"
"RTN","SCMCTSK3",13,0)
 I Y>0 S DIPA("SP")=$P(Y(0),U),DIC(0)="AZQME",DIC("A")="Go to Provider: "
"RTN","SCMCTSK3",14,0)
 D ^DIC
"RTN","SCMCTSK3",15,0)
 I Y>0 S DIPA("EP")=$P(Y(0),U)
"RTN","SCMCTSK3",16,0)
 I Y<0 S DIPA("EP")=X Q:X[U
"RTN","SCMCTSK3",17,0)
 S X=1 Q
"RTN","SCMCTSK3",18,0)
 Q
"RTN","SCMCTSK3",19,0)
KEY ;Inactivated Report Key
"RTN","SCMCTSK3",20,0)
 D KEY^SCMCTSK3 Q
"RTN","SCMCTSK3",21,0)
SORTYP()        ; sort type
"RTN","SCMCTSK3",22,0)
 W !,"Sort report by"
"RTN","SCMCTSK3",23,0)
 S DIR(0)="SO^1:TEAM;2:ASSOCIATED CLINIC;"
"RTN","SCMCTSK3",24,0)
 S DIR("B")=1
"RTN","SCMCTSK3",25,0)
 D ^DIR
"RTN","SCMCTSK3",26,0)
 Q Y
"RTN","SCMCTSK3",27,0)
DV(PP)       ;return institution sort of patient assignment entry and then IEN of team^ien of position
"RTN","SCMCTSK3",28,0)
 N A,B,C,T,I,INSTNM,INSTN
"RTN","SCMCTSK3",29,0)
 S A=$G(^SCPT(404.43,+PP,0)),T=+$P($G(^SCPT(404.42,+A,0)),U,3) I $D(INST(T)) Q INST(T)_U_T_U_$P(A,U,2)
"RTN","SCMCTSK3",30,0)
 S I=$P($G(^SCTM(404.51,T,0)),U,7) I $O(^TMP("SC",$J,"DIV",0)) I '$D(^TMP("SC",$J,"DIV",I)) Q -1
"RTN","SCMCTSK3",31,0)
 S INSTNM=$$GET1^DIQ(4,(+I)_",",.01),INSTN=$$GET1^DIQ(4,(+I)_",",99)
"RTN","SCMCTSK3",32,0)
 S INST(T)=$S($L(INSTN)=3:INSTN_" ",1:"")_INSTNM Q INST(T)_U_T_U_$P(A,U,2)
"RTN","SCMCTSK3",33,0)
EC(PP)     ;return enrolled clinics
"RTN","SCMCTSK3",34,0)
 N I,A
"RTN","SCMCTSK3",35,0)
 S A=""
"RTN","SCMCTSK3",36,0)
 F I=0:0 S I=$O(^SCTM(404.57,+$P(ZERO,U,2),5,I)) Q:'I  D
"RTN","SCMCTSK3",37,0)
 .I '$$PTCL^SCRPO2(DFN,U_I,0,DT) Q   ;not enrolled
"RTN","SCMCTSK3",38,0)
 .I $D(CLIN(I)) S A=A_CLIN(I)_U Q
"RTN","SCMCTSK3",39,0)
 .I $O(^TMP("SC",$J,"CLINIC",0)) I '$D(^(I)) Q
"RTN","SCMCTSK3",40,0)
 .S CLIN(I)=$P($G(^SC(I,0)),U) I $L(CLIN(I)) S A=A_CLIN(I)_U
"RTN","SCMCTSK3",41,0)
 Q $S(A="":-1,1:A)
"RTN","SCMCTSK3",42,0)
TM(PP) ;Return Team
"RTN","SCMCTSK3",43,0)
 N I,A,T
"RTN","SCMCTSK3",44,0)
 S T=+$P($G(^SCPT(404.42,+ZERO,0)),U,3)
"RTN","SCMCTSK3",45,0)
 I $D(TEAM(T)) Q TEAM(T)
"RTN","SCMCTSK3",46,0)
 I $O(^TMP("SC",$J,"TEAM",0)) I '$D(^(T)) Q -1
"RTN","SCMCTSK3",47,0)
 S TEAM(T)=$P($G(^SCTM(404.51,+T,0)),U)
"RTN","SCMCTSK3",48,0)
 I '$L(TEAM(T)) K TEAM(T) Q -1
"RTN","SCMCTSK3",49,0)
 Q TEAM(T)
"RTN","SCMCTSK3",50,0)
IU(DFN) ;is patient inactivity unassigned
"RTN","SCMCTSK3",51,0)
 N I,A,B,DATA,QUIT
"RTN","SCMCTSK3",52,0)
 S DATA=-1,QUIT=0
"RTN","SCMCTSK3",53,0)
 F I=0:0 S I=$O(^SCPT(404.42,"B",+$G(DFN),I)) Q:'I  S A=$G(^SCPT(404.42,I,0)) D  Q:QUIT
"RTN","SCMCTSK3",54,0)
 .F J=0:0 S J=$O(^SCPT(404.43,"B",I,J)) Q:'J  S B=$G(^SCPT(404.43,+J,0)) D  Q:QUIT
"RTN","SCMCTSK3",55,0)
 ..I $P(B,U,5),'$P(B,U,4) K A S QUIT=1 Q
"RTN","SCMCTSK3",56,0)
 ..I $P(B,U,12)="NA" S POS=+J D
"RTN","SCMCTSK3",57,0)
 ...S A("IU",I)=A
"RTN","SCMCTSK3",58,0)
 ...S A("IUA")=A
"RTN","SCMCTSK3",59,0)
 ...S A("IUB")=B
"RTN","SCMCTSK3",60,0)
 ...I $P(A,U,8),'$P(A,U,9) S A("A")=1
"RTN","SCMCTSK3",61,0)
 ;Q:$D(A("A")) DATA
"RTN","SCMCTSK3",62,0)
 Q:'$D(A("IU")) DATA
"RTN","SCMCTSK3",63,0)
 ;S DATA="1~"_$P(^SCTM(404.51,+$P(A,U,3),0),U)_"~"_(+$P(A,U,3))_"~"_$P($G(^SCTM(404.57,+$P(B,U,2),0)),U)_"~"_($P(B,U,2))_"~"_POS
"RTN","SCMCTSK3",64,0)
 S DATA="1~"_$P(^SCTM(404.51,+$P(A("IUA"),U,3),0),U)_"~"_(+$P(A("IUA"),U,3))_"~"_$P($G(^SCTM(404.57,+$P(A("IUB"),U,2),0)),U)_"~"_($P(A("IUB"),U,2))_"~"_POS
"RTN","SCMCTSK3",65,0)
 Q DATA
"RTN","SCMCTSK3",66,0)
PROMPT(SCDESC,DATESORT) ;Prompt for report parameters, queue report
"RTN","SCMCTSK3",67,0)
 ;Input: LIST=comma delimited string of list subscripts to prompt for
"RTN","SCMCTSK3",68,0)
 ;Input: SCRTN=report routine entry point
"RTN","SCMCTSK3",69,0)
 ;Input: SCDESC=tasked job description
"RTN","SCMCTSK3",70,0)
 ;
"RTN","SCMCTSK3",71,0)
 K TEAM,CLIN,INST,^TMP("SCSORT",$J)
"RTN","SCMCTSK3",72,0)
 N SCDIV,SCBDT,SCEDT,SC,SCI,SCX,SCOUT,SCT
"RTN","SCMCTSK3",73,0)
 D HOME^%ZIS
"RTN","SCMCTSK3",74,0)
 D ENS^%ZISS
"RTN","SCMCTSK3",75,0)
 S SC="^TMP(""SC"",$J)" K @SC S SCOUT=0
"RTN","SCMCTSK3",76,0)
 D TITL^SCRPW50(SCDESC)
"RTN","SCMCTSK3",77,0)
 I $L($G(DATESORT)) D  G:'$$DTR^SCRPO(.SC,.SCBDT,.SCEDT) END
"RTN","SCMCTSK3",78,0)
 .D SUBT^SCRPW50(DATESORT)
"RTN","SCMCTSK3",79,0)
 .S SCBDT("B")="T-30",SCEDT("B")="TODAY"
"RTN","SCMCTSK3",80,0)
 .I (DATESORT["Scheduled Ina")!(DATESORT["Scheduled for Inactivation") S SCEDT("B")="T+60"
"RTN","SCMCTSK3",81,0)
 S LIST="DIV,TEAM,POS,ASPR"
"RTN","SCMCTSK3",82,0)
 ;D SUBT^SCRPW50("**** Date Range Selection ****")
"RTN","SCMCTSK3",83,0)
 ;S (SCBDT("B"),SCEDT("B"))="TODAY"
"RTN","SCMCTSK3",84,0)
 ;G:'$$DTR^SCRPO(.SC,.SCBDT,.SCEDT) END
"RTN","SCMCTSK3",85,0)
 ;D SUBT^SCRPW50("**** Report Parameter Selection ****")
"RTN","SCMCTSK3",86,0)
 F SCI=1:1:$L(LIST,",") S SCX=$P(LIST,",",SCI) D  Q:SCOUT
"RTN","SCMCTSK3",87,0)
 .S SCOUT='$$LIST^SCRPO(.SC,SCX,1)
"RTN","SCMCTSK3",88,0)
 .Q
"RTN","SCMCTSK3",89,0)
 G:SCOUT END
"RTN","SCMCTSK3",90,0)
 S SORT="DV,TM,TP,PR"_$S(SCDESC["FTEE":",AC",1:",PT")
"RTN","SCMCTSK3",91,0)
 D SUBT^SCRPW50("**** Output sort order (optional) ****")
"RTN","SCMCTSK3",92,0)
 G:'$$SORT^SCRPO(.SC,SORT,"") END
"RTN","SCMCTSK3",93,0)
 S SCT(1)="**** Report Parameters Selected ****" D SUBT^SCRPW50(SCT(1))
"RTN","SCMCTSK3",94,0)
 G:'$$PPAR^SCRPO(.SC,1,.SCT) END
"RTN","SCMCTSK3",95,0)
 S SORTN=""
"RTN","SCMCTSK3",96,0)
 F SCI=0:0 S SCI=$O(^TMP("SC",$J,"SORT",SCI)) Q:'SCI  S SORTN=SORTN_$P(^(SCI),U,2)_U
"RTN","SCMCTSK3",97,0)
 W:$G(IORESET)'[$C(99) $G(IORESET)
"RTN","SCMCTSK3",98,0)
 Q
"RTN","SCMCTSK3",99,0)
END W:$G(IORESET)'[$C(99) $G(IORESET) K ^TMP("SC",$J) Q
"RTN","SCMCTSK3",100,0)
EXTEND ;Sort Extend
"RTN","SCMCTSK3",101,0)
 K ^TMP("SCSORT",$J)
"RTN","SCMCTSK3",102,0)
 I '$D(^TMP("SC",$J,"SORT",1)) S ^(1)="DV^INSTITUTION^SCDIV",SORTN="DIVISION"
"RTN","SCMCTSK3",103,0)
 N SORT S A="" F  S A=$O(^TMP("SC",$J,A)) Q:A=""  I "XRSORTDTR"'[A I $G(^(A))'="ALL" S SORT($S(A="ASPR":"PR",A="DIV":"DV",A="POS":"TP",1:"TM",A="PATIENT":PT))=""
"RTN","SCMCTSK3",104,0)
 N I,A,ED,SD
"RTN","SCMCTSK3",105,0)
 F I=0:0 S I=$O(^SCPT(404.43,"AEXT",I)) Q:'I  F J=0:0 S J=$O(^SCPT(404.43,"AEXT",I,J)) Q:'J  D
"RTN","SCMCTSK3",106,0)
 .I '$P($G(^SCPT(404.43,J,0)),U,15) Q
"RTN","SCMCTSK3",107,0)
 .S SD=$G(^TMP("SC",$J,"DTR","BEGIN")) I SD S ED=$G(^("END")) S:'ED ED=9999999 D INACTDT^SCMCTSK1(J) I (X<SD)!(X>ED) Q
"RTN","SCMCTSK3",108,0)
 .D SORT(0)
"RTN","SCMCTSK3",109,0)
 Q
"RTN","SCMCTSK3",110,0)
FILEIN(DATA,INFO) ;undo a inactivation
"RTN","SCMCTSK3",111,0)
 ;INFO entry in PATIENT POSITION ASSIGNMENT file
"RTN","SCMCTSK3",112,0)
 N ZERO,FLDA S DATA=1
"RTN","SCMCTSK3",113,0)
 S ZERO=$G(^SCPT(404.43,+$G(INFO),0))
"RTN","SCMCTSK3",114,0)
 ;I $P(ZERO,U,12)'="IU" Q
"RTN","SCMCTSK3",115,0)
 S FLDA(404.43,(+INFO)_",",.12)=""
"RTN","SCMCTSK3",116,0)
 S FLDA(404.43,(+INFO)_",",.04)=""
"RTN","SCMCTSK3",117,0)
 S FLDA(404.43,(+INFO)_",",.15)=""
"RTN","SCMCTSK3",118,0)
 S FLDA(404.43,(+INFO)_",",.17)=DT
"RTN","SCMCTSK3",119,0)
 I $D(^SCPT(404.42,+ZERO,0)) S FLDA(404.42,(+ZERO)_",",.15)="",FLDA(404.42,(+ZERO)_",",.09)=""
"RTN","SCMCTSK3",120,0)
 D FILE^DIE("E","FLDA","ERR")
"RTN","SCMCTSK3",121,0)
 Q
"RTN","SCMCTSK3",122,0)
UNASSIGN  ;Sort UNASSIGNMENTS
"RTN","SCMCTSK3",123,0)
 N END,START
"RTN","SCMCTSK3",124,0)
 K ^TMP("SCSORT",$J)
"RTN","SCMCTSK3",125,0)
 S START=$G(^TMP("SC",$J,"DTR","BEGIN"))-.1,END=$G(^("END"))+.9
"RTN","SCMCTSK3",126,0)
 I '$D(^TMP("SC",$J,"SORT",1)) S ^(1)="DV^INSTITUTION^SCDIV",SORTN="INSTITUTION"
"RTN","SCMCTSK3",127,0)
 N I,A,STAT
"RTN","SCMCTSK3",128,0)
 F STAT="NA","DU" F J=0:0 S J=$O(^SCPT(404.43,"ASTATB",STAT,J)) Q:'J  D
"RTN","SCMCTSK3",129,0)
 .S ZERO=$G(^SCPT(404.43,J,0)) I ($P(ZERO,U,4)<START)!($P(ZERO,U,4)>END) Q
"RTN","SCMCTSK3",130,0)
 .D SORT(1)
"RTN","SCMCTSK3",131,0)
 Q
"RTN","SCMCTSK3",132,0)
DFN(A) ;Return patient from Position assigment
"RTN","SCMCTSK3",133,0)
 Q +$G(^SCPT(404.42,+$G(A),0))
"RTN","SCMCTSK3",134,0)
PA(A) ;return patient name
"RTN","SCMCTSK3",135,0)
 Q $P($G(^DPT(+$G(DFN),0)),U)
"RTN","SCMCTSK3",136,0)
PR(PP)  ;Return assigned provider
"RTN","SCMCTSK3",137,0)
 N A
"RTN","SCMCTSK3",138,0)
 S A=$$GETPRTP^SCAPMCU2(+$P(ZERO,U,2),DT)
"RTN","SCMCTSK3",139,0)
 I $O(^TMP("SC",$J,"ASPR",0)) I '$D(^(+A)) Q -1
"RTN","SCMCTSK3",140,0)
 S A=$P(A,U,2)
"RTN","SCMCTSK3",141,0)
 Q $S(A="":-1,1:A)
"RTN","SCMCTSK3",142,0)
TP(A) ;return the team position
"RTN","SCMCTSK3",143,0)
 N TP S TP=+$P($G(ZERO),U,2)
"RTN","SCMCTSK3",144,0)
 I $O(^TMP("SC",$J,"POS",0)) I '$D(^(TP)) Q -1
"RTN","SCMCTSK3",145,0)
 Q $P($G(^SCTM(404.57,+TP,0)),U)
"RTN","SCMCTSK3",146,0)
FLAGG ;Sort FLAGGED
"RTN","SCMCTSK3",147,0)
 K ^TMP("SCSORT",$J)
"RTN","SCMCTSK3",148,0)
 N I,A,J
"RTN","SCMCTSK3",149,0)
 I '$D(^TMP("SC",$J,"SORT",1)) S ^(1)="DV^INSTITUTION^SCDIV",SORTN="INSTITUTION",^(2)="TM^TEAM^SCTEAM",^(3)="PR^PROVIDER^SCPROV",^(4)="PA^PATIENT^SCPAT"
"RTN","SCMCTSK3",150,0)
 N SORT S A="" F  S A=$O(^TMP("SC",$J,A)) Q:A=""  I "XRSORTDTR"'[A I $G(^(A))'="ALL" S SORT($S(A="ASPR":"PR",A="DIV":"DV",A="POS":"TP",1:"TM",A="PATIENT":PT))=""
"RTN","SCMCTSK3",151,0)
 S SDT=$G(^TMP("SC",$J,"DTR","BEGIN")),END=$G(^("END"))+.9
"RTN","SCMCTSK3",152,0)
 F I=0:0 S I=$O(^SCPT(404.43,"AFLG",I)) Q:'I  F J=0:0 S J=$O(^SCPT(404.43,"AFLG",I,J)) Q:'J  D
"RTN","SCMCTSK3",153,0)
 .I SDT>0 S:(END'>9) END=9999999 D INACTDT^SCMCTSK1(J) I (X<SDT)!(X>END) Q
"RTN","SCMCTSK3",154,0)
 .D SORT(0)
"RTN","SCMCTSK3",155,0)
 Q
"RTN","SCMCTSK3",156,0)
SORT(INACTIVE)  ;
"RTN","SCMCTSK3",157,0)
 N A,B,C,D,E,QUIT,SCA,K,KCNT,PIECE
"RTN","SCMCTSK3",158,0)
 S ZERO=$G(^SCPT(404.43,+J,0)) Q:$S('$G(INACTIVE):$P(ZERO,U,4),1:'$P(ZERO,U,4))
"RTN","SCMCTSK3",159,0)
 S DFN=$$DFN(+ZERO)
"RTN","SCMCTSK3",160,0)
 S QUIT=0,KCNT=0
"RTN","SCMCTSK3",161,0)
 F K=1:1 Q:'$D(^TMP("SC",$J,"SORT",K))  S A=^(K) K SORT($P(A,U)) S @("A("_K_")=$$"_$P(A,U)_"("_J_")") D  I (A(K)=-1)!($P(A(K),U)="") S QUIT=1 Q
"RTN","SCMCTSK3",162,0)
 .I $P(A,U)="EC",$L(A(K),U)>2 S KCNT=K
"RTN","SCMCTSK3",163,0)
 Q:QUIT
"RTN","SCMCTSK3",164,0)
 S A="" F  S A=$O(SORT(A)) Q:A=""  S @("B=$$"_A_"("_J_")") I B=-1 S QUIT=1 Q
"RTN","SCMCTSK3",165,0)
 Q:QUIT
"RTN","SCMCTSK3",166,0)
 F PIECE=1:1:$S(KCNT:$L(A(KCNT),U)-1,1:1) D
"RTN","SCMCTSK3",167,0)
 .S B="E" K @B
"RTN","SCMCTSK3",168,0)
 .F K=1:1:$O(A(99),-1) S @B@($P(A(K),U,$S(K=KCNT:PIECE,1:1)))="" S C=$Q(@B) K @B S B=C
"RTN","SCMCTSK3",169,0)
 .S @B@(J)=""
"RTN","SCMCTSK3",170,0)
 .M ^TMP("SCSORT",$J)=E
"RTN","SCMCTSK3",171,0)
 Q
"RTN","SCMCTSK3",172,0)
INACT ;
"RTN","SCMCTSK3",173,0)
 N ALPHA,ZERO
"RTN","SCMCTSK3",174,0)
 S ALPHA=$G(^SCTM(404.44,1,1)),ALPHA=$P(ALPHA,U,8) I ALPHA<DT S ALPHA=0
"RTN","SCMCTSK3",175,0)
 S ZERO=$G(^SCPT(404.43,+$G(PA),0)) I '$P(ZERO,U,15) S X="" Q
"RTN","SCMCTSK3",176,0)
 S X1=$P(ZERO,U,15),X2=$S(ALPHA:2,1:30) I $P(ZERO,U,13) S X2=$S(ALPHA:5,1:90)
"RTN","SCMCTSK3",177,0)
 D C^%DTC Q:ALPHA  Q:$E(X,6,7)=15
"RTN","SCMCTSK3",178,0)
 F  S (ZERO,X1)=X,X2=1 D C^%DTC Q:$E(X,6,7)=15  I $E(X,6,7)="01" S X=ZERO Q
"RTN","SCMCTSK3",179,0)
 Q
"RTN","SCMCTSK3",180,0)
INCON ;Inconsistency
"RTN","SCMCTSK3",181,0)
 N X
"RTN","SCMCTSK3",182,0)
 F POS=0:0 S POS=$O(^SCTM(404.57,POS)) Q:'POS  D POSIN(POS) I $L(X) S ^TMP("SCMCTSK",$J,POS)=X
"RTN","SCMCTSK3",183,0)
 Q
"RTN","SCMCTSK3",184,0)
POSIN(POS)      ;
"RTN","SCMCTSK3",185,0)
 S X=""
"RTN","SCMCTSK3",186,0)
 N ZERO S ZERO=$G(^SCTM(404.57,POS,0))
"RTN","SCMCTSK3",187,0)
 I '$P(ZERO,U,4) Q   ;not primary care ignore this
"RTN","SCMCTSK3",188,0)
 I '$$ACTTP^SCMCTPU(POS) Q  ;inactive position   
"RTN","SCMCTSK3",189,0)
 I '$$OKPREC3^SCMCLK(POS,DT) I '$P($G(^SD(403.46,+$P(ZERO,U,3),0)),U,3) S X="Role not=PCprovider" Q
"RTN","SCMCTSK3",190,0)
 ;find provider assigned to position and their person class
"RTN","SCMCTSK3",191,0)
 S PROV=+$$GETPRTP^SCAPMCU2(POS,DT) Q:'PROV
"RTN","SCMCTSK3",192,0)
 S PC=$$GET^XUA4A72(+PROV)
"RTN","SCMCTSK3",193,0)
 I '$O(^SD(403.46,+$P(ZERO,U,3),2,0)) Q
"RTN","SCMCTSK3",194,0)
 I '$D(^SD(403.46,+$P(ZERO,U,3),2,+PC)) S X="PersonClass not valid"
"RTN","SCMCTSK3",195,0)
 Q
"RTN","SCMCTSK3",196,0)
PRFLAG ;
"RTN","SCMCTSK3",197,0)
 N LASTDT,POSH
"RTN","SCMCTSK3",198,0)
 K ^TMP("SCMCTSK",$J) N FLDA
"RTN","SCMCTSK3",199,0)
 F POS=0:0 S POS=$O(^SCTM(404.57,POS)) Q:'POS  S ZERO=$G(^(POS,0)) D
"RTN","SCMCTSK3",200,0)
 .I '$P(ZERO,U,4) Q   ;not primary care ignore this
"RTN","SCMCTSK3",201,0)
 .I '$$ACTTP^SCMCTPU(POS) Q  ;inactive position
"RTN","SCMCTSK3",202,0)
 .S LASTDT=+$O(^SCTM(404.52,"AIDT",POS,1,-DT)),POSH=+$O(^SCTM(404.52,"AIDT",POS,1,LASTDT,0)) Q:'POSH
"RTN","SCMCTSK3",203,0)
 .I $O(^SCTM(404.52,"AIDT",POS,0,-9999999))<LASTDT Q   ;inactivation already scheduled
"RTN","SCMCTSK3",204,0)
 .I $P($G(^SCTM(404.52,POSH,0)),U,10) S FLDA(404.52,POSH_",",.091)="" ;already flagged
"RTN","SCMCTSK3",205,0)
 .I '$P($G(^SCTM(404.52,POSH,0)),U,4) Q   ;inactive
"RTN","SCMCTSK3",206,0)
 .I '$$OKPREC3^SCMCLK(POS,DT) I '$P($G(^SD(403.46,+$P(ZERO,U,3),0)),U,3) S ^TMP("SCMCTSK",$J,POSH)="Role cannot be primary care" Q
"RTN","SCMCTSK3",207,0)
 .;find provider assigned to position and their person class
"RTN","SCMCTSK3",208,0)
 .S PROV=+$$GETPRTP^SCAPMCU2(POS,DT)
"RTN","SCMCTSK3",209,0)
 .S PC=$$GET^XUA4A72(+PROV)
"RTN","SCMCTSK3",210,0)
 .I '$D(^SD(403.46,+$P(ZERO,U,3),2,+PC)) S ^TMP("SCMCTSK",$J,POSH)="Person Class is not valid for this role"
"RTN","SCMCTSK3",211,0)
 F POS=0:0 S POS=$O(^TMP("SCMCTSK",$J,POS)) Q:'POS  S FLDA(404.52,POS_",",.091)=DT
"RTN","SCMCTSK3",212,0)
VERPR ;verify already flagged positions; SD/499 replaced "AFLG" with "AFLAG"
"RTN","SCMCTSK3",213,0)
 N II,POSH S II="" F  S II=$O(^SCTM(404.52,"AFLAG",II)) Q:'II  S POSH=""  F  S POSH=$O(^SCTM(404.52,"AFLAG",II,POSH)) Q:'POSH  D
"RTN","SCMCTSK3",214,0)
 .N ZERO,ZEROTP S ZERO=$G(^SCTM(404.52,POSH,0))
"RTN","SCMCTSK3",215,0)
 .I '$P(ZERO,U,4) S FLDA(404.52,POSH_",",.091)="" Q
"RTN","SCMCTSK3",216,0)
 .;SD/499; added verification of the POSSIBLE PRIMARY PRACTITIONER field
"RTN","SCMCTSK3",217,0)
 .;in the TEAM POSITION file
"RTN","SCMCTSK3",218,0)
 .N TP S TP=$P(ZERO,U) S ZEROTP=$G(^SCTM(404.57,TP,0))
"RTN","SCMCTSK3",219,0)
 .I '$P(ZEROTP,U,4) S FLDA(404.52,POSH_",",.091)="" Q
"RTN","SCMCTSK3",220,0)
 .I (-$O(^SCTM(404.52,"AIDT",+ZERO,0,-9999999)))>$P(ZERO,U,2) S FLDA(404.52,POSH_",",.091)=""
"RTN","SCMCTSK3",221,0)
 I $O(FLDA(0)) D FILE^DIE("I","FLDA","ERR")
"RTN","SCMCTSK3",222,0)
 K ^TMP("SCMCTSK",$J)
"RTN","SCMCTSK3",223,0)
 Q
"RTN","SD53P499")
0^6^B8539155^n/a
"RTN","SD53P499",1,0)
SD53P499 ;ALB/ESW - SD*5.3*499 POST INIT; Oct 04, 2006  ; Compiled February 12, 2008 11:19:50
"RTN","SD53P499",2,0)
 ;;5.3;SCHEDULING;**499**;AUG 13, 1993;Build 21
"RTN","SD53P499",3,0)
 ;Unflagging all entries from file 404.43 from inactivation
"RTN","SD53P499",4,0)
 ;Sending a notification to the PCMM PATIENT/PROVIDER INACTIVE Mail Group
"RTN","SD53P499",5,0)
 ;Flagging for inactivation entries in file 404.43 following the revised functionality
"RTN","SD53P499",6,0)
 Q
"RTN","SD53P499",7,0)
 ;
"RTN","SD53P499",8,0)
POST ;
"RTN","SD53P499",9,0)
 N SDA
"RTN","SD53P499",10,0)
 S SDA(1)="",SDA(2)="    SD*5.3*499 Post-Install started.....",SDA(3)="" D ATADDQ
"RTN","SD53P499",11,0)
 ;
"RTN","SD53P499",12,0)
 N SDA
"RTN","SD53P499",13,0)
 S SDA(1)="",SDA(2)=" Un-flagging the current entries in the Patient Team Position Assignment"
"RTN","SD53P499",14,0)
 S SDA(3)=" file (# 404.43)",SDA(4)="" D ATADDQ
"RTN","SD53P499",15,0)
 N SDA
"RTN","SD53P499",16,0)
 N SD499,SDDATE S SDDATE="" F  S SDDATE=$O(^SCPT(404.43,"AFLG",SDDATE)) Q:SDDATE=""  D
"RTN","SD53P499",17,0)
 .S SD499="" F  S SD499=$O(^SCPT(404.43,"AFLG",SDDATE,SD499)) Q:SD499=""  D
"RTN","SD53P499",18,0)
 ..N ENTRY S ENTRY=SD499 D UNFLG^SCMCTSK2
"RTN","SD53P499",19,0)
 S SDA(1)="",SDA(2)=" Patients un-flagging process has been finished.",SDA(3)="" D ATADDQ
"RTN","SD53P499",20,0)
 ;
"RTN","SD53P499",21,0)
 N SDA S SDA(1)=""
"RTN","SD53P499",22,0)
 S SDA(2)=" Flagging patients for inactivation following new functionality started."
"RTN","SD53P499",23,0)
 S SDA(3)="" D ATADDQ
"RTN","SD53P499",24,0)
 D INACTIVE^SCMCTSK1
"RTN","SD53P499",25,0)
 N SDA S SDA(1)=""
"RTN","SD53P499",26,0)
 S SDA(2)=" Flagging Patients for Inactivation has been finished. "
"RTN","SD53P499",27,0)
 S SDA(3)="Use option: SCHD   Patients Scheduled for Inactivation from PC Panels"
"RTN","SD53P499",28,0)
 S SDA(4)="to print the current list of patients flagged for inactivation."
"RTN","SD53P499",29,0)
 S SDA(5)="" D ATADDQ
"RTN","SD53P499",30,0)
 ;another message
"RTN","SD53P499",31,0)
 N SDX,CNT S CNT=0
"RTN","SD53P499",32,0)
 S CNT=CNT+1,SDX(CNT)=" PATIENT TEAM POSITION ASSIGNMENT file has been updated "
"RTN","SD53P499",33,0)
 S CNT=CNT+1,SDX(CNT)=" by un-flagging all entries from inactivation "
"RTN","SD53P499",34,0)
 S CNT=CNT+1,SDX(CNT)=" and then flagging them again following new functionality"
"RTN","SD53P499",35,0)
 S CNT=CNT+1,SDX(CNT)=" provided with patch SD*5.3*499."
"RTN","SD53P499",36,0)
 S CNT=CNT+1,SDX(CNT)=" Use option: SCHD   Patients Scheduled for Inactivation from PC Panels"
"RTN","SD53P499",37,0)
 S CNT=CNT+1,SDX(CNT)=" to print a current list of patients flagged for inactivation."
"RTN","SD53P499",38,0)
 D MSGG(.SDX)
"RTN","SD53P499",39,0)
 Q
"RTN","SD53P499",40,0)
ATADDQ D MES^XPDUTL(.SDA) K SDA
"RTN","SD53P499",41,0)
 Q
"RTN","SD53P499",42,0)
MSG(X) ;
"RTN","SD53P499",43,0)
 N SDX S SDX=$O(SDA(999999),-1) S:'SDX SDX=1 S SDX=SDX+1
"RTN","SD53P499",44,0)
 S SDA(SDX)=$G(X)
"RTN","SD53P499",45,0)
 Q
"RTN","SD53P499",46,0)
MSGG(SDX) ;send message
"RTN","SD53P499",47,0)
 N SDAMX,XMSUB,XMY,XMTEXT,XMDUZ,DIFROM
"RTN","SD53P499",48,0)
 S XMSUB="PATCH SD*5.3*499 POST-INSTALL: Update Entries in File 404.43"
"RTN","SD53P499",49,0)
 S XMY("G.PCMM PATIENT/PROVIDER INACTIVE")=""
"RTN","SD53P499",50,0)
 S XMY(DUZ)=""
"RTN","SD53P499",51,0)
 S XMTEXT="SDX("
"RTN","SD53P499",52,0)
 S CNT=$O(SDX(""),-1)
"RTN","SD53P499",53,0)
 D ^XMD
"VER")
8.0^22.0
"BLD",7485,6)
^433
**END**
**END**
