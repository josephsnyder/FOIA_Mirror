Released SD*5.3*549 SEQ #457
Extracted from mail message
**KIDS**:SD*5.3*549^

**INSTALL NAME**
SD*5.3*549
"BLD",8102,0)
SD*5.3*549^SCHEDULING^0^3090820^y
"BLD",8102,1,0)
^^4^4^3090701^
"BLD",8102,1,1,0)
Fix Audit Trail in Hospital Location file (#44) for field 2505 - 
"BLD",8102,1,2,0)
Inactivate Date.  Also, fix option Find Next Available Appointment when 
"BLD",8102,1,3,0)
doing lookup by Team, so that it uses the new multiple field (#5 - 
"BLD",8102,1,4,0)
Associated Clinic) in the Team Position file (#404.57).
"BLD",8102,4,0)
^9.64PA^^
"BLD",8102,6.3)
2
"BLD",8102,"ABPKG")
n
"BLD",8102,"KRN",0)
^9.67PA^779.2^20
"BLD",8102,"KRN",.4,0)
.4
"BLD",8102,"KRN",.401,0)
.401
"BLD",8102,"KRN",.402,0)
.402
"BLD",8102,"KRN",.403,0)
.403
"BLD",8102,"KRN",.5,0)
.5
"BLD",8102,"KRN",.84,0)
.84
"BLD",8102,"KRN",3.6,0)
3.6
"BLD",8102,"KRN",3.8,0)
3.8
"BLD",8102,"KRN",9.2,0)
9.2
"BLD",8102,"KRN",9.8,0)
9.8
"BLD",8102,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",8102,"KRN",9.8,"NM",1,0)
SDNACT^^0^B19685388
"BLD",8102,"KRN",9.8,"NM",2,0)
SDNEXT^^0^B21934086
"BLD",8102,"KRN",9.8,"NM","B","SDNACT",1)

"BLD",8102,"KRN",9.8,"NM","B","SDNEXT",2)

"BLD",8102,"KRN",19,0)
19
"BLD",8102,"KRN",19.1,0)
19.1
"BLD",8102,"KRN",101,0)
101
"BLD",8102,"KRN",409.61,0)
409.61
"BLD",8102,"KRN",771,0)
771
"BLD",8102,"KRN",779.2,0)
779.2
"BLD",8102,"KRN",870,0)
870
"BLD",8102,"KRN",8989.51,0)
8989.51
"BLD",8102,"KRN",8989.52,0)
8989.52
"BLD",8102,"KRN",8994,0)
8994
"BLD",8102,"KRN","B",.4,.4)

"BLD",8102,"KRN","B",.401,.401)

"BLD",8102,"KRN","B",.402,.402)

"BLD",8102,"KRN","B",.403,.403)

"BLD",8102,"KRN","B",.5,.5)

"BLD",8102,"KRN","B",.84,.84)

"BLD",8102,"KRN","B",3.6,3.6)

"BLD",8102,"KRN","B",3.8,3.8)

"BLD",8102,"KRN","B",9.2,9.2)

"BLD",8102,"KRN","B",9.8,9.8)

"BLD",8102,"KRN","B",19,19)

"BLD",8102,"KRN","B",19.1,19.1)

"BLD",8102,"KRN","B",101,101)

"BLD",8102,"KRN","B",409.61,409.61)

"BLD",8102,"KRN","B",771,771)

"BLD",8102,"KRN","B",779.2,779.2)

"BLD",8102,"KRN","B",870,870)

"BLD",8102,"KRN","B",8989.51,8989.51)

"BLD",8102,"KRN","B",8989.52,8989.52)

"BLD",8102,"KRN","B",8994,8994)

"BLD",8102,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",8102,"QUES",0)
^9.62^^
"BLD",8102,"REQB",0)
^9.611^2^2
"BLD",8102,"REQB",1,0)
SD*5.3*165^2
"BLD",8102,"REQB",2,0)
SD*5.3*380^2
"BLD",8102,"REQB","B","SD*5.3*165",1)

"BLD",8102,"REQB","B","SD*5.3*380",2)

"MBREQ")
0
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813
"PKG",16,22,1,"PAH",1,0)
549^3090820
"PKG",16,22,1,"PAH",1,1,0)
^^4^4^3090820
"PKG",16,22,1,"PAH",1,1,1,0)
Fix Audit Trail in Hospital Location file (#44) for field 2505 - 
"PKG",16,22,1,"PAH",1,1,2,0)
Inactivate Date.  Also, fix option Find Next Available Appointment when 
"PKG",16,22,1,"PAH",1,1,3,0)
doing lookup by Team, so that it uses the new multiple field (#5 - 
"PKG",16,22,1,"PAH",1,1,4,0)
Associated Clinic) in the Team Position file (#404.57).
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","SDNACT")
0^1^B19685388^B18897332
"RTN","SDNACT",1,0)
SDNACT ;ALB/TMP - INACTIVATE A CLINIC ; 30 APR 85  9:02 am 
"RTN","SDNACT",2,0)
 ;;5.3;Scheduling;**63,380,549**;Aug 13, 1993;Build 2
"RTN","SDNACT",3,0)
 S:'$D(DTIME) DTIME=300 I '$D(DT) D DT^SDUTL
"RTN","SDNACT",4,0)
 S SDAY="Sun^Mon^Tues^Wednes^Thurs^Fri^Satur",SDZQ=1
"RTN","SDNACT",5,0)
 D DT^DICRW S DIC="^SC(",DIC(0)="AEMZQ",DIC("A")="Select CLINIC NAME: ",DIC("S")="I $P(^(0),""^"",3)=""C"",'$G(^(""OOS""))"
"RTN","SDNACT",6,0)
 D ^DIC K DIC("A"),DIC("S") G:Y<0 END S SC=+Y,SDX="",SDX1=9999999
"RTN","SDNACT",7,0)
 N SDRES S SDRES=$$CLNCK^SDUTL2(SC,0)
"RTN","SDNACT",8,0)
 I 'SDRES D
"RTN","SDNACT",9,0)
 .W !,?5,"WARNING:     Clinic's Stop Code ",$P(SDRES,U,2)
"RTN","SDNACT",10,0)
 .W !,?5,"Recommend:   Clinic be corrected."
"RTN","SDNACT",11,0)
 I $D(^SC(SC,"I")),+^("I")'=0,+^("I")'>DT,+$P(^("I"),"^",2)'>0 W *7,!,"This clinic was inactivated effective: " S Y=+^("I") D DTS^SDUTL W Y G END
"RTN","SDNACT",12,0)
 I $D(^SC(SC,"I")),+^("I")>DT G CHECK
"RTN","SDNACT",13,0)
 I $D(^SC(SC,"I")),+^("I")'>DT,+$P(^("I"),"^",2)'<DT W !,*7,"Clinic is already inactive until " S Y=+$P(^("I"),"^",2) D DTS^SDUTL W Y G END
"RTN","SDNACT",14,0)
D S %DT="AEFX",%DT("A")="Enter Date Clinic is to be Inactivated: " D ^%DT K %DT G:Y'>0 END S SDDATE=Y I Y<DT W "??",!,*7,"Inactivate date must be greater than or equal to today's date" G D
"RTN","SDNACT",15,0)
 I SDX<9999999,Y>SDX1,SDX1 W "??",!,*7,"Inactivate date must be < reactivate date" G D
"RTN","SDNACT",16,0)
 S POP=0 F I=SDDATE-.0001:0 S I=$O(^SC(SC,"S",I)) Q:'I!(POP)!(SDDATE'<SDX1&(SDX1))  F I1=0:0 S I1=$O(^SC(SC,"S",I,1,I1)) Q:'I1  I $P(^(I1,0),"^",9)'="C" S POP=1 Q
"RTN","SDNACT",17,0)
 I POP W *7,!,"Can't inactivate the clinic - appointments exist beyond " S Y=SDDATE D DT^DIQ G END
"RTN","SDNACT",18,0)
 I SDX'="" D CHG1 G OVR
"RTN","SDNACT",19,0)
 K SDN S ^SC(SC,"I")="",X=SDDATE D DOW^SDM0 S SDN(Y)=SDDATE F I=1:1:6 S X2=1,X1=X D C^%DTC,DOW^SDM0 S SDN(Y)=X
"RTN","SDNACT",20,0)
 F I=0:1:6 S J=$O(^SC(SC,"T"_I,SDN(I))) D GOT
"RTN","SDNACT",21,0)
OVR F I=SDDATE-.0001:0 S I=$O(^SC(SC,"ST",I)) Q:'I!(I>SDX1)  K ^(I)
"RTN","SDNACT",22,0)
 F I=SDDATE-.0001:0 S I=$O(^SC(SC,"T",I)) Q:'I!(I>SDX1)  K ^(I)
"RTN","SDNACT",23,0)
 F I=SDDATE-.0001:0 S I=$O(^SC(SC,"OST",I)) Q:'I!(I>SDX1)  K ^(I)
"RTN","SDNACT",24,0)
 S DIE="^SC(",DA=SC,DR="2505///^S X=SDDATE" D ^DIE  ;SD*549 use FM API to update field so Audit Trail functions properly
"RTN","SDNACT",25,0)
 W !!,"Clinic will be inactivated effective " S Y=SDDATE D DTS^SDUTL W Y G END
"RTN","SDNACT",26,0)
 ;
"RTN","SDNACT",27,0)
CHECK W *7,!,"This clinic is to be inactivated as of " S SDX=+^("I"),Y=SDX D DTS^SDUTL W Y S SDX1=+$P(^("I"),"^",2),Y=SDX1 I Y D DTS^SDUTL W " and reactivated as of ",Y ;NAKED REFERENCE - ^SC(DFN,"I")
"RTN","SDNACT",28,0)
 S %=1 W !,"Do you want to change the inactivate date" D YN^DICN I '% W !,"RESPOND YES OR NO" G CHECK
"RTN","SDNACT",29,0)
 G D:'(%-1),END:(%<0),DEL
"RTN","SDNACT",30,0)
 ;
"RTN","SDNACT",31,0)
DEL S %=2 W !,"Do you want to delete the inactivate date" D YN^DICN I '% W !,"RESPOND YES (Y) OR NO (N)" G DEL
"RTN","SDNACT",32,0)
 G:(%-1) END
"RTN","SDNACT",33,0)
 I '$D(^SC(SC,"SL")) W !,*7,"Cannot Delete - 'SL' node doesn't exist" G END
"RTN","SDNACT",34,0)
 G ^SDNACT1
"RTN","SDNACT",35,0)
CHG1 K SDN S X1=SDDATE,X2=6 D C^%DTC S SDNL=X,X=SDDATE D DOW^SDM0 S SDN(Y)=X
"RTN","SDNACT",36,0)
 F I=1:1:6 S X1=X,X2=1 D C^%DTC,DOW^SDM0 S SDN(Y)=X
"RTN","SDNACT",37,0)
 S X1=SDX,X2=6 D C^%DTC S SDOL=X,X1=SDX,X2=-1 D C^%DTC
"RTN","SDNACT",38,0)
 F I=0:0 S X2=1,X1=X D C^%DTC Q:X>SDOL  D DOW^SDM0 S:$D(^SC(SC,"T"_Y))&($O(^SC(SC,"T"_Y,0))'=9999999) ^SC(SC,"T"_Y,SDN(Y),1)=$S($D(^SC(SC,"T"_Y,X,1)):^(1),1:""),^(0)=SDN(Y) D A1,A
"RTN","SDNACT",39,0)
 I SDDATE<SDX F I=0:1:6 F J=SDNL:0 S J=$O(^SC(SC,"T"_I,J)) Q:'J!(J'<SDX)  K ^SC(SC,"T"_I,J)
"RTN","SDNACT",40,0)
 Q
"RTN","SDNACT",41,0)
A1 S:'$D(^SC(SC,"T"_Y,9999999,1)) ^(1)="",^(0)=9999999 K:(SDN(Y)-X) ^SC(SC,"T"_Y,X)
"RTN","SDNACT",42,0)
 Q
"RTN","SDNACT",43,0)
A I $O(^SC(SC,"T"_Y,SDN(Y)))>0 S SD=$O(^SC(SC,"T"_Y,SDN(Y))) S:^SC(SC,"T"_Y,SD,1)]"" ^SC(SC,"T"_Y,SDN(Y),1)=^SC(SC,"T"_Y,SD,1),^(0)=SDN(Y),^SC(SC,"T"_Y,SD,1)=""
"RTN","SDNACT",44,0)
 I SDX'>SDDATE,$O(^SC(SC,"ST",SDX-.1))>0 F Z=SDX-.1:0 S Z=$O(^SC(SC,"ST",Z)) Q:'Z!(SDX1&(Z'<SDX1))  K ^SC(SC,"ST",Z)
"RTN","SDNACT",45,0)
 K SD,Z Q
"RTN","SDNACT",46,0)
GOT S SD=$O(^SC(SC,"T"_I,0))
"RTN","SDNACT",47,0)
 I J>0,SD'=9999999 S ^SC(SC,"T"_I,SDN(I),1)=^SC(SC,"T"_I,J,1),^(0)=SDN(I) K ^SC(SC,"T"_I,J) F J1=J:0 S J1=$O(^SC(SC,"T"_I,J1)) Q:'J1  K ^SC(SC,"T"_I,J1)
"RTN","SDNACT",48,0)
 S ^SC(SC,"T"_I,9999999,1)="",^(0)=9999999
"RTN","SDNACT",49,0)
 Q
"RTN","SDNACT",50,0)
END K A,DA,CNT,D0,DH,DO,DOW,I,I1,J,J1,POP,SC,SD,SD0,SDAY,SDEL,SDDATE,SDFSW,SDN,SDNL,SDOL,SDREACT,SI,SL,STARTDAY,SDX,SDX1,SDZQ,X,X1,X2,Y,Z,DIE,DR Q
"RTN","SDNEXT")
0^2^B21934086^B19974175
"RTN","SDNEXT",1,0)
SDNEXT ;ALB/TMP - FIND NEXT AVAILABLE APPOINTMENT FOR A CLINIC ; 18 APR 86
"RTN","SDNEXT",2,0)
 ;;5.3;Scheduling;**41,45,165,549**;AUG 13, 1993;Build 2
"RTN","SDNEXT",3,0)
 ;
"RTN","SDNEXT",4,0)
 S IOP=$S($D(ION):ION,1:"HOME") D ^%ZIS K IOP
"RTN","SDNEXT",5,0)
1 S SDNEXT="",SDCT=0 G RD^SDMULT
"RTN","SDNEXT",6,0)
DT S FND=0,%DT(0)=-SDMAX,%DT="AEF",%DT("A")="  START SEARCH FOR NEXT AVAILABLE FROM WHAT DATE: " D ^%DT K %DT G:"^"[X 1:$S('$D(SDNEXT):1,'SDNEXT:1,1:0),END^SDMULT0 G:Y<0 DT S SDSTRTDT=+Y
"RTN","SDNEXT",7,0)
LIM W !,"  ENTER LATEST DATE TO CHECK FOR 1ST AVAILABLE SLOT: " S Y=SDMAX D DT^DIQ R "// ",X:DTIME G:X["^"!'($T) END^SDMULT0 I X']"" G OVR^SDMULT0
"RTN","SDNEXT",8,0)
 I X?.E1"?" W !,"  The latest date for future bookings for ",$P(SDC(1),"^",2)," is: " S Y=SDMAX D DTS^SDUTL W Y,!,"  If you enter a date here, it must be less than this date to further limit the",!,"  search" G LIM
"RTN","SDNEXT",9,0)
 S %DT="EF",%DT(0)=-SDMAX D ^%DT K %DT G:Y<0!(Y<SDSTRTDT) LIM S:Y>0 SDMAX=+Y
"RTN","SDNEXT",10,0)
 G OVR^SDMULT0
"RTN","SDNEXT",11,0)
 ;
"RTN","SDNEXT",12,0)
NEW ;entry point to be use for next available appt. 3/29/96
"RTN","SDNEXT",13,0)
 K VAUTT,VAUTC,SCUP
"RTN","SDNEXT",14,0)
 N SCOKNULL
"RTN","SDNEXT",15,0)
 S SCOKNULL=1
"RTN","SDNEXT",16,0)
 S IOP=$S($D(ION):ION,1:"HOME") D ^%ZIS K IOP
"RTN","SDNEXT",17,0)
 S SDNEXT="",SDCT=0
"RTN","SDNEXT",18,0)
 S VAUTNA="" ;don't allow all to be selected
"RTN","SDNEXT",19,0)
 S VAUTCA="" ;allow any clinic to be selected
"RTN","SDNEXT",20,0)
 S VAUTD=1 ;all divisions
"RTN","SDNEXT",21,0)
 D CLINIC^SCRPU1 ;prompt for clinics (none,one,many)
"RTN","SDNEXT",22,0)
 Q:$D(SCUP)  ; "^" SELECTED
"RTN","SDNEXT",23,0)
 D PRMTT^SCRPU1 ;prompt for team (none,one,many)
"RTN","SDNEXT",24,0)
 Q:('$D(VAUTT))&('$D(VAUTC))
"RTN","SDNEXT",25,0)
 Q:$D(SCUP)  ; "^" SELECTED
"RTN","SDNEXT",26,0)
 S APPTL=$$LENGTH()
"RTN","SDNEXT",27,0)
 Q:APPTL<0
"RTN","SDNEXT",28,0)
 S FIRST="First date to check for 1st available appointments: "
"RTN","SDNEXT",29,0)
 S SECOND="Latest date to check for available appointments: "
"RTN","SDNEXT",30,0)
 S RANG=$$DTRANG^SCRPU2(FIRST,SECOND)
"RTN","SDNEXT",31,0)
 I RANG=-1 D CLEAN,EXIT Q
"RTN","SDNEXT",32,0)
 I $D(VAUTT) D GETCLN(.VAUTT,.VAUTC)
"RTN","SDNEXT",33,0)
 ;all clinics selected & position assoc clinics in VAUTC(ien)=clinic name
"RTN","SDNEXT",34,0)
 D DRIVE(.VAUTC,APPTL,RANG)
"RTN","SDNEXT",35,0)
 D CLEAN,EXIT
"RTN","SDNEXT",36,0)
 Q
"RTN","SDNEXT",37,0)
EXIT ;
"RTN","SDNEXT",38,0)
 K VAUTD,VAUTNA,VAUTT,VAUTC,FIRST,SECOND,RANG,APPTL,SCPCMM,SDNEXT,SDCT
"RTN","SDNEXT",39,0)
 K VAUTCA,SCUP
"RTN","SDNEXT",40,0)
 Q
"RTN","SDNEXT",41,0)
 ;
"RTN","SDNEXT",42,0)
LENGTH() ;
"RTN","SDNEXT",43,0)
 ;prompt for appointment length
"RTN","SDNEXT",44,0)
 N LEN
"RTN","SDNEXT",45,0)
ST S DIR(0)="N"
"RTN","SDNEXT",46,0)
 S DIR("A")="Appointment Length Needed "
"RTN","SDNEXT",47,0)
 D ^DIR
"RTN","SDNEXT",48,0)
 I Y=""!(X="^")!(X="") S LEN=-1 G EX
"RTN","SDNEXT",49,0)
 S LEN=X
"RTN","SDNEXT",50,0)
EX K DIR,Y,X
"RTN","SDNEXT",51,0)
 Q LEN
"RTN","SDNEXT",52,0)
 ;
"RTN","SDNEXT",53,0)
GETCLN(TEAM,CLINIC) ;add assoc. clinics for teams to clinic array
"RTN","SDNEXT",54,0)
 ;TEAM - team array
"RTN","SDNEXT",55,0)
 ;CLINIC - clinic array
"RTN","SDNEXT",56,0)
 ;
"RTN","SDNEXT",57,0)
 N TM,LIST,ERR,OKAY
"RTN","SDNEXT",58,0)
 S TM=0,LIST="TPLIST",ERR="ERR1"
"RTN","SDNEXT",59,0)
 F  S TM=$O(TEAM(TM)) Q:TM=""!(TM'?.N)  D
"RTN","SDNEXT",60,0)
 .K @LIST,@ERR
"RTN","SDNEXT",61,0)
 .S OKAY=$$TPTM^SCAPMC24(TM,"","","",LIST,ERR)
"RTN","SDNEXT",62,0)
 .;@LIST contains all positions for team TM
"RTN","SDNEXT",63,0)
 .I $G(@LIST@(0))>0 D ADDCL(.CLINIC,LIST)
"RTN","SDNEXT",64,0)
 Q
"RTN","SDNEXT",65,0)
 ;
"RTN","SDNEXT",66,0)
ADDCL(CLINIC,PTLIST) ;add team's associated clinics to clinic list
"RTN","SDNEXT",67,0)
 ;CLINIC - array of selected clinics
"RTN","SDNEXT",68,0)
 ;PTLIST - array of all positions for a selected team
"RTN","SDNEXT",69,0)
 N CNAME,CIEN,TPNODE,TPIEN,NODE,EN
"RTN","SDNEXT",70,0)
 S EN=0
"RTN","SDNEXT",71,0)
 F  S EN=$O(@PTLIST@(EN)) Q:EN=""!(EN'?.N)  D
"RTN","SDNEXT",72,0)
 .S NODE=$G(@PTLIST@(EN))
"RTN","SDNEXT",73,0)
 .S TPIEN=+$P(NODE,"^") ;team position ien
"RTN","SDNEXT",74,0)
 .S TPNODE=$G(^SCTM(404.57,TPIEN,0))
"RTN","SDNEXT",75,0)
 .Q:TPNODE=""
"RTN","SDNEXT",76,0)
 .Q:'$D(^SCTM(404.57,TPIEN,5,0))  ;no associated clinics
"RTN","SDNEXT",77,0)
 .S SDA=0  ;SD/549 change logic to pull from new multiple field
"RTN","SDNEXT",78,0)
 .F  S SDA=$O(^SCTM(404.57,TPIEN,5,SDA)) Q:'SDA  D
"RTN","SDNEXT",79,0)
 ..Q:'$D(^SCTM(404.57,TPIEN,5,SDA,0))
"RTN","SDNEXT",80,0)
 ..S CIEN=+$G(^SCTM(404.57,TPIEN,5,SDA,0))
"RTN","SDNEXT",81,0)
 ..Q:CIEN=0  ;no associated clinic
"RTN","SDNEXT",82,0)
 ..S CNAME=$P($G(^SC(CIEN,0)),"^")  ;clinic name
"RTN","SDNEXT",83,0)
 ..S CLINIC(CIEN)=CNAME
"RTN","SDNEXT",84,0)
 K SDA
"RTN","SDNEXT",85,0)
 Q
"RTN","SDNEXT",86,0)
 ;
"RTN","SDNEXT",87,0)
DRIVE(CLINICA,LEN,BEGEND) ;driver
"RTN","SDNEXT",88,0)
 ;CLINICA - clinic array
"RTN","SDNEXT",89,0)
 ;LEN - appt. length wanted
"RTN","SDNEXT",90,0)
 ;BEGEND - begin date ^ end date
"RTN","SDNEXT",91,0)
 ;
"RTN","SDNEXT",92,0)
 N CIEN,COUNT,CONT,FND
"RTN","SDNEXT",93,0)
 S SDNEXT="",SDCT=1
"RTN","SDNEXT",94,0)
 S CIEN=0,STOP=0,COUNT=1
"RTN","SDNEXT",95,0)
 F  S CIEN=$O(CLINICA(CIEN)) Q:CIEN=""!(CIEN'?.N)!(STOP)  D
"RTN","SDNEXT",96,0)
 .S SDNEXT=""
"RTN","SDNEXT",97,0)
 .S SDSTRTDT=$P(BEGEND,"^")
"RTN","SDNEXT",98,0)
 .S SDMAX=$P(BEGEND,"^",2)
"RTN","SDNEXT",99,0)
 .S SDC(COUNT)=CIEN,SDC1(CIEN)=$G(CLINICA(CIEN))_"^"_LEN
"RTN","SDNEXT",100,0)
 .S SDCT=COUNT,SC=CIEN,FND=0
"RTN","SDNEXT",101,0)
 .D OVR^SDMULT0 S CONT=$$CONMA(CIEN,$S($O(CLINICA(CIEN)):0,1:1))
"RTN","SDNEXT",102,0)
 .K SDC(COUNT),SDC1(CIEN)
"RTN","SDNEXT",103,0)
 .;S CONT=$$CONMA(CIEN)
"RTN","SDNEXT",104,0)
 .Q:STOP
"RTN","SDNEXT",105,0)
 I $G(CONT)="M" D CLEAN S:$$ONE(.CLINICA) SDCLN=$O(CLINICA(0)) G ^SDM
"RTN","SDNEXT",106,0)
 Q
"RTN","SDNEXT",107,0)
CLEAN ;
"RTN","SDNEXT",108,0)
 D END^SDMULT0
"RTN","SDNEXT",109,0)
 K SDSTRTDT,SDNEXT,SDMAX,SDC,SDCT,SDC1,SDL,STOP,SDAPP,SDPCMM,SDCLN,FND
"RTN","SDNEXT",110,0)
 K SCPCC,SDPCM1,SC
"RTN","SDNEXT",111,0)
 Q
"RTN","SDNEXT",112,0)
 ;
"RTN","SDNEXT",113,0)
ONE(CLNA) ;one clinic selected? 1 or 0
"RTN","SDNEXT",114,0)
 N CNT,FIRST,RET,STP
"RTN","SDNEXT",115,0)
 S (CNT,STP)=0,RET=1
"RTN","SDNEXT",116,0)
 F  S CNT=$O(CLNA(CNT)) Q:CNT=""!(STP)  D
"RTN","SDNEXT",117,0)
 .I $D(FIRST) S STOP=1,RET=0
"RTN","SDNEXT",118,0)
 .I '$D(FIRST) S FIRST=1
"RTN","SDNEXT",119,0)
 Q RET
"RTN","SDNEXT",120,0)
 ;
"RTN","SDNEXT",121,0)
CONMA(CIEN,CONT) ;continue to view, exit or make appointment
"RTN","SDNEXT",122,0)
 ;
"RTN","SDNEXT",123,0)
PRT ;
"RTN","SDNEXT",124,0)
 S CONT=$G(CONT)
"RTN","SDNEXT",125,0)
 I $G(SDPCMM(CIEN))'>0&('CONT) Q -1
"RTN","SDNEXT",126,0)
 W !,"'^' TO EXIT"_$S('CONT:", 'C' TO CONTINUE",1:"")_" OR 'M' TO GOTO MAKE APPOINTMENT: "_$S(CONT:"^",1:"CONTINUE")_"//" R X:DTIME
"RTN","SDNEXT",127,0)
 I '$T!(X="^") S STOP=1,X=-1 G EX2
"RTN","SDNEXT",128,0)
 I (X'="^")&(X'="C")&(X'="M")&(X'="") G PRT
"RTN","SDNEXT",129,0)
 I CONT&(X="C") G PRT
"RTN","SDNEXT",130,0)
 I X="M" S STOP=1
"RTN","SDNEXT",131,0)
 I X="" S X="C"
"RTN","SDNEXT",132,0)
EX2 Q X
"VER")
8.0^22.0
"BLD",8102,6)
^457
**END**
**END**
