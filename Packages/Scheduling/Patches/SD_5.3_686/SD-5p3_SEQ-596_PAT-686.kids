Released SD*5.3*686 SEQ #596
Extracted from mail message
**KIDS**:SD*5.3*686^

**INSTALL NAME**
SD*5.3*686
"BLD",10340,0)
SD*5.3*686^SCHEDULING^0^3190930^y
"BLD",10340,1,0)
^^505^505^3180405^
"BLD",10340,1,1,0)
**************************************************************************
"BLD",10340,1,2,0)
**
"BLD",10340,1,3,0)
*                             GUI UPDATE 
"BLD",10340,1,4,0)
NOTICE                            *
"BLD",10340,1,5,0)
*-------------------------------------------------------------------------
"BLD",10340,1,6,0)
-*
"BLD",10340,1,7,0)
* This patch MUST be installed before the GUI update for release 
"BLD",10340,1,8,0)
1.5.1     *  
"BLD",10340,1,9,0)
* of VistA Scheduling GUI is installed. The previous 1.5 release will 
"BLD",10340,1,10,0)
work *
"BLD",10340,1,11,0)
* with no problems after this patch has been installed. However, if 
"BLD",10340,1,12,0)
the    *
"BLD",10340,1,13,0)
* 1.5.1 version is used without this patch, then all fields for 
"BLD",10340,1,14,0)
selecting  *
"BLD",10340,1,15,0)
* clinics, as well as the Audit Report, will not work 
"BLD",10340,1,16,0)
properly.            *
"BLD",10340,1,17,0)
**************************************************************************
"BLD",10340,1,18,0)
**
"BLD",10340,1,19,0)
 
"BLD",10340,1,20,0)
This patch contains the VistA components necessary to support the 1.5.1 
"BLD",10340,1,21,0)
release of VistA Scheduling Enhancements (VSE) as well as addressing the
"BLD",10340,1,22,0)
following issues:
"BLD",10340,1,23,0)
 
"BLD",10340,1,24,0)
1. R18120703FY18  - The VS GUI application freezes when the Audit Report 
"BLD",10340,1,25,0)
is
"BLD",10340,1,26,0)
                    run for all schedulers due to performance issues.
"BLD",10340,1,27,0)
 
"BLD",10340,1,28,0)
2. R17856900FY18, - If an appointment had been scheduled for a consult, 
"BLD",10340,1,29,0)
   R18564968FY18,   then that consult was completed, and finally the
"BLD",10340,1,30,0)
   R18648321FY18    appointment was canceled, the consult will be marked
"BLD",10340,1,31,0)
                    as active, even though it should remain as complete.
"BLD",10340,1,32,0)
 
"BLD",10340,1,33,0)
3. R17415367FY18  - If a user locks an appointment request (in this case,
"BLD",10340,1,34,0)
                    a consult request in particular) by selecting it in 
"BLD",10340,1,35,0)
the
"BLD",10340,1,36,0)
                    RM grid, then exits the GUI with it still locked, a 
"BLD",10340,1,37,0)
user
"BLD",10340,1,38,0)
                    in VistA will be unable to select the same request,
"BLD",10340,1,39,0)
                    instead receiving a message stating that the request 
"BLD",10340,1,40,0)
is
"BLD",10340,1,41,0)
                    locked.
"BLD",10340,1,42,0)
 
"BLD",10340,1,43,0)
4. R17039175FY18  - When using clinic lookup, if the user pauses the input
"BLD",10340,1,44,0)
                            is wiped out and has to be re-entered.
"BLD",10340,1,45,0)
 
"BLD",10340,1,46,0)
5. R18477670FY18  - When scheduling an appointment for an Inter-Facility
"BLD",10340,1,47,0)
                            Consult (IFC), the remote facility is not 
"BLD",10340,1,48,0)
notified.
"BLD",10340,1,49,0)
 
"BLD",10340,1,50,0)
This patch also contains modifications to routines (SDECAR1 and SDECAR2)
"BLD",10340,1,51,0)
and RPCs (SDEC ARGET and SDEC ARSET) as well changes to FileMan files
"BLD",10340,1,52,0)
(Appointment Request #409.85) related to a future enhancement - the 
"BLD",10340,1,53,0)
integration of Scheduling Manager functionality into the VS GUI.
"BLD",10340,1,54,0)
 
"BLD",10340,1,55,0)
 
"BLD",10340,1,56,0)
 
"BLD",10340,1,57,0)
Patch Components
"BLD",10340,1,58,0)
================
"BLD",10340,1,59,0)
 
"BLD",10340,1,60,0)
Files & Fields Associated:
"BLD",10340,1,61,0)
 
"BLD",10340,1,62,0)
File Name (#)                                             New/Modified/
"BLD",10340,1,63,0)
  Sub-file Name (#)   Field Name (Number)                   Deleted
"BLD",10340,1,64,0)
-------------------   ---------------------------------   -------------
"BLD",10340,1,65,0)
SDEC APPT REQUEST (#409.85)                               MODIFIED
"BLD",10340,1,66,0)
                              VAOS GUID (#5)                              
"BLD",10340,1,67,0)
NEW
"BLD",10340,1,68,0)
 
"BLD",10340,1,69,0)
SDEC CONTACT (#409.86)                                    MODIFIED
"BLD",10340,1,70,0)
 
"BLD",10340,1,71,0)
SD AUDIT STATISTICS (#409.97)                             NEW
"BLD",10340,1,72,0)
                      SCHEDULER (#.01)                    NEW
"BLD",10340,1,73,0)
                      DATE (#1)                           NEW
"BLD",10340,1,74,0)
                      PATIENT CONTACTS (#2)               NEW
"BLD",10340,1,75,0)
                      APPT REQUESTS (#3)                  NEW
"BLD",10340,1,76,0)
                      APPT APPOINTMENTS MADE (#4)         NEW
"BLD",10340,1,77,0)
                      APPT CLOSED (#5)                    NEW
"BLD",10340,1,78,0)
                      MRTC OPENED (#6)                    NEW
"BLD",10340,1,79,0)
                      MRTC CLOSED (#7)                    NEW
"BLD",10340,1,80,0)
                      EWL ENTRIES (#8)                    NEW
"BLD",10340,1,81,0)
                      EWL APPOINTMENTS MADE (#9)          NEW
"BLD",10340,1,82,0)
                      EWL CLOSED (#10)                    NEW
"BLD",10340,1,83,0)
                      PtCSch ENTRIES (#11)                NEW
"BLD",10340,1,84,0)
                      PtCSch APPOINTMENTS MADE (#12)      NEW
"BLD",10340,1,85,0)
                      CONSULT APPOINTMENTS MADE (#13)     NEW
"BLD",10340,1,86,0)
                      APPOINTMENTS CANCELLED (#14)        NEW
"BLD",10340,1,87,0)
                      TOTAL ACTIONS (#15)                 NEW
"BLD",10340,1,88,0)
 
"BLD",10340,1,89,0)
Bulletins Associated:
"BLD",10340,1,90,0)
                                                          New/Modified/
"BLD",10340,1,91,0)
Bulletin Name                                               Deleted    
"BLD",10340,1,92,0)
-------------                                             -------------
"BLD",10340,1,93,0)
N/A
"BLD",10340,1,94,0)
 
"BLD",10340,1,95,0)
 
"BLD",10340,1,96,0)
 
"BLD",10340,1,97,0)
Dialogs Associated:
"BLD",10340,1,98,0)
                                                          New/Modified/
"BLD",10340,1,99,0)
Dialog Name                                                 Deleted    
"BLD",10340,1,100,0)
-----------                                               -------------
"BLD",10340,1,101,0)
N/A
"BLD",10340,1,102,0)
 
"BLD",10340,1,103,0)
 
"BLD",10340,1,104,0)
 
"BLD",10340,1,105,0)
Forms Associated:
"BLD",10340,1,106,0)
                                                          New/Modified/
"BLD",10340,1,107,0)
Form Name                    File Name (Number)             Deleted    
"BLD",10340,1,108,0)
---------                    ------------------           -------------
"BLD",10340,1,109,0)
N/A
"BLD",10340,1,110,0)
 
"BLD",10340,1,111,0)
 
"BLD",10340,1,112,0)
 
"BLD",10340,1,113,0)
Functions Associated:
"BLD",10340,1,114,0)
                                                          New/Modified/
"BLD",10340,1,115,0)
Function Name                                               Deleted    
"BLD",10340,1,116,0)
-------------                                             -------------
"BLD",10340,1,117,0)
N/A
"BLD",10340,1,118,0)
 
"BLD",10340,1,119,0)
 
"BLD",10340,1,120,0)
 
"BLD",10340,1,121,0)
HL Logical Link:
"BLD",10340,1,122,0)
                                                          New/Modified/
"BLD",10340,1,123,0)
HL Logical Name                                             Deleted    
"BLD",10340,1,124,0)
---------------                                           -------------
"BLD",10340,1,125,0)
N/A
"BLD",10340,1,126,0)
 
"BLD",10340,1,127,0)
 
"BLD",10340,1,128,0)
 
"BLD",10340,1,129,0)
HL7 Application Parameters:
"BLD",10340,1,130,0)
                                                          New/Modified/
"BLD",10340,1,131,0)
HL7 Parameter Name                                          Deleted    
"BLD",10340,1,132,0)
------------------                                        -------------
"BLD",10340,1,133,0)
N/A
"BLD",10340,1,134,0)
 
"BLD",10340,1,135,0)
 
"BLD",10340,1,136,0)
 
"BLD",10340,1,137,0)
HLO Application Registry:
"BLD",10340,1,138,0)
                                                          New/Modified/
"BLD",10340,1,139,0)
HLO Registry Name                                           Deleted    
"BLD",10340,1,140,0)
-----------------                                         -------------
"BLD",10340,1,141,0)
N/A
"BLD",10340,1,142,0)
 
"BLD",10340,1,143,0)
 
"BLD",10340,1,144,0)
 
"BLD",10340,1,145,0)
Help Frames Associated:
"BLD",10340,1,146,0)
                                                          New/Modified/
"BLD",10340,1,147,0)
Help Frame Name                                             Deleted    
"BLD",10340,1,148,0)
---------------                                           -------------
"BLD",10340,1,149,0)
N/A
"BLD",10340,1,150,0)
 
"BLD",10340,1,151,0)
 
"BLD",10340,1,152,0)
 
"BLD",10340,1,153,0)
Mail Groups Associated:
"BLD",10340,1,154,0)
                                                          New/Modified/
"BLD",10340,1,155,0)
Mail Group Name                                             Deleted    
"BLD",10340,1,156,0)
---------------                                           -------------
"BLD",10340,1,157,0)
N/A
"BLD",10340,1,158,0)
 
"BLD",10340,1,159,0)
 
"BLD",10340,1,160,0)
 
"BLD",10340,1,161,0)
Options Associated:
"BLD",10340,1,162,0)
                                                                  
"BLD",10340,1,163,0)
New/Modified/
"BLD",10340,1,164,0)
Option Name                                              Type       
"BLD",10340,1,165,0)
Deleted    
"BLD",10340,1,166,0)
-----------                                              ----     
"BLD",10340,1,167,0)
-------------
"BLD",10340,1,168,0)
CLINICAL SCHEDULING PROCEDURE CALLS [SDECRPC]            Broker   MODIFIED
"BLD",10340,1,169,0)
COMPILE AUDIT REPORT FOR A SELECTED                      Routine  NEW
"BLD",10340,1,170,0)
   DATE [SDEC COMPILE AUDIT REPORT]
"BLD",10340,1,171,0)
COMPILE YESTERDAY'S AUDIT REPORT [SDEC AUDIT REPORT JOB] Routine  NEW
"BLD",10340,1,172,0)
RELEASE APPOINTMENT REQUEST LOCKS[SDEC RELEASE LOCKS]    Routine  NEW
"BLD",10340,1,173,0)
SUPERVISOR MENU [SDSUP]                                  Menu     MODIFIED
"BLD",10340,1,174,0)
 
"BLD",10340,1,175,0)
 
"BLD",10340,1,176,0)
 
"BLD",10340,1,177,0)
Parameter Definitions:
"BLD",10340,1,178,0)
                                                          New/Modified/
"BLD",10340,1,179,0)
Parameter Name                                              Deleted    
"BLD",10340,1,180,0)
--------------                                            -------------
"BLD",10340,1,181,0)
N/A
"BLD",10340,1,182,0)
 
"BLD",10340,1,183,0)
 
"BLD",10340,1,184,0)
 
"BLD",10340,1,185,0)
Parameter Template:
"BLD",10340,1,186,0)
                                                          New/Modified/
"BLD",10340,1,187,0)
Template Name                                               Deleted    
"BLD",10340,1,188,0)
-------------                                             -------------
"BLD",10340,1,189,0)
N/A
"BLD",10340,1,190,0)
 
"BLD",10340,1,191,0)
 
"BLD",10340,1,192,0)
 
"BLD",10340,1,193,0)
Protocols Associated:
"BLD",10340,1,194,0)
                                                          New/Modified/
"BLD",10340,1,195,0)
Protocol Name                                               Deleted    
"BLD",10340,1,196,0)
-------------                                             -------------
"BLD",10340,1,197,0)
N/A
"BLD",10340,1,198,0)
 
"BLD",10340,1,199,0)
 
"BLD",10340,1,200,0)
 
"BLD",10340,1,201,0)
Remote Procedures Associated:
"BLD",10340,1,202,0)
                                                          New/Modified/
"BLD",10340,1,203,0)
Remote Procedure Name                                       Deleted    
"BLD",10340,1,204,0)
---------------------                                     -------------
"BLD",10340,1,205,0)
SDEC ARGET                                                MODIFIED
"BLD",10340,1,206,0)
SDEC ARSET                                                MODIFIED
"BLD",10340,1,207,0)
SDEC RESCE                                                NEW
"BLD",10340,1,208,0)
SDEC SUMMGET2                                             NEW
"BLD",10340,1,209,0)
 
"BLD",10340,1,210,0)
 
"BLD",10340,1,211,0)
 
"BLD",10340,1,212,0)
Security Keys Associated:
"BLD",10340,1,213,0)
                                                          New/Modified/
"BLD",10340,1,214,0)
Security Key Name                                           Deleted    
"BLD",10340,1,215,0)
-----------------                                         -------------
"BLD",10340,1,216,0)
N/A
"BLD",10340,1,217,0)
 
"BLD",10340,1,218,0)
 
"BLD",10340,1,219,0)
 
"BLD",10340,1,220,0)
Templates, Input Associated:
"BLD",10340,1,221,0)
                                                          New/Modified/
"BLD",10340,1,222,0)
Template Name      Type      File Name (Number)             Deleted    
"BLD",10340,1,223,0)
-------------      ----      ------------------           -------------
"BLD",10340,1,224,0)
N/A
"BLD",10340,1,225,0)
 
"BLD",10340,1,226,0)
 
"BLD",10340,1,227,0)
 
"BLD",10340,1,228,0)
Templates, List Associated:
"BLD",10340,1,229,0)
                                                          New/Modified/
"BLD",10340,1,230,0)
Template Name      Type                                     Deleted    
"BLD",10340,1,231,0)
-------------      ----                                   -------------
"BLD",10340,1,232,0)
N/A
"BLD",10340,1,233,0)
 
"BLD",10340,1,234,0)
 
"BLD",10340,1,235,0)
 
"BLD",10340,1,236,0)
Templates, Print Associated:
"BLD",10340,1,237,0)
                                                            New/Modified/
"BLD",10340,1,238,0)
Template Name         Type  File Name (Number)                 Deleted    
"BLD",10340,1,239,0)
-------------         ----  ------------------              -------------
"BLD",10340,1,240,0)
SDEC AUDIT DATE PRINT Print SDEC AUDIT STATISTICS (#409.97) NEW
"BLD",10340,1,241,0)
 
"BLD",10340,1,242,0)
 
"BLD",10340,1,243,0)
 
"BLD",10340,1,244,0)
Templates, Sort Associated:
"BLD",10340,1,245,0)
                                                               
"BLD",10340,1,246,0)
New/Modified/
"BLD",10340,1,247,0)
Template Name             Type File Name (Number)                 
"BLD",10340,1,248,0)
Deleted    
"BLD",10340,1,249,0)
-------------             ---- ------------------              
"BLD",10340,1,250,0)
-------------
"BLD",10340,1,251,0)
SDEC AUDIT REPORT BY DATE Sort SDEC AUDIT STATISTICS (#409.97) NEW
"BLD",10340,1,252,0)
 
"BLD",10340,1,253,0)
 
"BLD",10340,1,254,0)
Additional Information:
"BLD",10340,1,255,0)
N/A
"BLD",10340,1,256,0)
 
"BLD",10340,1,257,0)
 
"BLD",10340,1,258,0)
New Service Requests (NSRs)
"BLD",10340,1,259,0)
----------------------------  
"BLD",10340,1,260,0)
N/A
"BLD",10340,1,261,0)
 
"BLD",10340,1,262,0)
 
"BLD",10340,1,263,0)
Patient Safety Issues (PSIs)
"BLD",10340,1,264,0)
-----------------------------
"BLD",10340,1,265,0)
N/A
"BLD",10340,1,266,0)
 
"BLD",10340,1,267,0)
 
"BLD",10340,1,268,0)
Service Desk Manager (SDM) Ticket(s) & Overview
"BLD",10340,1,269,0)
-----------------------------------------------
"BLD",10340,1,270,0)
1. R18120703FY18  Cancel Audit Data Error after selecting ALL in Audit 
"BLD",10340,1,271,0)
Report
"BLD",10340,1,272,0)
  
"BLD",10340,1,273,0)
Problem:
"BLD",10340,1,274,0)
-------
"BLD",10340,1,275,0)
In the Audit Report, when the user chooses ALL in order to run the report 
"BLD",10340,1,276,0)
for
"BLD",10340,1,277,0)
all schedulers, the system hangs for several minutes attempting to load 
"BLD",10340,1,278,0)
data,
"BLD",10340,1,279,0)
then finally returns an RPCException when the connection times out. This 
"BLD",10340,1,280,0)
also
"BLD",10340,1,281,0)
terminate's the user's connection to VistA until they close and reopen VS 
"BLD",10340,1,282,0)
GUI. 
"BLD",10340,1,283,0)
 
"BLD",10340,1,284,0)
Resolution:
"BLD",10340,1,285,0)
----------
"BLD",10340,1,286,0)
The data for the Audit Report is now compiled by a nightly job so that 
"BLD",10340,1,287,0)
much
"BLD",10340,1,288,0)
less data needs to be transmitted to the client in order to use the 
"BLD",10340,1,289,0)
report.
"BLD",10340,1,290,0)
Users will now be able to run the report for all schedulers without
"BLD",10340,1,291,0)
encountering the timeout.
"BLD",10340,1,292,0)
 
"BLD",10340,1,293,0)
2. R17856900FY18, R18564968FY18, R18648321FY18 Reactivating completed 
"BLD",10340,1,294,0)
consults
"BLD",10340,1,295,0)
  
"BLD",10340,1,296,0)
Problem:
"BLD",10340,1,297,0)
-------
"BLD",10340,1,298,0)
If an appointment is created for a consult, then the consult is marked as
"BLD",10340,1,299,0)
complete, then finally the appointment is canceled, the consult returns 
"BLD",10340,1,300,0)
to the
"BLD",10340,1,301,0)
active status instead of remaining complete. 
"BLD",10340,1,302,0)
 
"BLD",10340,1,303,0)
Resolution:
"BLD",10340,1,304,0)
----------
"BLD",10340,1,305,0)
In this situation, the consult will now remain in the complete status.
"BLD",10340,1,306,0)
 
"BLD",10340,1,307,0)
3. R17415367FY18 Incorrect lock handling in RM Grid
"BLD",10340,1,308,0)
  
"BLD",10340,1,309,0)
Problem:
"BLD",10340,1,310,0)
-------
"BLD",10340,1,311,0)
When a user selects a request in the RM grid, the request is locked until
"BLD",10340,1,312,0)
another request is selected. If the user exits the program, the lock is 
"BLD",10340,1,313,0)
not
"BLD",10340,1,314,0)
released. If a VistA user tries to use the previously locked request, they
"BLD",10340,1,315,0)
will be prevented from doing so. (To exacerbate this, the GUI was not 
"BLD",10340,1,316,0)
handling
"BLD",10340,1,317,0)
locks correctly and would give the lock to any user that tried to get it 
"BLD",10340,1,318,0)
even
"BLD",10340,1,319,0)
if another user held the lock, so this issue was not visible to GUI
"BLD",10340,1,320,0)
users.)
"BLD",10340,1,321,0)
 
"BLD",10340,1,322,0)
Resolution:
"BLD",10340,1,323,0)
----------
"BLD",10340,1,324,0)
The request that a user had locked when they log out is now unlocked
"BLD",10340,1,325,0)
correctly. In addition, if a user tries to work a request in the GUI that
"BLD",10340,1,326,0)
another user has locked, they will receive a message that the request is
"BLD",10340,1,327,0)
locked and which user holds the lock. Finally, a VistA option on the
"BLD",10340,1,328,0)
Supervisor menu has been added that will release all locks held by a user.
"BLD",10340,1,329,0)
    
"BLD",10340,1,330,0)
4. R17039175FY18 Consult lookup interaction errors
"BLD",10340,1,331,0)
 
"BLD",10340,1,332,0)
Problem:
"BLD",10340,1,333,0)
-------
"BLD",10340,1,334,0)
When using clinic lookup in the VS GUI, if the user pauses typing, the 
"BLD",10340,1,335,0)
input 
"BLD",10340,1,336,0)
is wiped out and has to be re-entered. A pop-up window appears if the 
"BLD",10340,1,337,0)
user's 
"BLD",10340,1,338,0)
input results in more than 50 matches and the input is erased. In 
"BLD",10340,1,339,0)
addtion, 
"BLD",10340,1,340,0)
the user cannot refine the list of clinics returned by typing additional 
"BLD",10340,1,341,0)
characters.
"BLD",10340,1,342,0)
 
"BLD",10340,1,343,0)
Resolution:
"BLD",10340,1,344,0)
----------
"BLD",10340,1,345,0)
GUI changes made, eliminating the pop-up window and responding to the 
"BLD",10340,1,346,0)
user's
"BLD",10340,1,347,0)
input including narrowing the list of returned values when each additional
"BLD",10340,1,348,0)
character is entered. A new RPC was created for the GUI to support this
"BLD",10340,1,349,0)
change. The new RPC returns a more limited amount of data so that the
"BLD",10340,1,350,0)
GUI can respond more quickly to the user's input.
"BLD",10340,1,351,0)
 
"BLD",10340,1,352,0)
5. R18477670FY18 Remote facility not updated when appointments made for 
"BLD",10340,1,353,0)
IFCs
"BLD",10340,1,354,0)
 
"BLD",10340,1,355,0)
Problem:
"BLD",10340,1,356,0)
-------
"BLD",10340,1,357,0)
When scheduling an appointment for an IFC, the remote facility is not 
"BLD",10340,1,358,0)
notified.
"BLD",10340,1,359,0)
RPC code for VS GUI did not include functionality in VistA Scheduling for 
"BLD",10340,1,360,0)
the 
"BLD",10340,1,361,0)
generation of IFC notifications.
"BLD",10340,1,362,0)
 
"BLD",10340,1,363,0)
Resolution:
"BLD",10340,1,364,0)
----------
"BLD",10340,1,365,0)
Modified the RPC code to call a VistA Scheduling API that generates IFC 
"BLD",10340,1,366,0)
notifications.
"BLD",10340,1,367,0)
 
"BLD",10340,1,368,0)
Test Sites:
"BLD",10340,1,369,0)
----------
"BLD",10340,1,370,0)
TBA
"BLD",10340,1,371,0)
 
"BLD",10340,1,372,0)
 
"BLD",10340,1,373,0)
Documentation Retrieval Instructions
"BLD",10340,1,374,0)
------------------------------------ 
"BLD",10340,1,375,0)
Updated documentation describing the new functionality introduced by this 
"BLD",10340,1,376,0)
patch is available.
"BLD",10340,1,377,0)
 
"BLD",10340,1,378,0)
The preferred method is to FTP the files from 
"BLD",10340,1,379,0)
ftp://download.vista.domain.ext/.
"BLD",10340,1,380,0)
This transmits the files from the first available FTP server. Sites may 
"BLD",10340,1,381,0)
also elect to retrieve software directly from a specific server as 
"BLD",10340,1,382,0)
follows:
"BLD",10340,1,383,0)
 
"BLD",10340,1,384,0)
 Hines          ftp.domain.ext   <ftp://ftp.domain.ext>
"BLD",10340,1,385,0)
 Salt Lake City ftp.domain.ext     <ftp://ftp.domain.ext>
"BLD",10340,1,386,0)
 
"BLD",10340,1,387,0)
Documentation can also be found on the VA Software Documentation Library 
"BLD",10340,1,388,0)
at:
"BLD",10340,1,389,0)
http://www4.domain.ext/vdl/
"BLD",10340,1,390,0)
 
"BLD",10340,1,391,0)
Title                                          File Name          FTP Mode
"BLD",10340,1,392,0)
--------------------------------------------------------------------------
"BLD",10340,1,393,0)
VistA Scheduling Enhancements GUI User Guide   VSE_VA_GUI_UG.PDF  Binary
"BLD",10340,1,394,0)
VistA Scheduling Enhancements Technical Manual VSE_TM.PDF         Binary
"BLD",10340,1,395,0)
 
"BLD",10340,1,396,0)
 
"BLD",10340,1,397,0)
Patch Installation:
"BLD",10340,1,398,0)
 
"BLD",10340,1,399,0)
 
"BLD",10340,1,400,0)
Pre/Post Installation Overview
"BLD",10340,1,401,0)
------------------------------
"BLD",10340,1,402,0)
Post-installation, there are 3 tasks: 1) re-index the SDEC CONTACT file,
"BLD",10340,1,403,0)
2) schedule the audit statistics compiler to run early each morning in 
"BLD",10340,1,404,0)
TaskMan and 3) compile enough previous audit statistics for reporting 
"BLD",10340,1,405,0)
users.
"BLD",10340,1,406,0)
These tasks will be detailed in the Post-Installation Instructions 
"BLD",10340,1,407,0)
section.
"BLD",10340,1,408,0)
  
"BLD",10340,1,409,0)
Installation Instructions
"BLD",10340,1,410,0)
-------------------------
"BLD",10340,1,411,0)
Install Time - less than 5 minutes.
"BLD",10340,1,412,0)
    
"BLD",10340,1,413,0)
   1. Use the INSTALL/CHECK MESSAGE option on the PackMan menu.
"BLD",10340,1,414,0)
   
"BLD",10340,1,415,0)
   2. From the Kernel Installation & Distribution System menu, select
"BLD",10340,1,416,0)
      the Installation menu.
"BLD",10340,1,417,0)
   
"BLD",10340,1,418,0)
   3. From this menu, you may select to use the following options
"BLD",10340,1,419,0)
      (when prompted for INSTALL NAME, enter SD*5.3*686):
"BLD",10340,1,420,0)
          a.  Verify Checksums in Transport Global - This option will 
"BLD",10340,1,421,0)
allow
"BLD",10340,1,422,0)
              you to ensure the integrity of the routines that are in the
"BLD",10340,1,423,0)
              transport global.
"BLD",10340,1,424,0)
          b.  Print Transport Global - This option will allow you to view
"BLD",10340,1,425,0)
              the components of the KIDS build.
"BLD",10340,1,426,0)
          c.  Compare Transport Global to Current System - This option 
"BLD",10340,1,427,0)
will
"BLD",10340,1,428,0)
              allow you to view all changes that will be made when this 
"BLD",10340,1,429,0)
              patch is installed.  It compares all components of this
"BLD",10340,1,430,0)
              patch (routines, DD's, templates, etc.).
"BLD",10340,1,431,0)
          d.  Backup a Transport Global - This option will create a backup
"BLD",10340,1,432,0)
              message of any routines exported with this patch. It will 
"BLD",10340,1,433,0)
not
"BLD",10340,1,434,0)
              backup any other changes such as DD's or templates.
"BLD",10340,1,435,0)
   
"BLD",10340,1,436,0)
   4. Use the Install Package(s) option and select the package SD*5.3*686.
"BLD",10340,1,437,0)
   
"BLD",10340,1,438,0)
   5. When prompted "Want KIDS to INHIBIT LOGONs during the install? NO//"
"BLD",10340,1,439,0)
      respond NO.
"BLD",10340,1,440,0)
   6. When prompted "Want to DISABLE Scheduled Options, Menu Options, and
"BLD",10340,1,441,0)
      Protocols? NO//", respond NO
"BLD",10340,1,442,0)
 
"BLD",10340,1,443,0)
Post-Installation Instructions
"BLD",10340,1,444,0)
------------------------------
"BLD",10340,1,445,0)
1.  RE-INDEX THE SDEC CONTACT FILE
"BLD",10340,1,446,0)
    ------------------------------
"BLD",10340,1,447,0)
    VA FileMan 22.2
"BLD",10340,1,448,0)
      
"BLD",10340,1,449,0)
    Select OPTION: UTILITY FUNCTIONS  
"BLD",10340,1,450,0)
                   ----
"BLD",10340,1,451,0)
        
"BLD",10340,1,452,0)
    Select UTILITY OPTION: 4  RE-INDEX FILE
"BLD",10340,1,453,0)
                           -
"BLD",10340,1,454,0)
     
"BLD",10340,1,455,0)
    MODIFY WHAT FILE: SD Audit Statistics// 409.86  SDEC CONTACT
"BLD",10340,1,456,0)
                                            ------
"BLD",10340,1,457,0)
                                              (0 entries)
"BLD",10340,1,458,0)
     
"BLD",10340,1,459,0)
    THERE ARE 3 INDICES WITHIN THIS FILE
"BLD",10340,1,460,0)
    DO YOU WISH TO RE-CROSS-REFERENCE ONE PARTICULAR INDEX? No// Y  (Yes)
"BLD",10340,1,461,0)
                                                                 -
"BLD",10340,1,462,0)
     
"BLD",10340,1,463,0)
    What type of cross-reference (Traditional or New)? Traditional// NEW
"BLD",10340,1,464,0)
                                                                     ---
"BLD",10340,1,465,0)
     
"BLD",10340,1,466,0)
              File: SDEC CONTACT (#409.86)
"BLD",10340,1,467,0)
    Select Subfile: 3  DATE/TIME of CONTACT  (Subfile #409.863)
"BLD",10340,1,468,0)
                    -
"BLD",10340,1,469,0)
     
"BLD",10340,1,470,0)
    Current Indexes on subfile #409.863:
"BLD",10340,1,471,0)
      1404   'AD' whole file index (resides on file #409.86)
"BLD",10340,1,472,0)
     
"BLD",10340,1,473,0)
    Which Index do you wish to re-cross-reference? 1404//   AD
"BLD",10340,1,474,0)
                                                            --
"BLD",10340,1,475,0)
     
"BLD",10340,1,476,0)
    Do you want to delete the existing 'AD' cross-reference? YES
"BLD",10340,1,477,0)
                                                             ---
"BLD",10340,1,478,0)
    Do you want to re-build the 'AD' cross reference? YES  ...DONE! 
"BLD",10340,1,479,0)
                                                      ---
"BLD",10340,1,480,0)
 
"BLD",10340,1,481,0)
2.  SCHEDULE THE AUDIT REPORT JOB
"BLD",10340,1,482,0)
    -----------------------------
"BLD",10340,1,483,0)
    Access the TASKMAN MANAGEMENT option then select Schedule/Unschedule 
"BLD",10340,1,484,0)
    options. Schedule the SDEC AUDIT REPORT JOB option to run at some 
"BLD",10340,1,485,0)
point 
"BLD",10340,1,486,0)
    in the early morning tomorrow (such as 1:00 am) with a rescheduling
"BLD",10340,1,487,0)
    frequency of one day (1D).
"BLD",10340,1,488,0)
 
"BLD",10340,1,489,0)
3.  COMPILE DATA FOR THE AUDIT REPORT
"BLD",10340,1,490,0)
    ---------------------------------
"BLD",10340,1,491,0)
    Access the SDEC COMPILE AUDIT REPORT option. Enter the date range 
"BLD",10340,1,492,0)
that 
"BLD",10340,1,493,0)
    you want to be able to report statistics for.  
"BLD",10340,1,494,0)
 
"BLD",10340,1,495,0)
    NOTE: You can run the option as many times as needed to compile the
"BLD",10340,1,496,0)
    report statistics. Compiling will be skipped if it has already been 
"BLD",10340,1,497,0)
done
"BLD",10340,1,498,0)
    for a day. It is recommended that you compile a single day the first 
"BLD",10340,1,499,0)
time
"BLD",10340,1,500,0)
    you use the option to gauge the amount of time required at your 
"BLD",10340,1,501,0)
facility.
"BLD",10340,1,502,0)
    Compiling audit statistics can be done at any time after installation 
"BLD",10340,1,503,0)
that
"BLD",10340,1,504,0)
    is convenient, but users will only be able to get data on the audit
"BLD",10340,1,505,0)
    report that has been compiled.
"BLD",10340,4,0)
^9.64PA^409.85^3
"BLD",10340,4,409.85,0)
409.85
"BLD",10340,4,409.85,2,0)
^9.641^409.85^1
"BLD",10340,4,409.85,2,409.85,0)
SDEC APPT REQUEST  (File-top level)
"BLD",10340,4,409.85,2,409.85,1,0)
^9.6411^5^1
"BLD",10340,4,409.85,2,409.85,1,5,0)
VAOS GUID
"BLD",10340,4,409.85,222)
y^y^p^^^^n^^n
"BLD",10340,4,409.85,224)

"BLD",10340,4,409.86,0)
409.86
"BLD",10340,4,409.86,222)
y^y^f^^^^n
"BLD",10340,4,409.97,0)
409.97
"BLD",10340,4,409.97,222)
y^y^f^^^^n
"BLD",10340,4,"APDD",409.85,409.85)

"BLD",10340,4,"APDD",409.85,409.85,5)

"BLD",10340,4,"B",409.85,409.85)

"BLD",10340,4,"B",409.86,409.86)

"BLD",10340,4,"B",409.97,409.97)

"BLD",10340,6)
11^
"BLD",10340,6.3)
53
"BLD",10340,"INIT")
SD686PST
"BLD",10340,"KRN",0)
^9.67PA^779.2^20
"BLD",10340,"KRN",.4,0)
.4
"BLD",10340,"KRN",.4,"NM",0)
^9.68A^1^1
"BLD",10340,"KRN",.4,"NM",1,0)
SDEC AUDIT DATE PRINT    FILE #409.97^409.97^0
"BLD",10340,"KRN",.4,"NM","B","SDEC AUDIT DATE PRINT    FILE #409.97",1)

"BLD",10340,"KRN",.401,0)
.401
"BLD",10340,"KRN",.401,"NM",0)
^9.68A^1^1
"BLD",10340,"KRN",.401,"NM",1,0)
SDEC AUDIT REPORT BY DATE    FILE #409.97^409.97^0
"BLD",10340,"KRN",.401,"NM","B","SDEC AUDIT REPORT BY DATE    FILE #409.97",1)

"BLD",10340,"KRN",.402,0)
.402
"BLD",10340,"KRN",.403,0)
.403
"BLD",10340,"KRN",.5,0)
.5
"BLD",10340,"KRN",.84,0)
.84
"BLD",10340,"KRN",3.6,0)
3.6
"BLD",10340,"KRN",3.8,0)
3.8
"BLD",10340,"KRN",9.2,0)
9.2
"BLD",10340,"KRN",9.8,0)
9.8
"BLD",10340,"KRN",9.8,"NM",0)
^9.68A^16^15
"BLD",10340,"KRN",9.8,"NM",1,0)
SDEC01C^^0^B69927064
"BLD",10340,"KRN",9.8,"NM",2,0)
SDECAUD^^0^B101121122
"BLD",10340,"KRN",9.8,"NM",3,0)
SDEC^^0^B133133924
"BLD",10340,"KRN",9.8,"NM",4,0)
SDECCON^^0^B17988891
"BLD",10340,"KRN",9.8,"NM",5,0)
SDEC07A^^0^B87285683
"BLD",10340,"KRN",9.8,"NM",6,0)
SDECLK^^0^B22769738
"BLD",10340,"KRN",9.8,"NM",7,0)
SDECAR1^^0^B167351251
"BLD",10340,"KRN",9.8,"NM",8,0)
SDECAR2^^0^B199967808
"BLD",10340,"KRN",9.8,"NM",9,0)
SDCNSLT^^0^B45406127
"BLD",10340,"KRN",9.8,"NM",10,0)
SDEC07^^0^B201524444
"BLD",10340,"KRN",9.8,"NM",12,0)
SDEC07C^^0^B2886008
"BLD",10340,"KRN",9.8,"NM",13,0)
SDEC51^^0^B175129662
"BLD",10340,"KRN",9.8,"NM",14,0)
SDEC57^^0^B100290193
"BLD",10340,"KRN",9.8,"NM",15,0)
SD686PST^^0^B21201631
"BLD",10340,"KRN",9.8,"NM",16,0)
SDAM2^^0^B31042321
"BLD",10340,"KRN",9.8,"NM","B","SD686PST",15)

"BLD",10340,"KRN",9.8,"NM","B","SDAM2",16)

"BLD",10340,"KRN",9.8,"NM","B","SDCNSLT",9)

"BLD",10340,"KRN",9.8,"NM","B","SDEC",3)

"BLD",10340,"KRN",9.8,"NM","B","SDEC01C",1)

"BLD",10340,"KRN",9.8,"NM","B","SDEC07",10)

"BLD",10340,"KRN",9.8,"NM","B","SDEC07A",5)

"BLD",10340,"KRN",9.8,"NM","B","SDEC07C",12)

"BLD",10340,"KRN",9.8,"NM","B","SDEC51",13)

"BLD",10340,"KRN",9.8,"NM","B","SDEC57",14)

"BLD",10340,"KRN",9.8,"NM","B","SDECAR1",7)

"BLD",10340,"KRN",9.8,"NM","B","SDECAR2",8)

"BLD",10340,"KRN",9.8,"NM","B","SDECAUD",2)

"BLD",10340,"KRN",9.8,"NM","B","SDECCON",4)

"BLD",10340,"KRN",9.8,"NM","B","SDECLK",6)

"BLD",10340,"KRN",19,0)
19
"BLD",10340,"KRN",19,"NM",0)
^9.68A^6^6
"BLD",10340,"KRN",19,"NM",1,0)
SDECRPC^^0
"BLD",10340,"KRN",19,"NM",2,0)
SDEC AUDIT REPORT JOB^^0
"BLD",10340,"KRN",19,"NM",3,0)
SDEC COMPILE AUDIT REPORT^^0
"BLD",10340,"KRN",19,"NM",4,0)
SDEC RELEASE LOCKS^^0
"BLD",10340,"KRN",19,"NM",5,0)
SDSUP^^2
"BLD",10340,"KRN",19,"NM",6,0)
SDEC PRINT AUDIT REPORT^^0
"BLD",10340,"KRN",19,"NM","B","SDEC AUDIT REPORT JOB",2)

"BLD",10340,"KRN",19,"NM","B","SDEC COMPILE AUDIT REPORT",3)

"BLD",10340,"KRN",19,"NM","B","SDEC PRINT AUDIT REPORT",6)

"BLD",10340,"KRN",19,"NM","B","SDEC RELEASE LOCKS",4)

"BLD",10340,"KRN",19,"NM","B","SDECRPC",1)

"BLD",10340,"KRN",19,"NM","B","SDSUP",5)

"BLD",10340,"KRN",19.1,0)
19.1
"BLD",10340,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",10340,"KRN",101,0)
101
"BLD",10340,"KRN",409.61,0)
409.61
"BLD",10340,"KRN",771,0)
771
"BLD",10340,"KRN",779.2,0)
779.2
"BLD",10340,"KRN",870,0)
870
"BLD",10340,"KRN",8989.51,0)
8989.51
"BLD",10340,"KRN",8989.52,0)
8989.52
"BLD",10340,"KRN",8994,0)
8994
"BLD",10340,"KRN",8994,"NM",0)
^9.68A^5^5
"BLD",10340,"KRN",8994,"NM",1,0)
SDEC SUMMGET2^^0
"BLD",10340,"KRN",8994,"NM",2,0)
SDEC RESCE^^0
"BLD",10340,"KRN",8994,"NM",3,0)
SDEC ARSET^^0
"BLD",10340,"KRN",8994,"NM",4,0)
SDEC ARGET^^0
"BLD",10340,"KRN",8994,"NM",5,0)
SDECAR1 ARGUID^^0
"BLD",10340,"KRN",8994,"NM","B","SDEC ARGET",4)

"BLD",10340,"KRN",8994,"NM","B","SDEC ARSET",3)

"BLD",10340,"KRN",8994,"NM","B","SDEC RESCE",2)

"BLD",10340,"KRN",8994,"NM","B","SDEC SUMMGET2",1)

"BLD",10340,"KRN",8994,"NM","B","SDECAR1 ARGUID",5)

"BLD",10340,"KRN","B",.4,.4)

"BLD",10340,"KRN","B",.401,.401)

"BLD",10340,"KRN","B",.402,.402)

"BLD",10340,"KRN","B",.403,.403)

"BLD",10340,"KRN","B",.5,.5)

"BLD",10340,"KRN","B",.84,.84)

"BLD",10340,"KRN","B",3.6,3.6)

"BLD",10340,"KRN","B",3.8,3.8)

"BLD",10340,"KRN","B",9.2,9.2)

"BLD",10340,"KRN","B",9.8,9.8)

"BLD",10340,"KRN","B",19,19)

"BLD",10340,"KRN","B",19.1,19.1)

"BLD",10340,"KRN","B",101,101)

"BLD",10340,"KRN","B",409.61,409.61)

"BLD",10340,"KRN","B",771,771)

"BLD",10340,"KRN","B",779.2,779.2)

"BLD",10340,"KRN","B",870,870)

"BLD",10340,"KRN","B",8989.51,8989.51)

"BLD",10340,"KRN","B",8989.52,8989.52)

"BLD",10340,"KRN","B",8994,8994)

"BLD",10340,"QDEF")
^^^^^^^^YES
"BLD",10340,"QUES",0)
^9.62^^
"BLD",10340,"REQB",0)
^9.611^3^3
"BLD",10340,"REQB",1,0)
SD*5.3*679^2
"BLD",10340,"REQB",2,0)
SD*5.3*701^2
"BLD",10340,"REQB",3,0)
SD*5.3*717^2
"BLD",10340,"REQB","B","SD*5.3*679",1)

"BLD",10340,"REQB","B","SD*5.3*701",2)

"BLD",10340,"REQB","B","SD*5.3*717",3)

"FIA",409.85)
SDEC APPT REQUEST
"FIA",409.85,0)
^SDEC(409.85,
"FIA",409.85,0,0)
409.85P
"FIA",409.85,0,1)
y^y^p^^^^n^^n
"FIA",409.85,0,10)

"FIA",409.85,0,11)

"FIA",409.85,0,"RLRO")

"FIA",409.85,0,"VR")
5.3^SD
"FIA",409.85,409.85)
1
"FIA",409.85,409.85,5)

"FIA",409.86)
SDEC CONTACT
"FIA",409.86,0)
^SDEC(409.86,
"FIA",409.86,0,0)
409.86P
"FIA",409.86,0,1)
y^y^f^^^^n
"FIA",409.86,0,10)

"FIA",409.86,0,11)

"FIA",409.86,0,"RLRO")

"FIA",409.86,0,"VR")
5.3^SD
"FIA",409.86,409.86)
0
"FIA",409.86,409.863)
0
"FIA",409.97)
SD Audit Statistics
"FIA",409.97,0)
^SDAUDIT(
"FIA",409.97,0,0)
409.97P
"FIA",409.97,0,1)
y^y^f^^^^n
"FIA",409.97,0,10)

"FIA",409.97,0,11)

"FIA",409.97,0,"RLRO")

"FIA",409.97,0,"VR")
5.3^SD
"FIA",409.97,409.97)
0
"INIT")
SD686PST
"IX",409.85,409.85,"GUID",0)
409.85^GUID^Stores pointer to Oracle database where VAOS appointment requests are stored.^R^^F^IR^I^409.85^^^^^LS
"IX",409.85,409.85,"GUID",.1,0)
^^5^5^3180420^
"IX",409.85,409.85,"GUID",.1,1,0)
The GUID is the database pointer in the Oracle database that stores VAOS 
"IX",409.85,409.85,"GUID",.1,2,0)
requests for appointments.  It is a 32 character value.  This 
"IX",409.85,409.85,"GUID",.1,3,0)
cross-reference is used to link the VAOS request to the Appointment 
"IX",409.85,409.85,"GUID",.1,4,0)
Request stored in VistA so that the VAOS database can be updated with 
"IX",409.85,409.85,"GUID",.1,5,0)
status changes when appointments are made or cancelled using VS GUI.
"IX",409.85,409.85,"GUID",1)
S ^SDEC(409.85,"GUID",$E(X,1,32),DA)=""
"IX",409.85,409.85,"GUID",2)
K ^SDEC(409.85,"GUID",$E(X,1,32),DA)
"IX",409.85,409.85,"GUID",2.5)
K ^SDEC(409.85,"GUID")
"IX",409.85,409.85,"GUID",11.1,0)
^.114IA^1^1
"IX",409.85,409.85,"GUID",11.1,1,0)
1^F^409.85^5^32^1^F
"IX",409.86,409.86,"AD",0)
409.86^AD^Date/user entered cross-reference^R^^R^IR^W^409.863^^^^^S
"IX",409.86,409.86,"AD",.1,0)
^^2^2^3180306^
"IX",409.86,409.86,"AD",.1,1,0)
Cross-reference by date/time entered and user entered.  Used by audit 
"IX",409.86,409.86,"AD",.1,2,0)
statistics compiler (SDECAUD).
"IX",409.86,409.86,"AD",1)
S ^SDEC(409.86,"AD",X(1),X(2),DA(1),DA)=""
"IX",409.86,409.86,"AD",2)
K ^SDEC(409.86,"AD",X(1),X(2),DA(1),DA)
"IX",409.86,409.86,"AD",2.5)
K ^SDEC(409.86,"AD")
"IX",409.86,409.86,"AD",11.1,0)
^.114IA^2^2
"IX",409.86,409.86,"AD",11.1,1,0)
1^F^409.863^6^^1^F
"IX",409.86,409.86,"AD",11.1,1,3)

"IX",409.86,409.86,"AD",11.1,2,0)
2^F^409.863^5^^2^F
"IX",409.86,409.86,"AD",11.1,2,3)

"IX",409.97,409.97,"D",0)
409.97^D^DATE AND SCHEDULER^R^^R^IR^I^409.97^^^^^LS
"IX",409.97,409.97,"D",.1,0)
^^1^1^3180222^
"IX",409.97,409.97,"D",.1,1,0)
Used to select records for printing on report by date.
"IX",409.97,409.97,"D",1)
S ^SDAUDIT("D",$E(X(1),1,7),$E(X(2),1,20),DA)=""
"IX",409.97,409.97,"D",2)
K ^SDAUDIT("D",$E(X(1),1,7),$E(X(2),1,20),DA)
"IX",409.97,409.97,"D",2.5)
K ^SDAUDIT("D")
"IX",409.97,409.97,"D",11.1,0)
^.114IA^2^2
"IX",409.97,409.97,"D",11.1,1,0)
1^F^409.97^1^7^1^F^DATE AND SCHEDULER
"IX",409.97,409.97,"D",11.1,2,0)
2^F^409.97^.01^20^2^F^SCHEDULER
"IX",409.97,409.97,"E",0)
409.97^E^SCHEDULER AND DATE^R^^R^IR^I^409.97^^^^^LS
"IX",409.97,409.97,"E",.1,0)
^^2^2^3180222^
"IX",409.97,409.97,"E",.1,1,0)
Used to select records for printing on report by scheduler for a date 
"IX",409.97,409.97,"E",.1,2,0)
range.
"IX",409.97,409.97,"E",1)
S ^SDAUDIT("E",$E(X(1),1,20),$E(X(2),1,7),DA)=""
"IX",409.97,409.97,"E",2)
K ^SDAUDIT("E",$E(X(1),1,20),$E(X(2),1,7),DA)
"IX",409.97,409.97,"E",2.5)
K ^SDAUDIT("E")
"IX",409.97,409.97,"E",11.1,0)
^.114IA^2^2
"IX",409.97,409.97,"E",11.1,1,0)
1^F^409.97^.01^20^1^F
"IX",409.97,409.97,"E",11.1,2,0)
2^F^409.97^1^7^2^F^DATE
"KRN",.4,1554,-1)
0^1
"KRN",.4,1554,0)
SDEC AUDIT DATE PRINT^3180312.0648^^409.97^^^3190619
"KRN",.4,1554,"DCL","409.97^10")
&
"KRN",.4,1554,"DCL","409.97^11")
&
"KRN",.4,1554,"DCL","409.97^12")
&
"KRN",.4,1554,"DCL","409.97^13")
&
"KRN",.4,1554,"DCL","409.97^14")
&
"KRN",.4,1554,"DCL","409.97^15")
&
"KRN",.4,1554,"DCL","409.97^2")
&
"KRN",.4,1554,"DCL","409.97^3")
&
"KRN",.4,1554,"DCL","409.97^4")
&
"KRN",.4,1554,"DCL","409.97^5")
&
"KRN",.4,1554,"DCL","409.97^6")
&
"KRN",.4,1554,"DCL","409.97^7")
&
"KRN",.4,1554,"DCL","409.97^8")
&
"KRN",.4,1554,"DCL","409.97^9")
&
"KRN",.4,1554,"F",1)
1~.01~S DIP(1)=$S($D(^SDAUDIT(D0,0)):^(0),1:"") S X=$P(DIP(1),U,1),X=X W X K DIP;"SchedulerIEN";Z;"INTERNAL(SCHEDULER)"~2~3~4~5~6~7~8~9~10~11~12~13~14~
"KRN",.4,1554,"F",2)
15~
"KRN",.4,1554,"H")
SD Audit Statistics STATISTICS
"KRN",.401,936,-1)
0^1
"KRN",.401,936,0)
SDEC AUDIT REPORT BY DATE^3180307.1024^^409.97^^^3190619
"KRN",.401,936,2,0)
^.4014^2^2
"KRN",.401,936,2,1,0)
409.97^1^DATE^^^^^^^1
"KRN",.401,936,2,1,"ASK")
1
"KRN",.401,936,2,1,"F")
3150100.999999^JAN 1,2015^JAN 1,2015
"KRN",.401,936,2,1,"GET")
S DISX(1)=$P($G(^SDAUDIT(D0,0)),U,2)
"KRN",.401,936,2,1,"IX")
^SDAUDIT("C",^SDAUDIT(^2
"KRN",.401,936,2,1,"QCON")
I (DISX(1)]]3150100.999999)&(DISX(1)']]3180411.24)
"KRN",.401,936,2,1,"T")
3180411.24^APR 11,2018@2400^APR 11,2018@24:00
"KRN",.401,936,2,1,"TXT")
DATE from JAN 1,2015 to APR 11,2018@24:00
"KRN",.401,936,2,2,0)
409.97^^SCHEDULER^".01^^^^^^4
"KRN",.401,936,2,2,"CM")
S Y(1)=$S($D(^SDAUDIT(D0,0)):^(0),1:"") S X=$P($G(^VA(200,+$P(Y(1),U,1),0)),U) I D0>0 S DISX(2)=X
"KRN",.401,936,2,2,"GET")
S Y(1)=$S($D(^SDAUDIT(D0,0)):^(0),1:"") S X=$P($G(^VA(200,+$P(Y(1),U,1),0)),U) I D0>0 S DISX(2)=X
"KRN",.401,936,2,2,"IX")
^SDAUDIT("B",^SDAUDIT(^2
"KRN",.401,936,2,2,"PTRIX")
^VA(200,"B",
"KRN",.401,936,2,2,"QCON")
I DISX(2)'=""
"KRN",.401,936,2,2,"TXT")
 SCHEDULER not null
"KRN",.401,936,2,"B",409.97,1)

"KRN",.401,936,2,"B",409.97,2)

"KRN",19,2202,-1)
2^5
"KRN",19,2202,0)
SDSUP^Supervisor Menu^^M^114^^^^^^^48^y
"KRN",19,2202,10,0)
^19.01IP^33^33
"KRN",19,2202,10,11,0)
11715
"KRN",19,2202,10,11,"^")
SDEC RELEASE LOCKS
"KRN",19,2202,"U")
SUPERVISOR MENU
"KRN",19,11630,-1)
0^1
"KRN",19,11630,0)
SDECRPC^CLINICAL SCHEDULING PROCEDURE CALLS^^B^^^^^^^^SCHEDULING^y
"KRN",19,11630,1,0)
^19.06^2^2^3190108^^^^
"KRN",19,11630,1,1,0)
This option hosts RPCs in the SDEC namespace.  CLINICAL SCHEDULING users 
"KRN",19,11630,1,2,0)
must have access to this option in order to use CLINICAL SCHEDULING.
"KRN",19,11630,99.1)
64281,43176
"KRN",19,11630,"RPC",0)
^19.05P^210^210
"KRN",19,11630,"RPC",1,0)
SDEC ACCGPTYG
"KRN",19,11630,"RPC",2,0)
SDEC ACCGROUP
"KRN",19,11630,"RPC",3,0)
SDEC ACCTYPE
"KRN",19,11630,"RPC",4,0)
SDEC ADDACCG
"KRN",19,11630,"RPC",5,0)
SDEC ADDACCTY
"KRN",19,11630,"RPC",6,0)
SDEC ADDAGI
"KRN",19,11630,"RPC",7,0)
SDEC ADDRES
"KRN",19,11630,"RPC",8,0)
SDEC ADDRESU
"KRN",19,11630,"RPC",9,0)
SDEC ADDRG
"KRN",19,11630,"RPC",10,0)
SDEC ADDRGI
"KRN",19,11630,"RPC",11,0)
SDEC APBLKALL
"KRN",19,11630,"RPC",12,0)
SDEC APBLKOV
"KRN",19,11630,"RPC",13,0)
SDEC APPADD
"KRN",19,11630,"RPC",14,0)
SDEC APPDEL
"KRN",19,11630,"RPC",15,0)
SDEC APPTEVLG
"KRN",19,11630,"RPC",16,0)
SDEC APPTLETR
"KRN",19,11630,"RPC",17,0)
SDEC APPTYPES
"KRN",19,11630,"RPC",18,0)
SDEC AVADD
"KRN",19,11630,"RPC",19,0)
SDEC AVDEL
"KRN",19,11630,"RPC",20,0)
SDEC AVDELDT
"KRN",19,11630,"RPC",21,0)
SDEC CANCKOUT
"KRN",19,11630,"RPC",22,0)
SDEC CANREAS
"KRN",19,11630,"RPC",23,0)
SDEC CHECKIN
"KRN",19,11630,"RPC",24,0)
SDEC CHECKOUT
"KRN",19,11630,"RPC",25,0)
SDEC CLINALL
"KRN",19,11630,"RPC",26,0)
SDEC CLINCAN
"KRN",19,11630,"RPC",27,0)
SDEC CLINDIS
"KRN",19,11630,"RPC",28,0)
SDEC CLINDISW
"KRN",19,11630,"RPC",29,0)
SDEC CLINLET
"KRN",19,11630,"RPC",30,0)
SDEC CLINLETW
"KRN",19,11630,"RPC",31,0)
SDEC CLINPROV
"KRN",19,11630,"RPC",32,0)
SDEC CLINSET
"KRN",19,11630,"RPC",33,0)
SDEC CLINSTOP
"KRN",19,11630,"RPC",34,0)
SDEC COPYAPPT
"KRN",19,11630,"RPC",35,0)
SDEC CPCANC
"KRN",19,11630,"RPC",36,0)
SDEC CPSTAT
"KRN",19,11630,"RPC",37,0)
SDEC CRSCHED
"KRN",19,11630,"RPC",38,0)
SDEC CSLOTSCH
"KRN",19,11630,"RPC",39,0)
SDEC CURFACG
"KRN",19,11630,"RPC",40,0)
SDEC CVARAPPT
"KRN",19,11630,"RPC",41,0)
SDEC DELAG
"KRN",19,11630,"RPC",42,0)
SDEC DELAGI
"KRN",19,11630,"RPC",43,0)
SDEC DELRESGP
"KRN",19,11630,"RPC",44,0)
SDEC DELRGI
"KRN",19,11630,"RPC",45,0)
SDEC DELRU
"KRN",19,11630,"RPC",46,0)
SDEC EDITAPPT
"KRN",19,11630,"RPC",47,0)
SDEC EHRPT
"KRN",19,11630,"RPC",48,0)
SDEC GETFAC
"KRN",19,11630,"RPC",49,0)
SDEC GETREGA
"KRN",19,11630,"RPC",50,0)
SDEC HLTHSUMM
"KRN",19,11630,"RPC",51,0)
SDEC HOLIDAY
"KRN",19,11630,"RPC",52,0)
SDEC HOSPLOC
"KRN",19,11630,"RPC",53,0)
SDEC IMHERE
"KRN",19,11630,"RPC",54,0)
SDEC NEWPERS
"KRN",19,11630,"RPC",55,0)
SDEC NOSHOPAT
"KRN",19,11630,"RPC",56,0)
SDEC NOSHOW
"KRN",19,11630,"RPC",57,0)
SDEC OVBOOK
"KRN",19,11630,"RPC",58,0)
SDEC PATAPPTD
"KRN",19,11630,"RPC",59,0)
SDEC PATAPPTH
"KRN",19,11630,"RPC",60,0)
SDEC PROVALL
"KRN",19,11630,"RPC",61,0)
SDEC PROVCLIN
"KRN",19,11630,"RPC",62,0)
SDEC PTLOOKRS
"KRN",19,11630,"RPC",63,0)
SDEC PWH
"KRN",19,11630,"RPC",64,0)
SDEC RAISEVNT
"KRN",19,11630,"RPC",65,0)
SDEC REBKCLIN
"KRN",19,11630,"RPC",66,0)
SDEC REBKLIST
"KRN",19,11630,"RPC",67,0)
SDEC REBKNEXT
"KRN",19,11630,"RPC",68,0)
SDEC REGEVENT
"KRN",19,11630,"RPC",69,0)
SDEC RESGPUSR
"KRN",19,11630,"RPC",70,0)
SDEC RESGRPUS
"KRN",19,11630,"RPC",71,0)
SDEC RESLETRF
"KRN",19,11630,"RPC",72,0)
SDEC RESLETRS
"KRN",19,11630,"RPC",73,0)
SDEC RESOURCE
"KRN",19,11630,"RPC",74,0)
SDEC RESUSER
"KRN",19,11630,"RPC",75,0)
SDEC SCHUSR
"KRN",19,11630,"RPC",76,0)
SDEC SEARCHAV
"KRN",19,11630,"RPC",77,0)
SDEC SETFAC
"KRN",19,11630,"RPC",78,0)
SDEC SETRBOOK
"KRN",19,11630,"RPC",79,0)
SDEC SPACEBAR
"KRN",19,11630,"RPC",80,0)
SDEC SUSRINFO
"KRN",19,11630,"RPC",81,0)
SDEC SVSPALL
"KRN",19,11630,"RPC",82,0)
SDEC SYSSTAT
"KRN",19,11630,"RPC",83,0)
SDEC TPBLKOV
"KRN",19,11630,"RPC",84,0)
SDEC UNDOCANA
"KRN",19,11630,"RPC",85,0)
SDEC UNREGEV
"KRN",19,11630,"RPC",86,0)
SDEC WAITLIST
"KRN",19,11630,"RPC",87,0)
SDEC WLCLOSE
"KRN",19,11630,"RPC",88,0)
SDEC WLGET
"KRN",19,11630,"RPC",89,0)
SDEC WLSET
"KRN",19,11630,"RPC",90,0)
SDEC PREFGET
"KRN",19,11630,"RPC",91,0)
SDEC PREFGETV
"KRN",19,11630,"RPC",92,0)
SDEC PREFSET
"KRN",19,11630,"RPC",93,0)
SDEC FAPPTGET
"KRN",19,11630,"RPC",94,0)
SDEC RECAPGET
"KRN",19,11630,"RPC",95,0)
SDEC RECDSET
"KRN",19,11630,"RPC",96,0)
SDEC RECGET
"KRN",19,11630,"RPC",97,0)
SDEC RECPRGET
"KRN",19,11630,"RPC",98,0)
SDEC RECSET
"KRN",19,11630,"RPC",99,0)
SDEC REQGET
"KRN",19,11630,"RPC",100,0)
SDEC PCSTGET
"KRN",19,11630,"RPC",101,0)
SDEC PCST2GET
"KRN",19,11630,"RPC",102,0)
SDEC PCSGET
"KRN",19,11630,"RPC",103,0)
SDEC PTSET
"KRN",19,11630,"RPC",104,0)
SDEC PTINQ
"KRN",19,11630,"RPC",105,0)
SDEC SUMMGET
"KRN",19,11630,"RPC",106,0)
SDEC SUMMAGET
"KRN",19,11630,"RPC",107,0)
SDEC APPIDGET
"KRN",19,11630,"RPC",108,0)
SDEC FACLIST
"KRN",19,11630,"RPC",109,0)
SDEC CGET
"KRN",19,11630,"RPC",110,0)
SDEC ETHGET
"KRN",19,11630,"RPC",111,0)
SDEC ETHCMGET
"KRN",19,11630,"RPC",112,0)
SDEC RACEGET
"KRN",19,11630,"RPC",113,0)
SDEC REP1GET
"KRN",19,11630,"RPC",114,0)
SDEC WLPCSET
"KRN",19,11630,"RPC",115,0)
SDEC APPSDGET
"KRN",19,11630,"RPC",116,0)
SDEC WLOPEN
"KRN",19,11630,"RPC",117,0)
SDEC ARCLOSE
"KRN",19,11630,"RPC",118,0)
SDEC ARDGET
"KRN",19,11630,"RPC",119,0)
SDEC ARGET
"KRN",19,11630,"RPC",120,0)
SDEC ARMRTGET
"KRN",19,11630,"RPC",121,0)
SDEC ARMRTSET
"KRN",19,11630,"RPC",122,0)
SDEC AROPEN
"KRN",19,11630,"RPC",123,0)
SDEC ARPCSET
"KRN",19,11630,"RPC",124,0)
SDEC ARSET
"KRN",19,11630,"RPC",125,0)
SDEC HIDE
"KRN",19,11630,"RPC",126,0)
SDEC PRIV
"KRN",19,11630,"RPC",127,0)
SDEC WLHIDE
"KRN",19,11630,"RPC",128,0)
SDECAR ARAPPT
"KRN",19,11630,"RPC",129,0)
SDECAR ARMRTC
"KRN",19,11630,"RPC",130,0)
SDECDEV DEVICE
"KRN",19,11630,"RPC",131,0)
SDECDIS DISABIL
"KRN",19,11630,"RPC",132,0)
SDECIDX GETREC
"KRN",19,11630,"RPC",133,0)
SDECIDX RECCNT
"KRN",19,11630,"RPC",134,0)
SDECLK LOCK
"KRN",19,11630,"RPC",135,0)
SDECLK UNLOCK
"KRN",19,11630,"RPC",136,0)
SDECLOC PRIVLOC
"KRN",19,11630,"RPC",137,0)
SDECLOC UPDPRIV
"KRN",19,11630,"RPC",138,0)
SDECRMG RECCNT
"KRN",19,11630,"RPC",139,0)
SDECRMG RMG
"KRN",19,11630,"RPC",140,0)
SDECRMG2 URGENCY
"KRN",19,11630,"RPC",141,0)
DG SENSITIVE RECORD ACCESS
"KRN",19,11630,"RPC",142,0)
DG CHK BS5 XREF ARRAY
"KRN",19,11630,"RPC",143,0)
ORPRF HASFLG
"KRN",19,11630,"RPC",144,0)
ORPRF GETFLG
"KRN",19,11630,"RPC",145,0)
ORWPT DIEDON
"KRN",19,11630,"RPC",146,0)
ORWPT ID INFO
"KRN",19,11630,"RPC",147,0)
ORWPT LAST5
"KRN",19,11630,"RPC",148,0)
ORWPT LAST5 RPL
"KRN",19,11630,"RPC",149,0)
ORWU USERINFO
"KRN",19,11630,"RPC",150,0)
SD VSE FILTER RPC
"KRN",19,11630,"RPC",151,0)
SD VSE REPORT RPC
"KRN",19,11630,"RPC",152,0)
SDEC APPSLOTS
"KRN",19,11630,"RPC",154,0)
SDEC NETLOC
"KRN",19,11630,"RPC",155,0)
SDEC NOAVAIL
"KRN",19,11630,"RPC",156,0)
SDECAPP GETYPE
"KRN",19,11630,"RPC",157,0)
SDECAR ARMULT
"KRN",19,11630,"RPC",158,0)
SDECAR AUDITGET
"KRN",19,11630,"RPC",159,0)
SDECCAP CAN
"KRN",19,11630,"RPC",160,0)
SDECCAP GET
"KRN",19,11630,"RPC",161,0)
SDECCAP SET
"KRN",19,11630,"RPC",162,0)
SDECWL AUDITGET
"KRN",19,11630,"RPC",163,0)
ROR LIST STATES
"KRN",19,11630,"RPC",164,0)
XUS SIGNON SETUP
"KRN",19,11630,"RPC",165,0)
XUS GET VISITOR
"KRN",19,11630,"RPC",166,0)
XUS SET VISITOR
"KRN",19,11630,"RPC",167,0)
XUS AV CODE
"KRN",19,11630,"RPC",168,0)
SDEC01 CLINICS
"KRN",19,11630,"RPC",169,0)
SDEC57 OBM
"KRN",19,11630,"RPC",170,0)
SDECAR3 AREDIT
"KRN",19,11630,"RPC",171,0)
SDECDEM MARITAL
"KRN",19,11630,"RPC",172,0)
SDECDEM RELIGION
"KRN",19,11630,"RPC",173,0)
SDECDEM ZIPLINK
"KRN",19,11630,"RPC",174,0)
SDECDEV DEV
"KRN",19,11630,"RPC",175,0)
SDECDEV PRINT
"KRN",19,11630,"RPC",176,0)
SDECRMGP GETRMGUP
"KRN",19,11630,"RPC",177,0)
SDECRMGP PUTRMGUP
"KRN",19,11630,"RPC",178,0)
SDECU4 GETFONT
"KRN",19,11630,"RPC",179,0)
SDECU4 PUTFONT
"KRN",19,11630,"RPC",180,0)
ORWU CLINLOC
"KRN",19,11630,"RPC",181,0)
XUS GET USER INFO
"KRN",19,11630,"RPC",182,0)
XUS GET CCOW TOKEN
"KRN",19,11630,"RPC",183,0)
ORWPT SHARE
"KRN",19,11630,"RPC",184,0)
ORWPT TOP
"KRN",19,11630,"RPC",185,0)
DG SENSITIVE RECORD BULLETIN
"KRN",19,11630,"RPC",186,0)
SDEC EP CLASSIFICATION
"KRN",19,11630,"RPC",187,0)
SDEC EP CPT
"KRN",19,11630,"RPC",188,0)
SDEC EP DEMOGRAPHICS
"KRN",19,11630,"RPC",189,0)
SDEC EP DIAGNOSIS
"KRN",19,11630,"RPC",190,0)
SDEC EP EVENT LOG
"KRN",19,11630,"RPC",191,0)
SDEC EP PROVIDER
"KRN",19,11630,"RPC",192,0)
SDEC EP PT INFO
"KRN",19,11630,"RPC",193,0)
SDEC EP STOP CODE
"KRN",19,11630,"RPC",194,0)
SDEC EP WAIT TIME
"KRN",19,11630,"RPC",195,0)
SDEC APPT STATUS
"KRN",19,11630,"RPC",196,0)
SDEC ELIGIBILITY
"KRN",19,11630,"RPC",197,0)
SDEC CONTACT DISPLAY
"KRN",19,11630,"RPC",198,0)
SDEC CONTACT MULTI-DISPLAY
"KRN",19,11630,"RPC",199,0)
SDEC CONTACT NEW
"KRN",19,11630,"RPC",200,0)
SDEC CONTACT SEQUENCE
"KRN",19,11630,"RPC",201,0)
SDEC CONTACT STOP CODE
"KRN",19,11630,"RPC",202,0)
SDEC CONTACT UPDATE
"KRN",19,11630,"RPC",203,0)
SDEC GETPRER
"KRN",19,11630,"RPC",204,0)
SDEC ELIG RETURN
"KRN",19,11630,"RPC",205,0)
SDEC BOOKHLDY
"KRN",19,11630,"RPC",206,0)
SDECAR1 ARGUID
"KRN",19,11630,"RPC",207,0)
SDECSTNG HELPLINK
"KRN",19,11630,"RPC",208,0)
XWB GET VARIABLE VALUE
"KRN",19,11630,"RPC",209,0)
SDEC RESCE
"KRN",19,11630,"RPC",210,0)
SDEC SUMMGET2
"KRN",19,11630,"U")
CLINICAL SCHEDULING PROCEDURE 
"KRN",19,11713,-1)
0^2
"KRN",19,11713,0)
SDEC AUDIT REPORT JOB^Compile yesterday's audit report^^R^^^^^^^n^SCHEDULING
"KRN",19,11713,2)
y
"KRN",19,11713,25)
BKGND^SDECAUD
"KRN",19,11713,200.9)
y
"KRN",19,11713,"U")
COMPILE YESTERDAY'S AUDIT REPO
"KRN",19,11714,-1)
0^3
"KRN",19,11714,0)
SDEC COMPILE AUDIT REPORT^Compile audit report for a selected date^^R^^SDECZMGR^^^^^^SCHEDULING
"KRN",19,11714,25)
SELECT^SDECAUD
"KRN",19,11714,99.1)
64714,42555
"KRN",19,11714,200.9)
n
"KRN",19,11714,"U")
COMPILE AUDIT REPORT FOR A SEL
"KRN",19,11715,-1)
0^4
"KRN",19,11715,0)
SDEC RELEASE LOCKS^Release Appointment Request Locks^^R^^^^^^^^SCHEDULING^^
"KRN",19,11715,1,0)
^^2^2^3180321^
"KRN",19,11715,1,1,0)
This option allows the user to release all appointment request locks held 
"KRN",19,11715,1,2,0)
by a selected user.
"KRN",19,11715,20)

"KRN",19,11715,25)
UNLKALL^SDECLK
"KRN",19,11715,"U")
RELEASE APPOINTMENT REQUEST LO
"KRN",19,11723,-1)
0^6
"KRN",19,11723,0)
SDEC PRINT AUDIT REPORT^Print VistA Scheduling Audit Report^^P^^^^^^^y^SCHEDULING
"KRN",19,11723,1,0)
^19.06^1^1^3190619^^
"KRN",19,11723,1,1,0)
Prints compiled audit report for VistA Scheduling.
"KRN",19,11723,60)
SDAUDIT(
"KRN",19,11723,62)
0
"KRN",19,11723,63)
[SDEC AUDIT DATE PRINT]
"KRN",19,11723,64)
[SDEC AUDIT REPORT BY DATE]
"KRN",19,11723,65)

"KRN",19,11723,66)

"KRN",19,11723,"U")
PRINT VISTA SCHEDULING AUDIT R
"KRN",8994,3559,-1)
0^3
"KRN",8994,3559,0)
SDEC ARSET^ARSET^SDEC^1^R^0^^0
"KRN",8994,3559,1,0)
^8994.01^1^1^3190117^^^^
"KRN",8994,3559,1,1,0)
Appointment Request Set
"KRN",8994,3559,2,0)
^8994.02A^1^1
"KRN",8994,3559,2,1,0)
INP^2^^1^1
"KRN",8994,3559,2,1,1,0)
^^69^69^3190117^
"KRN",8994,3559,2,1,1,1,0)
  ;  INP(1)  = (integer)  Wait List IEN point to
"KRN",8994,3559,2,1,1,2,0)
  ;                       SDEC APPT REQUEST file 409.85.
"KRN",8994,3559,2,1,1,3,0)
  ;                       If null, a new entry will be added
"KRN",8994,3559,2,1,1,4,0)
  ;  INP(2)  = (text)     DFN Pointer to the PATIENT file 2
"KRN",8994,3559,2,1,1,5,0)
  ;  INP(3)  = (date)     Originating Date/time in external date form
"KRN",8994,3559,2,1,1,6,0)
  ;  INP(4)  = (text)     Institution name NAME field from the 
"KRN",8994,3559,2,1,1,7,0)
INSTITUTION file
"KRN",8994,3559,2,1,1,8,0)
  ;  INP(5)  = (text)     Request Type
"KRN",8994,3559,2,1,1,9,0)
  ;  INP(6)  = (text)     REQ Specific Clinic name - NAME field in file 44
"KRN",8994,3559,2,1,1,10,0)
  ;  INP(7)  = (text)     Originating User name  - NAME field in NEW 
"KRN",8994,3559,2,1,1,11,0)
PERSON file 200
"KRN",8994,3559,2,1,1,12,0)
  ;  INP(8)  = (text)     Priority - 'ASAP' or 'FUTURE'
"KRN",8994,3559,2,1,1,13,0)
  ;  INP(9)  = (text)     Request By - 'PROVIDER' or 'PATIENT'
"KRN",8994,3559,2,1,1,14,0)
  ;  INP(10) = (text)     Provider name  - NAME field in NEW PERSON file 
"KRN",8994,3559,2,1,1,15,0)
200
"KRN",8994,3559,2,1,1,16,0)
  ;  INP(11) = (date)     Desired Date of appointment in external format.
"KRN",8994,3559,2,1,1,17,0)
  ;  INP(12) = (text)     comment - maximum of 24K characters.  Note: 
"KRN",8994,3559,2,1,1,18,0)
lines are to separated by carriage return (ASCII 13).
"KRN",8994,3559,2,1,1,19,0)
  ;  INP(13) = (text)     ENROLLMENT PRIORITY - Valid Values are:
"KRN",8994,3559,2,1,1,20,0)
  ;                                             GROUP 1
"KRN",8994,3559,2,1,1,21,0)
  ;                                             GROUP 2
"KRN",8994,3559,2,1,1,22,0)
  ;                                             GROUP 3
"KRN",8994,3559,2,1,1,23,0)
  ;                                             GROUP 4
"KRN",8994,3559,2,1,1,24,0)
  ;                                             GROUP 5
"KRN",8994,3559,2,1,1,25,0)
  ;                                             GROUP 6
"KRN",8994,3559,2,1,1,26,0)
  ;                                             GROUP 7
"KRN",8994,3559,2,1,1,27,0)
  ;                                             GROUP 8
"KRN",8994,3559,2,1,1,28,0)
  ;  INP(14) = (text)     MULTIPLE APPOINTMENT RTC      NO; YES
"KRN",8994,3559,2,1,1,29,0)
  ;  INP(15) = (integer)  MULT APPT RTC INTERVAL integer between 1-365
"KRN",8994,3559,2,1,1,30,0)
  ;  INP(16) = (integer)  MULT APPT NUMBER integer between 1-100
"KRN",8994,3559,2,1,1,31,0)
  ;  INP(17) = Patient Contacts separated by ::
"KRN",8994,3559,2,1,1,32,0)
  ;            Each :: piece has the following ~~ pieces:
"KRN",8994,3559,2,1,1,33,0)
  ;            1) = (date)    DATE ENTERED external date/time
"KRN",8994,3559,2,1,1,34,0)
  ;            2) = (text)    PC ENTERED BY USER ID or NAME - Pointer to 
"KRN",8994,3559,2,1,1,35,0)
  ;                           NEW PERSON file or NAME
"KRN",8994,3559,2,1,1,36,0)
  ;            4) = (text)    ACTION - 'Called' or 'Message Left'
"KRN",8994,3559,2,1,1,37,0)
  ;            5) = (optional) PATIENT PHONE Free-Text 4-20 characters
"KRN",8994,3559,2,1,1,38,0)
  ;  INP(18) = (optional) SERVICE CONNECTED PRIORITY valid values are NO  
"KRN",8994,3559,2,1,1,39,0)
YES
"KRN",8994,3559,2,1,1,40,0)
  ;  INP(19) = (optional) SERVICE CONNECTED PERCENTAGE = numeric 0-100
"KRN",8994,3559,2,1,1,41,0)
  ;  INP(20) = (optional) MRTC calculated preferred dates separated by 
"KRN",8994,3559,2,1,1,42,0)
pipe |:
"KRN",8994,3559,2,1,1,43,0)
  ;                       Each date can be in external format with no 
"KRN",8994,3559,2,1,1,44,0)
time.
"KRN",8994,3559,2,1,1,45,0)
 ;  INP(21) = (optional) CLINIC STOP pointer to CLINIC STOP file 40.7
"KRN",8994,3559,2,1,1,46,0)
 ;                       used to populate the REQ SERVICE/SPECIALTY field 
"KRN",8994,3559,2,1,1,47,0)
in 409.85
"KRN",8994,3559,2,1,1,48,0)
 ;  INP(22) = (optional) Appointment Type ID pointer to APPOINTMENT TYPE 
"KRN",8994,3559,2,1,1,49,0)
file 409.1
"KRN",8994,3559,2,1,1,50,0)
 ;  INP(23) = (optional) Patient Status
"KRN",8994,3559,2,1,1,51,0)
 ;                          N = NEW
"KRN",8994,3559,2,1,1,52,0)
 ;                          E = ESTABLISHED
"KRN",8994,3559,2,1,1,53,0)
 ;  INP(24) = (optional) MULT APPTS MADE
"KRN",8994,3559,2,1,1,54,0)
 ;                    list of child pointers to SDEC APPOINTMENT and/or 
"KRN",8994,3559,2,1,1,55,0)
SDEC APPT REQUEST files separated by pipe
"KRN",8994,3559,2,1,1,56,0)
 ;                    each pipe piece contains the following ~ pieces:
"KRN",8994,3559,2,1,1,57,0)
 ;                1. Appointment Id pointer to SDEC APPOINTMENT file 
"KRN",8994,3559,2,1,1,58,0)
409.84
"KRN",8994,3559,2,1,1,59,0)
 ;                2. Request Id pointer to SDEC APPT REQUEST file 409.85
"KRN",8994,3559,2,1,1,60,0)
 ;  INP(25) = (optional) PARENT REQUEST pointer to SDEC APPT REQUEST file 
"KRN",8994,3559,2,1,1,61,0)
409.85
"KRN",8994,3559,2,1,1,62,0)
 ;  INP(26) = (optional) NLT (No later than) [CPRS RTC REQUIREMENT]
"KRN",8994,3559,2,1,1,63,0)
 ;  INP(27) = (optional) PREREQ (Prerequisites) [CPRS RTC REQUIREMENT]
"KRN",8994,3559,2,1,1,64,0)
 ;  INP(28) = (optional) ORDER IEN [CPRS RTC REQUIREMENT]
"KRN",8994,3559,2,1,1,65,0)
 ;  INP(29) = (optional) VAOS GUID  <== wtc patch 686 3/21/18 added for 
"KRN",8994,3559,2,1,1,66,0)
VAOS requests
"KRN",8994,3559,2,1,1,67,0)
 ;  INP(30) = (optional) source of the call.  See Scheduling Events 
"KRN",8994,3559,2,1,1,68,0)
(#409.94), field 1 for list of values.  Default is "GUI".
"KRN",8994,3559,2,1,1,69,0)
 ; 
"KRN",8994,3559,2,"B","INP",1)

"KRN",8994,3559,2,"PARAMSEQ",1,1)

"KRN",8994,3559,3,0)
^8994.03^2^2^3190117^^^^
"KRN",8994,3559,3,1,0)
Return a single entry in the Global Array with the fields ERRORID and 
"KRN",8994,3559,3,2,0)
ERRORTEXT.
"KRN",8994,3562,-1)
0^4
"KRN",8994,3562,0)
SDEC ARGET^ARGET^SDEC^4^R^0^^0
"KRN",8994,3562,1,0)
^^1^1^3190117^
"KRN",8994,3562,1,1,0)
Appointment Request GET
"KRN",8994,3562,2,0)
^8994.02A^6^6
"KRN",8994,3562,2,1,0)
ARIEN1^1^^0^1
"KRN",8994,3562,2,1,1,0)
^^1^1^3150420^
"KRN",8994,3562,2,1,1,1,0)
Appt Request ID pointer to the SDEC APPT REQUEST fiel 409.85.
"KRN",8994,3562,2,2,0)
MAXREC^1^^0^2
"KRN",8994,3562,2,2,1,0)
^^1^1^3150420^
"KRN",8994,3562,2,2,1,1,0)
Max records returned.
"KRN",8994,3562,2,3,0)
SDBEG^1^^0^3
"KRN",8994,3562,2,3,1,0)
^^1^1^3150420^
"KRN",8994,3562,2,3,1,1,0)
Begin Date in external format.
"KRN",8994,3562,2,4,0)
SDEND^1^^0^4
"KRN",8994,3562,2,4,1,0)
^^1^1^3150420^
"KRN",8994,3562,2,4,1,1,0)
End date in external format.
"KRN",8994,3562,2,5,0)
DFN^1^^0^5
"KRN",8994,3562,2,5,1,0)
^^1^1^3150420^
"KRN",8994,3562,2,5,1,1,0)
Patient ID pointer to PATIENT file 2.
"KRN",8994,3562,2,6,0)
LASTSUB^1^^0^6
"KRN",8994,3562,2,6,1,0)
^8994.021^1^1^3190117^^^^
"KRN",8994,3562,2,6,1,1,0)
Last subscript from previous call.
"KRN",8994,3562,2,"B","ARIEN1",1)

"KRN",8994,3562,2,"B","DFN",5)

"KRN",8994,3562,2,"B","LASTSUB",6)

"KRN",8994,3562,2,"B","MAXREC",2)

"KRN",8994,3562,2,"B","SDBEG",3)

"KRN",8994,3562,2,"B","SDEND",4)

"KRN",8994,3562,2,"PARAMSEQ",1,1)

"KRN",8994,3562,2,"PARAMSEQ",2,2)

"KRN",8994,3562,2,"PARAMSEQ",3,3)

"KRN",8994,3562,2,"PARAMSEQ",4,4)

"KRN",8994,3562,2,"PARAMSEQ",5,5)

"KRN",8994,3562,2,"PARAMSEQ",6,6)

"KRN",8994,3562,3,0)
^^108^108^3190117^
"KRN",8994,3562,3,1,0)
 DFN [1] ^ PATIENT NAME [2] ^ <not used> [3] ^ DOB [4] ^ SSN [5] ^ GENDER 
"KRN",8994,3562,3,2,0)
[6]
"KRN",8994,3562,3,3,0)
 ^ WAIT LIST IEN [7] ^ ORIGINATING DATE [8] ^ INSTITUTION IEN [9]
"KRN",8994,3562,3,4,0)
 ^ INSTITUTION NAME [10] ^ APP TYPE [11] ^ SPECIFIC CLINIC IEN [12]
"KRN",8994,3562,3,5,0)
 ^ SPECIFIC CLINIC NAME [13] ^ ORIGINATING USER IEN [14]
"KRN",8994,3562,3,6,0)
 ^ ORIGINATING USER NAME [15] ^ PRIORITY [16] ^ REQUEST BY [17]\
"KRN",8994,3562,3,7,0)
 ^ PROVIDER IEN [18] ^ PROVIDER NAME [19] ^ DESIRED DATE OF APPOINTMENT 
"KRN",8994,3562,3,8,0)
[20]
"KRN",8994,3562,3,9,0)
 ^ COMMENTS [21] Note: Lines are separated by carriage return (ASCII 13)
"KRN",8994,3562,3,10,0)
^ ENROLLMENT PRIORITY [22] ^ MULTIPLE APPOINTMENT RTC 0=NO; 1=YES [23]
"KRN",8994,3562,3,11,0)
 ^ MULT APPT RTC INTERVAL-Integer between 1-365 [24]
"KRN",8994,3562,3,12,0)
 ^ MULT APPT NUMBER-Integer between 1-100 [25] ^ PRIGRP [26] ^ ELIGIEN 
"KRN",8994,3562,3,13,0)
[27] ^
"KRN",8994,3562,3,14,0)
 ^ELIGNAME [28] ^ SVCCONN [29] ^ SVCCONNP[30] ^ TYPEIEN [31] ^ TYPENAME 
"KRN",8994,3562,3,15,0)
[32]
"KRN",8994,3562,3,16,0)
 ^ PCONTACT [33] ^ ARDISPD [34] ^ ARDISPU [35] ^ ARDISPUN [36] ^ ARSVCCON 
"KRN",8994,3562,3,17,0)
[37]
"KRN",8994,3562,3,18,0)
 ^ PADDRES1 [38] ^ PADDRES2 [39] ^ PADDRES3 [40] ^ PCITY [41] ^ PSTATE 
"KRN",8994,3562,3,19,0)
[42]
"KRN",8994,3562,3,20,0)
 ^ PCOUNTRY [43] ^ PZIP4 [44] ^ GAF [45] ^ DATE/TIME ENTERED [46]
"KRN",8994,3562,3,21,0)
 ^ MTRCDATES [47] ^ SENSITIVE [48] ^^^^^^^ LASTSUB [56] ^ STOPIEN [57]
"KRN",8994,3562,3,22,0)
 ^ STOPNAME [58] ^ APPT_SCHED_DATE [59] ^ MRTCCOUNT [60] ^ PTPHONE [61]
"KRN",8994,3562,3,23,0)
 ^ APPTYPE [62] ^ EESTAT [63] ^ PRHBLOC [64] ^ APPTPTRS [65] ^ CHILDREN 
"KRN",8994,3562,3,24,0)
[66]
"KRN",8994,3562,3,25,0)
 ^ SDPARENT [67] 
"KRN",8994,3562,3,26,0)
 68 HRN = health record number 
"KRN",8994,3562,3,27,0)
 69 BADADD = BAD ADDRESS INDICATOR (.121) 
"KRN",8994,3562,3,28,0)
             1=UNDELIVERABLE 
"KRN",8994,3562,3,29,0)
             2=HOMELESS 
"KRN",8994,3562,3,30,0)
             3=OTHER 
"KRN",8994,3562,3,31,0)
             4=ADDRESS NOT FOUND 
"KRN",8994,3562,3,32,0)
 70 OPHONE = Office phone (.132) 
"KRN",8994,3562,3,33,0)
 71 NOK - Primary Next of Kin (.211) 
"KRN",8994,3562,3,34,0)
 72 KNAME - Primary Next of Kin name 
"KRN",8994,3562,3,35,0)
 73 KREL - Primary Next of Kin Relationship to Patient (.212) 
"KRN",8994,3562,3,36,0)
 74 KPHONE - Primary Next of Kin Phone (.219) 
"KRN",8994,3562,3,37,0)
 75 KSTREET - Primary Next of Kin Street Address [Line 1] (.213) 
"KRN",8994,3562,3,38,0)
 76 KSTREET2 - Primary Next of Kin Street Address [Line 2] (.214) 
"KRN",8994,3562,3,39,0)
 77 KSTREET3 - Primary Next of Kin Street Address [Line 3] (.215) 
"KRN",8994,3562,3,40,0)
 78 KCITY - Primary Next of Kin City (.216) 
"KRN",8994,3562,3,41,0)
 79 KSTATE - Primary Next of Kin State (.217) 
"KRN",8994,3562,3,42,0)
 80 KZIP - Primary Next of Kin Zip (.218) 
"KRN",8994,3562,3,43,0)
 81 NOK2 - Secondary Next of Kin (.2191) 
"KRN",8994,3562,3,44,0)
 82 K2NAME - Secondary Next of Kin name (.2191) 
"KRN",8994,3562,3,45,0)
 83 K2REL - Secondary Next of Kin Relationship to Patient (.2192) 
"KRN",8994,3562,3,46,0)
 84 K2PHONE - Secondary Next of Kin Phone (.2199) 
"KRN",8994,3562,3,47,0)
 85 K2STREET - Secondary Next of Kin Street Address [Line 1] (.2193) 
"KRN",8994,3562,3,48,0)
 86 K2STREET2 - Secondary Next of Kin Street Address [Line 2] (.2194) 
"KRN",8994,3562,3,49,0)
 87 K2STREET3 - Secondary Next of Kin Street Address [Line 3] (.2195) 
"KRN",8994,3562,3,50,0)
 88 K2CITY - Secondary Next of Kin City (.2196) 
"KRN",8994,3562,3,51,0)
 89 K2STATE - Secondary Next of Kin State (.2197) 
"KRN",8994,3562,3,52,0)
 90 K2ZIP - Secondary Next of Kin Zip (.2198) 
"KRN",8994,3562,3,53,0)
 91 PCOUNTY - Patient County (.117) 
"KRN",8994,3562,3,54,0)
 92 PETH - List of Patient Ethnicities/Names Eth|Name^... Use ETH^SDECU2 
"KRN",8994,3562,3,55,0)
 93 PRACE - List of Patient Races/Names RACE|NAME^... Use RACELST^SDECU2 
"KRN",8994,3562,3,56,0)
 94 PMARITAL - Patient Marital Status 
"KRN",8994,3562,3,57,0)
 95 PRELIGION - Patient Religious Preference 
"KRN",8994,3562,3,58,0)
 96 PTACTIVE - Patient Temporary Address Active? (.12105) 
"KRN",8994,3562,3,59,0)
 97 PTADDRESS1 - Patient Temporary Address Line 1 (.1211) 
"KRN",8994,3562,3,60,0)
 98 PTADDRESS2 - Patient Temporary Address Line 2 (.1212) 
"KRN",8994,3562,3,61,0)
 99 PTADDRESS3 - Patient Temporary Address Line 3 (.1213) 
"KRN",8994,3562,3,62,0)
 100 PTCITY - Patient Temporary City (.1214) 
"KRN",8994,3562,3,63,0)
 101 PTSTATE - Patient Temporary State (.1215) 
"KRN",8994,3562,3,64,0)
 102 PTZIP - Patient Temporary Zip (.1216) 
"KRN",8994,3562,3,65,0)
 103 PTZIP+4 - Patient Temporary Zip+4 (.12112) 
"KRN",8994,3562,3,66,0)
 104 PTCOUNTRY - Patient Temporary Country (.1223) 
"KRN",8994,3562,3,67,0)
 105 PTCOUNTY - Patient Temporary County (.12111) 
"KRN",8994,3562,3,68,0)
 106 PTMPPHONE - Patient Temporary Phone (.1219) 
"KRN",8994,3562,3,69,0)
 107 PTSTART - Patient Temporary Address Start Date (.1217) 
"KRN",8994,3562,3,70,0)
 108 PTEND - Patient Temporary Address End Date (.1218) 
"KRN",8994,3562,3,71,0)
 109 PCELL - Patient Cell Phone (.134) 
"KRN",8994,3562,3,72,0)
 110 PPAGER - Patient Pager Number (.135) 
"KRN",8994,3562,3,73,0)
 111 PEMAIL - Patient Email Address (.133) 
"KRN",8994,3562,3,74,0)
 112 PF_FFF - Patient FUGITIVE FELON FLAG 1=YES 
"KRN",8994,3562,3,75,0)
 113 PF_VCD - Patient VETERAN CATASTROPHICALLY DISABLED? Y=YES N=NO 
"KRN",8994,3562,3,76,0)
 114 PFNATIONAL - Patient national Flags 
"KRN",8994,3562,3,77,0)
                          (PRF ASSIGNMENT/PRF NATIONAL FLAG) separated by 
"KRN",8994,3562,3,78,0)
| 
"KRN",8994,3562,3,79,0)
         Each | piece contains the following ;; pieces: 
"KRN",8994,3562,3,80,0)
         1. PRFAID - PRF Assignment ID pointer to PRF ASSIGNMENT file 
"KRN",8994,3562,3,81,0)
(#26.13) 
"KRN",8994,3562,3,82,0)
         2. PRFSTAT - PRF Assignment Status 0=INACTIVE 1=ACTIVE 
"KRN",8994,3562,3,83,0)
         3. PRFNID - PRF National Flag ID pointer to PRF NATIONAL FLAG 
"KRN",8994,3562,3,84,0)
file (#26.15) 
"KRN",8994,3562,3,85,0)
         4. PRFNNAME - PRF National Flag name 
"KRN",8994,3562,3,86,0)
         5. PRFNSTAT - PRF National Flag status 0=INACTIVE 1=ACTIVE 
"KRN",8994,3562,3,87,0)
  115 PFLOCAL - Patient Local Flags 
"KRN",8994,3562,3,88,0)
                       (PRF ASSIGNMENT/PRF Local FLAG) separated by | 
"KRN",8994,3562,3,89,0)
         Each | piece contains the following ;; pieces: 
"KRN",8994,3562,3,90,0)
         1. PRFAID - PRF Assignment ID pointer to PRF ASSIGNMENT file 
"KRN",8994,3562,3,91,0)
(#26.13) 
"KRN",8994,3562,3,92,0)
         2. PRFSTAT - PRF Assignment Status 0=INACTIVE 1=ACTIVE 
"KRN",8994,3562,3,93,0)
         3. PRFLID - PRF Local Flag ID pointer to PRF LOCAL FLAG file 
"KRN",8994,3562,3,94,0)
(#26.11) 
"KRN",8994,3562,3,95,0)
         4. PRFLNAME - PRF Local Flag name 
"KRN",8994,3562,3,96,0)
         5. PRFLSTAT - PRF Local Flag status 0=INACTIVE 1=ACTIVE 
"KRN",8994,3562,3,97,0)
  116 SUBGRP - value from the ENROLLMENT SUBGROUP field of the PATIENT 
"KRN",8994,3562,3,98,0)
ENROLLMENT file 
"KRN",8994,3562,3,99,0)
               (#27.11) 
"KRN",8994,3562,3,100,0)
               Valid values are a b c d e g 
"KRN",8994,3562,3,101,0)
 117 CAT8G  - Category 8g flag - True if PriGRP ='Group 8' AND SUBGRP-'g' 
"KRN",8994,3562,3,102,0)
 118 SIMILAR = Similar Patients
"KRN",8994,3562,3,103,0)
 121 VAOS_GUID = Pointer to VAOS for Veteran-initiated appointment 
"KRN",8994,3562,3,104,0)
requests
"KRN",8994,3562,3,105,0)
   MESSSAGE | Patients 
"KRN",8994,3562,3,106,0)
    Patients separated by ;; 
"KRN",8994,3562,3,107,0)
      Each ;; piece contains the following ~ pieces 
"KRN",8994,3562,3,108,0)
      DFN ~ NAME ~ DOB ~ SSN
"KRN",8994,3719,-1)
0^1
"KRN",8994,3719,0)
SDEC SUMMGET2^SUMMGET2^SDEC^4^R^0^^0
"KRN",8994,3719,1,0)
^^1^1^3180228^
"KRN",8994,3719,1,1,0)
Get Audit Summary for a given data range.
"KRN",8994,3719,2,0)
^8994.02A^3^3
"KRN",8994,3719,2,1,0)
SDBEG^1^^0^1
"KRN",8994,3719,2,1,1,0)
^^1^1^3180228^
"KRN",8994,3719,2,1,1,1,0)
Begin Date in external form; default to all dates
"KRN",8994,3719,2,2,0)
SDEND^1^^0^2
"KRN",8994,3719,2,2,1,0)
^^1^1^3180228^
"KRN",8994,3719,2,2,1,1,0)
End Date in external form; default to all dates
"KRN",8994,3719,2,3,0)
USER^1^^0^3
"KRN",8994,3719,2,3,1,0)
^^2^2^3180228^
"KRN",8994,3719,2,3,1,1,0)
User ID pointer to NEW PERSON file (#200)
"KRN",8994,3719,2,3,1,2,0)
Used to filter by user
"KRN",8994,3719,2,"B","SDBEG",1)

"KRN",8994,3719,2,"B","SDEND",2)

"KRN",8994,3719,2,"B","USER",3)

"KRN",8994,3719,2,"PARAMSEQ",1,1)

"KRN",8994,3719,2,"PARAMSEQ",2,2)

"KRN",8994,3719,2,"PARAMSEQ",3,3)

"KRN",8994,3719,3,0)
^^18^18^3180228^
"KRN",8994,3719,3,1,0)
Global Array in which each array entry contains summary data delimited by 
"KRN",8994,3719,3,2,0)
caret (^):
"KRN",8994,3719,3,3,0)
     1. USERIEN  - Pointer to NEW PERSON file (#200)
"KRN",8994,3719,3,4,0)
     2. USERNAME - NAME from NEW PERSON file
"KRN",8994,3719,3,5,0)
     3. CONTACTS - Number of patient contacts in date range
"KRN",8994,3719,3,6,0)
     4. APPTOPEN - Number of APPT requests opened
"KRN",8994,3719,3,7,0)
     5. APPTMADE - Number of appointments made from APPT requests
"KRN",8994,3719,3,8,0)
     6. APPTCLSD - Number of APPT requests closed
"KRN",8994,3719,3,9,0)
     7. MRTCOPEN - Number of MRTC requests opened
"KRN",8994,3719,3,10,0)
     8. MRTCCLSD - Number of MRTC requests closed
"KRN",8994,3719,3,11,0)
     9. EWLOPEN  - Number of EWL requests opened
"KRN",8994,3719,3,12,0)
    10. EWLMADE  - Number of appointments made from EWL requests
"KRN",8994,3719,3,13,0)
    11. EWLCLSD  - Number of EWL requests closed
"KRN",8994,3719,3,14,0)
    12. PTCSOPEN - Number of PtCSch requests opened
"KRN",8994,3719,3,15,0)
    13. PTCSMADE - Number of appointments made from PtCSch requests
"KRN",8994,3719,3,16,0)
    14. CNSLTMD  - Number of appointments made from consults
"KRN",8994,3719,3,17,0)
    15. APPTCXLD - Number of appointments canceled
"KRN",8994,3719,3,18,0)
    16. ACTIONS  - Total number of user actions in date range
"KRN",8994,3720,-1)
0^2
"KRN",8994,3720,0)
SDEC RESCE^RESOURCE^SDEC01C^4^S^0^^0^1
"KRN",8994,3720,1,0)
^8994.01^1^1^3190618^^^
"KRN",8994,3720,1,1,0)
Returns all active Clinics
"KRN",8994,3720,2,0)
^8994.02A^4^4
"KRN",8994,3720,2,1,0)
DUZ^1^^0^1
"KRN",8994,3720,2,1,1,0)
^^2^2^3180301^
"KRN",8994,3720,2,1,1,1,0)
Checks that THIS user has the proper SECURITY KEY
"KRN",8994,3720,2,1,1,2,0)
Defaults to current user.
"KRN",8994,3720,2,2,0)
SDACT^1^^0^2
"KRN",8994,3720,2,2,1,0)
^^1^1^3180301^
"KRN",8994,3720,2,2,1,1,0)
Set to Yes - returns only active clinics
"KRN",8994,3720,2,3,0)
SDTYPE^1^^0^3
"KRN",8994,3720,2,3,1,0)
^^1^1^3180301^
"KRN",8994,3720,2,3,1,1,0)
Set to H - only returns Clinics
"KRN",8994,3720,2,4,0)
MAXREC^1^^0^4
"KRN",8994,3720,2,4,1,0)
^8994.021^1^1^3190618^^^
"KRN",8994,3720,2,4,1,1,0)
Max nuber of records returned
"KRN",8994,3720,2,"B","DUZ",1)

"KRN",8994,3720,2,"B","MAXREC",4)

"KRN",8994,3720,2,"B","SDACT",2)

"KRN",8994,3720,2,"B","SDTYPE",3)

"KRN",8994,3720,2,"PARAMSEQ",1,1)

"KRN",8994,3720,2,"PARAMSEQ",2,2)

"KRN",8994,3720,2,"PARAMSEQ",3,3)

"KRN",8994,3720,2,"PARAMSEQ",4,4)

"KRN",8994,3720,3,0)
^8994.03^5^5^3190618^^
"KRN",8994,3720,3,1,0)
Returns a global array in which each array entry contains data from
"KRN",8994,3720,3,2,0)
the  HOSPITAL LOCATION (clinic).
"KRN",8994,3720,3,3,0)
1. RESOURCEID - Pointer to the SDEC RESOURCE file
"KRN",8994,3720,3,4,0)
2. HOSPITAL_LOCATION_ID
"KRN",8994,3720,3,5,0)
3. CLINNAME  - Clinic Name from HOSPITAL LOCATION file 44
"KRN",8994,3721,-1)
0^5
"KRN",8994,3721,0)
SDECAR1 ARGUID^ARGUID^SDECAR1^4^P
"KRN",8994,3721,1,0)
^^2^2^3180419^
"KRN",8994,3721,1,1,0)
Returns Appointment Request data (same as SDEC ARGET) for a VAOS 
"KRN",8994,3721,1,2,0)
request.  Lookup is done on the GUID value.
"KRN",8994,3721,2,0)
^8994.02A^1^1
"KRN",8994,3721,2,1,0)
GUID^1^32^1^1
"KRN",8994,3721,2,1,1,0)
^^1^1^3180419^
"KRN",8994,3721,2,1,1,1,0)
GUID is the database pointer in the VAOS database.
"KRN",8994,3721,2,"B","GUID",1)

"KRN",8994,3721,2,"PARAMSEQ",1,1)

"KRN",8994,3721,3,0)
^^1^1^3180419^
"KRN",8994,3721,3,1,0)
Return data is the same as for SDEC ARGET RPC.
"MBREQ")
0
"ORD",5,.4)
.4;5;;;EDEOUT^DIFROMSO(.4,DA,"",XPDA);FPRE^DIFROMSI(.4,"",XPDA);EPRE^DIFROMSI(.4,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.4,DA,"",XPDA);DEL^DIFROMSK(.4,"",%)
"ORD",5,.4,0)
PRINT TEMPLATE
"ORD",6,.401)
.401;6;;;EDEOUT^DIFROMSO(.401,DA,"",XPDA);FPRE^DIFROMSI(.401,"",XPDA);EPRE^DIFROMSI(.401,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.401,DA,"",XPDA);DEL^DIFROMSK(.401,"",%)
"ORD",6,.401,0)
SORT TEMPLATE
"ORD",16,8994)
8994;16;1;;;;RPCE1^XPDIA1;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",48,-1)
1^1
"PKG",48,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",48,22,0)
^9.49I^1^1
"PKG",48,22,1,0)
5.3^3051119^2960613
"PKG",48,22,1,"PAH",1,0)
686^3190930^124
"PKG",48,22,1,"PAH",1,1,0)
^^505^505^3190930
"PKG",48,22,1,"PAH",1,1,1,0)
**************************************************************************
"PKG",48,22,1,"PAH",1,1,2,0)
**
"PKG",48,22,1,"PAH",1,1,3,0)
*                             GUI UPDATE 
"PKG",48,22,1,"PAH",1,1,4,0)
NOTICE                            *
"PKG",48,22,1,"PAH",1,1,5,0)
*-------------------------------------------------------------------------
"PKG",48,22,1,"PAH",1,1,6,0)
-*
"PKG",48,22,1,"PAH",1,1,7,0)
* This patch MUST be installed before the GUI update for release 
"PKG",48,22,1,"PAH",1,1,8,0)
1.5.1     *  
"PKG",48,22,1,"PAH",1,1,9,0)
* of VistA Scheduling GUI is installed. The previous 1.5 release will 
"PKG",48,22,1,"PAH",1,1,10,0)
work *
"PKG",48,22,1,"PAH",1,1,11,0)
* with no problems after this patch has been installed. However, if 
"PKG",48,22,1,"PAH",1,1,12,0)
the    *
"PKG",48,22,1,"PAH",1,1,13,0)
* 1.5.1 version is used without this patch, then all fields for 
"PKG",48,22,1,"PAH",1,1,14,0)
selecting  *
"PKG",48,22,1,"PAH",1,1,15,0)
* clinics, as well as the Audit Report, will not work 
"PKG",48,22,1,"PAH",1,1,16,0)
properly.            *
"PKG",48,22,1,"PAH",1,1,17,0)
**************************************************************************
"PKG",48,22,1,"PAH",1,1,18,0)
**
"PKG",48,22,1,"PAH",1,1,19,0)
 
"PKG",48,22,1,"PAH",1,1,20,0)
This patch contains the VistA components necessary to support the 1.5.1 
"PKG",48,22,1,"PAH",1,1,21,0)
release of VistA Scheduling Enhancements (VSE) as well as addressing the
"PKG",48,22,1,"PAH",1,1,22,0)
following issues:
"PKG",48,22,1,"PAH",1,1,23,0)
 
"PKG",48,22,1,"PAH",1,1,24,0)
1. R18120703FY18  - The VS GUI application freezes when the Audit Report 
"PKG",48,22,1,"PAH",1,1,25,0)
is
"PKG",48,22,1,"PAH",1,1,26,0)
                    run for all schedulers due to performance issues.
"PKG",48,22,1,"PAH",1,1,27,0)
 
"PKG",48,22,1,"PAH",1,1,28,0)
2. R17856900FY18, - If an appointment had been scheduled for a consult, 
"PKG",48,22,1,"PAH",1,1,29,0)
   R18564968FY18,   then that consult was completed, and finally the
"PKG",48,22,1,"PAH",1,1,30,0)
   R18648321FY18    appointment was canceled, the consult will be marked
"PKG",48,22,1,"PAH",1,1,31,0)
                    as active, even though it should remain as complete.
"PKG",48,22,1,"PAH",1,1,32,0)
 
"PKG",48,22,1,"PAH",1,1,33,0)
3. R17415367FY18  - If a user locks an appointment request (in this case,
"PKG",48,22,1,"PAH",1,1,34,0)
                    a consult request in particular) by selecting it in 
"PKG",48,22,1,"PAH",1,1,35,0)
the
"PKG",48,22,1,"PAH",1,1,36,0)
                    RM grid, then exits the GUI with it still locked, a 
"PKG",48,22,1,"PAH",1,1,37,0)
user
"PKG",48,22,1,"PAH",1,1,38,0)
                    in VistA will be unable to select the same request,
"PKG",48,22,1,"PAH",1,1,39,0)
                    instead receiving a message stating that the request 
"PKG",48,22,1,"PAH",1,1,40,0)
is
"PKG",48,22,1,"PAH",1,1,41,0)
                    locked.
"PKG",48,22,1,"PAH",1,1,42,0)
 
"PKG",48,22,1,"PAH",1,1,43,0)
4. R17039175FY18  - When using clinic lookup, if the user pauses the input
"PKG",48,22,1,"PAH",1,1,44,0)
                            is wiped out and has to be re-entered.
"PKG",48,22,1,"PAH",1,1,45,0)
 
"PKG",48,22,1,"PAH",1,1,46,0)
5. R18477670FY18  - When scheduling an appointment for an Inter-Facility
"PKG",48,22,1,"PAH",1,1,47,0)
                            Consult (IFC), the remote facility is not 
"PKG",48,22,1,"PAH",1,1,48,0)
notified.
"PKG",48,22,1,"PAH",1,1,49,0)
 
"PKG",48,22,1,"PAH",1,1,50,0)
This patch also contains modifications to routines (SDECAR1 and SDECAR2)
"PKG",48,22,1,"PAH",1,1,51,0)
and RPCs (SDEC ARGET and SDEC ARSET) as well changes to FileMan files
"PKG",48,22,1,"PAH",1,1,52,0)
(Appointment Request #409.85) related to a future enhancement - the 
"PKG",48,22,1,"PAH",1,1,53,0)
integration of Scheduling Manager functionality into the VS GUI.
"PKG",48,22,1,"PAH",1,1,54,0)
 
"PKG",48,22,1,"PAH",1,1,55,0)
 
"PKG",48,22,1,"PAH",1,1,56,0)
 
"PKG",48,22,1,"PAH",1,1,57,0)
Patch Components
"PKG",48,22,1,"PAH",1,1,58,0)
================
"PKG",48,22,1,"PAH",1,1,59,0)
 
"PKG",48,22,1,"PAH",1,1,60,0)
Files & Fields Associated:
"PKG",48,22,1,"PAH",1,1,61,0)
 
"PKG",48,22,1,"PAH",1,1,62,0)
File Name (#)                                             New/Modified/
"PKG",48,22,1,"PAH",1,1,63,0)
  Sub-file Name (#)   Field Name (Number)                   Deleted
"PKG",48,22,1,"PAH",1,1,64,0)
-------------------   ---------------------------------   -------------
"PKG",48,22,1,"PAH",1,1,65,0)
SDEC APPT REQUEST (#409.85)                               MODIFIED
"PKG",48,22,1,"PAH",1,1,66,0)
                              VAOS GUID (#5)                              
"PKG",48,22,1,"PAH",1,1,67,0)
NEW
"PKG",48,22,1,"PAH",1,1,68,0)
 
"PKG",48,22,1,"PAH",1,1,69,0)
SDEC CONTACT (#409.86)                                    MODIFIED
"PKG",48,22,1,"PAH",1,1,70,0)
 
"PKG",48,22,1,"PAH",1,1,71,0)
SD AUDIT STATISTICS (#409.97)                             NEW
"PKG",48,22,1,"PAH",1,1,72,0)
                      SCHEDULER (#.01)                    NEW
"PKG",48,22,1,"PAH",1,1,73,0)
                      DATE (#1)                           NEW
"PKG",48,22,1,"PAH",1,1,74,0)
                      PATIENT CONTACTS (#2)               NEW
"PKG",48,22,1,"PAH",1,1,75,0)
                      APPT REQUESTS (#3)                  NEW
"PKG",48,22,1,"PAH",1,1,76,0)
                      APPT APPOINTMENTS MADE (#4)         NEW
"PKG",48,22,1,"PAH",1,1,77,0)
                      APPT CLOSED (#5)                    NEW
"PKG",48,22,1,"PAH",1,1,78,0)
                      MRTC OPENED (#6)                    NEW
"PKG",48,22,1,"PAH",1,1,79,0)
                      MRTC CLOSED (#7)                    NEW
"PKG",48,22,1,"PAH",1,1,80,0)
                      EWL ENTRIES (#8)                    NEW
"PKG",48,22,1,"PAH",1,1,81,0)
                      EWL APPOINTMENTS MADE (#9)          NEW
"PKG",48,22,1,"PAH",1,1,82,0)
                      EWL CLOSED (#10)                    NEW
"PKG",48,22,1,"PAH",1,1,83,0)
                      PtCSch ENTRIES (#11)                NEW
"PKG",48,22,1,"PAH",1,1,84,0)
                      PtCSch APPOINTMENTS MADE (#12)      NEW
"PKG",48,22,1,"PAH",1,1,85,0)
                      CONSULT APPOINTMENTS MADE (#13)     NEW
"PKG",48,22,1,"PAH",1,1,86,0)
                      APPOINTMENTS CANCELLED (#14)        NEW
"PKG",48,22,1,"PAH",1,1,87,0)
                      TOTAL ACTIONS (#15)                 NEW
"PKG",48,22,1,"PAH",1,1,88,0)
 
"PKG",48,22,1,"PAH",1,1,89,0)
Bulletins Associated:
"PKG",48,22,1,"PAH",1,1,90,0)
                                                          New/Modified/
"PKG",48,22,1,"PAH",1,1,91,0)
Bulletin Name                                               Deleted    
"PKG",48,22,1,"PAH",1,1,92,0)
-------------                                             -------------
"PKG",48,22,1,"PAH",1,1,93,0)
N/A
"PKG",48,22,1,"PAH",1,1,94,0)
 
"PKG",48,22,1,"PAH",1,1,95,0)
 
"PKG",48,22,1,"PAH",1,1,96,0)
 
"PKG",48,22,1,"PAH",1,1,97,0)
Dialogs Associated:
"PKG",48,22,1,"PAH",1,1,98,0)
                                                          New/Modified/
"PKG",48,22,1,"PAH",1,1,99,0)
Dialog Name                                                 Deleted    
"PKG",48,22,1,"PAH",1,1,100,0)
-----------                                               -------------
"PKG",48,22,1,"PAH",1,1,101,0)
N/A
"PKG",48,22,1,"PAH",1,1,102,0)
 
"PKG",48,22,1,"PAH",1,1,103,0)
 
"PKG",48,22,1,"PAH",1,1,104,0)
 
"PKG",48,22,1,"PAH",1,1,105,0)
Forms Associated:
"PKG",48,22,1,"PAH",1,1,106,0)
                                                          New/Modified/
"PKG",48,22,1,"PAH",1,1,107,0)
Form Name                    File Name (Number)             Deleted    
"PKG",48,22,1,"PAH",1,1,108,0)
---------                    ------------------           -------------
"PKG",48,22,1,"PAH",1,1,109,0)
N/A
"PKG",48,22,1,"PAH",1,1,110,0)
 
"PKG",48,22,1,"PAH",1,1,111,0)
 
"PKG",48,22,1,"PAH",1,1,112,0)
 
"PKG",48,22,1,"PAH",1,1,113,0)
Functions Associated:
"PKG",48,22,1,"PAH",1,1,114,0)
                                                          New/Modified/
"PKG",48,22,1,"PAH",1,1,115,0)
Function Name                                               Deleted    
"PKG",48,22,1,"PAH",1,1,116,0)
-------------                                             -------------
"PKG",48,22,1,"PAH",1,1,117,0)
N/A
"PKG",48,22,1,"PAH",1,1,118,0)
 
"PKG",48,22,1,"PAH",1,1,119,0)
 
"PKG",48,22,1,"PAH",1,1,120,0)
 
"PKG",48,22,1,"PAH",1,1,121,0)
HL Logical Link:
"PKG",48,22,1,"PAH",1,1,122,0)
                                                          New/Modified/
"PKG",48,22,1,"PAH",1,1,123,0)
HL Logical Name                                             Deleted    
"PKG",48,22,1,"PAH",1,1,124,0)
---------------                                           -------------
"PKG",48,22,1,"PAH",1,1,125,0)
N/A
"PKG",48,22,1,"PAH",1,1,126,0)
 
"PKG",48,22,1,"PAH",1,1,127,0)
 
"PKG",48,22,1,"PAH",1,1,128,0)
 
"PKG",48,22,1,"PAH",1,1,129,0)
HL7 Application Parameters:
"PKG",48,22,1,"PAH",1,1,130,0)
                                                          New/Modified/
"PKG",48,22,1,"PAH",1,1,131,0)
HL7 Parameter Name                                          Deleted    
"PKG",48,22,1,"PAH",1,1,132,0)
------------------                                        -------------
"PKG",48,22,1,"PAH",1,1,133,0)
N/A
"PKG",48,22,1,"PAH",1,1,134,0)
 
"PKG",48,22,1,"PAH",1,1,135,0)
 
"PKG",48,22,1,"PAH",1,1,136,0)
 
"PKG",48,22,1,"PAH",1,1,137,0)
HLO Application Registry:
"PKG",48,22,1,"PAH",1,1,138,0)
                                                          New/Modified/
"PKG",48,22,1,"PAH",1,1,139,0)
HLO Registry Name                                           Deleted    
"PKG",48,22,1,"PAH",1,1,140,0)
-----------------                                         -------------
"PKG",48,22,1,"PAH",1,1,141,0)
N/A
"PKG",48,22,1,"PAH",1,1,142,0)
 
"PKG",48,22,1,"PAH",1,1,143,0)
 
"PKG",48,22,1,"PAH",1,1,144,0)
 
"PKG",48,22,1,"PAH",1,1,145,0)
Help Frames Associated:
"PKG",48,22,1,"PAH",1,1,146,0)
                                                          New/Modified/
"PKG",48,22,1,"PAH",1,1,147,0)
Help Frame Name                                             Deleted    
"PKG",48,22,1,"PAH",1,1,148,0)
---------------                                           -------------
"PKG",48,22,1,"PAH",1,1,149,0)
N/A
"PKG",48,22,1,"PAH",1,1,150,0)
 
"PKG",48,22,1,"PAH",1,1,151,0)
 
"PKG",48,22,1,"PAH",1,1,152,0)
 
"PKG",48,22,1,"PAH",1,1,153,0)
Mail Groups Associated:
"PKG",48,22,1,"PAH",1,1,154,0)
                                                          New/Modified/
"PKG",48,22,1,"PAH",1,1,155,0)
Mail Group Name                                             Deleted    
"PKG",48,22,1,"PAH",1,1,156,0)
---------------                                           -------------
"PKG",48,22,1,"PAH",1,1,157,0)
N/A
"PKG",48,22,1,"PAH",1,1,158,0)
 
"PKG",48,22,1,"PAH",1,1,159,0)
 
"PKG",48,22,1,"PAH",1,1,160,0)
 
"PKG",48,22,1,"PAH",1,1,161,0)
Options Associated:
"PKG",48,22,1,"PAH",1,1,162,0)
                                                                  
"PKG",48,22,1,"PAH",1,1,163,0)
New/Modified/
"PKG",48,22,1,"PAH",1,1,164,0)
Option Name                                              Type       
"PKG",48,22,1,"PAH",1,1,165,0)
Deleted    
"PKG",48,22,1,"PAH",1,1,166,0)
-----------                                              ----     
"PKG",48,22,1,"PAH",1,1,167,0)
-------------
"PKG",48,22,1,"PAH",1,1,168,0)
CLINICAL SCHEDULING PROCEDURE CALLS [SDECRPC]            Broker   MODIFIED
"PKG",48,22,1,"PAH",1,1,169,0)
COMPILE AUDIT REPORT FOR A SELECTED                      Routine  NEW
"PKG",48,22,1,"PAH",1,1,170,0)
   DATE [SDEC COMPILE AUDIT REPORT]
"PKG",48,22,1,"PAH",1,1,171,0)
COMPILE YESTERDAY'S AUDIT REPORT [SDEC AUDIT REPORT JOB] Routine  NEW
"PKG",48,22,1,"PAH",1,1,172,0)
RELEASE APPOINTMENT REQUEST LOCKS[SDEC RELEASE LOCKS]    Routine  NEW
"PKG",48,22,1,"PAH",1,1,173,0)
SUPERVISOR MENU [SDSUP]                                  Menu     MODIFIED
"PKG",48,22,1,"PAH",1,1,174,0)
 
"PKG",48,22,1,"PAH",1,1,175,0)
 
"PKG",48,22,1,"PAH",1,1,176,0)
 
"PKG",48,22,1,"PAH",1,1,177,0)
Parameter Definitions:
"PKG",48,22,1,"PAH",1,1,178,0)
                                                          New/Modified/
"PKG",48,22,1,"PAH",1,1,179,0)
Parameter Name                                              Deleted    
"PKG",48,22,1,"PAH",1,1,180,0)
--------------                                            -------------
"PKG",48,22,1,"PAH",1,1,181,0)
N/A
"PKG",48,22,1,"PAH",1,1,182,0)
 
"PKG",48,22,1,"PAH",1,1,183,0)
 
"PKG",48,22,1,"PAH",1,1,184,0)
 
"PKG",48,22,1,"PAH",1,1,185,0)
Parameter Template:
"PKG",48,22,1,"PAH",1,1,186,0)
                                                          New/Modified/
"PKG",48,22,1,"PAH",1,1,187,0)
Template Name                                               Deleted    
"PKG",48,22,1,"PAH",1,1,188,0)
-------------                                             -------------
"PKG",48,22,1,"PAH",1,1,189,0)
N/A
"PKG",48,22,1,"PAH",1,1,190,0)
 
"PKG",48,22,1,"PAH",1,1,191,0)
 
"PKG",48,22,1,"PAH",1,1,192,0)
 
"PKG",48,22,1,"PAH",1,1,193,0)
Protocols Associated:
"PKG",48,22,1,"PAH",1,1,194,0)
                                                          New/Modified/
"PKG",48,22,1,"PAH",1,1,195,0)
Protocol Name                                               Deleted    
"PKG",48,22,1,"PAH",1,1,196,0)
-------------                                             -------------
"PKG",48,22,1,"PAH",1,1,197,0)
N/A
"PKG",48,22,1,"PAH",1,1,198,0)
 
"PKG",48,22,1,"PAH",1,1,199,0)
 
"PKG",48,22,1,"PAH",1,1,200,0)
 
"PKG",48,22,1,"PAH",1,1,201,0)
Remote Procedures Associated:
"PKG",48,22,1,"PAH",1,1,202,0)
                                                          New/Modified/
"PKG",48,22,1,"PAH",1,1,203,0)
Remote Procedure Name                                       Deleted    
"PKG",48,22,1,"PAH",1,1,204,0)
---------------------                                     -------------
"PKG",48,22,1,"PAH",1,1,205,0)
SDEC ARGET                                                MODIFIED
"PKG",48,22,1,"PAH",1,1,206,0)
SDEC ARSET                                                MODIFIED
"PKG",48,22,1,"PAH",1,1,207,0)
SDEC RESCE                                                NEW
"PKG",48,22,1,"PAH",1,1,208,0)
SDEC SUMMGET2                                             NEW
"PKG",48,22,1,"PAH",1,1,209,0)
 
"PKG",48,22,1,"PAH",1,1,210,0)
 
"PKG",48,22,1,"PAH",1,1,211,0)
 
"PKG",48,22,1,"PAH",1,1,212,0)
Security Keys Associated:
"PKG",48,22,1,"PAH",1,1,213,0)
                                                          New/Modified/
"PKG",48,22,1,"PAH",1,1,214,0)
Security Key Name                                           Deleted    
"PKG",48,22,1,"PAH",1,1,215,0)
-----------------                                         -------------
"PKG",48,22,1,"PAH",1,1,216,0)
N/A
"PKG",48,22,1,"PAH",1,1,217,0)
 
"PKG",48,22,1,"PAH",1,1,218,0)
 
"PKG",48,22,1,"PAH",1,1,219,0)
 
"PKG",48,22,1,"PAH",1,1,220,0)
Templates, Input Associated:
"PKG",48,22,1,"PAH",1,1,221,0)
                                                          New/Modified/
"PKG",48,22,1,"PAH",1,1,222,0)
Template Name      Type      File Name (Number)             Deleted    
"PKG",48,22,1,"PAH",1,1,223,0)
-------------      ----      ------------------           -------------
"PKG",48,22,1,"PAH",1,1,224,0)
N/A
"PKG",48,22,1,"PAH",1,1,225,0)
 
"PKG",48,22,1,"PAH",1,1,226,0)
 
"PKG",48,22,1,"PAH",1,1,227,0)
 
"PKG",48,22,1,"PAH",1,1,228,0)
Templates, List Associated:
"PKG",48,22,1,"PAH",1,1,229,0)
                                                          New/Modified/
"PKG",48,22,1,"PAH",1,1,230,0)
Template Name      Type                                     Deleted    
"PKG",48,22,1,"PAH",1,1,231,0)
-------------      ----                                   -------------
"PKG",48,22,1,"PAH",1,1,232,0)
N/A
"PKG",48,22,1,"PAH",1,1,233,0)
 
"PKG",48,22,1,"PAH",1,1,234,0)
 
"PKG",48,22,1,"PAH",1,1,235,0)
 
"PKG",48,22,1,"PAH",1,1,236,0)
Templates, Print Associated:
"PKG",48,22,1,"PAH",1,1,237,0)
                                                            New/Modified/
"PKG",48,22,1,"PAH",1,1,238,0)
Template Name         Type  File Name (Number)                 Deleted    
"PKG",48,22,1,"PAH",1,1,239,0)
-------------         ----  ------------------              -------------
"PKG",48,22,1,"PAH",1,1,240,0)
SDEC AUDIT DATE PRINT Print SDEC AUDIT STATISTICS (#409.97) NEW
"PKG",48,22,1,"PAH",1,1,241,0)
 
"PKG",48,22,1,"PAH",1,1,242,0)
 
"PKG",48,22,1,"PAH",1,1,243,0)
 
"PKG",48,22,1,"PAH",1,1,244,0)
Templates, Sort Associated:
"PKG",48,22,1,"PAH",1,1,245,0)
                                                               
"PKG",48,22,1,"PAH",1,1,246,0)
New/Modified/
"PKG",48,22,1,"PAH",1,1,247,0)
Template Name             Type File Name (Number)                 
"PKG",48,22,1,"PAH",1,1,248,0)
Deleted    
"PKG",48,22,1,"PAH",1,1,249,0)
-------------             ---- ------------------              
"PKG",48,22,1,"PAH",1,1,250,0)
-------------
"PKG",48,22,1,"PAH",1,1,251,0)
SDEC AUDIT REPORT BY DATE Sort SDEC AUDIT STATISTICS (#409.97) NEW
"PKG",48,22,1,"PAH",1,1,252,0)
 
"PKG",48,22,1,"PAH",1,1,253,0)
 
"PKG",48,22,1,"PAH",1,1,254,0)
Additional Information:
"PKG",48,22,1,"PAH",1,1,255,0)
N/A
"PKG",48,22,1,"PAH",1,1,256,0)
 
"PKG",48,22,1,"PAH",1,1,257,0)
 
"PKG",48,22,1,"PAH",1,1,258,0)
New Service Requests (NSRs)
"PKG",48,22,1,"PAH",1,1,259,0)
----------------------------  
"PKG",48,22,1,"PAH",1,1,260,0)
N/A
"PKG",48,22,1,"PAH",1,1,261,0)
 
"PKG",48,22,1,"PAH",1,1,262,0)
 
"PKG",48,22,1,"PAH",1,1,263,0)
Patient Safety Issues (PSIs)
"PKG",48,22,1,"PAH",1,1,264,0)
-----------------------------
"PKG",48,22,1,"PAH",1,1,265,0)
N/A
"PKG",48,22,1,"PAH",1,1,266,0)
 
"PKG",48,22,1,"PAH",1,1,267,0)
 
"PKG",48,22,1,"PAH",1,1,268,0)
Service Desk Manager (SDM) Ticket(s) & Overview
"PKG",48,22,1,"PAH",1,1,269,0)
-----------------------------------------------
"PKG",48,22,1,"PAH",1,1,270,0)
1. R18120703FY18  Cancel Audit Data Error after selecting ALL in Audit 
"PKG",48,22,1,"PAH",1,1,271,0)
Report
"PKG",48,22,1,"PAH",1,1,272,0)
  
"PKG",48,22,1,"PAH",1,1,273,0)
Problem:
"PKG",48,22,1,"PAH",1,1,274,0)
-------
"PKG",48,22,1,"PAH",1,1,275,0)
In the Audit Report, when the user chooses ALL in order to run the report 
"PKG",48,22,1,"PAH",1,1,276,0)
for
"PKG",48,22,1,"PAH",1,1,277,0)
all schedulers, the system hangs for several minutes attempting to load 
"PKG",48,22,1,"PAH",1,1,278,0)
data,
"PKG",48,22,1,"PAH",1,1,279,0)
then finally returns an RPCException when the connection times out. This 
"PKG",48,22,1,"PAH",1,1,280,0)
also
"PKG",48,22,1,"PAH",1,1,281,0)
terminate's the user's connection to VistA until they close and reopen VS 
"PKG",48,22,1,"PAH",1,1,282,0)
GUI. 
"PKG",48,22,1,"PAH",1,1,283,0)
 
"PKG",48,22,1,"PAH",1,1,284,0)
Resolution:
"PKG",48,22,1,"PAH",1,1,285,0)
----------
"PKG",48,22,1,"PAH",1,1,286,0)
The data for the Audit Report is now compiled by a nightly job so that 
"PKG",48,22,1,"PAH",1,1,287,0)
much
"PKG",48,22,1,"PAH",1,1,288,0)
less data needs to be transmitted to the client in order to use the 
"PKG",48,22,1,"PAH",1,1,289,0)
report.
"PKG",48,22,1,"PAH",1,1,290,0)
Users will now be able to run the report for all schedulers without
"PKG",48,22,1,"PAH",1,1,291,0)
encountering the timeout.
"PKG",48,22,1,"PAH",1,1,292,0)
 
"PKG",48,22,1,"PAH",1,1,293,0)
2. R17856900FY18, R18564968FY18, R18648321FY18 Reactivating completed 
"PKG",48,22,1,"PAH",1,1,294,0)
consults
"PKG",48,22,1,"PAH",1,1,295,0)
  
"PKG",48,22,1,"PAH",1,1,296,0)
Problem:
"PKG",48,22,1,"PAH",1,1,297,0)
-------
"PKG",48,22,1,"PAH",1,1,298,0)
If an appointment is created for a consult, then the consult is marked as
"PKG",48,22,1,"PAH",1,1,299,0)
complete, then finally the appointment is canceled, the consult returns 
"PKG",48,22,1,"PAH",1,1,300,0)
to the
"PKG",48,22,1,"PAH",1,1,301,0)
active status instead of remaining complete. 
"PKG",48,22,1,"PAH",1,1,302,0)
 
"PKG",48,22,1,"PAH",1,1,303,0)
Resolution:
"PKG",48,22,1,"PAH",1,1,304,0)
----------
"PKG",48,22,1,"PAH",1,1,305,0)
In this situation, the consult will now remain in the complete status.
"PKG",48,22,1,"PAH",1,1,306,0)
 
"PKG",48,22,1,"PAH",1,1,307,0)
3. R17415367FY18 Incorrect lock handling in RM Grid
"PKG",48,22,1,"PAH",1,1,308,0)
  
"PKG",48,22,1,"PAH",1,1,309,0)
Problem:
"PKG",48,22,1,"PAH",1,1,310,0)
-------
"PKG",48,22,1,"PAH",1,1,311,0)
When a user selects a request in the RM grid, the request is locked until
"PKG",48,22,1,"PAH",1,1,312,0)
another request is selected. If the user exits the program, the lock is 
"PKG",48,22,1,"PAH",1,1,313,0)
not
"PKG",48,22,1,"PAH",1,1,314,0)
released. If a VistA user tries to use the previously locked request, they
"PKG",48,22,1,"PAH",1,1,315,0)
will be prevented from doing so. (To exacerbate this, the GUI was not 
"PKG",48,22,1,"PAH",1,1,316,0)
handling
"PKG",48,22,1,"PAH",1,1,317,0)
locks correctly and would give the lock to any user that tried to get it 
"PKG",48,22,1,"PAH",1,1,318,0)
even
"PKG",48,22,1,"PAH",1,1,319,0)
if another user held the lock, so this issue was not visible to GUI
"PKG",48,22,1,"PAH",1,1,320,0)
users.)
"PKG",48,22,1,"PAH",1,1,321,0)
 
"PKG",48,22,1,"PAH",1,1,322,0)
Resolution:
"PKG",48,22,1,"PAH",1,1,323,0)
----------
"PKG",48,22,1,"PAH",1,1,324,0)
The request that a user had locked when they log out is now unlocked
"PKG",48,22,1,"PAH",1,1,325,0)
correctly. In addition, if a user tries to work a request in the GUI that
"PKG",48,22,1,"PAH",1,1,326,0)
another user has locked, they will receive a message that the request is
"PKG",48,22,1,"PAH",1,1,327,0)
locked and which user holds the lock. Finally, a VistA option on the
"PKG",48,22,1,"PAH",1,1,328,0)
Supervisor menu has been added that will release all locks held by a user.
"PKG",48,22,1,"PAH",1,1,329,0)
    
"PKG",48,22,1,"PAH",1,1,330,0)
4. R17039175FY18 Consult lookup interaction errors
"PKG",48,22,1,"PAH",1,1,331,0)
 
"PKG",48,22,1,"PAH",1,1,332,0)
Problem:
"PKG",48,22,1,"PAH",1,1,333,0)
-------
"PKG",48,22,1,"PAH",1,1,334,0)
When using clinic lookup in the VS GUI, if the user pauses typing, the 
"PKG",48,22,1,"PAH",1,1,335,0)
input 
"PKG",48,22,1,"PAH",1,1,336,0)
is wiped out and has to be re-entered. A pop-up window appears if the 
"PKG",48,22,1,"PAH",1,1,337,0)
user's 
"PKG",48,22,1,"PAH",1,1,338,0)
input results in more than 50 matches and the input is erased. In 
"PKG",48,22,1,"PAH",1,1,339,0)
addtion, 
"PKG",48,22,1,"PAH",1,1,340,0)
the user cannot refine the list of clinics returned by typing additional 
"PKG",48,22,1,"PAH",1,1,341,0)
characters.
"PKG",48,22,1,"PAH",1,1,342,0)
 
"PKG",48,22,1,"PAH",1,1,343,0)
Resolution:
"PKG",48,22,1,"PAH",1,1,344,0)
----------
"PKG",48,22,1,"PAH",1,1,345,0)
GUI changes made, eliminating the pop-up window and responding to the 
"PKG",48,22,1,"PAH",1,1,346,0)
user's
"PKG",48,22,1,"PAH",1,1,347,0)
input including narrowing the list of returned values when each additional
"PKG",48,22,1,"PAH",1,1,348,0)
character is entered. A new RPC was created for the GUI to support this
"PKG",48,22,1,"PAH",1,1,349,0)
change. The new RPC returns a more limited amount of data so that the
"PKG",48,22,1,"PAH",1,1,350,0)
GUI can respond more quickly to the user's input.
"PKG",48,22,1,"PAH",1,1,351,0)
 
"PKG",48,22,1,"PAH",1,1,352,0)
5. R18477670FY18 Remote facility not updated when appointments made for 
"PKG",48,22,1,"PAH",1,1,353,0)
IFCs
"PKG",48,22,1,"PAH",1,1,354,0)
 
"PKG",48,22,1,"PAH",1,1,355,0)
Problem:
"PKG",48,22,1,"PAH",1,1,356,0)
-------
"PKG",48,22,1,"PAH",1,1,357,0)
When scheduling an appointment for an IFC, the remote facility is not 
"PKG",48,22,1,"PAH",1,1,358,0)
notified.
"PKG",48,22,1,"PAH",1,1,359,0)
RPC code for VS GUI did not include functionality in VistA Scheduling for 
"PKG",48,22,1,"PAH",1,1,360,0)
the 
"PKG",48,22,1,"PAH",1,1,361,0)
generation of IFC notifications.
"PKG",48,22,1,"PAH",1,1,362,0)
 
"PKG",48,22,1,"PAH",1,1,363,0)
Resolution:
"PKG",48,22,1,"PAH",1,1,364,0)
----------
"PKG",48,22,1,"PAH",1,1,365,0)
Modified the RPC code to call a VistA Scheduling API that generates IFC 
"PKG",48,22,1,"PAH",1,1,366,0)
notifications.
"PKG",48,22,1,"PAH",1,1,367,0)
 
"PKG",48,22,1,"PAH",1,1,368,0)
Test Sites:
"PKG",48,22,1,"PAH",1,1,369,0)
----------
"PKG",48,22,1,"PAH",1,1,370,0)
TBA
"PKG",48,22,1,"PAH",1,1,371,0)
 
"PKG",48,22,1,"PAH",1,1,372,0)
 
"PKG",48,22,1,"PAH",1,1,373,0)
Documentation Retrieval Instructions
"PKG",48,22,1,"PAH",1,1,374,0)
------------------------------------ 
"PKG",48,22,1,"PAH",1,1,375,0)
Updated documentation describing the new functionality introduced by this 
"PKG",48,22,1,"PAH",1,1,376,0)
patch is available.
"PKG",48,22,1,"PAH",1,1,377,0)
 
"PKG",48,22,1,"PAH",1,1,378,0)
The preferred method is to FTP the files from 
"PKG",48,22,1,"PAH",1,1,379,0)
ftp://download.vista.domain.ext/.
"PKG",48,22,1,"PAH",1,1,380,0)
This transmits the files from the first available FTP server. Sites may 
"PKG",48,22,1,"PAH",1,1,381,0)
also elect to retrieve software directly from a specific server as 
"PKG",48,22,1,"PAH",1,1,382,0)
follows:
"PKG",48,22,1,"PAH",1,1,383,0)
 
"PKG",48,22,1,"PAH",1,1,384,0)
 Hines          ftp.domain.ext   <ftp://ftp.domain.ext>
"PKG",48,22,1,"PAH",1,1,385,0)
 Salt Lake City ftp.domain.ext     <ftp://ftp.domain.ext>
"PKG",48,22,1,"PAH",1,1,386,0)
 
"PKG",48,22,1,"PAH",1,1,387,0)
Documentation can also be found on the VA Software Documentation Library 
"PKG",48,22,1,"PAH",1,1,388,0)
at:
"PKG",48,22,1,"PAH",1,1,389,0)
http://www4.domain.ext/vdl/
"PKG",48,22,1,"PAH",1,1,390,0)
 
"PKG",48,22,1,"PAH",1,1,391,0)
Title                                          File Name          FTP Mode
"PKG",48,22,1,"PAH",1,1,392,0)
--------------------------------------------------------------------------
"PKG",48,22,1,"PAH",1,1,393,0)
VistA Scheduling Enhancements GUI User Guide   VSE_VA_GUI_UG.PDF  Binary
"PKG",48,22,1,"PAH",1,1,394,0)
VistA Scheduling Enhancements Technical Manual VSE_TM.PDF         Binary
"PKG",48,22,1,"PAH",1,1,395,0)
 
"PKG",48,22,1,"PAH",1,1,396,0)
 
"PKG",48,22,1,"PAH",1,1,397,0)
Patch Installation:
"PKG",48,22,1,"PAH",1,1,398,0)
 
"PKG",48,22,1,"PAH",1,1,399,0)
 
"PKG",48,22,1,"PAH",1,1,400,0)
Pre/Post Installation Overview
"PKG",48,22,1,"PAH",1,1,401,0)
------------------------------
"PKG",48,22,1,"PAH",1,1,402,0)
Post-installation, there are 3 tasks: 1) re-index the SDEC CONTACT file,
"PKG",48,22,1,"PAH",1,1,403,0)
2) schedule the audit statistics compiler to run early each morning in 
"PKG",48,22,1,"PAH",1,1,404,0)
TaskMan and 3) compile enough previous audit statistics for reporting 
"PKG",48,22,1,"PAH",1,1,405,0)
users.
"PKG",48,22,1,"PAH",1,1,406,0)
These tasks will be detailed in the Post-Installation Instructions 
"PKG",48,22,1,"PAH",1,1,407,0)
section.
"PKG",48,22,1,"PAH",1,1,408,0)
  
"PKG",48,22,1,"PAH",1,1,409,0)
Installation Instructions
"PKG",48,22,1,"PAH",1,1,410,0)
-------------------------
"PKG",48,22,1,"PAH",1,1,411,0)
Install Time - less than 5 minutes.
"PKG",48,22,1,"PAH",1,1,412,0)
    
"PKG",48,22,1,"PAH",1,1,413,0)
   1. Use the INSTALL/CHECK MESSAGE option on the PackMan menu.
"PKG",48,22,1,"PAH",1,1,414,0)
   
"PKG",48,22,1,"PAH",1,1,415,0)
   2. From the Kernel Installation & Distribution System menu, select
"PKG",48,22,1,"PAH",1,1,416,0)
      the Installation menu.
"PKG",48,22,1,"PAH",1,1,417,0)
   
"PKG",48,22,1,"PAH",1,1,418,0)
   3. From this menu, you may select to use the following options
"PKG",48,22,1,"PAH",1,1,419,0)
      (when prompted for INSTALL NAME, enter SD*5.3*686):
"PKG",48,22,1,"PAH",1,1,420,0)
          a.  Verify Checksums in Transport Global - This option will 
"PKG",48,22,1,"PAH",1,1,421,0)
allow
"PKG",48,22,1,"PAH",1,1,422,0)
              you to ensure the integrity of the routines that are in the
"PKG",48,22,1,"PAH",1,1,423,0)
              transport global.
"PKG",48,22,1,"PAH",1,1,424,0)
          b.  Print Transport Global - This option will allow you to view
"PKG",48,22,1,"PAH",1,1,425,0)
              the components of the KIDS build.
"PKG",48,22,1,"PAH",1,1,426,0)
          c.  Compare Transport Global to Current System - This option 
"PKG",48,22,1,"PAH",1,1,427,0)
will
"PKG",48,22,1,"PAH",1,1,428,0)
              allow you to view all changes that will be made when this 
"PKG",48,22,1,"PAH",1,1,429,0)
              patch is installed.  It compares all components of this
"PKG",48,22,1,"PAH",1,1,430,0)
              patch (routines, DD's, templates, etc.).
"PKG",48,22,1,"PAH",1,1,431,0)
          d.  Backup a Transport Global - This option will create a backup
"PKG",48,22,1,"PAH",1,1,432,0)
              message of any routines exported with this patch. It will 
"PKG",48,22,1,"PAH",1,1,433,0)
not
"PKG",48,22,1,"PAH",1,1,434,0)
              backup any other changes such as DD's or templates.
"PKG",48,22,1,"PAH",1,1,435,0)
   
"PKG",48,22,1,"PAH",1,1,436,0)
   4. Use the Install Package(s) option and select the package SD*5.3*686.
"PKG",48,22,1,"PAH",1,1,437,0)
   
"PKG",48,22,1,"PAH",1,1,438,0)
   5. When prompted "Want KIDS to INHIBIT LOGONs during the install? NO//"
"PKG",48,22,1,"PAH",1,1,439,0)
      respond NO.
"PKG",48,22,1,"PAH",1,1,440,0)
   6. When prompted "Want to DISABLE Scheduled Options, Menu Options, and
"PKG",48,22,1,"PAH",1,1,441,0)
      Protocols? NO//", respond NO
"PKG",48,22,1,"PAH",1,1,442,0)
 
"PKG",48,22,1,"PAH",1,1,443,0)
Post-Installation Instructions
"PKG",48,22,1,"PAH",1,1,444,0)
------------------------------
"PKG",48,22,1,"PAH",1,1,445,0)
1.  RE-INDEX THE SDEC CONTACT FILE
"PKG",48,22,1,"PAH",1,1,446,0)
    ------------------------------
"PKG",48,22,1,"PAH",1,1,447,0)
    VA FileMan 22.2
"PKG",48,22,1,"PAH",1,1,448,0)
      
"PKG",48,22,1,"PAH",1,1,449,0)
    Select OPTION: UTILITY FUNCTIONS  
"PKG",48,22,1,"PAH",1,1,450,0)
                   ----
"PKG",48,22,1,"PAH",1,1,451,0)
        
"PKG",48,22,1,"PAH",1,1,452,0)
    Select UTILITY OPTION: 4  RE-INDEX FILE
"PKG",48,22,1,"PAH",1,1,453,0)
                           -
"PKG",48,22,1,"PAH",1,1,454,0)
     
"PKG",48,22,1,"PAH",1,1,455,0)
    MODIFY WHAT FILE: SD Audit Statistics// 409.86  SDEC CONTACT
"PKG",48,22,1,"PAH",1,1,456,0)
                                            ------
"PKG",48,22,1,"PAH",1,1,457,0)
                                              (0 entries)
"PKG",48,22,1,"PAH",1,1,458,0)
     
"PKG",48,22,1,"PAH",1,1,459,0)
    THERE ARE 3 INDICES WITHIN THIS FILE
"PKG",48,22,1,"PAH",1,1,460,0)
    DO YOU WISH TO RE-CROSS-REFERENCE ONE PARTICULAR INDEX? No// Y  (Yes)
"PKG",48,22,1,"PAH",1,1,461,0)
                                                                 -
"PKG",48,22,1,"PAH",1,1,462,0)
     
"PKG",48,22,1,"PAH",1,1,463,0)
    What type of cross-reference (Traditional or New)? Traditional// NEW
"PKG",48,22,1,"PAH",1,1,464,0)
                                                                     ---
"PKG",48,22,1,"PAH",1,1,465,0)
     
"PKG",48,22,1,"PAH",1,1,466,0)
              File: SDEC CONTACT (#409.86)
"PKG",48,22,1,"PAH",1,1,467,0)
    Select Subfile: 3  DATE/TIME of CONTACT  (Subfile #409.863)
"PKG",48,22,1,"PAH",1,1,468,0)
                    -
"PKG",48,22,1,"PAH",1,1,469,0)
     
"PKG",48,22,1,"PAH",1,1,470,0)
    Current Indexes on subfile #409.863:
"PKG",48,22,1,"PAH",1,1,471,0)
      1404   'AD' whole file index (resides on file #409.86)
"PKG",48,22,1,"PAH",1,1,472,0)
     
"PKG",48,22,1,"PAH",1,1,473,0)
    Which Index do you wish to re-cross-reference? 1404//   AD
"PKG",48,22,1,"PAH",1,1,474,0)
                                                            --
"PKG",48,22,1,"PAH",1,1,475,0)
     
"PKG",48,22,1,"PAH",1,1,476,0)
    Do you want to delete the existing 'AD' cross-reference? YES
"PKG",48,22,1,"PAH",1,1,477,0)
                                                             ---
"PKG",48,22,1,"PAH",1,1,478,0)
    Do you want to re-build the 'AD' cross reference? YES  ...DONE! 
"PKG",48,22,1,"PAH",1,1,479,0)
                                                      ---
"PKG",48,22,1,"PAH",1,1,480,0)
 
"PKG",48,22,1,"PAH",1,1,481,0)
2.  SCHEDULE THE AUDIT REPORT JOB
"PKG",48,22,1,"PAH",1,1,482,0)
    -----------------------------
"PKG",48,22,1,"PAH",1,1,483,0)
    Access the TASKMAN MANAGEMENT option then select Schedule/Unschedule 
"PKG",48,22,1,"PAH",1,1,484,0)
    options. Schedule the SDEC AUDIT REPORT JOB option to run at some 
"PKG",48,22,1,"PAH",1,1,485,0)
point 
"PKG",48,22,1,"PAH",1,1,486,0)
    in the early morning tomorrow (such as 1:00 am) with a rescheduling
"PKG",48,22,1,"PAH",1,1,487,0)
    frequency of one day (1D).
"PKG",48,22,1,"PAH",1,1,488,0)
 
"PKG",48,22,1,"PAH",1,1,489,0)
3.  COMPILE DATA FOR THE AUDIT REPORT
"PKG",48,22,1,"PAH",1,1,490,0)
    ---------------------------------
"PKG",48,22,1,"PAH",1,1,491,0)
    Access the SDEC COMPILE AUDIT REPORT option. Enter the date range 
"PKG",48,22,1,"PAH",1,1,492,0)
that 
"PKG",48,22,1,"PAH",1,1,493,0)
    you want to be able to report statistics for.  
"PKG",48,22,1,"PAH",1,1,494,0)
 
"PKG",48,22,1,"PAH",1,1,495,0)
    NOTE: You can run the option as many times as needed to compile the
"PKG",48,22,1,"PAH",1,1,496,0)
    report statistics. Compiling will be skipped if it has already been 
"PKG",48,22,1,"PAH",1,1,497,0)
done
"PKG",48,22,1,"PAH",1,1,498,0)
    for a day. It is recommended that you compile a single day the first 
"PKG",48,22,1,"PAH",1,1,499,0)
time
"PKG",48,22,1,"PAH",1,1,500,0)
    you use the option to gauge the amount of time required at your 
"PKG",48,22,1,"PAH",1,1,501,0)
facility.
"PKG",48,22,1,"PAH",1,1,502,0)
    Compiling audit statistics can be done at any time after installation 
"PKG",48,22,1,"PAH",1,1,503,0)
that
"PKG",48,22,1,"PAH",1,1,504,0)
    is convenient, but users will only be able to get data on the audit
"PKG",48,22,1,"PAH",1,1,505,0)
    report that has been compiled.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
15
"RTN","SD686PST")
0^15^B21201631^n/a
"RTN","SD686PST",1,0)
SD686PST ;  ALB/SAT - SD*5.3*686 POST-INSTALL ;
"RTN","SD686PST",2,0)
 ;;5.3;Scheduling;**686**;Aug 13, 1993;Build 53
"RTN","SD686PST",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified
"RTN","SD686PST",4,0)
 ;
"RTN","SD686PST",5,0)
 ;  Post-install routine for patch 686.  Identifies data errors in scheduling request files (#403.5, 409.3, 123, 409.85).
"RTN","SD686PST",6,0)
 ;
"RTN","SD686PST",7,0)
 D EXECUTE ;
"RTN","SD686PST",8,0)
 D AD
"RTN","SD686PST",9,0)
 Q
"RTN","SD686PST",10,0)
 ;
"RTN","SD686PST",11,0)
EXECUTE ;
"RTN","SD686PST",12,0)
 ;
"RTN","SD686PST",13,0)
 K ^TMP($J) ;
"RTN","SD686PST",14,0)
 ;
"RTN","SD686PST",15,0)
 N DA,I,FND,XMZ,LINE,X,SENDMSG ;
"RTN","SD686PST",16,0)
 S SENDMSG=0 ;
"RTN","SD686PST",17,0)
 W !,"Checking for data errors",! ;
"RTN","SD686PST",18,0)
 ;
"RTN","SD686PST",19,0)
 ;  Check for missing patient pointers in Request/Consultation (#123) file
"RTN","SD686PST",20,0)
 ;
"RTN","SD686PST",21,0)
 W !,"Consults..." ;
"RTN","SD686PST",22,0)
 S LINE=1,^TMP($J,"SDEC",LINE)="Records in consult file (#123) with null patient pointers (field #.02)" ;
"RTN","SD686PST",23,0)
 S DA=0,FND=0 F I=1:1 S DA=$O(^GMR(123,DA)) Q:'DA  W:I#1000=0 "." S X=$G(^(DA,0)) D  ;
"RTN","SD686PST",24,0)
 . I $P(X,"^",2)="" S FND=1,LINE=LINE+1,^TMP($J,"SDEC",LINE)="Null patient pointer (field #.02) in record "_DA ;
"RTN","SD686PST",25,0)
 ;
"RTN","SD686PST",26,0)
 I 'FND S LINE=LINE+1,^TMP($J,"SDEC",LINE)="NONE FOUND" ;
"RTN","SD686PST",27,0)
 E  S SENDMSG=1 ;
"RTN","SD686PST",28,0)
 S LINE=LINE+1,^TMP($J,"SDEC",LINE)=" " ;
"RTN","SD686PST",29,0)
 S LINE=LINE+1,^TMP($J,"SDEC",LINE)=" " ;
"RTN","SD686PST",30,0)
 ;
"RTN","SD686PST",31,0)
 ;  Check for bad dates in Recall Reminders file (#403.5)
"RTN","SD686PST",32,0)
 ;
"RTN","SD686PST",33,0)
 W !,"Recall Reminders..." ;
"RTN","SD686PST",34,0)
 S LINE=LINE+1,^TMP($J,"SDEC",LINE)="Records in recall reminders file (#403.5) with imprecise dates (fields #5 and #5.5)" ;
"RTN","SD686PST",35,0)
 S DA=0,FND=0 F I=1:1 S DA=$O(^SD(403.5,DA)) Q:'DA  W:I#1000=0 "." S X=$G(^(DA,0)) D  ;
"RTN","SD686PST",36,0)
 . I $P(X,"^",6)?5N1"00" S FND=1,LINE=LINE+1,^TMP($J,"SDEC",LINE)="Recall Date (#5) incorrect in record "_DA ;
"RTN","SD686PST",37,0)
 . I $P(X,"^",12)?5N1"00" S FND=1,LINE=LINE+1,^TMP($J,"SDEC",LINE)="Recall Date Per Patient (#5.5) incorrect in record "_DA ;
"RTN","SD686PST",38,0)
 ;
"RTN","SD686PST",39,0)
 I 'FND S LINE=LINE+1,^TMP($J,"SDEC",LINE)="NONE FOUND" ;
"RTN","SD686PST",40,0)
 E  S SENDMSG=1 ;
"RTN","SD686PST",41,0)
 S LINE=LINE+1,^TMP($J,"SDEC",LINE)=" " ;
"RTN","SD686PST",42,0)
 S LINE=LINE+1,^TMP($J,"SDEC",LINE)=" " ;
"RTN","SD686PST",43,0)
 ;
"RTN","SD686PST",44,0)
 ;  Check for bad dates in Wait List file (#409.3)
"RTN","SD686PST",45,0)
 ;
"RTN","SD686PST",46,0)
 W !,"Wait List..." ;
"RTN","SD686PST",47,0)
 S LINE=LINE+1,^TMP($J,"SDEC",LINE)="Records in wait list file (#409.3) with imprecise dates (field #22)" ;
"RTN","SD686PST",48,0)
 S DA=0,FND=0 F I=1:1 S DA=$O(^SDWL(409.3,DA)) Q:'DA  W:I#1000=0 "." S X=$G(^(DA,0)) D  ;
"RTN","SD686PST",49,0)
 . I $P(X,"^",16)?5N1"00" S FND=1,LINE=LINE+1,^TMP($J,"SDEC",LINE)="Desired Date of Appointment (#22) incorrect in record "_DA ;
"RTN","SD686PST",50,0)
 ;
"RTN","SD686PST",51,0)
 I 'FND S LINE=LINE+1,^TMP($J,"SDEC",LINE)="NONE FOUND" ;
"RTN","SD686PST",52,0)
 E  S SENDMSG=1 ;
"RTN","SD686PST",53,0)
 S LINE=LINE+1,^TMP($J,"SDEC",LINE)=" " ;
"RTN","SD686PST",54,0)
 S LINE=LINE+1,^TMP($J,"SDEC",LINE)=" " ;
"RTN","SD686PST",55,0)
 ;
"RTN","SD686PST",56,0)
 ;  Check for bad dates in Appointment Request file (#409.85)
"RTN","SD686PST",57,0)
 ;
"RTN","SD686PST",58,0)
 W !,"Appointment Request..." ;
"RTN","SD686PST",59,0)
 S LINE=LINE+1,^TMP($J,"SDEC",LINE)="Records in appointment request file (#409.85) with imprecise dates" ;
"RTN","SD686PST",60,0)
 S DA=0,FND=0 F I=1:1 S DA=$O(^SDEC(409.85,DA)) Q:'DA  W:I#1000=0 "." S X=$G(^(DA,0)) D  ;
"RTN","SD686PST",61,0)
 . I $P(X,"^",16)?5N1"00" S FND=1,LINE=LINE+1,^TMP($J,"SDEC",LINE)="CID/Preferred Date of Appointment (#22) incorrect in record "_DA ;
"RTN","SD686PST",62,0)
 ;
"RTN","SD686PST",63,0)
 I 'FND S LINE=LINE+1,^TMP($J,"SDEC",LINE)="NONE FOUND" ;
"RTN","SD686PST",64,0)
 E  S SENDMSG=1 ;
"RTN","SD686PST",65,0)
 S LINE=LINE+1,^TMP($J,"SDEC",LINE)=" " ;
"RTN","SD686PST",66,0)
 S LINE=LINE+1,^TMP($J,"SDEC",LINE)=" " ;
"RTN","SD686PST",67,0)
 ;
"RTN","SD686PST",68,0)
 ;  Send e-mail message with database errors listed.
"RTN","SD686PST",69,0)
 ;
"RTN","SD686PST",70,0)
 I SENDMSG D  ;
"RTN","SD686PST",71,0)
 . ;
"RTN","SD686PST",72,0)
 . N XMTO ;
"RTN","SD686PST",73,0)
 . S XMTO(DUZ)="" ; ,XMTO("Outlook e-mail address")="" ;  <<== Tested with Outlook e-mail address (e.g., xxx.yyy@domain.ext).  Add e-mail address of Outlook group if needed. wtc 9/6/2019
"RTN","SD686PST",74,0)
 . D SENDMSG^XMXAPI(DUZ,"Patch #686 - Database errors","^TMP($J,""SDEC"")",.XMTO,,.XMZ) ;
"RTN","SD686PST",75,0)
 . ;
"RTN","SD686PST",76,0)
 . W !,"A MailMan message has been sent to you containing a list of the database errors found.  Please forward the message to your IRM representative.",! ;
"RTN","SD686PST",77,0)
 ;
"RTN","SD686PST",78,0)
 K ^TMP($J) ;
"RTN","SD686PST",79,0)
 Q  ;
"RTN","SD686PST",80,0)
 ;
"RTN","SD686PST",81,0)
AD ;build AD cross-reference for patient contacts
"RTN","SD686PST",82,0)
 W !,"Building AD cross-reference for SDEC CONTACT file (#409.86)..."
"RTN","SD686PST",83,0)
 I $D(^SDEC(409.86,"AD")) W !,"Cross-reference data already exists, aborting." Q
"RTN","SD686PST",84,0)
 N SDXREF
"RTN","SD686PST",85,0)
 S SDXREF=$O(^DD("IX","BB",409.86,"AD",""))
"RTN","SD686PST",86,0)
 I SDXREF="" W !,"Cross-reference definition missing, aborting." Q
"RTN","SD686PST",87,0)
 D INDEX^DIKC(409.86,"","",SDXREF,"KSW409.863")
"RTN","SD686PST",88,0)
 Q
"RTN","SD686PST",89,0)
 ;
"RTN","SDAM2")
0^16^B31042321^B30803018
"RTN","SDAM2",1,0)
SDAM2 ;ALB/MJK - Appt Mgt (cont) ;JAN 15, 2016
"RTN","SDAM2",2,0)
 ;;5.3;Scheduling;**250,296,327,478,446,627,686**;Aug 13, 1993;Build 53
"RTN","SDAM2",3,0)
 ;
"RTN","SDAM2",4,0)
CI ; -- protocol SDAM APPT CHECK IN entry pt
"RTN","SDAM2",5,0)
 ; input:  VALMY := array entries
"RTN","SDAM2",6,0)
 ;
"RTN","SDAM2",7,0)
 N %,SDI,SDAT,VALMY,SDAMCIDT,SDCIACT
"RTN","SDAM2",8,0)
 D SEL^VALM2 S SDI=0,SDCIACT=""
"RTN","SDAM2",9,0)
 D NOW^%DTC S SDAMCIDT=$P(%,".")_"."_$E($P(%,".",2)_"0000",1,4)
"RTN","SDAM2",10,0)
 F  S SDI=$O(VALMY(SDI)) Q:'SDI  I $D(^TMP("SDAMIDX",$J,SDI)) K SDAT D
"RTN","SDAM2",11,0)
 .S SDAT=^TMP("SDAMIDX",$J,SDI)
"RTN","SDAM2",12,0)
 .W !,^TMP("SDAM",$J,+SDAT,0)
"RTN","SDAM2",13,0)
 .D:VALMCC SELECT^VALM10(+SDAT,1)
"RTN","SDAM2",14,0)
 .D ONE($P(SDAT,U,2),$P(SDAT,U,4),$P(SDAT,U,3),$P(SDAT,U,5),0,SDAMCIDT)
"RTN","SDAM2",15,0)
 .D:VALMCC SELECT^VALM10(+SDAT,0)
"RTN","SDAM2",16,0)
 S VALMBCK=$S(VALMCC:"",1:"R")
"RTN","SDAM2",17,0)
 Q
"RTN","SDAM2",18,0)
 ;
"RTN","SDAM2",19,0)
ONE(DFN,SDCL,SDT,SDDA,SDASK,SDAMCIDT) ; -- check in one appt
"RTN","SDAM2",20,0)
 ; input:  DFN := ifn of patient
"RTN","SDAM2",21,0)
 ;        SDCL := clinic#
"RTN","SDAM2",22,0)
 ;         SDT := appt d/t
"RTN","SDAM2",23,0)
 ;        SDDA := ifn in ^SC multiple or null
"RTN","SDAM2",24,0)
 ;       SDASK := ask d/t of ci always [1|yes or 0|no]
"RTN","SDAM2",25,0)
 ;    SDAMCIDT := ci date/time [optional]
"RTN","SDAM2",26,0)
 ;
"RTN","SDAM2",27,0)
 I $D(XRTL) D T0^%ZOSV
"RTN","SDAM2",28,0)
 S:'SDDA SDDA=$$FIND(DFN,SDT,SDCL)
"RTN","SDAM2",29,0)
 I 'SDDA W !!,*7,"You cannot check in this appointment." D PAUSE^VALM1 G ONEQ
"RTN","SDAM2",30,0)
 N SDATA,SDCIHDL,X S SDATA=SDDA_U_DFN_U_SDT_U_SDCL,SDCIHDL=$$HANDLE^SDAMEVT(1)
"RTN","SDAM2",31,0)
 D BEFORE^SDAMEVT(.SDATA,DFN,SDT,SDCL,SDDA,SDCIHDL)
"RTN","SDAM2",32,0)
 I '$D(^SD(409.63,"ACI",1,+SDATA("BEFORE","STATUS"))) W !!,*7,"You cannot check in this appointment." D PAUSE^VALM1 G ONEQ
"RTN","SDAM2",33,0)
 ; *** mt blocking removed
"RTN","SDAM2",34,0)
 ;S X="EASMTCHK" X ^%ZOSF("TEST") I $T,$G(EASACT)'="W",$$MT^EASMTCHK(DFN,"","C",SDT) D PAUSE^VALM1 G ONEQ
"RTN","SDAM2",35,0)
 I $P(SDT,".")>DT W !!,*7,"It is too soon to check in this appointment." D PAUSE^VALM1 G ONEQ
"RTN","SDAM2",36,0)
 S:'$D(^SC(SDCL,"S",0)) ^(0)="^44.001DA^^"
"RTN","SDAM2",37,0)
 S DR="",X=$G(^SC(SDCL,"S",SDT,1,SDDA,"C"))
"RTN","SDAM2",38,0)
 I +X S DR=309
"RTN","SDAM2",39,0)
 ; -- already co'ed
"RTN","SDAM2",40,0)
 I DR="",$P(X,U,3) D
"RTN","SDAM2",41,0)
 .S DR="309//"
"RTN","SDAM2",42,0)
 .I $P(^SC(SDCL,0),U,24)!(SDASK) S DR=DR_$$FTIME^VALM1($P(X,U,3)) Q
"RTN","SDAM2",43,0)
 .S DR=DR_"//^S X="_$P(X,U,3)
"RTN","SDAM2",44,0)
 ;
"RTN","SDAM2",45,0)
 I DR="",$P(^SC(SDCL,0),U,24)!(SDASK) S DR="309//"_$S(SDAMCIDT:$$FTIME^VALM1(SDAMCIDT),1:"NOW")
"RTN","SDAM2",46,0)
 I DR="" S DR="309///"_$S(SDAMCIDT:"/"_SDAMCIDT,1:"NOW")
"RTN","SDAM2",47,0)
 S DA(2)=SDCL,DA(1)=SDT,DA=SDDA,DIE="^SC("_DA(2)_",""S"","_DA(1)_",1," D ^DIE
"RTN","SDAM2",48,0)
 ;update SDEC APPOINTMENT   ;alb/sat 627
"RTN","SDAM2",49,0)
 N SDECAPPT,SDECDT
"RTN","SDAM2",50,0)
 S SDECAPPT=$$APPTGET^SDECUTL(DFN,SDT,SDCL)
"RTN","SDAM2",51,0)
 S SDECDT=$$GET1^DIQ(44.003,SDDA_","_SDT_","_SDCL_",",309,"I")
"RTN","SDAM2",52,0)
 D SDECCHK^SDEC25(SDECAPPT,SDECDT)
"RTN","SDAM2",53,0)
 ;alb/sat 627 end addition/modification
"RTN","SDAM2",54,0)
 D AFTER^SDAMEVT(.SDATA,DFN,SDT,SDCL,SDDA,SDCIHDL)
"RTN","SDAM2",55,0)
 I '$P(SDATA("AFTER","STATUS"),U,4),'$P(SDATA("BEFORE","STATUS"),U,4) W !?8,*7,"...appointment has not been checked in" D PAUSE^VALM1
"RTN","SDAM2",56,0)
 I SDATA("BEFORE","STATUS")'=SDATA("AFTER","STATUS") D
"RTN","SDAM2",57,0)
 .I $P(SDATA("AFTER","STATUS"),U,4),'$P(SDATA("BEFORE","STATUS"),U,4) W !?8,"...checked in ",$$FTIME^VALM1($P(SDATA("AFTER","STATUS"),U,4))
"RTN","SDAM2",58,0)
 .I $D(SDCIACT) D
"RTN","SDAM2",59,0)
 ..S Y=SDATA("AFTER","STATUS"),Y1=$P(Y,U,4),Y=$P(Y,U,3)
"RTN","SDAM2",60,0)
 ..I $P(SDATA("BEFORE","STATUS"),U,3)'=Y D UPD($$LOWER^VALM1(Y),"STAT",+SDAT,1),UPD("","TIME",+SDAT,1)
"RTN","SDAM2",61,0)
 ..I $P(SDATA("AFTER","STATUS"),U,3)["CHECKED IN" D UPD($S($P(Y1,".")=DT:$$TIME^SDAM1($P(Y1,".",2)),1:"     "),"TIME",+SDAT,1)
"RTN","SDAM2",62,0)
 .D EVT^SDAMEVT(.SDATA,4,0,SDCIHDL) ; 4 := ci evt , 0 := interactive mode
"RTN","SDAM2",63,0)
 I $D(XRT0) S XRTN="SDAM2" D T1^%ZOSV
"RTN","SDAM2",64,0)
ONEQ K DA,DIE,DR,DQ,DE,Y,Y1 Q
"RTN","SDAM2",65,0)
 ;
"RTN","SDAM2",66,0)
 ;
"RTN","SDAM2",67,0)
FIND(DFN,SDT,SDCL) ; -- return appt ifn for pat
"RTN","SDAM2",68,0)
 ;   input:        DFN := ifn of pat.
"RTN","SDAM2",69,0)
 ;                 SDT := appt d/t
"RTN","SDAM2",70,0)
 ;                SDCL := ifn of clinic
"RTN","SDAM2",71,0)
 ;  output: [returned] := ifn if pat has appt on date/time
"RTN","SDAM2",72,0)
 ;
"RTN","SDAM2",73,0)
 N Y
"RTN","SDAM2",74,0)
 ;*zeb+1 686 3/14/19 reverse $O to fix handling of more than one cancelled appointment for a particular patient/time/clinic combo
"RTN","SDAM2",75,0)
 S Y=99999 F  S Y=$O(^SC(SDCL,"S",SDT,1,Y),-1) Q:'Y  I $D(^(Y,0)),DFN=+^(0),$D(^DPT(+DFN,"S",SDT,0)),$$VALID(DFN,SDCL,SDT,Y) S CNSTLNK=$P($G(^SC(SDCL,"S",SDT,1,Y,"CONS")),U) K:CNSTLNK="" CNSTLNK Q  ;SD/478
"RTN","SDAM2",76,0)
 Q Y
"RTN","SDAM2",77,0)
 ;
"RTN","SDAM2",78,0)
UPD(TEXT,FLD,LINE,SAVE) ; -- update data for screen
"RTN","SDAM2",79,0)
 D FLDTEXT^VALM10(LINE,FLD,TEXT)
"RTN","SDAM2",80,0)
 D:VALMCC CNTRL^VALM10(LINE,$P(VALMDDF(FLD),U,2),$P(VALMDDF(FLD),U,3),IOINHI,IOINORM,+$G(SAVE))
"RTN","SDAM2",81,0)
 Q
"RTN","SDAM2",82,0)
 ;
"RTN","SDAM2",83,0)
MAKE ; -- make appt action
"RTN","SDAM2",84,0)
 N ORACTION,ORVP,XQORQUIT,SDAMERR
"RTN","SDAM2",85,0)
 D FULL^VALM1
"RTN","SDAM2",86,0)
 W !!,VALMHDR(1)
"RTN","SDAM2",87,0)
 D ^SDM
"RTN","SDAM2",88,0)
 I '$D(SDAMERR) D BLD^SDAM
"RTN","SDAM2",89,0)
 I $D(SDAMERR) D PAUSE^VALM1
"RTN","SDAM2",90,0)
 D SDM^SDKILL S VALMBCK="R"
"RTN","SDAM2",91,0)
 Q
"RTN","SDAM2",92,0)
 ;
"RTN","SDAM2",93,0)
WI ; -- walk-in visit action
"RTN","SDAM2",94,0)
 S VALMBCK="R"
"RTN","SDAM2",95,0)
 D FULL^VALM1
"RTN","SDAM2",96,0)
 I SDAMTYP="P" I $$CL^SDAMWI(SDFN) D BLD^SDAM1
"RTN","SDAM2",97,0)
 I SDAMTYP="C" I $$PT^SDAMWI(SDCLN) D BLD^SDAM3
"RTN","SDAM2",98,0)
 ;evaluate wait list ;SD/327
"RTN","SDAM2",99,0)
EWLCHK ;check if patient has any open EWL entries (SD/372)
"RTN","SDAM2",100,0)
 ;CLN expected as clinic IEN
"RTN","SDAM2",101,0)
 I '$D(DFN) Q
"RTN","SDAM2",102,0)
 Q:'$D(SDT)
"RTN","SDAM2",103,0)
 K ^TMP($J,"SDAMA301"),^TMP($J,"APPT")
"RTN","SDAM2",104,0)
 N SD S SD=SDT
"RTN","SDAM2",105,0)
 I '$D(SC) S SC=+$G(CLN)
"RTN","SDAM2",106,0)
 ;
"RTN","SDAM2",107,0)
 K ^TMP($J,"SDAMA301"),^TMP($J,"APPT")
"RTN","SDAM2",108,0)
 W:$D(IOF) @IOF D APPT^SDWLEVAL(DFN,SD,SC)
"RTN","SDAM2",109,0)
 Q:'$D(^TMP($J,"APPT"))
"RTN","SDAM2",110,0)
 N SDEV D EN^SDWLEVAL(DFN,.SDEV) I SDEV,$L(SDEV(1))>0 D
"RTN","SDAM2",111,0)
 .K ^TMP("SDWLPL",$J),^TMP($J,"SDWLPL")
"RTN","SDAM2",112,0)
 .D INIT^SDWLPL(DFN,"M")
"RTN","SDAM2",113,0)
 .Q:'$D(^TMP($J,"SDWLPL"))
"RTN","SDAM2",114,0)
 .D LIST^SDWLPL("M",DFN)
"RTN","SDAM2",115,0)
 .F  Q:'$D(^TMP($J,"SDWLPL"))  N SDR D ANSW^SDWLEVAL(1,.SDR) I 'SDR D LIST^SDWLPL("M",DFN) D
"RTN","SDAM2",116,0)
 ..F  N SDR  D ANSW^SDWLEVAL(0,.SDR) Q:'$D(^TMP($J,"SDWLPL"))  I 'SDR W !,"MUST ENTER A REASON NOT TO DISPOSITION MATCHED EWL ENTRY",!
"RTN","SDAM2",117,0)
 I $D(^TMP($J,"APPT")) N SDEV D EN^SDWLEVAL(DFN,.SDEV) I SDEV,$L(SDEV(1))>0 D
"RTN","SDAM2",118,0)
 .Q:'$D(^TMP($J,"SDWLPL"))  D ASKREM^SDWLEVAL S SDCTN=1 ;display and process selected open EWL entries
"RTN","SDAM2",119,0)
 .Q
"RTN","SDAM2",120,0)
 Q
"RTN","SDAM2",121,0)
 ;
"RTN","SDAM2",122,0)
DATE ; -- change date range
"RTN","SDAM2",123,0)
 S VALMB=SDBEG D RANGE^VALM11
"RTN","SDAM2",124,0)
 I $S('VALMBEG:1,SDBEG'=VALMBEG:0,1:SDEND=VALMEND) W !!,"Date range was not changed." D PAUSE^VALM1 S VALMBCK="" G DATEQ
"RTN","SDAM2",125,0)
 S SDBEG=VALMBEG,SDEND=VALMEND
"RTN","SDAM2",126,0)
 I SDAMTYP="P" D BLD^SDAM1
"RTN","SDAM2",127,0)
 I SDAMTYP="C" D BLD^SDAM3
"RTN","SDAM2",128,0)
 S VALMBCK="R"
"RTN","SDAM2",129,0)
DATEQ K VALMB,VALMBEG,VALMEND Q
"RTN","SDAM2",130,0)
 ;
"RTN","SDAM2",131,0)
INP(DFN,VDATE) ; -- determine inpatient status ; dom is not an inpatient appt
"RTN","SDAM2",132,0)
 N SDINP,VAINDT,VADMVT
"RTN","SDAM2",133,0)
 S SDINP="",VAINDT=VDATE D ADM^VADPT2 G INPQ:'VADMVT
"RTN","SDAM2",134,0)
 I $P(^DG(43,1,0),U,21),$P($G(^DIC(42,+$P($G(^DGPM(VADMVT,0)),U,6),0)),U,3)="D" G INPQ
"RTN","SDAM2",135,0)
 S SDINP="I"
"RTN","SDAM2",136,0)
INPQ Q SDINP
"RTN","SDAM2",137,0)
 ;
"RTN","SDAM2",138,0)
VALID(DFN,SDCL,SDT,SDDA) ; -- return valid appt.
"RTN","SDAM2",139,0)
 ; **NOTE:  For speed consideration the ^SC and ^DPT nodes must be
"RTN","SDAM2",140,0)
 ;          check to see they exist prior to calling this entry point.
"RTN","SDAM2",141,0)
 ;   input:        DFN := ifn of pat.
"RTN","SDAM2",142,0)
 ;                 SDT := appt d/t
"RTN","SDAM2",143,0)
 ;                SDCL := ifn of clinic
"RTN","SDAM2",144,0)
 ;                SDDA := ifn of appt
"RTN","SDAM2",145,0)
 ;  output: [returned] := 1 for valid appt., 0 for not valid
"RTN","SDAM2",146,0)
 Q $S($P(^SC(SDCL,"S",SDT,1,SDDA,0),U,9)'="C":1,$P(^DPT(DFN,"S",SDT,0),U,2)["C":1,1:0)
"RTN","SDCNSLT")
0^9^B45406127^B41631358
"RTN","SDCNSLT",1,0)
SDCNSLT ;ALB/HAG - LINK APPOINTMENTS TO CONSULTS ;JAN 15, 2016
"RTN","SDCNSLT",2,0)
 ;;5.3;Scheduling;**478,496,630,627,686**;Aug 13, 1993;Build 53
"RTN","SDCNSLT",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified
"RTN","SDCNSLT",4,0)
A ;===GET ACTIVE AND PENDING CONSULT
"RTN","SDCNSLT",5,0)
 N A,ND,CNT,CONS,CPRSTAT,DTENTR,DTIN,DTLMT,DTR,NOS,NOSHOW,SENDER,SERVICE,SRV,P8,PROC,PT,PTNM,STATUS
"RTN","SDCNSLT",6,0)
 K TMP S NOSHOW="no-show",CNT=0,$P(DSH,"-",IOM-1)="",PT=DFN,X1=DT,X2=-365 D C^%DTC S DTLMT=X
"RTN","SDCNSLT",7,0)
 S A=":" F  S A=$O(^GMR(123,"F",PT,A),-1) Q:'+A  S ND=$G(^GMR(123,A,0)) Q:ND=""  S PROC=$P($G(^GMR(123,A,1.11)),U),DTENTR=$P(ND,U) I DTENTR>DTLMT S CPRSTAT=$P(ND,U,12) D:CPRSTAT=5!(CPRSTAT=6)!(CPRSTAT=8)!(CPRSTAT=13)
"RTN","SDCNSLT",8,0)
 .Q:$D(^XTMP("SDECLKC-"_A))  ;do not display consult if locked by VS GUI  ;alb/sat 627
"RTN","SDCNSLT",9,0)
 .I STPCOD'="" S SRV=$P(ND,U,5) Q:'+SRV  I $D(^GMR(123.5,"AB1",STPCOD,SRV)) S PTIEN=$P(ND,U,2) D
"RTN","SDCNSLT",10,0)
 ..I CPRSTAT=8 S SHOW=0 Q:$D(^SC("AWAS1",A))  S NOS=$O(^GMR(123,A,40,":"),-1) Q:'+NOS  S X2=$P($G(^GMR(123,A,40,NOS,0)),U),X1=DT D ^%DTC Q:X'=""&(X>180)  D SCHED(PTIEN,STPCOD,.SHOW) Q:'SHOW
"RTN","SDCNSLT",11,0)
 ..;CPRSTAT 13 is a cancel
"RTN","SDCNSLT",12,0)
 ..I CPRSTAT=13 S NOS=$O(^GMR(123,A,40,":"),-1) Q:'+NOS  S NOS=$O(^GMR(123,A,40,NOS),-1) Q:'+NOS  S X2=$P($G(^GMR(123,A,40,NOS,0)),U),X1=DT D ^%DTC Q:X'=""&(X>180)  S COMMENT=$G(^GMR(123,A,40,NOS,1,1,0)) Q:COMMENT'[NOSHOW
"RTN","SDCNSLT",13,0)
 ..S:+PTIEN PTNM=$P(^DPT(PTIEN,0),U) S SERVICE=$P(^GMR(123.5,SRV,0),U),STATUS=$P(^ORD(100.01,CPRSTAT,0),U),SENDER=$P(ND,U,14) S:+SENDER SENDER=$P(^VA(200,SENDER,0),U)
"RTN","SDCNSLT",14,0)
 ..S Y=DTENTR D DD^%DT S DTIN=Y,DTR=$E(DTENTR,4,5)_"/"_$E(DTENTR,6,7)_"/"_$E(DTENTR,2,3)_"@"_$P(Y,"@",2)
"RTN","SDCNSLT",15,0)
 ..S CNT=CNT+1,TMP(CNT)=PTIEN_U_SERVICE_U_SENDER_U_STATUS_U_DTR_U_A_U_DTIN_U_$P(ND,U,17)_U_PROC
"RTN","SDCNSLT",16,0)
 Q:'$D(TMP)
"RTN","SDCNSLT",17,0)
QST N DIR,DTOUT,DUOUT,CNSULT
"RTN","SDCNSLT",18,0)
 S DIR(0)="Y",DIR("A")="Will this appointment be for a CONSULT/PROCEDURE",DIR("B")="YES",DIR("?")="Answer 'Y'es if appointment is for a Consult or Procedure." W ! D ^DIR S CNSULT=Y
"RTN","SDCNSLT",19,0)
 I CNSULT[U!(CNSULT=0)!(CNSULT="") K TMP Q
"RTN","SDCNSLT",20,0)
HDR W !!,"Please select from the list of consult(s), press 0 for none.",! ;LLS 05-JAN-2015 SD*5.3*630
"RTN","SDCNSLT",21,0)
 W !,PTNM,!!,"# Service",?68,"Cons #",!,DSH ;LLS 05-JAN-2015 SD*5.3*630
"RTN","SDCNSLT",22,0)
 S A=0 F  S A=$O(TMP(A)) Q:'+A  S ND=TMP(A),P8=$P(ND,U,8) D  ;LLS 05-JAN-2015 SD*5.3*630
"RTN","SDCNSLT",23,0)
 . W !,A,".",?3,$S(P8="P":$E($P(ND,U,9),1,63),1:$E($P(ND,U,2),1,63)),?68,$P(ND,U,6) W !,?4,"Request DT: ",$E($P(ND,U,5),1,14),?31,"FROM: ",$E($P(ND,U,3),1,33),?71,"TYPE: ",$S(P8="P":"P",P8="C":"C",1:"") ;LLS 05-JAN-2015 SD*5.3*630
"RTN","SDCNSLT",24,0)
 W !
"RTN","SDCNSLT",25,0)
READ R !,"Select Consult: ",CONS:DTIME G:CONS="" A
"RTN","SDCNSLT",26,0)
 I CONS=0!(CONS[U) W " ... NONE." K TMP Q
"RTN","SDCNSLT",27,0)
 I "? "[CONS W !," Select consult by number on the left side." G READ
"RTN","SDCNSLT",28,0)
 I '$D(TMP(CONS)) W *7," ?? Select consult by number on the left side." G READ
"RTN","SDCNSLT",29,0)
 S CNSLTLNK=$P(TMP(CONS),U,6)
"RTN","SDCNSLT",30,0)
 Q
"RTN","SDCNSLT",31,0)
SCHED(PTIEN,STPCOD,SHOW) ;===CONSULT IS SCHEDULE NOW CHECK IF IT HAS APPOINTMENT BY STOP CODE.
"RTN","SDCNSLT",32,0)
 N APT,CLNC,B,S1,S2,S3,S4,STOP,STOPCOD,X,Y
"RTN","SDCNSLT",33,0)
 S %DT="ST",X="T-1" D ^%DT S APT=Y,S1=0,STOP=0 F  S APT=$O(^DPT(PTIEN,"S",APT)) Q:'+APT!(STOP)  S S1=1,CLNC=$P(^DPT(PTIEN,"S",APT,0),U) I CLNC'="" S STOPCOD=$P(^SC(CLNC,0),U,7) I STOPCOD'="" S S2=0 I STOPCOD=STPCOD S S2=1 D
"RTN","SDCNSLT",34,0)
 .S S3=0,S4=0,B=0 F  S B=$O(^SC(CLNC,"S",APT,1,B)) Q:'+B!(STOP)  S S3=1 D
"RTN","SDCNSLT",35,0)
 ..I ($P($G(^SC(CLNC,"S",APT,1,B,0)),U)=PTIEN) S S4=1,STOP=1,SHOW=0
"RTN","SDCNSLT",36,0)
 I S1=0 S SHOW=1 Q  ;show if no appointment in the patient side
"RTN","SDCNSLT",37,0)
 I S2=0 S SHOW=1 Q  ;show if stop code does not match
"RTN","SDCNSLT",38,0)
 I S3=0 S SHOW=1 Q  ;show if no appointment in the clinic
"RTN","SDCNSLT",39,0)
 I S4=0 S SHOW=1 Q  ;show if patient does not match in appointment
"RTN","SDCNSLT",40,0)
 Q
"RTN","SDCNSLT",41,0)
LINK(SC,SDY,SD,CNSLTLNK) ;===LINK APPOINTMENT TO CONSULT
"RTN","SDCNSLT",42,0)
 N DA,DIE,DR,TDA,X
"RTN","SDCNSLT",43,0)
 S TDA=SDY,DA(2)=SC,DA(1)=SD,DA=TDA,DIE="^SC("_DA(2)_",""S"","_DA(1)_",1,",DR="688////^S X=CNSLTLNK" D ^DIE
"RTN","SDCNSLT",44,0)
 Q
"RTN","SDCNSLT",45,0)
EDITCS(SD,TMPD,TMPYCLNC,CNSLTLNK) ;===MARK CONSULT AS SCHEDULED
"RTN","SDCNSLT",46,0)
 N CSCHDT,SNDPRV,TME,X,Y,COMMENT,ER
"RTN","SDCNSLT",47,0)
 S %DT="ST",X="NOW" D ^%DT S CSCHDT=Y
"RTN","SDCNSLT",48,0)
 S SNDPRV=$P($G(^GMR(123,CNSLTLNK,0)),U,14),Y=SD D DD^%DT S TME=$P($P(Y,"@",2),":",1,2)
"RTN","SDCNSLT",49,0)
 S COMMENT(1)=$P(TMPYCLNC,U,2)_" Consult Appt. on "_$E(SD,4,5)_"/"_$E(SD,6,7)_"/"_$E(SD,2,3)_" @ "_TME
"RTN","SDCNSLT",50,0)
 S COMMENT(2)=TMPD
"RTN","SDCNSLT",51,0)
 D SCH^SDQQCN2(.ER,CNSLTLNK,SNDPRV,CSCHDT,0,,.COMMENT) K COMMENT
"RTN","SDCNSLT",52,0)
 Q
"RTN","SDCNSLT",53,0)
SDECCAN(SCLNK,SCSNOD,SDTTM,SDSC,SDWH,SDPL,SDECNOTE) ; patch 686 wtc/zeb 3.21.18 cancel consult appointment.  called from SDEC07A.
"RTN","SDCNSLT",54,0)
 S SNDPRV=$P($G(^GMR(123,SCLNK,0)),U,14) ;
"RTN","SDCNSLT",55,0)
 ;
"RTN","SDCNSLT",56,0)
CANCEL ;===appt was cancelled then mark consult as edit/resubmit, add comment.
"RTN","SDCNSLT",57,0)
 N APPT,CONSULT,CPRSSTAT,ER,GM40,GMRND,SDPATNT,USER,SNDPRV,J
"RTN","SDCNSLT",58,0)
 ;Variables CNDIE, CNDA and CNINDX used in calling routine for Cancel letter printed comment in consult.
"RTN","SDCNSLT",59,0)
 ;TMPD is assumed by the existing code
"RTN","SDCNSLT",60,0)
 S:$D(SDECNOTE) TMPD=SDECNOTE_$S($D(TMPD):"; ",1:"")_$G(TMPD) ;*zeb 686 10/30/18 keep cancel comment from GUI
"RTN","SDCNSLT",61,0)
 S:$D(SCLNK) CONSULT=SCLNK
"RTN","SDCNSLT",62,0)
 S:'$D(SCLNK) CONSULT=$P($G(^SC(SDSC,"S",SDTTM,1,SDPL,"CONS")),U)
"RTN","SDCNSLT",63,0)
 Q:'+CONSULT
"RTN","SDCNSLT",64,0)
 S:$D(SCSNOD) SDPATNT=$P(SCSNOD,U)
"RTN","SDCNSLT",65,0)
 S:'$D(SCSNOD) SDPATNT=$P($G(^SC(SDSC,"S",SDTTM,1,SDPL,0)),U)
"RTN","SDCNSLT",66,0)
 S CPRSSTAT=$P($G(^GMR(123,CONSULT,0)),U,12) I CPRSSTAT'="" S CPRSSTAT=$P($G(^ORD(100.01,CPRSSTAT,0)),U) Q:CPRSSTAT'="SCHEDULED"
"RTN","SDCNSLT",67,0)
 S SNDPRV=$P($G(^GMR(123,CONSULT,0)),U,14)
"RTN","SDCNSLT",68,0)
 S USER=$P(^VA(200,DUZ,0),U),Y=SDTTM D DD^%DT S APPT=$E(SDTTM,4,5)_"/"_$E(SDTTM,6,7)_"/"_$E(SDTTM,2,3)_" @ "_$P(Y,"@",2)
"RTN","SDCNSLT",69,0)
 S COMMENT(1)=$P(^SC(SDSC,0),U)_" Appt. on "_APPT_" was cancelled"_$S($D(SDWH):$S(SDWH["P":" by the Patient.",SDWH["C":" by the Clinic.",1:"."),$D(SDADM):" for administrative purposes.",1:", whole clinic.")
"RTN","SDCNSLT",70,0)
 S CNINDX=2 S:$D(TMPD) COMMENT(2)="Remarks: "_TMPD,CNINDX=CNINDX+1 K TMPD,SDECNOTE ;*zeb 686 10/30/18 clean up SDECNOTE in case SDECCAN not used
"RTN","SDCNSLT",71,0)
 N SDERR S SDERR=$$STATUS^GMRCGUIS(CONSULT,6,3,SNDPRV,"","",.COMMENT)
"RTN","SDCNSLT",72,0)
 S CNDIE="^GMR(123,"_CONSULT_",40,",CNDA=+$G(COMMENT(0))
"RTN","SDCNSLT",73,0)
 K COMMENT,DA
"RTN","SDCNSLT",74,0)
 S AUTO(SDSC,SDTTM,SDPATNT)=CONSULT
"RTN","SDCNSLT",75,0)
 S DA(2)=SDSC,DA(1)=SDTTM,DA=SDPL,DIE="^SC("_DA(2)_",""S"","_DA(1)_",1,",DR="688///@" D ^DIE
"RTN","SDCNSLT",76,0)
 K SCSNOD,SDADM,SCLNK
"RTN","SDCNSLT",77,0)
 Q
"RTN","SDCNSLT",78,0)
AUTOREB(SC,NDATE,LNK,CY) ;===AUTO REBOOK
"RTN","SDCNSLT",79,0)
 N DIC,DA,DIE,DR,Y,TME,SNDPRV,CSCHDT,COMMENT,ER
"RTN","SDCNSLT",80,0)
 S DA(2)=SC,DA(1)=NDATE,DA=CY,DIE="^SC("_DA(2)_",""S"","_DA(1)_",1,",DR="688////^S X=LNK" D ^DIE
"RTN","SDCNSLT",81,0)
 S Y=NDATE D DD^%DT S TME=$P(Y,"@",2)
"RTN","SDCNSLT",82,0)
 S COMMENT(1)=$P(^SC(SC,0),U)_" Consult Appt. on "_$E(NDATE,4,5)_"/"_$E(NDATE,6,7)_"/"_$E(NDATE,2,3)_" @ "_TME_" (Auto Rebooked)."
"RTN","SDCNSLT",83,0)
 S %DT="ST",X="NOW" D ^%DT S CSCHDT=Y
"RTN","SDCNSLT",84,0)
 S SNDPRV=$P($G(^GMR(123,LNK,0)),U,14)
"RTN","SDCNSLT",85,0)
 D SCH^SDQQCN2(.ER,LNK,SNDPRV,CSCHDT,0,,.COMMENT) K COMMENT
"RTN","SDCNSLT",86,0)
 Q
"RTN","SDCNSLT",87,0)
NOSHOW(SC,SDDTM,CNPAT,CNSTLNK,CN,AUTO,NSDIE,NSDA) ;
"RTN","SDCNSLT",88,0)
 ;Appt. was a NoShow, then mark Consult as Edit/Resubmit, add comment using silent call to notify user.
"RTN","SDCNSLT",89,0)
 ;Variables NSDIE and NSDA used in calling routine for NoShow letter printed comment in consult.
"RTN","SDCNSLT",90,0)
 N CSNOD,CPRSSTAT,NOSHOW,CSRQSRV,TPRNT,CSPRT,USER,Y,APPT,COMMENT,DA,DIC,DUZ2,DIC,DR,GM40,GMRND,ER,SNDPRV,J
"RTN","SDCNSLT",91,0)
 S CSNOD=$G(^GMR(123,CNSTLNK,0)),CPRSSTAT=$P(CSNOD,U,12),SNDPRV=$P(CSNOD,U,14),NOSHOW="no-show",AUTO(SC,SDDTM,CNPAT)=CNSTLNK
"RTN","SDCNSLT",92,0)
 I CPRSSTAT'="" S CPRSSTAT=$P($G(^ORD(100.01,CPRSSTAT,0)),U) Q:CPRSSTAT'="SCHEDULED"
"RTN","SDCNSLT",93,0)
 S CSRQSRV=$P(CSNOD,U,5) I CSRQSRV'="" S TPRNT=$P($G(^GMR(123.5,CSRQSRV,123)),U,9) I TPRNT'="" S:$P($G(^%ZIS(1,TPRNT,0)),U)'="" CSPRT=$P(^(0),U) ;reprint consult
"RTN","SDCNSLT",94,0)
 S USER=$P(^VA(200,DUZ,0),U),Y=SDDTM D DD^%DT S APPT=$E(SDDTM,4,5)_"/"_$E(SDDTM,6,7)_"/"_$E(SDDTM,2,3)_" @ "_$P(Y,"@",2)
"RTN","SDCNSLT",95,0)
 S COMMENT(1)=$P(^SC(SC,0),U)_" Appt. on "_APPT_" was a "_NOSHOW_"." ;no-show is a key word used by a search do not change
"RTN","SDCNSLT",96,0)
 N SDERR S SDERR=$$STATUS^GMRCGUIS(CNSTLNK,6,3,SNDPRV,"","",.COMMENT)
"RTN","SDCNSLT",97,0)
 S NSDIE="^GMR(123,"_CNSTLNK_",40,",NSDA=+$G(COMMENT(0))
"RTN","SDCNSLT",98,0)
 K COMMENT,DA
"RTN","SDCNSLT",99,0)
 S DA(2)=SC,DA(1)=SDDTM,DA=CN,DIE="^SC("_DA(2)_",""S"","_DA(1)_",1,",DR="688///@" D ^DIE
"RTN","SDCNSLT",100,0)
 I $D(CSPRT) D EN^GMRCP5(CNSTLNK,"C",CSPRT)
"RTN","SDCNSLT",101,0)
 K CNSTLNK Q
"RTN","SDEC")
0^3^B133133924^B133133924
"RTN","SDEC",1,0)
SDEC ;ALB/SAT - VISTA SCHEDULING RPCS ;MAR 15, 2017
"RTN","SDEC",2,0)
 ;;5.3;Scheduling;**627,643,642,651,658,665,672,679,686**;Aug 13, 1993;Build 53
"RTN","SDEC",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified
"RTN","SDEC",4,0)
 Q
"RTN","SDEC",5,0)
 ;
"RTN","SDEC",6,0)
ACCGROUP(SDECY) ;EP return active entries from the SDEC ACCESS GROUP file 409.822
"RTN","SDEC",7,0)
 D ACCGROUP^SDEC45(.SDECY) Q
"RTN","SDEC",8,0)
ACCGPTYG(SDECY) ;EP Get access group types
"RTN","SDEC",9,0)
 D ACCGPTYG^SDEC15(.SDECY) Q
"RTN","SDEC",10,0)
ACCTYPE(SDECY) ;EP return active entries from the SDEC ACCESS TYPE file 409.823
"RTN","SDEC",11,0)
 D ACCTYPE^SDEC45(.SDECY) Q
"RTN","SDEC",12,0)
ADDACCG(SDECY,SDECVAL) ;EP ADD/EDIT ACCESS GROUP
"RTN","SDEC",13,0)
 D ADDACCG^SDEC21(.SDECY,$G(SDECVAL)) Q
"RTN","SDEC",14,0)
ADDACCTY(SDECY,SDECVAL) ;EP ADD/EDIT ACCESS TYPE
"RTN","SDEC",15,0)
 D ADDACCTY^SDEC14(.SDECY,$G(SDECVAL)) Q
"RTN","SDEC",16,0)
ADDAGI(SDECY,SDECIEN,SDECIEN1) ;EP Add access group item - Adds ACCESS GROUP TYPE file entry
"RTN","SDEC",17,0)
 D ADDAGI^SDEC22(.SDECY,$G(SDECIEN),$G(SDECIEN1)) Q
"RTN","SDEC",18,0)
ADDRES(SDECY,SDECVAL) ;EP ADD/EDIT RESOURCE
"RTN","SDEC",19,0)
 D ADDRES^SDEC16(.SDECY,$G(SDECVAL)) Q
"RTN","SDEC",20,0)
ADDRESU(SDECY,SDECVAL) ;EP ADD/EDIT RESOURCE USER
"RTN","SDEC",21,0)
 D ADDRESU^SDEC18(.SDECY,$G(SDECVAL)) Q
"RTN","SDEC",22,0)
ADDRG(SDECY,SDECVAL) ;EP ADD/EDIT RESOURCE GROUP
"RTN","SDEC",23,0)
 D ADDRG^SDEC19(.SDECY,$G(SDECVAL)) Q
"RTN","SDEC",24,0)
ADDRGI(SDECY,SDECIEN,SDECIEN1) ;EP Adds RESOURCEID SDECIEN1 to RESOURCE GROUP entry SDECIEN
"RTN","SDEC",25,0)
 D ADDRGI^SDEC20(.SDECY,$G(SDECIEN),$G(SDECIEN1)) Q
"RTN","SDEC",26,0)
APBLKALL(SDECY,SDECSTART,SDECEND) ;EP List of all appointments for all resources
"RTN","SDEC",27,0)
 D APBLKALL^SDEC05(.SDECY,$G(SDECSTART),$G(SDECEND)) Q
"RTN","SDEC",28,0)
APBLKOV(SDECY,SDECSTART,SDECEND,SDECRES,SDECWI) ;EP APPT BLOCKS OVERLAP
"RTN","SDEC",29,0)
 D APBLKOV^SDEC05(.SDECY,$G(SDECSTART),$G(SDECEND),$G(SDECRES),$G(SDECWI)) Q
"RTN","SDEC",30,0)
APPADD ;EP ADD NEW APPOINTMENT
"RTN","SDEC",31,0)
 Q  ;rpc calls directly to APPADD^SDEC07
"RTN","SDEC",32,0)
APPDEL(SDECY,SDECAPTID,SDECTYP,SDECCR,SDECNOT,SDECDATE,SDUSER) ;EP Cancels appointment
"RTN","SDEC",33,0)
 D APPDEL^SDEC08(.SDECY,$G(SDECAPTID),$G(SDECTYP),$G(SDECCR),$G(SDECNOT),$G(SDECDATE),$G(SDUSER)) Q
"RTN","SDEC",34,0)
APPIDGET(SDECY,SDID) ;GET SDEC APPOINTMENT ien for given External ID
"RTN","SDEC",35,0)
 D APPIDGET^SDEC55(.SDECY,$G(SDID)) Q
"RTN","SDEC",36,0)
APPSDGET(SDECY,MAXREC,LASTSUB,SDBEG,SDEND,NOTEFLG,SDRES,DFN,SDID,SDIEN) ;GET appointment data from SDEC APPOINTMENT file 409.84
"RTN","SDEC",37,0)
 D APPSDGET^SDEC55A(.SDECY,$G(MAXREC),$G(LASTSUB),$G(SDBEG),$G(SDEND),$G(NOTEFLG),$G(SDRES),$G(DFN),$G(SDID),$G(SDIEN)) Q
"RTN","SDEC",38,0)
APPSLOTS(SDECY,SDCL,SDBEG,SDEND) ;return array of appt slots and availability - RPC
"RTN","SDEC",39,0)
 D APPSLOTS^SDEC57(.SDECY,$G(SDCL),$G(SDBEG),$G(SDEND)) Q
"RTN","SDEC",40,0)
APPTEVLG(SDECY,DFN) ;EP return appointment data for given patient - RPC
"RTN","SDEC",41,0)
 D APPTEVLG^SDEC38(.SDECY,$G(DFN)) Q
"RTN","SDEC",42,0)
APPTLETR(SDECY,SDECAPID,LT) ;EP Print Appointment Letter
"RTN","SDEC",43,0)
 D APPTLETR^SDEC40(.SDECY,$G(SDECAPID),$G(LT)) Q
"RTN","SDEC",44,0)
APPTYPES(RET,DFN) ; EP for SDEC APPTYPES - Return all active Appointment types from the APPOINTMENT TYPE file 409.1
"RTN","SDEC",45,0)
 D APPTYPES^SDECWL(.RET,$G(DFN)) Q
"RTN","SDEC",46,0)
ARCLOSE(RET,INP...) ;
"RTN","SDEC",47,0)
 D ARCLOSE^SDECAR(.RET,.INP) Q
"RTN","SDEC",48,0)
ARCLOSE1(RET,INP) ; Appt Request CLOSE  (without ... for VistA calls)
"RTN","SDEC",49,0)
 D ARCLOSE^SDECAR(.RET,.INP) Q
"RTN","SDEC",50,0)
ARDGET(SDECY) ;get values for disposition field of SDEC APPT REQUEST file
"RTN","SDEC",51,0)
 D ARDGET^SDECAR(.SDECY) Q
"RTN","SDEC",52,0)
ARGET(RET,ARIEN1,MAXREC,SDBEG,SDEND,DFN,LASTSUB,SDTOP,SVCL,DESDT,PRL,SVCR,SCVISIT,CLINIC,ORIGDT) ;EP Appt Request GET
"RTN","SDEC",53,0)
 D ARGET^SDECAR1(.RET,$G(ARIEN1),$G(MAXREC),$G(SDBEG),$G(SDEND),$G(DFN),$G(LASTSUB),$G(SDTOP),$G(SVCL),$G(DESDT),$G(PRL),$G(SVCR),$G(SCVISIT),$G(CLINIC),$G(ORIGDT)) Q
"RTN","SDEC",54,0)
ARMRTGET(SDECY,ARIEN) ;GET number of entries and values in MRTC CALC PREF DATES
"RTN","SDEC",55,0)
 D ARMRTGET^SDECAR(.SDECY,$G(ARIEN)) Q
"RTN","SDEC",56,0)
ARMRTSET(SDECY,ARIEN,MRTC) ;SET MRTC CALC PREF DATES dates - clears the multiple and sets the new ones that are passed in
"RTN","SDEC",57,0)
 D ARMRTSET^SDECAR(.SDECY,$G(ARIEN),$G(MRTC)) Q
"RTN","SDEC",58,0)
AROPEN(RET,ARAPP,ARIEN,ARDDT) ;Appt Request Open/re-open
"RTN","SDEC",59,0)
 D AROPEN^SDECAR(.RET,$G(ARAPP),$G(ARIEN),$G(ARDDT)) Q
"RTN","SDEC",60,0)
ARPCSET(SDECY,INP,ARIEN) ;SET update patient contacts in SDEC APPT REQUEST file
"RTN","SDEC",61,0)
 D ARPCSET^SDECAR(.SDECY,$G(INP),$G(ARIEN)) Q
"RTN","SDEC",62,0)
ARSET(RET,INP...) ;EP Appt Request Set
"RTN","SDEC",63,0)
 D ARSET^SDECAR2(.RET,.INP) Q
"RTN","SDEC",64,0)
ARSET1(RET,INP) ;EP Appt Request Set (without ... for VistA calls)
"RTN","SDEC",65,0)
 D ARSET^SDECAR2(.RET,.INP) Q
"RTN","SDEC",66,0)
AVADD(SDECY,SDECSTART,SDECEND,SDECTYPID,SDECRES,SDECSLOTS,SDECNOTE) ;EP SET Create entry in SDEC ACCESS BLOCK
"RTN","SDEC",67,0)
 D AVADD^SDEC12(.SDECY,$G(SDECSTART),$G(SDECEND),$G(SDECTYPID),$G(SDECRES),$G(SDECSLOTS),$G(SDECNOTE)) Q
"RTN","SDEC",68,0)
AVDEL(SDECY,SDECAVID) ;EP Cancel Availability - Deletes Access Block
"RTN","SDEC",69,0)
 D AVDEL^SDEC13(.SDECY,$G(SDECAVID)) Q
"RTN","SDEC",70,0)
AVDELDT(SDECY,SDECRESD,SDECSTART,SDECEND) ;EP Cancel availability in a date range
"RTN","SDEC",71,0)
 D AVDELDT^SDEC13(.SDECY,$G(SDECRESD),$G(SDECSTART),$G(SDECEND)) Q
"RTN","SDEC",72,0)
BOOKHLDY(SDECY,SDECCL) ;  Returns can book on holiday flag for a clinic.  12/1/17 wtc  679 
"RTN","SDEC",73,0)
 D BOOKHLDY^SDEC32(.SDECY,SDECCL) Q  ;
"RTN","SDEC",74,0)
CANCKOUT(SDECY,SDECAPTID) ;EP Cancel Check Out appointment
"RTN","SDEC",75,0)
 D CANCKOUT^SDEC25(.SDECY,$G(SDECAPTID)) Q
"RTN","SDEC",76,0)
CANREAS(SDECY,SDECIN) ;EP return active/inactive entries from the CANCELLATION REASONS table 409.2
"RTN","SDEC",77,0)
 D CANREAS^SDEC45(.SDECY,$G(SDECIN)) Q
"RTN","SDEC",78,0)
CAP(SDECY,DFN,SDAMEVT,SDT,DVBADA,SDAUTORB,SDCANVET) ;
"RTN","SDEC",79,0)
 D CAP^SDEC58(.SDECY,$G(DFN),$G(SDAMEVT),$G(SDT),$G(DVBADA),$G(SDAUTORB),$G(SDCANVET)) Q
"RTN","SDEC",80,0)
CGET(SDECY) ;GET active Countries from the COUNTRY CODE file 779.004
"RTN","SDEC",81,0)
 D CGET^SDEC55(.SDECY) Q
"RTN","SDEC",82,0)
CHECKIN(SDECY,SDECAPTID,SDECCDT,SDECCC,SDECPRV,SDECROU,SDECVCL,SDECVFM,SDECOG,SDECCR,SDECPCC,SDECWHF) ;EP Check in appointment
"RTN","SDEC",83,0)
 D CHECKIN^SDEC25(.SDECY,$G(SDECAPTID),$G(SDECCDT),$G(SDECCC),$G(SDECPRV),$G(SDECROU),$G(SDECVCL),$G(SDECVFM),$G(SDECOG),$G(SDECCR),$G(SDECPCC),$G(SDECWHF)) Q
"RTN","SDEC",84,0)
CHECKOUT(SDECY,DFN,SDT,SDCODT,SDECAPTID,VPRV) ;EP Check Out appointment
"RTN","SDEC",85,0)
 D CHECKOUT^SDEC25(.SDECY,$G(DFN),$G(SDT),$G(SDCODT),$G(SDECAPTID),$G(VPRV)) Q
"RTN","SDEC",86,0)
CLINALL(RET,MAXREC,SDECP) ; EP Return the IEN and NAME for all entries in the SD WL CLINIC LOCATION file
"RTN","SDEC",87,0)
 D CLINALL^SDECWL(.RET,$G(MAXREC),$G(SDECP)) Q
"RTN","SDEC",88,0)
CLINCAN(SDECY,SDECCLST,SDECBEG,SDECEND) ;EP Return recordset of CANCELLED patient appointments
"RTN","SDEC",89,0)
 D CLINCAN^SDEC34(.SDECY,$G(SDECCLST),$G(SDECBEG),$G(SDECEND)) Q
"RTN","SDEC",90,0)
CLINDIS(SDECY,SDECCLST,SDECBEG,SDECEND,SDECWI) ;EP Return formatted text output of the Clinic Schedules Report
"RTN","SDEC",91,0)
 D CLINDIS^SDEC47(.SDECY,$G(SDECCLST),$G(SDECBEG),$G(SDECEND),$G(SDECWI)) Q
"RTN","SDEC",92,0)
CLINDISW(SDECY,SDECCLST,SDECBEG,SDECEND) ;EP Return formatted text output of the Clinic Schedules Report for Walkins
"RTN","SDEC",93,0)
 D CLINDISW^SDEC47(.SDECY,$G(SDECCLST),$G(SDECBEG),$G(SDECEND)) Q
"RTN","SDEC",94,0)
CLINLET(SDECY,SDECCLST,SDECBEG,SDECEND,SDECWI) ;EP CLINIC LETTERS Appointment data
"RTN","SDEC",95,0)
 D CLINLET^SDEC27(.SDECY,$G(SDECCLST),$G(SDECBEG),$G(SDECEND),$G(SDECWI)) Q
"RTN","SDEC",96,0)
CLINLETW(SDECY,SDECCLST,SDECBEG,SDECEND) ;EP CLINIC LETTERS WALK-IN Appointment data for Walk-in Appointments only
"RTN","SDEC",97,0)
 D CLINLETW^SDEC27(.SDECY,$G(SDECCLST),$G(SDECBEG),$G(SDECEND)) Q
"RTN","SDEC",98,0)
CLINPROV(SDECY,SDECCL) ;EP return all providers for a given clinic from the HOSPITAL LOCATION file 44
"RTN","SDEC",99,0)
 D CLINPROV^SDEC45(.SDECY,$G(SDECCL)) Q
"RTN","SDEC",100,0)
CLINSET(SDECY,SDNOSLOT,SDIENS,SDECP,SDNOLET,MAXREC) ;EP Returns CLINIC SETUP PARAMETERS for clinics that are active in the HOSPITAL LOCATION file
"RTN","SDEC",101,0)
 D CLINSET^SDEC32(.SDECY,$G(SDNOSLOT),$G(SDIENS),$G(SDECP),$G(SDNOLET),$G(MAXREC)) Q
"RTN","SDEC",102,0)
CLINSTOP(SDECY,SDP) ;EP CLINIC STOP remote procedure
"RTN","SDEC",103,0)
 D CLINSTOP^SDEC45(.SDECY,$G(SDP)) Q
"RTN","SDEC",104,0)
COPYAPPT(SDECY,SDECRES,SDEC44,SDECBEG,SDECEND) ;EP Copy appointments from HOSPITAL LOCATION to SDEC RESOURCE
"RTN","SDEC",105,0)
 D COPYAPPT^SDEC29(.SDECY,$G(SDECRES),$G(SDEC44),$G(SDECBEG),$G(SDECEND)) Q
"RTN","SDEC",106,0)
CPCANC(SDECY,SDECTSK) ;EP Copy Appointment Cancel
"RTN","SDEC",107,0)
 D CPCANC^SDEC29(.SDECY,$G(SDECTSK)) Q
"RTN","SDEC",108,0)
CPSTAT(SDECY,SDECTSK) ;EP Copy Appointment Status
"RTN","SDEC",109,0)
 D CPSTAT^SDEC29(.SDECY,$G(SDECTSK)) Q
"RTN","SDEC",110,0)
CRSCHED(SDECY,SDECRES,SDECSTART,SDECEND,SDECWKIN,MAXREC,LASTSUB) ;EP Create Resource Appointment Schedule  ;alb/sat 672
"RTN","SDEC",111,0)
 D CRSCHED^SDEC02(.SDECY,$G(SDECRES),$G(SDECSTART),$G(SDECEND),$G(SDECWKIN),$G(MAXREC),$G(LASTSUB)) Q
"RTN","SDEC",112,0)
CSLOTSCH(SDECY,SDECRES,SDECSTART,SDECEND,SDECTYPES,SDECSRCH) ;GET Create Assigned Slot Schedule
"RTN","SDEC",113,0)
 D CSLOTSCH^SDEC04(.SDECY,$G(SDECRES),$G(SDECSTART),$G(SDECEND),$G(SDECTYPES),$G(SDECSRCH)) Q
"RTN","SDEC",114,0)
CURFACG(SDECY,SDECDUZ) ;EP  get current division/facility for given user
"RTN","SDEC",115,0)
 D CURFACG^SDEC46(.SDECY,$G(SDECDUZ)) Q
"RTN","SDEC",116,0)
CVARAPPT(SDECY,SDCL) ;EP IS Clinic Variable Appointment Length
"RTN","SDEC",117,0)
 D CVARAPPT^SDEC37(.SDECY,$G(SDCL)) Q
"RTN","SDEC",118,0)
DELAG(SDECY,SDECGRP) ;EP Deletes entry having IEN SDECGRP from SDEC ACCESS GROUP file
"RTN","SDEC",119,0)
 D DELAG^SDEC21(.SDECY,$G(SDECGRP)) Q
"RTN","SDEC",120,0)
DELAGI(SDECY,SDECIEN,SDECIEN1) ;EP Deletes entry having Access Group SDECIEN and Access Type SDECIEN1 the SDEC ACCESS GROUP TYPE file
"RTN","SDEC",121,0)
 D DELAGI^SDEC22(.SDECY,$G(SDECIEN),$G(SDECIEN1)) Q
"RTN","SDEC",122,0)
DELRESGP(SDECY,SDECGRP) ;EP Deletes entry name SDECGRP from SDEC RESOURCE GROUP file
"RTN","SDEC",123,0)
 D DELRESGP^SDEC19(.SDECY,$G(SDECGRP)) Q
"RTN","SDEC",124,0)
DELRGI(SDECY,SDECIEN,SDECIEN1) ;EP Deletes entry SDECIEN1 from entry SDECIEN in the SDEC RESOURCE GROUP file
"RTN","SDEC",125,0)
 D DELRGI^SDEC20(.SDECY,$G(SDECIEN),$G(SDECIEN1)) Q
"RTN","SDEC",126,0)
DELRU(SDECY,SDECIEN) ;EP Delete Resource User from SDEC RESOURCE USER file
"RTN","SDEC",127,0)
 D DELRU^SDEC18(.SDECY,$G(SDECIEN)) Q
"RTN","SDEC",128,0)
EDITAPPT(SDECY,SDECAPTID,SDECNOTE,SDECLEN) ;EP Edit appointment (only 'note text' and appointment length can be edited)
"RTN","SDEC",129,0)
 D EDITAPPT^SDEC26(.SDECY,$G(SDECAPTID),$G(SDECNOTE),$G(SDECLEN)) Q
"RTN","SDEC",130,0)
EHRPT(SDECY,SDECWID,SDECDFN) ;EP Raise patient selection event to EHR
"RTN","SDEC",131,0)
 D EHRPT^SDEC30(.SDECY,$G(SDECWID),$G(SDECDFN)) Q
"RTN","SDEC",132,0)
ETHGET(SDECY) ;GET active Ethnicities from the ETHNICITY file 10.2
"RTN","SDEC",133,0)
 D ETHGET^SDEC55(.SDECY) Q
"RTN","SDEC",134,0)
ETHCMGET(SDECY) ;GET values from the RACE AND ETHNICITY COLLECTION METHOD file 10.3
"RTN","SDEC",135,0)
 D ETHCMGET^SDEC55(.SDECY) Q
"RTN","SDEC",136,0)
FACLIST(SDECY,DFN) ; Return list of remote facilities for patient
"RTN","SDEC",137,0)
 D PTINQ^SDECPT(.SDECY,$G(DFN)) Q
"RTN","SDEC",138,0)
FAPPTGET(SDECY,DFN,SDBEG,SDEND,SDANC) ;GET Future appointments for given patient and date range
"RTN","SDEC",139,0)
 D FAPPTGET^SDEC50(.SDECY,$G(DFN),$G(SDBEG),$G(SDEND),$G(SDANC)) Q
"RTN","SDEC",140,0)
GETFAC(SDECY,SDECDUZ) ;EP Gets all facilities for a user
"RTN","SDEC",141,0)
 D GETFAC^SDEC46(.SDECY,$G(SDECDUZ)) Q
"RTN","SDEC",142,0)
GETONE(SDECY,SDGMR) ;EP Return data on one consult
"RTN","SDEC",143,0)
 D GETONE^SDEC51(.SDECY,$G(SDGMR)) Q
"RTN","SDEC",144,0)
GETREGA(SDECRET,DFN) ;EP return basic reg info/demographics for given patient
"RTN","SDEC",145,0)
 D GETREGA^SDEC09(.SDECRET,$G(DFN)) Q
"RTN","SDEC",146,0)
GETSITES(SDECY) ;return active National VA site names and station numbers
"RTN","SDEC",147,0)
 D GETSITES^SDEC59(.SDECY) Q
"RTN","SDEC",148,0)
GETVPRV(BGOY,VPRV) ;EP return data from the V PROVIDER file
"RTN","SDEC",149,0)
 D GETVPRV^SDEC44(.BGOY,$G(VPRV)) Q
"RTN","SDEC",150,0)
HIDE(SDECY) ;Return clinics hidden from display
"RTN","SDEC",151,0)
 D HIDE^SDEC45(.SDECY) Q
"RTN","SDEC",152,0)
HOLIDAY(SDECY,SDECBD) ;EP return all entries from the HOLIDAY file 40.5
"RTN","SDEC",153,0)
 D HOLIDAY^SDEC45(.SDECY,$G(SDECBD)) Q
"RTN","SDEC",154,0)
HOSPLOC(SDECY,SDECP,MAXREC,LSUB) ;EP return HOSPITAL LOCATIONs
"RTN","SDEC",155,0)
 D HOSPLOC^SDEC32(.SDECY,$G(SDECP),$G(MAXREC),$G(LSUB)) Q
"RTN","SDEC",156,0)
IMHERE(SDECRES) ;EP I'm Here
"RTN","SDEC",157,0)
 D IMHERE^SDEC31(.SDECRES) Q
"RTN","SDEC",158,0)
NETLOC(SDECY,LOCATION) ;GET data from the NETWORK LOCATION file 2005.2
"RTN","SDEC",159,0)
 D NETLOC^SDEC59(.SDECY,$G(LOCATION)) Q
"RTN","SDEC",160,0)
NEWPERS(SDECY,SDCLASS,SDPART,MAXREC,LSUB,INACT) ;return entries from the USR CLASS MEMBERSHIP file that have the given USR CLASS (default is PROVIDER)
"RTN","SDEC",161,0)
 D NEWPERS^SDEC45(.SDECY,$G(SDCLASS),$G(SDPART),$G(MAXREC),$G(LSUB),$G(INACT)) Q
"RTN","SDEC",162,0)
NOSHOPAT(SDECY,DFN,SDCL) ;EP COLLECT NO-SHOW DATA for Patient
"RTN","SDEC",163,0)
 D NOSHOPAT^SDEC37(.SDECY,$G(DFN),$G(SDCL)) Q
"RTN","SDEC",164,0)
NOSHOW(SDECY,SDECAPTID,SDECNS,USERIEN,SDECDATE) ;EP Sets appointment noshow flag in SDEC APPOINTMENT file
"RTN","SDEC",165,0)
 D NOSHOW^SDEC31(.SDECY,$G(SDECAPTID),$G(SDECNS),$G(USERIEN),$G(SDECDATE)) Q
"RTN","SDEC",166,0)
OVBOOK(SDECY,SDCL,SDBEG,SDECRES) ;EP RPC - OVERBOOK - CHECK FOR OVERBOOK FOR GIVEN CLINIC, DATE, AND RESOURCE
"RTN","SDEC",167,0)
 D OVBOOK^SDEC07A(.SDECY,$G(SDCL),$G(SDBEG),$G(SDECRES)) Q
"RTN","SDEC",168,0)
PATAPPTD(SDECY,DFN) ;EP Return the Patient appointment display
"RTN","SDEC",169,0)
 D PATAPPTD^SDEC27(.SDECY,$G(DFN)) Q
"RTN","SDEC",170,0)
PATAPPTH(SDECY,DFN) ;EP return patient's appointment history for given patient - RPC
"RTN","SDEC",171,0)
 D PATAPPTH^SDEC48(.SDECY,$G(DFN)) Q
"RTN","SDEC",172,0)
PCSGET(SDECY,SDSVSP) ;GET clinics for a service/specialty (clinic stop)
"RTN","SDEC",173,0)
 D PCSGET^SDEC50(.SDECY,$G(SDSVSP)) Q
"RTN","SDEC",174,0)
PCSTGET(SDECY,DFN,SDCL,SDBEG,SDEND) ;GET patient clinic status for a clinic for a given time frame - has the patient been seen by the given Clinic in the past 24 months
"RTN","SDEC",175,0)
 D PCSTGET^SDEC50(.SDECY,$G(DFN),$G(SDCL),$G(SDBEG),$G(SDEND)) Q
"RTN","SDEC",176,0)
PCST2GET(SDECY,DFN,STOP,SDBEG,SDEND) ;GET patient clinic status for a service/specialty (clinic stop) for a given time frame - has the patient been seen any clinics with the given service/specialty (clinic stop) in the past 24 months
"RTN","SDEC",177,0)
 D PCST2GET^SDEC50(.SDECY,$G(DFN),$G(STOP),$G(SDBEG),$G(SDEND)) Q
"RTN","SDEC",178,0)
PREFGET(SDECY,DFN,INAC) ;EP Get values from SDEC PREFERENCES AND SPECIAL NEEDS file for given patient
"RTN","SDEC",179,0)
 D PREFGET^SDEC49(.SDECY,$G(DFN),$G(INAC)) Q
"RTN","SDEC",180,0)
PREFGETV(SDECY) ;EP Get all valid PREFERENCE text from SDEC PREFERENCES AND SPECIAL NEEDS file
"RTN","SDEC",181,0)
 D PREFGETV^SDEC49(.SDECY) Q
"RTN","SDEC",182,0)
PREFSET(SDECY,DFN,PREF,REMARK) ;EP Set values to SDEC PREFERENCES AND SPECIAL NEEDS file  ;alb/sat 658 add REMARK
"RTN","SDEC",183,0)
 D PREFSET^SDEC49(.SDECY,$G(DFN),$G(PREF),$G(REMARK)) Q
"RTN","SDEC",184,0)
PRIV(SDECY,CLINIEN,USER) ;IS this USER in the PRIVILEGED USER multiple for the clinic
"RTN","SDEC",185,0)
 D PRIV^SDEC32(.SDECY,$G(CLINIEN),$G(USER)) Q
"RTN","SDEC",186,0)
PROVALL(SDECY,SDECCL) ;EP return all providers for a given clinic from the HOSPITAL LOCATION file 44
"RTN","SDEC",187,0)
 D PROVALL^SDEC45(.SDECY,$G(SDECCL)) Q
"RTN","SDEC",188,0)
PROVCLIN(SDECY,SDECPRV) ;EP PROVIDER CLINICS remote procedure
"RTN","SDEC",189,0)
 D PROVCLIN^SDEC45(.SDECY,$G(SDECPRV)) Q
"RTN","SDEC",190,0)
PTINQ(SDECY,DFN) ;GET output from ORWPT PTINQ in DataTable format
"RTN","SDEC",191,0)
 D PTINQ^SDECPT(.SDECY,$G(DFN)) Q
"RTN","SDEC",192,0)
PTLOOKRS(SDECY,SDECP,SDECC,LASTSUB) ;EP Patient Lookup
"RTN","SDEC",193,0)
 D PTLOOKRS^SDEC28(.SDECY,$G(SDECP),$G(SDECC),$G(LASTSUB)) Q
"RTN","SDEC",194,0)
PTSET(SDECY,INP...) ;SET patient demographics
"RTN","SDEC",195,0)
 D PTSET^SDEC53(.SDECY,.INP) Q
"RTN","SDEC",196,0)
PTSET1(SDECY,INP) ;SET patient demographics (call from debug)
"RTN","SDEC",197,0)
 D PTSET^SDEC53(.SDECY,.INP) Q
"RTN","SDEC",198,0)
RACEGET(SDECY) ;GET active Race entries from the RACE file 10
"RTN","SDEC",199,0)
 D RACEGET^SDEC55(.SDECY) Q
"RTN","SDEC",200,0)
RAISEVNT(SDECY,SDECEVENT,SDECPARAM,SDECSIP,SDECSPT) ;EP RAISE EVENT
"RTN","SDEC",201,0)
 D RAISEVNT^SDEC23(.SDECY,$G(SDECEVENT),$G(SDECPARAM),$G(SDECSIP),$G(SDECSPT)) Q
"RTN","SDEC",202,0)
REBKCLIN(SDECY,SDECCLST,SDECBEG,SDECEND) ;EP Return recordset of rebooked patient appointments between given dates
"RTN","SDEC",203,0)
 D REBKCLIN^SDEC34(.SDECY,$G(SDECCLST),$G(SDECBEG),$G(SDECEND)) Q
"RTN","SDEC",204,0)
REBKLIST(SDECY,SDECLIST) ;EP patient appointments used in listing REBOOKED appointments for a list of appointmentIDs.
"RTN","SDEC",205,0)
 D REBKLIST^SDEC34(.SDECY,$G(SDECLIST)) Q
"RTN","SDEC",206,0)
REBKNEXT(SDECY,SDECDATE,SDECRES,SDECTPID) ;EP find the next ACCESS BLOCK in resource SDECRES after SDECSTART
"RTN","SDEC",207,0)
 D REBKNEXT^SDEC33(.SDECY,$G(SDECDATE),$G(SDECRES),$G(SDECTPID)) Q
"RTN","SDEC",208,0)
RECIEN(SDECY,RECIEN) ;GET RECALL REMINDERS for given ID
"RTN","SDEC",209,0)
 D RECIEN^SDEC52(.SDECY,$G(RECIEN)) Q
"RTN","SDEC",210,0)
RECGET(SDECY,DFN,SDBEG,SDEND,MAXREC,LASTSUB,RECIEN,SDSTOP,SDFLAGS,SDCLL) ; GET entries from the RECALL REMINDERS file 403.5 for a given Patient and Recall Date range. ;alb/sat 658 add SDCLL
"RTN","SDEC",211,0)
 D RECGET^SDEC52(.SDECY,$G(DFN),$G(SDBEG),$G(SDEND),$G(MAXREC),$G(LASTSUB),$G(RECIEN),$G(SDSTOP),$G(SDFLAGS),$G(SDCLL)) Q
"RTN","SDEC",212,0)
RECSET(SDECY,INP...) ; SET/EDIT/CANCEL/DELETE an entry to the RECALL REMINDERS file 403.5
"RTN","SDEC",213,0)
 D RECSET^SDEC52A(.SDECY,.INP) Q
"RTN","SDEC",214,0)
RECSET1(SDECY,INP) ; SET/EDIT/CANCEL/DELETE an entry to the RECALL REMINDERS file 403.5
"RTN","SDEC",215,0)
 D RECSET^SDEC52A(.SDECY,.INP) Q
"RTN","SDEC",216,0)
RECDSET(SDECY,RECALLIEN,SDRRFTR,SDCOMM) ; DELETE an entry to the RECALL REMINDERS file 403.5
"RTN","SDEC",217,0)
 D RECDSET^SDEC52A(.SDECY,$G(RECALLIEN),$G(SDRRFTR),$G(SDCOMM)) Q
"RTN","SDEC",218,0)
RECAPGET(SDECY) ; GET entries from the RECALL REMINDERS APPT TYPE file 403.51
"RTN","SDEC",219,0)
 D RECAPGET^SDEC52B(.SDECY) Q
"RTN","SDEC",220,0)
RECPRGET(SDECY,RECINACT,SDECP,MAXREC,LASTSUB) ;GET entries from the RECALL REMINDERS PROVIDERS file 403.54
"RTN","SDEC",221,0)
 D RECPRGET^SDEC52B(.SDECY,$G(RECINACT),$G(SDECP),$G(MAXREC),$G(LASTSUB)) Q
"RTN","SDEC",222,0)
REGEVENT(SDECY,SDECEVENT,SDECIP,SDECPORT) ;EP Called by client to inform server of client's interest in SDECEVENT
"RTN","SDEC",223,0)
 D REGEVENT^SDEC23(.SDECY,$G(SDECEVENT),$G(SDECIP),$G(SDECPORT)) Q
"RTN","SDEC",224,0)
REP1GET(SDECY,MAXREC,LASTSUB,PNAME) ;GET clinic data for report
"RTN","SDEC",225,0)
 D REP1GET^SDEC56(.SDECY,$G(MAXREC),$G(LASTSUB),$G(PNAME)) Q
"RTN","SDEC",226,0)
REQGET(SDECY,SDBEG,SDEND,MAXREC,LASTSUB,SDGMR) ; GET entries with an ACTIVITY of RECEIVED, but do not have an ACTIVITY of SCHEDULED from the REQUEST/CONSULTATING file 123
"RTN","SDEC",227,0)
 D REQGET^SDEC51(.SDECY,$G(SDBEG),$G(SDEND),$G(MAXREC),$G(LASTSUB),$G(SDGMR)) Q
"RTN","SDEC",228,0)
RESGPUSR(SDECY,SDECDUZ) ;EP GROUP RESOURCE
"RTN","SDEC",229,0)
 D RESGPUSR^SDEC01(.SDECY,$G(SDECDUZ)) Q
"RTN","SDEC",230,0)
RESGRPUS(SDECY,SDECDUZ) ;EP return ACTIVE resource group names for the given user
"RTN","SDEC",231,0)
 D RESGRPUS^SDEC01(.SDECY,$G(SDECDUZ)) Q
"RTN","SDEC",232,0)
RESLETRF(SDECY,SDECRES,SDECLT) ;EP Return formatted text output of the Resource's Letter - either "LETTER TEXT" (also used as Reminder Letter), NO SHOW LETTER, or CLINIC CANCELLATION LETTER.
"RTN","SDEC",233,0)
 D RESLETRF^SDEC47(.SDECY,$G(SDECRES),$G(SDECLT)) Q
"RTN","SDEC",234,0)
RESLETRS(SDECY,SDECLIST,SDLTR,SDNOS,SDCAN) ;EP GET recordset of RESOURCES and associated LETTERS
"RTN","SDEC",235,0)
 D RESLETRS^SDEC35(.SDECY,$G(SDECLIST),$G(SDLTR),$G(SDNOS),$G(SDCAN)) Q
"RTN","SDEC",236,0)
RESUSER(SDECY,SDRES) ;EP SDEC RESOURCE USER remote procedure returns all entries from the SDEC RESOURCE USER table 409.833
"RTN","SDEC",237,0)
 D RESUSER^SDEC45(.SDECY,$G(SDRES)) Q
"RTN","SDEC",238,0)
RESOURCE(SDECY,SDECDUZ,SDACT,SDTYPE,MAXREC,LASTSUBI,SDIEN,SDECP) ;EP Returns ADO Recordset with ALL RESOURCE names
"RTN","SDEC",239,0)
 D RESOURCE^SDEC01A(.SDECY,$G(SDECDUZ),$G(SDACT),$G(SDTYPE),$G(MAXREC),$G(LASTSUBI),$G(SDIEN),$G(SDECP)) Q
"RTN","SDEC",240,0)
SCHUSR(SDECY) ;EP Return recordset of all users in NEW PERSON having SDECZMENU key
"RTN","SDEC",241,0)
 D SCHUSR^SDEC17(.SDECY) Q
"RTN","SDEC",242,0)
SEARCHAV(SDECY,SDECRES,SDECSTRT,SDECEND,SDECTYPES,SDECAMPM,SDECWKDY) ;EP Searches availability database
"RTN","SDEC",243,0)
 D SEARCHAV^SDEC24(.SDECY,$G(SDECRES),$G(SDECSTRT),$G(SDECEND),$G(SDECTYPES),$G(SDECAMPM),$G(SDECWKDY)) Q
"RTN","SDEC",244,0)
SETFAC(SDECY,SDECDUZ,SDECFAC) ;EP SET FACILITY
"RTN","SDEC",245,0)
 D SETFAC^SDEC46(.SDECY,$G(SDECDUZ),$G(SDECFAC)) Q
"RTN","SDEC",246,0)
SETRBOOK(SDECY,SDECAPPT,SDECDATE) ;EP Sets rebook date into appointment
"RTN","SDEC",247,0)
 D SETRBOOK^SDEC33(.SDECY,$G(SDECAPPT),$G(SDECDATE)) Q
"RTN","SDEC",248,0)
SPACEBAR(SDECY,SDECDIC,SDECVAL) ;EP Update ^DISV with most recent lookup value SDECVAL from file SDECDIC
"RTN","SDEC",249,0)
 D SPACEBAR^SDEC30(.SDECY,$G(SDECDIC),$G(SDECVAL)) Q
"RTN","SDEC",250,0)
SUMMGET(SDECRET,SDBEG,SDEND,USER,LSUB,MAXREC) ;GET Audit Summary for given date range
"RTN","SDEC",251,0)
 D SUMMGET^SDEC54(.SDECRET,$G(SDBEG),$G(SDEND),$G(USER),$G(LSUB),$G(MAXREC)) Q
"RTN","SDEC",252,0)
SUMMGET2(SDECRET,SDBEG,SDEND,USER) ;Get compiled Audit Report for a given date range
"RTN","SDEC",253,0)
 D SUMMGET2^SDECAUD(.SDECRET,$G(SDBEG),$G(SDEND),$G(USER)) Q
"RTN","SDEC",254,0)
SUMMAGET(SDECY,SDBEG,SDEND,USER,LSUB,MAXREC) ;get ALL appointments with a cancel status from SDEC APPOINTMENT for given date range and user
"RTN","SDEC",255,0)
 D SUMMAGET^SDEC54A(.SDECY,$G(SDBEG),$G(SDEND),$G(USER),$G(LSUB),$G(MAXREC)) Q
"RTN","SDEC",256,0)
SUSRINFO(SDECY,SDECDUZ) ;EP SCHEDULING USER INFO
"RTN","SDEC",257,0)
 D SUSRINFO^SDEC01(.SDECY,$G(SDECDUZ)) Q
"RTN","SDEC",258,0)
SVSPALL(RET) ; EP return IEN and NAME for all entries in the SD WL SERVICE/SPECIALTY file
"RTN","SDEC",259,0)
 D SVSPALL^SDECWL(.RET) Q
"RTN","SDEC",260,0)
SYSSTAT(SDECY) ; EP SYSTEM STATUS
"RTN","SDEC",261,0)
 D SYSSTAT^SDECUTL(.SDECY) Q
"RTN","SDEC",262,0)
TPBLKOV(SDECY,SDECSTART,SDECEND,SDECRES) ;EP TYPE BLOCKS OVERLAP
"RTN","SDEC",263,0)
 D TPBLKOV^SDEC06(.SDECY,$G(SDECSTART),$G(SDECEND),$G(SDECRES)) Q
"RTN","SDEC",264,0)
UNDOCANA(SDECY,SDECAPTID) ;EP  Undo Cancel Appointment
"RTN","SDEC",265,0)
 D UNDOCANA^SDEC08(.SDECY,$G(SDECAPTID)) Q
"RTN","SDEC",266,0)
UNREGEV(SDECY,SDECEVENT,SDECIP,SDECPORT) ;EP rpc SDE UNREGEV Called by client to Unregister client's interest in SDECEVENT
"RTN","SDEC",267,0)
 D UNREGEV^SDEC23(.SDECY,$G(SDECEVENT),$G(SDECIP),$G(SDECPORT)) Q
"RTN","SDEC",268,0)
WAITLIST(SDECY,SDECRES) ;EP COLLECT WAITLIST DATA
"RTN","SDEC",269,0)
 D WAITLIST^SDEC36(.SDECY,$G(SDECRES)) Q
"RTN","SDEC",270,0)
WLCLOSE(RET,INP...) ; Waitlist CLOSE
"RTN","SDEC",271,0)
 D WLCLOSE^SDECWL(.RET,.INP) Q
"RTN","SDEC",272,0)
WLCLOSE1(RET,INP) ; Waitlist CLOSE  (without ... for VistA calls)
"RTN","SDEC",273,0)
 D WLCLOSE^SDECWL(.RET,.INP) Q
"RTN","SDEC",274,0)
WLGET(RET,WLIEN1,MAXREC,SDBEG,SDEND,DFN,LASTSUB,SDTOP,SVCL,DESDT,PRI,SVCR,SCVISIT,CLINIC,ORIGDT) ;EP Waitlist GET   ;alb/sat 658 add SVCL-SCVISIT
"RTN","SDEC",275,0)
 D WLGET^SDECWL1(.RET,$G(WLIEN1),$G(MAXREC),$G(SDBEG),$G(SDEND),$G(DFN),$G(LASTSUB),$G(SDTOP),$G(SVCL),$G(DESDT),$G(PRI),$G(SVCR),$G(SCVISIT),$G(CLINIC),$G(ORIGDT)) Q
"RTN","SDEC",276,0)
WLHIDE(SDECY,DFN,WLCL) ;GET wait list entries in which the associated clinic's 'HIDE FROM DISPLAY?' field is 'YES'
"RTN","SDEC",277,0)
 D WLHIDE^SDECWL3(.SDECY,$G(DFN),$G(WLCL)) Q
"RTN","SDEC",278,0)
WLOPEN(RET,WLAPP,WLIEN,WLDDT) ;SET Waitlist Open/re-open
"RTN","SDEC",279,0)
 D WLOPEN^SDECWL(.RET,$G(WLAPP),$G(WLIEN),$G(WLDDT)) Q
"RTN","SDEC",280,0)
WLPCSET(SDECY,INP,WLIEN) ;SET update patient contacts in SD WAIT LIST file
"RTN","SDEC",281,0)
 D WLPCSET^SDECWL(.SDECY,$G(INP),$G(WLIEN)) Q
"RTN","SDEC",282,0)
WLSET(RET,INP...) ;EP Waitlist Set
"RTN","SDEC",283,0)
 D WLSET^SDECWL2(.RET,.INP) Q
"RTN","SDEC",284,0)
WLSET1(RET,INP) ;EP Waitlist Set (without ... for VistA calls)
"RTN","SDEC",285,0)
 D WLSET^SDECWL2(.RET,.INP) Q
"RTN","SDEC01C")
0^1^B69927064^n/a
"RTN","SDEC01C",1,0)
SDEC01C ;ALB/AJF - VISTA SCHEDULING RPCS ;FEB 22, 2018
"RTN","SDEC01C",2,0)
 ;;5.3;Scheduling;**686**;;Build 53
"RTN","SDEC01C",3,0)
 ;
"RTN","SDEC01C",4,0)
 Q
"RTN","SDEC01C",5,0)
 ;
"RTN","SDEC01C",6,0)
RESOURCE(SDECY,SDECDUZ,SDACT,SDTYPE,MAXREC,LASTSUBI,SDIEN,SDECP) ;Returns ADO Recordset with ALL RESOURCE names
"RTN","SDEC01C",7,0)
 ;   SDECDUZ = (optional) pointer to NEW PERSON file
"RTN","SDEC01C",8,0)
 ;                       Defaults to current user
"RTN","SDEC01C",9,0)
 ;                       checks that overbook is allowed
"RTN","SDEC01C",10,0)
 ;   SDACT   = (optional) 1 or YES will return only active resources
"RTN","SDEC01C",11,0)
 ;                       0, NO, or null will include inactive
"RTN","SDEC01C",12,0)
 ;   SDTYPE    = (optional) null will return all resource types
"RTN","SDEC01C",13,0)
 ;            H will only return HOSPITAL LOCATION (clinic) resources
"RTN","SDEC01C",14,0)
 ;            P will only return NEW PERSON (Provider) resources
"RTN","SDEC01C",15,0)
 ;            A will only return SDEC ADDITIONAL RESOURCE resources
"RTN","SDEC01C",16,0)
 ;            PH will only return prohibited clinics
"RTN","SDEC01C",17,0)
 ;   MAXREC   - (optional) Max records returned
"RTN","SDEC01C",18,0)
 ;   LASTSUBI - (optional) last subscripts from previous call
"RTN","SDEC01C",19,0)
 ;   SDIEN    - (optional) pointer to SDEC RESOURCE file
"RTN","SDEC01C",20,0)
 ;                         only 1 record will be returned if SDIEN is present
"RTN","SDEC01C",21,0)
 ;   SDECP  - (optional) Partial name text
"RTN","SDEC01C",22,0)
 ;RETURN:
"RTN","SDEC01C",23,0)
 ;  Successful Return:
"RTN","SDEC01C",24,0)
 ;   a global array in which each array entry contains data from the
"RTN","SDEC01C",25,0)
 ;      SDEC RESOURCE file
"RTN","SDEC01C",26,0)
 ;   1. RESOURCEID - Pointer to the SDEC RESOURCE file
"RTN","SDEC01C",27,0)
 ;   2. HOSPITALID - Pointer to the HOSPITAL LOCATION file 44
"RTN","SDEC01C",28,0)
 ;   3. CLINNAME   - Clinic Name from HOSPITAL LOCATION file 44
"RTN","SDEC01C",29,0)
 ;   4. ABBR       - Abbreviation
"RTN","SDEC01C",30,0)
 ;   5. RESOURCE_NAME - NAME from SDEC RESOURCE file
"RTN","SDEC01C",31,0)
 ;
"RTN","SDEC01C",32,0)
 ;
"RTN","SDEC01C",33,0)
 N SDA,SDCL,SDDATA,SDMSG,SDECERR,SDECRET,SDECIEN,SDECRES,SDECDEP,SDECDDR,SDECDEPN,SDECRDAT,SDECRNOD,SDECI,SDEC,SDECLTR
"RTN","SDEC01C",34,0)
 N ABBR,SDECNOS,SDECCAN,SDF,SDTYPR,SDX,SDPRO,PRO,SDH,SDK,SDRT,SDT,SDXT,SDCN,SDHL
"RTN","SDEC01C",35,0)
 S (SDF,SDRT,SDT,SDX)="",SDPRO=0
"RTN","SDEC01C",36,0)
 S SDECY="^TMP(""SDEC01C"","_$J_",""RESOURCE"")"
"RTN","SDEC01C",37,0)
 K @SDECY
"RTN","SDEC01C",38,0)
 S SDECI=0
"RTN","SDEC01C",39,0)
 S (SDECERR,SDTYPR)=""
"RTN","SDEC01C",40,0)
 ;                       1                       2                   3       
"RTN","SDEC01C",41,0)
 S @SDECY@(SDECI)="I00010RESOURCEID^I00010HOSPITAL_LOCATION_ID^T00030CLINNAME^T00030ABBR^T00030RESOURCE_NAME"_$C(30)
"RTN","SDEC01C",42,0)
 ;validate user
"RTN","SDEC01C",43,0)
 S SDECDUZ=$G(SDECDUZ)
"RTN","SDEC01C",44,0)
 I '+SDECDUZ S SDECDUZ=DUZ
"RTN","SDEC01C",45,0)
 ;validate active
"RTN","SDEC01C",46,0)
 S SDACT=1
"RTN","SDEC01C",47,0)
 ;S SDACT=$G(SDACT)
"RTN","SDEC01C",48,0)
 ;S SDACT=$S(SDACT=1:1,SDACT="YES":1,1:0)
"RTN","SDEC01C",49,0)
 ;validate type
"RTN","SDEC01C",50,0)
 S SDTYPE="H"
"RTN","SDEC01C",51,0)
 ;MGH added new type
"RTN","SDEC01C",52,0)
 ;I SDTYPE="PH" S SDPRO=1
"RTN","SDEC01C",53,0)
 S SDTYPE=$S(SDTYPE="H":"SC(",SDTYPE="P":"VA(200",SDTYPE="A":"SDEC",1:"")
"RTN","SDEC01C",54,0)
 ;validate MAXREC
"RTN","SDEC01C",55,0)
 S MAXREC=$G(MAXREC,9999999)
"RTN","SDEC01C",56,0)
 ;validate LASTSUBI
"RTN","SDEC01C",57,0)
 S LASTSUBI=$G(LASTSUBI)
"RTN","SDEC01C",58,0)
 ;validate SDIEN
"RTN","SDEC01C",59,0)
 ;MGH changed to allow multiple IENS
"RTN","SDEC01C",60,0)
 S SDIEN=$G(SDIEN)
"RTN","SDEC01C",61,0)
 I SDIEN'="",'$D(^SDEC(409.831,+SDIEN,0)) S SDIEN=""
"RTN","SDEC01C",62,0)
 I $G(SDIEN) D  G RESX
"RTN","SDEC01C",63,0)
 .F SDK=1:1:$L(SDIEN,"|") D
"RTN","SDEC01C",64,0)
 ..S SDECIEN=$P(SDIEN,"|",SDK)
"RTN","SDEC01C",65,0)
 ..Q:'$D(^SDEC(409.831,+SDECIEN,0))
"RTN","SDEC01C",66,0)
 ..S SDECRES=SDECIEN
"RTN","SDEC01C",67,0)
 ..D RES1
"RTN","SDEC01C",68,0)
 ;ien lookup
"RTN","SDEC01C",69,0)
 ;I +SDIEN S SDECRES=+SDIEN D RES1 G RESX
"RTN","SDEC01C",70,0)
 ;validate SDECP
"RTN","SDEC01C",71,0)
 S SDECP=$G(SDECP)
"RTN","SDEC01C",72,0)
 ;partial name lookup
"RTN","SDEC01C",73,0)
 I SDECP'="" D
"RTN","SDEC01C",74,0)
 .S SDF=$S($P(LASTSUBI,"|",1)'="":$P(LASTSUBI,"|",1),1:"")
"RTN","SDEC01C",75,0)
 .S (SDX,SDXT)=$S($P(LASTSUBI,"|",2)'="":$$GETSUB^SDEC56($P(LASTSUBI,"|",2)),1:$$GETSUB^SDEC56(SDECP))
"RTN","SDEC01C",76,0)
 .I ($P(LASTSUBI,"|",1)="")!($P(LASTSUBI,"|",1)="ABBR") S SDF="ABBR" F  S SDX=$O(^SDEC(409.831,"C",SDX)) Q:SDX=""  Q:SDX'[SDECP  D  Q:(+MAXREC)&(SDECI'<MAXREC)
"RTN","SDEC01C",77,0)
 ..S (SDECRES,SDRT)=$S($P(LASTSUBI,"|",3)'="":$P(LASTSUBI,"|",3),1:0)
"RTN","SDEC01C",78,0)
 ..S LASTSUBI="" F  S SDECRES=$O(^SDEC(409.831,"C",SDX,SDECRES)) Q:'+SDECRES  D RES1  Q:(+MAXREC)&(SDECI'<MAXREC)
"RTN","SDEC01C",79,0)
 .I ($P(LASTSUBI,"|",1)="")!($P(LASTSUBI,"|",1)="FULL") S SDF="FULL",SDX=SDXT F  S SDX=$O(^SDEC(409.831,"B",SDX)) Q:SDX=""  Q:SDX'[SDECP  D  Q:(+MAXREC)&(SDECI'<MAXREC)
"RTN","SDEC01C",80,0)
 ..S (SDECRES,SDRT)=$S($P(LASTSUBI,"|",3)'="":$P(LASTSUBI,"|",3),SDRT'="":SDRT,1:0)
"RTN","SDEC01C",81,0)
 ..S LASTSUBI="" F  S SDECRES=$O(^SDEC(409.831,"B",SDX,SDECRES)) Q:'+SDECRES  D RES1  Q:(+MAXREC)&(SDECI'<MAXREC)
"RTN","SDEC01C",82,0)
 ;$O THRU SDEC RESOURCE File
"RTN","SDEC01C",83,0)
 I SDECP="",'+SDIEN S SDECRES=$S($P(LASTSUBI,"|",2)'="":$P(LASTSUBI,"|",2),1:0) F  S SDECRES=$O(^SDEC(409.831,SDECRES)) Q:'+SDECRES  D  Q:(+MAXREC)&(SDECI'<MAXREC)
"RTN","SDEC01C",84,0)
 .D RES1
"RTN","SDEC01C",85,0)
RESX ;
"RTN","SDEC01C",86,0)
 S @SDECY@(SDECI)=@SDECY@(SDECI)_$C(31)
"RTN","SDEC01C",87,0)
 Q
"RTN","SDEC01C",88,0)
RES1 ; get data for 1 resource
"RTN","SDEC01C",89,0)
 N FND
"RTN","SDEC01C",90,0)
 S FND=0
"RTN","SDEC01C",91,0)
 Q:'$D(^SDEC(409.831,SDECRES,0))
"RTN","SDEC01C",92,0)
 I SDF="FULL",SDECP'="" S FND=$$CHK(SDECP,SDECRES) Q:+FND   ;alb/sat 658 - stop if 'this' record found in abbreviations
"RTN","SDEC01C",93,0)
 I SDECP'="" S SDH=0 F  S SDH=$O(^SDEC(409.831,"C",SDECP,SDH)) Q:SDH=""  S FND=SDH=SDECRES  Q:FND
"RTN","SDEC01C",94,0)
 S SDECRNOD=^SDEC(409.831,SDECRES,0)
"RTN","SDEC01C",95,0)
 I SDTYPE'="" Q:$P(SDECRNOD,U,11)'[SDTYPE
"RTN","SDEC01C",96,0)
 S SDTYPR=$P(SDECRNOD,U,11)
"RTN","SDEC01C",97,0)
 S $P(SDTYPR,"|",1)=$S($P(SDTYPR,";",2)="SC(":"H",$P(SDTYPR,";",2)="VA(200,":"P",$P(SDTYPR,";",2)="SDEC(409.834,":"A",1:"")
"RTN","SDEC01C",98,0)
 S $P(SDTYPR,"|",2)=$P($P(SDECRNOD,U,11),";",1)
"RTN","SDEC01C",99,0)
 S $P(SDTYPR,"|",3)=$$GET1^DIQ(409.831,SDECRES_",",.012)
"RTN","SDEC01C",100,0)
 I $P(SDTYPR,"|",1)="P" D RESPRV1^SDEC01B($P(SDTYPR,"|",2),$P(SDECRNOD,U,4))  ;do not include provider resource if NEW PERSON is not active
"RTN","SDEC01C",101,0)
 I $P(SDTYPR,"|",1)="H" D CHKC^SDEC01B($P(SDTYPR,"|",2),SDECRES)
"RTN","SDEC01C",102,0)
 I +SDACT,$$GET1^DIQ(409.831,SDECRES_",",.02)="YES" Q   ;do not include inactive entries
"RTN","SDEC01C",103,0)
 D GETACC(.SDECACC,SDECDUZ,SDECRES)
"RTN","SDEC01C",104,0)
 K SDECRDAT
"RTN","SDEC01C",105,0)
 ;alb/sat 658 - begin mod
"RTN","SDEC01C",106,0)
 ;
"RTN","SDEC01C",107,0)
 S $P(SDECRDAT,U,1)=$P(SDECRNOD,U,1)
"RTN","SDEC01C",108,0)
 S $P(SDECRDAT,U,2)=$P(SDECRNOD,U,2)
"RTN","SDEC01C",109,0)
 S $P(SDECRDAT,U,3)=$P(SDECRNOD,U,3)
"RTN","SDEC01C",110,0)
 S $P(SDECRDAT,U,4)=$P(SDECRNOD,U,4)
"RTN","SDEC01C",111,0)
 S SDHL=$P(SDECRNOD,U,4)
"RTN","SDEC01C",112,0)
 S SDCN=$$GET1^DIQ(44,SDHL_",",.01)  ;clinic name
"RTN","SDEC01C",113,0)
 ;alb/sat 658 - end mod
"RTN","SDEC01C",114,0)
 S SDECRDAT=SDECRES_U_SDECRDAT   ;1,2-5
"RTN","SDEC01C",115,0)
 S SDCL=$P(SDECRDAT,U,5)
"RTN","SDEC01C",116,0)
 Q:+$$GET1^DIQ(44,SDCL_",",50.01,"I")=1  ;OOS?
"RTN","SDEC01C",117,0)
 S PRO=0
"RTN","SDEC01C",118,0)
 ;MGH code for new type to only contain prohibited clinics
"RTN","SDEC01C",119,0)
 Q:$G(SDCL)=""&(SDPRO=1)
"RTN","SDEC01C",120,0)
 Q:$G(SDCL)&(SDPRO=1)&($$GET1^DIQ(44,SDCL_",",2500)'="YES")
"RTN","SDEC01C",121,0)
 S $P(SDECRDAT,U,3)=$$GET1^DIQ(409.831,SDECRES_",",.02)
"RTN","SDEC01C",122,0)
 ;Get letter text from wp field
"RTN","SDEC01C",123,0)
 S SDECLTR=""
"RTN","SDEC01C",124,0)
 I 0,$D(^SDEC(409.831,SDECRES,1)) D
"RTN","SDEC01C",125,0)
 . S SDECIEN=0
"RTN","SDEC01C",126,0)
 . F  S SDECIEN=$O(^SDEC(409.831,SDECRES,1,SDECIEN)) Q:'+SDECIEN  D
"RTN","SDEC01C",127,0)
 . . S SDECLTR=SDECLTR_$G(^SDEC(409.831,SDECRES,1,SDECIEN,0))
"RTN","SDEC01C",128,0)
 . . S SDECLTR=SDECLTR_$C(13)_$C(10)
"RTN","SDEC01C",129,0)
 S SDECNOS=""
"RTN","SDEC01C",130,0)
 I 0,$D(^SDEC(409.831,SDECRES,12)) D
"RTN","SDEC01C",131,0)
 . S SDECIEN=0 F  S SDECIEN=$O(^SDEC(409.831,SDECRES,12,SDECIEN)) Q:'+SDECIEN  D
"RTN","SDEC01C",132,0)
 . . S SDECNOS=SDECNOS_$G(^SDEC(409.831,SDECRES,12,SDECIEN,0))
"RTN","SDEC01C",133,0)
 . . S SDECNOS=SDECNOS_$C(13)_$C(10)
"RTN","SDEC01C",134,0)
 S SDECCAN=""
"RTN","SDEC01C",135,0)
 I 0,$D(^SDEC(409.831,SDECRES,13)) D
"RTN","SDEC01C",136,0)
 . S SDECIEN=0 F  S SDECIEN=$O(^SDEC(409.831,SDECRES,13,SDECIEN)) Q:'+SDECIEN  D
"RTN","SDEC01C",137,0)
 . . S SDECCAN=SDECCAN_$G(^SDEC(409.831,SDECRES,13,SDECIEN,0))
"RTN","SDEC01C",138,0)
 . . S SDECCAN=SDECCAN_$C(13)_$C(10)
"RTN","SDEC01C",139,0)
 N SDECACC,SDECMGR
"RTN","SDEC01C",140,0)
 S SDECACC="0^0^0^0"
"RTN","SDEC01C",141,0)
 S SDECMGR=$O(^DIC(19.1,"B","SDECZMGR",0))
"RTN","SDEC01C",142,0)
 I +SDECMGR,$D(^VA(200,SDECDUZ,51,SDECMGR)) S SDECACC="1^1^1^1"
"RTN","SDEC01C",143,0)
 I SDECACC="0^0^0^0" D
"RTN","SDEC01C",144,0)
 . N SDECNOD,SDECRUID
"RTN","SDEC01C",145,0)
 . S SDECRUID=0
"RTN","SDEC01C",146,0)
 . ;Get entry for this user and resource
"RTN","SDEC01C",147,0)
 . F  S SDECRUID=$O(^SDEC(409.833,"AC",SDECDUZ,SDECRUID)) Q:'+SDECRUID  I $D(^SDEC(409.833,SDECRUID,0)),$P(^(0),U)=SDECRES Q
"RTN","SDEC01C",148,0)
 . Q:'+SDECRUID
"RTN","SDEC01C",149,0)
 . S $P(SDECACC,U)=1
"RTN","SDEC01C",150,0)
 . S SDECNOD=$G(^SDEC(409.833,SDECRUID,0))
"RTN","SDEC01C",151,0)
 . S $P(SDECACC,U,2)=+$P(SDECNOD,U,3)
"RTN","SDEC01C",152,0)
 . S $P(SDECACC,U,3)=+$P(SDECNOD,U,4)
"RTN","SDEC01C",153,0)
 . S $P(SDECACC,U,4)=+$P(SDECNOD,U,5)
"RTN","SDEC01C",154,0)
 ;                     6         7         8         9-12
"RTN","SDEC01C",155,0)
 K SDDATA D GETS^DIQ(409.831,SDECRES_",",".01:.04","IE","SDDATA","SDMSG")
"RTN","SDEC01C",156,0)
 S SDA="SDDATA(409.831,"""_SDECRES_","")"
"RTN","SDEC01C",157,0)
 S ABBR=@SDA@(.011,"E")   ;abbreviation
"RTN","SDEC01C",158,0)
 ;AJF ; 022718 ; Only return 7 variables
"RTN","SDEC01C",159,0)
 S SDECRDAT=SDECRES_U_SDHL_U_SDCN_U_ABBR_U_$P(SDECRNOD,U)
"RTN","SDEC01C",160,0)
 ;S SDECRDAT=SDECRES_U_SDHL_U_SDCN
"RTN","SDEC01C",161,0)
 S $P(SDECRDAT,U,4)=@SDA@(.011,"E")   ;abbreviation
"RTN","SDEC01C",162,0)
 S $P(SDECRDAT,U,5)=$S(($G(SDF)="ABBR")&(@SDA@(.011,"E")'=""):@SDA@(.011,"E")_" ",1:"")_$P(SDECRDAT,U,5)  ;alb/sat 658 - include abbr in name if found by C xref
"RTN","SDEC01C",163,0)
 ;S $P(SDECRDAT,U,6)=SDF_"|"_SDX_"|"_SDECRES   ;LASTSUB
"RTN","SDEC01C",164,0)
 S SDECI=SDECI+1
"RTN","SDEC01C",165,0)
 S @SDECY@(SDECI)=SDECRDAT_$C(30)
"RTN","SDEC01C",166,0)
 Q
"RTN","SDEC01C",167,0)
 ;
"RTN","SDEC01C",168,0)
GETACC(SDECACC,SDECDUZ,SDECRES) ;get view, overbook, modify appt, and modify schedule abilities
"RTN","SDEC01C",169,0)
 ;INPUT:
"RTN","SDEC01C",170,0)
 ; SDECDUZ = user ID pointer to NEW PERSON file
"RTN","SDEC01C",171,0)
 ; SDECRES = resource ID pointer to SDEC RESOURCE file
"RTN","SDEC01C",172,0)
 ;RETURN:
"RTN","SDEC01C",173,0)
 ; .SDECACC  = access separated by ^:
"RTN","SDEC01C",174,0)
 ;   1. VIEW - User can VIEW 1=YES; 0=NO
"RTN","SDEC01C",175,0)
 ;   2. OVERBOOK - User can OVERBOOK  1=YES; 0=NO
"RTN","SDEC01C",176,0)
 ;   3. MODIFY SCHEDULE - User can Modify Schedule  1=YES; 0=NO
"RTN","SDEC01C",177,0)
 ;   4. MODIFY APPOINTMENTS User can modify appointments  1=YES; 0=NO
"RTN","SDEC01C",178,0)
 N SDECMGR
"RTN","SDEC01C",179,0)
 S SDECACC="0^0^0^0"
"RTN","SDEC01C",180,0)
 S SDECMGR=$O(^DIC(19.1,"B","SDECZMGR",0))
"RTN","SDEC01C",181,0)
 I +SDECMGR,$D(^VA(200,SDECDUZ,51,SDECMGR)) S SDECACC="1^1^1^1"
"RTN","SDEC01C",182,0)
 I SDECACC="0^0^0^0" D
"RTN","SDEC01C",183,0)
 . N SDECNOD,SDECRUID
"RTN","SDEC01C",184,0)
 . S SDECRUID=0
"RTN","SDEC01C",185,0)
 . ;Get entry for this user and resource
"RTN","SDEC01C",186,0)
 . F  S SDECRUID=$O(^SDEC(409.833,"AC",SDECDUZ,SDECRUID)) Q:'+SDECRUID  I $D(^SDEC(409.833,SDECRUID,0)),$P(^(0),U)=SDECRES Q
"RTN","SDEC01C",187,0)
 . Q:'+SDECRUID
"RTN","SDEC01C",188,0)
 . S $P(SDECACC,U)=1
"RTN","SDEC01C",189,0)
 . S SDECNOD=$G(^SDEC(409.833,SDECRUID,0))
"RTN","SDEC01C",190,0)
 . S $P(SDECACC,U,2)=+$P(SDECNOD,U,3)
"RTN","SDEC01C",191,0)
 . S $P(SDECACC,U,3)=+$P(SDECNOD,U,4)
"RTN","SDEC01C",192,0)
 . S $P(SDECACC,U,4)=+$P(SDECNOD,U,5)
"RTN","SDEC01C",193,0)
 Q
"RTN","SDEC01C",194,0)
 ;
"RTN","SDEC01C",195,0)
GETLTRS(SDECLTR,SDECNOS,SDECCAN,SDECRES,SDCL) ;get resource letters
"RTN","SDEC01C",196,0)
 ;INPUT:
"RTN","SDEC01C",197,0)
 ; SDECRES = resource ID pointer to SDEC RESOURCE file
"RTN","SDEC01C",198,0)
 ; SDCL    = clinic ID pointer to HOSPITAL LOCATION file
"RTN","SDEC01C",199,0)
 ;RETURN:
"RTN","SDEC01C",200,0)
 ; .SDECLTR = LETTER TEXT
"RTN","SDEC01C",201,0)
 ; .SDECNOS = NO SHOW LETTER
"RTN","SDEC01C",202,0)
 ; .SDECCAN = CLINIC CANCELLATION LETTER
"RTN","SDEC01C",203,0)
 ; .Get letter text from wp field
"RTN","SDEC01C",204,0)
 N SDECIEN
"RTN","SDEC01C",205,0)
 S SDECLTR=""
"RTN","SDEC01C",206,0)
 I $D(^SDEC(409.831,SDECRES,2,SDCL,1)) D
"RTN","SDEC01C",207,0)
 . S SDECIEN=0 F  S SDECIEN=$O(^SDEC(409.831,SDECRES,2,SDCL,1,SDECIEN)) Q:'+SDECIEN  D
"RTN","SDEC01C",208,0)
 . . S SDECLTR=SDECLTR_$G(^SDEC(409.831,SDECRES,2,SDCL,1,SDECIEN,0))
"RTN","SDEC01C",209,0)
 . . S SDECLTR=SDECLTR_$C(13)_$C(10)
"RTN","SDEC01C",210,0)
 S SDECNOS=""
"RTN","SDEC01C",211,0)
 I $D(^SDEC(409.831,SDECRES,2,SDCL,12)) D
"RTN","SDEC01C",212,0)
 . S SDECIEN=0 F  S SDECIEN=$O(^SDEC(409.831,SDECRES,2,SDCL,12,SDECIEN)) Q:'+SDECIEN  D
"RTN","SDEC01C",213,0)
 . . S SDECNOS=SDECNOS_$G(^SDEC(409.831,SDECRES,2,SDCL,12,SDECIEN,0))
"RTN","SDEC01C",214,0)
 . . S SDECNOS=SDECNOS_$C(13)_$C(10)
"RTN","SDEC01C",215,0)
 S SDECCAN=""
"RTN","SDEC01C",216,0)
 I $D(^SDEC(409.831,SDECRES,13)) D
"RTN","SDEC01C",217,0)
 . S SDECIEN=0 F  S SDECIEN=$O(^SDEC(409.831,SDECRES,2,SDCL,13,SDECIEN)) Q:'+SDECIEN  D
"RTN","SDEC01C",218,0)
 . . S SDECCAN=SDECCAN_$G(^SDEC(409.831,SDECRES,2,SDCL,13,SDECIEN,0))
"RTN","SDEC01C",219,0)
 . . S SDECCAN=SDECCAN_$C(13)_$C(10)
"RTN","SDEC01C",220,0)
 Q
"RTN","SDEC01C",221,0)
 ;
"RTN","SDEC01C",222,0)
CHK(SDECP,SDECRES)  ;alb/sat 658 - stop if 'this' record found in abbreviations
"RTN","SDEC01C",223,0)
 N FND,SDR,SDX
"RTN","SDEC01C",224,0)
 S FND=0
"RTN","SDEC01C",225,0)
 S SDX=$$GETSUB^SDEC56(SDECP)
"RTN","SDEC01C",226,0)
 F  S SDX=$O(^SDEC(409.831,"C",SDX)) Q:SDX=""  Q:SDX'[SDECP  D  Q:+FND
"RTN","SDEC01C",227,0)
 .S SDR=0 F  S SDR=$O(^SDEC(409.831,"C",SDX,SDR)) Q:'+SDR  S FND=SDR=SDECRES  Q:+FND
"RTN","SDEC01C",228,0)
 Q FND
"RTN","SDEC07")
0^10^B201524444^B200567128
"RTN","SDEC07",1,0)
SDEC07 ;ALB/SAT - VISTA SCHEDULING RPCS ; 11 Sep 2018  1:45 PM
"RTN","SDEC07",2,0)
 ;;5.3;Scheduling;**627,642,651,658,665,669,671,672,701,686**;Aug 13, 1993;Build 53
"RTN","SDEC07",3,0)
 ;
"RTN","SDEC07",4,0)
 ;Reference is made to ICR #4837
"RTN","SDEC07",5,0)
 Q
"RTN","SDEC07",6,0)
 ;
"RTN","SDEC07",7,0)
APPADD(SDECY,SDECSTART,SDECEND,DFN,SDECRES,SDECLEN,SDECNOTE,SDECATID,SDECCR,SDMRTC,SDDDT,SDREQBY,SDLAB,PROVIEN,SDID,SDAPTYP,SDSVCP,SDSVCPR,SDCL,SDEKG,SDXRAY,APPTYPE,EESTAT,OVB,SDPARENT,SDEL) ;ADD NEW APPOINTMENT
"RTN","SDEC07",8,0)
 ;
"RTN","SDEC07",9,0)
 N SDAPPTYP
"RTN","SDEC07",10,0)
 N SDECERR,SDECIEN,SDECDEP,SDECI,SDECJ,SDECAPPTI,SDECDJ,SDECRESD,SDECRNOD,SDECC,SDECERR,SDECWKIN
"RTN","SDEC07",11,0)
 N SDECNOEV,SDECDEV,SDECDERR,SDECTMP,SAVESTRT,SDAREQ0
"RTN","SDEC07",12,0)
 N %DT,X,Y,DGQUIET,OBM,RET
"RTN","SDEC07",13,0)
 N SDOE  ;alb/sat 672
"RTN","SDEC07",14,0)
 S SDECNOEV=1 ;Don't execute SDEC ADD APPOINTMENT protocol
"RTN","SDEC07",15,0)
 K ^TMP("SDEC07",$J)
"RTN","SDEC07",16,0)
 S SDECERR=0
"RTN","SDEC07",17,0)
 S SDECI=0
"RTN","SDEC07",18,0)
 S SDECY="^TMP(""SDEC07"","_$J_")"
"RTN","SDEC07",19,0)
 S ^TMP("SDEC07",$J,SDECI)="I00020APPOINTMENTID^T00020ERRORID"_$C(30)
"RTN","SDEC07",20,0)
 S SDECI=SDECI+1
"RTN","SDEC07",21,0)
 ;Check input data for errors
"RTN","SDEC07",22,0)
 S SDAREQ0=$G(^SDEC(409.85,+$P(SDAPTYP,"|",2),0))
"RTN","SDEC07",23,0)
 ;
"RTN","SDEC07",24,0)
 ;  Only check if RTC is closed if request is APPT. 686 12/17/18 WTC
"RTN","SDEC07",25,0)
 ;
"RTN","SDEC07",26,0)
 I $P(SDAPTYP,"|",1)="A" S SDAREQ0=$G(^SDEC(409.85,+$P(SDAPTYP,"|",2),0)) I $P(SDAREQ0,U,5)="RTC",$P(SDAREQ0,U,17)="C" D ERR(SDECI+1,"SDEC07 Error: This RTC request has been closed.") Q  ;
"RTN","SDEC07",27,0)
 ;
"RTN","SDEC07",28,0)
 S SAVESTRT=SDECSTART         ;MGH save date/time for consult request
"RTN","SDEC07",29,0)
 S:SDECSTART["@0000" SDECSTART=$P(SDECSTART,"@")
"RTN","SDEC07",30,0)
 S:SDECEND["@0000" SDECEND=$P(SDECEND,"@")
"RTN","SDEC07",31,0)
 S %DT="RXT",X=SDECSTART D ^%DT S SDECSTART=Y
"RTN","SDEC07",32,0)
 I SDECSTART=-1 D ERR(SDECI+1,"SDEC07 Error: Invalid Start Time") Q
"RTN","SDEC07",33,0)
 S %DT="RXT",X=SDECEND D ^%DT S SDECEND=Y
"RTN","SDEC07",34,0)
 I SDECEND=-1 D ERR(SDECI+1,"SDEC07 Error: Invalid End Time") Q
"RTN","SDEC07",35,0)
 I $L(SDECEND,".")=1 D ERR(SDECI+1,"SDEC07 Error: Invalid End Time") Q
"RTN","SDEC07",36,0)
 I SDECSTART>SDECEND S SDECTMP=SDECEND,SDECEND=SDECSTART,SDECSTART=SDECTMP
"RTN","SDEC07",37,0)
 S DFN=$G(DFN)
"RTN","SDEC07",38,0)
 I DFN="" D ERR(SDECI+1,"SDEC07: Patient ID required.") Q
"RTN","SDEC07",39,0)
 I '$D(^DPT(DFN,0)) D ERR(SDECI+1,"SDEC07 Error: Invalid Patient ID") Q
"RTN","SDEC07",40,0)
 L +^DPT(DFN):3 I '$T D ERR(SDECI+1,"Patient is being edited. Try again later.") Q   ;alb/sat 665
"RTN","SDEC07",41,0)
 ;
"RTN","SDEC07",42,0)
 ;  Reject if another appointment already scheduled at the same time.  wtc 686 11/30/18
"RTN","SDEC07",43,0)
 ;
"RTN","SDEC07",44,0)
 I $D(^DPT(DFN,"S",SDECSTART)),$P(^(SDECSTART,0),U,2)'="C",$P(^(0),U,2)'="PC" D ERR(SDECI+1,"Appointment in "_$P(^SC($P(^(0),U,1),0),U,1)_" already scheduled at the same time.") Q  ;
"RTN","SDEC07",45,0)
 ;
"RTN","SDEC07",46,0)
 ;Validate Resource
"RTN","SDEC07",47,0)
 S SDECERR=0 K SDECRESD
"RTN","SDEC07",48,0)
 S SDECRES=$G(SDECRES)
"RTN","SDEC07",49,0)
 I +SDECRES,'$D(^SDEC(409.831,SDECRES,0)) D ERR(SDECI+1,"SDEC07 Error: Invalid Resource ID") Q
"RTN","SDEC07",50,0)
 I '+SDECRES,'$D(^SDEC(409.831,"B",SDECRES)) D ERR(SDECI+1,"SDEC07 Error: Invalid Resource ID") Q
"RTN","SDEC07",51,0)
 S SDECRESD=$S(+SDECRES:+SDECRES,1:$O(^SDEC(409.831,"B",SDECRES,0)))
"RTN","SDEC07",52,0)
 S SDECRNOD=$G(^SDEC(409.831,SDECRESD,0))
"RTN","SDEC07",53,0)
 I SDECRNOD="" D ERR(SDECI+1,"SDEC07 Error: Unable to add appointment -- invalid Resource entry.") Q
"RTN","SDEC07",54,0)
 ;
"RTN","SDEC07",55,0)
 ;  Check that appointment date is not later than clinic permits or 390 days in future if no limit in clinic file (#44).
"RTN","SDEC07",56,0)
 ;
"RTN","SDEC07",57,0)
 ;  wtc 6/18/18 SD*5.3*701
"RTN","SDEC07",58,0)
 ;
"RTN","SDEC07",59,0)
 N PTR44,MAXDAYS S PTR44=$P(SDECRNOD,"^",4),MAXDAYS=390 ;
"RTN","SDEC07",60,0)
 I +PTR44,$D(^SC(PTR44,"SDP")) S MAXDAYS=$P(^("SDP"),"^",2) S:MAXDAYS="" MAXDAYS=390 ;
"RTN","SDEC07",61,0)
 I SDECSTART>$$FMADD^XLFDT($$NOW^XLFDT(),MAXDAYS) D ERR(SDECI+1,"Appointment date too far in the future") Q  ;
"RTN","SDEC07",62,0)
 ;
"RTN","SDEC07",63,0)
 S SDECWKIN=0
"RTN","SDEC07",64,0)
 S SDECATID=$G(SDECATID)
"RTN","SDEC07",65,0)
 I SDECATID="WALKIN" S SDECWKIN=1
"RTN","SDEC07",66,0)
 I SDECATID'?.N&(SDECATID'="WALKIN") S SDECATID=""
"RTN","SDEC07",67,0)
 ;validate appointment length - if passed in, must be 5-120
"RTN","SDEC07",68,0)
 S SDECLEN=$G(SDECLEN)
"RTN","SDEC07",69,0)
 ;I SDECLEN'="",(+SDECLEN<5)!(SDECLEN>120) D ERR(SDECI+1,"SDEC07 Error: Appointment length must be between 5 - 120.") Q
"RTN","SDEC07",70,0)
 ;validate MTRC flag (optional)
"RTN","SDEC07",71,0)
 S SDMRTC=$$UP^XLFSTR($G(SDMRTC))
"RTN","SDEC07",72,0)
 S SDMRTC=$S(SDMRTC="TRUE":1,1:0)
"RTN","SDEC07",73,0)
 ;validate desired date of appt (optional)
"RTN","SDEC07",74,0)
 S SDDDT=$G(SDDDT)
"RTN","SDEC07",75,0)
 I SDDDT'="" S %DT="" S X=$P(SDDDT,"@",1) D ^%DT S SDDDT=Y I Y=-1 S SDDDT=""
"RTN","SDEC07",76,0)
 I SDDDT="",SDECATID'="WALKIN" S SDDDT=$P(SDECSTART,".",1)
"RTN","SDEC07",77,0)
 ;validate requested by
"RTN","SDEC07",78,0)
 S SDREQBY=$$UP^XLFSTR($G(SDREQBY))
"RTN","SDEC07",79,0)
 I SDREQBY'="" S SDREQBY=$S(SDREQBY="PROVIDER":1,SDREQBY="PATIENT":2,1:0)
"RTN","SDEC07",80,0)
 ;validate lab date/time (optional)
"RTN","SDEC07",81,0)
 S SDLAB=$G(SDLAB)
"RTN","SDEC07",82,0)
 I SDLAB'="" S %DT="T" S X=SDLAB D ^%DT S SDLAB=Y I Y=-1 S SDLAB=""
"RTN","SDEC07",83,0)
 ;validate EKG date/time (optional)
"RTN","SDEC07",84,0)
 S SDEKG=$G(SDEKG)
"RTN","SDEC07",85,0)
 I SDEKG'="" S %DT="T" S X=SDEKG D ^%DT S SDEKG=Y I Y=-1 S SDEKG=""
"RTN","SDEC07",86,0)
 ;validate XRAY date/time (optional)
"RTN","SDEC07",87,0)
 S SDXRAY=$G(SDXRAY)
"RTN","SDEC07",88,0)
 I SDXRAY'="" S %DT="T" S X=SDXRAY D ^%DT S SDXRAY=Y I Y=-1 S SDXRAY=""
"RTN","SDEC07",89,0)
 ;validate provider
"RTN","SDEC07",90,0)
 I '$D(^VA(200,+$G(PROVIEN),0)) S PROVIEN=""
"RTN","SDEC07",91,0)
 S SDID=$G(SDID)
"RTN","SDEC07",92,0)
 ;validate clinic
"RTN","SDEC07",93,0)
 S SDCL=$G(SDCL)
"RTN","SDEC07",94,0)
 I SDCL'="" I '$D(^SC(SDCL,0)) S SDCL=""
"RTN","SDEC07",95,0)
 I SDCL="" S SDCL=$$GET1^DIQ(409.831,SDECRESD_",",.04,"I")   ;clinic ID   ;support for single HOSPITAL LOCATION in SDEC RESOURCE
"RTN","SDEC07",96,0)
 S OVB=+$G(OVB)  ;alb/sat 665
"RTN","SDEC07",97,0)
 I 'OVB S OBM=$$OBM1^SDEC57(SDCL,SDECSTART,SDMRTC,,+SDECWKIN) I OBM'="",+OBM'=1 S SDECAPPTID=0 D ERR(SDECI+1,"OBM"_OBM) Q   ;alb/sat 658 check if overbook ;alb/sat 665 clear SDECAPPTID
"RTN","SDEC07",98,0)
 ;validate appt request type (required)
"RTN","SDEC07",99,0)
 S SDAPTYP=$G(SDAPTYP)
"RTN","SDEC07",100,0)
 I SDAPTYP'="" D
"RTN","SDEC07",101,0)
 .I $P(SDAPTYP,"|",1)="E" I '$D(^SDWL(409.3,+$P(SDAPTYP,"|",2),0)) S SDAPTYP=""
"RTN","SDEC07",102,0)
 .I $P(SDAPTYP,"|",1)="R" I '$D(^SD(403.5,+$P(SDAPTYP,"|",2),0)) S SDAPTYP=""
"RTN","SDEC07",103,0)
 .I $P(SDAPTYP,"|",1)="C" I '$D(^GMR(123,+$P(SDAPTYP,"|",2),0)) S SDAPTYP=""  ;ICR 4837
"RTN","SDEC07",104,0)
 .I $P(SDAPTYP,"|",1)="A" I '$D(^SDEC(409.85,+$P(SDAPTYP,"|",2),0)) S SDAPTYP=""
"RTN","SDEC07",105,0)
 .;I SDAPTYP="" D ERR(SDECI+1,"SDEC07 Error: Invalid appointment request type.") Q   ;support for multiple HOSPITAL LOCATIONs are implemented in SDEC RESOURCE
"RTN","SDEC07",106,0)
 I SDCL="" D
"RTN","SDEC07",107,0)
 .S:$P(SDAPTYP,"|",1)="E" SDCL=$$GET1^DIQ(409.3,$P(SDAPTYP,"|",2)_",",13.2,"I")
"RTN","SDEC07",108,0)
 .S:$P(SDAPTYP,"|",1)="R" SDCL=$$GET1^DIQ(403.5,$P(SDAPTYP,"|",2)_",",4.5,"I")
"RTN","SDEC07",109,0)
 .S:$P(SDAPTYP,"|",1)="C" SDCL=$P($G(^GMR(123,+$P(SDAPTYP,"|",2),0)),U,4)       ;ICR 4837 ICR states 'Zero node read into variable'
"RTN","SDEC07",110,0)
 .S:$P(SDAPTYP,"|",1)="A" SDCL=$$GET1^DIQ(409.85,$P(SDAPTYP,"|",2)_",",8,"I")
"RTN","SDEC07",111,0)
 I SDCL="" D ERR(SDECI+1,"SDEC07 Error: Invalid clinic ID.") Q
"RTN","SDEC07",112,0)
 I $$INACTIVE^SDEC32(SDCL) D ERR(SDECI+1,"SDEC07 Error: "_$$GET1^DIQ(44,SDCL_",",.01)_" is an inactive clinic.") Q
"RTN","SDEC07",113,0)
 ;
"RTN","SDEC07",114,0)
 ;   Reject if consult is is not active or pending.  SD*5.3*686
"RTN","SDEC07",115,0)
 ;
"RTN","SDEC07",116,0)
 I $P(SDAPTYP,"|",1)="C" N CNSLTSTS,NOTOK S CNSLTSTS=$P($G(^GMR(123,+$P(SDAPTYP,"|",2),0)),U,12),NOTOK=0 D  Q:NOTOK  ;
"RTN","SDEC07",117,0)
 . I CNSLTSTS'=5,CNSLTSTS'=6 D ERR(SDECI+1,"Consult status is not PENDING or ACTIVE.  It cannot be scheduled.") S NOTOK=1 Q  ;
"RTN","SDEC07",118,0)
 ;
"RTN","SDEC07",119,0)
 ;validate service connected
"RTN","SDEC07",120,0)
 S SDSVCPR=$G(SDSVCPR)
"RTN","SDEC07",121,0)
 I SDSVCPR'="" S:(+SDSVCPR<0)!(+SDSVCPR>100) SDSVCPR=""
"RTN","SDEC07",122,0)
 S SDSVCP=$G(SDSVCP)
"RTN","SDEC07",123,0)
 S SDSVCP=$S(SDSVCP=0:0,SDSVCP="NO":0,SDSVCP=1:1,SDSVCP="YES":1,1:"")
"RTN","SDEC07",124,0)
 ;validate note
"RTN","SDEC07",125,0)
 S SDECNOTE=$G(SDECNOTE) S:SDECNOTE'="" SDECNOTE=$TR($E(SDECNOTE,1,150),"^"," ")   ;alb/sat 658 - only use 1st 150 characters
"RTN","SDEC07",126,0)
 ;validate APPTYPE
"RTN","SDEC07",127,0)
 S APPTYPE=$G(APPTYPE) I APPTYPE'="",'$D(^SD(409.1,+APPTYPE,0)) S APPTYPE=""
"RTN","SDEC07",128,0)
 ;validate Patient Status (EESTAT)
"RTN","SDEC07",129,0)
 S EESTAT=$G(EESTAT)
"RTN","SDEC07",130,0)
 I EESTAT="" D
"RTN","SDEC07",131,0)
 .I $P(SDAPTYP,"|",1)="E" S EESTAT=$$GET1^DIQ(409.3,$P(SDAPTYP,"|",2)_",",27,"I")
"RTN","SDEC07",132,0)
 .I $P(SDAPTYP,"|",1)="A" S EESTAT=$$GET1^DIQ(409.3,$P(SDAPTYP,"|",2)_",",.02,"I")
"RTN","SDEC07",133,0)
 S EESTAT=$S(EESTAT="N":"N",EESTAT="NEW":"N",EESTAT="E":"E",EESTAT="ESTABLISHED":"E",1:"")
"RTN","SDEC07",134,0)
 ;validate OVB (overbook)
"RTN","SDEC07",135,0)
 S OVB=+$G(OVB)
"RTN","SDEC07",136,0)
 I 'OVB D
"RTN","SDEC07",137,0)
 .D OVBOOK^SDEC07A(.RET,SDCL,SDECSTART,SDECRES)
"RTN","SDEC07",138,0)
 D
"RTN","SDEC07",139,0)
 .S SDAPPTYP=+APPTYPE
"RTN","SDEC07",140,0)
 .I 'SDAPPTYP D
"RTN","SDEC07",141,0)
 ..I $P(SDAPTYP,"|",1)="E" S SDAPPTYP=$$GET1^DIQ(409.3,+$P(SDAPTYP,"|",2)_",",8.7,"I")
"RTN","SDEC07",142,0)
 ..I $P(SDAPTYP,"|",1)="A" S SDAPPTYP=$$GET1^DIQ(409.85,+$P(SDAPTYP,"|",2)_",",8.7,"I")
"RTN","SDEC07",143,0)
 ..I $P(SDAPTYP,"|",1)="C",+APPTYPE S SDAPPTYP=+APPTYPE
"RTN","SDEC07",144,0)
 .S:'SDAPPTYP SDAPPTYP=$O(^SD(409.1,"B","REGULAR",0))
"RTN","SDEC07",145,0)
 ;Lock SDEC node
"RTN","SDEC07",146,0)
 L +^SDEC(409.84,DFN):5 I '$T D ERR(SDECI+1,"Another user is working with this patient's record.  Please try again later") Q
"RTN","SDEC07",147,0)
 ;
"RTN","SDEC07",148,0)
 ;TSTART
"RTN","SDEC07",149,0)
 S SDECAPPTID=$$SDECADD(SDECSTART,SDECEND,DFN,SDECRESD,SDECATID,SDDDT,SDID,SDAPTYP,PROVIEN,SDCL,SDECNOTE,SAVESTRT,SDECRES,SDAPPTYP,EESTAT,1,+SDECLEN)  ;alb/sat 665 add SDECLEN
"RTN","SDEC07",150,0)
 I 'SDECAPPTID D ERR(SDECI+1,"SDEC07 Error: Unable to add appointment to SDEC APPOINTMENT file.") Q
"RTN","SDEC07",151,0)
 ;Save the Appointment and start a new transaction that will get rolled back if there's an error
"RTN","SDEC07",152,0)
 ;TCOMMIT
"RTN","SDEC07",153,0)
 ;TSTART
"RTN","SDEC07",154,0)
 ; call chart request
"RTN","SDEC07",155,0)
 S SDECDEV=""  ;$$GET1^DIQ(9009020.2,$$DIV^SDECU,.05) I SDECDEV="" S SDECDERR="SDEC07 Error: No file room printer is defined for the chart request."
"RTN","SDEC07",156,0)
 I SDECATID="WALKIN",$G(SDECCR),$G(SDECDEV)'="" S DGQUIET=1 D WISD^SDECRT(DFN,$P(SDECSTART,"."),"",SDECDEV)
"RTN","SDEC07",157,0)
 I SDECNOTE]"" D SDECWP(SDECAPPTID,SDECNOTE)
"RTN","SDEC07",158,0)
 ;
"RTN","SDEC07",159,0)
 ;Create Appointment in VistA ;TODO: have this call APPVISTA^SDEC07B
"RTN","SDEC07",160,0)
 I +SDCL,$D(^SC(SDCL,0)) D  I +SDECERR D ERR(SDECI+1,$P(SDECERR,U,2))
"RTN","SDEC07",161,0)
 . S SDECC("PAT")=DFN
"RTN","SDEC07",162,0)
 . S SDECC("CLN")=SDCL
"RTN","SDEC07",163,0)
 . S SDECC("TYP")=$S(+SDECWKIN:4,SDAPPTYP=1:1,1:3)   ;3 for scheduled appts, 4 for walkins
"RTN","SDEC07",164,0)
 . S SDECC("COL")=$S(SDAPPTYP=7:1,1:"")   ;collateral visit if appointment type is COLLATERAL OF VET.
"RTN","SDEC07",165,0)
 . S SDECC("APT")=SDAPPTYP
"RTN","SDEC07",166,0)
 . S SDECC("ADT")=SDECSTART
"RTN","SDEC07",167,0)
 . S SDECC("LEN")=SDECLEN
"RTN","SDEC07",168,0)
 . S SDECC("OI")=$E($G(SDECNOTE),1,150) ;File 44 has 150 character limit on OTHER field
"RTN","SDEC07",169,0)
 . S SDECC("OI")=$TR(SDECC("OI"),";"," ") ;No semicolons allowed
"RTN","SDEC07",170,0)
 . S SDECC("OI")=$$STRIP(SDECC("OI")) ;Strip control characters from note
"RTN","SDEC07",171,0)
 . S SDECC("RES")=SDECRESD
"RTN","SDEC07",172,0)
 . S SDECC("USR")=DUZ
"RTN","SDEC07",173,0)
 . S SDECC("MTR")=$G(SDMRTC)
"RTN","SDEC07",174,0)
 . S SDECC("DDT")=SDDDT
"RTN","SDEC07",175,0)
 . S SDECC("REQ")=SDREQBY
"RTN","SDEC07",176,0)
 . S SDECC("LAB")=SDLAB
"RTN","SDEC07",177,0)
 . S SDECC("XRA")=SDXRAY
"RTN","SDEC07",178,0)
 . S SDECC("EKG")=SDEKG
"RTN","SDEC07",179,0)
 . S SDECC("OVB")=+OVB
"RTN","SDEC07",180,0)
 . S SDECC("ELG")=SDEL
"RTN","SDEC07",181,0)
 . S:$P(SDAPTYP,"|",1)="C" SDECC("CON")=$P(SDAPTYP,"|",2)
"RTN","SDEC07",182,0)
 . S SDECERR=$$MAKE^SDEC07B(.SDECC)
"RTN","SDEC07",183,0)
 . Q:SDECERR
"RTN","SDEC07",184,0)
 . ;Update Clinic availability
"RTN","SDEC07",185,0)
 . D AVUPDT(SDCL,SDECSTART,SDECLEN)
"RTN","SDEC07",186,0)
 . ;L
"RTN","SDEC07",187,0)
 . Q
"RTN","SDEC07",188,0)
 ;update wait list
"RTN","SDEC07",189,0)
 I $P(SDAPTYP,"|",1)="E" D EWL^SDEC07A($P(SDAPTYP,"|",2),SDECSTART,SDCL,SDSVCPR,SDSVCP,,SDAPPTYP)  ;alb/sat 658 do not pass note
"RTN","SDEC07",190,0)
 ;update appt request
"RTN","SDEC07",191,0)
 I $P(SDAPTYP,"|",1)="A" D
"RTN","SDEC07",192,0)
 .D UPDATE^SDECAR2($P(SDAPTYP,"|",2),SDECSTART,SDCL,SDSVCPR,SDSVCP,,SDAPPTYP)  ;alb/sat 658 do not pass note
"RTN","SDEC07",193,0)
 .I $G(SDMRTC),$G(SDPARENT) D AR433^SDECAR2(SDPARENT,SDECAPPTID_"~"_$P(SDAPTYP,"|",2))
"RTN","SDEC07",194,0)
 .D:$G(SDPARENT) AR438^SDECAR2($P(SDAPTYP,"|",2),SDPARENT)
"RTN","SDEC07",195,0)
 N SDT S SDT=SDECSTART
"RTN","SDEC07",196,0)
 ;add entry to OUTPATIENT ENCOUNTER file (#409.68)  ;alb/sat 672
"RTN","SDEC07",197,0)
 I $$NEW^SDPCE(SDT) D
"RTN","SDEC07",198,0)
 .N SDCOED
"RTN","SDEC07",199,0)
 .S SDOE=$$GETAPT^SDVSIT2(DFN,SDT,SDCL)
"RTN","SDEC07",200,0)
 ;
"RTN","SDEC07",201,0)
 ;Return Recordset
"RTN","SDEC07",202,0)
 ;TCOMMIT
"RTN","SDEC07",203,0)
 L -^SDEC(409.84,DFN)
"RTN","SDEC07",204,0)
 L -^DPT(DFN)
"RTN","SDEC07",205,0)
 S SDECI=SDECI+1
"RTN","SDEC07",206,0)
 S ^TMP("SDEC07",$J,SDECI)=SDECAPPTID_"^"_$G(SDECDERR)_$C(30)
"RTN","SDEC07",207,0)
 S SDECI=SDECI+1
"RTN","SDEC07",208,0)
 S ^TMP("SDEC07",$J,SDECI)=$C(31)
"RTN","SDEC07",209,0)
 Q
"RTN","SDEC07",210,0)
 ;
"RTN","SDEC07",211,0)
STRIP(SDECZ) ;Replace control characters with spaces
"RTN","SDEC07",212,0)
 N SDECI
"RTN","SDEC07",213,0)
 F SDECI=1:1:$L(SDECZ) I (32>$A($E(SDECZ,SDECI))) S SDECZ=$E(SDECZ,1,SDECI-1)_" "_$E(SDECZ,SDECI+1,999)
"RTN","SDEC07",214,0)
 Q SDECZ
"RTN","SDEC07",215,0)
 ;
"RTN","SDEC07",216,0)
 ;ADD SDEC APPOINTMENT ENTRY
"RTN","SDEC07",217,0)
SDECADD(SDECSTART,SDECEND,DFN,SDECRESD,SDECATID,SDDDT,SDID,SDAPTYP,PROVIEN,SDCL,SDECNOTE,SAVESTRT,SDECRES,SDAPPTYP,EESTAT,SDF,SDECLEN) ;alb/sat 665 add SDECLEN
"RTN","SDEC07",218,0)
 ;SDF       - (optional) flags
"RTN","SDEC07",219,0)
 ;                       1. called from GUI (update consult only if called from GUI)
"RTN","SDEC07",220,0)
 ;Returns ien in SDECAPPT or 0 if failed
"RTN","SDEC07",221,0)
 ;called from SDEC APPADD rpc and from VistA via SDM1A
"RTN","SDEC07",222,0)
 ;Create entry in SDEC APPOINTMENT
"RTN","SDEC07",223,0)
 N SDIEN,SDECAPPTID,SDECFDA,SDECIEN,SDECMSG,SL,X
"RTN","SDEC07",224,0)
 S SDECSTART=$G(SDECSTART)
"RTN","SDEC07",225,0)
 S SAVESTRT=$G(SAVESTRT),SDECRES=$G(SDECRES)         ;MGH save date/time for consult request
"RTN","SDEC07",226,0)
 S DFN=$G(DFN)
"RTN","SDEC07",227,0)
 S SDECRESD=$G(SDECRESD)
"RTN","SDEC07",228,0)
 S SDECATID=$G(SDECATID)
"RTN","SDEC07",229,0)
 S SDDDT=$G(SDDDT)
"RTN","SDEC07",230,0)
 S SDID=$G(SDID)
"RTN","SDEC07",231,0)
 S SDAPTYP=$G(SDAPTYP)
"RTN","SDEC07",232,0)
 S SDAPPTYP=$G(SDAPPTYP)
"RTN","SDEC07",233,0)
 S PROVIEN=$G(PROVIEN)
"RTN","SDEC07",234,0)
 S SDCL=$G(SDCL)
"RTN","SDEC07",235,0)
 S SDECEND=$G(SDECEND)
"RTN","SDEC07",236,0)
 ;alb/sat 665 begin modification
"RTN","SDEC07",237,0)
 S SDECLEN=$G(SDECLEN)
"RTN","SDEC07",238,0)
 I SDECLEN="",SDECEND="" S SDECLEN=+$G(^SC(SDCL,"SL")) S:'+SDECLEN SDECLEN=30 S SDECEND=$$FMADD^XLFDT(SDECSTART,,,+SDECLEN)   ;no length or end date/time
"RTN","SDEC07",239,0)
 I SDECLEN="",SDECEND'="" S SDECLEN=$$FMDIFF^XLFDT(SDECEND,SDECSTART,2)\60  ;no length
"RTN","SDEC07",240,0)
 I SDECLEN'="",SDECEND="" S SDECEND=$$FMADD^XLFDT(SDECSTART,,,+SDECLEN)  ;no end date/time
"RTN","SDEC07",241,0)
 ;alb/sat 665 end modification
"RTN","SDEC07",242,0)
 S SDECNOTE=$G(SDECNOTE)
"RTN","SDEC07",243,0)
 S SDF=$G(SDF,0)
"RTN","SDEC07",244,0)
 I PROVIEN="" D
"RTN","SDEC07",245,0)
 .S PROVIEN=$$GET1^DIQ(44,SDCL_",",16,"I")
"RTN","SDEC07",246,0)
 S SDIEN=$$APPTGET^SDECUTL(DFN,SDECSTART,SDCL)
"RTN","SDEC07",247,0)
 S SDIEN=$S(SDIEN'="":SDIEN_",",1:"+1,")
"RTN","SDEC07",248,0)
 S SDECFDA(409.84,SDIEN,.01)=SDECSTART
"RTN","SDEC07",249,0)
 S SDECFDA(409.84,SDIEN,.02)=SDECEND
"RTN","SDEC07",250,0)
 S SDECFDA(409.84,SDIEN,.03)="@" ;*zeb+22 686 3/20/19 clear data from overlaid appointments
"RTN","SDEC07",251,0)
 S SDECFDA(409.84,SDIEN,.04)="@"
"RTN","SDEC07",252,0)
 S SDECFDA(409.84,SDIEN,.05)=DFN
"RTN","SDEC07",253,0)
 S SDECFDA(409.84,SDIEN,.06)=$S(+SDAPPTYP:SDAPPTYP,1:"@")
"RTN","SDEC07",254,0)
 S SDECFDA(409.84,SDIEN,.07)=SDECRESD
"RTN","SDEC07",255,0)
 S SDECFDA(409.84,SDIEN,.08)=$G(DUZ)
"RTN","SDEC07",256,0)
 S SDECFDA(409.84,SDIEN,.09)=$P($$NOW^XLFDT,".",1)
"RTN","SDEC07",257,0)
 S SDECFDA(409.84,SDIEN,.1)="@"
"RTN","SDEC07",258,0)
 S SDECFDA(409.84,SDIEN,.101)="@"
"RTN","SDEC07",259,0)
 S SDECFDA(409.84,SDIEN,.102)="@"
"RTN","SDEC07",260,0)
 S SDECFDA(409.84,SDIEN,.11)="@"
"RTN","SDEC07",261,0)
 S SDECFDA(409.84,SDIEN,.12)="@"
"RTN","SDEC07",262,0)
 S SDECFDA(409.84,SDIEN,.121)="@"
"RTN","SDEC07",263,0)
 S SDECFDA(409.84,SDIEN,.122)="@"
"RTN","SDEC07",264,0)
 S SDECFDA(409.84,SDIEN,.13)=$S(SDECATID="WALKIN":"y",1:"@")
"RTN","SDEC07",265,0)
 S SDECFDA(409.84,SDIEN,.14)="@"
"RTN","SDEC07",266,0)
 S SDECFDA(409.84,SDIEN,.16)=$S(PROVIEN'="":PROVIEN,1:"@")
"RTN","SDEC07",267,0)
 S SDECFDA(409.84,SDIEN,.17)="@"
"RTN","SDEC07",268,0)
 S SDECFDA(409.84,SDIEN,.18)=$S($G(SDECLEN)'="":SDECLEN,1:"@")
"RTN","SDEC07",269,0)
 S SDECFDA(409.84,SDIEN,.2)=SDDDT
"RTN","SDEC07",270,0)
 S SDECFDA(409.84,SDIEN,.21)=$S($G(SDID)'="":SDID,1:"@")
"RTN","SDEC07",271,0)
 S SDECFDA(409.84,SDIEN,.22)=$S(SDAPTYP'="":$P(SDAPTYP,"|",2)_";"_$S($P(SDAPTYP,"|",1)="E":"SDWL(409.3,",$P(SDAPTYP,"|",1)="C":"GMR(123,",$P(SDAPTYP,"|",1)="R":"SD(403.5,",$P(SDAPTYP,"|",1)="A":"SDEC(409.85,",1:""),1:"@")
"RTN","SDEC07",272,0)
 S SDECFDA(409.84,SDIEN,.23)=$S($G(EESTAT)'="":EESTAT,1:"@")
"RTN","SDEC07",273,0)
 K SDECIEN,SDECMSG
"RTN","SDEC07",274,0)
 D UPDATE^DIE("","SDECFDA","SDECIEN","SDECMSG")
"RTN","SDEC07",275,0)
 S SDECAPPTID=$S(SDIEN'="+1,":+SDIEN,1:+$G(SDECIEN(1)))
"RTN","SDEC07",276,0)
 K SDECMSG
"RTN","SDEC07",277,0)
 I SDECNOTE="" D WP^DIE(409.84,$S(+$G(SDECAPPTID):SDECAPPTID_",",1:SDIEN_","),1,"","@","SDECMSG")
"RTN","SDEC07",278,0)
 I SDECNOTE'="" N ARR D WP^SDECUTL(.ARR,SDECNOTE) D WP^DIE(409.84,$S(+$G(SDECAPPTID):SDECAPPTID_",",1:SDIEN_","),1,"","ARR","SDECMSG")
"RTN","SDEC07",279,0)
 I SDECAPPTID'="" D
"RTN","SDEC07",280,0)
 .I $P(SDAPTYP,"|",1)="C",SDF D
"RTN","SDEC07",281,0)
 ..D REQSET^SDEC07A($P(SDAPTYP,"|",2),PROVIEN,"",1,"",SDECNOTE,SAVESTRT,SDECRES)   ;MGH added 3 parameters to this call
"RTN","SDEC07",282,0)
 Q SDECAPPTID
"RTN","SDEC07",283,0)
 ;
"RTN","SDEC07",284,0)
SDECWP(SDECAPPTID,SDECNOTE) ;
"RTN","SDEC07",285,0)
 ;Add WP field
"RTN","SDEC07",286,0)
 I SDECNOTE]"" S SDECNOTE(.5)=SDECNOTE,SDECNOTE=""
"RTN","SDEC07",287,0)
 I $D(SDECNOTE(0)) S SDECNOTE(.5)=SDECNOTE(0) K SDECNOTE(0)
"RTN","SDEC07",288,0)
 I $D(SDECNOTE(.5)) D
"RTN","SDEC07",289,0)
 . D WP^DIE(409.84,SDECAPPTID_",",1,"","SDECNOTE","SDECMSG")
"RTN","SDEC07",290,0)
 Q
"RTN","SDEC07",291,0)
 ;
"RTN","SDEC07",292,0)
ERR(SDECI,SDECERR) ;Error processing
"RTN","SDEC07",293,0)
 S SDECI=SDECI+1
"RTN","SDEC07",294,0)
 S SDECERR=$TR(SDECERR,"^","~")
"RTN","SDEC07",295,0)
 S ^TMP("SDEC07",$J,SDECI)=$G(SDECAPPTID,0)_"^"_SDECERR_$C(30)
"RTN","SDEC07",296,0)
 S SDECI=SDECI+1
"RTN","SDEC07",297,0)
 S ^TMP("SDEC07",$J,SDECI)=$C(31)
"RTN","SDEC07",298,0)
 L
"RTN","SDEC07",299,0)
 Q
"RTN","SDEC07",300,0)
 ;
"RTN","SDEC07",301,0)
ETRAP ;EP Error trap entry
"RTN","SDEC07",302,0)
 D ^%ZTER
"RTN","SDEC07",303,0)
 I '$D(SDECI) N SDECI S SDECI=999999
"RTN","SDEC07",304,0)
 S SDECI=SDECI+1
"RTN","SDEC07",305,0)
 D ERR(SDECI,"SDEC07 Error")
"RTN","SDEC07",306,0)
 Q
"RTN","SDEC07",307,0)
DAY ;;^SUN^MON^TUES^WEDNES^THURS^FRI^SATUR
"RTN","SDEC07",308,0)
 ;
"RTN","SDEC07",309,0)
DOW N SDTMP S SDTMP=$E(X,1,3),Y=$E(X,4,5),Y=Y>2&'(SDTMP#4)+$E("144025036146",Y)
"RTN","SDEC07",310,0)
 F SDTMP=SDTMP:-1:281 S Y=SDTMP#4=1+1+Y
"RTN","SDEC07",311,0)
 S Y=$E(X,6,7)+Y#7
"RTN","SDEC07",312,0)
 Q
"RTN","SDEC07",313,0)
 ;
"RTN","SDEC07",314,0)
AVUPDT(SDCL,SDECSTART,SDECLEN) ;Update Clinic availability
"RTN","SDEC07",315,0)
 ;SEE SDM1
"RTN","SDEC07",316,0)
 N %,ABORT,SDNOT,Y,DFN,SDVAL
"RTN","SDEC07",317,0)
 N SL,STARTDAY,X,SC,SB,HSI,SI,STR,SDDIF,SDMAX,SDDATE,SDDMAX,SDSDATE,CCXN,MXOK,COV,SDPROG
"RTN","SDEC07",318,0)
 N X1,SDEDT,X2,SD,SM,SS,S,SDLOCK,ST,I,SDECINC
"RTN","SDEC07",319,0)
 S Y=SDCL   ;,DFN=DFN  ;renamed SDECPATID to DFN
"RTN","SDEC07",320,0)
 S SL=$G(^SC(+Y,"SL")),X=$P(SL,U,3),STARTDAY=$S($L(X):X,1:8),SC=Y,SB=STARTDAY-1/100,X=$P(SL,U,6),HSI=$S(X=1:X,X:X,1:4),SI=$S(X="":4,X<3:4,X:X,1:4),STR="#@!$* XXWVUTSRQPONMLKJIHGFEDCBA0123456789jklmnopqrstuvwxyz",SDDIF=$S(HSI<3:8/HSI,1:2) K Y
"RTN","SDEC07",321,0)
 ;Determine maximum days for scheduling
"RTN","SDEC07",322,0)
 S SDMAX(1)=$P($G(^SC(+SC,"SDP")),U,2) S:'SDMAX(1) SDMAX(1)=365
"RTN","SDEC07",323,0)
 S (SDMAX,SDDMAX)=$$FMADD^XLFDT(DT,SDMAX(1))
"RTN","SDEC07",324,0)
 S SDDATE=SDECSTART
"RTN","SDEC07",325,0)
 S SDSDATE=SDDATE,SDDATE=SDDATE\1
"RTN","SDEC07",326,0)
1 ;L  Q:$D(SDXXX)  S CCXN=0 K MXOK,COV,SDPROT Q:DFN<0  S SC=+SC
"RTN","SDEC07",327,0)
 ;Q:$D(SDXXX)
"RTN","SDEC07",328,0)
 S CCXN=0 K MXOK,COV,SDPROT Q:$G(DFN)<0  S SC=+SC
"RTN","SDEC07",329,0)
 S X1=DT,SDEDT=365 S:$D(^SC(SC,"SDP")) SDEDT=$P(^SC(SC,"SDP"),"^",2)
"RTN","SDEC07",330,0)
 S X2=SDEDT D C^%DTC S SDEDT=X
"RTN","SDEC07",331,0)
 S Y=SDECSTART
"RTN","SDEC07",332,0)
EN1 S (X,SD)=Y,SM=0 D DOW
"RTN","SDEC07",333,0)
S I '$D(^SC(SC,"ST",$P(SD,"."),1)) S SS=+$O(^SC(+SC,"T"_Y,SD)) Q:SS'>0  Q:^(SS,1)=""  S ^SC(+SC,"ST",$P(SD,"."),1)=$E($P($T(DAY),U,Y+2),1,2)_" "_$E(SD,6,7)_$J("",SI+SI-6)_^(1),^(0)=$P(SD,".")
"RTN","SDEC07",334,0)
 S S=SDECLEN
"RTN","SDEC07",335,0)
 ;Check if SDECLEN evenly divisible by appointment length
"RTN","SDEC07",336,0)
 S SDVAL=$P(SL,U)
"RTN","SDEC07",337,0)
 I SDECLEN<SDVAL S SDECLEN=SDVAL
"RTN","SDEC07",338,0)
 I SDECLEN#SDVAL'=0 D
"RTN","SDEC07",339,0)
 . S SDECINC=SDECLEN\SDVAL
"RTN","SDEC07",340,0)
 . S SDECINC=SDECINC+1
"RTN","SDEC07",341,0)
 . S SDECLEN=SDVAL*SDECINC
"RTN","SDEC07",342,0)
 S SL=S_U_$P(SL,U,2,99)
"RTN","SDEC07",343,0)
SC S SDLOCK=$S('$D(SDLOCK):1,1:SDLOCK+1) Q:SDLOCK>9
"RTN","SDEC07",344,0)
 L +^SC(SC,"ST",$P(SD,"."),1):5 G:'$T SC
"RTN","SDEC07",345,0)
 S SDLOCK=0,S=^SC(SC,"ST",$P(SD,"."),1)
"RTN","SDEC07",346,0)
 S I=SD#1-SB*100,ST=I#1*SI\.6+($P(I,".")*SI),SS=SL*HSI/60*SDDIF+ST+ST
"RTN","SDEC07",347,0)
 I (I<1!'$F(S,"["))&(S'["CAN") L -^SC(SC,"ST",$P(SD,"."),1) Q
"RTN","SDEC07",348,0)
 I SM<7 S %=$F(S,"[",SS-1) S:'%!($P(SL,"^",6)<3) %=999 I $F(S,"]",SS)'<%!(SDDIF=2&$E(S,ST+ST+1,SS-1)["[") S SM=7
"RTN","SDEC07",349,0)
 ;
"RTN","SDEC07",350,0)
SP I ST+ST>$L(S),$L(S)<80 S S=S_" " G SP
"RTN","SDEC07",351,0)
 S SDNOT=1
"RTN","SDEC07",352,0)
 S ABORT=0
"RTN","SDEC07",353,0)
 F I=ST+ST:SDDIF:SS-SDDIF D  Q:ABORT
"RTN","SDEC07",354,0)
 . S ST=$E(S,I+1) S:ST="" ST=" "
"RTN","SDEC07",355,0)
 . S Y=$E(STR,$F(STR,ST)-2)
"RTN","SDEC07",356,0)
 . I S["CAN"!(ST="X"&($D(^SC(+SC,"ST",$P(SD,"."),"CAN")))) S ABORT=1 Q
"RTN","SDEC07",357,0)
 . I Y="" S ABORT=1 Q
"RTN","SDEC07",358,0)
 . S:Y'?1NL&(SM<6) SM=6 S ST=$E(S,I+2,999) S:ST="" ST=" " S S=$E(S,1,I)_Y_ST
"RTN","SDEC07",359,0)
 . Q
"RTN","SDEC07",360,0)
 S ^SC(SC,"ST",$P(SD,"."),1)=S
"RTN","SDEC07",361,0)
 L -^SC(SC,"ST",$P(SD,"."),1)
"RTN","SDEC07",362,0)
 Q
"RTN","SDEC07",363,0)
 ;
"RTN","SDEC07",364,0)
ERROR ;
"RTN","SDEC07",365,0)
 D ERR1("Error")
"RTN","SDEC07",366,0)
 Q
"RTN","SDEC07",367,0)
 ;
"RTN","SDEC07",368,0)
ERR1(SDECERR) ;Error processing
"RTN","SDEC07",369,0)
 S SDECI=SDECI+1
"RTN","SDEC07",370,0)
 S ^TMP("SDEC07",$J,SDECI)=SDECERR_$C(30)
"RTN","SDEC07",371,0)
 S SDECI=SDECI+1
"RTN","SDEC07",372,0)
 S ^TMP("SDEC07",$J,SDECI)=$C(31)
"RTN","SDEC07",373,0)
 Q  ;
"RTN","SDEC07",374,0)
 ;
"RTN","SDEC07A")
0^5^B87285683^B84573487
"RTN","SDEC07A",1,0)
SDEC07A ;ALB/SAT - VISTA SCHEDULING RPCS ;JUL 19, 2016
"RTN","SDEC07A",2,0)
 ;;5.3;Scheduling;**627,642,651,679,686**;Aug 13, 1993;Build 53
"RTN","SDEC07A",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified
"RTN","SDEC07A",4,0)
 ;References made to ICR #6185 and #4837
"RTN","SDEC07A",5,0)
 Q
"RTN","SDEC07A",6,0)
 ;
"RTN","SDEC07A",7,0)
OVBOOK(SDECY,SDCL,NSDT,SDECRES) ;RPC - OVERBOOK - Check if Overbook is allowed for given Clinic and Date.
"RTN","SDEC07A",8,0)
 ;OVBOOK(SDECY,SDCL,NSDT,SDECRES)  external parameter tag is in SDEC
"RTN","SDEC07A",9,0)
 ;  .SDECY   = returned pointer to OVERBOOK data
"RTN","SDEC07A",10,0)
 ;   SDCL    = clinic code - pointer to Hospital Location file ^SC
"RTN","SDEC07A",11,0)
 ;   NSDT    = date/time of new appointment
"RTN","SDEC07A",12,0)
 ;   SDECRES = resource to check for overbook
"RTN","SDEC07A",13,0)
 N %DT,AP,SDECI,OB,SDBK,OBCNT,OBMAX,SDCLN,SDCLRES,SDCLSL,SDCNT,SDRET,SDT,SDTD,SDTE,X,Y
"RTN","SDEC07A",14,0)
 N SD30,SDARR,OBCNTSUM
"RTN","SDEC07A",15,0)
 S OBCNTSUM=0
"RTN","SDEC07A",16,0)
 ; SDTD  = new schedule Date only in FM format
"RTN","SDEC07A",17,0)
 ; SDT   = loop value for $o through schedules
"RTN","SDEC07A",18,0)
 ; SDTE  = end of loop schedule
"RTN","SDEC07A",19,0)
 ; NSDT  = new appointment schedule Date/Time will be converted to FM format
"RTN","SDEC07A",20,0)
 S SDECI=0
"RTN","SDEC07A",21,0)
 S SDECY="^TMP(""SDEC"","_$J_")"
"RTN","SDEC07A",22,0)
 K @SDECY
"RTN","SDEC07A",23,0)
 S @SDECY@(0)="T00020ERRORID"_$C(30)
"RTN","SDEC07A",24,0)
 ;check for valid Hospital location
"RTN","SDEC07A",25,0)
 I '+SDCL D ERR1("Invalid Clinic ID - Cannot determine if Overbook is allowed.") Q
"RTN","SDEC07A",26,0)
 I '$D(^SC(SDCL,0)) D ERR1("Invalid Clinic ID - Cannot determine if Overbook is allowed.") Q
"RTN","SDEC07A",27,0)
 ;check for valid resource ID
"RTN","SDEC07A",28,0)
 I '+SDECRES D ERR1("Invalid Resource ID - Cannot determine if Overbook is allowed.") Q
"RTN","SDEC07A",29,0)
 I '$D(^SDEC(409.831,SDECRES,0)) D ERR1("Invalid Resource ID - Cannot determine if Overbook is allowed.") Q
"RTN","SDEC07A",30,0)
 ;check for valid DATE/TIME
"RTN","SDEC07A",31,0)
 S %DT="T"
"RTN","SDEC07A",32,0)
 S X=NSDT
"RTN","SDEC07A",33,0)
 D ^%DT   ; GET FM FORMAT FOR APPOINTMENT DATE/TIME
"RTN","SDEC07A",34,0)
 S NSDT=Y
"RTN","SDEC07A",35,0)
 I NSDT=-1 D ERR1("Invalid Appointment Date.") Q
"RTN","SDEC07A",36,0)
 S SDTD=$P(NSDT,".")
"RTN","SDEC07A",37,0)
 ; data header
"RTN","SDEC07A",38,0)
 ; OVERBOOK  0=not overbooked; 1=overbooked
"RTN","SDEC07A",39,0)
 S @SDECY@(0)="T00020OVERBOOK"_$C(30)
"RTN","SDEC07A",40,0)
 ;get allowed number of overbookings for clinic
"RTN","SDEC07A",41,0)
 S SDCLSL=$G(^SC(SDCL,"SL"))
"RTN","SDEC07A",42,0)
 S OBMAX=$P(SDCLSL,U,7)
"RTN","SDEC07A",43,0)
 I '+OBMAX S (OBCNT,OBMAX)=0 G XIT
"RTN","SDEC07A",44,0)
 N SDAB,SLOTSIZE
"RTN","SDEC07A",45,0)
 S SDAB="^TMP("_$J_",""SDEC"",""BLKS"")"
"RTN","SDEC07A",46,0)
 S SLOTSIZE="^TMP("_$J_",""SDEC"",""SLOTSIZE"")"
"RTN","SDEC07A",47,0)
 K @SDAB,@SLOTSIZE
"RTN","SDEC07A",48,0)
 ;get original slot sizes
"RTN","SDEC07A",49,0)
 D GETSLOTS^SDEC04(SLOTSIZE,SDECRES,SDTD,SDTD_".2359")
"RTN","SDEC07A",50,0)
 ;get current appt availability
"RTN","SDEC07A",51,0)
 D GETSLOTS^SDEC57(SDAB,SDECRES,SDTD,SDTD_".2359")
"RTN","SDEC07A",52,0)
 N IDX,SDR,SDSTART,SDSTOP,SDSLOTS,XX,IDX2,YY
"RTN","SDEC07A",53,0)
 ;restore original slot sizes into appts slots
"RTN","SDEC07A",54,0)
 S IDX="" F  S IDX=$O(@SLOTSIZE@(IDX)) Q:'IDX  D
"RTN","SDEC07A",55,0)
 .S XX=@SLOTSIZE@(IDX)
"RTN","SDEC07A",56,0)
 .S SDSTART=$P(XX,U,2),SDSTOP=$P(XX,U,3),SDSLOTS=$P(XX,U,4)
"RTN","SDEC07A",57,0)
 .S IDX2="" F  S IDX2=$O(@SDAB@(IDX2)) Q:'IDX2  D
"RTN","SDEC07A",58,0)
 ..S YY=@SDAB@(IDX2)
"RTN","SDEC07A",59,0)
 ..S:($P(YY,U,2)'<SDSTART)&($P(YY,U,3)'>SDSTOP) $P(@SDAB@(IDX2),U,4)=SDSLOTS
"RTN","SDEC07A",60,0)
 ;find overbooks
"RTN","SDEC07A",61,0)
 S IDX="" F  S IDX=$O(@SDAB@(IDX)) Q:IDX=""  D
"RTN","SDEC07A",62,0)
 .S XX=@SDAB@(IDX)
"RTN","SDEC07A",63,0)
 .S SDSTART=$P(XX,U,2),SDSTOP=$P(XX,U,3),SDSLOTS=$P(XX,U,4)
"RTN","SDEC07A",64,0)
 .;loop thru schedule
"RTN","SDEC07A",65,0)
 .; SDBK(<appt time>,<appt end time>)=counter starting at 0
"RTN","SDEC07A",66,0)
 .K SDBK  ;overbook counter array
"RTN","SDEC07A",67,0)
 .S SDRET="" D CRSCHED^SDEC(.SDRET,SDECRES,SDSTART,SDSTOP)
"RTN","SDEC07A",68,0)
 .K SDARR
"RTN","SDEC07A",69,0)
 .S SD30=1,SDCNT=0,SDT=0 F  S SDT=$O(@SDRET@(SDT)) Q:SDT=""  D
"RTN","SDEC07A",70,0)
 ..S SDR=$G(@SDRET@(SDT))
"RTN","SDEC07A",71,0)
 ..I $P(SDR,U,1)[$c(30) S SD30=1 Q
"RTN","SDEC07A",72,0)
 ..Q:SD30'=1
"RTN","SDEC07A",73,0)
 ..S SDCNT=SDCNT+1
"RTN","SDEC07A",74,0)
 ..S SDARR($P(SDR,U,1))=""
"RTN","SDEC07A",75,0)
 ..S SD30=0
"RTN","SDEC07A",76,0)
 .S SDCNT=0 F  S SDCNT=$O(SDARR(SDCNT)) Q:SDCNT=""  D
"RTN","SDEC07A",77,0)
 ..S SDR=$G(^SDEC(409.84,+SDCNT,0))
"RTN","SDEC07A",78,0)
 ..S SDT=$P(SDR,U,1)
"RTN","SDEC07A",79,0)
 ..S SDTE=$P(SDR,U,2)
"RTN","SDEC07A",80,0)
 ..Q:$P(SDR,U,12)]""  ;don't count cancelled appts
"RTN","SDEC07A",81,0)
 ..;if time ranges overlap, add to SDBK array
"RTN","SDEC07A",82,0)
 ..I (SDTE>SDT)&(((SDT'<SDSTART)&(SDT<SDSTOP))!((SDTE>SDSTART)&(SDTE'>SDSTOP))!((SDT'>SDSTART)&(SDTE'<SDSTOP))) D
"RTN","SDEC07A",83,0)
 ...D CKOB(SDT,SDTE,.SDBK)
"RTN","SDEC07A",84,0)
 ..;;D CKOB($P(SDT,".")_".0000",$P(SDTE,".")_".2359",.SDBK)
"RTN","SDEC07A",85,0)
 .S OBCNT=$$CNTOB(.SDBK,SDECRES,SDTD,OBMAX,SDAB)
"RTN","SDEC07A",86,0)
 .S OBCNTSUM=OBCNTSUM+OBCNT
"RTN","SDEC07A",87,0)
 .K @SDRET,SDBK
"RTN","SDEC07A",88,0)
XIT ;
"RTN","SDEC07A",89,0)
 S SDECI=SDECI+1
"RTN","SDEC07A",90,0)
 S @SDECY@(SDECI)=$S(OBCNTSUM<OBMAX:"YES",1:"NO")
"RTN","SDEC07A",91,0)
 S SDECI=SDECI+1
"RTN","SDEC07A",92,0)
 S @SDECY@(SDECI)=$C(30)
"RTN","SDEC07A",93,0)
 S SDECI=SDECI+1
"RTN","SDEC07A",94,0)
 S @SDECY@(SDECI)=$C(31)
"RTN","SDEC07A",95,0)
 Q
"RTN","SDEC07A",96,0)
 ;
"RTN","SDEC07A",97,0)
 ;find appointment in SDEC APPOINTMENT file
"RTN","SDEC07A",98,0)
SDECAP(SDECSDT,DFN) ;
"RTN","SDEC07A",99,0)
 N SDECAPN,SDECRES,ID
"RTN","SDEC07A",100,0)
 S SDECRES=0
"RTN","SDEC07A",101,0)
 S ID=0
"RTN","SDEC07A",102,0)
 F  S ID=$O(^SDEC(409.84,"B",SDECSDT,ID)) Q:ID'>0  Q:SDECRES'=0  D
"RTN","SDEC07A",103,0)
 . S SDECAPN=$G(^SDEC(409.84,ID,0))
"RTN","SDEC07A",104,0)
 . I $P(SDECAPN,U,5)=DFN S SDECRES=$P(SDECAPN,U,7)
"RTN","SDEC07A",105,0)
 Q SDECRES
"RTN","SDEC07A",106,0)
 ;
"RTN","SDEC07A",107,0)
 ;check if appointment start/stop is in range of an existing appointment
"RTN","SDEC07A",108,0)
CKOB(START,STOP,SDBK) ;called internally
"RTN","SDEC07A",109,0)
 ;  START   = appointment start date/time in FM format
"RTN","SDEC07A",110,0)
 ;  STOP    = appointment stop date/time in FM format
"RTN","SDEC07A",111,0)
 ; .SDBK    = bookings Array -  SDBK(<appt time>,<appt end time>)=counter starting at 0
"RTN","SDEC07A",112,0)
 N B,E,OB,OBF
"RTN","SDEC07A",113,0)
 S OBF=0
"RTN","SDEC07A",114,0)
 S B=""
"RTN","SDEC07A",115,0)
 F  S B=$O(SDBK(B)) Q:B'>0  D  Q:+OBF
"RTN","SDEC07A",116,0)
 . S E="" F  S E=$O(SDBK(B,E)) Q:E'>0  D  Q:+OBF
"RTN","SDEC07A",117,0)
 . . S OB=SDBK(B,E)
"RTN","SDEC07A",118,0)
 . . S OBF=1
"RTN","SDEC07A",119,0)
 . . ;S OBF=(($$FMADD^XLFDT(START,B,2)'<0)&($$FMADD^XLFDT(START,E,2)<0))!(($$FMADD^XLFDT(STOP,B,2)>0)&($$FMADD^XLFDT(STOP,E,2)'<0))
"RTN","SDEC07A",120,0)
 . . ;S OBF=(($P(START,".",2)'<$P(B,".",2))&($P(START,".",2)'>$P(E,".",2)))!(($P(STOP,".",2)>$P(B,".",2))&($P(STOP,".",2)'>$P(E,".",2)))
"RTN","SDEC07A",121,0)
 . . I OBF S SDBK(B,E)=(OB+1)
"RTN","SDEC07A",122,0)
 I 'OBF S SDBK(START,STOP)=1
"RTN","SDEC07A",123,0)
 ;
"RTN","SDEC07A",124,0)
 Q
"RTN","SDEC07A",125,0)
 ;
"RTN","SDEC07A",126,0)
 ;count overbookings
"RTN","SDEC07A",127,0)
CNTOB(SDBK,SDECRES,SDTD,OBMAX,SDAB) ;called internally
"RTN","SDEC07A",128,0)
 N AB,ABF,ABN,CNT,BK,SLOTS,B,E
"RTN","SDEC07A",129,0)
 S BK=""
"RTN","SDEC07A",130,0)
 S CNT=0
"RTN","SDEC07A",131,0)
 S B="" F  S B=$O(SDBK(B)) Q:B=""  D  Q:CNT'<OBMAX
"RTN","SDEC07A",132,0)
 . S E="" F  S E=$O(SDBK(B,E)) Q:E=""  D  Q:CNT'<OBMAX
"RTN","SDEC07A",133,0)
 . . S BK=SDBK(B,E)
"RTN","SDEC07A",134,0)
 . . Q:'+BK
"RTN","SDEC07A",135,0)
 . . S SLOTS=$$SLOTS(B,E,SDAB)   ;find access block
"RTN","SDEC07A",136,0)
 . . I '+SLOTS S CNT=CNT+BK
"RTN","SDEC07A",137,0)
 . . E  S BK=BK-SLOTS S:BK<0 BK=0 S CNT=CNT+BK
"RTN","SDEC07A",138,0)
 Q CNT
"RTN","SDEC07A",139,0)
SLOTS(B,E,SDAB) ;find access block
"RTN","SDEC07A",140,0)
 N ABF,ABN,SDI,SLOTS
"RTN","SDEC07A",141,0)
 S SLOTS=""
"RTN","SDEC07A",142,0)
 S SDI=0 F  S SDI=$O(@SDAB@(SDI)) Q:SDI'>0  D  Q:+ABF
"RTN","SDEC07A",143,0)
 .S ABN=@SDAB@(SDI)
"RTN","SDEC07A",144,0)
 .S ABF=((B'<$P(ABN,U,2))&(B<$P(ABN,U,3)))!((E>$P(ABN,U,2))&(E'>$P(ABN,U,3)))
"RTN","SDEC07A",145,0)
 .S:ABF SLOTS=+$P(ABN,U,4)
"RTN","SDEC07A",146,0)
 Q SLOTS
"RTN","SDEC07A",147,0)
 ;
"RTN","SDEC07A",148,0)
REQSET(SDRIEN,SDPROV,SDUSR,SDACT,SDECTYP,SDECNOTE,SAVESTRT,SDECRES) ;add SCHEDULED activity to REQUEST/CONSULTATION file
"RTN","SDEC07A",149,0)
 ;INPUT:
"RTN","SDEC07A",150,0)
 ; SDRIEN  - (required) pointer to RFEQUEST/CONSULTATION file 123
"RTN","SDEC07A",151,0)
 ; SDPROV  - (required) Provider pointer to NEW PERSON
"RTN","SDEC07A",152,0)
 ; SDUSR   - (optional) User that entered appointment pointer to NEW PERSON
"RTN","SDEC07A",153,0)
 ; SDACT   - (required) ACTIVITY type to add  1=SCHEDULED  2=STATUS CHANGE
"RTN","SDEC07A",154,0)
 ; SDECTYP - (required if SDACT=2) appointment Status valid values:
"RTN","SDEC07A",155,0)
 ;                          C=CANCELLED BY CLINIC
"RTN","SDEC07A",156,0)
 ;                         PC=CANCELLED BY PATIENT
"RTN","SDEC07A",157,0)
 ; SDECNOTE - Comments from Appointment
"RTN","SDEC07A",158,0)
 ; SAVESTRT - Appointment time in external format    ;alb/sat 651 corrected comment
"RTN","SDEC07A",159,0)
 ; SDECRES  - Appointment Resource
"RTN","SDEC07A",160,0)
 N SDDT,SDFDA,SDI,SDIEN,SDOA,SDOS,SDPDC,SDSCHED,SDSCHEDF,SDSTAT,SDTXT,SDERR,Y,SDPCM
"RTN","SDEC07A",161,0)
 S SDACT=$G(SDACT)
"RTN","SDEC07A",162,0)
 S SAVESTRT=$G(SAVESTRT)
"RTN","SDEC07A",163,0)
 S SDECRES=$G(SDECRES)
"RTN","SDEC07A",164,0)
 Q:"12"'[SDACT
"RTN","SDEC07A",165,0)
 S SDSCHEDF=0
"RTN","SDEC07A",166,0)
 S SDUSR=$G(SDUSR)
"RTN","SDEC07A",167,0)
 S:SDUSR="" SDUSR=DUZ
"RTN","SDEC07A",168,0)
 S:'$D(^VA(200,+SDUSR,0)) SDUSR=DUZ  ;take this out
"RTN","SDEC07A",169,0)
 S SDSCHED=$$GETIEN^SDEC51("SCHEDULED")
"RTN","SDEC07A",170,0)
 S SDSTAT=$$GETIEN^SDEC51("STATUS CHANGE")
"RTN","SDEC07A",171,0)
 S SDPDC=$O(^ORD(100.01,"B","DISCONTINUED",0))
"RTN","SDEC07A",172,0)
 ;ajf ; Check for completed Consult
"RTN","SDEC07A",173,0)
 S SDPCM=$O(^ORD(100.01,"B","COMPLETE",0))
"RTN","SDEC07A",174,0)
 I SDACT=1,SDSCHED="" Q
"RTN","SDEC07A",175,0)
 I SDACT=2,SDSTAT="" Q
"RTN","SDEC07A",176,0)
 ;ajf ; Check for completed Consult
"RTN","SDEC07A",177,0)
 S SDCPS=$$GET1^DIQ(123,SDRIEN_",",8,"I")
"RTN","SDEC07A",178,0)
 Q:SDCPS=SDPDC!(SDCPS=SDPCM) 
"RTN","SDEC07A",179,0)
 ;Q:$$GET1^DIQ(123,SDRIEN_",",8,"I")=SDPDC   ;never update file 123 if CPRS STATUS is DISCONTINUED
"RTN","SDEC07A",180,0)
 ;Q:$$GET1^DIQ(123,SDRIEN_",",8,"I")=SDPCM   ;never update file 123 if CPRS STATUS is COMPLETE
"RTN","SDEC07A",181,0)
 S SDECNOTE=$G(SDECNOTE)
"RTN","SDEC07A",182,0)
 ;it is possible to have multiple scheduled activities; make sure there is not already a SCHEDULED activity
"RTN","SDEC07A",183,0)
 ;S SDI=0 F  S SDI=$O(^GMR(123,SDRIEN,40,SDI)) Q:SDI'>0  D  Q:+SDSCHEDF
"RTN","SDEC07A",184,0)
 ;.I $P($G(^GMR(123,SDRIEN,40,SDI,0)),U,2)=SDSCHED S SDSCHEDF=1 Q
"RTN","SDEC07A",185,0)
 ;Q:+SDSCHEDF
"RTN","SDEC07A",186,0)
 S SDDT=$$NOW^XLFDT()  ;*zeb 12/13/17 679 don't use $E to remove seconds
"RTN","SDEC07A",187,0)
 ;
"RTN","SDEC07A",188,0)
 ; Replaced with call to SDCNSLT below.  wtc/zeb 3.21.18 patch 686 ;
"RTN","SDEC07A",189,0)
 ;
"RTN","SDEC07A",190,0)
 ;S SDFDA(123.02,"+1,"_SDRIEN_",",.01)=SDDT                                   ;ICR 6185
"RTN","SDEC07A",191,0)
 ;S SDFDA(123.02,"+1,"_SDRIEN_",",1)=$S(SDACT=1:SDSCHED,SDACT=2:SDSTAT,1:"")  ;ICR 6185
"RTN","SDEC07A",192,0)
 ;S SDFDA(123.02,"+1,"_SDRIEN_",",2)=SDDT                                     ;ICR 6185
"RTN","SDEC07A",193,0)
 ;S SDFDA(123.02,"+1,"_SDRIEN_",",3)=SDPROV                                   ;ICR 6185
"RTN","SDEC07A",194,0)
 ;S SDFDA(123.02,"+1,"_SDRIEN_",",4)=SDUSR                                    ;ICR 6185
"RTN","SDEC07A",195,0)
 ;D UPDATE^DIE("","SDFDA","SDIEN")
"RTN","SDEC07A",196,0)
 S SDTXT=""
"RTN","SDEC07A",197,0)
 ;MGH modified to add in note text and appointment data
"RTN","SDEC07A",198,0)
 I SDACT=1 D
"RTN","SDEC07A",199,0)
 .;
"RTN","SDEC07A",200,0)
 .; Disabled lines below because they exist in SDCNSLT.
"RTN","SDEC07A",201,0)
 .; wtc/zeb 3.22.18 patch 686
"RTN","SDEC07A",202,0)
 .;
"RTN","SDEC07A",203,0)
 .;S SDTXT(1)=$P($G(^SDEC(409.831,+SDECRES,0)),U,1)_" Consult Appt. on "_SAVESTRT
"RTN","SDEC07A",204,0)
 .;I SDECNOTE'="" S SDTXT(2)=SDECNOTE
"RTN","SDEC07A",205,0)
 . N %DT,X,SD,TMPYCLNC ;
"RTN","SDEC07A",206,0)
 . S X=SAVESTRT,%DT="T" D ^%DT S SD=Y ;
"RTN","SDEC07A",207,0)
 . S TMPYCLNC=$P($G(^SDEC(409.831,+SDECRES,0)),U,4) I TMPYCLNC'="" S TMPYCLNC=TMPYCLNC_U_$P(^SC(TMPYCLNC,0),U,1) ;
"RTN","SDEC07A",208,0)
 . D EDITCS^SDCNSLT(SD,SDECNOTE,TMPYCLNC,SDRIEN) ; Changed "" to SDECNOTE - wtc 686 11/7/2018
"RTN","SDEC07A",209,0)
 I SDACT=2 D
"RTN","SDEC07A",210,0)
 .;
"RTN","SDEC07A",211,0)
 .; Disabled lines below because they exist in SDCNSLT.
"RTN","SDEC07A",212,0)
 .; wtc/zeb 3.22.18 patch 686
"RTN","SDEC07A",213,0)
 .;
"RTN","SDEC07A",214,0)
 .;S SDECTYP=$G(SDECTYP)
"RTN","SDEC07A",215,0)
 .;S SDTXT(1)=$P($G(^SDEC(409.831,+SDECRES,0)),U,1)_" Appt. on "_SAVESTRT_" was cancelled"_$S(SDECTYP["P":" by the Patient.",SDECTYP["C":" by the Clinic.",1:".")   ;alb/sat 651 include appt info
"RTN","SDEC07A",216,0)
 .;I SDECNOTE'="" S SDTXT(2)="Remarks: "_SDECNOTE
"RTN","SDEC07A",217,0)
 . N DFN,%DT,X,SDTTM,SDSC,SDPL ;
"RTN","SDEC07A",218,0)
 . S DFN=$P($G(^GMR(123,SDRIEN,0)),U,2) ;
"RTN","SDEC07A",219,0)
 . S X=SAVESTRT,%DT="T" D ^%DT S SDTTM=Y ;
"RTN","SDEC07A",220,0)
 . S SDSC=$P($G(^SDEC(409.831,+SDECRES,0)),U,4) ;
"RTN","SDEC07A",221,0)
 . S SDPL=0 F  S SDPL=$O(^SC(SDSC,"S",SDTTM,1,SDPL)) Q:'SDPL  Q:$P(^(SDPL,0),U,1)=DFN  ;
"RTN","SDEC07A",222,0)
 . D SDECCAN^SDCNSLT(SDRIEN,DFN,SDTTM,SDSC,SDECTYP,SDPL,SDECNOTE) ;*zeb 686 10/30/18 send comments to consult
"RTN","SDEC07A",223,0)
 Q  ;
"RTN","SDEC07A",224,0)
 ;
"RTN","SDEC07A",225,0)
 ;  Lines below disabled by calls to SDCNSLT.
"RTN","SDEC07A",226,0)
 ;  wtc/zeb 3.22.18 patch 686
"RTN","SDEC07A",227,0)
 ;
"RTN","SDEC07A",228,0)
 ;I $D(SDTXT) D
"RTN","SDEC07A",229,0)
 ;.D WP^DIE(123.02,SDIEN(1)_","_SDRIEN_",",5,"","SDTXT","SDERR")   ;ICR 6185
"RTN","SDEC07A",230,0)
 ;K SDFDA   ;alb/sat 651
"RTN","SDEC07A",231,0)
 ;set CPRS status field  ICR 6185
"RTN","SDEC07A",232,0)
 ;S SDOS=$O(^ORD(100.01,"B","SCHEDULED",0))
"RTN","SDEC07A",233,0)
 ;S SDOA=$O(^ORD(100.01,"B","ACTIVE",0))
"RTN","SDEC07A",234,0)
 ;I SDOS'="" D
"RTN","SDEC07A",235,0)
 ;.;K SDFDA  ;alb/sat 651 moved up
"RTN","SDEC07A",236,0)
 ;.S SDFDA(123,SDRIEN_",",8)=$S(SDACT=1:SDOS,1:SDOA)
"RTN","SDEC07A",237,0)
 ;.;D UPDATE^DIE("","SDFDA")                          ;ICR 6185  ;alb/sat 651 moved down out of IF scope
"RTN","SDEC07A",238,0)
 ;S:+$G(SDSCHED) SDFDA(123,SDRIEN_",",9)=$S(SDACT=1:SDSCHED,1:SDSTAT)      ;alb/sat 651 - set LAST ACTION TAKEN   ICR 4837
"RTN","SDEC07A",239,0)
 ;D:$D(SDFDA) UPDATE^DIE("","SDFDA")   ;alb/sat 651
"RTN","SDEC07A",240,0)
 ;Q
"RTN","SDEC07A",241,0)
 ;
"RTN","SDEC07A",242,0)
EWL(WLIEN,APPDT,SDCL,SVCP,SVCPR,NOTE,SDAPPTYP) ;update SD WAIT LIST at appointment add
"RTN","SDEC07A",243,0)
 ;INPUT:
"RTN","SDEC07A",244,0)
 ;  WLIEN = Wait List ID pointer to SD WAIT LIST file 409.3
"RTN","SDEC07A",245,0)
 ;  APPDT = Appointment date/time (Scheduled Date of appt) in fm format
"RTN","SDEC07A",246,0)
 ;  SDCL  = Clinic ID pointer to HOSPITAL LOCATION file 44
"RTN","SDEC07A",247,0)
 ;  SVCP  = Service Connected Percentage numeric 0-100
"RTN","SDEC07A",248,0)
 ;  SVCPR = Service Connected Priority  0:NO  1:YES
"RTN","SDEC07A",249,0)
 ;  NOTE  = Comment only 1st 60 characters are used
"RTN","SDEC07A",250,0)
 ;  SDAPPTYP - (optional) Appointment type ID pointer to APPOINTMENT TYPE file 409.1
"RTN","SDEC07A",251,0)
 ;
"RTN","SDEC07A",252,0)
 ;all input must be verified by calling routine
"RTN","SDEC07A",253,0)
 N SDDIV,SDFDA,SDSN
"RTN","SDEC07A",254,0)
 S:+$G(SDAPPTYP) SDFDA(409.3,WLIEN_",",8.7)=SDAPPTYP
"RTN","SDEC07A",255,0)
 S SDFDA(409.3,WLIEN_",",13)=APPDT                     ;SCHEDULED DATE OF APPT       = APPDT  (SDECSTART)
"RTN","SDEC07A",256,0)
 S SDFDA(409.3,WLIEN_",",13.1)=$P($$NOW^XLFDT,".",1)   ;DATE APPT. MADE              = TODAY
"RTN","SDEC07A",257,0)
 S SDFDA(409.3,WLIEN_",",13.2)=SDCL                    ;APPT CLINIC                  = SDCL   (SDECSCD)
"RTN","SDEC07A",258,0)
 S SDFDA(409.3,WLIEN_",",13.3)=$P($G(^SC(SDCL,0)),U,4) ;APPT INSTITUTION             = Get from 44 using SDCL
"RTN","SDEC07A",259,0)
 S SDFDA(409.3,WLIEN_",",13.4)=$P($G(^SC(SDCL,0)),U,7) ;APPT STOP CODE               = Get from 44 using SDCL
"RTN","SDEC07A",260,0)
 S SDDIV=$P($G(^SC(SDCL,0)),U,15)
"RTN","SDEC07A",261,0)
 S SDSN=$S(SDDIV'="":$P($G(^DG(40.8,SDDIV,0)),U,2),1:"")
"RTN","SDEC07A",262,0)
 S SDFDA(409.3,WLIEN_",",13.6)=SDSN                    ;APPT STATION NUMBER
"RTN","SDEC07A",263,0)
 S SDFDA(409.3,WLIEN_",",13.7)=DUZ                     ;APPT CLERK                   = Current User
"RTN","SDEC07A",264,0)
 S SDFDA(409.3,WLIEN_",",13.8)="R"                     ;APPT STATUS                  = R:Scheduled/Kept
"RTN","SDEC07A",265,0)
 S:SVCP'="" SDFDA(409.3,WLIEN_",",14)=SVCP                      ;SERVICE CONNECTED PERCENTAGE = SVCP   (SDSVCP)
"RTN","SDEC07A",266,0)
 S:SVCPR'="" SDFDA(409.3,WLIEN_",",15)=SVCPR                     ;SERVICE CONNECTED PRIORITY   = SVCPR  (SDSVCPR)
"RTN","SDEC07A",267,0)
 S:$G(NOTE)'="" SDFDA(409.3,WLIEN_",",25)=NOTE
"RTN","SDEC07A",268,0)
 S SDFDA(409.3,WLIEN_",",27)="U"                       ;EWL ENROLLEE STATUS          = U:UNDETERMINED
"RTN","SDEC07A",269,0)
 S SDFDA(409.3,WLIEN_",",27.2)=0                       ;EWL ENROLLEE DATABASE FILE   = 0:NONE
"RTN","SDEC07A",270,0)
 S SDFDA(409.3,WLIEN_",",28)=DUZ                       ;EDITING USER                 = Current User
"RTN","SDEC07A",271,0)
 D UPDATE^DIE("","SDFDA")
"RTN","SDEC07A",272,0)
 Q
"RTN","SDEC07A",273,0)
 ;
"RTN","SDEC07A",274,0)
ERROR ;
"RTN","SDEC07A",275,0)
 D ERR1("Error")
"RTN","SDEC07A",276,0)
 Q
"RTN","SDEC07A",277,0)
 ;
"RTN","SDEC07A",278,0)
ERR1(SDECERR) ;Error processing
"RTN","SDEC07A",279,0)
 S SDECI=SDECI+1
"RTN","SDEC07A",280,0)
 S ^TMP("SDEC",$J,SDECI)=SDECERR_$C(30)
"RTN","SDEC07A",281,0)
 S SDECI=SDECI+1
"RTN","SDEC07A",282,0)
 S ^TMP("SDEC",$J,SDECI)=$C(31)
"RTN","SDEC07A",283,0)
 Q
"RTN","SDEC07C")
0^12^B2886008^n/a
"RTN","SDEC07C",1,0)
SDEC07C ;ALB/WTC/ZEB - VISTA SCHEDULING RPCS ; 17 Dec 2018  1:45 PM
"RTN","SDEC07C",2,0)
 ;;5.3;Scheduling;**686**;Aug 13, 1993;Build 53
"RTN","SDEC07C",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified
"RTN","SDEC07C",4,0)
 ;
"RTN","SDEC07C",5,0)
 ;  Code removed from SDEC07 to make its size XINDEX-compliant.
"RTN","SDEC07C",6,0)
 Q
"RTN","SDEC07C",7,0)
 ;
"RTN","SDEC07C",8,0)
ADDEVT(DFN,SDECSTART,SDECSC,SDCLA) ;EP
"RTN","SDEC07C",9,0)
 ;Called by SDEC ADD APPOINTMENT protocol
"RTN","SDEC07C",10,0)
 ;SDECSC=IEN of clinic in ^SC
"RTN","SDEC07C",11,0)
 ;SDCLA=IEN for ^SC(SDECSC,"S",SDECSTART,1,SDCLA). Use to get Length & Note
"RTN","SDEC07C",12,0)
 ;
"RTN","SDEC07C",13,0)
 N SDECNOD,SDECLEN,SDECAPPTID,SDECNODP,SDECWKIN,SDECRES
"RTN","SDEC07C",14,0)
 Q:+$G(SDECNOEV)
"RTN","SDEC07C",15,0)
 I $D(^SDEC(409.831,"ALOC",SDECSC)) S SDECRES=$O(^SDEC(409.831,"ALOC",SDECSC,0))
"RTN","SDEC07C",16,0)
 Q:'+$G(SDECRES)
"RTN","SDEC07C",17,0)
 S SDECNOD=$G(^SC(SDECSC,"S",SDECSTART,1,SDCLA,0))
"RTN","SDEC07C",18,0)
 Q:SDECNOD=""
"RTN","SDEC07C",19,0)
 S SDECNODP=$G(^DPT(DFN,"S",SDECSTART,0))
"RTN","SDEC07C",20,0)
 S SDECWKIN=""
"RTN","SDEC07C",21,0)
 S:$P(SDECNODP,U,7)=4 SDECWKIN="WALKIN" ;Purpose of Visit field of DPT Appointment subfile
"RTN","SDEC07C",22,0)
 S SDECLEN=$P(SDECNOD,U,2)
"RTN","SDEC07C",23,0)
 Q:'+SDECLEN
"RTN","SDEC07C",24,0)
 S SDECEND=$$FMADD^XLFDT(SDECSTART,0,0,SDECLEN,0)
"RTN","SDEC07C",25,0)
 S SDECAPPTID=$$SDECADD^SDEC07(SDECSTART,SDECEND,DFN,SDECRES,SDECWKIN,,,,,SDECSC,,,,,,1,+SDECLEN)  ;alb/sat 665 add SDECLEN
"RTN","SDEC07C",26,0)
 Q:'+SDECAPPTID
"RTN","SDEC07C",27,0)
 S SDECNOTE=$P(SDECNOD,U,4)
"RTN","SDEC07C",28,0)
 I SDECNOTE]"" D SDECWP^SDEC07(SDECAPPTID,SDECNOTE)
"RTN","SDEC07C",29,0)
 D ADDEVT3(SDECRES)
"RTN","SDEC07C",30,0)
 Q
"RTN","SDEC07C",31,0)
 ;
"RTN","SDEC07C",32,0)
ADDEVT3(SDECRES) ;
"RTN","SDEC07C",33,0)
 ;Call RaiseEvent to notify GUI clients
"RTN","SDEC07C",34,0)
 Q
"RTN","SDEC07C",35,0)
 ;
"RTN","SDEC51")
0^13^B175129662^B173509385
"RTN","SDEC51",1,0)
SDEC51 ;ALB/SAT - VISTA SCHEDULING RPCS ;MAR 15, 2017
"RTN","SDEC51",2,0)
 ;;5.3;Scheduling;**627,642,651,658,686**;Aug 13, 1993;Build 53
"RTN","SDEC51",3,0)
 ;
"RTN","SDEC51",4,0)
 ;Reference is made to ICR's #4837, #4557, #6185, and #6186
"RTN","SDEC51",5,0)
 Q
"RTN","SDEC51",6,0)
 ;
"RTN","SDEC51",7,0)
REQGET(SDECY,SDBEG,SDEND,MAXREC,LASTSUB,SDGMR) ; GET entries that are not SCHEDULED.
"RTN","SDEC51",8,0)
REQGETA ;
"RTN","SDEC51",9,0)
 N PADDRES1,PADDRES2,PADDRES3,PCITY,PSTATE,PCOUNTRY,PTPHONE,PZIP4
"RTN","SDEC51",10,0)
 N SDECI,SDI,SDJ,SDREASON,SDREC,SDRECL,SDRPA,SDRPA0,SDTMP,SDWP,X,Y,%DT
"RTN","SDEC51",11,0)
 N SDCNT,SDCAN,SDCDC,SDCANF,SDCSTOP,SDSCHED,SDSCHEDF,SDSENS,SDSTAT,SDSTATF,SDDONE
"RTN","SDEC51",12,0)
 N DIC,ELIGIEN,ELIGNAME,GAF,PRIGRP,SVCCONN,SVCCONNP,TYPEIEN,TYPENAME
"RTN","SDEC51",13,0)
 N SDDEMO,SDNOCHK,SDSUB
"RTN","SDEC51",14,0)
 N DOB,GENDER,HRN,INSTIEN,INSTNAME,NAME,SSN,SVVCCONN
"RTN","SDEC51",15,0)
 S (SDNOCHK,SDSUB)=""
"RTN","SDEC51",16,0)
 S SDECI=0
"RTN","SDEC51",17,0)
 K ^TMP("SDEC",$J)
"RTN","SDEC51",18,0)
 S SDECY="^TMP(""SDEC"","_$J_")"
"RTN","SDEC51",19,0)
 ; data header
"RTN","SDEC51",20,0)
 D HDR
"RTN","SDEC51",21,0)
 S (SDCANF,SDSCHEDF)=0
"RTN","SDEC51",22,0)
 S SDREC=$$GETIEN("RECEIVED")
"RTN","SDEC51",23,0)
 I SDREC="" D ERR1^SDECERR(-1,"REQUEST ACTION TYPES file does not have an entry of RECEIVED.",.SDECI,SDECY) Q
"RTN","SDEC51",24,0)
 S SDSCHED=$$GETIEN("SCHEDULED")
"RTN","SDEC51",25,0)
 I SDSCHED="" D ERR1^SDECERR(-1,"REQUEST ACTION TYPES file does not have an entry of SCHEDULED.",.SDECI,SDECY) Q
"RTN","SDEC51",26,0)
 S SDSTAT=$$GETIEN("STATUS CHANGE")
"RTN","SDEC51",27,0)
 S SDCAN=$$GETIEN("CANCELLED")
"RTN","SDEC51",28,0)
 S SDDONE=$$GETIEN("COMPLETE/UPDATE")
"RTN","SDEC51",29,0)
 S SDCDC=$$GETIEN("DISCONTINUED")
"RTN","SDEC51",30,0)
 ;validate SDBEG (optional)
"RTN","SDEC51",31,0)
 S SDBEG=$G(SDBEG)
"RTN","SDEC51",32,0)
 I $G(SDBEG)'="" S %DT="" S X=$P($G(SDBEG),"@",1) D ^%DT S SDBEG=Y I Y=-1 S SDBEG=$$FMADD^XLFDT($P($$NOW^XLFDT,".",1),-1825)
"RTN","SDEC51",33,0)
 I $G(SDBEG)="" S SDBEG=$$FMADD^XLFDT($P($$NOW^XLFDT,".",1),-1825)
"RTN","SDEC51",34,0)
 ;validate SDEND (optional)
"RTN","SDEC51",35,0)
 S SDEND=$G(SDEND)
"RTN","SDEC51",36,0)
 I SDEND'="" S %DT="" S X=$P($G(SDEND),"@",1) D ^%DT S SDEND=Y I Y=-1 S SDEND=$$FMADD^XLFDT($P($$NOW^XLFDT,".",1),-90)
"RTN","SDEC51",37,0)
 I SDEND="" S SDEND=$$FMADD^XLFDT($P($$NOW^XLFDT,".",1),-90)
"RTN","SDEC51",38,0)
 ;validate SDGMR (optional)
"RTN","SDEC51",39,0)
 S SDGMR=$G(SDGMR)
"RTN","SDEC51",40,0)
 I SDGMR'="" I '$D(^GMR(123,+SDGMR,0)) D ERR1^SDECERR(-1,"Invalid Request/Consultation ID.",.SDECI,SDECY) Q   ;ICR 4837
"RTN","SDEC51",41,0)
 I SDGMR'="" S SDNOCHK=1 D REQGET1 G REQX
"RTN","SDEC51",42,0)
 ;validate MAXREC (optional)
"RTN","SDEC51",43,0)
 S MAXREC=+$G(MAXREC)
"RTN","SDEC51",44,0)
 I 'MAXREC S MAXREC=9999999
"RTN","SDEC51",45,0)
 ;validate LASTSUB (optional)
"RTN","SDEC51",46,0)
 S LASTSUB=$G(LASTSUB)
"RTN","SDEC51",47,0)
 S SDCNT=0
"RTN","SDEC51",48,0)
 S SDJ=$S($P(LASTSUB,"|",1)'="":$P(LASTSUB,"|",1),1:(SDBEG-1)_".2359")
"RTN","SDEC51",49,0)
 ;alb/sat 658 - default lookup uses AE instead of AG
"RTN","SDEC51",50,0)
 N SDJ,SDJ1,SD90,SVC
"RTN","SDEC51",51,0)
 N %DT,X,Y
"RTN","SDEC51",52,0)
 N DRQ,OSACT,OSPEND,SDGMR,STAT
"RTN","SDEC51",53,0)
 S OSACT=$O(^ORD(100.01,"B","ACTIVE",0))
"RTN","SDEC51",54,0)
 S OSPEND=$O(^ORD(100.01,"B","PENDING",0))
"RTN","SDEC51",55,0)
 S SDECI=$G(SDECI,0)
"RTN","SDEC51",56,0)
 S SVC=$S($P(LASTSUB,"|",1)'="":$P(LASTSUB,"|",1)-1,1:0)
"RTN","SDEC51",57,0)
 F  S SVC=$O(^GMR(123,"AE",SVC)) Q:SVC=""  D  Q:SDECI>(MAXREC-1)
"RTN","SDEC51",58,0)
 .F STAT=OSACT,OSPEND D  Q:SDECI>(MAXREC-1)
"RTN","SDEC51",59,0)
 ..Q:STAT=""
"RTN","SDEC51",60,0)
 ..Q:($P(LASTSUB,"|",2)'="")&($P(LASTSUB,"|",2)'=STAT)
"RTN","SDEC51",61,0)
 ..S DRQ=$S($P(LASTSUB,"|",3)'="":$P(LASTSUB,"|",3)-.0001,1:SDBEG-1)
"RTN","SDEC51",62,0)
 ..F  S DRQ=$O(^GMR(123,"AE",SVC,STAT,DRQ)) Q:DRQ=""  Q:$P(DRQ,".",1)>SDEND  D  Q:SDECI>(MAXREC-1)
"RTN","SDEC51",63,0)
 ...S SDGMR=$S($P(LASTSUB,"|",4)'="":$P(LASTSUB,"|",4),1:0)
"RTN","SDEC51",64,0)
 ...S LASTSUB=""
"RTN","SDEC51",65,0)
 ...F  S SDGMR=$O(^GMR(123,"AE",SVC,STAT,DRQ,SDGMR)) Q:SDGMR=""  D REQGET1 I SDECI>(MAXREC-1) S SDSUB=SVC_"|"_STAT_"|"_DRQ_"|"_SDGMR Q
"RTN","SDEC51",66,0)
REQX ;
"RTN","SDEC51",67,0)
 S SDTMP=@SDECY@(SDECI) S SDTMP=$P(SDTMP,$C(30),1)
"RTN","SDEC51",68,0)
 S:$G(SDSUB)'="" $P(SDTMP,U,40)=SDSUB
"RTN","SDEC51",69,0)
 S @SDECY@(SDECI)=SDTMP_$C(30,31)
"RTN","SDEC51",70,0)
 Q
"RTN","SDEC51",71,0)
HDR ;Get the header information
"RTN","SDEC51",72,0)
 ;              1                 2           3         4
"RTN","SDEC51",73,0)
 S SDTMP="T00020CONSULTIEN^T00020ORIGDT^T00020DFN^T00030NAME"
"RTN","SDEC51",74,0)
 ;                     5                6             7              8                     9
"RTN","SDEC51",75,0)
 S SDTMP=SDTMP_"^T00030TO_SERVICE^T00010CLINIEN^T00030CLINNAME^T00030DATE_OF_REQUEST^T00030PRIO"
"RTN","SDEC51",76,0)
 ;                     10            11             12            13
"RTN","SDEC51",77,0)
 S SDTMP=SDTMP_"^T00030USERIEN^T00030USERNAME^T00030PROVIEN^T00030PROVNAME"
"RTN","SDEC51",78,0)
 ;                     14                 15                        16         17
"RTN","SDEC51",79,0)
 S SDTMP=SDTMP_"^T00030REQUEST_TYPE^T00030SERVICE_RENDERED_AS^T00100COMM^T00500REQ_PROC_ACT"
"RTN","SDEC51",80,0)
 ;                     18        19        20        21           22            23
"RTN","SDEC51",81,0)
 S SDTMP=SDTMP_"^T00030HRN^T00030DOB^T00030SSN^T00030GENDER^T00030INSTIEN^T00030INSTNAME"
"RTN","SDEC51",82,0)
 ;                     24           25            26             27            28
"RTN","SDEC51",83,0)
 S SDTMP=SDTMP_"^T00030PRIGRP^T00030ELIGIEN^T00030ELIGNAME^T00030SVCCONN^T00030SVCCONNP"
"RTN","SDEC51",84,0)
 ;                     29            30             31             32             33
"RTN","SDEC51",85,0)
 S SDTMP=SDTMP_"^T00030TYPEIEN^T00030TYPENAME^T00030PADDRES1^T00030PADDRES2^T00030PADDRES3"
"RTN","SDEC51",86,0)
 ;                     34          35           36             37          38      39             40
"RTN","SDEC51",87,0)
 S SDTMP=SDTMP_"^T00030PCITY^T00030PSTATE^T00030PCOUNTRY^T00030PZIP4^T00030GAF^T00100SENSITIVE^T00030LASTSUB"
"RTN","SDEC51",88,0)
 ;                     41         42            43            44          45           46         47
"RTN","SDEC51",89,0)
 S SDTMP=SDTMP_"^T00100STOP^T00030PTPHONE^T00030URGENCY^T00030PRACE^T00030PRACEN^T00030PETH^T00030PETHN"
"RTN","SDEC51",90,0)
 ;                     48            49
"RTN","SDEC51",91,0)
 S SDTMP=SDTMP_"^T00030PRHBLOC^T00030EARLIEST"
"RTN","SDEC51",92,0)
 S SDTMP=SDTMP_"^T00030BADADD^T00030OPHONE^T00030NOK^T00030KNAME^T00030KREL^T00030KPHONE"
"RTN","SDEC51",93,0)
 S SDTMP=SDTMP_"^T00030KSTREET^T00030KSTREET2^T00030KSTREET3^T00030KCITY^T00030KSTATE^T00030KZIP"
"RTN","SDEC51",94,0)
 S SDTMP=SDTMP_"^T00030NOK2^T00030K2NAME^T00030K2REL^T00030K2PHONE"
"RTN","SDEC51",95,0)
 S SDTMP=SDTMP_"^T00030K2STREET^T00030K2STREET2^T00030K2STREET3^T00030K2CITY^T00030K2STATE^T00030K2ZIP^T00030PCOUNTY"
"RTN","SDEC51",96,0)
 S SDTMP=SDTMP_"^T00030PMARITAL^T00030PRELIGION"
"RTN","SDEC51",97,0)
 S SDTMP=SDTMP_"^T00030PTACTIVE^T00030PTADDRESS1^T00030PTADDRESS2PTADDRESS3^T00030^T00030PTCITY^T00030PTSTATE^T00030PTZIP^T00030PTZIP+4"
"RTN","SDEC51",98,0)
 S SDTMP=SDTMP_"^T00030PTCOUNTRY^T00030PTCOUNTY^T00030PTPHONE^T00030PTSTART^T00030PTEND^T00030PCELL^T00030PPAGER^T00030PEMAIL"
"RTN","SDEC51",99,0)
 S SDTMP=SDTMP_"^T00030PF_FFF^T00030PF_VCD^T00030PFNATIONAL^T00030PFLOCAL^T00030SUBGRP^T00030CAT8G^T01000SIMILAR"
"RTN","SDEC51",100,0)
 S @SDECY@(SDECI)=SDTMP_$C(30)
"RTN","SDEC51",101,0)
 Q
"RTN","SDEC51",102,0)
GETONE(SDECY,SDGMR) ;Get one specific consult
"RTN","SDEC51",103,0)
 ;              1                 2           3         4
"RTN","SDEC51",104,0)
 N PADDRES1,PADDRES2,PADDRES3,PCITY,PSTATE,PCOUNTRY,PZIP4
"RTN","SDEC51",105,0)
 N SDECI,SDI,SDJ,SDREASON,SDREC,SDRECL,SDRPA,SDRPA0,SDTMP,SDWP,X,Y,%DT
"RTN","SDEC51",106,0)
 N SDCNT,SDCAN,SDCDC,SDCANF,SDCSTOP,SDSCHED,SDSCHEDF,SDSENS,SDSTAT,SDSTATF,SDDONE
"RTN","SDEC51",107,0)
 N ELIGIEN,ELIGNAME,GAF,PRIGRP,SVCCONN,SVCCONNP,TYPEIEN,TYPENAME
"RTN","SDEC51",108,0)
 N SDDEMO,SDSUB
"RTN","SDEC51",109,0)
 N DOB,GENDER,HRN,INSTIEN,INSTNAME,NAME,SSN,SVVCCONN
"RTN","SDEC51",110,0)
 N PRACE,PRACEN,PETH,PETHN
"RTN","SDEC51",111,0)
 S SDSUB=""
"RTN","SDEC51",112,0)
 S SDECI=0
"RTN","SDEC51",113,0)
 K ^TMP("SDEC",$J)
"RTN","SDEC51",114,0)
 S SDECY="^TMP(""SDEC"","_$J_")"
"RTN","SDEC51",115,0)
 D HDR
"RTN","SDEC51",116,0)
 S (SDCANF,SDSCHEDF)=0
"RTN","SDEC51",117,0)
 S SDREC=$$GETIEN("RECEIVED")
"RTN","SDEC51",118,0)
 I SDREC="" D ERR1^SDECERR(-1,"REQUEST ACTION TYPES file does not have an entry of RECEIVED.",.SDECI,SDECY) Q
"RTN","SDEC51",119,0)
 S SDSCHED=$$GETIEN("SCHEDULED")
"RTN","SDEC51",120,0)
 I SDSCHED="" D ERR1^SDECERR(-1,"REQUEST ACTION TYPES file does not have an entry of SCHEDULED.",.SDECI,SDECY) Q
"RTN","SDEC51",121,0)
 S SDSTAT=$$GETIEN("STATUS CHANGE")
"RTN","SDEC51",122,0)
 S SDCAN=$$GETIEN("CANCELLED")
"RTN","SDEC51",123,0)
 S SDDONE=$$GETIEN("COMPLETE/UPDATE")
"RTN","SDEC51",124,0)
 S SDCDC=$$GETIEN("DISCONTINUED")
"RTN","SDEC51",125,0)
 D REQGET1
"RTN","SDEC51",126,0)
 Q
"RTN","SDEC51",127,0)
REQGET1 ;
"RTN","SDEC51",128,0)
 N SDCL,SDGMR0,SDDATA,SDSER,SDSTOP,SIEN,STOP,IN,PRHBLOC
"RTN","SDEC51",129,0)
 ;
"RTN","SDEC51",130,0)
 ;  Added DFN to new list so data error in file #123 does not cause GUI to crash.  wtc  SD*5.3*686
"RTN","SDEC51",131,0)
 ;
"RTN","SDEC51",132,0)
 N PRIO,DFN ;
"RTN","SDEC51",133,0)
 S SDRECL="",SDSTOP=""
"RTN","SDEC51",134,0)
 S (SDCANF,SDSCHEDF,SDSTATF)=0
"RTN","SDEC51",135,0)
 S SDCL=$P($G(^GMR(123,+SDGMR,0)),U,6)   ;ICR 4837
"RTN","SDEC51",136,0)
 I SDCL'="",$$GET1^DIQ(44,SDCL_",",50.01,"I")=1 Q  ;check OOS?
"RTN","SDEC51",137,0)
 S PRHBLOC=$S($$GET1^DIQ(44,+SDCL_",",2500,"I")="Y":1,1:0)
"RTN","SDEC51",138,0)
 S SDGMR0=$G(^GMR(123,SDGMR,0))   ;ICR 4837 states 'Zero node read into variable'
"RTN","SDEC51",139,0)
 S IN=$P(SDGMR0,U,18)   ;$$GET1^DIQ(123,SDGMR_",",14)
"RTN","SDEC51",140,0)
 ;Q:IN="inpatient"            ;Inpatient consults do not have appointments
"RTN","SDEC51",141,0)
 S SDSER=$P(SDGMR0,U,5)
"RTN","SDEC51",142,0)
 I +SDSER D
"RTN","SDEC51",143,0)
 .S SIEN=0 F  S SIEN=$O(^GMR(123.5,SDSER,688,SIEN)) Q:'+SIEN  D
"RTN","SDEC51",144,0)
 ..S STOP=$G(^GMR(123.5,SDSER,688,SIEN,0))   ;ICR 4557
"RTN","SDEC51",145,0)
 ..I SDSTOP="" S SDSTOP=STOP
"RTN","SDEC51",146,0)
 ..E  S SDSTOP=SDSTOP_"|"_STOP
"RTN","SDEC51",147,0)
 S DFN=$$GET1^DIQ(123,SDGMR_",",.02,"I")
"RTN","SDEC51",148,0)
 Q:DFN=""
"RTN","SDEC51",149,0)
 ;
"RTN","SDEC51",150,0)
 I '$G(SDNOCHK) Q:$$REQCHK(.SDRECL,SDGMR,DFN)
"RTN","SDEC51",151,0)
 ;
"RTN","SDEC51",152,0)
 ;Q:SDCANF
"RTN","SDEC51",153,0)
 ;Q:SDSCHEDF
"RTN","SDEC51",154,0)
 I 1 D
"RTN","SDEC51",155,0)
 .;get REASON FOR REQUEST wp text
"RTN","SDEC51",156,0)
 .K SDWP
"RTN","SDEC51",157,0)
 .S X=$$GET1^DIQ(123,SDGMR_",",20,"","SDWP")
"RTN","SDEC51",158,0)
 .;S SDREASON=""
"RTN","SDEC51",159,0)
 .;I $D(SDWP) S SDI="" F  S SDI=$O(SDWP(SDI)) Q:SDI=""  S SDREASON=$S(SDREASON'="":SDREASON_$C(13,10),1:"")_$TR(SDWP(SDI),"^") Q
"RTN","SDEC51",160,0)
 .;collect demographics
"RTN","SDEC51",161,0)
 .D PDEMO^SDECU3(.SDDEMO,DFN)   ;alb/sat 658 PDEMO moved to SDECU3
"RTN","SDEC51",162,0)
 .S NAME=SDDEMO("NAME")
"RTN","SDEC51",163,0)
 .S DOB=SDDEMO("DOB")
"RTN","SDEC51",164,0)
 .S GENDER=SDDEMO("GENDER")
"RTN","SDEC51",165,0)
 .S HRN=SDDEMO("HRN")
"RTN","SDEC51",166,0)
 .S SSN=SDDEMO("SSN")
"RTN","SDEC51",167,0)
 .S INSTIEN=SDDEMO("INSTIEN")
"RTN","SDEC51",168,0)
 .S INSTNAME=SDDEMO("INSTNAME")
"RTN","SDEC51",169,0)
 .S PRIGRP=SDDEMO("PRIGRP")       ;24
"RTN","SDEC51",170,0)
 .S ELIGIEN=SDDEMO("ELIGIEN")     ;25
"RTN","SDEC51",171,0)
 .S ELIGNAME=SDDEMO("ELIGNAME")   ;26
"RTN","SDEC51",172,0)
 .S SVVCCONN=SDDEMO("SVCCONN")    ;27
"RTN","SDEC51",173,0)
 .S SVCCONNP=SDDEMO("SVCCONNP")   ;28
"RTN","SDEC51",174,0)
 .S TYPEIEN=SDDEMO("TYPEIEN")     ;29
"RTN","SDEC51",175,0)
 .S TYPENAME=SDDEMO("TYPENAME")   ;30
"RTN","SDEC51",176,0)
 .S PADDRES1=SDDEMO("PADDRES1")   ;31   - Patient Address line 1
"RTN","SDEC51",177,0)
 .S PADDRES2=SDDEMO("PADDRES2")   ;32   - Patient Address line 2
"RTN","SDEC51",178,0)
 .S PADDRES3=SDDEMO("PADDRES3")   ;33   - Patient Address line 3
"RTN","SDEC51",179,0)
 .S PCITY=SDDEMO("PCITY")         ;34   - Patient City
"RTN","SDEC51",180,0)
 .S PSTATE=SDDEMO("PSTATE")       ;35   - Patient state name
"RTN","SDEC51",181,0)
 .S PCOUNTRY=SDDEMO("PCOUNTRY")   ;36   - Patient country name
"RTN","SDEC51",182,0)
 .S PZIP4=SDDEMO("PZIP+4")        ;37   - Patient Zip+4
"RTN","SDEC51",183,0)
 .S PTPHONE=SDDEMO("HPHONE")      ;42   - Patient phone
"RTN","SDEC51",184,0)
 .S GAF=$$GAF^SDECU2(DFN)         ;38
"RTN","SDEC51",185,0)
 .S SDSENS=$$PTSEC^SDECUTL(DFN)   ;39
"RTN","SDEC51",186,0)
 .D RACELST^SDECU2(DFN,.PRACE,.PRACEN)
"RTN","SDEC51",187,0)
 .D ETH^SDECU2(DFN,.PETH,.PETHN)   ;get ethnicity
"RTN","SDEC51",188,0)
 .S PRIO=$$PRIO^SDEC51A(SDGMR)
"RTN","SDEC51",189,0)
 .;       1         2                                     3                  4
"RTN","SDEC51",190,0)
 .S SDTMP=SDGMR_"^"_$$GET1^DIQ(123,SDGMR_",",.01,"I")_"^"_$P(SDGMR0,U,2)_"^"_$$GET1^DIQ(123,SDGMR_",",.02)
"RTN","SDEC51",191,0)
 .;                 5                               6                                   7                               8
"RTN","SDEC51",192,0)
 .S SDTMP=SDTMP_"^"_$$GET1^DIQ(123,SDGMR_",",1)_"^"_$$GET1^DIQ(123,SDGMR_",",2,"I")_"^"_$$GET1^DIQ(123,SDGMR_",",2)_"^"_$$GET1^DIQ(123,SDGMR_",",3,"I")
"RTN","SDEC51",193,0)
 .;                 9        10                                  11                              12
"RTN","SDEC51",194,0)
 .S SDTMP=SDTMP_"^"_PRIO_"^"_$$GET1^DIQ(123,SDGMR_",",7,"I")_"^"_$$GET1^DIQ(123,SDGMR_",",7)_"^"_$P(SDGMR0,U,14)
"RTN","SDEC51",195,0)
 .;                 13                               14                               15
"RTN","SDEC51",196,0)
 .S SDTMP=SDTMP_"^"_$$GET1^DIQ(123,SDGMR_",",10)_"^"_$$GET1^DIQ(123,SDGMR_",",13)_"^"_$$GET1^DIQ(123,SDGMR_",",14)
"RTN","SDEC51",197,0)
 .;                 16     17
"RTN","SDEC51",198,0)
 .S SDTMP=SDTMP_"^"_""_"^"_SDRECL
"RTN","SDEC51",199,0)
 .;               18   19    20    21       22        23
"RTN","SDEC51",200,0)
 .S SDTMP=SDTMP_U_""_U_DOB_U_SSN_U_GENDER_U_INSTIEN_U_INSTNAME    ;23
"RTN","SDEC51",201,0)
 .;               24       25        26         27         28
"RTN","SDEC51",202,0)
 .S SDTMP=SDTMP_U_PRIGRP_U_ELIGIEN_U_ELIGNAME_U_SVVCCONN_U_SVCCONNP   ;28
"RTN","SDEC51",203,0)
 .;               29        30         31         32         33
"RTN","SDEC51",204,0)
 .S SDTMP=SDTMP_U_TYPEIEN_U_TYPENAME_U_PADDRES1_U_PADDRES2_U_PADDRES3 ;33
"RTN","SDEC51",205,0)
 .;               34      35       36         37      38      39
"RTN","SDEC51",206,0)
 .S SDTMP=SDTMP_U_PCITY_U_PSTATE_U_PCOUNTRY_U_PZIP4_U_GAF_U_SDSENS    ;39
"RTN","SDEC51",207,0)
 .S SDTMP=SDTMP_U_U_SDSTOP_U_PTPHONE_U_$$GET1^DIQ(123,SDGMR_",",5,"I")  ;save the 40th position for LASTSUB if it is to be returned
"RTN","SDEC51",208,0)
 .S SDTMP=SDTMP_U_PRACE_U_PRACEN_U_PETH_U_PETHN_U_PRHBLOC_U_$$GET1^DIQ(123,SDGMR_",",17,"I")   ;49
"RTN","SDEC51",209,0)
 .S $P(SDTMP,U,50)=SDDEMO("BADADD")
"RTN","SDEC51",210,0)
 .S $P(SDTMP,U,51)=SDDEMO("OPHONE")
"RTN","SDEC51",211,0)
 .S $P(SDTMP,U,52)=SDDEMO("NOK")
"RTN","SDEC51",212,0)
 .S $P(SDTMP,U,53)=SDDEMO("KNAME")
"RTN","SDEC51",213,0)
 .S $P(SDTMP,U,54)=SDDEMO("KREL")
"RTN","SDEC51",214,0)
 .S $P(SDTMP,U,55)=SDDEMO("KPHONE")
"RTN","SDEC51",215,0)
 .S $P(SDTMP,U,56)=SDDEMO("KSTREET")
"RTN","SDEC51",216,0)
 .S $P(SDTMP,U,57)=SDDEMO("KSTREET2")
"RTN","SDEC51",217,0)
 .S $P(SDTMP,U,58)=SDDEMO("KSTREET3")
"RTN","SDEC51",218,0)
 .S $P(SDTMP,U,59)=SDDEMO("KCITY")
"RTN","SDEC51",219,0)
 .S $P(SDTMP,U,60)=SDDEMO("KSTATE")
"RTN","SDEC51",220,0)
 .S $P(SDTMP,U,61)=SDDEMO("KZIP")
"RTN","SDEC51",221,0)
 .S $P(SDTMP,U,62)=SDDEMO("NOK2")
"RTN","SDEC51",222,0)
 .S $P(SDTMP,U,63)=SDDEMO("K2NAME")
"RTN","SDEC51",223,0)
 .S $P(SDTMP,U,64)=SDDEMO("K2REL")
"RTN","SDEC51",224,0)
 .S $P(SDTMP,U,65)=SDDEMO("K2PHONE")
"RTN","SDEC51",225,0)
 .S $P(SDTMP,U,66)=SDDEMO("K2STREET")
"RTN","SDEC51",226,0)
 .S $P(SDTMP,U,67)=SDDEMO("K2STREET2")
"RTN","SDEC51",227,0)
 .S $P(SDTMP,U,68)=SDDEMO("K2STREET3")
"RTN","SDEC51",228,0)
 .S $P(SDTMP,U,69)=SDDEMO("K2CITY")
"RTN","SDEC51",229,0)
 .S $P(SDTMP,U,70)=SDDEMO("K2STATE")
"RTN","SDEC51",230,0)
 .S $P(SDTMP,U,71)=SDDEMO("K2ZIP")
"RTN","SDEC51",231,0)
 .S $P(SDTMP,U,72)=SDDEMO("PCOUNTY")
"RTN","SDEC51",232,0)
 .S $P(SDTMP,U,73)=SDDEMO("PMARITAL")
"RTN","SDEC51",233,0)
 .S $P(SDTMP,U,74)=SDDEMO("PRELIGION")
"RTN","SDEC51",234,0)
 .S $P(SDTMP,U,75)=SDDEMO("PTACTIVE")
"RTN","SDEC51",235,0)
 .S $P(SDTMP,U,76)=SDDEMO("PTADDRESS1")
"RTN","SDEC51",236,0)
 .S $P(SDTMP,U,77)=SDDEMO("PTADDRESS2")
"RTN","SDEC51",237,0)
 .S $P(SDTMP,U,78)=SDDEMO("PTADDRESS3")
"RTN","SDEC51",238,0)
 .S $P(SDTMP,U,79)=SDDEMO("PTCITY")
"RTN","SDEC51",239,0)
 .S $P(SDTMP,U,80)=SDDEMO("PTSTATE")
"RTN","SDEC51",240,0)
 .S $P(SDTMP,U,81)=SDDEMO("PTZIP")
"RTN","SDEC51",241,0)
 .S $P(SDTMP,U,82)=SDDEMO("PTZIP+4")
"RTN","SDEC51",242,0)
 .S $P(SDTMP,U,83)=SDDEMO("PTCOUNTRY")
"RTN","SDEC51",243,0)
 .S $P(SDTMP,U,84)=SDDEMO("PTCOUNTY")
"RTN","SDEC51",244,0)
 .S $P(SDTMP,U,85)=SDDEMO("PTPHONE")
"RTN","SDEC51",245,0)
 .S $P(SDTMP,U,86)=SDDEMO("PTSTART")
"RTN","SDEC51",246,0)
 .S $P(SDTMP,U,87)=SDDEMO("PTEND")
"RTN","SDEC51",247,0)
 .S $P(SDTMP,U,88)=SDDEMO("PCELL")
"RTN","SDEC51",248,0)
 .S $P(SDTMP,U,89)=SDDEMO("PPAGER")
"RTN","SDEC51",249,0)
 .S $P(SDTMP,U,90)=SDDEMO("PEMAIL")
"RTN","SDEC51",250,0)
 .S $P(SDTMP,U,91)=SDDEMO("PF_FFF")
"RTN","SDEC51",251,0)
 .S $P(SDTMP,U,92)=SDDEMO("PF_VCD")
"RTN","SDEC51",252,0)
 .S $P(SDTMP,U,93)=SDDEMO("PFNATIONAL")
"RTN","SDEC51",253,0)
 .S $P(SDTMP,U,94)=SDDEMO("PFLOCAL")
"RTN","SDEC51",254,0)
 .S $P(SDTMP,U,95)=SDDEMO("SUBGRP")
"RTN","SDEC51",255,0)
 .S $P(SDTMP,U,96)=(PRIGRP="GROUP 8")&(SDDEMO("SUBGRP")="g")
"RTN","SDEC51",256,0)
 .S $P(SDTMP,U,97)=SDDEMO("SIMILAR")
"RTN","SDEC51",257,0)
 .S SDECI=SDECI+1 S @SDECY@(SDECI)=SDTMP_$C(30)
"RTN","SDEC51",258,0)
 Q
"RTN","SDEC51",259,0)
 ;
"RTN","SDEC51",260,0)
REQCHK(SDRECL,SDGMR,DFN) ;alb/sat 658 - new rules for consult check
"RTN","SDEC51",261,0)
 N CPRSTAT,IFC,OSACT,OSPEND
"RTN","SDEC51",262,0)
 Q:'$D(^GMR(123,+$G(SDGMR),0)) 1
"RTN","SDEC51",263,0)
 S OSACT=$O(^ORD(100.01,"B","ACTIVE",0))
"RTN","SDEC51",264,0)
 S OSPEND=$O(^ORD(100.01,"B","PENDING",0))
"RTN","SDEC51",265,0)
 S CPRSTAT=$$GET1^DIQ(123,SDGMR_",",8,"I")
"RTN","SDEC51",266,0)
 Q:'((CPRSTAT=OSACT)!(CPRSTAT=OSPEND)) 1
"RTN","SDEC51",267,0)
 S IFC=$$GET1^DIQ(123,SDGMR,.125,"I")
"RTN","SDEC51",268,0)
 Q:IFC="P" 1
"RTN","SDEC51",269,0)
 Q 0
"RTN","SDEC51",270,0)
REQCHK1(SDRECL,SDGMR,DFN) ; OLD
"RTN","SDEC51",271,0)
 N CPRSTAT,X,X1,X2   ;alb/sat 651
"RTN","SDEC51",272,0)
 N SDCAN,SDCANF,SDCDC,SDDONE,SDES,SDESF,SDFD,SDPDC,SDRPA,SDRPA0,SDSCHED,SDSCHEDF,SDSER,SDSTAT,SDSTATF
"RTN","SDEC51",273,0)
 N SDNOS     ;alb/sat 651
"RTN","SDEC51",274,0)
 S SDPDC=$O(^ORD(100.01,"B","DISCONTINUED",0))
"RTN","SDEC51",275,0)
 S CPRSTAT=$$GET1^DIQ(123,SDGMR_",",8,"I")   ;alb/sat 651 - set new CPRSTAT var
"RTN","SDEC51",276,0)
 Q:CPRSTAT=SDPDC 1   ;don't return this entry if CPRS STATUS is DISCONTINUED ;alb/sat 651 - use CPRSTAT instead of GET1^DIQ
"RTN","SDEC51",277,0)
 S SDFD=$P($$GET1^DIQ(123,SDGMR_",",.01,"I"),".",1)   ;alb/sat 651 - get FILE ENTRY DATE
"RTN","SDEC51",278,0)
 ;**Removed below line alb/jsm 658 - Consults to be displayed in the RM Grid regardless of the request date**
"RTN","SDEC51",279,0)
 ;Q:$$FMADD^XLFDT(DT,-365)>SDFD 1  ;alb/sat 651 - do not include records with FILE ENTRY DATE older than 1 year
"RTN","SDEC51",280,0)
 S SDSCHED=$$GETIEN("SCHEDULED")      ;$O(^GMR(123.1,"B","SCHEDULED",0))
"RTN","SDEC51",281,0)
 S SDSTAT=$$GETIEN("STATUS CHANGE")   ;$O(^GMR(123.1,"B","STATUS CHANGE",0))
"RTN","SDEC51",282,0)
 S SDCAN=$$GETIEN("CANCELLED")        ;$O(^GMR(123.1,"B","CANCELLED",0))
"RTN","SDEC51",283,0)
 S SDDONE=$$GETIEN("COMPLETE/UPDATE") ;$O(^GMR(123.1,"B","COMPLETE/UPDATE",0))
"RTN","SDEC51",284,0)
 S SDCDC=$$GETIEN("DISCONTINUED")     ;$O(^GMR(123.1,"B","DISCONTINUED",0))
"RTN","SDEC51",285,0)
 S SDES=$$GETIEN("EDIT/RESUBMITTED")
"RTN","SDEC51",286,0)
 S SDSER=$$GET1^DIQ(123,SDGMR_",",1,"I")   ;ICR 6185
"RTN","SDEC51",287,0)
 S DFN=$G(DFN) I '+DFN S DFN=$$GET1^DIQ(123,SDGMR_",",.02,"I")   ;ICR 6185
"RTN","SDEC51",288,0)
 S SDRECL=$G(SDRECL)
"RTN","SDEC51",289,0)
 S (SDCANF,SDESF,SDSCHEDF,SDSTATF)=0
"RTN","SDEC51",290,0)
 ;alb/sat 651 - start modification
"RTN","SDEC51",291,0)
 I CPRSTAT=13 D  G REQCHKX     ;cancel/no-show  ;13 is cancel - see A+7^SDCNSLT SD*5.3*627
"RTN","SDEC51",292,0)
 .S SDCANF=1
"RTN","SDEC51",293,0)
 .S SDNOS=$O(^GMR(123,SDGMR,40,":"),-1) Q:'+SDNOS       ;ICR 6185
"RTN","SDEC51",294,0)
 .S SDNOS=$O(^GMR(123,SDGMR,40,SDNOS),-1) Q:'+SDNOS
"RTN","SDEC51",295,0)
 .S X2=$P($G(^GMR(123,SDGMR,40,SDNOS,0)),U),X1=DT D ^%DTC Q:X'=""&(X>180)   ;ICR 6185
"RTN","SDEC51",296,0)
 .I $$FINDTXT^SDEC51A(SDGMR,SDNOS) D
"RTN","SDEC51",297,0)
 ..S SDCANF=0
"RTN","SDEC51",298,0)
 ..S:$L($G(SDRECL))<225 SDRECL=SDNOS_";;"_$$GET1^DIQ(123.02,SDNOS_","_SDGMR_",",.01,"E")_";;"_SDCAN_$S(SDRECL'="":"|"_SDRECL,1:"")
"RTN","SDEC51",299,0)
 ;alb/sat 651 - end modification
"RTN","SDEC51",300,0)
 S SDRPA=9999999 F  S SDRPA=$O(^GMR(123,SDGMR,40,SDRPA),-1) Q:SDRPA'>0  D  Q:SDCANF=1  Q:SDSCHEDF=1  Q:SDESF=1   ;ICR 6185
"RTN","SDEC51",301,0)
 .K SDDATA
"RTN","SDEC51",302,0)
 .D GETS^DIQ(123.02,SDRPA_","_SDGMR_",",".01;1;2;4","IE","SDDATA")   ;ICR 6185
"RTN","SDEC51",303,0)
 .S SDRPA0=SDDATA(123.02,SDRPA_","_SDGMR_",",1,"I")  ;  $G(^GMR(123,SDGMR,40,SDRPA,0))
"RTN","SDEC51",304,0)
 .I SDRPA0'=SDSCHED,SDRPA0'=SDSTAT,SDRPA0'=SDCAN,SDRPA0'=SDDONE,SDRPA0'=SDCDC,SDRPA0'=SDES Q  ;SDRECL is getting too long; only watch the ones we need
"RTN","SDEC51",305,0)
 .I (SDRPA0=SDCAN)!(SDRPA0=SDDONE)!(SDRPA0=SDCDC) S SDCANF=1 Q    ;skip completed consults/mgh
"RTN","SDEC51",306,0)
 .I SDRPA0=SDES S SDESF=1 Q
"RTN","SDEC51",307,0)
 .I SDRPA0=SDSCHED,SDSTATF'=1,$$SDCHED^SDEC51A(DFN,SDDATA(123.02,SDRPA_","_SDGMR_",",2,"I"),SDSER) S SDSCHEDF=1 Q
"RTN","SDEC51",308,0)
 .I SDRPA0=SDSTAT,$$FINDTXT^SDEC51A(SDGMR,SDRPA) S SDSTATF=1
"RTN","SDEC51",309,0)
 .S:$L($G(SDRECL))<225 SDRECL=SDRPA_";;"_SDDATA(123.02,SDRPA_","_SDGMR_",",.01,"E")_";;"_SDRPA0_$S(SDRECL'="":"|"_SDRECL,1:"")
"RTN","SDEC51",310,0)
REQCHKX ; exit  ;alb/sat 651 - add REQCHKX tag
"RTN","SDEC51",311,0)
 K SDDATA
"RTN","SDEC51",312,0)
 Q:SDSCHEDF SDSCHEDF
"RTN","SDEC51",313,0)
 Q:SDCANF SDCANF
"RTN","SDEC51",314,0)
 Q:SDESF 0
"RTN","SDEC51",315,0)
 Q 0
"RTN","SDEC51",316,0)
 ;
"RTN","SDEC51",317,0)
GETIEN(NAME) ;get ID from REQUEST ACTION TYPES file 123.1   ;ICR 6186
"RTN","SDEC51",318,0)
 N DIC
"RTN","SDEC51",319,0)
 S DIC=123.1
"RTN","SDEC51",320,0)
 S DIC(0)="BO"
"RTN","SDEC51",321,0)
 S X=NAME
"RTN","SDEC51",322,0)
 D ^DIC
"RTN","SDEC51",323,0)
 I Y=-1 Q ""
"RTN","SDEC51",324,0)
 Q $P(Y,U,1)
"RTN","SDEC57")
0^14^B100290193^B115815412
"RTN","SDEC57",1,0)
SDEC57 ;ALB/SAT/JSM - VISTA SCHEDULING RPCS ; 18 Jun 2018  4:21 PM
"RTN","SDEC57",2,0)
 ;;5.3;Scheduling;**627,642,658,665,701,686**;Aug 13, 1993;Build 53
"RTN","SDEC57",3,0)
 ;
"RTN","SDEC57",4,0)
 Q
"RTN","SDEC57",5,0)
 ;APPSLOTS - return appt slots and availability
"RTN","SDEC57",6,0)
 ;SDECY=Return global array
"RTN","SDEC57",7,0)
 ;  FM DATE ^ SLOT START TIME ^ SLOT STOP TIME ^ AVAILABILITY CODE
"RTN","SDEC57",8,0)
 ;  Availability codes 0-9,j-z for 0 to 26 available appts, A-W for overbooks 1-23
"RTN","SDEC57",9,0)
 ;SDECRES=Resource name
"RTN","SDEC57",10,0)
 ;SDECSTRT=Start date/time
"RTN","SDEC57",11,0)
 ;SDECEND=End date/time
"RTN","SDEC57",12,0)
APPSLOTS(SDECY,SDECRES,SDECSTART,SDECEND) ;GET Create Assigned Slot Schedule
"RTN","SDEC57",13,0)
 N CNT
"RTN","SDEC57",14,0)
 N SDECAD,SDECALO,SDECBS,SDECDEP,SDECERR,SDECI,SDECIEN,SDECK,SDECL,SDECNEND,SDECNOD
"RTN","SDEC57",15,0)
 N SDECNOT,SDECNSTART,SDECPEND,SDECQ,SDECRESD,SDECRESN,SDECS,SDECSUBCD,SDECTMP
"RTN","SDEC57",16,0)
 N SDAB,SDECTYPE,SDECTYPED,SDECZ
"RTN","SDEC57",17,0)
 N %DT,X,Y
"RTN","SDEC57",18,0)
 S SDECERR=""
"RTN","SDEC57",19,0)
 S SDECY="^TMP(""SDEC57"","_$J_",""APPSLOTS"")"
"RTN","SDEC57",20,0)
 K @SDECY
"RTN","SDEC57",21,0)
 S SDECALO=0,SDECI=0
"RTN","SDEC57",22,0)
 S @SDECY@(SDECI)="T00030DATE^T00030START_TIME^T00030END_TIME^I00010AVAILABILITY"_$C(30)
"RTN","SDEC57",23,0)
 S %DT="T",X=$P($P(SDECSTART,"@",1),".",1) D ^%DT
"RTN","SDEC57",24,0)
 S SDECSTART=Y
"RTN","SDEC57",25,0)
 S %DT="T",X=$P($P(SDECEND,"@",1),".",1) D ^%DT
"RTN","SDEC57",26,0)
 S SDECEND=Y
"RTN","SDEC57",27,0)
 ;validate SDECRES
"RTN","SDEC57",28,0)
 S SDECRES=$G(SDECRES)
"RTN","SDEC57",29,0)
 I SDECRES']"" S @SDECY@(1)="-1^Resource ID is required"_$C(30)_$C(31) Q
"RTN","SDEC57",30,0)
 I +SDECRES,'$D(^SDEC(409.831,+SDECRES,0)) S @SDECY@(1)="-1^Resource ID is required"_$C(30)_$C(31) Q
"RTN","SDEC57",31,0)
 I '+SDECRES S SDECRES=$O(^SDEC(409.831,"B",SDECRES,0)) I '+SDECRES S @SDECY@(1)="-1^Invalid Resource ID"_$C(30)_$C(31) Q
"RTN","SDEC57",32,0)
 S SDAB="^TMP("_$J_",""SDEC57"",""BLKS"")"
"RTN","SDEC57",33,0)
 K @SDAB
"RTN","SDEC57",34,0)
 D GETSLOTS(SDAB,SDECRES,SDECSTART,SDECEND)
"RTN","SDEC57",35,0)
 ;Get Access Type IDs
"RTN","SDEC57",36,0)
 N SD1,SD2,SD3,SD4,SDI,SDNOD,SDENDDT
"RTN","SDEC57",37,0)
 N SDSTRTDT,SDSLOTS,SDSTOPTM,SDSTRTTM
"RTN","SDEC57",38,0)
 S SDI=0 F  S SDI=$O(@SDAB@(SDI)) Q:SDI'>0  D
"RTN","SDEC57",39,0)
 .S SDNOD=@SDAB@(SDI)
"RTN","SDEC57",40,0)
 .S SD1=$P(SDNOD,U,2) ;start DT
"RTN","SDEC57",41,0)
 .S SD2=$P(SDNOD,U,3) ;end DT
"RTN","SDEC57",42,0)
 .S SD3=+$P(SDNOD,U,4) ;slots
"RTN","SDEC57",43,0)
 .S SD4=$P(SDNOD,U,5) ;access type(1=avail,2=not avail,3=canc)
"RTN","SDEC57",44,0)
 .S SDSTRTDT=$P(SD1,".")
"RTN","SDEC57",45,0)
 .S SDENDDT=$P(SD2,".")
"RTN","SDEC57",46,0)
 .S SDSTRTTM=$E($P(SD1_"0000",".",2),1,4)
"RTN","SDEC57",47,0)
 .S SDSTOPTM=$E($P(SD2_"0000",".",2),1,4)
"RTN","SDEC57",48,0)
 .S SDSLOTS=$P(SDNOD,U,4)
"RTN","SDEC57",49,0)
 .S SDSLOTS=$S(SDSLOTS=" ":"",1:SDSLOTS)
"RTN","SDEC57",50,0)
 .S SDSLOTS=$S(SD4=2:"",SD4=3:"X",1:SDSLOTS)
"RTN","SDEC57",51,0)
 .S SDECI=SDECI+1,@SDECY@(SDECI)=SDSTRTDT_U_SDSTRTTM_U_SDSTOPTM_U_SDSLOTS_$C(30)
"RTN","SDEC57",52,0)
 S @SDECY@(SDECI)=@SDECY@(SDECI)_$C(31)
"RTN","SDEC57",53,0)
 K @SDAB
"RTN","SDEC57",54,0)
 Q
"RTN","SDEC57",55,0)
 ;
"RTN","SDEC57",56,0)
GETSLOTS(SDAB,SDECRES,SDECSTART,SDECEND)  ;load SDEC ACCESS BLOCKS from file 44
"RTN","SDEC57",57,0)
 N SDCL,SDI,SDJ
"RTN","SDEC57",58,0)
 S SDECRES=$G(SDECRES) Q:SDECRES=""
"RTN","SDEC57",59,0)
 I +SDECRES,'$D(^SDEC(409.831,+SDECRES,0)) Q
"RTN","SDEC57",60,0)
 I '+SDECRES S SDECRES=$O(^SDEC(409.831,"B",SDECRES,0))
"RTN","SDEC57",61,0)
 Q:'SDECRES
"RTN","SDEC57",62,0)
 S %DT="T",X=$P($P(SDECSTART,"@",1),".",1) D ^%DT
"RTN","SDEC57",63,0)
 Q:Y=-1
"RTN","SDEC57",64,0)
 S SDECSTART=Y
"RTN","SDEC57",65,0)
 S %DT="T",X=$P($P(SDECEND,"@",1),".",1) D ^%DT
"RTN","SDEC57",66,0)
 Q:Y=-1
"RTN","SDEC57",67,0)
 S SDECEND=Y
"RTN","SDEC57",68,0)
 S SDCL=$$GET1^DIQ(409.831,SDECRES_",",.04,"I")
"RTN","SDEC57",69,0)
 Q:SDCL=""
"RTN","SDEC57",70,0)
 S SDI=$$FMADD^XLFDT(SDECSTART,-1)
"RTN","SDEC57",71,0)
 ;
"RTN","SDEC57",72,0)
 ;  Handle where SDI is initially -1 because of bad future dates.  wtc  6/18/18 SD*5.3*701
"RTN","SDEC57",73,0)
 ;
"RTN","SDEC57",74,0)
 I SDI<0 S @SDECY@(1)="-1^Bad future appointment date"_$C(30)_$C(31) Q  ;
"RTN","SDEC57",75,0)
 N BADATE S BADATE=0 ;
"RTN","SDEC57",76,0)
 F  S SDI=$$FMADD^XLFDT(SDI,1) Q:SDI>$P(SDECEND,".",1)!(BADATE>0)  D  ;
"RTN","SDEC57",77,0)
 . I SDI<0 S BADATE=1,SDECI=SDECI+1,@SDECY@(SDECI)="-1^Bad future appointment date"_$C(30)_$C(31) Q  ;
"RTN","SDEC57",78,0)
 .I ($O(^SC(SDCL,"T",0))="")!($O(^SC(SDCL,"T",0))>SDI) Q
"RTN","SDEC57",79,0)
 .I $$GET1^DIQ(44,SDCL_",",1918.5,"I")'="Y",$D(^HOLIDAY("B",SDI)) Q   ;do not schedule on holidays
"RTN","SDEC57",80,0)
 .;Q:$G(^SC(SDCL,"ST",SDI,1))["**CANCELLED**"
"RTN","SDEC57",81,0)
 .Q:$$INACTIVE^SDEC32(SDCL,$P(SDI,".",1))   ;don't get availability if clinic inactive on day SDI
"RTN","SDEC57",82,0)
 .D RESAB(SDAB,SDCL,SDI,SDI_"."_2359,SDECRES)
"RTN","SDEC57",83,0)
 Q
"RTN","SDEC57",84,0)
 ;
"RTN","SDEC57",85,0)
RESAB(SDAB,SDCL,SDBEG,SDEND,SDECRES)   ;build access blocks for 1 clinic
"RTN","SDEC57",86,0)
 ; SDECRES (optional) Resource pointer to SDEC RESOURCE file
"RTN","SDEC57",87,0)
 ;                    used to build access blocks from clinic availability
"RTN","SDEC57",88,0)
 ;                    for only this resource; all resources are build if null
"RTN","SDEC57",89,0)
 ;  .01    name
"RTN","SDEC57",90,0)
 ;    2    type (clinic)
"RTN","SDEC57",91,0)
 ;   1912  length of app't
"RTN","SDEC57",92,0)
 ;   1914  hour clinic display begins default is 8am; whole number 0-16
"RTN","SDEC57",93,0)
 ;   1917  display increments per hour
"RTN","SDEC57",94,0)
 ;   2505  inactive date
"RTN","SDEC57",95,0)
 ;   2506  reactivate date
"RTN","SDEC57",96,0)
 N SDAY,SDCLS,SDDATA,SDFIELDS,SDIN,SDLEN,SDRA,SDSI,SDT
"RTN","SDEC57",97,0)
 I $P($G(SDBEG),".",1)'?7N S SDBEG=$$FMADD^XLFDT($P($$NOW^XLFDT,".",1),-1)
"RTN","SDEC57",98,0)
 I $P($G(SDEND),".",1)'?7N S SDEND=$$FMADD^XLFDT($P($$NOW^XLFDT,".",1),365)
"RTN","SDEC57",99,0)
 S SDECRES=$G(SDECRES) I SDECRES'="",'$D(^SDEC(409.831,+SDECRES,0)) S SDECRES=""
"RTN","SDEC57",100,0)
 S SDFIELDS=".01;2;1912;1914;1917;2505;2506"
"RTN","SDEC57",101,0)
 D GETS^DIQ(44,SDCL_",",SDFIELDS,"IE","SDDATA","SDMSG")
"RTN","SDEC57",102,0)
 Q:SDDATA(44,SDCL_",",2,"I")'="C"   ;only clinic
"RTN","SDEC57",103,0)
 I $$INACTIVE(SDCL,.SDBEG,.SDEND,SDDATA(44,SDCL_",",2505,"I"),SDDATA(44,SDCL_",",2506,"I")) Q   ;only active
"RTN","SDEC57",104,0)
 S SDLEN=SDDATA(44,SDCL_",",1912,"I")  ;length of app't is required in file 44
"RTN","SDEC57",105,0)
 S SDCLS=SDDATA(44,SDCL_",",1914,"I")   ;hour clinic display begins
"RTN","SDEC57",106,0)
 S:SDCLS="" SDCLS=8 ;apply default start time of 0800
"RTN","SDEC57",107,0)
 ;SDSI=DISPLAY INCREMENTS PER HOUR (1-60min,2-30min,3-20min,4-15min,6-10min)
"RTN","SDEC57",108,0)
 S SDSI=SDDATA(44,SDCL_",",1917,"I")
"RTN","SDEC57",109,0)
 D TDAY(SDAB,SDCL,SDCLS,SDLEN,SDSI,SDBEG,SDEND)
"RTN","SDEC57",110,0)
 Q
"RTN","SDEC57",111,0)
 ;
"RTN","SDEC57",112,0)
TDAY(SDAB,SDCL,SDCLS,SDLEN,SDSI,SDBEG,SDEND) ;add/update access blocks for day template SDT
"RTN","SDEC57",113,0)
 ;SDBEG  = (optional) Start date in fileman format; defaults to 'today'
"RTN","SDEC57",114,0)
 ;SDEND = (optional) Stop date in fileman format; defaults to 365 days
"RTN","SDEC57",115,0)
 N SDAY,SDAY1,SDBLKS,SDE,SDE1,SDJ,SDPAT,SDPAT1,SDSIM
"RTN","SDEC57",116,0)
 S SDCL=$G(SDCL)
"RTN","SDEC57",117,0)
 Q:SDCL=""
"RTN","SDEC57",118,0)
 S SDLEN=$G(SDLEN)
"RTN","SDEC57",119,0)
 ;LENGTH OF APP'T
"RTN","SDEC57",120,0)
 I SDLEN="" S SDLEN=$$GET1^DIQ(44,SDCL_",",1912)
"RTN","SDEC57",121,0)
 S SDCLS=$G(SDCLS)
"RTN","SDEC57",122,0)
 ;HOUR CLINIC DISPLAY BEGINS
"RTN","SDEC57",123,0)
 I SDCLS="" S SDCLS=$$GET1^DIQ(44,SDCL_",",1914)   ;SDCLS=8
"RTN","SDEC57",124,0)
 S SDSI=$G(SDSI)
"RTN","SDEC57",125,0)
 ;DISPLAY INCREMENTS PER HOUR
"RTN","SDEC57",126,0)
 I SDSI="" S SDSI=$$GET1^DIQ(44,SDCL_",",1917,"I")   ;SDDATA(44,SDCL_",",1917,"I")
"RTN","SDEC57",127,0)
 S SDBEG=$G(SDBEG)
"RTN","SDEC57",128,0)
 D TDAY1
"RTN","SDEC57",129,0)
 Q
"RTN","SDEC57",130,0)
TDAY1 ;
"RTN","SDEC57",131,0)
 N D,SDA,SDTP,SS,ST,Y
"RTN","SDEC57",132,0)
 ;SDA=begin position of pattern on template
"RTN","SDEC57",133,0)
 S SDA=$S(SDSI=3:6,SDSI=6:12,1:8)
"RTN","SDEC57",134,0)
 S SDTP=""
"RTN","SDEC57",135,0)
 ;if no CURRENT AVAILABILITY pattern, try to build it
"RTN","SDEC57",136,0)
 I '$D(^SC(SDCL,"ST",$P(SDBEG,".",1),1)) S ST='$$ST(SDCL,SDBEG) Q:ST
"RTN","SDEC57",137,0)
 S SDTP=$G(^SC(SDCL,"ST",$P(SDBEG,".",1),1)) S SDTP=$E(SDTP,SDA,$L(SDTP))
"RTN","SDEC57",138,0)
 Q:SDTP=""
"RTN","SDEC57",139,0)
 K SDBLKS
"RTN","SDEC57",140,0)
 D GETBLKS^SDEC57A(.SDBLKS,SDTP,$P(SDBEG,".",1),SDCLS,SDLEN,SDSI,SDCL)
"RTN","SDEC57",141,0)
 D RESNB^SDECUTL1(SDAB,.SDBLKS,SDCL,$P(SDBEG,".",1))
"RTN","SDEC57",142,0)
 K SDBLKS
"RTN","SDEC57",143,0)
 Q
"RTN","SDEC57",144,0)
 ;
"RTN","SDEC57",145,0)
ST(SDCL,SDBEG) ;build ST
"RTN","SDEC57",146,0)
 ;RETURN - 0=not buildable or built as holiday ;1=buildable
"RTN","SDEC57",147,0)
 N D,SC,SDDT,SS,Y
"RTN","SDEC57",148,0)
 S SDDT=$P(SDBEG,".",1)
"RTN","SDEC57",149,0)
 S SC=SDCL
"RTN","SDEC57",150,0)
 S D=$$DOW^XLFDT(SDDT,1)
"RTN","SDEC57",151,0)
 S Y=D#7
"RTN","SDEC57",152,0)
 I $D(^HOLIDAY(SDDT))&($$GET1^DIQ(44,SDCL_",",1918.5,"I")'="Y") D H Q 0
"RTN","SDEC57",153,0)
 S SS=$$FDT(SDCL,Y)
"RTN","SDEC57",154,0)
 Q:+SS="" 0
"RTN","SDEC57",155,0)
 S ^SC(+SDCL,"ST",SDDT,1)=$E($P($T(DAY),U,Y+2),1,2)_" "_$E(SDDT,6,7)_$S(SDSI=3:"",SDSI=6:"      ",1:"  ")_SS,^SC(+SDCL,"ST",SDDT,0)=SDDT
"RTN","SDEC57",156,0)
 Q 1
"RTN","SDEC57",157,0)
FDT(SDCL,Y)  ;find day template pattern
"RTN","SDEC57",158,0)
 N SDE,SDTP
"RTN","SDEC57",159,0)
 S SDTP=""
"RTN","SDEC57",160,0)
 S SDE=$O(^SC(SDCL,"T"_Y,99999999),-1)
"RTN","SDEC57",161,0)
 Q:'SDE ""
"RTN","SDEC57",162,0)
 S SDTP=$G(^SC(SDCL,"T"_Y,SDE,1))
"RTN","SDEC57",163,0)
 Q:SDTP="" ""
"RTN","SDEC57",164,0)
 F  S SDE=$O(^SC(SDCL,"T"_Y,SDE),-1) Q:SDE'>0  Q:$P(SDBEG,".",1)'<SDE  S SDTP=$G(^SC(SDCL,"T"_Y,SDE,1))
"RTN","SDEC57",165,0)
 Q SDTP
"RTN","SDEC57",166,0)
H ;update ST as holiday
"RTN","SDEC57",167,0)
 S ^SC(+SC,"ST",X,1)="   "_$E(X,6,7)_"    "_$P(^HOLIDAY(X,0),U,2),^SC(+SC,"ST",X,0)=X
"RTN","SDEC57",168,0)
 Q
"RTN","SDEC57",169,0)
 ;
"RTN","SDEC57",170,0)
DAY ;;^SUN^MON^TUES^WEDNES^THURS^FRI^SATUR
"RTN","SDEC57",171,0)
 ;
"RTN","SDEC57",172,0)
INACTIVE(SDCL,SDBEG,SDEND,IDATE,RDATE)  ;
"RTN","SDEC57",173,0)
 ;INPUT:
"RTN","SDEC57",174,0)
 ;  SDCL  - clinic ID
"RTN","SDEC57",175,0)
 ; .SDBEG - begin date in FM format, no time
"RTN","SDEC57",176,0)
 ; .SDEND - end date in FM format, no time
"RTN","SDEC57",177,0)
 ;  IDATE - clinic's inactivation date
"RTN","SDEC57",178,0)
 ;  RDATE - clinic's reactivation date
"RTN","SDEC57",179,0)
 ;RETURN:
"RTN","SDEC57",180,0)
 ; 0=Clinic is active
"RTN","SDEC57",181,0)
 ; 1=Clinic is inactive
"RTN","SDEC57",182,0)
 ; active  0 0
"RTN","SDEC57",183,0)
 I IDATE="" Q 0
"RTN","SDEC57",184,0)
 ;  active but inactivated in future
"RTN","SDEC57",185,0)
 I IDATE>SDBEG S SDEND=IDATE Q 0
"RTN","SDEC57",186,0)
 ; inactive 1 0
"RTN","SDEC57",187,0)
 I IDATE'>SDBEG,RDATE="" Q 1   ;alb/sat 665
"RTN","SDEC57",188,0)
 ; inactive 1 1 inactive but reactivated
"RTN","SDEC57",189,0)
 ;  inactive now reactive now
"RTN","SDEC57",190,0)
 I IDATE'>SDBEG,RDATE'>SDBEG Q 0  ;alb/sat 665
"RTN","SDEC57",191,0)
 ;  inactive now reactive future
"RTN","SDEC57",192,0)
 I IDATE'>SDBEG,RDATE>IDATE S SDBEG=RDATE Q 0  ;alb/sat 665
"RTN","SDEC57",193,0)
 Q 1
"RTN","SDEC57",194,0)
 ;
"RTN","SDEC57",195,0)
OBM(RET,SDCL,SDT,MRTC,USR,SDW)  ;GET overbook status and message
"RTN","SDEC57",196,0)
 N %DT,OBM,SDTMP,X,Y
"RTN","SDEC57",197,0)
 S RET=$NA(^TMP("SDEC57",$J,"OBM"))
"RTN","SDEC57",198,0)
 K @RET
"RTN","SDEC57",199,0)
 S @RET@(0)="T00030CONTINUE^T00200MESSAGE^T00200PROMPT^T00030DEFAULT"_$C(30)
"RTN","SDEC57",200,0)
 ;validate SDCL
"RTN","SDEC57",201,0)
 S SDCL=$G(SDCL)
"RTN","SDEC57",202,0)
 I SDCL="" S @RET@(1)="-1^Clinic ID is required."_$C(30,31) Q
"RTN","SDEC57",203,0)
 I '$D(^SC(SDCL,0)) S @RET@(1)="-1^Invalid Clinic ID."_$C(30,31) Q
"RTN","SDEC57",204,0)
 ;validate SDT
"RTN","SDEC57",205,0)
 S SDT=$G(SDT)
"RTN","SDEC57",206,0)
 S %DT="T",X=SDT D ^%DT I Y=-1 S @RET@(1)="-1^Invalid appointment date/time."_$C(30,31) Q
"RTN","SDEC57",207,0)
 S SDT=Y
"RTN","SDEC57",208,0)
 ;validate MRTC
"RTN","SDEC57",209,0)
 S MRTC=$G(MRTC)
"RTN","SDEC57",210,0)
 I MRTC'="","01"'[MRTC S @RET@(1)="-1^Invalid MRTC flag."_$C(30,31) Q
"RTN","SDEC57",211,0)
 ;validate USR
"RTN","SDEC57",212,0)
 S USR=$G(USR)
"RTN","SDEC57",213,0)
 I USR="" S USR=DUZ
"RTN","SDEC57",214,0)
 I '$D(^VA(200,USR,0)) S @RET@(1)="-1^Invalid user ID."_$C(30,31) Q
"RTN","SDEC57",215,0)
 ;validate SDW
"RTN","SDEC57",216,0)
 S SDW=$G(SDW)
"RTN","SDEC57",217,0)
 S OBM=$$OBM1(SDCL,SDT,MRTC,USR,SDW)
"RTN","SDEC57",218,0)
 I OBM="" S @RET@(1)=1
"RTN","SDEC57",219,0)
 E  D
"RTN","SDEC57",220,0)
 .S SDTMP=""
"RTN","SDEC57",221,0)
 .F I=1:1:$L(OBM,"|") S $P(SDTMP,U,I)=$P(OBM,"|",I)
"RTN","SDEC57",222,0)
 .S @RET@(1)=SDTMP
"RTN","SDEC57",223,0)
 S @RET@(1)=@RET@(1)_$C(30,31)
"RTN","SDEC57",224,0)
 Q
"RTN","SDEC57",225,0)
OBM1(SDCL,SDT,MRTC,USR,SDW)  ;return message and possible prompt for overbook   ;alb/sat 658
"RTN","SDEC57",226,0)
 ; RETURN - <continue> | <message> | <prompt> | <default>
"RTN","SDEC57",227,0)
 ;  <continue> - 0=do not continue
"RTN","SDEC57",228,0)
 ;               1=continue
"RTN","SDEC57",229,0)
 ;               2=continue based on prompt response
"RTN","SDEC57",230,0)
 N %,CAN,D,DATE,HSI,I,OBM,MOB,MOBR,S,SB,SI,SL,SM,SM7,SDA,SDDIF,ST,STARTDAY,STR,X
"RTN","SDEC57",231,0)
 ;
"RTN","SDEC57",232,0)
 S OBM=""
"RTN","SDEC57",233,0)
 S (CAN,SM,SM7)=0
"RTN","SDEC57",234,0)
 ;validate SDCL
"RTN","SDEC57",235,0)
 S SDCL=$G(SDCL)
"RTN","SDEC57",236,0)
 Q:SDCL="" ""
"RTN","SDEC57",237,0)
 Q:'$D(^SC(SDCL,0)) ""
"RTN","SDEC57",238,0)
 ;validate MRTC
"RTN","SDEC57",239,0)
 S MRTC=$G(MRTC)
"RTN","SDEC57",240,0)
 ;validate USR
"RTN","SDEC57",241,0)
 S USR=$G(USR)
"RTN","SDEC57",242,0)
 I USR="" S USR=DUZ
"RTN","SDEC57",243,0)
 Q:'$D(^VA(200,USR,0)) ""
"RTN","SDEC57",244,0)
 ;validate SDT
"RTN","SDEC57",245,0)
 S SDT=$G(SDT)
"RTN","SDEC57",246,0)
 S %DT="T",X=SDT D ^%DT I Y=-1 Q ""
"RTN","SDEC57",247,0)
 S SDT=Y
"RTN","SDEC57",248,0)
 S DATE=$$FMTE^XLFDT($P(SDT,".",1))
"RTN","SDEC57",249,0)
 ;validate SDW  walk-in flag
"RTN","SDEC57",250,0)
 S SDW=$G(SDW)
"RTN","SDEC57",251,0)
 ;
"RTN","SDEC57",252,0)
 ;SM=6=OVERBOOK  SM=7=NOT IN SCHEDULE PERIOD
"RTN","SDEC57",253,0)
 S SL=$G(^SC(+SDCL,"SL")),X=$P(SL,U,3),STARTDAY=$S($L(X):X,1:8),SB=STARTDAY-1/100,X=$P(SL,U,6),HSI=$S(X=1:X,X:X,1:4),SI=$S(X="":4,X<3:4,X:X,1:4)
"RTN","SDEC57",254,0)
 S STR="#@!$* XXWVUTSRQPONMLKJIHGFEDCBA0123456789jklmnopqrstuvwxyz",SDDIF=$S(HSI<3:8/HSI,1:2)
"RTN","SDEC57",255,0)
 S S=$G(^SC(SDCL,"ST",$P(SDT,".",1),1))
"RTN","SDEC57",256,0)
 S I=SDT#1-SB*100,ST=I#1*SI\.6+($P(I,".")*SI),SS=SL*HSI/60*SDDIF+ST+ST
"RTN","SDEC57",257,0)
 ;check if not during schedule period (SM=7)
"RTN","SDEC57",258,0)
 S %=$F(S,"[",SS-1) S:'%!($P(SL,"^",6)<3) %=999 I $F(S,"]",SS)'<%!(SDDIF=2&$E(S,ST+ST+1,SS-1)["[") S SM=7
"RTN","SDEC57",259,0)
 ;check if OB  (SM=6)
"RTN","SDEC57",260,0)
 S SDA=$S($P(SL,U,6)=3:6,$P(SL,U,6)=6:12,1:8)
"RTN","SDEC57",261,0)
 F I=ST+ST:SDDIF:SS-SDDIF S ST=$E(S,I+1) S:ST="" ST=" " S Y=$E(STR,$F(STR,ST)-2),SM7=$S(I<SDA:1,Y="*":1,1:SM7) S CAN=$$CAN(S,ST,SDCL,SDT) Q:CAN  Q:Y=""  S:Y'?1NL&(SM<6) SM=6 S ST=$E(S,I+2,999) D  S:ST="" ST=" " S S=$E(S,1,I)_Y_ST
"RTN","SDEC57",262,0)
 .Q:ST'=""
"RTN","SDEC57",263,0)
 .Q:+SL'>+^SC(SDCL,"SL")
"RTN","SDEC57",264,0)
 .S ST="   "
"RTN","SDEC57",265,0)
 .Q
"RTN","SDEC57",266,0)
 I CAN S OBM="0|CAN'T BOOK WITHIN A CANCELLED TIME PERIOD!" G OBX
"RTN","SDEC57",267,0)
 I +SDW,+SM7 S OBM="1" G OBX
"RTN","SDEC57",268,0)
 S (MOBR,MOB)=$P($G(^SC(SDCL,"SL")),U,7)   ;MOB=MAX OB ALLOWED  MOBR=MAX OB REMAINING
"RTN","SDEC57",269,0)
 ; alb/jsm 658 updated to used the $P(SDT,".",1)-.01
"RTN","SDEC57",270,0)
 I MOBR F D=$P(SDT,".",1)-.01:0 S D=$O(^SC(SDCL,"S",D)) Q:$P(D,".",1)-$P(SDT,".",1)  F %=0:0 S %=$O(^SC(SDCL,"S",D,1,%)) Q:'%  I $P(^(%,0),"^",9)'["C",$D(^("OB")) S MOBR=MOBR-1
"RTN","SDEC57",271,0)
 ;*zeb 686 12/13/18 removed assumption that MRTCs are overbooks
"RTN","SDEC57",272,0)
 ; MAX OB DEFINED
"RTN","SDEC57",273,0)
 I MOB'="",SM#9'=0,MOBR<1,'$D(^XUSEC("SDMOB",DUZ)) S OBM="0|ONLY "_MOB_" OVERBOOK"_$E("S",MOB>1)_" ALLOWED PER DAY!!" G OBX
"RTN","SDEC57",274,0)
 I MOB'="",SM#9'=0,MOBR<1,$D(^XUSEC("SDMOB",DUZ)) S OBM="2||WILL EXCEED MAXIMUM ALLOWABLE OVERBOOKS, OK?|YES" G OBX
"RTN","SDEC57",275,0)
 I MOB'="",SM#9'=0,MOBR>0,'$D(^XUSEC("SDOB",DUZ)) S OBM="0|NO OPEN SLOTS THEN" G OBX
"RTN","SDEC57",276,0)
 I MOB'="",SM=7,$D(^XUSEC("SDOB",DUZ)) S OBM="2||THAT TIME IS NOT WITHIN SCHEDULED PERIOD!...OK?|NO" G OBX
"RTN","SDEC57",277,0)
 I MOB'="",SM=6,$D(^XUSEC("SDOB",DUZ)) S OBM="2||OVERBOOK!...OK?|NO" G OBX
"RTN","SDEC57",278,0)
 ; MAX OB NOT DEFINED
"RTN","SDEC57",279,0)
 I MOB="",SM#9'=0,'$D(^XUSEC("SDOB",DUZ)) S OBM="0|NO OPEN SLOTS THEN" G OBX
"RTN","SDEC57",280,0)
 I MOB="",SM=7,$D(^XUSEC("SDOB",DUZ)) S OBM="2||THAT TIME IS NOT WITHIN SCHEDULED PERIOD!...OK?|NO" G OBX
"RTN","SDEC57",281,0)
 I MOB="",SM=6,$D(^XUSEC("SDOB",DUZ)) S OBM="2||OVERBOOK!...OK?|NO" G OBX
"RTN","SDEC57",282,0)
OBX Q OBM
"RTN","SDEC57",283,0)
CAN(S,ST,SDCL,SDT) ;
"RTN","SDEC57",284,0)
 Q S["CAN"!(ST="X"&($D(^SC(+SDCL,"ST",$P(SDT,"."),"CAN"))))
"RTN","SDECAR1")
0^7^B167351251^B154809357
"RTN","SDECAR1",1,0)
SDECAR1 ;ALB/SAT - VISTA SCHEDULING RPCS ;MAR 15, 2017
"RTN","SDECAR1",2,0)
 ;;5.3;Scheduling;**627,642,658,686**;Aug 13, 1993;Build 53
"RTN","SDECAR1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified
"RTN","SDECAR1",4,0)
 ;
"RTN","SDECAR1",5,0)
 Q
"RTN","SDECAR1",6,0)
 ;
"RTN","SDECAR1",7,0)
 ; Get SDEC APPOINTMENT REQUEST for all entries in the user's Institution
"RTN","SDECAR1",8,0)
 ; where the Current Status is not C(losed).
"RTN","SDECAR1",9,0)
ARGET(RET,ARIEN1,MAXREC,SDBEG,SDEND,DFN,LASTSUB,SDTOP,SVCL,DESDT,PRL,SVCR,SCVISIT,CLINIC,ORIGDT) ;Appt Req GET  ;alb/sat 658 add SVCL-SCVISIT
"RTN","SDECAR1",10,0)
ARGET1 ;
"RTN","SDECAR1",11,0)
 ;29  SVCCONN  - SERVICE CONNECTED? field .301 of the PATIENT file
"RTN","SDECAR1",12,0)
 ;37  ARSVCCON - SERVICE CONNECTED PRIORITY field 15 of the SDEC APPT REQUEST file
"RTN","SDECAR1",13,0)
 ;
"RTN","SDECAR1",14,0)
 N CLOSED,FNUM,NAME,DOB,SSN4,GENDER,ARORIGDT,ARINST,ARINSTNM,ARTYPE,ARTEAM,ARPOS
"RTN","SDECAR1",15,0)
 N ELIGIEN,ELIGNAME,FRULES,GLOREF,HRN,INSTIEN,INSTNAME,PRIGRP,SVCCONN,SVCCONNP,TYPEIEN,TYPENAME
"RTN","SDECAR1",16,0)
 N PCOUNTRY,SDSUB,SDTMP,SSN,ARSSIEN,ARSSNAME,ARCLIEN,ARCLNAME
"RTN","SDECAR1",17,0)
 N ARUSER,ARPRIO,ARREQBY,ARPROV,ARPROVNM,ARDAPTDT,ARCOMM,AREESTAT,ARUSRNM
"RTN","SDECAR1",18,0)
 N ARCLIENL,AREDT,ARIEN,PTINFOLSTA,ARDISPD,ARDISPU,ARDISPUN,ARSVCCON
"RTN","SDECAR1",19,0)
 N ARMAI,ARMAN,ARMAR,ARSTAT,ARSTOP,ARSTOPN,COUNT,DES,SDK,STR,SDRTMP
"RTN","SDECAR1",20,0)
 N PCITY,GAF,PSTATE,PZIP4,PADDRES1,PADDRES2,PADDRES3,PPC,PTPHONE,ARENPRI,ARASD,ARPC,ARDATA
"RTN","SDECAR1",21,0)
 N SDCL,SDI,SDJ,SDMTRC,SDPARENT,SDPS,SDSENS,SDDEMO,X,Y,%DT,APPTPTRS
"RTN","SDECAR1",22,0)
 N VAOSGUID ; wtc patch 686 3/23/18 added for VAOS requests
"RTN","SDECAR1",23,0)
 S RET="^TMP(""SDEC"","_$J_")"
"RTN","SDECAR1",24,0)
 K @RET
"RTN","SDECAR1",25,0)
 S FNUM=$$FNUM^SDECAR,COUNT=0
"RTN","SDECAR1",26,0)
 S MAXREC=+$G(MAXREC,50)
"RTN","SDECAR1",27,0)
 D HDR
"RTN","SDECAR1",28,0)
 S GLOREF=$NA(^SDEC(409.85,"C",DUZ(2)))
"RTN","SDECAR1",29,0)
 S FRULES=1
"RTN","SDECAR1",30,0)
 S ARIEN=0
"RTN","SDECAR1",31,0)
 ;F  S WLIEN=$O(@GLOREF@(WLIEN)) Q:'WLIEN  D ONEPAT I MAXREC,COUNT'<MAXREC Q
"RTN","SDECAR1",32,0)
 S SDBEG=$G(SDBEG)
"RTN","SDECAR1",33,0)
 I SDBEG'="" S %DT="" S X=$P(SDBEG,"@",1) D ^%DT S SDBEG=Y I Y=-1 S SDBEG=3100101
"RTN","SDECAR1",34,0)
 I SDBEG="" S SDBEG=3100101
"RTN","SDECAR1",35,0)
 S SDEND=$G(SDEND)
"RTN","SDECAR1",36,0)
 I SDEND'="" S %DT="" S X=$P(SDEND,"@",1) D ^%DT S SDEND=Y I Y=-1 S SDEND=$$FMADD^XLFDT($E($$NOW^XLFDT,1,12),-90)
"RTN","SDECAR1",37,0)
 I SDEND="" S SDEND=$$FMADD^XLFDT($E($$NOW^XLFDT,1,12),-90)
"RTN","SDECAR1",38,0)
 S DFN=$G(DFN)
"RTN","SDECAR1",39,0)
 I DFN'="",'$D(^DPT(DFN,0)) S DFN=""
"RTN","SDECAR1",40,0)
 S LASTSUB=$S(DFN="":$G(LASTSUB),1:"")
"RTN","SDECAR1",41,0)
 S SDTOP=+$G(SDTOP)
"RTN","SDECAR1",42,0)
 ;validate SVCL
"RTN","SDECAR1",43,0)
 S SVCL=$G(SVCL)
"RTN","SDECAR1",44,0)
 I SVCL'="" D
"RTN","SDECAR1",45,0)
 .F SDI=$L(SVCL,"|"):-1:1 S SVC=$P(SVCL,"|",SDI) D
"RTN","SDECAR1",46,0)
 ..I (SVC="")!('$D(^DIC(40.7,+SVC,0))) S SVCL=$$PD^SDECUTL(SVCL,SDI,"|")
"RTN","SDECAR1",47,0)
 ;validate DESDT
"RTN","SDECAR1",48,0)
 S DESDT=$G(DESDT)
"RTN","SDECAR1",49,0)
 ;validate PRL
"RTN","SDECAR1",50,0)
 S PRL=$G(PRL)
"RTN","SDECAR1",51,0)
 I PRL'="" D
"RTN","SDECAR1",52,0)
 .N PR
"RTN","SDECAR1",53,0)
 .F SDI=$L(PRL,"|"):-1:1 S PR=$P(PRL,"|",SDI) D
"RTN","SDECAR1",54,0)
 ..I "012345678"'[PR S PR=$E(PR,7)
"RTN","SDECAR1",55,0)
 ..I "012345678"'[PR S PRL=$$PD^SDECUTL(PRL,SDI,"|")
"RTN","SDECAR1",56,0)
 ;validate SVCR
"RTN","SDECAR1",57,0)
 S SVCR=$G(SVCR) S:SVCR'="" SVCR=$$UP^XLFSTR(SVCR)
"RTN","SDECAR1",58,0)
 I SVCR'="" S SVCR=$S(SVCR="Y":1,SVCR="N":0,SVCR="YES":1,SVCR="NO":0,1:"")
"RTN","SDECAR1",59,0)
 ;validate SCVISIT
"RTN","SDECAR1",60,0)
 S SCVISIT=$G(SCVISIT) S:SCVISIT'="" SCVISIT=$$UP^XLFSTR(SCVISIT)
"RTN","SDECAR1",61,0)
 I SCVISIT'="" S SCVISIT=$S(SCVISIT="Y":"Y",SCVISIT="N":"N",SCVISIT="YES":"Y",SCVISIT="NO":"N",1:"")
"RTN","SDECAR1",62,0)
 ;validate CLINIC
"RTN","SDECAR1",63,0)
 S CLINIC=$G(CLINIC)
"RTN","SDECAR1",64,0)
 ;validate ORIGDT
"RTN","SDECAR1",65,0)
 S ORIGDT=$G(ORIGDT)
"RTN","SDECAR1",66,0)
 ;single IEN
"RTN","SDECAR1",67,0)
 S ARIEN1=$G(ARIEN1)
"RTN","SDECAR1",68,0)
 I +ARIEN1 I '$D(^SDEC(409.85,+ARIEN1,0))  S ARIEN1=""
"RTN","SDECAR1",69,0)
 I +ARIEN1 D
"RTN","SDECAR1",70,0)
 .S ARIEN=+ARIEN1
"RTN","SDECAR1",71,0)
 .S FRULES=0  ;no rules - just return the single record
"RTN","SDECAR1",72,0)
 .D ONEPAT
"RTN","SDECAR1",73,0)
 I +ARIEN1 S @RET@(COUNT)=@RET@(COUNT)_$C(31) Q
"RTN","SDECAR1",74,0)
 ;by patient
"RTN","SDECAR1",75,0)
 I +DFN D
"RTN","SDECAR1",76,0)
 .I 'SDTOP S ARIEN=0 F  S ARIEN=$O(^SDEC(409.85,"B",+DFN,ARIEN)) Q:ARIEN'>0  D ONEPAT  ;I MAXREC,COUNT'<MAXREC Q
"RTN","SDECAR1",77,0)
 .I +SDTOP S ARIEN=999999999 F  S ARIEN=$O(^SDEC(409.85,"B",+DFN,ARIEN),-1) Q:ARIEN'>0  D ONEPAT
"RTN","SDECAR1",78,0)
 ;clinic
"RTN","SDECAR1",79,0)
 I CLINIC'="" D  G ARX
"RTN","SDECAR1",80,0)
 .S SDI=$S($P(LASTSUB,"|",1)'="":$P(LASTSUB,"|",1),1:1)
"RTN","SDECAR1",81,0)
 .F SDI=SDI:1:$L(CLINIC,"|") S SDCL=$P(CLINIC,"|",SDI) D  I MAXREC,COUNT'<MAXREC Q
"RTN","SDECAR1",82,0)
 ..Q:SDCL=""
"RTN","SDECAR1",83,0)
 ..I DESDT'="" D  Q  ;GCC  DESDT desired dates by pipe
"RTN","SDECAR1",84,0)
 ...S SDT=$S($P(LASTSUB,"|",2)'="":$P(LASTSUB,"|",2)-1,1:1)
"RTN","SDECAR1",85,0)
 ...F SDT=SDT:1:$L(DESDT,"|") S DES=$P(DESDT,"|",SDT) D  I MAXREC,COUNT'<MAXREC Q
"RTN","SDECAR1",86,0)
 ....Q:DES=""
"RTN","SDECAR1",87,0)
 ....S ARIEN=$S($P(LASTSUB,"|",3)'="":$P(LASTSUB,"|",3),1:0)
"RTN","SDECAR1",88,0)
 ....F  S ARIEN=$O(^SDEC(409.85,"GCC",SDCL,DES,ARIEN)) Q:ARIEN=""  D  I MAXREC,COUNT'<MAXREC S SDSUB=SDCL_"|"_SDT_"|"_ARIEN Q
"RTN","SDECAR1",89,0)
 .....D ONEPAT
"RTN","SDECAR1",90,0)
 ..;
"RTN","SDECAR1",91,0)
 ..S SDT=$S($P(LASTSUB,"|",2)'="":$P(LASTSUB,"|",2)-1,ORIGDT'="":ORIGDT-1,1:SDBEG-1)  ;GC
"RTN","SDECAR1",92,0)
 ..F  S SDT=$O(^SDEC(409.85,"GC",SDCL,SDT)) Q:SDT=""  Q:((ORIGDT'="")&(SDT>ORIGDT))  Q:(ORIGDT="")&(SDT>SDEND)  D  I MAXREC,COUNT'<MAXREC Q
"RTN","SDECAR1",93,0)
 ...S ARIEN=$S($P(LASTSUB,"|",3)'="":$P(LASTSUB,"|",3),1:0)
"RTN","SDECAR1",94,0)
 ...F  S ARIEN=$O(^SDEC(409.85,"GC",SDCL,SDT,ARIEN)) Q:ARIEN=""  D  I MAXREC,COUNT'<MAXREC S SDSUB=SDI_"|"_SDT_"|"_ARIEN Q
"RTN","SDECAR1",95,0)
 ....D ONEPAT
"RTN","SDECAR1",96,0)
 ;by service
"RTN","SDECAR1",97,0)
 I SVCL'="" D  G ARX
"RTN","SDECAR1",98,0)
 .N PR1,SDT,SVC
"RTN","SDECAR1",99,0)
 .S SDI=$S($P(LASTSUB,"|",1)'="":$P(LASTSUB,"|",1),1:1)
"RTN","SDECAR1",100,0)
 .F SDI=SDI:1:$L(SVCL,"|") S SVC=$P(SVCL,"|",SDI) D  I MAXREC,COUNT'<MAXREC Q
"RTN","SDECAR1",101,0)
 ..Q:SVC=""
"RTN","SDECAR1",102,0)
 ..;I DESDTR'="" D  ;desired date range range <begin> ~ <end> not implemented
"RTN","SDECAR1",103,0)
 ..I DESDT'="" D  Q  ;GSC  DESDT desired dates by pipe
"RTN","SDECAR1",104,0)
 ...S SDT=$S($P(LASTSUB,"|",2)'="":$P(LASTSUB,"|",2)-1,1:1)
"RTN","SDECAR1",105,0)
 ...F SDT=SDT:1:$L(DESDT,"|") S DES=$P(DESDT,"|",SDT) D  I MAXREC,COUNT'<MAXREC Q
"RTN","SDECAR1",106,0)
 ....Q:DES=""
"RTN","SDECAR1",107,0)
 ....S ARIEN=$S($P(LASTSUB,"|",3)'="":$P(LASTSUB,"|",3),1:0)
"RTN","SDECAR1",108,0)
 ....F  S ARIEN=$O(^SDEC(409.85,"GSC",SVC,DES,ARIEN)) Q:ARIEN=""  D  I MAXREC,COUNT'<MAXREC S SDSUB=SVC_"|"_SDT_"|"_ARIEN Q
"RTN","SDECAR1",109,0)
 .....D ONEPAT
"RTN","SDECAR1",110,0)
 ..I PRL'="" D  Q   ;GSP
"RTN","SDECAR1",111,0)
 ...S SDK=$S($P(LASTSUB,"|",2)'="":$P(LASTSUB,"|",2)-1,1:1)
"RTN","SDECAR1",112,0)
 ...F SDK=SDK:1:$L(PRL,"|") S PR1=$P(PRL,"|",SDK) D  I MAXREC,COUNT'<MAXREC Q
"RTN","SDECAR1",113,0)
 ....S SDT=$S($P(LASTSUB,"|",3)'="":$P(LASTSUB,"|",3)-1,1:SDBEG-1)
"RTN","SDECAR1",114,0)
 ....F  S SDT=$O(^SDEC(409.85,"GSP",SVC,PR1,SDT)) Q:SDT=""  Q:SDT>SDEND  D  I MAXREC,COUNT'<MAXREC Q
"RTN","SDECAR1",115,0)
 .....S ARIEN=$S($P(LASTSUB,"|",4)'="":$P(LASTSUB,"|",4),1:0)
"RTN","SDECAR1",116,0)
 .....F  S ARIEN=$O(^SDEC(409.85,"GSP",SVC,PR1,SDT,ARIEN)) Q:ARIEN=""  D ONEPAT  I MAXREC,COUNT'<MAXREC S SDSUB=SVC_"|"_SDK_"|"_SDT_"|"_ARIEN Q
"RTN","SDECAR1",117,0)
 ..I SVCR'="" D  Q  ;GSB - WL service connected
"RTN","SDECAR1",118,0)
 ...S SDT=$S($P(LASTSUB,"|",2)'="":$P(LASTSUB,"|",2)-1,1:SDBEG-1)
"RTN","SDECAR1",119,0)
 ...F  S SDT=$O(^SDEC(409.85,"GSB",SVC,$E(SVCR),SDT)) Q:SDT=""  Q:SDT>SDEND  D  I MAXREC,COUNT'<MAXREC Q
"RTN","SDECAR1",120,0)
 ....S ARIEN=$S($P(LASTSUB,"|",3)'="":$P(LASTSUB,"|",3),1:0)
"RTN","SDECAR1",121,0)
 ....F  S ARIEN=$O(^SDEC(409.85,"GSB",SVC,$E(SVCR),SDT,ARIEN)) Q:ARIEN=""  D ONEPAT  I MAXREC,COUNT'<MAXREC S SDSUB=SVC_"|"_SDT_"|"_ARIEN Q
"RTN","SDECAR1",122,0)
 ..I SCVISIT'="" D  Q  ;GSA - Patient Service Connected
"RTN","SDECAR1",123,0)
 ...S SDT=$S($P(LASTSUB,"|",2)'="":$P(LASTSUB,"|",2)-1,1:SDBEG-1)
"RTN","SDECAR1",124,0)
 ...F  S SDT=$O(^SDEC(409.85,"GSA",SVC,$E(SCVISIT),SDT)) Q:SDT=""  Q:SDT>SDEND  D  I MAXREC,COUNT'<MAXREC Q
"RTN","SDECAR1",125,0)
 ....S ARIEN=$S($P(LASTSUB,"|",3)'="":$P(LASTSUB,"|",3),1:0)
"RTN","SDECAR1",126,0)
 ....F  S ARIEN=$O(^SDEC(409.85,"GSA",SVC,$E(SCVISIT),SDT,ARIEN)) Q:ARIEN=""  D ONEPAT  I MAXREC,COUNT'<MAXREC S SDSUB=SVC_"|"_SDT_"|"_ARIEN Q
"RTN","SDECAR1",127,0)
 ..S SDT=$S($P(LASTSUB,"|",2)'="":$P(LASTSUB,"|",2)-1,1:SDBEG-1)  ;GS
"RTN","SDECAR1",128,0)
 ..F  S SDT=$O(^SDEC(409.85,"GS",SVC,SDT)) Q:SDT=""  Q:SDT>SDEND  D  I MAXREC,COUNT'<MAXREC Q
"RTN","SDECAR1",129,0)
 ...S ARIEN=$S($P(LASTSUB,"|",3)'="":$P(LASTSUB,"|",3),1:0)
"RTN","SDECAR1",130,0)
 ...F  S ARIEN=$O(^SDEC(409.85,"GS",SVC,SDT,ARIEN)) Q:ARIEN=""  D  I MAXREC,COUNT'<MAXREC S SDSUB=SDI_"|"_SDT_"|"_ARIEN Q
"RTN","SDECAR1",131,0)
 ....D ONEPAT
"RTN","SDECAR1",132,0)
 ;
"RTN","SDECAR1",133,0)
 ;all by date range
"RTN","SDECAR1",134,0)
 I 'DFN D
"RTN","SDECAR1",135,0)
 .I 'SDTOP D
"RTN","SDECAR1",136,0)
 ..S SDJ=$S($P(LASTSUB,"|",1)'="":$P(LASTSUB,"|",1)-1,1:SDBEG-1)
"RTN","SDECAR1",137,0)
 ..F  S SDJ=$O(^SDEC(409.85,"E","O",SDJ)) Q:SDJ'>0  Q:SDJ>SDEND  D  I MAXREC,COUNT'<MAXREC Q
"RTN","SDECAR1",138,0)
 ...S ARIEN=$S($P(LASTSUB,"|",2)'="":$P(LASTSUB,"|",2),1:0)
"RTN","SDECAR1",139,0)
 ...F  S ARIEN=$O(^SDEC(409.85,"E","O",SDJ,ARIEN)) Q:ARIEN'>0  D  I MAXREC,COUNT'<MAXREC S SDSUB=SDJ_"|"_ARIEN Q
"RTN","SDECAR1",140,0)
 ....S SDSUB=""
"RTN","SDECAR1",141,0)
 ....D ONEPAT
"RTN","SDECAR1",142,0)
 .I +SDTOP D
"RTN","SDECAR1",143,0)
 ..S SDJ=$S($P(LASTSUB,"|",1)'="":$P(LASTSUB,"|",1)+1,1:SDEND+1)
"RTN","SDECAR1",144,0)
 ..F  S SDJ=$O(^SDEC(409.85,"E","O",SDJ),-1) Q:SDJ'>0  Q:SDJ<SDBEG  D  I MAXREC,COUNT'<MAXREC Q
"RTN","SDECAR1",145,0)
 ...S ARIEN=$S($P(LASTSUB,"|",2)'="":$P(LASTSUB,"|",2),1:999999999)
"RTN","SDECAR1",146,0)
 ...F  S ARIEN=$O(^SDEC(409.85,"E","O",SDJ,ARIEN),-1) Q:ARIEN'>0  D  I MAXREC,COUNT'<MAXREC S SDSUB=SDJ_"|"_ARIEN Q
"RTN","SDECAR1",147,0)
 ....S SDSUB=""
"RTN","SDECAR1",148,0)
 ....D ONEPAT
"RTN","SDECAR1",149,0)
ARX S SDTMP=@RET@(COUNT) S SDTMP=$P(SDTMP,$C(30),1)
"RTN","SDECAR1",150,0)
 S:$G(SDSUB)'="" $P(SDTMP,U,56)=SDSUB
"RTN","SDECAR1",151,0)
 S @RET@(COUNT)=SDTMP_$C(30,31)
"RTN","SDECAR1",152,0)
 Q
"RTN","SDECAR1",153,0)
HDR ;Send back the header
"RTN","SDECAR1",154,0)
 ;                     1         2
"RTN","SDECAR1",155,0)
 S SDRTMP="T00030DFN^T00030NAME"
"RTN","SDECAR1",156,0)
 ;                       3         4         5         6            7         8
"RTN","SDECAR1",157,0)
 S SDRTMP=SDRTMP_"^T00030HRN^T00030DOB^T00030SSN^T00030GENDER^I00010IEN^D00030ORIGDT"
"RTN","SDECAR1",158,0)
 ;                       9             10             11          12            13
"RTN","SDECAR1",159,0)
 S SDRTMP=SDRTMP_"^T00030INSTIEN^T00030INSTNAME^T00030TYPE^T00030CLINIEN^T00030CLINNAME"
"RTN","SDECAR1",160,0)
 ;                       14            15             16         17          18            19
"RTN","SDECAR1",161,0)
 S SDRTMP=SDRTMP_"^T00030USERIEN^T00030USERNAME^T00030PRIO^T00030REQBY^T00030PROVIEN^T00030PROVNAME"
"RTN","SDECAR1",162,0)
 ;                       20           21         22
"RTN","SDECAR1",163,0)
 S SDRTMP=SDRTMP_"^T00030DAPTDT^T00250COMM^T00030ENROLLMENT_PRIORITY"
"RTN","SDECAR1",164,0)
 ;                       23                             24                           25
"RTN","SDECAR1",165,0)
 S SDRTMP=SDRTMP_"^T00010MULTIPLE APPOINTMENT RTC^T00010MULT APPT RTC INTERVAL^T00010MULT APPT NUMBER"
"RTN","SDECAR1",166,0)
 ;                       26           27            28             29            30
"RTN","SDECAR1",167,0)
 S SDRTMP=SDRTMP_"^T00030PRIGRP^T00030ELIGIEN^T00030ELIGNAME^T00030SVCCONN^T00030SVCCONNP"
"RTN","SDECAR1",168,0)
 ;                       31            32             33             34            35            36
"RTN","SDECAR1",169,0)
 S SDRTMP=SDRTMP_"^T00030TYPEIEN^T00030TYPENAME^T00100PCONTACT^T00030ARDISPD^T00030ARDISPU^T00030ARDISPUN"
"RTN","SDECAR1",170,0)
 ;                       37             38             39             40             41
"RTN","SDECAR1",171,0)
 S SDRTMP=SDRTMP_"^T00030WLSVCCON^T00030PADDRES1^T00030PADDRES2^T00030PADDRES3^T00030PCITY"
"RTN","SDECAR1",172,0)
 ;                       42           43             44          45        46         47
"RTN","SDECAR1",173,0)
 S SDRTMP=SDRTMP_"^T00030PSTATE^T00030PCOUNTRY^T00030PZIP4^T00050GAF^T00030DATE^T00030MTRCDATES"
"RTN","SDECAR1",174,0)
 ;                       48              49         50         51         52         53
"RTN","SDECAR1",175,0)
 S SDRTMP=SDRTMP_"^T00100SENSITIVE^T00030NU49^T00030NU50^T00030NU51^T00030NU52^T00030NU53"
"RTN","SDECAR1",176,0)
 ;                       54         55         56            57            58             59
"RTN","SDECAR1",177,0)
 S SDRTMP=SDRTMP_"^T00030NU54^T00030NU55^T00030LASTSUB^T00030STOPIEN^T00030STOPNAME^T00250APPT_SCHED_DATE"
"RTN","SDECAR1",178,0)
 S SDRTMP=SDRTMP_"^T00030MRTCCOUNT^T00030PTPHONE^T00030APPTYPE^T00030EESTAT^T00030PRHBLOC^T00030APPTPTRS"
"RTN","SDECAR1",179,0)
 S SDRTMP=SDRTMP_"^T00250CHILDREN^T00030SDPARENT"
"RTN","SDECAR1",180,0)
 S SDRTMP=SDRTMP_"^T00030HRN^T00030BADADD^T00030OPHONE^T00030NOK^T00030^T00030KNAME^T00030KREL^T00030KPHONE"
"RTN","SDECAR1",181,0)
 S SDRTMP=SDRTMP_"^T00030KSTREET^T00030KSTREET2^T00030KSTREET3^T00030KCITY^T00030KSTATE^T00030KZIP^T00030"
"RTN","SDECAR1",182,0)
 S SDRTMP=SDRTMP_"^T00030NOK2^T00030K2NAME^T00030K2REL^T00030K2PHONE"
"RTN","SDECAR1",183,0)
 S SDRTMP=SDRTMP_"^T00030K2STREET^T00030K2STREET2^T00030K2STREET3^T00030K2CITY^T00030K2STATE^T00030K2ZIP"
"RTN","SDECAR1",184,0)
 S SDRTMP=SDRTMP_"^T00030PCOUNTY^T00030PETH^T00030PRACE^T00030PMARITAL^T00030PRELIGION^T00030PTACTIVE"
"RTN","SDECAR1",185,0)
 S SDRTMP=SDRTMP_"^T00030PTADDRESS1^T00030PTADDRESS2^T00030PTADDRESS3^T00030PTCITY^T00030PTSTATE^T00030PTZIP^T00030PTZIP+4"
"RTN","SDECAR1",186,0)
 S SDRTMP=SDRTMP_"^T00030PTCOUNTRY^T00030PTCOUNTY^T00030PTMPPHONE^T00030PTSTART^T00030PTEND^T00030PCELL^T00030PPAGER^T00030PEMAIL"
"RTN","SDECAR1",187,0)
 S SDRTMP=SDRTMP_"^T00030PF_FFF^T00030PF_VCD^T00030PFNATIONAL^T00030PFLOCAL^T00030SUBGRP^T00030CAT8G^T01000SIMILAR"
"RTN","SDECAR1",188,0)
 S SDRTMP=SDRTMP_"^T00032VAOS_GUID" ;  wtc patch 686 3/23/18 added for VAOS requests
"RTN","SDECAR1",189,0)
 S @RET@(COUNT)=SDRTMP_$C(30)
"RTN","SDECAR1",190,0)
 Q
"RTN","SDECAR1",191,0)
 ;
"RTN","SDECAR1",192,0)
ONEPAT ; Process one patient
"RTN","SDECAR1",193,0)
 N APPTYPE,ARMRTC,CHILDREN,SDI,PRHBLOC
"RTN","SDECAR1",194,0)
 K ARASD,ARDATA,ARSDOA,ARDAM,ARCLERK,ARCLERKN
"RTN","SDECAR1",195,0)
 S FRULES=$G(FRULES)
"RTN","SDECAR1",196,0)
 D GETS^DIQ(FNUM,ARIEN,"**","IE","ARDATA","ARMSG")
"RTN","SDECAR1",197,0)
 Q:'$D(ARDATA)
"RTN","SDECAR1",198,0)
 S ARSTAT=ARDATA(FNUM,ARIEN_",",23,"I")
"RTN","SDECAR1",199,0)
 I FRULES I '+$G(CLOSED) Q:ARSTAT="C"  ; Ignore CLOSED records; CLOSED setup and used from SDEC54 only
"RTN","SDECAR1",200,0)
 S ARORIGDT=ARDATA(FNUM,ARIEN_",",1,"I")
"RTN","SDECAR1",201,0)
 I FRULES I ($P(ARORIGDT,".",1)<SDBEG)!($P(ARORIGDT,".",1)>SDEND) Q
"RTN","SDECAR1",202,0)
 S DFN=ARDATA(FNUM,ARIEN_",",.01,"I")
"RTN","SDECAR1",203,0)
 Q:DFN=""
"RTN","SDECAR1",204,0)
 S SDPS=ARDATA(FNUM,ARIEN_",",.02,"E")
"RTN","SDECAR1",205,0)
 S SDCL=ARDATA(FNUM,ARIEN_",",8,"I")
"RTN","SDECAR1",206,0)
 Q:(SDCL'="")&($$GET1^DIQ(44,SDCL_",",50.01,"I")=1)  ;check OOS? in file 44
"RTN","SDECAR1",207,0)
 S PRHBLOC=$S($$GET1^DIQ(44,SDCL_",",2500,"I")="Y":1,1:0)
"RTN","SDECAR1",208,0)
 ;collect demographics
"RTN","SDECAR1",209,0)
 D PDEMO^SDECU3(.SDDEMO,DFN)  ;alb/sat 658 PDEMO moved to SDECU3
"RTN","SDECAR1",210,0)
 S NAME=SDDEMO("NAME")
"RTN","SDECAR1",211,0)
 S DOB=SDDEMO("DOB")
"RTN","SDECAR1",212,0)
 S GENDER=SDDEMO("GENDER")
"RTN","SDECAR1",213,0)
 S HRN=SDDEMO("HRN")
"RTN","SDECAR1",214,0)
 S SSN=SDDEMO("SSN")
"RTN","SDECAR1",215,0)
 S INSTIEN=SDDEMO("INSTIEN")
"RTN","SDECAR1",216,0)
 S INSTNAME=SDDEMO("INSTNAME")
"RTN","SDECAR1",217,0)
 S PRIGRP=SDDEMO("PRIGRP")
"RTN","SDECAR1",218,0)
 S ELIGIEN=SDDEMO("ELIGIEN")
"RTN","SDECAR1",219,0)
 S ELIGNAME=SDDEMO("ELIGNAME")
"RTN","SDECAR1",220,0)
 S SVCCONN=SDDEMO("SVCCONN")
"RTN","SDECAR1",221,0)
 S SVCCONNP=SDDEMO("SVCCONNP")
"RTN","SDECAR1",222,0)
 S TYPEIEN=SDDEMO("TYPEIEN")
"RTN","SDECAR1",223,0)
 S TYPENAME=SDDEMO("TYPENAME")
"RTN","SDECAR1",224,0)
 S PADDRES1=SDDEMO("PADDRES1")
"RTN","SDECAR1",225,0)
 S PADDRES2=SDDEMO("PADDRES2")
"RTN","SDECAR1",226,0)
 S PADDRES3=SDDEMO("PADDRES3")
"RTN","SDECAR1",227,0)
 S PCITY=SDDEMO("PCITY")
"RTN","SDECAR1",228,0)
 S PSTATE=SDDEMO("PSTATE")
"RTN","SDECAR1",229,0)
 S PCOUNTRY=SDDEMO("PCOUNTRY")
"RTN","SDECAR1",230,0)
 S PZIP4=SDDEMO("PZIP+4")
"RTN","SDECAR1",231,0)
 ;
"RTN","SDECAR1",232,0)
 S GAF=$$GAF^SDECU2(DFN)
"RTN","SDECAR1",233,0)
 ;
"RTN","SDECAR1",234,0)
 S PTPHONE=SDDEMO("HPHONE")    ;ARDATA(FNUM,ARIEN_",",.05,"I")  ;msc/sat
"RTN","SDECAR1",235,0)
 S ARINST=ARDATA(FNUM,ARIEN_",",2,"I")
"RTN","SDECAR1",236,0)
 S ARINSTNM=ARDATA(FNUM,ARIEN_",",2,"E")
"RTN","SDECAR1",237,0)
 S ARTYPE=ARDATA(FNUM,ARIEN_",",4,"I")
"RTN","SDECAR1",238,0)
 S VAOSGUID=ARDATA(FNUM,ARIEN_",",5,"I") ;  wtc patch 686 3/23/18 added for VAOS requests
"RTN","SDECAR1",239,0)
 S ARCLIENL=ARDATA(FNUM,ARIEN_",",8,"I")
"RTN","SDECAR1",240,0)
 S ARSTOP=ARDATA(FNUM,ARIEN_",",8.5,"I")
"RTN","SDECAR1",241,0)
 S ARSTOPN=ARDATA(FNUM,ARIEN_",",8.5,"E")
"RTN","SDECAR1",242,0)
 ;S ARCLIEN=$P($G(^SDWL(409.32,+ARCLIENL,0)),U,1)
"RTN","SDECAR1",243,0)
 S ARCLIEN=ARCLIENL
"RTN","SDECAR1",244,0)
 S ARCLNAME=ARDATA(FNUM,ARIEN_",",8,"E")
"RTN","SDECAR1",245,0)
 S APPTYPE=ARDATA(FNUM,ARIEN_",",8.7,"I")
"RTN","SDECAR1",246,0)
 S ARUSER=ARDATA(FNUM,ARIEN_",",9,"I")
"RTN","SDECAR1",247,0)
 S ARUSRNM=ARDATA(FNUM,ARIEN_",",9,"E")
"RTN","SDECAR1",248,0)
 S AREDT=$G(ARDATA(FNUM,ARIEN_",",9.5,"E"))   ;53
"RTN","SDECAR1",249,0)
 S ARPRIO=ARDATA(FNUM,ARIEN_",",10,"I")
"RTN","SDECAR1",250,0)
 S ARENPRI=ARDATA(FNUM,ARIEN_",",10.5,"E")   ;msc/sat
"RTN","SDECAR1",251,0)
 S ARREQBY=ARDATA(FNUM,ARIEN_",",11,"I")
"RTN","SDECAR1",252,0)
 S ARPROV=ARDATA(FNUM,ARIEN_",",12,"I")
"RTN","SDECAR1",253,0)
 S ARPROVNM=ARDATA(FNUM,ARIEN_",",12,"E")
"RTN","SDECAR1",254,0)
 S ARSDOA=ARDATA(FNUM,ARIEN_",",13,"E")      ;scheduled date of appt
"RTN","SDECAR1",255,0)
 S ARDAM=ARDATA(FNUM,ARIEN_",",13.1,"E")     ;date appt. made
"RTN","SDECAR1",256,0)
 S ARCLERK=ARDATA(FNUM,ARIEN_",",13.7,"I")   ;appt clerk ien
"RTN","SDECAR1",257,0)
 S ARCLERKN=ARDATA(FNUM,ARIEN_",",13.7,"E")   ;appt clerk name
"RTN","SDECAR1",258,0)
 S ARASD=""
"RTN","SDECAR1",259,0)
 S:ARSDOA'="" $P(ARASD,"~~",1)=ARSDOA
"RTN","SDECAR1",260,0)
 S:ARCLERK'="" $P(ARASD,"~~",12)=ARCLERK
"RTN","SDECAR1",261,0)
 S:ARCLERKN'="" $P(ARASD,"~~",13)=ARCLERKN
"RTN","SDECAR1",262,0)
 S:ARDAM'="" $P(ARASD,"~~",17)=ARDAM
"RTN","SDECAR1",263,0)
 S ARSVCCON=ARDATA(FNUM,ARIEN_",",15,"E")
"RTN","SDECAR1",264,0)
 S ARDAPTDT=ARDATA(FNUM,ARIEN_",",22,"I")
"RTN","SDECAR1",265,0)
 S ARCOMM=ARDATA(FNUM,ARIEN_",",25,"I")
"RTN","SDECAR1",266,0)
 ;S AREESTAT=ARDATA(FNUM,ARIEN_",",27,"I")
"RTN","SDECAR1",267,0)
 S ARMAR=$$GET1^DIQ(409.85,ARIEN_",",41)
"RTN","SDECAR1",268,0)
 S ARMAI=$$GET1^DIQ(409.85,ARIEN_",",42)
"RTN","SDECAR1",269,0)
 S ARMAN=$$GET1^DIQ(409.85,ARIEN_",",43)
"RTN","SDECAR1",270,0)
 S ARPC=$$WLPC^SDECAR1A(.ARDATA,ARIEN)
"RTN","SDECAR1",271,0)
 S ARDISPD=ARDATA(FNUM,ARIEN_",",19,"E")
"RTN","SDECAR1",272,0)
 S ARDISPU=ARDATA(FNUM,ARIEN_",",20,"I")
"RTN","SDECAR1",273,0)
 S ARDISPUN=ARDATA(FNUM,ARIEN_",",20,"E")
"RTN","SDECAR1",274,0)
 S APPTPTRS=$$GETAPPTS^SDECAR1A(ARIEN)
"RTN","SDECAR1",275,0)
 S CHILDREN=$$CHILDREN^SDECAR1A(ARIEN)
"RTN","SDECAR1",276,0)
 S ARMRTC=$$MRTC^SDECAR(ARIEN)
"RTN","SDECAR1",277,0)
 S SDPARENT=ARDATA(FNUM,ARIEN_",",43.8,"I")
"RTN","SDECAR1",278,0)
 S SDSENS=$$PTSEC^SDECUTL(DFN)
"RTN","SDECAR1",279,0)
 S (SDI,SDMTRC)="" F  S SDI=$O(ARDATA(409.857,SDI)) Q:SDI=""  S SDMTRC=$S(SDMTRC'="":SDMTRC_"|",1:"")_ARDATA(409.857,SDI,.01,"E")
"RTN","SDECAR1",280,0)
 S COUNT=COUNT+1
"RTN","SDECAR1",281,0)
 ;     1     2    3    4    5    6    7       8          9        10         11
"RTN","SDECAR1",282,0)
 S STR=DFN_U_""_U_""_U_""_U_""_U_""_U_ARIEN_U_ARORIGDT_U_ARINST_U_ARINSTNM_U_ARTYPE
"RTN","SDECAR1",283,0)
 ;           12        13         14       15        16       17        18
"RTN","SDECAR1",284,0)
 S STR=STR_U_ARCLIEN_U_ARCLNAME_U_ARUSER_U_ARUSRNM_U_ARPRIO_U_ARREQBY_U_ARPROV
"RTN","SDECAR1",285,0)
 ;           19         20         21       22        23      24      25
"RTN","SDECAR1",286,0)
 S STR=STR_U_ARPROVNM_U_ARDAPTDT_U_ARCOMM_U_ARENPRI_U_ARMAR_U_ARMAI_U_ARMAN
"RTN","SDECAR1",287,0)
 ;           26       27        28         29        30         31        32         33
"RTN","SDECAR1",288,0)
 S STR=STR_U_PRIGRP_U_ELIGIEN_U_ELIGNAME_U_SVCCONN_U_SVCCONNP_U_TYPEIEN_U_TYPENAME_U_ARPC
"RTN","SDECAR1",289,0)
 ;           34        35        36         37         38   39   40   41   42
"RTN","SDECAR1",290,0)
 S STR=STR_U_ARDISPD_U_ARDISPU_U_ARDISPUN_U_ARSVCCON_U_""_U_""_U_""_U_""_U_""
"RTN","SDECAR1",291,0)
 ;           43   44   45    46      47       48                       57   (save 56 for SDSUB)
"RTN","SDECAR1",292,0)
 S STR=STR_U_""_U_""_U_GAF_U_AREDT_U_SDMTRC_U_SDSENS_U_U_U_U_U_U_U_U_U_ARSTOP_U_ARSTOPN_U_ARASD
"RTN","SDECAR1",293,0)
 S STR=STR_U_ARMRTC_U_PTPHONE_U_APPTYPE_U_SDPS_U_PRHBLOC_U_APPTPTRS_U_CHILDREN_U_SDPARENT
"RTN","SDECAR1",294,0)
 D ARDEMO^SDECAR1A(.STR,DFN)  ;alb/sat 658 - get demographics
"RTN","SDECAR1",295,0)
 S $P(STR,"^",121)=VAOSGUID ;  wtc patch 686 3/23/18 added for VAOS requests.  Revised to store in piece 121.
"RTN","SDECAR1",296,0)
 S @RET@(COUNT)=STR_$C(30)
"RTN","SDECAR1",297,0)
 Q
"RTN","SDECAR1",298,0)
 ;
"RTN","SDECAR1",299,0)
ARGUID(RET,GUID)    ;
"RTN","SDECAR1",300,0)
 ;
"RTN","SDECAR1",301,0)
 ;  Return SDEC Appointment Request data for a VAOS Request GUID.
"RTN","SDECAR1",302,0)
 ;
"RTN","SDECAR1",303,0)
 ;  wtc SD*5.3*686  4/19/2018
"RTN","SDECAR1",304,0)
 ;
"RTN","SDECAR1",305,0)
 N FNUM,ARIEN,SDTMP,COUNT ;
"RTN","SDECAR1",306,0)
 S RET="^TMP(""SDEC"","_$J_")" ;
"RTN","SDECAR1",307,0)
 K @RET ;
"RTN","SDECAR1",308,0)
 S FNUM=$$FNUM^SDECAR,COUNT=0 ;
"RTN","SDECAR1",309,0)
 S ARIEN=$O(^SDEC(409.85,"GUID",GUID,0)) ;
"RTN","SDECAR1",310,0)
 D HDR ;
"RTN","SDECAR1",311,0)
 I ARIEN>0 D ONEPAT ;
"RTN","SDECAR1",312,0)
 G ARX ;
"RTN","SDECAR1",313,0)
 ;
"RTN","SDECAR2")
0^8^B199967808^B191968590
"RTN","SDECAR2",1,0)
SDECAR2 ;ALB/SAT/JSM - VISTA SCHEDULING RPCS ;10:57 AM  3 Jul 2017
"RTN","SDECAR2",2,0)
 ;;5.3;Scheduling;**627,642,658,671,686**;Aug 13, 1993;Build 53
"RTN","SDECAR2",3,0)
 ;
"RTN","SDECAR2",4,0)
 Q
"RTN","SDECAR2",5,0)
 ;
"RTN","SDECAR2",6,0)
ARSET(RET,INP) ;Appointment Request Set
"RTN","SDECAR2",7,0)
 ;ARSET(RET,INP...)  external parameter tag in SDEC
"RTN","SDECAR2",8,0)
 ;  INP(1)  = (integer)  Wait List IEN point to
"RTN","SDECAR2",9,0)
 ;                       SDEC APPT REQUEST file 409.85.
"RTN","SDECAR2",10,0)
 ;                       If null, a new entry will be added
"RTN","SDECAR2",11,0)
 ;  INP(2)  = (text)     DFN Pointer to the PATIENT file 2
"RTN","SDECAR2",12,0)
 ;  INP(3)  = (date)     Originating Date/time in external date form
"RTN","SDECAR2",13,0)
 ;  INP(4)  = (text)     Institution name NAME field from the INSTITUTION file
"RTN","SDECAR2",14,0)
 ;  INP(5)  = (text)     Request Type
"RTN","SDECAR2",15,0)
 ;  INP(6)  = (text)     REQ Specific Clinic name - NAME field in file 44
"RTN","SDECAR2",16,0)
 ;  INP(7)  = (text)     Originating User name  - NAME field in NEW PERSON file 200
"RTN","SDECAR2",17,0)
 ;  INP(8)  = (text)     Priority - 'ASAP' or 'FUTURE'
"RTN","SDECAR2",18,0)
 ;  INP(9)  = (text)     Request By - 'PROVIDER' or 'PATIENT'
"RTN","SDECAR2",19,0)
 ;  INP(10) = (text)     Provider name  - NAME field in NEW PERSON file200
"RTN","SDECAR2",20,0)
 ;  INP(11) = (date)     Desired Date of appointment in external format.
"RTN","SDECAR2",21,0)
 ;  INP(12) = (text)     comment must be 1-60 characters
"RTN","SDECAR2",22,0)
 ;  INP(13) = (text)     ENROLLMENT PRIORITY - Valid Values are:
"RTN","SDECAR2",23,0)
 ;                                             GROUP 1
"RTN","SDECAR2",24,0)
 ;                                             GROUP 2
"RTN","SDECAR2",25,0)
 ;                                             GROUP 3
"RTN","SDECAR2",26,0)
 ;                                             GROUP 4
"RTN","SDECAR2",27,0)
 ;                                             GROUP 5
"RTN","SDECAR2",28,0)
 ;                                             GROUP 6
"RTN","SDECAR2",29,0)
 ;                                             GROUP 7
"RTN","SDECAR2",30,0)
 ;                                             GROUP 8
"RTN","SDECAR2",31,0)
 ;  INP(14) = (text)     MULTIPLE APPOINTMENT RTC      NO; YES
"RTN","SDECAR2",32,0)
 ;  INP(15) = (integer)  MULT APPT RTC INTERVAL integer between 1-365
"RTN","SDECAR2",33,0)
 ;  INP(16) = (integer)  MULT APPT NUMBER integer between 1-100
"RTN","SDECAR2",34,0)
 ;  INP(17) = Patient Contacts separated by ::
"RTN","SDECAR2",35,0)
 ;            Each :: piece has the following ~~ pieces:
"RTN","SDECAR2",36,0)
 ;            1) = (date)    DATE ENTERED external date/time
"RTN","SDECAR2",37,0)
 ;            2) = (text)    PC ENTERED BY USER ID or NAME - Pointer toNEW PERSON file or NAME
"RTN","SDECAR2",38,0)
 ;            4) = (optional) ACTION - valid values are:
"RTN","SDECAR2",39,0)
 ;                             CALLED
"RTN","SDECAR2",40,0)
 ;                             MESSAGE LEFT
"RTN","SDECAR2",41,0)
 ;                             LETTER
"RTN","SDECAR2",42,0)
 ;            5) = (optional) PATIENT PHONE Free-Text 4-20 characters
"RTN","SDECAR2",43,0)
 ;            6) = NOT USED (optional) Comment 1-160 characters
"RTN","SDECAR2",44,0)
 ;  INP(18) = (optional) SERVICE CONNECTED PRIORITY valid values are NO YES
"RTN","SDECAR2",45,0)
 ;  INP(19) = (optional) SERVICE CONNECTED PERCENTAGE = numeric 0-100
"RTN","SDECAR2",46,0)
 ;  INP(20) = (optional) MRTC calculated preferred dates separated by pipe |:
"RTN","SDECAR2",47,0)
 ;                       Each date can be in external format with no time.
"RTN","SDECAR2",48,0)
 ;  INP(21) = (optional) CLINIC STOP pointer to CLINIC STOP file 40.7
"RTN","SDECAR2",49,0)
 ;                       used to populate the REQ SERVICE/SPECIALTY field in 409.85
"RTN","SDECAR2",50,0)
 ;  INP(22) = (optional) Appointment Type ID pointer to APPOINTMENT TYPE file 409.1
"RTN","SDECAR2",51,0)
 ;  INP(23) = (optional) Patient Status
"RTN","SDECAR2",52,0)
 ;                          N = NEW
"RTN","SDECAR2",53,0)
 ;                          E = ESTABLISHED
"RTN","SDECAR2",54,0)
 ;  INP(24) = (optional) MULT APPTS MADE
"RTN","SDECAR2",55,0)
 ;                    list of child pointers to SDEC APPOINTMENT and/orSDEC APPT REQUEST files separated by pipe
"RTN","SDECAR2",56,0)
 ;                    each pipe piece contains the following ~ pieces:
"RTN","SDECAR2",57,0)
 ;                1. Appointment Id pointer to SDEC APPOINTMENT file 409.84
"RTN","SDECAR2",58,0)
 ;                2. Request Id pointer to SDEC APPT REQUEST file 409.85
"RTN","SDECAR2",59,0)
 ;  INP(25) = (optional) PARENT REQUEST pointer to SDEC APPT REQUEST file 409.85
"RTN","SDECAR2",60,0)
 ;  INP(26) = (optional) NLT (No later than) [CPRS RTC REQUIREMENT]
"RTN","SDECAR2",61,0)
 ;  INP(27) = (optional) PREREQ (Prerequisites) [CPRS RTC REQUIREMENT]
"RTN","SDECAR2",62,0)
 ;  INP(28) = (optional) ORDER IEN [CPRS RTC REQUIREMENT]
"RTN","SDECAR2",63,0)
 ;  INP(29) = (optional) VAOS GUID  <== wtc patch 686 3/21/18 added for VAOS requests
"RTN","SDECAR2",64,0)
 N X,Y,%DT
"RTN","SDECAR2",65,0)
 N DFN,MI,ARAPTYP,ARIEN,ARORIGDT,ARORIGDTI,ARINST,ARINSTI,ARTYPE,ARTEAM,ARPOS,ARSRVSP,ARCLIN
"RTN","SDECAR2",66,0)
 N ARUSER,ARPRIO,ARREQBY,ARPROV,ARDAPTDT,ARCOMM,AREESTAT,AREDT,ARQUIT
"RTN","SDECAR2",67,0)
 N FNUM,FDA,ARNEW,ARRET,ARMSG,ARDATA,ARERR,ARHOSN,AUDF,SDREC
"RTN","SDECAR2",68,0)
 N ARMAI,ARMAN,ARMAR,ARPARENT,ARPATTEL,ARENPRI,ARSTOP,ARSVCCON,ARSVCCOP
"RTN","SDECAR2",69,0)
 N VAOSGUID ; wtc patch 686 3/21/18 added for VAOS requests
"RTN","SDECAR2",70,0)
 S (ARQUIT,AUDF)=0
"RTN","SDECAR2",71,0)
 S FNUM=$$FNUM^SDECAR
"RTN","SDECAR2",72,0)
 S RET="I00020ERRORID^T00030ERRORTEXT"_$C(30)
"RTN","SDECAR2",73,0)
 ; Use MERGE instead of SET so we can know if values were actually specified or not.
"RTN","SDECAR2",74,0)
 ; This way, if a value is null, we will delete any previous value,
"RTN","SDECAR2",75,0)
 ; but if it is missing, then we will just ignore it.
"RTN","SDECAR2",76,0)
 M ARIEN=INP(1)
"RTN","SDECAR2",77,0)
 S DFN=$G(INP(2))
"RTN","SDECAR2",78,0)
 I '+DFN S RET=RET_"-1^Invalid Patient ID."_$C(30,31) Q
"RTN","SDECAR2",79,0)
 I '$D(^DPT(DFN,0)) S RET=RET_"-1^Invalid Patient ID"_$C(30,31) Q
"RTN","SDECAR2",80,0)
 S AREDT=$P($G(INP(3)),":",1,2)
"RTN","SDECAR2",81,0)
 S %DT="TX" S X=AREDT D ^%DT S AREDT=Y
"RTN","SDECAR2",82,0)
 I Y=-1 S RET=RET_"-1^Invalid Origination date."_$C(30,31) Q
"RTN","SDECAR2",83,0)
 S ARORIGDT=$P(AREDT,".",1)
"RTN","SDECAR2",84,0)
 S ARINST=$G(INP(4)) I ARINST'="" D
"RTN","SDECAR2",85,0)
 .I '+ARINST S ARINST=$O(^DIC(4,"B",ARINST,0))
"RTN","SDECAR2",86,0)
 M ARTYPE=INP(5)
"RTN","SDECAR2",87,0)
 S ARCLIN=$G(INP(6))
"RTN","SDECAR2",88,0)
 I ARCLIN'="" D
"RTN","SDECAR2",89,0)
 .I +ARCLIN=ARCLIN D
"RTN","SDECAR2",90,0)
 ..I '$D(^SC(+ARCLIN,0)) S RET=RET_"-1^"_ARCLIN_" is an invalid Clinic ID."_$C(30,31) S ARQUIT=1 Q
"RTN","SDECAR2",91,0)
 ..;S ARCLIN=$$GET1^DIQ(44,ARCLIN_",",.01)
"RTN","SDECAR2",92,0)
 .I '(+ARCLIN=ARCLIN) D
"RTN","SDECAR2",93,0)
 ..S ARCLIN=$O(^SC("B",ARCLIN,0))
"RTN","SDECAR2",94,0)
 ..I ARCLIN="" S RET=RET_"-1^"_ARCLIN_" is an invalid Clinic Name."_$C(30,31) S ARQUIT=1 Q
"RTN","SDECAR2",95,0)
 Q:ARQUIT=1
"RTN","SDECAR2",96,0)
 S ARUSER=$G(INP(7))
"RTN","SDECAR2",97,0)
 I ARUSER'="" I '+ARUSER S ARUSER=$O(^VA(200,"B",ARUSER,0))
"RTN","SDECAR2",98,0)
 I ARUSER="" S ARUSER=DUZ
"RTN","SDECAR2",99,0)
 S ARREQBY=$G(INP(9)) I ARREQBY'="" D
"RTN","SDECAR2",100,0)
 .S ARREQBY=$S(ARREQBY="PATIENT":2,ARREQBY="PROVIDER":1,1:"")
"RTN","SDECAR2",101,0)
 S ARPROV=$G(INP(10)) I ARPROV'="" I '+ARPROV S ARPROV=$O(^VA(200,"B",ARPROV,0))
"RTN","SDECAR2",102,0)
 S ARDAPTDT=INP(11)
"RTN","SDECAR2",103,0)
 S %DT="" S X=$P($G(ARDAPTDT),"@",1) D ^%DT S ARPRIO=$S(Y=$P($$NOW^XLFDT,".",1):"A",1:"F")
"RTN","SDECAR2",104,0)
 S ARDAPTDT=Y
"RTN","SDECAR2",105,0)
 I Y=-1 S ARDAPTDT=""   ;S RET=RET_"-1^Invalid Desired Date."_$C(30,31)Q
"RTN","SDECAR2",106,0)
 S (INP(12),ARCOMM)=$TR($G(INP(12)),"^"," ")   ;alb/sat 658
"RTN","SDECAR2",107,0)
 S ARENPRI=$G(INP(13)) D
"RTN","SDECAR2",108,0)
 .S:ARENPRI'="" ARENPRI=$S(ARENPRI="GROUP 1":1,ARENPRI="GROUP 2":2,ARENPRI="GROUP3":3,ARENPRI="GROUP4":4,ARENPRI="GROUP 5":5,ARENPRI="GROUP 6":6,ARENPRI="GROUP 7":7,ARENPRI="GROUP 8":8,1:ARENPRI)
"RTN","SDECAR2",109,0)
 S ARMAR=$G(INP(14)) I ARMAR'="" S ARMAR=$S(ARMAR="YES":1,1:0)
"RTN","SDECAR2",110,0)
 M ARMAI=INP(15)
"RTN","SDECAR2",111,0)
 M ARMAN=INP(16)
"RTN","SDECAR2",112,0)
 S ARSVCCON=$G(INP(18)) S:ARSVCCON'="" ARSVCCON=$S(ARSVCCON="YES":1,1:0)
"RTN","SDECAR2",113,0)
 M ARSVCCOP=INP(19) I $G(ARSVCCOP)'="" S ARSVCCOP=+$G(ARSVCCOP) S:(+ARSVCCOP<0)!(+ARSVCCOP>100) ARSVCCOP=""
"RTN","SDECAR2",114,0)
 S ARSTOP=$G(INP(21))
"RTN","SDECAR2",115,0)
 I ARSTOP'="",ARCLIN'="" S RET=RET_"-1^Cannot include both Clinic and Service."_$C(30,31) Q
"RTN","SDECAR2",116,0)
 S ARAPTYP=+$G(INP(22)) I +ARAPTYP,'$D(^SD(409.1,ARAPTYP,0)) S ARAPTYP=""
"RTN","SDECAR2",117,0)
 S ARPARENT=+$G(INP(25)) I +ARPARENT,'$D(^SDEC(409.85,+ARPARENT,0)) S ARPARENT=""
"RTN","SDECAR2",118,0)
 S ARNLT=+$G(INP(26))
"RTN","SDECAR2",119,0)
 S ARPRER=$G(INP(27))
"RTN","SDECAR2",120,0)
 S ARORDN=+$G(INP(28))
"RTN","SDECAR2",121,0)
 ;CHECK FOR MISSING NLT,PREREQ,ORDER IEN ON MULTIPLE APPT REQUESTS
"RTN","SDECAR2",122,0)
 I +ARPARENT>0&(+$G(INP(26))=0) D
"RTN","SDECAR2",123,0)
 .S ARNLT=$P($G(^SDEC(409.85,+ARPARENT,7)),U,2)
"RTN","SDECAR2",124,0)
 I +ARPARENT>0&($G(INP(27))="") D
"RTN","SDECAR2",125,0)
 .N PRIEN,PR
"RTN","SDECAR2",126,0)
 .S PRIEN=0 F  S PRIEN=$O(^SDEC(409.85,+ARPARENT,8,PRIEN)) Q:PRIEN'>0  D
"RTN","SDECAR2",127,0)
 ..S PR=$P($G(^SDEC(409.85,+ARPARENT,8,PRIEN,0)),"^") Q:PR=""
"RTN","SDECAR2",128,0)
 ..S ARPRER=$S(ARPRER'="":ARPRER_";"_PR,1:PR)
"RTN","SDECAR2",129,0)
 I +ARPARENT>0&(+$G(INP(28))=0) D
"RTN","SDECAR2",130,0)
 .S ARORDN=$P($G(^SDEC(409.85,+ARPARENT,7)),U,1)
"RTN","SDECAR2",131,0)
 ;
"RTN","SDECAR2",132,0)
 S VAOSGUID=$G(INP(29)) ;   <== wtc patch 686 3/21/18 added for VAOS requests
"RTN","SDECAR2",133,0)
 S ARIEN=$G(ARIEN)
"RTN","SDECAR2",134,0)
 S ARNEW=ARIEN=""
"RTN","SDECAR2",135,0)
 I ARNEW D
"RTN","SDECAR2",136,0)
 . S AUDF=1
"RTN","SDECAR2",137,0)
 . S FDA=$NA(FDA(FNUM,"+1,"))
"RTN","SDECAR2",138,0)
 . S @FDA@(.01)=+DFN   ;$S(+DFN:$P($G(^DPT(DFN,0)),U),1:DFN)
"RTN","SDECAR2",139,0)
 . ;This handles the date/time coming in as "8/27/2014 12:00:00 AM"
"RTN","SDECAR2",140,0)
 . S:$G(ARORIGDT)'="" @FDA@(1)=ARORIGDT
"RTN","SDECAR2",141,0)
 . S:$G(ARINST)'="" @FDA@(2)=+ARINST
"RTN","SDECAR2",142,0)
 . S:$G(ARTYPE)'="" @FDA@(4)=$S(ARTYPE="APPOINTMENT":"APPT",ARTYPE="MOBILE":"MOBILE",1:ARTYPE)
"RTN","SDECAR2",143,0)
 . S:$G(VAOSGUID)'="" @FDA@(5)=VAOSGUID ;   <== wtc patch 686 3/21/18 added for VAOS requests
"RTN","SDECAR2",144,0)
 . S:$G(ARCLIN)'="" @FDA@(8)=+ARCLIN
"RTN","SDECAR2",145,0)
 . S:$G(ARSTOP)'="" @FDA@(8.5)=+ARSTOP
"RTN","SDECAR2",146,0)
 . S:+ARAPTYP @FDA@(8.7)=+ARAPTYP
"RTN","SDECAR2",147,0)
 . S:$G(ARUSER)'="" @FDA@(9)=+ARUSER
"RTN","SDECAR2",148,0)
 . S:$G(AREDT)'="" @FDA@(9.5)=AREDT
"RTN","SDECAR2",149,0)
 . S:$G(ARPRIO)'="" @FDA@(10)=ARPRIO
"RTN","SDECAR2",150,0)
 . S:$G(ARENPRI)'="" @FDA@(10.5)=ARENPRI
"RTN","SDECAR2",151,0)
 . S:$G(ARREQBY)'="" @FDA@(11)=ARREQBY
"RTN","SDECAR2",152,0)
 . S:$G(ARPROV)'="" @FDA@(12)=+ARPROV
"RTN","SDECAR2",153,0)
 . S:$G(ARSVCCOP)'="" @FDA@(14)=ARSVCCOP
"RTN","SDECAR2",154,0)
 . S:$G(ARSVCCON)'="" @FDA@(15)=+ARSVCCON
"RTN","SDECAR2",155,0)
 . S:$G(ARDAPTDT)'="" @FDA@(22)=ARDAPTDT
"RTN","SDECAR2",156,0)
 . S:$G(ARNLT)'="" @FDA@(47)=ARNLT
"RTN","SDECAR2",157,0)
 . D FDAPRER(.FDA,ARPRER,"+1")
"RTN","SDECAR2",158,0)
 . S:$G(ARORDN)'="" @FDA@(46)=ARORDN
"RTN","SDECAR2",159,0)
 . S @FDA@(23)="O"
"RTN","SDECAR2",160,0)
 . S:$G(ARCOMM)'="" @FDA@(25)=ARCOMM
"RTN","SDECAR2",161,0)
 . S:$G(ARMAR)'="" @FDA@(41)=ARMAR
"RTN","SDECAR2",162,0)
 . I +ARMAR,$G(ARMAI)'="" S @FDA@(42)=ARMAI
"RTN","SDECAR2",163,0)
 . I +ARMAR,$G(ARMAN)'="" S @FDA@(43)=ARMAN
"RTN","SDECAR2",164,0)
 . S:$G(INP(23))'="" @FDA@(.02)=$S(INP(23)="N":"N",INP(23)="NEW":"N",INP(23)="E":"E",INP(23)="ESTABLISHED":"E",1:"")
"RTN","SDECAR2",165,0)
 . S:+ARPARENT @FDA@(43.8)=+ARPARENT
"RTN","SDECAR2",166,0)
 E  D
"RTN","SDECAR2",167,0)
 . S ARIEN=ARIEN_"," ; Append the comma for both
"RTN","SDECAR2",168,0)
 . K ARDATA,ARERR
"RTN","SDECAR2",169,0)
 . D GETS^DIQ(FNUM,ARIEN,"*","IE","ARDATA","ARERR")
"RTN","SDECAR2",170,0)
 . I $D(ARERR) M ARMSG=ARERR K FDA Q
"RTN","SDECAR2",171,0)
 . S FDA=$NA(FDA(FNUM,ARIEN))
"RTN","SDECAR2",172,0)
 . I $D(ARORIGDT) D
"RTN","SDECAR2",173,0)
 . . S ARORIGDT=$P(ARORIGDT,"@",1) S %DT="" S X=ARORIGDT D ^%DT S ARORIGDTI=Y
"RTN","SDECAR2",174,0)
 . . I ARORIGDTI'=ARDATA(FNUM,ARIEN,1,"I") S @FDA@(1)=$S(ARORIGDT="":"@",1:ARORIGDT)
"RTN","SDECAR2",175,0)
 . I $D(ARINST),ARINST'=ARDATA(FNUM,ARIEN,2,"I") S @FDA@(2)=+ARINST
"RTN","SDECAR2",176,0)
 . I $D(ARTYPE),ARTYPE'=ARDATA(FNUM,ARIEN,4,"E") S @FDA@(4)=$S(ARTYPE="APPOINTMENT":"APPT",ARTYPE="MOBILE":"MOBILE",1:ARTYPE)
"RTN","SDECAR2",177,0)
 . I $G(VAOSGUID)'="",VAOSGUID'=ARDATA(FNUM,ARIEN,5,"I") S @FDA@(5)=VAOSGUID ;   <== wtc patch 686 3/21/18 added for VAOS requests
"RTN","SDECAR2",178,0)
 . I ARCLIN'="",ARCLIN'=ARDATA(FNUM,ARIEN,8,"I") S @FDA@(8)=+ARCLIN,AUDF=1 S:ARDATA(FNUM,ARIEN,8.5,"I")'="" @FDA@(8.5)="@"
"RTN","SDECAR2",179,0)
 . I ARSTOP'="",ARSTOP'=ARDATA(FNUM,ARIEN,8.5,"I") S @FDA@(8.5)=+ARSTOP,AUDF=1 S:ARDATA(FNUM,ARIEN,8,"I")'="" @FDA@(8)="@"
"RTN","SDECAR2",180,0)
 . S:+ARAPTYP @FDA@(8.7)=+ARAPTYP
"RTN","SDECAR2",181,0)
 . I $D(ARUSER),ARUSER'=ARDATA(FNUM,ARIEN,9,"I") S @FDA@(9)=+ARUSER
"RTN","SDECAR2",182,0)
 . I $D(AREDT),AREDT'=$G(ARDATA(FNUM,ARIEN,9.5,"I")) S @FDA@(9.5)=AREDT
"RTN","SDECAR2",183,0)
 . I $D(ARPRIO),ARPRIO'=ARDATA(FNUM,ARIEN,10,"I") S @FDA@(10)=$S(ARPRIO="":"@",1:ARPRIO)
"RTN","SDECAR2",184,0)
 . I $D(ARENPRI),ARENPRI'=ARDATA(FNUM,ARIEN,10.5,"E") S @FDA@(10.5)=ARENPRI
"RTN","SDECAR2",185,0)
 . I $D(ARREQBY),ARREQBY'=ARDATA(FNUM,ARIEN,11,"I") S @FDA@(11)=$S(ARREQBY="":"@",1:ARREQBY)
"RTN","SDECAR2",186,0)
 . I $D(ARPROV),ARPROV'=ARDATA(FNUM,ARIEN,12,"I") S @FDA@(12)=+ARPROV
"RTN","SDECAR2",187,0)
 . I $D(ARSVCCOP),ARSVCCOP'=$G(ARDATA(FNUM,ARIEN,14,"I")) S @FDA@(14)=ARSVCCOP
"RTN","SDECAR2",188,0)
 . I $D(ARSVCCON),ARSVCCON'=ARDATA(FNUM,ARIEN,15,"E") S @FDA@(15)=+ARSVCCON
"RTN","SDECAR2",189,0)
 . I $D(ARDAPTDT),ARDAPTDT'=ARDATA(FNUM,ARIEN,22,"I") S @FDA@(22)=$S(ARDAPTDT="":"@",1:ARDAPTDT)
"RTN","SDECAR2",190,0)
 . I $D(ARCOMM),ARCOMM'=ARDATA(FNUM,ARIEN,25,"I") S @FDA@(25)=$S(ARCOMM="":"@",1:ARCOMM)
"RTN","SDECAR2",191,0)
 . S:$G(ARMAR)'="" @FDA@(41)=ARMAR
"RTN","SDECAR2",192,0)
 . S:$G(ARMAI)'="" @FDA@(42)=ARMAI
"RTN","SDECAR2",193,0)
 . S:$G(ARMAN)'="" @FDA@(43)=ARMAN
"RTN","SDECAR2",194,0)
 . S:$G(ARNLT)'="" @FDA@(47)=ARNLT
"RTN","SDECAR2",195,0)
 . D DELPRER(+ARIEN)
"RTN","SDECAR2",196,0)
 . D FDAPRER(.FDA,ARPRER,+ARIEN)
"RTN","SDECAR2",197,0)
 . S:$G(ARORDN)'="" @FDA@(46)=ARORDN
"RTN","SDECAR2",198,0)
 . S:$G(INP(23))'="" @FDA@(.02)=$S(INP(23)="N":"N",INP(23)="NEW":"N",INP(23)="E":"E",INP(23)="ESTABLISHED":"E",1:"")
"RTN","SDECAR2",199,0)
 . S:+ARPARENT @FDA@(43.8)=+ARPARENT
"RTN","SDECAR2",200,0)
 ; Only call UPDATE^DIE if there are any array entries in FDA
"RTN","SDECAR2",201,0)
 D:$D(FDA)>9 UPDATE^DIE("","FDA","ARRET","ARMSG")
"RTN","SDECAR2",202,0)
 I $D(ARMSG) D
"RTN","SDECAR2",203,0)
 . F MI=1:1:$G(ARMSG("DIERR")) S RET=RET_"-1^"_$G(ARMSG("DIERR",MI,"TEXT",1))_$C(30)
"RTN","SDECAR2",204,0)
 . S RET=RET_$C(31)
"RTN","SDECAR2",205,0)
 Q:$D(ARMSG)
"RTN","SDECAR2",206,0)
 S ARINSTI=$P($G(^SDEC(409.85,$S(+ARIEN:ARIEN,1:ARRET(1)),0)),U,3)
"RTN","SDECAR2",207,0)
 I $G(INP(17))'="" D AR23(INP(17),$S(+ARIEN:ARIEN,1:ARRET(1)))   ;patient contacts
"RTN","SDECAR2",208,0)
 I +ARMAR,$G(INP(20))'="" D AR435(INP(20),$S(+ARIEN:ARIEN,1:ARRET(1)))   ;MRTC CALC PREF DATES
"RTN","SDECAR2",209,0)
 I +AUDF D ARAUD($S(+ARIEN:+ARIEN,1:ARRET(1)),ARCLIN,ARSTOP)   ;VS AUDIT
"RTN","SDECAR2",210,0)
 I $G(INP(24))'="" N SDI F SDI=1:1:$L(INP(24),"|") S SDREC=$P(INP(24),"|",SDI) D AR433($S(+ARIEN:+ARIEN,1:ARRET(1)),SDREC)
"RTN","SDECAR2",211,0)
 I +ARPARENT D AR433(+ARPARENT,"~"_$S(+ARIEN:+ARIEN,1:ARRET(1)))
"RTN","SDECAR2",212,0)
 I +$G(ARRET(1)) S RET=RET_ARRET(1)_U_$C(30,31)
"RTN","SDECAR2",213,0)
 E  S RET=RET_+ARIEN_U_$C(30,31)
"RTN","SDECAR2",214,0)
 Q
"RTN","SDECAR2",215,0)
 ;
"RTN","SDECAR2",216,0)
FDAPRER(FDA,ARPRER,ARIEN) ;Setup the FDA array for the PREREQUISITE multiple (#48)
"RTN","SDECAR2",217,0)
 N ASEQ,DELIM,PC,PR
"RTN","SDECAR2",218,0)
 Q:$G(ARPRER)=""
"RTN","SDECAR2",219,0)
 S DELIM=";",ASEQ=80
"RTN","SDECAR2",220,0)
 F PC=1:1:$L(ARPRER,DELIM) D
"RTN","SDECAR2",221,0)
 .S PR=$P(ARPRER,DELIM,PC) Q:PR=""
"RTN","SDECAR2",222,0)
 .S ASEQ=ASEQ+1,FDA(409.8548,"+"_ASEQ_","_ARIEN_",",.01)=PR
"RTN","SDECAR2",223,0)
 Q
"RTN","SDECAR2",224,0)
 ;
"RTN","SDECAR2",225,0)
DELPRER(ARIEN) ;Delete all entries in the PREREQUISITE multiple (#48)
"RTN","SDECAR2",226,0)
 N DIK,DA
"RTN","SDECAR2",227,0)
 Q:$G(ARIEN)'=+$G(ARIEN)  Q:ARIEN'>0
"RTN","SDECAR2",228,0)
 S DIK="^SDEC(409.85,"_ARIEN_",8,",DA(1)=ARIEN
"RTN","SDECAR2",229,0)
 S DA=0 F  S DA=$O(^SDEC(409.85,ARIEN,8,DA)) Q:DA'>0  D ^DIK
"RTN","SDECAR2",230,0)
 Q
"RTN","SDECAR2",231,0)
 ;
"RTN","SDECAR2",232,0)
GETPRER(RET,ARIEN) ;Return the values in the PREREQUISITE multiple (#48)
"RTN","SDECAR2",233,0)
 N CC,PR
"RTN","SDECAR2",234,0)
 I $G(^SDEC(409.85,+$G(ARIEN),0))="" S RET="-1^Invalid SDEC APPT REQUEST id "_$G(ARIEN) Q
"RTN","SDECAR2",235,0)
 S RET=""
"RTN","SDECAR2",236,0)
 S CC=0 F  S CC=$O(^SDEC(409.85,ARIEN,8,CC)) Q:CC'>0  D
"RTN","SDECAR2",237,0)
 .S PR=$P($G(^SDEC(409.85,ARIEN,8,CC,0)),U,1) Q:PR=""
"RTN","SDECAR2",238,0)
 .S RET=$S(RET'="":RET_U_PR,1:PR)
"RTN","SDECAR2",239,0)
 Q
"RTN","SDECAR2",240,0)
 ;
"RTN","SDECAR2",241,0)
ARAUD(ARIEN,ARCLIN,ARSTOP,DATE,USER) ;populate VS AUDIT multiple field 45
"RTN","SDECAR2",242,0)
 ; ARIEN   - (required) pointer to SDEC APPT REQUEST file 409.85
"RTN","SDECAR2",243,0)
 ; ARCLIN  - (optional) pointer to HOSPITAL LOCATION file 44
"RTN","SDECAR2",244,0)
 ; ARSTOP  - (optional) pointer to CLINIC STOP file
"RTN","SDECAR2",245,0)
 ; DATE    - (optional) date/time in fileman format
"RTN","SDECAR2",246,0)
 N SDFDA,SDP,SDPN
"RTN","SDECAR2",247,0)
 S ARIEN=$G(ARIEN) Q:ARIEN=""
"RTN","SDECAR2",248,0)
 S ARCLIN=$G(ARCLIN)
"RTN","SDECAR2",249,0)
 S ARSTOP=$G(ARSTOP)
"RTN","SDECAR2",250,0)
 S SDP=$O(^SDEC(409.85,ARIEN,6,9999999),-1)
"RTN","SDECAR2",251,0)
 I +SDP S SDPN=^SDEC(409.85,ARIEN,6,SDP,0) I $P(SDPN,U,3)=ARCLIN,$P(SDPN,U,4)=ARSTOP Q
"RTN","SDECAR2",252,0)
 S DATE=$G(DATE) S:DATE="" DATE=$E($$NOW^XLFDT,1,12)
"RTN","SDECAR2",253,0)
 S USER=$G(USER) S:USER="" USER=DUZ
"RTN","SDECAR2",254,0)
 S SDFDA(409.8545,"+1,"_ARIEN_",",.01)=DATE
"RTN","SDECAR2",255,0)
 S SDFDA(409.8545,"+1,"_ARIEN_",",1)=USER
"RTN","SDECAR2",256,0)
 S:ARCLIN'="" SDFDA(409.8545,"+1,"_ARIEN_",",2)=ARCLIN
"RTN","SDECAR2",257,0)
 S:ARSTOP'="" SDFDA(409.8545,"+1,"_ARIEN_",",3)=ARSTOP
"RTN","SDECAR2",258,0)
 D UPDATE^DIE("","SDFDA")
"RTN","SDECAR2",259,0)
 Q
"RTN","SDECAR2",260,0)
 ;
"RTN","SDECAR2",261,0)
AR433(ARIEN,SDEC) ;set MULT APPTS MADE
"RTN","SDECAR2",262,0)
 ;INPUT:
"RTN","SDECAR2",263,0)
 ;  ARIEN  = (required) pointer to SDEC APPT REQUEST file 409.85
"RTN","SDECAR2",264,0)
 ;  SDEC   = (required) child pointers to SDEC APPOINTMENT and SDEC APPTREQUEST file separated by pipe
"RTN","SDECAR2",265,0)
 ;                    each pipe piece contains the following ~ pieces:
"RTN","SDECAR2",266,0)
 ;                1. Appointment Id pointer to SDEC APPOINTMENT file 409.84
"RTN","SDECAR2",267,0)
 ;                2. Request Id pointer to SDEC APPT REQUEST file 409.85
"RTN","SDECAR2",268,0)
 N SDAPP,SDFDA,SDI,SDIEN
"RTN","SDECAR2",269,0)
 S ARIEN=$G(ARIEN)
"RTN","SDECAR2",270,0)
 Q:'$D(^SDEC(409.85,ARIEN,0))
"RTN","SDECAR2",271,0)
 S SDEC=$G(SDEC)
"RTN","SDECAR2",272,0)
 F SDI=1:1:$L(SDEC,"|") D
"RTN","SDECAR2",273,0)
 .K SDFDA
"RTN","SDECAR2",274,0)
 .S SDAPP=$P(SDEC,"|",SDI)
"RTN","SDECAR2",275,0)
 .I $P(SDAPP,"~",2)="",$P(SDAPP,"~",1)'="" S $P(SDAPP,"~",2)=$P($$GET1^DIQ(409.84,+SDAPP_",",.22,"I"),";",1)
"RTN","SDECAR2",276,0)
 .Q:$P(SDAPP,"~",2)=""
"RTN","SDECAR2",277,0)
 .S SDIEN=$O(^SDEC(409.85,ARIEN,2,"B",$P(SDAPP,"~",2),0))
"RTN","SDECAR2",278,0)
 .S SDIEN=$S(SDIEN'="":SDIEN,1:"+1")
"RTN","SDECAR2",279,0)
 .I $D(^SDEC(409.85,+$P(SDAPP,"~",2),0)) S SDFDA(409.852,SDIEN_","_ARIEN_",",.01)=+$P(SDAPP,"~",2)
"RTN","SDECAR2",280,0)
 .I $D(^SDEC(409.84,+$P(SDAPP,"~",1),0)) S SDFDA(409.852,SDIEN_","_ARIEN_",",.02)=+$P(SDAPP,"~",1)
"RTN","SDECAR2",281,0)
 .D:$D(SDFDA) UPDATE^DIE("","SDFDA")
"RTN","SDECAR2",282,0)
 Q
"RTN","SDECAR2",283,0)
AR433D(SDEC) ;delete MULT APPTS MADE
"RTN","SDECAR2",284,0)
 ;INPUT:
"RTN","SDECAR2",285,0)
 ;  SDEC   = (required) pointers to SDEC APPOINTMENT file 409.84 separated by pipe
"RTN","SDECAR2",286,0)
 N ARIEN,DFN,DIEN,SDAPP,SDFDA,SDI,SDJ,SDTYP
"RTN","SDECAR2",287,0)
 S SDEC=$G(SDEC)
"RTN","SDECAR2",288,0)
 F SDI=1:1:$L(SDEC,"|") D
"RTN","SDECAR2",289,0)
 .S SDAPP=$P(SDEC,"|",SDI)
"RTN","SDECAR2",290,0)
 .Q:'$D(^SDEC(409.84,SDAPP,0))
"RTN","SDECAR2",291,0)
 .S DFN=$$GET1^DIQ(409.84,SDAPP_",",.05,"I")
"RTN","SDECAR2",292,0)
 .S SDTYP=$$GET1^DIQ(409.84,SDAPP_",",.22,"I"),DIEN=$P(SDTYP,";",1)
"RTN","SDECAR2",293,0)
 .I $P(SDTYP,";",2)="SDEC(409.85," S ARIEN="" F  S ARIEN=$O(^SDEC(409.85,"B",DFN,ARIEN)) Q:ARIEN=""  D  ; alb/jsm 658
"RTN","SDECAR2",294,0)
 ..S SDJ="" F  S SDJ=$O(^SDEC(409.85,ARIEN,2,"B",DIEN,SDJ)) Q:SDJ=""  D
"RTN","SDECAR2",295,0)
 ...S SDFDA(409.852,SDJ_","_ARIEN_",",.01)="@"
"RTN","SDECAR2",296,0)
 ...D UPDATE^DIE("","SDFDA")
"RTN","SDECAR2",297,0)
 Q
"RTN","SDECAR2",298,0)
AR438(ARIEN,SDPARENT,SDEC) ;set PARENT REQUEST field 43.8; set as child in MULTAPPTS MADE in parent request
"RTN","SDECAR2",299,0)
 N SDFDA
"RTN","SDECAR2",300,0)
 I $G(SDPARENT)'="" S SDFDA(409.85,ARIEN_",",43.8)=SDPARENT D UPDATE^DIE("","SDFDA")
"RTN","SDECAR2",301,0)
 Q
"RTN","SDECAR2",302,0)
 ;
"RTN","SDECAR2",303,0)
AR435(SDDT,ARIEN) ;set dates into MRTC CALC PREF DATES multiple field 43.5
"RTN","SDECAR2",304,0)
 ;INPUT:
"RTN","SDECAR2",305,0)
 ; ARIEN - Requested date ID pointer to SDEC REQUESTED APPT file 409.85
"RTN","SDECAR2",306,0)
 ; SDDT  - MRTC calculated preferred dates separated by pipe |:
"RTN","SDECAR2",307,0)
 ;         Each date can be in external format with no time.
"RTN","SDECAR2",308,0)
 N SDI,SDJ,SDFDA,X,Y,%DT
"RTN","SDECAR2",309,0)
 F SDI=1:1:$L(SDDT,"|") D
"RTN","SDECAR2",310,0)
 .S %DT="" S X=$P($P(SDDT,"|",SDI),"@",1) D ^%DT S SDJ=Y
"RTN","SDECAR2",311,0)
 .Q:SDJ=-1
"RTN","SDECAR2",312,0)
 .Q:$O(^SDEC(409.85,ARIEN,5,"B",SDJ,0))   ;don't add duplicates
"RTN","SDECAR2",313,0)
 .S SDFDA(409.851,"+1,"_ARIEN_",",.01)=SDJ
"RTN","SDECAR2",314,0)
 .D UPDATE^DIE("","SDFDA")
"RTN","SDECAR2",315,0)
 Q
"RTN","SDECAR2",316,0)
 ;
"RTN","SDECAR2",317,0)
WLACT(NAME) ;
"RTN","SDECAR2",318,0)
 N ACTIVE,H
"RTN","SDECAR2",319,0)
 S ACTIVE=""
"RTN","SDECAR2",320,0)
 S H="" F  S H=$O(^DIC(40.7,"B",NAME,H)) Q:H=""  D  Q:ACTIVE'=""
"RTN","SDECAR2",321,0)
 .I $P(^DIC(40.7,H,0),U,3)'="",$P(^DIC(40.7,H,0),U,3)<$$NOW^XLFDT() Q
"RTN","SDECAR2",322,0)
 .S ACTIVE=H
"RTN","SDECAR2",323,0)
 Q ACTIVE
"RTN","SDECAR2",324,0)
 ;
"RTN","SDECAR2",325,0)
AR23(INP17,ARI) ;Patient Contacts
"RTN","SDECAR2",326,0)
 N STR17,ARASD,ARASDH,ARDATA1,ARERR1,ARI1,ARIENS,ARIENS1,ARRET1,FDA
"RTN","SDECAR2",327,0)
 N ARDT,ARUSR,X,Y,%DT
"RTN","SDECAR2",328,0)
 S ARIENS=ARI_","
"RTN","SDECAR2",329,0)
 F ARI1=1:1:$L(INP17,"::") D
"RTN","SDECAR2",330,0)
 .S STR17=$P(INP17,"::",ARI1)
"RTN","SDECAR2",331,0)
 .K FDA
"RTN","SDECAR2",332,0)
 .S %DT="T" S X=$P($P(STR17,"~~",1),":",1,2) D ^%DT S ARASD=Y
"RTN","SDECAR2",333,0)
 .I (ARASD=-1)!(ARASD="") Q
"RTN","SDECAR2",334,0)
 .S ARDT=$P($P(STR17,"~~",1),":",1,2)
"RTN","SDECAR2",335,0)
 .S ARASDH=""   ;$O(^SDEC(409.85,ARI,4,"B",ARASD,0))
"RTN","SDECAR2",336,0)
 .S ARIENS1=$S(ARASDH'="":ARASDH,1:"+1")_","_ARIENS
"RTN","SDECAR2",337,0)
 .S FDA=$NA(FDA(409.8544,ARIENS1))
"RTN","SDECAR2",338,0)
 .I ARASDH'="" D
"RTN","SDECAR2",339,0)
 ..D GETS^DIQ(409.8544,ARIENS1,"*","IE","ARDATA1","ARERR1")
"RTN","SDECAR2",340,0)
 ..I $P(STR17,"~~",1)'="" S @FDA@(.01)=ARDT ;DATE ENTERED external date/time
"RTN","SDECAR2",341,0)
 ..I $P(STR17,"~~",2)'="" S ARUSR=$P(STR17,"~~",2) S @FDA@(2)=$S(ARUSR="":"@",+ARUSR:$P($G(^VA(200,ARUSR,0)),U,1),1:ARUSER)  ;PC ENTERED BY USER
"RTN","SDECAR2",342,0)
 ..I $P(STR17,"~~",4)'="" S @FDA@(3)=$P(STR17,"~~",4)     ;ACTION  C=Called; M=Message Left; L=LETTER
"RTN","SDECAR2",343,0)
 ..I $P(STR17,"~~",5)'="" S @FDA@(4)=$P(STR17,"~~",5)     ;PATIENT PHONE
"RTN","SDECAR2",344,0)
 ..;I $P(STR17,"~~",6)'="" S @FDA@(5)=$E($P(STR17,"~~",6),1,160)     ;COMMENT
"RTN","SDECAR2",345,0)
 .I ARASDH="" D
"RTN","SDECAR2",346,0)
 ..I $P(STR17,"~~",1)'="" S @FDA@(.01)=ARDT ;DATE ENTERED external date/time
"RTN","SDECAR2",347,0)
 ..I $P(STR17,"~~",2)'="" S ARUSR=$P(STR17,"~~",2) S @FDA@(2)=$S(ARUSR="":"@",+ARUSR:$P($G(^VA(200,ARUSR,0)),U,1),1:ARUSR)     ;PC ENTERED BY USER
"RTN","SDECAR2",348,0)
 ..I $P(STR17,"~~",4)'="" S @FDA@(3)=$P(STR17,"~~",4)     ;ACTION  C=Called; M=Message Left; L=LETTER
"RTN","SDECAR2",349,0)
 ..I $P(STR17,"~~",5)'="" S @FDA@(4)=$P(STR17,"~~",5)     ;PATIENT PHONE
"RTN","SDECAR2",350,0)
 ..;I $P(STR17,"~~",6)'="" S @FDA@(5)=$E($P(STR17,"~~",6),1,160)     ;COMMENT
"RTN","SDECAR2",351,0)
 .D:$D(@FDA) UPDATE^DIE("E","FDA","ARRET1","ARMSG1")
"RTN","SDECAR2",352,0)
 Q
"RTN","SDECAR2",353,0)
UPDATE(ARIEN,APPDT,SDCL,SVCP,SVCPR,NOTE,SDAPPTYP) ;update REQ APPT REQUEST at apointment add
"RTN","SDECAR2",354,0)
 ;INPUT:
"RTN","SDECAR2",355,0)
 ;  ARIEN = Appt Request pointer to SD WAIT LIST file 409.85
"RTN","SDECAR2",356,0)
 ;  APPDT = Appointment date/time (Scheduled Date of appt) in fm format
"RTN","SDECAR2",357,0)
 ;  SDCL  = Clinic ID pointer to HOSPITAL LOCATION file 44
"RTN","SDECAR2",358,0)
 ;  SVCP  = Service Connected Percentage numeric 0-100
"RTN","SDECAR2",359,0)
 ;  SVCPR = Service Connected Priority  0:NO  1:YES
"RTN","SDECAR2",360,0)
 ;  NOTE  = Comment only 1st 60 characters are used
"RTN","SDECAR2",361,0)
 ;  SDAPPTYP = (optional) Appointment type ID pointer to APPOINTMENT TYPE file 409.1
"RTN","SDECAR2",362,0)
 ;
"RTN","SDECAR2",363,0)
 ;all input must be verified by calling routine
"RTN","SDECAR2",364,0)
 N SDDIV,SDFDA,SDSN,SDMSG
"RTN","SDECAR2",365,0)
 S:+$G(SDAPPTYP) SDFDA(409.85,ARIEN_",",8.7)=SDAPPTYP
"RTN","SDECAR2",366,0)
 S SDFDA(409.85,ARIEN_",",13)=APPDT                     ;SCHEDULED DATEOF APPT       = APPDT  (SDECSTART)
"RTN","SDECAR2",367,0)
 S SDFDA(409.85,ARIEN_",",13.1)=$P($$NOW^XLFDT,".",1)   ;DATE APPT. MADE= TODAY
"RTN","SDECAR2",368,0)
 S SDFDA(409.85,ARIEN_",",13.2)=SDCL                    ;APPT CLINIC= SDCL   (SDECSCD)
"RTN","SDECAR2",369,0)
 S SDFDA(409.85,ARIEN_",",13.3)=$P($G(^SC(SDCL,0)),U,4) ;APPT INSTITUTION             = Get from 44 using SDCL
"RTN","SDECAR2",370,0)
 S SDFDA(409.85,ARIEN_",",13.4)=$P($G(^SC(SDCL,0)),U,7) ;APPT STOP CODE= Get from 44 using SDCL
"RTN","SDECAR2",371,0)
 S SDDIV=$P($G(^SC(SDCL,0)),U,15)
"RTN","SDECAR2",372,0)
 S SDSN=$S(SDDIV'="":$P($G(^DG(40.8,SDDIV,0)),U,2),1:"")
"RTN","SDECAR2",373,0)
 S SDFDA(409.85,ARIEN_",",13.6)=SDSN                    ;APPT STATION NUMBER
"RTN","SDECAR2",374,0)
 S SDFDA(409.85,ARIEN_",",13.7)=DUZ                     ;APPT CLERK= Current User
"RTN","SDECAR2",375,0)
 S SDFDA(409.85,ARIEN_",",13.8)="R"                     ;APPT STATUS= R:Scheduled/Kept
"RTN","SDECAR2",376,0)
 S:SVCP'="" SDFDA(409.85,ARIEN_",",14)=SVCP                      ;SERVICE CONNECTED PERCENTAGE = SVCP   (SDSVCP)
"RTN","SDECAR2",377,0)
 S:SVCPR'="" SDFDA(409.85,ARIEN_",",15)=SVCPR                     ;SERVICE CONNECTED PRIORITY   = SVCPR  (SDSVCPR)
"RTN","SDECAR2",378,0)
 S:$G(NOTE)'="" SDFDA(409.85,ARIEN_",",25)=NOTE
"RTN","SDECAR2",379,0)
 D UPDATE^DIE("","SDFDA","","SDMSG")
"RTN","SDECAR2",380,0)
 Q
"RTN","SDECAUD")
0^2^B101121122^n/a
"RTN","SDECAUD",1,0)
SDECAUD ; ALB/WTC - VISTA SCHEDULING - Audit Statistics Compiler ;
"RTN","SDECAUD",2,0)
 ;;5.3;Scheduling;**686**;Aug 13, 1993;Build 53
"RTN","SDECAUD",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified
"RTN","SDECAUD",4,0)
    ;
"RTN","SDECAUD",5,0)
    Q  ;
"RTN","SDECAUD",6,0)
    ;
"RTN","SDECAUD",7,0)
BKGND   ;
"RTN","SDECAUD",8,0)
    ;
"RTN","SDECAUD",9,0)
    ;  Compile statistics for yesterday.
"RTN","SDECAUD",10,0)
    ;
"RTN","SDECAUD",11,0)
    D COMPILE() ;
"RTN","SDECAUD",12,0)
    Q  ;
"RTN","SDECAUD",13,0)
    ;
"RTN","SDECAUD",14,0)
SELECT  ;
"RTN","SDECAUD",15,0)
    ;
"RTN","SDECAUD",16,0)
    ;  Compile statistics for selected date or range of dates.
"RTN","SDECAUD",17,0)
    ;
"RTN","SDECAUD",18,0)
    N DATE,DATE1,DATE2,%DT,Y,I,X1,X2,X,TODAY ;
"RTN","SDECAUD",19,0)
    ;
"RTN","SDECAUD",20,0)
    D NOW^%DTC S TODAY=X ;
"RTN","SDECAUD",21,0)
    W !,"Compile audit statistics for a date or date range.",! ;
"RTN","SDECAUD",22,0)
SELECT1 ;
"RTN","SDECAUD",23,0)
    S %DT="AEX",%DT("A")="Begin date: " D ^%DT Q:Y<0  I Y'<TODAY W "...Must be earlier than today.",! G SELECT1 ;
"RTN","SDECAUD",24,0)
    S DATE1=Y ;
"RTN","SDECAUD",25,0)
SELECT2 ;
"RTN","SDECAUD",26,0)
    S %DT="AEX",%DT("A")="End date: " D ^%DT Q:Y<0  I Y'<TODAY W "...Must be earlier than today.",! G SELECT2 ;
"RTN","SDECAUD",27,0)
    S DATE2=Y ;
"RTN","SDECAUD",28,0)
    I DATE1>DATE2 W "... Dates entered out of sequence.  Re-enter.",! G SELECT ;
"RTN","SDECAUD",29,0)
    ;
"RTN","SDECAUD",30,0)
    ;  Compile data for each date in range but skip a date if compile previously run for that date.
"RTN","SDECAUD",31,0)
    ;
"RTN","SDECAUD",32,0)
    F I=0:1 S X1=DATE1,X2=I D C^%DTC S DATE=X Q:DATE>DATE2  D  ;
"RTN","SDECAUD",33,0)
    . W ! S Y=DATE D DD^%DT W Y ;
"RTN","SDECAUD",34,0)
    . I $D(^SDAUDIT("C",DATE)) W "...previously compiled.  Skipped." Q  ;
"RTN","SDECAUD",35,0)
    . D COMPILE(DATE) W "...compiled." ;
"RTN","SDECAUD",36,0)
    Q  ;
"RTN","SDECAUD",37,0)
    ;
"RTN","SDECAUD",38,0)
COMPILE(DATE)   ;
"RTN","SDECAUD",39,0)
    ;
"RTN","SDECAUD",40,0)
    ;  Compile audit statistics for a date.  If date not specified, use yesterday.
"RTN","SDECAUD",41,0)
    ;
"RTN","SDECAUD",42,0)
    K ^TMP($J) ;
"RTN","SDECAUD",43,0)
    N D1,CLERK,DA,X,TYPE,MRTC,APPTDATE,STATUS,PIECE,GLOBAL,DIC,DA1,DLAYGO,FLD ;
"RTN","SDECAUD",44,0)
    ;
"RTN","SDECAUD",45,0)
    I $G(DATE)="" S DATE=$$HTFM^XLFDT($H-1,1) ;
"RTN","SDECAUD",46,0)
    ;
"RTN","SDECAUD",47,0)
    ;  Do not compile if done previously.
"RTN","SDECAUD",48,0)
    ;
"RTN","SDECAUD",49,0)
    I $D(^SDAUDIT("C",DATE)) Q  ;
"RTN","SDECAUD",50,0)
    ;
"RTN","SDECAUD",51,0)
    ;  Loop thru date/user cross-reference in the SDEC APPT REQUEST file (#409.85) and count APPT and MRTC Requests opened.
"RTN","SDECAUD",52,0)
    ;
"RTN","SDECAUD",53,0)
    S D1=DATE-.001 F  S D1=$O(^SDEC(409.85,"AC",D1)) Q:'D1  Q:D1\1'=DATE  D  ;
"RTN","SDECAUD",54,0)
    .   ;
"RTN","SDECAUD",55,0)
    .   S CLERK=0 F  S CLERK=$O(^SDEC(409.85,"AC",D1,CLERK)) Q:'CLERK  D  ;
"RTN","SDECAUD",56,0)
    ..  ;
"RTN","SDECAUD",57,0)
    ..  ; Initialize statistics counters for the user.
"RTN","SDECAUD",58,0)
    ..  ;
"RTN","SDECAUD",59,0)
    ..  I '$D(^TMP($J,CLERK,DATE)) S ^TMP($J,CLERK,DATE)="0^0^0^0^0^0^0^0^0^0^0^0^0" ;
"RTN","SDECAUD",60,0)
    ..  ;
"RTN","SDECAUD",61,0)
    ..  S DA=0 F  S DA=$O(^SDEC(409.85,"AC",D1,CLERK,DA)) Q:'DA  S X=^SDEC(409.85,DA,0) D  ;
"RTN","SDECAUD",62,0)
    ... ;
"RTN","SDECAUD",63,0)
    ... ;  Parse request data
"RTN","SDECAUD",64,0)
    ... ;
"RTN","SDECAUD",65,0)
    ... S TYPE=$P(X,"^",5),APPTDATE=$P(X,"^",23),STATUS=$P(X,"^",17) ;
"RTN","SDECAUD",66,0)
    ... S MRTC=+$P($G(^SDEC(409.85,DA,3)),"^",1) ;
"RTN","SDECAUD",67,0)
    ... ;
"RTN","SDECAUD",68,0)
    ... ;  APPT request made
"RTN","SDECAUD",69,0)
    ... ;
"RTN","SDECAUD",70,0)
    ... I TYPE="APPT",MRTC=0 S $P(^(DATE),"^",2)=$P(^TMP($J,CLERK,DATE),"^",2)+1 ;
"RTN","SDECAUD",71,0)
    ... ;
"RTN","SDECAUD",72,0)
    ... ;  MRTC request
"RTN","SDECAUD",73,0)
    ... ;
"RTN","SDECAUD",74,0)
    ... I MRTC=1 S $P(^(DATE),"^",5)=$P(^TMP($J,CLERK,DATE),"^",5)+1 ;
"RTN","SDECAUD",75,0)
    ;
"RTN","SDECAUD",76,0)
    ;    Loop thru date/user cross-reference in the RECALL REMINDERS file (#403.5) and count PtCSch entries added.
"RTN","SDECAUD",77,0)
    ;
"RTN","SDECAUD",78,0)
    S D1=DATE-.001 F  S D1=$O(^SD(403.5,"AC",D1)) Q:'D1  Q:D1\1'=DATE  D  ;
"RTN","SDECAUD",79,0)
    .   ;
"RTN","SDECAUD",80,0)
    .   S CLERK=0 F  S CLERK=$O(^SD(403.5,"AC",D1,CLERK)) Q:'CLERK  D  ;
"RTN","SDECAUD",81,0)
    ..  ;
"RTN","SDECAUD",82,0)
    ..  I '$D(^TMP($J,CLERK,DATE)) S ^TMP($J,CLERK,DATE)="0^0^0^0^0^0^0^0^0^0^0^0^0" ;
"RTN","SDECAUD",83,0)
    ..  S $P(^(DATE),"^",10)=$P(^TMP($J,CLERK,DATE),"^",10)+1 ;
"RTN","SDECAUD",84,0)
    ;
"RTN","SDECAUD",85,0)
    ;    Loop thru date/user cross-reference in the SD WAIT LIST file (#409.3) and count EWL entries made.
"RTN","SDECAUD",86,0)
    ;
"RTN","SDECAUD",87,0)
    S D1=DATE-.001 F  S D1=$O(^SDWL(409.3,"AC",D1)) Q:'D1  Q:D1\1'=DATE  D  ;
"RTN","SDECAUD",88,0)
    .   ;
"RTN","SDECAUD",89,0)
    .   S CLERK=0 F  S CLERK=$O(^SDWL(409.3,"AC",D1,CLERK)) Q:'CLERK  D  ;
"RTN","SDECAUD",90,0)
    ..  ;
"RTN","SDECAUD",91,0)
    ..  I '$D(^TMP($J,CLERK,DATE)) S ^TMP($J,CLERK,DATE)="0^0^0^0^0^0^0^0^0^0^0^0^0" ;
"RTN","SDECAUD",92,0)
    ..  S $P(^(DATE),"^",7)=$P(^TMP($J,CLERK,DATE),"^",7)+1 ;
"RTN","SDECAUD",93,0)
    ;
"RTN","SDECAUD",94,0)
    ;   Loop thru date appointment made cross-reference in the SDEC APPOINTMENT file (#409.84) and count appointments
"RTN","SDECAUD",95,0)
    ;   made by type (EWL, Consult, PtCSch, APPT).  Increment request closed for each appointment made.
"RTN","SDECAUD",96,0)
    ;
"RTN","SDECAUD",97,0)
    S DA=0 F  S DA=$O(^SDEC(409.84,"AC",DATE,DA)) Q:'DA  S CLERK=$P(^SDEC(409.84,DA,0),"^",8),TYPE=$P($G(^SDEC(409.84,DA,2)),"^",1) D  ;
"RTN","SDECAUD",98,0)
    .   ;
"RTN","SDECAUD",99,0)
    .   Q:CLERK=""  ;  Skip if data missing
"RTN","SDECAUD",100,0)
    .   ;
"RTN","SDECAUD",101,0)
    .   S PIECE=$S($P(TYPE,";",2)="SDWL(409.3,":8,$P(TYPE,";",2)="GMR(123,":12,$P(TYPE,";",2)="SD(403.5,":11,$P(TYPE,";",2)="SDEC(409.85,":3,1:0) ;
"RTN","SDECAUD",102,0)
    .   Q:'PIECE  ;
"RTN","SDECAUD",103,0)
    .   I '$D(^TMP($J,CLERK,DATE)) S ^TMP($J,CLERK,DATE)="0^0^0^0^0^0^0^0^0^0^0^0^0" ;
"RTN","SDECAUD",104,0)
    .   ;
"RTN","SDECAUD",105,0)
    .   ;  Update appointment made.
"RTN","SDECAUD",106,0)
    .   ;
"RTN","SDECAUD",107,0)
    .   S $P(^(DATE),"^",PIECE)=$P(^TMP($J,CLERK,DATE),"^",PIECE)+1 ;
"RTN","SDECAUD",108,0)
    .   ;
"RTN","SDECAUD",109,0)
    .   ;  Update APPT or EWL request closed.
"RTN","SDECAUD",110,0)
    .   ;
"RTN","SDECAUD",111,0)
    .   S PIECE=$S($P(TYPE,";",2)="SDWL(409.3,":9,$P(TYPE,";",2)="SDEC(409.85,":4,1:0) Q:'PIECE  ;
"RTN","SDECAUD",112,0)
    .   ;
"RTN","SDECAUD",113,0)
    .   ;  Determine if APPT request is MRTC
"RTN","SDECAUD",114,0)
    .   ;
"RTN","SDECAUD",115,0)
    .   I $P(TYPE,";",2)="SDEC(409.85," S PTR=$P(TYPE,";",1),MRTC=+$P($G(^SDEC(409.85,PTR,3)),"^",1) I MRTC S PIECE=6 ;
"RTN","SDECAUD",116,0)
    .   ;
"RTN","SDECAUD",117,0)
    .   ;  Update request closed
"RTN","SDECAUD",118,0)
    .   ;
"RTN","SDECAUD",119,0)
    .   S $P(^(DATE),"^",PIECE)=$P(^TMP($J,CLERK,DATE),"^",PIECE)+1 ;
"RTN","SDECAUD",120,0)
    ;
"RTN","SDECAUD",121,0)
    ;    Loop thru date appointment cancelled cross-reference in the SDEC APPOINTMENT file (#409.84) and count cancellations.
"RTN","SDECAUD",122,0)
    ;
"RTN","SDECAUD",123,0)
    S D1=DATE-.001 F  S D1=$O(^SDEC(409.84,"AD",D1)) Q:'D1  Q:D1\1'=DATE  D  ;
"RTN","SDECAUD",124,0)
    .   ;
"RTN","SDECAUD",125,0)
    .   S DA=0 F  S DA=$O(^SDEC(409.84,"AD",D1,DA)) Q:'DA  S CLERK=$P(^SDEC(409.84,DA,0),"^",21) D  ;
"RTN","SDECAUD",126,0)
    ..  ;
"RTN","SDECAUD",127,0)
    ..  Q:CLERK=""  ;  Skip if data is missing
"RTN","SDECAUD",128,0)
    ..  ;
"RTN","SDECAUD",129,0)
    ..  I '$D(^TMP($J,CLERK,DATE)) S ^TMP($J,CLERK,DATE)="0^0^0^0^0^0^0^0^0^0^0^0^0" ;
"RTN","SDECAUD",130,0)
    ..  S $P(^(DATE),"^",13)=$P(^TMP($J,CLERK,DATE),"^",13)+1 ;
"RTN","SDECAUD",131,0)
    ;
"RTN","SDECAUD",132,0)
    ;    Loop thru date/time-user cross-reference in SDEC CONTACTS file (#409.86) and count contacts.
"RTN","SDECAUD",133,0)
    ;
"RTN","SDECAUD",134,0)
    S D1=DATE-.001 F  S D1=$O(^SDEC(409.86,"AD",D1)) Q:'D1  Q:D1\1'=DATE  D  ;
"RTN","SDECAUD",135,0)
    .   ;
"RTN","SDECAUD",136,0)
    .   S CLERK=0 F  S CLERK=$O(^SDEC(409.86,"AD",D1,CLERK)) Q:'CLERK  D  ;
"RTN","SDECAUD",137,0)
    ..  ;
"RTN","SDECAUD",138,0)
    ..  S DA=0 F  S DA=$O(^SDEC(409.86,"AD",D1,CLERK,DA)) Q:'DA  D  ;
"RTN","SDECAUD",139,0)
    ... S DA1=0 F  S DA1=$O(^SDEC(409.86,"AD",D1,CLERK,DA,DA1)) Q:'DA1  D  ;
"RTN","SDECAUD",140,0)
    ....    I '$D(^TMP($J,CLERK,DATE)) S ^TMP($J,CLERK,DATE)="0^0^0^0^0^0^0^0^0^0^0^0^0" ;
"RTN","SDECAUD",141,0)
    ....    S $P(^(DATE),"^",1)=$P(^TMP($J,CLERK,DATE),"^",1)+1 ;
"RTN","SDECAUD",142,0)
    ;
"RTN","SDECAUD",143,0)
    ;
"RTN","SDECAUD",144,0)
    ;  Update the SD Audit Statistics file (#409.97)
"RTN","SDECAUD",145,0)
    ;
"RTN","SDECAUD",146,0)
    S GLOBAL=^DIC(409.97,0,"GL") ;
"RTN","SDECAUD",147,0)
    S CLERK=0 F  S CLERK=$O(^TMP($J,CLERK)) Q:'CLERK  D  ;
"RTN","SDECAUD",148,0)
    .   ;
"RTN","SDECAUD",149,0)
    .   K DO S DIC=GLOBAL,DIC(0)="FL",DLAYGO="409.97",X=CLERK,DIC("DR")="1////"_DATE ;
"RTN","SDECAUD",150,0)
    .   F FLD=2:1:14 S DIC("DR")=DIC("DR")_";"_FLD_"////"_$P(^TMP($J,CLERK,DATE),"^",FLD-1) ;
"RTN","SDECAUD",151,0)
    .   D FILE^DICN ;
"RTN","SDECAUD",152,0)
    ;
"RTN","SDECAUD",153,0)
    K ^TMP($J) ;
"RTN","SDECAUD",154,0)
    ;
"RTN","SDECAUD",155,0)
    Q  ;
"RTN","SDECAUD",156,0)
    ;
"RTN","SDECAUD",157,0)
    ;*zeb+tag 2/28/18 686 return compiled data
"RTN","SDECAUD",158,0)
    ;--------------------
"RTN","SDECAUD",159,0)
    ;SUMMGET2 - Return compiled Audit Report data via RPC
"RTN","SDECAUD",160,0)
    ;--------------------
"RTN","SDECAUD",161,0)
    ;Parameters
"RTN","SDECAUD",162,0)
    ;----------
"RTN","SDECAUD",163,0)
    ;SDECRET - global reference to array with return values
"RTN","SDECAUD",164,0)
    ;SDBEG   - start date for reporting; defaults to 1/2/1841
"RTN","SDECAUD",165,0)
    ;SDEND   - end date for reporting; defaults to 10/15/2114
"RTN","SDECAUD",166,0)
    ;USER    - IEN of a user to report on; defaults to all users
"RTN","SDECAUD",167,0)
    ;----------
"RTN","SDECAUD",168,0)
    ;Returns (one row for each user)
"RTN","SDECAUD",169,0)
    ;----------
"RTN","SDECAUD",170,0)
    ;USERIEN  - user's IEN
"RTN","SDECAUD",171,0)
    ;USERNAME - user's name
"RTN","SDECAUD",172,0)
    ;CONTACTS - number of patient contacts
"RTN","SDECAUD",173,0)
    ;APPTOPEN - number of APPT requests opened
"RTN","SDECAUD",174,0)
    ;APPTMADE - number of appointments made for APPT requests
"RTN","SDECAUD",175,0)
    ;APPTCLSD - number of APPT requests closed
"RTN","SDECAUD",176,0)
    ;MRTCOPEN - number of MRTC requests opened
"RTN","SDECAUD",177,0)
    ;MRTCCLSD - number of MRTC requests closed
"RTN","SDECAUD",178,0)
    ;EWLOPEN  - number of EWL requests opened
"RTN","SDECAUD",179,0)
    ;EWLMADE  - number of appointments made for EWL requests
"RTN","SDECAUD",180,0)
    ;EWLCLSD  - number of EWL requests closed
"RTN","SDECAUD",181,0)
    ;PTCSOPEN - number of PtCSch requests opened
"RTN","SDECAUD",182,0)
    ;PTCSMADE - number of appointments made for PtCSch requests
"RTN","SDECAUD",183,0)
    ;CNSLTMD  - number of appointments made for consults
"RTN","SDECAUD",184,0)
    ;APPTCXLD - number of appointments canceled
"RTN","SDECAUD",185,0)
    ;ACTIONS  - total number of actions
"RTN","SDECAUD",186,0)
SUMMGET2(SDECRET,SDBEG,SDEND,USER)  ;Get compiled Audit Report for a given date range
"RTN","SDECAUD",187,0)
 N X,Y,%DT,U,X1,X2
"RTN","SDECAUD",188,0)
 N SDTMP,SDECLN,SDSTATS,SDPC,SDDT,SDASIEN,SDASDATA
"RTN","SDECAUD",189,0)
 S U="^"
"RTN","SDECAUD",190,0)
 ;translate dates to FM format
"RTN","SDECAUD",191,0)
 I SDBEG]"" S %DT="" S X=$P(SDBEG,"@",1) D ^%DT S SDBEG=Y S:Y=-1 SDBEG=1410102 I 1
"RTN","SDECAUD",192,0)
 E  S SDBEG=1410102 ;default begin date
"RTN","SDECAUD",193,0)
 I SDEND]"" S %DT="" S X=$P(SDEND,"@",1) D ^%DT S SDEND=Y S:Y=-1 SDEND=4141015 I 1
"RTN","SDECAUD",194,0)
 E  S SDEND=4141015 ;default end date
"RTN","SDECAUD",195,0)
 ;check user
"RTN","SDECAUD",196,0)
 I USER]"",'$D(^VA(200,+USER,0)) S USER=""
"RTN","SDECAUD",197,0)
 ;set up return array
"RTN","SDECAUD",198,0)
 S SDECRET="^TMP(""SDECAUD"","_$J_",""SUMMGET2"")"  ;global reference to return array
"RTN","SDECAUD",199,0)
 K @SDECRET
"RTN","SDECAUD",200,0)
 S SDECLN=0
"RTN","SDECAUD",201,0)
 ;set up column headers for return array
"RTN","SDECAUD",202,0)
 ;              1             2              3              4               5             6
"RTN","SDECAUD",203,0)
 S SDTMP="T00030USERIEN^T00030USERNAME^T00030CONTACTS^T00030APPTOPEN^T00030APPTMADE^T00030APPTCLSD"
"RTN","SDECAUD",204,0)
 ;                     7              8              9             10            11
"RTN","SDECAUD",205,0)
 S SDTMP=SDTMP_"^T00030MRTCOPEN^T00030MRTCCLSD^T00030EWLOPEN^T00030EWLMADE^T00030EWLCLSD"
"RTN","SDECAUD",206,0)
 ;                     12             13             14            15             16
"RTN","SDECAUD",207,0)
 S SDTMP=SDTMP_"^T00030PTCSOPEN^T00030PTCSMADE^T00030CNSLTMD^T00030APPTCXLD^T00030ACTIONS"
"RTN","SDECAUD",208,0)
 S @SDECRET@(SDECLN)=SDTMP_$C(30)
"RTN","SDECAUD",209,0)
 ;if a single user is specified, loop over x-ref for dates for that user
"RTN","SDECAUD",210,0)
 I USER]"" D  I 1
"RTN","SDECAUD",211,0)
 .S SDSTATS="0^0^0^0^0^0^0^0^0^0^0^0^0^0"
"RTN","SDECAUD",212,0)
 .S X1=SDBEG,X2=-1 D C^%DTC S SDDT=X
"RTN","SDECAUD",213,0)
 .F  S SDDT=$O(^SDAUDIT("E",USER,SDDT)) Q:SDDT=""  Q:SDDT>SDEND  D
"RTN","SDECAUD",214,0)
 ..S SDASIEN=""
"RTN","SDECAUD",215,0)
 ..F  S SDASIEN=$O(^SDAUDIT("E",USER,SDDT,SDASIEN)) Q:SDASIEN=""  D
"RTN","SDECAUD",216,0)
 ...S SDASDATA=^SDAUDIT(SDASIEN,0)
"RTN","SDECAUD",217,0)
 ...S $P(SDASDATA,U,16)=$$GET1^DIQ(409.97,SDASIEN_",",15) ;field 15 is computed, so isn't in global
"RTN","SDECAUD",218,0)
 ...F SDPC=1:1:14 S $P(SDSTATS,U,SDPC)=$P(SDSTATS,U,SDPC)+$P(SDASDATA,U,SDPC+2)
"RTN","SDECAUD",219,0)
 .S SDECLN=SDECLN+1
"RTN","SDECAUD",220,0)
 .S SDTMP=USER_U_$$GET1^DIQ(200,USER_",",.01)_U_SDSTATS
"RTN","SDECAUD",221,0)
 .S @SDECRET@(SDECLN)=SDTMP_$C(30)
"RTN","SDECAUD",222,0)
 ;otherwise, loop over x-ref for users for those dates
"RTN","SDECAUD",223,0)
 E  D
"RTN","SDECAUD",224,0)
 .F  S USER=$O(^SDAUDIT("E",USER)) Q:USER=""  D
"RTN","SDECAUD",225,0)
 ..S SDSTATS="0^0^0^0^0^0^0^0^0^0^0^0^0^0"
"RTN","SDECAUD",226,0)
 ..S X1=SDBEG,X2=-1 D C^%DTC S SDDT=X
"RTN","SDECAUD",227,0)
 ..F  S SDDT=$O(^SDAUDIT("E",USER,SDDT)) Q:SDDT=""  Q:SDDT>SDEND  D
"RTN","SDECAUD",228,0)
 ...S SDASIEN=""
"RTN","SDECAUD",229,0)
 ...F  S SDASIEN=$O(^SDAUDIT("E",USER,SDDT,SDASIEN)) Q:SDASIEN=""  D
"RTN","SDECAUD",230,0)
 ....S SDASDATA=^SDAUDIT(SDASIEN,0)
"RTN","SDECAUD",231,0)
 ....S $P(SDASDATA,U,16)=$$GET1^DIQ(409.97,SDASIEN_",",15) ;field 15 is computed, so isn't in global
"RTN","SDECAUD",232,0)
 ....F SDPC=1:1:14 S $P(SDSTATS,U,SDPC)=$P(SDSTATS,U,SDPC)+$P(SDASDATA,U,SDPC+2)
"RTN","SDECAUD",233,0)
 ..Q:SDSTATS="0^0^0^0^0^0^0^0^0^0^0^0^0^0"  ;don't send back if user has no data to send
"RTN","SDECAUD",234,0)
 ..S SDECLN=SDECLN+1
"RTN","SDECAUD",235,0)
 ..S SDTMP=USER_U_$$GET1^DIQ(200,USER_",",.01)_U_SDSTATS
"RTN","SDECAUD",236,0)
 ..S @SDECRET@(SDECLN)=SDTMP_$C(30)
"RTN","SDECAUD",237,0)
 Q
"RTN","SDECCON")
0^4^B17988891^B15794027
"RTN","SDECCON",1,0)
SDECCON ;SPFO/DMR SCHEDULING ENHANCEMENTS VSE CONTACT API
"RTN","SDECCON",2,0)
 ;;5.3;Scheduling;**669,686**;Aug 13 1993;Build 53
"RTN","SDECCON",3,0)
 ;
"RTN","SDECCON",4,0)
 ;This API provides SDEC CONTACT(#409.86)file information to the VSE VS GUI.
"RTN","SDECCON",5,0)
 ; 3/6/18 - wtc/zeb Added new cross-reference for audit statistics compiler.  Patch 686
"RTN","SDECCON",6,0)
 ;
"RTN","SDECCON",7,0)
 Q
"RTN","SDECCON",8,0)
DISPLAY(RTU,DFN,CLN,PDT,REQT,SER) ;
"RTN","SDECCON",9,0)
 Q:'$G(DFN)
"RTN","SDECCON",10,0)
 Q:'$G(PDT)
"RTN","SDECCON",11,0)
 Q:'$D(REQT)
"RTN","SDECCON",12,0)
 S (CC,CC1,CC2,REC)=""
"RTN","SDECCON",13,0)
 ;
"RTN","SDECCON",14,0)
 S CC="" F  S CC=$O(^SDEC(409.86,"B",DFN,CC)) Q:CC=""  D
"RTN","SDECCON",15,0)
 .S REC="" S REC=^SDEC(409.86,CC,0)
"RTN","SDECCON",16,0)
 .Q:PDT'=$P($G(REC),"^",3)
"RTN","SDECCON",17,0)
 .I $G(CLN)'="" Q:$G(CLN)'=$P($G(REC),"^",2)
"RTN","SDECCON",18,0)
 .I $G(SER)'="" Q:$G(SER)'=$P($G(REC),"^",6)
"RTN","SDECCON",19,0)
 .Q:REQT'=$P($G(REC),"^",4)
"RTN","SDECCON",20,0)
 .S RTU=CC_"^"_REC
"RTN","SDECCON",21,0)
 .Q
"RTN","SDECCON",22,0)
 D EXIT
"RTN","SDECCON",23,0)
 Q
"RTN","SDECCON",24,0)
DISMULT(RTT,CIEN) ;
"RTN","SDECCON",25,0)
 Q:'$G(CIEN)
"RTN","SDECCON",26,0)
 ;
"RTN","SDECCON",27,0)
 S (CC1,CC2,REC1,REC2,RTT,ENDT)=""
"RTN","SDECCON",28,0)
 ;
"RTN","SDECCON",29,0)
 S CC2="" F  S CC2=$O(^SDEC(409.86,CIEN,1,CC2)) Q:CC2=""  D
"RTN","SDECCON",30,0)
 .S REC2="" S REC2=$G(^SDEC(409.86,CIEN,1,CC2,1)) Q:REC2=""  D
"RTN","SDECCON",31,0)
 ..S ENDT="" S ENDT=$P($G(^SDEC(409.86,CIEN,1,CC2,0)),"^",1)
"RTN","SDECCON",32,0)
 ..S (ENTU,ENTUN)="" S ENTUN=$P(REC2,"^",5) I ENTUN>0 D
"RTN","SDECCON",33,0)
 ...S ENTU=$$GET1^DIQ(200,ENTUN,.01,"E")
"RTN","SDECCON",34,0)
 ..S RTT=RTT_CC1_"^"_REC2_"^"_ENTU_"^"_ENDT_";"
"RTN","SDECCON",35,0)
 ..Q
"RTN","SDECCON",36,0)
 D EXIT
"RTN","SDECCON",37,0)
 Q
"RTN","SDECCON",38,0)
 ;
"RTN","SDECCON",39,0)
NEW(RET,DFN,CLI,DTP,REQT,SRV,DTCON,CONT,COM,DTENT) ;
"RTN","SDECCON",40,0)
 Q:'$G(DFN)
"RTN","SDECCON",41,0)
 Q:'$G(DTP)
"RTN","SDECCON",42,0)
 Q:'$D(REQT)
"RTN","SDECCON",43,0)
 Q:'$G(DTCON)
"RTN","SDECCON",44,0)
 Q:'$D(CONT)
"RTN","SDECCON",45,0)
 Q:'$G(DTENT)
"RTN","SDECCON",46,0)
 I '$D(COM) S COM=""
"RTN","SDECCON",47,0)
 I '$G(CLI) S CLI=""
"RTN","SDECCON",48,0)
 I '$G(SRV) S SRV=""
"RTN","SDECCON",49,0)
 ;
"RTN","SDECCON",50,0)
 S (DFN2,CC1,CC2)=""
"RTN","SDECCON",51,0)
 ;
"RTN","SDECCON",52,0)
 S DFN2="" F  S DFN2=$O(^SDEC(409.86,"B",DFN2)) Q:DFN2=""  D
"RTN","SDECCON",53,0)
 .S CC1="" F  S CC1=$O(^SDEC(409.86,"B",DFN2,CC1)) Q:CC1=""  D
"RTN","SDECCON",54,0)
 ..S CC2=CC2+1
"RTN","SDECCON",55,0)
 ..Q
"RTN","SDECCON",56,0)
 S CC2=CC2+1 D
"RTN","SDECCON",57,0)
 .S ^SDEC(409.86,0)="SDEC CONTACT^409.86P^"_CC2_"^"_CC2
"RTN","SDECCON",58,0)
 .S ^SDEC(409.86,CC2,0)=DFN_"^"_CLI_"^"_DTP_"^"_REQT_"^"_1_SRV
"RTN","SDECCON",59,0)
 .S ^SDEC(409.86,CC2,1,0)="^409.863D^1^1"
"RTN","SDECCON",60,0)
 .S ^SDEC(409.86,CC2,1,1,0)=DTCON
"RTN","SDECCON",61,0)
 .S ^SDEC(409.86,CC2,1,1,1)=CONT_"^"_COM_"^"_0_"^"_1_"^"_DUZ_"^"_DTENT
"RTN","SDECCON",62,0)
 .S ^SDEC(409.86,"B",DFN,CC2)=""
"RTN","SDECCON",63,0)
 .S ^SDEC(409.86,CC2,1,"B",DTCON,1)=""
"RTN","SDECCON",64,0)
 .S ^SDEC(409.86,"AD",DTENT,DUZ,CC2,1)="" ;  3/6/18 WTC/ZEB create date/user cross-reference.
"RTN","SDECCON",65,0)
 .Q
"RTN","SDECCON",66,0)
 D EXIT
"RTN","SDECCON",67,0)
 Q
"RTN","SDECCON",68,0)
SEQ(RE1,DF1,CL1,PDATE,RTYPE,SRR) ;
"RTN","SDECCON",69,0)
 Q:'$G(DF1)
"RTN","SDECCON",70,0)
 Q:'$G(PDATE)
"RTN","SDECCON",71,0)
 I '$G(CL1) S CL1=""
"RTN","SDECCON",72,0)
 I '$G(SRR) S SRR=""
"RTN","SDECCON",73,0)
 ;
"RTN","SDECCON",74,0)
 S (JJ,JJ1,RCD,SQU,DF2)=""
"RTN","SDECCON",75,0)
 ;
"RTN","SDECCON",76,0)
 S JJ="" F  S JJ=$O(^SDEC(409.86,"B",DF1,JJ)) Q:JJ=""  D
"RTN","SDECCON",77,0)
 .S RCD="" S RCD=$G(^SDEC(409.86,JJ,0)) Q:RCD=""  D
"RTN","SDECCON",78,0)
 ..S SQU="" S SQU=$P($G(^SDEC(409.86,JJ,1,0)),"^",3) D
"RTN","SDECCON",79,0)
 ...Q:$G(SQU)=""
"RTN","SDECCON",80,0)
 ...Q:PDATE'=$P($G(RCD),"^",3)
"RTN","SDECCON",81,0)
 ...Q:RTYPE'=$P($G(RCD),"^",4)
"RTN","SDECCON",82,0)
 ...I $P($G(RCD),"^",2)=CL1 D
"RTN","SDECCON",83,0)
 ....S $P(^SDEC(409.86,JJ,0),"^",5)=SQU+1
"RTN","SDECCON",84,0)
 ....S RE1=SQU+1
"RTN","SDECCON",85,0)
 ....Q
"RTN","SDECCON",86,0)
 ...I $P($G(RCD),"^",6)=SRR D
"RTN","SDECCON",87,0)
 ....S $P(^SDEC(409.86,JJ,0),"^",5)=SQU+1
"RTN","SDECCON",88,0)
 ....S RE1=SQU+1
"RTN","SDECCON",89,0)
 ....Q
"RTN","SDECCON",90,0)
 D EXIT
"RTN","SDECCON",91,0)
 Q
"RTN","SDECCON",92,0)
UPDATE(RTT,IEN,CONDT,CTYPE,COMM,DTEN) ;
"RTN","SDECCON",93,0)
 Q:'$G(IEN)
"RTN","SDECCON",94,0)
 Q:'$G(CONDT)
"RTN","SDECCON",95,0)
 Q:'$D(CTYPE) 
"RTN","SDECCON",96,0)
 I '$D(COMM) S COMM=""
"RTN","SDECCON",97,0)
 I '$G(DTEN) S DTEN=""
"RTN","SDECCON",98,0)
 ;
"RTN","SDECCON",99,0)
 S (MULT,RTT,CC,CCC,COUNT,MULTN)=""
"RTN","SDECCON",100,0)
 ;
"RTN","SDECCON",101,0)
 S MULT="" S MULT=$G(^SDEC(409.86,IEN,1,0)) I MULT'="" D
"RTN","SDECCON",102,0)
 .S MULTN=$P(MULT,"^",4) I MULTN'="" D
"RTN","SDECCON",103,0)
 ..S COUNT=MULTN
"RTN","SDECCON",104,0)
 .Q
"RTN","SDECCON",105,0)
 I COUNT'="" S COUNT=COUNT+1 D
"RTN","SDECCON",106,0)
 .S ^SDEC(409.86,IEN,1,0)="^409.863D^"_COUNT_"^"_COUNT
"RTN","SDECCON",107,0)
 .S ^SDEC(409.86,IEN,1,COUNT,0)=CONDT
"RTN","SDECCON",108,0)
 .S ^SDEC(409.86,IEN,1,COUNT,1)=CTYPE_"^"_COMM_"^"_0_"^"_COUNT_"^"_DUZ_"^"_DTEN
"RTN","SDECCON",109,0)
 .S ^SDEC(409.86,IEN,1,"B",CONDT,COUNT)=""
"RTN","SDECCON",110,0)
 .S ^SDEC(409.86,"AD",DTEN,DUZ,IEN,COUNT)="" ;  3/6/18 WTC/ZEB create date/user cross-reference.
"RTN","SDECCON",111,0)
 .Q
"RTN","SDECCON",112,0)
 D EXIT
"RTN","SDECCON",113,0)
 Q 
"RTN","SDECCON",114,0)
GETSTC(RET,CLIEN) ;
"RTN","SDECCON",115,0)
 Q:CLIEN=""
"RTN","SDECCON",116,0)
 ;
"RTN","SDECCON",117,0)
 ;CLIEN=Clinic IEN
"RTN","SDECCON",118,0)
 ;HLF0=Hospital Location File 0 node
"RTN","SDECCON",119,0)
 ;SNUM=Stopc Code IEN [0,7]
"RTN","SDECCON",120,0)
 ;STPC=Stop Code 40.7
"RTN","SDECCON",121,0)
 ;CSNUM=Credit Stop IEN [0,18]
"RTN","SDECCON",122,0)
 ;CSTPC=Credit Stop Code 40.7
"RTN","SDECCON",123,0)
 ;
"RTN","SDECCON",124,0)
 S (HLF0,SNUM,STPC,CSNUM,CSTPC)=""
"RTN","SDECCON",125,0)
 ;
"RTN","SDECCON",126,0)
 S HLF0=$G(^SC(CLIEN,0)) I HLF0'="" D
"RTN","SDECCON",127,0)
 .S SNUM=$P($G(HLF0),"^",7) I SNUM'="" D
"RTN","SDECCON",128,0)
 ..S STPC=$$GET1^DIQ(40.7,SNUM,1)
"RTN","SDECCON",129,0)
 .S CNUM=$P($G(HLF0),"^",18) I CNUM'="" D
"RTN","SDECCON",130,0)
 ..S CSTPC=$$GET1^DIQ(40.7,CNUM,1)
"RTN","SDECCON",131,0)
 S RET=STPC_"^"_CSTPC
"RTN","SDECCON",132,0)
 K HLF0,SNUM,STPC,CSNUM,CSTPC
"RTN","SDECCON",133,0)
 Q
"RTN","SDECCON",134,0)
EXIT ;
"RTN","SDECCON",135,0)
 K MULT,CC,CCC,COUNT,COMM,DTEN,ENDT
"RTN","SDECCON",136,0)
 K JJ,JJ1,RCD,SQU,DF2,DFN2,CC1,CC2,RCD,SQU
"RTN","SDECCON",137,0)
 K REC1,REC2,ENDT,MULTN,CLN,PDT,REQT,SER
"RTN","SDECCON",138,0)
 Q
"RTN","SDECLK")
0^6^B22769738^B9204662
"RTN","SDECLK",1,0)
SDECLK ;ALB/SAT - VISTA SCHEDULING RPCS ;JAN 15, 2016
"RTN","SDECLK",2,0)
 ;;5.3;Scheduling;**627,686**;Aug 13, 1993;Build 53
"RTN","SDECLK",3,0)
 ;
"RTN","SDECLK",4,0)
 Q
"RTN","SDECLK",5,0)
 ;
"RTN","SDECLK",6,0)
LOCK(SDECY,REQ) ; -- Attempt to lock request record
"RTN","SDECLK",7,0)
 ;INPUT:
"RTN","SDECLK",8,0)
 ; REQ = Request - (required) Appt Request type - variable pointer pointer
"RTN","SDECLK",9,0)
 ;                            to one of these files:
"RTN","SDECLK",10,0)
 ;                         SDEC APPT REQUEST    - A|<APPT IEN>     A|123
"RTN","SDECLK",11,0)
 ;                         SD WAIT LIST         - E|<WL IEN>       E|123
"RTN","SDECLK",12,0)
 ;                         REQUEST/CONSULTATION - C|<CONSULT IEN>  C|123
"RTN","SDECLK",13,0)
 ;                         RECALL REMINDERS     - R|^<RECALL IEN>  R|123
"RTN","SDECLK",14,0)
 ;RETURN:
"RTN","SDECLK",15,0)
 ; A single entry in the global array indicating the success/failure of getting the lock:
"RTN","SDECLK",16,0)
 ;   1. CODE    -  1 if successful, or 0^Message if could not get lock
"RTN","SDECLK",17,0)
 ;   2. MESSAGE -  Message Text
"RTN","SDECLK",18,0)
 N RET,SDI,SDTYP,SDIEN
"RTN","SDECLK",19,0)
 N Y,SDECLK,NOW,NOW1
"RTN","SDECLK",20,0)
 S SDECY="^TMP(""SDEC"","_$J_")"
"RTN","SDECLK",21,0)
 K @SDECY
"RTN","SDECLK",22,0)
 S @SDECY@(0)="T00030CODE^T00030MESSAGE"_$C(30)
"RTN","SDECLK",23,0)
 I $G(REQ)="" S RET="0^Invalid Request input"_$C(30,31) Q
"RTN","SDECLK",24,0)
 S SDTYP=$P(REQ,"|",1) I "ACER"'[SDTYP S @SDECY@(1)="0^Invalid Request Type"_$C(30,31) Q
"RTN","SDECLK",25,0)
 S SDIEN=$P(REQ,"|",2) I SDIEN'?1.N S @SDECY@(1)="0^Invalid Request ID"_$C(30,31) Q
"RTN","SDECLK",26,0)
 S SDECLK=$G(^XTMP("SDECLK"_SDTYP_"-"_SDIEN,1)) I $P(SDECLK,U,1)=DUZ S @SDECY@(1)="1^You already have the lock"_$C(30,31) Q  ;*zeb 3/15/18 return this result for user for any $J
"RTN","SDECLK",27,0)
 L +^XTMP("SDECLK"_SDTYP_"-"_SDIEN):5 I '$T S @SDECY@(1)="0^"_$S(+SDECLK:$P($G(^VA(200,+SDECLK,0)),U),1:"Another person")_" is editing this request."_$C(30,31) Q
"RTN","SDECLK",28,0)
 I SDECLK,$P(SDECLK,U,1)'=DUZ S @SDECY@(1)="0^"_$S(+SDECLK:$P($G(^VA(200,+SDECLK,0)),U),1:"Another person")_" is editing this request."_$C(30,31) L -^XTMP("SDECLK"_SDTYP_"-"_SDIEN) Q  ;*zeb 3/15/18 respect locks from other users
"RTN","SDECLK",29,0)
 ;unlock user's previous locks
"RTN","SDECLK",30,0)
 S SDI="SDECLK" F  S SDI=$O(^XTMP(SDI)) Q:SDI'["SDECLK"  Q:SDI=""  D
"RTN","SDECLK",31,0)
 .I ($P($G(^XTMP(SDI,1)),U,1)=DUZ)!($P($G(^XTMP(SDI,1)),U,1)="") D
"RTN","SDECLK",32,0)
 ..L +^XTMP(SDI):5 ;*zeb+1 3/15/18 fix handling of system locks
"RTN","SDECLK",33,0)
 ..Q:'$T
"RTN","SDECLK",34,0)
 ..K ^XTMP(SDI)
"RTN","SDECLK",35,0)
 ..L -^XTMP(SDI)
"RTN","SDECLK",36,0)
 S NOW=$$NOW^XLFDT,NOW1=$$FMADD^XLFDT(NOW,1)
"RTN","SDECLK",37,0)
 S ^XTMP("SDECLK"_SDTYP_"-"_SDIEN,0)=NOW1_U_NOW_"^VSE GUI Request Lock"
"RTN","SDECLK",38,0)
 S ^XTMP("SDECLK"_SDTYP_"-"_SDIEN,1)=DUZ_U_$J
"RTN","SDECLK",39,0)
 S @SDECY@(1)="1^Lock successful"_$C(30,31)
"RTN","SDECLK",40,0)
 L -^XTMP("SDECLK"_SDTYP_"-"_SDIEN) ;*zeb 3/15/18 fix handling of system locks
"RTN","SDECLK",41,0)
 Q
"RTN","SDECLK",42,0)
 ;
"RTN","SDECLK",43,0)
UNLOCK(SDECY,REQ,FLG) ; -- Unlock request record
"RTN","SDECLK",44,0)
 ;INPUT:
"RTN","SDECLK",45,0)
 ; REQ = (required) - Appt Request type - variable pointer pointer
"RTN","SDECLK",46,0)
 ;                            to one of these files:
"RTN","SDECLK",47,0)
 ;                         SDEC APPT REQUEST    - A|<APPT IEN>     A|123
"RTN","SDECLK",48,0)
 ;                         SD WAIT LIST         - E|<WL IEN>       E|123
"RTN","SDECLK",49,0)
 ;                         REQUEST/CONSULTATION - C|<CONSULT IEN>  C|123
"RTN","SDECLK",50,0)
 ;                         RECALL REMINDERS     - R|^<RECALL IEN>  R|123
"RTN","SDECLK",51,0)
 ; FLG = (optional) Unlock if other job
"RTN","SDECLK",52,0)
 ;        0 = (default) only unlock if lock belongs to current user and current $J job
"RTN","SDECLK",53,0)
 ;        1 = unlock even if the lock does not belong to current user and current $J job
"RTN","SDECLK",54,0)
 ;RETURN:
"RTN","SDECLK",55,0)
 ; A single entry in the global array indicating the success of unlocking the record:
"RTN","SDECLK",56,0)
 ;   1. CODE    -  1 if successful, or 0^Message if could not get lock
"RTN","SDECLK",57,0)
 ;   2. MESSAGE -  Message Text
"RTN","SDECLK",58,0)
 ;                 If message text="Not your lock" you can call again and send 1 as the 2nd input to unlock anyway.
"RTN","SDECLK",59,0)
 N SDTYP,SDIEN
"RTN","SDECLK",60,0)
 N Y,SDECLK,NOW,NOW1,SDECUSER
"RTN","SDECLK",61,0)
 S SDECY="^TMP(""SDEC"","_$J_")"
"RTN","SDECLK",62,0)
 K @SDECY
"RTN","SDECLK",63,0)
 S @SDECY@(0)="T00030CODE^T00030MESSAGE"_$C(30)
"RTN","SDECLK",64,0)
 I $G(REQ)="" S @SDECY@(1)="0^Invalid Request input"_$C(30,31) Q
"RTN","SDECLK",65,0)
 S SDTYP=$P(REQ,"|",1) I "ACER"'[SDTYP S @SDECY@(1)="0^Invalid Request Type"_$C(30,31) Q
"RTN","SDECLK",66,0)
 S SDIEN=$P(REQ,"|",2) I SDIEN'?1.N S @SDECY@(1)="0^Invalid Request ID"_$C(30,31) Q
"RTN","SDECLK",67,0)
 L +^XTMP("SDECLK"_SDTYP_"-"_SDIEN):5 I '$T S @SDECY@(1)="0^Unable to access lock table."_$C(30,31) Q  ;*zeb 3/15/18 fix handling of system locks
"RTN","SDECLK",68,0)
 S SDECLK=$G(^XTMP("SDECLK"_SDTYP_"-"_SDIEN,1)) ;*zeb+2 3/15/18 only do this once
"RTN","SDECLK",69,0)
 S SDECUSER=$P(SDECLK,U,1)
"RTN","SDECLK",70,0)
 I $G(FLG)'=1,(SDECUSER]""),(SDECUSER'=DUZ) S @SDECY@(1)="1^Not your lock"_$C(30,31) L -^XTMP("SDECLK"_SDTYP_"-"_SDIEN) Q  ;*zeb 3/22/18 fix handling of system locks
"RTN","SDECLK",71,0)
 ;the previous line is a silent failure if the lock doesn't exist or if someone else has it; they already have been behaving as if they had the lock
"RTN","SDECLK",72,0)
 ;this is a "shouldn't happen" scenario since the user had the lock before they tried to get rid of it, but we don't want to delete the new user
"RTN","SDECLK",73,0)
 K ^XTMP("SDECLK"_SDTYP_"-"_SDIEN) ;*zeb+1 3/15/18 change node before unlocking it
"RTN","SDECLK",74,0)
 L -^XTMP("SDECLK"_SDTYP_"-"_SDIEN)
"RTN","SDECLK",75,0)
 S @SDECY@(1)="1^Unlock successful"_$C(30,31)
"RTN","SDECLK",76,0)
 Q
"RTN","SDECLK",77,0)
 ;
"RTN","SDECLK",78,0)
 ;*zeb+tag 3/19/18 686 fix lock handling
"RTN","SDECLK",79,0)
 ;--------------------
"RTN","SDECLK",80,0)
 ;UNLKALL - Remove users' appointment request locks interactively
"RTN","SDECLK",81,0)
 ;--------------------
"RTN","SDECLK",82,0)
UNLKALL ;interactive option to remove a user's locks
"RTN","SDECLK",83,0)
 N SDECUSER,DIC,Y,U,SDNODE,SDLKDATA,SDLKUSER,SDLKFILE,SDLKIEN
"RTN","SDECLK",84,0)
 S Y="",U="^"
"RTN","SDECLK",85,0)
 W !,"Release all appointment request locks held by a user",!
"RTN","SDECLK",86,0)
 F  D  I Y=-1 Q
"RTN","SDECLK",87,0)
 .K DIC,Y
"RTN","SDECLK",88,0)
 .S DIC="^VA(200,"
"RTN","SDECLK",89,0)
 .S DIC(0)="AEQ"
"RTN","SDECLK",90,0)
 .S DIC("A")="Whose locks to release? "
"RTN","SDECLK",91,0)
 .D ^DIC
"RTN","SDECLK",92,0)
 .Q:(Y=-1)
"RTN","SDECLK",93,0)
 .S SDECUSER=$P(Y,U,1)
"RTN","SDECLK",94,0)
 .S SDNODE="SDECLK"
"RTN","SDECLK",95,0)
 .F  S SDNODE=$O(^XTMP(SDNODE)) Q:SDNODE'["SDECLK"  D
"RTN","SDECLK",96,0)
 ..S SDLKDATA=$G(^XTMP(SDNODE,1))
"RTN","SDECLK",97,0)
 ..S SDLKUSER=$P(SDLKDATA,U,1)
"RTN","SDECLK",98,0)
 ..Q:SDLKUSER'=SDECUSER  ;only want locks for this user
"RTN","SDECLK",99,0)
 ..K ^XTMP(SDNODE)
"RTN","SDECLK",100,0)
 ..S SDLKFILE=$E(SDNODE,7)
"RTN","SDECLK",101,0)
 ..S SDLKFILE=$S(SDLKFILE="E":"EWL Request",SDLKFILE="R":"PtCSch Request",SDLKFILE="C":"Consult",1:"APPT Request")
"RTN","SDECLK",102,0)
 ..S SDLKIEN=$P(SDNODE,"-",2)
"RTN","SDECLK",103,0)
 ..W !,"Lock released for "_SDLKFILE_" "_SDLKIEN
"RTN","SDECLK",104,0)
 Q
"SEC","^DD",409.86,409.863,5,9)

"SEC","^DIC",409.86,409.86,0,"AUDIT")
@
"SEC","^DIC",409.86,409.86,0,"DD")
@
"SEC","^DIC",409.86,409.86,0,"DEL")
@
"SEC","^DIC",409.86,409.86,0,"LAYGO")
@
"SEC","^DIC",409.86,409.86,0,"RD")
@
"SEC","^DIC",409.86,409.86,0,"WR")
@
"SEC","^DIC",409.97,409.97,0,"AUDIT")
@
"SEC","^DIC",409.97,409.97,0,"DD")
@
"SEC","^DIC",409.97,409.97,0,"DEL")
@
"SEC","^DIC",409.97,409.97,0,"LAYGO")
@
"SEC","^DIC",409.97,409.97,0,"WR")
@
"VER")
8.0^22.2
"^DD",409.85,409.85,5,0)
VAOS GUID^F^^0;8^K:$L(X)>32!($L(X)<1) X
"^DD",409.85,409.85,5,1,0)
^.1^^0
"^DD",409.85,409.85,5,3)
Answer must be 1-32 characters in length.
"^DD",409.85,409.85,5,21,0)
^^2^2^3180321^
"^DD",409.85,409.85,5,21,1,0)
Stores pointer to Oracle database where VAOS appointment requests are 
"^DD",409.85,409.85,5,21,2,0)
stored.
"^DD",409.85,409.85,5,"DT")
3180420
"^DD",409.86,409.86,0)
FIELD^^1.1^7
"^DD",409.86,409.86,0,"DDA")
N
"^DD",409.86,409.86,0,"DT")
3170616
"^DD",409.86,409.86,0,"ID",1)
S %I=Y,Y=$S('$D(^(0)):"",$D(^SC(+$P(^(0),U,2),0))#2:$P(^(0),U,1),1:""),C=$P(^DD(44,.01,0),U,2) D Y^DIQ:Y]"" W "   ",Y,@("$E("_DIC_"%I,0),0)") S Y=%I K %I
"^DD",409.86,409.86,0,"ID",2.1)
W "   ",@("$P($P($C(59)_$S($D(^DD(409.86,2.1,0)):$P(^(0),U,3),1:0)_$E("_DIC_"Y,0),0),$C(59)_$P(^(0),U,4)_"":"",2),$C(59),1)")
"^DD",409.86,409.86,0,"ID","W1.1")
S %I=Y,Y=$S('$D(^(0)):"",$D(^DIC(40.7,+$P(^(0),U,6),0))#2:$P(^(0),U,1),1:""),C=$P(^DD(40.7,.01,0),U,2) D Y^DIQ:Y]"" W "   ",Y,@("$E("_DIC_"%I,0),0)") S Y=%I K %I
"^DD",409.86,409.86,0,"ID","W2")
W "   ",$$NAKED^DIUTL("$$DATE^DIUTL($P(^(0),U,3))")
"^DD",409.86,409.86,0,"IX","B",409.86,.01)

"^DD",409.86,409.86,0,"NM","SDEC CONTACT")

"^DD",409.86,409.86,0,"PT",409.94,3)

"^DD",409.86,409.86,0,"VRPK")
SD
"^DD",409.86,409.86,.01,0)
PATIENT^RP2'^DPT(^0;1^Q
"^DD",409.86,409.86,.01,1,0)
^.1
"^DD",409.86,409.86,.01,1,1,0)
409.86^B
"^DD",409.86,409.86,.01,1,1,1)
S ^SDEC(409.86,"B",$E(X,1,30),DA)=""
"^DD",409.86,409.86,.01,1,1,2)
K ^SDEC(409.86,"B",$E(X,1,30),DA)
"^DD",409.86,409.86,.01,3)
Please enter current Patient!
"^DD",409.86,409.86,.01,21,0)
^^1^1^3170611^
"^DD",409.86,409.86,.01,21,1,0)
This is the Patient for this contact.
"^DD",409.86,409.86,.01,23,0)
^^1^1^3170611^
"^DD",409.86,409.86,.01,23,1,0)
Pointer to the Patient(#2) file.
"^DD",409.86,409.86,.01,"DT")
3170417
"^DD",409.86,409.86,1,0)
CLINIC^P44'^SC(^0;2^Q
"^DD",409.86,409.86,1,3)
Please enter contact clinic!
"^DD",409.86,409.86,1,21,0)
^^1^1^3170611^
"^DD",409.86,409.86,1,21,1,0)
This is the Clinic for this contact.
"^DD",409.86,409.86,1,23,0)
^^1^1^3170611^
"^DD",409.86,409.86,1,23,1,0)
Pointer to the Hospital Location(#44) file.
"^DD",409.86,409.86,1,"DT")
3170502
"^DD",409.86,409.86,1.1,0)
SERVICE^P40.7'^DIC(40.7,^0;6^Q
"^DD",409.86,409.86,1.1,3)
Please enter Service for this contact.
"^DD",409.86,409.86,1.1,21,0)
^.001^1^1^3170611^^
"^DD",409.86,409.86,1.1,21,1,0)
This is the Service for this contact.
"^DD",409.86,409.86,1.1,23,0)
^.001^1^1^3170611^^
"^DD",409.86,409.86,1.1,23,1,0)
Pointer to the CLINIC STOP(#40.7) file.
"^DD",409.86,409.86,1.1,"DT")
3170611
"^DD",409.86,409.86,2,0)
PREFERRED DATE^D^^0;3^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",409.86,409.86,2,3)
Please enter Preferred Date of appointment.
"^DD",409.86,409.86,2,21,0)
^^1^1^3170611^
"^DD",409.86,409.86,2,21,1,0)
This is the Preferred Date of Appointment for this contact.
"^DD",409.86,409.86,2,23,0)
^^2^2^3170611^
"^DD",409.86,409.86,2,23,1,0)
This date field contains the Preferred Date of Appointment for this 
"^DD",409.86,409.86,2,23,2,0)
contact.
"^DD",409.86,409.86,2,"DT")
3170611
"^DD",409.86,409.86,2.1,0)
REQUEST TYPE^RS^A:APPOINTMENT;C:CONSULT;R:RECALL;V:VETERAN;M:MOBILE;P:PROCEDURE;E:EWL;W:W2VA;RTC:RETURN TO CLINIC;^0;4^Q
"^DD",409.86,409.86,2.1,3)
Select the Request Type for this contact!
"^DD",409.86,409.86,2.1,21,0)
^^1^1^3170611^
"^DD",409.86,409.86,2.1,21,1,0)
This is the Request Type of this contact.
"^DD",409.86,409.86,2.1,23,0)
^^1^1^3170611^
"^DD",409.86,409.86,2.1,23,1,0)
Contact Request Type is a set of codes.
"^DD",409.86,409.86,2.1,"DT")
3170612
"^DD",409.86,409.86,2.2,0)
MAIN SEQUENCE^NJ2,0^^0;5^K:+X'=X!(X>99)!(X<0)!(X?.E1"."1N.N) X
"^DD",409.86,409.86,2.2,3)
Type a number between 0 and 99, 0 decimal digits.
"^DD",409.86,409.86,2.2,21,0)
^.001^1^1^3170611^^^
"^DD",409.86,409.86,2.2,21,1,0)
The Main Sequence field keeps track of the number of contacts.
"^DD",409.86,409.86,2.2,23,0)
^^2^2^3170611^
"^DD",409.86,409.86,2.2,23,1,0)
The Main Sequence is a numeric field that tracks the number contact of 
"^DD",409.86,409.86,2.2,23,2,0)
attempts.
"^DD",409.86,409.86,2.2,"DT")
3170429
"^DD",409.86,409.86,3,0)
DATE/TIME of CONTACT^409.863D^^1;0
"^DD",409.86,409.86,3,21,0)
^.001^1^1^3170612^^
"^DD",409.86,409.86,3,21,1,0)
This is the DATE/TIME multiple of the contact.
"^DD",409.86,409.86,3,23,0)
^^2^2^3170612^
"^DD",409.86,409.86,3,23,1,0)
DATE/TIME of CONTACT multiple tracks the number of contacts for this 
"^DD",409.86,409.86,3,23,2,0)
patient.
"^DD",409.86,409.863,0)
DATE/TIME of CONTACT SUB-FIELD^^6^7
"^DD",409.86,409.863,0,"DT")
3170612
"^DD",409.86,409.863,0,"IX","B",409.863,.01)

"^DD",409.86,409.863,0,"NM","DATE/TIME of CONTACT")

"^DD",409.86,409.863,0,"UP")
409.86
"^DD",409.86,409.863,.01,0)
DATE/TIME of CONTACT^MRD^^0;1^S %DT="ETXR" D ^%DT S X=Y K:Y<1 X
"^DD",409.86,409.863,.01,1,0)
^.1^^-1
"^DD",409.86,409.863,.01,1,1,0)
409.863^B
"^DD",409.86,409.863,.01,1,1,1)
S ^SDEC(409.86,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",409.86,409.863,.01,1,1,2)
K ^SDEC(409.86,DA(1),1,"B",$E(X,1,30),DA)
"^DD",409.86,409.863,.01,3)
Please enter DATE/TIME of CONTACT.
"^DD",409.86,409.863,.01,21,0)
^^1^1^3170611^
"^DD",409.86,409.863,.01,21,1,0)
This is the Date/Time of contact for this patient.
"^DD",409.86,409.863,.01,23,0)
^^2^2^3170611^
"^DD",409.86,409.863,.01,23,1,0)
This is a date/time field used to record the date/time a contact is 
"^DD",409.86,409.863,.01,23,2,0)
entered.
"^DD",409.86,409.863,.01,"DT")
3170501
"^DD",409.86,409.863,1,0)
CONTACT TYPE^S^C:CALL;L:LETTER;^1;1^Q
"^DD",409.86,409.863,1,1,0)
^.1^^0
"^DD",409.86,409.863,1,3)
Select Contact Type!
"^DD",409.86,409.863,1,21,0)
^^1^1^3170611^
"^DD",409.86,409.863,1,21,1,0)
This field Contact Type is how the patient is contacted.
"^DD",409.86,409.863,1,23,0)
^^1^1^3170611^
"^DD",409.86,409.863,1,23,1,0)
This field Contact Type is a set of codes of how a patient is contacted.
"^DD",409.86,409.863,1,"DT")
3170611
"^DD",409.86,409.863,2,0)
COMMENTS^FJ80^^1;2^K:$L(X)>80!($L(X)<1) X
"^DD",409.86,409.863,2,3)
Answer must be 1-80 characters in length.
"^DD",409.86,409.863,2,21,0)
^^1^1^3170611^
"^DD",409.86,409.863,2,21,1,0)
This is any comments associated with this contact.
"^DD",409.86,409.863,2,23,0)
^^1^1^3170611^
"^DD",409.86,409.863,2,23,1,0)
This is a Free Text field used to enter comments for this contact. 
"^DD",409.86,409.863,2,"DT")
3170611
"^DD",409.86,409.863,3,0)
LEFT MESSAGE^S^0:NO;1:YES;^1;3^Q
"^DD",409.86,409.863,3,3)
Enter 'YES' if patient was left a message, else enter 'NO'.
"^DD",409.86,409.863,3,21,0)
^.001^1^1^3170612^^
"^DD",409.86,409.863,3,21,1,0)
This field is if the patient was left a message.
"^DD",409.86,409.863,3,23,0)
^.001^1^1^3170612^^
"^DD",409.86,409.863,3,23,1,0)
The Left Message field is a set of codes.
"^DD",409.86,409.863,3,"DT")
3170612
"^DD",409.86,409.863,4,0)
SEQUENCE^RNJ2,0^^1;4^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",409.86,409.863,4,3)
Type a number between 1 and 99, 0 decimal digits.
"^DD",409.86,409.863,4,21,0)
^^1^1^3170611^
"^DD",409.86,409.863,4,21,1,0)
This is the Sequence of this contact.
"^DD",409.86,409.863,4,23,0)
^^1^1^3170611^
"^DD",409.86,409.863,4,23,1,0)
This field sequence is a numeric field.
"^DD",409.86,409.863,4,"DT")
3170417
"^DD",409.86,409.863,5,0)
USER ENTERED CONTACT^P200'^VA(200,^1;5^Q
"^DD",409.86,409.863,5,3)
Enter user who entered the contact!
"^DD",409.86,409.863,5,21,0)
^^1^1^3170611^
"^DD",409.86,409.863,5,21,1,0)
This is the user who entered the contact.
"^DD",409.86,409.863,5,23,0)
^^1^1^3170611^
"^DD",409.86,409.863,5,23,1,0)
The User Entered Contact field is a pointer to file NEW PERSON(#200).
"^DD",409.86,409.863,5,"DT")
3170611
"^DD",409.86,409.863,6,0)
DATE/TIME ENTERED^D^^1;6^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",409.86,409.863,6,3)
Enter date/time contact was entered.
"^DD",409.86,409.863,6,21,0)
^.001^1^1^3170612^^
"^DD",409.86,409.863,6,21,1,0)
This is the date/time the contact was entered.
"^DD",409.86,409.863,6,23,0)
^.001^1^1^3170612^^
"^DD",409.86,409.863,6,23,1,0)
This is a date/time field for when the contact was entered.
"^DD",409.86,409.863,6,"DT")
3170612
"^DD",409.97,409.97,0)
FIELD^^15^16
"^DD",409.97,409.97,0,"DDA")
N
"^DD",409.97,409.97,0,"DT")
3180220
"^DD",409.97,409.97,0,"IX","B",409.97,.01)

"^DD",409.97,409.97,0,"IX","C",409.97,1)

"^DD",409.97,409.97,0,"NM","SD Audit Statistics")

"^DD",409.97,409.97,0,"VRPK")
SD
"^DD",409.97,409.97,.01,0)
SCHEDULER^RP200'^VA(200,^0;1^Q
"^DD",409.97,409.97,.01,1,0)
^.1
"^DD",409.97,409.97,.01,1,1,0)
409.97^B
"^DD",409.97,409.97,.01,1,1,1)
S ^SDAUDIT("B",$E(X,1,30),DA)=""
"^DD",409.97,409.97,.01,1,1,2)
K ^SDAUDIT("B",$E(X,1,30),DA)
"^DD",409.97,409.97,.01,3)
Enter name of scheduler.
"^DD",409.97,409.97,.01,21,0)
^.001^2^2^3180222^^^
"^DD",409.97,409.97,.01,21,1,0)
Scheduler (user of VSE GUI) who performs actions (e.g., enter appointment 
"^DD",409.97,409.97,.01,21,2,0)
requests).
"^DD",409.97,409.97,.01,23,0)
^.001^2^2^3180222^^
"^DD",409.97,409.97,.01,23,1,0)
Scheduler is extracted from activity files (e.g., 409.84, 409.85) by 
"^DD",409.97,409.97,.01,23,2,0)
audit compiler (SDECAUD).
"^DD",409.97,409.97,.01,"DT")
3180220
"^DD",409.97,409.97,1,0)
DATE^D^^0;2^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",409.97,409.97,1,1,0)
^.1
"^DD",409.97,409.97,1,1,1,0)
409.97^C
"^DD",409.97,409.97,1,1,1,1)
S ^SDAUDIT("C",$E(X,1,30),DA)=""
"^DD",409.97,409.97,1,1,1,2)
K ^SDAUDIT("C",$E(X,1,30),DA)
"^DD",409.97,409.97,1,1,1,"%D",0)
^^1^1^3180222^
"^DD",409.97,409.97,1,1,1,"%D",1,0)
Date cross-reference for report of statistics by date.
"^DD",409.97,409.97,1,1,1,"DT")
3180220
"^DD",409.97,409.97,1,3)
Enter the date the action was performed.
"^DD",409.97,409.97,1,21,0)
^^1^1^3180222^
"^DD",409.97,409.97,1,21,1,0)
Date the scheduler performed the action.
"^DD",409.97,409.97,1,23,0)
^^2^2^3180222^
"^DD",409.97,409.97,1,23,1,0)
Date is extracted from the relevant file (e.g., 409.84) by the audit 
"^DD",409.97,409.97,1,23,2,0)
statistics compiler (SDECAUD).
"^DD",409.97,409.97,1,"DT")
3180220
"^DD",409.97,409.97,2,0)
PATIENT CONTACTS^NJ8,0^^0;3^K:+X'=X!(X>99999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",409.97,409.97,2,3)
Type a number between 0 and 99999999, 0 decimal digits.
"^DD",409.97,409.97,2,21,0)
^^1^1^3180222^
"^DD",409.97,409.97,2,21,1,0)
Count of patient contacts performed by the scheduler on the date.
"^DD",409.97,409.97,2,23,0)
^^2^2^3180222^
"^DD",409.97,409.97,2,23,1,0)
Counts are extracted by audit statistics compiler (SDECAUD) from files 
"^DD",409.97,409.97,2,23,2,0)
409.85 and 409.3.
"^DD",409.97,409.97,2,"DT")
3180220
"^DD",409.97,409.97,3,0)
APPT REQUESTS^NJ8,0^^0;4^K:+X'=X!(X>99999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",409.97,409.97,3,3)
Type a number between 0 and 99999999, 0 decimal digits.
"^DD",409.97,409.97,3,21,0)
^^1^1^3180222^
"^DD",409.97,409.97,3,21,1,0)
Number of appointments requests entered by the scheduler on the date.
"^DD",409.97,409.97,3,23,0)
^^2^2^3180222^
"^DD",409.97,409.97,3,23,1,0)
Data is extracted by the audit statistics compiler (SDECAUD) from file 
"^DD",409.97,409.97,3,23,2,0)
#409.84.
"^DD",409.97,409.97,3,"DT")
3180220
"^DD",409.97,409.97,4,0)
APPT APPOINTMENTS MADE^NJ8,0^^0;5^K:+X'=X!(X>99999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",409.97,409.97,4,3)
Type a number between 0 and 99999999, 0 decimal digits.
"^DD",409.97,409.97,4,21,0)
^.001^1^1^3180222^^
"^DD",409.97,409.97,4,21,1,0)
Count of appointments performed by the scheduler on the date.
"^DD",409.97,409.97,4,23,0)
^^2^2^3180222^
"^DD",409.97,409.97,4,23,1,0)
Data is extracted by the audit statistics compiler (SDECAUD) from file 
"^DD",409.97,409.97,4,23,2,0)
409.84.
"^DD",409.97,409.97,4,"DT")
3180220
"^DD",409.97,409.97,5,0)
APPT CLOSED^NJ8,0^^0;6^K:+X'=X!(X>99999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",409.97,409.97,5,3)
Type a number between 0 and 99999999, 0 decimal digits.
"^DD",409.97,409.97,5,21,0)
^.001^1^1^3180222^^
"^DD",409.97,409.97,5,21,1,0)
Number of appointments cancelled by the scheduler on the date.
"^DD",409.97,409.97,5,23,0)
^.001^1^1^3180222^^
"^DD",409.97,409.97,5,23,1,0)
Data is extracted by the audit statistics compiler (SDECAUD).
"^DD",409.97,409.97,5,"DT")
3180220
"^DD",409.97,409.97,6,0)
MRTC OPENED^NJ8,0^^0;7^K:+X'=X!(X>99999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",409.97,409.97,6,3)
Type a number between 0 and 99999999, 0 decimal digits.
"^DD",409.97,409.97,6,21,0)
^^1^1^3180222^
"^DD",409.97,409.97,6,21,1,0)
Number of MRTC appointment requests opened by the scheduler on the date.
"^DD",409.97,409.97,6,23,0)
^^2^2^3180222^
"^DD",409.97,409.97,6,23,1,0)
Counts are extracted by the audit statistics compiler (SDECAUD) from file 
"^DD",409.97,409.97,6,23,2,0)
409.85.
"^DD",409.97,409.97,6,"DT")
3180220
"^DD",409.97,409.97,7,0)
MRTC CLOSED^NJ8,0^^0;8^K:+X'=X!(X>99999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",409.97,409.97,7,3)
Type a number between 0 and 99999999, 0 decimal digits.
"^DD",409.97,409.97,7,21,0)
^^1^1^3180222^
"^DD",409.97,409.97,7,21,1,0)
Number of MRTC appointment requests closed by the scheduler on the date.
"^DD",409.97,409.97,7,23,0)
^^2^2^3180222^
"^DD",409.97,409.97,7,23,1,0)
Counts are extracted by the audit statictics compiler (SDECAUD) from file 
"^DD",409.97,409.97,7,23,2,0)
409.85.
"^DD",409.97,409.97,7,"DT")
3180220
"^DD",409.97,409.97,8,0)
EWL ENTRIES^NJ8,0^^0;9^K:+X'=X!(X>99999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",409.97,409.97,8,3)
Type a number between 0 and 99999999, 0 decimal digits.
"^DD",409.97,409.97,8,21,0)
^^1^1^3180222^
"^DD",409.97,409.97,8,21,1,0)
Number of wait list entries created by the scheduler on the date.
"^DD",409.97,409.97,8,23,0)
^^2^2^3180222^
"^DD",409.97,409.97,8,23,1,0)
Data is extracted by the audit statistics compiler (SDECAUD) from file 
"^DD",409.97,409.97,8,23,2,0)
409.3.
"^DD",409.97,409.97,8,"DT")
3180220
"^DD",409.97,409.97,9,0)
EWL APPOINTMENTS MADE^NJ8,0^^0;10^K:+X'=X!(X>99999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",409.97,409.97,9,3)
Type a number between 0 and 99999999, 0 decimal digits.
"^DD",409.97,409.97,9,21,0)
^^1^1^3180222^
"^DD",409.97,409.97,9,21,1,0)
Number of appointments made off of the EWL by the scheduler on a date.
"^DD",409.97,409.97,9,23,0)
^^2^2^3180222^
"^DD",409.97,409.97,9,23,1,0)
Data is extracted by the audit statistics compiler (SDECAUD) from file 
"^DD",409.97,409.97,9,23,2,0)
409.84.
"^DD",409.97,409.97,9,"DT")
3180220
"^DD",409.97,409.97,10,0)
EWL CLOSED^NJ8,0^^0;11^K:+X'=X!(X>99999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",409.97,409.97,10,3)
Type a number between 0 and 99999999, 0 decimal digits.
"^DD",409.97,409.97,10,21,0)
^^1^1^3180222^
"^DD",409.97,409.97,10,21,1,0)
Number of EWL appointment requests closed by the scheduler on the date.
"^DD",409.97,409.97,10,23,0)
^^2^2^3180222^
"^DD",409.97,409.97,10,23,1,0)
Data is extracted by the audit statistics compiler (SDECAUD) from file 
"^DD",409.97,409.97,10,23,2,0)
409.3.
"^DD",409.97,409.97,10,"DT")
3180220
"^DD",409.97,409.97,11,0)
PtCSch ENTRIES^NJ8,0^^0;12^K:+X'=X!(X>99999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",409.97,409.97,11,3)
Type a number between 0 and 99999999, 0 decimal digits.
"^DD",409.97,409.97,11,21,0)
^^2^2^3180222^
"^DD",409.97,409.97,11,21,1,0)
Number of patient recall (PtCSch) requests entered by the scheduler on 
"^DD",409.97,409.97,11,21,2,0)
the date.
"^DD",409.97,409.97,11,23,0)
^^2^2^3180222^
"^DD",409.97,409.97,11,23,1,0)
Data is extracted by the audit statistics compiler (SDECAUD) from file 
"^DD",409.97,409.97,11,23,2,0)
403.5.
"^DD",409.97,409.97,11,"DT")
3180220
"^DD",409.97,409.97,12,0)
PtCSch APPOINTMENTS MADE^NJ8,0^^0;13^K:+X'=X!(X>99999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",409.97,409.97,12,3)
Type a number between 0 and 99999999, 0 decimal digits.
"^DD",409.97,409.97,12,21,0)
^^2^2^3180222^
"^DD",409.97,409.97,12,21,1,0)
Number of patient recall (PtCSch) appointments entered by the scheduler 
"^DD",409.97,409.97,12,21,2,0)
on the date.
"^DD",409.97,409.97,12,23,0)
^^2^2^3180222^
"^DD",409.97,409.97,12,23,1,0)
Data is extracted by the audit statistics compiler (SDECAUD) from file 
"^DD",409.97,409.97,12,23,2,0)
409.84.
"^DD",409.97,409.97,12,"DT")
3180220
"^DD",409.97,409.97,13,0)
CONSULT APPOINTMENTS MADE^NJ8,0^^0;14^K:+X'=X!(X>99999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",409.97,409.97,13,3)
Type a number between 0 and 99999999, 0 decimal digits.
"^DD",409.97,409.97,13,21,0)
^^1^1^3180222^
"^DD",409.97,409.97,13,21,1,0)
Number of consult appointments entered by the scheduler on the date.
"^DD",409.97,409.97,13,23,0)
^^2^2^3180222^
"^DD",409.97,409.97,13,23,1,0)
Data is extracted by the audit statistics compiler (SDECAUD) from file 
"^DD",409.97,409.97,13,23,2,0)
409.84.
"^DD",409.97,409.97,13,"DT")
3180220
"^DD",409.97,409.97,14,0)
APPOINTMENTS CANCELLED^NJ8,0^^0;15^K:+X'=X!(X>99999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",409.97,409.97,14,3)
Type a number between 0 and 99999999, 0 decimal digits.
"^DD",409.97,409.97,14,21,0)
^^1^1^3180222^
"^DD",409.97,409.97,14,21,1,0)
Number of appointments cancelled by the scheduler on the date.
"^DD",409.97,409.97,14,23,0)
^^2^2^3180222^
"^DD",409.97,409.97,14,23,1,0)
Data is extracted by the audit statistics compiler (SDECAUD) from file 
"^DD",409.97,409.97,14,23,2,0)
409.84.
"^DD",409.97,409.97,14,"DT")
3180220
"^DD",409.97,409.97,15,0)
TOTAL ACTIONS^CJ8,0^^ ; ^X ^DD(409.97,15,9.3) S X=X+$P(Y(409.97,15,1),U,14)+$P(Y(409.97,15,1),U,15)
"^DD",409.97,409.97,15,9)
^
"^DD",409.97,409.97,15,9.01)
409.97^14;409.97^13;409.97^12;409.97^11;409.97^10;409.97^9;409.97^8;409.97^7;409.97^6;409.97^5;409.97^4;409.97^3;409.97^2
"^DD",409.97,409.97,15,9.1)
PATIENT CONTACTS+APPT REQUESTS+APPT APPOINTMENTS MADE+APPT CLOSED+MRTC OPENED+MRTC CLOSED+EWL ENTRIES+EWL APPOINTMENTS MADE+EWL CLOSED+PtCSch ENTRIES+PtCSch APPOINTMENTS MADE+CONSULT APPOINTMENTS MADE+APPOINTMENTS CANCELLED
"^DD",409.97,409.97,15,9.2)
S Y(409.97,15,1)=$S($D(^SDAUDIT(D0,0)):^(0),1:"") S X=$P(Y(409.97,15,1),U,3)+$P(Y(409.97,15,1),U,4)+$P(Y(409.97,15,1),U,5)+$P(Y(409.97,15,1),U,6)+$P(Y(409.97,15,1),U,7)
"^DD",409.97,409.97,15,9.3)
X ^DD(409.97,15,9.2) S X=X+$P(Y(409.97,15,1),U,8)+$P(Y(409.97,15,1),U,9)+$P(Y(409.97,15,1),U,10)+$P(Y(409.97,15,1),U,11)+$P(Y(409.97,15,1),U,12)+$P(Y(409.97,15,1),U,13)
"^DIC",409.86,409.86,0)
SDEC CONTACT^409.86
"^DIC",409.86,409.86,0,"GL")
^SDEC(409.86,
"^DIC",409.86,409.86,"%",0)
^1.005^^0
"^DIC",409.86,409.86,"%D",0)
^^4^4^3170612^
"^DIC",409.86,409.86,"%D",1,0)
This file is used by the VSE VS GUI. The file contains patient contact
"^DIC",409.86,409.86,"%D",2,0)
information regarding appointment follow up each time a patient is
"^DIC",409.86,409.86,"%D",3,0)
contacted. This file should not be edited using Fileman, the file is
"^DIC",409.86,409.86,"%D",4,0)
updated using the VSE VS GUI.
"^DIC",409.86,"B","SDEC CONTACT",409.86)

"^DIC",409.97,409.97,0)
SD Audit Statistics^409.97
"^DIC",409.97,409.97,0,"GL")
^SDAUDIT(
"^DIC",409.97,409.97,"%D",0)
^1.001^4^4^3180312^^
"^DIC",409.97,409.97,"%D",1,0)
The SD Audit Statistics file contains counts of activities performed by a 
"^DIC",409.97,409.97,"%D",2,0)
scheduler on a date.  The statistics are compiled early each morning by 
"^DIC",409.97,409.97,"%D",3,0)
the audit statistics compiler routine (SDECAUD) from data in files 403.5, 
"^DIC",409.97,409.97,"%D",4,0)
409.3, 409.84 and 409.85."
"^DIC",409.97,"B","SD Audit Statistics",409.97)

"BLD",10340,6)
^596
**END**
**END**

