EMERGENCY Released SD*5.3*555 SEQ #452
Extracted from mail message
**KIDS**:SD*5.3*555^

**INSTALL NAME**
SD*5.3*555
"BLD",7188,0)
SD*5.3*555^SCHEDULING^0^3090504^y
"BLD",7188,1,0)
^^1^1^3090414^
"BLD",7188,1,1,0)
Fix SDLT routine for Scheduling letters
"BLD",7188,4,0)
^9.64PA^^
"BLD",7188,6.3)
3
"BLD",7188,"ABPKG")
n
"BLD",7188,"KRN",0)
^9.67PA^8989.52^19
"BLD",7188,"KRN",.4,0)
.4
"BLD",7188,"KRN",.401,0)
.401
"BLD",7188,"KRN",.402,0)
.402
"BLD",7188,"KRN",.403,0)
.403
"BLD",7188,"KRN",.5,0)
.5
"BLD",7188,"KRN",.84,0)
.84
"BLD",7188,"KRN",3.6,0)
3.6
"BLD",7188,"KRN",3.8,0)
3.8
"BLD",7188,"KRN",9.2,0)
9.2
"BLD",7188,"KRN",9.8,0)
9.8
"BLD",7188,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",7188,"KRN",9.8,"NM",1,0)
SDLT^^0^B17520984
"BLD",7188,"KRN",9.8,"NM","B","SDLT",1)

"BLD",7188,"KRN",19,0)
19
"BLD",7188,"KRN",19,"NM",0)
^9.68A^^
"BLD",7188,"KRN",19.1,0)
19.1
"BLD",7188,"KRN",101,0)
101
"BLD",7188,"KRN",409.61,0)
409.61
"BLD",7188,"KRN",771,0)
771
"BLD",7188,"KRN",870,0)
870
"BLD",7188,"KRN",8989.51,0)
8989.51
"BLD",7188,"KRN",8989.52,0)
8989.52
"BLD",7188,"KRN",8994,0)
8994
"BLD",7188,"KRN","B",.4,.4)

"BLD",7188,"KRN","B",.401,.401)

"BLD",7188,"KRN","B",.402,.402)

"BLD",7188,"KRN","B",.403,.403)

"BLD",7188,"KRN","B",.5,.5)

"BLD",7188,"KRN","B",.84,.84)

"BLD",7188,"KRN","B",3.6,3.6)

"BLD",7188,"KRN","B",3.8,3.8)

"BLD",7188,"KRN","B",9.2,9.2)

"BLD",7188,"KRN","B",9.8,9.8)

"BLD",7188,"KRN","B",19,19)

"BLD",7188,"KRN","B",19.1,19.1)

"BLD",7188,"KRN","B",101,101)

"BLD",7188,"KRN","B",409.61,409.61)

"BLD",7188,"KRN","B",771,771)

"BLD",7188,"KRN","B",870,870)

"BLD",7188,"KRN","B",8989.51,8989.51)

"BLD",7188,"KRN","B",8989.52,8989.52)

"BLD",7188,"KRN","B",8994,8994)

"BLD",7188,"QUES",0)
^9.62^^
"BLD",7188,"REQB",0)
^9.611^1^1
"BLD",7188,"REQB",1,0)
SD*5.3*441^2
"BLD",7188,"REQB","B","SD*5.3*441",1)

"MBREQ")
0
"PKG",48,-1)
1^1
"PKG",48,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",48,20,0)
^9.402P^^
"PKG",48,22,0)
^9.49I^1^1
"PKG",48,22,1,0)
5.3^2930813^2960613
"PKG",48,22,1,"PAH",1,0)
555^3090504
"PKG",48,22,1,"PAH",1,1,0)
^^1^1^3090504
"PKG",48,22,1,"PAH",1,1,1,0)
Fix SDLT routine for Scheduling letters
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","SDLT")
0^1^B17520984^B16314350
"RTN","SDLT",1,0)
SDLT ;ALB/LDB - CANCELLATION LETTERS ; 14 Feb 2003
"RTN","SDLT",2,0)
 ;;5.3;Scheduling;**185,213,281,330,398,523,441,555**;Aug 13, 1993;Build 3
"RTN","SDLT",3,0)
 ;
"RTN","SDLT",4,0)
 ;**************************************************************************
"RTN","SDLT",5,0)
 ;                          MODIFICATIONS
"RTN","SDLT",6,0)
 ;                          
"RTN","SDLT",7,0)
 ;   DATE      PATCH     DEVELOPER  DESCRIPTION OF CHANGES
"RTN","SDLT",8,0)
 ; --------  ----------  ---------  ----------------------------------------
"RTN","SDLT",9,0)
 ; 02/14/03  SD*5.3*281  SAUNDERS   Print letters to confidential address if
"RTN","SDLT",10,0)
 ;                                  requested
"RTN","SDLT",11,0)
 ; 12/2/03   SD*5.3*330  LUNDEN     Remove form feed from PRT+0
"RTN","SDLT",12,0)
 ;
"RTN","SDLT",13,0)
 ;**************************************************************************
"RTN","SDLT",14,0)
 ;
"RTN","SDLT",15,0)
 N Z0,X
"RTN","SDLT",16,0)
 ;WRITE GREETING AND OPENING TEXT OF LETTER
"RTN","SDLT",17,0)
PRT S DFN=$P(A,U,1)  ;SD*523
"RTN","SDLT",18,0)
 I $D(SDNOSH) I $D(^DPT(DFN,.1)) S POP=1 Q:POP  ;SD/523
"RTN","SDLT",19,0)
 S Y=DT D DTS^SDUTL
"RTN","SDLT",20,0)
 I +$G(SDFIRST)=0 W @IOF ;SD*5.3*330 Form feed only after letter #1
"RTN","SDLT",21,0)
 K SDFIRST
"RTN","SDLT",22,0)
 ;S SDFIRST=0
"RTN","SDLT",23,0)
 W !,?65,Y,!,?65,$$LAST4(A),!!!!
"RTN","SDLT",24,0)
 I 'SDFORM W !!!!! D ADDR W !!!!
"RTN","SDLT",25,0)
W1 W !,"Dear ",$S($P(^DPT(+A,0),"^",2)="M":"Mr. ",1:"Ms. ")
"RTN","SDLT",26,0)
 N DPTNAME
"RTN","SDLT",27,0)
 S DPTNAME("FILE")=2,DPTNAME("FIELD")=".01",DPTNAME("IENS")=(+A)_","
"RTN","SDLT",28,0)
 S X=$$NAMEFMT^XLFNAME(.DPTNAME,"G","M") W X,","
"RTN","SDLT",29,0)
 W !! K ^UTILITY($J,"W"),DIWF,DIWR,DIWF S DIWL=1,DIWF="C80WN" F Z0=0:0 S Z0=$O(^VA(407.5,SDLET,1,Z0)) Q:Z0'>0  S X=^(Z0,0) D ^DIWP
"RTN","SDLT",30,0)
 D ^DIWW K ^UTILITY($J,"W") Q
"RTN","SDLT",31,0)
WRAPP ;WRITE APPOINTMENT INFORMATION
"RTN","SDLT",32,0)
 N B
"RTN","SDLT",33,0)
 S:$D(SC)&'$D(SDC) SDC=SC S SDCL=$P(^SC(+SDC,0),"^",1),SDCL=SDCL_" Clinic" D FORM
"RTN","SDLT",34,0)
 S SDX1=$S($D(SDX):SDX,1:X) S:$D(SDS) S=SDS F B=3,4,5 I $P(S,"^",B)]"" S SDCL=$S(B=3:"LAB",B=4:"XRAY",1:"EKG"),SDX=$P(S,"^",B) D FORM
"RTN","SDLT",35,0)
 S (SDX,X)=SDX1 Q
"RTN","SDLT",36,0)
FORM S:$D(SDX) X=SDX S SDHX=X D DW^%DTC S DOW=X,X=SDHX X ^DD("FUNC",2,1) S SDT0=X,SDDAT=$P("JAN^FEB^MAR^APR^MAY^JUN^JUL^AUG^SEP^OCT^NOV^DEC","^",$E(SDHX,4,5))_" "_+$E(SDHX,6,7)_", "_(1700+$E(SDHX,1,3)) W !?4,DOW,?14,$J(SDDAT,12)
"RTN","SDLT",37,0)
 W ?27,$J(SDT0,8)," ",SDCL I $D(SDLT)&($Y>(IOSL-8)) W @IOF
"RTN","SDLT",38,0)
 Q
"RTN","SDLT",39,0)
REST ;WRITE THE REMAINDER OF LETTER
"RTN","SDLT",40,0)
 N Z5,I,X
"RTN","SDLT",41,0)
 I SDLET W !?12 K ^UTILITY($J,"W"),DIWL,DIWR,DIWF S DIWL=1,DIWF="C80WN" F Z5=0:0 S Z5=$O(^VA(407.5,SDLET,2,Z5)) Q:Z5'>0  S X=^(Z5,0) D ^DIWP
"RTN","SDLT",42,0)
 D ^DIWW K ^UTILITY($J,"W") Q:'SDFORM
"RTN","SDLT",43,0)
 F I=$Y:1:IOSL-12 W !
"RTN","SDLT",44,0)
 D ADDR Q
"RTN","SDLT",45,0)
ADDR K VAHOW S DFN=+A W !?12,$$FML^DGNFUNC(DFN)
"RTN","SDLT",46,0)
 I $D(^DG(43,1,"BT")),'$P(^("BT"),"^",3) S VAPA("P")=""
"RTN","SDLT",47,0)
 S X1=DT,X2=5 D C^%DTC I '$D(VAPA("P")) S (VATEST("ADD",9),VATEST("ADD",10))=X
"RTN","SDLT",48,0)
 D ADD^VADPT D
"RTN","SDLT",49,0)
 .;CHANGE STATE TO ABBR.
"RTN","SDLT",50,0)
 .N SDIENS,X
"RTN","SDLT",51,0)
 .I $D(VAPA(5)) S SDIENS=+VAPA(5)_",",X=$$GET1^DIQ(5,SDIENS,1),$P(VAPA(5),U,2)=X
"RTN","SDLT",52,0)
 .I $D(VAPA(17)) S SDIENS=+VAPA(17)_",",X=$$GET1^DIQ(5,SDIENS,1),$P(VAPA(17),U,2)=X
"RTN","SDLT",53,0)
 .K SDIENS Q
"RTN","SDLT",54,0)
 N SDCCACT1,SDCCACT2,LL
"RTN","SDLT",55,0)
 S SDCCACT1=VAPA(12),SDCCACT2=$P($G(VAPA(22,2)),"^",3)
"RTN","SDLT",56,0)
 ;if confidential address is not active for scheduling/appointment letters, print to regular address
"RTN","SDLT",57,0)
 I ($G(SDCCACT1)=0)!($G(SDCCACT2)'="Y") D
"RTN","SDLT",58,0)
 .F LL=1:1:3 W:VAPA(LL)]"" !,?12,VAPA(LL)
"RTN","SDLT",59,0)
 .;if country is blank display as USA
"RTN","SDLT",60,0)
 .I (VAPA(25)="")!($P(VAPA(25),"^",2)="UNITED STATES")  D  ;display city,state,zip
"RTN","SDLT",61,0)
 ..W !,?12,VAPA(4)_" "_$P(VAPA(5),U,2)_"  "_$P(VAPA(11),U,2)
"RTN","SDLT",62,0)
 .E  D  ;display postal code,city,province
"RTN","SDLT",63,0)
 ..W !,?12,VAPA(24)_" "_VAPA(4)_" "_VAPA(23)
"RTN","SDLT",64,0)
 .W:($P(VAPA(25),"^",2)'="UNITED STATES") !,?12,$P(VAPA(25),U,2) ;display country
"RTN","SDLT",65,0)
 ;if confidential address is active for scheduling/appointment letters, print to confidential address
"RTN","SDLT",66,0)
 I $G(SDCCACT1)=1,$G(SDCCACT2)="Y" D
"RTN","SDLT",67,0)
 .F LL=13:1:15 W:VAPA(LL)]"" !,?12,VAPA(LL)
"RTN","SDLT",68,0)
 .I (VAPA(28)="")!($P(VAPA(28),"^",2)="UNITED STATES") D
"RTN","SDLT",69,0)
 ..W !,?12,VAPA(16)_" "_$P(VAPA(17),U,2)_"  "_$P(VAPA(18),U,2)
"RTN","SDLT",70,0)
 .E  D
"RTN","SDLT",71,0)
 ..W !,?12,VAPA(27)_" "_VAPA(16)_" "_VAPA(26)
"RTN","SDLT",72,0)
 .W:($P(VAPA(28),"^",2)'="UNITED STATES") !?12,$P(VAPA(28),U,2)
"RTN","SDLT",73,0)
 W ! D KVAR^VADPT Q
"RTN","SDLT",74,0)
 ;
"RTN","SDLT",75,0)
 ;
"RTN","SDLT",76,0)
LAST4(DFN) ;Return patient "last four"
"RTN","SDLT",77,0)
 N SDX
"RTN","SDLT",78,0)
 S SDX=$G(^DPT(+DFN,0))
"RTN","SDLT",79,0)
 Q $E(SDX)_$E($P(SDX,U,9),6,9)
"RTN","SDLT",80,0)
 ;
"RTN","SDLT",81,0)
BADADD ;Print patients with a Bad Address Indicator
"RTN","SDLT",82,0)
 I '$D(^TMP($J,"BADADD")) Q
"RTN","SDLT",83,0)
 N SDHDR,SDHDR1
"RTN","SDLT",84,0)
 W @IOF,$TR($J("",IOM)," ","*")
"RTN","SDLT",85,0)
 S SDHDR="BAD ADDRESS INDICATOR LIST" W !,?(IOM-$L(SDHDR)/2),SDHDR,!
"RTN","SDLT",86,0)
 S SDHDR1="** THE LETTER FOR THESE PATIENT(S) DID NOT PRINT DUE TO A BAD ADDRESS INDICATOR."
"RTN","SDLT",87,0)
 W !,"Last 4",!,"of SSN",?10,"Patient Name",!
"RTN","SDLT",88,0)
 W $TR($J("",IOM)," ","*")
"RTN","SDLT",89,0)
 N SDNAM,SDDFN
"RTN","SDLT",90,0)
 S SDNAM="" F  S SDNAM=$O(^TMP($J,"BADADD",SDNAM)) Q:SDNAM=""  D
"RTN","SDLT",91,0)
 . S SDDFN=0 F  S SDDFN=$O(^TMP($J,"BADADD",SDNAM,SDDFN)) Q:'SDDFN  D
"RTN","SDLT",92,0)
 . . W !,$$LAST4(SDDFN),?10,SDNAM
"RTN","SDLT",93,0)
 W !!,SDHDR1
"RTN","SDLT",94,0)
 Q
"VER")
8.0^22.0
"BLD",7188,6)
^452
**END**
**END**
