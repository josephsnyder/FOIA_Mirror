Released SD*5.3*181 SEQ #167
Extracted from mail message
**KIDS**:SD*5.3*181^

**INSTALL NAME**
SD*5.3*181
"BLD",1842,0)
SD*5.3*181^SCHEDULING^0^2990219^y
"BLD",1842,1,0)
^^1^1^2990219^
"BLD",1842,1,1,0)
PCMM output issues
"BLD",1842,4,0)
^9.64PA^^
"BLD",1842,"ABNS",0)
^9.66A^^
"BLD",1842,"ABPKG")
n^n^
"BLD",1842,"KRN",0)
^9.67PA^19^18
"BLD",1842,"KRN",.4,0)
.4
"BLD",1842,"KRN",.401,0)
.401
"BLD",1842,"KRN",.402,0)
.402
"BLD",1842,"KRN",.403,0)
.403
"BLD",1842,"KRN",.5,0)
.5
"BLD",1842,"KRN",.84,0)
.84
"BLD",1842,"KRN",3.6,0)
3.6
"BLD",1842,"KRN",3.8,0)
3.8
"BLD",1842,"KRN",9.2,0)
9.2
"BLD",1842,"KRN",9.8,0)
9.8
"BLD",1842,"KRN",9.8,"NM",0)
^9.68A^6^6
"BLD",1842,"KRN",9.8,"NM",1,0)
SCRPU3^^0^B16887265
"BLD",1842,"KRN",9.8,"NM",2,0)
SCRPTM^^0^B27834508
"BLD",1842,"KRN",9.8,"NM",3,0)
SCRPTA^^0^B29618145
"BLD",1842,"KRN",9.8,"NM",4,0)
SCRPTA2^^0^B25111103
"BLD",1842,"KRN",9.8,"NM",5,0)
SCRPPAT2^^0^B25879576
"BLD",1842,"KRN",9.8,"NM",6,0)
SCRPPAT3^^0^B25320257
"BLD",1842,"KRN",9.8,"NM","B","SCRPPAT2",5)

"BLD",1842,"KRN",9.8,"NM","B","SCRPPAT3",6)

"BLD",1842,"KRN",9.8,"NM","B","SCRPTA",3)

"BLD",1842,"KRN",9.8,"NM","B","SCRPTA2",4)

"BLD",1842,"KRN",9.8,"NM","B","SCRPTM",2)

"BLD",1842,"KRN",9.8,"NM","B","SCRPU3",1)

"BLD",1842,"KRN",19,0)
19
"BLD",1842,"KRN",19.1,0)
19.1
"BLD",1842,"KRN",101,0)
101
"BLD",1842,"KRN",409.61,0)
409.61
"BLD",1842,"KRN",771,0)
771
"BLD",1842,"KRN",869.2,0)
869.2
"BLD",1842,"KRN",870,0)
870
"BLD",1842,"KRN",8994,0)
8994
"BLD",1842,"KRN","B",.4,.4)

"BLD",1842,"KRN","B",.401,.401)

"BLD",1842,"KRN","B",.402,.402)

"BLD",1842,"KRN","B",.403,.403)

"BLD",1842,"KRN","B",.5,.5)

"BLD",1842,"KRN","B",.84,.84)

"BLD",1842,"KRN","B",3.6,3.6)

"BLD",1842,"KRN","B",3.8,3.8)

"BLD",1842,"KRN","B",9.2,9.2)

"BLD",1842,"KRN","B",9.8,9.8)

"BLD",1842,"KRN","B",19,19)

"BLD",1842,"KRN","B",19.1,19.1)

"BLD",1842,"KRN","B",101,101)

"BLD",1842,"KRN","B",409.61,409.61)

"BLD",1842,"KRN","B",771,771)

"BLD",1842,"KRN","B",869.2,869.2)

"BLD",1842,"KRN","B",870,870)

"BLD",1842,"KRN","B",8994,8994)

"BLD",1842,"QUES",0)
^9.62^^
"BLD",1842,"REQB",0)
^9.611^3^3
"BLD",1842,"REQB",1,0)
SD*5.3*52^2
"BLD",1842,"REQB",2,0)
SD*5.3*140^2
"BLD",1842,"REQB",3,0)
SD*5.3*174^2
"BLD",1842,"REQB","B","SD*5.3*140",2)

"BLD",1842,"REQB","B","SD*5.3*174",3)

"BLD",1842,"REQB","B","SD*5.3*52",1)

"MBREQ")
0
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813^2930925
"PKG",16,22,1,"PAH",1,0)
181^2990219^256
"PKG",16,22,1,"PAH",1,1,0)
^^1^1^2990414
"PKG",16,22,1,"PAH",1,1,1,0)
PCMM output issues
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","SCRPPAT2")
0^5^B25879576
"RTN","SCRPPAT2",1,0)
SCRPPAT2 ;ALB/CMM - Practitioner's Patients ; 18 Feb 99  3:02 PM
"RTN","SCRPPAT2",2,0)
 ;;5.3;Scheduling;**41,48,174,181**;AUG 13, 1993
"RTN","SCRPPAT2",3,0)
 ;
"RTN","SCRPPAT2",4,0)
 ;Listing of Practitioner's Patients
"RTN","SCRPPAT2",5,0)
 ;
"RTN","SCRPPAT2",6,0)
DRIVE ;
"RTN","SCRPPAT2",7,0)
 ;driver module
"RTN","SCRPPAT2",8,0)
 N PRAC,INF,ARRY,ERROR,NXT,OKAY,PIEN,TPRC
"RTN","SCRPPAT2",9,0)
 S ARRY="^TMP(""SCARRAY"","_$J_")",ERROR="ERR"
"RTN","SCRPPAT2",10,0)
 S TPRC="^TMP(""SCRP"",$J,""PRACT"")" M @TPRC=PRACT
"RTN","SCRPPAT2",11,0)
 K @ARRY,@ERROR,PRACT
"RTN","SCRPPAT2",12,0)
 I @TPRC=1 D ALL^SCRPPAT3 ;all practitioners selected
"RTN","SCRPPAT2",13,0)
 S NXT=0
"RTN","SCRPPAT2",14,0)
 F  S NXT=$O(@TPRC@(NXT)) Q:NXT=""!(NXT'?.N)  D
"RTN","SCRPPAT2",15,0)
 .I @TPRC=0 S PIEN=NXT
"RTN","SCRPPAT2",16,0)
 .I @TPRC=1 S PIEN=$P(@TPRC@(NXT),"^")
"RTN","SCRPPAT2",17,0)
 .K @ARRY,@ERROR
"RTN","SCRPPAT2",18,0)
 .S OKAY=$$PTPR^SCAPMC14(PIEN,"","","",ARRY,ERROR) ;patients for practitioner
"RTN","SCRPPAT2",19,0)
 .I '+OKAY Q
"RTN","SCRPPAT2",20,0)
 .D LOOPPT(ARRY,PIEN) ;loop through patients for practitioner
"RTN","SCRPPAT2",21,0)
 K @ARRY,@ERROR,@TPRC
"RTN","SCRPPAT2",22,0)
 Q
"RTN","SCRPPAT2",23,0)
 ;
"RTN","SCRPPAT2",24,0)
LOOPPT(ARY,PRAC) ;loop through patients for practitioner
"RTN","SCRPPAT2",25,0)
 ;ARY - array of patients for selected practitioner
"RTN","SCRPPAT2",26,0)
 ;PRAC - practitioner ien
"RTN","SCRPPAT2",27,0)
 N NXT,PIEN,TPIEN,PNAME,TPIEN,NODE,PTP,TPI,TPN,CLIEN,CNAME,PTA,PTAN,TIEN
"RTN","SCRPPAT2",28,0)
 N PC,TNODE,TNAME,PINF,POSN
"RTN","SCRPPAT2",29,0)
 S NXT=0
"RTN","SCRPPAT2",30,0)
 F  S NXT=$O(@ARY@(NXT)) Q:NXT=""!(NXT'?.N)  D
"RTN","SCRPPAT2",31,0)
 .S NODE=$G(@ARY@(NXT))
"RTN","SCRPPAT2",32,0)
 .Q:NODE=""
"RTN","SCRPPAT2",33,0)
 .S PIEN=+$P(NODE,"^") ;ien of patient file entry
"RTN","SCRPPAT2",34,0)
 .S TPIEN=+$P(NODE,"^",3) ;ien of patient team position assignment
"RTN","SCRPPAT2",35,0)
 .S PTP=$G(^SCPT(404.43,TPIEN,0))
"RTN","SCRPPAT2",36,0)
 .Q:PTP=""
"RTN","SCRPPAT2",37,0)
 .S PTA=+$P(PTP,"^") ;patient team assignment ien (404.42)
"RTN","SCRPPAT2",38,0)
 .S PTAN=$G(^SCPT(404.42,PTA,0))
"RTN","SCRPPAT2",39,0)
 .Q:PTAN=""
"RTN","SCRPPAT2",40,0)
 .S TIEN=+$P(PTAN,"^",3) ;team file ien (404.51)
"RTN","SCRPPAT2",41,0)
 .I '$D(TEAM(TIEN))&(TEAM'=1) Q  ;not a selected team
"RTN","SCRPPAT2",42,0)
 .S TNODE=$G(^SCTM(404.51,TIEN,0))
"RTN","SCRPPAT2",43,0)
 .Q:TNODE=""
"RTN","SCRPPAT2",44,0)
 .S TNAME=$P(TNODE,"^") ;team name
"RTN","SCRPPAT2",45,0)
 .S TPI=+$P(PTP,"^",2) ;Team Position file ien (404.57)
"RTN","SCRPPAT2",46,0)
 .S TPN=$G(^SCTM(404.57,TPI,0))
"RTN","SCRPPAT2",47,0)
 .Q:TPN=""
"RTN","SCRPPAT2",48,0)
 .S POSN=$P(TPN,"^") ;position name
"RTN","SCRPPAT2",49,0)
 .S CLIEN=+$P(TPN,"^",9) ;associated clinic ien
"RTN","SCRPPAT2",50,0)
 .D CECHK(CLIEN,.CNAME,PIEN) ;is patient enrolled in associated clinic?
"RTN","SCRPPAT2",51,0)
 .;S CNAME=$P($G(^SC(CLIEN,0)),"^") ;clinic name
"RTN","SCRPPAT2",52,0)
 .S PC=$S($P(PTP,"^",5)=0:0,1:1) ;primary care position 1or2-yes/0-no
"RTN","SCRPPAT2",53,0)
 .S PNAME=$P($G(^VA(200,+PRAC,0)),"^") ;practitioner name
"RTN","SCRPPAT2",54,0)
 .Q:PNAME=""
"RTN","SCRPPAT2",55,0)
 .;
"RTN","SCRPPAT2",56,0)
 .S PINF=PIEN_"^"_$$PDATA^SCRPEC(PIEN,CLIEN,1)
"RTN","SCRPPAT2",57,0)
 .;$$PDATA returns pt name,pid,mt,pelig,status,status date,last appt,nxt appt
"RTN","SCRPPAT2",58,0)
 .;
"RTN","SCRPPAT2",59,0)
 .D FORMAT(CNAME,PINF,PC,TIEN,TNAME,PRAC,PNAME,POSN,TPI) ;formats data for display
"RTN","SCRPPAT2",60,0)
 Q
"RTN","SCRPPAT2",61,0)
 ;
"RTN","SCRPPAT2",62,0)
CECHK(CLIEN,CNAME,PIEN) ;
"RTN","SCRPPAT2",63,0)
 ;CLIEN - clinic ien
"RTN","SCRPPAT2",64,0)
 ;CNAME - clinic name returned if patient is enrolled in clien clinic
"RTN","SCRPPAT2",65,0)
 ;PIEN - patien ien
"RTN","SCRPPAT2",66,0)
 ;
"RTN","SCRPPAT2",67,0)
 N EN,NODE
"RTN","SCRPPAT2",68,0)
 S CNAME=""
"RTN","SCRPPAT2",69,0)
 I $D(^DPT(PIEN,"DE","B",CLIEN)) D
"RTN","SCRPPAT2",70,0)
 .;enrolled at one time, check if discharged
"RTN","SCRPPAT2",71,0)
 .S EN=$O(^DPT(PIEN,"DE","B",CLIEN,""))
"RTN","SCRPPAT2",72,0)
 .S NODE=$G(^DPT(PIEN,"DE",EN,0))
"RTN","SCRPPAT2",73,0)
 .Q:NODE=""
"RTN","SCRPPAT2",74,0)
 .I $P(NODE,"^",3)="" S CNAME=$P($G(^SC(CLIEN,0)),"^") ;clinic name
"RTN","SCRPPAT2",75,0)
 .I $P(NODE,"^",3)'="",$P(NODE,"^",3)>DT S CNAME=$P($G(^SC(CLIEN,0)),"^") ;clinic name
"RTN","SCRPPAT2",76,0)
 Q
"RTN","SCRPPAT2",77,0)
 ;
"RTN","SCRPPAT2",78,0)
FORMAT(CNAME,PINF,PC,TIEN,TNAME,PRAC,PNAME,POSN,TPI) ; format data for display
"RTN","SCRPPAT2",79,0)
 ;CNAME - clinic name
"RTN","SCRPPAT2",80,0)
 ;PINF - patient/clinic data
"RTN","SCRPPAT2",81,0)
 ;PC - primary care 1/0
"RTN","SCRPPAT2",82,0)
 ;TIEN - team file ien (#404.51)
"RTN","SCRPPAT2",83,0)
 ;TNAME - team name
"RTN","SCRPPAT2",84,0)
 ;PRAC - practitioner ien (#200)
"RTN","SCRPPAT2",85,0)
 ;PNAME - practitioner name
"RTN","SCRPPAT2",86,0)
 ;POSN - position name
"RTN","SCRPPAT2",87,0)
 ;TPI - team position ien (#404.57)
"RTN","SCRPPAT2",88,0)
 ;
"RTN","SCRPPAT2",89,0)
 N IIEN,INAME,ERR
"RTN","SCRPPAT2",90,0)
 S ERR=$$SETUP^SCRPPAT3(.IIEN,.INAME,TIEN,TNAME,PRAC,PNAME,POSN,TPI)
"RTN","SCRPPAT2",91,0)
 I ERR Q
"RTN","SCRPPAT2",92,0)
 ;
"RTN","SCRPPAT2",93,0)
 I SORT=1 D STOR(IIEN,TIEN,PRAC,PINF,PNAME,TNAME,TPI) ;sort division,team,practitioner
"RTN","SCRPPAT2",94,0)
 I SORT=2 D STOR(IIEN,PRAC,TIEN,PINF,PNAME,TNAME,TPI) ;sort division,practitioner,team
"RTN","SCRPPAT2",95,0)
 ;
"RTN","SCRPPAT2",96,0)
 Q
"RTN","SCRPPAT2",97,0)
 ;
"RTN","SCRPPAT2",98,0)
STOR(IIEN,SEC,TRD,PINF,PNAME,TNAME,TPI) ;
"RTN","SCRPPAT2",99,0)
 ;IIEN - ien institution
"RTN","SCRPPAT2",100,0)
 ;SEC - second sort subscript, IEN team or IEN practitioner
"RTN","SCRPPAT2",101,0)
 ;TRD - third sort subscript, IEN team or IEN practitioner
"RTN","SCRPPAT2",102,0)
 ;PINF - patient/clinic info
"RTN","SCRPPAT2",103,0)
 ;PNAME - practitioner name
"RTN","SCRPPAT2",104,0)
 ;TNAME - team name
"RTN","SCRPPAT2",105,0)
 ;TPI - team position ien
"RTN","SCRPPAT2",106,0)
 ;
"RTN","SCRPPAT2",107,0)
 N PIEN,PTNAME,PID
"RTN","SCRPPAT2",108,0)
 S PIEN=+$P(PINF,"^") ;patient ien 
"RTN","SCRPPAT2",109,0)
 S PTNAME=$E($P(PINF,"^",2),1,15) ;patient name
"RTN","SCRPPAT2",110,0)
 I $D(@STORE@("PT",IIEN,SEC,TRD,TPI,PTNAME,PIEN)) Q
"RTN","SCRPPAT2",111,0)
 ;
"RTN","SCRPPAT2",112,0)
 S @STORE@("PT",IIEN,SEC,TRD,TPI,PTNAME,PIEN)=""
"RTN","SCRPPAT2",113,0)
 ;
"RTN","SCRPPAT2",114,0)
 I '$D(@STORE@("PTOT",IIEN,SEC,TRD,PIEN)) D
"RTN","SCRPPAT2",115,0)
 .;count each unique patient for any given practitioner for grand total
"RTN","SCRPPAT2",116,0)
 .S @STORE@("PTOT",IIEN,SEC,TRD,PIEN)=""
"RTN","SCRPPAT2",117,0)
 .S @STORE@("TOTAL",IIEN,PRAC,0)=$G(@STORE@("TOTAL",IIEN,PRAC,0))+1 ;patient count by practitioner
"RTN","SCRPPAT2",118,0)
 ;
"RTN","SCRPPAT2",119,0)
 S @STORE@("TOTAL",IIEN,PRAC,TIEN,TPI)=$G(@STORE@("TOTAL",IIEN,PRAC,TIEN,TPI))+1 ;patient count by practitioner and team
"RTN","SCRPPAT2",120,0)
 ;
"RTN","SCRPPAT2",121,0)
 S @STORE@(IIEN,SEC,TRD,TPI,PIEN)=PTNAME
"RTN","SCRPPAT2",122,0)
 S PID=$P(PINF,"^",3),PID=$TR(PID,"-","")
"RTN","SCRPPAT2",123,0)
 S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),18)=$E(PID,6,10) ;last 4 pid - 5 places is for any pseudo
"RTN","SCRPPAT2",124,0)
 S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),25)=$P(PINF,"^",4) ;means test status
"RTN","SCRPPAT2",125,0)
 S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),31)=$P(PINF,"^",5) ;eligibility
"RTN","SCRPPAT2",126,0)
 ;Removed by patch 174
"RTN","SCRPPAT2",127,0)
 ;S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),40)=$P(PINF,"^",6) ;patient status
"RTN","SCRPPAT2",128,0)
 S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),42)=$P(PINF,"^",8) ;last appt
"RTN","SCRPPAT2",129,0)
 S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),54)=$P(PINF,"^",9) ;nxt appt
"RTN","SCRPPAT2",130,0)
 S $E(@STORE@(IIEN,SEC,TRD,TPI,PIEN),66)=$E(CNAME,1,15) ;clinic
"RTN","SCRPPAT2",131,0)
 ;
"RTN","SCRPPAT2",132,0)
 Q
"RTN","SCRPPAT2",133,0)
 ;
"RTN","SCRPPAT3")
0^6^B25320257
"RTN","SCRPPAT3",1,0)
SCRPPAT3 ;ALB/CMM - Practitioner's Patients ; 18 Feb 99  2:58 PM
"RTN","SCRPPAT3",2,0)
 ;;5.3;Scheduling;**41,52,148,174,181**;AUG 13, 1993
"RTN","SCRPPAT3",3,0)
 ;
"RTN","SCRPPAT3",4,0)
 ;Listing of Practitioner's Patients
"RTN","SCRPPAT3",5,0)
 ;
"RTN","SCRPPAT3",6,0)
PAT(INS,SEC,TRD,SEC3,ST3,ST4,POS) ;
"RTN","SCRPPAT3",7,0)
 ;writes patients for position/practitioner
"RTN","SCRPPAT3",8,0)
 N PTN,PT,FIRST
"RTN","SCRPPAT3",9,0)
 S PTN="",FIRST=1
"RTN","SCRPPAT3",10,0)
 I SUMM D TOTAL1^SCRPPAT3(INS,SEC,TRD,POS) Q  ;Summary only
"RTN","SCRPPAT3",11,0)
 F  S PTN=$O(@STORE@("PT",INS,SEC,TRD,POS,PTN)) Q:PTN=""!(STOP)  D
"RTN","SCRPPAT3",12,0)
 .S PT=0
"RTN","SCRPPAT3",13,0)
 .F  S PT=$O(@STORE@("PT",INS,SEC,TRD,POS,PTN,PT)) Q:'PT!(STOP)  D
"RTN","SCRPPAT3",14,0)
 ..I (IOST'?1"C-".E),$Y>(IOSL-10) D NEWP1^SCRPU3(.PAGE,TITL) D:'STOP HEAD2(INS,SEC,TRD,SEC3,ST3,ST4,POS) D:'FIRST&'STOP HEADER
"RTN","SCRPPAT3",15,0)
 ..I (IOST?1"C-".E),$Y>(IOSL-10) D HOLD^SCRPU3(.PAGE,TITL) D:'STOP HEAD2(INS,SEC,TRD,SEC3,ST3,ST4,POS) D:'FIRST&'STOP HEADER
"RTN","SCRPPAT3",16,0)
 ..Q:STOP
"RTN","SCRPPAT3",17,0)
 ..I FIRST D HEADER S FIRST=0
"RTN","SCRPPAT3",18,0)
 ..W !,$G(@STORE@(INS,SEC,TRD,POS,PT)) ;print patient detail line
"RTN","SCRPPAT3",19,0)
 ..Q
"RTN","SCRPPAT3",20,0)
 .Q
"RTN","SCRPPAT3",21,0)
 Q
"RTN","SCRPPAT3",22,0)
 ;
"RTN","SCRPPAT3",23,0)
SPRINT(STORE,IOP,TITL,SORT) ; Summary Print Only
"RTN","SCRPPAT3",24,0)
 ;STORE - global location of data
"RTN","SCRPPAT3",25,0)
 ;IOP - device to print to
"RTN","SCRPPAT3",26,0)
 ;TITL - title of report
"RTN","SCRPPAT3",27,0)
 ;SORT - sort order 1-div,team,pract/2-div,pract,team
"RTN","SCRPPAT3",28,0)
 ;
"RTN","SCRPPAT3",29,0)
 N PAGE
"RTN","SCRPPAT3",30,0)
 S PAGE=1,STOP=0
"RTN","SCRPPAT3",31,0)
 D OPEN^SCRPU3
"RTN","SCRPPAT3",32,0)
 Q:$G(POP)
"RTN","SCRPPAT3",33,0)
 D TITLE^SCRPU3(.PAGE,TITL)
"RTN","SCRPPAT3",34,0)
 D CLOSE^SCRPU3
"RTN","SCRPPAT3",35,0)
 Q
"RTN","SCRPPAT3",36,0)
 ;
"RTN","SCRPPAT3",37,0)
TOTAL1(INS,SEC,TRD,POS) ;
"RTN","SCRPPAT3",38,0)
 ;print team/practitioner total
"RTN","SCRPPAT3",39,0)
 N TEM,PRC
"RTN","SCRPPAT3",40,0)
 I SORT=1 S TEM=SEC,PRC=TRD
"RTN","SCRPPAT3",41,0)
 I SORT=2 S TEM=TRD,PRC=SEC
"RTN","SCRPPAT3",42,0)
 W !!,$G(@STORE@("TH",INS,PRC,TEM,POS)),$G(@STORE@("TOTAL",INS,PRC,TEM,POS))
"RTN","SCRPPAT3",43,0)
 W !!
"RTN","SCRPPAT3",44,0)
 Q
"RTN","SCRPPAT3",45,0)
 ;
"RTN","SCRPPAT3",46,0)
TOTAL2(INS) ;
"RTN","SCRPPAT3",47,0)
 ;print practitioners' totals
"RTN","SCRPPAT3",48,0)
 N PRC,FIRST
"RTN","SCRPPAT3",49,0)
 S PRC="",FIRST=1
"RTN","SCRPPAT3",50,0)
 F  S PRC=$O(@STORE@("TH",INS,PRC)) Q:PRC=""!(STOP)  D
"RTN","SCRPPAT3",51,0)
 .I (IOST'?1"C-".E),$Y>(IOSL-8) D NEWP1^SCRPU3(.PAGE,TITL)
"RTN","SCRPPAT3",52,0)
 .I (IOST?1"C-".E),$Y>(IOSL-8) D HOLD^SCRPU3(.PAGE,TITL)
"RTN","SCRPPAT3",53,0)
 .Q:STOP
"RTN","SCRPPAT3",54,0)
 .I FIRST W !,"Practitioner Patient Panel Totals:",! S FIRST=0
"RTN","SCRPPAT3",55,0)
 .W !!,$G(@STORE@("TH",INS,PRC)),$G(@STORE@("TOTAL",INS,PRC,0))
"RTN","SCRPPAT3",56,0)
 I 'STOP W !!,$G(@STORE@("TH",INS)),!
"RTN","SCRPPAT3",57,0)
 Q
"RTN","SCRPPAT3",58,0)
 ;
"RTN","SCRPPAT3",59,0)
HEAD2(INS,SEC,TRD,SEC3,ST3,ST4,POS) ;
"RTN","SCRPPAT3",60,0)
 I (SEC3="""TN""")&($D(@ST4@(INS,TRD,SEC))) D
"RTN","SCRPPAT3",61,0)
 .W !,$G(@ST3@(INS,SEC)) ;write team (sort 1)
"RTN","SCRPPAT3",62,0)
 .W !,$G(@ST4@(INS,TRD,SEC,POS)) ;write practitioner (sort 2)
"RTN","SCRPPAT3",63,0)
 I (SEC3="""PN""")&($D(@ST3@(INS,SEC,TRD))) D
"RTN","SCRPPAT3",64,0)
 .W !,$G(@ST3@(INS,SEC,TRD,POS)) ;write practitioner (sort 1)
"RTN","SCRPPAT3",65,0)
 .W !,$G(@ST4@(INS,TRD)) ;write team (sort 2)
"RTN","SCRPPAT3",66,0)
 Q
"RTN","SCRPPAT3",67,0)
 ;
"RTN","SCRPPAT3",68,0)
HEADER ;
"RTN","SCRPPAT3",69,0)
 N NXT
"RTN","SCRPPAT3",70,0)
 W !
"RTN","SCRPPAT3",71,0)
 F NXT="H1","H2","H3" W !,$G(@STORE@(NXT))
"RTN","SCRPPAT3",72,0)
 W !
"RTN","SCRPPAT3",73,0)
 Q
"RTN","SCRPPAT3",74,0)
 ;
"RTN","SCRPPAT3",75,0)
SHEAD ;
"RTN","SCRPPAT3",76,0)
 S @STORE@("H2")="Pt Name"
"RTN","SCRPPAT3",77,0)
 S $E(@STORE@("H2"),18)="Pt ID"
"RTN","SCRPPAT3",78,0)
 S $E(@STORE@("H1"),25)="M.T."
"RTN","SCRPPAT3",79,0)
 S $E(@STORE@("H2"),25)="Stat"
"RTN","SCRPPAT3",80,0)
 S $E(@STORE@("H1"),31)="Prim"
"RTN","SCRPPAT3",81,0)
 S $E(@STORE@("H2"),31)="Elig"
"RTN","SCRPPAT3",82,0)
 ;Removed by patch 174
"RTN","SCRPPAT3",83,0)
 ;S $E(@STORE@("H1"),39)="Pat"
"RTN","SCRPPAT3",84,0)
 ;S $E(@STORE@("H2"),39)="Stat"
"RTN","SCRPPAT3",85,0)
 S $E(@STORE@("H1"),42)="Last"
"RTN","SCRPPAT3",86,0)
 S $E(@STORE@("H2"),42)="Appt"
"RTN","SCRPPAT3",87,0)
 S $E(@STORE@("H1"),54)="Next"
"RTN","SCRPPAT3",88,0)
 S $E(@STORE@("H2"),54)="Appt"
"RTN","SCRPPAT3",89,0)
 S $E(@STORE@("H2"),66)="Clinic"
"RTN","SCRPPAT3",90,0)
 S $P(@STORE@("H3"),"=",81)=""
"RTN","SCRPPAT3",91,0)
 Q
"RTN","SCRPPAT3",92,0)
ALL ;
"RTN","SCRPPAT3",93,0)
 ;get all practitioners for all teams selected
"RTN","SCRPPAT3",94,0)
 I TEAM=1 D TALL ;all teams selected
"RTN","SCRPPAT3",95,0)
 N TIEN,OKAY
"RTN","SCRPPAT3",96,0)
 S TIEN=""
"RTN","SCRPPAT3",97,0)
 F  S TIEN=$O(TEAM(TIEN)) Q:TIEN=""!(TIEN'?.N)  D
"RTN","SCRPPAT3",98,0)
 .I $D(TEAM(TIEN)) D
"RTN","SCRPPAT3",99,0)
 ..S OKAY=$$PRTM^SCAPMC1(TIEN,"","","",TPRC,"ERROR")
"RTN","SCRPPAT3",100,0)
 Q
"RTN","SCRPPAT3",101,0)
 ;
"RTN","SCRPPAT3",102,0)
TALL ;
"RTN","SCRPPAT3",103,0)
 ;get all active team for divisions selected
"RTN","SCRPPAT3",104,0)
 N NXT,IIEN,NODE
"RTN","SCRPPAT3",105,0)
 S NXT=0,IIEN=""
"RTN","SCRPPAT3",106,0)
 ;$O through team file and find all active teams for selected divisions
"RTN","SCRPPAT3",107,0)
 F  S IIEN=$O(^SCTM(404.51,"AINST",IIEN)) Q:IIEN=""  D
"RTN","SCRPPAT3",108,0)
 .I INST=1!$D(INST(IIEN)) D
"RTN","SCRPPAT3",109,0)
 ..S TIEN=0
"RTN","SCRPPAT3",110,0)
 ..F  S TIEN=$O(^SCTM(404.51,"AINST",IIEN,TIEN)) Q:TIEN=""  D
"RTN","SCRPPAT3",111,0)
 ...I $$ACTTM^SCMCTMU(TIEN) S TEAM(TIEN)=""
"RTN","SCRPPAT3",112,0)
 Q
"RTN","SCRPPAT3",113,0)
 ;
"RTN","SCRPPAT3",114,0)
SETUP(IIEN,INAME,TIEN,TNAME,PRAC,PNAME,POSN,TPI) ;
"RTN","SCRPPAT3",115,0)
 ;setup data
"RTN","SCRPPAT3",116,0)
 S IIEN=+$P($G(^SCTM(404.51,TIEN,0)),"^",7) ;institution ien
"RTN","SCRPPAT3",117,0)
 S INAME=$P($G(^DIC(4,IIEN,0)),"^") ;institution name
"RTN","SCRPPAT3",118,0)
 I INAME="" S INAME="[BAD DATA]"
"RTN","SCRPPAT3",119,0)
 ;
"RTN","SCRPPAT3",120,0)
 I PNAME="" S PNAME="[BAD DATA]"
"RTN","SCRPPAT3",121,0)
 I TNAME="" S TNAME="[BAD DATA]"
"RTN","SCRPPAT3",122,0)
 I '$D(@STORE@("PN",IIEN,PRAC,TIEN,TPI)) S @STORE@("PN",IIEN,PRAC,TIEN,TPI)="Practitioner: "_PNAME_" ("_POSN_")"
"RTN","SCRPPAT3",123,0)
 I '$D(@STORE@("TN",IIEN,TIEN)) S @STORE@("TN",IIEN,TIEN)="Team: "_TNAME
"RTN","SCRPPAT3",124,0)
 ;
"RTN","SCRPPAT3",125,0)
 I '$D(@STORE@("I",INAME,IIEN)) S @STORE@("I",INAME,IIEN)="",@STORE@(IIEN)="Division: "_INAME
"RTN","SCRPPAT3",126,0)
 I '$D(@STORE@("T",IIEN,TNAME,TIEN)) S @STORE@("T",IIEN,TNAME,TIEN)=""
"RTN","SCRPPAT3",127,0)
 I '$D(@STORE@("P",IIEN,PNAME,PRAC,TPI)) S @STORE@("P",IIEN,PNAME,PRAC,TPI)=""
"RTN","SCRPPAT3",128,0)
 I '$D(@STORE@("TOTAL",IIEN,PRAC,0)) S @STORE@("TOTAL",IIEN,PRAC,0)=0
"RTN","SCRPPAT3",129,0)
 I '$D(@STORE@("TOTAL",IIEN,PRAC,TIEN)) S @STORE@("TOTAL",IIEN,PRAC,TIEN)=0
"RTN","SCRPPAT3",130,0)
 ;
"RTN","SCRPPAT3",131,0)
 S @STORE@("TH",IIEN,PRAC)="Patient Panel Count for "_PNAME_": "
"RTN","SCRPPAT3",132,0)
 S @STORE@("TH",IIEN,PRAC,TIEN,TPI)="Patient Count for "_PNAME_" ("_POSN_") on Team "_TNAME_": "
"RTN","SCRPPAT3",133,0)
 ;
"RTN","SCRPPAT3",134,0)
 S @STORE@("TH",IIEN)="** Note: Patient Panel Count is a count of unique patients for each practitioner"
"RTN","SCRPPAT3",135,0)
 Q 0
"RTN","SCRPPAT3",136,0)
 ;
"RTN","SCRPTA")
0^3^B29618145
"RTN","SCRPTA",1,0)
SCRPTA ;ALB/CMM - Patient Listing w/Team Assignment Data ; 18 Feb 99  5:20 PM
"RTN","SCRPTA",2,0)
 ;;5.3;Scheduling;**41,48,52,114,174,181**;AUG 13, 1993
"RTN","SCRPTA",3,0)
 ;
"RTN","SCRPTA",4,0)
 ;Patient Listing w/Team Assignment Data Report
"RTN","SCRPTA",5,0)
 ;
"RTN","SCRPTA",6,0)
PROMPTS ;
"RTN","SCRPTA",7,0)
 ;Prompt for Institution, Team, Role, Practitioner and Print device
"RTN","SCRPTA",8,0)
 ;
"RTN","SCRPTA",9,0)
 N PRNT,QTIME,NUMBER
"RTN","SCRPTA",10,0)
 K VAUTD,VAUTT,VAUTR,VAUTP,VAUTPP,SCUP
"RTN","SCRPTA",11,0)
 S QTIME=""
"RTN","SCRPTA",12,0)
 D INST^SCRPU1 I Y=-1 G ERR
"RTN","SCRPTA",13,0)
 K Y D PRMTT^SCRPU1 I '$D(VAUTT) G ERR
"RTN","SCRPTA",14,0)
 K Y D ROLE^SCRPU1 I '$D(VAUTR) G ERR
"RTN","SCRPTA",15,0)
 K Y S VAUTPP="" D PRACT^SCRPU1 K VAUTPP I '$D(VAUTP) G ERR
"RTN","SCRPTA",16,0)
 S PRNT=$$PDEVICE^SCRPU3()
"RTN","SCRPTA",17,0)
 I PRNT=-1 G ERR
"RTN","SCRPTA",18,0)
 I PRNT["Q;" S QTIME=$$GETTIME^SCRPU3()
"RTN","SCRPTA",19,0)
 I QTIME=-1 G ERR
"RTN","SCRPTA",20,0)
 I PRNT'?1"Q;".E S PRNT="Q;"_PRNT
"RTN","SCRPTA",21,0)
 K Y
"RTN","SCRPTA",22,0)
 S NUMBER=$$ENTRY2(.VAUTD,.VAUTT,.VAUTR,.VAUTP,PRNT,QTIME)
"RTN","SCRPTA",23,0)
 I NUMBER>0 W !!,"Print queued, task number: ",NUMBER
"RTN","SCRPTA",24,0)
 Q
"RTN","SCRPTA",25,0)
 ;
"RTN","SCRPTA",26,0)
ENTRY2(INST,TEAM,ROLE,PRACT,IOP,ZTDTH) ;
"RTN","SCRPTA",27,0)
 ;Second entry point for GUI to use
"RTN","SCRPTA",28,0)
 ;Input Parameters:
"RTN","SCRPTA",29,0)
 ;INST - institutions selected (variable and array)
"RTN","SCRPTA",30,0)
 ;TEAM - teams selected (variable and array)
"RTN","SCRPTA",31,0)
 ;ROLE - roles selected (variable and array)
"RTN","SCRPTA",32,0)
 ;PRACT - practitioners selected (variable and array)
"RTN","SCRPTA",33,0)
 ;IOP - print device
"RTN","SCRPTA",34,0)
 ;ZTDTH - queue time (optional)
"RTN","SCRPTA",35,0)
 ;
"RTN","SCRPTA",36,0)
 ;validate parameters
"RTN","SCRPTA",37,0)
 I '$D(INST)!'$D(TEAM)!'$D(ROLE)!'$D(PRACT)!'$D(IOP)!(IOP="") Q
"RTN","SCRPTA",38,0)
 ;
"RTN","SCRPTA",39,0)
 N NUMBER
"RTN","SCRPTA",40,0)
 S IOST=$P(IOP,"^",2),IOP=$P(IOP,"^")
"RTN","SCRPTA",41,0)
 I IOP?1"Q;".E S IOP=$P(IOP,"Q;",2)
"RTN","SCRPTA",42,0)
 I IOST?1"C-".E D QENTRY G RET
"RTN","SCRPTA",43,0)
 I ZTDTH="" S ZTDTH=$H
"RTN","SCRPTA",44,0)
 S ZTRTN="QENTRY^SCRPTA"
"RTN","SCRPTA",45,0)
 S ZTDESC="Patient Listing w/Team Assignment",ZTIO=IOP
"RTN","SCRPTA",46,0)
 N II
"RTN","SCRPTA",47,0)
 F II="INST","TEAM","ROLE","INST(","TEAM(","PRACT","PRACT(","ROLE(","IOP" S ZTSAVE(II)=""
"RTN","SCRPTA",48,0)
 D ^%ZTLOAD
"RTN","SCRPTA",49,0)
RET S NUMBER=0
"RTN","SCRPTA",50,0)
 I $D(ZTSK) S NUMBER=ZTSK
"RTN","SCRPTA",51,0)
 D EXIT1
"RTN","SCRPTA",52,0)
 Q NUMBER
"RTN","SCRPTA",53,0)
 ;
"RTN","SCRPTA",54,0)
QENTRY ;
"RTN","SCRPTA",55,0)
 ;driver entry point
"RTN","SCRPTA",56,0)
 S TITL="Patient Listing w/Team Assignment Data"
"RTN","SCRPTA",57,0)
 S STORE="^TMP("_$J_",""SCRPTA"")"
"RTN","SCRPTA",58,0)
 K @STORE
"RTN","SCRPTA",59,0)
 S @STORE=0
"RTN","SCRPTA",60,0)
 I TEAM=1 D TALL^SCRPPAT3 S TEAM=0
"RTN","SCRPTA",61,0)
 D FIND
"RTN","SCRPTA",62,0)
 I $O(@STORE@(0))="" S NODATA=$$NODATA^SCRPU3(TITL)
"RTN","SCRPTA",63,0)
 I '$D(NODATA) D PRINTIT(STORE,IOP,TITL)
"RTN","SCRPTA",64,0)
 D EXIT2
"RTN","SCRPTA",65,0)
 Q
"RTN","SCRPTA",66,0)
 ;
"RTN","SCRPTA",67,0)
ERR ;
"RTN","SCRPTA",68,0)
EXIT1 ;
"RTN","SCRPTA",69,0)
 K ZTDTH,ZTRTN,ZTDESC,ZTSK,ZTIO,ZTSAVE,Y,SCUP
"RTN","SCRPTA",70,0)
 Q
"RTN","SCRPTA",71,0)
 ;
"RTN","SCRPTA",72,0)
EXIT2 ;
"RTN","SCRPTA",73,0)
 K @STORE
"RTN","SCRPTA",74,0)
 K STOP,STORE,TITL,IOP,TEAM,INST,ROLE,NODATA,PRACT
"RTN","SCRPTA",75,0)
 Q
"RTN","SCRPTA",76,0)
 ;
"RTN","SCRPTA",77,0)
FIND ;
"RTN","SCRPTA",78,0)
 N NXT,TLIST,TERR,CNT,ERR1,TNODE,NODE1,PIEN,PTAIEN
"RTN","SCRPTA",79,0)
 S NXT=0,TLIST="^TMP("_$J_",""SCRPTA"",""LIST1"")",TERR="ERR1"
"RTN","SCRPTA",80,0)
 K @TLIST,@TERR
"RTN","SCRPTA",81,0)
 F  S NXT=$O(TEAM(NXT)) Q:NXT=""!(NXT'?.N)  D
"RTN","SCRPTA",82,0)
 .S ERR1=$$PTTM^SCAPMC2(NXT,,.TLIST,.TERR) ;Patients assigned to team NXT
"RTN","SCRPTA",83,0)
 .Q:ERR1=0
"RTN","SCRPTA",84,0)
 .S CNT=0
"RTN","SCRPTA",85,0)
 .F  S CNT=$O(@TLIST@(CNT)) Q:CNT=""!(CNT'?.N)  D
"RTN","SCRPTA",86,0)
 ..S TNODE=$G(@TLIST@(CNT))
"RTN","SCRPTA",87,0)
 ..Q:TNODE=""
"RTN","SCRPTA",88,0)
 ..S PIEN=+$P(TNODE,"^") ;patient ien
"RTN","SCRPTA",89,0)
 ..S PTAIEN=+$P(TNODE,"^",3) ;ien Patient Team Assignment #404.42
"RTN","SCRPTA",90,0)
 ..D CHK^SCRPTA2(PTAIEN,PIEN)
"RTN","SCRPTA",91,0)
 .K @TLIST,@TERR
"RTN","SCRPTA",92,0)
 K @TLIST,@TERR
"RTN","SCRPTA",93,0)
 Q
"RTN","SCRPTA",94,0)
 ;
"RTN","SCRPTA",95,0)
PRINTIT(STORE,IOP,TITL) ;
"RTN","SCRPTA",96,0)
 D OPEN^SCRPU3
"RTN","SCRPTA",97,0)
 Q:$G(POP)
"RTN","SCRPTA",98,0)
 N NXT,PAGE,NPAGE,INTN,TMN,INT,TM,PRN,PR,NEW,POS
"RTN","SCRPTA",99,0)
 S (NPAGE,STOP)=0,PAGE=1,(INTN,NEW)=""
"RTN","SCRPTA",100,0)
 D SHEAD ;setup headers
"RTN","SCRPTA",101,0)
 D TITLE^SCRPU3(.PAGE,TITL) ;write title
"RTN","SCRPTA",102,0)
 F  S INTN=$O(@STORE@("I",INTN)) Q:INTN=""!(STOP)  D
"RTN","SCRPTA",103,0)
 .S INT=$O(@STORE@("I",INTN,"")) ;institution
"RTN","SCRPTA",104,0)
 .Q:INT=""
"RTN","SCRPTA",105,0)
 .I '$D(NEW),(IOST'?1"C-".E) D NEWP1^SCRPU3(.PAGE,TITL)
"RTN","SCRPTA",106,0)
 .I '$D(NEW),(IOST?1"C-".E) D HOLD^SCRPU3(.PAGE,TITL)
"RTN","SCRPTA",107,0)
 .Q:STOP
"RTN","SCRPTA",108,0)
 .W !,$G(@STORE@(INT))
"RTN","SCRPTA",109,0)
 .K NEW
"RTN","SCRPTA",110,0)
 .S TMN=""
"RTN","SCRPTA",111,0)
 .F  S TMN=$O(@STORE@("T",INT,TMN)) Q:TMN=""!(STOP)  D
"RTN","SCRPTA",112,0)
 ..S TM=$O(@STORE@("T",INT,TMN,"")) ;team
"RTN","SCRPTA",113,0)
 ..Q:TM=""
"RTN","SCRPTA",114,0)
 ..I (IOST'?1"C-".E),$Y>(IOSL-8) D NEWP1^SCRPU3(.PAGE,TITL) W:'STOP !,$G(@STORE@(INT))
"RTN","SCRPTA",115,0)
 ..I (IOST?1"C-".E),$Y>(IOSL-8) D HOLD^SCRPU3(.PAGE,TITL) W:'STOP !,$G(@STORE@(INT))
"RTN","SCRPTA",116,0)
 ..Q:STOP
"RTN","SCRPTA",117,0)
 ..W !!,$G(@STORE@(INT,TM))
"RTN","SCRPTA",118,0)
 ..I (IOST'?1"C-".E),$Y>(IOSL-10) D NEWP1^SCRPU3(.PAGE,TITL) W:'STOP !,$G(@STORE@(INT)),!!,$G(@STORE@(INT,TM))
"RTN","SCRPTA",119,0)
 ..I (IOST?1"C-".E),$Y>(IOSL-10) D HOLD^SCRPU3(.PAGE,TITL) W:'STOP !,$G(@STORE@(INT)),!!,$G(@STORE@(INT,TM))
"RTN","SCRPTA",120,0)
 ..Q:STOP
"RTN","SCRPTA",121,0)
 ..S PRN=""
"RTN","SCRPTA",122,0)
 ..D HEADER
"RTN","SCRPTA",123,0)
 ..F  S PRN=$O(@STORE@("P",INT,TM,PRN)) Q:PRN=""!(STOP)  D
"RTN","SCRPTA",124,0)
 ...S PR=$O(@STORE@("P",INT,TM,PRN,"")) ;practitioner
"RTN","SCRPTA",125,0)
 ...Q:PR=""
"RTN","SCRPTA",126,0)
 ...S POS=""
"RTN","SCRPTA",127,0)
 ...F  S POS=$O(@STORE@("P",INT,TM,PRN,PR,POS)) Q:POS=""!(STOP)  D
"RTN","SCRPTA",128,0)
 ....D PRNT(INT,TM,PR,POS)
"RTN","SCRPTA",129,0)
 D CLOSE^SCRPU3
"RTN","SCRPTA",130,0)
 Q
"RTN","SCRPTA",131,0)
 ;
"RTN","SCRPTA",132,0)
PRNT(INT,TM,PR,POS) ;
"RTN","SCRPTA",133,0)
 ;INT - institution ien
"RTN","SCRPTA",134,0)
 ;TM - team ien
"RTN","SCRPTA",135,0)
 ;PR - practitioner ien
"RTN","SCRPTA",136,0)
 ;POS - position ien
"RTN","SCRPTA",137,0)
 ;
"RTN","SCRPTA",138,0)
 N PTIEN,PTNAME
"RTN","SCRPTA",139,0)
 S PTNAME=""
"RTN","SCRPTA",140,0)
 F  S PTNAME=$O(@STORE@(INT,TM,PR,POS,PTNAME)) Q:PTNAME=""!(STOP)  D
"RTN","SCRPTA",141,0)
 .S PTIEN=""
"RTN","SCRPTA",142,0)
 .F  S PTIEN=$O(@STORE@(INT,TM,PR,POS,PTNAME,PTIEN)) Q:PTIEN=""!(STOP)  D
"RTN","SCRPTA",143,0)
 ..I (IOST'?1"C-".E),$Y>(IOSL-4) D NEWP1^SCRPU3(.PAGE,TITL) W:'STOP !,$G(@STORE@(INT)),!!,$G(@STORE@(INT,TM)) D:'STOP HEADER
"RTN","SCRPTA",144,0)
 ..I (IOST?1"C-".E),$Y>(IOSL-4) D HOLD^SCRPU3(.PAGE,TITL) W:'STOP !,$G(@STORE@(INT)),!!,$G(@STORE@(INT,TM)) D:'STOP HEADER
"RTN","SCRPTA",145,0)
 ..Q:STOP
"RTN","SCRPTA",146,0)
 ..W !,$G(@STORE@(INT,TM,PR,POS,PTNAME,PTIEN))
"RTN","SCRPTA",147,0)
 .Q
"RTN","SCRPTA",148,0)
 Q
"RTN","SCRPTA",149,0)
 ;
"RTN","SCRPTA",150,0)
HEADER ;
"RTN","SCRPTA",151,0)
 ;write column headers
"RTN","SCRPTA",152,0)
 N EN
"RTN","SCRPTA",153,0)
 W !
"RTN","SCRPTA",154,0)
 F EN="H1","H2","H3" D
"RTN","SCRPTA",155,0)
 .W !,$G(@STORE@(EN))
"RTN","SCRPTA",156,0)
 Q
"RTN","SCRPTA",157,0)
SHEAD ;
"RTN","SCRPTA",158,0)
 ;setup column headers
"RTN","SCRPTA",159,0)
 S @STORE@("H2")="Pt Name"
"RTN","SCRPTA",160,0)
 S $E(@STORE@("H2"),23)="Pt ID"
"RTN","SCRPTA",161,0)
 S $E(@STORE@("H2"),30)="Practitioner"
"RTN","SCRPTA",162,0)
 S $E(@STORE@("H2"),52)="Position"
"RTN","SCRPTA",163,0)
 S $E(@STORE@("H1"),71)="Date"
"RTN","SCRPTA",164,0)
 S $E(@STORE@("H2"),71)="Assigned"
"RTN","SCRPTA",165,0)
 S $P(@STORE@("H3"),"=",81)=""
"RTN","SCRPTA",166,0)
 Q
"RTN","SCRPTA2")
0^4^B25111103
"RTN","SCRPTA2",1,0)
SCRPTA2 ;ALB/CMM - Patient Listing w/Team Assignment Data ; 18 Feb 99  5:14 PM
"RTN","SCRPTA2",2,0)
 ;;5.3;Scheduling;**41,88,140,148,174,181**;AUG 13, 1993
"RTN","SCRPTA2",3,0)
 ;
"RTN","SCRPTA2",4,0)
 ;Patient Listing w/Team Assignment Data Report continued
"RTN","SCRPTA2",5,0)
 ;
"RTN","SCRPTA2",6,0)
CHK(PTIEN,PIEN) ;assigned to a position
"RTN","SCRPTA2",7,0)
 ;PTIEN - ien of 404.42 Patient Team Assignment file
"RTN","SCRPTA2",8,0)
 ;PIEN - ien of patient file #2
"RTN","SCRPTA2",9,0)
 ;
"RTN","SCRPTA2",10,0)
 N NODE,START,TPIEN,TPNODE,ROL,PRAC
"RTN","SCRPTA2",11,0)
 S START=""
"RTN","SCRPTA2",12,0)
 Q:'$D(^SCPT(404.43,"B",PTIEN))&(PRACT'="")
"RTN","SCRPTA2",13,0)
 I '$D(^SCPT(404.43,"B",PTIEN))&(PRACT="") D NOTA(PTIEN,PIEN) Q
"RTN","SCRPTA2",14,0)
 F  S START=$O(^SCPT(404.43,"B",PTIEN,START)) Q:START=""  D
"RTN","SCRPTA2",15,0)
 .S NODE=$G(^SCPT(404.43,START,0))
"RTN","SCRPTA2",16,0)
 .Q:NODE=""
"RTN","SCRPTA2",17,0)
 .Q:($P(NODE,"^",4)'="")&($P(NODE,"^",4)<DT)
"RTN","SCRPTA2",18,0)
 .; ^ not assigned currently
"RTN","SCRPTA2",19,0)
 .S TPIEN=+$P(NODE,"^",2) ;team position ien (404.57)
"RTN","SCRPTA2",20,0)
 .I '$D(^SCTM(404.57,TPIEN,0)) D NOTA(PTIEN,PIEN) Q
"RTN","SCRPTA2",21,0)
 .S TPNODE=$G(^SCTM(404.57,TPIEN,0))
"RTN","SCRPTA2",22,0)
 .I TPNODE="" D NOTA(PTIEN,PIEN) Q
"RTN","SCRPTA2",23,0)
 .;
"RTN","SCRPTA2",24,0)
 .S ROL=+$P(TPNODE,"^",3) ;role for position (ien)
"RTN","SCRPTA2",25,0)
 .Q:'$D(ROLE(ROL))&(ROLE'=1)
"RTN","SCRPTA2",26,0)
 .; ^ not a selected role
"RTN","SCRPTA2",27,0)
 .;
"RTN","SCRPTA2",28,0)
 .S PRAC=$$PRACI(TPIEN) ;practitioner information
"RTN","SCRPTA2",29,0)
 .I +PRAC=-1 D NOTA(PTIEN,PIEN) Q
"RTN","SCRPTA2",30,0)
 .I (PRACT'=1)&('$D(PRACT(+PRAC)))&(+PRAC'=0) Q
"RTN","SCRPTA2",31,0)
 .; ^ not a selected practitioner
"RTN","SCRPTA2",32,0)
 .;
"RTN","SCRPTA2",33,0)
 .S POS=$P($G(^SCTM(404.57,TPIEN,0)),"^")
"RTN","SCRPTA2",34,0)
 .D FOUND2(START,NODE,TPIEN,POS,TPNODE,PRAC,PIEN)
"RTN","SCRPTA2",35,0)
 Q
"RTN","SCRPTA2",36,0)
PRACI(TPIEN) ;
"RTN","SCRPTA2",37,0)
 ;TPIEN - team position ien (404.57)
"RTN","SCRPTA2",38,0)
 ;
"RTN","SCRPTA2",39,0)
 N EN,TPLIST,TPERR,NAME,POS,ERR,NPIEN,NODE,POSIEN
"RTN","SCRPTA2",40,0)
 S TPLIST="TPLST",TPERR="ERR2"
"RTN","SCRPTA2",41,0)
 K @TPLIST,@TPERR
"RTN","SCRPTA2",42,0)
 S ERR=$$PRTP^SCAPMC8(TPIEN,,.TPLIST,.TPERR)
"RTN","SCRPTA2",43,0)
 Q:ERR=0!($D(@TPERR)) -1
"RTN","SCRPTA2",44,0)
 S NODE=$G(@TPLIST@(1))
"RTN","SCRPTA2",45,0)
 Q:NODE="" "0^[Not Assigned]"
"RTN","SCRPTA2",46,0)
 S NAME=$P(NODE,"^",2) ;practitioner name
"RTN","SCRPTA2",47,0)
 S NPIEN=+$P(NODE,"^") ;practitioner ien
"RTN","SCRPTA2",48,0)
 S POS=$P(NODE,"^",4) ;position name
"RTN","SCRPTA2",49,0)
 S POSIEN=+$P(NODE,"^",3) ;position ien
"RTN","SCRPTA2",50,0)
 I POS="" S POS="[Not Assigned]",POSIEN=0
"RTN","SCRPTA2",51,0)
 I NAME="" S NAME="[Not Assigned]",NPIEN=0
"RTN","SCRPTA2",52,0)
 K @TPLIST,@TPERR
"RTN","SCRPTA2",53,0)
 Q NPIEN_"^"_NAME_"^"_POS_"^"_POSIEN
"RTN","SCRPTA2",54,0)
 ;
"RTN","SCRPTA2",55,0)
FOUND2(START,NODE,TPIEN,POS,TPNODE,PRAC,PIEN) ;
"RTN","SCRPTA2",56,0)
 ;START - patient team assignment position ien
"RTN","SCRPTA2",57,0)
 ;NODE - patient team position assignment node
"RTN","SCRPTA2",58,0)
 ;TPIEN - team position ien (404.57)
"RTN","SCRPTA2",59,0)
 ;POS - team position
"RTN","SCRPTA2",60,0)
 ;TPNODE - team position node (404.57)
"RTN","SCRPTA2",61,0)
 ;PRAC - practitioner info. NAME IEN^NAME^POS^POSIEN
"RTN","SCRPTA2",62,0)
 ;PIEN - patient ien
"RTN","SCRPTA2",63,0)
 ;
"RTN","SCRPTA2",64,0)
 N PTNAME,PID,ADATE
"RTN","SCRPTA2",65,0)
 S PTNAME=$E($P($G(^DPT(PIEN,0)),"^"),1,20) ;patient name
"RTN","SCRPTA2",66,0)
 S PID=$P($G(^DPT(PIEN,.36)),"^",3),PID=$TR(PID,"-","")
"RTN","SCRPTA2",67,0)
 S PID=$E(PID,6,10) ;last four pid include 5th for pseudo notation
"RTN","SCRPTA2",68,0)
 ;
"RTN","SCRPTA2",69,0)
 S ADATE=$P(NODE,"^",3) ;position assignment date - fm format
"RTN","SCRPTA2",70,0)
 ;convert to external format
"RTN","SCRPTA2",71,0)
 I ADATE'="" S ADATE=$TR($$FMTE^XLFDT(ADATE,"5DF")," ","0")
"RTN","SCRPTA2",72,0)
 ;
"RTN","SCRPTA2",73,0)
 S PNAME=$P(PRAC,"^",2) ;practitioner name
"RTN","SCRPTA2",74,0)
 S PNIEN=$P(PRAC,"^") ;practitioner ien
"RTN","SCRPTA2",75,0)
 ;
"RTN","SCRPTA2",76,0)
 S TIEN=+$P(TPNODE,"^",2) ;ien team file 404.51
"RTN","SCRPTA2",77,0)
 S TMN=$G(^SCTM(404.51,TIEN,0))
"RTN","SCRPTA2",78,0)
 Q:TMN=""
"RTN","SCRPTA2",79,0)
 S TNAME=$P(TMN,"^") ;team name
"RTN","SCRPTA2",80,0)
 S PC=$P(TMN,"^",5) ;primary care team 1/0
"RTN","SCRPTA2",81,0)
 S IIEN=+$P(TMN,"^",7) ;institution ien
"RTN","SCRPTA2",82,0)
 S INAME=$P($G(^DIC(4,IIEN,0)),"^") ;institution
"RTN","SCRPTA2",83,0)
 ;
"RTN","SCRPTA2",84,0)
 D FORMAT(IIEN,INAME,TNAME,TIEN,PC,PTNAME,PID,PNAME,PNIEN,POS,TPIEN,ADATE,PIEN)
"RTN","SCRPTA2",85,0)
 Q
"RTN","SCRPTA2",86,0)
 ;
"RTN","SCRPTA2",87,0)
FORMAT(IIEN,INAME,TNAME,TIEN,PC,PTNAME,PID,PNAME,PIEN,POS,TPIEN,ADATE,PTIEN) ;
"RTN","SCRPTA2",88,0)
 ;IIEN - institution ien
"RTN","SCRPTA2",89,0)
 ;INAME - institution name
"RTN","SCRPTA2",90,0)
 ;TNAME - team name
"RTN","SCRPTA2",91,0)
 ;TIEN - team ien
"RTN","SCRPTA2",92,0)
 ;PC - primary care 1/0
"RTN","SCRPTA2",93,0)
 ;PTNAME - patient name
"RTN","SCRPTA2",94,0)
 ;PID - last 4 pid plus 5th pseudo
"RTN","SCRPTA2",95,0)
 ;PNAME - practitioner name
"RTN","SCRPTA2",96,0)
 ;PIEN - practitioner ien
"RTN","SCRPTA2",97,0)
 ;POS - position name
"RTN","SCRPTA2",98,0)
 ;TPIEN - position ien
"RTN","SCRPTA2",99,0)
 ;ADATE - assignment date
"RTN","SCRPTA2",100,0)
 ;PTIEN - patient ien
"RTN","SCRPTA2",101,0)
 ;
"RTN","SCRPTA2",102,0)
 I INAME="" S INAME="[BAD DATA]"
"RTN","SCRPTA2",103,0)
 I TNAME="" S TNAME="[BAD DATA]"
"RTN","SCRPTA2",104,0)
 I PNAME="" S PNAME="[BAD DATA]"
"RTN","SCRPTA2",105,0)
 I '$D(@STORE@("I",INAME,IIEN)) S @STORE@("I",INAME,IIEN)=""
"RTN","SCRPTA2",106,0)
 I '$D(@STORE@("T",IIEN,TNAME,TIEN)) S @STORE@("T",IIEN,TNAME,TIEN)=""
"RTN","SCRPTA2",107,0)
 I '$D(@STORE@("P",IIEN,TIEN,PNAME,PIEN,TPIEN)) S @STORE@("P",IIEN,TIEN,PNAME,PIEN,TPIEN)=""
"RTN","SCRPTA2",108,0)
 S @STORE@(IIEN)="Division: "_INAME
"RTN","SCRPTA2",109,0)
 S @STORE@(IIEN,TIEN)="Team:  "_TNAME
"RTN","SCRPTA2",110,0)
 S $E(@STORE@(IIEN,TIEN),40)="Primary Care Team: "_$S(PC=1:"YES",1:"NO")
"RTN","SCRPTA2",111,0)
 ;
"RTN","SCRPTA2",112,0)
 S @STORE@(IIEN,TIEN,PIEN,TPIEN,PTNAME,PTIEN)=PTNAME
"RTN","SCRPTA2",113,0)
 S $E(@STORE@(IIEN,TIEN,PIEN,TPIEN,PTNAME,PTIEN),23)=PID
"RTN","SCRPTA2",114,0)
 S $E(@STORE@(IIEN,TIEN,PIEN,TPIEN,PTNAME,PTIEN),30)=$E(PNAME,1,20)
"RTN","SCRPTA2",115,0)
 S $E(@STORE@(IIEN,TIEN,PIEN,TPIEN,PTNAME,PTIEN),52)=$E(POS,1,17)
"RTN","SCRPTA2",116,0)
 S $E(@STORE@(IIEN,TIEN,PIEN,TPIEN,PTNAME,PTIEN),71)=ADATE
"RTN","SCRPTA2",117,0)
 Q
"RTN","SCRPTA2",118,0)
 ;
"RTN","SCRPTA2",119,0)
NOTA(PTIEN,PIEN) ;
"RTN","SCRPTA2",120,0)
 ;PTIEN - patient team assignment (#404.42)
"RTN","SCRPTA2",121,0)
 ;PIEN - patient ien
"RTN","SCRPTA2",122,0)
 N IIEN,INAME,TNAME,TIEN,PC,PTNAME,PID,PNAME,PNIEN,POSIEN,POS,TPIEN,ADATE
"RTN","SCRPTA2",123,0)
 S POS="[Not Assigned]",POSIEN=0
"RTN","SCRPTA2",124,0)
 S PNAME="[Not Assigned]",PNIEN=0
"RTN","SCRPTA2",125,0)
 S ADATE=""
"RTN","SCRPTA2",126,0)
 ;
"RTN","SCRPTA2",127,0)
 S PTNAME=$E($P($G(^DPT(PIEN,0)),"^"),1,20) ;patient name
"RTN","SCRPTA2",128,0)
 S PID=$P($G(^DPT(PIEN,.36)),"^",3),PID=$TR(PID,"-","")
"RTN","SCRPTA2",129,0)
 S PID=$E(PID,6,10) ;last 4 plus 5th for psuedo
"RTN","SCRPTA2",130,0)
 ;
"RTN","SCRPTA2",131,0)
 S TIEN=+$P($G(^SCPT(404.42,PTIEN,0)),"^",3) ;team ien
"RTN","SCRPTA2",132,0)
 S TMN=$G(^SCTM(404.51,TIEN,0))
"RTN","SCRPTA2",133,0)
 Q:TMN=""
"RTN","SCRPTA2",134,0)
 S TNAME=$P(TMN,"^") ;team name
"RTN","SCRPTA2",135,0)
 S PC=$P(TMN,"^",5) ;primary care team 1/0
"RTN","SCRPTA2",136,0)
 S IIEN=+$P(TMN,"^",7) ;institution ien
"RTN","SCRPTA2",137,0)
 S INAME=$P($G(^DIC(4,IIEN,0)),"^") ;institution name
"RTN","SCRPTA2",138,0)
 ;
"RTN","SCRPTA2",139,0)
 D FORMAT(IIEN,INAME,TNAME,TIEN,PC,PTNAME,PID,PNAME,PNIEN,POS,POSIEN,ADATE,PIEN)
"RTN","SCRPTA2",140,0)
 Q
"RTN","SCRPTM")
0^2^B27834508
"RTN","SCRPTM",1,0)
SCRPTM ;ALB/CMM - List of Team's Members Report ; 18 Feb 99 10:00 PM
"RTN","SCRPTM",2,0)
 ;;5.3;Scheduling;**41,48,52,181**;AUG 13, 1993
"RTN","SCRPTM",3,0)
 ;
"RTN","SCRPTM",4,0)
 ;List of Team's Members Report
"RTN","SCRPTM",5,0)
 ;
"RTN","SCRPTM",6,0)
PROMPTS ;
"RTN","SCRPTM",7,0)
 ;Prompt for Institution, Team, Date Range, User Class, Role
"RTN","SCRPTM",8,0)
 ;and Print device
"RTN","SCRPTM",9,0)
 ;
"RTN","SCRPTM",10,0)
 N VAUTD,VAUTT,VAUTUC,VAUTR,QTIME,RANG,PRNT,NUMBER
"RTN","SCRPTM",11,0)
 K VAUTD,VAUTT,VAUTUC,VAUTR,SCUP
"RTN","SCRPTM",12,0)
 S QTIME=""
"RTN","SCRPTM",13,0)
 D INST^SCRPU1 I Y=-1 G ERR
"RTN","SCRPTM",14,0)
 K Y D PRMTT^SCRPU1 I '$D(VAUTT) G ERR
"RTN","SCRPTM",15,0)
 K Y S RANG=$$DTRANG^SCRPU2() I +RANG=-1 G ERR
"RTN","SCRPTM",16,0)
 K Y D USER^SCRPU1 I '$D(VAUTUC)&($P($G(^SD(404.91,1,"PCMM")),"^")=1) G ERR
"RTN","SCRPTM",17,0)
 K Y D ROLE^SCRPU1 I '$D(VAUTR) G ERR
"RTN","SCRPTM",18,0)
 S PRNT=$$PDEVICE^SCRPU3()
"RTN","SCRPTM",19,0)
 I PRNT=-1 G ERR
"RTN","SCRPTM",20,0)
 I PRNT["Q;" S QTIME=$$GETTIME^SCRPU3()
"RTN","SCRPTM",21,0)
 I QTIME=-1 G ERR
"RTN","SCRPTM",22,0)
 I PRNT'?1"Q;".E S PRNT="Q;"_PRNT
"RTN","SCRPTM",23,0)
 K Y
"RTN","SCRPTM",24,0)
 S NUMBER=$$ENTRY2(.VAUTD,.VAUTT,.VAUTUC,.VAUTR,RANG,PRNT,QTIME)
"RTN","SCRPTM",25,0)
 I NUMBER>0 W !!,"Print queued, task number: ",NUMBER
"RTN","SCRPTM",26,0)
 Q
"RTN","SCRPTM",27,0)
 ;
"RTN","SCRPTM",28,0)
ENTRY2(INST,TEAM,USERC,ROLE,RANGE,IOP,ZTDTH) ;
"RTN","SCRPTM",29,0)
 ;Second entry point for GUI to use
"RTN","SCRPTM",30,0)
 ;Input Parameters:
"RTN","SCRPTM",31,0)
 ;INST - institutions selected (variable and array)
"RTN","SCRPTM",32,0)
 ;TEAM - teams selected (variable and array)
"RTN","SCRPTM",33,0)
 ;USERC - user classes selected (variable and array)
"RTN","SCRPTM",34,0)
 ;ROLE - roles selected (variable and array)
"RTN","SCRPTM",35,0)
 ;RANGE - date range selected (begin date ^ end date)
"RTN","SCRPTM",36,0)
 ;IOP - print device
"RTN","SCRPTM",37,0)
 ;ZTDTH - queue time (optional)
"RTN","SCRPTM",38,0)
 ;
"RTN","SCRPTM",39,0)
 ;validate parameters
"RTN","SCRPTM",40,0)
 I '$D(INST)!'$D(TEAM)!'$D(ROLE)!'$D(RANGE)!'$D(IOP)!(IOP="") Q
"RTN","SCRPTM",41,0)
 ;
"RTN","SCRPTM",42,0)
 N NUMBER
"RTN","SCRPTM",43,0)
 S IOST=$P(IOP,"^",2),IOP=$P(IOP,"^")
"RTN","SCRPTM",44,0)
 I IOP?1"Q;".E S IOP=$P(IOP,"Q;",2)
"RTN","SCRPTM",45,0)
 I IOST?1"C-".E D QENTRY G RET
"RTN","SCRPTM",46,0)
 I ZTDTH="" S ZTDTH=$H
"RTN","SCRPTM",47,0)
 S ZTRTN="QENTRY^SCRPTM"
"RTN","SCRPTM",48,0)
 S ZTDESC="List of Team's Members",ZTIO=IOP
"RTN","SCRPTM",49,0)
 N II
"RTN","SCRPTM",50,0)
 F II="INST","TEAM","USERC","ROLE","INST(","TEAM(","USERC(","ROLE(","RANGE","IOP" S ZTSAVE(II)=""
"RTN","SCRPTM",51,0)
 D ^%ZTLOAD
"RTN","SCRPTM",52,0)
RET S NUMBER=0
"RTN","SCRPTM",53,0)
 I $D(ZTSK) S NUMBER=ZTSK
"RTN","SCRPTM",54,0)
 D EXIT1
"RTN","SCRPTM",55,0)
 Q NUMBER
"RTN","SCRPTM",56,0)
 ;
"RTN","SCRPTM",57,0)
QENTRY ;
"RTN","SCRPTM",58,0)
 ;driver entry point
"RTN","SCRPTM",59,0)
 S TITL="Team's Members Report"
"RTN","SCRPTM",60,0)
 S STORE="^TMP("_$J_",""SCRPTM"")"
"RTN","SCRPTM",61,0)
 K @STORE
"RTN","SCRPTM",62,0)
 S @STORE=0
"RTN","SCRPTM",63,0)
 I TEAM=1 D TALL^SCRPPAT3 S TEAM=0
"RTN","SCRPTM",64,0)
 D DRIVE
"RTN","SCRPTM",65,0)
 I $O(@STORE@(0))="" S NODATA=$$NODATA^SCRPU3(TITL)
"RTN","SCRPTM",66,0)
 I '$D(NODATA) D PRINTIT(STORE,IOP,TITL)
"RTN","SCRPTM",67,0)
 D EXIT2
"RTN","SCRPTM",68,0)
 Q
"RTN","SCRPTM",69,0)
 ;
"RTN","SCRPTM",70,0)
ERR ;
"RTN","SCRPTM",71,0)
EXIT1 ;
"RTN","SCRPTM",72,0)
 K ZTDTH,ZTRTN,ZTDESC,ZTSK,ZTIO,ZTSAVE,SCUP
"RTN","SCRPTM",73,0)
 Q
"RTN","SCRPTM",74,0)
EXIT2 ;
"RTN","SCRPTM",75,0)
 K @STORE
"RTN","SCRPTM",76,0)
 K STOP,STORE,TITL,IOP,TEAM,INST,NODATA,RANGE,ROLE,USERC
"RTN","SCRPTM",77,0)
 Q
"RTN","SCRPTM",78,0)
 ;
"RTN","SCRPTM",79,0)
DRIVE ;
"RTN","SCRPTM",80,0)
 N TM,EN,EN2,NODE,OKAY,PLIST,ERR,RDATE,TROL,TUSE
"RTN","SCRPTM",81,0)
 S TM="",ERR="ERRORS",PLIST="^TMP(""SCRP"",$J,""LIST"")"
"RTN","SCRPTM",82,0)
 K @ERR,@PLIST
"RTN","SCRPTM",83,0)
 F  S TM=$O(^SCTM(404.57,"C",TM)) Q:TM=""  D
"RTN","SCRPTM",84,0)
 .;$O through team position file
"RTN","SCRPTM",85,0)
 .I '$D(TEAM(TM))&(TEAM'=1) Q
"RTN","SCRPTM",86,0)
 .;Q above, not a selected team
"RTN","SCRPTM",87,0)
 .;selected team
"RTN","SCRPTM",88,0)
 .S RDATE("BEGIN")=$P(RANGE,"^")
"RTN","SCRPTM",89,0)
 .S RDATE("END")=$P(RANGE,"^",2)
"RTN","SCRPTM",90,0)
 .S RDATE("INCL")=0
"RTN","SCRPTM",91,0)
 .I ROLE=1 S OKAY=$$PRTM^SCAPMC1(TM,"RDATE","","",PLIST,ERR)
"RTN","SCRPTM",92,0)
 .I ROLE'=1 S OKAY=$$PRTM^SCAPMC1(TM,"RDATE","","ROLE",PLIST,ERR)
"RTN","SCRPTM",93,0)
 .I OKAY,$D(@PLIST@(0)) D PULL^SCRPTM2(TM,PLIST)
"RTN","SCRPTM",94,0)
 .K @PLIST,@ERR
"RTN","SCRPTM",95,0)
 .I $D(USERC),(USERC'=1) S OKAY=$$PRTM^SCAPMC1(TM,"RDATE","USERC","",PLIST,ERR)
"RTN","SCRPTM",96,0)
 .I OKAY D PULL^SCRPTM2(TM,.PLIST)
"RTN","SCRPTM",97,0)
 .K @PLIST,@ERR
"RTN","SCRPTM",98,0)
 K @PLIST,@ERR
"RTN","SCRPTM",99,0)
 Q
"RTN","SCRPTM",100,0)
 ;
"RTN","SCRPTM",101,0)
PRINTIT(STORE,IOP,TITL) ;
"RTN","SCRPTM",102,0)
 D OPEN^SCRPU3
"RTN","SCRPTM",103,0)
 Q:$G(POP)
"RTN","SCRPTM",104,0)
 N INST,EINST,ETEAM,TEM,EPRACT,PRACT,PAGE,NXT,NPAGE,CNT,HEAD,POS
"RTN","SCRPTM",105,0)
 S EINST="",(NPAGE,STOP,HEAD)=0,PAGE=1
"RTN","SCRPTM",106,0)
 D TITLE^SCRPU3(.PAGE,TITL)
"RTN","SCRPTM",107,0)
 F  S EINST=$O(@STORE@("I",EINST)) Q:EINST=""!(STOP)  D
"RTN","SCRPTM",108,0)
 .S INST=$O(@STORE@("I",EINST,""))
"RTN","SCRPTM",109,0)
 .Q:INST=""
"RTN","SCRPTM",110,0)
 .I 'NPAGE W !,$G(@STORE@(INST)) ;write institution line
"RTN","SCRPTM",111,0)
 .S (ETEAM,TEM)=""
"RTN","SCRPTM",112,0)
 .F  S ETEAM=$O(@STORE@("T",INST,ETEAM)) Q:ETEAM=""!(STOP)  D
"RTN","SCRPTM",113,0)
 ..S TEM=$O(@STORE@("T",INST,ETEAM,0))
"RTN","SCRPTM",114,0)
 ..I TEM="" Q
"RTN","SCRPTM",115,0)
 ..S NXT="H"
"RTN","SCRPTM",116,0)
 ..I NPAGE,(IOST'?1"C-".E) D NEWP^SCRPTM2(INST,TEM,TITL,.PAGE,.HEAD) S NPAGE=0
"RTN","SCRPTM",117,0)
 ..I NPAGE,(IOST?1"C-".E) D HOLD1^SCRPTM2(.PAGE,TITL,INST,TEM,.HEAD) S NPAGE=0
"RTN","SCRPTM",118,0)
 ..I STOP Q
"RTN","SCRPTM",119,0)
 ..I IOST'?1"C-".E,$Y>(IOSL-5) D NEWP^SCRPTM2(INST,TEM,TITL,.PAGE,.HEAD)
"RTN","SCRPTM",120,0)
 ..I IOST?1"C-".E,$Y>(IOSL-5) D HOLD1^SCRPTM2(.PAGE,TITL,INST,TEM,.HEAD)
"RTN","SCRPTM",121,0)
 ..I STOP Q
"RTN","SCRPTM",122,0)
 ..W !
"RTN","SCRPTM",123,0)
 ..F  S NXT=$O(@STORE@(INST,TEM,NXT)) Q:NXT'?1"H".E!(STOP)  D
"RTN","SCRPTM",124,0)
 ...I 'HEAD W !,$G(@STORE@(INST,TEM,NXT)) S HEAD=0 ;writes team info
"RTN","SCRPTM",125,0)
 ..S (EPRACT,PRACT)=""
"RTN","SCRPTM",126,0)
 ..W ! ;extra line between members and practioner list
"RTN","SCRPTM",127,0)
 ..F  S EPRACT=$O(@STORE@("PN",INST,TEM,EPRACT)) Q:EPRACT=""!(STOP)  D
"RTN","SCRPTM",128,0)
 ...F  S PRACT=$O(@STORE@("PN",INST,TEM,EPRACT,PRACT)) Q:PRACT=""!(STOP)  D
"RTN","SCRPTM",129,0)
 ....I PRACT="" Q
"RTN","SCRPTM",130,0)
 ....S POS=""
"RTN","SCRPTM",131,0)
 ....F  S POS=$O(@STORE@("PN",INST,TEM,EPRACT,PRACT,POS)) Q:POS=""!(STOP)  D
"RTN","SCRPTM",132,0)
 .....D PRNTD(INST,TEM,PRACT,POS,TITL,.PAGE,.HEAD)
"RTN","SCRPTM",133,0)
 .....W ! ;seperated positions
"RTN","SCRPTM",134,0)
 ....W ! ;seperates practitioners
"RTN","SCRPTM",135,0)
 .S NPAGE=1
"RTN","SCRPTM",136,0)
 D CLOSE^SCRPU3
"RTN","SCRPTM",137,0)
 Q
"RTN","SCRPTM",138,0)
 ;
"RTN","SCRPTM",139,0)
PRNTD(INST,TEM,PRACT,POS,TITL,PAGE,HEAD) ;
"RTN","SCRPTM",140,0)
 ;
"RTN","SCRPTM",141,0)
 N CNT
"RTN","SCRPTM",142,0)
 S CNT=""
"RTN","SCRPTM",143,0)
 F  S CNT=$O(@STORE@(INST,TEM,PRACT,POS,CNT)) Q:CNT=""!(STOP)  D
"RTN","SCRPTM",144,0)
 .I IOST'?1"C-".E,$Y>(IOSL-8) D NEWP^SCRPTM2(INST,TEM,TITL,.PAGE,.HEAD)
"RTN","SCRPTM",145,0)
 .I IOST?1"C-".E,$Y>(IOSL-8) D HOLD1^SCRPTM2(.PAGE,TITL,INST,TEM,.HEAD)
"RTN","SCRPTM",146,0)
 .I STOP Q
"RTN","SCRPTM",147,0)
 .W !,$G(@STORE@(INST,TEM,PRACT,POS,CNT))
"RTN","SCRPTM",148,0)
 Q
"RTN","SCRPU3")
0^1^B16887265
"RTN","SCRPU3",1,0)
SCRPU3 ;ALB/CMM - GENERIC UTILITIES ; 18 Feb 99 10:20 AM
"RTN","SCRPU3",2,0)
 ;;5.3;Scheduling;**41,45,52,140,181**;AUG 13, 1993
"RTN","SCRPU3",3,0)
 ;
"RTN","SCRPU3",4,0)
ELIG(DFN) ;
"RTN","SCRPU3",5,0)
 ;Gets Primary Eligibility
"RTN","SCRPU3",6,0)
 N PRIM
"RTN","SCRPU3",7,0)
 I '$D(^DPT(DFN,.36)) Q 0
"RTN","SCRPU3",8,0)
 I '$D(^DIC(8,+$P(^DPT(DFN,.36),"^"),0)) Q 0
"RTN","SCRPU3",9,0)
 S PRIM=$P($G(^DIC(8,$P($G(^DPT(DFN,.36)),"^"),0)),"^",9)
"RTN","SCRPU3",10,0)
 ;MAS Primary Eligibility Code
"RTN","SCRPU3",11,0)
 S PRIM=$P($G(^DIC(8.1,PRIM,0)),"^")
"RTN","SCRPU3",12,0)
 ;
"RTN","SCRPU3",13,0)
 S PRIM=$TR(PRIM,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","SCRPU3",14,0)
 I PRIM="NON-SERVICE CONNECTED" S PRIM="NSC"
"RTN","SCRPU3",15,0)
 I PRIM["SERVICE CONNECTED" S PRIM=$P(PRIM,"SERVICE CONNECTED")_"SC"_$P(PRIM,"SERVICE CONNECTED",2,999)
"RTN","SCRPU3",16,0)
 I PRIM["LESS THAN" S PRIM=$P(PRIM,"LESS THAN")_"<"_$P(PRIM,"LESS THAN",2,999)
"RTN","SCRPU3",17,0)
 I PRIM[" TO " S PRIM=$P(PRIM," TO ")_"-"_$P(PRIM," TO ",2,999)
"RTN","SCRPU3",18,0)
 I PRIM["%" S PRIM=$TR(PRIM,"%","")
"RTN","SCRPU3",19,0)
 S PRIM=$E(PRIM,1,9)
"RTN","SCRPU3",20,0)
 Q PRIM
"RTN","SCRPU3",21,0)
 ;
"RTN","SCRPU3",22,0)
GETNEXT(DFN,CLN) ;
"RTN","SCRPU3",23,0)
 ;Get next appointment for patient (DFN) at Clinic (CLN)
"RTN","SCRPU3",24,0)
 ;Returning the date in 00/00/0000 format
"RTN","SCRPU3",25,0)
 N NEXT,APPT,FOUND
"RTN","SCRPU3",26,0)
 S APPT=DT,FOUND=0,NEXT=""
"RTN","SCRPU3",27,0)
 F  S APPT=$O(^DPT(DFN,"S",APPT)) Q:APPT=""!(FOUND)  D
"RTN","SCRPU3",28,0)
 .I CLN=+$G(^DPT(DFN,"S",APPT,0))&($P(^DPT(DFN,"S",APPT,0),"^",2)'["C") S FOUND=1,NEXT=$TR($$FMTE^XLFDT(APPT,"5DF")," ","0")
"RTN","SCRPU3",29,0)
 Q NEXT
"RTN","SCRPU3",30,0)
 ;
"RTN","SCRPU3",31,0)
GETLAST(DFN,CLN) ;
"RTN","SCRPU3",32,0)
 ;Get last appointment for patient (DFN) at Clinic (CLN)
"RTN","SCRPU3",33,0)
 ;Returning the date in 00/00/0000 format
"RTN","SCRPU3",34,0)
 N LAST,APPT,FOUND
"RTN","SCRPU3",35,0)
 S APPT=DT,FOUND=0,LAST=""
"RTN","SCRPU3",36,0)
 F  S APPT=$O(^DPT(DFN,"S",APPT),-1) Q:APPT=""!(APPT=0)!(FOUND)  D
"RTN","SCRPU3",37,0)
 .I CLN=+$G(^DPT(DFN,"S",APPT,0))&($P(^DPT(DFN,"S",APPT,0),"^",2)'["C") S FOUND=1,LAST=$TR($$FMTE^XLFDT(APPT,"5DF")," ","0")
"RTN","SCRPU3",38,0)
 Q LAST
"RTN","SCRPU3",39,0)
 ;
"RTN","SCRPU3",40,0)
PDEVICE() ;
"RTN","SCRPU3",41,0)
 ;Generic Printer Call
"RTN","SCRPU3",42,0)
 N TION,POP
"RTN","SCRPU3",43,0)
 S %ZIS="QN" D ^%ZIS K %ZIS Q:POP!(ION="^") -1
"RTN","SCRPU3",44,0)
 S TION=ION
"RTN","SCRPU3",45,0)
 I $D(IO("Q")) S TION="Q;"_TION
"RTN","SCRPU3",46,0)
 Q TION_"^"_IOST
"RTN","SCRPU3",47,0)
 ;
"RTN","SCRPU3",48,0)
GETTIME() ;
"RTN","SCRPU3",49,0)
 ;Prompt for Queue Time
"RTN","SCRPU3",50,0)
 N X,Y
"RTN","SCRPU3",51,0)
 S DIR(0)="D^::RFE",DIR("A")="Start Time",DIR("B")="NOW"
"RTN","SCRPU3",52,0)
 D ^DIR
"RTN","SCRPU3",53,0)
 I $D(DTOUT)!(X="") S Y=$H
"RTN","SCRPU3",54,0)
 I $D(DUOUT)!($D(DIROUT)) S Y=-1
"RTN","SCRPU3",55,0)
 K DIR,DTOUT,DUOUT,DIROUT
"RTN","SCRPU3",56,0)
 Q Y
"RTN","SCRPU3",57,0)
 ;
"RTN","SCRPU3",58,0)
HOLD(PAGE,TIT) ;
"RTN","SCRPU3",59,0)
 ;device is home, reached end of page
"RTN","SCRPU3",60,0)
 N X
"RTN","SCRPU3",61,0)
 W !!,"Press Any Key to Continue or '^' to Quit" R X:DTIME
"RTN","SCRPU3",62,0)
 I '$T!(X="^") S STOP=1 Q
"RTN","SCRPU3",63,0)
 D NEWP1(.PAGE,TIT)
"RTN","SCRPU3",64,0)
 Q
"RTN","SCRPU3",65,0)
 ;
"RTN","SCRPU3",66,0)
NEWP1(PAGE,TITL) ;
"RTN","SCRPU3",67,0)
 ;new page
"RTN","SCRPU3",68,0)
 ;
"RTN","SCRPU3",69,0)
 D STOPCHK^DGUTL
"RTN","SCRPU3",70,0)
 I $G(STOP) D STOPPED^DGUTL Q
"RTN","SCRPU3",71,0)
 W @IOF
"RTN","SCRPU3",72,0)
 S PAGE=PAGE+1
"RTN","SCRPU3",73,0)
 D TITLE(PAGE,TITL)
"RTN","SCRPU3",74,0)
 Q
"RTN","SCRPU3",75,0)
 ;
"RTN","SCRPU3",76,0)
TITLE(PG,TITL) ;
"RTN","SCRPU3",77,0)
 N PDATE,CEN
"RTN","SCRPU3",78,0)
 S PDATE=$$FMTE^XLFDT(DT,"5D")
"RTN","SCRPU3",79,0)
 W !,"Printed on: ",PDATE,?25,TITL,?70,"PAGE: ",PG,!
"RTN","SCRPU3",80,0)
 Q
"RTN","SCRPU3",81,0)
 ;
"RTN","SCRPU3",82,0)
CLOSE ;close device
"RTN","SCRPU3",83,0)
 D ^%ZISC
"RTN","SCRPU3",84,0)
 Q
"RTN","SCRPU3",85,0)
 ;
"RTN","SCRPU3",86,0)
OPEN ;opens device
"RTN","SCRPU3",87,0)
 IF IOST?1"C-".E D  Q  ;%zis has already been called via $$pdevice
"RTN","SCRPU3",88,0)
 .W @IOF
"RTN","SCRPU3",89,0)
 D ^%ZIS
"RTN","SCRPU3",90,0)
 Q:POP
"RTN","SCRPU3",91,0)
 U IO
"RTN","SCRPU3",92,0)
 Q
"RTN","SCRPU3",93,0)
 ;
"RTN","SCRPU3",94,0)
NODATA(TITL) ;
"RTN","SCRPU3",95,0)
 ;no data to print
"RTN","SCRPU3",96,0)
 ;returns 1
"RTN","SCRPU3",97,0)
 D OPEN
"RTN","SCRPU3",98,0)
 D TITLE(1,TITL)
"RTN","SCRPU3",99,0)
 W !,"No data to report"
"RTN","SCRPU3",100,0)
 D CLOSE
"RTN","SCRPU3",101,0)
 Q 1
"RTN","SCRPU3",102,0)
 ;
"RTN","SCRPU3",103,0)
HELP W:'$D(VAUTNA) !,"ENTER:",!?5,"- A or ALL for all ",VAUTSTR,"s, or"
"RTN","SCRPU3",104,0)
 W:($D(VAUTTN))&(VAUTSTR="TEAM") !?5,"- N or NOT for not assigned to a team or"
"RTN","SCRPU3",105,0)
 W:($D(VAUTPO))&(VAUTSTR="PRACTITIONER") !?5,"- N or NONE or NOT for not assigned to a Practitioner"
"RTN","SCRPU3",106,0)
 W !?5,"- Select individual "_VAUTSTR W:'$D(VAUTPO) " -- limit 20"
"RTN","SCRPU3",107,0)
 W !?5,"Imprecise selections will yield an additional prompt."
"RTN","SCRPU3",108,0)
 I $O(@VAUTVB@(0))]"" W !?5,"- An entry preceeded by a minus [-] sign to remove entry from list."
"RTN","SCRPU3",109,0)
 I $O(@VAUTVB@(0))]"" W !,"NOTE, you have already selected:" S VAJ=0 F VAJ1=0:0 S VAJ=$O(@VAUTVB@(VAJ)) Q:VAJ=""  W !?8,$S(VAUTNI=1:VAJ,1:@VAUTVB@(VAJ))
"RTN","SCRPU3",110,0)
 Q
"RTN","SCRPU3",111,0)
 ;
"RTN","SCRPU3",112,0)
CONV(ORIGA,NEWA) ;
"RTN","SCRPU3",113,0)
 ;ORIGA - original array - name(ien)=data
"RTN","SCRPU3",114,0)
 ;NEWA - new array - name(n)=ien^data
"RTN","SCRPU3",115,0)
 ;
"RTN","SCRPU3",116,0)
 N ENT,CNT
"RTN","SCRPU3",117,0)
 S ENT=0,CNT=0
"RTN","SCRPU3",118,0)
 S NEWA=ORIGA
"RTN","SCRPU3",119,0)
 F  S ENT=$O(ORIGA(ENT)) Q:ENT=""!(ENT'?.N)  D
"RTN","SCRPU3",120,0)
 .S CNT=CNT+1
"RTN","SCRPU3",121,0)
 .S NEWA(CNT)=ENT_"^"_ORIGA(ENT)
"RTN","SCRPU3",122,0)
 Q
"VER")
8.0^21.0V02
**END**
**END**
