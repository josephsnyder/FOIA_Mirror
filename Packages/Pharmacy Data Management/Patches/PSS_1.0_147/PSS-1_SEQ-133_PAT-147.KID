Released PSS*1*147 SEQ #133
Extracted from mail message
**KIDS**:PSS*1.0*147^

**INSTALL NAME**
PSS*1.0*147
"BLD",7503,0)
PSS*1.0*147^PHARMACY DATA MANAGEMENT^0^3090825^y
"BLD",7503,1,0)
^^114^114^3090731^
"BLD",7503,1,1,0)
This patch will make some additional enhancements to the Pharmacy
"BLD",7503,1,2,0)
Re-Engineering (PRE) V. 0.5 Pre-Release functionality that was released in
"BLD",7503,1,3,0)
patch PSS*1.0*129. This patch also sends out four Vista Security Keys to
"BLD",7503,1,4,0)
be used in the Pharmacy Enterprise Customization System (PECS)
"BLD",7503,1,5,0)
Application, which will be released at a later date.
"BLD",7503,1,6,0)
 
"BLD",7503,1,7,0)
The enhancements to the Pre-Release functionality include:
"BLD",7503,1,8,0)
                                  
"BLD",7503,1,9,0)
1) A new PSS ORDER CHECKS Mail Group will be created upon installation of
"BLD",7503,1,10,0)
this patch. This mail group will be used for various purposes, all
"BLD",7503,1,11,0)
relating to the Pharmacy Re-Engineering (PRE) V. 0.5 project.
"BLD",7503,1,12,0)
 
"BLD",7503,1,13,0)
2) Data from the DOSE UNIT (#4) Field and the NUMERIC DOSE (#5) Field of
"BLD",7503,1,14,0)
the LOCAL POSSIBLE DOSAGE (#50.0904) Subfile of the DRUG (#50) File will
"BLD",7503,1,15,0)
be added as display elements to the Lookup into Dispense Drug File
"BLD",7503,1,16,0)
[PSS LOOK] option and the Drug Enter/Edit [PSS DRUG ENTER/EDIT] option.
"BLD",7503,1,17,0)
 
"BLD",7503,1,18,0)
3) A Vista Mail message will be sent to the PSS ORDER CHECKS Mail Group
"BLD",7503,1,19,0)
when an update is made to the STANDARD MEDICATION ROUTES (#51.23) File by
"BLD",7503,1,20,0)
the New Term Rapid Turnaround (NTRT) process. This mail message will
"BLD",7503,1,21,0)
include what was updated, and will also include any automatic mapping
"BLD",7503,1,22,0)
activities that occurred from the MEDICATION ROUTES (#51.2) File to the
"BLD",7503,1,23,0)
STANDARD MEDICATION ROUTES (#51.23) File.
"BLD",7503,1,24,0)
 
"BLD",7503,1,25,0)
4) The Request Change to Standard Medication Route [PSS MEDICATION ROUTE 
"BLD",7503,1,26,0)
REQUEST] option has been changed to now refer the requestor to a web site
"BLD",7503,1,27,0)
to make the request.
"BLD",7503,1,28,0)
 
"BLD",7503,1,29,0)
5) A new ADDITIVE FREQUENCY (#18) Field has been added to the IV ADDITIVES
"BLD",7503,1,30,0)
(#52.6) File. This field will be used to provide a default value for the
"BLD",7503,1,31,0)
Additive Frequency field in Computerized Patient Record System (CPRS) when
"BLD",7503,1,32,0)
continuous IV orders with additives are entered. Data will be
"BLD",7503,1,33,0)
auto-populated by a Post-Install routine for this patch, and this data
"BLD",7503,1,34,0)
should be reviewed and edited as necessary. This new field can be edited
"BLD",7503,1,35,0)
using the Drug Enter/Edit [PSS DRUG ENTER/EDIT] option or the ADditives
"BLD",7503,1,36,0)
File [PSSJI DRUG] option. These defaults will not start to appear in CPRS
"BLD",7503,1,37,0)
until Pharmacy Re-Engineering (PRE) V. 0.5. A new IV Additive Report [PSS
"BLD",7503,1,38,0)
IV ADDITIVE REPORT] option has also been added, and this report, in
"BLD",7503,1,39,0)
addition to the current IV Solution Report [PSS IV SOLUTION REPORT] 
"BLD",7503,1,40,0)
option, will now be located under the new IV Additive/Solution Reports
"BLD",7503,1,41,0)
[PSS ADDITIVE/SOLUTION REPORTS] Menu option, which will be located under
"BLD",7503,1,42,0)
the Pharmacy Data Management [PSS MGR] Menu option.
"BLD",7503,1,43,0)
 
"BLD",7503,1,44,0)
A Mail Message will be sent to the PSS ORDER CHECKS Mail Group and the
"BLD",7503,1,45,0)
patch installer upon completion of patch installation.
"BLD",7503,1,46,0)
                                 
"BLD",7503,1,47,0)
 
"BLD",7503,1,48,0)
This patch addresses the following New Service Request (NSR):
"BLD",7503,1,49,0)
-------------------------------------------------------------
"BLD",7503,1,50,0)
There is no NSR associated with this patch. 
"BLD",7503,1,51,0)
 
"BLD",7503,1,52,0)
 
"BLD",7503,1,53,0)
This patch addresses the following Remedy Ticket(s):
"BLD",7503,1,54,0)
----------------------------------------------------
"BLD",7503,1,55,0)
There are no Remedy tickets associated with this patch.
"BLD",7503,1,56,0)
 
"BLD",7503,1,57,0)
 
"BLD",7503,1,58,0)
Overview of Remedy Ticket(s):
"BLD",7503,1,59,0)
-----------------------------
"BLD",7503,1,60,0)
There are no Remedy tickets associated with this patch. 
"BLD",7503,1,61,0)
 
"BLD",7503,1,62,0)
 
"BLD",7503,1,63,0)
Components Exported With Patch: 
"BLD",7503,1,64,0)
-------------------------------
"BLD",7503,1,65,0)
 
"BLD",7503,1,66,0)
 
"BLD",7503,1,67,0)
The following is a list of fields included in this patch:
"BLD",7503,1,68,0)
 
"BLD",7503,1,69,0)
Field Name                 (Number)     File Name             (Number)
"BLD",7503,1,70,0)
-----------------------------------     ------------------------------
"BLD",7503,1,71,0)
ADDITIVE FREQUENCY               18     IV ADDITIVES              52.6
"BLD",7503,1,72,0)
                                                             
"BLD",7503,1,73,0)
 
"BLD",7503,1,74,0)
The following is a list of templates included in this patch:
"BLD",7503,1,75,0)
 
"BLD",7503,1,76,0)
Template Name               Type           File Name (Number)
"BLD",7503,1,77,0)
-------------               ----           ------------------
"BLD",7503,1,78,0)
PSSIV ADD                   Input          IV ADDITIVES (#52.6)
"BLD",7503,1,79,0)
 
"BLD",7503,1,80,0)
 
"BLD",7503,1,81,0)
The following is a list of options included in this patch:
"BLD",7503,1,82,0)
 
"BLD",7503,1,83,0)
Option Name                      Type      Action
"BLD",7503,1,84,0)
-----------                      ----      ----------------------
"BLD",7503,1,85,0)
PSS IV ADDITIVE REPORT           RUN       SEND TO SITE
"BLD",7503,1,86,0)
PSS ADDITIVE/SOLUTION REPORT     MENU      SEND TO SITE
"BLD",7503,1,87,0)
                                                                 
"BLD",7503,1,88,0)
 
"BLD",7503,1,89,0)
The following is a list of mail groups included in this patch:
"BLD",7503,1,90,0)
 
"BLD",7503,1,91,0)
Mail Group
"BLD",7503,1,92,0)
---------- 
"BLD",7503,1,93,0)
PSS ORDER CHECKS 
"BLD",7503,1,94,0)
 
"BLD",7503,1,95,0)
Please note that the PSS ORDER CHECKS Mail Group is not an actual 
"BLD",7503,1,96,0)
component of the KIDS Build, but it is created during the Environment 
"BLD",7503,1,97,0)
Check routine.
"BLD",7503,1,98,0)
 
"BLD",7503,1,99,0)
 
"BLD",7503,1,100,0)
The following is a list of security keys included in this patch:
"BLD",7503,1,101,0)
 
"BLD",7503,1,102,0)
Security Key
"BLD",7503,1,103,0)
------------                                   
"BLD",7503,1,104,0)
PSS_CUSTOM_TABLES_ADMIN                      SEND TO SITE
"BLD",7503,1,105,0)
PSS_CUSTOM_TABLES_APPROVER                   SEND TO SITE
"BLD",7503,1,106,0)
PSS_CUSTOM_TABLES_REL_MAN                    SEND TO SITE
"BLD",7503,1,107,0)
PSS_CUSTOM_TABLES_REQUESTOR                  SEND TO SITE
"BLD",7503,1,108,0)
                                                          
"BLD",7503,1,109,0)
 
"BLD",7503,1,110,0)
The following is a list of protocols included in this patch:
"BLD",7503,1,111,0)
 
"BLD",7503,1,112,0)
Protocol
"BLD",7503,1,113,0)
-------- 
"BLD",7503,1,114,0)
PSS MED ROUTE RECEIVE                        SEND TO SITE
"BLD",7503,4,0)
^9.64PA^52.6^1
"BLD",7503,4,52.6,0)
52.6
"BLD",7503,4,52.6,2,0)
^9.641^52.6^1
"BLD",7503,4,52.6,2,52.6,0)
IV ADDITIVES  (File-top level)
"BLD",7503,4,52.6,2,52.6,1,0)
^9.6411^18^1
"BLD",7503,4,52.6,2,52.6,1,18,0)
ADDITIVE FREQUENCY
"BLD",7503,4,52.6,222)
y^y^p^^^^n^^n
"BLD",7503,4,52.6,224)

"BLD",7503,4,"APDD",52.6,52.6)

"BLD",7503,4,"APDD",52.6,52.6,18)

"BLD",7503,4,"B",52.6,52.6)

"BLD",7503,6.3)
16
"BLD",7503,"ABPKG")
n
"BLD",7503,"INID")
n^n
"BLD",7503,"INIT")
PSS147PO
"BLD",7503,"KRN",0)
^9.67PA^779.2^20
"BLD",7503,"KRN",.4,0)
.4
"BLD",7503,"KRN",.401,0)
.401
"BLD",7503,"KRN",.402,0)
.402
"BLD",7503,"KRN",.402,"NM",0)
^9.68A^1^1
"BLD",7503,"KRN",.402,"NM",1,0)
PSSIV ADD    FILE #52.6^52.6^0
"BLD",7503,"KRN",.402,"NM","B","PSSIV ADD    FILE #52.6",1)

"BLD",7503,"KRN",.403,0)
.403
"BLD",7503,"KRN",.5,0)
.5
"BLD",7503,"KRN",.84,0)
.84
"BLD",7503,"KRN",3.6,0)
3.6
"BLD",7503,"KRN",3.8,0)
3.8
"BLD",7503,"KRN",9.2,0)
9.2
"BLD",7503,"KRN",9.8,0)
9.8
"BLD",7503,"KRN",9.8,"NM",0)
^9.68A^9^9
"BLD",7503,"KRN",9.8,"NM",1,0)
PSSADRPT^^0^B31361232
"BLD",7503,"KRN",9.8,"NM",2,0)
PSSDOS^^0^B61025597
"BLD",7503,"KRN",9.8,"NM",3,0)
PSSLOOK^^0^B85630505
"BLD",7503,"KRN",9.8,"NM",4,0)
PSSMEDRQ^^0^B97598352
"BLD",7503,"KRN",9.8,"NM",5,0)
PSSMRTUP^^0^B160988994
"BLD",7503,"KRN",9.8,"NM",6,0)
PSSMRTUX^^0^B21812440
"BLD",7503,"KRN",9.8,"NM",7,0)
PSSUTIL^^0^B91400007
"BLD",7503,"KRN",9.8,"NM",8,0)
PSS147EN^^0^B8073298
"BLD",7503,"KRN",9.8,"NM",9,0)
PSS147PO^^0^B65037615
"BLD",7503,"KRN",9.8,"NM","B","PSS147EN",8)

"BLD",7503,"KRN",9.8,"NM","B","PSS147PO",9)

"BLD",7503,"KRN",9.8,"NM","B","PSSADRPT",1)

"BLD",7503,"KRN",9.8,"NM","B","PSSDOS",2)

"BLD",7503,"KRN",9.8,"NM","B","PSSLOOK",3)

"BLD",7503,"KRN",9.8,"NM","B","PSSMEDRQ",4)

"BLD",7503,"KRN",9.8,"NM","B","PSSMRTUP",5)

"BLD",7503,"KRN",9.8,"NM","B","PSSMRTUX",6)

"BLD",7503,"KRN",9.8,"NM","B","PSSUTIL",7)

"BLD",7503,"KRN",19,0)
19
"BLD",7503,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",7503,"KRN",19,"NM",1,0)
PSS ADDITIVE/SOLUTION REPORTS^^0
"BLD",7503,"KRN",19,"NM",2,0)
PSS IV ADDITIVE REPORT^^0
"BLD",7503,"KRN",19,"NM","B","PSS ADDITIVE/SOLUTION REPORTS",1)

"BLD",7503,"KRN",19,"NM","B","PSS IV ADDITIVE REPORT",2)

"BLD",7503,"KRN",19.1,0)
19.1
"BLD",7503,"KRN",19.1,"NM",0)
^9.68A^4^4
"BLD",7503,"KRN",19.1,"NM",1,0)
PSS_CUSTOM_TABLES_ADMIN^^0
"BLD",7503,"KRN",19.1,"NM",2,0)
PSS_CUSTOM_TABLES_APPROVER^^0
"BLD",7503,"KRN",19.1,"NM",3,0)
PSS_CUSTOM_TABLES_REL_MAN^^0
"BLD",7503,"KRN",19.1,"NM",4,0)
PSS_CUSTOM_TABLES_REQUESTOR^^0
"BLD",7503,"KRN",19.1,"NM","B","PSS_CUSTOM_TABLES_ADMIN",1)

"BLD",7503,"KRN",19.1,"NM","B","PSS_CUSTOM_TABLES_APPROVER",2)

"BLD",7503,"KRN",19.1,"NM","B","PSS_CUSTOM_TABLES_REL_MAN",3)

"BLD",7503,"KRN",19.1,"NM","B","PSS_CUSTOM_TABLES_REQUESTOR",4)

"BLD",7503,"KRN",101,0)
101
"BLD",7503,"KRN",101,"NM",0)
^9.68A^1^1
"BLD",7503,"KRN",101,"NM",1,0)
PSS MED ROUTE RECEIVE^^0
"BLD",7503,"KRN",101,"NM","B","PSS MED ROUTE RECEIVE",1)

"BLD",7503,"KRN",409.61,0)
409.61
"BLD",7503,"KRN",771,0)
771
"BLD",7503,"KRN",779.2,0)
779.2
"BLD",7503,"KRN",870,0)
870
"BLD",7503,"KRN",8989.51,0)
8989.51
"BLD",7503,"KRN",8989.52,0)
8989.52
"BLD",7503,"KRN",8994,0)
8994
"BLD",7503,"KRN","B",.4,.4)

"BLD",7503,"KRN","B",.401,.401)

"BLD",7503,"KRN","B",.402,.402)

"BLD",7503,"KRN","B",.403,.403)

"BLD",7503,"KRN","B",.5,.5)

"BLD",7503,"KRN","B",.84,.84)

"BLD",7503,"KRN","B",3.6,3.6)

"BLD",7503,"KRN","B",3.8,3.8)

"BLD",7503,"KRN","B",9.2,9.2)

"BLD",7503,"KRN","B",9.8,9.8)

"BLD",7503,"KRN","B",19,19)

"BLD",7503,"KRN","B",19.1,19.1)

"BLD",7503,"KRN","B",101,101)

"BLD",7503,"KRN","B",409.61,409.61)

"BLD",7503,"KRN","B",771,771)

"BLD",7503,"KRN","B",779.2,779.2)

"BLD",7503,"KRN","B",870,870)

"BLD",7503,"KRN","B",8989.51,8989.51)

"BLD",7503,"KRN","B",8989.52,8989.52)

"BLD",7503,"KRN","B",8994,8994)

"BLD",7503,"PRE")
PSS147EN
"BLD",7503,"QUES",0)
^9.62^^
"BLD",7503,"REQB",0)
^9.611^4^4
"BLD",7503,"REQB",1,0)
PSS*1.0*129^2
"BLD",7503,"REQB",2,0)
XU*8.0*474^2
"BLD",7503,"REQB",3,0)
PSS*1.0*127^2
"BLD",7503,"REQB",4,0)
XT*7.3*111^2
"BLD",7503,"REQB","B","PSS*1.0*127",3)

"BLD",7503,"REQB","B","PSS*1.0*129",1)

"BLD",7503,"REQB","B","XT*7.3*111",4)

"BLD",7503,"REQB","B","XU*8.0*474",2)

"FIA",52.6)
IV ADDITIVES
"FIA",52.6,0)
^PS(52.6,
"FIA",52.6,0,0)
52.6I
"FIA",52.6,0,1)
y^y^p^^^^n^^n
"FIA",52.6,0,10)

"FIA",52.6,0,11)

"FIA",52.6,0,"RLRO")

"FIA",52.6,0,"VR")
1.0^PSS
"FIA",52.6,52.6)
1
"FIA",52.6,52.6,18)

"INIT")
PSS147PO
"KRN",.402,2000,-1)
0^1
"KRN",.402,2000,0)
PSSIV ADD^3090724.0824^@^52.6^^@^3090817
"KRN",.402,2000,"DIAB",1,1,52.62,0)
ALL
"KRN",.402,2000,"DIAB",1,1,52.63,0)
ALL
"KRN",.402,2000,"DR",1,52.6)
.01;1;D GETD^PSSVIDRG;17;2;3;4;Q;S X=$S($D(PSIVSC):PSIVSC,1:"") K PSIVSC;5;6;7;8;9;10;12;13;14;18;
"KRN",.402,2000,"DR",2,52.61)
.01;1;2;3;4;5///^S X=$S($D(PSIVSC):PSIVSC,1:"") K PSIVSC;Q;5;6;7;
"KRN",.402,2000,"DR",2,52.62)
.01:1
"KRN",.402,2000,"DR",2,52.63)
.01
"KRN",19,13775,-1)
0^2
"KRN",19,13775,0)
PSS IV ADDITIVE REPORT^IV Additive Report^^R^^^^^^^^PHARMACY DATA MANAGEMENT
"KRN",19,13775,1,0)
^^4^4^3090715^
"KRN",19,13775,1,1,0)
This report will display entries from the IV ADDITIVES (#52.6) File. The 
"KRN",19,13775,1,2,0)
display selection choices will be for all IV Additives, only IV Additives 
"KRN",19,13775,1,3,0)
whose ADDITIVE FREQUENCY (#18 ) Field is set to '1 BAG/DAY', or only those
"KRN",19,13775,1,4,0)
IV Additives whose ADDITIVE FREQUENCY (#18) Field is null.
"KRN",19,13775,25)
REP^PSSADRPT
"KRN",19,13775,"U")
IV ADDITIVE REPORT
"KRN",19,13776,-1)
0^1
"KRN",19,13776,0)
PSS ADDITIVE/SOLUTION REPORTS^IV Additive/Solution Reports^^M^^^^^^^^PHARMACY DATA MANAGEMENT
"KRN",19,13776,1,0)
^19.06^2^2^3090722^^
"KRN",19,13776,1,1,0)
This Sub-Menu contains options that can be used to run reports from the 
"KRN",19,13776,1,2,0)
IV ADDITIVES (#52.6) File and the IV SOLUTIONS (#52.7) File.
"KRN",19,13776,10,0)
^19.01IP^^0
"KRN",19,13776,99)
61564,35467
"KRN",19,13776,"U")
IV ADDITIVE/SOLUTION REPORTS
"KRN",19.1,599,-1)
0^1
"KRN",19.1,599,0)
PSS_CUSTOM_TABLES_ADMIN^ADMINISTRATOR^l^y^1
"KRN",19.1,599,1,0)
^19.11^1^1^3090504^^^
"KRN",19.1,599,1,1,0)
This key is used by the Pharmacy Enterprise Customization System (PECS) web application. Holders of this key will have the ability to perform configuration and administrative tasks for the application. They will also have querying capabilities.
"KRN",19.1,600,-1)
0^2
"KRN",19.1,600,0)
PSS_CUSTOM_TABLES_APPROVER^APPROVER^l^y^1
"KRN",19.1,600,1,0)
^19.11^2^2^3090504^^^
"KRN",19.1,600,1,1,0)
This key is used by the Pharmacy Enterprise Customization System (PECS) web application.  Holders of this key will have the same privileges as those with the PSS CUSTOM TABLES REQUESTOR key. Additional capabilities will be to review, approve, 
"KRN",19.1,600,1,2,0)
delete or reject customization requests and to view and generate reports.
"KRN",19.1,601,-1)
0^3
"KRN",19.1,601,0)
PSS_CUSTOM_TABLES_REL_MAN^RELEASE MANAGER^l^y^1
"KRN",19.1,601,1,0)
^19.11^2^2^3090504^^
"KRN",19.1,601,1,1,0)
This key is used by the Pharmacy Enterprise Customization System (PECS) web application. Holders of this key will have the ability to create file updates for FDB database tables to be applied at local facilities. 
"KRN",19.1,601,1,2,0)
They will also have querying capabilities.
"KRN",19.1,602,-1)
0^4
"KRN",19.1,602,0)
PSS_CUSTOM_TABLES_REQUESTOR^REQUESTOR^l^y^1
"KRN",19.1,602,1,0)
^19.11^2^2^3090504^^^
"KRN",19.1,602,1,1,0)
This key is used by the Pharmacy Enterprise Customization System (PECS) web application.  Holders of this key will be allowed to enter customization requests, display and view the status of their own requests. 
"KRN",19.1,602,1,2,0)
They will also have limited querying capabilities.
"KRN",101,5750,-1)
0^1
"KRN",101,5750,0)
PSS MED ROUTE RECEIVE^Receive Standard Medication Route Updates^^A^^^^^^^^PHARMACY DATA MANAGEMENT
"KRN",101,5750,1,0)
^^2^2^3090303^
"KRN",101,5750,1,1,0)
This protocol processes updates to the Standard Medication Routes (#51.23)
"KRN",101,5750,1,2,0)
File.
"KRN",101,5750,20)
D ^PSSMRTUP
"KRN",101,5750,99)
61423,34822
"MBREQ")
0
"ORD",3,19.1)
19.1;3;;;KEY^XPDTA1;KEYF1^XPDIA1;KEYE1^XPDIA1;KEYF2^XPDIA1;;KEYDEL^XPDIA1
"ORD",3,19.1,0)
SECURITY KEY
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",517,-1)
1^1
"PKG",517,0)
PHARMACY DATA MANAGEMENT^PSS^Maintenance of Pharmacy files.
"PKG",517,20,0)
^9.402P^^
"PKG",517,22,0)
^9.49I^1^1
"PKG",517,22,1,0)
1.0^2970930^2971014^11595
"PKG",517,22,1,"PAH",1,0)
147^3090825
"PKG",517,22,1,"PAH",1,1,0)
^^114^114^3090825
"PKG",517,22,1,"PAH",1,1,1,0)
This patch will make some additional enhancements to the Pharmacy
"PKG",517,22,1,"PAH",1,1,2,0)
Re-Engineering (PRE) V. 0.5 Pre-Release functionality that was released in
"PKG",517,22,1,"PAH",1,1,3,0)
patch PSS*1.0*129. This patch also sends out four Vista Security Keys to
"PKG",517,22,1,"PAH",1,1,4,0)
be used in the Pharmacy Enterprise Customization System (PECS)
"PKG",517,22,1,"PAH",1,1,5,0)
Application, which will be released at a later date.
"PKG",517,22,1,"PAH",1,1,6,0)
 
"PKG",517,22,1,"PAH",1,1,7,0)
The enhancements to the Pre-Release functionality include:
"PKG",517,22,1,"PAH",1,1,8,0)
                                  
"PKG",517,22,1,"PAH",1,1,9,0)
1) A new PSS ORDER CHECKS Mail Group will be created upon installation of
"PKG",517,22,1,"PAH",1,1,10,0)
this patch. This mail group will be used for various purposes, all
"PKG",517,22,1,"PAH",1,1,11,0)
relating to the Pharmacy Re-Engineering (PRE) V. 0.5 project.
"PKG",517,22,1,"PAH",1,1,12,0)
 
"PKG",517,22,1,"PAH",1,1,13,0)
2) Data from the DOSE UNIT (#4) Field and the NUMERIC DOSE (#5) Field of
"PKG",517,22,1,"PAH",1,1,14,0)
the LOCAL POSSIBLE DOSAGE (#50.0904) Subfile of the DRUG (#50) File will
"PKG",517,22,1,"PAH",1,1,15,0)
be added as display elements to the Lookup into Dispense Drug File
"PKG",517,22,1,"PAH",1,1,16,0)
[PSS LOOK] option and the Drug Enter/Edit [PSS DRUG ENTER/EDIT] option.
"PKG",517,22,1,"PAH",1,1,17,0)
 
"PKG",517,22,1,"PAH",1,1,18,0)
3) A Vista Mail message will be sent to the PSS ORDER CHECKS Mail Group
"PKG",517,22,1,"PAH",1,1,19,0)
when an update is made to the STANDARD MEDICATION ROUTES (#51.23) File by
"PKG",517,22,1,"PAH",1,1,20,0)
the New Term Rapid Turnaround (NTRT) process. This mail message will
"PKG",517,22,1,"PAH",1,1,21,0)
include what was updated, and will also include any automatic mapping
"PKG",517,22,1,"PAH",1,1,22,0)
activities that occurred from the MEDICATION ROUTES (#51.2) File to the
"PKG",517,22,1,"PAH",1,1,23,0)
STANDARD MEDICATION ROUTES (#51.23) File.
"PKG",517,22,1,"PAH",1,1,24,0)
 
"PKG",517,22,1,"PAH",1,1,25,0)
4) The Request Change to Standard Medication Route [PSS MEDICATION ROUTE 
"PKG",517,22,1,"PAH",1,1,26,0)
REQUEST] option has been changed to now refer the requestor to a web site
"PKG",517,22,1,"PAH",1,1,27,0)
to make the request.
"PKG",517,22,1,"PAH",1,1,28,0)
 
"PKG",517,22,1,"PAH",1,1,29,0)
5) A new ADDITIVE FREQUENCY (#18) Field has been added to the IV ADDITIVES
"PKG",517,22,1,"PAH",1,1,30,0)
(#52.6) File. This field will be used to provide a default value for the
"PKG",517,22,1,"PAH",1,1,31,0)
Additive Frequency field in Computerized Patient Record System (CPRS) when
"PKG",517,22,1,"PAH",1,1,32,0)
continuous IV orders with additives are entered. Data will be
"PKG",517,22,1,"PAH",1,1,33,0)
auto-populated by a Post-Install routine for this patch, and this data
"PKG",517,22,1,"PAH",1,1,34,0)
should be reviewed and edited as necessary. This new field can be edited
"PKG",517,22,1,"PAH",1,1,35,0)
using the Drug Enter/Edit [PSS DRUG ENTER/EDIT] option or the ADditives
"PKG",517,22,1,"PAH",1,1,36,0)
File [PSSJI DRUG] option. These defaults will not start to appear in CPRS
"PKG",517,22,1,"PAH",1,1,37,0)
until Pharmacy Re-Engineering (PRE) V. 0.5. A new IV Additive Report [PSS
"PKG",517,22,1,"PAH",1,1,38,0)
IV ADDITIVE REPORT] option has also been added, and this report, in
"PKG",517,22,1,"PAH",1,1,39,0)
addition to the current IV Solution Report [PSS IV SOLUTION REPORT] 
"PKG",517,22,1,"PAH",1,1,40,0)
option, will now be located under the new IV Additive/Solution Reports
"PKG",517,22,1,"PAH",1,1,41,0)
[PSS ADDITIVE/SOLUTION REPORTS] Menu option, which will be located under
"PKG",517,22,1,"PAH",1,1,42,0)
the Pharmacy Data Management [PSS MGR] Menu option.
"PKG",517,22,1,"PAH",1,1,43,0)
 
"PKG",517,22,1,"PAH",1,1,44,0)
A Mail Message will be sent to the PSS ORDER CHECKS Mail Group and the
"PKG",517,22,1,"PAH",1,1,45,0)
patch installer upon completion of patch installation.
"PKG",517,22,1,"PAH",1,1,46,0)
                                 
"PKG",517,22,1,"PAH",1,1,47,0)
 
"PKG",517,22,1,"PAH",1,1,48,0)
This patch addresses the following New Service Request (NSR):
"PKG",517,22,1,"PAH",1,1,49,0)
-------------------------------------------------------------
"PKG",517,22,1,"PAH",1,1,50,0)
There is no NSR associated with this patch. 
"PKG",517,22,1,"PAH",1,1,51,0)
 
"PKG",517,22,1,"PAH",1,1,52,0)
 
"PKG",517,22,1,"PAH",1,1,53,0)
This patch addresses the following Remedy Ticket(s):
"PKG",517,22,1,"PAH",1,1,54,0)
----------------------------------------------------
"PKG",517,22,1,"PAH",1,1,55,0)
There are no Remedy tickets associated with this patch.
"PKG",517,22,1,"PAH",1,1,56,0)
 
"PKG",517,22,1,"PAH",1,1,57,0)
 
"PKG",517,22,1,"PAH",1,1,58,0)
Overview of Remedy Ticket(s):
"PKG",517,22,1,"PAH",1,1,59,0)
-----------------------------
"PKG",517,22,1,"PAH",1,1,60,0)
There are no Remedy tickets associated with this patch. 
"PKG",517,22,1,"PAH",1,1,61,0)
 
"PKG",517,22,1,"PAH",1,1,62,0)
 
"PKG",517,22,1,"PAH",1,1,63,0)
Components Exported With Patch: 
"PKG",517,22,1,"PAH",1,1,64,0)
-------------------------------
"PKG",517,22,1,"PAH",1,1,65,0)
 
"PKG",517,22,1,"PAH",1,1,66,0)
 
"PKG",517,22,1,"PAH",1,1,67,0)
The following is a list of fields included in this patch:
"PKG",517,22,1,"PAH",1,1,68,0)
 
"PKG",517,22,1,"PAH",1,1,69,0)
Field Name                 (Number)     File Name             (Number)
"PKG",517,22,1,"PAH",1,1,70,0)
-----------------------------------     ------------------------------
"PKG",517,22,1,"PAH",1,1,71,0)
ADDITIVE FREQUENCY               18     IV ADDITIVES              52.6
"PKG",517,22,1,"PAH",1,1,72,0)
                                                             
"PKG",517,22,1,"PAH",1,1,73,0)
 
"PKG",517,22,1,"PAH",1,1,74,0)
The following is a list of templates included in this patch:
"PKG",517,22,1,"PAH",1,1,75,0)
 
"PKG",517,22,1,"PAH",1,1,76,0)
Template Name               Type           File Name (Number)
"PKG",517,22,1,"PAH",1,1,77,0)
-------------               ----           ------------------
"PKG",517,22,1,"PAH",1,1,78,0)
PSSIV ADD                   Input          IV ADDITIVES (#52.6)
"PKG",517,22,1,"PAH",1,1,79,0)
 
"PKG",517,22,1,"PAH",1,1,80,0)
 
"PKG",517,22,1,"PAH",1,1,81,0)
The following is a list of options included in this patch:
"PKG",517,22,1,"PAH",1,1,82,0)
 
"PKG",517,22,1,"PAH",1,1,83,0)
Option Name                      Type      Action
"PKG",517,22,1,"PAH",1,1,84,0)
-----------                      ----      ----------------------
"PKG",517,22,1,"PAH",1,1,85,0)
PSS IV ADDITIVE REPORT           RUN       SEND TO SITE
"PKG",517,22,1,"PAH",1,1,86,0)
PSS ADDITIVE/SOLUTION REPORT     MENU      SEND TO SITE
"PKG",517,22,1,"PAH",1,1,87,0)
                                                                 
"PKG",517,22,1,"PAH",1,1,88,0)
 
"PKG",517,22,1,"PAH",1,1,89,0)
The following is a list of mail groups included in this patch:
"PKG",517,22,1,"PAH",1,1,90,0)
 
"PKG",517,22,1,"PAH",1,1,91,0)
Mail Group
"PKG",517,22,1,"PAH",1,1,92,0)
---------- 
"PKG",517,22,1,"PAH",1,1,93,0)
PSS ORDER CHECKS 
"PKG",517,22,1,"PAH",1,1,94,0)
 
"PKG",517,22,1,"PAH",1,1,95,0)
Please note that the PSS ORDER CHECKS Mail Group is not an actual 
"PKG",517,22,1,"PAH",1,1,96,0)
component of the KIDS Build, but it is created during the Environment 
"PKG",517,22,1,"PAH",1,1,97,0)
Check routine.
"PKG",517,22,1,"PAH",1,1,98,0)
 
"PKG",517,22,1,"PAH",1,1,99,0)
 
"PKG",517,22,1,"PAH",1,1,100,0)
The following is a list of security keys included in this patch:
"PKG",517,22,1,"PAH",1,1,101,0)
 
"PKG",517,22,1,"PAH",1,1,102,0)
Security Key
"PKG",517,22,1,"PAH",1,1,103,0)
------------                                   
"PKG",517,22,1,"PAH",1,1,104,0)
PSS_CUSTOM_TABLES_ADMIN                      SEND TO SITE
"PKG",517,22,1,"PAH",1,1,105,0)
PSS_CUSTOM_TABLES_APPROVER                   SEND TO SITE
"PKG",517,22,1,"PAH",1,1,106,0)
PSS_CUSTOM_TABLES_REL_MAN                    SEND TO SITE
"PKG",517,22,1,"PAH",1,1,107,0)
PSS_CUSTOM_TABLES_REQUESTOR                  SEND TO SITE
"PKG",517,22,1,"PAH",1,1,108,0)
                                                          
"PKG",517,22,1,"PAH",1,1,109,0)
 
"PKG",517,22,1,"PAH",1,1,110,0)
The following is a list of protocols included in this patch:
"PKG",517,22,1,"PAH",1,1,111,0)
 
"PKG",517,22,1,"PAH",1,1,112,0)
Protocol
"PKG",517,22,1,"PAH",1,1,113,0)
-------- 
"PKG",517,22,1,"PAH",1,1,114,0)
PSS MED ROUTE RECEIVE                        SEND TO SITE
"PRE")
PSS147EN
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
9
"RTN","PSS147EN")
0^8^B8073298^n/a
"RTN","PSS147EN",1,0)
PSS147EN ;BIR/RTR-Environment check routine for patch PSS*1*147 ;07/17/09
"RTN","PSS147EN",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**147**;9/30/97;Build 16
"RTN","PSS147EN",3,0)
 ;
"RTN","PSS147EN",4,0)
 Q:'$G(XPDENV)
"RTN","PSS147EN",5,0)
 ;
"RTN","PSS147EN",6,0)
 ;
"RTN","PSS147EN",7,0)
EN ;
"RTN","PSS147EN",8,0)
 N X,Y,DTOUT,DUOUT,DIRUT,DIROUT,DIC,DA,DLAYGO
"RTN","PSS147EN",9,0)
 N PSSMGPAR,PSSMGPOR,PSSMGPMY,PSSMGPNM,PSSMGPDS,PSSMGPRS,PSSMGPQT,PSSMGPTP,PSSMGPSL
"RTN","PSS147EN",10,0)
 S @XPDGREF@("PSS147IN","INSTALL")=0 I $$PATCH^XPDUTL("PSS*1.0*147") S @XPDGREF@("PSS147IN","INSTALL")=1
"RTN","PSS147EN",11,0)
 I $$FIND1^DIC(3.8,"","X","PSS ORDER CHECKS","B") D KTM G REC
"RTN","PSS147EN",12,0)
 D KTM K PSSMGPAR
"RTN","PSS147EN",13,0)
 S PSSMGPAR(1)="A 'PSS ORDER CHECKS' Mail Group is now being created. Mail Group members will"
"RTN","PSS147EN",14,0)
 S PSSMGPAR(2)="receive various notifications that impact Enhanced Order Checks (drug-drug"
"RTN","PSS147EN",15,0)
 S PSSMGPAR(3)="interactions, duplicate therapy and dosing) introduced with PRE V. 0.5. Please"
"RTN","PSS147EN",16,0)
 S PSSMGPAR(4)="enter the Pharmacy ADPAC or a designee to be the Mail Group Organizer."
"RTN","PSS147EN",17,0)
 S PSSMGPAR(5)=" "
"RTN","PSS147EN",18,0)
 S PSSMGPAR(6)="To continue this install, you must now enter a Mail Group organizer."
"RTN","PSS147EN",19,0)
 S PSSMGPAR(7)=" "
"RTN","PSS147EN",20,0)
 D MES^XPDUTL(.PSSMGPAR)
"RTN","PSS147EN",21,0)
 K DIC S DIC=200,DIC(0)="QEAMZ",DIC("A")="Enter Mail Group Organizer: "
"RTN","PSS147EN",22,0)
 D ^DIC K DIC I $D(DTOUT)!($D(DUOUT))!(+Y'>0) S XPDABORT=2 Q
"RTN","PSS147EN",23,0)
 S PSSMGPOR=+Y,PSSMGPMY(+Y)=""
"RTN","PSS147EN",24,0)
 S PSSMGPNM="PSS ORDER CHECKS",PSSMGPTP=0,PSSMGPSL=0,PSSMGPQT=1
"RTN","PSS147EN",25,0)
 S PSSMGPDS(1)="Members of this mail group will receive various notifications that impact"
"RTN","PSS147EN",26,0)
 S PSSMGPDS(2)="Enhanced Order Checks (drug-drug interactions, duplicate therapy and dosing"
"RTN","PSS147EN",27,0)
 S PSSMGPDS(3)="checks) introduced with PRE V. 0.5 utilizing a COTS database."
"RTN","PSS147EN",28,0)
 S PSSMGPRS=$$MG^XMBGRP(PSSMGPNM,PSSMGPTP,PSSMGPOR,PSSMGPSL,.PSSMGPMY,.PSSMGPDS,PSSMGPQT)
"RTN","PSS147EN",29,0)
 I 'PSSMGPRS D BMES^XPDUTL(" ") D BMES^XPDUTL("Unable to create PSS ORDER CHECKS Mail Group, aborting install.") S XPDABORT=2 Q
"RTN","PSS147EN",30,0)
 D BMES^XPDUTL("PSS ORDER CHECKS Mail Group successfully created.")
"RTN","PSS147EN",31,0)
 ;
"RTN","PSS147EN",32,0)
 ;
"RTN","PSS147EN",33,0)
 ;
"RTN","PSS147EN",34,0)
REC ;Set up mail message recipients
"RTN","PSS147EN",35,0)
 S @XPDGREF@("PSS147DZ",DUZ)=""
"RTN","PSS147EN",36,0)
 S @XPDGREF@("PSS147DZ","G.PSS ORDER CHECKS")=""
"RTN","PSS147EN",37,0)
 Q
"RTN","PSS147EN",38,0)
 ;
"RTN","PSS147EN",39,0)
 ;
"RTN","PSS147EN",40,0)
KTM ;Kill TMP global
"RTN","PSS147EN",41,0)
 K ^TMP("DIERR",$J)
"RTN","PSS147EN",42,0)
 Q
"RTN","PSS147PO")
0^9^B65037615^n/a
"RTN","PSS147PO",1,0)
PSS147PO ;BIR/RTR-Post Install routine for patch PSS*1*147 ;07/17/09
"RTN","PSS147PO",2,0)
 ;;1.0;PHARMACY DATA MAMAGEMENT;**147**;9/30/97;Build 16
"RTN","PSS147PO",3,0)
 ;
"RTN","PSS147PO",4,0)
 ;
"RTN","PSS147PO",5,0)
 N PSSKDACT,PSSMRMPF
"RTN","PSS147PO",6,0)
 K ^TMP($J,"PSS147TX")
"RTN","PSS147PO",7,0)
 S ^TMP($J,"PSS147TX",1,0)="Installation of patch PSS*1.0*147 has been successfully completed!"
"RTN","PSS147PO",8,0)
 S ^TMP($J,"PSS147TX",2,0)=" " I @XPDGREF@("PSS147IN","INSTALL") S PSSKDACT=3 G SUBS
"RTN","PSS147PO",9,0)
 S ^TMP($J,"PSS147TX",3,0)="Please use the IV Additive Report to review the auto-populated data in the"
"RTN","PSS147PO",10,0)
 S ^TMP($J,"PSS147TX",4,0)="new ADDITIVE FREQUENCY (#18) Field of the IV ADDITIVES (#52.6) File and"
"RTN","PSS147PO",11,0)
 S ^TMP($J,"PSS147TX",5,0)="edit as necessary." S ^TMP($J,"PSS147TX",6,0)=" " S PSSKDACT=7
"RTN","PSS147PO",12,0)
SUBS ;
"RTN","PSS147PO",13,0)
 ;
"RTN","PSS147PO",14,0)
 ;
"RTN","PSS147PO",15,0)
 I '@XPDGREF@("PSS147IN","INSTALL") D BMES^XPDUTL("Populating new Additive Frequency field...") D IV D BMES^XPDUTL("Finished populating new Additive Frequency field...")
"RTN","PSS147PO",16,0)
 D BMES^XPDUTL("Rebuilding PSS MGR Menu...") D MENU D BMES^XPDUTL("Finished rebuilding PSS MGR Menu...")
"RTN","PSS147PO",17,0)
 D PROT D PRMAIL
"RTN","PSS147PO",18,0)
 D BMES^XPDUTL("Generating Mail message....") D MAIL D BMES^XPDUTL("Mail message sent...")
"RTN","PSS147PO",19,0)
 Q
"RTN","PSS147PO",20,0)
 ;
"RTN","PSS147PO",21,0)
 ;
"RTN","PSS147PO",22,0)
IV ;Populate new ADDITIVE FREQUENCY Field in IV ADDITIVES File
"RTN","PSS147PO",23,0)
 N PSSADPN,PSSADPRC,PSSADPDR,PSSADPN1,PSSADPN3,PSSADPCL,X
"RTN","PSS147PO",24,0)
 S PSSADPN="" F  S PSSADPN=$O(^PS(52.6,"B",PSSADPN)) Q:PSSADPN=""  F PSSADPRC=0:0 S PSSADPRC=$O(^PS(52.6,"B",PSSADPN,PSSADPRC)) Q:'PSSADPRC  D
"RTN","PSS147PO",25,0)
 .S PSSADPCL=""
"RTN","PSS147PO",26,0)
 .I $P($G(^PS(52.6,PSSADPRC,0)),"^",14)'="" Q
"RTN","PSS147PO",27,0)
 .S PSSADPDR=$P($G(^PS(52.6,PSSADPRC,0)),"^",2)
"RTN","PSS147PO",28,0)
 .I 'PSSADPDR Q
"RTN","PSS147PO",29,0)
 .S PSSADPN1=$P($G(^PSDRUG(PSSADPDR,"ND")),"^"),PSSADPN3=$P($G(^PSDRUG(PSSADPDR,"ND")),"^",3)
"RTN","PSS147PO",30,0)
 .I PSSADPN1,PSSADPN3 K X S PSSADPCL=$$DCLCODE^PSNAPIS(PSSADPN1,PSSADPN3) K X
"RTN","PSS147PO",31,0)
 .I PSSADPCL="" S PSSADPCL=$P($G(^PSDRUG(PSSADPDR,0)),"^",2)
"RTN","PSS147PO",32,0)
 .I PSSADPCL["VT" S $P(^PS(52.6,PSSADPRC,0),"^",14)=1 Q
"RTN","PSS147PO",33,0)
 .I PSSADPCL'="" S $P(^PS(52.6,PSSADPRC,0),"^",14)="A"
"RTN","PSS147PO",34,0)
 Q
"RTN","PSS147PO",35,0)
 ;
"RTN","PSS147PO",36,0)
 ;
"RTN","PSS147PO",37,0)
MENU ;Rebuild PSS MGR Menu
"RTN","PSS147PO",38,0)
 N PSSKDARS,PSSKDARM
"RTN","PSS147PO",39,0)
 S PSSKDARM=$$LKOPT^XPDMENU("PSS MGR") I 'PSSKDARM D  Q
"RTN","PSS147PO",40,0)
 .D BMES^XPDUTL("Unable to find PSS MGR Menu Option....")
"RTN","PSS147PO",41,0)
 .S ^TMP($J,"PSS147TX",PSSKDACT,0)="Unable to find PSS MGR menu option.." S PSSKDACT=PSSKDACT+1
"RTN","PSS147PO",42,0)
 .S ^TMP($J,"PSS147TX",PSSKDACT,0)="Please Log a Remedy Ticket and refer to this message." S PSSKDACT=PSSKDACT+1
"RTN","PSS147PO",43,0)
 .S ^TMP($J,"PSS147TX",PSSKDACT,0)=" " S PSSKDACT=PSSKDACT+1
"RTN","PSS147PO",44,0)
 I $$FIND1^DIC(19.01,","_PSSKDARM_",","X","PSS IV SOLUTION REPORT","B") D KTM K PSSKDARS S PSSKDARS=$$DELETE^XPDMENU("PSS MGR","PSS IV SOLUTION REPORT") I 'PSSKDARS D  Q
"RTN","PSS147PO",45,0)
 .D BMES^XPDUTL("Unable to unlink PSS IV SOLUTION REPORT from PSS MGR Menu Option....")
"RTN","PSS147PO",46,0)
 .S ^TMP($J,"PSS147TX",PSSKDACT,0)="Unable to unlink PSS IV SOLUTION REPORT from PSS MGR Menu Option" S PSSKDACT=PSSKDACT+1
"RTN","PSS147PO",47,0)
 .S ^TMP($J,"PSS147TX",PSSKDACT,0)="Please Log a Remedy Ticket and refer to this message." S PSSKDACT=PSSKDACT+1
"RTN","PSS147PO",48,0)
 .S ^TMP($J,"PSS147TX",PSSKDACT,0)=" " S PSSKDACT=PSSKDACT+1
"RTN","PSS147PO",49,0)
 D KTM K PSSKDARS S PSSKDARS=$$ADD^XPDMENU("PSS ADDITIVE/SOLUTION REPORTS","PSS IV ADDITIVE REPORT",,1) I 'PSSKDARS D  Q
"RTN","PSS147PO",50,0)
 .D BMES^XPDUTL("Unable to attach PSS IV ADDITIVE REPORT to PSS ADDITIVE/SOLUTION REPORTS Menu.")
"RTN","PSS147PO",51,0)
 .S ^TMP($J,"PSS147TX",PSSKDACT,0)="Unable to attach PSS IV ADDITIVE REPORT to PSS ADDITIVE/SOLUTION REPORTS Menu" S PSSKDACT=PSSKDACT+1
"RTN","PSS147PO",52,0)
 .S ^TMP($J,"PSS147TX",PSSKDACT,0)="Please Log a Remedy Ticket and refer to this message." S PSSKDACT=PSSKDACT+1
"RTN","PSS147PO",53,0)
 .S ^TMP($J,"PSS147TX",PSSKDACT,0)=" " S PSSKDACT=PSSKDACT+1
"RTN","PSS147PO",54,0)
 K PSSKDARS S PSSKDARS=$$ADD^XPDMENU("PSS ADDITIVE/SOLUTION REPORTS","PSS IV SOLUTION REPORT",,2) I 'PSSKDARS D  Q
"RTN","PSS147PO",55,0)
 .D BMES^XPDUTL("Unable to attach PSS IV SOLUTION REPORT to PSS ADDITIVE/SOLUTION REPORTS Menu.")
"RTN","PSS147PO",56,0)
 .S ^TMP($J,"PSS147TX",PSSKDACT,0)="Unable to attach PSS IV SOLUTION REPORT to PSS ADDITIVE/SOLUTION REPORTS Menu" S PSSKDACT=PSSKDACT+1
"RTN","PSS147PO",57,0)
 .S ^TMP($J,"PSS147TX",PSSKDACT,0)="Please Log a Remedy Ticket and refer to this message." S PSSKDACT=PSSKDACT+1
"RTN","PSS147PO",58,0)
 .S ^TMP($J,"PSS147TX",PSSKDACT,0)=" " S PSSKDACT=PSSKDACT+1
"RTN","PSS147PO",59,0)
 K PSSKDARS S PSSKDARS=$$ADD^XPDMENU("PSS MGR","PSS ADDITIVE/SOLUTION REPORTS",,18) I 'PSSKDARS D
"RTN","PSS147PO",60,0)
 .D BMES^XPDUTL("Unable to attach PSS ADDITIVE/SOLUTION REPORTS to PSS MGR Menu Option....")
"RTN","PSS147PO",61,0)
 .S ^TMP($J,"PSS147TX",PSSKDACT,0)="Unable to attach PSS ADDITIVE/SOLUTION REPORTS to PSS MGR Menu Option" S PSSKDACT=PSSKDACT+1
"RTN","PSS147PO",62,0)
 .S ^TMP($J,"PSS147TX",PSSKDACT,0)="Please Log a Remedy Ticket and refer to this message." S PSSKDACT=PSSKDACT+1
"RTN","PSS147PO",63,0)
 .S ^TMP($J,"PSS147TX",PSSKDACT,0)=" " S PSSKDACT=PSSKDACT+1
"RTN","PSS147PO",64,0)
 Q
"RTN","PSS147PO",65,0)
 ;
"RTN","PSS147PO",66,0)
 ;
"RTN","PSS147PO",67,0)
PROT ;Attaching Med Route Receive protocol
"RTN","PSS147PO",68,0)
 ;Check the +1 and +2 Usage in the FileMan documentation
"RTN","PSS147PO",69,0)
 S PSSMRMPF=0
"RTN","PSS147PO",70,0)
 D BMES^XPDUTL("Attaching PSS MED ROUTE RECEIVE protocol to XUMF MFS EVENTS protocol...")
"RTN","PSS147PO",71,0)
 N PSSMRMPR,PSSMRMDJ,PSSMRMRR,PSSMRMAT,PSSMRMER
"RTN","PSS147PO",72,0)
 S PSSMRMPR=$$FIND1^DIC(101,"","X","XUMF MFS EVENTS","B") I 'PSSMRMPR D PASE S PSSMRMPF=1 D KTM Q
"RTN","PSS147PO",73,0)
 S PSSMRMDJ=$$FIND1^DIC(101,"","X","PSS MED ROUTE RECEIVE","B") I 'PSSMRMDJ D PASEX S PSSMRMPF=2 D KTM Q
"RTN","PSS147PO",74,0)
 I $$FIND1^DIC(101.01,","_PSSMRMPR_",","X","PSS MED ROUTE RECEIVE","B") G ADDPRX
"RTN","PSS147PO",75,0)
 K PSSMRMER S PSSMRMAT(1,101.01,"+2,"_PSSMRMPR_",",.01)=PSSMRMDJ D UPDATE^DIE("","PSSMRMAT(1)",,"PSSMRMER(1)")
"RTN","PSS147PO",76,0)
 I '$$FIND1^DIC(101.01,","_PSSMRMPR_",","X","PSS MED ROUTE RECEIVE","B") S PSSMRMPF=3 D PACEZ D KTM Q
"RTN","PSS147PO",77,0)
ADDPRX ;
"RTN","PSS147PO",78,0)
 D KTM D BMES^XPDUTL("PSS MED ROUTE RECEIVE Protocol attached successfully.")
"RTN","PSS147PO",79,0)
 Q
"RTN","PSS147PO",80,0)
 ;
"RTN","PSS147PO",81,0)
 ;
"RTN","PSS147PO",82,0)
PASE ;
"RTN","PSS147PO",83,0)
 K PSSMRMRR
"RTN","PSS147PO",84,0)
 S PSSMRMRR(1)=" " S PSSMRMRR(2)="Cannot find XUMF MFS EVENTS protocol on system, installation will continue,"
"RTN","PSS147PO",85,0)
 S PSSMRMRR(3)="please see post installation mail message for further instructions."
"RTN","PSS147PO",86,0)
 S PSSMRMRR(4)=" "
"RTN","PSS147PO",87,0)
 D MES^XPDUTL(.PSSMRMRR)
"RTN","PSS147PO",88,0)
 Q
"RTN","PSS147PO",89,0)
 ;
"RTN","PSS147PO",90,0)
 ;
"RTN","PSS147PO",91,0)
PASEX ;
"RTN","PSS147PO",92,0)
 K PSSMRMRR
"RTN","PSS147PO",93,0)
 S PSSMRMRR(1)=" " S PSSMRMRR(2)="Cannot find PSS MED ROUTE RECEIVE protocol on system, installation will"
"RTN","PSS147PO",94,0)
 S PSSMRMRR(3)="continue, please see post installation mail message for further instructions."
"RTN","PSS147PO",95,0)
 S PSSMRMRR(4)=" "
"RTN","PSS147PO",96,0)
 D MES^XPDUTL(.PSSMRMRR)
"RTN","PSS147PO",97,0)
 Q
"RTN","PSS147PO",98,0)
 ;
"RTN","PSS147PO",99,0)
 ;
"RTN","PSS147PO",100,0)
PACEZ ;
"RTN","PSS147PO",101,0)
 K PSSMRMRR
"RTN","PSS147PO",102,0)
 S PSSMRMRR(1)=" " S PSSMRMRR(2)="Unable to attach PSS MED ROUTE RECEIVE protocol to XUMF MFS EVENTS protocol,"
"RTN","PSS147PO",103,0)
 S PSSMRMRR(3)="please see post installation mail message for further instructions."
"RTN","PSS147PO",104,0)
 S PSSMRMRR(4)=" "
"RTN","PSS147PO",105,0)
 D MES^XPDUTL(.PSSMRMRR)
"RTN","PSS147PO",106,0)
 Q
"RTN","PSS147PO",107,0)
 ;
"RTN","PSS147PO",108,0)
 ;
"RTN","PSS147PO",109,0)
PRMAIL ;Add protocol message if necessary
"RTN","PSS147PO",110,0)
 I 'PSSMRMPF Q
"RTN","PSS147PO",111,0)
 I PSSMRMPF=1 D  Q
"RTN","PSS147PO",112,0)
 .S ^TMP($J,"PSS147TX",PSSKDACT,0)="Unable to find the XUMF MFS EVENTS protocol. This protocol was exported in" S PSSKDACT=PSSKDACT+1
"RTN","PSS147PO",113,0)
 .S ^TMP($J,"PSS147TX",PSSKDACT,0)="patch XU*8.0*474. You must have this protocol so the PSS MED ROUTE RECEIVE" S PSSKDACT=PSSKDACT+1
"RTN","PSS147PO",114,0)
 .S ^TMP($J,"PSS147TX",PSSKDACT,0)="protocol can be attached to it, in order to process any Standard Medication" S PSSKDACT=PSSKDACT+1
"RTN","PSS147PO",115,0)
 .S ^TMP($J,"PSS147TX",PSSKDACT,0)="Route updates. Please log a Remedy Ticket and refer to this message."
"RTN","PSS147PO",116,0)
 I PSSMRMPF=2 D  Q
"RTN","PSS147PO",117,0)
 .S ^TMP($J,"PSS147TX",PSSKDACT,0)="Unable to find the PSS MED ROUTE RECEIVE protocol. This protocol is exported" S PSSKDACT=PSSKDACT+1
"RTN","PSS147PO",118,0)
 .S ^TMP($J,"PSS147TX",PSSKDACT,0)="in patch PSS*1.0*147. You must have this protocol so it can be attached to the" S PSSKDACT=PSSKDACT+1
"RTN","PSS147PO",119,0)
 .S ^TMP($J,"PSS147TX",PSSKDACT,0)="XUMF MFS EVENTS protocol, in order to process any Standard Medication Route" S PSSKDACT=PSSKDACT+1
"RTN","PSS147PO",120,0)
 .S ^TMP($J,"PSS147TX",PSSKDACT,0)="updates. Please log a Remedy Ticket and refer to this message."
"RTN","PSS147PO",121,0)
 I PSSMRMPF=3 D  Q
"RTN","PSS147PO",122,0)
 .S ^TMP($J,"PSS147TX",PSSKDACT,0)="Unable to attach the PSS MED ROUTE RECEIVE protocol to the XUMF MFS EVENTS" S PSSKDACT=PSSKDACT+1
"RTN","PSS147PO",123,0)
 .S ^TMP($J,"PSS147TX",PSSKDACT,0)="protocol. These protocols must be attached in order to process any Standard" S PSSKDACT=PSSKDACT+1
"RTN","PSS147PO",124,0)
 .S ^TMP($J,"PSS147TX",PSSKDACT,0)="Medication Route updates. Please log a Remedy Ticket and refer to this message."
"RTN","PSS147PO",125,0)
 Q
"RTN","PSS147PO",126,0)
 ;
"RTN","PSS147PO",127,0)
 ;
"RTN","PSS147PO",128,0)
 ;
"RTN","PSS147PO",129,0)
KTM ;Kill TMP global
"RTN","PSS147PO",130,0)
 K ^TMP("DIERR",$J)
"RTN","PSS147PO",131,0)
 Q
"RTN","PSS147PO",132,0)
 ;
"RTN","PSS147PO",133,0)
 ;
"RTN","PSS147PO",134,0)
MAIL ;Send Mail Message
"RTN","PSS147PO",135,0)
 N PSS147RC,XMTEXT,XMY,XMSUB,XMDUZ,XMMG,XMSTRIP,XMROU,XMYBLOB,XMZ,XMDUN
"RTN","PSS147PO",136,0)
 S XMSUB="PSS*1*147 Installation Complete"
"RTN","PSS147PO",137,0)
 S XMDUZ="PSS*1*147 Install"
"RTN","PSS147PO",138,0)
 S XMTEXT="^TMP($J,""PSS147TX"","
"RTN","PSS147PO",139,0)
 S PSS147RC="" F  S PSS147RC=$O(@XPDGREF@("PSS147DZ",PSS147RC)) Q:PSS147RC=""  S XMY(PSS147RC)=""
"RTN","PSS147PO",140,0)
 N DIFROM D ^XMD
"RTN","PSS147PO",141,0)
 K ^TMP($J,"PSS147TX")
"RTN","PSS147PO",142,0)
 Q
"RTN","PSSADRPT")
0^1^B31361232^n/a
"RTN","PSSADRPT",1,0)
PSSADRPT ;BIR/RTR-IV ADDITIVE REPORT ;07/15/09
"RTN","PSSADRPT",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**147**;9/30/97;Build 16
"RTN","PSSADRPT",3,0)
 ;
"RTN","PSSADRPT",4,0)
REP ;IV Additive report
"RTN","PSSADRPT",5,0)
 ;
"RTN","PSSADRPT",6,0)
 W !!,"This report displays entries in the IV ADDITIVES (#52.6) File. You can select",!,"to display only entries marked with '1 BAG/DAY' in the ADDITIVE FREQUENCY (#18)"
"RTN","PSSADRPT",7,0)
 W !,"Field, or only those entries with nothing entered in the ADDITIVE FREQUENCY",!,"(#18) Field, or all entries can be displayed.",!
"RTN","PSSADRPT",8,0)
 N DIR,PSSKFTP,Y,DIRUT,DIROUT,DUOUT,DTOUT,IOP,%ZIS,POP,X,ZTRTN,ZTDESC,ZTSAVE,ZTSK
"RTN","PSSADRPT",9,0)
 K DIR,Y S DIR(0)="SO^1:Print entries marked as '1 BAG/DAY' for ADDITIVE FREQUENCY;N:Print entries marked as Null for ADDITIVE FREQUENCY;A:Print all IV Additives"
"RTN","PSSADRPT",10,0)
 S DIR("B")="A",DIR("A")="Print which IV Additives"
"RTN","PSSADRPT",11,0)
 S DIR("?")=" ",DIR("?",1)="Enter '1' to see only those IV Additives that are marked as '1 BAG/DAY' in"
"RTN","PSSADRPT",12,0)
 S DIR("?",2)="the ADDITIVE FREQUENCY (#18) Field, enter 'N' to see only those IV Additives"
"RTN","PSSADRPT",13,0)
 S DIR("?",3)="with no data entered in the ADDITIVE FREQUENCY (#18) Field, enter 'A' to"
"RTN","PSSADRPT",14,0)
 S DIR("?",4)="see all IV Additives, regardless of ADDITIVE FREQUENCY designation."
"RTN","PSSADRPT",15,0)
 D ^DIR K DIR I $D(DUOUT)!($D(DTOUT)) D MESS Q
"RTN","PSSADRPT",16,0)
 I Y'="1",Y'="N",Y'="A" D MESS Q
"RTN","PSSADRPT",17,0)
 S PSSKFTP=Y
"RTN","PSSADRPT",18,0)
 W !!?3,"This report is designed for 80 column format!",!
"RTN","PSSADRPT",19,0)
 K IOP,%ZIS,POP S %ZIS="QM" D ^%ZIS I $G(POP)>0 W !!,"Nothing queued to print.",! K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR,IOP,%ZIS,POP Q
"RTN","PSSADRPT",20,0)
 I $D(IO("Q")) S ZTRTN="START^PSSADRPT",ZTDESC="IV Additives Report",ZTSAVE("PSSKFTP")="" D ^%ZTLOAD W !!,"Report queued to print.",! D  K IOP,%ZIS,POP Q
"RTN","PSSADRPT",21,0)
 .K DIR,Y S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSSADRPT",22,0)
 ;
"RTN","PSSADRPT",23,0)
 U IO G STARTX
"RTN","PSSADRPT",24,0)
START ;
"RTN","PSSADRPT",25,0)
 U IO
"RTN","PSSADRPT",26,0)
 N DIR,Y,DIRUT,DIROUT,DUOUT,DTOUT,X
"RTN","PSSADRPT",27,0)
STARTX ;
"RTN","PSSADRPT",28,0)
 N PSSKFOUT,PSSKFMDV,PSSKFMFD,PSSKFMCT,PSSKFMLN,PSSKFMXX,PSSKFMIN,PSSKFMAR,PSSKFMSC,PSSKFMSY,PSSKFMSU,PSSKFMSX,PSSKFML1,PSSKFML2,PSSKFMDF,PSSKFMDZ,PSSKFMDQ,PSSKFML3,PSSKFMTP,PSSKFERR,PSSKFERZ,PSSKFERX
"RTN","PSSADRPT",29,0)
 S (PSSKFOUT,PSSKFMFD)=0,PSSKFMDV=$S($E(IOST,1,2)'="C-":"P",1:"C"),PSSKFMCT=1
"RTN","PSSADRPT",30,0)
 K PSSKFMLN S $P(PSSKFMLN,"-",79)=""
"RTN","PSSADRPT",31,0)
 D HD
"RTN","PSSADRPT",32,0)
 S PSSKFMXX="" F  S PSSKFMXX=$O(^PS(52.6,"B",PSSKFMXX)) Q:PSSKFMXX=""!(PSSKFOUT)  D
"RTN","PSSADRPT",33,0)
 .F PSSKFMIN=0:0 S PSSKFMIN=$O(^PS(52.6,"B",PSSKFMXX,PSSKFMIN)) Q:'PSSKFMIN!(PSSKFOUT)  D
"RTN","PSSADRPT",34,0)
 ..K PSSKFMTP,PSSKFMAR,PSSKFMSC,PSSKFMSY,PSSKFMSU,PSSKFMSX,PSSKFML1,PSSKFML2,PSSKFML3
"RTN","PSSADRPT",35,0)
 ..S PSSKFMTP=PSSKFMIN_","
"RTN","PSSADRPT",36,0)
 ..D GETS^DIQ(52.6,PSSKFMTP,".01;1;2;12;15;17;18","IE","PSSKFMAR","PSSKFERR")
"RTN","PSSADRPT",37,0)
 ..I PSSKFTP=1,$G(PSSKFMAR(52.6,PSSKFMTP,18,"I"))'=1 Q
"RTN","PSSADRPT",38,0)
 ..I PSSKFTP="N",$G(PSSKFMAR(52.6,PSSKFMTP,18,"I"))'="" Q
"RTN","PSSADRPT",39,0)
 ..S PSSKFMFD=1
"RTN","PSSADRPT",40,0)
 ..I ($Y+5)>IOSL D HD Q:PSSKFOUT
"RTN","PSSADRPT",41,0)
 ..W !!?18,"Print Name: "_$G(PSSKFMAR(52.6,PSSKFMTP,.01,"E"))
"RTN","PSSADRPT",42,0)
 ..I ($Y+5)>IOSL D HD Q:PSSKFOUT
"RTN","PSSADRPT",43,0)
 ..W !?19,"Drug Unit: "_$G(PSSKFMAR(52.6,PSSKFMTP,2,"E"))
"RTN","PSSADRPT",44,0)
 ..I ($Y+5)>IOSL D HD Q:PSSKFOUT
"RTN","PSSADRPT",45,0)
 ..W !?20,"Synonyms: "
"RTN","PSSADRPT",46,0)
 ..S PSSKFMSC=0 F PSSKFMSY=0:0 S PSSKFMSY=$O(^PS(52.6,PSSKFMIN,3,PSSKFMSY)) Q:'PSSKFMSY!(PSSKFOUT)  D
"RTN","PSSADRPT",47,0)
 ...K PSSKFMSU,PSSKFMSX
"RTN","PSSADRPT",48,0)
 ...S PSSKFMSU=PSSKFMSY_","_PSSKFMIN_"," S PSSKFMSX=$$GET1^DIQ(52.63,PSSKFMSU,".01",,,"PSSKFERX")
"RTN","PSSADRPT",49,0)
 ...W:PSSKFMSC !?30,$G(PSSKFMSX) W:'PSSKFMSC ?30,$G(PSSKFMSX)
"RTN","PSSADRPT",50,0)
 ...S PSSKFMSC=1
"RTN","PSSADRPT",51,0)
 ...I ($Y+5)>IOSL D HD Q:PSSKFOUT
"RTN","PSSADRPT",52,0)
 ..Q:PSSKFOUT
"RTN","PSSADRPT",53,0)
 ..I ($Y+5)>IOSL D HD Q:PSSKFOUT
"RTN","PSSADRPT",54,0)
 ..W !?16,"Generic Drug: "_$G(PSSKFMAR(52.6,PSSKFMTP,1,"E"))
"RTN","PSSADRPT",55,0)
 ..I ($Y+5)>IOSL D HD Q:PSSKFOUT
"RTN","PSSADRPT",56,0)
 ..K PSSKFML1,PSSKFML2,PSSKFMDF,PSSKFMDZ,PSSKFMDQ,PSSKFML3
"RTN","PSSADRPT",57,0)
 ..S PSSKFML1=$L($G(PSSKFMAR(52.6,PSSKFMTP,15,"E"))),PSSKFMDF=$G(PSSKFMAR(52.6,PSSKFMTP,15,"I"))
"RTN","PSSADRPT",58,0)
 ..S PSSKFML2=0 I PSSKFMDF S PSSKFMDZ=PSSKFMDF_"," S PSSKFMDQ=$$GET1^DIQ(50.7,PSSKFMDZ,".02",,,"PSSKFERZ") S PSSKFML2=$L(PSSKFMDQ)
"RTN","PSSADRPT",59,0)
 ..S PSSKFML3=PSSKFML1+PSSKFML2
"RTN","PSSADRPT",60,0)
 ..W !?5,"Pharmacy Orderable Item: "_$G(PSSKFMAR(52.6,PSSKFMTP,15,"E"))
"RTN","PSSADRPT",61,0)
 ..I PSSKFML3<47 W "  "_$G(PSSKFMDQ)
"RTN","PSSADRPT",62,0)
 ..I PSSKFML3'<47 W !?30,$G(PSSKFMDQ)
"RTN","PSSADRPT",63,0)
 ..I ($Y+5)>IOSL D HD Q:PSSKFOUT
"RTN","PSSADRPT",64,0)
 ..W !?11,"Inactivation Date: "_$G(PSSKFMAR(52.6,PSSKFMTP,12,"E"))
"RTN","PSSADRPT",65,0)
 ..I ($Y+5)>IOSL D HD Q:PSSKFOUT
"RTN","PSSADRPT",66,0)
 ..W !,"Used in IV Fluid Order Entry: "_$G(PSSKFMAR(52.6,PSSKFMTP,17,"E"))
"RTN","PSSADRPT",67,0)
 ..I ($Y+5)>IOSL D HD Q:PSSKFOUT
"RTN","PSSADRPT",68,0)
 ..W !?10,"Additive Frequency: "_$G(PSSKFMAR(52.6,PSSKFMTP,18,"E"))
"RTN","PSSADRPT",69,0)
 ..I ($Y+5)>IOSL D HD Q:PSSKFOUT
"RTN","PSSADRPT",70,0)
 ;
"RTN","PSSADRPT",71,0)
END ;End of report
"RTN","PSSADRPT",72,0)
 I '$G(PSSKFOUT),'$G(PSSKFMFD) W !!,$S($G(PSSKFTP)=1:"No IV Additives marked as '1 BAG/DAY'.",$G(PSSKFTP)="N":"No IV Additives marked as null.",1:"No IV Additives to print."),!
"RTN","PSSADRPT",73,0)
 I $G(PSSKFMDV)="P" W !!,"End of Report.",!
"RTN","PSSADRPT",74,0)
 K PSSKFTP
"RTN","PSSADRPT",75,0)
 I '$G(PSSKFOUT),$G(PSSKFMDV)="C" W !!,"End of Report." K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSSADRPT",76,0)
 I $G(PSSKFMDV)="C" W !
"RTN","PSSADRPT",77,0)
 E  W @IOF
"RTN","PSSADRPT",78,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSSADRPT",79,0)
 Q
"RTN","PSSADRPT",80,0)
 ;
"RTN","PSSADRPT",81,0)
HD ;Report Header
"RTN","PSSADRPT",82,0)
 I $G(PSSKFMDV)="C",$G(PSSKFMCT)'=1 W ! K DIR,Y S DIR(0)="E",DIR("A")="Press Return to continue, '^' to exit" D ^DIR K DIR I 'Y S PSSKFOUT=1 Q
"RTN","PSSADRPT",83,0)
 W @IOF W !,$S(PSSKFTP=1:"IV Additives marked as '1 BAG/DAY' for ADDITIVE FREQUENCY",PSSKFTP="N":"IV Additives marked as null for ADDITIVE FREQUENCY",1:"All IV Additives"),?68,"Page: "_$G(PSSKFMCT),!,PSSKFMLN,! S PSSKFMCT=PSSKFMCT+1
"RTN","PSSADRPT",84,0)
 Q
"RTN","PSSADRPT",85,0)
 ;
"RTN","PSSADRPT",86,0)
MESS ;
"RTN","PSSADRPT",87,0)
 W !!,"No Action taken.",!
"RTN","PSSADRPT",88,0)
 K DIR,Y S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSSADRPT",89,0)
 Q
"RTN","PSSDOS")
0^2^B61025597^B50760637
"RTN","PSSDOS",1,0)
PSSDOS ;BIR/RTR-Dose edit option ;03/10/00
"RTN","PSSDOS",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**38,49,50,47,129,147**;9/30/97;Build 16
"RTN","PSSDOS",3,0)
 ;
"RTN","PSSDOS",4,0)
 ;Reference to PS(50.607 supported by DBIA 2221
"RTN","PSSDOS",5,0)
DOSN ;
"RTN","PSSDOS",6,0)
 N X,Y,PSSNFID,PSSNAT,PSSNAT1,PSSNATND,PSSNATDF,PSSNATUN,PSSNOCON,PSSST,PSSUN,PSSNAME,PSSIND,PSSDOSA,PSSXYZ,PSSNATST,POSDOS,LPDOS
"RTN","PSSDOS",7,0)
 N PSSDIEN,PSSONLYI,PSSONLYO,PSSTALK,PSSIZZ,PSSOZZ,PSSSKIPP,PSSWDXF
"RTN","PSSDOS",8,0)
 N PSSIEN S PSSIEN=DA
"RTN","PSSDOS",9,0)
DOSNX ;
"RTN","PSSDOS",10,0)
 D STUN
"RTN","PSSDOS",11,0)
 I PSSST="",$O(^PSDRUG(PSSIEN,"DOS1",0)) K ^PSDRUG(PSSIEN,"DOS") K ^PSDRUG(PSSIEN,"DOS1")
"RTN","PSSDOS",12,0)
 S (PSSIZZ,PSSOZZ)=0 S:'$G(PSSSKIPP) PSSSKIPP=0
"RTN","PSSDOS",13,0)
 S PSSXYZ=0 D CHECK
"RTN","PSSDOS",14,0)
 ;Display strength
"RTN","PSSDOS",15,0)
 D:$P($G(^PSDRUG(PSSIEN,"DOS")),"^")'="" XNWS I $P($G(^PSDRUG(PSSIEN,"DOS")),"^")'="",$O(^PSDRUG(PSSIEN,"DOS1",0)) N PSSIENS,PSS11 G DOSA
"RTN","PSSDOS",16,0)
 ;.N PSSDESTP W !!,"Strength from National Drug File match => "_$S($E($G(PSSNATST),1)=".":"0",1:"")_$G(PSSNATST)_"    "_$P($G(^PS(50.607,+$G(PSSUN),0)),"^")
"RTN","PSSDOS",17,0)
 ;.W !,"Strength currently in the Drug File    => "_$S($E($P($G(^PSDRUG(PSSIEN,"DOS")),"^"),1)=".":"0",1:"")_$P($G(^PSDRUG(PSSIEN,"DOS")),"^")_"    "_$S($P($G(^PS(50.607,+$G(PSSUN),0)),"^")'["/":$P($G(^(0)),"^"),1:"") S PSSDESTP=1 D MS^PSSDSPOP
"RTN","PSSDOS",18,0)
 ;.K PSSDESTP
"RTN","PSSDOS",19,0)
 ;
"RTN","PSSDOS",20,0)
 I $G(PSSXYZ),'$O(^PSDRUG(PSSIEN,"DOS1",0)) D  D ^DIR K DIR I Y=1 S PSSSKIPP=1 D EN2^PSSUTIL(PSSIEN,1) G DOSNX
"RTN","PSSDOS",21,0)
 .K DIR S DIR(0)="Y",DIR("B")="N",DIR("A")="Create Possible Dosages for this drug",DIR("?")=" "
"RTN","PSSDOS",22,0)
 .S DIR("?",1)="This drug meets the criteria to have Possible Dosages, but it currently does",DIR("?",2)="not have any. If you answer 'YES', Possible Dosages will be created for this"
"RTN","PSSDOS",23,0)
 .S DIR("?",3)="drug, based on the match to the National Drug File."
"RTN","PSSDOS",24,0)
 .W !!!,"This drug can have Possible Dosages, but currently does not have any.",!
"RTN","PSSDOS",25,0)
 I '$O(^PSDRUG(PSSIEN,"DOS1",0)) D LPD,QUES G:'Y END G LOCX
"RTN","PSSDOS",26,0)
DOSA S PSSST=$P($G(^PSDRUG(PSSIEN,"DOS")),"^") S PSSWDXF=0
"RTN","PSSDOS",27,0)
 W !!,"Strength => "_$S($E($G(PSSST),1)=".":"0",1:"")_$G(PSSST)_"   Unit => "_$S($P($G(^PS(50.607,+$G(PSSUN),0)),"^")'["/":$P($G(^(0)),"^"),1:"") W !
"RTN","PSSDOS",28,0)
 ;;;I $D(^PSDRUG(PSSIEN,"DOS1"))
"RTN","PSSDOS",29,0)
 D:($Y+5)>IOSL QASK G:PSSWDXF WXF W !,"POSSIBLE DOSAGES:" D
"RTN","PSSDOS",30,0)
 .F PDS=0:0 S PDS=$O(^PSDRUG(PSSIEN,"DOS1",PDS)) Q:'PDS!(PSSWDXF)  D
"RTN","PSSDOS",31,0)
 ..S POSDOS=$G(^PSDRUG(PSSIEN,"DOS1",PDS,0))
"RTN","PSSDOS",32,0)
 ..D:($Y+5)>IOSL QASK Q:PSSWDXF  W !,"   DISPENSE UNITS PER DOSE: ",$S($E($P(POSDOS,U),1)=".":"0",1:"")_$P(POSDOS,U) D
"RTN","PSSDOS",33,0)
 ...S X=$P(POSDOS,U) D SET^PSSDOSLZ W ?38,"DOSE: ",X,?60,"PACKAGE: ",$P(POSDOS,U,3)
"RTN","PSSDOS",34,0)
 ;;;I $D(^PSDRUG(PSSIEN,"DOS2"))
"RTN","PSSDOS",35,0)
 S PSSWDXF=0 W !!,"LOCAL POSSIBLE DOSAGES:" D
"RTN","PSSDOS",36,0)
 .F PDS=0:0 S PDS=$O(^PSDRUG(PSSIEN,"DOS2",PDS)) Q:'PDS!(PSSWDXF)  D
"RTN","PSSDOS",37,0)
 ..D:($Y+5)>IOSL QASK Q:PSSWDXF  S LPDOS=$G(^PSDRUG(PSSIEN,"DOS2",PDS,0)) W !,"  LOCAL POSSIBLE DOSAGE: " D
"RTN","PSSDOS",38,0)
 ...I $L($P(LPDOS,U))'>27 W $P(LPDOS,U),?55,"PACKAGE: ",$P(LPDOS,U,2) D WXFPT(LPDOS) Q
"RTN","PSSDOS",39,0)
 ...W !,?10,$P(LPDOS,U),!,?55,"PACKAGE: ",$P(LPDOS,U,2) D WXFPT(LPDOS)
"RTN","PSSDOS",40,0)
WXF ;
"RTN","PSSDOS",41,0)
 W !! K DIR S DIR(0)="Y",DIR("A")="Do you want to edit the dosages",DIR("B")="N" D ^DIR K DIR I 'Y W ! D END Q
"RTN","PSSDOS",42,0)
 I $G(PSSST) W !!,"Changing the strength will update all possible dosages for this Drug.",!
"RTN","PSSDOS",43,0)
 ;Edit Strength
"RTN","PSSDOS",44,0)
 I $G(PSSST) W ! K DIE S DIE="^PSDRUG(",DA=PSSIEN,DR=901 D ^DIE W ! K DIE,PSSXYZ I $P($G(^PSDRUG(PSSIEN,"DOS")),"^")="" K ^PSDRUG(PSSIEN,"DOS") K ^PSDRUG(PSSIEN,"DOS1") W !!,"Deleting Strength has deleted all Possible Dosages!",!
"RTN","PSSDOS",45,0)
 I '$P($G(^PSDRUG(PSSIEN,"DOS")),"^") D LPD D QUES G:'Y END G LOC
"RTN","PSSDOS",46,0)
 ;
"RTN","PSSDOS",47,0)
DOSA1 K DIC S DA(1)=PSSIEN,DIC="^PSDRUG("_PSSIEN_",""DOS1"",",DIC(0)="QEAMLZ",DIC("A")="Select DISPENSE UNITS PER DOSE: " D  D ^DIC K DIC I Y<1!($D(DTOUT))!($D(DUOUT)) G DOSLOC
"RTN","PSSDOS",48,0)
 .S DIC("W")="W ""  ""_$S($E($P($G(^PSDRUG(PSSIEN,""DOS1"",+Y,0)),""^"",2),1)=""."":""0"",1:"""")_$P($G(^PSDRUG(PSSIEN,""DOS1"",+Y,0)),""^"",2)_""    ""_$P($G(^PSDRUG(PSSIEN,""DOS1"",+Y,0)),""^"",3)"
"RTN","PSSDOS",49,0)
 S PSSDOSA=+Y
"RTN","PSSDOS",50,0)
 W ! K DIE S DA(1)=PSSIEN,DA=PSSDOSA,DR=".01;2",DIE="^PSDRUG("_PSSIEN_",""DOS1""," D ^DIE K DIE D:'$D(Y)&('$D(DTOUT)) BCMA^PSSDOSER G:$D(Y)!($D(DTOUT)) DOSLOC
"RTN","PSSDOS",51,0)
 W ! G DOSA1
"RTN","PSSDOS",52,0)
DOSLOC ;
"RTN","PSSDOS",53,0)
 S (PSSPCI,PSSPCO)=0
"RTN","PSSDOS",54,0)
 F PSSPCZ=0:0 S PSSPCZ=$O(^PSDRUG(PSSIEN,"DOS1",PSSPCZ)) Q:'PSSPCZ  D
"RTN","PSSDOS",55,0)
 .I $P($G(^PSDRUG(PSSIEN,"DOS1",PSSPCZ,0)),"^",2)'="" S:$P($G(^(0)),"^",3)["I" PSSPCI=1 S:$P($G(^(0)),"^",3)["O" PSSPCO=1
"RTN","PSSDOS",56,0)
 I PSSPCI,PSSPCO W !! K DIR S DIR(0)="Y",DIR("B")="N",DIR("A")="Enter/Edit Local Possible Dosages" D  D ^DIR K DIR I Y'=1 K PSSPCI,PSSPCO,PSSPCZ W ! D END Q
"RTN","PSSDOS",57,0)
 .S DIR("?")=" ",DIR("?",1)="Possible Dosages exist for both Outpatient Pharmacy and Inpatient Medications.",DIR("?",2)="Local Possible Dosages can be added, but will not be displayed for selection"
"RTN","PSSDOS",58,0)
 .S DIR("?",3)="as long as there are Possible Dosages.",DIR("?",4)=" ",DIR("?",5)="Enter 'Y' to Enter/Edit Local Possible Dosages."
"RTN","PSSDOS",59,0)
 K PSSPCI,PSSPCO,PSSPCZ
"RTN","PSSDOS",60,0)
 ;
"RTN","PSSDOS",61,0)
LOCX ;
"RTN","PSSDOS",62,0)
 I $G(PSSSKIPP) G LOC
"RTN","PSSDOS",63,0)
 I $G(PSSIZZ),$G(PSSOZZ) G LOC
"RTN","PSSDOS",64,0)
 K PSSONLYO,PSSONLYI
"RTN","PSSDOS",65,0)
 I $G(PSSIZZ),'$G(PSSOZZ) S PSSONLYO=1
"RTN","PSSDOS",66,0)
 I $G(PSSOZZ),'$G(PSSIZZ) S PSSONLYI=1
"RTN","PSSDOS",67,0)
 S PSSTALK=1,PSSDIEN=PSSIEN D LOC^PSSUTIL K PSSONLYI,PSSONLYO,PSSTALK,PSSDIEN
"RTN","PSSDOS",68,0)
LOC ; Edit local dose
"RTN","PSSDOS",69,0)
 D STUN,NATND,PR
"RTN","PSSDOS",70,0)
 W ! K DIC S DA(1)=PSSIEN,DIC="^PSDRUG("_PSSIEN_",""DOS2"",",DIC(0)="QEAMLZ" D  D ^DIC K DIC I Y<1!($D(DTOUT))!($D(DUOUT)) D END Q
"RTN","PSSDOS",71,0)
 .S DIC("W")="W ""  ""_$P($G(^PSDRUG(PSSIEN,""DOS2"",+Y,0)),""^"",2)"
"RTN","PSSDOS",72,0)
 S PSSDOSA=+Y,PSSOTH=$S($P($G(^PS(59.7,1,40.2)),"^"):1,1:0)
"RTN","PSSDOS",73,0)
 W ! K DIE S DA(1)=PSSIEN,DA=PSSDOSA,DR=".01;S:'$G(PSSOTH) Y=""@1"";3;@1;1",DIE="^PSDRUG("_PSSIEN_",""DOS2"","
"RTN","PSSDOS",74,0)
 D ^DIE K DIE,PSSOTH G:$P($G(^PSDRUG(PSSIEN,"DOS2",PSSDOSA,0)),"^")="" LOC D:'$D(Y)&('$D(DTOUT)) BCMA1^PSSDOSER I $D(Y)!($D(DTOUT)) D END Q
"RTN","PSSDOS",75,0)
 I $$TEST^PSSDSPOP(PSSIEN) K DA,DIE,DR,DIDEL S DA(1)=PSSIEN,DA=PSSDOSA,DR="4;5",DIE="^PSDRUG("_PSSIEN_",""DOS2""," D ^DIE K DIE,DA,DR,DIDEL I $D(Y)!($D(DTOUT)) D END Q
"RTN","PSSDOS",76,0)
 G LOC
"RTN","PSSDOS",77,0)
LPD ; Display local dose before edit
"RTN","PSSDOS",78,0)
 S PSSWDXF=0 D:($Y+5)>IOSL QASK Q:PSSWDXF  W !!,"LOCAL POSSIBLE DOSAGES:" D
"RTN","PSSDOS",79,0)
 .F PDS=0:0 S PDS=$O(^PSDRUG(PSSIEN,"DOS2",PDS)) Q:'PDS!(PSSWDXF)  D
"RTN","PSSDOS",80,0)
 ..D:($Y+5)>IOSL QASK Q:PSSWDXF  S LPDOS=$G(^PSDRUG(PSSIEN,"DOS2",PDS,0)) W !,"  " D
"RTN","PSSDOS",81,0)
 ...I $L($P(LPDOS,U))'>27 W $P(LPDOS,U),?55,"PACKAGE: ",$P(LPDOS,U,2) D WXFPT(LPDOS) Q
"RTN","PSSDOS",82,0)
 ...W !,?10,$P(LPDOS,U),!,?55,"PACKAGE: ",$P(LPDOS,U,2) D WXFPT(LPDOS)
"RTN","PSSDOS",83,0)
 Q
"RTN","PSSDOS",84,0)
CHECK ;
"RTN","PSSDOS",85,0)
 K PSSNAT,PSSNATND,PSSNATDF,PSSNATUN,PSSNATST,PSSIZZ,PSSOZZ
"RTN","PSSDOS",86,0)
 D NATND
"RTN","PSSDOS",87,0)
 ;I $G(PSSST) S PSSXYZ=1 Q
"RTN","PSSDOS",88,0)
 Q:'PSSNATDF!('PSSNATUN)!($G(PSSNATST)="")
"RTN","PSSDOS",89,0)
 Q:'$D(^PS(50.606,PSSNATDF,0))!('$D(^PS(50.607,PSSNATUN,0)))
"RTN","PSSDOS",90,0)
 I PSSNATST'?.N&(PSSNATST'?.N1".".N) Q
"RTN","PSSDOS",91,0)
 I $D(^PS(50.606,"ACONI",PSSNATDF,PSSNATUN)),$O(^PS(50.606,"ADUPI",PSSNATDF,0)) S (PSSXYZ,PSSIZZ)=1
"RTN","PSSDOS",92,0)
 I $D(^PS(50.606,"ACONO",PSSNATDF,PSSNATUN)),$O(^PS(50.606,"ADUPO",PSSNATDF,0)) S (PSSXYZ,PSSOZZ)=1
"RTN","PSSDOS",93,0)
 Q
"RTN","PSSDOS",94,0)
END K PSSNFID,PSSNAT,PSSNAT1,PSSNATND,PSSNATDF,PSSNATUN,PSSNOCON,PSSST,PSSUN,PSSIEN,PSSNAME,PSSIND,PSSDOSA,PSSXYZ,PSSNATST
"RTN","PSSDOS",95,0)
 Q
"RTN","PSSDOS",96,0)
ULK ;No need to unlock, called from Drug enter/edit
"RTN","PSSDOS",97,0)
 Q:'$G(PSSIEN)
"RTN","PSSDOS",98,0)
 L -^PSDRUG(PSSIEN)
"RTN","PSSDOS",99,0)
 Q
"RTN","PSSDOS",100,0)
QUES ;
"RTN","PSSDOS",101,0)
 W ! K DIR S DIR(0)="Y",DIR("A")="Do you want to edit Local Possible Dosages",DIR("B")="N" D ^DIR K DIR Q
"RTN","PSSDOS",102,0)
 Q
"RTN","PSSDOS",103,0)
STUN S PSSST=$P($G(^PSDRUG(PSSIEN,"DOS")),"^"),PSSUN=$P($G(^("DOS")),"^",2)
"RTN","PSSDOS",104,0)
 Q
"RTN","PSSDOS",105,0)
NATND S PSSNAT=+$P($G(^PSDRUG(PSSIEN,"ND")),"^",3),PSSNAT1=$P($G(^("ND")),"^")
"RTN","PSSDOS",106,0)
 S PSSNATND=$$DFSU^PSNAPIS(PSSNAT1,PSSNAT) S PSSNATDF=$P(PSSNATND,"^"),PSSNATST=$P(PSSNATND,"^",4),PSSNATUN=$P(PSSNATND,"^",5)
"RTN","PSSDOS",107,0)
 Q
"RTN","PSSDOS",108,0)
PR I PSSST'=""!(PSSNATST'=""),(PSSUN!(PSSNATUN)) D
"RTN","PSSDOS",109,0)
 .W !!,"Strength: "_$S($E($S(PSSST'="":PSSST,1:PSSNATST),1)=".":"0",1:"")_$S(PSSST'="":PSSST,1:PSSNATST)
"RTN","PSSDOS",110,0)
 .W ?30,"Unit: "_$P($G(^PS(50.607,+$S(PSSUN:PSSUN,1:PSSNATUN),0)),"^")
"RTN","PSSDOS",111,0)
 E  W !!,"Strength: ",?30,"Unit: "
"RTN","PSSDOS",112,0)
 Q
"RTN","PSSDOS",113,0)
XNWS ;
"RTN","PSSDOS",114,0)
 N PSSDESTP W !!,"Strength from National Drug File match => "_$S($E($G(PSSNATST),1)=".":"0",1:"")_$G(PSSNATST)_"    "_$P($G(^PS(50.607,+$G(PSSUN),0)),"^")
"RTN","PSSDOS",115,0)
 W !,"Strength currently in the Drug File    => "_$S($E($P($G(^PSDRUG(PSSIEN,"DOS")),"^"),1)=".":"0",1:"")_$P($G(^PSDRUG(PSSIEN,"DOS")),"^")_"    "_$S($P($G(^PS(50.607,+$G(PSSUN),0)),"^")'["/":$P($G(^(0)),"^"),1:"") S PSSDESTP=1 D MS^PSSDSPOP
"RTN","PSSDOS",116,0)
 K PSSDESTP
"RTN","PSSDOS",117,0)
 Q
"RTN","PSSDOS",118,0)
 ;
"RTN","PSSDOS",119,0)
 ;
"RTN","PSSDOS",120,0)
QASK ;Ask to continue
"RTN","PSSDOS",121,0)
 N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","PSSDOS",122,0)
 K DIR W ! S DIR(0)="E",DIR("A")="Press Return to continue,'^' to exit"  D ^DIR K DIR I 'Y S PSSWDXF=1
"RTN","PSSDOS",123,0)
 W @IOF
"RTN","PSSDOS",124,0)
 Q
"RTN","PSSDOS",125,0)
 ;
"RTN","PSSDOS",126,0)
 ;
"RTN","PSSDOS",127,0)
WXFPT(PSSWDXVL) ;Add print fields with PSS*1*147
"RTN","PSSDOS",128,0)
 N PSSWDX1,PSSWDX2,PSSWDX3,PSSWDX4,PSSWDX5,PSSWDX6
"RTN","PSSDOS",129,0)
 S PSSWDX4=""
"RTN","PSSDOS",130,0)
 S PSSWDX1=$P(PSSWDXVL,"^",3),PSSWDX2=$P(PSSWDXVL,"^",5),PSSWDX3=$P(PSSWDXVL,"^",6)
"RTN","PSSDOS",131,0)
 I PSSWDX2 S PSSWDX4=$P($G(^PS(51.24,+PSSWDX2,0)),"^")
"RTN","PSSDOS",132,0)
 S PSSWDX5=$S($E(PSSWDX3)=".":"0",1:"")_PSSWDX3
"RTN","PSSDOS",133,0)
 S PSSWDX6=$L(PSSWDX5)
"RTN","PSSDOS",134,0)
 D:($Y+5)>IOSL QASK Q:PSSWDXF  W !?4,"BCMA UNITS PER DOSE: "_PSSWDX1
"RTN","PSSDOS",135,0)
 I PSSWDX6<12 D:($Y+5)>IOSL QASK Q:PSSWDXF  W !?4,"       NUMERIC DOSE: "_PSSWDX5,?38,"DOSE UNIT: "_PSSWDX4 Q
"RTN","PSSDOS",136,0)
 D:($Y+5)>IOSL QASK Q:PSSWDXF  W !,?4,"       NUMERIC DOSE: "_PSSWDX5
"RTN","PSSDOS",137,0)
 D:($Y+5)>IOSL QASK Q:PSSWDXF  W !,?38,"DOSE UNIT: "_PSSWDX4
"RTN","PSSDOS",138,0)
 Q
"RTN","PSSLOOK")
0^3^B85630505^B78953701
"RTN","PSSLOOK",1,0)
PSSLOOK ;BIR/WRT-Drug file lookup ;02/03/00
"RTN","PSSLOOK",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**3,7,15,16,20,24,29,38,68,61,87,90,127,147**;9/30/97;Build 16
"RTN","PSSLOOK",3,0)
 ;
"RTN","PSSLOOK",4,0)
 ;Reference to ^PS(50.605 supported by DBIA #2138
"RTN","PSSLOOK",5,0)
 ;Reference to ^PS(50.608 supported by DBIA #2136
"RTN","PSSLOOK",6,0)
 ;Reference to ^PS(50.609 supported by DBIA #2137
"RTN","PSSLOOK",7,0)
 ;Reference to ^PS(50.607 supported by DBIA #2221
"RTN","PSSLOOK",8,0)
 ;Reference to $$FORMRX^PSNAPIS(DA,K,.LIST) supported by DBIA #2574
"RTN","PSSLOOK",9,0)
 ;Reference to $$FORMI^PSNAPIS(P1,P3) supported by DBIA #2574
"RTN","PSSLOOK",10,0)
 ;Reference to $$PSJDF^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSSLOOK",11,0)
 ;Reference to $$PSJST^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSSLOOK",12,0)
 ;Reference to $$PROD2^PSNAPIS(P1,P3) supported by DBIA #2531
"RTN","PSSLOOK",13,0)
 ;Reference to $$VAGN^PSNAPIS(P1) supported by DBIA #2531
"RTN","PSSLOOK",14,0)
 ;Reference to ^PSNDF(50.68 supported by DBIA 3735
"RTN","PSSLOOK",15,0)
 ;
"RTN","PSSLOOK",16,0)
START S QUIT=0,PSSFG=0 D KILL F PSSXX=1:1 D PICK Q:PSSFG
"RTN","PSSLOOK",17,0)
DONE D KILL K PSSFG,PSSXX,QUIT,FM,FMS,Y2K
"RTN","PSSLOOK",18,0)
 Q
"RTN","PSSLOOK",19,0)
PICK W ! K DIC S DIC="^PSDRUG(",DIC(0)="QEAMN" D ^DIC K DIC I Y<0 S PSSFG=1 Q
"RTN","PSSLOOK",20,0)
 S IFN=+Y D NDDATA,GETDATA,INACT,NOD66,FORMAT,KILL
"RTN","PSSLOOK",21,0)
 Q
"RTN","PSSLOOK",22,0)
NDDATA I $D(^PSDRUG(IFN,"ND")) S CLPTR=$P(^PSDRUG(IFN,"ND"),"^",6) I $P(^PSDRUG(IFN,"ND"),"^",2)]"" S NDNODE=^PSDRUG(IFN,"ND"),VAGNPTR=$P(NDNODE,"^",1),VAPN=$P(NDNODE,"^",2),SZPTR=$P(NDNODE,"^",4),TYPTR=$P(NDNODE,"^",5) D NDF,NDF1
"RTN","PSSLOOK",23,0)
 Q
"RTN","PSSLOOK",24,0)
NDF S DA=VAGNPTR,X=$$VAGN^PSNAPIS(DA),VAGN=X,PS=$P(^PS(50.609,SZPTR,0),"^",1),PT=$P(^PS(50.608,TYPTR,0),"^",1),P3=$P(NDNODE,"^",3)
"RTN","PSSLOOK",25,0)
 K X S DA=VAGNPTR,K=P3,X=$$PROD2^PSNAPIS(DA,K) I X]"",$P(X,"^")]"" S VAPRN=$P(X,"^"),VADU=$P(X,"^",4),CMOPID=$P(X,"^",2)
"RTN","PSSLOOK",26,0)
 S CSF="" I $P(NDNODE,"^",3) S CSF=$$GET1^DIQ(50.68,$P(NDNODE,"^",3),19,"I")
"RTN","PSSLOOK",27,0)
 Q
"RTN","PSSLOOK",28,0)
IT S CMOPID=$P(X,"^",2)
"RTN","PSSLOOK",29,0)
 Q
"RTN","PSSLOOK",30,0)
NDF1 S X=$$PSJDF^PSNAPIS(DA,K),VADF=$P(X,"^",2)
"RTN","PSSLOOK",31,0)
 Q
"RTN","PSSLOOK",32,0)
INACT S ACT="" I $D(^PSDRUG(IFN,"I")) S Y=$P(^PSDRUG(IFN,"I"),"^",1) X ^DD("DD") S ACT=Y
"RTN","PSSLOOK",33,0)
 Q
"RTN","PSSLOOK",34,0)
GETDATA S NODE0=^PSDRUG(IFN,0),GN=$P(NODE0,"^",1),CL=$P(NODE0,"^",2),DEA=$P(NODE0,"^",3),WRN=$P(NODE0,"^",8),NF=$P(NODE0,"^",9),MESS=$P(NODE0,"^",10),VNF=$P(NODE0,"^",11),CLASS="",WARN="" S:NF=1 NF="N/F" S:VNF=1 VNF="V-N/F"
"RTN","PSSLOOK",35,0)
 S PSSNODE=$G(^PSDRUG(IFN,"DOS"))
"RTN","PSSLOOK",36,0)
 I CL]"" S CLASS=CL_"  "_$P(^PS(50.605,CLPTR,0),"^",2)
"RTN","PSSLOOK",37,0)
 I $D(^PSDRUG(IFN,3)) S:$P(^PSDRUG(IFN,3),"^")=0 CMOP="NO" S:$P(^PSDRUG(IFN,3),"^")=1 CMOP="YES"
"RTN","PSSLOOK",38,0)
 I $D(^PSDRUG(IFN,5)) S QDM=^PSDRUG(IFN,5)
"RTN","PSSLOOK",39,0)
 S OINM="" S NDC="" I $D(^PSDRUG(IFN,2)) S NODE2=^PSDRUG(IFN,2) S:$P(NODE2,"^",1)]"" OIPTR=$P(NODE2,"^",1) S NDC=$P(NODE2,"^",4) S:$P(NODE2,"^",6)]"" PDPTR=$P(NODE2,"^",6) S APP=$P(NODE2,"^",3),FM="" D TWOA
"RTN","PSSLOOK",40,0)
 Q
"RTN","PSSLOOK",41,0)
TWOA I $D(OIPTR) S OI=$P(^PS(50.7,OIPTR,0),"^",1),DFPTR=$P(^PS(50.7,OIPTR,0),"^",2),DF=$P(^PS(50.606,DFPTR,0),"^",1),FMS=$P(^PS(50.7,OIPTR,0),"^",12) S:FMS]"" FM=" (N/F)" S OINM=OI_" "_DF_FM
"RTN","PSSLOOK",42,0)
 ;I $D(PDPTR) S PD=$P(^PS(50.3,PDPTR,0),"^",1)
"RTN","PSSLOOK",43,0)
 Q
"RTN","PSSLOOK",44,0)
NOD66 S (DUPOU,PPDU,PPOU,DU,SS)="" I $D(^PSDRUG(IFN,660)) S NDE=^PSDRUG(IFN,660),OUPTR=$P(NDE,"^",2),PPOU=$P(NDE,"^",3),DUPOU=$P(NDE,"^",5),PPDU=$P(NDE,"^",6),SS=$P(NDE,"^",7),DU=$P(NDE,"^",8) I OUPTR]"" S OU=$P(^DIC(51.5,OUPTR,0),"^")
"RTN","PSSLOOK",45,0)
 Q
"RTN","PSSLOOK",46,0)
SYN I $D(^PSDRUG(IFN,1,0)) F ZZZ=0:0 S ZZZ=$O(^PSDRUG(IFN,1,ZZZ)) Q:'ZZZ  S SYNM=$P(^PSDRUG(IFN,1,ZZZ,0),"^",1),INT=$P(^PSDRUG(IFN,1,ZZZ,0),"^",3) D SYN1
"RTN","PSSLOOK",47,0)
 Q
"RTN","PSSLOOK",48,0)
SYN1 S INT=$S(INT=0:"Trade Name",INT=1:"Quick Code",INT="C":"Ctrl Substances",INT="D":"Drug Accountability",1:"") D FULL Q:$G(QUIT)  W ?14,SYNM,?55,INT,!
"RTN","PSSLOOK",49,0)
 Q
"RTN","PSSLOOK",50,0)
SYN2 S:INT=0 INT="Trade" S:INT=1 INT="Quick" S:INT="C" INT="Ctrl Subs" S:INT="D" INT="Drug Acct" W ?16,SYNM,?57,INT,!
"RTN","PSSLOOK",51,0)
 Q
"RTN","PSSLOOK",52,0)
IFCAP I $D(^PSDRUG(IFN,441,0)) F QQQ=0:0 S QQQ=$O(^PSDRUG(IFN,441,QQQ)) Q:'QQQ  S IFCAPNM=$P(^PSDRUG(IFN,441,QQQ,0),"^",1)
"RTN","PSSLOOK",53,0)
 Q
"RTN","PSSLOOK",54,0)
FORMAT ; BEGIN WRITING
"RTN","PSSLOOK",55,0)
 N DAW
"RTN","PSSLOOK",56,0)
 W @IOF,?21,GN,!
"RTN","PSSLOOK",57,0)
 F XX=1:1:77 W "="
"RTN","PSSLOOK",58,0)
 W !
"RTN","PSSLOOK",59,0)
 W:$D(VAPRN) "VA PRINT NAME: ",?17,VAPRN W:$D(CMOPID) ?60,"CMOP ID#: ",CMOPID W:$D(VAPN) !,"VA PRODUCT NAME: ",?17,VAPN W:$D(CMOP) ?60,"CMOP DISPENSE: ",CMOP
"RTN","PSSLOOK",60,0)
 W:$D(OINM) !,"ORDERABLE ITEM: ",?17,OINM W:$D(VAPN) ?60,"NDF DF: ",VADF
"RTN","PSSLOOK",61,0)
 I $D(OIPTR),OIPTR]"" W !,"ORDERABLE ITEM TEXT: ",! D OITXT
"RTN","PSSLOOK",62,0)
 W:$D(PD) !,"PRIMARY DRUG: ",?17,PD
"RTN","PSSLOOK",63,0)
 W !,"SYNONYM(S): " D SYN D FULL Q:$G(QUIT)  W !,"MESSAGE: ",MESS,!
"RTN","PSSLOOK",64,0)
 D FULL Q:$G(QUIT)  F XX=1:1:77 W "-"
"RTN","PSSLOOK",65,0)
 W !
"RTN","PSSLOOK",66,0)
 D FULL Q:$G(QUIT)  W "DEA, SPECIAL HDLG: ",DEA,?48,"NDC: ",?63,NDC
"RTN","PSSLOOK",67,0)
 S DAW=+$$GET1^DIQ(50,IFN,81)
"RTN","PSSLOOK",68,0)
 D FULL Q:$G(QUIT)  W !,"DAW CODE:  ",DAW," - ",$$DAWEXT^PSSDAWUT(DAW)
"RTN","PSSLOOK",69,0)
 D FULL Q:$G(QUIT)  W !,"CS FEDERAL SCHEDULE: ",$G(CSF)
"RTN","PSSLOOK",70,0)
 D FULL Q:$G(QUIT)  W !,"INACTIVE DATE: ",ACT
"RTN","PSSLOOK",71,0)
 D FULL Q:$G(QUIT)  W:$D(QDM) !,"QUANTITY DISPENSE MESSAGE: ",QDM,!
"RTN","PSSLOOK",72,0)
 D FULL Q:$G(QUIT)  I WRN]"" W !,"WARNING LABEL: " S X=WRN F Z0=1:1 Q:$P(X,",",Z0,99)=""  S Z1=$P(X,",",Z0) W:$D(^PS(54,Z1,0)) ?19,$P(^(0),"^",1),! I '$D(^(0)) W ?19,"NO SUCH WARNING LABEL" K X Q
"RTN","PSSLOOK",73,0)
 D FULL Q:$G(QUIT)  S PSSLOOK=1 D
"RTN","PSSLOOK",74,0)
 .N DRUG
"RTN","PSSLOOK",75,0)
 .I $P($G(^PSDRUG(IFN,0)),"^")="" K PSSLOOK Q
"RTN","PSSLOOK",76,0)
 .S PSSWSITE=+$O(^PS(59.7,0)) W !,"WARNING LABEL SOURCE is " D
"RTN","PSSLOOK",77,0)
 ..I $P($G(^PS(59.7,PSSWSITE,10)),"^",9)="N" W "set to 'NEW'" Q
"RTN","PSSLOOK",78,0)
 ..W "not set to 'NEW'"
"RTN","PSSLOOK",79,0)
 .K PSSWRN
"RTN","PSSLOOK",80,0)
 .D FULL Q:$G(QUIT)  W !,"NEW WARNING LABEL:"
"RTN","PSSLOOK",81,0)
 .S ^TMP("PSSWRNB",$J,$P(^PSDRUG(IFN,0),"^"))="" D ^PSSWRNE
"RTN","PSSLOOK",82,0)
 .K PSSLOOK,^TMP("PSSWRNB",$J),PSSWRN
"RTN","PSSLOOK",83,0)
 D FULL Q:$G(QUIT)  W:'$D(QDM) ! F XX=1:1:77 W "-"
"RTN","PSSLOOK",84,0)
 D FULL Q:$G(QUIT)  W !
"RTN","PSSLOOK",85,0)
 W "ORDER UNIT: ",?27 W:$D(OU) OU W ?40,"PRICE/ORDER UNIT: ",?67,PPOU
"RTN","PSSLOOK",86,0)
 D FULL Q:$G(QUIT)  W !,"DISPENSE UNIT: ",?27,DU W:$D(VADU) ?40,"VA DISPENSE UNIT: ",?67,VADU
"RTN","PSSLOOK",87,0)
 D FULL Q:$G(QUIT)  W !,"DISPENSE UNITS/ORDER UNIT: ",?21,DUPOU,?40,"PRICE/DISPENSE UNIT: ",?67,PPDU
"RTN","PSSLOOK",88,0)
 D FULL Q:$G(QUIT)  W !,"NCPDP DISPENSE UNIT: ",$$GET1^DIQ(50,IFN,82),?40,"NCPDP QUANTITY MULTIPLIER: ",?67,$J($$GET1^DIQ(50,IFN,83),8,3)
"RTN","PSSLOOK",89,0)
 D FULL Q:$G(QUIT)  W !,"APPL PKG USE:" D PACK
"RTN","PSSLOOK",90,0)
 Q
"RTN","PSSLOOK",91,0)
PACK S APPL="" S:'$D(APP) APPL="  NONE"
"RTN","PSSLOOK",92,0)
 I $D(APP) D
"RTN","PSSLOOK",93,0)
 . S:APP["O" APPL=APPL_"  Outpatient" S:APP["U" APPL=APPL_"  Unit Dose"
"RTN","PSSLOOK",94,0)
 . S:APP["I" APPL=APPL_"  IV" S:APP["W" APPL=APPL_"  Ward Stock"
"RTN","PSSLOOK",95,0)
 . S:APP["N" APPL=APPL_"  Control Subs" S:APP["X" APPL=APPL_"  Non-VA Med"
"RTN","PSSLOOK",96,0)
 . S:APPL="" APPL="  NONE"
"RTN","PSSLOOK",97,0)
 W ?13,APPL
"RTN","PSSLOOK",98,0)
 I $P(PSSNODE,"^",2) S (PSSCALC,PSSUNIT)=$P($G(^PS(50.607,+$P(PSSNODE,U,2),0)),U),PSSSTR=$P(PSSNODE,"^")
"RTN","PSSLOOK",99,0)
 I $G(PSSUNIT)'="",$G(PSSUNIT)["/" D UNCALC
"RTN","PSSLOOK",100,0)
 D FULL Q:$G(QUIT)  W !,"STRENGTH: ",$S($E($P(PSSNODE,U),1)=".":"0",1:"")_$P(PSSNODE,U),?35,"UNIT: ",$G(PSSCALC)
"RTN","PSSLOOK",101,0)
 D FULL Q:$G(QUIT)  W !,"POSSIBLE DOSAGES:"
"RTN","PSSLOOK",102,0)
 I $D(^PSDRUG(IFN,"DOS1",0)) F PDS=0:0 S PDS=$O(^PSDRUG(IFN,"DOS1",PDS)) Q:'PDS  D
"RTN","PSSLOOK",103,0)
 .S POSDOS=^PSDRUG(IFN,"DOS1",PDS,0)
"RTN","PSSLOOK",104,0)
 .D FULL Q:$G(QUIT)  W !,"   DISPENSE UNITS PER DOSE: ",$S($E($P(POSDOS,U),1)=".":"0",1:"")_$P(POSDOS,U),?40,"DOSE: ",$S($E($P(POSDOS,U,2),1)=".":"0",1:"")_$P(POSDOS,U,2),?55,"PACKAGE: ",$P(POSDOS,U,3)
"RTN","PSSLOOK",105,0)
 .D FULL Q:$G(QUIT)  W !,"       BCMA UNITS PER DOSE: ",$P(POSDOS,U,4)
"RTN","PSSLOOK",106,0)
 D FULL Q:$G(QUIT)  W !,"LOCAL POSSIBLE DOSAGES:"
"RTN","PSSLOOK",107,0)
 I $D(^PSDRUG(IFN,"DOS2",0)) F PDS=0:0 S PDS=$O(^PSDRUG(IFN,"DOS2",PDS)) Q:'PDS  D
"RTN","PSSLOOK",108,0)
 .S LPDOS=^PSDRUG(IFN,"DOS2",PDS,0)
"RTN","PSSLOOK",109,0)
 .D FULL Q:$G(QUIT)  W !,"   LOCAL POSSIBLE DOSAGE: " D
"RTN","PSSLOOK",110,0)
 ..I $L($P(LPDOS,U))'>27 W $P(LPDOS,U),?55,"PACKAGE: ",$P(LPDOS,U,2)
"RTN","PSSLOOK",111,0)
 ..E   W !,?10,$P(LPDOS,U),!,?55,"PACKAGE: ",$P(LPDOS,U,2)
"RTN","PSSLOOK",112,0)
 ..D FULL Q:$G(QUIT)  W !,"     BCMA UNITS PER DOSE: ",$P(LPDOS,U,3) D FULL Q:$G(QUIT)  D LPDNW
"RTN","PSSLOOK",113,0)
 D FULL Q:$G(QUIT)  W ! F XX=1:1:77 W "-"
"RTN","PSSLOOK",114,0)
 D FULL Q:$G(QUIT)  W !,"VA CLASS: ",$G(CLASS)
"RTN","PSSLOOK",115,0)
 D FULL Q:$G(QUIT)  W !,"LOCAL NON-FORMULARY: ",$G(NF),"          ","VISN NON-FORMULARY: ",$G(VNF)
"RTN","PSSLOOK",116,0)
 N DA,K,LIST,PSXDN,PSXGN,PSXVP,X,XX1,XX2
"RTN","PSSLOOK",117,0)
 K PSXGN,PSXVP I $D(^PSDRUG(IFN,"ND")) S PSXDN=$G(^PSDRUG(IFN,"ND")),PSXGN=$P(PSXDN,"^"),PSXVP=$P(PSXDN,"^",3)
"RTN","PSSLOOK",118,0)
 I $G(PSXGN),$G(PSXVP) S X=$$PROD2^PSNAPIS(PSXGN,PSXVP),XX1=$$FORMI^PSNAPIS(PSXGN,PSXVP)
"RTN","PSSLOOK",119,0)
 D FULL Q:$G(QUIT)  W !,"National Formulary Indicator: "_$S($G(XX1)=1:"YES",$G(XX1)=0:"NO",1:"Not Matched to NDF")
"RTN","PSSLOOK",120,0)
 I $D(^PSDRUG(IFN,65,0)) D FULL Q:$G(QUIT)  W !,"FORMULARY ALTERNATIVES: ",! F FA=0:0 S FA=$O(^PSDRUG(IFN,65,FA)) Q:'FA  S LDFPTR=$P($G(^PSDRUG(IFN,65,FA,0)),"^") I LDFPTR D FULL Q:$G(QUIT)  W ?26,$P($G(^PSDRUG(LDFPTR,0)),"^"),!
"RTN","PSSLOOK",121,0)
 D FULL Q:$G(QUIT)  I $G(PSXGN),$G(PSXVP) W !,"National Restriction: " S XX2=$$FORMRX^PSNAPIS(PSXGN,PSXVP,.LIST) I $G(XX2)=1,$D(LIST) F XX2=0:0 S XX2=$O(LIST(XX2)) Q:'XX2  D FULL Q:$G(QUIT)  W !,LIST(XX2,0)
"RTN","PSSLOOK",122,0)
 W !,"Local Drug Text: ",! I $D(^PSDRUG(IFN,9,0)) D LDT
"RTN","PSSLOOK",123,0)
 Q
"RTN","PSSLOOK",124,0)
LDT F TXT1=0:0 S TXT1=$O(^PSDRUG(IFN,9,TXT1)) Q:'TXT1  S TEXPTR=^PSDRUG(IFN,9,TXT1,0) F PPP=0:0 S PPP=$O(^PS(51.7,TEXPTR,2,PPP)) Q:'PPP  S PST=$P($G(^PS(51.7,TEXPTR,0)),"^",2) I 'PST S WPT=^PS(51.7,TEXPTR,2,PPP,0) D FULL Q:$G(QUIT)  W WPT,!
"RTN","PSSLOOK",125,0)
 ;
"RTN","PSSLOOK",126,0)
 ;
"RTN","PSSLOOK",127,0)
KILL K IFN,APP,INT,VADU,VAGN,VAPN,VAPRN,P3,VAGNPTR,MESS,CLASS,DEA,ACT,CL,CLPTR,CMOP,DF,DFPTR,DU,DUPOUGN,IFCAPNM,NDC,NDE,NDNODE,NF,NODE0,NODE2,OI,OINM,OIPTR,OU,PD,PDPTR,PPDU,PPOU,PS,PT,NOD66,SYNM,SZPTR,TYPTR,WARN,WRN,XX,ZZZ,SS,OUPTR,CMOPID
"RTN","PSSLOOK",128,0)
 K DUPOU,QQQ,GN,QDM,APPL,VADF,DFP,DFRM,Y,Z0,Z1,DDD,PPP,TEXT,TXTPTR,TXT,TXT1,TEXPTR,VNF,WPT,FA,LDFPTR,TEXTPTR,QUIT,PST,D0,DA,K,DIR
"RTN","PSSLOOK",129,0)
 K PSSNODE,PSDOSUN,PDS,POSDOS,LPDOS,CSF,PSSSTR,PSSUNIT,PSSCALC
"RTN","PSSLOOK",130,0)
 Q
"RTN","PSSLOOK",131,0)
OITXT I $D(^PS(50.7,OIPTR,1,0)) F TXT=0:0 S TXT=$O(^PS(50.7,OIPTR,1,TXT)) Q:'TXT  S TEXTPTR=^PS(50.7,OIPTR,1,TXT,0) F DDD=0:0 S DDD=$O(^PS(51.7,TEXTPTR,2,DDD)) Q:'DDD  D IDATE I 'Y2K S TEXT=^PS(51.7,TEXTPTR,2,DDD,0) D FULL Q:$G(QUIT)  W TEXT,!
"RTN","PSSLOOK",132,0)
 Q
"RTN","PSSLOOK",133,0)
FULL D:($Y+5)>IOSL&('$G(QUIT)) FSCRN
"RTN","PSSLOOK",134,0)
 Q
"RTN","PSSLOOK",135,0)
FSCRN Q:$G(QUIT)  W ! K DIR S DIR(0)="E",DIR("A")="Press Return to continue,'^' to exit" D ^DIR W @IOF S:Y'=1 QUIT=1
"RTN","PSSLOOK",136,0)
 Q
"RTN","PSSLOOK",137,0)
IDATE S Y2K=$P($G(^PS(51.7,TEXTPTR,0)),"^",2)
"RTN","PSSLOOK",138,0)
 Q
"RTN","PSSLOOK",139,0)
UNCALC ;
"RTN","PSSLOOK",140,0)
 N PSSVA,PSSVA1,PSSVB,PSSVB1,PSSDASH,PSSNDFS,PSSDASH2,PSSDASH3,PSSDASH5 K PSSCALC
"RTN","PSSLOOK",141,0)
 S PSSDASH=0 S PSSNDFS=$$PSJST^PSNAPIS(+$P($G(^PSDRUG(IFN,"ND")),"^"),+$P($G(^PSDRUG(IFN,"ND")),"^",3)) S PSSNDFS=+$P($G(PSSNDFS),"^",2)
"RTN","PSSLOOK",142,0)
 I $G(PSSNDFS),$G(PSSSTR),+$G(PSSSTR)'=+$G(PSSNDFS) S PSSDASH=1
"RTN","PSSLOOK",143,0)
 S PSSVA=$P(PSSUNIT,"/"),PSSVB=$P(PSSUNIT,"/",2),PSSVA1=+$G(PSSVA),PSSVB1=+$G(PSSVB)
"RTN","PSSLOOK",144,0)
 I $G(PSSDASH) S PSSDASH2=PSSSTR/PSSNDFS,PSSDASH3=PSSDASH2*$S($G(PSSVB1):PSSVB1,1:1) S PSSDASH5=$S('$G(PSSVB1):PSSDASH3_$G(PSSVB),1:PSSDASH3_$P(PSSVB,PSSVB1,2))
"RTN","PSSLOOK",145,0)
 S PSSCALC=$S($G(PSSDASH):$S('$G(PSSVA1):PSSVA,1:$P(PSSVA1,PSSVA1,2))_"/"_$G(PSSDASH5),1:PSSUNIT)
"RTN","PSSLOOK",146,0)
 Q
"RTN","PSSLOOK",147,0)
 ;
"RTN","PSSLOOK",148,0)
LPDNW ;Display Dose Unit and Numeric Dose fields, added with patch PSS*1*147
"RTN","PSSLOOK",149,0)
 N PSSLKL1,PSSLKL2,PSSLKL3,PSSLKL4
"RTN","PSSLOOK",150,0)
 S PSSLKL4=""
"RTN","PSSLOOK",151,0)
 S PSSLKL1=$P(LPDOS,"^",5),PSSLKL2=$P(LPDOS,"^",6)
"RTN","PSSLOOK",152,0)
 I PSSLKL1 S PSSLKL4=$P($G(^PS(51.24,+PSSLKL1,0)),"^")
"RTN","PSSLOOK",153,0)
 S PSSLKL3=$S($E(PSSLKL2)=".":"0",1:"")_PSSLKL2
"RTN","PSSLOOK",154,0)
 I $L(PSSLKL3)<18 D FULL Q:$G(QUIT)  W !?5,"NUMERIC DOSE: "_PSSLKL3,?38,"DOSE UNIT: "_PSSLKL4 Q
"RTN","PSSLOOK",155,0)
 D FULL Q:$G(QUIT)  W !?5,"NUMERIC DOSE: "_PSSLKL3
"RTN","PSSLOOK",156,0)
 D FULL Q:$G(QUIT)  W !?38,"DOSE UNIT: "_PSSLKL4
"RTN","PSSLOOK",157,0)
 Q
"RTN","PSSMEDRQ")
0^4^B97598352^B93016200
"RTN","PSSMEDRQ",1,0)
PSSMEDRQ ;BIR/RTR-Request New Standard Medication Route ;10/17/07
"RTN","PSSMEDRQ",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**129,147**;9/30/97;Build 16
"RTN","PSSMEDRQ",3,0)
 ;
"RTN","PSSMEDRQ",4,0)
REQ ;Request Med Route change
"RTN","PSSMEDRQ",5,0)
 D WLINK Q
"RTN","PSSMEDRQ",6,0)
 N DDWAUTO,DDWTAB,DWDISABL,DIWEPSE,DIWETXT,DDWLMAR,DDWRMAR,DDWRW,DDWC,DDWFLAGS,PSSTACCT
"RTN","PSSMEDRQ",7,0)
 N J,%,D0,D1,D2,DG,DIC,DIR,X,Y,DUOUT,DTOUT,DIRUT,DIROUT,DIWESUB,DWLW,DWPK,PSSMQANS,PSSMQOUT,PSSMQIEN,PSSMQNME,PSSMQNDU,PSSMQFDB,PSSMQMED,PSSMQTXT,PSSMQVIS
"RTN","PSSMEDRQ",8,0)
 K PSSMQANS,PSSMQOUT,PSSMQIEN,PSSMQNME,PSSMQNDU,PSSMQFDB,PSSMQMED,PSSMQTXT,PSSMQVIS
"RTN","PSSMEDRQ",9,0)
 S PSSMQOUT=0
"RTN","PSSMEDRQ",10,0)
 K DIR S DIR(0)="SO^N:New Medication Route;C:Change to Existing Medication Route",DIR("A")="Request New Medication Route or Change existing Medication Route",DIR("B")="N"
"RTN","PSSMEDRQ",11,0)
 S DIR("?")=" ",DIR("?",1)="Enter 'N' to request that a new Medication Route be added to the"
"RTN","PSSMEDRQ",12,0)
 S DIR("?",2)="STANDARD MEDICATION ROUTES (#51.23) File, enter 'C' to request a change",DIR("?",3)="to an existing entry in the STANDARD MEDICATION ROUTES (#51.23) File."
"RTN","PSSMEDRQ",13,0)
 D ^DIR K DIR I $D(DUOUT)!($D(DTOUT)) D MESS Q
"RTN","PSSMEDRQ",14,0)
 I Y'="N",Y'="C" D MESS Q
"RTN","PSSMEDRQ",15,0)
 S PSSMQANS=Y
"RTN","PSSMEDRQ",16,0)
 I PSSMQANS="C" W ! K DIC S DIC=51.23,DIC(0)="QEAMZ" D ^DIC K DIC S PSSMQIEN=+Y I Y<0!($D(DUOUT))!($D(DTOUT)) D MESS Q
"RTN","PSSMEDRQ",17,0)
 I PSSMQANS="C" S PSSMQNME=$P($G(^PS(51.23,PSSMQIEN,0)),"^")
"RTN","PSSMEDRQ",18,0)
 I PSSMQANS="N" D NEWMR I PSSMQOUT D MESS Q
"RTN","PSSMEDRQ",19,0)
 W ! K DIR,PSSMQMED S DIR(0)="FO^1:78",DIR("A",1)="Give an example of a medication administered by this route (optional).",DIR("A")="Medication (Free Text)",DIR("?")=" ",DIR("?",1)="Give an example of a medication that would be administered"
"RTN","PSSMEDRQ",20,0)
 S DIR("?",2)=$S(PSSMQANS="N":"by the new Medication Route you are requesting, 1 to 78 characters.",1:"by the Medication Route you are requesting a change to, 1 to 78 characters.")
"RTN","PSSMEDRQ",21,0)
 D ^DIR K DIR I $D(DUOUT)!($D(DTOUT)) S PSSMQOUT=1 D MESS Q
"RTN","PSSMEDRQ",22,0)
 S PSSMQMED=Y
"RTN","PSSMEDRQ",23,0)
 I $G(PSSMQMED)'="" S PSSMQMED=$$UP^XLFSTR(PSSMQMED)
"RTN","PSSMEDRQ",24,0)
 W !!,"You'll now be prompted for a reason or references for this request (optional).",!
"RTN","PSSMEDRQ",25,0)
 K DIR S DIR(0)="E",DIR("A")="Press Return to continue, '^' to exit" D ^DIR K DIR I 'Y D MESS Q
"RTN","PSSMEDRQ",26,0)
 W ! K ^TMP($J,"PSSMQTXT") K DIC S DIWESUB="References/Reason for Request",DWLW=78,DWPK=1,DIC="^TMP($J,""PSSMQTXT""," D EN^DIWE
"RTN","PSSMEDRQ",27,0)
 W ! D TEST K DIR S DIR(0)="Y",DIR("A")="Transmit Medication Route Request",DIR("B")="Y"
"RTN","PSSMEDRQ",28,0)
 S DIR("?")=" ",DIR("?",1)="Enter 'Y' to transmit this request for review. (For production accounts only)"
"RTN","PSSMEDRQ",29,0)
 S DIR("?",2)="If you enter 'N', the message will be sent to you only, in Vista mail.",DIR("?",3)="Enter '^' to exit, and not send the message."
"RTN","PSSMEDRQ",30,0)
 D ^DIR K DIR
"RTN","PSSMEDRQ",31,0)
 I $D(DUOUT)!($D(DTOUT)) D KLM D MESS Q
"RTN","PSSMEDRQ",32,0)
 S PSSMQVIS=0
"RTN","PSSMEDRQ",33,0)
 I Y'=1 S PSSMQVIS=1 D SENDRT W !!,"Mail message only sent to you in Vista Mail.",! K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR Q
"RTN","PSSMEDRQ",34,0)
 D SENDRT W !!,"Mail message transmitted for review.",! K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSSMEDRQ",35,0)
 Q
"RTN","PSSMEDRQ",36,0)
 ;
"RTN","PSSMEDRQ",37,0)
SENDRT ;Send Med Route Mail Message
"RTN","PSSMEDRQ",38,0)
 N XMTEXT,XMY,XMSUB,XMDUZ,XMMG,XMSTRIP,XMROU,DIFROM,XMYBLOB,XMZ,XMDUN,PSSMQLP,PSSMQCNT
"RTN","PSSMEDRQ",39,0)
 K ^TMP($J,"PSSMQSND")
"RTN","PSSMEDRQ",40,0)
 S ^TMP($J,"PSSMQSND",1,0)=$S(PSSMQANS="N":"Request New Medication Route:",PSSMQANS="C":"Request Medication Route Change For:",1:"Medication Route Request:")
"RTN","PSSMEDRQ",41,0)
 S ^TMP($J,"PSSMQSND",2,0)=$S(PSSMQANS="N":$G(PSSMQNDU),PSSMQANS="C":$G(PSSMQNME),1:"Unknown")
"RTN","PSSMEDRQ",42,0)
 S ^TMP($J,"PSSMQSND",3,0)=" "
"RTN","PSSMEDRQ",43,0)
 S ^TMP($J,"PSSMQSND",4,0)="Medication:"
"RTN","PSSMEDRQ",44,0)
 S ^TMP($J,"PSSMQSND",5,0)=$S($G(PSSMQMED)'="":$G(PSSMQMED),1:"<None Entered>")
"RTN","PSSMEDRQ",45,0)
 S PSSMQCNT=7 S ^TMP($J,"PSSMQSND",6,0)=" "
"RTN","PSSMEDRQ",46,0)
 F PSSMQLP=0:0 S PSSMQLP=$O(^TMP($J,"PSSMQTXT",PSSMQLP)) Q:'PSSMQLP  S ^TMP($J,"PSSMQSND",PSSMQCNT,0)=$G(^TMP($J,"PSSMQTXT",PSSMQLP,0)) S PSSMQCNT=PSSMQCNT+1
"RTN","PSSMEDRQ",47,0)
 K ^TMP($J,"PSSMQTXT")
"RTN","PSSMEDRQ",48,0)
 S XMSUB="Medication Route Request"
"RTN","PSSMEDRQ",49,0)
 S XMDUZ=DUZ
"RTN","PSSMEDRQ",50,0)
 S XMTEXT="^TMP($J,""PSSMQSND"","
"RTN","PSSMEDRQ",51,0)
 S XMY(DUZ)=""
"RTN","PSSMEDRQ",52,0)
 I 'PSSMQVIS,PSSTACCT S XMY("VAOITVHITHDSSTSPEPSNTRT@va.gov")=""
"RTN","PSSMEDRQ",53,0)
 D ^XMD
"RTN","PSSMEDRQ",54,0)
 K ^TMP($J,"PSSMQSND")
"RTN","PSSMEDRQ",55,0)
 Q
"RTN","PSSMEDRQ",56,0)
 ;
"RTN","PSSMEDRQ",57,0)
KLM ;Kill Med Route TMP global
"RTN","PSSMEDRQ",58,0)
 K ^TMP($J,"PSSMQTXT")
"RTN","PSSMEDRQ",59,0)
 Q
"RTN","PSSMEDRQ",60,0)
 ;
"RTN","PSSMEDRQ",61,0)
NEWMR ;New Med Route
"RTN","PSSMEDRQ",62,0)
 W ! K DIR,PSSMQNDU S DIR(0)="FO^3:50",DIR("A")="Enter Medication Route name",DIR("?")=" ",DIR("?",1)="Enter the name of the Medication Route you are requesting to be added"
"RTN","PSSMEDRQ",63,0)
 S DIR("?",2)="to the STANDARD MEDICATION ROUTES (#51.23) File, 3 to 50 characters."
"RTN","PSSMEDRQ",64,0)
 D ^DIR K DIR I $D(DIRUT)!($D(DUOUT))!($D(DTOUT)) S PSSMQOUT=1 Q
"RTN","PSSMEDRQ",65,0)
 S PSSMQNDU=Y
"RTN","PSSMEDRQ",66,0)
 S PSSMQNDU=$$UP^XLFSTR(PSSMQNDU)
"RTN","PSSMEDRQ",67,0)
 I $L(PSSMQNDU)>50!($L(PSSMQNDU)<3)!($E(PSSMQNDU,1)=" ")!($E(PSSMQNDU,$L(PSSMQNDU))=" ")!(PSSMQNDU["  ")!(PSSMQNDU'?.UNP)!'(PSSMQNDU'?1P.E) D  G NEWMR
"RTN","PSSMEDRQ",68,0)
 .W !!!,"The Medication Route must be 3-50 characters in length, comprised only of"
"RTN","PSSMEDRQ",69,0)
 .W !,"uppercase letters, numeric's, and punctuation, but no leading punctuation,"
"RTN","PSSMEDRQ",70,0)
 .W !,"and contain no leading, trailing, or consecutive spaces.",!
"RTN","PSSMEDRQ",71,0)
 I $O(^PS(51.23,"B",PSSMQNDU,0)) D  S PSSMQOUT=1 Q
"RTN","PSSMEDRQ",72,0)
 .W !!,PSSMQNDU_" is already an entry in the",!,"STANDARD MEDICATION ROUTES (#51.23) File. To request a change to this entry"
"RTN","PSSMEDRQ",73,0)
 .W !,"re-enter this option and select 'Change to Existing Medication Route'."
"RTN","PSSMEDRQ",74,0)
 S PSSMQFDB=$O(^PS(51.23,"C",PSSMQNDU,0)) I PSSMQFDB D  S PSSMQOUT=1 Q
"RTN","PSSMEDRQ",75,0)
 .W !!,PSSMQNDU_" is already a First DataBank Med Route",!,"in the STANDARD MEDICATION ROUTES (#51.23) File for",!
"RTN","PSSMEDRQ",76,0)
 .W $P($G(^PS(51.23,+$G(PSSMQFDB),0)),"^")_". To request a change to this",!,"entry, re-enter this option and select 'Change to Existing Medication Route'."
"RTN","PSSMEDRQ",77,0)
 Q
"RTN","PSSMEDRQ",78,0)
 ;
"RTN","PSSMEDRQ",79,0)
 ;
"RTN","PSSMEDRQ",80,0)
DOSE ;Request Dose Unit change
"RTN","PSSMEDRQ",81,0)
 N DDWAUTO,DDWTAB,DWDISABL,DIWEPSE,DIWETXT,DDWLMAR,DDWRMAR,DDWRW,DDWC,DDWFLAGS,PSSTACCT
"RTN","PSSMEDRQ",82,0)
 N J,%,D0,D1,D2,DG,DIC,DIR,X,Y,DUOUT,DTOUT,DIRUT,DIROUT,PSSRQANS,PSSRQIEN,PSSRQOUT,PSSRQNDU,PSSRQSYN,PSSRQFDB,PSSRQVIS,PSSRQNME,DIWESUB,DWLW,DWPK
"RTN","PSSMEDRQ",83,0)
 K PSSRQANS,PSSRQIEN,PSSRQOUT,PSSRQNDU,PSSRQSYN,PSSRQFDB,PSSRQVIS,PSSRQNME
"RTN","PSSMEDRQ",84,0)
 S PSSRQOUT=0
"RTN","PSSMEDRQ",85,0)
 K DIR S DIR(0)="SO^N:New Dose Unit;C:Change to Existing Dose Unit",DIR("A")="Request New Dose Unit or Change existing Dose Unit",DIR("B")="N"
"RTN","PSSMEDRQ",86,0)
 S DIR("?")=" ",DIR("?",1)="Enter 'N' to request that a new Dose Unit be added to the DOSE UNITS"
"RTN","PSSMEDRQ",87,0)
 S DIR("?",2)="(#51.24) File, enter 'C' to request a change to an existing entry",DIR("?",3)="in the DOSE UNITS (#51.24) File."
"RTN","PSSMEDRQ",88,0)
 D ^DIR K DIR I $D(DUOUT)!($D(DTOUT)) D MESS Q
"RTN","PSSMEDRQ",89,0)
 I Y'="N",Y'="C" D MESS Q
"RTN","PSSMEDRQ",90,0)
 S PSSRQANS=Y
"RTN","PSSMEDRQ",91,0)
 I PSSRQANS="C" W ! K DIC S DIC=51.24,DIC(0)="QEAMZ" D ^DIC K DIC S PSSRQIEN=+Y I Y<0!($D(DUOUT))!($D(DTOUT)) D MESS Q
"RTN","PSSMEDRQ",92,0)
 I PSSRQANS="C" S PSSRQNME=$P($G(^PS(51.24,PSSRQIEN,0)),"^")
"RTN","PSSMEDRQ",93,0)
 I PSSRQANS="N" D NEW I PSSRQOUT D MESS Q
"RTN","PSSMEDRQ",94,0)
 W !!,"You must now enter a reason or references for this request.",!
"RTN","PSSMEDRQ",95,0)
 K DIR S DIR(0)="E",DIR("A")="Press Return to continue, '^' to exit" D ^DIR K DIR I 'Y D MESS Q
"RTN","PSSMEDRQ",96,0)
 W ! K ^TMP($J,"PSSRQTXT") K DIC S DIWESUB="References/Reason for Request",DWLW=78,DWPK=1,DIC="^TMP($J,""PSSRQTXT""," D EN^DIWE
"RTN","PSSMEDRQ",97,0)
 I '$D(^TMP($J,"PSSRQTXT")) W !!,"No data was entered." D KL D MESS Q
"RTN","PSSMEDRQ",98,0)
 W ! D TEST K DIR S DIR(0)="Y",DIR("A")="Transmit Dose Unit Request",DIR("B")="Y"
"RTN","PSSMEDRQ",99,0)
 S DIR("?")=" ",DIR("?",1)="Enter 'Y' to transmit this request for review. (For production accounts only)"
"RTN","PSSMEDRQ",100,0)
 S DIR("?",2)="If you enter 'N', the message will sent to you only, in Vista mail.",DIR("?",3)="Enter '^' to exit, and not send the message."
"RTN","PSSMEDRQ",101,0)
 D ^DIR K DIR
"RTN","PSSMEDRQ",102,0)
 I $D(DUOUT)!($D(DTOUT)) D KL D MESS Q
"RTN","PSSMEDRQ",103,0)
 S PSSRQVIS=0
"RTN","PSSMEDRQ",104,0)
 I Y'=1 S PSSRQVIS=1 D SEND W !!,"Mail message only sent to you in Vista Mail.",! K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR Q
"RTN","PSSMEDRQ",105,0)
 D SEND W !!,"Mail message transmitted for review.",! K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSSMEDRQ",106,0)
 Q
"RTN","PSSMEDRQ",107,0)
 ;
"RTN","PSSMEDRQ",108,0)
KL ;Kill Dose Unit TMP global
"RTN","PSSMEDRQ",109,0)
 K ^TMP($J,"PSSRQTXT")
"RTN","PSSMEDRQ",110,0)
 Q
"RTN","PSSMEDRQ",111,0)
 ;
"RTN","PSSMEDRQ",112,0)
MESS ;Exit Message
"RTN","PSSMEDRQ",113,0)
 W !!,"No Action Taken.",!
"RTN","PSSMEDRQ",114,0)
 K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSSMEDRQ",115,0)
 Q
"RTN","PSSMEDRQ",116,0)
 ;
"RTN","PSSMEDRQ",117,0)
NEW ;New Dose Unit
"RTN","PSSMEDRQ",118,0)
 W ! K DIR,PSSRQNDU S DIR(0)="FO^1:30",DIR("A")="Enter Dose Unit name",DIR("?")=" ",DIR("?",1)="Enter the name of the Dose Unit you are requesting"
"RTN","PSSMEDRQ",119,0)
 S DIR("?",2)="to be added to the DOSE UNITS (#51.24) File, 1 to 30 characters."
"RTN","PSSMEDRQ",120,0)
 D ^DIR K DIR I $D(DIRUT)!($D(DUOUT))!($D(DTOUT)) S PSSRQOUT=1 Q
"RTN","PSSMEDRQ",121,0)
 S PSSRQNDU=Y
"RTN","PSSMEDRQ",122,0)
 S PSSRQNDU=$$UP^XLFSTR(PSSRQNDU)
"RTN","PSSMEDRQ",123,0)
 I $L(PSSRQNDU)>30!($L(PSSRQNDU)<1)!($E(PSSRQNDU,1)=" ")!($E(PSSRQNDU,$L(PSSRQNDU))=" ")!(PSSRQNDU["  ")!(PSSRQNDU'?.ANP)!'(PSSRQNDU'?1P.E) D  G NEW
"RTN","PSSMEDRQ",124,0)
 .W !!!,"The Dose Unit must be 1-30 characters in length, comprised of upper and lower-"
"RTN","PSSMEDRQ",125,0)
 .W !,"case letters, numeric's, and punctuation, but no leading punctuation, and"
"RTN","PSSMEDRQ",126,0)
 .W !,"contain no leading, trailing, or consecutive spaces.",!
"RTN","PSSMEDRQ",127,0)
 I $O(^PS(51.24,"B",PSSRQNDU,0)) D  S PSSRQOUT=1 Q
"RTN","PSSMEDRQ",128,0)
 .W !!,PSSRQNDU_" is already an entry in the DOSE UNITS (#51.24)"
"RTN","PSSMEDRQ",129,0)
 .W !,"File. To request a change to this entry, re-enter this option and",!,"select 'Change to Existing Dose Unit'."
"RTN","PSSMEDRQ",130,0)
 S PSSRQSYN=$O(^PS(51.24,"D",PSSRQNDU,0)) I PSSRQSYN D  S PSSRQOUT=1 Q
"RTN","PSSMEDRQ",131,0)
 .W !!,PSSRQNDU_" is already a synonym in the DOSE UNITS (#51.24)"
"RTN","PSSMEDRQ",132,0)
 .W !,"File for "_$P($G(^PS(51.24,+$G(PSSRQSYN),0)),"^")_". To request a change to this entry,"
"RTN","PSSMEDRQ",133,0)
 .W !,"re-enter this option and select 'Change to Existing Dose Unit'."
"RTN","PSSMEDRQ",134,0)
 S PSSRQFDB=$O(^PS(51.24,"C",PSSRQNDU,0)) I PSSRQFDB D  S PSSRQOUT=1 Q
"RTN","PSSMEDRQ",135,0)
 .W !!,PSSRQNDU_" is already a First DataBank Dose Unit",!,"in the DOSE UNITS (#51.24) File for "_$P($G(^PS(51.24,+$G(PSSRQFDB),0)),"^")_"."
"RTN","PSSMEDRQ",136,0)
 .W !,"To request a change to this entry, re-enter this option and select",!,"'Change to Existing Dose Unit'."
"RTN","PSSMEDRQ",137,0)
 Q
"RTN","PSSMEDRQ",138,0)
 ;
"RTN","PSSMEDRQ",139,0)
SEND ;Send Dose Unit Mail Message
"RTN","PSSMEDRQ",140,0)
 N XMTEXT,XMY,XMSUB,XMDUZ,XMMG,XMSTRIP,XMROU,XMDUN,DIFROM,XMYBLOB,XMZ,PSSRQLP,PSSRQCNT
"RTN","PSSMEDRQ",141,0)
 K ^TMP($J,"PSSRQSND")
"RTN","PSSMEDRQ",142,0)
 S ^TMP($J,"PSSRQSND",1,0)=$S(PSSRQANS="N":"Request New Dose Unit:",PSSRQANS="C":"Request Dose Unit Change For:",1:"Dose unit Request:")
"RTN","PSSMEDRQ",143,0)
 S ^TMP($J,"PSSRQSND",2,0)=$S(PSSRQANS="N":$G(PSSRQNDU),PSSRQANS="C":$G(PSSRQNME),1:"Unknown")
"RTN","PSSMEDRQ",144,0)
 S ^TMP($J,"PSSRQSND",3,0)=" "
"RTN","PSSMEDRQ",145,0)
 S PSSRQCNT=4
"RTN","PSSMEDRQ",146,0)
 F PSSRQLP=0:0 S PSSRQLP=$O(^TMP($J,"PSSRQTXT",PSSRQLP)) Q:'PSSRQLP  S ^TMP($J,"PSSRQSND",PSSRQCNT,0)=$G(^TMP($J,"PSSRQTXT",PSSRQLP,0)) S PSSRQCNT=PSSRQCNT+1
"RTN","PSSMEDRQ",147,0)
 K ^TMP($J,"PSSRQTXT")
"RTN","PSSMEDRQ",148,0)
 S XMSUB="Dose Unit Request"
"RTN","PSSMEDRQ",149,0)
 S XMDUZ=DUZ
"RTN","PSSMEDRQ",150,0)
 S XMTEXT="^TMP($J,""PSSRQSND"","
"RTN","PSSMEDRQ",151,0)
 S XMY(DUZ)=""
"RTN","PSSMEDRQ",152,0)
 I 'PSSRQVIS,PSSTACCT S XMY("VAOITVHITPSDOSEUNITREQ@va.gov")=""
"RTN","PSSMEDRQ",153,0)
 D ^XMD
"RTN","PSSMEDRQ",154,0)
 K ^TMP($J,"PSSRQSND")
"RTN","PSSMEDRQ",155,0)
 Q
"RTN","PSSMEDRQ",156,0)
 ;
"RTN","PSSMEDRQ",157,0)
TEST ;
"RTN","PSSMEDRQ",158,0)
 S PSSTACCT=1
"RTN","PSSMEDRQ",159,0)
 I '$$PROD^XUPROD S PSSTACCT=0 W !!,"NOTE: This is a test account. Regardless of your response to the 'Transmit'",!,"prompt, this request will NOT be sent forward for national review.",!
"RTN","PSSMEDRQ",160,0)
 Q
"RTN","PSSMEDRQ",161,0)
 ;
"RTN","PSSMEDRQ",162,0)
 ;
"RTN","PSSMEDRQ",163,0)
WLINK ;Refer to website with patch PSS*1*147
"RTN","PSSMEDRQ",164,0)
 N DIR,DTOUT,DUOUT,DIRUT,DIROUT,X,Y
"RTN","PSSMEDRQ",165,0)
 W !!!,"Standard Medication Route requests must now be made at the following website:",!
"RTN","PSSMEDRQ",166,0)
 W !?3,"http://vista.med.va.gov/ntrt/",!
"RTN","PSSMEDRQ",167,0)
 K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSSMEDRQ",168,0)
 Q
"RTN","PSSMRTUP")
0^5^B160988994^n/a
"RTN","PSSMRTUP",1,0)
PSSMRTUP ;BIR/RTR-Process Standard Medication Route File Updates ;03/02/09
"RTN","PSSMRTUP",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**147**;9/30/97;Build 16
"RTN","PSSMRTUP",3,0)
 ;
"RTN","PSSMRTUP",4,0)
 ;Reference to TMP("XUMF EVENT" supported by DBIA 5470
"RTN","PSSMRTUP",5,0)
EN ;
"RTN","PSSMRTUP",6,0)
 I '$D(^TMP("XUMF EVENT",$J,51.23)) Q
"RTN","PSSMRTUP",7,0)
 ;We are assuming the name of the .01 field will not change
"RTN","PSSMRTUP",8,0)
 K ^TMP($J,"PSSMRPTX") K ^TMP($J,"PSSMRPCC") K ^TMP($J,"PSSMRUN")
"RTN","PSSMRTUP",9,0)
 N PSSMRPCT
"RTN","PSSMRTUP",10,0)
 S PSSMRPCT=1
"RTN","PSSMRTUP",11,0)
 D NWRT
"RTN","PSSMRTUP",12,0)
 D STCH
"RTN","PSSMRTUP",13,0)
 D INACZ^PSSMRTUX
"RTN","PSSMRTUP",14,0)
 D LOCALS
"RTN","PSSMRTUP",15,0)
 D MAIL K ^TMP($J,"PSSMRPCC") K ^TMP($J,"PSSMRUN") K ^TMP($J,"PSSMRPTX")
"RTN","PSSMRTUP",16,0)
 Q
"RTN","PSSMRTUP",17,0)
 ;
"RTN","PSSMRTUP",18,0)
 ;
"RTN","PSSMRTUP",19,0)
MAIL ;
"RTN","PSSMRTUP",20,0)
 N XMTEXT,XMY,XMSUB,XMDUZ,XMMG,XMSTRIP,XMROU,XMYBLOB,XMZ,XMDUN
"RTN","PSSMRTUP",21,0)
 I '$D(^TMP($J,"PSSMRPTX")) Q
"RTN","PSSMRTUP",22,0)
 S XMSUB="Standard Medication Route File Update"
"RTN","PSSMRTUP",23,0)
 S XMDUZ="Standard Medication Route File Processor"
"RTN","PSSMRTUP",24,0)
 S XMTEXT="^TMP($J,""PSSMRPTX"","
"RTN","PSSMRTUP",25,0)
 S XMY("G.PSS ORDER CHECKS")=""
"RTN","PSSMRTUP",26,0)
 N DIFROM D ^XMD
"RTN","PSSMRTUP",27,0)
 ;K ^TMP($J,"PSSMRPTX")
"RTN","PSSMRTUP",28,0)
 Q
"RTN","PSSMRTUP",29,0)
 ;
"RTN","PSSMRTUP",30,0)
 ;
"RTN","PSSMRTUP",31,0)
STAT(PSSMRPEN) ;Return status of entry, assuming .01 and File 51.23
"RTN","PSSMRTUP",32,0)
 I $P($$GETSTAT^XTID(51.23,.01,PSSMRPEN_","),"^")=1 Q 1
"RTN","PSSMRTUP",33,0)
 Q 0
"RTN","PSSMRTUP",34,0)
 ;
"RTN","PSSMRTUP",35,0)
 ;
"RTN","PSSMRTUP",36,0)
NWRT ;New Medication Routes
"RTN","PSSMRTUP",37,0)
 N PSSMRPL,PSSMRPLN,PSSMRPL1,PSSMRPST S PSSMRPL1=0
"RTN","PSSMRTUP",38,0)
 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="The following entries have been added to the Standard Medication Routes",PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",39,0)
 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="(#51.23) File:",PSSMRPCT=PSSMRPCT+1 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)=" ",PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",40,0)
 F PSSMRPL=0:0 S PSSMRPL=$O(^TMP("XUMF EVENT",$J,51.23,"NEW",PSSMRPL)) Q:'PSSMRPL  D
"RTN","PSSMRTUP",41,0)
 .S PSSMRPLN=$G(^PS(51.23,PSSMRPL,0)) I PSSMRPLN="" Q
"RTN","PSSMRTUP",42,0)
 .S PSSMRPL1=1,PSSMRPST=$$STAT(PSSMRPL)
"RTN","PSSMRTUP",43,0)
 .S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="   "_$P(PSSMRPLN,"^")_$S('PSSMRPST:"   (Inactive)",1:"") S PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",44,0)
 .S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="     FDB Route: "_$S($P(PSSMRPLN,"^",2)'="":$P(PSSMRPLN,"^",2),1:"(None)") S PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",45,0)
 I 'PSSMRPL1 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="   (None)" S PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",46,0)
 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)=" " S PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",47,0)
 Q
"RTN","PSSMRTUP",48,0)
 ;
"RTN","PSSMRTUP",49,0)
 ;
"RTN","PSSMRTUP",50,0)
STCH ;Status changes
"RTN","PSSMRTUP",51,0)
 ;Sets PSSMRPCC TMP global, which holds inactivated and reactivated entries
"RTN","PSSMRTUP",52,0)
 ;If 0.1 changes, which it should not, we are just showing the 'after' value
"RTN","PSSMRTUP",53,0)
 N PSSMRPBB,PSSMRPDD,PSSMRPEE,PSSMRPFF,PSSMRPGG,PSSMRPXX,PSSMRPZZ,PSSMRPLL,PSSMRPZA,PSSMRPZB
"RTN","PSSMRTUP",54,0)
 S PSSMRPFF=0
"RTN","PSSMRTUP",55,0)
 F PSSMRPLL=0:0 S PSSMRPLL=$O(^TMP("XUMF EVENT",$J,51.23,"STATUS",PSSMRPLL)) Q:'PSSMRPLL  D
"RTN","PSSMRTUP",56,0)
 .S PSSMRPBB=$G(^TMP("XUMF EVENT",$J,51.23,"STATUS",PSSMRPLL))
"RTN","PSSMRTUP",57,0)
 .I PSSMRPBB="" Q
"RTN","PSSMRTUP",58,0)
 .I $P(PSSMRPBB,"^",3)'=0,$P(PSSMRPBB,"^",3)'=1 Q
"RTN","PSSMRTUP",59,0)
 .S PSSMRPZA=$$RPLCMNT^XTIDTRM(51.23,PSSMRPLL) S PSSMRPZB=$P(PSSMRPZA,";") S ^TMP($J,"PSSMRPCC",$S($P(PSSMRPBB,"^",3)=0:"INACT",1:"REACT"),PSSMRPLL)=$S('PSSMRPZB:0,PSSMRPZB=PSSMRPLL:0,1:PSSMRPZB)
"RTN","PSSMRTUP",60,0)
 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="The following entries have been inactivated in the Standard Medication",PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",61,0)
 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="Routes (#51.23) File:",PSSMRPCT=PSSMRPCT+1 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)=" ",PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",62,0)
 K PSSMRPLL
"RTN","PSSMRTUP",63,0)
 F PSSMRPLL=0:0 S PSSMRPLL=$O(^TMP($J,"PSSMRPCC","INACT",PSSMRPLL)) Q:'PSSMRPLL  D
"RTN","PSSMRTUP",64,0)
 .S PSSMRPXX=+PSSMRPLL_"," I '$$SCREEN^XTID(51.23,.01,PSSMRPXX) K ^TMP($J,"PSSMRPCC","INACT",PSSMRPLL) Q
"RTN","PSSMRTUP",65,0)
 .S PSSMRPFF=1 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="   "_$P($G(^PS(51.23,+PSSMRPLL,0)),"^") S PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",66,0)
 .S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="     FDB Route: "_$S($P($G(^PS(51.23,+PSSMRPLL,0)),"^",2)'="":$P($G(^PS(51.23,+PSSMRPLL,0)),"^",2),1:"(None)") S PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",67,0)
 .S PSSMRPDD=$G(^TMP($J,"PSSMRPCC","INACT",PSSMRPLL))
"RTN","PSSMRTUP",68,0)
 .S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="     Replacement Term: "_$S(+$G(PSSMRPDD):$P($G(^PS(51.23,+PSSMRPDD,0)),"^"),1:"(None)") S PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",69,0)
 .S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="     Replacement Term FDB Route: "_$S('$G(PSSMRPDD):"(None)",$P($G(^PS(51.23,+PSSMRPDD,0)),"^",2)'="":$P($G(^PS(51.23,+PSSMRPDD,0)),"^",2),1:"(None)") S PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",70,0)
 I 'PSSMRPFF S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="   (None)",PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",71,0)
 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)=" " S PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",72,0)
 S PSSMRPGG=0
"RTN","PSSMRTUP",73,0)
 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="The following entries have been reactivated in the Standard Medication",PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",74,0)
 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="Routes (#51.23) File:",PSSMRPCT=PSSMRPCT+1 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)=" ",PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",75,0)
 F PSSMRPEE=0:0 S PSSMRPEE=$O(^TMP($J,"PSSMRPCC","REACT",PSSMRPEE)) Q:'PSSMRPEE  D
"RTN","PSSMRTUP",76,0)
 .S PSSMRPZZ=+PSSMRPEE_"," I $$SCREEN^XTID(51.23,.01,PSSMRPZZ) K ^TMP($J,"PSSMRPCC","REACT",PSSMRPEE) Q
"RTN","PSSMRTUP",77,0)
 .S PSSMRPGG=1 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="   "_$P($G(^PS(51.23,+PSSMRPEE,0)),"^") S PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",78,0)
 .S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="     FDB Route: "_$S($P($G(^PS(51.23,+PSSMRPEE,0)),"^",2)'="":$P($G(^PS(51.23,+PSSMRPEE,0)),"^",2),1:"(None)") S PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",79,0)
 I 'PSSMRPGG S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="   (None)",PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",80,0)
 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)=" " S PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",81,0)
 Q
"RTN","PSSMRTUP",82,0)
 ;
"RTN","PSSMRTUP",83,0)
 ;
"RTN","PSSMRTUP",84,0)
LOCALS ;
"RTN","PSSMRTUP",85,0)
 ;Loop through 51.2, call INCT to see if entry is in INACT Global, if so, then unmap local entry, then Remap if there is a replacement entry
"RTN","PSSMRTUP",86,0)
 ;Then if local entry is still unmapped, execute standard Med Route mapping logic
"RTN","PSSMRTUP",87,0)
 ;INCT and SET will set the PSSMRUN TMP global as follows, where piece 1 one = 1 for Mapped/Remapped, or = 0 for unmapped
"RTN","PSSMRTUP",88,0)
 ;TMP($J,"PSSMRUN",Lock variable,51.2 IEN)=0 or 1^Old Mapped Name^New Mapped Name
"RTN","PSSMRTUP",89,0)
 D REMAP
"RTN","PSSMRTUP",90,0)
 Q
"RTN","PSSMRTUP",91,0)
 ;
"RTN","PSSMRTUP",92,0)
 ;
"RTN","PSSMRTUP",93,0)
REMAP ;Attempt to remap any unmapped local medication routes
"RTN","PSSMRTUP",94,0)
 N PSSRTIEN,PSSRTNAM,PSSRTSTS,PSSRTIX,PSSRTLOC,PSSRTLOP,PSSRTLOX,PSSRTSHL
"RTN","PSSMRTUP",95,0)
 S PSSRTIX="" F  S PSSRTIX=$O(^PS(51.2,"B",PSSRTIX)) Q:PSSRTIX=""  D
"RTN","PSSMRTUP",96,0)
 .F PSSRTIEN=0:0 S PSSRTIEN=$O(^PS(51.2,"B",PSSRTIX,PSSRTIEN)) Q:'PSSRTIEN  D
"RTN","PSSMRTUP",97,0)
 ..I '$D(^PS(51.2,PSSRTIEN,0)) Q
"RTN","PSSMRTUP",98,0)
 ..;I '$P($G(^PS(51.2,PSSRTIEN,0)),"^",4) Q
"RTN","PSSMRTUP",99,0)
 ..S PSSRTLOC=0 L +^PS(51.2,PSSRTIEN):$S($G(DILOCKTM)>0:DILOCKTM,1:3) I '$T S PSSRTLOC=1
"RTN","PSSMRTUP",100,0)
 ..;Continue if record is locked, just do not set any data
"RTN","PSSMRTUP",101,0)
 ..D INCT I $P($G(^PS(51.2,PSSRTIEN,1)),"^"),'$D(^TMP($J,"PSSMRPCC","INACT",+$P($G(^PS(51.2,PSSRTIEN,1)),"^"))) D UN Q
"RTN","PSSMRTUP",102,0)
 ..K PSSRTNAM,PSSRTSTS I '$P($G(^PS(51.2,PSSRTIEN,0)),"^",4) D UN Q
"RTN","PSSMRTUP",103,0)
 ..S PSSRTNAM=$P($G(^PS(51.2,PSSRTIEN,0)),"^") S PSSRTNAM=$$UP^XLFSTR(PSSRTNAM)
"RTN","PSSMRTUP",104,0)
 ..S PSSRTSTS=$O(^PS(51.23,"B",PSSRTNAM,0)) I PSSRTSTS,'$$SCREEN^XTID(51.23,.01,PSSRTSTS_",") D SET D UN Q
"RTN","PSSMRTUP",105,0)
 ..K PSSRTSTS,PSSRTSHL S PSSRTLOX=0 F PSSRTLOP=0:0 S PSSRTLOP=$O(^PS(51.23,"C",PSSRTNAM,PSSRTLOP)) Q:'PSSRTLOP  S PSSRTSTS=PSSRTLOP I PSSRTSTS,'$$SCREEN^XTID(51.23,.01,PSSRTSTS_",") S PSSRTLOX=PSSRTLOX+1 S PSSRTSHL=PSSRTSTS
"RTN","PSSMRTUP",106,0)
 ..I PSSRTLOX=1 S PSSRTSTS=PSSRTSHL D SET D UN Q
"RTN","PSSMRTUP",107,0)
 ..K PSSRTSTS I PSSRTNAM[" EAR" S PSSRTSTS=$O(^PS(51.23,"B","OTIC",0)) I PSSRTSTS,'$$SCREEN^XTID(51.23,.01,PSSRTSTS_",") D SET D UN Q
"RTN","PSSMRTUP",108,0)
 ..K PSSRTSTS I PSSRTNAM[" EYE" S PSSRTSTS=$O(^PS(51.23,"B","OPHTHALMIC",0)) I PSSRTSTS,'$$SCREEN^XTID(51.23,.01,PSSRTSTS_",") D SET D UN Q
"RTN","PSSMRTUP",109,0)
 ..K PSSRTSTS I PSSRTNAM="G TUBE"!(PSSRTNAM="G-TUBE")!(PSSRTNAM="J TUBE")!(PSSRTNAM="J-TUBE")!(PSSRTNAM="NG TUBE")!(PSSRTNAM="NG-TUBE") D  I PSSRTSTS,'$$SCREEN^XTID(51.23,.01,PSSRTSTS_",") D SET D UN Q
"RTN","PSSMRTUP",110,0)
 ...S PSSRTSTS=$O(^PS(51.23,"B","ENTERAL",0))
"RTN","PSSMRTUP",111,0)
 ..K PSSRTSTS I PSSRTNAM="BY MOUTH" S PSSRTSTS=$O(^PS(51.23,"B","ORAL",0)) I PSSRTSTS,'$$SCREEN^XTID(51.23,.01,PSSRTSTS_",") D SET D UN Q
"RTN","PSSMRTUP",112,0)
 ..K PSSRTSTS I PSSRTNAM["NOSE"!(PSSRTNAM["NASAL")!(PSSRTNAM["NOSTRIL") S PSSRTSTS=$O(^PS(51.23,"B","NASAL",0)) I PSSRTSTS,'$$SCREEN^XTID(51.23,.01,PSSRTSTS_",") D SET D UN Q
"RTN","PSSMRTUP",113,0)
 ..K PSSRTSTS I PSSRTNAM="IVPB"!(PSSRTNAM="IV PUSH")!(PSSRTNAM="IV PIGGYBACK") S PSSRTSTS=$O(^PS(51.23,"B","INTRAVENOUS",0)) I PSSRTSTS,'$$SCREEN^XTID(51.23,.01,PSSRTSTS_",") D SET D UN Q
"RTN","PSSMRTUP",114,0)
 ..D UN
"RTN","PSSMRTUP",115,0)
 D FINAL
"RTN","PSSMRTUP",116,0)
 Q
"RTN","PSSMRTUP",117,0)
 ;
"RTN","PSSMRTUP",118,0)
 ;
"RTN","PSSMRTUP",119,0)
UN ;Unlock Med Route
"RTN","PSSMRTUP",120,0)
 I PSSRTLOC Q
"RTN","PSSMRTUP",121,0)
 L -^PS(51.2,PSSRTIEN)
"RTN","PSSMRTUP",122,0)
 Q
"RTN","PSSMRTUP",123,0)
 ;
"RTN","PSSMRTUP",124,0)
 ;
"RTN","PSSMRTUP",125,0)
SET ;Set Data, leaving USER as null, so the installer is not recorded as the user
"RTN","PSSMRTUP",126,0)
 I '$D(^TMP($J,"PSSMRUN",$S(PSSRTLOC:"PSSLCK",1:"PSSUNLCK"),PSSRTIEN)) S ^TMP($J,"PSSMRUN",$S(PSSRTLOC:"PSSLCK",1:"PSSUNLCK"),PSSRTIEN)=1_"^^"_$P($G(^PS(51.23,PSSRTSTS,0)),"^") D OLDNM G SETPS
"RTN","PSSMRTUP",127,0)
 S $P(^TMP($J,"PSSMRUN",$S(PSSRTLOC:"PSSLCK",1:"PSSUNLCK"),PSSRTIEN),"^",3)=$P($G(^PS(51.23,PSSRTSTS,0)),"^"),$P(^TMP($J,"PSSMRUN",$S(PSSRTLOC:"PSSLCK",1:"PSSUNLCK"),PSSRTIEN),"^")=1 D OLDNM
"RTN","PSSMRTUP",128,0)
SETPS I PSSRTLOC Q
"RTN","PSSMRTUP",129,0)
 N %,PSSHASHP,X,%H,%I,PSSHASHZ,PSSHASHO
"RTN","PSSMRTUP",130,0)
 K PSSHASHP,PSSHASHZ,PSSHASHO S PSSHASHO=$S($P($G(^PS(51.2,PSSRTIEN,1)),"^"):$P($G(^PS(51.2,PSSRTIEN,1)),"^"),1:"")
"RTN","PSSMRTUP",131,0)
 S $P(^PS(51.2,PSSRTIEN,1),"^")=PSSRTSTS
"RTN","PSSMRTUP",132,0)
 D NOW^%DTC S PSSHASHP(51.27,"+1,"_PSSRTIEN_",",.01)=%
"RTN","PSSMRTUP",133,0)
 S PSSHASHP(51.27,"+1,"_PSSRTIEN_",",1)=""
"RTN","PSSMRTUP",134,0)
 S PSSHASHP(51.27,"+1,"_PSSRTIEN_",",2)=PSSHASHO
"RTN","PSSMRTUP",135,0)
 S PSSHASHP(51.27,"+1,"_PSSRTIEN_",",3)=PSSRTSTS
"RTN","PSSMRTUP",136,0)
 D UPDATE^DIE("","PSSHASHP",,"PSSHASHZ")
"RTN","PSSMRTUP",137,0)
 Q
"RTN","PSSMRTUP",138,0)
 ;
"RTN","PSSMRTUP",139,0)
 ;
"RTN","PSSMRTUP",140,0)
SETNW(PSSMRPQX,PSSMRPQZ) ;
"RTN","PSSMRTUP",141,0)
 ;Called from Replaced with term logic
"RTN","PSSMRTUP",142,0)
 N %,PSSMRPQA,X,%H,%I,PSSMRPQB
"RTN","PSSMRTUP",143,0)
 K PSSMRPQA,PSSMRPQB
"RTN","PSSMRTUP",144,0)
 S $P(^PS(51.2,PSSRTIEN,1),"^")=PSSMRPQZ
"RTN","PSSMRTUP",145,0)
 D NOW^%DTC S PSSMRPQA(51.27,"+1,"_PSSRTIEN_",",.01)=%
"RTN","PSSMRTUP",146,0)
 S PSSMRPQA(51.27,"+1,"_PSSRTIEN_",",1)=""
"RTN","PSSMRTUP",147,0)
 S PSSMRPQA(51.27,"+1,"_PSSRTIEN_",",2)=PSSMRPQX
"RTN","PSSMRTUP",148,0)
 S PSSMRPQA(51.27,"+1,"_PSSRTIEN_",",3)=PSSMRPQZ
"RTN","PSSMRTUP",149,0)
 D UPDATE^DIE("","PSSMRPQA",,"PSSMRPQB")
"RTN","PSSMRTUP",150,0)
 Q
"RTN","PSSMRTUP",151,0)
 ;
"RTN","PSSMRTUP",152,0)
 ;
"RTN","PSSMRTUP",153,0)
INCT ;Check Inactivation global
"RTN","PSSMRTUP",154,0)
 N PSSMRPJ6,PSSMRPJ7,PSSMRPJ8,PSSMRPOL,PSSMRPNW
"RTN","PSSMRTUP",155,0)
 S PSSMRPJ6=$P($G(^PS(51.2,PSSRTIEN,1)),"^") Q:'PSSMRPJ6
"RTN","PSSMRTUP",156,0)
 I '$D(^TMP($J,"PSSMRPCC","INACT",PSSMRPJ6)) Q
"RTN","PSSMRTUP",157,0)
 ;Assuming .01 cannot change, if it does, would need old name from 51.23, and need to set piece 2 of INACT global above
"RTN","PSSMRTUP",158,0)
 S PSSMRPOL=$P($G(^PS(51.23,+$G(PSSMRPJ6),0)),"^")
"RTN","PSSMRTUP",159,0)
 S PSSMRPJ7=$P($G(^TMP($J,"PSSMRPCC","INACT",PSSMRPJ6)),"^")
"RTN","PSSMRTUP",160,0)
 S PSSMRPJ8=$S('$G(PSSMRPJ7):"",'$D(^PS(51.23,+PSSMRPJ7,0)):"",1:+PSSMRPJ7)
"RTN","PSSMRTUP",161,0)
 I PSSMRPJ8,$$SCREEN^XTID(51.23,.01,PSSMRPJ8_",") S PSSMRPJ8=""
"RTN","PSSMRTUP",162,0)
 ;Still assuming .01 can't change, if so, need new name from 51.23 
"RTN","PSSMRTUP",163,0)
 S PSSMRPNW=$S(+$G(PSSMRPJ8):$P($G(^PS(51.23,+$G(PSSMRPJ8),0)),"^"),1:"")
"RTN","PSSMRTUP",164,0)
 I 'PSSRTLOC D SETNW(PSSMRPJ6,PSSMRPJ8)
"RTN","PSSMRTUP",165,0)
 S ^TMP($J,"PSSMRUN",$S(PSSRTLOC:"PSSLCK",1:"PSSUNLCK"),PSSRTIEN)=$S('PSSMRPJ8:0_"^"_$G(PSSMRPOL),1:1_"^"_$G(PSSMRPOL)_"^"_$G(PSSMRPNW))
"RTN","PSSMRTUP",166,0)
 Q
"RTN","PSSMRTUP",167,0)
 ;
"RTN","PSSMRTUP",168,0)
 ;
"RTN","PSSMRTUP",169,0)
FINAL ;
"RTN","PSSMRTUP",170,0)
 ;Sets Local mapped and remapped sections of the mail message
"RTN","PSSMRTUP",171,0)
 N PSSMRPP1,PSSMRPP2,PSSMRPP3,PSSMRPP4,PSSMRPP5
"RTN","PSSMRTUP",172,0)
 S PSSMRPP5=0
"RTN","PSSMRTUP",173,0)
 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="The following entries in the Medication Routes (#51.2) File have been",PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",174,0)
 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="mapped/remapped to a Standard Medication Route (#51.23) File entry.",PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",175,0)
 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)=" ",PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",176,0)
 F PSSMRPP1=0:0 S PSSMRPP1=$O(^TMP($J,"PSSMRUN","PSSUNLCK",PSSMRPP1)) Q:'PSSMRPP1  D
"RTN","PSSMRTUP",177,0)
 .I '$P($G(^TMP($J,"PSSMRUN","PSSUNLCK",PSSMRPP1)),"^") Q
"RTN","PSSMRTUP",178,0)
 .S PSSMRPP5=1
"RTN","PSSMRTUP",179,0)
 .S PSSMRPP2=$G(^TMP($J,"PSSMRUN","PSSUNLCK",PSSMRPP1))
"RTN","PSSMRTUP",180,0)
 .S PSSMRPP3=$S($P(PSSMRPP2,"^",2)="":"(None)",1:$P(PSSMRPP2,"^",2))
"RTN","PSSMRTUP",181,0)
 .S PSSMRPP4=$S($P(PSSMRPP2,"^",3)="":"(None)",1:$P(PSSMRPP2,"^",3))
"RTN","PSSMRTUP",182,0)
 .S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="   "_$P($G(^PS(51.2,PSSMRPP1,0)),"^") S PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",183,0)
 .S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="     Previous Standard Route: "_PSSMRPP3 S PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",184,0)
 .S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="     New Standard Route: "_PSSMRPP4 S PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",185,0)
 I 'PSSMRPP5 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="   (None)" S PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",186,0)
 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)=" " S PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",187,0)
 D ATTN^PSSMRTUX S PSSMRPP5=0
"RTN","PSSMRTUP",188,0)
 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="The following entries in the Medication Routes (#51.2) File have been",PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",189,0)
 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="unmapped from a Standard Medication Route (#51.23) File entry.",PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",190,0)
 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)=" ",PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",191,0)
 S PSSMRPP1=0
"RTN","PSSMRTUP",192,0)
 F PSSMRPP1=0:0 S PSSMRPP1=$O(^TMP($J,"PSSMRUN","PSSUNLCK",PSSMRPP1)) Q:'PSSMRPP1  D
"RTN","PSSMRTUP",193,0)
 .I $P($G(^TMP($J,"PSSMRUN","PSSUNLCK",PSSMRPP1)),"^") Q
"RTN","PSSMRTUP",194,0)
 .S PSSMRPP5=1
"RTN","PSSMRTUP",195,0)
 .S PSSMRPP2=$G(^TMP($J,"PSSMRUN","PSSUNLCK",PSSMRPP1))
"RTN","PSSMRTUP",196,0)
 .S PSSMRPP3=$S($P(PSSMRPP2,"^",2)="":"(None)",1:$P(PSSMRPP2,"^",2))
"RTN","PSSMRTUP",197,0)
 .S PSSMRPP4=$P(PSSMRPP2,"^",3) I PSSMRPP4="" S PSSMRPP4="(None)"
"RTN","PSSMRTUP",198,0)
 .S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="   "_$P($G(^PS(51.2,PSSMRPP1,0)),"^") S PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",199,0)
 .S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="     Previous Standard Route: "_PSSMRPP3 S PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",200,0)
 .S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="     New Standard Route: "_PSSMRPP4 S PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",201,0)
 I 'PSSMRPP5 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="   (None)" S PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",202,0)
 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)=" " S PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",203,0)
 ;
"RTN","PSSMRTUP",204,0)
 ;
"RTN","PSSMRTUP",205,0)
 ;Set Locked entries sections of mail message
"RTN","PSSMRTUP",206,0)
 D ZERO^PSSMRTUX K PSSMRPP1,PSSMRPP2,PSSMRPP3,PSSMRPP4,PSSMRPP5
"RTN","PSSMRTUP",207,0)
 S PSSMRPP5=0
"RTN","PSSMRTUP",208,0)
 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="The following entries in the Medication Routes (#51.2) File were to be",PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",209,0)
 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="mapped/remapped to a Standard Medication Route (#51.23) File entry, but",PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",210,0)
 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="could not occur because the Medication Route (#51.2) File entry was locked.",PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",211,0)
 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)=" ",PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",212,0)
 F PSSMRPP1=0:0 S PSSMRPP1=$O(^TMP($J,"PSSMRUN","PSSLCK",PSSMRPP1)) Q:'PSSMRPP1  D
"RTN","PSSMRTUP",213,0)
 .I '$P($G(^TMP($J,"PSSMRUN","PSSLCK",PSSMRPP1)),"^") Q
"RTN","PSSMRTUP",214,0)
 .S PSSMRPP5=1
"RTN","PSSMRTUP",215,0)
 .S PSSMRPP2=$G(^TMP($J,"PSSMRUN","PSSLCK",PSSMRPP1))
"RTN","PSSMRTUP",216,0)
 .S PSSMRPP3=$S($P(PSSMRPP2,"^",2)="":"(None)",1:$P(PSSMRPP2,"^",2))
"RTN","PSSMRTUP",217,0)
 .S PSSMRPP4=$S($P(PSSMRPP2,"^",3)="":"(None)",1:$P(PSSMRPP2,"^",3))
"RTN","PSSMRTUP",218,0)
 .S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="   "_$P($G(^PS(51.2,PSSMRPP1,0)),"^") S PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",219,0)
 .S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="     Current Standard Route: "_PSSMRPP3 S PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",220,0)
 .D CHL^PSSMRTUX
"RTN","PSSMRTUP",221,0)
 I 'PSSMRPP5 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="   (None)" S PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",222,0)
 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)=" " S PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",223,0)
 S PSSMRPP5=0
"RTN","PSSMRTUP",224,0)
 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="The following entries in the Medication Routes (#51.2) File were to be",PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",225,0)
 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="unmapped from a Standard Medication Route (#51.23) File entry, but",PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",226,0)
 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="could not occur because the Medication Route (#51.2) File entry was locked.",PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",227,0)
 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)=" ",PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",228,0)
 S PSSMRPP1=0
"RTN","PSSMRTUP",229,0)
 F PSSMRPP1=0:0 S PSSMRPP1=$O(^TMP($J,"PSSMRUN","PSSLCK",PSSMRPP1)) Q:'PSSMRPP1  D
"RTN","PSSMRTUP",230,0)
 .I $P($G(^TMP($J,"PSSMRUN","PSSLCK",PSSMRPP1)),"^") Q
"RTN","PSSMRTUP",231,0)
 .S PSSMRPP5=1
"RTN","PSSMRTUP",232,0)
 .S PSSMRPP2=$G(^TMP($J,"PSSMRUN","PSSLCK",PSSMRPP1))
"RTN","PSSMRTUP",233,0)
 .S PSSMRPP3=$S($P(PSSMRPP2,"^",2)="":"(None)",1:$P(PSSMRPP2,"^",2))
"RTN","PSSMRTUP",234,0)
 .S PSSMRPP4=$P(PSSMRPP2,"^",3) I PSSMRPP4="" S PSSMRPP4="<delete mapping>"
"RTN","PSSMRTUP",235,0)
 .S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="   "_$P($G(^PS(51.2,PSSMRPP1,0)),"^") S PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",236,0)
 .S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="     Current Standard Route: "_PSSMRPP3 S PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",237,0)
 .S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="     New Standard Route: "_PSSMRPP4 S PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUP",238,0)
 I 'PSSMRPP5 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="   (None)"
"RTN","PSSMRTUP",239,0)
 Q
"RTN","PSSMRTUP",240,0)
 ;
"RTN","PSSMRTUP",241,0)
 ;
"RTN","PSSMRTUP",242,0)
OLDNM ;
"RTN","PSSMRTUP",243,0)
 I $P($G(^PS(51.2,PSSRTIEN,1)),"^") S $P(^TMP($J,"PSSMRUN",$S(PSSRTLOC:"PSSLCK",1:"PSSUNLCK"),PSSRTIEN),"^",2)=$P($G(^PS(51.23,+$P($G(^PS(51.2,PSSRTIEN,1)),"^"),0)),"^")
"RTN","PSSMRTUP",244,0)
 Q
"RTN","PSSMRTUX")
0^6^B21812440^n/a
"RTN","PSSMRTUX",1,0)
PSSMRTUX ;BIR/RTR-Process Standard Medication Route File Updates continued ;03/02/09
"RTN","PSSMRTUX",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**147**;9/30/97;Build 16
"RTN","PSSMRTUX",3,0)
 ;
"RTN","PSSMRTUX",4,0)
 ;Reference to TMP("XUMF EVENT" supported by DBIA 5470
"RTN","PSSMRTUX",5,0)
CHL ;Check Length, called from locked entries section of PSSMRTUP
"RTN","PSSMRTUX",6,0)
 N PSSMRTL1
"RTN","PSSMRTUX",7,0)
 S PSSMRTL1=$L(PSSMRPP4)
"RTN","PSSMRTUX",8,0)
 I PSSMRTL1<37 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="     Recommend mapping to Standard Route: "_PSSMRPP4 S PSSMRPCT=PSSMRPCT+1 Q
"RTN","PSSMRTUX",9,0)
 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="     Recommend mapping to Standard Route:" S PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUX",10,0)
 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="       "_PSSMRPP4 S PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUX",11,0)
 Q
"RTN","PSSMRTUX",12,0)
 ;
"RTN","PSSMRTUX",13,0)
 ;
"RTN","PSSMRTUX",14,0)
ATTN ;
"RTN","PSSMRTUX",15,0)
 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="PLEASE REVIEW, MAY REQUIRE YOUR ATTENTION!",PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUX",16,0)
 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)=" ",PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUX",17,0)
 Q
"RTN","PSSMRTUX",18,0)
 ;
"RTN","PSSMRTUX",19,0)
 ;
"RTN","PSSMRTUX",20,0)
ZERO ;Miscellaneous Standard Med Route changes
"RTN","PSSMRTUX",21,0)
 N PSSMRPHH,PSSMRPJ1,PSSMRPJ2,PSSMRPJ5,PSSMRPA1,PSSMRPA2,PSSMRPA3,PSSMRPA4,PSSMRPA5,PSSMRPA6,PSSMRPA8,PSSMRPA9,PSSMRPA7
"RTN","PSSMRTUX",22,0)
 ;If just the .01 changes, we are not showing
"RTN","PSSMRTUX",23,0)
 S PSSMRPJ5=0
"RTN","PSSMRTUX",24,0)
 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="The following entries in the Standard Medication Routes (#51.23) File have had",PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUX",25,0)
 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="changes to the associated First DataBank Med Route and/or Replacement Term.",PSSMRPCT=PSSMRPCT+1 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)=" ",PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUX",26,0)
 S PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUX",27,0)
 F PSSMRPHH=0:0 S PSSMRPHH=$O(^TMP("XUMF EVENT",$J,51.23,"BEFORE",PSSMRPHH)) Q:'PSSMRPHH  D
"RTN","PSSMRTUX",28,0)
 .S PSSMRPJ1=$P($G(^TMP("XUMF EVENT",$J,51.23,"BEFORE",PSSMRPHH,0)),"^",2)
"RTN","PSSMRTUX",29,0)
 .S PSSMRPJ2=$P($G(^TMP("XUMF EVENT",$J,51.23,"AFTER",PSSMRPHH,0)),"^",2)
"RTN","PSSMRTUX",30,0)
 .S PSSMRPA1=$P($G(^TMP("XUMF EVENT",$J,51.23,"BEFORE",PSSMRPHH,"VUID")),"^",3)
"RTN","PSSMRTUX",31,0)
 .S PSSMRPA2=$P($G(^TMP("XUMF EVENT",$J,51.23,"AFTER",PSSMRPHH,"VUID")),"^",3)
"RTN","PSSMRTUX",32,0)
 .S (PSSMRPA3,PSSMRPA4)=0 K PSSMRPA5,PSSMRPA6,PSSMRPA7
"RTN","PSSMRTUX",33,0)
 .I PSSMRPJ1'=PSSMRPJ2 S PSSMRPA3=1
"RTN","PSSMRTUX",34,0)
 .I PSSMRPA1'=PSSMRPA2 S PSSMRPA4=1
"RTN","PSSMRTUX",35,0)
 .I 'PSSMRPA3,'PSSMRPA4 Q
"RTN","PSSMRTUX",36,0)
 .I PSSMRPA3 S PSSMRPA5=$S($G(PSSMRPJ2)'="":$G(PSSMRPJ2),1:"<deleted>")
"RTN","PSSMRTUX",37,0)
 .I PSSMRPA4 S PSSMRPA6=$S('$G(PSSMRPA2):"<deleted>",1:$P($G(^PS(51.23,+$G(PSSMRPA2),0)),"^")) S PSSMRPA7=$S('$G(PSSMRPA2):"<deleted>",$P($G(^PS(51.23,+$G(PSSMRPA2),0)),"^",2)'="":$P($G(^PS(51.23,+$G(PSSMRPA2),0)),"^",2),1:"(None)")
"RTN","PSSMRTUX",38,0)
 .S PSSMRPJ5=1 S PSSMRPA8=PSSMRPHH S PSSMRPA9=$$STAT^PSSMRTUP(PSSMRPA8)
"RTN","PSSMRTUX",39,0)
 .S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="   "_$P($G(^PS(51.23,+PSSMRPHH,0)),"^")_$S('PSSMRPA9:"   (Inactive)",1:"") S PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUX",40,0)
 .I PSSMRPA3 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="     FDB Route: "_$G(PSSMRPA5) S PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUX",41,0)
 .I PSSMRPA4 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="     Replacement Term: "_$G(PSSMRPA6) S PSSMRPCT=PSSMRPCT+1 I $G(PSSMRPA2) S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="     Replacement Term FDB Route: "_$G(PSSMRPA7) S PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUX",42,0)
 I 'PSSMRPJ5 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)="   (None)",PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUX",43,0)
 S ^TMP($J,"PSSMRPTX",PSSMRPCT,0)=" " S PSSMRPCT=PSSMRPCT+1
"RTN","PSSMRTUX",44,0)
 Q
"RTN","PSSMRTUX",45,0)
 ;
"RTN","PSSMRTUX",46,0)
 ;
"RTN","PSSMRTUX",47,0)
INACZ ;Set 51.23 entries as Inactive if the FDB Route has changed
"RTN","PSSMRTUX",48,0)
 ;
"RTN","PSSMRTUX",49,0)
 ;Here we only reset the value of Inact if the FDB field changes
"RTN","PSSMRTUX",50,0)
 N PSSMRPWH,PSSMRPWJ,PSSMRPW1,PSSMRPW2,PSSMRPW9,PSSMRPW8,PSSMRPW7
"RTN","PSSMRTUX",51,0)
 F PSSMRPWH=0:0 S PSSMRPWH=$O(^TMP("XUMF EVENT",$J,51.23,"BEFORE",PSSMRPWH)) Q:'PSSMRPWH  D
"RTN","PSSMRTUX",52,0)
 .S PSSMRPWJ=$G(^TMP("XUMF EVENT",$J,51.23,"BEFORE",PSSMRPWH,0)) Q:PSSMRPWJ=""
"RTN","PSSMRTUX",53,0)
 .S PSSMRPW1=$P($G(^TMP("XUMF EVENT",$J,51.23,"BEFORE",PSSMRPWH,0)),"^",2)
"RTN","PSSMRTUX",54,0)
 .S PSSMRPW2=$P($G(^TMP("XUMF EVENT",$J,51.23,"AFTER",PSSMRPWH,0)),"^",2)
"RTN","PSSMRTUX",55,0)
 .I PSSMRPW1=PSSMRPW2 Q
"RTN","PSSMRTUX",56,0)
 .S PSSMRPW7=""
"RTN","PSSMRTUX",57,0)
 .S PSSMRPW8=PSSMRPWH
"RTN","PSSMRTUX",58,0)
 .S PSSMRPW9=$$RPLCMNT^XTIDTRM(51.23,PSSMRPW8)
"RTN","PSSMRTUX",59,0)
 .I $P(PSSMRPW9,";")'=PSSMRPWH S PSSMRPW7=$P(PSSMRPW9,";")
"RTN","PSSMRTUX",60,0)
 .I '$D(^TMP($J,"PSSMRPCC","INACT",PSSMRPWH)) D  Q
"RTN","PSSMRTUX",61,0)
 ..;S ^TMP($J,"PSSMRPCC","INACT",PSSMRPWH)=$S('$P($G(^TMP("XUMF EVENT",$J,51.23,"AFTER",PSSMRPWH,"REPLACED BY")),"^"):0,1:$P($G(^TMP("XUMF EVENT",$J,51.23,"AFTER",PSSMRPWH,"REPLACED BY")),"^"))
"RTN","PSSMRTUX",62,0)
 ..S ^TMP($J,"PSSMRPCC","INACT",PSSMRPWH)=$S('$G(PSSMRPW7):0,1:$G(PSSMRPW7))
"RTN","PSSMRTUX",63,0)
 .I '^TMP($J,"PSSMRPCC","INACT",PSSMRPWH),$G(PSSMRPW7) S ^TMP($J,"PSSMRPCC","INACT",PSSMRPWH)=$G(PSSMRPW7)
"RTN","PSSMRTUX",64,0)
 Q
"RTN","PSSUTIL")
0^7^B91400007^B69436985
"RTN","PSSUTIL",1,0)
PSSUTIL ;BIR/RTR-utility routine for NDF changes ;04/04/00
"RTN","PSSUTIL",2,0)
 ;;1.0;PHARMACY DATA MANAGEMENT;**34,38,147**;9/30/97;Build 16
"RTN","PSSUTIL",3,0)
 ;
"RTN","PSSUTIL",4,0)
 ;Reference to PS(50.607 supported by DBIA 2221
"RTN","PSSUTIL",5,0)
EN(PSSDIEN) ;Receive Drug entries unmatched as a result of NDF changes
"RTN","PSSUTIL",6,0)
 ;Not called, NDF deletes the possible and local possible dosages
"RTN","PSSUTIL",7,0)
 Q
"RTN","PSSUTIL",8,0)
EN1(PSSDIEN,PSSTALK) ;Receive Drug entries that have been unmatched
"RTN","PSSUTIL",9,0)
 N PSSLD,PSSLOCV,PSSPWXEX
"RTN","PSSUTIL",10,0)
 S PSSLOCV=$O(^PS(59.7,0))
"RTN","PSSUTIL",11,0)
 ;I $P($G(^PS(59.7,+$G(PSSLOCV),80)),"^",3)<2 Q
"RTN","PSSUTIL",12,0)
 W !!,"Deleting Possible Dosages.."
"RTN","PSSUTIL",13,0)
 K ^PSDRUG(PSSDIEN,"DOS"),^PSDRUG(PSSDIEN,"DOS1")
"RTN","PSSUTIL",14,0)
 H 1 W "."
"RTN","PSSUTIL",15,0)
 I '$G(PSSTALK) K ^PSDRUG(PSSDIEN,"DOS2") G EQ
"RTN","PSSUTIL",16,0)
 I '$O(^PSDRUG(PSSDIEN,"DOS2",0)) W !
"RTN","PSSUTIL",17,0)
 I $O(^PSDRUG(PSSDIEN,"DOS2",0)) D DASK D  W ! K DIR S DIR(0)="Y",DIR("B")="Y",DIR("A")="Delete these Local Possible Dosages" D ^DIR K DIR I Y=1 W !!,"Deleting Local Possible Dosages.." K ^PSDRUG(PSSDIEN,"DOS2") H 1 W "." W ! G EQ
"RTN","PSSUTIL",18,0)
 .S PSSPWXEX=0 W !!,"LOCAL POSSIBLE DOSAGES:"
"RTN","PSSUTIL",19,0)
 .W ! F PSSLD=0:0 S PSSLD=$O(^PSDRUG(PSSDIEN,"DOS2",PSSLD)) Q:'PSSLD!(PSSPWXEX)  D
"RTN","PSSUTIL",20,0)
 ..D:($Y+5)>IOSL ZASK Q:PSSPWXEX  W !,$P($G(^PSDRUG(PSSDIEN,"DOS2",PSSLD,0)),"^")_"   "_$S($P($G(^(0)),"^",2)="":"(No package)",1:"(Package -> "_$P($G(^(0)),"^",2)_")") D DOSEADD
"RTN","PSSUTIL",21,0)
 I $O(^PSDRUG(PSSDIEN,"DOS2",0)) W !!,"Local Possible Dosages not deleted.",!
"RTN","PSSUTIL",22,0)
EQ Q
"RTN","PSSUTIL",23,0)
EN2(PSSDIEN,PSSTALK) ;Receive Drug entries matched to NDF
"RTN","PSSUTIL",24,0)
 ;Do we need entry point on an Orderable Item match (not matched to NDF)
"RTN","PSSUTIL",25,0)
 Q:'$D(^PSDRUG(PSSDIEN,0))
"RTN","PSSUTIL",26,0)
 K ^PSDRUG(PSSDIEN,"DOS"),^PSDRUG(PSSDIEN,"DOS1")
"RTN","PSSUTIL",27,0)
 N PSSLOC,PSSO,PSSI,PSSND,PSSND1,PSSBOTH,PSSONLYI,PSSONLYO,PSSNODE,PSSDF,PSSST,PSSUN,PSSTOT,PSSTOTX,PSSDUPD,PSSTODOS,PSSFLAG
"RTN","PSSUTIL",28,0)
 S PSSLOC=$O(^PS(59.7,0))
"RTN","PSSUTIL",29,0)
 ;I $P($G(^PS(59.7,+$G(PSSLOC),80)),"^",3)<3 Q
"RTN","PSSUTIL",30,0)
 I $G(PSSTALK) W !!,"Resetting Possible Dosages..",! K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSSUTIL",31,0)
 S PSSBOTH=1
"RTN","PSSUTIL",32,0)
 S (PSSONLYI,PSSONLYO,PSSFLAG)=0
"RTN","PSSUTIL",33,0)
 S PSSND=$P($G(^PSDRUG(PSSDIEN,"ND")),"^",3),PSSND1=$P($G(^("ND")),"^") I 'PSSND!('PSSND1) G LOC
"RTN","PSSUTIL",34,0)
 S PSSNODE=$$DFSU^PSNAPIS(PSSND1,PSSND) S PSSDF=$P(PSSNODE,"^"),PSSST=$P(PSSNODE,"^",4),PSSUN=$P(PSSNODE,"^",5)
"RTN","PSSUTIL",35,0)
 I 'PSSDF!('PSSUN)!($G(PSSST)="") G LOC
"RTN","PSSUTIL",36,0)
 I '$D(^PS(50.606,PSSDF,0))!('$D(^PS(50.607,PSSUN,0))) G LOC
"RTN","PSSUTIL",37,0)
 I PSSST'?.N&(PSSST'?.N1".".N) G LOC
"RTN","PSSUTIL",38,0)
 S (PSSI,PSSO)=0
"RTN","PSSUTIL",39,0)
 I $D(^PS(50.606,"ACONI",PSSDF,PSSUN)),$O(^PS(50.606,"ADUPI",PSSDF,0)) S PSSI=1
"RTN","PSSUTIL",40,0)
 I $D(^PS(50.606,"ACONO",PSSDF,PSSUN)),$O(^PS(50.606,"ADUPO",PSSDF,0)) S PSSO=1
"RTN","PSSUTIL",41,0)
 I 'PSSO,'PSSI G LOC
"RTN","PSSUTIL",42,0)
 I PSSI,'PSSO D  S:PSSTOT>1 PSSTOTX=PSSTOT-1,^PSDRUG(PSSDIEN,"DOS")=PSSST_"^"_PSSUN,PSSONLYO=1,PSSBOTH=0,^PSDRUG(PSSDIEN,"DOS1",0)="^50.0903^"_$G(PSSTOTX)_"^"_$G(PSSTOTX) G LOC
"RTN","PSSUTIL",43,0)
 .S PSSTOT=1 F PSSDUPD=0:0 S PSSDUPD=$O(^PS(50.606,"ADUPI",PSSDF,PSSDUPD)) Q:'PSSDUPD  D
"RTN","PSSUTIL",44,0)
 ..S PSSTODOS=PSSDUPD*PSSST
"RTN","PSSUTIL",45,0)
 ..S ^PSDRUG(PSSDIEN,"DOS1",PSSTOT,0)=PSSDUPD_"^"_PSSTODOS_"^I",^PSDRUG(PSSDIEN,"DOS1","B",PSSDUPD,PSSTOT)="" S PSSTOT=PSSTOT+1
"RTN","PSSUTIL",46,0)
 I PSSO,'PSSI D  S:PSSTOT>1 PSSTOTX=PSSTOT-1,^PSDRUG(PSSDIEN,"DOS")=PSSST_"^"_PSSUN,PSSONLYI=1,PSSBOTH=0,^PSDRUG(PSSDIEN,"DOS1",0)="^50.0903^"_$G(PSSTOTX)_"^"_$G(PSSTOTX) G LOC
"RTN","PSSUTIL",47,0)
 .S PSSTOT=1 F PSSDUPD=0:0 S PSSDUPD=$O(^PS(50.606,"ADUPO",PSSDF,PSSDUPD)) Q:'PSSDUPD  D
"RTN","PSSUTIL",48,0)
 ..S PSSTODOS=PSSDUPD*PSSST
"RTN","PSSUTIL",49,0)
 ..S ^PSDRUG(PSSDIEN,"DOS1",PSSTOT,0)=PSSDUPD_"^"_PSSTODOS_"^O",^PSDRUG(PSSDIEN,"DOS1","B",PSSDUPD,PSSTOT)="" S PSSTOT=PSSTOT+1
"RTN","PSSUTIL",50,0)
 I PSSO,PSSI D  S:PSSTOT>1 PSSTOTX=PSSTOT-1,PSSFLAG=1,^PSDRUG(PSSDIEN,"DOS")=PSSST_"^"_PSSUN,^PSDRUG(PSSDIEN,"DOS1",0)="^50.0903^"_$G(PSSTOTX)_"^"_$G(PSSTOTX)
"RTN","PSSUTIL",51,0)
 .S PSSTOT=1 F PSSDUPD=0:0 S PSSDUPD=$O(^PS(50.606,"ADUPI",PSSDF,PSSDUPD)) Q:'PSSDUPD  D
"RTN","PSSUTIL",52,0)
 ..S PSSTODOS=PSSDUPD*PSSST
"RTN","PSSUTIL",53,0)
 ..S ^PSDRUG(PSSDIEN,"DOS1",PSSTOT,0)=PSSDUPD_"^"_PSSTODOS S $P(^PSDRUG(PSSDIEN,"DOS1",PSSTOT,0),"^",3)=$S($D(^PS(50.606,"ADUPO",PSSDF,PSSDUPD)):"IO",1:"I") S ^PSDRUG(PSSDIEN,"DOS1","B",PSSDUPD,PSSTOT)="" S PSSTOT=PSSTOT+1
"RTN","PSSUTIL",54,0)
 I PSSO,PSSI D  S:PSSTOT>1 PSSTOTX=PSSTOT-1,PSSFLAG=1,^PSDRUG(PSSDIEN,"DOS")=PSSST_"^"_PSSUN,^PSDRUG(PSSDIEN,"DOS1",0)="^50.0903^"_$G(PSSTOTX)_"^"_$G(PSSTOTX)
"RTN","PSSUTIL",55,0)
 .F PSSDUPD=0:0 S PSSDUPD=$O(^PS(50.606,"ADUPO",PSSDF,PSSDUPD)) Q:'PSSDUPD  D
"RTN","PSSUTIL",56,0)
 ..I $D(^PS(50.606,"ADUPI",PSSDF,PSSDUPD)) Q
"RTN","PSSUTIL",57,0)
 ..S PSSTODOS=PSSDUPD*PSSST
"RTN","PSSUTIL",58,0)
 ..S ^PSDRUG(PSSDIEN,"DOS1",PSSTOT,0)=PSSDUPD_"^"_PSSTODOS_"^O",^PSDRUG(PSSDIEN,"DOS1","B",PSSDUPD,PSSTOT)="" S PSSTOT=PSSTOT+1
"RTN","PSSUTIL",59,0)
 Q
"RTN","PSSUTIL",60,0)
LOC ;Set local possible dosages
"RTN","PSSUTIL",61,0)
 N PSSOITEM,PSSOID,PSSLTOT,PSSLTOTX,PSDUPDPT,PSNOUN,PSNOUNPA,PSNOUNPT,PSALL,PSDOD,PSSLPT,PSSLPTX,PSSLPNO,PSSLP,PSSNL,PSSNLF,PSSNLX
"RTN","PSSUTIL",62,0)
 S PSSOITEM=$P($G(^PSDRUG(PSSDIEN,2)),"^") Q:'PSSOITEM
"RTN","PSSUTIL",63,0)
 S PSSOID=$P($G(^PS(50.7,PSSOITEM,0)),"^",2) Q:'PSSOID
"RTN","PSSUTIL",64,0)
 Q:'$O(^PS(50.606,PSSOID,"NOUN",0))
"RTN","PSSUTIL",65,0)
 I $O(^PSDRUG(PSSDIEN,"DOS2",0)) G LOCMRG
"RTN","PSSUTIL",66,0)
 I '$G(PSSTALK) G QUIET
"RTN","PSSUTIL",67,0)
 W ! K DIR S DIR("A")="This drug has no Local Possible Dosages, do you want to create them",DIR("B")="Y",DIR(0)="Y"
"RTN","PSSUTIL",68,0)
 S DIR("?")=" ",DIR("?",1)="If you answer 'YES', Local Possible Dosages will be created for this drug using",DIR("?",2)="nouns associated with the "_$P($G(^PS(50.606,+$G(PSSOID),0)),"^")_" Dosage Form."
"RTN","PSSUTIL",69,0)
 D ^DIR K DIR I Y'=1 Q
"RTN","PSSUTIL",70,0)
 W !!,"Setting Local Possible Dosages..",!
"RTN","PSSUTIL",71,0)
 K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSSUTIL",72,0)
QUIET ;
"RTN","PSSUTIL",73,0)
 I $O(^PS(50.606,PSSOID,"DUPD",0)) D  S:PSSLTOT>1 PSSLTOTX=PSSLTOT-1,^PSDRUG(PSSDIEN,"DOS2",0)="^50.0904^"_$G(PSSLTOTX)_"^"_$G(PSSLTOTX) Q
"RTN","PSSUTIL",74,0)
 .S PSSLTOT=1
"RTN","PSSUTIL",75,0)
 .F PSNOUN=0:0 S PSNOUN=$O(^PS(50.606,PSSOID,"NOUN",PSNOUN)) Q:'PSNOUN  S PSNOUNPT=$P($G(^(PSNOUN,0)),"^"),PSNOUNPA=$P($G(^(0)),"^",2) D:PSNOUNPT'=""
"RTN","PSSUTIL",76,0)
 ..Q:PSNOUNPA=""
"RTN","PSSUTIL",77,0)
 ..F PSDOD=0:0 S PSDOD=$O(^PS(50.606,PSSOID,"DUPD",PSDOD)) Q:'PSDOD  S PSDUPDPT=$P($G(^(PSDOD,0)),"^") D:PSDUPDPT'=""
"RTN","PSSUTIL",78,0)
 ...I $G(PSSONLYO),PSNOUNPA'["O" Q
"RTN","PSSUTIL",79,0)
 ...I $G(PSSONLYI),PSNOUNPA'["I" Q
"RTN","PSSUTIL",80,0)
 ...D TEST^PSSDOSCR
"RTN","PSSUTIL",81,0)
 ...S PSALL=$G(PSDUPDPT)_" "_$S($G(PSSNLF):$G(PSSNLX),1:$G(PSNOUNPT)) K PSSNL,PSSNLF,PSSNLX
"RTN","PSSUTIL",82,0)
 ...S ^PSDRUG(PSSDIEN,"DOS2",PSSLTOT,0)=$G(PSALL)_"^"_$G(PSNOUNPA),^PSDRUG(PSSDIEN,"DOS2","B",$E(PSALL,1,30),PSSLTOT)="" S PSSLTOT=PSSLTOT+1
"RTN","PSSUTIL",83,0)
 S PSSLTOT=1 F PSNOUN=0:0 S PSNOUN=$O(^PS(50.606,PSSOID,"NOUN",PSNOUN)) Q:'PSNOUN  S PSNOUNPT=$P($G(^(PSNOUN,0)),"^"),PSNOUNPA=$P($G(^(0)),"^",2) D:PSNOUNPT'=""
"RTN","PSSUTIL",84,0)
 .Q:PSNOUNPA=""
"RTN","PSSUTIL",85,0)
 .I $G(PSSONLYI),PSNOUNPA'["I" Q
"RTN","PSSUTIL",86,0)
 .I $G(PSSONLYO),PSNOUNPA'["O" Q
"RTN","PSSUTIL",87,0)
 .S ^PSDRUG(PSSDIEN,"DOS2",PSSLTOT,0)=PSNOUNPT_"^"_$G(PSNOUNPA),^PSDRUG(PSSDIEN,"DOS2","B",$E(PSNOUNPT,1,30),PSSLTOT)="" S PSSLTOT=PSSLTOT+1
"RTN","PSSUTIL",88,0)
 I PSSLTOT>1 S PSSLTOTX=PSSLTOT-1 S ^PSDRUG(PSSDIEN,"DOS2",0)="^50.0904^"_$G(PSSLTOTX)_"^"_$G(PSSLTOTX)
"RTN","PSSUTIL",89,0)
 Q
"RTN","PSSUTIL",90,0)
LOCMRG ;Merge new Local Possible Dosages with existing ones
"RTN","PSSUTIL",91,0)
 N PSSLIEN,PSSLIENX,PSSPWZEX
"RTN","PSSUTIL",92,0)
 I '$G(PSSTALK) G QUIET1
"RTN","PSSUTIL",93,0)
 W !!,"This drug has the following Local Possible Dosages:",!
"RTN","PSSUTIL",94,0)
 S PSSPWZEX=0 F PSSLIEN=0:0 S PSSLIEN=$O(^PSDRUG(PSSDIEN,"DOS2",PSSLIEN)) Q:'PSSLIEN!(PSSPWZEX)  D
"RTN","PSSUTIL",95,0)
 .D:($Y+5)>IOSL XASK Q:PSSPWZEX  S PSSLIENX=$P($G(^PSDRUG(PSSDIEN,"DOS2",PSSLIEN,0)),"^")
"RTN","PSSUTIL",96,0)
 .I $L(PSSLIENX)'>53 W !,PSSLIENX,?55,"PACKAGE: ",$P($G(^PSDRUG(PSSDIEN,"DOS2",PSSLIEN,0)),"^",2) D DOSEADX Q
"RTN","PSSUTIL",97,0)
 .W !,PSSLIENX,!,?55,"PACKAGE: ",$P($G(^PSDRUG(PSSDIEN,"DOS2",PSSLIEN,0)),"^",2) D DOSEADX
"RTN","PSSUTIL",98,0)
 W ! K DIR S DIR(0)="Y",DIR("B")="Y",DIR("A")="Do you want to merge new Local Possible Dosages"
"RTN","PSSUTIL",99,0)
 S DIR("?")=" ",DIR("?",1)="If you answer 'YES', any new Local Possible Dosages found based on the nouns",DIR("?",2)="associated with the "_$P($G(^PS(50.606,+$G(PSSOID),0)),"^")_" Dosage Form"
"RTN","PSSUTIL",100,0)
 S DIR("?",3)="will be added to you current Local Possible Dosages."
"RTN","PSSUTIL",101,0)
 D ^DIR K DIR I Y'=1 Q
"RTN","PSSUTIL",102,0)
 W !!,"Setting Local Possible Dosages..",!
"RTN","PSSUTIL",103,0)
 K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSSUTIL",104,0)
QUIET1 ;
"RTN","PSSUTIL",105,0)
 I $O(^PS(50.606,PSSOID,"DUPD",0)) D  Q
"RTN","PSSUTIL",106,0)
 .F PSNOUN=0:0 S PSNOUN=$O(^PS(50.606,PSSOID,"NOUN",PSNOUN)) Q:'PSNOUN  S PSNOUNPT=$P($G(^(PSNOUN,0)),"^"),PSNOUNPA=$P($G(^(0)),"^",2) D:PSNOUNPT'=""
"RTN","PSSUTIL",107,0)
 ..Q:PSNOUNPA=""
"RTN","PSSUTIL",108,0)
 ..F PSDOD=0:0 S PSDOD=$O(^PS(50.606,PSSOID,"DUPD",PSDOD)) Q:'PSDOD  S PSDUPDPT=$P($G(^(PSDOD,0)),"^") D:PSDUPDPT'=""
"RTN","PSSUTIL",109,0)
 ...I $G(PSSONLYO),PSNOUNPA'["O" Q
"RTN","PSSUTIL",110,0)
 ...I $G(PSSONLYI),PSNOUNPA'["I" Q
"RTN","PSSUTIL",111,0)
 ...D TEST^PSSDOSCR
"RTN","PSSUTIL",112,0)
 ...S PSALL=$G(PSDUPDPT)_" "_$S($G(PSSNLF):$G(PSSNLX),1:$G(PSNOUNPT)) K PSSNL,PSSNLF,PSSNLX
"RTN","PSSUTIL",113,0)
 ...S (PSSLPT,PSSLPTX,PSSLPNO)=0 F PSSLP=0:0 S PSSLP=$O(^PSDRUG(PSSDIEN,"DOS2",PSSLP)) Q:'PSSLP  S PSSLPTX=PSSLPTX+1 S PSSLPT=PSSLP I PSALL=$P($G(^PSDRUG(PSSDIEN,"DOS2",PSSLP,0)),"^") S PSSLPNO=1
"RTN","PSSUTIL",114,0)
 ...Q:PSSLPNO
"RTN","PSSUTIL",115,0)
 ...S PSSLPT=PSSLPT+1,PSSLPTX=PSSLPTX+1
"RTN","PSSUTIL",116,0)
 ...S ^PSDRUG(PSSDIEN,"DOS2",PSSLPT,0)=$G(PSALL)_"^"_$G(PSNOUNPA),^PSDRUG(PSSDIEN,"DOS2","B",$E(PSALL,1,30),PSSLPT)="",^PSDRUG(PSSDIEN,"DOS2",0)="^50.0904^"_$G(PSSLPT)_"^"_$G(PSSLPTX)
"RTN","PSSUTIL",117,0)
 F PSNOUN=0:0 S PSNOUN=$O(^PS(50.606,PSSOID,"NOUN",PSNOUN)) Q:'PSNOUN  S PSNOUNPT=$P($G(^(PSNOUN,0)),"^"),PSNOUNPA=$P($G(^(0)),"^",2) D:PSNOUNPT'=""
"RTN","PSSUTIL",118,0)
 .Q:PSNOUNPA=""
"RTN","PSSUTIL",119,0)
 .I $G(PSSONLYO),PSNOUNPA'["O" Q
"RTN","PSSUTIL",120,0)
 .I $G(PSSONLYI),PSNOUNPA'["I" Q
"RTN","PSSUTIL",121,0)
 .S (PSSLPT,PSSLPTX,PSSLPNO)=0 F PSSLP=0:0 S PSSLP=$O(^PSDRUG(PSSDIEN,"DOS2",PSSLP)) Q:'PSSLP  S PSSLPTX=PSSLPTX+1 S PSSLPT=PSSLP I PSNOUNPT=$P($G(^PSDRUG(PSSDIEN,"DOS2",PSSLP,0)),"^") S PSSLPNO=1
"RTN","PSSUTIL",122,0)
 .Q:PSSLPNO
"RTN","PSSUTIL",123,0)
 .S PSSLPT=PSSLPT+1,PSSLPTX=PSSLPTX+1
"RTN","PSSUTIL",124,0)
 .S ^PSDRUG(PSSDIEN,"DOS2",PSSLPT,0)=$G(PSNOUNPT)_"^"_$G(PSNOUNPA),^PSDRUG(PSSDIEN,"DOS2","B",$E(PSNOUNPT,1,30),PSSLPT)="",^PSDRUG(PSSDIEN,"DOS2",0)="^50.0904^"_$G(PSSLPT)_"^"_$G(PSSLPTX)
"RTN","PSSUTIL",125,0)
 Q
"RTN","PSSUTIL",126,0)
 ;
"RTN","PSSUTIL",127,0)
 ;
"RTN","PSSUTIL",128,0)
DOSEADD ;New fields added with PSS*1*147
"RTN","PSSUTIL",129,0)
 N PSSPW1,PSSPW2,PSSPW3,PSSPW4,PSSPW5,PSSPW6,PSSPW7,PSSPW8
"RTN","PSSUTIL",130,0)
 S PSSPW7=""
"RTN","PSSUTIL",131,0)
 S PSSPW1=$G(^PSDRUG(PSSDIEN,"DOS2",PSSLD,0))
"RTN","PSSUTIL",132,0)
 S PSSPW2=$P(PSSPW1,"^",3)
"RTN","PSSUTIL",133,0)
 S PSSPW3=$S($E(PSSPW2)=".":"0",1:"")_PSSPW2
"RTN","PSSUTIL",134,0)
 D:($Y+5)>IOSL ZASK Q:PSSPWXEX  W !?3,"BCMA UNITS PER DOSE: "_PSSPW3
"RTN","PSSUTIL",135,0)
 S PSSPW4=$P(PSSPW1,"^",5),PSSPW5=$P(PSSPW1,"^",6)
"RTN","PSSUTIL",136,0)
 S PSSPW6=$S($E(PSSPW5)=".":"0",1:"")_PSSPW5
"RTN","PSSUTIL",137,0)
 I PSSPW4 S PSSPW7=$P($G(^PS(51.24,+PSSPW4,0)),"^")
"RTN","PSSUTIL",138,0)
 S PSSPW8=$L(PSSPW6)+$L(PSSPW7)
"RTN","PSSUTIL",139,0)
 D:($Y+5)>IOSL ZASK Q:PSSPWXEX  I PSSPW8<49 W !?3,"NUMERIC DOSE: "_PSSPW6_"   DOSE UNIT: "_PSSPW7 Q
"RTN","PSSUTIL",140,0)
 W !?3,"NUMERIC DOSE: "_PSSPW6
"RTN","PSSUTIL",141,0)
 W !?3,"DOSE UNIT: "_PSSPW7
"RTN","PSSUTIL",142,0)
 Q
"RTN","PSSUTIL",143,0)
 ;
"RTN","PSSUTIL",144,0)
 ;
"RTN","PSSUTIL",145,0)
DOSEADX ;New fields added with PSS*1*147
"RTN","PSSUTIL",146,0)
 N PSSPWX1,PSSPWX2,PSSPWX3,PSSPWX4,PSSPWX5,PSSPWX6,PSSPWX7,PSSPWX8
"RTN","PSSUTIL",147,0)
 S PSSPWX7=""
"RTN","PSSUTIL",148,0)
 S PSSPWX1=$G(^PSDRUG(PSSDIEN,"DOS2",PSSLIEN,0))
"RTN","PSSUTIL",149,0)
 S PSSPWX2=$P(PSSPWX1,"^",3)
"RTN","PSSUTIL",150,0)
 S PSSPWX3=$S($E(PSSPWX2)=".":"0",1:"")_PSSPWX2
"RTN","PSSUTIL",151,0)
 D:($Y+5)>IOSL XASK Q:PSSPWZEX  W !?3,"BCMA UNITS PER DOSE: "_PSSPWX3
"RTN","PSSUTIL",152,0)
 S PSSPWX4=$P(PSSPWX1,"^",5),PSSPWX5=$P(PSSPWX1,"^",6)
"RTN","PSSUTIL",153,0)
 S PSSPWX6=$S($E(PSSPWX5)=".":"0",1:"")_PSSPWX5
"RTN","PSSUTIL",154,0)
 I PSSPWX4 S PSSPWX7=$P($G(^PS(51.24,+PSSPWX4,0)),"^")
"RTN","PSSUTIL",155,0)
 S PSSPWX8=$L(PSSPWX6)+$L(PSSPWX7)
"RTN","PSSUTIL",156,0)
 D:($Y+5)>IOSL XASK Q:PSSPWZEX  I PSSPWX8<49 W !?3,"NUMERIC DOSE: "_PSSPWX6_"   DOSE UNIT: "_PSSPWX7 Q
"RTN","PSSUTIL",157,0)
 W !?3,"NUMERIC DOSE: "_PSSPWX6
"RTN","PSSUTIL",158,0)
 W !?3,"DOSE UNIT: "_PSSPWX7
"RTN","PSSUTIL",159,0)
 Q
"RTN","PSSUTIL",160,0)
 ;
"RTN","PSSUTIL",161,0)
 ;
"RTN","PSSUTIL",162,0)
ZASK ;Ask to continue
"RTN","PSSUTIL",163,0)
 N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","PSSUTIL",164,0)
 K DIR W ! S DIR(0)="E",DIR("A")="Press Return to continue,'^' to exit the list"  D ^DIR K DIR I 'Y S PSSPWXEX=1
"RTN","PSSUTIL",165,0)
 W @IOF
"RTN","PSSUTIL",166,0)
 Q
"RTN","PSSUTIL",167,0)
 ;
"RTN","PSSUTIL",168,0)
 ;
"RTN","PSSUTIL",169,0)
XASK ;Ask to continue
"RTN","PSSUTIL",170,0)
 N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","PSSUTIL",171,0)
 K DIR W ! S DIR(0)="E",DIR("A")="Press Return to continue,'^' to exit the list"  D ^DIR K DIR I 'Y S PSSPWZEX=1
"RTN","PSSUTIL",172,0)
 W @IOF
"RTN","PSSUTIL",173,0)
 Q
"RTN","PSSUTIL",174,0)
 ;
"RTN","PSSUTIL",175,0)
 ;
"RTN","PSSUTIL",176,0)
DASK ;Ask to continue
"RTN","PSSUTIL",177,0)
 N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","PSSUTIL",178,0)
 K DIR W ! S DIR(0)="E",DIR("A")="Press Return to continue"  D ^DIR K DIR
"RTN","PSSUTIL",179,0)
 W @IOF
"RTN","PSSUTIL",180,0)
 Q
"VER")
8.0^22.0
"^DD",52.6,52.6,18,0)
ADDITIVE FREQUENCY^S^1:1 BAG/DAY;A:ALL BAGS;^0;14^Q
"^DD",52.6,52.6,18,3)
Select a value to be used as the default value for the Additive Frequency field in Computerized Patient Record System (CPRS), when continuous IV orders with additives are entered.
"^DD",52.6,52.6,18,21,0)
^.001^3^3^3090713^^^^
"^DD",52.6,52.6,18,21,1,0)
This field will be used to provide a default value for the Additive
"^DD",52.6,52.6,18,21,2,0)
Frequency field in Computerized Patient Record System (CPRS) when
"^DD",52.6,52.6,18,21,3,0)
continuous IV orders with additives are entered.
"^DD",52.6,52.6,18,"DT")
3090713
"BLD",7503,6)
^133
**END**
**END**
