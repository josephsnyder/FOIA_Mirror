Released SR*3*165 SEQ #167
Extracted from mail message
**KIDS**:SR*3.0*165^

**INSTALL NAME**
SR*3.0*165
"BLD",6578,0)
SR*3.0*165^SURGERY^0^3090826^y
"BLD",6578,1,0)
^^13^13^3090819^^^
"BLD",6578,1,1,0)
This patch addresses the following problems:
"BLD",6578,1,2,0)
 
"BLD",6578,1,3,0)
1.  HD194156 - Input transform for CPT Modifier 51 in Surgery
"BLD",6578,1,4,0)
The Lexicon package has been working to update the CPT code ranges for 
"BLD",6578,1,5,0)
the CPT Modifier 51. Part of this update is to include all Surgical 
"BLD",6578,1,6,0)
Procedures with the exception of those listed in Appendix E of the CPT
"BLD",6578,1,7,0)
Manual.  During the analysis phase for this project, it was discovered 
"BLD",6578,1,8,0)
that this unique CPT Modifier carries with it the stipulation that it 
"BLD",6578,1,9,0)
can not be used in conjunction with the principal procedure.
"BLD",6578,1,10,0)
 
"BLD",6578,1,11,0)
2.  HD238998 - FGH - service block issue on 5th week of month
"BLD",6578,1,12,0)
When a monthly service block is set for a day in the 4th week, users are
"BLD",6578,1,13,0)
unable to set a service block for that day in the 5th week of a month.
"BLD",6578,4,0)
^9.64PA^^
"BLD",6578,6)
1^
"BLD",6578,6.3)
6
"BLD",6578,"ABPKG")
n
"BLD",6578,"KRN",0)
^9.67PA^8989.52^19
"BLD",6578,"KRN",.4,0)
.4
"BLD",6578,"KRN",.401,0)
.401
"BLD",6578,"KRN",.402,0)
.402
"BLD",6578,"KRN",.403,0)
.403
"BLD",6578,"KRN",.5,0)
.5
"BLD",6578,"KRN",.84,0)
.84
"BLD",6578,"KRN",3.6,0)
3.6
"BLD",6578,"KRN",3.8,0)
3.8
"BLD",6578,"KRN",9.2,0)
9.2
"BLD",6578,"KRN",9.8,0)
9.8
"BLD",6578,"KRN",9.8,"NM",0)
^9.68A^10^8
"BLD",6578,"KRN",9.8,"NM",1,0)
SROMOD^^0^B38394892
"BLD",6578,"KRN",9.8,"NM",2,0)
SROMOD0^^0^B42153492
"BLD",6578,"KRN",9.8,"NM",3,0)
SRSBDEL^^0^B24873371
"BLD",6578,"KRN",9.8,"NM",5,0)
SRSBOUT^^0^B34635928
"BLD",6578,"KRN",9.8,"NM",6,0)
SRSDIS1^^0^B9832283
"BLD",6578,"KRN",9.8,"NM",7,0)
SRSDISP^^0^B11398688
"BLD",6578,"KRN",9.8,"NM",9,0)
SRSAVL^^0^B22424982
"BLD",6578,"KRN",9.8,"NM",10,0)
SRSBUTL^^0^B34773230
"BLD",6578,"KRN",9.8,"NM","B","SROMOD",1)

"BLD",6578,"KRN",9.8,"NM","B","SROMOD0",2)

"BLD",6578,"KRN",9.8,"NM","B","SRSAVL",9)

"BLD",6578,"KRN",9.8,"NM","B","SRSBDEL",3)

"BLD",6578,"KRN",9.8,"NM","B","SRSBOUT",5)

"BLD",6578,"KRN",9.8,"NM","B","SRSBUTL",10)

"BLD",6578,"KRN",9.8,"NM","B","SRSDIS1",6)

"BLD",6578,"KRN",9.8,"NM","B","SRSDISP",7)

"BLD",6578,"KRN",19,0)
19
"BLD",6578,"KRN",19.1,0)
19.1
"BLD",6578,"KRN",101,0)
101
"BLD",6578,"KRN",409.61,0)
409.61
"BLD",6578,"KRN",771,0)
771
"BLD",6578,"KRN",870,0)
870
"BLD",6578,"KRN",8989.51,0)
8989.51
"BLD",6578,"KRN",8989.52,0)
8989.52
"BLD",6578,"KRN",8994,0)
8994
"BLD",6578,"KRN","B",.4,.4)

"BLD",6578,"KRN","B",.401,.401)

"BLD",6578,"KRN","B",.402,.402)

"BLD",6578,"KRN","B",.403,.403)

"BLD",6578,"KRN","B",.5,.5)

"BLD",6578,"KRN","B",.84,.84)

"BLD",6578,"KRN","B",3.6,3.6)

"BLD",6578,"KRN","B",3.8,3.8)

"BLD",6578,"KRN","B",9.2,9.2)

"BLD",6578,"KRN","B",9.8,9.8)

"BLD",6578,"KRN","B",19,19)

"BLD",6578,"KRN","B",19.1,19.1)

"BLD",6578,"KRN","B",101,101)

"BLD",6578,"KRN","B",409.61,409.61)

"BLD",6578,"KRN","B",771,771)

"BLD",6578,"KRN","B",870,870)

"BLD",6578,"KRN","B",8989.51,8989.51)

"BLD",6578,"KRN","B",8989.52,8989.52)

"BLD",6578,"KRN","B",8994,8994)

"BLD",6578,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",6578,"QUES",0)
^9.62^^
"BLD",6578,"REQB",0)
^9.611^4^4
"BLD",6578,"REQB",1,0)
SR*3.0*127^1
"BLD",6578,"REQB",2,0)
SR*3.0*142^1
"BLD",6578,"REQB",3,0)
SR*3.0*94^1
"BLD",6578,"REQB",4,0)
SR*3.0*104^1
"BLD",6578,"REQB","B","SR*3.0*104",4)

"BLD",6578,"REQB","B","SR*3.0*127",1)

"BLD",6578,"REQB","B","SR*3.0*142",2)

"BLD",6578,"REQB","B","SR*3.0*94",3)

"MBREQ")
0
"PKG",167,-1)
1^1
"PKG",167,0)
SURGERY^SR^SURGICAL DATA COLLECTION AND OPERATIONS SCHEDULING
"PKG",167,20,0)
^9.402P^^
"PKG",167,22,0)
^9.49I^1^1
"PKG",167,22,1,0)
3.0^2930624^2930811
"PKG",167,22,1,"PAH",1,0)
165^3090826^1611
"PKG",167,22,1,"PAH",1,1,0)
^^13^13^3090826
"PKG",167,22,1,"PAH",1,1,1,0)
This patch addresses the following problems:
"PKG",167,22,1,"PAH",1,1,2,0)
 
"PKG",167,22,1,"PAH",1,1,3,0)
1.  HD194156 - Input transform for CPT Modifier 51 in Surgery
"PKG",167,22,1,"PAH",1,1,4,0)
The Lexicon package has been working to update the CPT code ranges for 
"PKG",167,22,1,"PAH",1,1,5,0)
the CPT Modifier 51. Part of this update is to include all Surgical 
"PKG",167,22,1,"PAH",1,1,6,0)
Procedures with the exception of those listed in Appendix E of the CPT
"PKG",167,22,1,"PAH",1,1,7,0)
Manual.  During the analysis phase for this project, it was discovered 
"PKG",167,22,1,"PAH",1,1,8,0)
that this unique CPT Modifier carries with it the stipulation that it 
"PKG",167,22,1,"PAH",1,1,9,0)
can not be used in conjunction with the principal procedure.
"PKG",167,22,1,"PAH",1,1,10,0)
 
"PKG",167,22,1,"PAH",1,1,11,0)
2.  HD238998 - FGH - service block issue on 5th week of month
"PKG",167,22,1,"PAH",1,1,12,0)
When a monthly service block is set for a day in the 4th week, users are
"PKG",167,22,1,"PAH",1,1,13,0)
unable to set a service block for that day in the 5th week of a month.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
8
"RTN","SROMOD")
0^1^B38394892^B37665201
"RTN","SROMOD",1,0)
SROMOD ;BIR/ADM - CPT Modifier Input ; [ 02/27/01  6:32 AM ]
"RTN","SROMOD",2,0)
 ;;3.0; Surgery ;**88,100,127,165**;24 Jun 93;Build 6
"RTN","SROMOD",3,0)
 Q
"RTN","SROMOD",4,0)
DISPLAY ; display name with modifier
"RTN","SROMOD",5,0)
 N SRY,SRDA,SRDATE S SRDATE=DT
"RTN","SROMOD",6,0)
 S SRDA=$S($G(SRTN):SRTN,$D(DA(1)):DA(1),$D(DA):DA,1:"")
"RTN","SROMOD",7,0)
 I $G(SRDA) S SRDATE=$P($G(^SRF(SRDA,0)),"^",9)
"RTN","SROMOD",8,0)
 S SRY=$$MOD^ICPTMOD(Y,"I",SRDATE) Q:$P(SRY,"^")=-1
"RTN","SROMOD",9,0)
 S Y=$P(SRY,"^",2)_"  "_$P(SRY,"^",3)
"RTN","SROMOD",10,0)
 Q
"RTN","SROMOD",11,0)
SCR27() ; screen for acceptable CPT code/modifier pair for principal procedure
"RTN","SROMOD",12,0)
 N SRCODE,SRDA,SRCMOD,SROK,SRSDATE,SRZ D PCHK K SRM
"RTN","SROMOD",13,0)
 Q SROK
"RTN","SROMOD",14,0)
PCHK ; return value of modifier if acceptable for principal procedure
"RTN","SROMOD",15,0)
 N SRSDATE S SRSDATE=DT K ICPTVDT
"RTN","SROMOD",16,0)
 S SROK=0,SRCODE="",SRDA=$S($G(SRTN):SRTN,$D(DA(1)):DA(1),$D(DA):DA,1:""),SRM=$S($D(SRM):SRM,1:+Y)
"RTN","SROMOD",17,0)
 I SRDA S SRSDATE=$P(^SRF(SRDA,0),"^",9),SRCODE=$P($G(^SRF(SRDA,"OP")),"^",2)
"RTN","SROMOD",18,0)
 ;;Begin *165 - RJS
"RTN","SROMOD",19,0)
 I 'SRCODE!(X=51) Q
"RTN","SROMOD",20,0)
 ;; End *165 - RJS
"RTN","SROMOD",21,0)
 S SRZ=$P($$MODP^ICPTMOD(SRCODE,SRM,"I",SRSDATE),"^") I SRZ>0 S SROK=SRZ
"RTN","SROMOD",22,0)
 S ICPTVDT=SRSDATE
"RTN","SROMOD",23,0)
 Q
"RTN","SROMOD",24,0)
OTH() ; screen for acceptable CPT code/modifier pair for other procedure
"RTN","SROMOD",25,0)
 N SRCODE,SRDA,SRCMOD,SROK,SROTH,SRSDATE,SRZ D OCHK K SRM
"RTN","SROMOD",26,0)
 Q SROK
"RTN","SROMOD",27,0)
OCHK ; return value of modifier if acceptable for other procedure
"RTN","SROMOD",28,0)
 N SRSDATE S SRSDATE=DT K ICPTVDT
"RTN","SROMOD",29,0)
 S SROK=0,SRCODE="",SRDA=$S($G(SRTN):SRTN,$D(DA(2)):DA(2),$D(DA(1)):DA(1),$D(D0):D0,1:""),SROTH=$S($D(DA):DA,$D(D1):D1,1:""),SRM=$S($D(SRM):SRM,1:+Y)
"RTN","SROMOD",30,0)
 I SRDA&SROTH S SRSDATE=$P(^SRF(SRDA,0),"^",9),SRCODE=$P($G(^SRF(SRDA,13,SROTH,2)),"^")
"RTN","SROMOD",31,0)
 I 'SRCODE Q
"RTN","SROMOD",32,0)
 S SRZ=$P($$MODP^ICPTMOD(SRCODE,SRM,"I",SRSDATE),"^") I SRZ>0 S SROK=SRZ
"RTN","SROMOD",33,0)
 S ICPTVDT=SRSDATE
"RTN","SROMOD",34,0)
 Q
"RTN","SROMOD",35,0)
SPRIN ; set logic for ACPT x-ref
"RTN","SROMOD",36,0)
 Q:$E($G(IOST))'="C"!($G(DIK)'="")
"RTN","SROMOD",37,0)
 N SRCODE,SRDA,SRDEF,SRIEN,SRJ,SRQ,SRSDATE,SRSEL,SRSOUT,SRX,SRY,Z S (SRQ,SRSOUT)=0,SRCODE=X N X I $D(SRCMOD) D HYPH27
"RTN","SROMOD",38,0)
 S SRDA=DA,SRIEN=$O(^SRF(SRDA,"OPMOD","AAA"),-1) I SRIEN S SRX=$P(^SRF(SRDA,"OPMOD",SRIEN,0),"^"),SRCMOD=$P($$MOD^ICPTMOD(SRX,"I"),"^",2)
"RTN","SROMOD",39,0)
 K DIR F  D  K SRM,SRCMOD Q:SRSOUT  S SRQ=0
"RTN","SROMOD",40,0)
 .S DIR("A")=" Modifier: ",DIR(0)="130.028,.01AO" S:$G(SRCMOD)'="" DIR("B")=SRCMOD D:$O(^SRF(SRDA,"OPMOD",0)) QUES
"RTN","SROMOD",41,0)
 .D ^DIR K DIR S DA=SRDA I $D(DTOUT)!$D(DUOUT)!(X="") S SRSOUT=1 Q
"RTN","SROMOD",42,0)
 .I +Y S SRJ=0 F  S SRJ=$O(^SRF(SRDA,"OPMOD",SRJ)) Q:'SRJ  I $P(^SRF(SRDA,"OPMOD",SRJ,0),"^")=+Y N DIR D  Q
"RTN","SROMOD",43,0)
 ..S SRSEL=Y(0),DIR(0)="130.028,.01AO",DIR("A")="   Modifier: ",DIR("B")=$P(Y(0),"^")
"RTN","SROMOD",44,0)
 ..D ^DIR S DA=SRDA I $D(DTOUT)!$D(DUOUT)!(X="") S SRSOUT=1 Q
"RTN","SROMOD",45,0)
 ..I +Y S SRK=0 F  S SRK=$O(^SRF(SRDA,"OPMOD",SRK)) Q:'SRK  I $P(^SRF(SRDA,"OPMOD",SRK,0),"^")=+Y S SRQ=1 Q
"RTN","SROMOD",46,0)
 ..Q:SRQ  I +Y S $P(^SRF(SRDA,"OPMOD",SRJ,0),"^")=+Y,SRQ=1 Q
"RTN","SROMOD",47,0)
 ..I X="@" S SRY(130.028,SRJ_","_SRDA_",",.01)="@" D FILE^DIE("","SRY"),EN^DDIOL(" ... Modifier deleted","","?20") S SRQ=1
"RTN","SROMOD",48,0)
 .Q:SRQ!SRSOUT
"RTN","SROMOD",49,0)
 .I +Y S SRY(130.028,"+1,"_DA_",",.01)=+Y D UPDATE^DIE("","SRY") Q
"RTN","SROMOD",50,0)
 .I X="@",$D(SRCMOD) S SRY(130.028,SRIEN_","_SRDA_",",.01)="@" D FILE^DIE("","SRY"),EN^DDIOL(" ... Modifier deleted","","?20")
"RTN","SROMOD",51,0)
 Q
"RTN","SROMOD",52,0)
KPRIN ; kill logic for ACPT x-ref
"RTN","SROMOD",53,0)
 Q:$E($G(IOST))'="C"!($G(DIK)'="")  K ^SRF(DA,"OPMOD")
"RTN","SROMOD",54,0)
 Q
"RTN","SROMOD",55,0)
SOTH ; set logic for ACPT1 x-ref
"RTN","SROMOD",56,0)
 Q:$E($G(IOST))'="C"!($G(DIK)'="")
"RTN","SROMOD",57,0)
 N SRCODE,SRDA,SRDEF,SRIEN,SRJ,SRQ,SRSDATE,SRSEL,SRSOUT,SRX,SRY,Z S (SRQ,SRSOUT)=0,SRCODE=X N X I $D(SRCMOD) D HYPHOTH
"RTN","SROMOD",58,0)
 S SRDA=DA,SRDA(1)=DA(1),SRIEN=$O(^SRF(SRDA(1),13,SRDA,"MOD","A"),-1) I SRIEN S SRX=$P(^SRF(SRDA(1),13,SRDA,"MOD",SRIEN,0),"^"),SRCMOD=$P($$MOD^ICPTMOD(SRX,"I"),"^",2)
"RTN","SROMOD",59,0)
 K DIR F  D  K SRM,SRCMOD Q:SRSOUT  S SRQ=0
"RTN","SROMOD",60,0)
 .S DIR("A")=" Modifier: ",DIR(0)="130.164,.01AO" S:$G(SRCMOD)'="" DIR("B")=SRCMOD D:$O(^SRF(SRDA(1),13,SRDA,"MOD",0)) QUES1
"RTN","SROMOD",61,0)
 .D ^DIR K DIR S DA=SRDA,DA(1)=SRDA(1) I $D(DTOUT)!$D(DUOUT)!(X="") S SRSOUT=1 Q
"RTN","SROMOD",62,0)
 .I +Y S SRJ=0 F  S SRJ=$O(^SRF(SRDA(1),13,SRDA,"MOD",SRJ)) Q:'SRJ  I $P(^SRF(SRDA(1),13,SRDA,"MOD",SRJ,0),"^")=+Y N DIR D  Q
"RTN","SROMOD",63,0)
 ..S SRSEL=Y(0),DIR(0)="130.164,.01AO",DIR("A")="   Modifier: ",DIR("B")=$P(Y(0),"^")
"RTN","SROMOD",64,0)
 ..D ^DIR S DA=SRDA I $D(DTOUT)!$D(DUOUT)!(X="") S SRSOUT=1 Q
"RTN","SROMOD",65,0)
 ..I +Y S SRK=0 F  S SRK=$O(^SRF(SRDA(1),13,SRDA,"MOD",SRK)) Q:'SRK  I $P(^SRF(SRDA(1),13,SRDA,"MOD",SRK,0),"^")=+Y S Y="" Q
"RTN","SROMOD",66,0)
 ..I X="@" S SRY(130.164,SRJ_","_SRDA_","_SRDA(1)_",",.01)="@" D FILE^DIE("","SRY"),EN^DDIOL(" ... Modifier deleted","","?20") S SRQ=1
"RTN","SROMOD",67,0)
 .Q:SRQ!SRSOUT
"RTN","SROMOD",68,0)
 .I +Y S SRY(130.164,"+1,"_DA_","_DA(1)_",",.01)=+Y D UPDATE^DIE("","SRY") Q
"RTN","SROMOD",69,0)
 .I X="@",$D(SRCMOD) S SRY(130.164,SRIEN_","_SRDA_",",SRDA(1)_",",.01)="@" D FILE^DIE("","SRY"),EN^DDIOL(" ... Modifier deleted","","?20")
"RTN","SROMOD",70,0)
 Q
"RTN","SROMOD",71,0)
KOTH ; kill logic for ACPT1 x-ref
"RTN","SROMOD",72,0)
 Q:$E($G(IOST))'="C"!($G(DIK)'="")  K ^SRF(DA(1),13,DA,"MOD")
"RTN","SROMOD",73,0)
 Q
"RTN","SROMOD",74,0)
HYPH27 ; input CPT hyphenated modifier for principal procedure
"RTN","SROMOD",75,0)
 N SRCODE,SRDA,SRDUP,SRLIST,SRN,SROK,SRY S SRLIST=SRCMOD
"RTN","SROMOD",76,0)
 F SRN=1:1 S SRCMOD=$P(SRLIST,",",SRN) Q:SRCMOD=""  D
"RTN","SROMOD",77,0)
 .S (SRDUP,SROK)=0
"RTN","SROMOD",78,0)
 .S SRM=$P($$MOD^ICPTMOD(SRCMOD),"^") K:SRM<0 SRM I $D(SRM) D PCHK K SRM
"RTN","SROMOD",79,0)
 .I 'SROK D EN^DDIOL("CPT Modifier '"_SRCMOD_"' is not acceptable with this CPT code.","","!") K SRCMOD Q
"RTN","SROMOD",80,0)
 .S SRJ=0 F  S SRJ=$O(^SRF(SRDA,"OPMOD",SRJ)) Q:'SRJ  I $P(^SRF(SRDA,"OPMOD",SRJ,0),"^")=SROK S SRDUP=1 Q
"RTN","SROMOD",81,0)
 .I 'SRDUP S SRY(130.028,"+1,"_DA_",",.01)=SROK D UPDATE^DIE("","SRY")
"RTN","SROMOD",82,0)
 Q
"RTN","SROMOD",83,0)
HYPHOTH ; input CPT hyphenated modifier for other procedure
"RTN","SROMOD",84,0)
 N SRCODE,SRDA,SRDUP,SRLIST,SRN,SROK,SROTH,SRY S SRLIST=SRCMOD
"RTN","SROMOD",85,0)
 F SRN=1:1 S SRCMOD=$P(SRLIST,",",SRN) Q:SRCMOD=""  D
"RTN","SROMOD",86,0)
 .S (SRDUP,SROK)=0
"RTN","SROMOD",87,0)
 .S SRM=$P($$MOD^ICPTMOD(SRCMOD),"^") K:SRM<0 SRM I $D(SRM) D OCHK K SRM
"RTN","SROMOD",88,0)
 .I 'SROK D EN^DDIOL("CPT Modifier '"_SRCMOD_"' is not acceptable with this CPT code.","","!") K SRCMOD Q
"RTN","SROMOD",89,0)
 .S SRJ=0 F  S SRJ=$O(^SRF(SRDA,13,SROTH,"MOD",SRJ)) Q:'SRJ  I $P(^SRF(SRDA,13,SROTH,"MOD",SRJ,0),"^")=SROK S SRDUP=1 Q
"RTN","SROMOD",90,0)
 .I 'SRDUP S SRY(130.164,"+1,"_DA_","_DA(1)_",",.01)=SROK D UPDATE^DIE("","SRY")
"RTN","SROMOD",91,0)
 Q
"RTN","SROMOD",92,0)
QUES N SRI,SRMD,SRX,SRY,SRZ S DIR("?",1)=" Answer with PRIN. PROCEDURE CPT MODIFIER",DIR("?",2)="Choose from:"
"RTN","SROMOD",93,0)
 S SRI=0,SRCT=3 F  S SRI=$O(^SRF(SRDA,"OPMOD",SRI)) Q:'SRI  S SRMD=$P(^SRF(SRDA,"OPMOD",SRI,0),"^") D
"RTN","SROMOD",94,0)
 .S SRX=$$MOD^ICPTMOD(SRMD,"I",$P($G(^SRF(SRDA,0)),"^",9)),SRY=$P(SRX,"^",2),SRZ=$P(SRX,"^",3)
"RTN","SROMOD",95,0)
 .S DIR("?",SRCT)="   "_SRY_"   "_SRZ,SRCT=SRCT+1
"RTN","SROMOD",96,0)
 S DIR("?",SRCT)="",DIR("?")="     You may enter a new PRIN. PROCEDURE CPT MODIFIER, if you wish."
"RTN","SROMOD",97,0)
 Q
"RTN","SROMOD",98,0)
QUES1 N SRI,SRMD,SRX,SRY,SRZ S DIR("?",1)=" Answer with OTHER PROCEDURE CPT MODIFIER",DIR("?",2)="Choose from:"
"RTN","SROMOD",99,0)
 S SRI=0,SRCT=3 F  S SRI=$O(^SRF(SRDA(1),13,SRDA,"MOD",SRI)) Q:'SRI  S SRMD=$P(^SRF(SRDA(1),13,SRDA,"MOD",SRI,0),"^") D
"RTN","SROMOD",100,0)
 .S SRX=$$MOD^ICPTMOD(SRMD,"I",$P($G(^SRF(SRDA,0)),"^",9)),SRY=$P(SRX,"^",2),SRZ=$P(SRX,"^",3)
"RTN","SROMOD",101,0)
 .S DIR("?",SRCT)="   "_SRY_"   "_SRZ,SRCT=SRCT+1
"RTN","SROMOD",102,0)
 S DIR("?",SRCT)="",DIR("?")="     You may enter a new OTHER PROCEDURE CPT MODIFIER, if you wish."
"RTN","SROMOD",103,0)
 Q
"RTN","SROMOD",104,0)
  
"RTN","SROMOD0")
0^2^B42153492^B41364677
"RTN","SROMOD0",1,0)
SROMOD0 ;BIR/ADM - CPT MODIFIER INPUT ;08/01/05
"RTN","SROMOD0",2,0)
 ;;3.0; Surgery ;**142,165**;24 Jun 93;Build 6
"RTN","SROMOD0",3,0)
 Q
"RTN","SROMOD0",4,0)
DISPLAY ; display name with modifier
"RTN","SROMOD0",5,0)
 N SRY,SRDA,SRDATE S SRDATE=DT
"RTN","SROMOD0",6,0)
 S SRDA=$S($G(SRTN):SRTN,$D(DA(1)):DA(1),$D(DA):DA,1:"")
"RTN","SROMOD0",7,0)
 I $G(SRDA) S SRDATE=$P($G(^SRF(SRDA,0)),"^",9)
"RTN","SROMOD0",8,0)
 S SRY=$$MOD^ICPTMOD(Y,"I",SRDATE) Q:$P(SRY,"^")=-1
"RTN","SROMOD0",9,0)
 S Y=$P(SRY,"^",2)_"  "_$P(SRY,"^",3)
"RTN","SROMOD0",10,0)
 Q
"RTN","SROMOD0",11,0)
SCR27() ; screen for acceptable CPT code/modifier pair for principal procedure
"RTN","SROMOD0",12,0)
 N SRCODE,SRDA,SRCMOD,SROK,SRSDATE,SRZ D PCHK K SRM
"RTN","SROMOD0",13,0)
 Q SROK
"RTN","SROMOD0",14,0)
PCHK ; return value of modifier if acceptable for principal procedure
"RTN","SROMOD0",15,0)
 N SRSDATE S SRSDATE=DT
"RTN","SROMOD0",16,0)
 S SROK=0,SRCODE="",SRDA=$S($G(SRTN):SRTN,$D(DA(1)):DA(1),$D(DA):DA,1:""),SRM=$S($D(SRM):SRM,1:+Y)
"RTN","SROMOD0",17,0)
 I SRDA S SRSDATE=$P(^SRF(SRDA,0),"^",9),SRCODE=$P($G(^SRO(136,SRDA,0)),"^",2)
"RTN","SROMOD0",18,0)
 ;; Begin *165 - RJS
"RTN","SROMOD0",19,0)
 I 'SRCODE!(X=51) Q
"RTN","SROMOD0",20,0)
 ;;End *165 - RJS
"RTN","SROMOD0",21,0)
 S SRZ=$P($$MODP^ICPTMOD(SRCODE,SRM,"I",SRSDATE),"^") I SRZ>0 S SROK=SRZ
"RTN","SROMOD0",22,0)
 Q
"RTN","SROMOD0",23,0)
OTH() ; screen for acceptable CPT code/modifier pair for other procedure
"RTN","SROMOD0",24,0)
 N SRCODE,SRDA,SRCMOD,SROK,SROTH,SRSDATE,SRZ D OCHK K SRM
"RTN","SROMOD0",25,0)
 Q SROK
"RTN","SROMOD0",26,0)
OCHK ; return value of modifier if acceptable for other procedure
"RTN","SROMOD0",27,0)
 N SRSDATE S SRSDATE=DT
"RTN","SROMOD0",28,0)
 S SROK=0,SRCODE="",SRDA=$S($G(SRTN):SRTN,$D(DA(2)):DA(2),$D(DA(1)):DA(1),$D(D0):D0,1:""),SROTH=$S($D(DA):DA,$D(D1):D1,1:""),SRM=$S($D(SRM):SRM,1:+Y)
"RTN","SROMOD0",29,0)
 I SRDA&SROTH S SRSDATE=$P(^SRF(SRDA,0),"^",9),SRCODE=$P($G(^SRO(136,SRDA,3,SROTH,0)),"^")
"RTN","SROMOD0",30,0)
 I 'SRCODE Q
"RTN","SROMOD0",31,0)
 S SRZ=$P($$MODP^ICPTMOD(SRCODE,SRM,"I",SRSDATE),"^") I SRZ>0 S SROK=SRZ
"RTN","SROMOD0",32,0)
 Q
"RTN","SROMOD0",33,0)
PRIN ; enter CPT modifiers for principal CPT code
"RTN","SROMOD0",34,0)
 Q:$E($G(IOST),1,2)'="C-"!($G(DIK)'="")
"RTN","SROMOD0",35,0)
 N SRCODE,SRDA,SRDEF,SRIEN,SRJ,SRQ,SRSDATE,SRSEL,SRSOUT,SRX,SRY,Z
"RTN","SROMOD0",36,0)
 S (SRQ,SRSOUT)=0,SRDA=DA,SRCODE=$P(^SRO(136,SRDA,0),"^",2),SRIEN=$O(^SRO(136,SRDA,1,"AAA"),-1)
"RTN","SROMOD0",37,0)
 I SRIEN S SRX=$P(^SRO(136,SRDA,1,SRIEN,0),"^"),SRCMOD=$P($$MOD^ICPTMOD(SRX,"I"),"^",2)
"RTN","SROMOD0",38,0)
 K DIR F  D  K SRM,SRCMOD Q:SRSOUT  S SRQ=0
"RTN","SROMOD0",39,0)
 .S DIR("A")=" Modifier: ",DIR(0)="136.01,.01AO" S:$G(SRCMOD)'="" DIR("B")=SRCMOD D:$O(^SRO(136,SRDA,1,0)) QUES
"RTN","SROMOD0",40,0)
 .D ^DIR K DIR S DA=SRDA I $D(DTOUT)!$D(DUOUT)!(X="") S SRSOUT=1 Q
"RTN","SROMOD0",41,0)
 .I +Y S SRJ=0 F  S SRJ=$O(^SRO(136,SRDA,1,SRJ)) Q:'SRJ  I $P(^SRO(136,SRDA,1,SRJ,0),"^")=+Y N DIR D  Q
"RTN","SROMOD0",42,0)
 ..S SRSEL=Y(0),DIR(0)="136.01,.01AO",DIR("A")="   Modifier: ",DIR("B")=$P(Y(0),"^")
"RTN","SROMOD0",43,0)
 ..D ^DIR S DA=SRDA I $D(DTOUT)!$D(DUOUT)!(X="") S SRSOUT=1 Q
"RTN","SROMOD0",44,0)
 ..I +Y S SRK=0 F  S SRK=$O(^SRO(136,SRDA,1,SRK)) Q:'SRK  I $P(^SRO(136,SRDA,1,SRK,0),"^")=+Y S SRQ=1 Q
"RTN","SROMOD0",45,0)
 ..Q:SRQ  I +Y S $P(^SRO(136,SRDA,1,SRJ,0),"^")=+Y,SRQ=1 Q
"RTN","SROMOD0",46,0)
 ..I X="@" S SRY(136.01,SRJ_","_SRDA_",",.01)="@" D FILE^DIE("","SRY"),EN^DDIOL(" ... Modifier deleted","","?20") S SRQ=1
"RTN","SROMOD0",47,0)
 .Q:SRQ!SRSOUT
"RTN","SROMOD0",48,0)
 .I +Y S SRY(136.01,"+1,"_DA_",",.01)=+Y D UPDATE^DIE("","SRY") Q
"RTN","SROMOD0",49,0)
 .I X="@",$D(SRCMOD) S SRY(136.01,SRIEN_","_SRDA_",",.01)="@" D FILE^DIE("","SRY"),EN^DDIOL(" ... Modifier deleted","","?20")
"RTN","SROMOD0",50,0)
 Q
"RTN","SROMOD0",51,0)
OPROC ; enter CPT modifiers for other CPT code
"RTN","SROMOD0",52,0)
 N SRCODE,SRDA,SRDEF,SRIEN,SRJ,SRQ,SRSDATE,SRSEL,SRSOUT,SRX,SRY,Z S (SRQ,SRSOUT)=0,SRCODE=X N X I $D(SRCMOD) D OHYPH
"RTN","SROMOD0",53,0)
 S SRDA=DA,SRDA(1)=DA(1),SRIEN=$O(^SRO(136,SRDA(1),3,SRDA,1,"A"),-1) I SRIEN S SRX=$P(^SRO(136,SRDA(1),3,SRDA,1,SRIEN,0),"^"),SRCMOD=$P($$MOD^ICPTMOD(SRX,"I"),"^",2)
"RTN","SROMOD0",54,0)
 K DIR F  D  K SRM,SRCMOD Q:SRSOUT  S SRQ=0
"RTN","SROMOD0",55,0)
 .S DIR("A")=" Modifier: ",DIR(0)="136.31,.01AO" S:$G(SRCMOD)'="" DIR("B")=SRCMOD D:$O(^SRO(136,SRDA(1),3,SRDA,1,0)) QUES1
"RTN","SROMOD0",56,0)
 .D ^DIR K DIR S DA=SRDA,DA(1)=SRDA(1) I $D(DTOUT)!$D(DUOUT)!(X="") S SRSOUT=1 Q
"RTN","SROMOD0",57,0)
 .I +Y S SRJ=0 F  S SRJ=$O(^SRO(136,SRDA(1),3,SRDA,1,SRJ)) Q:'SRJ  I $P(^SRO(136,SRDA(1),3,SRDA,1,SRJ,0),"^")=+Y N DIR D  Q
"RTN","SROMOD0",58,0)
 ..S SRSEL=Y(0),DIR(0)="136.31,.01AO",DIR("A")="   Modifier: ",DIR("B")=$P(Y(0),"^")
"RTN","SROMOD0",59,0)
 ..D ^DIR S DA=SRDA I $D(DTOUT)!$D(DUOUT)!(X="") S SRSOUT=1 Q
"RTN","SROMOD0",60,0)
 ..I +Y S SRK=0 F  S SRK=$O(^SRO(136,SRDA(1),3,SRDA,1,SRK)) Q:'SRK  I $P(^SRO(136,SRDA(1),3,SRDA,1,SRK,0),"^")=+Y S Y="" Q
"RTN","SROMOD0",61,0)
 ..I X="@" S SRY(136.31,SRJ_","_SRDA_","_SRDA(1)_",",.01)="@" D FILE^DIE("","SRY"),EN^DDIOL(" ... Modifier deleted","","?20") S SRQ=1
"RTN","SROMOD0",62,0)
 .Q:SRQ!SRSOUT
"RTN","SROMOD0",63,0)
 .I +Y S SRY(136.31,"+1,"_DA_","_DA(1)_",",.01)=+Y D UPDATE^DIE("","SRY") Q
"RTN","SROMOD0",64,0)
 .I X="@",$D(SRCMOD) S SRY(136.31,SRIEN_","_SRDA_",",SRDA(1)_",",.01)="@" D FILE^DIE("","SRY"),EN^DDIOL(" ... Modifier deleted","","?20")
"RTN","SROMOD0",65,0)
 Q
"RTN","SROMOD0",66,0)
KOMOD ; delete other CPT modifiers when CPT code is edited
"RTN","SROMOD0",67,0)
 I $D(SRDIRED) S SRDIRED=1 Q:'$D(DA)
"RTN","SROMOD0",68,0)
 N SRCODE,SRDA,SRJ,SRY S SRDA=$G(DA),SRDA(1)=$G(DA(1)) Q:'SRDA!'SRDA(1)
"RTN","SROMOD0",69,0)
 S SRCODE=X,SRJ=0 F  S SRJ=$O(^SRO(136,SRDA(1),3,SRDA,1,SRJ)) Q:'SRJ  D
"RTN","SROMOD0",70,0)
 .S SRY(136.31,SRJ_","_SRDA_","_SRDA(1)_",",.01)="@" D FILE^DIE("","SRY")
"RTN","SROMOD0",71,0)
 S X=SRCODE
"RTN","SROMOD0",72,0)
 Q
"RTN","SROMOD0",73,0)
PHYPH ; called from input transform to process hyphenated modifier list
"RTN","SROMOD0",74,0)
 Q:$E($G(IOST),1,2)'="C-"!($G(DIK)'="")
"RTN","SROMOD0",75,0)
 N SRSDATE,SRDA,SRDUP,SRJ,SRLIST,SRM,SRN,SROK,SRY,SRZ S SRCODE=X D KPMOD S X=SRCODE Q:'$D(SRCMOD)
"RTN","SROMOD0",76,0)
 S SRLIST=SRCMOD,SRSDATE=DT,SRDA=$S($G(SRTN):SRTN,$D(DA(1)):DA(1),$D(DA):DA,1:"")
"RTN","SROMOD0",77,0)
 S:SRDA SRSDATE=$P(^SRF(SRDA,0),"^",9)
"RTN","SROMOD0",78,0)
 F SRN=1:1 S SRCMOD=$P(SRLIST,",",SRN) Q:SRCMOD=""  D
"RTN","SROMOD0",79,0)
 .S (SRDUP,SROK)=0
"RTN","SROMOD0",80,0)
 .S SRM=$P($$MOD^ICPTMOD(SRCMOD),"^") K:SRM<0 SRM I $D(SRM) D  K SRM
"RTN","SROMOD0",81,0)
 ..S SROK=0,SRM=$S($D(SRM):SRM,1:+Y)
"RTN","SROMOD0",82,0)
 ..S SRZ=$P($$MODP^ICPTMOD(SRCODE,SRM,"I",SRSDATE),"^") I SRZ>0 S SROK=SRZ
"RTN","SROMOD0",83,0)
 .I 'SROK&($E($G(IOST),1,2)="C-") D EN^DDIOL("CPT Modifier '"_SRCMOD_"' is not acceptable with this CPT code.","","!") K SRCMOD Q
"RTN","SROMOD0",84,0)
 .S SRJ=0 F  S SRJ=$O(^SRO(136,SRDA,1,SRJ)) Q:'SRJ  I $P(^SRO(136,SRDA,1,SRJ,0),"^")=SROK S SRDUP=1 Q
"RTN","SROMOD0",85,0)
 .I 'SRDUP S SRY(136.01,"+1,"_DA_",",.01)=SROK D UPDATE^DIE("","SRY")
"RTN","SROMOD0",86,0)
 S X=SRCODE
"RTN","SROMOD0",87,0)
 Q
"RTN","SROMOD0",88,0)
KPMOD ; delete principal CPT modifiers when CPT code is edited
"RTN","SROMOD0",89,0)
 N SRDA,SRJ,SRY
"RTN","SROMOD0",90,0)
 S SRDA=DA,SRJ=0 F  S SRJ=$O(^SRO(136,SRDA,1,SRJ)) Q:'SRJ  D
"RTN","SROMOD0",91,0)
 .S SRY(136.01,SRJ_","_SRDA_",",.01)="@" D FILE^DIE("","SRY")
"RTN","SROMOD0",92,0)
 Q
"RTN","SROMOD0",93,0)
OHYPH ; input CPT hyphenated modifier for other procedure
"RTN","SROMOD0",94,0)
 N SRCODE,SRDA,SRDUP,SRLIST,SRN,SROK,SROTH,SRY S SRLIST=SRCMOD
"RTN","SROMOD0",95,0)
 F SRN=1:1 S SRCMOD=$P(SRLIST,",",SRN) Q:SRCMOD=""  D
"RTN","SROMOD0",96,0)
 .S (SRDUP,SROK)=0
"RTN","SROMOD0",97,0)
 .S SRM=$P($$MOD^ICPTMOD(SRCMOD),"^") K:SRM<0 SRM I $D(SRM) D OCHK K SRM
"RTN","SROMOD0",98,0)
 .I 'SROK D EN^DDIOL("CPT Modifier '"_SRCMOD_"' is not acceptable with this CPT code.","","!") K SRCMOD Q
"RTN","SROMOD0",99,0)
 .S SRJ=0 F  S SRJ=$O(^SRO(136,SRDA,3,SROTH,1,SRJ)) Q:'SRJ  I $P(^SRO(136,SRDA,3,SROTH,1,SRJ,0),"^")=SROK S SRDUP=1 Q
"RTN","SROMOD0",100,0)
 .I 'SRDUP S SRY(136.31,"+1,"_DA_","_DA(1)_",",.01)=SROK D UPDATE^DIE("","SRY")
"RTN","SROMOD0",101,0)
 Q
"RTN","SROMOD0",102,0)
QUES N SRI,SRMD,SRX,SRY,SRZ S DIR("?",1)=" Answer with PRIN PROCEDURE CPT MODIFIER",DIR("?",2)="Choose from:"
"RTN","SROMOD0",103,0)
 S SRI=0,SRCT=3 F  S SRI=$O(^SRO(136,SRDA,1,SRI)) Q:'SRI  S SRMD=$P(^SRO(136,SRDA,1,SRI,0),"^") D
"RTN","SROMOD0",104,0)
 .S SRX=$$MOD^ICPTMOD(SRMD,"I",$P($G(^SRF(SRDA,0)),"^",9)),SRY=$P(SRX,"^",2),SRZ=$P(SRX,"^",3)
"RTN","SROMOD0",105,0)
 .S DIR("?",SRCT)="   "_SRY_"   "_SRZ,SRCT=SRCT+1
"RTN","SROMOD0",106,0)
 S DIR("?",SRCT)="",DIR("?")="     You may enter a new PRIN PROCEDURE CPT MODIFIER, if you wish."
"RTN","SROMOD0",107,0)
 Q
"RTN","SROMOD0",108,0)
QUES1 N SRI,SRMD,SRX,SRY,SRZ S DIR("?",1)=" Answer with OTHER PROCEDURE CPT MODIFIER",DIR("?",2)="Choose from:"
"RTN","SROMOD0",109,0)
 S SRI=0,SRCT=3 F  S SRI=$O(^SRO(136,SRDA(1),3,SRDA,1,SRI)) Q:'SRI  S SRMD=$P(^SRO(136,SRDA(1),3,SRDA,1,SRI,0),"^") D
"RTN","SROMOD0",110,0)
 .S SRX=$$MOD^ICPTMOD(SRMD,"I",$P($G(^SRF(SRDA,0)),"^",9)),SRY=$P(SRX,"^",2),SRZ=$P(SRX,"^",3)
"RTN","SROMOD0",111,0)
 .S DIR("?",SRCT)="   "_SRY_"   "_SRZ,SRCT=SRCT+1
"RTN","SROMOD0",112,0)
 S DIR("?",SRCT)="",DIR("?")="     You may enter a new OTHER PROCEDURE CPT MODIFIER, if you wish."
"RTN","SROMOD0",113,0)
 Q
"RTN","SROMOD0",114,0)
  
"RTN","SRSAVL")
0^9^B22424982^B22195624
"RTN","SRSAVL",1,0)
SRSAVL ;B'HAM ISC/MAM - DISPLAY AVAILABILITY ; [ 09/22/98  11:36 AM ]
"RTN","SRSAVL",2,0)
 ;;3.0; Surgery ;**77,50,165**;24 Jun 93;Build 6
"RTN","SRSAVL",3,0)
START K SRSDATE S SRSOUT=0,SRBPRG=1 D CURRENT^SRSBUTL
"RTN","SRSAVL",4,0)
 S X="IOPTCH10;IOPTCH16" D ENDR^%ZISS S SR10=IOPTCH10,SR16=IOPTCH16 D KILL^%ZISS
"RTN","SRSAVL",5,0)
 W @IOF,!,"Do you want to view all Operating Rooms on one day ?  YES //  " R SRYN:DTIME I '$T!(SRYN["^") S SRSOUT=1 G END
"RTN","SRSAVL",6,0)
 S SRYN=$E(SRYN) S:SRYN="" SRYN="Y"
"RTN","SRSAVL",7,0)
 I "YyNn"'[SRYN W !!,"Enter RETURN if you want to view the availabilty of all operating rooms for a",!,"particular date, or 'NO' to view the availability of one specific operating",!,"room over a two week period."
"RTN","SRSAVL",8,0)
 I "YyNn"'[SRYN W !!,"Press RETURN to continue  " R X:DTIME G START
"RTN","SRSAVL",9,0)
 I "Yy"[SRYN D REQ G:SRSOUT END D:SREQ ^SRSAVL1 G END
"RTN","SRSAVL",10,0)
 W !! K %DT S %DT="AEFX",%DT("A")="Begin Display on which Date ?  " D ^%DT I Y<0 S SRSOUT=1 G END
"RTN","SRSAVL",11,0)
 S SRSDATE=+Y,SR1DAY=1
"RTN","SRSAVL",12,0)
 W !! K DIC S DIC="^SRS(",DIC(0)="QEAMZ",DIC("S")="I $$ORDIV^SROUTL0(+Y,$G(SRSITE(""DIV""))),('$P(^(0),""^"",6))" D ^DIC I Y<0 S SRSOUT=1 G END
"RTN","SRSAVL",13,0)
 S SROR=+Y,SROOM=$P(Y(0),"^"),SROOM=$P(^SC(SROOM,0),"^") I SR16="" D ^SRSDIS1 G END
"RTN","SRSAVL",14,0)
 S IOP=IO_";132",%ZIS="" D ^%ZIS W SR16
"RTN","SRSAVL",15,0)
 W @IOF,!,"Operating Room: "_SROOM,!!,"  DATE   12    1    2    3    4    5    6    7    8    9   10   11   12   13   14   15   16   17   18   19   20   21   22   23   24"
"RTN","SRSAVL",16,0)
 S SRDT=SRSDATE F SRDAZE=0:1:14 S X1=SRDT,X2=SRDAZE D C^%DTC S SRSDATE=X,SRDATE=$E(X,4,5)_"-"_$E(X,6,7)_"-"_$E(X,2,3)_"  " D LINE
"RTN","SRSAVL",17,0)
END I 'SRSOUT W !!,"Press RETURN to continue  " R X:DTIME
"RTN","SRSAVL",18,0)
 S IOP=IO_";80",%ZIS="" D ^%ZIS W SR10 W @IOF K SRTN,SRBFLG,SRBSER1,SRBPRG D ^SRSKILL
"RTN","SRSAVL",19,0)
 Q
"RTN","SRSAVL",20,0)
REQ ; list requests ?
"RTN","SRSAVL",21,0)
 S SREQ=0 W !!,"Do you want to list requests also ?  NO//  " R SRYN:DTIME I '$T!(SRYN["^") S SRSOUT=1 Q
"RTN","SRSAVL",22,0)
 S SRYN=$E(SRYN) S:SRYN="" SRYN="N"
"RTN","SRSAVL",23,0)
 I "YyNn"'[SRYN W !!,"Enter RETURN if you only want to view the availability of operating",!,"rooms, or 'YES' to also list requested cases for the date selected.",! G REQ
"RTN","SRSAVL",24,0)
 I "Yy"[SRYN S SREQ=1
"RTN","SRSAVL",25,0)
 K SR1DAY I '$D(SRSDATE) W ! K %DT S %DT="AEFX",%DT("A")="Display Operating Room Availability for which Date ?  " D ^%DT S:+Y SRSDATE=+Y I Y<0 S SRSOUT=1 Q
"RTN","SRSAVL",26,0)
 I SR16="" D ^SRSDISP Q
"RTN","SRSAVL",27,0)
 S IOP=IO_";132",%ZIS="" D ^%ZIS W SR16
"RTN","SRSAVL",28,0)
 W @IOF,!!,"ROOM    12   1    2    3    4    5    6    7    8    9    10   11   12   13   14   15   16   17   18   19   20   21   22   23   24"
"RTN","SRSAVL",29,0)
 S SROR=0 F  S SROR=$O(^SRS(SROR)) Q:'SROR  I '$P(^(SROR,0),"^",6) D:$$ORDIV^SROUTL0(SROR,SRSITE("DIV")) LINE
"RTN","SRSAVL",30,0)
 Q
"RTN","SRSAVL",31,0)
LINE I '$D(^SRS(SROR,"S",SRSDATE,1)) D GRAPH
"RTN","SRSAVL",32,0)
 S SROR1=$P(^SRS(SROR,0),"^"),SROR1=$P(^SC(SROR1,0),"^")
"RTN","SRSAVL",33,0)
 W !,$S($D(SR1DAY):SRDATE,1:$E(SROR1,1,6)),?8,$E(^SRS(SROR,"S",SRSDATE,1),11,200)
"RTN","SRSAVL",34,0)
 Q
"RTN","SRSAVL",35,0)
GRAPH ; set graph in ^SRS
"RTN","SRSAVL",36,0)
 S ^SRS(SROR,"S",SRSDATE,0)=SRSDATE,^SRS(SROR,"SS",SRSDATE,0)=SRSDATE
"RTN","SRSAVL",37,0)
 S ^SRS(SROR,"S",SRSDATE,1)=$E(SRSDATE,4,5)_"-"_$E(SRSDATE,6,7)_"-"_$E(SRSDATE,2,3)_"  |____|____|____|____|____|____|____|____|____|____|____|____|____|____|____|____|____|____|____|____|____|____|____|____|"
"RTN","SRSAVL",38,0)
 S ^SRS(SROR,"SS",SRSDATE,1)=^SRS(SROR,"S",SRSDATE,1)
"RTN","SRSAVL",39,0)
 S X1=SRSDATE,X2=2830103 D ^%DTC S SRDAY=$P("MO^TU^WE^TH^FR^SA^SU","^",X#7+1),X3=X#2+8 S X1=SRSDATE,X2=$E(SRSDATE,1,5)_"01" D ^%DTC S SRDY=X\7+1
"RTN","SRSAVL",40,0)
 S SRTIME=0 F I=0:0 S SRTIME=$O(^SRS("R",SRDAY,SROR,SRTIME)) Q:SRTIME=""  S NUMB="" F I=0:0 S NUMB=$O(^SRS("R",SRDAY,SROR,SRTIME,NUMB)) Q:NUMB=""  S SRXREF=^(NUMB),SRSDAY=$P(SRXREF,"^",2) S SRNUMB=$E(SRSDAY,3),FLAG=0 D CHNG
"RTN","SRSAVL",41,0)
 Q
"RTN","SRSAVL",42,0)
CHNG ; change graph
"RTN","SRSAVL",43,0)
 I SRSDAY[SRDAY,SRDY=4,SRNUMB=5 S X1=SRSDATE,X2=7,X5=$E(SRSDATE,4,5) D C^%DTC I $E(X,4,5)'=X5 S FLAG=1
"RTN","SRSAVL",44,0)
 I 'FLAG,SRSDAY[SRDAY,(SRNUMB=0!(SRNUMB=SRDY))!(SRNUMB=X3) S FLAG=1
"RTN","SRSAVL",45,0)
 I 'FLAG Q
"RTN","SRSAVL",46,0)
 S SRST=$P(SRXREF,"^",3),SRET=$P(SRXREF,"^",4),SERV=$P(SRXREF,"^",5),P=""
"RTN","SRSAVL",47,0)
 S SRX1=11+((SRST\1)*5)+(SRST-(SRST\1)*100\15),SRX2=11+((SRET\1)*5)+(SRET-(SRET\1)*100\15)
"RTN","SRSAVL",48,0)
 F X=SRX1:1:SRX2-1 S P=P_$S('(X#5):"|",$E(SERV,X#5)'="":$E(SERV,X#5),1:".")
"RTN","SRSAVL",49,0)
 S X1=^SRS(SROR,"S",SRSDATE,1),^(1)=$E(X1,1,SRX1)_P_$E(X1,SRX2+1,200),^SRS(SROR,"SS",SRSDATE,1)=^(1),^SRS(SROR,"S",SRSDATE,0)=SRSDATE,^SRS(SROR,"SS",SRSDATE,0)=SRSDATE Q
"RTN","SRSAVL",50,0)
 Q 
"RTN","SRSBDEL")
0^3^B24873371^B23194774
"RTN","SRSBDEL",1,0)
SRSBDEL ;B'HAM ISC/MAM - DELETE SERVICE BLOCKOUT ; [ 01/08/98   9:54 AM ]
"RTN","SRSBDEL",2,0)
 ;;3.0; Surgery ;**26,77,104,165**;24 Jun 93;Build 6
"RTN","SRSBDEL",3,0)
SER ; service abbreviation
"RTN","SRSBDEL",4,0)
 S SRBPRG=1 D CURRENT^SRSBUTL
"RTN","SRSBDEL",5,0)
 S SRSOUT=0
"RTN","SRSBDEL",6,0)
 R !!,"Select service you wish to delete. (3-4 characters)  ",SRSSER:DTIME I '$T!("^"[SRSSER) S SRSOUT=1 G END
"RTN","SRSBDEL",7,0)
 I SRSSER["?"!(SRSSER["=") D QUES G SER
"RTN","SRSBDEL",8,0)
 F SRMM=1:1:$L(SRSSER) I $E(SRSSER,SRMM)?1U S SRSSER=$E(SRSSER,0,SRMM-1)_$C($A(SRSSER,SRMM)+32)_$E(SRSSER,SRMM+1,999)
"RTN","SRSBDEL",9,0)
 I '$D(^SRS("SER",SRSSER)) W !!!,SRSSER_" does not exist.",! G SER
"RTN","SRSBDEL",10,0)
 S (OR,CNT)=0 F I=0:0 S OR=$O(^SRS("SER",SRSSER,OR)) Q:OR=""  D
"RTN","SRSBDEL",11,0)
 .I $D(SRSITE("DIV")) Q:'($$ORDIV^SROUTL0(OR,SRSITE("DIV"))) 
"RTN","SRSBDEL",12,0)
 .S SRSOR=$P(^SC($P(^SRS(OR,0),"^"),0),"^") S DAY=0 F I=0:0 S DAY=$O(^SRS("SER",SRSSER,OR,DAY)) Q:DAY=""  D TIME
"RTN","SRSBDEL",13,0)
 W !!!,"The service '"_SRSSER_"' has the following time(s) scheduled: " F I=1:1:CNT W !,?2,$P(SRSOR(I),"^")
"RTN","SRSBDEL",14,0)
NUM R !!!,"Which number would you like to delete ?  ",NUM:DTIME I '$T!("^"[NUM) S SRSOUT=1 G END
"RTN","SRSBDEL",15,0)
 I NUM<1!(NUM>CNT)!(NUM'?.N) W !!,"Enter a number from 1 to "_CNT_", or '^' to leave this option.",! G NUM
"RTN","SRSBDEL",16,0)
STDATE S SRSOR=$P(SRSOR(NUM),"^",2),DAY=$P(SRSOR(NUM),"^",3),SRSST=$P(SRSOR(NUM),"^",4),SRSET=$P(SRSOR(NUM),"^",5)
"RTN","SRSBDEL",17,0)
DATE W ! S %DT("A")="Delete the Blockout starting with which date ?  ",%DT="AEFX" D ^%DT W:Y<1 !!,"No action taken.",! G:Y<1 END S (X,SRSDATE)=Y D DW^%DTC S DAYOFW=X
"RTN","SRSBDEL",18,0)
 I SRSDATE<DT W !!,"Past dates cannot be entered.",! G DATE
"RTN","SRSBDEL",19,0)
 I $E(DAYOFW,1,2)'=DAY W !!,"The date you entered is not a " D DAY W DAY2_".",!! G STDATE
"RTN","SRSBDEL",20,0)
 D DAYCHK^SRSBD1 I SRCHK=1 W !!,"The service '"_SRSSER_"' is not scheduled for this date at the time period you",!,"have entered.  The option 'Display Availability' may be used to determine",!,"the proper date." H 4 G END
"RTN","SRSBDEL",21,0)
 S SRSNUM=$P(^SRS("SER",SRSSER,SRSOR,DAY,SRSST),"^",4)
"RTN","SRSBDEL",22,0)
ASK W !!,"Do you want to delete the blockout for this service on this",!,"date only ?  NO// " R Z:DTIME I '$T!(Z="^") G END
"RTN","SRSBDEL",23,0)
 S:Z="" Z="N" S Z=$E(Z)
"RTN","SRSBDEL",24,0)
 I "NnYy"'[Z W !!,"If you only want to delete the blockout for this date, enter 'YES'.  Enter",!,"RETURN to delete the blockout from this date on." G ASK
"RTN","SRSBDEL",25,0)
 W !!,"Updating Schedules...",!! S SRSALL=$S("Nn"[Z:1,1:0) I SRSALL=1 G MULD
"RTN","SRSBDEL",26,0)
DEL D:'SRSALL MULD
"RTN","SRSBDEL",27,0)
 Q:^SRS(SRSOR,"S",SRSDATE,1)'[SRBCKH
"RTN","SRSBDEL",28,0)
 S SRS1=11+($P(SRSST,".")*5)+(SRSST-$P(SRSST,".")*100\15),SRS2=11+($P(SRSET,".")*5)+(SRSET-$P(SRSET,".")*100\15),S="" F I=SRS1:1:SRS2-1 S S=S_$S('(I#5):"|",1:"_")
"RTN","SRSBDEL",29,0)
 S X0=^SRS(SRSOR,"SS",SRSDATE,1),(X0,^(1))=$E(X0,1,SRS1)_S_$E(X0,SRS2+1,200)
"RTN","SRSBDEL",30,0)
 S X1=^SRS(SRSOR,"S",SRSDATE,1)
"RTN","SRSBDEL",31,0)
 F I=SRS1:1:SRS2+1 I $E(X1,I)'="X" S X1=$E(X1,1,I-1)_$E(X0,I)_$E(X1,I+1,200)
"RTN","SRSBDEL",32,0)
 S ^SRS(SRSOR,"S",SRSDATE,1)=X1
"RTN","SRSBDEL",33,0)
 G:'SRSALL END Q
"RTN","SRSBDEL",34,0)
DAY S DAY2=$S(DAY="MO":"Monday",DAY="TU":"Tuesday",DAY="WE":"Wednesday",DAY="TH":"Thursday",DAY="FR":"Friday",DAY="SA":"Saturday",1:"Sunday")
"RTN","SRSBDEL",35,0)
 Q
"RTN","SRSBDEL",36,0)
CK1 I SRSNUM=0 S X=7 D UPDATE G:X CK1
"RTN","SRSBDEL",37,0)
CK2 I SRSNUM>7 S X=14 D UPDATE G:X CK2
"RTN","SRSBDEL",38,0)
CK0 I SRSNUM>0,(SRSNUM<5) S X5=$E(SRSDATE,4,5),X1=SRSDATE,X2=7 D C^%DTC S SRSDATE=X G:$E(X,4,5)=X5 CK0
"RTN","SRSBDEL",39,0)
CK3 I SRSNUM>0,(SRSNUM<5) S X=SRSNUM-1*7 D UPDATE G:X CK0
"RTN","SRSBDEL",40,0)
CK5 I SRSNUM=5 S X1=SRSDATE,X2=21 D C^%DTC S SRSDATE=X
"RTN","SRSBDEL",41,0)
CK4 I SRSNUM=5 S X1=SRSDATE,X2=7,X5=$E(SRSDATE,4,5) D C^%DTC S SRSDATE=X G:$E(SRSDATE,4,5)=X5 CK4 S X=-7 D UPDATE G:X CK5
"RTN","SRSBDEL",42,0)
 Q
"RTN","SRSBDEL",43,0)
UPDATE S X1=SRSDATE,X2=X D C^%DTC S SRSDATE=X D:$D(^SRS(SRSOR,"S",SRSDATE)) DEL S X=1 S:$O(^SRS(SRSOR,"S",SRSDATE))="" X=0 Q
"RTN","SRSBDEL",44,0)
TIME S TIME=0 F I=0:0 S TIME=$O(^SRS("SER",SRSSER,OR,DAY,TIME)) Q:TIME=""  S CNT=CNT+1,ETIME=$P(^(TIME),"^",2) D DAY S SRSOR(CNT)=CNT_".  "_SRSOR_" on "_DAY2_" from "_TIME_" to "_ETIME_"^"_OR_"^"_DAY_"^"_TIME_"^"_ETIME
"RTN","SRSBDEL",45,0)
 Q
"RTN","SRSBDEL",46,0)
MULD ; delete all
"RTN","SRSBDEL",47,0)
 S S="" F I=SRX1:1:SRX2-1 S S=S_$S('(I#5):"|",$E(SRSSER,I#5)'="":$E(SRSSER,I#5),1:".")
"RTN","SRSBDEL",48,0)
 S SRBCKH=S
"RTN","SRSBDEL",49,0)
 Q:'SRSALL
"RTN","SRSBDEL",50,0)
 S X=0 D UPDATE,DELCHK^SRSBUTL(DAY),CK1 S DA(3)=SRSOR,DA(2)=$O(^SRS(DA(3),1,"B",DAY,0)),DA(1)=$O(^SRS(DA(3),1,DA(2),1,"B",SRSSER,0)),DA=$O(^SRS(DA(3),1,DA(2),1,DA(1),1,"B",SRSST,0))
"RTN","SRSBDEL",51,0)
 S DIK="^SRS("_DA(3)_",1,"_DA(2)_",1,"_DA(1)_",1," D ^DIK
"RTN","SRSBDEL",52,0)
 I '$O(^SRS(DA(3),1,DA(2),1,DA(1),1,0)) S DA=DA(1),DA(1)=DA(2),DA(2)=DA(3) K DA(3) S DIK="^SRS("_DA(2)_",1,"_DA(1)_",1," D ^DIK I '$O(^SRS(DA(2),1,DA(1),1,0)) S DA=DA(1),DA(1)=DA(2) S DIK="^SRS("_DA(1)_",1," D ^DIK
"RTN","SRSBDEL",53,0)
 K ^SRS("R",DAY,SRSOR,SRSST,SRSNUM),^SRS("SER",SRSSER,SRSOR,DAY,SRSST)
"RTN","SRSBDEL",54,0)
END I 'SRSOUT W !!,"Press RETURN to continue  " R X:DTIME
"RTN","SRSBDEL",55,0)
 D ^SRSKILL K SRBCKH,SRBPRG W @IOF
"RTN","SRSBDEL",56,0)
 Q
"RTN","SRSBDEL",57,0)
QUES W !!,"Choose from: " S SERV=0 F I=0:0 S SERV=$O(^SRS("C",SERV)) Q:SERV=""  W !,?5,SERV
"RTN","SRSBDEL",58,0)
 Q
"RTN","SRSBOUT")
0^5^B34635928^B27445011
"RTN","SRSBOUT",1,0)
SRSBOUT ;B'HAM ISC/MAM - BLOCK OUT TIME ON OR SCHEDULE ; [ 09/22/98  11:36 AM ]
"RTN","SRSBOUT",2,0)
 ;;3.0; Surgery ;**77,50,165**;24 Jun 93;Build 6
"RTN","SRSBOUT",3,0)
CNG S SRS1=$P(^SRS("R",SRSDAY,SRSOR,I,J),"^",3),EN1=$P(^(J),"^",4),SRS2=SRSST,EN2=SRSET
"RTN","SRSBOUT",4,0)
 I (SRS1'<SRS2)&(SRS1<EN2)!((EN1>SRS2)&(EN1'>EN2))!((SRS2'<SRS1)&(SRS2<EN1)) I J=0!(SRSNUM=0)!((J<8)&(SRSNUM>5))!((J>5)&(SRSNUM<8))!(SRSNUM=J)!(((J=4)!(J=5)&(SRSNUM=4)!(SRSNUM=5))) D INT
"RTN","SRSBOUT",5,0)
 Q
"RTN","SRSBOUT",6,0)
INT ; collision with service at the same time
"RTN","SRSBOUT",7,0)
 S SRSSER1=^SRS("R",SRSDAY,SRSOR,I,J),STIME=$P(SRSSER1,"^",3),ETIME=$P(SRSSER1,"^",4),STIME=$E(STIME,1,2)_":"_$E(STIME,4,5),ETIME=$E(ETIME,1,2)_":"_$E(ETIME,4,5)
"RTN","SRSBOUT",8,0)
 S SRSBANG=1 W !!,"Time collision with '"_$P(SRSSER1,"^",5)_"' which has reservations from "_STIME_" to "_ETIME_".",!
"RTN","SRSBOUT",9,0)
 ;;>>BEGIN 3*165-RJS
"RTN","SRSBOUT",10,0)
 W:$G(SRBCHK(SRSDATE)) "The start date entered is not available for your ",SRSSER," Service Block.",!
"RTN","SRSBOUT",11,0)
 W !,"I will search for available openings.  Please wait."
"RTN","SRSBOUT",12,0)
 N SRSDT S SRSDT=0 F  S SRSDT=$O(SRBCHK(SRSDT)) Q:'SRSDT  D
"RTN","SRSBOUT",13,0)
 .I $G(SRBCHK(SRSDT)) W !,?5,$E(SRSDT,4,5),"-",$E(SRSDT,6,7),"-",$E(SRSDT,2,3)," is not available"
"RTN","SRSBOUT",14,0)
 .I '$G(SRBCHK(SRSDT)) W !,?5,$E(SRSDT,4,5),"-",$E(SRSDT,6,7),"-",$E(SRSDT,2,3)," is available"
"RTN","SRSBOUT",15,0)
 N DIR,Y S DIR(0)="Y",DIR("B")="YES",DIR("A")="Do you want to use the available dates" D ^DIR Q:Y
"RTN","SRSBOUT",16,0)
 S SRBFLG=1 W !!,"Your Service Block has not been set."  ;;<<END 3*165-RJS
"RTN","SRSBOUT",17,0)
 Q
"RTN","SRSBOUT",18,0)
S ; set up ^SRS
"RTN","SRSBOUT",19,0)
 S ^SRS(SRSOR,"S",SRSDATE,1)=$E(SRSDATE,4,5)_"-"_$E(SRSDATE,6,7)_"-"_$E(SRSDATE,2,3)_"  |____|____|____|____|____|____|____|____|____|____|____|____|____|____|____|____|____|____|____|____|____|____|____|____|"
"RTN","SRSBOUT",20,0)
 S ^SRS(SRSOR,"S",SRSDATE,0)=SRSDATE
"RTN","SRSBOUT",21,0)
 I '$D(^SRS(SRSOR,"SS",SRSDATE,1)) S ^SRS(SRSOR,"SS",SRSDATE,1)=^SRS(SRSOR,"S",SRSDATE,1),^SRS(SRSOR,"SS",SRSDATE,0)=SRSDATE
"RTN","SRSBOUT",22,0)
 Q
"RTN","SRSBOUT",23,0)
END W !!,"Press RETURN to continue  " R X:DTIME
"RTN","SRSBOUT",24,0)
 K SRBCHK,SRBFLG,SRBPRG,^TMP($J) ;; 3*165-RJS  CLEANUP
"RTN","SRSBOUT",25,0)
 D ^SRSKILL W @IOF
"RTN","SRSBOUT",26,0)
 Q
"RTN","SRSBOUT",27,0)
MNTH ; one day each month
"RTN","SRSBOUT",28,0)
 R !!,"Every month, last week of the month ? NO//  ",Z1:DTIME I '$T!(Z1["^") S SRSOUT=1 Q
"RTN","SRSBOUT",29,0)
 S Z1=$E(Z1) S:Z1="" Z1="N" S:$E(Z1)="y" Z1="Y" S:Z1["Y" Z=7
"RTN","SRSBOUT",30,0)
 I "YyNn"'[Z1 W !!,"If this blockout should appear on the same day every month, on the last",!,"week of that month, enter 'YES'.  Otherwise, enter RETURN." G MNTH
"RTN","SRSBOUT",31,0)
 Q
"RTN","SRSBOUT",32,0)
SER ; select service
"RTN","SRSBOUT",33,0)
 S SRBPRG=1 D CURRENT^SRSBUTL
"RTN","SRSBOUT",34,0)
 R !!,"For what service ? (3-4 characters, do not use 'X' or '=')  ",SRSSER:DTIME I '$T!(SRSSER["^") G END
"RTN","SRSBOUT",35,0)
 I SRSSER="" G END
"RTN","SRSBOUT",36,0)
 I SRSSER["=" W !!,"You service abbreviation cannot include the equal sign." G SER
"RTN","SRSBOUT",37,0)
 I SRSSER'?3.4A W !!!,"Enter a 3 to 4 letter abbreviation for the service, i.e. card, gen, gi.",!! G SER
"RTN","SRSBOUT",38,0)
 I SRSSER["X"!(SRSSER["x") W !!,"Your service abbreviation cannot include the letter 'X'." G SER
"RTN","SRSBOUT",39,0)
 I $L(SRSSER)<3!($L(SRSSER)>4) W !!,"Abbreviation must be 3 to 4 characters. " G SER
"RTN","SRSBOUT",40,0)
 F SRMM=1:1:$L(SRSSER) I $E(SRSSER,SRMM)?1U S SRSSER=$E(SRSSER,0,SRMM-1)_$C($A(SRSSER,SRMM)+32)_$E(SRSSER,SRMM+1,999)
"RTN","SRSBOUT",41,0)
ROOM ; select operating room
"RTN","SRSBOUT",42,0)
 W !! K DIC S DIC="^SRS(",DIC(0)="QEAM",DIC("S")="I $$ORDIV^SROUTL0(+Y,$G(SRSITE(""DIV""))),('$P(^SRS(+Y,0),U,6))",DIC("A")="Select Operating Room: " D ^DIC K DIC G:Y'>0 END S SRSOR=+Y,SRBPRG=1
"RTN","SRSBOUT",43,0)
 I $D(^SRS("SER",SRSSER,SRSOR)) W !!,?5,"A Service Block for """,SRSSER,""" already exists. Please try agian." G SER
"RTN","SRSBOUT",44,0)
DATE ; select date to begin
"RTN","SRSBOUT",45,0)
 S %DT("A")="Select Starting Date: ",%DT="AEFX" W !! D ^%DT G:Y'>0 END S SRSDATE=Y I SRSDATE<DT W !!,"Past dates cannot be entered." G DATE
"RTN","SRSBOUT",46,0)
TIME ; select starting and ending times
"RTN","SRSBOUT",47,0)
 S (SRSBANG,SRSOUT)=0 D ^SRSTIME I SRSOUT G END
"RTN","SRSBOUT",48,0)
 ;
"RTN","SRSBOUT",49,0)
PAT W !!,"1. Every week, same time ",!,"2. Every other week ",!,"3. Every month, same day of week & week of month " R !!,"Select Number:  ",Z:DTIME I '$T!(Z["^") S SRSOUT=1 G END
"RTN","SRSBOUT",50,0)
 I Z["?" D HELP G PAT
"RTN","SRSBOUT",51,0)
 I Z<1!(Z>3) W !!,"Enter 1, 2, or 3." G PAT
"RTN","SRSBOUT",52,0)
 I Z>2 S X1=SRSDATE,X2=$E(SRSDATE,1,5)_"01" D ^%DTC S Z=X\7+3
"RTN","SRSBOUT",53,0)
 I Z>5 D MNTH Q:SRSOUT
"RTN","SRSBOUT",54,0)
 S SRSNUM=$P("0^8^1^2^3^4^5","^",Z),X1=SRSDATE,X2=2830103 D ^%DTC S SRSDAY=$P("MO^TU^WE^TH^FR^SA^SU","^",X#7+1),Y=0 I SRSNUM=8 S:X#2 SRSNUM=9
"RTN","SRSBOUT",55,0)
 S SRSST=$P(SRSTIME,"^"),SRSET=$P(SRSTIME,"^",2),SRSST=$E(SRSST,1,2)_"."_$E(SRSST,4,5),SRSET=$E(SRSET,1,2)_"."_$E(SRSET,4,5)
"RTN","SRSBOUT",56,0)
 S SRBFLG=1  ;;>>BEGIN 3*165-RJS
"RTN","SRSBOUT",57,0)
 D BLOCKED^SRSBUTL,CHK^SRSBUTL  ;;<<END 3*165-RJS
"RTN","SRSBOUT",58,0)
 S I="" F  S I=$O(^SRS("R",SRSDAY,SRSOR,I)) Q:I=""!SRSBANG  F J=0:1:9 I $D(^SRS("R",SRSDAY,SRSOR,I,J)) D CNG Q:SRSBANG
"RTN","SRSBOUT",59,0)
 G:SRSBANG&SRBFLG END  ;;<<3*165-RJS
"RTN","SRSBOUT",60,0)
 W !!,"Updating Schedules...",!
"RTN","SRSBOUT",61,0)
MUL2 ;
"RTN","SRSBOUT",62,0)
 K DIE,DR S DIE=131.7,DA=SRSOR,DR="8///"_SRSDAY,DR(2,131.703)="1///"_SRSSER,DR(3,131.704)="2////"_DUZ_";1///"_SRSST,DR(4,131.705)="2////"_SRSNUM_";1///"_SRSET D ^DIE K DR
"RTN","SRSBOUT",63,0)
 S SRSBOUT=DUZ_"^"_SRSDAY_"0^"_$P(SRSTIME,"^")_"^"_$P(SRSTIME,"^",2)_"^"_SRSSER,X=0
"RTN","SRSBOUT",64,0)
 I '$D(^SRS(SRSOR,"S",SRSDATE,1)) D S
"RTN","SRSBOUT",65,0)
 D UPDATE
"RTN","SRSBOUT",66,0)
CK1 I SRSNUM=0 S X=7 D UPDATE G:X CK1
"RTN","SRSBOUT",67,0)
CK2 I SRSNUM>7 S X=14 D UPDATE G:X CK2
"RTN","SRSBOUT",68,0)
CK0 I SRSNUM>0,(SRSNUM<5) S X5=$E(SRSDATE,4,5),X1=SRSDATE,X2=7 D C^%DTC S SRSDATE=X G:$E(X,4,5)=X5 CK0
"RTN","SRSBOUT",69,0)
CK3 I SRSNUM>0,(SRSNUM<5) S X=SRSNUM-1*7 D UPDATE G:X CK0
"RTN","SRSBOUT",70,0)
CK5 I SRSNUM=5 S X1=SRSDATE,X2=21 D C^%DTC S SRSDATE=X
"RTN","SRSBOUT",71,0)
CK4 I SRSNUM=5 S X1=SRSDATE,X2=7,X5=$E(SRSDATE,4,5) D C^%DTC S SRSDATE=X G:$E(SRSDATE,4,5)=X5 CK4 S X=-7 D UPDATE G:X CK5
"RTN","SRSBOUT",72,0)
 G END
"RTN","SRSBOUT",73,0)
UPDATE S X1=SRSDATE,X2=X D C^%DTC S SRSDATE=X D  Q
"RTN","SRSBOUT",74,0)
 .Q:$G(SRBCHK(SRSDATE))
"RTN","SRSBOUT",75,0)
 .D:$D(^SRS(SRSOR,"S",SRSDATE)) PATRN^SRSUTL S X=1 S:$O(^SRS(SRSOR,"S",SRSDATE))="" X=0
"RTN","SRSBOUT",76,0)
 Q
"RTN","SRSBOUT",77,0)
HELP W !!,"Enter '1' to create the blockout on the same day and time every week, '2' to",!,"create the blockout on the same day and time every other week, or '3' to "
"RTN","SRSBOUT",78,0)
 W !,"create the blockout for the same day of the week and week of the month only."
"RTN","SRSBOUT",79,0)
 Q
"RTN","SRSBUTL")
0^10^B34773230^n/a
"RTN","SRSBUTL",1,0)
SRSBUTL ;B'HAM ISC/MAM - BLOCK OUT TIME ON OR SCHEDULE UTILITY; [ 08/14/09  11:36 AM ]
"RTN","SRSBUTL",2,0)
 ;;3.0; Surgery ;**165**;24 Jun 93;Build 6
"RTN","SRSBUTL",3,0)
BLOCKED ; find blocked OPERATING ROOMS
"RTN","SRSBUTL",4,0)
 S SRBDT=DT,SRBCNT=0,SRBOR=SRSOR,SRBDAY=SRSDAY
"RTN","SRSBUTL",5,0)
 S X1=SRBDT,X2=-1 D C^%DTC S SRBDT=X
"RTN","SRSBUTL",6,0)
 F  S SRBDT=$O(^SRS(SRBOR,"S",SRBDT)) Q:SRBDT=""  D
"RTN","SRSBUTL",7,0)
 .S SRBCNT=SRBCNT+1
"RTN","SRSBUTL",8,0)
 .Q:'$D(^SRS(SRBOR,"S",SRBDT,1))
"RTN","SRSBUTL",9,0)
 .S SRBST=""
"RTN","SRSBUTL",10,0)
 .F  S SRBST=$O(^SRS("R",SRBDAY,SRBOR,SRBST)) Q:SRBST=""  D
"RTN","SRSBUTL",11,0)
 ..S SRBN=""
"RTN","SRSBUTL",12,0)
 ..F  S SRBN=$O(^SRS("R",SRBDAY,SRBOR,SRBST,SRBN)) Q:SRBN=""  D
"RTN","SRSBUTL",13,0)
 ...S SRBET=$P(^SRS("R",SRBDAY,SRBOR,SRBST,SRBN),"^",4)
"RTN","SRSBUTL",14,0)
 ...S SRBSERV=$P(^SRS("R",SRBDAY,SRBOR,SRBST,SRBN),"^",5)
"RTN","SRSBUTL",15,0)
 ...S SRB1=+SRBST,SRB2=+SRBET
"RTN","SRSBUTL",16,0)
 ...D PTRNALG  ; algorithm for setting start and end of pattern
"RTN","SRSBUTL",17,0)
 ...S SRBNUM=$S(SRBN=0:3,SRBN>7&(SRBN<10):2,1:1)
"RTN","SRSBUTL",18,0)
 ...I $G(^SRS(SRBOR,"S",SRBDT,1))[SRBS S ^TMP($J,"SRSBOUT",SRBDT,SRBNUM,SRBST)=SRBSERV_"^"_SRBN_"^"_SRBET
"RTN","SRSBUTL",19,0)
 K SRB1,SRB2,SRBCNT,SRBDAY,SRBDT,SRBET,SRBI,SRBNUM,SRBN,SRBS,SRBSERV,SRBST,X,X1,X2
"RTN","SRSBUTL",20,0)
 Q
"RTN","SRSBUTL",21,0)
CHK ;; CHECK FOR EXISTING BLOCKS
"RTN","SRSBUTL",22,0)
 S SRBOR=SRSOR,SRBDT=SRSDATE,SRBTIME=SRSTIME,SRBNUM=SRSNUM
"RTN","SRSBUTL",23,0)
 S SRB1=$P(SRBTIME,"^"),SRB2=$P(SRBTIME,"^",2),SRB1=$E(SRB1,1,2)_"."_$E(SRB1,4,5),SRB2=$E(SRB2,1,2)_"."_$E(SRB2,4,5)
"RTN","SRSBUTL",24,0)
 S SRBEN1=SRB1,SRBEN2=SRB2,SRBFLG=1,X=0 D CHKD
"RTN","SRSBUTL",25,0)
CK1 I SRBNUM=0 S X=7 D CHKD G:X CK1
"RTN","SRSBUTL",26,0)
CK2 I SRBNUM>7 S X=14 D CHKD G:X CK2
"RTN","SRSBUTL",27,0)
CK0 I SRBNUM>0,(SRBNUM<5) S X5=$E(SRBDT,4,5),X1=SRBDT,X2=7 D C^%DTC S SRBDT=X G:$E(X,4,5)=X5 CK0
"RTN","SRSBUTL",28,0)
CK3 I SRBNUM>0,(SRBNUM<5) S X=SRBNUM-1*7 D CHKD G:X CK0
"RTN","SRSBUTL",29,0)
CK5 I SRBNUM=5 S X1=SRBDT,X2=21 D C^%DTC S SRBDT=X
"RTN","SRSBUTL",30,0)
CK4 I SRBNUM=5 S X1=SRBDT,X2=7,X5=$E(SRBDT,4,5) D C^%DTC S SRBDT=X G:$E(SRBDT,4,5)=X5 CK4 S X=-7 D CHKD G:X CK5
"RTN","SRSBUTL",31,0)
END S SRBDT="" F  S SRBDT=$O(SRBCHK(SRBDT)) Q:'SRBDT  S:SRBCHK(SRBDT)=0 SRBFLG=0
"RTN","SRSBUTL",32,0)
 K SRB1,SRB2,SRBDT,SRBEN1,SRBEN2,SRBNMB,SRBNUM,SRBST,SRBET,SRBTIME,X5
"RTN","SRSBUTL",33,0)
 Q
"RTN","SRSBUTL",34,0)
CHKD S X1=SRBDT,X2=X D C^%DTC S SRBDT=X
"RTN","SRSBUTL",35,0)
 S:'$G(^SRS(SRBOR,"S",SRBDT,0)) X=0
"RTN","SRSBUTL",36,0)
 S SRBCHK(SRBDT)=0
"RTN","SRSBUTL",37,0)
 I $D(^TMP($J,"SRSBOUT",SRBDT))  D
"RTN","SRSBUTL",38,0)
 .S SRBNMB=""
"RTN","SRSBUTL",39,0)
 .F  S SRBNMB=$O(^TMP($J,"SRSBOUT",SRBDT,SRBNMB)) Q:'SRBNMB  D
"RTN","SRSBUTL",40,0)
 ..S (SRBST,SRBET)=""
"RTN","SRSBUTL",41,0)
 ..F  S SRBST=$O(^TMP($J,"SRSBOUT",SRBDT,SRBNMB,SRBST)) Q:'SRBST  D
"RTN","SRSBUTL",42,0)
 ...S SRBET=$P(^TMP($J,"SRSBOUT",SRBDT,SRBNMB,SRBST),"^",3)
"RTN","SRSBUTL",43,0)
 ...I (SRBST'<SRBEN1)&(SRBST<SRBEN2)!((SRBET>SRBEN1)&(SRBET'>SRBEN2))!((SRBEN1'<SRBST)&(SRBEN1<SRBET)) S SRBCHK(SRBDT)=1
"RTN","SRSBUTL",44,0)
 Q
"RTN","SRSBUTL",45,0)
DIS1 ;CHECK AND SET NEW SERVICE BLOCK
"RTN","SRSBUTL",46,0)
 S SRBOR=SROR,SRBDT=SRSDATE
"RTN","SRSBUTL",47,0)
 S X1=SRBDT,X2=2830103 D ^%DTC S SRBDAY=$P("MO^TU^WE^TH^FR^SA^SU","^",X#7+1),X3=X#2+8 S X1=SRBDT,X2=$E(SRBDT,1,5)_"01" D ^%DTC S SRBDY=X\7+1
"RTN","SRSBUTL",48,0)
 S:'$G(SRBSER1) SRBSER1=""
"RTN","SRSBUTL",49,0)
 S SRBCNTR=0
"RTN","SRSBUTL",50,0)
 S SRBST=0 F  S SRBST=$O(^SRS("R",SRBDAY,SRBOR,SRBST)) Q:SRBST=""  D
"RTN","SRSBUTL",51,0)
 .S SRBN="" F  S SRBN=$O(^SRS("R",SRBDAY,SRBOR,SRBST,SRBN)) Q:SRBN=""  D
"RTN","SRSBUTL",52,0)
 ..S SRBET=$P(^SRS("R",SRBDAY,SRBOR,SRBST,SRBN),"^",4),SRBSER=$P(^SRS("R",SRBDAY,SRBOR,SRBST,SRBN),"^",5)
"RTN","SRSBUTL",53,0)
 ..S:SRBSER1'=SRBSER SRBCNTR=SRBCNTR+1,SRBSTM(SRBCNTR)=SRBST,SRBETM(SRBCNTR)=SRBET,SRBS1(SRBCNTR)=$P(^SRS("R",SRBDAY,SRBOR,SRBST,SRBN),"^",2)
"RTN","SRSBUTL",54,0)
 S SRBCTR3=0,SRB=0
"RTN","SRSBUTL",55,0)
 F SRBCTR1=1:1:3 D
"RTN","SRSBUTL",56,0)
 .F SRBCTR2=1:1:SRBCNTR D
"RTN","SRSBUTL",57,0)
 ..S SRBNUMB=$E(SRBS1(SRBCTR2),3)
"RTN","SRSBUTL",58,0)
 ..I SRBCTR1=3,SRBNUMB=0 D UPDATE
"RTN","SRSBUTL",59,0)
 ..I SRBCTR1=2,SRBNUMB=X3 D UPDATE
"RTN","SRSBUTL",60,0)
 ..I SRBCTR1=1,SRBNUMB=SRBDY D UPDATE
"RTN","SRSBUTL",61,0)
 I '$G(SRBPRG) K SRBCNT,SRBDT,SRBOR,SRBPRG,SRBSER1
"RTN","SRSBUTL",62,0)
 K SRB,SRBCNTR,SRBCTR1,SRBCTR2,SRBCTR3,SRBDAY,SRBDY,SRBET,SRBET1,X3
"RTN","SRSBUTL",63,0)
 K SRBARRY,SRBETM,SRBN,SRBNUMB,SRBS,SRBS1,SRBS2,SRBSER,SRBSERV,SRBST,SRBST1,SRBSTM
"RTN","SRSBUTL",64,0)
 Q
"RTN","SRSBUTL",65,0)
UPDATE ;CHECK AND SET SERVICE BLOCK
"RTN","SRSBUTL",66,0)
 I $D(^SRS(SRBOR,"S",SRBDT)),$G(^SRS(SRBOR,"S",SRBDT,1))["X" S SRBCTR3=1,SRB=1
"RTN","SRSBUTL",67,0)
 I '$G(SRBCTR3),'$D(^SRS(SRBOR,"S",SRBDT)) D S^SRSBOUT
"RTN","SRSBUTL",68,0)
 S SRBST1=SRBSTM(SRBCTR2),SRBET1=SRBETM(SRBCTR2),SRSNUM=SRBNUMB,(SRBCTR3,SRBFLG)=1
"RTN","SRSBUTL",69,0)
 S SRBSERV=$P(^SRS("R",SRBDAY,SRBOR,SRBST1,SRBNUMB),"^",5)
"RTN","SRSBUTL",70,0)
 S SRBARRY(SRBDT,SRBSERV)=SRBST1_"^"_SRBET1
"RTN","SRSBUTL",71,0)
 D CHECK I 'SRB D SET
"RTN","SRSBUTL",72,0)
 I SRBFLG,SRB S SRB1=SRBST1,SRB2=SRBET1 D PATRN
"RTN","SRSBUTL",73,0)
 Q
"RTN","SRSBUTL",74,0)
SET ;SET SERVICE BLOCK GRAPH
"RTN","SRSBUTL",75,0)
 I 'SRBFLG Q
"RTN","SRSBUTL",76,0)
 S SRB1=SRBST1,SRB2=SRBET1,SRBI=""
"RTN","SRSBUTL",77,0)
 D PTRNALG  ;; algorithm for setting start and end of pattern
"RTN","SRSBUTL",78,0)
 S SRBX1=^SRS(SROR,"S",SRSDATE,1),^(1)=$E(SRBX1,1,SRB1)_SRBS_$E(SRBX1,SRB2+1,200),^SRS(SROR,"SS",SRSDATE,1)=^(1),^SRS(SROR,"S",SRSDATE,0)=SRSDATE,^SRS(SROR,"SS",SRSDATE,0)=SRSDATE
"RTN","SRSBUTL",79,0)
 K SRB1,SRB2,SRBI,SRBX1
"RTN","SRSBUTL",80,0)
 Q
"RTN","SRSBUTL",81,0)
CHECK ;CHECK FOR TIME COLLISION
"RTN","SRSBUTL",82,0)
 S SRBSER2="" F  S SRBSER2=$O(SRBARRY(SRBDT,SRBSER2)) Q:SRBSER2=""  D
"RTN","SRSBUTL",83,0)
 .S SRBS1=$P(SRBARRY(SRBDT,SRBSER2),"^",1),SRBS2=$P(SRBARRY(SRBDT,SRBSER2),"^",2)
"RTN","SRSBUTL",84,0)
 .Q:SRBSER2=SRBSERV
"RTN","SRSBUTL",85,0)
 .I (SRBS1'<SRBST1)&(SRBS1<SRBET1)!((SRBS2>SRBST1)&(SRBS2'>SRBET1))!((SRBST1'<SRBS1)&(SRBST1<SRBS2)) S SRBFLG=0
"RTN","SRSBUTL",86,0)
 K SRBSER2
"RTN","SRSBUTL",87,0)
 Q
"RTN","SRSBUTL",88,0)
DELCHK(SRBDAY) ; CHECK FOR OVERLAPING BLOCK FOR THE DELETED DAY
"RTN","SRSBUTL",89,0)
 S SRBDT=SRSDATE,SRBOR=SRSOR,SRBNUM=SRSNUM,SRBST=""
"RTN","SRSBUTL",90,0)
 F  S SRBST=$O(^SRS("R",SRBDAY,SRBOR,SRBST)) Q:SRBST=""  D
"RTN","SRSBUTL",91,0)
 .Q:'$D(^SRS("R",SRBDAY,SRBOR,SRBST,SRBNUM))
"RTN","SRSBUTL",92,0)
 .S SRBSERV=$P(^SRS("R",SRBDAY,SRBOR,SRBST,SRBNUM),"^",5),SRBET=$P(^SRS("R",SRBDAY,SRBOR,SRBST,SRBNUM),"^",4)
"RTN","SRSBUTL",93,0)
 .S SRB1=+SRBST,SRB2=+SRBET
"RTN","SRSBUTL",94,0)
 .D PTRNALG
"RTN","SRSBUTL",95,0)
 .I SRBS'=SRBCKH,$G(^SRS(SRBOR,"S",SRBDT,1))'[SRBS S SRB1=+SRBST,SRB2=+SRBET D PATRN
"RTN","SRSBUTL",96,0)
 K SRB1,SRB2,SRBDAY,SRBDT,SRBNUM,SRBOR,SRBET,SRBST,SRBSERV,SRBS,SRBI,SRBTS,SRBTE,X,X0,X1
"RTN","SRSBUTL",97,0)
 Q
"RTN","SRSBUTL",98,0)
PATRN ; set pattern in OPERATING ROOM file
"RTN","SRSBUTL",99,0)
 D PTRNALG  ;; algorithm for setting start and end of pattern
"RTN","SRSBUTL",100,0)
 S SRBX0=^SRS(SRBOR,"SS",SRBDT,1),(SRBX0,^(1))=$E(SRBX0,1,SRB1)_SRBS_$E(SRBX0,SRB2+1,200),^SRS(SRBOR,"SS",SRBDT,0)=SRBDT
"RTN","SRSBUTL",101,0)
 S SRBX1=^SRS(SRBOR,"S",SRBDT,1) F SRBI=SRB1:1:SRB2 I "X="'[$E(SRBX1,SRBI) S SRBX1=$E(SRBX1,1,SRBI-1)_$E(SRBX0,SRBI)_$E(SRBX1,SRBI+1,200)
"RTN","SRSBUTL",102,0)
 S ^SRS(SRBOR,"S",SRBDT,1)=SRBX1,^SRS(SRBOR,"S",SRBDT,0)=SRBDT
"RTN","SRSBUTL",103,0)
 K SRB1,SRB2,SRBX0,SRBX1
"RTN","SRSBUTL",104,0)
 Q
"RTN","SRSBUTL",105,0)
PTRNALG ; set pattern in OPERATING ROOM file
"RTN","SRSBUTL",106,0)
 ; algorithm for setting start and end of pattern
"RTN","SRSBUTL",107,0)
 S SRB1=11+((SRB1\1)*5)+(SRB1-(SRB1\1)*100\15),SRB2=11+((SRB2\1)*5)+(SRB2-(SRB2\1)*100\15)
"RTN","SRSBUTL",108,0)
 S SRBS="" F SRBI=SRB1:1:SRB2-1 S SRBS=SRBS_$S('(SRBI#5):"|",$E(SRBSERV,SRBI#5)'="":$E(SRBSERV,SRBI#5),1:".")
"RTN","SRSBUTL",109,0)
 Q
"RTN","SRSBUTL",110,0)
CURRENT ; ENSURE SERVICE BLOCK GRAPH IS UP TO DATE
"RTN","SRSBUTL",111,0)
 S SRBOR=0 F  S SRBOR=$O(^SRS(SRBOR)) Q:'SRBOR  D
"RTN","SRSBUTL",112,0)
 .Q:$P(^SRS(SRBOR,0),"^",6)=1
"RTN","SRSBUTL",113,0)
 .S SRBCNT=0 F SRBCNT=0:1:90 S X1=DT,X2=SRBCNT D C^%DTC S SRBDT=X D:'$D(^SRS(SRBOR,"S",SRBDT,1)) GRAPH^SRSDIS1(SRBDT,SRBOR)
"RTN","SRSBUTL",114,0)
 K SRBCNT,SRBDT,SRBOR,X,X1,X
"RTN","SRSBUTL",115,0)
 Q
"RTN","SRSDIS1")
0^6^B9832283^B9696115
"RTN","SRSDIS1",1,0)
SRSDIS1 ;B'HAM ISC/MAM - DISPLAY ONE ROOM ; [ 09/29/03  10:23 AM ]
"RTN","SRSDIS1",2,0)
 ;;3.0; Surgery ;**100,165**;24 Jun 93;Build 6
"RTN","SRSDIS1",3,0)
PICK W @IOF,!!,"Display of Available Operating Room Time",!!,"1. Display Availability (12:00 AM - 12:00 PM)",!,"2. Display Availability (06:00 AM - 08:00 PM)",!,"3. Display Availability (12:00 PM - 12:00 AM)"
"RTN","SRSDIS1",4,0)
 W !!,"Select Number: 2//  " R X:DTIME I '$T!(X["^") S SRSOUT=1 Q
"RTN","SRSDIS1",5,0)
 S:X="" X=2 I X<1!(X>3) D HELP G PICK
"RTN","SRSDIS1",6,0)
 S SRDTYPE=X D HDR
"RTN","SRSDIS1",7,0)
 S SRDT=SRSDATE F SRDAZE=0:1:14 S X1=SRDT,X2=SRDAZE D C^%DTC S SRSDATE=X,SRDATE=$E(X,4,5)_"-"_$E(X,6,7)_"-"_$E(X,2,3)_" " D LINE
"RTN","SRSDIS1",8,0)
 Q
"RTN","SRSDIS1",9,0)
HDR W @IOF,!!,"Operating Room: "_SROOM,?25,$S(SRDTYPE=2:"     (6:00 AM - 8:00 PM)",SRDTYPE=1:" (12:00 AM - 12:00 PM)",1:" (12:00 PM - 12:00 AM)"),!!,"DATE "
"RTN","SRSDIS1",10,0)
 I SRDTYPE=2 W "    6    7    8    9   10   11   12   13   14   15   16   17   18   19   20" Q
"RTN","SRSDIS1",11,0)
 I SRDTYPE=1 W "    12   1    2    3    4    5    6    7    8    9   10   11   12" Q
"RTN","SRSDIS1",12,0)
 W "    12   13   14   15   16   17  18   19   20   21   22   23   24"
"RTN","SRSDIS1",13,0)
 Q
"RTN","SRSDIS1",14,0)
LINE ; display graph for each room
"RTN","SRSDIS1",15,0)
 I '$D(^SRS(SROR,"S",SRSDATE,1)) D GRAPH(SRSDATE,SROR)
"RTN","SRSDIS1",16,0)
 S START=$S(SRDTYPE=2:41,SRDTYPE=1:11,1:71),END=$S(SRDTYPE=2:111,SRDTYPE=1:71,1:500)
"RTN","SRSDIS1",17,0)
 W !,SRDATE,$E(^SRS(SROR,"S",SRSDATE,1),START,END)
"RTN","SRSDIS1",18,0)
 Q
"RTN","SRSDIS1",19,0)
GRAPH(SRSDATE,SROR) ; set graph in ^SRS
"RTN","SRSDIS1",20,0)
 S ^SRS(SROR,"S",SRSDATE,0)=SRSDATE,^SRS(SROR,"SS",SRSDATE,0)=SRSDATE
"RTN","SRSDIS1",21,0)
 S X=$E(SRSDATE,4,5)_"-"_$E(SRSDATE,6,7)_"-"_$E(SRSDATE,2,3)
"RTN","SRSDIS1",22,0)
 S ^SRS(SROR,"S",SRSDATE,1)=X_"  |____|____|____|____|____|____|____|____|____|____|____|____|____|____|____|____|____|____|____|____|____|____|____|____|",^SRS(SROR,"SS",SRSDATE,1)=^SRS(SROR,"S",SRSDATE,1)
"RTN","SRSDIS1",23,0)
 D DIS1^SRSBUTL  ;;3*165-RJS
"RTN","SRSDIS1",24,0)
 Q
"RTN","SRSDIS1",25,0)
HELP W !!,"Enter the number corresponding to portion of the display graph of available",!,"operating room time that you want to view.  If you want to view the room"
"RTN","SRSDIS1",26,0)
 W !,"between the hours of 6:00 AM and 8:00 PM, enter '2'.  A display of available",!,"operating room time will then appear on your screen."
"RTN","SRSDIS1",27,0)
 W !!,"Press <RET> to continue  " R X:DTIME
"RTN","SRSDIS1",28,0)
 Q
"RTN","SRSDISP")
0^7^B11398688^B11352066
"RTN","SRSDISP",1,0)
SRSDISP ;B'HAM ISC/MAM - SELECT GRAPH DISPLAY ; [ 04/03/00  1:33 PM ]
"RTN","SRSDISP",2,0)
 ;;3.0; Surgery ;**50,94,165**;24 Jun 93;Build 6
"RTN","SRSDISP",3,0)
PICK W @IOF,!!,"Display of Available Operating Room Time",!!,"1. Display Availability (12:00 AM - 12:00 PM)",!,"2. Display Availability (06:00 AM - 08:00 PM)",!,"3. Display Availability (12:00 PM - 12:00 AM)"
"RTN","SRSDISP",4,0)
 W !,"4. Do Not Display Availability"
"RTN","SRSDISP",5,0)
 W !!,"Select Number: 2//  " R X:DTIME I '$T!(X["^") S SRSOUT=1 Q
"RTN","SRSDISP",6,0)
 S:X="" X=2 I X<1!(X>4) D HELP G PICK
"RTN","SRSDISP",7,0)
 S SRDTYPE=X I SRDTYPE<4 D HDR
"RTN","SRSDISP",8,0)
 S SROR=0 F  S SROR=$O(^SRS(SROR)) Q:'SROR  I '$P(^(SROR,0),"^",6) D:$$ORDIV^SROUTL0(SROR,$G(SRSITE("DIV"))) LINE
"RTN","SRSDISP",9,0)
 Q
"RTN","SRSDISP",10,0)
HDR W @IOF,!!,"ROOM"
"RTN","SRSDISP",11,0)
 I SRDTYPE=2 W "   6AM   7    8    9    10   11   12   13   14   15   16   17   18   19   20" Q
"RTN","SRSDISP",12,0)
 I SRDTYPE=1 W "   12AM  1    2    3    4    5    6    7    8    9   10   11   12PM" Q
"RTN","SRSDISP",13,0)
 W "   12PM  13   14   15   16   17   18   19   20   21   22   23   24"
"RTN","SRSDISP",14,0)
 Q
"RTN","SRSDISP",15,0)
LINE ; display graph for each room
"RTN","SRSDISP",16,0)
 I '$D(^SRS(SROR,"S",SRSDATE,1)) D GRAPH
"RTN","SRSDISP",17,0)
 S X2=1,X1=SRSDATE D C^%DTC I '$D(^SRS(SROR,"S",X,1)) S SRDAT=SRSDATE,SRSDATE=X D GRAPH S SRSDATE=SRDAT K SRDAT
"RTN","SRSDISP",18,0)
 I SRDTYPE=4 Q
"RTN","SRSDISP",19,0)
 S X=$P(^SRS(SROR,0),"^"),ROOM=$P(^SC(X,0),"^"),START=$S(SRDTYPE=2:41,SRDTYPE=1:11,1:71),END=$S(SRDTYPE=2:111,SRDTYPE=1:71,1:500)
"RTN","SRSDISP",20,0)
 W !,$E(ROOM,1,8),?8,$E(^SRS(SROR,"S",SRSDATE,1),START,END)
"RTN","SRSDISP",21,0)
 Q
"RTN","SRSDISP",22,0)
GRAPH ; set graph in ^SRS
"RTN","SRSDISP",23,0)
 S ^SRS(SROR,"S",SRSDATE,0)=SRSDATE,^SRS(SROR,"SS",SRSDATE,0)=SRSDATE
"RTN","SRSDISP",24,0)
 S X=$E(SRSDATE,4,5)_"-"_$E(SRSDATE,6,7)_"-"_$E(SRSDATE,2,3)
"RTN","SRSDISP",25,0)
 S ^SRS(SROR,"S",SRSDATE,1)=X_"  |____|____|____|____|____|____|____|____|____|____|____|____|____|____|____|____|____|____|____|____|____|____|____|____|",^SRS(SROR,"SS",SRSDATE,1)=^SRS(SROR,"S",SRSDATE,1)
"RTN","SRSDISP",26,0)
 D DIS1^SRSBUTL  ;;3*165-RJS
"RTN","SRSDISP",27,0)
 Q
"RTN","SRSDISP",28,0)
HELP W !!,"Enter the number corresponding to portion of the display graph of available",!,"operating room time that you want to view.  If you are scheduling a case"
"RTN","SRSDISP",29,0)
 W !,"between the hours of 6:00 AM and 8:00 PM, enter '2'.  A display of available",!,"operating room time will then appear on your screen.  If you do not want to"
"RTN","SRSDISP",30,0)
 W !,"see a display for any time period, enter '4'.  You will then be asked to",!,"select an operating room."
"RTN","SRSDISP",31,0)
 W !!,"Press <RET> to continue  " R X:DTIME
"RTN","SRSDISP",32,0)
 Q
"VER")
8.0^22.0
"BLD",6578,6)
^167
**END**
**END**
