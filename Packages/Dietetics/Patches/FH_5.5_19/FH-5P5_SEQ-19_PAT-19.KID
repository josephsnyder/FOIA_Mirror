Released FH*5.5*19 SEQ #19
Extracted from mail message
**KIDS**:FH*5.5*19^

**INSTALL NAME**
FH*5.5*19
"BLD",7827,0)
FH*5.5*19^DIETETICS^0^3080724^y
"BLD",7827,1,0)
^^1^1^3080722^
"BLD",7827,1,1,0)
This addresses general issues with the Nutrition and Food Service package.
"BLD",7827,4,0)
^9.64PA^^
"BLD",7827,6.3)
2
"BLD",7827,"ABPKG")
n
"BLD",7827,"KRN",0)
^9.67PA^8989.52^19
"BLD",7827,"KRN",.4,0)
.4
"BLD",7827,"KRN",.401,0)
.401
"BLD",7827,"KRN",.402,0)
.402
"BLD",7827,"KRN",.403,0)
.403
"BLD",7827,"KRN",.5,0)
.5
"BLD",7827,"KRN",.84,0)
.84
"BLD",7827,"KRN",3.6,0)
3.6
"BLD",7827,"KRN",3.8,0)
3.8
"BLD",7827,"KRN",9.2,0)
9.2
"BLD",7827,"KRN",9.8,0)
9.8
"BLD",7827,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",7827,"KRN",9.8,"NM",1,0)
FHOMWOR^^0^B25485238
"BLD",7827,"KRN",9.8,"NM",2,0)
FHDPSM^^0^B4795299
"BLD",7827,"KRN",9.8,"NM",3,0)
FHOMSS2^^0^B17597008
"BLD",7827,"KRN",9.8,"NM","B","FHDPSM",2)

"BLD",7827,"KRN",9.8,"NM","B","FHOMSS2",3)

"BLD",7827,"KRN",9.8,"NM","B","FHOMWOR",1)

"BLD",7827,"KRN",19,0)
19
"BLD",7827,"KRN",19.1,0)
19.1
"BLD",7827,"KRN",101,0)
101
"BLD",7827,"KRN",409.61,0)
409.61
"BLD",7827,"KRN",771,0)
771
"BLD",7827,"KRN",870,0)
870
"BLD",7827,"KRN",8989.51,0)
8989.51
"BLD",7827,"KRN",8989.52,0)
8989.52
"BLD",7827,"KRN",8994,0)
8994
"BLD",7827,"KRN","B",.4,.4)

"BLD",7827,"KRN","B",.401,.401)

"BLD",7827,"KRN","B",.402,.402)

"BLD",7827,"KRN","B",.403,.403)

"BLD",7827,"KRN","B",.5,.5)

"BLD",7827,"KRN","B",.84,.84)

"BLD",7827,"KRN","B",3.6,3.6)

"BLD",7827,"KRN","B",3.8,3.8)

"BLD",7827,"KRN","B",9.2,9.2)

"BLD",7827,"KRN","B",9.8,9.8)

"BLD",7827,"KRN","B",19,19)

"BLD",7827,"KRN","B",19.1,19.1)

"BLD",7827,"KRN","B",101,101)

"BLD",7827,"KRN","B",409.61,409.61)

"BLD",7827,"KRN","B",771,771)

"BLD",7827,"KRN","B",870,870)

"BLD",7827,"KRN","B",8989.51,8989.51)

"BLD",7827,"KRN","B",8989.52,8989.52)

"BLD",7827,"KRN","B",8994,8994)

"BLD",7827,"QUES",0)
^9.62^^
"BLD",7827,"REQB",0)
^9.611^1^1
"BLD",7827,"REQB",1,0)
FH*5.5*5^2
"BLD",7827,"REQB","B","FH*5.5*5",1)

"MBREQ")
0
"PKG",122,-1)
1^1
"PKG",122,0)
DIETETICS^FH^Dietetics System
"PKG",122,20,0)
^9.402P^^
"PKG",122,22,0)
^9.49I^1^1
"PKG",122,22,1,0)
5.5^3050202^3050308^33227
"PKG",122,22,1,"PAH",1,0)
19^3080724
"PKG",122,22,1,"PAH",1,1,0)
^^1^1^3080724
"PKG",122,22,1,"PAH",1,1,1,0)
This addresses general issues with the Nutrition and Food Service package.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","FHDPSM")
0^2^B4795299^B4611317
"RTN","FHDPSM",1,0)
FHDPSM ;Hines OIFO/RTK/FAI SPECIAL MEALS DISPLAY  ;10/20/04  14:22
"RTN","FHDPSM",2,0)
 ;;5.5;DIETETICS;**19**;Jan 28, 2005;Build 2
"RTN","FHDPSM",3,0)
 ;
"RTN","FHDPSM",4,0)
LIST ;
"RTN","FHDPSM",5,0)
 K FHLIST S FHS="ACDP",NUM=0,EX="" D HDR
"RTN","FHDPSM",6,0)
 F FHSMDT=STDT:0 S FHSMDT=$O(^FHPT(FHDFN,"SM",FHSMDT)) Q:FHSMDT'>0!(FHSMDT<STDT)!(FHSMDT>ENDT)!(EX=U)  D
"RTN","FHDPSM",7,0)
 .S FHNODE=$G(^FHPT(FHDFN,"SM",FHSMDT,0)),FHSTAT=$P(FHNODE,U,2)
"RTN","FHDPSM",8,0)
 .I FHS'[FHSTAT Q
"RTN","FHDPSM",9,0)
 .S FHSTAT=$S(FHSTAT="P":"PENDING",FHSTAT="A":"AUTHORIZED",FHSTAT="D":"DENIED",1:"CANCELLED")
"RTN","FHDPSM",10,0)
 .S NUM=NUM+1,PAD=$S($L(NUM)=1:" ",1:"") W !,PAD,NUM
"RTN","FHDPSM",11,0)
 .D PATNAME^FHOMUTL
"RTN","FHDPSM",12,0)
 .S FHD=$$FMTE^XLFDT(FHSMDT,"P") W ?8,$E(FHD,1,12)
"RTN","FHDPSM",13,0)
 .S FHLPT=$P($G(FHNODE),U,3),FHLOC=$S(FHLPT="":"",1:$E($P($G(^FH(119.6,FHLPT,0)),U,1),1,10))
"RTN","FHDPSM",14,0)
 .W ?26,FHLOC
"RTN","FHDPSM",15,0)
 .S FHDPT=$P(FHNODE,U,4),FHDIET=$S(FHDPT="":"",1:$E($P($G(^FH(111,FHDPT,0)),U,1),1,12))
"RTN","FHDPSM",16,0)
 .W ?40,FHDIET
"RTN","FHDPSM",17,0)
 .S FHMEAL=$P(FHNODE,U,9) W ?57,FHMEAL,?65,FHSTAT
"RTN","FHDPSM",18,0)
 .S FHLIST(NUM)=FHDFN_"^"_FHSMDT
"RTN","FHDPSM",19,0)
 .I $E(FHSTAT,1)="D" D
"RTN","FHDPSM",20,0)
 ..S FHDENY=$P(FHNODE,U,6)
"RTN","FHDPSM",21,0)
 ..I FHDENY'="" W !,?6,"Denied By: ",$P($G(^VA(200,FHDENY,0)),U,1)
"RTN","FHDPSM",22,0)
 .S FHCOMM=$P(FHNODE,U,8) I FHCOMM'="" W !?6,"Comment: ",FHCOMM
"RTN","FHDPSM",23,0)
 .I $D(^FHPT(FHDFN,"SM",FHSMDT,1)) D
"RTN","FHDPSM",24,0)
 ..S FHEL=$G(^FHPT(FHDFN,"SM",FHSMDT,1))
"RTN","FHDPSM",25,0)
 ..W !?6,"Early/Late Tray Time: ",$P(FHEL,U,1)
"RTN","FHDPSM",26,0)
 ..W "  Bagged Meal: ",$P(FHEL,U,2)
"RTN","FHDPSM",27,0)
 ..Q
"RTN","FHDPSM",28,0)
 .I $Y>(IOSL-4) D PG I EX=U Q
"RTN","FHDPSM",29,0)
 .Q
"RTN","FHDPSM",30,0)
 I NUM=0 W !!,"NO SPECIAL MEALS FOR THIS DATE RANGE" Q
"RTN","FHDPSM",31,0)
 Q
"RTN","FHDPSM",32,0)
PG ;
"RTN","FHDPSM",33,0)
 Q:$O(^FHPT(FHDFN,"SM",FHSMDT))'>0
"RTN","FHDPSM",34,0)
 I IOST?1"C".E W ! K DIR S DIR(0)="E" D ^DIR I 'Y S EX=U Q
"RTN","FHDPSM",35,0)
 D HDR Q
"RTN","FHDPSM",36,0)
HDR ;
"RTN","FHDPSM",37,0)
 W:$Y @IOF
"RTN","FHDPSM",38,0)
 W !?15,"S P E C I A L    M E A L S "
"RTN","FHDPSM",39,0)
 W !!!?1,"#",?8,"Date/Time",?26,"Location",?40,"Diet Ordered",?57,"Meal",?65,"Status"
"RTN","FHDPSM",40,0)
 W !,"===",?7,"============",?25,"==========",?39,"============",?56,"====",?65,"========="
"RTN","FHDPSM",41,0)
 Q
"RTN","FHDPSM",42,0)
END ;
"RTN","FHDPSM",43,0)
 K EX,FHNODE,FHSTAT Q
"RTN","FHOMSS2")
0^3^B17597008^B17440516
"RTN","FHOMSS2",1,0)
FHOMSS2 ;Hines OIFO/RTK SPECIAL MEALS STATUS LIST  ;2/07/06  10:05
"RTN","FHOMSS2",2,0)
 ;;5.5;DIETETICS;**5,19**;Jan 28, 2005;Build 2
"RTN","FHOMSS2",3,0)
 ;
"RTN","FHOMSS2",4,0)
 W @IOF,!!?20,"S P E C I A L   M E A L S   S T A T U S   L I S T"
"RTN","FHOMSS2",5,0)
START S (FHSELOC,FHSLCOM,FHSLPRO)=""
"RTN","FHOMSS2",6,0)
 W !! K DIR S DIR("A")="Print by LOCATION, COMM OFFICE, PRODUCTION FACILITY or ALL: "
"RTN","FHOMSS2",7,0)
 S DIR(0)="SAO^A:ALL;C:COMM OFFICE;L:LOCATION;P:PROD FACILITY" D ^DIR
"RTN","FHOMSS2",8,0)
 Q:$D(DIRUT)  S FHLBY=Y
"RTN","FHOMSS2",9,0)
 I FHLBY="L" W ! D OUTLOC^FHOMUTL Q:FHLOC=""  S FHSELOC=FHLOC,FHLOC=""
"RTN","FHOMSS2",10,0)
 I FHLBY="C" D  Q:FHSLCOM=""
"RTN","FHOMSS2",11,0)
 .W ! K DIC S DIC=119.73,DIC("A")="Select Communication Office: "
"RTN","FHOMSS2",12,0)
 .S DIC(0)="AEQZ" D ^DIC Q:$D(DUOUT)  I Y=-1 S FHSLCOM="" Q
"RTN","FHOMSS2",13,0)
 .S FHSLCOM=+Y
"RTN","FHOMSS2",14,0)
 I FHLBY="P" D  Q:FHSLPRO=""
"RTN","FHOMSS2",15,0)
 .W ! K DIC S DIC=119.71,DIC("A")="Select Production Facility: "
"RTN","FHOMSS2",16,0)
 .S DIC(0)="AEQZ" D ^DIC Q:$D(DUOUT)  I Y=-1 S FHSLPRO="" Q
"RTN","FHOMSS2",17,0)
 .S FHSLPRO=+Y
"RTN","FHOMSS2",18,0)
 W ! D STDATE^FHOMUTL I STDT="" Q
"RTN","FHOMSS2",19,0)
 W ! D ENDATE^FHOMUTL I ENDT="" Q
"RTN","FHOMSS2",20,0)
 D DEV,START Q
"RTN","FHOMSS2",21,0)
DEV ;get device and set up queue
"RTN","FHOMSS2",22,0)
 W ! K %ZIS,IOP S %ZIS="Q" D ^%ZIS Q:POP
"RTN","FHOMSS2",23,0)
 I '$D(IO("Q")) U IO D LIST,^%ZISC,END Q
"RTN","FHOMSS2",24,0)
 S ZTSAVE("STDT")="",ZTSAVE("ENDT")="",ZTSAVE("FHLBY")=""
"RTN","FHOMSS2",25,0)
 S ZTSAVE("FHSELOC")="",ZTSAVE("FHSLCOM")="",ZTSAVE("FHSLPRO")=""
"RTN","FHOMSS2",26,0)
 S ZTRTN="LIST^FHOMSS2",ZTDESC="Special Meals Display" D ^%ZTLOAD
"RTN","FHOMSS2",27,0)
 D ^%ZISC K %ZIS,IOP
"RTN","FHOMSS2",28,0)
 D END Q
"RTN","FHOMSS2",29,0)
LIST ; First build data in ^TMP global
"RTN","FHOMSS2",30,0)
 K ^TMP($J) S NUM=0,EX="",FHPG=0,ENDT=ENDT_.99
"RTN","FHOMSS2",31,0)
 F FHSMDT=STDT:0 S FHSMDT=$O(^FHPT("SM",FHSMDT)) Q:FHSMDT'>0!(FHSMDT>ENDT)!(EX=U)  D
"RTN","FHOMSS2",32,0)
 .S FHSMDTX=$E(FHSMDT,1,7)
"RTN","FHOMSS2",33,0)
 .S FHDFN=$O(^FHPT("SM",FHSMDT,"")) D PATNAME^FHOMUTL
"RTN","FHOMSS2",34,0)
 .S FHNODE=$G(^FHPT(FHDFN,"SM",FHSMDT,0)),FHSTAT=$P(FHNODE,U,2)
"RTN","FHOMSS2",35,0)
 .I FHSTAT="C" Q
"RTN","FHOMSS2",36,0)
 .S FHLOC=$P(FHNODE,U,3) Q:FHLOC=""  I FHLBY="L",FHSELOC'=FHLOC Q
"RTN","FHOMSS2",37,0)
 .S FHCOMM=$P($G(^FH(119.6,FHLOC,0)),U,8) I FHLBY="C",FHSLCOM'=FHCOMM Q
"RTN","FHOMSS2",38,0)
 .S FHPRD=$P($G(^FH(119.73,FHCOMM,0)),U,4) I FHLBY="P",FHSLPRO'=FHPRD Q
"RTN","FHOMSS2",39,0)
 .S FHPRORD=$P($G(^FH(119.6,FHLOC,0)),U,4) I FHPRORD="" S FHPRORD=99
"RTN","FHOMSS2",40,0)
 .S FHPRORD=$S(FHPRORD<1:99,FHPRORD<10:"0"_FHPRORD,1:FHPRORD)
"RTN","FHOMSS2",41,0)
 .S FHLOCNM=$P($G(^FH(119.6,FHLOC,0)),U,1),FHML=$P(FHNODE,U,9)
"RTN","FHOMSS2",42,0)
 .S FHML=$S(FHML="B":1,FHML="N":2,FHML="E":3,1:4)
"RTN","FHOMSS2",43,0)
 .S ^TMP($J,FHPRORD_"~"_FHLOCNM,FHSMDTX_"."_FHML,FHPTNM_"~"_FHDFN)=FHNODE
"RTN","FHOMSS2",44,0)
 .Q
"RTN","FHOMSS2",45,0)
 ; Now display data from the ^TMP global
"RTN","FHOMSS2",46,0)
 I '$D(^TMP($J)) W !!,"NO SPECIAL MEALS TO PRINT FOR GIVEN DATE RANGE" Q
"RTN","FHOMSS2",47,0)
 S FHLSRT="" F  S FHLSRT=$O(^TMP($J,FHLSRT)) Q:FHLSRT=""!(EX=U)  D
"RTN","FHOMSS2",48,0)
 .D:FHPG>0&(IOST?1"C".E) PG Q:EX=U
"RTN","FHOMSS2",49,0)
 .D HDR S FHPG=FHPG+1
"RTN","FHOMSS2",50,0)
 .F FHSMDT=0:0 S FHSMDT=$O(^TMP($J,FHLSRT,FHSMDT)) Q:FHSMDT'>0!(EX=U)  D
"RTN","FHOMSS2",51,0)
 ..S FHPTN="" F  S FHPTN=$O(^TMP($J,FHLSRT,FHSMDT,FHPTN)) Q:FHPTN=""!(EX=U)  D
"RTN","FHOMSS2",52,0)
 ...S FHNODE=$G(^TMP($J,FHLSRT,FHSMDT,FHPTN)),FHLOC=$P(FHNODE,U,3)
"RTN","FHOMSS2",53,0)
 ...S FHLOCZN=$G(^FH(119.6,FHLOC,0)),FHDFN=$P(FHPTN,"~",2)
"RTN","FHOMSS2",54,0)
 ...S FHSTAT=$P(FHNODE,U,2),FHSTAT=$S(FHSTAT="P":"PENDING",FHSTAT="A":"AUTH",FHSTAT="D":"DENIED",1:"CANCEL")
"RTN","FHOMSS2",55,0)
 ...S NUM=NUM+1 D PATNAME^FHOMUTL W !,$E(FHPTNM,1,20)
"RTN","FHOMSS2",56,0)
 ...S FHSMDTX=$P(FHNODE,U,1)
"RTN","FHOMSS2",57,0)
 ...S FHD=$$FMTE^XLFDT(FHSMDTX,"P") W ?22,$E(FHD,1,12)
"RTN","FHOMSS2",58,0)
 ...S FHLPT=$P(FHNODE,U,3),FHLOC=$E($P($G(^FH(119.6,FHLPT,0)),U,1),1,10)
"RTN","FHOMSS2",59,0)
 ...S FHRMBD=$P(FHNODE,U,13),FHRMBNM=""
"RTN","FHOMSS2",60,0)
 ...I FHRMBD'="" S FHRMBNM=$E($P($G(^DG(405.4,FHRMBD,0)),U,1),1,14)
"RTN","FHOMSS2",61,0)
 ...W ?36,FHRMBNM
"RTN","FHOMSS2",62,0)
 ...S FHDPT=$P(FHNODE,U,4),FHDIET=$S(FHDPT="":"",1:$E($P($G(^FH(111,FHDPT,0)),U,1),1,15))
"RTN","FHOMSS2",63,0)
 ...W ?52,FHDIET
"RTN","FHOMSS2",64,0)
 ...S FHMEAL=$P(FHNODE,U,9) W ?69,FHMEAL,?73,FHSTAT
"RTN","FHOMSS2",65,0)
 ...I $E(FHSTAT,1)="D" D
"RTN","FHOMSS2",66,0)
 ....S FHDENY=$P(FHNODE,U,6) W !?6,"Denied by: "
"RTN","FHOMSS2",67,0)
 ....I FHDENY'="" W $P($G(^VA(200,FHDENY,0)),U,1)
"RTN","FHOMSS2",68,0)
 ...S FHCMNT=$P(FHNODE,U,8) I FHCMNT'="" W !?6,"Comment: ",FHCMNT
"RTN","FHOMSS2",69,0)
 ...I $D(^FHPT(FHDFN,"SM",FHSMDTX,1)) D
"RTN","FHOMSS2",70,0)
 ....S FHEL=$G(^FHPT(FHDFN,"SM",FHSMDTX,1))
"RTN","FHOMSS2",71,0)
 ....W !?6,"Early/Late Tray Time: ",$P(FHEL,U,1)
"RTN","FHOMSS2",72,0)
 ....W "  Bagged Meal: ",$P(FHEL,U,2)
"RTN","FHOMSS2",73,0)
 ....Q
"RTN","FHOMSS2",74,0)
 ...Q
"RTN","FHOMSS2",75,0)
 ..Q
"RTN","FHOMSS2",76,0)
 .I $Y>(IOSL-4) D PG I EX=U Q
"RTN","FHOMSS2",77,0)
 .Q
"RTN","FHOMSS2",78,0)
 Q
"RTN","FHOMSS2",79,0)
PG ;
"RTN","FHOMSS2",80,0)
 I IOST?1"C".E W ! K DIR S DIR(0)="E" D ^DIR I 'Y S EX=U Q
"RTN","FHOMSS2",81,0)
 D HDR Q
"RTN","FHOMSS2",82,0)
HDR ;
"RTN","FHOMSS2",83,0)
 W:$Y @IOF
"RTN","FHOMSS2",84,0)
 W !?5,"S P E C I A L    M E A L S    S T A T U S    R E P O R T"
"RTN","FHOMSS2",85,0)
 W !!?5,"LOCATION: ",$P(FHLSRT,"~",2)
"RTN","FHOMSS2",86,0)
 W !!!,"Patient Name",?22,"Date",?36,"Room-Bed"
"RTN","FHOMSS2",87,0)
 W ?52,"Diet Ordered",?68,"Meal",?73,"Status"
"RTN","FHOMSS2",88,0)
 W !,"====================",?22,"============",?36,"=============="
"RTN","FHOMSS2",89,0)
 W ?52,"===============",?68,"====",?73,"======="
"RTN","FHOMSS2",90,0)
 Q
"RTN","FHOMSS2",91,0)
END ;
"RTN","FHOMSS2",92,0)
 K STDT,ENDT,EX,FHNODE,FHSELOC,FHSLCOM,FHSLPRO,FHPRD,FHSTAT Q
"RTN","FHOMWOR")
0^1^B25485238^B25425575
"RTN","FHOMWOR",1,0)
FHOMWOR ;Hines OIFO/RTK OUTPATIENT MEALS/HL7 MESSAGING  ;10/21/03  10:15
"RTN","FHOMWOR",2,0)
 ;;5.5;DIETETICS;**2,5,19**;Jan 28, 2005;Build 2
"RTN","FHOMWOR",3,0)
 S FHDFN="",FHZ115="P"_DFN D ADD^FHOMDPA
"RTN","FHOMWOR",4,0)
 I 'FHDFN S TXT="Outpatient not found" D GETOR^FHWOR,ERR Q
"RTN","FHOMWOR",5,0)
 ;Decode FHMSG(3) - PV1
"RTN","FHOMWOR",6,0)
 S FHX=$G(FHMSG(3))
"RTN","FHOMWOR",7,0)
 I $E(FHX,1,3)'="PV1" S TXT="3rd msg not PV1" D GETOR^FHWOR,ERR Q
"RTN","FHOMWOR",8,0)
 S FHLOC=$P($P(FHX,"|",4),U,1)
"RTN","FHOMWOR",9,0)
 I FHLOC="" S TXT="Missing Location" D GETOR^FHWOR,ERR Q
"RTN","FHOMWOR",10,0)
 S FHLOC=$O(^FH(119.6,"AL",FHLOC,""))
"RTN","FHOMWOR",11,0)
 I 'FHLOC S TXT="Invalid Location" D GETOR^FHWOR,ERR Q
"RTN","FHOMWOR",12,0)
 ;Decode FHMSG(4) - ORC
"RTN","FHOMWOR",13,0)
 S FHX=$G(FHMSG(4))
"RTN","FHOMWOR",14,0)
 I $E(FHX,1,3)'="ORC" S TXT="4th msg not ORC" D GETOR^FHWOR,ERR Q
"RTN","FHOMWOR",15,0)
 S FHORN=$P(FHX,"|",3),FHORN=+FHORN,FILL=$P(FHX,"|",4)
"RTN","FHOMWOR",16,0)
 S FHDUR=$P(FHX,"|",8),FHDOW=$P(FHDUR,U,2)
"RTN","FHOMWOR",17,0)
 S DATE=$E($P(FHDUR,U,4),1,8) D CVT^FHWOR S STDT=DATE,FHOSTDT=STDT
"RTN","FHOMWOR",18,0)
 S DATE=$P(FHDUR,U,5) D CVT^FHWOR S ENDT=DATE I ENDT'="" S ENDT=ENDT_.99
"RTN","FHOMWOR",19,0)
 I ENDT="" S ENDT=9999999.99
"RTN","FHOMWOR",20,0)
 S ACT=$P(FHX,"|",2) I ACT="CA"!(ACT="DC") D CANCEL Q
"RTN","FHOMWOR",21,0)
 I ACT="NA" D NA Q
"RTN","FHOMWOR",22,0)
 I ACT="SS" D OMSTAT^FHWORR Q
"RTN","FHOMWOR",23,0)
 I ACT'="NW" S TXT="Action not NW, CA or DC" D GETOR^FHWOR,ERR Q
"RTN","FHOMWOR",24,0)
 D NOW^%DTC S FHNOW=$P(%,".",1)
"RTN","FHOMWOR",25,0)
 I STDT=""!(STDT<FHNOW) S TXT="Start Date not valid" D GETOR^FHWOR,ERR Q
"RTN","FHOMWOR",26,0)
 I ENDT<STDT S TXT="End Date not valid" D GETOR^FHWOR,ERR Q
"RTN","FHOMWOR",27,0)
 S FHPV=$P(FHX,"|",13),FHEFF=$P(FHX,"|",16)
"RTN","FHOMWOR",28,0)
 I FHEFF="" S TXT="No effective date" D ERR Q
"RTN","FHOMWOR",29,0)
 ;Decode FHMSG(5) - ODS/ODT
"RTN","FHOMWOR",30,0)
 S FHX=$G(FHMSG(5))
"RTN","FHOMWOR",31,0)
 S FHINST=$P(FHX,"|",4),FHBAG="N" I FHINST="bagged" S FHBAG="Y"
"RTN","FHOMWOR",32,0)
 S FHSVCP=$P($P(FHX,"|",3),U,4)
"RTN","FHOMWOR",33,0)
 I $E(FHX,1,3)="ODT" D HL7SET^FHOMRE1 Q  ;EARLY/LATE
"RTN","FHOMWOR",34,0)
 I $E(FHX,1,3)="OBR" D HL7SET^FHOMIP Q  ;ISOLATION/PRECAUTION
"RTN","FHOMWOR",35,0)
 I $E(FHX,1,3)'="ODS" S TXT="5th message not ODT or ODS as expected" D GETOR^FHWOR,ERR Q
"RTN","FHOMWOR",36,0)
 S FHTYPC=$P(FHX,"|",2) I FHTYPC="ZE" D HL7SET^FHOMRT1 Q  ;TUBEFEEDING
"RTN","FHOMWOR",37,0)
 S FHDTX=$P(FHX,"|",4),FHDIET=$P(FHDTX,U,4),FHDTX=$E(FHDTX,4,$L(FHDTX))
"RTN","FHOMWOR",38,0)
 S FHCOM=$P(FHX,"|",5),FHM3=$P(FHX,"|",3)
"RTN","FHOMWOR",39,0)
 I $E(FHDTX,1,4)="FH-6" D HL7SET^FHOMRA1 Q  ;ADDITIONAL ORDERS
"RTN","FHOMWOR",40,0)
 S FHMEAL=$S(FHM3=1:"B",FHM3=3:"N",FHM3=5:"E",1:"")
"RTN","FHOMWOR",41,0)
 I FHMEAL="" S TXT="Meal missing" D GETOR^FHWOR,ERR Q
"RTN","FHOMWOR",42,0)
 I FHDIET="" S TXT="Missing diet" D GETOR^FHWOR,ERR Q
"RTN","FHOMWOR",43,0)
 I '$D(^FH(111,FHDIET)) S TXT="Invalid diet" D GETOR^FHWOR,ERR Q
"RTN","FHOMWOR",44,0)
 I FHTYPC="S" D SM  ;SPECIAL MEAL REQUEST
"RTN","FHOMWOR",45,0)
 I FHTYPC="D" D RM I $G(FHAIL)'="" Q  ;RECURRING MEAL ORDER
"RTN","FHOMWOR",46,0)
 D SEND^FHWOR Q
"RTN","FHOMWOR",47,0)
SM ; Special Meal Request
"RTN","FHOMWOR",48,0)
 ; FHDFN,FHLOC set at top of FHOMWOR
"RTN","FHOMWOR",49,0)
 D NOW^%DTC S FHNOW=%
"RTN","FHOMWOR",50,0)
 S FHDUZ=$P($G(FHMSG(4)),"|",11),FHSTAT="P",FHRMBD=""
"RTN","FHOMWOR",51,0)
 I FHDUZ'="",$D(^XUSEC("FHAUTH",FHDUZ)) S FHSTAT="A"
"RTN","FHOMWOR",52,0)
 S FHQEL=1 D SETNODE^FHOMSR1
"RTN","FHOMWOR",53,0)
 S FILL="S;"_FHSMID
"RTN","FHOMWOR",54,0)
 Q
"RTN","FHOMWOR",55,0)
RM ;
"RTN","FHOMWOR",56,0)
 ; Recurring orders from CPRS will only have ONE diet, not up to 5 like
"RTN","FHOMWOR",57,0)
 ; for NonVA patients/inpatients therefore can set FHDIETX1-5 = NULL
"RTN","FHOMWOR",58,0)
 ; FHDFN,FHLOC set at top of FHOMWOR
"RTN","FHOMWOR",59,0)
 S FHMPNUM=$O(^FHPT(FHDFN,"OP","C",""),-1) I FHMPNUM="" S FHMPNUM=0
"RTN","FHOMWOR",60,0)
 S FHMPNUM=FHMPNUM+1
"RTN","FHOMWOR",61,0)
 S (FHAIL,FHRMBD,FHDIETX(1),FHDIETX(2),FHDIETX(3),FHDIETX(4),FHDIETX(5))=""
"RTN","FHOMWOR",62,0)
 S (C,FHENDL)=0,STDTLP=STDT,FHDZ="" F  Q:FHENDL=1  D
"RTN","FHOMWOR",63,0)
 .S X=STDTLP D H^%DTC S:%Y=0 %Y=7 S FHDZ=FHDZ_%Y_"^",X1=STDTLP,X2=1
"RTN","FHOMWOR",64,0)
 .D C^%DTC S STDTLP=X,C=C+1 I STDTLP>ENDT!(C>6) S FHENDL=1 Q
"RTN","FHOMWOR",65,0)
 S FHDAYS="" F FHH=1:1:7 S FHPCE=$P(FHDOW,"~",FHH) Q:FHPCE=""  D
"RTN","FHOMWOR",66,0)
 .S FHD3=$E(FHPCE,3)
"RTN","FHOMWOR",67,0)
 .I FHD3'>0,FHD3'<8 Q
"RTN","FHOMWOR",68,0)
 .I FHDZ'[FHD3 Q
"RTN","FHOMWOR",69,0)
 .S FHDAYS=FHDAYS_$E("MTWRFSX",FHD3)
"RTN","FHOMWOR",70,0)
 I FHDAYS="",$E(STDT,1,7)'=$E(ENDT,1,7) S (TXT,FHAIL)="Day of week invalid or not within date range" D GETOR^FHWOR,ERR Q
"RTN","FHOMWOR",71,0)
 I FHDAYS="",$E(STDT,1,7)=$E(ENDT,1,7) S X=$E(STDT,1,7) D DOW^%DTC S FHDAYS=$E("XMTWRFS",Y+1)
"RTN","FHOMWOR",72,0)
 D SETNODE^FHOMRO1
"RTN","FHOMWOR",73,0)
 S FILL="R;"_FHMPNUM_";"_STDT_";"_ENDT_";"_FHDAYS_";"_FHMEAL
"RTN","FHOMWOR",74,0)
 Q
"RTN","FHOMWOR",75,0)
CANCEL ;Cancel outpatient orders
"RTN","FHOMWOR",76,0)
 S FHENDT=ENDT,FHX=$G(FHMSG(4)),FILL=$P(FHX,"|",4),FHMPNUM=""
"RTN","FHOMWOR",77,0)
 S FHORSAV=FHORN,FHILSAV=FILL,FHACTSV=ACT
"RTN","FHOMWOR",78,0)
 S FHTYPE=$P(FILL,";",1) I FHTYPE="R" S FHMPNUM=$P(FILL,";",2)
"RTN","FHOMWOR",79,0)
 I "AEIGSRT"'[FHTYPE S TXT="Invalid cancel code" D ERR Q
"RTN","FHOMWOR",80,0)
 S X1=STDT,X2=-1 D C^%DTC S STDT1=X
"RTN","FHOMWOR",81,0)
 I "AET"[FHTYPE F FHRMDT=STDT1:0 S FHRMDT=$O(^FHPT(FHDFN,"OP","B",FHRMDT)) Q:FHRMDT'>0!(FHRMDT>FHENDT)  D
"RTN","FHOMWOR",82,0)
 .F FHRNUM=0:0 S FHRNUM=$O(^FHPT(FHDFN,"OP","B",FHRMDT,FHRNUM)) Q:FHRNUM'>0  D
"RTN","FHOMWOR",83,0)
 ..I FHTYPE="A" D CANAO^FHOMRC1 Q
"RTN","FHOMWOR",84,0)
 ..I FHTYPE="E" D CANEL^FHOMRC1 Q
"RTN","FHOMWOR",85,0)
 ..I FHTYPE="T" D CANTF^FHOMRC1 Q
"RTN","FHOMWOR",86,0)
 I FHTYPE="R" F FHRNUM=0:0 S FHRNUM=$O(^FHPT(FHDFN,"OP","C",FHMPNUM,FHRNUM)) Q:FHRNUM'>0  S FHRMDT=$P($G(^FHPT(FHDFN,"OP",FHRNUM,0)),U,1) D CANRM^FHOMRC1,ASSOC^FHOMRC2
"RTN","FHOMWOR",87,0)
 I FHTYPE="I" D CAN^FHOMIP
"RTN","FHOMWOR",88,0)
 I FHTYPE="S" S FHSMID=$P(FILL,";",2),FHCDT=FHDFN_"^"_FHSMID D CAN^FHOMSC1,CNSMEL^FHOMRC2  ;cancel a SM and associated SM Late Tray
"RTN","FHOMWOR",89,0)
 I FHTYPE="G" S FHSMID=$P(FILL,";",2),FHCDT=FHDFN_"^"_FHSMID D CNSMEL^FHOMRC2  ;cancel a SM Late Tray only
"RTN","FHOMWOR",90,0)
 S FHORN=FHORSAV,FILL=FHILSAV,ACT=FHACTSV D CSEND^FHWOR Q
"RTN","FHOMWOR",91,0)
 Q
"RTN","FHOMWOR",92,0)
NA ;Number assign for outpatient
"RTN","FHOMWOR",93,0)
 S FILL=$P(FHX,"|",4)
"RTN","FHOMWOR",94,0)
 S FHTYPE=$P(FILL,";",1) S (FHMPN,FHRNUM)=+$P(FILL,";",2)
"RTN","FHOMWOR",95,0)
 D NA^FHOMWOR1
"RTN","FHOMWOR",96,0)
 Q
"RTN","FHOMWOR",97,0)
ERR ;
"RTN","FHOMWOR",98,0)
 K MSG D RMSH^FHWOR  ;Sets MSG(1) & MSG(2)
"RTN","FHOMWOR",99,0)
 S ACT="UA" I $P(FHMSG(4),"|",2)="CA" S ACT="U"_$E($P(FHMSG(4),"|",2),1)
"RTN","FHOMWOR",100,0)
 S $P(MSG(3),"|",1,2)="ORC|"_ACT,$P(MSG(3),"|",3)=FHORN
"RTN","FHOMWOR",101,0)
 S $P(MSG(3),"|",4)=$P(FHMSG(3),"|",4)
"RTN","FHOMWOR",102,0)
 S $P(MSG(3),"|",13)=$P(FHMSG(3),"|",13)
"RTN","FHOMWOR",103,0)
 S $P(MSG(3),"|",16)=$P(FHMSG(3),"|",16),$P(MSG(3),"|",17)=TXT
"RTN","FHOMWOR",104,0)
 ;
"RTN","FHOMWOR",105,0)
 ;W ! F RK=0:0 S RK=$O(MSG(RK)) Q:RK'>0  W !,"  MSG"_RK_"= ",MSG(RK)
"RTN","FHOMWOR",106,0)
 ;F RK=0:0 S RK=$O(FHMSG(RK)) Q:RK'>0  W !,"FHMSG"_RK_"= ",FHMSG(RK)
"RTN","FHOMWOR",107,0)
 ;W !!,"TXT=",TXT,!!
"RTN","FHOMWOR",108,0)
 ;
"RTN","FHOMWOR",109,0)
 D EVSEND^FHWOR Q
"RTN","FHOMWOR",110,0)
 Q
"VER")
8.0^22.0
"BLD",7827,6)
^19
**END**
**END**
