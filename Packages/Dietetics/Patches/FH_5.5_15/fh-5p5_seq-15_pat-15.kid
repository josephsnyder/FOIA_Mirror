Released FH*5.5*15 SEQ #15
Extracted from mail message
**KIDS**:FH*5.5*15^

**INSTALL NAME**
FH*5.5*15
"BLD",7668,0)
FH*5.5*15^DIETETICS^0^3080229^y
"BLD",7668,4,0)
^9.64PA^^
"BLD",7668,6.3)
2
"BLD",7668,"ABPKG")
n
"BLD",7668,"KRN",0)
^9.67PA^8989.52^19
"BLD",7668,"KRN",.4,0)
.4
"BLD",7668,"KRN",.4,"NM",0)
^9.68A^^
"BLD",7668,"KRN",.401,0)
.401
"BLD",7668,"KRN",.402,0)
.402
"BLD",7668,"KRN",.403,0)
.403
"BLD",7668,"KRN",.5,0)
.5
"BLD",7668,"KRN",.84,0)
.84
"BLD",7668,"KRN",3.6,0)
3.6
"BLD",7668,"KRN",3.8,0)
3.8
"BLD",7668,"KRN",9.2,0)
9.2
"BLD",7668,"KRN",9.8,0)
9.8
"BLD",7668,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",7668,"KRN",9.8,"NM",1,0)
FHDCR1A^^0^B48033927
"BLD",7668,"KRN",9.8,"NM",2,0)
FHORE21^^0^B31634756
"BLD",7668,"KRN",9.8,"NM",3,0)
FHOMCBRP^^0^B31341657
"BLD",7668,"KRN",9.8,"NM","B","FHDCR1A",1)

"BLD",7668,"KRN",9.8,"NM","B","FHOMCBRP",3)

"BLD",7668,"KRN",9.8,"NM","B","FHORE21",2)

"BLD",7668,"KRN",19,0)
19
"BLD",7668,"KRN",19.1,0)
19.1
"BLD",7668,"KRN",101,0)
101
"BLD",7668,"KRN",409.61,0)
409.61
"BLD",7668,"KRN",771,0)
771
"BLD",7668,"KRN",870,0)
870
"BLD",7668,"KRN",8989.51,0)
8989.51
"BLD",7668,"KRN",8989.52,0)
8989.52
"BLD",7668,"KRN",8994,0)
8994
"BLD",7668,"KRN","B",.4,.4)

"BLD",7668,"KRN","B",.401,.401)

"BLD",7668,"KRN","B",.402,.402)

"BLD",7668,"KRN","B",.403,.403)

"BLD",7668,"KRN","B",.5,.5)

"BLD",7668,"KRN","B",.84,.84)

"BLD",7668,"KRN","B",3.6,3.6)

"BLD",7668,"KRN","B",3.8,3.8)

"BLD",7668,"KRN","B",9.2,9.2)

"BLD",7668,"KRN","B",9.8,9.8)

"BLD",7668,"KRN","B",19,19)

"BLD",7668,"KRN","B",19.1,19.1)

"BLD",7668,"KRN","B",101,101)

"BLD",7668,"KRN","B",409.61,409.61)

"BLD",7668,"KRN","B",771,771)

"BLD",7668,"KRN","B",870,870)

"BLD",7668,"KRN","B",8989.51,8989.51)

"BLD",7668,"KRN","B",8989.52,8989.52)

"BLD",7668,"KRN","B",8994,8994)

"BLD",7668,"QUES",0)
^9.62^^
"BLD",7668,"REQB",0)
^9.611^3^3
"BLD",7668,"REQB",1,0)
FH*5.5*5^2
"BLD",7668,"REQB",2,0)
FH*5.5*1^2
"BLD",7668,"REQB",3,0)
FH*5.5*8^2
"BLD",7668,"REQB","B","FH*5.5*1",2)

"BLD",7668,"REQB","B","FH*5.5*5",1)

"BLD",7668,"REQB","B","FH*5.5*8",3)

"MBREQ")
0
"PKG",122,-1)
1^1
"PKG",122,0)
DIETETICS^FH^Dietetics System
"PKG",122,20,0)
^9.402P^^
"PKG",122,22,0)
^9.49I^1^1
"PKG",122,22,1,0)
5.5^3050202^3050308^33227
"PKG",122,22,1,"PAH",1,0)
15^3080229
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","FHDCR1A")
0^1^B48033927^B45241377
"RTN","FHDCR1A",1,0)
FHDCR1A ; HISC/REL/NCA/RVD - Build Diet Cards ;1/21/99  14:04
"RTN","FHDCR1A",2,0)
 ;;5.5;DIETETICS;**1,5,15**;Jan 28, 2005;Build 2
"RTN","FHDCR1A",3,0)
 ;patch #5 - added the screen for cancelled Guest meal.
"RTN","FHDCR1A",4,0)
 ;patch #15 - added the screen to prevent reprint of outpatient meal diet cards
"RTN","FHDCR1A",5,0)
B1 ; Store wards
"RTN","FHDCR1A",6,0)
 K ^TMP($J),NN,N,P S MFLG=0 D Q1^FHDCR1B D NOW^%DTC S (DTP,TIM)=% D DTP^FH S HD=DTP S:MEAL="A" MFLG=1
"RTN","FHDCR1A",7,0)
 S DTP=D1 D DTP^FH S (MDT,MEALDT)=DTP,MEALDT=$J("",62-$L(MEALDT)\2)_MEALDT
"RTN","FHDCR1A",8,0)
 S FHBOT=$P($G(^FH(119.9,1,4)),"^",1)
"RTN","FHDCR1A",9,0)
 S FHD1=D1-.00001,FHD2=D1+.99999
"RTN","FHDCR1A",10,0)
 S FHDFNSAV="",FHW1SAV=W1,FHFHPSAV=FHP,FHMEALSA=MEAL
"RTN","FHDCR1A",11,0)
 S:$G(FHDFN) FHDFNSAV=FHDFN
"RTN","FHDCR1A",12,0)
 I $G(DFN),'$D(^DPT(DFN,.1)) G OUTALL
"RTN","FHDCR1A",13,0)
 I '$G(DFN),$G(FHDFN) G OUTALL
"RTN","FHDCR1A",14,0)
 ;next process inpatient data
"RTN","FHDCR1A",15,0)
DFN I $G(DFN),$G(FHDFN) D  Q
"RTN","FHDCR1A",16,0)
 .S ADM=+$G(^DPT(DFN,.105)),W1=+$P($G(^FHPT(FHDFN,"A",+ADM,0)),"^",8)
"RTN","FHDCR1A",17,0)
 .S K1=$G(^FH(119.6,+W1,0)),WRDN=$P(K1,"^",1),SP=$P(K1,"^",5),SP1=$P(K1,"^",6),FHPAR=$P(K1,"^",24),RM=$G(^DPT(DFN,.101))
"RTN","FHDCR1A",18,0)
 .I 'SP Q:FHPAR'="Y"  S SP=SP1 Q:'SP
"RTN","FHDCR1A",19,0)
 .K PP,S,MM S NBR=0
"RTN","FHDCR1A",20,0)
 .I 'TPP D BLD^FHDCR11 D:NBR UPD,PRT^FHDCR1C Q
"RTN","FHDCR1A",21,0)
 .I 'MFLG D BLD^FHDCR1D D:NBR UPD,PRT^FHMTK1C Q
"RTN","FHDCR1A",22,0)
 .F MEAL="B","N","E" D BLD^FHDCR1D
"RTN","FHDCR1A",23,0)
 .D UPD
"RTN","FHDCR1A",24,0)
 .D:NBR PRT^FHMTK1C
"RTN","FHDCR1A",25,0)
 ;if ward, do specific ward/location;otherwise, do all entry for all
"RTN","FHDCR1A",26,0)
 ;wards/locations and all communication offices.
"RTN","FHDCR1A",27,0)
WARD I W1 S ^TMP($J,"W","01"_$P($G(^FH(119.6,+W1,0)),"^",1))=W1_"^"_$P($G(^FH(119.6,+W1,0)),"^",5,6)_"^"_$P($G(^FH(119.6,+W1,0)),"^",24)
"RTN","FHDCR1A",28,0)
 E  F W1=0:0 S W1=$O(^FH(119.6,W1)) Q:W1<1  D
"RTN","FHDCR1A",29,0)
 .S P0=$G(^FH(119.6,W1,0)),WRDN=$P(P0,"^",1),SP=$P(P0,"^",5,6),D2=$P(P0,"^",8),FHPAR=$P(P0,"^",24),P0=$P(P0,"^",4),P0=$S(P0<1:99,P0<10:"0"_P0,1:P0)
"RTN","FHDCR1A",30,0)
 .I FHP,D2'=FHP Q
"RTN","FHDCR1A",31,0)
 .S ^TMP($J,"W",P0_WRDN)=W1_"^"_SP_"^"_FHPAR Q
"RTN","FHDCR1A",32,0)
 S NX="" F  S NX=$O(^TMP($J,"W",NX)) Q:NX=""  S X1=$G(^(NX)),W1=+X1,FHS=$P(X1,"^",2),SP1=$P(X1,"^",3),FHPAR=$P(X1,"^",4),WRDN=$E(NX,3,99) S:'FHS&(FHPAR="Y") FHS=SP1 I FHS K ^TMP($J,"D") D
"RTN","FHDCR1A",33,0)
 .F FHDFN=0:0 S FHDFN=$O(^FHPT("AW",W1,FHDFN)) Q:FHDFN<1  D
"RTN","FHDCR1A",34,0)
 ..D PATNAME^FHOMUTL Q:'$G(DFN)
"RTN","FHDCR1A",35,0)
 ..S ADM=$G(^FHPT("AW",W1,FHDFN))
"RTN","FHDCR1A",36,0)
 ..I SORT="A" S RM=$P($G(^DPT(DFN,0)),"^",1),DL=0,RMB=$G(^DPT(DFN,.101)) S:RMB="" RMB="***"
"RTN","FHDCR1A",37,0)
 ..E  S RI=$G(^DPT(DFN,.108)),RM=$G(^DPT(DFN,.101)) S:RM="" RM="***" S:RI RE=$O(^FH(119.6,"AR",+RI,W1,0)) S:'RI RE="" S DL=$S(RE:$P($G(^FH(119.6,W1,"R",+RE,0)),"^",2),1:""),RMB=""
"RTN","FHDCR1A",38,0)
 ..S DL=$S(DL<1:99,DL<10:"0"_DL,1:DL)
"RTN","FHDCR1A",39,0)
 ..S ^TMP($J,"D",DL_"~"_RM_"~"_$S(SORT="R":DFN,1:RMB))=DFN_"^"_ADM_"^"_FHDFN Q
"RTN","FHDCR1A",40,0)
 .;
"RTN","FHDCR1A",41,0)
 .K ^TMP($J,"MP"),^TMP($J,0),MM,PP,S S X9="",NBR=0 F  S X9=$O(^TMP($J,"D",X9)) Q:X9=""  S FHX6=$G(^(X9)) S DFN=$P(FHX6,"^",1),ADM=$P(FHX6,"^",2) D
"RTN","FHDCR1A",42,0)
 ..S FHDFN=$P(FHX6,"^",3)
"RTN","FHDCR1A",43,0)
 ..S RM=$S(SORT="R":$P(X9,"~",2),1:$P(X9,"~",3)) S SP=FHS
"RTN","FHDCR1A",44,0)
 ..I TPP D  Q
"RTN","FHDCR1A",45,0)
 ...I 'MFLG D BLD^FHDCR1D,UPD Q
"RTN","FHDCR1A",46,0)
 ...F MEAL="B","N","E" D BLD^FHDCR1D
"RTN","FHDCR1A",47,0)
 ...D UPD
"RTN","FHDCR1A",48,0)
 ...Q
"RTN","FHDCR1A",49,0)
 ..I 'TPP D BLD^FHDCR11 D UPD Q
"RTN","FHDCR1A",50,0)
 .I NBR,TPP D PRT^FHMTK1C Q
"RTN","FHDCR1A",51,0)
 .D:NBR PRT^FHDCR1C
"RTN","FHDCR1A",52,0)
 ;
"RTN","FHDCR1A",53,0)
OUTALL K ^TMP($J,"D")   ;reset/clean-up tmp global outpatient process.
"RTN","FHDCR1A",54,0)
 ;process outpatient data
"RTN","FHDCR1A",55,0)
 ;next recurring
"RTN","FHDCR1A",56,0)
 F FHK1=FHD1:0 S FHK1=$O(^FHPT("RM",FHK1)) Q:(FHK1'>0)!(FHK1>FHD2)  D
"RTN","FHDCR1A",57,0)
 .F FHDFN=0:0 S FHDFN=$O(^FHPT("RM",FHK1,FHDFN)) Q:FHDFN'>0  D
"RTN","FHDCR1A",58,0)
 ..F FHKD=0:0 S FHKD=$O(^FHPT("RM",FHK1,FHDFN,FHKD)) Q:FHKD'>0  D
"RTN","FHDCR1A",59,0)
 ...S FHKDAT=^FHPT(FHDFN,"OP",FHKD,0)
"RTN","FHDCR1A",60,0)
 ...S (W1,FHW1)=$P(FHKDAT,U,3)
"RTN","FHDCR1A",61,0)
 ...S FHRMB=$P(FHKDAT,U,18)
"RTN","FHDCR1A",62,0)
 ...S FHDIET=$P(FHKDAT,U,2),FHMEAL=$P(FHKDAT,U,4),FHDCLP=$P(FHKDAT,U,14),FHSTAT=$P(FHKDAT,U,15),FHDRMLE=$P(FHKDAT,U,16)
"RTN","FHDCR1A",63,0)
 ...S:FHDIET="" FHDIET=$E(FHKDAT,7,11)
"RTN","FHDCR1A",64,0)
 ...I (FHMEALSA'="A"),(FHMEAL'=FHMEALSA) Q
"RTN","FHDCR1A",65,0)
 ...I FHSTAT="C" Q
"RTN","FHDCR1A",66,0)
 ...I UPD,FHDCLP'="",FHDRMLE="" Q
"RTN","FHDCR1A",67,0)
 ...I UPD,FHDCLP'="",FHDRMLE'="",FHDCLP>FHDRMLE Q
"RTN","FHDCR1A",68,0)
 ...I $G(FHW1SAV),(FHW1'=FHW1SAV) Q
"RTN","FHDCR1A",69,0)
 ...I $G(FHDFNSAV),(FHDFN'=FHDFNSAV) Q
"RTN","FHDCR1A",70,0)
 ...S FHLOC="",FHRGS="OP"
"RTN","FHDCR1A",71,0)
 ...Q:'$G(FHW1)
"RTN","FHDCR1A",72,0)
 ...S:$D(^FH(119.6,FHW1,0)) FHLOC=$P(^FH(119.6,FHW1,0),U,8)
"RTN","FHDCR1A",73,0)
 ...I $G(FHFHPSAV),$G(FHLOC),(FHFHPSAV'=FHLOC) Q
"RTN","FHDCR1A",74,0)
 ...S FHDFN1=$P(^FHPT(FHDFN,0),U,1)
"RTN","FHDCR1A",75,0)
 ...I $G(FHW1SAV)!($G(FHFHPSAV)) D OUTW Q
"RTN","FHDCR1A",76,0)
 ...I $G(FHDFNSAV) D OUTP Q
"RTN","FHDCR1A",77,0)
 ...D OUTW
"RTN","FHDCR1A",78,0)
 ;next guest
"RTN","FHDCR1A",79,0)
 F FHKD=FHD1:0 S FHKD=$O(^FHPT("GM",FHKD)) Q:(FHKD'>0)!(FHKD>FHD2)  D
"RTN","FHDCR1A",80,0)
 .F FHDFN=0:0 S FHDFN=$O(^FHPT("GM",FHKD,FHDFN)) Q:FHDFN'>0  D
"RTN","FHDCR1A",81,0)
 ..S FHKDAT=^FHPT(FHDFN,"GM",FHKD,0)
"RTN","FHDCR1A",82,0)
 ..S (W1,FHW1)=$P(FHKDAT,U,5)
"RTN","FHDCR1A",83,0)
 ..S FHSTAT=$P(FHKDAT,U,9),FHDCLP=$P(FHKDAT,U,8)
"RTN","FHDCR1A",84,0)
 ..Q:FHSTAT="C"
"RTN","FHDCR1A",85,0)
 ..I UPD,FHDCLP'="" Q
"RTN","FHDCR1A",86,0)
 ..S FHRMB=$P(FHKDAT,U,11)
"RTN","FHDCR1A",87,0)
 ..S FHDIET=$P(FHKDAT,U,6),FHMEAL=$P(FHKDAT,U,3)
"RTN","FHDCR1A",88,0)
 ..I (FHMEALSA'="A"),(FHMEAL'=FHMEALSA) Q
"RTN","FHDCR1A",89,0)
 ..I $G(FHW1SAV),(FHW1'=FHW1SAV) Q
"RTN","FHDCR1A",90,0)
 ..I $G(FHDFNSAV),(FHDFN'=FHDFNSAV) Q
"RTN","FHDCR1A",91,0)
 ..S FHLOC="",FHRGS="GM"
"RTN","FHDCR1A",92,0)
 ..Q:'$G(FHW1)
"RTN","FHDCR1A",93,0)
 ..S:$D(^FH(119.6,FHW1,0)) FHLOC=$P(^FH(119.6,FHW1,0),U,8)
"RTN","FHDCR1A",94,0)
 ..I $G(FHFHPSAV),$G(FHLOC),(FHFHPSAV'=FHLOC) Q
"RTN","FHDCR1A",95,0)
 ..S FHDFN1=$P(^FHPT(FHDFN,0),U,1)
"RTN","FHDCR1A",96,0)
 ..I $G(FHW1SAV)!($G(FHFHPSAV)) D OUTW Q
"RTN","FHDCR1A",97,0)
 ..I $G(FHDFNSAV) D OUTP Q
"RTN","FHDCR1A",98,0)
 ..D OUTW
"RTN","FHDCR1A",99,0)
 ;next SPECIAL
"RTN","FHDCR1A",100,0)
 F FHKD=FHD1:0 S FHKD=$O(^FHPT("SM",FHKD)) Q:(FHKD'>0)!(FHKD>FHD2)  D
"RTN","FHDCR1A",101,0)
 .F FHDFN=0:0 S FHDFN=$O(^FHPT("SM",FHKD,FHDFN)) Q:FHDFN'>0  D
"RTN","FHDCR1A",102,0)
 ..S FHKDAT=^FHPT(FHDFN,"SM",FHKD,0)
"RTN","FHDCR1A",103,0)
 ..S (W1,FHW1)=$P(FHKDAT,U,3)
"RTN","FHDCR1A",104,0)
 ..S FHRMB=$P(FHKDAT,U,13)
"RTN","FHDCR1A",105,0)
 ..S FHDFN1=$P(^FHPT(FHDFN,0),U,1)
"RTN","FHDCR1A",106,0)
 ..S FHDIET=$P(FHKDAT,U,4),FHMEAL=$P(FHKDAT,U,9),FHSTAT=$P(FHKDAT,U,2),FHDCLP=$P(FHKDAT,U,11)
"RTN","FHDCR1A",107,0)
 ..I (FHMEALSA'="A"),(FHMEAL'=FHMEALSA) Q
"RTN","FHDCR1A",108,0)
 ..I (FHSTAT="C")!(FHSTAT="D") Q
"RTN","FHDCR1A",109,0)
 ..I UPD,FHDCLP'="" Q
"RTN","FHDCR1A",110,0)
 ..I $G(FHW1SAV),(FHW1'=FHW1SAV) Q
"RTN","FHDCR1A",111,0)
 ..I $G(FHDFNSAV),(FHDFN'=FHDFNSAV) Q
"RTN","FHDCR1A",112,0)
 ..S FHLOC="",FHRGS="SM"
"RTN","FHDCR1A",113,0)
 ..Q:'$G(FHW1)
"RTN","FHDCR1A",114,0)
 ..S:$D(^FH(119.6,FHW1,0)) FHLOC=$P(^FH(119.6,FHW1,0),U,8)
"RTN","FHDCR1A",115,0)
 ..I $G(FHFHPSAV),$G(FHLOC),(FHFHPSAV'=FHLOC) Q
"RTN","FHDCR1A",116,0)
 ..S FHDFN1=$P(^FHPT(FHDFN,0),U,1)
"RTN","FHDCR1A",117,0)
 ..I $G(FHW1SAV)!($G(FHFHPSAV)) D OUTW Q
"RTN","FHDCR1A",118,0)
 ..I $G(FHDFNSAV) D OUTP Q
"RTN","FHDCR1A",119,0)
 ..D OUTW
"RTN","FHDCR1A",120,0)
 ;
"RTN","FHDCR1A",121,0)
 K ^TMP($J,"MP"),^TMP($J,0),MM,PP,S S X9="",NBR=0 F  S X9=$O(^TMP($J,"D",X9)) Q:X9=""  S FHX6=$G(^(X9)) S FHDFN=$P(FHX6,"^",1),ADM=$P(FHX6,"^",2) D
"RTN","FHDCR1A",122,0)
 .S RM=$S(SORT="R":$P(X9,"~",2),1:$P(X9,"~",3)) S SP=FHS
"RTN","FHDCR1A",123,0)
 .S FHDFN=$P(FHX6,"^",1),FHRGS=$P(FHX6,"^",2)
"RTN","FHDCR1A",124,0)
 .D PATNAME^FHOMUTL
"RTN","FHDCR1A",125,0)
 .S FHKD=$P(FHX6,"^",3),W1=$P(FHX6,"^",4)
"RTN","FHDCR1A",126,0)
 .Q:$G(FHRGS)!('$G(FHKD))
"RTN","FHDCR1A",127,0)
 .S FHSTAT="",FHADM=FHKD
"RTN","FHDCR1A",128,0)
 .S FHKDAT=$G(^FHPT(FHDFN,""_FHRGS_"",FHKD,0))
"RTN","FHDCR1A",129,0)
 .I FHRGS="GM" S W1=$P(FHKDAT,U,5),FHDIET=$P(FHKDAT,U,6),FHMEAL=$P(FHKDAT,U,3)
"RTN","FHDCR1A",130,0)
 .I FHRGS="OP" S W1=$P(FHKDAT,U,3),FHDIET=$P(FHKDAT,U,2),FHMEAL=$P(FHKDAT,U,4),FHSTAT=$P(FHKDAT,U,15)
"RTN","FHDCR1A",131,0)
 .I FHRGS="SM" S W1=$P(FHKDAT,U,3),FHDIET=$P(FHKDAT,U,4),FHMEAL=$P(FHKDAT,U,9),FHSTAT=$P(FHKDAT,U,2)
"RTN","FHDCR1A",132,0)
 .;don't process IF STATUS IS cancelled or denied
"RTN","FHDCR1A",133,0)
 .I (FHSTAT="C")!(FHSTAT="D") Q
"RTN","FHDCR1A",134,0)
 .S K1=$G(^FH(119.6,+W1,0)),WRDN=$P(K1,"^",1),SP=$P(K1,"^",5),SP1=$P(K1,"^",6),FHPAR=$P(K1,"^",24)
"RTN","FHDCR1A",135,0)
 .I 'SP Q:FHPAR'="Y"  S SP=SP1 Q:'SP
"RTN","FHDCR1A",136,0)
 .I TPP D  Q
"RTN","FHDCR1A",137,0)
 ..I 'MFLG,'ADM D OUT^FHDCR1D,@FHRGS Q
"RTN","FHDCR1A",138,0)
 ..F MEAL="B","N","E" D:'ADM OUT^FHDCR1D
"RTN","FHDCR1A",139,0)
 ..D:'ADM @FHRGS
"RTN","FHDCR1A",140,0)
 .I 'TPP,'ADM D OUT^FHDCR11 D @FHRGS Q
"RTN","FHDCR1A",141,0)
 I NBR,TPP D PRT^FHMTK1C Q
"RTN","FHDCR1A",142,0)
 D:NBR PRT^FHDCR1C
"RTN","FHDCR1A",143,0)
 Q
"RTN","FHDCR1A",144,0)
 ;
"RTN","FHDCR1A",145,0)
UPD ; Update Date/Time Diet Card was Printed
"RTN","FHDCR1A",146,0)
 S $P(^FHPT(FHDFN,"A",ADM,0),"^",16)=TIM Q
"RTN","FHDCR1A",147,0)
OUTP ;process outpatient using patient
"RTN","FHDCR1A",148,0)
 S RM="***"
"RTN","FHDCR1A",149,0)
 S K1=$G(^FH(119.6,+W1,0)),WRDN=$P(K1,"^",1),SP=$P(K1,"^",5),SP1=$P(K1,"^",6),FHPAR=$P(K1,"^",24)
"RTN","FHDCR1A",150,0)
 I 'SP Q:FHPAR'="Y"  S SP=SP1 Q:'SP
"RTN","FHDCR1A",151,0)
 K PP,S,MM S NBR=0,FHADM=FHKD I $G(FHRMB),$D(^DG(405.4,FHRMB,0)) S RM=$P(^DG(405.4,FHRMB,0),U,1)
"RTN","FHDCR1A",152,0)
 I 'TPP D OUT^FHDCR11 D:NBR @FHRGS,PRT^FHDCR1C K ^TMP($J,"MP"),^TMP($J,0),PP,S,TT,SRT Q
"RTN","FHDCR1A",153,0)
 I 'MFLG D OUT^FHDCR1D D:NBR @FHRGS,PRT^FHMTK1C Q
"RTN","FHDCR1A",154,0)
 F MEAL="B","N","E" D OUT^FHDCR1D
"RTN","FHDCR1A",155,0)
 D @FHRGS
"RTN","FHDCR1A",156,0)
 D:NBR PRT^FHMTK1C
"RTN","FHDCR1A",157,0)
 Q
"RTN","FHDCR1A",158,0)
OP S $P(^FHPT(FHDFN,"OP",FHKD,0),"^",14)=TIM Q
"RTN","FHDCR1A",159,0)
GM S $P(^FHPT(FHDFN,"GM",FHKD,0),"^",8)=TIM Q
"RTN","FHDCR1A",160,0)
SM S $P(^FHPT(FHDFN,"SM",FHKD,0),"^",11)=TIM Q
"RTN","FHDCR1A",161,0)
 ;
"RTN","FHDCR1A",162,0)
OUTW ;process outpatient using all and ward.
"RTN","FHDCR1A",163,0)
 ;F FHDFN=0:0 S FHDFN=$O(^FHPT("AW",W1,FHDFN)) Q:FHDFN<1  D
"RTN","FHDCR1A",164,0)
 D PATNAME^FHOMUTL
"RTN","FHDCR1A",165,0)
 S (RM,RMB)="***"
"RTN","FHDCR1A",166,0)
 I $G(FHRMB),$D(^DG(405.4,FHRMB,0)) S RMB=$P(^DG(405.4,FHRMB,0),U,1)
"RTN","FHDCR1A",167,0)
 I SORT="A" S RM=FHPTNM,DL=0
"RTN","FHDCR1A",168,0)
 E  S (RI,RE,DL)="***",RM=RMB
"RTN","FHDCR1A",169,0)
 S ^TMP($J,"D",DL_"~"_RM_"~"_$S(SORT="R":FHDFN,1:RMB)_FHMEAL)=FHDFN_"^"_FHRGS_"^"_FHKD_"^"_W1
"RTN","FHDCR1A",170,0)
 Q
"RTN","FHOMCBRP")
0^3^B31341657^B30743180
"RTN","FHOMCBRP",1,0)
FHOMCBRP ;Hines OIFO/RTK COMBINED OUTPATIENT MEALS LIST  ;6/30/03  15:45
"RTN","FHOMCBRP",2,0)
 ;;5.5;DIETETICS;**5,15**;Jan 28, 2005;Build 2
"RTN","FHOMCBRP",3,0)
 ;
"RTN","FHOMCBRP",4,0)
 W @IOF,!!,"C O M B I N E D   O U T P A T I E N T   M E A L S   L I S T"
"RTN","FHOMCBRP",5,0)
EN ;
"RTN","FHOMCBRP",6,0)
 W !! K DIR S DIR("A")="Print by LOCATION, COMM OFFICE, PRODUCTION FACILITY or ALL: "
"RTN","FHOMCBRP",7,0)
 S DIR(0)="SAO^A:ALL;C:COMM OFFICE;L:LOCATION;P:PROD FACILITY" D ^DIR
"RTN","FHOMCBRP",8,0)
 Q:$D(DIRUT)  S FHLBY=Y
"RTN","FHOMCBRP",9,0)
 I FHLBY="L" W ! D OUTLOC^FHOMUTL Q:FHLOC=""  S FHSELOC=FHLOC,FHLOC=""
"RTN","FHOMCBRP",10,0)
 I FHLBY="C" D  Q:FHSLCOM=""
"RTN","FHOMCBRP",11,0)
 .W ! K DIC S DIC=119.73,DIC("A")="Select Communication Office: "
"RTN","FHOMCBRP",12,0)
 .S DIC(0)="AEQZ" D ^DIC I $D(DUOUT) S FHSLCOM="" Q
"RTN","FHOMCBRP",13,0)
 .I Y=-1 S FHSLCOM="" Q
"RTN","FHOMCBRP",14,0)
 .S FHSLCOM=+Y
"RTN","FHOMCBRP",15,0)
 I FHLBY="P" D  Q:FHSLPRO=""
"RTN","FHOMCBRP",16,0)
 .W ! K DIC S DIC=119.71,DIC("A")="Select Production Facility: "
"RTN","FHOMCBRP",17,0)
 .S DIC(0)="AEQZ" D ^DIC I $D(DUOUT) S FHSLPRO="" Q
"RTN","FHOMCBRP",18,0)
 .I Y=-1 S FHSLPRO="" Q
"RTN","FHOMCBRP",19,0)
 .S FHSLPRO=+Y
"RTN","FHOMCBRP",20,0)
 W ! D STDATE^FHOMUTL I STDT="" Q
"RTN","FHOMCBRP",21,0)
 W ! D ENDATE^FHOMUTL I ENDT="" Q
"RTN","FHOMCBRP",22,0)
 S X1=STDT,X2=-1 D C^%DTC S STDT1=X,ENDT=ENDT_.99
"RTN","FHOMCBRP",23,0)
 D DEV,EN Q
"RTN","FHOMCBRP",24,0)
DEV ;get device and set up queue
"RTN","FHOMCBRP",25,0)
 W ! K %ZIS,IOP S %ZIS="Q" D ^%ZIS Q:POP
"RTN","FHOMCBRP",26,0)
 I '$D(IO("Q")) U IO D LIST,^%ZISC,END Q
"RTN","FHOMCBRP",27,0)
 S ZTRTN="LIST^FHOMCBRP",ZTDESC="Combined Outpatient Meals Display"
"RTN","FHOMCBRP",28,0)
 S ZTSAVE("STDT")="",ZTSAVE("STDT1")="",ZTSAVE("ENDT")=""
"RTN","FHOMCBRP",29,0)
 S ZTSAVE("FHLBY")="",ZTSAVE("FHSELOC")="",ZTSAVE("FHSLCOM")=""
"RTN","FHOMCBRP",30,0)
 S ZTSAVE("FHSLPRO")="" D ^%ZTLOAD
"RTN","FHOMCBRP",31,0)
 D ^%ZISC K %ZIS,IOP
"RTN","FHOMCBRP",32,0)
 D END Q
"RTN","FHOMCBRP",33,0)
LIST ; First build data in ^TMP global
"RTN","FHOMCBRP",34,0)
 K ^TMP($J) S NUM=0,EX="",FHPG=0
"RTN","FHOMCBRP",35,0)
 ;Recurring Meals
"RTN","FHOMCBRP",36,0)
 F FHXRDT=STDT1:0 S FHXRDT=$O(^FHPT("RM",FHXRDT)) Q:FHXRDT'>0!(FHXRDT>ENDT)!(EX=U)  D
"RTN","FHOMCBRP",37,0)
 .F FHDFN=0:0 S FHDFN=$O(^FHPT("RM",FHXRDT,FHDFN)) Q:FHDFN'>0!(EX=U)  D
"RTN","FHOMCBRP",38,0)
 ..F FHRM=0:0 S FHRM=$O(^FHPT("RM",FHXRDT,FHDFN,FHRM)) Q:FHRM'>0!(EX=U)  D
"RTN","FHOMCBRP",39,0)
 ...S FHZN=$G(^FHPT(FHDFN,"OP",FHRM,0)),FHST=$P(FHZN,U,15) I FHST="C" Q
"RTN","FHOMCBRP",40,0)
 ...D PATNAME^FHOMUTL
"RTN","FHOMCBRP",41,0)
 ...S FHLOC=$P(FHZN,U,3) Q:FHLOC=""  I FHLBY="L",FHSELOC'=FHLOC Q
"RTN","FHOMCBRP",42,0)
 ...S FHCOMM=$P($G(^FH(119.6,FHLOC,0)),U,8) I FHLBY="C",FHSLCOM'=FHCOMM Q
"RTN","FHOMCBRP",43,0)
 ...S FHPRD=$P($G(^FH(119.73,FHCOMM,0)),U,4) I FHLBY="P",FHSLPRO'=FHPRD Q
"RTN","FHOMCBRP",44,0)
 ...S FHPRORD=$P($G(^FH(119.6,FHLOC,0)),U,4) I FHPRORD="" S FHPRORD=99
"RTN","FHOMCBRP",45,0)
 ...S FHPRORD=$S(FHPRORD<1:99,FHPRORD<10:"0"_FHPRORD,1:FHPRORD)
"RTN","FHOMCBRP",46,0)
 ...S FHLOCNM=$P($G(^FH(119.6,FHLOC,0)),U,1)
"RTN","FHOMCBRP",47,0)
 ...S FHML=$P(FHZN,U,4) Q:FHML=""  S FHML=$S(FHML="B":1,FHML="N":2,FHML="E":3)
"RTN","FHOMCBRP",48,0)
 ...S ^TMP($J,FHXRDT_"~"_FHML,FHPRORD_"~"_FHLOCNM_"~"_FHLOC,FHPTNM_"~"_FHDFN_"~"_FHRM)="R~"_FHZN
"RTN","FHOMCBRP",49,0)
 ...Q
"RTN","FHOMCBRP",50,0)
 ..Q
"RTN","FHOMCBRP",51,0)
 .Q
"RTN","FHOMCBRP",52,0)
 ;Special Meals
"RTN","FHOMCBRP",53,0)
 S ENDT=ENDT_.99
"RTN","FHOMCBRP",54,0)
 F FHSMDT=STDT:0 S FHSMDT=$O(^FHPT("SM",FHSMDT)) Q:FHSMDT'>0!(FHSMDT>ENDT)!(EX=U)  D
"RTN","FHOMCBRP",55,0)
 .S FHSMDTX=$E(FHSMDT,1,7)
"RTN","FHOMCBRP",56,0)
 .S FHDFN=$O(^FHPT("SM",FHSMDT,"")) D PATNAME^FHOMUTL
"RTN","FHOMCBRP",57,0)
 .S FHZN=$G(^FHPT(FHDFN,"SM",FHSMDT,0)),FHSTAT=$P(FHZN,U,2)
"RTN","FHOMCBRP",58,0)
 .I FHSTAT="C" Q
"RTN","FHOMCBRP",59,0)
 .S FHLOC=$P(FHZN,U,3) Q:FHLOC=""  I FHLBY="L",FHSELOC'=FHLOC Q
"RTN","FHOMCBRP",60,0)
 .S FHCOMM=$P($G(^FH(119.6,FHLOC,0)),U,8) I FHLBY="C",FHSLCOM'=FHCOMM Q
"RTN","FHOMCBRP",61,0)
 .S FHPRD=$P($G(^FH(119.73,FHCOMM,0)),U,4) I FHLBY="P",FHSLPRO'=FHPRD Q
"RTN","FHOMCBRP",62,0)
 .S FHPRORD=$P($G(^FH(119.6,FHLOC,0)),U,4) I FHPRORD="" S FHPRORD=99
"RTN","FHOMCBRP",63,0)
 .S FHPRORD=$S(FHPRORD<1:99,FHPRORD<10:"0"_FHPRORD,1:FHPRORD)
"RTN","FHOMCBRP",64,0)
 .S FHLOCNM=$P($G(^FH(119.6,FHLOC,0)),U,1),FHML=$P(FHZN,U,9) Q:FHML=""
"RTN","FHOMCBRP",65,0)
 .S FHML=$S(FHML="B":1,FHML="N":2,FHML="E":3)
"RTN","FHOMCBRP",66,0)
 .S ^TMP($J,FHSMDTX_"~"_FHML,FHPRORD_"~"_FHLOCNM_"~"_FHLOC,FHPTNM_"~"_FHDFN)="S~"_FHZN
"RTN","FHOMCBRP",67,0)
 .Q
"RTN","FHOMCBRP",68,0)
 ;Guest Meals
"RTN","FHOMCBRP",69,0)
 F FHGMDT=STDT:0 S FHGMDT=$O(^FHPT("GM",FHGMDT)) Q:FHGMDT'>0!(FHGMDT>ENDT)  D
"RTN","FHOMCBRP",70,0)
 .F FHDFN=0:0 S FHDFN=$O(^FHPT("GM",FHGMDT,FHDFN)) Q:FHDFN'>0  D
"RTN","FHOMCBRP",71,0)
 ..S FHZN=$G(^FHPT(FHDFN,"GM",FHGMDT,0)),FHST=$P(FHZN,U,9) I FHST="C" Q
"RTN","FHOMCBRP",72,0)
 ..D PATNAME^FHOMUTL
"RTN","FHOMCBRP",73,0)
 ..S FHLOC=$P(FHZN,U,5) Q:FHLOC=""  I FHLBY="L",FHSELOC'=FHLOC Q
"RTN","FHOMCBRP",74,0)
 ..S FHCOMM=$P($G(^FH(119.6,FHLOC,0)),U,8) I FHLBY="C",FHSLCOM'=FHCOMM Q
"RTN","FHOMCBRP",75,0)
 ..S FHPRD=$P($G(^FH(119.73,FHCOMM,0)),U,4) I FHLBY="P",FHSLPRO'=FHPRD Q
"RTN","FHOMCBRP",76,0)
 ..S FHPRORD=$P($G(^FH(119.6,FHLOC,0)),U,4) I FHPRORD="" S FHPRORD=99
"RTN","FHOMCBRP",77,0)
 ..S FHPRORD=$S(FHPRORD<1:99,FHPRORD<10:"0"_FHPRORD,1:FHPRORD)
"RTN","FHOMCBRP",78,0)
 ..S FHLOCNM=$P($G(^FH(119.6,FHLOC,0)),U,1)
"RTN","FHOMCBRP",79,0)
 ..S FHML=$P(FHZN,U,3) Q:FHML=""  S FHML=$S(FHML="B":1,FHML="N":2,FHML="E":3)
"RTN","FHOMCBRP",80,0)
 ..S FHGMDTX=$E(FHGMDT,1,7)
"RTN","FHOMCBRP",81,0)
 ..S ^TMP($J,FHGMDTX_"~"_FHML,FHPRORD_"~"_FHLOCNM_"~"_FHLOC,FHPTNM_"~"_FHDFN)="G~"_FHZN
"RTN","FHOMCBRP",82,0)
 ..Q
"RTN","FHOMCBRP",83,0)
 .Q
"RTN","FHOMCBRP",84,0)
 ; Now display data from the ^TMP global
"RTN","FHOMCBRP",85,0)
 I '$D(^TMP($J)) W !!,"NO OUTPATIENT MEALS WITHIN SELECTED PARAMETERS" Q
"RTN","FHOMCBRP",86,0)
 S FHDTML="" F  S FHDTML=$O(^TMP($J,FHDTML)) Q:FHDTML=""!(EX=U)  D
"RTN","FHOMCBRP",87,0)
 .I FHPG<1 D HDR
"RTN","FHOMCBRP",88,0)
 .S FHWDT=$P(FHDTML,"~",1),FHWML=$P(FHDTML,"~",2)
"RTN","FHOMCBRP",89,0)
 .S FHWDT=$$FMTE^XLFDT(FHWDT,"P")
"RTN","FHOMCBRP",90,0)
 .S FHWML=$S(FHWML=1:"Breakfast",FHWML=2:"Noon",1:"Evening")
"RTN","FHOMCBRP",91,0)
 .S FHPG=FHPG+1
"RTN","FHOMCBRP",92,0)
 .S FHLOC="" F  S FHLOC=$O(^TMP($J,FHDTML,FHLOC)) Q:FHLOC=""!(EX=U)  D
"RTN","FHOMCBRP",93,0)
 ..W !!,FHWDT,?14,"- ",FHWML,?28,"LOCATION: "
"RTN","FHOMCBRP",94,0)
 ..W $P(FHLOC,"~",2),!,"Patient Name",?28,"Diet",?55,"Room-Bed"
"RTN","FHOMCBRP",95,0)
 ..W !,"========================",?28,"========================"
"RTN","FHOMCBRP",96,0)
 ..W ?55,"========================"
"RTN","FHOMCBRP",97,0)
 ..S FHPTN="" F  S FHPTN=$O(^TMP($J,FHDTML,FHLOC,FHPTN)) Q:FHPTN=""!(EX=U)  D
"RTN","FHOMCBRP",98,0)
 ...S FHNODE=$G(^TMP($J,FHDTML,FHLOC,FHPTN))
"RTN","FHOMCBRP",99,0)
 ...W !,$E($P(FHPTN,"~",1),1,24)
"RTN","FHOMCBRP",100,0)
 ...S FHPCE=2 S:$E(FHNODE,1)="S" FHPCE=4 S:$E(FHNODE,1)="G" FHPCE=6
"RTN","FHOMCBRP",101,0)
 ...S FHDIET=$P(FHNODE,U,FHPCE)
"RTN","FHOMCBRP",102,0)
 ...I FHDIET'="" W ?28,$E($P($G(^FH(111,FHDIET,0)),U,1),1,24)
"RTN","FHOMCBRP",103,0)
 ...I $E(FHNODE,1)="R" I $P($G(^FH(119.6,$P(FHLOC,"~",3),1)),U,4)="Y" S FHDFN=$P(FHPTN,"~",2),FHRNUM=$P(FHPTN,"~",3) D DIETPAT^FHOMRR1 W ?28,$E(FHDIETP,1,24)
"RTN","FHOMCBRP",104,0)
 ...S FHPCE=18 S:$E(FHNODE,1)="S" FHPCE=13 S:$E(FHNODE,1)="G" FHPCE=11
"RTN","FHOMCBRP",105,0)
 ...S FHRMBD=$P(FHNODE,U,FHPCE),FHRMBNM=""
"RTN","FHOMCBRP",106,0)
 ...I FHRMBD'="" S FHRMBNM=$E($P($G(^DG(405.4,FHRMBD,0)),U,1),1,24)
"RTN","FHOMCBRP",107,0)
 ...W ?55,FHRMBNM
"RTN","FHOMCBRP",108,0)
 ...I $Y>(IOSL-4) D PG I EX=U Q
"RTN","FHOMCBRP",109,0)
 ...Q
"RTN","FHOMCBRP",110,0)
 ..Q
"RTN","FHOMCBRP",111,0)
 .Q
"RTN","FHOMCBRP",112,0)
 Q
"RTN","FHOMCBRP",113,0)
END ;
"RTN","FHOMCBRP",114,0)
 K DIR,ENDT,STDT,FHGMDT,FHGMDTX,FHRM,FHXRDT,FHSMDT,FHSMDTX,FHML,FHCL
"RTN","FHOMCBRP",115,0)
 K FHCH,FHDIET,FHLOC,FHPTN,FHSELOC,FHSLCOM,FHNODE,FHZN,FHSLPRO,FHPRD
"RTN","FHOMCBRP",116,0)
 K FHDIETP,FHPCE,FHPG
"RTN","FHOMCBRP",117,0)
 Q
"RTN","FHOMCBRP",118,0)
PG ;
"RTN","FHOMCBRP",119,0)
 I IOST?1"C".E W ! K DIR S DIR(0)="E" D ^DIR I 'Y S EX=U Q
"RTN","FHOMCBRP",120,0)
 D HDR Q
"RTN","FHOMCBRP",121,0)
HDR ;
"RTN","FHOMCBRP",122,0)
 W:$Y @IOF
"RTN","FHOMCBRP",123,0)
 W !,"C O M B I N E D   O U T P A T I E N T   M E A L S   L I S T",!!
"RTN","FHOMCBRP",124,0)
 Q
"RTN","FHORE21")
0^2^B31634756^B31608695
"RTN","FHORE21",1,0)
FHORE21 ; HISC/REL/NCA - List Early/Late Trays (cont) ;11/9/94  13:33 
"RTN","FHORE21",2,0)
 ;;5.5;DIETETICS;**5,8,15**;Jan 28, 2005;Build 2
"RTN","FHORE21",3,0)
 ;patch #5 - added outpt room-bed.
"RTN","FHORE21",4,0)
 S D1=DTE,COUNT=0,LINE=1 K ^TMP($J) S ANS=""
"RTN","FHORE21",5,0)
F2 S D1=$O(^FHPT("ADLT",D1)) G:D1<1!(D1\1'=DTE) P0 S FHDFN=0
"RTN","FHORE21",6,0)
F3 S FHDFN=$O(^FHPT("ADLT",D1,FHDFN)) G:FHDFN<1 F2 S ADM=0
"RTN","FHORE21",7,0)
F4 S ADM=$O(^FHPT("ADLT",D1,FHDFN,ADM)) G:ADM<1 F3
"RTN","FHORE21",8,0)
 I $S($D(^DGPM(ADM,0)):$P(^(0),"^",17),1:1) G F7
"RTN","FHORE21",9,0)
 S Y(0)=$G(^FHPT(FHDFN,"A",ADM,"EL",D1,0)) G:Y(0)="" F7
"RTN","FHORE21",10,0)
 S X=$G(^FHPT(FHDFN,"A",ADM,0)),OLW=$P(X,"^",11),IS=$P(X,"^",10)
"RTN","FHORE21",11,0)
 S W1=$P(X,"^",8),X2=$G(^FH(119.6,+W1,0)),WARD=$P(X2,"^",1)
"RTN","FHORE21",12,0)
 G:WARD="" F4 S P0=$P(X2,"^",8) I FHP,P0'=FHP G F4
"RTN","FHORE21",13,0)
 S M1=$P(Y(0),"^",2) I MEAL'="A",M1'=MEAL G F4
"RTN","FHORE21",14,0)
 D CUR G:FHLD'="" F4 S O1=Y
"RTN","FHORE21",15,0)
 S ^TMP($J,"EL",D1_"-"_$P(Y(0),"^",6),FHDFN_"-"_ADM)=WARD_"^"_P0_"^"_OLW_"^"_IS_"^"_O1_"^"_$P(Y(0),"^",2,4) G F4
"RTN","FHORE21",16,0)
P0 D NOW^%DTC S DTP=% D DTP^FH S H1=DTP,DTP=DTE\1 D DTP^FH S L1=DTP
"RTN","FHORE21",17,0)
 I LAB S LAB=$P($G(^FH(119.9,1,"D",IOS,0)),"^",2) S:'LAB LAB=1
"RTN","FHORE21",18,0)
 S S1=LAB=2*5+36
"RTN","FHORE21",19,0)
P1 S M2="Z",PG=0 D:'LAB HDR
"RTN","FHORE21",20,0)
 S N1="" F  S N1=$O(^TMP($J,"EL",N1)) Q:N1=""!(ANS="^")  S N2="" F  S N2=$O(^TMP($J,"EL",N1,N2)) Q:N2=""  S Y=^(N2) D P2 Q:ANS="^"
"RTN","FHORE21",21,0)
 ;
"RTN","FHORE21",22,0)
 D ^FHOMELT  ;List Outpatient (Recurring Meals) Late Trays
"RTN","FHORE21",23,0)
 I LAB<1 W !!
"RTN","FHORE21",24,0)
 S FHPREV="" D:'LAB OPHDR
"RTN","FHORE21",25,0)
 F N1="B","N","E"  D
"RTN","FHORE21",26,0)
 .I '$D(^TMP($J,N1)) Q
"RTN","FHORE21",27,0)
 .S N2="" F  S N2=$O(^TMP($J,N1,N2)) Q:N2=""!(ANS="^")  D
"RTN","FHORE21",28,0)
 ..S FHDATA=$G(^TMP($J,N1,N2)),FHLOC=$P(FHDATA,U,1),FHDFN=$P(FHDATA,U,2)
"RTN","FHORE21",29,0)
 ..S FHBAG=$P(FHDATA,U,3),(O1,FHDIET)=$P(FHDATA,U,4),RM=$P(FHDATA,U,5) D PATNAME^FHOMUTL
"RTN","FHORE21",30,0)
 ..S (WARD,FHLOCNM)=$E($P($G(^FH(119.6,FHLOC,0)),U,1),1,10)
"RTN","FHORE21",31,0)
 ..S FHIP=$P($G(^FHPT(FHDFN,0)),U,5),FHIPD="",IS=""
"RTN","FHORE21",32,0)
 ..I FHIP'="" S (IS,FHIPD)=$P($G(^FH(119.4,FHIP,0)),U,2)_$P($G(^FH(119.4,FHIP,0)),U,3)
"RTN","FHORE21",33,0)
 ..S P1=FHPTNM,BID=FHBID,TIM=$P(N2,"~",1),M1=N1
"RTN","FHORE21",34,0)
 ..I LAB<1 D OUTP
"RTN","FHORE21",35,0)
 ..I LAB>0,LAB<3 D P3
"RTN","FHORE21",36,0)
 ..I LAB>2 D LL Q
"RTN","FHORE21",37,0)
 I LAB>2 D DPLL^FHLABEL K ^TMP($J) Q
"RTN","FHORE21",38,0)
 I LAB<3 F K=1:1:$S('LAB:1,1:18) W !
"RTN","FHORE21",39,0)
 Q
"RTN","FHORE21",40,0)
P2 S FHDFN=+N2,WARD=$P(Y,"^",1),P0=$P(Y,"^",2),OLW=$P(Y,"^",3),IS=$P(Y,"^",4),O1=$P(Y,"^",5),M1=$P(Y,"^",6),TIM=$P(Y,"^",7),BAG=$P(Y,"^",8)
"RTN","FHORE21",41,0)
 I IS S IS=^FH(119.4,IS,0),IS=$P(IS,"^",2)_$P(IS,"^",3)
"RTN","FHORE21",42,0)
 D PATNAME^FHOMUTL I DFN="" Q
"RTN","FHORE21",43,0)
 S Y=^DPT(DFN,0),P1=$P(Y,"^",1) D PID^FHDPA
"RTN","FHORE21",44,0)
 S RM=$G(^DPT(DFN,.101)) I LAB>2 D LL Q
"RTN","FHORE21",45,0)
 G:LAB P3
"RTN","FHORE21",46,0)
 I $Y>(IOSL-10) D HDR Q:ANS="^"  W !!?56,$S(M1="B":"Breakfast ",M1="N":"   Noon ",1:" Evening "),$J(TIM,6),! S M2=M1_TIM
"RTN","FHORE21",47,0)
 S X=M1_TIM I X'=M2 W !!?56,$S(M1="B":"Breakfast ",M1="N":"   Noon ",1:" Evening "),$J(TIM,6),! S M2=X
"RTN","FHORE21",48,0)
 W !,$S(WARD'="":$E(WARD,1,10),1:"")_$S(RM'="":"/"_$E(RM,1,10),1:""),?24,$E(P1,1,22),?50,BID,?61,$S(IS'="":IS,1:""),?67,$S(BAG="Y":"YES",1:""),?73,O1
"RTN","FHORE21",49,0)
 D ALG^FHCLN W !,"Allergies: ",$S(ALG="":"None on file",1:ALG)
"RTN","FHORE21",50,0)
 Q
"RTN","FHORE21",51,0)
P3 S P1=$E(P1,1,22),WARD=$E(WARD,1,15),RM=$E(RM,1,10)
"RTN","FHORE21",52,0)
 D ALG^FHCLN
"RTN","FHORE21",53,0)
 W !,$S(M1="B":"Breakfast",M1="N":"  Noon ",1:" Evening"),?10,TIM,?(S1-12),L1 W:LAB=2 !
"RTN","FHORE21",54,0)
 W !,$E(P1,1,S1-5-$L(WARD)),?(S1-3-$L(WARD)),WARD
"RTN","FHORE21",55,0)
 W !,BID W:IS'="" ?(S1-3\2),IS W ?(S1-3-$L(RM)),RM W:LAB=2 !
"RTN","FHORE21",56,0)
 I $L(O1)<S1 W !,O1,$S(ALG="":"",1:" *ALG"),!!
"RTN","FHORE21",57,0)
 E  S L=$S($L($P(O1,",",1,3))<S1:3,1:2) W !,$P(O1,",",1,L),!,$E($P(O1,",",L+1,5),2,99),$S(ALG="":"",1:"*ALG"),!
"RTN","FHORE21",58,0)
 W:LAB=2 ! Q
"RTN","FHORE21",59,0)
OUTP ;
"RTN","FHORE21",60,0)
 I $Y>(IOSL-10) D OPHDR Q:ANS="^"
"RTN","FHORE21",61,0)
 S NEW=N1_$P(N2,"~",1) I FHPREV'=NEW W !!?56,$S(N1="B":"Breakfast ",N1="N":"   Noon ",1:" Evening "),$J($P(N2,"~",1),6),!
"RTN","FHORE21",62,0)
 W !,FHLOCNM
"RTN","FHORE21",63,0)
 D PATNAME^FHOMUTL W "/"_RM,?24,FHPTNM,?50,FHBID
"RTN","FHORE21",64,0)
 W ?61,FHIPD,?67,$S(FHBAG="Y":"YES",1:"")
"RTN","FHORE21",65,0)
 W ?73,FHDIET
"RTN","FHORE21",66,0)
 D ALG^FHCLN W !,"Allergies: ",$S(ALG="":"None on file",1:ALG)
"RTN","FHORE21",67,0)
 S FHPREV=N1_$P(N2,"~",1)
"RTN","FHORE21",68,0)
 Q
"RTN","FHORE21",69,0)
F7 K ^FHPT("ADLT",D1,FHDFN,ADM) G F4
"RTN","FHORE21",70,0)
CUR S A1=0,(Y,FHLD,FHOR)="" F KK=0:0 S KK=$O(^FHPT(FHDFN,"A",ADM,"AC",KK)) Q:KK<1!(KK>D1)  S A1=KK
"RTN","FHORE21",71,0)
 Q:'A1  S FHORD=$P(^FHPT(FHDFN,"A",ADM,"AC",A1,0),"^",2),X=^FHPT(FHDFN,"A",ADM,"DI",FHORD,0),FHOR=$P(X,"^",2,6),FHLD=$P(X,"^",7)
"RTN","FHORE21",72,0)
 I FHLD'="" S FHDU=";"_$P(^DD(115.02,6,0),"^",3),%=$F(FHDU,";"_FHLD_":") Q:%<1  S Y=$P($E(FHDU,%,999),";",1) Q
"RTN","FHORE21",73,0)
 S Y="" F A1=1:1:5 S D3=$P(FHOR,"^",A1) I D3 S:Y'="" Y=Y_", " S Y=Y_$P(^FH(111,D3,0),"^",7)
"RTN","FHORE21",74,0)
 Q
"RTN","FHORE21",75,0)
DP K N S Y=$G(^FH(119.73,+P0,1))
"RTN","FHORE21",76,0)
 F KK=1,2,3,7,8,9,13,14,15 S X=$P(Y,"^",KK) I X'="" S N($S(KK<7:"B",KK<13:"N",1:"E"),X)=""
"RTN","FHORE21",77,0)
 Q
"RTN","FHORE21",78,0)
HDR ; Print Header (INPATIENT)
"RTN","FHORE21",79,0)
 I PG,IOST?1"C-".E R !!,"Press RETURN to continue or ""^"" to exit. ",ANS:DTIME S:'$T!(ANS["^") ANS="^" Q:ANS="^"  I "^"'[ANS W !,"Enter Return or ""^""." G HDR
"RTN","FHORE21",80,0)
 W:'($E(IOST,1,2)'="C-"&'PG) @IOF S PG=PG+1
"RTN","FHORE21",81,0)
 W !?32,"I N P A T I E N T   E A R L Y / L A T E   T R A Y S",?110,H1
"RTN","FHORE21",82,0)
 W !,$S('FHP:"Consolidated",1:$P(^FH(119.73,FHP,0),"^",1)),?61,L1,?121,"Page ",PG
"RTN","FHORE21",83,0)
 W !!,"Ward/Room",?24,"Patient",?50,"ID#",?61,"Iso   Bag   Current-Diet",! Q
"RTN","FHORE21",84,0)
OPHDR ; Print Header (OUTPATIENT)
"RTN","FHORE21",85,0)
 I PG,IOST?1"C-".E R !!,"Press RETURN to continue or ""^"" to exit. ",ANS:DTIME S:'$T!(ANS["^") ANS="^" Q:ANS="^"  I "^"'[ANS W !,"Enter Return or ""^""." G OPHDR
"RTN","FHORE21",86,0)
 W:$E(IOST,1,2)="C-" @IOF S PG=PG+1
"RTN","FHORE21",87,0)
 W !?32,"O U T P A T I E N T   E A R L Y / L A T E   T R A Y S",?110,H1
"RTN","FHORE21",88,0)
 W !,$S('FHP:"Consolidated",1:$P(^FH(119.73,FHP,0),"^",1)),?61,L1,?121,"Page ",PG
"RTN","FHORE21",89,0)
 W !!,"Ward/Room",?24,"Patient",?50,"ID#",?61,"Iso   Bag   Current-Diet",! Q
"RTN","FHORE21",90,0)
LL ;
"RTN","FHORE21",91,0)
 D ALG^FHCLN
"RTN","FHORE21",92,0)
 S FHCOL=$S(LAB=3:3,1:2)
"RTN","FHORE21",93,0)
 I LABSTART>1 F FHLABST=1:1:(LABSTART-1)*FHCOL D  S LABSTART=1
"RTN","FHORE21",94,0)
 .I LAB=3 S (PCL1,PCL2,PCL3,PCL4,PCL5,PCL6)="" D LL3^FHLABEL
"RTN","FHORE21",95,0)
 .I LAB=4 S (PCL1,PCL2,PCL3,PCL4,PCL5,PCL6,PCL7,PCL8)="" D LL4^FHLABEL
"RTN","FHORE21",96,0)
 .Q
"RTN","FHORE21",97,0)
 S SL1=$S(LAB=3:25,1:38)
"RTN","FHORE21",98,0)
 S MEALTM=$S(M1="B":"Breakfast",M1="N":"Noon",1:"Evening")_"  "_TIM
"RTN","FHORE21",99,0)
 S BID=BID_$S(ALG="":"",1:" *ALG")
"RTN","FHORE21",100,0)
 S BIDIS=BID_$E("        ",1,12-$L(BID))_IS
"RTN","FHORE21",101,0)
 S WARD=$E(WARD,1,15),WLN=$L(WARD),RM=$E(RM,1,10)
"RTN","FHORE21",102,0)
 I LAB=3 D
"RTN","FHORE21",103,0)
 .S P1=$E(P1,1,24-WLN)
"RTN","FHORE21",104,0)
 .S (PCL1,PCL6)="",PCL2=MEALTM_$J(L1,25-$L(MEALTM))
"RTN","FHORE21",105,0)
 .S PCL3=P1_$J(WARD,25-$L(P1)),PCL4=BIDIS_$J(RM,25-$L(BIDIS))
"RTN","FHORE21",106,0)
 .S PCL5=$E(O1,1,29) D LL3^FHLABEL
"RTN","FHORE21",107,0)
 I LAB=4 D
"RTN","FHORE21",108,0)
 .S P1=$E(P1,1,37-WLN)
"RTN","FHORE21",109,0)
 .S (PCL1,PCL2,PCL7,PCL8)="",PCL3=MEALTM_$J(L1,38-$L(MEALTM))
"RTN","FHORE21",110,0)
 .S PCL4=P1_$J(WARD,38-$L(P1)),PCL5=BIDIS_$J(RM,38-$L(BIDIS))
"RTN","FHORE21",111,0)
 .S PCL6=$E(O1,1,42) D LL4^FHLABEL
"RTN","FHORE21",112,0)
 Q
"VER")
8.0^22.0
"BLD",7668,6)
^15
**END**
**END**
