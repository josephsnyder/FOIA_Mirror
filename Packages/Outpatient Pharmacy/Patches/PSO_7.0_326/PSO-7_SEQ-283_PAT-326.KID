Released PSO*7*326 SEQ #283
Extracted from mail message
**KIDS**:PSO*7.0*326^

**INSTALL NAME**
PSO*7.0*326
"BLD",6759,0)
PSO*7.0*326^OUTPATIENT PHARMACY^0^3091006^y
"BLD",6759,1,0)
^^45^45^3090821^
"BLD",6759,1,1,0)
The FY09 Q1 Enhancement Release is related to PSI-07-090 (PSPO #543) and
"BLD",6759,1,2,0)
Remedy Ticket #189923. The Social Security Number (SSN) was removed from
"BLD",6759,1,3,0)
the print out given to the patient from the following options.
"BLD",6759,1,4,0)
  Action Profile (132 COLUMN PRINTOUT) [PSO ACTION PROFILE]
"BLD",6759,1,5,0)
  Medication Profile [PSO P]
"BLD",6759,1,6,0)
  Printing/Reprinting prescription labels using these options:
"BLD",6759,1,7,0)
    Patient Prescription Processing [PSO LM BACKDOOR ORDERS]
"BLD",6759,1,8,0)
     - ListMan hidden action (RP)  - Reprint (OP)
"BLD",6759,1,9,0)
     - ListMan hidden action (OTH) - MI Print Medication Instructions
"BLD",6759,1,10,0)
                                    (addressed in patch PSN*4*181)
"BLD",6759,1,11,0)
    Complete Orders from OERR [PSO LMOE FINISH]
"BLD",6759,1,12,0)
    Pull Early from Suspense [PSO PNDRX]
"BLD",6759,1,13,0)
    Print from Suspense File [PSO PNDLBL]
"BLD",6759,1,14,0)
     - 5 Standard Print from Suspense
"BLD",6759,1,15,0)
    Reprint a non-voided Outpatient Rx Label [PSO SCRIPTALK REPRINT
"BLD",6759,1,16,0)
                                              VISTA LB]    
"BLD",6759,1,17,0)
    Queue ScripTalk Label by Barcode [PSO SCRIPTALK MANUAL INTERNAL]
"BLD",6759,1,18,0)
    Queue ScripTalk Label by Rx# [PSO SCRIPTALK MANUAL EXTERNAL] 
"BLD",6759,1,19,0)
 
"BLD",6759,1,20,0)
Additionally, the ability to lookup by prescription number or wand a
"BLD",6759,1,21,0)
barcode with the prescription was added to the patient lookup prompt on
"BLD",6759,1,22,0)
the following options.
"BLD",6759,1,23,0)
  Patient Prescription Processing [PSO LM BACKDOOR ORDERS]
"BLD",6759,1,24,0)
  Medication Profile [PSO P]
"BLD",6759,1,25,0)
  Rx (Prescriptions) [PSO RX]
"BLD",6759,1,26,0)
  Update Patient Record [PSO PAT]
"BLD",6759,1,27,0)
  Manual Print of Multi-Rx Forms [PSO LM MULTI-RX PRINT]
"BLD",6759,1,28,0)
  ScripTalk Patient Enter/Edit [PSO SCRIPTALK PATIENT ENROLL]
"BLD",6759,1,29,0)
  Patient Address Changes Report [PSO ADDRESS CHANGE REPORT]
"BLD",6759,1,30,0)
  List Prescriptions Not Mailed [PSO BAI NOT MAILED]
"BLD",6759,1,31,0)
  Non-VA Meds Usage Report [PSO NON-VA MEDS USAGE REPORT]
"BLD",6759,1,32,0)
  Enter New Patient [PSO BINGO NEW PATIENT]
"BLD",6759,1,33,0)
  Action Profile (132 COLUMN PRINTOUT) [PSO ACTION PROFILE]
"BLD",6759,1,34,0)
  Poly Pharmacy Report [PSOPOLY].
"BLD",6759,1,35,0)
 
"BLD",6759,1,36,0)
The help text for patient lookup was modified and will display the
"BLD",6759,1,37,0)
following.
"BLD",6759,1,38,0)
  Enter the prescription number prefixed by a # (ex. #XXXXXXX) or
"BLD",6759,1,39,0)
  Wand the barcode of the prescription. The format of the barcode is
"BLD",6759,1,40,0)
  NNN-NNNNNNN where the first 3 digits are your station number.
"BLD",6759,1,41,0)
            - OR -
"BLD",6759,1,42,0)
  Answer with PATIENT NAME, or SOCIAL SECURITY NUMBER, or last 4 digits
"BLD",6759,1,43,0)
  of SOCIAL SECURITY NUMBER, or first initial of last name with last 4
"BLD",6759,1,44,0)
  digits of SOCIAL SECURITY NUMBER
"BLD",6759,1,45,0)
  Do you want the entire NNNNNNNN-Entry PATIENT List?
"BLD",6759,4,0)
^9.64PA^^0
"BLD",6759,6)
1^
"BLD",6759,6.3)
11
"BLD",6759,"KRN",0)
^9.67PA^779.2^20
"BLD",6759,"KRN",.4,0)
.4
"BLD",6759,"KRN",.401,0)
.401
"BLD",6759,"KRN",.402,0)
.402
"BLD",6759,"KRN",.403,0)
.403
"BLD",6759,"KRN",.5,0)
.5
"BLD",6759,"KRN",.84,0)
.84
"BLD",6759,"KRN",3.6,0)
3.6
"BLD",6759,"KRN",3.8,0)
3.8
"BLD",6759,"KRN",9.2,0)
9.2
"BLD",6759,"KRN",9.8,0)
9.8
"BLD",6759,"KRN",9.8,"NM",0)
^9.68A^61^32
"BLD",6759,"KRN",9.8,"NM",1,0)
PSOADDR^^0^B66903494
"BLD",6759,"KRN",9.8,"NM",2,0)
PSOBAIRP^^0^B26011149
"BLD",6759,"KRN",9.8,"NM",3,0)
PSODACT^^0^B16620275
"BLD",6759,"KRN",9.8,"NM",4,0)
PSODEM^^0^B13834682
"BLD",6759,"KRN",9.8,"NM",5,0)
PSOLLL7^^0^B33639732
"BLD",6759,"KRN",9.8,"NM",7,0)
PSOP^^0^B45335172
"BLD",6759,"KRN",9.8,"NM",8,0)
PSOP1^^0^B26127323
"BLD",6759,"KRN",9.8,"NM",9,0)
PSOPAT^^0^B4999933
"BLD",6759,"KRN",9.8,"NM",10,0)
PSOPATLK^^0^B5987433
"BLD",6759,"KRN",9.8,"NM",11,0)
PSOPOLY^^0^B40529966
"BLD",6759,"KRN",9.8,"NM",12,0)
PSORX1^^0^B59378115
"BLD",6759,"KRN",9.8,"NM",13,0)
PSOSD1^^0^B48899635
"BLD",6759,"KRN",9.8,"NM",14,0)
PSOSD2^^0^B29718119
"BLD",6759,"KRN",9.8,"NM",15,0)
PSOSD3^^0^B38820871
"BLD",6759,"KRN",9.8,"NM",16,0)
PSOSDP^^0^B31130096
"BLD",6759,"KRN",9.8,"NM",17,0)
PSOTALK2^^0^B62138253
"BLD",6759,"KRN",9.8,"NM",45,0)
PSOP2^^0^B31681031
"BLD",6759,"KRN",9.8,"NM",46,0)
PSOLLL1^^0^B70166318
"BLD",6759,"KRN",9.8,"NM",47,0)
PSOLLL5^^0^B37231330
"BLD",6759,"KRN",9.8,"NM",48,0)
PSOLLLH^^0^B33342712
"BLD",6759,"KRN",9.8,"NM",49,0)
PSOLLLHN^^0^B9141187
"BLD",6759,"KRN",9.8,"NM",51,0)
PSONVARP^^0^B23669597
"BLD",6759,"KRN",9.8,"NM",52,0)
PSOLBL^^0^B63221606
"BLD",6759,"KRN",9.8,"NM",53,0)
PSOLBL2^^0^B34647042
"BLD",6759,"KRN",9.8,"NM",54,0)
PSOLLLI^^0^B66532826
"BLD",6759,"KRN",9.8,"NM",55,0)
PSOLBLN2^^0^B37556069
"BLD",6759,"KRN",9.8,"NM",56,0)
PSOLBL1^^0^B28929017
"BLD",6759,"KRN",9.8,"NM",57,0)
PSOPRF^^0^B35553625
"BLD",6759,"KRN",9.8,"NM",58,0)
PSOPRFSS^^0^B16605168
"BLD",6759,"KRN",9.8,"NM",59,0)
PSOTRLBL^^0^B19249062
"BLD",6759,"KRN",9.8,"NM",60,0)
PSOBINGO^^0^B63802606
"BLD",6759,"KRN",9.8,"NM",61,0)
PSOTALK^^0^B83851636
"BLD",6759,"KRN",9.8,"NM","B","PSOADDR",1)

"BLD",6759,"KRN",9.8,"NM","B","PSOBAIRP",2)

"BLD",6759,"KRN",9.8,"NM","B","PSOBINGO",60)

"BLD",6759,"KRN",9.8,"NM","B","PSODACT",3)

"BLD",6759,"KRN",9.8,"NM","B","PSODEM",4)

"BLD",6759,"KRN",9.8,"NM","B","PSOLBL",52)

"BLD",6759,"KRN",9.8,"NM","B","PSOLBL1",56)

"BLD",6759,"KRN",9.8,"NM","B","PSOLBL2",53)

"BLD",6759,"KRN",9.8,"NM","B","PSOLBLN2",55)

"BLD",6759,"KRN",9.8,"NM","B","PSOLLL1",46)

"BLD",6759,"KRN",9.8,"NM","B","PSOLLL5",47)

"BLD",6759,"KRN",9.8,"NM","B","PSOLLL7",5)

"BLD",6759,"KRN",9.8,"NM","B","PSOLLLH",48)

"BLD",6759,"KRN",9.8,"NM","B","PSOLLLHN",49)

"BLD",6759,"KRN",9.8,"NM","B","PSOLLLI",54)

"BLD",6759,"KRN",9.8,"NM","B","PSONVARP",51)

"BLD",6759,"KRN",9.8,"NM","B","PSOP",7)

"BLD",6759,"KRN",9.8,"NM","B","PSOP1",8)

"BLD",6759,"KRN",9.8,"NM","B","PSOP2",45)

"BLD",6759,"KRN",9.8,"NM","B","PSOPAT",9)

"BLD",6759,"KRN",9.8,"NM","B","PSOPATLK",10)

"BLD",6759,"KRN",9.8,"NM","B","PSOPOLY",11)

"BLD",6759,"KRN",9.8,"NM","B","PSOPRF",57)

"BLD",6759,"KRN",9.8,"NM","B","PSOPRFSS",58)

"BLD",6759,"KRN",9.8,"NM","B","PSORX1",12)

"BLD",6759,"KRN",9.8,"NM","B","PSOSD1",13)

"BLD",6759,"KRN",9.8,"NM","B","PSOSD2",14)

"BLD",6759,"KRN",9.8,"NM","B","PSOSD3",15)

"BLD",6759,"KRN",9.8,"NM","B","PSOSDP",16)

"BLD",6759,"KRN",9.8,"NM","B","PSOTALK",61)

"BLD",6759,"KRN",9.8,"NM","B","PSOTALK2",17)

"BLD",6759,"KRN",9.8,"NM","B","PSOTRLBL",59)

"BLD",6759,"KRN",19,0)
19
"BLD",6759,"KRN",19.1,0)
19.1
"BLD",6759,"KRN",101,0)
101
"BLD",6759,"KRN",101,"NM",0)
^9.68A^^0
"BLD",6759,"KRN",409.61,0)
409.61
"BLD",6759,"KRN",409.61,"NM",0)
^9.68A^^0
"BLD",6759,"KRN",771,0)
771
"BLD",6759,"KRN",779.2,0)
779.2
"BLD",6759,"KRN",870,0)
870
"BLD",6759,"KRN",8989.51,0)
8989.51
"BLD",6759,"KRN",8989.52,0)
8989.52
"BLD",6759,"KRN",8994,0)
8994
"BLD",6759,"KRN","B",.4,.4)

"BLD",6759,"KRN","B",.401,.401)

"BLD",6759,"KRN","B",.402,.402)

"BLD",6759,"KRN","B",.403,.403)

"BLD",6759,"KRN","B",.5,.5)

"BLD",6759,"KRN","B",.84,.84)

"BLD",6759,"KRN","B",3.6,3.6)

"BLD",6759,"KRN","B",3.8,3.8)

"BLD",6759,"KRN","B",9.2,9.2)

"BLD",6759,"KRN","B",9.8,9.8)

"BLD",6759,"KRN","B",19,19)

"BLD",6759,"KRN","B",19.1,19.1)

"BLD",6759,"KRN","B",101,101)

"BLD",6759,"KRN","B",409.61,409.61)

"BLD",6759,"KRN","B",771,771)

"BLD",6759,"KRN","B",779.2,779.2)

"BLD",6759,"KRN","B",870,870)

"BLD",6759,"KRN","B",8989.51,8989.51)

"BLD",6759,"KRN","B",8989.52,8989.52)

"BLD",6759,"KRN","B",8994,8994)

"BLD",6759,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",6759,"QUES",0)
^9.62^^
"BLD",6759,"REQB",0)
^9.611^8^4
"BLD",6759,"REQB",4,0)
PSN*4.0*181^2
"BLD",6759,"REQB",6,0)
PSO*7.0*320^2
"BLD",6759,"REQB",7,0)
PSO*7.0*266^2
"BLD",6759,"REQB",8,0)
PSO*7.0*297^2
"BLD",6759,"REQB","B","PSN*4.0*181",4)

"BLD",6759,"REQB","B","PSO*7.0*266",7)

"BLD",6759,"REQB","B","PSO*7.0*297",8)

"BLD",6759,"REQB","B","PSO*7.0*320",6)

"MBREQ")
0
"PKG",141,-1)
1^1
"PKG",141,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",141,20,0)
^9.402P^^
"PKG",141,22,0)
^9.49I^1^1
"PKG",141,22,1,0)
7.0^2971216^2980917^11712
"PKG",141,22,1,"PAH",1,0)
326^3091006^11920
"PKG",141,22,1,"PAH",1,1,0)
^^45^45^3091006
"PKG",141,22,1,"PAH",1,1,1,0)
The FY09 Q1 Enhancement Release is related to PSI-07-090 (PSPO #543) and
"PKG",141,22,1,"PAH",1,1,2,0)
Remedy Ticket #189923. The Social Security Number (SSN) was removed from
"PKG",141,22,1,"PAH",1,1,3,0)
the print out given to the patient from the following options.
"PKG",141,22,1,"PAH",1,1,4,0)
  Action Profile (132 COLUMN PRINTOUT) [PSO ACTION PROFILE]
"PKG",141,22,1,"PAH",1,1,5,0)
  Medication Profile [PSO P]
"PKG",141,22,1,"PAH",1,1,6,0)
  Printing/Reprinting prescription labels using these options:
"PKG",141,22,1,"PAH",1,1,7,0)
    Patient Prescription Processing [PSO LM BACKDOOR ORDERS]
"PKG",141,22,1,"PAH",1,1,8,0)
     - ListMan hidden action (RP)  - Reprint (OP)
"PKG",141,22,1,"PAH",1,1,9,0)
     - ListMan hidden action (OTH) - MI Print Medication Instructions
"PKG",141,22,1,"PAH",1,1,10,0)
                                    (addressed in patch PSN*4*181)
"PKG",141,22,1,"PAH",1,1,11,0)
    Complete Orders from OERR [PSO LMOE FINISH]
"PKG",141,22,1,"PAH",1,1,12,0)
    Pull Early from Suspense [PSO PNDRX]
"PKG",141,22,1,"PAH",1,1,13,0)
    Print from Suspense File [PSO PNDLBL]
"PKG",141,22,1,"PAH",1,1,14,0)
     - 5 Standard Print from Suspense
"PKG",141,22,1,"PAH",1,1,15,0)
    Reprint a non-voided Outpatient Rx Label [PSO SCRIPTALK REPRINT
"PKG",141,22,1,"PAH",1,1,16,0)
                                              VISTA LB]    
"PKG",141,22,1,"PAH",1,1,17,0)
    Queue ScripTalk Label by Barcode [PSO SCRIPTALK MANUAL INTERNAL]
"PKG",141,22,1,"PAH",1,1,18,0)
    Queue ScripTalk Label by Rx# [PSO SCRIPTALK MANUAL EXTERNAL] 
"PKG",141,22,1,"PAH",1,1,19,0)
 
"PKG",141,22,1,"PAH",1,1,20,0)
Additionally, the ability to lookup by prescription number or wand a
"PKG",141,22,1,"PAH",1,1,21,0)
barcode with the prescription was added to the patient lookup prompt on
"PKG",141,22,1,"PAH",1,1,22,0)
the following options.
"PKG",141,22,1,"PAH",1,1,23,0)
  Patient Prescription Processing [PSO LM BACKDOOR ORDERS]
"PKG",141,22,1,"PAH",1,1,24,0)
  Medication Profile [PSO P]
"PKG",141,22,1,"PAH",1,1,25,0)
  Rx (Prescriptions) [PSO RX]
"PKG",141,22,1,"PAH",1,1,26,0)
  Update Patient Record [PSO PAT]
"PKG",141,22,1,"PAH",1,1,27,0)
  Manual Print of Multi-Rx Forms [PSO LM MULTI-RX PRINT]
"PKG",141,22,1,"PAH",1,1,28,0)
  ScripTalk Patient Enter/Edit [PSO SCRIPTALK PATIENT ENROLL]
"PKG",141,22,1,"PAH",1,1,29,0)
  Patient Address Changes Report [PSO ADDRESS CHANGE REPORT]
"PKG",141,22,1,"PAH",1,1,30,0)
  List Prescriptions Not Mailed [PSO BAI NOT MAILED]
"PKG",141,22,1,"PAH",1,1,31,0)
  Non-VA Meds Usage Report [PSO NON-VA MEDS USAGE REPORT]
"PKG",141,22,1,"PAH",1,1,32,0)
  Enter New Patient [PSO BINGO NEW PATIENT]
"PKG",141,22,1,"PAH",1,1,33,0)
  Action Profile (132 COLUMN PRINTOUT) [PSO ACTION PROFILE]
"PKG",141,22,1,"PAH",1,1,34,0)
  Poly Pharmacy Report [PSOPOLY].
"PKG",141,22,1,"PAH",1,1,35,0)
 
"PKG",141,22,1,"PAH",1,1,36,0)
The help text for patient lookup was modified and will display the
"PKG",141,22,1,"PAH",1,1,37,0)
following.
"PKG",141,22,1,"PAH",1,1,38,0)
  Enter the prescription number prefixed by a # (ex. #XXXXXXX) or
"PKG",141,22,1,"PAH",1,1,39,0)
  Wand the barcode of the prescription. The format of the barcode is
"PKG",141,22,1,"PAH",1,1,40,0)
  NNN-NNNNNNN where the first 3 digits are your station number.
"PKG",141,22,1,"PAH",1,1,41,0)
            - OR -
"PKG",141,22,1,"PAH",1,1,42,0)
  Answer with PATIENT NAME, or SOCIAL SECURITY NUMBER, or last 4 digits
"PKG",141,22,1,"PAH",1,1,43,0)
  of SOCIAL SECURITY NUMBER, or first initial of last name with last 4
"PKG",141,22,1,"PAH",1,1,44,0)
  digits of SOCIAL SECURITY NUMBER
"PKG",141,22,1,"PAH",1,1,45,0)
  Do you want the entire NNNNNNNN-Entry PATIENT List?
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
32
"RTN","PSOADDR")
0^1^B66903494^B66739832
"RTN","PSOADDR",1,0)
PSOADDR ;BIR/RTR-Print address changes from Audit file ;10/17/01
"RTN","PSOADDR",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**127,233,326**;DEC 1997;Build 11
"RTN","PSOADDR",3,0)
 ;External reference to ^DIA supported by DBIA 2602
"RTN","PSOADDR",4,0)
 ;
"RTN","PSOADDR",5,0)
EN ;
"RTN","PSOADDR",6,0)
 N PSOFORM,PSOAPAT,PSOSDT,PSOEDT,PSOSDTX,PSOEDTX,X,Y,X1,X2
"RTN","PSOADDR",7,0)
 W !!,"This option provides a report that displays changes made to permanent and"
"RTN","PSOADDR",8,0)
 W !,"temporary mailing address information in the PATIENT file (#2). Also changes"
"RTN","PSOADDR",9,0)
 W !,"to the MAIL field (#.03) and the MAIL STATUS EXPIRATION DATE field (#.05)"
"RTN","PSOADDR",10,0)
 W !,"in the PHARMACY PATIENT file (#55) will be displayed."
"RTN","PSOADDR",11,0)
 W !,"Changes can only be displayed if the edits were made using VA FileMan, and the"
"RTN","PSOADDR",12,0)
 W !,"Audit function was turned on for the field(s) at the time of the edit.",!!
"RTN","PSOADDR",13,0)
 K DIR S DIR(0)="SB^S:Single;A:All",DIR("A")="Print report for a Single patient, or All patients",DIR("B")="Single",DIR("?")=" ",DIR("?",1)="Enter 'S' to print address changes for one patient over the selected"
"RTN","PSOADDR",14,0)
 S DIR("?",2)="date range, enter 'A' to print address changes for all patients",DIR("?",3)="over the selected date range."
"RTN","PSOADDR",15,0)
 D ^DIR K DIR I Y["^"!($D(DTOUT))!($D(DUOUT)) D MESS Q
"RTN","PSOADDR",16,0)
 S PSOFORM=$S(Y="S":1,1:0)
"RTN","PSOADDR",17,0)
 I 'PSOFORM G DATE
"RTN","PSOADDR",18,0)
 K DIC W ! S DIC(0)="QEAM",DIC("A")="Select PATIENT: " D EN^PSOPATLK S Y=PSOPTLK K DIC,PSOPTLK I Y<1!($D(DUOUT))!($D(DTOUT)) D MESS Q
"RTN","PSOADDR",19,0)
 S PSOAPAT=+Y
"RTN","PSOADDR",20,0)
DATE ;
"RTN","PSOADDR",21,0)
 W !!
"RTN","PSOADDR",22,0)
 I PSOFORM W !,"This report will be sorted by Date/time of edit."
"RTN","PSOADDR",23,0)
 I 'PSOFORM W !,"This report will be sorted by Patient Name, and within Patient Name will be",!,"sorted by Date/time of edit."
"RTN","PSOADDR",24,0)
 W !,"A beginning and ending date must now be entered for the search."
"RTN","PSOADDR",25,0)
 K DIR W ! S DIR(0)="DAO^:DT:APEX",DIR("A")="Beginning Date: ",DIR("?")=" ",DIR("?",1)="Enter the date to begin searching for changes to address fields.",DIR("?",2)="A future date cannot be entered." D ^DIR K DIR
"RTN","PSOADDR",26,0)
 I 'Y!($D(DTOUT))!($D(DUOUT)) D MESS Q
"RTN","PSOADDR",27,0)
 S PSOSDT=Y D DD^%DT S PSOSDTX=Y
"RTN","PSOADDR",28,0)
 S X1=PSOSDT,X2=-1 D C^%DTC S PSOSDT=X_".9999"
"RTN","PSOADDR",29,0)
 W ! K DIR S DIR(0)="DAO^"_PSOSDT_"::APEX",DIR("A")="Ending Date: ",DIR("?")=" ",DIR("?",1)="Enter the ending date of the search for changes to address fields.",DIR("?",2)="This date cannot be before the beginning date." D ^DIR K DIR
"RTN","PSOADDR",30,0)
 I 'Y!($D(DTOUT))!($D(DUOUT)) D MESS Q
"RTN","PSOADDR",31,0)
 S PSOEDT=Y D DD^%DT S PSOEDTX=Y
"RTN","PSOADDR",32,0)
 S X1=PSOEDT,X2=+1 D C^%DTC S PSOEDT=X
"RTN","PSOADDR",33,0)
 K IOP,%ZIS,POP S %ZIS="QM" D ^%ZIS I $G(POP) D MESS Q
"RTN","PSOADDR",34,0)
 I $D(IO("Q")) D  Q
"RTN","PSOADDR",35,0)
 .S ZTRTN="REP^PSOADDR",ZTDESC="Pharmacy Address change report",ZTSAVE("PSOFORM")="",ZTSAVE("PSOAPAT")="",ZTSAVE("PSOSDT")="",ZTSAVE("PSOEDT")="",ZTSAVE("PSOEDTX")="",ZTSAVE("PSOSDTX")="" D ^%ZTLOAD K %ZIS W !!,"Report queued to print.",!
"RTN","PSOADDR",36,0)
REP ;
"RTN","PSOADDR",37,0)
 K ^TMP("PSOADD",$J)
"RTN","PSOADDR",38,0)
 N PSODEV,PSOUT,PSOLINE,PSOPAGE,PSOADND,PSOADUSR,PSOADF,PSOADFF,PSOAOPT,PSOAOPTA,PSOAOPTZ,PSOAOPTB,PSOAOPTC,PSOADLP,PSOANODE,PSOADX,PSOADXX,PSOADATE,PSOC,PSOAALL,PSOADFN,PSOANAME,PSONI,PSONX,PSONB,PSOASN,VA,DFN,PSONSSN,PSOAFLAG
"RTN","PSOADDR",39,0)
 U IO
"RTN","PSOADDR",40,0)
 S (PSOUT,PSOAFLAG)=0,PSODEV=$S($E(IOST,1,2)'="C-":0,1:1),PSOPAGE=1
"RTN","PSOADDR",41,0)
 S $P(PSOLINE,"-",78)=""
"RTN","PSOADDR",42,0)
 I $G(PSOFORM) G ONE
"RTN","PSOADDR",43,0)
ALL ;Print report for all patients
"RTN","PSOADDR",44,0)
 N PSOFILE
"RTN","PSOADDR",45,0)
 F PSOFILE=2,55 F PSOAALL=PSOSDT:0 S PSOAALL=$O(^DIA(PSOFILE,"C",PSOAALL)) Q:'PSOAALL!(PSOEDT'>PSOAALL)  S PSOADLP="" F  S PSOADLP=$O(^DIA(PSOFILE,"C",PSOAALL,PSOADLP)) Q:PSOADLP=""  D
"RTN","PSOADDR",46,0)
 .S PSOADFN=$P($G(^DIA(PSOFILE,PSOADLP,0)),"^"),PSOC=$P($G(^(0)),"^",3) Q:'PSOADFN
"RTN","PSOADDR",47,0)
 .S PSOANAME=$P($G(^DPT(PSOADFN,0)),"^") Q:PSOANAME=""
"RTN","PSOADDR",48,0)
 .I PSOFILE=2 I PSOC=.111!(PSOC=.112)!(PSOC=.113)!(PSOC=.114)!(PSOC=.115)!(PSOC=.116)!(PSOC=.1211)!(PSOC=.1212)!(PSOC=.1213)!(PSOC=.1214)!(PSOC=.1215)!(PSOC=.1216)!(PSOC=.1112)!(PSOC=.12112)!(PSOC=.121)!(PSOC=.1217)!(PSOC=.1218)!(PSOC=.12105) D
"RTN","PSOADDR",49,0)
 ..S ^TMP("PSOADD",$J,PSOANAME,PSOADFN,PSOAALL,PSOFILE,PSOADLP)=$G(^DIA(2,PSOADLP,0))
"RTN","PSOADDR",50,0)
 .I PSOFILE=55 I PSOC=.03!(PSOC=.05) D
"RTN","PSOADDR",51,0)
 ..S ^TMP("PSOADD",$J,PSOANAME,PSOADFN,PSOAALL,PSOFILE,PSOADLP)=$G(^DIA(55,PSOADLP,0))
"RTN","PSOADDR",52,0)
 D HD
"RTN","PSOADDR",53,0)
 I '$D(^TMP("PSOADD",$J)) W !!,"No data found to print for this date range.",! G END
"RTN","PSOADDR",54,0)
 S PSONI="" F  S PSONI=$O(^TMP("PSOADD",$J,PSONI)) Q:PSONI=""!(PSOUT)  S PSONX="" F  S PSONX=$O(^TMP("PSOADD",$J,PSONI,PSONX)) Q:PSONX=""!(PSOUT)  D NAME S PSONB="" F  S PSONB=$O(^TMP("PSOADD",$J,PSONI,PSONX,PSONB)) Q:PSONB=""!(PSOUT)  D
"RTN","PSOADDR",55,0)
 .F PSOFILE=2,55 S PSOADXX="" F  S PSOADXX=$O(^TMP("PSOADD",$J,PSONI,PSONX,PSONB,PSOFILE,PSOADXX)) Q:PSOADXX=""!(PSOUT)  D
"RTN","PSOADDR",56,0)
 ..I ($Y+5)>IOSL D HD Q:PSOUT
"RTN","PSOADDR",57,0)
 ..S Y=PSONB D DD^%DT S PSOADATE=Y
"RTN","PSOADDR",58,0)
 ..S PSOADND=$G(^TMP("PSOADD",$J,PSONI,PSONX,PSONB,PSOFILE,PSOADXX))
"RTN","PSOADDR",59,0)
 ..D FLD
"RTN","PSOADDR",60,0)
 ..D PRALL
"RTN","PSOADDR",61,0)
 G END
"RTN","PSOADDR",62,0)
ONE ;Print report for one patient
"RTN","PSOADDR",63,0)
 N PSOFILE
"RTN","PSOADDR",64,0)
 F PSOFILE=2,55 S PSOADLP="" F  S PSOADLP=$O(^DIA(PSOFILE,"B",PSOAPAT,PSOADLP)) Q:PSOADLP=""  S PSOC=$P($G(^DIA(PSOFILE,PSOADLP,0)),"^",3) D
"RTN","PSOADDR",65,0)
 .S PSOANODE=$G(^DIA(PSOFILE,PSOADLP,0))
"RTN","PSOADDR",66,0)
 .I +$P($G(PSOANODE),"^",2)>PSOSDT,+$P($G(PSOANODE),"^",2)<PSOEDT D
"RTN","PSOADDR",67,0)
 ..I PSOFILE=2 I PSOC=.111!(PSOC=.112)!(PSOC=.113)!(PSOC=.114)!(PSOC=.115)!(PSOC=.116)!(PSOC=.1211)!(PSOC=.1212)!(PSOC=.1213)!(PSOC=.1214)!(PSOC=.1215)!(PSOC=.1216)!(PSOC=.1112)!(PSOC=.12112)!(PSOC=.121)!(PSOC=.1217)!(PSOC=.1218)!(PSOC=.12105) D
"RTN","PSOADDR",68,0)
 ...S ^TMP("PSOADD",$J,+$P(PSOANODE,"^",2),PSOFILE,PSOADLP)=PSOANODE
"RTN","PSOADDR",69,0)
 ..I PSOFILE=55 I PSOC=.03!(PSOC=.05) D
"RTN","PSOADDR",70,0)
 ...S ^TMP("PSOADD",$J,+$P(PSOANODE,"^",2),PSOFILE,PSOADLP)=PSOANODE
"RTN","PSOADDR",71,0)
 K VA S DFN=PSOAPAT D PID^VADPT6 S PSOASN=$P($G(^DPT(+$G(PSOAPAT),0)),"^")_"  ("_$E(VA("PID"),5,12)_")"
"RTN","PSOADDR",72,0)
 K VA
"RTN","PSOADDR",73,0)
 D HD
"RTN","PSOADDR",74,0)
 I '$D(^TMP("PSOADD",$J)) W !!,"No data found to print for this date range.",! G END
"RTN","PSOADDR",75,0)
 S PSOADX="" F  S PSOADX=$O(^TMP("PSOADD",$J,PSOADX)) Q:PSOADX=""!(PSOUT)  F PSOFILE=2,55 S PSOADXX="" F  S PSOADXX=$O(^TMP("PSOADD",$J,PSOADX,PSOFILE,PSOADXX)) Q:PSOADXX=""!(PSOUT)  D
"RTN","PSOADDR",76,0)
 .I ($Y+5)>IOSL D HD Q:PSOUT
"RTN","PSOADDR",77,0)
 .S Y=PSOADX D DD^%DT S PSOADATE=Y
"RTN","PSOADDR",78,0)
 .S PSOADND=$G(^TMP("PSOADD",$J,PSOADX,PSOFILE,PSOADXX))
"RTN","PSOADDR",79,0)
 .D FLD
"RTN","PSOADDR",80,0)
 .W ! D PRONE
"RTN","PSOADDR",81,0)
END ;
"RTN","PSOADDR",82,0)
 K ^TMP("PSOADD",$J)
"RTN","PSOADDR",83,0)
 I '$G(PSOUT),PSODEV W !!,"End of Report." K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSOADDR",84,0)
 I 'PSODEV W !!,"End of Report."
"RTN","PSOADDR",85,0)
 I PSODEV W !
"RTN","PSOADDR",86,0)
 E  W @IOF
"RTN","PSOADDR",87,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSOADDR",88,0)
 Q
"RTN","PSOADDR",89,0)
HD ;
"RTN","PSOADDR",90,0)
 I '$G(PSOFORM) S PSOAFLAG=1
"RTN","PSOADDR",91,0)
 I PSODEV,PSOPAGE'=1 W ! K DIR S DIR(0)="E",DIR("A")="Press Return to continue, '^' to exit" D ^DIR K DIR I 'Y S PSOUT=1 Q
"RTN","PSOADDR",92,0)
 I PSOPAGE=1,'PSODEV W ! I 1
"RTN","PSOADDR",93,0)
 E  W @IOF
"RTN","PSOADDR",94,0)
 D  W ?67,"PAGE: "_PSOPAGE S PSOPAGE=PSOPAGE+1
"RTN","PSOADDR",95,0)
 .I PSOFORM W !,"Address changes for "_$G(PSOASN) Q
"RTN","PSOADDR",96,0)
 .W !,"Address changes for ALL Patients"
"RTN","PSOADDR",97,0)
 W !,"made between "_$G(PSOSDTX)_" and "_$G(PSOEDTX)
"RTN","PSOADDR",98,0)
 W !,PSOLINE
"RTN","PSOADDR",99,0)
 Q
"RTN","PSOADDR",100,0)
MESS ;
"RTN","PSOADDR",101,0)
 W !!,"Nothing queued to print.",!
"RTN","PSOADDR",102,0)
 Q
"RTN","PSOADDR",103,0)
NAME ;Set name(ssn)
"RTN","PSOADDR",104,0)
 K VA S DFN=PSONX D PID^VADPT6
"RTN","PSOADDR",105,0)
 S PSONSSN=$G(PSONI)_"   ("_$E(VA("PID"),5,12)_")"
"RTN","PSOADDR",106,0)
 K VA
"RTN","PSOADDR",107,0)
 Q
"RTN","PSOADDR",108,0)
PRALL ;Print data for all patients
"RTN","PSOADDR",109,0)
 S PSOAFLAG=0
"RTN","PSOADDR",110,0)
 W !!,"          Patient: ",$G(PSONSSN) I ($Y+5)>IOSL D HD Q:PSOUT
"RTN","PSOADDR",111,0)
PRONE ;Print data for one patient
"RTN","PSOADDR",112,0)
 D CON W !,"Date/time of edit: ",$G(PSOADATE) I ($Y+5)>IOSL D HD Q:PSOUT
"RTN","PSOADDR",113,0)
 D CON W !,"     Field edited: ",$G(PSOADFF) I ($Y+5)>IOSL D HD Q:PSOUT
"RTN","PSOADDR",114,0)
 D CON W !,"        Edited by: ",$G(PSOADUSR) I ($Y+5)>IOSL D HD Q:PSOUT
"RTN","PSOADDR",115,0)
 D CON W !,"  Option/Protocol: ",$G(PSOAOPT) I ($Y+5)>IOSL D HD Q:PSOUT
"RTN","PSOADDR",116,0)
 D CON W !,"        Old Value: ",$S($P($G(^DIA(PSOFILE,PSOADXX,2)),"^")'="":$P($G(^(2)),"^"),1:"<no previous value>") I ($Y+5)>IOSL D HD Q:PSOUT
"RTN","PSOADDR",117,0)
 D CON W !,"        New Value: ",$S($P($G(^DIA(PSOFILE,PSOADXX,3)),"^")'="":$P($G(^(3)),"^"),1:"<no current value>") I ($Y+5)>IOSL D HD
"RTN","PSOADDR",118,0)
 Q
"RTN","PSOADDR",119,0)
CON ;
"RTN","PSOADDR",120,0)
 I PSOAFLAG,'PSOFORM W !,"  Patient (cont.): ",$G(PSONSSN) S PSOAFLAG=0
"RTN","PSOADDR",121,0)
 Q
"RTN","PSOADDR",122,0)
FLD ;Set field value
"RTN","PSOADDR",123,0)
 K PSOADF D FIELD^DID(PSOFILE,$P(PSOADND,"^",3),"","LABEL","PSOADF")
"RTN","PSOADDR",124,0)
 S PSOADFF=$G(PSOADF("LABEL"))
"RTN","PSOADDR",125,0)
USR ;Set user value
"RTN","PSOADDR",126,0)
 S PSOADUSR=$P(PSOADND,"^",4) I 'PSOADUSR S PSOADUSR="UNKNOWN"
"RTN","PSOADDR",127,0)
 I PSOADUSR'="UNKNOWN" K DIC S DIC="^VA(200,",DIC(0)="MZO",X="`"_PSOADUSR D ^DIC S PSOADUSR=$P($G(Y),"^",2) K DIC
"RTN","PSOADDR",128,0)
 I $G(PSOADUSR)="" S PSOADUSR="UNKNOWN"
"RTN","PSOADDR",129,0)
PROT ;Set value of protocol or option
"RTN","PSOADDR",130,0)
 S (PSOAOPT,PSOAOPTB,PSOAOPTC)=""
"RTN","PSOADDR",131,0)
 I $G(^DIA(PSOFILE,PSOADXX,4.1))="" S PSOAOPT="/" Q
"RTN","PSOADDR",132,0)
 S PSOAOPTA=$P($G(^DIA(PSOFILE,PSOADXX,4.1)),"^")
"RTN","PSOADDR",133,0)
 I PSOAOPTA K DIQ,DIC,PSOAOPTZ S DIC=19,DR=".01",DA=PSOAOPTA,DIQ(0)="E",DIQ="PSOAOPTZ" D EN^DIQ1 S PSOAOPTB=$G(PSOAOPTZ(19,PSOAOPTA,.01,"E")) K DIQ,DA,DR,PSOAOPTZ
"RTN","PSOADDR",134,0)
 S PSOAOPTA=$P($G(^DIA(PSOFILE,PSOADXX,4.1)),"^",2)
"RTN","PSOADDR",135,0)
 K PSOAOPTZ I $P(PSOAOPTA,";",2)="ORD(101," K DIC S DIC=101,DR=".01",DA=+PSOAOPTA,DIQ(0)="E",DIQ="PSOAOPTZ" D EN^DIQ1 S PSOAOPTC=$G(PSOAOPTZ(101,+PSOAOPTA,.01,"E")) K DA,DR,DIC,DIQ,PSOAOPTZ
"RTN","PSOADDR",136,0)
 I $P(PSOAOPTA,";",2)'="ORD(101,",+PSOAOPTA K DIC,DIQ S DIC=19,DR=".01",DA=+PSOAOPTA,DIQ(0)="E",DIQ="PSOAOPTZ" D EN^DIQ1 S PSOAOPTC=$G(PSOAOPTZ(19,+PSOAOPTA,.01,"E")) K PSOAOPTZ,DIC,DA,DR,DIQ
"RTN","PSOADDR",137,0)
 S PSOAOPT=$G(PSOAOPTB)_"/"_$G(PSOAOPTC)
"RTN","PSOADDR",138,0)
 Q
"RTN","PSOBAIRP")
0^2^B26011149^B25852563
"RTN","PSOBAIRP",1,0)
PSOBAIRP ;BIR/RTR-Report of prescription mail labels with bad address ;08/16/2006
"RTN","PSOBAIRP",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**233,326**;DEC 1997;Build 11
"RTN","PSOBAIRP",3,0)
 ;
"RTN","PSOBAIRP",4,0)
EN ;
"RTN","PSOBAIRP",5,0)
 N PSOFORM,PSOAPAT,PSOSDT,PSOEDT,PSOSDTX,PSOEDTX,X,Y,X1,X2
"RTN","PSOBAIRP",6,0)
 W !!,"This option provides a report that shows patients and prescriptions whose last"
"RTN","PSOBAIRP",7,0)
 W !,"label activity had a routing of mail and no valid permanent or temporary"
"RTN","PSOBAIRP",8,0)
 W !,"address. It will also indicate whether the patient now has a good address.",!!
"RTN","PSOBAIRP",9,0)
 K DIR S DIR(0)="SB^S:Single;A:All",DIR("A")="Print report for a Single patient, or All patients",DIR("B")="Single",DIR("?")=" ",DIR("?",1)="Enter 'S' to print address changes for one patient over the selected"
"RTN","PSOBAIRP",10,0)
 S DIR("?",2)="date range, enter 'A' to print address changes for all patients",DIR("?",3)="over the selected date range."
"RTN","PSOBAIRP",11,0)
 D ^DIR K DIR I Y["^"!($D(DTOUT))!($D(DUOUT)) D MESS Q
"RTN","PSOBAIRP",12,0)
 S PSOFORM=$S(Y="S":1,1:0)
"RTN","PSOBAIRP",13,0)
 I 'PSOFORM G DATE
"RTN","PSOBAIRP",14,0)
 K DIC W ! S DIC(0)="QEAM",DIC("A")="Select PATIENT: " D EN^PSOPATLK S Y=PSOPTLK K DIC,PSOPTLK I Y<1!($D(DUOUT))!($D(DTOUT)) D MESS Q
"RTN","PSOBAIRP",15,0)
 S PSOAPAT=+Y
"RTN","PSOBAIRP",16,0)
DATE ;
"RTN","PSOBAIRP",17,0)
 W !!
"RTN","PSOBAIRP",18,0)
 W ! K %DT S %DT="AEX",%DT("A")="Start fill date: " D ^%DT K %DT I Y<0!($D(DTOUT))!($D(DUOUT)) D MESS Q 
"RTN","PSOBAIRP",19,0)
 S (%DT(0),PSOSDT)=Y D DD^%DT S PSOSDTX=Y
"RTN","PSOBAIRP",20,0)
 W ! S %DT="AEX",%DT("A")="End fill date: " D ^%DT K %DT I Y<0!($D(DTOUT))!($D(DUOUT)) D MESS Q
"RTN","PSOBAIRP",21,0)
 S PSOEDT=Y D DD^%DT S PSOEDTX=Y
"RTN","PSOBAIRP",22,0)
 S X1=PSOSDT,X2=-1 D C^%DTC S PSOSDT=X_".9999"
"RTN","PSOBAIRP",23,0)
 S X1=PSOEDT,X2=+1 D C^%DTC S PSOEDT=X
"RTN","PSOBAIRP",24,0)
 K IOP,%ZIS,POP S %ZIS="QM" D ^%ZIS I $G(POP) D MESS Q
"RTN","PSOBAIRP",25,0)
 I $D(IO("Q")) D  Q
"RTN","PSOBAIRP",26,0)
 .S ZTRTN="REP^PSOBAIRP",ZTDESC="Pharmacy bad address mail label report",ZTSAVE("PSOFORM")="",ZTSAVE("PSOAPAT")="",ZTSAVE("PSOSDT")="",ZTSAVE("PSOEDT")="",ZTSAVE("PSOEDTX")="",ZTSAVE("PSOSDTX")="" D ^%ZTLOAD K %ZIS
"RTN","PSOBAIRP",27,0)
 .W !!,"Report queued to print.",!
"RTN","PSOBAIRP",28,0)
REP ;
"RTN","PSOBAIRP",29,0)
 K ^TMP("PSOBADL",$J)
"RTN","PSOBAIRP",30,0)
 N PSODEV,PSOUT,PSOLINE,PSOPAGE,PSOADND,PSOADF,PSOADFF,PSOAOPT,PSOAOPTA,PSOAOPTZ,PSOAOPTB,PSOAOPTC,PSOADLP,PSOANODE,PSOADX,PSORX,PSOADATE,PSOC,PSOAALL,PSOADFN,PSOANAME,PSONI,PSONX,PSONB,PSOASN,VA,DFN,PSONSSN,PSOAFLAG
"RTN","PSOBAIRP",31,0)
 U IO
"RTN","PSOBAIRP",32,0)
 S (PSOUT,PSOAFLAG)=0,PSODEV=$S($E(IOST,1,2)'="C-":0,1:1),PSOPAGE=1
"RTN","PSOBAIRP",33,0)
 S $P(PSOLINE,"-",78)=""
"RTN","PSOBAIRP",34,0)
ALL ;Print report for all patients
"RTN","PSOBAIRP",35,0)
 N PSORD,PSORX,PSOLBL,PSOX
"RTN","PSOBAIRP",36,0)
 S PSORD=PSOSDT F  S PSORD=$O(^PSRX("AD",PSORD)) Q:'PSORD!(PSORD>PSOEDT)  D
"RTN","PSOBAIRP",37,0)
 .S PSORX=0 F  S PSORX=$O(^PSRX("AD",PSORD,PSORX)) Q:'PSORX  D
"RTN","PSOBAIRP",38,0)
 ..S PSOLBL=$O(^PSRX(PSORX,"L",999999),-1) I 'PSOLBL Q
"RTN","PSOBAIRP",39,0)
 ..S PSOX=$G(^PSRX(PSORX,"L",PSOLBL,0)) I PSOX["(BAD ADDRESS",PSOX'["WINDOW" D
"RTN","PSOBAIRP",40,0)
 ...S PSOADFN=$P($G(^PSRX(PSORX,0)),"^",2) Q:'PSOADFN
"RTN","PSOBAIRP",41,0)
 ...I $G(PSOFORM),PSOADFN'=PSOAPAT Q
"RTN","PSOBAIRP",42,0)
 ...S PSOANAME=$P($G(^DPT(PSOADFN,0)),"^") Q:PSOANAME=""
"RTN","PSOBAIRP",43,0)
 ...S ^TMP("PSOBADL",$J,PSOANAME,PSOADFN,PSORD,PSORX)=""
"RTN","PSOBAIRP",44,0)
 D HD
"RTN","PSOBAIRP",45,0)
 I '$D(^TMP("PSOBADL",$J)) W !!,"No data found to print for this date range.",! G END
"RTN","PSOBAIRP",46,0)
 S PSONI="" F  S PSONI=$O(^TMP("PSOBADL",$J,PSONI)) Q:PSONI=""!(PSOUT)  D
"RTN","PSOBAIRP",47,0)
 .S PSONX="" F  S PSONX=$O(^TMP("PSOBADL",$J,PSONI,PSONX)) Q:PSONX=""!(PSOUT)  D NAME,PRALL D
"RTN","PSOBAIRP",48,0)
 ..S PSONB="" F  S PSONB=$O(^TMP("PSOBADL",$J,PSONI,PSONX,PSONB)) Q:PSONB=""!(PSOUT)  D
"RTN","PSOBAIRP",49,0)
 ...S PSORX="" F  S PSORX=$O(^TMP("PSOBADL",$J,PSONI,PSONX,PSONB,PSORX)) Q:PSORX=""!(PSOUT)  D
"RTN","PSOBAIRP",50,0)
 ....I ($Y+5)>IOSL D HD Q:PSOUT
"RTN","PSOBAIRP",51,0)
 ....S Y=PSONB D DD^%DT S PSOADATE=Y
"RTN","PSOBAIRP",52,0)
 ....D PRONE
"RTN","PSOBAIRP",53,0)
END ;
"RTN","PSOBAIRP",54,0)
 K ^TMP("PSOBADL",$J)
"RTN","PSOBAIRP",55,0)
 K DTOUT,DUOUT
"RTN","PSOBAIRP",56,0)
 I '$G(PSOUT),PSODEV W !!,"End of Report." K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSOBAIRP",57,0)
 I 'PSODEV W !!,"End of Report."
"RTN","PSOBAIRP",58,0)
 I PSODEV W !
"RTN","PSOBAIRP",59,0)
 E  W @IOF
"RTN","PSOBAIRP",60,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSOBAIRP",61,0)
 Q
"RTN","PSOBAIRP",62,0)
HD ;
"RTN","PSOBAIRP",63,0)
 I '$G(PSOFORM) S PSOAFLAG=1
"RTN","PSOBAIRP",64,0)
 I PSODEV,PSOPAGE'=1 W ! K DIR S DIR(0)="E",DIR("A")="Press Return to continue, '^' to exit" D ^DIR K DIR I 'Y S PSOUT=1 Q
"RTN","PSOBAIRP",65,0)
 I PSOPAGE=1,'PSODEV W ! I 1
"RTN","PSOBAIRP",66,0)
 E  W @IOF
"RTN","PSOBAIRP",67,0)
 D  W ?67,"PAGE: "_PSOPAGE S PSOPAGE=PSOPAGE+1
"RTN","PSOBAIRP",68,0)
 .I PSOFORM W !,"Bad address mail label report for "_$G(PSOANAME) Q
"RTN","PSOBAIRP",69,0)
 .W !,"Bad address mail label report for ALL Patients"
"RTN","PSOBAIRP",70,0)
 W !,"for fill date between "_$G(PSOSDTX)_" and "_$G(PSOEDTX)
"RTN","PSOBAIRP",71,0)
 W !,PSOLINE
"RTN","PSOBAIRP",72,0)
 Q
"RTN","PSOBAIRP",73,0)
MESS ;
"RTN","PSOBAIRP",74,0)
 W !!,"Nothing queued to print.",!
"RTN","PSOBAIRP",75,0)
 Q
"RTN","PSOBAIRP",76,0)
NAME ;Set name(ssn)
"RTN","PSOBAIRP",77,0)
 K VA S DFN=PSONX D PID^VADPT6
"RTN","PSOBAIRP",78,0)
 S PSONSSN=$G(PSONI)_"   ("_$E(VA("PID"),5,12)_")"
"RTN","PSOBAIRP",79,0)
 K VA
"RTN","PSOBAIRP",80,0)
 Q
"RTN","PSOBAIRP",81,0)
PRALL ;Print data for all patients
"RTN","PSOBAIRP",82,0)
 N PSOADDR
"RTN","PSOBAIRP",83,0)
 S PSOADDR=""
"RTN","PSOBAIRP",84,0)
 S PSOAFLAG=0
"RTN","PSOBAIRP",85,0)
 W !!,$G(PSONSSN) D CHKADDR W ?30,"  ",PSOADDR I ($Y+5)>IOSL D HD Q:PSOUT
"RTN","PSOBAIRP",86,0)
 Q
"RTN","PSOBAIRP",87,0)
PRONE ;Print data for one patient
"RTN","PSOBAIRP",88,0)
 N PSORX0
"RTN","PSOBAIRP",89,0)
 S PSORX0=$G(^PSRX(PSORX,0)) I PSORX0=""!($P(PSORX0,"^",6)="") Q
"RTN","PSOBAIRP",90,0)
 D CON W !,$G(PSOADATE),?15," Rx#: ",$P(PSORX0,"^"),?30,"  ",$P($G(^PSDRUG($P(PSORX0,"^",6),0)),"^")
"RTN","PSOBAIRP",91,0)
 I ($Y+5)>IOSL D HD Q:PSOUT
"RTN","PSOBAIRP",92,0)
 Q
"RTN","PSOBAIRP",93,0)
CON ;
"RTN","PSOBAIRP",94,0)
 I PSOAFLAG,'PSOFORM W !,$G(PSONSSN) S PSOAFLAG=0
"RTN","PSOBAIRP",95,0)
 Q
"RTN","PSOBAIRP",96,0)
 ;
"RTN","PSOBAIRP",97,0)
CHKADDR ;
"RTN","PSOBAIRP",98,0)
 N PSOBADR,PSOTEMP
"RTN","PSOBAIRP",99,0)
 I $G(PSONX)="" Q
"RTN","PSOBAIRP",100,0)
 S PSOBADR=$$BADADR^DGUTL3(PSONX)
"RTN","PSOBAIRP",101,0)
 I PSOBADR D
"RTN","PSOBAIRP",102,0)
 .S PSOTEMP=$$CHKTEMP^PSOBAI(PSONX)
"RTN","PSOBAIRP",103,0)
 I PSOBADR,'PSOTEMP S PSOADDR="** BAD ADDRESS **" Q
"RTN","PSOBAIRP",104,0)
 S PSOADDR="PATIENT NOW HAS A VALID ADDRESS"
"RTN","PSOBAIRP",105,0)
 Q
"RTN","PSOBINGO")
0^60^B63802606^B63409607
"RTN","PSOBINGO",1,0)
PSOBINGO ;BHAM ISC/LC - BINGO BOARD OPTION DRIVER ;8/1/07 1:45pm
"RTN","PSOBINGO",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**12,28,56,125,152,232,268,275,326**;DEC 1997;Build 11
"RTN","PSOBINGO",3,0)
 ;External Ref. to ^PS(55 is supp. by DBIA# 2228
"RTN","PSOBINGO",4,0)
 ;External Ref. to ^PSDRUG(, is supp. by DBIA# 221
"RTN","PSOBINGO",5,0)
 ;
"RTN","PSOBINGO",6,0)
 ;*232 add ATIC xref set/kill code here
"RTN","PSOBINGO",7,0)
 ;*275 BA xref sometimes gets corrupted, kill bad BA xref and quit
"RTN","PSOBINGO",8,0)
 ;
"RTN","PSOBINGO",9,0)
 S (FLAG,FLAG1)=0,(TRIPS,JOES,ADV,DGP)="" G:'$G(PSOAP) END D:'$D(PSOPAR) ^PSOLSET G:'$D(PSOPAR) END
"RTN","PSOBINGO",10,0)
BEG ;PSOAP=1 NEW ENTRY; 2=DISPLAY; 3=REMOVE
"RTN","PSOBINGO",11,0)
 D NOW^%DTC S TM=$E(%,1,12),TM1=$P(TM,".",2) G:PSOAP=1 NEW I PSOAP=3 D BCRMV^PSOBING1 G:'$D(X) END
"RTN","PSOBINGO",12,0)
 I PSOAP=3 S DIC=52.11,DIC(0)="EMQZ",DIC("S")="I '$P($G(^PS(52.11,Y,0)),U,8)" D ^DIC K DIC G:+Y'>0 BEG G:($G(DTOUT))!($G(DUOUT)) END S DA=+Y,NAM=Y(0,0)
"RTN","PSOBINGO",13,0)
 I PSOAP=2 W !! K DIC,DIE,DLAYGO S (DIC,DIE)=52.11,DIC(0)="AEMQZ",DIC("A")="Enter Patient Name to Display: ",DIC("S")="I $P($G(^PS(52.11,Y,0)),U,4)=PSOSITE&'$P($G(^PS(52.11,Y,0)),U,7)"
"RTN","PSOBINGO",14,0)
 I PSOAP=2 D ^DIC K DIC G:+Y'>0!($G(DTOUT))!($G(DUOUT)) END S (DA,ODA)=+Y,NAM=Y(0,0)
"RTN","PSOBINGO",15,0)
 I PSOAP=3 D STUF,REMOVE1 G BEG
"RTN","PSOBINGO",16,0)
 I PSOAP=2,($P($G(^PS(52.11,DA,0)),"^",7)]"") W !!,NAM,"  is already in the display queue.",$C(7) G BEG
"RTN","PSOBINGO",17,0)
 I PSOAP=2,$P($P($G(^PS(52.11,DA,0)),"^",5),".")'=DT S Y=$P($P($G(^PS(52.11,DA,0)),"^",5),".") D DD^%DT W !!,$C(7),NAM," was entered on "_Y_".",!,"It can't be displayed and is now deleted." S DIK="^PS(52.11," D ^DIK K DIK G BEG
"RTN","PSOBINGO",18,0)
 I PSOAP=2&($P(^PS(52.11,ODA,0),"^",4)'=+PSOSITE) W !!,$C(7),NAM," was entered under the "_$P(^PS(59,$P(^(0),"^",4),0),"^")_" division." G BEG
"RTN","PSOBINGO",19,0)
 I PSOAP=2 S PSODRF=0 D CREF^PSOBING1 G:PSODRF BEG D  G BEG
"RTN","PSOBINGO",20,0)
 .S NM=$P(^DPT($P(^PS(52.11,ODA,0),"^"),0),"^"),DR="6////"_$E(TM1_"0000",1,4)_";8////"_NM_""
"RTN","PSOBINGO",21,0)
 .D PASS,SETUP S DA=ODA D STATS1^PSOBRPRT,WTIME^PSOBING1
"RTN","PSOBINGO",22,0)
NEW ;Init lookup
"RTN","PSOBINGO",23,0)
 W !! K DIC S DIC=2,DIC(0)="QEAM",DIC("A")="Enter Patient Name : " D EN^PSOPATLK S Y=PSOPTLK K DIC,PSOPTLK G:Y<0!($G(DUOUT))!($G(DTOUT)) END S (DA,ADA,DFN)=+Y D DEM^VADPT Q:VAERR  S NAM=VADM(1),SSN=$P(VADM(2),"^")
"RTN","PSOBINGO",24,0)
 K DD,DO S:$D(DISGROUP) DGP=$P($G(^PS(59.3,DISGROUP,0)),"^") S (DIC,DIE)="^PS(52.11,",X=ADA,DIC("DR")=$S($G(GROUPCNT)=1&($G(DISGROUP)):"2////"_DISGROUP_"",1:"2//^S X=DGP")
"RTN","PSOBINGO",25,0)
 S DIC(0)="LMNQZ",DLAYGO=59.3 D FILE^DICN K DD,DO,DIC G:Y'>0 NEW
"RTN","PSOBINGO",26,0)
 S JOES=$P(Y(0),"^",3),ADV=$P($G(^PS(59.3,JOES,0)),"^",2),DA=+Y
"RTN","PSOBINGO",27,0)
 I $G(DTOUT)!($G(DUOUT))!(X="") D WARN G NEW
"RTN","PSOBINGO",28,0)
TIC K TFLAG I ADV="T" S DIR(0)="NA^1:999999:0",DIR("A")="TICKET #:",DIR("?")="Ticket # must be numeric and unique" D ^DIR I $D(DUOUT)!($D(DTOUT))!($D(DIRUT)) D WARN G BEG
"RTN","PSOBINGO",29,0)
 S TFLAG=1 I PSOAP=1,$G(ADV)="T" W !! S TIC=+Y D
"RTN","PSOBINGO",30,0)
 .F TIEN=0:0 S TIEN=$O(^PS(52.11,"C",TIC,TIEN)) Q:'TIEN  I DA'=TIEN,($G(PSOSITE)=+$P(^PS(52.11,TIEN,0),"^",4)) D
"RTN","PSOBINGO",31,0)
 ..S TDFN=$P(^PS(52.11,TIEN,0),"^"),TSSN=$P(^PS(52.11,TIEN,1),"^",2),TFLAG=0 W !,$C(7),$P(^DPT(TDFN,0),"^")_" ("_TSSN_") was issued ticket # "_TIC,". Try again!",!
"RTN","PSOBINGO",32,0)
 .K TDFN,TIEN,TSSN Q:'TFLAG
"RTN","PSOBINGO",33,0)
 G:'TFLAG TIC I ADV="T" S DR="1////"_TIC_";3////"_PSOSITE_";4////"_TM_";5////"_$E(TM1_"0000",1,4)_";8////"_NAM_";9////"_SSN_";13////0",FLAG1=1 G PASS
"RTN","PSOBINGO",34,0)
 S DR="3////"_PSOSITE_";4////"_TM_";5////"_$E(TM1_"0000",1,4)_";8////"_NAM_";9////"_SSN_";13////0"
"RTN","PSOBINGO",35,0)
PASS S NFLAG=1 L +^PS(52.11,DA):$S(+$G(^DD("DILOCKTM"))>0:+^DD("DILOCKTM"),1:3) E  W !!,$C(7),Y(0,0)," is being edited!",! Q
"RTN","PSOBINGO",36,0)
 D ^DIE L -^PS(52.11,DA) I $G(DUOUT)!($G(DTOUT))!(X="") D WARN G BEG
"RTN","PSOBINGO",37,0)
 S:$G(PSOAP)=1 FLGG=0 G:$G(PSOAP)'=1 STRX1
"RTN","PSOBINGO",38,0)
STRX ;sto Rx #'s IN 52.11
"RTN","PSOBINGO",39,0)
 N BRXNUM,BBFTYP,BBFNUM,BBMW,MWDIR,II,FL,FLN,PR,PRN,PRNDT,FLNDT,Y
"RTN","PSOBINGO",40,0)
STRX0 S DIR(0)="FO^1:11",DIR("A")="Enter Rx #",DIR("?")="^D HELP^PSOBINGO",DIR("??")="^D HELP2^PSOBINGO" D ^DIR G:X=""&($G(FLGG)) STRX1 I $D(DIRUT) D WARN G BEG
"RTN","PSOBINGO",41,0)
 S DIC=52,DIC(0)="EQM",DIC("S")="I $P($G(^PSRX(Y,0)),U,2)=ADA" D ^DIC K DIC I $D(DUOUT)!($D(DTOUT)) D WARN G BEG
"RTN","PSOBINGO",42,0)
 G:Y=-1 STRX0
"RTN","PSOBINGO",43,0)
 I $G(Y)<0&('$G(FLGG)) D WARN G BEG
"RTN","PSOBINGO",44,0)
 I $G(Y)<0&($G(FLGG)) G STRX1
"RTN","PSOBINGO",45,0)
 S BRXNUM=$P(Y,"^")
"RTN","PSOBINGO",46,0)
 I $D(^PSRX(BRXNUM,1,0)) F II=0:0 S II=$O(^PSRX(BRXNUM,1,II)) Q:'II  S FLN=II
"RTN","PSOBINGO",47,0)
 I $D(FLN) S FLNDT=$P(^PSRX(BRXNUM,1,FLN,0),"^"),FL="F"
"RTN","PSOBINGO",48,0)
 I $D(^PSRX(BRXNUM,"P",0)) F II=0:0 S II=$O(^PSRX(BRXNUM,"P",II)) Q:'II  S PRN=II
"RTN","PSOBINGO",49,0)
 I $D(PRN) S PRNDT=$P(^PSRX(BRXNUM,"P",PRN,0),"^"),PR="P"
"RTN","PSOBINGO",50,0)
 S:$D(FLN)!($D(PRN)) BBFTYP=$S($G(PRNDT)>$G(FLNDT):PR,1:"F")
"RTN","PSOBINGO",51,0)
 I $G(BBFTYP)="P" S BBFNUM=PRN,BBMW=$P(^PSRX(BRXNUM,"P",PRN,0),"^",2)
"RTN","PSOBINGO",52,0)
 I $G(BBFTYP)="F" S BBFNUM=FLN,BBMW=$P(^PSRX(BRXNUM,1,FLN,0),"^",2)
"RTN","PSOBINGO",53,0)
 I '$D(BBFTYP) S BBFTYP="F",BBFNUM=0,BBMW=$P(^PSRX(BRXNUM,0),"^",11)
"RTN","PSOBINGO",54,0)
MW ;
"RTN","PSOBINGO",55,0)
 I $G(BBMW)="M" W !?5,$C(7),"Routing is set for Mail" D DIR
"RTN","PSOBINGO",56,0)
 I $D(MWDIR) K BRXNUM,BBFTYP,BBFNUM,BBMW,MWDIR,II,FL,FLN,PR,PRN,PRNDT,FLNDT,Y G STRX
"RTN","PSOBINGO",57,0)
 ;
"RTN","PSOBINGO",58,0)
 S X=BRXNUM,DIC("DR")="1////"_BBFTYP_";2////"_BBFNUM_"",DLAYGO=52.11
"RTN","PSOBINGO",59,0)
 S DA(1)=DA,DIC="^PS(52.11,"_DA(1)_",2,",DIC(0)="L",DIC("P")=$P(^DD(52.11,12,0),"^",2) K DD,DO D FILE^DICN K Y,DD,DO,X,BRXNUM,BBFTYP,BBFNUM,II,FL,PR,PRNDT,FLNDT S FLGG=1 G STRX
"RTN","PSOBINGO",60,0)
 ;
"RTN","PSOBINGO",61,0)
STRX1 D:PSOAP=1&($G(ADV)="N") CHKUP,NOTE G:'NFLAG BEG D STUF G:FLAG BEG Q:PSOAP=2
"RTN","PSOBINGO",62,0)
SETUP S ZZZ=0 I '$D(^PS(59.2,DT,0)) K DD,DIC,DO,DA S X=DT,DIC="^PS(59.2,",DIC(0)="",DINUM=X,DLAYGO=59.2 D FILE^DICN K DD,DO S ZZZ=1 Q:Y'>0
"RTN","PSOBINGO",63,0)
 I ZZZ=1 K DD,DO S DLAYGO=59.2,DA(1)=+Y,DIC=DIC_DA(1)_",1,",(DINUM,X)=PSOSITE,DIC(0)="",DIC("P")=$P(^DD(59.2,1,0),"^",2) D FILE^DICN K DD,DO,DIC,DA Q:Y'>0
"RTN","PSOBINGO",64,0)
 Q:PSOAP=2&($P($G(^PS(59.2,DT,1,PSOSITE,0)),"^"))  I ZZZ=0 K DD,DIC,DO,DA S DA(1)=DT,(DINUM,X)=PSOSITE,DIC="^PS(59.2,"_DT_",1,",DIC(0)="LZ",DLAYGO=59.2 D FILE^DICN K DD,DIC,DA,DO Q:PSOAP=2  G NEW
"RTN","PSOBINGO",65,0)
 G BEG
"RTN","PSOBINGO",66,0)
STUF S RX0=^PS(52.11,DA,0),JOES=$P(RX0,"^",4),TICK=$P($G(RX0),"^",2) Q:PSOAP=3  G:ADV="T"&($G(FLAG1)=1)&('$G(TICK)) WARN G:'$G(JOES)!($G(NAM)']"") WARN
"RTN","PSOBINGO",67,0)
 W:PSOAP=2 !!,"Patient added in display queue." W:PSOAP=1 !!,"Record is added." Q
"RTN","PSOBINGO",68,0)
WARN W !!!,$C(7),"Patient record incomplete!" S FLAG=1,DIK="^PS(52.11," D ^DIK G SHOW Q
"RTN","PSOBINGO",69,0)
REMOVE S DIK="^PS(52.11," D ^DIK
"RTN","PSOBINGO",70,0)
SHOW K DIK,DA,ADA W !!,"Record is removed."
"RTN","PSOBINGO",71,0)
 Q
"RTN","PSOBINGO",72,0)
REMOVE1 ;
"RTN","PSOBINGO",73,0)
 Q:'$D(^PS(52.11,"ANAM",$P(^PS(52.11,DA,0),"^",3),$P(^(1),"^",3)_$P(^(1),"^",4)_" "_$P(^DPT(+$P(^PS(52.11,DA,0),"^"),0),"^"),DA))
"RTN","PSOBINGO",74,0)
 N DIE,DR I $D(^PS(52.11,"ANAM",$P(^PS(52.11,DA,0),"^",3),$P(^(1),"^",3)_$P(^(1),"^",4)_" "_$P(^DPT(+$P(^PS(52.11,DA,0),"^"),0),"^"),DA)) S DIE="^PS(52.11,",DR="7////1" D
"RTN","PSOBINGO",75,0)
 .D ^DIE
"RTN","PSOBINGO",76,0)
 .K ^PS(52.11,"ANAM",$P(^PS(52.11,DA,0),"^",3),$P(^(1),"^",3)_$P(^(1),"^",4)_" "_$P(^DPT(+$P(^PS(52.11,DA,0),"^"),0),"^"),DA)
"RTN","PSOBINGO",77,0)
 I $D(^PS(52.11,"ATIC",+$P(^PS(52.11,DA,0),"^",3),+$P(^(0),"^",2),DA)) S DIE="^PS(52.11,",DR="7////1" D
"RTN","PSOBINGO",78,0)
 .D ^DIE
"RTN","PSOBINGO",79,0)
 .K ^PS(52.11,"ATIC",+$P(^PS(52.11,DA,0),"^",3),+$P(^(0),"^",2),DA)
"RTN","PSOBINGO",80,0)
 Q
"RTN","PSOBINGO",81,0)
CHKUP ;Multi & dupe names
"RTN","PSOBINGO",82,0)
 S SDA=DA S:'$D(DFN) DFN=PSODFN G:$O(^PS(52.11,"B",DFN,0))=DA BROW F P=0:0 S P=$O(^PS(52.11,"B",DFN,P)) Q:'P!(P=DA)  S LAST=P
"RTN","PSOBINGO",83,0)
 Q:'$G(LAST)  S TRIPS=$P($G(^PS(52.11,LAST,1)),"^",4) I TRIPS]"" S TRIPS=$A(TRIPS),TRIPS=TRIPS+1,TRIPS=$C(TRIPS) S DR="11////"_TRIPS_"" D ^DIE S F1=1 G BROW
"RTN","PSOBINGO",84,0)
 K TRIPS
"RTN","PSOBINGO",85,0)
FIRST ;Set 1st dup
"RTN","PSOBINGO",86,0)
 S DR="11////A" D ^DIE K DR,CNT
"RTN","PSOBINGO",87,0)
BROW S DA=SDA,NOPE=0,CNT=0
"RTN","PSOBINGO",88,0)
 F NIEN=0:0 S NIEN=$O(^PS(52.11,"BA",NAM,NIEN)) Q:'NIEN!(NIEN=$G(DA))  D  Q:NOPE
"RTN","PSOBINGO",89,0)
 . ;add check for bad xref and kill        *275
"RTN","PSOBINGO",90,0)
 . I '$D(^PS(52.11,NIEN,0)) K ^PS(52.11,"BA",NAM,NIEN) Q
"RTN","PSOBINGO",91,0)
 . D:$D(^PS(52.11,"BI")) BICK Q:CNT>0
"RTN","PSOBINGO",92,0)
 . D SETNEW
"RTN","PSOBINGO",93,0)
 Q
"RTN","PSOBINGO",94,0)
SETNEW S SSN1=$O(^PS(52.11,"BA",NAM,NIEN,0)),ADFN=$P(^PS(52.11,NIEN,0),"^"),CNT=1 I SSN1=SSN S NOPE=1 Q
"RTN","PSOBINGO",95,0)
 S DR="10////1" D ^DIE S F1=1 Q
"RTN","PSOBINGO",96,0)
BICK ;Chks "BI" Xref & assigns seq#
"RTN","PSOBINGO",97,0)
 S SSN1=$O(^PS(52.11,"BA",NAM,NIEN,0)) I SSN1=SSN&('$P($G(^PS(52.11,SDA,1)),"^",3)) S NOPE=1 Q
"RTN","PSOBINGO",98,0)
 S CNT=0 I $D(^PS(52.11,"BI",DFN)) S CNT=$O(^(DFN,0)),DA=SDA,DR="10////"_CNT_"" D ^DIE S F1=1 Q
"RTN","PSOBINGO",99,0)
 F NDFN=0:0 S NDFN=$O(^PS(52.11,"BI",NDFN)) Q:'NDFN  S CNT=$O(^(NDFN,0))+1
"RTN","PSOBINGO",100,0)
 S DR="10////"_CNT_"" D ^DIE S F1=1 Q
"RTN","PSOBINGO",101,0)
NOTE S DFN=$P($G(^PS(52.11,DA,0)),"^"),NFLAG=1 W !!,?5,"NAME",?30,"SSN",?45,"ID",?50,"ORDER"
"RTN","PSOBINGO",102,0)
 F Z=0:0 S Z=$O(^PS(52.11,"B",DFN,Z)) Q:'Z  S ZDA=Z S NODE=$G(^PS(52.11,ZDA,1)),Z1=$P(NODE,"^"),Z2=$P(NODE,"^",3),Z3=$P(NODE,"^",4),Z4=$P(NODE,"^",2) W:NODE'="" !,?5,Z1,?30,Z4,?46,Z2,?52,Z3
"RTN","PSOBINGO",103,0)
 W !! S DIR(0)="F,O",DIR("A")="Press return to add the last prescription or '^' to remove it."
"RTN","PSOBINGO",104,0)
 S DIR("A",1)="Please advise the patient that the above ID # or ORDER Letter",DIR("A",2)="or both will be displayed with his/her name on the Bingo Display",DIR("A",3)=" "
"RTN","PSOBINGO",105,0)
 D ^DIR K DIR K NODE,Z1,Z2,Z3 I $G(DTOUT)!(Y="^") S NFLAG=0 D REMOVE
"RTN","PSOBINGO",106,0)
 Q
"RTN","PSOBINGO",107,0)
DIR K DIR,X,Y S DIR(0)="Y",DIR("A")="Continue ",DIR("B")="N",DIR("?")="Answer YES to continue, NO to bypass"
"RTN","PSOBINGO",108,0)
 D ^DIR K DIR S:$D(DIRUT)!('Y) MWDIR=1 K DIRUT,DTOUT,DUOUT,X,Y
"RTN","PSOBINGO",109,0)
 Q
"RTN","PSOBINGO",110,0)
HELP2 S (PA,PD)="",PL=0 F  S PA=$O(^PS(55,ADA,"P","A",PA)) Q:'PA  D:DT-1<PA
"RTN","PSOBINGO",111,0)
 .F  S PD=$O(^PS(55,ADA,"P","A",PA,PD)) Q:'PD  S PL=PL+1 W !,$P(^PSRX(PD,0),"^"),"      ",$P(^PSDRUG($P(^PSRX(PD,0),"^",6),0),"^")
"RTN","PSOBINGO",112,0)
 .I $G(PL)>15 N DIR S DIR(0)="E",DIR("A")="Press return to continue" D ^DIR K DIR S PL=0
"RTN","PSOBINGO",113,0)
 Q
"RTN","PSOBINGO",114,0)
HELP W !,"Enter the patient's Rx number.",!
"RTN","PSOBINGO",115,0)
 Q
"RTN","PSOBINGO",116,0)
ATICSET ;Set ATIC xref                                                PSO*232
"RTN","PSOBINGO",117,0)
 Q:'+$P(^PS(52.11,DA,0),"^",3)
"RTN","PSOBINGO",118,0)
 Q:'+$P(^PS(52.11,DA,0),"^",2)
"RTN","PSOBINGO",119,0)
 I $P(^PS(59.3,$P(^PS(52.11,DA,0),"^",3),0),"^",2)["T" D
"RTN","PSOBINGO",120,0)
 .S ^PS(52.11,"ATIC",+$P(^PS(52.11,DA,0),"^",3),+$P(^(0),"^",2),DA)=""
"RTN","PSOBINGO",121,0)
 Q
"RTN","PSOBINGO",122,0)
ATICKIL ;Kill ATIC xref                                               PSO*232
"RTN","PSOBINGO",123,0)
 Q:'+$P(^PS(52.11,DA,0),"^",3)
"RTN","PSOBINGO",124,0)
 Q:'+$P(^PS(52.11,DA,0),"^",2)
"RTN","PSOBINGO",125,0)
 I $P(^PS(59.3,$P(^PS(52.11,DA,0),"^",3),0),"^",2)["T" D
"RTN","PSOBINGO",126,0)
 .K ^PS(52.11,"ATIC",+$P(^PS(52.11,DA,0),"^",3),+$P(^(0),"^",2),DA)
"RTN","PSOBINGO",127,0)
 Q
"RTN","PSOBINGO",128,0)
 ;
"RTN","PSOBINGO",129,0)
END K %,ADA,ADFN,ADV,CNT,DA,DATE,DFN,DINUM,DLAYGO,DR,DTOUT,DUOUT,F1,FLAG,FLAG1,FLGG,JOES,LAST,NAM,NDFN,NIEN,NFLAG,NODE,NOPE,NM
"RTN","PSOBINGO",130,0)
 K PSODRF,ODA,P,PSOAP,RX0,TM,TM1,SDA,SSN,SSN1,RX0,TIC,TICK,TFLAG,VADM,X,Y,Z,Z1,Z2,Z3,Z4,ZDA,ZZZ,PL,PD,PA
"RTN","PSOBINGO",131,0)
 Q
"RTN","PSODACT")
0^3^B16620275^B16808016
"RTN","PSODACT",1,0)
PSODACT ;BHAM ISC/JrR - CREATE DUE ANSWER SHEET FROM ACTION PROFILE ; 11/18/92 18:58
"RTN","PSODACT",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**2,326**;DEC 1997;Build 11
"RTN","PSODACT",3,0)
 Q
"RTN","PSODACT",4,0)
ENSAVE ;Enter here from PSOSD0 to store info about each DUE RX
"RTN","PSODACT",5,0)
 ;as Action Profile is printing. Needs RXNODE=NODE '0' OF RXN,RXN
"RTN","PSODACT",6,0)
 S PSOQDRG=$P(RXNODE,"^",6),PSOQDFN=$P(RXNODE,"^",2)
"RTN","PSODACT",7,0)
 I $D(^PS(50.073,"AD",PSOQDRG)),('$P(RXNODE,"^",15)!($P(RXNODE,"^",15)=5)) F PSOQ=0:0 S PSOQ=$O(^PS(50.073,"AD",PSOQDRG,PSOQ)) Q:'PSOQ  D
"RTN","PSODACT",8,0)
 .I $P(^PS(50.073,PSOQ,0),"^",2),$P(^(0),"^",3) F DIV=0:0 S DIV=$O(^PS(50.073,PSOQ,3,DIV)) Q:'DIV  I $P(^PS(50.073,PSOQ,3,DIV,0),"^")=$G(PSOSITE) D STORE
"RTN","PSODACT",9,0)
 K PSOQ,PSOQDRG,PSOQDFN,DIV
"RTN","PSODACT",10,0)
 QUIT
"RTN","PSODACT",11,0)
 ;return to ^PSOSD0
"RTN","PSODACT",12,0)
 ;
"RTN","PSODACT",13,0)
STORE S ^TMP("PSOD",$J,RXN,PSOQDRG,PSOQ,5)=$P(RXNODE,"^",4)
"RTN","PSODACT",14,0)
 S ^TMP("PSOD",$J,RXN,PSOQDRG,PSOQ,8)=PSOQDFN
"RTN","PSODACT",15,0)
 Q
"RTN","PSODACT",16,0)
 ;
"RTN","PSODACT",17,0)
ENSTUFF ;Enter here from PSOSD Action Profile
"RTN","PSODACT",18,0)
 ;Print an Answer sheet for DUE RXs stored at ENSAVE above
"RTN","PSODACT",19,0)
 NEW I,RXN
"RTN","PSODACT",20,0)
 Q:'$D(^TMP("PSOD",$J))
"RTN","PSODACT",21,0)
 F RXN=0:0 S RXN=$O(^TMP("PSOD",$J,RXN)) Q:'RXN  F PSOQDRG=0:0 S PSOQDRG=$O(^TMP("PSOD",$J,RXN,PSOQDRG)) Q:'PSOQDRG  F PSOQ=0:0 S PSOQ=$O(^TMP("PSOD",$J,RXN,PSOQDRG,PSOQ)) Q:'PSOQ  D PRINT
"RTN","PSODACT",22,0)
 K ^TMP("PSOD",$J) W:'$D(PSONOPG) @IOF
"RTN","PSODACT",23,0)
 K PSOQDRG,PSOQ,PSA,PIECE,FLAG,I,PSOQPHYS,DFN,SSN,PSIGN,PSOQL
"RTN","PSODACT",24,0)
 K PSOQDFN,PSOQM,PSOQSSN,PSQNUM,PSOQN,PSOQNUM,PSQ,PSTXT,PSWRAP,PSMARG
"RTN","PSODACT",25,0)
 QUIT
"RTN","PSODACT",26,0)
 ;return to ^PSOSD
"RTN","PSODACT",27,0)
 ;
"RTN","PSODACT",28,0)
SET ;This code is not being executed at this time.
"RTN","PSODACT",29,0)
 D NEW S PSA=+Y
"RTN","PSODACT",30,0)
 S $P(^PS(50.0731,PSA,0),"^",2,4)=PSOQ_"^"_PSOQDRG_"^"_RXN
"RTN","PSODACT",31,0)
 F PIECE=5,8 S $P(^PS(50.0731,PSA,0),"^",PIECE)=^TMP("PSOD",$J,RXN,PSOQDRG,PSOQ,PIECE)
"RTN","PSODACT",32,0)
MOVE S FLAG=0
"RTN","PSODACT",33,0)
 F I=0:0 S I=$O(^PS(50.073,PSOQ,2,I)) Q:'I  S:$D(^PS(50.0732,$P(^(I,0),"^",2),0)) ^PS(50.0731,PSA,1,I,0)=^PS(50.073,PSOQ,2,I,0),$P(^PS(50.0732,$P(^(0),"^",2),0),"^",7)=1,FLAG=1
"RTN","PSODACT",34,0)
 S:FLAG $P(^PS(50.073,PSOQ,0),"^",4)=1,^PS(50.0731,PSA,1,0)="^50.07311IA^"_$P(^PS(50.073,PSOQ,2,0),"^",3,4)
"RTN","PSODACT",35,0)
 S DIK="^PS(50.0731,",DA=PSA D IX^DIK K DIK,DA
"RTN","PSODACT",36,0)
 Q
"RTN","PSODACT",37,0)
 ;
"RTN","PSODACT",38,0)
NEW ;laygo into the DUE Answer file
"RTN","PSODACT",39,0)
 L +^PS(50.0731,0):20
"RTN","PSODACT",40,0)
 S X=$P(^PS(50.0731,0),"^",3)
"RTN","PSODACT",41,0)
LOOP S X=X+1 G:$D(^PS(50.0731,X)) LOOP L
"RTN","PSODACT",42,0)
 K DIC,DD,DO S DIC="^PS(50.0731,",DIC(0)="XL",DIC("DR")="6///NOW",DLAYGO=50.0731,DINUM=X D FILE^DICN
"RTN","PSODACT",43,0)
 K DIC,DLAYGO,DINUM
"RTN","PSODACT",44,0)
 L -^PS(50.0731,0)
"RTN","PSODACT",45,0)
 Q:$P(Y,"^",3)
"RTN","PSODACT",46,0)
 G NEW
"RTN","PSODACT",47,0)
 ;
"RTN","PSODACT",48,0)
PRINT ;prints DUE Questionnaire
"RTN","PSODACT",49,0)
 W @IOF,!!,@$S($G(PSORM)=0:"?25",1:"?52"),"***** Due Answer Sheet *****"
"RTN","PSODACT",50,0)
 W !!,"SEQ. Number: _______________",?($X+3),"Questionnaire: "_$P(^PS(50.073,PSOQ,0),"^"),@$S($G(PSORM)=0:"!",1:"?$X+3"),"Drug: "_$P(^PSDRUG(PSOQDRG,0),"^"),@$S($G(PSORM)=0:"?45",1:"?109"),"Rx #: "_$P(^PSRX(RXN,0),"^")
"RTN","PSODACT",51,0)
 S PSOQPHYS=$P($G(^VA(200,+$P(^PSRX(RXN,0),"^",4),0)),"^")
"RTN","PSODACT",52,0)
 W !!,"Rx Provider: ",$E(PSOQPHYS,1,20)
"RTN","PSODACT",53,0)
 S PSOQDFN=^TMP("PSOD",$J,RXN,PSOQDRG,PSOQ,8)
"RTN","PSODACT",54,0)
 W ?($X+3),"Patient: ",$P(^DPT(PSOQDFN,0),"^"),@$S($G(PSORM)=0:"!",1:"?$X+3"),?($X+3),"Section: ______________"
"RTN","PSODACT",55,0)
 W @$S($G(PSORM)=0:"?$X+3",1:"?109"),"Date: "
"RTN","PSODACT",56,0)
 S Y=DT D DT^DIQ
"RTN","PSODACT",57,0)
QOUT ;Enter here from ^PSODUE to print questions for Questionaire
"RTN","PSODACT",58,0)
 K PSOQL S $P(PSOQL,"-",$S($G(PSORM)=0:80,1:IOM))="" W !,PSOQL
"RTN","PSODACT",59,0)
 I $O(^PS(50.073,PSOQ,"N",0)) D NARATV,^DIWW K DIWF,DIWL,DIWR
"RTN","PSODACT",60,0)
 S PSIGN=0
"RTN","PSODACT",61,0)
 I $O(^PS(50.073,PSOQ,2,0)) F PSOQN=0:0 S PSOQN=$O(^PS(50.073,PSOQ,2,PSOQN)) Q:'PSOQN  S PSIGN=1,PSOQM=^(PSOQN,0) D:$P(PSOQM,"^",2)
"RTN","PSODACT",62,0)
 .S PSQNUM=+PSOQM,PSQ=$P(^PS(50.0732,$P(PSOQM,"^",2),0),"^") D WRAP^PSODEDT W !?($L(PSQNUM)+2),"Answer: ",! I $Y>(IOSL-7) W @IOF
"RTN","PSODACT",63,0)
 W:PSIGN ?(IOM-40),"Signature: __________________________",!
"RTN","PSODACT",64,0)
 Q
"RTN","PSODACT",65,0)
NARATV K ^UTILITY($J,"W") S DIWL=4,DIWR=$S($G(PSORM)=0:80,1:IOM),DIWF="WN" F PSOQN=0:0 S PSOQN=$O(^PS(50.073,PSOQ,"N",PSOQN)) Q:'PSOQN  S X=^(PSOQN,0) D ^DIWP
"RTN","PSODACT",66,0)
 Q
"RTN","PSODEM")
0^4^B13834682^B13921896
"RTN","PSODEM",1,0)
PSODEM ;BHAM ISC/SAB - PATIENT DEMOGRAPHICS ; 02/17/93 12:29
"RTN","PSODEM",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**5,19,233,258,326**;DEC 1997;Build 11
"RTN","PSODEM",3,0)
GET S DFN=DA D 6^VADPT,PID^VADPT U IO W @IOF,!,VADM(1)
"RTN","PSODEM",4,0)
 I +VAPA(9) W !?5,"(TEMP ADDRESS from "_$P(VAPA(9),"^",2)_" till "_$S($P(VAPA(10),"^",2)]"":$P(VAPA(10),"^",2),1:"(no end date)")_")"
"RTN","PSODEM",5,0)
 W !,VAPA(1),?40,"DOB:   ",$S(+VADM(3):$P(VADM(3),"^",2),1:"UNKNOWN") W:VAPA(2)]"" !,VAPA(2) W:VAPA(3)]"" !,VAPA(3)
"RTN","PSODEM",6,0)
 W !,VAPA(4),?40,"PHONE: "_VAPA(8),!,$P(VAPA(5),"^",2)_"  "_$S(VAPA(11)]"":$P(VAPA(11),"^",2),1:VAPA(6)),?40,"ELIG:  "_$P(VAEL(1),"^",2) W:+VAEL(3) !?40,"SC%:   "_$P(VAEL(3),"^",2)
"RTN","PSODEM",7,0)
 I $D(^PS(55,DFN,0)) W:$P(^(0),"^",2) !,"CANNOT USE SAFETY CAPS." I +$P(^(0),"^",4) W ?40,"DIALYSIS PATIENT."
"RTN","PSODEM",8,0)
 I $G(^PS(55,DFN,1))]"" S X=^(1) W !!?5,"Pharmacy Narrative: " F I=1:1 Q:$P(X," ",I,99)=""  W:$X+$L($P(X," ",I))+$L(" ")>IOM ! W $P(X," ",I)," "
"RTN","PSODEM",9,0)
RE S (WT,HT)="",X="GMRVUTL" X ^%ZOSF("TEST") I $T D
"RTN","PSODEM",10,0)
 .F GMRVSTR="WT","HT" S VM=GMRVSTR D EN6^GMRVUTL S @VM=X,$P(@VM,"^")=$E($P(@VM,"^"),4,5)_"/"_$E($P(@VM,"^"),6,7)_"/"_($E($P(@VM,"^"),1,3)+1700)
"RTN","PSODEM",11,0)
 .S X=$P(WT,"^",8),Y=$J(X/2.2,0,2),$P(WT,"^",9)=Y,X=$P(HT,"^",8),Y=$J(2.54*X,0,2),$P(HT,"^",9)=Y
"RTN","PSODEM",12,0)
 Q:$G(POERR)
"RTN","PSODEM",13,0)
 W !!,"WEIGHT(Kg): " W:+$P(WT,"^",8) $P(WT,"^",9)_" ("_$P(WT,"^")_")" W ?41,"HEIGHT(cm): " W:$P(HT,"^",8) $P(HT,"^",9)_" ("_$P(HT,"^")_")" K VM,WT,HT
"RTN","PSODEM",14,0)
 S PSLC=0 G MA:$P($G(^DPT(DFN,.17)),"^",2)'="I"
"RTN","PSODEM",15,0)
 I '$D(VAEL(1)) D ELIG^VADPT W !!,"ELIGIBILITY: ",$P(VAEL(1),"^",2) W:+VAEL(3) ?$X+5,"SC%: "_$P(VAEL(3),"^",2) S PSLC=PSLC+2
"RTN","PSODEM",16,0)
MA K SC W !,"DISABILITIES: " S PSLC=PSLC+2
"RTN","PSODEM",17,0)
 F I=0:0 S I=$O(^DPT(DFN,.372,I)) Q:'I  S I1=$S($D(^DPT(DFN,.372,I,0)):^(0),1:"") D:+I1
"RTN","PSODEM",18,0)
 .S PSDIS=$S($P($G(^DIC(31,+I1,0)),"^")]""&($P($G(^(0)),"^",4)']""):$P(^(0),"^"),$P($G(^DIC(31,+I1,0)),"^",4)]"":$P(^(0),"^",4),1:""),PSCNT=$P(I1,"^",2)
"RTN","PSODEM",19,0)
 .X:($X+$L(PSDIS)+7)>(IOM-8) "W !?14 S PSLC=PSLC+1" W PSDIS,"-",PSCNT,"% (",$S($P(I1,"^",3):"SC",1:"NSC"),"), "
"RTN","PSODEM",20,0)
 .I $E(IOST)="C",$Y+4>IOSL,$D(PSTYPE) K DIR S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR K DIR,DTOUT W @IOF,?13
"RTN","PSODEM",21,0)
 X "N X S X=""GMRADPT"" X ^%ZOSF(""TEST"") Q" I $T D:'$D(PSOPTPST) GMRA
"RTN","PSODEM",22,0)
Q K SC,I1,VAROOT,Y,AL,I,X,Y,PSCNT,PSLC,PSDIS D:$G(PSTYPE)']"" KVA^VADPT Q
"RTN","PSODEM",23,0)
GMRA K ^TMP($J,"AL") S GMRA="0^0^111" D ^GMRADPT I GMRAL D
"RTN","PSODEM",24,0)
 .F DR=0:0 S DR=$O(GMRAL(DR)) Q:'DR  S ^TMP($J,"AL",$S('$P(GMRAL(DR),"^",5):1,1:2),$P(GMRAL(DR),"^",7),$P(GMRAL(DR),"^",2))=""
"RTN","PSODEM",25,0)
 .W !!,"ALLERGIES: " S (DR,TY)="" F I=0:0 S TY=$O(^TMP($J,"AL",1,TY)) Q:TY=""  F D=0:0 S DR=$O(^TMP($J,"AL",1,TY,DR)) Q:DR=""  W:$X+$L(DR)+$L(", ")>IOM !?11 W DR_", " D
"RTN","PSODEM",26,0)
 ..I $E(IOST)="C",$Y+4>IOSL,$D(PSTYPE) W ! K DIR S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR K DIR,DTOUT W @IOF,?18
"RTN","PSODEM",27,0)
 .W !!,"ADVERSE REACTIONS: " S (DR,TY)="" F I=0:0 S TY=$O(^TMP($J,"AL",2,TY)) Q:TY=""  F D=0:0 S DR=$O(^TMP($J,"AL",2,TY,DR)) Q:DR=""  W:$X+$L(DR)+$L(", ")>IOM !?19 W DR_", " D
"RTN","PSODEM",28,0)
 ..I $E(IOST)="C",$Y+4>IOSL,$D(PSTYPE) W ! K DIR S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR K DIR,DTOUT W @IOF,?18
"RTN","PSODEM",29,0)
 I $G(GMRAL)']"" F AD="ALLERGIES:","ADVERSE REACTIONS:" W !!,AD I $G(PSOFROM)="" F ADL=1:1:IOM-($L(AD)+5) W "_"
"RTN","PSODEM",30,0)
 I GMRAL=0 W !!,"ALLERGIES: NKA",!!,"ADVERSE REACTIONS:"
"RTN","PSODEM",31,0)
 W ! K TY,D,I,GMRA,GMRAL,DR,AD,ADL,^TMP($J,"AL") Q
"RTN","PSOLBL")
0^52^B63221606^B64018530
"RTN","PSOLBL",1,0)
PSOLBL ;BIR/SAB/RTR-BOTTLE LABEL ; 11/20/08 12:14pm
"RTN","PSOLBL",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**8,19,30,36,47,71,92,120,157,244,206,225,303,266,326**;DEC 1997;Build 11
"RTN","PSOLBL",3,0)
 ;DBIAs PSDRUG-221, PS(55-2228, IBARX-125, PSXSRP-2201, %ZIS-3435, DPT-3097
"RTN","PSOLBL",4,0)
 ;
"RTN","PSOLBL",5,0)
 ;*244 rem test for part fill when testing status > 11
"RTN","PSOLBL",6,0)
 ;
"RTN","PSOLBL",7,0)
DQ I $D(PSOIOS),PSOIOS]"" D DEVBAR^PSOBMST
"RTN","PSOLBL",8,0)
 I $G(PSOBAR0)]"",$G(PSOBAR1)]"",$D(^PS(59,PSOSITE,1)) S PSOBARS=1
"RTN","PSOLBL",9,0)
DQ1 D ^PSOLBL4
"RTN","PSOLBL",10,0)
 I $G(IOST(0)),$D(^%ZIS(2,IOST(0),55,"B","LL")) G ^PSOLLLI
"RTN","PSOLBL",11,0)
 G:'$D(PPL) HLEX G:($P($G(PSOPAR),"^",30)=2)&('$G(PSOEXREP)) HLEX K RXFLX S PSOCKHN=","_$G(PPL) S PSRESOLV=+PPL D CHECK F PI=1:1  D  S RX=$P(PPL,",",PI) D C Q:$G(PSOLAPPL)  D:$G(PSDFNFLG) TRAIL^PSOLBL2 K RXP,REPRINT
"RTN","PSOLBL",12,0)
 .S (PSDFNFLG,PSOLAPPL)=0 S NEXTRX=$P(PPL,",",(PI+1)) I NEXTRX=""!(NEXTRX=",") S PSOLAPPL=1 Q
"RTN","PSOLBL",13,0)
 .I PSOPDFN'=$P(^PSRX(NEXTRX,0),"^",2) S PSDFNFLG=1,PSOPDFN=$P(^PSRX(NEXTRX,0),"^",2) Q
"RTN","PSOLBL",14,0)
 I $P(^PS(59,PSOSITE,1),"^",28) D ^PSOLBLN2
"RTN","PSOLBL",15,0)
 D:'$P(^PS(59,PSOSITE,1),"^",28) ^PSOLBLS
"RTN","PSOLBL",16,0)
DQ5 I $D(^TMP($J,"PSOCP",DFN)),'$P(^PS(59,PSOSITE,1),"^",28) D INV^PSOCPE
"RTN","PSOLBL",17,0)
HLEX K RXPI,PSORX,RXP,PSOIOS,PSOLAPPL,XXX,COPAYVAR,TECH,PHYS,MFG,NURSE,STATE,SIDE,COPIES,EXDT,ISD,PSOINST,RXN,RXY,VADT,DEA,WARN,FDT,QTY,PATST,PDA,PS,PS1,PS2,PSL,PSNP,INRX,RR,XTYPE,SSNP,SSNPN,PNM,ADDR,PSODBQ,PSOLASTF,PSRESOLV,PSOEXREP,PSOSXQ
"RTN","PSOLBL",18,0)
 K ^TMP($J,"PSOCP",+$G(PSOCPN)),PSOCPN,PSOLBLDR,PSOLBLPS,PSOLBLCP,RXPR,RXRP,RXRS,PSOCKHN,RXFLX,PSOLAPPL,PSOPDFN,PSDFNFLG,PSOZERO,NEXTRX,PSOBLALL,STA S:'$G(PSOSUREP)&('$G(PSOSUSPR)) ZTREQ="@" Q
"RTN","PSOLBL",19,0)
C I $G(IOST(0)),$D(^%ZIS(2,IOST(0),55,"B","LL")) G C^PSOLLLI
"RTN","PSOLBL",20,0)
 U IO S X=$S('$P(^PS(59,PSOSITE,1),"^",28):132,1:158) X ^%ZOSF("RM") Q:'$D(^PSRX(RX,0))
"RTN","PSOLBL",21,0)
 S:$G(PSOBLALL) PSOBLRX=RX
"RTN","PSOLBL",22,0)
 S:$D(RXRP(RX)) REPRINT=1 S:$D(RXPR(RX)) RXP=RXPR(RX)
"RTN","PSOLBL",23,0)
 I $G(PSOSUREP)!($G(PSOEXREP)) S REPRINT=1 S:'$G(RXRP(RX)) RXRP(RX)=1
"RTN","PSOLBL",24,0)
 S RXY=^PSRX(RX,0),RXSTA=$P(^PSRX(RX,"STA"),"^") I RXSTA>11 D AL("QT") K RXY,RXP,REPRINT Q         ;*244
"RTN","PSOLBL",25,0)
 I RXSTA=3 D AL("QT") K RXY,RXP,REPRINT Q
"RTN","PSOLBL",26,0)
 I $G(RXPR(RX)),'$D(^PSRX(RX,"P",RXP,0)) K RXY,RXP,REPRINT Q
"RTN","PSOLBL",27,0)
 I $P($G(RXFL(RX)),"^"),'$D(^PSRX(RX,1,$P($G(RXFL(RX)),"^"),0)) K RXY,RXP,REPRINT Q
"RTN","PSOLBL",28,0)
 I $G(PSODBQ)!($G(RXRS(RX))) S RR=$O(^PS(52.5,"B",RX,0)) Q:'RR  I $G(^PS(52.5,RR,"P"))=1 K RXY,RXP,REPRINT Q
"RTN","PSOLBL",29,0)
 I $G(RXRS(RX))!($G(PSOPULL)) S PSOSXQ=0 N DR,DA,DIE D  I $G(PSOSXQ) K RXY,RXP,REPRINT Q
"RTN","PSOLBL",30,0)
 .S DA=$O(^PS(52.5,"B",RX,0)) Q:'DA  S A=$P($G(^PS(52.5,DA,0)),"^",7) Q:A=""
"RTN","PSOLBL",31,0)
 .I A="Q" S DIE="^PS(52.5,",DR="3////P" D ^DIE Q
"RTN","PSOLBL",32,0)
 .K RXRS(RX) S PSOSXQ=1
"RTN","PSOLBL",33,0)
 I $G(PSRESOLV)=RX D ENLBL^PSOBSET K PSRESOLV
"RTN","PSOLBL",34,0)
 I RXSTA'=4 D:$G(PSOSUSPR) AREC^PSOSUTL D:$G(PSOPULL)!($G(RXRS(RX))) AREC1^PSOSUTL D:$G(PSOSUREP) AREC^PSOSUSRP D:$G(PSXREP) AREC^PSXSRP
"RTN","PSOLBL",35,0)
 K ^UTILITY("DIQ1",$J) S DA=$P($$SITE^VASITE(),"^") I $G(DA) S DIC=4,DIQ(0)="I",DR="99" D EN^DIQ1 S PSOINST=$G(^UTILITY("DIQ1",$J,4,DA,99,"I")) K ^UTILITY("DIQ1",$J),DA,DR,DIC
"RTN","PSOLBL",36,0)
 S RXN=$P(RXY,"^"),ISD=$P(RXY,"^",13),RXF=0,DFN=+$P(RXY,"^",2),SIG=$P($G(^PSRX(RX,"SIG")),"^"),ISD=$E(ISD,4,5)_"/"_$E(ISD,6,7)_"/"_($E(ISD,1,3)+1700),ZY=0,$P(LINE,"_",28)="_"
"RTN","PSOLBL",37,0)
 S PSOLBLPS=+$P(RXY,"^",3),PSOLBLDR=+$P(RXY,"^",6)
"RTN","PSOLBL",38,0)
 S NURSE=$S($P($G(^DPT(DFN,"NHC")),"^")="Y":1,$P($G(^PS(55,DFN,40)),"^"):1,1:0) S FDT=$P(^PSRX(RX,2),"^",2),PS=$S($D(^PS(59,PSOSITE,0)):^(0),1:""),PS1=$S($D(^(1)):^(1),1:""),PSOSITE7=$P(^("IB"),"^")
"RTN","PSOLBL",39,0)
 S PS2=$P(PS,"^")_"^"_$P(PS,"^",6)
"RTN","PSOLBL",40,0)
 S (EXPDT,EXDT)=$P(^PSRX(RX,2),"^",6),EXDT=$S('EXDT:"",1:$E(EXDT,4,5)_"/"_$E(EXDT,6,7)_"/"_($E(EXDT,1,3)+1700))
"RTN","PSOLBL",41,0)
 S COPIES=$S($P($G(RXRP(RX)),"^",2):$P($G(RXRP(RX)),"^",2),$P(RXY,"^",18)]"":$P(RXY,"^",18),1:1)
"RTN","PSOLBL",42,0)
 K PSOCKHNX S PSOCKHL=$L(RX),PSOCKHN=$E($G(PSOCKHN),(PSOCKHL+2),999) D  K PSOCKHNX,PSOCKHL,PSOCKHA
"RTN","PSOLBL",43,0)
 .S PSOCKHA=","_RX_","
"RTN","PSOLBL",44,0)
 .I PSOCKHN'[PSOCKHA Q
"RTN","PSOLBL",45,0)
 .S PSOCKHA=$E(PSOCKHA,1,($L(PSOCKHA)-1))
"RTN","PSOLBL",46,0)
 .S PSOCKHNX=$L(PSOCKHN,PSOCKHA)-1
"RTN","PSOLBL",47,0)
 .I +$G(PSOCKHNX)>0 D DOUB
"RTN","PSOLBL",48,0)
 I $O(^PSRX(RX,1,0)),$G(RXFL(RX))'=0 S $P(^PSRX(RX,3),"^",6)="" K ^PSRX(RX,"DAI"),^PSRX(RX,"DRI")
"RTN","PSOLBL",49,0)
 I '$G(RXP),'$O(^PSRX(RX,1,0)) S RXFL(RX)=0
"RTN","PSOLBL",50,0)
 I '$G(RXP) D OSET I '$O(^PSRX(RX,1,0))!($G(RXFL(RX))=0) G ORIG
"RTN","PSOLBL",51,0)
 I $O(^PSRX(RX,1,0)),'$G(RXP),'$G(RXFL(RX)) S XTYPE=1 D REF G STA
"RTN","PSOLBL",52,0)
 I $O(^PSRX(RX,1,0)),'$G(RXP),$G(RXFL(RX)) G STA
"RTN","PSOLBL",53,0)
 I $G(RXP) S XTYPE="P" D REF G STA
"RTN","PSOLBL",54,0)
ORIG S TECH=$P($G(^VA(200,+$P(^PSRX(RX,0),"^",16),0)),"^"),QTY=$P(^PSRX(RX,0),"^",7),PHYS=$S($D(^VA(200,+$P(^PSRX(RX,0),"^",4),0)):$P(^(0),"^"),1:"UKN") D 6^VADPT,PID^VADPT S SSNPN=""
"RTN","PSOLBL",55,0)
 S DAYS=$P(^PSRX(RX,0),"^",8),MFG="________",LOT="________"
"RTN","PSOLBL",56,0)
STA S STATE=$S($D(^DIC(5,+$P(PS,"^",8),0)):$P(^(0),"^",2),1:"UKN")
"RTN","PSOLBL",57,0)
 S DRUG=$$ZZ^PSOSUTL(RX),DEA=$P($G(^PSDRUG(+$P(RXY,"^",6),0)),"^",3),WARN=$P($G(^(0)),"^",8)
"RTN","PSOLBL",58,0)
 S SIDE=$S($P($G(RXRP(RX)),"^",3):1,1:0)
"RTN","PSOLBL",59,0)
 I $G(^PSRX(RX,"P",+$G(RXP),0))]"" S RXPI=RXP D
"RTN","PSOLBL",60,0)
 .S RXP=^PSRX(RX,"P",RXP,0)
"RTN","PSOLBL",61,0)
 .S RXY=$P(RXP,"^")_"^"_$P(RXY,"^",2,6)_"^"_$P(RXP,"^",4)_"^"_$P(RXP,"^",10)_"^"_$P(RXY,"^",9)_"^"_$P($G(^PSRX(RX,"SIG")),"^",2)_"^"_$P(RXP,"^",2)_"^"_$P(RXY,"^",12,14)_"^"_$P(^PSRX(RX,"STA"),"^")_"^"_$P(RXP,"^",7)_"^"_$P(RXY,"^",17,99)
"RTN","PSOLBL",62,0)
 .S FDT=$P(RXP,"^")
"RTN","PSOLBL",63,0)
 S MW=$P(RXY,"^",11) I $G(RXFL(RX))'=0 D:$G(RXFL(RX))  I '$G(RXFL(RX)) F I=0:0 S I=$O(^PSRX(RX,1,I)) Q:'I  S RXF=RXF+1 S:'$G(RXP) MW=$P(^PSRX(RX,1,I,0),"^",2) I +^PSRX(RX,1,I,0)'<FDT S FDT=+^(0)
"RTN","PSOLBL",64,0)
 .I $G(RXFL(RX)),'$D(^PSRX(RX,1,RXFL(RX),0)) K RXFL(RX) Q
"RTN","PSOLBL",65,0)
 .;PSO*7*266
"RTN","PSOLBL",66,0)
 .S RXF=RXFL(RX) S:'$G(RXP) MW=$P($G(^PSRX(RX,1,RXF,0)),"^",2) F I=0:0 S I=$O(^PSRX(RX,1,I)) Q:'I  I +^PSRX(RX,1,I,0)'<FDT S FDT=+^(0)
"RTN","PSOLBL",67,0)
 I MW="W" S PSMP=$G(^PSRX(RX,"MP")) I PSMP]"" D
"RTN","PSOLBL",68,0)
 .S PSJ=0 F PSI=1:1:$L(PSMP) S PSMP(PSI)="",PSJ=PSJ+1 F PSJ=PSJ:1 S PSMP(PSI)=PSMP(PSI)_$P(PSMP," ",PSJ)_" " Q:($L(PSMP(PSI))+$L($P(PSMP," ",PSJ+1))>30)
"RTN","PSOLBL",69,0)
 .K PSMP(PSI)
"RTN","PSOLBL",70,0)
 S X=$S($D(^PS(55,DFN,0)):^(0),1:""),PSCAP=$P(X,"^",2),PS55=$P($G(X),"^",3),PS55X=$P($G(X),"^",5)
"RTN","PSOLBL",71,0)
 I (($G(PS55X)]"")&(PS55>1)&(PS55X<DT)) S PS55=0
"RTN","PSOLBL",72,0)
 S:MW="M" MW=$S((PS55=1!(PS55=4)):"R",1:MW)
"RTN","PSOLBL",73,0)
 S MW=$S(MW="M":"REGULAR",MW="R":"CERTIFIED",1:"WINDOW")
"RTN","PSOLBL",74,0)
 I ($G(PSMP(1))']""&($G(PS55)=2)) S PSMP(1)=$G(SSNPN)
"RTN","PSOLBL",75,0)
 S DATE=$E(FDT,1,7),REF=$P(RXY,"^",9)-RXF S:'$G(RXP) $P(^PSRX(RX,3),"^")=FDT S:REF<1 REF=0 D ^PSOLBL2 S II=RX D ^PSORFL,RFLDT^PSORFL
"RTN","PSOLBL",76,0)
 S PATST=$G(^PS(53,+$P(RXY,"^",3),0)) S PRTFL=1 I REF=0 S:('$P(PATST,"^",5))!(DEA["W")!(DEA[1)!(DEA[2) PRTFL=0
"RTN","PSOLBL",77,0)
 S VRPH=$P(^PSRX(RX,2),"^",10),PSCLN=+$P(RXY,"^",5),PSCLN=$S($D(^SC(PSCLN,0)):$P(^(0),"^",2),1:"UNKNOWN")
"RTN","PSOLBL",78,0)
 S PATST=$P(PATST,"^",2),X1=DT,X2=$P(RXY,"^",8)-10 D C^%DTC:REF I $D(^PSRX(RX,2)),$P(^(2),"^",6),REF,X'<$P(^(2),"^",6) S REF=0,VRPH=$P(^(2),"^",10)
"RTN","PSOLBL",79,0)
 I $G(PSOCHAMP),$G(PSOTRAMT) S COPAYVAR="CHAMPUS" G LBL
"RTN","PSOLBL",80,0)
 I $G(RXP) S COPAYVAR="" G LBL
"RTN","PSOLBL",81,0)
 I $P($G(^PS(53,+$G(PSOLBLPS),0)),"^",7) D SNO G LBL
"RTN","PSOLBL",82,0)
 I $P($G(^PSDRUG(+$G(PSOLBLDR),0)),"^",3)["I"!($P($G(^(0)),"^",3)["S")!($P($G(^(0)),"^",3)["N") D SNO G LBL
"RTN","PSOLBL",83,0)
 I $P(^PSRX(RX,"STA"),"^")>0,$P(^("STA"),"^")'=2,'$G(PSODBQ) D SNO G LBL
"RTN","PSOLBL",84,0)
 I $G(PSOLBLCP)="" D IBCP
"RTN","PSOLBL",85,0)
 N PSOQI S PSOQI=$G(^PSRX(RX,"IBQ")) I $G(PSOLBLCP)=0 D SNO G LBL
"RTN","PSOLBL",86,0)
 I $G(PSOLBLCP)=1 I $P(PSOQI,"^",2)!($P(PSOQI,"^",3))!($P(PSOQI,"^",4))!($P(PSOQI,"^",5))!($P(PSOQI,"^",6))!($P(PSOQI,"^",7))!($P(PSOQI,"^",8)) D SNO G LBL
"RTN","PSOLBL",87,0)
 I $G(PSOLBLCP)=2 I $P(PSOQI,"^")!($P(PSOQI,"^",2))!($P(PSOQI,"^",3))!($P(PSOQI,"^",4))!($P(PSOQI,"^",5))!($P(PSOQI,"^",6))!($P(PSOQI,"^",7))!($P(PSOQI,"^",8)) D SNO G LBL
"RTN","PSOLBL",88,0)
 I $G(PSOLBLCP)=2,'$P($G(^PSRX(RX,"IB")),"^") D SNO G LBL
"RTN","PSOLBL",89,0)
 S PSOCPN=$P(^PSRX(RX,0),"^",2),INRX=$P(^(0),"^") I $G(^TMP($J,"PSOCP",PSOCPN))="" S ^(PSOCPN)=PSOCPN
"RTN","PSOLBL",90,0)
 S ^TMP($J,"PSOCP",PSOCPN,INRX)=INRX_"^"_$$ZZ^PSOSUTL(RX)_"^"_+$G(DAYS) S COPAYVAR="COPAY" K ZDRUG
"RTN","PSOLBL",91,0)
LBL G ^PSOLBLD:$P(^PSRX(RX,"STA"),"^")=4 D ^PSOLBLD:$D(^PSRX(RX,"DRI"))&('$G(RXF))&('$G(RXP)) D:$P($G(^PSRX(RX,3)),"^",6)&('$G(RXF))&('$G(RXP)) ^PSOLBLD1 G ^PSOLBL1:'$P(^PS(59,PSOSITE,1),"^",28)
"RTN","PSOLBL",92,0)
 G ^PSOLBLN
"RTN","PSOLBL",93,0)
REF F XXX=0:0 S XXX=$O(^PSRX(RX,XTYPE,XXX)) Q:+XXX'>0  D
"RTN","PSOLBL",94,0)
 .S TECH=$S($D(^VA(200,+$P(^PSRX(RX,XTYPE,XXX,0),"^",7),0)):$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSOLBL",95,0)
 .S QTY=$P(^PSRX(RX,XTYPE,XXX,0),"^",4),PHYS=$S($D(^VA(200,+$P(^PSRX(RX,XTYPE,XXX,0),"^",17),0)):$P(^(0),"^"),$D(^VA(200,+$P(^PSRX(RX,0),"^",4),0)):$P(^(0),"^"),1:"UNKNOWN") D 6^VADPT,PID^VADPT S SSNPN=""
"RTN","PSOLBL",96,0)
 .S DAYS=$P(^PSRX(RX,XTYPE,XXX,0),"^",10),LOT="________",MFG="________"
"RTN","PSOLBL",97,0)
 Q
"RTN","PSOLBL",98,0)
CHECK S PSDFNFLG=0,PSOZERO=$P(PPL,","),PSOPDFN=$P(^PSRX(PSOZERO,0),"^",2)
"RTN","PSOLBL",99,0)
 Q
"RTN","PSOLBL",100,0)
OSET D OSET^PSOLBL1
"RTN","PSOLBL",101,0)
 Q
"RTN","PSOLBL",102,0)
DOUB Q:'$D(RXFL(RX))  I +$G(RXFL(RX))-PSOCKHNX<0 Q
"RTN","PSOLBL",103,0)
 S RXFLX(RX)=$G(RXFL(RX)),RXFL(RX)=$G(RXFL(RX))-PSOCKHNX
"RTN","PSOLBL",104,0)
 Q
"RTN","PSOLBL",105,0)
AL(T) N I,IR,RF,USR,TY,DES S USR=""
"RTN","PSOLBL",106,0)
 I T="UT" D
"RTN","PSOLBL",107,0)
 .N J,RX S USR=$G(DUZ),TY="B",DES="Label never queued to print by User"
"RTN","PSOLBL",108,0)
 .F J=1:1  S RX=+$P(PPL,",",J) Q:'RX  D AL1
"RTN","PSOLBL",109,0)
 I T="QT" D
"RTN","PSOLBL",110,0)
 .S I=+$P(^PSRX(RX,"STA"),"^"),TY=$S((I=3)!(I=16):"H",I=13:"D",1:"C")
"RTN","PSOLBL",111,0)
 .S DES=I_" "_$S((I=3)!(I=16):"HOLD"_$S(I=16:"(PROVIDER)",1:""),(I=12)!(I=14)!(I=15):"DISCONTINUED"_$S(I=14:"(PROVIDER)",I=15:"(EDIT)",1:""),I=13:"DELETED",1:"")
"RTN","PSOLBL",112,0)
 .S DES="Queued label terminated - "_DES D AL1
"RTN","PSOLBL",113,0)
 K %,%H,%I Q
"RTN","PSOLBL",114,0)
AL1 S (IR,I,RF)=0 F  S I=$O(^PSRX(RX,1,I)) Q:'I  S RF=I S:I>5 RF=I+1
"RTN","PSOLBL",115,0)
 S I=0 F  S I=$O(^PSRX(RX,"A",I)) Q:'I  S IR=I
"RTN","PSOLBL",116,0)
 S IR=IR+1,^PSRX(RX,"A",0)="^52.3DA^"_IR_"^"_IR
"RTN","PSOLBL",117,0)
 D NOW^%DTC S ^PSRX(RX,"A",IR,0)=%_"^"_TY_"^"_USR_"^"_$S($G(RXPR(RX)):6,1:RF)_"^"_DES
"RTN","PSOLBL",118,0)
 Q
"RTN","PSOLBL",119,0)
IBCP N X,Y,PSOJJ,PSOLL
"RTN","PSOLBL",120,0)
 S PSOLBLCP="",X=$P($G(^PS(59,+$G(PSOSITE),"IB")),"^")_"^"_$G(DFN) D XTYPE^IBARX
"RTN","PSOLBL",121,0)
 S PSOJJ="" F  S PSOJJ=$O(Y(PSOJJ)) Q:'PSOJJ  S PSOLL="" F  S PSOLL=$O(Y(PSOJJ,PSOLL)) Q:PSOLL=""  S:PSOLL>0 PSOLBLCP=PSOLL
"RTN","PSOLBL",122,0)
 I '$G(PSOLBLCP) S PSOLBLCP=0
"RTN","PSOLBL",123,0)
 Q
"RTN","PSOLBL",124,0)
SNO S COPAYVAR="NO COPAY" Q
"RTN","PSOLBL1")
0^56^B28929017^B29469598
"RTN","PSOLBL1",1,0)
PSOLBL1 ;BHAM ISC/SAB - PRINTS LABEL ;1/20/93 14:25
"RTN","PSOLBL1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**107,110,225,326**;DEC 1997;Build 11
"RTN","PSOLBL1",3,0)
START S COPIES=COPIES-1
"RTN","PSOLBL1",4,0)
 W $C(13) S $X=0 W "VA (119)",?10,$E(DT,4,5),"/",$E(DT,6,7),"/",$E(DT,2,3) W:('SIDE)&(PRTFL) ?40,"PLEASE REFER ONLY TO '",$S(REF:"1. REFILL REQUEST",1:"2. RENEWAL ORDER"),"'" W:+$G(RXP) ?100,"(PARTIAL)" W:$D(REPRINT) ?110,"(REPRINT)"
"RTN","PSOLBL1",5,0)
 W !,$P(PS,"^",2) W:('SIDE)&(PRTFL) ?40,"INSTRUCTION ON REVERSE SIDE OF THIS FORM" W:'SIDE ?102,"(Filled at ",$P(PS2,"^",2),")"
"RTN","PSOLBL1",6,0)
 W !,$P(PS,"^",7),", ",STATE,"  ",$P(PS,"^",5) W:'SIDE ?83,"*** ",$P(PS2,"^")," ***"
"RTN","PSOLBL1",7,0)
 W !,?22,$S(MW["C":"CERTIFIED MAIL",1:"") W:'SIDE ?38,SSNP,?69,"RX: ",RXN
"RTN","PSOLBL1",8,0)
 W !,?2,PNM W:'SIDE ?38,PNM,?64,"EXPIRES: ",EXDT W:('SIDE)&(PRTFL) ?83,"INDICATE ANY ADDRESS CHANGES"
"RTN","PSOLBL1",9,0)
 W !,?2,$S($D(PSMP(1)):PSMP(1),1:VAPA(1)) W:'SIDE ?38,$E(VAPA(1),1,25),?64,"REFILLS: ",REF ;W:('SIDE)&(PRTFL) ?83,LINE 
"RTN","PSOLBL1",10,0)
 W:('SIDE)&(PRTFL) ?83,"_____PERM.   _____TEMP." W:'PRTFL ?83,"* A 'NEW' RX IS REQUIRED.        *"
"RTN","PSOLBL1",11,0)
 S ADDR(3)=VAPA(4)_", "_$P($G(^DIC(5,+$P(VAPA(5),"^"),0)),"^",2)_"  "_VAPA(6),ADDR(2)="" S:VAPA(2)]"" ADDR(2)=VAPA(2)_" "_VAPA(3)
"RTN","PSOLBL1",12,0)
 I ADDR(2)="" S ADDR(2)=ADDR(3),ADDR(3)=""
"RTN","PSOLBL1",13,0)
 S ADDR(5)=$E(VAPA(4),1,13)_", "_$P($G(^DIC(5,+$P(VAPA(5),"^"),0)),"^",2)_"  "_VAPA(6)
"RTN","PSOLBL1",14,0)
 W !,?2,$S($D(PSMP(2)):PSMP(2),$D(PSMP(1)):"",1:$E(ADDR(2),1,35)) W:'SIDE ?38,$S($G(ADDR(3))="":ADDR(5),1:$E(ADDR(2),1,24)),?62,$S(RFLMSG]"":"*",1:" "),"LST FILL: "
"RTN","PSOLBL1",15,0)
 W:'SIDE $G(PSOLASTF)
"RTN","PSOLBL1",16,0)
 I 'SIDE W:PRTFL ?83,"ADDRESS: ",$E(LINE,1,23) W:'PRTFL ?83,"********** PLEASE NOTE ***********"
"RTN","PSOLBL1",17,0)
 W !,?2,$S($D(PSMP(3)):PSMP(3),$D(PSMP(1)):"",1:ADDR(3)) I 'SIDE W ?38,$S(ADDR(3)'="":ADDR(5),1:""),?64,"ROUTING: ",$S(MW="REGULAR":"MAIL",1:MW) W:PRTFL ?83,"CITY/STATE/ZIP: ",$E(LINE,1,16) W:'PRTFL ?83,"* THIS RX CAN NOT BE 'RENEWED'.  *"
"RTN","PSOLBL1",18,0)
 ;NEW LABEL WHITE SPACE
"RTN","PSOLBL1",19,0)
 I +$G(PSOBARS),'SIDE,$P(PSOPAR,"^",19)'=1 S X="S",X2=PSOINST_"-"_RX W !,?40 S X1=$X W @PSOBAR1,X2,@PSOBAR0,$C(13),!,$S($G(PS55)=2:"***DO NOT MAIL***",1:"**CRITICAL MEDICAL SHIPMENT**"),!
"RTN","PSOLBL1",20,0)
 E  F NLWS=1:1:6 W ! W:NLWS=5 $S($G(PS55)=2:"***DO NOT MAIL***",1:"**CRITICAL MEDICAL SHIPMENT**")
"RTN","PSOLBL1",21,0)
 W !,?8,"VA Medical Center" I 'SIDE W ?38,INT(1)
"RTN","PSOLBL1",22,0)
 W !,$P(PS,"^"),"  ",$P(PS,"^",3),"-",$P(PS,"^",4) W:'SIDE ?38,INT(2) I 'SIDE W:PRTFL ?83 W:'PRTFL ?83,"* PLEASE CONTACT YOUR PHYSICIAN. *"
"RTN","PSOLBL1",23,0)
 W !,?4,RXN,?15,$E(DATE,4,5),"/",$E(DATE,6,7),"/",$E(DATE,2,3),"   (",RXF+1," OF ",1+$P(RXY,"^",9),")" I 'SIDE W ?38,INT(3) W:(PRTFL)&('REF) ?83,"***** FOR PHYSICIAN USE ONLY *****" W:'PRTFL ?83,"**********************************"
"RTN","PSOLBL1",24,0)
 W !,PNM,?29,"#",$P(RXY,"^",7)
"RTN","PSOLBL1",25,0)
 W:'SIDE ?38,"CAP: ",$S(PSCAP:"**NON-SFTY**",1:"SAFETY")," WARN:",WARN,?68,$E(DATE,4,5),"/",$E(DATE,6,7),"/",$E(DATE,2,3)," " S I1=$P($H,",",2)\60 W:'SIDE I1\60,":",(I1#60\10)_(I1#10) W:('SIDE)&(PRTFL) ?83,"SIGNATURE : ",$E(LINE,1,20)
"RTN","PSOLBL1",26,0)
SIG F DR=1:1:$S(SGC<5:4,1:6) D SIG1
"RTN","PSOLBL1",27,0)
 I SGC>4 F I=1:1:22 W ! I I>22-SGC S DR=DR+1,X=$S($D(SGY(DR)):SGY(DR),1:"") W X W:'SIDE ?38,X
"RTN","PSOLBL1",28,0)
 ;I SGC>4 F I=1:1:$S($P($G(PSOPAR),"^",10):22,1:16) W ! I I>($S($P($G(PSOPAR),"^",10):28,1:22)-SGC) S DR=DR+1,X=$S($D(SGY(DR)):SGY(DR),1:"") W X W:'SIDE ?38,X
"RTN","PSOLBL1",29,0)
 W !?3,$E(PHYS,1,14),?25,"(",$P(RXY,"^",16),"/",$S($D(VRPH):VRPH,1:" "),")" W:'SIDE ?38,DRUG,?38+$L(DRUG)," (QTY:",$P(RXY,"^",7)," DAYS:",$P(RXY,"^",8)," FILL: ",RXF+1," OF ",1+$P(RXY,"^",9)," ISD:",ISD,")"
"RTN","PSOLBL1",30,0)
 W !,DRUG W:'SIDE ?38,PHYS,?62,RFLMSG,?100,PATST,"  ",PSCLN
"RTN","PSOLBL1",31,0)
 I $D(PSOBARS),PSOBARS W $C(13),# S $X=0
"RTN","PSOLBL1",32,0)
 E  W !
"RTN","PSOLBL1",33,0)
 I COPIES>0 S SIDE=1 G START
"RTN","PSOLBL1",34,0)
 ;STORE LABEL PRINT NODE
"RTN","PSOLBL1",35,0)
 D NOW^%DTC S NOW=% K %,%H,%I S RXF=0 F I=0:0 S I=$O(^PSRX(RX,1,I)) Q:'I  S RXF=I
"RTN","PSOLBL1",36,0)
 S IR=0 F FDA=0:0 S FDA=$O(^PSRX(RX,"L",FDA)) Q:'FDA  S IR=FDA
"RTN","PSOLBL1",37,0)
 S IR=IR+1,^PSRX(RX,"L",0)="^52.032DA^"_IR_"^"_IR
"RTN","PSOLBL1",38,0)
 S ^PSRX(RX,"L",IR,0)=NOW_"^"_$S($G(RXP):99-RXPI,1:RXF)_"^"_$S($G(PCOMX)]"":$G(PCOMX),1:"From RX number "_$P(^PSRX(RX,0),"^"))_$S($G(RXP):" (Partial)",1:"")_$S($D(REPRINT):" (Reprint)",1:"")_"^"_PDUZ
"RTN","PSOLBL1",39,0)
 S ^PSRX(RX,"TYPE")=0 K RXF,IR,FDA,NOW,I
"RTN","PSOLBL1",40,0)
 I '$D(PSSPND),$P(PSOPAR,"^",18) D CHCK2^PSOTRLBL
"RTN","PSOLBL1",41,0)
END K PSCLN,%DT,ADDR,DATE,DEA,DR,DR1,DRX,DRUG,FDT,SGY,RXY,RXZ,RYY,RFLMSG,RFL,%H,COPIES,DOB,DRUG,LIM,LMI,LINE,PS,PS1,PS2,INT,ISD,I1,MW,MAIL,STATE,SIDE,SSNP,SS,ST,ST1,PATST,PRTFL,PHYS,PNM,S,SL,SGC,PSMP,PSI,PSJ,VRPH,REPRINT,PS55,PS55X Q
"RTN","PSOLBL1",42,0)
 Q
"RTN","PSOLBL1",43,0)
 ;
"RTN","PSOLBL1",44,0)
SIG1 S X=$S($D(SGY(DR)):SGY(DR),1:"") W !,X
"RTN","PSOLBL1",45,0)
 I 'SIDE W ?38,X I PRTFL W ?83 W:DR=1 ?83,$S('REF:"PRINT NAME: "_$E(LINE,1,25),1:"") W:DR=2 "DATE: ",$E(LINE,1,10) W:(DR=2)&('REF) " DEA# ",$E(LINE,1,6) W:(DR=3)&('REF) "Refills: 0 1 2 3 4 5 6 7 8 9 10 11"
"RTN","PSOLBL1",46,0)
 Q
"RTN","PSOLBL1",47,0)
 ;
"RTN","PSOLBL1",48,0)
OSET I $G(RXFL(RX))']""!($G(RXFL(RX))=0) D  Q
"RTN","PSOLBL1",49,0)
 .S TECH=$P($G(^VA(200,+$P(^PSRX(RX,0),"^",16),0)),"^"),QTY=$P(^PSRX(RX,0),"^",7),PHYS=$S($D(^VA(200,+$P(^PSRX(RX,0),"^",4),0)):$P(^(0),"^"),1:"UKN") D 6^VADPT,PID^VADPT S SSNPN=""
"RTN","PSOLBL1",50,0)
 .S DAYS=$P(^PSRX(RX,0),"^",8),MFG="________",LOT="________"
"RTN","PSOLBL1",51,0)
 I '$D(^PSRX(RX,1,RXFL(RX),0)) K RXFL(RX) Q
"RTN","PSOLBL1",52,0)
 S TECH=$S($D(^VA(200,+$P(^PSRX(RX,1,RXFL(RX),0),"^",7),0)):$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSOLBL1",53,0)
 S QTY=$P(^PSRX(RX,1,RXFL(RX),0),"^",4),PHYS=$S($D(^VA(200,+$P(^PSRX(RX,1,RXFL(RX),0),"^",17),0)):$P(^(0),"^"),$D(^VA(200,+$P(^PSRX(RX,0),"^",4),0)):$P(^(0),"^"),1:"UNKNOWN") D 6^VADPT,PID^VADPT S SSNPN=""
"RTN","PSOLBL1",54,0)
 S DAYS=$P(^PSRX(RX,1,RXFL(RX),0),"^",10),LOT="________",MFG="________"
"RTN","PSOLBL1",55,0)
 Q
"RTN","PSOLBL2")
0^53^B34647042^B34866671
"RTN","PSOLBL2",1,0)
PSOLBL2 ;BIR/SAB-LABEL OUTPUT CONT. ;11/18/92 19:15
"RTN","PSOLBL2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**16,19,30,71,92,117,135,326**;DEC 1997;Build 11
"RTN","PSOLBL2",3,0)
 ;External reference to ^PS(51 supported by DBIA 2224
"RTN","PSOLBL2",4,0)
 ;External reference to ^PS(54 supported by DBIA 2227
"RTN","PSOLBL2",5,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOLBL2",6,0)
 ;External reference to ^PS(55 supported by DBIA 2228
"RTN","PSOLBL2",7,0)
 ;External reference to ^DPT supported by DBIA 3097
"RTN","PSOLBL2",8,0)
 ;External reference to GMRADPT supported by DBIA 10099
"RTN","PSOLBL2",9,0)
 I $P($G(^PSRX(RX,"SIG")),"^",2) K SGY D ^PSOLBL3 G SIGOLD
"RTN","PSOLBL2",10,0)
 D SIG
"RTN","PSOLBL2",11,0)
QUIT K SIG,E,F,S Q
"RTN","PSOLBL2",12,0)
SIG K OT S SGY="" F P=1:1:$L(SIG," ") S X=$P(SIG," ",P) D:X]""
"RTN","PSOLBL2",13,0)
 .I $D(^PS(51,"A",X)) D
"RTN","PSOLBL2",14,0)
 ..I $P($G(^PS(55,DFN,"LAN")),"^") S OT=$O(^PS(51,"B",X,0)) I OT,$P($G(^PS(51,OT,4)),"^")]"" S X=$P(^PS(51,OT,4),"^") K OT Q
"RTN","PSOLBL2",15,0)
 ..S %=^PS(51,"A",X),X=$P(%,"^") I $P(%,"^",2)]"" S Y=$P(SIG," ",P-1),Y=$E(Y,$L(Y)) S:Y>1 X=$P(%,"^",2)
"RTN","PSOLBL2",16,0)
 .S SGY=SGY_X_" "
"RTN","PSOLBL2",17,0)
 S X="",SGC=1 F J=1:1 S Z=$P(SGY," ",J) S:Z="" SGY(SGC)=X Q:Z=""  S:$L(X)+$L(Z)'<$S($P(PSOPAR,"^",28):46,1:34) SGY(SGC)=X,SGC=SGC+1,X="" S X=X_Z_" "
"RTN","PSOLBL2",18,0)
SIGOLD I '$P(PSOPAR,"^",28) D  K NHC
"RTN","PSOLBL2",19,0)
 .K DIC,DR,DIQ,NHC S DIC=2,DA=DFN,DR=148,DIQ="NHC",DIQ(0)="I"
"RTN","PSOLBL2",20,0)
 .D EN^DIQ1 K DIC,DR,DIQ
"RTN","PSOLBL2",21,0)
 .I NHC(2,DFN,148,"I")="Y"!($P($G(^PS(55,DFN,40)),"^")) S SGC=SGC+1,SGY(SGC)="Expiration:________ Mfg:_________"
"RTN","PSOLBL2",22,0)
 ;
"RTN","PSOLBL2",23,0)
DPT S X=$S($D(^DPT(DFN,0))#2:^(0),1:""),DOB=$P(X,"^",3),L=$E(X,1)
"RTN","PSOLBL2",24,0)
 S Y=$P(X,"^",9),PNM=$P(X,"^") D PID^VADPT S SS="",SSNP=""
"RTN","PSOLBL2",25,0)
 I $P(PSOPAR,"^",28) K SIG,E,F,S Q
"RTN","PSOLBL2",26,0)
GMRA X "N X S X=""GMRADPT"" X ^%ZOSF(""TEST"") Q" I '$T S (INT(1),INT(2),INT(3))="" Q
"RTN","PSOLBL2",27,0)
 S GMRA="0^1^111" D ^GMRADPT S I1=1,INT(1)="ALLERGIES: ",(INT(2),INT(3))="" F I=0:0 S I=$O(GMRAL(I)) Q:I'>0  S AL=$P(GMRAL(I),U,2) S:$L(INT(I1))+$L(AL)>42 I1=I1+1,INT(I1)="" S INT(I1)=INT(I1)_AL_", "
"RTN","PSOLBL2",28,0)
 ;K GMRA,GMRAL Q
"RTN","PSOLBL2",29,0)
 Q
"RTN","PSOLBL2",30,0)
SIGPH S SIGPH=SIG,X="",SGCPH=1 F J=1:1:100 S Z=$P(SIGPH," ",J) S:Z="" SIGPH(SGCPH)=X S:$L(X)+$L(Z)'<34 SIGPH(SGCPH)=X,SGCPH=SGCPH+1,X="" S X=X_Z_" "
"RTN","PSOLBL2",31,0)
 Q
"RTN","PSOLBL2",32,0)
WARN W:'$G(PSOBLALL) @IOF W ?54,PNM,!,?54,"Rx# ",RXN,!,?54,DRUG,!,?54,"DRUG WARNING:" S DIWL=55,DIWR=100,DIWF="W" F WW=1:1 Q:$P(WARN,",",WW,99)=""  S PSOWARN=$P(WARN,",",WW) D:$D(^PS(54,PSOWARN,0))
"RTN","PSOLBL2",33,0)
 .K ^UTILITY($J,"W") F AA=0:0 S AA=$O(^PS(54,PSOWARN,1,AA)) Q:'AA  S X=^(AA,0) D ^DIWP D ^DIWW
"RTN","PSOLBL2",34,0)
 K WW,PSOWARN,AA W:$G(PSOBLALL) @IOF Q
"RTN","PSOLBL2",35,0)
REP ;LEFT SIDE ONLY REPRINT FOR NEW LABEL STOCK
"RTN","PSOLBL2",36,0)
 K PSOSTLK,ZTKDRUG I $L($T(PSOSTALK^PSOTALK1)) D PSOSTALK^PSOTALK1 S PSOSTLK=1 ; PRINT SCRIPTALK LABEL IF APPLICABLE
"RTN","PSOLBL2",37,0)
 S ZTKDRUG="XXXXXX   SCRIPTALK RX   XXXXXX"
"RTN","PSOLBL2",38,0)
 S Y=DATE X ^DD("DD") S DATE=Y S TECH="("_$S($P($G(^PSRX(+$G(RX),"OR1")),"^",5):$P($G(^PSRX(+$G(RX),"OR1")),"^",5),1:$P(RXY,"^",16))_"/"_$S($G(VRPH)&($P(PSOPAR,"^",32)):VRPH,1:" ")_")"
"RTN","PSOLBL2",39,0)
 S PSZIP=$P(PS,"^",5) S PSOHZIP=$S(PSZIP["-":PSZIP,1:$E(PSZIP,1,5)_$S($E(PSZIP,6,9)]"":"-"_$E(PSZIP,6,9),1:""))
"RTN","PSOLBL2",40,0)
 W "VAMC ",$P(PS,"^",7),", ",STATE,"  ",$G(PSOHZIP),?102,"(REPRINT)" W:$G(RXP) "(PARTIAL)" W !,$P(PS2,"^",2),"  ",$P(PS,"^",3),"-",$P(PS,"^",4),"   ",TECH
"RTN","PSOLBL2",41,0)
 W !,"Rx# ",RXN,"  ",DATE,"  Fill ",RXF+1," of ",1+$P(RXY,"^",9),!,PNM
"RTN","PSOLBL2",42,0)
 F DR=1:1 Q:$G(SGY(DR))=""  D:DR=4!(DR=7)!(DR=10)!(DR=13)  W !,$G(SGY(DR))
"RTN","PSOLBL2",43,0)
 .F GG=1:1:27 W !
"RTN","PSOLBL2",44,0)
 I DR>4 S KK=$S(DR=5!(DR=8)!(DR=11):2,(DR=6)!(DR=9)!(DR=12):1,1:0) I KK F HH=1:1:KK W !
"RTN","PSOLBL2",45,0)
 I DR=2 W !!
"RTN","PSOLBL2",46,0)
 I DR=3 W !
"RTN","PSOLBL2",47,0)
 W ! S PSDU=$P($G(^PSDRUG($P($G(^PSRX(RX,0)),"^",6),660)),"^",8) W $G(PHYS),!,"Qty: "_$G(QTY),"  ",$G(PSDU),$S($G(PSDU)="":"      ",1:" "),$S($G(NURSE):"Mfg______Exp______",1:"")
"RTN","PSOLBL2",48,0)
 I $G(PSOSTLK) W !,$S($G(PSOTALK)&('$G(PSOTREP)):ZTKDRUG,1:DRUG)
"RTN","PSOLBL2",49,0)
 I '$G(PSOSTLK) W !,DRUG
"RTN","PSOLBL2",50,0)
 K PSDU W !!,$P(PS,"^",2),!,$P(PS,"^",7),", ",STATE,"  ",$G(PSOHZIP),!!!!,"FORWARDING SERVICE REQUESTED",!
"RTN","PSOLBL2",51,0)
 I "C"[$E(MW) W ?21,"CERTIFIED MAIL",!
"RTN","PSOLBL2",52,0)
 E  W !
"RTN","PSOLBL2",53,0)
 W !,$S($G(PS55)=2:"***DO NOT MAIL***",1:"***CRITICAL MEDICAL SHIPMENT***")
"RTN","PSOLBL2",54,0)
 W !!!,PNM,!,$S($D(PSMP(1)):PSMP(1),1:VAPA(1)),!,$S($D(PSMP(2)):PSMP(2),$D(PSMP(1)):"",1:$G(ADDR(2))),!,$S($D(PSMP(3)):PSMP(3),$D(PSMP(1)):"",1:$G(ADDR(3))),!,$S($D(PSMP(4)):PSMP(4),$D(PSMP(1)):"",1:$G(ADDR(4)))
"RTN","PSOLBL2",55,0)
 W @IOF Q
"RTN","PSOLBL2",56,0)
MUL ;
"RTN","PSOLBL2",57,0)
 I $G(PSOBARS),$P($G(PSOPAR),"^",19) W:J=1 !!! W:J=2 !
"RTN","PSOLBL2",58,0)
 E  W:J=1 !!!!!!!!! W:J=2 !!!!!!!! W:J=3 !!!!!! W:J=4 !!!! W:J=5 !!
"RTN","PSOLBL2",59,0)
 W !,"Use the label above to mail the computer",!,"copies back to us. Apply enough postage",!,"to your envelope to ensure delivery."
"RTN","PSOLBL2",60,0)
 Q
"RTN","PSOLBL2",61,0)
MULT W !,"Use the label above to mail the computer",?54,"(",PSLN,")",!,"copies back to us. Apply enough postage",?60,"PATIENT'S SIGNATURE   "_$E(DT,4,5),"/",$E(DT,6,7),"/",($E(DT,1,3)+1700),!,"to your envelope to ensure delivery."
"RTN","PSOLBL2",62,0)
 Q
"RTN","PSOLBL2",63,0)
PRINT S (PSONOPR,PSOWSTOP,PSOASTOP)=0 F CCC=1:1 Q:$G(PSONOPR)  D
"RTN","PSOLBL2",64,0)
 .W ?54,$G(^TMP($J,"PSOWPT",CCC)) S:'$O(^(CCC)) PSOWSTOP=1
"RTN","PSOLBL2",65,0)
 .W ?102,$G(^TMP($J,"PSOAPT",CCC)),! S:'$O(^(CCC)) PSOASTOP=1
"RTN","PSOLBL2",66,0)
 .I PSOWSTOP,PSOASTOP S PSONOPR=1
"RTN","PSOLBL2",67,0)
 K ^TMP($J,"PSOWARN"),^TMP($J,"ALWA"),^TMP($J,"PSOWPT"),^TMP($J,"PSOAPT"),PSONKA,PSONULL,WWW,GMRA,GMRAL,PSOWARN,JJJ,WCNT,RRR,ALG,ALCNT,EEE,FFF,PSOLG,PSOLGA,PSORY,CCC,PSONOPR,PSOWSTOP,PSOASTOP W @IOF
"RTN","PSOLBL2",68,0)
 Q
"RTN","PSOLBL2",69,0)
KILL K PSCLN,DATE,DR,RXY,RFLMSG,COPIES,DRUG,LMI,LINE,INT,ISD,I1,MW,STATE,SIDE,SGY,PATST,PRTFL,PHYS,SGC,VRPH,NLWS,Y,TECH,LFLDT,EXPDT,COPAYVAR,NURSE,X,X1,X2,PSCAP,LOT,DIFF,DAYS,ZZ,GG,HH,KK,ULN,PSZIP,PSOHZIP,PSOPROV,PSMP,REPRINT,PS55,PS55X
"RTN","PSOLBL2",70,0)
 K PSOLBLDR,PSOLBLPS,OSIG,OSGY
"RTN","PSOLBL2",71,0)
 Q
"RTN","PSOLBL2",72,0)
TRAIL I $P(^PS(59,PSOSITE,1),"^",28) D ^PSOLBLN2
"RTN","PSOLBL2",73,0)
 D:'$P(^PS(59,PSOSITE,1),"^",28) ^PSOLBLS I $D(^TMP($J,"PSOCP",DFN)),'$P(^PS(59,PSOSITE,1),"^",28) D INV^PSOCPE
"RTN","PSOLBL2",74,0)
 K RXPI,PSORX,RXP,PSOIOS,PSOLAPPL,XXX,TECH,COPAYVAR,PHYS,MFG,NURSE,STATE,SIDE,COPIES,EXDT,ISD,PSOINST,RXN,RXY,VADT,DEA,WARN,FDT,QTY,PARST,PDA,PS,PS1,PS2,PSL,PSNP,INRX,RR,XTYPE,SSNP,PNM,ADDR,PSODBQ,PSOLASTF
"RTN","PSOLBL2",75,0)
 K ^TMP($J,"PSOCP",+$G(PSOCPN)),PSDFNFLG,PSOLAPPL
"RTN","PSOLBL2",76,0)
 I '$G(PSOBLALL) K PSOCPN,PSOLBLCP
"RTN","PSOLBL2",77,0)
 Q
"RTN","PSOLBLN2")
0^55^B37556069^B37925640
"RTN","PSOLBLN2",1,0)
PSOLBLN2 ;BHAM ISC/RTR - NEW LABEL TRAILER ;06/06/94
"RTN","PSOLBLN2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**92,107,110,305,326**;DEC 1997;Build 11
"RTN","PSOLBLN2",3,0)
 Q:'+$G(RXN)!('$G(PSOTRAIL))!('+$G(DFN))
"RTN","PSOLBLN2",4,0)
 I $G(PSOBLALL),$P(PPL,",",PI+1)'="" Q
"RTN","PSOLBLN2",5,0)
 K ^TMP($J,"PSOMAIL"),^TMP($J,"PSONARR"),^TMP($J,"PSOSUSP") S PRCOPAY=$S('$D(PSOCPN):0,1:1)
"RTN","PSOLBLN2",6,0)
START ;RETURN MAIL
"RTN","PSOLBLN2",7,0)
 S PS=$S($D(^PS(59,PSOSITE,0)):^(0),1:"") I $P(PSOSYS,"^",4),$D(^PS(59,+$P($G(PSOSYS),"^",4),0)) S PS=^PS(59,$P($G(PSOSYS),"^",4),0)
"RTN","PSOLBLN2",8,0)
 S VAADDR1=$P(PS,"^"),VASTREET=$P(PS,"^",2),STATE=$S($D(^DIC(5,+$P(PS,"^",8),0)):$P(^(0),"^",2),1:"UNKNOWN")
"RTN","PSOLBLN2",9,0)
 S PSZIP=$P(PS,"^",5) S PSOHZIP=$S(PSZIP["-":PSZIP,1:$E(PSZIP,1,5)_$S($E(PSZIP,6,9)]"":"-"_$E(PSZIP,6,9),1:""))
"RTN","PSOLBLN2",10,0)
 S ^TMP($J,"PSOMAIL",$S(PRCOPAY:1,1:3))="Pharmacy Service (119)",^($S(PRCOPAY:2,1:4))=$G(VAADDR1),^($S(PRCOPAY:3,1:5))=$G(VASTREET),^($S(PRCOPAY:4,1:6))=$P(PS,"^",7)_", "_$G(STATE)_"  "_$G(PSOHZIP)
"RTN","PSOLBLN2",11,0)
 I PRCOPAY F ZZZ=5:1:15 S ^TMP($J,"PSOMAIL",ZZZ)=""
"RTN","PSOLBLN2",12,0)
 I 'PRCOPAY F ZZZ=7:1:17 S ^TMP($J,"PSOMAIL",ZZZ)=""
"RTN","PSOLBLN2",13,0)
 S ^TMP($J,"PSOMAIL",$S(PRCOPAY:16,1:18))="Use the label above to mail the computer",^($S(PRCOPAY:17,1:19))="copies back to us. Apply enough postage",^($S(PRCOPAY:18,1:20))="to your envelope to ensure delivery."
"RTN","PSOLBLN2",14,0)
NARR ;SET TMP GLOBAL FOR NARRATIVES
"RTN","PSOLBLN2",15,0)
 K ^UTILITY($J,"W") S (DIWL,PSNACNT)=1,DIWR=45,DIWF="",(PSSIXFL,PSSEVFL)=0 F ZZ=0:0 S ZZ=$O(^PS(59,PSOSITE,6,ZZ)) Q:'ZZ  I $D(^(ZZ,0)) S X=^(0) D ^DIWP
"RTN","PSOLBLN2",16,0)
 F LLL=0:0 S LLL=$O(^UTILITY($J,"W",DIWL,LLL)) Q:'LLL  S ^TMP($J,"PSONARR",PSNACNT)=^UTILITY($J,"W",DIWL,LLL,0) S PSNACNT=PSNACNT+1,PSSIXFL=1
"RTN","PSOLBLN2",17,0)
 I PSSIXFL S ^TMP($J,"PSONARR",PSNACNT)="" S PSNACNT=PSNACNT+1
"RTN","PSOLBLN2",18,0)
 S DIWL=1,DIWR=45,DIWF="" K ^UTILITY($J,"W") F ZZ=0:0 S ZZ=$O(^PS(59,PSOSITE,7,ZZ)) Q:'ZZ  I $D(^(ZZ,0)) S X=^(0) D ^DIWP
"RTN","PSOLBLN2",19,0)
 F LLL=0:0 S LLL=$O(^UTILITY($J,"W",DIWL,LLL)) Q:'LLL  S ^TMP($J,"PSONARR",PSNACNT)=^UTILITY($J,"W",DIWL,LLL,0) S PSNACNT=PSNACNT+1,PSSEVFL=1
"RTN","PSOLBLN2",20,0)
 I $G(PSOCHAMP),$G(PSOTRAMT) D:PSSEVFL  S ^TMP($J,"PSONARR",PSNACNT)="REMIT $"_PSOTRAMT_" TO AGENT CASHIER." G SUSP
"RTN","PSOLBLN2",21,0)
 .S ^TMP($J,"PSONARR",PSNACNT)="" S PSNACNT=PSNACNT+1
"RTN","PSOLBLN2",22,0)
 I 'PRCOPAY G SUSP
"RTN","PSOLBLN2",23,0)
 I PSSEVFL S ^TMP($J,"PSONARR",PSNACNT)="" S PSNACNT=PSNACNT+1
"RTN","PSOLBLN2",24,0)
 S DIWL=1,DIWR=45,DIWF="" K ^UTILITY($J,"W") F ZZ=0:0 S ZZ=$O(^PS(59,PSOSITE,4,ZZ)) Q:'ZZ  I $D(^(ZZ,0)) S X=^(0) D ^DIWP
"RTN","PSOLBLN2",25,0)
 F LLL=0:0 S LLL=$O(^UTILITY($J,"W",DIWL,LLL)) Q:'LLL  S ^TMP($J,"PSONARR",PSNACNT)=^UTILITY($J,"W",DIWL,LLL,0) S PSNACNT=PSNACNT+1
"RTN","PSOLBLN2",26,0)
SUSP ;SUSPENSE DOCUMENT
"RTN","PSOLBLN2",27,0)
 S (PSSUFLG,PSSPCNT)=0 S:'$D(DFN) DFN=+$P($G(^PSRX(RX,0)),"^",2) S PSODFN=DFN,(SPPL,RXX,STA)=""
"RTN","PSOLBLN2",28,0)
 I $G(PSODTCUT)']"" S X1=DT,X2=-120 D C^%DTC S PSODTCUT=X
"RTN","PSOLBLN2",29,0)
 D ^PSOBUILD S (STA,RXX)="" F  S STA=$O(PSOSD(STA)) Q:STA=""  F  S RXX=$O(PSOSD(STA,RXX)) Q:RXX=""  I $P(PSOSD(STA,RXX),"^",2)=5 S SPPL=$P(PSOSD(STA,RXX),"^")_","_SPPL
"RTN","PSOLBLN2",30,0)
 D 6^VADPT,PID^VADPT I SPPL="" S PSSUFLG=1 G PRINT
"RTN","PSOLBLN2",31,0)
 S ^TMP($J,"PSOSUSP",1)="",^(2)=VADM(1),^(3)=$G(VAPA(1)),^(4)=$G(ADDR(2)) I $G(ADDR(3))="",$G(ADDR(4))="" S ^TMP($J,"PSOSUSP",5)="" G ADD
"RTN","PSOLBLN2",32,0)
 I $G(ADDR(3))'="",$G(ADDR(4))="" S ^TMP($J,"PSOSUSP",5)=$G(ADDR(3)) S ^TMP($J,"PSOSUSP",6)="" G ADD
"RTN","PSOLBLN2",33,0)
 S ^TMP($J,"PSOSUSP",5)=$G(ADDR(3)),^(6)=$G(ADDR(4)),^(7)=""
"RTN","PSOLBLN2",34,0)
ADD F ZZ=0:0 S ZZ=$O(^TMP($J,"PSOSUSP",ZZ)) Q:'ZZ  S PSSPCNT=ZZ
"RTN","PSOLBLN2",35,0)
 S PSSPCNT=PSSPCNT+1 S ^TMP($J,"PSOSUSP",PSSPCNT)="   The following prescriptions will be" S PSSPCNT=PSSPCNT+1 S ^TMP($J,"PSOSUSP",PSSPCNT)="mailed to you on or after the date indicated." S PSSPCNT=PSSPCNT+1
"RTN","PSOLBLN2",36,0)
 S ^TMP($J,"PSOSUSP",PSSPCNT)="",PSSPCNT=PSSPCNT+1,^(PSSPCNT)="Rx#                   Date",PSSPCNT=PSSPCNT+1,^(PSSPCNT)="============================================",PSSPCNT=PSSPCNT+1,^(PSSPCNT)="",PSSPCNT=PSSPCNT+1
"RTN","PSOLBLN2",37,0)
 F XX=1:1 Q:$P(SPPL,",",XX)=""  S PSSSRX=$P(SPPL,",",XX) D
"RTN","PSOLBLN2",38,0)
 .S SPNUM=$O(^PS(52.5,"B",PSSSRX,0)) I SPNUM S SPDATE=$P($G(^PS(52.5,SPNUM,0)),"^",2) S Y=SPDATE D DD^%DT S SPDATE=Y
"RTN","PSOLBLN2",39,0)
 .S $P(PSOLGTH," ",(20-($L($P(^PSRX(PSSSRX,0),"^")))))="" S ^TMP($J,"PSOSUSP",PSSPCNT)=$P(^PSRX(PSSSRX,0),"^")_PSOLGTH_$G(SPDATE) S PSSPCNT=PSSPCNT+1
"RTN","PSOLBLN2",40,0)
 .S ^TMP($J,"PSOSUSP",PSSPCNT)="  "_$$ZZ^PSOSUTL(PSSSRX) S PSSPCNT=PSSPCNT+1 K SPNUM,SPDATE,Y
"RTN","PSOLBLN2",41,0)
PRINT S PSOTRDFN=$P(VADM(2),"^"),PSOTRDFN=$S(PSOTRDFN]"":PSOTRDFN,1:"Unavailable") S Y=DT X ^DD("DD") S EDT=Y
"RTN","PSOLBLN2",42,0)
 W ?54,VADM(1)_" "_EDT
"RTN","PSOLBLN2",43,0)
 W ! I PRCOPAY,$G(PSOBARS) S X="S",X2=PSOTRDFN,X1=$X W ?54,@PSOBAR1,PSOTRDFN,@PSOBAR0,$C(13) S $X=0
"RTN","PSOLBLN2",44,0)
 I PRCOPAY,'$G(PSOBARS) W !!!
"RTN","PSOLBLN2",45,0)
 I 'PRCOPAY W !
"RTN","PSOLBLN2",46,0)
 I 'PSSUFLG D PRSUS,NPP1 G END
"RTN","PSOLBLN2",47,0)
 S (PSNONARR,PSNOADDR,PSNOBOTH)=0 F TTT=1:1 Q:$G(PSNOBOTH)  D
"RTN","PSOLBLN2",48,0)
 .W $G(^TMP($J,"PSOMAIL",TTT)) S:'$O(^(TTT)) PSNOADDR=1
"RTN","PSOLBLN2",49,0)
 .W ?54,$G(^TMP($J,"PSONARR",TTT)),! S:'$O(^(TTT)) PSNONARR=1
"RTN","PSOLBLN2",50,0)
 .I PSNOADDR,PSNONARR S PSNOBOTH=1
"RTN","PSOLBLN2",51,0)
 D NPP1
"RTN","PSOLBLN2",52,0)
END K ^TMP($J,"PSONARR"),^TMP($J,"PSOMAIL"),^TMP($J,"PSOSUSP"),^UTILITY($J,"W")
"RTN","PSOLBLN2",53,0)
 K DIWF,DIWL,DIWR,EDT,LLL,PRCOPAY,PS,PSNACNT,PSNOADDR,PSNOBOTH,PSNONARR,PSNOSUSP,PSNTHREE,PSOLGTH,PSOSD,PSOTRAIL,PSOTRDFN,PSSEVFL,PSSIXFL,PSSPCNT,PSSSRX,PSSUFLG,RXX,SPDATE,SPNUM,SPPL,STATE,TTT,VAADDR1,VADM,VAEL,VAPA,VASTREET,ZZ,ZZZ W @IOF
"RTN","PSOLBLN2",54,0)
 I $P(PSOPAR,"^",31) D BLANK^PSOLBLD W @IOF
"RTN","PSOLBLN2",55,0)
 Q
"RTN","PSOLBLN2",56,0)
NPP1 ;
"RTN","PSOLBLN2",57,0)
 N PSOLAN S PSOLAN=$P($G(^PS(55,DFN,"LAN")),"^",2) S:'PSOLAN PSOLAN=1
"RTN","PSOLBLN2",58,0)
 I $G(PSOLAN)=1 D
"RTN","PSOLBLN2",59,0)
 . W !,"The VA Notice of Privacy Practices, IB 10-163, which outlines your privacy",!
"RTN","PSOLBLN2",60,0)
 . W "rights, is available online at http://www1.va.gov/Health/ or you may obtain",!
"RTN","PSOLBLN2",61,0)
 . W "a copy by writing the VHA Privacy Office (19F2), 810 Vermont Avenue NW,",!
"RTN","PSOLBLN2",62,0)
 . W "Washington, DC 20420.",!
"RTN","PSOLBLN2",63,0)
 I $G(PSOLAN)=2 D
"RTN","PSOLBLN2",64,0)
 . W !,"La Notificacion relacionada con las Politicas de Privacidad del Departamento",!
"RTN","PSOLBLN2",65,0)
 . W "de Asuntos del Veterano, IB 10-163, contiene los detalles acerca de sus",!
"RTN","PSOLBLN2",66,0)
 . W "derechos de privacidad y esta disponible electronicamente en la siguiente",!
"RTN","PSOLBLN2",67,0)
 . W "direccion: http://www1.va.gov/Health/.  Usted tambien puede conseguir una",!
"RTN","PSOLBLN2",68,0)
 . W "copia escribiendo a la Oficina de Privacidad del Departamento de Asuntos de",!
"RTN","PSOLBLN2",69,0)
 . W "Salud del Veterano, (19F2), 810 Vermont Avenue NW, Washington, DC 20420.",!
"RTN","PSOLBLN2",70,0)
 Q
"RTN","PSOLBLN2",71,0)
 ;
"RTN","PSOLBLN2",72,0)
PRSUS S (PSNONARR,PSNOADDR,PSNOSUSP,PSNTHREE)=0 F TTT=1:1 Q:$G(PSNTHREE)  D
"RTN","PSOLBLN2",73,0)
 .W $G(^TMP($J,"PSOMAIL",TTT)) S:'$O(^(TTT)) PSNOADDR=1
"RTN","PSOLBLN2",74,0)
 .W ?54,$G(^TMP($J,"PSONARR",TTT)) S:'$O(^(TTT)) PSNONARR=1
"RTN","PSOLBLN2",75,0)
 .W ?102,$G(^TMP($J,"PSOSUSP",TTT)),! S:'$O(^(TTT)) PSNOSUSP=1
"RTN","PSOLBLN2",76,0)
 .I PSNOADDR,PSNONARR,PSNOSUSP S PSNTHREE=1
"RTN","PSOLBLN2",77,0)
 Q
"RTN","PSOLLL1")
0^46^B70166318^B70201021
"RTN","PSOLLL1",1,0)
PSOLLL1 ;BIR/BHW - LASER LABELS ;10/24/2002
"RTN","PSOLLL1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**120,141,135,162,161,233,200,264,326**;DEC 1997;Build 11
"RTN","PSOLLL1",3,0)
 ;
"RTN","PSOLLL1",4,0)
 ;Reference to ^PSDRUG supported by DBIA 221
"RTN","PSOLLL1",5,0)
 ;Reference ^VA(200,D0,"PS" supported by DBIA 224
"RTN","PSOLLL1",6,0)
 ;External reference to ^PS(55 supported by DBIA 2228
"RTN","PSOLLL1",7,0)
 ;
"RTN","PSOLLL1",8,0)
ST I $P($G(^PSRX(RX,3)),"^",3) S PSOPROV=+$P(^(0),"^",4),PSOPROV=$S($G(RXP):+$P($G(RXP),"^",17),$G(RXF):+$P($G(^PSRX(RX,1,RXF,0)),"^",17),1:PSOPROV) S:'$G(PSOPROV) PSOPROV=+$P(^PSRX(RX,0),"^",4) D
"RTN","PSOLLL1",9,0)
 . I +$P($G(^VA(200,PSOPROV,"PS")),"^",7) S:'$P($G(PHYS),"/",2) PHYS=$G(PHYS)_"/"_+$P($G(^PSRX(RX,3)),"^",3)
"RTN","PSOLLL1",10,0)
 S $P(ULN,"_",34)="",PSOTRAIL=1
"RTN","PSOLLL1",11,0)
 S (Y,X1)=EXPDT X ^DD("DD") S EXPDT=Y,Y=$P(^PSRX(RX,0),"^",13) X ^DD("DD") S ISD=Y,X2=DT D ^%DTC S DIFF=X
"RTN","PSOLLL1",12,0)
 S Y=DATE X ^DD("DD") S DATE=Y
"RTN","PSOLLL1",13,0)
 S TECH="("_$S($P($G(^PSRX(+$G(RX),"OR1")),"^",5):$P($G(^PSRX(+$G(RX),"OR1")),"^",5),1:$P(RXY,"^",16))_"/"_$S($G(VRPH)&($P(PSOPAR,"^",32)):VRPH,1:" ")_")"
"RTN","PSOLLL1",14,0)
 S PSZIP=$P(PS,"^",5),PSOHZIP=$S(PSZIP["-":PSZIP,1:$E(PSZIP,1,5)_$S($E(PSZIP,6,9)]"":"-"_$E(PSZIP,6,9),1:""))
"RTN","PSOLLL1",15,0)
L1 I $G(PSOIO("BLH"))]"" X PSOIO("BLH")
"RTN","PSOLLL1",16,0)
 I 'SIGF,'SIGM,'PMIM K PSOSTLK,ZTKDRUG I $L($T(PSOSTALK^PSOTALK1)) D PSOSTALK^PSOTALK1 D  S PSOSTLK=1 ; PRINT ONE SCRIPTALK LABEL IF APPLICABLE
"RTN","PSOLLL1",17,0)
 .D 6^VADPT,PID^VADPT6 S SSNPN=""
"RTN","PSOLLL1",18,0)
 S T="VAMC "_$P(PS,"^",7)_", "_STATE_" "_$G(PSOHZIP) S:SIGF!($G(FILLCONT)) T=" " D PRINT(T)
"RTN","PSOLLL1",19,0)
 S T=$P(PS2,"^",2)_"  "_TECH_"  Ph: "_$P(PS,"^",3)_"-"_$P(PS,"^",4) S:SIGF!($G(FILLCONT)) T=" " D PRINT(T)
"RTN","PSOLLL1",20,0)
 S PSDU=$P($G(^PSDRUG($P($G(^PSRX(RX,0)),"^",6),660)),"^",8)
"RTN","PSOLLL1",21,0)
 I $G(PSOIO("BLB"))]"" X PSOIO("BLB")
"RTN","PSOLLL1",22,0)
 S XFONT=$E(PSOFONT,2,99)
"RTN","PSOLLL1",23,0)
 S T="Rx# "_RXN_"  " S:SIGF!($G(FILLCONT)) T=" " D PRINT(T,1)
"RTN","PSOLLL1",24,0)
 D STRT^PSOLLU1("RX#",T,.L) S PSOY=PSOY-PSOYI,OPSOX=PSOX,PSOX=L(XFONT)*300+PSOX
"RTN","PSOLLL1",25,0)
 S DR=$G(SIGF("DR"))
"RTN","PSOLLL1",26,0)
 S T="  "_DATE_"  "_$S('SIGF:"Fill "_(RXF+1)_" of "_(1+$P(RXY,"^",9)),1:"(label continued)") S:SIGF!($G(FILLCONT)) T=" " D PRINT(T)
"RTN","PSOLLL1",27,0)
 S PSOX=OPSOX,T=PNM S:SIGF!($G(FILLCONT)) T=" " I T'=" " D PRINT(T,1)
"RTN","PSOLLL1",28,0)
 I DR>1 S PSOX=OPSOX,T="Rx# "_RXN_"  (label continued)" D PRINT(T)
"RTN","PSOLLL1",29,0)
 D STRT^PSOLLU1("SIG",T,.L)
"RTN","PSOLLL1",30,0)
 S OPSOX=PSOX,PSOX=L(XFONT)*300+PSOX,PSOY=PSOY-PSOYI,T="  "_$G(SSNPN) S:SIGF!($G(FILLCONT)) T=" " D PRINT(T)
"RTN","PSOLLL1",31,0)
 S PSOX=OPSOX,LENGTH=0,PTEXT="",SIGF=0,XFONT=$E(PSOFONT,2,99)
"RTN","PSOLLL1",32,0)
 N DP,TEXTP,TEXTL,MORE
"RTN","PSOLLL1",33,0)
 I 'SIGM,'$G(FILLCONT) D COUNTSG^PSOLLLW
"RTN","PSOLLL1",34,0)
 S DR=SIGF("DR")
"RTN","PSOLLL1",35,0)
 I DR>1,'$D(NSGY(DR,4)) D
"RTN","PSOLLL1",36,0)
 .F I=4:-1:1 Q:$D(NSGY(DR,I))  S T=" " D PRINT(T) ; BOTTOM-JUSTIFY CONTINUED BOTTLE SIG JUST ABOVE 'DISCARD' LINE
"RTN","PSOLLL1",37,0)
 F I=1:1 Q:'$D(NSGY(DR,I))  S TEXT=NSGY(DR,I) D PRINT(TEXT)
"RTN","PSOLLL1",38,0)
 I I>4,$D(NSGY(DR,5)) S SIGF=1,SIGF("DR")=DR+1
"RTN","PSOLLL1",39,0)
 I $G(PSOIO("BLF"))]"" X PSOIO("BLF")
"RTN","PSOLLL1",40,0)
 S PSOY=PSODY-PSOYI,PSOFONT=PSODFONT
"RTN","PSOLLL1",41,0)
 I SIGF G WARN:'SIGM&('$G(FILLCONT)),CONT
"RTN","PSOLLL1",42,0)
 I '$D(NSGY) G CONT
"RTN","PSOLLL1",43,0)
 K NSGY,^TMP($J,"PSOSIG",RX)
"RTN","PSOLLL1",44,0)
 D NOW^%DTC S X1=X,X2=365 D C^%DTC S Y=X X ^DD("DD")
"RTN","PSOLLL1",45,0)
 S DEA=$P($G(^PSDRUG($P(RXY,"^",6),0)),"^",3),T=""
"RTN","PSOLLL1",46,0)
 I DEA'["S" S T="Discard after "_$S(DEA[0!(DEA["M"):"_________",1:Y)_"__________   "
"RTN","PSOLLL1",47,0)
 S T=T_"Mfr_________" D PRINT(T)
"RTN","PSOLLL1",48,0)
 S PSOY=PSOY-5
"RTN","PSOLLL1",49,0)
 D  S PSOFONT="F8"  D PRINT(T)
"RTN","PSOLLL1",50,0)
 . S NOR=$P(RXY,"^",9)-RXF
"RTN","PSOLLL1",51,0)
 . I $P(RXY,"^",9)=0 S T="NO REFILL" Q
"RTN","PSOLLL1",52,0)
 . I NOR=0 S T="NO REFILLS LEFT" Q
"RTN","PSOLLL1",53,0)
 . S T="May refill "_NOR_"X by "_EXPDT
"RTN","PSOLLL1",54,0)
 S PPHYS=$G(PHYS)
"RTN","PSOLLL1",55,0)
 S XFONT=$E(PSOQFONT,2,99)
"RTN","PSOLLL1",56,0)
 S TEXT="Qty: " D STRT^PSOLLU1("SIG",TEXT,.L) S Q(1)=L(XFONT)
"RTN","PSOLLL1",57,0)
 S TEXT=" "_PSDU D STRT^PSOLLU1("SIG",TEXT,.L) S Q(2)=L(XFONT)
"RTN","PSOLLL1",58,0)
 S TEXT="       "_$G(PHYS) D STRT^PSOLLU1("SIG",TEXT,.L) S Q(3)=L(XFONT)
"RTN","PSOLLL1",59,0)
 S TEXT=$G(QTY) D STRT^PSOLLU1("SIG",TEXT,.L) S LENGTH=Q(1)+Q(2)+Q(3)+L(XFONT+2),Q(4)=L(XFONT+2)
"RTN","PSOLLL1",60,0)
 I LENGTH>3 F I=$L(PHYS)-1:-1:1 S PPHYS=$E(PHYS,1,I),TEXT="       "_PPHYS D STRT^PSOLLU1("SIG",TEXT,.L) I Q(1)+Q(2)+Q(4)+L(XFONT)<3.3 Q 
"RTN","PSOLLL1",61,0)
 S PSOFONT=PSOTFONT,OPSOX=PSOX,PSOX=PSOX+(Q(1)*300),PSOY=PSOQY-PSOYI,T=$G(QTY) D PRINT(T)
"RTN","PSOLLL1",62,0)
 S PSOX=OPSOX,PSOFONT=PSOQFONT,PSOY=PSOY-PSOYI,T="Qty: " D PRINT(T)
"RTN","PSOLLL1",63,0)
 S PSOX=PSOX+(Q(1)+Q(4)*300),PSOY=PSOY-PSOYI,T=" "_$G(PSDU)_"       "_$G(PPHYS) D PRINT(T)
"RTN","PSOLLL1",64,0)
 S PSOFONT=PSOTFONT,PSOX=OPSOX,PSOY=PSOTY-PSOYI,T=DRUG D STRT^PSOLLU1("SIG",T,.L)
"RTN","PSOLLL1",65,0)
 I L($E(PSOFONT,2,99))>3 S PSOFONT=$S(PSOFONT="F12":"F10",PSOFONT="F10":"F9",PSOFONT="F9":F8,PSOFONT="F8":"F6")
"RTN","PSOLLL1",66,0)
 S ZTKDRUG="XXXXXX   SCRIPTALK RX   XXXXXX"
"RTN","PSOLLL1",67,0)
 I $G(PSOSTLK) S T=$S($G(PSOSTALK):ZTKDRUG,1:DRUG)
"RTN","PSOLLL1",68,0)
 D PRINT(T,1)
"RTN","PSOLLL1",69,0)
 I SIGM G CONT
"RTN","PSOLLL1",70,0)
 S ^PSRX(RX,"TYPE")=0
"RTN","PSOLLL1",71,0)
WARN ;PRINT WARNING LABELS
"RTN","PSOLLL1",72,0)
 I $G(PSOIO("WLI"))]"" X PSOIO("WLI")
"RTN","PSOLLL1",73,0)
 ; IF <5 WARNINGS, PRINT LABELS BOTTOM-JUSTIFIED
"RTN","PSOLLL1",74,0)
 S PSOLAN=$P($G(^PS(55,DFN,"LAN")),"^",2)
"RTN","PSOLLL1",75,0)
 S WARN5=WARN F  Q:$L(WARN5,",")>4  S WARN5=" ,"_WARN5
"RTN","PSOLLL1",76,0)
 F WWW=1:1:5 S PSOWARN=$P(WARN5,",",WWW) I PSOWARN'="" D
"RTN","PSOLLL1",77,0)
 . I PSOWARN["N" D NEWWARN^PSOLLLW Q
"RTN","PSOLLL1",78,0)
 . D WARN54^PSOLLLW
"RTN","PSOLLL1",79,0)
 ;RETURN MAIL
"RTN","PSOLLL1",80,0)
 S PS=$S($D(^PS(59,PSOSITE,0)):^(0),1:"") I $P(PSOSYS,"^",4),$D(^PS(59,+$P($G(PSOSYS),"^",4),0)) S PS=^PS(59,$P($G(PSOSYS),"^",4),0)
"RTN","PSOLLL1",81,0)
 S VAADDR1=$P(PS,"^"),VASTREET=$P(PS,"^",2),STATE=$S($D(^DIC(5,+$P(PS,"^",8),0)):$P(^(0),"^",2),1:"UNKNOWN")
"RTN","PSOLLL1",82,0)
 S PSZIP=$P(PS,"^",5),PSOHZIP=$S(PSZIP["-":PSZIP,1:$E(PSZIP,1,5)_$S($E(PSZIP,6,9)]"":"-"_$E(PSZIP,6,9),1:""))
"RTN","PSOLLL1",83,0)
 I $G(PSOIO("RMI"))]"" X PSOIO("RMI")
"RTN","PSOLLL1",84,0)
 S PSOYI=$G(PSOHYI,40),OFONT=PSOFONT,PSOFONT=$G(PSOHFONT)
"RTN","PSOLLL1",85,0)
 S BLNKLIN="",$P(BLNKLIN," ",40)=" "
"RTN","PSOLLL1",86,0)
 S T="Attn: (119)"_BLNKLIN_$$FMTE^XLFDT(DT) D PRINT(T,0)
"RTN","PSOLLL1",87,0)
 S T=$G(VASTREET) D PRINT(T,0)
"RTN","PSOLLL1",88,0)
 S T=$P(PS,"^",7)_", "_$G(STATE)_"  "_$G(PSOHZIP) D PRINT(T,0)
"RTN","PSOLLL1",89,0)
 S PSOY=PSOY+PSOYI,T=$S(PS55=2:"***DO NOT MAIL***",1:"") I T'="" D PRINT(T,0)
"RTN","PSOLLL1",90,0)
 I T'="***DO NOT MAIL***" S T=$S(PS55[0!(PS55[3)!(PS55=""):"REGULAR MAIL",1:"CERTIFIED MAIL") S T=T_"-"_$G(MAILCOM) S:$L(T)>25 PSOFONT="F8" D PRINT(T,0)
"RTN","PSOLLL1",91,0)
 S PSOFONT=OFONT
"RTN","PSOLLL1",92,0)
 S T=PNM
"RTN","PSOLLL1",93,0)
 S PSOY=PSOY+PSOYI,PSOYI=PSORYI D PRINT(T,0)
"RTN","PSOLLL1",94,0)
 I $G(VAPA(1))=""!(PS55=2) G W
"RTN","PSOLLL1",95,0)
 ; ADD CHECK FOR BAD ADDRESS INDICATOR OR FOREIGN ADDRESS
"RTN","PSOLLL1",96,0)
 N PSOBADR,PSOTEMP,PSOFORGN,I
"RTN","PSOLLL1",97,0)
 S PSOBADR=0,PSOTEMP=0
"RTN","PSOLLL1",98,0)
 S PSOFORGN=$P($G(VAPA(25)),"^",2) I PSOFORGN'="",PSOFORGN'["UNITED STATES" S PSOFORGN=1
"RTN","PSOLLL1",99,0)
 I 'PSOFORGN S PSOBADR=$$BADADR^DGUTL3(DFN)
"RTN","PSOLLL1",100,0)
 I 'PSOFORGN,PSOBADR S PSOTEMP=$$CHKTEMP^PSOBAI(DFN)
"RTN","PSOLLL1",101,0)
 F I=1:1:3 I $G(VAPA(I))]"" D
"RTN","PSOLLL1",102,0)
 . S T="" I I=1,'PSOFORGN,PSOBADR,'$G(PSOTEMP) S T="** BAD ADDRESS INDICATED **"
"RTN","PSOLLL1",103,0)
 . I I=1,T="",PSOFORGN S T="*** FOREIGN ADDRESS ***"
"RTN","PSOLLL1",104,0)
 . I T="" I 'PSOFORGN I 'PSOBADR!$G(PSOTEMP) S T=$G(VAPA(I))
"RTN","PSOLLL1",105,0)
 . D STRT^PSOLLU1("ML",T,.L) I L($E(PSOFONT,2,99))<2.37 D PRINT(T,0) Q
"RTN","PSOLLL1",106,0)
 . F F=12,10,9,8,6 I L(F)<2.37 S OFONT=PSOFONT,PSOFONT="F"_F D PRINT(T,0) S PSOFONT=OFONT Q
"RTN","PSOLLL1",107,0)
 S A=+$G(VAPA(5)) I A S A=$S($D(^DIC(5,A,0)):$P(^(0),"^",2),1:"UNKNOWN")
"RTN","PSOLLL1",108,0)
 S T="" I 'PSOFORGN I 'PSOBADR!$G(PSOTEMP) S T=$G(VAPA(4))_", "_A_"  "_$S($G(VAPA(11)):$P(VAPA(11),"^",2),1:$G(VAPA(6)))
"RTN","PSOLLL1",109,0)
 D PRINT(T,0)
"RTN","PSOLLL1",110,0)
W ;
"RTN","PSOLLL1",111,0)
 S T=$S(MW="WINDOW":"WINDOW -",1:"MAIL -")
"RTN","PSOLLL1",112,0)
 N XFONT
"RTN","PSOLLL1",113,0)
 S OFONT=PSOFONT,PSOYI=$G(PSOTYI,40),PSOFONT=PSOTFONT,XFONT=$E(PSOFONT,2,99),PSOY=PSOTY
"RTN","PSOLLL1",114,0)
 I T["WINDOW" D
"RTN","PSOLLL1",115,0)
 . I $G(^PSRX(RX,"MP"))'="" S PSOY=PSOY-PSOYI ; START 1 LINE HIGHER IF METHOD OF PICK-UP
"RTN","PSOLLL1",116,0)
 . S OPSOX=PSOX D PRINT(T,1) S PSOX=PSOX+200,PSOY=PSOY-PSOYI
"RTN","PSOLLL1",117,0)
 . S T=$G(^PSRX(RX,"MP")) I T="" S PSOFONT=OFONT,PSOX=OPSOX Q
"RTN","PSOLLL1",118,0)
 . N FIRST
"RTN","PSOLLL1",119,0)
 . S FIRST=1
"RTN","PSOLLL1",120,0)
 . D STRT^PSOLLU1("ML",T,.L)
"RTN","PSOLLL1",121,0)
 . I L(XFONT)<1.75 D PRINT(T,0) S PSOFONT=OFONT,PSOX=OPSOX Q
"RTN","PSOLLL1",122,0)
 . F F=10,9,8,6 I L(F)<4.5 Q
"RTN","PSOLLL1",123,0)
 . S XFONT=F,PSOFONT="F"_F,PSOYI=$S(PSOFONT="F12":40,PSOFONT="F10":35,PSOFONT="F9":30,PSOFONT="F8":25,1:20)
"RTN","PSOLLL1",124,0)
 . F J=$L(T," "):-1:1 S PTEXT=$P(T," ",1,J) D STRT^PSOLLU1("ML",PTEXT,.L) D  Q:T=""
"RTN","PSOLLL1",125,0)
 .. I FIRST I L(XFONT)<1.75 D PRINT(PTEXT,0) S T=$P(T," ",J+1,512),J=$L(T," ")+1,PTEXT="",FIRST=0,PSOX=OPSOX,PSOY=PSOY+20 Q
"RTN","PSOLLL1",126,0)
 .. I 'FIRST I L(XFONT)<2.3 D PRINT(PTEXT,0) S T=$P(T," ",J+1,512),J=$L(T," ")+1,PTEXT=""
"RTN","PSOLLL1",127,0)
 . D:PTEXT]"" PRINT(PTEXT,0)
"RTN","PSOLLL1",128,0)
 I T="MAIL -" D PRINT(T,1)
"RTN","PSOLLL1",129,0)
 S PSOFONT=OFONT
"RTN","PSOLLL1",130,0)
CONT I $G(SIDE) G BARC:'L5,CONT2
"RTN","PSOLLL1",131,0)
 I $G(COPIES)>1 G BARC
"RTN","PSOLLL1",132,0)
 I 'L2!PFM D ^PSOLLL2 S L2=1
"RTN","PSOLLL1",133,0)
 I 'L3 D ^PSOLLL3 S L3=1
"RTN","PSOLLL1",134,0)
 I 'L4!PMIM S PIMI=0 D ^PSOLLL4 S L4=1
"RTN","PSOLLL1",135,0)
 I L5 W @IOF G CONT2
"RTN","PSOLLL1",136,0)
BARC I $G(BOTTLBL) G BARCE ; ONLY PRINT BARCODE ON 1ST BOTTLE LABEL
"RTN","PSOLLL1",137,0)
 S BOTTLBL=1
"RTN","PSOLLL1",138,0)
 I $G(PSOIO("BLBC"))]"" X PSOIO("BLBC") I $G(NOBARC) G BARCE
"RTN","PSOLLL1",139,0)
 S X2=PSOINST_"-"_RX W X2
"RTN","PSOLLL1",140,0)
 I $G(PSOIO("EBLBC"))]"" X PSOIO("EBLBC")
"RTN","PSOLLL1",141,0)
BARCE W @IOF
"RTN","PSOLLL1",142,0)
COPY I SIGF S SIGM=1 G L1 ; NEED TO FINISH PRINTING CONTINUED BOTTLE LABEL
"RTN","PSOLLL1",143,0)
 S FILLCONT=0 I PFM!PMIM S FILLCONT=1 G L1
"RTN","PSOLLL1",144,0)
 I $G(COPIES)>1 D  G L1
"RTN","PSOLLL1",145,0)
 . S COPIES=COPIES-1
"RTN","PSOLLL1",146,0)
 . S (SIGM,PFM,PMIM,L2,L3,L4,L5,BOTTLBL)=0
"RTN","PSOLLL1",147,0)
 . K SIGF,PFF,PMIF S (SIGF,PFF,PMIF)=0 F I="DR","T" S (SIGF(I),PFF(I))=1
"RTN","PSOLLL1",148,0)
 . F I="A","B","I" S PMIF(I)=1
"RTN","PSOLLL1",149,0)
 S IR=0 F FDA=0:0 S FDA=$O(^PSRX(RX,"L",FDA)) Q:'FDA  S IR=FDA
"RTN","PSOLLL1",150,0)
 S IR=IR+1,^PSRX(RX,"L",0)="^52.032DA^"_IR_"^"_IR
"RTN","PSOLLL1",151,0)
 S ^PSRX(RX,"L",IR,0)=PSOFNOW_"^"_$S($G(RXP):99-RXPI,1:RXF)_"^"_$S($G(PCOMX)]"":$G(PCOMX),$G(PCOMH(RX))]"":PCOMH(RX),1:"From RX number "_$P(^PSRX(RX,0),"^"))_$S($G(RXP):" (Partial)",1:"")_$S($D(REPRINT):" (Reprint)",1:"")_"^"_PDUZ
"RTN","PSOLLL1",152,0)
 N PSOBADR,PSOTEMP
"RTN","PSOLLL1",153,0)
 S PSOBADR=$$CHKRX^PSOBAI(RX)
"RTN","PSOLLL1",154,0)
 I $G(PSOBADR) S PSOTEMP=$P(PSOBADR,"^",2),PSOBADR=$P(PSOBADR,"^")
"RTN","PSOLLL1",155,0)
 I $G(PSOBADR),'$G(PSOTEMP) D
"RTN","PSOLLL1",156,0)
 .S IR=IR+1,^PSRX(RX,"L",0)="^52.032DA^"_IR_"^"_IR
"RTN","PSOLLL1",157,0)
 .S ^PSRX(RX,"L",IR,0)=PSOFNOW_"^"_$S($G(RXP):99-RXPI,1:RXF)_"^"_"ROUTING="_$G(MW)_" (BAD ADDRESS)"_"^"_PDUZ
"RTN","PSOLLL1",158,0)
 S L5=1
"RTN","PSOLLL1",159,0)
CONT2 I SIGF S SIGM=1 G L1 ; MORE BOTTLE LABEL SIG TO PRINT
"RTN","PSOLLL1",160,0)
 I PMIM G CONT ; MORE PMI INFO TO PRINT
"RTN","PSOLLL1",161,0)
 I $G(PSOBLALL)=1,$P(PPL,",",PI+1)="" D TRAIL
"RTN","PSOLLL1",162,0)
 Q
"RTN","PSOLLL1",163,0)
PRINT(T,B) ;
"RTN","PSOLLL1",164,0)
 S BOLD=$G(B)
"RTN","PSOLLL1",165,0)
 I 'BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL1",166,0)
 I BOLD,$G(PSOIO(PSOFONT_"B"))]"" X PSOIO(PSOFONT_"B")
"RTN","PSOLLL1",167,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSOLLL1",168,0)
 W T,!
"RTN","PSOLLL1",169,0)
 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSOLLL1",170,0)
 I BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT) ;TURN OFF BOLDING
"RTN","PSOLLL1",171,0)
 Q
"RTN","PSOLLL1",172,0)
TRAIL I $G(SIDE) G END
"RTN","PSOLLL1",173,0)
 D ^PSOLLL5
"RTN","PSOLLL1",174,0)
 D ^PSOLLLH
"RTN","PSOLLL1",175,0)
 D ^PSOLLL6
"RTN","PSOLLL1",176,0)
 I '$P($G(^PS(59,PSOSITE,1)),"^",18) Q
"RTN","PSOLLL1",177,0)
 I '$G(REPRINT) D ^PSOLLL7
"RTN","PSOLLL1",178,0)
END I '$P(PSOPAR,"^",31) Q
"RTN","PSOLLL1",179,0)
 W @IOF
"RTN","PSOLLL1",180,0)
 I $G(PSOIO("PMII"))]"" X PSOIO("PMII")
"RTN","PSOLLL1",181,0)
 I $G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL1",182,0)
 S T="NEXT PATIENT"
"RTN","PSOLLL1",183,0)
 S PSOX=1100-(L($E(PSOFONT,2,99))*300/2)
"RTN","PSOLLL1",184,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSOLLL1",185,0)
 W T,!
"RTN","PSOLLL1",186,0)
 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSOLLL1",187,0)
 Q
"RTN","PSOLLL1",188,0)
 ;
"RTN","PSOLLL5")
0^47^B37231330^B37264779
"RTN","PSOLLL5",1,0)
PSOLLL5 ;BIR/RJS - LASER LABEL CONTINUED ;11/14/05 10:09am
"RTN","PSOLLL5",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**120,161,230,200,326**;DEC 1997;Build 11
"RTN","PSOLLL5",3,0)
 ;
"RTN","PSOLLL5",4,0)
START ;
"RTN","PSOLLL5",5,0)
 N TEXT,BLNKLIN
"RTN","PSOLLL5",6,0)
 S $P(BLNKLIN,"_",90)="_"
"RTN","PSOLLL5",7,0)
 D MAIL^PSOLLL7
"RTN","PSOLLL5",8,0)
 I $G(PSOIO("ACI"))]"" X PSOIO("ACI")
"RTN","PSOLLL5",9,0)
 S TEXT="HAS YOUR ADDRESS CHANGED?" D STRT^PSOLLU1("SEC2",TEXT,.L)
"RTN","PSOLLL5",10,0)
 S OPSOX=PSOX,PSOX=4.2-L($E(PSOHFONT,2,99))*300/2+OPSOX
"RTN","PSOLLL5",11,0)
 S OFONT=PSOFONT,PSOFONT=$G(PSOHFONT,OFONT) D PRINT(TEXT,1) S PSOX=OPSOX,PSOY=PSOY+10,PSOFONT=OFONT
"RTN","PSOLLL5",12,0)
 S TEXT="Write address changes in the blanks, sign the form, and return to" D PRINT(TEXT,0)
"RTN","PSOLLL5",13,0)
 S TEXT="your pharmacy." D PRINT(TEXT,0)
"RTN","PSOLLL5",14,0)
 S X=$S($D(^DPT(DFN,0))#2:^(0),1:""),PNM=$P(X,"^")
"RTN","PSOLLL5",15,0)
 D PID^VADPT6,ADD^VADPT S SSNP=""
"RTN","PSOLLL5",16,0)
 S PSOY=PSOY+PSOYI,TEXT=PNM_"  "_SSNP D PRINT(TEXT,0)
"RTN","PSOLLL5",17,0)
 I $G(VAPA(1))="" G ALLERGY
"RTN","PSOLLL5",18,0)
 F I=1:1:3 I $G(VAPA(I))]"" S TEXT=$G(VAPA(I))_$E(BLNKLIN,1,80-$L(VAPA(I))) D PRINT(TEXT,0)
"RTN","PSOLLL5",19,0)
 S A=+$G(VAPA(5)) I A S A=$S($D(^DIC(5,A,0)):$P(^(0),"^",2),1:"UNKNOWN")
"RTN","PSOLLL5",20,0)
 S B=$G(VAPA(4))_", "_A_"  "_$S($G(VAPA(11)):$P(VAPA(11),"^",2),1:$G(VAPA(6)))
"RTN","PSOLLL5",21,0)
 S TEXT=B_$E(BLNKLIN,1,80-$L(B)) D PRINT(TEXT,0)
"RTN","PSOLLL5",22,0)
 S B=VAPA(8)
"RTN","PSOLLL5",23,0)
 S TEXT=B_$E(BLNKLIN,1,80-$L(B)) D PRINT(TEXT,0)
"RTN","PSOLLL5",24,0)
 S:$G(VAPA(3))="" PSOY=PSOY+PSOYI
"RTN","PSOLLL5",25,0)
 S TEXT="[   ] Permanent                     [   ] Temporary until ____/____/____" D PRINT(TEXT,0)
"RTN","PSOLLL5",26,0)
 S PSOY=$G(PSOFY),TEXT="Signature "_$E(BLNKLIN,1,45) D PRINT(TEXT,0)
"RTN","PSOLLL5",27,0)
 ;
"RTN","PSOLLL5",28,0)
ALLERGY ;ALLERGIES & REACTIONS
"RTN","PSOLLL5",29,0)
 K ^TMP($J,"PSOALWA")
"RTN","PSOLLL5",30,0)
 S GMRA="0^0^111" D ^GMRADPT
"RTN","PSOLLL5",31,0)
 I $G(GMRAL) S PSORY=0 F  S PSORY=$O(GMRAL(PSORY)) Q:'PSORY  S ^TMP($J,"PSOALWA",$S($P(GMRAL(PSORY),"^",4):1,1:2),$S('$P(GMRAL(PSORY),"^",5):1,1:2),$P(GMRAL(PSORY),"^",7),$P(GMRAL(PSORY),"^",2))=""
"RTN","PSOLLL5",32,0)
 S ^TMP($J,"PSOAPT",1)=$G(PNM)_"  "_$G(SSNP),^(2)="Verified Allergies"
"RTN","PSOLLL5",33,0)
 S ALCNT=0,EEE=0,(PSOLG,PSOLGA)="" F  S PSOLG=$O(^TMP($J,"PSOALWA",1,1,PSOLG)) Q:PSOLG=""  F  S PSOLGA=$O(^TMP($J,"PSOALWA",1,1,PSOLG,PSOLGA)) Q:PSOLGA=""  S EEE=1,ALCNT=ALCNT+1,^TMP($J,"PSOAPT",2,ALCNT)=PSOLGA
"RTN","PSOLLL5",34,0)
 I 'EEE,$G(GMRAL)=0 S ALCNT=ALCNT+1,^TMP($J,"PSOAPT",2,ALCNT)="NKA"
"RTN","PSOLLL5",35,0)
 S ALCNT=0,^TMP($J,"PSOAPT",3)="Non-Verified Allergies"
"RTN","PSOLLL5",36,0)
 S EEE=0,(PSOLG,PSOLGA)="" F  S PSOLG=$O(^TMP($J,"PSOALWA",2,1,PSOLG)) Q:PSOLG=""  F  S PSOLGA=$O(^TMP($J,"PSOALWA",2,1,PSOLG,PSOLGA)) Q:PSOLGA=""  S EEE=EEE+1,ALCNT=ALCNT+1,^TMP($J,"PSOAPT",3,ALCNT)=PSOLGA
"RTN","PSOLLL5",37,0)
 I 'EEE,$G(GMRAL)=0 S ALCNT=ALCNT+1,^TMP($J,"PSOAPT",3,ALCNT)="NKA"
"RTN","PSOLLL5",38,0)
 S ALCNT=0,^TMP($J,"PSOAPT",4)="Verified Adverse Reactions"
"RTN","PSOLLL5",39,0)
 S (PSOLG,PSOLGA)="" F  S PSOLG=$O(^TMP($J,"PSOALWA",1,2,PSOLG)) Q:PSOLG=""  F  S PSOLGA=$O(^TMP($J,"PSOALWA",1,2,PSOLG,PSOLGA)) Q:PSOLGA=""  S ALCNT=ALCNT+1,^TMP($J,"PSOAPT",4,ALCNT)=PSOLGA
"RTN","PSOLLL5",40,0)
 S ALCNT=0,^TMP($J,"PSOAPT",5)="Non-Verified Adverse Reactions"
"RTN","PSOLLL5",41,0)
 S (PSOLG,PSOLGA)="" F  S PSOLG=$O(^TMP($J,"PSOALWA",2,2,PSOLG)) Q:PSOLG=""  F  S PSOLGA=$O(^TMP($J,"PSOALWA",2,2,PSOLG,PSOLGA)) Q:PSOLGA=""  S ALCNT=ALCNT+1,^TMP($J,"PSOAPT",5,ALCNT)=PSOLGA
"RTN","PSOLLL5",42,0)
 I $G(PSOIO("ALI"))]"" X PSOIO("ALI")
"RTN","PSOLLL5",43,0)
 S XFONT=$E($G(PSOFONT),2,99)
"RTN","PSOLLL5",44,0)
 S OFONT=PSOFONT,PSOFONT=$G(PSOHFONT,PSOFONT) S TEXT=^TMP($J,"PSOAPT",1) D PRINT(TEXT,1) S PSOFONT=OFONT
"RTN","PSOLLL5",45,0)
 I $$GET1^DIQ(44,$P(RXY,"^",5),2,"I")="W" S TEXT="INPATIENT" D PRINT(TEXT,0)
"RTN","PSOLLL5",46,0)
 F CCC=3,4,5 I '$O(^TMP($J,"PSOAPT",CCC,0)) K ^TMP($J,"PSOAPT",CCC)
"RTN","PSOLLL5",47,0)
 D ASSESS
"RTN","PSOLLL5",48,0)
 I CCC="NKA" S ^TMP($J,"PSOAPT",2,1)="No Known Allergies" K ^TMP($J,"PSOAPT",3)
"RTN","PSOLLL5",49,0)
 S CCC=1,OUT=0
"RTN","PSOLLL5",50,0)
 F  S CCC=$O(^TMP($J,"PSOAPT",CCC)) Q:CCC=""  D  Q:OUT
"RTN","PSOLLL5",51,0)
 .S TEXT=$G(^TMP($J,"PSOAPT",CCC))
"RTN","PSOLLL5",52,0)
 .I $G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL5",53,0)
 .S PSOY=PSOY+PSOYI D PRINT(TEXT,0,1)
"RTN","PSOLLL5",54,0)
 .I TEXT="No Assessment Made" Q
"RTN","PSOLLL5",55,0)
 .I PSOY>PSOYM S OUT=1 Q
"RTN","PSOLLL5",56,0)
 .S (TEXT,PTEXT,CCC2)="",LENGTH=0
"RTN","PSOLLL5",57,0)
 .F  S CCC2=$O(^TMP($J,"PSOAPT",CCC,CCC2)) Q:CCC2=""  S TEXT=^(CCC2) D  Q:OUT
"RTN","PSOLLL5",58,0)
 ..D STRT^PSOLLU1("SEC2",TEXT,.L)
"RTN","PSOLLL5",59,0)
 ..I LENGTH+L(XFONT)<3.7 S PTEXT=PTEXT_TEXT_",",LENGTH=LENGTH+L(XFONT) Q
"RTN","PSOLLL5",60,0)
 ..I PTEXT="" D  Q
"RTN","PSOLLL5",61,0)
 ... F JJ=$L(TEXT):-1 S PTEXT=$E(TEXT,1,JJ) D STRT^PSOLLU1("SEC2",PTEXT,.L) I L(XFONT)<3.7 D PRINT(PTEXT,0) S PTEXT=$E(TEXT,JJ+1,512)_"," Q
"RTN","PSOLLL5",62,0)
 ... D STRT^PSOLLU1("SEC2",PTEXT,.L) S LENGTH=L(XFONT)
"RTN","PSOLLL5",63,0)
 ..S LENGTH=0,CCC2=CCC2-1
"RTN","PSOLLL5",64,0)
 ..I PSOY>PSOYM S OUT=1 Q
"RTN","PSOLLL5",65,0)
 ..D PRINT(PTEXT,0) S PTEXT=""
"RTN","PSOLLL5",66,0)
 .I 'OUT,PTEXT]"" D PRINT($P(PTEXT,",",1,$L(PTEXT,",")-1),0)
"RTN","PSOLLL5",67,0)
 I OUT S T="Additional Allergies or Adverse Reactions Exist." D PRINT(T,0) S T="Talk to your Physician or Pharmacist." D PRINT(T,0)
"RTN","PSOLLL5",68,0)
 K ^TMP($J,"PSOALWA"),^TMP($J,"PSOAPT"),PSONKA,PSONULL,WWW,GMRA,GMRAL,JJJ,WCNT,RRR,ALG,ALCNT,EEE,FFF,PSOLG,PSOLGA,PSORY,CCC,CCC2,FNTFLG,TEXT,TEXT2
"RTN","PSOLLL5",69,0)
SUSPEN S PSODFN=DFN,(SPPL,RXX,STA)="",XXS=1
"RTN","PSOLLL5",70,0)
 I $G(PSODTCUT)']"" S X1=DT,X2=-120 D C^%DTC S PSODTCUT=X
"RTN","PSOLLL5",71,0)
 D ^PSOBUILD S (STA,RXX)=""
"RTN","PSOLLL5",72,0)
 F  S STA=$O(PSOSD(STA)) Q:STA=""  F  S RXX=$O(PSOSD(STA,RXX)) Q:RXX=""  I $P(PSOSD(STA,RXX),"^",2)=5 S SPPL=$P(PSOSD(STA,RXX),"^")_","_SPPL
"RTN","PSOLLL5",73,0)
 I SPPL="" Q
"RTN","PSOLLL5",74,0)
SUSP1 I $G(PSOIO("SPI"))]"" X PSOIO("SPI")
"RTN","PSOLLL5",75,0)
 S TOF=0,TEXT=PNM_" "_SSNP_" "_$G(PSONOW) D PRINT(TEXT,0)
"RTN","PSOLLL5",76,0)
 S TEXT="The following prescription(s) have been requested and will be" D PRINT(TEXT,0)
"RTN","PSOLLL5",77,0)
 S TEXT="mailed to you on or after the date indicated." D PRINT(TEXT,0)
"RTN","PSOLLL5",78,0)
 S PSOY=PSOY+PSOYI,TEXT="Rx#                                          Date                                        "
"RTN","PSOLLL5",79,0)
 D PRINT(TEXT,0,1)
"RTN","PSOLLL5",80,0)
 F XX=XXS:1 Q:$P(SPPL,",",XX)=""  S RX=$P(SPPL,",",XX) D  Q:TOF
"RTN","PSOLLL5",81,0)
 . S SPNUM=$O(^PS(52.5,"B",RX,0)) I SPNUM S SPDATE=$P($G(^PS(52.5,SPNUM,0)),"^",2) S Y=SPDATE X ^DD("DD") S SPDATE=Y
"RTN","PSOLLL5",82,0)
 . S T=$P(^PSRX(RX,0),"^") D PRINT(T,0)
"RTN","PSOLLL5",83,0)
 . S PSOY=PSOY-PSOYI,OPSOX=PSOX,PSOX=PSOCX,T=$G(SPDATE) D PRINT(T,0)
"RTN","PSOLLL5",84,0)
 . S PSOX=OPSOX+20,T=$$ZZ^PSOSUTL(RX) D PRINT(T,0) K SPNUM,SPDATE,Y,ZDRUG
"RTN","PSOLLL5",85,0)
 . S PSOX=OPSOX,PSOY=PSOY+PSOYI
"RTN","PSOLLL5",86,0)
 . I PSOY>PSOYM S XXS=XX+1,TOF=1 W:$P(SPPL,",",XXS)]"" @IOF Q
"RTN","PSOLLL5",87,0)
 I TOF,$P(SPPL,",",XXS)]"" G SUSP1
"RTN","PSOLLL5",88,0)
 Q
"RTN","PSOLLL5",89,0)
PRINT(T,B,UL) ;
"RTN","PSOLLL5",90,0)
 S BOLD=$G(B),UL=$G(UL)
"RTN","PSOLLL5",91,0)
 I 'BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL5",92,0)
 I BOLD,$G(PSOIO(PSOFONT_"B"))]"" X PSOIO(PSOFONT_"B")
"RTN","PSOLLL5",93,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSOLLL5",94,0)
 I UL,$G(PSOIO("FWU"))]"" X PSOIO("FWU")
"RTN","PSOLLL5",95,0)
 W T,!
"RTN","PSOLLL5",96,0)
 I UL,$G(PSOIO("FDU"))]"" X PSOIO("FDU")
"RTN","PSOLLL5",97,0)
 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSOLLL5",98,0)
 I BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT) ;TURN OFF BOLDING
"RTN","PSOLLL5",99,0)
 Q
"RTN","PSOLLL5",100,0)
ASSESS ;
"RTN","PSOLLL5",101,0)
 N FLG3,FLG4,FLG5
"RTN","PSOLLL5",102,0)
 S CCC=$G(^TMP($J,"PSOAPT",2,1))
"RTN","PSOLLL5",103,0)
 S FLG3=$G(^TMP($J,"PSOAPT",3,1))
"RTN","PSOLLL5",104,0)
 S FLG4=$G(^TMP($J,"PSOAPT",4,1))
"RTN","PSOLLL5",105,0)
 S FLG5=$G(^TMP($J,"PSOAPT",5,1))
"RTN","PSOLLL5",106,0)
 I CCC="",FLG3="",FLG4="",FLG5="" S ^TMP($J,"PSOAPT",2,1)="No Assessment Made" K ^TMP($J,"PSOAPT",3)
"RTN","PSOLLL5",107,0)
 Q
"RTN","PSOLLL7")
0^5^B33639732^B34122114
"RTN","PSOLLL7",1,0)
PSOLLL7 ;BHAM/JLC - LASER LABEL MULTI RX REFILL REQUEST FORM ;12/12/92
"RTN","PSOLLL7",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**120,161,200,326**;DEC 1997;Build 11
"RTN","PSOLLL7",3,0)
 ;
"RTN","PSOLLL7",4,0)
 ;Reference to ^PS(59.7 supported by DBIA 694
"RTN","PSOLLL7",5,0)
 ;Reference to ^PS(55 supported by DBIA 2228
"RTN","PSOLLL7",6,0)
 ;Read-only reference to %ZIS(2 supported by DBIA 3435
"RTN","PSOLLL7",7,0)
 ;
"RTN","PSOLLL7",8,0)
EN D MAIL
"RTN","PSOLLL7",9,0)
 I $G(PSOIO("PII"))]"" X PSOIO("PII")
"RTN","PSOLLL7",10,0)
 S T="Use the adhesive label above to mail prescription" D PRINT(T)
"RTN","PSOLLL7",11,0)
 S T="documents to your pharmacy." D PRINT(T)
"RTN","PSOLLL7",12,0)
REFILL Q:'DFN  S PS1=$G(^PS(59,PSOSITE,1)),PSOSITE7=$G(^("IB")),PSOSYS=$G(^PS(59.7,1,40.1))
"RTN","PSOLLL7",13,0)
 I '$D(PSSPND) F PSRX=0:0 S PSRX=$O(RX(PSRX)) Q:'PSRX  K RX(PSRX)
"RTN","PSOLLL7",14,0)
 S BLNKLIN="",$P(BLNKLIN,"_",45)="_"
"RTN","PSOLLL7",15,0)
 F PSRX=0:0 S PSRX=$O(^PS(55,DFN,"P",PSRX)) Q:'PSRX  D RZX
"RTN","PSOLLL7",16,0)
 ;NEW LABEL
"RTN","PSOLLL7",17,0)
 S PSOX=0
"RTN","PSOLLL7",18,0)
DOCNEW I $G(PSOIO("RPI"))]"" X PSOIO("RPI")
"RTN","PSOLLL7",19,0)
 S PSOYI=PSOTYI,PSOX=PSOLX,ORIGY=PSOY
"RTN","PSOLLL7",20,0)
 D HDR S PSA=0
"RTN","PSOLLL7",21,0)
 F J=1:1 S PSA=$O(RX(PSA)) Q:'PSA  D SCRPTNEW
"RTN","PSOLLL7",22,0)
 I $O(RX(0))="" G EXIT
"RTN","PSOLLL7",23,0)
 I PSOY=ORIGY G EXIT
"RTN","PSOLLL7",24,0)
 S PSOYI=PSOSYI,T=BLNKLIN D PRINT(T) S PSOYI=PSOTYI
"RTN","PSOLLL7",25,0)
 S PS=$S($D(^PS(59,PSOSITE,0)):^(0),1:"")
"RTN","PSOLLL7",26,0)
 S T="Patient's Signature & Date        "_$P(PS,"^",6)_"     "_PSONOW D PRINT(T)
"RTN","PSOLLL7",27,0)
EXIT K PSINF,AMC,PSA,PSDFN,PSDO,PSDT2,PSRFL,PSRX,PSLN,PSRXX,PSSS,PSST,PSOCR,DIWL,DIWR,DIWF,PSO9
"RTN","PSOLLL7",28,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","PSOLLL7",29,0)
 Q
"RTN","PSOLLL7",30,0)
SCRPTNEW S T="____"_$$ZZ^PSOSUTL(PSA) K ZDRUG D PRINT(T) S PSOYI=PSOTYI
"RTN","PSOLLL7",31,0)
 D DTCONNW
"RTN","PSOLLL7",32,0)
 S PSOYI=PSOTYI,OPSOX=PSOX,PSOX=PSOX+PSOXI,T="Refills "_$P(RX(PSA),"^",2)_"   Exp "_PSDT2_"    Rx# "_$P(^PSRX(PSA,0),"^") K TN D PRINT(T)
"RTN","PSOLLL7",33,0)
 S PSOYI=PSOBYI
"RTN","PSOLLL7",34,0)
 I $G(PSOIO("SBT"))]"" X PSOIO("SBT")
"RTN","PSOLLL7",35,0)
 S X2=PSOINST_"-"_PSA,PSOX=PSOX+PSOXI
"RTN","PSOLLL7",36,0)
 W X2
"RTN","PSOLLL7",37,0)
 I $G(PSOIO("EBT"))]"" X PSOIO("EBT")
"RTN","PSOLLL7",38,0)
 S PSOX=OPSOX
"RTN","PSOLLL7",39,0)
 I PSOY>PSOYM D  D:$O(RX(PSA)) HDR Q
"RTN","PSOLLL7",40,0)
 .S T=BLNKLIN,PSOYI=PSOSYI D PRINT(T) S PSOYI=PSOTYI
"RTN","PSOLLL7",41,0)
 .S T="Patient's Signature & Date         "_$P(PS,"^",6)_"     "_PSONOW D PRINT(T)
"RTN","PSOLLL7",42,0)
 .S PSOY=ORIGY,PSOYI=PSOTYI
"RTN","PSOLLL7",43,0)
 .I PSOX=PSORX S PSOX=PSOLX W @IOF Q
"RTN","PSOLLL7",44,0)
 .S PSOX=PSORX
"RTN","PSOLLL7",45,0)
 Q
"RTN","PSOLLL7",46,0)
DTCONNW S PSDT2=$P(RX(PSA),"^"),PSDT2=$E(PSDT2,4,5)_"/"_$E(PSDT2,6,7)_"/"_($E(PSDT2,1,3)+1700) Q
"RTN","PSOLLL7",47,0)
RFILL2 F AMC=0:0 S AMC=$O(^PSRX(PSRXX,1,AMC)) Q:'AMC  S PSRFL=PSRFL-1
"RTN","PSOLLL7",48,0)
 I PSRFL>0 S X1=DT,X2=$P(^PSRX(PSRXX,0),"^",8)-10 D C^%DTC I X'<$P(^(2),"^",6) S PSRFL=0
"RTN","PSOLLL7",49,0)
 Q
"RTN","PSOLLL7",50,0)
RZX S PSRXX=+^PS(55,DFN,"P",PSRX,0)
"RTN","PSOLLL7",51,0)
 I $D(^PSRX(PSRXX,0)) S PSRFL=$P(^(0),"^",9) D:$D(^(1))&PSRFL RFILL2 I PSRFL>0,$P($G(^PSRX(PSRXX,"STA")),"^")<10,134'[$E(+$P($G(^("STA")),"^")),$P(^(2),"^",6)>DT S RX(PSRXX)=$P(^(2),"^",6)_"^"_PSRFL
"RTN","PSOLLL7",52,0)
 Q
"RTN","PSOLLL7",53,0)
HDR S T=PNM D PRINT(T)
"RTN","PSOLLL7",54,0)
 D ADD^VADPT
"RTN","PSOLLL7",55,0)
 I $G(VAPA(1))="" G HDR5
"RTN","PSOLLL7",56,0)
 F I=1:1:3 I $G(VAPA(I))]"" S T=VAPA(I) D PRINT(T)
"RTN","PSOLLL7",57,0)
 S A=+$G(VAPA(5)) I A S A=$S($D(^DIC(5,A,0)):$P(^(0),"^",2),1:"UNKNOWN")
"RTN","PSOLLL7",58,0)
 S B=$G(VAPA(4))_", "_A_"  "_$S($G(VAPA(11)):$P(VAPA(11),"^",2),1:$G(VAPA(6)))
"RTN","PSOLLL7",59,0)
 S T=B D PRINT(T)
"RTN","PSOLLL7",60,0)
HDR5 I $O(RX(0))="" D  S PSOY=PSOY+PSOYI Q
"RTN","PSOLLL7",61,0)
 .S PSOY=PSOY+PSOYI,T="You have no refillable prescriptions as of "_PSONOW_"." D PRINT(T)
"RTN","PSOLLL7",62,0)
 .S T="Please contact your provider if you need new prescriptions." D PRINT(T)
"RTN","PSOLLL7",63,0)
 .I '$D(PSOINST) D SITE
"RTN","PSOLLL7",64,0)
 .S PS=$S($D(^PS(59,PSOSITE,0)):^(0),1:"")
"RTN","PSOLLL7",65,0)
 .S OPSOX=PSOX,OPSOY=PSOY,T=$P(PS,"^",6) S PSOX=2300,PSOY=3900 D PRINT(T) S PSOX=OPSOX,PSOY=OPSOY
"RTN","PSOLLL7",66,0)
ADD S PSOY=PSOY+PSOYI,T="Please check prescriptions to be refilled, sign the form, then" D PRINT(T)
"RTN","PSOLLL7",67,0)
 S T="mail or return to your pharmacy." D PRINT(T) S PSOY=PSOY+PSOYI
"RTN","PSOLLL7",68,0)
 Q
"RTN","PSOLLL7",69,0)
MAIL ;PRINT MAILING ADHESIVE LABEL
"RTN","PSOLLL7",70,0)
 S PS=$S($D(^PS(59,PSOSITE,0)):^(0),1:"")
"RTN","PSOLLL7",71,0)
 I $P(PSOSYS,"^",4),$D(^PS(59,+$P($G(PSOSYS),"^",4),0)) S PS=^PS(59,$P($G(PSOSYS),"^",4),0)
"RTN","PSOLLL7",72,0)
 S VAADDR1=$P(PS,"^"),VASTREET=$P(PS,"^",2),STATE=$S($D(^DIC(5,+$P(PS,"^",8),0)):$P(^(0),"^",2),1:"UNKNOWN")
"RTN","PSOLLL7",73,0)
 S PSZIP=$P(PS,"^",5),PSOHZIP=$S(PSZIP["-":PSZIP,1:$E(PSZIP,1,5)_$S($E(PSZIP,6,9)]"":"-"_$E(PSZIP,6,9),1:""))
"RTN","PSOLLL7",74,0)
 I $G(PSOIO("MLI"))]"" X PSOIO("MLI")
"RTN","PSOLLL7",75,0)
 I $G(PSOIO("PSOFONT"))]"" X PSOIO("PSOFONT")
"RTN","PSOLLL7",76,0)
 S TEXT="Attn: (119)" D PRINT(TEXT)
"RTN","PSOLLL7",77,0)
 S TEXT=VAADDR1 D PRINT(TEXT)
"RTN","PSOLLL7",78,0)
 S TEXT=$G(VASTREET) D PRINT(TEXT)
"RTN","PSOLLL7",79,0)
 S TEXT=$P(PS,"^",7)_", "_$G(STATE)_"  "_$G(PSOHZIP) D PRINT(TEXT)
"RTN","PSOLLL7",80,0)
 Q
"RTN","PSOLLL7",81,0)
PRINT(T) ;
"RTN","PSOLLL7",82,0)
 I $G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLL7",83,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSOLLL7",84,0)
 W T,!
"RTN","PSOLLL7",85,0)
 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSOLLL7",86,0)
 Q
"RTN","PSOLLL7",87,0)
QUEUE ; ENTRY POINT TO PRINT STAND-ALONE MULTI-RX FORM
"RTN","PSOLLL7",88,0)
 S SAVDFN=$D(DFN) ; DFN SET IF COMING FROM HIDDEN ACTION
"RTN","PSOLLL7",89,0)
 I '$D(PSOPAR) D ^PSOLSET I '$D(PSOPAR) Q
"RTN","PSOLLL7",90,0)
 I '$G(PSOSYS) S PSOSYS=$G(^PS(59.7,1,40.1))
"RTN","PSOLLL7",91,0)
 I '$D(PSOINST) D SITE
"RTN","PSOLLL7",92,0)
 W !
"RTN","PSOLLL7",93,0)
 I $D(DFN) G GETPT2
"RTN","PSOLLL7",94,0)
GETPT S DIC("A")="Enter patient to reprint Multi-Rx refill form for: ",DIC(0)="QEAM" D EN^PSOPATLK S Y=PSOPTLK I Y<0!("^"[X) K PSOPTLK,DIC Q
"RTN","PSOLLL7",95,0)
 S DFN=$P(Y,"^")
"RTN","PSOLLL7",96,0)
GETPT2 D DEM^VADPT S PNM=VADM(1)
"RTN","PSOLLL7",97,0)
 I $P(VADM(6),"^",2)]"" D  G GETPT
"RTN","PSOLLL7",98,0)
 .W $C(7),!!,PNM_" Died "_$P(VADM(6),"^",2)_".",!
"RTN","PSOLLL7",99,0)
Q1 W ! K POP,ZTSK S %ZIS("B")="",%ZIS="MNQ",%ZIS("A")="Select LABEL DEVICE: " D ^%ZIS S PSLION=ION K %ZIS("A")
"RTN","PSOLLL7",100,0)
 I $G(POP) Q
"RTN","PSOLLL7",101,0)
 I $G(IOST(0)),'$D(^%ZIS(2,IOST(0),55,"B","LL")) W !,"Must specify a laser labels printer for Multi-Rx form." G Q1
"RTN","PSOLLL7",102,0)
 I '$G(IOST(0)) W !,"Nothing queued to print." H 1 Q
"RTN","PSOLLL7",103,0)
 D 6^VADPT,PID^VADPT6 S SSNP=""
"RTN","PSOLLL7",104,0)
 D NOW^%DTC S Y=$P(%,"."),PSOFNOW=% X ^DD("DD") S PSONOW=Y
"RTN","PSOLLL7",105,0)
 F G="DFN","PNM","PSOPAR","PSOSITE","SSNP","PSONOW","PSOSYS","PSOINST" S:$D(@G) ZTSAVE(G)=""
"RTN","PSOLLL7",106,0)
 S ZTRTN="DQ^PSOLLL7",ZTIO=PSLION,ZTDESC="Outpatient Pharmacy Multi-Rx print",ZTDTH=$H,PDUZ=DUZ
"RTN","PSOLLL7",107,0)
 D ^%ZISC,^%ZTLOAD W:$D(ZTSK) !!,"Multi-Rx form queued to print",!! H 1 K G
"RTN","PSOLLL7",108,0)
 I $G(SAVDFN)=0 K DFN,SAVDFN
"RTN","PSOLLL7",109,0)
 Q
"RTN","PSOLLL7",110,0)
DQ N PSOBIO S (I,PSOIO)=0 F  S I=$O(^%ZIS(2,IOST(0),55,I)) Q:'I  S X0=$G(^(I,0)) I X0]"" S PSOIO($P(X0,"^"))=^(1),PSOIO=1
"RTN","PSOLLL7",111,0)
 I $G(PSOIO("LLI"))]"" X PSOIO("LLI")
"RTN","PSOLLL7",112,0)
 G EN
"RTN","PSOLLL7",113,0)
SITE ;
"RTN","PSOLLL7",114,0)
 K ^UTILITY("DIQ1",$J) S DA=$P($$SITE^VASITE(),"^")
"RTN","PSOLLL7",115,0)
 I $G(DA)>0 S DIC=4,DIQ(0)="I",DR="99" D EN^DIQ1 S PSOINST=$G(^UTILITY("DIQ1",$J,4,DA,99,"I")) K ^UTILITY("DIQ1",$J),DA,DR,DIC
"RTN","PSOLLL7",116,0)
 I '$D(PSOINST) S PSOINST=""
"RTN","PSOLLL7",117,0)
 Q
"RTN","PSOLLLH")
0^48^B33342712^B33423186
"RTN","PSOLLLH",1,0)
PSOLLLH ;BIR/EJW - HIPAA/NCPDP LASER LABELS ;7/20/06 10:21am
"RTN","PSOLLLH",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**161,148,244,200,326**;DEC 1997;Build 11
"RTN","PSOLLLH",3,0)
 ;
"RTN","PSOLLLH",4,0)
 ;Reference to DUR1^BPSNCPD3 supported by DBIA 4560
"RTN","PSOLLLH",5,0)
 ;
"RTN","PSOLLLH",6,0)
 ;*244 ignore Rx status > 11
"RTN","PSOLLLH",7,0)
 ;
"RTN","PSOLLLH",8,0)
SIGLOG N PSOSEQ,J,RXF,RXY,RXN,RX,FIRST,DATE,BLNKLIN,RX2,FDT,BLNKLN2,LAST,CNT
"RTN","PSOLLLH",9,0)
 D DEM^VADPT
"RTN","PSOLLLH",10,0)
 S FIRST=1,LAST=0
"RTN","PSOLLLH",11,0)
 I '$G(REPRINT) D NOWINDOW I NOWIN Q
"RTN","PSOLLLH",12,0)
 K NOWIN
"RTN","PSOLLLH",13,0)
 S $P(BLNKLN2," ",32)=" "
"RTN","PSOLLLH",14,0)
 S $P(BLNKLIN,"_",32)="_"
"RTN","PSOLLLH",15,0)
 F PSOSEQ=1:1:$L(PPL,",") S RX=$P(PPL,",",PSOSEQ) D
"RTN","PSOLLLH",16,0)
 .I RX="" Q
"RTN","PSOLLLH",17,0)
 .Q:$G(^PSRX(RX,"STA"))>11                           ;*244
"RTN","PSOLLLH",18,0)
 .S RXY=$G(^PSRX(RX,0)) I RXY="" Q
"RTN","PSOLLLH",19,0)
 .S CNT=$G(CNT)+1
"RTN","PSOLLLH",20,0)
 .S RX2=$G(^PSRX(RX,2)),FDT=$P(RX2,"^",2)
"RTN","PSOLLLH",21,0)
 .I FIRST!(CNT#4=1) D HDR,BARC S FIRST=0
"RTN","PSOLLLH",22,0)
 .S RXF=+$O(^PSRX(RX,1,"A"),-1)
"RTN","PSOLLLH",23,0)
 .I RXF>0 I +^PSRX(RX,1,RXF,0)'<FDT S FDT=+^(0)
"RTN","PSOLLLH",24,0)
 .S DATE=$E(FDT,1,7),Y=DATE X ^DD("DD") S DATE=Y
"RTN","PSOLLLH",25,0)
 .S RXN=$P(RXY,"^")
"RTN","PSOLLLH",26,0)
 .S T=RXN_" ("_(RXF)_") "
"RTN","PSOLLLH",27,0)
 .N PSODRNM
"RTN","PSOLLLH",28,0)
 .S PSODRNM=$$ZZ^PSOSUTL(RX)
"RTN","PSOLLLH",29,0)
 .S T=T_$E(FDT,4,5)_"/"_$E(FDT,6,7)_"/"_$E(FDT,2,3)_" "_$E(PSODRNM,1,(27-$L(RXN))) D PRINT(T)
"RTN","PSOLLLH",30,0)
 S LAST=1 D SIGN
"RTN","PSOLLLH",31,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","PSOLLLH",32,0)
 Q
"RTN","PSOLLLH",33,0)
 ;
"RTN","PSOLLLH",34,0)
SIGN ;
"RTN","PSOLLLH",35,0)
 I '$G(CNT) Q
"RTN","PSOLLLH",36,0)
 N II
"RTN","PSOLLLH",37,0)
 S II=CNT#4
"RTN","PSOLLLH",38,0)
 I LAST,II>0 F J=1:1:(4-II) S T=" " D PRINT(T)
"RTN","PSOLLLH",39,0)
 S PSOY=PSOY+10
"RTN","PSOLLLH",40,0)
 S T="Pt. Sig."_BLNKLIN D PRINT(T)
"RTN","PSOLLLH",41,0)
 S PSOY=PSOY+5
"RTN","PSOLLLH",42,0)
 D PRINT($$PLANNM())
"RTN","PSOLLLH",43,0)
 S PSOY=PSOY+15
"RTN","PSOLLLH",44,0)
 S T="Relation_____ Counseling Refused__ Accepted__" D PRINT(T)
"RTN","PSOLLLH",45,0)
 S PSOY=PSOY+10
"RTN","PSOLLLH",46,0)
 S T=PNM_"  "_$G(SSNP) D PRINT(T,1)
"RTN","PSOLLLH",47,0)
 Q
"RTN","PSOLLLH",48,0)
 ;
"RTN","PSOLLLH",49,0)
HDR ;
"RTN","PSOLLLH",50,0)
 I 'FIRST D SIGN W @IOF
"RTN","PSOLLLH",51,0)
 I $G(PSOIO("BLH"))]"" X PSOIO("BLH")
"RTN","PSOLLLH",52,0)
 S T="VAMC "_$P(PS,"^",7)_", "_STATE_" "_$G(PSOHZIP) D PRINT(T)
"RTN","PSOLLLH",53,0)
 S T=$P(PS2,"^",2)_"  Ph: "_$P(PS,"^",3)_"-"_$P(PS,"^",4)_"       "_$G(PSONOW) D PRINT(T)
"RTN","PSOLLLH",54,0)
 I $G(PSOIO("BLB"))]"" X PSOIO("BLB")
"RTN","PSOLLLH",55,0)
 S XFONT=$E(PSOFONT,2,99)
"RTN","PSOLLLH",56,0)
 N REPMSG
"RTN","PSOLLLH",57,0)
 S REPMSG=BLNKLN2_"(REPRINT)"
"RTN","PSOLLLH",58,0)
 S T="By signing below"_$S($G(REPRINT):REPMSG,1:"") D PRINT(T,1)
"RTN","PSOLLLH",59,0)
 S T="you acknowledge receipt of the following Rx's" D PRINT(T,1)
"RTN","PSOLLLH",60,0)
 S T=" " D PRINT(T)
"RTN","PSOLLLH",61,0)
 S PSOY=PSOY-20
"RTN","PSOLLLH",62,0)
 Q
"RTN","PSOLLLH",63,0)
 ;
"RTN","PSOLLLH",64,0)
PRINT(T,B) ;
"RTN","PSOLLLH",65,0)
 S BOLD=$G(B)
"RTN","PSOLLLH",66,0)
 I 'BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT)
"RTN","PSOLLLH",67,0)
 I BOLD,$G(PSOIO(PSOFONT_"B"))]"" X PSOIO(PSOFONT_"B")
"RTN","PSOLLLH",68,0)
 I $G(PSOIO("ST"))]"" X PSOIO("ST")
"RTN","PSOLLLH",69,0)
 W T,!
"RTN","PSOLLLH",70,0)
 I $G(PSOIO("ET"))]"" X PSOIO("ET")
"RTN","PSOLLLH",71,0)
 I BOLD,$G(PSOIO(PSOFONT))]"" X PSOIO(PSOFONT) ;TURN OFF BOLDING
"RTN","PSOLLLH",72,0)
 Q
"RTN","PSOLLLH",73,0)
 ;
"RTN","PSOLLLH",74,0)
QUEUE ; ENTRY POINT TO REPRINT SIGNATURE LOG
"RTN","PSOLLLH",75,0)
 I '$D(PSOPAR) D ^PSOLSET I '$D(PSOPAR) Q
"RTN","PSOLLLH",76,0)
 N REPRINT,PS,STATE,PS2,PSOHZIP
"RTN","PSOLLLH",77,0)
 S PS=$S($D(^PS(59,PSOSITE,0)):^(0),1:"")
"RTN","PSOLLLH",78,0)
 S PS2=$P(PS,"^")_"^"_$P(PS,"^",6)
"RTN","PSOLLLH",79,0)
 I $P(PSOSYS,"^",4),$D(^PS(59,+$P($G(PSOSYS),"^",4),0)) S PS=^PS(59,$P($G(PSOSYS),"^",4),0)
"RTN","PSOLLLH",80,0)
 S VAADDR1=$P(PS,"^"),VASTREET=$P(PS,"^",2),STATE=$S($D(^DIC(5,+$P(PS,"^",8),0)):$P(^(0),"^",2),1:"UNKNOWN")
"RTN","PSOLLLH",81,0)
 S PSZIP=$P(PS,"^",5),PSOHZIP=$S(PSZIP["-":PSZIP,1:$E(PSZIP,1,5)_$S($E(PSZIP,6,9)]"":"-"_$E(PSZIP,6,9),1:""))
"RTN","PSOLLLH",82,0)
 S REPRINT=1
"RTN","PSOLLLH",83,0)
LRP W !! S DIC("S")="I $P($G(^(0)),""^"",2),$D(^(""STA"")),$P($G(^(""STA"")),""^"")<10",DIC="^PSRX(",DIC("A")="Reprint Signature Log for Prescription: ",DIC(0)="QEAZ" D ^DIC K P,DIC("A") I Y<0!("^"[X) D KILL Q
"RTN","PSOLLLH",84,0)
 W !
"RTN","PSOLLLH",85,0)
 S (PPL,RX)=+Y
"RTN","PSOLLLH",86,0)
 N RXY
"RTN","PSOLLLH",87,0)
 S RXY=$G(^PSRX(RX,0)) I RXY="" Q
"RTN","PSOLLLH",88,0)
 S DFN=$P(RXY,"^",2)
"RTN","PSOLLLH",89,0)
GETPT2 D DEM^VADPT S PNM=VADM(1)
"RTN","PSOLLLH",90,0)
 I $P(VADM(6),"^",2)]"" D  G LRP
"RTN","PSOLLLH",91,0)
 .W $C(7),!!,PNM_" Died "_$P(VADM(6),"^",2)_".",!
"RTN","PSOLLLH",92,0)
 D 6^VADPT,PID^VADPT6 S SSNP=""
"RTN","PSOLLLH",93,0)
Q1 W ! K POP,ZTSK S %ZIS("B")="",%ZIS="MNQ",%ZIS("A")="Select LABEL DEVICE: " D ^%ZIS S PSLION=ION K %ZIS("A")
"RTN","PSOLLLH",94,0)
 I $G(POP) Q
"RTN","PSOLLLH",95,0)
 I $G(IOST(0)),'$D(^%ZIS(2,IOST(0),55,"B","LL")) W !,"Must specify a laser labels printer for Signature Log Reprint" G Q1
"RTN","PSOLLLH",96,0)
 I '$G(IOST(0)) W !,"Nothing queued to print." H 1 Q
"RTN","PSOLLLH",97,0)
 D NOW^%DTC S Y=$P(%,"."),PSOFNOW=% X ^DD("DD") S PSONOW=Y
"RTN","PSOLLLH",98,0)
 F G="PPL","REPRINT","PNM","STATE","PS2","PSOHZIP","PSOPAR","PSOSITE","PS","PSONOW","PSOSYS","SSNP" S:$D(@G) ZTSAVE(G)=""
"RTN","PSOLLLH",99,0)
 S ZTRTN="DQ^PSOLLLH",ZTIO=PSLION,ZTDESC="Outpatient Pharmacy Signature Log Reprint",ZTDTH=$H,PDUZ=DUZ
"RTN","PSOLLLH",100,0)
 D ^%ZISC,^%ZTLOAD W:$D(ZTSK) !!,"Signature Log Reprint queued",!! H 1 K G
"RTN","PSOLLLH",101,0)
 G QUEUE
"RTN","PSOLLLH",102,0)
 Q
"RTN","PSOLLLH",103,0)
DQ N PSOBIO S (I,PSOIO)=0 F  S I=$O(^%ZIS(2,IOST(0),55,I)) Q:'I  S X0=$G(^(I,0)) I X0]"" S PSOIO($P(X0,"^"))=^(1),PSOIO=1
"RTN","PSOLLLH",104,0)
 I $G(PSOIO("LLI"))]"" X PSOIO("LLI")
"RTN","PSOLLLH",105,0)
 G SIGLOG
"RTN","PSOLLLH",106,0)
 ;
"RTN","PSOLLLH",107,0)
PLANNM() ; Returns Insurance Name (3rd Party)
"RTN","PSOLLLH",108,0)
 S PLANNM=""
"RTN","PSOLLLH",109,0)
 N I,DUR,RX
"RTN","PSOLLLH",110,0)
 F I=1:1:$L(PPL,",") S RX=+$P(PPL,",",I) D  I PLANNM'="" Q
"RTN","PSOLLLH",111,0)
 .I 'RX Q
"RTN","PSOLLLH",112,0)
 .D DUR1^BPSNCPD3(RX,$$LSTRFL^PSOBPSU1(RX),.DUR) S PLANNM=$G(DUR(1,"INSURANCE NAME"))
"RTN","PSOLLLH",113,0)
 Q PLANNM
"RTN","PSOLLLH",114,0)
BARC I '$G(FIRST) G BARCE ; PRINT BARCODE FOR 1 RX ON 1ST SIGLOG LABEL ONLY
"RTN","PSOLLLH",115,0)
 I $G(PSOIO("BLBC"))]"" X PSOIO("BLBC") I $G(NOBARC) G BARCE
"RTN","PSOLLLH",116,0)
 I '$D(PSOINST) D INST
"RTN","PSOLLLH",117,0)
 S X2=PSOINST_"-"_RX W X2
"RTN","PSOLLLH",118,0)
 I $G(PSOIO("EBLBC"))]"" X PSOIO("EBLBC")
"RTN","PSOLLLH",119,0)
BARCE Q
"RTN","PSOLLLH",120,0)
 ;
"RTN","PSOLLLH",121,0)
KILL ; CLEAN UP VARIABLES
"RTN","PSOLLLH",122,0)
 K DIC,DFN,PNM,PPL,PSZIP,RX,SSNP,VA,VADDR1,VADM,VAEL,VAPA,VASTREET
"RTN","PSOLLLH",123,0)
 Q
"RTN","PSOLLLH",124,0)
INST ;
"RTN","PSOLLLH",125,0)
 K ^UTILITY("DIQ1",$J) S DA=$P($$SITE^VASITE(),"^")
"RTN","PSOLLLH",126,0)
 I $G(DA) S DIC=4,DIQ(0)="I",DR="99" D EN^DIQ1 S PSOINST=$G(^UTILITY("DIQ1",$J,4,DA,99,"I"))
"RTN","PSOLLLH",127,0)
 K ^UTILITY("DIQ1",$J),DA,DR,DIC
"RTN","PSOLLLH",128,0)
 Q
"RTN","PSOLLLH",129,0)
 ;
"RTN","PSOLLLH",130,0)
NOWINDOW ; ON ORIGINAL PRINT - DON'T PRINT IF ALL ARE MAIL
"RTN","PSOLLLH",131,0)
 N I,RX,RXF,MW,RXP,RXY
"RTN","PSOLLLH",132,0)
 S NOWIN=1
"RTN","PSOLLLH",133,0)
 F I=1:1:$L(PPL,",") S RX=$P(PPL,",",I) D  I 'NOWIN Q
"RTN","PSOLLLH",134,0)
 .I RX="" Q
"RTN","PSOLLLH",135,0)
 .I $G(^PSRX(RX,"STA"))>11 Q
"RTN","PSOLLLH",136,0)
 .S RXY=$G(^PSRX(RX,0)) I RXY="" Q
"RTN","PSOLLLH",137,0)
 .I '$D(^PSRX(RX,1)) S MW=$P(RXY,"^",11) I MW="W" S NOWIN=0 Q
"RTN","PSOLLLH",138,0)
 .S RXF=$O(^PSRX(RX,1,99),-1) I RXF>0 S MW=$P($G(^PSRX(RX,1,RXF,0)),"^",2) I MW="W" S NOWIN=0
"RTN","PSOLLLH",139,0)
 .S RXP=$O(^PSRX(RX,"P",99),-1) I RXP>0 S MW=$P($G(^PSRX(RX,"P",RXP,0)),"^",2) I MW="W" S NOWIN=0
"RTN","PSOLLLH",140,0)
 Q
"RTN","PSOLLLHN")
0^49^B9141187^B9172755
"RTN","PSOLLLHN",1,0)
PSOLLLHN ;BIR/SJA - HIPAA/NCPDP LASER LABELS ;2/21/07 10:21am
"RTN","PSOLLLHN",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**200,268,326**;DEC 1997;Build 11
"RTN","PSOLLLHN",3,0)
 ;
"RTN","PSOLLLHN",4,0)
 ;*244 ignore Rx status > 11
"RTN","PSOLLLHN",5,0)
 ;
"RTN","PSOLLLHN",6,0)
ST ; ENTRY POINT TO SPEED SIGNATURE LOG REPRINT
"RTN","PSOLLLHN",7,0)
 I '$D(PSOPAR) D ^PSOLSET I '$D(PSOPAR) Q
"RTN","PSOLLLHN",8,0)
 N REPRINT,PS,STATE,PS2,PSOHZIP,PSODISP,PSOOELSE,PSOIEN,VALMCNT
"RTN","PSOLLLHN",9,0)
 S PS=$S($D(^PS(59,PSOSITE,0)):^(0),1:"")
"RTN","PSOLLLHN",10,0)
 S PS2=$P(PS,"^")_"^"_$P(PS,"^",6)
"RTN","PSOLLLHN",11,0)
 I $P(PSOSYS,"^",4),$D(^PS(59,+$P($G(PSOSYS),"^",4),0)) S PS=^PS(59,$P($G(PSOSYS),"^",4),0)
"RTN","PSOLLLHN",12,0)
 S VAADDR1=$P(PS,"^"),VASTREET=$P(PS,"^",2),STATE=$S($D(^DIC(5,+$P(PS,"^",8),0)):$P(^(0),"^",2),1:"UNKNOWN")
"RTN","PSOLLLHN",13,0)
 S PSZIP=$P(PS,"^",5),PSOHZIP=$S(PSZIP["-":PSZIP,1:$E(PSZIP,1,5)_$S($E(PSZIP,6,9)]"":"-"_$E(PSZIP,6,9),1:""))
"RTN","PSOLLLHN",14,0)
 D 6^VADPT,PID^VADPT6 S SSNP=""
"RTN","PSOLLLHN",15,0)
 S REPRINT=1
"RTN","PSOLLLHN",16,0)
 I '$G(PSOCNT) S VALMSG="This patient has no Prescriptions!" S VALMBCK="" Q
"RTN","PSOLLLHN",17,0)
OS K DIR,DUOUT,DIRUT S DIR("A")="Select Orders by number",DIR(0)="LO^1:"_PSOCNT D ^DIR S LST=Y I $D(DTOUT)!($D(DUOUT)) K DIR,DIRUT,DTOUT,DUOUT S VALMBCK="" Q
"RTN","PSOLLLHN",18,0)
 K DIR,DIRUT,DTOUT,PSOOELSE,PSOREPX I '+LST D KILL S VALMBCK="" Q
"RTN","PSOLLLHN",19,0)
 S PSOOELSE=1 D FULL^VALM1
"RTN","PSOLLLHN",20,0)
Q1 K POP,ZTSK S %ZIS("B")="",%ZIS="MNQ",%ZIS("A")="Select LABEL DEVICE: " D ^%ZIS S PSLION=ION K %ZIS("A")
"RTN","PSOLLLHN",21,0)
 I $G(POP) S VALMBCK="R",VALMSG="No Labels Reprinted." Q
"RTN","PSOLLLHN",22,0)
 I $G(IOST(0)),'$D(^%ZIS(2,IOST(0),55,"B","LL")) W !,"Must specify a laser labels printer for Signature Log Reprint" G Q1
"RTN","PSOLLLHN",23,0)
 I '$G(IOST(0)) S VALMBCK="R",VALMSG="Nothing queued to print." Q
"RTN","PSOLLLHN",24,0)
 D DEM^VADPT S PNM=VADM(1)
"RTN","PSOLLLHN",25,0)
 I $P(VADM(6),"^",2)]"" D  G OS
"RTN","PSOLLLHN",26,0)
 .W $C(7),!!,PNM_" Died "_$P(VADM(6),"^",2)_".",!
"RTN","PSOLLLHN",27,0)
 S PPL="" F ORD=1:1:$L(LST,",") Q:$P(LST,",",ORD)']""  S ORN=$P(LST,",",ORD),PSOIEN=$P(PSOLST(ORN),"^",2) D
"RTN","PSOLLLHN",28,0)
 .I '$P($G(^PSRX(PSOIEN,0)),"^",2)!($G(^("STA"),"^")>11) Q
"RTN","PSOLLLHN",29,0)
 .I $P($G(^PSRX(PSOIEN,0)),"^",2) S PPL=$S(PPL:PPL_",",1:"")_PSOIEN
"RTN","PSOLLLHN",30,0)
 .S VALMBCK="R"
"RTN","PSOLLLHN",31,0)
 I +PPL D QUEUE W:$D(ZTSK) !!,"Signature Log Reprint queued",!! H 1
"RTN","PSOLLLHN",32,0)
 I '$G(PSOOELSE) S VALMBCK=""
"RTN","PSOLLLHN",33,0)
 D ^PSOBUILD
"RTN","PSOLLLHN",34,0)
 D KILL D KVA^VADPT
"RTN","PSOLLLHN",35,0)
 Q
"RTN","PSOLLLHN",36,0)
QUEUE D NOW^%DTC S Y=$P(%,"."),PSOFNOW=% X ^DD("DD") S PSONOW=Y
"RTN","PSOLLLHN",37,0)
 F G="PPL","REPRINT","PNM","STATE","PS2","PSOHZIP","PSOPAR","PSOSITE","PS","PSONOW","PSOSYS","RX","SSNP" S:$D(@G) ZTSAVE(G)=""
"RTN","PSOLLLHN",38,0)
 S ZTRTN="DQ^PSOLLLH",ZTIO=PSLION,ZTDESC="Outpatient Pharmacy Signature Log Reprint",ZTDTH=$H,PDUZ=DUZ
"RTN","PSOLLLHN",39,0)
 D ^%ZISC,^%ZTLOAD K G
"RTN","PSOLLLHN",40,0)
 Q
"RTN","PSOLLLHN",41,0)
 ;
"RTN","PSOLLLHN",42,0)
KILL ; CLEAN UP VARIABLES
"RTN","PSOLLLHN",43,0)
 K DIC,LST,ORD,ORN,PSOIEN,PNM,PPL,PSZIP,RX,SSNP,VA,VADDR1,VADM,VAEL,VAPA,VASTREET
"RTN","PSOLLLHN",44,0)
 Q
"RTN","PSOLLLI")
0^54^B66532826^B67178881
"RTN","PSOLLLI",1,0)
PSOLLLI ;BIR/JLC - LASER LABELS INITIALIZATION ; 11/20/08 12:17pm
"RTN","PSOLLLI",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**120,157,189,161,244,200,206,225,303,266,326**;DEC 1997;Build 11
"RTN","PSOLLLI",3,0)
 ;
"RTN","PSOLLLI",4,0)
 ;DBIAs PSDRUG-221, PS(55-2228, SC-10040, IBARX-125, PSXSRP-2201, %ZIS-3435, DPT-3097, ^TMP($J,"PSNPPIO"-3794
"RTN","PSOLLLI",5,0)
 ;External reference to DRUG^PSSWRNA supported by DBIA 4449
"RTN","PSOLLLI",6,0)
 ;
"RTN","PSOLLLI",7,0)
 ;*244 remove test for partial fill when testing status > 11
"RTN","PSOLLLI",8,0)
 ;
"RTN","PSOLLLI",9,0)
DQ N PSOBIO S (I,PSOIO)=0 F  S I=$O(^%ZIS(2,IOST(0),55,I)) Q:'I  S X0=$G(^(I,0)) I X0]"" S PSOIO($P(X0,"^"))=^(1),PSOIO=1
"RTN","PSOLLLI",10,0)
DQ1 I '$D(PPL) G HLEX
"RTN","PSOLLLI",11,0)
 I $P($G(PSOPAR),"^",30)=2,'$G(PSOEXREP) G HLEX
"RTN","PSOLLLI",12,0)
 K RXFLX S PSOCKHN=","_$G(PPL),PSRESOLV=+PPL D CHECK
"RTN","PSOLLLI",13,0)
 S PSOINT=1 F PI=1:1 S RX=$P(PPL,",",PI) Q:RX=""  D
"RTN","PSOLLLI",14,0)
 . S RXY=$G(^PSRX(RX,0)) Q:RXY=""  I PSOPDFN'=$P(RXY,"^",2),'PSOINT D TRAIL^PSOLLL1 S PSOPDFN=$P(RXY,"^",2)
"RTN","PSOLLLI",15,0)
 . K RXP,REPRINT D C
"RTN","PSOLLLI",16,0)
 I 'PSOINT D TRAIL^PSOLLL1
"RTN","PSOLLLI",17,0)
HLEX K RXPI,PSORX,RXP,PSOIOS,PSOLAPPL,XXX,COPAYVAR,TECH,PHYS,MFG,NURSE,STATE,SIDE,COPIES,EXDT,ISD,PSOINST,RXN,RXY,VADT,DEA,WARN,FDT,QTY,PATST,PDA,PS,PS1,RXP,REPRINT
"RTN","PSOLLLI",18,0)
 K SGY,OSGY,PS2,PSL,PSNP,INRX,RR,XTYPE,SSNP,SSNPN,PNM,ADDR,PSODBQ,PSOLASTF,PSRESOLV,PSOEXREP,PSOSXQ
"RTN","PSOLLLI",19,0)
 K DATE,DR,DRUG,LINE,MW,PRTFL,VRPH,EXPDT,X2,DIFF,DAYS,PSZIP,PSOHZIP,PS55,PS55X
"RTN","PSOLLLI",20,0)
 K ^TMP($J,"PSNPMI"),^TMP($J,"PSOCP",+$G(PSOCPN)),PSOCPN,PSOLBLDR,PSOLBLPS,PSOLBLCP,RXPR,RXRP,RXRS,PSOCKHN,RXFLX,PSOLAPPL,PSOPDFN,PSDFNFLG,PSOZERO,NEXTRX,PSOBLALL,STA
"RTN","PSOLLLI",21,0)
 I '$G(PSOSUREP),'$G(PSOSUSPR) S ZTREQ="@"
"RTN","PSOLLLI",22,0)
 Q
"RTN","PSOLLLI",23,0)
C N PSOBIO S (I,PSOIO)=0 F  S I=$O(^%ZIS(2,IOST(0),55,I)) Q:'I  S X0=$G(^(I,0)) I X0]"" S PSOIO($P(X0,"^"))=^(1),PSOIO=1
"RTN","PSOLLLI",24,0)
 U IO Q:'$D(^PSRX(RX,0))  S RXY=^(0),RX2=^(2),RXSTA=^("STA") K SGY,OSGY
"RTN","PSOLLLI",25,0)
 S (SIGM,PFM,PMIM,L2,L3,L4,L5,FILLCONT,BOTTLBL)=0
"RTN","PSOLLLI",26,0)
 K SIGF,PFF,PMIF S (SIGF,PFF,PMIF)=0 F I="DR","T" S (SIGF(I),PFF(I))=1
"RTN","PSOLLLI",27,0)
 F I="A","B","I" S PMIF(I)=1
"RTN","PSOLLLI",28,0)
 D NOW^%DTC S Y=$P(%,"."),PSOFNOW=% X ^DD("DD") S PSONOW=Y,Y=PSOFNOW X ^DD("DD") S PSONOWT=Y
"RTN","PSOLLLI",29,0)
 S:$G(PSOBLALL) PSOBLRX=RX S:$D(RXRP(RX)) REPRINT=1 S:$D(RXPR(RX)) RXP=RXPR(RX)
"RTN","PSOLLLI",30,0)
 I $G(PSOSUREP)!($G(PSOEXREP)) S REPRINT=1 I '$G(RXRP(RX)) S RXRP(RX)=1
"RTN","PSOLLLI",31,0)
 S A=$P(RXSTA,"^") I A>11 D AL^PSOLBL("QT") K RXP,REPRINT Q      ;*244
"RTN","PSOLLLI",32,0)
 I A=3 D AL^PSOLBL("QT") K RXP,REPRINT Q
"RTN","PSOLLLI",33,0)
 I $G(RXPR(RX)),'$D(^PSRX(RX,"P",RXP,0)) K RXP,REPRINT Q
"RTN","PSOLLLI",34,0)
 I $P($G(RXFL(RX)),"^"),'$D(^PSRX(RX,1,$P($G(RXFL(RX)),"^"),0)) K RXP,REPRINT Q
"RTN","PSOLLLI",35,0)
 I $G(PSODBQ)!($G(RXRS(RX))) S RR=$O(^PS(52.5,"B",RX,0)) Q:'RR  I $G(^PS(52.5,RR,"P"))=1 K RXP,REPRINT Q
"RTN","PSOLLLI",36,0)
 I $G(RXRS(RX))!($G(PSOPULL)) S PSOSXQ=0 N DR,DA,DIE D  I $G(PSOSXQ) K RXP,REPRINT Q
"RTN","PSOLLLI",37,0)
 . S DA=$O(^PS(52.5,"B",RX,0)) Q:'DA
"RTN","PSOLLLI",38,0)
 . S A=$P($G(^PS(52.5,DA,0)),"^",7) I A="" Q
"RTN","PSOLLLI",39,0)
 . I A="Q" S DIE="^PS(52.5,",DR="3////P" D ^DIE Q
"RTN","PSOLLLI",40,0)
 . K RXRS(RX) S PSOSXQ=1
"RTN","PSOLLLI",41,0)
 I $G(PSRESOLV)=RX D ENLBL^PSOBSET K PSRESOLV
"RTN","PSOLLLI",42,0)
 I $P(RXSTA,"^")'=4 D
"RTN","PSOLLLI",43,0)
 . I $G(PSOSUSPR) D AREC^PSOSUTL
"RTN","PSOLLLI",44,0)
 . I $G(PSOPULL)!($G(RXRS(RX))) D AREC1^PSOSUTL
"RTN","PSOLLLI",45,0)
 . I $G(PSOSUREP) D AREC^PSOSUSRP
"RTN","PSOLLLI",46,0)
 . I $G(PSXREP) D AREC^PSXSRP
"RTN","PSOLLLI",47,0)
 S RXY=^PSRX(RX,0),RX2=^(2),RXSTA=^("STA")
"RTN","PSOLLLI",48,0)
 K ^UTILITY("DIQ1",$J) S DA=$P($$SITE^VASITE(),"^")
"RTN","PSOLLLI",49,0)
 I $G(DA) S DIC=4,DIQ(0)="I",DR="99" D EN^DIQ1 S PSOINST=$G(^UTILITY("DIQ1",$J,4,DA,99,"I")) K ^UTILITY("DIQ1",$J),DA,DR,DIC
"RTN","PSOLLLI",50,0)
 S RXN=$P(RXY,"^"),DFN=+$P(RXY,"^",2),PSOLBLPS=+$P(RXY,"^",3),PSOLBLDR=+$P(RXY,"^",6)
"RTN","PSOLLLI",51,0)
 S ISD=$P(RXY,"^",13),RXF=0,SIG=$P($G(^PSRX(RX,"SIG")),"^"),ISD=$E(ISD,4,5)_"/"_$E(ISD,6,7)_"/"_($E(ISD,1,3)+1700),ZY=0,$P(LINE,"_",28)="_"
"RTN","PSOLLLI",52,0)
 S NURSE=$S($P($G(^DPT(DFN,"NHC")),"^")="Y":1,$P($G(^PS(55,DFN,40)),"^"):1,1:0)
"RTN","PSOLLLI",53,0)
 S FDT=$P(RX2,"^",2),PS=$S($D(^PS(59,PSOSITE,0)):^(0),1:""),PS1=$S($D(^(1)):^(1),1:""),PSOSITE7=$P(^("IB"),"^")
"RTN","PSOLLLI",54,0)
 S PS2=$P(PS,"^")_"^"_$P(PS,"^",6)
"RTN","PSOLLLI",55,0)
 S EXPDT=$P(RX2,"^",6),EXDT=$S('EXPDT:"",1:$E(EXPDT,4,5)_"/"_$E(EXPDT,6,7)_"/"_($E(EXPDT,1,3)+1700))
"RTN","PSOLLLI",56,0)
 S COPIES=$S($P($G(RXRP(RX)),"^",2):$P($G(RXRP(RX)),"^",2),$P(RXY,"^",18)]"":$P(RXY,"^",18),1:1)
"RTN","PSOLLLI",57,0)
 K PSOCKHNX S PSOCKHL=$L(RX),PSOCKHN=$E($G(PSOCKHN),(PSOCKHL+2),999) D  K PSOCKHNX,PSOCKHL,PSOCKHA
"RTN","PSOLLLI",58,0)
 .S PSOCKHA=","_RX_","
"RTN","PSOLLLI",59,0)
 .I PSOCKHN'[PSOCKHA Q
"RTN","PSOLLLI",60,0)
 .S PSOCKHA=$E(PSOCKHA,1,($L(PSOCKHA)-1))
"RTN","PSOLLLI",61,0)
 .S PSOCKHNX=$L(PSOCKHN,PSOCKHA)-1
"RTN","PSOLLLI",62,0)
 .I +$G(PSOCKHNX)>0 D DOUB
"RTN","PSOLLLI",63,0)
 I $O(^PSRX(RX,1,0)),$G(RXFL(RX))'=0 S $P(^PSRX(RX,3),"^",6)="" K ^PSRX(RX,"DAI"),^PSRX(RX,"DRI")
"RTN","PSOLLLI",64,0)
 I '$G(RXP),'$O(^PSRX(RX,1,0)) S RXFL(RX)=0
"RTN","PSOLLLI",65,0)
 I '$G(RXP) D OSET I '$O(^PSRX(RX,1,0))!($G(RXFL(RX))=0) G ORIG
"RTN","PSOLLLI",66,0)
 I $O(^PSRX(RX,1,0)),'$G(RXP) D  G STA
"RTN","PSOLLLI",67,0)
 . I '$G(RXFL(RX)) S XTYPE=1 D REF
"RTN","PSOLLLI",68,0)
 I $G(RXP) S XTYPE="P" D REF G STA
"RTN","PSOLLLI",69,0)
ORIG S TECH=$P($G(^VA(200,+$P(RXY,"^",16),0)),"^"),PHYS=$S($D(^VA(200,+$P(RXY,"^",4),0)):$P(^(0),"^"),1:"UKN")
"RTN","PSOLLLI",70,0)
 S DAYS=$P(RXY,"^",8),QTY=$P(RXY,"^",7)
"RTN","PSOLLLI",71,0)
 D 6^VADPT,PID^VADPT6 S SSNPN=""
"RTN","PSOLLLI",72,0)
STA S STATE=$S($D(^DIC(5,+$P(PS,"^",8),0)):$P(^(0),"^",2),1:"UKN")
"RTN","PSOLLLI",73,0)
 S DRUG=$$ZZ^PSOSUTL(RX),DEA=$P($G(^PSDRUG(+$P(RXY,"^",6),0)),"^",3),WARN=$P($G(^(0)),"^",8)
"RTN","PSOLLLI",74,0)
 S WARN=$$DRUG^PSSWRNA(+$P(RXY,"^",6),+$P(RXY,"^",2))
"RTN","PSOLLLI",75,0)
 S SIDE=$S($P($G(RXRP(RX)),"^",3):1,1:0)
"RTN","PSOLLLI",76,0)
 I $G(^PSRX(RX,"P",+$G(RXP),0))]"" S RXPI=RXP D
"RTN","PSOLLLI",77,0)
 .S RXP=^PSRX(RX,"P",RXP,0)
"RTN","PSOLLLI",78,0)
 .S RXY=$P(RXP,"^")_"^"_$P(RXY,"^",2,6)_"^"_$P(RXP,"^",4)_"^"_$P(RXP,"^",10)_"^"_$P(RXY,"^",9)_"^"_$P($G(^PSRX(RX,"SIG")),"^",2)_"^"_$P(RXP,"^",2)_"^"_$P(RXY,"^",12,14)_"^"_$P(^PSRX(RX,"STA"),"^")_"^"_$P(RXP,"^",7)_"^"_$P(RXY,"^",17,99)
"RTN","PSOLLLI",79,0)
 .S FDT=$P(RXP,"^")
"RTN","PSOLLLI",80,0)
 S MW=$P(RXY,"^",11) I $G(RXFL(RX))'=0 D:$G(RXFL(RX))  I '$G(RXFL(RX)) F I=0:0 S I=$O(^PSRX(RX,1,I)) Q:'I  S RXF=RXF+1 S:'$G(RXP) MW=$P(^PSRX(RX,1,I,0),"^",2) I +^PSRX(RX,1,I,0)'<FDT S FDT=+^(0)
"RTN","PSOLLLI",81,0)
 .I $G(RXFL(RX)),'$D(^PSRX(RX,1,RXFL(RX),0)) K RXFL(RX) Q
"RTN","PSOLLLI",82,0)
 .;PSO*7*266
"RTN","PSOLLLI",83,0)
 .S RXF=RXFL(RX) S:'$G(RXP) MW=$P($G(^PSRX(RX,1,RXF,0)),"^",2) F I=0:0 S I=$O(^PSRX(RX,1,I)) Q:'I  I +^PSRX(RX,1,I,0)'<FDT S FDT=+^(0)
"RTN","PSOLLLI",84,0)
 I MW="W",$G(^PSRX(RX,"MP"))]"" D
"RTN","PSOLLLI",85,0)
 .S PSMP=^PSRX(RX,"MP"),PSJ=0 F PSI=1:1:$L(PSMP) S PSMP(PSI)="",PSJ=PSJ+1 F PSJ=PSJ:1 S PSMP(PSI)=PSMP(PSI)_$P(PSMP," ",PSJ)_" " Q:($L(PSMP(PSI))+$L($P(PSMP," ",PSJ+1))>30)
"RTN","PSOLLLI",86,0)
 .K PSMP(PSI)
"RTN","PSOLLLI",87,0)
 ;New mail codes for CMOP
"RTN","PSOLLLI",88,0)
 S MAILCOM=""
"RTN","PSOLLLI",89,0)
 S X=$G(^PS(55,DFN,0)),PSCAP=$P(X,"^",2),PS55=$P(X,"^",3),PS55X=$P(X,"^",5)
"RTN","PSOLLLI",90,0)
 I PS55X]"",PS55>1,PS55X<DT S PS55=0
"RTN","PSOLLLI",91,0)
 S:MW="M" MW=$S((PS55=1!(PS55=4)):"R",1:MW)
"RTN","PSOLLLI",92,0)
 S MAILCOM=$P($G(^PS(59,PSOSITE,9)),"^")
"RTN","PSOLLLI",93,0)
 S MW=$S(MW="M":"REGULAR",MW="R":"CERTIFIED",1:"WINDOW")
"RTN","PSOLLLI",94,0)
 I $G(PSMP(1))="",$G(PS55)=2 S PSMP(1)=$G(SSNPN)
"RTN","PSOLLLI",95,0)
 S DATE=$E(FDT,1,7),REF=$P(RXY,"^",9)-RXF S:'$G(RXP) $P(^PSRX(RX,3),"^")=FDT S:REF<1 REF=0 D ^PSOLBL2 S II=RX D ^PSORFL,RFLDT^PSORFL
"RTN","PSOLLLI",96,0)
 S (X,PSOFLAST)=$G(PSOLASTF) I X?1N.E D ^%DT X ^DD("DD") S PSOFLAST=Y
"RTN","PSOLLLI",97,0)
 S PATST=$G(^PS(53,+$P(RXY,"^",3),0)) S PRTFL=1 I REF=0 S:('$P(PATST,"^",5))!(DEA["W")!(DEA[1)!(DEA[2) PRTFL=0
"RTN","PSOLLLI",98,0)
 S VRPH=$P(RX2,"^",10),PSCLN=+$P(RXY,"^",5),PSCLN=$G(^SC(PSCLN,0)),PSCLN=$S($P(PSCLN,"^",2)'="":$P(PSCLN,"^",2),1:$E($P(PSCLN,"^"),1,7)) I PSCLN="" S PSCLN="UNKNOWN"
"RTN","PSOLLLI",99,0)
 S PATST=$P(PATST,"^",2),X1=DT,X2=$P(RXY,"^",8)-10 D C^%DTC:REF I $D(^PSRX(RX,2)),$P(^(2),"^",6),REF,X'<$P(^(2),"^",6) S REF=0,VRPH=$P(^(2),"^",10)
"RTN","PSOLLLI",100,0)
 I $G(PSOCHAMP),$G(PSOTRAMT) S COPAYVAR="CHAMPUS" G LBL
"RTN","PSOLLLI",101,0)
 I $G(RXP) S COPAYVAR="" G LBL
"RTN","PSOLLLI",102,0)
 I $P($G(^PS(53,+$G(PSOLBLPS),0)),"^",7) D SNO G LBL
"RTN","PSOLLLI",103,0)
 I DEA["I"!(DEA["S")!(DEA["N") D SNO G LBL
"RTN","PSOLLLI",104,0)
 I $P(^PSRX(RX,"STA"),"^")>0,$P(^("STA"),"^")'=2,'$G(PSODBQ) D SNO G LBL
"RTN","PSOLLLI",105,0)
 I $G(PSOLBLCP)="" D IBCP
"RTN","PSOLLLI",106,0)
 N PSOQI S PSOQI=$G(^PSRX(RX,"IBQ"))
"RTN","PSOLLLI",107,0)
 I $G(PSOLBLCP)=0 D SNO G LBL
"RTN","PSOLLLI",108,0)
 I $G(PSOLBLCP)=1 I $P(PSOQI,"^",2)!($P(PSOQI,"^",3))!($P(PSOQI,"^",4))!($P(PSOQI,"^",5))!($P(PSOQI,"^",6))!($P(PSOQI,"^",7))!($P(PSOQI,"^",8)) D SNO G LBL
"RTN","PSOLLLI",109,0)
 I $G(PSOLBLCP)=2 I $P(PSOQI,"^")!($P(PSOQI,"^",2))!($P(PSOQI,"^",3))!($P(PSOQI,"^",4))!($P(PSOQI,"^",5))!($P(PSOQI,"^",6))!($P(PSOQI,"^",7))!($P(PSOQI,"^",8)) D SNO G LBL
"RTN","PSOLLLI",110,0)
 I $G(PSOLBLCP)=2,'$P($G(^PSRX(RX,"IB")),"^") D SNO G LBL
"RTN","PSOLLLI",111,0)
 S PSOCPN=$P(RXY,"^",2),INRX=$P(RXY,"^")
"RTN","PSOLLLI",112,0)
 I $G(^TMP($J,"PSOCP",PSOCPN))="" S ^(PSOCPN)=PSOCPN
"RTN","PSOLLLI",113,0)
 S ^TMP($J,"PSOCP",PSOCPN,INRX)=INRX_"^"_$$ZZ^PSOSUTL(RX)_"^"_+$G(DAYS),COPAYVAR="COPAY" K ZDRUG
"RTN","PSOLLLI",114,0)
LBL I $G(PSOIO("LLI"))]"" X PSOIO("LLI")
"RTN","PSOLLLI",115,0)
 I $P(RXSTA,"^")=4 D ^PSOLLL8 Q  ;for a critical interaction entered by a tech - don't allow a label to be printed
"RTN","PSOLLLI",116,0)
 I $D(^PSRX(RX,"DRI")),'$G(RXF),'$G(RXP) D ^PSOLLL8
"RTN","PSOLLLI",117,0)
 I $P($G(^PSRX(RX,3)),"^",6),'$G(RXF),'$G(RXP) D ^PSOLLL9
"RTN","PSOLLLI",118,0)
 S PSOINT=0 G ^PSOLLL1
"RTN","PSOLLLI",119,0)
REF F XXX=0:0 S XXX=$O(^PSRX(RX,XTYPE,XXX)) Q:+XXX'>0  D
"RTN","PSOLLLI",120,0)
 .S TECH=$S($D(^VA(200,+$P(^PSRX(RX,XTYPE,XXX,0),"^",7),0)):$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSOLLLI",121,0)
 .S QTY=$P(^PSRX(RX,XTYPE,XXX,0),"^",4),PHYS=$S($D(^VA(200,+$P(^PSRX(RX,XTYPE,XXX,0),"^",17),0)):$P(^(0),"^"),$D(^VA(200,+$P(^PSRX(RX,0),"^",4),0)):$P(^(0),"^"),1:"UNKNOWN") D 6^VADPT,PID^VADPT6 S SSNPN=""
"RTN","PSOLLLI",122,0)
 .S DAYS=$P(^PSRX(RX,XTYPE,XXX,0),"^",10)
"RTN","PSOLLLI",123,0)
 Q
"RTN","PSOLLLI",124,0)
CHECK S PSDFNFLG=0,PSOZERO=$P(PPL,","),PSOPDFN=$P(^PSRX(PSOZERO,0),"^",2)
"RTN","PSOLLLI",125,0)
 Q
"RTN","PSOLLLI",126,0)
OSET ;
"RTN","PSOLLLI",127,0)
 N A
"RTN","PSOLLLI",128,0)
 I $G(RXFL(RX))']""!($G(RXFL(RX))=0) D  Q
"RTN","PSOLLLI",129,0)
 .S A=^PSRX(RX,0)
"RTN","PSOLLLI",130,0)
 .S TECH=$P($G(^VA(200,+$P(A,"^",16),0)),"^"),QTY=$P(A,"^",7),PHYS=$S($D(^VA(200,+$P(A,"^",4),0)):$P(^(0),"^"),1:"UKN") D 6^VADPT,PID^VADPT6 S SSNPN=""
"RTN","PSOLLLI",131,0)
 .S DAYS=$P(A,"^",8)
"RTN","PSOLLLI",132,0)
 I '$D(^PSRX(RX,1,RXFL(RX),0)) K RXFL(RX) Q
"RTN","PSOLLLI",133,0)
 S A=^PSRX(RX,1,RXFL(RX),0)
"RTN","PSOLLLI",134,0)
 S TECH=$S($D(^VA(200,+$P(A,"^",7),0)):$P(^(0),"^"),1:"UNKNOWN")
"RTN","PSOLLLI",135,0)
 S QTY=$P(A,"^",4),PHYS=$S($D(^VA(200,+$P(A,"^",17),0)):$P(^(0),"^"),$D(^VA(200,+$P(^PSRX(RX,0),"^",4),0)):$P(^(0),"^"),1:"UNKNOWN") D 6^VADPT,PID^VADPT6 S SSNPN=""
"RTN","PSOLLLI",136,0)
 S DAYS=$P(A,"^",10)
"RTN","PSOLLLI",137,0)
 Q
"RTN","PSOLLLI",138,0)
DOUB ;
"RTN","PSOLLLI",139,0)
 Q:'$D(RXFL(RX))
"RTN","PSOLLLI",140,0)
 I +$G(RXFL(RX))-PSOCKHNX<0 Q
"RTN","PSOLLLI",141,0)
 S RXFLX(RX)=$G(RXFL(RX))
"RTN","PSOLLLI",142,0)
 S RXFL(RX)=$G(RXFL(RX))-PSOCKHNX
"RTN","PSOLLLI",143,0)
 Q
"RTN","PSOLLLI",144,0)
IBCP ;
"RTN","PSOLLLI",145,0)
 N X,Y,PSOJJ,PSOLL
"RTN","PSOLLLI",146,0)
 S PSOLBLCP=""
"RTN","PSOLLLI",147,0)
 S X=$P($G(^PS(59,+$G(PSOSITE),"IB")),"^")_"^"_$G(DFN) D XTYPE^IBARX
"RTN","PSOLLLI",148,0)
 S PSOJJ="" F  S PSOJJ=$O(Y(PSOJJ)) Q:'PSOJJ  S PSOLL="" F  S PSOLL=$O(Y(PSOJJ,PSOLL)) Q:PSOLL=""  S:PSOLL>0 PSOLBLCP=PSOLL
"RTN","PSOLLLI",149,0)
 I '$G(PSOLBLCP) S PSOLBLCP=0
"RTN","PSOLLLI",150,0)
 Q
"RTN","PSOLLLI",151,0)
SNO ;
"RTN","PSOLLLI",152,0)
 S COPAYVAR="NO COPAY"
"RTN","PSOLLLI",153,0)
 Q
"RTN","PSONVARP")
0^51^B23669597^B23438101
"RTN","PSONVARP",1,0)
PSONVARP ;BHM/MFR - Non-VA Med Usage Report - Input ;04/10/03
"RTN","PSONVARP",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**132,118,326**;13 Feb 97;Build 11
"RTN","PSONVARP",3,0)
 ;External reference to ^%DT is supported by DBIA 10003
"RTN","PSONVARP",4,0)
 ;External reference to ^%ZTLOAD is supported by DBIA 10063
"RTN","PSONVARP",5,0)
 ;External reference to ^%ZIS is supported by DBIA 10086
"RTN","PSONVARP",6,0)
 ;External reference to ^DIR is supported by DBIA 10026
"RTN","PSONVARP",7,0)
 ;External reference to ^XLFSTR is supported by DBIA 10104
"RTN","PSONVARP",8,0)
 ;
"RTN","PSONVARP",9,0)
HID ; - Entrhy point from the Hidden Action in the Medication Profile
"RTN","PSONVARP",10,0)
 N PSOHDFLG S PSOHDFLG=1
"RTN","PSONVARP",11,0)
 ;
"RTN","PSONVARP",12,0)
EN N PSOSD,PSOED,PSOST,PSOSRT,PSOAPT,PSOAOI,PSOST,PSOOC,PSOAPT,PSOAOI,I,Y
"RTN","PSONVARP",13,0)
 N OK,X,C,%DT
"RTN","PSONVARP",14,0)
 ;
"RTN","PSONVARP",15,0)
 ; - Ask for FROM DATE DOCUMENTED
"RTN","PSONVARP",16,0)
 S %DT(0)=-DT,%DT="AEP",%DT("A")="FROM DATE DOCUMENTED: "
"RTN","PSONVARP",17,0)
 W ! D ^%DT I Y<0!($D(DTOUT)) G END
"RTN","PSONVARP",18,0)
 S PSOSD=Y\1-.00001
"RTN","PSONVARP",19,0)
 ;
"RTN","PSONVARP",20,0)
ENDT ; - Ask for TO DATE DOCUMENTED
"RTN","PSONVARP",21,0)
 S %DT(0)=PSOSD+1\1,%DT("A")="TO DATE DOCUMENTED: "
"RTN","PSONVARP",22,0)
 W ! D ^%DT I Y<0!($D(DTOUT)) G END
"RTN","PSONVARP",23,0)
 S PSOED=Y\1+.99999
"RTN","PSONVARP",24,0)
 ;
"RTN","PSONVARP",25,0)
 ; - Reported called from a Hidden Action menu
"RTN","PSONVARP",26,0)
 I $G(PSOHDFLG) D  G DEV
"RTN","PSONVARP",27,0)
 . S PSOPT(DFN)="",PSOAPT=0,PSOAOI=1,PSOST="B",PSOOC="B",PSOSRT="4,2"
"RTN","PSONVARP",28,0)
 ;
"RTN","PSONVARP",29,0)
SORT ; - Ask for SORT BY
"RTN","PSONVARP",30,0)
 K DIR S DIR("B")="PATIENT NAME" D HL1("A")
"RTN","PSONVARP",31,0)
SORT1 S PSOSRT="",(PSOAPT,PSOAOI)=1,(PSOST,PSOOC)="B"
"RTN","PSONVARP",32,0)
 S DIR("A")="SORT BY",DIR(0)="FO" D HL1("?")
"RTN","PSONVARP",33,0)
 W ! D ^DIR K DIR I $D(DIRUT) G END
"RTN","PSONVARP",34,0)
 ;
"RTN","PSONVARP",35,0)
 S OK=1,C=15 W !
"RTN","PSONVARP",36,0)
 F I=1:1:$L(Y,",") D
"RTN","PSONVARP",37,0)
 . S X=$P(Y,",",I) S:X'?.N X=$$TRNS(X) I PSOSRT[X Q
"RTN","PSONVARP",38,0)
 . W !?(C-10),$S(I=1:"SORT BY ",1:"THEN BY ") S C=C+5
"RTN","PSONVARP",39,0)
 . I X<1!(X>5) W X,"???",$C(7) S OK=0 Q
"RTN","PSONVARP",40,0)
 . W $P("PATIENT NAME^ORDERABLE ITEM^DATE DOCUMENTED^STATUS^ORDER CHECKS","^",X)
"RTN","PSONVARP",41,0)
 . S PSOSRT=PSOSRT_","_X
"RTN","PSONVARP",42,0)
 I 'OK S DIR("B")=Y G SORT1
"RTN","PSONVARP",43,0)
 S $E(PSOSRT)=""
"RTN","PSONVARP",44,0)
 ;
"RTN","PSONVARP",45,0)
 S OK=1
"RTN","PSONVARP",46,0)
 F I=1:1:$L(PSOSRT,",") D  I 'OK Q
"RTN","PSONVARP",47,0)
 . S X=$P(PSOSRT,",",I) D:X'=3 @("SRT"_X)
"RTN","PSONVARP",48,0)
 I 'OK S DIR("B")="PATIENT NAME" G SORT1
"RTN","PSONVARP",49,0)
 ;
"RTN","PSONVARP",50,0)
DEV W ! K %ZIS,IOP,POP,ZTSK S %ZIS="QM" D ^%ZIS K %ZIS I POP G END
"RTN","PSONVARP",51,0)
 I $D(IO("Q")) D  G END
"RTN","PSONVARP",52,0)
 . N G K IO("Q"),ZTIO,ZTSAVE,ZTDTH,ZTSK
"RTN","PSONVARP",53,0)
 . S ZTRTN="EN^PSONVAR1",ZTDESC="Non-VA Meds Usage Report"
"RTN","PSONVARP",54,0)
 . F G="PSOSD","PSOED","PSOSRT","PSOPT","PSOOI" S:$D(@G) ZTSAVE(G)=""
"RTN","PSONVARP",55,0)
 . F G="PSOST","PSOOC","PSOAPT","PSOAOI" S:$D(@G) ZTSAVE(G)=""
"RTN","PSONVARP",56,0)
 . S:$D(PSOPT) ZTSAVE("PSOPT(")="" S:$D(PSOOI) ZTSAVE("PSOOI(")=""
"RTN","PSONVARP",57,0)
 . D ^%ZTLOAD W:$D(ZTSK) !,"Report is Queued to print !!" K ZTSK
"RTN","PSONVARP",58,0)
 ;
"RTN","PSONVARP",59,0)
 G EN^PSONVAR1
"RTN","PSONVARP",60,0)
 ;
"RTN","PSONVARP",61,0)
END Q
"RTN","PSONVARP",62,0)
 ;
"RTN","PSONVARP",63,0)
SRT1 ; - Selection of PATIENTS to print on the Report
"RTN","PSONVARP",64,0)
 N DIC,X,I K PSOPT S PSOAPT=0
"RTN","PSONVARP",65,0)
 W !!,?5,"You may select a single or multiple PATIENTS,"
"RTN","PSONVARP",66,0)
 W !,?5,"or enter ^ALL to select all PATIENTS.",!
"RTN","PSONVARP",67,0)
 S DIC(0)="QEAM",DIC("A")="     PATIENT: "
"RTN","PSONVARP",68,0)
 F  D EN^PSOPATLK S Y=PSOPTLK Q:+Y<1  S:'$$DEAD(+Y,1) PSOPT(+Y)="" K DIC("B"),PSOPTLK
"RTN","PSONVARP",69,0)
 I Y="^ALL" S PSOAPT=1 K PSOPT,DUOUT Q
"RTN","PSONVARP",70,0)
 I $D(DUOUT)!($D(DTOUT)) S OK=0 Q
"RTN","PSONVARP",71,0)
 I '$D(PSOPT),Y<1 S OK=0 Q
"RTN","PSONVARP",72,0)
 Q
"RTN","PSONVARP",73,0)
 ;
"RTN","PSONVARP",74,0)
SRT2 ; - Selection of ORDERABLE ITEMS to print on the Report
"RTN","PSONVARP",75,0)
 N DIC,X,I K PSOOI S PSOAOI=0
"RTN","PSONVARP",76,0)
 W !!,?5,"You may select a single or multiple ORDERABLE ITEMS,"
"RTN","PSONVARP",77,0)
 W !,?5,"or enter ^ALL to select all ORDERABLE ITEMS.",!
"RTN","PSONVARP",78,0)
 S DIC=50.7,DIC(0)="QEAM",DIC("A")="     ORDERABLE ITEM: "
"RTN","PSONVARP",79,0)
 F  D ^DIC Q:Y<0  S PSOOI(+Y)="" K DIC("B")
"RTN","PSONVARP",80,0)
 I X="^ALL" S PSOAOI=1 K PSOOI,DUOUT Q
"RTN","PSONVARP",81,0)
 I $D(DUOUT)!($D(DTOUT)) S OK=0 Q
"RTN","PSONVARP",82,0)
 I '$D(PSOOI)&(Y<0) S OK=0 Q
"RTN","PSONVARP",83,0)
 Q
"RTN","PSONVARP",84,0)
 ;
"RTN","PSONVARP",85,0)
SRT4 ; - Selection of STATUS to print on the Report
"RTN","PSONVARP",86,0)
 N DIR,X,I K PSOST
"RTN","PSONVARP",87,0)
 W !!,?5,"You may select (A)CTIVE, (D)ISCONTINUED or (B)OTH status.",!
"RTN","PSONVARP",88,0)
 S DIR(0)="SAO^A:ACTIVE;D:DISCONTINUED;B:BOTH"
"RTN","PSONVARP",89,0)
 S DIR("A")="     STATUS: ",DIR("B")="ACTIVE" D ^DIR
"RTN","PSONVARP",90,0)
 I $D(DIRUT) S OK=0 Q
"RTN","PSONVARP",91,0)
 S PSOST=Y
"RTN","PSONVARP",92,0)
 Q
"RTN","PSONVARP",93,0)
 ;
"RTN","PSONVARP",94,0)
SRT5 ; - Selection of ORDER CHECKS to print on the Report
"RTN","PSONVARP",95,0)
 N DIR,X,OP1,OP2 K PSOOC
"RTN","PSONVARP",96,0)
 S OP1="ORDERS WITH ORDER CHECKS ONLY"
"RTN","PSONVARP",97,0)
 S OP2="ORDERS WITHOUT ORDER CHECKS ONLY"
"RTN","PSONVARP",98,0)
 W !!,?5,"You may select 'Y' to print ",OP1,","
"RTN","PSONVARP",99,0)
 W !?5,"'N' to print ",OP2," or 'B' for BOTH.",!
"RTN","PSONVARP",100,0)
 S DIR(0)="SAO^Y:"_OP1_";N:"_OP2_";B:BOTH"
"RTN","PSONVARP",101,0)
 S DIR("A")="     ORDER CHECKS: ",DIR("B")="BOTH" D ^DIR
"RTN","PSONVARP",102,0)
 I $D(DIRUT) S OK=0 Q
"RTN","PSONVARP",103,0)
 S PSOOC=Y
"RTN","PSONVARP",104,0)
 Q
"RTN","PSONVARP",105,0)
 ;
"RTN","PSONVARP",106,0)
TRNS(X) ; - Translates Alpha into the corresponding Sorting Code
"RTN","PSONVARP",107,0)
 N L,UPX S L=$L(X),UPX=$$UP^XLFSTR(X)
"RTN","PSONVARP",108,0)
 I $E("PATIENT NAME",1,L)=UPX Q 1
"RTN","PSONVARP",109,0)
 I $E("ORDERABLE ITEM",1,L)=UPX Q 2
"RTN","PSONVARP",110,0)
 I $E("DATE DOCUMENTED",1,L)=UPX Q 3
"RTN","PSONVARP",111,0)
 I $E("STATUS",1,L)=UPX Q 4
"RTN","PSONVARP",112,0)
 I $E("ORDER CHECKS",1,L)=UPX Q 5
"RTN","PSONVARP",113,0)
 Q X
"RTN","PSONVARP",114,0)
 ;
"RTN","PSONVARP",115,0)
DEAD(DFN,DSPL) ; Check if Patient has a Date Of Death on File
"RTN","PSONVARP",116,0)
 N VADM,Y
"RTN","PSONVARP",117,0)
 I '$G(DFN) Q 0
"RTN","PSONVARP",118,0)
 D DEM^VADPT I $G(VADM(6))="" Q 0
"RTN","PSONVARP",119,0)
 I $G(DSPL) W !?10,$P($G(VADM(1)),"^")," (",$P($G(VADM(2)),"^",2),") DIED ",$P($G(VADM(6)),"^",2),$C(7)
"RTN","PSONVARP",120,0)
 Q 1
"RTN","PSONVARP",121,0)
 ;
"RTN","PSONVARP",122,0)
HL1(S) ; - Help for the SORT BY prompt
"RTN","PSONVARP",123,0)
 S DIR(S,1)="    Enter the SORT field(s) for this Report:"
"RTN","PSONVARP",124,0)
 S DIR(S,2)=" "
"RTN","PSONVARP",125,0)
 S DIR(S,3)="       1 - PATIENT NAME"
"RTN","PSONVARP",126,0)
 S DIR(S,4)="       2 - ORDERABLE ITEM"
"RTN","PSONVARP",127,0)
 S DIR(S,5)="       3 - DATE DOCUMENTED"
"RTN","PSONVARP",128,0)
 S DIR(S,6)="       4 - STATUS"
"RTN","PSONVARP",129,0)
 S DIR(S,7)="       5 - ORDER CHECKS"
"RTN","PSONVARP",130,0)
 S DIR(S,8)=" "
"RTN","PSONVARP",131,0)
 S DIR(S,9)="    Or any combination of the above, separated by comma,"
"RTN","PSONVARP",132,0)
 S DIR(S,10)="    as in these examples:"
"RTN","PSONVARP",133,0)
 S DIR(S,11)=" "
"RTN","PSONVARP",134,0)
 S DIR(S,12)="       2,1  - BY ORDERABLE ITEM, THEN BY PATIENT NAME"
"RTN","PSONVARP",135,0)
 S DIR(S,13)="      5,1,4 - BY ORDER CHECKS, THEN BY PATIENT NAME, THEN BY STATUS"
"RTN","PSONVARP",136,0)
 S DIR(S,14)=" "
"RTN","PSONVARP",137,0)
 S DIR(S)=" "
"RTN","PSONVARP",138,0)
 Q
"RTN","PSOP")
0^7^B45335172^B46184688
"RTN","PSOP",1,0)
PSOP ;BIR/SAB - Medication profile long or short ;02/25/94
"RTN","PSOP",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**2,15,98,132,148,326**;DEC 1997;Build 11
"RTN","PSOP",3,0)
 ;External reference to PS(55 supported by DBIA 2228
"RTN","PSOP",4,0)
 ;External reference to PS(59.7 supported by DBIA 694
"RTN","PSOP",5,0)
 ;External reference to PSDRUG supported by DBIA 221
"RTN","PSOP",6,0)
 W !! K ^TMP($J),ZTSK,CLS S DIC(0)="QEAM" D EN^PSOPATLK S Y=PSOPTLK G Q:+Y<1  S PSOLOUD=1,DFN=+Y D:$P($G(^PS(55,+Y,0)),"^",6)'=2 EN^PSOHLUP(+Y) K PSOLOUD S Y=DFN
"RTN","PSOP",7,0)
DOIT S (FN,DFN,D0,DA)=+Y I '$D(^PS(55,+Y,"P")),'$D(^("ARC")),'$D(^("NVA")),'$D(^PS(52.41,"AOR",+Y)) W !?20,$C(7),"NO PHARMACY INFORMATION" H 5 D ^PSODEM G PSOP
"RTN","PSOP",8,0)
 I '$O(^PS(55,+Y,"P",0)),$D(^PS(55,+Y,"ARC")) D ^PSODEM W !!,"PATIENT HAS ARCHIVED PRESCRIPTIONS",! G PSOP
"RTN","PSOP",9,0)
 S DIR("?")="Enter 'L' for a long profile or 'S' for a short profile",DIR("A")="LONG or SHORT: ",DIR(0)="SA^L:LONG;S:SHORT",DIR("B")="SHORT" D ^DIR G:$D(DUOUT)!$D(DIRUT) Q S PLS=Y K DIR
"RTN","PSOP",10,0)
S S DIR(0)="SA^D:DATE;M:MEDICATION;C:CLASS",DIR("A")="Sort by DATE, CLASS or MEDICATION: ",DIR("B")=$S($P($G(PSOPAR),"^",14)=2:"MEDICATION",$P($G(PSOPAR),"^",14)=1:"CLASS",1:"DATE")
"RTN","PSOP",11,0)
 S DIR("?",1)="Enter 'DATE', 'CLASS' or 'MEDICATION' to determine the order in which",DIR("?")="prescriptions will appear on the profile." D ^DIR G:$D(DUOUT)!$D(DIRUT) Q S PSRT=$S(Y="D":"DATE",Y="M":"DRUG",1:"CLSS")
"RTN","PSOP",12,0)
 S HDR=$S(Y="D":"ISSUE DATE",Y="M":"DRUG NAME",1:"DRUG CLASS") K DIR
"RTN","PSOP",13,0)
 K DIR G:PSRT="DATE" DEV S DIR("A")="Profile Expiration/Discontinued cutoff",DIR("B")=120,DIR(0)="N^1:9999:0",DIR("?",1)="Enter the number of days which will cut discontinued and expired Rx's from",DIR("?")="the profile."
"RTN","PSOP",14,0)
 D ^DIR G:$D(DTOUT)!($D(DUOUT)) Q K DIR S X1=DT,X2=-X D C^%DTC S PSODTCT=X
"RTN","PSOP",15,0)
DEV D SORT^PSOP1 G:$D(DUOUT)!($D(DTOUT)) Q
"RTN","PSOP",16,0)
 K %ZIS,IOP,ZTSK S PSOION=ION,%ZIS="MQ" D ^%ZIS K %ZIS I POP S IOP=PSOION D ^%ZIS K IOP,PSOION G Q
"RTN","PSOP",17,0)
 K PSOION I $D(IO("Q")) S ZTDESC="Patient Medication Profile",ZTRTN="P^PSOP" D  G PSOP
"RTN","PSOP",18,0)
 .F G="HDR","TO","FR","SDT","PSFR","PSTO","DTS","CLS","EDT","DRS","PSODTCT","FN","DFN","DA","D0","PLS","PSRT","PSOPAR" S:$D(@G) ZTSAVE(G)=""
"RTN","PSOP",19,0)
 .K IO("Q") D ^%ZTLOAD W:$D(ZTSK) !,"Task Queued to Print",! K Q,ZTSK D Q
"RTN","PSOP",20,0)
 D P,Q G PSOP
"RTN","PSOP",21,0)
P U IO S PAGE=1,$P(PSOPLINE,"-",80)="" K ^TMP($J) D LOOP D ^PSODEM W:$O(^PS(55,DA,"ARC",0)) !!,"Patient Has Archived Prescriptions",!
"RTN","PSOP",22,0)
 I $Y+10>IOSL,$E(IOST)="C" D DIR^PSOP1 Q:$D(PQT)  W @IOF
"RTN","PSOP",23,0)
 W:$P($G(^PS(59.7,1,40.1)),"^") !,"Outpatient prescriptions are discontinued 72 hours after admission"
"RTN","PSOP",24,0)
 W !!?(80-$L("Medication Profile Sorted by "_HDR))/2,"Medication Profile Sorted by "_HDR W:$G(FR)]"" !?(80-$L(FR_" to "_TO))/2,FR_" to "_TO
"RTN","PSOP",25,0)
 I PLS="S" D ^PSOP1 G Q
"RTN","PSOP",26,0)
 W ! S DRUG="" F II=0:0 S DRUG=$O(^TMP($J,DRUG)) Q:DRUG=""!($D(PQT))  F J=0:0 S J=$O(^TMP($J,DRUG,J)) Q:'J  D O W:$G(PQT) @IOF Q:$G(PQT)  I $Y+8>IOSL,$E(IOST)="C" D DIR^PSOP1 W @IOF Q:$D(PQT)
"RTN","PSOP",27,0)
 D PEND^PSOP2,NVA^PSOP2
"RTN","PSOP",28,0)
Q D ^%ZISC K CP,HDR,X1,X2,RX3,^TMP($J),ST0,PSODTCT,ST,D0,DIC,DIR,DIRUT,DUOUT,G,II,K,RXD,RXF,ZX,DRUG,X,DFN,PHYS,PSRT,CT,AL,I1,PLS,REF,LMI,PI,FN,Y,I,J,RX,DRX,ST,RX0,RX2,DA,PSOPLINE,PAGE,PRLBL,PSOPATOK,PSOPTLK
"RTN","PSOP",29,0)
 K PSOLR,PSDIV,PQT,TO,FR,CLS,DRG,DRS,DTS,DTOUT,PSFR,PSTO,SDT,EDT,PPP,FSIG,IIII,STAT,PP,EEEE,PPPCNT,PENDREX,PSOPEND,PPDIS,PPOI,PCOUNT,PPCOUNT,PPP S:$D(ZTQUEUED) ZTREQ="@" Q
"RTN","PSOP",30,0)
 ;
"RTN","PSOP",31,0)
O S RX0=^PSRX(J,0),RX2=$G(^(2)),RX3=$G(^(3)),$P(RX0,"^",15)=$G(^("STA")),DRX="NOT ON FILE",CP=$S(+$G(^PSRX(J,"IB")):"$",1:" ") S:$P(RX0,"^",15)="" $P(RX0,"^",15)=-1
"RTN","PSOP",32,0)
 ;
"RTN","PSOP",33,0)
 I $D(^PSDRUG(+$P(RX0,"^",6),0)) S DRX=$P(^(0),"^")
"RTN","PSOP",34,0)
 I $Y+10>IOSL,IOSL["C-" D DIR^PSOP1 W @IOF Q:$D(PQT)
"RTN","PSOP",35,0)
 I $Y+10>IOSL,$E(IOST)'="C" S PAGE=PAGE+1 D
"RTN","PSOP",36,0)
 .W @IOF,!,$P(^DPT(DFN,0),"^"),?70,"Page: "_PAGE
"RTN","PSOP",37,0)
 .W !?(80-$L("Medication Profile Sorted by "_HDR))/2,"Medication Profile Sorted by "_HDR W:$G(FR)]"" !?(80-$L(FR_" to "_TO))/2,FR_" to "_TO
"RTN","PSOP",38,0)
 .W !,PSOPLINE
"RTN","PSOP",39,0)
 W !!,"Rx #: "_CP_$P(RX0,"^"),$$ECME^PSOBPSUT(J),?32,"Drug: ",$G(DRX)
"RTN","PSOP",40,0)
 S PSOBRSIG=$P($G(^PSRX(J,"SIG")),"^",2) K FSIG,BSIG D
"RTN","PSOP",41,0)
 .I PSOBRSIG D FSIG^PSOUTLA("R",J,70) Q
"RTN","PSOP",42,0)
 .D EN2^PSOUTLA1(J,70) F IIII=0:0 S IIII=$O(BSIG(IIII)) Q:'IIII  S FSIG(IIII)=BSIG(IIII)
"RTN","PSOP",43,0)
 K PSOBRSIG,IIII,BSIG
"RTN","PSOP",44,0)
 W !?2,"SIG: "_$G(FSIG(1)) D:$O(FSIG(1))
"RTN","PSOP",45,0)
 .F IIII=1:0 S IIII=$O(FSIG(IIII)) Q:'IIII!($G(PQT))  W !?7,$G(FSIG(IIII))  D:($Y+5>IOSL)&($E(IOST)["C") DIR^PSOP1 Q:$G(PQT)  D:$Y+5>IOSL
"RTN","PSOP",46,0)
 ..S PAGE=PAGE+1
"RTN","PSOP",47,0)
 ..W @IOF,!,$P(^DPT(DFN,0),"^"),?70,"Page: "_PAGE
"RTN","PSOP",48,0)
 ..W !?(80-$L("Medication Profile Sorted by "_HDR))/2,"Medication Profile Sorted by "_HDR W:$G(FR)]"" !?(80-$L(FR_" to "_TO))/2,FR_" to "_TO
"RTN","PSOP",49,0)
 ..W !,PSOPLINE
"RTN","PSOP",50,0)
 Q:$G(PQT)
"RTN","PSOP",51,0)
 W !?2,"QTY: ",$P(RX0,"^",7),?23,"# of Refills: ",$P(RX0,"^",9),?45,"Issue/Expr: " S Y=$P(RX0,"^",13) W $E(Y,4,5),"-",$E(Y,6,7),"-",$E(Y,2,3),"/" S Y=$P(RX2,"^",6) W:Y $E(Y,4,5),"-",$E(Y,6,7),"-",$E(Y,2,3)
"RTN","PSOP",52,0)
 K DIC,X,Y S DIC="^VA(200,",DIC(0)="M",X="`"_+$P(RX0,"^",4) D ^DIC S PHYS=$S(+Y:$P(Y,"^",2),1:"Unknown") K DIC,X,Y
"RTN","PSOP",53,0)
 W !?2,"Prov: "_PHYS,?30,"Entry By: "_$P(RX0,"^",16),?45,"Filled: " S Y=$P(RX2,"^",2) W:Y $E(Y,4,5),"-",$E(Y,6,7),"-",$E(Y,2,3) W " (",$P(RX0,"^",11),")"
"RTN","PSOP",54,0)
 I $P(RX3,"^",3) D
"RTN","PSOP",55,0)
 .K DIC,X,Y S DIC="^VA(200,",DIC(0)="M",X="`"_+$P(RX3,"^",3) D ^DIC S PHYS=$S(+Y:$P(Y,"^",2),1:"Unknown") K DIC,X,Y W !?2,"Cosigner: "_PHYS K PHYS
"RTN","PSOP",56,0)
 S PSOLR=$S($P(RX2,"^",13):$P(RX2,"^",13),1:"") F PSOX=0:0 S PSOX=$O(^PSRX(J,1,PSOX)) Q:'PSOX  S:$P(^PSRX(J,1,PSOX,0),"^",18) PSOLR=$P(^(0),"^",18)
"RTN","PSOP",57,0)
 W !?2,"Last Released: " W:PSOLR $E(PSOLR,4,5)_"-"_$E(PSOLR,6,7)_"-"_$E(PSOLR,2,3)
"RTN","PSOP",58,0)
 W ?45,$S($P(RX2,"^",15):"Original Fill Returned to Stock",1:"Original Release: "_$S($P(RX2,"^",13):$E($P(RX2,"^",13),4,5)_"-"_$E($P(RX2,"^",13),6,7)_"-"_$E($P(RX2,"^",13),2,3),1:""))
"RTN","PSOP",59,0)
 S CT=0,REF=$P(RX0,"^",9) F K=0:0 S K=$O(^PSRX(J,1,K)) Q:'K  S RX1=^PSRX(J,1,K,0) D
"RTN","PSOP",60,0)
 .I $Y+5>IOSL,IOSL["C-" D DIR^PSOP1 W @IOF Q:$D(PQT)
"RTN","PSOP",61,0)
 .I $Y+5>IOSL,$E(IOST)'="C" S PAGE=PAGE+1 D
"RTN","PSOP",62,0)
 ..W @IOF,!,$P(^DPT(DFN,0),"^"),?70,"Page: "_PAGE
"RTN","PSOP",63,0)
 ..W !?(80-$L("Medication Profile Sorted by "_HDR))/2,"Medication Profile Sorted by "_HDR W:$G(FR)]"" !?(80-$L(FR_" to "_TO))/2,FR_" to "_TO
"RTN","PSOP",64,0)
 ..W !,PSOPLINE
"RTN","PSOP",65,0)
 .W !?2,"Refilled: "_$E($P(RX1,"^"),4,5)_"-"_$E($P(RX1,"^"),6,7)_"-"_$E($P(RX1,"^"),2,3)_" ("_$P(RX1,"^",2)_")"_$S($P(RX1,"^",16):"(R)",1:"")
"RTN","PSOP",66,0)
 .W ?30,"Released: "_$S($P(RX1,"^",18):$E($P(RX1,"^",18),4,5)_"-"_$E($P(RX1,"^",18),6,7)_"-"_$E($P(RX1,"^",18),2,3),1:"")
"RTN","PSOP",67,0)
 .S REF=REF-1
"RTN","PSOP",68,0)
 I $Y+2>IOSL,IOSL["C-" D DIR^PSOP1 W @IOF Q:$D(PQT)
"RTN","PSOP",69,0)
 I $Y+2>IOSL,$E(IOST)'="C" S PAGE=PAGE+1 W @IOF,!,$P(^DPT(DFN,0),"^"),?70,"Page: "_PAGE
"RTN","PSOP",70,0)
 I $O(^PSRX(J,"P",0)) W !?2,"Partials: " F K=0:0 S K=$O(^PSRX(J,"P",K)) Q:'K  W $E(^(K,0),4,5),"-",$E(^(0),6,7),"-",$E(^(0),2,3)," (",$P(^(0),"^",2),") QTY:",$P(^(0),"^",4)_$S($P(^(0),"^",16):" (R)",1:"")_", "
"RTN","PSOP",71,0)
 W:$P(RX3,"^",7)]"" !?2,"Remarks: ",$P(RX3,"^",7) D STAT^PSOFUNC
"RTN","PSOP",72,0)
 S PSDIV=$S($D(^PS(59,+$P(RX2,"^",9),0)):$P(^(0),"^")_" ("_$P(^(0),"^",6)_")",1:"Unknown")
"RTN","PSOP",73,0)
 W !?2,"Division: "_$E(PSDIV,1,25),?40,ST,?60,REF," Refill"_$S(REF'=1:"s",1:"")," Left"
"RTN","PSOP",74,0)
 Q
"RTN","PSOP",75,0)
LOOP F I=0:0 S I=$O(^PS(55,DFN,"P",I)) Q:'I  S J=+^(I,0) D  I $G(PSOPATOK),$D(^PSRX(J,0)),$P($G(^PSRX(J,"STA")),"^")'=13 S PRLBL=PSRT_"^PSOP2" D @PRLBL
"RTN","PSOP",76,0)
 .S PSOPATOK=1 I $P($G(^PSRX(+$G(J),0)),"^",2),DFN'=$P($G(^(0)),"^",2) K ^PS(55,DFN,"P",I,0) S:$P($G(^PS(55,DFN,"P",0)),"^",4) $P(^PS(55,DFN,"P",0),"^",4)=$P($G(^(0)),"^",4)-1 S PSOPATOK=0
"RTN","PSOP",77,0)
 Q
"RTN","PSOP1")
0^8^B26127323^B26993923
"RTN","PSOP1",1,0)
PSOP1 ;BHAM ISC/SAB - prints short medication profile ;02/25/94
"RTN","PSOP1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**15,46,103,132,148,233,326**;DEC 1997;Build 11
"RTN","PSOP1",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOP1",4,0)
 ;External reference to ^PS(50.605 supported by DBIA 696
"RTN","PSOP1",5,0)
 K RX,DTOUT,DIRUT,DIROUT,DUOUT
"RTN","PSOP1",6,0)
 D HD S DRUG="" F I=0:0 S DRUG=$O(^TMP($J,DRUG)) Q:DRUG=""!($G(PQT))  D  G:$D(DTOUT)!($D(DUOUT))!($D(DIROUT)) Q
"RTN","PSOP1",7,0)
 .F J=0:0 S J=$O(^TMP($J,DRUG,J)) Q:'J!($G(PQT))  S RX0=^(J),RX2=$G(^PSRX(J,2)),$P(RX0,"^",15)=$G(^("STA")),CP=$S(+$G(^PSRX(J,"IB")):"$",1:" ") S:$P(RX2,"^",15)&($P(RX2,"^",2)) RST($P(RX2,"^",2))=1 S:$P(RX0,"^",15)="" $P(RX0,"^",15)=-1 D W
"RTN","PSOP1",8,0)
 D:'$G(PQT) PEND^PSOP2,NVA^PSOP2
"RTN","PSOP1",9,0)
Q D ^%ZISC K ^TMP($J),PQT,PSODTCT,ST,D0,DIC,DIR,DIRUT,DUOUT,G,II,K,RXD,RXF,ZX,DRUG,X,DFN,PHYS,PSRT,CT,AL,I1,PLS,REF
"RTN","PSOP1",10,0)
 K LMI,PI,FN,Y,I,J,RX,DRX,ST,RX0,RX2,DA,PPPSTAT,PPP,EEEE,PPPCNT,PENDREX,PSOPEND,PPDIS,PPOI,PCOUNT,PP,FSIG,ZZZZ
"RTN","PSOP1",11,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSOP1",12,0)
 Q
"RTN","PSOP1",13,0)
W I $Y+6>IOSL,$E(IOST)="C" D DIR W @IOF Q:$D(PQT)  D HD
"RTN","PSOP1",14,0)
 N PSOBADR
"RTN","PSOP1",15,0)
 U IO I IO'=IO(0),$Y+6>IOSL W @IOF D HD
"RTN","PSOP1",16,0)
 I $E(IOST)'="C",$Y+6>IOSL W @IOF D HD
"RTN","PSOP1",17,0)
 D STAT^PSOFUNC S STA="A^N^R^H^P^S^^^^^^E^DC^^DC^DE^PH",ST=$P(STA,"^",(ST0+1)) K STA
"RTN","PSOP1",18,0)
 S PSOBADR=$O(^PSRX(J,"L",9999),-1)
"RTN","PSOP1",19,0)
 I PSOBADR'="" S PSOBADR=$G(^PSRX(J,"L",PSOBADR,0)) I PSOBADR["(BAD ADDRESS)" S PSOBADR="B"
"RTN","PSOP1",20,0)
 I PSOBADR'="B" S PSOBADR=""
"RTN","PSOP1",21,0)
 S ST=ST_PSOBADR
"RTN","PSOP1",22,0)
 W !,CP_$P(RX0,"^"),$$ECME^PSOBPSUT(J),?13,$S($D(^PSDRUG(+$P(RX0,"^",6),0)):$P(^(0),"^"),1:"NOT ON FILE"),?54,$S($L(ST)=1:" "_ST,1:ST)
"RTN","PSOP1",23,0)
 S RXD=$P($G(^PSRX(J,3)),"^"),RXF=$P(RX0,"^",9) F II=0:0 S II=$O(^PSRX(J,1,II)) Q:'II  S RXF=RXF-1 S:$P(^PSRX(J,1,II,0),"^",16) RST($P(^(0),"^"))=1
"RTN","PSOP1",24,0)
 W ?58,$S($L(RXF)=1:" "_RXF,1:RXF)
"RTN","PSOP1",25,0)
 W ?61,$E($P(RX0,"^",13),4,5)_"-"_$E($P(RX0,"^",13),6,7)_"-"_$E($P(RX0,"^",13),2,3) W:RXD ?70,$E(RXD,4,5)_"-"_$E(RXD,6,7)_"-"_$E(RXD,2,3)_$S($G(RST(RXD)):"R",1:"")
"RTN","PSOP1",26,0)
 S PSOPRSIG=$P($G(^PSRX(J,"SIG")),"^",2) K FSIG,BSIG D
"RTN","PSOP1",27,0)
 .I PSOPRSIG D FSIG^PSOUTLA("R",J,50) Q
"RTN","PSOP1",28,0)
 .D EN2^PSOUTLA1(J,50) F GGGG=0:0 S GGGG=$O(BSIG(GGGG)) Q:'GGGG  S FSIG(GGGG)=BSIG(GGGG)
"RTN","PSOP1",29,0)
 K PSOPRSIG,GGGG,BSIG
"RTN","PSOP1",30,0)
 W !?5,"QTY: ",$P(RX0,"^",7),?24,"SIG: ",$G(FSIG(1)) D:$O(FSIG(1))
"RTN","PSOP1",31,0)
 .F GGGG=1:0 S GGGG=$O(FSIG(GGGG)) Q:'GGGG!($G(PQT))  W !,?29,$G(FSIG(GGGG)) D:$Y+5>IOSL&($E(IOST)="C") DIR Q:$G(PQT)  I '$G(PQT),($Y+5>IOSL) W @IOF D HD
"RTN","PSOP1",32,0)
 K GGGG,FSIG Q:$G(PQT)
"RTN","PSOP1",33,0)
 ;D SIG
"RTN","PSOP1",34,0)
 K RST Q
"RTN","PSOP1",35,0)
HD D:PAGE>1
"RTN","PSOP1",36,0)
 .W !,"Patient: "_$P(^DPT(DFN,0),"^"),?70,"Page: "_PAGE
"RTN","PSOP1",37,0)
 .W !?(80-$L("Medication Profile Sorted by "_HDR))/2,"Medication Profile Sorted by "_HDR W:$G(FR)]"" !?(80-$L(FR_" to "_TO))/2,FR_" to "_TO
"RTN","PSOP1",38,0)
 W !?57,"REF",!?1,"Rx#",?13,"Drug",?54,"ST",?57,"REM",?62,"Issued",?70,"Last Fill",!,PSOPLINE S PAGE=PAGE+1
"RTN","PSOP1",39,0)
 Q
"RTN","PSOP1",40,0)
SORT K DIR,DUOUT,DTOUT
"RTN","PSOP1",41,0)
 S DIR("B")="All",DIR("A",1)=" ",DIR("A")="All Medications or Selection (A/S): ",DIR(0)="SAM^A:All;S:Select Range",DIR("?",1)="Enter 'A' to Print Entire Medication Profile",DIR("?")="   or 'S' for Selection Range" D ^DIR
"RTN","PSOP1",42,0)
 K DIR Q:$D(DIRUT)!(Y="A")!(Y="E")  D @PSRT
"RTN","PSOP1",43,0)
 Q
"RTN","PSOP1",44,0)
DATE ;asks date range
"RTN","PSOP1",45,0)
 W ! K %DT S %DT="AEX",%DT("A")="Starting Date: " D ^%DT  I "^"[X S DUOUT=1 Q
"RTN","PSOP1",46,0)
 G:Y<0 DATE S SDT=+Y,%DT(0)=SDT,FR=$E(SDT,4,5)_"/"_$E(SDT,6,7)_"/"_$E(SDT,2,3)
"RTN","PSOP1",47,0)
EDT S %DT("A")="Ending Date: " D ^%DT  I "^"[X S DUOUT=1 Q
"RTN","PSOP1",48,0)
 G:Y<0 EDT S EDT=+Y,DTS=1,TO=$E(EDT,4,5)_"/"_$E(EDT,6,7)_"/"_$E(EDT,2,3)
"RTN","PSOP1",49,0)
 K %DT Q
"RTN","PSOP1",50,0)
DRUG ;asks drug list
"RTN","PSOP1",51,0)
 W ! S DIC("A")="Start with Drug: ",DIC(0)="AEMQ",DIC=50
"RTN","PSOP1",52,0)
 S DIC("S")="I $S('$D(^PSDRUG(Y,""I"")):1,'^(""I""):1,DT'>^(""I""):1,1:0),$S('$D(^PSDRUG(Y,2)):1,$P(^(2),""^"",3)'[""O"":0,1:1)"
"RTN","PSOP1",53,0)
 D ^DIC I "^"[X S DUOUT=1 K DIC Q
"RTN","PSOP1",54,0)
 G:Y<0 DRUG S FR=$P(Y,"^",2)
"RTN","PSOP1",55,0)
 F %=$L($E(FR,1,30)):-1:1 S M=$A(FR,%) I M>32 S Y1=$E(FR,1,%-1)_$C(M-1)_$C(122) Q
"RTN","PSOP1",56,0)
 S PSFR=Y1 K Y1,Y,X
"RTN","PSOP1",57,0)
TO S DIC("A")="To Drug: " D ^DIC I "^"[X S DUOUT=1 K DIC Q
"RTN","PSOP1",58,0)
 G:Y<0 TO I FR]$P(Y,"^",2) W !,$C(7),"Less Than 'Start' Value" K X,Y G TO
"RTN","PSOP1",59,0)
 S TO=$P(Y,"^",2),DRS=1
"RTN","PSOP1",60,0)
 F %=$L($E(TO,1,30)):-1:1 S M=$A(TO,%) I M>32 S Y1=$E(TO,1,%-1)_$C(M+1)_$C(122) Q
"RTN","PSOP1",61,0)
 S PSTO=Y1 K Y1,Y,X,DIC
"RTN","PSOP1",62,0)
 Q
"RTN","PSOP1",63,0)
CLSS ;asks drug class list
"RTN","PSOP1",64,0)
 W ! S DIC("A")="Start with Drug Class: ",DIC(0)="AEQ",DIC=50.605 D ^DIC I "^"[X S DUOUT=1 Q
"RTN","PSOP1",65,0)
 G:Y<0 CLSS S FR=$P(Y,"^",2)
"RTN","PSOP1",66,0)
 F %=$L($E(FR,1,30)):-1:1 S M=$A(FR,%) I M>32 S Y1=$E(FR,1,%-1)_$C(M-1)_$C(122) Q
"RTN","PSOP1",67,0)
 S PSFR=Y1 K Y1,Y,X
"RTN","PSOP1",68,0)
TO1 S DIC("A")="To Drug Class: " D ^DIC I "^"[X S DUOUT=1 Q
"RTN","PSOP1",69,0)
 G:Y<0 TO1 I FR]$P(Y,"^",2) W !,$C(7),"Less Than 'Start' Value" K X,Y G TO1
"RTN","PSOP1",70,0)
 S TO=$P(Y,"^",2)
"RTN","PSOP1",71,0)
 F %=$L($E(TO,1,30)):-1:1 S M=$A(TO,%) I M>32 S Y1=$E(TO,1,%-1)_$C(M+1)_$C(122) Q
"RTN","PSOP1",72,0)
 S PSTO=Y1,CLS=1 K Y,Y1,X
"RTN","PSOP1",73,0)
 Q
"RTN","PSOP1",74,0)
DIR K PQT,DTOUT,DUOUT,DIR,DIRUT S DIR(0)="E" D ^DIR S:$D(DUOUT)!($D(DTOUT)) PQT=1 Q
"RTN","PSOP1",75,0)
SIG I '$P(^PSRX(J,"SIG"),"^",2) D  Q
"RTN","PSOP1",76,0)
 .S X=$P(^PSRX(J,"SIG"),"^") D SIGONE^PSOHELP S SIG=$E($G(INS1),2,250)
"RTN","PSOP1",77,0)
 .F SG=1:1:$L(SIG) W:($X+$L($P(SIG," ",SG)_" "))>$S(IOST["C-":IOM,1:70) !?6 W:$P(SIG," ",SG)]"" $P(SIG," ",SG)_" "
"RTN","PSOP1",78,0)
 S MIG=$P(^PSRX(J,"SIG"),"^"),SIGOK=1 D
"RTN","PSOP1",79,0)
 .F SG=1:1:$L(MIG) Q:$P(MIG," ",SG)=""  W:($X+$L($P(MIG," ",SG)_" "))>$S(IOST["C-":IOM,1:70) !?6 W $P(MIG," ",SG)_" "
"RTN","PSOP1",80,0)
 F I=0:0 S I=$O(^PSRX(RXN,"SIG1",I)) Q:'I  S MIG=$P(^PSRX(RXN,"SIG1",I,0),"^") D
"RTN","PSOP1",81,0)
 .F SG=1:1:$L(MIG) Q:$P(MIG," ",SG)=""  W:($X+$L($P(MIG," ",SG)_" "))>$S(IOST["C-":IOM,1:70) !?6 W $P(MIG," ",SG)_" "
"RTN","PSOP1",82,0)
 Q
"RTN","PSOP2")
0^45^B31681031^B32288266
"RTN","PSOP2",1,0)
PSOP2 ;BIR/SAB - medication profile long or short ;02/25/94
"RTN","PSOP2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**15,98,132,326**;DEC 1997;Build 11
"RTN","PSOP2",3,0)
 ;External reference to File #55 supported by DBIA 2228
"RTN","PSOP2",4,0)
 ;External reference to PSDRUG supported by DBIA 221
"RTN","PSOP2",5,0)
 ;External reference ^PS(50.606 supported by DBIA 2174
"RTN","PSOP2",6,0)
 ;External reference ^PS(50.7 supported by DBIA 2223
"RTN","PSOP2",7,0)
DATE I $G(DTS) D  Q:'$G(TRDT)
"RTN","PSOP2",8,0)
 .S:$P(^PSRX(J,0),"^",13)'<SDT&($P(^(0),"^",13)'>EDT) TRDT=1
"RTN","PSOP2",9,0)
 S X=$P(^PSRX(J,0),"^",13),X=999999999-X,^TMP($J,X,J)=^(0) K TRDT
"RTN","PSOP2",10,0)
 Q
"RTN","PSOP2",11,0)
DRUG Q:'$D(^PSDRUG(+$P(^PSRX(J,0),"^",6),0))  S DRG=$P(^(0),"^")
"RTN","PSOP2",12,0)
 I $G(DRS) D  Q:'$G(TRDR)
"RTN","PSOP2",13,0)
 .I DRG]PSFR,PSTO]DRG S TRDR=1
"RTN","PSOP2",14,0)
 I $P($G(^PSRX(J,3)),"^",5),$P($G(^PSRX(J,3)),"^",5)<PSODTCT,$P($G(^("STA")),"^")>11,$P($G(^("STA")),"^")'=16 K TRDR Q
"RTN","PSOP2",15,0)
 I $P($G(^PSRX(J,2)),"^",6)'<PSODTCT S ^TMP($J,$E(DRG,1,31),J)=^PSRX(J,0) K TRDR
"RTN","PSOP2",16,0)
 Q
"RTN","PSOP2",17,0)
CLSS Q:'$D(^PSDRUG(+$P(^PSRX(J,0),"^",6),0))  S DRG=$P(^(0),"^",2)
"RTN","PSOP2",18,0)
 I $G(CLS) D  Q:'$G(TRCL)
"RTN","PSOP2",19,0)
 .I DRG]PSFR,PSTO]DRG S TRCL=1
"RTN","PSOP2",20,0)
 I $P($G(^PSRX(J,3)),"^",5),$P($G(^PSRX(J,3)),"^",5)<PSODTCT,$P($G(^("STA")),"^")>11,$P($G(^("STA")),"^")'=16 K TRCL Q
"RTN","PSOP2",21,0)
 I $P($G(^PSRX(J,2)),"^",6)'<PSODTCT S ^TMP($J,$S(DRG]"":$E(DRG,1,31),1:"UNKNOWN"),J)=^PSRX(J,0) K TRCL
"RTN","PSOP2",22,0)
 Q
"RTN","PSOP2",23,0)
PEND ;list pending orders
"RTN","PSOP2",24,0)
 S PPPCNT=1 F PPP=0:0 S PPP=$O(^PS(52.41,"P",DFN,PPP)) Q:'PPP  S PPPSTAT=$P($G(^PS(52.41,PPP,0)),"^",3) I PPPSTAT="NW"!(PPPSTAT="HD")!(PPPSTAT="RNW") D
"RTN","PSOP2",25,0)
 .S PSOPEND(PPPCNT)=PPP_"^"_$S(+$P($G(^PS(52.41,PPP,0)),"^",9):"DD",1:"OI")_"^"_$P($G(^(0)),"^",5)_"^"_$P(^(0),"^",6)_"^"_$P(^(0),"^",10)_"^"_$P(^(0),"^",11) S PPPCNT=PPPCNT+1
"RTN","PSOP2",26,0)
 Q:PPPCNT=1  I $E(IOST)="C" D DIR^PSOP1 Q:$G(PQT)
"RTN","PSOP2",27,0)
 D HD1 S PPCOUNT=1 F EEEE=0:0 S EEEE=$O(PSOPEND(EEEE)) Q:'EEEE!($G(PQT))  D
"RTN","PSOP2",28,0)
 .S PENDREX=$P(PSOPEND(EEEE),"^"),PPDIS=$P($G(^PS(52.41,PENDREX,0)),"^",9),PPOI=$P($G(^(0)),"^",8)
"RTN","PSOP2",29,0)
 .W:PPCOUNT>1 ! W !,"Drug: ",$S($P(PSOPEND(EEEE),"^",2)="DD":$P($G(^PSDRUG(+PPDIS,0)),"^"),1:$P($G(^PS(50.7,+PPOI,0)),"^")_" "_$P($G(^PS(50.606,+$P($G(^(0)),"^",2),0)),"^")),! S PPCOUNT=PPCOUNT+1
"RTN","PSOP2",30,0)
 .W ?1,"Eff. Date: ",$E($P(PSOPEND(EEEE),"^",4),4,5)_"-"_$E($P(PSOPEND(EEEE),"^",4),6,7)_"-"_$E($P(PSOPEND(EEEE),"^",4),2,3),?22,"Qty: ",$P(PSOPEND(EEEE),"^",5),?40,"Refills: ",$P(PSOPEND(EEEE),"^",6)
"RTN","PSOP2",31,0)
 .K DIC,X,Y S DIC="^VA(200,",DIC(0)="M",X="`"_+$P(PSOPEND(EEEE),"^",3) D ^DIC K DIC,X
"RTN","PSOP2",32,0)
 .W ?52,"Prov: "_$E($P(Y,"^",2),1,21)
"RTN","PSOP2",33,0)
 .D:($Y+5>IOSL)&($E(IOST)="C") DIR^PSOP1 Q:$G(PQT)  D:$Y+5>IOSL HD1
"RTN","PSOP2",34,0)
 .S PCOUNT=1 W !?1,"Sig: " F AAAA=0:0 S AAAA=$O(^PS(52.41,PENDREX,"SIG",AAAA)) Q:'AAAA!($G(PQT))  W:PCOUNT>1 ! W ?6,$G(^PS(52.41,PENDREX,"SIG",AAAA,0)) S PCOUNT=PCOUNT+1 D:($Y+5>IOSL)&($E(IOST)="C") DIR^PSOP1 Q:$G(PQT)  D:$Y+5>IOSL
"RTN","PSOP2",35,0)
 ..D HD1 S PPCOUNT=$S('$O(^PS(52.41,PENDREX,"SIG",AAAA)):1,1:PPCOUNT)
"RTN","PSOP2",36,0)
 I '$G(PQT),$E(IOST)="C" D DIR^PSOP1
"RTN","PSOP2",37,0)
 Q
"RTN","PSOP2",38,0)
HD1 ;W @IOF W !,?29,"PENDING ORDERS",!,PSOPLINE
"RTN","PSOP2",39,0)
 I $G(PLS)="L" S PAGE=PAGE+1
"RTN","PSOP2",40,0)
 W @IOF W !,"Patient: "_$P($G(^DPT(DFN,0)),"^"),?70,"Page: "_PAGE,!?21,$S($G(NVA):"Non-VA MEDS (Not Dispensed by VA)",1:"Pending Outpatient Orders"),!,PSOPLINE
"RTN","PSOP2",41,0)
 I $G(PLS)="S" S PAGE=PAGE+1
"RTN","PSOP2",42,0)
 Q
"RTN","PSOP2",43,0)
NVA ;non-va meds
"RTN","PSOP2",44,0)
 Q:'$O(^PS(55,DFN,"NVA",0))
"RTN","PSOP2",45,0)
 W !!,PSOPLINE,!?(80-$L("Non-VA MEDS (Not Dispensed by VA)"))/2,"Non-VA MEDS (Not Dispensed by VA)",!
"RTN","PSOP2",46,0)
 K PQT S PCNT=1 F PPP=0:0 S PPP=$O(^PS(55,DFN,"NVA",PPP)) Q:'PPP!($G(PQT))  S NVAOR=^PS(55,DFN,"NVA",PPP,0),NVA=1 D
"RTN","PSOP2",47,0)
 .;I PCNT D HD1 S PCNT=0
"RTN","PSOP2",48,0)
 .Q:'$P(NVAOR,"^")
"RTN","PSOP2",49,0)
 .I $Y+10>IOSL,$E(IOST)="C" D DIR^PSOP1 Q:$D(PQT)  W @IOF
"RTN","PSOP2",50,0)
 .I $Y+11>IOSL,$E(IOST)'="C" D HD1
"RTN","PSOP2",51,0)
 .W !!,$S($P(NVAOR,"^",2):$P($G(^PSDRUG(+$P(NVAOR,"^",2),0)),"^"),1:$P($G(^PS(50.7,$P(NVAOR,"^"),0)),"^")_" "_$P($G(^PS(50.606,+$P($G(^(0)),"^",2),0)),"^"))
"RTN","PSOP2",52,0)
 .I PLS="S" D  Q
"RTN","PSOP2",53,0)
 ..W !?2,"Dosage: "_$P(NVAOR,"^",3)
"RTN","PSOP2",54,0)
 ..W !?2,"Schedule: "_$P(NVAOR,"^",5)
"RTN","PSOP2",55,0)
 ..W !?2,"Date Documented: "
"RTN","PSOP2",56,0)
 ..W $E($P(NVAOR,"^",10),4,5)_"/"_$E($P(NVAOR,"^",10),6,7)_"/"_$E($P(NVAOR,"^",10),2,3)
"RTN","PSOP2",57,0)
 ..W !?2,"Status: "_$S($P(NVAOR,"^",7):"Discontinued ("_$E($P(NVAOR,"^",7),4,5)_"/"_$E($P(NVAOR,"^",7),6,7)_"/"_$E($P(NVAOR,"^",7),2,3)_")",1:"Active")
"RTN","PSOP2",58,0)
 .I ($Y+5)>IOSL,$E(IOST)'="C" D HD1
"RTN","PSOP2",59,0)
 .W !?2,"Dosage: "_$P(NVAOR,"^",3)
"RTN","PSOP2",60,0)
 .W !?2,"Schedule: "_$P(NVAOR,"^",5)
"RTN","PSOP2",61,0)
 .W !?2,"Route: "_$P(NVAOR,"^",4)
"RTN","PSOP2",62,0)
 .W !?2,"Status: "_$S($P(NVAOR,"^",7):"Discontinued ("_$E($P(NVAOR,"^",7),4,5)_"/"_$E($P(NVAOR,"^",7),6,7)_"/"_$E($P(NVAOR,"^",7),2,3)_")",1:"Active")
"RTN","PSOP2",63,0)
 .W !?2,"Start Date: "_$E($P(NVAOR,"^",9),4,5)_"/"_$E($P(NVAOR,"^",9),6,7)_"/"_$E($P(NVAOR,"^",9),2,3),?$X+5,"CPRS Order #: "_$P(NVAOR,"^",8)
"RTN","PSOP2",64,0)
 .W !?2,"Documented By: "_$S($G(^VA(200,$P(NVAOR,"^",11),0))]"":$P(^VA(200,$P(NVAOR,"^",11),0),"^"),1:"Unknown")_" on "_$E($P(NVAOR,"^",10),4,5)_"/"_$E($P(NVAOR,"^",10),6,7)_"/"_$E($P(NVAOR,"^",10),2,3)
"RTN","PSOP2",65,0)
 .I ($Y+5)>IOSL,$E(IOST)'="C" D HD1
"RTN","PSOP2",66,0)
 .I $O(^PS(55,DFN,"NVA",PPP,"OCK",0)) W !?2,"Order Check(s):" D
"RTN","PSOP2",67,0)
 ..I ($Y+5)>IOSL,$E(IOST)'="C" D HD1 W !?2,"Order Check(s):"
"RTN","PSOP2",68,0)
 ..F NVAP=0:0 S NVAP=$O(^PS(55,DFN,"NVA",PPP,"OCK",NVAP)) Q:'NVAP  W !?3,"#"_NVAP_". "_$P(^PS(55,DFN,"NVA",PPP,"OCK",NVAP,0),"^") S PRV=$P(^(0),"^",2) D  I ($Y+5)>IOSL,$E(IOST)'="C" D HD1 W !?2,"Order Check(s):"
"RTN","PSOP2",69,0)
 ...I ($Y+5)>IOSL,$E(IOST)'="C" D HD1
"RTN","PSOP2",70,0)
 ...I $O(^PS(55,DFN,"NVA",PPP,"OCK",NVAP,"OVR",0)) W !?5,"Override Reason: " D
"RTN","PSOP2",71,0)
 ....I ($Y+5)>IOSL,$E(IOST)'="C" D HD1
"RTN","PSOP2",72,0)
 ....F NVAPR=0:0 S NVAPR=$O(^PS(55,DFN,"NVA",PPP,"OCK",NVAP,"OVR",NVAPR)) Q:'NVAPR  W ?22,^PS(55,DFN,"NVA",PPP,"OCK",NVAP,"OVR",NVAPR,0),!
"RTN","PSOP2",73,0)
 ..W ?2,"Override Provider: "_$P(^VA(200,PRV,0),"^"),!
"RTN","PSOP2",74,0)
 .I ($Y+5)>IOSL,$E(IOST)'="C" D HD1
"RTN","PSOP2",75,0)
 .I $O(^PS(55,DFN,"NVA",PPP,"DSC",0)) W !?2,"Statement/Explanation/Comments: " D
"RTN","PSOP2",76,0)
 ..I ($Y+5)>IOSL,$E(IOST)'="C" D HD1
"RTN","PSOP2",77,0)
 ..F NVAP=0:0 S NVAP=$O(^PS(55,DFN,"NVA",PPP,"DSC",NVAP)) Q:'NVAP  W $P(^PS(55,DFN,"NVA",PPP,"DSC",NVAP,0),"^"),!?34
"RTN","PSOP2",78,0)
 W ! K NVA,NVAP,NVAPR,NVAOR
"RTN","PSOP2",79,0)
 Q
"RTN","PSOPAT")
0^9^B4999933^B4781637
"RTN","PSOPAT",1,0)
PSOPAT ;BHAM ISC/SAB - update pharmacy patient data ;03/08/93 8:35
"RTN","PSOPAT",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**74,117,149,233,268,326**;DEC 1997;Build 11
"RTN","PSOPAT",3,0)
 ;Reference to ^PS(55, is supported by IA 2228
"RTN","PSOPAT",4,0)
 I '$D(PSOPAR) D ^PSOLSET I '$D(PSOPAR) W $C(7),!,"Site Parameters must be Defined!",! G EX
"RTN","PSOPAT",5,0)
2 W ! S PSOFROM=1,DIC("A")="Select Patient: ",DIC(0)="AEQMZ" D EN^PSOPATLK S Y=PSOPTLK G:"^"[Y EX G:Y<0 2 S DFN=+Y S PSOLOUD=1 D:$P($G(^PS(55,DFN,0)),"^",6)'=2 EN^PSOHLUP(DFN) K PSOLOUD
"RTN","PSOPAT",6,0)
 S DA=DFN,PI="" D ^PSODEM G 2:PI="^"
"RTN","PSOPAT",7,0)
 I '$P($G(PSOPAR),"^",22),'$D(^XUSEC("PSO ADDRESS UPDATE",+$G(DUZ))) G P55
"RTN","PSOPAT",8,0)
 L +^PS(55,DA):$S(+$G(^DD("DILOCKTM"))>0:+^DD("DILOCKTM"),1:3) I '$T D MSG D EX G 2
"RTN","PSOPAT",9,0)
 S PSODFN=DA D UPDATE^PSOBAI S DA=PSODFN
"RTN","PSOPAT",10,0)
 W !
"RTN","PSOPAT",11,0)
 L +^DPT(DA):$S(+$G(^DD("DILOCKTM"))>0:+^DD("DILOCKTM"),1:3) I '$T D MSG D EX G 2
"RTN","PSOPAT",12,0)
 S DIE="^DPT(",DR="[PSO OUTPT]" D ^DIE L -^DPT(DA)
"RTN","PSOPAT",13,0)
P55 I '$D(^PS(55,DFN)) K DIC S DIC="^PS(55,",DIC(0)="LZ",(X,DINUM)=DFN K DD,DO D FILE^DICN D:$G(DFN)&($P($G(^PS(55,DFN,0)),"^",6)'=2) EN^PSOHLUP(DFN) K DIC
"RTN","PSOPAT",14,0)
 I $G(DFN),$P($G(^PS(55,DFN,0)),"^")="" S $P(^PS(55,DFN,0),"^")=DFN K DIK S DA=DFN,DIK="^PS(55,",DIK(1)=".01^B" D EN^DIK K DIK S DA=DFN
"RTN","PSOPAT",15,0)
 S DIE="^PS(55,",DR=".02;.03;.05;.04;1;D ELIG^PSORX1;3;40:41.1;106;106.1" W !!?5,">>PHARMACY PATIENT DATA<<",!
"RTN","PSOPAT",16,0)
 D ^DIE,EX W !! G 2
"RTN","PSOPAT",17,0)
 Q
"RTN","PSOPAT",18,0)
EX L -^PS(55,+$G(DA)),-^DPT(+$G(DA))
"RTN","PSOPAT",19,0)
 K DIC,X,Y,DIE,D0,DA,DFN,PI,DR,%,%Y,%X,C,DI,DIPGM,DQ,PSOFROM,PSOPTLK
"RTN","PSOPAT",20,0)
 Q
"RTN","PSOPAT",21,0)
MSG W $C(7),!,"Patient Data is Being Edited by Another User!",! Q
"RTN","PSOPATLK")
0^10^B5987433^n/a
"RTN","PSOPATLK",1,0)
PSOPATLK ;BIR/JAM - Patient Lookup utility ;7/21/08
"RTN","PSOPATLK",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**326**;DEC 1997;Build 11
"RTN","PSOPATLK",3,0)
 ;
"RTN","PSOPATLK",4,0)
 ; This API looks for a patient using a prescription number, barcode
"RTN","PSOPATLK",5,0)
 ; or the registration standard patient lookup.
"RTN","PSOPATLK",6,0)
 ;
"RTN","PSOPATLK",7,0)
EN ;Entry point - Prompts for Patient, Prescription Number or Barcode
"RTN","PSOPATLK",8,0)
 ; 
"RTN","PSOPATLK",9,0)
 ; Input  - DIC(0) & DIC("A") [Optional] 
"RTN","PSOPATLK",10,0)
 ;          Used by DIR if defined by the calling routine.
"RTN","PSOPATLK",11,0)
 ;
"RTN","PSOPATLK",12,0)
 ; Output - PSOPTLK [Processed user response]
"RTN","PSOPATLK",13,0)
 ;
"RTN","PSOPATLK",14,0)
 N DIR
"RTN","PSOPATLK",15,0)
 K PSOPTLK
"RTN","PSOPATLK",16,0)
 S DIR(0)="FO"_$S($D(DIC("A")):"A",1:"")_"^^K:$$PATVAL^PSOPATLK() X"
"RTN","PSOPATLK",17,0)
 S DIR("A")=$S($D(DIC("A")):DIC("A"),1:"Select PATIENT NAME")
"RTN","PSOPATLK",18,0)
 S (DIR("?"),DIR("??"))="^D PATHLP^PSOPATLK"
"RTN","PSOPATLK",19,0)
 D ^DIR
"RTN","PSOPATLK",20,0)
 M PSOPTLK=Y
"RTN","PSOPATLK",21,0)
 K DIROUT,DIRUT,DTOUT,DUOUT
"RTN","PSOPATLK",22,0)
 Q
"RTN","PSOPATLK",23,0)
PATHLP ;Help text for patient prompt
"RTN","PSOPATLK",24,0)
 N DIC
"RTN","PSOPATLK",25,0)
 I $E(X)'="?" Q
"RTN","PSOPATLK",26,0)
 I X="?" D
"RTN","PSOPATLK",27,0)
 .W !?1,"Enter the prescription number prefixed by a # (ex. #XXXXXXX) or"
"RTN","PSOPATLK",28,0)
 .W !?1,"Wand the barcode of the prescription. The format of the barcode is"
"RTN","PSOPATLK",29,0)
 .W !?1,"NNN-NNNNNNN where the first 3 digits are your station number."
"RTN","PSOPATLK",30,0)
 .W !?1,"         - OR -           "
"RTN","PSOPATLK",31,0)
 S DIC="^DPT(",DIC(0)="QZEXN" D ^DIC
"RTN","PSOPATLK",32,0)
 Q
"RTN","PSOPATLK",33,0)
 ;
"RTN","PSOPATLK",34,0)
PATVAL() ;Validate user input
"RTN","PSOPATLK",35,0)
 N OUT
"RTN","PSOPATLK",36,0)
 S OUT=0
"RTN","PSOPATLK",37,0)
 ;Prescription lookup
"RTN","PSOPATLK",38,0)
 I X?1"#".E D RXLK Q OUT
"RTN","PSOPATLK",39,0)
 ;Barcode lookup
"RTN","PSOPATLK",40,0)
 I X?3N1"-".N D RXLK Q OUT
"RTN","PSOPATLK",41,0)
 ;Standard patient lookup
"RTN","PSOPATLK",42,0)
 S DIC="^DPT(" S:'$D(DIC(0)) DIC(0)="QEMZ" D ^DIC
"RTN","PSOPATLK",43,0)
 S OUT=$S(+Y>0:0,1:1)
"RTN","PSOPATLK",44,0)
 Q OUT
"RTN","PSOPATLK",45,0)
 ;
"RTN","PSOPATLK",46,0)
RXLK ;Prescription Lookup
"RTN","PSOPATLK",47,0)
 N DFN,DIC,RXNUM,RX,Z
"RTN","PSOPATLK",48,0)
 S RXNUM=X,RX=$S($E(RXNUM)="#":$E(RXNUM,2,999999999),1:$P(RXNUM,"-",2))
"RTN","PSOPATLK",49,0)
 I RX="" W !,$C(7),"No prescription number entered." S OUT=1 Q
"RTN","PSOPATLK",50,0)
 I $E(RXNUM)'="#",$P(RXNUM,"-")'=$$INST() D  S OUT=1 Q
"RTN","PSOPATLK",51,0)
 .W !!,$C(7),"This prescription is not from this institution."
"RTN","PSOPATLK",52,0)
 S Z=$S($E(RXNUM)="#":$O(^PSRX("B",RX,0)),1:RX),Y=$G(^PSRX(+Z,0))
"RTN","PSOPATLK",53,0)
 I (Y="")!(Z="") D  S OUT=1 Q
"RTN","PSOPATLK",54,0)
 .W !,$C(7),"No Prescription Record found"_$S($E(RXNUM)="#":".",1:" for this barcode.")
"RTN","PSOPATLK",55,0)
 S DFN=$P(Y,"^",2) K Y
"RTN","PSOPATLK",56,0)
 N DIC,X S DIC="^DPT(",DIC(0)="QZEXN" S X=DFN D ^DIC
"RTN","PSOPATLK",57,0)
 Q 
"RTN","PSOPATLK",58,0)
INST() ;get institution number
"RTN","PSOPATLK",59,0)
 N PSOINST,DA,DIQ
"RTN","PSOPATLK",60,0)
 S DA=$P($$SITE^VASITE(),"^")
"RTN","PSOPATLK",61,0)
 S PSOINST=$$GET1^DIQ(4,DA,99,"I")
"RTN","PSOPATLK",62,0)
 Q PSOINST
"RTN","PSOPATLK",63,0)
 ;
"RTN","PSOPOLY")
0^11^B40529966^B40602112
"RTN","PSOPOLY",1,0)
PSOPOLY ;BHAM ISC/SAB - patients with a minimum amount of rx's within a # of days ;10/06/93
"RTN","PSOPOLY",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**19,28,132,326**;DEC 1997;Build 11
"RTN","PSOPOLY",3,0)
 ;External reference ^PS(55 supported by DBIA# 2228
"RTN","PSOPOLY",4,0)
 ;External reference ^PSDRUG( supported by DBIA# 221
"RTN","PSOPOLY",5,0)
 ;External reference ^DPT( supported by DBIA# 10035
"RTN","PSOPOLY",6,0)
 ;External reference ^PS(50.606 supported by DBIA 2174
"RTN","PSOPOLY",7,0)
 ;External reference ^PS(50.7 supported by DBIA 2223
"RTN","PSOPOLY",8,0)
 K ^TMP($J),DIR S PG=0
"RTN","PSOPOLY",9,0)
 S DIR("A")="Number Of Days To Begin Search",DIR("?")="^D HLP^PSOPOLY",DIR(0)="N^1:730:0",DIR("B")=180 D ^DIR G:$D(DIRUT) END S DAYS=Y K DIR
"RTN","PSOPOLY",10,0)
 S DIR("A")="Minimum Number Of Rxs and Active Non-VA Meds",DIR("B")=7,DIR("?")="^D HLP1^PSOPOLY",DIR(0)="N^1:100:0" D ^DIR G:$D(DIRUT) END S RX=Y K DIR
"RTN","PSOPOLY",11,0)
PAT W !! S DIC("A")="Enter Patient's Name or ^ALL for All Patients: "
"RTN","PSOPOLY",12,0)
 S DIC(0)="QEM" D EN^PSOPATLK S Y=PSOPTLK G:$E(Y,1,2)="^A"!($E(Y,1,2)="^a") ALL G:"^"[$E(Y) END S (PSODFN,DFN)=+Y
"RTN","PSOPOLY",13,0)
 D:$P($G(^PS(55,DFN,0)),"^",6)'=2 EN^PSOHLUP(DFN) S ALL=0 D DEV G:$G(QP)!($D(ZTSK)) END
"RTN","PSOPOLY",14,0)
ENQ D CON,PID^VADPT S DFN=PSODFN I '$O(^PS(55,DFN,"P","A",PSDATE)),'$O(^PS(55,DFN,"NVA",0)) G NRX
"RTN","PSOPOLY",15,0)
BEG S RXS=0 S:$G(PSDATEX) PSDATE=PSDATEX
"RTN","PSOPOLY",16,0)
 F  S PSDATE=$O(^PS(55,DFN,"P","A",PSDATE)) Q:'PSDATE  S (P,J)=0 F  S J=$O(^PS(55,DFN,"P","A",PSDATE,J)) Q:'J  D:$D(^PSRX(J,0))
"RTN","PSOPOLY",17,0)
 .I 134'[$E(+$P($G(^PSRX(J,"STA")),"^")),$P($G(^PSDRUG($P($G(^PSRX(J,0)),"^",6),0)),"^",3)'["S" S RXS=RXS+1,RX(DFN,J)=+$P($G(^PSRX(J,"STA")),"^")
"RTN","PSOPOLY",18,0)
 N NVA F NVA=0:0 S NVA=$O(^PS(55,DFN,"NVA",NVA)) Q:'NVA  I '$P(^PS(55,DFN,"NVA",NVA,0),"^",7) S RXS=RXS+1
"RTN","PSOPOLY",19,0)
 I RXS'<RX F  S P=$O(RX(DFN,P)) Q:'P  S RX0=$S($D(^PSRX(P,0)):^(0),1:""),RX2=$S($D(^(2)):^(2),1:""),RX3=$S($D(^(3)):^(3),1:"") D
"RTN","PSOPOLY",20,0)
 .S STA=RX(DFN,P),DRUG=$S($D(^PSDRUG($P(RX0,"^",6),0)):$P(^PSDRUG($P(RX0,"^",6),0),"^"),1:"UNKNOWN"),CLASS=$S($P($G(^PSDRUG($P(RX0,"^",6),0)),"^",2)]"":$P(^(0),"^",2),1:"UNKNOWN")
"RTN","PSOPOLY",21,0)
A .S STAT="A^N^R^H^N^S^^^^^^E^DC^^DC^DE^H^P^",STATUS=$P(STAT,"^",STA+1)
"RTN","PSOPOLY",22,0)
 .S FILLDATE=9999999-$P(^PSRX(P,2),"^",2)
"RTN","PSOPOLY",23,0)
 .S ^TMP($J,$P(^DPT(DFN,0),"^"),CLASS,DRUG,FILLDATE,P)=$P(^PSRX(P,0),"^",2)_"^"_RXS_"^"_$P(RX3,"^")_"^"_$P(RX0,"^",4)_"^"_STATUS_"^"_VA("BID")_"^"_DFN
"RTN","PSOPOLY",24,0)
 I RXS'<RX,$O(^TMP($J,$P(^DPT(DFN,0),"^"),""))="" S CLASS="NVA",^TMP($J,$P(^DPT(DFN,0),"^"),CLASS)=DFN_"^"_RXS
"RTN","PSOPOLY",25,0)
 S RXS=0 K RX(DFN),CLASS
"RTN","PSOPOLY",26,0)
 I 'ALL,'$D(^TMP($J)) G NRX
"RTN","PSOPOLY",27,0)
 I 'ALL D PRI G:$G(PSOTRUE) END D NVA G END
"RTN","PSOPOLY",28,0)
 Q
"RTN","PSOPOLY",29,0)
 ;
"RTN","PSOPOLY",30,0)
PRI S PG=0 D HDR S (DFN,ZDFN)="" D
"RTN","PSOPOLY",31,0)
 .F  S DFN=$O(^TMP($J,DFN)) Q:DFN=""  S (ZCLASS,CLASS)="" D  I ALL,$G(CLASS)="" D:'$G(PSOTRUE) NVA K PSOTRUE W ! F I=1:1:132 W "-"
"RTN","PSOPOLY",32,0)
 ..F  S CLASS=$O(^TMP($J,DFN,CLASS)) Q:CLASS=""  D
"RTN","PSOPOLY",33,0)
 ...I CLASS="NVA" S PSODFN=$P(^TMP($J,DFN,"NVA"),"^"),PSOTRUE=1 D NVA Q
"RTN","PSOPOLY",34,0)
 ...S DRUG="" F  S DRUG=$O(^TMP($J,DFN,CLASS,DRUG)) Q:DRUG=""  S FILLDATE="" F  S FILLDATE=$O(^TMP($J,DFN,CLASS,DRUG,FILLDATE)) Q:'FILLDATE  D
"RTN","PSOPOLY",35,0)
 ....F RNX=0:0 S RNX=$O(^TMP($J,DFN,CLASS,DRUG,FILLDATE,RNX)) Q:'RNX  S POLY=^(RNX),PSODFN=$P(POLY,"^",7) D
"RTN","PSOPOLY",36,0)
 .....I ($Y+5)>IOSL D HDR
"RTN","PSOPOLY",37,0)
 .....W ! W:ZDFN'=DFN !,DFN_" ("_$P(POLY,"^",6)_")" W:ZDFN'=DFN ?65,$J($P(POLY,"^",2),3),! W:ZCLASS'=CLASS ?2,$E(CLASS,1,16)
"RTN","PSOPOLY",38,0)
 .....W ?22,DRUG,?65,$P(POLY,"^",5) S Y=$P(POLY,"^",3) W ?77 D DT^DIQ S PROV=$P($G(^VA(200,$P(POLY,"^",4),0)),"^") W ?92,$E(PROV,1,25),?121,$P(^PSRX(RNX,0),"^") S ZCLASS=CLASS,ZDFN=DFN
"RTN","PSOPOLY",39,0)
 .....S TOTRX=$G(TOTRX)+1 S:'$D(^TMP($J,"PAT",DFN)) TOTP=$G(TOTP)+1,^TMP($J,"PAT",DFN)=""
"RTN","PSOPOLY",40,0)
 I ALL U IO W !!,"Total Number of Patients: "_TOTP,?40,"Total Number of Rxs: "_TOTRX,?80,"Average Rxs per Patient: "_(TOTRX\TOTP)
"RTN","PSOPOLY",41,0)
 Q
"RTN","PSOPOLY",42,0)
END W ! D ^%ZISC K QP,^TMP($J),DIR,DTOUT,DUOUT,DIRUT,DIROUT,%DT,ALL,CLASS,DAYS,DFN,DIC,DRUG,EDT,FILLDATE,PSDATEX,G,I,J,P,PSDATE,RX,RXS,RX0,RX2,RX3,SDT,X,Y,POLY,PROV,POP,RNX,Z0,Z1,Z2,ZCLASS,PG,ZDFN,ZTSK,STA,STAT,STATUS D KVA^VADPT
"RTN","PSOPOLY",43,0)
 K PSODFN,PAT,TOTRX,TOTP S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSOPOLY",44,0)
 Q
"RTN","PSOPOLY",45,0)
ALL ;print all patients
"RTN","PSOPOLY",46,0)
 W ! S ALL=1,(TOTRX,TOTP)=0 D DEV G:$G(QP)!($D(ZTSK)) END
"RTN","PSOPOLY",47,0)
ALLP D CON
"RTN","PSOPOLY",48,0)
 F DFN=0:0 S DFN=$O(^PS(55,DFN)) Q:'DFN  S ALL=1 D:$P($G(^PS(55,DFN,0)),"^",6)'=2 EN^PSOHLUP(DFN) D PID^VADPT,BEG
"RTN","PSOPOLY",49,0)
 I '$D(^TMP($J)) G NRX
"RTN","PSOPOLY",50,0)
 D PRI,END
"RTN","PSOPOLY",51,0)
 Q
"RTN","PSOPOLY",52,0)
CON ;convert data to date
"RTN","PSOPOLY",53,0)
 S %DT="",X="T-"_DAYS D ^%DT S SDT=Y,(PSDATE,PSDATEX)=SDT-1,X="T" D ^%DT S EDT=Y,RXS=0
"RTN","PSOPOLY",54,0)
 Q
"RTN","PSOPOLY",55,0)
NRX ;prints no rx message
"RTN","PSOPOLY",56,0)
 D HDR U IO W:'ALL !,$P(^DPT(DFN,0),"^")_" ("_VA("BID")_")" W !?20,">>>> No Active Prescriptions and/or Non-VA Meds found within the Range <<<<" W @IOF G END
"RTN","PSOPOLY",57,0)
 Q
"RTN","PSOPOLY",58,0)
HLP ;help module
"RTN","PSOPOLY",59,0)
 W !!,$C(7),"Enter numeric value greater than zero.",!,"The value must a whole number, no decimals or fractions.",!!
"RTN","PSOPOLY",60,0)
 Q
"RTN","PSOPOLY",61,0)
HLP1 W !!,$C(7),"Enter a numeric value greater than zero.",!,"The number seven (7) is the default, no decimals or fractions.",!,"The count will include both Active Prescriptions and Non-VA Medications.",!!
"RTN","PSOPOLY",62,0)
 Q
"RTN","PSOPOLY",63,0)
DEV K %ZIS,IOP,ZTSK S %ZIS("B")="",PSOION=ION,%ZIS="QM" D ^%ZIS K %ZIS I POP S QP=1,IOP=PSOION D ^%ZIS K IOP,PSOION Q
"RTN","PSOPOLY",64,0)
 I $G(IOM)<132 W $C(7),!!,"Printout Must be 132 Columns.",!! G DEV
"RTN","PSOPOLY",65,0)
 K PSOION I $D(IO("Q")) D  K IO("Q") D ^%ZTLOAD W:$D(ZTSK) !,"Report is queued to print !",!
"RTN","PSOPOLY",66,0)
 .S ZTDESC="Poly Pharmacy Report",ZTRTN=$S('ALL:"ENQ^PSOPOLY",1:"ALLP^PSOPOLY") F G="ALL","RX","DAYS","DFN","PG","PSODFN" S:$D(@G) ZTSAVE(G)=""
"RTN","PSOPOLY",67,0)
 Q
"RTN","PSOPOLY",68,0)
HDR ;report header
"RTN","PSOPOLY",69,0)
 S PG=PG+1 U IO W @IOF,?55,"Poly Pharmacy Report",!?50,$E(SDT,4,5)_"-"_$E(SDT,6,7)_"-"_($E(SDT,1,3)+1700)_"    to    "_$E(EDT,4,5)_"-"_$E(EDT,6,7)_"-"_($E(EDT,1,3)+1700)
"RTN","PSOPOLY",70,0)
 W !?37," for "_DAYS_" Days for "_RX_" or More Active Prescriptions and/or Non-VA Meds"
"RTN","PSOPOLY",71,0)
 W ?122,"Page "_PG,!,"Patient",?40,"ID#",?62,"Active Rx's",!,?2,"Class",?22,"Drug",?65,"Status",?77,"Last Filled",?92,"Provider",?121,"Rx Number"
"RTN","PSOPOLY",72,0)
 W ! F I=1:1:132 W "-"
"RTN","PSOPOLY",73,0)
 Q
"RTN","PSOPOLY",74,0)
NVA ;displays non-va meds
"RTN","PSOPOLY",75,0)
 Q:'$O(^PS(55,PSODFN,"NVA",0))  N TITLE
"RTN","PSOPOLY",76,0)
 S PSOSTA=">>>Non-VA MEDS (Not dispensed by VA)<<<"
"RTN","PSOPOLY",77,0)
 S STR=($L(PSOSTA)+IOM/2)-$L(PSOSTA),STP=IOM-(STR+$L(PSOSTA)) F I=1:1:STR S TITLE=$G(TITLE)_" "
"RTN","PSOPOLY",78,0)
 S TITLE=TITLE_PSOSTA F I=1:1:STP S TITLE=TITLE_" "
"RTN","PSOPOLY",79,0)
 D:($Y+7)>IOSL HDR W !!,TITLE
"RTN","PSOPOLY",80,0)
 I $G(CLASS)="NVA" W !,DFN_" ("_VA("BID")_")",?40,"Total Non-VA Meds: "_$P(^TMP($J,DFN,CLASS),"^",2)
"RTN","PSOPOLY",81,0)
 F NVAO=0:0 S NVAO=$O(^PS(55,PSODFN,"NVA",NVAO)) Q:'NVAO  D
"RTN","PSOPOLY",82,0)
 .Q:$P(^PS(55,PSODFN,"NVA",NVAO,0),"^",7)  Q:'$P(^PS(55,PSODFN,"NVA",NVAO,0),"^")
"RTN","PSOPOLY",83,0)
 .S DUPRX0=^PS(55,PSODFN,"NVA",NVAO,0)
"RTN","PSOPOLY",84,0)
 .I ($Y+7)>IOSL D HDR W !!,TITLE,!,$P(^DPT(PSODFN,0),"^")_" ("_VA("BID")_")"
"RTN","PSOPOLY",85,0)
 .S DOI=$S($P(DUPRX0,"^",2):$P(^PSDRUG($P(DUPRX0,"^",2),0),"^"),1:$P(^PS(50.7,$P(DUPRX0,"^"),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^"))
"RTN","PSOPOLY",86,0)
 .W !?2,DOI_" "_$P(DUPRX0,"^",3)
"RTN","PSOPOLY",87,0)
 .W !?5,"Schedule: "_$P(DUPRX0,"^",5)
"RTN","PSOPOLY",88,0)
 .W !?5,"Start Date: "_$$FMTE^XLFDT($P(DUPRX0,"^",9)),?45," Documented: "_$$FMTE^XLFDT($P(DUPRX0,"^",10)) ;_"  Status: Active"
"RTN","PSOPOLY",89,0)
 K DUPRX0,NVA,STP,STR,PSOSTA,TITLE,DOI
"RTN","PSOPOLY",90,0)
 Q
"RTN","PSOPRF")
0^57^B35553625^B35881363
"RTN","PSOPRF",1,0)
PSOPRF ;BHAM ISC/SAB - PRINTS A PROFILE ;11/18/92
"RTN","PSOPRF",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**19,132,300,320,326**;DEC 1997;Build 11
"RTN","PSOPRF",3,0)
 ;External reference to File #55 supported by DBIA 2228
"RTN","PSOPRF",4,0)
 ;External reference ^PS(50.606 supported by DBIA 2174
"RTN","PSOPRF",5,0)
 ;External reference ^PS(50.7 supported by DBIA 2223
"RTN","PSOPRF",6,0)
 ;External reference ^PSDRUG( supported by DBIA 221
"RTN","PSOPRF",7,0)
 ;PHARMACIST IN REVEIWING RX'S WHEN ADDING A 'NEW' RX
"RTN","PSOPRF",8,0)
Q D CUTDATE^PSOFUNC
"RTN","PSOPRF",9,0)
QOLD D PLBL^PSORXL
"RTN","PSOPRF",10,0)
 Q
"RTN","PSOPRF",11,0)
 ;
"RTN","PSOPRF",12,0)
DQ S:'$D(PFIO) PFIO=IO D START D KILL^%ZTLOAD Q
"RTN","PSOPRF",13,0)
 ;
"RTN","PSOPRF",14,0)
START D:('$D(PSOBMST)) EN1P^PSOBSET K Z S IOP=PFIO D ^%ZIS U IO I '$D(PSODTCUT) D CUTDATE^PSOFUNC
"RTN","PSOPRF",15,0)
 S:'$D(Z) Z=1 S:'$D(NEW1) (NEW1,NEW11)="^" S %DT="",X="T" D ^%DT S DT=Y S X1=DT,X2=-365 D C^%DTC S EXPS=X S X1=DT,X2=-182 D C^%DTC S EXP=X
"RTN","PSOPRF",16,0)
 K ^TMP($J,"PRF") S LINE="" F I=1:1:110 S LINE=LINE_"-"
"RTN","PSOPRF",17,0)
 F RXX=0:0 S RXX=$O(^PS(55,DFN,"P",RXX)) Q:'RXX  S RXNN=+^(RXX,0) I $D(^PSRX(RXNN,0)),$P($G(^("STA")),"^")'=13 S RXPX=^PSRX(RXNN,0),$P(RXPX,"^",15)=$P($G(^("STA")),"^"),RXPX2=^(2) D CHK
"RTN","PSOPRF",18,0)
 D HD I '$D(^TMP($J,"PRF")) W !!?Z+15,"****** NO RX DATA ******",! G PPP
"RTN","PSOPRF",19,0)
 ;
"RTN","PSOPRF",20,0)
SD F SD="A","C","S" W:SD="S" !,?Z+1,"SUPPLIES",$E(LINE,1,89) I $D(^TMP($J,"PRF",SD)) S DRNME="" D DRNME
"RTN","PSOPRF",21,0)
PPP D PEND,NVA
"RTN","PSOPRF",22,0)
 W !!,"NAME: "_$P(^DPT(DFN,0),"^"),!
"RTN","PSOPRF",23,0)
 W:IOF]"" @IOF K ^TMP($J,"PRF"),A,B,DRNME,DRP,EXP,EXPS,I,II,ISSD,J,LINE,LN,MESS,MJK,NEW1,NEW11,PHYS,POP,QTY,TTTT,RFL,RFS,RXF,RXNN,RXPX,RXPX2,RXPNO,RXX,SD,SIG,STA,X,X1,X2,Y,Z
"RTN","PSOPRF",24,0)
 Q
"RTN","PSOPRF",25,0)
 ;
"RTN","PSOPRF",26,0)
DRNME S DRNME=$O(^TMP($J,"PRF",SD,DRNME)) Q:DRNME=""  D ISSD G DRNME
"RTN","PSOPRF",27,0)
 ;
"RTN","PSOPRF",28,0)
ISSD F ISSD=0:0 S ISSD=$O(^TMP($J,"PRF",SD,DRNME,ISSD)) Q:'ISSD  S RXPNO="" D RXPNO
"RTN","PSOPRF",29,0)
 Q
"RTN","PSOPRF",30,0)
 ;
"RTN","PSOPRF",31,0)
RXPNO S RXPNO=$O(^TMP($J,"PRF",SD,DRNME,ISSD,RXPNO)) Q:RXPNO=""  S RXNN=^(RXPNO) I $D(^PSRX(RXNN,0)) S RXPX=^(0),RXPX2=^(2) D PRT G RXPNO
"RTN","PSOPRF",32,0)
 W "END***************"
"RTN","PSOPRF",33,0)
 ;
"RTN","PSOPRF",34,0)
CHK Q:PSODTCUT>$P(RXPX2,"^",6)
"RTN","PSOPRF",35,0)
 I $P(^PSRX(RXNN,"STA"),"^")=12 S II=RXNN D LAST^PSORFL Q:PSODTCUT>RFDATE
"RTN","PSOPRF",36,0)
 I $P(RXPX,"^",3)=7!($P(RXPX,"^",3)=8)&('PSOPRPAS) Q
"RTN","PSOPRF",37,0)
 S J="^"_RXNN_"^" Q:(NEW1[J)!(NEW11[J)  Q:$P(RXPX,"^",13)<EXPS  S RXPNO=$P(RXPX,"^"),ISSD=$P(RXPX,"^",13)
"RTN","PSOPRF",38,0)
 Q:'$D(^PSDRUG($P(RXPX,"^",6),0))  S DRP=^(0),SD=$S($P(DRP,"^",3)["S":"S",$P(RXPX,"^",15)=12:"C",1:"A"),DRNME=$P(DRP,"^"),^TMP($J,"PRF",SD,DRNME,ISSD,RXPNO)=RXNN
"RTN","PSOPRF",39,0)
 Q
"RTN","PSOPRF",40,0)
 ;
"RTN","PSOPRF",41,0)
PRT S RFS=$P(RXPX,"^",9),QTY=$P(RXPX,"^",7)
"RTN","PSOPRF",42,0)
 S PHYS=$S($D(^VA(200,$P(RXPX,"^",4),0)):$P(^(0),"^"),1:"UNKNOWN"),II=RXNN D LAST^PSORFL S RXF=0 F MJK=0:0 S MJK=$O(^PSRX(RXNN,1,MJK)) Q:'MJK  S RXF=RXF+1
"RTN","PSOPRF",43,0)
 S STA=$S($P(^PSRX(RXNN,"STA"),"^")=14:"DC",$P(^PSRX(RXNN,"STA"),"^")=15:"DE",$P(^PSRX(RXNN,"STA"),"^")=16:"PH",1:$E("ANRHPS     ECD",(1+$P(^PSRX(RXNN,"STA"),"^")))),STA=$S(DT>$P(RXPX2,"^",6):"E",1:STA)
"RTN","PSOPRF",44,0)
 W !,?Z+1,RXPNO,?Z+15,DRNME,?Z+55,$E(ISSD,4,5),"/",$E(ISSD,6,7)," ",$E(RFL,1,5)," ",?Z+67,$J(RFS,2)," ",$J(RXF,2)," ",?Z+73,$J(QTY,12)," ",?Z+86,STA," ",?Z+88,$E(PHYS,1,20)
"RTN","PSOPRF",45,0)
 D SIG F TTTT=0:0 S TTTT=$O(FSIG(TTTT)) Q:'TTTT  W !,?Z+19,FSIG(TTTT)
"RTN","PSOPRF",46,0)
 Q
"RTN","PSOPRF",47,0)
 ;
"RTN","PSOPRF",48,0)
HD D PID^VADPT
"RTN","PSOPRF",49,0)
 W !,?Z+17,"PRESCRIPTION PROFILE AS OF ",$E(DT,4,5),"/",$E(DT,6,7),"/",($E(DT,1,3)+1700),!!,?Z+20,"NAME: "_$P(^DPT(DFN,0),"^")
"RTN","PSOPRF",50,0)
 I $D(^PS(55,DFN,1)) S MESS=^(1),LN=$L(MESS),A=0 W ! F B=1:1 Q:$P(MESS," ",B,99)=""  W:$X>(Z+63) ! W ?Z+31,$P(MESS," ",B)," "
"RTN","PSOPRF",51,0)
 I $$RDI^PSORMRX(DFN) W !!,"THIS PATIENT HAS PRESCRIPTIONS AT OTHER FACILITIES"
"RTN","PSOPRF",52,0)
 W !!?Z+20,"PHARMACIST: ___________________________  DATE: ____________"
"RTN","PSOPRF",53,0)
 W !!?Z+52,"   DATES   ",?Z+67,"REFS ",?Z+86,"S"
"RTN","PSOPRF",54,0)
 W !?Z+1,"RX #     ",?Z+15,"DRUG/STRENGTH/SIG",?Z+55,"ISSD  LAST ",?Z+67,"AL AC",?Z+77,"QTY",?Z+86,"T",?Z+93,"PROVIDER"
"RTN","PSOPRF",55,0)
 W !?Z+1,$E(LINE,1,12),?Z+15,$E(LINE,1,35),?Z+55,"----- -----",?Z+67,"-- --",?Z+73,"------------",?Z+86,"-",?Z+88,$E(LINE,1,20)
"RTN","PSOPRF",56,0)
 Q
"RTN","PSOPRF",57,0)
SIG ;Format Sig
"RTN","PSOPRF",58,0)
 S PSPROSIG=$P($G(^PSRX(RXNN,"SIG")),"^",2) K FSIG,BSIG D
"RTN","PSOPRF",59,0)
 .I PSPROSIG D FSIG^PSOUTLA("R",RXNN,80) Q
"RTN","PSOPRF",60,0)
 .D EN2^PSOUTLA1(RXNN,80) F GGGGG=0:0 S GGGGG=$O(BSIG(GGGGG)) Q:'GGGGG  S FSIG(GGGGG)=BSIG(GGGGG)
"RTN","PSOPRF",61,0)
 K PSPROSIG,GGGGG,BSIG Q
"RTN","PSOPRF",62,0)
PEND ;Print Pending Orders
"RTN","PSOPRF",63,0)
 N PSPCOUNT,PSPPEND,ZXXX,PSPSTAT,FSIGZZ,PZZDRUG,PSSODRUG,PZXZERO,PPPPP,GGGGG
"RTN","PSOPRF",64,0)
 S PSPCOUNT=1,PSPPEND="" F PPPPP=0:0 S PPPPP=$O(^PS(52.41,"P",DFN,PPPPP)) Q:'PPPPP  S PSPSTAT=$P($G(^PS(52.41,PPPPP,0)),"^",3) I PSPSTAT="NW"!(PSPSTAT="HD")!(PSPSTAT="RNW") S PSPPEND(PSPCOUNT)=PPPPP,PSPCOUNT=PSPCOUNT+1
"RTN","PSOPRF",65,0)
 Q:'$O(PSPPEND(0))
"RTN","PSOPRF",66,0)
 W !!,?48,"PENDING ORDERS",!,LINE,!
"RTN","PSOPRF",67,0)
 F ZXXX=0:0 S ZXXX=$O(PSPPEND(ZXXX)) Q:'ZXXX  S PZXZERO=$G(^PS(52.41,PSPPEND(ZXXX),0)) D:$P(PZXZERO,"^")
"RTN","PSOPRF",68,0)
 .S PZZDRUG=$P(PZXZERO,"^",9),PZZODRUG=$P(PZXZERO,"^",8)
"RTN","PSOPRF",69,0)
 .W !,"Drug: ",$S(PZZDRUG:$P($G(^PSDRUG(+PZZDRUG,0)),"^"),1:$P($G(^PS(50.7,+PZZODRUG,0)),"^")_" "_$P($G(^PS(50.606,+$P($G(^(0)),"^",2),0)),"^"))
"RTN","PSOPRF",70,0)
 .W !?3,"Eff. Date: ",$E($P(PZXZERO,"^",6),4,5)_"/"_$E($P(PZXZERO,"^",6),6,7)_"/"_($E($P(PZXZERO,"^",6),1,3)+1700)
"RTN","PSOPRF",71,0)
 .W ?25,"Qty: ",$P(PZXZERO,"^",10),?50,"Refills: ",$P(PZXZERO,"^",11),?65,"Provider: ",$P($G(^VA(200,+$P(PZXZERO,"^",5),0)),"^")
"RTN","PSOPRF",72,0)
 .D FSIG^PSOUTLA("P",PSPPEND(ZXXX),100) W !?3,"Sig: ",$G(FSIG(1)) F FSIGZZ=1:0 S FSIGZZ=$O(FSIG(FSIGZZ)) Q:'FSIGZZ  W !?8,$G(FSIG(FSIGZZ))
"RTN","PSOPRF",73,0)
 Q
"RTN","PSOPRF",74,0)
NVA ;displays non-va meds
"RTN","PSOPRF",75,0)
 Q:'$G(DFN)!('$O(^PS(55,DFN,"NVA",0)))
"RTN","PSOPRF",76,0)
 W !!?48,"Non-VA MEDS (Not dispensed by VA)",!,LINE
"RTN","PSOPRF",77,0)
 F NVA=0:0 S NVA=$O(^PS(55,DFN,"NVA",NVA)) Q:'NVA  D
"RTN","PSOPRF",78,0)
 .S DUPRX0=^PS(55,DFN,"NVA",NVA,0) Q:'$P(DUPRX0,"^")
"RTN","PSOPRF",79,0)
 .W !!,"Orderable Item: "_$P(^PS(50.7,$P(DUPRX0,"^"),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^")_"   Drug: "_$S($P(DUPRX0,"^",2):$P(^PSDRUG($P(DUPRX0,"^",2),0),"^"),1:"No Dispense Drug Selected")
"RTN","PSOPRF",80,0)
 .W !,"Status: "_$S($P(DUPRX0,"^",7):"Discontinued ("_$$FMTE^XLFDT($P($P(DUPRX0,"^",7),"."))_")",1:"Active")
"RTN","PSOPRF",81,0)
 .W !,"Drug Class: "_$S($P(DUPRX0,"^",2):$P(^PSDRUG($P(DUPRX0,"^",2),0),"^",2),1:"")
"RTN","PSOPRF",82,0)
 .W !,"Dosage: "_$P(DUPRX0,"^",3),!,"Schedule: "_$P(DUPRX0,"^",5),!,"Medication Route: "_$P(DUPRX0,"^",4)
"RTN","PSOPRF",83,0)
 .W !,"Start Date: "_$$FMTE^XLFDT($P(DUPRX0,"^",9)),?40,"CPRS Order #: "_$P(DUPRX0,"^",8)
"RTN","PSOPRF",84,0)
 .W !,"Documented By: "_$P(^VA(200,$P(DUPRX0,"^",11),0),"^")_" on "_$$FMTE^XLFDT($P(DUPRX0,"^",10))
"RTN","PSOPRF",85,0)
 W ! K NVA,DUPRXO
"RTN","PSOPRF",86,0)
 Q
"RTN","PSOPRFSS")
0^58^B16605168^B16818686
"RTN","PSOPRFSS",1,0)
PSOPRFSS ;BHAM ISC/SAB - PRINTS A PROFILE FROM SUSPENSE ; 11/18/92 19:38
"RTN","PSOPRFSS",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**19,300,320,326**;DEC 1997;Build 11
"RTN","PSOPRFSS",3,0)
 ;PHARMACIST IN REVEIWING RX'S WHEN ADDING A 'NEW' RX
"RTN","PSOPRFSS",4,0)
Q D CUTDATE^PSOFUNC
"RTN","PSOPRFSS",5,0)
QOLD D PLBL^PSORXL
"RTN","PSOPRFSS",6,0)
 Q
"RTN","PSOPRFSS",7,0)
 ;
"RTN","PSOPRFSS",8,0)
DQ D START Q
"RTN","PSOPRFSS",9,0)
 ;
"RTN","PSOPRFSS",10,0)
START D:('$D(PSOBMST)) EN1P^PSOBSET K Z I '$D(PSODTCUT) D CUTDATE^PSOFUNC
"RTN","PSOPRFSS",11,0)
 S:'$D(Z) Z=1 S:'$D(NEW1) (NEW1,NEW11)="^" S %DT="",X="T" D ^%DT S DT=Y S X1=DT,X2=-365 D C^%DTC S EXPS=X S X1=DT,X2=-182 D C^%DTC S EXP=X
"RTN","PSOPRFSS",12,0)
 K ^TMP($J,"PRF") S LINE="" F I=1:1:110 S LINE=LINE_"-"
"RTN","PSOPRFSS",13,0)
 F RXX=0:0 S RXX=$O(^PS(55,DFN,"P",RXX)) Q:'RXX  S RXNN=+^(RXX,0) I $D(^PSRX(RXNN,0)),$P($G(^("STA")),"^")'=13 S RXPX=^PSRX(RXNN,0),$P(RXPX,"^",15)=$P($G(^("STA")),"^"),RXPX2=^(2) D CHK
"RTN","PSOPRFSS",14,0)
 D HD I '$D(^TMP($J,"PRF")) W !!?Z+15,"****** NO RX DATA ******",! G PPP
"RTN","PSOPRFSS",15,0)
 ;
"RTN","PSOPRFSS",16,0)
SD F SD="A","C","S" W:SD="S" !,?Z+1,"SUPPLIES",$E(LINE,1,89) I $D(^TMP($J,"PRF",SD)) S DRNME="" D DRNME
"RTN","PSOPRFSS",17,0)
PPP D PEND^PSOPRF
"RTN","PSOPRFSS",18,0)
 W !!,"NAME: "_$P(^DPT(DFN,0),"^"),!
"RTN","PSOPRFSS",19,0)
 W:IOF]"" @IOF K ^TMP($J,"PRF"),A,B,DRNME,DRP,EXP,EXPS,I,II,ISSD,J,LINE,LN,MESS,MJK,NEW1,NEW11,PHYS,POP,QTY,TTTT,RFL,RFS,RXF,RXNN,RXPX,RXPX2,RXPNO,RXX,SD,SIG,STA,X,X1,X2,Y,Z
"RTN","PSOPRFSS",20,0)
 Q
"RTN","PSOPRFSS",21,0)
 ;
"RTN","PSOPRFSS",22,0)
DRNME S DRNME=$O(^TMP($J,"PRF",SD,DRNME)) Q:DRNME=""  D ISSD G DRNME
"RTN","PSOPRFSS",23,0)
 ;
"RTN","PSOPRFSS",24,0)
ISSD F ISSD=0:0 S ISSD=$O(^TMP($J,"PRF",SD,DRNME,ISSD)) Q:'ISSD  S RXPNO="" D RXPNO
"RTN","PSOPRFSS",25,0)
 Q
"RTN","PSOPRFSS",26,0)
 ;
"RTN","PSOPRFSS",27,0)
RXPNO S RXPNO=$O(^TMP($J,"PRF",SD,DRNME,ISSD,RXPNO)) Q:RXPNO=""  S RXNN=^(RXPNO) I $D(^PSRX(RXNN,0)) S RXPX=^(0),RXPX2=^(2) D PRT G RXPNO
"RTN","PSOPRFSS",28,0)
 W "END***************"
"RTN","PSOPRFSS",29,0)
 ;
"RTN","PSOPRFSS",30,0)
CHK Q:PSODTCUT>$P(RXPX2,"^",6)
"RTN","PSOPRFSS",31,0)
 I $P(^PSRX(RXNN,"STA"),"^")=12 S II=RXNN D LAST^PSORFL Q:PSODTCUT>RFDATE
"RTN","PSOPRFSS",32,0)
 I $P(RXPX,"^",3)=7!($P(RXPX,"^",3)=8)&('PSOPRPAS) Q
"RTN","PSOPRFSS",33,0)
 S J="^"_RXNN_"^" Q:(NEW1[J)!(NEW11[J)  Q:$P(RXPX,"^",13)<EXPS  S RXPNO=$P(RXPX,"^"),ISSD=$P(RXPX,"^",13)
"RTN","PSOPRFSS",34,0)
 Q:'$D(^PSDRUG($P(RXPX,"^",6),0))  S DRP=^(0),SD=$S($P(DRP,"^",3)["S":"S",$P(RXPX,"^",15)=12:"C",1:"A"),DRNME=$P(DRP,"^"),^TMP($J,"PRF",SD,DRNME,ISSD,RXPNO)=RXNN
"RTN","PSOPRFSS",35,0)
 Q
"RTN","PSOPRFSS",36,0)
 ;
"RTN","PSOPRFSS",37,0)
PRT S RFS=$P(RXPX,"^",9),QTY=$P(RXPX,"^",7)
"RTN","PSOPRFSS",38,0)
 S PHYS=$S($D(^VA(200,$P(RXPX,"^",4),0)):$P(^(0),"^"),1:"UNKNOWN"),II=RXNN D LAST^PSORFL S RXF=0 F MJK=0:0 S MJK=$O(^PSRX(RXNN,1,MJK)) Q:'MJK  S RXF=RXF+1
"RTN","PSOPRFSS",39,0)
 S STA=$S($P(^PSRX(RXNN,"STA"),"^")=14:"DC",$P(^PSRX(RXNN,"STA"),"^")=15:"DE",$P(^PSRX(RXNN,"STA"),"^")=16:"PH",1:$E("ANRHPS     ECD",(1+$P(^PSRX(RXNN,"STA"),"^")))),STA=$S(DT>$P(RXPX2,"^",6):"E",1:STA)
"RTN","PSOPRFSS",40,0)
 W !,?Z+1,RXPNO,?Z+15,DRNME,?Z+55,$E(ISSD,4,5),"/",$E(ISSD,6,7)," ",$E(RFL,1,5)," ",?Z+67,$J(RFS,2)," ",$J(RXF,2)," ",?Z+73,$J(QTY,12)," ",?Z+86,STA," ",?Z+88,$E(PHYS,1,20)
"RTN","PSOPRFSS",41,0)
 D SIG^PSOPRF F TTTT=0:0 S TTTT=$O(FSIG(TTTT)) Q:'TTTT  W !,?Z+19,FSIG(TTTT)
"RTN","PSOPRFSS",42,0)
 Q
"RTN","PSOPRFSS",43,0)
 ;
"RTN","PSOPRFSS",44,0)
HD D PID^VADPT
"RTN","PSOPRFSS",45,0)
 W !,?Z+17,"PRESCRIPTION PROFILE AS OF ",$E(DT,4,5),"/",$E(DT,6,7),"/",($E(DT,1,3)+1700)
"RTN","PSOPRFSS",46,0)
 W !!,?Z+20,"NAME: ",$P(^DPT(DFN,0),"^")
"RTN","PSOPRFSS",47,0)
 I $D(^PS(55,DFN,1)) S MESS=^(1),LN=$L(MESS),A=0 W ! F B=1:1 Q:$P(MESS," ",B,99)=""  W:$X>(Z+63) ! W ?Z+31,$P(MESS," ",B)," "
"RTN","PSOPRFSS",48,0)
 I $$RDI^PSORMRX(DFN) W !!,"THIS PATIENT HAS PRESCRIPTIONS AT OTHER FACILITIES"
"RTN","PSOPRFSS",49,0)
 W !!?Z+20,"PHARMACIST: ___________________________  DATE: ____________"
"RTN","PSOPRFSS",50,0)
 W !!?Z+52,"   DATES   ",?Z+67,"REFS ",?Z+86,"S"
"RTN","PSOPRFSS",51,0)
 W !?Z+1,"RX #     ",?Z+15,"DRUG/STRENGTH/SIG",?Z+55,"ISSD  LAST ",?Z+67,"AL AC",?Z+77,"QTY",?Z+86,"T",?Z+93,"PROVIDER"
"RTN","PSOPRFSS",52,0)
 W !?Z+1,$E(LINE,1,12),?Z+15,$E(LINE,1,35),?Z+55,"----- -----",?Z+67,"-- --",?Z+73,"------------",?Z+86,"-",?Z+88,$E(LINE,1,20)
"RTN","PSORX1")
0^12^B59378115^B59085291
"RTN","PSORX1",1,0)
PSORX1 ;BIR/SAB-medication processing driver ;8/20/08 7:39am
"RTN","PSORX1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**7,22,23,57,62,46,74,71,90,95,115,117,146,139,135,182,195,233,268,300,170,320,326**;DEC 1997;Build 11
"RTN","PSORX1",3,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSORX1",4,0)
 ;External reference ^DIC(31 supported by DBIA 658
"RTN","PSORX1",5,0)
 ;External reference ^DPT(D0,.372 supported by DBIA 1476
"RTN","PSORX1",6,0)
 ;External reference DISPPRF^DGPFAPI supported by DBIA #4563
"RTN","PSORX1",7,0)
 ;External reference ^ORRDI1 is supported by DBIA 4659
"RTN","PSORX1",8,0)
 ;External reference ^XTMP("ORRDI" is supported by DBIA 4660
"RTN","PSORX1",9,0)
 ;External reference ^PSUHL supported by DBIA 4803
"RTN","PSORX1",10,0)
 ;
"RTN","PSORX1",11,0)
 ;PSO*195 add call to display Patient Record Flag (DISPPRF^DGPFAPI)
"RTN","PSORX1",12,0)
 ;
"RTN","PSORX1",13,0)
START K PSOQFLG,PSOID,PSOFIN,PSOQUIT,PSODRUG S (PSOBCK,PSOERR)=1 D INIT G:PSORX("QFLG") END
"RTN","PSORX1",14,0)
 D PT G:$G(PSORX("QFLG")) END D FULL^VALM1 I $G(NOPROC) K NOPROC G NX
"RTN","PSORX1",15,0)
 ;call to add bingo board data to file 52.11
"RTN","PSORX1",16,0)
 F SLPPL=0:0 S SLPPL=$O(RXRS(SLPPL)) Q:'SLPPL  D
"RTN","PSORX1",17,0)
 .I $P($G(^PSRX(SLPPL,"STA")),"^")'=5 K RXRS(SLPPL) Q
"RTN","PSORX1",18,0)
 .S RXREC=SLPPL D WIND^PSOSUPOE I $G(PBINGRTE) D BBADD^PSOSUPOE S (BINGCRT,BINGRTE)=1 S:$G(PSOFROM)'="NEW" PSOFROM="REFILL"
"RTN","PSORX1",19,0)
 K TM,TM1 I $G(PSORX("PSOL",1))]""!($D(RXRS)) D ^PSORXL K PSORX
"RTN","PSORX1",20,0)
 G:$G(NOBG) NX
"RTN","PSORX1",21,0)
 S TM=$P(^TMP("PSOBB",$J),"^"),TM1=$P(^TMP("PSOBB",$J),"^",2) K ^TMP("PSOBB",$J)
"RTN","PSORX1",22,0)
 I $G(PSOFROM)="NEW"!($G(PSOFROM)="REFILL")!($G(PSOFROM)="PARTIAL") D:$D(BINGCRT)&($D(BINGRTE)&($D(DISGROUP))) ^PSOBING1 K BINGCRT,BINGRTE,BBRX,BBFLG
"RTN","PSORX1",23,0)
NX I $G(POERR("DEAD"))!$G(PSOQFLG) D EOJ G START
"RTN","PSORX1",24,0)
 D EOJ G START
"RTN","PSORX1",25,0)
END Q
"RTN","PSORX1",26,0)
 ;---------------------------------------------------------
"RTN","PSORX1",27,0)
INIT ;
"RTN","PSORX1",28,0)
 S PSORX("QFLG")=0
"RTN","PSORX1",29,0)
 D:'$D(PSOPAR) ^PSOLSET I '$D(PSOPAR) S PSORX("QFLG")=1
"RTN","PSORX1",30,0)
 I $P($G(PSOPAR),"^",2),'$D(^XUSEC("PSORPH",DUZ)) S PSORX("VERIFY")=1
"RTN","PSORX1",31,0)
INITX Q
"RTN","PSORX1",32,0)
 ;
"RTN","PSORX1",33,0)
PT ;
"RTN","PSORX1",34,0)
 K ^TMP("PSORXDC",$J),CLOZPAT,DIC,PSODFN,PSOPTLK S PSORX("QFLG")=0,DIC(0)="QEAM" D EN^PSOPATLK S Y=PSOPTLK
"RTN","PSORX1",35,0)
 I +Y'>0 S PSORX("QFLG")=1 G PTX
"RTN","PSORX1",36,0)
OERR N:$G(MEDP) PAT,POERR K PSOXFLG S (DFN,PSODFN)=+Y,PSORX("NAME")=$P(Y,"^",2)
"RTN","PSORX1",37,0)
 K NPPROC,PSOQFLG,DIC,DR,DIQ S DIC=2,DA=PSODFN,DR=.351,DIQ="PSOPTPST" D EN^DIQ1 K DIC,DA,DR,DIQ D DEAD^PSOPTPST I $G(PSOQFLG) S NOPROC=1 Q
"RTN","PSORX1",38,0)
 ;PSO*195 move SSN write to here and add DISPPRF call
"RTN","PSORX1",39,0)
 S SSN=$P(^DPT(PSODFN,0),"^",9) W !!?10,$C(7),PSORX("NAME")
"RTN","PSORX1",40,0)
 W " ("_$E(SSN,1,3)_"-"_$E(SSN,4,5)_"-"_$E(SSN,6,9)_")" K SSN
"RTN","PSORX1",41,0)
 S PSONOAL="" D ALLERGY^PSOORUT2 D  I PSONOAL'="" D PAUSE
"RTN","PSORX1",42,0)
 .I PSONOAL'="" W !,$C(7),"     No Allergy Assessment!"
"RTN","PSORX1",43,0)
 D REMOTE
"RTN","PSORX1",44,0)
 N PSOUPDT
"RTN","PSORX1",45,0)
 S PSOUPDT=1
"RTN","PSORX1",46,0)
 I $G(XQY0)["PSO LMOE FINISH" S PSOUPDT=0
"RTN","PSORX1",47,0)
 D CHKADDR^PSOBAI(PSODFN,1,PSOUPDT)
"RTN","PSORX1",48,0)
 D:(XQY0["PSO LMOE FINISH")&('$G(SNGLPAT)) DISPPRF^DGPFAPI(PSODFN)
"RTN","PSORX1",49,0)
 ;
"RTN","PSORX1",50,0)
 I $P($G(^PS(55,PSODFN,"LAN")),"^") W !?10,"Patient has another language preference!",! H 3
"RTN","PSORX1",51,0)
 I $G(^PS(55,"ASTALK",PSODFN)) W !,"Patient is enrolled to receive ScripTalk 'talking' prescription labels.",! H 2 D MAIL
"RTN","PSORX1",52,0)
 D NOW^%DTC S TM=$E(%,1,12),TM1=$P(TM,".",2) S ^TMP("PSOBB",$J)=TM_"^"_TM1
"RTN","PSORX1",53,0)
 ;Call to display remote/local prescriptions
"RTN","PSORX1",54,0)
 I '$G(PSOFIN) D RDICHK^PSORMRX(PSODFN)
"RTN","PSORX1",55,0)
 S PSOQFLG=0,DIC="^PS(55,",DLAYGO=55
"RTN","PSORX1",56,0)
 I '$D(^PS(55,PSODFN,0)) D
"RTN","PSORX1",57,0)
 .K DD,DO S DIC(0)="L",(DINUM,X)=PSODFN D FILE^DICN D:Y<1  K DIC,DA,DR,DD,DO
"RTN","PSORX1",58,0)
 ..S $P(^PS(55,PSODFN,0),"^")=PSODFN K DIK S DA=PSODFN,DIK="^PS(55,",DIK(1)=.01 D EN^DIK K DIK
"RTN","PSORX1",59,0)
 D RXSTA
"RTN","PSORX1",60,0)
 S PSOLOUD=1 D:$P($G(^PS(55,PSODFN,0)),"^",6)'=2 EN^PSOHLUP(PSODFN) K PSOLOUD
"RTN","PSORX1",61,0)
 I $G(^PS(55,PSODFN,"PS"))']"" D  I $G(POERR("QFLG")) G EOJ
"RTN","PSORX1",62,0)
 .L +^PS(55,PSODFN):$S(+$G(^DD("DILOCKTM"))>0:+^DD("DILOCKTM"),1:3) I '$T W $C(7),!!,"Patient Data is Being Edited by Another User!",! S POERR("QFLG")=1 S:$G(PSOFIN) PSOQUIT=1 Q
"RTN","PSORX1",63,0)
 .S PSOXFLG=1,SSN=$P(^DPT(PSODFN,0),"^",9) W !!?10,$C(7),PSORX("NAME")_" ("_$E(SSN,1,3)_"-"_$E(SSN,4,5)_"-"_$E(SSN,6,9)_")",! K SSN
"RTN","PSORX1",64,0)
 .S DIE=55,DR=".02;.03;.04;.05;1;D ELIG^PSORX1;3;50;106;106.1",DA=PSODFN W !!,?5,">>PHARMACY PATIENT DATA<<",! D ^DIE L -^PS(55,PSODFN)
"RTN","PSORX1",65,0)
 S PSOX=$G(^PS(55,PSODFN,"PS")) I PSOX]"" S PSORX("PATIENT STATUS")=$P($G(^PS(53,PSOX,0)),"^")
"RTN","PSORX1",66,0)
 I $G(^PS(55,PSODFN,"PS"))']"" D  I $G(POERR("QFLG")) G EOJ
"RTN","PSORX1",67,0)
 .W !!,"Patient Status Required!!",! D ELIG
"RTN","PSORX1",68,0)
 .W ! K POERR("QFLG"),DIC,DR,DIE S DIC("A")="RX PATIENT STATUS: ",DIC(0)="QEAMZ",DIC=53 D ^DIC K DIC
"RTN","PSORX1",69,0)
 .I $D(DIRUT)!(Y=-1) D  Q
"RTN","PSORX1",70,0)
 ..W $C(7),"Required Data!",! S POERR("QFLG")=1 S:$G(PSOFIN) PSOQUIT=1
"RTN","PSORX1",71,0)
 ..I $O(^PS(55,PSODFN,0))="" S DA=PSODFN,DIK="^PS(55," D ^DIK
"RTN","PSORX1",72,0)
 .S ^PS(55,PSODFN,"PS")=+Y,PSORX("PATIENT STATUS")=$P(^PS(53,+Y,0),"^")
"RTN","PSORX1",73,0)
 .K DIRUT,DTOUT,DUOUT,X,Y,DA
"RTN","PSORX1",74,0)
 Q:$G(PSOFIN)
"RTN","PSORX1",75,0)
 D ^PSOBUILD
"RTN","PSORX1",76,0)
 F PT="GET","DEAD","INP","CNH","TPB","ADDRESS","COPAY" S RTN=PT_"^PSOPTPST" D @RTN Q:$G(POERR("DEAD"))!($G(PSOQFLG))
"RTN","PSORX1",77,0)
 I $G(POERR("DEAD")) S POERR("QFLG")=1 F II=0:0 S II=$O(^PS(52.41,"P",PSODFN,II)) D:$P($G(^PS(52.41,II,0)),"^",3)'="DC"&($P($G(^(0)),"^",3)'="DE") DC^PSOORFI2
"RTN","PSORX1",78,0)
 K PSOERR("DEAD"),II I $G(PSOQFLG) S POERR("QFLG")=1 G EOJ Q
"RTN","PSORX1",79,0)
 S (PAT,PSOXXDFN)=PSODFN,POERR=1 D ^PSOORUT2,BLD^PSOORUT1,EN^PSOLMUTL
"RTN","PSORX1",80,0)
 D CLEAR^VALM1 G:$G(PSOQUIT) PTX D EN^PSOLMAO
"RTN","PSORX1",81,0)
 S (DFN,PSODFN)=PSOXXDFN K DIE,DIC,DLAYGO,DR,DA,PSOX,PSORXED
"RTN","PSORX1",82,0)
 I $O(RXFL("")),$P(^PS(55,PSODFN,0),"^",7)="" D
"RTN","PSORX1",83,0)
 . N %
"RTN","PSORX1",84,0)
 . D NOW^%DTC
"RTN","PSORX1",85,0)
 . S $P(^PS(55,PSODFN,0),"^",7)=$E(%,1,12),$P(^(0),"^",8)="A" D LOGDFN^PSUHL(PSODFN)
"RTN","PSORX1",86,0)
PTX ;
"RTN","PSORX1",87,0)
 K X,Y,^TMP("PS",$J),C,DEA,PRC,PSCNT,PSOACT,PSOCLC,PSOCS,PSOCT,PSOFINFL,PSOHD,PSOLST,PSOOPT,PSOPF,PSOX,PSOX1,PSOXXDFN,SIGOK,STP,STR,PSOPATLK
"RTN","PSORX1",88,0)
 Q
"RTN","PSORX1",89,0)
EOJ ;
"RTN","PSORX1",90,0)
 K PSOERR,PSOMED,PSORX,PSOSD,PSODRUG,PSODFN,PSOOPT,PSOBILL,PSOIBQS,PSOCPAY,PSOPF,PSOPI,COMM,DGI,DGS,PT,PTDY,PTRF,RN,RTN,SERS,ST0,STAT,DFN,STOP,SLPPL,RXREC
"RTN","PSORX1",91,0)
 K:'$G(MEDP) PSOQFLG
"RTN","PSORX1",92,0)
 D KVA^VADPT,FULL^VALM1 K PSOLST,PSOXFLG,PSCNT,PSDIS,PSOAL,P1,LOG,%,%DT,%I,D0,DAT,DFN,DRG,ORX,PSON,PSOPTPST,PSORX,PTST,PSOBCK,PSOID,PSOBXPUL
"RTN","PSORX1",93,0)
 K INCOM,SIG,SG,STP,RX0,RXN,RX2,RX3,RTS,C,DEAD,PS,PSOCLC,PSOCNT,PSOCT,PSODA,PSOFROM,PSOHD,R3,REA,RF,RFD,RFM,RLD,RXNUM,RXP,RXPR,RXRP,RXRS,STR,POERR,VALMSG
"RTN","PSORX1",94,0)
 K ^TMP("PSORXDC",$J),^TMP("PSOAL",$J),^TMP("PSOAO",$J),^TMP("PSOSF",$J),^TMP("PSOPF",$J),^TMP("PSOPI",$J),^TMP("PSOPO",$J),^TMP("PSOHDR",$J) I '$G(MEDP),'$G(PSOQUIT) K PAT
"RTN","PSORX1",95,0)
 K PSORX,RFN,PSOXXDFN,VALM,VALMKEY,PSOBCK,SPOERR,PSOFLAG,VALMBCK,D,GMRA,GMRAL,GMRAREC,PSOSTA,PSODT,RXFL,NOBG,BBRX,BBFLG
"RTN","PSORX1",96,0)
 Q
"RTN","PSORX1",97,0)
ELIG ; shows eligibility and disabilities
"RTN","PSORX1",98,0)
 D ELIG^VADPT W !,"Eligibility: "_$P(VAEL(1),"^",2)_$S(+VAEL(3):"     SC%: "_$P(VAEL(3),"^",2),1:"") S N=0 F  S N=$O(VAEL(1,N)) Q:'N  W !,?10,$P(VAEL(1,N),"^",2)
"RTN","PSORX1",99,0)
 W !,"Disabilities: " F I=0:0 S I=$O(^DPT(DFN,.372,I)) Q:'I  S I1=$S($D(^DPT(DFN,.372,I,0)):^(0),1:"") D:+I1
"RTN","PSORX1",100,0)
 .S PSDIS=$S($P($G(^DIC(31,+I1,0)),"^")]""&($P($G(^(0)),"^",4)']""):$P(^(0),"^"),$P($G(^DIC(31,+I1,0)),"^",4)]"":$P(^(0),"^",4),1:""),PSCNT=$P(I1,"^",2)
"RTN","PSORX1",101,0)
 .W:$L(PSDIS_"-"_PSCNT_"% ("_$S($P(I1,"^",3):"SC",1:"NSC")_"), ")>80 !,?15
"RTN","PSORX1",102,0)
 .W $S($G(PSDIS)]"":PSDIS_"-",1:"")_PSCNT_"% ("_$S($P(I1,"^",3):"SC",1:"NSC")_"), "
"RTN","PSORX1",103,0)
 K N
"RTN","PSORX1",104,0)
 Q
"RTN","PSORX1",105,0)
PROFILE ;
"RTN","PSORX1",106,0)
 S (PSORX("REFILL"),PSORX("RENEW"))=0,PSOX="" D ^PSOBUILD
"RTN","PSORX1",107,0)
 I '$G(PSOSD) W !,"This patient has no prescriptions" S:'$D(DFN) DFN=PSODFN D GMRA^PSODEM G PROFILEX
"RTN","PSORX1",108,0)
 S (PSODRG,PSOX)="" F  S PSODRG=$O(PSOSD(PSODRG)) Q:PSODRG=""  F  S PSOX=$O(PSOSD(PSODRG,PSOX)) Q:PSOX=""  S:$P(PSOSD(PSODRG,PSOX),"^",3)="" PSORX("RENEW")=1 S:$P(PSOSD(PSODRG,PSOX),"^",4)="" PSORX("REFILL")=1
"RTN","PSORX1",109,0)
 K PSOX
"RTN","PSORX1",110,0)
PROFILEX Q
"RTN","PSORX1",111,0)
 ;
"RTN","PSORX1",112,0)
MAIL ; MAKE SURE MAIL STATUS IS COMPATIBLE WITH SCRIPTALK PATIENT
"RTN","PSORX1",113,0)
 I $P($G(^PS(59,PSOSITE,"STALK")),"^")="" Q  ; NO SCRIPTALK PRINTER SET UP FOR THIS DIVISION
"RTN","PSORX1",114,0)
 N MAIL
"RTN","PSORX1",115,0)
 S MAIL=$G(^PS(55,PSODFN,0)) I $P(MAIL,"^",3)>1 Q
"RTN","PSORX1",116,0)
MAILP W !!,"REMINDER: CMOP does not fill ScripTalk prescriptions.Please select mail"
"RTN","PSORX1",117,0)
 W !,"status:  2 (DO NOT MAIL), 3 (LOCAL REGULAR MAIL) or 4 (LOCAL CERTFIED MAIL)."
"RTN","PSORX1",118,0)
 R !,"MAIL: ",MAIL:120
"RTN","PSORX1",119,0)
 I MAIL?1"^".E Q
"RTN","PSORX1",120,0)
 I MAIL<2!(MAIL>4) W !,"INVALID MAIL SETTING - ENTER 2,3, OR 4" G MAILP
"RTN","PSORX1",121,0)
 W "  ",$S(MAIL=2:"DO NOT MAIL",MAIL=3:"LOCAL REGULAR MAIL",1:"LOCAL CERTIFIED MAIL")
"RTN","PSORX1",122,0)
 S $P(^PS(55,PSODFN,0),"^",3)=MAIL
"RTN","PSORX1",123,0)
 Q
"RTN","PSORX1",124,0)
REMOTE ; 
"RTN","PSORX1",125,0)
 I $T(HAVEHDR^ORRDI1)']"" Q
"RTN","PSORX1",126,0)
 I '$$HAVEHDR^ORRDI1 Q
"RTN","PSORX1",127,0)
 I $D(^XTMP("ORRDI","OUTAGE INFO","DOWN")) W !,"Remote data not available - Only local order checks processed." D  Q
"RTN","PSORX1",128,0)
 .K DIR W ! S DIR(0)="EA",DIR("A")="Press Return to continue..." D ^DIR W ! K DIR
"RTN","PSORX1",129,0)
 Q
"RTN","PSORX1",130,0)
PAUSE ;
"RTN","PSORX1",131,0)
 W ! K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSORX1",132,0)
 Q
"RTN","PSORX1",133,0)
 ;
"RTN","PSORX1",134,0)
RXSTA ; DISPLAY ELIGIBILITY & PROMPT FOR RX PATIENT STATUS
"RTN","PSORX1",135,0)
 N DA,PSOSTA
"RTN","PSORX1",136,0)
 I '$G(PSODFN) Q
"RTN","PSORX1",137,0)
 S DA=PSODFN,PSOSTA=$G(^PS(55,PSODFN,"PS"))
"RTN","PSORX1",138,0)
 I XQY0["PSO LMOE FINISH"!(XQY0["PSO LM BACKDOOR ORDERS") I PSOSTA]"" D
"RTN","PSORX1",139,0)
 .D ELIG^VADPT W !,"Eligibility: "_$P(VAEL(1),"^",2)_$S(+VAEL(3):"     SC%: "_$P(VAEL(3),"^",2),1:"")
"RTN","PSORX1",140,0)
 .S N=0 F  S N=$O(VAEL(1,N)) Q:'N  W !,?10,$P(VAEL(1,N),"^",2)
"RTN","PSORX1",141,0)
 .S DIC("A")="RX PATIENT STATUS: ",DIC("B")=PSOSTA,DIC(0)="QEAMZ",DIC=53 D ^DIC K DIC
"RTN","PSORX1",142,0)
 .I +Y>0,+Y'=PSOSTA S DIE="^PS(55,",DR="3////"_+Y D ^DIE
"RTN","PSORX1",143,0)
 Q
"RTN","PSOSD1")
0^13^B48899635^B48787398
"RTN","PSOSD1",1,0)
PSOSD1 ;BHAM ISC/SAB/JMB - action or informational profile cont. ; 10/30/07 10:39am
"RTN","PSOSD1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**2,17,19,22,40,49,66,107,110,132,233,258,240,320,326**;DEC 1997;Build 11
"RTN","PSOSD1",3,0)
 ;External reference to ^PS(59.7 is supported by DBIA 694
"RTN","PSOSD1",4,0)
 ;
"RTN","PSOSD1",5,0)
INIT N PSOPTLK
"RTN","PSOSD1",6,0)
 S PRF="" F PSOI=0:0 S DIC(0)="QEAM" D EN^PSOPATLK S Y=PSOPTLK Q:Y<1  D
"RTN","PSOSD1",7,0)
 .S PRF=PRF_+Y_",",DFN=+Y D DEM^VADPT I +VADM(6) W !,"Patient Expired on "_$P(VADM(6),"^",2),! S DOD(DFN)=$P(VADM(6),"^",2) K DFN
"RTN","PSOSD1",8,0)
 .I $L(PRF)>240 W !,$C(7),"MAX NUMBER OF PATIENTS HAS BEEN REACHED" Q
"RTN","PSOSD1",9,0)
 Q:'$L(PRF)  D DAYS G:$D(DUOUT)!($D(DTOUT)) EXIT^PSOSD
"RTN","PSOSD1",10,0)
DEV N PSOBARS,PSOBAR0,PSOBAR1 K %ZIS,IOP,ZTSK,ZTQUEUED S PSOION=ION,%ZIS="QM",%ZIS("B")="",%ZIS("A")=$S(PSTYPE:"Select a Printer: ",1:"DEVICE: ") D ^%ZIS K %ZIS I POP S IOP=PSOION D ^%ZIS K IOP,PSOION G EXIT
"RTN","PSOSD1",11,0)
 I $E(IOST)["C",PSTYPE D ^%ZISC W $C(7),!!,"Action Profiles MUST BE SENT TO A PRINTER !!",!,"ONLY INFORMATIONAL PROFILES ARE ALLOWED TO PRINT TO SCREEN !!",! G DEV
"RTN","PSOSD1",12,0)
 S PSOIOS=IOS D DEVBAR^PSOBMST S PSOBAR2=PSOBAR0,PSOBAR3=PSOBAR1
"RTN","PSOSD1",13,0)
 S PSOBAR4=$G(PSOBAR3)]""&($G(PSOBAR2)]"")&(+$P($G(PSOPAR),"^"))
"RTN","PSOSD1",14,0)
 K PSOION I $D(IO("Q")) S ZTDESC="Outpatient Pharmacy Action Profile",ZTRTN="START^PSOSD1",ZTSAVE("ZTREQ")="@" D  D EXIT Q:$G(LM)  G ^PSOSD
"RTN","PSOSD1",15,0)
 .F G="PSORM","PSOPOL","PSONUM","PSOSYS","PSOINST","PSOBAR3","PSOBAR4","PSOBAR2","PSOPAR","PSOPAR7","PRF","PSDAYS","PSDATE","PSTYPE","PSOSITE","PSDATE","PSDAY" S:$D(@G) ZTSAVE(G)=""
"RTN","PSOSD1",16,0)
 .S ZTSAVE("DOD*")="",ZTSAVE("PSOBAR*")="" D ^%ZTLOAD W:$D(ZTSK) !,"Report Queued to Print !!",! K:'$G(LM) ZTSK,IO("Q")
"RTN","PSOSD1",17,0)
 D START G:'$G(LM) ^PSOSD
"RTN","PSOSD1",18,0)
 Q
"RTN","PSOSD1",19,0)
START U IO S PSTYPE=$S($D(PSTYPE):PSTYPE,1:0),$P(LINE,"-",132)="-"
"RTN","PSOSD1",20,0)
 F PSIX=1:1 S DFN=$P(PRF,",",PSIX) G:DFN']"" EXIT D ELIG S PAGE=1 D  G:$G(PSQFLG)!($D(DTOUT))!($D(DUOUT)) EXIT
"RTN","PSOSD1",21,0)
 .D PAT^PSOSD Q:$D(DTOUT)!($D(DUOUT))  D  Q:PSQFLG  D RXPAD:PSTYPE D ENSTUFF^PSODACT
"RTN","PSOSD1",22,0)
 ..Q:$D(DUOUT)!($D(DTOUT))  S PSQFLG=0 D ^PSOSD3,NVA^PSOSD3,EN^PSORMRXP(DFN)
"RTN","PSOSD1",23,0)
EXIT I '$D(PSONOPG) W ! D ^%ZISC K DFN
"RTN","PSOSD1",24,0)
 W:$D(PSONOPG)&('$D(ORVP)) @IOF
"RTN","PSOSD1",25,0)
 K ^TMP($J,"PRF"),^("ACT"),ADDR,ADDRFL,CLASS,CNDT,CNT,DRUG,CLAPP,HDFL,I,II,J,L,LINE,P,PAGE,PSDOB,PSIIX,PSNAME,PSOI,PSQFLG,PSSN,DFN,PSIX,PAGE,PGM,LINE,PRF,PSTYPE,PSDATE,PSDAYS,VAL,VAR,RX,RX0,RX3,RX2,ST,ST0,PSDAY,RF,RFS,PSOBAR3,PSOBAR4,PSOBAR2
"RTN","PSOSD1",26,0)
 D KVA^VADPT K DOD,FILL,DIC,PSCNT,PSDT,PCLASS,PHYS,ZCLASS,PSOPRINT,RXNODE,DIR,X1,X2,PSONUM,PSOPOLP,PSSN4
"RTN","PSOSD1",27,0)
 Q
"RTN","PSOSD1",28,0)
 ; 
"RTN","PSOSD1",29,0)
DAYS K DIR S DIR("A")="Profile Expiration/Discontinued Cutoff",DIR("B")=120,DIR(0)="N^0:9999:0",DIR("?",1)="Enter the number of days which will cut discontinued and expired Rx's from",DIR("?")="the profile."
"RTN","PSOSD1",30,0)
 D ^DIR Q:$D(DTOUT)!($D(DUOUT))  S PSDAYS=X K DIR S X1=DT,X2=-PSDAYS D C^%DTC S (PSDATE,PSDAY)=X
"RTN","PSOSD1",31,0)
 Q
"RTN","PSOSD1",32,0)
 ;
"RTN","PSOSD1",33,0)
DFN S:'$D(PSORM) PSORM=1
"RTN","PSOSD1",34,0)
 S PSOIOS=IOS D DEVBAR^PSOBMST S PSOBAR2=PSOBAR0,PSOBAR3=PSOBAR1
"RTN","PSOSD1",35,0)
 S PSOBAR4=$G(PSOBAR3)]""&($G(PSOBAR2)]"")&(+$P($G(PSOPAR),"^"))
"RTN","PSOSD1",36,0)
 W:$D(PSONOPG)&($G(PSONOPG)'=2) @IOF I '$G(PSOSITE) S PSOSITE=$O(^PS(59,0))
"RTN","PSOSD1",37,0)
 S PRF=DFN_"," D:'$G(PSDAYS)  G START
"RTN","PSOSD1",38,0)
 .S PSDAYS=120,X1=DT,X2=-PSDAYS D C^%DTC S (PSDATE,PSDAY)=X
"RTN","PSOSD1",39,0)
 Q
"RTN","PSOSD1",40,0)
 ;
"RTN","PSOSD1",41,0)
ELIG S PSOPRINT=""
"RTN","PSOSD1",42,0)
 D ELIG^VADPT
"RTN","PSOSD1",43,0)
 Q:'$D(VAEL(4))
"RTN","PSOSD1",44,0)
 Q:+VAEL(4)'=1
"RTN","PSOSD1",45,0)
 I $D(VAEL(3)),+VAEL(3)=1,($P(VAEL(3),"^",2)<50) S PSOPRINT="SC NSC"
"RTN","PSOSD1",46,0)
 D KVAR^VADPT
"RTN","PSOSD1",47,0)
 Q
"RTN","PSOSD1",48,0)
 ;
"RTN","PSOSD1",49,0)
RXPAD N K Q:$G(DOD(DFN))]""  D HD F CNT=1:1:4 S LF="!?45" D  Q:$Y+14>IOSL
"RTN","PSOSD1",50,0)
 .W !?4,"Name: "_PSNAME,?58,"DOB: "_PSDOB
"RTN","PSOSD1",51,0)
 .W !!,CNT,?4,"Medication: ",LN,$E(LN,1,11),!!?4,"Outpatient Directions: ",LN,!?4
"RTN","PSOSD1",52,0)
 .W $E(LN,1,3),"SC",$E(LN,1,3),"NSC","  Quantity: _____    Days Supply _____   "
"RTN","PSOSD1",53,0)
 .W:'$G(PSORM) @LF W "Refills: 0 1 2 3 4 5 6 7 8 9 10 11"
"RTN","PSOSD1",54,0)
 .W !!?4,$E(LN,1,35)," ",$E(LN,1,14)," ",$E(LN,1,24)
"RTN","PSOSD1",55,0)
 .W !?4,"Provider's Signature",?40,"DEA #",?55,"Date/Time",!!,$E(LINE,1,$S('PSORM:80,1:IOM))
"RTN","PSOSD1",56,0)
 K LF Q
"RTN","PSOSD1",57,0)
 ;
"RTN","PSOSD1",58,0)
HD S FN=DFN S:'$D(PSORM) PSORM=1
"RTN","PSOSD1",59,0)
 D ELIG^PSOSD1,DEM^VADPT,INP^VADPT,ADD^VADPT,PID^VADPT S PSSN=VA("PID"),PSSN4="",ADDRFL=$S(+VAPA(9):"Temporary ",1:"")
"RTN","PSOSD1",60,0)
 I +VADM(6) S DOD(DFN)=$P(VADM(6),"^",2)
"RTN","PSOSD1",61,0)
 S PSNAME=$E(VADM(1),1,28),PSDOB=$P(VADM(3),"^",2) I $D(IOF),$G(PAGE)'=1 W @IOF
"RTN","PSOSD1",62,0)
 W "Action Rx Profile",?47,"Run Date: " S Y=DT D DT^DIO2 W ?71,"Page: "_PAGE S PAGE=PAGE+1,X=$$SITE^VASITE
"RTN","PSOSD1",63,0)
 W !,"Sorted by drug classification for Rx's currently active"_$S('PSDAYS:" only.",1:"") W:PSDAYS !,"and for those Rx's that have been inactive less than "_PSDAYS_" days."
"RTN","PSOSD1",64,0)
 W @$S(PSORM:"?70",1:"!"),"Site: VAMC "_$P(X,"^",2)_" ("_$P(X,"^",3)_")",!,$E(LINE,1,$S('PSORM:80,1:IOM)-1)
"RTN","PSOSD1",65,0)
 I $P(VAIN(4),"^",2)]"",+$P($G(^PS(59.7,1,40.1)),"^") W !,"Outpatient prescriptions are discontinued 72 hours after admission.",!
"RTN","PSOSD1",66,0)
 W !?1,"Name  : ",PSNAME W ?58,"Action Date: ________" W !?1,"DOB   : "_PSDOB
"RTN","PSOSD1",67,0)
 W:ADDRFL]"" ?30,ADDRFL,! W ?30,"Address  :"
"RTN","PSOSD1",68,0)
 I $G(ADDRFL)="" D CHECKBAI
"RTN","PSOSD1",69,0)
 W ?41,VAPA(1) W:VAPA(2)]"" !?41,VAPA(2) W:VAPA(3)]"" !?41,VAPA(3) W !?41,VAPA(4)_", "_$P(VAPA(5),"^",2)_"  "_$S(VAPA(11)]"":$P(VAPA(11),"^",2),1:VAPA(6)),!?30,"Phone    : "_VAPA(8)
"RTN","PSOSD1",70,0)
 I PSOBAR4 S X="S",X2=PSSN W @$S('PSORM:"!?30",1:"?$X+5") S X1=$X W @PSOBAR3,X2,@PSOBAR2,$C(13) S $X=0
"RTN","PSOSD1",71,0)
 S (WT,HT)="",X="GMRVUTL" X ^%ZOSF("TEST") I $T D
"RTN","PSOSD1",72,0)
 .F GMRVSTR="WT","HT" S VM=GMRVSTR D EN6^GMRVUTL S @VM=X,$P(@VM,"^")=$E($P(@VM,"^"),4,5)_"/"_$E($P(@VM,"^"),6,7)_"/"_($E($P(@VM,"^"),1,3)+1700)
"RTN","PSOSD1",73,0)
 .S X=$P(WT,"^",8),Y=$J(X/2.2,0,2),$P(WT,"^",9)=Y,X=$P(HT,"^",8),Y=$J(2.54*X,0,2),$P(HT,"^",9)=Y
"RTN","PSOSD1",74,0)
 W !!,"WEIGHT(Kg): " W:+$P(WT,"^",8) $P(WT,"^",9)_" ("_$P(WT,"^")_")" W ?41,"HEIGHT(cm): " W:$P(HT,"^",8) $P(HT,"^",9)_" ("_$P(HT,"^")_")" K VM,WT,HT
"RTN","PSOSD1",75,0)
 D GMRA^PSODEM W !,$E(LINE,1,$S('PSORM:80,1:IOM)-1),!,"Instructions to the provider:",!,"A prescription blank (VA FORM 10-2577f) must be used for All Class II NARCOTICS."
"RTN","PSOSD1",76,0)
 S (ELN,LN,LINE)="",$P(LN,"_",53)="",$P(LINE,"-",132)=""
"RTN","PSOSD1",77,0)
 W !,$E(LINE,1,$S('PSORM:80,1:IOM)-1),!?4,"OTHER MEDICATIONS:",!
"RTN","PSOSD1",78,0)
 Q
"RTN","PSOSD1",79,0)
LM ;prints AP from listamn action
"RTN","PSOSD1",80,0)
 S X=$$SITE^VASITE,PSOINST=$P(X,"^",3) K X
"RTN","PSOSD1",81,0)
 K DIR S DIR("A")="Action or Informational (A or I): ",DIR("?",1)="Enter 'A' for action profile",DIR("?",2)="      'I' for informational profile",DIR("?")="      'E' to EXIT process",DIR("B")="A",DIR(0)="SAM^1:Action;0:Informational;E:Exit"
"RTN","PSOSD1",82,0)
 D ^DIR K DIR Q:Y="E"!($D(DIRUT))  S PSTYPE=Y,LM=1
"RTN","PSOSD1",83,0)
 I '$P($G(PSOSYS),"^",6) S PSOPOL=0 G ASK
"RTN","PSOSD1",84,0)
 K DIR S DIR("A")="Do you want generate a Polypharmacy report?: ",DIR("?",1)="Enter 'Y' to generate report",DIR("?",2)="      'N' if you do not want the report",DIR("?")="      'E' to EXIT process",DIR("B")="NO",DIR(0)="SA^1:YES;0:NO;E:Exit"
"RTN","PSOSD1",85,0)
 D ^DIR S PSOPOL=$S(Y:1,1:0) G:Y="E"!($D(DIRUT)) EXIT G:'PSOPOL ASK
"RTN","PSOSD1",86,0)
 K DIR S DIR("A")="Minimum Number of Active Prescriptions",DIR("B")=7,DIR(0)="N^1:100:0" D ^DIR S PSONUM=Y G:$D(DIRUT) EXIT
"RTN","PSOSD1",87,0)
 K DIR,DTOUT,DIRUT,DUOUT S DIR("A")="Do you want this Profile to print in 132 columns or 80 columns: ",DIR("B")="132",DIR(0)="SAM^1:132;8:80;E:Exit"
"RTN","PSOSD1",88,0)
 D ^DIR G:Y="E"!($D(DUOUT))!($D(DIRUT)) EXIT S PSORM=$S(Y=1:1,1:0) K DIR,X,Y
"RTN","PSOSD1",89,0)
 ;PSO*7*240 Go to exit if DUOUT or DTOUT
"RTN","PSOSD1",90,0)
ASK D DAYS G:($D(DUOUT))!($D(DTOUT)) EXIT S PRF=PSODFN_"," D DEV I $D(ZTSK) S VALMSG="Action Profile Queued to Printer."
"RTN","PSOSD1",91,0)
 D EXIT K LM
"RTN","PSOSD1",92,0)
 Q
"RTN","PSOSD1",93,0)
 ;
"RTN","PSOSD1",94,0)
CHECKBAI ;
"RTN","PSOSD1",95,0)
 N PSOBADR
"RTN","PSOSD1",96,0)
 S PSOBADR=$$BADADR^DGUTL3(DFN)
"RTN","PSOSD1",97,0)
 I 'PSOBADR W " " Q
"RTN","PSOSD1",98,0)
 W ?40,"** BAD ADDRESS INDICATED **",!
"RTN","PSOSD1",99,0)
 Q
"RTN","PSOSD1",100,0)
 ;
"RTN","PSOSD2")
0^14^B29718119^B29900999
"RTN","PSOSD2",1,0)
PSOSD2 ;BHAM ISC/SAB - action or informational profile cont. ;3/24/93
"RTN","PSOSD2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**2,19,107,110,176,233,258,326**;DEC 1997;Build 11
"RTN","PSOSD2",3,0)
 ;External reference to ^PS(59.7 is supported by DBIA 694
"RTN","PSOSD2",4,0)
 ;
"RTN","PSOSD2",5,0)
1 W !,$E(LINE,1,$S('PSORM:80,1:IOM)-1),!
"RTN","PSOSD2",6,0)
 W !,"Instructions to the provider:"
"RTN","PSOSD2",7,0)
 W !,"   A. A prescription blank (VA FORM 10-2577f) must be used for the"
"RTN","PSOSD2",8,0)
 W !,"      following: 1) any new medication"
"RTN","PSOSD2",9,0)
 W !,"                 2) any changes in dosage, direction or quantity"
"RTN","PSOSD2",10,0)
 W !,"                 3) all class II narcotics."
"RTN","PSOSD2",11,0)
 W !,"   B. To continue a medication as printed:"
"RTN","PSOSD2",12,0)
 W !,"      1.  If ""Remaining Refills"" are sufficient to complete"
"RTN","PSOSD2",13,0)
 W !,"          therapy or last until next scheduled clinic appointment,"
"RTN","PSOSD2",14,0)
 W !,"          no action is required."
"RTN","PSOSD2",15,0)
 W !,"      2.  If ""Remaining Refills"" are not sufficient to complete"
"RTN","PSOSD2",16,0)
 W !,"          therapy or last until next scheduled clinic appointment,"
"RTN","PSOSD2",17,0)
 W !,"          sign ""RENEW/MD"" line, enter VA# and date, and circle"
"RTN","PSOSD2",18,0)
 W !,"          total number of refills needed.  This action creates a"
"RTN","PSOSD2",19,0)
 W !,"          new prescription with refills as indicated."
"RTN","PSOSD2",20,0)
 W !,"   C. To discontinue a medication, sign DISCONTINUE/MD line and enter VA# and",@$S(PSORM:"?$X+1",1:"!?6"),"date."
"RTN","PSOSD2",21,0)
 W !,"   D. Any medications not acted upon will continue to be available"
"RTN","PSOSD2",22,0)
 W !,"      to the patient until all refills are used or until expiration."
"RTN","PSOSD2",23,0)
 W !!,"  NOTE: '(R)' indicates a fill was returned to stock."
"RTN","PSOSD2",24,0)
 Q
"RTN","PSOSD2",25,0)
 ;
"RTN","PSOSD2",26,0)
HD S:'$D(PSORM) PSORM=1 N K S FN=DFN
"RTN","PSOSD2",27,0)
 D ELIG^PSOSD1,DEM^VADPT,INP^VADPT,ADD^VADPT,PID^VADPT S PSSN=VA("PID"),ADDRFL=$S(+VAPA(9):"Temporary ",1:"")
"RTN","PSOSD2",28,0)
 I $G(^TMP($J,DFN)),$D(CLINICX) D ^PSOSDP
"RTN","PSOSD2",29,0)
 S PSNAME=$E(VADM(1),1,28),PSDOB=$P(VADM(3),"^",2)
"RTN","PSOSD2",30,0)
 I '$D(PSOBAR0)!('$D(PSOBAR1)) S PSOIOS=IOS D DEVBAR^PSOBMST
"RTN","PSOSD2",31,0)
 S PSOBAR2=PSOBAR0,PSOBAR3=PSOBAR1
"RTN","PSOSD2",32,0)
 S PSOBAR4=$G(PSOBAR3)]""&($G(PSOBAR2)]"")&(+$P($G(PSOPAR),"^"))
"RTN","PSOSD2",33,0)
HD1 S RXCNT=0 I $E(IOST)="C",'PSTYPE K DIR S DIR(0)="E",DIR("A")="Press Return to Continue or ""^"" to Exit" D ^DIR Q:$D(DTOUT)!($D(DUOUT))
"RTN","PSOSD2",34,0)
 I $D(IOF) W @IOF
"RTN","PSOSD2",35,0)
 U IO
"RTN","PSOSD2",36,0)
 W $S(PSTYPE:"Action",1:"Informational")_" Rx Profile",?47,"Run Date: " S Y=DT D DT^DIO2 W ?71,"Page: "_PAGE
"RTN","PSOSD2",37,0)
 W !,"Sorted by drug classification for Rx's currently active"_$S('PSDAYS:" only.",1:"") W:PSDAYS !,"and for those Rx's that have been inactive less than "_PSDAYS_" days."
"RTN","PSOSD2",38,0)
 S X=$$SITE^VASITE
"RTN","PSOSD2",39,0)
 W @$S(PSORM:"?70",1:"!"),"Site: VAMC "_$P(X,"^",2)_" ("_$P(X,"^",3)_")",!,$E(LINE,1,$S('PSORM:80,1:IOM)-1)
"RTN","PSOSD2",40,0)
 I $P(VAIN(4),"^",2)]"",+$P($G(^PS(59.7,1,40.1)),"^") W !,"Outpatient prescriptions are discontinued 72 hours after admission.",!
"RTN","PSOSD2",41,0)
 I $D(CLINICX) W !?1,"Clinic: ",$E(CLINICX,1,28),?45,"Date/Time: " S Y=CLDT D DT^DIO2
"RTN","PSOSD2",42,0)
 W !?1,"Name  : ",PSNAME W:PSTYPE ?58,"Action Date: ________" W !?1,"DOB   : "_PSDOB
"RTN","PSOSD2",43,0)
 W:ADDRFL]"" ?30,ADDRFL,! W ?30,"Address  :"
"RTN","PSOSD2",44,0)
 I $G(ADDRFL)="" D CHECKBAI^PSOSD1
"RTN","PSOSD2",45,0)
 W ?41,VAPA(1) W:VAPA(2)]"" !?41,VAPA(2) W:VAPA(3)]"" !?41,VAPA(3)
"RTN","PSOSD2",46,0)
 W !?41,VAPA(4)_", "_$P(VAPA(5),"^",2)_"  "_$S(VAPA(11)]"":$P(VAPA(11),"^",2),1:VAPA(6)),!?30,"Phone    : "_VAPA(8)
"RTN","PSOSD2",47,0)
 I PSOBAR4 S X="S",X2=PSSN W @$S('PSORM:"!?30",1:"?$X+5") S X1=$X W @PSOBAR3,X2,@PSOBAR2,$C(13) S $X=0
"RTN","PSOSD2",48,0)
 W:$G(DOD(DFN))]"" ?1,"**** Date of Death: "_DOD(DFN)_" ****",!
"RTN","PSOSD2",49,0)
 D:'$D(HDFL)
"RTN","PSOSD2",50,0)
 .K DIRUT,DIR,DUOUT,DTOUT D:'$G(CLAPP) RE^PSODEM Q:$D(DIRUT)
"RTN","PSOSD2",51,0)
 .I $Y+15>IOSL,$E(IOST)="C" K DIR S DIR(0)="E" D ^DIR K DIR,DUOUT,DTOUT
"RTN","PSOSD2",52,0)
 .Q:$D(DIRUT)
"RTN","PSOSD2",53,0)
 .K ^UTILITY("VASD",$J),VASD S VASD("F")=DT,VASD("T")=9999999,VASD("W")="123456789" D:$G(DFN)&('$G(CLAPP)) SDA^VADPT K VASD I '$G(CLAPP)&($D(^UTILITY("VASD",$J))) D  S CLAPP=1 D HD:$G(^TMP($J,DFN))'<$G(PSONUM)&($G(PSOPOL))
"RTN","PSOSD2",54,0)
 ..W:$E(IOST)="C" @IOF
"RTN","PSOSD2",55,0)
 ..W !,$E(LINE,1,$S('PSORM:80,1:IOM)-1)
"RTN","PSOSD2",56,0)
 ..S FA=DT W !!,"Pending Outpatient Clinic Appointments:"
"RTN","PSOSD2",57,0)
 ..F PSOACPP=0:0 S PSOACPP=$O(^UTILITY("VASD",$J,PSOACPP)) Q:'PSOACPP  S PSOACPPE=$G(^UTILITY("VASD",$J,PSOACPP,"E")),PSOACPPI=$G(^("I")) W !?11,$P(PSOACPPE,"^"),?35,$P(PSOACPPE,"^",2) D CAPP
"RTN","PSOSD2",58,0)
 ..I $E(IOST)="C" K DIR,DIRUT,DTOUT S DIR(0)="E" D ^DIR K DIR
"RTN","PSOSD2",59,0)
 .E  D:$G(PAGE)>1&('$G(PSOPOL))
"RTN","PSOSD2",60,0)
 ..S (WT,HT)="",X="GMRVUTL" X ^%ZOSF("TEST") I $T D
"RTN","PSOSD2",61,0)
 ...F GMRVSTR="WT","HT" S VM=GMRVSTR D EN6^GMRVUTL S @VM=X,$P(@VM,"^")=$E($P(@VM,"^"),4,5)_"/"_$E($P(@VM,"^"),6,7)_"/"_($E($P(@VM,"^"),1,3)+1700)
"RTN","PSOSD2",62,0)
 ...S X=$P(WT,"^",8),Y=$J(X/2.2,0,2),$P(WT,"^",9)=Y,X=$P(HT,"^",8),Y=$J(2.54*X,0,2),$P(HT,"^",9)=Y
"RTN","PSOSD2",63,0)
 ..W !!,"WEIGHT(Kg): " W:+$P(WT,"^",8) $P(WT,"^",9)_" ("_$P(WT,"^")_")" W ?41,"HEIGHT(cm): " W:$P(HT,"^",8) $P(HT,"^",9)_" ("_$P(HT,"^")_")" K VM,WT,HT
"RTN","PSOSD2",64,0)
 D:$D(DIRUT) KLCL Q:$D(DIRUT)  S PAGE=PAGE+1 I $D(^UTILITY("VASD",$J)),PAGE=2!($G(PSOPOLP)) D KLCL S PSOPOLP=0 D HD Q
"RTN","PSOSD2",65,0)
 D KLCL I PSTYPE,'$D(HDFL) D 1 S HDFL=""
"RTN","PSOSD2",66,0)
 W !,$E(LINE,1,$S('PSORM:80,1:IOM)-1),!,"Medication/Supply" Q:'PSORM
"RTN","PSOSD2",67,0)
 W ?74,"Rx#",?85,"Status",?98,"Expiration",?110,"Provider",!,?101,"Date"
"RTN","PSOSD2",68,0)
 Q
"RTN","PSOSD2",69,0)
 ;
"RTN","PSOSD2",70,0)
CAPP ;
"RTN","PSOSD2",71,0)
 K X S X2=DT,X1=$P($P($G(PSOACPPI),"^"),".") I $G(X1) D ^%DTC
"RTN","PSOSD2",72,0)
 W $S($P(PSOACPPI,"^",3)["C":"   *** Canceled ***",1:" ("_$G(X)_" days)")
"RTN","PSOSD2",73,0)
 Q
"RTN","PSOSD2",74,0)
PSRENW D:'$G(PSODTCUT) CUTDATE^PSOFUNC I $P(RX2,"^",6)<PSODTCUT S PSRENW=0 G LN
"RTN","PSOSD2",75,0)
 I $E($P(RX0,"^",15))="D",$P(RX3,"^",5)<PSODTCUT,$P(^PSRX(RXNO,"STA"),"^")=12 S PSRENW=0 G LN
"RTN","PSOSD2",76,0)
 I $E($P(RX0,"^",15))="D",$P(^PSRX(RXNO,"STA"),"^")'=12 S PSRENW=0
"RTN","PSOSD2",77,0)
LN S CS=0 F DEA=1:1 Q:$E(PSODEA,DEA)=""  I $E(+PSODEA,DEA)>2,$E(+PSODEA,DEA)<6 S CS=1
"RTN","PSOSD2",78,0)
 K DEA,PSODEA Q
"RTN","PSOSD2",79,0)
KLCL K ^UTILITY("VASD",$J),PSOACPPI,PSOACPPE,PSOACPP Q
"RTN","PSOSD3")
0^15^B38820871^B39002565
"RTN","PSOSD3",1,0)
PSOSD3 ;BHAM ISC/RTR - Prints pending orders on action profile ;11/20/95
"RTN","PSOSD3",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**2,19,107,110,132,233,258,326**;DEC 1997;Build 11
"RTN","PSOSD3",3,0)
 ;External reference ^PS(50.7 - 2223
"RTN","PSOSD3",4,0)
 ;External reference ^PS(50.606 - 2174
"RTN","PSOSD3",5,0)
 ;External reference ^PSDRUG( - 221
"RTN","PSOSD3",6,0)
 ;External reference ^PS(59.7 - 694
"RTN","PSOSD3",7,0)
 ;External reference to ^PS(55 - 2228
"RTN","PSOSD3",8,0)
 ;
"RTN","PSOSD3",9,0)
START Q:$D(DUOUT)!($D(DTOUT))!('$G(DFN))
"RTN","PSOSD3",10,0)
 N MMM,PNDIS,PNDLINE,PNDREX,PNPOI,PPPP,PSOPRVD,PSCONT,PSOEFF,PSOQTY,PSOREFLS,PZSTAT,WWW
"RTN","PSOSD3",11,0)
 D ELIG^PSOSD1,DEM^VADPT,INP^VADPT,ADD^VADPT,PID^VADPT S PSSN=VA("PID"),ADDRFL=$S(+VAPA(9):"Temporary ",1:"")
"RTN","PSOSD3",12,0)
 S PSNAME=$E(VADM(1),1,28),PSDOB=$P(VADM(3),"^",2)
"RTN","PSOSD3",13,0)
 K ^TMP($J,"PSOPEND") S $P(PNDLINE,"-",33)=""
"RTN","PSOSD3",14,0)
 S PSCONT=1 F MMM=0:0 S MMM=$O(^PS(52.41,"P",DFN,MMM)) Q:'MMM  S PZSTAT=$P($G(^PS(52.41,MMM,0)),"^",3) I PZSTAT="NW"!(PZSTAT="HD")!(PZSTAT="RNW") D
"RTN","PSOSD3",15,0)
 .S ^TMP($J,"PSOPEND",PSCONT)=MMM_"^"_$S(+$P($G(^PS(52.41,MMM,0)),"^",9):"DD",1:"OI") S PSCONT=PSCONT+1
"RTN","PSOSD3",16,0)
 I $Y+6>IOSL D HD1 S:$D(DTOUT)!($D(DUOUT)) PSQFLG=1 G:$G(PSQFLG) END
"RTN","PSOSD3",17,0)
 D HD
"RTN","PSOSD3",18,0)
 I PSCONT=1 W !?10,"No pending orders for this patient!",! G END
"RTN","PSOSD3",19,0)
 F WWW=0:0 S WWW=$O(^TMP($J,"PSOPEND",WWW)) Q:'WWW!($G(PSQFLG))  D
"RTN","PSOSD3",20,0)
 .S PNDREX=$P(^TMP($J,"PSOPEND",WWW),"^"),PNDIS=$P($G(^PS(52.41,PNDREX,0)),"^",9),PNPOI=$P($G(^(0)),"^",8),PSOEFF=$P($G(^(0)),"^",6),PSOQTY=$P($G(^(0)),"^",10),PSOREFLS=$P($G(^(0)),"^",11),PSOPRVD=$P($G(^(0)),"^",5)
"RTN","PSOSD3",21,0)
 .W !,"Drug: ",$S($P(^TMP($J,"PSOPEND",WWW),"^",2)="DD":$P($G(^PSDRUG(+PNDIS,0)),"^"),1:$P($G(^PS(50.7,+PNPOI,0)),"^")_" "_$P($G(^PS(50.606,+$P($G(^(0)),"^",2),0)),"^")),!
"RTN","PSOSD3",22,0)
 .W ?1,"Eff. Date: ",$E(PSOEFF,4,5)_"-"_$E(PSOEFF,6,7)_"-"_($E(PSOEFF,1,3)+1700),?22,"Qty: ",PSOQTY,?40,"Refills: ",PSOREFLS,?52,"Prov: ",$E($P($G(^VA(200,+PSOPRVD,0)),"^"),1,21)
"RTN","PSOSD3",23,0)
 .S PSCONT=1 W !?1,"Sig: " F PPPP=0:0 S PPPP=$O(^PS(52.41,PNDREX,"SIG",PPPP)) Q:'PPPP!($G(PSQFLG))  W:PSCONT>1 ! W ?6,$G(^PS(52.41,PNDREX,"SIG",PPPP,0)) S PSCONT=PSCONT+1
"RTN","PSOSD3",24,0)
 .I $E(IOST)'="C" W !
"RTN","PSOSD3",25,0)
 .I $E(IOST)="C" D HD1 S:$D(DUOUT)!($D(DTOUT)) PSQFLG=1 Q:$G(PSQFLG)  D HD
"RTN","PSOSD3",26,0)
 .I $E(IOST)'="C" I $Y+9>IOSL D HD1 S:$D(DUOUT)!($D(DTOUT)) PSQFLG=1 Q:$G(PSQFLG)  D HD
"RTN","PSOSD3",27,0)
END K ^TMP($J,"PSOPEND") Q
"RTN","PSOSD3",28,0)
HD W !,PNDLINE,"PENDING ORDERS",PNDLINE,! Q
"RTN","PSOSD3",29,0)
 ;
"RTN","PSOSD3",30,0)
HD1 S FN=DFN
"RTN","PSOSD3",31,0)
 I $E(IOST)="C" K DIR S DIR(0)="E",DIR("A")="Press Return to Continue or ""^"" to Exit" D ^DIR Q:$D(DUOUT)!($D(DTOUT))
"RTN","PSOSD3",32,0)
 D ELIG^PSOSD1,DEM^VADPT,INP^VADPT,ADD^VADPT,PID^VADPT S PSSN=VA("PID"),ADDRFL=$S(+VAPA(9):"Temporary ",1:"")
"RTN","PSOSD3",33,0)
 S PSNAME=$E(VADM(1),1,28),PSDOB=$P(VADM(3),"^",2)
"RTN","PSOSD3",34,0)
 I $D(IOF) W @IOF
"RTN","PSOSD3",35,0)
 W $S(PSTYPE:"Action",1:"Informational")_" Rx Profile",?47,"Run Date: " S Y=DT D DT^DIO2 W ?71,"Page: "_PAGE
"RTN","PSOSD3",36,0)
 W !,"Sorted by drug classification for Rx's currently active"_$S('PSDAYS:" only.",1:"") W:PSDAYS !,"and for those Rx's that have been inactive less than "_PSDAYS_" days."
"RTN","PSOSD3",37,0)
 S X=$$SITE^VASITE
"RTN","PSOSD3",38,0)
 W @$S(PSORM:"?70",1:"!"),"Site: VAMC "_$P(X,"^",2)_" ("_$P(X,"^",3)_")",!,$E(LINE,1,$S('PSORM:80,1:IOM)-1)
"RTN","PSOSD3",39,0)
 I $P(VAIN(4),"^",2)]"",+$P($G(^PS(59.7,1,40.1)),"^") W !,"Outpatient prescriptions are discontinued 72 hours after admission.",!
"RTN","PSOSD3",40,0)
 I $D(CLINICX) W !?1,"Clinic: "_$E(CLINICX,1,28),?45,"Date/Time: " S Y=CLDT D DT^DIO2
"RTN","PSOSD3",41,0)
 W !?1,"Name  : ",PSNAME W:PSTYPE ?58,"Action Date: ________" W !?1,"DOB   : "_PSDOB
"RTN","PSOSD3",42,0)
 W:ADDRFL]"" ?30,ADDRFL,! W ?30,"Address  :"
"RTN","PSOSD3",43,0)
 I $G(ADDRFL)="" D CHECKBAI^PSOSD1
"RTN","PSOSD3",44,0)
 W ?41,VAPA(1) W:VAPA(2)]"" !?41,VAPA(2) W:VAPA(3)]"" !?41,VAPA(3)
"RTN","PSOSD3",45,0)
 W !?41,VAPA(4)_", "_$P(VAPA(5),"^",2)_"  "_$S(VAPA(11)]"":$P(VAPA(11),"^",2),1:VAPA(6)),!?30,"Phone    : "_VAPA(8)
"RTN","PSOSD3",46,0)
 I PSOBAR4 S X="S",X2=PSSN W @$S('PSORM:"!?30",1:"?$X+5") S X1=$X W @PSOBAR3,X2,@PSOBAR2,$C(13) S $X=0
"RTN","PSOSD3",47,0)
 W:$G(DOD(DFN))]"" ?1,"**** Date of Death: "_DOD(DFN)_" ****",!
"RTN","PSOSD3",48,0)
 S (WT,HT)="",X="GMRVUTL" X ^%ZOSF("TEST") I $T D
"RTN","PSOSD3",49,0)
 .F GMRVSTR="WT","HT" S VM=GMRVSTR D EN6^GMRVUTL S @VM=X,$P(@VM,"^")=$E($P(@VM,"^"),4,5)_"/"_$E($P(@VM,"^"),6,7)_"/"_($E($P(@VM,"^"),1,3)+1700)
"RTN","PSOSD3",50,0)
 .S X=$P(WT,"^",8),Y=$J(X/2.2,0,2),WT=WT_"^"_Y,X=$P(HT,"^",8),Y=$J(2.54*X,0,2),HT=HT_"^"_Y
"RTN","PSOSD3",51,0)
 W !!,"WEIGHT(Kg): " W:+$P(WT,"^",8) $P(WT,"^",9)_" ("_$P(WT,"^")_")" W ?41,"HEIGHT(cm): " W:$P(HT,"^",8) $P(HT,"^",9)_" ("_$P(HT,"^")_")" K VM,WT,HT
"RTN","PSOSD3",52,0)
 S PAGE=PAGE+1 W !,$E(LINE,1,$S('PSORM:80,1:IOM)-1)
"RTN","PSOSD3",53,0)
 Q
"RTN","PSOSD3",54,0)
NVA ;displays non-va meds
"RTN","PSOSD3",55,0)
 Q:'$O(^PS(55,DFN,"NVA",0))
"RTN","PSOSD3",56,0)
 Q:$D(DUOUT)!($D(DTOUT))!('$G(DFN))
"RTN","PSOSD3",57,0)
 D HD1 S $P(PNDLINE,"-",IOM)="",PSODFN=DFN
"RTN","PSOSD3",58,0)
 W !,PNDLINE,!?25,"Non-VA Meds (Not dispensed by VA)",!,PNDLINE,!
"RTN","PSOSD3",59,0)
 F NVA=0:0 S NVA=$O(^PS(55,DFN,"NVA",NVA)) Q:'NVA  D  Q:$G(PSQFLG)
"RTN","PSOSD3",60,0)
 .I $Y+6>IOSL D HD1 S:$D(DTOUT)!($D(DUOUT)) PSQFLG=1 Q:$G(PSQFLG)
"RTN","PSOSD3",61,0)
 .Q:'$P(^PS(55,PSODFN,"NVA",NVA,0),"^")
"RTN","PSOSD3",62,0)
 .S DUPRX0=^PS(55,PSODFN,"NVA",NVA,0)
"RTN","PSOSD3",63,0)
 .W !,"Orderable Item: "_$P(^PS(50.7,$P(DUPRX0,"^"),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^")
"RTN","PSOSD3",64,0)
 .W !,"Drug: "_$S($P(DUPRX0,"^",2):$P(^PSDRUG($P(DUPRX0,"^",2),0),"^"),1:"No Dispense Drug Selected")
"RTN","PSOSD3",65,0)
 .W !,"Status: "_$S($P(DUPRX0,"^",7):"Discontinued ("_$$FMTE^XLFDT($P($P(DUPRX0,"^",7),"."))_")",1:"Active")
"RTN","PSOSD3",66,0)
 .W !,"Dosage: "_$P(DUPRX0,"^",3)
"RTN","PSOSD3",67,0)
 .W !,"Schedule: "_$P(DUPRX0,"^",5),!,"Route: "_$P(DUPRX0,"^",4)
"RTN","PSOSD3",68,0)
 .W !,"Start Date: "_$$FMTE^XLFDT($P(DUPRX0,"^",9)),?40,"CPRS Oder #: "_$P(DUPRX0,"^",8)
"RTN","PSOSD3",69,0)
 .W !,"Documented By: "_$P(^VA(200,$P(DUPRX0,"^",11),0),"^")_" on "_$$FMTE^XLFDT($P(DUPRX0,"^",10))
"RTN","PSOSD3",70,0)
 .S RMLEN=$S('PSORM:75,1:IOM-5)
"RTN","PSOSD3",71,0)
 .F I=0:0 S I=$O(^PS(55,PSODFN,"NVA",NVA,"OCK",I)) Q:'I  D  W !
"RTN","PSOSD3",72,0)
 ..S ORD=$P(^PS(55,PSODFN,"NVA",NVA,"OCK",I,0),"^"),ORP=$P(^(0),"^",2)
"RTN","PSOSD3",73,0)
 ..W !,"Order Check #"_I_": "
"RTN","PSOSD3",74,0)
 ..K OCK,LEN I $L(ORD)>RMLEN S (LEN,IEN)=1 D
"RTN","PSOSD3",75,0)
 ...F SG=1:1:$L(ORD) S:$L($G(OCK(IEN))_" "_$P(ORD," ",SG))>RMLEN&($P(ORD," ",SG)]"") IEN=IEN+1 S:$P(ORD," ",SG)'="" OCK(IEN)=$G(OCK(IEN))_" "_$P(ORD," ",SG)
"RTN","PSOSD3",76,0)
 ...F II=0:0 S II=$O(OCK(II)) Q:'II  W !?5,OCK(II)
"RTN","PSOSD3",77,0)
 ..W:'$G(LEN) ORD K LEN,SG,IEN,II,OCK,ORD
"RTN","PSOSD3",78,0)
 ..W !,"Overriding Provider: "_$S($G(ORP):$P(^VA(200,ORP,0),"^"),1:"")
"RTN","PSOSD3",79,0)
 ..K ORP,OCK,REA W !,"Reason:" F SS=0:0 S SS=$O(^PS(55,PSODFN,"NVA",NVA,"OCK",I,"OVR",SS)) Q:'SS  S REA(SS)=^PS(55,PSODFN,"NVA",NVA,"OCK",I,"OVR",SS,0)
"RTN","PSOSD3",80,0)
 ..S IEN=1 F II=0:0 S II=$O(REA(II)) Q:'II  D
"RTN","PSOSD3",81,0)
 ...F SG=1:1:$L(REA(II)) S:$L($G(OCK(IEN))_" "_$P(REA(II)," ",SG))>RMLEN&($P(REA(II)," ",SG)]"") IEN=IEN+1 S:$P(REA(II)," ",SG)'="" OCK(IEN)=$G(OCK(IEN))_" "_$P(REA(II)," ",SG)
"RTN","PSOSD3",82,0)
 ...K REA,IEN,SG F II=0:0 S II=$O(OCK(II)) Q:'II  W OCK(II) I $O(OCK(II)) W !?5
"RTN","PSOSD3",83,0)
 .K OCK W !,"Statement/Explanation/Comments:" F SS=0:0 S SS=$O(^PS(55,PSODFN,"NVA",NVA,"DSC",SS)) Q:'SS  S DSC(SS)=^PS(55,PSODFN,"NVA",NVA,"DSC",SS,0)
"RTN","PSOSD3",84,0)
 .S IEN=1 F II=0:0 S II=$O(DSC(II)) Q:'II  D
"RTN","PSOSD3",85,0)
 ..F SG=1:1:$L(DSC(II)) S:$L($G(OCK(IEN))_" "_$P(DSC(II)," ",SG))>RMLEN&($P(DSC(II)," ",SG)]"") IEN=IEN+1 S:$P(DSC(II)," ",SG)'="" OCK(IEN)=$G(OCK(IEN))_" "_$P(DSC(II)," ",SG)
"RTN","PSOSD3",86,0)
 .K IEN,DSC,SG F II=0:0 S II=$O(OCK(II)) Q:'II  W !?5,OCK(II)
"RTN","PSOSD3",87,0)
 .W !! I $E(IOST)'="C" W !
"RTN","PSOSD3",88,0)
 K RMLEN
"RTN","PSOSD3",89,0)
 Q
"RTN","PSOSDP")
0^16^B31130096^B32009072
"RTN","PSOSDP",1,0)
PSOSDP ;BHAM ISC/SAB - poly pharmacy report attached to action/info profile ;12/13/93 8:24
"RTN","PSOSDP",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**2,17,19,107,110,155,176,233,258,326**;DEC 1997;Build 11
"RTN","PSOSDP",3,0)
 ;called from PSOSD
"RTN","PSOSDP",4,0)
 Q:+$G(^TMP($J,DFN))<PSONUM!($G(DOD(DFN))]"")  S DRG="",P=0,PSOPOLP=0 D HD K SGY
"RTN","PSOSDP",5,0)
 F  S DRG=$O(^TMP($J,DFN,DRG)) Q:DRG=""  F  S P=$O(^TMP($J,DFN,DRG,P)) Q:'P  I $G(^PSRX(P,0))]"" S RX0=^PSRX(P,0),RX2=$G(^(2)),RX3=$G(^(3)) D  K SGY
"RTN","PSOSDP",6,0)
 .I $Y+6>IOSL D FT,HD
"RTN","PSOSDP",7,0)
 .S SIG=$P($G(^PSRX(P,"SIG")),"^") W !?10,"* "_$E(DRG,1,40),?52 D SIG W $G(BSIG(1)),?79,"*"
"RTN","PSOSDP",8,0)
 .I $O(BSIG(1)) F PSREV=1:0 S PSREV=$O(BSIG(PSREV)) Q:'PSREV  W !?10,"*",?52,$G(BSIG(PSREV)),?79,"*" I $Y+4>IOSL,$O(BSIG(PSREV)) D FT,HD
"RTN","PSOSDP",9,0)
 .K BSIG,PSREV
"RTN","PSOSDP",10,0)
 D FT K PSOGY
"RTN","PSOSDP",11,0)
 Q
"RTN","PSOSDP",12,0)
SIG K FSIG,BSIG I $P($G(^PSRX(P,"SIG")),"^",2) D FSIG^PSOUTLA("R",P,26) F PSREV=1:1 Q:'$D(FSIG(PSREV))  S BSIG(PSREV)=FSIG(PSREV)
"RTN","PSOSDP",13,0)
 K FSIG,PSREV I '$P($G(^PSRX(P,"SIG")),"^",2) D EN3^PSOUTLA1(P,26)
"RTN","PSOSDP",14,0)
 Q
"RTN","PSOSDP",15,0)
HD S FN=DFN
"RTN","PSOSDP",16,0)
 D ELIG^PSOSD1,DEM^VADPT,INP^VADPT,ADD^VADPT,PID^VADPT S PSSN=VA("PID"),ADDRFL=$S(+VAPA(9):"Temporary ",1:"")
"RTN","PSOSDP",17,0)
 S PSNAME=$E(VADM(1),1,28),PSDOB=$P(VADM(3),"^",2)
"RTN","PSOSDP",18,0)
 W @IOF,!,"Polypharmacy Rx Profile Review",?47,"Run Date: " S Y=DT D DT^DIO2 W ?71,"Page: "_PAGE S PAGE=PAGE+1,X=$$SITE^VASITE
"RTN","PSOSDP",19,0)
 W !,"Sorted by drug name for Rx's currently active",@$S(PSORM:"?70",1:"!"),"Site: VAMC "_$P(X,"^",2)_"( "_$P(X,"^",3)_")",!,$E(LINE,1,$S('PSORM:80,1:IOM)-1)
"RTN","PSOSDP",20,0)
 I $D(CLINICX) W !?1,"Clinic: ",$E(CLINICX,1,28),?45,"Date/Time: " S Y=CLDT D DT^DIO2
"RTN","PSOSDP",21,0)
 W !?1,"Name  : ",PSNAME,?30 W ?58,"Review Date: ________" W !?1,"DOB   : "_PSDOB
"RTN","PSOSDP",22,0)
 W:ADDRFL]"" ?30,ADDRFL,! W ?30,"Address  :"
"RTN","PSOSDP",23,0)
 I ADDRFL="" D CHECKBAI^PSOSD1
"RTN","PSOSDP",24,0)
 W ?41,VAPA(1) W:VAPA(2)]"" !?41,VAPA(2) W:VAPA(3)]"" !?41,VAPA(3) W !?41,VAPA(4)_", "_$P(VAPA(5),"^",2)_"  "_VAPA(6),!?30,"Phone    : "_VAPA(8)
"RTN","PSOSDP",25,0)
 S PSOBAR2=PSOBAR0,PSOBAR3=PSOBAR1
"RTN","PSOSDP",26,0)
 S PSOBAR4=$G(PSOBAR3)]""&($G(PSOBAR2)]"")&(+$P($G(PSOPAR),"^"))
"RTN","PSOSDP",27,0)
 I PSOBAR4 S X="S",X2=PSSN W @$S('PSORM:"!?30",1:"?$X+5") S X1=$X W @PSOBAR3,X2,@PSOBAR2,$C(13) S $X=0
"RTN","PSOSDP",28,0)
 F GMRVSTR="WT","HT" S VM=GMRVSTR D EN6^GMRVUTL S @VM=X,$P(@VM,"^")=$E($P(@VM,"^"),4,5)_"/"_$E($P(@VM,"^"),6,7)_"/"_($E($P(@VM,"^"),1,3)+1700)
"RTN","PSOSDP",29,0)
 S X=$P(WT,"^",8),Y=$J(X/2.2,0,2),WT=WT_"^"_Y,X=$P(HT,"^",8),Y=$J(2.54*X,0,2),HT=HT_"^"_Y
"RTN","PSOSDP",30,0)
 W !?1,"WEIGHT(Kg): " W:+$P(WT,"^",8) $P(WT,"^",9)_" ("_$P(WT,"^")_")" W ?41,"HEIGHT(cm): " W:$P(HT,"^",8) $P(HT,"^",9)_" ("_$P(HT,"^")_")" K VM,WT,HT
"RTN","PSOSDP",31,0)
 W !,$E(LINE,1,$S('PSORM:80,1:IOM)-1),!!!?10 F I=1:1:70 W "*"
"RTN","PSOSDP",32,0)
 W !?10,"*",?35,"POLYPHARMACY REVIEW",?79,"*",!?10,"*",?79,"*",!?10,"* Patient:  "_PSNAME,?50,"(ID#: "_VA("BID")_")",?79,"*"
"RTN","PSOSDP",33,0)
 W !?10,"* is identified as having "_PSONUM_" or more active prescriptions",?79,"*",!?10,"* for drugs (excluding supplies).  To avoid unnecessary",?79,"*"
"RTN","PSOSDP",34,0)
 W !?10,"* medications, please review these to ensure that each one",?79,"*",!?10,"* is essential.  Unnecessary medications may be discontinued on",?79,"*"
"RTN","PSOSDP",35,0)
 W !?10,"* the attached Action Profile.",?79,"*",!?10,"*",?79,"*",!?10,"* I have reviewed the medications below and have taken",?79,"*",!?10,"* actions to discontinue those that are no longer required.",?79,"*"
"RTN","PSOSDP",36,0)
 F I=1:1:3 W !?10,"*",?79,"*"
"RTN","PSOSDP",37,0)
 W !?10,"*",?25 F I=1:1:35 W "_"
"RTN","PSOSDP",38,0)
 W ?79,"*",!?10,"*",?25,"(Signature)",?79,"*" F I=1:1:2 W !?10,"*",?79,"*"
"RTN","PSOSDP",39,0)
 W !?10,"*",?25,"Drugs ("_^TMP($J,DFN)_")",?60,"SIG",?79,"*"
"RTN","PSOSDP",40,0)
 W !?10,"* " F I=1:1:30 W "-"
"RTN","PSOSDP",41,0)
 W ?52 F I=1:1:20 W "-"
"RTN","PSOSDP",42,0)
 W ?79,"*"
"RTN","PSOSDP",43,0)
 Q
"RTN","PSOSDP",44,0)
FT W !?10 F I=1:1:70 W "*"
"RTN","PSOSDP",45,0)
 Q
"RTN","PSOSDP",46,0)
CLSG ;clinic group sort and print
"RTN","PSOSDP",47,0)
 S CLSP=1,DIC("A")="Select Clinic Sort Group: "
"RTN","PSOSDP",48,0)
 S DIC="^PS(59.8,",DIC(0)="AEQM" D ^DIC G:"^"[X EXIT^PSOSD G:Y<0 CLSG
"RTN","PSOSDP",49,0)
 S CLSG=+Y
"RTN","PSOSDP",50,0)
 I '$O(^PS(59.8,CLSG,1,0)) W !!,$C(7),"There are no clinics defined for this Clinic Group!",!,$C(7) G CLSG
"RTN","PSOSDP",51,0)
 S %DT="AEFX",%DT("A")="FOR DATE: " D ^%DT G:"^"[X EXIT^PSOSD G CLSG:Y<0 S (APCLDT,CLDT)=Y,$P(LINE,"-",132)="-"
"RTN","PSOSDP",52,0)
 D DAYS^PSOSD1 G:$D(DIRUT) EXIT S X1=DT,X2=-PSDAYS D C^%DTC S PSDATE=X S PSTYPE=$S($D(PSTYPE):PSTYPE,1:0)
"RTN","PSOSDP",53,0)
 K %DT,%ZIS,IOP,ZTSK,ZTQUEUED S PSOION=ION,%ZIS="QM",%ZIS("B")="",%ZIS("A")=$S(PSTYPE:"Select a Printer: ",1:"DEVICE: ")
"RTN","PSOSDP",54,0)
 S %ZIS("S")=$S(PSTYPE:"I $E($G(^%ZIS(2,+$G(^(""SUBTYPE"")),0)),1)=""P""",1:"")
"RTN","PSOSDP",55,0)
 N PSOBARS,PSOBAR0,PSOBAR1
"RTN","PSOSDP",56,0)
 D ^%ZIS I POP S IOP=PSOION K PSOION G EXIT
"RTN","PSOSDP",57,0)
 S APRT=ION ;D ^%ZISC
"RTN","PSOSDP",58,0)
 K DTOUT,DIR,DIRUT
"RTN","PSOSDP",59,0)
 W ! I $G(IO("Q")) D  W:$D(ZTSK) !,"Report Queued to Print !!",!! G EXIT
"RTN","PSOSDP",60,0)
 .S %DT="ERXAFS",%DT("A")="Request Start Time: ",%DT("B")="NOW",%DT(0)="NOW" D ^%DT W ! Q:$D(DIRUT)!(X["^")  S APTM=Y
"RTN","PSOSDP",61,0)
 .F G="LINE","CLDT","CLSG","PSOPOL","PSOSYS","PSOINST","PSOBAR3","PSOBAR4","PSOBAR2","PSOPAR","PSOPAR7","PRF","PSDAYS","PSDATE","PSTYPE","PSOSITE","PSDATE","PSDAY","PSONUM","PSORM" S:$D(@G) ZTSAVE(G)=""
"RTN","PSOSDP",62,0)
 .S ZTSAVE("APCLDT")="",ZTDTH=APTM,ZTDESC="Clinic Sort Group Action Profile (Outpatient Pharmacy).",ZTSAVE("ZTREQ")="@",ZTSAVE("APRT")="",ZTIO=APRT,ZTRTN="EN^PSOSDP" D ^%ZTLOAD
"RTN","PSOSDP",63,0)
 ;
"RTN","PSOSDP",64,0)
EN ;
"RTN","PSOSDP",65,0)
 S APIFLDS="1;2;3;4;5;6;7;8;9;10;11;12",ALL=1
"RTN","PSOSDP",66,0)
 S CLN=0 ;S PSOIOS=IOS D DEVBAR^PSOBMST
"RTN","PSOSDP",67,0)
 F  S CLN=$O(^PS(59.8,CLSG,1,CLN)) Q:'CLN  S FR=CLN_","_CLDT,PSOT=CLDT,TO=CLN_","_CLDT_".2359" D CLIN1^PSOSDRAP S CLDT=APCLDT
"RTN","PSOSDP",68,0)
 D ^%ZISC
"RTN","PSOSDP",69,0)
 ;
"RTN","PSOSDP",70,0)
EXIT K ADDRFL,CAN,CLDT,CLINICX,CLSG,CLSP,CNT,CS,DFN,G,PAGE,PCLASS,PRF,PSDATE
"RTN","PSOSDP",71,0)
 K PSDAY,PSDAYS,PSDT,PIIX,PSNAME,PSONUM,PSOT,PSSN,PSTYPE,RF,RFS,RXNO
"RTN","PSOSDP",72,0)
 K RXNODE,PSORM,PSOUT,PSOION,ZTDESC,DQTIME,F,O,W,CLN,APQUE,APTM,APRT
"RTN","PSOSDP",73,0)
 K APCLDT D KVA^VADPT,EXIT^PSOSD
"RTN","PSOSDP",74,0)
 G:'$D(ZTQUEUED) ^PSOSD
"RTN","PSOSDP",75,0)
 Q
"RTN","PSOSDP",76,0)
 ;
"RTN","PSOSDP",77,0)
COS I $P($G(^PSRX(J,3)),"^",3),$D(^VA(200,+$P($G(^(3)),"^",3),0)) W !?99,"COSIGNER: "_$P($G(^VA(200,$P(^PSRX(J,3),"^",3),0)),"^")
"RTN","PSOSDP",78,0)
 Q
"RTN","PSOTALK")
0^61^B83851636^B84172658
"RTN","PSOTALK",1,0)
PSOTALK ;BIR/EJW - SCRIPTALK INTERFACE FROM VISTA ; 2/21/08 4:26pm
"RTN","PSOTALK",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**135,182,211,200,249,297,326**;DEC 1997;Build 11
"RTN","PSOTALK",3,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSOTALK",4,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOTALK",5,0)
 ;External reference to ^PS(59.7 controlled subscription by DBIA 694
"RTN","PSOTALK",6,0)
 ;ROB SILVERMAN-HINES DEVELOPED ORIGINAL VISTA CUSTOM SOFTWARE FOR SCRIPTALK
"RTN","PSOTALK",7,0)
EN Q:'$$PAT55  ; QUIT IF NOT A SCRIPTALK ELIGIBLE PATIENT
"RTN","PSOTALK",8,0)
 S PSOSTALK=1
"RTN","PSOTALK",9,0)
 N PHONE,RXNUM,RXALPHA,DATE,EDATE,RFILLS,PTNAME,SIG,SIGX,PROV,DRUG,WARN,LINE
"RTN","PSOTALK",10,0)
 D GATHER,TRANS,CLEAN
"RTN","PSOTALK",11,0)
 Q
"RTN","PSOTALK",12,0)
 ;
"RTN","PSOTALK",13,0)
CLEAN K PHONE,RXNUM,RXALPHA,DATE,EDATE,RFILLS,PTNAME,SIG,SIGX,PROV,DRUG,WARN,VADM
"RTN","PSOTALK",14,0)
 K PSOCTP,PSOCTV,XMIT,PSORCT,PSOTSSN,PSOEXPDT
"RTN","PSOTALK",15,0)
 K PSOLNE,PSOLEN,PSOLINE,PSOWORD,PSOWDS,LINE
"RTN","PSOTALK",16,0)
 K PSOSIG1,PSOLSIG,PSOSIG,PSOSTOP,PSOPMAP
"RTN","PSOTALK",17,0)
 Q
"RTN","PSOTALK",18,0)
BARE N RX
"RTN","PSOTALK",19,0)
 D CLEAN
"RTN","PSOTALK",20,0)
 W ! S DIC="^PSRX(",DIC(0)="AEQM" D ^DIC K DIC Q:Y<0  S RX=+Y
"RTN","PSOTALK",21,0)
 D:'$D(PSOPAR) ^PSOLSET
"RTN","PSOTALK",22,0)
 I '$$PAT55 W !,"Patient not enrolled in ScripTalk program." G BAREO
"RTN","PSOTALK",23,0)
 I $P(^PSRX(RX,"STA"),"^")'=0 W !,"Prescription not ACTIVE" G BAREO
"RTN","PSOTALK",24,0)
 D GATHER
"RTN","PSOTALK",25,0)
 W !!,"  Queuing ScripTalk label"
"RTN","PSOTALK",26,0)
 D TRANS
"RTN","PSOTALK",27,0)
BAREO D CLEAN
"RTN","PSOTALK",28,0)
 W !!
"RTN","PSOTALK",29,0)
 G BARE
"RTN","PSOTALK",30,0)
 Q
"RTN","PSOTALK",31,0)
BARI N RX
"RTN","PSOTALK",32,0)
 D CLEAN
"RTN","PSOTALK",33,0)
 S RX=$$READER^PSOTALK1("FO^1:12","Enter Barcode Rx#")
"RTN","PSOTALK",34,0)
 Q:RX']""
"RTN","PSOTALK",35,0)
 G:RX'["-" BARIO
"RTN","PSOTALK",36,0)
 S RX=$P(RX,"-",2)
"RTN","PSOTALK",37,0)
 I '$D(^PSRX(RX,0)) W !,"Prescription not on file" G BARIO
"RTN","PSOTALK",38,0)
 I '$$PAT55 W !,"Patient not enrolled in ScripTalk program." G BARIO
"RTN","PSOTALK",39,0)
 I $P(^PSRX(RX,"STA"),"^")'=0 W !,"Prescription not ACTIVE" G BARIO
"RTN","PSOTALK",40,0)
 D:'$D(PSOPAR) ^PSOLSET
"RTN","PSOTALK",41,0)
 D GATHER
"RTN","PSOTALK",42,0)
 W !!,"  Queuing ScripTalk label"
"RTN","PSOTALK",43,0)
 D TRANS
"RTN","PSOTALK",44,0)
BARIO D CLEAN
"RTN","PSOTALK",45,0)
 W !!
"RTN","PSOTALK",46,0)
 G BARI
"RTN","PSOTALK",47,0)
 Q
"RTN","PSOTALK",48,0)
GATHER ;
"RTN","PSOTALK",49,0)
 N DFN
"RTN","PSOTALK",50,0)
 S DFN=$P(^PSRX(RX,0),"^",2)
"RTN","PSOTALK",51,0)
 D DEM^VADPT
"RTN","PSOTALK",52,0)
 S PHONE=$$PHONE
"RTN","PSOTALK",53,0)
 S RXNUM=+$$RXNUM
"RTN","PSOTALK",54,0)
 S RXALPHA=$$RXALPHA
"RTN","PSOTALK",55,0)
 S DATE=$$DATE
"RTN","PSOTALK",56,0)
 S FILLS=$$RFILLS I $L(RFILLS)=1 S FILLS="0"_FILLS
"RTN","PSOTALK",57,0)
 S PTNAME=VADM(1) D
"RTN","PSOTALK",58,0)
 .N FNAM,MI
"RTN","PSOTALK",59,0)
 .S FNAM=$P(PTNAME,",",2) I FNAM[" " D
"RTN","PSOTALK",60,0)
 ..S MI=$P(FNAM," ",2,99) I MI[" " S MI=$P(MI," ")
"RTN","PSOTALK",61,0)
 ..S FNAM=$P(FNAM," ")
"RTN","PSOTALK",62,0)
 .S PTNAME=FNAM_$S($G(MI)'="":" "_MI,1:"")_" "_$P(PTNAME,",")
"RTN","PSOTALK",63,0)
 .S PTNAME=$$UP^XLFSTR(PTNAME)
"RTN","PSOTALK",64,0)
 .S PTNAME=$TR(PTNAME,"-"," ")
"RTN","PSOTALK",65,0)
 .S PTNAME=$TR(PTNAME,".","")
"RTN","PSOTALK",66,0)
 .S PTNAME=$TR(PTNAME,"'"," ")
"RTN","PSOTALK",67,0)
 S SIG=$TR($$UP^XLFSTR($$SIGPOE),"[\]^_`{|}~","(/) -'( ) ")
"RTN","PSOTALK",68,0)
 S SIGX=$TR($$UP^XLFSTR($$SIGPOEX),"[\]^_`{|}~","(/) -'( ) ")
"RTN","PSOTALK",69,0)
 S PROV=$E($$UP^XLFSTR($$PROV),1,30)
"RTN","PSOTALK",70,0)
 S DRUG=$TR($$UP^XLFSTR($$DRUG),"[\]^_`{|}~","(/) -'( ) ")
"RTN","PSOTALK",71,0)
 S WARN=$$WARN
"RTN","PSOTALK",72,0)
 D PSOEXP
"RTN","PSOTALK",73,0)
 S LINE(1)="VAMC "_$$CITY_", "_$$STATE_"  "_$$ZIP
"RTN","PSOTALK",74,0)
 S LINE(2)=$$SITE_" ("_$$CLERK_"/"_$$VRPH_") "_$$ACODE_"-"_$$EPHON_" Exp: "_PSOEXPDT
"RTN","PSOTALK",75,0)
 S LINE(3)="Rx# "_$$RXNUM_"  "_$$EDATE_"  Fill "_$$FILNO_" of "_$$TFILLS
"RTN","PSOTALK",76,0)
 S LINE(4)=$$EPAT_"  "_$$LAST4
"RTN","PSOTALK",77,0)
 D INST^PSOTALK1 S LINE(5)=$G(PSOLNE(1)),LINE(6)=$G(PSOLNE(2)),LINE(7)=$G(PSOLNE(3))
"RTN","PSOTALK",78,0)
 S LINE(8)=$$EPROV,LINE(10)=$$DRUG
"RTN","PSOTALK",79,0)
 S LINE(9)="Qty: "_$$QTY_"  "_$$DF
"RTN","PSOTALK",80,0)
 Q
"RTN","PSOTALK",81,0)
TRANS ;If printer mapping defined use it; otherwise print by division 01/19/07
"RTN","PSOTALK",82,0)
 D PCHK:'$D(PSOPMAP)  ;don't recheck for mapped printer if PSOPMAP equal 0 (not defined) or 1 (defined)
"RTN","PSOTALK",83,0)
 I '$D(^PS(59.7,1,47,"B",IOS))&('$G(PSOPMAP)) S ZTIO="`"_$P($G(^PS(59,PSOSITE,"STALK")),U)
"RTN","PSOTALK",84,0)
 Q:ZTIO="`"
"RTN","PSOTALK",85,0)
 S ZTRTN="GO^PSOTALK",ZTSAVE("*")="",ZTDTH=$$NOW^XLFDT,ZTDESC="Scriptalk Interface Transmission"
"RTN","PSOTALK",86,0)
 D ^%ZTLOAD
"RTN","PSOTALK",87,0)
 Q
"RTN","PSOTALK",88,0)
PCHK ;Check for printers that are mapped to a ScripTalk printer
"RTN","PSOTALK",89,0)
 N PSOLPRT,PSONIOS,PSOLBSEQ
"RTN","PSOTALK",90,0)
 S ZTIO="`",PSOLPRT=$S($D(PSOLAP):PSOLAP,$G(SUSPT):PSLION,$D(ION):ION,1:"") Q:PSOLPRT=""  Q:'$D(^%ZIS(1,"B",PSOLPRT))
"RTN","PSOTALK",91,0)
 S PSONIOS="",PSOPMAP=0,PSONIOS=$O(^%ZIS(1,"B",PSOLPRT,PSONIOS))
"RTN","PSOTALK",92,0)
 I $D(^PS(59.7,1,47,"B",PSONIOS)) D
"RTN","PSOTALK",93,0)
 . S PSOLBSEQ="",PSOLBSEQ=$O(^PS(59.7,1,47,"B",PSONIOS,PSOLBSEQ))
"RTN","PSOTALK",94,0)
 . S ZTIO=ZTIO_$P(^PS(59.7,1,47,PSOLBSEQ,0),"^",2),PSOPMAP=1
"RTN","PSOTALK",95,0)
 Q
"RTN","PSOTALK",96,0)
 ;
"RTN","PSOTALK",97,0)
GO W !,"^XA",!,"^FO250,700^XGE:RX.GRF^FS"  ;;1.2e 4-17-02 TO MOVE GRAPHIC
"RTN","PSOTALK",98,0)
 D OVERLAY,PICOTAG  ;;FOR LARGER LABELS
"RTN","PSOTALK",99,0)
 W !,"^PQ1,0,1,Y",!,"^XZ"  ;;FOR LARGER LABELS
"RTN","PSOTALK",100,0)
 S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSOTALK",101,0)
 Q
"RTN","PSOTALK",102,0)
 ;
"RTN","PSOTALK",103,0)
OVERLAY F PSOLINE=1:1:7 D DEFLINE((9+((20-PSOLINE)*28)),50,LINE(PSOLINE),PSOLINE,0)
"RTN","PSOTALK",104,0)
 F PSOLINE=8:1:10 D DEFLINE((9+((19-PSOLINE)*28)),50,LINE(PSOLINE),PSOLINE,0)
"RTN","PSOTALK",105,0)
 Q
"RTN","PSOTALK",106,0)
 ;
"RTN","PSOTALK",107,0)
DEFLINE(XCORD,YCORD,PRTOUT,FIELDNO,OFFSET) ;
"RTN","PSOTALK",108,0)
 W !,"^AFR,20,10^FO"_XCORD_","_YCORD_"^FR^CI0^FD"_PRTOUT_"^FS"
"RTN","PSOTALK",109,0)
 Q
"RTN","PSOTALK",110,0)
 ;
"RTN","PSOTALK",111,0)
PICOTAG S PSOCTP=1
"RTN","PSOTALK",112,0)
 S DRUG=$E(DRUG,1,39)  ;1.2c*1 TEMPORARY FIX FOR DRUG TRUNCATE AT 39
"RTN","PSOTALK",113,0)
 F XMIT=PTNAME,DRUG,SIGX,DATE,FILLS,WARN,PROV,PHONE,RXNUM,RXALPHA D XMITP
"RTN","PSOTALK",114,0)
 Q
"RTN","PSOTALK",115,0)
 ;
"RTN","PSOTALK",116,0)
XMITP W !,"^RX"_$S(PSOCTP<10:"0",1:"")_PSOCTP_","_XMIT_"^FS"
"RTN","PSOTALK",117,0)
 S PSOCTP=PSOCTP+1
"RTN","PSOTALK",118,0)
 Q
"RTN","PSOTALK",119,0)
ID() I $$PAT55 Q "+SCRIPTALK"
"RTN","PSOTALK",120,0)
 E  Q ""
"RTN","PSOTALK",121,0)
AUTO ;;v1.2c - LABEL REPRINTING FUNCTIONS 3-12-02
"RTN","PSOTALK",122,0)
 Q:$G(PSOTREP)  ;NO AUTO-PRINT DURING REGULAR NON-VOIDED LABEL REPRINT
"RTN","PSOTALK",123,0)
 D PCHK
"RTN","PSOTALK",124,0)
 I $P($G(^PS(59,+PSOSITE,"STALK")),U,2)="A"!($G(PSOPMAP)) D EN
"RTN","PSOTALK",125,0)
 Q
"RTN","PSOTALK",126,0)
 ;
"RTN","PSOTALK",127,0)
PAT55() Q +$G(^PS(55,"ASTALK",$P(^PSRX(RX,0),"^",2)))  ;IS PATIENT ENROLLED (NEW FIELD POSITION 2-12-02 RMS UPDATE v1.2b)
"RTN","PSOTALK",128,0)
PHONE() ;changes below 1.2c*1 to swap to site signed-on vs. site from Rx
"RTN","PSOTALK",129,0)
 Q $E($P(^PS(59,+PSOSITE,0),"^",3),1,3)_$E($TR($P(^PS(59,+PSOSITE,0),"^",4),"-,",""),1,7) ; RX DIVISION PHONE NUMBER
"RTN","PSOTALK",130,0)
CITY() Q $P(^PS(59,+PSOSITE,0),"^",7)
"RTN","PSOTALK",131,0)
STATE() Q $P(^DIC(5,$P(^PS(59,+PSOSITE,0),"^",8),0),"^",2)
"RTN","PSOTALK",132,0)
ZIP() Q $P(^PS(59,+PSOSITE,0),"^",5)
"RTN","PSOTALK",133,0)
SITE() Q $P(^PS(59,+PSOSITE,0),"^",6)
"RTN","PSOTALK",134,0)
ACODE() Q $P(^PS(59,+PSOSITE,0),"^",3)
"RTN","PSOTALK",135,0)
EPHON() Q $P(^PS(59,+PSOSITE,0),"^",4)
"RTN","PSOTALK",136,0)
CLERK() Q $P($G(^PSRX(RX,"OR1")),"^",5)
"RTN","PSOTALK",137,0)
PSOEXP ;
"RTN","PSOTALK",138,0)
 N X1,X2,X S X1=DT,X2=365 D C^%DTC S PSOEXPDT=X
"RTN","PSOTALK",139,0)
 S PSOEXPDT=$E(PSOEXPDT,4,5)_"/"_$E(PSOEXPDT,6,7)_"/"_$E(PSOEXPDT,2,3)
"RTN","PSOTALK",140,0)
 Q
"RTN","PSOTALK",141,0)
VRPH() Q $P($G(^PSRX(RX,2)),"^",10)
"RTN","PSOTALK",142,0)
RXNUM() Q $P(^PSRX(RX,0),"^",1) ;RETURN RX EXTERNAL NUMBER
"RTN","PSOTALK",143,0)
RXALPHA() ;RETURN RENEWAL LETTER OR SPACE CHARACTER
"RTN","PSOTALK",144,0)
 N RXALPHA
"RTN","PSOTALK",145,0)
 S RXALPHA=$E($P(^PSRX(RX,0),"^",1),$L($P(^PSRX(RX,0),"^",1)))
"RTN","PSOTALK",146,0)
 Q $S(RXALPHA?1A:RXALPHA,1:" ")
"RTN","PSOTALK",147,0)
DATE() ;CHANGED 7-30-01 TO USE EDATE FORMAT ALSO WHEN SPEAKING
"RTN","PSOTALK",148,0)
 S EDATE=$P(^PSRX(RX,3),"^")
"RTN","PSOTALK",149,0)
 Q $E(EDATE,4,5)_$E(EDATE,6,7)_$E(EDATE,2,3)
"RTN","PSOTALK",150,0)
EDATE() Q $$FMTE^XLFDT($P(^PSRX(RX,3),"^"))  ; EXTERNAL DATE / LAST DISPENSED
"RTN","PSOTALK",151,0)
FILLS() Q $G(RXF)+1 ; FILL COUNT
"RTN","PSOTALK",152,0)
TFILLS() Q $P(^PSRX(RX,0),"^",9)+1 ; TOTAL FILLS
"RTN","PSOTALK",153,0)
RFILLS() ;NEW REFILLS REMAINING METHOD 9-21-00, BASED ON PTST+5^PSORXVW
"RTN","PSOTALK",154,0)
 S RFILLS=$P(^PSRX(RX,0),"^",9),PSORCT=0 F  S PSORCT=$O(^PSRX(RX,1,PSORCT)) Q:'PSORCT  S RFILLS=RFILLS-1
"RTN","PSOTALK",155,0)
 Q RFILLS
"RTN","PSOTALK",156,0)
FILNO() Q $$TFILLS-$$RFILLS
"RTN","PSOTALK",157,0)
EPAT() Q $P(^DPT($P(^PSRX(RX,0),"^",2),0),"^") ; EXTERNAL PATIENT NAME
"RTN","PSOTALK",158,0)
LAST4() S PSOTSSN="" ; REMOVED LAST 4 SSN - PATCH *326
"RTN","PSOTALK",159,0)
 Q PSOTSSN
"RTN","PSOTALK",160,0)
SIG() ;THIS SUBROUTINE WILL BE ABANDONED IF SIGPOE WORKS v1.2c 3-13-02
"RTN","PSOTALK",161,0)
 I $L($P(^PSRX(RX,"SIG"),"^",1))=0 Q $E($$LSIG^PSOTALK1($P(^PSRX(RX,"SIG1",1,0),"^",1)),1,196)
"RTN","PSOTALK",162,0)
 E  Q $E($$LSIG^PSOTALK1($P(^PSRX(RX,"SIG"),"^",1)),1,196) ; SIG -- NEEDS TO BE EXPANDED
"RTN","PSOTALK",163,0)
SIGPOE() ;v1.2c - NEW SUBROUTINE TO GIVE MESSAGE FOR LONG SIGS FOR THE HUMAN READABLE PORTION
"RTN","PSOTALK",164,0)
 S PSOSIG=""
"RTN","PSOTALK",165,0)
 I $P($G(^PS(55,DFN,"LAN")),"^",1) D  G SIGPOEE
"RTN","PSOTALK",166,0)
 .S PSOSIG=" " ; PUT SPACE ON FRONT OF SIG (GETS STRIPPED OFF LATER)
"RTN","PSOTALK",167,0)
 .D OTHL1^PSOLBL3(RX) I $O(SIG2(0))="" Q
"RTN","PSOTALK",168,0)
 .N XX,X
"RTN","PSOTALK",169,0)
 .;PSO*7*211;MODIFIED TO REPLACE SIG IF >138 INSTEAD OF 196
"RTN","PSOTALK",170,0)
 .S XX=0 F  S XX=$O(SIG2(XX)) Q:'XX  S X=SIG2(XX) I X'="" S PSOSIG=PSOSIG_X_" " I $L(PSOSIG)>138 D  Q
"RTN","PSOTALK",171,0)
 ..S PSOSIG=" INDICACIONES MUY LARGAS. IMPRIMA UNA ETIQUETA DE VISTA VALIDA Y APLIQUELA SOBRE ESTA ETIQUETA DE SCRIPTALK EN LA BOTELLA."
"RTN","PSOTALK",172,0)
 E  D  ;
"RTN","PSOTALK",173,0)
 . N PSOSEQ
"RTN","PSOTALK",174,0)
 . S PSOSTOP=0,PSOSIG=""
"RTN","PSOTALK",175,0)
 . S PSOLSIG=" SIG IS TOO LONG. REPRINT A NON-VOIDED VISTA LABEL AND PLACE OVER THIS SCRIPTALK LABEL"
"RTN","PSOTALK",176,0)
 . S PSOSEQ=0 F  S PSOSEQ=$O(^PSRX(RX,"SIG1",PSOSEQ)) Q:PSOSEQ'=+PSOSEQ!($G(PSOSTOP))  D  ;
"RTN","PSOTALK",177,0)
 .. S PSOSIG1=$G(^PSRX(RX,"SIG1",PSOSEQ,0))
"RTN","PSOTALK",178,0)
 ..;PSO*7*211;MODIFIED TO REPLACE SIG IF >138 INSTEAD OF 196
"RTN","PSOTALK",179,0)
 .. I $L(PSOSIG)+$L($G(^PSRX(RX,"SIG1",PSOSEQ,0)))>138 S PSOSIG=PSOLSIG,PSOSTOP=1 Q  ;
"RTN","PSOTALK",180,0)
 .. S PSOSIG=$G(PSOSIG)_" "_PSOSIG1
"RTN","PSOTALK",181,0)
SIGPOEE Q $E(PSOSIG,2,197)
"RTN","PSOTALK",182,0)
 ;
"RTN","PSOTALK",183,0)
SIGPOEX() ;v1.2c - NEW SUBROUTINE TO GIVE MESSAGE FOR LONG SIGS FOR THE READ ALOUD PORTION
"RTN","PSOTALK",184,0)
 S PSOSIG=""
"RTN","PSOTALK",185,0)
 I $P($G(^PS(55,DFN,"LAN")),"^",1) D  G SIGPOEEX
"RTN","PSOTALK",186,0)
 .S PSOSIG=" " ; PUT SPACE ON FRONT OF SIG (GETS STRIPPED OFF LATER)
"RTN","PSOTALK",187,0)
 .D OTHL1^PSOLBL3(RX) I $O(SIG2(0))="" Q
"RTN","PSOTALK",188,0)
 .N XX,X
"RTN","PSOTALK",189,0)
 .S XX=0 F  S XX=$O(SIG2(XX)) Q:'XX  S X=SIG2(XX) I X'="" S PSOSIG=PSOSIG_X_" " I $L(PSOSIG)>196 D  Q
"RTN","PSOTALK",190,0)
 ..S PSOSIG=" LAS INSTRUCCIONES DE ESTA RECETA SON MUY LARGAS.  POR FAVOR SOLICITE A SU CUIDADOR QUE LE LEA LAS INSTRUCCIONES IMPRESAS EN EL ROTULO O COMUNIQUESE CON SU MEDICO PARA INSTRUCCIONES COMPLETAS."
"RTN","PSOTALK",191,0)
 I $L($P(^PSRX(RX,"SIG"),"^",1))'=0 Q $E($$LSIG^PSOTALK1($P(^PSRX(RX,"SIG"),"^",1)),1,196)
"RTN","PSOTALK",192,0)
 E  D  ;
"RTN","PSOTALK",193,0)
 . N PSOSEQ
"RTN","PSOTALK",194,0)
 . S PSOSTOP=0,PSOSIG=""
"RTN","PSOTALK",195,0)
 . S PSOLSIG=" THE INSTRUCTIONS FOR THIS PRESCRIPTION ARE TOO LONG. PLEASE HAVE A CAREGIVER READ THE PRINTED LABEL OR CONTACT YOUR PHYSICIAN FOR COMPLETE INSTRUCTIONS."
"RTN","PSOTALK",196,0)
 . S PSOSEQ=0 F  S PSOSEQ=$O(^PSRX(RX,"SIG1",PSOSEQ)) Q:PSOSEQ'=+PSOSEQ!($G(PSOSTOP))  D  ;
"RTN","PSOTALK",197,0)
 .. S PSOSIG1=$G(^PSRX(RX,"SIG1",PSOSEQ,0))
"RTN","PSOTALK",198,0)
 .. I $L(PSOSIG)+$L($G(^PSRX(RX,"SIG1",PSOSEQ,0)))>196 S PSOSIG=PSOLSIG,PSOSTOP=1 Q  ;
"RTN","PSOTALK",199,0)
 .. S PSOSIG=$G(PSOSIG)_" "_PSOSIG1
"RTN","PSOTALK",200,0)
SIGPOEEX Q $E(PSOSIG,2,197)
"RTN","PSOTALK",201,0)
PROV() ;PROVIDER NAME
"RTN","PSOTALK",202,0)
 K DIC,X,Y S DIC="^VA(200,",DIC(0)="M",X="`"_+$P(^PSRX(RX,0),"^",4) D ^DIC S PSOPHYS=$S(+Y:$P(Y,"^",2),1:"UNKNOWN") K DIC,X,Y
"RTN","PSOTALK",203,0)
 Q $P($$NAMEFMT^XLFNAME(PSOPHYS)," MD")
"RTN","PSOTALK",204,0)
EPROV() ;
"RTN","PSOTALK",205,0)
 K DIC,X,Y S DIC="^VA(200,",DIC(0)="M",X="`"_+$P(^PSRX(RX,0),"^",4) D ^DIC S PSOPHYS=$S(+Y:$P(Y,"^",2),1:"UNKNOWN") K DIC,X,Y
"RTN","PSOTALK",206,0)
 Q PSOPHYS
"RTN","PSOTALK",207,0)
QTY() Q $S($G(RXP):$P(RXP,"^",4),1:$P(^PSRX(RX,0),"^",7))
"RTN","PSOTALK",208,0)
DF() Q $P($G(^PSDRUG($P(^PSRX(RX,0),"^",6),660)),"^",8)
"RTN","PSOTALK",209,0)
DRUG() Q $$ZZ^PSOSUTL(RX) ; DRUG NAME
"RTN","PSOTALK",210,0)
WARN() N WARN,NWARN,IWARN,XWARN ; 1-28-02 UPDATE v1.2a TO ELIMINATE LOCAL CODES
"RTN","PSOTALK",211,0)
 S WARN=$P(^PSDRUG($P(^PSRX(RX,0),"^",6),0),"^",8) ; WARNING LABEL CODES
"RTN","PSOTALK",212,0)
 F NWARN=1:1:3 S IWARN=$P(WARN,",",NWARN) S:IWARN>20 IWARN="" S:$L(IWARN)=1 IWARN="0"_IWARN S:$L(IWARN)=0 IWARN="00" S XWARN=$G(XWARN)_IWARN
"RTN","PSOTALK",213,0)
 Q XWARN
"RTN","PSOTALK2")
0^17^B62138253^B61754763
"RTN","PSOTALK2",1,0)
PSOTALK2 ;BIR/EJW - SCRIPTALK ENROLLMENT FUNCTIONS ;3-28-02
"RTN","PSOTALK2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**135,182,326**;DEC 1997;Build 11
"RTN","PSOTALK2",3,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSOTALK2",4,0)
 ;External reference ^TMP("TIUP", ^TIUPNAPI, ^TIU(8925.1 supported by DBIA 1911
"RTN","PSOTALK2",5,0)
ENROLL ;
"RTN","PSOTALK2",6,0)
 N PSOSTEN,PSOIND,PSOLAST,DFN
"RTN","PSOTALK2",7,0)
 S PSOIND=""
"RTN","PSOTALK2",8,0)
 I '$G(PSOFIRST) D INSTR S PSOFIRST=1
"RTN","PSOTALK2",9,0)
 W !
"RTN","PSOTALK2",10,0)
 K DIC W ! S DIC(0)="QEAM",DIC("A")="Select PATIENT: " D EN^PSOPATLK S Y=PSOPTLK K DIC,PSOPTLK I Y<1!($D(DUOUT))!($D(DTOUT)) D CLEAN Q
"RTN","PSOTALK2",11,0)
 S PSOPT=+Y
"RTN","PSOTALK2",12,0)
 S DFN=PSOPT D DEM^VADPT I +$G(VADM(6)) W !,"Patient is deceased",! G ENROLL
"RTN","PSOTALK2",13,0)
 I '$D(^PS(55,PSOPT)) D
"RTN","PSOTALK2",14,0)
 .S DIC="^PS(55,",DLAYGO=55
"RTN","PSOTALK2",15,0)
 .K DD,DO S DIC(0)="L",(DINUM,X)=PSOPT D FILE^DICN D:Y<1  K DIC,DA,DR,DD,DO
"RTN","PSOTALK2",16,0)
 ..S $P(^PS(55,PSOPT,0),"^")=PSOPT K DIK S DA=PSOPT,DIK="^PS(55,",DIK(1)=.01 D EN^DIK K DIK
"RTN","PSOTALK2",17,0)
 S PSOSTEN=$G(^PS(55,"ASTALK",PSOPT))
"RTN","PSOTALK2",18,0)
 S DIR(0)="Y",DIR("A")="SCRIPTALK PATIENT" S DIR("B")=$S(PSOSTEN:"Y",1:"N") D ^DIR K DIR
"RTN","PSOTALK2",19,0)
 S PSOSTEN=Y
"RTN","PSOTALK2",20,0)
 I PSOSTEN D MAIL,GETIND
"RTN","PSOTALK2",21,0)
 D SET55
"RTN","PSOTALK2",22,0)
 D NOTE(PSOPT)
"RTN","PSOTALK2",23,0)
 K PSOIND,PSOPT,PSOSTEN,PSOLAST,X,Y
"RTN","PSOTALK2",24,0)
 G ENROLL
"RTN","PSOTALK2",25,0)
 ;
"RTN","PSOTALK2",26,0)
SET55 ; SET MULTIPLE FOR SCRIPTALK ENROLLMENT AUDIT
"RTN","PSOTALK2",27,0)
 N PSODA,PSOERR,PSOIEN,PSOSTDT
"RTN","PSOTALK2",28,0)
 I PSOPT="" Q
"RTN","PSOTALK2",29,0)
 S PSOSTDT=$$NOW^XLFDT
"RTN","PSOTALK2",30,0)
 S PSODA(55.0108,"+1,"_PSOPT_",",.01)=PSOSTDT
"RTN","PSOTALK2",31,0)
 S PSODA(55.0108,"+1,"_PSOPT_",",1)=PSOSTEN
"RTN","PSOTALK2",32,0)
 S PSODA(55.0108,"+1,"_PSOPT_",",2)=PSOIND
"RTN","PSOTALK2",33,0)
 S PSODA(55.0108,"+1,"_PSOPT_",",3)=$G(DUZ)
"RTN","PSOTALK2",34,0)
 D UPDATE^DIE("","PSODA","PSOIEN","PSOERR")
"RTN","PSOTALK2",35,0)
 Q
"RTN","PSOTALK2",36,0)
 ;
"RTN","PSOTALK2",37,0)
GETIND ; GET INDICATION FOR ENROLLMENT
"RTN","PSOTALK2",38,0)
 S PSOLAST=$P($G(^PS(55,PSOPT,"SCTALK",0)),"^",4) I PSOLAST'="" S PSOIND=$P($G(^PS(55,PSOPT,"SCTALK",PSOLAST,0)),"^",3) ; IF PRIOR ANSWER WAS 'Y' - GET PRIOR INDICATION
"RTN","PSOTALK2",39,0)
 S DIR(0)="S^B:BLIND VETERAN;L:LOW VISION",DIR("A")="INDICATION" S DIR("B")=PSOIND D ^DIR K DIR
"RTN","PSOTALK2",40,0)
 S PSOIND=$G(Y)
"RTN","PSOTALK2",41,0)
 Q
"RTN","PSOTALK2",42,0)
 ;
"RTN","PSOTALK2",43,0)
INSTR ;
"RTN","PSOTALK2",44,0)
 W @IOF
"RTN","PSOTALK2",45,0)
 I $O(^TIU(8925.1,"B","SCRIPTALK ENROLLMENT",0))="" Q
"RTN","PSOTALK2",46,0)
 W !
"RTN","PSOTALK2",47,0)
 W !?3,"At the conclusion of this enrollment option, you will be given"
"RTN","PSOTALK2",48,0)
 W !?3,"the opportunity to sign a progress note recording the enrollment"
"RTN","PSOTALK2",49,0)
 W !?3,"of new ScripTalk patients. If you modify the record of a patient"
"RTN","PSOTALK2",50,0)
 W !?3,"that was previously enrolled, and they remain enrolled, you may"
"RTN","PSOTALK2",51,0)
 W !?3,"wish to either delete or edit the text of the generated note."
"RTN","PSOTALK2",52,0)
 W !!
"RTN","PSOTALK2",53,0)
 K PSOSQ,PSOTT,PSOSTP
"RTN","PSOTALK2",54,0)
 Q
"RTN","PSOTALK2",55,0)
 ;
"RTN","PSOTALK2",56,0)
NOTE(PSOPT) ;CREATE A PROGRESS NOTE FOR PATIENT 'PSOPT' ABOUT ENROLLMENT
"RTN","PSOTALK2",57,0)
 Q:'+$G(^PS(55,"ASTALK",PSOPT))  ; IF THIS PTS ENROLLMENT ISN'T ACTIVE
"RTN","PSOTALK2",58,0)
 S PSOTITL=$O(^TIU(8925.1,"B","SCRIPTALK ENROLLMENT",0))
"RTN","PSOTALK2",59,0)
 Q:'+PSOTITL  ;IF NO TITLE ON SYSTEM
"RTN","PSOTALK2",60,0)
 S PSOPTNM=$P($G(^DPT(PSOPT,0)),U,1)
"RTN","PSOTALK2",61,0)
 S PSOLINE=1
"RTN","PSOTALK2",62,0)
 S ^TMP("TIUP",$J,PSOLINE,0)=PSOPTNM_" was enrolled in ScripTalk today, and is now eligible to receive"
"RTN","PSOTALK2",63,0)
 S PSOLINE=PSOLINE+1
"RTN","PSOTALK2",64,0)
 S ^TMP("TIUP",$J,PSOLINE,0)="prescriptions with encoded speech-capable labels."
"RTN","PSOTALK2",65,0)
 S ^TMP("TIUP",$J,0)=U_U_PSOLINE_PSOLINE_U_DT_U
"RTN","PSOTALK2",66,0)
INSTALL K TIUDA
"RTN","PSOTALK2",67,0)
 D NEW^TIUPNAPI(.TIUDA,PSOPT,DUZ,$$NOW^XLFDT,PSOTITL)
"RTN","PSOTALK2",68,0)
 Q
"RTN","PSOTALK2",69,0)
 ;
"RTN","PSOTALK2",70,0)
CLEAN K PSOLINE,PSOPTNM,PSOTITL,PSOSTP,PSOPT,PSOFIRST
"RTN","PSOTALK2",71,0)
 K ^TMP("TIUP",$J)
"RTN","PSOTALK2",72,0)
 Q
"RTN","PSOTALK2",73,0)
 ;
"RTN","PSOTALK2",74,0)
AUDREP ;
"RTN","PSOTALK2",75,0)
 K DIC W ! S DIC(0)="QEAM",DIC("A")="Select PATIENT: " D EN^PSOPATLK S Y=PSOPTLK K DIC,PSOPTLK I Y<1!($D(DUOUT))!($D(DTOUT)) Q
"RTN","PSOTALK2",76,0)
 S PSOPT=+Y
"RTN","PSOTALK2",77,0)
 S ZTSAVE("*")=""
"RTN","PSOTALK2",78,0)
 W !!,"You may queue the report to print, if you wish.",!
"RTN","PSOTALK2",79,0)
 K %ZIS,POP,IOP S %ZIS="QM" D ^%ZIS I $G(POP) W !!,"Nothing queued to print.",! G DONE
"RTN","PSOTALK2",80,0)
 I $D(IO("Q")) S ZTRTN="AUDRQ^PSOTALK2",ZTDESC="Report of ScripTalk Enrollment",ZTSAVE("*")="" D ^%ZTLOAD K %ZSI W !,"Report queued to print.",! G DONE
"RTN","PSOTALK2",81,0)
AUDRQ ;
"RTN","PSOTALK2",82,0)
 U IO
"RTN","PSOTALK2",83,0)
 S PSOOUT=0,PSODV=$S($E(IOST)="C":"C",1:"P")
"RTN","PSOTALK2",84,0)
 S PSOPGCT=1
"RTN","PSOTALK2",85,0)
 D TITLEA I PSOOUT G DONE
"RTN","PSOTALK2",86,0)
 S PSOAUD=0 F  S PSOAUD=$O(^PS(55,PSOPT,"SCTALK",PSOAUD)) Q:PSOAUD=""  D  I PSOOUT Q
"RTN","PSOTALK2",87,0)
 .S PSONODE=$G(^PS(55,PSOPT,"SCTALK",PSOAUD,0))
"RTN","PSOTALK2",88,0)
 .S PSOSTAT=$P(PSONODE,"^",2)
"RTN","PSOTALK2",89,0)
 .S PSOTIME=$$FMTE^XLFDT($P(PSONODE,U,1)),PSOTIME=$P(PSOTIME,"@")_"  "_$P(PSOTIME,"@",2)
"RTN","PSOTALK2",90,0)
 .S PSOTIME=$P(PSOTIME,":",1,2)
"RTN","PSOTALK2",91,0)
 .I ($Y+5)>IOSL&('$G(PSOOUT)) D TITLEA I PSOOUT Q
"RTN","PSOTALK2",92,0)
 .W !,?2,PSOTIME
"RTN","PSOTALK2",93,0)
 .W ?25,$S(PSOSTAT:"YES",PSOSTAT=0:"NO",1:" ")
"RTN","PSOTALK2",94,0)
 .S PSOIND=$P(PSONODE,"^",3)
"RTN","PSOTALK2",95,0)
 .I 'PSOSTAT S PSOIND=""
"RTN","PSOTALK2",96,0)
 .W ?35,$S(PSOIND="B":"BLIND VETERAN",PSOIND="L":"LOW VISION",1:"")
"RTN","PSOTALK2",97,0)
 .I $P(PSONODE,"^",4)'="" D  W ?52,$E(PSODUZ,1,27)
"RTN","PSOTALK2",98,0)
 ..K DIC,X,Y S DIC="^VA(200,",DIC(0)="M",X="`"_+$P(PSONODE,"^",4) D ^DIC S PSODUZ=$S(+Y:$P(Y,"^",2),1:"UNKNOWN") K DIC,X,Y
"RTN","PSOTALK2",99,0)
 I PSOOUT G DONE
"RTN","PSOTALK2",100,0)
END ;
"RTN","PSOTALK2",101,0)
 I '$G(PSOOUT),$G(PSODV)="C" W !!,"** End of Report **" K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSOTALK2",102,0)
 I $G(PSODV)="C" W !
"RTN","PSOTALK2",103,0)
 E  W @IOF
"RTN","PSOTALK2",104,0)
DONE K PSOPT,PSOAUD,PSONODE,PSOIND,PSOSTAT,PSOPGCT,Y,IOP,POP,IO("Q"),DIRUT,DUOUT,DTOUT,PSODV,PSOOUT
"RTN","PSOTALK2",105,0)
 K PSODFN,PSOIND,PSOSSN,PSOPRINT,PSONM,^TMP($J,"PSOTALK2")
"RTN","PSOTALK2",106,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSOTALK2",107,0)
 Q
"RTN","PSOTALK2",108,0)
 ;
"RTN","PSOTALK2",109,0)
TITLEA ;
"RTN","PSOTALK2",110,0)
 I $G(PSODV)="C",$G(PSOPGCT)'=1 W ! K DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSOOUT=1 Q
"RTN","PSOTALK2",111,0)
 W @IOF
"RTN","PSOTALK2",112,0)
 W !,"SCRIPTALK AUDIT HISTORY" S Y=DT X ^DD("DD") W ?40,"Date printed: ",Y,?70,"Page: ",PSOPGCT,!!
"RTN","PSOTALK2",113,0)
 S PSOPGCT=PSOPGCT+1
"RTN","PSOTALK2",114,0)
 W !,"Name: ",$E($P(^DPT(PSOPT,0),"^"),1,25),"    Currently enrolled: ",$S($G(^PS(55,"ASTALK",PSOPT)):"YES",1:"NO"),!!
"RTN","PSOTALK2",115,0)
 W !?24,"Previous",?35,"Previous"
"RTN","PSOTALK2",116,0)
 W !,?2,"Date-Time Set",?25,"Status",?35,"Indication",?52,"Entered by"
"RTN","PSOTALK2",117,0)
 W !,?2,"-------------------",?24,"--------",?35,"-------------",?52,"--------------------",!
"RTN","PSOTALK2",118,0)
 Q
"RTN","PSOTALK2",119,0)
 ;
"RTN","PSOTALK2",120,0)
ENQ ;
"RTN","PSOTALK2",121,0)
 W ! K DIR S DIR(0)="Y",DIR("B")="Y",DIR("A")="Do you want to report only active enrollees" D ^DIR K DIR D:$D(DIRUT) MESS G:Y["^"!($D(DIRUT)) DONE S PSOPRINT=$S(Y:1,1:0)
"RTN","PSOTALK2",122,0)
 W !!,"You may queue the report to print, if you wish.",!
"RTN","PSOTALK2",123,0)
 K %ZIS,POP,IOP S %ZIS="QM" D ^%ZIS I $G(POP) W !!,"Nothing queued to print.",! G DONE
"RTN","PSOTALK2",124,0)
 I $D(IO("Q")) S ZTRTN="RPENROLL^PSOTALK2",ZTDESC="Report of ScripTalk Enrollment",ZTSAVE("*")="" D ^%ZTLOAD K %ZSI W !,"Report queued to print.",! G DONE
"RTN","PSOTALK2",125,0)
RPENROLL ;
"RTN","PSOTALK2",126,0)
 U IO
"RTN","PSOTALK2",127,0)
 S PSOOUT=0,PSODV=$S($E(IOST)="C":"C",1:"P")
"RTN","PSOTALK2",128,0)
 S PSOPGCT=1
"RTN","PSOTALK2",129,0)
 D TITLEE I PSOOUT G DONE
"RTN","PSOTALK2",130,0)
 K ^TMP($J,"PSOTALK2")
"RTN","PSOTALK2",131,0)
 D GETDFN
"RTN","PSOTALK2",132,0)
 I '$D(^TMP($J,"PSOTALK2")) W !!,"No patients to report!",!! G DONE
"RTN","PSOTALK2",133,0)
 S PSONM="" F  S PSONM=$O(^TMP($J,"PSOTALK2",PSONM)) Q:PSONM=""  S PSOSSN="" F  S PSOSSN=$O(^TMP($J,"PSOTALK2",PSONM,PSOSSN)) Q:PSOSSN=""  D  I PSOOUT G DONE
"RTN","PSOTALK2",134,0)
 .S PSOIND=^TMP($J,"PSOTALK2",PSONM,PSOSSN)
"RTN","PSOTALK2",135,0)
 .I ($Y+5)>IOSL&('$G(PSOOUT)) D TITLEE I PSOOUT Q
"RTN","PSOTALK2",136,0)
 .W !,PSONM,?25," ",PSOSSN I 'PSOPRINT W ?43,$S(+$P(PSOIND,"^",3):"YES",1:"NO")
"RTN","PSOTALK2",137,0)
 .W !,?3,$S($P(PSOIND,"^",2)="B":"BLIND VETERAN",$P(PSOIND,"^",2)="L":"LOW VISION",1:" ")
"RTN","PSOTALK2",138,0)
 .W ?58,$$FMTE^XLFDT($P(PSOIND,"^")),!
"RTN","PSOTALK2",139,0)
 G END
"RTN","PSOTALK2",140,0)
 ;
"RTN","PSOTALK2",141,0)
TITLEE ;
"RTN","PSOTALK2",142,0)
 I $G(PSODV)="C",$G(PSOPGCT)'=1 W ! K DIR S DIR(0)="E" D ^DIR K DIR I 'Y S PSOOUT=1 Q
"RTN","PSOTALK2",143,0)
 W @IOF
"RTN","PSOTALK2",144,0)
 W !,"Report of ScripTalk Enrollment",?40,"Date printed: "_$$FMTE^XLFDT(DT),?70,"Page: ",PSOPGCT,!!
"RTN","PSOTALK2",145,0)
 S PSOPGCT=PSOPGCT+1
"RTN","PSOTALK2",146,0)
 W !,"Patient name",?25," SSN" I 'PSOPRINT W ?40,"Active enrollee?"
"RTN","PSOTALK2",147,0)
 W !?3,"Indication",?57,"Enrollment last updated"
"RTN","PSOTALK2",148,0)
 W !,"--------------",?25,"-----------" W:'PSOPRINT ?40,"-------------" W ?57,"-----------------------",!
"RTN","PSOTALK2",149,0)
 Q
"RTN","PSOTALK2",150,0)
 ;
"RTN","PSOTALK2",151,0)
GETDFN ;
"RTN","PSOTALK2",152,0)
 N DFN
"RTN","PSOTALK2",153,0)
 S PSODFN=0 F  S PSODFN=$O(^PS(55,"ASTALK",PSODFN)) Q:PSODFN=""  D
"RTN","PSOTALK2",154,0)
 .I PSOPRINT I '$G(^PS(55,"ASTALK",PSODFN)) Q
"RTN","PSOTALK2",155,0)
 .S DFN=PSODFN D DEM^VADPT I +$G(VADM(6)) Q  ; DECEASED
"RTN","PSOTALK2",156,0)
 .S PSOSEQ=$P($G(^PS(55,DFN,"SCTALK",0)),"^",4)
"RTN","PSOTALK2",157,0)
 .S PSOAUD=""
"RTN","PSOTALK2",158,0)
 .I PSOSEQ'="" S PSOAUD=$G(^PS(55,DFN,"SCTALK",PSOSEQ,0))
"RTN","PSOTALK2",159,0)
 .I $G(VA("PID"))="" S VA("PID")=" "
"RTN","PSOTALK2",160,0)
 .S ^TMP($J,"PSOTALK2",VADM(1),VA("PID"))=$P(PSOAUD,"^")_"^"_$P(PSOAUD,"^",3)_"^"_$G(^PS(55,"ASTALK",PSODFN))
"RTN","PSOTALK2",161,0)
 Q
"RTN","PSOTALK2",162,0)
 ;
"RTN","PSOTALK2",163,0)
MESS W !!,"No report printed!",!!
"RTN","PSOTALK2",164,0)
 Q
"RTN","PSOTALK2",165,0)
 ;
"RTN","PSOTALK2",166,0)
MAIL ; MAKE SURE MAIL STATUS IS COMPATIBLE WITH SCRIPTALK PATIENT
"RTN","PSOTALK2",167,0)
 N MAIL
"RTN","PSOTALK2",168,0)
 S MAIL=$G(^PS(55,PSOPT,0)) I $P(MAIL,"^",3)>1 Q
"RTN","PSOTALK2",169,0)
MAILP W !!,"REMINDER: CMOP does not fill ScripTalk prescriptions.Please select mail"
"RTN","PSOTALK2",170,0)
 W !,"status:  2 (DO NOT MAIL), 3 (LOCAL REGULAR MAIL) or 4 (LOCAL CERTFIED MAIL)."
"RTN","PSOTALK2",171,0)
 R !,"MAIL: ",MAIL:120
"RTN","PSOTALK2",172,0)
 I MAIL?1"^".E Q
"RTN","PSOTALK2",173,0)
 I MAIL<2!(MAIL>4) W !,"INVALID MAIL SETTING - ENTER 2,3, OR 4" G MAILP
"RTN","PSOTALK2",174,0)
 W "  ",$S(MAIL=2:"DO NOT MAIL",MAIL=3:"LOCAL REGULAR MAIL",1:"LOCAL CERTIFIED MAIL")
"RTN","PSOTALK2",175,0)
 S $P(^PS(55,PSOPT,0),"^",3)=MAIL
"RTN","PSOTALK2",176,0)
 Q
"RTN","PSOTRLBL")
0^59^B19249062^B19590362
"RTN","PSOTRLBL",1,0)
PSOTRLBL ;BHAM ISC/AMC/SAB - MULTI RX REFILL REQUEST FORM ;11/16/92 15:37
"RTN","PSOTRLBL",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**19,92,107,110,326**;DEC 1997;Build 11
"RTN","PSOTRLBL",3,0)
 ;External reference ^PS(59.7 supported by DBIA 694
"RTN","PSOTRLBL",4,0)
 ;External reference to ^PS(55 supported by DBIA 2228
"RTN","PSOTRLBL",5,0)
CHK S PSDO=$O(^PS(52.5,"C",ZI,D0)),DFN=$P(^PS(52.5,D0,0),"^",3) I PSDO>0 S PSDFN=$P(^PS(52.5,PSDO,0),"^",3) Q:PSDFN=DFN
"RTN","PSOTRLBL",6,0)
 G BUILD
"RTN","PSOTRLBL",7,0)
CHCK2 Q:'$G(PPL)  S:'$D(PI) PI=0 Q:COPIES  G:$G(PSOLAPPL)!($G(PSDFNFLG)) CHEDI I $P(PPL,",",PI+1)'="" Q
"RTN","PSOTRLBL",8,0)
CHEDI S $P(PSLN,"_",39)="" I $O(PSORX("PSOL",$G(PPL1))) S PPL1=$O(PSORX("PSOL",PPL1)),PPL=PSORX("PSOL",PPL1) F PI=0:1 G:$P(PPL,",",PI)="" INST S RX=$P(PPL,",",PI) D C^PSOLBL
"RTN","PSOTRLBL",9,0)
BUILD Q:'DFN  S PS1=$G(^PS(59,PSOSITE,1)),PSOSITE7=$G(^("IB")),PSOSYS=$G(^PS(59.7,1,40.1)) I '$D(PSSPND) F PSRX=0:0 S PSRX=$O(RX(PSRX)) Q:'PSRX  K RX(PSRX)
"RTN","PSOTRLBL",10,0)
 F PSRX=0:0 S PSRX=$O(^PS(55,DFN,"P",PSRX)) Q:'PSRX  D RZX
"RTN","PSOTRLBL",11,0)
 G:'$O(RX(0))&($P($G(PSOPAR),"^",28)) EXIT
"RTN","PSOTRLBL",12,0)
 S PSINF("STREET")=VAPA(1),PSINF("STREET 2")=VAPA(2),PSINF("CITY")=VAPA(4),PSINF("ZIP")=$S($G(VAPA(11))]"":$P($G(VAPA(11)),"^",2),1:$G(VAPA(6))),PSINF("STATE")=$P(VAPA(5),"^",2)
"RTN","PSOTRLBL",13,0)
 S:VAPA(1)="" PSINF("STREET")="NO ADDRESS",(PSINF("CITY"),PSINF("STATE"),PSINF("ZIP"))="" S PSINF("NAME")=$P(^DPT(DFN,0),"^") D PID^VADPT S PSINF("SSAN")=VA("PID")
"RTN","PSOTRLBL",14,0)
 S PSA=0,VASTREET=$P(^PS(59,PSOSITE,0),"^",2),VAADDR1=$P(^(0),"^")
"RTN","PSOTRLBL",15,0)
 I $P(PSOSYS,"^",4),$D(^PS(59,+$P($G(PSOSYS),"^",4),0)) S PS=^PS(59,$P($G(PSOSYS),"^",4),0),VASTREET=$P(^PS(59,$P(PSOSYS,"^",4),0),"^",2),VAADDR1=$P(^PS(59,$P(PSOSYS,"^",4),0),"^")
"RTN","PSOTRLBL",16,0)
 S COUNT=$S($G(PSOBARS)&($P(PSOPAR,"^",19)):3,1:10)
"RTN","PSOTRLBL",17,0)
 I '$P(^PS(59,PSOSITE,1),"^",28) D DOCOLD Q
"RTN","PSOTRLBL",18,0)
 ;NEW LABEL
"RTN","PSOTRLBL",19,0)
DOCNEW W ?54,PSINF("NAME")
"RTN","PSOTRLBL",20,0)
 I PSINF("STREET 2")="" S PSINF("STREET 2")=PSINF("STREET"),PSINF("STREET")=""
"RTN","PSOTRLBL",21,0)
 W !,?54,$G(VAPA(1)),!,?54,$G(ADDR(2))
"RTN","PSOTRLBL",22,0)
 I $G(ADDR(3))="",$G(ADDR(4))="" G ADD
"RTN","PSOTRLBL",23,0)
 I $G(ADDR(3))'="",$G(ADDR(4))="" W !,?54,$G(ADDR(3)) G ADD
"RTN","PSOTRLBL",24,0)
 W !,?54,$G(ADDR(3)),!,?54,$G(ADDR(4))
"RTN","PSOTRLBL",25,0)
ADD W !,?54,"Please check prescriptions to be refilled"
"RTN","PSOTRLBL",26,0)
 F J=1:1:COUNT S PSA=$O(RX(PSA)) S:'PSA J=J-1 Q:'PSA  D SCRPTNEW
"RTN","PSOTRLBL",27,0)
 W !,?54,"(",PSLN,")",!,?60,"PATIENT'S SIGNATURE   ",$E(DT,4,5),"/",$E(DT,6,7),"/",($E(DT,1,3)+1700)
"RTN","PSOTRLBL",28,0)
DOCEND W @IOF I PSA,$O(RX(PSA)) G DOCNEW
"RTN","PSOTRLBL",29,0)
INST ;
"RTN","PSOTRLBL",30,0)
EXIT K PSINF,AMC,PSA,PSDFN,PSDO,PSDT2,PSRFL,PSRX,PSLN,PSRXX,PSSS,PSST,PSOCR,DIWL,DIWR,DIWF,PSO9 Q
"RTN","PSOTRLBL",31,0)
SCRPTNEW W !,?54,"(___) ",$$ZZ^PSOSUTL(PSA) K ZDRUG
"RTN","PSOTRLBL",32,0)
 W !,?60,$P(RX(PSA),"^",2)," " D DTCONNW W ?64,"Expires ",PSDT2,"  Rx# ",$P(^PSRX(PSA,0),"^") K TN
"RTN","PSOTRLBL",33,0)
 I $G(PSOBARS),$P($G(PSOPAR),"^",19) S X="S",X2=PSOINST_"-"_PSA W !,?60 S X1=$X W @PSOBAR1,X2,@PSOBAR0
"RTN","PSOTRLBL",34,0)
 Q
"RTN","PSOTRLBL",35,0)
DTCONNW S PSDT2=$P(RX(PSA),"^"),PSDT2=$E(PSDT2,4,5)_"/"_$E(PSDT2,6,7)_"/"_($E(PSDT2,1,3)+1700) Q
"RTN","PSOTRLBL",36,0)
 ;OLD LABEL
"RTN","PSOTRLBL",37,0)
DOCOLD W $C(13) S $X=0 W ?38,PSINF("SSAN"),"    FEE: " I $P($G(PSOPAR),"^",17) W $P($G(^DPT(DFN,.17)),"^",2)
"RTN","PSOTRLBL",38,0)
 W ?63,"REFILL REQUEST: PLEASE CHECK PRESCRIPTIONS TO BE REFILLED",!?38,PSINF("NAME"),?79,"YOUR SIGNATURE IS REQUIRED"
"RTN","PSOTRLBL",39,0)
 W !?38,PSINF("STREET"),?60,"REFILLS" W:PSINF("STREET 2")]"" !?38,PSINF("STREET 2") W !?38,PSINF("CITY"),?59,"REMAINING  EXPIRES",!?38,PSINF("STATE")," ",PSINF("ZIP")
"RTN","PSOTRLBL",40,0)
 F J=1:1:COUNT S PSA=$O(RX(PSA)) S:'PSA J=J-1 Q:'PSA  D SCRPTOLD
"RTN","PSOTRLBL",41,0)
 W !!! W ?40,"(",PSLN,")","  PATIENT'S SIGNATURE   ",$E(DT,4,5),"/",$E(DT,6,7),"/",($E(DT,1,3)+1700)
"RTN","PSOTRLBL",42,0)
 W @IOF I PSA,$O(RX(PSA)) G DOCOLD
"RTN","PSOTRLBL",43,0)
 K PSINF,AMC,PSA,PSDFN,PSDO,PSDT2,PSRFL,PSRX,PSRXX,PSSS,PSST,PSLN Q
"RTN","PSOTRLBL",44,0)
SCRPTOLD W !?56,"(____) ",$P(RX(PSA),"^",2)," " D DTCONOD W ?67,PSDT2," ",$P(^PSRX(PSA,0),"^")
"RTN","PSOTRLBL",45,0)
 W ?85,$$ZZ^PSOSUTL(PSA) K ZDRUG
"RTN","PSOTRLBL",46,0)
 I $G(PSOBARS),+$P($G(PSOPAR),"^",19) S X="S",X2=PSOINST_"-"_PSA W !,?80 S X1=$X W @PSOBAR1,X2,@PSOBAR0
"RTN","PSOTRLBL",47,0)
 Q
"RTN","PSOTRLBL",48,0)
DTCONOD S PSDT2=$P(RX(PSA),"^"),PSDT2=$E(PSDT2,4,5)_"/"_$E(PSDT2,6,7)_"/"_($E(PSDT2,1,3)+1700) Q
"RTN","PSOTRLBL",49,0)
REFILL F AMC=0:0 S AMC=$O(^PSRX(PSRXX,1,AMC)) Q:'AMC  S PSRFL=PSRFL-1
"RTN","PSOTRLBL",50,0)
 I PSRFL>0 S X1=DT,X2=$P(^PSRX(PSRXX,0),"^",8)-10 D C^%DTC I X'<$P(^(2),"^",6) S PSRFL=0
"RTN","PSOTRLBL",51,0)
 Q
"RTN","PSOTRLBL",52,0)
RZX S PSRXX=+^PS(55,DFN,"P",PSRX,0) I $D(^PSRX(PSRXX,0)) S PSRFL=$P(^(0),"^",9) D:$D(^(1))&PSRFL REFILL I PSRFL>0,$P($G(^PSRX(PSRXX,"STA")),"^")<10,134'[$E(+$P($G(^("STA")),"^")),$P(^(2),"^",6)>DT S RX(PSRXX)=$P(^(2),"^",6)_"^"_PSRFL
"RTN","PSOTRLBL",53,0)
 Q
"VER")
8.0^22.0
"BLD",6759,6)
^283
**END**
**END**
