$TXT Created by NIXON,TONY at CHEY20.FO-BAYPINES.MED.VA.GOV  (KIDS) on Friday, 04/17/09 at 14:52
=============================================================================
Run Date: SEP 24, 2009                     Designation: PSO*7*322
Package : PSO - OUTPATIENT PHARMACY           Priority: Mandatory
Version : 7       SEQ #282                      Status: Released
                  Compliance Date: OCT 25, 2009
=============================================================================

Associated patches: (v)PSO*7*264   <<= must be installed BEFORE `PSO*7*322'
                    (v)PSO*7*267   <<= must be installed BEFORE `PSO*7*322'

Subject: INTERNET PRESCRIPTION PROCESSED FOR AN INVALID DIVISION

Category: 
  - Routine

Description:
============

 This patch addresses the following 3 issues:
  
 ISSUE 1: INACTIVE DIVISION
          -----------------
          An undefined error occurs while processing an internet refill.
  
  
 ISSUE 2: System variable DUZ 
          -------------------
          Stops user DUZ from being improperly reset.
  
  
 ISSUE 3: RETIRED DBIA 2852
          -----------------
          Ensures that routine PSOATRF is in compliance with the retirement
          of DBIA 2852.  Due to the retirement of DBIA 2852, a direct data
          dictionary global reference for the Prescription file (#52) is no
          longer valid.  Therefore the reference to ^DD(52 has been 
          replaced with the following Pharmacy API: STATUS^PSODI (DBIA
          4858).
  
 Associated Remedy Ticket(s):
 ============================
 1.  HD0000000283240 - Undefined error in routine PSOATRF
 2.  HD0000000316608 - Problem with user DUZ 
 3.  HD0000000318643 - RETIRED DBIA 2852
  
 Associated NSRs:
 ================
 N/A
  
  
 Participating Test Sites:
 ========================= 
 Oklahoma City, OK
 Palo Alto HCS
 White River Junction HCS
  
 Remedy Overview:
 ================
 1. HD0000000283240 - <UNDEFINED>SDIV+1^PSOATRF
  
 Problem:
 --------
 When submitting an internet refill on an inactive division an undefined
 error occurs in the OUTPATIENT PHARMACY application.
  
 Resolution:
 ----------- 
 Routine PSOATRF was modified to continue processing and a message will be 
 generated to notify any holders of the PSOAUTRF security key that an
 internet refill request was submitted to an inactive division.  Please see
 EXAMPLE E-MAIL (INVALID DIVISION):
  
 NEW MESSAGE => Inactive division for Rx # 1234567.  Cannot refill.
  
    ============= EXAMPLE E-MAIL (INVALID DIVISION) ===============
  
    Subj: XXXXX CLINIC Internet Refills Not Processed List
    From: POSTMASTER  In 'IN' basket.   Page 1  *New*
    ---------------------------------------------------------------
    Internet Refills Not Processed Report for the XXXXXXX Division.
  
    The following refill requests were not processed:  
  
    Patient: PATIENT, TEST ONE   SSN: 1234
  
       Rx #: 1234567  (REF #1)  Qty: 30
       Drug: ASPIRIN 325MG BUFFERED TAB
       Reason: Inactive division for Rx # 1234567.  Cannot refill.
  
  
  
 2. HD0000000316608 - Problem with user DUZ
  
 Problem:
 --------
 While submitting an internet refill the current user's DUZ is set to 
 another user's DUZ.  This issue occurs when a check is performed to 
 ensure that the current user has the "PSOAUTRF" security key.  While the 
 check is performed, the DUZ variable gets improperly reset to another 
 user's DUZ that has the security key.
  
 A DUZ is an internal system number that VistA uses to identify a user.
  
 Resolution:
 ----------- 
 Routine PSOATRF was modified so that the current user's DUZ will not be
 reset to another user's DUZ.
  
  
 3. HD0000000318643 - RETIRED DBIA 2852
  
 Problem:
 --------
 Outpatient Pharmacy routine PSOATRF contains a direct data dictionary
 global reference that is no longer valid.  The DBIA assigned to ^DD(52,100,0)
 has been retired. (DBIA2852).
  
 Resolution:
 ----------- 
 Replaced ^DD(52,100,0) with the following API call: STATUS^PSODI.  
 Routine PSOATRF is now in compliance.
  
  
        ================INSTALLATION INSTRUCTIONS =================
  
 Installation will take less than 2 minutes.  Users may be on the system.
  
    1. Use the INSTALL/CHECK MESSAGE option on the PackMan menu.
  
    2. From the Kernel Installation & Distribution System menu, select
       the Installation menu.
  
    3. From this menu, you may select to use the following options
       (when prompted for INSTALL NAME, enter PSO*7.0*322)
  
       a. Backup a Transport Global - this option will create a backup
          message of any routines exported with the patch. It will NOT
          backup any other changes such as DDs or templates.
  
       b. Compare Transport Global to Current System - this option will
          allow you to view all changes that will be made when the patch
          is installed. It compares all components of the patch (routines,
          DDs, templates, etc.).
  
       c. Verify Checksums in Transport Global - this option will ensure
          the integrity of the routines that are in the transport global.
  
    4. Use the Install Package(s) option and select the package PSO*7.0*322
  
    5. When prompted "Want KIDS to INHIBIT LOGONs during the install?
       NO//" respond NO.
  
    6. When prompted "Want to DISABLE Scheduled Options, Menu Options, and
       Protocols? NO//" respond NO.

Routine Information:
====================
The second line of each of these routines now looks like:
 ;;7.0;OUTPATIENT PHARMACY;**[Patch List]**;DEC 1997;Build 4

The checksums below are new checksums, and
 can be checked with CHECK1^XTSUMBLD.

Routine Name: PSOATRF
    Before: B73020434   After: B77200307  **264,322**
 
Routine list of preceding patches: 264

=============================================================================
User Information:
Entered By  : NIXON,ANTOINE                 Date Entered  : DEC 05, 2008
Completed By: SESSLER,APRIL                 Date Completed: AUG 24, 2009
Released By : BAYLIS,RANDALL S              Date Released : SEP 24, 2009
=============================================================================


Packman Mail Message:
=====================

$END TXT
