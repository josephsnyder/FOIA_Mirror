Released DG*5.3*712 SEQ #714
Extracted from mail message
**KIDS**:DG*5.3*712^

**INSTALL NAME**
DG*5.3*712
"BLD",2647,0)
DG*5.3*712^REGISTRATION^0^3090504^y
"BLD",2647,1,0)
^^5^5^3090504^
"BLD",2647,1,1,0)
 
"BLD",2647,1,2,0)
ADD FILE 2 X-REFS: 
"BLD",2647,1,3,0)
EMAIL ADDRESS, CELL PHONE NUMBER, AND BAD ADDRESS INDICATOR
"BLD",2647,1,4,0)
Refer to patch DG*5.3*712 in the FORUM Patch Module for a complete
"BLD",2647,1,5,0)
description.
"BLD",2647,4,0)
^9.64PA^^
"BLD",2647,6.3)
7
"BLD",2647,"ABNS",0)
^9.66A^^
"BLD",2647,"ABPKG")
^^
"BLD",2647,"INID")
^
"BLD",2647,"INIT")
DG712PST
"BLD",2647,"KRN",0)
^9.67PA^8989.52^19
"BLD",2647,"KRN",.4,0)
.4
"BLD",2647,"KRN",.401,0)
.401
"BLD",2647,"KRN",.402,0)
.402
"BLD",2647,"KRN",.403,0)
.403
"BLD",2647,"KRN",.5,0)
.5
"BLD",2647,"KRN",.84,0)
.84
"BLD",2647,"KRN",3.6,0)
3.6
"BLD",2647,"KRN",3.8,0)
3.8
"BLD",2647,"KRN",9.2,0)
9.2
"BLD",2647,"KRN",9.8,0)
9.8
"BLD",2647,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",2647,"KRN",9.8,"NM",1,0)
DG712PST^^0^B56456931
"BLD",2647,"KRN",9.8,"NM",2,0)
VAFCTR^^0^B2482346
"BLD",2647,"KRN",9.8,"NM",3,0)
VAFCTFPR^^0^B23028531
"BLD",2647,"KRN",9.8,"NM",4,0)
VAFCPDAT^^0^B39036052
"BLD",2647,"KRN",9.8,"NM",5,0)
VAFCAUD^^0^B27488177
"BLD",2647,"KRN",9.8,"NM","B","DG712PST",1)

"BLD",2647,"KRN",9.8,"NM","B","VAFCAUD",5)

"BLD",2647,"KRN",9.8,"NM","B","VAFCPDAT",4)

"BLD",2647,"KRN",9.8,"NM","B","VAFCTFPR",3)

"BLD",2647,"KRN",9.8,"NM","B","VAFCTR",2)

"BLD",2647,"KRN",19,0)
19
"BLD",2647,"KRN",19,"NM",0)
^9.68A^2^2
"BLD",2647,"KRN",19,"NM",1,0)
VAFC EXCEPTION HANDLER^^1^
"BLD",2647,"KRN",19,"NM",2,0)
VAFC PDR PURGE^^1^
"BLD",2647,"KRN",19,"NM","B","VAFC EXCEPTION HANDLER",1)

"BLD",2647,"KRN",19,"NM","B","VAFC PDR PURGE",2)

"BLD",2647,"KRN",19.1,0)
19.1
"BLD",2647,"KRN",101,0)
101
"BLD",2647,"KRN",409.61,0)
409.61
"BLD",2647,"KRN",771,0)
771
"BLD",2647,"KRN",870,0)
870
"BLD",2647,"KRN",8989.51,0)
8989.51
"BLD",2647,"KRN",8989.52,0)
8989.52
"BLD",2647,"KRN",8994,0)
8994
"BLD",2647,"KRN","B",.4,.4)

"BLD",2647,"KRN","B",.401,.401)

"BLD",2647,"KRN","B",.402,.402)

"BLD",2647,"KRN","B",.403,.403)

"BLD",2647,"KRN","B",.5,.5)

"BLD",2647,"KRN","B",.84,.84)

"BLD",2647,"KRN","B",3.6,3.6)

"BLD",2647,"KRN","B",3.8,3.8)

"BLD",2647,"KRN","B",9.2,9.2)

"BLD",2647,"KRN","B",9.8,9.8)

"BLD",2647,"KRN","B",19,19)

"BLD",2647,"KRN","B",19.1,19.1)

"BLD",2647,"KRN","B",101,101)

"BLD",2647,"KRN","B",409.61,409.61)

"BLD",2647,"KRN","B",771,771)

"BLD",2647,"KRN","B",870,870)

"BLD",2647,"KRN","B",8989.51,8989.51)

"BLD",2647,"KRN","B",8989.52,8989.52)

"BLD",2647,"KRN","B",8994,8994)

"BLD",2647,"QDEF")
^^^^^^^^^^YES
"BLD",2647,"QUES",0)
^9.62^^
"BLD",2647,"REQB",0)
^9.611^4^4
"BLD",2647,"REQB",1,0)
DG*5.3*653^2
"BLD",2647,"REQB",2,0)
DG*5.3*520^2
"BLD",2647,"REQB",3,0)
DG*5.3*707^2
"BLD",2647,"REQB",4,0)
DG*5.3*477^2
"BLD",2647,"REQB","B","DG*5.3*477",4)

"BLD",2647,"REQB","B","DG*5.3*520",2)

"BLD",2647,"REQB","B","DG*5.3*653",1)

"BLD",2647,"REQB","B","DG*5.3*707",3)

"INIT")
DG712PST
"KRN",19,7214,-1)
1^1
"KRN",19,7214,0)
VAFC EXCEPTION HANDLER
"KRN",19,7215,-1)
1^2
"KRN",19,7215,0)
VAFC PDR PURGE
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813^2970721^12541
"PKG",5,22,1,"PAH",1,0)
712^3090504^12555
"PKG",5,22,1,"PAH",1,1,0)
^^5^5^3090504
"PKG",5,22,1,"PAH",1,1,1,0)
 
"PKG",5,22,1,"PAH",1,1,2,0)
ADD FILE 2 X-REFS: 
"PKG",5,22,1,"PAH",1,1,3,0)
EMAIL ADDRESS, CELL PHONE NUMBER, AND BAD ADDRESS INDICATOR
"PKG",5,22,1,"PAH",1,1,4,0)
Refer to patch DG*5.3*712 in the FORUM Patch Module for a complete
"PKG",5,22,1,"PAH",1,1,5,0)
description.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","DG712PST")
0^1^B56456931^n/a
"RTN","DG712PST",1,0)
DG712PST ;BIR/CMC/TKW,PTD-PATCH DG*5.3*712 POST INSTALLATION ROUTINE ;1/29/09  17:41
"RTN","DG712PST",2,0)
 ;;5.3;Registration;**712**;Aug 13, 1993;Build 7
"RTN","DG712PST",3,0)
 ;
"RTN","DG712PST",4,0)
 ; IA #2796 for use of calls to RGHLLOG in UPDBAI
"RTN","DG712PST",5,0)
POST ;Post init
"RTN","DG712PST",6,0)
 N DGFLD,DGMFLD,DGOUT,DGFILE
"RTN","DG712PST",7,0)
 ;File cross references
"RTN","DG712PST",8,0)
 D XR(2,.121) ; BAD ADDRESS INDICATOR (#.121)
"RTN","DG712PST",9,0)
 D XR(2,.133) ; EMAIL ADDRESS (#.133)
"RTN","DG712PST",10,0)
 D XR(2,.134) ; PHONE NUMBER [CELLULAR] (#.134)
"RTN","DG712PST",11,0)
 D TEMPL
"RTN","DG712PST",12,0)
 ;TURNING ON AUDITING FOR ALIAS FIELD(S)
"RTN","DG712PST",13,0)
 D ALIAS
"RTN","DG712PST",14,0)
 ; Queue job to send A31 for patients with BAD ADDRESS INDICATOR
"RTN","DG712PST",15,0)
 D UPDBAI
"RTN","DG712PST",16,0)
 Q
"RTN","DG712PST",17,0)
 ;
"RTN","DG712PST",18,0)
XR(DGFILE,DGFLD) ;File index type cross references
"RTN","DG712PST",19,0)
 ;
"RTN","DG712PST",20,0)
 N DGFDA,DGIEN,DGWP,DGERR,DGXR,DGVAL,DGOUT,DIERR
"RTN","DG712PST",21,0)
 ;Set up the cross-reference
"RTN","DG712PST",22,0)
 I '$D(DGXR) S DGXR=$S(DGFLD[".":"AVAFC"_$P(DGFLD,".",2),1:"AVAFC"_DGFLD)
"RTN","DG712PST",23,0)
 ;Check for existing cross-reference
"RTN","DG712PST",24,0)
 S DGVAL(1)=DGFILE,DGVAL(2)=DGXR
"RTN","DG712PST",25,0)
 D FIND^DIC(.11,"","@;IXIE","KP",.DGVAL,"","","","","DGOUT")
"RTN","DG712PST",26,0)
 I $D(DGOUT("DILIST",1)) D  Q
"RTN","DG712PST",27,0)
 .D MES^XPDUTL("   >> Cross reference "_DGXR_" already exists, nothing filed.")
"RTN","DG712PST",28,0)
 .Q
"RTN","DG712PST",29,0)
 ;Create filer array
"RTN","DG712PST",30,0)
 S DGFDA(.11,"+1,",.01)=DGFILE                      ;FILE
"RTN","DG712PST",31,0)
 S DGFDA(.11,"+1,",.02)=DGXR                        ;NAME
"RTN","DG712PST",32,0)
 S DGFDA(.11,"+1,",.11)="This x-ref calls the DG FIELD MONITOR event point."  ;SHORT DESCRIPTION
"RTN","DG712PST",33,0)
 S DGFDA(.11,"+1,",.2)="MU"                         ;TYPE
"RTN","DG712PST",34,0)
 S DGFDA(.11,"+1,",.4)="F"                          ;EXECUTION
"RTN","DG712PST",35,0)
 S DGFDA(.11,"+1,",.41)="I"                         ;ACTIVITY
"RTN","DG712PST",36,0)
 S DGFDA(.11,"+1,",.5)="I"                          ;ROOT TYPE
"RTN","DG712PST",37,0)
 S DGFDA(.11,"+1,",.51)=DGFILE                      ;ROOT FILE
"RTN","DG712PST",38,0)
 S DGFDA(.11,"+1,",.42)="A"                         ;USE
"RTN","DG712PST",39,0)
 S DGFDA(.11,"+1,",1.1)="D FC^DGFCPROT(.DA,"_DGFILE_","_DGFLD_",""SET"",$H,$G(DUZ),.X,.X1,.X2,$G(XQY0)) Q"  ;SET LOGIC
"RTN","DG712PST",40,0)
 S DGFDA(.11,"+1,",2.1)="D FC^DGFCPROT(.DA,"_DGFILE_","_DGFLD_",""KILL"",$H,$G(DUZ),.X,.X1,.X2,$G(XQY0)) Q"  ;KILL LOGIC
"RTN","DG712PST",41,0)
 ;CROSS REFERENCE VALUES
"RTN","DG712PST",42,0)
 S DGFDA(.114,"+2,+1,",.01)=1                       ;ORDER NUMBER
"RTN","DG712PST",43,0)
 S DGFDA(.114,"+2,+1,",1)="F"                       ;TYPE OF VALUE
"RTN","DG712PST",44,0)
 S DGFDA(.114,"+2,+1,",2)=DGFILE                    ;FILE NUMBER
"RTN","DG712PST",45,0)
 S DGFDA(.114,"+2,+1,",3)=DGFLD                     ;FIELD NUMBER
"RTN","DG712PST",46,0)
 S DGFDA(.114,"+2,+1,",7)="F"                       ;COLLATION
"RTN","DG712PST",47,0)
 ;DESCRIPTION
"RTN","DG712PST",48,0)
 S DGWP(1)="This cross-reference activates the DG FIELD MONITOR event point."
"RTN","DG712PST",49,0)
 S DGWP(2)="Applications that wish to monitor edit activity related to this field may"
"RTN","DG712PST",50,0)
 S DGWP(3)="subscribe to that event point and take action as indicated by the changes"
"RTN","DG712PST",51,0)
 S DGWP(4)="that occur.  Refer to the DG FIELD MONITOR protocol for a description of"
"RTN","DG712PST",52,0)
 S DGWP(5)="the information available at the time of the event."
"RTN","DG712PST",53,0)
 ;File INDEX record
"RTN","DG712PST",54,0)
 D UPDATE^DIE("","DGFDA","DGIEN","DGERR")
"RTN","DG712PST",55,0)
 I $D(DIERR) D  Q
"RTN","DG712PST",56,0)
 .N DGI S DGI=""
"RTN","DG712PST",57,0)
 .D BMES^XPDUTL("   >> A problem has occurred during the filing of x-ref "_DGXR_"!")
"RTN","DG712PST",58,0)
 .D MES^XPDUTL("      Please contact Customer Support.")
"RTN","DG712PST",59,0)
 .F  S DGI=$O(DGERR("DIERR",1,"TEXT",DGI)) Q:DGI=""  D
"RTN","DG712PST",60,0)
 ..D MES^XPDUTL(DGERR("DIERR",1,"TEXT",DGI))
"RTN","DG712PST",61,0)
 ..Q
"RTN","DG712PST",62,0)
 .Q
"RTN","DG712PST",63,0)
 S DGFLD(DGFILE,DGFLD)=""  ;Create list to recompile templates
"RTN","DG712PST",64,0)
 D MES^XPDUTL("   >> "_DGXR_" cross-reference filed.")
"RTN","DG712PST",65,0)
 ;File DESCRIPTION field
"RTN","DG712PST",66,0)
 D WP^DIE(.11,DGIEN(1)_",",.1,"","DGWP")
"RTN","DG712PST",67,0)
 Q
"RTN","DG712PST",68,0)
 ;
"RTN","DG712PST",69,0)
TEMPL ;Determine templates on the PATIENT (#2) file to be compiled.
"RTN","DG712PST",70,0)
 N GLOBAL,FIELD,NFIELD,FILE,CNT
"RTN","DG712PST",71,0)
 D BMES^XPDUTL("Beginning to compile templates on the PATIENT (#2) file.")
"RTN","DG712PST",72,0)
 ;
"RTN","DG712PST",73,0)
 S NFIELD=".121,.133,.134",FILE=2,FIELD="",CNT=1
"RTN","DG712PST",74,0)
 F  S FIELD=$P(NFIELD,",",CNT) Q:FIELD=""  D LOOP(FIELD,FILE) S CNT=CNT+1
"RTN","DG712PST",75,0)
 W !!
"RTN","DG712PST",76,0)
 S (X,Y)=""
"RTN","DG712PST",77,0)
 D BMES^XPDUTL("The following routine namespace was compiled:")
"RTN","DG712PST",78,0)
 F  S X=$O(CFIELD(X)) Q:X=""  S Y=$G(Y)+1 S PRINT(Y)=" "_X_"*"
"RTN","DG712PST",79,0)
 ;
"RTN","DG712PST",80,0)
 D MES^XPDUTL(.PRINT)
"RTN","DG712PST",81,0)
 K X,Y,PRINT,CFIELD
"RTN","DG712PST",82,0)
 Q
"RTN","DG712PST",83,0)
LOOP(FIELD,FILE) ;Compile templates.
"RTN","DG712PST",84,0)
 N GLOBAL,TEMPLATP,TEMPLATN,X,Y,DMAX
"RTN","DG712PST",85,0)
 F GLOBAL="^DIE","^DIPT" DO
"RTN","DG712PST",86,0)
 .I $D(@GLOBAL@("AF",FILE,FIELD)) D
"RTN","DG712PST",87,0)
 ..S TEMPLATP=0
"RTN","DG712PST",88,0)
 ..F  S TEMPLATP=$O(@GLOBAL@("AF",FILE,FIELD,TEMPLATP)) Q:'TEMPLATP  DO
"RTN","DG712PST",89,0)
 ...S TEMPLATN=$P($G(@GLOBAL@(TEMPLATP,0)),"^",1)
"RTN","DG712PST",90,0)
 ...I TEMPLATN="" D BMES^XPDUTL("Could not compile template "_TEMPLATN_$C(13,10)_"Please review!") Q
"RTN","DG712PST",91,0)
 ...S X=$P($G(@GLOBAL@(TEMPLATP,"ROUOLD")),"^")
"RTN","DG712PST",92,0)
 ...I X=""&($D(@GLOBAL@(TEMPLATP,"ROU"))'=0) D BMES^XPDUTL("Could not find routine for template "_TEMPLATN_$C(13,10)_"Please review!") Q
"RTN","DG712PST",93,0)
 ...I X=""&($D(@GLOBAL@(TEMPLATP,"ROU"))=0) Q
"RTN","DG712PST",94,0)
 ...I $D(CFIELD(X)) Q  ;already compiled
"RTN","DG712PST",95,0)
 ...S CFIELD(X)="" ;  remember the template was compiled
"RTN","DG712PST",96,0)
 ...S Y=TEMPLATP ;  set up the call for FileMan
"RTN","DG712PST",97,0)
 ...S DMAX=$$ROUSIZE^DILF
"RTN","DG712PST",98,0)
 ...I GLOBAL="^DIE" D BMES^XPDUTL(" "),BMES^XPDUTL("   Compiling Input Templates") D EN^DIEZ Q
"RTN","DG712PST",99,0)
 ...I GLOBAL="^DIPT" D BMES^XPDUTL(" "),BMES^XPDUTL("   Compiling Print Templates") D EN^DIPZ Q
"RTN","DG712PST",100,0)
 Q
"RTN","DG712PST",101,0)
 ;
"RTN","DG712PST",102,0)
ALIAS ;TURNING ON ALIAS AUDITING
"RTN","DG712PST",103,0)
 N FLDNUM
"RTN","DG712PST",104,0)
 S FLDNUM=.01 D TURNON^DIAUTL(2.01,FLDNUM) W !,"Adding AUDIT to sub-file 2.01 Alias, field #",FLDNUM
"RTN","DG712PST",105,0)
 S FLDNUM=1 D TURNON^DIAUTL(2.01,FLDNUM) W !,"Adding AUDIT to sub-file 2.01 Alias, field #",FLDNUM
"RTN","DG712PST",106,0)
 Q
"RTN","DG712PST",107,0)
 ;
"RTN","DG712PST",108,0)
UPDBAI ; Send A31 to update the BAD ADDRESS INDICATOR for all patients
"RTN","DG712PST",109,0)
 D BMES^XPDUTL(" "),BMES^XPDUTL("   Queuing job to update MPI for Patients with BAD ADDRESS INDICATOR.")
"RTN","DG712PST",110,0)
 N ZTIO,ZTSK,ZTRTN,ZTDESC,ZTSAVE,ZTDTH,Y
"RTN","DG712PST",111,0)
 S ZTIO="",ZTRTN="DQUPDBAI^DG712PST",ZTDTH=$H
"RTN","DG712PST",112,0)
 S ZTDESC="Send A31 update for patients with BAD ADDRESS INDICATOR-post init for DG*5.3*712."
"RTN","DG712PST",113,0)
 D ^%ZTLOAD
"RTN","DG712PST",114,0)
 I '$G(ZTSK) D MES^XPDUTL("   **** Queuing job failed!!!") Q
"RTN","DG712PST",115,0)
 D MES^XPDUTL("   Job number "_ZTSK_" was queued.")
"RTN","DG712PST",116,0)
 Q
"RTN","DG712PST",117,0)
DQUPDBAI ; Entry point to queue job to update BAD ADDRESS INDICATOR for all patients
"RTN","DG712PST",118,0)
 N DGSITE,DGSNAME,DGDFN,DGBAI,DGICN,DGCNT,DGECNT,DGERR,R,X
"RTN","DG712PST",119,0)
 ; Get current station number and name
"RTN","DG712PST",120,0)
 S X=$$SITE^VASITE()
"RTN","DG712PST",121,0)
 S DGSNAME=$P(X,"^",2),DGSITE=$P(X,"^",3)
"RTN","DG712PST",122,0)
 S (DGCNT,DGECNT)=0
"RTN","DG712PST",123,0)
 ; Loop through patient file, if patient has a BAD ADDRESS INDICATOR, send A31
"RTN","DG712PST",124,0)
 F DGDFN=0:0 S DGDFN=$O(^DPT(DGDFN)) Q:'DGDFN  D
"RTN","DG712PST",125,0)
 . ; Check for PATIENT having BAD ADDRESS INDICATOR
"RTN","DG712PST",126,0)
 . S DGBAI=$P($G(^DPT(DGDFN,.11)),U,16)
"RTN","DG712PST",127,0)
 . Q:'DGBAI
"RTN","DG712PST",128,0)
 . S DGICN=+$$GETICN^MPIF001(DGDFN)
"RTN","DG712PST",129,0)
 . ; Only update if station has a valid national ICN
"RTN","DG712PST",130,0)
 . Q:DGICN=-1
"RTN","DG712PST",131,0)
 . Q:$E(DGICN,1,($L(DGSITE)))=DGSITE
"RTN","DG712PST",132,0)
 . ; Send A31
"RTN","DG712PST",133,0)
 . S DGERR=$$A31^MPIFA31B(DGDFN)
"RTN","DG712PST",134,0)
 . I +DGERR<0 D  Q
"RTN","DG712PST",135,0)
 .. D START^RGHLLOG()
"RTN","DG712PST",136,0)
 .. D EXC^RGHLLOG(208,"Error building A31 for BAD ADDRESS INDICATOR during post-init of DG*5.3*712, (DFN="_DGDFN_"), ERROR="_$P(DGERR,"^",2),DGDFN)
"RTN","DG712PST",137,0)
 .. D STOP^RGHLLOG()
"RTN","DG712PST",138,0)
 .. S DGECNT=DGECNT+1 Q
"RTN","DG712PST",139,0)
 . S DGCNT=DGCNT+1
"RTN","DG712PST",140,0)
 . Q
"RTN","DG712PST",141,0)
 ; Send email to person who ran the INIT, letting them know results
"RTN","DG712PST",142,0)
 N XMDUZ,XMTEXT,XMSUB,XMY,XMZ,XMDUN,X,R
"RTN","DG712PST",143,0)
 S R(1)="A31 messages to update the BAD ADDRESS INDICATOR for "_DGCNT_" Patients were sent."
"RTN","DG712PST",144,0)
 I DGECNT'>0 S R(2)=" ",R(3)="You can now delete the post-init routine ^DG712PST."
"RTN","DG712PST",145,0)
 I DGECNT>0 D
"RTN","DG712PST",146,0)
 . S R(2)=" "
"RTN","DG712PST",147,0)
 . S R(3)="*** Note: "_DGECNT_" errors occurred trying to update the BAD ADDRESS INDICATOR."
"RTN","DG712PST",148,0)
 . S R(4)="*** IMDQ can check the EXCEPTIONS LOG to see details for these errors."
"RTN","DG712PST",149,0)
 . S R(5)="*** See further instructions in the patch description for DG*5.3*712."
"RTN","DG712PST",150,0)
 . Q
"RTN","DG712PST",151,0)
 S XMTEXT="R(",XMSUB="Results from running patch DG*5.3*712"
"RTN","DG712PST",152,0)
 S XMDUZ=.5
"RTN","DG712PST",153,0)
 S XMY(DUZ)=""
"RTN","DG712PST",154,0)
 D ^XMD
"RTN","DG712PST",155,0)
 ; Send message to MPI developers on Outlook
"RTN","DG712PST",156,0)
 K XMDUZ,XMTEXT,XMSUB,XMY,XMZ,XMDUN,R
"RTN","DG712PST",157,0)
 S R(1)="Post-Init routine UPDBAI^DG712PST run at station: "_DGSITE_" - "_DGSNAME
"RTN","DG712PST",158,0)
 S R(2)=" "
"RTN","DG712PST",159,0)
 S R(3)="A31 messages to update the BAD ADDRESS INDICATOR for "_DGCNT_" Patients were sent."
"RTN","DG712PST",160,0)
 I DGECNT>0 D
"RTN","DG712PST",161,0)
 . S R(4)=" "
"RTN","DG712PST",162,0)
 . S R(5)="*** Note: "_DGECNT_" errors occurred trying to update the BAD ADDRESS INDICATOR."
"RTN","DG712PST",163,0)
 . S R(6)="*** IMDQ can check the EXCEPTIONS LOG to see details for these errors."
"RTN","DG712PST",164,0)
 . S R(7)="*** See further instructions in the patch description for DG*5.3*712."
"RTN","DG712PST",165,0)
 . Q
"RTN","DG712PST",166,0)
 S XMTEXT="R(",XMSUB="Results from running patch DG*5.3*712 at station: "_DGSITE
"RTN","DG712PST",167,0)
 S XMDUZ=DUZ
"RTN","DG712PST",168,0)
 S XMY("TAMI.WINN@VA.GOV")=""
"RTN","DG712PST",169,0)
 S XMY("CHRISTINE.LINK@VA.GOV")=""
"RTN","DG712PST",170,0)
 D ^XMD
"RTN","DG712PST",171,0)
 Q
"RTN","DG712PST",172,0)
 ;
"RTN","DG712PST",173,0)
 ;
"RTN","VAFCAUD")
0^5^B27488177^B24016806
"RTN","VAFCAUD",1,0)
VAFCAUD ;BIR/CML-MPI/PD AUDIT FILE PRINT FOR A SPECIFIED PATIENT ;2/25/09
"RTN","VAFCAUD",2,0)
 ;;5.3;Registration;**477,712**;Aug 13, 1993;Build 7
"RTN","VAFCAUD",3,0)
 ;Reference to ^DIA(2 and data derived from the AUDIT file (#1.1)
"RTN","VAFCAUD",4,0)
 ;is supported by IA #2097 and #2602.
"RTN","VAFCAUD",5,0)
 ;Reference to ^ORD(101 supported by IA #2596
"RTN","VAFCAUD",6,0)
 S QFLG=1
"RTN","VAFCAUD",7,0)
 S RPCFLG=0 ;is this from an rpc call
"RTN","VAFCAUD",8,0)
BEGIN ;
"RTN","VAFCAUD",9,0)
 W !!,"This option prints information from the AUDIT file (#1.1) for a"
"RTN","VAFCAUD",10,0)
 W !,"selected patient and date range."
"RTN","VAFCAUD",11,0)
 W !!,"For the PATIENT file (#2) entry selected, the report prints the"
"RTN","VAFCAUD",12,0)
 W !,"patient name and DFN, date/time the field was edited, the user who"
"RTN","VAFCAUD",13,0)
 W !,"made the change, the field edited, the old value, and the new value."
"RTN","VAFCAUD",14,0)
 W !,"The option or protocol (if available) will also be displayed."
"RTN","VAFCAUD",15,0)
 D ASK1
"RTN","VAFCAUD",16,0)
 I $G(VAFCDFN) D ASK2
"RTN","VAFCAUD",17,0)
 I $G(VAFCBDT),$G(VAFCEDT) D DEV
"RTN","VAFCAUD",18,0)
 G QUIT
"RTN","VAFCAUD",19,0)
 ;
"RTN","VAFCAUD",20,0)
ASK1 ;Ask for PATIENT
"RTN","VAFCAUD",21,0)
 W !
"RTN","VAFCAUD",22,0)
 S DIC="^DPT(",DIC(0)="QEAM",DIC("A")="Select PATIENT: " D ^DIC K DIC Q:Y<0  S VAFCDFN=+Y
"RTN","VAFCAUD",23,0)
 I '$O(^DIA(2,"B",VAFCDFN,0)),'$O(^DIA(2,"B",VAFCDFN_",1",0)) W !!,"This patient has no audit data available for any date." G ASK1   ;**712
"RTN","VAFCAUD",24,0)
 Q
"RTN","VAFCAUD",25,0)
 ;
"RTN","VAFCAUD",26,0)
ASK2 ;Ask for Date Range
"RTN","VAFCAUD",27,0)
 ;I '$D(VAFCDFN)&($D(DFN)) S VAFCDFN=DFN
"RTN","VAFCAUD",28,0)
 W !!,"Enter date range for data to be included in report."
"RTN","VAFCAUD",29,0)
 K DIR,DIRUT,DTOUT,DUOUT
"RTN","VAFCAUD",30,0)
 S DIR(0)="DAO^:DT:EPX",DIR("A")="Beginning Date:  " D ^DIR K DIR Q:$D(DIRUT)  S VAFCBDT=Y
"RTN","VAFCAUD",31,0)
 S DIR(0)="DAO^"_VAFCBDT_":DT:EPX",DIR("A")="Ending Date:  " D ^DIR K DIR Q:$D(DIRUT)  S VAFCEDT=Y
"RTN","VAFCAUD",32,0)
 Q
"RTN","VAFCAUD",33,0)
 ;
"RTN","VAFCAUD",34,0)
DEV W !!,"The right margin for this report is 80.",!!
"RTN","VAFCAUD",35,0)
 S ZTSAVE("VAFCBDT")="",ZTSAVE("VAFCEDT")="",ZTSAVE("VAFCDFN")=""
"RTN","VAFCAUD",36,0)
 D EN^XUTMDEVQ("START^VAFCAUD(VAFCDFN,VAFCBDT,VAFCEDT,RPCFLG)","MPI/PD - Print AUDIT File Data for a Specific Patient",.ZTSAVE) I 'POP Q
"RTN","VAFCAUD",37,0)
 W !,"NO DEVICE SELECTED OR REPORT PRINTED!!"
"RTN","VAFCAUD",38,0)
 G QUIT
"RTN","VAFCAUD",39,0)
 ;
"RTN","VAFCAUD",40,0)
START(VAFCDFN,VAFCBDT,VAFCEDT,RPCFLG) ;
"RTN","VAFCAUD",41,0)
 N IEN
"RTN","VAFCAUD",42,0)
 K ^TMP("VAFCAUD",$J)
"RTN","VAFCAUD",43,0)
 ;
"RTN","VAFCAUD",44,0)
LOOP ;Loop on "B" xref of the AUDIT file
"RTN","VAFCAUD",45,0)
 S STOP=VAFCEDT+1
"RTN","VAFCAUD",46,0)
 S IEN=0 F  S IEN=$O(^DIA(2,"B",VAFCDFN,IEN)) Q:'IEN  D
"RTN","VAFCAUD",47,0)
 .I $D(^DIA(2,IEN,0)) S EDITDT=$P(^(0),U,2) I EDITDT>VAFCBDT,EDITDT<STOP D
"RTN","VAFCAUD",48,0)
 ..S ^TMP("VAFCAUD",$J,EDITDT,IEN)=""
"RTN","VAFCAUD",49,0)
 ;
"RTN","VAFCAUD",50,0)
 ;find any audit data for audited fields that are multiples  - **712
"RTN","VAFCAUD",51,0)
 F QQ=1:1 S SUB=VAFCDFN_","_QQ Q:'$D(^DIA(2,"B",SUB))  S IEN=0 F  S IEN=$O(^DIA(2,"B",SUB,IEN)) Q:'IEN  D
"RTN","VAFCAUD",52,0)
 .I $D(^DIA(2,IEN,0)) S EDITDT=$P(^(0),U,2) I EDITDT>VAFCBDT,EDITDT<STOP S ^TMP("VAFCAUD",$J,EDITDT,IEN)=""
"RTN","VAFCAUD",53,0)
 ;
"RTN","VAFCAUD",54,0)
PRT ;Print report
"RTN","VAFCAUD",55,0)
 S (PG,QFLG)=0,U="^",$P(LN,"-",81)="",SITE=$P($$SITE^VASITE(),U,2)
"RTN","VAFCAUD",56,0)
 S PVAFCBDT=$$FMTE^XLFDT(VAFCBDT),PVAFCEDT=$$FMTE^XLFDT(VAFCEDT)
"RTN","VAFCAUD",57,0)
 D NOW^%DTC S HDT=$$FMTE^XLFDT($E(%,1,12))
"RTN","VAFCAUD",58,0)
 D HDR
"RTN","VAFCAUD",59,0)
 I '$O(^TMP("VAFCAUD",$J,0)) W !!,"No audit data found in this date range for this patient." Q
"RTN","VAFCAUD",60,0)
 S EDITDT=0 F  S EDITDT=$O(^TMP("VAFCAUD",$J,EDITDT)) Q:QFLG  Q:'EDITDT  D
"RTN","VAFCAUD",61,0)
 .S IEN=0 F  S IEN=$O(^TMP("VAFCAUD",$J,EDITDT,IEN)) Q:QFLG  Q:'IEN  D
"RTN","VAFCAUD",62,0)
 ..S PRTDT=$$FMTE^XLFDT($E(EDITDT,1,12))
"RTN","VAFCAUD",63,0)
 ..S IEN0=^DIA(2,IEN,0)
"RTN","VAFCAUD",64,0)
 ..S FILE=2,FIELD=$P(IEN0,"^",3) I FIELD["," S FILE=+$P(^DD(2,$P(FIELD,","),0),"^",2),FIELD=$P(FIELD,",",2)   ;**712
"RTN","VAFCAUD",65,0)
 ..K VAFCARR1 D FIELD^DID(FILE,FIELD,"","LABEL","VAFCARR1")   ;**712
"RTN","VAFCAUD",66,0)
 ..S FLD=$G(VAFCARR1("LABEL")) Q:FLD=""
"RTN","VAFCAUD",67,0)
 ..S USER=$P(IEN0,U,4)
"RTN","VAFCAUD",68,0)
 ..I 'USER S USER="UNKNOWN"
"RTN","VAFCAUD",69,0)
 ..I USER'="UNKNOWN" S DIC="^VA(200,",DIC(0)="MZO",X="`"_USER D ^DIC S USER=$P(Y,"^",2)
"RTN","VAFCAUD",70,0)
 ..S OLD=$G(^DIA(2,IEN,2)) I OLD']"" S OLD="<no previous value>"
"RTN","VAFCAUD",71,0)
 ..S NEW=$G(^DIA(2,IEN,3)) I NEW']"" S NEW="<no current value>"
"RTN","VAFCAUD",72,0)
 ..K OPTDA1,OPTDA2,VAFCOPTN,OPTNM I $G(^DIA(2,IEN,4.1)) D
"RTN","VAFCAUD",73,0)
 ...S OPTDA1=+$P(^DIA(2,IEN,4.1),"^")
"RTN","VAFCAUD",74,0)
 ...I OPTDA1 S DIC=19,DR=".01",DA=OPTDA1,DIQ(0)="EI",DIQ="VAFCOPTN" D EN^DIQ1 K DIC,DR,DA,DIQ S VAFCOPTN=$G(VAFCOPTN(19,OPTDA1,.01,"E"))
"RTN","VAFCAUD",75,0)
 ...S OPTDA2=$P(^DIA(2,IEN,4.1),"^",2)
"RTN","VAFCAUD",76,0)
 ...I $P(OPTDA2,";",2)="ORD(101," S DIC=101,DR=".01",DA=+OPTDA2,DIQ(0)="EI",DIQ="VAFCOPTN" D EN^DIQ1 K DIC,DR,DA,DIQ S OPTNM=$G(VAFCOPTN(101,+OPTDA2,.01,"E")) Q
"RTN","VAFCAUD",77,0)
 ...I +OPTDA2 S DIC=19,DR=".01",DA=+OPTDA2,DIQ(0)="EI",DIQ="VAFCOPTN" D EN^DIQ1 K DIC,DR,DA,DIQ S OPTNM=$G(VAFCOPTN(19,+OPTDA2,.01,"E")) Q
"RTN","VAFCAUD",78,0)
 ..I 'RPCFLG D:$Y+4>IOSL HDR Q:QFLG
"RTN","VAFCAUD",79,0)
 ..W !,PRTDT,?20,FLD,?51,USER,!?20,OLD," / ",NEW
"RTN","VAFCAUD",80,0)
 ..I $G(VAFCOPTN)'="" W !?3,VAFCOPTN
"RTN","VAFCAUD",81,0)
 ..I $G(OPTNM)'="" W:$G(VAFCOPTN)="" !?3 W "/",$G(OPTNM)
"RTN","VAFCAUD",82,0)
 ..W !
"RTN","VAFCAUD",83,0)
 Q
"RTN","VAFCAUD",84,0)
 ;
"RTN","VAFCAUD",85,0)
QUIT ;
"RTN","VAFCAUD",86,0)
 I '$G(RPCFLG),$E(IOST,1,2)="C-"&('$G(QFLG)) S DIR(0)="E" D  D ^DIR K DIR
"RTN","VAFCAUD",87,0)
 .S SS=22-$Y F JJ=1:1:SS W !
"RTN","VAFCAUD",88,0)
 I '$G(RPCFLG) D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","VAFCAUD",89,0)
 K ^TMP("VAFCAUD",$J)
"RTN","VAFCAUD",90,0)
 K %,%I,C,VAFCDFN,EDITDT,FLD,HDT,IEN,IEN0,JJ,LN,NEW,OLD,OPTDA1,OPTDA2,VAFCOPTN,OPTNM,PG,PVAFCBDT,PVAFCEDT,PRTDT,POP
"RTN","VAFCAUD",91,0)
 K QFLG,VAFCARR1,VAFCBDT,VAFCEDT,RPCFLG,SITE,SS,STOP,USER,X,Y,ZTSK
"RTN","VAFCAUD",92,0)
 K SUB,FILE,FIELD,QQ   ;**712
"RTN","VAFCAUD",93,0)
 Q
"RTN","VAFCAUD",94,0)
 ;
"RTN","VAFCAUD",95,0)
HDR ;HEADER
"RTN","VAFCAUD",96,0)
 I 'RPCFLG I $E(IOST,1,2)="C-" S SS=22-$Y F JJ=1:1:SS W !
"RTN","VAFCAUD",97,0)
 I 'RPCFLG I $E(IOST,1,2)="C-",PG>0 S DIR(0)="E" W ! D ^DIR K DIR I 'Y S QFLG=1 Q
"RTN","VAFCAUD",98,0)
 S PG=PG+1
"RTN","VAFCAUD",99,0)
 I 'RPCFLG W:$Y!($E(IOST,1,2)="C-") @IOF
"RTN","VAFCAUD",100,0)
 W !,"PATIENT AUDIT LIST at ",SITE," on ",HDT,?70,"Page: ",PG
"RTN","VAFCAUD",101,0)
 W !,"Patient: ",$P(^DPT(VAFCDFN,0),U)," (DFN #",VAFCDFN,")"
"RTN","VAFCAUD",102,0)
 W !,"Date Range: ",PVAFCBDT," to ",PVAFCEDT
"RTN","VAFCAUD",103,0)
 W !!,"Date/Time Edited",?20,"Field Edited",?51,"Edited By"
"RTN","VAFCAUD",104,0)
 W !?20,"Old Value / New Value",!?3,"Option/Protocol",!,LN
"RTN","VAFCAUD",105,0)
 Q
"RTN","VAFCPDAT")
0^4^B39036052^B37914186
"RTN","VAFCPDAT",1,0)
VAFCPDAT ;BIR/CML/ALS-DISPLAY MPI/PD INFORMATION FOR SELECTED PATIENT ;10/24/02  13:13
"RTN","VAFCPDAT",2,0)
 ;;5.3;Registration;**333,414,474,505,707,712**;Aug 13, 1993;Build 7
"RTN","VAFCPDAT",3,0)
 ;Registration has IA #3299 for MPI/PD to call START^VAFCPDAT
"RTN","VAFCPDAT",4,0)
 ;
"RTN","VAFCPDAT",5,0)
 ;variable DFN is not NEWed or KILLed in this routine as that variable is passed in
"RTN","VAFCPDAT",6,0)
 ;
"RTN","VAFCPDAT",7,0)
MAIN ; Entry point with device call
"RTN","VAFCPDAT",8,0)
 S NOTRPC=1
"RTN","VAFCPDAT",9,0)
 K ZTSAVE S ZTSAVE("DFN")=""
"RTN","VAFCPDAT",10,0)
 D EN^XUTMDEVQ("START^VAFCPDAT","Print MPI/PD Patient Data",.ZTSAVE)
"RTN","VAFCPDAT",11,0)
 K NOTRPC
"RTN","VAFCPDAT",12,0)
 Q
"RTN","VAFCPDAT",13,0)
 ;
"RTN","VAFCPDAT",14,0)
START ;Entry point without device call, used for RPC calls
"RTN","VAFCPDAT",15,0)
 S $P(LN,"=",80)="",$P(LN2,"=",60)="",QFLG=0
"RTN","VAFCPDAT",16,0)
 D NOW^%DTC S HDT=$$FMTE^XLFDT($E(%,1,12))
"RTN","VAFCPDAT",17,0)
 S SITE=$$SITE^VASITE(),SITENAM=$P(SITE,"^",2),SITENUM=$P(SITE,"^",3),SITEIEN=$P(SITE,"^")
"RTN","VAFCPDAT",18,0)
 I +DFN<0 D  Q
"RTN","VAFCPDAT",19,0)
 .I $D(NOTRPC) W @IOF,!," "
"RTN","VAFCPDAT",20,0)
 .W !,"ICN ",$G(ICN)," does not exist at ",SITENAM,"."
"RTN","VAFCPDAT",21,0)
 .W !,"Search date: ",HDT,!,LN
"RTN","VAFCPDAT",22,0)
 S DIC=2,DR=".01;.02;.03;.09;.111;.112;.113;.114;.115;.1112;.131;.313;.351;994;.0907;.0906;.121",DA=DFN,DIQ(0)="EI",DIQ="DNODE"  ;**707,712
"RTN","VAFCPDAT",23,0)
 N NAME,SSN,DOB,SEX,CLAIM,DOD,ICN,STR1,STR2,STR3,CTY,ST,ZIP,PHN,MBI,SSNVER,PREAS,BAI  ;**707,712
"RTN","VAFCPDAT",24,0)
 D EN^DIQ1 K DIC,DR,DA,DIQ
"RTN","VAFCPDAT",25,0)
 S NAME=$G(DNODE(2,DFN,.01,"E")),SSN=$G(DNODE(2,DFN,.09,"E"))
"RTN","VAFCPDAT",26,0)
 S DOB=$$FMTE^XLFDT($G(DNODE(2,DFN,.03,"I")))
"RTN","VAFCPDAT",27,0)
 S MBI=$G(DNODE(2,DFN,994,"I")),MBI=$S(MBI="Y":"YES",MBI="N":"NO",1:"NULL")  ;**707
"RTN","VAFCPDAT",28,0)
 S SEX=$G(DNODE(2,DFN,.02,"E")),DOD=$G(DNODE(2,DFN,.351,"E"))
"RTN","VAFCPDAT",29,0)
 S CLAIM=$G(DNODE(2,DFN,.313,"E")) S:CLAIM="" CLAIM="None"
"RTN","VAFCPDAT",30,0)
 S BAI=$G(DNODE(2,DFN,.121,"E"))  ;**712
"RTN","VAFCPDAT",31,0)
 S STR1=$G(DNODE(2,DFN,.111,"E")),STR2=$G(DNODE(2,DFN,.112,"E")),STR3=$G(DNODE(2,DFN,.113,"E"))
"RTN","VAFCPDAT",32,0)
 S CTY=$G(DNODE(2,DFN,.114,"E")),ST=$G(DNODE(2,DFN,.115,"E")),ZIP=$G(DNODE(2,DFN,.1112,"E"))
"RTN","VAFCPDAT",33,0)
 S PHN=$G(DNODE(2,DFN,.131,"E"))
"RTN","VAFCPDAT",34,0)
 S SSNVER=$G(DNODE(2,DFN,.0907,"E"))  ;**707
"RTN","VAFCPDAT",35,0)
 S PREAS=$G(DNODE(2,DFN,.0906,"E"))  ;**707
"RTN","VAFCPDAT",36,0)
 S MNODE=$$MPINODE^MPIFAPI(DFN) I +MNODE=-1 S MNODE="^^^^^"
"RTN","VAFCPDAT",37,0)
 S (ICN,CMOR,SCN,SCORE,SCRDT,DIFF)=""
"RTN","VAFCPDAT",38,0)
 S ICN=$P($G(MNODE),"^") S:ICN="" ICN="None"
"RTN","VAFCPDAT",39,0)
 S CMOR=$$GET1^DIQ(4,+$P($G(MNODE),"^",3)_",",.01) S:CMOR="" CMOR="None"
"RTN","VAFCPDAT",40,0)
 I $E(ICN,1,3)=SITENUM S GOT=0 D
"RTN","VAFCPDAT",41,0)
 . I $P($G(MNODE),"^",4)=""!('$D(^DPT("AICNL",1,DFN))) S ICN=ICN_"**"
"RTN","VAFCPDAT",42,0)
 ;
"RTN","VAFCPDAT",43,0)
 I $D(NOTRPC) W @IOF,!
"RTN","VAFCPDAT",44,0)
 W !,"MPI/PD Data for: ",NAME,"  (DFN #",DFN,")"
"RTN","VAFCPDAT",45,0)
 ; check for patient sensitivity and user security
"RTN","VAFCPDAT",46,0)
 N RESULT,RGSENS,SENSTV,DA,DR,DIC,DIQ,VAFCSEN
"RTN","VAFCPDAT",47,0)
 D PTSEC^DGSEC4(.RESULT,DFN,0,"MPI/PD Patient Inquiry^MPI/PD Patient Inquiry")
"RTN","VAFCPDAT",48,0)
 I RESULT(1)=-1 W !!,"Access denied: Required parameters not defined" G QUIT
"RTN","VAFCPDAT",49,0)
 I RESULT(1)>0 W ?50,"***PATIENT MARKED SENSITIVE***"
"RTN","VAFCPDAT",50,0)
 I RESULT(1)=3 W !!,"Access not allowed on your own PATIENT (#2) file entry" G QUIT
"RTN","VAFCPDAT",51,0)
 I RESULT(1)=4 W !!,"Access denied: Your SSN is not defined" G QUIT
"RTN","VAFCPDAT",52,0)
 I RESULT(1)<3 D
"RTN","VAFCPDAT",53,0)
 . I RESULT(1)=1 D NOTICE^DGSEC4(.VAFCSEN,DFN,"RPC - VAFC REMOTE PDAT FROM THE MPI^MPI/PD Patient Inquiry (Remote)",2) ;IA #3027
"RTN","VAFCPDAT",54,0)
 . I RESULT(1)=2 D NOTICE^DGSEC4(.VAFCSEN,DFN,"RPC - VAFC REMOTE PDAT FROM THE MPI^MPI/PD Patient Inquiry (Remote)",3) ;IA #3027
"RTN","VAFCPDAT",55,0)
 W !,"Printed ",HDT," at ",SITENAM,!,LN
"RTN","VAFCPDAT",56,0)
 S $Y=$Y+1
"RTN","VAFCPDAT",57,0)
 ;next 7 lines modified for **707
"RTN","VAFCPDAT",58,0)
 W !,"ICN    : ",ICN,?40,"CMOR: ",CMOR
"RTN","VAFCPDAT",59,0)
 W !,"SSN    : ",SSN
"RTN","VAFCPDAT",60,0)
 I SSNVER]"" W !?9,"SSN Verification Status: ",SSNVER
"RTN","VAFCPDAT",61,0)
 I SSNVER="",PREAS]"" W !?9,"Pseudo SSN Reason: ",PREAS
"RTN","VAFCPDAT",62,0)
 I SSNVER]"",PREAS]"" W !?9,"Pseudo SSN Reason      : ",PREAS
"RTN","VAFCPDAT",63,0)
 W !,"Sex    : ",SEX
"RTN","VAFCPDAT",64,0)
 W !,"Claim #: ",CLAIM
"RTN","VAFCPDAT",65,0)
 W !,"Date of Birth: ",DOB
"RTN","VAFCPDAT",66,0)
 I DOD]"" W !,"Date of Death: ",DOD
"RTN","VAFCPDAT",67,0)
 I MBI]"" W !,"Multiple Birth Indicator: ",MBI  ;**707
"RTN","VAFCPDAT",68,0)
 W !,"Address:" I BAI'="" W " (Bad Address Indicator: ",BAI,")"
"RTN","VAFCPDAT",69,0)
 I STR1'="" W !?9,STR1
"RTN","VAFCPDAT",70,0)
 I STR2'="" W !?9,STR2
"RTN","VAFCPDAT",71,0)
 I STR3'="" W !?9,STR3
"RTN","VAFCPDAT",72,0)
 I CTY'="" W !?9,$E(CTY,1,20)_", "_$G(ST)_" "_$G(ZIP)
"RTN","VAFCPDAT",73,0)
 I PHN'="" W !,"Phone #: ",PHN
"RTN","VAFCPDAT",74,0)
 I $G(IOSL)<30&($E(IOST,1,2)="C-") D
"RTN","VAFCPDAT",75,0)
 .I $Y>23 D
"RTN","VAFCPDAT",76,0)
 ..S DIR(0)="E" D  D ^DIR K DIR I 'Y S QFLG=1
"RTN","VAFCPDAT",77,0)
 ...S SS=22-$Y F JJ=1:1:SS W !
"RTN","VAFCPDAT",78,0)
 ..S $Y=0
"RTN","VAFCPDAT",79,0)
 I QFLG=1 G QUIT
"RTN","VAFCPDAT",80,0)
 ;
"RTN","VAFCPDAT",81,0)
TF ;List Treating Facilities for this patient
"RTN","VAFCPDAT",82,0)
 D TFHDR
"RTN","VAFCPDAT",83,0)
 K TFARR
"RTN","VAFCPDAT",84,0)
 S TF=0 F  S TF=$O(^DGCN(391.91,"APAT",DFN,TF)) Q:'TF  D
"RTN","VAFCPDAT",85,0)
 .S TFIEN=$O(^DGCN(391.91,"APAT",DFN,TF,0))
"RTN","VAFCPDAT",86,0)
 . S DIC="^DGCN(391.91,",DR=".02;.03;.07",DA=TFIEN,DIQ(0)="EI",DIQ="TFDATA"
"RTN","VAFCPDAT",87,0)
 . D EN^DIQ1 K DIC,DA,DR,DIQ
"RTN","VAFCPDAT",88,0)
 . S INST="",STATION=""
"RTN","VAFCPDAT",89,0)
 . S INST=$G(TFDATA(391.91,TFIEN,.02,"I"))
"RTN","VAFCPDAT",90,0)
 . I INST'="" D
"RTN","VAFCPDAT",91,0)
 .. S DIC=4,DR="99",DA=INST,DIQ(0)="E",DIQ="STA"
"RTN","VAFCPDAT",92,0)
 .. D EN^DIQ1 K DIC,DA,DR,DIQ
"RTN","VAFCPDAT",93,0)
 .. S STATION=$G(STA(4,INST,99,"E"))
"RTN","VAFCPDAT",94,0)
 . S TFNM=$G(TFDATA(391.91,TFIEN,.02,"E"))
"RTN","VAFCPDAT",95,0)
 . S LSTDT=$G(TFDATA(391.91,TFIEN,.03,"I")) S:LSTDT="" LSTDT="none found"
"RTN","VAFCPDAT",96,0)
 . S LSTSORT=9999999
"RTN","VAFCPDAT",97,0)
 . I +LSTDT S LSTSORT=9999999-LSTDT,LSTDT=$$FMTE^XLFDT($E(LSTDT,1,12))
"RTN","VAFCPDAT",98,0)
 . S REACODE=$G(TFDATA(391.91,TFIEN,.07,"E")) S REASON="none found"
"RTN","VAFCPDAT",99,0)
 . I REACODE'="" D
"RTN","VAFCPDAT",100,0)
 .. S DIC="^VAT(391.72,",DIC(0)="Z",X=REACODE D ^DIC K DIC,X
"RTN","VAFCPDAT",101,0)
 .. S REASON=$P($G(Y(0)),"^",4)
"RTN","VAFCPDAT",102,0)
 . S TFARR(LSTSORT,TFNM)=TFIEN_"^"_REASON_"^"_$G(STATION)_"^"_LSTDT
"RTN","VAFCPDAT",103,0)
 I '$D(TFARR) W !,"No Treating Facilities found." G SUB
"RTN","VAFCPDAT",104,0)
 S LSTSORT=0 F  S LSTSORT=$O(TFARR(LSTSORT)) Q:'LSTSORT  D  G:QFLG QUIT
"RTN","VAFCPDAT",105,0)
 .S TFNM="" F  S TFNM=$O(TFARR(LSTSORT,TFNM)) Q:TFNM=""  D  Q:QFLG
"RTN","VAFCPDAT",106,0)
 ..S REASON=$P(TFARR(LSTSORT,TFNM),"^",2)
"RTN","VAFCPDAT",107,0)
 ..S STATION=$P(TFARR(LSTSORT,TFNM),"^",3)
"RTN","VAFCPDAT",108,0)
 ..S LSTDT=$P(TFARR(LSTSORT,TFNM),"^",4)
"RTN","VAFCPDAT",109,0)
 ..I $Y+3>IOSL&($E(IOST,1,2)="C-") D  Q:QFLG
"RTN","VAFCPDAT",110,0)
 ...S LNQ=22 D SS Q:QFLG
"RTN","VAFCPDAT",111,0)
 ...W @IOF,!,"MPI/PD data for: ",NAME,"  (DFN #",DFN,")",!,LN2 D TFHDR
"RTN","VAFCPDAT",112,0)
 ..W !,$E(TFNM,1,20),?22,$G(STATION),?32,LSTDT,?54,REASON
"RTN","VAFCPDAT",113,0)
SUB ;removed listing of subscribers for RG*1.0*23
"RTN","VAFCPDAT",114,0)
HIS ;find ICN history
"RTN","VAFCPDAT",115,0)
 I '$O(^DPT(DFN,"MPIFHIS",0)) G CONT
"RTN","VAFCPDAT",116,0)
 ;
"RTN","VAFCPDAT",117,0)
 I $Y+4>IOSL&($E(IOST,1,2)="C-") D  G:QFLG QUIT
"RTN","VAFCPDAT",118,0)
 .S LNQ=22 D SS Q:QFLG
"RTN","VAFCPDAT",119,0)
 .W @IOF,!,"MPI/PD data for: ",NAME,"  (DFN #",DFN,")",!,LN2
"RTN","VAFCPDAT",120,0)
 D ICNHDR
"RTN","VAFCPDAT",121,0)
 S HIS=0 F  S HIS=$O(^DPT(DFN,"MPIFHIS",HIS)) Q:'HIS  D  G:QFLG QUIT
"RTN","VAFCPDAT",122,0)
 .S DIC=2,DR="992",DR(2.0992)=".01;3",DA=DFN,DA(2.0992)=HIS
"RTN","VAFCPDAT",123,0)
 .S DIQ(0)="E",DIQ="HISNODE"
"RTN","VAFCPDAT",124,0)
 .D EN^DIQ1 K DIC,DA,DR,DIQ
"RTN","VAFCPDAT",125,0)
 .S HISICN=$G(HISNODE(2.0992,HIS,.01,"E"))
"RTN","VAFCPDAT",126,0)
 .S HISDT=$G(HISNODE(2.0992,HIS,3,"E"))
"RTN","VAFCPDAT",127,0)
 .I $Y+3>IOSL&($E(IOST,1,2)="C-") D  Q:QFLG
"RTN","VAFCPDAT",128,0)
 ..S LNQ=22 D SS Q:QFLG
"RTN","VAFCPDAT",129,0)
 ..W @IOF,!,"MPI/PD data for: ",NAME,"  (DFN #",DFN,")",!,LN2 D ICNHDR
"RTN","VAFCPDAT",130,0)
 .W !,HISICN I HISDT]"" W "  - changed ",HISDT
"RTN","VAFCPDAT",131,0)
 ;
"RTN","VAFCPDAT",132,0)
CONT ;Continue to VAFCPDT2 for CMOR data and extended data
"RTN","VAFCPDAT",133,0)
 D CMORHIS^VAFCPDT2
"RTN","VAFCPDAT",134,0)
DONE ;
"RTN","VAFCPDAT",135,0)
 I QFLG G QUIT
"RTN","VAFCPDAT",136,0)
 I ($E(IOST,1,2)="C-") S LNQ=24 D SS
"RTN","VAFCPDAT",137,0)
 ;
"RTN","VAFCPDAT",138,0)
QUIT ;
"RTN","VAFCPDAT",139,0)
 K %,CMOR,DIC,DIR,DIRUT,DNODE,GOT,HDT,HIS,HISDT,HISICN,JJ,LIEN,LINST
"RTN","VAFCPDAT",140,0)
 K LN,LSTDT,MNODE,REACODE,REASON,SCN,SCORE,SITE,SITEIEN,SITENAM,SITENUM
"RTN","VAFCPDAT",141,0)
 K SS,SUBN,SUBARR,TERM,TERMDT,TF,TFARR,TFDATA,TFIEN,TFNM,Y,D,CHG,CHGNODE
"RTN","VAFCPDAT",142,0)
 K HISNODE,DIFF,INST,RGDFN,SCRDT,STATION,STA,LN2,NAME,LSTSORT,LNQ,QFLG,MBI
"RTN","VAFCPDAT",143,0)
 Q
"RTN","VAFCPDAT",144,0)
TFHDR ;
"RTN","VAFCPDAT",145,0)
 W !!,"Treating Facilities:",?22,"Station:",?32,"DT Last Treated",?54,"Event Reason"
"RTN","VAFCPDAT",146,0)
 W !,"--------------------",?22,"--------",?32,"---------------",?54,"------------"
"RTN","VAFCPDAT",147,0)
 Q
"RTN","VAFCPDAT",148,0)
ICNHDR W !!,"ICN History:",!,"------------"
"RTN","VAFCPDAT",149,0)
 Q
"RTN","VAFCPDAT",150,0)
 ;
"RTN","VAFCPDAT",151,0)
SS S DIR(0)="E" D  D ^DIR K DIR I 'Y S QFLG=1
"RTN","VAFCPDAT",152,0)
 .S SS=LNQ-$Y F JJ=1:1:SS W !
"RTN","VAFCPDAT",153,0)
 Q
"RTN","VAFCTFPR")
0^3^B23028531^B22416094
"RTN","VAFCTFPR",1,0)
VAFCTFPR ;ALB/JLU,CML-MFU PROCESSING ROUTINE ;06/25/98
"RTN","VAFCTFPR",2,0)
 ;;5.3;Registration;**149,261,255,307,414,474,520,712**;Aug 13, 1993;Build 7
"RTN","VAFCTFPR",3,0)
 ;Reference to EXC^RGHLLOG and START^RGHLLOG supported by IA #2796
"RTN","VAFCTFPR",4,0)
 ;
"RTN","VAFCTFPR",5,0)
EN ;This entry point is used to process the Master File Update Message.
"RTN","VAFCTFPR",6,0)
 ;It is called by the VAFC MFU-TFL ClIENT when a MFU message is received
"RTN","VAFCTFPR",7,0)
 ;There are no inputs or outputs
"RTN","VAFCTFPR",8,0)
 ;
"RTN","VAFCTFPR",9,0)
 ;quit if Master Patient Index (MPI) is not installed
"RTN","VAFCTFPR",10,0)
 S X="MPIF001" X ^%ZOSF("TEST") Q:'$T
"RTN","VAFCTFPR",11,0)
 S X="MPIFQ0" X ^%ZOSF("TEST") Q:'$T
"RTN","VAFCTFPR",12,0)
 S X="RGRSBUL1" X ^%ZOSF("TEST") Q:'$T
"RTN","VAFCTFPR",13,0)
 S X="RGRSBULL" X ^%ZOSF("TEST") Q:'$T
"RTN","VAFCTFPR",14,0)
 K X N ICN,PDFN,TYPE,VAFCER,VAFCARR,SG
"RTN","VAFCTFPR",15,0)
 N VAFC,MFNQUIT,VAFCI,MSG,MFUPT,INST,PDLT,VAFCTFT
"RTN","VAFCTFPR",16,0)
MFN ;Read Treating Facility MFN M05 (PROCESS LOGIC) msg into VAFC()
"RTN","VAFCTFPR",17,0)
 F VAFCI=1:1 X HLNEXT Q:HLQUIT'>0  S VAFC(VAFCI)=HLNODE
"RTN","VAFCTFPR",18,0)
MFNP ;Process in the TF updates messages
"RTN","VAFCTFPR",19,0)
 S VAFCI="" F  S VAFCI=$O(VAFC(VAFCI)) Q:'VAFCI!($G(MFNQUIT)=1)  S MSG=VAFC(VAFCI),SG=$E(MSG,1,3) D:SG?2A1(1A,1N) PICK
"RTN","VAFCTFPR",20,0)
 Q
"RTN","VAFCTFPR",21,0)
INIT ;Process in the ADT A04/A08 (routing logic)
"RTN","VAFCTFPR",22,0)
 F VAFCI=1:1 X HLNEXT Q:HLQUIT'>0  S (MSG,VAFC(VAFCI))=HLNODE,SG=$E(HLNODE,1,3) D:SG?2A1(1A,1N) PICK
"RTN","VAFCTFPR",23,0)
 Q
"RTN","VAFCTFPR",24,0)
PICK ;check routine for segment entry point
"RTN","VAFCTFPR",25,0)
 I $T(@SG)]"" D @SG
"RTN","VAFCTFPR",26,0)
 I $T(@SG)="" Q
"RTN","VAFCTFPR",27,0)
 Q
"RTN","VAFCTFPR",28,0)
MSH ;;MSH
"RTN","VAFCTFPR",29,0)
 ;process the MSH segment
"RTN","VAFCTFPR",30,0)
 D START^RGHLLOG($G(HLMTIENS))
"RTN","VAFCTFPR",31,0)
 S (HLFS,HL("FS"))=$E(MSG,4),(HLECH,HL("ECH"))=$E(MSG,5,8)
"RTN","VAFCTFPR",32,0)
 S VAFCARR("SENDING SITE")=$P(MSG,HL("FS"),4)
"RTN","VAFCTFPR",33,0)
 Q
"RTN","VAFCTFPR",34,0)
EVN ;;EVN
"RTN","VAFCTFPR",35,0)
 ;process the EVN segment
"RTN","VAFCTFPR",36,0)
 S STATN=+$$SITE^VASITE()_"^"_$$FMDATE^HLFNC($P(MSG,HL("FS"),3))
"RTN","VAFCTFPR",37,0)
 Q
"RTN","VAFCTFPR",38,0)
PID ;;PID
"RTN","VAFCTFPR",39,0)
 ;process the PID segment
"RTN","VAFCTFPR",40,0)
 S PDFN=+$P(MSG,HL("FS"),4)
"RTN","VAFCTFPR",41,0)
 Q
"RTN","VAFCTFPR",42,0)
MFI ;;MFI
"RTN","VAFCTFPR",43,0)
 ;process the MFI segment
"RTN","VAFCTFPR",44,0)
 N NXTSGMT,VAFCMPI
"RTN","VAFCTFPR",45,0)
 S MFUPT=$P(MSG,HL("FS"),2)
"RTN","VAFCTFPR",46,0)
 ;master file update type is not TFL SET quit flag
"RTN","VAFCTFPR",47,0)
 I MFUPT'="TFL" S MFNQUIT=1 Q
"RTN","VAFCTFPR",48,0)
 N HLCOMP
"RTN","VAFCTFPR",49,0)
 S HLCOMP=$E(HL("ECH"),1)
"RTN","VAFCTFPR",50,0)
 S TYPE=$P(MSG,HL("FS"),4)
"RTN","VAFCTFPR",51,0)
 ;is this coming from the CMOR if so pass a '1' to FILE to end transmission
"RTN","VAFCTFPR",52,0)
 S VAFCTFT=0 I TYPE="REP" S VAFCTFT=1
"RTN","VAFCTFPR",53,0)
 S VAFCARR("CMOR")=$P($P(MSG,HL("FS"),8),HLCOMP,1)
"RTN","VAFCTFPR",54,0)
 S NXTSGMT=$G(VAFC(+$O(VAFC(VAFCI))))
"RTN","VAFCTFPR",55,0)
 I $P(NXTSGMT,HL("FS"))="MFE" S ICN=$P($P(NXTSGMT,HL("FS"),5),HLCOMP,4) I $G(ICN)="" S MFNQUIT=1 D EXC^RGHLLOG(210,"Msg#"_$G(HL("MID"))_" failed to Update TF from "_$G(VAFCARR("SENDING SITE"))_".  ICN not sent.",$G(PDFN)) Q
"RTN","VAFCTFPR",56,0)
 ;check for CMOR mismatch
"RTN","VAFCTFPR",57,0)
 S PDFN=$$GETDFN^MPIF001(ICN)
"RTN","VAFCTFPR",58,0)
 I +$G(PDFN)<0 S MFNQUIT=1 D EXC^RGHLLOG(210,"Msg#"_$G(HL("MID"))_" failed to update TF from "_$G(VAFCARR("SENDING SITE"))_" for ICN#"_$G(ICN)) Q
"RTN","VAFCTFPR",59,0)
 S VAFCMPI=$$MPINODE^MPIFAPI(PDFN)
"RTN","VAFCTFPR",60,0)
 ;if from CMOR delete all TF's and replace with CMOR's list (need to log exception if problems deleting TF's)
"RTN","VAFCTFPR",61,0)
 I TYPE="REP" D
"RTN","VAFCTFPR",62,0)
 . ;if CMOR mismatch quit the exception will be logged in MFE subroutine
"RTN","VAFCTFPR",63,0)
 .;**712 NO NEED TO CHECK CMOR ANYMORE I $P($G(VAFCMPI),"^",3)'=$G(VAFCARR("CMOR")) Q
"RTN","VAFCTFPR",64,0)
 . S VAFCER=$$DELALLTF^VAFCTFU(ICN) I VAFCER S MFNQUIT=1 D EXC^RGHLLOG(212,"Msg#"_$G(HL("MID"))_" failed to Delete ALL TF's for ICN#"_$G(ICN),$G(PDFN)) Q
"RTN","VAFCTFPR",65,0)
 Q
"RTN","VAFCTFPR",66,0)
MFE ;;MFE
"RTN","VAFCTFPR",67,0)
 ;process the MFE segment
"RTN","VAFCTFPR",68,0)
 N HLCOMP,NXTSGMT
"RTN","VAFCTFPR",69,0)
 S HLCOMP=$E(HL("ECH"),1)
"RTN","VAFCTFPR",70,0)
 S PDLT=$$FMDATE^HLFNC($P(MSG,HL("FS"),4))
"RTN","VAFCTFPR",71,0)
 S INST=$P($P(MSG,HL("FS"),5),HLCOMP) ; **520 REMOVE + AND GET PIECE
"RTN","VAFCTFPR",72,0)
 S INST=$$LKUP^XUAF4(INST) ; **520 REMOVE +
"RTN","VAFCTFPR",73,0)
 I INST="" S MFNQUIT=1 Q  ; log exception, set MFNQUIT flag and quit
"RTN","VAFCTFPR",74,0)
 S PDFN=$$GETDFN^MPIF001(ICN)
"RTN","VAFCTFPR",75,0)
 D  Q:$G(MFNQUIT)=1
"RTN","VAFCTFPR",76,0)
 .;if unable to get DFN from ICN set MFNQUIT flag and quit
"RTN","VAFCTFPR",77,0)
 .I +$G(PDFN)<0 S MFNQUIT=1 D EXC^RGHLLOG(210,"Msg#"_$G(HL("MID"))_" failed to update TF from "_$G(VAFCARR("SENDING SITE"))_" for ICN#"_$G(ICN)) Q
"RTN","VAFCTFPR",78,0)
 .N VAFCDATA,LOCNAME,LASTNAME,LOCSSN,LOCICN,LOCCMOR
"RTN","VAFCTFPR",79,0)
 .S LOCNAME=$$GET1^DIQ(2,+PDFN_",",.01)
"RTN","VAFCTFPR",80,0)
 .S LASTNAME=$P(LOCNAME,",",1)
"RTN","VAFCTFPR",81,0)
 .S LOCSSN=$$GET1^DIQ(2,+PDFN_",",.09)
"RTN","VAFCTFPR",82,0)
 .S LOCICN=+$$GETICN^MPIF001(PDFN)
"RTN","VAFCTFPR",83,0)
 .S LOCCMOR=$$GETVCCI^MPIF001(PDFN)
"RTN","VAFCTFPR",84,0)
 .;CMOR MISMATCH or CMOR = null log exception, set MFNQUIT flag and quit
"RTN","VAFCTFPR",85,0)
 .;**712 NO NEED TO CHECK CMOR ANYMORE
"RTN","VAFCTFPR",86,0)
 .;I LOCCMOR'=VAFCARR("CMOR")!(VAFCARR("CMOR")="") D  Q
"RTN","VAFCTFPR",87,0)
 .;.D EXC^RGHLLOG(211,"Msg#"_$G(HL("MID"))_" failed to update from "_$G(VAFCARR("SENDING SITE"))_" for "_$G(LOCNAME)_" ICN#"_$G(ICN)_" due to mismatch CMOR "_$G(VAFCARR("CMOR"))_"/"_$G(LOCCMOR)_" (local)",$G(PDFN)) S MFNQUIT=1
"RTN","VAFCTFPR",88,0)
 ;check next segment, if it exist and it is a ZET segment quit and let the ZET module add the TF
"RTN","VAFCTFPR",89,0)
 S NXTSGMT=$G(VAFC(+$O(VAFC(VAFCI)))) I $P($G(NXTSGMT),HL("FS"))="ZET" Q
"RTN","VAFCTFPR",90,0)
 D FILE^VAFCTFU(PDFN,INST_"^"_$G(PDLT),$G(VAFCTFT))
"RTN","VAFCTFPR",91,0)
 Q
"RTN","VAFCTFPR",92,0)
ZET ;;ZET
"RTN","VAFCTFPR",93,0)
 ;process Patient's Date Last Treated Event Type, ZET segment
"RTN","VAFCTFPR",94,0)
 K PDLTET
"RTN","VAFCTFPR",95,0)
 S PDLTET=$P(MSG,HL("FS"),2)
"RTN","VAFCTFPR",96,0)
 D FILE^VAFCTFU(PDFN,INST_"^"_PDLT_"^"_PDLTET,$G(VAFCTFT))
"RTN","VAFCTFPR",97,0)
 Q
"RTN","VAFCTFPR",98,0)
TFPRQ Q
"RTN","VAFCTFPR",99,0)
 ;
"RTN","VAFCTFPR",100,0)
POPQ Q
"RTN","VAFCTFPR",101,0)
 ;
"RTN","VAFCTFPR",102,0)
UP ;entry point to process local A04 messages.
"RTN","VAFCTFPR",103,0)
 ;This is call by the VAFC TFL-UPDATE CLIENT
"RTN","VAFCTFPR",104,0)
 N STATN,PDFN,VAFCARR,HLFS,HLECH,SG,VAFCI
"RTN","VAFCTFPR",105,0)
 N VAFC
"RTN","VAFCTFPR",106,0)
 D INIT
"RTN","VAFCTFPR",107,0)
 ;file the TF and trigger the TF update
"RTN","VAFCTFPR",108,0)
 D FILE^VAFCTFU(PDFN,+$$SITE^VASITE,1)
"RTN","VAFCTFPR",109,0)
UPQ Q
"RTN","VAFCTR")
0^2^B2482346^B1588263
"RTN","VAFCTR",1,0)
VAFCTR ;BIR/CMC,ERC,PTD-Monitoring fields for MPI/PD via DG field monitoring ; 3/30/07
"RTN","VAFCTR",2,0)
 ;;5.3;Registration;**575,648,653,712**;Aug 13, 1993;Build 7
"RTN","VAFCTR",3,0)
 Q  ; quit if called from the top
"RTN","VAFCTR",4,0)
 ;
"RTN","VAFCTR",5,0)
MPIPD ; protocol entry point for monitoring fields via DG field monitoring
"RTN","VAFCTR",6,0)
 ; Currently monitoring for fields:
"RTN","VAFCTR",7,0)
 ; 1 ALIAS - .01 of the multiple
"RTN","VAFCTR",8,0)
 ; 2 RACE INFORMATION - .01 of the multiple
"RTN","VAFCTR",9,0)
 ; 6 ETHNICITY INFORMATION - .01 of the multiple
"RTN","VAFCTR",10,0)
 ; 994 MULTIPLE BIRTH INDICATOR
"RTN","VAFCTR",11,0)
 ; .525 POW STAUTS INDICATED?
"RTN","VAFCTR",12,0)
 ; .0906 PSEUDO SSN REASON
"RTN","VAFCTR",13,0)
 ; .121 BAD ADDRESS INDICATOR
"RTN","VAFCTR",14,0)
 ; .133 EMAIL ADDRESS
"RTN","VAFCTR",15,0)
 ; .134 PHONE NUMBER [CELLULAR]
"RTN","VAFCTR",16,0)
 ;
"RTN","VAFCTR",17,0)
 I $G(DGFILE)'=2&($G(DGFILE)'=2.01)&($G(DGFILE)'=2.02)&($G(DGFILE)'=2.06) Q
"RTN","VAFCTR",18,0)
 S DGFIELD=$G(DGFIELD)
"RTN","VAFCTR",19,0)
 I DGFIELD'=.01&(DGFIELD'=994)&(DGFIELD'=.525)&(DGFIELD'=.0906)&(DGFIELD'=.121)&(DGFIELD'=.133)&(DGFIELD'=.134)  Q
"RTN","VAFCTR",20,0)
 I $T(AVAFC^VAFCDD01)="" Q
"RTN","VAFCTR",21,0)
 ;The fields below are not multiples
"RTN","VAFCTR",22,0)
 I (DGFIELD=994)!(DGFIELD=.525)!(DGFIELD=.0906)!(DGFIELD=.121)!(DGFIELD=.133)!(DGFIELD=.134) S VAFCF=DGFIELD_";" D AVAFC^VAFCDD01(DGDA)
"RTN","VAFCTR",23,0)
 ;The fields below ARE multiples
"RTN","VAFCTR",24,0)
 I DGFILE=2.01 S VAFCF="1;" D AVAFC^VAFCDD01(DGDA(1)) ;ALIAS
"RTN","VAFCTR",25,0)
 I DGFILE=2.02 S VAFCF="2.02,.01;" D AVAFC^VAFCDD01(DGDA(1)) ;RACE INFORMATION
"RTN","VAFCTR",26,0)
 I DGFILE=2.06 S VAFCF="2.06,.01;" D AVAFC^VAFCDD01(DGDA(1)) ;ETHNICITY INFORMATION
"RTN","VAFCTR",27,0)
 Q
"VER")
8.0^22.0
"BLD",2647,6)
^714
**END**
**END**
