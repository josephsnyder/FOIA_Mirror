Released DG*5.3*817 SEQ #732
Extracted from mail message
**KIDS**:DG*5.3*817^

**INSTALL NAME**
DG*5.3*817
"BLD",8271,0)
DG*5.3*817^REGISTRATION^0^3100318^y
"BLD",8271,1,0)
^^4^4^3100318^
"BLD",8271,1,1,0)
 This patch will allow a PTF record for a FEE BASIS patient with a means
"BLD",8271,1,2,0)
 test status of "Required" to be closed and transmitted to Austin. It will
"BLD",8271,1,3,0)
 also allow setting of 501 transmissions flag for PTF's with more than 25
"BLD",8271,1,4,0)
 records.
"BLD",8271,4,0)
^9.64PA^^
"BLD",8271,6.3)
4
"BLD",8271,"KRN",0)
^9.67PA^779.2^20
"BLD",8271,"KRN",.4,0)
.4
"BLD",8271,"KRN",.401,0)
.401
"BLD",8271,"KRN",.402,0)
.402
"BLD",8271,"KRN",.403,0)
.403
"BLD",8271,"KRN",.5,0)
.5
"BLD",8271,"KRN",.84,0)
.84
"BLD",8271,"KRN",3.6,0)
3.6
"BLD",8271,"KRN",3.8,0)
3.8
"BLD",8271,"KRN",9.2,0)
9.2
"BLD",8271,"KRN",9.8,0)
9.8
"BLD",8271,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",8271,"KRN",9.8,"NM",1,0)
DGPTR1^^0^B28617663
"BLD",8271,"KRN",9.8,"NM",2,0)
DGPTUTL1^^0^B30078992
"BLD",8271,"KRN",9.8,"NM",3,0)
DGPTFVC1^^0^B36905971
"BLD",8271,"KRN",9.8,"NM","B","DGPTFVC1",3)

"BLD",8271,"KRN",9.8,"NM","B","DGPTR1",1)

"BLD",8271,"KRN",9.8,"NM","B","DGPTUTL1",2)

"BLD",8271,"KRN",19,0)
19
"BLD",8271,"KRN",19,"NM",0)
^9.68A^^
"BLD",8271,"KRN",19.1,0)
19.1
"BLD",8271,"KRN",101,0)
101
"BLD",8271,"KRN",409.61,0)
409.61
"BLD",8271,"KRN",771,0)
771
"BLD",8271,"KRN",779.2,0)
779.2
"BLD",8271,"KRN",870,0)
870
"BLD",8271,"KRN",8989.51,0)
8989.51
"BLD",8271,"KRN",8989.52,0)
8989.52
"BLD",8271,"KRN",8994,0)
8994
"BLD",8271,"KRN","B",.4,.4)

"BLD",8271,"KRN","B",.401,.401)

"BLD",8271,"KRN","B",.402,.402)

"BLD",8271,"KRN","B",.403,.403)

"BLD",8271,"KRN","B",.5,.5)

"BLD",8271,"KRN","B",.84,.84)

"BLD",8271,"KRN","B",3.6,3.6)

"BLD",8271,"KRN","B",3.8,3.8)

"BLD",8271,"KRN","B",9.2,9.2)

"BLD",8271,"KRN","B",9.8,9.8)

"BLD",8271,"KRN","B",19,19)

"BLD",8271,"KRN","B",19.1,19.1)

"BLD",8271,"KRN","B",101,101)

"BLD",8271,"KRN","B",409.61,409.61)

"BLD",8271,"KRN","B",771,771)

"BLD",8271,"KRN","B",779.2,779.2)

"BLD",8271,"KRN","B",870,870)

"BLD",8271,"KRN","B",8989.51,8989.51)

"BLD",8271,"KRN","B",8989.52,8989.52)

"BLD",8271,"KRN","B",8994,8994)

"BLD",8271,"QDEF")
^^^^^^^^^^YES
"BLD",8271,"QUES",0)
^9.62^^
"BLD",8271,"REQB",0)
^9.611^3^3
"BLD",8271,"REQB",1,0)
DG*5.3*635^1
"BLD",8271,"REQB",2,0)
DG*5.3*664^1
"BLD",8271,"REQB",3,0)
DG*5.3*629^1
"BLD",8271,"REQB","B","DG*5.3*629",3)

"BLD",8271,"REQB","B","DG*5.3*635",1)

"BLD",8271,"REQB","B","DG*5.3*664",2)

"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813
"PKG",5,22,1,"PAH",1,0)
817^3100318
"PKG",5,22,1,"PAH",1,1,0)
^^4^4^3100318
"PKG",5,22,1,"PAH",1,1,1,0)
 This patch will allow a PTF record for a FEE BASIS patient with a means
"PKG",5,22,1,"PAH",1,1,2,0)
 test status of "Required" to be closed and transmitted to Austin. It will
"PKG",5,22,1,"PAH",1,1,3,0)
 also allow setting of 501 transmissions flag for PTF's with more than 25
"PKG",5,22,1,"PAH",1,1,4,0)
 records.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","DGPTFVC1")
0^3^B36905971^B36592132
"RTN","DGPTFVC1",1,0)
DGPTFVC1 ;ALB/AS/ADL - Expanded PTF Close-Out Edits ; 12/14/04 10:34am
"RTN","DGPTFVC1",2,0)
 ;;5.3;Registration;**52,58,79,114,164,400,342,466,415,493,512,510,544,629,817**;Aug 13, 1993;Build 4
"RTN","DGPTFVC1",3,0)
 ;;ADL;Updated for CSV Project;;Mar 26, 2003
"RTN","DGPTFVC1",4,0)
 ;Called from Q+2^DGPTFTR. Variable must be passed in: PTF
"RTN","DGPTFVC1",5,0)
 ;Variable returned: DGERR.   DGERR <-- 1 if record fails to pass a check; DGERR <-- "" if record passes all checks
"RTN","DGPTFVC1",6,0)
 ;
"RTN","DGPTFVC1",7,0)
 Q:'$D(PTF)
"RTN","DGPTFVC1",8,0)
 S DGERR="",DGV(701)=$S($D(^DGPT(PTF,70)):^(70),1:""),DGV(101)=^(0),DGSUFFIX=$P(DGV(101),"^",5),DGV("FEE")=$P(DGV(101),"^",4),DFN=$P(DGV(101),"^",1)
"RTN","DGPTFVC1",9,0)
 ;
"RTN","DGPTFVC1",10,0)
 I $P(DGV(101),"^",2)>2820700 D AO
"RTN","DGPTFVC1",11,0)
 ;
"RTN","DGPTFVC1",12,0)
 I DGRTY=1,DGV("FEE") D MT
"RTN","DGPTFVC1",13,0)
 ;
"RTN","DGPTFVC1",14,0)
 ; DG*512, sck/Remove 101-Means Test indicator = 'U' xmit block
"RTN","DGPTFVC1",15,0)
 ;I 'DGV("FEE"),$P(DGV(101),"^",10)="U",'DGV(701)!(+DGV(701)>2890700) S DGERR=1 W !,"101 MEANS TEST",?23," value 'U' - not valid for discharges as of 7/1/1989",!?42,"per MAS VACO policy"
"RTN","DGPTFVC1",16,0)
 ;
"RTN","DGPTFVC1",17,0)
 I $D(^DPT(DFN,57)),$P(^(57),"^",4)>0 S S0=$P(^(57),"^",4),DGDX=$S(S0=1!(S0=3):"344.1",1:"344.0"),DGSCI="" F DGX=0:0 S DGX=$O(^DGPT(PTF,"M",DGX)) Q:DGX'>0  S DGNODE=^(DGX,0),DGSCI="" D SCI
"RTN","DGPTFVC1",18,0)
 ;
"RTN","DGPTFVC1",19,0)
 S DGDP="",DGDISPO=$P(DGV(701),"^",6),DGRECSUF=$P(DGV(701),"^",13)
"RTN","DGPTFVC1",20,0)
 I DGRTY=1 D
"RTN","DGPTFVC1",21,0)
 .S DGSTATYP=$S(DGDISPO=12!(DGDISPO=13):30,DGDISPO=10:42,DGDISPO=8:40,1:"")
"RTN","DGPTFVC1",22,0)
 .I DGSTATYP]"" D
"RTN","DGPTFVC1",23,0)
 ..D NUMACT^DGPTSUF(DGSTATYP)
"RTN","DGPTFVC1",24,0)
 ..I DGANUM>0 F I=1:1:DGANUM I DGSUFFIX=DGSUFNAM(I) D
"RTN","DGPTFVC1",25,0)
 ...I DGDISPO'=8 I DGRECSUF=DGSUFNAM(DGANUM) S DGDP=5 D DP
"RTN","DGPTFVC1",26,0)
 ...I DGDISPO=8 N DGANUM,DGSUFNAM D NUMACT^DGPTSUF(42) I DGRECSUF=DGSUFNAM(DGANUM) S DGDP=5 D DP
"RTN","DGPTFVC1",27,0)
 .K DGANUM,DGSTATYP,DGSUFNAM,I
"RTN","DGPTFVC1",28,0)
 ;
"RTN","DGPTFVC1",29,0)
 I DGRTY=1 S %=$P(DGV(701),"^",3) I %=4!(%=6)!(%=7) S DGDP="" D OP I $P(DGV(701),"^",5)=1 S DGERR=1 W !,"701 VA AUSPICES",?23," value inconsistent for discharge"
"RTN","DGPTFVC1",30,0)
 ;
"RTN","DGPTFVC1",31,0)
 ;I 'DGV("FEE") S %=$P(^DPT(DFN,0),"^",6),%=$S($D(^DIC(10,+%,0)):$P(^(0),"^",2),1:"") I '%!(%>7) S DGERR=1 W !,"701 RACE",?23," value " W:%']"" "blank" I %]"" W %," (invalid code)"
"RTN","DGPTFVC1",32,0)
 ;
"RTN","DGPTFVC1",33,0)
 ;If PRRTP treating specialty, must have valid PRRTP suffix
"RTN","DGPTFVC1",34,0)
 ;Fee records would not contain PRRTP specialties
"RTN","DGPTFVC1",35,0)
 I 'DGV("FEE"),"^25^26^27^28^29^38^39^"[(U_$P(DGV(701),U,2)_U) D
"RTN","DGPTFVC1",36,0)
 .I DGSUFFIX'="PA",(DGSUFFIX'="PB"),(DGSUFFIX'="PC"),(DGSUFFIX'="PD") D
"RTN","DGPTFVC1",37,0)
 ..S DGERR=1
"RTN","DGPTFVC1",38,0)
 ..W !,"101 SUFFIX",?23,"value must be set to a valid PRRTP suffix."
"RTN","DGPTFVC1",39,0)
 ;
"RTN","DGPTFVC1",40,0)
 D RACETHNC
"RTN","DGPTFVC1",41,0)
 K DGDISPO,DGRECSUF,DGV,DGDP,DGDX,DGSCI,DGSUFFIX,DGNODE,DGX,%,S0,I,X
"RTN","DGPTFVC1",42,0)
 I DGERR H 4
"RTN","DGPTFVC1",43,0)
 Q
"RTN","DGPTFVC1",44,0)
 ;
"RTN","DGPTFVC1",45,0)
SCI F X=5:1:15 I X#10 S DGPTTMP=$$ICDDX^ICDCODE(+$P(DGNODE,"^",X),$$GETDATE^ICDGTDRG(PTF)) I +DGPTTMP>0&($P(DGPTTMP,U,10)) S:$E($P(DGPTTMP,"^",2),1,5)=DGDX DGSCI=1 Q:DGSCI
"RTN","DGPTFVC1",46,0)
 I 'DGSCI S DGERR=1,%=$P(DGNODE,"^",10),X=$TR($$FMTE^XLFDT(%,"5DF")," ","0") W !,"501 ",X," SCI of ",S0,?23," requires an ICD Diagnosis code beginning with",!?12," or equal to ",DGDX
"RTN","DGPTFVC1",47,0)
 Q
"RTN","DGPTFVC1",48,0)
 ;
"RTN","DGPTFVC1",49,0)
MT S DGVMT=$P(DGV(101),"^",10),DGX=999 G DGX:DGVMT']"" I +$P(DGV(101),"^",2)<2860700!(DGSUFFIX="BU") S DGX="X" G DGX
"RTN","DGPTFVC1",50,0)
 ;S DGZEC=$S($D(^DPT(DFN,.36)):$P(^(.36),U,1),1:""),DGZEC=$S($D(^DIC(8,+DGZEC,0)):^(0),1:"") I $P(DGZEC,U,5)="N" S DGX="N" G DGX
"RTN","DGPTFVC1",51,0)
 S DGZEC=$P($G(^DGPT(PTF,101)),U,8),DGZEC=$S($D(^DIC(8,+DGZEC,0)):^(0),1:"") I $P(DGZEC,U,5)="N" S DGX="N" G DGX
"RTN","DGPTFVC1",52,0)
 S DGT=$P(DGV(701),".") G AS:'$O(^DGMT(408.31,"AD",1,DFN,0)) S DGZ1=$$LST^DGMTU(DFN,DGT) K:DGZ1']"" DGZ1
"RTN","DGPTFVC1",53,0)
 I DGVMT="X" K DGX,DGVMT Q
"RTN","DGPTFVC1",54,0)
 S DGX=$S('$D(DGZ1):"U",1:$P(DGZ1,U,4))
"RTN","DGPTFVC1",55,0)
 ; Determine if the Pending Adjudication is for MT(C) or GMT(G)
"RTN","DGPTFVC1",56,0)
 I DGX="P" D  G DGX
"RTN","DGPTFVC1",57,0)
 . I '+$P($G(DGZ1),U) S DGX="U" Q
"RTN","DGPTFVC1",58,0)
 . S DGX=$$PA^DGMTUTL($P(DGZ1,U)),DGX=$S('$D(DGX):"U",DGX="MT":"C",DGX="GMT":"G",1:"U")
"RTN","DGPTFVC1",59,0)
 ; sc < 50%, 0% non-comp, sc movements - DG*5.3*544
"RTN","DGPTFVC1",60,0)
 I DGX="A",$P(DGZEC,U,4)=3,$$SC^DGMTR(DFN),$$ANYSC^DGPTSCAN(PTF) S DGX="AS" G DGX
"RTN","DGPTFVC1",61,0)
 ;-- sc, >0%  - DG*5.3*544
"RTN","DGPTFVC1",62,0)
 I DGX="A","^1^3^"[("^"_$P(DGZEC,U,4)_"^"),$P($G(^DPT(DFN,.3)),U,2)>0 S DGX="AS" G DGX
"RTN","DGPTFVC1",63,0)
 S DGX=$S(DGX="A":"AN","BCGN"[DGX:DGX,1:"U") G AS:DGX="U" G DGX:DGX'="N"
"RTN","DGPTFVC1",64,0)
AS S DGZ=$S($D(^DPT(DFN,.321)):^(.321),1:0) I $P(DGZ,U,2)="Y"!($P(DGZ,U,3)="Y") S DGX="AS" G DGX
"RTN","DGPTFVC1",65,0)
 S DGZ=$S($D(^DPT(DFN,.322)):^(.322),1:0) I $P(DGZ,U,13)="Y" S DGX="AS" G DGX
"RTN","DGPTFVC1",66,0)
 N DGNTARR S DGZ=$S($$GETCUR^DGNTAPI(DFN,"DGNTARR")>0:DGNTARR("NTR"),1:"") I $P(DGZ,U)="Y" S DGX="AS" G DGX
"RTN","DGPTFVC1",67,0)
 S DGZ=$$GETSTAT^DGMSTAPI(DFN) I $P(DGZ,U,2)="Y" S DGX="AS" G DGX
"RTN","DGPTFVC1",68,0)
 I $P(DGZEC,U,5)="Y",$P(DGZEC,U,4)<4,"^2^15^"'[(U_$P(DGZEC,U,9)_U) S DGX="AS" G DGX
"RTN","DGPTFVC1",69,0)
 S DGX="AN"
"RTN","DGPTFVC1",70,0)
DGX ;DG*5.3*817/Remove 101-Means Test indicator = 'U' xmit block for FEE BASIS PTF 
"RTN","DGPTFVC1",71,0)
 I DGVMT'=DGX,DGVMT'="U" S DGERR=1 W !,"101 ","MEANS TEST",?23," value ",DGVMT,$S(DGVMT']"":"blank",DGVMT="X":" only for admissions prior to 7/1/86 or domicilliary use",1:" inconsistent with eligibility data")
"RTN","DGPTFVC1",72,0)
 K DGZEC,DGZ,DGZ1,DGT,DGX,DGVMT Q
"RTN","DGPTFVC1",73,0)
 ;
"RTN","DGPTFVC1",74,0)
DP I $P(DGV(701),"^",3)'=5 S DGERR=1 W !,"701 ",$E("TYPE OF DISPOSITION",1,18),?23," value inconsistent for discharge"
"RTN","DGPTFVC1",75,0)
OP I $P(DGV(701),"^",4)=1 S DGERR=1 W !,"701 ",$E("OUTPATIENT TREATMENT",1,18),?23," value inconsistent for discharge" Q:DGDP=""
"RTN","DGPTFVC1",76,0)
 I $P(DGV(701),"^",5)=2 S DGERR=1 W !,"701 VA AUSPICES",?23," value inconsistent for discharge"
"RTN","DGPTFVC1",77,0)
 Q
"RTN","DGPTFVC1",78,0)
 ;
"RTN","DGPTFVC1",79,0)
AO I DGPTFMT<2 D  Q
"RTN","DGPTFVC1",80,0)
 .S %=$S($D(^DGPT(PTF,101)):$P(^(101),"^",4),1:"")
"RTN","DGPTFVC1",81,0)
 .S %=$S($D(^DIC(45.82,+%,0)):$P(^(0),"^",1),1:"")
"RTN","DGPTFVC1",82,0)
 .S I=$S($D(^DPT(DFN,.321)):^(.321),1:"")
"RTN","DGPTFVC1",83,0)
 .S:$P(I,"^",2)="Y"&(%'=6) DGERR=1,DGV("E")=1
"RTN","DGPTFVC1",84,0)
 .W:$D(DGV("E")) !,"101 AGENT ORANGE",?23," value ",$S(DGV("E"):"can only be used with COB of '6'",1:"is inconsistent with Vietnam Service and/or COB")
"RTN","DGPTFVC1",85,0)
 ;
"RTN","DGPTFVC1",86,0)
 N AO,AOL,TMP
"RTN","DGPTFVC1",87,0)
 S TMP=$G(^DPT(DFN,.321))
"RTN","DGPTFVC1",88,0)
 S AO=$S($P(TMP,"^",2)="Y":1,1:0)
"RTN","DGPTFVC1",89,0)
 S AOL=$P(TMP,"^",13)
"RTN","DGPTFVC1",90,0)
 Q:('AO)
"RTN","DGPTFVC1",91,0)
 Q:(AOL'="")
"RTN","DGPTFVC1",92,0)
 S DGERR=1,DGV("E")=1
"RTN","DGPTFVC1",93,0)
 W !,"101 AGENT ORANGE LOCATION",?23,"value required if exposure to Agent Orange claimed"
"RTN","DGPTFVC1",94,0)
 Q
"RTN","DGPTFVC1",95,0)
RACETHNC        ;Race and ethnicity check
"RTN","DGPTFVC1",96,0)
 ;Ensure that a value for ethnicity and at least one race is on file.
"RTN","DGPTFVC1",97,0)
 ;Ensure all active race/ethnicity values have a valid PTF value and an
"RTN","DGPTFVC1",98,0)
 ;associated collection method.  Ensure all collection methods have a
"RTN","DGPTFVC1",99,0)
 ;valid PTF value.  Ignore race/ethicity entries that are inactive or
"RTN","DGPTFVC1",100,0)
 ;invalid pointers.  Note: PTF sends first active ethnicity and first
"RTN","DGPTFVC1",101,0)
 ;six active races.
"RTN","DGPTFVC1",102,0)
 N REF,IEN,TYPE,TEXT,PTRVAL,PTRMTHD,NUM,MAX
"RTN","DGPTFVC1",103,0)
 N VALIDVAL,VALIDMTH,VALUE,VADM
"RTN","DGPTFVC1",104,0)
 D DEM^VADPT
"RTN","DGPTFVC1",105,0)
 F REF=11,12 D
"RTN","DGPTFVC1",106,0)
 .I REF=12 D
"RTN","DGPTFVC1",107,0)
 ..S MAX=6
"RTN","DGPTFVC1",108,0)
 ..S TYPE=1
"RTN","DGPTFVC1",109,0)
 ..S VALIDVAL=",3,8,9,A,B,C,D,"
"RTN","DGPTFVC1",110,0)
 ..S VALIDMTH=",S,P,O,U,"
"RTN","DGPTFVC1",111,0)
 ..S TEXT="RACE"
"RTN","DGPTFVC1",112,0)
 .I REF=11 D
"RTN","DGPTFVC1",113,0)
 ..S MAX=1
"RTN","DGPTFVC1",114,0)
 ..S TYPE=2
"RTN","DGPTFVC1",115,0)
 ..S TEXT="ETHNICITY"
"RTN","DGPTFVC1",116,0)
 ..S VALIDVAL=",H,N,D,U,"
"RTN","DGPTFVC1",117,0)
 ..S VALIDMTH=",S,P,O,U,"
"RTN","DGPTFVC1",118,0)
 .S NUM=1
"RTN","DGPTFVC1",119,0)
 .S IEN=0
"RTN","DGPTFVC1",120,0)
 .F  S IEN=+$O(VADM(REF,IEN)) Q:'IEN  D  Q:NUM>MAX
"RTN","DGPTFVC1",121,0)
 ..S PTRVAL=+VADM(REF,IEN)
"RTN","DGPTFVC1",122,0)
 ..S PTRMTHD=+$G(VADM(REF,IEN,1))
"RTN","DGPTFVC1",123,0)
 ..Q:'PTRVAL
"RTN","DGPTFVC1",124,0)
 ..Q:$$INACTIVE^DGUTL4(PTRVAL,TYPE)
"RTN","DGPTFVC1",125,0)
 ..S NUM=NUM+1
"RTN","DGPTFVC1",126,0)
 ..S VALUE=$$PTR2CODE^DGUTL4(PTRVAL,TYPE,4)
"RTN","DGPTFVC1",127,0)
 ..I (VALUE="")!(VALIDVAL'[VALUE) D  Q
"RTN","DGPTFVC1",128,0)
 ...W !,"701 ",TEXT,?23,"missing/invalid xmit value"
"RTN","DGPTFVC1",129,0)
 ...S DGERR=1
"RTN","DGPTFVC1",130,0)
 ..I ('PTRMTHD) D  Q
"RTN","DGPTFVC1",131,0)
 ...W !,"701 ",TEXT,?23,"method of collection missing/invalid"
"RTN","DGPTFVC1",132,0)
 ...S DGERR=1
"RTN","DGPTFVC1",133,0)
 ..S VALUE=$$PTR2CODE^DGUTL4(PTRMTHD,3,4)
"RTN","DGPTFVC1",134,0)
 ..I (VALUE="")!(VALIDMTH'[VALUE) D  Q
"RTN","DGPTFVC1",135,0)
 ...W !,"701 ",TEXT,?23,"missing/invalid xmit value for method of collection"
"RTN","DGPTFVC1",136,0)
 ...S DGERR=1
"RTN","DGPTFVC1",137,0)
 Q
"RTN","DGPTR1")
0^1^B28617663^B29190038
"RTN","DGPTR1",1,0)
DGPTR1 ;ALB/MTC - PTF VERIFICATION ; 01 MAR 91 @0800
"RTN","DGPTR1",2,0)
 ;;5.3;Registration;**58,247,338,342,423,415,565,678,696,729,781,664,817**;Aug 13, 1993;Build 4
"RTN","DGPTR1",3,0)
START S T=$E(Y,2,3),T=$S(T=40&($E(Y,28)="P"):"P40",1:T),ERR=$P($T(@("T"_T)),";;",2,999),W=$P($T(@(T)),";;",2,999),F=31 D L
"RTN","DGPTR1",4,0)
 I T=70 S ERR=$P($T(T701),";;",2,999),W=$P($T(701),";;",2,999),F=72 D L
"RTN","DGPTR1",5,0)
 D @("D"_T) Q
"RTN","DGPTR1",6,0)
 K DGFILL
"RTN","DGPTR1",7,0)
 Q
"RTN","DGPTR1",8,0)
 ;
"RTN","DGPTR1",9,0)
L N DGFOR S DGFOR=$S($$FORIEN^DGADDUTL($P(DG11,U,10))<1:0,1:1) ;set foreign country flag =1, else, set as domestic
"RTN","DGPTR1",10,0)
 F H=1:1 S DGO=$P(W,U,H) Q:'DGO  F Z=1:1:$P(DGO,";",3) S DGL=DGLOGIC(+DGO),X=$E(Y,F) D @("ERR:"_DGL) S F=F+1
"RTN","DGPTR1",11,0)
 Q
"RTN","DGPTR1",12,0)
 ;
"RTN","DGPTR1",13,0)
T10 ;;1:NAME^2:SOURCE OF ADM^3:TRANS FAC.^4:SOURCE OF PAY^5:POW^6:MARITAL ST^7:SEX^8:DOB^9:POS^10:VIETNAM^11:ION RADIATION^12:RESIDENCE^13:MEANS TEST^14:INCOME^15:MST^16:COMBAT VET^17:CV END DT^18:PROJ 112/SHAD^19:ERI^20:COUNTRY
"RTN","DGPTR1",14,0)
 ;
"RTN","DGPTR1",15,0)
T70 ;;1:DT OF DISP.^2:DISCH BD SEC^3:TYPE OF DIS^4:OUT TREAT^5:VA AUS^6:PL OF DIS^7:REC FAC^8:ASIH DAYS^9:NOT USED^10:C&P STAT^11:PDXLS^12:ONLY DX^13:PHY MPCR
"RTN","DGPTR1",16,0)
 ;T701 is part 2 of T70
"RTN","DGPTR1",17,0)
T701 ;;1:PHY SPEC^2:%SC^3:LEGION^4:SUICIDE^5:DRUG^6:AXIS-IV^7:AXIS-V^8:SC^9:EXP^10:MST^11:HNC^12:ETHNICITY^13:RACE^14:COMBAT VET^15:PROJ 112/SHAD
"RTN","DGPTR1",18,0)
 ;
"RTN","DGPTR1",19,0)
T50 ;;1:DT OF MVMT^2:LOSING BD SEC MPCR^3:LOSING BD SEC^4:LEAVE DAYS^5:PASS DAYS^6:SCI^7:DIAG^8:DOCTOR'S SSN^9:PHY MPCR^10:PHY SPEC^11:DISCHARGE STAT^^^^^16:LEGION^17:SUICIDE^18:DRUG^19:AXIS-IV^20:AXIS-V^21:SC^22:EXP^23:MST^24:HNC
"RTN","DGPTR1",20,0)
 ;
"RTN","DGPTR1",21,0)
T53 ;;1:DATE OF PHYSICAL MOVEMENT^2:LOSING PHYSICAL MPCR^3:LOSING PHYSICAL SPECIALTY^4:TR SPECIALTY MPCR^5:TR SPECIALTY^6:LEAVE DAYS^7:PASS DAYS^8:DOCTOR'S SSN (NOT USED)
"RTN","DGPTR1",22,0)
 ;
"RTN","DGPTR1",23,0)
T40 ;;1:DATE OF SURGERY^2:SURG SPEC.^3:CAT CHIEF SURGEON^4:CAT FIRST ASS^5:ANEST. TECH.^6:SOURCE OF PAY^7:OP CODE^8:DOCTOR'S SSN (NOT USED)^^^^^13:TRANSPLANT STATUS
"RTN","DGPTR1",24,0)
 ;
"RTN","DGPTR1",25,0)
TP40 ;;1:OP CODE
"RTN","DGPTR1",26,0)
 ;
"RTN","DGPTR1",27,0)
T60 ;;1:DATE OF PROCEDURE^2:LOSING BD SEC^3:DIALYSIS TYPE^4:NUMBER OF TREATMENTS^5:PROCEDURE CODE
"RTN","DGPTR1",28,0)
 ;
"RTN","DGPTR1",29,0)
LOGIC ;;X'?.N^X'?.A&(X'=" ")^X'=" "^X'?.N&(X'=" ")^X'?.A&(X'=" ")^0^X'?.N&(X'="X")^X'=" "&(X'="P")^X="E"^X="Y"^X=" "^X'="A"&(X'=" ")^(X'?.A)&(X'?.N)&(X'=" ")^(X'?.AN)&('$P(DG0,U,4))^((T1)&(X'=" "))!(('T1)&(X'?.AN)&('$P(DG0,U,4)))
"RTN","DGPTR1",30,0)
 ;;(X'?.AN)^'$D(DGFOR)&(X'?.N)^'$D(DGFOR)&X'?.N&(X'="X")
"RTN","DGPTR1",31,0)
 ;;END
"RTN","DGPTR1",32,0)
 ;
"RTN","DGPTR1",33,0)
 ; edit check# ; edit field ; # x check preformed ; display error name #
"RTN","DGPTR1",34,0)
10 ;;6;;12;1^2;1;1;1^5;1;1;1^1;2;1;2^2;2;1;2^4;3;3;3^6;;3;3^4;4;1;4^6;5;1;5^2;6;1;6^2;7;1;7^1;8;8;8^6;;1;9^11;9;1;9^4;10;1;10^4;10;1;11^17;11;5;12^18;11;5;12^2;12;1;13^6;;1;13^1;;6;14^2;;1;15^1;;1;16^4;;6;17^1;;1;18^5;;1;19^5;;3;20^3;;26
"RTN","DGPTR1",35,0)
 ;
"RTN","DGPTR1",36,0)
70 ;;1;1;10;1^13;2;2;2^1;3;1;3^4;4;1;4^4;5;1;5^6;;1;6^4;7;3;7^6;;3;7^4;8;3;8^6;9;1;9^1;10;1;10^9;11;1;11^11;11;2;11^6;;3;11^10;11;1;11^6;;1;12^15;;6;13
"RTN","DGPTR1",37,0)
 ;701 is part 2 of 70
"RTN","DGPTR1",38,0)
701 ;;15;;2;1^1;;3;2^4;;1;3^4;;1;4^12;;1;5^4;;3;5^4;;1;6^4;;4;7^4;;1;8^5;;3;9^5;;1;10^5;;1;11^13;12;2;12^13;13;12;13^5;;1;14^5;;1;15^3;;16
"RTN","DGPTR1",39,0)
 ;
"RTN","DGPTR1",40,0)
50 ;;1;1;10;1^1;;6;2^16;3;2;3^1;4;3;4^1;5;3;5^6;;1;6^11;7;3;7^6;;32;7^6;;9;8^14;;6;9^14;;2;10^6;;1;11^4;;1;16^4;;1;17^12;;1;18^4;;3;18^4;;1;19^4;;4;20^4;;1;21^5;;3;22^5;;1;23^5;;1;24
"RTN","DGPTR1",41,0)
 ;
"RTN","DGPTR1",42,0)
53 ;;1;;10;1^1;;6;2^13;;2;3^1;;6;4^13;;2;5^1;;3;6^1;;3;7^3;;9;8^3;;54;
"RTN","DGPTR1",43,0)
 ;
"RTN","DGPTR1",44,0)
40 ;;1;1;10;1^1;2;2;2^11;3;1;3^4;4;1;4^6;5;1;5^4;6;1;6^11;7;2;7^6;;3;7^3;7;2;7^6;;5;7^3;7;2;7^6;;5;7^3;7;2;7^6;;5;7^3;7;2;7^6;;5;7^3;7;2;7^3;;9;8^4;;1;13^3;;34;
"RTN","DGPTR1",45,0)
 ;
"RTN","DGPTR1",46,0)
P40 ;;8;;1;^3;;11;^11;1;2;1^6;;3;1^3;1;2;1^6;;5;1^3;;2;1^6;;5;1^3;;2;1^6;;5;1^3;;2;1^6;;5;1^3;;2;1^3;;48
"RTN","DGPTR1",47,0)
 ;
"RTN","DGPTR1",48,0)
60 ;;1;1;10;1^13;2;2;2^4;3;1;3^4;4;3;4^11;5;3;5^6;;32;5^3;;44
"RTN","DGPTR1",49,0)
 ;
"RTN","DGPTR1",50,0)
ERR S DGERR=1
"RTN","DGPTR1",51,0)
 W !,T,$S(T["H":" ",1:$E(Y,4)),"  "
"RTN","DGPTR1",52,0)
 W:"45"[$E(T,1) $E(Y,31,32),"-",$E(Y,33,34),"-",$E(Y,35,36),"@",$E(Y,37,40)
"RTN","DGPTR1",53,0)
 W ?25,$P($P(ERR,U,$P(DGO,";",4)),":",2),?40,"COL.",F,"  VALUE: ",$S($E(Y,F)=" ":"BLANK",1:$E(Y,F))
"RTN","DGPTR1",54,0)
 S I=$S('$D(I):1,I>0:I,1:1),^(I)=$S($D(^UTILITY("DG",$J,T_$S(T["H":"",1:$E(Y,4)),I)):^(I),1:U) I $P(DGO,";",2),^(I)'[(U_$P(DGO,";",2)_U) S ^(I)=^(I)_$P(DGO,";",2)_U
"RTN","DGPTR1",55,0)
 Q
"RTN","DGPTR1",56,0)
 ;
"RTN","DGPTR1",57,0)
D10 I $E(Y,66)="Z" S (F,H)=68,W="11;10;1;10" D L
"RTN","DGPTR1",58,0)
 ;Allow FEE BASIS with means test of U to transmit to Austin - DG*5.3*817
"RTN","DGPTR1",59,0)
 ;I $P(^DGPT(J,0),"^",4),$P(^(0),"^",10)="U",$D(^DGPT(J,70)),+^(70)>2890700 S F=79,DGO="2;12;1;12" D ERR
"RTN","DGPTR1",60,0)
 Q
"RTN","DGPTR1",61,0)
 ;
"RTN","DGPTR1",62,0)
D40 Q
"RTN","DGPTR1",63,0)
DP40 Q
"RTN","DGPTR1",64,0)
D70 I "467"'[$E(Y,43) S F=44,W="4;4;1;4^1;5;1;5^11;6;1;6" D L
"RTN","DGPTR1",65,0)
 Q
"RTN","DGPTR1",66,0)
D50 I "A0"[$P(DG0,U,5)!("A4"[$P(DG0,U,5))!('$D(^DGPT(J,70))) S W="11;6;1;6",F=55 D L
"RTN","DGPTR1",67,0)
 I $D(^DGPT(J,70)),$S(T1:1,1:+^(70)>2871000) S W="11;6;1;6",F=55 D L
"RTN","DGPTR1",68,0)
 I $E(Y,4)=1 S W="9;7;1;7",F=56 D L
"RTN","DGPTR1",69,0)
 I I=1,'T1 S W="1;11;1;11",F=108 D L
"RTN","DGPTR1",70,0)
 Q
"RTN","DGPTR1",71,0)
D53 Q
"RTN","DGPTR1",72,0)
D60 I $E(Y,43) S F=44,W="1;4;3;4" D L
"RTN","DGPTR1",73,0)
 Q
"RTN","DGPTR1",74,0)
HEAD S ERR="1:SSN^2:ADMISSION DATE^3:FACILITY #",W="8;1;1;1^1;1;9;1^1;2;10;2^1;3;3;3^6;;3;3",F=5,T="HEADER" D LOG
"RTN","DGPTR1",75,0)
 D L
"RTN","DGPTR1",76,0)
 Q
"RTN","DGPTR1",77,0)
LOG ;place DGLOGIC in array inorder to add more logic tests ;DG*5.3*664
"RTN","DGPTR1",78,0)
 K DGLOGIC ;S DGLOGIC=$P($T(LOGIC),";;",2)
"RTN","DGPTR1",79,0)
 N LOGX,LOGI,LOGCNT,II,XX
"RTN","DGPTR1",80,0)
 S LOGI=0,LOGCNT=1
"RTN","DGPTR1",81,0)
 F LOGI=0:1 S LOGX=$P($T(LOGIC+LOGI),";;",2) Q:LOGX="END"  F II=1:1 S XX=$P(LOGX,U,II) Q:XX=""  S DGLOGIC(LOGCNT)=XX,LOGCNT=LOGCNT+1
"RTN","DGPTR1",82,0)
 Q
"RTN","DGPTR1",83,0)
CEN S T=70,ERR=$P($T(T70),";;",2),W=$P($T(70),";;",2,999),W="13;9;1;9"_$P(W,"13;9;1;9",2,999),F=56 D L
"RTN","DGPTR1",84,0)
 S ERR=$P($T(T701),";;",2),W=$P($T(701),";;",2,999),F=72 D L
"RTN","DGPTR1",85,0)
 Q
"RTN","DGPTUTL1")
0^2^B30078992^B29888402
"RTN","DGPTUTL1",1,0)
DGPTUTL1 ;ALB/MJK - PTF Utility ;2/1/05 2:20pm
"RTN","DGPTUTL1",2,0)
 ;;5.3;Registration;**33,45,54,517,635,817**;Aug 13, 1993;Build 4
"RTN","DGPTUTL1",3,0)
 ;
"RTN","DGPTUTL1",4,0)
FLAG ; -- select PTF rec to update xmit flags
"RTN","DGPTUTL1",5,0)
 S DGMAX=25
"RTN","DGPTUTL1",6,0)
 W ! S DIC="^DGPT(",DIC(0)="AEMQ",DIC("S")="I '$P(^(0),U,6),$P(^(0),U,11)=1 D CHK^DGPTUTL1 I $D(DGMTY)>9"
"RTN","DGPTUTL1",7,0)
 D ^DIC K DIC G FLAGQ:+Y<0 S (Y,PTF)=+Y D CHK
"RTN","DGPTUTL1",8,0)
 F DGMTY=501,535 I $D(DGMTY(DGMTY)) D UP Q:$D(DGOUT)
"RTN","DGPTUTL1",9,0)
FLAGQ K DGMAX,DGT,DGADM,DGX,DGA1,DGA,DGMTY,C,DGOUT Q
"RTN","DGPTUTL1",10,0)
 ;
"RTN","DGPTUTL1",11,0)
UP ; -- select mvt and update xmit flag
"RTN","DGPTUTL1",12,0)
 ;I DGMTY=501 S DIC="^DGPT("_PTF_",""M"",",DIC("S")="I Y'=1,'$D(^(""P""))"
"RTN","DGPTUTL1",13,0)
 I DGMTY=501 S DIC="^DGPT("_PTF_",""M"",",DIC("S")="I Y'=1"
"RTN","DGPTUTL1",14,0)
 I DGMTY=535 S DIC="^DGPT("_PTF_",535,",DIC("S")="I Y'=1"
"RTN","DGPTUTL1",15,0)
 W ! S DIC(0)="AEMQ" D ^DIC S DIE=DIC K DIC
"RTN","DGPTUTL1",16,0)
 K DGOUT I X["^" S DGOUT=""
"RTN","DGPTUTL1",17,0)
 I +Y<0 G UPQ
"RTN","DGPTUTL1",18,0)
 S DA=+Y,DR=17 D ^DIE K DE,DQ G UP
"RTN","DGPTUTL1",19,0)
UPQ K DIE,DR Q
"RTN","DGPTUTL1",20,0)
 ;
"RTN","DGPTUTL1",21,0)
CHK ;
"RTN","DGPTUTL1",22,0)
 N T1,T2,C K DGMTY S T1=0,T2=9999999
"RTN","DGPTUTL1",23,0)
 F DGMTY=501,535 D 501^DGPTFVC2:DGMTY=501,535^DGPTFVC2:DGMTY=535 S:C>DGMAX DGMTY(DGMTY)=""
"RTN","DGPTUTL1",24,0)
 Q
"RTN","DGPTUTL1",25,0)
 ;
"RTN","DGPTUTL1",26,0)
INCOME ;-- load ptf income information
"RTN","DGPTUTL1",27,0)
 ;   Use discharge date if available; else use current date/time
"RTN","DGPTUTL1",28,0)
 D NOW^%DTC
"RTN","DGPTUTL1",29,0)
 S X=$S($D(^DGPT(PTF,70)):+^(70),1:%),DGX=$S($D(^DGPT(PTF,101)):^(101),1:"")
"RTN","DGPTUTL1",30,0)
 D INC
"RTN","DGPTUTL1",31,0)
 G INQ:Y=$P(DGX,U,7)
"RTN","DGPTUTL1",32,0)
 S DIE="^DGPT(",DA=PTF,DR="101.07////"_Y
"RTN","DGPTUTL1",33,0)
 D ^DIE
"RTN","DGPTUTL1",34,0)
INQ ;
"RTN","DGPTUTL1",35,0)
 K DGX,DGINCM,DIE,DA,DR,DGI,DG30,DG362,DGT,%
"RTN","DGPTUTL1",36,0)
 Q
"RTN","DGPTUTL1",37,0)
 ;
"RTN","DGPTUTL1",38,0)
INC ;-- load income information  Input:X date,Output:Y-income
"RTN","DGPTUTL1",39,0)
 N DGINCM,DGI,DG30,DG362,DGT,DGX
"RTN","DGPTUTL1",40,0)
 I '$D(X) S Y="" G INCQ
"RTN","DGPTUTL1",41,0)
 S Y=+$P($$INCOME^VAFMON(DFN,X),".")
"RTN","DGPTUTL1",42,0)
 I Y<0 S Y=0
"RTN","DGPTUTL1",43,0)
INCQ Q
"RTN","DGPTUTL1",44,0)
 ;
"RTN","DGPTUTL1",45,0)
CHQUES ;-- This function will deterime if the patient has any of the following
"RTN","DGPTUTL1",46,0)
 ;   indicated : AO, IR and EC. If so the array DGEXQ will contain
"RTN","DGPTUTL1",47,0)
 ;     DGEXQ(1)="" - AO
"RTN","DGPTUTL1",48,0)
 ;     DGEXQ(2)="" - IR
"RTN","DGPTUTL1",49,0)
 ;     DGEXQ(3)="" - EC
"RTN","DGPTUTL1",50,0)
 ;   Otherwise they will be undefined.
"RTN","DGPTUTL1",51,0)
 K DGEXQ
"RTN","DGPTUTL1",52,0)
 S DGEXQ(1)="",DGEXQ(2)="",DGEXQ(3)=""
"RTN","DGPTUTL1",53,0)
 Q
"RTN","DGPTUTL1",54,0)
 ;
"RTN","DGPTUTL1",55,0)
SETTRAN ;-- set transmission if error DGOUT=1, will return XMZ
"RTN","DGPTUTL1",56,0)
 K DGXMZ
"RTN","DGPTUTL1",57,0)
 S DGOUTX=0
"RTN","DGPTUTL1",58,0)
 S Y=$S($P(DGD,".",2)=99:DGSD,1:DGD) X ^DD("DD")
"RTN","DGPTUTL1",59,0)
 S XMSUB=Y_"  "_$P(DGRTY0,U)_" TRANSMISSION ",XMDUZ=.5
"RTN","DGPTUTL1",60,0)
 D GET^XMA2
"RTN","DGPTUTL1",61,0)
 I $D(XMZ),XMZ>0 S DGXMZ=XMZ K XMZ G SETQ
"RTN","DGPTUTL1",62,0)
 W !!,"*** ERROR *** Unable to create Mail Message #... Try again later."
"RTN","DGPTUTL1",63,0)
 S DGOUTX=1
"RTN","DGPTUTL1",64,0)
SETQ ;
"RTN","DGPTUTL1",65,0)
 Q
"RTN","DGPTUTL1",66,0)
 ;
"RTN","DGPTUTL1",67,0)
KVAR ; -- clean up for l/e
"RTN","DGPTUTL1",68,0)
 K DA,DFN,A,B,I,ANS,DIE,DR,%,%DT,DGPR,DGREL,DGST,DIC,HEAD,J,K,L,M,MT,NU,PTF,DGPTFE,Y,DGZM0,DGZS0,DOB,L1,PT,SEX,AGE,CC,DAM,DOB,DXLS,EXP,NOR,NO,DRG,DRGCAL,DGZSUR,S1,SUR,M1,MOV,P,P1
"RTN","DGPTUTL1",69,0)
 K DGDX,DGER,DGI,DGINFO,DGLOS,DGNXD,DGP,DGPAS,DGPSV,DGTLOS,DGTY,DIS2,DGJUMP,DGPRD,DGPC,DGDRGNM,DGMOVM,DR,DGQWK,ST1,DGX,DQ,TY,DGRTY,DGRTY0,DGPTFMT,DG,DGA1,DGDC,DGNEXT,RC,DP,POP,DGICD0,DGPROCD,DGPROCI,DGPROCM,DGVAR,DGAD
"RTN","DGPTUTL1",70,0)
 K TAC,TRS,SD,PD,MDC,NDR,NSD,OR,ORG,T,DGZDIAG,DGZPRO,DGZSER,J1,I1,L2,L3,L4,L5,L6,PM,DGFC,S,M2,PROC,SU,ST,NL,DGDD,SD1,D,DFN,DFN1,DFN2,D0,P2,S2,X,DGNUM,DGN,DGERR,DGVI,DGVO,Z,Z1,DGZ,DGADM,DGNODE,^UTILITY($J),DGCFL
"RTN","DGPTUTL1",71,0)
 K DGPM2X,DGPMDA,DGPMDCD,DGPMVI,DGAMY,VAERR,VAIP,DGPTSCRN,DGREC,DGHOLD,DG300,DG300A,DG300B,DG701,DGBPC,DGPTIT,DGMOV,DGSUR
"RTN","DGPTUTL1",72,0)
 K M3,DGLAST,DGMVT
"RTN","DGPTUTL1",73,0)
 Q
"RTN","DGPTUTL1",74,0)
 ;
"RTN","DGPTUTL1",75,0)
ELIG ; shows eligibility and disabilities
"RTN","DGPTUTL1",76,0)
 D ELIG^VADPT W #,!,"Eligibility: "_$P(VAEL(1),"^",2)_$S(+VAEL(3):"     SC%: "_$P(VAEL(3),"^",2),1:"")
"RTN","DGPTUTL1",77,0)
 W !,"Disabilities: " F I=0:0 S I=$O(^DPT(DFN,.372,I)) Q:'I  S I1=$S($D(^DPT(DFN,.372,I,0)):^(0),1:"") D:+I1
"RTN","DGPTUTL1",78,0)
 .S PSDIS=$S($P($G(^DIC(31,+I1,0)),"^")]""&($P($G(^(0)),"^",4)']""):$P(^(0),"^"),$P($G(^DIC(31,+I1,0)),"^",4)]"":$P(^(0),"^",4),1:""),PSCNT=$P(I1,"^",2)
"RTN","DGPTUTL1",79,0)
 .W:$L(PSDIS_"-"_PSCNT_"% ("_$S($P(I1,"^",3):"SC",1:"NSC")_"), ")+$X>80 !,?15
"RTN","DGPTUTL1",80,0)
 .W $S($G(PSDIS)]"":PSDIS_"-",1:"")_PSCNT_"% ("_$S($P(I1,"^",3):"SC",1:"NSC")_"), "
"RTN","DGPTUTL1",81,0)
 .I $Y>22 W !,"PRESS RETURN TO CONTINUE:" R X:DTIME W #
"RTN","DGPTUTL1",82,0)
 Q
"RTN","DGPTUTL1",83,0)
DATE ;EDIT CPT DATE/TIME TO BE AFTER ADMISSION DATE BUT BEFORE DISCHARGE
"RTN","DGPTUTL1",84,0)
 I X<$P(^DGPT(DA(1),0),U,2) W !,"Not before admission" K X Q
"RTN","DGPTUTL1",85,0)
 I $G(^(70)),X>^(70) W !,"Not after discharge" K X Q
"RTN","DGPTUTL1",86,0)
 S I=0 F  S I=$O(^DGPT(PTF,"C",I)) Q:I'>0  I X=+^(I,0) W !,"Cannot change to existing CPT date/time entry" K X Q
"RTN","DGPTUTL1",87,0)
 Q
"RTN","DGPTUTL1",88,0)
SETABX ;SET AB CROSSREFERENCE IN FILE 45
"RTN","DGPTUTL1",89,0)
 G KILLABX:$P($G(^DGPT(DA(1),"C",DA,0)),U,7)
"RTN","DGPTUTL1",90,0)
 N BOOL S (DGCPT,BOOL)=0
"RTN","DGPTUTL1",91,0)
 F  S DGCPT=$O(^DGCPT(46,"C",DA(1),DGCPT)) Q:'DGCPT  D  Q:BOOL
"RTN","DGPTUTL1",92,0)
 .S BOOL='$G(^DGCPT(46,DGCPT,9))
"RTN","DGPTUTL1",93,0)
 I 'BOOL K ^DGPT("AB",$E(X,1,30),DA(1),DA)
"RTN","DGPTUTL1",94,0)
 S ^DGPT("AB",$E(X,1,30),DA(1),DA)="" Q
"RTN","DGPTUTL1",95,0)
KILLABX ;KILL AB CROSSREFERENCE IN FILE 45
"RTN","DGPTUTL1",96,0)
 G SETABX:'$P($G(^DGPT(DA(1),"C",DA,0)),U,7)
"RTN","DGPTUTL1",97,0)
 K ^DGPT("AB",$E(X,1,30),DA(1),DA) Q
"RTN","DGPTUTL1",98,0)
DISP F I=1:1:$P(DGZPRF,U,3) D
"RTN","DGPTUTL1",99,0)
 .S Y=+DGZPRF(I) D D^DGPTUTL W !,I,?5,Y
"RTN","DGPTUTL1",100,0)
 Q
"RTN","DGPTUTL1",101,0)
HELP W !,"Enter '^' to stop display and edit of data,"
"RTN","DGPTUTL1",102,0)
 W !,"'^N' to jump to screen #N (appears in upper right of screen as"
"RTN","DGPTUTL1",103,0)
 W " <N>),",!,"a number to jump to that number 801 screen,"
"RTN","DGPTUTL1",104,0)
 W " ?? to list the 801 screens,"
"RTN","DGPTUTL1",105,0)
 W !,"<RET> to continue on to next screen or A-B to edit:"
"RTN","DGPTUTL1",106,0)
 W !?10,"A-Professional service information",!,?10,"B-Procedure codes",!,"You may also enter any combination of the above, separated by commas (ex:A,B)",! Q
"RTN","DGPTUTL1",107,0)
CPT ;DISPLAY CPT CODES AND MODIFIERS
"RTN","DGPTUTL1",108,0)
 S CPT=+DGZPRF(J,K),N=$$CPT^ICPTCOD(CPT,$$GETDATE^ICDGTDRG(PTF)),N=$S(N>0:$P(N,U,2,99),1:"")
"RTN","DGPTUTL1",109,0)
 W $P(N,U),"  ",$P(N,U,2)
"RTN","DGPTUTL1",110,0)
 F I=1,2 S MOD=$P(DGZPRF(J,K),U,I+1) D MOD:MOD
"RTN","DGPTUTL1",111,0)
 W !,?7,"Quantity: ",$P(DGZPRF(J,K),U,14) K I,MOD,N Q
"RTN","DGPTUTL1",112,0)
MOD S N=$$MOD^ICPTMOD(MOD,"I",$$GETDATE^ICDGTDRG(PTF)) W !,?7,"CPT Modifier ",I,":",$P(N,U,2)," ",$P(N,U,3)
"RTN","DGPTUTL1",113,0)
 Q
"VER")
8.0^22.0
"BLD",8271,6)
^732
**END**
**END**
