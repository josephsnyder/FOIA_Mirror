EMERGENCY Released DG*5.3*778 SEQ #688
Extracted from mail message
**KIDS**:DG*5.3*778^

**INSTALL NAME**
DG*5.3*778
"BLD",7374,0)
DG*5.3*778^REGISTRATION^0^3080326^y
"BLD",7374,4,0)
^9.64PA^^
"BLD",7374,6.3)
9
"BLD",7374,"ABNS",0)
^9.66A^^
"BLD",7374,"ABPKG")
n^n
"BLD",7374,"KRN",0)
^9.67PA^8989.52^19
"BLD",7374,"KRN",.4,0)
.4
"BLD",7374,"KRN",.401,0)
.401
"BLD",7374,"KRN",.402,0)
.402
"BLD",7374,"KRN",.403,0)
.403
"BLD",7374,"KRN",.5,0)
.5
"BLD",7374,"KRN",.84,0)
.84
"BLD",7374,"KRN",3.6,0)
3.6
"BLD",7374,"KRN",3.8,0)
3.8
"BLD",7374,"KRN",9.2,0)
9.2
"BLD",7374,"KRN",9.8,0)
9.8
"BLD",7374,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",7374,"KRN",9.8,"NM",1,0)
DGCV^^0^B50348592
"BLD",7374,"KRN",9.8,"NM","B","DGCV",1)

"BLD",7374,"KRN",19,0)
19
"BLD",7374,"KRN",19.1,0)
19.1
"BLD",7374,"KRN",101,0)
101
"BLD",7374,"KRN",409.61,0)
409.61
"BLD",7374,"KRN",771,0)
771
"BLD",7374,"KRN",870,0)
870
"BLD",7374,"KRN",8989.51,0)
8989.51
"BLD",7374,"KRN",8989.52,0)
8989.52
"BLD",7374,"KRN",8994,0)
8994
"BLD",7374,"KRN","B",.4,.4)

"BLD",7374,"KRN","B",.401,.401)

"BLD",7374,"KRN","B",.402,.402)

"BLD",7374,"KRN","B",.403,.403)

"BLD",7374,"KRN","B",.5,.5)

"BLD",7374,"KRN","B",.84,.84)

"BLD",7374,"KRN","B",3.6,3.6)

"BLD",7374,"KRN","B",3.8,3.8)

"BLD",7374,"KRN","B",9.2,9.2)

"BLD",7374,"KRN","B",9.8,9.8)

"BLD",7374,"KRN","B",19,19)

"BLD",7374,"KRN","B",19.1,19.1)

"BLD",7374,"KRN","B",101,101)

"BLD",7374,"KRN","B",409.61,409.61)

"BLD",7374,"KRN","B",771,771)

"BLD",7374,"KRN","B",870,870)

"BLD",7374,"KRN","B",8989.51,8989.51)

"BLD",7374,"KRN","B",8989.52,8989.52)

"BLD",7374,"KRN","B",8994,8994)

"BLD",7374,"QUES",0)
^9.62^^
"BLD",7374,"REQB",0)
^9.611^1^1
"BLD",7374,"REQB",1,0)
DG*5.3*673^2
"BLD",7374,"REQB","B","DG*5.3*673",1)

"MBREQ")
0
"PKG",47,-1)
1^1
"PKG",47,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",47,20,0)
^9.402P^^
"PKG",47,22,0)
^9.49I^1^1
"PKG",47,22,1,0)
5.3^2930813^2960613
"PKG",47,22,1,"PAH",1,0)
778^3080326
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","DGCV")
0^1^B50348592^B35316058
"RTN","DGCV",1,0)
DGCV ;ALB/DW,ERC,BRM,TMK - COMBAT VET ELIGIBILTY; 10/15/05 ; 3/24/08 7:28am
"RTN","DGCV",2,0)
 ;;5.3;Registration;**528,576,564,673,778**; Aug 13, 1993;Build 9
"RTN","DGCV",3,0)
 ;
"RTN","DGCV",4,0)
CVELIG(DFN) ;
"RTN","DGCV",5,0)
 ;API will determine whether or not this veteran needs to have CV End
"RTN","DGCV",6,0)
 ;Date set.  If this determination cannot be done due to imprecise
"RTN","DGCV",7,0)
 ;or missing dates, it returns which dates need editing.
"RTN","DGCV",8,0)
 ;Input:
"RTN","DGCV",9,0)
 ;  DFN - Patient file IEN
"RTN","DGCV",10,0)
 ;Output
"RTN","DGCV",11,0)
 ;  RESULT
"RTN","DGCV",12,0)
 ;    0 - CV End Date should not be set
"RTN","DGCV",13,0)
 ;    1 - CV End Date should be set
"RTN","DGCV",14,0)
 ;  If critical dates are imprecise return the following
"RTN","DGCV",15,0)
 ;    A - CV End Date should not be set, imprecise Service Sep date
"RTN","DGCV",16,0)
 ;    B - CV End Date should not be set, imprecise Combat To date
"RTN","DGCV",17,0)
 ;    C - CV End Date should not be set, imprecise Yugoslavia To date
"RTN","DGCV",18,0)
 ;    D - CV End Date should not be set, imprecise Somalia To date
"RTN","DGCV",19,0)
 ;    E - CV End Date should not be set, imprecise Pers Gulf To date
"RTN","DGCV",20,0)
 ;  If the Service Sep Date is missing, and there are no OEF/OIF/UNKNOWN
"RTN","DGCV",21,0)
 ;    OEF/OIF records on file, return the following so that it  will
"RTN","DGCV",22,0)
 ;    appear on the Imprecise/Missing Date Report
"RTN","DGCV",23,0)
 ;    F - missing Service Sep Date & no OEF OIF or OEF/OIF Unknown dates
"RTN","DGCV",24,0)
 ;  If critical dates are missing but the corresponding indicator fields
"RTN","DGCV",25,0)
 ;    are set to 'YES' return the following
"RTN","DGCV",26,0)
 ;    G - missing Combat To Date, but Combat Indicated? = 'Yes'
"RTN","DGCV",27,0)
 ;    H - missing PG To Date, but PG Indicated? = 'Yes'
"RTN","DGCV",28,0)
 ;    I - missing Somalia To Date, but Somalia Indicator = 'Yes'
"RTN","DGCV",29,0)
 ;    J - missing Yugoslavia To Date, but Yugoslavia Indicator = 'Yes'
"RTN","DGCV",30,0)
 ;
"RTN","DGCV",31,0)
 N DG1,DG2,I,RESULT
"RTN","DGCV",32,0)
 N DGCOM,DGCVDT,DGCVFLG,DGGULF,DGSOM,DGSRV,DGYUG,DGOEIF
"RTN","DGCV",33,0)
 S (DG1,DG2,RESULT)=0
"RTN","DGCV",34,0)
 I $G(DFN)']"" Q RESULT
"RTN","DGCV",35,0)
 I '$D(^DPT(DFN)) Q RESULT
"RTN","DGCV",36,0)
 ;
"RTN","DGCV",37,0)
 ;get combat related data from top-level VistA fields
"RTN","DGCV",38,0)
 N DGARR,DGERR
"RTN","DGCV",39,0)
 D GETS^DIQ(2,DFN_",",".327;.322012;.322018;.322021;.5294;.5295","I","DGARR","DGERR")
"RTN","DGCV",40,0)
 D PARSE
"RTN","DGCV",41,0)
 ;
"RTN","DGCV",42,0)
 S DG1=$$CHKSSD(DFN) ;check SSD for imprecise or missing
"RTN","DGCV",43,0)
 S DGDATE=$G(DGCOM)_"^"_$G(DGYUG)_"^"_$G(DGSOM)_"^"_$G(DGGULF)_"^"_$G(DGOEIF)
"RTN","DGCV",44,0)
 ;
"RTN","DGCV",45,0)
 I $S(DG1="F":1,1:$P(DGDATE,U,5)>$G(DGSRV)) D
"RTN","DGCV",46,0)
 . ; Use OIF/OEF/UNKNOWN OEF/OIF to dt only when SSD missing or SSD less
"RTN","DGCV",47,0)
 . ; than OIF/OEF/UNKNOWN OEF/OIF to dt
"RTN","DGCV",48,0)
 . N DGSRV,Z
"RTN","DGCV",49,0)
 . S DGSRV=$P(DGDATE,U,5),Z=$$CHKSSD(DFN)
"RTN","DGCV",50,0)
 . I Z=1 S DG1=Z
"RTN","DGCV",51,0)
 ;
"RTN","DGCV",52,0)
 S DG2=$$CHKREST(DGDATE,$G(DGSRV)) ;check other "TO" dates for imprecise, missing or invalid
"RTN","DGCV",53,0)
 S RESULT=$$RES(DG1,$G(DG2))
"RTN","DGCV",54,0)
 Q RESULT
"RTN","DGCV",55,0)
 ;
"RTN","DGCV",56,0)
RES(DG1,DG2) ;determine the final RESULT code from DG1 & DG2
"RTN","DGCV",57,0)
 ;if SSD evaluates to earlier than 11/11/98, can't set CV End Date
"RTN","DGCV",58,0)
 I DG1=0!($G(DG2)=0) Q 0
"RTN","DGCV",59,0)
 ;if SSD is 1
"RTN","DGCV",60,0)
 I DG1=1,($G(DG2)=1!($G(DG2)']"")) Q 1
"RTN","DGCV",61,0)
 I DG1=1,($G(DG2)=0) Q 0
"RTN","DGCV",62,0)
 I DG1=1 Q DG2
"RTN","DGCV",63,0)
 ;if SSD is imprecise or missing
"RTN","DGCV",64,0)
 I DG1'=1,($G(DG2)=1) S DG2=""
"RTN","DGCV",65,0)
 Q DG1_DG2
"RTN","DGCV",66,0)
 ;
"RTN","DGCV",67,0)
CHKDATE(DGDATE,I,SSD) ;check to see if date is imprecise or missing
"RTN","DGCV",68,0)
 ;if imprecise check to see if the imprecision prevents CV evaluation
"RTN","DGCV",69,0)
 ;if not imprecise check to see if after 11/11/98
"RTN","DGCV",70,0)
 ; Note that SSD doesn't appear to ever be used here (TMK)
"RTN","DGCV",71,0)
 N RES
"RTN","DGCV",72,0)
 S RES=0
"RTN","DGCV",73,0)
 I $G(DGDATE)']"",I'=5 D  Q RES
"RTN","DGCV",74,0)
 . S RES=$S(I=0:"F",I=1:"G",I=2:"H",I=3:"I",I=4:"J",1:"")
"RTN","DGCV",75,0)
 I $E(DGDATE,6,7)="00" D
"RTN","DGCV",76,0)
 . I I=0 I DGDATE>2981111 S RES="A" Q
"RTN","DGCV",77,0)
 . I DGDATE=2980000!(DGDATE=2981100) D  Q
"RTN","DGCV",78,0)
 .. ; Note OIF/OEF/UNKNOWN OEF/OIF will not get here as these dates by
"RTN","DGCV",79,0)
 .. ; definition are after 11/11/98
"RTN","DGCV",80,0)
 . . S RES=$S(I=0:"A",I=1:"B",I=2:"C",I=3:"D",I=4:"E",1:"")
"RTN","DGCV",81,0)
 Q:RES="A" RES
"RTN","DGCV",82,0)
 I DGDATE>2981111 S RES=1
"RTN","DGCV",83,0)
 Q RES
"RTN","DGCV",84,0)
 ;
"RTN","DGCV",85,0)
SETCV(DFN,DGSRV) ;calculate CV end date
"RTN","DGCV",86,0)
 ;    DGSRV is the most recent of the Service Separation Date 
"RTN","DGCV",87,0)
 ;    or the OEF/OIF To Date, called from file #2 new style 
"RTN","DGCV",88,0)
 ;    cross reference "ACVCOM"
"RTN","DGCV",89,0)
 N DGCVEDT,DGFDA,DGNDAA,DGPLUS3,DGTMPDT,DGYRS
"RTN","DGCV",90,0)
 S DGNDAA=3080128
"RTN","DGCV",91,0)
 I $G(DFN)']""!($G(DGSRV)']"") Q
"RTN","DGCV",92,0)
 I '$D(^DPT(DFN)) Q
"RTN","DGCV",93,0)
 I $$GET1^DIQ(2,DFN_",",.5295,"I") Q
"RTN","DGCV",94,0)
 D CVRULES(DFN,DGSRV,.DGYRS)
"RTN","DGCV",95,0)
 Q:$G(DGYRS)'=3&($G(DGYRS)'=5)
"RTN","DGCV",96,0)
 ;NDAA legislation, enacted 1/28/08, gives vets discharged
"RTN","DGCV",97,0)
 ;on or after 1/28/03 (2 years previously) CV Eligibility 
"RTN","DGCV",98,0)
 ;for 5 years.  Vets discharged before 1/28/03 get eligibility 
"RTN","DGCV",99,0)
 ;for 3 years after enactment (or until 1/27/2011) DG*5.3*778
"RTN","DGCV",100,0)
 S DGTMPDT=$S(DGYRS=3:DGNDAA,1:DGSRV)
"RTN","DGCV",101,0)
 S DGCVEDT=($E(DGTMPDT,1,3)+DGYRS)_$E(DGTMPDT,4,7)
"RTN","DGCV",102,0)
 S DGCVEDT=$$FMADD^XLFDT(DGCVEDT,-1)
"RTN","DGCV",103,0)
 S DGFDA(2,DFN_",",.5295)=DGCVEDT
"RTN","DGCV",104,0)
 D FILE^DIE(,"DGFDA")
"RTN","DGCV",105,0)
 Q
"RTN","DGCV",106,0)
 ;
"RTN","DGCV",107,0)
CVRULES(DFN,DGSRV,DGYRS) ;apply rules for the CV End Date
"RTN","DGCV",108,0)
 ;extension project - DG*5.3*778
"RTN","DGCV",109,0)
 ;DGSRV - most recent of Service Sep Date or OEIUUF to date
"RTN","DGCV",110,0)
 ;   DGYRS = 3 years from NDAA or 1/27/2011
"RTN","DGCV",111,0)
 ;         = 5 years from SSD or Enrollment App Date
"RTN","DGCV",112,0)
 ;determine how many years extra CV eligibility to give
"RTN","DGCV",113,0)
 N DGCIEN,DGCUTOFF,DGENRDT,DGPIEN,DGPRI,DGQT,DGSTAT
"RTN","DGCV",114,0)
 ;determine if veteran has an enrollment record prior
"RTN","DGCV",115,0)
 ;to 1/28/2008 (the NDAA date) and no CV End Date for
"RTN","DGCV",116,0)
 ;this enrollment
"RTN","DGCV",117,0)
 S DGYRS=5
"RTN","DGCV",118,0)
 S (DGPRI,DGQT)=0
"RTN","DGCV",119,0)
 S DGCUTOFF=3030128
"RTN","DGCV",120,0)
 S DGCIEN=$$FINDCUR^DGENA(DFN)
"RTN","DGCV",121,0)
 I $G(DGCIEN),($D(^DGEN(27.11,DGCIEN,0)))]"" D
"RTN","DGCV",122,0)
 . S DGENRDT=$$GET1^DIQ(27.11,DGCIEN_",",75.01,"I") Q:$G(DGENRDT)']""
"RTN","DGCV",123,0)
 . I $P(DGENRDT,".",1)<DGNDAA S DGPRI=1 Q
"RTN","DGCV",124,0)
 . I DGENRDT'<DGNDAA D
"RTN","DGCV",125,0)
 . . S DGPIEN=DGCIEN
"RTN","DGCV",126,0)
 . . F  S DGPIEN=$$FINDPRI^DGENA(DGPIEN) Q:'DGPIEN  D  Q:DGQT
"RTN","DGCV",127,0)
 . . . S DGENRDT=$$GET1^DIQ(27.11,DGPIEN_",",75.01,"I")
"RTN","DGCV",128,0)
 . . . Q:$G(DGENRDT)']""
"RTN","DGCV",129,0)
 . . . I $P(DGENRDT,".",1)<DGNDAA S (DGPRI,DGQT)=1
"RTN","DGCV",130,0)
 ;if DGPRI=1, then there is an enrollment prior to 1/28/08
"RTN","DGCV",131,0)
 I DGPRI=1 D  Q
"RTN","DGCV",132,0)
 . I $G(DGCIEN)]"" S DGSTAT=$$GET1^DIQ(27.11,DGCIEN_",",.04,"E")
"RTN","DGCV",133,0)
 . I $G(DGSTAT)["INITIAL APPLICATION BY VAMC"!($G(DGSTAT)["BELOW ENROLLMENT GROUP THRESHOLD") D
"RTN","DGCV",134,0)
 . . I DGSRV<DGCUTOFF S DGYRS=3
"RTN","DGCV",135,0)
 ;
"RTN","DGCV",136,0)
 ;if no enrollment prior to 1/28/08 (DGPRI=0) check service date
"RTN","DGCV",137,0)
 ;against cutoff date - 1/28/03
"RTN","DGCV",138,0)
 I DGSRV<DGCUTOFF S DGYRS=3
"RTN","DGCV",139,0)
 Q
"RTN","DGCV",140,0)
 ;
"RTN","DGCV",141,0)
CVEDT(DFN,DGDT) ;Provide Combat Vet Eligibility End Date, if eligible
"RTN","DGCV",142,0)
 ;Supported DBIA #4156
"RTN","DGCV",143,0)
 ;Input:  DFN - Patient file IEN
"RTN","DGCV",144,0)
 ;        DGDT - Treatment date (optional), 
"RTN","DGCV",145,0)
 ;               DT is default
"RTN","DGCV",146,0)
 ;Output :RESULT=(1,0,-1)^End Date (if populated, otherwise null)^CV
"RTN","DGCV",147,0)
 ;               Eligible on DGDT(1,0)^is patient eligible on input date?
"RTN","DGCV",148,0)
 ;      (piece 1)  1 - qualifies as a CV
"RTN","DGCV",149,0)
 ;                 0 - does not qualify as a CV
"RTN","DGCV",150,0)
 ;                -1 - bad DFN or date
"RTN","DGCV",151,0)
 ;      (piece 3)  1 - vet was eligible on date specified (or DT)      
"RTN","DGCV",152,0)
 ;                 0 - vet was not eligible on date specified (or DT)
"RTN","DGCV",153,0)
 ;
"RTN","DGCV",154,0)
 N RESULT
"RTN","DGCV",155,0)
 S RESULT=""
"RTN","DGCV",156,0)
 I $G(DFN)="" Q -1
"RTN","DGCV",157,0)
 I '$D(^DPT(DFN)) Q -1
"RTN","DGCV",158,0)
 ;if time sent in, drop time
"RTN","DGCV",159,0)
 I $G(DGDT)']"" S DGDT=DT
"RTN","DGCV",160,0)
 I DGDT?7N1"."1.6N S DGDT=$E(DGDT,1,7)
"RTN","DGCV",161,0)
 I DGDT'?7N Q -1
"RTN","DGCV",162,0)
 S RESULT=$$GET1^DIQ(2,DFN_",",.5295,"I")
"RTN","DGCV",163,0)
 I $G(RESULT)']"" Q 0
"RTN","DGCV",164,0)
 S RESULT=$S(DGDT'>RESULT:RESULT_"^1",1:RESULT_"^0") ; if treatment date is earlier or equal to end date, veteran is eligible
"RTN","DGCV",165,0)
 S RESULT=$S($G(RESULT):1_"^"_RESULT,1:0)
"RTN","DGCV",166,0)
 Q RESULT
"RTN","DGCV",167,0)
 ;
"RTN","DGCV",168,0)
PARSE ;GETS^DIQ called in CVELIG - in this subroutine stuff results into array
"RTN","DGCV",169,0)
 S DGSRV=$G(DGARR(2,DFN_",",.327,"I"))
"RTN","DGCV",170,0)
 S DGCOM=$G(DGARR(2,DFN_",",.5294,"I")) ;Combat To Date
"RTN","DGCV",171,0)
 S DGGULF=$G(DGARR(2,DFN_",",.322012,"I")) ;Persian Gulf To Date
"RTN","DGCV",172,0)
 S DGSOM=$G(DGARR(2,DFN_",",.322018,"I")) ;Somalia To Date
"RTN","DGCV",173,0)
 S DGYUG=$G(DGARR(2,DFN_",",.322021,"I")) ;Yugoslavia To Date
"RTN","DGCV",174,0)
 S DGCVDT=$G(DGARR(2,DFN_",",.5295,"I")) ;CV End Date
"RTN","DGCV",175,0)
 ; get last OIF/OEF/UNKNOWN OEF/OIF episode from multiple
"RTN","DGCV",176,0)
 S DGOEIF=$P($$LAST^DGENOEIF(DFN),U)
"RTN","DGCV",177,0)
 Q
"RTN","DGCV",178,0)
 ;
"RTN","DGCV",179,0)
CHKSSD(DFN) ;check the Serv Sep Date [Last]
"RTN","DGCV",180,0)
 ; DGSRV=last SSD
"RTN","DGCV",181,0)
 ;  Output - RESULT
"RTN","DGCV",182,0)
 ;    1 - Date is present and after 11/11/1998
"RTN","DGCV",183,0)
 ;    0 - Date is present but before 11/11/1998
"RTN","DGCV",184,0)
 ;    A - Date is imprecise & either is or potentially is after 11/11/98
"RTN","DGCV",185,0)
 ;    F - Date is missing
"RTN","DGCV",186,0)
 N DG1
"RTN","DGCV",187,0)
 I $G(DGSRV)']"" Q "F"
"RTN","DGCV",188,0)
 S DG1=$$CHKDATE(DGSRV,0)
"RTN","DGCV",189,0)
 I $G(DG1)']"" S DG1=0
"RTN","DGCV",190,0)
 Q DG1
"RTN","DGCV",191,0)
 ;
"RTN","DGCV",192,0)
CHKREST(DGDATE,SSD) ;
"RTN","DGCV",193,0)
 ; SSD = optional, = to the last serv sep date
"RTN","DGCV",194,0)
 N DG3,DG4,DGDT,DGFLG,DGLEN,DGQ,DGR,DGRES,DGX
"RTN","DGCV",195,0)
 S (DG3,DG4,DGR,DGRES)=""
"RTN","DGCV",196,0)
 S DGQ=0 ;loop terminator
"RTN","DGCV",197,0)
 S DGFLG=0 ;flag to indicate that one of the dates is missing (no 
"RTN","DGCV",198,0)
 ;          need to check this for OIF/OEF/UNKNOWN OEF/OIF since
"RTN","DGCV",199,0)
 ;          by definition, these must always be post 11/11/98)
"RTN","DGCV",200,0)
 F DGX=1:1:5 D
"RTN","DGCV",201,0)
 . S DGDT=$P(DGDATE,U,DGX) D
"RTN","DGCV",202,0)
 . . I DGX'=5,$G(DGDT)']"" S DGFLG=1
"RTN","DGCV",203,0)
 . . S DG4=$$CHKDATE(DGDT,DGX,$G(SSD))
"RTN","DGCV",204,0)
 . . I $G(DG4)'=0 S DG3=$G(DG3)_$G(DG4)
"RTN","DGCV",205,0)
 S DGLEN=$L(DG3)
"RTN","DGCV",206,0)
 S DGQ=0
"RTN","DGCV",207,0)
 F DGX=1:1:DGLEN S DGCHAR=$E(DG3,DGX) D  Q:DGQ=1
"RTN","DGCV",208,0)
 . I DGCHAR=1 S DG3=DGCHAR,DGQ=1 Q
"RTN","DGCV",209,0)
 . I "BCDE"[DGCHAR S DGR=DGR_DGCHAR,DGQ=2
"RTN","DGCV",210,0)
 I DGQ=1 Q 1
"RTN","DGCV",211,0)
 I DGQ=2 Q $E(DGR)
"RTN","DGCV",212,0)
 I DGFLG=1 S DGRES=$$MISS(DFN,DGLEN,DG3)
"RTN","DGCV",213,0)
 Q DGRES
"RTN","DGCV",214,0)
 ;
"RTN","DGCV",215,0)
MISS(DFN,DGLEN,DGRES) ;there is at least one missing date, and in order to 
"RTN","DGCV",216,0)
 ;return a RESULT of a missing date, need to check to see if the 
"RTN","DGCV",217,0)
 ;corresponding indicator field is set to 'YES'
"RTN","DGCV",218,0)
 N DGARR,DGCHAR,DGERR,DGQ,DGR,DGX
"RTN","DGCV",219,0)
 N DGCIND,DGPGIND,DGSIND,DGYIND
"RTN","DGCV",220,0)
 S (DGCHAR,DGQ,DGR)=0
"RTN","DGCV",221,0)
 D GETS^DIQ(2,DFN_",",".32201;.322019;.322016;.5291","I","DGARR","DGERR")
"RTN","DGCV",222,0)
 S DGCIND=$G(DGARR(2,DFN_",",.5291,"I")) ;Combat Service Indicated
"RTN","DGCV",223,0)
 S DGYIND=$G(DGARR(2,DFN_",",.322019,"I")) ;Yugo service indicated
"RTN","DGCV",224,0)
 S DGSIND=$G(DGARR(2,DFN_",",.322016,"I")) ;Somalia service indicated
"RTN","DGCV",225,0)
 S DGPGIND=$G(DGARR(2,DFN_",",.32201,"I")) ;Pers Gulf service indicated
"RTN","DGCV",226,0)
 F DGX=1:1:DGLEN S DGCHAR=$E(DGRES,DGX) D  Q:DGQ=1
"RTN","DGCV",227,0)
 . I DGCHAR="G",($G(DGCIND)="Y") S DGR="G",DGQ=1 Q
"RTN","DGCV",228,0)
 . I DGCHAR="H",($G(DGYIND)="Y") S DGR="H",DGQ=1 Q
"RTN","DGCV",229,0)
 . I DGCHAR="I",($G(DGSIND)="Y") S DGR="I",DGQ=1 Q
"RTN","DGCV",230,0)
 . I DGCHAR="J",($G(DGPGIND)="Y") S DGR="J"
"RTN","DGCV",231,0)
 Q DGR
"RTN","DGCV",232,0)
DELCV(DFN) ;called by the Kill logic of the ACVCOM cross reference
"RTN","DGCV",233,0)
 ;if $$CVELIG^DGCV returns a 0 the CV End Date should be deleted
"RTN","DGCV",234,0)
 ;because this would indicate that fields have been changed and
"RTN","DGCV",235,0)
 ;CV eligibility is no longer appropriate
"RTN","DGCV",236,0)
 ;
"RTN","DGCV",237,0)
 N DGCV,DGFDA
"RTN","DGCV",238,0)
 K DGCVFLG
"RTN","DGCV",239,0)
 S DGCVFLG=0
"RTN","DGCV",240,0)
 I $G(DFN)']"" Q
"RTN","DGCV",241,0)
 I '$D(^DPT(DFN)) Q
"RTN","DGCV",242,0)
 S DGCV=$$GET1^DIQ(2,DFN_",",.5295,"I")
"RTN","DGCV",243,0)
 I $G(DGCV)']"" Q
"RTN","DGCV",244,0)
 S DGCVFLG=1
"RTN","DGCV",245,0)
 S DGFDA(2,DFN_",",.5295)="@"
"RTN","DGCV",246,0)
 D FILE^DIE(,"DGFDA")
"RTN","DGCV",247,0)
 Q
"VER")
8.0^22.0
"BLD",7374,6)
^688
**END**
**END**
