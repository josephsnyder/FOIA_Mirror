Released DG*5.3*799 SEQ #731
Extracted from mail message
**KIDS**:DG*5.3*799^

**INSTALL NAME**
DG*5.3*799
"BLD",7489,0)
DG*5.3*799^REGISTRATION^0^3090805^y
"BLD",7489,1,0)
^^2^2^3090723^
"BLD",7489,1,1,0)
Modifications to Patient Registration to prevent the 'Edit a Means Test'
"BLD",7489,1,2,0)
prompt if the on file MT belongs to another site.
"BLD",7489,4,0)
^9.64PA^^
"BLD",7489,6.3)
1
"BLD",7489,"ABPKG")
n
"BLD",7489,"KRN",0)
^9.67PA^779.2^20
"BLD",7489,"KRN",.4,0)
.4
"BLD",7489,"KRN",.401,0)
.401
"BLD",7489,"KRN",.402,0)
.402
"BLD",7489,"KRN",.403,0)
.403
"BLD",7489,"KRN",.5,0)
.5
"BLD",7489,"KRN",.84,0)
.84
"BLD",7489,"KRN",3.6,0)
3.6
"BLD",7489,"KRN",3.8,0)
3.8
"BLD",7489,"KRN",9.2,0)
9.2
"BLD",7489,"KRN",9.8,0)
9.8
"BLD",7489,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",7489,"KRN",9.8,"NM",1,0)
DGMTU^^0^B56504667
"BLD",7489,"KRN",9.8,"NM","B","DGMTU",1)

"BLD",7489,"KRN",19,0)
19
"BLD",7489,"KRN",19.1,0)
19.1
"BLD",7489,"KRN",101,0)
101
"BLD",7489,"KRN",409.61,0)
409.61
"BLD",7489,"KRN",771,0)
771
"BLD",7489,"KRN",779.2,0)
779.2
"BLD",7489,"KRN",870,0)
870
"BLD",7489,"KRN",8989.51,0)
8989.51
"BLD",7489,"KRN",8989.52,0)
8989.52
"BLD",7489,"KRN",8994,0)
8994
"BLD",7489,"KRN","B",.4,.4)

"BLD",7489,"KRN","B",.401,.401)

"BLD",7489,"KRN","B",.402,.402)

"BLD",7489,"KRN","B",.403,.403)

"BLD",7489,"KRN","B",.5,.5)

"BLD",7489,"KRN","B",.84,.84)

"BLD",7489,"KRN","B",3.6,3.6)

"BLD",7489,"KRN","B",3.8,3.8)

"BLD",7489,"KRN","B",9.2,9.2)

"BLD",7489,"KRN","B",9.8,9.8)

"BLD",7489,"KRN","B",19,19)

"BLD",7489,"KRN","B",19.1,19.1)

"BLD",7489,"KRN","B",101,101)

"BLD",7489,"KRN","B",409.61,409.61)

"BLD",7489,"KRN","B",771,771)

"BLD",7489,"KRN","B",779.2,779.2)

"BLD",7489,"KRN","B",870,870)

"BLD",7489,"KRN","B",8989.51,8989.51)

"BLD",7489,"KRN","B",8989.52,8989.52)

"BLD",7489,"KRN","B",8994,8994)

"BLD",7489,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",7489,"QUES",0)
^9.62^^
"BLD",7489,"REQB",0)
^9.611^1^1
"BLD",7489,"REQB",1,0)
DG*5.3*783^2
"BLD",7489,"REQB","B","DG*5.3*783",1)

"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813
"PKG",5,22,1,"PAH",1,0)
799^3090805
"PKG",5,22,1,"PAH",1,1,0)
^^2^2^3090805
"PKG",5,22,1,"PAH",1,1,1,0)
Modifications to Patient Registration to prevent the 'Edit a Means Test'
"PKG",5,22,1,"PAH",1,1,2,0)
prompt if the on file MT belongs to another site.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","DGMTU")
0^1^B56504667^B54863290
"RTN","DGMTU",1,0)
DGMTU ;ALB/RMO,LBD,BRM,EG - Means Test Utilities ; 02/08/2005 07:10 AM
"RTN","DGMTU",2,0)
 ;;5.3;Registration;**4,33,182,277,290,374,358,420,426,411,332,433,456,476,519,451,630,783,799**;Aug 13, 1993;Build 1
"RTN","DGMTU",3,0)
 ;MT=Means Test
"RTN","DGMTU",4,0)
LST(DFN,DGDT,DGMTYPT) ;Last MT for a patient
"RTN","DGMTU",5,0)
 ;         Input  -- DFN   Patient IEN
"RTN","DGMTU",6,0)
 ;                   DGDT  Date/Time  (Optional- default today@2359)
"RTN","DGMTU",7,0)
 ;                DGMTYPT  Type of Test (Optional - if not defined 
"RTN","DGMTU",8,0)
 ;                                       Means Test will be assumed)
"RTN","DGMTU",9,0)
 ;         Output -- Annual Means Test IEN^Date of Test
"RTN","DGMTU",10,0)
 ;                   ^Status Name^Status Code^Source of Test
"RTN","DGMTU",11,0)
 N DGIDT,DGMTFL1,DGMTI,DGNOD,Y I '$D(DGMTYPT) S DGMTYPT=1
"RTN","DGMTU",12,0)
 S DGIDT=$S($G(DGDT)>0:-DGDT,1:-DT) S:'$P(DGIDT,".",2) DGIDT=DGIDT_.2359
"RTN","DGMTU",13,0)
 F  S DGIDT=+$O(^DGMT(408.31,"AID",DGMTYPT,DFN,DGIDT)) Q:'DGIDT!$G(DGMTFL1)  D
"RTN","DGMTU",14,0)
 .F DGMTI=0:0 S DGMTI=+$O(^DGMT(408.31,"AID",DGMTYPT,DFN,DGIDT,DGMTI)) Q:'DGMTI!$G(DGMTFL1)  D
"RTN","DGMTU",15,0)
 ..S DGNOD=$G(^DGMT(408.31,DGMTI,0)) I DGNOD,$G(^("PRIM"))!(DGMTYPT=4) S DGMTFL1=1,Y=DGMTI_"^"_$P(^(0),"^")_"^"_$$MTS(DFN,+$P(^(0),"^",3))_"^"_$P(DGNOD,"^",23) ; chk for primary MT
"RTN","DGMTU",16,0)
 Q $G(Y)
"RTN","DGMTU",17,0)
 ;
"RTN","DGMTU",18,0)
LVMT(DFN,DGDT) ;Last valid MT (status other than required)
"RTN","DGMTU",19,0)
 ;          Input  -- DFN    Patient IEN
"RTN","DGMTU",20,0)
 ;                    DGDT   Date (Optional - default today)
"RTN","DGMTU",21,0)
 ;          Output -- Annual Means Test IEN^Date of Test^Status Name
"RTN","DGMTU",22,0)
 ;                     ^Status Code
"RTN","DGMTU",23,0)
 N DGMT,DGMTL
"RTN","DGMTU",24,0)
 S:'$D(DGDT) DGDT=DT S DGMTL=$$LST^DGMTU(DFN,DGDT)
"RTN","DGMTU",25,0)
 I $P(DGMTL,"^",4)="R" F  S DGMT=$$LST^DGMTU(DFN,DGDT) Q:DGMT']""!($P(DGMT,U,4)'="R")  S DGDT=$P(DGMT,U,2)-1
"RTN","DGMTU",26,0)
 Q $S($G(DGMT)]"":DGMT,1:$G(DGMTL))
"RTN","DGMTU",27,0)
 ;
"RTN","DGMTU",28,0)
NVMT(DFN,DGDT) ;Next valid MT (status other than required)
"RTN","DGMTU",29,0)
 ;          Input  -- DFN    Patient IEN
"RTN","DGMTU",30,0)
 ;                    DGDT   Date (Required)
"RTN","DGMTU",31,0)
 ;          Output -- Annual Means Test IEN^Date of Test^Status Name
"RTN","DGMTU",32,0)
 ;                     ^Status Code
"RTN","DGMTU",33,0)
 N DGDTE,DGMT,DGMT0,DGMTI,DGMTPR,DGMTS
"RTN","DGMTU",34,0)
 S DGDTE=DGDT
"RTN","DGMTU",35,0)
 F  S DGDTE=$O(^DGMT(408.31,"AD",1,DFN,DGDTE)) Q:'DGDTE!$G(DGMT)  D
"RTN","DGMTU",36,0)
 .F DGMTI=0:0 S DGMTI=$O(^DGMT(408.31,"AD",1,DFN,DGDTE,DGMTI)) Q:'DGMTI  S DGMT0=$G(^DGMT(408.31,DGMTI,0)),DGMTS=+$P(DGMT0,"^",3),DGMTPR=$G(^("PRIM")) I +DGMT0,DGMTS'=1,DGMTPR S DGMT=DGMTI_"^"_+DGMT0_"^"_$$MTS^DGMTU(DFN,DGMTS) Q
"RTN","DGMTU",37,0)
 Q $G(DGMT)
"RTN","DGMTU",38,0)
 ;
"RTN","DGMTU",39,0)
MTS(DFN,DGMTS) ;MT status -- default current
"RTN","DGMTU",40,0)
 ;         Input  -- DFN    Patient IEN
"RTN","DGMTU",41,0)
 ;                   DGMTS  Means Test Status IEN  (Optional)
"RTN","DGMTU",42,0)
 ;         Output -- Status Name^Status Code
"RTN","DGMTU",43,0)
 N Y
"RTN","DGMTU",44,0)
 S DGMTS=$S($G(DGMTS)>0:DGMTS,1:$P($G(^DPT(DFN,0)),"^",14))
"RTN","DGMTU",45,0)
 I DGMTS S Y=$P($G(^DG(408.32,DGMTS,0)),"^",1,2)
"RTN","DGMTU",46,0)
 Q $G(Y)
"RTN","DGMTU",47,0)
 ;
"RTN","DGMTU",48,0)
DIS(DFN) ;Display patients current MT status,
"RTN","DGMTU",49,0)
 ;        eligibility for care, deductible information,
"RTN","DGMTU",50,0)
 ;        date of test and date of completion
"RTN","DGMTU",51,0)
 ;         Input  -- DFN    Patient IEN
"RTN","DGMTU",52,0)
 ;         Output -- None
"RTN","DGMTU",53,0)
 N DGCS,DGDED,DGMTI,DGMT0
"RTN","DGMTU",54,0)
 S DGCS=$P($G(^DPT(DFN,0)),"^",14) G DISQ:DGCS=""
"RTN","DGMTU",55,0)
 S DGMTI=+$$LST^DGMTU(DFN),DGMT0=$G(^DGMT(408.31,DGMTI,0))
"RTN","DGMTU",56,0)
 S MTSIG=$P(DGMT0,"^",29)
"RTN","DGMTU",57,0)
 W !,"Means Test Signed?: ",$S(MTSIG=1:"YES",MTSIG=0:"NO",MTSIG=9:"DELETED",1:"")
"RTN","DGMTU",58,0)
 I DGCS=1 W !!,"Patient Requires a Means Test"
"RTN","DGMTU",59,0)
 I DGCS=2 W !!,"Patient's Means Test is Pending Adjudication for "_$$PA^DGMTUTL(DGMTI)
"RTN","DGMTU",60,0)
 I DGCS=3 W !!,"Means Test Not Required"
"RTN","DGMTU",61,0)
 I ("^4^5^6^16^")[("^"_DGCS_"^") W !!,"Patient's status is ",$$GETNAME^DGMTH(DGCS)," based on primary means test"
"RTN","DGMTU",62,0)
 I $D(^DG(408.32,DGCS,"MSG")) W !,^("MSG")
"RTN","DGMTU",63,0)
 I DGCS=6 S DGDED=$P(DGMT0,"^",11) W ! W:DGDED]"" "Has",$S(DGDED:"",1:" not")," agreed to pay the deductible"
"RTN","DGMTU",64,0)
 S Y=$P(DGMT0,"^") X ^DD("DD") W !,"Primary Means Test ",$S(DGCS=1:"Required from",1:"Last Applied")," '",Y,"'"
"RTN","DGMTU",65,0)
 I ("^2^4^5^6^16^")[("^"_DGCS_"^") S Y=$P(DGMT0,"^",7) X ^DD("DD") W " (COMPLETED: ",Y,")"
"RTN","DGMTU",66,0)
 I DGCS=3 S Y=$P(DGMT0,"^",17) X ^DD("DD") W " (NO LONGER REQUIRED: ",Y,")"
"RTN","DGMTU",67,0)
DISQ Q
"RTN","DGMTU",68,0)
 ;
"RTN","DGMTU",69,0)
EDT(DFN,DGDT) ;Display patients current MT information and provide
"RTN","DGMTU",70,0)
 ;        the user with the option of proceeding with a required
"RTN","DGMTU",71,0)
 ;        MT or editing an existing means test
"RTN","DGMTU",72,0)
 ;         Input  -- DFN    Patient IEN
"RTN","DGMTU",73,0)
 ;                   DGDT   Date/Time
"RTN","DGMTU",74,0)
 ;         Output -- None
"RTN","DGMTU",75,0)
 ;
"RTN","DGMTU",76,0)
 ; obtain lock used to synchronize local MT/CT options with income test upload
"RTN","DGMTU",77,0)
 N VSITE
"RTN","DGMTU",78,0)
 I $$LOCK^DGMTUTL(DFN)
"RTN","DGMTU",79,0)
 ;
"RTN","DGMTU",80,0)
 D DIS(DFN)
"RTN","DGMTU",81,0)
 S DGMTI=+$$LST(DFN,DGDT),VSITE=+$P($$SITE^VASITE(),U,3)
"RTN","DGMTU",82,0)
 G EDTQ:'DGMTI!(DGMTI'=+$$LST^DGMTU(DFN))
"RTN","DGMTU",83,0)
 I $P($G(^DGMT(408.31,DGMTI,2)),U,5)'=VSITE G EDTQ ; Test doesn't belong to site
"RTN","DGMTU",84,0)
 S DGMT0=$G(^DGMT(408.31,DGMTI,0)),DGMTDT=+DGMT0,DGMTS=$P(DGMT0,"^",3)
"RTN","DGMTU",85,0)
 S DIR("A")="Do you wish to "_$S(DGMTS=1:"proceed with",1:"edit")_" the means test at this time"
"RTN","DGMTU",86,0)
 S DIR("B")=$S(DGMTS&($D(DGPRFLG)):"NO",DGMTS=1:"YES",1:"NO"),DIR(0)="Y"
"RTN","DGMTU",87,0)
 W ! D ^DIR G EDTQ:$D(DTOUT)!($D(DUOUT))
"RTN","DGMTU",88,0)
 I Y S DGMTYPT=1,DGMTACT="EDT",DGMTROU="EDTQ^DGMTU" G EN^DGMTSC
"RTN","DGMTU",89,0)
EDTQ K DGMT0,DGMTACT,DGMTDT,DGMTI,DGMTROU,DGMTS,DIR,DTOUT,DUOUT,Y
"RTN","DGMTU",90,0)
 ;
"RTN","DGMTU",91,0)
 ; release lock
"RTN","DGMTU",92,0)
 D UNLOCK^DGMTUTL(DFN)
"RTN","DGMTU",93,0)
 ;
"RTN","DGMTU",94,0)
 Q
"RTN","DGMTU",95,0)
 ;
"RTN","DGMTU",96,0)
CMTS(DFN) ;Get Current MT Status - query HEC if necessary
"RTN","DGMTU",97,0)
 ;
"RTN","DGMTU",98,0)
 ;        Input: DFN=patient ien
"RTN","DGMTU",99,0)
 ;       Output: MT IEN^Date of Test^Status Name
"RTN","DGMTU",100,0)
 ;                 ^Status Code^Source of Test
"RTN","DGMTU",101,0)
 ;
"RTN","DGMTU",102,0)
 N X,Y,DGMTDATA,DGQSENT,DGDOD,NODE0,DGRET,DGMFLG,DGTAG,DGMTYPT
"RTN","DGMTU",103,0)
 D CHKPT^DGMTU4(DFN)
"RTN","DGMTU",104,0)
 S DGMTYPT=1,DGMTDATA=$$LST(DFN,"",DGMTYPT)
"RTN","DGMTU",105,0)
 ;Next line checks to see if patient has expired, if so, Query not initiated
"RTN","DGMTU",106,0)
 S DGDOD=$P($G(^DPT(DFN,.35)),U)
"RTN","DGMTU",107,0)
 I +DGDOD Q DGMTDATA
"RTN","DGMTU",108,0)
 ;Next line checks to see if current test exists, if not, Query not initiated 
"RTN","DGMTU",109,0)
 I '$G(DGMTDATA) Q DGMTDATA
"RTN","DGMTU",110,0)
 D:+$$QFLG(DGMTDATA)
"RTN","DGMTU",111,0)
 .I $G(IVMZ10)'="UPLOAD IN PROGRESS",'$$OPEN^IVMCQ2(DFN),'$$SENT^IVMCQ2(DFN),$G(DGMFLG)'=0 D
"RTN","DGMTU",112,0)
 ..I $$LOCK^DGMTUTL(DFN)
"RTN","DGMTU",113,0)
 ..D QRYQUE2^IVMCQ2(DFN,$G(DUZ),0,$G(XQY)) S DGQSENT=1
"RTN","DGMTU",114,0)
 ..I '$D(ZTQUEUED),'$G(DGMSGF),$G(DGQSENT) W !!,"Financial query queued to be sent to HEC...",! H .5
"RTN","DGMTU",115,0)
 ..D UNLOCK^DGMTUTL(DFN)
"RTN","DGMTU",116,0)
 .S DGMTDATA=$$LST(DFN,"",DGMTYPT)
"RTN","DGMTU",117,0)
 D:+$$MFLG(DGMTDATA)
"RTN","DGMTU",118,0)
 .S DGMFLG=$$MFLG(DGMTDATA)
"RTN","DGMTU",119,0)
 .S DGTAG=$S(DGMFLG=1:"MSG"_DGMFLG,DGMFLG=2:"MSG"_DGMFLG,1:0)
"RTN","DGMTU",120,0)
 .I DGTAG["MSG",'$G(DGMSGF) D @DGTAG
"RTN","DGMTU",121,0)
 Q DGMTDATA   ;return most current MT data
"RTN","DGMTU",122,0)
MFLG(DGMTDATA) ;Set up appropriate informational message flag for user's
"RTN","DGMTU",123,0)
 ;benefit.
"RTN","DGMTU",124,0)
 ;Input        -     DGMTDATA as defined by $$LST function.
"RTN","DGMTU",125,0)
 ;Output       -     DGRETV
"RTN","DGMTU",126,0)
 ;     1 = Current Test is REQUIRED
"RTN","DGMTU",127,0)
 ;     2 = Test is > 365 days old and is in a status of
"RTN","DGMTU",128,0)
 ;         other than REQUIRED or NO LONGER REQUIRED
"RTN","DGMTU",129,0)
 ;     2 = Pend Adj for GMT, test date is 10/6/99 or
"RTN","DGMTU",130,0)
 ;         greater and agreed to the deductible
"RTN","DGMTU",131,0)
 ;     0 = CAT C/Pend Adj for MT, test date is 10/6/99
"RTN","DGMTU",132,0)
 ;         or greater and agreed to the deductible.
"RTN","DGMTU",133,0)
 ; OR  0 = Cat C, declined income info and agreed
"RTN","DGMTU",134,0)
 ;         to pay deductible.
"RTN","DGMTU",135,0)
 ; OR  0 = Has a future dated Means Test
"RTN","DGMTU",136,0)
 N DGRETV,FTST,DGMT0
"RTN","DGMTU",137,0)
 S DGRETV=0 I '$G(DGMTDATA) Q DGRETV
"RTN","DGMTU",138,0)
 S DGMT0=$G(^DGMT(408.31,+DGMTDATA,0))
"RTN","DGMTU",139,0)
 I $P(DGMTDATA,U,4)="R" S DGRETV=1
"RTN","DGMTU",140,0)
 I $$OLD^DGMTU4($P(DGMTDATA,U,2)),($P(DGMTDATA,U,4)'="N")&($P(DGMTDATA,U,4)'="R") S DGRETV=2
"RTN","DGMTU",141,0)
 I ($P(DGMTDATA,U,4)="C")!($P(DGMTDATA,U,4)="P"&($P(DGMT0,U,12)'<$P(DGMT0,U,27))),$P(DGMTDATA,U,2)>2991005,$P(DGMT0,U,11)=1 S DGRETV=0
"RTN","DGMTU",142,0)
 I ($P(DGMTDATA,U,4)="C"),+$P(DGMT0,U,14),+$P(DGMT0,U,11) S DGRETV=0
"RTN","DGMTU",143,0)
 D DOM^DGMTR I $G(DGDOM) S DGRETV=0
"RTN","DGMTU",144,0)
 S FTST=$$FUT(DFN)
"RTN","DGMTU",145,0)
 I DGRETV,FTST,$P(^DGMT(408.31,+FTST,0),U,19)=1 S DGRETV=0
"RTN","DGMTU",146,0)
 Q DGRETV
"RTN","DGMTU",147,0)
MSG1 ;Informational message 1
"RTN","DGMTU",148,0)
 N NODE0,Y
"RTN","DGMTU",149,0)
 S NODE0=$G(^DGMT(408.31,+DGMTDATA,0))
"RTN","DGMTU",150,0)
 W !!,$C(7),?15,"*** Patient Requires a Means Test ***",!
"RTN","DGMTU",151,0)
 S Y=$P(NODE0,U) X ^DD("DD") W !,?14,"Primary Means Test Required from "_Y,!
"RTN","DGMTU",152,0)
 I $G(IOST)["C-" R !!,"Enter <RETURN> to continue.",DGRET:DTIME
"RTN","DGMTU",153,0)
 Q
"RTN","DGMTU",154,0)
MSG2 ;Informational message 2
"RTN","DGMTU",155,0)
 N NODE0,Y
"RTN","DGMTU",156,0)
 S NODE0=$G(^DGMT(408.31,+DGMTDATA,0))
"RTN","DGMTU",157,0)
 W !!,$C(7),?17,"*** Patient Requires a Means Test ***",!
"RTN","DGMTU",158,0)
 S Y=$P(NODE0,U) X ^DD("DD") W !,?10,"Patient's Test dated "_Y_" is "_$P(DGMTDATA,U,3)_"."_" The test"
"RTN","DGMTU",159,0)
 W !,?10,"date is greater than 365 days old.  Please update."
"RTN","DGMTU",160,0)
 I $G(IOST)["C-" R !!,"Enter <RETURN> to continue.",DGRET:DTIME
"RTN","DGMTU",161,0)
 Q
"RTN","DGMTU",162,0)
QFLG(DGMTDATA) ;
"RTN","DGMTU",163,0)
 ;INPUT - DGMTDATA
"RTN","DGMTU",164,0)
 ;OUTPUT- IVMQFLG 1 if query is necessary 0 if not
"RTN","DGMTU",165,0)
 N IVMQFLG,DGMT0
"RTN","DGMTU",166,0)
 S IVMQFLG=0 I '$G(DGMTDATA) Q IVMQFLG
"RTN","DGMTU",167,0)
 S DGMT0=$G(^DGMT(408.31,+DGMTDATA,0))
"RTN","DGMTU",168,0)
 ;Set flag to 1 if Means test is Required.
"RTN","DGMTU",169,0)
 I $P(DGMTDATA,U,4)="R" S IVMQFLG=1
"RTN","DGMTU",170,0)
 ;Set flag to 1 if Means test older than 365 days and status is not
"RTN","DGMTU",171,0)
 ;NO LONGER REQUIRED and not REQUIRED.
"RTN","DGMTU",172,0)
 I $$OLD^DGMTU4($P(DGMTDATA,U,2)),($P(DGMTDATA,U,4)'="N")&($P(DGMTDATA,U,4)'="R") S IVMQFLG=1
"RTN","DGMTU",173,0)
 ;If Cat C/Pend Adj for MT, older than 365 days, agreed to pay, test
"RTN","DGMTU",174,0)
 ;date > 10/5/99 reset flag to 0 - no query is necessary.
"RTN","DGMTU",175,0)
 I ($P(DGMTDATA,U,4)="C")!($P(DGMTDATA,U,4)="P"&($P(DGMT0,U,12)'<$P(DGMT0,U,27))),$P(DGMTDATA,U,2)>2991005,$P(DGMT0,U,11)=1 S IVMQFLG=0
"RTN","DGMTU",176,0)
 ;If patient is Cat C, declined to provide income but has agreed to
"RTN","DGMTU",177,0)
 ;pay deductible, no query necessary - reset flag to 0
"RTN","DGMTU",178,0)
 I ($P(DGMTDATA,U,4)="C"),+$P(DGMT0,U,14),+$P(DGMT0,U,11) S DGRETV=0
"RTN","DGMTU",179,0)
 ;If patient is on a DOM ward, don't initiate query
"RTN","DGMTU",180,0)
 D DOM^DGMTR I $G(DGDOM) S IVMQFLG=0
"RTN","DGMTU",181,0)
 Q IVMQFLG
"RTN","DGMTU",182,0)
 ;
"RTN","DGMTU",183,0)
FUT(DFN,DGDT,DGMTYPT) ; Future MT for a patient
"RTN","DGMTU",184,0)
 ;DFN      Patient IEN
"RTN","DGMTU",185,0)
 ;DGDT     Date (Optional- default to today)
"RTN","DGMTU",186,0)
 ;DGMTYPT  Type of Test (Optional - default to MT)
"RTN","DGMTU",187,0)
 ;Return
"RTN","DGMTU",188,0)
 ;If a DCD test was performed it will be returned, else the
"RTN","DGMTU",189,0)
 ;current future dated test for the Income Year.
"RTN","DGMTU",190,0)
 ;MT IEN^Date of Test^Status Name^Status Code^Source
"RTN","DGMTU",191,0)
 ;
"RTN","DGMTU",192,0)
 N DGIDT,Y,MTIEN,SRCE,DONE,MTNOD,ARR,LAST,TYPTST
"RTN","DGMTU",193,0)
 S:'$D(DGMTYPT) DGMTYPT=1
"RTN","DGMTU",194,0)
 ;no future LTC eg 02/15/2005
"RTN","DGMTU",195,0)
 I ($G(DGMTYPT)=4) Q ""
"RTN","DGMTU",196,0)
 S TYPTST=$S(DGMTYPT=2:"AF",1:"AE")
"RTN","DGMTU",197,0)
 S DGIDT=$S($G(DGDT)>0:DGDT,1:DT),DONE=0
"RTN","DGMTU",198,0)
 S (ARR,LAST,Y)=""
"RTN","DGMTU",199,0)
 S:$P(DGIDT,".",2) DGIDT=$P(DGIDT,".")
"RTN","DGMTU",200,0)
 F  S DGIDT=$O(^IVM(301.5,TYPTST,DFN,DGIDT)) Q:'DGIDT!(DONE)  D
"RTN","DGMTU",201,0)
 .S MTIEN=0
"RTN","DGMTU",202,0)
 .F  S MTIEN=$O(^IVM(301.5,TYPTST,DFN,DGIDT,MTIEN)) Q:'MTIEN!(DONE)  D
"RTN","DGMTU",203,0)
 ..Q:'$D(^DGMT(408.31,MTIEN,0))
"RTN","DGMTU",204,0)
 ..S MTNOD=^DGMT(408.31,MTIEN,0),SRCE=$P(MTNOD,U,23)
"RTN","DGMTU",205,0)
 ..I SRCE'=1 S DONE=1,Y=MTIEN_U_$P(MTNOD,U)_U_$$MTS^DGMTU(DFN,+$P(MTNOD,U,3))_U_$P(MTNOD,U,23) Q
"RTN","DGMTU",206,0)
 ..I 'DONE,'$D(ARR($P(MTNOD,U),MTIEN)) S ARR($P(MTNOD,U),MTIEN)=MTIEN_U_$P(MTNOD,U)_U_$$MTS^DGMTU(DFN,+$P(MTNOD,U,3))_U_$P(MTNOD,U,23)
"RTN","DGMTU",207,0)
 I 'DONE S LAST=$O(ARR(""),-1) I LAST S Y=ARR(LAST,$O(ARR(LAST,""),-1))
"RTN","DGMTU",208,0)
 Q $G(Y)
"VER")
8.0^22.0
"BLD",7489,6)
^731
**END**
**END**
