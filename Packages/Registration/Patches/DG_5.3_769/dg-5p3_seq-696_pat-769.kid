Released DG*5.3*769 SEQ #696
Extracted from mail message
**KIDS**:DG*5.3*769^

**INSTALL NAME**
DG*5.3*769
"BLD",7480,0)
DG*5.3*769^REGISTRATION^0^3080319^y
"BLD",7480,1,0)
^^2^2^3071031^
"BLD",7480,1,1,0)
  This patch addresses issues regarding the patient sensitivity/security
"BLD",7480,1,2,0)
check, and the check for same last name and last 4 digits of SSN.
"BLD",7480,4,0)
^9.64PA^^
"BLD",7480,6)
1^
"BLD",7480,6.3)
2
"BLD",7480,"INI")

"BLD",7480,"INIT")
DG53P769
"BLD",7480,"KRN",0)
^9.67PA^8989.52^19
"BLD",7480,"KRN",.4,0)
.4
"BLD",7480,"KRN",.401,0)
.401
"BLD",7480,"KRN",.402,0)
.402
"BLD",7480,"KRN",.403,0)
.403
"BLD",7480,"KRN",.5,0)
.5
"BLD",7480,"KRN",.84,0)
.84
"BLD",7480,"KRN",3.6,0)
3.6
"BLD",7480,"KRN",3.8,0)
3.8
"BLD",7480,"KRN",9.2,0)
9.2
"BLD",7480,"KRN",9.8,0)
9.8
"BLD",7480,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",7480,"KRN",9.8,"NM",1,0)
DPTLK^^0^B66931183
"BLD",7480,"KRN",9.8,"NM",2,0)
DGSEC^^0^B42705118
"BLD",7480,"KRN",9.8,"NM",3,0)
DG53P769^^0^B239808
"BLD",7480,"KRN",9.8,"NM","B","DG53P769",3)

"BLD",7480,"KRN",9.8,"NM","B","DGSEC",2)

"BLD",7480,"KRN",9.8,"NM","B","DPTLK",1)

"BLD",7480,"KRN",19,0)
19
"BLD",7480,"KRN",19.1,0)
19.1
"BLD",7480,"KRN",101,0)
101
"BLD",7480,"KRN",409.61,0)
409.61
"BLD",7480,"KRN",771,0)
771
"BLD",7480,"KRN",870,0)
870
"BLD",7480,"KRN",8989.51,0)
8989.51
"BLD",7480,"KRN",8989.52,0)
8989.52
"BLD",7480,"KRN",8994,0)
8994
"BLD",7480,"KRN","B",.4,.4)

"BLD",7480,"KRN","B",.401,.401)

"BLD",7480,"KRN","B",.402,.402)

"BLD",7480,"KRN","B",.403,.403)

"BLD",7480,"KRN","B",.5,.5)

"BLD",7480,"KRN","B",.84,.84)

"BLD",7480,"KRN","B",3.6,3.6)

"BLD",7480,"KRN","B",3.8,3.8)

"BLD",7480,"KRN","B",9.2,9.2)

"BLD",7480,"KRN","B",9.8,9.8)

"BLD",7480,"KRN","B",19,19)

"BLD",7480,"KRN","B",19.1,19.1)

"BLD",7480,"KRN","B",101,101)

"BLD",7480,"KRN","B",409.61,409.61)

"BLD",7480,"KRN","B",771,771)

"BLD",7480,"KRN","B",870,870)

"BLD",7480,"KRN","B",8989.51,8989.51)

"BLD",7480,"KRN","B",8989.52,8989.52)

"BLD",7480,"KRN","B",8994,8994)

"BLD",7480,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",7480,"QUES",0)
^9.62^^
"BLD",7480,"REQB",0)
^9.611^2^2
"BLD",7480,"REQB",1,0)
DG*5.3*582^1
"BLD",7480,"REQB",2,0)
DG*5.3*647^1
"BLD",7480,"REQB","B","DG*5.3*582",1)

"BLD",7480,"REQB","B","DG*5.3*647",2)

"INIT")
DG53P769
"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
5.3^2930813
"PKG",5,22,1,"PAH",1,0)
769^3080319^100850
"PKG",5,22,1,"PAH",1,1,0)
^^2^2^3080319
"PKG",5,22,1,"PAH",1,1,1,0)
  This patch addresses issues regarding the patient sensitivity/security
"PKG",5,22,1,"PAH",1,1,2,0)
check, and the check for same last name and last 4 digits of SSN.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","DG53P769")
0^3^B239808^n/a
"RTN","DG53P769",1,0)
DG53P769 ;ALB/JAT DELETE RECORDS ;5/10/07
"RTN","DG53P769",2,0)
 ;;5.3;Registration;**769**;Aug 13, 1993;Build 2
"RTN","DG53P769",3,0)
 ;; resets from ^DD(2,0,"ACT")="I '$G(DICR),$G(DIC(0))'[""I"" D ^DGSEC"
"RTN","DG53P769",4,0)
 ;
"RTN","DG53P769",5,0)
 S ^DD(2,0,"ACT")="I $G(DIC(0))'[""I"" D ^DGSEC"
"RTN","DG53P769",6,0)
 Q
"RTN","DGSEC")
0^2^B42705118^B41818093
"RTN","DGSEC",1,0)
DGSEC ;ALB/RMO - MAS Patient Look-up Security Check ; 3/24/04 7:53pm
"RTN","DGSEC",2,0)
 ;;5.3;Registration;**32,46,197,214,249,281,352,391,425,582,769**;Aug 13, 1993;Build 2
"RTN","DGSEC",3,0)
 ;
"RTN","DGSEC",4,0)
 ;Entry point from DPTLK
"RTN","DGSEC",5,0)
 I +$G(Y)=+$G(^DISV(DUZ,"^DPT(")),$G(DPTBTDT) K DPTBTDT Q
"RTN","DGSEC",6,0)
 N DFN,DGANS,DGMSG,DGOPT,DGPTSSN,DGREC,DGSENS,DGY,DX,DY,%,DG1
"RTN","DGSEC",7,0)
 ;Y=Patient file DFN
"RTN","DGSEC",8,0)
 S DGY=Y
"RTN","DGSEC",9,0)
 ;OWNREC^DGSEC4 parameters: 
"RTN","DGSEC",10,0)
 ;  DGREC = output array passed by reference
"RTN","DGSEC",11,0)
 ;  DGY = Patient file DFN
"RTN","DGSEC",12,0)
 ;  DUZ = New Person file IEN
"RTN","DGSEC",13,0)
 ;  1=generate error msg
"RTN","DGSEC",14,0)
 ;  DGNEWPT - set to 1 in DPTLK2 when adding new Patient (#2) file entry
"RTN","DGSEC",15,0)
 ;  DGPTSSN - set to patient's SSN when adding new Patient file entry
"RTN","DGSEC",16,0)
 ;  X=Patient's SSN from DPTLK2
"RTN","DGSEC",17,0)
 I $G(DGNEWPT)=1 S DGPTSSN=X
"RTN","DGSEC",18,0)
 D OWNREC^DGSEC4(.DGREC,+DGY,DUZ,1,$G(DGNEWPT),$G(DGPTSSN))
"RTN","DGSEC",19,0)
 S Y=DGY
"RTN","DGSEC",20,0)
 I DGREC(1)=1!(DGREC(1)=2) D  G Q
"RTN","DGSEC",21,0)
 .S Y=-1
"RTN","DGSEC",22,0)
 .D DISP(.DGREC)
"RTN","DGSEC",23,0)
 .I $D(DDS) R !,"Please enter any key to continue.",DGANS:DTIME
"RTN","DGSEC",24,0)
 ;SENS^DGSEC4 parameters: 
"RTN","DGSEC",25,0)
 ;  DGSENS = output array passed by reference
"RTN","DGSEC",26,0)
 ;  Y = Patient fileDFN
"RTN","DGSEC",27,0)
 ;  DUZ = New Person file IEN
"RTN","DGSEC",28,0)
 ;  DDS - Screenman variable
"RTN","DGSEC",29,0)
 ;  DGSENFLG - If defined, patient record sensitivity not checked
"RTN","DGSEC",30,0)
 D SENS^DGSEC4(.DGSENS,+Y,DUZ,$G(DDS),.DGSENFLG)
"RTN","DGSEC",31,0)
 ;DUZ must be defined to access a sensitive record
"RTN","DGSEC",32,0)
 I DGSENS(1)=-1 D  G Q
"RTN","DGSEC",33,0)
 .S Y=-1
"RTN","DGSEC",34,0)
 .D DISP(.DGSENS)
"RTN","DGSEC",35,0)
 I DGSENS(1)=0 G Q
"RTN","DGSEC",36,0)
 ;Get option name for DG Security Log file and bulletin
"RTN","DGSEC",37,0)
 D OP^XQCHK S DGOPT=$S(+XQOPT<0:"^UNKNOWN",1:$P(XQOPT,U)_U_$P(XQOPT,U,2))
"RTN","DGSEC",38,0)
 I DGSENS(1)=1 D
"RTN","DGSEC",39,0)
 .I DIC(0)["E" D
"RTN","DGSEC",40,0)
 ..W $C(7)
"RTN","DGSEC",41,0)
 ..D DISP(.DGSENS)
"RTN","DGSEC",42,0)
 .I Y>0 D
"RTN","DGSEC",43,0)
 ..;Parameters: DFN,DUZ,,Option name^Menu text
"RTN","DGSEC",44,0)
 ..D SETLOG1(+Y,DUZ,,DGOPT)
"RTN","DGSEC",45,0)
 I DGSENS(1)=2 D
"RTN","DGSEC",46,0)
 .I DIC(0)["E" D
"RTN","DGSEC",47,0)
 ..W $C(7)
"RTN","DGSEC",48,0)
 ..D DISP(.DGSENS)
"RTN","DGSEC",49,0)
 ..D NOTCE1
"RTN","DGSEC",50,0)
 .I Y>0 D
"RTN","DGSEC",51,0)
 ..D SETLOG1(+Y,DUZ,,DGOPT)
"RTN","DGSEC",52,0)
 ..;Parameters: DFN,DUZ,Option name^Menu text,message array
"RTN","DGSEC",53,0)
 ..D BULTIN1(+Y,DUZ,DGOPT,.DGMSG)
"RTN","DGSEC",54,0)
 ..I $D(DGSM),DIC(0)["E" D DISP(.DGMSG)
"RTN","DGSEC",55,0)
 D Q
"RTN","DGSEC",56,0)
 Q
"RTN","DGSEC",57,0)
 ;
"RTN","DGSEC",58,0)
REC ;DPTLK2 entry point when adding new Patient file record
"RTN","DGSEC",59,0)
 ;Input: X=Patient's SSN
"RTN","DGSEC",60,0)
 ;Output: DGREC=1 (adding own record or SSN not defined) or 0
"RTN","DGSEC",61,0)
 ;
"RTN","DGSEC",62,0)
 ;Parameters: DGREC=output array
"RTN","DGSEC",63,0)
 ;            DUZ
"RTN","DGSEC",64,0)
 ;            1 - generate error msg
"RTN","DGSEC",65,0)
 ;            DGNEWPT = 1 (adding new Patient (#2) file record
"RTN","DGSEC",66,0)
 ;            DGPTSSN = X (Patient's SSN)
"RTN","DGSEC",67,0)
 N DGPTSSN
"RTN","DGSEC",68,0)
 S DGPTSSN=X
"RTN","DGSEC",69,0)
 D OWNREC^DGSEC4(.DGREC,,DUZ,1,$G(DGNEWPT),$G(DGPTSSN))
"RTN","DGSEC",70,0)
 I DGREC(1)=1!(DGREC(1)=2) D
"RTN","DGSEC",71,0)
 .D DISP(.DGREC)
"RTN","DGSEC",72,0)
 .I $D(DDS) R !,"Please enter any key to continue.",DGANS:DTIME
"RTN","DGSEC",73,0)
 S DGREC=+DGREC(1)
"RTN","DGSEC",74,0)
 I DGREC=2 S DGREC=1
"RTN","DGSEC",75,0)
 Q
"RTN","DGSEC",76,0)
SETLOG ;Entry point for DBIA #2242
"RTN","DGSEC",77,0)
 ;Input variables: Y=DFN,DUZ,DG1=Inpatient/outpatient indicator,DGOPT=Option name^Menu text
"RTN","DGSEC",78,0)
 D SETLOG1(Y,DUZ,DG1,DGOPT)
"RTN","DGSEC",79,0)
 D Q
"RTN","DGSEC",80,0)
 Q
"RTN","DGSEC",81,0)
BULTIN ;Entry point for DBIA #2242
"RTN","DGSEC",82,0)
 ;Input variables: Y=DFN,DUZ,DGOPT=Option name^Menu text
"RTN","DGSEC",83,0)
 D BULTIN1(Y,DUZ,DGOPT)
"RTN","DGSEC",84,0)
 Q
"RTN","DGSEC",85,0)
SETLOG1(DFN,DGDUZ,DG1,DGOPT) ;Adds/updates entry in DG Security Log file (38.1)
"RTN","DGSEC",86,0)
 ;Input:
"RTN","DGSEC",87,0)
 ;  DFN   - Patient (#2) file DFN (Required)
"RTN","DGSEC",88,0)
 ;  DGDUZ - New Person (#200) file IEN
"RTN","DGSEC",89,0)
 ;  DG1   - Inpatient or Outpatient (Optional)
"RTN","DGSEC",90,0)
 ;  DGOPT - Option (#19) file Name (#.01)^Menu text (Optional)
"RTN","DGSEC",91,0)
 ;
"RTN","DGSEC",92,0)
 N DGA1,DGDATE,DGDTE,DGT,DGTIME,XQOPT
"RTN","DGSEC",93,0)
 ;DG/582
"RTN","DGSEC",94,0)
 I $G(VALM("TITLE"))="Dependents Module" Q
"RTN","DGSEC",95,0)
 ;Lock global
"RTN","DGSEC",96,0)
LOCK L +^DGSL(38.1,+DFN):1 G:'$T LOCK
"RTN","DGSEC",97,0)
 ;Add new entry for patient if not found
"RTN","DGSEC",98,0)
 I '$D(^DGSL(38.1,+DFN,0)) D
"RTN","DGSEC",99,0)
 .S ^DGSL(38.1,+DFN,0)=+DFN
"RTN","DGSEC",100,0)
 .S ^DGSL(38.1,"B",+DFN,+DFN)=""
"RTN","DGSEC",101,0)
 .S $P(^DGSL(38.1,0),U,3)=+DFN
"RTN","DGSEC",102,0)
 .S $P(^DGSL(38.1,0),U,4)=$P(^DGSL(38.1,0),U,4)+1
"RTN","DGSEC",103,0)
 .;Determine if entry is automatically sensitive
"RTN","DGSEC",104,0)
 .N ELIG,FLAG,X
"RTN","DGSEC",105,0)
 .S FLAG=0
"RTN","DGSEC",106,0)
 .S X=$S($D(^DPT(+DFN,"TYPE")):+^("TYPE"),1:"")
"RTN","DGSEC",107,0)
 .I $D(^DG(391,+X,0)),$P(^(0),"^",4) S FLAG=1
"RTN","DGSEC",108,0)
 .I 'FLAG S ELIG=0 F  S ELIG=$O(^DPT(+DFN,"E",ELIG)) Q:'ELIG  D  Q:FLAG
"RTN","DGSEC",109,0)
 ..S X=$G(^DIC(8,ELIG,0))
"RTN","DGSEC",110,0)
 ..I $P(X,"^",12) S FLAG=1
"RTN","DGSEC",111,0)
 .S $P(^DGSL(38.1,+DFN,0),"^",2)=FLAG
"RTN","DGSEC",112,0)
 .;Date/time sensitivity was set
"RTN","DGSEC",113,0)
 .S $P(^DGSL(38.1,+DFN,0),"^",4)=$$NOW^XLFDT()
"RTN","DGSEC",114,0)
 ;determine if an inpatient
"RTN","DGSEC",115,0)
 D H^DGUTL
"RTN","DGSEC",116,0)
 S DGT=DGTIME
"RTN","DGSEC",117,0)
 I $G(DG1)="" D ^DGPMSTAT
"RTN","DGSEC",118,0)
 ;get option name
"RTN","DGSEC",119,0)
 I $G(DGOPT)="" D OP^XQCHK S DGOPT=$S(+XQOPT<0:"^UNKNOWN",1:$P(XQOPT,U)_U_$P(XQOPT,U,2))
"RTN","DGSEC",120,0)
SETUSR S DGDTE=9999999.9999-DGTIME I $D(^DGSL(38.1,+DFN,"D",DGDTE,0)) S DGTIME=DGTIME+.00001 G SETUSR
"RTN","DGSEC",121,0)
 S:'$D(^DGSL(38.1,+DFN,"D",0)) ^(0)="^38.11DA^^" S ^DGSL(38.1,+DFN,"D",DGDTE,0)=DGTIME_U_DGDUZ_U_$P(DGOPT,U,2)_U_$S(DG1:"y",1:"n"),$P(^(0),U,3,4)=DGDTE_U_($P(^DGSL(38.1,+DFN,"D",0),U,4)+1)
"RTN","DGSEC",122,0)
 S ^DGSL(38.1,"AD",DGDTE,+DFN)=""
"RTN","DGSEC",123,0)
 S ^DGSL(38.1,"AU",+DFN,DGDUZ,DGDTE)=""
"RTN","DGSEC",124,0)
 L -^DGSL(38.1,+DFN)
"RTN","DGSEC",125,0)
 Q
"RTN","DGSEC",126,0)
Q K DG1,DGDATE,DGDTE,DGLNE,DGMSG,DGOPT,DGSEN,DGTIME,DGY,XQOPT
"RTN","DGSEC",127,0)
 N DGTEST S DGTEST=^%ZOSF("TEST")
"RTN","DGSEC",128,0)
 I DIC(0)["E",Y>0 D
"RTN","DGSEC",129,0)
 .S X="DGPFAPI" X DGTEST I $T D  ;Patient Record Flags check/display
"RTN","DGSEC",130,0)
 ..N DGPFSAVY S DGPFSAVY=Y
"RTN","DGSEC",131,0)
 ..D DISPPRF^DGPFAPI(Y) S Y=DGPFSAVY K DGPFSAVY
"RTN","DGSEC",132,0)
 .S X="A7RDPACT" X DGTEST I $T D ^A7RDPACT ;NDBI
"RTN","DGSEC",133,0)
 .S X="GMRPNCW" X DGTEST I $T S DPTSAVY=Y D ENPAT^GMRPNCW S Y=DPTSAVY K DPTSAVY ; CWAD
"RTN","DGSEC",134,0)
 .S X="MPRCHK" X DGTEST I $T D EN^MPRCHK(Y) ; MPR
"RTN","DGSEC",135,0)
 Q
"RTN","DGSEC",136,0)
 ;
"RTN","DGSEC",137,0)
BULTIN1(DFN,DGDUZ,DGOPT,DGMSG) ;Generate sensitive record access bulletin
"RTN","DGSEC",138,0)
 ;
"RTN","DGSEC",139,0)
 ;Input:  DFN = Patient file IEN
"RTN","DGSEC",140,0)
 ;        DGDUZ = New Person (#200) file IEN
"RTN","DGSEC",141,0)
 ;        DGOPT = Option (#19) file Name (#.01)^Menu text
"RTN","DGSEC",142,0)
 ;        DGMSG = Message array (Optional)
"RTN","DGSEC",143,0)
 ;
"RTN","DGSEC",144,0)
 N DGEMPLEE,XMSUB,XQOPT
"RTN","DGSEC",145,0)
 ;DG/582
"RTN","DGSEC",146,0)
 I $G(VALM("TITLE"))="Dependents Module" Q
"RTN","DGSEC",147,0)
 K DGB I $D(^DG(43,1,"NOT")),+$P(^("NOT"),U,10) S DGB=10
"RTN","DGSEC",148,0)
 Q:'$D(DGB)  S XMSUB="RESTRICTED PATIENT RECORD ACCESSED"
"RTN","DGSEC",149,0)
 S DGB=+$P($G(^DG(43,1,"NOT")),U,DGB) Q:'DGB
"RTN","DGSEC",150,0)
 S DGB=$$GET1^DIQ(3.8,DGB,.01,"","","ZERR") Q:'$L(DGB)
"RTN","DGSEC",151,0)
 ;S DGB=$P($G(^XMB(3.8,DGB,0)),U) Q:'$L(DGB)
"RTN","DGSEC",152,0)
 I $G(DGOPT)="" D OP^XQCHK S DGOPT=$S(+XQOPT<0:"^UNKNOWN",1:$P(XQOPT,U)_U_$P(XQOPT,U,2))
"RTN","DGSEC",153,0)
 N XMB,XMY,XMY0,XMZ
"RTN","DGSEC",154,0)
 S XMB="DG SENSITIVITY",XMB(1)=$P(^DPT(+DFN,0),U)
"RTN","DGSEC",155,0)
 S DGEMPLEE=$$EMPL^DGSEC4(+DFN)
"RTN","DGSEC",156,0)
 I DGEMPLEE=1 S XMB(1)=XMB(1)_"  (Employee)"
"RTN","DGSEC",157,0)
 S XMB(2)=$P(^DPT(+DFN,0),U,9),XMB(3)=$P(DGOPT,U,2),XMY("G."_DGB)=""
"RTN","DGSEC",158,0)
 N Y S Y=$$NOW^XLFDT() X ^DD("DD") S XMB(4)=Y
"RTN","DGSEC",159,0)
 D SEND(.XMB,.XMY)
"RTN","DGSEC",160,0)
 S DGMSG(1)="NOTE: A bulletin will now be sent to your station security officer."
"RTN","DGSEC",161,0)
 Q
"RTN","DGSEC",162,0)
 ;
"RTN","DGSEC",163,0)
SEND(XMB,XMY) ;Queue mail bulletin
"RTN","DGSEC",164,0)
 ;Input: XMB,XMY=Mailman bulletin parameters
"RTN","DGSEC",165,0)
 ;
"RTN","DGSEC",166,0)
 D ^XMB
"RTN","DGSEC",167,0)
 Q
"RTN","DGSEC",168,0)
 ;
"RTN","DGSEC",169,0)
DISP(ARRAY) ;Display message text to screen
"RTN","DGSEC",170,0)
 ;Input:  Array containg message text
"RTN","DGSEC",171,0)
 ;
"RTN","DGSEC",172,0)
 I '$D(ARRAY) Q
"RTN","DGSEC",173,0)
 I DIC(0)'["E" Q
"RTN","DGSEC",174,0)
 I $D(DDS) D CLRMSG^DDS S DX=0,DY=DDSHBX+1 X DDXY S X=0 X ^%ZOSF("RM")
"RTN","DGSEC",175,0)
 N DGI,DGWHERE
"RTN","DGSEC",176,0)
 I '$D(DDS) W !!
"RTN","DGSEC",177,0)
 F DGI=1:0 S DGI=$O(ARRAY(DGI)) Q:'DGI  D
"RTN","DGSEC",178,0)
 .S DGWHERE=(80-$L(ARRAY(DGI)))\2
"RTN","DGSEC",179,0)
 .W ?DGWHERE,ARRAY(DGI),!
"RTN","DGSEC",180,0)
 Q
"RTN","DGSEC",181,0)
 ;
"RTN","DGSEC",182,0)
NOTCE1 W:'$D(DDS) !! W "Do you want to continue processing this patient record" S %=2 D YN^DICN S:%<0!(%=2) Y=-1 I '% D  W:'$D(DDS) !! W "Enter 'YES' to continue processing, or 'NO' to quit processing this record." W:$D(DDS) ! G NOTCE1
"RTN","DGSEC",183,0)
 .I $D(DDS) D CLRMSG^DDS S DX=0,DY=DDSHBX+1 X DDXY
"RTN","DGSEC",184,0)
 Q
"RTN","DGSEC",185,0)
 ;
"RTN","DGSEC",186,0)
LOADXMY() ;this adds the contents of field #509 of File #43 to the XMY array
"RTN","DGSEC",187,0)
 ;PDX plans to use this - remember to NEW DIC before ^XMD call
"RTN","DGSEC",188,0)
 ;  Input  - None
"RTN","DGSEC",189,0)
 ;  Output - XMY("G.mailgroupname")="" if field #509 is defined
"RTN","DGSEC",190,0)
 ;                where mailgroupname is text value of mail group
"RTN","DGSEC",191,0)
 ;          Returns: 0              - Ok
"RTN","DGSEC",192,0)
 ;                   -1^errortext   - if can't find mail group
"RTN","DGSEC",193,0)
 ;
"RTN","DGSEC",194,0)
 N DGB,DGERR
"RTN","DGSEC",195,0)
 S DGERR=0
"RTN","DGSEC",196,0)
 S DGB=+$P($G(^DG(43,1,"NOT")),"^",10)
"RTN","DGSEC",197,0)
 I '$$GET1^DIQ(3.8,DGB,.01,"","","ZERR")#2 S DGERR="-1^No/Bad Field #509 entry in File #43" G QTLOADX
"RTN","DGSEC",198,0)
 ;I '$D(^XMB(3.8,DGB,0))#2 S DGERR="-1^No/Bad Field #509 entry in File #43" G QTLOADX
"RTN","DGSEC",199,0)
 S XMY("G."_$P($G(^XMB(3.8,DGB,0)),"^",1))="" ; pass mailgroup
"RTN","DGSEC",200,0)
QTLOADX Q DGERR
"RTN","DPTLK")
0^1^B66931183^B65590603
"RTN","DPTLK",1,0)
DPTLK ;ALB/RMO,RTK - MAS Patient Look-up Main Routine ; 3/22/05 4:19pm
"RTN","DPTLK",2,0)
 ;;5.3;Registration;**32,72,93,73,136,157,197,232,265,277,223,327,244,513,528,541,576,600,485,633,629,647,769**;Aug 13, 1993;Build 2
"RTN","DPTLK",3,0)
 ;
"RTN","DPTLK",4,0)
 ; mods made for magstripe read 12/96 - JFP
"RTN","DPTLK",5,0)
 ;
"RTN","DPTLK",6,0)
 ;Optional input: DPTNOFZY='1' to suppress fuzzy lookups implemented
"RTN","DPTLK",7,0)
 ;                by patch DG*5.3*244
"RTN","DPTLK",8,0)
 ;
"RTN","DPTLK",9,0)
EN ; -- Entry point
"RTN","DPTLK",10,0)
 N DIE,DR
"RTN","DPTLK",11,0)
 K DPTX,DPTDFN,DPTSAVX I $D(DIC(0)) G QK:DIC(0)["I"!(DIC(0)'["A"&('$D(X)))
"RTN","DPTLK",12,0)
 I '$D(^DD("VERSION")) W !!?3,"Unable to proceed. Fileman version node ^DD(""VERSION"") is undefined." G QK
"RTN","DPTLK",13,0)
 I '$D(^DPT(0))!(^DD("VERSION")<17.2) W !!?3,"Unable to proceed. ",$S('$D(^DPT(0)):"0th node of ^DPT missing",^DD("VERSION")<17.2:"Fileman version must be at least 17.2",1:""),"." G QK
"RTN","DPTLK",14,0)
EN2 K DO,DUOUT,DTOUT S U="^",DIC="^DPT(",DIC(0)=$S($D(DIC(0)):DIC(0),1:"AELMQ") S:DIC(0)'["A" (DPTX,DPTSAVX)=X
"RTN","DPTLK",15,0)
 S DPTSZ=1000 I $D(^DD("OS"))#2 S DPTSZ=$S(+$P(^DD("OS",^("OS"),0),U,2):$P(^(0),U,2),1:DPTSZ)
"RTN","DPTLK",16,0)
 ;
"RTN","DPTLK",17,0)
ASKPAT ; -- Prompt for patient
"RTN","DPTLK",18,0)
 I DIC(0)["A" D   G QK:'$T!($E(DPTX)["^")!(DPTX="")
"RTN","DPTLK",19,0)
 .K DTOUT,DUOUT
"RTN","DPTLK",20,0)
 .W !,$S($D(DIC("A")):DIC("A"),1:"Select PATIENT NAME: ") W:$D(DIC("B")) DIC("B"),"// "
"RTN","DPTLK",21,0)
 .R X:DTIME
"RTN","DPTLK",22,0)
 .S DPTX=X S:'$T DTOUT=1 S:$T&(DPTX="")&($D(DIC("B"))) DPTX=DIC("B") S:DPTX["^"&($E(DPTX)'="%") DUOUT=1
"RTN","DPTLK",23,0)
 ; -- Check for the IATA magnetic stripe input
"RTN","DPTLK",24,0)
 N MAG,GCHK
"RTN","DPTLK",25,0)
 S MAG=0
"RTN","DPTLK",26,0)
 I $E(DPTX)="%"!($E(DPTX)=";"),DPTX["?" S MAG=1,(X,DPTX)=$$IATA(DPTX)
"RTN","DPTLK",27,0)
 ;
"RTN","DPTLK",28,0)
CHKPAT ; -- Custom Patient Lookup
"RTN","DPTLK",29,0)
 D DO^DIC1
"RTN","DPTLK",30,0)
 S DIC("W")=$S($D(DIC("W")):DIC("W"),1:"")
"RTN","DPTLK",31,0)
 K DPTIFNS,DPTS,DPTSEL
"RTN","DPTLK",32,0)
 S DPTCNT=0
"RTN","DPTLK",33,0)
 ; -- Check input for format an length
"RTN","DPTLK",34,0)
 G CHKDFN:DPTX?1A!(DPTX'?.ANP)!($L(DPTX)>30)
"RTN","DPTLK",35,0)
 ; -- Check for null response or abort
"RTN","DPTLK",36,0)
 I DPTX=""!(DPTX["^") G ASKPAT:DIC(0)["A",QK
"RTN","DPTLK",37,0)
 ; -- Check for question mark
"RTN","DPTLK",38,0)
 I DPTX["?" D  G ASKPAT:DIC(0)["A",QK
"RTN","DPTLK",39,0)
 .S D="B"
"RTN","DPTLK",40,0)
 .S DZ=$S(DPTX?1"?":"",1:"??")
"RTN","DPTLK",41,0)
 .G CHKPAT1:DZ="??"
"RTN","DPTLK",42,0)
 .N %
"RTN","DPTLK",43,0)
 .W !,?1,"Answer with PATIENT NAME, or SOCIAL SECURITY NUMBER, or last 4 digits",!,?4,"of SOCIAL SECURITY NUMBER, or first initial of"
"RTN","DPTLK",44,0)
 .W " last name with last",!,?4,"4 digits of SOCIAL SECURITY NUMBER"
"RTN","DPTLK",45,0)
 .W !,?1,"Do you want the entire ",+$P($G(^DPT(0)),"^",4),"-Entry PATIENT List" S %=0 D YN^DICN
"RTN","DPTLK",46,0)
 .Q:%'=1
"RTN","DPTLK",47,0)
 .S DZ="??"
"RTN","DPTLK",48,0)
CHKPAT1 .S X=DPTX
"RTN","DPTLK",49,0)
 .D DQ^DICQ
"RTN","DPTLK",50,0)
 ; -- Check for space bar, return
"RTN","DPTLK",51,0)
 I DPTX=" " D  G CHKDFN
"RTN","DPTLK",52,0)
 .S Y=$S('($D(DUZ)#2):-1,$D(^DISV(DUZ,"^DPT(")):^("^DPT("),1:-1)
"RTN","DPTLK",53,0)
 .D SETDPT^DPTLK1:Y>0
"RTN","DPTLK",54,0)
 .S DPTDFN=$S($D(DPTS(Y)):Y,1:-1)
"RTN","DPTLK",55,0)
 ; -- Check for DFN look up
"RTN","DPTLK",56,0)
 I $E(DPTX)="`" D  G CHKDFN
"RTN","DPTLK",57,0)
 .S Y=$S($D(^DPT(+$P(DPTX,"`",2),0)):+$P(DPTX,"`",2),1:-1)
"RTN","DPTLK",58,0)
 .D SETDPT^DPTLK1:Y>0
"RTN","DPTLK",59,0)
 .S DPTDFN=$S($D(DPTS(Y)):Y,1:-1)
"RTN","DPTLK",60,0)
 ; -- Puts input in correct format
"RTN","DPTLK",61,0)
 G CHKDFN:DPTX=""
"RTN","DPTLK",62,0)
 ; -- Force new entry
"RTN","DPTLK",63,0)
 I $E(DPTX)="""",$E(DPTX,$L(DPTX))="""" G NOPAT
"RTN","DPTLK",64,0)
 ; -- Check for index lookups
"RTN","DPTLK",65,0)
 D ^DPTLK1 G QK:$D(DTOUT)!($D(DUOUT)&(DIC(0)'["A")),ASKPAT:$D(DUOUT),CHKPAT:DPTDFN<0,CHKDFN:DPTDFN>0 I DIC(0)["N",$D(^DPT(DPTX,0)) S Y=X D SETDPT^DPTLK1 S DPTDFN=$S($D(DPTS(Y)):Y,1:-1) G CHKDFN
"RTN","DPTLK",66,0)
MAG ; -- No patient found, check for mag stripe input, create stub
"RTN","DPTLK",67,0)
 I 'MAG G NOPAT
"RTN","DPTLK",68,0)
 ; -- Check for ADT option(s) only
"RTN","DPTLK",69,0)
 N DGOPT
"RTN","DPTLK",70,0)
 S DGOPT=$P($G(XQY0),"^",2)
"RTN","DPTLK",71,0)
 I DGOPT'="Load/Edit Patient Data",DGOPT'="Register a Patient" D  G EN2
"RTN","DPTLK",72,0)
 .W !,"    ...Patient not in database, use ADT options to load patient" D Q1
"RTN","DPTLK",73,0)
 ; -- Prompt for creation of stub
"RTN","DPTLK",74,0)
 S DIR(0)="Y",DIR("B")="NO",DIR("A")="Patient not found...Create stub entry: "
"RTN","DPTLK",75,0)
 S GCHK=$D(^TMP("DGVIC"))
"RTN","DPTLK",76,0)
 D ^DIR
"RTN","DPTLK",77,0)
 K DIR
"RTN","DPTLK",78,0)
 I 'Y D Q1 G EN2
"RTN","DPTLK",79,0)
 ; -- Parse IATA fields
"RTN","DPTLK",80,0)
 D FIELDS(IATA)
"RTN","DPTLK",81,0)
 ; -- Check for Duplicates
"RTN","DPTLK",82,0)
 D EP2^DPTLK3
"RTN","DPTLK",83,0)
 I DPTDFN<0 D Q1 G EN2
"RTN","DPTLK",84,0)
 ; -- Creates Stub entry in patient file
"RTN","DPTLK",85,0)
 S Y=$$FILE^DPTLK4(DGFLDS)
"RTN","DPTLK",86,0)
 I $P(Y,"^",3)'=1 W !,"Could not add patient to patient file" D QK1 Q
"RTN","DPTLK",87,0)
 D QK1
"RTN","DPTLK",88,0)
 Q
"RTN","DPTLK",89,0)
 ;
"RTN","DPTLK",90,0)
NOPAT ; -- No patient found, ask to add new
"RTN","DPTLK",91,0)
 I DIC(0)["L" D ^DPTLK2 S Y=DPTDFN G ASKPAT:DIC(0)["A"&(Y<0)&('$G(DTOUT)),QK1
"RTN","DPTLK",92,0)
 ;
"RTN","DPTLK",93,0)
CHKDFN ; -- 
"RTN","DPTLK",94,0)
 S:'$D(DPTDFN) DPTDFN=-1 I DPTDFN'>0!('$D(DPTS(+DPTDFN))) W:DIC(0)["Q" *7," ??" G ASKPAT:DIC(0)["A",QK
"RTN","DPTLK",95,0)
 I DIC(0)["E" D  W $S('$D(DPTSEL)&('$D(DIVP)):$P(DPTS(DPTDFN),U,2)_"  "_$P(DPTS(DPTDFN),U)_"  ",$D(^DPT(DPTDFN,0)):"  "_$P(^(0),U)_"  ",1:"") S Y=DPTDFN X:$D(^DPT(DPTDFN,0)) "N DDS X DIC(""W"")"
"RTN","DPTLK",96,0)
 .I $D(DDS) D CLRMSG^DDS S DX=0,DY=DDSHBX+1 X DDXY
"RTN","DPTLK",97,0)
 ;
"RTN","DPTLK",98,0)
 ; check for other patients in "BS5" xref on Patient file
"RTN","DPTLK",99,0)
 ;I '$G(DICR),DPTDFN>0,DIC(0)["E",$$BS5^DPTLK5(+DPTDFN) D  G ASKPAT:DIC(0)["A"&(%'=1),QK:DPTDFN<0
"RTN","DPTLK",100,0)
 I DPTDFN>0,DIC(0)["E",$$BS5^DPTLK5(+DPTDFN) D  G ASKPAT:DIC(0)["A"&(%'=1),QK:DPTDFN<0  ;*TEST*
"RTN","DPTLK",101,0)
 .N DPTZERO,DPTLSNME,DPTSSN S DPTZERO=$G(^DPT(+DPTDFN,0)),DPTLSNME=$P($P(DPTZERO,U),","),DPTSSN=$E($P(DPTZERO,U,9),6,9)
"RTN","DPTLK",102,0)
 .W $C(7),!!,"There is more than one patient whose last name is '",DPTLSNME,"' and"
"RTN","DPTLK",103,0)
 .W !,"whose social security number ends with '",DPTSSN,"'."
"RTN","DPTLK",104,0)
 .W !,"Are you sure you wish to continue (Y/N)" S %=0 D YN^DICN
"RTN","DPTLK",105,0)
 .I %'=1 S DPTDFN=-1
"RTN","DPTLK",106,0)
 ;
"RTN","DPTLK",107,0)
 ;I '$G(DICR),DPTDFN>0 S Y=DPTDFN D ^DGSEC S DPTDFN=Y G ASKPAT:DIC(0)["A"&(DPTDFN<0),QK:DPTDFN<0
"RTN","DPTLK",108,0)
 I DPTDFN>0,DIC(0)["E" S Y=DPTDFN D ^DGSEC S DPTDFN=Y G ASKPAT:DIC(0)["A"&(DPTDFN<0),QK:DPTDFN<0 S DPTBTDT=1
"RTN","DPTLK",109,0)
 S DPTX=DPTX_$P(DPTS(DPTDFN),U,2),DPTDFN=DPTDFN_U_$P(^DPT(DPTDFN,0),U)
"RTN","DPTLK",110,0)
 ;
"RTN","DPTLK",111,0)
Q ; -- 
"RTN","DPTLK",112,0)
 S Y=$S('$D(DPTDFN):-1,'$D(DPTS(+DPTDFN)):-1,1:DPTDFN),X=$S($D(DPTX)&(+Y>0):DPTX,$D(DPTSAVX):DPTSAVX,$D(DPTX):DPTX,1:"")
"RTN","DPTLK",113,0)
 I Y>0 S:DIC(0)'["F" ^DISV($S($D(DUZ)#2:DUZ,1:0),"^DPT(")=+Y S:DIC(0)["Z" Y(0)=^DPT(+Y,0),Y(0,0)=$P(^(0),U,1)
"RTN","DPTLK",114,0)
 ;DG*600
"RTN","DPTLK",115,0)
 ;I DIC(0)["E",$P($G(^DPT(+Y,0)),U,21) W *7,!,"Warning : You have selected a test patient."
"RTN","DPTLK",116,0)
 I DIC(0)["E",$$TESTPAT^VADPT(+Y) W *7,!,"WARNING : You may have selected a test patient."
"RTN","DPTLK",117,0)
 I DIC(0)["E",$$BADADR^DGUTL3(+Y) W *7,!,"WARNING : ** This patient has been flagged with a Bad Address Indicator."
"RTN","DPTLK",118,0)
 I DIC(0)["E",$$VAADV^DPTLK3(+Y) W *7,!,"** Patient is VA ADVANTAGE."
"RTN","DPTLK",119,0)
 ;DG*485
"RTN","DPTLK",120,0)
 I $D(^DPT("AXFFP",1,+Y)) D FFP^DPTLK5
"RTN","DPTLK",121,0)
 ;Display enrollment information
"RTN","DPTLK",122,0)
 I Y>0,DIC(0)["E" D ENR
"RTN","DPTLK",123,0)
 ;
"RTN","DPTLK",124,0)
 ;Call Combat Vet check
"RTN","DPTLK",125,0)
 I Y>0,DIC(0)["E" D CV
"RTN","DPTLK",126,0)
 ;
"RTN","DPTLK",127,0)
 ; check whether to display Means Test Required message
"RTN","DPTLK",128,0)
 D
"RTN","DPTLK",129,0)
 .N DPTDIV
"RTN","DPTLK",130,0)
 .I '$G(DUZ(2)) Q
"RTN","DPTLK",131,0)
 .I Y>0,DIC(0)["E" S DPTDIV=$$DMT^DPTLK5(+Y,DUZ(2)) I DPTDIV D
"RTN","DPTLK",132,0)
 ..W $C(7),!!,"MEANS TEST REQUIRED"
"RTN","DPTLK",133,0)
 ..W !,?3,$P($G(^DG(40.8,DPTDIV,"MT")),U,2)
"RTN","DPTLK",134,0)
 ..H 2
"RTN","DPTLK",135,0)
 ;
"RTN","DPTLK",136,0)
Q1 ; -- Clean up variables
"RTN","DPTLK",137,0)
 K D,DIC("W"),DO,DPTCNT,DPTDFN,DPTIFNS,DPTIX,DPTS
"RTN","DPTLK",138,0)
 K:'$G(DICR) DPTBTDT  ; IF DICR LEAVE FOR DGSEC TO HANDLE
"RTN","DPTLK",139,0)
 K DPTSAVX,DPTSEL,DPTSZ,DPTX
"RTN","DPTLK",140,0)
 ;
"RTN","DPTLK",141,0)
 K:$D(IATA) IATA
"RTN","DPTLK",142,0)
 K:$D(DGFLDS) @DGFLDS,DGFLDS
"RTN","DPTLK",143,0)
 Q
"RTN","DPTLK",144,0)
 ;
"RTN","DPTLK",145,0)
QK K:'$D(DPTNOFZK) DPTNOFZY G Q
"RTN","DPTLK",146,0)
 ;
"RTN","DPTLK",147,0)
QK1 K:'$D(DPTNOFZK) DPTNOFZY G Q1
"RTN","DPTLK",148,0)
 ;
"RTN","DPTLK",149,0)
IX ; --
"RTN","DPTLK",150,0)
 I $D(D),$D(^DD(2,0,"IX",D)),($E(D)'="A") S DPTIX=D
"RTN","DPTLK",151,0)
 G DPTLK
"RTN","DPTLK",152,0)
 ;
"RTN","DPTLK",153,0)
IATA(X) ; --
"RTN","DPTLK",154,0)
 ;This function pulls off ssn from the IATA track
"RTN","DPTLK",155,0)
 ;
"RTN","DPTLK",156,0)
 ;Input:  X   -  what was read in
"RTN","DPTLK",157,0)
 ;Output: SSN -  social security number
"RTN","DPTLK",158,0)
 ;          Q -  quit
"RTN","DPTLK",159,0)
 ;
"RTN","DPTLK",160,0)
 ; Track            Start Sent     End Sent      Field Separator
"RTN","DPTLK",161,0)
 ; -----            ----------     --------      ---------------
"RTN","DPTLK",162,0)
 ;  IATA (alphanum)      %             ?          {   (Note: VA used ^)
"RTN","DPTLK",163,0)
 ;  ABA (numeric)        ;             ?          =    
"RTN","DPTLK",164,0)
 ;
"RTN","DPTLK",165,0)
 ;N IATA
"RTN","DPTLK",166,0)
 S (IATA)=""
"RTN","DPTLK",167,0)
 I $E(X)'="%" Q X ; no start sentinel
"RTN","DPTLK",168,0)
 I X'["?" Q "Q"
"RTN","DPTLK",169,0)
 ; -- Extract data from track
"RTN","DPTLK",170,0)
 S IATA=$$TRACK(X,"%","?")
"RTN","DPTLK",171,0)
 ; -- checks for no data
"RTN","DPTLK",172,0)
 I IATA="" Q "Q"
"RTN","DPTLK",173,0)
 ; -- Returns SSN
"RTN","DPTLK",174,0)
 I IATA'="" Q $P(IATA,"^")
"RTN","DPTLK",175,0)
 Q "Q"
"RTN","DPTLK",176,0)
 ;
"RTN","DPTLK",177,0)
TRACK(X,START,END) ; find track where start/end are sentinels
"RTN","DPTLK",178,0)
 ;
"RTN","DPTLK",179,0)
 Q $P($P($G(X),START,2),END,1)
"RTN","DPTLK",180,0)
 ;
"RTN","DPTLK",181,0)
FIELDS(IATA) ; -- Sets fields
"RTN","DPTLK",182,0)
 Q:'$D(IATA)
"RTN","DPTLK",183,0)
 N CNT,FIELD
"RTN","DPTLK",184,0)
 S DGFLDS="^TMP(""DGVIC"","_$J_")",CNT=1
"RTN","DPTLK",185,0)
 K @DGFLDS
"RTN","DPTLK",186,0)
 F  S FIELD=$P($G(IATA),"^",CNT)  Q:FIELD=""  D
"RTN","DPTLK",187,0)
 .S @DGFLDS@(CNT)=FIELD
"RTN","DPTLK",188,0)
 .S CNT=CNT+1
"RTN","DPTLK",189,0)
 ; -- Define fields for duplicate checker
"RTN","DPTLK",190,0)
 S DPTX=$G(@DGFLDS@(2)) ;NAME
"RTN","DPTLK",191,0)
 S DPTIDS(.03)=$G(@DGFLDS@(3)) ;DOB
"RTN","DPTLK",192,0)
 S DPTIDS(.09)=$G(@DGFLDS@(1)) ;SSN
"RTN","DPTLK",193,0)
 Q
"RTN","DPTLK",194,0)
ENR ;Display Enrollment information after patient selection
"RTN","DPTLK",195,0)
 N DGENCAT,DGENDFN,DGENR,DGEGTIEN,DGEGT
"RTN","DPTLK",196,0)
 I '$$GET^DGENA($$FINDCUR^DGENA(+DPTDFN),.DGENR) Q
"RTN","DPTLK",197,0)
 S DGENCAT=$$CATEGORY^DGENA4(+DPTDFN)
"RTN","DPTLK",198,0)
 S DGENCAT=$$EXTERNAL^DILFD(27.15,.02,"",DGENCAT)
"RTN","DPTLK",199,0)
 W !?1,"Enrollment Priority: ",$S($G(DGENR("PRIORITY")):$$EXT^DGENU("PRIORITY",DGENR("PRIORITY")),1:""),$S($G(DGENR("SUBGRP"))="":"",1:$$EXT^DGENU("SUBGRP",$G(DGENR("SUBGRP"))))
"RTN","DPTLK",200,0)
 W ?33,"Category: ",DGENCAT
"RTN","DPTLK",201,0)
 W ?57,"End Date: ",$S($G(DGENR("END")):$$FMTE^XLFDT(DGENR("END"),"5DZ"),1:""),!
"RTN","DPTLK",202,0)
 ;If patient is NOT ELIGIBLE, display Enrollment Status (Ineligible Project Phase I)
"RTN","DPTLK",203,0)
 I $G(DGENR("STATUS"))=10!($G(DGENR("STATUS"))=19)!($G(DGENR("STATUS"))=20) D
"RTN","DPTLK",204,0)
 . W ?1,"Enrollment Status: ",$S($G(DGENR("STATUS")):$$EXT^DGENU("STATUS",DGENR("STATUS")),1:"") ;H 5
"RTN","DPTLK",205,0)
 ;check for Combat Veteran Eligibility, if elig do not display EGT info
"RTN","DPTLK",206,0)
 I $$CVEDT^DGCV(+DPTDFN) Q
"RTN","DPTLK",207,0)
 ;Get Enrollment Group Threshold Priority and Subgroup
"RTN","DPTLK",208,0)
 S DGEGTIEN=$$FINDCUR^DGENEGT
"RTN","DPTLK",209,0)
 S DGEGT=$$GET^DGENEGT(DGEGTIEN,.DGEGT)
"RTN","DPTLK",210,0)
 Q:$G(DGENR("PRIORITY"))=""!($G(DGEGT("PRIORITY"))="")
"RTN","DPTLK",211,0)
 ;Compare Patient's Enrollment Priority to Enrollment Group Threshold
"RTN","DPTLK",212,0)
 I '$$ABOVE^DGENEGT1(+DPTDFN,DGENR("PRIORITY"),$G(DGENR("SUBGRP")),DGEGT("PRIORITY"),DGEGT("SUBGRP")) D
"RTN","DPTLK",213,0)
 .N X,IORVOFF,IORVON
"RTN","DPTLK",214,0)
 .S X="IORVOFF;IORVON"
"RTN","DPTLK",215,0)
 .D ENDR^%ZISS
"RTN","DPTLK",216,0)
 .W !?32 W:$D(IORVON) IORVON  W "*** WARNING ***" W:$D(IORVOFF) IORVOFF
"RTN","DPTLK",217,0)
 .I DGENR("END")'="" W !?14 W:$D(IORVON) IORVON W "*** PATIENT ENROLLMENT END",$S(DT>+DGENR("END"):"ED",1:"S")," EFFECTIVE ",$$FMTE^XLFDT(DGENR("END"),"5DZ")," ***" W:$D(IORVOFF) IORVOFF Q
"RTN","DPTLK",218,0)
 .W !?5 W:$D(IORVON) IORVON W "*** PATIENT ENROLLMENT ENDING.  ENROLLMENT END DATE IS NOT KNOWN. ***" W:$D(IORVOFF) IORVOFF
"RTN","DPTLK",219,0)
 Q
"RTN","DPTLK",220,0)
CV ;check for Combat Vet status
"RTN","DPTLK",221,0)
 N DGCV
"RTN","DPTLK",222,0)
 S DGCV=$$CVEDT^DGCV(+DPTDFN)
"RTN","DPTLK",223,0)
 I $P(DGCV,U)=1 D  Q
"RTN","DPTLK",224,0)
 . I '$$GET^DGENA($$FINDCUR^DGENA(+DPTDFN),.DGENR) W !
"RTN","DPTLK",225,0)
 . W ?3,"Combat Vet Status: "_$S($P(DGCV,U,3)=1:"ELIGIBLE",1:"EXPIRED"),?57,"End Date: "_$$FMTE^XLFDT($P(DGCV,U,2),"5DZ")
"RTN","DPTLK",226,0)
 Q
"VER")
8.0^22.0
"BLD",7480,6)
^696
**END**
**END**
