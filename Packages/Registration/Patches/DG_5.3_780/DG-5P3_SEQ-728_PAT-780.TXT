$TXT Created by KOPECKY,STEVE at MNTVLL.FO-ALBANY.MED.VA.GOV  (KIDS) on Thursday, 03/25/10 at 10:25
=============================================================================
Run Date: JUN 21, 2010                     Designation: DG*5.3*780
Package : DG - REGISTRATION                   Priority: Mandatory
Version : 5.3       SEQ #728                    Status: Released
                  Compliance Date: JUL 18, 2010
=============================================================================

Associated patches: (v)DG*5.3*688  <<= must be installed BEFORE `DG*5.3*780'

Subject: INCONSISTENCY 55 ERROR CORRECTED

Category: 
  - Routine

Description:
============

 This patch (DG*5.3*780) corrects a problem where the consistency 
 checker for registration returns an inconsistency error #55 (INCOME DATA
 MISSING) when it should not.
  
 This patch addresses the following New Service Request (NSR):
 -------------------------------------------------------------
 There is no NSR associated with this patch.
  
  
 This patch addresses the following NOIS/Remedy ticket(s):
 ---------------------------------------------------------
 HD0000000227025 Inconsistency Alerts for income info for which means test 
                 is not due yet
     Duplicates: HD0000000228758 Income data missing screen 9 load/edit
                 HD0000000262871 Site reports seeing CC 55 when the vet has
                                 a current means test
                 HD0000000314450 Inconsistent error for patients not able 
                                 to fix
                 HD0000000377687 Inconsistency Error - 55 Income Data 
                                 Missing
                 HD0000000389019 Patients enrolled but not registered
  
 Overview of Remedy Message(s): 
 -----------------------------------
 Remedy ticket: HD0000000227025  
    Duplicates: HD0000000228758, HD0000000262871, HD0000000314450, 
 HD0000000377687, HD0000000389019
  
 Problem: When a patient has a 'current' means test and has income data
          associated with it, the system does not always pick up the
          income data when executing the consistency check #55 in 
          registration and produces the error message: INCOME DATA MISSING.
          
 Solution: This condition only occurs if the patient has had an unexpired 
           means test deleted and then a newer means test added within 365
           days of the original unexpired means test. This leaves a stub
           record in the INCOME RELATION file (#408.22) that does not have
           a means test associated with it so it appears as if no income
           information is available.  The fix is to check for a current
           means test and if it is not yet 365 days old, use that means
           test to extract the current income information.
           
           Please note: This patch will fix the consistency checks so that 
           the error is no longer erroneously being produced.  However, if
           patients have had this error in the past and those patients are
           displayed on reports which include the Percentage of Completed
           Registrations, users must go to Load/Edit for those patients
           before the patients will be removed from the reports.  No data
           needs to be modified for those patients.  Their records must
           only be touched before the inconsistency error #55 is removed.
     
 Components Sent With Patch
 --------------------------
 None
  
  
 Test Sites:
 -----------
  Hudson Valley VA HCS (Medium)
  NY Harbor VA HCS (Large) 
  Orlando VAMC (Integrated) 
  Southern Arizona VA HCS (Large)
  
  
        ================INSTALLATION INSTRUCTIONS =================
 If installed during the normal workday, it is recommended that:
        1.  TaskMan should be placed in a wait state in order to prevent 
            HL7 filer errors while this patch is being installed.
        2.  The following selection(s) in the OPTION (#19) file, and all of
            their descendants be disabled to prevent possible conflicts
            while running the KIDS Install. Other VISTA users will not be
            affected:
  
               [DG LOAD PATIENT DATA] Load/Edit Patient Data
               [DG REGISTER PATIENT]  Register a Patient
               [IBJD INTAKE COMP REG] Percentage of Completed Registrations
  
 Install Time - less than 5 minutes (unless otherwise indicated)
  
 1.  LOAD TRANSPORT GLOBAL 
     ---------------------
     Choose the PackMan message containing this patch and invoke the 
     INSTALL/CHECK MESSAGE PackMan option.  
              
 2.  START UP KIDS 
     -------------
     Start up the Kernel Installation and Distribution System Menu 
     [XPD MAIN]: 
    
          Edits and Distribution ...  
          Utilities ...  
          Installation ...  
    
 Select Kernel Installation & Distribution System Option: INStallation 
                                                          ---
          Load a Distribution 
          Print Transport Global 
          Compare Transport Global to Current System 
          Verify Checksums in Transport Global 
          Install Package(s) 
          Restart Install of Package(s) 
          Unload a Distribution 
          Backup a Transport Global 
    
 Select Installation Option: 
    
 3.  Select Installation Option: 
     ---------------------------
     NOTE:  The following are OPTIONAL - (When prompted for the INSTALL
            NAME, enter DG*5.3*780):
       
     a.  Backup a Transport Global - This option will create a backup
         message of any routines exported with this patch. It will not
         backup any other changes such as DD's or templates.
     b.  Compare Transport Global to Current System - This option will
         allow you to view all changes that will be made when this patch
         is installed.  It compares all components of this patch
         (routines, DD's, templates, etc.).
     c.  Verify Checksums in Transport Global - This option will allow
         you to ensure the integrity of the routines that are in the
         transport global.
      
 4.  Select Installation Option: Install Package(s) 
                                 ------------------
     **This is the step to start the installation of this KIDS patch: 
    
    a.  Choose the Install Package(s) option to start the patch
        install.
  
      When prompted 'Want KIDS to Rebuild Menu Trees Upon Completion of
      Install? YES//'  Answer NO
  
    b.  When prompted 'Want KIDS to INHIBIT LOGONs during the install? 
        YES//' answer NO (unless otherwise indicated)
    c.  When prompted 'Want to DISABLE Scheduled Options, Menu 
        Options, and Protocols? YES//' answer YES (unless otherwise
        indicated)
    d.  When prompted 'Enter options you wish to mark as 'Out Of
        Order':'  Enter the following options:
  
               DG LOAD PATIENT DATA   Load/Edit Patient Data
               DG REGISTER PATIENT    Register a Patient 
               IBJD INTAKE COMP REG   Percentage of Completed Registrations
  
    e.  When prompted 'Enter protocols you wish to mark as 'Out Of
        Order':' press <return>.

Routine Information:
====================
The second line of each of these routines now looks like:
 ;;5.3;Registration;**[Patch List]**;Aug 13, 1993;Build 2

The checksums below are new checksums, and
 can be checked with CHECK1^XTSUMBLD.

Routine Name: DGRPC2
    Before: B64408428   After: B66765890  **45,69,108,121,205,218,342,
                                           387,470,467,489,505,507,528,
                                           451,564,570,657,688,780**
 Description of Changes:
  Before:
  =======
   
   32 55     ;BELOW IS USED BY BOTH 54 & 55
   33        S DGLST=$S(DGCHK["55":55,1:54)
   34        I $G(^DPT(DFN,.35)),(^(.35)<+($E(DT,1,3)_"0000")) D NEXT G @DGLST ; 
              patient died before current year
   35        N DGE S DGE=+$O(^DIC(8.1,"B","SERVICE CONNECTED 50% to 100%",0))
   36        I $P($G(^DPT(DFN,.3)),U,2)'<50!($P($G(^DIC(8,+$G(^DPT(DFN,.36)),0)),
              U,9)=DGE) D NEXT G @DGLST ;50-100% SC
   37        S DGPTYP=$G(^DG(391,+DGP("TYPE"),"S")),DGISYR=$E(DT,1,3)-1_"0000" I 
              '$P(DGPTYP,"^",8)&('$P(DGPTYP,"^",9)) K DGPTYP,DGISYR D NEXT G @DGL
              ST ; screens 8 and 9 off
   38        D ALL^DGMTU21(DFN,"VSD",DT,"IP")
   39        I '$P(DGPTYP,"^",8)!(DGCHK'["54") G JUST55 ; screen 8 off OR JUST 55
               IN CHK
   
   
   
  After:
  ======
   
   32 55     ;BELOW IS USED BY BOTH 54 & 55
   33        N DGMT
   34        S DGLST=$S(DGCHK["55":55,1:54)
   35        I $G(^DPT(DFN,.35)),(^(.35)<+($E(DT,1,3)_"0000")) D NEXT G @DGLST ; 
              patient died before current year
   36        N DGE S DGE=+$O(^DIC(8.1,"B","SERVICE CONNECTED 50% to 100%",0))
   37        I $P($G(^DPT(DFN,.3)),U,2)'<50!($P($G(^DIC(8,+$G(^DPT(DFN,.36)),0)),
              U,9)=DGE) D NEXT G @DGLST ;50-100% SC
   38        S DGPTYP=$G(^DG(391,+DGP("TYPE"),"S")),DGISYR=$E(DT,1,3)-1_"0000" I 
              '$P(DGPTYP,"^",8)&('$P(DGPTYP,"^",9)) K DGPTYP,DGISYR D NEXT G @DGL
              ST ; screens 8 and 9 off
  >39        ; If current/not outdated means test exits, pass to income retrieval
  >40        ; Patch 780
  >41        S DGMT=$$LST^DGMTU(DFN)
  >42        I DGMT,$$OLD^DGMTU4($P(DGMT,U,2)) S DGMT=""
  >43        D ALL^DGMTU21(DFN,"VSD",$S(DGMT:$P(DGMT,U,2),1:DT),"IP",$S(DGMT:DGMT
              ,1:""))
   44        I '$P(DGPTYP,"^",8)!(DGCHK'["54") G JUST55 ; screen 8 off OR JUST 55
               IN CHK

 
Routine list of preceding patches: 688

=============================================================================
User Information:
Entered By  : HUA,PATRICK                   Date Entered  : FEB 20, 2008
Completed By: SBERRO,SANDRA                 Date Completed: JUN 07, 2010
Released By : FITCH,DONNA                   Date Released : JUN 21, 2010
=============================================================================


Packman Mail Message:
=====================

$END TXT
