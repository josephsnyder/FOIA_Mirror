$TXT Created by KOPP,TERRY at MNTVLL.FO-ALBANY.MED.VA.GOV  (KIDS) on Wednesday, 08/20/08 at 11:51
=============================================================================
Run Date: JUN 12, 2009                     Designation: DG*5.3*792
Package : DG - REGISTRATION                   Priority: Mandatory
Version : 5.3       SEQ #711                    Status: Released
                  Compliance Date: JUL 13, 2009
=============================================================================

Associated patches: (v)DG*5.3*731  <<= must be installed BEFORE `DG*5.3*792'
                    (v)DG*5.3*778  <<= must be installed BEFORE `DG*5.3*792'

Subject: Fix Unsupported CV End Dates Report Problem

Category: 
  - Routine

Description:
============

 This patch fixes two problems with the Unsupported CV End Dates Report 
 [DG UNSUPPORTED CV END DATE RPT] option, which produces a list of 
 veterans with Combat Veteran (CV) End Dates that are not supported by 
 Military Service Data.  
  
 The enactment of the National Defense Authorization Act FY 08 (NDAA) 
 extended the time period for CV Eligibility from two years to up to five 
 years. The NDAA conversion software, however, failed to take into account
 the Unsupported CV End Dates Report [DG UNSUPPORTED CV END DATE RPT]
 option, which still uses the old calculation. This means that whenever the
 report is run:  (1) veterans whose CV Eligibility falls into the NDAA
 extended time period between three to five years are incorrectly included
 on the report. Conversely, (2) there may be veterans whose database
 records are eligible for conversion but have not yet undergone it. These
 veterans' names and CV End Dates are supposed to be included on the report
 but currently are not. DG*5.3*792 corrects both of these problems.
  
  
 This patch addresses the following New Service Request (NSR):
 -------------------------------------------------------------
 There is no NSR associated with this patch.
  
  
 This patch addresses the following Remedy Ticket(s):
 ----------------------------------------------------
 HD0000000266401 - Unsupported CV End Dates Report Problem
  
  
 Overview of Remedy Ticket(s):
 -----------------------------
  
 HD0000000266401
  
 Problem:
 ========
 When Registration patch DG*5.3*778 was released to change the Combat
 Veteran end date calculation for the National Defense Authorization Act FY
 08 (NDAA), the Unsupported CV End Dates Report [DG UNSUPPORTED CV END DATE
 RPT] option was missed so it is still using the old 2 year calculation.  
 This renders the report unusable.
  
  
 Resolution:
 ============
 The report was changed to use the new NDAA calculation to determine the
 appropriate veterans to include on the report.
  
  
 Test Sites:
 -----------
 PITTSBURGH HCS (Large)
 INDIANAPOLIS, IN (Large)
 UPSTATE NEW YORK HCS (Integrated)
 VA GREATER LOS ANGELES HCS (Integrated)
  
  
        ================INSTALLATION INSTRUCTIONS =================
  
 It is recommended that this patch be installed after normal working hours
 as the routine DGCV is included in this patch and is used extensively 
 within the registration system.
  
 It is recommended that the following selections in the OPTION (#19) file
 be disabled to minimize the chance of possible conflicts while running the
 KIDS Install:
  
   Unsupported CV End Dates Report      [DG UNSUPPORTED CV END DATE RPT]
   Load/Edit Patient                    [DG LOAD PATIENT DATA]
   Register a Patient                   [DG REGISTER PATIENT]
  
 Install Time - less than 5 minutes
  
       
 1.  LOAD TRANSPORT GLOBAL 
     ---------------------
     Choose the PackMan message containing this patch and invoke the 
     INSTALL/CHECK MESSAGE PackMan option.  
  
 2.  START UP KIDS  
     -------------
     Start up the Kernel Installation and Distribution System Menu 
     [XPD MAIN]: 
  
          Edits and Distribution ...  
          Utilities ...  
          Installation ...  
  
   Select Kernel Installation & Distribution System Option: INStallation 
                                                            --- 
          Load a Distribution  
          Print Transport Global 
          Compare Transport Global to Current System 
          Verify Checksums in Transport Global 
          Install Package(s) 
          Restart Install of Package(s) 
          Unload a Distribution 
          Backup a Transport Global 
  
  
 3.  Select Installation Option:  
     ---------------------------
     NOTE:  The following are OPTIONAL - (When prompted for the INSTALL
            NAME, enter DG*5.3*792):
       
     a.  Backup a Transport Global - This option will create a backup
         message of any routines exported with this patch. It will not
         backup any other changes such as DD's or templates.
     b.  Compare Transport Global to Current System - This option will
         allow you to view all changes that will be made when this patch
         is installed.  It compares all components of this patch
         (routines, DD's, templates, etc.).
     c.  Verify Checksums in Transport Global - This option will allow
         you to ensure the integrity of the routines that are in the
         transport global.
      
  
 4.Select Installation Option: Install Package(s)
                               ------------------
     **This is the step to start the installation of this KIDS patch: 
   
     a.  Choose the Install Package(s) option to start the patch
         install.
     b.  When prompted 'Want KIDS to INHIBIT LOGONs during the install? 
         YES//' answer NO.
     c.  When prompted 'Want to DISABLE Scheduled Options, Menu 
         Options, and Protocols? YES//' answer YES.
     d.  When prompted 'Enter options you wish to mark as 'Out Of
         Order':'  enter the following options:
          Unsupported CV End Dates Report  [DG UNSUPPORTED CV END DATE RPT]
          Load/Edit Patient                [DG LOAD PATIENT DATA]
          Register a Patient               [DG REGISTER PATIENT]
     e.  When prompted 'Enter protocols you wish to mark as 'Out Of
         Order':' press <Enter>.

Routine Information:
====================
The second line of each of these routines now looks like:
 ;;5.3;Registration;**[Patch List]**; Aug 13, 1993;Build 4

The checksums below are new checksums, and
 can be checked with CHECK1^XTSUMBLD.

Routine Name: DGCV
    Before: B50348592   After: B52767874  **528,576,564,673,778,792**
 Description of Changes:
  Changed: SETCV+4
     From: N DGCVEDT,DGFDA,DGNDAA,DGPLUS3,DGTMPDT,DGYRS
           S DGNDAA=3080128
           I $G(DFN)']""!($G(DGSRV)']"") Q
           I '$D(^DPT(DFN)) Q
       To: N DGCVEDT,DGFDA
   
   
  Added: after SETCV+5
          S DGCVEDT=$$CALCCV(DFN,DGSRV)
          Q:DGCVEDT=""
   
   
  Pulled the actual CV end date calculation out of the update call into a 
  calculation call to be used by others.
   
  Removed from SETCV:
         D CVRULES(DFN,DGSRV,.DGYRS)
         Q:$G(DGYRS)'=3&($G(DGYRS)'=5)
         ;NDAA legislation, enacted 1/28/08, gives vets discharged
         ;on or after 1/28/03 (2 years previously) CV Eligibility 
         ;for 5 years.  Vets discharged before 1/28/03 get eligibility 
         ;for 3 years after enactment (or until 1/27/2011) DG*5.3*778
         S DGTMPDT=$S(DGYRS=3:DGNDAA,1:DGSRV)
         S DGCVEDT=($E(DGTMPDT,1,3)+DGYRS)_$E(DGTMPDT,4,7)
         S DGCVEDT=$$FMADD^XLFDT(DGCVEDT,-1)
   
  Added CALCCV:
  CALCCV(DFN,DGSRV) ; Calculate CV end date given DFN and date to start
        ; calculation from
        ; Function returns null or CV end date calculated
        N DGCVEDT,DGNDAA,DGPLUS3,DGTMPDT,DGYRS
        I $G(DFN)']""!($G(DGSRV)']"") Q ""
        I '$D(^DPT(DFN)) Q ""
        S DGNDAA=3080128
        D CVRULES(DFN,DGSRV,DGNDAA,.DGYRS)
        Q:$G(DGYRS)'=3&($G(DGYRS)'=5) ""
        ;NDAA legislation, enacted 1/28/08, gives vets discharged
        ;on or after 1/28/03 (2 years previously) CV Eligibility 
        ;for 5 years.  Vets discharged before 1/28/03 get eligibility 
        ;for 3 years after enactment (or until 1/27/2011) DG*5.3*778
        S DGTMPDT=$S(DGYRS=3:DGNDAA,1:DGSRV)
        S DGCVEDT=($E(DGTMPDT,1,3)+DGYRS)_$E(DGTMPDT,4,7)
        S DGCVEDT=$$FMADD^XLFDT(DGCVEDT,-1)
        Q DGCVEDT
        ;
   
   
  Changed: CVRULES parameter list
     From: CVRULES(DFN,DGSRV,DGYRS) ;apply rules for the CV End Date
       To: CVRULES(DFN,DGSRV,DGNDAA,DGYRS) ;apply rules for the CV End Date

Routine Name: DGCVRPT
    Before: B26310985   After: B26451377  **564,731,792**
 Description of Changes:
   
  Changed: SCH (not actually used anywhere)
    From: SCH   S CALC=$P($$SCH^XLFDT("24M",SSD),".",1) Q
      To: SCH   S CALC=$$CALCCV^DGCV(DFN,SSD) Q
   
  Changed: CVDATE+9
     From: D GETS^DIQ(2,DFN_",",".327;.322012;.322018;.322021;.5294;.5295"
  ,"I" ,"DGARR","DGERR")
       To: D GETS^DIQ(2,DFN_",",".327;.322012;.322018;.322021;.5294","I","
  DGAR R","DGERR")
   
  Changed: CVDATE+11
     From: S SSD=$G(DGARRY(2,DFN_",",.327,"I")) 
       To: S SSD=$G(DGARR(2,DFN_",",.327,"I"))
   
  Changed: CVDATE+13
     From: I $G(DGARRY("OEF/OIF")),DGARRY("OEF/OIF")>SSD S DATE=DGARRY("OEF/
  OIF") G CVDATEQ
       To: I $G(DGARR("OEF/OIF")),DGARR("OEF/OIF")>SSD S DATE=DGARR("OEF/OIF
  ") G CVDATEQ
   
  Added: CVDATE+16
           I $G(DGARR("OEF/OIF")) S DATE=SSD Q
   
  Changed: CVDATEQ
    From: CVDATEQ Q $S(DATE:$P($$SCH^XLFDT("24M",DATE),".",1),1:"")
      To: CVDATEQ Q $S(DATE:$$CALCCV^DGCV(DFN,DATE),1:"")

 
Routine list of preceding patches: 731, 778

=============================================================================
User Information:
Entered By  : KOPP,TERRY M                  Date Entered  : AUG 20, 2008
Completed By: RUDINGER,NANCY L.             Date Completed: JUN 03, 2009
Released By : GROOMS,ANTHONY E              Date Released : JUN 12, 2009
=============================================================================


Packman Mail Message:
=====================

$END TXT
