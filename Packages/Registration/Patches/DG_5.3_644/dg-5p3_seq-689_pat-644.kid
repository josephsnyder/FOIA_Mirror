Released DG*5.3*644 SEQ #689
Extracted from mail message
**KIDS**:DG*5.3*644^

**INSTALL NAME**
DG*5.3*644
"BLD",5914,0)
DG*5.3*644^REGISTRATION^0^3080409^y
"BLD",5914,4,0)
^9.64PA^391.31^1
"BLD",5914,4,391.31,0)
391.31
"BLD",5914,4,391.31,222)
y^y^f^^^^n
"BLD",5914,4,"B",391.31,391.31)

"BLD",5914,6.3)
11
"BLD",5914,"ABPKG")
n
"BLD",5914,"INID")
^n
"BLD",5914,"INIT")
EN^DG53644P
"BLD",5914,"KRN",0)
^9.67PA^8989.52^19
"BLD",5914,"KRN",.4,0)
.4
"BLD",5914,"KRN",.401,0)
.401
"BLD",5914,"KRN",.402,0)
.402
"BLD",5914,"KRN",.403,0)
.403
"BLD",5914,"KRN",.5,0)
.5
"BLD",5914,"KRN",.84,0)
.84
"BLD",5914,"KRN",3.6,0)
3.6
"BLD",5914,"KRN",3.8,0)
3.8
"BLD",5914,"KRN",3.8,"NM",0)
^9.68A^1^1
"BLD",5914,"KRN",3.8,"NM",1,0)
DGHTERR^^0
"BLD",5914,"KRN",3.8,"NM","B","DGHTERR",1)

"BLD",5914,"KRN",9.2,0)
9.2
"BLD",5914,"KRN",9.8,0)
9.8
"BLD",5914,"KRN",9.8,"NM",0)
^9.68A^11^9
"BLD",5914,"KRN",9.8,"NM",1,0)
DGHTENR^^0^B67958013
"BLD",5914,"KRN",9.8,"NM",2,0)
DGHTHL7^^0^B50017254
"BLD",5914,"KRN",9.8,"NM",3,0)
DGHTRPT^^0^B35941394
"BLD",5914,"KRN",9.8,"NM",5,0)
DGHTINAC^^0^B40701300
"BLD",5914,"KRN",9.8,"NM",6,0)
DGHTRPT1^^0^B28040554
"BLD",5914,"KRN",9.8,"NM",7,0)
DGHTHLAA^^0^B13204379
"BLD",5914,"KRN",9.8,"NM",8,0)
DG53644P^^0^B48503489
"BLD",5914,"KRN",9.8,"NM",10,0)
DGHTXREF^^0^B2276969
"BLD",5914,"KRN",9.8,"NM",11,0)
DGHTRTX^^0^B14862223
"BLD",5914,"KRN",9.8,"NM","B","DG53644P",8)

"BLD",5914,"KRN",9.8,"NM","B","DGHTENR",1)

"BLD",5914,"KRN",9.8,"NM","B","DGHTHL7",2)

"BLD",5914,"KRN",9.8,"NM","B","DGHTHLAA",7)

"BLD",5914,"KRN",9.8,"NM","B","DGHTINAC",5)

"BLD",5914,"KRN",9.8,"NM","B","DGHTRPT",3)

"BLD",5914,"KRN",9.8,"NM","B","DGHTRPT1",6)

"BLD",5914,"KRN",9.8,"NM","B","DGHTRTX",11)

"BLD",5914,"KRN",9.8,"NM","B","DGHTXREF",10)

"BLD",5914,"KRN",19,0)
19
"BLD",5914,"KRN",19,"NM",0)
^9.68A^13^6
"BLD",5914,"KRN",19,"NM",5,0)
DGHT HOME TELEHEALTH^^0
"BLD",5914,"KRN",19,"NM",6,0)
DGHT PATIENT INACTIVATION^^0
"BLD",5914,"KRN",19,"NM",7,0)
DGHT PATIENT SIGNUP^^0
"BLD",5914,"KRN",19,"NM",9,0)
DGHT TRANSMISSION REPORT^^0
"BLD",5914,"KRN",19,"NM",12,0)
DGHT SUMMARY REPORT^^0
"BLD",5914,"KRN",19,"NM",13,0)
DGHT HL7 MESSAGE MONITOR^^0
"BLD",5914,"KRN",19,"NM","B","DGHT HL7 MESSAGE MONITOR",13)

"BLD",5914,"KRN",19,"NM","B","DGHT HOME TELEHEALTH",5)

"BLD",5914,"KRN",19,"NM","B","DGHT PATIENT INACTIVATION",6)

"BLD",5914,"KRN",19,"NM","B","DGHT PATIENT SIGNUP",7)

"BLD",5914,"KRN",19,"NM","B","DGHT SUMMARY REPORT",12)

"BLD",5914,"KRN",19,"NM","B","DGHT TRANSMISSION REPORT",9)

"BLD",5914,"KRN",19.1,0)
19.1
"BLD",5914,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",5914,"KRN",101,0)
101
"BLD",5914,"KRN",101,"NM",0)
^9.68A^4^4
"BLD",5914,"KRN",101,"NM",1,0)
DG HOME TELEHEALTH ADT-A03 CLIENT^^0
"BLD",5914,"KRN",101,"NM",2,0)
DG HOME TELEHEALTH ADT-A03 SERVER^^0
"BLD",5914,"KRN",101,"NM",3,0)
DG HOME TELEHEALTH ADT-A04 CLIENT^^0
"BLD",5914,"KRN",101,"NM",4,0)
DG HOME TELEHEALTH ADT-A04 SERVER^^0
"BLD",5914,"KRN",101,"NM","B","DG HOME TELEHEALTH ADT-A03 CLIENT",1)

"BLD",5914,"KRN",101,"NM","B","DG HOME TELEHEALTH ADT-A03 SERVER",2)

"BLD",5914,"KRN",101,"NM","B","DG HOME TELEHEALTH ADT-A04 CLIENT",3)

"BLD",5914,"KRN",101,"NM","B","DG HOME TELEHEALTH ADT-A04 SERVER",4)

"BLD",5914,"KRN",409.61,0)
409.61
"BLD",5914,"KRN",771,0)
771
"BLD",5914,"KRN",771,"NM",0)
^9.68A^4^2
"BLD",5914,"KRN",771,"NM",3,0)
DG HOME TELEHEALTH^^0
"BLD",5914,"KRN",771,"NM",4,0)
HTAPPL^^0
"BLD",5914,"KRN",771,"NM","B","DG HOME TELEHEALTH",3)

"BLD",5914,"KRN",771,"NM","B","HTAPPL",4)

"BLD",5914,"KRN",870,0)
870
"BLD",5914,"KRN",870,"NM",0)
^9.68A^7^6
"BLD",5914,"KRN",870,"NM",1,0)
DG HT AMD^^0
"BLD",5914,"KRN",870,"NM",2,0)
DG HT ATI^^0
"BLD",5914,"KRN",870,"NM",3,0)
DG HT VIT^^0
"BLD",5914,"KRN",870,"NM",4,0)
DG HT VN^^0
"BLD",5914,"KRN",870,"NM",6,0)
DG HTH^^0
"BLD",5914,"KRN",870,"NM",7,0)
DG HT HH^^0
"BLD",5914,"KRN",870,"NM","B","DG HT AMD",1)

"BLD",5914,"KRN",870,"NM","B","DG HT ATI",2)

"BLD",5914,"KRN",870,"NM","B","DG HT HH",7)

"BLD",5914,"KRN",870,"NM","B","DG HT VIT",3)

"BLD",5914,"KRN",870,"NM","B","DG HT VN",4)

"BLD",5914,"KRN",870,"NM","B","DG HTH",6)

"BLD",5914,"KRN",8989.51,0)
8989.51
"BLD",5914,"KRN",8989.51,"NM",0)
^9.68A^3^3
"BLD",5914,"KRN",8989.51,"NM",1,0)
DG HTH # OF RETRANSMITS^^0
"BLD",5914,"KRN",8989.51,"NM",2,0)
DG HTH DEFAULT WAIT TIME^^0
"BLD",5914,"KRN",8989.51,"NM",3,0)
DG HTH EXTENDED WAIT TIME^^0
"BLD",5914,"KRN",8989.51,"NM","B","DG HTH # OF RETRANSMITS",1)

"BLD",5914,"KRN",8989.51,"NM","B","DG HTH DEFAULT WAIT TIME",2)

"BLD",5914,"KRN",8989.51,"NM","B","DG HTH EXTENDED WAIT TIME",3)

"BLD",5914,"KRN",8989.52,0)
8989.52
"BLD",5914,"KRN",8994,0)
8994
"BLD",5914,"KRN","B",.4,.4)

"BLD",5914,"KRN","B",.401,.401)

"BLD",5914,"KRN","B",.402,.402)

"BLD",5914,"KRN","B",.403,.403)

"BLD",5914,"KRN","B",.5,.5)

"BLD",5914,"KRN","B",.84,.84)

"BLD",5914,"KRN","B",3.6,3.6)

"BLD",5914,"KRN","B",3.8,3.8)

"BLD",5914,"KRN","B",9.2,9.2)

"BLD",5914,"KRN","B",9.8,9.8)

"BLD",5914,"KRN","B",19,19)

"BLD",5914,"KRN","B",19.1,19.1)

"BLD",5914,"KRN","B",101,101)

"BLD",5914,"KRN","B",409.61,409.61)

"BLD",5914,"KRN","B",771,771)

"BLD",5914,"KRN","B",870,870)

"BLD",5914,"KRN","B",8989.51,8989.51)

"BLD",5914,"KRN","B",8989.52,8989.52)

"BLD",5914,"KRN","B",8994,8994)

"BLD",5914,"QUES",0)
^9.62^^
"BLD",5914,"REQB",0)
^9.611^1^1
"BLD",5914,"REQB",1,0)
GMRC*3.0*42^2
"BLD",5914,"REQB","B","GMRC*3.0*42",1)

"FIA",391.31)
HOME TELEHEALTH PATIENT
"FIA",391.31,0)
^DGHT(391.31,
"FIA",391.31,0,0)
391.31
"FIA",391.31,0,1)
y^y^f^^^^n
"FIA",391.31,0,10)

"FIA",391.31,0,11)

"FIA",391.31,0,"RLRO")

"FIA",391.31,0,"VR")
5.3^DG
"FIA",391.31,391.31)
0
"FIA",391.31,391.317)
0
"INIT")
EN^DG53644P
"IX",391.31,391.31,"APATVN",0)
391.31^APATVN^Xrefer on patient & vendor.^MU^^R^IR^I^391.31^^^^^A
"IX",391.31,391.31,"APATVN",.1,0)
^^3^3^3050202^
"IX",391.31,391.31,"APATVN",.1,1,0)
This is a new style crossreference created based on patient IEN and vendor 
"IX",391.31,391.31,"APATVN",.1,2,0)
IEN.  The patient IEN is a pointer to file #2 and the vendor IEN is a 
"IX",391.31,391.31,"APATVN",.1,3,0)
pointer to file #4.
"IX",391.31,391.31,"APATVN",1)
S ^DGHT(391.31,"APATVN",X(1),X(2),DA)=""
"IX",391.31,391.31,"APATVN",2)
K ^DGHT(391.31,"APATVN",X(1),X(2),DA)
"IX",391.31,391.31,"APATVN",11.1,0)
^.114IA^2^2
"IX",391.31,391.31,"APATVN",11.1,1,0)
1^F^391.31^1^99^1^F
"IX",391.31,391.31,"APATVN",11.1,1,3)

"IX",391.31,391.31,"APATVN",11.1,2,0)
2^F^391.31^2^99^2^F
"IX",391.31,391.31,"APATVN",11.1,2,3)

"KRN",3.8,341,-1)
0^1
"KRN",3.8,341,0)
DGHTERR^PU^^^^^
"KRN",3.8,341,2,0)
^3.801^2^2^3080409^^^^
"KRN",3.8,341,2,1,0)
This mail group is used to send reject messages for Home Telehealth 
"KRN",3.8,341,2,2,0)
Registrations. 
"KRN",3.8,341,3)

"KRN",3.8,341,5,0)
^3.811P^^0
"KRN",19,13048,-1)
0^5
"KRN",19,13048,0)
DGHT HOME TELEHEALTH^Home Telehealth Menu^Activation of option requires OCC approval.^M^^^^^^^^REGISTRATION
"KRN",19,13048,1,0)
^^4^4^3070920^
"KRN",19,13048,1,1,0)
This option is used to sign-up and deactivate patients that are eligible 
"KRN",19,13048,1,2,0)
for Home Telehealth care provided by a vendor.  This option is also used 
"KRN",19,13048,1,3,0)
to generate HL7 messages to send to the appropriate Home Telehealth 
"KRN",19,13048,1,4,0)
vendor server system via the Austin Interface Engine.
"KRN",19,13048,10,0)
^19.01IP^4^4
"KRN",19,13048,10,1,0)
13049^SU^10
"KRN",19,13048,10,1,"^")
DGHT PATIENT SIGNUP
"KRN",19,13048,10,2,0)
13050^IN^20
"KRN",19,13048,10,2,"^")
DGHT PATIENT INACTIVATION
"KRN",19,13048,10,3,0)
13051^PR^30
"KRN",19,13048,10,3,"^")
DGHT SUMMARY REPORT
"KRN",19,13048,10,4,0)
13052^TR^40
"KRN",19,13048,10,4,"^")
DGHT TRANSMISSION REPORT
"KRN",19,13048,99)
61094,32984
"KRN",19,13048,"U")
HOME TELEHEALTH MENU
"KRN",19,13049,-1)
0^7
"KRN",19,13049,0)
DGHT PATIENT SIGNUP^Patient Sign-Up/Activation^Activation of option requires OCC approval.^R^^^^^^^^REGISTRATION
"KRN",19,13049,1,0)
^19.06^4^4^3070920^^^^
"KRN",19,13049,1,1,0)
This option is used to sign-up patients eligible for Home Telehealth care 
"KRN",19,13049,1,2,0)
provided by a vendor.  Once okayed for transmission, an A04 type HL7 
"KRN",19,13049,1,3,0)
messages will be generated and sent to the appropriate Home Telehealth 
"KRN",19,13049,1,4,0)
vendor server via the Austin Interface Engine.
"KRN",19,13049,25)
DGHTENR
"KRN",19,13049,"U")
PATIENT SIGN-UP/ACTIVATION
"KRN",19,13050,-1)
0^6
"KRN",19,13050,0)
DGHT PATIENT INACTIVATION^Patient Inactivation^Activation of option requires OCC approval.^R^^^^^^^^REGISTRATION
"KRN",19,13050,1,0)
^19.06^4^4^3050608^^
"KRN",19,13050,1,1,0)
This option is used to deactivate patients from Home Telehealth care
"KRN",19,13050,1,2,0)
provided by a vendor.  Once okayed for transmission, A03 type HL7 message
"KRN",19,13050,1,3,0)
will be generated and sent to the appropriate Home Telehealth vendor server 
"KRN",19,13050,1,4,0)
via the Austin Interface Engine.
"KRN",19,13050,25)
EN^DGHTINAC
"KRN",19,13050,"U")
PATIENT INACTIVATION
"KRN",19,13051,-1)
0^12
"KRN",19,13051,0)
DGHT SUMMARY REPORT^Patient Summary Report^Activation of option requires OCC approval.^R^^^^^^^^REGISTRATION
"KRN",19,13051,1,0)
^19.06^7^7^3050316^^^^
"KRN",19,13051,1,1,0)
This report gives a summary of all patients that have been signed up for 
"KRN",19,13051,1,2,0)
Home Telehealth for a specified date range.  The report includes:-
"KRN",19,13051,1,3,0)
      o  Patient Name
"KRN",19,13051,1,4,0)
      o  Status (Active/Inactivate)
"KRN",19,13051,1,5,0)
      o  Date of Last Change
"KRN",19,13051,1,6,0)
      o  Vendor
"KRN",19,13051,1,7,0)
      o  Total # of Home Telehealth patients
"KRN",19,13051,25)
DGHTRPT1
"KRN",19,13051,"U")
PATIENT SUMMARY REPORT
"KRN",19,13052,-1)
0^9
"KRN",19,13052,0)
DGHT TRANSMISSION REPORT^Transmission Report^Activation of option requires OCC approval.^R^^^^^^^^REGISTRATION
"KRN",19,13052,1,0)
^^2^2^3050223^
"KRN",19,13052,1,1,0)
This report provides detail information of patient information transmitted to 
"KRN",19,13052,1,2,0)
Home Telehealth vendor servers for a specified date range.
"KRN",19,13052,25)
DGHTRPT
"KRN",19,13052,"U")
TRANSMISSION REPORT
"KRN",19,13162,-1)
0^13
"KRN",19,13162,0)
DGHT HL7 MESSAGE MONITOR^Home Telehealth HL7 Message Monitor^^R^^^^^^^^REGISTRATION^^
"KRN",19,13162,1,0)
^19.06^7^7^3060522^^
"KRN",19,13162,1,1,0)
This option monitors HL7 messages that were transmitted to home telehealth
"KRN",19,13162,1,2,0)
vendors. The rescheduling frequency should coincide with the Parameters
"KRN",19,13162,1,3,0)
Definition file (#8989.51). The default value is 15 minutes, but it can be
"KRN",19,13162,1,4,0)
changed by the site. The option orders thru the Home Telehealth file 
"KRN",19,13162,1,5,0)
(#391.31) and tries to find messages that have not received AAs within a
"KRN",19,13162,1,6,0)
predetermined amount of time. If it finds any HL7 messages that meet the
"KRN",19,13162,1,7,0)
criteria, it retransmits the messages.
"KRN",19,13162,20)

"KRN",19,13162,25)
EN^DGHTRTX
"KRN",19,13162,"U")
HOME TELEHEALTH HL7 MESSAGE MO
"KRN",101,15458,-1)
0^3
"KRN",101,15458,0)
DG HOME TELEHEALTH ADT-A04 CLIENT^HOME TELEHEALTH CLIENT^^S^^^^^^^^
"KRN",101,15458,1,0)
^^1^1^3050208^
"KRN",101,15458,1,1,0)
HL7 subscriber (client) protocol for transmission to AAC's VIE server.
"KRN",101,15458,99)
59896,60551
"KRN",101,15458,770)
^HTAPPL^^A04^^^^^^^ACK
"KRN",101,15458,771)

"KRN",101,15458,773)
1^1^0
"KRN",101,15458,774)
Q
"KRN",101,15459,-1)
0^4
"KRN",101,15459,0)
DG HOME TELEHEALTH ADT-A04 SERVER^HOME TELEHEALTH SERVER^^E^^^^^^^^
"KRN",101,15459,1,0)
^^1^1^3050304^^
"KRN",101,15459,1,1,0)
HL7 subscriber (server) protocol for transmission to AAC's VIE server.
"KRN",101,15459,99)
59897,58714
"KRN",101,15459,770)
DG HOME TELEHEALTH^^ADT^A04^1^^^AL^AL^2.4^
"KRN",101,15459,772)
D ACKMSG^DGHTHLAA
"KRN",101,15459,775,0)
^101.0775PA^1^1
"KRN",101,15459,775,1,0)
15458
"KRN",101,15459,775,1,"^")
DG HOME TELEHEALTH ADT-A04 CLIENT
"KRN",101,15477,-1)
0^2
"KRN",101,15477,0)
DG HOME TELEHEALTH ADT-A03 SERVER^HOME TELEHEALTH SERVER^^E^^^^^^^^
"KRN",101,15477,1,0)
^101.06^1^1^3050304^^^^
"KRN",101,15477,1,1,0)
HL7 subscriber (server) protocol for transmission to AAC's VIE server.
"KRN",101,15477,99)
59939,36207
"KRN",101,15477,770)
DG HOME TELEHEALTH^^ADT^A03^3^^^AL^AL^2.4^
"KRN",101,15477,772)
D ACKMSG^DGHTHLAA
"KRN",101,15477,775,0)
^101.0775PA^1^1
"KRN",101,15477,775,1,0)
15478
"KRN",101,15477,775,1,"^")
DG HOME TELEHEALTH ADT-A03 CLIENT
"KRN",101,15478,-1)
0^1
"KRN",101,15478,0)
DG HOME TELEHEALTH ADT-A03 CLIENT^HOME TELEHEALTH CLIENT^^S^^^^^^^^
"KRN",101,15478,1,0)
^^1^1^3051005^^^
"KRN",101,15478,1,1,0)
HL7 subscriber (client) protocol for transmission to AAC's VIE server.
"KRN",101,15478,99)
59939,36329
"KRN",101,15478,770)
^HTAPPL^^A03^^^^^^^ACK
"KRN",101,15478,773)
1^1^0
"KRN",771,134,-1)
0^3
"KRN",771,134,0)
DG HOME TELEHEALTH^a^^DGHTERR^^^USA
"KRN",771,146,-1)
0^4
"KRN",771,146,0)
HTAPPL^^^DGHTERR
"KRN",771,146,"SEG",0)
^771.05P
"KRN",870,206,-1)
0^6
"KRN",870,206,0)
DG HTH^^TCP^^^^^^^^^^^^^^^^^^10
"KRN",870,206,200)
^^^^^^^^^R
"KRN",870,206,400)
10.1.1.1^8090^C^^^
"KRN",870,232,-1)
0^7
"KRN",870,232,0)
DG HT HH^TELEHEALTH HEALTH HERO^TCP^^^^^^^^^^^^^^^^^^10
"KRN",870,232,200)
^^^^^^^^^R
"KRN",870,232,400)
10.224.49.7^5121^C^^^
"KRN",870,233,-1)
0^1
"KRN",870,233,0)
DG HT AMD^TELEHEALTH AMD^TCP^^^^^^^^^^^^^^^^^^10
"KRN",870,233,200)
^^^^^^^^^R
"KRN",870,233,400)
10.224.63.136^5121^C^^^
"KRN",870,234,-1)
0^2
"KRN",870,234,0)
DG HT ATI^TELEHEALTH AMERICAN TELECARE^TCP^^^^^^^^^^^^^^^^^^10
"KRN",870,234,200)
^^^^^^^^^R
"KRN",870,234,400)
10.224.63.136^5121^C^^^
"KRN",870,235,-1)
0^4
"KRN",870,235,0)
DG HT VN^TELEHEALTH VITEL NET^TCP^^^^^^^^^^^^^^^^^^10
"KRN",870,235,200)
^^^^^^^^^R
"KRN",870,235,400)
10.224.63.68^5121^C^^^
"KRN",870,236,-1)
0^3
"KRN",870,236,0)
DG HT VIT^TELEHEALTH VITERION^TCP^^^^^^^^^^^^^^^^^^10
"KRN",870,236,200)
^^^^^^^^^R
"KRN",870,236,400)
10.224.64.10^5121^C^^^
"KRN",8989.51,385,-1)
0^2
"KRN",8989.51,385,0)
DG HTH DEFAULT WAIT TIME^Enter time in minutes to wait for AAs^0^^DEFAULT TIME FOR AWAITING AA^0
"KRN",8989.51,385,1)
N^1:999^Enter number of minutes to wait for application acknowledgements.
"KRN",8989.51,385,30,0)
^8989.513I^1^1
"KRN",8989.51,385,30,1,0)
1^4.2
"KRN",8989.51,386,-1)
0^1
"KRN",8989.51,386,0)
DG HTH # OF RETRANSMITS^Enter number of retransmissions attempts^^^Enter number of retransmission attempts^0
"KRN",8989.51,386,1)
N^1:999^Enter the number retransmissions to attempt
"KRN",8989.51,386,30,0)
^8989.513I^1^1
"KRN",8989.51,386,30,1,0)
1^4.2
"KRN",8989.51,432,-1)
0^3
"KRN",8989.51,432,0)
DG HTH EXTENDED WAIT TIME^Enter extended wait time to wait for AAs^0^^EXTENDED TIME TO WAIT FOR AA
"KRN",8989.51,432,1)
N^1:999^Enter the number of extended minutes to wait for application acknowledgements.
"KRN",8989.51,432,30,0)
^8989.513I^1^1
"KRN",8989.51,432,30,1,0)
1^4.2
"MBREQ")
0
"ORD",11,3.8)
3.8;11;;;MAILG^XPDTA1;MAILGF1^XPDIA1;MAILGE1^XPDIA1;MAILGF2^XPDIA1;;MAILGDEL^XPDIA1(%)
"ORD",11,3.8,0)
MAIL GROUP
"ORD",13,870)
870;13;1;;HLLL^XPDTA1;;HLLLE^XPDIA1;;;HLLLDEL^XPDIA1(%)
"ORD",13,870,0)
HL LOGICAL LINK
"ORD",14,771)
771;14;;;HLAP^XPDTA1;HLAPF1^XPDIA1;HLAPE1^XPDIA1;HLAPF2^XPDIA1;;HLAPDEL^XPDIA1(%)
"ORD",14,771,0)
HL7 APPLICATION PARAMETER
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"ORD",20,8989.51)
8989.51;20;;;PAR1E1^XPDTA2;PAR1F1^XPDIA3;PAR1E1^XPDIA3;PAR1F2^XPDIA3;;PAR1DEL^XPDIA3(%)
"ORD",20,8989.51,0)
PARAMETER DEFINITION
"PKG",114,-1)
1^1
"PKG",114,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",114,20,0)
^9.402P^^
"PKG",114,22,0)
^9.49I^1^1
"PKG",114,22,1,0)
5.3^2930813^2930821
"PKG",114,22,1,"PAH",1,0)
644^3080409
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
9
"RTN","DG53644P")
0^8^B48503489^n/a
"RTN","DG53644P",1,0)
DG53644P ;BPFO/JRC - Home Telehealth Patient POST Install;10 January 2005 ; 4/8/08 10:02am
"RTN","DG53644P",2,0)
 ;;5.3;Registration;**644**;Aug 13, 1993;Build 11
"RTN","DG53644P",3,0)
 ;
"RTN","DG53644P",4,0)
EN ;Main entry point
"RTN","DG53644P",5,0)
 ;Init variables
"RTN","DG53644P",6,0)
 N VIEIP,LINK,DGARRAY,SITE,FLAG,RESPONSE
"RTN","DG53644P",7,0)
 S DGARRAY="^TMP(""DGHT"",$J,""IPARRAY"")"
"RTN","DG53644P",8,0)
 S SITE=+$P($$SITE^VASITE(),U,3),(LINK,RESPONSE)=0
"RTN","DG53644P",9,0)
 ;
"RTN","DG53644P",10,0)
 ;Setup ip address array
"RTN","DG53644P",11,0)
 D ARRAY
"RTN","DG53644P",12,0)
 ;
"RTN","DG53644P",13,0)
 ;Resolve ip address to use
"RTN","DG53644P",14,0)
 S VIEIP="",VIEIP=$O(@DGARRAY@(SITE,VIEIP))
"RTN","DG53644P",15,0)
 ;
"RTN","DG53644P",16,0)
 ;No ip address resolved, enter manually? if flag = 1 abort
"RTN","DG53644P",17,0)
 I VIEIP="" D ASKYN I 'RESPONSE D ERRMSG K @DGARRAY Q
"RTN","DG53644P",18,0)
 ;
"RTN","DG53644P",19,0)
 ;If response = 1, enter ip adress manually if flag = 1 abort
"RTN","DG53644P",20,0)
 I RESPONSE S VIEIP=0 D ASKIP I 'VIEIP D ERRMSG K @DGARRAY Q
"RTN","DG53644P",21,0)
 ;
"RTN","DG53644P",22,0)
 ;Order thru HL Logical Link file and retrieve IEN for 'DGHT' Link
"RTN","DG53644P",23,0)
 S LINK=$O(^HLCS(870,"B","DG HTH",LINK))
"RTN","DG53644P",24,0)
 ;
"RTN","DG53644P",25,0)
 ;If DG HTH logical link not found display message and quit
"RTN","DG53644P",26,0)
 I 'LINK K @DGARRAY D ERRMSG Q
"RTN","DG53644P",27,0)
 ;
"RTN","DG53644P",28,0)
 ;Update HL Logical Link file (#870)
"RTN","DG53644P",29,0)
 D BMES^XPDUTL("DG HTH Logical Link has been found ")
"RTN","DG53644P",30,0)
 D BMES^XPDUTL("Updating IP Address field (#400.01) ")
"RTN","DG53644P",31,0)
 I VIEIP D
"RTN","DG53644P",32,0)
 .;Prepare DIE filer call
"RTN","DG53644P",33,0)
 .N DGHFDA,DGHERR
"RTN","DG53644P",34,0)
 .S DGHFDA(870,LINK_",",400.01)=VIEIP
"RTN","DG53644P",35,0)
 .D FILE^DIE("EK","DGHFDA","DGHERR")
"RTN","DG53644P",36,0)
 .I $D(DGHERR) D ERRMSG Q
"RTN","DG53644P",37,0)
 .D BMES^XPDUTL("DG HTH Logical Link ip address updated successfully. ")
"RTN","DG53644P",38,0)
 D MENUS
"RTN","DG53644P",39,0)
 Q
"RTN","DG53644P",40,0)
 ;
"RTN","DG53644P",41,0)
ARRAY ;Set VIE IP Address Array
"RTN","DG53644P",42,0)
 ;Input  : DGARRAY - ip address array
"RTN","DG53644P",43,0)
 ;Output : VIE ip address array
"RTN","DG53644P",44,0)
 ;         @DGARRAY@(station,VieIpAddress) =  ""
"RTN","DG53644P",45,0)
 N OFF,TEXT,STATION,IP
"RTN","DG53644P",46,0)
 F OFF=1:1 S TEXT=$P($T(TABLE+OFF),";;",2) Q:TEXT="END"  D
"RTN","DG53644P",47,0)
 .S STATION=$P(TEXT,"^",1),IP=$P(TEXT,"^",2)
"RTN","DG53644P",48,0)
 .I STATION=""!(IP="") Q
"RTN","DG53644P",49,0)
 .S @DGARRAY@(STATION,IP)=""
"RTN","DG53644P",50,0)
 Q
"RTN","DG53644P",51,0)
 ;
"RTN","DG53644P",52,0)
ASKIP ;Prompt user for VIE IP address
"RTN","DG53644P",53,0)
 N DIR,DIRUT,X,Y
"RTN","DG53644P",54,0)
 S DIR(0)="F^^K:X'?1.3N1"".""1.3N1"".""1.3N1"".""1.3N X"
"RTN","DG53644P",55,0)
 S DIR("?",1)="Enter a valid IP address using the following format: nnn.nnn.nnn.nnn"
"RTN","DG53644P",56,0)
 S DIR("?")="Or '??' for a list of available station numbers & IP addresses."
"RTN","DG53644P",57,0)
 S DIR("??")="^D VIEHELP^DG53644P"
"RTN","DG53644P",58,0)
 S DIR("A")="Enter local VIE IP address"
"RTN","DG53644P",59,0)
 D ^DIR
"RTN","DG53644P",60,0)
 I $D(DIRUT) Q
"RTN","DG53644P",61,0)
 S VIEIP=Y
"RTN","DG53644P",62,0)
 Q
"RTN","DG53644P",63,0)
 ;
"RTN","DG53644P",64,0)
VIEHELP ;Help text listing Local VIE address"
"RTN","DG53644P",65,0)
 N OFF,TEXT,IP
"RTN","DG53644P",66,0)
 F OFF=1:1 S TEXT=$P($T(TABLE+OFF),";;",2) Q:TEXT="END"  D
"RTN","DG53644P",67,0)
 .S STATION=$P(TEXT,"^",1),IP=$P(TEXT,"^",2)
"RTN","DG53644P",68,0)
 .I STATION=""!(IP="") Q
"RTN","DG53644P",69,0)
 .W ?3,STATION,?12,IP,!
"RTN","DG53644P",70,0)
 Q
"RTN","DG53644P",71,0)
ASKYN ;Ask user if they want to enter IP address manually
"RTN","DG53644P",72,0)
 N DIR,DIRUT,X,Y
"RTN","DG53644P",73,0)
 S DIR(0)="Y"
"RTN","DG53644P",74,0)
 S DIR("A",1)="Unable to resolve VIE IP address."
"RTN","DG53644P",75,0)
 S DIR("A")="Would you like to enter it manually"
"RTN","DG53644P",76,0)
 D ^DIR
"RTN","DG53644P",77,0)
 I $D(DIRUT)!('Y) S FLAG=1 Q
"RTN","DG53644P",78,0)
 S RESPONSE=Y
"RTN","DG53644P",79,0)
 Q
"RTN","DG53644P",80,0)
 ;
"RTN","DG53644P",81,0)
ERRMSG ;Problem encountered updating IP address notify user
"RTN","DG53644P",82,0)
 D BMES^XPDUTL("DG HTH Logical Link's IP address was not updated. ")
"RTN","DG53644P",83,0)
 D MES^XPDUTL("See patch description for instructions on how ")
"RTN","DG53644P",84,0)
 D MES^XPDUTL("to update the IP address at a later time. ")
"RTN","DG53644P",85,0)
 Q
"RTN","DG53644P",86,0)
 ;
"RTN","DG53644P",87,0)
MENUS ;Place HTH menu options out of order
"RTN","DG53644P",88,0)
 N OPTION,MENU,TEXT
"RTN","DG53644P",89,0)
 ;Delete HTH main menu from registration options.
"RTN","DG53644P",90,0)
 S OPTION="DGHT HOME TELEHEALTH"
"RTN","DG53644P",91,0)
 F MENU="DG REGISTRATION MENU","DG SUPERVISOR MENU" D
"RTN","DG53644P",92,0)
 .D DELETE^XPDMENU(MENU,OPTION)
"RTN","DG53644P",93,0)
 D BMES^XPDUTL("Implementation of HTH requires OCC coordination/approval; hence the following")
"RTN","DG53644P",94,0)
 D BMES^XPDUTL("list of HTH menu options have been placed out of order by the installation.")
"RTN","DG53644P",95,0)
 S OPTION="",TEXT="Activation of option requires OCC approval."
"RTN","DG53644P",96,0)
 F OPTION="DGHT HOME TELEHEALTH","DGHT PATIENT SIGNUP","DGHT PATIENT INACTIVATION","DGHT SUMMARY REPORT","DGHT TRANSMISSION REPORT" D
"RTN","DG53644P",97,0)
 .D OUT^XPDMENU(OPTION,TEXT)
"RTN","DG53644P",98,0)
 .D BMES^XPDUTL("["_OPTION_"]")
"RTN","DG53644P",99,0)
 Q
"RTN","DG53644P",100,0)
TABLE ;VIE IP address array table syntax - station ^ vie ip
"RTN","DG53644P",101,0)
 ;;516^10.64.10.136
"RTN","DG53644P",102,0)
 ;;660^10.154.2.54
"RTN","DG53644P",103,0)
 ;;657^10.123.139.63
"RTN","DG53644P",104,0)
 ;;613^10.40.106.46
"RTN","DG53644P",105,0)
 ;;528^10.21.253.165
"RTN","DG53644P",106,0)
 ;;HEC^10.61.193.83
"RTN","DG53644P",107,0)
 ;;528^10.21.253.169
"RTN","DG53644P",108,0)
 ;;HEC^10.61.193.88
"RTN","DG53644P",109,0)
 ;;688^10.41.0.18
"RTN","DG53644P",110,0)
 ;;518^10.8.66.64
"RTN","DG53644P",111,0)
 ;;523^10.9.0.99
"RTN","DG53644P",112,0)
 ;;650^10.11.1.30
"RTN","DG53644P",113,0)
 ;;689^10.12.8.37
"RTN","DG53644P",114,0)
 ;;580^10.133.188.116
"RTN","DG53644P",115,0)
 ;;517^10.50.50.24
"RTN","DG53644P",116,0)
 ;;608^10.8.143.73
"RTN","DG53644P",117,0)
 ;;561^10.30.21.175
"RTN","DG53644P",118,0)
 ;;503^10.32.11.27
"RTN","DG53644P",119,0)
 ;;558^10.48.138.44
"RTN","DG53644P",120,0)
 ;;402^10.14.128.29
"RTN","DG53644P",121,0)
 ;;620^10.30.21.180
"RTN","DG53644P",122,0)
 ;;529^10.32.129.50
"RTN","DG53644P",123,0)
 ;;589^10.120.137.84
"RTN","DG53644P",124,0)
 ;;526^10.30.21.185
"RTN","DG53644P",125,0)
 ;;512^10.42.14.165
"RTN","DG53644P",126,0)
 ;;637^10.50.148.34
"RTN","DG53644P",127,0)
 ;;540^10.33.120.113
"RTN","DG53644P",128,0)
 ;;542^10.34.22.100
"RTN","DG53644P",129,0)
 ;;674^10.137.10.30
"RTN","DG53644P",130,0)
 ;;671^10.140.159.107
"RTN","DG53644P",131,0)
 ;;504^10.145.252.221
"RTN","DG53644P",132,0)
 ;;630^10.30.21.165
"RTN","DG53644P",133,0)
 ;;405^10.14.55.53
"RTN","DG53644P",134,0)
 ;;562^10.33.184.77
"RTN","DG53644P",135,0)
 ;;659^10.51.1.122
"RTN","DG53644P",136,0)
 ;;632^10.30.21.170
"RTN","DG53644P",137,0)
 ;;595^10.35.136.65
"RTN","DG53644P",138,0)
 ;;460^10.39.10.30
"RTN","DG53644P",139,0)
 ;;565^10.51.138.130
"RTN","DG53644P",140,0)
 ;;658^10.49.138.24
"RTN","DG53644P",141,0)
 ;;646^10.37.34.86
"RTN","DG53644P",142,0)
 ;;590^10.48.10.89
"RTN","DG53644P",143,0)
 ;;509^10.57.224.115
"RTN","DG53644P",144,0)
 ;;521^10.59.15.164
"RTN","DG53644P",145,0)
 ;;534^10.56.224.105
"RTN","DG53644P",146,0)
 ;;631^10.13.97.24
"RTN","DG53644P",147,0)
 ;;693^10.38.14.110
"RTN","DG53644P",148,0)
 ;;652^10.49.50.60
"RTN","DG53644P",149,0)
 ;;544^10.60.205.80
"RTN","DG53644P",150,0)
 ;;557^10.61.224.94
"RTN","DG53644P",151,0)
 ;;673^10.69.48.45
"RTN","DG53644P",152,0)
 ;;642^10.36.41.66
"RTN","DG53644P",153,0)
 ;;619^10.62.224.103
"RTN","DG53644P",154,0)
 ;;679^10.63.224.238
"RTN","DG53644P",155,0)
 ;;573^10.65.10.44
"RTN","DG53644P",156,0)
 ;;672^10.68.130.68
"RTN","DG53644P",157,0)
 ;;546^10.67.12.49
"RTN","DG53644P",158,0)
 ;;581^10.73.100.123
"RTN","DG53644P",159,0)
 ;;596^10.74.100.123
"RTN","DG53644P",160,0)
 ;;614^10.76.100.124
"RTN","DG53644P",161,0)
 ;;757^10.81.1.96
"RTN","DG53644P",162,0)
 ;;548^10.70.31.219
"RTN","DG53644P",163,0)
 ;;603^10.75.100.123
"RTN","DG53644P",164,0)
 ;;626^10.78.100.123
"RTN","DG53644P",165,0)
 ;;538^10.82.1.249
"RTN","DG53644P",166,0)
 ;;621^10.72.100.123
"RTN","DG53644P",167,0)
 ;;539^10.80.2.46
"RTN","DG53644P",168,0)
 ;;583^10.89.4.94
"RTN","DG53644P",169,0)
 ;;541^10.83.1.69
"RTN","DG53644P",170,0)
 ;;610^10.90.1.40
"RTN","DG53644P",171,0)
 ;;552^10.85.1.29
"RTN","DG53644P",172,0)
 ;;550^10.94.10.133
"RTN","DG53644P",173,0)
 ;;506^10.93.80.134
"RTN","DG53644P",174,0)
 ;;695^10.98.2.38
"RTN","DG53644P",175,0)
 ;;515^10.92.1.85
"RTN","DG53644P",176,0)
 ;;537^10.97.8.33
"RTN","DG53644P",177,0)
 ;;676^10.103.2.132
"RTN","DG53644P",178,0)
 ;;553^10.91.0.74
"RTN","DG53644P",179,0)
 ;;578^10.101.1.64
"RTN","DG53644P",180,0)
 ;;556^10.100.1.18
"RTN","DG53644P",181,0)
 ;;607^10.102.2.65
"RTN","DG53644P",182,0)
 ;;655^10.88.63.68
"RTN","DG53644P",183,0)
 ;;502^10.129.24.29
"RTN","DG53644P",184,0)
 ;;598^10.128.5.226
"RTN","DG53644P",185,0)
 ;;586^10.130.12.207
"RTN","DG53644P",186,0)
 ;;585^10.99.1.67
"RTN","DG53644P",187,0)
 ;;520^10.132.96.24
"RTN","DG53644P",188,0)
 ;;564^10.134.10.116
"RTN","DG53644P",189,0)
 ;;623^10.134.140.38
"RTN","DG53644P",190,0)
 ;;629^10.131.90.19
"RTN","DG53644P",191,0)
 ;;635^10.135.56.118
"RTN","DG53644P",192,0)
 ;;667^10.129.131.82
"RTN","DG53644P",193,0)
 ;;519^10.146.252.103
"RTN","DG53644P",194,0)
 ;;501^10.144.252.224
"RTN","DG53644P",195,0)
 ;;644^10.148.253.60
"RTN","DG53644P",196,0)
 ;;442^10.152.21.79
"RTN","DG53644P",197,0)
 ;;756^10.147.252.224
"RTN","DG53644P",198,0)
 ;;649^10.149.252.225
"RTN","DG53644P",199,0)
 ;;554^10.153.5.154
"RTN","DG53644P",200,0)
 ;;436^10.154.132.68
"RTN","DG53644P",201,0)
 ;;678^10.150.253.218
"RTN","DG53644P",202,0)
 ;;575^10.155.134.45
"RTN","DG53644P",203,0)
 ;;654^10.172.25.11
"RTN","DG53644P",204,0)
 ;;640^10.168.99.38
"RTN","DG53644P",205,0)
 ;;459^10.170.100.74
"RTN","DG53644P",206,0)
 ;;612^10.173.19.113
"RTN","DG53644P",207,0)
 ;;666^10.152.183.178
"RTN","DG53644P",208,0)
 ;;531^10.167.138.66
"RTN","DG53644P",209,0)
 ;;648^10.165.50.99
"RTN","DG53644P",210,0)
 ;;663^10.161.5.50
"RTN","DG53644P",211,0)
 ;;653^10.166.130.147
"RTN","DG53644P",212,0)
 ;;668^10.163.14.34
"RTN","DG53644P",213,0)
 ;;463^10.162.140.63
"RTN","DG53644P",214,0)
 ;;687^10.163.144.27
"RTN","DG53644P",215,0)
 ;;692^10.167.4.52
"RTN","DG53644P",216,0)
 ;;358^10.171.253.13
"RTN","DG53644P",217,0)
 ;;570^10.171.67.160
"RTN","DG53644P",218,0)
 ;;662^10.174.1.79
"RTN","DG53644P",219,0)
 ;;605^10.177.118.81
"RTN","DG53644P",220,0)
 ;;593^10.176.50.24
"RTN","DG53644P",221,0)
 ;;618^10.104.10.89
"RTN","DG53644P",222,0)
 ;;ALBANY^10.1.19.150
"RTN","DG53644P",223,0)
 ;;600^10.179.99.94
"RTN","DG53644P",224,0)
 ;;ALBANY CS LAB^10.1.19.155
"RTN","DG53644P",225,0)
 ;;SILVER SPRING^10.2.29.172
"RTN","DG53644P",226,0)
 ;;664^10.178.10.73
"RTN","DG53644P",227,0)
 ;;691^10.180.1.48
"RTN","DG53644P",228,0)
 ;;508^10.58.239.74
"RTN","DG53644P",229,0)
 ;;HDR AAC^10.224.132.23
"RTN","DG53644P",230,0)
 ;;HDR AAC^10.224.132.28
"RTN","DG53644P",231,0)
 ;;AAC^10.224.151.133
"RTN","DG53644P",232,0)
 ;;AAC^10.224.151.153
"RTN","DG53644P",233,0)
 ;;BAY PINES OIFO^10.4.229.88
"RTN","DG53644P",234,0)
 ;;HINES OIFO^10.3.21.43
"RTN","DG53644P",235,0)
 ;;BIRMINGHAM OIFO^10.4.21.25
"RTN","DG53644P",236,0)
 ;;SALT LAKE OIFO^10.5.21.86
"RTN","DG53644P",237,0)
 ;;BAY PINES OIFO IV&V TEST LAB^10.4.229.85
"RTN","DG53644P",238,0)
 ;;HINES OIFO EMC DATA CENTER^10.3.21.48
"RTN","DG53644P",239,0)
 ;;HAC^10.6.21.42
"RTN","DG53644P",240,0)
 ;;HAC^10.191.10.152
"RTN","DG53644P",241,0)
 ;;IE Team - Dev & Test^10.4.229.90
"RTN","DG53644P",242,0)
 ;;EMC Data Center^10.3.21.53
"RTN","DG53644P",243,0)
 ;;IE Team - Dev & Test^10.6.21.50
"RTN","DG53644P",244,0)
 ;;MPI^10.224.151.138
"RTN","DG53644P",245,0)
 ;;CMOP^10.189.77.163
"RTN","DG53644P",246,0)
 ;;CMOP^10.189.101.157
"RTN","DG53644P",247,0)
 ;;CMOP^10.189.1.17
"RTN","DG53644P",248,0)
 ;;CMOP^10.189.61.94
"RTN","DG53644P",249,0)
 ;;636^10.114.5.4
"RTN","DG53644P",250,0)
 ;;CMOP^10.189.101.34
"RTN","DG53644P",251,0)
 ;;CMOP^10.189.77.74
"RTN","DG53644P",252,0)
 ;;CMOP^10.189.37.38
"RTN","DG53644P",253,0)
 ;;549^10.138.65.55
"RTN","DG53644P",254,0)
 ;;ARC^10.191.1.58
"RTN","DG53644P",255,0)
 ;;PLANO TEST SERVER^10.6.208.19
"RTN","DG53644P",256,0)
 ;;541^10.83.59.125
"RTN","DG53644P",257,0)
 ;;END
"RTN","DGHTENR")
0^1^B67958013^n/a
"RTN","DGHTENR",1,0)
DGHTENR ;ALB/JAM - Home Telehealth Patient Sign-up;10 January 2005 ; 9/20/07 8:27am
"RTN","DGHTENR",2,0)
 ;;5.3;Registration;**644**;Aug 13, 1993;Build 11
"RTN","DGHTENR",3,0)
 ;
"RTN","DGHTENR",4,0)
EN N DGDFN,STOP,ARR,RESULT,DGVEN,DGPRV,DGCON,GETOK,DGHTH,DGMID,DGCHK,DGDEF
"RTN","DGHTENR",5,0)
 N DGEVNDT,VENDOR,DGTYPE
"RTN","DGHTENR",6,0)
 S ARR=$NA(HLA("HLS"))
"RTN","DGHTENR",7,0)
 S STOP=0
"RTN","DGHTENR",8,0)
 F  D  Q:STOP
"RTN","DGHTENR",9,0)
 .K DGHTH
"RTN","DGHTENR",10,0)
 .S DGHTH("DGTYPE")="A"
"RTN","DGHTENR",11,0)
 .;Get patient
"RTN","DGHTENR",12,0)
 .W !!
"RTN","DGHTENR",13,0)
 .S DGDFN=$$GETPAT() I 'DGDFN S STOP=1 Q
"RTN","DGHTENR",14,0)
 .S DGHTH("DFN")=DGDFN
"RTN","DGHTENR",15,0)
 .;Get receiving vendor
"RTN","DGHTENR",16,0)
 .S DGVEN=$$GETVEN() I 'DGVEN Q
"RTN","DGHTENR",17,0)
 .S DGHTH("VENDOR")=DGVEN
"RTN","DGHTENR",18,0)
 .;Check if Patient is already signed up
"RTN","DGHTENR",19,0)
 .S DGCHK=$$SGNUPCHK(.DGHTH)
"RTN","DGHTENR",20,0)
 .I 'DGCHK W "  ...Patient Sign-Up/Activation request terminated." Q
"RTN","DGHTENR",21,0)
 .;Get consult number
"RTN","DGHTENR",22,0)
 .S DGDEF=$G(DGHTH("CONSULT")),DGCON=$$GCONSULT(DGDFN,DGDEF) I 'DGCON Q
"RTN","DGHTENR",23,0)
 .S DGHTH("CONSULT")=DGCON
"RTN","DGHTENR",24,0)
 .;Get Care Coordinator
"RTN","DGHTENR",25,0)
 .S DGDEF=$G(DGHTH("COORD")),DGPRV=$$GETPROV(DGDEF) I 'DGPRV Q
"RTN","DGHTENR",26,0)
 .S DGHTH("COORD")=DGPRV
"RTN","DGHTENR",27,0)
 .;Get okay for transmission
"RTN","DGHTENR",28,0)
 .S GETOK=$$SNDMSG(DGHTH("DGTYPE"))
"RTN","DGHTENR",29,0)
 .I 'GETOK W "  ...Patient record not transmitted." Q
"RTN","DGHTENR",30,0)
 .;file patient data in #391.31
"RTN","DGHTENR",31,0)
 .S DGEVNDT=$$NOW^XLFDT(),DGHTH("EVENTDT")=DGEVNDT
"RTN","DGHTENR",32,0)
 .D FILE
"RTN","DGHTENR",33,0)
 .;build message
"RTN","DGHTENR",34,0)
 .W !!,"Generating HL7 message ..."
"RTN","DGHTENR",35,0)
 .K @ARR
"RTN","DGHTENR",36,0)
 .S RESULT=$$BLDHL7^DGHTHL7(.DGHTH,ARR)
"RTN","DGHTENR",37,0)
 .I +RESULT<0 D  Q
"RTN","DGHTENR",38,0)
 ..W !,"** UNABLE TO BUILD MESSAGE **",!,$P(RESULT,"^",2) K @ARR
"RTN","DGHTENR",39,0)
 .I RESULT=0 D  Q
"RTN","DGHTENR",40,0)
 ..W !,"** EMPTY MESSAGE BUILT **" K @ARR
"RTN","DGHTENR",41,0)
 .;send message
"RTN","DGHTENR",42,0)
 .W !,"Sending message ..."
"RTN","DGHTENR",43,0)
 .S RESULT=$$SNDHL7^DGHTHL7(ARR,DGVEN,"DG HOME TELEHEALTH ADT-A04 SERVER")
"RTN","DGHTENR",44,0)
 .I $P(RESULT,"^",2)'="" D  Q
"RTN","DGHTENR",45,0)
 ..W !,"** UNABLE TO SEND MESSAGE **"
"RTN","DGHTENR",46,0)
 ..W !,"Error Code: ",$P(RESULT,"^",2),"  Message: ",$P(RESULT,"^",3)
"RTN","DGHTENR",47,0)
 ..K @ARR
"RTN","DGHTENR",48,0)
 .;Update File #391.31 with message ID
"RTN","DGHTENR",49,0)
 .S DGMID=$P(RESULT,"^")
"RTN","DGHTENR",50,0)
 .D MIDUPD
"RTN","DGHTENR",51,0)
 .W !,"Sent using message ID ",$P(RESULT,"^")
"RTN","DGHTENR",52,0)
 .K @ARR
"RTN","DGHTENR",53,0)
 Q
"RTN","DGHTENR",54,0)
 ;
"RTN","DGHTENR",55,0)
SGNUPCHK(DGARY)        ;Check if patient already signed up & whether to 
"RTN","DGHTENR",56,0)
 ;continue signup for transmission
"RTN","DGHTENR",57,0)
 ;Input : Array with patient data with at least patient & vendor IEN
"RTN","DGHTENR",58,0)
 ;Output: 0 = Patient was signed up, terminate processing 
"RTN","DGHTENR",59,0)
 ;        1 = Continue processing
"RTN","DGHTENR",60,0)
 ;
"RTN","DGHTENR",61,0)
 N X,Y,DA,DA1,DAIEN,DGDAT,DTOUT,DUOUT,DIR
"RTN","DGHTENR",62,0)
 S X="" F  S X=$O(DGARY(X)) Q:X=""  D
"RTN","DGHTENR",63,0)
 .I DGARY(X)="" K DGARY(X) Q
"RTN","DGHTENR",64,0)
 .S @X=DGARY(X)
"RTN","DGHTENR",65,0)
 I '$G(DFN)!('$G(VENDOR))!($G(DGTYPE)="") Q 1
"RTN","DGHTENR",66,0)
 S DAIEN=$$LOCREC^DGHTINAC(DFN,VENDOR,DGTYPE)
"RTN","DGHTENR",67,0)
 I 'DAIEN Q 1
"RTN","DGHTENR",68,0)
 W @IOF,!,"PATIENT ALREADY SIGNED-UP/ACTIVATED WITH VENDOR",!!
"RTN","DGHTENR",69,0)
 D DSPREC(DAIEN)
"RTN","DGHTENR",70,0)
 S DIR(0)="Y",DIR("A")="Continue Patient Sign-Up/Activation",DIR("B")="No"
"RTN","DGHTENR",71,0)
 S DIR("?")="Enter NO to terminate sign-up/activation or YES to continue sign-up/activation."
"RTN","DGHTENR",72,0)
 D ^DIR I Y D
"RTN","DGHTENR",73,0)
 .S DGDAT=^DGHT(391.31,$P(DAIEN,"^"),0),DGARY("DA")=DAIEN
"RTN","DGHTENR",74,0)
 .S DGARY("CONSULT")=$P(DGDAT,"^",4),DGARY("COORD")=$P(DGDAT,"^",5)
"RTN","DGHTENR",75,0)
 W !
"RTN","DGHTENR",76,0)
 Q $S(+Y<0:0,1:+Y)
"RTN","DGHTENR",77,0)
 ;
"RTN","DGHTENR",78,0)
DSPREC(DGIEN) ;Display Home Telehealth record
"RTN","DGHTENR",79,0)
 ;Input : IEN and sub IEN for Home Telehealth files #391.31 & #391.317
"RTN","DGHTENR",80,0)
 ;Output: Displays record if found
"RTN","DGHTENR",81,0)
 ;
"RTN","DGHTENR",82,0)
 N DA,DA1,DGDAT,DGDAT1
"RTN","DGHTENR",83,0)
 I $G(DGIEN)="" Q
"RTN","DGHTENR",84,0)
 S DA=$P(DGIEN,"^"),DA1=$P(DGIEN,"^",2)
"RTN","DGHTENR",85,0)
 I '+DA Q
"RTN","DGHTENR",86,0)
 S DGDAT=^DGHT(391.31,DA,0)
"RTN","DGHTENR",87,0)
 S DGDAT1=$S(DA1:^DGHT(391.31,DA,"TRAN",DA1,0),1:"")
"RTN","DGHTENR",88,0)
 W !?3,"Patient:          ",$$GET1^DIQ(2,$P(DGDAT,"^",2),.01,"E")
"RTN","DGHTENR",89,0)
 W !?3,"Vendor:           ",$$GET1^DIQ(4,$P(DGDAT,"^",3),.01,"E")
"RTN","DGHTENR",90,0)
 W !?3,"Care Coordinator: ",$$GET1^DIQ(200,$P(DGDAT,"^",5),.01,"E")
"RTN","DGHTENR",91,0)
 W ?45,"Consult Number:    ",$P(DGDAT,"^",4)
"RTN","DGHTENR",92,0)
 W !?3,"Activation Date:  ",$$FMTE^XLFDT($P(DGDAT,"^",6),2)
"RTN","DGHTENR",93,0)
 W:$P(DGDAT,"^",7)'="" ?45,"Inactivation Date: ",$$FMTE^XLFDT($P(DGDAT,"^",7),2)
"RTN","DGHTENR",94,0)
 I DGDAT1'="" D
"RTN","DGHTENR",95,0)
 .W !?3,"Transaction Date: ",$$FMTE^XLFDT($P(DGDAT1,"^"),2)
"RTN","DGHTENR",96,0)
 .W ?45,"Transaction Type:  "
"RTN","DGHTENR",97,0)
 .W $S('$P(DGDAT1,"^",5):"Retransmit",$P(DGDAT1,"^",5)=1:"Add",1:"Edit")
"RTN","DGHTENR",98,0)
 .W !?3,"Message Type:     ",$S($P(DGDAT1,"^",4)="A":"Activation",$P(DGDAT1,"^",4)="I":"Inactivation",1:"Unknown")
"RTN","DGHTENR",99,0)
 .W ?45,"Message ID:        ",$P(DGDAT1,"^",2)
"RTN","DGHTENR",100,0)
 .W !?3,"Data Entry User:  ",$$GET1^DIQ(200,$P(DGDAT1,"^",3),.01,"E")
"RTN","DGHTENR",101,0)
 .W !?3,"Acknowledge Date: ",$$FMTE^XLFDT($P(DGDAT1,"^",6),2)
"RTN","DGHTENR",102,0)
 .W ?45,"Acknowledge Code:  "
"RTN","DGHTENR",103,0)
 .W $S($P(DGDAT1,"^",7)="A":"Accepted",$P(DGDAT1,"^",7)="R":"Rejected",1:"")
"RTN","DGHTENR",104,0)
 .I $P(DGDAT1,"^",8)'="" W !?3,"Reject Message:   ",$P(DGDAT1,"^",8)
"RTN","DGHTENR",105,0)
 .W !
"RTN","DGHTENR",106,0)
 Q
"RTN","DGHTENR",107,0)
 ;
"RTN","DGHTENR",108,0)
GETPAT()        ;Prompt user for patient
"RTN","DGHTENR",109,0)
 ;Input : None
"RTN","DGHTENR",110,0)
 ;Output: Pointer to PATIENT File, #2 (i.e. DFN)
"RTN","DGHTENR",111,0)
 ;        0 on user quit
"RTN","DGHTENR",112,0)
 N DIC,X,Y,DTOUT,DUOUT,IENVAL
"RTN","DGHTENR",113,0)
 S DIC="^DPT(",DIC("A")="Patient: ",DIC(0)="AEQM"
"RTN","DGHTENR",114,0)
 D ^DIC I +Y<0 Q 0
"RTN","DGHTENR",115,0)
 S IENVAL=$$PATOK(+Y) I 'IENVAL Q 0
"RTN","DGHTENR",116,0)
 Q +Y
"RTN","DGHTENR",117,0)
 ;
"RTN","DGHTENR",118,0)
PATOK(DFN)      ;Patient screen
"RTN","DGHTENR",119,0)
 ;Input : DFN - Pointer to PATIENT
"RTN","DGHTENR",120,0)
 ;Output: 1 = Patient selectable
"RTN","DGHTENR",121,0)
 ;        0 = Patient not selectable
"RTN","DGHTENR",122,0)
 N NODE
"RTN","DGHTENR",123,0)
 ;Dead
"RTN","DGHTENR",124,0)
 I $G(^DPT(DFN,.35)) W !,"*** Patient has expired. ***" Q 0
"RTN","DGHTENR",125,0)
 ;No national ICN
"RTN","DGHTENR",126,0)
 S NODE=$G(^DPT(DFN,"MPI"))
"RTN","DGHTENR",127,0)
 I $P(NODE,"^",1)="" W !,"*** Patient has no ICN. ***" Q 0
"RTN","DGHTENR",128,0)
 ;Local ICN
"RTN","DGHTENR",129,0)
 I $P(NODE,"^",4) W !,"*** Patient has local ICN. ***" Q 0
"RTN","DGHTENR",130,0)
 ;Selectable patient
"RTN","DGHTENR",131,0)
 Q 1
"RTN","DGHTENR",132,0)
 ;
"RTN","DGHTENR",133,0)
GETVEN() ;Prompt user for receiving vendor
"RTN","DGHTENR",134,0)
 ;Input : None
"RTN","DGHTENR",135,0)
 ;Output: N = Pointer to INSTITUTION File, #4
"RTN","DGHTENR",136,0)
 ;        0 = User quit
"RTN","DGHTENR",137,0)
 ;
"RTN","DGHTENR",138,0)
 N DIR,X,Y,DTOUT,DUOUT,DIRUT
"RTN","DGHTENR",139,0)
 S DIR(0)="391.31,2",DIR("A")="Vendor"
"RTN","DGHTENR",140,0)
 S DIR("?")="Enter the Home Telehealth vendor patient is signed up with."
"RTN","DGHTENR",141,0)
 D ^DIR
"RTN","DGHTENR",142,0)
 Q $S(+Y<0:0,1:+Y)
"RTN","DGHTENR",143,0)
 ;
"RTN","DGHTENR",144,0)
GCONSULT(DFN,DEFAULT) ;Prompt Consult number from file #123
"RTN","DGHTENR",145,0)
 ;Input : DFN      Patient pointer for file #2
"RTN","DGHTENR",146,0)
 ;        DEFAULT  Default value for consult number (if existing)
"RTN","DGHTENR",147,0)
 ;Output: N        Pointer to REQUEST/CONSULTATION file, #123
"RTN","DGHTENR",148,0)
 ;        0        User quit
"RTN","DGHTENR",149,0)
 ;
"RTN","DGHTENR",150,0)
 N DIR,X,Y,DTOUT,DUOUT,DIRUT,CON,CONZER,DGTMP
"RTN","DGHTENR",151,0)
 ;find ien for 'CARE COORDINATION HOME TELEHEALTH SCREENING'
"RTN","DGHTENR",152,0)
 S CON="CARE COORDINATION HOME TELEHEALTH SCREENING"
"RTN","DGHTENR",153,0)
 K ^TMP("GMRCR",$J)
"RTN","DGHTENR",154,0)
 D GUI^GMRCASV1("DGTMP",CON,1,0) ;DBIA#3252
"RTN","DGHTENR",155,0)
 S CON=$O(DGTMP(0))
"RTN","DGHTENR",156,0)
 I 'CON W !,"Service Area not available" Q 0
"RTN","DGHTENR",157,0)
 S CON=+DGTMP(CON) ;DBIA#2740
"RTN","DGHTENR",158,0)
 D OER^GMRCSLM1(DFN,CON,"")
"RTN","DGHTENR",159,0)
 S CONZER=$G(^TMP("GMRCR",$J,"CS",0)),DIR("?")="^D CONHELP^DGHTENR"
"RTN","DGHTENR",160,0)
 I '+$P(CONZER,"^",4) D  Q 0
"RTN","DGHTENR",161,0)
 .W !!,"No Home Telehealth consult available for this patient!!"
"RTN","DGHTENR",162,0)
 S DIR(0)="P^TMP(""GMRCR"",$J,""CS"",:AEQMZ",DIR("A")="Consult Number"
"RTN","DGHTENR",163,0)
 I $G(DEFAULT)'="" S DIR("B")=DEFAULT
"RTN","DGHTENR",164,0)
 D ^DIR
"RTN","DGHTENR",165,0)
 K ^TMP("GMRCR",$J)
"RTN","DGHTENR",166,0)
 Q $S(+Y<0:0,1:$P(Y,"^",2))
"RTN","DGHTENR",167,0)
 ;
"RTN","DGHTENR",168,0)
CONHELP ;Help for consult #
"RTN","DGHTENR",169,0)
 N DIC,XX,D
"RTN","DGHTENR",170,0)
 I $D(^TMP("GMRCR",$J,"CS")) D  Q
"RTN","DGHTENR",171,0)
 .W !?1,"Answer with the number representing consult.",!?1,"Choose from:"
"RTN","DGHTENR",172,0)
 .S XX=0 F  S XX=$O(^TMP("GMRCR",$J,"CS",XX)) Q:'XX  D
"RTN","DGHTENR",173,0)
 ..W !?1,XX,")",?5,$P(^TMP("GMRCR",$J,"CS",XX,0),"^"),?15
"RTN","DGHTENR",174,0)
 ..W $$FMTE^XLFDT($P(^TMP("GMRCR",$J,"CS",XX,0),"^",2),"2HM"),?30
"RTN","DGHTENR",175,0)
 ..W $E($P(^TMP("GMRCR",$J,"CS",XX,0),"^",7),1,38),?70,$P(^TMP("GMRCR",$J,"CS",XX,0),"^",3)
"RTN","DGHTENR",176,0)
 S DIC="^TMP(""GMRCR"",$J,""CS"")",DIC(0)="MQEZ" D DQ^DICQ
"RTN","DGHTENR",177,0)
 Q
"RTN","DGHTENR",178,0)
 ;
"RTN","DGHTENR",179,0)
GETPROV(DEFAULT) ;Prompt for Care Coordinator
"RTN","DGHTENR",180,0)
 ;Input : DEFAULT = Default value for provider (if existing)
"RTN","DGHTENR",181,0)
 ;Output: N =       Pointer to NEW PERSON file, #200
"RTN","DGHTENR",182,0)
 ;        0 =       User quit
"RTN","DGHTENR",183,0)
 ;
"RTN","DGHTENR",184,0)
 N DIR,X,Y,DTOUT,DUOUT,DIRUT
"RTN","DGHTENR",185,0)
 S DIR(0)="P^VA(200,:AEQM",DIR("A")="Care Coordinator"
"RTN","DGHTENR",186,0)
 S DIR("?")="Enter the Care Coordinator responsible for signing up this patient."
"RTN","DGHTENR",187,0)
 I $G(DEFAULT)'="" S DIR("B")=$$GET1^DIQ(200,DEFAULT,.01,"E")
"RTN","DGHTENR",188,0)
 D ^DIR
"RTN","DGHTENR",189,0)
 Q $S(+Y<0:0,1:+Y)
"RTN","DGHTENR",190,0)
 ;
"RTN","DGHTENR",191,0)
SNDMSG(TYPE)        ;Prompt to transmit transaction to vendor server
"RTN","DGHTENR",192,0)
 ;Input : None
"RTN","DGHTENR",193,0)
 ;Output: 1 = Send message
"RTN","DGHTENR",194,0)
 ;        0 = User quit
"RTN","DGHTENR",195,0)
 ;
"RTN","DGHTENR",196,0)
 N DIR,X,Y,DTOUT,DUOUT,DIRUT
"RTN","DGHTENR",197,0)
 S DIR(0)="Y",DIR("B")="Yes"
"RTN","DGHTENR",198,0)
 S DIR("A")=$S(TYPE="A":"Send Sign-Up/Activation",TYPE="I":"Send Inactivation",1:"")
"RTN","DGHTENR",199,0)
 S DIR("?")="Enter 'Yes' to transmit patient information to vendor. 'No' not to transmit."
"RTN","DGHTENR",200,0)
 D ^DIR
"RTN","DGHTENR",201,0)
 Q $S(+Y<0:0,1:+Y)
"RTN","DGHTENR",202,0)
 ;
"RTN","DGHTENR",203,0)
FILE ;File patient data in #391.31
"RTN","DGHTENR",204,0)
 N DIC,DIE,DA,DR,X,Y,DGRN,DGTREVN,DINUM
"RTN","DGHTENR",205,0)
 S DGTREVN=0
"RTN","DGHTENR",206,0)
 I $G(DGHTH("DA"))'="" D  Q
"RTN","DGHTENR",207,0)
 .D FILE1
"RTN","DGHTENR",208,0)
HTADD L +^DGHT(391.31,0)
"RTN","DGHTENR",209,0)
 S DGRN=$P(^DGHT(391.31,0),"^",3)+1 I $D(^DGHT(391.31,DGRN)) D  G HTADD
"RTN","DGHTENR",210,0)
 .S $P(^DGHT(391.31,0),"^",3)=$P(^(0),"^",3)+1 L -^DGHT(391.31,0)
"RTN","DGHTENR",211,0)
 L -^DGHT(391.31,0)
"RTN","DGHTENR",212,0)
 S DIC(0)="L",DIC="^DGHT(391.31,",X=DGRN,DINUM=X D FILE^DICN
"RTN","DGHTENR",213,0)
 S DGHTH("DA")=+Y,DGTREVN=1
"RTN","DGHTENR",214,0)
 ;
"RTN","DGHTENR",215,0)
FILE1 ;Add/Update fields in #391.31
"RTN","DGHTENR",216,0)
 S DIE="^DGHT(391.31,",DA=+DGHTH("DA")
"RTN","DGHTENR",217,0)
 S DR="1////"_DGDFN_";2////"_DGVEN_";3////"_DGCON_";4////"_DGPRV
"RTN","DGHTENR",218,0)
 S:DGTREVN DR=DR_";5////"_DGEVNDT
"RTN","DGHTENR",219,0)
 D ^DIE
"RTN","DGHTENR",220,0)
 ;file entry in subfile #391.317
"RTN","DGHTENR",221,0)
 K DIC,DD,DO,DA
"RTN","DGHTENR",222,0)
 S DIC(0)="L",DIC("P")=$P(^DD(391.31,7,0),"^",2),DA(1)=+DGHTH("DA")
"RTN","DGHTENR",223,0)
 I $P(DGHTH("DA"),"^",2)="" D
"RTN","DGHTENR",224,0)
 .S DGRN=$S('$D(^DGHTH(391.31,DA(1),"TRAN")):0,1:$P(^DGHTH(391.31,DA(1),"TRAN",0),"^",3))+1,$P(DGHTH("DA"),"^",2)=DGRN,X=DGEVNDT
"RTN","DGHTENR",225,0)
 .S DIC="^DGHT(391.31,"_DA(1)_","_"""TRAN"""_","
"RTN","DGHTENR",226,0)
 .D FILE^DICN
"RTN","DGHTENR",227,0)
 K DR
"RTN","DGHTENR",228,0)
 S DA=$P(DGHTH("DA"),"^",2),DIE="^DGHT(391.31,"_DA(1)_","_"""TRAN"""_","
"RTN","DGHTENR",229,0)
 S (DR,DR(2,391.317))=".01////"_DGEVNDT_";.02////@"_";.03////"_DUZ_";.04////"_DGTYPE_";.05////"_DGTREVN  ;";.07////@" retain AA and trans. date/time when 1st transmitted successfully.
"RTN","DGHTENR",230,0)
 D ^DIE
"RTN","DGHTENR",231,0)
 Q
"RTN","DGHTENR",232,0)
 ;
"RTN","DGHTENR",233,0)
MIDUPD ;Update File #391.31 with message ID
"RTN","DGHTENR",234,0)
 N DIE,DR,DA,X,Y
"RTN","DGHTENR",235,0)
 S DA=$P(DGHTH("DA"),"^",2),DA(1)=+DGHTH("DA")
"RTN","DGHTENR",236,0)
 S (DR,DR(2,391.317))=".02////"_DGMID
"RTN","DGHTENR",237,0)
 S DIE="^DGHT(391.31,"_DA(1)_","_"""TRAN"""_","
"RTN","DGHTENR",238,0)
 D ^DIE
"RTN","DGHTENR",239,0)
 Q
"RTN","DGHTHL7")
0^2^B50017254^n/a
"RTN","DGHTHL7",1,0)
DGHTHL7 ;ALB/JAM - Home Telehealth Patient Sign-up HL7;10 January 2005 ; 9/25/07 10:18am
"RTN","DGHTHL7",2,0)
 ;;5.3;Registration;**644**;Aug 13, 1993;Build 11
"RTN","DGHTHL7",3,0)
 ;
"RTN","DGHTHL7",4,0)
BLDHL7(DGHTH,MSG) ;Build HL7 Registration message for Home Telehealth
"RTN","DGHTHL7",5,0)
 ;Input : DGHTH - Arry with Home Telehealth transaction data
"RTN","DGHTHL7",6,0)
 ;        MSG   - Array to put message into (full global ref)
"RTN","DGHTHL7",7,0)
 ;Output: N  - Last line number used, or
"RTN","DGHTHL7",8,0)
 ;        0  - no message built, or
"RTN","DGHTHL7",9,0)
 ;        -1^ErrorText on error
"RTN","DGHTHL7",10,0)
 ;        MSG will contain HL7 message
"RTN","DGHTHL7",11,0)
 ;Note  : Insertion into MSG begins at next available line number
"RTN","DGHTHL7",12,0)
 ;
"RTN","DGHTHL7",13,0)
 N DFN,VENDOR,CONSULT,COORD,EVENTDT,VALCHK,DGX,ERR,PROTNAME,VAFPID
"RTN","DGHTHL7",14,0)
 N HLFS,HLECH,HLQ,HL,EVN,PID,PD1,PV1,LINE,X,Y
"RTN","DGHTHL7",15,0)
 S ERR=0,X="" F  S X=$O(DGHTH(X)) Q:X=""  D  I ERR Q
"RTN","DGHTHL7",16,0)
 .I DGHTH(X)="" S VALCHK="-1^Bad Input ("_X_")",ERR=1 Q
"RTN","DGHTHL7",17,0)
 .S @X=DGHTH(X)
"RTN","DGHTHL7",18,0)
 I ERR Q $G(VALCHK)
"RTN","DGHTHL7",19,0)
 I $G(MSG)="" Q "-1^Bad input variable (MSG)"
"RTN","DGHTHL7",20,0)
 S PROTNAME="DG HOME TELEHEALTH ADT-A04 SERVER"
"RTN","DGHTHL7",21,0)
 D INIT^HLFNC2(PROTNAME,.HL)
"RTN","DGHTHL7",22,0)
 I ($O(HL(""))="") Q "-1^Unable to initialize HL7 variables"
"RTN","DGHTHL7",23,0)
 S LINE=+$O(@MSG@(""),-1)
"RTN","DGHTHL7",24,0)
 ;
"RTN","DGHTHL7",25,0)
 ;EVN segment
"RTN","DGHTHL7",26,0)
 S EVN=$$EVN("A04","A04",EVENTDT)
"RTN","DGHTHL7",27,0)
 I $P(EVN,U)=-1 K @MSG Q EVN
"RTN","DGHTHL7",28,0)
 S LINE=LINE+1 S @MSG@(LINE)=EVN
"RTN","DGHTHL7",29,0)
 ;
"RTN","DGHTHL7",30,0)
 ;PID segment
"RTN","DGHTHL7",31,0)
 S PID=$$PID(DFN,.HL,.VAFPID)
"RTN","DGHTHL7",32,0)
 I $P(PID,U)=-1 Q PID
"RTN","DGHTHL7",33,0)
 D PIDVAL I ERR Q ERR
"RTN","DGHTHL7",34,0)
 S DGX=$O(VAFPID(0)),LINE=LINE+1 S @MSG@(LINE)=VAFPID(DGX)
"RTN","DGHTHL7",35,0)
 F  S DGX=$O(VAFPID(DGX)) Q:'DGX  D
"RTN","DGHTHL7",36,0)
 .S @MSG@(LINE,DGX-1)=VAFPID(DGX)
"RTN","DGHTHL7",37,0)
 ;
"RTN","DGHTHL7",38,0)
 ;PD1 segment
"RTN","DGHTHL7",39,0)
 S PD1=$$PD1(DFN,COORD)
"RTN","DGHTHL7",40,0)
 I $P(PD1,U)=-1 Q PD1
"RTN","DGHTHL7",41,0)
 S LINE=LINE+1 S @MSG@(LINE)=PD1
"RTN","DGHTHL7",42,0)
 ;
"RTN","DGHTHL7",43,0)
 ;PV1 segment
"RTN","DGHTHL7",44,0)
 S $P(PV1,HLFS,1)=1,$P(PV1,HLFS,5)=CONSULT
"RTN","DGHTHL7",45,0)
 S $P(PV1,HLFS,39)=$$STA^XUAF4(DUZ(2))
"RTN","DGHTHL7",46,0)
 S PV1="PV1"_HLFS_PV1
"RTN","DGHTHL7",47,0)
 S LINE=LINE+1 S @MSG@(LINE)=PV1
"RTN","DGHTHL7",48,0)
 ;
"RTN","DGHTHL7",49,0)
 Q LINE
"RTN","DGHTHL7",50,0)
 ;
"RTN","DGHTHL7",51,0)
EVN(TYPE,FLAG,DGEVDT) ;Build EVN segment
"RTN","DGHTHL7",52,0)
 ;Input:  TYPE   - HL7 event type
"RTN","DGHTHL7",53,0)
 ;        FLAG   - HL7 Event Reason Code
"RTN","DGHTHL7",54,0)
 ;        DGEVDT - Event Date/Time [Optional]
"RTN","DGHTHL7",55,0)
 ;Output: value  - EVN segment
"RTN","DGHTHL7",56,0)
 ;        -1^ErrorText on error
"RTN","DGHTHL7",57,0)
 ;
"RTN","DGHTHL7",58,0)
 N USRNAM,USERID,COMP,SUBCOMP,EVN
"RTN","DGHTHL7",59,0)
 I $G(TYPE)=""!($G(FLAG)="") Q "-1^Value missing to build message (EVN segment)"
"RTN","DGHTHL7",60,0)
 S EVN=$$EVN^VAFHLEVN(TYPE,FLAG,DGEVDT)
"RTN","DGHTHL7",61,0)
 I ($E(EVN,1,3)'="EVN") Q "-1^Error build message (EVN segment)"
"RTN","DGHTHL7",62,0)
 ;Add user and user's facility to EVN segment
"RTN","DGHTHL7",63,0)
 S COMP=$E(HL("ECH"),1),SUBCOMP=$E(HL("ECH"),4)
"RTN","DGHTHL7",64,0)
 S USRNAM=$$HLNAME^HLFNC($$GET1^DIQ(200,DUZ_",",.01),HL("ECH"))
"RTN","DGHTHL7",65,0)
 S USERID=DUZ_COMP_$P(USRNAM,COMP)_COMP_$P(USRNAM,COMP,2)_COMP_COMP_COMP
"RTN","DGHTHL7",66,0)
 S USERID=USERID_COMP_COMP_COMP_"USVHA"_SUBCOMP_SUBCOMP_"0363"_COMP_"L"
"RTN","DGHTHL7",67,0)
 S USERID=USERID_COMP_COMP_COMP_"NI"_COMP_"VA FACILITY ID"_SUBCOMP
"RTN","DGHTHL7",68,0)
 S USERID=USERID_$P($$SITE^VASITE,"^",3)_SUBCOMP_"L"
"RTN","DGHTHL7",69,0)
 S $P(EVN,HLFS,6)=USERID,$P(EVN,HLFS,8)=$P($$SITE^VASITE,HLFS,3)
"RTN","DGHTHL7",70,0)
 Q EVN
"RTN","DGHTHL7",71,0)
 ;
"RTN","DGHTHL7",72,0)
PID(DFN,HL,DGPID) ;Build PID segment
"RTN","DGHTHL7",73,0)
 ;Input:  DFN    - Patient DFN
"RTN","DGHTHL7",74,0)
 ;        HL     - HL7 values
"RTN","DGHTHL7",75,0)
 ;Output: DGPIR  - PID array segment
"RTN","DGHTHL7",76,0)
 ;            1  - PID segment build (no error)
"RTN","DGHTHL7",77,0)
 ;        -1^ErrorText on error
"RTN","DGHTHL7",78,0)
 ;
"RTN","DGHTHL7",79,0)
 N FLDS,DGX
"RTN","DGHTHL7",80,0)
 I $G(DFN)="" Q "-1^Value missing to build message (PID segment)"
"RTN","DGHTHL7",81,0)
 S FLDS=$$COMMANUM^VAFCADT2(1,9)_",10NTB,11,"
"RTN","DGHTHL7",82,0)
 S FLDS=FLDS_$$COMMANUM^VAFCADT2(12,21)_",22B"
"RTN","DGHTHL7",83,0)
 D BLDPID^VAFCQRY(DFN,"",FLDS,.DGPID,.HL)
"RTN","DGHTHL7",84,0)
 S DGX=$O(DGPID(0)) I DGX S DGX=DGPID(DGX)
"RTN","DGHTHL7",85,0)
 I $P(DGX,"^")'="PID" Q "-1^Error build message (PID segment)"
"RTN","DGHTHL7",86,0)
 Q 1
"RTN","DGHTHL7",87,0)
 ;
"RTN","DGHTHL7",88,0)
PD1(DFN,COORD) ;Build PD1 segment
"RTN","DGHTHL7",89,0)
 ;Input:  DFN    - Patient DFN
"RTN","DGHTHL7",90,0)
 ;        COOR   - Care Coordinator
"RTN","DGHTHL7",91,0)
 ;Output: PD1    - PD1 segment
"RTN","DGHTHL7",92,0)
 ;        -1^ErrorText on error
"RTN","DGHTHL7",93,0)
 ;
"RTN","DGHTHL7",94,0)
 N PD1,DGNAME
"RTN","DGHTHL7",95,0)
 I $G(DFN)=""!($G(COORD)="") Q "-1^Value missing to build message (PD1 segment)"
"RTN","DGHTHL7",96,0)
 S PD1=$$EN^VAFHLPD1(DFN,3)
"RTN","DGHTHL7",97,0)
 I ($E(PD1,1,3)'="PD1") Q "-1^Error build message (PD1 segment)"
"RTN","DGHTHL7",98,0)
 S DGNAME("FILE")=200,DGNAME("IENS")=COORD,DGNAME("FIELD")=.01
"RTN","DGHTHL7",99,0)
 S $P(PD1,HLFS,5)=COORD_$E(HLECH)_$$HLNAME^XLFNAME(.DGNAME,"",$E(HLECH))
"RTN","DGHTHL7",100,0)
 Q PD1
"RTN","DGHTHL7",101,0)
 ;
"RTN","DGHTHL7",102,0)
PIDVAL ;validate PID segment
"RTN","DGHTHL7",103,0)
 ;locate the fields in variable FLDS in VAFPID array, check its not null
"RTN","DGHTHL7",104,0)
 N NSTR,STR,FLN,FLDS,FLC,X,Y,Z
"RTN","DGHTHL7",105,0)
 S FLDS="4^6^8^12^20",(FLN,FLN(0))=0,DGX=0
"RTN","DGHTHL7",106,0)
 S STR="Patient Identifier list^Patient Name^Date of Birth^Patient address^SSN"
"RTN","DGHTHL7",107,0)
 F  S DGX=$O(VAFPID(DGX)) Q:'DGX  D  I ERR Q
"RTN","DGHTHL7",108,0)
 .S FLN(DGX)=$L(VAFPID(DGX),"^")-1,FLC=FLN,FLN=FLN+FLN(DGX)
"RTN","DGHTHL7",109,0)
 .F X=1:1 S Y=$P(FLDS,"^",X) Q:Y=""  I Y'="C" D  I ERR Q
"RTN","DGHTHL7",110,0)
 ..I Y'>FLN S $P(FLDS,"^",X)="C" D
"RTN","DGHTHL7",111,0)
 ...I FLN(DGX)=FLN S:($P(VAFPID(DGX),"^",Y-FLC)="")!($P(VAFPID(DGX),"^",Y-FLC)="""""") ERR="-1^Error in PID-"_(Y-1)_" field ("_$P(STR,"^",X)_")" Q
"RTN","DGHTHL7",112,0)
 ...S NSTR=$P(VAFPID(DGX-1),"^",FLN(DGX-1)+1)_VAFPID(DGX) I ($P(NSTR,"^",Y-FLC)="")!($P(NSTR,"^",Y-FLC)="""""") S ERR="-1^Error in PID-"_(Y-1)_" field ("_$P(STR,"^",X)_")" Q
"RTN","DGHTHL7",113,0)
 Q
"RTN","DGHTHL7",114,0)
 ;
"RTN","DGHTHL7",115,0)
BLDHL7I(DFN,MSG) ;Build HL7 Registration message for telehealth
"RTN","DGHTHL7",116,0)
 ;Input : DFN  - Pointer to PATIENT
"RTN","DGHTHL7",117,0)
 ;        MSG  - Array to put message into (full global ref)
"RTN","DGHTHL7",118,0)
 ;Output: Last line number used
"RTN","DGHTHL7",119,0)
 ;        -1^ErrorText on error
"RTN","DGHTHL7",120,0)
 ;        MSG will contain HL7 message
"RTN","DGHTHL7",121,0)
 ;Notes : Insertion into MSG begins at next available line number
"RTN","DGHTHL7",122,0)
 I '$D(^DPT(DFN,0)) Q "-1^Bad input (DFN)"
"RTN","DGHTHL7",123,0)
 I $G(MSG)="" Q "-1^Bad input variable (MSG)"
"RTN","DGHTHL7",124,0)
 N HLFS,HLECH,HLQ,HL,EVN,VAFPID,PV1,LINE,FLDS,DGVEN,DGX
"RTN","DGHTHL7",125,0)
 N EVNTDT,ERR,PROT4HL7,COMP,SUBCOMP,USRNAM,USERID
"RTN","DGHTHL7",126,0)
 S PROT4HL7="DG HOME TELEHEALTH ADT-A03 SERVER"
"RTN","DGHTHL7",127,0)
 D INIT^HLFNC2(PROT4HL7,.HL)
"RTN","DGHTHL7",128,0)
 I ($O(HL(""))="") Q "-1^Unable to initialize HL7 variables"
"RTN","DGHTHL7",129,0)
 S EVNTDT=$$NOW^XLFDT()
"RTN","DGHTHL7",130,0)
 S LINE=+$O(@MSG@(""),-1)
"RTN","DGHTHL7",131,0)
 ;EVN segment
"RTN","DGHTHL7",132,0)
 S EVN=$$EVN("A03","A03",EVNTDT)
"RTN","DGHTHL7",133,0)
 I EVN<0 K @MSG Q "-1^Error build message (EVN segment)"
"RTN","DGHTHL7",134,0)
 S LINE=LINE+1
"RTN","DGHTHL7",135,0)
 S @MSG@(LINE)=EVN
"RTN","DGHTHL7",136,0)
 ;
"RTN","DGHTHL7",137,0)
 ;PID segment
"RTN","DGHTHL7",138,0)
 N DGX
"RTN","DGHTHL7",139,0)
 S PID=$$PID(DGDFN,.HL,.VAFPID)
"RTN","DGHTHL7",140,0)
 I +PID'>0 S ERR=1 K @MSG Q "-1^Error build message (PID segment)"
"RTN","DGHTHL7",141,0)
 S DGX=$O(VAFPID(0)),LINE=LINE+1 S @MSG@(LINE)=VAFPID(DGX)
"RTN","DGHTHL7",142,0)
 F  S DGX=$O(VAFPID(DGX)) Q:'DGX  D
"RTN","DGHTHL7",143,0)
 .S @MSG@(LINE,DGX-1)=VAFPID(DGX)
"RTN","DGHTHL7",144,0)
 ;Done
"RTN","DGHTHL7",145,0)
 Q 1
"RTN","DGHTHL7",146,0)
SNDHL7(MSG,PTRRCV,PROTNAME)     ;Send HL7 Home Telehealth message to server
"RTN","DGHTHL7",147,0)
 ;Input : MSG - Array containing HL7 message to transmit
"RTN","DGHTHL7",148,0)
 ;              (full global reference)
"RTN","DGHTHL7",149,0)
 ;            - Must be in format required for interaction
"RTN","DGHTHL7",150,0)
 ;              with the HL7 package
"RTN","DGHTHL7",151,0)
 ;     PTRRCV  - Pointer for vendor receiving system
"RTN","DGHTHL7",152,0)
 ;    PROTNAME - Protocol name
"RTN","DGHTHL7",153,0)
 ;Output: Message ID
"RTN","DGHTHL7",154,0)
 ;        Message ID or 0^ErrorText on error
"RTN","DGHTHL7",155,0)
 ;Notes  : The global array ^TMP("HLS",$J) will be KILLed if MSG
"RTN","DGHTHL7",156,0)
 ;         does not use this global location
"RTN","DGHTHL7",157,0)
 I $G(MSG)="" Q "-1^Bad input variable(MSG)"
"RTN","DGHTHL7",158,0)
 I '$G(PTRRCV) Q "-1^Bad input variable for vendor (PTRRCV)"
"RTN","DGHTHL7",159,0)
 I ($O(@MSG@(""))="") Q "-1^Message empty... can't send empty"
"RTN","DGHTHL7",160,0)
 N DGARRAY,HL,HLL,HLFS,HLECH,HLQ,HLMTIEN,HLRESLT,HLP,KILLARRY,ARRY4HL7,APPINFO,DIC,CLPROT,SIEN,LINK
"RTN","DGHTHL7",161,0)
 S ARRY4HL7=$NA(^TMP("HLS",$J))
"RTN","DGHTHL7",162,0)
 D INIT^HLFNC2(PROTNAME,.HL)
"RTN","DGHTHL7",163,0)
 I ($O(HL(""))="") Q "-1^Unable to initialize HL7 variables"
"RTN","DGHTHL7",164,0)
 S APPINFO=$$APP4MSH(PTRRCV)
"RTN","DGHTHL7",165,0)
 I APPINFO="" Q "-1^Unable to determine receiving system information"
"RTN","DGHTHL7",166,0)
 ;See if MSG is ^TMP("HLS",$J)
"RTN","DGHTHL7",167,0)
 S KILLARRY=0
"RTN","DGHTHL7",168,0)
 I (MSG'=ARRY4HL7) D
"RTN","DGHTHL7",169,0)
 .;Make sure '$J' wasn't used
"RTN","DGHTHL7",170,0)
 .Q:(MSG="^TMP(""HLS"",$J)")
"RTN","DGHTHL7",171,0)
 .;Initialize ^TMP("HLS",$J) and merge XMITARRY into it
"RTN","DGHTHL7",172,0)
 .K @ARRY4HL7
"RTN","DGHTHL7",173,0)
 .M @ARRY4HL7=@MSG
"RTN","DGHTHL7",174,0)
 .S KILLARRY=1
"RTN","DGHTHL7",175,0)
 ;Using dynamic MSH segment
"RTN","DGHTHL7",176,0)
 S $P(HLP("SUBSCRIBER"),"^",2)="DG HOME TELEHEALTH"
"RTN","DGHTHL7",177,0)
 S $P(HLP("SUBSCRIBER"),"^",3)=$P(APPINFO,"^",1)
"RTN","DGHTHL7",178,0)
 S $P(HLP("SUBSCRIBER"),"^",4)="HTAPPL"
"RTN","DGHTHL7",179,0)
 S $P(HLP("SUBSCRIBER"),"^",5)=$P(APPINFO,"^",2)
"RTN","DGHTHL7",180,0)
 S HLP("PRIORITY")="I"  ;Immediate priority
"RTN","DGHTHL7",181,0)
 ;Get subscriber protocol
"RTN","DGHTHL7",182,0)
 S DIC="^ORD(101,",DIC(0)="B",X=PROTNAME D ^DIC
"RTN","DGHTHL7",183,0)
 D GETS^DIQ(101,+Y,"775*","E","ARRAY1")
"RTN","DGHTHL7",184,0)
 S CLPROT=ARRAY1(101.0775,$O(ARRAY1(101.0775,0)),.01,"E")
"RTN","DGHTHL7",185,0)
 ;Use inst file ien to retrieve logical link for dynamic addressing
"RTN","DGHTHL7",186,0)
 D LINK^HLUTIL3(DGVEN,.DGARRAY,"")
"RTN","DGHTHL7",187,0)
 S LINK=DGARRAY($O(DGARRAY(0)))
"RTN","DGHTHL7",188,0)
 S HLL("LINKS",1)=CLPROT_U_LINK
"RTN","DGHTHL7",189,0)
 D GENERATE^HLMA(PROTNAME,"GM",1,.HLRESLT,"",.HLP)
"RTN","DGHTHL7",190,0)
 ;S:('HLRESLT) HLRESLT=$P(HLRESLT,"^",2,3)
"RTN","DGHTHL7",191,0)
 ;Delete ^TMP("HLS",$J) if MSG was different
"RTN","DGHTHL7",192,0)
 K:(KILLARRY) @ARRY4HL7
"RTN","DGHTHL7",193,0)
 ;Done
"RTN","DGHTHL7",194,0)
 Q HLRESLT
"RTN","DGHTHL7",195,0)
 ;
"RTN","DGHTHL7",196,0)
APP4MSH(PTRRCV) ;Determine sending and receiving application for MSH segment
"RTN","DGHTHL7",197,0)
 ;Input : PTRRCV = Pointer to file #4 for receiving system
"RTN","DGHTHL7",198,0)
 ;Output: Sending Facility ^ Receiving Facility
"RTN","DGHTHL7",199,0)
 ;        Null = Error/bad input
"RTN","DGHTHL7",200,0)
 N SNDFAC,RCVFAC
"RTN","DGHTHL7",201,0)
 I 'PTRRCV Q ""
"RTN","DGHTHL7",202,0)
 I $$GET1^DIQ(4,PTRRCV,.01)="" Q ""
"RTN","DGHTHL7",203,0)
 S SNDFAC=$P($$SITE^VASITE(),"^",3)_$E(HLECH)
"RTN","DGHTHL7",204,0)
 S SNDFAC=SNDFAC_$$GET1^DIQ(4,$P($$SITE^VASITE(),"^"),60,"E")_$E(HLECH)
"RTN","DGHTHL7",205,0)
 S SNDFAC=SNDFAC_"DNS"
"RTN","DGHTHL7",206,0)
 S RCVFAC=$$GET1^DIQ(4,PTRRCV,99,"E")_$E(HLECH)
"RTN","DGHTHL7",207,0)
 S RCVFAC=RCVFAC_$$GET1^DIQ(4,PTRRCV,60,"E")_$E(HLECH)_"DNS"
"RTN","DGHTHL7",208,0)
 Q SNDFAC_"^"_RCVFAC
"RTN","DGHTHLAA")
0^7^B13204379^n/a
"RTN","DGHTHLAA",1,0)
DGHTHLAA ;ALB/JRC - Home Telehealth Patient HL7 Application Acknowledgment;10 January 2005 ; 10/4/06 3:07pm
"RTN","DGHTHLAA",2,0)
 ;;5.3;Registration;**644**;Aug 13, 1993;Build 11
"RTN","DGHTHLAA",3,0)
 ;;
"RTN","DGHTHLAA",4,0)
ACKMSG ; Process A03 and A04 'AA' messages for Home Telehealth Application
"RTN","DGHTHLAA",5,0)
 ; Input  : All variables set by the HL7 package
"RTN","DGHTHLAA",6,0)
 ; Output : None
"RTN","DGHTHLAA",7,0)
 ;
"RTN","DGHTHLAA",8,0)
 ;   Note: This process will update file # 391.31 subfile 391.317
"RTN","DGHTHLAA",9,0)
 ;           Date/Time of ACK from HT        -  Field .06
"RTN","DGHTHLAA",10,0)
 ;           ACK Code from HT                -  Field .07
"RTN","DGHTHLAA",11,0)
 ;           Reject Message(Only if reject)  -  Field .08
"RTN","DGHTHLAA",12,0)
 ;
"RTN","DGHTHLAA",13,0)
 N DGHMSG,DGHPARAM,I,X
"RTN","DGHTHLAA",14,0)
 ;
"RTN","DGHTHLAA",15,0)
 ;Get message text
"RTN","DGHTHLAA",16,0)
 S ^TMP("DGRUACK",$H)="START PROCESS"
"RTN","DGHTHLAA",17,0)
 F I=1:1 X HLNEXT Q:(HLQUIT'>0)  D
"RTN","DGHTHLAA",18,0)
 . S DGHMSG(I,1)=HLNODE
"RTN","DGHTHLAA",19,0)
 . ; Check for segment length greater than 245
"RTN","DGHTHLAA",20,0)
 . S X=0 F  S X=+$O(HLNODE(X)) Q:('X)  S DGHMSG(I,(X+1))=HLNODE(X)
"RTN","DGHTHLAA",21,0)
 ;
"RTN","DGHTHLAA",22,0)
 ;Quit if there is no valid message header
"RTN","DGHTHLAA",23,0)
 Q:$P($G(DGHMSG(1,1)),"^")'="MSH"
"RTN","DGHTHLAA",24,0)
 ;
"RTN","DGHTHLAA",25,0)
 M ^TMP("DGRUACK",$H,"HL")=DGHMSG
"RTN","DGHTHLAA",26,0)
 ;analyze the message and take appropriate action
"RTN","DGHTHLAA",27,0)
 ;
"RTN","DGHTHLAA",28,0)
 S X=1,DGHPARAM=""
"RTN","DGHTHLAA",29,0)
 F  S X=+$O(DGHMSG(X)) Q:('X)  D
"RTN","DGHTHLAA",30,0)
 . I $P(DGHMSG(X,1),"^")="MSA" D
"RTN","DGHTHLAA",31,0)
 .. D PROCESS(DGHMSG(X,1),.DGHPARAM)
"RTN","DGHTHLAA",32,0)
 Q
"RTN","DGHTHLAA",33,0)
 ;
"RTN","DGHTHLAA",34,0)
PROCESS(DGHMSG,DGHPARAM) ;
"RTN","DGHTHLAA",35,0)
 N EVNTYPE,ACK,REJMSG,MSGID,IEN,SIEN,PATIENT,FLDS,DGHERR,DGHFDA,DATE
"RTN","DGHTHLAA",36,0)
 ;Initialize variables
"RTN","DGHTHLAA",37,0)
 S EVNTYPE=""
"RTN","DGHTHLAA",38,0)
 ;
"RTN","DGHTHLAA",39,0)
 ;Set incoming message event type
"RTN","DGHTHLAA",40,0)
 S EVNTYPE=$G(HL("ETN"))
"RTN","DGHTHLAA",41,0)
 ;
"RTN","DGHTHLAA",42,0)
 Q:$G(DGHMSG)']""
"RTN","DGHTHLAA",43,0)
 ;
"RTN","DGHTHLAA",44,0)
 S ACK=$P(DGHMSG,"^",2)         ; Get acknowledgement code
"RTN","DGHTHLAA",45,0)
 S REJMSG=$P(DGHMSG,"^",7)   ; Get Reject Message if it exist
"RTN","DGHTHLAA",46,0)
 ;
"RTN","DGHTHLAA",47,0)
 ;Get outgoing message ID
"RTN","DGHTHLAA",48,0)
 S MSGID=$P(DGHMSG,U,3)
"RTN","DGHTHLAA",49,0)
 ;
"RTN","DGHTHLAA",50,0)
 ;Update Home Telehealth File (# 391.31) sub-file (#391.317)
"RTN","DGHTHLAA",51,0)
 ;$order on "D" cross reference to resolve IEN and SIEN values
"RTN","DGHTHLAA",52,0)
 ;for updating the record and sub record
"RTN","DGHTHLAA",53,0)
 ;
"RTN","DGHTHLAA",54,0)
 S IEN=0,IEN=$O(^DGHT(391.31,"D",MSGID,IEN)) Q:'+IEN
"RTN","DGHTHLAA",55,0)
 S SIEN=0,SIEN=$O(^DGHT(391.31,"D",MSGID,IEN,SIEN)) Q:'+SIEN
"RTN","DGHTHLAA",56,0)
 Q:$P($G(^DGHT(391.31,IEN,"TRAN",SIEN,0)),U,7)="A"
"RTN","DGHTHLAA",57,0)
 ;Resolve external value for PATIENT
"RTN","DGHTHLAA",58,0)
 S PATIENT=$$GET1^DIQ(2,$P($G(^DGHT(391.31,IEN,0)),U,2),.01,"E")
"RTN","DGHTHLAA",59,0)
 S FLDS=SIEN_","_IEN_","
"RTN","DGHTHLAA",60,0)
 ;If valid entries found update subfile 391.317
"RTN","DGHTHLAA",61,0)
 I IEN&SIEN D
"RTN","DGHTHLAA",62,0)
 .;Convert date to FM format
"RTN","DGHTHLAA",63,0)
 .S DATE=$$FMTE^XLFDT($$FMDATE^HLFNC($P(HL("DTM"),"-",1)))
"RTN","DGHTHLAA",64,0)
 .S DGHFDA(391.317,FLDS,.06)=DATE
"RTN","DGHTHLAA",65,0)
 .S DGHFDA(391.317,FLDS,.07)=$S(ACK="AA":"A",ACK="AR":"R",1:"")
"RTN","DGHTHLAA",66,0)
 .S DGHFDA(391.317,FLDS,.08)=$P(REJMSG,"~",2)
"RTN","DGHTHLAA",67,0)
 .D FILE^DIE("EK","DGHFDA","DGHERR")
"RTN","DGHTHLAA",68,0)
 .I $D(DGHERR) S DGHERR="Problem encountered while filing record # "_IEN
"RTN","DGHTHLAA",69,0)
 ;
"RTN","DGHTHLAA",70,0)
 ;If valid AA is receieved for message kill the "HTHNOACK" xref
"RTN","DGHTHLAA",71,0)
 D:(ACK="AA")!(ACK="AR") KILLXREF^DGHTXREF(MSGID)
"RTN","DGHTHLAA",72,0)
 ;
"RTN","DGHTHLAA",73,0)
 ;Update inactivation date field (#6)
"RTN","DGHTHLAA",74,0)
 I $P($G(^DGHT(391.31,IEN,"TRAN",SIEN,0)),U,4)="I",ACK="AA",'$D(DGHERR) D
"RTN","DGHTHLAA",75,0)
 .N FLDS S FLDS=IEN_","
"RTN","DGHTHLAA",76,0)
 .S DGHFDA(391.31,FLDS,6)=DATE
"RTN","DGHTHLAA",77,0)
 .D FILE^DIE("EK","DGHFDA","DGHERR")
"RTN","DGHTHLAA",78,0)
 ; 
"RTN","DGHTHLAA",79,0)
 ;If the ACK is AA and 'DGHERR quit
"RTN","DGHTHLAA",80,0)
 Q:ACK="AA"&'$D(DGHERR)
"RTN","DGHTHLAA",81,0)
 ;
"RTN","DGHTHLAA",82,0)
 ;If transaction is not found in subfile #391.317 set DGHERR variable
"RTN","DGHTHLAA",83,0)
 I '+SIEN S DGHERR="Problem processing transaction record"
"RTN","DGHTHLAA",84,0)
 ;
"RTN","DGHTHLAA",85,0)
 ;Set DGHPARAM(4) to  error message if defined
"RTN","DGHTHLAA",86,0)
 S DGHPARAM(4)=$S($D(DGHERR):DGHERR,ACK'="AA":$P(DGHMSG,"^",7),1:"")
"RTN","DGHTHLAA",87,0)
 ;
"RTN","DGHTHLAA",88,0)
 D MESSAGE
"RTN","DGHTHLAA",89,0)
 Q
"RTN","DGHTHLAA",90,0)
 ;
"RTN","DGHTHLAA",91,0)
MESSAGE ;Build bulletin and send to mail group
"RTN","DGHTHLAA",92,0)
 ;      Input:
"RTN","DGHTHLAA",93,0)
 ;      Output:
"RTN","DGHTHLAA",94,0)
 ;
"RTN","DGHTHLAA",95,0)
 N MSGTEXT,XMTEXT,XMSUB,XMY,XMCHAN,XMZ,XMDUZ,MSGTYPE
"RTN","DGHTHLAA",96,0)
 S MSGTYPE=$S(EVNTYPE["A04":"Sign-up/Activation",EVNTYPE["A03":"Inactivation",1:"")
"RTN","DGHTHLAA",97,0)
 S MSGTEXT(1)=" "
"RTN","DGHTHLAA",98,0)
 S MSGTEXT(2)="Home Telehealth "_MSGTYPE_" was REJECTED"
"RTN","DGHTHLAA",99,0)
 S MSGTEXT(3)=" "
"RTN","DGHTHLAA",100,0)
 S MSGTEXT(4)="Date:       "_$$FMTE^XLFDT(DATE,1)
"RTN","DGHTHLAA",101,0)
 S MSGTEXT(5)="Patient:    "_PATIENT
"RTN","DGHTHLAA",102,0)
 S MSGTEXT(6)="Message ID: "_MSGID
"RTN","DGHTHLAA",103,0)
 S MSGTEXT(7)="Error Code: "_DGHPARAM(4)
"RTN","DGHTHLAA",104,0)
 ;Send message to mail group
"RTN","DGHTHLAA",105,0)
 S XMSUB="Home Telehealth Patient "_MSGTYPE_" Reject"
"RTN","DGHTHLAA",106,0)
 S XMTEXT="MSGTEXT("
"RTN","DGHTHLAA",107,0)
 S XMY("G.DGHTERR")=""
"RTN","DGHTHLAA",108,0)
 S XMCHAN=1
"RTN","DGHTHLAA",109,0)
 S XMDUZ="Home Telehealth Patient "_MSGTYPE
"RTN","DGHTHLAA",110,0)
 D ^XMD
"RTN","DGHTHLAA",111,0)
 Q
"RTN","DGHTINAC")
0^5^B40701300^n/a
"RTN","DGHTINAC",1,0)
DGHTINAC ;ALB/JRC/JAM - Home Telehealth Patient Inactivation HL7;10 January 2005 ; 11/14/06 9:46am
"RTN","DGHTINAC",2,0)
 ;;5.3;Registration;**644**;Aug 13, 1993;Build 11
"RTN","DGHTINAC",3,0)
 ;;
"RTN","DGHTINAC",4,0)
EN ;Main entry point
"RTN","DGHTINAC",5,0)
 ;Initiate variables
"RTN","DGHTINAC",6,0)
 N STOP,ARR,DGTYPE,DGDUZ,FLG
"RTN","DGHTINAC",7,0)
 N CNT,DGDFN,DGVEN,NODE,NODE1,MSGTYPE,INACTDT,IRECORD,INODE,DGEVNT
"RTN","DGHTINAC",8,0)
 N INAMSGID,ACKCODE,TINACTDT,DGVEN,DGCOOR,DGDATE,VENDOR,CHOICES
"RTN","DGHTINAC",9,0)
 N ARECORD,NUMBER,TMPNODE,ITRANS,INODE,DGMID,RESULT,GETOK,DIR,RECORD
"RTN","DGHTINAC",10,0)
 S ARR=$NA(HLA("HLS")),DGTYPE="I",DGDUZ=DUZ
"RTN","DGHTINAC",11,0)
 S STOP=0
"RTN","DGHTINAC",12,0)
 F  D  Q:STOP
"RTN","DGHTINAC",13,0)
 .K ^TMP("DGHT",$J),CHOICES
"RTN","DGHTINAC",14,0)
 .S (DGVEN,RECORD,CNT,FLG,ITRANS)=0
"RTN","DGHTINAC",15,0)
 .W !!
"RTN","DGHTINAC",16,0)
 .;Select patient
"RTN","DGHTINAC",17,0)
 .S DGDFN=$$GETPAT()
"RTN","DGHTINAC",18,0)
 .I 'DGDFN S STOP=1 Q
"RTN","DGHTINAC",19,0)
 .;Get active patient's home telehealth records
"RTN","DGHTINAC",20,0)
 .F  S DGVEN=$O(^DGHT(391.31,"APATVN",DGDFN,DGVEN)) Q:'DGVEN  D
"RTN","DGHTINAC",21,0)
 ..S ARECORD=$$LOCREC(DGDFN,DGVEN,"A")
"RTN","DGHTINAC",22,0)
 ..Q:'(ARECORD)
"RTN","DGHTINAC",23,0)
 ..;Get 0'th node of activation record and 0'th node of transaction
"RTN","DGHTINAC",24,0)
 ..S NODE=$G(^DGHT(391.31,$P(ARECORD,U,1),0))
"RTN","DGHTINAC",25,0)
 ..S NODE1=$G(^DGHT(391.31,+$P(ARECORD,U,1),"TRAN",+$P(ARECORD,U,2),0))
"RTN","DGHTINAC",26,0)
 ..Q:$P(NODE1,U,7)'="A"
"RTN","DGHTINAC",27,0)
 ..S IRECORD=$$LOCREC(DGDFN,DGVEN,"I")
"RTN","DGHTINAC",28,0)
 ..Q:'+IRECORD
"RTN","DGHTINAC",29,0)
 ..S MSGTYPE=$P($G(NODE1),U,4),INACTDT=$P($G(NODE),U,7)
"RTN","DGHTINAC",30,0)
 ..;Get Inactivation transaction node if exist
"RTN","DGHTINAC",31,0)
 ..S INODE=$G(^DGHT(391.31,+$P(IRECORD,U,1),"TRAN",+$P(IRECORD,U,2),0))
"RTN","DGHTINAC",32,0)
 ..S INAMSGID=$P(INODE,U,2),ACKCODE=$P(INODE,U,7),TINACTDT=$P(INODE,U,1)
"RTN","DGHTINAC",33,0)
 ..I $P($G(INODE),U,7)="A" Q
"RTN","DGHTINAC",34,0)
 ..;Increment counter
"RTN","DGHTINAC",35,0)
 ..S CNT=CNT+1
"RTN","DGHTINAC",36,0)
 ..;Store records in temporary global
"RTN","DGHTINAC",37,0)
 ..;
"RTN","DGHTINAC",38,0)
 ..;  ^TMP NODE  - Record # ^ Transaction # ^ patient ^ vendor ^
"RTN","DGHTINAC",39,0)
 ..;               trans date ^ coordinator ^ trans type ^ inactiva
"RTN","DGHTINAC",40,0)
 ..;               tio date ^ inact msg id ^ inact msg ack code ^
"RTN","DGHTINAC",41,0)
 ..;               trans inactivation date and time ^ inact record
"RTN","DGHTINAC",42,0)
 ..;
"RTN","DGHTINAC",43,0)
 ..S DGVEN=$P(NODE,U,3),DGCOOR=$P(NODE,U,5),DGDATE=$P(NODE,U,6)
"RTN","DGHTINAC",44,0)
 ..S ^TMP("DGHT",$J,CNT,$P(ARECORD,U,1))=ARECORD_U_DGDFN_U_DGVEN_U_DGDATE_U_DGCOOR_U_MSGTYPE_U_INACTDT_U_$G(INAMSGID)_U_$G(ACKCODE)_U_$G(TINACTDT)_U_$TR(IRECORD,U,"~")
"RTN","DGHTINAC",45,0)
 ..;If more than one record prepare CHOICES variable for DIR call
"RTN","DGHTINAC",46,0)
 ..S VENDOR=$$GET1^DIQ(4,$P(NODE,U,3),.01,"E")
"RTN","DGHTINAC",47,0)
 ..S CHOICES=$G(CHOICES)_CNT_":"_$TR($$FMTE^XLFDT(DGDATE,"1HM"),":","")_"   "_VENDOR_";"
"RTN","DGHTINAC",48,0)
 ..;If more than one active HTH record prompt user for selection
"RTN","DGHTINAC",49,0)
 .I CNT>1 D  Q:FLG
"RTN","DGHTINAC",50,0)
 ..;Resolve external value for PATIENT
"RTN","DGHTINAC",51,0)
 ..W !!,"Patient "_$$GET1^DIQ(2,DGDFN,.01,"E")_" has multiple  active records"
"RTN","DGHTINAC",52,0)
 ..K DIR,X,Y,DIRUT,DUOUT
"RTN","DGHTINAC",53,0)
 ..S DIR(0)="S^"_CHOICES
"RTN","DGHTINAC",54,0)
 ..S DIR("A")="Select Sign-up/Activation record to Inactivate"
"RTN","DGHTINAC",55,0)
 ..D ^DIR
"RTN","DGHTINAC",56,0)
 ..I $D(DIRUT)!$D(DUOUT) S FLG=1 Q
"RTN","DGHTINAC",57,0)
 ..S NUMBER=Y
"RTN","DGHTINAC",58,0)
 ..S RECORD=0,RECORD=$O(^TMP("DGHT",$J,NUMBER,RECORD))
"RTN","DGHTINAC",59,0)
 ..S TMPNODE=^TMP("DGHT",$J,NUMBER,RECORD),IRECORD=$P(TMPNODE,U,12)
"RTN","DGHTINAC",60,0)
 .;If there is only one record suppress choices
"RTN","DGHTINAC",61,0)
 .I CNT=1 D
"RTN","DGHTINAC",62,0)
 ..S NUMBER=CNT
"RTN","DGHTINAC",63,0)
 ..S RECORD=0,RECORD=$O(^TMP("DGHT",$J,NUMBER,RECORD))
"RTN","DGHTINAC",64,0)
 ..S TMPNODE=^TMP("DGHT",$J,CNT,RECORD),IRECORD=$P(TMPNODE,U,12)
"RTN","DGHTINAC",65,0)
 .;If no active records
"RTN","DGHTINAC",66,0)
 .I 'CNT D  Q:FLG
"RTN","DGHTINAC",67,0)
 ..W !
"RTN","DGHTINAC",68,0)
 ..W !,"************************************************************"
"RTN","DGHTINAC",69,0)
 ..W !,"*   THIS PATIENT HAS NO ACTIVE HOME TELEHEALTH  RECORDS     *"
"RTN","DGHTINAC",70,0)
 ..W !,"************************************************************"
"RTN","DGHTINAC",71,0)
 ..S FLG=1
"RTN","DGHTINAC",72,0)
 .;Display patient's record information to screen
"RTN","DGHTINAC",73,0)
 .W @IOF
"RTN","DGHTINAC",74,0)
 .W !!,"THE FOLLOWING PATIENT'S HOME TELEHEALTH RECORD WILL BE INACTIVATED"
"RTN","DGHTINAC",75,0)
 .W !!
"RTN","DGHTINAC",76,0)
 .D DSPREC^DGHTENR($P(TMPNODE,U,1,2))
"RTN","DGHTINAC",77,0)
 .;If patient's record was previously inactivated display information
"RTN","DGHTINAC",78,0)
 .I +$P(IRECORD,"~",2)'="" D
"RTN","DGHTINAC",79,0)
 ..W !,"Patient's inactivation was previously transmitted on:"
"RTN","DGHTINAC",80,0)
 ..W !!,?3,"Date & Time: ",?21,$$FMTE^XLFDT($P(TMPNODE,U,11),"2")
"RTN","DGHTINAC",81,0)
 ..W !,?3,"Message ID: ",?21,$P(TMPNODE,U,9)
"RTN","DGHTINAC",82,0)
 ..W !,?3,"Acknowledge Code: ",?21,$S($P(TMPNODE,U,10)="R":"Rejected",$P(TMPNODE,U,10)="A":"Accepted",1:"")
"RTN","DGHTINAC",83,0)
 ..W !!
"RTN","DGHTINAC",84,0)
 .;Prompt user for inactivation date
"RTN","DGHTINAC",85,0)
 .K DIR,X,Y,DIRUT,DUOUT
"RTN","DGHTINAC",86,0)
 .S DIR(0)="D^::ERTXS"
"RTN","DGHTINAC",87,0)
 .S DIR("A")="Enter Inactivation Date & Time"
"RTN","DGHTINAC",88,0)
 .S DIR("B")=$$FMTE^XLFDT($$NOW^XLFDT())
"RTN","DGHTINAC",89,0)
 .D ^DIR
"RTN","DGHTINAC",90,0)
 .I $D(DIRUT)!$D(DUOUT) D EXIT Q
"RTN","DGHTINAC",91,0)
 .S DGEVNT=Y
"RTN","DGHTINAC",92,0)
 .;Get okay for tansmission
"RTN","DGHTINAC",93,0)
 .S GETOK=$$SNDMSG^DGHTENR(DGTYPE)
"RTN","DGHTINAC",94,0)
 .I 'GETOK W "  ...Patient record not transmitted." D EXIT Q
"RTN","DGHTINAC",95,0)
 .;Set variables and validate
"RTN","DGHTINAC",96,0)
 .S DGVEN=$P(TMPNODE,U,4),DGDATE=$P(TMPNODE,U,5)
"RTN","DGHTINAC",97,0)
 .S DGCOOR=$P(TMPNODE,U,6),TINACTDT=$P(TMPNODE,U,10)
"RTN","DGHTINAC",98,0)
 .;build message
"RTN","DGHTINAC",99,0)
 .W !!,"Generating message ..."
"RTN","DGHTINAC",100,0)
 .K @ARR
"RTN","DGHTINAC",101,0)
 .S RESULT=$$BLDHL7I^DGHTHL7(DGDFN,ARR)
"RTN","DGHTINAC",102,0)
 .I RESULT<0 D  Q
"RTN","DGHTINAC",103,0)
 ..W !,"** UNABLE TO BUILD MESSAGE **"
"RTN","DGHTINAC",104,0)
 ..W !,$P(RESULT,"^",2)
"RTN","DGHTINAC",105,0)
 ..K @ARR
"RTN","DGHTINAC",106,0)
 .I RESULT=0 D  Q
"RTN","DGHTINAC",107,0)
 ..W !,"** EMPTY MESSAGE BUILT **"
"RTN","DGHTINAC",108,0)
 ..K @ARR
"RTN","DGHTINAC",109,0)
 .;send message
"RTN","DGHTINAC",110,0)
 .W !,"Sending message ..."
"RTN","DGHTINAC",111,0)
 .S RESULT=$$SNDHL7^DGHTHL7(ARR,DGVEN,"DG HOME TELEHEALTH ADT-A03 SERVER")
"RTN","DGHTINAC",112,0)
 .I RESULT<0 D  Q
"RTN","DGHTINAC",113,0)
 ..W !,"** UNABLE TO SEND MESSAGE **"
"RTN","DGHTINAC",114,0)
 ..W !,$P(RESULT,"^",2)
"RTN","DGHTINAC",115,0)
 ..K @ARR
"RTN","DGHTINAC",116,0)
 .W !,"Sent using message ID ",+RESULT
"RTN","DGHTINAC",117,0)
 .S DGMID=$P(RESULT,U,1)
"RTN","DGHTINAC",118,0)
 .K @ARR
"RTN","DGHTINAC",119,0)
 .D FILE
"RTN","DGHTINAC",120,0)
 D EXIT
"RTN","DGHTINAC",121,0)
 Q
"RTN","DGHTINAC",122,0)
 ;
"RTN","DGHTINAC",123,0)
GETPAT()        ;Prompt user for patient
"RTN","DGHTINAC",124,0)
 ;Input : None
"RTN","DGHTINAC",125,0)
 ;Output: Pointer to PATIENT File, #2 (i.e. DFN)
"RTN","DGHTINAC",126,0)
 ;        0 on user quit
"RTN","DGHTINAC",127,0)
 N DIC,X,Y,DTOUT,DUOUT
"RTN","DGHTINAC",128,0)
 S DIC="^DPT(",DIC("A")="Patient: "
"RTN","DGHTINAC",129,0)
 S DIC(0)="AEQM"
"RTN","DGHTINAC",130,0)
 S DIC("S")="I $D(^DGHT(391.31,""APATVN"",+Y))"
"RTN","DGHTINAC",131,0)
 D ^DIC
"RTN","DGHTINAC",132,0)
 Q $S(+Y<0:0,1:+Y)
"RTN","DGHTINAC",133,0)
 ;
"RTN","DGHTINAC",134,0)
FILE ;Update Home Telehealth File Inactivation
"RTN","DGHTINAC",135,0)
 N DGHFDA,DGHERR,FLDS,DA
"RTN","DGHTINAC",136,0)
 ;Remove old inactivation entry in transaction subfile
"RTN","DGHTINAC",137,0)
 I +$P(IRECORD,"~",2) D
"RTN","DGHTINAC",138,0)
 .N DIK S DA(1)=+$P(IRECORD,"~",1),DA=+$P(IRECORD,"~",2)
"RTN","DGHTINAC",139,0)
 .S DIK="^DGHT(391.31,"_DA(1)_",""TRAN"","
"RTN","DGHTINAC",140,0)
 .D ^DIK
"RTN","DGHTINAC",141,0)
 ;Update subfile 391.317 Transaction
"RTN","DGHTINAC",142,0)
 K DGHFDA,DGHERR
"RTN","DGHTINAC",143,0)
 S DGHFDA(391.317,"+2,"_RECORD_",",.01)=DGEVNT
"RTN","DGHTINAC",144,0)
 S DGHFDA(391.317,"+2,"_RECORD_",",.02)=DGMID
"RTN","DGHTINAC",145,0)
 S DGHFDA(391.317,"+2,"_RECORD_",",.03)=DGDUZ
"RTN","DGHTINAC",146,0)
 S DGHFDA(391.317,"+2,"_RECORD_",",.04)=DGTYPE
"RTN","DGHTINAC",147,0)
 D UPDATE^DIE("","DGHFDA","","DGHERR")
"RTN","DGHTINAC",148,0)
 I $D(DGHERR) D
"RTN","DGHTINAC",149,0)
 .W !!!,"Problem encountered during record update "
"RTN","DGHTINAC",150,0)
 .W !!,"Contact IRM"_"  Error: "_$G(DGHERR("DIERR",1,"TEXT",1))
"RTN","DGHTINAC",151,0)
 Q
"RTN","DGHTINAC",152,0)
 ;
"RTN","DGHTINAC",153,0)
LOCREC(DFN,VENDOR,TYPE) ;Locate the appropriate record pointer(s) for processing
"RTN","DGHTINAC",154,0)
 ;Input : DFN    - Patient DFN
"RTN","DGHTINAC",155,0)
 ;        VENDOR - Vendor IEN
"RTN","DGHTINAC",156,0)
 ;        TYPE   - A for Activation/Sign-up  or I for Inactivation
"RTN","DGHTINAC",157,0)
 ;Output: Record IEN^transaction IEN (if available)
"RTN","DGHTINAC",158,0)
 ;   flag 1 = Patient record was located
"RTN","DGHTINAC",159,0)
 ;        0 = No record was located.
"RTN","DGHTINAC",160,0)
 ;
"RTN","DGHTINAC",161,0)
 ;If TYPE="A"  and record has inactivation date then nothing will be 
"RTN","DGHTINAC",162,0)
 ;             returned, record is consider closed.
"RTN","DGHTINAC",163,0)
 ;   TYPE="I"  and transaction level record was accepted,then nothing
"RTN","DGHTINAC",164,0)
 ;             will be returned, record is consider closed.
"RTN","DGHTINAC",165,0)
 ;
"RTN","DGHTINAC",166,0)
 I ($G(DFN)="")!($G(VENDOR)="")!($G(TYPE)="") Q 0
"RTN","DGHTINAC",167,0)
 N IEN,IEN1,DGDAT,DGDAT1,FND,FND1
"RTN","DGHTINAC",168,0)
 S (IEN,FND,FND1)=0
"RTN","DGHTINAC",169,0)
 F  S IEN=$O(^DGHT(391.31,"APATVN",DFN,VENDOR,IEN)) Q:'IEN  D  I FND Q
"RTN","DGHTINAC",170,0)
 .S DGDAT=$G(^DGHT(391.31,IEN,0)) I DGDAT="" Q
"RTN","DGHTINAC",171,0)
 .Q:$P(DGDAT,"^",7)'=""
"RTN","DGHTINAC",172,0)
 .;I TYPE="A" Q:$P(DGDAT,"^",7)'=""
"RTN","DGHTINAC",173,0)
 .;I TYPE="I",$P(DGDAT,"^",7)="" S FND=IEN Q
"RTN","DGHTINAC",174,0)
 .S IEN1=0 F  S IEN1=$O(^DGHT(391.31,IEN,"TRAN",IEN1)) Q:'IEN1  D  Q:+FND1
"RTN","DGHTINAC",175,0)
 ..S DGDAT1=$G(^DGHT(391.31,IEN,"TRAN",IEN1,0)) Q:DGDAT1=""
"RTN","DGHTINAC",176,0)
 ..I $P(DGDAT1,"^",4)'=$E(TYPE) Q
"RTN","DGHTINAC",177,0)
 ..I TYPE="I",$P(DGDAT1,"^",7)="A" Q
"RTN","DGHTINAC",178,0)
 ..S FND1=IEN1
"RTN","DGHTINAC",179,0)
 .S FND=IEN_$S(IEN1:"^"_IEN1,1:"")
"RTN","DGHTINAC",180,0)
 Q FND
"RTN","DGHTINAC",181,0)
 ;
"RTN","DGHTINAC",182,0)
EXIT ;Kill array
"RTN","DGHTINAC",183,0)
 K ^TMP("DGHT",$J)
"RTN","DGHTINAC",184,0)
 Q
"RTN","DGHTRPT")
0^3^B35941394^n/a
"RTN","DGHTRPT",1,0)
DGHTRPT ;ALB/JRC - Home Telehealth Transmissions Report ; 1/9/06 9:22am
"RTN","DGHTRPT",2,0)
 ;;5.3;Registration;**644**;Aug 13, 1993;Build 11
"RTN","DGHTRPT",3,0)
 ;
"RTN","DGHTRPT",4,0)
EN ;entry point from option
"RTN","DGHTRPT",5,0)
 ;Declare variable(s) and arrays
"RTN","DGHTRPT",6,0)
 N DGSD,DGED,I,SCANARR,MSGSTAT,FLAG
"RTN","DGHTRPT",7,0)
 N ZTDESC,ZTIO,ZTSAVE
"RTN","DGHTRPT",8,0)
 S FLAG=""
"RTN","DGHTRPT",9,0)
 ;Prompt for starting and ending date
"RTN","DGHTRPT",10,0)
 D GETDATES^DGHTRPT1 Q:FLAG
"RTN","DGHTRPT",11,0)
 ;Get ACK status
"RTN","DGHTRPT",12,0)
 D GETSTAT Q:FLAG
"RTN","DGHTRPT",13,0)
 ;Get coordinator(s)
"RTN","DGHTRPT",14,0)
 D GETCOOR Q:FLAG
"RTN","DGHTRPT",15,0)
 ;Queue Report
"RTN","DGHTRPT",16,0)
 S ZTIO=""
"RTN","DGHTRPT",17,0)
 S ZTDESC="Home Telehealth Transmission Report"
"RTN","DGHTRPT",18,0)
 F I="DGSD","DGED","SCANARR","MSGSTAT" S ZTSAVE(I)=""
"RTN","DGHTRPT",19,0)
 D EN^XUTMDEVQ("EN1^DGHTRPT",ZTDESC,.ZTSAVE)
"RTN","DGHTRPT",20,0)
 Q
"RTN","DGHTRPT",21,0)
 ;
"RTN","DGHTRPT",22,0)
EN1 ;Tasked entry point
"RTN","DGHTRPT",23,0)
 ;Input : DGSD  -  FM format report start date
"RTN","DGHTRPT",24,0)
 ;        DGED   -  FM format report end date
"RTN","DGHTRPT",25,0)
 ;
"RTN","DGHTRPT",26,0)
 ;Output : None
"RTN","DGHTRPT",27,0)
 ;
"RTN","DGHTRPT",28,0)
 ;Declare variables
"RTN","DGHTRPT",29,0)
 N DGSD1,DGED1,STOP,CNT,LN,PAGENUM,SCRNARR
"RTN","DGHTRPT",30,0)
 S DGED1=DGED+.9999,DGSD1=DGSD-.0001,(CNT,PAGENUM,STOP)=0
"RTN","DGHTRPT",31,0)
 S SCRNARR="^TMP(""DGHT"",$J,""SCRNARR"")"
"RTN","DGHTRPT",32,0)
 K @SCRNARR
"RTN","DGHTRPT",33,0)
 M @SCRNARR@("PROVIDERS")=SCANARR
"RTN","DGHTRPT",34,0)
 D HEADER
"RTN","DGHTRPT",35,0)
 D GETDATA
"RTN","DGHTRPT",36,0)
 I 'CNT D  Q
"RTN","DGHTRPT",37,0)
 .W !
"RTN","DGHTRPT",38,0)
 .W !,"***********************************************"
"RTN","DGHTRPT",39,0)
 .W !,"*  NOTHING TO REPORT FOR SELECTED TIME FRAME  *"
"RTN","DGHTRPT",40,0)
 .W !,"***********************************************"
"RTN","DGHTRPT",41,0)
 .D WAIT
"RTN","DGHTRPT",42,0)
 D DETAIL I STOP D EXIT Q
"RTN","DGHTRPT",43,0)
 D TOTAL
"RTN","DGHTRPT",44,0)
 D EXIT
"RTN","DGHTRPT",45,0)
 Q
"RTN","DGHTRPT",46,0)
 ;
"RTN","DGHTRPT",47,0)
GETSTAT ;Prompt for message status to report
"RTN","DGHTRPT",48,0)
 N DIR,X,Y
"RTN","DGHTRPT",49,0)
 S DIR(0)="SC^1:ALL;2:ACCEPTED;3:REJECTED"
"RTN","DGHTRPT",50,0)
 S DIR("A")="Select message status for report"
"RTN","DGHTRPT",51,0)
 D ^DIR
"RTN","DGHTRPT",52,0)
 I $D(DIRUT) S FLAG=1 Q
"RTN","DGHTRPT",53,0)
 S MSGSTAT=Y
"RTN","DGHTRPT",54,0)
 Q
"RTN","DGHTRPT",55,0)
 ;
"RTN","DGHTRPT",56,0)
GETCOOR ;Prompt for coordinator(s)
"RTN","DGHTRPT",57,0)
 N DIC,VAUTSTR,VAUTVB,VAUTNI,Y
"RTN","DGHTRPT",58,0)
 ;Get provider selection
"RTN","DGHTRPT",59,0)
 S DIC="^VA(200,"
"RTN","DGHTRPT",60,0)
 S VAUTSTR="CARE COORDINATOR"
"RTN","DGHTRPT",61,0)
 S VAUTVB="SCANARR"
"RTN","DGHTRPT",62,0)
 S VAUTNI=2
"RTN","DGHTRPT",63,0)
 D FIRST^VAUTOMA
"RTN","DGHTRPT",64,0)
 I Y<0 S FLAG=1 Q
"RTN","DGHTRPT",65,0)
 Q
"RTN","DGHTRPT",66,0)
 ;
"RTN","DGHTRPT",67,0)
GETDATA ;Get data
"RTN","DGHTRPT",68,0)
 ;Declare variables
"RTN","DGHTRPT",69,0)
 N PATIENT,SSN,VENDOR,COORD,CONSULT,DATE,MSGID,ACKDATE,STATUS,REJECT
"RTN","DGHTRPT",70,0)
 N MSGTYPE,STATUS,DGDA0,DGDA1,DG0,DG1
"RTN","DGHTRPT",71,0)
 F  S DGSD1=$O(^DGHT(391.31,"C",DGSD1)) Q:(DGSD1>DGED1)!('DGSD1)  D
"RTN","DGHTRPT",72,0)
 .S DGDA0=0
"RTN","DGHTRPT",73,0)
 .F  S DGDA0=$O(^DGHT(391.31,"C",DGSD1,DGDA0)) Q:'DGDA0  D
"RTN","DGHTRPT",74,0)
 ..S DGDA1=0
"RTN","DGHTRPT",75,0)
 ..F  S DGDA1=$O(^DGHT(391.31,"C",DGSD1,DGDA0,DGDA1)) Q:'DGDA1  D
"RTN","DGHTRPT",76,0)
 ...;Get data node and increment conunter
"RTN","DGHTRPT",77,0)
 ...S DG0=$G(^DGHT(391.31,DGDA0,0))
"RTN","DGHTRPT",78,0)
 ...Q:DG0=""
"RTN","DGHTRPT",79,0)
 ...S DG1=$G(^DGHT(391.31,DGDA0,"TRAN",DGDA1,0))
"RTN","DGHTRPT",80,0)
 ...Q:DG1=""
"RTN","DGHTRPT",81,0)
 ...S PATIENT=$P(DG0,U,2),VENDOR=$P(DG0,U,3),CONSULT=$P(DG0,U,4)
"RTN","DGHTRPT",82,0)
 ...S COORD=$P(DG0,U,5),DATE=$P(DG1,U,1),MSGID=$P(DG1,U,2)
"RTN","DGHTRPT",83,0)
 ...S ACKDATE=$P(DG1,U,6),STATUS=$P(DG1,U,7),REJECT=$P(DG1,U,8)
"RTN","DGHTRPT",84,0)
 ...S MSGTYPE=$P(DG1,U,4)
"RTN","DGHTRPT",85,0)
 ...;Check Screens
"RTN","DGHTRPT",86,0)
 ...Q:MSGSTAT'=1&(MSGSTAT'=$S(STATUS="A":2,STATUS="R":3,1:""))
"RTN","DGHTRPT",87,0)
 ...Q:'@SCRNARR@("PROVIDERS")&'$D(@SCRNARR@("PROVIDERS",COORD))
"RTN","DGHTRPT",88,0)
 ...;Resolve external values for PATIENT
"RTN","DGHTRPT",89,0)
 ...S SSN=$E($$GET1^DIQ(2,PATIENT,.09,"I"),6,9)
"RTN","DGHTRPT",90,0)
 ...S PATIENT=$$GET1^DIQ(2,PATIENT,.01,"E")
"RTN","DGHTRPT",91,0)
 ...;Resolve external value for VENDOR
"RTN","DGHTRPT",92,0)
 ...S VENDOR=$$GET1^DIQ(4,VENDOR,.01,"E")
"RTN","DGHTRPT",93,0)
 ...;Resolve external value for COORD
"RTN","DGHTRPT",94,0)
 ...S COORD=$$GET1^DIQ(200,COORD,.01,"E")
"RTN","DGHTRPT",95,0)
 ...;Increment counter and save for later
"RTN","DGHTRPT",96,0)
 ...S CNT=CNT+1
"RTN","DGHTRPT",97,0)
 ...S ^TMP("DGHT",$J,CNT)=PATIENT_U_SSN_U_VENDOR_U_COORD_U_CONSULT_U_DATE_U_MSGID_U_ACKDATE_U_STATUS_U_REJECT_U_MSGTYPE
"RTN","DGHTRPT",98,0)
 Q
"RTN","DGHTRPT",99,0)
HEADER ;print header
"RTN","DGHTRPT",100,0)
 S PAGENUM=PAGENUM+1
"RTN","DGHTRPT",101,0)
 S $P(LN,"-",80)=""
"RTN","DGHTRPT",102,0)
 W @IOF
"RTN","DGHTRPT",103,0)
 W !,"Home Telehealth ",$S(MSGSTAT=1:"All",MSGSTAT=2:"Accepted",MSGSTAT=3:"Rejected",1:"")_" Transmissions Report ",?65,"Page: ",PAGENUM
"RTN","DGHTRPT",104,0)
 W !!,"Report for ",$$FMTE^XLFDT(DGSD)," thru ",$$FMTE^XLFDT(DGED)
"RTN","DGHTRPT",105,0)
 W !!,?1,"Patient",?22,"SSN",?28,"HT Vendor",?50,"Care Coordinator",?68,"Consult #"
"RTN","DGHTRPT",106,0)
 W !?3,"Event/Trans Date",?28,"Message ID",?50,"ACK Date/Time",?69,"Status"
"RTN","DGHTRPT",107,0)
 W !?3,"Message Type",?28,"Reject Message",?50,"Retransmitted"
"RTN","DGHTRPT",108,0)
 W !?1,LN
"RTN","DGHTRPT",109,0)
 Q
"RTN","DGHTRPT",110,0)
 ;
"RTN","DGHTRPT",111,0)
DETAIL ;Print detailed line
"RTN","DGHTRPT",112,0)
 ;Input  :  ^TMP("DGHT",$J) full global reference
"RTN","DGHTRPT",113,0)
 ;          PATIENT   -   HTH Patient
"RTN","DGHTRPT",114,0)
 ;          SSN       -   Patient SSN's last four
"RTN","DGHTRPT",115,0)
 ;          VENDOR    -   HTH Vendor Server
"RTN","DGHTRPT",116,0)
 ;          COORD     -   Care Coordinator
"RTN","DGHTRPT",117,0)
 ;          CONSULT   -   CONSULT # file 123
"RTN","DGHTRPT",118,0)
 ;          DATE      -   Event/Transmission Date
"RTN","DGHTRPT",119,0)
 ;          MSGID     -   Message ID
"RTN","DGHTRPT",120,0)
 ;          ACK DATE  -   ACK Date and Time
"RTN","DGHTRPT",121,0)
 ;          STATUS    -   Registration Status
"RTN","DGHTRPT",122,0)
 ;          REJECT    -   Reject message
"RTN","DGHTRPT",123,0)
 ;          MSGTYPE   -   Message Type
"RTN","DGHTRPT",124,0)
 ;Output  : None
"RTN","DGHTRPT",125,0)
 ;Set acknowledgement status
"RTN","DGHTRPT",126,0)
 N RECORD,NODE,MSGID,ACKSTAT
"RTN","DGHTRPT",127,0)
 S (MSGID,ACKSTAT,NODE)="",RECORD=0
"RTN","DGHTRPT",128,0)
 F  S RECORD=$O(^TMP("DGHT",$J,RECORD)) Q:'RECORD  D  Q:STOP
"RTN","DGHTRPT",129,0)
 .S NODE=^TMP("DGHT",$J,RECORD)
"RTN","DGHTRPT",130,0)
 .S MSGID=$P(NODE,U,7),ACKSTAT=+$$MSGSTAT^HLUTIL(MSGID)
"RTN","DGHTRPT",131,0)
 .W !,?1,$E($P(NODE,U,1),1,20),?22,$P(NODE,U,2),?28,$E($P(NODE,U,3),1,20),?50,$E($P(NODE,U,4),1,16),?68,$P(NODE,U,5)
"RTN","DGHTRPT",132,0)
 .W !?3,$E($$FMTE^XLFDT($P(NODE,U,6),"1"),1,18),?28,$P(NODE,U,7),?47,$E($$FMTE^XLFDT($P(NODE,U,8),"1"),1,18),?69,$S($P(NODE,U,9)="A":"Accepted",$P(NODE,U,9)="R":"Rejected",ACKSTAT=1:"Pending TR",ACKSTAT=2:"Awaiting AA",1:"Unknown")
"RTN","DGHTRPT",133,0)
 .W !,?3,$S($P(NODE,U,11)="A":"Activation",$P(NODE,U,11)="I":"Inactivation",1:""),?28,$P(NODE,U,10)
"RTN","DGHTRPT",134,0)
 .;if there is data in the "HTHNOACK" node resolve number of retries
"RTN","DGHTRPT",135,0)
 .I $O(^DGHT(391.31,"HTHNOACK",$S(MSGID'="":MSGID,1:0),0)) D
"RTN","DGHTRPT",136,0)
 ..N RECORD,TRANS,RETRANS
"RTN","DGHTRPT",137,0)
 ..S (RECORD,TRANS,RETRANS)=0
"RTN","DGHTRPT",138,0)
 ..S RECORD=$O(^DGHT(391.31,"HTHNOACK",MSGID,0)),TRANS=$O(^DGHT(391.31,"HTHNOACK",MSGID,RECORD,0)),RETRANS=$P($G(^DGHT(391.31,"HTHNOACK",MSGID,RECORD,TRANS)),U,1)
"RTN","DGHTRPT",139,0)
 ..W ?50,RETRANS
"RTN","DGHTRPT",140,0)
 .W !
"RTN","DGHTRPT",141,0)
 .I $Y>(IOSL-5) D WAIT Q:STOP  D HEADER
"RTN","DGHTRPT",142,0)
 Q
"RTN","DGHTRPT",143,0)
 ;
"RTN","DGHTRPT",144,0)
TOTAL ;Report totals
"RTN","DGHTRPT",145,0)
 W !!?1,"Total Number of Home Telehealth Records: ",?23,CNT
"RTN","DGHTRPT",146,0)
 Q
"RTN","DGHTRPT",147,0)
 ;
"RTN","DGHTRPT",148,0)
WAIT ;End of page logic
"RTN","DGHTRPT",149,0)
 ;Input   ; None
"RTN","DGHTRPT",150,0)
 ;Output  ; STOP - Flag inidcating if printing should continue
"RTN","DGHTRPT",151,0)
 ;                 1 = Stop     0 = Continue
"RTN","DGHTRPT",152,0)
 ;
"RTN","DGHTRPT",153,0)
 N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","DGHTRPT",154,0)
 ;CRT - Prompt for continue
"RTN","DGHTRPT",155,0)
 I $E(IOST,1,2)="C-"&(IOSL'>24) D  Q
"RTN","DGHTRPT",156,0)
 .F  Q:$Y>(IOSL-3)  W !
"RTN","DGHTRPT",157,0)
 .S DIR(0)="E"
"RTN","DGHTRPT",158,0)
 .D ^DIR
"RTN","DGHTRPT",159,0)
 .S STOP=$S(Y'=1:1,1:0)
"RTN","DGHTRPT",160,0)
 ;Background task - check taskman
"RTN","DGHTRPT",161,0)
 S STOP=$$S^%ZTLOAD()
"RTN","DGHTRPT",162,0)
 I STOP D
"RTN","DGHTRPT",163,0)
 .W !,"*********************************************"
"RTN","DGHTRPT",164,0)
 .W !,"*  PRINTING OF REPORT STOPPED AS REQUESTED  *"
"RTN","DGHTRPT",165,0)
 .W !,"*********************************************"
"RTN","DGHTRPT",166,0)
 Q
"RTN","DGHTRPT",167,0)
EXIT ;Kill temp global
"RTN","DGHTRPT",168,0)
 K ^TMP("DGHT",$J)
"RTN","DGHTRPT",169,0)
 Q
"RTN","DGHTRPT1")
0^6^B28040554^n/a
"RTN","DGHTRPT1",1,0)
DGHTRPT1 ;ALB/JRC - Home Telehealth Transmissions Report ; 10/14/05 12:38pm
"RTN","DGHTRPT1",2,0)
 ;;5.3;Registration;**644**;Aug 13, 1993;Build 11
"RTN","DGHTRPT1",3,0)
 ;
"RTN","DGHTRPT1",4,0)
EN ;entry point from option
"RTN","DGHTRPT1",5,0)
 ;Declare variable(s) and arrays
"RTN","DGHTRPT1",6,0)
 N DGSD,DGED,I,ZTDESC,ZTIO,ZTSAVE,FLAG,SORT
"RTN","DGHTRPT1",7,0)
 S FLAG=0
"RTN","DGHTRPT1",8,0)
 ;Get beginning and ending dates
"RTN","DGHTRPT1",9,0)
 D GETDATES Q:FLAG
"RTN","DGHTRPT1",10,0)
 ;Get sort
"RTN","DGHTRPT1",11,0)
 D GETSORT Q:FLAG
"RTN","DGHTRPT1",12,0)
 ;Queue Report
"RTN","DGHTRPT1",13,0)
 S ZTIO=""
"RTN","DGHTRPT1",14,0)
 S ZTDESC="Home Telehealth Transmission Report"
"RTN","DGHTRPT1",15,0)
 F I="DGSD","DGED","SORT" D
"RTN","DGHTRPT1",16,0)
 .S ZTSAVE(I)=""
"RTN","DGHTRPT1",17,0)
 D EN^XUTMDEVQ("EN1^DGHTRPT1",ZTDESC,.ZTSAVE)
"RTN","DGHTRPT1",18,0)
 Q
"RTN","DGHTRPT1",19,0)
 ;
"RTN","DGHTRPT1",20,0)
EN1 ;Tasked entry point
"RTN","DGHTRPT1",21,0)
 ;Input : DGSD  -  FM format report start date
"RTN","DGHTRPT1",22,0)
 ;        DGED   -  FM format report end date
"RTN","DGHTRPT1",23,0)
 ;
"RTN","DGHTRPT1",24,0)
 ;Output : None
"RTN","DGHTRPT1",25,0)
 ;
"RTN","DGHTRPT1",26,0)
 ;Declare variables
"RTN","DGHTRPT1",27,0)
 N DGSD1,DGED1,CNT,ICNT,ACNT,LN,SCRNARR
"RTN","DGHTRPT1",28,0)
 N NODE,STOP,PAGENUM,FLAG
"RTN","DGHTRPT1",29,0)
 S DGED1=DGED+.9999,DGSD1=DGSD-.0001,(CNT,ACNT,ICNT,PAGENUM,STOP)=0
"RTN","DGHTRPT1",30,0)
 S SCRNARR="^TMP(""DGHT"",$J,""SCRNARR"")",FLAG=0
"RTN","DGHTRPT1",31,0)
 K @SCRNARR
"RTN","DGHTRPT1",32,0)
 D HEADER I STOP D EXIT Q
"RTN","DGHTRPT1",33,0)
 D GETDATA
"RTN","DGHTRPT1",34,0)
 I 'CNT D  Q
"RTN","DGHTRPT1",35,0)
 .W !
"RTN","DGHTRPT1",36,0)
 .W !,"***********************************************"
"RTN","DGHTRPT1",37,0)
 .W !,"*  NOTHING TO REPORT FOR SELECTED TIME FRAME  *"
"RTN","DGHTRPT1",38,0)
 .W !,"***********************************************"
"RTN","DGHTRPT1",39,0)
 .D WAIT
"RTN","DGHTRPT1",40,0)
 D DETAIL I STOP D EXIT Q
"RTN","DGHTRPT1",41,0)
 D TOTAL
"RTN","DGHTRPT1",42,0)
 D EXIT
"RTN","DGHTRPT1",43,0)
 Q
"RTN","DGHTRPT1",44,0)
 ;
"RTN","DGHTRPT1",45,0)
GETDATES ;Prompt for start date
"RTN","DGHTRPT1",46,0)
 N DIR,DIRUT,X,Y
"RTN","DGHTRPT1",47,0)
 S DIR(0)="D^:NOW:EX"
"RTN","DGHTRPT1",48,0)
 S DIR("A")="Enter Report Start Date"
"RTN","DGHTRPT1",49,0)
 S DIR("B")=$$FMTE^XLFDT($$NOW^XLFDT,"1D")
"RTN","DGHTRPT1",50,0)
 D ^DIR
"RTN","DGHTRPT1",51,0)
 I $D(DIRUT) S FLAG=1 Q
"RTN","DGHTRPT1",52,0)
 S DGSD=Y
"RTN","DGHTRPT1",53,0)
 ;Prompt for end date
"RTN","DGHTRPT1",54,0)
 K DIR,DIRUT,X,Y
"RTN","DGHTRPT1",55,0)
 S DIR(0)="D^:NOW:EX"
"RTN","DGHTRPT1",56,0)
 S DIR("A")="Enter Report Ending Date"
"RTN","DGHTRPT1",57,0)
 S DIR("B")=$$FMTE^XLFDT($$NOW^XLFDT,"1D")
"RTN","DGHTRPT1",58,0)
 D ^DIR
"RTN","DGHTRPT1",59,0)
 I $D(DIRUT) S FLAG=1 Q
"RTN","DGHTRPT1",60,0)
 S DGED=Y
"RTN","DGHTRPT1",61,0)
 Q
"RTN","DGHTRPT1",62,0)
 ;
"RTN","DGHTRPT1",63,0)
GETSORT ;Select sort, 1 for patient or 2 for trans date
"RTN","DGHTRPT1",64,0)
 ;Declare variables
"RTN","DGHTRPT1",65,0)
 N DIR,X,Y,DIRUT,DIROUT,DTOUT,DUOUT
"RTN","DGHTRPT1",66,0)
 ;Get sort
"RTN","DGHTRPT1",67,0)
 S DIR(0)="SC^1:Patient;2:Transmission Date;"
"RTN","DGHTRPT1",68,0)
 S DIR("A")="Select sorting criteria"
"RTN","DGHTRPT1",69,0)
 D ^DIR
"RTN","DGHTRPT1",70,0)
 I $D(DIRUT) S FLAG=1 Q
"RTN","DGHTRPT1",71,0)
 S SORT=Y
"RTN","DGHTRPT1",72,0)
 Q
"RTN","DGHTRPT1",73,0)
 ;
"RTN","DGHTRPT1",74,0)
GETDATA ;Get data
"RTN","DGHTRPT1",75,0)
 ;Declare variables
"RTN","DGHTRPT1",76,0)
 N DG0,DG1,DGDA0,DGDA1,PATIENT,VENDOR,INACTDT,DATE,MSGTYPE,STATUS
"RTN","DGHTRPT1",77,0)
 F  S DGSD1=$O(^DGHT(391.31,"C",DGSD1)) Q:(DGSD1>DGED1)!('DGSD1)  D
"RTN","DGHTRPT1",78,0)
 .S DGDA0=0
"RTN","DGHTRPT1",79,0)
 .F  S DGDA0=$O(^DGHT(391.31,"C",DGSD1,DGDA0)) Q:'DGDA0  D
"RTN","DGHTRPT1",80,0)
 ..S DGDA1=0
"RTN","DGHTRPT1",81,0)
 ..F  S DGDA1=$O(^DGHT(391.31,"C",DGSD1,DGDA0,DGDA1)) Q:'DGDA1  D
"RTN","DGHTRPT1",82,0)
 ...;Get data nodes and icrement conunter
"RTN","DGHTRPT1",83,0)
 ...S DG0=$G(^DGHT(391.31,DGDA0,0))
"RTN","DGHTRPT1",84,0)
 ...Q:DG0=""
"RTN","DGHTRPT1",85,0)
 ...S DG1=$G(^DGHT(391.31,DGDA0,"TRAN",DGDA1,0))
"RTN","DGHTRPT1",86,0)
 ...;Quit if there is no transaction data or type = inactivation
"RTN","DGHTRPT1",87,0)
 ...Q:DG1=""
"RTN","DGHTRPT1",88,0)
 ...Q:$P(DG1,U,4)="I"
"RTN","DGHTRPT1",89,0)
 ...S PATIENT=$P(DG0,U,2),VENDOR=$P(DG0,U,3),INACTDT=$P(DG0,U,7)
"RTN","DGHTRPT1",90,0)
 ...S DATE=$P(DG1,U,1),MSGTYPE=$P(DG1,U,4)
"RTN","DGHTRPT1",91,0)
 ...I 'INACTDT S STATUS="Active"
"RTN","DGHTRPT1",92,0)
 ...;If there is an Inactivation date validate trans status
"RTN","DGHTRPT1",93,0)
 ...I INACTDT D
"RTN","DGHTRPT1",94,0)
 ....S DGDA1=$O(^DGHT(391.31,DGDA0,"TRAN",DGDA1))
"RTN","DGHTRPT1",95,0)
 ....S DG1=$G(^DGHT(391.31,DGDA0,"TRAN",DGDA1,0))
"RTN","DGHTRPT1",96,0)
 ....S STATUS=$S($P(DG1,U,7)="A":"Inactive",$P(DG1,U,7)="R":"Active",1:"Active")
"RTN","DGHTRPT1",97,0)
 ...;Resolve external values for PATIENT
"RTN","DGHTRPT1",98,0)
 ...S PATIENT=$$GET1^DIQ(2,PATIENT,.01,"E")
"RTN","DGHTRPT1",99,0)
 ...;Resolve external value for VENDOR
"RTN","DGHTRPT1",100,0)
 ...S VENDOR=$$GET1^DIQ(4,VENDOR,.01,"E")
"RTN","DGHTRPT1",101,0)
 ...;Resolve external value for COORD
"RTN","DGHTRPT1",102,0)
 ...;Increment counters and save for later
"RTN","DGHTRPT1",103,0)
 ...S CNT=CNT+1
"RTN","DGHTRPT1",104,0)
 ...I STATUS="Active" S ACNT=ACNT+1
"RTN","DGHTRPT1",105,0)
 ...I STATUS="Inactive" S ICNT=ICNT+1
"RTN","DGHTRPT1",106,0)
 ...S ^TMP("DGHT",$J,$S(SORT=1:PATIENT,1:DATE),CNT)=PATIENT_U_STATUS_U_DATE_U_VENDOR
"RTN","DGHTRPT1",107,0)
 Q
"RTN","DGHTRPT1",108,0)
HEADER ;print header
"RTN","DGHTRPT1",109,0)
 S PAGENUM=PAGENUM+1
"RTN","DGHTRPT1",110,0)
 S $P(LN,"-",80)=""
"RTN","DGHTRPT1",111,0)
 W @IOF
"RTN","DGHTRPT1",112,0)
 W !,"Home Telehealth Patient Summary Report ",?65,"Page: ",PAGENUM
"RTN","DGHTRPT1",113,0)
 W !!,"Report for ",$$FMTE^XLFDT(DGSD)," thru ",$$FMTE^XLFDT(DGED)
"RTN","DGHTRPT1",114,0)
 W !!,?1,"Patient",?25,"Status",?34,"Date of Last Change",?56,"HT Vendor"
"RTN","DGHTRPT1",115,0)
 W !?1,LN
"RTN","DGHTRPT1",116,0)
 Q
"RTN","DGHTRPT1",117,0)
 ;
"RTN","DGHTRPT1",118,0)
DETAIL ;Print detailed line
"RTN","DGHTRPT1",119,0)
 ;Input  :  ^TMP("DGHT",$J) full global reference
"RTN","DGHTRPT1",120,0)
 ;          PATIENT   -   HTH Patient
"RTN","DGHTRPT1",121,0)
 ;          STATUS    -   Registration Status
"RTN","DGHTRPT1",122,0)
 ;          DATE      -   Event/Transmission Date
"RTN","DGHTRPT1",123,0)
 ;          VENDOR    -   HTH Vendor Server
"RTN","DGHTRPT1",124,0)
 ;Output  : None
"RTN","DGHTRPT1",125,0)
 ;Declare variables
"RTN","DGHTRPT1",126,0)
 N SORT,RECORD
"RTN","DGHTRPT1",127,0)
 S SORT=""
"RTN","DGHTRPT1",128,0)
 F  S SORT=$O(^TMP("DGHT",$J,SORT)) Q:SORT=""  D  Q:STOP
"RTN","DGHTRPT1",129,0)
 .S RECORD=0 F  S RECORD=$O(^TMP("DGHT",$J,SORT,RECORD)) Q:'RECORD!(STOP)  D  Q:STOP
"RTN","DGHTRPT1",130,0)
 ..S NODE=^TMP("DGHT",$J,SORT,RECORD)
"RTN","DGHTRPT1",131,0)
 ..W !,?1,$E($P(NODE,U,1),1,22),?25,$P(NODE,U,2),?34,$$FMTE^XLFDT($P(NODE,U,3),"2Z"),?56,$E($P(NODE,U,4),1,23)
"RTN","DGHTRPT1",132,0)
 ..I $Y>(IOSL-5) D WAIT Q:STOP  D HEADER
"RTN","DGHTRPT1",133,0)
 Q
"RTN","DGHTRPT1",134,0)
 ;
"RTN","DGHTRPT1",135,0)
TOTAL ;Report totals
"RTN","DGHTRPT1",136,0)
 W !!?1,"Total Number of Active Patient Record(s): ",?45,$J($FNUMBER(ACNT,",",0),8)
"RTN","DGHTRPT1",137,0)
 W !?1,"Total Number of Inactive Patient Record(s): ",?45,$J($FNUMBER(ICNT,",",0),8)
"RTN","DGHTRPT1",138,0)
 W !?1,"Total Number of Patient Record(s): ",?45,$J($FNUMBER(CNT,",",0),8)
"RTN","DGHTRPT1",139,0)
 Q
"RTN","DGHTRPT1",140,0)
 ;
"RTN","DGHTRPT1",141,0)
WAIT ;End of page logic
"RTN","DGHTRPT1",142,0)
 ;Input   ; None
"RTN","DGHTRPT1",143,0)
 ;Output  ; STOP - Flag inidcating if printing should continue
"RTN","DGHTRPT1",144,0)
 ;                 1 = Stop     0 = Continue
"RTN","DGHTRPT1",145,0)
 ;
"RTN","DGHTRPT1",146,0)
 S STOP=0
"RTN","DGHTRPT1",147,0)
 ;CRT - Prompt for continue
"RTN","DGHTRPT1",148,0)
 I $E(IOST,1,2)="C-"&(IOSL'>24) D  Q
"RTN","DGHTRPT1",149,0)
 .F  Q:$Y>(IOSL-3)  W !
"RTN","DGHTRPT1",150,0)
 .N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","DGHTRPT1",151,0)
 .S DIR(0)="E"
"RTN","DGHTRPT1",152,0)
 .D ^DIR
"RTN","DGHTRPT1",153,0)
 .S STOP=$S(Y'=1:1,1:0)
"RTN","DGHTRPT1",154,0)
 ;Background task - check taskman
"RTN","DGHTRPT1",155,0)
 S STOP=$$S^%ZTLOAD()
"RTN","DGHTRPT1",156,0)
 I STOP D
"RTN","DGHTRPT1",157,0)
 .W !,"*********************************************"
"RTN","DGHTRPT1",158,0)
 .W !,"*  PRINTING OF REPORT STOPPED AS REQUESTED  *"
"RTN","DGHTRPT1",159,0)
 .W !,"*********************************************"
"RTN","DGHTRPT1",160,0)
 Q
"RTN","DGHTRPT1",161,0)
EXIT ;Kill temp global
"RTN","DGHTRPT1",162,0)
 K ^TMP("DGHT",$J)
"RTN","DGHTRPT1",163,0)
 Q
"RTN","DGHTRTX")
0^11^B14862223^n/a
"RTN","DGHTRTX",1,0)
DGHTRTX ;ALB/JRC - Home Telehealth HL7 Message Monitoring Routine ;10 January 2005 ; 9/14/06 12:52pm
"RTN","DGHTRTX",2,0)
 ;;5.3;Registration;**644**;Aug 13, 1993;Build 11
"RTN","DGHTRTX",3,0)
 ;
"RTN","DGHTRTX",4,0)
 ;This routine when tasked will run at predetermined time intervals
"RTN","DGHTRTX",5,0)
 ;and check to see if there are any HTH HL7 messages that have not
"RTN","DGHTRTX",6,0)
 ;received an application acknowledgment. If it finds messages that
"RTN","DGHTRTX",7,0)
 ;have not received AAs, it will retransmit the HL7 messages up to the
"RTN","DGHTRTX",8,0)
 ;number of times defined in the "DG HTH # OF RETRANSMITS" parameter.
"RTN","DGHTRTX",9,0)
 ;If no AA is received after the 5th try an alert is sent to the
"RTN","DGHTRTX",10,0)
 ;DGHTERR mailgroup. After the 5th try an extended wait time is used
"RTN","DGHTRTX",11,0)
 ;(12 hours) and the process starts a new.
"RTN","DGHTRTX",12,0)
 ;
"RTN","DGHTRTX",13,0)
EN ;entry point from tasked option, $O thru home telehealth file
"RTN","DGHTRTX",14,0)
 ;(#391.31) "HTHNOACK" xref and find mnessages to retransmit
"RTN","DGHTRTX",15,0)
 N MSGID,NODE,STATUS,RECORD,TRANS,TYPE,ERROR,RETRANS,DTIME,XTIME
"RTN","DGHTRTX",16,0)
 N DGCOUNT,DGDATE,CNT
"RTN","DGHTRTX",17,0)
 S (MSGID,NODE,TRANS,ERROR)="",TYPE=1,CNT=0
"RTN","DGHTRTX",18,0)
 K ^TMP($J,"DGHT")
"RTN","DGHTRTX",19,0)
 ;Get number of allowed retransmissions from parameter file
"RTN","DGHTRTX",20,0)
 S RETRANS=$$GET^XPAR("SYS","DG HTH # OF RETRANSMITS")
"RTN","DGHTRTX",21,0)
 ;Get time interval parameters, convert them to seconds
"RTN","DGHTRTX",22,0)
 S DTIME=$$GET^XPAR("SYS","DG HTH DEFAULT WAIT TIME")*60
"RTN","DGHTRTX",23,0)
 S XTIME=$$GET^XPAR("SYS","DG HTH EXTENDED WAIT TIME")*60
"RTN","DGHTRTX",24,0)
 ;Resolve record to update using MSGID cross reference
"RTN","DGHTRTX",25,0)
 F  S MSGID=$O(^DGHT(391.31,"HTHNOACK",MSGID)) Q:MSGID=""  D
"RTN","DGHTRTX",26,0)
 .S RECORD=$O(^DGHT(391.31,"D",MSGID,0)) Q:'RECORD
"RTN","DGHTRTX",27,0)
 .S TRANS=$O(^DGHT(391.31,"D",MSGID,RECORD,0)) Q:'TRANS
"RTN","DGHTRTX",28,0)
 .S NODE=$G(^DGHT(391.31,"HTHNOACK",MSGID,RECORD,TRANS))
"RTN","DGHTRTX",29,0)
 .Q:NODE=""
"RTN","DGHTRTX",30,0)
 .S DGCOUNT=$P(NODE,U,1),DGDATE=$P(NODE,U,2)
"RTN","DGHTRTX",31,0)
 .;Check outgoing message status
"RTN","DGHTRTX",32,0)
 .;               0 = message doesn't exist
"RTN","DGHTRTX",33,0)
 .;               1 = waiting in queue
"RTN","DGHTRTX",34,0)
 .;             1.5 = opening connection
"RTN","DGHTRTX",35,0)
 .;             1.7 = awaiting response, # of retries
"RTN","DGHTRTX",36,0)
 .;               2 = awaiting application ack
"RTN","DGHTRTX",37,0)
 .;               3 = successfully completed
"RTN","DGHTRTX",38,0)
 .;               4 = error
"RTN","DGHTRTX",39,0)
 .;               8 = being generated
"RTN","DGHTRTX",40,0)
 .;               9 = awaiting processing
"RTN","DGHTRTX",41,0)
 .S STATUS=+$$MSGSTAT^HLUTIL(MSGID)
"RTN","DGHTRTX",42,0)
 .;If status=3 kill xref and quit
"RTN","DGHTRTX",43,0)
 .I STATUS=3 D KILLXREF^DGHTXREF(MSGID) Q
"RTN","DGHTRTX",44,0)
 .D CHKMSG
"RTN","DGHTRTX",45,0)
 I $O(^TMP($J,"DGHT",0)) D MESSAGE K ^TMP($J)
"RTN","DGHTRTX",46,0)
 Q
"RTN","DGHTRTX",47,0)
 ;
"RTN","DGHTRTX",48,0)
RTX ;Retransmit message
"RTN","DGHTRTX",49,0)
 N X,DGDATE
"RTN","DGHTRTX",50,0)
 S X=$$MSGACT^HLUTIL(MSGID,2)
"RTN","DGHTRTX",51,0)
 ;Update counter and trans date
"RTN","DGHTRTX",52,0)
 S DGDATE=$$NOW^XLFDT()
"RTN","DGHTRTX",53,0)
 D SETXREF^DGHTXREF(MSGID,1,1)
"RTN","DGHTRTX",54,0)
 Q
"RTN","DGHTRTX",55,0)
 ;
"RTN","DGHTRTX",56,0)
MESSAGE ;Build bulletin and send to mail group
"RTN","DGHTRTX",57,0)
 ;      Input: Home telehealth patient record
"RTN","DGHTRTX",58,0)
 ;      Output:
"RTN","DGHTRTX",59,0)
 ;
"RTN","DGHTRTX",60,0)
 N MSGTEXT,XMTEXT,XMSUB,XMY,XMCHAN,XMZ,XMDUZ,MSGTYPE,NODE0,NODE1
"RTN","DGHTRTX",61,0)
 N RECORD,TNODE
"RTN","DGHTRTX",62,0)
 ;Get records from ^tmp global
"RTN","DGHTRTX",63,0)
 S (RECORD,CNT)=0 F  S RECORD=$O(^TMP($J,"DGHT",RECORD)) Q:'RECORD  D
"RTN","DGHTRTX",64,0)
 .S TRANS=0 F  S TRANS=$O(^TMP($J,"DGHT",RECORD,TRANS)) Q:'TRANS  D
"RTN","DGHTRTX",65,0)
 ..S TNODE=^TMP($J,"DGHT",RECORD,TRANS)
"RTN","DGHTRTX",66,0)
 ..S MSGID=$P(TNODE,U,2),ERROR=$P(TNODE,U,2)
"RTN","DGHTRTX",67,0)
 ..;Get 0th node and trans nodes
"RTN","DGHTRTX",68,0)
 ..S NODE0=$G(^DGHT(391.31,RECORD,0))
"RTN","DGHTRTX",69,0)
 ..S NODE1=$G(^DGHT(391.31,RECORD,"TRAN",TRANS,0)),MSGTYPE=$P(NODE1,U,4)
"RTN","DGHTRTX",70,0)
 ..S MSGTYPE=$S(MSGTYPE="A":"Sign-up/Activation",MSGTYPE="I":"Inactivation",1:""),CNT=CNT+1
"RTN","DGHTRTX",71,0)
 ..S MSGTEXT(CNT)="Home Telehealth "_MSGTYPE_" was REJECTED",CNT=CNT+1
"RTN","DGHTRTX",72,0)
 ..S MSGTEXT(CNT)=" ",CNT=CNT+1
"RTN","DGHTRTX",73,0)
 ..S MSGTEXT(CNT)="Date:       "_$$FMTE^XLFDT($$NOW^XLFDT(),1),CNT=CNT+1
"RTN","DGHTRTX",74,0)
 ..S MSGTEXT(CNT)="Patient:    "_$$GET1^DIQ(2,$P(NODE0,U,2),.01,"E")
"RTN","DGHTRTX",75,0)
 ..S CNT=CNT+1,MSGTEXT(CNT+1)="Message ID: "_MSGID,CNT=CNT+1
"RTN","DGHTRTX",76,0)
 ..S MSGTEXT(CNT)="Error Code: "_ERROR,CNT=CNT+1
"RTN","DGHTRTX",77,0)
 ..S MSGTEXT(CNT)="",CNT=CNT+1
"RTN","DGHTRTX",78,0)
 ;Send message to mail group
"RTN","DGHTRTX",79,0)
 S XMSUB="Home Telehealth Patient "_MSGTYPE_" Reject"
"RTN","DGHTRTX",80,0)
 S XMTEXT="MSGTEXT("
"RTN","DGHTRTX",81,0)
 S XMY("G.DGHTERR")=""
"RTN","DGHTRTX",82,0)
 S XMCHAN=1
"RTN","DGHTRTX",83,0)
 S XMDUZ="Home Telehealth Patient "_MSGTYPE
"RTN","DGHTRTX",84,0)
 D ^XMD
"RTN","DGHTRTX",85,0)
 Q
"RTN","DGHTRTX",86,0)
 ;
"RTN","DGHTRTX",87,0)
CHKMSG ;Check message for retransmission
"RTN","DGHTRTX",88,0)
 N DIFF
"RTN","DGHTRTX",89,0)
 S DIFF=$$FMDIFF^XLFDT($$NOW^XLFDT(),DGDATE,2)
"RTN","DGHTRTX",90,0)
 I DGCOUNT<RETRANS D  Q
"RTN","DGHTRTX",91,0)
 .I DIFF>DTIME D RTX I (DGCOUNT+1)=RETRANS D  Q
"RTN","DGHTRTX",92,0)
 ..S ERROR=$S('STATUS:"HL7 MESSAGE DOES NOT EXIST. REQUIRES MANUAL RETRANSMISSION",1:"DEFAULT MAXIMUM RETRANSMISSIONS REACHED")
"RTN","DGHTRTX",93,0)
 ..S ^TMP($J,"DGHT",RECORD,TRANS)=MSGID_U_ERROR
"RTN","DGHTRTX",94,0)
 I DIFF>XTIME S DGCOUNT=0 D RTX Q
"RTN","DGHTRTX",95,0)
 Q
"RTN","DGHTXREF")
0^10^B2276969^n/a
"RTN","DGHTXREF",1,0)
DGHTXREF ;ALB/JRC - Home Telehealth HL7 Message Monitoring Routine ;10 January 2005 ; 9/12/06 2:02pm
"RTN","DGHTXREF",2,0)
 ;;5.3;Registration;**644**;Aug 13, 1993;Build 11
"RTN","DGHTXREF",3,0)
 ;
"RTN","DGHTXREF",4,0)
 ;This routine is called to set or remove cross references on
"RTN","DGHTXREF",5,0)
 ;file Home Telehealth Patient file (#391.31)
"RTN","DGHTXREF",6,0)
 ;
"RTN","DGHTXREF",7,0)
SETXREF(MSGID,SET,TYPE) ;Logic for "HTHNOACK" cross references of
"RTN","DGHTXREF",8,0)
 ; HOME TELEHEALTH PATIENT file (#391.31)
"RTN","DGHTXREF",9,0)
 ;
"RTN","DGHTXREF",10,0)
 ;Input  : MSGID - HL7 Message ID
"RTN","DGHTXREF",11,0)
 ;         SET - If 1, set cross reference
"RTN","DGHTXREF",12,0)
 ;               If 0, kill cross reference
"RTN","DGHTXREF",13,0)
 ;         TYPE - If 1, set triggered by tasked job
"RTN","DGHTXREF",14,0)
 ;                If 0, set triggered by manual process
"RTN","DGHTXREF",15,0)
 ;                      demands special processing
"RTN","DGHTXREF",16,0)
 ;         OLDMSGID - If there is an old message id
"RTN","DGHTXREF",17,0)
 ;                    xref needs to be removed.
"RTN","DGHTXREF",18,0)
 ;
"RTN","DGHTXREF",19,0)
 ;Output : None
"RTN","DGHTXREF",20,0)
 ;
"RTN","DGHTXREF",21,0)
 ;Check input
"RTN","DGHTXREF",22,0)
 Q:'$G(MSGID)!'$G(SET)
"RTN","DGHTXREF",23,0)
 ;Check hl7 message, if status=3 make sure no xref exist and quit
"RTN","DGHTXREF",24,0)
 I +$$MSGSTAT^HLUTIL(MSGID)=3 D KILLXREF(MSGID) Q
"RTN","DGHTXREF",25,0)
 ;Declare variables
"RTN","DGHTXREF",26,0)
 N RECORD,TRANS,NODE0,TNODE,EVNTDATE,ACKCODE,CNT
"RTN","DGHTXREF",27,0)
 ;Set date and count if exist
"RTN","DGHTXREF",28,0)
 S EVNTDATE=$G(DGDATE),CNT=$S($G(DGCOUNT)'="":DGCOUNT+1,1:0)
"RTN","DGHTXREF",29,0)
 ;Get ien and sien of hth patient record and set nodes
"RTN","DGHTXREF",30,0)
 S RECORD=$O(^DGHT(391.31,"D",MSGID,0)) Q:'RECORD
"RTN","DGHTXREF",31,0)
 S TRANS=$O(^DGHT(391.31,"D",MSGID,RECORD,0)) Q:'TRANS
"RTN","DGHTXREF",32,0)
 S NODE0=$G(^DGHT(391.31,RECORD,0)),TNODE=$G(^("TRAN",TRANS,0))
"RTN","DGHTXREF",33,0)
 ;Check HTH file (#391.31) for  AA, if so kill xref and quit
"RTN","DGHTXREF",34,0)
 I ($P(TNODE,U,6)'="")!($P(TNODE,U,7)'="") D KILLXREF(MSGID) Q
"RTN","DGHTXREF",35,0)
 ;Get event date/time
"RTN","DGHTXREF",36,0)
 S EVNTDATE=$S(TYPE=1:DGDATE,TYPE=0:$P(TNODE,U,1),1:"")
"RTN","DGHTXREF",37,0)
 ;No event date/time - don't set x-ref
"RTN","DGHTXREF",38,0)
 Q:('EVNTDATE)
"RTN","DGHTXREF",39,0)
 ;Kill old xref if exist, then set the new xref
"RTN","DGHTXREF",40,0)
 D KILLXREF(MSGID)
"RTN","DGHTXREF",41,0)
 S ^DGHT(391.31,"HTHNOACK",MSGID,RECORD,TRANS)=CNT_U_EVNTDATE
"RTN","DGHTXREF",42,0)
 Q
"RTN","DGHTXREF",43,0)
 ;
"RTN","DGHTXREF",44,0)
KILLXREF(MSGID) ;Kill x-ref
"RTN","DGHTXREF",45,0)
 K ^DGHT(391.31,"HTHNOACK",MSGID)
"RTN","DGHTXREF",46,0)
 Q
"SEC","^DD",391.31,391.31,1,8.5)

"SEC","^DIC",391.31,391.31,0,"AUDIT")
@
"SEC","^DIC",391.31,391.31,0,"DD")
@
"SEC","^DIC",391.31,391.31,0,"DEL")
@
"SEC","^DIC",391.31,391.31,0,"LAYGO")
@
"SEC","^DIC",391.31,391.31,0,"RD")
@
"SEC","^DIC",391.31,391.31,0,"WR")
@
"VER")
8.0^22.0
"^DD",391.31,391.31,0)
FIELD^^7^8
"^DD",391.31,391.31,0,"DDA")
N
"^DD",391.31,391.31,0,"DT")
3050214
"^DD",391.31,391.31,0,"IX","B",391.31,.01)

"^DD",391.31,391.31,0,"IX","C",391.317,.01)

"^DD",391.31,391.31,0,"IX","D",391.317,.02)

"^DD",391.31,391.31,0,"IX","E",391.31,1)

"^DD",391.31,391.31,0,"IX","HTHNOACK",391.317,.02)

"^DD",391.31,391.31,0,"NM","HOME TELEHEALTH PATIENT")

"^DD",391.31,391.31,.01,0)
RECORD NUMBER^RNJ7,0X^^0;1^K:+X'=X!(X>9999999)!(X<0)!(X?.E1"."1N.N) X S:$D(X) DINUM=X
"^DD",391.31,391.31,.01,1,0)
^.1
"^DD",391.31,391.31,.01,1,1,0)
391.31^B
"^DD",391.31,391.31,.01,1,1,1)
S ^DGHT(391.31,"B",$E(X,1,30),DA)=""
"^DD",391.31,391.31,.01,1,1,2)
K ^DGHT(391.31,"B",$E(X,1,30),DA)
"^DD",391.31,391.31,.01,3)
Type a Number between 0 and 9999999, 0 Decimal Digits
"^DD",391.31,391.31,.01,21,0)
^.001^1^1^3050420^^^
"^DD",391.31,391.31,.01,21,1,0)
This field contains the record number for this entry.
"^DD",391.31,391.31,.01,23,0)
^.001^1^1^3050420^^^
"^DD",391.31,391.31,.01,23,1,0)
The internal entry number (IEN) for this record.
"^DD",391.31,391.31,.01,"DEL",.01,0)
I 1 D EN^DDIOL("Home Telehealth entries cannot be deleted")
"^DD",391.31,391.31,.01,"DT")
3050214
"^DD",391.31,391.31,1,0)
PATIENT^RP2'^DPT(^0;2^Q
"^DD",391.31,391.31,1,1,0)
^.1
"^DD",391.31,391.31,1,1,1,0)
391.31^E
"^DD",391.31,391.31,1,1,1,1)
S ^DGHT(391.31,"E",$E(X,1,30),DA)=""
"^DD",391.31,391.31,1,1,1,2)
K ^DGHT(391.31,"E",$E(X,1,30),DA)
"^DD",391.31,391.31,1,1,1,"DT")
3060823
"^DD",391.31,391.31,1,3)
Enter the name of the patient being assigned for Home Telehealth.
"^DD",391.31,391.31,1,21,0)
^.001^1^1^3050420^^^^
"^DD",391.31,391.31,1,21,1,0)
This is the name of patient assigned for Home Telehealth service.
"^DD",391.31,391.31,1,23,0)
^.001^1^1^3050420^^^^
"^DD",391.31,391.31,1,23,1,0)
A pointer to the PATIENT file (#2).
"^DD",391.31,391.31,1,"DT")
3060823
"^DD",391.31,391.31,2,0)
VENDOR^R*P4'^DIC(4,^0;3^S DIC("S")="I $P($G(^DIC(4,+Y,99)),""^"")?1""200T"".E" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",391.31,391.31,2,3)
Enter the vendor assigned to this Home Telehealth patient.
"^DD",391.31,391.31,2,12)
Only 200T entries are valid.
"^DD",391.31,391.31,2,12.1)
S DIC("S")="I $P($G(^DIC(4,+Y,99)),""^"")?1""200T"".E"
"^DD",391.31,391.31,2,21,0)
^.001^3^3^3050216^^^^
"^DD",391.31,391.31,2,21,1,0)
This is the name of the vendor assigned to this Home Telehealth patient.
"^DD",391.31,391.31,2,21,2,0)
The vendor data comes from the Institution file #4 and are the 200T* entries.  
"^DD",391.31,391.31,2,21,3,0)
These entries are specifically added to file #4 for Home Telehealth vendors.
"^DD",391.31,391.31,2,23,0)
^.001^1^1^3050216^^^^
"^DD",391.31,391.31,2,23,1,0)
A pointer to the INSTITUTION file (#4).
"^DD",391.31,391.31,2,"DT")
3050214
"^DD",391.31,391.31,3,0)
CONSULT NUMBER^RP123'^GMR(123,^0;4^Q
"^DD",391.31,391.31,3,3)
Enter IEN of the consult from REQUEST/CONSULTATION file (#123).
"^DD",391.31,391.31,3,21,0)
^.001^1^1^3050214^^^
"^DD",391.31,391.31,3,21,1,0)
This is the internal entry number of the consultation.
"^DD",391.31,391.31,3,23,0)
^.001^1^1^3050214^^
"^DD",391.31,391.31,3,23,1,0)
A pointer to the REQUEST/CONSULTATION file (#123).
"^DD",391.31,391.31,3,"DT")
3050119
"^DD",391.31,391.31,4,0)
CARE COORDINATOR^RP200'^VA(200,^0;5^Q
"^DD",391.31,391.31,4,3)
Enter the name of the Care Coordinator responsible for patient.
"^DD",391.31,391.31,4,21,0)
^.001^3^3^3050214^^^^
"^DD",391.31,391.31,4,21,1,0)
This is the name of the Care Coordinator responsible for assigning 
"^DD",391.31,391.31,4,21,2,0)
this patient for Home Telehealth service.  Care Coordinator is 
"^DD",391.31,391.31,4,21,3,0)
selected from entries in the NEW PERSON file (#200).
"^DD",391.31,391.31,4,23,0)
^.001^1^1^3050214^^^
"^DD",391.31,391.31,4,23,1,0)
A pointer to the NEW PERSON file (#200).
"^DD",391.31,391.31,4,"DT")
3050119
"^DD",391.31,391.31,5,0)
ACTIVATION DATE^RD^^0;6^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",391.31,391.31,5,3)
The date/time the patient was activated for Home Telehealth service.
"^DD",391.31,391.31,5,21,0)
^.001^2^2^3050214^^^^
"^DD",391.31,391.31,5,21,1,0)
The date and time the patient was assigned/registered/sign-up for Home 
"^DD",391.31,391.31,5,21,2,0)
Telehealth services.
"^DD",391.31,391.31,5,"DT")
3050207
"^DD",391.31,391.31,6,0)
INACTIVATION DATE^D^^0;7^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",391.31,391.31,6,1,0)
^.1^^0
"^DD",391.31,391.31,6,3)
The date/time the patient was inactivated from Home Telehealth service.
"^DD",391.31,391.31,6,21,0)
^.001^1^1^3050214^^^^
"^DD",391.31,391.31,6,21,1,0)
The date and time this patient was inactivated  from Home Telehealth service.
"^DD",391.31,391.31,6,"DT")
3050207
"^DD",391.31,391.31,7,0)
TRANSACTION^391.317DA^^TRAN;0
"^DD",391.31,391.31,7,21,0)
^.001^2^2^3050214^^^^
"^DD",391.31,391.31,7,21,1,0)
Transaction relating to home telehealth patient sign-up/activation (admission)
"^DD",391.31,391.31,7,21,2,0)
and inactivation (discharge).
"^DD",391.31,391.317,0)
TRANSACTION SUB-FIELD^^.08^8
"^DD",391.31,391.317,0,"DT")
3050214
"^DD",391.31,391.317,0,"IX","B",391.317,.01)

"^DD",391.31,391.317,0,"NM","TRANSACTION")

"^DD",391.31,391.317,0,"UP")
391.31
"^DD",391.31,391.317,.01,0)
TRANSACTION DATE^RD^^0;1^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",391.31,391.317,.01,1,0)
^.1^^-1
"^DD",391.31,391.317,.01,1,1,0)
391.317^B
"^DD",391.31,391.317,.01,1,1,1)
S ^DGHT(391.31,DA(1),"TRAN","B",$E(X,1,30),DA)=""
"^DD",391.31,391.317,.01,1,1,2)
K ^DGHT(391.31,DA(1),"TRAN","B",$E(X,1,30),DA)
"^DD",391.31,391.317,.01,1,2,0)
391.31^C
"^DD",391.31,391.317,.01,1,2,1)
S ^DGHT(391.31,"C",$E(X,1,30),DA(1),DA)=""
"^DD",391.31,391.317,.01,1,2,2)
K ^DGHT(391.31,"C",$E(X,1,30),DA(1),DA)
"^DD",391.31,391.317,.01,1,2,"DT")
3050207
"^DD",391.31,391.317,.01,3)
Date/time event was last transmitted.
"^DD",391.31,391.317,.01,21,0)
^.001^2^2^3050214^^^
"^DD",391.31,391.317,.01,21,1,0)
Date and time transaction was transmitted.  The date/time is reflective of 
"^DD",391.31,391.317,.01,21,2,0)
the last time this event was transmitted.
"^DD",391.31,391.317,.01,"DT")
3051209
"^DD",391.31,391.317,.02,0)
MESSAGE ID OF XMIT TO HT^F^^0;2^K:$L(X)>20!($L(X)<1) X
"^DD",391.31,391.317,.02,1,0)
^.1^^-1
"^DD",391.31,391.317,.02,1,1,0)
391.31^D
"^DD",391.31,391.317,.02,1,1,1)
S ^DGHT(391.31,"D",$E(X,1,30),DA(1),DA)=""
"^DD",391.31,391.317,.02,1,1,2)
K ^DGHT(391.31,"D",$E(X,1,30),DA(1),DA)
"^DD",391.31,391.317,.02,1,1,"DT")
3050210
"^DD",391.31,391.317,.02,1,2,0)
391.31^HTHNOACK^MUMPS
"^DD",391.31,391.317,.02,1,2,1)
D SETXREF^DGHTXREF($E(X,1,30),1,0)
"^DD",391.31,391.317,.02,1,2,2)
K ^DGHT(391.31,"HTHNOACK",$E(X,1,30),DA(1),DA)
"^DD",391.31,391.317,.02,1,2,"%D",0)
^.101^6^6^3060125^^^^
"^DD",391.31,391.317,.02,1,2,"%D",1,0)
This xref is set when an activation/inactivation occur for home telehealth
"^DD",391.31,391.317,.02,1,2,"%D",2,0)
patients and an hl7 message is succesfully generated. The xref will
"^DD",391.31,391.317,.02,1,2,"%D",3,0)
remain until an application acknowledgment is received for the sent 
"^DD",391.31,391.317,.02,1,2,"%D",4,0)
hl7 message from the receiving vendor server. If no AA is received 
"^DD",391.31,391.317,.02,1,2,"%D",5,0)
attempts will be made to retransmit the messages a predetermined number 
"^DD",391.31,391.317,.02,1,2,"%D",6,0)
of times at predetermined time intervals.
"^DD",391.31,391.317,.02,1,2,"DT")
3060125
"^DD",391.31,391.317,.02,3)
Enter message ID of transmission to HT.
"^DD",391.31,391.317,.02,21,0)
^.001^1^1^3050214^^
"^DD",391.31,391.317,.02,21,1,0)
Message ID of last transmission to Home Telehealth Vendor server.
"^DD",391.31,391.317,.02,"DT")
3060125
"^DD",391.31,391.317,.03,0)
USER CREATING TRANSACTION^P200'^VA(200,^0;3^Q
"^DD",391.31,391.317,.03,3)
The user entering this transaction for Home Telehealth service.
"^DD",391.31,391.317,.03,21,0)
^.001^1^1^3050214^^^
"^DD",391.31,391.317,.03,21,1,0)
The user creating this transaction. This information is obtained from the DUZ.
"^DD",391.31,391.317,.03,23,0)
^^1^1^3050214^
"^DD",391.31,391.317,.03,23,1,0)
Pointer to NEW PERSON file #200.
"^DD",391.31,391.317,.03,"DT")
3050207
"^DD",391.31,391.317,.04,0)
MESSAGE TYPE^RS^A:ACTIVATION/SIGN UP;I:INACTIVATION;^0;4^Q
"^DD",391.31,391.317,.04,3)
Enter type of message being transmitted.
"^DD",391.31,391.317,.04,21,0)
^.001^3^3^3050214^^^^
"^DD",391.31,391.317,.04,21,1,0)
This is the type of message being transmitted for the Home Telehealth patient.
"^DD",391.31,391.317,.04,21,2,0)
    A   Patient Activation/Sign-up. This is a 'A04' (register) HL7 type message.
"^DD",391.31,391.317,.04,21,3,0)
    I   Patient Inactivation.  This is an 'A03' (discharge) HL7 type message.
"^DD",391.31,391.317,.04,"DT")
3050207
"^DD",391.31,391.317,.05,0)
TRANSMISSION EVENT^RS^0:RETRANSMIT;1:ADD;^0;5^Q
"^DD",391.31,391.317,.05,3)
Enter the action taken for the transmission.
"^DD",391.31,391.317,.05,21,0)
^.001^3^3^3050214^^
"^DD",391.31,391.317,.05,21,1,0)
Actions taken for the transmission are as follows:-
"^DD",391.31,391.317,.05,21,2,0)
  ADD         Encounter 1st added.  
"^DD",391.31,391.317,.05,21,3,0)
  RETRANSMIT  Encounter retransmitted.
"^DD",391.31,391.317,.05,"DT")
3050207
"^DD",391.31,391.317,.06,0)
DATE/TIME OF ACK FROM HT^D^^0;6^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",391.31,391.317,.06,3)
Enter date/time acknowledgement was received from HT vendor.
"^DD",391.31,391.317,.06,21,0)
^.001^2^2^3050214^^^
"^DD",391.31,391.317,.06,21,1,0)
Date and time acknowledgement for transmission to Home Telehealth 
"^DD",391.31,391.317,.06,21,2,0)
Vendor server was received. 
"^DD",391.31,391.317,.06,"DT")
3050207
"^DD",391.31,391.317,.07,0)
ACK CODE FROM HT^S^A:ACCEPTED;R:REJECTED;^0;7^Q
"^DD",391.31,391.317,.07,3)
Enter acknowledgement code received from HT.
"^DD",391.31,391.317,.07,21,0)
^.001^5^5^3050214^^
"^DD",391.31,391.317,.07,21,1,0)
Code denoting type of acknowledgement received for transmission to Home 
"^DD",391.31,391.317,.07,21,2,0)
Telehealth Vendor Server.  This code is related to the application 
"^DD",391.31,391.317,.07,21,3,0)
acknowledgement.  The codes are as follows:-
"^DD",391.31,391.317,.07,21,4,0)
    A = Accepted
"^DD",391.31,391.317,.07,21,5,0)
    R = Rejected
"^DD",391.31,391.317,.07,"DT")
3050207
"^DD",391.31,391.317,.08,0)
REJECT MESSAGE^F^^0;8^K:$L(X)>50!($L(X)<3) X
"^DD",391.31,391.317,.08,3)
Enter 3-50 characters of the error message.
"^DD",391.31,391.317,.08,21,0)
^.001^2^2^3050214^^^^
"^DD",391.31,391.317,.08,21,1,0)
If there was an error in processing of the transmission message, this field 
"^DD",391.31,391.317,.08,21,2,0)
will contain the 3-50 characters of the error message.
"^DD",391.31,391.317,.08,"DT")
3050214
"^DIC",391.31,391.31,0)
HOME TELEHEALTH PATIENT^391.31
"^DIC",391.31,391.31,0,"GL")
^DGHT(391.31,
"^DIC",391.31,"B","HOME TELEHEALTH PATIENT",391.31)

"BLD",5914,6)
^689
**END**
**END**
