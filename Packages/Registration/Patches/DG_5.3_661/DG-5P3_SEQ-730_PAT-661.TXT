
=============================================================================
Run Date: AUG 31, 2010                     Designation: DG*5.3*661
Package : DG - REGISTRATION                   Priority: Mandatory
Version : 5.3       SEQ #730                    Status: Released
                  Compliance Date: OCT 01, 2010
=============================================================================

Associated patches: (v)DG*5.3*688  <<= must be installed BEFORE `DG*5.3*661'

Subject: FIX INVALID COPAY LINKS - NON IVM TESTS

Category: 
  - Routine

Description:
============

 This patch corrects a problem that is causing veterans' financial (Means 
 and Rx Co-pay) Tests to be incorrectly paired, or "linked" together in 
 VistA when the dates of the two tests are not in the same year. This
 problem occurs when a non-IVM-converted Means or Rx Co-pay Test is being
 uploaded into the database. If the veteran's most recent existing test of
 the same type as the incoming test has been linked to another test, this
 link will be added to the incoming test even if the date of the linked
 test is in a different year. This makes the link invalid, because the two
 tests are not in the same year.
  
 This patch will be distributed in a Host File along with patch EAS*1.0*86 
 (IVM Means Test Upload Issues Corrected). Patch EAS*1.0*86 corrects this 
 same problem for IVM-converted tests.
  
  
 This patch addresses the following New Service Request (NSR):
 -------------------------------------------------------------
 There is no NSR associated with this patch.
  
  
 This patch addresses the following Remedy Ticket(s):
 ----------------------------------------------------
 HD0000000254647  Means test issue
 Duplicates:
    HD0000000241667  New Means Test Not Populating RX Copay
    HD0000000241702  Co-Pay Test
    HD0000000340201  ESR records show vet as not married but lists 1 
                     dependent
  
  
 Overview of Remedy Ticket(s):
 -----------------------------
 HD0000000254647   Means test issue
    Duplicates: HD0000000241667, HD0000000241702, HD0000000340201
  
 Problem:
 --------
 The problem described above is exemplified by the incorrect linking of an 
 existing Rx Co-pay Test from a previous year to a new non-IVM-converted
 Means Test being uploaded from an HL7 Z10 message. The fact that the 
 co-pay test is for a previous year makes it appear that the co-pay
 exemption status for the current year is not based on the income or
 patient eligibility factors for that year.
  
 Solution:
 ---------
 When an incoming, non-IVM-converted test is uploaded, the code will check 
 the veteran's most recent existing test of the same type. If it has a
 link, the code will add that link to the new test, but only if the dates 
 of the new test, existing test, and linked test are all in the same year.
  
 Routine changed: DGMTA
  
 Patch EAS*1.0*86 will correct this same problem for IVM-converted tests.
  
  
 Test Sites:
 -----------
 Butler, PA VAMC (Small)
 Eastern Colorado HCS (Large)
 Marion, IL VAMC (Heartland-East HCS - Integrated)
 St. Cloud, MN VAMC (Small)
  
  
 SOFTWARE RETRIEVAL
 ==================
  
 The software for this patch is not being distributed through the National 
 Patch Module. This patch is being distributed as a host file. The host 
 file will contain the following two KIDS builds:
  
             Host file name: DG_53_P661.KID
  
                     Builds: DG*5.3*661
                             EAS*1.0*86
  
 Sites may retrieve the software directly using File Transfer Protocol 
 (FTP) from the ANONYMOUS.SOFTWARE directory at the following OI Field 
 Offices:
  
                     Albany   : ftp.fo-albany.med.va.gov
                     Hines    : ftp.fo-hines.med.va.gov
               Salt Lake City : ftp.fo-slc.med.va.gov
       First Available Server : download.vista.med.va.gov
  
 The following file will be available:
  
     File Name            Description
     ---------            -----------
     DG_53_P661.KID       Host File containing KIDS software distribution
  
 Note:  Use ASCII mode when transferring the .KID file.
  
  
        ================INSTALLATION INSTRUCTIONS =================
  
 If installed during the normal workday, it is recommended that Taskman 
 be placed in a wait state in order to prevent missing HL7 traffic while
 this patch is being installed. 
  
 NOTE:  Because queuing an installation requires Taskman to be in an 
 active state, it is recommended that the installation not be queued.
  
  
 Install Time - Less than 5 minutes.
  
 1.  DOWNLOAD HOST KIDS FILE
     -----------------------
     Download the KIDS file DG_53_P661.KID from the ANONYMOUS.SOFTWARE
     directory of any of the following three Office of Information Field
     Offices (OIFOs):  Albany, Hines, or Salt Lake to the appropriate
     directory on your system.
  
 2.  LOAD DISTRIBUTION
     -----------------
     Use the 'LOAD A DISTRIBUTION' option on the KIDS INSTALLATION
     menu, and enter:  the directory onto which you have downloaded the
     host file, immediately followed by DG_53_P661.KID.
  
              
 3.  START UP KIDS 
     -------------
     Start up the Kernel Installation and Distribution System Menu 
     [XPD MAIN]: 
    
          Edits and Distribution ...  
          Utilities ...  
          Installation ...  
    
 Select Kernel Installation & Distribution System Option: INStallation 
                                                          ---
          Load a Distribution 
          Print Transport Global 
          Compare Transport Global to Current System 
          Verify Checksums in Transport Global 
          Install Package(s) 
          Restart Install of Package(s) 
          Unload a Distribution 
          Backup a Transport Global 
    
 Select Installation Option: 
    
 4.  Select Installation Option: 
     ---------------------------
     NOTE:  The following are OPTIONAL - (When prompted for the INSTALL
            NAME, enter DG*5.3*661):
       
     a.  Backup a Transport Global - This option will create a backup
         message of any routines exported with this patch. It will not
         backup any other changes such as DD's or templates.
     b.  Compare Transport Global to Current System - This option will
         allow you to view all changes that will be made when this patch
         is installed. It compares all components of this patch
         (routines, DD's, templates, etc.).
     c.  Verify Checksums in Transport Global - This option will allow
         you to ensure the integrity of the routines that are in the
         transport global.
      
 5.  Select Installation Option: Install Package(s) 
                                 ------------------
     **This is the step to start the installation of this KIDS patch: 
    
     a.  Choose the Install Package(s) option to start the patch
         install.
     b.  When prompted 'Want KIDS to INHIBIT LOGONs during the install? 
         NO//' answer NO. 
     c.  When prompted 'Want to DISABLE Scheduled Options, Menu 
         Options, and Protocols? NO//' answer YES.
     d.  When prompted 'Enter options you wish to mark as 'Out Of
         Order':'  enter:
         
              DG MEANS TEST ADD       Add a New Means Test
  
     e.  When prompted 'Enter protocols you wish to mark as 'Out Of
         Order':'  press <ENTER>.
     g.  If prompted for 'Delay Install (Minutes):  (0-60): 0//' 
          press <Enter>.
  
 6.  If Taskman was placed in a wait state, it should be removed from the
     wait state as soon as the install is done. The post-install process 
     will not run until Taskman has restarted.
  
 7.  The post-install routine, DG53661P, can be deleted once the 
     post-install process has completed successfully.
  
  
 ****************** POST-INSTALLATION INSTRUCTIONS *******************
  
 A post-installation routine will automatically queue a job to run after
 the patch installation has completed. The routine is DG53661P.
  
 The post-install job will 'clean up' existing links between all Means
 Tests and Rx Co-pay tests (both IVM- and non-IVM converted) that are not
 for the same income year, or are pointing to a record that no longer
 exists in the file. These incorrect links will be deleted. 
  
 Because this clean-up process will read through the entire ANNUAL MEANS 
 TEST file (#408.31), this job may take a long time to run. A completion
 bulletin will be sent to the mail group DGEN ELIGIBILITY ALERT when it has
 successfully completed. If it does not complete or is stopped, it can be
 restarted by running CTSTART^DG53661P.
  
 The results of the clean-up are stored in the ^XTMP("DG53661", global.
 NOTE:  The ^XTMP("DG53661" global at your site will be maintained for 
 six months, after which it will be automatically purged by a background 
 process that runs on every system.
  
 ^XTMP("DG53661","LINK_DELETED",<Subscript 3>,<Subscript 4>)=""
        Subscript 3: IEN of record in ANNUAL MEANS TEST file (#408.31)
        Subscript 4: IEN of deleted link from LINKED RX COPAY/MEANS TEST
                     field (#2.06)
  
 The rest of the global definition is:
  
 ^XTMP("DG53661","PARAMS")= four '^' pieces of data:
         Piece 1: Running count of the # of ANNUAL MEANS TEST file 
                  (#408.31) records where the bad link was deleted. 
         Piece 2: Last IEN read from ANNUAL MEANS TEST file (#408.31) 
         Piece 3: Running count of the # of records read in the ANNUAL 
                  MEANS TEST file (#408.31).
         Piece 4: "RUNNING", "STOPPED" or "DONE" to indicate the 
                  current status of the update job.
  
 ^XTMP("DG53661","RUNNING",<date/time of job start>)=date/time of job end 
  
 ^XTMP("DG53661","RUNNING",<date/time of job start>,<task #>)=""
  
  
 Note:  In the Routine Information section below, where routines' second 
 lines are listed, please disregard the Build numbers, as these have been
 generated by the National Patch Module and are irrelevant to VistA sites'
 installations.

Routine Information:
====================
The second line of each of these routines now looks like:
 ;;5.3;Registration;**[Patch List]**;Aug 13, 1993;Build 2

The checksums below are new checksums, and
 can be checked with CHECK1^XTSUMBLD.

Routine Name: DG53661P
    Before:       n/a   After: B19780943  **661**
Routine Name: DGMTA
    Before: B40373601   After: B41969113  **33,45,137,166,177,182,290,
                                           344,332,433,458,535,612,564,
                                           688,661**
 
Routine list of preceding patches: 688

=============================================================================
User Information:
Entered By  : MULLER,RICHARD                Date Entered  : APR 12, 2005
Completed By: RUDINGER,NANCY L.             Date Completed: AUG 24, 2010
Released By : GROOMS,ANTHONY E              Date Released : AUG 31, 2010
=============================================================================


Packman Mail Message:
=====================

No routines included
