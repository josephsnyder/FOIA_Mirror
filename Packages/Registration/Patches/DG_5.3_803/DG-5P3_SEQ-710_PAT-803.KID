EMERGENCY Released DG*5.3*803 SEQ #710
Extracted from mail message
**KIDS**:DG*5.3*803^

**INSTALL NAME**
DG*5.3*803
"BLD",7200,0)
DG*5.3*803^REGISTRATION^0^3090608^y
"BLD",7200,1,0)
^^1^1^3090605^
"BLD",7200,1,1,0)
Please refer to the patch description in this patch on FORUM
"BLD",7200,4,0)
^9.64PA^27.16^2
"BLD",7200,4,27.11,0)
27.11
"BLD",7200,4,27.11,2,0)
^9.641^27.11^1
"BLD",7200,4,27.11,2,27.11,0)
PATIENT ENROLLMENT  (File-top level)
"BLD",7200,4,27.11,2,27.11,1,0)
^9.6411^.12^1
"BLD",7200,4,27.11,2,27.11,1,.12,0)
ENROLLMENT SUBGROUP
"BLD",7200,4,27.11,222)
y^y^p^^^^n^^n
"BLD",7200,4,27.11,224)

"BLD",7200,4,27.16,0)
27.16
"BLD",7200,4,27.16,2,0)
^9.641^27.16^1
"BLD",7200,4,27.16,2,27.16,0)
ENROLLMENT GROUP THRESHOLD  (File-top level)
"BLD",7200,4,27.16,2,27.16,1,0)
^9.6411^.03^1
"BLD",7200,4,27.16,2,27.16,1,.03,0)
EGT SUBGROUP
"BLD",7200,4,27.16,222)
y^y^p^^^^n^^n
"BLD",7200,4,27.16,224)

"BLD",7200,4,"APDD",27.11,27.11)

"BLD",7200,4,"APDD",27.11,27.11,.12)

"BLD",7200,4,"APDD",27.16,27.16)

"BLD",7200,4,"APDD",27.16,27.16,.03)

"BLD",7200,4,"B",27.11,27.11)

"BLD",7200,4,"B",27.16,27.16)

"BLD",7200,6)
6^
"BLD",7200,6.3)
31
"BLD",7200,"INID")
^n
"BLD",7200,"INIT")
EN^DG53P803
"BLD",7200,"KRN",0)
^9.67PA^9002226^20
"BLD",7200,"KRN",.4,0)
.4
"BLD",7200,"KRN",.401,0)
.401
"BLD",7200,"KRN",.402,0)
.402
"BLD",7200,"KRN",.403,0)
.403
"BLD",7200,"KRN",.5,0)
.5
"BLD",7200,"KRN",.84,0)
.84
"BLD",7200,"KRN",3.6,0)
3.6
"BLD",7200,"KRN",3.8,0)
3.8
"BLD",7200,"KRN",9.2,0)
9.2
"BLD",7200,"KRN",9.8,0)
9.8
"BLD",7200,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",7200,"KRN",9.8,"NM",1,0)
DGENELA4^^0^B63509989
"BLD",7200,"KRN",9.8,"NM",2,0)
DG53P803^^0^B935708
"BLD",7200,"KRN",9.8,"NM",3,0)
DGENEGT1^^0^B62318221
"BLD",7200,"KRN",9.8,"NM","B","DG53P803",2)

"BLD",7200,"KRN",9.8,"NM","B","DGENEGT1",3)

"BLD",7200,"KRN",9.8,"NM","B","DGENELA4",1)

"BLD",7200,"KRN",19,0)
19
"BLD",7200,"KRN",19.1,0)
19.1
"BLD",7200,"KRN",101,0)
101
"BLD",7200,"KRN",409.61,0)
409.61
"BLD",7200,"KRN",771,0)
771
"BLD",7200,"KRN",870,0)
870
"BLD",7200,"KRN",8989.51,0)
8989.51
"BLD",7200,"KRN",8989.52,0)
8989.52
"BLD",7200,"KRN",8994,0)
8994
"BLD",7200,"KRN",9002226,0)
9002226
"BLD",7200,"KRN","B",.4,.4)

"BLD",7200,"KRN","B",.401,.401)

"BLD",7200,"KRN","B",.402,.402)

"BLD",7200,"KRN","B",.403,.403)

"BLD",7200,"KRN","B",.5,.5)

"BLD",7200,"KRN","B",.84,.84)

"BLD",7200,"KRN","B",3.6,3.6)

"BLD",7200,"KRN","B",3.8,3.8)

"BLD",7200,"KRN","B",9.2,9.2)

"BLD",7200,"KRN","B",9.8,9.8)

"BLD",7200,"KRN","B",19,19)

"BLD",7200,"KRN","B",19.1,19.1)

"BLD",7200,"KRN","B",101,101)

"BLD",7200,"KRN","B",409.61,409.61)

"BLD",7200,"KRN","B",771,771)

"BLD",7200,"KRN","B",870,870)

"BLD",7200,"KRN","B",8989.51,8989.51)

"BLD",7200,"KRN","B",8989.52,8989.52)

"BLD",7200,"KRN","B",8994,8994)

"BLD",7200,"KRN","B",9002226,9002226)

"BLD",7200,"QDEF")
^^^^NO^^^^^^NO
"BLD",7200,"QUES",0)
^9.62^^
"BLD",7200,"REQB",0)
^9.611^1^1
"BLD",7200,"REQB",1,0)
DG*5.3*688^1
"BLD",7200,"REQB","B","DG*5.3*688",1)

"FIA",27.11)
PATIENT ENROLLMENT
"FIA",27.11,0)
^DGEN(27.11,
"FIA",27.11,0,0)
27.11OID
"FIA",27.11,0,1)
y^y^p^^^^n^^n
"FIA",27.11,0,10)

"FIA",27.11,0,11)

"FIA",27.11,0,"RLRO")

"FIA",27.11,0,"VR")
5.3^DG
"FIA",27.11,27.11)
1
"FIA",27.11,27.11,.12)

"FIA",27.16)
ENROLLMENT GROUP THRESHOLD
"FIA",27.16,0)
^DGEN(27.16,
"FIA",27.16,0,0)
27.16DO
"FIA",27.16,0,1)
y^y^p^^^^n^^n
"FIA",27.16,0,10)

"FIA",27.16,0,11)

"FIA",27.16,0,"RLRO")

"FIA",27.16,0,"VR")
5.3^DG
"FIA",27.16,27.16)
1
"FIA",27.16,27.16,.03)

"INIT")
EN^DG53P803
"MBREQ")
0
"PKG",47,-1)
1^1
"PKG",47,0)
REGISTRATION^DG^PATIENT REGISTRATION, ADMISSION, DISCHARGE, EMBOSSER 
"PKG",47,20,0)
^9.402P^^
"PKG",47,22,0)
^9.49I^1^1
"PKG",47,22,1,0)
5.3^2930813^2960613
"PKG",47,22,1,"PAH",1,0)
803^3090608^123456997
"PKG",47,22,1,"PAH",1,1,0)
^^1^1^3090608
"PKG",47,22,1,"PAH",1,1,1,0)
Please refer to the patch description in this patch on FORUM
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","DG53P803")
0^2^B935708^n/a
"RTN","DG53P803",1,0)
DG53P803 ;ALB/DLF Set Enrollment group threshold to 'd' ; 6/8/09 5:51pm
"RTN","DG53P803",2,0)
 ;;5.3;Registration;**803**;Aug 13, 1993;Build 31
"RTN","DG53P803",3,0)
 Q
"RTN","DG53P803",4,0)
EN ;Post install entry point
"RTN","DG53P803",5,0)
 D MES^XPDUTL("Updating Enrollment Group Threshold file (#27.16)")
"RTN","DG53P803",6,0)
 N EGTIEN,DGENFDA,ERR,DIE
"RTN","DG53P803",7,0)
 S DGENFDA(27.16,"+1,",.01)=3090615
"RTN","DG53P803",8,0)
 S DGENFDA(27.16,"+1,",.02)=8
"RTN","DG53P803",9,0)
 S DGENFDA(27.16,"+1,",.03)=4
"RTN","DG53P803",10,0)
 S DGENFDA(27.16,"+1,",.04)=4
"RTN","DG53P803",11,0)
 S DGENFDA(27.16,"+1,",.06)=$$DT^XLFDT
"RTN","DG53P803",12,0)
 S DGENFDA(27.16,"+1,",25)="EGT set to 8d by patch DG*5.3*803"
"RTN","DG53P803",13,0)
 D UPDATE^DIE("","DGENFDA","","ERR")
"RTN","DG53P803",14,0)
 I $D(ERR) D MES^XPDUTL("   Could not set EGT entry in file #27.16")
"RTN","DG53P803",15,0)
 Q
"RTN","DGENEGT1")
0^3^B62318221^B61377172
"RTN","DGENEGT1",1,0)
DGENEGT1 ;ALB/KCL,ISA/KWP,LBD,RGL,BRM,DLF - Enrollment Group Threshold API's ; 4/21/09 12:10pm
"RTN","DGENEGT1",2,0)
 ;;5.3;Registration;**232,417,454,491,513,451,564,672,717,688,803**;Aug 13, 1993;Build 31
"RTN","DGENEGT1",3,0)
 ;
"RTN","DGENEGT1",4,0)
 ;
"RTN","DGENEGT1",5,0)
NOTIFY(DGEGT,OLDEGT) ;
"RTN","DGENEGT1",6,0)
 ; Description: This is used to send a message to local mail group.
"RTN","DGENEGT1",7,0)
 ; The notification is used to communicate changes in the Enrollment
"RTN","DGENEGT1",8,0)
 ; Group Threshold (EGT) setting to users at the local site.
"RTN","DGENEGT1",9,0)
 ;
"RTN","DGENEGT1",10,0)
 ;  Input:
"RTN","DGENEGT1",11,0)
 ;    DGEGT - the new Enrollment Group Threshold array, passed by reference
"RTN","DGENEGT1",12,0)
 ;   OLDEGT - the previous Enrollment Group Threshold array, passed by reference
"RTN","DGENEGT1",13,0)
 ;
"RTN","DGENEGT1",14,0)
 ; Output: None
"RTN","DGENEGT1",15,0)
 ;
"RTN","DGENEGT1",16,0)
 N TEXT,XMDUN,XMDUZ,XMTEXT,XMROU,XMSTRIP,XMSUB,XMY,XMZ,OLDPRI
"RTN","DGENEGT1",17,0)
 ;
"RTN","DGENEGT1",18,0)
 ; init subject and sender
"RTN","DGENEGT1",19,0)
 S XMSUB="Enrollment Group Threshold (EGT) Changed"
"RTN","DGENEGT1",20,0)
 S (XMDUN,XMDUZ)="Registration Enrollment Module"
"RTN","DGENEGT1",21,0)
 ;
"RTN","DGENEGT1",22,0)
 ; recipient
"RTN","DGENEGT1",23,0)
 S XMY("G.DGEN EGT UPDATES")=""
"RTN","DGENEGT1",24,0)
 ;
"RTN","DGENEGT1",25,0)
 ; get old EGT priority
"RTN","DGENEGT1",26,0)
 S OLDPRI=$G(OLDEGT("PRIORITY"))
"RTN","DGENEGT1",27,0)
 ;
"RTN","DGENEGT1",28,0)
 S XMTEXT="TEXT("
"RTN","DGENEGT1",29,0)
 S TEXT(1)="The Secretary of the VA has officially changed the enrollment priority"
"RTN","DGENEGT1",30,0)
 S TEXT(2)="grouping of veterans who shall receive care.  This change may place"
"RTN","DGENEGT1",31,0)
 S TEXT(3)="veterans under your facilities care into a 'Not Enrolled' category."
"RTN","DGENEGT1",32,0)
 S TEXT(4)=""
"RTN","DGENEGT1",33,0)
 S TEXT(5)=""
"RTN","DGENEGT1",34,0)
 S TEXT(6)="           Prior EGT Priority:  "_$S($G(OLDPRI):$$EXTERNAL^DILFD(27.16,.02,"F",OLDPRI),1:"N/A")_$S($G(OLDEGT("SUBGRP")):$$EXTERNAL^DILFD(27.16,.03,"F",OLDEGT("SUBGRP")),1:"")
"RTN","DGENEGT1",35,0)
 S TEXT(7)=""
"RTN","DGENEGT1",36,0)
 S TEXT(8)=""
"RTN","DGENEGT1",37,0)
 S TEXT(9)="  New Enrollment Group Threshold (EGT) Settings:"
"RTN","DGENEGT1",38,0)
 S TEXT(10)=""
"RTN","DGENEGT1",39,0)
 S TEXT(11)="                 EGT Priority:  "_$$EXTERNAL^DILFD(27.16,.02,"F",DGEGT("PRIORITY"))_$S($G(DGEGT("SUBGRP")):$$EXTERNAL^DILFD(27.16,.03,"F",DGEGT("SUBGRP")),1:"")
"RTN","DGENEGT1",40,0)
 S TEXT(12)="                     EGT Type:  "_$$EXTERNAL^DILFD(27.16,.04,"F",DGEGT("TYPE"))
"RTN","DGENEGT1",41,0)
 S TEXT(13)="           EGT Effective Date:  "_$$EXTERNAL^DILFD(27.16,.01,"F",DGEGT("EFFDATE"))
"RTN","DGENEGT1",42,0)
 ;
"RTN","DGENEGT1",43,0)
 ; mailman deliverey
"RTN","DGENEGT1",44,0)
 D ^XMD
"RTN","DGENEGT1",45,0)
 ;
"RTN","DGENEGT1",46,0)
 Q
"RTN","DGENEGT1",47,0)
 ;
"RTN","DGENEGT1",48,0)
 ;
"RTN","DGENEGT1",49,0)
DISPLAY() ;
"RTN","DGENEGT1",50,0)
 ; Description: Display Enrollment Group Threshold (EGT) settings.
"RTN","DGENEGT1",51,0)
 ;
"RTN","DGENEGT1",52,0)
 N DGEGT
"RTN","DGENEGT1",53,0)
 ;
"RTN","DGENEGT1",54,0)
 W !
"RTN","DGENEGT1",55,0)
 I '$$GET^DGENEGT($$FINDCUR^DGENEGT(),.DGEGT) W !,"Enrollment Group Threshold (EGT) settings not found."
"RTN","DGENEGT1",56,0)
 E  D
"RTN","DGENEGT1",57,0)
 .W !,?3,"Enrollment Group Threshold (EGT) Settings"
"RTN","DGENEGT1",58,0)
 .W !,?3,"========================================="
"RTN","DGENEGT1",59,0)
 .W !
"RTN","DGENEGT1",60,0)
 .W !?5,"Date Entered",?25,": ",$S('$G(DGEGT("ENTERED")):"-none-",1:$$EXTERNAL^DILFD(27.16,.01,"F",DGEGT("ENTERED")))
"RTN","DGENEGT1",61,0)
 .W !?5,"EGT Priority",?25,": ",$S('$G(DGEGT("PRIORITY")):"-none-",1:$$EXTERNAL^DILFD(27.16,.02,"F",DGEGT("PRIORITY")))_$S($G(DGEGT("SUBGRP"))="":"",1:$$EXTERNAL^DILFD(27.16,.03,"F",DGEGT("SUBGRP")))
"RTN","DGENEGT1",62,0)
 .W !?5,"EGT Type",?25,": ",$S($G(DGEGT("TYPE"))="":"-none-",1:$$EXTERNAL^DILFD(27.16,.04,"F",DGEGT("TYPE")))
"RTN","DGENEGT1",63,0)
 .W !?5,"EGT Effective Date",?25,": ",$S('$G(DGEGT("EFFDATE")):"-none-",1:$$EXTERNAL^DILFD(27.16,.05,"F",DGEGT("EFFDATE")))
"RTN","DGENEGT1",64,0)
 ;
"RTN","DGENEGT1",65,0)
 Q
"RTN","DGENEGT1",66,0)
 ;
"RTN","DGENEGT1",67,0)
ABOVE(DPTDFN,ENRPRI,ENRGRP,EGTPRI,EGTGRP,EGTFLG) ;
"RTN","DGENEGT1",68,0)
 ; Description: This function will determine if the enrollment is above
"RTN","DGENEGT1",69,0)
 ; the threshold.
"RTN","DGENEGT1",70,0)
 ;
"RTN","DGENEGT1",71,0)
 ;Input:
"RTN","DGENEGT1",72,0)
 ; DPTDFN - Patient File IEN
"RTN","DGENEGT1",73,0)
 ; ENRPRI - Enrollment Priority
"RTN","DGENEGT1",74,0)
 ; ENRGRP - Enrollment Sub-Group
"RTN","DGENEGT1",75,0)
 ; EGTPRI - EGT Priority (optional) - not used
"RTN","DGENEGT1",76,0)
 ; EGTGRP - EGT Sub-Group (optional) - not used
"RTN","DGENEGT1",77,0)
 ; EGTFLG - Flag to bypass additional EGT type 2 check (optional)
"RTN","DGENEGT1",78,0)
 ;          It is used by $$ABOVE2 to prevent re-entering the
"RTN","DGENEGT1",79,0)
 ;          sub-priority API ($$SUBPRI^DGENELA4)
"RTN","DGENEGT1",80,0)
 ; Output:
"RTN","DGENEGT1",81,0)
 ; Returns 1 if above 0 below. 
"RTN","DGENEGT1",82,0)
 ;
"RTN","DGENEGT1",83,0)
 I $G(ENRGRP)="" S ENRGRP=""
"RTN","DGENEGT1",84,0)
 I $G(ENRPRI)="" S ENRPRI=""
"RTN","DGENEGT1",85,0)
 N ABOVE,EGT,TODAY,X
"RTN","DGENEGT1",86,0)
 I '$$GET^DGENEGT($$FINDCUR^DGENEGT(),.EGT) Q 1
"RTN","DGENEGT1",87,0)
 D NOW^%DTC S TODAY=X
"RTN","DGENEGT1",88,0)
 I TODAY<EGT("EFFDATE") Q 1
"RTN","DGENEGT1",89,0)
 ;
"RTN","DGENEGT1",90,0)
 ;EGT type 2 - Stop New Enrollments
"RTN","DGENEGT1",91,0)
 ; or EGT type 4 - Enrollment Decision (ESP DG*5.3*491)
"RTN","DGENEGT1",92,0)
 I EGT("TYPE")=2!(EGT("TYPE")=4) D  Q ABOVE
"RTN","DGENEGT1",93,0)
 .S ABOVE=0
"RTN","DGENEGT1",94,0)
 .I ENRPRI<7 D  Q
"RTN","DGENEGT1",95,0)
 ..I ENRPRI'>EGT("PRIORITY") S ABOVE=1 Q
"RTN","DGENEGT1",96,0)
 .;do check for priorities 7 and 8
"RTN","DGENEGT1",97,0)
 .I ENRPRI<EGT("PRIORITY") S ABOVE=1 Q
"RTN","DGENEGT1",98,0)
 .I ENRGRP'>EGT("SUBGRP") S ABOVE=1 Q
"RTN","DGENEGT1",99,0)
 .I $$OVRRIDE(.DPTDFN,.EGT) S ABOVE=1
"RTN","DGENEGT1",100,0)
 ;
"RTN","DGENEGT1",101,0)
 ;EGT types 1 & 3
"RTN","DGENEGT1",102,0)
 ;do check for priorities 7 and 8
"RTN","DGENEGT1",103,0)
 I ENRPRI>6&(ENRPRI=EGT("PRIORITY")) S ABOVE=0 D  Q ABOVE
"RTN","DGENEGT1",104,0)
 .I ENRGRP'>(EGT("SUBGRP")) S ABOVE=1
"RTN","DGENEGT1",105,0)
 I ENRPRI'>(EGT("PRIORITY")) Q 1
"RTN","DGENEGT1",106,0)
 Q 0
"RTN","DGENEGT1",107,0)
 ;
"RTN","DGENEGT1",108,0)
ABOVE2(DPTDFN,ENRDT,PRIORITY,SUBGRP) ;
"RTN","DGENEGT1",109,0)
 ;
"RTN","DGENEGT1",110,0)
 ; Input: DPTDFN    - Patient File IEN
"RTN","DGENEGT1",111,0)
 ;        ENRDT     - enrollment effective date
"RTN","DGENEGT1",112,0)
 ;        PRIORITY  - enrollment priority
"RTN","DGENEGT1",113,0)
 ;        SUBGRP    - enrollment sub-priority (internal numeric value)
"RTN","DGENEGT1",114,0)
 ;
"RTN","DGENEGT1",115,0)
 ; Output: 1 or 0 for above or below EGT threshold
"RTN","DGENEGT1",116,0)
 ;
"RTN","DGENEGT1",117,0)
 N ABOVE,TODAY,X,EGT
"RTN","DGENEGT1",118,0)
 S ABOVE=1
"RTN","DGENEGT1",119,0)
 S:'$G(SUBGRP) SUBGRP=""
"RTN","DGENEGT1",120,0)
 S:'$G(PRIORITY) PRIORITY=""
"RTN","DGENEGT1",121,0)
 S:'$G(ENRDT) ENRDT=""
"RTN","DGENEGT1",122,0)
 D NOW^%DTC S TODAY=X
"RTN","DGENEGT1",123,0)
 Q:'$$GET^DGENEGT($$FINDCUR^DGENEGT(ENRDT),.EGT) 1
"RTN","DGENEGT1",124,0)
 Q:'$G(EGT("EFFDATE")) 1
"RTN","DGENEGT1",125,0)
 Q:TODAY<EGT("EFFDATE") 1
"RTN","DGENEGT1",126,0)
 Q:EGT("TYPE")#2 $$ABOVE(DPTDFN,PRIORITY,SUBGRP,"","",1)  ;If EGT type 1 or 3
"RTN","DGENEGT1",127,0)
 I '$$ABOVE(DPTDFN,PRIORITY,SUBGRP,"","",1) Q 0
"RTN","DGENEGT1",128,0)
 Q ABOVE
"RTN","DGENEGT1",129,0)
 ;
"RTN","DGENEGT1",130,0)
OVRRIDE(DPTDFN,EGT) ;check for previous EGT override by HEC and new rules
"RTN","DGENEGT1",131,0)
 N CVDT,ENRCAT,ENRDT,EGTENR,ENRIEN,DGPAT,STOP,CUR,CE
"RTN","DGENEGT1",132,0)
 S (STOP,CUR)=0
"RTN","DGENEGT1",133,0)
 I '$$GET^DGENELA(DPTDFN,.DGPAT) Q 0  ;Get current Patient file data
"RTN","DGENEGT1",134,0)
 ; Find most recent enrollment record
"RTN","DGENEGT1",135,0)
 S ENRIEN=$$FINDCUR^DGENA(.DPTDFN)
"RTN","DGENEGT1",136,0)
 F  Q:STOP!CUR  D
"RTN","DGENEGT1",137,0)
 .I 'ENRIEN S STOP=1 Q  ;cannot check if no current enrollment
"RTN","DGENEGT1",138,0)
 .I '$$GET^DGENA(ENRIEN,.EGTENR) S STOP=1 Q  ;need enr info to proceed
"RTN","DGENEGT1",139,0)
 .S ENRIEN=$$FINDPRI^DGENA(ENRIEN)
"RTN","DGENEGT1",140,0)
 .; If status is Pending, Deceased, Not Eligible, or Not Applicable
"RTN","DGENEGT1",141,0)
 .; ignore record and get previous
"RTN","DGENEGT1",142,0)
 .I "^6^15^16^17^18^19^20^21^23^"[(U_EGTENR("STATUS")_U) Q
"RTN","DGENEGT1",143,0)
 .S CUR=1
"RTN","DGENEGT1",144,0)
 I STOP Q 0
"RTN","DGENEGT1",145,0)
 S ENRDT=$$EDATE($G(EGTENR("APP")),$G(EGTENR("EFFDATE"))) S:'ENRDT ENRDT=DT
"RTN","DGENEGT1",146,0)
 S ENRCAT=$P($G(^DGEN(27.15,+EGTENR("STATUS"),0)),"^",2)
"RTN","DGENEGT1",147,0)
 ; If enrollment status was overridden at HEC, then cont. enroll.
"RTN","DGENEGT1",148,0)
 I EGTENR("SOURCE")=2,ENRDT'<EGT("EFFDATE"),ENRCAT="E" Q 1
"RTN","DGENEGT1",149,0)
 ; If status is Rejected or Cancelled/Declined, quit (no cont. enroll.)
"RTN","DGENEGT1",150,0)
 I "^4^7^11^12^13^22^"[(U_EGTENR("STATUS")_U) Q 0
"RTN","DGENEGT1",151,0)
 ; If Application Date or Effective Date of Change are prior to the
"RTN","DGENEGT1",152,0)
 ; EGT Effective Date then cont. enroll.
"RTN","DGENEGT1",153,0)
 I ENRDT<EGT("EFFDATE") Q 1
"RTN","DGENEGT1",154,0)
 ; If Enrollment Record is Verified, and meets one of the special CE
"RTN","DGENEGT1",155,0)
 ; rules, then cont. enroll.
"RTN","DGENEGT1",156,0)
 I ENRCAT="E" S CE=$$RULES(DPTDFN,.EGTENR,.EGT,.DGPAT) I CE Q CE>0
"RTN","DGENEGT1",157,0)
 ; Check previous enrollment records for Application Date/Effective
"RTN","DGENEGT1",158,0)
 ; Date and special CE rules
"RTN","DGENEGT1",159,0)
 S (STOP,CE)=0
"RTN","DGENEGT1",160,0)
 F  Q:STOP  D
"RTN","DGENEGT1",161,0)
 .I 'ENRIEN S STOP=1 Q  ;cannot check if no current enrollment
"RTN","DGENEGT1",162,0)
 .I '$$GET^DGENA(ENRIEN,.EGTENR) S STOP=1 Q  ;need enr info to proceed
"RTN","DGENEGT1",163,0)
 .S ENRIEN=$$FINDPRI^DGENA(ENRIEN)
"RTN","DGENEGT1",164,0)
 .; If status is Pending, Deceased, Not Eligible; Ineligible Date,
"RTN","DGENEGT1",165,0)
 .; or Not Applicable ignore record and get previous
"RTN","DGENEGT1",166,0)
 .I "^6^15^16^17^18^19^20^21^23^"[(U_EGTENR("STATUS")_U) Q
"RTN","DGENEGT1",167,0)
 .S ENRDT=$$EDATE($G(EGTENR("APP")),$G(EGTENR("EFFDATE"))) S:'ENRDT ENRDT=DT
"RTN","DGENEGT1",168,0)
 .S ENRCAT=$P($G(^DGEN(27.15,+EGTENR("STATUS"),0)),"^",2)
"RTN","DGENEGT1",169,0)
 .; If Application Date or Effective Date of Change are prior to the
"RTN","DGENEGT1",170,0)
 .; EGT Effective Date then cont. enroll.
"RTN","DGENEGT1",171,0)
 .I ENRDT<EGT("EFFDATE") S (STOP,CE)=1 Q
"RTN","DGENEGT1",172,0)
 .; If Enrollment Record is Verified, and meets one of the special CE
"RTN","DGENEGT1",173,0)
 .; rules, then cont. enroll.
"RTN","DGENEGT1",174,0)
 .I ENRCAT="E" S CE=$$RULES(DPTDFN,.EGTENR,.EGT,.DGPAT) I CE S STOP=1,CE=CE>0 Q
"RTN","DGENEGT1",175,0)
 Q CE
"RTN","DGENEGT1",176,0)
 ;
"RTN","DGENEGT1",177,0)
RULES(DPTDFN,EGTENR,EGT,DGPAT) ;check for new cont enrollment rules (DG*5.3*672)
"RTN","DGENEGT1",178,0)
 N RTN
"RTN","DGENEGT1",179,0)
 ; If veteran ever had a verified enrollment with SC 10%+ and is now
"RTN","DGENEGT1",180,0)
 ; SC 0% non-compensable then cont. enroll
"RTN","DGENEGT1",181,0)
 I EGTENR("ELIG","VACKAMT")&(EGTENR("ELIG","SCPER")>9)&(DGPAT("SCPER")=0)&(DGPAT("VACKAMT")'>0) Q 1
"RTN","DGENEGT1",182,0)
 ; If veteran ever had a verified enrollment with one of these
"RTN","DGENEGT1",183,0)
 ; eligibilities then cont. enroll:  AA, HB, VA Pension
"RTN","DGENEGT1",184,0)
 I EGTENR("ELIG","VACKAMT")&((EGTENR("ELIG","A&A")="Y")!(EGTENR("ELIG","HB")="Y")!(EGTENR("ELIG","VAPEN")="Y")) Q 1
"RTN","DGENEGT1",185,0)
 ; If AO Exposure Location = Korean DMZ prior to ESR implementation,
"RTN","DGENEGT1",186,0)
 ; then cont. enroll.
"RTN","DGENEGT1",187,0)
 ; **** NOTE: For patch DG*5.3*672 the ESR implementation date will
"RTN","DGENEGT1",188,0)
 ; be set to 12/29/2040.  This will be changed to the actual ESR
"RTN","DGENEGT1",189,0)
 ; implementation date in a later patch.
"RTN","DGENEGT1",190,0)
 ; DG*5.3*688 - Date changed to 10/1/2007
"RTN","DGENEGT1",191,0)
 I DGPAT("AO")="Y" D  I $G(RTN) Q RTN
"RTN","DGENEGT1",192,0)
 .I $S($D(EGTENR("ELIG","AOEXPLOC")):EGTENR("ELIG","AOEXPLOC"),1:DGPAT("AOEXPLOC"))="K",EGTENR("EFFDATE"),EGTENR("EFFDATE")<3090321 S RTN=1
"RTN","DGENEGT1",193,0)
 ; If combat vet end date is before application date, cont. enroll
"RTN","DGENEGT1",194,0)
 I $G(EGTENR("ELIG","CVELEDT"))'<ENRDT Q 1
"RTN","DGENEGT1",195,0)
 ; If veteran is enrolled due to MT status or Medicaid, cont. enroll
"RTN","DGENEGT1",196,0)
 ; UNLESS first verified enrollment record is due to MT status or
"RTN","DGENEGT1",197,0)
 ; Medicaid and the primary MT of that income year was changed to a
"RTN","DGENEGT1",198,0)
 ; status that would not enroll (e.g. due to IVM converted test,
"RTN","DGENEGT1",199,0)
 ; Hardship removal, or Medicaid removal).
"RTN","DGENEGT1",200,0)
 I ((EGTENR("PRIORITY")=7!EGTENR("PRIORITY")=8)&("^2^16^"[(U_EGTENR("ELIG","MTSTA")_U)))!((EGTENR("PRIORITY")=5)&((EGTENR("ELIG","MTSTA")=4)!(EGTENR("ELIG","MEDICAID")=1))) S RTN=1 D  Q RTN
"RTN","DGENEGT1",201,0)
 .N ENIEN,ENR,MTDT,MTIEN
"RTN","DGENEGT1",202,0)
 .S ENIEN=0 F  S ENIEN=$O(^DGEN(27.11,"C",+DPTDFN,ENIEN)) Q:'ENIEN  I $P($G(^DGEN(27.11,+ENIEN,0)),U,4)=2 D  Q
"RTN","DGENEGT1",203,0)
 ..I '$$GET^DGENA(ENIEN,.ENR) Q
"RTN","DGENEGT1",204,0)
 ..I ((ENR("PRIORITY")=7!ENR("PRIORITY")=8)&("^2^16^"[(U_ENR("ELIG","MTSTA")_U)))!((ENR("PRIORITY")=5)&(ENR("ELIG","VAPEN")'="Y")&((ENR("ELIG","MTSTA")=4)!(ENR("ELIG","MEDICAID")=1))) D
"RTN","DGENEGT1",205,0)
 ...S MTDT=$E(ENR("APP"),1,3)_"1231",MTIEN=$$LST^DGMTU(MTDT) Q:'MTIEN
"RTN","DGENEGT1",206,0)
 ...I $P($G(^DGMT(408.31,MTIEN,0)),U,3)=6 S RTN=-1
"RTN","DGENEGT1",207,0)
 Q 0
"RTN","DGENEGT1",208,0)
 ;
"RTN","DGENEGT1",209,0)
EDATE(APP,EFF) ; Compare the Application Date and Effective Date and
"RTN","DGENEGT1",210,0)
 ; return the earlier date
"RTN","DGENEGT1",211,0)
 N EDT
"RTN","DGENEGT1",212,0)
 S APP=$G(APP),EFF=$G(EFF)
"RTN","DGENEGT1",213,0)
 S EDT=APP I 'EDT S EDT=EFF Q EDT
"RTN","DGENEGT1",214,0)
 I EFF S:EFF<EDT EDT=EFF
"RTN","DGENEGT1",215,0)
 Q EDT
"RTN","DGENELA4")
0^1^B63509989^B45731799
"RTN","DGENELA4",1,0)
DGENELA4 ;ALB/CJM,KCL,RTK,LBD,EG,CKN,DLF - Patient Eligibility API ; 6/5/09 11:46am
"RTN","DGENELA4",2,0)
 ;;5.3;Registration;**232,275,306,327,314,367,417,437,456,491,451,564,672,659,653,688,803**;Aug 13,1993;Build 31
"RTN","DGENELA4",3,0)
 ;
"RTN","DGENELA4",4,0)
 ;
"RTN","DGENELA4",5,0)
PRIORITY(DFN,DGELG,DGELGSUB,ENRDATE,APPDATE) ;
"RTN","DGENELA4",6,0)
 ; Description: Used to compute the priority group and subgroup for a
"RTN","DGENELA4",7,0)
 ; patient, also returning the subset of the eligibility data on which 
"RTN","DGENELA4",8,0)
 ; the priority subgroup is based.
"RTN","DGENELA4",9,0)
 ;
"RTN","DGENELA4",10,0)
 ;Input:
"RTN","DGENELA4",11,0)
 ;      DFN - ien of patient
"RTN","DGENELA4",12,0)
 ;    DGELG - ELIGIBILITY object array (optional, pass by reference)
"RTN","DGENELA4",13,0)
 ;  ENRDATE - The Enrollment Date. This date is used in the priority
"RTN","DGENELA4",14,0)
 ;            determination only if the application date is not passed.
"RTN","DGENELA4",15,0)
 ;  APPDATE - The Enrollment Application Date.  This date is used
"RTN","DGENELA4",16,0)
 ;            to determine the priority. If the application date
"RTN","DGENELA4",17,0)
 ;            is not passed then the enrollment date (ENRDATE) is used.
"RTN","DGENELA4",18,0)
 ;
"RTN","DGENELA4",19,0)
 ;Output:
"RTN","DGENELA4",20,0)
 ;  Function Value - returns the priority and subgroup computed by the
"RTN","DGENELA4",21,0)
 ;    function as a 2 piece string 'PRIORITY^SUBGROUP'
"RTN","DGENELA4",22,0)
 ;  DGELGSUB - this local array will contain the eligibility data on
"RTN","DGENELA4",23,0)
 ;    which the priority determination was based, pass by reference
"RTN","DGENELA4",24,0)
 ;    if needed.
"RTN","DGENELA4",25,0)
 ;
"RTN","DGENELA4",26,0)
 N CODE,HICODE,PRI,HIPRI,PRIORITY,SUBGRP,HISUB,SUB,DGPAT
"RTN","DGENELA4",27,0)
 K DGELGSUB S DGELGSUB=""
"RTN","DGENELA4",28,0)
 S (HICODE,HIPRI,SUBGRP,HISUB)=""
"RTN","DGENELA4",29,0)
 D
"RTN","DGENELA4",30,0)
 .I '$D(DGELG),'$$GET^DGENELA(DFN,.DGELG) Q  ;can not proceed with eligibility
"RTN","DGENELA4",31,0)
 .; can't proceed without an Enrollment Date or Application Date
"RTN","DGENELA4",32,0)
 .I '$G(ENRDATE),'$G(APPDATE) Q
"RTN","DGENELA4",33,0)
 .I $$GET^DGENPTA(DFN,.DGPAT)
"RTN","DGENELA4",34,0)
 .; determine priority/subgroup based on primary eligibility
"RTN","DGENELA4",35,0)
 .S HICODE=$$NATCODE^DGENELA(DGELG("ELIG","CODE"))
"RTN","DGENELA4",36,0)
 .S PRIORITY=$$PRI(HICODE,.DGELG,$G(ENRDATE),$G(APPDATE))
"RTN","DGENELA4",37,0)
 .S HIPRI=$P(PRIORITY,"^"),HISUB=$P(PRIORITY,"^",2)
"RTN","DGENELA4",38,0)
 .S CODE=""
"RTN","DGENELA4",39,0)
 .;
"RTN","DGENELA4",40,0)
 .; determine if other eligibilities result in higher priority/subgroup
"RTN","DGENELA4",41,0)
 .F  S CODE=$O(DGELG("ELIG","CODE",CODE)) Q:('CODE!(HIPRI=1))  D
"RTN","DGENELA4",42,0)
 ..S PRIORITY=$$PRI($$NATCODE^DGENELA(CODE),.DGELG,$G(ENRDATE),$G(APPDATE))
"RTN","DGENELA4",43,0)
 ..S PRI=$P(PRIORITY,"^"),SUB=$P(PRIORITY,"^",2)
"RTN","DGENELA4",44,0)
 ..S:((PRI>0)&((PRI<HIPRI)!(HIPRI=""))) HIPRI=PRI,HICODE=$$NATCODE^DGENELA(CODE),HISUB=SUB
"RTN","DGENELA4",45,0)
 ..S:((PRI=HIPRI)&((SUB>0)&(SUB<HISUB))) HIPRI=PRI,HICODE=$$NATCODE^DGENELA(CODE),HISUB=SUB
"RTN","DGENELA4",46,0)
 .;
"RTN","DGENELA4",47,0)
 .;set the DGELGSUB() array with the eligibility information used in the
"RTN","DGENELA4",48,0)
 .;priority determination
"RTN","DGENELA4",49,0)
 .S DGELGSUB("CODE")=HICODE,DGELGSUB("SC")=DGELG("SC"),DGELGSUB("SCPER")=DGELG("SCPER"),DGELGSUB("POW")=DGELG("POW"),DGELGSUB("A&A")=DGELG("A&A"),DGELGSUB("HB")=DGELG("HB")
"RTN","DGENELA4",50,0)
 .S DGELGSUB("VAPEN")=DGELG("VAPEN"),DGELGSUB("VACKAMT")=DGELG("VACKAMT"),DGELGSUB("DISRET")=DGELG("DISRET"),DGELGSUB("DISLOD")=DGELG("DISLOD")
"RTN","DGENELA4",51,0)
 .S DGELGSUB("MEDICAID")=DGELG("MEDICAID"),DGELGSUB("AO")=DGELG("AO"),DGELGSUB("IR")=DGELG("IR"),DGELGSUB("EC")=DGELG("EC"),DGELGSUB("MTSTA")=DGELG("MTSTA")
"RTN","DGENELA4",52,0)
 .;Purple Heart Added to DGELGSUB
"RTN","DGENELA4",53,0)
 .S DGELGSUB("VCD")=DGELG("VCD"),DGELGSUB("PH")=DGELG("PH")
"RTN","DGENELA4",54,0)
 .;Added for HVE Phase III (DG*5.3*564)
"RTN","DGENELA4",55,0)
 .S DGELGSUB("UNEMPLOY")=DGELG("UNEMPLOY"),DGELGSUB("CVELEDT")=DGELG("CVELEDT"),DGELGSUB("SHAD")=DGELG("SHAD")
"RTN","DGENELA4",56,0)
 .;added dg*5.3*659
"RTN","DGENELA4",57,0)
 .S DGELGSUB("RADEXPM")=DGELG("RADEXPM")
"RTN","DGENELA4",58,0)
 .S DGELGSUB("AOEXPLOC")=DGELG("AOEXPLOC")
"RTN","DGENELA4",59,0)
 .I $G(DGPAT("INELDATE"))'="" S (HIPRI,HISUB)=""
"RTN","DGENELA4",60,0)
 ;
"RTN","DGENELA4",61,0)
 Q HIPRI_$S(HIPRI:"^"_HISUB,1:"")
"RTN","DGENELA4",62,0)
 ;
"RTN","DGENELA4",63,0)
 ;
"RTN","DGENELA4",64,0)
PRI(CODE,DGELG,ENRDATE,APPDATE) ;
"RTN","DGENELA4",65,0)
 ; Description: Returns the priority group and subgroup based on a
"RTN","DGENELA4",66,0)
 ; single eligibility code.
"RTN","DGENELA4",67,0)
 ;Input -
"RTN","DGENELA4",68,0)
 ;  CODE - pointer to file #8.1, MAS Eligibility Code
"RTN","DGENELA4",69,0)
 ;  DGELG - local array obtained by calling $$GET, pass by reference
"RTN","DGENELA4",70,0)
 ;  ENRDATE - The Enrollment Date. This date is used in the priority
"RTN","DGENELA4",71,0)
 ;            determination only if the application date is not passed.
"RTN","DGENELA4",72,0)
 ;  APPDATE - The Enrollment Application Date.  This date is used
"RTN","DGENELA4",73,0)
 ;            to determine the priority. If the application date
"RTN","DGENELA4",74,0)
 ;            is not passed then the enrollment date (ENRDATE) is used.
"RTN","DGENELA4",75,0)
 ;
"RTN","DGENELA4",76,0)
 ;Output -
"RTN","DGENELA4",77,0)
 ;  Function Value - returns the priority and subgroup computed by the
"RTN","DGENELA4",78,0)
 ;   function as a 2 piece string 'PRIORITY^SUBGROUP'
"RTN","DGENELA4",79,0)
 ;
"RTN","DGENELA4",80,0)
 N CODENAME,PRIORITY,MTSTA,SUBGRP,DGEGT,PRISUB,DGMTI,MTTHR,GMTTHR
"RTN","DGENELA4",81,0)
 N NODE2,DGNCM,DGNETW,DGMEDEX,DGEDEX,DGASSTS,DGMTYR,MTTEST1,MTTEST2
"RTN","DGENELA4",82,0)
 S SUBGRP=""
"RTN","DGENELA4",83,0)
 ;
"RTN","DGENELA4",84,0)
 ; use the Application Date when determining the priority, otherwise use
"RTN","DGENELA4",85,0)
 ; the Enrollment Date (ESP DG*5,3*491)
"RTN","DGENELA4",86,0)
 S ENRDATE=$S($G(APPDATE):APPDATE,1:$G(ENRDATE))
"RTN","DGENELA4",87,0)
 ;
"RTN","DGENELA4",88,0)
 ;get the name of the national eligibility code
"RTN","DGENELA4",89,0)
 S CODENAME=$$CODENAME^DGENELA(CODE)
"RTN","DGENELA4",90,0)
 ;
"RTN","DGENELA4",91,0)
 ;get the means test code
"RTN","DGENELA4",92,0)
 S MTSTA=""
"RTN","DGENELA4",93,0)
 I DGELG("MTSTA") S MTSTA=$P($G(^DG(408.32,DGELG("MTSTA"),0)),"^",2)
"RTN","DGENELA4",94,0)
 ;
"RTN","DGENELA4",95,0)
 ;get MT and GMT thresholds
"RTN","DGENELA4",96,0)
 S DGMTI=$P($$LST^DGMTU(DFN),"^")
"RTN","DGENELA4",97,0)
 S MTTHR=$$GET1^DIQ(408.31,+DGMTI,.12,"I")
"RTN","DGENELA4",98,0)
 S GMTTHR=$$GET1^DIQ(408.31,+DGMTI,.27,"I")
"RTN","DGENELA4",99,0)
 S DGNCM=$$GET1^DIQ(408.31,+DGMTI,.04,"I")
"RTN","DGENELA4",100,0)
 S DGNETW=$$GET1^DIQ(408.31,+DGMTI,.05,"I")
"RTN","DGENELA4",101,0)
 D ALL^DGMTU21(DFN,"V",DT,"I",+DGMTI)
"RTN","DGENELA4",102,0)
 S DGAICM=0
"RTN","DGENELA4",103,0)
 S:$G(DGINC("V")) DGAICM=+DGINC("V")
"RTN","DGENELA4",104,0)
 S (DGMEDEX,DGEDEX,DGASSTS)=0
"RTN","DGENELA4",105,0)
 S DGMTYR=$$GET1^DIQ(408.21,+DGAICM,.01,"E")
"RTN","DGENELA4",106,0)
 I $D(^DGMT(408.21,DGAICM,2))  D
"RTN","DGENELA4",107,0)
 .S NODE2=^DGMT(408.21,DGAICM,2)
"RTN","DGENELA4",108,0)
 .S DGASSTS=DGASSTS+$P(NODE2,U,1)+$P(NODE2,U,2)+$P(NODE2,U,3)+$P(NODE2,U,4)-$P(NODE2,U,5)
"RTN","DGENELA4",109,0)
 .S DGASSTS=DGASSTS+$P(NODE2,U,6)+$P(NODE2,U,7)+$P(NODE2,U,8)+$P(NODE2,U,9)
"RTN","DGENELA4",110,0)
 S:$D(^DGMT(408.21,DGAICM,1)) DGMEDEX=$P(^DGMT(408.21,DGAICM,1),"^",12)
"RTN","DGENELA4",111,0)
 S:$D(^DGMT(408.21,DGAICM,1)) DGEDEX=$P(^DGMT(408.21,DGAICM,1),"^",3)
"RTN","DGENELA4",112,0)
 ;
"RTN","DGENELA4",113,0)
 ;get the Enrollment Group Threshold (EGT) setting
"RTN","DGENELA4",114,0)
 S DGEGT=""
"RTN","DGENELA4",115,0)
 I $$GET^DGENEGT($$FINDCUR^DGENEGT(),.DGEGT)
"RTN","DGENELA4",116,0)
 I '$G(DGELG("RADEXPM")) S DGELG("RADEXPM")=""
"RTN","DGENELA4",117,0)
 I '$G(DGELG("SHAD")) S DGELG("SHAD")=""
"RTN","DGENELA4",118,0)
 ;
"RTN","DGENELA4",119,0)
 D  ;drops out when priority determined
"RTN","DGENELA4",120,0)
 .S PRIORITY=""
"RTN","DGENELA4",121,0)
 .I ((DGELG("SC")="Y")&(DGELG("SCPER")>49))!(CODENAME="SERVICE CONNECTED 50% to 100%") S PRIORITY=1 Q
"RTN","DGENELA4",122,0)
 .I (DGELG("SC")="Y")&(DGELG("SCPER")>0)&(DGELG("UNEMPLOY")="Y")&(DGELG("VACKAMT")>0)&(DGELG("VAPEN")'="Y")&(DGELG("A&A")'="Y")&(DGELG("HB")'="Y") S PRIORITY=1 Q
"RTN","DGENELA4",123,0)
 .I ((DGELG("SC")="Y")&(DGELG("SCPER")>29)&(CODENAME="SC LESS THAN 50%")) S PRIORITY=2 Q
"RTN","DGENELA4",124,0)
 .I ((DGELG("SC")="Y")&(DGELG("SCPER")>9)&(CODENAME="SC LESS THAN 50%"))!(DGELG("POW")="Y")!(CODENAME="PRISONER OF WAR")!(DGELG("DISRET")=1)!(DGELG("DISLOD")=1)!(CODENAME="PURPLE HEART RECIPIENT")!(DGELG("PH")="Y") S PRIORITY=3 Q
"RTN","DGENELA4",125,0)
 .I (DGELG("A&A")="Y")!(CODENAME="AID & ATTENDANCE")!(DGELG("HB")="Y")!(CODENAME="HOUSEBOUND")!(DGELG("VCD")="Y") S PRIORITY=4 Q
"RTN","DGENELA4",126,0)
 .I (MTSTA="A")!(DGELG("MEDICAID")=1)!(DGELG("VAPEN")="Y")!(CODENAME="NSC, VA PENSION") S PRIORITY=5 Q
"RTN","DGENELA4",127,0)
 .I (CODENAME="WORLD WAR I")!(CODENAME="MEXICAN BORDER WAR")!(DGELG("EC")="Y")!(DGELG("VACKAMT")>0)!((DGELG("CVELEDT"))&(DGELG("CVELEDT")'<DT))!(DGELG("SHAD")=1) S PRIORITY=6 Q
"RTN","DGENELA4",128,0)
 .I DGELG("IR")="Y" I (DGELG("RADEXPM")=2)!(DGELG("RADEXPM")=3)!(DGELG("RADEXPM")=4) S PRIORITY=6 Q
"RTN","DGENELA4",129,0)
 .I (DGELG("AO")="Y"),(DGELG("AOEXPLOC"))="V" S PRIORITY=6 Q
"RTN","DGENELA4",130,0)
 .I (MTSTA="G")!((MTSTA="P")&(GMTTHR>MTTHR)) S PRIORITY=7 D  Q
"RTN","DGENELA4",131,0)
 ..I ((DGELG("SC")="Y")&(DGELG("SCPER")=0)&(DGELG("VACKAMT")<1)&(CODENAME="SC LESS THAN 50%")) S SUBGRP=$$SUBPRI(DFN,.PRIORITY,1) Q
"RTN","DGENELA4",132,0)
 ..S SUBGRP=$$SUBPRI(DFN,.PRIORITY,3)
"RTN","DGENELA4",133,0)
 .S MTTEST1=MTTHR
"RTN","DGENELA4",134,0)
 .I GMTTHR>MTTHR S MTTEST1=GMTTHR
"RTN","DGENELA4",135,0)
 .S MTTEST2=MTTEST1+(MTTEST1*0.10)+0.01 ; Add 10% to the test threshold
"RTN","DGENELA4",136,0)
 .I $$SC^DGMTR(DFN),DGMTYR>2007,DGNCM>MTTEST1,MTTEST2>DGNCM,ENRDATE>3090614 S PRIORITY=8,SUBGRP=$$SUBPRI(DFN,.PRIORITY,2) Q
"RTN","DGENELA4",137,0)
 .I $$SC^DGMTR(DFN),DGMTYR>2007,(DGNCM-DGMEDEX-DGEDEX)<MTTHR,DGNCM+DGNETW>79999.99 S PRIORITY=8,SUBGRP=$$SUBPRI(DFN,.PRIORITY,2) Q
"RTN","DGENELA4",138,0)
 .I DGELG("SC")="N",DGMTYR>2007,DGNCM>MTTEST1,MTTEST2>DGNCM,ENRDATE>3090614 S PRIORITY=8,SUBGRP=$$SUBPRI(DFN,.PRIORITY,4) Q
"RTN","DGENELA4",139,0)
 .I DGELG("SC")="N",DGMTYR>2007,(DGNCM-DGMEDEX-DGEDEX)<MTTHR,DGNCM+DGNETW>79999.99 S PRIORITY=8,SUBGRP=$$SUBPRI(DFN,.PRIORITY,4) Q
"RTN","DGENELA4",140,0)
 .I ((DGELG("SC")="Y")&(DGELG("SCPER")=0)&(DGELG("VACKAMT")<1)&(CODENAME="SC LESS THAN 50%")) S PRIORITY=8,SUBGRP=$$SUBPRI(DFN,.PRIORITY,1) Q
"RTN","DGENELA4",141,0)
 .I ((MTSTA="C")!(MTSTA="P")) S PRIORITY=8,SUBGRP=$$SUBPRI(DFN,PRIORITY,3) Q
"RTN","DGENELA4",142,0)
 ;
"RTN","DGENELA4",143,0)
 Q PRIORITY_$S(PRIORITY:"^"_SUBGRP,1:"")
"RTN","DGENELA4",144,0)
 ;
"RTN","DGENELA4",145,0)
SUBPRI(DFN,PRIORITY,SUBGRP) ;calculate sub-priority if under EGT
"RTN","DGENELA4",146,0)
 ;
"RTN","DGENELA4",147,0)
 N PRVPRI,DONE,PRVENST,ENRDT,DGENRIEN,EGT,DGENRC,TODAY,X
"RTN","DGENELA4",148,0)
 Q:'$G(DFN)
"RTN","DGENELA4",149,0)
 S U="^"
"RTN","DGENELA4",150,0)
 S:$G(PRIORITY)="" PRIORITY=""
"RTN","DGENELA4",151,0)
 S:$G(SUBGRP)="" SUBGRP=""
"RTN","DGENELA4",152,0)
 D NOW^%DTC S TODAY=X
"RTN","DGENELA4",153,0)
 Q:'$$GET^DGENEGT($$FINDCUR^DGENEGT(),.EGT) SUBGRP  ;EGT isn't set
"RTN","DGENELA4",154,0)
 Q:TODAY<EGT("EFFDATE") SUBGRP  ;EGT is not in effect
"RTN","DGENELA4",155,0)
 I "^1^3^"[(U_EGT("TYPE")_U) Q SUBGRP
"RTN","DGENELA4",156,0)
 I EGT("TYPE")=2,(PRIORITY+(SUBGRP*.01))<(EGT("PRIORITY")+(EGT("SUBGRP")*.01)) Q SUBGRP
"RTN","DGENELA4",157,0)
 I EGT("TYPE")=4 Q:(PRIORITY<EGT("PRIORITY")) SUBGRP  Q:(PRIORITY>EGT("PRIORITY")) $$SUBCNV(SUBGRP)
"RTN","DGENELA4",158,0)
 ;I $G(ENRDATE) Q:$$ABOVE2^DGENEGT1(ENRDATE,PRIORITY,SUBGRP) SUBGRP
"RTN","DGENELA4",159,0)
 S DGENRIEN=$$FINDCUR^DGENA(DFN)
"RTN","DGENELA4",160,0)
 I 'DGENRIEN,$G(ENRDATE),ENRDATE<EGT("EFFDATE") Q SUBGRP
"RTN","DGENELA4",161,0)
 S DONE=0
"RTN","DGENELA4",162,0)
 F  Q:DONE  D
"RTN","DGENELA4",163,0)
 .I 'DGENRIEN S DONE=2 Q
"RTN","DGENELA4",164,0)
 .I '$$GET^DGENA(DGENRIEN,.DGENRC) S DONE=2 Q
"RTN","DGENELA4",165,0)
 .S DGENRIEN=$$FINDPRI^DGENA(DGENRIEN)
"RTN","DGENELA4",166,0)
 .Q:DGENRC("STATUS")=6   ;deceased
"RTN","DGENELA4",167,0)
 .I $P($G(^DGEN(27.15,+DGENRC("STATUS"),0)),"^",2)="N" S DONE=2 Q
"RTN","DGENELA4",168,0)
 .S ENRDT=$G(DGENRC("APP")) S:'ENRDT ENRDT=$G(DGENRC("EFFDATE"))
"RTN","DGENELA4",169,0)
 .I ENRDT,ENRDT<EGT("EFFDATE") S DONE=1 Q
"RTN","DGENELA4",170,0)
 .; HEC is the authoritative source on continuous enrollment
"RTN","DGENELA4",171,0)
 .I $$OVRRIDE^DGENEGT1(DFN,.EGT) S DONE=1
"RTN","DGENELA4",172,0)
 ;
"RTN","DGENELA4",173,0)
 Q $S(DONE=2:$$SUBCNV(SUBGRP),1:SUBGRP)
"RTN","DGENELA4",174,0)
 ;
"RTN","DGENELA4",175,0)
SUBCNV(SUBGRP) ;return new subgrp
"RTN","DGENELA4",176,0)
 I SUBGRP=1 Q 5
"RTN","DGENELA4",177,0)
 I SUBGRP=3 Q 7
"RTN","DGENELA4",178,0)
 Q SUBGRP
"VER")
8.0^22.0
"^DD",27.11,27.11,.12,0)
ENROLLMENT SUBGROUP^S^1:a;2:b;3:c;4:d;5:e;7:g;^0;12^Q
"^DD",27.11,27.11,.12,1,0)
^.1
"^DD",27.11,27.11,.12,1,1,0)
27.11^AENR12^MUMPS
"^DD",27.11,27.11,.12,1,1,1)
D E2711^DGRTRIG(DA)
"^DD",27.11,27.11,.12,1,1,2)
D E2711^DGRTRIG(DA)
"^DD",27.11,27.11,.12,1,1,3)
 DO NOT DELETE
"^DD",27.11,27.11,.12,1,1,"%D",0)
^.101^2^2^3050913^^^^
"^DD",27.11,27.11,.12,1,1,"%D",1,0)
This cross-reference is used to notify HEC of changes that may affect
"^DD",27.11,27.11,.12,1,1,"%D",2,0)
enrollment.
"^DD",27.11,27.11,.12,1,1,"DT")
3050913
"^DD",27.11,27.11,.12,3)
Enter the enrollment priority subgroup determined for this patient.
"^DD",27.11,27.11,.12,21,0)
^.001^1^1^3090126^^^^
"^DD",27.11,27.11,.12,21,1,0)
This field will contain the enrollment priority subgroup determined for this enrollment.
"^DD",27.11,27.11,.12,"DT")
3090126
"^DD",27.16,27.16,.03,0)
EGT SUBGROUP^SI^1:a;3:c;4:d;^0;3^Q
"^DD",27.16,27.16,.03,3)
Enter the enrollment priority subgroup threshold.
"^DD",27.16,27.16,.03,21,0)
^.001^1^1^3090126^^^^
"^DD",27.16,27.16,.03,21,1,0)
This field will contain the enrollment priority subgroup threshold.
"^DD",27.16,27.16,.03,"DT")
3090126
"BLD",7200,6)
^710
**END**
**END**
