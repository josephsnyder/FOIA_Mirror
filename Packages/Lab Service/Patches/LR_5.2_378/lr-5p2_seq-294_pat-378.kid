Released LR*5.2*378 SEQ #294
Extracted from mail message
**KIDS**:LR*5.2*378^

**INSTALL NAME**
LR*5.2*378
"BLD",7622,0)
LR*5.2*378^LAB SERVICE^0^3080115^y
"BLD",7622,1,0)
^^6^6^3080115^
"BLD",7622,1,1,0)
 
"BLD",7622,1,2,0)
 
"BLD",7622,1,3,0)
 
"BLD",7622,1,4,0)
This patch corrects a problem with the Labserver reports
"BLD",7622,1,5,0)
whereby the reports are held up because the subject line 
"BLD",7622,1,6,0)
in the MailMan message is too long (greater than 65 characters).
"BLD",7622,4,0)
^9.64PA^^
"BLD",7622,6.3)
1
"BLD",7622,"ABPKG")
n
"BLD",7622,"KRN",0)
^9.67PA^8989.52^19
"BLD",7622,"KRN",.4,0)
.4
"BLD",7622,"KRN",.401,0)
.401
"BLD",7622,"KRN",.402,0)
.402
"BLD",7622,"KRN",.403,0)
.403
"BLD",7622,"KRN",.5,0)
.5
"BLD",7622,"KRN",.84,0)
.84
"BLD",7622,"KRN",3.6,0)
3.6
"BLD",7622,"KRN",3.8,0)
3.8
"BLD",7622,"KRN",9.2,0)
9.2
"BLD",7622,"KRN",9.8,0)
9.8
"BLD",7622,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",7622,"KRN",9.8,"NM",1,0)
LRSRVR6^^0^B25829656
"BLD",7622,"KRN",9.8,"NM","B","LRSRVR6",1)

"BLD",7622,"KRN",19,0)
19
"BLD",7622,"KRN",19.1,0)
19.1
"BLD",7622,"KRN",101,0)
101
"BLD",7622,"KRN",409.61,0)
409.61
"BLD",7622,"KRN",771,0)
771
"BLD",7622,"KRN",870,0)
870
"BLD",7622,"KRN",8989.51,0)
8989.51
"BLD",7622,"KRN",8989.52,0)
8989.52
"BLD",7622,"KRN",8994,0)
8994
"BLD",7622,"KRN","B",.4,.4)

"BLD",7622,"KRN","B",.401,.401)

"BLD",7622,"KRN","B",.402,.402)

"BLD",7622,"KRN","B",.403,.403)

"BLD",7622,"KRN","B",.5,.5)

"BLD",7622,"KRN","B",.84,.84)

"BLD",7622,"KRN","B",3.6,3.6)

"BLD",7622,"KRN","B",3.8,3.8)

"BLD",7622,"KRN","B",9.2,9.2)

"BLD",7622,"KRN","B",9.8,9.8)

"BLD",7622,"KRN","B",19,19)

"BLD",7622,"KRN","B",19.1,19.1)

"BLD",7622,"KRN","B",101,101)

"BLD",7622,"KRN","B",409.61,409.61)

"BLD",7622,"KRN","B",771,771)

"BLD",7622,"KRN","B",870,870)

"BLD",7622,"KRN","B",8989.51,8989.51)

"BLD",7622,"KRN","B",8989.52,8989.52)

"BLD",7622,"KRN","B",8994,8994)

"BLD",7622,"QUES",0)
^9.62^^
"BLD",7622,"REQB",0)
^9.611^1^1
"BLD",7622,"REQB",1,0)
LR*5.2*346^2
"BLD",7622,"REQB","B","LR*5.2*346",1)

"MBREQ")
0
"PKG",26,-1)
1^1
"PKG",26,0)
LAB SERVICE^LR^CORE LAB SYSTEM
"PKG",26,20,0)
^9.402P^1^1
"PKG",26,20,1,0)
2^^LRXDRPT
"PKG",26,20,1,1)

"PKG",26,20,"B",2,1)

"PKG",26,22,0)
^9.49I^1^1
"PKG",26,22,1,0)
5.2^2940927^2950304
"PKG",26,22,1,"PAH",1,0)
378^3080115
"PKG",26,22,1,"PAH",1,1,0)
^^6^6^3080115
"PKG",26,22,1,"PAH",1,1,1,0)
 
"PKG",26,22,1,"PAH",1,1,2,0)
 
"PKG",26,22,1,"PAH",1,1,3,0)
 
"PKG",26,22,1,"PAH",1,1,4,0)
This patch corrects a problem with the Labserver reports
"PKG",26,22,1,"PAH",1,1,5,0)
whereby the reports are held up because the subject line 
"PKG",26,22,1,"PAH",1,1,6,0)
in the MailMan message is too long (greater than 65 characters).
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","LRSRVR6")
0^1^B25829656^B25592719
"RTN","LRSRVR6",1,0)
LRSRVR6 ;DALIO/JMC - LAB DATA SERVER CONT'D SNOMED EXTRACT ;Aug 17, 2006
"RTN","LRSRVR6",2,0)
 ;;5.2;LAB SERVICE;**346,378**;Sep 27, 1994;Build 1
"RTN","LRSRVR6",3,0)
 ; Produces SNOMED extract via LRLABSERVER option
"RTN","LRSRVR6",4,0)
 ;
"RTN","LRSRVR6",5,0)
 Q
"RTN","LRSRVR6",6,0)
 ;
"RTN","LRSRVR6",7,0)
 ;
"RTN","LRSRVR6",8,0)
SERVER ; Server entry Point
"RTN","LRSRVR6",9,0)
 N I,LRCNT,LREND,LRL,LRMSUBJ,LRST,LRSTN,LRTXT,LRX,LRY
"RTN","LRSRVR6",10,0)
 D BUILD
"RTN","LRSRVR6",11,0)
 S LRMSUBJ=LRST_" "_LRSTN_" SNOMED EXTRACT "_$$HTE^XLFDT($H,"1M")
"RTN","LRSRVR6",12,0)
 D MAILSEND(LRMSUBJ)
"RTN","LRSRVR6",13,0)
 D CLEAN
"RTN","LRSRVR6",14,0)
 Q
"RTN","LRSRVR6",15,0)
 ;
"RTN","LRSRVR6",16,0)
 ;
"RTN","LRSRVR6",17,0)
BUILD ; Build extract
"RTN","LRSRVR6",18,0)
 N J,LRCNT,LRCRLF,LRETIME,LRFN,LRLEX,LRNAME,LRQUIT,LRROOT,LRSCT,LRSCTEC,LRSCTVER,LRSCTX,LRSPEC,LRSTIME,LRSTR,LRVAL,LRVUID,LRX,LRY,X,Y
"RTN","LRSRVR6",19,0)
 ;
"RTN","LRSRVR6",20,0)
 S LRSTIME=$$NOW^XLFDT,LRVAL=$$SITE^VASITE,LRST=$P(LRVAL,"^",3),LRSTN=$P(LRVAL,"^",2),LRSCTVER=""
"RTN","LRSRVR6",21,0)
 I LRST="" S LRST="???"
"RTN","LRSRVR6",22,0)
 K ^TMP($J,"LRDATA")
"RTN","LRSRVR6",23,0)
 S (LRCNT,LRCNT("SCT"))=0,LRCRLF=$C(13,10),LRSTR=""
"RTN","LRSRVR6",24,0)
 F I=61,61.1,61.2,61.3,61.4,61.5,61.6,62 S LRCNT(I)=0,LRCNT(I,"SCT")=0
"RTN","LRSRVR6",25,0)
 D HDR
"RTN","LRSRVR6",26,0)
 ;
"RTN","LRSRVR6",27,0)
 ; Flag to indicate if SNOMED CT is available from LEXICON.
"RTN","LRSRVR6",28,0)
 S LRLEX=0
"RTN","LRSRVR6",29,0)
 I $T(CODE^LEXTRAN)'="" S LRLEX=1
"RTN","LRSRVR6",30,0)
 ;
"RTN","LRSRVR6",31,0)
 F LRFN=61,61.1,61.2,61.3,61.4,61.5,61.6,62  D
"RTN","LRSRVR6",32,0)
 . S LRROOT="^LAB("_LRFN_",""B"")"
"RTN","LRSRVR6",33,0)
 . D FILE
"RTN","LRSRVR6",34,0)
 ;
"RTN","LRSRVR6",35,0)
 S LRETIME=$$NOW^XLFDT
"RTN","LRSRVR6",36,0)
 ; Set the final info into the ^TMP message global
"RTN","LRSRVR6",37,0)
 S LRNODE=$O(^TMP($J,"LRDATA",""),-1)
"RTN","LRSRVR6",38,0)
 I LRSTR'="" S LRNODE=LRNODE+1,^TMP($J,"LRDATA",LRNODE)=$$UUEN^LRSRVR4(LRSTR)
"RTN","LRSRVR6",39,0)
 S ^TMP($J,"LRDATA",LRNODE+1)=" "
"RTN","LRSRVR6",40,0)
 S ^TMP($J,"LRDATA",LRNODE+2)="end"
"RTN","LRSRVR6",41,0)
 ;
"RTN","LRSRVR6",42,0)
 S ^TMP($J,"LRDATA",1)=^TMP($J,"LRDATA",1)_" (Run time:"_$$FMDIFF^XLFDT(LRETIME,LRSTIME,3)_")"
"RTN","LRSRVR6",43,0)
 S ^TMP($J,"LRDATA",3)="SNOMED CT version......: "_LRSCTVER
"RTN","LRSRVR6",44,0)
 S J=6
"RTN","LRSRVR6",45,0)
 S ^TMP($J,"LRDATA",J)="Number of records per file:"
"RTN","LRSRVR6",46,0)
 F I=61,61.1,61.2,61.3,61.4,61.5,61.6,62 D
"RTN","LRSRVR6",47,0)
 . S J=J+1
"RTN","LRSRVR6",48,0)
 . S ^TMP($J,"LRDATA",J)=" "_$$LJ^XLFSTR($$GET1^DID(I,"","","NAME")_" File (#"_I_")",32,".")_": "_$J(LRCNT(I),5)_"  ("_LRCNT(I,"SCT")_" mapped)"
"RTN","LRSRVR6",49,0)
 S ^TMP($J,"LRDATA",J+1)=$$LJ^XLFSTR("Total number of records",33,".")_": "_$J(LRCNT,5)_"  ("_LRCNT("SCT")_" mapped)"
"RTN","LRSRVR6",50,0)
 ;
"RTN","LRSRVR6",51,0)
 Q
"RTN","LRSRVR6",52,0)
 ;
"RTN","LRSRVR6",53,0)
 ;
"RTN","LRSRVR6",54,0)
CLEAN ;
"RTN","LRSRVR6",55,0)
 K ^TMP($J,"LR61")
"RTN","LRSRVR6",56,0)
 K LRIEN,LRLEN,LRNODE,LRSNM,LRSPECN
"RTN","LRSRVR6",57,0)
 D CLEAN^LRSRVR
"RTN","LRSRVR6",58,0)
 D ^%ZISC
"RTN","LRSRVR6",59,0)
 Q
"RTN","LRSRVR6",60,0)
 ;
"RTN","LRSRVR6",61,0)
 ;
"RTN","LRSRVR6",62,0)
FILE ; Search file entry and build record.
"RTN","LRSRVR6",63,0)
 ;
"RTN","LRSRVR6",64,0)
 F  S LRROOT=$Q(@LRROOT) Q:LRROOT=""  Q:$QS(LRROOT,2)'="B"  D
"RTN","LRSRVR6",65,0)
 . Q:$G(@LRROOT)
"RTN","LRSRVR6",66,0)
 . S LRIEN=$QS(LRROOT,4),LRSPEC=""
"RTN","LRSRVR6",67,0)
 . S LRNAME=$P($G(^LAB(LRFN,LRIEN,0)),"^"),LRNAME=$$TRIM^XLFSTR(LRNAME,"RL"," ")
"RTN","LRSRVR6",68,0)
 . S X=$P($G(^LAB(LRFN,LRIEN,0)),"^",2)
"RTN","LRSRVR6",69,0)
 . S LRSNM=$S(LRFN'=62:X,1:"")
"RTN","LRSRVR6",70,0)
 . I LRFN=62 S LRSPEC=X
"RTN","LRSRVR6",71,0)
 . I LRSNM'="",LRFN>60.9,LRFN<61.61 S LRX=((LRFN*10)#610)+1,LRSNM=$E("TMEFDPJ",LRX)_"-"_LRSNM
"RTN","LRSRVR6",72,0)
 . S LRSCT=$P($G(^LAB(LRFN,LRIEN,"SCT")),"^"),(LRSCTEC,LRSCTX,LRVUID)=""
"RTN","LRSRVR6",73,0)
 . I LRLEX,LRSCT'="" D
"RTN","LRSRVR6",74,0)
 . . K LRX
"RTN","LRSRVR6",75,0)
 . . S LRX=$$CODE^LEXTRAN(LRSCT,"SCT",DT,"LRX")
"RTN","LRSRVR6",76,0)
 . . S LRSCTX=$G(LRX("F")),LRSCTEC=$S(LRX<1:$P(LRX,"^",2),1:"")
"RTN","LRSRVR6",77,0)
 . . I LRSCTVER="",LRX>0 S LRSCTVER=$P($G(LRX(0)),"^",3)
"RTN","LRSRVR6",78,0)
 . S LRSTR=LRSTR_LRST_"-"_LRFN_"-"_LRIEN_"|"_LRNAME_"|"_LRSNM_"|"_LRVUID_"|"_LRSCT_"|"_LRSCTX_"|"_LRSCTEC_"|"
"RTN","LRSRVR6",79,0)
 . S LRSPECN="|"
"RTN","LRSRVR6",80,0)
 . I LRFN=62,LRSPEC D
"RTN","LRSRVR6",81,0)
 . . S LRSPECN=$P($G(^LAB(61,LRSPEC,0)),"^")
"RTN","LRSRVR6",82,0)
 . . S LRSPECN=LRSPECN_"|"_LRST_"-61-"_LRSPEC
"RTN","LRSRVR6",83,0)
 . S LRSTR=LRSTR_LRSPECN_"|1.1|"
"RTN","LRSRVR6",84,0)
 . S LRCNT=LRCNT+1,LRCNT(LRFN)=LRCNT(LRFN)+1 S:LRSCT LRCNT("SCT")=LRCNT("SCT")+1,LRCNT(LRFN,"SCT")=LRCNT(LRFN,"SCT")+1
"RTN","LRSRVR6",85,0)
 . D SETDATA
"RTN","LRSRVR6",86,0)
 Q
"RTN","LRSRVR6",87,0)
 ;
"RTN","LRSRVR6",88,0)
 ;
"RTN","LRSRVR6",89,0)
SETDATA ; Set data into report structure
"RTN","LRSRVR6",90,0)
 S LRSTR=LRSTR_LRCRLF
"RTN","LRSRVR6",91,0)
 S LRNODE=$O(^TMP($J,"LRDATA",""),-1)
"RTN","LRSRVR6",92,0)
 D ENCODE^LRSRVR4(.LRSTR)
"RTN","LRSRVR6",93,0)
 Q
"RTN","LRSRVR6",94,0)
 ;
"RTN","LRSRVR6",95,0)
 ;
"RTN","LRSRVR6",96,0)
HDR ; Set the header information
"RTN","LRSRVR6",97,0)
 N LRFILENM
"RTN","LRSRVR6",98,0)
 S LRFILENM=$TR(LRSTN," ","_")_"-"_LRSUB_"-"_$P($$FMTHL7^XLFDT(LRSTIME),"-")_".TXT"
"RTN","LRSRVR6",99,0)
 S ^TMP($J,"LRDATA",1)="Report Generated.......: "_$$FMTE^XLFDT(LRSTIME)_" at "_LRSTN
"RTN","LRSRVR6",100,0)
 S ^TMP($J,"LRDATA",2)="Report requested.......: "_LRSUB
"RTN","LRSRVR6",101,0)
 S ^TMP($J,"LRDATA",3)="SNOMED CT version......: "
"RTN","LRSRVR6",102,0)
 S ^TMP($J,"LRDATA",4)="Extract version........: 1.1"
"RTN","LRSRVR6",103,0)
 F I=5,15,16,18,23 S ^TMP($J,"LRDATA",I)=" "
"RTN","LRSRVR6",104,0)
 S ^TMP($J,"LRDATA",17)="Attached file..........: "_LRFILENM
"RTN","LRSRVR6",105,0)
 S ^TMP($J,"LRDATA",19)="Legend:"
"RTN","LRSRVR6",106,0)
 S X="Station #-File #-IEN|Entry Name|SNOMED I|VUID|SNOMED CT|SNOMED CT TERM|Mapping Exception|Related Specimen|Related Specimen ID|Extract Ver|"
"RTN","LRSRVR6",107,0)
 S ^TMP($J,"LRDATA",20)=X
"RTN","LRSRVR6",108,0)
 S X="           1        |     2    |   3    |  4 |    5    |       6      |        7        |        8       |        9          |    10     |"
"RTN","LRSRVR6",109,0)
 S ^TMP($J,"LRDATA",21)=X
"RTN","LRSRVR6",110,0)
 S ^TMP($J,"LRDATA",22)=$$REPEAT^XLFSTR("-",$L(X))
"RTN","LRSRVR6",111,0)
 S ^TMP($J,"LRDATA",24)=$$UUBEGFN^LRSRVR2A(LRFILENM)
"RTN","LRSRVR6",112,0)
 Q
"RTN","LRSRVR6",113,0)
 ;
"RTN","LRSRVR6",114,0)
 ;
"RTN","LRSRVR6",115,0)
MAILSEND(LRMSUBJ) ; Send extract back to requestor.
"RTN","LRSRVR6",116,0)
 ;
"RTN","LRSRVR6",117,0)
 N LRINSTR,LRTASK,LRTO,XMERR,XMZ
"RTN","LRSRVR6",118,0)
 S LRTO(XQSND)=""
"RTN","LRSRVR6",119,0)
 S LRINSTR("ADDR FLAGS")="R"
"RTN","LRSRVR6",120,0)
 S LRINSTR("FROM")="LAB_PACKAGE"
"RTN","LRSRVR6",121,0)
 S LRMSUBJ=$E(LRMSUBJ,1,65)
"RTN","LRSRVR6",122,0)
 D SENDMSG^XMXAPI(.5,LRMSUBJ,"^TMP($J,""LRDATA"")",.LRTO,.LRINSTR,.LRTASK)
"RTN","LRSRVR6",123,0)
 Q
"VER")
8.0^22.0
"BLD",7622,6)
^294
**END**
**END**
