Released LR*5.2*416 SEQ #345
Extracted from mail message
**KIDS**:LR*5.2*416^

**INSTALL NAME**
LR*5.2*416
"BLD",8938,0)
LR*5.2*416^LAB SERVICE^0^3130916^y
"BLD",8938,1,0)
^^11^11^3130916^^^^
"BLD",8938,1,1,0)
This patch is a VM patch that addresses 3 issues in the Lab package.
"BLD",8938,1,2,0)
 
"BLD",8938,1,3,0)
1.  Option LRCENLKUP (Review By Order Number) gives misleading
"BLD",8938,1,4,0)
    information when 1 sample of a multi-sample order is not
"BLD",8938,1,5,0)
    collected.
"BLD",8938,1,6,0)
 
"BLD",8938,1,7,0)
2.  The option LRAPFICH (Print final path reports by accession number)
"BLD",8938,1,8,0)
    prints the wrong year on the SNOMED CODE LISTING which is printed
"BLD",8938,1,9,0)
    at the end of the pathology report for some AP accessions.
"BLD",8938,1,10,0)
 
"BLD",8938,1,11,0)
3.  Autopsy reports not viewable in CPRS.
"BLD",8938,4,0)
^9.64PA^^
"BLD",8938,6)
2^
"BLD",8938,6.3)
4
"BLD",8938,"ABPKG")
n
"BLD",8938,"KRN",0)
^9.67PA^779.2^20
"BLD",8938,"KRN",.4,0)
.4
"BLD",8938,"KRN",.401,0)
.401
"BLD",8938,"KRN",.402,0)
.402
"BLD",8938,"KRN",.403,0)
.403
"BLD",8938,"KRN",.5,0)
.5
"BLD",8938,"KRN",.84,0)
.84
"BLD",8938,"KRN",3.6,0)
3.6
"BLD",8938,"KRN",3.8,0)
3.8
"BLD",8938,"KRN",9.2,0)
9.2
"BLD",8938,"KRN",9.8,0)
9.8
"BLD",8938,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",8938,"KRN",9.8,"NM",1,0)
LRCE^^0^B67329261
"BLD",8938,"KRN",9.8,"NM",2,0)
LRSPRPT^^0^B65490213
"BLD",8938,"KRN",9.8,"NM",3,0)
LRSPRPTM^^0^B2545240
"BLD",8938,"KRN",9.8,"NM",4,0)
LRAPBR4^^0^B44190167
"BLD",8938,"KRN",9.8,"NM","B","LRAPBR4",4)

"BLD",8938,"KRN",9.8,"NM","B","LRCE",1)

"BLD",8938,"KRN",9.8,"NM","B","LRSPRPT",2)

"BLD",8938,"KRN",9.8,"NM","B","LRSPRPTM",3)

"BLD",8938,"KRN",19,0)
19
"BLD",8938,"KRN",19,"NM",0)
^9.68A^^
"BLD",8938,"KRN",19.1,0)
19.1
"BLD",8938,"KRN",101,0)
101
"BLD",8938,"KRN",409.61,0)
409.61
"BLD",8938,"KRN",771,0)
771
"BLD",8938,"KRN",779.2,0)
779.2
"BLD",8938,"KRN",870,0)
870
"BLD",8938,"KRN",8989.51,0)
8989.51
"BLD",8938,"KRN",8989.52,0)
8989.52
"BLD",8938,"KRN",8994,0)
8994
"BLD",8938,"KRN","B",.4,.4)

"BLD",8938,"KRN","B",.401,.401)

"BLD",8938,"KRN","B",.402,.402)

"BLD",8938,"KRN","B",.403,.403)

"BLD",8938,"KRN","B",.5,.5)

"BLD",8938,"KRN","B",.84,.84)

"BLD",8938,"KRN","B",3.6,3.6)

"BLD",8938,"KRN","B",3.8,3.8)

"BLD",8938,"KRN","B",9.2,9.2)

"BLD",8938,"KRN","B",9.8,9.8)

"BLD",8938,"KRN","B",19,19)

"BLD",8938,"KRN","B",19.1,19.1)

"BLD",8938,"KRN","B",101,101)

"BLD",8938,"KRN","B",409.61,409.61)

"BLD",8938,"KRN","B",771,771)

"BLD",8938,"KRN","B",779.2,779.2)

"BLD",8938,"KRN","B",870,870)

"BLD",8938,"KRN","B",8989.51,8989.51)

"BLD",8938,"KRN","B",8989.52,8989.52)

"BLD",8938,"KRN","B",8994,8994)

"BLD",8938,"QUES",0)
^9.62^^
"BLD",8938,"REQB",0)
^9.611^1^1
"BLD",8938,"REQB",1,0)
LR*5.2*350^2
"BLD",8938,"REQB","B","LR*5.2*350",1)

"MBREQ")
0
"PKG",26,-1)
1^1
"PKG",26,0)
LAB SERVICE^LR^CORE LAB SYSTEM
"PKG",26,20,0)
^9.402P^1^1
"PKG",26,20,1,0)
2^^LRXDRPT
"PKG",26,20,1,1)

"PKG",26,20,"B",2,1)

"PKG",26,22,0)
^9.49I^1^1
"PKG",26,22,1,0)
5.2^2940927^2950304
"PKG",26,22,1,"PAH",1,0)
416^3130916^33274
"PKG",26,22,1,"PAH",1,1,0)
^^11^11^3130916
"PKG",26,22,1,"PAH",1,1,1,0)
This patch is a VM patch that addresses 3 issues in the Lab package.
"PKG",26,22,1,"PAH",1,1,2,0)
 
"PKG",26,22,1,"PAH",1,1,3,0)
1.  Option LRCENLKUP (Review By Order Number) gives misleading
"PKG",26,22,1,"PAH",1,1,4,0)
    information when 1 sample of a multi-sample order is not
"PKG",26,22,1,"PAH",1,1,5,0)
    collected.
"PKG",26,22,1,"PAH",1,1,6,0)
 
"PKG",26,22,1,"PAH",1,1,7,0)
2.  The option LRAPFICH (Print final path reports by accession number)
"PKG",26,22,1,"PAH",1,1,8,0)
    prints the wrong year on the SNOMED CODE LISTING which is printed
"PKG",26,22,1,"PAH",1,1,9,0)
    at the end of the pathology report for some AP accessions.
"PKG",26,22,1,"PAH",1,1,10,0)
 
"PKG",26,22,1,"PAH",1,1,11,0)
3.  Autopsy reports not viewable in CPRS.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","LRAPBR4")
0^4^B44190167^B44175433
"RTN","LRAPBR4",1,0)
LRAPBR4 ;DALOI/STAFF - Autopsy Browser Display ;04/06/10  15:52
"RTN","LRAPBR4",2,0)
 ;;5.2;LAB SERVICE;**259,317,350,416**;Sep 27, 1994;Build 4
"RTN","LRAPBR4",3,0)
 ;
"RTN","LRAPBR4",4,0)
 ; Reference to ^DPT supported by IA #918
"RTN","LRAPBR4",5,0)
 ;
"RTN","LRAPBR4",6,0)
 Q
"RTN","LRAPBR4",7,0)
 ;
"RTN","LRAPBR4",8,0)
ENTER ; Entry point
"RTN","LRAPBR4",9,0)
 N LRTEXT,LRFILE,LRFIELD,LRTMP,LRFLG
"RTN","LRAPBR4",10,0)
 D INIT
"RTN","LRAPBR4",11,0)
 Q:'$D(^LR(LRDFN,LRSS))
"RTN","LRAPBR4",12,0)
 D HEADER
"RTN","LRAPBR4",13,0)
 D BODY
"RTN","LRAPBR4",14,0)
 D:'LRTIU POW
"RTN","LRAPBR4",15,0)
 D:LRTIU ESIGLN^LRAPBR1
"RTN","LRAPBR4",16,0)
 D FOOTER
"RTN","LRAPBR4",17,0)
 Q
"RTN","LRAPBR4",18,0)
 ;
"RTN","LRAPBR4",19,0)
 ;
"RTN","LRAPBR4",20,0)
INIT ; Initialize variables
"RTN","LRAPBR4",21,0)
 S X=^LR(LRDFN,0) D ^LRUP
"RTN","LRAPBR4",22,0)
 Q:'$D(^LR(LRDFN,LRSS))
"RTN","LRAPBR4",23,0)
 F LRTMP=1:1 D  Q:LRFIELD="Q"
"RTN","LRAPBR4",24,0)
 . S X=$T(VART1+LRTMP)
"RTN","LRAPBR4",25,0)
 . S LRFIELD=$P(X,";",2),VAR=$P(X,";",3),LRFLG=$P(X,";",4)
"RTN","LRAPBR4",26,0)
 . Q:LRFIELD="Q"
"RTN","LRAPBR4",27,0)
 . S @VAR=$$GET1^DIQ(63,LRDFN_",",LRFIELD,LRFLG)
"RTN","LRAPBR4",28,0)
 . I VAR["LRM",@VAR S X=@VAR D D^LRUA S @VAR=X
"RTN","LRAPBR4",29,0)
 S LRH(2)=$E(LRH(2),2,3)
"RTN","LRAPBR4",30,0)
 ;
"RTN","LRAPBR4",31,0)
 ; Get date of death (LRH)
"RTN","LRAPBR4",32,0)
 S DA=LRDFN D D^LRAUAW
"RTN","LRAPBR4",33,0)
 S Y=LR(63,12) D D^LRU S LRH=Y
"RTN","LRAPBR4",34,0)
 ;
"RTN","LRAPBR4",35,0)
 S LCT=0
"RTN","LRAPBR4",36,0)
 S:'LRTIU GROOT="^TMP(""LRAPBR"",$J,"
"RTN","LRAPBR4",37,0)
 S:LRTIU GROOT="^TMP(""TIUP"",$J,"
"RTN","LRAPBR4",38,0)
 K ^TMP("LRAPBR",$J)
"RTN","LRAPBR4",39,0)
 ;
"RTN","LRAPBR4",40,0)
 ; If reporting lab available then use instead of VistA site name.
"RTN","LRAPBR4",41,0)
 S LRX=$P($G(^LR(LRDFN,"AU")),"^",18)
"RTN","LRAPBR4",42,0)
 I LRX S LRQ(1)=$$NAME^XUAF4(LRX)
"RTN","LRAPBR4",43,0)
 ;
"RTN","LRAPBR4",44,0)
 Q
"RTN","LRAPBR4",45,0)
 ;
"RTN","LRAPBR4",46,0)
 ;
"RTN","LRAPBR4",47,0)
BODY ; Report body
"RTN","LRAPBR4",48,0)
 D:LRTIU GLENTRY("$TEXT",,1)
"RTN","LRAPBR4",49,0)
 S LR("F")=1
"RTN","LRAPBR4",50,0)
 I LRH(1)="" D
"RTN","LRAPBR4",51,0)
 . D GLENTRY("+*+* REPORT INCOMPLETE *+*+",20,1)
"RTN","LRAPBR4",52,0)
 . D GLENTRY(,,1)
"RTN","LRAPBR4",53,0)
 D MODAUCK
"RTN","LRAPBR4",54,0)
 ; Display supplementary report header if one or more has been added
"RTN","LRAPBR4",55,0)
 I $P($G(^LR(LRDFN,84,0)),U,4) D
"RTN","LRAPBR4",56,0)
 . S LRTEXT="*+* SUPPLEMENTARY REPORT HAS BEEN ADDED *+*"
"RTN","LRAPBR4",57,0)
 . S LRTEXT=$$CJ^XLFSTR(LRTEXT,IOM)
"RTN","LRAPBR4",58,0)
 . D GLENTRY(LRTEXT,,1)
"RTN","LRAPBR4",59,0)
 . S LRTEXT="*+* REFER TO BOTTOM OF REPORT *+*"
"RTN","LRAPBR4",60,0)
 . S LRTEXT=$$CJ^XLFSTR(LRTEXT,IOM)
"RTN","LRAPBR4",61,0)
 . D GLENTRY(LRTEXT,,1)
"RTN","LRAPBR4",62,0)
 D GLENTRY(,,1)
"RTN","LRAPBR4",63,0)
 F LRV=81,82,84 D
"RTN","LRAPBR4",64,0)
 . D:LRV'=84 GLENTRY(,,1)
"RTN","LRAPBR4",65,0)
 . D:LRV=81 GLENTRY(LRAU(1),0)
"RTN","LRAPBR4",66,0)
 . D:LRV=82 GLENTRY(LRAU(2),0)
"RTN","LRAPBR4",67,0)
 . I LRV'=84 D
"RTN","LRAPBR4",68,0)
 . . D GLENTRY(,,1)
"RTN","LRAPBR4",69,0)
 . . S LRFILE=63,LRIENS=LRDFN_","
"RTN","LRAPBR4",70,0)
 . . S LRFIELD=$S(LRV=81:32.2,1:32.3)
"RTN","LRAPBR4",71,0)
 . . D WP
"RTN","LRAPBR4",72,0)
 . I LRV=84 D
"RTN","LRAPBR4",73,0)
 . . N LRIENS1,LRIENS
"RTN","LRAPBR4",74,0)
 . . S LRFILE=63.324
"RTN","LRAPBR4",75,0)
 .  . S LRA=0 F  S LRA=$O(^LR(LRDFN,84,LRA)) Q:'LRA  D
"RTN","LRAPBR4",76,0)
 . . . S LRIENS1=LRA_","_LRDFN_","
"RTN","LRAPBR4",77,0)
 . . . D GLENTRY("SUPPLEMENTARY REPORT DATE: ",0,1)
"RTN","LRAPBR4",78,0)
 . . . S LRB=$$GET1^DIQ(LRFILE,LRIENS1,.01)
"RTN","LRAPBR4",79,0)
 . . . D GLENTRY(LRB,BTAB)
"RTN","LRAPBR4",80,0)
 . . . D:$P($G(^LR(LRDFN,84,LRA,2,0)),U,4) SUPA
"RTN","LRAPBR4",81,0)
 . . . S LRFIELD=1,LRIENS=LRIENS1 D WP
"RTN","LRAPBR4",82,0)
 . . . D GLENTRY(,,1)
"RTN","LRAPBR4",83,0)
 . I LRV'=84 D DASH,GLENTRY(,,1)
"RTN","LRAPBR4",84,0)
 D ^LRAPBR5
"RTN","LRAPBR4",85,0)
 Q
"RTN","LRAPBR4",86,0)
 ;
"RTN","LRAPBR4",87,0)
 ;
"RTN","LRAPBR4",88,0)
WP ; Display word procesing fields
"RTN","LRAPBR4",89,0)
 K LRTMP,^UTILITY($J,"W")
"RTN","LRAPBR4",90,0)
 N LRX,DIWR,DIWL,LRA1
"RTN","LRAPBR4",91,0)
 S LRX=$$GET1^DIQ(LRFILE,LRIENS,LRFIELD,"","LRTMP","LRERR(1)")
"RTN","LRAPBR4",92,0)
 S DIWR=IOM-5,DIWL=5,DIWF=""
"RTN","LRAPBR4",93,0)
 S LRX=+$$GET1^DID(LRFILE,LRFIELD,"","SPECIFIER","LRERR(2)")
"RTN","LRAPBR4",94,0)
 I $$GET1^DID(LRX,.01,"","SPECIFIER","LRERR(2)")["L" S DIWF="N"
"RTN","LRAPBR4",95,0)
 S LRA1=0 F  S LRA1=$O(LRTMP(LRA1)) Q:'LRA1  S X=LRTMP(LRA1) D ^DIWP
"RTN","LRAPBR4",96,0)
 S LRA1=0 F  S LRA1=$O(^UTILITY($J,"W",DIWL,LRA1)) Q:'LRA1  D
"RTN","LRAPBR4",97,0)
 .D GLENTRY(^UTILITY($J,"W",DIWL,LRA1,0),DIWL,1)
"RTN","LRAPBR4",98,0)
 K ^UTILITY($J,"W")
"RTN","LRAPBR4",99,0)
 Q
"RTN","LRAPBR4",100,0)
 ;
"RTN","LRAPBR4",101,0)
 ;
"RTN","LRAPBR4",102,0)
SUPA ; Print supplementary report audit information
"RTN","LRAPBR4",103,0)
 N LRFILE,LRIENS1,LRWP
"RTN","LRAPBR4",104,0)
 S LRTEXT="*+* SUPPLEMENTARY REPORT HAS BEEN ADDED/MODIFIED *+*"
"RTN","LRAPBR4",105,0)
 S LRTEXT=$$CJ^XLFSTR(LRTEXT,IOM)
"RTN","LRAPBR4",106,0)
 D GLENTRY(LRTEXT,,1)
"RTN","LRAPBR4",107,0)
 S LRTEXT="(Added/Last" D GLENTRY(LRTEXT,0,1)
"RTN","LRAPBR4",108,0)
 S (A,B)=0 F  S A=$O(^LR(LRDFN,84,LRA,2,A)) Q:'A  D
"RTN","LRAPBR4",109,0)
 .S B=A
"RTN","LRAPBR4",110,0)
 Q:'$D(^LR(LRDFN,84,LRA,2,B,0))
"RTN","LRAPBR4",111,0)
 S A=^(0),Y=+A,LRSGN=" typed by ",LRDSC=" modified: ",A2=$P(A,"^",2)
"RTN","LRAPBR4",112,0)
 ;If supp rpt is released, display 'signed by' instead of 'typed by'
"RTN","LRAPBR4",113,0)
 I $P(A,"^",3) S LRSGN=" signed by ",LRDSC=" released: ",A2=$P(A,"^",3),Y=$P(A,"^",4)
"RTN","LRAPBR4",114,0)
 S A2=$S($D(^VA(200,A2,0)):$P(^(0),"^"),1:A2)
"RTN","LRAPBR4",115,0)
 ;S LRFILE=63.3242,LRIENS1=B_","_LRA_","_LRDFN_","
"RTN","LRAPBR4",116,0)
 ;D GETS^DIQ(LRFILE,LRIENS1,"*","","LRWP")
"RTN","LRAPBR4",117,0)
 ;S Y=LRWP(LRFILE,LRIENS1,.01)
"RTN","LRAPBR4",118,0)
 ;S A=LRWP(LRFILE,LRIENS1,.02)
"RTN","LRAPBR4",119,0)
 D D^LRU
"RTN","LRAPBR4",120,0)
 S LRTEXT=LRDSC_Y_LRSGN_A2_")" D GLENTRY(LRTEXT,BTAB)
"RTN","LRAPBR4",121,0)
 Q
"RTN","LRAPBR4",122,0)
 ;
"RTN","LRAPBR4",123,0)
 ;
"RTN","LRAPBR4",124,0)
HEADER ;
"RTN","LRAPBR4",125,0)
 S LRQ=LRQ+1
"RTN","LRAPBR4",126,0)
 D:LRTIU GLENTRY("$APHDR",,1)
"RTN","LRAPBR4",127,0)
 F I=1:1:2 D GLENTRY(,,1)
"RTN","LRAPBR4",128,0)
 ;
"RTN","LRAPBR4",129,0)
 ; Print names of facilities printing/releasing this report.
"RTN","LRAPBR4",130,0)
 N LRN,LRPL,LRRL,LRX
"RTN","LRAPBR4",131,0)
 I $$GET^XPAR("DIV^PKG","LR REPORTS FACILITY PRINT",1,"Q")>1,'LRTIU D
"RTN","LRAPBR4",132,0)
 . D PFAC^LRRP1(DUZ(2),"",1,.LRPL)
"RTN","LRAPBR4",133,0)
 . S LRN=0
"RTN","LRAPBR4",134,0)
 . F  S LRN=$O(LRPL(LRN)) Q:'LRN  D GLENTRY(LRPL(LRN),"",1)
"RTN","LRAPBR4",135,0)
 ;
"RTN","LRAPBR4",136,0)
 ; Display reporting lab
"RTN","LRAPBR4",137,0)
 I $$GET^XPAR("DIV^PKG","LR REPORTS FACILITY PRINT",1,"Q")#2 D
"RTN","LRAPBR4",138,0)
 . S LRX=+$P($G(^LR(LRDFN,"AU")),"^",18)
"RTN","LRAPBR4",139,0)
 . I LRX<1 Q
"RTN","LRAPBR4",140,0)
 . D RL^LRRP1(LRX,1,.LRRL),GLENTRY("","",1)
"RTN","LRAPBR4",141,0)
 . S LRN=0
"RTN","LRAPBR4",142,0)
 . F  S LRN=$O(LRRL(LRN)) Q:'LRN  D GLENTRY(LRRL(LRN),"",1)
"RTN","LRAPBR4",143,0)
 ;
"RTN","LRAPBR4",144,0)
 D DASH
"RTN","LRAPBR4",145,0)
 S LRTEXT="CLINICAL RECORD |" D GLENTRY(LRTEXT,5,1)
"RTN","LRAPBR4",146,0)
 S LRTEXT="AUTOPSY PROTOCOL" D GLENTRY(LRTEXT,40)
"RTN","LRAPBR4",147,0)
 D DASH
"RTN","LRAPBR4",148,0)
 S LRTEXT="Date died: "_LRH D GLENTRY(LRTEXT,0,1)
"RTN","LRAPBR4",149,0)
 S LRTEXT="| Autopsy date: "_LRH(1) D GLENTRY(LRTEXT,40)
"RTN","LRAPBR4",150,0)
 S LRTEXT="Resident: "_LRM(2) D GLENTRY(LRTEXT,0,1)
"RTN","LRAPBR4",151,0)
 S LRTEXT="| "_$E(LRS(3),1,13) D GLENTRY(LRTEXT,40)
"RTN","LRAPBR4",152,0)
 S LRTEXT="Autopsy No. "_$S(LRQ(8)'="":LRQ(8)_LRH(2)_" "_LRAC,1:LRAC)
"RTN","LRAPBR4",153,0)
 D GLENTRY(LRTEXT,56)
"RTN","LRAPBR4",154,0)
 D DASH
"RTN","LRAPBR4",155,0)
 Q
"RTN","LRAPBR4",156,0)
 ;
"RTN","LRAPBR4",157,0)
 ;
"RTN","LRAPBR4",158,0)
MODAUCK ; Display modified banner if required
"RTN","LRAPBR4",159,0)
 S LRAPMR=$$GET1^DIQ(63,LRDFN,102,"I")
"RTN","LRAPBR4",160,0)
 Q:'LRAPMR
"RTN","LRAPBR4",161,0)
 S LRAPMD=$$GET1^DIQ(63,LRDFN,102.2,"I")
"RTN","LRAPBR4",162,0)
 D GLENTRY("","",1)
"RTN","LRAPBR4",163,0)
 S LRTEXT=""
"RTN","LRAPBR4",164,0)
 F LRCNT=1:1:$S(LRAPMD:14,1:15) D
"RTN","LRAPBR4",165,0)
 .S LRTEXT=LRTEXT_"*+"
"RTN","LRAPBR4",166,0)
 S LRTEXT=LRTEXT_" MODIFIED "
"RTN","LRAPBR4",167,0)
 S LRTEXT=LRTEXT_$S(LRAPMD:"DIAGNOSIS ",1:"REPORT ")
"RTN","LRAPBR4",168,0)
 F LRCNT=1:1:$S(LRAPMD:14,1:15) D
"RTN","LRAPBR4",169,0)
 .S LRTEXT=LRTEXT_"*+"
"RTN","LRAPBR4",170,0)
 D GLENTRY(LRTEXT,"",1)
"RTN","LRAPBR4",171,0)
 D GLENTRY("","",1)
"RTN","LRAPBR4",172,0)
 Q
"RTN","LRAPBR4",173,0)
 ;
"RTN","LRAPBR4",174,0)
 ;
"RTN","LRAPBR4",175,0)
POW ; Determine POW or Persian Gulf status
"RTN","LRAPBR4",176,0)
 I $P($G(^LR(LRDFN,0)),"^",2)=2 D
"RTN","LRAPBR4",177,0)
 .S LRPOW=0
"RTN","LRAPBR4",178,0)
 .I $D(^DPT(DFN,.52)) S:$P(^(.52),U,5)="Y" LRPOW=1
"RTN","LRAPBR4",179,0)
 .I $D(^DPT(DFN,.322)) S:$P($G(^(.322)),"^",10)="Y" LRPOW=1
"RTN","LRAPBR4",180,0)
 .D ^LRAPBRPW
"RTN","LRAPBR4",181,0)
 .K LRPOW
"RTN","LRAPBR4",182,0)
 Q
"RTN","LRAPBR4",183,0)
 ;
"RTN","LRAPBR4",184,0)
 ;
"RTN","LRAPBR4",185,0)
FOOTER ; Report footer
"RTN","LRAPBR4",186,0)
 D:LRTIU GLENTRY("$FTR",,1)
"RTN","LRAPBR4",187,0)
 D DASH
"RTN","LRAPBR4",188,0)
 D GLENTRY(,,1)
"RTN","LRAPBR4",189,0)
 I LRH(3)=""&(LRH(17)'="") D
"RTN","LRAPBR4",190,0)
 . S LRTEXT="| Provisional Anatomic Dx"
"RTN","LRAPBR4",191,0)
 . D GLENTRY(LRTEXT,55)
"RTN","LRAPBR4",192,0)
 S LRTEXT="Pathologist: "_LRM(3) D GLENTRY(LRTEXT,0,1)
"RTN","LRAPBR4",193,0)
 D GLENTRY(LRW(9),52)
"RTN","LRAPBR4",194,0)
 S LRTEXT="| Date " D GLENTRY(LRTEXT,55)
"RTN","LRAPBR4",195,0)
 S LRTEXT=$E($S(LRH(3)'="":LRH(3),1:LRH(17)),1,12) D GLENTRY(LRTEXT,BTAB)
"RTN","LRAPBR4",196,0)
 D DASH
"RTN","LRAPBR4",197,0)
 S LRTEXT=$E(LRQ(1),1,IOM-20) D GLENTRY(LRTEXT,0,1)
"RTN","LRAPBR4",198,0)
 S LRTEXT="AUTOPSY PROTOCOL" D GLENTRY(LRTEXT,IOM-17)
"RTN","LRAPBR4",199,0)
 S LRTEXT="Patient: "_$E(LRP,1,30) D GLENTRY(LRTEXT,0,1)
"RTN","LRAPBR4",200,0)
 D GLENTRY(SSN,43),GLENTRY("SEX:"_SEX,56),GLENTRY("DOB:"_DOB,63)
"RTN","LRAPBR4",201,0)
 D GLENTRY($E(LRLLOC,1,22),0,1)
"RTN","LRAPBR4",202,0)
 S LRTEXT="Physician: "_$E(LRM(1),1,28) D GLENTRY(LRTEXT,23)
"RTN","LRAPBR4",203,0)
 S LRTEXT="AGE AT DEATH:"_$J(AGE,3) D GLENTRY(LRTEXT,63)
"RTN","LRAPBR4",204,0)
 Q
"RTN","LRAPBR4",205,0)
 ;
"RTN","LRAPBR4",206,0)
 ;
"RTN","LRAPBR4",207,0)
DASH ;
"RTN","LRAPBR4",208,0)
 D GLENTRY(LR("%"),0,1)
"RTN","LRAPBR4",209,0)
 Q
"RTN","LRAPBR4",210,0)
 ;
"RTN","LRAPBR4",211,0)
 ;
"RTN","LRAPBR4",212,0)
GLENTRY(LRPR1,LRPR2,LRPR3) ; Write to global
"RTN","LRAPBR4",213,0)
 ; LRPR1 = Text to be written to global
"RTN","LRAPBR4",214,0)
 ; LRPR2 = Tab position
"RTN","LRAPBR4",215,0)
 ; LRPR3 = 1 means start a new line.  Othewise, write on current line.
"RTN","LRAPBR4",216,0)
 S LRPR1=$G(LRPR1),LRPR2=+$G(LRPR2),LRPR3=+$G(LRPR3)
"RTN","LRAPBR4",217,0)
 D:LRPR3 NEWLN^LRAPUTL(LRPR1,LRPR2)
"RTN","LRAPBR4",218,0)
 D:'LRPR3 GLBWRT^LRAPUTL(LRPR1,LRPR2)
"RTN","LRAPBR4",219,0)
 Q
"RTN","LRAPBR4",220,0)
 ;
"RTN","LRAPBR4",221,0)
 ;
"RTN","LRAPBR4",222,0)
VART1 ;Setup variables
"RTN","LRAPBR4",223,0)
 ;14;LRAC;I;AUTOPSY ACCESSION #
"RTN","LRAPBR4",224,0)
 ;13.5;LRM(2);I;RESIDENT PATHOLOGIST
"RTN","LRAPBR4",225,0)
 ;12.1;LRM(1);I;PHYSICIAN
"RTN","LRAPBR4",226,0)
 ;13.01;LRW(9);I;AUTOPSY TYPIST
"RTN","LRAPBR4",227,0)
 ;13.6;LRM(3);I;SENIOR PATHOLOGIST
"RTN","LRAPBR4",228,0)
 ;11;LRH(1);;AUTOPSY DATE/TIME
"RTN","LRAPBR4",229,0)
 ;11;LRH(2);I;AUTOPSY DATE/TIME 2 DIGIT YEAR
"RTN","LRAPBR4",230,0)
 ;13;LRH(3);;DATE AUTOPSY REPORT COMPLETED
"RTN","LRAPBR4",231,0)
 ;14.9;LRH(17);;PROVISIONAL ANAT DX DATE
"RTN","LRAPBR4",232,0)
 ;14.1;LRLLOC;I;LOCATION
"RTN","LRAPBR4",233,0)
 ;12.5;AGE;I;AGE AT DEATH
"RTN","LRAPBR4",234,0)
 ;14.5;LRSVC;;SERVICE
"RTN","LRAPBR4",235,0)
 ;13.7;LRS(3);;AUTOPSY TYPE
"RTN","LRAPBR4",236,0)
 ;Q
"RTN","LRCE")
0^1^B67329261^B66243304
"RTN","LRCE",1,0)
LRCE ;DALOI/JMC - LOOK-UP ON CENTRAL ENTRY # ;03/24/11  17:32
"RTN","LRCE",2,0)
 ;;5.2;LAB SERVICE;**28,76,103,121,153,210,202,263,350,416**;Sep 27, 1994;Build 4
"RTN","LRCE",3,0)
 ;
"RTN","LRCE",4,0)
EN ;
"RTN","LRCE",5,0)
 S (LRSTOP,LRFLAG1,LRFLG,LRSN1,LRNOP)=0
"RTN","LRCE",6,0)
 K DIRUT,SSN,LRORD
"RTN","LRCE",7,0)
 W !!
"RTN","LRCE",8,0)
 S DIR("A")="Order Number or UID: ",DIR(0)="FOA"
"RTN","LRCE",9,0)
 S DIR("?",1)="Enter a whole number for the order number, enter the universal identifier"
"RTN","LRCE",10,0)
 S DIR("?",2)="(UID), or press Return to find the order number by Patient.",DIR("?")="Enter '^' to Exit."
"RTN","LRCE",11,0)
 D ^DIR
"RTN","LRCE",12,0)
 I $G(SSN)&(Y="") G END
"RTN","LRCE",13,0)
 I Y="" D ^LROS G:'$G(SSN) END G EN
"RTN","LRCE",14,0)
NEXT I $D(DIRUT) G END
"RTN","LRCE",15,0)
 D UNIV
"RTN","LRCE",16,0)
 S LRORD=+Y
"RTN","LRCE",17,0)
 I LRORD?.AP!(LRORD<1) D  G EN
"RTN","LRCE",18,0)
 . W !,"Enter a whole number for the order number."
"RTN","LRCE",19,0)
 S LRORD=+LRORD
"RTN","LRCE",20,0)
 K DIR,X,Y,DIRUT
"RTN","LRCE",21,0)
 IF $O(^LRO(69,"C",LRORD,0))<1 W "  NUMBER NOT FOUND" G LRCE
"RTN","LRCE",22,0)
DIS ;
"RTN","LRCE",23,0)
 W @IOF
"RTN","LRCE",24,0)
 I $D(LRADDTST) D
"RTN","LRCE",25,0)
 . W !!?15,"LISTING OF DATES "
"RTN","LRCE",26,0)
 . S (CNT,LRODT)=0
"RTN","LRCE",27,0)
 . F A=0:0 S LRODT=$O(^LRO(69,"C",LRORD,LRODT)) Q:LRODT=""  D
"RTN","LRCE",28,0)
 .. D CHKPAGE Q:$G(LRSTOP)
"RTN","LRCE",29,0)
 .. S CNT=CNT+1
"RTN","LRCE",30,0)
 .. W !?5,CNT,?10,$$FMTE^XLFDT(LRODT,"5FM")
"RTN","LRCE",31,0)
 Q:$G(LRSTOP)  K CNT,A
"RTN","LRCE",32,0)
 S LRODT=0
"RTN","LRCE",33,0)
 F  S LRODT=$O(^LRO(69,"C",LRORD,LRODT)) Q:LRODT<1!($G(LRSTOP))  D  I $D(LRADDTST),+LRADDTST Q
"RTN","LRCE",34,0)
 . D LR2
"RTN","LRCE",35,0)
 I $D(LRADDTST) G LRCE:LRADDTST="" G END
"RTN","LRCE",36,0)
 I '$D(LRADDTST) G EN
"RTN","LRCE",37,0)
 Q
"RTN","LRCE",38,0)
 ;
"RTN","LRCE",39,0)
 ;
"RTN","LRCE",40,0)
ADDTST ;
"RTN","LRCE",41,0)
 S LRADDTST="" D EN
"RTN","LRCE",42,0)
 S LRRSTAT=160
"RTN","LRCE",43,0)
 I LRADDTST  D ^LRORD
"RTN","LRCE",44,0)
 D END,ADDEND
"RTN","LRCE",45,0)
 Q
"RTN","LRCE",46,0)
 ;
"RTN","LRCE",47,0)
 ;
"RTN","LRCE",48,0)
ADDEND ;
"RTN","LRCE",49,0)
 K LRCLCTR,LRCLST,LRDFN,LRDPF,LRDRWTM,LRFLAG1,LRFLG
"RTN","LRCE",50,0)
 K LRLLOC,LRLOC,LRODT,LROLLOC,LRORDRR,LRPRAC,LRRB
"RTN","LRCE",51,0)
 K LRRSITE,LRSD,LRDN,LRSTOP,LRTREA,LRSN,LRTSN,LRTSP,PNM,SSN,DOB,SEX
"RTN","LRCE",52,0)
 K TYPE,LRRSTAT,LRNOP,LRSN1
"RTN","LRCE",53,0)
 K X,Y,I
"RTN","LRCE",54,0)
 Q
"RTN","LRCE",55,0)
 ;
"RTN","LRCE",56,0)
 ;
"RTN","LRCE",57,0)
LR2 ;
"RTN","LRCE",58,0)
 Q:$G(LRSTOP)
"RTN","LRCE",59,0)
 D CHKPAGE
"RTN","LRCE",60,0)
 Q:$G(LRSTOP)
"RTN","LRCE",61,0)
 S LRSN=0
"RTN","LRCE",62,0)
 F  S LRSN=+$O(^LRO(69,"C",+$G(LRORD),+$G(LRODT),LRSN)) Q:LRSN<1!($G(LRSTOP))  D PT I $D(LRADDTST),+LRADDTST Q
"RTN","LRCE",63,0)
 Q
"RTN","LRCE",64,0)
 ;
"RTN","LRCE",65,0)
 ;
"RTN","LRCE",66,0)
UNIV ; see if entry is UID
"RTN","LRCE",67,0)
 N LRAA,LRAD,LRAN I $D(^LRO(68,"C",X)) S LRAA=$O(^LRO(68,"C",X,0)) I LRAA S LRAD=$O(^LRO(68,"C",X,LRAA,0)) I LRAD S LRAN=$O(^LRO(68,"C",X,LRAA,LRAD,0)) I LRAN S Y=$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,.1)),"^")
"RTN","LRCE",68,0)
 Q
"RTN","LRCE",69,0)
 ;
"RTN","LRCE",70,0)
 ;
"RTN","LRCE",71,0)
CHKPAGE ;
"RTN","LRCE",72,0)
 Q:$G(LRSTOP)
"RTN","LRCE",73,0)
 Q:$Y<(IOSL-2)
"RTN","LRCE",74,0)
 K DIR
"RTN","LRCE",75,0)
 S DIR(0)="E"
"RTN","LRCE",76,0)
 D ^DIR
"RTN","LRCE",77,0)
 I $D(DUOUT)!($D(DIRUT)) S LRSTOP=1 Q
"RTN","LRCE",78,0)
 W @IOF
"RTN","LRCE",79,0)
 W !
"RTN","LRCE",80,0)
 Q
"RTN","LRCE",81,0)
 ;
"RTN","LRCE",82,0)
 ;
"RTN","LRCE",83,0)
PT ;
"RTN","LRCE",84,0)
 D CHKPAGE
"RTN","LRCE",85,0)
 Q:$G(LRSTOP)!($G(LRFLG))
"RTN","LRCE",86,0)
 S LROR=$S($D(^LRO(69,LRODT,1,LRSN,0)):^(0),1:-1)
"RTN","LRCE",87,0)
 S LRDFN=+LROR
"RTN","LRCE",88,0)
 I LRDFN<1 W "  NO PATIENT" Q
"RTN","LRCE",89,0)
 S LRWHOE=+$P(LROR,U,2)
"RTN","LRCE",90,0)
 S LRWHOE=$S($D(^VA(200,LRWHOE,0)):$P(^(0),U),1:"")
"RTN","LRCE",91,0)
 S LRDPF=$P(^LR(LRDFN,0),U,2),DFN=$P(^(0),U,3)
"RTN","LRCE",92,0)
 D PT^LRX
"RTN","LRCE",93,0)
 H 1
"RTN","LRCE",94,0)
HEAD ;
"RTN","LRCE",95,0)
 D CHKPAGE
"RTN","LRCE",96,0)
 Q:$G(LRSTOP)
"RTN","LRCE",97,0)
 W !!,"ORDER #: ",LRORD,?20,"PAT: ",PNM,"    SSN: ",SSN,!
"RTN","LRCE",98,0)
 D CHKPAGE
"RTN","LRCE",99,0)
 Q:$G(LRSTOP)
"RTN","LRCE",100,0)
 D LRGLIN^LRX
"RTN","LRCE",101,0)
 W !
"RTN","LRCE",102,0)
 S LRCTYP=$P(LROR,U,4)
"RTN","LRCE",103,0)
 I (LRWHOE'="")!(LRCTYP'="") D
"RTN","LRCE",104,0)
 . I LRWHOE'="" W "WHO ENTERED: ",$E(LRWHOE,1,25) K LRWHOE
"RTN","LRCE",105,0)
 . W:LRCTYP'="" ?40,"TYPE OF COLLECTION: ",LRCTYP
"RTN","LRCE",106,0)
 I $D(^LRO(69,LRODT,1,LRSN,1)) D
"RTN","LRCE",107,0)
 . S LRCLCTR=$P(^LRO(69,LRODT,1,LRSN,1),U,3),LRCLST=$P(^(1),U,4)
"RTN","LRCE",108,0)
 . S:LRCLCTR'="" LRCLCTR=$P($G(^VA(200,+LRCLCTR,0)),U)
"RTN","LRCE",109,0)
 . W ! D CHKPAGE Q:$G(LRSTOP)
"RTN","LRCE",110,0)
 . W:LRCLCTR'="" "  COLLECTOR : ",$E(LRCLCTR,1,25)
"RTN","LRCE",111,0)
 . W:LRCLST'="" ?40,"COLLECTION STATUS: ",LRCLST
"RTN","LRCE",112,0)
 Q:$G(LRSTOP)
"RTN","LRCE",113,0)
 ;
"RTN","LRCE",114,0)
 S LRDRWTM=$S($D(^LRO(69,LRODT,1,LRSN,1)):+^(1),1:"")
"RTN","LRCE",115,0)
 S:LRDRWTM LRDRWTM=$$FMTE^XLFDT(LRDRWTM,"ZM")
"RTN","LRCE",116,0)
 S LRLOC=+$P(LROR,U,9),LRLOC=$P($G(^SC(LRLOC,0)),U)
"RTN","LRCE",117,0)
 I (LRDRWTM'="")!(LRLOC'="") D
"RTN","LRCE",118,0)
 . W ! D CHKPAGE Q:$G(LRSTOP)
"RTN","LRCE",119,0)
 . W:LRDRWTM'="" "  DRAW TIME:   ",LRDRWTM
"RTN","LRCE",120,0)
 . I LRDRWTM="",$P(LROR,"^",8) W "TO BE DRAWN:   ",$$FMTE^XLFDT($P(LROR,U,8),"ZM")
"RTN","LRCE",121,0)
 . W:LRLOC'="" ?40,"ORDERING LOCATION: ",$E(LRLOC,1,20)
"RTN","LRCE",122,0)
 Q:$G(LRSTOP)
"RTN","LRCE",123,0)
 ;
"RTN","LRCE",124,0)
 W ! D CHKPAGE Q:$G(LRSTOP)
"RTN","LRCE",125,0)
 I $G(^LRO(69,LRODT,1,LRSN,3)) W "  LAB ARRIVAL: ",$$FMTE^XLFDT(+$G(^(3)),"ZM")
"RTN","LRCE",126,0)
 I LRDPF=2 W:LRWRD'="" ?40,"WARD: ",LRWRD
"RTN","LRCE",127,0)
 W:$P(LROR,U,3) !,"  SPECIMEN: " D CHKPAGE Q:$G(LRSTOP)
"RTN","LRCE",128,0)
 W:$P(LROR,U,3) $S($D(^LAB(62,$P(LROR,U,3),0)):$P(^(0),U),1:"??")
"RTN","LRCE",129,0)
 S L=+$P(^LRO(69,LRODT,1,LRSN,0),U,6) I L D
"RTN","LRCE",130,0)
 . S LRMD=$S($D(^VA(200,L,0)):$P(^(0),U),1:L)
"RTN","LRCE",131,0)
 . W ?40,"PROVIDER: ",$E(LRMD,1,30)
"RTN","LRCE",132,0)
 W:$G(^LRO(69,LRODT,1,LRSN,"PCE")) !,?5,"Visit Number(s): ",$G(^("PCE"))
"RTN","LRCE",133,0)
 ;
"RTN","LRCE",134,0)
 S I=0
"RTN","LRCE",135,0)
TST D CHKPAGE
"RTN","LRCE",136,0)
 Q:$G(LRSTOP)
"RTN","LRCE",137,0)
 F  S I=$O(^LRO(69,LRODT,1,LRSN,2,I)) Q:I<1  D
"RTN","LRCE",138,0)
 . D CHKPAGE Q:$G(LRSTOP)
"RTN","LRCE",139,0)
 . S LRNOPMSG=0
"RTN","LRCE",140,0)
 . D TEST D CHKPAGE Q:$G(LRSTOP)
"RTN","LRCE",141,0)
 D CHKPAGE
"RTN","LRCE",142,0)
 Q:$G(LRSTOP)
"RTN","LRCE",143,0)
 I $D(^LRO(69,LRODT,1,LRSN,1)),$L($P(^(1),U,6)) D
"RTN","LRCE",144,0)
 . W !,"COMMENT: ",$P(^LRO(69,LRODT,1,LRSN,1),U,6) D CHKPAGE Q:$G(LRSTOP)
"RTN","LRCE",145,0)
 S I=0
"RTN","LRCE",146,0)
 F  S I=$O(^LRO(69,LRODT,1,LRSN,6,I)) Q:I<1  W !,?3,^(I,0) D CHKPAGE Q:$G(LRSTOP)
"RTN","LRCE",147,0)
 Q:$G(LRSTOP)
"RTN","LRCE",148,0)
NXT S X=$P($G(^LRO(69,LRODT,1,LRSN,1)),U,4)
"RTN","LRCE",149,0)
 I X="C"!($G(LRNOPMSG)) W !,"Order has already been accessioned."
"RTN","LRCE",150,0)
 I LRNOP,'$D(LRLABKY) D  Q
"RTN","LRCE",151,0)
 . I $G(LRNOPMSG) W !,"Tests have been accessioned, call the lab to add tests to the same order."
"RTN","LRCE",152,0)
 I '$D(LRADDTST) Q
"RTN","LRCE",153,0)
 I X="M" W !?5,"This Order was Merged " Q
"RTN","LRCE",154,0)
 I '$G(LRRSTAT) S LRRSTAT=160
"RTN","LRCE",155,0)
SEL W !,"Is this the one"
"RTN","LRCE",156,0)
 S %=1,LRNOP=0 K LRORDRR,LRRSITE,LRSD,LRTSP
"RTN","LRCE",157,0)
 D YN^DICN
"RTN","LRCE",158,0)
 I %'=1 S (LRFLG1,LRNOP)=0 Q
"RTN","LRCE",159,0)
 S LRADDTST=$S(%=1:LRORD,1:"")
"RTN","LRCE",160,0)
 Q:$G(LRSTOP)!('$G(LRADDTST))
"RTN","LRCE",161,0)
 I %=1 D
"RTN","LRCE",162,0)
 . N X,X0,I,DIC,DA
"RTN","LRCE",163,0)
 . S X0=^LRO(69,LRODT,1,LRSN,0),LRLWC=$P(X0,"^",4)
"RTN","LRCE",164,0)
 . S LRFLG=1
"RTN","LRCE",165,0)
 . S LRPRAC=$P(X0,"^",6),LRLLOC=$P(X0,"^",7),LROLLOC=$P(X0,U,9)
"RTN","LRCE",166,0)
 . Q:LRLWC'="R"  S LRRSITE("SDT")=$P(X0,U,5)
"RTN","LRCE",167,0)
 . S DIC("A")="*Select Original Ordered Test "
"RTN","LRCE",168,0)
 . S DA=LRSN,DA(1)=LRODT,DIC("S")="I $G(^(.3))"
"RTN","LRCE",169,0)
 . S DIC="^LRO(69,"_LRODT_",1,"_LRSN_",2,",DIC(0)="AQEZNM"
"RTN","LRCE",170,0)
 . D ^DIC I Y<1  S LRADDTST="" Q
"RTN","LRCE",171,0)
 . S LRTSP=$P(Y,U,2),X=$G(^LRO(69,LRODT,1,LRSN,2,+Y,.3))
"RTN","LRCE",172,0)
 . Q:'$P(X,U,2)  S (LRSD("RPSITE"),LRRSITE("RSITE"))=$P(X,U,2)_U_$P(^LRO(69,LRODT,1,LRSN,0),U,7)
"RTN","LRCE",173,0)
 . S LRRSITE("RPSITE")=$P(X,U,3)
"RTN","LRCE",174,0)
 . S LRSD("RUID")=$P(X,U,5)
"RTN","LRCE",175,0)
 . S LRORDRR="R"
"RTN","LRCE",176,0)
 Q
"RTN","LRCE",177,0)
 ;
"RTN","LRCE",178,0)
 ;
"RTN","LRCE",179,0)
LUPT ;
"RTN","LRCE",180,0)
 K DFN,DIC S DIC(0)="EMQ"
"RTN","LRCE",181,0)
 D ^LRDPA
"RTN","LRCE",182,0)
 Q:DFN<1!$D(DUOUT)
"RTN","LRCE",183,0)
 ;
"RTN","LRCE",184,0)
LU1 ;
"RTN","LRCE",185,0)
 W !,"Order date to start from: T//" R X:DTIME
"RTN","LRCE",186,0)
 I '$T!(X["^") QUIT
"RTN","LRCE",187,0)
 S %DT="E",X=$S(X="":"T",1:X)
"RTN","LRCE",188,0)
 D ^%DT
"RTN","LRCE",189,0)
 G:Y<1 LU1 S Y=Y-1
"RTN","LRCE",190,0)
 S LRODT=Y F  S LRODT=$O(^LRO(69,LRODT)) Q:LRODT<1  D FSN
"RTN","LRCE",191,0)
 Q
"RTN","LRCE",192,0)
 ;
"RTN","LRCE",193,0)
 ;
"RTN","LRCE",194,0)
FSN ;
"RTN","LRCE",195,0)
 S LRSN=0
"RTN","LRCE",196,0)
 F  S LRSN=$O(^LRO(69,LRODT,1,"AA",LRDFN,LRSN)) Q:LRSN<1  D
"RTN","LRCE",197,0)
 . Q:'$D(^LRO(69,LRODT,1,LRSN,.1))  S LRORD=+^(.1) D PT
"RTN","LRCE",198,0)
 Q
"RTN","LRCE",199,0)
 ;
"RTN","LRCE",200,0)
 ;
"RTN","LRCE",201,0)
TEST ;
"RTN","LRCE",202,0)
 D CHKPAGE Q:$G(LRSTOP)
"RTN","LRCE",203,0)
 S X=^LRO(69,LRODT,1,LRSN,2,I,0) S:$P(^(0),U,3) (LRNOP,LRNOPMSG)=1
"RTN","LRCE",204,0)
 W !,"  TEST: ",$S($D(^LAB(60,+X,0)):$P(^(0),"^"),1:"UNKNOWN"),?28,"  "
"RTN","LRCE",205,0)
 S LRURG=+$P(X,U,2)
"RTN","LRCE",206,0)
 W $E($S($D(^LAB(62.05,LRURG,0)):$P(^(0),U),1:"ROUTINE"),1,15)
"RTN","LRCE",207,0)
 W ?38,"  ",$S($D(^LRO(68,+$P(X,"^",4),0)):$P(^(0),"^"),1:""),?50,"  ",$P(X,"^",5),?55
"RTN","LRCE",208,0)
 ;
"RTN","LRCE",209,0)
 D REF
"RTN","LRCE",210,0)
 I $P(X,"^",11) D
"RTN","LRCE",211,0)
 . W !?3,"Canceled by: "_$P(^VA(200,$P(X,"^",11),0),"^") S I(2)=0
"RTN","LRCE",212,0)
 . F  S I(2)=$O(^LRO(69,LRODT,1,LRSN,2,I,1.1,I(2))) Q:I(2)<1  I $D(^(I(2),0)) W !?5,^(0) D CHKPAGE Q:$G(LRSTOP)
"RTN","LRCE",213,0)
 D CHKPAGE Q:$G(LRSTOP)
"RTN","LRCE",214,0)
 ;
"RTN","LRCE",215,0)
 S I(2)=0
"RTN","LRCE",216,0)
 F  S I(2)=$O(^LRO(69,LRODT,1,LRSN,2,I,1,I(2))) Q:I(2)<1  I $D(^(I(2),0)) W !?5,^(0) D CHKPAGE Q:$G(LRSTOP)
"RTN","LRCE",217,0)
 Q
"RTN","LRCE",218,0)
 ;
"RTN","LRCE",219,0)
 ;
"RTN","LRCE",220,0)
REF ; If referred test, display status and manifest
"RTN","LRCE",221,0)
 N LREVNT,LRSCFG,LRUID
"RTN","LRCE",222,0)
 ;
"RTN","LRCE",223,0)
 S LRUID=$P($G(^LRO(69,LRODT,1,LRSN,2,I,.3)),"^")
"RTN","LRCE",224,0)
 I LRUID="" Q
"RTN","LRCE",225,0)
 ;
"RTN","LRCE",226,0)
 W "  <"_LRUID_">"
"RTN","LRCE",227,0)
 ;
"RTN","LRCE",228,0)
 S LREVNT=$$STATUS^LREVENT(LRUID,+X,""),LRSCFG=""
"RTN","LRCE",229,0)
 I LREVNT="" Q
"RTN","LRCE",230,0)
 I $P(LREVNT,"^",3)'="" D
"RTN","LRCE",231,0)
 . N LR628
"RTN","LRCE",232,0)
 . S LR628=$O(^LAHM(62.8,"B",$P(LREVNT,"^",3),0))
"RTN","LRCE",233,0)
 . S LRSCFG=$P($G(^LAHM(62.8,LR628,0)),"^",2)
"RTN","LRCE",234,0)
 . I LRSCFG S LRSCFG(0)=$P($G(^LAHM(62.9,LRSCFG,0),"Unknown/deleted"),"^")
"RTN","LRCE",235,0)
 W !,?4,"REFERRAL STATUS: "_$P(LREVNT,"^")_" ("_$P(LREVNT,"^",2)_")"
"RTN","LRCE",236,0)
 W !,?4,"SHIPPING MANIFEST: "_$P(LREVNT,"^",3)
"RTN","LRCE",237,0)
 I LRSCFG W " using shipping config "_LRSCFG(0)
"RTN","LRCE",238,0)
 ;
"RTN","LRCE",239,0)
 Q
"RTN","LRCE",240,0)
 ;
"RTN","LRCE",241,0)
 ;
"RTN","LRCE",242,0)
END ;
"RTN","LRCE",243,0)
 K %,%DT,A,DFN,DIC,DIR,DIRUT,DTOUT,DUOUT,I,II,K,L,LRARIV,LRCLCTR,LRCLST
"RTN","LRCE",244,0)
 K LRCTYP,LRDRWTM,LRFLAG1,LRFLG,LRLOC,LRMD,LRODT,LROR,LRORD
"RTN","LRCE",245,0)
 K LRPRAC,LRSN,LRSN1,LRSTOP,LRURG,LRW,LRWHOE,LRWRD,VA("BID"),VA("PID")
"RTN","LRCE",246,0)
 K VAIN,VADM,VAERR,X,X1,X2,Y,Z
"RTN","LRCE",247,0)
 Q:$G(LR2ORD)
"RTN","LRCE",248,0)
 K LRNOP,LRNOPMSG
"RTN","LRCE",249,0)
 Q
"RTN","LRSPRPT")
0^2^B65490213^B65444483
"RTN","LRSPRPT",1,0)
LRSPRPT ;DALOI/STAFF - CY/EM/SP PATIENT RPT ;11/14/11  13:03
"RTN","LRSPRPT",2,0)
 ;;5.2;LAB SERVICE;**1,72,248,259,317,350,416**;Sep 27, 1994;Build 4
"RTN","LRSPRPT",3,0)
 ;
"RTN","LRSPRPT",4,0)
 W !!?20,LRO(68)," FINAL PATIENT REPORTS"
"RTN","LRSPRPT",5,0)
 K LRSAV,LRAP,LRS(99)
"RTN","LRSPRPT",6,0)
 D EN2^LRUA
"RTN","LRSPRPT",7,0)
 G END^LRSPRPT1:LRAPX=2,SGL:LRAPX=3,CH:LRAPX=4
"RTN","LRSPRPT",8,0)
GETP ;
"RTN","LRSPRPT",9,0)
 D EN1^LRUPS Q:LRAN=-1
"RTN","LRSPRPT",10,0)
 G:$D(^LRO(69.2,LRAA,2,LRAN,0)) GETP
"RTN","LRSPRPT",11,0)
 D LOCK^DILF("^LRO(69.2,LRAA,2)")
"RTN","LRSPRPT",12,0)
 I '$T D  G GETP
"RTN","LRSPRPT",13,0)
 . N MSG
"RTN","LRSPRPT",14,0)
 . S MSG(1)="The final reports queue is in use by another person.",MSG(1,"F")="!!"
"RTN","LRSPRPT",15,0)
 . S MSG(2)="You will need to add this accession to the queue later."
"RTN","LRSPRPT",16,0)
 . D EN^DDIOL(.MSG)
"RTN","LRSPRPT",17,0)
 S ^LRO(69.2,LRAA,2,LRAN,0)=LRDFN_"^"_LRI
"RTN","LRSPRPT",18,0)
 S X=^LRO(69.2,LRAA,2,0),^(0)=$P(X,"^",1,2)_"^"_LRAN_"^"_($P(X,"^",4)+1)
"RTN","LRSPRPT",19,0)
 L -^LRO(69.2,LRAA,2)
"RTN","LRSPRPT",20,0)
 G GETP
"RTN","LRSPRPT",21,0)
 ;
"RTN","LRSPRPT",22,0)
 ;
"RTN","LRSPRPT",23,0)
CH ;
"RTN","LRSPRPT",24,0)
 S LRAPX(1)=2 D EN^LRSPRPT2 Q:$G(%)<1
"RTN","LRSPRPT",25,0)
 W !!,"Save final report list for reprinting "
"RTN","LRSPRPT",26,0)
 S %=2 D YN^LRU S:%=1 LRSAV=1
"RTN","LRSPRPT",27,0)
 ; Variable LR("DVD") is used to divide reports displayed in the browser
"RTN","LRSPRPT",28,0)
 K LR("DVD")
"RTN","LRSPRPT",29,0)
 S $P(LR("DVD"),"|",IOM)=""
"RTN","LRSPRPT",30,0)
DEV ; from LRAPMOD
"RTN","LRSPRPT",31,0)
 W !
"RTN","LRSPRPT",32,0)
 S %ZIS="Q" D ^%ZIS
"RTN","LRSPRPT",33,0)
 I POP W ! D END Q
"RTN","LRSPRPT",34,0)
 I $D(IO("Q")) D  Q
"RTN","LRSPRPT",35,0)
 . N ZTDESC,ZTRTN,ZTSAVE,ZTSK
"RTN","LRSPRPT",36,0)
 . S ZTDESC="ANAT PATH FINAL REPORT"
"RTN","LRSPRPT",37,0)
 . S ZTSAVE("LR*")="",ZTRTN="QUE^LRSPRPT"
"RTN","LRSPRPT",38,0)
 . D ^%ZTLOAD,HOME^%ZIS
"RTN","LRSPRPT",39,0)
 . D EN^DDIOL("Request "_$S($G(ZTSK):"queued - Task #"_ZTSK,1:"NOT queued"),"","!")
"RTN","LRSPRPT",40,0)
 . D END
"RTN","LRSPRPT",41,0)
 ;
"RTN","LRSPRPT",42,0)
QUE ;
"RTN","LRSPRPT",43,0)
 U IO
"RTN","LRSPRPT",44,0)
 N LRFFF
"RTN","LRSPRPT",45,0)
 ; LRSF515=1 means generating an SF515
"RTN","LRSPRPT",46,0)
 S:'$D(LRSF515) LRSF515=0
"RTN","LRSPRPT",47,0)
 S:'$D(LRFOC) LRFOC=0
"RTN","LRSPRPT",48,0)
 S:'$D(LRQUIT) LRQUIT=0
"RTN","LRSPRPT",49,0)
 S LRFFF=1  ;Flag to perform final form feed
"RTN","LRSPRPT",50,0)
 I LRFOC S LRFFF=0  ;If final office copy, don't perform final form feed
"RTN","LRSPRPT",51,0)
 S LR(.21)=+$G(^LRO(69.2,LRAA,.2)),LR("DIWF")="W"
"RTN","LRSPRPT",52,0)
 S LRA=$S($D(^LRO(69.2,LRAA,0)):$P(^(0),U,9),1:1) S:LRA="" LRA=1
"RTN","LRSPRPT",53,0)
 D L^LRU,S^LRU,L1^LRU,SET^LRUA
"RTN","LRSPRPT",54,0)
 ;
"RTN","LRSPRPT",55,0)
PSGL ; Single Report
"RTN","LRSPRPT",56,0)
 I $D(LRAP) D  G LST
"RTN","LRSPRPT",57,0)
 . S LRDFN=$P(LRAP,"^"),LRI=$P(LRAP,"^",2)
"RTN","LRSPRPT",58,0)
 . I +$G(LRPTR) D  Q
"RTN","LRSPRPT",59,0)
 . . D MAIN^LRAPTIUP(LRPTR,0)
"RTN","LRSPRPT",60,0)
 . . S LRFFF=0 ;Don't do final form feed.  It's done by LRAPTIUP.
"RTN","LRSPRPT",61,0)
 . . I LRQUIT S LR("Q")=1 Q
"RTN","LRSPRPT",62,0)
 . . K LRAP S LR("F")=1
"RTN","LRSPRPT",63,0)
 . . I 'LR("Q"),$D(LR("F")),IOST?1"C".E D CONT
"RTN","LRSPRPT",64,0)
 . . Q:LR("Q")
"RTN","LRSPRPT",65,0)
 . . I 'LRFOC S LR("Q")=1 Q
"RTN","LRSPRPT",66,0)
 . . D FOC
"RTN","LRSPRPT",67,0)
 . . I LRQUIT S LR("Q")=1 Q
"RTN","LRSPRPT",68,0)
 . . I 'LR("Q"),$D(LR("F")),IOST?1"C".E D CONT
"RTN","LRSPRPT",69,0)
 . W:IOST?1"C-".E @IOF
"RTN","LRSPRPT",70,0)
 . D EN
"RTN","LRSPRPT",71,0)
 . K LRAP
"RTN","LRSPRPT",72,0)
 . I 'LR("Q"),$D(LR("F")),IOST?1"C".E D CONT
"RTN","LRSPRPT",73,0)
 . Q:LR("Q")
"RTN","LRSPRPT",74,0)
 . I 'LRFOC S LR("Q")=1 Q
"RTN","LRSPRPT",75,0)
 . W !
"RTN","LRSPRPT",76,0)
 . W:IOST?1"P-".E @IOF
"RTN","LRSPRPT",77,0)
 . D FOC
"RTN","LRSPRPT",78,0)
 . I LRQUIT S LR("Q")=1 Q
"RTN","LRSPRPT",79,0)
 . I 'LR("Q"),$D(LR("F")),IOST?1"C".E D CONT
"RTN","LRSPRPT",80,0)
 ;
"RTN","LRSPRPT",81,0)
PQUE ;Report from queue
"RTN","LRSPRPT",82,0)
 S LRAN=0
"RTN","LRSPRPT",83,0)
 F  S LRAN=$O(^LRO(69.2,LRAA,2,LRAN)) Q:'LRAN!(LR("Q"))  D
"RTN","LRSPRPT",84,0)
 . S LRQUIT=0
"RTN","LRSPRPT",85,0)
 . I 'LRFOC S LRFFF=1
"RTN","LRSPRPT",86,0)
 . K LR("F")
"RTN","LRSPRPT",87,0)
 . S X=^LRO(69.2,LRAA,2,LRAN,0),LRDFN=+X,LRI=$P(X,"^",2)
"RTN","LRSPRPT",88,0)
 . D TIUCHK^LRAPUTL(.LRPTR,LRDFN,LRSS,LRI)
"RTN","LRSPRPT",89,0)
 . I +$G(LRPTR) D  Q
"RTN","LRSPRPT",90,0)
 . . D MAIN^LRAPTIUP(LRPTR,0)
"RTN","LRSPRPT",91,0)
 . . S LRFFF=0
"RTN","LRSPRPT",92,0)
 . . W:IOST["BROWSER"&('LRFOC) !!,LR("DVD")
"RTN","LRSPRPT",93,0)
 . . K LRPTR
"RTN","LRSPRPT",94,0)
 . . I LRQUIT S LR("Q")=1 Q
"RTN","LRSPRPT",95,0)
 . . S LR("F")=1
"RTN","LRSPRPT",96,0)
 . . I 'LR("Q"),$D(LR("F")),IOST?1"C-".E D CONT
"RTN","LRSPRPT",97,0)
 . . Q:LR("Q")!('LRFOC)
"RTN","LRSPRPT",98,0)
 . . D FOC
"RTN","LRSPRPT",99,0)
 . . W:IOST["BROWSER" !!,LR("DVD")
"RTN","LRSPRPT",100,0)
 . . I LRQUIT S LR("Q")=1 Q
"RTN","LRSPRPT",101,0)
 . . I 'LR("Q"),$D(LR("F")),IOST?1"C".E D CONT
"RTN","LRSPRPT",102,0)
 . W:IOST?1"C-".E @IOF
"RTN","LRSPRPT",103,0)
 . D EN
"RTN","LRSPRPT",104,0)
 . W:IOST?1"P-".E @IOF
"RTN","LRSPRPT",105,0)
 . W:IOST["BROWSER"&('LRFOC) !!,LR("DVD")
"RTN","LRSPRPT",106,0)
 . I 'LR("Q"),$D(LR("F")),IOST?1"C-".E D CONT
"RTN","LRSPRPT",107,0)
 . Q:LR("Q")
"RTN","LRSPRPT",108,0)
 . Q:'LRFOC
"RTN","LRSPRPT",109,0)
 . W !
"RTN","LRSPRPT",110,0)
 . D FOC
"RTN","LRSPRPT",111,0)
 . W:IOST["BROWSER" !!,LR("DVD")
"RTN","LRSPRPT",112,0)
 . I LRQUIT S LR("Q")=1 Q
"RTN","LRSPRPT",113,0)
 . I 'LR("Q"),$D(LR("F")),IOST?1"C".E D CONT
"RTN","LRSPRPT",114,0)
 S LRFFF=0
"RTN","LRSPRPT",115,0)
 ;
"RTN","LRSPRPT",116,0)
LST ;
"RTN","LRSPRPT",117,0)
 K LRRMD,LRPMD,LRAP
"RTN","LRSPRPT",118,0)
 K:'$D(LRSAV) ^LRO(69.2,LRAA,2)
"RTN","LRSPRPT",119,0)
 S ^LRO(69.2,LRAA,2,0)="^69.23A^^0"
"RTN","LRSPRPT",120,0)
 K LRSAV,LRV,LRW,LRZ
"RTN","LRSPRPT",121,0)
 I IOST?1"P-".E W:LRFFF @IOF
"RTN","LRSPRPT",122,0)
 D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","LRSPRPT",123,0)
 K %,DIR,DTOUT,DUOUT,DIRUT,X,Y
"RTN","LRSPRPT",124,0)
 D END
"RTN","LRSPRPT",125,0)
 Q
"RTN","LRSPRPT",126,0)
 ;
"RTN","LRSPRPT",127,0)
 ;
"RTN","LRSPRPT",128,0)
W ;
"RTN","LRSPRPT",129,0)
 W !,LR("%")
"RTN","LRSPRPT",130,0)
 Q
"RTN","LRSPRPT",131,0)
 ;
"RTN","LRSPRPT",132,0)
 ;
"RTN","LRSPRPT",133,0)
F ;
"RTN","LRSPRPT",134,0)
 ; N A,DIWF,DIWL,DIWR
"RTN","LRSPRPT",135,0)
 D E
"RTN","LRSPRPT",136,0)
 S A=0,DIWF=$TR(DIWF,"W","")
"RTN","LRSPRPT",137,0)
 F  S A=$O(^LR(LRDFN,LRSS,LRI,LRV,A)) Q:'A  S X=^LR(LRDFN,LRSS,LRI,LRV,A,0) D:X["|TOP|" TOP D ^DIWP
"RTN","LRSPRPT",138,0)
 S A=0
"RTN","LRSPRPT",139,0)
 F  S A=$O(^UTILITY($J,"W",DIWL,A)) Q:'A  D:$Y>(IOSL-11) F^LRAPF,^LRAPF Q:LR("Q")  W !,^UTILITY($J,"W",DIWL,A,0)
"RTN","LRSPRPT",140,0)
 I $Y<(IOSL-11) W !
"RTN","LRSPRPT",141,0)
 K ^UTILITY($J,"W")
"RTN","LRSPRPT",142,0)
 Q
"RTN","LRSPRPT",143,0)
 ;
"RTN","LRSPRPT",144,0)
 ;
"RTN","LRSPRPT",145,0)
E ;
"RTN","LRSPRPT",146,0)
 K ^UTILITY($J,"W")
"RTN","LRSPRPT",147,0)
 S DIWR=IOM-5,DIWL=5,DIWF=""
"RTN","LRSPRPT",148,0)
 ;
"RTN","LRSPRPT",149,0)
 ; Set gross description field to value from file #69.2
"RTN","LRSPRPT",150,0)
 ;I LRV=1 S DIWF=LR("DIWF")
"RTN","LRSPRPT",151,0)
 S DIWF=LR("DIWF")
"RTN","LRSPRPT",152,0)
 ;
"RTN","LRSPRPT",153,0)
 Q
"RTN","LRSPRPT",154,0)
 ;
"RTN","LRSPRPT",155,0)
 ;
"RTN","LRSPRPT",156,0)
EN ; from LRSPT
"RTN","LRSPRPT",157,0)
 ; Moved to LRSPRPTA due to size limits on routine
"RTN","LRSPRPT",158,0)
 D EN^LRSPRPTA
"RTN","LRSPRPT",159,0)
 Q
"RTN","LRSPRPT",160,0)
 ;
"RTN","LRSPRPT",161,0)
 ;
"RTN","LRSPRPT",162,0)
S ;
"RTN","LRSPRPT",163,0)
 S Y=+X,X=$P(X,U,2) D D^LRU
"RTN","LRSPRPT",164,0)
 W !?3,"Date: ",Y
"RTN","LRSPRPT",165,0)
 I $D(LR("R")),'X W " not verified" Q
"RTN","LRSPRPT",166,0)
 D:$Y>(IOSL-13) F^LRAPF,^LRAPF Q:LR("Q")
"RTN","LRSPRPT",167,0)
 D:$P($G(^LR(LRDFN,LRSS,LRI,1.2,LRV,2,0)),U,4) SUPA
"RTN","LRSPRPT",168,0)
 D E S B=0
"RTN","LRSPRPT",169,0)
 F LRZ=0:1 S B=$O(^LR(LRDFN,LRSS,LRI,1.2,LRV,1,B)) Q:'B!(LR("Q"))  D
"RTN","LRSPRPT",170,0)
 . D:$Y>(IOSL-14) F^LRAPF,^LRAPF Q:LR("Q")
"RTN","LRSPRPT",171,0)
 . S DIWF="W"
"RTN","LRSPRPT",172,0)
 . S X=^LR(LRDFN,LRSS,LRI,1.2,LRV,1,B,0) D ^DIWP Q:LR("Q")
"RTN","LRSPRPT",173,0)
 Q:LR("Q")
"RTN","LRSPRPT",174,0)
 D:LRZ ^DIWW
"RTN","LRSPRPT",175,0)
 Q
"RTN","LRSPRPT",176,0)
 ;
"RTN","LRSPRPT",177,0)
 ;
"RTN","LRSPRPT",178,0)
SGL ; Print Single Report
"RTN","LRSPRPT",179,0)
 N LRPTR
"RTN","LRSPRPT",180,0)
 S LRAPX(1)=""
"RTN","LRSPRPT",181,0)
 D EN1^LRUPS Q:LRAN=-1
"RTN","LRSPRPT",182,0)
 I '$P(^LR(LRDFN,LRSS,LRI,0),"^",11) D  G SGL
"RTN","LRSPRPT",183,0)
 . W $C(7)," Sorry, report not verified.",!
"RTN","LRSPRPT",184,0)
 D TIUCHK^LRAPUTL(.LRPTR,LRDFN,LRSS,LRI)
"RTN","LRSPRPT",185,0)
 S LRAP=LRDFN_"^"_LRI,LRSAV=1
"RTN","LRSPRPT",186,0)
 D EN2^LRUA
"RTN","LRSPRPT",187,0)
 G DEV
"RTN","LRSPRPT",188,0)
 ;
"RTN","LRSPRPT",189,0)
 ;
"RTN","LRSPRPT",190,0)
A ;
"RTN","LRSPRPT",191,0)
 S A=0 F  S A=$O(^LR(LRDFN,LRSS,LRI,LRV,A)) Q:'A!(LR("Q"))  D
"RTN","LRSPRPT",192,0)
 . D:$Y>(IOSL-13) F^LRAPF,^LRAPF Q:LR("Q")
"RTN","LRSPRPT",193,0)
 . W !,$P(^LR(LRDFN,LRSS,LRI,LRV,A,0),"^")
"RTN","LRSPRPT",194,0)
 Q
"RTN","LRSPRPT",195,0)
 ;
"RTN","LRSPRPT",196,0)
 ;
"RTN","LRSPRPT",197,0)
TOP ;
"RTN","LRSPRPT",198,0)
 S Z=$P(X,"|TOP|",1)_$P(X,"|TOP|",2) D F^LRAPF,^LRAPF S X=Z
"RTN","LRSPRPT",199,0)
 Q
"RTN","LRSPRPT",200,0)
 ;
"RTN","LRSPRPT",201,0)
 ;
"RTN","LRSPRPT",202,0)
SUPA ; Print supplementary report audit information
"RTN","LRSPRPT",203,0)
 W !?14,"*+* SUPPLEMENTARY REPORT HAS BEEN ADDED/MODIFIED *+*"
"RTN","LRSPRPT",204,0)
 W !,"(Added/Last modified: "
"RTN","LRSPRPT",205,0)
 S (A,B)=0 F  S A=$O(^LR(LRDFN,LRSS,LRI,1.2,LRV,2,A)) Q:'A!(LR("Q"))  D
"RTN","LRSPRPT",206,0)
 . S B=A
"RTN","LRSPRPT",207,0)
 Q:LR("Q")
"RTN","LRSPRPT",208,0)
 Q:'$D(^LR(LRDFN,LRSS,LRI,1.2,LRV,2,B,0))
"RTN","LRSPRPT",209,0)
 S A=^(0),Y=+A,LRSGN=" typed by ",A=$P(A,"^",2)
"RTN","LRSPRPT",210,0)
 I $P(^LR(LRDFN,LRSS,LRI,1.2,LRV,2,B,0),"^",3) D
"RTN","LRSPRPT",211,0)
 . S A=^(0),LRSGN=" signed by ",A2=$P(A,"^",3),Y=$P(A,"^",4)
"RTN","LRSPRPT",212,0)
 . S A=A2
"RTN","LRSPRPT",213,0)
 S A=$S($D(^VA(200,A,0)):$P(^(0),"^"),1:A)
"RTN","LRSPRPT",214,0)
 ; If supp rpt is released, display 'signed by' instead of 'typed by'
"RTN","LRSPRPT",215,0)
 D D^LRU W Y,LRSGN,A,")"
"RTN","LRSPRPT",216,0)
 ; If RELEASE SUPP REPORT MODIFIED set to 1, display "NOT VERIFIED"
"RTN","LRSPRPT",217,0)
 I $P(^LR(LRDFN,LRSS,LRI,1.2,LRV,0),"^",3) W !,?25,"**-* NOT VERIFIED *-**"
"RTN","LRSPRPT",218,0)
 D:$D(LRQ(9)) SUPM
"RTN","LRSPRPT",219,0)
 Q
"RTN","LRSPRPT",220,0)
 ;
"RTN","LRSPRPT",221,0)
 ;
"RTN","LRSPRPT",222,0)
SUPM ; Print previous versions of supplementary reports
"RTN","LRSPRPT",223,0)
 ; This is used by menu option 'Print path modifications [LRAPMOD]'
"RTN","LRSPRPT",224,0)
 ;
"RTN","LRSPRPT",225,0)
 S A=0 F  S A=$O(^LR(LRDFN,LRSS,LRI,1.2,LRV,2,A)) Q:'A!(LR("Q"))  D
"RTN","LRSPRPT",226,0)
 . S LRT=^LR(LRDFN,LRSS,LRI,1.2,LRV,2,A,0)
"RTN","LRSPRPT",227,0)
 . D:$Y>(IOSL-13) F^LRAPF,^LRAPF Q:LR("Q")
"RTN","LRSPRPT",228,0)
 . S Y=+LRT,Y2=" modified: ",X=$P(LRT,"^",2),LRSGN="  typed by "
"RTN","LRSPRPT",229,0)
 . ; If supp rpt is released, display 'signed by' instead of 'typed by'
"RTN","LRSPRPT",230,0)
 . I $P(LRT,"^",3) S LRSGN=" signed by ",X=$P(LRT,"^",3),Y=$P(LRT,"^",4),Y2=" released: "
"RTN","LRSPRPT",231,0)
 . S X=$S($D(^VA(200,X,0)):$P(^(0),"^"),1:X)
"RTN","LRSPRPT",232,0)
 . D D^LRU W !,"Date ",Y2,Y,LRSGN,X
"RTN","LRSPRPT",233,0)
 . K ^UTILITY($J)
"RTN","LRSPRPT",234,0)
 . S DIWR=IOM-5,DIWL=5,DIWF="W"
"RTN","LRSPRPT",235,0)
 . S B=0
"RTN","LRSPRPT",236,0)
 . F LRZ=0:1 S B=$O(^LR(LRDFN,LRSS,LRI,1.2,LRV,2,A,1,B)) Q:'B!(LR("Q"))  D
"RTN","LRSPRPT",237,0)
 . . S LRT=^LR(LRDFN,LRSS,LRI,1.2,LRV,2,A,1,B,0)
"RTN","LRSPRPT",238,0)
 . . D:$Y>(IOSL-13) F^LRAPF,^LRAPF Q:LR("Q")
"RTN","LRSPRPT",239,0)
 . . S X=LRT D ^DIWP
"RTN","LRSPRPT",240,0)
 . Q:LR("Q")  D:LRZ ^DIWW
"RTN","LRSPRPT",241,0)
 Q:LR("Q")
"RTN","LRSPRPT",242,0)
 W !?13,"==========Text below appears on final report=========="
"RTN","LRSPRPT",243,0)
 Q
"RTN","LRSPRPT",244,0)
 ;
"RTN","LRSPRPT",245,0)
 ;
"RTN","LRSPRPT",246,0)
CONT ;
"RTN","LRSPRPT",247,0)
 K DIR S DIR(0)="E"
"RTN","LRSPRPT",248,0)
 D ^DIR W !
"RTN","LRSPRPT",249,0)
 S:$D(DTOUT)!(X[U) LR("Q")=1
"RTN","LRSPRPT",250,0)
 Q
"RTN","LRSPRPT",251,0)
 ;
"RTN","LRSPRPT",252,0)
 ;
"RTN","LRSPRPT",253,0)
FOC ; Print final office copy page (SNOMEDS)
"RTN","LRSPRPT",254,0)
 N LRADC,LRCTR
"RTN","LRSPRPT",255,0)
 I '$D(LRAP) D
"RTN","LRSPRPT",256,0)
 . D:LRSS'="AU" ^LRUA
"RTN","LRSPRPT",257,0)
 . I LRSS="AU" S X=^LR(LRDFN,0) D ^LRUP
"RTN","LRSPRPT",258,0)
 I LRSS="AU" D
"RTN","LRSPRPT",259,0)
 . S LRADC=$E($P(^LR(LRDFN,LRSS),"^"),1,3)_"0000"
"RTN","LRSPRPT",260,0)
 . S:+$G(LRDPF)=2 LRDEM("DTH")=$P(VADM(6),"^",2)
"RTN","LRSPRPT",261,0)
 . ; Get DATE DIED from Referral File for Referral Patients
"RTN","LRSPRPT",262,0)
 . S:+$G(LRDPF)'=2 LRDEM("DTH")=$$GET1^DIQ(67,DFN_",",.351)
"RTN","LRSPRPT",263,0)
 . S LRDEM("AUDT")=$$GET1^DIQ(63,LRDFN_",",11)
"RTN","LRSPRPT",264,0)
 . S LRDEM("AUTYP")=$$GET1^DIQ(63,LRDFN_",",13.7)
"RTN","LRSPRPT",265,0)
 . S LRDEM("PRO")=$$GET1^DIQ(63,LRDFN_",",13.5)
"RTN","LRSPRPT",266,0)
 I LRSS'="AU" D
"RTN","LRSPRPT",267,0)
 . S LRADC=$E($P(^LR(LRDFN,LRSS,LRI,0),"^",10),1,3)_"0000"
"RTN","LRSPRPT",268,0)
 . S LRDEM("PRO")=LRMD
"RTN","LRSPRPT",269,0)
 S LRDEM("PNM")=LRP,LRDEM("SSN")=SSN
"RTN","LRSPRPT",270,0)
 S LRDEM("SEX")=SEX,LRDEM("AGE")=AGE,LRDEM("DOB")=DOB
"RTN","LRSPRPT",271,0)
 D INIT^LRAPSNMD(LRDFN,LRSS,$G(LRI),LRSF,LRAA,LRAN,LRADC,.LRDEM,0)
"RTN","LRSPRPT",272,0)
 Q
"RTN","LRSPRPT",273,0)
 ;
"RTN","LRSPRPT",274,0)
 ;
"RTN","LRSPRPT",275,0)
END ;
"RTN","LRSPRPT",276,0)
 D V^LRU
"RTN","LRSPRPT",277,0)
 K LRSF515
"RTN","LRSPRPT",278,0)
 Q
"RTN","LRSPRPTM")
0^3^B2545240^B2545182
"RTN","LRSPRPTM",1,0)
LRSPRPTM ;AVAMC/REG/WTY - MODIFIED PATH REPORT ;9/22/00
"RTN","LRSPRPTM",2,0)
 ;;5.2;LAB SERVICE;**1,248,416**;Sep 27, 1994;Build 4
"RTN","LRSPRPTM",3,0)
 ;
"RTN","LRSPRPTM",4,0)
 ;Reference to ^VA(200 supported by IA #10060
"RTN","LRSPRPTM",5,0)
 ;Reference to ^DIWP suppported by IA #10011
"RTN","LRSPRPTM",6,0)
 ;Reference to ^DIWW suppported by IA #10029
"RTN","LRSPRPTM",7,0)
 ;
"RTN","LRSPRPTM",8,0)
 W !?28,"*+* MODIFIED REPORT *+*"
"RTN","LRSPRPTM",9,0)
 W !,"(Last modified: "
"RTN","LRSPRPTM",10,0)
 S B=0
"RTN","LRSPRPTM",11,0)
 F A=0:0 S A=$O(^LR(LRDFN,LRSS,LRI,LR(0),A)) Q:'A!(LR("Q"))  S B=A
"RTN","LRSPRPTM",12,0)
 Q:LR("Q")  Q:'$D(^LR(LRDFN,LRSS,LRI,LR(0),B,0))
"RTN","LRSPRPTM",13,0)
 S A=^LR(LRDFN,LRSS,LRI,LR(0),B,0),Y=+A,A=$P(A,"^",2)
"RTN","LRSPRPTM",14,0)
 S A=$S($D(^VA(200,A,0)):$P(^(0),"^"),1:A)
"RTN","LRSPRPTM",15,0)
 D D^LRU W Y," typed by ",A,")"
"RTN","LRSPRPTM",16,0)
 D:$D(LRQ(9)) M
"RTN","LRSPRPTM",17,0)
 Q
"RTN","LRSPRPTM",18,0)
 ;
"RTN","LRSPRPTM",19,0)
M F A=0:0 S A=$O(^LR(LRDFN,LRSS,LRI,LR(0),A)) Q:'A!(LR("Q"))  D
"RTN","LRSPRPTM",20,0)
 .S LRT=^LR(LRDFN,LRSS,LRI,LR(0),A,0)
"RTN","LRSPRPTM",21,0)
 .D:$Y>(IOSL-14) F^LRAPF,^LRAPF Q:LR("Q")
"RTN","LRSPRPTM",22,0)
 .S Y=+LRT,X=$P(LRT,"^",2),X=$S($D(^VA(200,X,0)):$P(^(0),"^"),1:X)
"RTN","LRSPRPTM",23,0)
 .D D^LRU W !,"Date modified:",Y," typed by ",X D F
"RTN","LRSPRPTM",24,0)
 Q:LR("Q")
"RTN","LRSPRPTM",25,0)
 W !?13,"==========Text below appears on final report=========="
"RTN","LRSPRPTM",26,0)
 Q
"RTN","LRSPRPTM",27,0)
E K ^UTILITY($J) S DIWR=IOM-5,DIWL=5,DIWF="W"
"RTN","LRSPRPTM",28,0)
 Q
"RTN","LRSPRPTM",29,0)
 ;
"RTN","LRSPRPTM",30,0)
F D E S B=0
"RTN","LRSPRPTM",31,0)
 F LRZ=0:1 S B=$O(^LR(LRDFN,LRSS,LRI,LR(0),A,1,B)) Q:'B!(LR("Q"))  D
"RTN","LRSPRPTM",32,0)
 .S LRT=^LR(LRDFN,LRSS,LRI,LR(0),A,1,B,0)
"RTN","LRSPRPTM",33,0)
 .D:$Y>(IOSL-14) F^LRAPF,^LRAPF Q:LR("Q")
"RTN","LRSPRPTM",34,0)
 .S X=LRT D ^DIWP
"RTN","LRSPRPTM",35,0)
 Q:LR("Q")  D:LRZ ^DIWW
"RTN","LRSPRPTM",36,0)
 Q
"VER")
8.0^22.0
"BLD",8938,6)
^345
**END**
**END**

