Released LR*5.2*433 SEQ #346
Extracted from mail message
**KIDS**:LR*5.2*433^

**INSTALL NAME**
LR*5.2*433
"BLD",8756,0)
LR*5.2*433^LAB SERVICE^0^3140114^y
"BLD",8756,1,0)
^^10^10^3130918
"BLD",8756,1,1,0)
Lab Version 5.2 Patch 433 - Anatomical Pathology Image Framework
"BLD",8756,1,2,0)
 
"BLD",8756,1,3,0)
 
"BLD",8756,1,4,0)
Routines:
"BLD",8756,1,5,0)
LR7OB63D    new value = 29564352
"BLD",8756,1,6,0)
LRAPED    new value = 33912945
"BLD",8756,1,7,0)
LRAPEDC    new value = 5938079
"BLD",8756,1,8,0)
LRAPLG1    new value = 169348471
"BLD",8756,1,9,0)
LRAPRES    new value = 188361634
"BLD",8756,1,10,0)
LRUDEL    new value = 25303229
"BLD",8756,4,0)
^9.64PA^^0
"BLD",8756,6.3)
4
"BLD",8756,"ABNS",0)
^9.66A^^
"BLD",8756,"ABPKG")
^y^
"BLD",8756,"INID")
n^n^n
"BLD",8756,"KRN",0)
^9.67PA^8994^19
"BLD",8756,"KRN",.4,0)
.4
"BLD",8756,"KRN",.401,0)
.401
"BLD",8756,"KRN",.402,0)
.402
"BLD",8756,"KRN",.403,0)
.403
"BLD",8756,"KRN",.5,0)
.5
"BLD",8756,"KRN",.84,0)
.84
"BLD",8756,"KRN",3.6,0)
3.6
"BLD",8756,"KRN",3.8,0)
3.8
"BLD",8756,"KRN",9.2,0)
9.2
"BLD",8756,"KRN",9.8,0)
9.8
"BLD",8756,"KRN",9.8,"NM",0)
^9.68A^6^6
"BLD",8756,"KRN",9.8,"NM",1,0)
LR7OB63D^^0^B29564352
"BLD",8756,"KRN",9.8,"NM",2,0)
LRAPED^^0^B33912945
"BLD",8756,"KRN",9.8,"NM",3,0)
LRAPEDC^^0^B5938079
"BLD",8756,"KRN",9.8,"NM",4,0)
LRAPLG1^^0^B169348471
"BLD",8756,"KRN",9.8,"NM",5,0)
LRAPRES^^0^B188361634
"BLD",8756,"KRN",9.8,"NM",6,0)
LRUDEL^^0^B25303229
"BLD",8756,"KRN",9.8,"NM","B","LR7OB63D",1)

"BLD",8756,"KRN",9.8,"NM","B","LRAPED",2)

"BLD",8756,"KRN",9.8,"NM","B","LRAPEDC",3)

"BLD",8756,"KRN",9.8,"NM","B","LRAPLG1",4)

"BLD",8756,"KRN",9.8,"NM","B","LRAPRES",5)

"BLD",8756,"KRN",9.8,"NM","B","LRUDEL",6)

"BLD",8756,"KRN",19,0)
19
"BLD",8756,"KRN",19.1,0)
19.1
"BLD",8756,"KRN",101,0)
101
"BLD",8756,"KRN",409.61,0)
409.61
"BLD",8756,"KRN",771,0)
771
"BLD",8756,"KRN",870,0)
870
"BLD",8756,"KRN",8989.51,0)
8989.51
"BLD",8756,"KRN",8989.52,0)
8989.52
"BLD",8756,"KRN",8994,0)
8994
"BLD",8756,"KRN","B",.4,.4)

"BLD",8756,"KRN","B",.401,.401)

"BLD",8756,"KRN","B",.402,.402)

"BLD",8756,"KRN","B",.403,.403)

"BLD",8756,"KRN","B",.5,.5)

"BLD",8756,"KRN","B",.84,.84)

"BLD",8756,"KRN","B",3.6,3.6)

"BLD",8756,"KRN","B",3.8,3.8)

"BLD",8756,"KRN","B",9.2,9.2)

"BLD",8756,"KRN","B",9.8,9.8)

"BLD",8756,"KRN","B",19,19)

"BLD",8756,"KRN","B",19.1,19.1)

"BLD",8756,"KRN","B",101,101)

"BLD",8756,"KRN","B",409.61,409.61)

"BLD",8756,"KRN","B",771,771)

"BLD",8756,"KRN","B",870,870)

"BLD",8756,"KRN","B",8989.51,8989.51)

"BLD",8756,"KRN","B",8989.52,8989.52)

"BLD",8756,"KRN","B",8994,8994)

"BLD",8756,"QUES",0)
^9.62^^
"BLD",8756,"REQB",0)
^9.611^2^2
"BLD",8756,"REQB",1,0)
LR*5.2*427^2
"BLD",8756,"REQB",2,0)
LR*5.2*259^2
"BLD",8756,"REQB","B","LR*5.2*259",2)

"BLD",8756,"REQB","B","LR*5.2*427",1)

"MBREQ")
0
"PKG",6,-1)
1^1
"PKG",6,0)
LAB SERVICE^LR^CORE LAB SYSTEM
"PKG",6,20,0)
^9.402P^1^1
"PKG",6,20,1,0)
2^^LRXDRPT
"PKG",6,20,1,1)

"PKG",6,20,"B",2,1)

"PKG",6,22,0)
^9.49I^1^1
"PKG",6,22,1,0)
5.2^2940927^2941103
"PKG",6,22,1,"PAH",1,0)
433^3140114^1866
"PKG",6,22,1,"PAH",1,1,0)
^^10^10^3140114
"PKG",6,22,1,"PAH",1,1,1,0)
Lab Version 5.2 Patch 433 - Anatomical Pathology Image Framework
"PKG",6,22,1,"PAH",1,1,2,0)
 
"PKG",6,22,1,"PAH",1,1,3,0)
 
"PKG",6,22,1,"PAH",1,1,4,0)
Routines:
"PKG",6,22,1,"PAH",1,1,5,0)
LR7OB63D    new value = 29564352
"PKG",6,22,1,"PAH",1,1,6,0)
LRAPED    new value = 33912945
"PKG",6,22,1,"PAH",1,1,7,0)
LRAPEDC    new value = 5938079
"PKG",6,22,1,"PAH",1,1,8,0)
LRAPLG1    new value = 169348471
"PKG",6,22,1,"PAH",1,1,9,0)
LRAPRES    new value = 188361634
"PKG",6,22,1,"PAH",1,1,10,0)
LRUDEL    new value = 25303229
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","LR7OB63D")
0^1^B29564352^B28748245
"RTN","LR7OB63D",1,0)
LR7OB63D ;DALOI/JMC,PMK - Get Autopsy data ;23 Jul 2013 1:52 PM
"RTN","LR7OB63D",2,0)
 ;;5.2;LAB SERVICE;**121,187,315,350,433**;Sep 27, 1994;Build 4
"RTN","LR7OB63D",3,0)
 ;
"RTN","LR7OB63D",4,0)
 ;
"RTN","LR7OB63D",5,0)
AU ;Process AU data
"RTN","LR7OB63D",6,0)
 N IFN,IFN1,IFN2,X0,X1,X2,X3,X4,X5,Y1,Y2,Y3,Y4,Y5,Y6,Y7,Y18,CTR1,PATH,SUB,LRSN
"RTN","LR7OB63D",7,0)
 ;
"RTN","LR7OB63D",8,0)
 I '$G(LRSS) S LRSS="AU"  ;added for LSRP
"RTN","LR7OB63D",9,0)
 Q:'$D(^LR(LRDFN,"AU"))  S X0=^("AU"),Y6=$S(+$G(CORRECT):"C",$P(X0,"^",15):"F",$P(X0,"^",3):"R",1:"I"),CTR1=0
"RTN","LR7OB63D",10,0)
 S:+X0 $P(^TMP("LRX",$J,69,CTR,68),"^",4)=+X0 ;DT of autopsy
"RTN","LR7OB63D",11,0)
 S:$P(X0,"^",3) $P(^TMP("LRX",$J,69,CTR,68),"^",6)=$P(X0,"^",3) ;DT Completed
"RTN","LR7OB63D",12,0)
 S PATH=$S($P(X0,"^",10):$P(X0,"^",10),1:$P(X0,"^",7)) ;Pathologist
"RTN","LR7OB63D",13,0)
 S Y18=";AU;"_IVDT
"RTN","LR7OB63D",14,0)
 S CTR1=CTR1+1
"RTN","LR7OB63D",15,0)
 S ^TMP("LRX",$J,69,CTR,68,CTR1)=$S($D(^TMP("LRX",$J,69,1)):$P(^TMP("LRX",$J,69,1),"^"),1:"")_"^^"_PATH_"^"_$P(X0,"^",3)
"RTN","LR7OB63D",16,0)
 ;
"RTN","LR7OB63D",17,0)
 D WP(33,"SPECIMEN","","ST")
"RTN","LR7OB63D",18,0)
 ;
"RTN","LR7OB63D",19,0)
 S IFN=0 F  S IFN=$O(^LR(LRDFN,80,IFN)) Q:IFN<1  D
"RTN","LR7OB63D",20,0)
 . N LRTMP,LRX
"RTN","LR7OB63D",21,0)
 . S LRX=^(IFN,0),LRX=$$ICDDX^ICDCODE(+LRX,,,1)
"RTN","LR7OB63D",22,0)
 . S CTR1=CTR1+1,LRTMP="AUTOPSY ICD9CM CODE^"
"RTN","LR7OB63D",23,0)
 . S LRTMP=LRTMP_$P(LRX,"^",4)_"^^^^"_Y6_"^^CE^"_$P(LRX,"^",2)
"RTN","LR7OB63D",24,0)
 . S LRTMP=LRTMP_"^ICD9^&IMP^^^^AUTOPSY ICD9CM CODE"_"^^^"_Y18
"RTN","LR7OB63D",25,0)
 . S ^TMP("LRX",$J,69,CTR,63,CTR1)=LRTMP
"RTN","LR7OB63D",26,0)
 ;
"RTN","LR7OB63D",27,0)
 D WP(81,"CLINICAL DIAGNOSIS","","TX")
"RTN","LR7OB63D",28,0)
 D WP(82,"PATHOLOGICAL DIAGNOSIS","","TX")
"RTN","LR7OB63D",29,0)
 ;
"RTN","LR7OB63D",30,0)
 S IFN=0
"RTN","LR7OB63D",31,0)
 F  S IFN=$O(^LR(LRDFN,84,IFN)) Q:IFN<1  S X=^(IFN,0) D
"RTN","LR7OB63D",32,0)
 . S IFN1=0
"RTN","LR7OB63D",33,0)
 . F  S IFN1=$O(^LR(LRDFN,84,IFN,1,IFN1)) Q:IFN1<1  S X1=^(IFN1,0) D
"RTN","LR7OB63D",34,0)
 . . S CTR1=CTR1+1
"RTN","LR7OB63D",35,0)
 . . S ^TMP("LRX",$J,69,CTR,63,CTR1)="SUPPLEMENTARY REPORT~"_+X_"^"_X1_"^^^^"_Y6_"^^TX^^^^^^^SUPLMNT RPT~"_+X_"^^^"_Y18
"RTN","LR7OB63D",36,0)
 ;
"RTN","LR7OB63D",37,0)
 I $D(^LR(LRDFN,"AV")) S XNODE=^("AV") D
"RTN","LR7OB63D",38,0)
 . F IFN=1:1:$L(XNODE,"^") D
"RTN","LR7OB63D",39,0)
 . . S X1=$P(XNODE,"^",IFN)
"RTN","LR7OB63D",40,0)
 . . I X1'="" S X=$$NODEPIK^LR7OB63(63,"AV",IFN,X1) I $P(X,"^")'="" S CTR1=CTR1+1,^TMP("LRX",$J,69,CTR,63,CTR1)=X_"^^^^"_Y6_"^^^^^^^^^"_X_"^^^"_Y18
"RTN","LR7OB63D",41,0)
 I $D(^LR(LRDFN,"AW")) S XNODE=^("AW") D
"RTN","LR7OB63D",42,0)
 . F IFN=1:1:$L(XNODE,"^") D
"RTN","LR7OB63D",43,0)
 . . S X1=$P(XNODE,"^",IFN)
"RTN","LR7OB63D",44,0)
 . . I X1'="" S X=$$NODEPIK^LR7OB63(63,"AW",IFN,X1) I $P(X,"^")'="" S CTR1=CTR1+1,^TMP("LRX",$J,69,CTR,63,CTR1)=X_"^^^^"_Y6_"^^^^^^^^^"_X_"^^^"_Y18
"RTN","LR7OB63D",45,0)
 I $D(^LR(LRDFN,"AWI")) S XNODE=^("AWI") D
"RTN","LR7OB63D",46,0)
 . F IFN=1:1:$L(XNODE,"^") D
"RTN","LR7OB63D",47,0)
 . . S X1=$P(XNODE,"^",IFN)
"RTN","LR7OB63D",48,0)
 . . I X1'="" S X=$$NODEPIK^LR7OB63(63,"AWI",IFN,X1) I $P(X,"^")'="" S CTR1=CTR1+1,^TMP("LRX",$J,69,CTR,63,CTR1)=X_"^^^^"_Y6_"^^^^^^^^^"_X_"^^^"_Y18
"RTN","LR7OB63D",49,0)
 ;
"RTN","LR7OB63D",50,0)
 S IFN=0,SUB=0
"RTN","LR7OB63D",51,0)
 F  S IFN=$O(^LR(LRDFN,"AY",IFN)) Q:IFN<1  S X=^(IFN,0) D
"RTN","LR7OB63D",52,0)
 . S SUB=SUB+1,CTR1=CTR1+1
"RTN","LR7OB63D",53,0)
 . S ^TMP("LRX",$J,69,CTR,63,CTR1)="ORGAN/TISSUE^"_$$POINTER^LR7OB63(63.2,.01,+X)_"^^^^"_Y6_"^"_SUB_"^CE^"_$P($G(^LAB(61,+X,0)),"^",2)_"^SNM^&ANT^^^^ORG/TISS"_"^^^"_Y18
"RTN","LR7OB63D",54,0)
 . D PTR(1,"DISEASE",63.21,.01,61.4,"")
"RTN","LR7OB63D",55,0)
 . S IFN1=0 F  S IFN1=$O(^LR(LRDFN,"AY",IFN,2,IFN1)) Q:IFN1<1  S X=^(IFN1,0) D
"RTN","LR7OB63D",56,0)
 . . S CTR1=CTR1+1
"RTN","LR7OB63D",57,0)
 . . S ^TMP("LRX",$J,69,CTR,63,CTR1)="MORPHOLOGY"_"^"_$$POINTER^LR7OB63(63.22,.01,+X)_"^^^^"_Y6_"^"_SUB_"^CE^"_$P($G(^LAB(61.1,+X,0)),"^",2)_"^SNM^&IMP^^^^MORPH^^^"_Y18
"RTN","LR7OB63D",58,0)
 . . S IFN2=0
"RTN","LR7OB63D",59,0)
 . . F  S IFN2=$O(^LR(LRDFN,"AY",IFN,2,IFN1,1,IFN2)) Q:IFN2<1  S X=^(IFN2,0) D
"RTN","LR7OB63D",60,0)
 . . . S CTR1=CTR1+1
"RTN","LR7OB63D",61,0)
 . . . S ^TMP("LRX",$J,69,CTR,63,CTR1)="ETIOLOGY^"_$$POINTER^LR7OB63(63.23,.01,+X)_"^^^^"_Y6_"^"_SUB_"^CE^"_$P($G(^LAB(61.2,+X,0)),"^",2)_"^SNM^^^^^ETIOLOGY^^^"_Y18
"RTN","LR7OB63D",62,0)
 . D PTR(3,"FUNCTION",63.25,.01,61.3,"")
"RTN","LR7OB63D",63,0)
 . D PTR(4,"PROCEDURE",63.24,.01,61.5,"&CNP")
"RTN","LR7OB63D",64,0)
 . S IFN1=0
"RTN","LR7OB63D",65,0)
 . F  S IFN1=$O(^LR(LRDFN,"AY",IFN,5,IFN1)) Q:IFN1<1  S X=^(IFN1,0),IFN2=0 F  S IFN2=$O(^LR(LRDFN,"AY",IFN,5,IFN1,1,IFN2)) Q:IFN2<1  S X1=^(IFN2,0) D
"RTN","LR7OB63D",66,0)
 . . S CTR1=CTR1+1
"RTN","LR7OB63D",67,0)
 . . S ^TMP("LRX",$J,69,CTR,63,CTR1)="SPECIAL STUDIES "_$$SET^LR7OB63(63.26,.01,$P(X,"^"))_"~"_$P(X,"^",2)_"^"_X1_"^^^^^^TX^^^^^^^SPEC STUDIES "_$$SET^LR7OB63(63.26,.01,$P(X,"^"))_"~"_$P(X,"^",2)_"^^^"_Y18
"RTN","LR7OB63D",68,0)
 ;
"RTN","LR7OB63D",69,0)
 ; Print performing laboratory if designated
"RTN","LR7OB63D",70,0)
 D PPL^LR7OB63C
"RTN","LR7OB63D",71,0)
 ;
"RTN","LR7OB63D",72,0)
 Q
"RTN","LR7OB63D",73,0)
 ;
"RTN","LR7OB63D",74,0)
 ;
"RTN","LR7OB63D",75,0)
WP(I,NAME,ID,VALTYP) ;Store word processing fields
"RTN","LR7OB63D",76,0)
 ;I=Node at ^LR(LRDFN,I)
"RTN","LR7OB63D",77,0)
 ;NAME=Field name
"RTN","LR7OB63D",78,0)
 ;ID=Coded HL7 ID
"RTN","LR7OB63D",79,0)
 ;VALTYP="TX" for text, "CE" for coded
"RTN","LR7OB63D",80,0)
 N IFN,IFN1,X
"RTN","LR7OB63D",81,0)
 Q:'I  Q:'$L(NAME)
"RTN","LR7OB63D",82,0)
 S IFN=0
"RTN","LR7OB63D",83,0)
 F  S IFN=$O(^LR(LRDFN,I,IFN)) Q:IFN<1  S X=^(IFN,0) D
"RTN","LR7OB63D",84,0)
 . D SPLIT^LR7OU1(X,"^TMP(""LRX"",$J,69,"_CTR_",63)",.CTR1,80,NAME_"^","^^^^"_Y6_"^^"_VALTYP_"^^^"_ID_"^^^^"_NAME_"^^^"_Y18)
"RTN","LR7OB63D",85,0)
 Q
"RTN","LR7OB63D",86,0)
 ;
"RTN","LR7OB63D",87,0)
 ;
"RTN","LR7OB63D",88,0)
PTR(I,NAME,FILE,FIELD,SNMFILE,ID) ;Store ptr fields for ORGAN/TISSUE multiple
"RTN","LR7OB63D",89,0)
 ;I=Node at ^LR(LRDFN,'AY',IFN,I)
"RTN","LR7OB63D",90,0)
 ;NAME=Field name
"RTN","LR7OB63D",91,0)
 ;FILE=File #
"RTN","LR7OB63D",92,0)
 ;FIELD=Field #
"RTN","LR7OB63D",93,0)
 ;SNMFILE=Snomed file # for coded entry
"RTN","LR7OB63D",94,0)
 ;ID=Procedure ID Natl
"RTN","LR7OB63D",95,0)
 N IFN1
"RTN","LR7OB63D",96,0)
 Q:'I  Q:'$L(NAME)
"RTN","LR7OB63D",97,0)
 S IFN1=0 F  S IFN1=$O(^LR(LRDFN,"AY",IFN,I,IFN1)) Q:IFN1<1  S X=^(IFN1,0) D
"RTN","LR7OB63D",98,0)
 . S CTR1=CTR1+1,^TMP("LRX",$J,69,CTR,63,CTR1)=NAME_"^"_$$POINTER^LR7OB63(FILE,FIELD,+X)_"^^^^"_Y6_"^"_SUB_"^CE^"_$P($G(@("^LAB("_SNMFILE_","_+X_",0)")),"^",2)_"^SNM^"_ID_"^^^^"_NAME_"^^^"_Y18
"RTN","LR7OB63D",99,0)
 Q
"RTN","LR7OB63D",100,0)
 ;
"RTN","LR7OB63D",101,0)
 ;
"RTN","LR7OB63D",102,0)
OERR ;Call to OE/RR to setup/update order
"RTN","LR7OB63D",103,0)
 N X,DR
"RTN","LR7OB63D",104,0)
 Q:'$D(^LRO(68,LRAA,1,LRAD,1,LRAN,0))  S X=$P(^(0),"^",4),LRSN=$P(^(0),"^",5),X=$S($P($G(^LRO(69,+X,1,+LRSN,0)),"^",11):"SC",1:"SN") D ACC^LR7OB1(LRAA,LRAD,LRAN,X)
"RTN","LR7OB63D",105,0)
 ;
"RTN","LR7OB63D",106,0)
 I $T(EDIT^MAGT7MA)'="" D EDIT^MAGT7MA ; invoke Imaging HL7 routine - P433
"RTN","LR7OB63D",107,0)
 ;
"RTN","LR7OB63D",108,0)
 Q
"RTN","LR7OB63D",109,0)
 ;
"RTN","LR7OB63D",110,0)
 ;
"RTN","LR7OB63D",111,0)
OE1 ;Get 'before' status of accession
"RTN","LR7OB63D",112,0)
 N X
"RTN","LR7OB63D",113,0)
 S CORRECT=0
"RTN","LR7OB63D",114,0)
 Q:'$D(^LRO(68,LRAA,1,LRAD,1,LRAN,0))  S LRDFN=+^(0)
"RTN","LR7OB63D",115,0)
 I LRSS="AU" S:$P($G(^LR(LRDFN,LRSS)),"^",15) CORRECT=1 Q
"RTN","LR7OB63D",116,0)
 Q:'$D(^LRO(68,LRAA,1,LRAD,1,LRAN,3))  Q:'$P(^(3),"^",5)  S X=$P(^(3),"^",5)
"RTN","LR7OB63D",117,0)
 S:$P($G(^LR(LRDFN,LRSS,X,0)),"^",11) CORRECT=1
"RTN","LR7OB63D",118,0)
 Q
"RTN","LRAPED")
0^2^B33912945^B32844009
"RTN","LRAPED",1,0)
LRAPED ;DALOI/STAFF,PMK - ANATOMIC PATH EDIT LOG-IN ;17 Sep 2013 7:31 AM
"RTN","LRAPED",2,0)
 ;;5.2;LAB SERVICE;**1,31,72,115,259,350,427,433**;Sep 27, 1994;Build 4
"RTN","LRAPED",3,0)
 ;
"RTN","LRAPED",4,0)
 N LRTMP,LRREL,LRCOMP,LRMSG
"RTN","LRAPED",5,0)
 D ^LRAP Q:'$D(Y)
"RTN","LRAPED",6,0)
 D XR^LRU
"RTN","LRAPED",7,0)
 I LRCAPA D @(LRSS_"^LRAPSWK") G:'$D(X) END
"RTN","LRAPED",8,0)
 W !!,"EDIT ",LRO(68)," (",LRABV,") Log-In/Clinical Hx for ",LRH(0)," "
"RTN","LRAPED",9,0)
 S %=1 D YN^LRU G:%<1 END
"RTN","LRAPED",10,0)
 I %=2 D  G:Y<1 END
"RTN","LRAPED",11,0)
 . S %DT="AE",%DT(0)="-N",%DT("A")="Enter YEAR: "
"RTN","LRAPED",12,0)
 . D ^%DT K %DT
"RTN","LRAPED",13,0)
 . Q:Y<1
"RTN","LRAPED",14,0)
 . S LRAD=$E(Y,1,3)_"0000",Y=LRAD D D^LRU S LRH(0)=Y
"RTN","LRAPED",15,0)
 S LRC=$E(LRAD,1,3)
"RTN","LRAPED",16,0)
G ;
"RTN","LRAPED",17,0)
 W !!,"Enter ",LRO(68)," Accession #: " R LRAN:DTIME
"RTN","LRAPED",18,0)
 G:LRAN=""!(LRAN[U) END
"RTN","LRAPED",19,0)
 I LRAN'?1N.N!($E(LRAN)=0) D  G G
"RTN","LRAPED",20,0)
 .W $C(7),!," ENTER NUMBERS ONLY, No leading zero's"
"RTN","LRAPED",21,0)
 D EDIT
"RTN","LRAPED",22,0)
 ;
"RTN","LRAPED",23,0)
 I $T(EDIT^MAGT7MA)'="" D EDIT^MAGT7MA ; invoke Imaging HL7 routine - P433
"RTN","LRAPED",24,0)
 ;
"RTN","LRAPED",25,0)
 G G
"RTN","LRAPED",26,0)
 ;
"RTN","LRAPED",27,0)
 ;
"RTN","LRAPED",28,0)
EDIT ;
"RTN","LRAPED",29,0)
 N LRDIWESUB,LRFILE,LRACC
"RTN","LRAPED",30,0)
 S LRDFN=$O(^LR(LRXREF,LRC,LRABV,LRAN,0))
"RTN","LRAPED",31,0)
 I 'LRDFN W $C(7),"  Not in file" Q
"RTN","LRAPED",32,0)
 I '$D(^LR(LRDFN,0)) K ^LR(LRXREF,LRC,LRABV,LRAN,LRDFN) Q
"RTN","LRAPED",33,0)
 S X=^LR(LRDFN,0) D ^LRUP W !,LRP," ID: ",SSN," OK "
"RTN","LRAPED",34,0)
 S %=1 D YN^LRU Q:%'=1
"RTN","LRAPED",35,0)
 D @($S("CYEMSP"[LRSS:"I",1:"A"))
"RTN","LRAPED",36,0)
 Q
"RTN","LRAPED",37,0)
 ;
"RTN","LRAPED",38,0)
 ;
"RTN","LRAPED",39,0)
I ;Non-autopsy sections (SP,CY,EM)
"RTN","LRAPED",40,0)
 D GETDEF^LRAP
"RTN","LRAPED",41,0)
 S LRI=+$O(^LR(LRXREF,LRC,LRABV,LRAN,LRDFN,0))
"RTN","LRAPED",42,0)
 I '$D(^LR(LRDFN,LRSS,LRI,0)) D  Q
"RTN","LRAPED",43,0)
 . W $C(7),!,"Entry in x-ref but not in file ! X-ref deleted."
"RTN","LRAPED",44,0)
 . K ^LR(LRXREF,LRC,LRABV,LRAN,LRDFN,LRI)
"RTN","LRAPED",45,0)
 S X=^LR(LRDFN,LRSS,LRI,0),LRRC=$P(X,"^",10)
"RTN","LRAPED",46,0)
 S DA=LRI,DA(1)=LRDFN,DIE="^LR("_LRDFN_","""_LRSS_""",",(LRB,Y)=+X
"RTN","LRAPED",47,0)
 D D^LRU W !,"Specimen date: ",Y
"RTN","LRAPED",48,0)
 I $P(^LR(LRDFN,LRSS,LRI,0),"^",11)!($P(^(0),"^",3)) D  Q
"RTN","LRAPED",49,0)
 . W $C(7),!!,"Report released or completed.  Cannot edit Log-in data."
"RTN","LRAPED",50,0)
 D:LRCAPA C^LRAPSWK
"RTN","LRAPED",51,0)
 ;
"RTN","LRAPED",52,0)
DIE ;
"RTN","LRAPED",53,0)
 ;
"RTN","LRAPED",54,0)
 W ! D CK^LRU
"RTN","LRAPED",55,0)
 I $D(LR("CK")) K LR("CK") Q
"RTN","LRAPED",56,0)
 S LRACC=$P($G(^LR(LRDFN,LRSS,LRI,0)),"^",6)
"RTN","LRAPED",57,0)
 ;
"RTN","LRAPED",58,0)
 S LRDIWESUB="["_LRACC_"]"
"RTN","LRAPED",59,0)
 ;
"RTN","LRAPED",60,0)
 D SET,^DIE
"RTN","LRAPED",61,0)
 I $D(Y) D HELP G DIE
"RTN","LRAPED",62,0)
 D CK
"RTN","LRAPED",63,0)
 D:$O(^LR(LRDFN,LRSS,LRI,.1,0))&("SPCYEM"[LRSS)&(LRCAPA) C1^LRAPSWK
"RTN","LRAPED",64,0)
 D FRE^LRU
"RTN","LRAPED",65,0)
 Q
"RTN","LRAPED",66,0)
 ;
"RTN","LRAPED",67,0)
 ;
"RTN","LRAPED",68,0)
SET ; Setup fields for SP, CY and EM subscripts to edit.
"RTN","LRAPED",69,0)
 ;
"RTN","LRAPED",70,0)
 ;N LRFIELD,LRFILE
"RTN","LRAPED",71,0)
 ;S LRFILE=$S(LRSS="SP":63.08,LRSS="CY":63.09,LRSS="EM":63.02,1:"")
"RTN","LRAPED",72,0)
 ;F LRFIELD=.013,.014,.015,.016 S LRDIWESUB(LRFILE,LRFIELD)=$$SET2(LRFILE,LRFIELD,LRACC)
"RTN","LRAPED",73,0)
 ;
"RTN","LRAPED",74,0)
 S (LRJ,LRE,LRF)=""
"RTN","LRAPED",75,0)
 S DR=".08;S LRE=X;.07;S LRJ=X;S:LRJ LRJ=$P(^VA(200,LRJ,0),U);"
"RTN","LRAPED",76,0)
 S DR=DR_".011//^S X=LRJ;.012;.013;.014;.015;.016;.1;S LRG=X;.02;.021;"
"RTN","LRAPED",77,0)
 S DR=DR_".99;S LRF=X"
"RTN","LRAPED",78,0)
 ;
"RTN","LRAPED",79,0)
 I LRSS="SP" D
"RTN","LRAPED",80,0)
 . S DR(2,63.812)=".01;.06R//^S X=LRSPTOP(0);S:X LRSPTOP=X,LRSPTOP(0)=$P(^LAB(61,LRSPTOP,0),U)"
"RTN","LRAPED",81,0)
 . S DR(2,63.812)=DR(2,63.812)_";.07R//^S X=LRSAMP(0);S:X LRSAMP=X,LRSAMP(0)=$P(^LAB(62,LRSAMP,0),U)"
"RTN","LRAPED",82,0)
 ;
"RTN","LRAPED",83,0)
 I LRSS="CY" D
"RTN","LRAPED",84,0)
 . S DR(2,63.902)=".01;S LR(63.902)=X;.06R//^S X=LRSPTOP(0);S:X LRSPTOP=X,LRSPTOP(0)=$P(^LAB(61,LRSPTOP,0),U)"
"RTN","LRAPED",85,0)
 . S DR(2,63.902)=DR(2,63.902)_";.07R//^S X=LRSAMP(0);S:X LRSAMP=X,LRSAMP(0)=$P(^LAB(62,LRSAMP,0),U);S:'LRCAPA Y=""@2"";.02;@2"
"RTN","LRAPED",86,0)
 ;
"RTN","LRAPED",87,0)
 I LRSS="EM" D
"RTN","LRAPED",88,0)
 . S DR(2,63.202)=".01;.06R//^S X=LRSPTOP(0);S:X LRSPTOP=X,LRSPTOP(0)=$P(^LAB(61,LRSPTOP,0),U)"
"RTN","LRAPED",89,0)
 . S DR(2,63.202)=DR(2,63.202)_";.07R//^S X=LRSAMP(0);S:X LRSAMP=X,LRSAMP(0)=$P(^LAB(62,LRSAMP,0),U)"
"RTN","LRAPED",90,0)
 Q
"RTN","LRAPED",91,0)
 ;
"RTN","LRAPED",92,0)
 ;
"RTN","LRAPED",93,0)
SET1 ; Setup autopsy fields to edit.
"RTN","LRAPED",94,0)
 ;
"RTN","LRAPED",95,0)
 S LRJ="",DA=LRDFN,DIE="^LR(",DR="11;S LRRC=X;14.1;S LRLLOC=X;14.5;"
"RTN","LRAPED",96,0)
 S DR=DR_"14.6;S LRSVC=X;12.1;S LRMD=X;13.5:13.8"
"RTN","LRAPED",97,0)
 S:%=1 DR=DR_";16:24;26:31;25;31.1:31.4;25.1:25.9"
"RTN","LRAPED",98,0)
 D D^LRAUAW
"RTN","LRAPED",99,0)
 S (Y,LRB)=LR(63,12),LRI=9999999-$P(LRB,".")
"RTN","LRAPED",100,0)
 Q
"RTN","LRAPED",101,0)
 ;
"RTN","LRAPED",102,0)
 ;
"RTN","LRAPED",103,0)
SET2(FILE,FIELD,PREFIX) ; Build field name with specified prefix.
"RTN","LRAPED",104,0)
 ; Call with  FILE = file or subfile number
"RTN","LRAPED",105,0)
 ;           FIELD = field number of WP field
"RTN","LRAPED",106,0)
 ;          PREFIX = prefix for subject header
"RTN","LRAPED",107,0)
 ;
"RTN","LRAPED",108,0)
 N LABEL
"RTN","LRAPED",109,0)
 S LABEL=$$GET1^DID(FILE,FIELD,"","LABEL")
"RTN","LRAPED",110,0)
 I LABEL'="" S LABEL=PREFIX_" "_LABEL
"RTN","LRAPED",111,0)
 ;
"RTN","LRAPED",112,0)
 Q LABEL
"RTN","LRAPED",113,0)
 ;
"RTN","LRAPED",114,0)
 ;
"RTN","LRAPED",115,0)
A ;Autopsy
"RTN","LRAPED",116,0)
 S LRREL=+$$GET1^DIQ(63,LRDFN_",",14.7,"I")
"RTN","LRAPED",117,0)
 S LRCOMP=+$$GET1^DIQ(63,LRDFN_",",13,"I")
"RTN","LRAPED",118,0)
 I LRREL!LRCOMP D  Q
"RTN","LRAPED",119,0)
 . D EN^DDIOL($C(7)_"Report released or completed.  Cannot edit Log-in data.","","!!")
"RTN","LRAPED",120,0)
 W !!,"Edit Weights & Measurements " S %=2 D YN^LRU Q:%<1
"RTN","LRAPED",121,0)
 S LRRC=$P(^LR(LRDFN,"AU"),U),DA=LRDFN,DIE="^LR("
"RTN","LRAPED",122,0)
 D SET1,D^LRU
"RTN","LRAPED",123,0)
 W !!,"Date Died: ",Y
"RTN","LRAPED",124,0)
 I 'LRB D  Q
"RTN","LRAPED",125,0)
 . W $C(7),"?  Must have date died entered in ",LR(63,.02)," File."
"RTN","LRAPED",126,0)
 ;
"RTN","LRAPED",127,0)
 S LRACC=$P($G(^LR(LRDFN,"AU")),"^",6)
"RTN","LRAPED",128,0)
 ;
"RTN","LRAPED",129,0)
AU ;
"RTN","LRAPED",130,0)
 ;
"RTN","LRAPED",131,0)
 S LRDIWESUB="["_LRACC_"]"
"RTN","LRAPED",132,0)
 W ! D ^DIE
"RTN","LRAPED",133,0)
 I $D(Y) D HELP G AU
"RTN","LRAPED",134,0)
 D CK1
"RTN","LRAPED",135,0)
 Q
"RTN","LRAPED",136,0)
 ;
"RTN","LRAPED",137,0)
 ;
"RTN","LRAPED",138,0)
CK ;
"RTN","LRAPED",139,0)
 I '$D(^LR(LRDFN,LRSS,LRI)) D K
"RTN","LRAPED",140,0)
 Q
"RTN","LRAPED",141,0)
 ;
"RTN","LRAPED",142,0)
 ;
"RTN","LRAPED",143,0)
CK1 ;
"RTN","LRAPED",144,0)
 Q:'$D(^LRO(68,LRAA,1,LRAD,1,LRAN,0))  S X=^(0)
"RTN","LRAPED",145,0)
 S:'$D(^LRO(68,LRAA,1,LRAD,1,LRAN,3)) ^(3)=LRB_"^^^^"_LRI
"RTN","LRAPED",146,0)
 S LRTMP=$P(X,U,1,2)_U_LRRC_U_$P(X,U,4,6)_U_LRLLOC_U_LRMD_U_LRSVC
"RTN","LRAPED",147,0)
 S LRTMP=LRTMP_U_$P(X,U,10)
"RTN","LRAPED",148,0)
 S ^LRO(68,LRAA,1,LRAD,1,LRAN,0)=LRTMP
"RTN","LRAPED",149,0)
 S LRD=+$P(X,U,3)
"RTN","LRAPED",150,0)
 K ^LRO(68,LRAA,1,LRAD,1,"E",LRD,LRAN)
"RTN","LRAPED",151,0)
 S ^LRO(68,LRAA,1,LRAD,1,"E",LRRC,LRAN)=""
"RTN","LRAPED",152,0)
 S X=^LRO(68,LRAA,1,LRAD,1,LRAN,3),^(3)=LRB_U_$P(X,U,2,99)
"RTN","LRAPED",153,0)
 Q
"RTN","LRAPED",154,0)
 ;
"RTN","LRAPED",155,0)
 ;
"RTN","LRAPED",156,0)
K ;
"RTN","LRAPED",157,0)
 Q:'$D(^LRO(68,LRAA,1,LRAD,1,LRAN))  D K^LRUDEL
"RTN","LRAPED",158,0)
 L +^LRO(68,LRAA):999
"RTN","LRAPED",159,0)
 K ^LRO(68,LRAA,1,LRAD,1,LRAN),^LRO(68,LRAA,1,LRAD,1,"E",LRRC,LRAN)
"RTN","LRAPED",160,0)
 K ^LRO(68,LRAA,1,"AC",DUZ(2),LRAD,LRAN)
"RTN","LRAPED",161,0)
 S X=^LRO(68,LRAA,1,LRAD,1,0)
"RTN","LRAPED",162,0)
 S LRTMP=$P(X,"^",1,2)_"^"_(LRAN-1)_"^"_($P(X,"^",4)-1)
"RTN","LRAPED",163,0)
 S ^LRO(68,LRAA,1,LRAD,1,0)=LRTMP
"RTN","LRAPED",164,0)
 L -^LRO(68,LRAA)
"RTN","LRAPED",165,0)
 F A=1,2,3,4 D
"RTN","LRAPED",166,0)
 . I $D(^LRO(69.2,LRAA,A,LRAN)) K ^(LRAN) D
"RTN","LRAPED",167,0)
 . . S X(1)=$O(^LRO(69.2,LRAA,A,0)) S:'X(1) X(1)=0
"RTN","LRAPED",168,0)
 . . I $D(^LRO(69.2,LRAA,A,0)) D
"RTN","LRAPED",169,0)
 . . . L +^LRO(69.2,LRAA,A):999
"RTN","LRAPED",170,0)
 . . . S X=^LRO(69.2,LRAA,A,0)
"RTN","LRAPED",171,0)
 . . . S LRTMP=$P(X,"^",1,2)_"^"_X(1)_"^"_$S(X(1)=0:X(1),1:($P(X,"^",4)-1))
"RTN","LRAPED",172,0)
 . . . S ^LRO(69.2,LRAA,A,0)=LRTMP
"RTN","LRAPED",173,0)
 . . . L -^LRO(69.2,LRAA,A)
"RTN","LRAPED",174,0)
 Q
"RTN","LRAPED",175,0)
 ;
"RTN","LRAPED",176,0)
 ;
"RTN","LRAPED",177,0)
HELP ;
"RTN","LRAPED",178,0)
 W $C(7),!!,"Please do not exit EDIT with an ""^""."
"RTN","LRAPED",179,0)
 W !,"Press RETURN key repeatedly to complete the edit.",!!
"RTN","LRAPED",180,0)
 Q
"RTN","LRAPED",181,0)
 ;
"RTN","LRAPED",182,0)
 ;
"RTN","LRAPED",183,0)
END ;
"RTN","LRAPED",184,0)
 D V^LRU
"RTN","LRAPED",185,0)
 Q
"RTN","LRAPEDC")
0^3^B5938079^B5405480
"RTN","LRAPEDC",1,0)
LRAPEDC ;AVAMC/REG,WTY,PMK - EDIT ANATOMIC PATH COMMENTS ;23 Jul 2013 1:53 PM
"RTN","LRAPEDC",2,0)
 ;;5.2;LAB SERVICE;**72,259,433**;Sep 27, 1994;Build 4
"RTN","LRAPEDC",3,0)
 ;
"RTN","LRAPEDC",4,0)
 N LRREL,LRFLD,LRFILE,LRMSG
"RTN","LRAPEDC",5,0)
 S LRDICS="SPCYEM" D ^LRAP Q:'$D(Y)
"RTN","LRAPEDC",6,0)
 D XR^LRU
"RTN","LRAPEDC",7,0)
ASK ;
"RTN","LRAPEDC",8,0)
 W !?14,"1. Enter/edit specimen comment(s)"
"RTN","LRAPEDC",9,0)
 W !?14,"2. Enter/edit delayed report comment(s)"
"RTN","LRAPEDC",10,0)
 R !,"CHOOSE (1-2): ",X:DTIME
"RTN","LRAPEDC",11,0)
 G:X=""!(X[U) END
"RTN","LRAPEDC",12,0)
 I X'=1&(X'=2) D  G ASK
"RTN","LRAPEDC",13,0)
 .W $C(7),!,"Must select either a '1' or a '2'"
"RTN","LRAPEDC",14,0)
 S DR=$S(X=1:.99,1:.97),LR("C")=$S(X=1:"specimen",1:"delayed report")
"RTN","LRAPEDC",15,0)
 W !!,"EDIT ",LRO(68)," ",LR("C")," comments for ",LRH(0)," "
"RTN","LRAPEDC",16,0)
 S %=1 D YN^LRU G:%<1 END
"RTN","LRAPEDC",17,0)
 I %=2 D  G:Y<1 END
"RTN","LRAPEDC",18,0)
 .S %DT="AE",%DT(0)="-N",%DT("A")="Enter YEAR: "
"RTN","LRAPEDC",19,0)
 .D ^%DT K %DT
"RTN","LRAPEDC",20,0)
 .Q:Y<1
"RTN","LRAPEDC",21,0)
 .S LRAD=$E(Y,1,3)_"0000",Y=LRAD D D^LRU S LRH(0)=Y
"RTN","LRAPEDC",22,0)
 S LRC=$E(LRAD,1,3)
"RTN","LRAPEDC",23,0)
G ;
"RTN","LRAPEDC",24,0)
 W !!,"Enter ",LRO(68)," Accession #: "
"RTN","LRAPEDC",25,0)
 R LRAN:DTIME G:LRAN=""!(LRAN[U) END
"RTN","LRAPEDC",26,0)
 I LRAN'?1N.N W $C(7)," ENTER NUMBERS ONLY" G G
"RTN","LRAPEDC",27,0)
 D EDIT
"RTN","LRAPEDC",28,0)
 ;
"RTN","LRAPEDC",29,0)
 I $T(EDIT^MAGT7MA)'="" D EDIT^MAGT7MA ; invoke Imaging HL7 routine - P433
"RTN","LRAPEDC",30,0)
 ;
"RTN","LRAPEDC",31,0)
 G G
"RTN","LRAPEDC",32,0)
EDIT ;
"RTN","LRAPEDC",33,0)
 S LRDFN=$O(^LR(LRXREF,LRC,LRABV,LRAN,0))
"RTN","LRAPEDC",34,0)
 I 'LRDFN W $C(7),"  Not in file" Q
"RTN","LRAPEDC",35,0)
 I '$D(^LR(LRDFN,0)) K ^LR(LRXREF,LRC,LRABV,LRAN,LRDFN) Q
"RTN","LRAPEDC",36,0)
 S X=^LR(LRDFN,0) D ^LRUP
"RTN","LRAPEDC",37,0)
 W !,LRP," ID: ",SSN," OK "
"RTN","LRAPEDC",38,0)
 S %=1 D YN^LRU Q:%'=1
"RTN","LRAPEDC",39,0)
 S LRI=+$O(^LR(LRXREF,LRC,LRABV,LRAN,LRDFN,0))
"RTN","LRAPEDC",40,0)
 I '$D(^LR(LRDFN,LRSS,LRI,0)) D  Q
"RTN","LRAPEDC",41,0)
 .W $C(7),!,"Entry in x-ref but not in file ! X-ref deleted."
"RTN","LRAPEDC",42,0)
 .K ^LR(LRXREF,LRC,LRABV,LRAN,LRDFN,LRI)
"RTN","LRAPEDC",43,0)
 S LRFLD=$S(LRSS="SP":8,LRSS="CY":9,LRSS="EM":2,1:"")
"RTN","LRAPEDC",44,0)
 Q:LRFLD=""
"RTN","LRAPEDC",45,0)
 S LRFILE=+$$GET1^DID(63,LRFLD,"","SPECIFIER")
"RTN","LRAPEDC",46,0)
 S LRREL=+$$GET1^DIQ(LRFILE,LRI_","_LRDFN_",",.11,"I")
"RTN","LRAPEDC",47,0)
 I LRREL D  Q
"RTN","LRAPEDC",48,0)
 .K LRMSG
"RTN","LRAPEDC",49,0)
 .S LRMSG=$C(7)_"Report released.  Edit not allowed from this option."
"RTN","LRAPEDC",50,0)
 .D EN^DDIOL(LRMSG,"","!!")
"RTN","LRAPEDC",51,0)
 S X=^LR(LRDFN,LRSS,LRI,0)
"RTN","LRAPEDC",52,0)
 I $P($P(X,"^",6)," ")'=LRABV Q
"RTN","LRAPEDC",53,0)
 S LRD=$P(X,"^",10),DA=LRI,DA(1)=LRDFN,DIE="^LR(LRDFN,LRSS,"
"RTN","LRAPEDC",54,0)
 S (LRB,Y)=+X D D^LRU W !,"Specimen date: ",Y
"RTN","LRAPEDC",55,0)
 D ^DIE
"RTN","LRAPEDC",56,0)
 Q
"RTN","LRAPEDC",57,0)
END ;
"RTN","LRAPEDC",58,0)
 D V^LRU
"RTN","LRAPEDC",59,0)
 Q
"RTN","LRAPLG1")
0^4^B169348471^B165428544
"RTN","LRAPLG1",1,0)
LRAPLG1 ;DALOI/CKA,JMC,PMK - LOG-IN CONT. ;17 Sep 2013 7:31 AM
"RTN","LRAPLG1",2,0)
 ;;5.2;LAB SERVICE;**72,121,248,308,350,427,433**;Sep 27, 1994;Build 4
"RTN","LRAPLG1",3,0)
 ;
"RTN","LRAPLG1",4,0)
 ; Reference to DISP^SROSPLG supported by IA #893
"RTN","LRAPLG1",5,0)
 ;
"RTN","LRAPLG1",6,0)
START ; Start logging in the specimens.
"RTN","LRAPLG1",7,0)
 N LRFND,LRMSG,LRXX
"RTN","LRAPLG1",8,0)
 ;
"RTN","LRAPLG1",9,0)
 ; Lock ^LR( and ^LRO
"RTN","LRAPLG1",10,0)
 D LOCK^DILF("^LR(LRDFN,LRSS)")
"RTN","LRAPLG1",11,0)
 I '$T D  Q
"RTN","LRAPLG1",12,0)
 . S LRMSG="This record is locked by another user. Please try later."
"RTN","LRAPLG1",13,0)
 . D EN^DDIOL(LRMSG,"","!!")
"RTN","LRAPLG1",14,0)
 ;
"RTN","LRAPLG1",15,0)
 D LOCK^DILF("^LRO(68,LRAA,1,LRAD,1,0)")
"RTN","LRAPLG1",16,0)
 I '$T D  Q
"RTN","LRAPLG1",17,0)
 . L -^LR(LRDFN,LRSS)
"RTN","LRAPLG1",18,0)
 . S LRMSG="Someone else is logging in specimens.  Please wait and try again."
"RTN","LRAPLG1",19,0)
 . D EN^DDIOL(LRMSG,"","!!")
"RTN","LRAPLG1",20,0)
 ;
"RTN","LRAPLG1",21,0)
 ; Check that accession date exists first
"RTN","LRAPLG1",22,0)
 D CHECK68^LRWLST1(LRAA,LRAD)
"RTN","LRAPLG1",23,0)
 ;
"RTN","LRAPLG1",24,0)
EN ;
"RTN","LRAPLG1",25,0)
 N LRAPDAN
"RTN","LRAPLG1",26,0)
 ;
"RTN","LRAPLG1",27,0)
 S (LRI,LRIDT)=""
"RTN","LRAPLG1",28,0)
 S LRAN=1
"RTN","LRAPLG1",29,0)
 S LRAPDAN=$$GET^XPAR("ALL","LR AP DEFAULT ACCESSION NUMBER","`"_LRAA,"Q")
"RTN","LRAPLG1",30,0)
 I LRAPDAN=2 S LRAN=+$P(^LRO(68,LRAA,1,LRAD,1,0),U,3)
"RTN","LRAPLG1",31,0)
 F  Q:'$D(^LRO(68,LRAA,1,LRAD,1,LRAN))  S LRAN=LRAN+1
"RTN","LRAPLG1",32,0)
 W !!,"Assign ",LRO(68)," (",LRABV,") accession #: ",LRAN S %=1 D YN^LRU
"RTN","LRAPLG1",33,0)
 I %<1 L -^LRO(68,LRAA,1,LRAD,1,0),-^LR(LRDFN,LRSS) Q
"RTN","LRAPLG1",34,0)
 ;
"RTN","LRAPLG1",35,0)
 I %=1,$D(LRXREF),$D(^LR(LRXREF,LRH(2),LRABV,LRAN)) D  Q:$D(LRFND)
"RTN","LRAPLG1",36,0)
 . I $D(^LRO(68,LRAA,1,LRAD,1,LRAN,0)),$P(^(0),U) S X=LRAN D ^LRUTELL S LRFND=1
"RTN","LRAPLG1",37,0)
 . I '$D(LRFND) D ^LRAPLG2
"RTN","LRAPLG1",38,0)
 . I $D(LRFND) L -^LRO(68,LRAA,1,LRAD,1,0),-^LR(LRDFN,LRSS) Q
"RTN","LRAPLG1",39,0)
 . S %=0
"RTN","LRAPLG1",40,0)
 ;
"RTN","LRAPLG1",41,0)
 I %=1 D CRE868 I $D(LRMSG) G EN
"RTN","LRAPLG1",42,0)
 ;
"RTN","LRAPLG1",43,0)
 I %=2 D OS I $D(LRFND) K LRFND L -^LRO(68,LRAA,1,LRAD,1,0),-^LR(LRDFN,LRSS) Q
"RTN","LRAPLG1",44,0)
 ;
"RTN","LRAPLG1",45,0)
 L -^LRO(68,LRAA,1,LRAD,1,0)
"RTN","LRAPLG1",46,0)
 ;
"RTN","LRAPLG1",47,0)
 S LRAC=$P(^LRO(68,LRAA,0),U,11)_" "_$S(LRAD["0000":$E(LRAD,2,3),1:$E(LRAD,4,7))_" "_LRAN
"RTN","LRAPLG1",48,0)
 ;
"RTN","LRAPLG1",49,0)
AU ; Autopsy Specific
"RTN","LRAPLG1",50,0)
 I LRSS="AU" D ^LRAUAW Q
"RTN","LRAPLG1",51,0)
 S:'$D(^LR(LRDFN,LRSS,0)) ^(0)="^"_LRSF_"DA^0^0"
"RTN","LRAPLG1",52,0)
 ;
"RTN","LRAPLG1",53,0)
 ; If orginal login then create entry in file #63
"RTN","LRAPLG1",54,0)
LR7OFA0 ;
"RTN","LRAPLG1",55,0)
 I LRIDT="" D CRE863
"RTN","LRAPLG1",56,0)
 I LRI="" Q
"RTN","LRAPLG1",57,0)
 ;
"RTN","LRAPLG1",58,0)
 K DA,DTOUT,DIWESUB
"RTN","LRAPLG1",59,0)
 ;S DIWESUB=$E(PNM,1,27-$L(LRACC))_" ["_LRACC_"]"
"RTN","LRAPLG1",60,0)
 S LR(.07)=$S($D(SRDOC):SRDOC,1:"") K SRDOC
"RTN","LRAPLG1",61,0)
 S:LR(.07) LR(.07)=$P($G(^VA(200,LR(.07),0)),"^")
"RTN","LRAPLG1",62,0)
 S DA=LRI,DA(1)=LRDFN
"RTN","LRAPLG1",63,0)
 S DIC(0)="EQLMF",DLAYGO=63,DIE="^LR(LRDFN,LRSS,"
"RTN","LRAPLG1",64,0)
 D @LR("L")
"RTN","LRAPLG1",65,0)
 D ^DIE K DLAYGO
"RTN","LRAPLG1",66,0)
 S:'$D(LRRC) LRRC=LRNT
"RTN","LRAPLG1",67,0)
 ;
"RTN","LRAPLG1",68,0)
 ; Check if topography and collection sample entered on each specimen.
"RTN","LRAPLG1",69,0)
 ; If not entered then define Y to cause entry to be deleted.
"RTN","LRAPLG1",70,0)
 I LRSS?1(1"SP",1"CY",1"EM") D
"RTN","LRAPLG1",71,0)
 . N I,LRJ,X
"RTN","LRAPLG1",72,0)
 . S LRJ=0
"RTN","LRAPLG1",73,0)
 . F  S LRJ=$O(^LR(LRDFN,LRSS,LRI,.1,LRJ)) Q:LRJ<1  D  Q:$D(Y)
"RTN","LRAPLG1",74,0)
 . . S X=$G(^LR(LRDFN,LRSS,LRI,.1,LRJ,0))
"RTN","LRAPLG1",75,0)
 . . F I=6,7 I $P(X,"^",I)="" S Y="" Q
"RTN","LRAPLG1",76,0)
 ;
"RTN","LRAPLG1",77,0)
 ; Delete entry if prompts not answered unless report has been released.
"RTN","LRAPLG1",78,0)
 I $D(DTOUT)!$D(Y) D  Q
"RTN","LRAPLG1",79,0)
 . N DA,DIK
"RTN","LRAPLG1",80,0)
 . I LRSS?1(1"SP",1"CY",1"EM"),($P(^LR(LRDFN,LRSS,LRI,0),"^",11)!$P(^LR(LRDFN,LRSS,LRI,0),"^",15)) Q
"RTN","LRAPLG1",81,0)
 . W $C(7),!!,"All Prompts not answered - <ENTRY DELETED>"
"RTN","LRAPLG1",82,0)
 . S DA(1)=LRDFN,DA=LRI
"RTN","LRAPLG1",83,0)
 . S DIK="^LR("_DA(1)_","""_LRSS_""","
"RTN","LRAPLG1",84,0)
 . D ^DIK,X,END
"RTN","LRAPLG1",85,0)
 ;
"RTN","LRAPLG1",86,0)
 D GETSTCS ; Store specimen topography, coll sample in temp array
"RTN","LRAPLG1",87,0)
 ;
"RTN","LRAPLG1",88,0)
TST ; Get the ordered test and store in temp array
"RTN","LRAPLG1",89,0)
 N II
"RTN","LRAPLG1",90,0)
 D ORDTST
"RTN","LRAPLG1",91,0)
 ; Delete entry if no ordered tests unless report has been released.
"RTN","LRAPLG1",92,0)
 I II=2 D  Q
"RTN","LRAPLG1",93,0)
 . I LRSS?1(1"SP",1"CY",1"EM"),($P(^LR(LRDFN,LRSS,LRI,0),"^",11)!$P(^LR(LRDFN,LRSS,LRI,0),"^",15)) Q
"RTN","LRAPLG1",94,0)
 . N DA,DIK
"RTN","LRAPLG1",95,0)
 . W $C(7),!!,"No ordered test selected - <ENTRY DELETED>"
"RTN","LRAPLG1",96,0)
 . S DA(1)=LRDFN,DA=LRI,DIK="^LR("_DA(1)_","""_LRSS_""","
"RTN","LRAPLG1",97,0)
 . D ^DIK,X,END
"RTN","LRAPLG1",98,0)
 ;
"RTN","LRAPLG1",99,0)
 I LRSS="CY",LRCAPA D CK^LRAPCWK
"RTN","LRAPLG1",100,0)
 ;
"RTN","LRAPLG1",101,0)
 ; Check for surgery case references and move info if user wants surgical case info copied to Lab.
"RTN","LRAPLG1",102,0)
 I LRSS="SP" D SPMOVE
"RTN","LRAPLG1",103,0)
 ;
"RTN","LRAPLG1",104,0)
 ; Fill out the stub accession with related info
"RTN","LRAPLG1",105,0)
 I '$D(LRC(5)) S LRC(5)=""
"RTN","LRAPLG1",106,0)
 D ^LRUWLF
"RTN","LRAPLG1",107,0)
 ;
"RTN","LRAPLG1",108,0)
 I LRCAPA D
"RTN","LRAPLG1",109,0)
 . I LRSS="CY" D ^LRAPCWK
"RTN","LRAPLG1",110,0)
 . I LRSS?1(1"SP",1"EM") D ^LRAPSWK
"RTN","LRAPLG1",111,0)
 ;
"RTN","LRAPLG1",112,0)
 I LRSS?1(1"SP",1"CY",1"EM") D ^LRSPGD
"RTN","LRAPLG1",113,0)
 ;
"RTN","LRAPLG1",114,0)
 I $T(ADD^MAGTP005)'="" N MAGNEWCASE S MAGNEWCASE=1 D ADD^MAGTP005(LRAC) ; add case to file #2005.42 - P433
"RTN","LRAPLG1",115,0)
 ;
"RTN","LRAPLG1",116,0)
 D OERR^LR7OB63D,LDSI
"RTN","LRAPLG1",117,0)
 ;
"RTN","LRAPLG1",118,0)
 I $T(NEW^MAGT7MA)'="" D NEW^MAGT7MA ; invoke Imaging HL7 routine - P433
"RTN","LRAPLG1",119,0)
 ;
"RTN","LRAPLG1",120,0)
 Q
"RTN","LRAPLG1",121,0)
 ;
"RTN","LRAPLG1",122,0)
 ;
"RTN","LRAPLG1",123,0)
LDSI ; LDSI tasks
"RTN","LRAPLG1",124,0)
 ;
"RTN","LRAPLG1",125,0)
 N LRLLOC,LRALOC,LRPRAC,LROUTINE,LROPL,LRODT,LRNT,LRFILE,LRIENS,LRORD,LRORDR,LRSRDT,LRTST
"RTN","LRAPLG1",126,0)
 ;
"RTN","LRAPLG1",127,0)
 ; Get variables for ORUT node
"RTN","LRAPLG1",128,0)
 S LROUTINE=$P($G(^LAB(69.9,1,3)),"^",2)    ;default urgency
"RTN","LRAPLG1",129,0)
 S LRPROVL=LRMD(1)    ;Ordering provider-CKA
"RTN","LRAPLG1",130,0)
 ; Get ORDER TYPE
"RTN","LRAPLG1",131,0)
 ;S LROT=??
"RTN","LRAPLG1",132,0)
 S LRORDR="SP" ;Default to 'Send Patient' for now
"RTN","LRAPLG1",133,0)
 S LRNT=$$NOW^XLFDT() ;Date ordered = current date/time
"RTN","LRAPLG1",134,0)
 S LRODT=$P(LRNT,".")
"RTN","LRAPLG1",135,0)
 ; Get Provider, Location abbrev, Collection date/time
"RTN","LRAPLG1",136,0)
 S LRFILE=$S(LRSS="SP":63.08,LRSS="CY":63.09,LRSS="EM":63.02,1:"")
"RTN","LRAPLG1",137,0)
 S LRIENS=LRI_","_LRDFN_","
"RTN","LRAPLG1",138,0)
 S LRPRAC=+$$GET1^DIQ(LRFILE,LRIENS,.07,"I")
"RTN","LRAPLG1",139,0)
 S LRLLOC=$$GET1^DIQ(LRFILE,LRIENS,.08,"I")
"RTN","LRAPLG1",140,0)
 I LRLLOC="" S LRLLOC="NO ABRV"
"RTN","LRAPLG1",141,0)
 S LRSDT=+$$GET1^DIQ(LRFILE,LRIENS,.01,"I")
"RTN","LRAPLG1",142,0)
 S LRSRDT=$$GET1^DIQ(LRFILE,LRIENS,.1,"I") ; Specimen received date/time
"RTN","LRAPLG1",143,0)
 ; Get CPRS Order #
"RTN","LRAPLG1",144,0)
 S ORIFN="" ; Default to blank for now
"RTN","LRAPLG1",145,0)
 ;
"RTN","LRAPLG1",146,0)
 ; Get Lab Order #, update file #69 and #68
"RTN","LRAPLG1",147,0)
 S (LRORD,LRSPEC,LRTST,LRSAMP,LRADD,LROT)="",LRCNT=1
"RTN","LRAPLG1",148,0)
 F  S LRSPEC=$O(LRXX(LRSPEC)) Q:'LRSPEC  D
"RTN","LRAPLG1",149,0)
 . N LRRECINF
"RTN","LRAPLG1",150,0)
 . S LRSAMP=$P(LRXX(LRSPEC),"^",1),LRNLT=$P(LRXX(LRSPEC),"^",2),LRTST=$P(LRXX(LRSPEC),"^",3)
"RTN","LRAPLG1",151,0)
 . Q:'LRTST
"RTN","LRAPLG1",152,0)
 . ; Add entry in #69 for each specimen
"RTN","LRAPLG1",153,0)
 . I LRORD S LRADD=1 D ZSN^LR7OFAO("",.LRRECINF)
"RTN","LRAPLG1",154,0)
 . ; Get Lab Order # first time thru
"RTN","LRAPLG1",155,0)
 . D:'LRORD EN^LR7OFAO(LRODT,LRDFN,LRSAMP,LRORDR,LRNT,LRPRAC,LRLLOC,LRSDT,ORIFN,LRSPEC,LRSS,LRTST,LRUID,.LRRECINF)
"RTN","LRAPLG1",156,0)
 . S LRSN=+$P(^LRO(68,LRAA,1,LRAD,1,LRAN,0),U,5),LRCDT=0,LREAL=""
"RTN","LRAPLG1",157,0)
 . I LRSN>0 S LRCDT=$P($G(^LRO(69,LRODT,1,LRSN,1)),"^",1,2),LREAL=$P(LRCDT,"^",2),LRCDT=+LRCDT
"RTN","LRAPLG1",158,0)
 . D UPD68,UPD63
"RTN","LRAPLG1",159,0)
 . S LRCNT=LRCNT+1
"RTN","LRAPLG1",160,0)
 ;
"RTN","LRAPLG1",161,0)
 Q
"RTN","LRAPLG1",162,0)
 ;
"RTN","LRAPLG1",163,0)
 ;
"RTN","LRAPLG1",164,0)
UPD68 ; Update #68 with required test data
"RTN","LRAPLG1",165,0)
 N LRFILE,LRERR,IEN,LRIEN
"RTN","LRAPLG1",166,0)
 S LRFILE=68.04,IEN(1)=LRTST
"RTN","LRAPLG1",167,0)
 S LRIEN="?+1,"_LRAN_","_LRAD_","_LRAA_","
"RTN","LRAPLG1",168,0)
 S FDA(3,LRFILE,LRIEN,.01)=LRTST
"RTN","LRAPLG1",169,0)
 S FDA(3,LRFILE,LRIEN,1)=LROUTINE
"RTN","LRAPLG1",170,0)
 D UPDATE^DIE("","FDA(3)","IEN","LRERR(3)")
"RTN","LRAPLG1",171,0)
 I $D(LRERR(3)) D LRMSG("UPD68-3~LRAPLG1",.LRERR)
"RTN","LRAPLG1",172,0)
 ;. S ^LRO(68,LRAA,1,LRAD,1,LRAN,4,LRTST,0)=LRTST_"^"_LROUTINE
"RTN","LRAPLG1",173,0)
 ;
"RTN","LRAPLG1",174,0)
 ; Update #68 with specimen data
"RTN","LRAPLG1",175,0)
 K LRFILE,FDAIEN,IEN
"RTN","LRAPLG1",176,0)
 S LRFILE=68.05
"RTN","LRAPLG1",177,0)
 ; Check or Set top node for 68.05
"RTN","LRAPLG1",178,0)
 S FDAIEN="?+"_LRCNT_","_LRAN_","_LRAD_","_LRAA_","
"RTN","LRAPLG1",179,0)
 S FDA(31,LRFILE,FDAIEN,.01)=LRSPEC
"RTN","LRAPLG1",180,0)
 S FDA(31,LRFILE,FDAIEN,1)=LRSAMP
"RTN","LRAPLG1",181,0)
 D UPDATE^DIE("","FDA(31)","IEN","LRERR(31)")
"RTN","LRAPLG1",182,0)
 I $D(LRERR(31)) D LRMSG("UPD68-31~LRAPLG1",.LRERR)
"RTN","LRAPLG1",183,0)
 ;
"RTN","LRAPLG1",184,0)
 Q
"RTN","LRAPLG1",185,0)
 ;
"RTN","LRAPLG1",186,0)
 ;
"RTN","LRAPLG1",187,0)
UPD63 ; Update ORUT Node in #63
"RTN","LRAPLG1",188,0)
 S LRTSORU=LRTST,LRURG=9,LRI=LRIDT
"RTN","LRAPLG1",189,0)
 D SLRSS^LRWLST11
"RTN","LRAPLG1",190,0)
 D ORUT^LRWLST11
"RTN","LRAPLG1",191,0)
 ;. S ^LR(LRDFN,LRSS,LRI,"ORUT",LRCNT,0)=LRNLT_"^"_LROUTINE_"^"_ORIFN_"^"_LRORD_"^"_LROT_"^"_LRPRAC_"^^"_LRSPEC_"^"_LRSAMP
"RTN","LRAPLG1",192,0)
 ;
"RTN","LRAPLG1",193,0)
 Q
"RTN","LRAPLG1",194,0)
 ;
"RTN","LRAPLG1",195,0)
 ;
"RTN","LRAPLG1",196,0)
X ; from LRAUAW
"RTN","LRAPLG1",197,0)
 I "CYEMSP"[LRSS K ^LR(LRXREF,LRH(2),LRABV,LRAN)
"RTN","LRAPLG1",198,0)
 I LRSS="AU" D
"RTN","LRAPLG1",199,0)
 . I $D(^LR(LRDFN,"AV")) K ^LR(LRDFN,"AV")
"RTN","LRAPLG1",200,0)
 . I $D(^LR(LRDFN,"AW")) K ^LR(LRDFN,"AW")
"RTN","LRAPLG1",201,0)
 . I $D(^LR(LRDFN,"AWI")) K ^LR(LRDFN,"AWI")
"RTN","LRAPLG1",202,0)
 . I $D(LRRC) K ^LR("AAUA",+$E(LRRC,1,3),LRABV,LRAN),^LR("AAU",+LRRC,LRDFN)
"RTN","LRAPLG1",203,0)
 I $G(LRRC)>1 K:LRSS?1(1"SP",1"CY",1"EM") ^LR(LRXR,LRRC,LRDFN,LRI)
"RTN","LRAPLG1",204,0)
 K LRRC
"RTN","LRAPLG1",205,0)
 Q
"RTN","LRAPLG1",206,0)
 ;
"RTN","LRAPLG1",207,0)
 ;
"RTN","LRAPLG1",208,0)
OS ; User choosing accession number
"RTN","LRAPLG1",209,0)
 N DIR,DIROUT,DIRUT,DTOUT,LRSPEC,X,Y
"RTN","LRAPLG1",210,0)
 S DIR(0)="N^1:999999:0^D OSDIR^LRAPLG1"
"RTN","LRAPLG1",211,0)
 S DIR("A")="Enter Accession #"
"RTN","LRAPLG1",212,0)
 D ^DIR
"RTN","LRAPLG1",213,0)
 I $D(DIRUT) S LRFND=1 Q
"RTN","LRAPLG1",214,0)
 S LRAN=Y
"RTN","LRAPLG1",215,0)
 ;
"RTN","LRAPLG1",216,0)
 I $G(^LRO(68,LRAA,1,LRAD,1,LRAN,0)) D  Q
"RTN","LRAPLG1",217,0)
 . I $D(LRXREF),$D(^LR(LRXREF,LRH(2),LRABV,LRAN,LRDFN)) D
"RTN","LRAPLG1",218,0)
 . . S (LRI,LRIDT)=$O(^LR(LRXREF,LRH(2),LRABV,LRAN,LRDFN,0))
"RTN","LRAPLG1",219,0)
 . . I LRIDT S LRSD=$P($G(^LR(LRDFN,LRSS,LRIDT,0)),"^")
"RTN","LRAPLG1",220,0)
 ;
"RTN","LRAPLG1",221,0)
 I $D(LRXREF),$D(^LR(LRXREF,LRH(2),LRABV,LRAN)) D ^LRAPLG2 Q
"RTN","LRAPLG1",222,0)
 ;
"RTN","LRAPLG1",223,0)
 D CRE868
"RTN","LRAPLG1",224,0)
 I $D(LRMSG) S LRFND=1
"RTN","LRAPLG1",225,0)
 Q
"RTN","LRAPLG1",226,0)
 ;
"RTN","LRAPLG1",227,0)
 ;R !!,"Enter Accession #: ",X:DTIME I X=""!(X[U) S LRFND=1 Q
"RTN","LRAPLG1",228,0)
 ;I X'?1N.N!(X<1)!(X>99999) W $C(7),!!,"ENTER A WHOLE NUMBER FROM 1 TO 99999",! G OS
"RTN","LRAPLG1",229,0)
 ;I $D(^LRO(68,LRAA,1,LRAD,1,X,0)),$P(^(0),U) D ^LRUTELL G OS
"RTN","LRAPLG1",230,0)
 ;S LRAN=X
"RTN","LRAPLG1",231,0)
 ;S ^LRO(68,LRAA,1,LRAD,1,X,0)=LRDFN
"RTN","LRAPLG1",232,0)
 ;I $D(LRXREF),$D(^LR(LRXREF,LRH(2),LRABV,X)) D
"RTN","LRAPLG1",233,0)
 ;. D ^LRAPLG2 S LRFND=1
"RTN","LRAPLG1",234,0)
 ;L -^LRO(68,LRAA,1,LRAD,1,0)
"RTN","LRAPLG1",235,0)
 ;
"RTN","LRAPLG1",236,0)
 ;
"RTN","LRAPLG1",237,0)
OSDIR ; Called from DIR call in OS above
"RTN","LRAPLG1",238,0)
 ;
"RTN","LRAPLG1",239,0)
 ;ZEXCEPT: LRAA,LRAD,LRDFN,X
"RTN","LRAPLG1",240,0)
 ;
"RTN","LRAPLG1",241,0)
 ; Accession number doesn't exist in file #68 - quit, OK to use this number
"RTN","LRAPLG1",242,0)
 I $O(^LRO(68,LRAA,1,LRAD,1,+X,""))="" Q
"RTN","LRAPLG1",243,0)
 ;
"RTN","LRAPLG1",244,0)
 N LRX
"RTN","LRAPLG1",245,0)
 S LRX=$G(^LRO(68,LRAA,1,LRAD,1,+X,0))
"RTN","LRAPLG1",246,0)
 I LRX<1 K X Q
"RTN","LRAPLG1",247,0)
 ;
"RTN","LRAPLG1",248,0)
 ; Stub entry which matches on LRDFN
"RTN","LRAPLG1",249,0)
 I LRX=LRDFN Q
"RTN","LRAPLG1",250,0)
 ;
"RTN","LRAPLG1",251,0)
 I $P(LRX,U)'=LRDFN S X=+X D ^LRUTELL K X
"RTN","LRAPLG1",252,0)
 ;
"RTN","LRAPLG1",253,0)
 Q
"RTN","LRAPLG1",254,0)
 ;
"RTN","LRAPLG1",255,0)
 ;
"RTN","LRAPLG1",256,0)
ORDTST ; Prompt for ordered test(s); translate to NLT code for storage in ORUT
"RTN","LRAPLG1",257,0)
 ; Add NLT code to temp array LRXX (This code currently assumes one ordered test per accession)
"RTN","LRAPLG1",258,0)
 ;
"RTN","LRAPLG1",259,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT,LRNLT,LRWKCD,XX
"RTN","LRAPLG1",260,0)
 S (LRNLT,LRWKCD)="",II=0
"RTN","LRAPLG1",261,0)
 S DIR(0)="P^LAB(60,:AEMOQ",DIR("B")=$G(LRTST(0))
"RTN","LRAPLG1",262,0)
 S DIR("S")="I $P(^LAB(60,Y,0),""^"",4)=LRSS,""IBO""[$P(^LAB(60,Y,0),""^"",3),$P($G(^LAB(60,Y,64)),""^"")"
"RTN","LRAPLG1",263,0)
 D ^DIR
"RTN","LRAPLG1",264,0)
 I $D(DIRUT) S II=2 Q
"RTN","LRAPLG1",265,0)
 S LRWKCD=+$G(^LAB(60,+Y,64)),LRNLT=$P($G(^LAM(LRWKCD,0)),"^",2),II=1
"RTN","LRAPLG1",266,0)
 S XX=0
"RTN","LRAPLG1",267,0)
 F  S XX=$O(LRXX(XX)) Q:'XX  S $P(LRXX(XX),"^",2)=LRNLT_"^"_+Y
"RTN","LRAPLG1",268,0)
 ;
"RTN","LRAPLG1",269,0)
 Q
"RTN","LRAPLG1",270,0)
 ;
"RTN","LRAPLG1",271,0)
 ;
"RTN","LRAPLG1",272,0)
GETSTCS ;Get spec top and coll samp
"RTN","LRAPLG1",273,0)
 N LRI
"RTN","LRAPLG1",274,0)
 K LRXX
"RTN","LRAPLG1",275,0)
 S LRI=0,(LRXX,X)=""
"RTN","LRAPLG1",276,0)
 F  S LRI=$O(^LR(LRDFN,LRSS,LRIDT,.1,LRI)) Q:'LRI  D
"RTN","LRAPLG1",277,0)
 . S X=$G(^LR(LRDFN,LRSS,LRIDT,.1,LRI,0))
"RTN","LRAPLG1",278,0)
 . I $P(X,"^",6)'="" S LRXX($P(X,"^",6))=$P(X,"^",7)_"^"
"RTN","LRAPLG1",279,0)
 Q
"RTN","LRAPLG1",280,0)
 ;
"RTN","LRAPLG1",281,0)
 ;
"RTN","LRAPLG1",282,0)
CRE868 ; Create accession number in file 68
"RTN","LRAPLG1",283,0)
 N LRFDA,LRFDAIEN,LRIEN
"RTN","LRAPLG1",284,0)
 K LRMSG
"RTN","LRAPLG1",285,0)
 S LRIEN="+1,"_LRAD_","_LRAA_","
"RTN","LRAPLG1",286,0)
 S LRFDAIEN(1)=LRAN
"RTN","LRAPLG1",287,0)
 S LRFDA(1,68.02,LRIEN,.01)=LRDFN
"RTN","LRAPLG1",288,0)
 D UPDATE^DIE("S","LRFDA(1)","LRFDAIEN","LRMSG")
"RTN","LRAPLG1",289,0)
 I $D(LRMSG) S LRSD=LRAD D LRMSG("EN~LRAPGL1",.LRMSG) Q
"RTN","LRAPLG1",290,0)
 S X=LRAN
"RTN","LRAPLG1",291,0)
 Q
"RTN","LRAPLG1",292,0)
 ;
"RTN","LRAPLG1",293,0)
 ;
"RTN","LRAPLG1",294,0)
CRE863 ; Create entry in file #63
"RTN","LRAPLG1",295,0)
 ;
"RTN","LRAPLG1",296,0)
 N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","LRAPLG1",297,0)
 S DIR(0)="DO^:NOW:ET"
"RTN","LRAPLG1",298,0)
 S DIR("A")="Date/time Specimen taken",DIR("B")="NOW"
"RTN","LRAPLG1",299,0)
 D ^DIR K DIR
"RTN","LRAPLG1",300,0)
 I Y<1 D END Q
"RTN","LRAPLG1",301,0)
 S (LRY,LRSD)=Y,LRI=9999999-LRY
"RTN","LRAPLG1",302,0)
 ;
"RTN","LRAPLG1",303,0)
 ; Process and get unique LRI
"RTN","LRAPLG1",304,0)
 F  Q:'$D(^LR(LRDFN,LRSS,LRI,0))  D
"RTN","LRAPLG1",305,0)
 . S (LRSD,LRY)=$$FMADD^XLFDT(LRY,,,,1)
"RTN","LRAPLG1",306,0)
 . S LRI=9999999-LRY
"RTN","LRAPLG1",307,0)
 ;
"RTN","LRAPLG1",308,0)
 N LRFDA,LRIEN,LRFILE,LRFDAIEN
"RTN","LRAPLG1",309,0)
 K DIERR,LRMSG
"RTN","LRAPLG1",310,0)
 S LRACC=LRAC,LRNT=$$NOW^XLFDT()
"RTN","LRAPLG1",311,0)
 S LRFILE=$S(LRSS="SP":63.08,LRSS="CY":63.09,LRSS="EM":63.02,1:63.08)
"RTN","LRAPLG1",312,0)
 S LRFDAIEN(1)=LRI
"RTN","LRAPLG1",313,0)
 S LRIEN="+1,"_LRDFN_","
"RTN","LRAPLG1",314,0)
 S LRFDA(2,LRFILE,LRIEN,.01)=LRSD
"RTN","LRAPLG1",315,0)
 S LRFDA(2,LRFILE,LRIEN,.06)=LRACC
"RTN","LRAPLG1",316,0)
 ;
"RTN","LRAPLG1",317,0)
 D UPDATE^DIE("","LRFDA(2)","LRFDAIEN","LRMSG")
"RTN","LRAPLG1",318,0)
 L -^LR(LRDFN,LRSS)
"RTN","LRAPLG1",319,0)
 I $D(LRMSG) D LRMSG("F~LRAPLG1",.LRMSG) Q
"RTN","LRAPLG1",320,0)
 ;
"RTN","LRAPLG1",321,0)
 S (LRI,LRIDT)=LRFDAIEN(1)
"RTN","LRAPLG1",322,0)
 ;
"RTN","LRAPLG1",323,0)
 Q
"RTN","LRAPLG1",324,0)
 ;
"RTN","LRAPLG1",325,0)
 ;
"RTN","LRAPLG1",326,0)
SPMOVE ; Copy surgery information into lab package
"RTN","LRAPLG1",327,0)
 ;  - store surgery package reference to retrieve surgeon/attending.
"RTN","LRAPLG1",328,0)
 ;  - LRFLAG used to determine if data copied from Surgery packge and moved to Lab and generate notice.
"RTN","LRAPLG1",329,0)
 ;         if no data before and data after call to SROSPLG then add disclaimer.
"RTN","LRAPLG1",330,0)
 ;
"RTN","LRAPLG1",331,0)
 S X="SROSPLG" X ^%ZOSF("TEST")
"RTN","LRAPLG1",332,0)
 I '$T Q
"RTN","LRAPLG1",333,0)
 ;
"RTN","LRAPLG1",334,0)
 N I,LRFIELD,LRFLAG,LRJ,LRSREF,LRSRTN,LRWP
"RTN","LRAPLG1",335,0)
 S LRFLAG="",LRSRTN=$G(SRTN)
"RTN","LRAPLG1",336,0)
 I LRSRTN D
"RTN","LRAPLG1",337,0)
 . N LRDATA,LRDIE
"RTN","LRAPLG1",338,0)
 . S LRDATA(.01)=LRDFN_","_LRSS_","_LRI_",0"
"RTN","LRAPLG1",339,0)
 . S LRDATA(.02)=1
"RTN","LRAPLG1",340,0)
 . S LRDATA(1)=LRSRTN_";SRF("
"RTN","LRAPLG1",341,0)
 . D SETREF^LRUEPR(LRDFN,LRDATA(.01),.LRDATA,1)
"RTN","LRAPLG1",342,0)
 . F I=.2,.3,.4,.5 I '$O(^LR(LRDFN,LRSS,LRI,I,0)) S $P(LRFLAG,"^",I*10)=1
"RTN","LRAPLG1",343,0)
 ;
"RTN","LRAPLG1",344,0)
 D DISP^SROSPLG
"RTN","LRAPLG1",345,0)
 ;
"RTN","LRAPLG1",346,0)
 ; Create notation on where info came from if site wants reference.
"RTN","LRAPLG1",347,0)
 ;  also store referece as external package reference.
"RTN","LRAPLG1",348,0)
 S LRSREF=$$GET^XPAR("DIV^PKG","LR AP SURGERY REFERENCE",1,"Q")
"RTN","LRAPLG1",349,0)
 S LRFIELD(.013)="(#60) BRIEF CLIN HISTORY"
"RTN","LRAPLG1",350,0)
 S LRFIELD(.014)="(#32) PRINCIPAL PRE-OP DIAGNOSIS, (#.72) OTHER PREOP DIAGNOSIS"
"RTN","LRAPLG1",351,0)
 S LRFIELD(.015)="(#59) OPERATIVE FINDINGS"
"RTN","LRAPLG1",352,0)
 S LRFIELD(.016)="(#34) PRINCIPAL POST-OP DIAG, (#.74) OTHER POSTOP DIAGS"
"RTN","LRAPLG1",353,0)
 S LRWP(1)=" "
"RTN","LRAPLG1",354,0)
 F LRJ=.2,.3,.4,.5 I $P(LRFLAG,"^",LRJ*10),$O(^LR(LRDFN,LRSS,LRI,LRJ,0)) D
"RTN","LRAPLG1",355,0)
 . N LRDATA,LRDIE
"RTN","LRAPLG1",356,0)
 . S LRFIELD=$P("^.013^.014^.015^.016","^",LRJ*10)
"RTN","LRAPLG1",357,0)
 . S LRWP(2)="Information automatically documented from SURGERY package case #"_LRSRTN_" Field "_LRFIELD(LRFIELD)
"RTN","LRAPLG1",358,0)
 . I LRSREF=1 D WP^DIE(63.08,LRI_","_LRDFN_",",LRFIELD,"A","LRWP","LRDIE(LRFIELD)")
"RTN","LRAPLG1",359,0)
 . S LRDATA(.01)=LRDFN_","_LRSS_","_LRI_","_LRJ_",0"
"RTN","LRAPLG1",360,0)
 . S LRDATA(.02)=1
"RTN","LRAPLG1",361,0)
 . S LRDATA(1)=LRSRTN_";SRF(;"_LRWP(2)
"RTN","LRAPLG1",362,0)
 . D SETREF^LRUEPR(LRDFN,LRDATA(.01),.LRDATA,1)
"RTN","LRAPLG1",363,0)
 ;
"RTN","LRAPLG1",364,0)
 Q
"RTN","LRAPLG1",365,0)
 ;
"RTN","LRAPLG1",366,0)
 ;
"RTN","LRAPLG1",367,0)
LRMSG(LRRNAME,LRFMERR) ;
"RTN","LRAPLG1",368,0)
 ; Filing error notification
"RTN","LRAPLG1",369,0)
 ; Inputs
"RTN","LRAPLG1",370,0)
 ;  LRRNAME: Routine name  (TAG~RTN)
"RTN","LRAPLG1",371,0)
 ;  LRFMERR:<byref> FileMan error local array
"RTN","LRAPLG1",372,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT,LRDIE
"RTN","LRAPLG1",373,0)
 S LRRNAME=$TR($G(LRRNAME),"^","~")
"RTN","LRAPLG1",374,0)
 M LRDIE=LRFMERR
"RTN","LRAPLG1",375,0)
 D MAILALRT^LRWLST12(LRRNAME,.LRFMERR)
"RTN","LRAPLG1",376,0)
 S DIR(0)="EA"
"RTN","LRAPLG1",377,0)
 S DIR("A",1)="Filing error in "_LRRNAME_" for this accession/specimen"
"RTN","LRAPLG1",378,0)
 S DIR("A")="Press the return key to continue"
"RTN","LRAPLG1",379,0)
 D ^DIR
"RTN","LRAPLG1",380,0)
 Q
"RTN","LRAPLG1",381,0)
 ;
"RTN","LRAPLG1",382,0)
 ;
"RTN","LRAPLG1",383,0)
OUT ;
"RTN","LRAPLG1",384,0)
 ; Exit point
"RTN","LRAPLG1",385,0)
 Q
"RTN","LRAPLG1",386,0)
 ;
"RTN","LRAPLG1",387,0)
 ;
"RTN","LRAPLG1",388,0)
END ; from LRAUAW, LRAPLG2
"RTN","LRAPLG1",389,0)
 ; Lock Accession file
"RTN","LRAPLG1",390,0)
 D LOCK^DILF("^LRO(68,LRAA,1,LRAD,1,0)")
"RTN","LRAPLG1",391,0)
 I '$T D EN^DDIOL("Someone else is logging in specimens.  Please wait and try again.","","!!") Q
"RTN","LRAPLG1",392,0)
 ;
"RTN","LRAPLG1",393,0)
 N DIK,DA
"RTN","LRAPLG1",394,0)
 S DA=LRAN,DA(1)=LRAD,DA(2)=LRAA
"RTN","LRAPLG1",395,0)
 S DIK="^LRO(68,"_DA(2)_",1,"_DA(1)_",1,"
"RTN","LRAPLG1",396,0)
 D ^DIK
"RTN","LRAPLG1",397,0)
 ;
"RTN","LRAPLG1",398,0)
 L -^LRO(68,LRAA,1,LRAD,1,0)
"RTN","LRAPLG1",399,0)
 Q
"RTN","LRAPLG1",400,0)
 ;
"RTN","LRAPLG1",401,0)
 ;
"RTN","LRAPLG1",402,0)
FIX ; Entry point to delete an orphan AP entry in file #63
"RTN","LRAPLG1",403,0)
 ;
"RTN","LRAPLG1",404,0)
 N DA,DFN,DIC,DIK,DIR,DIROUT,DIRUT,DIQ,DR,DTOUT
"RTN","LRAPLG1",405,0)
 N LRAA,LRABV,LRAC,LRAD,LRAN,LRDFN,LRDPA,LRDPF,LRH,LRI,LRRC,LRSS,LRWHN,LRXR,LRXREF
"RTN","LRAPLG1",406,0)
 N AGE,PNM,SEX,X,Y
"RTN","LRAPLG1",407,0)
 ;
"RTN","LRAPLG1",408,0)
 D ^LRAP Q:'$D(Y)
"RTN","LRAPLG1",409,0)
 D XR^LRU
"RTN","LRAPLG1",410,0)
 ;
"RTN","LRAPLG1",411,0)
 I LRSS'?1(1"SP",1"CY",1"EM") W !,"This program only supports SP, CY and EM subscripts",! Q
"RTN","LRAPLG1",412,0)
 ;
"RTN","LRAPLG1",413,0)
 S LRH(2)=$E(LRAD,1,3),LRWHN=$E(LRAD,2,3)
"RTN","LRAPLG1",414,0)
 ;
"RTN","LRAPLG1",415,0)
 D EN1^LRUPS Q:LRAN=-1
"RTN","LRAPLG1",416,0)
 I $P(^LR(LRDFN,LRSS,LRI,0),"^",11)'="" W !,"Report has been released!",! Q
"RTN","LRAPLG1",417,0)
 I $D(^LR(LRDFN,LRSS,LRI,2005)) D  Q
"RTN","LRAPLG1",418,0)
 . W !,"Report has associated images in IMAGING package!"
"RTN","LRAPLG1",419,0)
 . W !,"Disposition these images before deleting this entry!",!
"RTN","LRAPLG1",420,0)
 ;
"RTN","LRAPLG1",421,0)
 K DR
"RTN","LRAPLG1",422,0)
 S DIC="^LR("_LRDFN_","""_LRSS_""",",DA(1)=LRDFN,DA=LRI,DIQ(0)="ACR"
"RTN","LRAPLG1",423,0)
 D EN^DIQ
"RTN","LRAPLG1",424,0)
 ;
"RTN","LRAPLG1",425,0)
 S DIR(0)="Y",DIR("A")="DELETE this entry",DIR("B")="NO"
"RTN","LRAPLG1",426,0)
 D ^DIR
"RTN","LRAPLG1",427,0)
 I Y<1 Q
"RTN","LRAPLG1",428,0)
 ;
"RTN","LRAPLG1",429,0)
 K DIR
"RTN","LRAPLG1",430,0)
 S DIR(0)="Y",DIR("A")="Are you sure",DIR("B")="NO"
"RTN","LRAPLG1",431,0)
 D ^DIR
"RTN","LRAPLG1",432,0)
 I Y<1 Q
"RTN","LRAPLG1",433,0)
 ;
"RTN","LRAPLG1",434,0)
 ; Lock record
"RTN","LRAPLG1",435,0)
 D LOCK^DILF("^LR(LRDFN,LRSS,LRI)")
"RTN","LRAPLG1",436,0)
 I '$T D  Q
"RTN","LRAPLG1",437,0)
 . D EN^DDIOL("Someone else is accessing this record.  Please wait and try again.","","!!")
"RTN","LRAPLG1",438,0)
 . D KVA^VADPT,V^LRU
"RTN","LRAPLG1",439,0)
 ;
"RTN","LRAPLG1",440,0)
 K DA,DIK
"RTN","LRAPLG1",441,0)
 S DA=LRI,DA(1)=LRDFN,DIK="^LR("_DA(1)_","""_LRSS_""","
"RTN","LRAPLG1",442,0)
 D ^DIK
"RTN","LRAPLG1",443,0)
 ;
"RTN","LRAPLG1",444,0)
 ; Cleanup some cross-references.
"RTN","LRAPLG1",445,0)
 I LRSS?1(1"SP",1"CY",1"EM") D
"RTN","LRAPLG1",446,0)
 . K ^LR(LRXREF,LRH(2),LRABV,LRAN,LRDFN,LRI)
"RTN","LRAPLG1",447,0)
 . I $G(LRRC)>1 K ^LR(LRXR,LRRC,LRDFN,LRI)
"RTN","LRAPLG1",448,0)
 ;
"RTN","LRAPLG1",449,0)
 I LRSS="AU" D
"RTN","LRAPLG1",450,0)
 . I $D(^LR(LRDFN,"AV")) K ^LR(LRDFN,"AV")
"RTN","LRAPLG1",451,0)
 . I $D(^LR(LRDFN,"AW")) K ^LR(LRDFN,"AW")
"RTN","LRAPLG1",452,0)
 . I $D(^LR(LRDFN,"AWI")) K ^LR(LRDFN,"AWI")
"RTN","LRAPLG1",453,0)
 . I $D(LRRC) K ^LR("AAUA",+$E(LRRC,1,3),LRABV,LRAN),^LR("AAU",+LRRC,LRDFN)
"RTN","LRAPLG1",454,0)
 ;
"RTN","LRAPLG1",455,0)
 ; Release lock
"RTN","LRAPLG1",456,0)
 L -^LR(LRDFN,LRSS,LRI)
"RTN","LRAPLG1",457,0)
 ;
"RTN","LRAPLG1",458,0)
 W !!,"Entry deleted",!
"RTN","LRAPLG1",459,0)
 D KVA^VADPT,V^LRU
"RTN","LRAPLG1",460,0)
 ;
"RTN","LRAPLG1",461,0)
 Q
"RTN","LRAPRES")
0^5^B188361634^B184608349
"RTN","LRAPRES",1,0)
LRAPRES ;DALOI/STAFF,PMK - AP ESIG RELEASE REPORT ;17 Sep 2013 10:52 AM
"RTN","LRAPRES",2,0)
 ;;5.2;LAB SERVICE;**259,295,317,315,350,427,433**;Sep 27, 1994;Build 4
"RTN","LRAPRES",3,0)
 ;
"RTN","LRAPRES",4,0)
 ;
"RTN","LRAPRES",5,0)
 ; Reference to NEW^TIUPNAPI supported by IA #1911
"RTN","LRAPRES",6,0)
 ; Reference to SETPARM^TIULE supported by IA #2863
"RTN","LRAPRES",7,0)
 ; Reference to File #8925.1 supported by IA #5033
"RTN","LRAPRES",8,0)
 ; Reference to TGET^TIUSRVR1 supported by IA #2944
"RTN","LRAPRES",9,0)
 ; Reference to $$DDEFIEN^TIUFLF7 supported by IA #5352
"RTN","LRAPRES",10,0)
 ; Reference to EXTRACT^TIULQ supported by IA #2693
"RTN","LRAPRES",11,0)
 ;
"RTN","LRAPRES",12,0)
 ; ZEXCEPT is used to identify variables which are external to a specific TAG
"RTN","LRAPRES",13,0)
 ;         used in conjunction with Eclipse M-editor.
"RTN","LRAPRES",14,0)
 ;
"RTN","LRAPRES",15,0)
MAIN ;
"RTN","LRAPRES",16,0)
 N LRMSG,LRDEM,LREND,LRQUIT,LRNTIME,LRPRCLSS,LRVCDE,LRMTCH
"RTN","LRAPRES",17,0)
 N LRPCEXP,LRESCPT,LRPCSTR,USRSEL
"RTN","LRAPRES",18,0)
 S LRESCPT=0
"RTN","LRAPRES",19,0)
 D TITLE
"RTN","LRAPRES",20,0)
 I LRQUIT D END Q
"RTN","LRAPRES",21,0)
 D CPTCHK
"RTN","LRAPRES",22,0)
 F  D  Q:LRQUIT
"RTN","LRAPRES",23,0)
 . S LRQUIT=0
"RTN","LRAPRES",24,0)
 . D MENU
"RTN","LRAPRES",25,0)
 . Q:LRQUIT
"RTN","LRAPRES",26,0)
 . S USRSEL=$G(LRSEL)
"RTN","LRAPRES",27,0)
 . D  ; Protect USRSEL var
"RTN","LRAPRES",28,0)
 . . N USRSEL
"RTN","LRAPRES",29,0)
 . . D SECTION
"RTN","LRAPRES",30,0)
 . Q:LRQUIT
"RTN","LRAPRES",31,0)
 . S LREND=0
"RTN","LRAPRES",32,0)
 . I USRSEL="E" S LREND=0 D CLSSCHK^LRAPRES1(DUZ,.LREND)
"RTN","LRAPRES",33,0)
 . Q:LREND
"RTN","LRAPRES",34,0)
 . D ACCYR
"RTN","LRAPRES",35,0)
 . Q:LRQUIT
"RTN","LRAPRES",36,0)
 . D ACCPN
"RTN","LRAPRES",37,0)
 D END
"RTN","LRAPRES",38,0)
 Q
"RTN","LRAPRES",39,0)
 ;
"RTN","LRAPRES",40,0)
 ;
"RTN","LRAPRES",41,0)
ACCPN ; Prompt for accession number or patient name
"RTN","LRAPRES",42,0)
 N USRSEL1
"RTN","LRAPRES",43,0)
 S USRSEL1=$G(USRSEL) ;from MAIN
"RTN","LRAPRES",44,0)
 F  D  Q:LREND
"RTN","LRAPRES",45,0)
 . S (LRQUIT,LREND)=0
"RTN","LRAPRES",46,0)
 . D CPTCHK
"RTN","LRAPRES",47,0)
 . D LOOKUP^LRAPUTL(.LRDATA,LRH(0),LRO(68),LRSS,LRAD,LRAA)
"RTN","LRAPRES",48,0)
 . Q:'LRDATA
"RTN","LRAPRES",49,0)
 . I LRDATA=-1 S LREND=1 Q
"RTN","LRAPRES",50,0)
 . S LRDFN=LRDATA,LRI=LRDATA(1)
"RTN","LRAPRES",51,0)
 . S LRIENS=LRI_","_LRDFN_","
"RTN","LRAPRES",52,0)
 . I USRSEL1="E" D  Q:LRQUIT
"RTN","LRAPRES",53,0)
 . . D RELCHK
"RTN","LRAPRES",54,0)
 . . Q:LRQUIT
"RTN","LRAPRES",55,0)
 . . D SETRL^LRVERA(LRDFN,LRSS,$S('LRAU:LRI,1:0),DUZ(2))
"RTN","LRAPRES",56,0)
 . . D:'LRZ(2) BROWSE
"RTN","LRAPRES",57,0)
 . . D ESIG
"RTN","LRAPRES",58,0)
 . . Q:LRQUIT
"RTN","LRAPRES",59,0)
 . . S LRNTIME=$$NOW^XLFDT
"RTN","LRAPRES",60,0)
 . . I 'LRZ(2) D TIUPREP,STORE
"RTN","LRAPRES",61,0)
 . . Q:LRQUIT
"RTN","LRAPRES",62,0)
 . . D RELEASE
"RTN","LRAPRES",63,0)
 . . Q:LRQUIT
"RTN","LRAPRES",64,0)
 . . D:'LRZ(2) MAIN^LRAPRES1(LRDFN,LRSS,LRI,LRSF,LRP,LRAC)
"RTN","LRAPRES",65,0)
 . . D OERR^LR7OB63D
"RTN","LRAPRES",66,0)
 . I USRSEL1="C" D
"RTN","LRAPRES",67,0)
 . . Q:$T(CPT^LRCAPES)=""
"RTN","LRAPRES",68,0)
 . . S LRPRO=DUZ
"RTN","LRAPRES",69,0)
 . . D PROVIDR^LRAPUTL
"RTN","LRAPRES",70,0)
 . . Q:LRQUIT
"RTN","LRAPRES",71,0)
 . . D CPT^LRCAPES(LRAA,LRAD,LRAN,LRPRO)
"RTN","LRAPRES",72,0)
 . I USRSEL1="V" D
"RTN","LRAPRES",73,0)
 . . D DEMARR
"RTN","LRAPRES",74,0)
 . . D INIT^LRAPSNMD(LRDFN,LRSS,LRI,LRSF,LRAA,LRAN,LRAD,.LRDEM,1)
"RTN","LRAPRES",75,0)
 Q
"RTN","LRAPRES",76,0)
 ;
"RTN","LRAPRES",77,0)
 ;
"RTN","LRAPRES",78,0)
TITLE ; Title
"RTN","LRAPRES",79,0)
 S LRQUIT=0
"RTN","LRAPRES",80,0)
 D CK^LRAP
"RTN","LRAPRES",81,0)
 I Y=-1 S LRQUIT=1 Q
"RTN","LRAPRES",82,0)
 W @IOF
"RTN","LRAPRES",83,0)
 S LRTEXT="Release/Electronically Sign Pathology Reports"
"RTN","LRAPRES",84,0)
 S LRMSG(1)=$$CJ^XLFSTR(LRTEXT,IOM)
"RTN","LRAPRES",85,0)
 S LRMSG(1,"F")="!!"
"RTN","LRAPRES",86,0)
 S LRMSG(2)="",LRMSG(2,"F")="!"
"RTN","LRAPRES",87,0)
 D EN^DDIOL(.LRMSG) K LRMSG
"RTN","LRAPRES",88,0)
 Q
"RTN","LRAPRES",89,0)
 ;
"RTN","LRAPRES",90,0)
 ;
"RTN","LRAPRES",91,0)
CPTCHK ; Determine if CPT is activated
"RTN","LRAPRES",92,0)
 Q:$T(ES^LRCAPES)=""
"RTN","LRAPRES",93,0)
 S LRESCPT=$$ES^LRCAPES()
"RTN","LRAPRES",94,0)
 Q
"RTN","LRAPRES",95,0)
 ;
"RTN","LRAPRES",96,0)
 ;
"RTN","LRAPRES",97,0)
DEMARR ;
"RTN","LRAPRES",98,0)
 I LRAU D
"RTN","LRAPRES",99,0)
 . S LRPRO=$$GET1^DIQ(63,LRDFN_",",13.5,"I")
"RTN","LRAPRES",100,0)
 . S LRPRO(1)=$$GET1^DIQ(63,LRDFN_",",13.5)
"RTN","LRAPRES",101,0)
 I 'LRAU D
"RTN","LRAPRES",102,0)
 . S LRPRO=$$GET1^DIQ(LRSF,LRI_","_LRDFN_",",.07,"I")
"RTN","LRAPRES",103,0)
 . S LRPRO(1)=$$GET1^DIQ(LRSF,LRI_","_LRDFN_",",.07)
"RTN","LRAPRES",104,0)
 S LRDEM("SEX")=SEX,LRDEM("DOB")=DOB
"RTN","LRAPRES",105,0)
 S LRDEM("AGE")=AGE
"RTN","LRAPRES",106,0)
 S LRDEM("SEC")=LRAA(1),LRDEM("PNM")=PNM
"RTN","LRAPRES",107,0)
 S LRDEM("SSN")=SSN,LRDEM("PRO")=LRPRO(1)
"RTN","LRAPRES",108,0)
 I LRAU D
"RTN","LRAPRES",109,0)
 . S LRDEM("DTH")=$P(VADM(6),"^",2)
"RTN","LRAPRES",110,0)
 . S LRDEM("AUDT")=$$GET1^DIQ(63,LRDFN_",",11)
"RTN","LRAPRES",111,0)
 . S LRDEM("AUTYP")=$$GET1^DIQ(63,LRDFN_",",13.7)
"RTN","LRAPRES",112,0)
 Q
"RTN","LRAPRES",113,0)
 ;
"RTN","LRAPRES",114,0)
 ;
"RTN","LRAPRES",115,0)
MENU ;
"RTN","LRAPRES",116,0)
 N DIR,X,Y
"RTN","LRAPRES",117,0)
 S DIR(0)="SO^"
"RTN","LRAPRES",118,0)
 S:LRESCPT DIR(0)=DIR(0)_"C:CPT Coding;"
"RTN","LRAPRES",119,0)
 S DIR(0)=DIR(0)_"E:Electronically Sign Reports;V:View SNOMED Codes"
"RTN","LRAPRES",120,0)
 S DIR("A")="Selection"
"RTN","LRAPRES",121,0)
 D ^DIR
"RTN","LRAPRES",122,0)
 I $D(DIRUT) S LRQUIT=1 Q
"RTN","LRAPRES",123,0)
 S LRSEL=Y
"RTN","LRAPRES",124,0)
 Q
"RTN","LRAPRES",125,0)
 ;
"RTN","LRAPRES",126,0)
 ;
"RTN","LRAPRES",127,0)
SECTION ; Choose Anatomic Pathology section (AU,SP,CY,EM)
"RTN","LRAPRES",128,0)
 N LRMSG
"RTN","LRAPRES",129,0)
 W !
"RTN","LRAPRES",130,0)
 D ^LRAP
"RTN","LRAPRES",131,0)
 I '$D(Y)!('$D(LRSS)) S LRQUIT=1 Q
"RTN","LRAPRES",132,0)
 S:LRO(68)="EM" LRO(68)="ELECTRON MICROSCOPY"
"RTN","LRAPRES",133,0)
 S LRAU=0            ; LRAU = 0 - Not Autopsy
"RTN","LRAPRES",134,0)
 S:LRSS="AU" LRAU=1  ;      = 1 - Autopsy
"RTN","LRAPRES",135,0)
 I LRCAPA D  Q:LRQUIT
"RTN","LRAPRES",136,0)
 . S X=""
"RTN","LRAPRES",137,0)
 . S:LRSS="CY" X="CYTOLOGY REPORTING"
"RTN","LRAPRES",138,0)
 . S:LRSS="SP" X="SURGICAL PATH REPORTING"
"RTN","LRAPRES",139,0)
 . D:X'="" X^LRUWK
"RTN","LRAPRES",140,0)
 . S:'$D(X) LRQUIT=1
"RTN","LRAPRES",141,0)
 ;
"RTN","LRAPRES",142,0)
 S LRSOP="Z"
"RTN","LRAPRES",143,0)
 S LRMSG(1)=LRO(68)_" ("_LRABV_")",LRMSG(1,"F")="!?20"
"RTN","LRAPRES",144,0)
 S LRMSG(2)="",LRMSG(2,"F")="!"
"RTN","LRAPRES",145,0)
 D EN^DDIOL(.LRMSG)
"RTN","LRAPRES",146,0)
 Q
"RTN","LRAPRES",147,0)
 ;
"RTN","LRAPRES",148,0)
 ;
"RTN","LRAPRES",149,0)
ACCYR ; Determine Accession Year
"RTN","LRAPRES",150,0)
 D ACCYR^LRAPUTL(.LRAD1,LRH(0),LRAA,LRO(68))
"RTN","LRAPRES",151,0)
 I LRAD1=-1 S LRQUIT=1 Q
"RTN","LRAPRES",152,0)
 I LRAD1 S LRAD=$P(LRAD1,U),LRH(0)=$P(LRAD1,U,2)
"RTN","LRAPRES",153,0)
 Q
"RTN","LRAPRES",154,0)
 ;
"RTN","LRAPRES",155,0)
 ;
"RTN","LRAPRES",156,0)
RELCHK ; Perform series of checks
"RTN","LRAPRES",157,0)
 N LRPAT,LRSRLST,LRSRREL
"RTN","LRAPRES",158,0)
 S LRQUIT=0
"RTN","LRAPRES",159,0)
 I 'LRAU D  Q:LRQUIT
"RTN","LRAPRES",160,0)
 . S LRPAT=+$$GET1^DIQ(LRSF,LRIENS,.02,"I")
"RTN","LRAPRES",161,0)
 . S LRZ=$$GET1^DIQ(LRSF,LRIENS,.03,"I")
"RTN","LRAPRES",162,0)
 . S LRZ(1)=$$GET1^DIQ(LRSF,LRIENS,.13,"I")
"RTN","LRAPRES",163,0)
 . S LRZ(1.1)=$$GET1^DIQ(LRSF,LRIENS,.13)
"RTN","LRAPRES",164,0)
 . S LRZ(2)=$$GET1^DIQ(LRSF,LRIENS,.11,"I")
"RTN","LRAPRES",165,0)
 . I 'LRZ,'LRZ(2) D
"RTN","LRAPRES",166,0)
 . . W $C(7)
"RTN","LRAPRES",167,0)
 . . S LRMSG="No date report completed.  Cannot release."
"RTN","LRAPRES",168,0)
 . . D EN^DDIOL(LRMSG,"","!!") K LRMSG
"RTN","LRAPRES",169,0)
 . . S LRQUIT=1
"RTN","LRAPRES",170,0)
 ;
"RTN","LRAPRES",171,0)
 I LRAU D  Q:LRQUIT
"RTN","LRAPRES",172,0)
 . I $G(^LR(LRDFN,"AU"))="" D  Q
"RTN","LRAPRES",173,0)
 . . S LRMSG="No information found for this accession in the "
"RTN","LRAPRES",174,0)
 . . S LRMSG=LRMSG_"LAB DATA file (#63)."
"RTN","LRAPRES",175,0)
 . . D EN^DDIOL(LRMSG,"","!!") K LRMSG
"RTN","LRAPRES",176,0)
 . . S LRQUIT=1
"RTN","LRAPRES",177,0)
 . S LRPAT=+$$GET1^DIQ(63,LRDFN_",",13.6,"I")
"RTN","LRAPRES",178,0)
 . S LRZ=$$GET1^DIQ(63,LRDFN_",",13,"I")
"RTN","LRAPRES",179,0)
 . S LRZ(1)=$$GET1^DIQ(63,LRDFN_",",14.8,"I")
"RTN","LRAPRES",180,0)
 . S LRZ(1.1)=$$GET1^DIQ(63,LRDFN_",",14.8)
"RTN","LRAPRES",181,0)
 . S LRZ(2)=$$GET1^DIQ(63,LRDFN_",",14.7,"I")
"RTN","LRAPRES",182,0)
 . ; KLL-CHECK FOR PROVISIONAL DATE OR DATE REPORT COMPLETED
"RTN","LRAPRES",183,0)
 . S LRZ(3)=$$GET1^DIQ(63,LRDFN_",",14.9,"I")
"RTN","LRAPRES",184,0)
 . I 'LRZ,'LRZ(3) D
"RTN","LRAPRES",185,0)
 . . W $C(7)
"RTN","LRAPRES",186,0)
 . . S LRMSG="Provisional or date report completed required.  Cannot release."
"RTN","LRAPRES",187,0)
 . . D EN^DDIOL(LRMSG,"","!!") K LRMSG
"RTN","LRAPRES",188,0)
 . . S LRQUIT=1
"RTN","LRAPRES",189,0)
 I 'LRPAT,'LRZ(2) D
"RTN","LRAPRES",190,0)
 . W $C(7)
"RTN","LRAPRES",191,0)
 . S LRMSG="Pathologist or Cytotechnologist entry missing. Cannot release."
"RTN","LRAPRES",192,0)
 . D EN^DDIOL(LRMSG,"","!!") K LRMSG
"RTN","LRAPRES",193,0)
 . S LRQUIT=1
"RTN","LRAPRES",194,0)
 D:'LRZ(2) SUPCHK^LRAPR1
"RTN","LRAPRES",195,0)
 Q:LRQUIT
"RTN","LRAPRES",196,0)
 I LRZ(2) D  Q:LRQUIT
"RTN","LRAPRES",197,0)
 . W $C(7)
"RTN","LRAPRES",198,0)
 . S LRMSG="Report " S:LRZ(2)=1 LRMSG=LRMSG_"has already been "
"RTN","LRAPRES",199,0)
 . S LRMSG=LRMSG_"released "
"RTN","LRAPRES",200,0)
 . S Y=LRZ(2) D DD^%DT S:LRZ(2)>1 LRMSG=LRMSG_Y
"RTN","LRAPRES",201,0)
 . S:LRZ(1)'="" LRMSG=LRMSG_" by "_LRZ(1.1)
"RTN","LRAPRES",202,0)
 . D EN^DDIOL(LRMSG,"","!!") K LRMSG
"RTN","LRAPRES",203,0)
 . S:'LRAU LRQUIT=1
"RTN","LRAPRES",204,0)
 ; KLL-DON'T ALLOW UNRELEASE IF REPT COMPLETED DATE EXISTS FOR AU
"RTN","LRAPRES",205,0)
 I LRZ(2),LRZ S LRQUIT=1
"RTN","LRAPRES",206,0)
 S LRMSG="" D EN^DDIOL(LRMSG,"","!") K LRMSG
"RTN","LRAPRES",207,0)
 ; Don't allow unrelease if supp report not released for AU
"RTN","LRAPRES",208,0)
 I LRZ(2),'LRZ D
"RTN","LRAPRES",209,0)
 . S LRSRLST=$P($G(^LR(LRDFN,84,0)),"^",4)
"RTN","LRAPRES",210,0)
 . Q:'LRSRLST
"RTN","LRAPRES",211,0)
 . S LRSRREL=$P($G(^LR(LRDFN,84,LRSRLST,0)),"^",2)
"RTN","LRAPRES",212,0)
 . I 'LRSRREL D
"RTN","LRAPRES",213,0)
 . . N LRMSG
"RTN","LRAPRES",214,0)
 . . S LRMSG=$C(7)_"Supplementary report has not been released. Cannot use this option."
"RTN","LRAPRES",215,0)
 . . D EN^DDIOL(LRMSG,"","!!")
"RTN","LRAPRES",216,0)
 . . S LRQUIT=1
"RTN","LRAPRES",217,0)
 Q:LRQUIT
"RTN","LRAPRES",218,0)
 I LRZ(2),'LRZ D
"RTN","LRAPRES",219,0)
 . S DIR(0)="YA",DIR("B")="NO"
"RTN","LRAPRES",220,0)
 . S DIR("A")="Unrelease report? "
"RTN","LRAPRES",221,0)
 . D ^DIR
"RTN","LRAPRES",222,0)
 . I 'Y S LRQUIT=1
"RTN","LRAPRES",223,0)
 Q
"RTN","LRAPRES",224,0)
 ;
"RTN","LRAPRES",225,0)
 ;
"RTN","LRAPRES",226,0)
BROWSE ; Display the report in the browser
"RTN","LRAPRES",227,0)
 N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","LRAPRES",228,0)
 ;
"RTN","LRAPRES",229,0)
 ; Check if user's terminal supports browser functionality
"RTN","LRAPRES",230,0)
 I '$$TEST^DDBRT D  Q
"RTN","LRAPRES",231,0)
 . S DIR("A",1)="This terminal does not support the needed functionality to use the Browser!"
"RTN","LRAPRES",232,0)
 . S DIR("A",2)="Unable to display report on terminal."
"RTN","LRAPRES",233,0)
 . S DIR("A")="Press any key to continue."
"RTN","LRAPRES",234,0)
 . S DIR(0)="EA" D ^DIR
"RTN","LRAPRES",235,0)
 ;
"RTN","LRAPRES",236,0)
 S DIR(0)="YA",DIR("B")="YES"
"RTN","LRAPRES",237,0)
 S DIR("A")="View the report before signing? "
"RTN","LRAPRES",238,0)
 D ^DIR
"RTN","LRAPRES",239,0)
 I Y<1 Q
"RTN","LRAPRES",240,0)
 ;
"RTN","LRAPRES",241,0)
 K ^TMP("LRAPBR",$J)
"RTN","LRAPRES",242,0)
 S LRMSG=$$CJ^XLFSTR("*** Report is being processed.  One moment please. ***",IOM)
"RTN","LRAPRES",243,0)
 D EN^DDIOL(LRMSG,"","!!")
"RTN","LRAPRES",244,0)
 D INIT^LRAPBR(LRAA,LRSS,LRI,LRDFN,LRO(68),LRAU,0)
"RTN","LRAPRES",245,0)
 Q
"RTN","LRAPRES",246,0)
 ;
"RTN","LRAPRES",247,0)
 ;
"RTN","LRAPRES",248,0)
ESIG ; Prompt for electronic signature
"RTN","LRAPRES",249,0)
 S LRQUIT=0
"RTN","LRAPRES",250,0)
 D SIG^XUSESIG
"RTN","LRAPRES",251,0)
 I X1="" D  Q
"RTN","LRAPRES",252,0)
 . W "  SIGNATURE NOT VERIFIED"
"RTN","LRAPRES",253,0)
 . S LRQUIT=1
"RTN","LRAPRES",254,0)
 Q
"RTN","LRAPRES",255,0)
 ;
"RTN","LRAPRES",256,0)
 ;
"RTN","LRAPRES",257,0)
TIUPREP ;
"RTN","LRAPRES",258,0)
 K ^TMP("TIUP",$J)
"RTN","LRAPRES",259,0)
 S LRMSG="*** Report is being processed"
"RTN","LRAPRES",260,0)
 ; Exclude patient files 67, 67.1, 67.2, 67.3, 62.3 from TIU storage
"RTN","LRAPRES",261,0)
 ;
"RTN","LRAPRES",262,0)
 I LRDPF'=62.3,LRDPF'[67 S LRMSG=LRMSG_" for storage in TIU"
"RTN","LRAPRES",263,0)
 S LRMSG=LRMSG_".  One moment please. ***"
"RTN","LRAPRES",264,0)
 S LRMSG=$$CJ^XLFSTR(LRMSG,IOM)
"RTN","LRAPRES",265,0)
 D EN^DDIOL(LRMSG,"","!!")
"RTN","LRAPRES",266,0)
 ;
"RTN","LRAPRES",267,0)
 D INIT^LRAPBR(LRAA,LRSS,LRI,LRDFN,LRO(68),LRAU,1,LRNTIME)
"RTN","LRAPRES",268,0)
 Q
"RTN","LRAPRES",269,0)
 ;
"RTN","LRAPRES",270,0)
 ;
"RTN","LRAPRES",271,0)
RELEASE ; Release the report
"RTN","LRAPRES",272,0)
 N LRMSG
"RTN","LRAPRES",273,0)
 ;
"RTN","LRAPRES",274,0)
 ; Store REPORT RELEASE DATE/TIME and RELEASED BY
"RTN","LRAPRES",275,0)
 I 'LRAU D
"RTN","LRAPRES",276,0)
 . S LRRC=$$GET1^DIQ(LRSF,LRIENS,.1,"I")
"RTN","LRAPRES",277,0)
 . I LRCAPA D C^LRAPSWK
"RTN","LRAPRES",278,0)
 . S DR=".11////^S X=LRNTIME;.13////^S X=DUZ"
"RTN","LRAPRES",279,0)
 . S DIE="^LR(LRDFN,LRSS,",DA=LRI,DA(1)=LRDFN
"RTN","LRAPRES",280,0)
 . S LRA=^LR(LRDFN,LRSS,LRI,0) ; Set LRA for xref call to LRWOMEN
"RTN","LRAPRES",281,0)
 ;
"RTN","LRAPRES",282,0)
 ; Store AUTOPSY RELEASE DATE/TIME and AUTOPSY RELEASED BY
"RTN","LRAPRES",283,0)
 I LRAU D
"RTN","LRAPRES",284,0)
 . S DR="14.7////^S X=$S(LRZ(2):""@"",1:LRNTIME);"
"RTN","LRAPRES",285,0)
 . S DR=DR_"14.8////^S X=$S(LRZ(2):""@"",1:DUZ);"
"RTN","LRAPRES",286,0)
 . S DIE="^LR(",DA=LRDFN
"RTN","LRAPRES",287,0)
 ;
"RTN","LRAPRES",288,0)
 D CK^LRU
"RTN","LRAPRES",289,0)
 Q:$D(LR("CK"))
"RTN","LRAPRES",290,0)
 D ^DIE
"RTN","LRAPRES",291,0)
 ;
"RTN","LRAPRES",292,0)
 ; Update accession with completion status
"RTN","LRAPRES",293,0)
 D ACCCOMP
"RTN","LRAPRES",294,0)
 ;
"RTN","LRAPRES",295,0)
 ; Update clinical reminders
"RTN","LRAPRES",296,0)
 D UPDATE^LRPXRM(LRDFN,$G(LRSS,"AU"),$G(LRI))
"RTN","LRAPRES",297,0)
 ;
"RTN","LRAPRES",298,0)
 D FRE^LRU
"RTN","LRAPRES",299,0)
 S LRMSG="*** Report "
"RTN","LRAPRES",300,0)
 I LRZ(2),LRAU S LRMSG=LRMSG_"un"
"RTN","LRAPRES",301,0)
 S LRMSG=LRMSG_"released. ***"
"RTN","LRAPRES",302,0)
 D EN^DDIOL($$CJ^XLFSTR(LRMSG,IOM),"","!!")
"RTN","LRAPRES",303,0)
 ;
"RTN","LRAPRES",304,0)
 ; Record workload
"RTN","LRAPRES",305,0)
 I "CYSP"[LRSS,LRCAPA D WKLD
"RTN","LRAPRES",306,0)
 ;
"RTN","LRAPRES",307,0)
 ; Check if supported subscript, released and LEDI accession and send results back to submitting facility.
"RTN","LRAPRES",308,0)
 I LRSS?1(1"SP",1"CY",1"EM"),$$GET1^DIQ(LRSF,LRI_","_LRDFN_",",.11,"I") D LEDI^LRVR0
"RTN","LRAPRES",309,0)
 ;
"RTN","LRAPRES",310,0)
 ;I LRCAPA,"SPCYEM"[LRSS,LRD(1)'="","MBA"[LRD(1) D C1^LRAPSWK
"RTN","LRAPRES",311,0)
 Q
"RTN","LRAPRES",312,0)
 ;
"RTN","LRAPRES",313,0)
 ;
"RTN","LRAPRES",314,0)
STORE ; Store report in TIU
"RTN","LRAPRES",315,0)
 N LRTITLE,LRIENS,LRFILE,LRFDA,LRTIUPTR,LRMSG
"RTN","LRAPRES",316,0)
 I LRDPF=62.3!(LRDPF[67) D REFRRL^LRAPUTL Q
"RTN","LRAPRES",317,0)
 S:LRSS="SP" LRO68="SURGICAL PATHOLOGY"
"RTN","LRAPRES",318,0)
 S:LRSS="CY" LRO68="CYTOPATHOLOGY"
"RTN","LRAPRES",319,0)
 S:LRSS="EM" LRO68="ELECTRON MICROSCOPY"
"RTN","LRAPRES",320,0)
 S:LRSS="AU" LRO68="AUTOPSY"
"RTN","LRAPRES",321,0)
 D SETPARM^TIULE
"RTN","LRAPRES",322,0)
 S LRTITLE=$$DDEFIEN^TIUFLF7("LR "_LRO68_" REPORT","TL")
"RTN","LRAPRES",323,0)
 I 'LRTITLE D
"RTN","LRAPRES",324,0)
 . W $C(7)
"RTN","LRAPRES",325,0)
 . S LRMSG="No TIU title for this lab report.  Cannot release."
"RTN","LRAPRES",326,0)
 . D EN^DDIOL(LRMSG,"","!!") K LRMSG
"RTN","LRAPRES",327,0)
 . S LRQUIT=1
"RTN","LRAPRES",328,0)
 Q:LRQUIT
"RTN","LRAPRES",329,0)
 ; Set parameter to 1 for e-sig verification in TIU; if e-sig fails,
"RTN","LRAPRES",330,0)
 ;      TIU will abort creation of doc in ^TIU(8925, and return
"RTN","LRAPRES",331,0)
 ;      an error, tiufn=-1,-1.
"RTN","LRAPRES",332,0)
 D NEW^TIUPNAPI(.LRTIUPTR,DFN,DUZ,LRNTIME,LRTITLE,,,,DUZ,,1)
"RTN","LRAPRES",333,0)
 I LRTIUPTR="-1^-1" D  Q
"RTN","LRAPRES",334,0)
 .S LRMSG(1)="     *** Signature in TIU failed. ***"
"RTN","LRAPRES",335,0)
 .S LRMSG(2,"F")="!!!"
"RTN","LRAPRES",336,0)
 .S LRMSG(2)="Possible causes:"
"RTN","LRAPRES",337,0)
 .S LRMSG(3,"F")="!!"
"RTN","LRAPRES",338,0)
 .S LRMSG(3)="1. Report contains 3 sequential characters matching those defined"
"RTN","LRAPRES",339,0)
 .S LRMSG(4)="in the BLANK CHARACTER STRING field (#1.06), TIU PARAMETERS file (#8925.99)"
"RTN","LRAPRES",340,0)
 .S LRMSG(5)="which are "_$P(TIUPRM1,U,6)_"."
"RTN","LRAPRES",341,0)
 .S LRMSG(6,"F")="!!"
"RTN","LRAPRES",342,0)
 .S LRMSG(6)="To correct this situation use a data entry option to remove"
"RTN","LRAPRES",343,0)
 .S LRMSG(7)="these characters from this report."
"RTN","LRAPRES",344,0)
 .S LRMSG(8,"F")="!!"
"RTN","LRAPRES",345,0)
 .S LRMSG(8)="2.  There is some other TIU document setup problem."
"RTN","LRAPRES",346,0)
 .S LRMSG(9,"F")="!!"
"RTN","LRAPRES",347,0)
 .S LRMSG(9)="Report this situation to the Laboratory ADP Coordinator."
"RTN","LRAPRES",348,0)
 .S LRMSG(10)="     *** Report storage in TIU failed. ***"
"RTN","LRAPRES",349,0)
 .S LRMSG(10,"F")="!!!"
"RTN","LRAPRES",350,0)
 .D EN^DDIOL(.LRMSG,"","!!")
"RTN","LRAPRES",351,0)
 .S LRQUIT=1
"RTN","LRAPRES",352,0)
 I +LRTIUPTR=-1 D  Q
"RTN","LRAPRES",353,0)
 . S LRMSG="*** Report storage in TIU failed. ***"
"RTN","LRAPRES",354,0)
 . S LRMSG=$$CJ^XLFSTR(LRMSG,IOM)
"RTN","LRAPRES",355,0)
 . D EN^DDIOL(LRMSG,"","!!")
"RTN","LRAPRES",356,0)
 . S LRQUIT=1
"RTN","LRAPRES",357,0)
 S LRMSG="*** Report storage in TIU is complete. ***"
"RTN","LRAPRES",358,0)
 S LRMSG=$$CJ^XLFSTR(LRMSG,IOM)
"RTN","LRAPRES",359,0)
 D EN^DDIOL(LRMSG,"","!!")
"RTN","LRAPRES",360,0)
 ;CKA-Calculate checksum of TIU report text
"RTN","LRAPRES",361,0)
 D EXTRACT^TIULQ(+LRTIUPTR,"LRTIU",,,,1,,1)
"RTN","LRAPRES",362,0)
 S $P(LRTIU(+LRTIUPTR,"TEXT",0),U,5)=$P(LRTIU(+LRTIUPTR,1201,"I"),".")
"RTN","LRAPRES",363,0)
 S LRCHKSUM=$$CHKSUM^XUSESIG1("LRTIU("_+LRTIUPTR_",""TEXT"")")
"RTN","LRAPRES",364,0)
 K LRTIU
"RTN","LRAPRES",365,0)
 ;
"RTN","LRAPRES",366,0)
 ; Store pointer & checksum information in the LAB DATA (#63) file
"RTN","LRAPRES",367,0)
 S LRIENS="+1,"_$S('LRAU:LRI_",",1:"")_LRDFN_","
"RTN","LRAPRES",368,0)
 S LRFILE=$S(LRSS="SP":63.19,LRSS="CY":63.47,LRSS="EM":63.49,1:"")
"RTN","LRAPRES",369,0)
 S:LRFILE="" LRFILE=$S(LRSS="AU":63.101,1:"")
"RTN","LRAPRES",370,0)
 S LRFDA(1,LRFILE,LRIENS,.01)=LRNTIME
"RTN","LRAPRES",371,0)
 S LRFDA(1,LRFILE,LRIENS,1)=+LRTIUPTR
"RTN","LRAPRES",372,0)
 S LRFDA(1,LRFILE,LRIENS,2)=LRCHKSUM
"RTN","LRAPRES",373,0)
 D UPDATE^DIE("","LRFDA(1)")
"RTN","LRAPRES",374,0)
 D RETRACT^LRAPRES1(LRDFN,LRSS,LRI,+LRTIUPTR)
"RTN","LRAPRES",375,0)
 ;
"RTN","LRAPRES",376,0)
 I $T(REPORT^MAGT7MA)'="" D REPORT^MAGT7MA ; invoke Imaging to associate images to the TIU note - P433
"RTN","LRAPRES",377,0)
 ;
"RTN","LRAPRES",378,0)
 Q
"RTN","LRAPRES",379,0)
 ;
"RTN","LRAPRES",380,0)
 ;
"RTN","LRAPRES",381,0)
WKLD ; Capture workload
"RTN","LRAPRES",382,0)
 N ERR,FILE,FILE1,IENS,IENS1,LRIEN,LRFDA,LROUT,RNUM
"RTN","LRAPRES",383,0)
 S LRK=$P(^LR(LRDFN,LRSS,LRI,0),"^",11) Q:'LRK
"RTN","LRAPRES",384,0)
 Q:$D(^LRO(68,LRAA,1,LRAD,1,LRAN,4,LRT,0))
"RTN","LRAPRES",385,0)
 S RNUM=1,IENS="+"_RNUM_","_LRAN_","_LRAD_","_LRAA_","
"RTN","LRAPRES",386,0)
 S FILE=68.04,LRIEN(1)=LRT
"RTN","LRAPRES",387,0)
 S LRFDA(1,FILE,IENS,.01)=LRT
"RTN","LRAPRES",388,0)
 S LRFDA(1,FILE,IENS,1)=50
"RTN","LRAPRES",389,0)
 S LRFDA(1,FILE,IENS,3)=DUZ
"RTN","LRAPRES",390,0)
 S LRFDA(1,FILE,IENS,4)=LRK
"RTN","LRAPRES",391,0)
 S C=0,FILE1=68.14
"RTN","LRAPRES",392,0)
 F  S C=$O(LRT(C)) Q:'C  D
"RTN","LRAPRES",393,0)
 . S RNUM=RNUM+1,LRIEN(RNUM)=C
"RTN","LRAPRES",394,0)
 . S IENS1="+"_RNUM_","_IENS
"RTN","LRAPRES",395,0)
 . S LRFDA(1,FILE1,IENS1,.01)=C
"RTN","LRAPRES",396,0)
 . S LRFDA(1,FILE1,IENS1,.02)=1
"RTN","LRAPRES",397,0)
 . S LRFDA(1,FILE1,IENS1,.03)=0
"RTN","LRAPRES",398,0)
 . S LRFDA(1,FILE1,IENS1,.04)=0
"RTN","LRAPRES",399,0)
 . S LRFDA(1,FILE1,IENS1,1)=LRK
"RTN","LRAPRES",400,0)
 . S LRFDA(1,FILE1,IENS1,2)=DUZ
"RTN","LRAPRES",401,0)
 . S LRFDA(1,FILE1,IENS1,3)=DUZ(2)
"RTN","LRAPRES",402,0)
 . S LRFDA(1,FILE1,IENS1,4)=LRAA
"RTN","LRAPRES",403,0)
 . S LRFDA(1,FILE1,IENS1,5)=LRAA
"RTN","LRAPRES",404,0)
 . S LRFDA(1,FILE1,IENS1,6)=LRAA
"RTN","LRAPRES",405,0)
 D UPDATE^DIE("","LRFDA(1)","LRIEN","LROUT")
"RTN","LRAPRES",406,0)
 Q
"RTN","LRAPRES",407,0)
 ;
"RTN","LRAPRES",408,0)
 ;
"RTN","LRAPRES",409,0)
ACCCOMP ; Complete tests on accession
"RTN","LRAPRES",410,0)
 ;
"RTN","LRAPRES",411,0)
 N LRERR,LRFDA,LRFILE,LRIENS,LRK,LRORDT,LRSN,LRSRDT,LRT,LRX
"RTN","LRAPRES",412,0)
 ;
"RTN","LRAPRES",413,0)
 ;ZEXCEPT: LRAA,LRAD,LRAN,LRDFN,LRDUZ,LRI,LRSS
"RTN","LRAPRES",414,0)
 ;
"RTN","LRAPRES",415,0)
 ; Retrieve d/t released
"RTN","LRAPRES",416,0)
 I LRSS="AU" S LRK=$P(^LR(LRDFN,LRSS),"^",15)
"RTN","LRAPRES",417,0)
 E  S LRK=$P(^LR(LRDFN,LRSS,LRI,0),"^",11)
"RTN","LRAPRES",418,0)
 I LRK="" Q
"RTN","LRAPRES",419,0)
 ;
"RTN","LRAPRES",420,0)
 ; Lab Arrival d/t
"RTN","LRAPRES",421,0)
 I LRSS="AU" S LRSRDT=$P(^LR(LRDFN,LRSS),"^",1)
"RTN","LRAPRES",422,0)
 E  S LRSRDT=$P(^LR(LRDFN,LRSS,LRI,0),"^",10)
"RTN","LRAPRES",423,0)
 ;
"RTN","LRAPRES",424,0)
 ; Don't update workload tests (urgency>49)
"RTN","LRAPRES",425,0)
 S LRT=0,LRFILE=68.04
"RTN","LRAPRES",426,0)
 F  S LRT=$O(^LRO(68,LRAA,1,LRAD,1,LRAN,4,LRT)) Q:LRT<.5  D
"RTN","LRAPRES",427,0)
 . I $P(^LRO(68,LRAA,1,LRAD,1,LRAN,4,LRT,0),"^",2)>49 Q
"RTN","LRAPRES",428,0)
 . K LRIENS,LRFDA,LRERR(1)
"RTN","LRAPRES",429,0)
 . S LRIENS=LRT_","_LRAN_","_LRAD_","_LRAA_","
"RTN","LRAPRES",430,0)
 . S LRFDA(1,LRFILE,LRIENS,3)=$S($G(LRDUZ):LRDUZ,$G(DUZ):DUZ,1:"")
"RTN","LRAPRES",431,0)
 . S LRFDA(1,LRFILE,LRIENS,4)=LRK
"RTN","LRAPRES",432,0)
 . D UPDATE^DIE("","LRFDA(1)","","LRERR(1)")
"RTN","LRAPRES",433,0)
 ;
"RTN","LRAPRES",434,0)
 ; Update order with release date/time if available.
"RTN","LRAPRES",435,0)
 ;  - check for lab arrival time and update if missing
"RTN","LRAPRES",436,0)
 S LRX=$G(^LRO(68,LRAA,1,LRAD,1,LRAN,0))
"RTN","LRAPRES",437,0)
 S LRORDT=$P(LRX,"^",4),LRSN=$P(LRX,"^",5)
"RTN","LRAPRES",438,0)
 I LRORDT>0,LRSN>0,$D(^LRO(69,LRORDT,1,LRSN,0)) D
"RTN","LRAPRES",439,0)
 . K LRFILE,LRIENS
"RTN","LRAPRES",440,0)
 . S LRIENS=LRSN_","_LRORDT_",",LRFILE=69.01
"RTN","LRAPRES",441,0)
 . I $P($G(^LRO(69,LRORDT,1,LRSN,3)),"^")="",LRSRDT S LRFDA(2,LRFILE,LRIENS,20)=LRSRDT
"RTN","LRAPRES",442,0)
 . S LRFDA(2,LRFILE,LRIENS,21)=LRK
"RTN","LRAPRES",443,0)
 . D UPDATE^DIE("","LRFDA(2)","","LRERR(2)")
"RTN","LRAPRES",444,0)
 ;
"RTN","LRAPRES",445,0)
 Q
"RTN","LRAPRES",446,0)
 ;
"RTN","LRAPRES",447,0)
 ;
"RTN","LRAPRES",448,0)
END ; Clean-up variables and quit
"RTN","LRAPRES",449,0)
 K LRAD1,LRDATA,LRAU,LRRDTE,LRTEXT,LRSEL,LRFILE,LRIENS,LRIENS1
"RTN","LRAPRES",450,0)
 K LRFDA,ERR,IENS,LROUT,LRIEN,LRTMP
"RTN","LRAPRES",451,0)
 K ^TMP("LRAPBR",$J),^TMP("TIUP",$J)
"RTN","LRAPRES",452,0)
 D:$T(CLEAN^LRCAPES)'="" CLEAN^LRCAPES
"RTN","LRAPRES",453,0)
 D V^LRU
"RTN","LRAPRES",454,0)
 Q
"RTN","LRUDEL")
0^6^B25303229^B24276751
"RTN","LRUDEL",1,0)
LRUDEL ;DALOI/REG,CYM,PMK - DELETE AN AP ACCESSION NUMBER ;17 Sep 2013 7:30 AM
"RTN","LRUDEL",2,0)
 ;;5.2;LAB SERVICE;**1,72,121,201,350,427,433**;Sep 27, 1994;Build 4
"RTN","LRUDEL",3,0)
 ;
"RTN","LRUDEL",4,0)
 D END,^LRAP G:'$D(Y) END D XR^LRU
"RTN","LRUDEL",5,0)
 W !?22,"Delete an Accession Number",!!
"RTN","LRUDEL",6,0)
 ;
"RTN","LRUDEL",7,0)
D S %DT("A")="Accession number date: ",%DT="AQE" D ^%DT K %DT Q:Y<1  S (Y,LRAD)=$E(Y,1,3)_"0000" D DATE S LRH(0)=Y
"RTN","LRUDEL",8,0)
 ;
"RTN","LRUDEL",9,0)
 I '$D(^LRO(68,LRAA,1,LRAD,0)) W $C(7),!!,"No accession numbers for ",LRH(0),! G D
"RTN","LRUDEL",10,0)
 S H(2)=$E(LRAD,1,3)
"RTN","LRUDEL",11,0)
N1 K LRNO
"RTN","LRUDEL",12,0)
 R !!,"Select Accession # : ",LRAN:DTIME Q:LRAN=""!(LRAN["^")
"RTN","LRUDEL",13,0)
 D REST
"RTN","LRUDEL",14,0)
 L -^LRO(69.2,LRAA)
"RTN","LRUDEL",15,0)
 I $G(LRDFN),$G(LRSS)'="" L -^LR(LRDFN,LRSS)
"RTN","LRUDEL",16,0)
 G N1
"RTN","LRUDEL",17,0)
 ;
"RTN","LRUDEL",18,0)
 ;
"RTN","LRUDEL",19,0)
REST ;
"RTN","LRUDEL",20,0)
 ;
"RTN","LRUDEL",21,0)
 N LRDIV
"RTN","LRUDEL",22,0)
 ;
"RTN","LRUDEL",23,0)
 I LRAN'?1N.N W $C(7),!!,"Enter NUMBERS only" Q
"RTN","LRUDEL",24,0)
 I '$D(^LRO(68,LRAA,1,LRAD,1,LRAN,0)) W $C(7),!!,"Accession number ",LRAN," for ",LRH(0)," not in ACCESSION file",!! Q
"RTN","LRUDEL",25,0)
 ;
"RTN","LRUDEL",26,0)
 L +^LRO(68,LRAA,1,LRAD,1,LRAN):DILOCKTM
"RTN","LRUDEL",27,0)
 I '$T W !!?10,$C(7),"Someone else is editing this entry ",! Q
"RTN","LRUDEL",28,0)
 ;
"RTN","LRUDEL",29,0)
 L +^LRO(69.2,LRAA):DILOCKTM
"RTN","LRUDEL",30,0)
 I '$T W !!?10,$C(7),"Someone else is editing this entry ",! Q
"RTN","LRUDEL",31,0)
 ;
"RTN","LRUDEL",32,0)
 S LRND=^LRO(68,LRAA,1,LRAD,1,LRAN,0),LRDFN=+LRND
"RTN","LRUDEL",33,0)
 S LRDIV=+$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,.4)),U,1)
"RTN","LRUDEL",34,0)
 I '$D(^LR(LRDFN,0)) D BAD Q
"RTN","LRUDEL",35,0)
 ;
"RTN","LRUDEL",36,0)
 S Y=^LR(LRDFN,0),LRPFN=$P(Y,U,2),LRFNAM=$P(^DIC(LRPFN,0),U),LRPF=^(0,"GL"),Y=$P(Y,U,3),LRP=@(LRPF_Y_",0)")
"RTN","LRUDEL",37,0)
 W !,$P(LRP,U)," ID: ",$P(LRP,U,9) S Y=$P(LRP,U,3) D DATE W:Y'[1700 " DOB: ",Y
"RTN","LRUDEL",38,0)
 W !!,"ACC # ",LRAN
"RTN","LRUDEL",39,0)
 ;
"RTN","LRUDEL",40,0)
 I LRSS="AU" D  Q
"RTN","LRUDEL",41,0)
 . S LRRC=$P($G(^LR(LRDFN,"AU")),U)
"RTN","LRUDEL",42,0)
 . S Y=$$GET1^DIQ(63,LRDFN_",",12) ;Date of Death
"RTN","LRUDEL",43,0)
 . D DEL^LRAUAW
"RTN","LRUDEL",44,0)
 ;
"RTN","LRUDEL",45,0)
 I '$D(^LRO(68,LRAA,1,LRAD,1,LRAN,3)) D
"RTN","LRUDEL",46,0)
 . S LRI=$O(^LR(LRXREF,H(2),LRABV,LRAN,LRDFN,0))
"RTN","LRUDEL",47,0)
 . I LRI S LRSD=$P($G(^LR(LRDFN,LRSS,LRI,0)),U,1)
"RTN","LRUDEL",48,0)
 ;
"RTN","LRUDEL",49,0)
 I $D(^LRO(68,LRAA,1,LRAD,1,LRAN,3)) D
"RTN","LRUDEL",50,0)
 . S X=^LRO(68,LRAA,1,LRAD,1,LRAN,3)
"RTN","LRUDEL",51,0)
 . S LRSD=+X
"RTN","LRUDEL",52,0)
 . S LRI=$P(X,"^",5)
"RTN","LRUDEL",53,0)
 . I 'LRI S LRI=$O(^LR(LRXREF,H(2),LRABV,LRAN,LRDFN,0))
"RTN","LRUDEL",54,0)
 ;
"RTN","LRUDEL",55,0)
 I '$G(LRI) D  Q  ;No data in #63 for this accession; only delete from #68
"RTN","LRUDEL",56,0)
 . W "  OK to DELETE "
"RTN","LRUDEL",57,0)
 . S %=2 D YN^LRU
"RTN","LRUDEL",58,0)
 . I %'=1 W $C(7),!?4,"NOT DELETED",!! Q
"RTN","LRUDEL",59,0)
 . K ^LRO(68,LRAA,1,LRAD,1,LRAN),^LRO(68,LRAA,1,"AC",LRDIV,LRAD,LRAN)
"RTN","LRUDEL",60,0)
 . D T
"RTN","LRUDEL",61,0)
 . W !,LRAN," Deleted"
"RTN","LRUDEL",62,0)
  ;
"RTN","LRUDEL",63,0)
 S X=$G(^LR(LRDFN,LRSS,LRI,0))
"RTN","LRUDEL",64,0)
 S LRRC=$P(X,U,10)
"RTN","LRUDEL",65,0)
 I $P(X,"^",3)!($P(X,"^",11))!($P(X,"^",15)) W $C(7),!,"Report completed &/or released, deletion not allowed." Q
"RTN","LRUDEL",66,0)
 ;
"RTN","LRUDEL",67,0)
 L +^LR(LRDFN,LRSS,LRI):DILOCKTM
"RTN","LRUDEL",68,0)
 I '$T W !!?10,"Someone else is editing this entry ",!,$C(7) Q
"RTN","LRUDEL",69,0)
 ;
"RTN","LRUDEL",70,0)
 S Y=LRRC
"RTN","LRUDEL",71,0)
 D DATE
"RTN","LRUDEL",72,0)
 W "  DATE RECEIVED: ",Y,"  OK to DELETE "
"RTN","LRUDEL",73,0)
 S %=2 D YN^LRU
"RTN","LRUDEL",74,0)
 I %'=1 W $C(7),!?4,"NOT DELETED",!! Q
"RTN","LRUDEL",75,0)
 ;
"RTN","LRUDEL",76,0)
 D DEL69AN
"RTN","LRUDEL",77,0)
 ;
"RTN","LRUDEL",78,0)
 D ACC^LR7OB1(LRAA,LRAD,LRAN,"OC") ; Cancel order
"RTN","LRUDEL",79,0)
 ;
"RTN","LRUDEL",80,0)
 I $D(^LR(LRDFN,LRSS,LRI)) D
"RTN","LRUDEL",81,0)
 . ;
"RTN","LRUDEL",82,0)
 . I $T(CANCEL^MAGT7MA)'="" D CANCEL^MAGT7MA ; invoke Imaging HL7 routine - P433
"RTN","LRUDEL",83,0)
 . ;
"RTN","LRUDEL",84,0)
 . K ^LR(LRDFN,LRSS,LRI)
"RTN","LRUDEL",85,0)
 . I $D(^LR(LRDFN,LRSS,0)) S X=^LR(LRDFN,LRSS,0),X(1)=$O(^(0)),X(2)=$P(X,"^",4)-1,^(0)=$P(X,"^",1,2)_"^"_X(1)_"^"_X(2)
"RTN","LRUDEL",86,0)
 ;
"RTN","LRUDEL",87,0)
 K:LRRC ^LR(LRXR,LRRC,LRDFN,LRI)
"RTN","LRUDEL",88,0)
 K ^LR(LRXREF,H(2),LRABV,LRAN,LRDFN,LRI)
"RTN","LRUDEL",89,0)
 D K
"RTN","LRUDEL",90,0)
 K ^LRO(68,LRAA,1,LRAD,1,LRAN),^LRO(68,LRAA,1,"AC",LRDIV,LRAD,LRAN)
"RTN","LRUDEL",91,0)
 K:LRRC ^LRO(68,LRAA,1,LRAD,1,"E",LRRC,LRAN)
"RTN","LRUDEL",92,0)
 ;
"RTN","LRUDEL",93,0)
 L +^LRO(68,LRAA,1,LRAD,1,0):DILOCKTM
"RTN","LRUDEL",94,0)
 I $T D
"RTN","LRUDEL",95,0)
 . S X=^LRO(68,LRAA,1,LRAD,1,0),X(1)=$O(^(0)),X(2)=$P(X,"^",4)-1
"RTN","LRUDEL",96,0)
 . S:X(2)<1 X(2)=0 S ^(0)=$P(X,"^",1,2)_"^"_X(1)_"^"_X(2)
"RTN","LRUDEL",97,0)
 . L -^LRO(68,LRAA,1,LRAD,1,0)
"RTN","LRUDEL",98,0)
 ;
"RTN","LRUDEL",99,0)
 D T
"RTN","LRUDEL",100,0)
 Q
"RTN","LRUDEL",101,0)
 ;
"RTN","LRUDEL",102,0)
 ;
"RTN","LRUDEL",103,0)
BAD W $C(7),!!,"Entry not in file",!!
"RTN","LRUDEL",104,0)
 Q
"RTN","LRUDEL",105,0)
 ;
"RTN","LRUDEL",106,0)
 ;
"RTN","LRUDEL",107,0)
T ;
"RTN","LRUDEL",108,0)
 N A
"RTN","LRUDEL",109,0)
 F A=1,2,3,4 I $D(^LRO(69.2,LRAA,A,LRAN)) D
"RTN","LRUDEL",110,0)
 . K ^LRO(69.2,LRAA,A,LRAN)
"RTN","LRUDEL",111,0)
 . S X(1)=$O(^LRO(69.2,LRAA,A,0))
"RTN","LRUDEL",112,0)
 . S:'X(1) X(1)=0
"RTN","LRUDEL",113,0)
 . I $D(^LRO(69.2,LRAA,A,0)) S X=^(0),^(0)=$P(X,"^",1,2)_"^"_X(1)_"^"_$S(X(1)=0:X(1),1:($P(X,"^",4)-1))
"RTN","LRUDEL",114,0)
 Q
"RTN","LRUDEL",115,0)
 ;
"RTN","LRUDEL",116,0)
 ;
"RTN","LRUDEL",117,0)
DATE ; Returns the date in eye-readable month format
"RTN","LRUDEL",118,0)
 S Y=$TR($$FMTE^XLFDT(Y,"M"),"@"," ")
"RTN","LRUDEL",119,0)
 Q
"RTN","LRUDEL",120,0)
 ;
"RTN","LRUDEL",121,0)
 ;
"RTN","LRUDEL",122,0)
K ; also from LRAPED
"RTN","LRUDEL",123,0)
 N A
"RTN","LRUDEL",124,0)
 S A=0
"RTN","LRUDEL",125,0)
 F  S A=$O(^LRO(68,LRAA,1,LRAD,1,LRAN,4,A)) Q:'A  K ^LRO(68,"AA",LRAA_"|"_LRAD_"|"_LRAN_"|"_A)
"RTN","LRUDEL",126,0)
 Q
"RTN","LRUDEL",127,0)
 ;
"RTN","LRUDEL",128,0)
 ;
"RTN","LRUDEL",129,0)
DEL69AN ; Delete accession number out of file #69's reference
"RTN","LRUDEL",130,0)
 N LRODT,LRSN,LRI,DR,DIE,DA
"RTN","LRUDEL",131,0)
 S LRODT=+$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,0)),"^",4)
"RTN","LRUDEL",132,0)
 S LRSN=+$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,0)),"^",5)
"RTN","LRUDEL",133,0)
 ;
"RTN","LRUDEL",134,0)
 L +^LRO(69,LRODT,1,LRSN,2):DILOCKTM
"RTN","LRUDEL",135,0)
 I '$T W !!?10,$C(7),"Someone else is editing this entry ",! Q
"RTN","LRUDEL",136,0)
 ;
"RTN","LRUDEL",137,0)
 S DR="3///@;2///@;4///@;13///@;8///CA;9///L;10///^S X=DUZ"
"RTN","LRUDEL",138,0)
 S DIE="^LRO(69,"_LRODT_",1,"_LRSN_",2,",LRI=0
"RTN","LRUDEL",139,0)
 F  S LRI=$O(^LRO(69,LRODT,1,LRSN,2,LRI)) Q:'LRI  D
"RTN","LRUDEL",140,0)
 .Q:'$D(^LRO(69,LRODT,1,LRSN,2,LRI,0))
"RTN","LRUDEL",141,0)
 .Q:$P(^LRO(69,LRODT,1,LRSN,2,LRI,0),"^",5)'=LRAN
"RTN","LRUDEL",142,0)
 .Q:$P(^LRO(69,LRODT,1,LRSN,2,LRI,0),"^",4)'=LRAA
"RTN","LRUDEL",143,0)
 .Q:$P(^LRO(69,LRODT,1,LRSN,2,LRI,0),"^",3)'=LRAD
"RTN","LRUDEL",144,0)
 .S DA=LRI,DA(1)=LRSN,DA(2)=LRODT
"RTN","LRUDEL",145,0)
 .D ^DIE
"RTN","LRUDEL",146,0)
 L -^LRO(69,LRODT,1,LRSN,2)
"RTN","LRUDEL",147,0)
 Q
"RTN","LRUDEL",148,0)
 ;
"RTN","LRUDEL",149,0)
 ;
"RTN","LRUDEL",150,0)
END D V^LRU
"RTN","LRUDEL",151,0)
 Q
"VER")
8.0^22.0
"BLD",8756,6)
^346
**END**
**END**

