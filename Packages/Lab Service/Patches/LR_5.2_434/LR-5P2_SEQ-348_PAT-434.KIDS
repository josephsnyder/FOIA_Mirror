Released LR*5.2*434 SEQ #348
Extracted from mail message
**KIDS**:LR*5.2*434^

**INSTALL NAME**
LR*5.2*434
"BLD",9500,0)
LR*5.2*434^LAB SERVICE^0^3131009^y
"BLD",9500,1,0)
^^8^8^3131009^^
"BLD",9500,1,1,0)
This patch is a VM patch that addresses 2 issues in the Lab package.
"BLD",9500,1,2,0)
 
"BLD",9500,1,3,0)
1. Incomplete test definition leads to "ghost" tests showing up in
"BLD",9500,1,4,0)
   CPRS (Computerized Patient Record System).
"BLD",9500,1,5,0)
 
"BLD",9500,1,6,0)
2. Panel tests sometimes get wrong urgency stored in file
"BLD",9500,1,7,0)
   #68 (ACCESSION) when ordered with an atomic test with a higher
"BLD",9500,1,8,0)
   urgency than the panel test.
"BLD",9500,4,0)
^9.64PA^^
"BLD",9500,6.3)
1
"BLD",9500,"ABPKG")
n
"BLD",9500,"KRN",0)
^9.67PA^779.2^20
"BLD",9500,"KRN",.4,0)
.4
"BLD",9500,"KRN",.401,0)
.401
"BLD",9500,"KRN",.402,0)
.402
"BLD",9500,"KRN",.403,0)
.403
"BLD",9500,"KRN",.5,0)
.5
"BLD",9500,"KRN",.84,0)
.84
"BLD",9500,"KRN",3.6,0)
3.6
"BLD",9500,"KRN",3.8,0)
3.8
"BLD",9500,"KRN",9.2,0)
9.2
"BLD",9500,"KRN",9.8,0)
9.8
"BLD",9500,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",9500,"KRN",9.8,"NM",1,0)
LR7OV0^^0^B33645882
"BLD",9500,"KRN",9.8,"NM",2,0)
LRCAPV1S^^0^B5816954
"BLD",9500,"KRN",9.8,"NM","B","LR7OV0",1)

"BLD",9500,"KRN",9.8,"NM","B","LRCAPV1S",2)

"BLD",9500,"KRN",19,0)
19
"BLD",9500,"KRN",19.1,0)
19.1
"BLD",9500,"KRN",101,0)
101
"BLD",9500,"KRN",409.61,0)
409.61
"BLD",9500,"KRN",771,0)
771
"BLD",9500,"KRN",779.2,0)
779.2
"BLD",9500,"KRN",870,0)
870
"BLD",9500,"KRN",8989.51,0)
8989.51
"BLD",9500,"KRN",8989.52,0)
8989.52
"BLD",9500,"KRN",8994,0)
8994
"BLD",9500,"KRN","B",.4,.4)

"BLD",9500,"KRN","B",.401,.401)

"BLD",9500,"KRN","B",.402,.402)

"BLD",9500,"KRN","B",.403,.403)

"BLD",9500,"KRN","B",.5,.5)

"BLD",9500,"KRN","B",.84,.84)

"BLD",9500,"KRN","B",3.6,3.6)

"BLD",9500,"KRN","B",3.8,3.8)

"BLD",9500,"KRN","B",9.2,9.2)

"BLD",9500,"KRN","B",9.8,9.8)

"BLD",9500,"KRN","B",19,19)

"BLD",9500,"KRN","B",19.1,19.1)

"BLD",9500,"KRN","B",101,101)

"BLD",9500,"KRN","B",409.61,409.61)

"BLD",9500,"KRN","B",771,771)

"BLD",9500,"KRN","B",779.2,779.2)

"BLD",9500,"KRN","B",870,870)

"BLD",9500,"KRN","B",8989.51,8989.51)

"BLD",9500,"KRN","B",8989.52,8989.52)

"BLD",9500,"KRN","B",8994,8994)

"BLD",9500,"QUES",0)
^9.62^^
"BLD",9500,"REQB",0)
^9.611^2^2
"BLD",9500,"REQB",1,0)
LR*5.2*221^2
"BLD",9500,"REQB",2,0)
LR*5.2*350^2
"BLD",9500,"REQB","B","LR*5.2*221",1)

"BLD",9500,"REQB","B","LR*5.2*350",2)

"MBREQ")
0
"PKG",26,-1)
1^1
"PKG",26,0)
LAB SERVICE^LR^CORE LAB SYSTEM
"PKG",26,20,0)
^9.402P^^0
"PKG",26,22,0)
^9.49I^1^1
"PKG",26,22,1,0)
5.2^2940927^2950304
"PKG",26,22,1,"PAH",1,0)
434^3131009
"PKG",26,22,1,"PAH",1,1,0)
^^8^8^3131009
"PKG",26,22,1,"PAH",1,1,1,0)
This patch is a VM patch that addresses 2 issues in the Lab package.
"PKG",26,22,1,"PAH",1,1,2,0)
 
"PKG",26,22,1,"PAH",1,1,3,0)
1. Incomplete test definition leads to "ghost" tests showing up in
"PKG",26,22,1,"PAH",1,1,4,0)
   CPRS (Computerized Patient Record System).
"PKG",26,22,1,"PAH",1,1,5,0)
 
"PKG",26,22,1,"PAH",1,1,6,0)
2. Panel tests sometimes get wrong urgency stored in file
"PKG",26,22,1,"PAH",1,1,7,0)
   #68 (ACCESSION) when ordered with an atomic test with a higher
"PKG",26,22,1,"PAH",1,1,8,0)
   urgency than the panel test.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","LR7OV0")
0^1^B33645882^B31803944
"RTN","LR7OV0",1,0)
LR7OV0 ;DALOI/STAFF - Update orderable items ;Oct 10, 2007
"RTN","LR7OV0",2,0)
 ;;5.2;LAB SERVICE;**121,187,357,361,350,434**;Sep 27, 1994;Build 1
"RTN","LR7OV0",3,0)
 ;
"RTN","LR7OV0",4,0)
TEST(TEST,ICNT) ;Process single test
"RTN","LR7OV0",5,0)
 ;TEST=test ptr to file 60
"RTN","LR7OV0",6,0)
 ;ICNT=Current counter in ORUPDMSG(ICNT)
"RTN","LR7OV0",7,0)
 N TYPE,TESTID,IFN,IFN1,CTR,CTR1,GENW,X0,S0,SAMP,MAX,DMAX,COLLECT,SAMPLE,SPEC,SUBID,SYN,COST,WCOM,Y9,Y10,Y11
"RTN","LR7OV0",8,0)
 Q:'$D(^LAB(60,TEST,0))  S X0=^(0),COST=$P(X0,"^",11),SUB=$P(X0,"^",4),TYPE=$P(X0,"^",3),CTR1=0
"RTN","LR7OV0",9,0)
 I $D(^LAB(60,TEST,6)) S (CTR,IFN)=0 F  S IFN=$O(^LAB(60,TEST,6,IFN)) Q:IFN<1  S CTR=CTR+1,GENW(CTR)=^(IFN,0)
"RTN","LR7OV0",10,0)
 S (CTR,IFN)=0 F  S IFN=$O(^LAB(60,TEST,5,IFN)) Q:IFN<1  S CTR=CTR+1,SYN(CTR)=^(IFN,0)
"RTN","LR7OV0",11,0)
 S (Y9,Y10,Y11)="" I $P($G(^LAB(60,TEST,64)),"^") S Y9=$P(^(64),"^"),Y10=$P(^LAM(Y9,0),"^"),Y9=$P(^(0),"^",2),Y11="99NLT"
"RTN","LR7OV0",12,0)
 D
"RTN","LR7OV0",13,0)
 . S (COLLECT,SAMP,SPEC)=0,TESTID=$$UVID^LR7OU0(TEST,+SPEC,Y9,Y11,Y10,"ORUPDMSG"),ICNT=ICNT+1,ORUPDMSG(ICNT)=$$MFE(MFECODE,TESTID)
"RTN","LR7OV0",14,0)
 . S ICNT=ICNT+1,ORUPDMSG(ICNT)=$$ZLR("","",CTR1,SUB,"","",COST,TYPE)
"RTN","LR7OV0",15,0)
 . S IFN1=0 F  S IFN1=$O(^LAB(60,TEST,2,IFN1)) Q:IFN1<1  S X=^(IFN1,0) I $D(^LAB(60,+X,0)) D
"RTN","LR7OV0",16,0)
 .. N Y9,Y10,Y11 S (Y9,Y10,Y11)="" I $P($G(^LAB(60,+X,64)),"^") S Y9=$P(^(64),"^"),Y10=$P(^LAM(Y9,0),"^"),Y9=$P(^(0),"^",2),Y11="99NLT"
"RTN","LR7OV0",17,0)
 .. S SUBID=$$UVID^LR7OU0($P(X,"^"),"",Y9,Y11,Y10,"ORUPDMSG"),ICNT=ICNT+1,ORUPDMSG(ICNT)="ZLC||||"_SUBID
"RTN","LR7OV0",18,0)
 . D ZSY(.SYN),NTE(.GENW,.WCOM)
"RTN","LR7OV0",19,0)
 Q
"RTN","LR7OV0",20,0)
 ;
"RTN","LR7OV0",21,0)
MFE(EVENT,KEY) ;MFE component
"RTN","LR7OV0",22,0)
 ;EVENT=MAD-Add Record, MDL-Delete Record, MUP-Update Record
"RTN","LR7OV0",23,0)
 ;      MDC-Deactivate, MAC-Reactivate
"RTN","LR7OV0",24,0)
 N MFE
"RTN","LR7OV0",25,0)
 S MFE="MFE|"_EVENT_"|||"_KEY
"RTN","LR7OV0",26,0)
 Q MFE
"RTN","LR7OV0",27,0)
 ;
"RTN","LR7OV0",28,0)
ZLR(SPEC,COLLECT,SEQ,SUB,MAXORD,DMAXORD,COST,TYPE) ;ZLR component
"RTN","LR7OV0",29,0)
 N ZLR
"RTN","LR7OV0",30,0)
 S ZLR="ZLR|"_SPEC_"|"_COLLECT_"|"_SEQ_"|"_SUB_"|"_MAXORD_"|"_DMAXORD_"|"_COST_"|"_TYPE
"RTN","LR7OV0",31,0)
 Q ZLR
"RTN","LR7OV0",32,0)
 ;
"RTN","LR7OV0",33,0)
ZSY(SYN) ;ZSY component
"RTN","LR7OV0",34,0)
 N IFN
"RTN","LR7OV0",35,0)
 S IFN=0 F  S IFN=$O(SYN(IFN)) Q:IFN<1  S ICNT=ICNT+1,ORUPDMSG(ICNT)="ZSY|"_IFN_"|"_SYN(IFN)
"RTN","LR7OV0",36,0)
 Q
"RTN","LR7OV0",37,0)
 ;
"RTN","LR7OV0",38,0)
NTE(GEN,COM) ;NTE component
"RTN","LR7OV0",39,0)
 N IFN,CTR S CTR=0
"RTN","LR7OV0",40,0)
 S ICNT=ICNT+1 D NTE^LR7OU01(CTR,"P","GEN(",ICNT)
"RTN","LR7OV0",41,0)
 S ICNT=ICNT+1 D NTE^LR7OU01(CTR,"P","COM(",ICNT)
"RTN","LR7OV0",42,0)
 Q
"RTN","LR7OV0",43,0)
 ;
"RTN","LR7OV0",44,0)
MFI(EVENT) ;MFI component
"RTN","LR7OV0",45,0)
 ;EVENT=REP for initial population of orderables
"RTN","LR7OV0",46,0)
 ;     =UPD for subsequent updates
"RTN","LR7OV0",47,0)
 N MFI
"RTN","LR7OV0",48,0)
 S MFI="MFI|60^Lab Test^99DD||"_EVENT_"|||NE"
"RTN","LR7OV0",49,0)
 Q MFI
"RTN","LR7OV0",50,0)
 ;
"RTN","LR7OV0",51,0)
SINGLE(TEST,MFICODE,MFECODE) ;Message for a single test
"RTN","LR7OV0",52,0)
 ;TEST= ptr to test in file 60
"RTN","LR7OV0",53,0)
 ;MFICODE=File Level Event Code
"RTN","LR7OV0",54,0)
 ;MFECODE=Record Level Event Code
"RTN","LR7OV0",55,0)
 ;N X,ORUPDMSG,MSG
"RTN","LR7OV0",56,0)
 L +LR7OV0(TEST):9999
"RTN","LR7OV0",57,0)
 S MSG="ORUPDMSG",X=$$MSH^LR7OU0("MFN"),ORUPDMSG(1)=X
"RTN","LR7OV0",58,0)
 S X=$$MFI(MFICODE),ORUPDMSG(2)=X
"RTN","LR7OV0",59,0)
 D TEST(TEST,2)
"RTN","LR7OV0",60,0)
 ;W !!,$P(^LAB(60,TEST,0),"^"),! I $D(ORUPDMSG(3)) ZW ORUPDMSG
"RTN","LR7OV0",61,0)
 ;
"RTN","LR7OV0",62,0)
 ; If test deleted then mark file 101.43 entry as "inactive"
"RTN","LR7OV0",63,0)
 I '$D(^LAB(60,TEST,0)) D
"RTN","LR7OV0",64,0)
 . N TESTID
"RTN","LR7OV0",65,0)
 . S MFECODE="MDC"
"RTN","LR7OV0",66,0)
 . S TESTID=$$UVID^LR7OU0(TEST,0,"","","","ORUPDMSG")
"RTN","LR7OV0",67,0)
 . S ORUPDMSG(3)=$$MFE(MFECODE,TESTID)
"RTN","LR7OV0",68,0)
 I $D(ORUPDMSG(3)) S ORUPDMSG="ORUPDMSG" D MSG^XQOR("LR7O ORDERABLE OR",.ORUPDMSG) ;Send update message
"RTN","LR7OV0",69,0)
 L -LR7OV0(TEST)
"RTN","LR7OV0",70,0)
 Q
"RTN","LR7OV0",71,0)
 ;
"RTN","LR7OV0",72,0)
ADD(TEST) ;Add single record to Master file
"RTN","LR7OV0",73,0)
 N MFICODE,MFECODE S MFECODE="MAD",MFICODE="REP" D SINGLE(TEST,MFICODE,MFECODE)
"RTN","LR7OV0",74,0)
 Q
"RTN","LR7OV0",75,0)
 ;
"RTN","LR7OV0",76,0)
DEL(TEST) ;Delete single record from Master file
"RTN","LR7OV0",77,0)
 N MFICODE,MFECODE S MFECODE="MDL",MFICODE="UPD" D SINGLE(TEST,MFICODE,MFECODE)
"RTN","LR7OV0",78,0)
 Q
"RTN","LR7OV0",79,0)
 ;
"RTN","LR7OV0",80,0)
UPD(TEST) ;Update record in Master file
"RTN","LR7OV0",81,0)
 ;Modified for patch LR*5.2*361
"RTN","LR7OV0",82,0)
 N ZTSAVE,ZTRTN,ZTDESC,ZTDTH,ZTIO
"RTN","LR7OV0",83,0)
 S ZTSAVE("TEST")=TEST
"RTN","LR7OV0",84,0)
 S ZTRTN="TUPD^LR7OV0"
"RTN","LR7OV0",85,0)
 S ZTDESC="LABORATORY TEST FILE HL7 update message"
"RTN","LR7OV0",86,0)
 S ZTDTH=$H
"RTN","LR7OV0",87,0)
 S ZTIO=""
"RTN","LR7OV0",88,0)
 D ^%ZTLOAD
"RTN","LR7OV0",89,0)
 Q
"RTN","LR7OV0",90,0)
 ;
"RTN","LR7OV0",91,0)
TUPD ;Tasked update of record in Master file
"RTN","LR7OV0",92,0)
 ;Added for patch LR*5.2*361
"RTN","LR7OV0",93,0)
 N MFICODE,MFECODE S MFECODE="MUP",MFICODE="UPD" D SINGLE(TEST,MFICODE,MFECODE)
"RTN","LR7OV0",94,0)
 Q
"RTN","LR7OV0",95,0)
 ;
"RTN","LR7OV0",96,0)
DEACT(TEST) ;Deactivate record in Master file
"RTN","LR7OV0",97,0)
 N MFICODE,MFECODE S MFECODE="MDC",MFICODE="UPD" D SINGLE(TEST,MFICODE,MFECODE)
"RTN","LR7OV0",98,0)
 Q
"RTN","LR7OV0",99,0)
 ;
"RTN","LR7OV0",100,0)
REACT(TEST) ;Reactivate record in Master file
"RTN","LR7OV0",101,0)
 N MFICODE,MFECODE S MFECODE="MAC",MFICODE="UPD" D SINGLE(TEST,MFICODE,MFECODE)
"RTN","LR7OV0",102,0)
 Q
"RTN","LR7OV0",103,0)
 ;
"RTN","LR7OV0",104,0)
 ;Following code added to support LR*5.2*357
"RTN","LR7OV0",105,0)
 ;Following code modified to support LR*5.2*361
"RTN","LR7OV0",106,0)
 ;Designed to help update the ORDERABLE ITEMS FILE (file 101.43) after the deletion
"RTN","LR7OV0",107,0)
 ;of a SYNONYM from the LABORATORY TEST file (file 60).
"RTN","LR7OV0",108,0)
UPD2(TEST,KSYN) ;Update record in Master file - Modified for LR*5.2*361
"RTN","LR7OV0",109,0)
 ;TEST = IEN of lab test in file 60
"RTN","LR7OV0",110,0)
 ;KSYN = IEN of synonym to be deleted from lab test in file 60
"RTN","LR7OV0",111,0)
 ;Modified for LR*5.2*361
"RTN","LR7OV0",112,0)
 N ZTSAVE,ZTRTN,ZTDESC,ZTDTH,ZTIO
"RTN","LR7OV0",113,0)
 S ZTSAVE("TEST")=TEST
"RTN","LR7OV0",114,0)
 S ZTSAVE("KSYN")=KSYN
"RTN","LR7OV0",115,0)
 S ZTRTN="TUPD2^LR7OV0"
"RTN","LR7OV0",116,0)
 S ZTDESC="LABORATORY TEST FILE HL7 update message"
"RTN","LR7OV0",117,0)
 S ZTDTH=$H
"RTN","LR7OV0",118,0)
 S ZTIO=""
"RTN","LR7OV0",119,0)
 D ^%ZTLOAD
"RTN","LR7OV0",120,0)
 Q
"RTN","LR7OV0",121,0)
 ;
"RTN","LR7OV0",122,0)
TUPD2 ;Update record in Master file
"RTN","LR7OV0",123,0)
 ;TEST = IEN of lab test in file 60
"RTN","LR7OV0",124,0)
 ;KSYN = IEN of synonym to be deleted from lab test in file 60
"RTN","LR7OV0",125,0)
 N MFICODE,MFECODE S MFECODE="MUP",MFICODE="UPD" D SINGLE2(TEST,KSYN,MFICODE,MFECODE)
"RTN","LR7OV0",126,0)
 Q
"RTN","LR7OV0",127,0)
 ;
"RTN","LR7OV0",128,0)
SINGLE2(TEST,KSYN,MFICODE,MFECODE) ;Message for a single test
"RTN","LR7OV0",129,0)
 ;TEST = IEN of lab test in file 60
"RTN","LR7OV0",130,0)
 ;KSYN = IEN of synonym to be deleted from lab test in file 60
"RTN","LR7OV0",131,0)
 ;MFICODE = File Level Event Code
"RTN","LR7OV0",132,0)
 ;MFECODE = Record Level Event Code
"RTN","LR7OV0",133,0)
 N X,ORUPDMSG,MSG
"RTN","LR7OV0",134,0)
 S MSG="ORUPDMSG",X=$$MSH^LR7OU0("MFN"),ORUPDMSG(1)=X
"RTN","LR7OV0",135,0)
 S X=$$MFI(MFICODE),ORUPDMSG(2)=X
"RTN","LR7OV0",136,0)
 D TEST2(TEST,KSYN,2)
"RTN","LR7OV0",137,0)
 I $D(ORUPDMSG(3)) S ORUPDMSG="ORUPDMSG" D MSG^XQOR("LR7O ORDERABLE OR",.ORUPDMSG) ;Send update message
"RTN","LR7OV0",138,0)
 Q
"RTN","LR7OV0",139,0)
 ;
"RTN","LR7OV0",140,0)
TEST2(TEST,KSYN,ICNT) ;Process single test
"RTN","LR7OV0",141,0)
 ;TEST = IEN of lab test in file 60
"RTN","LR7OV0",142,0)
 ;KSYN = IEN of synonym to be deleted from lab test in file 60
"RTN","LR7OV0",143,0)
 ;ICNT = Current counter in ORUPDMSG(ICNT)
"RTN","LR7OV0",144,0)
 N TYPE,TESTID,IFN,IFN1,CTR,CTR1,GENW,X0,S0,SAMP,MAX,DMAX,COLLECT,SAMPLE,SPEC,SYN,SUBID,COST,WCOM,Y9,Y10,Y11
"RTN","LR7OV0",145,0)
 Q:'$D(^LAB(60,TEST,0))  S X0=^(0),COST=$P(X0,"^",11),SUB=$P(X0,"^",4),TYPE=$P(X0,"^",3),CTR1=0
"RTN","LR7OV0",146,0)
 I $D(^LAB(60,TEST,6)) S (CTR,IFN)=0 F  S IFN=$O(^LAB(60,TEST,6,IFN)) Q:IFN<1  S CTR=CTR+1,GENW(CTR)=^(IFN,0)
"RTN","LR7OV0",147,0)
 S (CTR,IFN)=0 F  S IFN=$O(^LAB(60,TEST,5,IFN)) Q:IFN<1  D
"RTN","LR7OV0",148,0)
 . S:KSYN'=IFN CTR=CTR+1,SYN(CTR)=^LAB(60,TEST,5,IFN,0)
"RTN","LR7OV0",149,0)
 S (Y9,Y10,Y11)="" I $P($G(^LAB(60,TEST,64)),"^") S Y9=$P(^(64),"^"),Y10=$P(^LAM(Y9,0),"^"),Y9=$P(^(0),"^",2),Y11="99NLT"
"RTN","LR7OV0",150,0)
 D
"RTN","LR7OV0",151,0)
 . S (COLLECT,SAMP,SPEC)=0,TESTID=$$UVID^LR7OU0(TEST,+SPEC,Y9,Y11,Y10,"ORUPDMSG"),ICNT=ICNT+1,ORUPDMSG(ICNT)=$$MFE(MFECODE,TESTID)
"RTN","LR7OV0",152,0)
 . S ICNT=ICNT+1,ORUPDMSG(ICNT)=$$ZLR("","",CTR1,SUB,"","",COST,TYPE)
"RTN","LR7OV0",153,0)
 . S IFN1=0 F  S IFN1=$O(^LAB(60,TEST,2,IFN1)) Q:IFN1<1  S X=^(IFN1,0) I $D(^LAB(60,+X,0)) D
"RTN","LR7OV0",154,0)
 .. N Y9,Y10,Y11 S (Y9,Y10,Y11)="" I $P($G(^LAB(60,+X,64)),"^") S Y9=$P(^(64),"^"),Y10=$P(^LAM(Y9,0),"^"),Y9=$P(^(0),"^",2),Y11="99NLT"
"RTN","LR7OV0",155,0)
 .. S SUBID=$$UVID^LR7OU0($P(X,"^"),"",Y9,Y11,Y10,"ORUPDMSG"),ICNT=ICNT+1,ORUPDMSG(ICNT)="ZLC||||"_SUBID
"RTN","LR7OV0",156,0)
 . D ZSY(.SYN),NTE(.GENW,.WCOM)
"RTN","LR7OV0",157,0)
 Q
"RTN","LRCAPV1S")
0^2^B5816954^B5317067
"RTN","LRCAPV1S",1,0)
LRCAPV1S ;SLC/FHS-SET WKLD CODE INTO LRO(68 PART 2 ; 12/3/1997
"RTN","LRCAPV1S",2,0)
 ;;5.2;LAB SERVICE;**42,153,201,221,434**;Sep 27, 1994;Build 1
"RTN","LRCAPV1S",3,0)
SET ; From LRCAPV1
"RTN","LRCAPV1S",4,0)
 Q:'$D(^LRO(68,+LRAA,1,LRAD,1,LRAN,0))#2
"RTN","LRCAPV1S",5,0)
 I '$D(LRTIME) S LRTIME=$$NOW^XLFDT
"RTN","LRCAPV1S",6,0)
 I '$P(LRTIME,".",2) S LRTIME=$$NOW^XLFDT
"RTN","LRCAPV1S",7,0)
 I '$D(^LRO(68,+LRAA,1,LRAD,1,LRAN,4,LRT,0))#2 D
"RTN","LRCAPV1S",8,0)
 .  S LRURGW=$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,4,+$G(LRT("P")),0)),U,2)  ; urgency from parent test
"RTN","LRCAPV1S",9,0)
 .  I LRURGW'>0,$G(LRALERT) S LRURGW=LRALERT
"RTN","LRCAPV1S",10,0)
 .  S ^LRO(68,+LRAA,1,LRAD,1,LRAN,4,LRT,0)=LRT_U_(50+$G(LRURGW))_U_U_DUZ_U_LRTIME_"^^^"_LRCDEF_U_$P($G(LRT("P")),U)
"RTN","LRCAPV1S",11,0)
 .  S $P(^LRO(68,+LRAA,1,LRAD,1,LRAN,4,0),U,3)=LRT,$P(^(0),U,4)=1+$P(^(0),U,4),^LRO(68,+LRAA,1,LRAD,1,LRAN,4,"B",LRT,LRT)=""
"RTN","LRCAPV1S",12,0)
 S:'$P(^LRO(68,+LRAA,1,LRAD,1,LRAN,4,LRT,0),U,8) $P(^(0),U,8)=$G(LRCDEF)
"RTN","LRCAPV1S",13,0)
 S:'$D(^LRO(68,+LRAA,1,LRAD,1,LRAN,4,LRT,1,0))#2 ^(0)="^68.14P^" S NODE0=^(0),NODE=LRP_U_"^^^^"_LRTIME_U_DUZ_U_DUZ(2)_U_$S($G(LRCAPMS):LRCAPMS,1:+LRAA)_U
"RTN","LRCAPV1S",14,0)
 I '$D(^LRO(68,+LRAA,1,LRAD,1,LRAN,4,LRT,1,LRP,0)) S $P(NODE0,U,3)=LRP,$P(NODE0,U,4)=1+$P(NODE0,U,4),^LRO(68,+LRAA,1,LRAD,1,LRAN,4,LRT,1,0)=NODE0,^(LRP,0)=NODE
"RTN","LRCAPV1S",15,0)
 S X=^LRO(68,+LRAA,1,LRAD,1,LRAN,4,LRT,1,LRP,0) I '$D(LRADD),$P(X,U,2) Q
"RTN","LRCAPV1S",16,0)
 I $D(LRADD) S:'$P(X,U,3) $P(X,U,2)=LRCNT+$P(X,U,2) S:$P(X,U,3) $P(X,U,2)=LRCNT,$P(X,U,3)=0 S ^LRO(68,+LRAA,1,LRAD,1,LRAN,4,LRT,1,LRP,0)=X
"RTN","LRCAPV1S",17,0)
 I '$D(LRADD),'$P(X,U,3) S $P(X,U,2)=LRCNT,^LRO(68,+LRAA,1,LRAD,1,LRAN,4,LRT,1,LRP,0)=X
"RTN","LRCAPV1S",18,0)
 I $G(LRCSQ),$G(LRCSQQ) D
"RTN","LRCAPV1S",19,0)
 . S ^XTMP("LRCAP",LRCSQ,DUZ,0)=$$HTFM^XLFDT($H+30,1)_U_DT_U_"Lab Control workload count"_U_$G(DUZ)
"RTN","LRCAPV1S",20,0)
 . S ^XTMP("LRCAP",LRCSQ,DUZ,LRP)=""
"RTN","LRCAPV1S",21,0)
 Q
"VER")
8.0^22.0
"BLD",9500,6)
^348
**END**
**END**

