KIDS Distribution saved on Jul 07, 2010@13:41:37
YS*5.01*97
**KIDS**:YS*5.01*97^

**INSTALL NAME**
YS*5.01*97
"BLD",19039,0)
YS*5.01*97^MENTAL HEALTH^0^3100707^y
"BLD",19039,1,0)
^^2^2^3100427^
"BLD",19039,1,1,0)
Please refer to YS*5.01*97 in the National Patch Module for a description 
"BLD",19039,1,2,0)
of this patch.
"BLD",19039,4,0)
^9.64PA^^0
"BLD",19039,6.3)
42
"BLD",19039,"ABPKG")
n
"BLD",19039,"INIT")
HL7^YS97POST
"BLD",19039,"KRN",0)
^9.67PA^8989.52^19
"BLD",19039,"KRN",.4,0)
.4
"BLD",19039,"KRN",.4,"NM",0)
^9.68A^^0
"BLD",19039,"KRN",.401,0)
.401
"BLD",19039,"KRN",.401,"NM",0)
^9.68A^^0
"BLD",19039,"KRN",.402,0)
.402
"BLD",19039,"KRN",.403,0)
.403
"BLD",19039,"KRN",.5,0)
.5
"BLD",19039,"KRN",.84,0)
.84
"BLD",19039,"KRN",3.6,0)
3.6
"BLD",19039,"KRN",3.8,0)
3.8
"BLD",19039,"KRN",3.8,"NM",0)
^9.68A^1^1
"BLD",19039,"KRN",3.8,"NM",1,0)
YS MHA-MHNDB^^0
"BLD",19039,"KRN",3.8,"NM","B","YS MHA-MHNDB",1)

"BLD",19039,"KRN",9.2,0)
9.2
"BLD",19039,"KRN",9.8,0)
9.8
"BLD",19039,"KRN",9.8,"NM",0)
^9.68A^13^6
"BLD",19039,"KRN",9.8,"NM",7,0)
YTQAPI14^^0^B29200951
"BLD",19039,"KRN",9.8,"NM",8,0)
YTQPRT^^0^B29277675
"BLD",19039,"KRN",9.8,"NM",10,0)
YTQTUSE^^0^B8194860
"BLD",19039,"KRN",9.8,"NM",11,0)
YTQAPI15^^0^B29251831
"BLD",19039,"KRN",9.8,"NM",12,0)
YTQHL7^^0^B40318734
"BLD",19039,"KRN",9.8,"NM",13,0)
YS97POST^^0^B435281
"BLD",19039,"KRN",9.8,"NM","B","YS97POST",13)

"BLD",19039,"KRN",9.8,"NM","B","YTQAPI14",7)

"BLD",19039,"KRN",9.8,"NM","B","YTQAPI15",11)

"BLD",19039,"KRN",9.8,"NM","B","YTQHL7",12)

"BLD",19039,"KRN",9.8,"NM","B","YTQPRT",8)

"BLD",19039,"KRN",9.8,"NM","B","YTQTUSE",10)

"BLD",19039,"KRN",19,0)
19
"BLD",19039,"KRN",19,"NM",0)
^9.68A^56^41
"BLD",19039,"KRN",19,"NM",15,0)
YS BROKER1^^0
"BLD",19039,"KRN",19,"NM",16,0)
YSMANAGER^^0
"BLD",19039,"KRN",19,"NM",17,0)
YSCENCAD^^0
"BLD",19039,"KRN",19,"NM",18,0)
YSCENMGR^^0
"BLD",19039,"KRN",19,"NM",19,0)
YSCENROT^^0
"BLD",19039,"KRN",19,"NM",20,0)
YSCENSUBUP^^0
"BLD",19039,"KRN",19,"NM",21,0)
YSCENUNITUP^^0
"BLD",19039,"KRN",19,"NM",22,0)
YS SITE-FILE 615.5^^0
"BLD",19039,"KRN",19,"NM",23,0)
YS SITE-FILE 615.6^^0
"BLD",19039,"KRN",19,"NM",24,0)
YS SITE-FILE 615.7^^0
"BLD",19039,"KRN",19,"NM",25,0)
YS SITE-FILE 615.8^^0
"BLD",19039,"KRN",19,"NM",26,0)
YS SITE-FILE 615.9^^0
"BLD",19039,"KRN",19,"NM",27,0)
YS SITE-FILE 602 TEST LIM^^0
"BLD",19039,"KRN",19,"NM",29,0)
YSUTIL^^0
"BLD",19039,"KRN",19,"NM",30,0)
YSTSTAUD^^0
"BLD",19039,"KRN",19,"NM",31,0)
YSMCHK^^0
"BLD",19039,"KRN",19,"NM",32,0)
YSTESTBAT^^0
"BLD",19039,"KRN",19,"NM",33,0)
YSEXTESTS^^0
"BLD",19039,"KRN",19,"NM",34,0)
YSMKIL^^0
"BLD",19039,"KRN",19,"NM",35,0)
YSPIT^^0
"BLD",19039,"KRN",19,"NM",36,0)
YSKILLINC^^0
"BLD",19039,"KRN",19,"NM",37,0)
YSINST RESTART LIMIT^^0
"BLD",19039,"KRN",19,"NM",38,0)
YSMOVP^^0
"BLD",19039,"KRN",19,"NM",39,0)
YSSR MGT UTILITY^^0
"BLD",19039,"KRN",19,"NM",40,0)
YSSR W-ORDER^^0
"BLD",19039,"KRN",19,"NM",41,0)
YSSR EDIT^^0
"BLD",19039,"KRN",19,"NM",42,0)
YSSR DELETE^^0
"BLD",19039,"KRN",19,"NM",43,0)
YSDECTREES-R^^0
"BLD",19039,"KRN",19,"NM",44,0)
YTQ FORM PRINT^^0
"BLD",19039,"KRN",19,"NM",45,0)
YTQ DETAILED DEFINITION^^0
"BLD",19039,"KRN",19,"NM",46,0)
YTQ PNOTE FLAG^^0
"BLD",19039,"KRN",19,"NM",47,0)
YTQ EXEMPT TEST^^0
"BLD",19039,"KRN",19,"NM",48,0)
YTQ USAGE^^0
"BLD",19039,"KRN",19,"NM",49,0)
YTQ XML OUTPUT^^0
"BLD",19039,"KRN",19,"NM",50,0)
YTQ HL7 UTILITIES^^0
"BLD",19039,"KRN",19,"NM",51,0)
YTQ HL7 CHECK^^0
"BLD",19039,"KRN",19,"NM",52,0)
YTQ HL7 SEND1^^0
"BLD",19039,"KRN",19,"NM",53,0)
YSSR REVIEW^^0
"BLD",19039,"KRN",19,"NM",54,0)
YS SITE PARAMETERS^^0
"BLD",19039,"KRN",19,"NM",55,0)
YTQ MHA3 MENU^^0
"BLD",19039,"KRN",19,"NM",56,0)
YTQTUSE^^0
"BLD",19039,"KRN",19,"NM","B","YS BROKER1",15)

"BLD",19039,"KRN",19,"NM","B","YS SITE PARAMETERS",54)

"BLD",19039,"KRN",19,"NM","B","YS SITE-FILE 602 TEST LIM",27)

"BLD",19039,"KRN",19,"NM","B","YS SITE-FILE 615.5",22)

"BLD",19039,"KRN",19,"NM","B","YS SITE-FILE 615.6",23)

"BLD",19039,"KRN",19,"NM","B","YS SITE-FILE 615.7",24)

"BLD",19039,"KRN",19,"NM","B","YS SITE-FILE 615.8",25)

"BLD",19039,"KRN",19,"NM","B","YS SITE-FILE 615.9",26)

"BLD",19039,"KRN",19,"NM","B","YSCENCAD",17)

"BLD",19039,"KRN",19,"NM","B","YSCENMGR",18)

"BLD",19039,"KRN",19,"NM","B","YSCENROT",19)

"BLD",19039,"KRN",19,"NM","B","YSCENSUBUP",20)

"BLD",19039,"KRN",19,"NM","B","YSCENUNITUP",21)

"BLD",19039,"KRN",19,"NM","B","YSDECTREES-R",43)

"BLD",19039,"KRN",19,"NM","B","YSEXTESTS",33)

"BLD",19039,"KRN",19,"NM","B","YSINST RESTART LIMIT",37)

"BLD",19039,"KRN",19,"NM","B","YSKILLINC",36)

"BLD",19039,"KRN",19,"NM","B","YSMANAGER",16)

"BLD",19039,"KRN",19,"NM","B","YSMCHK",31)

"BLD",19039,"KRN",19,"NM","B","YSMKIL",34)

"BLD",19039,"KRN",19,"NM","B","YSMOVP",38)

"BLD",19039,"KRN",19,"NM","B","YSPIT",35)

"BLD",19039,"KRN",19,"NM","B","YSSR DELETE",42)

"BLD",19039,"KRN",19,"NM","B","YSSR EDIT",41)

"BLD",19039,"KRN",19,"NM","B","YSSR MGT UTILITY",39)

"BLD",19039,"KRN",19,"NM","B","YSSR REVIEW",53)

"BLD",19039,"KRN",19,"NM","B","YSSR W-ORDER",40)

"BLD",19039,"KRN",19,"NM","B","YSTESTBAT",32)

"BLD",19039,"KRN",19,"NM","B","YSTSTAUD",30)

"BLD",19039,"KRN",19,"NM","B","YSUTIL",29)

"BLD",19039,"KRN",19,"NM","B","YTQ DETAILED DEFINITION",45)

"BLD",19039,"KRN",19,"NM","B","YTQ EXEMPT TEST",47)

"BLD",19039,"KRN",19,"NM","B","YTQ FORM PRINT",44)

"BLD",19039,"KRN",19,"NM","B","YTQ HL7 CHECK",51)

"BLD",19039,"KRN",19,"NM","B","YTQ HL7 SEND1",52)

"BLD",19039,"KRN",19,"NM","B","YTQ HL7 UTILITIES",50)

"BLD",19039,"KRN",19,"NM","B","YTQ MHA3 MENU",55)

"BLD",19039,"KRN",19,"NM","B","YTQ PNOTE FLAG",46)

"BLD",19039,"KRN",19,"NM","B","YTQ USAGE",48)

"BLD",19039,"KRN",19,"NM","B","YTQ XML OUTPUT",49)

"BLD",19039,"KRN",19,"NM","B","YTQTUSE",56)

"BLD",19039,"KRN",19.1,0)
19.1
"BLD",19039,"KRN",19.1,"NM",0)
^9.68A^^
"BLD",19039,"KRN",101,0)
101
"BLD",19039,"KRN",409.61,0)
409.61
"BLD",19039,"KRN",771,0)
771
"BLD",19039,"KRN",771,"NM",0)
^9.68A^^
"BLD",19039,"KRN",870,0)
870
"BLD",19039,"KRN",870,"NM",0)
^9.68A^^0
"BLD",19039,"KRN",8989.51,0)
8989.51
"BLD",19039,"KRN",8989.51,"NM",0)
^9.68A^^
"BLD",19039,"KRN",8989.52,0)
8989.52
"BLD",19039,"KRN",8994,0)
8994
"BLD",19039,"KRN",8994,"NM",0)
^9.68A^1^1
"BLD",19039,"KRN",8994,"NM",1,0)
YTQ HL7^^0
"BLD",19039,"KRN",8994,"NM","B","YTQ HL7",1)

"BLD",19039,"KRN","B",.4,.4)

"BLD",19039,"KRN","B",.401,.401)

"BLD",19039,"KRN","B",.402,.402)

"BLD",19039,"KRN","B",.403,.403)

"BLD",19039,"KRN","B",.5,.5)

"BLD",19039,"KRN","B",.84,.84)

"BLD",19039,"KRN","B",3.6,3.6)

"BLD",19039,"KRN","B",3.8,3.8)

"BLD",19039,"KRN","B",9.2,9.2)

"BLD",19039,"KRN","B",9.8,9.8)

"BLD",19039,"KRN","B",19,19)

"BLD",19039,"KRN","B",19.1,19.1)

"BLD",19039,"KRN","B",101,101)

"BLD",19039,"KRN","B",409.61,409.61)

"BLD",19039,"KRN","B",771,771)

"BLD",19039,"KRN","B",870,870)

"BLD",19039,"KRN","B",8989.51,8989.51)

"BLD",19039,"KRN","B",8989.52,8989.52)

"BLD",19039,"KRN","B",8994,8994)

"BLD",19039,"QUES",0)
^9.62^^
"BLD",19039,"REQB",0)
^9.611^1^1
"BLD",19039,"REQB",1,0)
YS*5.01*85^1
"BLD",19039,"REQB","B","YS*5.01*85",1)

"INIT")
HL7^YS97POST
"KRN",3.8,313,-1)
0^1
"KRN",3.8,313,0)
YS MHA-MHNDB^PR^^^^^
"KRN",3.8,313,2,0)
^3.801^2^2^3100119^^^^
"KRN",3.8,313,2,1,0)
This group receives error messages from the HL7 system when problems 
"KRN",3.8,313,2,2,0)
arise sending messages to the Mental Health National database.
"KRN",3.8,313,3)

"KRN",19,3964,-1)
0^29
"KRN",19,3964,0)
YSUTIL^MHA2 Psych test utilities^^M^^^^^^^^MENTAL HEALTH^^1
"KRN",19,3964,1,0)
^19.06^2^2^3081220^^^^
"KRN",19,3964,1,1,0)
This option accesses the psych testing utilities menu. This is a legacy 
"KRN",19,3964,1,2,0)
option and does not affect MHA3.
"KRN",19,3964,10,0)
^19.01IP^9^9
"KRN",19,3964,10,2,0)
3998^2
"KRN",19,3964,10,2,"^")
YSTSTAUD
"KRN",19,3964,10,3,0)
3969^3
"KRN",19,3964,10,3,"^")
YSMCHK
"KRN",19,3964,10,4,0)
3999^4
"KRN",19,3964,10,4,"^")
YSTESTBAT
"KRN",19,3964,10,5,0)
3997^5
"KRN",19,3964,10,5,"^")
YSEXTESTS
"KRN",19,3964,10,6,0)
3966^6
"KRN",19,3964,10,6,"^")
YSMKIL
"KRN",19,3964,10,7,0)
4002^7
"KRN",19,3964,10,7,"^")
YSPIT
"KRN",19,3964,10,8,0)
4004^8^
"KRN",19,3964,10,8,"^")
YSKILLINC
"KRN",19,3964,10,9,0)
6907^9
"KRN",19,3964,10,9,"^")
YSINST RESTART LIMIT
"KRN",19,3964,20)
N H2,L2 S H2="*** LEGACY Mental Health ***",L2="MHA2 Utilities" W !,@IOF,#,?(IOM-$L(H2)/2),H2,!?(IOM-$L(L2)/2),L2
"KRN",19,3964,25)

"KRN",19,3964,99)
61878,46418
"KRN",19,3964,"U")
MHA2 PSYCH TEST UTILITIES
"KRN",19,3965,-1)
0^38
"KRN",19,3965,0)
YSMOVP^Move crisis notes and messages^^R^^^^^^^^
"KRN",19,3965,1,0)
^^3^3^2890907^^^^
"KRN",19,3965,1,1,0)
This option is used by the authorized staff to move text
"KRN",19,3965,1,2,0)
created under the "Crisis Notes" and "Patient Messages" options to
"KRN",19,3965,1,3,0)
"Progress Notes".
"KRN",19,3965,25)
YSMV
"KRN",19,3965,"U")
MOVE CRISIS NOTES AND MESSAGES
"KRN",19,3966,-1)
0^34
"KRN",19,3966,0)
YSMKIL^Delete Patient Data^^R^^^^^^^^
"KRN",19,3966,1,0)
^^3^3^2870626^^^^
"KRN",19,3966,1,1,0)
This option allows staff to delete patient test data from all or
"KRN",19,3966,1,2,0)
selected tests.  The tests may be completed or incompleted.
"KRN",19,3966,1,3,0)
This option is a restricted management function.
"KRN",19,3966,25)
YTKIL
"KRN",19,3966,"U")
DELETE PATIENT DATA
"KRN",19,3969,-1)
0^31
"KRN",19,3969,0)
YSMCHK^Check Psych Data Base^^R^^^^^^^^
"KRN",19,3969,1,0)
^^1^1^2920326^^^^
"KRN",19,3969,1,1,0)
This option allows staff to list incomplete tests/interviews.
"KRN",19,3969,25)
YTCHECK
"KRN",19,3969,"U")
CHECK PSYCH DATA BASE
"KRN",19,3997,-1)
0^33
"KRN",19,3997,0)
YSEXTESTS^Exempt psychological tests^^R^^^^^^^^
"KRN",19,3997,1,0)
^^6^6^2881208^^^^
"KRN",19,3997,1,1,0)
Psychological tests are divided into two categories.  One class of
"KRN",19,3997,1,2,0)
tests requires the user to be trained according to APA guidelines for
"KRN",19,3997,1,3,0)
the proper administration and interpretation of tests, viz., MMPI,   
"KRN",19,3997,1,4,0)
etc.  Tests such as the Beck, Zung, BPRS which do not require training
"KRN",19,3997,1,5,0)
are available to all staff.  This option allows the chief of psychology
"KRN",19,3997,1,6,0)
to assign the available tests to their proper category.
"KRN",19,3997,25)
YTEX
"KRN",19,3997,"U")
EXEMPT PSYCHOLOGICAL TESTS
"KRN",19,3998,-1)
0^30
"KRN",19,3998,0)
YSTSTAUD^Audit test/interview data^^R^^^^^^^^
"KRN",19,3998,1,0)
^^2^2^2890427^^^^
"KRN",19,3998,1,1,0)
Allows audit of tests and interviews by patient name, test name,
"KRN",19,3998,1,2,0)
date, initiator, and requester.
"KRN",19,3998,25)
YTAUDIT
"KRN",19,3998,99)
55105,58217
"KRN",19,3998,"U")
AUDIT TEST/INTERVIEW DATA
"KRN",19,3999,-1)
0^32
"KRN",19,3999,0)
YSTESTBAT^Test battery utility^^R^^^^^^^^
"KRN",19,3999,1,0)
^^4^4^2941021^^^^
"KRN",19,3999,1,1,0)
This option allows appropriate staff to create, delete, and
"KRN",19,3999,1,2,0)
print test batteries for the administration of a sequence of
"KRN",19,3999,1,3,0)
psychological tests and interviews.  This is a restricted
"KRN",19,3999,1,4,0)
management function.
"KRN",19,3999,25)
YTTB
"KRN",19,3999,"U")
TEST BATTERY UTILITY
"KRN",19,4002,-1)
0^35
"KRN",19,4002,0)
YSPIT^Print test/interview items^^R^^^^^^^^^^1
"KRN",19,4002,1,0)
^^1^1^2900116^^^^
"KRN",19,4002,1,1,0)
Allows printing of psychology test/interview items.
"KRN",19,4002,20)
Q
"KRN",19,4002,25)
YTPIT
"KRN",19,4002,"U")
PRINT TEST/INTERVIEW ITEMS
"KRN",19,4004,-1)
0^36
"KRN",19,4004,0)
YSKILLINC^Delete incomplete tests/interviews^^R^^^^^^^^
"KRN",19,4004,1,0)
^^3^3^2870626^
"KRN",19,4004,1,1,0)
This options allows the deletion of all incomplete tests/interviews
"KRN",19,4004,1,2,0)
which have been incomplete for longer than a specified interval.
"KRN",19,4004,1,3,0)
This option is a restricted management function.
"KRN",19,4004,25)
YTKILINC
"KRN",19,4004,"U")
DELETE INCOMPLETE TESTS/INTERV
"KRN",19,4011,-1)
0^53
"KRN",19,4011,0)
YSSR REVIEW^Review of Seclusion/Restraint Action^^R^^^^^^^^^^^1
"KRN",19,4011,1,0)
^^1^1^2881214^^^
"KRN",19,4011,1,1,0)
Record of review.
"KRN",19,4011,15)
D KILLALL^YSSR2
"KRN",19,4011,25)
ENREV^YSSR1
"KRN",19,4011,"U")
REVIEW OF SECLUSION/RESTRAINT 
"KRN",19,4017,-1)
0^40
"KRN",19,4017,0)
YSSR W-ORDER^Written Order Edit^^R^^^^^^^^^^^1
"KRN",19,4017,1,0)
^^5^5^2890315^^
"KRN",19,4017,1,1,0)
Permits the editing of an order type after initial entry of order.
"KRN",19,4017,1,2,0)
Developed to accommodate physician's written orders after the fact.
"KRN",19,4017,1,3,0)
A written order must be received within 24 hours after initiation
"KRN",19,4017,1,4,0)
of a patient into seclusion/restraint.  Also, an order must be
"KRN",19,4017,1,5,0)
written every 24 hours.
"KRN",19,4017,15)
D KILLALL^YSSR2
"KRN",19,4017,25)
ENWO^YSSR1
"KRN",19,4017,"U")
WRITTEN ORDER EDIT
"KRN",19,4018,-1)
0^39
"KRN",19,4018,0)
YSSR MGT UTILITY^Seclusion/Restraint Management Utilities^^M^^^^^^^^^^^
"KRN",19,4018,1,0)
^^2^2^2880901^^^^
"KRN",19,4018,1,1,0)
Contains functions required for the management of the Seclusion/Restraint
"KRN",19,4018,1,2,0)
 Entry.
"KRN",19,4018,10,0)
^19.01PI^5^5
"KRN",19,4018,10,1,0)
4019^3^3
"KRN",19,4018,10,1,"^")
YSSR EDIT
"KRN",19,4018,10,2,0)
4020^4^4
"KRN",19,4018,10,2,"^")
YSSR DELETE
"KRN",19,4018,10,4,0)
4011^1^1
"KRN",19,4018,10,4,"^")
YSSR REVIEW
"KRN",19,4018,10,5,0)
4017^2^2
"KRN",19,4018,10,5,"^")
YSSR W-ORDER
"KRN",19,4018,15)

"KRN",19,4018,99)
61878,46418
"KRN",19,4018,"U")
SECLUSION/RESTRAINT MANAGEMENT
"KRN",19,4019,-1)
0^41
"KRN",19,4019,0)
YSSR EDIT^Edit Seclusion/Restraint Entry^^R^^^^^^^^^^^1
"KRN",19,4019,1,0)
^^1^1^2871217^
"KRN",19,4019,1,1,0)
A single entry may be edited through this option.
"KRN",19,4019,15)
D KILLALL^YSSR2
"KRN",19,4019,25)
ENEDIT^YSSR2
"KRN",19,4019,"U")
EDIT SECLUSION/RESTRAINT ENTRY
"KRN",19,4020,-1)
0^42
"KRN",19,4020,0)
YSSR DELETE^Delete Seclusion/Restraint Entry^^R^^^^^^^^^^^1
"KRN",19,4020,1,0)
^^1^1^2930205^^^^
"KRN",19,4020,1,1,0)
Permits deletion of a single Seclusion/Restraint entry.
"KRN",19,4020,15)
D KILLALL^YSSR2
"KRN",19,4020,25)
ENTRYD^YSSR2
"KRN",19,4020,99)
55290,68739
"KRN",19,4020,"U")
DELETE SECLUSION/RESTRAINT ENT
"KRN",19,4032,-1)
0^18
"KRN",19,4032,0)
YSCENMGR^Inpatient Features management functions^^M^^^^^^^^
"KRN",19,4032,1,0)
1^^1^1^2881206^
"KRN",19,4032,1,1,0)
Inpatient manager functions including unit and sub-unit definitions.
"KRN",19,4032,10,0)
^19.01IP^5^5
"KRN",19,4032,10,1,0)
4033^4
"KRN",19,4032,10,1,"^")
YSCENUNITUP
"KRN",19,4032,10,2,0)
4034^3
"KRN",19,4032,10,2,"^")
YSCENSUBUP
"KRN",19,4032,10,4,0)
4043^2
"KRN",19,4032,10,4,"^")
YSCENROT
"KRN",19,4032,10,5,0)
4062^1
"KRN",19,4032,10,5,"^")
YSCENCAD
"KRN",19,4032,99)
61878,46418
"KRN",19,4032,"U")
INPATIENT FEATURES MANAGEMENT 
"KRN",19,4033,-1)
0^21
"KRN",19,4033,0)
YSCENUNITUP^Ward Definition^^R^^^^^^^^^^^1
"KRN",19,4033,1,0)
^^1^1^2880819^^^^
"KRN",19,4033,1,1,0)
Set up and define MH wards.
"KRN",19,4033,15)
D KILLALL^YSCEN
"KRN",19,4033,25)
1^YSCEN1
"KRN",19,4033,99)
54957,31271
"KRN",19,4033,"U")
WARD DEFINITION
"KRN",19,4034,-1)
0^20
"KRN",19,4034,0)
YSCENSUBUP^Team Definition^^R^^^^^^^^^^^1
"KRN",19,4034,1,0)
^^1^1^2880819^^^^
"KRN",19,4034,1,1,0)
Set up and define sub-units.
"KRN",19,4034,15)
D KILLALL^YSCEN
"KRN",19,4034,25)
2^YSCEN1
"KRN",19,4034,"U")
TEAM DEFINITION
"KRN",19,4043,-1)
0^19
"KRN",19,4043,0)
YSCENROT^Rotation of Teams^^R^^^^^^^^^^^1
"KRN",19,4043,1,0)
^^2^2^2880819^^
"KRN",19,4043,1,1,0)
This option allows setting and changing of order of teams for
"KRN",19,4043,1,2,0)
next admits.
"KRN",19,4043,15)
D KILLALL^YSCEN
"KRN",19,4043,25)
ROT^YSCEN13
"KRN",19,4043,"U")
ROTATION OF TEAMS
"KRN",19,4062,-1)
0^17
"KRN",19,4062,0)
YSCENCAD^Cancel a MH Census Discharge^^R^^^^^^^^^^^1
"KRN",19,4062,1,0)
^^4^4^2890912^^^^
"KRN",19,4062,1,1,0)
Allows cancellation of an MH census discharge when MAS has cancelled
"KRN",19,4062,1,2,0)
a discharge. Patient must return to the same MH unit within 4 days
"KRN",19,4062,1,3,0)
to allow such a cancellation. All present data is removed and replaced
"KRN",19,4062,1,4,0)
with the previous data.
"KRN",19,4062,15)
D KILLALL^YSCEN
"KRN",19,4062,25)
YSCEN13
"KRN",19,4062,"U")
CANCEL A MH CENSUS DISCHARGE
"KRN",19,4065,-1)
0^54
"KRN",19,4065,0)
YS SITE PARAMETERS^Mental Health System site parameters^^M^^^^^^^^
"KRN",19,4065,1,0)
^19.06^3^3^3080827^^^^
"KRN",19,4065,1,1,0)
This option is for the use of the Mental Health Application
"KRN",19,4065,1,2,0)
Coordinator.  Through it, site-specific files may be maintained
"KRN",19,4065,1,3,0)
by the coordinator.
"KRN",19,4065,10,0)
^19.01PI^9^6
"KRN",19,4065,10,1,0)
4066^^1
"KRN",19,4065,10,1,"^")
YS SITE-FILE 615.5
"KRN",19,4065,10,2,0)
4067^^2
"KRN",19,4065,10,2,"^")
YS SITE-FILE 615.6
"KRN",19,4065,10,3,0)
4068^^3
"KRN",19,4065,10,3,"^")
YS SITE-FILE 615.7
"KRN",19,4065,10,4,0)
4069^^4
"KRN",19,4065,10,4,"^")
YS SITE-FILE 615.8
"KRN",19,4065,10,5,0)
4070^^5
"KRN",19,4065,10,5,"^")
YS SITE-FILE 615.9
"KRN",19,4065,10,9,0)
6906^^9
"KRN",19,4065,10,9,"^")
YS SITE-FILE 602 TEST LIM
"KRN",19,4065,99)
61878,46418
"KRN",19,4065,99.1)
61842,46203
"KRN",19,4065,"U")
MENTAL HEALTH SYSTEM SITE PARA
"KRN",19,4066,-1)
0^22
"KRN",19,4066,0)
YS SITE-FILE 615.5^REASONS......Edit S/R Reasons File^^R^^^^^^^^^^1
"KRN",19,4066,1,0)
^^1^1^2881206^^^^
"KRN",19,4066,1,1,0)
Option permits entry and edit of site-specific file.
"KRN",19,4066,20)
D PWARN^YSSRU1
"KRN",19,4066,25)
ENREA^YSSITE
"KRN",19,4066,30)

"KRN",19,4066,31)

"KRN",19,4066,36)

"KRN",19,4066,50)

"KRN",19,4066,51)

"KRN",19,4066,"U")
REASONS......EDIT S/R REASONS 
"KRN",19,4067,-1)
0^23
"KRN",19,4067,0)
YS SITE-FILE 615.6^CATEGORY.....Edit S/R Category File^^R^^^^^^^^^^1
"KRN",19,4067,1,0)
^^2^2^2881206^^
"KRN",19,4067,1,1,0)
Permits entry and editing of fields in the Seclusion/Restraint
"KRN",19,4067,1,2,0)
Category File (^YSR(615.6)).
"KRN",19,4067,20)
D PWARN^YSSRU1
"KRN",19,4067,25)
ENCAT^YSSITE
"KRN",19,4067,"U")
CATEGORY.....EDIT S/R CATEGORY
"KRN",19,4068,-1)
0^24
"KRN",19,4068,0)
YS SITE-FILE 615.7^RELEASE......Edit S/R Release Criteria File^^R^^^^^^^^^^1
"KRN",19,4068,1,0)
^^2^2^2881206^^^
"KRN",19,4068,1,1,0)
Permits entry and edit of fields within the Seclusion/Restraint Release
"KRN",19,4068,1,2,0)
Criteria File (^YSR(615.7)).
"KRN",19,4068,20)
D PWARN^YSSRU1
"KRN",19,4068,25)
ENRELC^YSSITE
"KRN",19,4068,"U")
RELEASE......EDIT S/R RELEASE 
"KRN",19,4069,-1)
0^25
"KRN",19,4069,0)
YS SITE-FILE 615.8^ALTERNATIVES.Edit S/R Alternatives File^^R^^^^^^^^^^1
"KRN",19,4069,1,0)
^^2^2^2881206^^^
"KRN",19,4069,1,1,0)
Permits entry and edit of fields within the Seclusion/Restraint Alternatives
"KRN",19,4069,1,2,0)
File (^YSR(615.8)).
"KRN",19,4069,20)
D PWARN^YSSRU1
"KRN",19,4069,25)
ENALT^YSSITE
"KRN",19,4069,"U")
ALTERNATIVES.EDIT S/R ALTERNAT
"KRN",19,4070,-1)
0^26
"KRN",19,4070,0)
YS SITE-FILE 615.9^CHECKLIST....Edit S/R Checklist File^^R^^^^^^^^^^1
"KRN",19,4070,1,0)
^^2^2^2881206^^^
"KRN",19,4070,1,1,0)
Permits entry and edit of data within the Seclusion/Restraint
"KRN",19,4070,1,2,0)
Checklist File (^YSR(615.9)).
"KRN",19,4070,20)
D PWARN^YSSRU1
"KRN",19,4070,25)
ENCKL^YSSITE
"KRN",19,4070,"U")
CHECKLIST....EDIT S/R CHECKLIS
"KRN",19,4073,-1)
0^16
"KRN",19,4073,0)
YSMANAGER^MHS Manager^^M^^^^^^^^^^1^1
"KRN",19,4073,1,0)
^19.06^3^3^3081220^^^^
"KRN",19,4073,1,1,0)
Menu to facilitate addition of manager functions to the
"KRN",19,4073,1,2,0)
secondary menues of authorized Mental Health System management
"KRN",19,4073,1,3,0)
personnel.
"KRN",19,4073,10,0)
^19.01IP^9^9
"KRN",19,4073,10,1,0)
4032^1
"KRN",19,4073,10,1,"^")
YSCENMGR
"KRN",19,4073,10,2,0)
4065^2
"KRN",19,4073,10,2,"^")
YS SITE PARAMETERS
"KRN",19,4073,10,3,0)
3964^3
"KRN",19,4073,10,3,"^")
YSUTIL
"KRN",19,4073,10,6,0)
3965^4
"KRN",19,4073,10,6,"^")
YSMOVP
"KRN",19,4073,10,7,0)
4018^5
"KRN",19,4073,10,7,"^")
YSSR MGT UTILITY
"KRN",19,4073,10,8,0)
4075^6
"KRN",19,4073,10,8,"^")
YSDECTREES-R
"KRN",19,4073,10,9,0)
13024^7
"KRN",19,4073,10,9,"^")
YTQ MHA3 MENU
"KRN",19,4073,15)
K YSM,POP
"KRN",19,4073,20)
D MHS^YSMHMENU
"KRN",19,4073,99)
61878,46418
"KRN",19,4073,99.1)
61842,46203
"KRN",19,4073,"U")
MHS MANAGER
"KRN",19,4075,-1)
0^43
"KRN",19,4075,0)
YSDECTREES-R^Decision Tree Shell^^R^^^^^^^^
"KRN",19,4075,1,0)
^^15^15^2930811^^^^
"KRN",19,4075,1,1,0)
This option references a tool used to aid in decision processes.
"KRN",19,4075,1,2,0)
Information entered can range from a decision tree through a
"KRN",19,4075,1,3,0)
standard triage.
"KRN",19,4075,1,4,0)
   
"KRN",19,4075,1,5,0)
In order to be of use, the data base must first be established.
"KRN",19,4075,1,6,0)
This tool requires detailed knowledge of input data.  The
"KRN",19,4075,1,7,0)
Dallas ISC can be of assistance (FTS# (700) 738-1940) with data entry
"KRN",19,4075,1,8,0)
procedures.
"KRN",19,4075,1,9,0)
  
"KRN",19,4075,1,10,0)
**************************************************************************
"KRN",19,4075,1,11,0)
   
"KRN",19,4075,1,12,0)
The individual site is responsible for ensuring permission for
"KRN",19,4075,1,13,0)
copyrighted material is obtained prior to entering the material.
"KRN",19,4075,1,14,0)
     
"KRN",19,4075,1,15,0)
**************************************************************************
"KRN",19,4075,20)

"KRN",19,4075,25)
YSESM
"KRN",19,4075,99)
55202,55148
"KRN",19,4075,"U")
DECISION TREE SHELL
"KRN",19,6906,-1)
0^27
"KRN",19,6906,0)
YS SITE-FILE 602 TEST LIM^INSTRUMENT...Edit Instrument Restart Day Limit^^R^^^^^^^^MENTAL HEALTH
"KRN",19,6906,1,0)
3^^3^3^2921119^
"KRN",19,6906,1,1,0)
This option allows the setting of the SITE default for the maximum 
"KRN",19,6906,1,2,0)
number of day that may elapse between an interupted instrument the
"KRN",19,6906,1,3,0)
restart of that instrument.
"KRN",19,6906,25)
INST^YSSITE
"KRN",19,6906,99)
55285,57875
"KRN",19,6906,"U")
INSTRUMENT...EDIT INSTRUMENT R
"KRN",19,6907,-1)
0^37
"KRN",19,6907,0)
YSINST RESTART LIMIT^Edit Instrument Restart Limit^^E^^^^^^^^MENTAL HEALTH
"KRN",19,6907,1,0)
^^2^2^2921119^^^^
"KRN",19,6907,1,1,0)
This option will allow you to change the default days that may elapse
"KRN",19,6907,1,2,0)
between interuption and restarting of a specific Mental Health Instrument.
"KRN",19,6907,30)
YTT(601,
"KRN",19,6907,31)
AEMQ
"KRN",19,6907,50)
YTT(601,
"KRN",19,6907,51)
38;
"KRN",19,6907,53)
BACKOUTOK
"KRN",19,6907,"U")
EDIT INSTRUMENT RESTART LIMIT
"KRN",19,11364,-1)
0^15
"KRN",19,11364,0)
YS BROKER1^YS BROKER1 version 1.0.2.20~1.0.0.1~1.0.0.1^^B^^^^^^^n^
"KRN",19,11364,1,0)
^19.06^1^1^3100316^^^^
"KRN",19,11364,1,1,0)
Allows user to call VISTA's remote procedures.
"KRN",19,11364,99.1)
60709,60780
"KRN",19,11364,"RPC",0)
^19.05P^139^139
"KRN",19,11364,"RPC",1,0)
YTAPI LISTALL
"KRN",19,11364,"RPC",2,0)
YTAPI LISTONE
"KRN",19,11364,"RPC",3,0)
YTAPI SCOREIT
"KRN",19,11364,"RPC",4,0)
YTAPI SAVEIT
"KRN",19,11364,"RPC",5,0)
YTAPI SHOWALL
"KRN",19,11364,"RPC",6,0)
YTAPI SHOWIT
"KRN",19,11364,"RPC",7,0)
YS GAF API
"KRN",19,11364,"RPC",16,0)
DDR GETS ENTRY DATA
"KRN",19,11364,"RPC",17,0)
DDR LISTER
"KRN",19,11364,"RPC",18,0)
DDR VALIDATOR
"KRN",19,11364,"RPC",19,0)
DDR FILER
"KRN",19,11364,"RPC",20,0)
YTAPI NEW ASI
"KRN",19,11364,"RPC",21,0)
ORWPT LAST5
"KRN",19,11364,"RPC",22,0)
ORQPT CLINIC PATIENTS
"KRN",19,11364,"RPC",23,0)
ORQPT PROVIDER PATIENTS
"KRN",19,11364,"RPC",24,0)
ORQPT SPECIALTIES
"KRN",19,11364,"RPC",25,0)
ORQPT SPECIALTY PATIENTS
"KRN",19,11364,"RPC",26,0)
ORQPT WARDS
"KRN",19,11364,"RPC",28,0)
ORWPT ID INFO
"KRN",19,11364,"RPC",29,0)
ORWPT LIST ALL
"KRN",19,11364,"RPC",33,0)
ORWU CLINLOC
"KRN",19,11364,"RPC",34,0)
ORWU DT
"KRN",19,11364,"RPC",35,0)
ORWU NEWPERS
"KRN",19,11364,"RPC",36,0)
ORWORB FASTUSER
"KRN",19,11364,"RPC",37,0)
ORQPT DEFAULT LIST SOURCE
"KRN",19,11364,"RPC",38,0)
ORWU USERINFO
"KRN",19,11364,"RPC",40,0)
ORQPT DEFAULT PATIENT LIST
"KRN",19,11364,"RPC",46,0)
YTRP INSTRUMENT REPORT
"KRN",19,11364,"RPC",47,0)
YSRP ASI ITEM
"KRN",19,11364,"RPC",48,0)
YSRP ASI NARRATIVE
"KRN",19,11364,"RPC",49,0)
YTAPI ASI PNOTE
"KRN",19,11364,"RPC",50,0)
YTAPI CLERK RESPONSES
"KRN",19,11364,"RPC",51,0)
YTAPI ASI SAVE DATA
"KRN",19,11364,"RPC",52,0)
YTAPI ASI SIGNER
"KRN",19,11364,"RPC",53,0)
YTAPI SAVE TEST COMMENT
"KRN",19,11364,"RPC",54,0)
YTAPI ASI FACTORS
"KRN",19,11364,"RPC",55,0)
DDR FIND1
"KRN",19,11364,"RPC",56,0)
YTAPI ASI LISTER
"KRN",19,11364,"RPC",57,0)
YTAPI GET ASI RESPONSES
"KRN",19,11364,"RPC",58,0)
YTAPI GET INCOMPLETE
"KRN",19,11364,"RPC",59,0)
YTAPI LIST INCOMPLETES
"KRN",19,11364,"RPC",60,0)
YTAPI NEW GAF
"KRN",19,11364,"RPC",61,0)
YTAPI QUEST
"KRN",19,11364,"RPC",62,0)
YTAPI SAVE INCOMPLETES
"KRN",19,11364,"RPC",63,0)
YTAPI TEST BULLETIN
"KRN",19,11364,"RPC",64,0)
YTAPI TEST BATTERY
"KRN",19,11364,"RPC",66,0)
ORWPT PTINQ
"KRN",19,11364,"RPC",67,0)
DDR DELETE ENTRY
"KRN",19,11364,"RPC",68,0)
DGWPT SAVDFLT
"KRN",19,11364,"RPC",69,0)
DGWPT DIEDON
"KRN",19,11364,"RPC",70,0)
DGWPT BYWARD
"KRN",19,11364,"RPC",71,0)
DGWPT CLINRNG
"KRN",19,11364,"RPC",72,0)
DGWPT DFLTSRC
"KRN",19,11364,"RPC",73,0)
DGWPT SELCHK
"KRN",19,11364,"RPC",74,0)
DGWPT TOP
"KRN",19,11364,"RPC",75,0)
XUS KEY CHECK
"KRN",19,11364,"RPC",76,0)
DGWPT SELECT
"KRN",19,11364,"RPC",77,0)
DGWPT1 PRCARE
"KRN",19,11364,"RPC",78,0)
YTQ ADMINS BOTH
"KRN",19,11364,"RPC",79,0)
YTQ ALL ANSWERS
"KRN",19,11364,"RPC",80,0)
YTQ ALL CHOICES
"KRN",19,11364,"RPC",81,0)
YTQ ASI LISTER
"KRN",19,11364,"RPC",82,0)
YTQ ASI SIGNOK
"KRN",19,11364,"RPC",83,0)
YTQ BATTC
"KRN",19,11364,"RPC",84,0)
YTQ BATTDEL
"KRN",19,11364,"RPC",85,0)
YTQ CAPIE
"KRN",19,11364,"RPC",86,0)
YTQ CHOICE ADD
"KRN",19,11364,"RPC",87,0)
YTQ CHOICE ORPHAN DELETE
"KRN",19,11364,"RPC",88,0)
YTQ CHOICEIDENT
"KRN",19,11364,"RPC",89,0)
YTQ CHOICES
"KRN",19,11364,"RPC",90,0)
YTQ CHOICETYPE ADD
"KRN",19,11364,"RPC",91,0)
YTQ CHOICETYPE DELETE
"KRN",19,11364,"RPC",92,0)
YTQ CHOICETYPE DESCRIBE
"KRN",19,11364,"RPC",93,0)
YTQ CHOICETYPE ORPHAN DELETE
"KRN",19,11364,"RPC",94,0)
YTQ COPY TEST
"KRN",19,11364,"RPC",95,0)
YTQ DELETE SCALES AND GROUP
"KRN",19,11364,"RPC",96,0)
YTQ DELETE TEST
"KRN",19,11364,"RPC",97,0)
YTQ DISPLAY
"KRN",19,11364,"RPC",98,0)
YTQ EXPORT
"KRN",19,11364,"RPC",99,0)
YTQ EXPORTED MAIL
"KRN",19,11364,"RPC",100,0)
YTQ FIRST WP
"KRN",19,11364,"RPC",101,0)
YTQ GAF HX
"KRN",19,11364,"RPC",102,0)
YTQ GENERIC LISTER
"KRN",19,11364,"RPC",103,0)
YTQ GET ADMINISTRATIONS
"KRN",19,11364,"RPC",104,0)
YTQ GET REPORT
"KRN",19,11364,"RPC",105,0)
YTQ GET SCALES
"KRN",19,11364,"RPC",106,0)
YTQ GETANS
"KRN",19,11364,"RPC",107,0)
YTQ IMPORT
"KRN",19,11364,"RPC",108,0)
YTQ KEYS
"KRN",19,11364,"RPC",109,0)
YTQ LEGACY REPORT
"KRN",19,11364,"RPC",110,0)
YTQ PATIENT INFO
"KRN",19,11364,"RPC",111,0)
YTQ PATIENT LOOKUP
"KRN",19,11364,"RPC",112,0)
YTQ PN CREATE
"KRN",19,11364,"RPC",113,0)
YTQ PURGE
"KRN",19,11364,"RPC",114,0)
YTQ QUESTALL
"KRN",19,11364,"RPC",115,0)
YTQ RULEDEL
"KRN",19,11364,"RPC",116,0)
YTQ RULES
"KRN",19,11364,"RPC",117,0)
YTQ SAVE
"KRN",19,11364,"RPC",118,0)
YTQ SCALEGROUP
"KRN",19,11364,"RPC",119,0)
YTQ SCORE ADMIN
"KRN",19,11364,"RPC",120,0)
YTQ SCORE SAVE
"KRN",19,11364,"RPC",121,0)
YTQ SECTION
"KRN",19,11364,"RPC",122,0)
YTQ SET ANSWER
"KRN",19,11364,"RPC",123,0)
YTQ SET NATIONAL
"KRN",19,11364,"RPC",124,0)
YTQ SKIP
"KRN",19,11364,"RPC",125,0)
YTQ TEST ADD
"KRN",19,11364,"RPC",126,0)
YTQ TEST ORDER
"KRN",19,11364,"RPC",127,0)
YTQ TSLIST
"KRN",19,11364,"RPC",128,0)
YTQ TSLIST1
"KRN",19,11364,"RPC",129,0)
YTQ USERQ
"KRN",19,11364,"RPC",130,0)
YTQ VERSRV
"KRN",19,11364,"RPC",131,0)
YTQ WP ALL
"KRN",19,11364,"RPC",132,0)
YTQ WP FILER
"KRN",19,11364,"RPC",133,0)
YTQ HL7
"KRN",19,11364,"RPC",134,0)
YTQ LEGCR
"KRN",19,11364,"RPC",135,0)
YTAPI PREVIEW
"KRN",19,11364,"RPC",136,0)
YTQ ALLKEYS
"KRN",19,11364,"RPC",137,0)
YTQ GET SCRATCH
"KRN",19,11364,"RPC",138,0)
YTQ SET SCRATCH
"KRN",19,11364,"RPC",139,0)
YTQ KILL SCRATCH
"KRN",19,11364,"U")
YS BROKER1 VERSION 1.0.2.20~1.
"KRN",19,13023,-1)
0^46
"KRN",19,13023,0)
YTQ PNOTE FLAG^Stop/Re-Start Progress Notes for an Instrument^Functionality not available^R^^^^^^^^
"KRN",19,13023,1,0)
^19.06^2^2^3081015^^
"KRN",19,13023,1,1,0)
Allows site to turn off MHA3 generated TIU notes for a specified 
"KRN",19,13023,1,2,0)
instrument.
"KRN",19,13023,25)
NOPNOTE^YTQAPI14
"KRN",19,13023,"U")
STOP/RE-START PROGRESS NOTES F
"KRN",19,13024,-1)
0^55
"KRN",19,13024,0)
YTQ MHA3 MENU^MHA3 Utilities^^M^^^^^^^^^^1
"KRN",19,13024,1,0)
^19.06^1^1^3100224^^^^
"KRN",19,13024,1,1,0)
MHA3 settings and utilities.
"KRN",19,13024,10,0)
^19.01IP^8^8
"KRN",19,13024,10,1,0)
13023^4
"KRN",19,13024,10,1,"^")
YTQ PNOTE FLAG
"KRN",19,13024,10,2,0)
3966^3
"KRN",19,13024,10,2,"^")
YSMKIL
"KRN",19,13024,10,3,0)
13026^2
"KRN",19,13024,10,3,"^")
YTQ DETAILED DEFINITION
"KRN",19,13024,10,4,0)
13025^1
"KRN",19,13024,10,4,"^")
YTQ FORM PRINT
"KRN",19,13024,10,5,0)
13027^8
"KRN",19,13024,10,5,"^")
YTQ HL7 UTILITIES
"KRN",19,13024,10,6,0)
13031^5
"KRN",19,13024,10,6,"^")
YTQ EXEMPT TEST
"KRN",19,13024,10,7,0)
13032^7
"KRN",19,13024,10,7,"^")
YTQ XML OUTPUT
"KRN",19,13024,10,8,0)
13033^6
"KRN",19,13024,10,8,"^")
YTQ USAGE
"KRN",19,13024,20)
N H2,L2 S H2="*** Mental Health ***",L2="MHA3 Utilities" W !,@IOF,#,?(IOM-$L(H2)/2),H2,!?(IOM-$L(L2)/2),L2
"KRN",19,13024,99)
61878,46418
"KRN",19,13024,"U")
MHA3 UTILITIES
"KRN",19,13025,-1)
0^44
"KRN",19,13025,0)
YTQ FORM PRINT^Print Test Form^^R^^^^^^^^
"KRN",19,13025,1,0)
^19.06^3^3^3080506^^
"KRN",19,13025,1,1,0)
Displays a representation of the test as it might look on a paper form. 
"KRN",19,13025,1,2,0)
This is NOT the way the published test form looks but it will print 
"KRN",19,13025,1,3,0)
Introductions, Questions and Choices.
"KRN",19,13025,25)
FORM^YTQPRT
"KRN",19,13025,"U")
PRINT TEST FORM
"KRN",19,13026,-1)
0^45
"KRN",19,13026,0)
YTQ DETAILED DEFINITION^Detailed Definition^^R^^^^^^^^
"KRN",19,13026,1,0)
^19.06^3^3^3080701^^^^
"KRN",19,13026,1,1,0)
Displays all the information available for a specified MHA3 instrument. 
"KRN",19,13026,1,2,0)
This includes Intros, Questions, Choicetypes, Choices, Skips, Skip rules, 
"KRN",19,13026,1,3,0)
and Reports.
"KRN",19,13026,25)
PRTTEST^YTQPRT
"KRN",19,13026,"U")
DETAILED DEFINITION
"KRN",19,13027,-1)
0^50
"KRN",19,13027,0)
YTQ HL7 UTILITIES^MHA3 HL7 Utilities^^M^^^^^^^^
"KRN",19,13027,1,0)
^19.06^1^1^3080612^^^^
"KRN",19,13027,1,1,0)
Menu of options for examining HL7 messaging in MHA3.
"KRN",19,13027,10,0)
^19.01IP^2^2
"KRN",19,13027,10,1,0)
13028^1
"KRN",19,13027,10,1,"^")
YTQ HL7 CHECK
"KRN",19,13027,10,2,0)
13029^2
"KRN",19,13027,10,2,"^")
YTQ HL7 SEND1
"KRN",19,13027,99)
61878,46418
"KRN",19,13027,"U")
MHA3 HL7 UTILITIES
"KRN",19,13028,-1)
0^51
"KRN",19,13028,0)
YTQ HL7 CHECK^HL7 Check^^R^^^^^^^^
"KRN",19,13028,1,0)
^19.06^2^2^3080506^^
"KRN",19,13028,1,1,0)
Check the status of the MHA3 HL7 link and the status of an individual 
"KRN",19,13028,1,2,0)
message.
"KRN",19,13028,25)
CKHL7^YTQAPI14
"KRN",19,13028,"U")
HL7 CHECK
"KRN",19,13029,-1)
0^52
"KRN",19,13029,0)
YTQ HL7 SEND1^Re-Send individual HL7 Message^^R^^^^^^^^
"KRN",19,13029,1,0)
^19.06^2^2^3080506^^
"KRN",19,13029,1,1,0)
Re-Send and individual HL7 message. The message is selected by patient, 
"KRN",19,13029,1,2,0)
then test and then by date.
"KRN",19,13029,25)
SEND1^YTQAPI14
"KRN",19,13029,"U")
RE-SEND INDIVIDUAL HL7 MESSAGE
"KRN",19,13030,-1)
0^56
"KRN",19,13030,0)
YTQTUSE^server test usage MHA3 stats^^S^^^^^^^^
"KRN",19,13030,1,0)
^19.06^6^6^3100315^^^^
"KRN",19,13030,1,1,0)
       *** MHA3 ***
"KRN",19,13030,1,2,0)
Used by the National Mental Health Strategic Healthcare Group to determine
"KRN",19,13030,1,3,0)
the annual psychological test usage by site.  This option reports the
"KRN",19,13030,1,4,0)
number of each test by station within any given time period.
"KRN",19,13030,1,5,0)
 
"KRN",19,13030,1,6,0)
The MAILMAN message must be in FILEMAN date format 3031001^3040930
"KRN",19,13030,25)
YTQTUSE
"KRN",19,13030,220)
^R^^N^^N
"KRN",19,13030,"U")
SERVER TEST USAGE MHA3 STATS
"KRN",19,13031,-1)
0^47
"KRN",19,13031,0)
YTQ EXEMPT TEST^Exempt Test^^R^^^^^^^^
"KRN",19,13031,1,0)
^^5^5^3081008^
"KRN",19,13031,1,1,0)
Set restrictions on Administering and Reporting of individual tests base 
"KRN",19,13031,1,2,0)
on the security keys held by the ORDERER of the test.
"KRN",19,13031,1,3,0)
 
"KRN",19,13031,1,4,0)
The number of days that a test can be re-started if incomplete can also 
"KRN",19,13031,1,5,0)
be changed.
"KRN",19,13031,25)
EXEMPT^YTQAPI14
"KRN",19,13031,"U")
EXEMPT TEST
"KRN",19,13032,-1)
0^49
"KRN",19,13032,0)
YTQ XML OUTPUT^XML Output^^R^^^^^^^^
"KRN",19,13032,1,0)
^19.06^15^15^3080701^^^^
"KRN",19,13032,1,1,0)
Outputs an XML document of MHA3 Administration data filtered by:
"KRN",19,13032,1,2,0)
 
"KRN",19,13032,1,3,0)
          D         Date Only
"KRN",19,13032,1,4,0)
          I         Instrument
"KRN",19,13032,1,5,0)
          L         Location
"KRN",19,13032,1,6,0)
          P         Patient
"KRN",19,13032,1,7,0)
          O         Ordered By
"KRN",19,13032,1,8,0)
 
"KRN",19,13032,1,9,0)
All reports have a date range. You may include results and individual 
"KRN",19,13032,1,10,0)
question data.
"KRN",19,13032,1,11,0)
 
"KRN",19,13032,1,12,0)
This report is in XML format to aid use by other reporting tools. Output 
"KRN",19,13032,1,13,0)
contains Patient Identified Data and its use is restricted to those who 
"KRN",19,13032,1,14,0)
meet all requirements for data security and research and clinical 
"KRN",19,13032,1,15,0)
authorization/
"KRN",19,13032,25)
MAIN^YTQAPI15
"KRN",19,13032,"U")
XML OUTPUT
"KRN",19,13033,-1)
0^48
"KRN",19,13033,0)
YTQ USAGE^Test Usage^^R^^^^^^^^
"KRN",19,13033,1,0)
^19.06^2^2^3100315^^^^
"KRN",19,13033,1,1,0)
Returns number of completed administrations by test for a specified 
"KRN",19,13033,1,2,0)
period.
"KRN",19,13033,25)
EN1^YTQTUSE
"KRN",19,13033,"U")
TEST USAGE
"KRN",8994,2510,-1)
0^1
"KRN",8994,2510,0)
YTQ HL7^HL7^YTQHL7^2^S^^^1
"KRN",8994,2510,1,0)
^8994.01^1^1^3090603^^^^
"KRN",8994,2510,1,1,0)
Sends HL7 Message to national database.
"KRN",8994,2510,2,0)
^8994.02A^1^1
"KRN",8994,2510,2,1,0)
AD ^1^^1
"KRN",8994,2510,2,1,1,0)
^8994.021^1^1^3090603^^^^
"KRN",8994,2510,2,1,1,1,0)
IEN of MH Administration file 601.84
"KRN",8994,2510,2,"B","AD ",1)

"MBREQ")
0
"ORD",11,3.8)
3.8;11;;;MAILG^XPDTA1;MAILGF1^XPDIA1;MAILGE1^XPDIA1;MAILGF2^XPDIA1;;MAILGDEL^XPDIA1(%)
"ORD",11,3.8,0)
MAIL GROUP
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",71,-1)
1^1
"PKG",71,0)
MENTAL HEALTH^YS^Version 5.01 of Mental Health
"PKG",71,22,0)
^9.49I^1^1
"PKG",71,22,1,0)
5.01^2941230^2950201
"PKG",71,22,1,"PAH",1,0)
97^3100707^547
"PKG",71,22,1,"PAH",1,1,0)
^^2^2^3100707
"PKG",71,22,1,"PAH",1,1,1,0)
Please refer to YS*5.01*97 in the National Patch Module for a description 
"PKG",71,22,1,"PAH",1,1,2,0)
of this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","YS97POST")
0^13^B435281
"RTN","YS97POST",1,0)
YS97POST ;ASF/ALB- YS*5.01*97 POST-INIT ; 8/28/08 9:27am
"RTN","YS97POST",2,0)
 ;;5.01;MENTAL HEALTH;**97**;Dec 30, 1994;Build 42
"RTN","YS97POST",3,0)
 Q
"RTN","YS97POST",4,0)
HL7 ;
"RTN","YS97POST",5,0)
 N DA,DIC,DIE,X,Y,DR
"RTN","YS97POST",6,0)
 ;app param
"RTN","YS97POST",7,0)
 S DIC=771,X="YS MHA",DIC(0)="M" D ^DIC Q:Y'>0
"RTN","YS97POST",8,0)
 S DA=+Y,DIE=771,DR="2///A" D ^DIE
"RTN","YS97POST",9,0)
 ;logical link
"RTN","YS97POST",10,0)
 S DIC=870,X="YS MHAT",DIC(0)="M" D ^DIC Q:Y'>0
"RTN","YS97POST",11,0)
 S DA=+Y,DIE=870,DR="200.02///5;400.01///10.37.1.53;400.02///5000" D ^DIE
"RTN","YS97POST",12,0)
 Q
"RTN","YTQAPI14")
0^7^B29200951
"RTN","YTQAPI14",1,0)
YTQAPI14 ;ASF/ALB MHA PROCEEDURES ; 9/25/09 11:14am
"RTN","YTQAPI14",2,0)
 ;;5.01;MENTAL HEALTH;**85,97**;Dec 30, 1994;Build 42
"RTN","YTQAPI14",3,0)
 Q
"RTN","YTQAPI14",4,0)
RESEND ;resend all no transmits and errors
"RTN","YTQAPI14",5,0)
 N YSDATE,YSAD,YSTS,YSFILT,YSBEG,YSEND
"RTN","YTQAPI14",6,0)
 W @IOF,!,"MHA3 HL7 Resends",!!,"CAUTION:: use only if instructed by National Support Staff",!
"RTN","YTQAPI14",7,0)
 K DIR S DIR(0)="Y",DIR("B")="No",DIR("A")="Continue" D ^DIR Q:$D(DIRUT)
"RTN","YTQAPI14",8,0)
 Q:Y=0
"RTN","YTQAPI14",9,0)
 K DIR S DIR(0)="D^:DT:EX",DIR("A")="Begin Date" D ^DIR Q:$D(DIRUT)
"RTN","YTQAPI14",10,0)
 S YSBEG=Y
"RTN","YTQAPI14",11,0)
 K DIR S DIR(0)="D^"_Y_":DT:EX",DIR("A")="End Date" D ^DIR Q:$D(DIRUT)
"RTN","YTQAPI14",12,0)
 S YSEND=Y
"RTN","YTQAPI14",13,0)
 K DIR S DIR(0)="S^E:Errors only;T:Awaiting Transmission only;B:Both Errors;A:All administrations",DIR("A")="Filter resend" D ^DIR Q:$D(DIRUT)
"RTN","YTQAPI14",14,0)
 S YSFILT=Y
"RTN","YTQAPI14",15,0)
 S YSCODE=0,N1=0 F  S YSCODE=$O(^YTT(601.84,"AC",YSCODE)) Q:YSCODE'>0  D
"RTN","YTQAPI14",16,0)
 . S YSSNDFLG=$P($G(^YTT(601.71,YSCODE,8)),U,4)
"RTN","YTQAPI14",17,0)
 . Q:YSSNDFLG'="Y"
"RTN","YTQAPI14",18,0)
 . S YSDATE=YSBEG,YSEND=YSEND+.9
"RTN","YTQAPI14",19,0)
 . F  S YSDATE=$O(^YTT(601.84,"AC",YSCODE,YSDATE)) Q:YSDATE'>0!(YSDATE>YSEND)  D
"RTN","YTQAPI14",20,0)
 .. S YSAD=0 F  S YSAD=$O(^YTT(601.84,"AC",YSCODE,YSDATE,YSAD)) Q:YSAD'>0  D  Q
"RTN","YTQAPI14",21,0)
 ... S YSTS=$P($G(^YTT(601.84,YSAD,2)),U)
"RTN","YTQAPI14",22,0)
 ... Q:YSTS=""  ;-->out never send --incomplete
"RTN","YTQAPI14",23,0)
 ... I YSFILT="E" Q:YSTS'="E"
"RTN","YTQAPI14",24,0)
 ... I YSFILT="T" Q:YSTS'="T"
"RTN","YTQAPI14",25,0)
 ... I YSFILT="B" Q:(YSTS'="E")&(YSTS'="T")
"RTN","YTQAPI14",26,0)
 ... D NULLNOW
"RTN","YTQAPI14",27,0)
 ... K YS,YSDATA S YS("AD")=YSAD D HL7^YTQHL7(.YSDATA,.YS)
"RTN","YTQAPI14",28,0)
 ... S N1=N1+1 ;W !,N1,"  ",YSAD,"  date=",YSDATE," stat= ",YSTS
"RTN","YTQAPI14",29,0)
 W !,N1," messages resent"
"RTN","YTQAPI14",30,0)
 Q
"RTN","YTQAPI14",31,0)
NULLNOW ;set transmission status to "" and NOW
"RTN","YTQAPI14",32,0)
 N DIE,DR,DA
"RTN","YTQAPI14",33,0)
 S DA=YSAD,DIE="^YTT(601.84,",DR="11////@;12///NOW"
"RTN","YTQAPI14",34,0)
NN1 ;re-entry if lock fails
"RTN","YTQAPI14",35,0)
 L +^YTT(601.84,DA):DILOCKTM I '$T H 10 G NN1
"RTN","YTQAPI14",36,0)
 D ^DIE
"RTN","YTQAPI14",37,0)
 L -^YTT(601.84,DA)
"RTN","YTQAPI14",38,0)
 Q
"RTN","YTQAPI14",39,0)
CKHL7 ;check hl7 status
"RTN","YTQAPI14",40,0)
 N DIC,DA
"RTN","YTQAPI14",41,0)
 W @IOF,!?15,"*** HL7 Check ***",!
"RTN","YTQAPI14",42,0)
 S X="YS MHAT",DIC=870 D ^DIC
"RTN","YTQAPI14",43,0)
 I +Y'>0 W !,"YS MHAT ERROR" Q  ;-->out
"RTN","YTQAPI14",44,0)
 S DA=+Y D EN^DIQ
"RTN","YTQAPI14",45,0)
 S DIR(0)="Y",DIR("B")="Yes",DIR("A")="Continue" D ^DIR Q:$D(DIRUT)
"RTN","YTQAPI14",46,0)
 Q:Y=0
"RTN","YTQAPI14",47,0)
 D SELADM^YTQAPI14(.YSAD)
"RTN","YTQAPI14",48,0)
 Q:YSAD'>0  ;-->out
"RTN","YTQAPI14",49,0)
 S DIC="^YTT(601.84,",DA=YSAD D EN^DIQ
"RTN","YTQAPI14",50,0)
 Q
"RTN","YTQAPI14",51,0)
SEND1 ;send single HL7 by pt & test
"RTN","YTQAPI14",52,0)
 N DIC,YSAD
"RTN","YTQAPI14",53,0)
 D SELADM^YTQAPI14(.YSAD)
"RTN","YTQAPI14",54,0)
 Q:YSAD'>0
"RTN","YTQAPI14",55,0)
 K YS,YSDATA
"RTN","YTQAPI14",56,0)
 D NULLNOW
"RTN","YTQAPI14",57,0)
 S YS("AD")=YSAD D HL7^YTQHL7(.YSDATA,.YS)
"RTN","YTQAPI14",58,0)
 W !,"HL7 message created..."
"RTN","YTQAPI14",59,0)
 Q
"RTN","YTQAPI14",60,0)
SELADM(YSADIEN) ;select admin by pt and test
"RTN","YTQAPI14",61,0)
 N N,YSGIVEN,DIC,DFN,YSCODEN,YSDFN
"RTN","YTQAPI14",62,0)
 S YSADIEN=0
"RTN","YTQAPI14",63,0)
 D ^YSLRP Q:YSDFN'>0
"RTN","YTQAPI14",64,0)
 S DIC="^YTT(601.71,",DIC(0)="AEQ" D ^DIC Q:Y'>0
"RTN","YTQAPI14",65,0)
 S YSCODEN=+Y
"RTN","YTQAPI14",66,0)
 S YSGIVEN=0
"RTN","YTQAPI14",67,0)
 F  S YSGIVEN=$O(^PXRMINDX(601.84,"PI",YSDFN,YSCODEN,YSGIVEN)) Q:YSGIVEN'>0  D
"RTN","YTQAPI14",68,0)
 . S N=0 F  S N=$O(^PXRMINDX(601.84,"PI",DFN,YSCODEN,YSGIVEN,N)) Q:N'>0  D
"RTN","YTQAPI14",69,0)
 .. W !,N
"RTN","YTQAPI14",70,0)
 .. S Y=YSGIVEN D DD^%DT W ?15,Y
"RTN","YTQAPI14",71,0)
 S DIC="^YTT(601.84,",DIC(0)="AEQ" D ^DIC
"RTN","YTQAPI14",72,0)
 S YSADIEN=+Y
"RTN","YTQAPI14",73,0)
 Q
"RTN","YTQAPI14",74,0)
NOPNOTE ;restrict Pnote for a test
"RTN","YTQAPI14",75,0)
 N DIE,DIC,X,Y,DA
"RTN","YTQAPI14",76,0)
 S DIC="^YTT(601.71,",DIC(0)="AEMQ" D ^DIC Q:Y'>0
"RTN","YTQAPI14",77,0)
 S DIE="^YTT(601.71,",DA=+Y,DR=28 D ^DIE
"RTN","YTQAPI14",78,0)
 Q
"RTN","YTQAPI14",79,0)
EXEMPT ;exempt by adim and report
"RTN","YTQAPI14",80,0)
 N DIE,DIC,X,Y,DA
"RTN","YTQAPI14",81,0)
 W @IOF,!,"*** Exempt Test ***",!!
"RTN","YTQAPI14",82,0)
 W "Caution-- changing the exempt level of a published test may break copyright",!,"agreements. Changes to national tests are at the risk of the changing facility.",!!
"RTN","YTQAPI14",83,0)
 S DIC="^YTT(601.71,",DIC(0)="AEMQ" D ^DIC Q:Y'>0
"RTN","YTQAPI14",84,0)
 S DIE="^YTT(601.71,",DA=+Y,DR="8;9;27;18///NOW" D ^DIE
"RTN","YTQAPI14",85,0)
 Q
"RTN","YTQAPI14",86,0)
SIGNOK(YSDATA,YS) ; all reqiured fields
"RTN","YTQAPI14",87,0)
 ;Input: IENS as iens for 604
"RTN","YTQAPI14",88,0)
 ;Output: 1^OK TO SIGN
"RTN","YTQAPI14",89,0)
 ;        0^MISSING REQUIRED FIELDS
"RTN","YTQAPI14",90,0)
 ;        2^A G12 RECORD
"RTN","YTQAPI14",91,0)
 N N1,YSASCLS,X,YSASFLD,YSF,YSASSPL,YSN,YSFLAG,YSIEN,YSTYPE
"RTN","YTQAPI14",92,0)
 S YSFLAG=1
"RTN","YTQAPI14",93,0)
 S YSIEN=$G(YS("IENS"),-1)
"RTN","YTQAPI14",94,0)
 I '$D(^YSTX(604,YSIEN,0)) S YSDATA(1)="[ERROR]",YSDATA(2)="BAD IEN" Q
"RTN","YTQAPI14",95,0)
 S YSDATA(1)="[DATA]",YSDATA(2)="1^OK TO SIGN"
"RTN","YTQAPI14",96,0)
 S YSN=2
"RTN","YTQAPI14",97,0)
 S YSASCLS=$$GET1^DIQ(604,YSIEN_",",.04,"I")
"RTN","YTQAPI14",98,0)
 S YSASCLS=YSASCLS+3
"RTN","YTQAPI14",99,0)
 S N1=0 F  S N1=$O(^YSTX(604.66,N1)) Q:N1'>0  D:($P(^YSTX(604.66,N1,0),U,8)&($P(^YSTX(604.66,N1,0),U,YSASCLS)))
"RTN","YTQAPI14",100,0)
 . S YSASFLD=$P(^YSTX(604.66,N1,0),U,3)
"RTN","YTQAPI14",101,0)
 . D TYPE
"RTN","YTQAPI14",102,0)
 .; S YSF=$S(YSASFLD>10.02&(YSASFLD<10.44):"I",$P(^DD(604,YSASFLD,0),U,2)?1"P".E:"",1:"I")
"RTN","YTQAPI14",103,0)
 . S YSF=$S(YSASFLD>10.02&(YSASFLD<10.44):"I",YSTYPE=1:"",1:"I")
"RTN","YTQAPI14",104,0)
 . S X=$$GET1^DIQ(604,YSIEN,YSASFLD,YSF)
"RTN","YTQAPI14",105,0)
 . S:X="" YSFLAG=0,YSN=YSN+1,YSDATA(YSN)=^YSTX(604.66,N1,0)
"RTN","YTQAPI14",106,0)
 S X=$$GET1^DIQ(604,YSIEN,YSASFLD,.11)
"RTN","YTQAPI14",107,0)
 S:X="X"!(X="N") YSFLAG=2
"RTN","YTQAPI14",108,0)
 S:YSFLAG=0 YSDATA(2)="0^MISSING REQUIRED FIELDS"
"RTN","YTQAPI14",109,0)
 S:YSFLAG=2 YSDATA(2)="2^A G12 RECORD"
"RTN","YTQAPI14",110,0)
 Q
"RTN","YTQAPI14",111,0)
TYPE ;check field type
"RTN","YTQAPI14",112,0)
 ;O = NOT A POINTER 1 = POINTER
"RTN","YTQAPI14",113,0)
 N YSFLD
"RTN","YTQAPI14",114,0)
 S YSTYPE=0
"RTN","YTQAPI14",115,0)
 D FIELD^DID(604,YSASFLD,"","TYPE","YSFLD")
"RTN","YTQAPI14",116,0)
 S:YSFLD("TYPE")="POINTER" YSTYPE=1
"RTN","YTQAPI14",117,0)
 Q
"RTN","YTQAPI14",118,0)
SCOREIT(YSDATA,YS) ; from YTQAPI8
"RTN","YTQAPI14",119,0)
 N N,N2,N4,R,S,YSAA,I,II,DFN,YSCODE,YSADATE,YSSCALE,YSBED,YSEND
"RTN","YTQAPI14",120,0)
 K YSDATA,YSSONE
"RTN","YTQAPI14",121,0)
 D PARSE^YTAPI(.YS)
"RTN","YTQAPI14",122,0)
SCOR1 S (YSTEST,YSET)=$O(^YTT(601,"B",YSCODE,0))
"RTN","YTQAPI14",123,0)
 S YSED=YSADATE
"RTN","YTQAPI14",124,0)
 S YSDFN=DFN
"RTN","YTQAPI14",125,0)
 S YSSX=$P(^DPT(DFN,0),U,2)
"RTN","YTQAPI14",126,0)
 S YSTN=YSCODE
"RTN","YTQAPI14",127,0)
 IF '$D(^YTD(601.2,YSDFN,1,YSET,1,YSED)) S YSDATA(1)="[ERROR SCORE1+5]",YSDATA(2)="no administration found" Q
"RTN","YTQAPI14",128,0)
 D PRIV ;check it
"RTN","YTQAPI14",129,0)
 S YSR(0)=$G(^YTT(601.6,YSET,0))
"RTN","YTQAPI14",130,0)
 I $P(YSR(0),U,2)="Y" S X=^YTT(601.6,YSET,1) X X
"RTN","YTQAPI14",131,0)
 Q:$G(YSDATA(1))?1"[ERROR".E
"RTN","YTQAPI14",132,0)
 D SCORSET^YTAPI2
"RTN","YTQAPI14",133,0)
 D:YSPRIV SF^YTAPI2
"RTN","YTQAPI14",134,0)
 S N1=0
"RTN","YTQAPI14",135,0)
 F  S N1=$O(YSSONE(N1)) Q:N1'>0  S N=N+1,YSDATA(N)=YSSONE(N1)
"RTN","YTQAPI14",136,0)
 D CLEAN^YSMTI5 Q
"RTN","YTQAPI14",137,0)
PRIV ;check privileges
"RTN","YTQAPI14",138,0)
 N YS71,YSKEY
"RTN","YTQAPI14",139,0)
 S YSPRIV=0
"RTN","YTQAPI14",140,0)
 S YS71=$O(^YTT(601.71,"B",YSTN,0))
"RTN","YTQAPI14",141,0)
 Q:YS71'>0  ;-->out error
"RTN","YTQAPI14",142,0)
 S YSKEY=$$GET1^DIQ(601.71,YS71_",",9)
"RTN","YTQAPI14",143,0)
 I YSKEY="" S YSPRIV=1 Q  ;-->out exempt
"RTN","YTQAPI14",144,0)
 I $D(^XUSEC(YSKEY,DUZ)) S YSPRIV=1 Q  ;-->out has key
"RTN","YTQAPI14",145,0)
 Q
"RTN","YTQAPI15")
0^11^B29251831
"RTN","YTQAPI15",1,0)
YTQAPI15 ;ASF/ALB MHA XML ; 9/25/09 11:14am
"RTN","YTQAPI15",2,0)
 ;;5.01;MENTAL HEALTH;**85,97**;Dec 30, 1994;Build 42
"RTN","YTQAPI15",3,0)
 Q
"RTN","YTQAPI15",4,0)
MAIN ;
"RTN","YTQAPI15",5,0)
 N N,G,YSCN,ICN,Y,YSA,YSAD,YSB,YSC,YSCN,YSCODE,YSD,YSDFN,YSDG,YSE,YSEA,YSER,YSF,YSFIELD,YSFILE,YSIENS,YSJ,YSLOC,YSOD,YSQNUMB,YSQTEXT,YSR,DFN,DIRUT,L1,L2,CNT,IDX,LEN
"RTN","YTQAPI15",6,0)
 D SELAD
"RTN","YTQAPI15",7,0)
DEV S %ZIS="QM" D ^%ZIS Q:IO=""
"RTN","YTQAPI15",8,0)
 I '$D(IO("Q")) W !,"Please Queue this job",! G DEV
"RTN","YTQAPI15",9,0)
 D  D ^%ZTLOAD D HOME^%ZIS K IO("Q") Q  ;-->out
"RTN","YTQAPI15",10,0)
 .S ZTRTN="ENQ^YTQAPI15",ZTDESC="MHA3 XML Export",ZTSAVE("YS*")=""
"RTN","YTQAPI15",11,0)
 .S ZTIO=ION_";"_IOST
"RTN","YTQAPI15",12,0)
 .I $D(IO("DOC"))#2,IO("DOC")]"" S ZTIO=ZTIO_";"_IO("DOC") Q
"RTN","YTQAPI15",13,0)
 .I IOM S ZTIO=ZTIO_";"_IOM
"RTN","YTQAPI15",14,0)
 .I IOSL S ZTIO=ZTIO_";"_IOSL
"RTN","YTQAPI15",15,0)
 ;
"RTN","YTQAPI15",16,0)
ENQ ;taskman entry
"RTN","YTQAPI15",17,0)
 K ^TMP("YSXML",$J),^TMP("YSAD",$J)
"RTN","YTQAPI15",18,0)
 S N=0
"RTN","YTQAPI15",19,0)
 D SI:YSF="I",SP:YSF="P",SO:YSF="O",SL:YSF="L",SD:YSF="D"
"RTN","YTQAPI15",20,0)
 I '$D(^TMP("YSAD",$J)) S ^TMP("YSXML",$J,1)="[ERROR]^no data" Q  ;-->out
"RTN","YTQAPI15",21,0)
 S N=N+1,^TMP("YSXML",$J,N)="<?xml version='1.0' encoding='UTF-8'?>"
"RTN","YTQAPI15",22,0)
 S N=N+1,^TMP("YSXML",$J,N)="<Export>"
"RTN","YTQAPI15",23,0)
 D ADMIN
"RTN","YTQAPI15",24,0)
 S N=N+1,^TMP("YSXML",$J,N)="</Export>"
"RTN","YTQAPI15",25,0)
 U IO S N=0 F  S N=$O(^TMP("YSXML",$J,N)) Q:N'>0  W ^(N),!
"RTN","YTQAPI15",26,0)
 D ^%ZISC
"RTN","YTQAPI15",27,0)
 Q  ;-->out
"RTN","YTQAPI15",28,0)
SELAD ;administation filter
"RTN","YTQAPI15",29,0)
 W @IOF,!!,"MHA XML Export"
"RTN","YTQAPI15",30,0)
 K DIR S DIR(0)="S^D:Date Only;I:Instrument;L:Location;P:Patient;O:Ordered By"
"RTN","YTQAPI15",31,0)
 S DIR("A")="Filter By" D ^DIR
"RTN","YTQAPI15",32,0)
 Q:$D(DIRUT)
"RTN","YTQAPI15",33,0)
 S YSF=Y
"RTN","YTQAPI15",34,0)
 K DIR S DIR(0)="DA^2961001:NOW:TX",DIR("A")="Begin date/time: ",DIR("B")="T-1M" D ^DIR
"RTN","YTQAPI15",35,0)
 Q:$D(DIRUT)
"RTN","YTQAPI15",36,0)
 S YSB=Y
"RTN","YTQAPI15",37,0)
 K DIR S DIR(0)="DA^2961001:NOW:TX",DIR("A")="End date/time: ",DIR("B")="NOW" D ^DIR
"RTN","YTQAPI15",38,0)
 Q:$D(DIRUT)
"RTN","YTQAPI15",39,0)
 S YSE=Y
"RTN","YTQAPI15",40,0)
 K DIR S DIR(0)="Y",DIR("A")="Export Answers",DIR("B")="No" D ^DIR
"RTN","YTQAPI15",41,0)
 Q:$D(DIRUT)
"RTN","YTQAPI15",42,0)
 S YSEA=Y
"RTN","YTQAPI15",43,0)
 K DIR S DIR(0)="Y",DIR("A")="Export Results",DIR("B")="No" D ^DIR
"RTN","YTQAPI15",44,0)
 Q:$D(DIRUT)
"RTN","YTQAPI15",45,0)
 S YSER=Y
"RTN","YTQAPI15",46,0)
 K DIC
"RTN","YTQAPI15",47,0)
 I YSF="I" S DIC(0)="AEQ",DIC="^YTT(601.71," D ^DIC Q:Y'>0  S YSCODE=$P(Y,U,2)
"RTN","YTQAPI15",48,0)
 I YSF="P" D ^YSLRP Q:DFN'>0  ;-->out
"RTN","YTQAPI15",49,0)
 I YSF="O" S DIC("A")="Ordered By: ",DIC(0)="AEQ",DIC="^VA(200," D ^DIC Q:Y'>0  S YSOD=+Y
"RTN","YTQAPI15",50,0)
 I YSF="L" S DIC(0)="AEQ",DIC="^DIC(42," D ^DIC Q:Y'>0  S YSLOC=+Y
"RTN","YTQAPI15",51,0)
 Q
"RTN","YTQAPI15",52,0)
SI ;selct by instrument
"RTN","YTQAPI15",53,0)
 S YSCN=$O(^YTT(601.71,"B",YSCODE,-1))
"RTN","YTQAPI15",54,0)
 S YSD=YSB-.00001 F  S YSD=$O(^YTT(601.84,"AC",YSCN,YSD)) Q:(YSD'>0)!(YSD>YSE)  D
"RTN","YTQAPI15",55,0)
 . S YSAD=0 F  S YSAD=$O(^YTT(601.84,"AC",YSCN,YSD,YSAD)) Q:YSAD'>0  S ^TMP("YSAD",$J,YSAD)=""
"RTN","YTQAPI15",56,0)
 Q
"RTN","YTQAPI15",57,0)
SP ;select by patient
"RTN","YTQAPI15",58,0)
 S YSAD=0 F  S YSAD=$O(^YTT(601.84,"C",YSDFN,YSAD)) Q:YSAD'>0  D
"RTN","YTQAPI15",59,0)
 . S YSDG=$P(^YTT(601.84,YSAD,0),U,4)
"RTN","YTQAPI15",60,0)
 . S:(YSDG'<YSB)&(YSDG'>(YSE+.9)) ^TMP("YSAD",$J,YSAD)=""
"RTN","YTQAPI15",61,0)
 Q
"RTN","YTQAPI15",62,0)
SD ;select by Date Only
"RTN","YTQAPI15",63,0)
 S YSAD=0 F  S YSAD=$O(^YTT(601.84,"B",YSAD)) Q:YSAD'>0  D
"RTN","YTQAPI15",64,0)
 . S YSDG=$P(^YTT(601.84,YSAD,0),U,4)
"RTN","YTQAPI15",65,0)
 . S:(YSDG'<YSB)&(YSDG'>(YSE+.9)) ^TMP("YSAD",$J,YSAD)=""
"RTN","YTQAPI15",66,0)
 Q
"RTN","YTQAPI15",67,0)
SO ;select by Ordered by
"RTN","YTQAPI15",68,0)
 S YSAD=0 F  S YSAD=$O(^YTT(601.84,"AO",YSOD,YSAD)) Q:YSAD'>0  D
"RTN","YTQAPI15",69,0)
 . S YSDG=$P(^YTT(601.84,YSAD,0),U,4)
"RTN","YTQAPI15",70,0)
 . S:(YSDG'<YSB)&(YSDG'>(YSE+.9)) ^TMP("YSAD",$J,YSAD)=""
"RTN","YTQAPI15",71,0)
 Q
"RTN","YTQAPI15",72,0)
SL ;select by location
"RTN","YTQAPI15",73,0)
 S YSAD=0 F  S YSAD=$O(^YTT(601.84,"AL",YSLOC,YSAD)) Q:YSAD'>0  D
"RTN","YTQAPI15",74,0)
 . S YSDG=$P(^YTT(601.84,YSAD,0),U,4)
"RTN","YTQAPI15",75,0)
 . S:(YSDG'<YSB)&(YSDG'>(YSE+.9)) ^TMP("YSAD",$J,YSAD)=""
"RTN","YTQAPI15",76,0)
 Q
"RTN","YTQAPI15",77,0)
ADMIN ;extract the data into an XML global
"RTN","YTQAPI15",78,0)
 S YSAD=0 F  S YSAD=$O(^TMP("YSAD",$J,YSAD)) Q:YSAD'>0  D
"RTN","YTQAPI15",79,0)
 . S N=N+1,^TMP("YSXML",$J,N)="<Admin>"
"RTN","YTQAPI15",80,0)
 . S N=N+1,^TMP("YSXML",$J,N)="<Admin_ID>"_YSAD_"</Admin_ID>"
"RTN","YTQAPI15",81,0)
 . D FORM("Patient",601.84,YSAD,1)
"RTN","YTQAPI15",82,0)
 . S DFN=$P(^YTT(601.84,YSAD,0),U,2),ICN=$$GETICN^MPIF001(DFN),N=N+1,^TMP("YSXML",$J,N)="<ICN>"_ICN_"</ICN>"
"RTN","YTQAPI15",83,0)
 . D FORM("Instrument",601.84,YSAD,2)
"RTN","YTQAPI15",84,0)
 . D FORM("Given",601.84,YSAD,3)
"RTN","YTQAPI15",85,0)
 . D FORM("Saved",601.84,YSAD,4)
"RTN","YTQAPI15",86,0)
 . D FORM("Ordered",601.84,YSAD,5)
"RTN","YTQAPI15",87,0)
 . D FORM("Complete",601.84,YSAD,8)
"RTN","YTQAPI15",88,0)
 . D FORM("Location",601.84,YSAD,13)
"RTN","YTQAPI15",89,0)
 . D QUEST:YSEA
"RTN","YTQAPI15",90,0)
 . D RESULT:YSER
"RTN","YTQAPI15",91,0)
 . S N=N+1,^TMP("YSXML",$J,N)="</Admin>"
"RTN","YTQAPI15",92,0)
 Q
"RTN","YTQAPI15",93,0)
FORM(YSTAG,YSFILE,YSIENS,YSFIELD) ;xml entry
"RTN","YTQAPI15",94,0)
 N G,Y1,Y2
"RTN","YTQAPI15",95,0)
 S N=N+1
"RTN","YTQAPI15",96,0)
 S Y1=$$GET1^DIQ(YSFILE,YSIENS_",",YSFIELD)
"RTN","YTQAPI15",97,0)
 S Y2=$$CONVSTR(Y1)
"RTN","YTQAPI15",98,0)
 S G="<"_YSTAG_">"_Y2_"</"_YSTAG_">"
"RTN","YTQAPI15",99,0)
 S ^TMP("YSXML",$J,N)=G
"RTN","YTQAPI15",100,0)
 Q
"RTN","YTQAPI15",101,0)
QUEST ;answers out
"RTN","YTQAPI15",102,0)
 S YSA=0,YSJ=0  F  S YSA=$O(^YTT(601.85,"AD",YSAD,YSA)) Q:YSA'>0  D
"RTN","YTQAPI15",103,0)
 . S N=N+1,^TMP("YSXML",$J,N)="<Quest>"
"RTN","YTQAPI15",104,0)
 . S N=N+1,^TMP("YSXML",$J,N)="<Admin_ID>"_YSAD_"</Admin_ID>"
"RTN","YTQAPI15",105,0)
 . S YSQNUMB=$P(^YTT(601.85,YSA,0),U,3)
"RTN","YTQAPI15",106,0)
 . S N=N+1,^TMP("YSXML",$J,N)="<Qnumb>"_YSQNUMB_"</Qnumb>"
"RTN","YTQAPI15",107,0)
 . S YSQTEXT=$G(^YTT(601.72,YSQNUMB,1,1,0))
"RTN","YTQAPI15",108,0)
 . S N=N+1,^TMP("YSXML",$J,N)="<Qtext>"_YSQTEXT_"</Qtext>"
"RTN","YTQAPI15",109,0)
 . S N=N+1,YSJ=YSJ+1,^TMP("YSXML",$J,N)="<Seq>"_YSJ_"</Seq>"
"RTN","YTQAPI15",110,0)
 . D FORM("Choice",601.85,YSA,4)
"RTN","YTQAPI15",111,0)
 . S N=N+1
"RTN","YTQAPI15",112,0)
 . S YSC=$P(^YTT(601.85,YSA,0),U,4)
"RTN","YTQAPI15",113,0)
 . S YSCN=$S(YSC?1N.N:^YTT(601.75,YSC,1),1:"???")
"RTN","YTQAPI15",114,0)
 . S:$D(^YTT(601.85,YSA,1,1,0)) YSCN=^YTT(601.85,YSA,1,1,0)
"RTN","YTQAPI15",115,0)
 . S ^TMP("YSXML",$J,N)="<Ans>"_YSCN_"</Ans>"
"RTN","YTQAPI15",116,0)
 . S N=N+1,^TMP("YSXML",$J,N)="</Quest>"
"RTN","YTQAPI15",117,0)
 Q
"RTN","YTQAPI15",118,0)
RESULT ;results out
"RTN","YTQAPI15",119,0)
 S YSR=0
"RTN","YTQAPI15",120,0)
 F  S YSR=$O(^YTT(601.92,"AC",YSAD,YSR)) Q:YSR'>0  D
"RTN","YTQAPI15",121,0)
 . S N=N+1,^TMP("YSXML",$J,N)="<Score>"
"RTN","YTQAPI15",122,0)
 . S N=N+1,^TMP("YSXML",$J,N)="<Admin_ID>"_YSAD_"</Admin_ID>"
"RTN","YTQAPI15",123,0)
 . D FORM("Scale",601.92,YSR,2)
"RTN","YTQAPI15",124,0)
 . D FORM("Raw",601.92,YSR,3)
"RTN","YTQAPI15",125,0)
 . D FORM("Trans1",601.92,YSR,4)
"RTN","YTQAPI15",126,0)
 . S N=N+1,^TMP("YSXML",$J,N)="</Score>"
"RTN","YTQAPI15",127,0)
 Q
"RTN","YTQAPI15",128,0)
HEAD ;
"RTN","YTQAPI15",129,0)
 ;
"RTN","YTQAPI15",130,0)
CONVSTR(YSIN) ;convert string to valid xml
"RTN","YTQAPI15",131,0)
 S L1(1)="&",L2(1)="&amp;" ; Keep "&" first
"RTN","YTQAPI15",132,0)
 S L1(2)=">",L2(2)="&gt;"
"RTN","YTQAPI15",133,0)
 S L1(3)="<",L2(3)="&lt;"
"RTN","YTQAPI15",134,0)
 S L1(4)="'",L2(4)="&apos;"
"RTN","YTQAPI15",135,0)
 S L1(5)="""",L2(5)="&quot;"
"RTN","YTQAPI15",136,0)
 S YSOUT=YSIN
"RTN","YTQAPI15",137,0)
 F CNT=1:1:5 D
"RTN","YTQAPI15",138,0)
 .S LEN=$L(L1(CNT))+1
"RTN","YTQAPI15",139,0)
 .S IDX=0
"RTN","YTQAPI15",140,0)
 .F  S IDX=$F(YSOUT,L1(CNT),IDX) Q:IDX=0  D
"RTN","YTQAPI15",141,0)
 .. S YSOUT=$E(YSOUT,1,IDX-LEN)_L2(CNT)_$E(YSOUT,IDX,250)
"RTN","YTQAPI15",142,0)
 .. S IDX=IDX-(LEN-2)
"RTN","YTQAPI15",143,0)
 Q YSOUT
"RTN","YTQHL7")
0^12^B40318734
"RTN","YTQHL7",1,0)
YTQHL7 ;ALB/ASF HL7 ; 10/7/08 3:31pm
"RTN","YTQHL7",2,0)
 ;;5.01;MENTAL HEALTH;**85,93,97**;Dec 30, 1994;Build 42
"RTN","YTQHL7",3,0)
 Q
"RTN","YTQHL7",4,0)
ACKMHA ;
"RTN","YTQHL7",5,0)
 N YSLOCAT,YSERT,YSDIV,YSACK,YSMID,YSFS,YSAD,YSMTXT,YSX,YS772,YSMSG
"RTN","YTQHL7",6,0)
 S YSACK="",YSFS=HL("FS")
"RTN","YTQHL7",7,0)
 ;get ack type
"RTN","YTQHL7",8,0)
 F  X HLNEXT Q:HLQUIT'>0  D
"RTN","YTQHL7",9,0)
 . I $P(HLNODE,YSFS)="MSA" S YSACK=$P(HLNODE,YSFS,2),YSMID=$P(HLNODE,YSFS,3),YSERT=$P(HLNODE,YSFS,1,4)
"RTN","YTQHL7",10,0)
 ;get ien of 601.84 from message
"RTN","YTQHL7",11,0)
 S DIC=773,DIC(0)="MZ",X=YSMID D ^DIC K DIC
"RTN","YTQHL7",12,0)
 I Y'>0 D ERRMAIL("BAD BAD") Q  ;-->out
"RTN","YTQHL7",13,0)
 S YS772=$P(Y,U,2) ;ien of message 772
"RTN","YTQHL7",14,0)
 S X=$$GET1^DIQ(772,YS772_",",200,,"YSMSG")
"RTN","YTQHL7",15,0)
 S N=0,YSAD=0 F  S N=$O(YSMSG(N)) Q:N'>0!(YSAD>0)  S YSOUT=YSMSG(N) S:$P(YSOUT,YSFS)="OBX" YSAD=+$P(YSOUT,YSFS,4)
"RTN","YTQHL7",16,0)
 I YSAD'>0 D ERRMAIL("ERROR?  MH ADMINITRATION #601.84 ien is 0",YSAD) Q  ;--->out
"RTN","YTQHL7",17,0)
 ;set 601.84 fields
"RTN","YTQHL7",18,0)
 S YSX=$S(YSACK="AA":"S",YSACK="AE":"E",YSACK="AR":"E",1:"")
"RTN","YTQHL7",19,0)
 S DA=YSAD,DIE="^YTT(601.84,",DR="11///"_YSX_";12///NOW" D ^DIE
"RTN","YTQHL7",20,0)
 I YSACK="AR" D ARSEND Q  ;resend HL7 and --> out ASF 5/14/08
"RTN","YTQHL7",21,0)
 I YSX'="S" D ERRMAIL(YSERT,YSAD)
"RTN","YTQHL7",22,0)
 Q
"RTN","YTQHL7",23,0)
ARSEND ;resend AR acks
"RTN","YTQHL7",24,0)
 N ZTIO,ZTDESC,ZTRTN,ZTREQ,ZTDTH
"RTN","YTQHL7",25,0)
 S ZTSAVE("YSAD")=""
"RTN","YTQHL7",26,0)
 S ZTIO="",ZTRTN="ARHL7^YTQHL7"
"RTN","YTQHL7",27,0)
 S %DT="FRPS",X="NOW+1H" D ^%DT S ZTDTH=Y
"RTN","YTQHL7",28,0)
 S ZTDESC="mha3 AR HL7 resend of "_YSAD
"RTN","YTQHL7",29,0)
 D ^%ZTLOAD
"RTN","YTQHL7",30,0)
 Q
"RTN","YTQHL7",31,0)
ARHL7 ;taskman hl7 resend
"RTN","YTQHL7",32,0)
 K YS,YSDATA
"RTN","YTQHL7",33,0)
 S YS("AD")=YSAD
"RTN","YTQHL7",34,0)
 D HL7^YTQHL7(.YSDATA,.YS)
"RTN","YTQHL7",35,0)
 S ZTREQ="@"
"RTN","YTQHL7",36,0)
 Q
"RTN","YTQHL7",37,0)
ERRMAIL(X,YSAD) ;mail error reports
"RTN","YTQHL7",38,0)
 N XMDUZ,XMSUB,XMTEXT,XMY,YSMAILG
"RTN","YTQHL7",39,0)
 S YSMAILG=$$GETAPP^HLCS2("YS MHA")
"RTN","YTQHL7",40,0)
 K ^TMP("YSMHAHL7",$J)
"RTN","YTQHL7",41,0)
 S ^TMP("YSMHAHL7",$J,1,0)="An attempt to send MHA3 Administration ien #"_YSAD
"RTN","YTQHL7",42,0)
 S ^TMP("YSMHAHL7",$J,2,0)="generated an error."
"RTN","YTQHL7",43,0)
 S ^TMP("YSMHAHL7",$J,3,0)="Error: "_X
"RTN","YTQHL7",44,0)
 S ^TMP("YSMHAHL7",$J,4,0)="Please report this error mailto:hl7err@mentalhealth.va.gov"
"RTN","YTQHL7",45,0)
 S XMSUB="Mental Health Assistant 3 HL7 Error"
"RTN","YTQHL7",46,0)
 S XMY("G."_$P(YSMAILG,U))=""
"RTN","YTQHL7",47,0)
 S XMTEXT="^TMP(""YSMHAHL7"",$J,"
"RTN","YTQHL7",48,0)
 S XMDUZ="AUTOMATED MESSAGE"
"RTN","YTQHL7",49,0)
 D ^XMD
"RTN","YTQHL7",50,0)
 K ^TMP("YSMHAHL7",$J)
"RTN","YTQHL7",51,0)
 Q
"RTN","YTQHL7",52,0)
HL7(YSDATA,YS) ;RPC entry
"RTN","YTQHL7",53,0)
 ;input:ADMIN = ADMINISTRATION #
"RTN","YTQHL7",54,0)
 ;output: [DATA]
"RTN","YTQHL7",55,0)
 N G,G1,N,YSAD,YSQ,CNT,MC,HLFS,HLCS,DA,DFN,DIE,DR,HLECH,HLNEXT,HLNODE,HLQUIT,MYOPTNS,MYRESULT,J1,J2
"RTN","YTQHL7",56,0)
 N VADMVT,VAINDT,X1,Y,YSANSID,YSAVED,YSCC,YSCONID,YSEQ,YSIN,YSIO,YSLINE,YSORBY,YSOUT,YSQN,YSTEST,YSTESTN,YSTS,YSTST,YSRTYP,YSRTYPN
"RTN","YTQHL7",57,0)
 S YSAD=$G(YS("AD"))
"RTN","YTQHL7",58,0)
 I YSAD'?1N.N S YSDATA(1)="[ERROR]",YSDATA(2)="bad ad num" Q  ;-->out
"RTN","YTQHL7",59,0)
 I '$D(^YTT(601.84,YSAD)) S YSDATA(1)="[ERROR]",YSDATA(2)="no such reference" Q  ;-->out
"RTN","YTQHL7",60,0)
 ;No Dups
"RTN","YTQHL7",61,0)
 I $P($G(^YTT(601.84,YSAD,2)),U)="S" S YSDATA(1)="[ERROR]",YSDATA(2)=YSAD_" is dup" Q  ;-->out
"RTN","YTQHL7",62,0)
 S YSTST=$P(^YTT(601.84,YSAD,0),U,3) ;ins ien
"RTN","YTQHL7",63,0)
 I $P($G(^YTT(601.71,YSTST,8)),U,4)'="Y" S YSDATA(1)="[DATA]",YSDATA(2)="ins not to be sent" Q  ;--> out
"RTN","YTQHL7",64,0)
 S YSDATA(1)="[ERROR]"
"RTN","YTQHL7",65,0)
 S DA=YSAD,DIE="^YTT(601.84,",DR="11///T;12///NOW" D ^DIE
"RTN","YTQHL7",66,0)
 D ADSEND
"RTN","YTQHL7",67,0)
 Q
"RTN","YTQHL7",68,0)
ADSEND ;send completed Admin to MHSHG
"RTN","YTQHL7",69,0)
 S DFN=$P(^YTT(601.84,YSAD,0),U,2)
"RTN","YTQHL7",70,0)
 S YSAVED=$P(^YTT(601.84,YSAD,0),U,4) ;changed to GIVEN 10/31/07
"RTN","YTQHL7",71,0)
 S YSTESTN=$P(^YTT(601.84,YSAD,0),U,3)
"RTN","YTQHL7",72,0)
 S YSTEST=$$GET1^DIQ(601.71,YSTESTN_",",.01)
"RTN","YTQHL7",73,0)
 S YSORBY=$P(^YTT(601.84,YSAD,0),U,6)
"RTN","YTQHL7",74,0)
 S YSLOCAT=$P(^YTT(601.84,YSAD,0),U,11)
"RTN","YTQHL7",75,0)
 S YSDIV="" S:YSLOCAT?1N.N YSDIV=$$GET1^DIQ(44,YSLOCAT_",",3.5)
"RTN","YTQHL7",76,0)
 I YSDIV=""&($D(DUZ(2))) S YSDIV=$$GET1^DIQ(4,DUZ(2)_",",.01)
"RTN","YTQHL7",77,0)
BLDM ;BUILD A SINGLE MESSAGE
"RTN","YTQHL7",78,0)
 ;MSH-EVN-PID-PV1-OBX
"RTN","YTQHL7",79,0)
 K HLA,HLEVN
"RTN","YTQHL7",80,0)
 N CNT,MC,HLFS,HLCS
"RTN","YTQHL7",81,0)
 S CNT=0
"RTN","YTQHL7",82,0)
1 ;set up environment for message
"RTN","YTQHL7",83,0)
 K HL D INIT^HLFNC2("YS MHA A08 EVENT",.HL)
"RTN","YTQHL7",84,0)
 I $G(HL) D  Q  ; error occurred -->out
"RTN","YTQHL7",85,0)
 . ; put error handler here for init failure
"RTN","YTQHL7",86,0)
 . S YSDATA(1)="[ERROR]",YSDATA(2)="init Error: "_$P(HL,2) W !,"XXX"
"RTN","YTQHL7",87,0)
 S HLFS=$G(HL("FS")) I HLFS="" S HLFS="^"
"RTN","YTQHL7",88,0)
 S HLCS=$E(HL("ECH"),1)
"RTN","YTQHL7",89,0)
2 ;Add message txt to HLA array
"RTN","YTQHL7",90,0)
 ;create ENV segment
"RTN","YTQHL7",91,0)
 S CNT=CNT+1,HLA("HLS",CNT)="EVN"_HLFS_"A08"_HLFS_$$HLDATE^HLFNC(YSAVED,"TS")_HLFS_$$HLDATE^HLFNC(YSAVED,"TS")_HLFS_"05"_HLFS_HLFS_$$HLDATE^HLFNC(YSAVED,"TS")
"RTN","YTQHL7",92,0)
 ; create PID segment for patient DFN -- call segment generator
"RTN","YTQHL7",93,0)
 S CNT=CNT+1,HLA("HLS",CNT)=$$EN^VAFHLPID(DFN,"1,2,4,6,7,8,10,11,12,13,16,17,19,22",1,1)
"RTN","YTQHL7",94,0)
 ;create PV1 segment
"RTN","YTQHL7",95,0)
 S VAINDT=YSAVED D ADM^VADPT2 S YSIO=$S(VADMVT>0:"I",1:"O")
"RTN","YTQHL7",96,0)
 S CNT=CNT+1,HLA("HLS",CNT)="PV1"_HLFS_"0001"_HLFS_YSIO_HLFS_"~~~~~~~~"_YSDIV
"RTN","YTQHL7",97,0)
 ;create OBX segments
"RTN","YTQHL7",98,0)
 D OBX(YSAD)
"RTN","YTQHL7",99,0)
 ;crete PR1 proccedure
"RTN","YTQHL7",100,0)
 S CNT=CNT+1
"RTN","YTQHL7",101,0)
 S HLA("HLS",CNT)="PR1"_HLFS_1_HLFS_HLFS_YSTESTN_$E($G(HLECH))_YSTEST_HLFS_HLFS_$$HLDATE^HLFNC(YSAVED,"TS")_HLFS_"D"
"RTN","YTQHL7",102,0)
 N DGNAME S DGNAME("FILE")=200,DGNAME("IENS")=YSORBY,DGNAME("FIELD")=.01
"RTN","YTQHL7",103,0)
 S X1=$$HLNAME^XLFNAME(.DGNAME,"S",$E($G(HLECH))),X1=YSORBY_$E(HLECH,1)_X1
"RTN","YTQHL7",104,0)
 S HLA("HLS",CNT)=HLA("HLS",CNT)_HLFS_HLFS_HLFS_HLFS_HLFS_HLFS_X1
"RTN","YTQHL7",105,0)
CTRL ;remove stray chars
"RTN","YTQHL7",106,0)
 F J1=1:1:CNT D:$G(HLA("HLS",J1))?.E1C.E CTRL1
"RTN","YTQHL7",107,0)
 ;
"RTN","YTQHL7",108,0)
DIRECT ;CALL HL7 TO TRANSMIT MESSAGE
"RTN","YTQHL7",109,0)
 D GENERATE^HLMA("YS MHA A08 EVENT","LM",1,.MYRESULT,"",.MYOPTNS)
"RTN","YTQHL7",110,0)
 S YSDATA(1)="[DATA]"
"RTN","YTQHL7",111,0)
 Q
"RTN","YTQHL7",112,0)
OBX(YSAD) ;enter multiple OBX seqments
"RTN","YTQHL7",113,0)
 S YSIN=$P(^YTT(601.84,YSAD,0),U,3)
"RTN","YTQHL7",114,0)
 S YSEQ=0 F  S YSEQ=$O(^YTT(601.76,"AD",YSIN,YSEQ)) Q:YSEQ'>0  S YSCONID=$O(^YTT(601.76,"AD",YSIN,YSEQ,0)) D
"RTN","YTQHL7",115,0)
 . S YSQN=$P(^YTT(601.76,YSCONID,0),U,4)
"RTN","YTQHL7",116,0)
 . S YSRTYP=$P($G(^YTT(601.72,YSQN,2)),U,2)
"RTN","YTQHL7",117,0)
 . S YSRTYPN=YSRTYP*(-1)
"RTN","YTQHL7",118,0)
 . S YSANSID=$O(^YTT(601.85,"AC",YSAD,YSQN,0))
"RTN","YTQHL7",119,0)
 . Q:YSANSID'?1N.N
"RTN","YTQHL7",120,0)
 . S G=$G(^YTT(601.85,YSANSID,0)),YSCC=$P(G,U,4)
"RTN","YTQHL7",121,0)
 . S CNT=CNT+1
"RTN","YTQHL7",122,0)
 . I +YSCC S CNT=CNT+1,HLA("HLS",CNT)="OBX"_HLFS_YSEQ_HLFS_"CE"_HLFS_YSAD_"~~~"_YSQN_HLFS_1_HLFS_YSCC_"~"_$G(^YTT(601.75,$P(G,U,4),1))_"||||||"_"R|||"_$$HLDATE^HLFNC(YSAVED,"TS") Q
"RTN","YTQHL7",123,0)
 . E  S YSLINE=0 F  S YSLINE=$O(^YTT(601.85,YSANSID,1,YSLINE)) Q:YSLINE'>0  D
"RTN","YTQHL7",124,0)
 .. S CNT=CNT+1,HLA("HLS",CNT)="OBX"_HLFS_YSEQ_HLFS_"CE"_HLFS_YSAD_"~~~"_YSQN_HLFS_YSLINE_HLFS_YSRTYPN_"~"
"RTN","YTQHL7",125,0)
 .. S Y1=$G(^YTT(601.85,YSANSID,1,YSLINE,0))
"RTN","YTQHL7",126,0)
 .. F X1="|","~" S X=$S(X1="~":":;",1:";:") F %=0:0 S %=$F(Y1,X1,%) Q:%<2  S Y1=$E(Y1,1,%-$L(X1)-1)_X_$E(Y1,%,999)
"RTN","YTQHL7",127,0)
 .. S HLA("HLS",CNT)=HLA("HLS",CNT)_Y1_"||||||"_"R|||"_$$HLDATE^HLFNC(YSAVED,"TS") Q
"RTN","YTQHL7",128,0)
 Q
"RTN","YTQHL7",129,0)
REDO ;resend all no transmits and errors
"RTN","YTQHL7",130,0)
 S YSAD=0 F  S YSAD=$O(^YTT(601.84,YSAD)) Q:YSAD'>0  D
"RTN","YTQHL7",131,0)
 . S YSTS=$P($G(^YTT(601.84,YSAD,2)),U)
"RTN","YTQHL7",132,0)
 . I (YSTS="T")!(YSTS="E") K YS,YSDATA S YS("AD")=YSAD D HL7(.YSDATA,.YS)
"RTN","YTQHL7",133,0)
 Q
"RTN","YTQHL7",134,0)
REDO1 ;resend single admin
"RTN","YTQHL7",135,0)
 K DIC,DIR S DIC(0)="AEQM",DIC="^YTT(601.84," D ^DIC Q:Y'>0  ;-->out
"RTN","YTQHL7",136,0)
 W !
"RTN","YTQHL7",137,0)
 S (YSAD,DA)=+Y D EN^DIQ
"RTN","YTQHL7",138,0)
 S DIR(0)="Y",DIR("A")="Send HL7",DIR("B")="No" D ^DIR
"RTN","YTQHL7",139,0)
 I Y K YS,YSDATA S YS("AD")=YSAD D HL7(.YSDATA,.YS)
"RTN","YTQHL7",140,0)
 G REDO1
"RTN","YTQHL7",141,0)
CTRL1 ;remove control chars
"RTN","YTQHL7",142,0)
 F J2=1:1 Q:HLA("HLS",J1)'?.E1C.E  S:$E(HLA("HLS",J1),J2)?1C HLA("HLS",J1)=$E(HLA("HLS",J1),0,J2-1)_$E(HLA("HLS",J1),J2+1,999),J2=J2-1
"RTN","YTQHL7",143,0)
 Q
"RTN","YTQPRT")
0^8^B29277675
"RTN","YTQPRT",1,0)
YTQPRT ;ASF/ALB MHA3 PRINT TEST; 2/24/10 1:27pm
"RTN","YTQPRT",2,0)
 ;;5.01;MENTAL HEALTH;**85,97**;DEC 30,1994;Build 42
"RTN","YTQPRT",3,0)
 ;
"RTN","YTQPRT",4,0)
 Q
"RTN","YTQPRT",5,0)
FORM ;print for clinicians
"RTN","YTQPRT",6,0)
 N YSLIMIT,YSCODE,YSCODEN,YSNUMB,YSG,YSIEN,YSOPER,YSQG2,YSERR,YSCTYPE,YSCHT,YSCHOICE,YSLEG,YSQN,YSNN,YSLFT
"RTN","YTQPRT",7,0)
 N DA,G,J,N,N1,Y,YS1,YSCDISP,YSCHTSEQ,YSCTEXT,YSI,YSIDENT,YSDISP,YSINTRO,YSQDISP,YSR,YSRTYPE,YSSCALE,YSSCIEN,YSZ,YSEQ,YSIDISP
"RTN","YTQPRT",8,0)
 K DIC S DIC(0)="MAE",DIC="^YTT(601.71," D ^DIC Q:Y'>0
"RTN","YTQPRT",9,0)
 S YSCODEN=+Y,YSCODE=$P(Y,U,2)
"RTN","YTQPRT",10,0)
 ;S DA=YSCODEN D EN^DIQ
"RTN","YTQPRT",11,0)
 D ^%ZIS Q:POP
"RTN","YTQPRT",12,0)
FA W @IOF,!?7,YSCODE
"RTN","YTQPRT",13,0)
 W !,$$GET1^DIQ(601.71,YSCODEN_",","PRINT TITLE")
"RTN","YTQPRT",14,0)
 S YSNUMB=0,YSLFT=""
"RTN","YTQPRT",15,0)
 ;Loop thru test for all items
"RTN","YTQPRT",16,0)
 S YSEQ=0 F  S YSEQ=$O(^YTT(601.76,"AD",YSCODEN,YSEQ)) Q:YSEQ'>0!(YSLFT)  S YSIEN=$O(^YTT(601.76,"AD",YSCODEN,YSEQ,0)) Q:YSIEN'>0!(YSLFT)  S YSNUMB=YSNUMB+1,YSR=0 D
"RTN","YTQPRT",17,0)
 . D:(($Y+5)>IOSL) WAIT
"RTN","YTQPRT",18,0)
 . S YSG=^YTT(601.76,YSIEN,0),YSQN=$P(YSG,U,4),YSQG2=$G(^YTT(601.72,YSQN,2)),YSRTYPE=$P(YSQG2,U,2)
"RTN","YTQPRT",19,0)
 . S YSQDISP=$P(YSG,U,6),YSIDISP=$P(YSG,U,7),YSCDISP=$P(YSG,U,8)
"RTN","YTQPRT",20,0)
 . D QOUT
"RTN","YTQPRT",21,0)
 . W:YSRTYPE'=1 !,$$GET1^DIQ(601.74,YSRTYPE_",",1)_":__________"
"RTN","YTQPRT",22,0)
 . S YSCTYPE=$P(YSQG2,U,3) Q:YSCTYPE=""  ;-->out
"RTN","YTQPRT",23,0)
 . S YSIDENT=$O(^YTT(601.89,"B",YSCTYPE,0)) S:YSIDENT'="" YSIDENT=$P($G(^YTT(601.89,YSIDENT,0)),U,2)
"RTN","YTQPRT",24,0)
 . S YSI=0 S YSCHTSEQ=0 F  S YSCHTSEQ=$O(^YTT(601.751,"AC",YSCTYPE,YSCHTSEQ)) Q:YSCHTSEQ'>0  S YSI=YSI+1 D
"RTN","YTQPRT",25,0)
 .. S YSCHOICE=$O(^YTT(601.751,"AC",YSCTYPE,YSCHTSEQ,0)) Q:YSCHOICE'>0  D
"RTN","YTQPRT",26,0)
 ... S YSCTEXT=$G(^YTT(601.75,YSCHOICE,1))
"RTN","YTQPRT",27,0)
 ... W !,"_____ ",$S(YSIDENT=0:YSI-1_".",YSIDENT="N":"",1:YSI_".")," ",YSCTEXT
"RTN","YTQPRT",28,0)
 K ^TMP($J,"YSG")
"RTN","YTQPRT",29,0)
 D ^%ZISC
"RTN","YTQPRT",30,0)
 Q
"RTN","YTQPRT",31,0)
QOUT ;pull text and intros
"RTN","YTQPRT",32,0)
 W !! ;,YSEQ,">> Question#"_YSQN
"RTN","YTQPRT",33,0)
 S YSINTRO=$P($G(^YTT(601.72,YSQN,2)),U)
"RTN","YTQPRT",34,0)
 I YSINTRO?1N.N S N1=0 F  S N1=$O(^YTT(601.73,YSINTRO,1,N1)) Q:N1'>0  W !,^YTT(601.73,YSINTRO,1,N1,0)
"RTN","YTQPRT",35,0)
 W !,YSNUMB,". " S N1=0 F  S N1=$O(^YTT(601.72,YSQN,1,N1)) Q:N1'>0  W:N1>1 ! W ^YTT(601.72,YSQN,1,N1,0)
"RTN","YTQPRT",36,0)
 Q
"RTN","YTQPRT",37,0)
PRTTEST ;print for developers
"RTN","YTQPRT",38,0)
 K DIC S DIC(0)="MAE",DIC="^YTT(601.71," D ^DIC Q:Y'>0
"RTN","YTQPRT",39,0)
 N YSLIMIT,YSCODE,YSCODEN,YSNUMB,YSG,YSIEN,YSOPER,YSQG2,YSERR,YSCTYPE,YSCHT,YSCHOICE,YSLEG,YSQN,YSNN
"RTN","YTQPRT",40,0)
 N DA,G,J,N,N1,YS1,YSCDISP,YSCHTSEQ,YSCTEXT,YSI,YSIDENT,YSDISP,YSINTRO,YSQDISP,YSR,YSRTYPE,YSSCALE,YSSCIEN,YSZ,YSEQ,YSIDISP,YSLFT,YSRPT
"RTN","YTQPRT",41,0)
EN1 ;
"RTN","YTQPRT",42,0)
 K IOP S %ZIS="Q" D ^%ZIS Q:POP  ;-->out
"RTN","YTQPRT",43,0)
 S YSCODEN=+Y,YSCODE=$P(^YTT(601.71,YSCODEN,0),U)
"RTN","YTQPRT",44,0)
 W @IOF,!?10,"*** ",YSCODE," ***",!
"RTN","YTQPRT",45,0)
 S DA=YSCODEN,DIC="^YTT(601.71," D EN^DIQ
"RTN","YTQPRT",46,0)
 S YSNUMB=0,YSLFT=""
"RTN","YTQPRT",47,0)
 D:(($Y+9)>IOSL) WAIT
"RTN","YTQPRT",48,0)
 Q:YSLFT
"RTN","YTQPRT",49,0)
 ;Loop thru test for all items
"RTN","YTQPRT",50,0)
 S YSEQ=0 F  S YSEQ=$O(^YTT(601.76,"AD",YSCODEN,YSEQ)) Q:YSEQ'>0!(YSLFT)  S YSIEN=$O(^YTT(601.76,"AD",YSCODEN,YSEQ,0)) Q:YSIEN'>0!(YSLFT)  S YSNUMB=YSNUMB+1,YSR=0 D
"RTN","YTQPRT",51,0)
 . D:(($Y+5)>IOSL) WAIT
"RTN","YTQPRT",52,0)
 . S YSG=^YTT(601.76,YSIEN,0),YSQN=$P(YSG,U,4),YSQG2=$G(^YTT(601.72,YSQN,2))
"RTN","YTQPRT",53,0)
 . S YSQDISP=$P(YSG,U,6),YSIDISP=$P(YSG,U,7),YSCDISP=$P(YSG,U,8)
"RTN","YTQPRT",54,0)
 . D GETTEXT
"RTN","YTQPRT",55,0)
 . S YSCTYPE=$P(YSQG2,U,3) Q:YSCTYPE=""  ;->out
"RTN","YTQPRT",56,0)
 . W !,"Choicetype: ",YSCTYPE
"RTN","YTQPRT",57,0)
 . W "  identifier: " I $D(^YTT(601.89,"B",YSCTYPE)) S YSIDENT=$O(^YTT(601.89,"B",YSCTYPE,0)) Q:YSIDENT=""  W $P($G(^YTT(601.89,YSIDENT,0)),U,2)
"RTN","YTQPRT",58,0)
 . D IENCK(YSCTYPE)
"RTN","YTQPRT",59,0)
 . S YSCHTSEQ=0 F  S YSCHTSEQ=$O(^YTT(601.751,"AC",YSCTYPE,YSCHTSEQ)) Q:YSCHTSEQ'>0  D
"RTN","YTQPRT",60,0)
 .. S YSCHOICE=$O(^YTT(601.751,"AC",YSCTYPE,YSCHTSEQ,0)) Q:YSCHOICE'>0  D
"RTN","YTQPRT",61,0)
 ... S YSCTEXT=$G(^YTT(601.75,YSCHOICE,1))
"RTN","YTQPRT",62,0)
 ... S YSLEG=$P($G(^YTT(601.75,YSCHOICE,0)),U,2)
"RTN","YTQPRT",63,0)
 ... W !,"# "_YSCHOICE_" Leg: "_YSLEG_"  "_YSCTEXT
"RTN","YTQPRT",64,0)
 Q:YSLFT  ;-->out
"RTN","YTQPRT",65,0)
 D SCALES
"RTN","YTQPRT",66,0)
 Q:YSLFT  ;-->out
"RTN","YTQPRT",67,0)
 D SKIP
"RTN","YTQPRT",68,0)
 Q:YSLFT  ;-->out
"RTN","YTQPRT",69,0)
 D RULESKIP
"RTN","YTQPRT",70,0)
 Q:YSLFT  ;-->out
"RTN","YTQPRT",71,0)
 D REPORT
"RTN","YTQPRT",72,0)
 K ^TMP($J,"YSG")
"RTN","YTQPRT",73,0)
 D ^%ZISC
"RTN","YTQPRT",74,0)
 Q
"RTN","YTQPRT",75,0)
GETTEXT ;pull text and intros
"RTN","YTQPRT",76,0)
 W !!,"<<",YSEQ,">> Question#"_YSQN,"     Display Q: ",YSQDISP,"  I: ",YSIDISP,"  C: ",YSCDISP
"RTN","YTQPRT",77,0)
 S YSINTRO=$P($G(^YTT(601.72,YSQN,2)),U)
"RTN","YTQPRT",78,0)
 I YSINTRO?1N.N W !,"Intro #"_YSINTRO S N1=0 F  S N1=$O(^YTT(601.73,YSINTRO,1,N1)) Q:N1'>0  W !,^YTT(601.73,YSINTRO,1,N1,0)
"RTN","YTQPRT",79,0)
 S N1=0 F  S N1=$O(^YTT(601.72,YSQN,1,N1)) Q:N1'>0  W !,^YTT(601.72,YSQN,1,N1,0)
"RTN","YTQPRT",80,0)
 Q
"RTN","YTQPRT",81,0)
SCALES ;scales
"RTN","YTQPRT",82,0)
 W !!!?5,"*** Scales ***",!
"RTN","YTQPRT",83,0)
 S YS1("CODE")=YSCODE D SCALEG^YTQAPI3(.YSZ,.YS1)
"RTN","YTQPRT",84,0)
 S N=1 F  S N=$O(^TMP($J,"YSG",N)) Q:N'>0!(YSLFT)  D
"RTN","YTQPRT",85,0)
 . D:(($Y+9)>IOSL) WAIT
"RTN","YTQPRT",86,0)
 . S G=^TMP($J,"YSG",N)
"RTN","YTQPRT",87,0)
 . I G'?1"Scale".E W !,"scale group: ",+$P(G,"=",2),"  ",$P(G,U,3) Q
"RTN","YTQPRT",88,0)
 . S YSSCALE=$P(G,U,4),YSSCIEN=$P($P(G,U,1),"=",2)
"RTN","YTQPRT",89,0)
 . W !,YSSCIEN,?10,YSSCALE
"RTN","YTQPRT",90,0)
 . Q:'$D(^YTT(601.91,"AC",YSSCIEN))
"RTN","YTQPRT",91,0)
 . W !?5,"#      Question     target           ADD"
"RTN","YTQPRT",92,0)
 . S J=0 F  S J=$O(^YTT(601.91,"AC",YSSCIEN,J)) Q:J'>0  S G=^YTT(601.91,J,0) W !?5,+G,?12,$P(G,U,3),"  ",$P(G,U,4),"   ",$P(G,U,5)
"RTN","YTQPRT",93,0)
 K ^TMP($J,"YSG")
"RTN","YTQPRT",94,0)
 Q
"RTN","YTQPRT",95,0)
SKIP ;skip questions
"RTN","YTQPRT",96,0)
 W !!!?5,"*** Skips ***",!
"RTN","YTQPRT",97,0)
 S N=0 F  S N=$O(^YTT(601.79,"AC",YSCODEN,N)) Q:N'>0!(YSLFT)  D
"RTN","YTQPRT",98,0)
 . D:(($Y+9)>IOSL) WAIT
"RTN","YTQPRT",99,0)
 .S G=^YTT(601.79,N,0)
"RTN","YTQPRT",100,0)
 . W !,"SkipID: "+$P(G,U)_"  RuleId: "_$P(G,U,3)_"  QuestionID: "_$P(G,U,4)
"RTN","YTQPRT",101,0)
 .S ^TMP($J,"YSG",$P(G,U,3))=""
"RTN","YTQPRT",102,0)
 Q
"RTN","YTQPRT",103,0)
RULESKIP ;rules that skip questions
"RTN","YTQPRT",104,0)
 S N=0 F  S N=$O(^TMP($J,"YSG",N)) Q:N'>1!(YSLFT)  D
"RTN","YTQPRT",105,0)
 . D:(($Y+9)>IOSL) WAIT
"RTN","YTQPRT",106,0)
 . W !
"RTN","YTQPRT",107,0)
 . S DA=N,DIC="^YTT(601.82," D EN^DIQ
"RTN","YTQPRT",108,0)
 Q
"RTN","YTQPRT",109,0)
REPORT ;display report setup
"RTN","YTQPRT",110,0)
 S YSRPT=$O(^YTT(601.93,"C",YSCODEN,0))
"RTN","YTQPRT",111,0)
 I YSRPT'>0 W !!,"REPORT: not defined",!! Q  ;-->out
"RTN","YTQPRT",112,0)
 W !!
"RTN","YTQPRT",113,0)
 S DA=YSRPT,DIC="^YTT(601.93," D EN^DIQ
"RTN","YTQPRT",114,0)
 Q
"RTN","YTQPRT",115,0)
IENCK(NN) ;check ien< 100,000
"RTN","YTQPRT",116,0)
 Q:YSCODEN>99999  ;-->out
"RTN","YTQPRT",117,0)
 S J=0 F  S J=$O(^YTT(601.751,"B",NN,J)) Q:J'>0  I J>99999 W !,"###### not national ######## ",^YTT(601.751,J,0) S ^TMP($J,"YSNATERR",NN,YSCODE)=""
"RTN","YTQPRT",118,0)
 Q
"RTN","YTQPRT",119,0)
WAIT ;
"RTN","YTQPRT",120,0)
 F I0=1:1:IOSL-$Y-4 W !
"RTN","YTQPRT",121,0)
 N DTOUT,DUOUT,DIRUT
"RTN","YTQPRT",122,0)
 I IOST?1"C".E S DIR(0)="E" D ^DIR K DIR S YSLFT=$D(DIRUT)
"RTN","YTQPRT",123,0)
 W @IOF Q
"RTN","YTQTUSE")
0^10^B8194860
"RTN","YTQTUSE",1,0)
YTQTUSE ;ASF/ALB- PSYCHOLOGICAL TEST USEAGE REPORTING ; 7/30/09 10:44am
"RTN","YTQTUSE",2,0)
 ;;5.01;MENTAL HEALTH;**87,97**;Dec 30, 1994;Build 42
"RTN","YTQTUSE",3,0)
 ;called as a server option from YTQTUSE
"RTN","YTQTUSE",4,0)
1 N YSB,YSY,DFN,YSTST,YSCOMP,N,N1,A,YSCPLETE,YSGIVEN,YSCODEN,YSAD,Y
"RTN","YTQTUSE",5,0)
 N XMA,XMDUZ,XMY,XMSUB,XMRG,XQSUB,XMTEXT
"RTN","YTQTUSE",6,0)
 K ^TMP($J,"YSTAT")
"RTN","YTQTUSE",7,0)
 S ^TMP($J,"YSTAT",1)=$$SITE^VASITE
"RTN","YTQTUSE",8,0)
 S XMA=1 X XMREC
"RTN","YTQTUSE",9,0)
 I XMRG="" S ^TMP($J,"YSTAT",12)="Dates can not be resolved" D SENDER Q  ;-->out
"RTN","YTQTUSE",10,0)
 S YSB=$P(XMRG,U),YSY=$P(XMRG,U,2)
"RTN","YTQTUSE",11,0)
 S ^TMP($J,"YSTAT",2)="From: "_YSB_" To: "_YSY
"RTN","YTQTUSE",12,0)
 S ^TMP($J,"YSTAT",3)=" "
"RTN","YTQTUSE",13,0)
TT ;test ck
"RTN","YTQTUSE",14,0)
 S N=20
"RTN","YTQTUSE",15,0)
 D STATS ;useage rollup
"RTN","YTQTUSE",16,0)
 S YSTST=0 F  S YSTST=$O(A(YSTST)) Q:YSTST'>0  D
"RTN","YTQTUSE",17,0)
 . S N=N+1
"RTN","YTQTUSE",18,0)
 . S ^TMP($J,"YSTAT",N)=+A(YSTST)_U_$P($G(^YTT(601.71,YSTST,0)),U)_U_YSTST_U_$$SITE^VASITE_U_A(YSTST)
"RTN","YTQTUSE",19,0)
SENDER ;
"RTN","YTQTUSE",20,0)
 S XMSUB="MHA3 Automated Usage Report"
"RTN","YTQTUSE",21,0)
 S XMY(XMFROM)=""
"RTN","YTQTUSE",22,0)
 S XMTEXT="^TMP($J,""YSTAT"","
"RTN","YTQTUSE",23,0)
 S XMDUZ="MH3 automated testing REPLY"
"RTN","YTQTUSE",24,0)
 N XMFROM,XMZ,XMREC,XMCHAN D ^XMD
"RTN","YTQTUSE",25,0)
 Q
"RTN","YTQTUSE",26,0)
STATS ;test count
"RTN","YTQTUSE",27,0)
 N YSHLSTAT,YSHLP K A
"RTN","YTQTUSE",28,0)
 S YSCODEN=0 F  S YSCODEN=$O(^YTT(601.84,"AC",YSCODEN)) Q:YSCODEN'>0  D
"RTN","YTQTUSE",29,0)
 . S YSGIVEN=YSB-.01
"RTN","YTQTUSE",30,0)
 . F  S YSGIVEN=$O(^YTT(601.84,"AC",YSCODEN,YSGIVEN)) Q:YSGIVEN'>0!(YSGIVEN>YSY)  D
"RTN","YTQTUSE",31,0)
 .. S YSAD=0
"RTN","YTQTUSE",32,0)
 .. F  S YSAD=$O(^YTT(601.84,"AC",YSCODEN,YSGIVEN,YSAD)) Q:YSAD'>0  D
"RTN","YTQTUSE",33,0)
 ... S YSCPLETE=$P(^YTT(601.84,YSAD,0),U,9)
"RTN","YTQTUSE",34,0)
 ... Q:YSCPLETE'="Y"  ;-->out
"RTN","YTQTUSE",35,0)
 ... S YSHLSTAT=$P($G(^YTT(601.84,YSAD,2)),U)
"RTN","YTQTUSE",36,0)
 ... S YSHLP=$S(YSHLSTAT="S":2,YSHLSTAT="E":3,YSHLSTAT="T":4,1:5)
"RTN","YTQTUSE",37,0)
 ... S $P(A(YSCODEN),U)=$P($G(A(YSCODEN)),U)+1
"RTN","YTQTUSE",38,0)
 ... S $P(A(YSCODEN),U,YSHLP)=$P(A(YSCODEN),U,YSHLP)+1
"RTN","YTQTUSE",39,0)
 Q
"RTN","YTQTUSE",40,0)
EN1 ;interactive login
"RTN","YTQTUSE",41,0)
 ;
"RTN","YTQTUSE",42,0)
 N DIR,YSB,YSY,YSCPLETE,A,B,YSINS,YSLFT
"RTN","YTQTUSE",43,0)
 S N=0,YSLFT=0
"RTN","YTQTUSE",44,0)
 K DIR S DIR(0)="DA^2961001:NOW:TX",DIR("A")="Begin date/time: ",DIR("B")="T-1M" D ^DIR
"RTN","YTQTUSE",45,0)
 Q:$D(DIRUT)
"RTN","YTQTUSE",46,0)
 S YSB=Y
"RTN","YTQTUSE",47,0)
 K DIR S DIR(0)="DA^2961001:NOW:TX",DIR("A")="End date/time: ",DIR("B")="NOW" D ^DIR
"RTN","YTQTUSE",48,0)
 Q:$D(DIRUT)
"RTN","YTQTUSE",49,0)
 S YSY=Y
"RTN","YTQTUSE",50,0)
 D STATS
"RTN","YTQTUSE",51,0)
 S YSTST=0 F  S YSTST=$O(A(YSTST)) Q:YSTST'>0  D
"RTN","YTQTUSE",52,0)
 . S N=N+1
"RTN","YTQTUSE",53,0)
 . S B($P($G(^YTT(601.71,YSTST,0)),U))=A(YSTST)
"RTN","YTQTUSE",54,0)
 . K A(YSTST)
"RTN","YTQTUSE",55,0)
 D ^%ZIS Q:POP  U IO
"RTN","YTQTUSE",56,0)
 W @IOF,!,"MHA3 Test Count from: "
"RTN","YTQTUSE",57,0)
 S Y=YSB D DD^%DT W Y
"RTN","YTQTUSE",58,0)
 S Y=YSY D DD^%DT W " to: ",Y
"RTN","YTQTUSE",59,0)
 W !,?5,"Count",?12,"Instrument",?60,"S E T ?"
"RTN","YTQTUSE",60,0)
 S YSINS=0
"RTN","YTQTUSE",61,0)
 F  S YSINS=$O(B(YSINS)) Q:YSINS=""!(YSLFT)  D
"RTN","YTQTUSE",62,0)
 . D:(($Y+5)>IOSL) WAIT
"RTN","YTQTUSE",63,0)
 . W !?5,$P(B(YSINS),U),?12,YSINS,?60,$P(B(YSINS),U,2,9)
"RTN","YTQTUSE",64,0)
 D ^%ZISC
"RTN","YTQTUSE",65,0)
 Q
"RTN","YTQTUSE",66,0)
WAIT ;
"RTN","YTQTUSE",67,0)
 F I0=1:1:IOSL-$Y-4 W !
"RTN","YTQTUSE",68,0)
 N DIR,DTOUT,DUOUT,DIRUT
"RTN","YTQTUSE",69,0)
 I IOST?1"C".E S DIR(0)="E" D ^DIR K DIR S YSLFT=$D(DIRUT)
"RTN","YTQTUSE",70,0)
 W @IOF Q
"VER")
8.0^22.0
**END**
**END**
