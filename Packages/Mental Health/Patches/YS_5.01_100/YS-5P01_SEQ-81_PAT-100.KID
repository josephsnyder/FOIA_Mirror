Released YS*5.01*100 SEQ #81
Extracted from mail message
**KIDS**:YS*5.01*100^

**INSTALL NAME**
YS*5.01*100
"BLD",7826,0)
YS*5.01*100^MENTAL HEALTH^0^3081112^y
"BLD",7826,1,0)
^^6^6^3081112^
"BLD",7826,1,1,0)
This patch removes some cross-references to field .53 (Progress
"BLD",7826,1,2,0)
Note Pointer) of file # 604 (Addiction Severity Index) that remained
"BLD",7826,1,3,0)
after the elimination of field .53 due to file restructuring.  A post-init
"BLD",7826,1,4,0)
routine (YS501P99) is used to remove these cross-references. This patch
"BLD",7826,1,5,0)
also replaces the term MHA3 in some prompts with the phrase 
"BLD",7826,1,6,0)
"MH administration/test".
"BLD",7826,4,0)
^9.64PA^^
"BLD",7826,6.3)
2
"BLD",7826,"ABPKG")
n
"BLD",7826,"INIT")
POST^YS501100
"BLD",7826,"KRN",0)
^9.67PA^8989.52^19
"BLD",7826,"KRN",.4,0)
.4
"BLD",7826,"KRN",.401,0)
.401
"BLD",7826,"KRN",.402,0)
.402
"BLD",7826,"KRN",.403,0)
.403
"BLD",7826,"KRN",.5,0)
.5
"BLD",7826,"KRN",.84,0)
.84
"BLD",7826,"KRN",3.6,0)
3.6
"BLD",7826,"KRN",3.8,0)
3.8
"BLD",7826,"KRN",9.2,0)
9.2
"BLD",7826,"KRN",9.8,0)
9.8
"BLD",7826,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",7826,"KRN",9.8,"NM",1,0)
YS501100^^0^B1123080
"BLD",7826,"KRN",9.8,"NM",2,0)
YTKIL^^0^B9102073
"BLD",7826,"KRN",9.8,"NM",3,0)
YTQKIL^^0^B5447693
"BLD",7826,"KRN",9.8,"NM","B","YS501100",1)

"BLD",7826,"KRN",9.8,"NM","B","YTKIL",2)

"BLD",7826,"KRN",9.8,"NM","B","YTQKIL",3)

"BLD",7826,"KRN",19,0)
19
"BLD",7826,"KRN",19.1,0)
19.1
"BLD",7826,"KRN",101,0)
101
"BLD",7826,"KRN",409.61,0)
409.61
"BLD",7826,"KRN",771,0)
771
"BLD",7826,"KRN",870,0)
870
"BLD",7826,"KRN",8989.51,0)
8989.51
"BLD",7826,"KRN",8989.52,0)
8989.52
"BLD",7826,"KRN",8994,0)
8994
"BLD",7826,"KRN","B",.4,.4)

"BLD",7826,"KRN","B",.401,.401)

"BLD",7826,"KRN","B",.402,.402)

"BLD",7826,"KRN","B",.403,.403)

"BLD",7826,"KRN","B",.5,.5)

"BLD",7826,"KRN","B",.84,.84)

"BLD",7826,"KRN","B",3.6,3.6)

"BLD",7826,"KRN","B",3.8,3.8)

"BLD",7826,"KRN","B",9.2,9.2)

"BLD",7826,"KRN","B",9.8,9.8)

"BLD",7826,"KRN","B",19,19)

"BLD",7826,"KRN","B",19.1,19.1)

"BLD",7826,"KRN","B",101,101)

"BLD",7826,"KRN","B",409.61,409.61)

"BLD",7826,"KRN","B",771,771)

"BLD",7826,"KRN","B",870,870)

"BLD",7826,"KRN","B",8989.51,8989.51)

"BLD",7826,"KRN","B",8989.52,8989.52)

"BLD",7826,"KRN","B",8994,8994)

"BLD",7826,"PRE")
YS501100
"BLD",7826,"QUES",0)
^9.62^^
"BLD",7826,"REQB",0)
^9.611^2^2
"BLD",7826,"REQB",1,0)
YS*5.01*82^2
"BLD",7826,"REQB",2,0)
YS*5.01*85^2
"BLD",7826,"REQB","B","YS*5.01*82",1)

"BLD",7826,"REQB","B","YS*5.01*85",2)

"INIT")
POST^YS501100
"MBREQ")
0
"PKG",159,-1)
1^1
"PKG",159,0)
MENTAL HEALTH^YS^Version 5.01 of Mental Health
"PKG",159,20,0)
^9.402P^^
"PKG",159,22,0)
^9.49I^1^1
"PKG",159,22,1,0)
5.01^2941230^2950325
"PKG",159,22,1,"PAH",1,0)
100^3081112
"PKG",159,22,1,"PAH",1,1,0)
^^6^6^3081112
"PKG",159,22,1,"PAH",1,1,1,0)
This patch removes some cross-references to field .53 (Progress
"PKG",159,22,1,"PAH",1,1,2,0)
Note Pointer) of file # 604 (Addiction Severity Index) that remained
"PKG",159,22,1,"PAH",1,1,3,0)
after the elimination of field .53 due to file restructuring.  A post-init
"PKG",159,22,1,"PAH",1,1,4,0)
routine (YS501P99) is used to remove these cross-references. This patch
"PKG",159,22,1,"PAH",1,1,5,0)
also replaces the term MHA3 in some prompts with the phrase 
"PKG",159,22,1,"PAH",1,1,6,0)
"MH administration/test".
"PRE")
YS501100
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","YS501100")
0^1^B1123080^n/a
"RTN","YS501100",1,0)
YS501100 ;BP/TMD,Post-init Routine for YS*5.01*100 ; 2/18/04 9:29am
"RTN","YS501100",2,0)
 ;;5.01;MENTAL HEALTH;**100**;Dec 30, 1994;Build 2
"RTN","YS501100",3,0)
 ;
"RTN","YS501100",4,0)
ENV ;Main entry point for Environment check point.
"RTN","YS501100",5,0)
 ;
"RTN","YS501100",6,0)
 S XPDABORT=""
"RTN","YS501100",7,0)
 D PROGCHK(.XPDABORT) ;checks programmer variables
"RTN","YS501100",8,0)
 I XPDABORT="" K XPDABORT
"RTN","YS501100",9,0)
 Q
"RTN","YS501100",10,0)
 ;
"RTN","YS501100",11,0)
POST ;Main entry point for Post-init items.
"RTN","YS501100",12,0)
 ;
"RTN","YS501100",13,0)
 ;Remove left over x-reference nodes from file restructuring
"RTN","YS501100",14,0)
 K ^DD(604,"B","PROGRESS NOTE POINTER",.53)
"RTN","YS501100",15,0)
 K ^DD(604,"GL",.5,3,.53)
"RTN","YS501100",16,0)
 Q
"RTN","YS501100",17,0)
 ;
"RTN","YS501100",18,0)
PROGCHK(XPDABORT) ;checks for necessary programmer variables
"RTN","YS501100",19,0)
 ;
"RTN","YS501100",20,0)
 I '$G(DUZ)!($G(DUZ(0))'="@")!('$G(DT))!($G(U)'="^") D
"RTN","YS501100",21,0)
 .D BMES^XPDUTL("*****")
"RTN","YS501100",22,0)
 .D MES^XPDUTL("Your programming variables are not set up properly.")
"RTN","YS501100",23,0)
 .D MES^XPDUTL("Installation aborted.")
"RTN","YS501100",24,0)
 .D MES^XPDUTL("*****")
"RTN","YS501100",25,0)
 .S XPDABORT=2
"RTN","YS501100",26,0)
 Q
"RTN","YTKIL")
0^2^B9102073^B8970368
"RTN","YTKIL",1,0)
YTKIL ;SLC/TGA-KILL TEST/INTERVIEW DATA ;4/21/92  08:50 ; 10/31/07 12:41pm
"RTN","YTKIL",2,0)
 ;;5.01;MENTAL HEALTH;**37,85,100**;Dec 30, 1994;Build 2
"RTN","YTKIL",3,0)
 ;
"RTN","YTKIL",4,0)
 ; Called from the top by MENU option YSMKIL
"RTN","YTKIL",5,0)
 ;
"RTN","YTKIL",6,0)
 S YSO=0,YSNOKILL=1 W @IOF,!!,"Delete Patient Data"
"RTN","YTKIL",7,0)
 W ! D ^YSLRP G:YSDFN<1 END
"RTN","YTKIL",8,0)
 S DIR(0)="Y",DIR("A")="Delete MH administration/test data",DIR("B")="No" D ^DIR
"RTN","YTKIL",9,0)
 Q:$G(DIRUT)
"RTN","YTKIL",10,0)
 IF Y D EN^YTQKIL Q  ;-->out
"RTN","YTKIL",11,0)
 I '$D(^YTD(601.2,YSDFN)),'$D(^YTD(601.4,YSDFN)) W !!,"NO DATA ON THIS PATIENT!" G END
"RTN","YTKIL",12,0)
R ;
"RTN","YTKIL",13,0)
 R !!,"Delete All tests and interviews? N// ",A:DTIME S YSTOUT='$T,YSUOUT=A["^" G:YSTOUT!YSUOUT END S A=$TR($E(A_"N"),"yn","YN") I "YN"'[A W:A'["?" " ?",$C(7) G R
"RTN","YTKIL",14,0)
 I "Y"[A S DIK="^YTD(601.2,",DA=YSDFN D ^DIK S DIK="^YTD(601.4,",DA=YSDFN D ^DIK W !!,"DELETED!" G END
"RTN","YTKIL",15,0)
 S T(0)=0 G:'$O(^YTD(601.4,YSDFN,1,0)) C W !!,"Incomplete tests and Interviews",! S YTC=$O(^YTT(601,"B","CLERK",0))
"RTN","YTKIL",16,0)
 S T=0
"RTN","YTKIL",17,0)
 F  S T=$O(^YTD(601.4,YSDFN,1,T)) G:'T C S T(0)=T(0)+1 G:YSTOUT!YSUOUT END S X=^(T,0),P=$P(X,U),D=$P(X,U,2),DA=P S:P=YTC P=$P(X,U,6),DA=YTC W !!,$$TN(+YSDFN,+T,+P),?10,$$FMTE^XLFDT(D,"5ZD") D DI
"RTN","YTKIL",18,0)
DI ;
"RTN","YTKIL",19,0)
 R " ...Delete? N// ",K:DTIME S YSTOUT='$T,YSUOUT=K["^",K=$E(K) Q:"Nn"[K  I YSTOUT!YSUOUT Q
"RTN","YTKIL",20,0)
 I "Yy"'[K W:K'["?" " ?",$C(7) G DI
"RTN","YTKIL",21,0)
 S DIK="^YTD(601.4,YSDFN,1,",DA(1)=YSDFN D ^DIK W ?40,"DELETED!" Q
"RTN","YTKIL",22,0)
C ;
"RTN","YTKIL",23,0)
 G:'$D(^YTD(601.2,YSDFN,1,0)) E W !!,"Completed Tests and Interviews"
"RTN","YTKIL",24,0)
 S T=0
"RTN","YTKIL",25,0)
 F  S T=$O(^YTD(601.2,YSDFN,1,T)) G:'T!YSUOUT END F D=0:0 S D=$O(^YTD(601.2,YSDFN,1,T,1,D)) Q:'D  S T(0)=T(0)+1 Q:YSTOUT!YSUOUT  Q:'$D(^YTT(601,T))  W !!,$P(^YTT(601,T,0),U),?10,$$FMTE^XLFDT(D,"5ZD") D DC
"RTN","YTKIL",26,0)
DC ;
"RTN","YTKIL",27,0)
 R " ...Delete? N// ",K:DTIME S YSTOUT='$T,YSUOUT=K["^",K=$E(K) Q:"Nn"[K  I YSTOUT!YSUOUT Q
"RTN","YTKIL",28,0)
 I "Yy"'[K W:K'["?" " ?",$C(7) G DC
"RTN","YTKIL",29,0)
 S DIK="^YTD(601.2,YSDFN,1,T,1,",DA=D,DA(1)=T,DA(2)=YSDFN D ^DIK W ?40,"DELETED" Q
"RTN","YTKIL",30,0)
E ;
"RTN","YTKIL",31,0)
 W:'T(0) !!,"NO TESTS/INTERVIEWS FOUND!"
"RTN","YTKIL",32,0)
END ;
"RTN","YTKIL",33,0)
 K %,A,D,DA,DIC,DIK,K,P,T,X,YSAGE,YSDFN,YSDOB,YSE,YSN,YSNM,YSNOKILL,YSO,YSS,YSSEX,YSSSN,YTC
"RTN","YTKIL",34,0)
 QUIT
"RTN","YTKIL",35,0)
 ;
"RTN","YTKIL",36,0)
TN(DFN,TN6014,TN601) ;Print test name...
"RTN","YTKIL",37,0)
 ; TN6014 = IEN of ^YTD(601.4,+DFN,1,+TN6014...
"RTN","YTKIL",38,0)
 ; TN601  = IEN of ^YTT(601,+TN601...
"RTN","YTKIL",39,0)
 N TESTNAME,X
"RTN","YTKIL",40,0)
 S X=$P($G(^YTT(601,+TN601,0)),U),TESTNAME=$S(X']"":"Unknown",1:X)
"RTN","YTKIL",41,0)
 I $G(^YTD(601.4,+DFN,1,+TN6014,99))'="MMPIR" QUIT TESTNAME ;->
"RTN","YTKIL",42,0)
 QUIT $S(TN601=60:"MMPIR",TN601=61:"MMPR",1:"Unknown") ;->
"RTN","YTKIL",43,0)
 ;
"RTN","YTQKIL")
0^3^B5447693^B5269849
"RTN","YTQKIL",1,0)
YTQKIL ;ASF/ALB MHA3 DELETES ; 10/31/07 12:54pm
"RTN","YTQKIL",2,0)
 ;;5.01;MENTAL HEALTH;**85,100**;Dec 30, 1994;Build 2
"RTN","YTQKIL",3,0)
 Q
"RTN","YTQKIL",4,0)
EN ;
"RTN","YTQKIL",5,0)
 N DIR,DIRUT,YS71,YSAD,YSANS,YSASNOW,YSGIVEN,YSORD,YSORDID,YSSITE,YSTST,G,N,X,YSGIVEFM
"RTN","YTQKIL",6,0)
 I '$D(^YTT(601.84,"C",YSDFN)) W !,"No MH administration/test data exists for this patient." H 4 Q
"RTN","YTQKIL",7,0)
 K YSDATA
"RTN","YTQKIL",8,0)
 S YS("DFN")=YSDFN,YS("COMPLETE")="Y" D ADMINS^YTQAPI5(.YSDATA,.YS)
"RTN","YTQKIL",9,0)
 S N=2 F  S N=$O(YSDATA(N)) Q:N'>0!($G(DIRUT))  D
"RTN","YTQKIL",10,0)
 . S G=YSDATA(N)
"RTN","YTQKIL",11,0)
 . S YSAD=$P(G,U) Q:YSAD'?1N.N  ;-->out
"RTN","YTQKIL",12,0)
 . S YSTST=$P(G,U,2)
"RTN","YTQKIL",13,0)
 . S YSGIVEN=$$GET1^DIQ(601.84,YSAD_",",3)
"RTN","YTQKIL",14,0)
 . S YSGIVEFM=$$GET1^DIQ(601.84,YSAD_",",3,"I")
"RTN","YTQKIL",15,0)
 . S YSGIVEFM=$$FMTHL7^XLFDT(YSGIVEFM)
"RTN","YTQKIL",16,0)
 . S YSORD=$$GET1^DIQ(601.84,YSAD_",",5)
"RTN","YTQKIL",17,0)
 . S YSORDID=$$GET1^DIQ(601.84,YSAD_",",5,"I")
"RTN","YTQKIL",18,0)
 . S YS71=$O(^YTT(601.71,"B",YSTST,0))
"RTN","YTQKIL",19,0)
 . W !,YSTST_" on "_YSGIVEN_" by "_YSORD
"RTN","YTQKIL",20,0)
 . S DIR(0)="Y",DIR("A")="Delete",DIR("B")="No" D ^DIR
"RTN","YTQKIL",21,0)
 . D:Y EMAIL,DEL
"RTN","YTQKIL",22,0)
 Q
"RTN","YTQKIL",23,0)
DEL ;delete admin
"RTN","YTQKIL",24,0)
 S DIR(0)="Y",DIR("A")="Are you sure",DIR("B")="No" D ^DIR
"RTN","YTQKIL",25,0)
 Q:'Y
"RTN","YTQKIL",26,0)
 K DIK
"RTN","YTQKIL",27,0)
 S DIK="^YTT(601.84,",DA=YSAD D ^DIK
"RTN","YTQKIL",28,0)
 S YSANS=0 F  S YSANS=$O(^YTT(601.85,"AD",YSAD,YSANS)) Q:YSANS'>0  D
"RTN","YTQKIL",29,0)
 . S DIK="^YTT(601.85,",DA=YSANS D ^DIK
"RTN","YTQKIL",30,0)
 W "  ***Deleted"
"RTN","YTQKIL",31,0)
 Q
"RTN","YTQKIL",32,0)
EMAIL ;send message
"RTN","YTQKIL",33,0)
 N XMDUZ,XMTEXT,XMY,XMZ,XMSUB
"RTN","YTQKIL",34,0)
 K ^TMP($J,"YTQKIL")
"RTN","YTQKIL",35,0)
 S YSSITE=$$KSP^XUPARAM("INST")
"RTN","YTQKIL",36,0)
 S ^TMP($J,"YTQKIL",1,0)="#Delete#"_U_YSSITE_U_YSAD_U_YSTST_U_YS71_U_YSGIVEN_U_YSGIVEFM_U_YSORD_U_YSORDID
"RTN","YTQKIL",37,0)
 S ^TMP($J,"YTQKIL",2,0)=" "
"RTN","YTQKIL",38,0)
 S ^TMP($J,"YTQKIL",3,0)="Please delete this entry."
"RTN","YTQKIL",39,0)
 ;
"RTN","YTQKIL",40,0)
XMIT ;transmit
"RTN","YTQKIL",41,0)
 K XMZ S %DT="T",X="NOW" D ^%DT,DD^%DT
"RTN","YTQKIL",42,0)
 S YSASNOW=Y
"RTN","YTQKIL",43,0)
 K XMY S XMY("mhadelete@mentalhealth.med.va.gov")=""
"RTN","YTQKIL",44,0)
 S XMDUZ=DUZ,XMTEXT="^TMP($J,""YTQKIL"",",XMSUB="Delete mha3 Admin from: "_YSSITE_" on "_YSASNOW D ^XMD
"RTN","YTQKIL",45,0)
 K ^TMP($J,"YTQKIL")
"RTN","YTQKIL",46,0)
 Q
"VER")
8.0^22.0
"BLD",7826,6)
^81
**END**
**END**
