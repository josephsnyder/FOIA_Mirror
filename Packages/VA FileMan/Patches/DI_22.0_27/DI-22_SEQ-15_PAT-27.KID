Released DI*22*27 SEQ #15
Extracted from mail message
**KIDS**:DI*22.0*27^

**INSTALL NAME**
DI*22.0*27
"BLD",63,0)
DI*22.0*27^VA FILEMAN^0^3000107^y
"BLD",63,1,0)
^^2^2^3000107^
"BLD",63,1,1,0)
See patch DI*22*27 in the National Patch Module for complete information
"BLD",63,1,2,0)
on this patch.
"BLD",63,4,0)
^9.64PA^^
"BLD",63,"KRN",0)
^9.67PA^19^15
"BLD",63,"KRN",.4,0)
.4
"BLD",63,"KRN",.401,0)
.401
"BLD",63,"KRN",.402,0)
.402
"BLD",63,"KRN",.403,0)
.403
"BLD",63,"KRN",.5,0)
.5
"BLD",63,"KRN",.84,0)
.84
"BLD",63,"KRN",3.6,0)
3.6
"BLD",63,"KRN",3.8,0)
3.8
"BLD",63,"KRN",9.2,0)
9.2
"BLD",63,"KRN",9.8,0)
9.8
"BLD",63,"KRN",9.8,"NM",0)
^9.68A^2^2
"BLD",63,"KRN",9.8,"NM",1,0)
DIKZ1^^0^B14104346
"BLD",63,"KRN",9.8,"NM",2,0)
DIKZ2^^0^B9360499
"BLD",63,"KRN",9.8,"NM","B","DIKZ1",1)

"BLD",63,"KRN",9.8,"NM","B","DIKZ2",2)

"BLD",63,"KRN",19,0)
19
"BLD",63,"KRN",19.1,0)
19.1
"BLD",63,"KRN",101,0)
101
"BLD",63,"KRN",409.61,0)
409.61
"BLD",63,"KRN",8994,0)
8994
"BLD",63,"KRN","B",.4,.4)

"BLD",63,"KRN","B",.401,.401)

"BLD",63,"KRN","B",.402,.402)

"BLD",63,"KRN","B",.403,.403)

"BLD",63,"KRN","B",.5,.5)

"BLD",63,"KRN","B",.84,.84)

"BLD",63,"KRN","B",3.6,3.6)

"BLD",63,"KRN","B",3.8,3.8)

"BLD",63,"KRN","B",9.2,9.2)

"BLD",63,"KRN","B",9.8,9.8)

"BLD",63,"KRN","B",19,19)

"BLD",63,"KRN","B",19.1,19.1)

"BLD",63,"KRN","B",101,101)

"BLD",63,"KRN","B",409.61,409.61)

"BLD",63,"KRN","B",8994,8994)

"BLD",63,"QUES",0)
^9.62^^
"BLD",63,"REQB",0)
^9.611^1^1
"BLD",63,"REQB",1,0)
DI*22.0*1^2
"BLD",63,"REQB","B","DI*22.0*1",1)

"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
VA FILEMAN^DI^FM INIT
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
22.0^2991209^2990828^12
"PKG",5,22,1,"PAH",1,0)
27^3000107
"PKG",5,22,1,"PAH",1,1,0)
^^2^2^3000107
"PKG",5,22,1,"PAH",1,1,1,0)
See patch DI*22*27 in the National Patch Module for complete information
"PKG",5,22,1,"PAH",1,1,2,0)
on this patch.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
2
"RTN","DIKZ1")
0^1^B14104346
"RTN","DIKZ1",1,0)
DIKZ1 ;SFISC/XAK-XREF COMPILER ;1:52 PM  7 Jan 2000
"RTN","DIKZ1",2,0)
 ;;22.0;VA FileMan;**1,27**;Mar 30, 1999
"RTN","DIKZ1",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","DIKZ1",4,0)
NEWR ;
"RTN","DIKZ1",5,0)
 K ^UTILITY($J) S DRN=""
"RTN","DIKZ1",6,0)
 S ^UTILITY($J,0,1)=DNM_" ; DRIVER FOR COMPILED XREFS FOR FILE #"_DH(1)_" ; "_$E(DT,4,5)_"/"_$E(DT,6,7)_"/"_$E(DT,2,3),^(2)=" ; "
"RTN","DIKZ1",7,0)
 S ^UTILITY($J,0,3)=" N DH,DU,DIKILL,DISET,DIKJ,DIKZ,DIKYR,DIKZA,DIK0Z,DIKZK,DIKDP,DIKM1,DIKUP,DIKUM,DV,DIIX,DIKF,DIAU,DIKNM,DIKDA,DIKLK,DIKLM,DIKY,DIXR,DIKCOND,DIKSVDA,DIKPUSH,X1,X2"
"RTN","DIKZ1",8,0)
 S ^UTILITY($J,0,4)=" I '$D(DIKSAT) S DIKLK=DIK_DA_"")"" L +@DIKLK:10 K:'$T DIKLK"
"RTN","DIKZ1",9,0)
 S ^UTILITY($J,0,5)=" D DI I '$D(DIKSAT),$D(DIKLK) L -@DIKLK"
"RTN","DIKZ1",10,0)
 S ^UTILITY($J,0,6)=" G Q"
"RTN","DIKZ1",11,0)
 S ^(7)="DI S DIKM1=0,DIKUM=0,DA(0)="""",DV=0 F  S DV=$O(DA(DV)) Q:DV'>0  S DIKUM=DIKUM+1,DIKUP(DV)=DA(DV)"
"RTN","DIKZ1",12,0)
 S ^(8)=" S:DV="""" DV=-1 S DH(1)="_DH(1)_",DIKUP=DA"
"RTN","DIKZ1",13,0)
 S ^(9)=" I $D(DIKKS) D:DIKZ1=DH(1) "_$P(DIKGO,",")_" S DA=DIKUP D:DIKZ1=DH(1) "_$P(DIKGO,",",2)_" D:DIKZ1'=DH(1) KILL D:DIKZ1'=DH(1) DA D:DIKZ1'=DH(1) SET D DA Q"
"RTN","DIKZ1",14,0)
 S ^(10)=" I $D(DIKIL) D:DIKZ1=DH(1) "_$P(DIKGO,",")_" S:DIKZ1=DH(1) DIKM1=1 D:DIKZ1'=DH(1) KILL S DA=DIKUP D:DIKM1>0 KIL1 D DA Q"
"RTN","DIKZ1",15,0)
 S ^(11)=" I $D(DIKST) D:DIKZ1=DH(1) "_$P(DIKGO,",",2)_" D:DIKZ1'=DH(1) SET D DA Q"
"RTN","DIKZ1",16,0)
 S ^(12)=" I $D(DIKSAT) D SET1 D DA Q"
"RTN","DIKZ1",17,0)
 S ^(13)=" Q"
"RTN","DIKZ1",18,0)
 S ^(14)="DA K DA F DV=1:1 Q:'$D(DIKUP(DV))  S DA(DV)=DIKUP(DV)"
"RTN","DIKZ1",19,0)
 S ^(15)=" S DA=DIKUP Q"
"RTN","DIKZ1",20,0)
 S ^(16)="SET1 S (DA,DCNT)=0"
"RTN","DIKZ1",21,0)
 S ^(17)=" S DU=$E(DIK,1,$L(DIK)-1),DIKLK=$S(DIK["","":DU_"")"",1:DU) L +@DIKLK:10 K:'$T DIKLK"
"RTN","DIKZ1",22,0)
 S ^(18)="C I @(""$O(""_DIK_""DA))'>0"") S DA=$$C1(DA),^(0)=$P(@(DIK_""0)""),U,1,2)_U_DA_U_DCNT K DCNT L:$D(DIKLK) -@DIKLK Q"
"RTN","DIKZ1",23,0)
 S ^(19)=" S (DIKY,DA)=$O(^(DA)) G C:$P($G(^(DA,0)),U)']"""" S DU=1,DCNT=DCNT+1 S:DA="""" (DIKY,DA)=-1 D:DIKZ1=DH(1) "_$P(DIKGO,",",2)_" D:DIKZ1'=DH(1) SET D:DIKZ1'=DH(1) DA K DB(0) S DA=DIKY G C"
"RTN","DIKZ1",24,0)
 S ^(20)=" Q"
"RTN","DIKZ1",25,0)
 S ^(21)="C1(A) Q:$P($G(@(DIK_""A,0)"")),U)]"""" A"
"RTN","DIKZ1",26,0)
 S ^(22)=" F  S @(""A=+$O(""_DIK_""A),-1)"") Q:$P($G(@(DIK_""A,0)"")),U)]""""!(A'>0)"
"RTN","DIKZ1",27,0)
 S ^(23)=" Q A"
"RTN","DIKZ1",28,0)
 S ^(24)="KILL S DIKILL=1,DIKZK=2",DIKR=24,X=2 D SUB
"RTN","DIKZ1",29,0)
 S DIKR=DIKR+1,^(DIKR)=" Q"
"RTN","DIKZ1",30,0)
 S DIKR=DIKR+1,^(DIKR)="SET S DISET=1,DIKZK=1 K DIKPUSH",X=1 D SUB
"RTN","DIKZ1",31,0)
 F DIK8=1:1 S DIKRT=$T(TEXT+DIK8) Q:DIKRT=""  S ^(DIKR+DIK8)=$E(DIKRT,4,999)
"RTN","DIKZ1",32,0)
 S (DRN,DIKR)="",T=0
"RTN","DIKZ1",33,0)
 F DIKZZ=0:0 S DIKZZ=$O(^UTILITY($J,0,DIKZZ)) Q:DIKZZ'>0  S %=^(DIKZZ),T=T+$L(%) I T>DMAX S DIKZOVFL=1 D OVFL^DIKZ11 Q
"RTN","DIKZ1",34,0)
 S T=0 I $D(DIKZOVFL) D SAVE^DIKZ K ^UTILITY($J,0) F DIKZZ=0:0 S DIKZZ=$O(^UTILITY($J,"OVFL",DIKZZ)) Q:DIKZZ'>0  S %=^(DIKZZ) S ^UTILITY($J,0,DIKZZ)=%
"RTN","DIKZ1",35,0)
 I $D(DIKZOVFL) S DRN=0 K ^UTILITY($J,"OVFL")
"RTN","DIKZ1",36,0)
 G SAVE^DIKZ
"RTN","DIKZ1",37,0)
 ;
"RTN","DIKZ1",38,0)
SUB F DIK8=0:0 S DIK8=$O(DIK(X,DIK8)) Q:DIK8'>0  S DIKR=DIKR+1,^(DIKR)=" I DIKZ1="_DIK8_","_$P(DIK2(DIK8),",",4)_" S "_$P(DIK2(DIK8),",",3)_" D "_DIK(X,DIK8)_" Q"
"RTN","DIKZ1",39,0)
 Q
"RTN","DIKZ1",40,0)
TEXT ;;
"RTN","DIKZ1",41,0)
 ;; Q
"RTN","DIKZ1",42,0)
 ;;KIL1 K @(DIK_"DA)") Q:'$D(^(0))
"RTN","DIKZ1",43,0)
 ;; S Y=^(0),DH=$S($O(^(0))'>0:0,1:$P(Y,U,4)-1),X=$P($P(Y,U,3),U,DH>0) D 3:X=DA
"RTN","DIKZ1",44,0)
 ;; S ^(0)=$P(Y,U,1,2)_U_X_U_DH
"RTN","DIKZ1",45,0)
 ;; Q
"RTN","DIKZ1",46,0)
 ;;Q K DIKGP,DIKZ1 Q
"RTN","DIKZ1",47,0)
 ;; ;
"RTN","DIKZ1",48,0)
 ;;3 I X>1,$D(^(X-1)) S X=X-1 Q
"RTN","DIKZ1",49,0)
 ;; S DV=1 F X=X:1 S X=X+DV,DV=DV+1 I $O(^(X))'>0 S DU=X-2,DV=1 Q
"RTN","DIKZ1",50,0)
 ;;L S X=$O(^(DU)) Q:X>0  S DU=DU-DV,DV=DV+1 S:DU<0 DU=0 G L
"RTN","DIKZ1",51,0)
 ;; Q
"RTN","DIKZ1",52,0)
 ;;BUL S DIKOZ=1,DIKZA=$P("CREA^DELE",U,DIKZK)_"TE VALUE"
"RTN","DIKZ1",53,0)
 ;; I $D(^DD(DIKZ1,DIKZZ,1,DIKZR,DIKZA)) W "...(`",^(DIKZA),"` BULLETIN WILL NOT BE TRIGGERED) " Q
"RTN","DIKZ2")
0^2^B9360499
"RTN","DIKZ2",1,0)
DIKZ2 ;SFISC/XAK-XREF COMPILER ;1:52 PM  7 Jan 2000
"RTN","DIKZ2",2,0)
 ;;22.0;VA FileMan;**27**;Mar 30, 1999
"RTN","DIKZ2",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","DIKZ2",4,0)
 S DIKR=DIKR+1
"RTN","DIKZ2",5,0)
 S DIK1=" I $D("_DIKVR_") K DIKLM S:DIKM1="_A_" DIKLM=1"
"RTN","DIKZ2",6,0)
 I A>1 D
"RTN","DIKZ2",7,0)
 . S DIK1=DIK1_" S:DIKM1'="_A_"&'$G(DIKPUSH("_A_")) DIKPUSH("_A_")=1,"
"RTN","DIKZ2",8,0)
 . F DIK4=A:-1:2 S DIK8=DIK4-1,DIK1=DIK1_"DA("_DIK4_")=DA("_DIK8_"),"
"RTN","DIKZ2",9,0)
 . S DIK1=DIK1_"DA(1)=DA,DA=0"
"RTN","DIKZ2",10,0)
 . F DIK4=2:1:A-1 S DIK1=DIK1_" S:DIKM1<"_DIK4_" DA("_(A-DIK4)_")=0"
"RTN","DIKZ2",11,0)
 S ^UTILITY($J,DIKR)=DIK1_" G @DIKM1"
"RTN","DIKZ2",12,0)
 S DIKR=DIKR+1,DIKCT=0 I A>1 D DAR
"RTN","DIKZ2",13,0)
 S ^UTILITY($J,DIKR)=A-1_" ;",DIKR=DIKR+1
"RTN","DIKZ2",14,0)
 D:DIKVR="DIKILL" WFK
"RTN","DIKZ2",15,0)
 S DIKCT=DIKCT+1,DIKL2=A-1,DIK1=$C(64+DIKCT)_" S DA=$O("_DIK2_DIK8(DH)_"DA))"
"RTN","DIKZ2",16,0)
 S ^UTILITY($J,DIKR)=DIK1_" I DA'>0 S DA=0 "_$S(DIKL2=0:"",1:"Q:DIKM1="_DIKL2_"  ")_"G "_$S(A'<2:$C(64+A-1),1:"END"),DIKR=DIKR+1
"RTN","DIKZ2",17,0)
 K DIK6
"RTN","DIKZ2",18,0)
 Q
"RTN","DIKZ2",19,0)
CRT ;
"RTN","DIKZ2",20,0)
 I '$D(^DD(DV,"IX")),'$D(^TMP("DIKC",$J,DV)) K DU(DV) Q
"RTN","DIKZ2",21,0)
 S DIK(X,DV)="",DIK4(DV)=DW,DIK2(DV)="DA("_A_"),,DIKM1="_A_",DIKUM'<"_A
"RTN","DIKZ2",22,0)
 I A=1 S DIK8(DV)=$P(DIK2(DV),",",1,2)_DIK4(DV)_","
"RTN","DIKZ2",23,0)
 E  I $D(DIK2(DH)) S DIKC=DV,DIK8(DV)="" F DIK8=1:1:A D
"RTN","DIKZ2",24,0)
 . S DIK8(DV)="DA("_DIK8_"),"_DIK4(DIKC)_","_DIK8(DV)
"RTN","DIKZ2",25,0)
 . S DIKC=^DD(DIKC,0,"UP")
"RTN","DIKZ2",26,0)
 Q
"RTN","DIKZ2",27,0)
DAR ;
"RTN","DIKZ2",28,0)
 S (DIKC,DIK1,%,DIKL2)=1,DIKQ=0
"RTN","DIKZ2",29,0)
 F DIK8=A-1:-1:1 S DIKC=DIKC+2,DIKCT=DIKCT+1,DIK4=" S DA("_DIK8_")=$O("_DIK2_$P(DIK8(DH),",",1,DIKC)_"))" S:'$D(%) ^UTILITY($J,DIKR)=DIKL2_" ;",DIKR=DIKR+1,DIKL2=DIKL2+1 K % D DAR2 K DIK1
"RTN","DIKZ2",30,0)
 Q
"RTN","DIKZ2",31,0)
DAR2 ;
"RTN","DIKZ2",32,0)
 S ^UTILITY($J,DIKR)=$C(64+DIKCT)_DIK4_" I DA("_DIK8_")'>0 S DA("_DIK8_")=0 "_$S($D(DIK6)&('$D(DIK1)):"Q:DIKM1="_DIKQ_"  ",1:"")_"G "_$S($D(DIK1):"END",1:$C(64+DIKCT-1)),DIKR=DIKR+1,DIKQ=DIKQ+1,DIK6=1
"RTN","DIKZ2",33,0)
 Q
"RTN","DIKZ2",34,0)
 ;
"RTN","DIKZ2",35,0)
WFK ;Get whole file kill xrefs
"RTN","DIKZ2",36,0)
 N DIKXR,DIKKW,DIKKW0,DIKCODE
"RTN","DIKZ2",37,0)
 S DIKXR=0 F  S DIKXR=$O(^TMP("DIKC",$J,"KW",DH,DIKXR)) Q:'DIKXR  D
"RTN","DIKZ2",38,0)
 . S DIKKW=$G(^TMP("DIKC",$J,"KW",DH,DIKXR))
"RTN","DIKZ2",39,0)
 . Q:DIKKW?."^"!(DIKKW="Q")
"RTN","DIKZ2",40,0)
 . S DIKKW0=$G(^TMP("DIKC",$J,"KW",DH,DIKXR,0))
"RTN","DIKZ2",41,0)
 . I DIKKW0="" D DOTLINE^DIKZ0(" "_DIKKW) Q
"RTN","DIKZ2",42,0)
 . Q:$P(DIKKW0,U)'="W"
"RTN","DIKZ2",43,0)
 . ;
"RTN","DIKZ2",44,0)
 . ;Build code to push down DA array
"RTN","DIKZ2",45,0)
 . S DIKCODE=$$BCPDA(A,$P(DIKKW0,U,2))
"RTN","DIKZ2",46,0)
 . I DIKCODE]"" D LINE^DIKZ0(" "_DIKCODE)
"RTN","DIKZ2",47,0)
 . D DOTLINE^DIKZ0(" "_DIKKW)
"RTN","DIKZ2",48,0)
 . I DIKCODE]"" D LINE^DIKZ0(" K DA M DA=DIKSVDA")
"RTN","DIKZ2",49,0)
 Q
"RTN","DIKZ2",50,0)
 ;
"RTN","DIKZ2",51,0)
BCPDA(LEV,RFILE) ;Build code to push down DA array
"RTN","DIKZ2",52,0)
 N DIFF,COD,I,RLEV
"RTN","DIKZ2",53,0)
 S RLEV=$$FLEV^DIKCU(RFILE)
"RTN","DIKZ2",54,0)
 S DIFF=RLEV-LEV
"RTN","DIKZ2",55,0)
 Q:DIFF<1 ""
"RTN","DIKZ2",56,0)
 ;
"RTN","DIKZ2",57,0)
 S COD=""
"RTN","DIKZ2",58,0)
 F I=RLEV:-1:DIFF S COD=COD_"DA("_I_")=DA("_(I-DIFF)_"),"
"RTN","DIKZ2",59,0)
 F I=DIFF-1:-1:0 S COD=COD_"DA("_I_")=0,"
"RTN","DIKZ2",60,0)
 I COD]"" D
"RTN","DIKZ2",61,0)
 . S COD=$E(COD,1,$L(COD)-1)
"RTN","DIKZ2",62,0)
 . F  Q:COD'["DA(0)"  S COD=$P(COD,"DA(0)")_"DA"_$P(COD,"DA(0)",2,999)
"RTN","DIKZ2",63,0)
 . S COD="K DIKSVDA M DIKSVDA=DA S "_COD
"RTN","DIKZ2",64,0)
 Q COD
"VER")
8.0^22.0
**END**
**END**
