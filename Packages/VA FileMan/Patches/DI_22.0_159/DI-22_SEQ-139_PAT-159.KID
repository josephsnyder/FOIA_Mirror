Released DI*22*159 SEQ #139
Extracted from mail message
**KIDS**:DI*22.0*159^

**INSTALL NAME**
DI*22.0*159
"BLD",748,0)
DI*22.0*159^VA FILEMAN^0^3080610^y
"BLD",748,1,0)
^^2^2^3080610^^^
"BLD",748,1,1,0)
See patch DI*22*159 in the National Patch Module on FORUM for complete
"BLD",748,1,2,0)
information on this patch.
"BLD",748,4,0)
^9.64PA^^
"BLD",748,6.3)
8
"BLD",748,"KRN",0)
^9.67PA^8989.52^19
"BLD",748,"KRN",.4,0)
.4
"BLD",748,"KRN",.401,0)
.401
"BLD",748,"KRN",.402,0)
.402
"BLD",748,"KRN",.403,0)
.403
"BLD",748,"KRN",.5,0)
.5
"BLD",748,"KRN",.84,0)
.84
"BLD",748,"KRN",3.6,0)
3.6
"BLD",748,"KRN",3.8,0)
3.8
"BLD",748,"KRN",9.2,0)
9.2
"BLD",748,"KRN",9.8,0)
9.8
"BLD",748,"KRN",9.8,"NM",0)
^9.68A^14^14
"BLD",748,"KRN",9.8,"NM",1,0)
DIE1^^0^B32974046
"BLD",748,"KRN",9.8,"NM",2,0)
DIA^^0^B17168950
"BLD",748,"KRN",9.8,"NM",3,0)
DIA1^^0^B10599883
"BLD",748,"KRN",9.8,"NM",4,0)
DIA3^^0^B16113145
"BLD",748,"KRN",9.8,"NM",5,0)
DIE^^0^B26226750
"BLD",748,"KRN",9.8,"NM",6,0)
DIE0^^0^B9621443
"BLD",748,"KRN",9.8,"NM",7,0)
DIETED^^0^B42722493
"BLD",748,"KRN",9.8,"NM",8,0)
DIEZ^^0^B18556993
"BLD",748,"KRN",9.8,"NM",9,0)
DIEZ0^^0^B17398012
"BLD",748,"KRN",9.8,"NM",10,0)
DIEZ2^^0^B48725159
"BLD",748,"KRN",9.8,"NM",11,0)
DIC5^^0^B8363930
"BLD",748,"KRN",9.8,"NM",12,0)
DIWE1^^0^B15137861
"BLD",748,"KRN",9.8,"NM",13,0)
DIC3^^0^B31837904
"BLD",748,"KRN",9.8,"NM",14,0)
DICM^^0^B32299770
"BLD",748,"KRN",9.8,"NM","B","DIA",2)

"BLD",748,"KRN",9.8,"NM","B","DIA1",3)

"BLD",748,"KRN",9.8,"NM","B","DIA3",4)

"BLD",748,"KRN",9.8,"NM","B","DIC3",13)

"BLD",748,"KRN",9.8,"NM","B","DIC5",11)

"BLD",748,"KRN",9.8,"NM","B","DICM",14)

"BLD",748,"KRN",9.8,"NM","B","DIE",5)

"BLD",748,"KRN",9.8,"NM","B","DIE0",6)

"BLD",748,"KRN",9.8,"NM","B","DIE1",1)

"BLD",748,"KRN",9.8,"NM","B","DIETED",7)

"BLD",748,"KRN",9.8,"NM","B","DIEZ",8)

"BLD",748,"KRN",9.8,"NM","B","DIEZ0",9)

"BLD",748,"KRN",9.8,"NM","B","DIEZ2",10)

"BLD",748,"KRN",9.8,"NM","B","DIWE1",12)

"BLD",748,"KRN",19,0)
19
"BLD",748,"KRN",19,"NM",0)
^9.68A^^
"BLD",748,"KRN",19.1,0)
19.1
"BLD",748,"KRN",101,0)
101
"BLD",748,"KRN",409.61,0)
409.61
"BLD",748,"KRN",771,0)
771
"BLD",748,"KRN",870,0)
870
"BLD",748,"KRN",8989.51,0)
8989.51
"BLD",748,"KRN",8989.52,0)
8989.52
"BLD",748,"KRN",8994,0)
8994
"BLD",748,"KRN","B",.4,.4)

"BLD",748,"KRN","B",.401,.401)

"BLD",748,"KRN","B",.402,.402)

"BLD",748,"KRN","B",.403,.403)

"BLD",748,"KRN","B",.5,.5)

"BLD",748,"KRN","B",.84,.84)

"BLD",748,"KRN","B",3.6,3.6)

"BLD",748,"KRN","B",3.8,3.8)

"BLD",748,"KRN","B",9.2,9.2)

"BLD",748,"KRN","B",9.8,9.8)

"BLD",748,"KRN","B",19,19)

"BLD",748,"KRN","B",19.1,19.1)

"BLD",748,"KRN","B",101,101)

"BLD",748,"KRN","B",409.61,409.61)

"BLD",748,"KRN","B",771,771)

"BLD",748,"KRN","B",870,870)

"BLD",748,"KRN","B",8989.51,8989.51)

"BLD",748,"KRN","B",8989.52,8989.52)

"BLD",748,"KRN","B",8994,8994)

"BLD",748,"MSC")
D:\R\DVA\GFTDI159B.KID
"BLD",748,"MSCOM")
INCLUDING DIWE1 FROM PATCH 158
"BLD",748,"PRE")
DI159ENV
"BLD",748,"QUES",0)
^9.62^^
"BLD",748,"REQB",0)
^9.611^5^5
"BLD",748,"REQB",1,0)
DI*22.0*60^0
"BLD",748,"REQB",2,0)
DI*22.0*70^0
"BLD",748,"REQB",3,0)
DI*22.0*95^0
"BLD",748,"REQB",4,0)
DI*22.0*111^0
"BLD",748,"REQB",5,0)
DI*22.0*149^0
"BLD",748,"REQB","B","DI*22.0*111",4)

"BLD",748,"REQB","B","DI*22.0*149",5)

"BLD",748,"REQB","B","DI*22.0*60",1)

"BLD",748,"REQB","B","DI*22.0*70",2)

"BLD",748,"REQB","B","DI*22.0*95",3)

"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
VA FILEMAN^DI^FM INIT
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
22.0^2990330^3080318^1163
"PKG",5,22,1,"PAH",1,0)
159^3080610^1163
"PKG",5,22,1,"PAH",1,1,0)
^^2^2^3080610
"PKG",5,22,1,"PAH",1,1,1,0)
See patch DI*22*159 in the National Patch Module on FORUM for complete
"PKG",5,22,1,"PAH",1,1,2,0)
information on this patch.
"PRE")
DI159ENV
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
15
"RTN","DI159ENV")
0^^B3745010^n/a
"RTN","DI159ENV",1,0)
DI159ENV ;IRMFO-SF/FM STAFF-ENVIRONMENT CHECK ROUTINE ;5:33 AM  18 Oct 2007
"RTN","DI159ENV",2,0)
 ;;22.0;VA FileMan;**159**;Mar 30, 1999;Build 8
"RTN","DI159ENV",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DI159ENV",4,0)
 ;
"RTN","DI159ENV",5,0)
 ; Check XPDENV 0 = Loading; 1 = Installing
"RTN","DI159ENV",6,0)
 I 'XPDENV Q  ; Loading Distribution - No Check
"RTN","DI159ENV",7,0)
 ;
"RTN","DI159ENV",8,0)
 ;
"RTN","DI159ENV",9,0)
INSCHK ; Do Checks During Install Only
"RTN","DI159ENV",10,0)
 W $C(7)
"RTN","DI159ENV",11,0)
 D MES^XPDUTL("** Although Queuing is allowed - it is HIGHLY recommended that ALL Users and")
"RTN","DI159ENV",12,0)
 D MES^XPDUTL("VISTA Background jobs be STOPPED before installation of this patch.  Failure")
"RTN","DI159ENV",13,0)
 D MES^XPDUTL("to do so may result in 'source routine edited' error(s). Edits will be")
"RTN","DI159ENV",14,0)
 D MES^XPDUTL("lost and record(s) may be left in an inconsistent state, for example,")
"RTN","DI159ENV",15,0)
 D MES^XPDUTL("not all Cross-Referencing completed; which in turn may cause FUTURE")
"RTN","DI159ENV",16,0)
 D MES^XPDUTL("VistA/FileMan Hard Errors or corrupted Data. **")
"RTN","DI159ENV",17,0)
 ;
"RTN","DI159ENV",18,0)
TMCHK ; Check to see if TaskMan is still running
"RTN","DI159ENV",19,0)
 S X=$$TM^%ZTLOAD
"RTN","DI159ENV",20,0)
 I X,'$D(^%ZTSCH("WAIT")) D
"RTN","DI159ENV",21,0)
 . W $C(7)
"RTN","DI159ENV",22,0)
 . D BMES^XPDUTL("* Warning TaskMan Has NOT Been Stopped or Placed in a WAIT State!")
"RTN","DI159ENV",23,0)
 ;
"RTN","DI159ENV",24,0)
LINH ; Check to see if Logons are Inhibited
"RTN","DI159ENV",25,0)
 D GETENV^%ZOSV  ; $P(Y,"^",2) = Installing Volume
"RTN","DI159ENV",26,0)
 S X=+$G(^%ZIS(14.5,"LOGON",$P(Y,"^",2)))
"RTN","DI159ENV",27,0)
 I 'X D
"RTN","DI159ENV",28,0)
 . W $C(7)
"RTN","DI159ENV",29,0)
 . D BMES^XPDUTL("* Warning Logons are NOT Inhibited!")
"RTN","DI159ENV",30,0)
 Q
"RTN","DIA")
0^2^B17168950^B13427002
"RTN","DIA",1,0)
DIA ;SFISC/GFT-SELECT FIELDS TO EDIT ;4JUNE2008
"RTN","DIA",2,0)
 ;;22.0;VA FileMan;**159**;Mar 30, 1999;Build 8
"RTN","DIA",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DIA",4,0)
 D DICS
"RTN","DIA",5,0)
1 D F W !?F*3,"EDIT WHICH "_X I $S(DB:DIAT="",1:1) R ": ALL// ",X:DTIME S:'$T X=U,DTOUT=1 G ALL^DIA1:X=""!(X="ALL"),TEMP^DIA1:X?1"[".E&'F,L
"RTN","DIA",6,0)
ED G NDB:DIAT=""
"RTN","DIA",7,0)
GDB S Y=$P(DIAT,";",DB) I "Q"[Y G NDB:Y="" D DB G GDB
"RTN","DIA",8,0)
 I Y?.NP,$P(Y,":",2),Y'["/" S Y=+Y_"-"_$P(Y,":",2)
"RTN","DIA",9,0)
 S %=$G(DI(DB,DIARTLVL-1,DI,DIAO)) I %]"" S Y=%
"RTN","DIA",10,0)
 E  I Y?1"^"1N1"."1.2N S DB=DB+1 G GDB ;WPB-0804-30857
"RTN","DIA",11,0)
 W ": "_Y D RW
"RTN","DIA",12,0)
 I X="" S X=Y I X="ALL" G ALL^DIA1
"RTN","DIA",13,0)
L S DSC=X?1"^".E I DSC S X=$E(X,2,999) I U[X K DR Q
"RTN","DIA",14,0)
 I $A(X)=64 G X:X'?1P.N,P:$L(X)>1,X:'DB S DB=DB+1 G 2
"RTN","DIA",15,0)
 K DIC,DIAB D DICS S DV="",J=$P(X,"-",2) I +J=J,$P(X,"-",1)=+X,J>X S D(F)=J K DA D RANGE^DIA1 K D S Y=DA G X:Y="" D DB G 2
"RTN","DIA",16,0)
DIC ;
"RTN","DIA",17,0)
 S DIC(0)="EZI",DIC="^DD(DI,",Y=-1 G X^DIA3:X[";" S DIC("W")="S %=$P(^(0),U,2) I % W $S($P(^DD(+%,.01,0),U,2)[""W"":""  (word-processing)"",1:""  (multiple)"")" D ^DIC Q:$D(DTOUT)
"RTN","DIA",18,0)
 I Y>0 D SET S Y=$P(Y(0),U,2) G 2:'Y S L=L+1,(DI,J(L))=+Y,I(L)=""""_$P($P(Y(0),U,4),";")_"""" G DOWN
"RTN","DIA",19,0)
 I $E(X)="]" S DRS=9,X=$E(X,2,999) G DIC:X]"",2
"RTN","DIA",20,0)
 G DIA^DIQQQ:X?."?" I $D(^DD(DI,"GR")) K Y S Y=-1 D:$L(X)<31
"RTN","DIA",21,0)
 . N I,DIGRP,DTOUT,DUOUT,DIRUT,DIROUT,DIYN S DIGRP=X,DIYN=0
"RTN","DIA",22,0)
 . D:$D(^DD(DI,"GR",DIGRP))  Q:DIYN  F  S DIGRP=$O(^DD(DI,"GR",DIGRP)) Q:$E(DIGRP,1,$L(X))'=X  D  Q:DIYN
"RTN","DIA",23,0)
 .. N X,I
"RTN","DIA",24,0)
 .. F I=0:0 S I=$O(^DD(DI,"GR",DIGRP,I)) Q:'I  I $G(^DD(DI,I,0))]"" S I(I)=I_U_$P(^(0),U)
"RTN","DIA",25,0)
 .. Q:'$O(I(0))
"RTN","DIA",26,0)
 .. W !!,"Fields in Group: ",DIGRP F I=0:0 S I=$O(I(I)) Q:'I  W !,?2,I,?10,$P(I(I),U,2)
"RTN","DIA",27,0)
 .. D  Q:DIYN'=1
"RTN","DIA",28,0)
 ... N X,Y S DIR(0)="Y",DIR("A")="Edit this GROUP of fields",DIR("B")="YES" D ^DIR S DIYN=$S(Y=1:1,$G(DIRUT):2,1:0) Q
"RTN","DIA",29,0)
 .. M Y=I S Y=0 Q
"RTN","DIA",30,0)
 . Q
"RTN","DIA",31,0)
 K DIYN G X^DIA3
"RTN","DIA",32,0)
 ;
"RTN","DIA",33,0)
F S X=$P(^DD(DI,0),U) I F,X="FIELD" S X=$O(^(0,"NM",0))_" "_X
"RTN","DIA",34,0)
 Q
"RTN","DIA",35,0)
 ;
"RTN","DIA",36,0)
X ;
"RTN","DIA",37,0)
 W $C(7),"??" D DICS
"RTN","DIA",38,0)
2 ;
"RTN","DIA",39,0)
 G 1:'$D(DR(F+1,DI)) D F W !?F*3,"THEN EDIT "_X G ED:DB
"RTN","DIA",40,0)
R R ": ",X:DTIME E  W $C(7) S X=U,DTOUT=1
"RTN","DIA",41,0)
 I X]"" G L
"RTN","DIA",42,0)
UP ;
"RTN","DIA",43,0)
 G ^DIA1:'F K I(L),J(L) S L=L-1 I '$D(J(L)) F L=L-99:1 Q:'$D(J(L+1))
"RTN","DIA",44,0)
 I DB S DB=DB(F),DIARTLVL=DIARTLVL(F),DIAO=DIAO(F),DIAT=$S(DIAO<0:"",DIAO:$G(^DIE(DIAA,"DR",DIARTLVL,J(L),DIAO)),$D(^DIE(DIAA,"DR",DIARTLVL,J(L))):^(J(L)),1:"")
"RTN","DIA",45,0)
 S DIARLVL=DIARLVL(F),DIAP=DIAP(F),DI=J(L),F=F-1 G 2
"RTN","DIA",46,0)
 ;
"RTN","DIA",47,0)
NDB I DB,DIAO'<0 S DIAO=DIAO+1 I $D(^DIE(DIAA,"DR",DIARLVL,DI,DIAO)) S DIAT=^(DIAO),DB=1 G GDB
"RTN","DIA",48,0)
 S DIAO=-1 G R
"RTN","DIA",49,0)
 ;
"RTN","DIA",50,0)
 ;
"RTN","DIA",51,0)
 ;
"RTN","DIA",52,0)
EN ;Entry point from DIB routine
"RTN","DIA",53,0)
 N DIARTLVL,DIARLVL,DIAL,DIESP,DRR D OS^DII:'$D(DISYS)
"RTN","DIA",54,0)
FILETOP D DICS ;Enter from DIA3 when there is a file jump
"RTN","DIA",55,0)
DOWN S F=F+1,DIAL(F)=+$G(DIAL),DIARLVL(F)=+$G(DIARLVL) F %=F+1:.01 I '$D(DR(%,DI)) Q  ;Find 2.01 if we have already gone down to DR(2,DI) -- WPB-0804-30857
"RTN","DIA",56,0)
 S:%["." @DRR=@DRR_U_%_";",DIAP=DIAP+1 S DIARLVL=%
"RTN","DIA",57,0)
 S DIAP(F)=DIAP,DIAP=0
"RTN","DIA",58,0)
 I DB S DIARTLVL(F)=DIARTLVL D  S DB(F)=DB,DB=1,DIAO(F)=DIAO,DIAO=0,DIAT=$G(^DIE(DIAA,"DR",DIARTLVL,DI)),DIARTLVL(DIARTLVL,DI)=""
"RTN","DIA",59,0)
 .S %=$P(DIAT,";",DB) I %?1"^"1.NP S DIARTLVL=$P(%,U,2),DB=DB+1 Q
"RTN","DIA",60,0)
 .F DIARTLVL=F+1:.01 I '$D(DIARTLVL(DIARTLVL,DI)) Q
"RTN","DIA",61,0)
 G 1:$P(^DD(DI,.01,0),U,2)'["W",1:L#100=0,UP
"RTN","DIA",62,0)
 ;
"RTN","DIA",63,0)
DICS ;
"RTN","DIA",64,0)
 S DIC("S")="I Y>.001,$P(^(0),U,2)'[""C"""_$S(DUZ(0)="@":"",1:",$P(^(0),U,2)'[""K""")_" Q:'$D(^(9))  I ^(9)'=U"_$S(DUZ(0)'="@":" F DW=1:1:$L(^(9)) I DUZ(0)[$E(^(9),DW) Q",1:"") Q
"RTN","DIA",65,0)
 ;
"RTN","DIA",66,0)
P ;
"RTN","DIA",67,0)
 S DRS=99,Y=X D DB G 2
"RTN","DIA",68,0)
 ;
"RTN","DIA",69,0)
SET S Y=+Y_DV
"RTN","DIA",70,0)
DB ;
"RTN","DIA",71,0)
 I DB,'DSC S DB=DB+1
"RTN","DIA",72,0)
D ;takes 'Y' and puts it into 'DR' array -- Also called from DIA3
"RTN","DIA",73,0)
 N %,B
"RTN","DIA",74,0)
 S (DRR,B)=$NA(DR(DIARLVL,DI)),%=$O(@DRR@(""),-1)
"RTN","DIA",75,0)
 I % S DRR=$NA(@DRR@(%))
"RTN","DIA",76,0)
 I '$D(@DRR) S @DRR="",DIAP=0
"RTN","DIA",77,0)
 E  I $L(Y)+$L(@DRR)>230 S DRR=$NA(@B@(%+1)),DIAP=DIAP\1000+1*1000,@DRR=""
"RTN","DIA",78,0)
 S @DRR=@DRR_Y_";",DRS=$G(DRS)+1
"RTN","DIA",79,0)
 S DIAP=DIAP+1
"RTN","DIA",80,0)
DIAB I $D(DIAB) S ^UTILITY($J,DIAP#1000,DIARLVL-1,DI,DIAP\1000)=DIAB K DIAB
"RTN","DIA",81,0)
 Q
"RTN","DIA",82,0)
 ;
"RTN","DIA",83,0)
RW I $L(Y)>19 D RW^DIR2 Q
"RTN","DIA",84,0)
 W "// " R X:DTIME I '$T S X=U,DTOUT=1 W $C(7)
"RTN","DIA1")
0^3^B10599883^B11942166
"RTN","DIA1",1,0)
DIA1 ;SFISC/GFT-PROCESS TEMPLATES, RANGES FOR INPUT ;20MAR2006
"RTN","DIA1",2,0)
 ;;22.0;VA FileMan;**159**;Mar 30, 1999;Build 8
"RTN","DIA1",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DIA1",4,0)
S D NOW^%DTC S DIADT=+$J(%,0,4) K %,DW G Q:DRS<5 R !,"STORE THESE FIELDS IN TEMPLATE: ",X:DTIME S:'$T DTOUT=1 G Q:X="" S DIC(0)="LZSEQ",DLAYGO=0 D T K DLAYGO,DIC I Y<0 G S:X'[U K DR G Q
"RTN","DIA1",5,0)
 S X=$P(^(0),U,6) I DUZ(0)'["@",X]"" F %=1:1 I DUZ(0)[$E(X,%) Q:%'>$L(X)  W !?7,$C(7),"YOU HAVE NO 'WRITE ACCESS' TO THIS TEMPLATE",! G S
"RTN","DIA1",6,0)
 S DW=$S('$D(^("ROU")):1,^("ROU")'[U:1,$D(^("ROUOLD")):^("ROUOLD"),1:1),%=0,X=$P(Y,U,2)
"RTN","DIA1",7,0)
 I $O(^(0))]"" W $C(7),!,X_" TEMPLATE ALREADY EXISTS.... OK TO REPLACE" D YN^DICN W ! G S:%-1 L +^DIE(+Y) S %Y="" F %X=0:0 S %Y=$O(^DIE(+Y,%Y)) Q:%Y=""  K:",%D,ROUOLD,W,"'[(","_%Y_",") ^(%Y)
"RTN","DIA1",8,0)
 S ^DIE(+Y,0)=X_U_DIADT_U_$S('%:DUZ(0),1:$P(Y(0),U,3))_U_DI_U_DUZ_U_$S('%:DUZ(0),1:$P(Y(0),U,6))_U_DT,^DIE("F"_DI,X,+Y)=1 L -^DIE(+Y)
"RTN","DIA1",9,0)
M S %X="DR(",%Y="^DIE(+Y,""DR""," D %XY^%RCR M ^DIE(+Y,"DIAB")=^UTILITY($J)
"RTN","DIA1",10,0)
 S X=DW,DP=DIA("P"),DMAX=^DD("ROU") I X'=1,$D(^DD("OS",DISYS,"ZS")) D EN^DIEZ S DR(1,DIA("P"))=U_DNM
"RTN","DIA1",11,0)
Q K DNM,DIAO,DI,DIAP,%,%I,DIADT,DIAT,DIE,DMAX,%X,%Y Q
"RTN","DIA1",12,0)
 ;
"RTN","DIA1",13,0)
ALL ;Called by DIETED, DIA
"RTN","DIA1",14,0)
 S %=DI,^UTILITY($J,1,F,%,DIAP\1000)="ALL" K DA D  G UP^DIA:F,S:$D(DRS) Q
"RTN","DIA1",15,0)
 .N DIA1 S DIA1=DIARLVL D A
"RTN","DIA1",16,0)
 ;
"RTN","DIA1",17,0)
RANGE ;called by DIA, DIE17, DIETED
"RTN","DIA1",18,0)
 N DIA1 S DIA1=F+1 S %=DI I X>0 S Y=X-.000001 G B
"RTN","DIA1",19,0)
A S Y=0
"RTN","DIA1",20,0)
B S DA="",X=0
"RTN","DIA1",21,0)
G S DG=Y
"RTN","DIA1",22,0)
DR S Y=$O(^DD(%,Y)) S:Y="" Y=-1 I $D(D(F)),Y'>0!(Y>D(F)) D DG:X Q
"RTN","DIA1",23,0)
 I Y'>0 D DG:X S:$D(DR(DIA1,%))[0 DR(DIA1,%)=DA Q
"RTN","DIA1",24,0)
 I $D(^(Y,0)),X X DIC("S") G G:$T D DG G DR
"RTN","DIA1",25,0)
 X DIC("S") E  G DR
"RTN","DIA1",26,0)
 S X=Y G G
"RTN","DIA1",27,0)
 ;
"RTN","DIA1",28,0)
DG S DA=DA_$E(";",1,$L(DA))_X_$P(":"_DG,U,X'=DG)
"RTN","DIA1",29,0)
 S DQ=0 F  S DQ=$O(^DD(%,"SB",DQ)) Q:DQ=""  S DP=$O(^(DQ,0)) I DP'<X,DP'>DG S Y(F,DQ)=""
"RTN","DIA1",30,0)
 S DQ=-1
"RTN","DIA1",31,0)
Y S X=$O(Y(F,0)) I X>0 K Y(F,X) S DA(F)=DA,Y(F)=Y,%(F)=%,F=F+1,DIA1=DIA1+1,%=X D A S F=F-1,DIA1=DIA1-1,%=%(F),Y=Y(F),DA=DA(F) G Y
"RTN","DIA1",32,0)
 S X="",DG=0 K DP Q
"RTN","DIA1",33,0)
 ;
"RTN","DIA1",34,0)
TEMP ;
"RTN","DIA1",35,0)
 S DIC(0)="ZSEQ" D T K DIC Q:$D(DTOUT)  G DB:Y<0
"RTN","DIA1",36,0)
 S %=$P(Y(0),U,6) G ED:DUZ(0)="@"!'$L(%) F X=1:1:$L(%) I DUZ(0)[$E(%,X) G ED
"RTN","DIA1",37,0)
GT I $G(^("ROU"))[U S DR(1,DIA("P"))=^("ROU")
"RTN","DIA1",38,0)
 E  S:$D(^("W")) DIE("W")=^("W") S %X="^DIE(+Y,""DR"",",%Y="DR(" D %XY^%RCR
"RTN","DIA1",39,0)
 S $P(^DIE(+Y,0),U,7)=DT
"RTN","DIA1",40,0)
 Q
"RTN","DIA1",41,0)
 ;
"RTN","DIA1",42,0)
T K DIC("W") S D="F"_DI,X=$P(X,"]",1),X=$P(X,"[",1)_$P(X,"[",2),DIC="^DIE(",DIC("S")="I $P(^(0),U,4)=DI"_$P(" S %=$P(^(0),U,3) F DW=1:1:$L(%) I DUZ(0)[$E(%,DW) Q",9,DUZ(0)'="@") G IX^DIC
"RTN","DIA1",43,0)
 ;
"RTN","DIA1",44,0)
ED I Y<1 G GT
"RTN","DIA1",45,0)
 S %=2 W !,"WANT TO EDIT '",$P(Y,U,2),"' INPUT TEMPLATE" D YN^DICN G GT:%-1
"RTN","DIA1",46,0)
 S DIE="^DIE(",DA=+Y,DR=".01;3;6" D ^DIE K DR I '$D(DA) S DB=0 G DB
"RTN","DIA1",47,0)
 S:$D(^DIE(DA,"DR"))#2 ^("DR",1,J(0))=^("DR")
"RTN","DIA1",48,0)
 S DIAA=DA,DRS=9,DIAT=$S($D(^DIE(DA,"DR",1,J(0))):^(J(0)),1:"")
"RTN","DIA1",49,0)
 M DI=^DIE(DA,"DIAB")
"RTN","DIA1",50,0)
 S F=0,(DIARTLVL,DB)=1,DIAO=0 F DXS=1:1 Q:'$D(DR(99,DXS))
"RTN","DIA1",51,0)
DB S DI=J(0) G ^DIA
"RTN","DIA3")
0^4^B16113145^B16115618
"RTN","DIA3",1,0)
DIA3 ;SFISC/GFT-UPDATE POINTERS, CHECK CODE IN INPUT STRING, CHECK FILE ACCESS ;19SEP2004
"RTN","DIA3",2,0)
 ;;22.0;VA FileMan;**159**;Mar 30, 1999;Build 8
"RTN","DIA3",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DIA3",4,0)
 S Y=DIA("P"),DH=1,DTO=DIA D PTS^DIT:'$D(^UTILITY("DIT",$J,0)) S ^UTILITY("DIT",$J,0)=0 Q:$D(^(0))<9
"RTN","DIA3",5,0)
 D ASK^DITP Q:%-1
"RTN","DIA3",6,0)
 S Y=0 I @("$O("_DIC_"0))'>0") G D
"RTN","DIA3",7,0)
C W !,"WHICH DO YOU WANT TO DO? --",!?4,"1) DELETE ALL SUCH POINTERS",!?4,"2) CHANGE ALL SUCH POINTERS TO POINT TO A DIFFERENT '"_$P(^(0),U,1)_"' ENTRY",!!,"CHOOSE 1) OR 2): " R %:DTIME G F:U[%,W:%=2,C:%'=1
"RTN","DIA3",8,0)
D W !,"DELETE ALL POINTERS" D YN^DICN G F:%<0,C:%-1,DITP
"RTN","DIA3",9,0)
W W !,"THEN PLEASE INDICATE WHICH ENTRY SHOULD BE POINTED TO" D L^DIA2 G DITP:Y>0
"RTN","DIA3",10,0)
F W $C(7),!,"OK... FORGET IT... LET'S GO ON TO EDIT ANOTHER ENTRY" Q
"RTN","DIA3",11,0)
DITP S (^UTILITY("DIT",$J,DIA(1)),^(DIA(1)_";"_$E(DIA,2,999)))=+Y_";"_$E(DIA,2,999)
"RTN","DIA3",12,0)
 W !?4,"("_$P("DELETION^RE-POINTING",U,''Y+1)_" WILL OCCUR WHEN YOU LEAVE 'ENTER/EDIT' OPTION)"
"RTN","DIA3",13,0)
 Q
"RTN","DIA3",14,0)
 ;
"RTN","DIA3",15,0)
FIXPT(DIFLG,DIFILE,DIDELIEN,DIPTIEN) ;DELETE OR REPOINT POINTERS
"RTN","DIA3",16,0)
 ;In V21, will just delete pointers.  Later, DIPTIEN will be record to repoint to.
"RTN","DIA3",17,0)
 ;DIFLG="D" (delete), DIFILE=File# previously pointed to, DIDELIEN=Record# previously pointed to, DIPTIEN=New pointed-to record(future)
"RTN","DIA3",18,0)
 N %X,%Y,X,Y,DIPTIEN,DIFIXPT,DIFIXPTC,DIFIXPTH D  I $G(X)]"" D BLD^DIALOG(201,X) Q
"RTN","DIA3",19,0)
 . S X="DIFLG" Q:$G(DIFLG)'="D"  S X="DIDELIEN" Q:'$G(DIDELIEN)  S X="DIFILE" Q:'$G(DIFILE)  Q:$G(^DIC(DIFILE,0,"GL"))=""
"RTN","DIA3",20,0)
 . S X="DIPTIEN" I $G(DIPTIEN) S Y=$G(^DD(DIFILE,0,"GL")) Q:Y=""  I '$D(@(Y_DIPTIEN_",0)")) Q
"RTN","DIA3",21,0)
 . K X Q
"RTN","DIA3",22,0)
 S DIPTIEN=+$G(DIPTIEN),(DIFIXPT,DIFIXPTC)=1
"RTN","DIA3",23,0)
 N %,BY,D,DHD,DHIT,DIA,DIC,DISTOP,DL,DR,DTO,FLDS,FR,IOP,L,TO,X,Y,Z K ^UTILITY("DIT",$J),^TMP("DIFIXPT",$J)
"RTN","DIA3",24,0)
 S (DIFILE,DIA("P"),Y)=+DIFILE,(DIA,DTO)=^DIC(DIFILE,0,"GL"),DIA(1)=DIDELIEN
"RTN","DIA3",25,0)
 D PTS^DIT S ^UTILITY("DIT",$J,0)=0 G:$D(^(0))<9 QFIXPT
"RTN","DIA3",26,0)
 S (^UTILITY("DIT",$J,DIA(1)),^(DIA(1)_";"_$E(DIA,2,999)))=DIPTIEN_";"_$E(DIA,2,999)
"RTN","DIA3",27,0)
 D P^DITP
"RTN","DIA3",28,0)
QFIXPT K ^UTILITY("DIT",$J),DIFLG,DIFILE,DIDELIEN,DIIOP,DIPTIEN Q
"RTN","DIA3",29,0)
 ;
"RTN","DIA3",30,0)
X ;
"RTN","DIA3",31,0)
 I 'Y S:'DSC&DB DB=DB+1 S Y=0 F  S Y=$O(Y(Y)) D D^DIA:Y'="" I Y="" S Y=-1 G 2^DIA
"RTN","DIA3",32,0)
 S Y=X I DUZ(0)="@",X'?.E1":" S X=$S(X["//^":$P(X,"//^",2),1:X),X=$S(X[";":$P(X,";"),1:X) D ^DIM G:$D(X) P^DIA:X=Y I Y["//^",'$D(X) G BAD
"RTN","DIA3",33,0)
 I Y[";" F %=2:1 S D=$P(Y,";",%) Q:D=""  S D=$S(D="DUP":"d",D="REQ":"R","""R""d"""[D:"",$A(D)=34:$E(D,2,$F(D,"""",2)-2),D="T":D,1:"") G BAD:D="",DIA3^DIQQQ:$A(D)>45&($A(D)<58)!(D[":") S DV=D_$C(126)_DV
"RTN","DIA3",34,0)
 I Y[";" S X=$P(Y,";",1) S:'$D(DIAB) DIAB=Y G DIC^DIA
"RTN","DIA3",35,0)
 F DK="///+","//+","///","//" I Y[DK S DP=$P(Y,DK,2,9) I DP'?1"/".E&(DP'?1"^".E)!(DUZ(0)="@") G DEF
"RTN","DIA3",36,0)
 G BAD:Y'?.E1":"
"RTN","DIA3",37,0)
E K X S:'$D(DIAB) DIAB=Y S DICOMP=L_"WE?",DQI="Y(",DA="DR(99,"_DXS_",",X=Y,DICMX=1 D ^DICOMPW I '$D(X) K DIAB G BAD:'$D(DP),ACC
"RTN","DIA3",38,0)
L I $D(X)>1 S DXS=DXS+1,%=0 F  S %=$O(X(%)) Q:%=""  S @(DA_"%)=X(%)")
"RTN","DIA3",39,0)
 S %=-1 S L=$S(Y>L:+Y,1:L\100+1*100),Y=U_DP_U_U_X_" S X=$S(D(0)>0:D(0),1:"""")",DRS=99 K X D DB^DIA S DI=+DP G FILETOP^DIA
"RTN","DIA3",40,0)
 ;
"RTN","DIA3",41,0)
DEF S X="DA,DV,DWLC,0)=X" F J=L:-1 Q:I(J)[U  S X="DA("_(L-J+1)_"),"_I(J)_","_X
"RTN","DIA3",42,0)
 S DICMX="S DWLC=DWLC+1,"_DIA_X,DA="DR(99,"_DXS_",",DHIT=Y,X=DP,DQI="X(",DICOMP=L_"T?" D EN^DICOMP,DICS^DIA,XEC K X S X=$P(DHIT,DK,1),DV=DV_DK_DP G DIC^DIA:DV'[";"
"RTN","DIA3",43,0)
BAD Q:$D(DTOUT)  G X^DIA
"RTN","DIA3",44,0)
ACC K DIAB W !?9,"YOU HAVE NO WRITE ACCESS TO FILE "_+DP G BAD
"RTN","DIA3",45,0)
 Q
"RTN","DIA3",46,0)
 ;
"RTN","DIA3",47,0)
XEC I $D(X),Y["m" S DIC("S")="S %=$P(^(0),U,2) I %,$D(^DD(+%,.01,0)),$P(^(0),U,2)[""W"",$D(^DD(DI,Y,0)) "_DIC("S")
"RTN","DIA3",48,0)
 S Y=0 F  S Y=$O(X(Y)) Q:Y=""  S @(DA_"Y)=X(Y)")
"RTN","DIA3",49,0)
 S Y=-1 I $D(X) S %=1,Y="DO YOU MEAN '"_DP_"' AS A VARIABLE" W !?63-$L(Y),Y D YN^DICN Q:%-1  S Y="Q",DXS=DXS+1,DP=U_X,DRS=99 D D^DIA:$S(DIAP:$P(DR(F+1,DI),";",DIAP#1000)'="Q",1:1) S:'$D(DIAB) DIAB=DHIT
"RTN","DIA3",50,0)
 Q:DP'="@"  I DK="//" S DA=U_U Q
"RTN","DIA3",51,0)
 W !,$C(7),"    WARNING: THIS MEANS AUTOMATIC DELETION!!"
"RTN","DIC3")
0^13^B31837904^B31344317
"RTN","DIC3",1,0)
DIC3 ;SFISC/XAK,TKW,SEA/TOAD-VA FileMan: Lookup, Part 1 (called from DIC) ;31JUL2007
"RTN","DIC3",2,0)
 ;;22.0;VA FileMan;**1,16,4,17,20,28,40,86,70,159**;Mar 30, 1999;Build 8
"RTN","DIC3",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DIC3",4,0)
 ;
"RTN","DIC3",5,0)
SEARCH ; Begin search through x-refs.
"RTN","DIC3",6,0)
 I DIC(0)["T",'$G(DICR) N:'$D(DICR(1)) DICR S DICR=0 D:DIC(0)["O"
"RTN","DIC3",7,0)
 . I DIC(0)'["X" S DIC(0)=DIC(0)_"X" Q
"RTN","DIC3",8,0)
 . S DIC(0)=$TR(DIC(0),"X") Q
"RTN","DIC3",9,0)
 I X?1"`".NP D ^DICM Q
"RTN","DIC3",10,0)
 I $L(X)>100,'$G(DILONGX) D ^DICM Q
"RTN","DIC3",11,0)
 N DIOK,DIEXACTN K % I $G(DISKIPIX)=D K DISKIPIX G M
"RTN","DIC3",12,0)
EXACT ; Find all exact matches to the lookup values
"RTN","DIC3",13,0)
 S DISAVDS=DS,DIEXACTN=0
"RTN","DIC3",14,0)
 I $G(DILONGX) G:$L(DICR(DICR,"ORG"))'>DINDEX(1,"LENGTH") M D
"RTN","DIC3",15,0)
 . S (X,X(1),DIVAL,DIVAL(1))=$E(DICR(DICR,"ORG"),1,DINDEX(1,"LENGTH")) Q
"RTN","DIC3",16,0)
 I DINDEX("#")>1,($G(DIALLVAL)!($G(DICR))),(DIC(0)["X"!(DIC(0)["O")) D EXACT^DIC4,SET^DIC4
"RTN","DIC3",17,0)
 I DINDEX("#")'>1 S Y=0,DIX=X F  D MOREX Q:Y=-1!(DS(0))
"RTN","DIC3",18,0)
 I DS(0) Q:DIC(0)'["T"  Q:$P(DS(0),U,2)'="U"!($G(DIROUT))  S DS(0)=0
"RTN","DIC3",19,0)
 I DIC(0)["T",DIC(0)["E",$G(DUOUT) D  ;22*70
"RTN","DIC3",20,0)
 . ; Set up variables for next index lookup
"RTN","DIC3",21,0)
 . K DS,DUOUT
"RTN","DIC3",22,0)
 . S (DS,DS(0),DS("DD"))=0
"RTN","DIC3",23,0)
 . S X=DIVAL(1)
"RTN","DIC3",24,0)
 . Q
"RTN","DIC3",25,0)
 I DISAVDS=0,DS=1,DIC(0)["O"!(DIC(0)'["E"),DIC(0)'["T" D  Q:Y>0!($D(DIROUT))  ;Good IEN returned or user bailed out
"RTN","DIC3",26,0)
 . I DINDEX("#")'>1,DIEXACTN>1,DINDEX'="B" S Y=-1 Q
"RTN","DIC3",27,0)
 . S Y=+DS(1),DS("DD")=1
"RTN","DIC3",28,0)
 . I DINDEX("#")'>1,DIEXACTN'>1 S DIY=1 D C^DIC2 Q
"RTN","DIC3",29,0)
 . D G^DIC2 Q
"RTN","DIC3",30,0)
 ;
"RTN","DIC3",31,0)
PARTIAL ; Find all partial matches to the lookup values
"RTN","DIC3",32,0)
 I DIC(0)'["X",DINDEX("#")>1 D PARTIAL^DIC4,SET^DIC4
"RTN","DIC3",33,0)
 I DIC(0)'["X",DINDEX("#")'>1 F  D  Q:$G(DIX)=""!(DS(0))
"RTN","DIC3",34,0)
 . N DITYP S DITYP=$G(DINDEX(1,"TYPE"))
"RTN","DIC3",35,0)
 . D
"RTN","DIC3",36,0)
 . . I DIC(0)["E",(DITYP["F"!(DITYP["S")) Q:DIC(0)["n"
"RTN","DIC3",37,0)
 . . I $TR(X,"-.")?.N,DO(2)'["D",'$D(DIDA) S DIX=$O(@(DIC_"D,DIX_"" "")"),-1)
"RTN","DIC3",38,0)
 . . Q
"RTN","DIC3",39,0)
 . S DIX=$O(@(DIC_"D,DIX)"))
"RTN","DIC3",40,0)
 . Q:DIX=""
"RTN","DIC3",41,0)
 . I $P(DIX,X)'="" D  Q:DIX=""
"RTN","DIC3",42,0)
 . . I +$P(X,"E")'=X!(DIC(0)'["E") S DIX="" Q
"RTN","DIC3",43,0)
 . . I DIC(0)'["n"!(DITYP'["F"&(DITYP'["S")) S DIX="" Q
"RTN","DIC3",44,0)
 . . D FINDMORE^DICLIX0(1,.DIX,X,.DINDEX)
"RTN","DIC3",45,0)
 . . S:$P(DIX,X)'="" DIX="" Q
"RTN","DIC3",46,0)
 . S Y=0 F  D MOREX Q:Y=-1!(DS(0))
"RTN","DIC3",47,0)
 . Q
"RTN","DIC3",48,0)
 I DS(0) Q:DIC(0)'["T"  Q:$P(DS(0),U,2)'="U"!($G(DIROUT))  S DS(0)=0
"RTN","DIC3",49,0)
 I DIC(0)["T",DIC(0)["E",$G(DUOUT) D  ;22*70
"RTN","DIC3",50,0)
 . ; Set up variables for next index lookup
"RTN","DIC3",51,0)
 . K DS,DUOUT
"RTN","DIC3",52,0)
 . S (DS,DS(0),DS("DD"))=0
"RTN","DIC3",53,0)
 . S X=DIVAL(1)
"RTN","DIC3",54,0)
 . Q
"RTN","DIC3",55,0)
 ;
"RTN","DIC3",56,0)
M ; Find the next index.  At end, display the rest
"RTN","DIC3",57,0)
 I DIC(0)["T" D KEEPON^DIC5 I DS(0) Q:$P(DS(0),U,2)'="U"!($G(DIROUT))
"RTN","DIC3",58,0)
 I DIC(0)["M" S DIOK=0 F  D  Q:DIOK
"RTN","DIC3",59,0)
 . N Y S Y=DINDEX("START") K DINDEX S DINDEX("WAY")=1,DINDEX("START")=Y,DINDEX("#")=1
"RTN","DIC3",60,0)
 . S (D,DINDEX)=$S($D(DID):$P(DID,U,DID(1)),1:$O(@(DIC_"D)")))
"RTN","DIC3",61,0)
 . S:$D(DID) DID(1)=DID(1)+1
"RTN","DIC3",62,0)
 . I D=""!(D=-1) S D="",DIOK=1 Q
"RTN","DIC3",63,0)
 . I $D(@(DIC_"D)"))-10 Q
"RTN","DIC3",64,0)
 . ; Check Index, build index info
"RTN","DIC3",65,0)
 . D IXCHK^DIC4(.DIFILEI,.DINDEX,.DIOK,.DIALLVAL,.DIVAL,$G(DID)) Q
"RTN","DIC3",66,0)
 I DIC(0)["M",D]"" G EXACT
"RTN","DIC3",67,0)
 D:DIC(0)["M" D^DIC0
"RTN","DIC3",68,0)
 I DS=1 S DS("DD")=1 D G^DIC2 Q
"RTN","DIC3",69,0)
 I DS D Y^DIC1 Q:DS(0)  I DINDEX("#")'>1 D:DO(2)["O"&(DO(2)'["A") L^DICM Q
"RTN","DIC3",70,0)
 I $G(DILONGX) S X=$E(DICR(DICR,"ORG"),1,30)
"RTN","DIC3",71,0)
 I DIC(0)["T",'$G(DICR),DIC(0)["O",DIC(0)["X" G SEARCH
"RTN","DIC3",72,0)
 I DINDEX("#")>1,'$G(DICR) D:DIC(0)["L"  D:Y=-1 BAD^DIC1 Q
"RTN","DIC3",73,0)
 . S Y=-1 I $G(DICR)="" N DICR S DICR=0
"RTN","DIC3",74,0)
 . I $A(X)=34,X?.E1"""" D N^DICM Q
"RTN","DIC3",75,0)
 . K DD D L^DICM Q
"RTN","DIC3",76,0)
 D ^DICM Q
"RTN","DIC3",77,0)
 ;
"RTN","DIC3",78,0)
 ;
"RTN","DIC3",79,0)
MOREX ; Find more exact matches to lookup value DIX
"RTN","DIC3",80,0)
 S Y=$O(@(DIC_"D,DIX,Y)")) I 'Y S Y=-1 Q
"RTN","DIC3",81,0)
 I $D(DIEXACTN)#2 S DIEXACTN=DIEXACTN+1
"RTN","DIC3",82,0)
 D MN Q:'$T  D K  Q:$G(DS(0))
"RTN","DIC3",83,0)
 I DS>1,DIC(0)'["E",DIC(0)'["Y" K DS S DS=0,DS(0)=1,Y=-1
"RTN","DIC3",84,0)
 Q
"RTN","DIC3",85,0)
 ;
"RTN","DIC3",86,0)
MN N DZ S DZ=$S((DIC(0)["D"&(DINDEX="B")):1,$G(DINDEX("#"))>1:0,$G(@(DIC_"D,DIX,Y)")):1,1:0) S DIYX=0
"RTN","DIC3",87,0)
 D:'$D(DO) GETFA^DIC1(.DIC,.DO)
"RTN","DIC3",88,0)
 I D="B",'DZ,'($D(@(DIC_"D,DIX,Y)"))#2) D
"RTN","DIC3",89,0)
 . N I S I=Y F  S DZ=$G(^(I)),I=$O(^(I,0)) Q:I=""
"RTN","DIC3",90,0)
 . Q
"RTN","DIC3",91,0)
 S DIY="" I '$D(@(DIC_"Y,0)")) X "I 0" Q
"RTN","DIC3",92,0)
 I D="B",'DZ,'$D(DO("SCR")),$L(DIX)<30,'$D(DIC("S")),'$D(@(DIC_"Y,-9)")),'$G(DINDEX("OLDSUB")) D ADDKEY I 1 Q
"RTN","DIC3",93,0)
 D S I  D
"RTN","DIC3",94,0)
 . I DINDEX("FLISTD")["^.01^",DINDEX("#")=1,'DZ,$P(DIY,DIX)="",'$G(DINDEX("OLDSUB")) D  Q
"RTN","DIC3",95,0)
 . . N I S I=$S($G(DILONGX):DICR(DICR,"ORG"),1:DIX)
"RTN","DIC3",96,0)
 . . S DIY=$P(DIY,I,2,9),DIYX=1 D ADDKEY Q
"RTN","DIC3",97,0)
 . Q:DIC(0)["Y"
"RTN","DIC3",98,0)
 . I ($G(DINDEX("#"))>1)!($G(DINDEX("OLDSUB"))) D  Q
"RTN","DIC3",99,0)
 . . D ADDIX^DIC4(.DIFILEI,Y,.DINDEX,.DIX,.DISCREEN)
"RTN","DIC3",100,0)
 . . D ADDKEY Q
"RTN","DIC3",101,0)
 . D ADDKEY
"RTN","DIC3",102,0)
 . I DINDEX("FLISTD")["^.01^",'DZ S DIY=""
"RTN","DIC3",103,0)
 . Q
"RTN","DIC3",104,0)
 Q
"RTN","DIC3",105,0)
 ;
"RTN","DIC3",106,0)
S D:'$D(DO) GETFA^DIC1(.DIC,.DO)
"RTN","DIC3",107,0)
 I $D(@(DIC_"Y,0)")),'$D(^(-9)) S DIY=$P(^(0),U)
"RTN","DIC3",108,0)
 E  S DIY="" Q
"RTN","DIC3",109,0)
 I '$D(DIC("S")),'$D(DO("SCR")) Q
"RTN","DIC3",110,0)
 I $G(DINDEX("#"))>1!($G(DINDEX("OLDSUB"))) Q
"RTN","DIC3",111,0)
 I $G(DILONGX) N DI0NODE,DIVAL D
"RTN","DIC3",112,0)
 . N % S %=DINDEX(1,"GET")
"RTN","DIC3",113,0)
 . I %="DIVAL=DINDEX(DISUB)" S DIVAL=X Q
"RTN","DIC3",114,0)
 . I %["DI0NODE" S DI0NODE=@(DIC_"Y,0)")
"RTN","DIC3",115,0)
 . N DIFILE S DIFILE=DIFILEI,DIFILE(DIFILE)=DIFILEI(DIFILEI)
"RTN","DIC3",116,0)
 . N DIEN S DIEN=Y_DIENS
"RTN","DIC3",117,0)
 . S @% Q
"RTN","DIC3",118,0)
 N DIAC,DIFILE,DISAVEX,DISAVEY,DISAVED
"RTN","DIC3",119,0)
 M DISAVEX=X,DISAVEY=Y S DISAVED=D I $D(@(DIC_"Y,0)"))
"RTN","DIC3",120,0)
 I $D(DIVAL(1)),$D(DIVAL)=10 S DIVAL=DIVAL(1) ;*159
"RTN","DIC3",121,0)
 I 1 X:$D(DIC("S")) DIC("S") K DIAC,DIFILE D:$D(DIC("S")) SX Q:'$T
"RTN","DIC3",122,0)
 I $D(DO("SCR")),$D(@(DIC_"Y,0)")) X DO("SCR") D SX Q:'$T
"RTN","DIC3",123,0)
 I 1 Q
"RTN","DIC3",124,0)
 ;
"RTN","DIC3",125,0)
SX M X=DISAVEX,Y=DISAVEY S D=DISAVED Q
"RTN","DIC3",126,0)
 ;
"RTN","DIC3",127,0)
ADDKEY ; Put KEY values into output array for display
"RTN","DIC3",128,0)
 S DIX("F")="" I DIC(0)'["U" S DIX("F")=$G(DINDEX("FLISTD"))
"RTN","DIC3",129,0)
 Q:'$D(DIFILEI(DIFILEI,"KEY"))  Q:DIC(0)["S"
"RTN","DIC3",130,0)
 N DIKX,DII,DIFLD,DIERR,I
"RTN","DIC3",131,0)
 M DIKX=DIFILEI(DIFILEI,"KEY",DIFILEI) Q:'$D(DIKX)
"RTN","DIC3",132,0)
 K DIX("K")
"RTN","DIC3",133,0)
 F I=0:0 S I=$O(DIKX(I)) Q:'I  F DIFLD=0:0 S DIFLD=$O(DIKX(I,DIFLD)) Q:'DIFLD  D
"RTN","DIC3",134,0)
 . I DIFLD=.01,$G(DZ)=0 S DIY=""
"RTN","DIC3",135,0)
 . S DIX("K",I,DIFLD)=$$GET1^DIQ(DIFILEI,Y_DIFILEI(DIFILEI,"KEY","IEN"),DIFLD,"","","DIERR") Q
"RTN","DIC3",136,0)
 Q
"RTN","DIC3",137,0)
 ;
"RTN","DIC3",138,0)
K ; Put an IEN into the DS array for display
"RTN","DIC3",139,0)
 N DZ,I S DZ=$O(DS(0)) F I=DZ:1:DS I +$G(DS(I))=Y,DIC(0)'["C" S I=-1 Q
"RTN","DIC3",140,0)
 I I'=-1,DIC(0)["T" D
"RTN","DIC3",141,0)
 . Q:'$D(^TMP($J,"DICSEEN",DIFILEI))
"RTN","DIC3",142,0)
 . I $D(^TMP($J,"DICSEEN",DIFILEI,Y)) S I=-1 Q
"RTN","DIC3",143,0)
 . S ^TMP($J,"DICSEEN",DIFILEI,Y)="" Q
"RTN","DIC3",144,0)
 I I=-1 S I=DIX K DIX S DIX=I,I=-1 Q
"RTN","DIC3",145,0)
 I DS-DZ>100 D
"RTN","DIC3",146,0)
 . N D1,D2 S D2=DZ+19 F D1=DZ:1:D2 K DS(D1),DIY(D1),DIYX(D1)
"RTN","DIC3",147,0)
 . Q
"RTN","DIC3",148,0)
 S DS=DS+1 D
"RTN","DIC3",149,0)
 . S I=DS M DS(DS)=DIX S DS=I,I=DIX K DIX S DIX=I
"RTN","DIC3",150,0)
 . S DS(DS)=Y_"^"_$P(DIX,X,2,99) Q
"RTN","DIC3",151,0)
 S DIY(DS)=DIY S:DIY]""&$G(DIYX) DIYX(DS)=1
"RTN","DIC3",152,0)
 I DS#5-1!(DS=1)!(DIC(0)["Y") Q
"RTN","DIC3",153,0)
 D Y^DIC1 Q
"RTN","DIC3",154,0)
 ;
"RTN","DIC3",155,0)
 ;
"RTN","DIC5")
0^11^B8363930^B8130256
"RTN","DIC5",1,0)
DIC5 ;SFISC/XAK,TKW,SEA/TOAD-VA FileMan: Lookup, Part 1 (utilities) ;05/28/2008
"RTN","DIC5",2,0)
 ;;22.0;VA FileMan;**4,20,31,70,159**;Mar 30, 1999;Build 8
"RTN","DIC5",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DIC5",4,0)
NODE75 ; Do after executing 7.5 node on DD, called from ^DIC
"RTN","DIC5",5,0)
 I $D(X)#2 S (DIVAL,DIVAL(1))=X Q
"RTN","DIC5",6,0)
 S Y=-1 Q:DIC(0)'["Q"!(DIC(0)'["E")
"RTN","DIC5",7,0)
 W $C(7) Q:$D(DDS)
"RTN","DIC5",8,0)
 W !,$$EZBLD^DIALOG(120,$$EZBLD^DIALOG(8090)) Q
"RTN","DIC5",9,0)
 ;
"RTN","DIC5",10,0)
BYIEN1 ; Lookup record by IEN when user enters `n for a number 'n', called from ^DIC
"RTN","DIC5",11,0)
 S Y=$E(X,2,30) I Y="" S Y=-1 Q
"RTN","DIC5",12,0)
 N % S %=DINDEX("START") N DINDEX S DINDEX="",DINDEX("#")=1,DINDEX("START")=%
"RTN","DIC5",13,0)
 D S^DIC3 I '$T S Y=-1 Q
"RTN","DIC5",14,0)
 N DD,DS,DZ S DS=1,DD=Y,DIX=X D ADDKEY^DIC3,GOT^DIC2
"RTN","DIC5",15,0)
 Q
"RTN","DIC5",16,0)
 ;
"RTN","DIC5",17,0)
BYIEN2 ; Lookup record by IEN when user enters a numeric lookup value, called from ^DIC
"RTN","DIC5",18,0)
 Q:DO(2)<0!($D(DF))
"RTN","DIC5",19,0)
 N T S T=DINDEX(1,"TYPE")
"RTN","DIC5",20,0)
 I $D(@(DIC_"X,0)")) D  Q:Y>0
"RTN","DIC5",21,0)
 . N DD S DD=$D(^DD(DIFILEI,.001))
"RTN","DIC5",22,0)
 . I 'DD Q:T["N"  I '$O(@(DIC_"""A["")")),$O(^("A["))]"" Q
"RTN","DIC5",23,0)
 . N % S %=DINDEX("START") N DINDEX S DINDEX="",DINDEX("#")=1,DINDEX("START")=%
"RTN","DIC5",24,0)
 . S Y=X D S^DIC3 I '$T S Y=-1 Q
"RTN","DIC5",25,0)
 . N DZ,DS,DIX,DIC5D S DIC5D=D,DS=1,DIX=X D ADDKEY^DIC3,GOT^DIC2 Q:Y>0
"RTN","DIC5",26,0)
 . D DO^DIC1 S D=DIC5D
"RTN","DIC5",27,0)
 I T["P"!(T["V"),DIC(0)'["U" S DISKIPIX=D
"RTN","DIC5",28,0)
 Q
"RTN","DIC5",29,0)
 ;
"RTN","DIC5",30,0)
SPACEBAR ; Lookup last record selected by this user when user enters space bar return.  Called from ^DIC
"RTN","DIC5",31,0)
 N % S %=DINDEX("START") N DINDEX S DINDEX="",DINDEX("#")=1,DINDEX("START")=%
"RTN","DIC5",32,0)
 D S^DIC3 I '$T S Y=-1 Q
"RTN","DIC5",33,0)
 N DZ,DS,DIX S DS=1,DIX=X D ADDKEY^DIC3,GOT^DIC2 Q
"RTN","DIC5",34,0)
 ;
"RTN","DIC5",35,0)
KEEPON ; If DIC(0)["T", display entries found so far, then check for internal value if index is date, set, pointer, VP.  Called from ^DIC3.
"RTN","DIC5",36,0)
 I DS D  Q:Y>0!($G(DTOUT))!($G(DIROUT))
"RTN","DIC5",37,0)
 . N I M I=X N X M X=I S I=D N D S D=I K I
"RTN","DIC5",38,0)
 . I DS=1 D
"RTN","DIC5",39,0)
 . . S DS("DD")=1 D G^DIC2 Q
"RTN","DIC5",40,0)
 . E  I $G(DS("DD"))'=DS D Y^DIC1 I '$D(DIROUT),$D(DUOUT) K DUOUT ;22*70
"RTN","DIC5",41,0)
 . K DD,DS,DIX,DIYX S (DD,DS,DS("DD"))=0
"RTN","DIC5",42,0)
 . S:DIC(0)["E" DS(0,"HDRDSP",DIFILEI)=1
"RTN","DIC5",43,0)
 . S DS(0)=$S(Y>0:"1^"_+Y,$G(DTOUT):"1^T",$G(DIROUT):"1^U",1:0)
"RTN","DIC5",44,0)
 . Q
"RTN","DIC5",45,0)
 Q:DIC(0)["U"  I DINDEX=DINDEX("START"),$G(DINDEX("#"))>1 Q
"RTN","DIC5",46,0)
 N I M I=X N X M X=I S I=D N D S D=I K I
"RTN","DIC5",47,0)
 D 1^DICM
"RTN","DIC5",48,0)
 K DD,DS,DIX,DIYX S (DD,DS,DS("DD"))=0
"RTN","DIC5",49,0)
 S DS(0)=$S(Y>0:"1^"_+Y,$G(DTOUT):"1^T",$G(DIROUT):"1^U",1:0)
"RTN","DIC5",50,0)
 Q
"RTN","DIC5",51,0)
 ;
"RTN","DIC5",52,0)
PTRID(DO,DIC) ; Build code in DIC("W") to display Identifiers on pointed-to files
"RTN","DIC5",53,0)
 N DIFILEI,DIGBL,DIOGBL S DIFILEI=+DO(2),DIOGBL=DIC
"RTN","DIC5",54,0)
 F  S DIFILEI=+$P($P($G(^DD(DIFILEI,.01,0)),U,2),"P",2) Q:'DIFILEI  S DIGBL=$G(^DIC(DIFILEI,0,"GL")) Q:DIGBL=""  D Q
"RTN","DIC5",55,0)
 Q
"RTN","DIC5",56,0)
Q ; Build Identifier code for a single pointed-to file
"RTN","DIC5",57,0)
 N DIGBL1 S DIGBL1=DIGBL
"RTN","DIC5",58,0)
 I DIGBL[$C(34) S DIGBL1=$$CONVQQ^DILIBF(DIGBL)
"RTN","DIC5",59,0)
 N N,O,% S N=$O(DIC("W",999999),-1)
"RTN","DIC5",60,0)
 S O=$S(N:DIC("W",N),1:DIC("W"))
"RTN","DIC5",61,0)
 N % S %="I '$G(DICR) S DIEN=+"_DIOGBL_"DIEN,0) I $D("_DIGBL_"DIEN,0)) S DIFILEI="_DIFILEI_",DIGBL="""_DIGBL1_""" D WOV^DICQ1"
"RTN","DIC5",62,0)
 S DIOGBL=DIGBL
"RTN","DIC5",63,0)
 I ($L(O)+$L(%))<230 D  Q
"RTN","DIC5",64,0)
 . I 'N S DIC("W")=DIC("W")_" "_% Q
"RTN","DIC5",65,0)
 . S DIC("W",N)=DIC("W",N)_" "_% Q
"RTN","DIC5",66,0)
 S N=N+1,DIC("W",N)=%
"RTN","DIC5",67,0)
 I N=1 S DIC("W")=DIC("W")_" X DIC(""W"",1)" Q
"RTN","DIC5",68,0)
 S DIC("W",N-1)=DIC("W",N-1)_" X DIC(""W"","_N_")"
"RTN","DIC5",69,0)
 Q
"RTN","DIC5",70,0)
 ;
"RTN","DICM")
0^14^B32299770^B29790678
"RTN","DICM",1,0)
DICM ;SFISC/GFT,XAK,TKW-MULTIPLE LOOKUP FOR FLDS WHICH MUST BE TRANSFORMED ;4AUG2007
"RTN","DICM",2,0)
 ;;22.0;VA FileMan;**4,20,31,40,149,159**;Mar 30, 1999;Build 8
"RTN","DICM",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DICM",4,0)
 I '$D(DICR(1)),DIC(0)'["T" N DICR S DICR=0
"RTN","DICM",5,0)
 I $A(X)=34,X?.E1"""" G N
"RTN","DICM",6,0)
 I $G(^DD(+DO(2),0,"LOOK"))]"",^("LOOK")'="SOUNDEX" G @^("LOOK")
"RTN","DICM",7,0)
 I DIC(0)["U" S DD=0 G W
"RTN","DICM",8,0)
 I DIC(0)["T" G 2
"RTN","DICM",9,0)
R N DIFLAGS S DIFLAGS="4l"_$P("M^",U,DIC(0)["M")
"RTN","DICM",10,0)
 N DIFORCE D
"RTN","DICM",11,0)
 . S DIFORCE=0 I DIC(0)'["M"!($D(DID)) S DIFORCE=1
"RTN","DICM",12,0)
 . S DIFORCE(0)=$S(DIC(0)'["M":DINDEX,$D(DID):DID,1:"*"),DIFORCE(1)=1
"RTN","DICM",13,0)
 F  D 1 I DINDEX=""!(Y>0)!($G(DTOUT))!($G(DIROUT)) Q
"RTN","DICM",14,0)
 G 2
"RTN","DICM",15,0)
 ;
"RTN","DICM",16,0)
1 N DS,%Y,DIV
"RTN","DICM",17,0)
 I $G(DINDEX("IXFILE")) S Y=DINDEX(1,"FILE"),%Y=DINDEX(1,"FIELD")
"RTN","DICM",18,0)
 E  S Y=$O(^DD(+DO(2),0,"IX",DINDEX,0)) S:Y="" Y=-1 S %Y=+$O(^(Y,0))
"RTN","DICM",19,0)
 I Y=-1,DINDEX="B" S Y=+DO(2),%Y=.01
"RTN","DICM",20,0)
 S:Y="" Y=-1 S:%Y="" %Y=-1
"RTN","DICM",21,0)
 I $D(DICR(U,Y,%Y,DINDEX)) S Y=-1
"RTN","DICM",22,0)
 E  I %Y=.01,DINDEX'="B",Y=+DO(2),$D(DICR(U,Y,%Y,"B")),$G(DINDEX(1,"TRANCODE"))="" S Y=-1
"RTN","DICM",23,0)
 I Y'<0 D
"RTN","DICM",24,0)
 . S DS=$G(^DD(Y,%Y,0)) I DS="" S Y=-1 Q
"RTN","DICM",25,0)
 . S %=DINDEX,DICR(U,Y,%Y,DINDEX)=0
"RTN","DICM",26,0)
 . I $D(^DD(Y,%Y,7)) D RS K DS X ^(7) Q
"RTN","DICM",27,0)
 . I $G(DINDEX("IXTYPE"))="S" D A,SOU^DICM1,D Q:Y>0  S Y=-1 Q
"RTN","DICM",28,0)
 . S DIX=Y,Y=$P(DS,U,2)
"RTN","DICM",29,0)
 . S Y=$S(Y["P":"P",Y["D":"D",Y["S":"S",Y["V":"V",1:"")
"RTN","DICM",30,0)
 . I Y]"" D A D:'Y ^DICM1,D Q:Y>0  S Y=-1 Q
"RTN","DICM",31,0)
 . I $G(DINDEX(1,"TRANCODE"))]"" S Y="T" D A,^DICM1 N DITRANX S DITRANX=1 D D
"RTN","DICM",32,0)
 . Q:Y>0  S Y=-1 Q
"RTN","DICM",33,0)
 Q:Y>0!(DIC(0)["T")  D
"RTN","DICM",34,0)
 . K DIV M DIV=X S DIV(1)=X N X,Y
"RTN","DICM",35,0)
 . D NXTINDX^DICF2(.DINDEX,.DIFORCE,.DIFILEI,DIFLAGS,.DIV,"*") Q
"RTN","DICM",36,0)
 Q
"RTN","DICM",37,0)
 ;
"RTN","DICM",38,0)
2 D D^DIC0 S %=D
"RTN","DICM",39,0)
 G K:Y>0!($G(DIROUT))
"RTN","DICM",40,0)
 I X?.E1L.E,DIC(0)'["X" D  G K:$G(DIROUT)
"RTN","DICM",41,0)
 . D % N DIFILEI,DINDEX
"RTN","DICM",42,0)
 . S DIC(0)=$TR(DIC(0),"L"),X=$$UP^DILIBF(X) S:$G(DILONGX) DICR(DICR,"ORG")=X
"RTN","DICM",43,0)
 . D DIC Q
"RTN","DICM",44,0)
 I Y'>0,X["," S DS="",DIX=$P(X,",") I DIC(0)'["X",$L(DIX)<31 D  G K:$G(DIROUT) ;COMMA-PIECING
"RTN","DICM",45,0)
 . F %=2:1 S DD=$P(X,",",%) I DD'["""" D  Q:DD=""
"RTN","DICM",46,0)
 . . F  Q:$A(DD)-32  S DD=$E(DD,2,999)
"RTN","DICM",47,0)
 . . F  Q:$A(DD,$L(DD))-32  S DD=$E(DD,1,$L(DD)-1)
"RTN","DICM",48,0)
 . . I $L(DD)*2+$L(DS)>200!(DD="") S DD="" Q
"RTN","DICM",49,0)
 . . S DS=DS_" I %?.E1P1"""_DD_""".E!(D'=""B""&(%?1"""_DD_""".E))" Q
"RTN","DICM",50,0)
 . Q:DS=""  S %=D
"RTN","DICM",51,0)
 . D % S X=DIX N DILONGX
"RTN","DICM",52,0)
 . S DS="S %=$P(^(0),U)"_DS,DIC(0)=DIC(0)_"D" D 7 Q
"RTN","DICM",53,0)
 I Y'>0,$L(X)>30 D
"RTN","DICM",54,0)
 . N DILONGX S DILONGX=1
"RTN","DICM",55,0)
 . S %=D D % S Y="DICR("_DICR_")",DICR(DICR,"ORG")=X
"RTN","DICM",56,0)
 . S DS=$S(DIC(0)["X":"I DIVAL="_Y,1:"I '$L($P(DIVAL,"_Y_"))")
"RTN","DICM",57,0)
 . S:DIC(0)["O"&(DIC(0)'["E") DS=DS_",'$L($P(DIVAL,"_Y_",2))"
"RTN","DICM",58,0)
 . D 7 I Y>0!(X'?.E1L.E)!(DIC(0)["X") K DILONGX Q
"RTN","DICM",59,0)
 . S %=D D % S (X,DICR(DICR,"ORG"))=$$UP^DILIBF(X)
"RTN","DICM",60,0)
 . S Y="DICR("_DICR_",""ORG"")"
"RTN","DICM",61,0)
 . S DS="I '$L($P(DIVAL,"_Y_"))" S:DIC(0)["O"&(DIC(0)'["E") DS=DS_",'$L($P(DIVAL,"_Y_",2))"
"RTN","DICM",62,0)
 . D 7 K DILONGX Q
"RTN","DICM",63,0)
 ;
"RTN","DICM",64,0)
K S DICR=+$G(DICR),DD=$D(DICR(DICR,6)) K:'DICR DICR
"RTN","DICM",65,0)
 I Y>0 K DIC("W") D R^DIC2 Q
"RTN","DICM",66,0)
 I $G(DTOUT)!($G(DIROUT)) Q
"RTN","DICM",67,0)
W I @("$O("_DIC_"""A[""))]""""") G NL:DIC(0)["N",DD
"RTN","DICM",68,0)
 I DO(2)'["Z" S Y=0 D  Q:Y>0!($G(DIROUT))
"RTN","DICM",69,0)
DINUM .I $G(DINDEX("1","FIELD"))=.01,X?1.15NP,$P($G(^DD(+DO(2),.01,0)),U,5,99)["DINUM=X",$D(@(DIC_"X,0)")) D  Q:Y>0
"RTN","DICM",70,0)
 ..S Y=X I 1 X:$D(DIC("S")) DIC("S") I  S DIY="",DS=1 N DZ,DD D ADDKEY^DIC3,GOT^DIC2 Q
"RTN","DICM",71,0)
 ..S Y=0
"RTN","DICM",72,0)
 .N DIOUT S DIOUT=0 F DS=1:1 S @("Y=$O("_DIC_"Y))") D  Q:DIOUT
"RTN","DICM",73,0)
 . . I 'Y S Y=-1,DIOUT=1 Q
"RTN","DICM",74,0)
 . . W:DIC(0)["E"&(DS#20=0) ".."
"RTN","DICM",75,0)
 . . I $D(@(DIC_Y_",0)")),$P(^(0),U)=X X:$D(DIC("S")) DIC("S") I  S DIOUT=1
"RTN","DICM",76,0)
 . . I DIOUT S DIY="",DS=1 N DZ,DD D ADDKEY^DIC3,GOT^DIC2
"RTN","DICM",77,0)
 . . Q
"RTN","DICM",78,0)
NL I '$G(DICR) D NQ I $T D  Q:Y>0!($G(DTOUT))!($G(DIROUT))
"RTN","DICM",79,0)
 . N:'$G(DIASKOK) DIASKOK S (DS,DIASKOK)=1 N DZ,DD
"RTN","DICM",80,0)
 . D ADDKEY^DIC3,GOT^DIC2 Q
"RTN","DICM",81,0)
DD S Y=-1 I DD D BAD^DIC1 Q
"RTN","DICM",82,0)
L I DIC(0)["L" K DD G ^DICN
"RTN","DICM",83,0)
B D BAD^DIC1 Q
"RTN","DICM",84,0)
 ;
"RTN","DICM",85,0)
N D RS S X=$E(X,2,$L(X)-1),%=D D
"RTN","DICM",86,0)
 . I DINDEX("#")>1 S %Y=+$G(DINDEX(1,"FIELD")),DS=$G(^DD(+$G(DINDEX(1,"FILE")),%Y,0)) Q:DS]""
"RTN","DICM",87,0)
 . S DS=^DD(+DO(2),.01,0),%Y=.01 Q
"RTN","DICM",88,0)
 F Y="P","D","S","V" I $P(DS,U,2)[Y K:Y="P" DO D ^DICM1 S:$D(X)#2 DS("INT")=X Q
"RTN","DICM",89,0)
 I $D(X),DINDEX("#")>1 S X(1)=X
"RTN","DICM",90,0)
 S Y=-1 D L:$D(X),E
"RTN","DICM",91,0)
 I Y'>0 K DUOUT D BAD^DIC1 Q
"RTN","DICM",92,0)
 G 2
"RTN","DICM",93,0)
 ;
"RTN","DICM",94,0)
A ; Set variables needed for transforming date/set/ptr/var.ptr
"RTN","DICM",95,0)
 S DICR(DICR+1,4)=%
"RTN","DICM",96,0)
 D % K DF,DID,DINUM Q
"RTN","DICM",97,0)
 ;
"RTN","DICM",98,0)
% ; Set variables up before doing lookup w/transformed value
"RTN","DICM",99,0)
 I DIC(0)'["L" S DICR(DICR+1,8)=1
"RTN","DICM",100,0)
 E  I '$$OKTOADD^DICM0(.DIFILEI,.DINDEX,.DIFINDER) S DICR(DICR+1,8)=1
"RTN","DICM",101,0)
 I $G(DINUM)]"" S DICR(DICR+1,10)=DINUM
"RTN","DICM",102,0)
 I $D(DF) S DICR(DICR+1,9)=DF S:$G(DID)]"" DICR(DICR+1,9.1)=$G(DID(1))_U_DID
"RTN","DICM",103,0)
RS S DICR=DICR+1,DICR(DICR)=X,DICR(DICR,0)=DIC(0),DIC(0)=$TR(DIC(0),"A"),DIC(0)=$TR(DIC(0),"Q") Q
"RTN","DICM",104,0)
 ;
"RTN","DICM",105,0)
D S:$G(DICR(DICR,10))]"" DINUM=DICR(DICR,10)
"RTN","DICM",106,0)
 S (D,DF)=DICR(DICR,4) D
"RTN","DICM",107,0)
 . N T S T=$P($G(DS),U,2)
"RTN","DICM",108,0)
 . S DIC(0)=$TR(DIC(0),"M","") I T["V" S DIC(0)=$TR(DIC(0),"A","")
"RTN","DICM",109,0)
 . I D="B",T'["D",'$G(DITRANX) S DIC(0)=DIC(0)_"s"
"RTN","DICM",110,0)
 . I T["P"!(T["V")!(T["S") S DIC(0)=DIC(0)_"X"
"RTN","DICM",111,0)
 . Q
"RTN","DICM",112,0)
 I DICR(DICR,4)=DINDEX N I M I=DINDEX N DINDEX M DINDEX=I K I S DINDEX("START")=DINDEX
"RTN","DICM",113,0)
 E  N DINDEX D
"RTN","DICM",114,0)
 . S (DINDEX,DINDEX("START"))=DICR(DICR,4),DINDEX("WAY")=1
"RTN","DICM",115,0)
 . D INDEX^DICUIX(.DIFILEI,DIFLAGS,.DINDEX,"",.DIVALUE) Q
"RTN","DICM",116,0)
 I DINDEX("#")>1 S (DINDEX(1),DINDEX(1,"FROM"),DINDEX(1,"PART"))=$G(X)
"RTN","DICM",117,0)
RCR S:'$D(DIDA) DICRS=1
"RTN","DICM",118,0)
DIC ;
"RTN","DICM",119,0)
 I $D(DICR(DICR,8)) S DIC(0)=$TR(DIC(0),"L")
"RTN","DICM",120,0)
 S Y=-1 I $D(X) D  ;*159  WAS: I $D(X),$L(X)<31 D
"RTN","DICM",121,0)
 . N DIVAL S (DIVAL,DIVAL(1))=X N X S (X,X(1))=DIVAL
"RTN","DICM",122,0)
 . D RENUM^DIC1 K DIDA Q
"RTN","DICM",123,0)
 S:DIC(0)["L" DICR(DICR-1,6)=1 K:$D(DICR(DICR,4)) DF
"RTN","DICM",124,0)
E S D="B" Q:'$G(DICR)  ;**GFT
"RTN","DICM",125,0)
 S %=DICR,X=DICR(%),DIC(0)=DICR(%,0),DICR=%-1
"RTN","DICM",126,0)
 S:$G(DICR(%,10))]"" DINUM=DICR(%,10)
"RTN","DICM",127,0)
 S:$D(DICR(%,9)) (D,DF)=DICR(%,9) I $G(DICR(%,9.1))]"" S:$P(DICR(%,9.1),U)]"" DID(1)=$P(DICR(%,9.1),U) S DID=$P(DICR(%,9.1),U,2,999)
"RTN","DICM",128,0)
 K DICRS,DICR(%) D DO^DIC1:'$D(DO(2)) Q
"RTN","DICM",129,0)
 ;
"RTN","DICM",130,0)
NQ I $L(X)<14,X?.NP,+X=X,@("$D("_DIC_"X,0))") S Y=X D S^DIC3
"RTN","DICM",131,0)
 Q
"RTN","DICM",132,0)
 ;
"RTN","DICM",133,0)
SOUNDEX I DIC(0)["E",'$D(DICRS) W "  " D RS,SOU S DIC(0)=$TR(DIC(0),"L") D RCR Q:Y>0
"RTN","DICM",134,0)
 G R
"RTN","DICM",135,0)
 ;
"RTN","DICM",136,0)
7 S Y=-1 N % S %=$S($D(DIC("S")):DIC("S"),1:1)
"RTN","DICM",137,0)
 I $D(DS),'$D(DIC("S1")) D
"RTN","DICM",138,0)
 . S DIC("S")=DS I '% S DIC("S")=DIC("S")_" X DIC(""S1"")",DIC("S1")=%
"RTN","DICM",139,0)
 . I X]"" D
"RTN","DICM",140,0)
 . . N DIVAL S (DIVAL,DIVAL(1))=X,DIVAL(0)=1 N X S (X,X(1))=DIVAL
"RTN","DICM",141,0)
 . . N DINDEX,DIFILEI
"RTN","DICM",142,0)
 . . S DIC(0)=$TR(DIC(0),"L") D F^DIC
"RTN","DICM",143,0)
 . K DIC("S") S:$D(DIC("S1")) DIC("S")=DIC("S1") K DIC("S1")
"RTN","DICM",144,0)
 D E Q
"RTN","DICM",145,0)
 ;
"RTN","DICM",146,0)
SOU D SOU^DICM1 Q
"RTN","DIE")
0^5^B26226750^B20904318
"RTN","DIE",1,0)
DIE ;SFISC/GFT,XAK-PROC.DR-STR ;28MAR2006
"RTN","DIE",2,0)
 ;;22.0;VA FileMan;**1,4,8,11,59,95,159**;Mar 30, 1999;Build 8
"RTN","DIE",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DIE",4,0)
 N DG,DNM,DICRREC K DB I DIE S DIE=^DIC(DIE,0,"GL")
"RTN","DIE",5,0)
 Q:$D(@(DIE_DA_",-9)"))  Q:'$D(@(DIE_"0)"))  S U="^",DP=+$P(^(0),U,2) Q:$P($G(^DD($$FNO^DILIBF(DP),0,"DI")),U,2)["Y"&'$D(DIOVRD)&'$G(DIFROM)
"RTN","DIE",6,0)
GO Q:DIE?1"^DIA(".E  Q:DA'>0  K DE,DOV,DIOV,DIEC,DTOUT N DIEDA D
"RTN","DIE",7,0)
 . N %
"RTN","DIE",8,0)
 . F %=1:1 Q:'$G(DA(%))  S DIEDA(%)=DA(%)
"RTN","DIE",9,0)
 . S DIEDA=DA
"RTN","DIE",10,0)
 . Q
"RTN","DIE",11,0)
 I $D(DIETMP)[0 N DIETMP S DIETMP=$$GETTMP^DIKC1("DIE")
"RTN","DIE",12,0)
 N DIEFXREF,DIIENS,DIE1,DIE1N K DIEFIRE,DIEBADK,DIESP S DIIENS=$$IENS^DIKCU(DP,.DA)
"RTN","DIE",13,0)
 S DL=1,DIE1=1,D0=DA,DI=DP,DR(1,DP)=DR D INI I $E(DR)'="[" D DR^DIE17
"RTN","DIE",14,0)
 S DP=DI,DA=D0,(DQ,DIEL,DK,DP(0))=0 K DIC("S")
"RTN","DIE",15,0)
MR S DK=DK+1,DH=$P(DR,";",DK) I +DH=DH S (DI,DM)=DH G S:$D(^DD(DP,DI)),MR
"RTN","DIE",16,0)
 S DI=$P(DH,":",1) I 'DI G K:DI=0,PB
"RTN","DIE",17,0)
J I DH["//" S DE(DQ+1,0)=$P(DH,"//",2,9),DI=$P(DI,"//",1),DH=""
"RTN","DIE",18,0)
 G K:+DI=DI S DM=+DI,Y=$P(DI,DM,2,99),DI=DM G MR:Y=""!'$D(^DD(DP,DI,0)) S DQ=DQ+1,(DZ,DQ(DQ))=^(0),DIFLD(DQ)=DI
"RTN","DIE",19,0)
SPC F %=1:1 S DIESP=$P(Y,$C(126),%) Q:DIESP=""  D
"RTN","DIE",20,0)
 .I DIESP="d"!(DIESP="R") S $P(DZ,U,2)=$P(DZ,U,2)_DIESP Q
"RTN","DIE",21,0)
 .I DIESP="T"!(DIESP="t") S:$G(^DD(DP,DI,.1))]"" $P(DZ,U)=^(.1) Q
"RTN","DIE",22,0)
 .S $P(DZ,U)=DIESP,DQ(DQ,"CAPTION")=DIESP
"RTN","DIE",23,0)
 S:DH'[$C(126) DH=DH_$C(126) S DQ(DQ)=DZ K DZ G Y
"RTN","DIE",24,0)
 ;
"RTN","DIE",25,0)
K S DM=$P(DH,":",2),DM=$S(DM:DM,1:DI) I DI,$D(^DD(DP,DI)) G S
"RTN","DIE",26,0)
NX S DI=$O(^DD(DP,DI)) S:DI="" DI=-1 G MR:DI'>0,MR:DI>DM
"RTN","DIE",27,0)
S I DQ'<50,'$D(DE(DQ+1)) G H
"RTN","DIE",28,0)
 S DQ=DQ+1,DQ(DQ)=^(DI,0),DIFLD(DQ)=DI
"RTN","DIE",29,0)
Y S Y=$P(DQ(DQ),"^",4),DG=$P(Y,";",1)
"RTN","DIE",30,0)
 ;Determine whether field has a xref defined in the Index file
"RTN","DIE",31,0)
 S DIEXREF=0 F  S DIEXREF=$O(^DD("IX","F",DP,DI,DIEXREF)) Q:'DIEXREF  I $P($G(^DD("IX",DIEXREF,0)),U) S DIEXREF=1 Q
"RTN","DIE",32,0)
 I $D(^DD(DP,DI,1))!($P(DQ(DQ),U,2)["a")!DIEXREF S DE=0,DB=DM,DM=0,DE(Y)=DQ K DIEXREF F DW=1:1 S DE=$O(^DD(DP,DI,1,DE)) Q:DE<1  S DE(Y,DW,1)=^(DE,1),DE(Y,DW,2)=^(2)
"RTN","DIE",33,0)
 I  S:DE="" DE=-1
"RTN","DIE",34,0)
 I $P(DQ(DQ),U,2)["a" S DE(Y,DW,2)="S DIIX=2_U_DIFLD(DE(DQ)) D AUDIT^DIET",DE(Y,DW,1)="S DIIX=3_U_DIFLD(DE(DQ)) D AUDIT^DIET",DE(Y)=DQ I ^DD(DP,DI,"AUDIT")="e" S DE(Y,DW,1)="I $D(DE(DE(DQ)))#2 "_DE(Y,DW,1)
"RTN","DIE",35,0)
 S Y=$P(Y,";",2) I DU'=DG S D="",DU=DG,@DC G M:Y=0,B:DU=" ",EQ:DW[0 S D=^(DG)
"RTN","DIE",36,0)
 I Y S:$P(D,"^",Y)]"" DE(DQ)=$P(D,"^",Y)
"RTN","DIE",37,0)
 E  S Y=$E(D,+$E(Y,2,9),$P(Y,",",2)) S:Y'?." " DE(DQ)=Y
"RTN","DIE",38,0)
EQ G MR:DI=DM,NX:DM S DM=DB K DB G D
"RTN","DIE",39,0)
 ;
"RTN","DIE",40,0)
INI K DIC("S") S DIC=DIE,DU=-1,DC="DW=$D("_DIE_DA_",DG))"
"RTN","DIE",41,0)
Q Q
"RTN","DIE",42,0)
 ;
"RTN","DIE",43,0)
 ;
"RTN","DIE",44,0)
MORE ;from ^DIE1
"RTN","DIE",45,0)
 D INI G MR:DI=DM,NX:DI'[U,MR:'$D(^DD(DP,+DI)) S %=$P(DI,U,2),DI=+DI S:%]"" DQ(DQ+1,"CAPTION")=% G S
"RTN","DIE",46,0)
 ;
"RTN","DIE",47,0)
 ;
"RTN","DIE",48,0)
JMP ;from ^DIE0
"RTN","DIE",49,0)
 D INI G J
"RTN","DIE",50,0)
 ;
"RTN","DIE",51,0)
PB I DH="" G D:$D(DR(DIE1,DP))<9 S:'$D(DOV) DOV=0,DR(DIE1,DP)=DR S DOV=$O(DR(DIE1,DP,DOV)) S:DOV="" DOV=-1 G D:DOV'>0 S DR=DR(DIE1,DP,DOV),DK=0 G MR
"RTN","DIE",52,0)
 G MR:DH?1"@".N I 'DQ G TEM:DH?1"[".E S:"Q"'=DH DQ=1,DQ(0,1)=DH G MR:$A(DH)-94 S DC=$P(DH,U,1,4) X $P(DH,U,5,999) D DIE1N G O^DIE0
"RTN","DIE",53,0)
E S DK=DK-1,(DI,DM)=1
"RTN","DIE",54,0)
D G DQ^DIED
"RTN","DIE",55,0)
 ;
"RTN","DIE",56,0)
H S DI=DI_U G D
"RTN","DIE",57,0)
 ;Multiple field
"RTN","DIE",58,0)
M S Y=$P(DQ(DQ),U,2)_U_DG G DC:DW<9
"RTN","DIE",59,0)
 I $D(DSC(+Y))#2,$P(DSC(+Y),"I $D(^UTILITY(",1)="" S D=DIEL+1 D D1 X DSC(+Y) S D=$O(^(0)) S:D="" D=-1 S @DC S DC=$O(^(DG,0)) S:DC="" DC=-1 G DE
"RTN","DIE",60,0)
 I $D(^(DG,0)) S D=$P(^(0),U,3,4) S:$P(^(0),U,2)'=$P(Y,U) $P(^(0),U,2)=$P(Y,U) ;HMMM
"RTN","DIE",61,0)
 E  S D=$O(^(0)) S:D="" D=-1
"RTN","DIE",62,0)
DE I D>0 S Y=Y_U_D I DP(0)-Y!($P(DP(0),U,2)-DK),$D(^(+D,0)) S DE(DQ)=$P(^(0),U) ;Default value if this isn't same multiple we were down in before
"RTN","DIE",63,0)
DC S DC=$P(^DD(+Y,0),U,4)_U_Y,%=DQ(DQ),Y=^(.01,0)
"RTN","DIE",64,0)
MUL I $P(Y,U,2)'["W" S DQ(DQ)=$P($$EZBLD^DIALOG(8042,$G(DQ(DQ,"CAPTION"),$P(Y,U))),": ")_U_1_$P(Y,U,2,99) D DIE1N G D ;MULTIPLE-FIELD LABEL
"RTN","DIE",65,0)
 I DQ>1 K DQ(DQ) G E:$D(DE(DQ,0)),H
"RTN","DIE",66,0)
 D
"RTN","DIE",67,0)
 .Q:DH'[$C(126)
"RTN","DIE",68,0)
 .N DIEA S DIEA=$P($P(DH,+DH,2),$C(126)) Q:DIEA=""!(DIEA="d")!(DIEA="R")
"RTN","DIE",69,0)
 .I DIEA="T"!(DIEA="t") S:$D(^DD(+$P(%,U,2),.01,.1)) DQ(DQ,"CAPTION")=^(.1) Q
"RTN","DIE",70,0)
 .S DQ(DQ,"CAPTION")=DIEA
"RTN","DIE",71,0)
DIWE S Y=$G(DQ(DQ,"CAPTION"),$P(%,U))_U_$P(Y,U,2) D DIEN^DIWE K DQ,DG,DE S DQ=0 G QY^DIE1:$D(DTOUT) G MORE ;WORD-PROCESSING FIELD LABEL
"RTN","DIE",72,0)
 ;
"RTN","DIE",73,0)
D1 Q:D'>0  S:'$D(@("D"_D)) @("D"_D)=0 S D=D-1 G D1
"RTN","DIE",74,0)
 ;
"RTN","DIE",75,0)
DIE1N N M,I S DIE1N="" F I=DK,DK+1 S M=$P(DR,";",I) I M?1"^"1.NP S DIE1N=$P(M,U,2) S:I>DK DK=DK+1 Q  ;WPB-0804-30857
"RTN","DIE",76,0)
 Q
"RTN","DIE",77,0)
 ;
"RTN","DIE",78,0)
 ;
"RTN","DIE",79,0)
B K DQ(DQ) S DQ=DQ-1,DU=-9 G EQ
"RTN","DIE",80,0)
 ;
"RTN","DIE",81,0)
TEM K:$D(DIETMP)#2 @DIETMP,DIETMP
"RTN","DIE",82,0)
 S Y=0 F  S Y=$O(^DIE("B",$P($E(DR,2,99),"]",1),Y)) S:Y="" Y=-1 G Q:Y=-1,Q:'$D(^DIE(+Y,0)) Q:$P(^(0),U,4)=DP
"RTN","DIE",83,0)
 S $P(^(0),U,7)=DT I $G(^("ROU"))[U,$$ROUEXIST^DILIBF($P(^("ROU"),U,2)) G @^DIE(+Y,"ROU")
"RTN","DIE",84,0)
 S:$D(^("W")) DIE("W")=^("W") S %X="^DIE(+Y,""DR"",",%Y="DR(" D %XY^%RCR
"RTN","DIE",85,0)
 S DIE("^")=DR,DR=$S($D(^DIE(Y,"DR"))#2:^("DR"),1:DR(1,DP)) D DIE K DR S DR=DIE(U)
"RTN","DIE",86,0)
 Q
"RTN","DIE",87,0)
 ;
"RTN","DIE",88,0)
 ;Silent call concerning editing and filing of data.
"RTN","DIE",89,0)
 ;
"RTN","DIE",90,0)
FILE(DIEFFLAG,DIEFAR,DIEFOUT) ;
"RTN","DIE",91,0)
 G FILEX^DIEF
"RTN","DIE",92,0)
 ;
"RTN","DIE",93,0)
WP(DIEFF,DIEFIEN,DIEFFLD,DIEFWPFL,DIEFTSRC,DIEFOUT) ;
"RTN","DIE",94,0)
 G WPX^DIEFW
"RTN","DIE",95,0)
 ;
"RTN","DIE",96,0)
HELP(DIEHF,DIEHIEN,DIEHFLD,DIEHFLG,DIEHOUT) ;
"RTN","DIE",97,0)
 G GETX^DIEH
"RTN","DIE",98,0)
 ;
"RTN","DIE",99,0)
VAL(DIEVF,DIEVIEN,DIEVFLD,DIEVFLG,DIEVAL,DIEVANS,DIEVFAR,DIOUTAR) ;
"RTN","DIE",100,0)
 G VALX^DIEV
"RTN","DIE",101,0)
 ;
"RTN","DIE",102,0)
KEYVAL(DIVKFLAG,DIVKFDA,DIVKOUT) ;
"RTN","DIE",103,0)
 G KEYVALX^DIEVK
"RTN","DIE",104,0)
 ;
"RTN","DIE",105,0)
VALS(DIVSFLAG,DIVSEFDA,DIVSIFDA,DIVSMSG) ;
"RTN","DIE",106,0)
 G VALSX^DIEVS
"RTN","DIE",107,0)
 ;
"RTN","DIE",108,0)
CHK(DIEVF,DIEVFLD,DIEVFLG,DIEVAL,DIEVANS,DIOUTAR) ;
"RTN","DIE",109,0)
 G CHKX^DIEV
"RTN","DIE",110,0)
 ;
"RTN","DIE",111,0)
UPDATE(DIFLAGS,DIFDA,DIEN,DIMSGA) ;SEA/TOAD
"RTN","DIE",112,0)
 ; ENTRY POINT--update database
"RTN","DIE",113,0)
 ; procedure, all passed by value
"RTN","DIE",114,0)
 G ADDX^DICA
"RTN","DIE",115,0)
 ;
"RTN","DIE0")
0^6^B9621443^B9856102
"RTN","DIE0",1,0)
DIE0 ;SFISC/GFT-BRANCHING, UP-ARROWING ;27MAR2006
"RTN","DIE0",2,0)
 ;;22.0;VA FileMan;**60,159**;Mar 30, 1999;Build 8
"RTN","DIE0",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DIE0",4,0)
 G Q^DIE1:$D(DTOUT) G:X'?1"^".E T^DIED:$P($P(DQ(DQ),U,4),";E",2),X
"RTN","DIE0",5,0)
 I $D(DIE("NO^")),X=U,DIE("NO^")'["OUTOK" W !?3,"EXIT NOT ALLOWED " G X
"RTN","DIE0",6,0)
 I $D(DIE("NO^")),X?1"^"1E.E,DIE("NO^")'["BACK" W !?3,"JUMPING NOT ALLOWED " G X
"RTN","DIE0",7,0)
 I $L(X,"^")-1>1 S X=$E(X,2,99) G DIE0
"RTN","DIE0",8,0)
 S X=$P(X,U,2),DIC(0)="E"
"RTN","DIE0",9,0)
OUT I X=""!(DP<0) S DIK=X,DC=$S($D(DQ(DQ))#2:$P(DQ(DQ),U,4),1:DQ) G OUT^DIE1
"RTN","DIE0",10,0)
 I DR]"" G A:X?1"@".N S DIC("S")="D S^DIE0" S:'$D(DR(DIE1,DP)) DR(DIE1,DP)=DR
"RTN","DIE0",11,0)
 S DDBK=0,DIC="^DD("_DP_"," D ^DIC I Y>0 D S
"RTN","DIE0",12,0)
 E  W:DDBK !?3,"JUMPING FORWARD NOT ALLOWED "
"RTN","DIE0",13,0)
 K DTOUT,DIC,DDBK,DDFND,DDONE,A0,A1,A2
"RTN","DIE0",14,0)
 I Y<0 S DG=DK,DH=":"_DM G X
"RTN","DIE0",15,0)
 S DI=$S(DH[":":+Y,1:DH),DK=DG D ^DIE1:$D(DG)>9 K DG,DB,DE,DQ,DIFLD S DQ=0 G JMP^DIE
"RTN","DIE0",16,0)
X W:X'["?"&'$D(ZTQUEUED) $C(7),"??" G B^DIED:'$D(DB(DQ)),B^DIE1
"RTN","DIE0",17,0)
 ;
"RTN","DIE0",18,0)
BR ;From ^DIED
"RTN","DIE0",19,0)
 S Y=U,X=$G(X) X DQ(0,DQ) D:$D(DIEFIRE)#2 FIREREC^DIE1 G A^DIED:$D(Y)[0,A^DIED:Y=U S D=$S(+Y=Y:9999,1:DQ),X="" I 0[Y S DQ=0 G OUT
"RTN","DIE0",20,0)
D S D=D+1 I '$D(DQ(D)) G D:$D(DQ(0,D)) S DQ=9999,X=Y,DIC(0)="FO" G OUT
"RTN","DIE0",21,0)
 G D:$P(DQ(D),Y,1)]"" S DQ=D G RE^DIED
"RTN","DIE0",22,0)
 ;
"RTN","DIE0",23,0)
O ;From ^DIE
"RTN","DIE0",24,0)
 K DQ S (DI,DV,DM)=0 I X]"",$D(@(U_$P(DC,U,3)_X_",0)"))#2 D S^DIE1,DIEC
"RTN","DIE0",25,0)
 S DQ=0 G MORE^DIE
"RTN","DIE0",26,0)
 ;
"RTN","DIE0",27,0)
DIEC S DIE=U_$P(DC,U,3),DIEC(DL)=DA F %=1:1 Q:'$D(DA(%))  S DIEC(DL,%)=DA(%)
"RTN","DIE0",28,0)
 K DA,DB,DE,DG F %=0:1:DIEL-1 S DA="D"_%,DIEC(DL,0,%)=@DA K @DA
"RTN","DIE0",29,0)
 S:$D(DIETMP)#2 DIEC(DL,"IENS")=DIIENS,DIIENS=X_","
"RTN","DIE0",30,0)
 S DIEL=0,(D0,DA)=X Q
"RTN","DIE0",31,0)
 ;
"RTN","DIE0",32,0)
DIEZ ;
"RTN","DIE0",33,0)
 I X="" G @("A"_U_DNM)
"RTN","DIE0",34,0)
 S D=0,DL=DL+1,DNM(DL)=DNM,DNM(DL,0)=DQ,DIEL=DIEL+1 D DIEC G @DGO
"RTN","DIE0",35,0)
 ;
"RTN","DIE0",36,0)
A I $D(DR(DIE1,DP))>9 D OA ;Branching to "@N"
"RTN","DIE0",37,0)
 E  F DG=1:1 S DH=$P(DR(DIE1,DP),";",DG) G X:DH="" I DH=X S:$D(DOV) DOV=0 S DR=DR(DIE1,DP) Q
"RTN","DIE0",38,0)
 S DK=DG,DI=X D ^DIE1 G JMP^DIE
"RTN","DIE0",39,0)
OA S %=0 F  S %=$O(DR(DIE1,DP,%)) Q:%=""  F DG=1:1 S DH=$P(DR(DIE1,DP,%),";",DG) Q:DH=""  I DH=X S DR=DR(DIE1,DP,%),DOV=%,%=9999 Q
"RTN","DIE0",40,0)
 S %=-1 Q
"RTN","DIE0",41,0)
 ;
"RTN","DIE0",42,0)
E ;UNEDITABLE & DINUM fields
"RTN","DIE0",43,0)
 I X="@" Q:DV'["I"  G NO
"RTN","DIE0",44,0)
 Q:X[U!(X?."?")!DV!$D(DITC)
"RTN","DIE0",45,0)
NO W:'$D(DB(DQ)) $C(7),"   NO EDITING!!" K X
"RTN","DIE0",46,0)
Q Q
"RTN","DIE0",47,0)
 ;
"RTN","DIE0",48,0)
 ;
"RTN","DIE0",49,0)
 ;
"RTN","DIE0",50,0)
S ;SCREEN fields;  out= $T
"RTN","DIE0",51,0)
 N DDR S (%,DDFND)=0,DDR=DR(DIE1,DP),DDBK=0,Y=+Y
"RTN","DIE0",52,0)
 I $D(DIE("NO^")),DIE("NO^")["BACK" S DDBK=1
"RTN","DIE0",53,0)
 D S1 I DDFND Q
"RTN","DIE0",54,0)
 I 'DDONE,$D(DR(DL,DP))>9 F %=-1:0 S %=$O(DR(DIE1,DP,%)) Q:%=""  S DDR=DR(DIE1,DP,%) D S1 Q:DDONE!DDFND
"RTN","DIE0",55,0)
 Q
"RTN","DIE0",56,0)
S1 ;selectable?
"RTN","DIE0",57,0)
 S DDONE=0 F DG=1:1 D S2 Q:DDFND!DDONE!(DH="")
"RTN","DIE0",58,0)
 I DDFND S DOV=%,DR=$G(DR(DIE1,DP,%),$G(DR(DIE1,DP)))
"RTN","DIE0",59,0)
 Q
"RTN","DIE0",60,0)
S2 ;parse for ;-piece
"RTN","DIE0",61,0)
 S DH=$P(DDR,";",DG) Q:(DH["///"&(DIC(0)'["F"))!'DH
"RTN","DIE0",62,0)
 ;list
"RTN","DIE0",63,0)
 I 'DDBK,+DH=Y S DDFND=1 Q
"RTN","DIE0",64,0)
 I DDBK,+DH=DIFLD,+DH'=Y S DDONE=1 Q
"RTN","DIE0",65,0)
 I DDBK,+DH=Y S DDFND=1 Q
"RTN","DIE0",66,0)
 Q:$P(DH,"//")'[":"
"RTN","DIE0",67,0)
 ;range
"RTN","DIE0",68,0)
 S A0=+$P(DH,":",1),A1=+$P(DH,":",2)
"RTN","DIE0",69,0)
 I 'DDBK,Y'<A0,Y'>A1 S DDFND=1 Q
"RTN","DIE0",70,0)
 F A2=A0-.000001:0 S A2=$O(^DD(DP,A2)) Q:A2>A1!'A2  S:A2=DIFLD&(A2'=Y)&DDBK DDONE=1 Q:DDONE  I A2=Y,(A2'>DIFLD) S DDFND=1 Q
"RTN","DIE0",71,0)
 Q
"RTN","DIE1")
0^1^B32974046^B31515558
"RTN","DIE1",1,0)
DIE1 ;SFISC/GFT-FILE DATA, XREF IT, GO UP AND DOWN MULTIPLES ;28MAY2008
"RTN","DIE1",2,0)
 ;;22.0;VA FileMan;**1,4,11,159**;Mar 30, 1999;Build 8
"RTN","DIE1",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DIE1",4,0)
 K DQ,DB G E1:$D(DG)<9 I DP<0 K DG S DQ=0 Q
"RTN","DIE1",5,0)
 S DQ="",DU=-2,DG="$D("_DIE_DA_",DU))"
"RTN","DIE1",6,0)
Y S DQ=$O(DG(DQ)),DW=$P(DQ,";",2) G DE:$P(DQ,";")=DU
"RTN","DIE1",7,0)
 I DU'<0 S ^(DU)=DV,DU=-2
"RTN","DIE1",8,0)
 G IX:DQ="" S DU=$P(DQ,";",1),DV="" I @DG S DV=^(DU)
"RTN","DIE1",9,0)
DE I 'DW S DW=$E(DW,2,99),DE=DW-$L(DV)-1,%=$P(DW,",",2)+1,X=$E(DV,%,999),DV=$E(DV,0,DW-1)_$J("",$S(DE>0:DE,1:0))_DG(DQ) S:X'?." " DV=DV_$J("",%-DW-$L(DG(DQ)))_X G Y
"RTN","DIE1",10,0)
PC S $P(DV,"^",DW)=DG(DQ) G Y
"RTN","DIE1",11,0)
 ;
"RTN","DIE1",12,0)
IX S DICRREC="LOADXR^DIED",DQ=$O(DE(" ")) G E1:DQ="",E1:'$D(DG(DQ)) I $D(DE(DE(DQ)))#2 F DG=1:1 Q:'$D(DE(DQ,DG))  S DIC=DIE,X=DE(DE(DQ)) X DE(DQ,DG,2)
"RTN","DIE1",13,0)
 S X="" I DG(DQ)]"" F DG=1:1 Q:'$D(DE(DQ,DG))  S DIC=DIE,X=DG(DQ) X DE(DQ,DG,1)
"RTN","DIE1",14,0)
 D:$D(DIEFXREF) FIREFLD
"RTN","DIE1",15,0)
E1 K DICRREC,DIFLD,DG,DB,DE,DIANUM S DQ=0 Q
"RTN","DIE1",16,0)
 ;
"RTN","DIE1",17,0)
B ;
"RTN","DIE1",18,0)
 I '$D(DB(DQ)) S X="?BAD" G ^DIEQ
"RTN","DIE1",19,0)
 S DC=DQ,DIK="",DL=1
"RTN","DIE1",20,0)
OUT ;
"RTN","DIE1",21,0)
 D DIE1 S Y(DC)=DIK G UP:DL>1,Q:DC=0,QY
"RTN","DIE1",22,0)
 ;
"RTN","DIE1",23,0)
E ;
"RTN","DIE1",24,0)
 I DP'<0 S DC=$S($D(X)#2:X,1:"") D DIE1 S X=DC G G:DI>0,UP:DL>1
"RTN","DIE1",25,0)
Q K Y
"RTN","DIE1",26,0)
QY I $D(DTOUT),$D(DIEDA) D
"RTN","DIE1",27,0)
 . N % K DA
"RTN","DIE1",28,0)
 . F %=1:1 Q:'$D(DIEDA(%))  S DA(%)=DIEDA(%)
"RTN","DIE1",29,0)
 . S DA=DIEDA
"RTN","DIE1",30,0)
 . Q
"RTN","DIE1",31,0)
 K:$D(DTOUT) DG,DQ
"RTN","DIE1",32,0)
 I $D(DIETMP)#2 D FIREREC K @DIETMP,DIETMP
"RTN","DIE1",33,0)
 K DIEBADK,DIEFIRE,DIEXREF,DIEFXREF,DIIENS,DIE1,DIESP
"RTN","DIE1",34,0)
 K DIP,DB,DE,DM,DK,DL,DH,DU,DV,DW,DP,DC,DIK,DOV,DIEL,DIFLD Q
"RTN","DIE1",35,0)
 ;
"RTN","DIE1",36,0)
M ;
"RTN","DIE1",37,0)
 S DD=X,DIC(0)="LM"_$S($D(DB(DQ)):"X",1:"QE"),DO(2)=$P(DC,"^",2),DO=$P($P(DQ(DQ),U)," ",2,99)_"^"_DO(2)_"^"_$P(DC,"^",4,5) D DOWN I @("'$D("_DIC_"0))") S ^(0)="^"_DO(2)
"RTN","DIE1",38,0)
 E  I DO(2)["I" S %=0,DIC("W")="" D W^DIC1
"RTN","DIE1",39,0)
 K DIC("PTRIX") M DIC("PTRIX")=DIE("PTRIX")
"RTN","DIE1",40,0)
DIC S D="B",DLAYGO=DP\1,X=DD D  K DIC("PTRIX")
"RTN","DIE1",41,0)
 .N DIETMP,DICR D X^DIC
"RTN","DIE1",42,0)
 I Y>0 S DA=+Y,DI=0,X=$P(Y,U,2) S:$D(DIETMP)#2 $P(DIIENS,",")=DA S:+DR=.01!(DR="")&$P(Y,U,3) DI=.01,DK=1,DM=$P($P(DR,";",1),":",2),DM=$S(DR="":9999999,DM="":+DR,1:DM) G D1
"RTN","DIE1",43,0)
 S DI(DL-1)=DI(DL-1)_U K DUOUT,DTOUT G U1
"RTN","DIE1",44,0)
 ;
"RTN","DIE1",45,0)
DOWN D S,DIE1,DDA S DIE=DIC Q
"RTN","DIE1",46,0)
 ;
"RTN","DIE1",47,0)
S ;CALLED BY O+1^DIE0
"RTN","DIE1",48,0)
 S DIOV(DL)=$G(DOV,0) K DOV
"RTN","DIE1",49,0)
 S DIE1N(DL)=$G(DIE1N),DP(DL)=DP,DP=+$P(DC,"^",2),DI(DL)=$S(DV'["M":DI,$D(DSC(DP))!$D(DB(DQ)):DI,1:DI_U_$G(DQ(DQ,"CAPTION"))),DIE(DL)=DIE,DK(DL)=DK,DR(DL)=DR
"RTN","DIE1",50,0)
 S DM(DL)=DM,DK=0,DIE1(DL)=DIE1,DL=DL+1,DIE1=$S($G(DIE1N):DIE1N,1:DL),DIEL=DIEL+1,DM=9999999,DR=""
"RTN","DIE1",51,0)
 I $D(DR(DIE1,DP)) S DM=0,DR=DR(DIE1,DP)
"RTN","DIE1",52,0)
 Q
"RTN","DIE1",53,0)
 ;
"RTN","DIE1",54,0)
DDA N T,X
"RTN","DIE1",55,0)
 S T=$T
"RTN","DIE1",56,0)
 F X=+$O(DA(" "),-1):-1:1 K DA(X+1) S:$D(DA(X))#2 DA(X+1)=DA(X)
"RTN","DIE1",57,0)
 K DA(1) S:$D(DA)#2 DA(1)=DA
"RTN","DIE1",58,0)
 S DIC=DIE_DA_","""_$P(DC,U,3)_""","
"RTN","DIE1",59,0)
 S:$D(DIETMP)#2 DIIENS=","_DIIENS
"RTN","DIE1",60,0)
 I T
"RTN","DIE1",61,0)
 Q
"RTN","DIE1",62,0)
 ;
"RTN","DIE1",63,0)
UDA N T,X
"RTN","DIE1",64,0)
 S T=$T
"RTN","DIE1",65,0)
 S DA=$G(DA(1)) ;K DA(1)
"RTN","DIE1",66,0)
 F X=2:1:+$O(DA(" "),-1) I $D(DA(X))#2 S DA(X-1)=DA(X) K DA(X)
"RTN","DIE1",67,0)
 S:$D(DIETMP)#2 DIIENS=$P(DIIENS,",",2,999)
"RTN","DIE1",68,0)
 I T
"RTN","DIE1",69,0)
 Q
"RTN","DIE1",70,0)
N ;
"RTN","DIE1",71,0)
 D DOWN S DA=$P(DC,U,4),DI=.01 S:$D(DIETMP)#2 $P(DIIENS,",")=DA S ^DISV(DUZ,$E(DIC,1,28))=$E(DIC,29,999)_DA
"RTN","DIE1",72,0)
D1 S @("D"_DIEL)=DA
"RTN","DIE1",73,0)
G G MORE^DIE
"RTN","DIE1",74,0)
 ;
"RTN","DIE1",75,0)
UP ;
"RTN","DIE1",76,0)
 Q:$D(DTOUT)
"RTN","DIE1",77,0)
 S DP(0)=DP_U_DK(DL-1) I $D(DIEC(DL)) D DIEC G U
"RTN","DIE1",78,0)
U1 D UDA S DIEL=DIEL-1
"RTN","DIE1",79,0)
U S DQ=0,DL=DL-1,DIE1N=DIE1N(DL),DIE=DIE(DL),DM=DM(DL),DI=DI(DL),DP=DP(DL),DR=DR(DL),DK=DK(DL),DIE1=DIE1(DL) I $D(DIOV(DL)) S DOV=DIOV(DL) K DIOV(DL)
"RTN","DIE1",80,0)
 G G
"RTN","DIE1",81,0)
 ;
"RTN","DIE1",82,0)
DIEC K DA S DA=DIEC(DL) F %=1:1 Q:'$D(DIEC(DL,%))  S DA(%)=DIEC(DL,%)
"RTN","DIE1",83,0)
 F DIEL=0:1 Q:'$D(DIEC(DL,0,DIEL))  S @("D"_DIEL)=DIEC(DL,0,DIEL)
"RTN","DIE1",84,0)
 S:$D(DIETMP)#2 DIIENS=DIEC(DL,"IENS")
"RTN","DIE1",85,0)
 S DIEL=DIEL-1 K DIEC(DL)
"RTN","DIE1",86,0)
 Q
"RTN","DIE1",87,0)
 ;
"RTN","DIE1",88,0)
FIREFLD ;Fire field-level xrefs stored in DIEFXREF
"RTN","DIE1",89,0)
 D:$D(DIEFXREF)>2 FIRE^DIKC(DP,.DA,"KS","DIEFXREF","O","",$E("C",$G(DIOPER)="A"))
"RTN","DIE1",90,0)
 K DIEFXREF
"RTN","DIE1",91,0)
 Q
"RTN","DIE1",92,0)
 ;
"RTN","DIE1",93,0)
FIREREC ;Fire record-level xrefs accumulated in ^TMP
"RTN","DIE1",94,0)
 Q:$D(DIETMP)[0  Q:$D(@DIETMP@("R"))<2
"RTN","DIE1",95,0)
 N DP,DIIENS,DIE,DA,DIKEY,Y
"RTN","DIE1",96,0)
 ;
"RTN","DIE1",97,0)
 S DP=0 F  S DP=$O(@DIETMP@("R",DP)) Q:'DP  D
"RTN","DIE1",98,0)
 . S DIIENS=" " F  S DIIENS=$O(@DIETMP@("R",DP,DIIENS)) Q:DIIENS=""  D
"RTN","DIE1",99,0)
 .. D DA^DILF(DIIENS,.DA)
"RTN","DIE1",100,0)
 .. D FIRE^DIKC(DP,.DA,"KS",$NA(@DIETMP@("R")),"F^^K",.DIKEY,$E("C",$G(DIOPER)="A"))
"RTN","DIE1",101,0)
 ;
"RTN","DIE1",102,0)
 ;If any keys are invalid, restore values
"RTN","DIE1",103,0)
 D:$D(DIKEY)>9 RESTORE(.DIKEY,DIETMP)
"RTN","DIE1",104,0)
 ;
"RTN","DIE1",105,0)
 K DIEFIRE,@DIETMP@("R"),@DIETMP@("V")
"RTN","DIE1",106,0)
 Q
"RTN","DIE1",107,0)
 ;
"RTN","DIE1",108,0)
RESTORE(DIKEY,DIETMP) ;Restore key fields to their pre-edited values
"RTN","DIE1",109,0)
 N DA
"RTN","DIE1",110,0)
 K DIEBADK
"RTN","DIE1",111,0)
 S:$D(DIEFIRE)#2 X="BADKEY"
"RTN","DIE1",112,0)
 ;
"RTN","DIE1",113,0)
 ;Set "write" and "restore" flags
"RTN","DIE1",114,0)
 N DIEWR,DIEREST
"RTN","DIE1",115,0)
 I '$D(ZTQUEUED),'$D(DDS),$D(DIEFIRE)[0!($G(DIEFIRE)["M") S DIEWR=1
"RTN","DIE1",116,0)
 E  S DIEWR=0
"RTN","DIE1",117,0)
 I $D(DIEFIRE)#2,DIEFIRE'["R" S DIEREST=0
"RTN","DIE1",118,0)
 E  S DIEREST=1
"RTN","DIE1",119,0)
 I '$G(DIEWR),'$G(DIEREST),$G(DIEFIRE)'["L" Q
"RTN","DIE1",120,0)
 ;
"RTN","DIE1",121,0)
 N DIEFDA,DIEKK,DIEMSG,DIFIL,DIFLD,DIFLDI,DIIENS,DIIENSA
"RTN","DIE1",122,0)
 N DINEW,DIOLD,DIRFIL,X
"RTN","DIE1",123,0)
 ;
"RTN","DIE1",124,0)
 ;Loop through all keys that are not unique and build FDA
"RTN","DIE1",125,0)
 K DIEFDA
"RTN","DIE1",126,0)
 S DIRFIL=0 F  S DIRFIL=$O(DIKEY(DIRFIL)) Q:'DIRFIL  D
"RTN","DIE1",127,0)
 . S DIEKK=0 F  S DIEKK=$O(DIKEY(DIRFIL,DIEKK)) Q:'DIEKK  D
"RTN","DIE1",128,0)
 .. Q:$D(^DD("KEY",DIEKK,0))[0
"RTN","DIE1",129,0)
 .. K DIFLD
"RTN","DIE1",130,0)
 .. S DIFLDI=0 F  S DIFLDI=$O(^DD("KEY",DIEKK,2,DIFLDI)) Q:'DIFLDI  D
"RTN","DIE1",131,0)
 ... S DIFLD=$P($G(^DD("KEY",DIEKK,2,DIFLDI,0)),U),DIFIL=$P($G(^(0)),U,2)
"RTN","DIE1",132,0)
 ... Q:'DIFLD!'DIFIL
"RTN","DIE1",133,0)
 ... S DIFLD(DIFIL,DIFLD)=$$FLEVDIFF^DIKCU(DIRFIL,DIFIL)
"RTN","DIE1",134,0)
 .. S DIIENS=" " S DIIENS=$O(DIKEY(DIRFIL,DIEKK,DIIENS)) Q:DIIENS=""  D
"RTN","DIE1",135,0)
 ... S DIFIL=0 F  S DIFIL=$O(DIFLD(DIFIL)) Q:'DIFIL  D
"RTN","DIE1",136,0)
 .... S DIFLD=0 F  S DIFLD=$O(DIFLD(DIFIL,DIFLD)) Q:'DIFLD  D
"RTN","DIE1",137,0)
 ..... Q:$D(^DD(DIFIL,DIFLD,0))[0
"RTN","DIE1",138,0)
 ..... S DIIENSA=$P(DIIENS,",",DIFLD(DIFIL,DIFLD)+1,999)
"RTN","DIE1",139,0)
 ..... Q:$D(@DIETMP@("V",DIFIL,DIIENSA,DIFLD,"F"))[0!$D(^("4/"))  S DIOLD=^("F")
"RTN","DIE1",140,0)
 ..... K DA D DA^DILF(DIIENSA,.DA)
"RTN","DIE1",141,0)
 ..... S X=$$DEC^DIKC2(DIFIL,DIFLD) Q:X=""  X X S DINEW=X
"RTN","DIE1",142,0)
 ..... I DIEREST S DIEFDA(DIFIL,DIIENSA,DIFLD)=DIOLD
"RTN","DIE1",143,0)
 ..... I DIEWR!($G(DIEFIRE)["L") D
"RTN","DIE1",144,0)
 ...... S DIEBADK(DIRFIL,DIEKK,DIFIL,DIIENSA,DIFLD,"O")=DIOLD
"RTN","DIE1",145,0)
 ...... S DIEBADK(DIRFIL,DIEKK,DIFIL,DIIENSA,DIFLD,"N")=DINEW
"RTN","DIE1",146,0)
 ;
"RTN","DIE1",147,0)
 I DIEREST,$D(DIEFDA) D FILE^DIE("U","DIEFDA","DIEMSG") K DIERR
"RTN","DIE1",148,0)
 I DIEWR,$D(DIEBADK) D MSG^DIEKMSG(.DIEBADK,DIEREST)
"RTN","DIE1",149,0)
 ;
"RTN","DIE1",150,0)
 I $G(DIEFIRE)'["L" K DIEBADK
"RTN","DIE1",151,0)
 Q
"RTN","DIETED")
0^7^B42722493^B36461042
"RTN","DIETED",1,0)
DIETED ;SFISC/GFT SCREEN-EDIT AN INPUT TEMPLATE ;22MAY2006
"RTN","DIETED",2,0)
 ;;22.0;VA FileMan;**111,159**;Mar 30, 1999;Build 8
"RTN","DIETED",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DIETED",4,0)
 N DIC,DIET,DRK,DIETED,I,J,DDSCHG
"RTN","DIETED",5,0)
 S DIC=.402,DIC(0)="AEQ" D ^DIC Q:Y<1
"RTN","DIETED",6,0)
 S DIET=+Y D E
"RTN","DIETED",7,0)
 D PUT
"RTN","DIETED",8,0)
K K ^UTILITY("DIETEDIAB",$J),^UTILITY("DIETED",$J)
"RTN","DIETED",9,0)
 Q
"RTN","DIETED",10,0)
 ;
"RTN","DIETED",11,0)
EDIT(DIET) ; Edit Template using Screen Editor
"RTN","DIETED",12,0)
 N DRK,DIETED,I,J
"RTN","DIETED",13,0)
E N DUOUT,DTOUT,DP,DI,D0,DIETROW,DIETEDER,DIETH,DR,F,L,DB
"RTN","DIETED",14,0)
 X ^%ZOSF("EON")
"RTN","DIETED",15,0)
 I '$D(^DIE(DIET,0)) W !,"NO TEMPLATE SELECTED",! Q
"RTN","DIETED",16,0)
 S DIETED="Input Template """_$P(^(0),U)_""""
"RTN","DIETED",17,0)
 W "..."
"RTN","DIETED",18,0)
 D GET("^TMP(""DIETED"",$J)")
"RTN","DIETED",19,0)
 S DIETH="Editing "_DIETED,DIETROW=1,DRK=$P(^DIE(DIET,0),U,4)
"RTN","DIETED",20,0)
DDW D EDIT^DDW("^TMP(""DIETED"",$J)","M",DIETH,"(File "_DRK_")",DIETROW)
"RTN","DIETED",21,0)
 I $D(DUOUT)!$D(DTOUT) K DR G KL
"RTN","DIETED",22,0)
 D K K I,J
"RTN","DIETED",23,0)
 D PROCESS("^TMP(""DIETED"",$J)")
"RTN","DIETED",24,0)
 X ^%ZOSF("EON")
"RTN","DIETED",25,0)
 S DIETROW=$O(DIETEDER(0)) I DIETROW S DIETH="ERROR!  Re-editing "_DIETED K DIETEDER G DDW
"RTN","DIETED",26,0)
 S DDSCHG=1
"RTN","DIETED",27,0)
KL K ^TMP("DIETED",$J)
"RTN","DIETED",28,0)
 I '$D(DR) W $C(7),$$EZBLD^DIALOG(8077) Q
"RTN","DIETED",29,0)
 M ^UTILITY("DIETED",$J)=DR
"RTN","DIETED",30,0)
 Q
"RTN","DIETED",31,0)
 ;
"RTN","DIETED",32,0)
GET(DIETA,DIT) ;put displayable template into @DIETA
"RTN","DIETED",33,0)
 N DIAO,DIETREL,DIETAD,DB,DIAT,I,J,L,DIAR,DIAB
"RTN","DIETED",34,0)
 K @DIETA
"RTN","DIETED",35,0)
 I '$D(DIT) S DIT=$NA(^DIE(DIET))
"RTN","DIETED",36,0)
 S (DR,DIAT)="",(DIETAD,L,DIAO,DB,DIAR)=0,F=-1
"RTN","DIETED",37,0)
 S J(0)=$P(@DIT@(0),U,4)
"RTN","DIETED",38,0)
 M DI=^("DIAB") S DI=J(0)
"RTN","DIETED",39,0)
 D DOWN
"RTN","DIETED",40,0)
1 S Y=$P(DIAT,";",DB) I "Q"[Y G NDB:Y="" S DB=DB+1 G 1
"RTN","DIETED",41,0)
 S %=+Y I Y?.NP,$P(Y,":",2),Y'["/" S Y=+Y_"-"_$P(Y,":",2),%=""
"RTN","DIETED",42,0)
 I %_"T~"=Y!(%_"t~"=Y),$P($G(^DD(DI,%,0)),U,2) S Y=% ;HWH-1103-40934 -- ignore TITLE of MULTIPLE
"RTN","DIETED",43,0)
 S DIETREL="",DIAB=$G(DI(DB,DIAR-1,DI,DIAO)) E  S:Y?1"^".E DIETREL=Y S:DIAB]"" Y=DIAB
"RTN","DIETED",44,0)
 I Y?1"]".E S Y=$E(Y,2,999)
"RTN","DIETED",45,0)
 I DIAB="",%,$D(^DD(DI,%,0)) S Y=$P(^(0),U)_$P(Y,%,2,999)
"RTN","DIETED",46,0)
 S DB=DB+1,DIETAD=DIETAD+1,@DIETA@(DIETAD)=$J("",F*3)_Y I DIETREL]"" D  G 1 ;Put it in!
"RTN","DIETED",47,0)
 .S L=L\100+1*100,(J(L),DI)=$P(DIETREL,U,2) D DOWN ;Relational jump
"RTN","DIETED",48,0)
 I % S %=+$P($G(^DD(DI,%,0)),U,2) I %,$P($G(^DD(%,.01,0)),U,2)'["W" S L=L+1,(J(L),DI)=% D DOWN ;Down to a multiple
"RTN","DIETED",49,0)
 I Y="ALL" G UP
"RTN","DIETED",50,0)
 G 1
"RTN","DIETED",51,0)
 ;
"RTN","DIETED",52,0)
DOWN S F=F+1,DIAR(F)=DIAR,DIAR=DIAR+1,%=$P(DIAT,";",DB) S:%?1"^"1.NP DB=DB+1,DIAR=$P(%,U,2)
"RTN","DIETED",53,0)
 S DB(F)=DB,DB=1,DIAO(F)=DIAO,DIAO=0
"RTN","DIETED",54,0)
DIAT S DIAT=$G(@DIT@("DR",DIAR,DI),"ALL") Q
"RTN","DIETED",55,0)
 ;
"RTN","DIETED",56,0)
NDB I DIAO'<0 S DIAO=DIAO+1 I $D(@DIT@("DR",DIAR,DI,DIAO)) S DIAT=^(DIAO),DB=1 G 1
"RTN","DIETED",57,0)
 S DIAO=-1
"RTN","DIETED",58,0)
UP Q:'F  K I(L),J(L) S L=$O(J(L),-1)
"RTN","DIETED",59,0)
 S DIAR=DIAR(F),DB=DB(F),DIAO=DIAO(F),DI=J(L),DIAT=$S(DIAO<0:"",DIAO:@DIT@("DR",DIAR,J(L),DIAO),1:$G(@DIT@("DR",DIAR,DI))),F=F-1 G 1
"RTN","DIETED",60,0)
 ;
"RTN","DIETED",61,0)
 ;
"RTN","DIETED",62,0)
 ;
"RTN","DIETED",63,0)
 ;
"RTN","DIETED",64,0)
PROCESS(DIETA) ;puts nodes into ^UTILITY("DIETED")
"RTN","DIETED",65,0)
 N DIAB,LINE,DXS,L,DIAP,DIETSL,DQI,DIETSAVE,DIETAB,ERR,DIAR
"RTN","DIETED",66,0)
 K DR S F=0,(DI,J(0))=DRK,I(0)=^DIC(J(0),0,"GL"),DIAP="",(L,DIETAB)=0,DXS=1,DIAR=1
"RTN","DIETED",67,0)
 F LINE=1:1 Q:'$D(@DIETA@(LINE))  K ERR S X=^(LINE) D
"RTN","DIETED",68,0)
 .I X?1"^".E S LINE=999999999 K DR Q
"RTN","DIETED",69,0)
 .D LINE(X)
"RTN","DIETED",70,0)
 .I $D(ERR) W "LINE ",LINE S DIETEDER(LINE)=ERR,LINE=-LINE Q  ;stop if we find one error
"RTN","DIETED",71,0)
 I LINE<0 W " ERROR!"
"RTN","DIETED",72,0)
 Q
"RTN","DIETED",73,0)
 ;
"RTN","DIETED",74,0)
LINE(X) ;Process one LINE from the screen
"RTN","DIETED",75,0)
 N D,DIC,DICMX,DV,DATE,Y,DICOMPX,DICOMP,DRR
"RTN","DIETED",76,0)
 F D=$L(X):-1:1 Q:$A(X,D)>32  S X=$E(X,1,D-1)
"RTN","DIETED",77,0)
 F D=0:1 Q:$A(X)-32  S X=$E(X,2,999) ;strip off 'D' leading spaces
"RTN","DIETED",78,0)
 Q:X=""
"RTN","DIETED",79,0)
OUT I D<DIETAB,L K I(L),J(L) S L=$O(J(L),-1),DIAP=DIAP(F),DIAR=DIAR(F),DIETAB=$G(DIETAB(F),D),F=F-1,DI=J(L) G OUT ;out-dentation means go up a level (or more)
"RTN","DIETED",80,0)
 S DIETAB=D
"RTN","DIETED",81,0)
 I X?1"@"1.N S Y=X G DR
"RTN","DIETED",82,0)
ALL D DICS^DIA I X="ALL" D  Q
"RTN","DIETED",83,0)
 .S ^UTILITY("DIETEDIAB",$J,1,DIAR-1,DI,DIAP\1000)=X
"RTN","DIETED",84,0)
 .N D,DA,DG D RANGE^DIA1
"RTN","DIETED",85,0)
 S DV="",J=$P(X,"-",2) I +J=J,$P(X,"-")=+X,J>X D  G X:Y="",DR
"RTN","DIETED",86,0)
 .N D,DA,DG S D(F)=J D RANGE^DIA1 S Y=DA
"RTN","DIETED",87,0)
SEMIC I X[";" S Y=X,X=$P(X,";") D  G X:'$D(Y) S DIAB=Y
"RTN","DIETED",88,0)
 .F %=2:1:$L(Y,";") S D=$P(Y,";",%),D=$S(D="DUP":"d",D="REQ":"R","""R""d"""[D:"",$A(D)=34:$E(D,2,$F(D,"""",2)-2),D="T":D,1:""),DV=D_$C(126)_DV I $A(D)>45&($A(D)<58)!(D[":")!(D="") K Y Q
"RTN","DIETED",89,0)
DIC S DIC(0)="OZ",DIC="^DD(DI," D ^DIC
"RTN","DIETED",90,0)
 I Y>0 S Y=+Y_DV D DR S %=+$P(Y(0),U,2) D:%  Q
"RTN","DIETED",91,0)
 .I $P($G(^DD(+%,.01,0)),U,2)["W" Q
"RTN","DIETED",92,0)
 .S L=L+1,(DI,J(L))=+%,I(L)=""""_$P($P(Y(0),U,4),";")_"""" D D
"RTN","DIETED",93,0)
 S (Y,DIETSAVE)=X I DUZ(0)="@",X'?.E1":" S X=$S(X["//^":$P(X,"//^",2),1:X),X=$S(X[";":$P(X,";"),1:X) D ^DIM G:$D(X) DR:X=DIETSAVE I DIETSAVE["//^",'$D(X) G X
"RTN","DIETED",94,0)
 F DIETSL="///+","//+","///","//" I DIETSAVE[DIETSL S DP=$P(DIETSAVE,DIETSL,2,9) I DP'?1"/".E&(DP'?1"^".E)!(DUZ(0)="@") G DEF
"RTN","DIETED",95,0)
 I DIETSAVE?.E1":" S:'$D(DIAB) DIAB=DIETSAVE K X S X=DIETSAVE,DICOMP=L_"WE",DQI="Y(",DA="DR(99,"_DXS_",",DICMX=1 D ^DICOMPW G L:$D(X) ;as in E^DIA3
"RTN","DIETED",96,0)
X S ERR=1 Q
"RTN","DIETED",97,0)
 ;
"RTN","DIETED",98,0)
L I $D(X)>1  M DR(99,DXS)=X S DXS=DXS+1
"RTN","DIETED",99,0)
 S %=-1,L=$S(Y>L:+Y,1:L\100+1*100),Y=U_DP_U_U_X_" S X=$S(D(0)>0:D(0),1:"""")" K X
"RTN","DIETED",100,0)
 D DR S DI=+DP D D
"RTN","DIETED",101,0)
 Q
"RTN","DIETED",102,0)
 ;
"RTN","DIETED",103,0)
D N % S F=F+1,DIAR(F)=DIAR F %=F+1:.01 Q:'$D(DR(%,DI))
"RTN","DIETED",104,0)
 S:%["." @DRR=@DRR_U_%_";",DIAP=DIAP+1 S DIAR=%
"RTN","DIETED",105,0)
 S DIAP(F)=DIAP,DIAP=0,DIETAB(F)=DIETAB Q
"RTN","DIETED",106,0)
 ;
"RTN","DIETED",107,0)
DEF S X=DIETSAVE D  S X=$P(DIETSAVE,DIETSL),DV=DV_DIETSL_DP G X:DV[";",DIC ;as in DEF^DIA3
"RTN","DIETED",108,0)
 .S X="DA,DV,DWLC,0)=X" F J=L:-1 Q:I(J)[U  S X="DA("_(L-J+1)_"),"_I(J)_","_X
"RTN","DIETED",109,0)
 .S DICMX="S DWLC=DWLC+1,"_I(J)_X,DA="DR(99,"_DXS_",",X=DP,DQI="X(",DICOMP=L_"T"
"RTN","DIETED",110,0)
 .D EN^DICOMP,DICS^DIA
"RTN","DIETED",111,0)
XEC .I $D(X),Y["m" S DIC("S")="S %=$P(^(0),U,2) I %,$D(^DD(+%,.01,0)),$P(^(0),U,2)[""W"",$D(^DD(DI,Y,0)) "_DIC("S") ;as in XEC^DIA3
"RTN","DIETED",112,0)
 .S Y=0 F  S Y=$O(X(Y)) Q:Y=""  S @(DA_"Y)=X(Y)")
"RTN","DIETED",113,0)
 .S Y=-1 I $D(X) S Y="Q",DXS=DXS+1,DP=U_X D
"RTN","DIETED",114,0)
 ..D  S:'$D(DIAB) DIAB=DIETSAVE ;assume "YOU MEAN as a VARIABLE"
"RTN","DIETED",115,0)
 ...N DIAB D DR
"RTN","DIETED",116,0)
 .I DP="@",DIETSL="//" S DA=U_U
"RTN","DIETED",117,0)
 .Q
"RTN","DIETED",118,0)
 ;
"RTN","DIETED",119,0)
DR ;takes 'Y' and puts it into 'DR' array
"RTN","DIETED",120,0)
 N %,B
"RTN","DIETED",121,0)
 S (DRR,B)=$NA(DR(DIAR,DI)),%=$O(@DRR@(""),-1)
"RTN","DIETED",122,0)
 I % S DRR=$NA(@DRR@(%))
"RTN","DIETED",123,0)
 I '$D(@DRR) S @DRR="",DIAP=0
"RTN","DIETED",124,0)
 I $L(Y)+$L(@DRR)>230 S DRR=$NA(@B@(%+1)),DIAP=DIAP\1000+1*1000,@DRR=""
"RTN","DIETED",125,0)
 S @DRR=@DRR_Y_";"
"RTN","DIETED",126,0)
 S DIAP=DIAP+1
"RTN","DIETED",127,0)
DIAB I $D(DIAB) S ^UTILITY("DIETEDIAB",$J,DIAP#1000,DIAR-1,DI,DIAP\1000)=DIAB K DIAB
"RTN","DIETED",128,0)
 Q
"RTN","DIETED",129,0)
 ;
"RTN","DIETED",130,0)
PUT ;save template
"RTN","DIETED",131,0)
 I '$D(^UTILITY("DIETED",$J)) Q
"RTN","DIETED",132,0)
 N DIC
"RTN","DIETED",133,0)
 S DIC("B")=DIET
"RTN","DIETED",134,0)
SAVEAS S DIC=.402,DIC("A")="Save revised "_DIETED_" as: ",DIC(0)="AEQL",DIC("S")="I $P(^(0),U,4)=DRK"
"RTN","DIETED",135,0)
 D ^DIC
"RTN","DIETED",136,0)
 Q:Y<0  I $O(^DIE(+Y,0))]"" W !,$C(7),"Are you sure you want to overwrite this '",$P(Y,U,2)," 'Template" S %=1 D YN^DICN I %-1 Q:%<2  K DIC("B") G SAVEAS
"RTN","DIETED",137,0)
 L +^DIE(+Y)
"RTN","DIETED",138,0)
 S ^DIE("F"_J(0),$P(Y,U,2),+Y)=1
"RTN","DIETED",139,0)
 S $P(^DIE(+Y,0),U,4)=J(0)
"RTN","DIETED",140,0)
 L -^DIE(+Y)
"RTN","DIETED",141,0)
 D SAVEFLDS(+Y)
"RTN","DIETED",142,0)
 Q
"RTN","DIETED",143,0)
 ;
"RTN","DIETED",144,0)
SAVEFLDS(Y) ;
"RTN","DIETED",145,0)
 N X,DP,DMAX
"RTN","DIETED",146,0)
 Q:'$D(^UTILITY("DIETED",$J))!'$G(Y)
"RTN","DIETED",147,0)
NOW D NOW^%DTC S $P(^DIE(Y,0),U,2)=+$J(%,0,4)
"RTN","DIETED",148,0)
 S $P(^DIE(Y,0),U,5)=$G(DUZ)
"RTN","DIETED",149,0)
 K ^DIE(Y,"DR") M ^DIE(+Y,"DR")=^UTILITY("DIETED",$J)
"RTN","DIETED",150,0)
 K ^DIE(Y,"DIAB") M ^DIE(+Y,"DIAB")=^UTILITY("DIETEDIAB",$J)
"RTN","DIETED",151,0)
 S X=$S('$D(^DIE(+Y,"ROU")):1,^("ROU")'[U:1,$D(^("ROUOLD")):^("ROUOLD"),1:1),DP=+$P(^(0),U,4),DMAX=^DD("ROU") I X'=1,$D(^DD("OS",DISYS,"ZS")) D EN^DIEZ
"RTN","DIETED",152,0)
 D K
"RTN","DIETED",153,0)
 Q
"RTN","DIEZ")
0^8^B18556993^B18519324
"RTN","DIEZ",1,0)
DIEZ ;SFISC/GFT-COMPILE INPUT TEMPLATE ;13SEP2004
"RTN","DIEZ",2,0)
 ;;22.0;VA FileMan;**1,11,159**;Mar 30, 1999;Build 8
"RTN","DIEZ",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DIEZ",4,0)
 I $G(DUZ(0))'="@" W $C(7),$$EZBLD^DIALOG(101) G K
"RTN","DIEZ",5,0)
EN1 D:'$D(DISYS) OS^DII I '$D(^DD("OS",DISYS,"ZS")) W $$EZBLD^DIALOG(820),$C(7) G K
"RTN","DIEZ",6,0)
 S U="^" S:'$G(DTIME) DTIME=300 N L,DNM
"RTN","DIEZ",7,0)
 D SIZ^DIPZ0(8033) G:$D(DTOUT)!($D(DUOUT))!('X) K S DMAX=X Q:$D(DIX)
"RTN","DIEZ",8,0)
TEM K DIC S DIC="^DIE(",DIC(0)="AEQ",DIC("W")="W ?40,""FILE #"",$P(^(0),U,4) W:$D(^(""ROU"")) ?60,^(""ROU"")",DIC("S")="I Y'<1" D ^DIC G:'$D(^DIE(+Y,"DR")) K S DIPZ=+Y
"RTN","DIEZ",9,0)
 D RNM^DIPZ0(8033) G:$D(DTOUT)!($D(DUOUT))!(X="") K S DNM=X K DIC
"RTN","DIEZ",10,0)
 W ! S DIR(0)="Y",DIR("A")=$$EZBLD^DIALOG(8020) D ^DIR K DIR G:'Y!($D(DIRUT)) K
"RTN","DIEZ",11,0)
 S X=DNM,Y=DIPZ K DIPZ
"RTN","DIEZ",12,0)
EN ;
"RTN","DIEZ",13,0)
 W:'$G(DIEZS) ! K ^UTILITY($J),DRN N L,DIEZQ,DIR S DMAX=DMAX-2150,DNM=X,DIEZ=+Y,DRN="",DRD=0,DIEZQ=0
"RTN","DIEZ",14,0)
 S DP=$P(^DIE(DIEZ,0),U,4),DIE=^DIC(DP,0,"GL")
"RTN","DIEZ",15,0)
 I '$D(^DIE(DIEZ,"DR",1,DP)) S ^DIE(DIEZ,"DR",1,DP)=^DIE(DIEZ,"DR")
"RTN","DIEZ",16,0)
 D DT^DICRW S X=-1
"RTN","DIEZ",17,0)
 K T S T(1)=$P(^DIE(DIEZ,0),U),T(2)=$$EZBLD^DIALOG(8033),T(3)=DP D BLD^DIALOG(8024,.T,"","DIR") W:'$G(DIEZS) !,DIR K T
"RTN","DIEZ",18,0)
 D UNCAF(DIEZ)
"RTN","DIEZ",19,0)
 K DOV,^DIE(DIEZ,"RD"),DR S DR=^("DR",1,DP),(DIER,DL)=1,DIEZL=0,DIEZAB=U
"RTN","DIEZ",20,0)
 D NEWROU F %=0:0 S %=$O(^DIE(DIEZ,"DR",99,%)) Q:%=""  F %Y=0:0 S %Y=$O(^DIE(DIEZ,"DR",99,%,%Y)) Q:%Y=""  S F=0,Q=^DIE(DIEZ,"DR",99,%,%Y) D QFF^DIEZ2 S X=" S DR(99,"_%_","_%Y_")="_Q D L^DIEZ2
"RTN","DIEZ",21,0)
 S X=" N DIEZTMP,DIEZAR,DIEZRXR,DIIENS,DIXR K DIEFIRE,DIEBADK S DIEZTMP=$$GETTMP^DIKC1(""DIEZ"")" D L^DIEZ2
"RTN","DIEZ",22,0)
 S X=" M DIEZAR=^DIE("_DIEZ_",""AR"") S DICRREC=""TRIG^DIE17""" D L^DIEZ2
"RTN","DIEZ",23,0)
 N DIEZTMP S DIEZTMP=$$GETTMP^DIKC1("DIEZ")
"RTN","DIEZ",24,0)
 S X=" S:$D(DTIME)[0 DTIME=300 S D0=DA,DIIENS=DA_"","",DIEZ="_DIEZ_",U=""^""" G ^DIEZ0
"RTN","DIEZ",25,0)
 ;
"RTN","DIEZ",26,0)
NEWROU ;
"RTN","DIEZ",27,0)
 K ^UTILITY($J,0) S DQ=0,T=99,L=3
"RTN","DIEZ",28,0)
 S ^UTILITY($J,0,1)=DNM_DRN_" ; "_$P("GENERATED FROM '"_$P(^DIE(DIEZ,0),U,1)_"' INPUT TEMPLATE(#"_DIEZ_"), FILE "_DP,U,DRN="")_";"_$E(DT,4,5)_"/"_$E(DT,6,7)_"/"_$E(DT,2,3)
"RTN","DIEZ",29,0)
 S ^UTILITY($J,0,2)=" D DE G BEGIN"
"RTN","DIEZ",30,0)
 S ^UTILITY($J,0,3)="BEGIN S DNM="""_DNM_DRN_""",DQ=1"
"RTN","DIEZ",31,0)
 I '$D(DRN(+DRN)) S DRN(+DRN)=U
"RTN","DIEZ",32,0)
 Q
"RTN","DIEZ",33,0)
 ;
"RTN","DIEZ",34,0)
EN2(Y,DIEZFLGS,X,DMAX,DIEZRLA,DIEZZMSG) ;Silent or Talking with parameter passing
"RTN","DIEZ",35,0)
 ;and optionally return list of routines built and if successful
"RTN","DIEZ",36,0)
 ;IEN,FLAGS,ROUTINE,RTNMAXSIZE,RTNLISTARRAY,MSGARRAY
"RTN","DIEZ",37,0)
 ;Y=TEMPLATE IEN (required)
"RTN","DIEZ",38,0)
 ;FLAGS="T"alk  (optional)
"RTN","DIEZ",39,0)
 ;X=ROUTINE NAME (required)
"RTN","DIEZ",40,0)
 ;DMAX=ROUTINE SIZE (optional)
"RTN","DIEZ",41,0)
 ;DIEZRLA=ROUTINE LIST ARRAY, by value (optional)
"RTN","DIEZ",42,0)
 ;DIEZZMSG=MESSAGE ARRAY (optional) (default ^TMP)
"RTN","DIEZ",43,0)
 ;*
"RTN","DIEZ",44,0)
 ;DIEZS will be used to indicate "silent" if set to 1
"RTN","DIEZ",45,0)
 ;Write statements are made conditional, if not "silent"
"RTN","DIEZ",46,0)
 ;*
"RTN","DIEZ",47,0)
 N DIEZS,DNM,DIQUIET,DIEZRIEN,DIEZRLAZ,DIEZRLAF
"RTN","DIEZ",48,0)
 N DIK,DIC,%I,DICS
"RTN","DIEZ",49,0)
 S DIEZS=$G(DIEZFLGS)'["T"
"RTN","DIEZ",50,0)
 S:DIEZS DIQUIET=1
"RTN","DIEZ",51,0)
 I '$D(DIFM) N DIFM S DIFM=1 D
"RTN","DIEZ",52,0)
 .N Y,DIEZFLGS,X,DMAX,DIEZRLA,DIEZS
"RTN","DIEZ",53,0)
 .D INIZE^DIEFU
"RTN","DIEZ",54,0)
 I $G(Y)'>0 D BLD^DIALOG(1700,"IEN for Edit Template missing or invalid") G EN2E
"RTN","DIEZ",55,0)
 I '$D(^DIE(Y,0)) D BLD^DIALOG(1700,"No Edit Template on file with IEN="_Y) G EN2E
"RTN","DIEZ",56,0)
 I $G(X)']"" D BLD^DIALOG(1700,"Routine name missing this Edit Template, IEN="_Y) G EN2E
"RTN","DIEZ",57,0)
 I X'?1U.NU&(X'?1"%"1U.NU) D BLD^DIALOG(1700,"Routine name invalid") G EN2E
"RTN","DIEZ",58,0)
 I $L(X)>7 D BLD^DIALOG(1700,"Routine name too long") G EN2E
"RTN","DIEZ",59,0)
 S DIEZRLA=$G(DIEZRLA,"DIEZRLAZ"),DIEZRIEN=Y
"RTN","DIEZ",60,0)
 S:DIEZRLA="" DIEZRLA="DIEZRLAZ" S:$G(DMAX)<2500!($G(DMAX)>^DD("ROU")) DMAX=^DD("ROU")
"RTN","DIEZ",61,0)
 S DIEZRLAF=""
"RTN","DIEZ",62,0)
 K @DIEZRLA
"RTN","DIEZ",63,0)
 D EN
"RTN","DIEZ",64,0)
 G:'DIEZS!(DIEZRLAF) EN2E
"RTN","DIEZ",65,0)
 D BLD^DIALOG(1700,"Compiling Edit Template (IEN="_DIEZRIEN_")"_$S(DIEZRLAF=0:", routine name too long",1:""))
"RTN","DIEZ",66,0)
EN2E I 'DIEZS D MSG^DIALOG() Q
"RTN","DIEZ",67,0)
 I $G(DIEZZMSG)]"" D CALLOUT^DIEFU(DIEZZMSG)
"RTN","DIEZ",68,0)
 Q
"RTN","DIEZ",69,0)
 ;
"RTN","DIEZ",70,0)
RECOMP S DIX=1 D DIEZ Q:'$D(DIX)  N DIMAX S DIMAX=DMAX
"RTN","DIEZ",71,0)
 F DIX=0:0 S DIX=$O(^DIE(DIX)) Q:DIX'>0  I $D(^(DIX,0)),$D(^("ROU")) S %=$P(^(0),"^",1),X=$E(^("ROU"),2,99) I X]"" S Y=DIX,DMAX=DIMAX D EN
"RTN","DIEZ",72,0)
 ;
"RTN","DIEZ",73,0)
K K %,DDH,DIC,DIX,DIPZ,DMAX,DNM,DTOUT,DIRUT,DIROUT,DUOUT,X,Y Q
"RTN","DIEZ",74,0)
 ;DIALOG #101  'only those with programmer's access'
"RTN","DIEZ",75,0)
 ;       #820  'no way to save routines on the system'
"RTN","DIEZ",76,0)
 ;       #8020 'Should the compilation run now?'
"RTN","DIEZ",77,0)
 ;       #8024 'Compiling template name Input template of file n'
"RTN","DIEZ",78,0)
 ;       #8033 'Input template'
"RTN","DIEZ",79,0)
UNCAF(DIEZ) ;
"RTN","DIEZ",80,0)
 ; for one compiled input template (DIEZ), delete its "AF" entries
"RTN","DIEZ",81,0)
 N %,X S X=""
"RTN","DIEZ",82,0)
 F  S X=$O(^DIE("AF",X)) Q:X=""  K:'X ^(X,DIEZ) S %=0 F  S %=$O(^DIE("AF",X,%)) Q:%'>0  K:$D(^(%,DIEZ)) ^(DIEZ)
"RTN","DIEZ",83,0)
 Q
"RTN","DIEZ",84,0)
 ;
"RTN","DIEZ",85,0)
UNC(DIEZ,DIFLAGS) ;
"RTN","DIEZ",86,0)
 ; DBS: silent entry point to uncompile an input template
"RTN","DIEZ",87,0)
 ; DIEZ = IEN of input template to uncompile
"RTN","DIEZ",88,0)
 ; DIFLAGS = flags:
"RTN","DIEZ",89,0)
 ;     D = compiled routines are also deleted
"RTN","DIEZ",90,0)
 K ^DIE(DIEZ,"ROU")
"RTN","DIEZ",91,0)
 D UNCAF(DIEZ)
"RTN","DIEZ",92,0)
 I $G(DIFLAGS)["D" D
"RTN","DIEZ",93,0)
 . N DINAME S DINAME=$G(^DIE(DIEZ,"ROUOLD")) Q:DINAME=""
"RTN","DIEZ",94,0)
 . N DIROU,DISUF F DISUF="",1:1 D  Q:DIROU=""
"RTN","DIEZ",95,0)
 . . S DIROU=DINAME_DISUF I '$$ROUEXIST^DILIBF(DIROU) S DIROU="" Q
"RTN","DIEZ",96,0)
 . . N X S X=DIROU X ^%ZOSF("DEL")
"RTN","DIEZ",97,0)
 Q
"RTN","DIEZ0")
0^9^B17398012^B16897031
"RTN","DIEZ0",1,0)
DIEZ0 ;SFISC/GFT-COMPILE INPUT TEMPLATE ;13SEP2004
"RTN","DIEZ0",2,0)
 ;;22.0;VA FileMan;**159**;Mar 30, 1999;Build 8
"RTN","DIEZ0",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DIEZ0",4,0)
 D L
"RTN","DIEZ0",5,0)
DL S DQ=0,DK=0,DQFF=0
"RTN","DIEZ0",6,0)
MR S DK=DK+1,DH=$P(DR,";",DK),DI=$P(DH,":",1),(DIEZP,DIEZDUP,DIEZR)="" G:'DI K:DI=0,PB S DPR=$P(DH,"//",2,99),DM=+DI S:DPR]"" DI=$P(DI,"//",1),DH=""
"RTN","DIEZ0",7,0)
 G K:DM=DI S Y=$P(DI,DM,2,99) G MR:Y=""!'$D(^DD(DP,DM,0)) F %=1:1 S X=$P(Y,$C(126),%) Q:X=""  S:X="d" DIEZDUP=X S:X="R" DIEZR=X S:X'="d"&(X'="R")&(X'="T") DIEZP=X D:X="T"
"RTN","DIEZ0",8,0)
 .I $D(^DD(DP,DM,.1)) S DIEZP=^(.1) Q
"RTN","DIEZ0",9,0)
 .I +$P(^DD(DP,DM,0),U,2),$P(^DD(+$P(^(0),U,2),.01,0),U,2)["W",$D(^(.1)) S DIEZP=^(.1)
"RTN","DIEZ0",10,0)
 .Q
"RTN","DIEZ0",11,0)
 S (DI,DM)=+DI G S
"RTN","DIEZ0",12,0)
K S DM=$P(DH,":",2),DM=$S(DM:DM,1:+DI) I DI,$D(^DD(DP,+DI)) G S
"RTN","DIEZ0",13,0)
NX ;
"RTN","DIEZ0",14,0)
 S DI=$O(^DD(DP,+DI)),DIEZP="" S:DI="" DI=-1 G MR:DI'>0,MR:DI>DM
"RTN","DIEZ0",15,0)
S S Y=^DD(DP,+DI,0),DV=$P(Y,U,2)_$E("#",Y["DINUM")_DIEZR_DIEZDUP S:DIEZP=""&'DV DIEZP=$P(Y,U,1)
"RTN","DIEZ0",16,0)
 S X=DIEZP,DW=$P(Y,U,4) G NX:$A(DW)=32 I T>DMAX D SV G:DIEZQ K^DIEZ2 G S
"RTN","DIEZ0",17,0)
 W:'$G(DIEZS) "." S DQ=DQ+1,DI=+DI,DU=$P(Y,U,3),%=" S "
"RTN","DIEZ0",18,0)
 K DIEZOT I DV["O",$D(^(2)) D O^DIEZ2
"RTN","DIEZ0",19,0)
 I DQFF S %=" D:$D(DG)>9 F^DIE17,DE S DQ="_DQ_",",DQFF=0
"RTN","DIEZ0",20,0)
 I DV S Y=X,X=DQ_%_"D=0 K DE(1) ;"_DI D L,DRN G MUL^DIEZ2
"RTN","DIEZ0",21,0)
 S ^UTILITY($J,U,$P(DW,";",1),$P(DW,";",2),DQ)="",T=T+35,X=DQ_%_"DW="""_DW_""",DV="""_DV_""",DU="""",DLB="""_X_""",DIFLD="_DI D L
"RTN","DIEZ0",22,0)
 I $D(DIEZOT) S X=DIEZOT D L K DIEZOT
"RTN","DIEZ0",23,0)
 S DIEZXREF=$O(^DD("IX","F",DP,DI,0))
"RTN","DIEZ0",24,0)
 I $O(^DD(DP,DI,1,0))>0!(DV["a")!DIEZXREF D
"RTN","DIEZ0",25,0)
 . S DQFF=1,X=" S DE(DW)=""C"_DQ_U_DNM_DRN_""""
"RTN","DIEZ0",26,0)
 . S:DIEZXREF X=X_",DE(DW,""INDEX"")=1"
"RTN","DIEZ0",27,0)
 . ;Determine whether this field is part of a field-level key.
"RTN","DIEZ0",28,0)
 . ;Also, build list: DIEZKEY(uniquenessIndex)=""
"RTN","DIEZ0",29,0)
 . ;for those indexes that are uniqueness indexes for keys.
"RTN","DIEZ0",30,0)
 . N DIEZK,DIEZUI
"RTN","DIEZ0",31,0)
 . K DIEZKEY S DIEZK=0
"RTN","DIEZ0",32,0)
 . F  S DIEZK=$O(^DD("KEY","F",DP,DI,DIEZK)) Q:'DIEZK  D
"RTN","DIEZ0",33,0)
 .. S DIEZUI=$P($G(^DD("KEY",DIEZK,0)),U,4) Q:'DIEZUI
"RTN","DIEZ0",34,0)
 .. S:$P($G(^DD("IX",DIEZUI,0)),U,6)="F" DIEZKEY(DIEZUI)=""
"RTN","DIEZ0",35,0)
 . S:$D(DIEZKEY) X=X_",DE(DW,""KEY"")=""$$K"_DQ_""""
"RTN","DIEZ0",36,0)
 . D L
"RTN","DIEZ0",37,0)
 K DIEZXREF
"RTN","DIEZ0",38,0)
X D PR,XREF^DIEZ2:DQFF S %=$P(Y,U,5,99),X=$F(%,"%DT=""") I X,DPR?1"/".E S Y=$F(%,"E",X) I Y S %=$E(%,1,Y-2)_$E(%,Y,999)
"RTN","DIEZ0",39,0)
 I DPR?1"//".E S %=""
"RTN","DIEZ0",40,0)
 D AF^DIEZ2 S X="X"_DQ_" " I "Q"[% S X=X_"Q" D L G NX
"RTN","DIEZ0",41,0)
 S X=X_% D L I DV["F" S X=" I $D(X),X'?.ANP K X" D L
"RTN","DIEZ0",42,0)
 S X=" Q" D L S X=" ;" D L G NX
"RTN","DIEZ0",43,0)
 ;
"RTN","DIEZ0",44,0)
PB I DH="" S:'$D(DOV(DL)) DOV(DL)=0 S DOV(DL)=$O(^DIE(DIEZ,"DR",DIER,DP,DOV(DL))) S:DOV(DL)="" DOV(DL)=-1 G UP:DOV(DL)<0 S DR=^(DOV(DL)),DK=0 G MR
"RTN","DIEZ0",45,0)
 S DQ=DQ+1 I DH?1"@".N S X=DQ_" S DQ="_(DQ+1)_" ;"_DH,^UTILITY($J,"AB",DIEZAB,DH)=DQ_U_DNM_DRN G M
"RTN","DIEZ0",46,0)
 S X=DQ_" D:$D(DG)>9 F^DIE17,DE S Y=U,DQ="_DQ_" " I "Q"[DH S X=X_"G A" G M
"RTN","DIEZ0",47,0)
 I DH?1"^".E S F=0,X=X_$P(DH,U,5,999),Q=$P(DH,U,1,3) D L,DRN,QFF^DIEZ2,DIERN^DIEZ2 S X=" S DGO=""^"_DNM_%_""",DC="_Q_" G DIEZ^DIE0",DRN(%)=$P(DH,U,2)_U_DIERN_U_$P(DH,U,3)_U_U_DQ_U_DRN D L S X="R"_DQ_" D DE G A" D L S X=" ;" G M
"RTN","DIEZ0",48,0)
 S X=X_"D X"_DQ_" D:$D(DIEFIRE)#2 FIREREC^DIE17 G A:$D(Y)[0,A:Y=U S X=Y,DIC(0)=""F"",DW=DQ G OUT^DIE17" D L S X="X"_DQ_" "_DH D L S X=" Q"
"RTN","DIEZ0",49,0)
M D L G MR
"RTN","DIEZ0",50,0)
 ;
"RTN","DIEZ0",51,0)
UP S DQ=DQ+1,X=DQ_" G "_(DL>1)_"^DIE17" D L,^DIEZ1 G:DIEZQ K^DIEZ2 S Y=0
"RTN","DIEZ0",52,0)
LV S Y=$O(DRN(Y)) S:Y="" Y=-1 I Y<0 G ^DIEZ2
"RTN","DIEZ0",53,0)
 S X=DRN(Y) G LV:X=U S DRN=Y,DP=+X,DIER=$P(X,U,2),DL=DIER\1,DIE=U_$P(X,U,3),DIEZL=+$P(X,U,4),DIEZAB=$P(X,U,5)_U_DNM_$P(X,U,6),DR=$S($D(^DIE(DIEZ,"DR",DIER,DP)):^(DP),1:"0:9999999"),DRN(Y)=U D N S:+DR=.01!(DR?1"0:".E) ^(3)=^(3)_"+D G B" G DL
"RTN","DIEZ0",54,0)
 ;
"RTN","DIEZ0",55,0)
PR ;
"RTN","DIEZ0",56,0)
 D DU^DIEZ2:DU]"" S X=" G RE" I DW="0;1",DL>1,DQ=1 S X=X_":'D S DQ=2 G 2"
"RTN","DIEZ0",57,0)
 D PR^DIEZ2:DPR]""
"RTN","DIEZ0",58,0)
L S L=L+1,^UTILITY($J,0,L)=X,T=T+$L(X)+2 S:X?1N.E T=T+15 Q
"RTN","DIEZ0",59,0)
 ;
"RTN","DIEZ0",60,0)
SV D DRN
"RTN","DIEZ0",61,0)
 S X=DQ+1_" D:$D(DG)>9 F^DIE17 G ^"_DNM_%,DQ=% D L,^DIEZ1 Q:DIEZQ
"RTN","DIEZ0",62,0)
N G NEWROU^DIEZ
"RTN","DIEZ0",63,0)
 ;
"RTN","DIEZ0",64,0)
DRN F %=DRN+1:1 Q:'$D(DRN(%))
"RTN","DIEZ2")
0^10^B48725159^B47298614
"RTN","DIEZ2",1,0)
DIEZ2 ;SFISC/GFT-COMPILE INPUT TEMPLATE ;20SEP2004
"RTN","DIEZ2",2,0)
 ;;22.0;VA FileMan;**11,95,159**;Mar 30, 1999;Build 8
"RTN","DIEZ2",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DIEZ2",4,0)
 K DIEZAR D RECXR^DIEZ4(.DIEZAR)
"RTN","DIEZ2",5,0)
 K ^DIE(DIEZ,"AR") M:$D(DIEZAR) ^DIE(DIEZ,"AR")=DIEZAR
"RTN","DIEZ2",6,0)
 S %X="^UTILITY($J,""AF"",",%Y="^DIE(""AF""," D %XY^%RCR
"RTN","DIEZ2",7,0)
 K ^DIE(DIEZ,"AB") S %X="^UTILITY($J,""AB"",",%Y="^DIE(DIEZ,""AB""," D %XY^%RCR
"RTN","DIEZ2",8,0)
 S ^DIE(DIEZ,"ROUOLD")=DNM,^("ROU")=U_DNM
"RTN","DIEZ2",9,0)
K K ^DIBT(.402,1,DIEZ),^UTILITY($J)
"RTN","DIEZ2",10,0)
 K @DIEZTMP,DIEZTMP,DIEZAR,DIER,DIERN
"RTN","DIEZ2",11,0)
 K DIE,DINC,DK,DL,DMAX,DNR,DP,DQ,DQFF,DRD,DS,DSN,DV,DW,DI,DH,%,%X,%Y,%H,X,Y
"RTN","DIEZ2",12,0)
 K DIEZ,DIEZDUP,DIEZR,Q,DPP,DPR,DM,DR,DU,T,F,DRN,DOV,DIEZL,DIEZP,DIEZAB
"RTN","DIEZ2",13,0)
 Q
"RTN","DIEZ2",14,0)
 ;
"RTN","DIEZ2",15,0)
XREF ;
"RTN","DIEZ2",16,0)
 N DIEZR,DIEZX,DIEZLN
"RTN","DIEZ2",17,0)
 S X="C"_DQ_" G C"_DQ_"S:$D(DE("_DQ_"))[0 K DB" D L
"RTN","DIEZ2",18,0)
 S DIEZX=L,DIEZLN=0 ;remember cross-refs will start after 'L'
"RTN","DIEZ2",19,0)
 F %=0:0 S %=$O(^DD(DP,DI,1,%)) Q:%'>0  S DW=^(%,2),X=" S X=DE("_DQ_"),DIC=DIE" D SK ;first build the KILL XREFS
"RTN","DIEZ2",20,0)
 I DV["a" S X=" S X=DE("_DQ_"),DIIX=2_U_DIFLD D AUDIT^DIET" D X
"RTN","DIEZ2",21,0)
 ;I X]"" S X="C"_DQ_" ;" D L
"RTN","DIEZ2",22,0)
 D OVERFLO
"RTN","DIEZ2",23,0)
 S X="C"_DQ_"S S X="""" G:DG(DQ)=X C"_DQ_"F1 K DB" D L S X=""
"RTN","DIEZ2",24,0)
 S DIEZX=L,DIEZLN=L
"RTN","DIEZ2",25,0)
 F %=0:0 S %=$O(^DD(DP,DI,1,%)) Q:%'>0  S DW=^(%,1),X=X_" S X=DG(DQ),DIC=DIE" D SK ;then the SET XREFS
"RTN","DIEZ2",26,0)
 I DV["a" S X=X_" I $D(DE("_DQ_"))'[0!(^DD(DP,DIFLD,""AUDIT"")'=""e"") S X=DG(DQ),DIIX=3_U_DIFLD D AUDIT^DIET" D X
"RTN","DIEZ2",27,0)
 D OVERFLO
"RTN","DIEZ2",28,0)
 ;Build index code and code to check key
"RTN","DIEZ2",29,0)
 D INDEX
"RTN","DIEZ2",30,0)
 S X=X_" Q" D L
"RTN","DIEZ2",31,0)
 I $D(DIEZKEY) D GETKEY^DIEZ3(DP,DI,.DIEZKEY,DQ) K DIEZKEY
"RTN","DIEZ2",32,0)
 Q
"RTN","DIEZ2",33,0)
 ;
"RTN","DIEZ2",34,0)
SK D X I "Q"[DW S X=" ;" G X
"RTN","DIEZ2",35,0)
 I DW["Q",^DD(DP,DI,1,%,0)["MUMPS" S Q=DW,F=0 D QFF S X=" X "_Q G X
"RTN","DIEZ2",36,0)
 S X=" "_DW
"RTN","DIEZ2",37,0)
X D L S DIEZLN=DIEZLN+$L(X),X="" Q
"RTN","DIEZ2",38,0)
 ;
"RTN","DIEZ2",39,0)
OVERFLO I DIEZLN+T+100<DMAX!'DIEZLN Q
"RTN","DIEZ2",40,0)
 K ^UTILITY($J,"DIEZXR") M ^UTILITY($J,"DIEZXR")=^UTILITY($J,0)
"RTN","DIEZ2",41,0)
 S DIEZR=DRN,(DIEZR(1),DRN)=$O(DRN(""),-1)+1 D
"RTN","DIEZ2",42,0)
 .N T,DQ,L
"RTN","DIEZ2",43,0)
 .D NEWROU^DIEZ ;make a new routine holding just the X-REFS
"RTN","DIEZ2",44,0)
 .F T=2:1 S DIEZX=DIEZX+1 Q:'$D(^UTILITY($J,"DIEZXR",DIEZX))  S ^UTILITY($J,0,T)=^(DIEZX) K ^UTILITY($J,"DIEZXR",DIEZX)
"RTN","DIEZ2",45,0)
 .F  K ^UTILITY($J,0,T) S T=$O(^(T)) Q:'T
"RTN","DIEZ2",46,0)
 .D SAVE^DIEZ1
"RTN","DIEZ2",47,0)
 K ^UTILITY($J,0) M ^UTILITY($J,0)=^UTILITY($J,"DIEZXR")
"RTN","DIEZ2",48,0)
 S DRN=DIEZR,T=T-DIEZLN,X=" D ^"_DNM_DIEZR(1) D L
"RTN","DIEZ2",49,0)
 Q
"RTN","DIEZ2",50,0)
 ;
"RTN","DIEZ2",51,0)
MUL ;
"RTN","DIEZ2",52,0)
 S DNR=%,DW=$P(DW,";",1),X=$P(^DD(+DV,0),U,4)_U_DV_U_DW_U,%=^(.01,0),DV=+DV_$P(%,U,2)
"RTN","DIEZ2",53,0)
 G 1:DV'["W" I DPR]"" S F=0,Q=DPR D QFF S X=" S DE(1,0)="_Q D L
"RTN","DIEZ2",54,0)
 S X=" S Y="""_$S(DIEZP]"":DIEZP_U_$P(%,U,2,9),1:%)_""",DG="""_DW_""",DC=""^"_+DV_""" D DIEN^DIWE K DE(1) G A" D L S X=" ;" D L,AF
"RTN","DIEZ2",55,0)
 S ^UTILITY($J,"AF",+DV,.01,DIEZ)="" D AB G NX^DIEZ0
"RTN","DIEZ2",56,0)
 ;
"RTN","DIEZ2",57,0)
1 S X=" S DIFLD="_DI_",DGO=""^"_DNM_DNR_""",DC="""_X_""",DV="""_DV_""",DW=""0;1"",DOW="""_$S(DIEZP]"":DIEZP,1:$P(^(0),U))_""",DLB=$P($$EZBLD^DIALOG(8042,DOW),"": "") S:D DC=DC_D",DPP=DV["M",DU=$P(^(0),U,3) D L,DU:DU]""
"RTN","DIEZ2",58,0)
 S X=$P(" G RE:D",U,DPP)_" I $D(DSC("_+DV_"))#2,$P(DSC("_+DV_"),""I $D(^UTILITY("",1)="""" X DSC("_+DV_") S D=$O(^(0)) S:D="""" D=-1 G M"_DQ D L
"RTN","DIEZ2",59,0)
 S:+DW'=DW DW=""""_DW_"""" S X=" S D=$S($D("_DIE_"DA,"_DW_",0)):$P(^(0),U,3,4),$O(^(0))'="""":$O(^(0)),1:-1)" D L
"RTN","DIEZ2",60,0)
 S X="M"_DQ_" I D>0 S DC=DC_D I $D("_DIE_"DA,"_DW_",+D,0)) S DE("_DQ_")=$P(^(0),U,1)" D L
"RTN","DIEZ2",61,0)
 D PR^DIEZ0 S X="R"_DQ_" D DE" D L
"RTN","DIEZ2",62,0)
 S X=$S(DPP:" S D=$S($D("_DIE_"DA,"_DW_",0)):$P(^(0),U,3,4),1:1) G "_DQ_"+1",1:" G A") D L S X=" ;" D L,AF,DIERN
"RTN","DIEZ2",63,0)
 S DRN(DNR)=+DV_U_DIERN_DIE_"D"_DIEZL_","_DW_","_U_(DIEZL+1)_U_DQ_U_DRN G NX^DIEZ0
"RTN","DIEZ2",64,0)
 ;
"RTN","DIEZ2",65,0)
DIERN ;
"RTN","DIEZ2",66,0)
 N M S DIERN=DL+1,M=$P(DR,";",DK+1) S:M?1"^"1.NP DK=DK+1,DIERN=$P(M,U,2) Q
"RTN","DIEZ2",67,0)
 ;
"RTN","DIEZ2",68,0)
AF ;
"RTN","DIEZ2",69,0)
 S ^UTILITY($J,"AF",DP,DI,DIEZ)=""
"RTN","DIEZ2",70,0)
AB I '$D(^UTILITY($J,"AB",DIEZAB,DI)) S ^(DI)=DQ_U_DNM_DRN S:DPR?1"/".E ^(DI,"///")=""
"RTN","DIEZ2",71,0)
 Q
"RTN","DIEZ2",72,0)
 ;
"RTN","DIEZ2",73,0)
DU S F=0,Q=DU D QFF S X=" S DU="_Q,DU=""
"RTN","DIEZ2",74,0)
L S L=L+1,^UTILITY($J,0,L)=X,T=T+$L(X)+2 Q
"RTN","DIEZ2",75,0)
 ;
"RTN","DIEZ2",76,0)
O ;
"RTN","DIEZ2",77,0)
 S F=0,Q=^(2) D QFF S DIEZOT=" S DQ("_DQ_",2)="_Q Q
"RTN","DIEZ2",78,0)
 ;
"RTN","DIEZ2",79,0)
PR ;
"RTN","DIEZ2",80,0)
 F %=1,2,3 Q:$E(DPR,%)'="/"
"RTN","DIEZ2",81,0)
 S X=$E(DPR,%,999),Q=X,F=0 D QFF I $A(X)-94 S X=" S Y="_Q
"RTN","DIEZ2",82,0)
 E  S X=" "_$E(X,2,999) D L S X=" S Y=X"
"RTN","DIEZ2",83,0)
 D L S X=" G Y" I %>1 S DPP=0,X=" S X=Y,DB(DQ)=1"_$S(%=3:",DE(DW,""4/"")=""""",1:"")_" G:X="""" N^DIE17:DV,A I $D(DE(DQ)),DV[""I""!(DV[""#"") D E^DIE0 G A:'$D(X)" D L S X=" G "_$S(%=3:"RD:X=""@"",Z",1:"RD")
"RTN","DIEZ2",84,0)
 Q
"RTN","DIEZ2",85,0)
QF ;
"RTN","DIEZ2",86,0)
 S F=0,Q=DIE
"RTN","DIEZ2",87,0)
QFF ;
"RTN","DIEZ2",88,0)
 S F=$F(Q,"""",F) I F S Q=$E(Q,1,F-1)_$E(Q,F-1,999),F=F+1 G QFF
"RTN","DIEZ2",89,0)
 S Q=""""_Q_""""
"RTN","DIEZ2",90,0)
 Q
"RTN","DIEZ2",91,0)
 ;
"RTN","DIEZ2",92,0)
INDEX ;Build code field and record level cross references.
"RTN","DIEZ2",93,0)
 ;In:
"RTN","DIEZ2",94,0)
 ; DP = file #
"RTN","DIEZ2",95,0)
 ; DI = field #
"RTN","DIEZ2",96,0)
 ; DIEZKEY(xref#) = "" : for each xref that is a Uniqueness Index
"RTN","DIEZ2",97,0)
 ;                       for a simple (single-field key)
"RTN","DIEZ2",98,0)
 N DIEZCNT,DIEZFLST,DIEZI,DIEZRLST,DIEZXR,DIEZXREF
"RTN","DIEZ2",99,0)
 S DIEZCNT=0
"RTN","DIEZ2",100,0)
 ;
"RTN","DIEZ2",101,0)
 ;Get field- and record-level xrefs
"RTN","DIEZ2",102,0)
 D LOADFLD^DIKC1(DP,DI,"KS","","@DIEZTMP@(""V"",","DIEZXREF",$NA(@DIEZTMP@("R")),.DIEZFLST,.DIEZRLST)
"RTN","DIEZ2",103,0)
 I DIEZFLST="",DIEZRLST="" S X="C"_DQ_"F1" Q
"RTN","DIEZ2",104,0)
 ;
"RTN","DIEZ2",105,0)
 ;Build code for each field-level xref
"RTN","DIEZ2",106,0)
 ;Save DIEZKEY(uniquenessIndex)=index tag # (DIEZCNT)
"RTN","DIEZ2",107,0)
 I DIEZFLST]"" S DIEZXR=0 F  S DIEZXR=$O(DIEZXREF(DP,DIEZXR)) Q:'DIEZXR  D
"RTN","DIEZ2",108,0)
 . D GETXR(DIEZXR,.DIEZCNT)
"RTN","DIEZ2",109,0)
 . S:$D(DIEZKEY(DIEZXR))#2 DIEZKEY(DIEZXR)=DIEZCNT
"RTN","DIEZ2",110,0)
 ;
"RTN","DIEZ2",111,0)
 ;Build code to set the DIEZRXR array for each record-level xref
"RTN","DIEZ2",112,0)
 S X="C"_DQ_"F"_(DIEZCNT+1)
"RTN","DIEZ2",113,0)
 Q:DIEZRLST=""
"RTN","DIEZ2",114,0)
 S X=X_" S DIEZRXR("_DP_",DIIENS)=$$OREF^DILF($NA(@$$CREF^DILF(DIE)))" D L
"RTN","DIEZ2",115,0)
 S X=" F DIXR="_$TR(DIEZRLST,U,",")_" S DIEZRXR("_DP_",DIXR)=""""" D L
"RTN","DIEZ2",116,0)
 S DIEZI=0 F  S DIEZI=$O(DIEZRLST(DIEZI)) Q:'DIEZI  D
"RTN","DIEZ2",117,0)
 . S X=" F DIXR="_$TR(DIEZRLST(DIEZI),U,",")_" S DIEZRXR("_DP_",DIEZIENS)=""""" D L
"RTN","DIEZ2",118,0)
 ;
"RTN","DIEZ2",119,0)
 S X=""
"RTN","DIEZ2",120,0)
 Q
"RTN","DIEZ2",121,0)
 ;
"RTN","DIEZ2",122,0)
GETXR(DIEZXR,DIEZCNT) ;Get code for one index DIEZXR
"RTN","DIEZ2",123,0)
 N DIEZCOD,DIEZF,DIEZKLOG,DIEZNSS,DIEZSLOG,DIEZO
"RTN","DIEZ2",124,0)
 S DIEZCNT=$G(DIEZCNT)+1
"RTN","DIEZ2",125,0)
 ;
"RTN","DIEZ2",126,0)
 ;Build code to call subroutine to set X array
"RTN","DIEZ2",127,0)
 S X="C"_DQ_"F"_DIEZCNT_$S(DIEZCNT=1:" N X,X1,X2",1:"")_" S DIXR="_DIEZXR_" D C"_DQ_"X"_DIEZCNT_"(U) K X2 M X2=X D C"_DQ_"X"_DIEZCNT_"(""O"") K X1 M X1=X"
"RTN","DIEZ2",128,0)
 D L
"RTN","DIEZ2",129,0)
 ;
"RTN","DIEZ2",130,0)
 ;Build code to check for null subscripts
"RTN","DIEZ2",131,0)
 S DIEZNSS="",DIEZO=0
"RTN","DIEZ2",132,0)
 F  S DIEZO=$O(DIEZXREF(DP,DIEZXR,DIEZO)) Q:'DIEZO  D
"RTN","DIEZ2",133,0)
 . Q:'$G(DIEZXREF(DP,DIEZXR,DIEZO,"SS"))
"RTN","DIEZ2",134,0)
 . I DIEZNSS="" S DIEZNSS="$G(X("_DIEZO_"))]"""""
"RTN","DIEZ2",135,0)
 . E  S DIEZNSS=DIEZNSS_",$G(X("_DIEZO_"))]"""""
"RTN","DIEZ2",136,0)
 I DIEZNSS]"" S DIEZNSS=" I "_DIEZNSS_" D"
"RTN","DIEZ2",137,0)
 E  S DIEZNSS=" D"
"RTN","DIEZ2",138,0)
 ;
"RTN","DIEZ2",139,0)
 ;Get kill logic and condition
"RTN","DIEZ2",140,0)
 S DIEZKLOG=$G(DIEZXREF(DP,DIEZXR,"K"))
"RTN","DIEZ2",141,0)
 I DIEZKLOG'?."^" D
"RTN","DIEZ2",142,0)
 . S X=DIEZNSS D L
"RTN","DIEZ2",143,0)
 . ;Get kill condition code
"RTN","DIEZ2",144,0)
 . S DIEZCOD=$G(DIEZXREF(DP,DIEZXR,"KC"))
"RTN","DIEZ2",145,0)
 . I DIEZCOD'?."^" D
"RTN","DIEZ2",146,0)
 .. S X=" . N DIEXARR M DIEXARR=X S DIEZCOND=1" D L
"RTN","DIEZ2",147,0)
 .. S X=" . "_DIEZCOD D L
"RTN","DIEZ2",148,0)
 .. S X=" . S DIEZCOND=$G(X) K X M X=DIEXARR Q:'DIEZCOND" D L
"RTN","DIEZ2",149,0)
 . ;Get kill logic
"RTN","DIEZ2",150,0)
 . S X=" . "_DIEZKLOG D L
"RTN","DIEZ2",151,0)
 ;
"RTN","DIEZ2",152,0)
 ;Get set logic and condition
"RTN","DIEZ2",153,0)
 S DIEZSLOG=$G(DIEZXREF(DP,DIEZXR,"S"))
"RTN","DIEZ2",154,0)
 I DIEZSLOG'?."^" D
"RTN","DIEZ2",155,0)
 . S X=" K X M X=X2"_DIEZNSS D L
"RTN","DIEZ2",156,0)
 . ;Get set condition code
"RTN","DIEZ2",157,0)
 . S DIEZCOD=$G(DIEZXREF(DP,DIEZXR,"SC"))
"RTN","DIEZ2",158,0)
 . I DIEZCOD'?."^" D
"RTN","DIEZ2",159,0)
 .. S X=" . N DIEXARR M DIEXARR=X S DIEZCOND=1" D L
"RTN","DIEZ2",160,0)
 .. S X=" . "_DIEZCOD D L
"RTN","DIEZ2",161,0)
 .. S X=" . S DIEZCOND=$G(X) K X M X=DIEXARR Q:'DIEZCOND" D L
"RTN","DIEZ2",162,0)
 . ;Get set logic
"RTN","DIEZ2",163,0)
 . S X=" . "_DIEZSLOG D L
"RTN","DIEZ2",164,0)
 ;
"RTN","DIEZ2",165,0)
 S X=" G C"_DQ_"F"_(DIEZCNT+1) D L
"RTN","DIEZ2",166,0)
 ;
"RTN","DIEZ2",167,0)
 ;Build code to set X array
"RTN","DIEZ2",168,0)
 S DIEZF=$O(DIEZXREF(DP,DIEZXR,0))
"RTN","DIEZ2",169,0)
 S X="C"_DQ_"X"_DIEZCNT_"(DION) K X" D L
"RTN","DIEZ2",170,0)
 S DIEZO=0
"RTN","DIEZ2",171,0)
 F  S DIEZO=$O(DIEZXREF(DP,DIEZXR,DIEZO)) Q:'DIEZO  D
"RTN","DIEZ2",172,0)
 . D BLDDEC(DP,DIEZXR,DIEZO)
"RTN","DIEZ2",173,0)
 S X=" S X=$G(X("_DIEZF_"))" D L
"RTN","DIEZ2",174,0)
 S X=" Q" D L
"RTN","DIEZ2",175,0)
 Q
"RTN","DIEZ2",176,0)
 ;
"RTN","DIEZ2",177,0)
BLDDEC(DP,DIEZXR,DIEZO) ;Build data extraction code
"RTN","DIEZ2",178,0)
 N CODE,NODE,TRANS
"RTN","DIEZ2",179,0)
 ;
"RTN","DIEZ2",180,0)
 S CODE=$G(DIEZXREF(DP,DIEZXR,DIEZO)) Q:CODE?."^"
"RTN","DIEZ2",181,0)
 S TRANS=$G(DIEZXREF(DP,DIEZXR,DIEZO,"T"))
"RTN","DIEZ2",182,0)
 I TRANS'?."^" D
"RTN","DIEZ2",183,0)
 . S X=" "_CODE D L
"RTN","DIEZ2",184,0)
 . D DOTLINE(" I $D(X)#2 "_TRANS)
"RTN","DIEZ2",185,0)
 . S X=" S:$D(X)#2 X("_DIEZO_")=X" D L
"RTN","DIEZ2",186,0)
 E  I $D(DIEZXREF(DP,DIEZXR,DIEZO,"F"))#2,CODE?1"S X=".E D
"RTN","DIEZ2",187,0)
 . S X=" S X("_DIEZO_")"_$E(CODE,4,999) D L
"RTN","DIEZ2",188,0)
 E  D
"RTN","DIEZ2",189,0)
 . S X=" "_CODE D L
"RTN","DIEZ2",190,0)
 . S X=" S:$D(X)#2 X("_DIEZO_")=X" D L
"RTN","DIEZ2",191,0)
 Q
"RTN","DIEZ2",192,0)
 ;
"RTN","DIEZ2",193,0)
DOTLINE(CODE) ;
"RTN","DIEZ2",194,0)
 I CODE[" Q"!(CODE[" Q:") D
"RTN","DIEZ2",195,0)
 . S X=" D" D L
"RTN","DIEZ2",196,0)
 . S X=" ."_CODE D L
"RTN","DIEZ2",197,0)
 E  S X=CODE D L
"RTN","DIEZ2",198,0)
 Q
"RTN","DIWE1")
0^12^B15137861^B12156201
"RTN","DIWE1",1,0)
DIWE1 ;SFISC/GFT-WORD PROCESSING FUNCTION ;4JUN2008
"RTN","DIWE1",2,0)
 ;;22.0;VA FileMan;**159**;Mar 30, 1999;Build 8
"RTN","DIWE1",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DIWE1",4,0)
 G X:$D(DTOUT) I '$D(DWL) S I=DWLC,J=$S(I<11:1,1:I-8) W:J>1 ?7,". . .",!?7,". . ." D LL
"RTN","DIWE1",5,0)
1 G X:$D(DTOUT) R !,"EDIT Option: ",X:DTIME S:'$T DTOUT=1 G X:U[X!(X=".")
"RTN","DIWE1",6,0)
LC I X?1L S X=$C($A(X)-32)
"RTN","DIWE1",7,0)
 S J="^DOPT(""DIWE1""," I X?1U S I=$F(DWO,X)-1 I I>0 S ^DISV(DUZ,J)=I S I=I*2-1 G OPT
"RTN","DIWE1",8,0)
 I X=" ",$D(^DISV(DUZ,J)) S I=^(J),X=$E(DWO,I) I X]"" W X S I=I*2-1 G OPT
"RTN","DIWE1",9,0)
 I X?1N.N S I=9 D LN G E2:X W "OR"
"RTN","DIWE1",10,0)
 W !?5,"Choose, by first letter, a Word Processing Command"
"RTN","DIWE1",11,0)
 I X?2"?".E W " from the following:" F I=1:2 S Y=$T(OPT+I),J=$E(Y,1) Q:J=" "  I DWO[J W !?10,$P(Y,";",4)
"RTN","DIWE1",12,0)
 W !?5,"or type a Line Number to edit that line." G 1
"RTN","DIWE1",13,0)
 ;
"RTN","DIWE1",14,0)
OPT Q:$D(DTOUT)  S X1=$T(OPT+I),X=$P(X1,";",3) W $E(X,'$X)_$E(X,2,99) G @$E(X1,1)
"RTN","DIWE1",15,0)
A ;;Add lines;Add Lines to End of Text
"RTN","DIWE1",16,0)
 D ^DIWE2 S (DWL,DWLC)=DWI,@(DIC_"0)=DWLC") G 1:DWLC,X
"RTN","DIWE1",17,0)
B ;;Break line: ;Break a Line into Two;
"RTN","DIWE1",18,0)
 D RD G B^DIWE4
"RTN","DIWE1",19,0)
C ;;Change every: ;Change Every String to Another in a Range of Lines;
"RTN","DIWE1",20,0)
 G C^DIWE2
"RTN","DIWE1",21,0)
D ;;Delete from line: ;Delete Line(s);
"RTN","DIWE1",22,0)
 D RD G D^DIWE3
"RTN","DIWE1",23,0)
E ;;Edit line: ;Edit a Line (Replace __  With __);
"RTN","DIWE1",24,0)
 D RD G OPT:X="",1:X=U,LC:X?1A,E2
"RTN","DIWE1",25,0)
G ;;Get Data from Another Source ;Get Data from Another Source
"RTN","DIWE1",26,0)
 G X^DIWE5
"RTN","DIWE1",27,0)
I ;;Insert after line: ;Insert Line(s) after an Existing Line;
"RTN","DIWE1",28,0)
 D RD G I^DIWE2
"RTN","DIWE1",29,0)
J ;;Join line: ;Join Line to the One Following;
"RTN","DIWE1",30,0)
 D RD G J^DIWE4
"RTN","DIWE1",31,0)
L ;;List line: ;List a Range of Lines;
"RTN","DIWE1",32,0)
 S DIWELAST=$S($G(DIWELAST):DIWELAST,1:1) W DIWELAST_"//" R X:DTIME S:'$T X=U,DTOUT=1 S:X="" X=DIWELAST D LN G LIST:X,1:X=U W !,$P(X1,";",3) G L
"RTN","DIWE1",33,0)
M ;;Move line: ;Move Lines to New Location within Text;
"RTN","DIWE1",34,0)
 D RD G M^DIWE3
"RTN","DIWE1",35,0)
P ;;Print from Line: 1//;Print Lines as Formatted Output;
"RTN","DIWE1",36,0)
 R X:DTIME S:'$T X=U,DTOUT=1 S:X="" X=1 D LN,^DIWE4:X G 1
"RTN","DIWE1",37,0)
R ;;Repeat line: ;Repeat Lines at a New Location
"RTN","DIWE1",38,0)
 D RD G R^DIWE3
"RTN","DIWE1",39,0)
S ;;Search for: ;Search for a String
"RTN","DIWE1",40,0)
 G S^DIWE2
"RTN","DIWE1",41,0)
T ;;Transfer incoming text after line: ;Transfer Lines From Another Document
"RTN","DIWE1",42,0)
 D RD,Z^DIWE3 G DIWE1
"RTN","DIWE1",43,0)
U ;;Utilities in Word-Processing;Utility Sub-Menu
"RTN","DIWE1",44,0)
 D ^DIWE11 G 1
"RTN","DIWE1",45,0)
Y ;;Y;Y-Programmer Edit;
"RTN","DIWE1",46,0)
 G Y^DIWE4
"RTN","DIWE1",47,0)
 ;;
"RTN","DIWE1",48,0)
E2 S Y=^(0) S:Y="" Y=" " W !,$J(DWL,3)_">"_Y,! S DIRWP=1 D RW^DIR2 K DIRWP G E2:X?1."?",X:X?1."^"
"RTN","DIWE1",49,0)
TAB I X[$C(9) S X=$P(X,$C(9),1)_$C(124)_"TAB"_$C(124)_$P(X,$C(9),2,999) G TAB
"RTN","DIWE1",50,0)
 S:X]"" ^(0)=X
"RTN","DIWE1",51,0)
 ;check if line is greater than max, DWLW, break line up and treat as an insert
"RTN","DIWE1",52,0)
 I $L(X)>DWLW D
"RTN","DIWE1",53,0)
 . N I,J,DIC1
"RTN","DIWE1",54,0)
 . K ^UTILITY($J,"W") S DIC1=DIC,DIC="^UTILITY($J,""W"",",@(DIC_"0)")=""
"RTN","DIWE1",55,0)
 . F DWI=1:1 Q:$L(X)'>DWLW  S J=$F(X," ",DWLW-7),J=$S(J<1!(J>DWLW):DWLW,1:J),@(DIC_"DWI,0)")=$E(X,1,J-1),X=$E(X,J,256)
"RTN","DIWE1",56,0)
 . S @(DIC_"DWI,0)")=X
"RTN","DIWE1",57,0)
 . W !,(DWI-1)_" line"_$E("s",DWI>2)_" inserted.."
"RTN","DIWE1",58,0)
 . X "F J=DWL+1:1:DWLC S DWI=DWI+1,"_DIC_"DWI,0)="_DIC1_"J,0) W ""."""
"RTN","DIWE1",59,0)
 . S I=DWL X "F J=1:1 Q:'$D("_DIC_"J,0))  S "_DIC1_"I,0)=^(0),I=I+1 W ""."""
"RTN","DIWE1",60,0)
 . S DWLC=I-1,DIC=DIC1 K ^UTILITY($J,"W")
"RTN","DIWE1",61,0)
 E  I X="@" S (DW1,DW2)=DWL W "DELETED..." D DEL^DIWE3
"RTN","DIWE1",62,0)
 W ! S I=9 G OPT
"RTN","DIWE1",63,0)
 ;
"RTN","DIWE1",64,0)
RD R X:DTIME S:'$T DTOUT=1 I X?1."?" W !?5,"Enter a line number from 1 through "_DWLC,!!,$P(X1,";",3) G RD
"RTN","DIWE1",65,0)
LN I U[X!(X=".") S X=U Q
"RTN","DIWE1",66,0)
 Q:I=9&(X?1A)  I 'DWLC,I<27,I-13 S X=U W "  THERE ARE NO LINES!",$C(7),! Q
"RTN","DIWE1",67,0)
 I "+- "[$E(X,1),X?1P.N,$D(DWL) S:X?1P X=X_1 S X=X+DWL W "  "_X
"RTN","DIWE1",68,0)
 E  S X=+X
"RTN","DIWE1",69,0)
 I (I=13!(I=27)&(X=0))!$D(@(DIC_"X,0)")) S DWL=X Q
"RTN","DIWE1",70,0)
 S X="" G LNQ^DIWE5
"RTN","DIWE1",71,0)
 ;
"RTN","DIWE1",72,0)
X K DIWELAST
"RTN","DIWE1",73,0)
 G X^DIWE
"RTN","DIWE1",74,0)
 ;
"RTN","DIWE1",75,0)
LIST W "  to: "_DWLC_"// " R I:DTIME S:'$T DTOUT=1 S I=$S(I="":DWLC,1:I) I I,I>DWLC!(I<1) S I=DWLC
"RTN","DIWE1",76,0)
 S J=X,DIWELAST=$S(DWLC=I:1,1:I) D LL G 1
"RTN","DIWE1",77,0)
LL X "F J=J:1:I W !,$J(J,3)_"">""_"_DIC_"J,0)"
"VER")
8^22.0
"BLD",748,6)
^139
**END**
**END**
