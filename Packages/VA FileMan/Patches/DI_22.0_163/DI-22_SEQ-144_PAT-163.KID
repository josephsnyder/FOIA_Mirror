Released DI*22*163 SEQ #144
Extracted from mail message
**KIDS**:DI*22.0*163^

**INSTALL NAME**
DI*22.0*163
"BLD",769,0)
DI*22.0*163^VA FILEMAN^0^3100330^y
"BLD",769,1,0)
^^2^2^3091102^^^^
"BLD",769,1,1,0)
See patch DI*22*163 in the National Patch Module on FORUM for complete
"BLD",769,1,2,0)
information on this patch.
"BLD",769,4,0)
^9.64PA^^
"BLD",769,6)
3^
"BLD",769,6.3)
28
"BLD",769,"ABPKG")
n
"BLD",769,"INID")
^n
"BLD",769,"INIT")
POST^DIPR163
"BLD",769,"KRN",0)
^9.67PA^779.2^20
"BLD",769,"KRN",.4,0)
.4
"BLD",769,"KRN",.401,0)
.401
"BLD",769,"KRN",.402,0)
.402
"BLD",769,"KRN",.403,0)
.403
"BLD",769,"KRN",.5,0)
.5
"BLD",769,"KRN",.84,0)
.84
"BLD",769,"KRN",3.6,0)
3.6
"BLD",769,"KRN",3.8,0)
3.8
"BLD",769,"KRN",9.2,0)
9.2
"BLD",769,"KRN",9.8,0)
9.8
"BLD",769,"KRN",9.8,"NM",0)
^9.68A^11^11
"BLD",769,"KRN",9.8,"NM",1,0)
DIT1^^0^B22503370
"BLD",769,"KRN",9.8,"NM",2,0)
DIP11^^0^B21981037
"BLD",769,"KRN",9.8,"NM",3,0)
DIR^^0^B22459740
"BLD",769,"KRN",9.8,"NM",4,0)
DIQ^^0^B47760134
"BLD",769,"KRN",9.8,"NM",5,0)
DIEZ^^0^B21739471
"BLD",769,"KRN",9.8,"NM",6,0)
DIKZ^^0^B29922049
"BLD",769,"KRN",9.8,"NM",7,0)
DIPZ^^0^B17402853
"BLD",769,"KRN",9.8,"NM",8,0)
DIPZ0^^0^B4753333
"BLD",769,"KRN",9.8,"NM",9,0)
DIPR163^^0^B6521718
"BLD",769,"KRN",9.8,"NM",10,0)
DIQGU^^0^B6424161
"BLD",769,"KRN",9.8,"NM",11,0)
DINIT12^^0^B20226922
"BLD",769,"KRN",9.8,"NM","B","DIEZ",5)

"BLD",769,"KRN",9.8,"NM","B","DIKZ",6)

"BLD",769,"KRN",9.8,"NM","B","DINIT12",11)

"BLD",769,"KRN",9.8,"NM","B","DIP11",2)

"BLD",769,"KRN",9.8,"NM","B","DIPR163",9)

"BLD",769,"KRN",9.8,"NM","B","DIPZ",7)

"BLD",769,"KRN",9.8,"NM","B","DIPZ0",8)

"BLD",769,"KRN",9.8,"NM","B","DIQ",4)

"BLD",769,"KRN",9.8,"NM","B","DIQGU",10)

"BLD",769,"KRN",9.8,"NM","B","DIR",3)

"BLD",769,"KRN",9.8,"NM","B","DIT1",1)

"BLD",769,"KRN",19,0)
19
"BLD",769,"KRN",19,"NM",0)
^9.68A^^
"BLD",769,"KRN",19.1,0)
19.1
"BLD",769,"KRN",101,0)
101
"BLD",769,"KRN",409.61,0)
409.61
"BLD",769,"KRN",771,0)
771
"BLD",769,"KRN",779.2,0)
779.2
"BLD",769,"KRN",870,0)
870
"BLD",769,"KRN",8989.51,0)
8989.51
"BLD",769,"KRN",8989.52,0)
8989.52
"BLD",769,"KRN",8994,0)
8994
"BLD",769,"KRN","B",.4,.4)

"BLD",769,"KRN","B",.401,.401)

"BLD",769,"KRN","B",.402,.402)

"BLD",769,"KRN","B",.403,.403)

"BLD",769,"KRN","B",.5,.5)

"BLD",769,"KRN","B",.84,.84)

"BLD",769,"KRN","B",3.6,3.6)

"BLD",769,"KRN","B",3.8,3.8)

"BLD",769,"KRN","B",9.2,9.2)

"BLD",769,"KRN","B",9.8,9.8)

"BLD",769,"KRN","B",19,19)

"BLD",769,"KRN","B",19.1,19.1)

"BLD",769,"KRN","B",101,101)

"BLD",769,"KRN","B",409.61,409.61)

"BLD",769,"KRN","B",771,771)

"BLD",769,"KRN","B",779.2,779.2)

"BLD",769,"KRN","B",870,870)

"BLD",769,"KRN","B",8989.51,8989.51)

"BLD",769,"KRN","B",8989.52,8989.52)

"BLD",769,"KRN","B",8994,8994)

"BLD",769,"PRE")
DIPR163
"BLD",769,"QUES",0)
^9.62^^
"BLD",769,"REQB",0)
^9.611^7^6
"BLD",769,"REQB",2,0)
DI*22.0*63^1
"BLD",769,"REQB",3,0)
DI*22.0*30^1
"BLD",769,"REQB",4,0)
DI*22.0*140^1
"BLD",769,"REQB",5,0)
DI*22.0*159^1
"BLD",769,"REQB",6,0)
DI*22.0*160^1
"BLD",769,"REQB",7,0)
DI*22.0*104^1
"BLD",769,"REQB","B","DI*22.0*104",7)

"BLD",769,"REQB","B","DI*22.0*140",4)

"BLD",769,"REQB","B","DI*22.0*159",5)

"BLD",769,"REQB","B","DI*22.0*160",6)

"BLD",769,"REQB","B","DI*22.0*30",3)

"BLD",769,"REQB","B","DI*22.0*63",2)

"INIT")
POST^DIPR163
"MBREQ")
0
"PKG",5,-1)
1^1
"PKG",5,0)
VA FILEMAN^DI^FM INIT
"PKG",5,20,0)
^9.402P^^
"PKG",5,22,0)
^9.49I^1^1
"PKG",5,22,1,0)
22.0^2990330^3080318^1163
"PKG",5,22,1,"PAH",1,0)
163^3100330
"PKG",5,22,1,"PAH",1,1,0)
^^2^2^3100330
"PKG",5,22,1,"PAH",1,1,1,0)
See patch DI*22*163 in the National Patch Module on FORUM for complete
"PKG",5,22,1,"PAH",1,1,2,0)
information on this patch.
"PRE")
DIPR163
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
11
"RTN","DIEZ")
0^5^B21739471^B18556993
"RTN","DIEZ",1,0)
DIEZ ;SFISC/GFT-COMPILE INPUT TEMPLATE ;19JAN2010
"RTN","DIEZ",2,0)
 ;;22.0;VA FileMan;**1,11,159,163**;Mar 30, 1999;Build 28
"RTN","DIEZ",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DIEZ",4,0)
 I $G(DUZ(0))'="@" W $C(7),$$EZBLD^DIALOG(101) G K
"RTN","DIEZ",5,0)
EN1 D:'$D(DISYS) OS^DII I '$D(^DD("OS",DISYS,"ZS")) W $$EZBLD^DIALOG(820),$C(7) G K
"RTN","DIEZ",6,0)
 S U="^" S:'$G(DTIME) DTIME=300 N L,DNM
"RTN","DIEZ",7,0)
 D SIZ^DIPZ0(8033) G:$D(DTOUT)!($D(DUOUT))!('X) K S DMAX=X Q:$D(DIX)
"RTN","DIEZ",8,0)
TEM K DIC S DIC="^DIE(",DIC(0)="AEQ",DIC("W")="W ?40,""FILE #"",$P(^(0),U,4) W:$D(^(""ROU"")) ?60,^(""ROU"")",DIC("S")="I Y'<1" D ^DIC G:'$D(^DIE(+Y,"DR")) K S DIPZ=+Y
"RTN","DIEZ",9,0)
 D RNM^DIPZ0(8033) G:$D(DTOUT)!($D(DUOUT))!(X="") K S DNM=X K DIC
"RTN","DIEZ",10,0)
 W ! S DIR(0)="Y",DIR("A")=$$EZBLD^DIALOG(8020) D ^DIR K DIR G:'Y!($D(DIRUT)) K
"RTN","DIEZ",11,0)
 S X=DNM,Y=DIPZ K DIPZ
"RTN","DIEZ",12,0)
EN ;
"RTN","DIEZ",13,0)
 W:'$G(DIEZS) ! K ^UTILITY($J),DRN N L,DIEZQ,DIR S DMAX=DMAX-2150,DNM=X,DIEZ=+Y,DRN="",DRD=0,DIEZQ=0 D DELETROU(X)
"RTN","DIEZ",14,0)
 S DP=$P(^DIE(DIEZ,0),U,4),DIE=^DIC(DP,0,"GL")
"RTN","DIEZ",15,0)
 I '$D(^DIE(DIEZ,"DR",1,DP)) S ^DIE(DIEZ,"DR",1,DP)=^DIE(DIEZ,"DR")
"RTN","DIEZ",16,0)
 D DT^DICRW S X=-1
"RTN","DIEZ",17,0)
 K T S T(1)=$P(^DIE(DIEZ,0),U),T(2)=$$EZBLD^DIALOG(8033),T(3)=DP D BLD^DIALOG(8024,.T,"","DIR") W:'$G(DIEZS) !,DIR K T
"RTN","DIEZ",18,0)
 D UNCAF(DIEZ)
"RTN","DIEZ",19,0)
 K DOV,^DIE(DIEZ,"RD"),DR S DR=^("DR",1,DP),(DIER,DL)=1,DIEZL=0,DIEZAB=U
"RTN","DIEZ",20,0)
 D NEWROU F %=0:0 S %=$O(^DIE(DIEZ,"DR",99,%)) Q:%=""  F %Y=0:0 S %Y=$O(^DIE(DIEZ,"DR",99,%,%Y)) Q:%Y=""  S F=0,Q=^DIE(DIEZ,"DR",99,%,%Y) D QFF^DIEZ2 S X=" S DR(99,"_%_","_%Y_")="_Q D L^DIEZ2
"RTN","DIEZ",21,0)
 S X=" N DIEZTMP,DIEZAR,DIEZRXR,DIIENS,DIXR K DIEFIRE,DIEBADK S DIEZTMP=$$GETTMP^DIKC1(""DIEZ"")" D L^DIEZ2
"RTN","DIEZ",22,0)
 S X=" M DIEZAR=^DIE("_DIEZ_",""AR"") S DICRREC=""TRIG^DIE17""" D L^DIEZ2
"RTN","DIEZ",23,0)
 N DIEZTMP S DIEZTMP=$$GETTMP^DIKC1("DIEZ")
"RTN","DIEZ",24,0)
 S X=" S:$D(DTIME)[0 DTIME=300 S D0=DA,DIIENS=DA_"","",DIEZ="_DIEZ_",U=""^""" G ^DIEZ0
"RTN","DIEZ",25,0)
 ;
"RTN","DIEZ",26,0)
NEWROU ;
"RTN","DIEZ",27,0)
 K ^UTILITY($J,0) S DQ=0,T=99,L=3
"RTN","DIEZ",28,0)
 S ^UTILITY($J,0,1)=DNM_DRN_" ; "_$P("GENERATED FROM '"_$P(^DIE(DIEZ,0),U,1)_"' INPUT TEMPLATE(#"_DIEZ_"), FILE "_DP,U,DRN="")_";"_$E(DT,4,5)_"/"_$E(DT,6,7)_"/"_$E(DT,2,3)
"RTN","DIEZ",29,0)
 S ^UTILITY($J,0,2)=" D DE G BEGIN"
"RTN","DIEZ",30,0)
 S ^UTILITY($J,0,3)="BEGIN S DNM="""_DNM_DRN_""",DQ=1"
"RTN","DIEZ",31,0)
 I '$D(DRN(+DRN)) S DRN(+DRN)=U
"RTN","DIEZ",32,0)
 Q
"RTN","DIEZ",33,0)
 ;
"RTN","DIEZ",34,0)
EN2(Y,DIEZFLGS,X,DMAX,DIEZRLA,DIEZZMSG) ;Silent or Talking with parameter passing
"RTN","DIEZ",35,0)
 ;and optionally return list of routines built and if successful
"RTN","DIEZ",36,0)
 ;IEN,FLAGS,ROUTINE,RTNMAXSIZE,RTNLISTARRAY,MSGARRAY
"RTN","DIEZ",37,0)
 ;Y=TEMPLATE IEN (required)
"RTN","DIEZ",38,0)
 ;FLAGS="T"alk  (optional)
"RTN","DIEZ",39,0)
 ;X=ROUTINE NAME (required)
"RTN","DIEZ",40,0)
 ;DMAX=ROUTINE SIZE (optional)
"RTN","DIEZ",41,0)
 ;DIEZRLA=ROUTINE LIST ARRAY, by value (optional)
"RTN","DIEZ",42,0)
 ;DIEZZMSG=MESSAGE ARRAY (optional) (default ^TMP)
"RTN","DIEZ",43,0)
 ;*
"RTN","DIEZ",44,0)
 ;DIEZS will be used to indicate "silent" if set to 1
"RTN","DIEZ",45,0)
 ;Write statements are made conditional, if not "silent"
"RTN","DIEZ",46,0)
 ;*
"RTN","DIEZ",47,0)
 N DIEZS,DNM,DIQUIET,DIEZRIEN,DIEZRLAZ,DIEZRLAF
"RTN","DIEZ",48,0)
 N DIK,DIC,%I,DICS
"RTN","DIEZ",49,0)
 S DIEZS=$G(DIEZFLGS)'["T"
"RTN","DIEZ",50,0)
 S:DIEZS DIQUIET=1
"RTN","DIEZ",51,0)
 I '$D(DIFM) N DIFM S DIFM=1 D
"RTN","DIEZ",52,0)
 .N Y,DIEZFLGS,X,DMAX,DIEZRLA,DIEZS
"RTN","DIEZ",53,0)
 .D INIZE^DIEFU
"RTN","DIEZ",54,0)
 I $G(Y)'>0 D BLD^DIALOG(1700,"IEN for Edit Template missing or invalid") G EN2E
"RTN","DIEZ",55,0)
 I '$D(^DIE(Y,0)) D BLD^DIALOG(1700,"No Edit Template on file with IEN="_Y) G EN2E
"RTN","DIEZ",56,0)
 I $G(X)']"" D BLD^DIALOG(1700,"Routine name missing this Edit Template, IEN="_Y) G EN2E
"RTN","DIEZ",57,0)
 I X'?1U.NU&(X'?1"%"1U.NU) D BLD^DIALOG(1700,"Routine name invalid") G EN2E
"RTN","DIEZ",58,0)
 I $L(X)>7 D BLD^DIALOG(1700,"Routine name too long") G EN2E
"RTN","DIEZ",59,0)
 S DIEZRLA=$G(DIEZRLA,"DIEZRLAZ"),DIEZRIEN=Y
"RTN","DIEZ",60,0)
 S:DIEZRLA="" DIEZRLA="DIEZRLAZ" S:$G(DMAX)<2500!($G(DMAX)>^DD("ROU")) DMAX=^DD("ROU")
"RTN","DIEZ",61,0)
 S DIEZRLAF=""
"RTN","DIEZ",62,0)
 K @DIEZRLA
"RTN","DIEZ",63,0)
 D EN
"RTN","DIEZ",64,0)
 G:'DIEZS!(DIEZRLAF) EN2E
"RTN","DIEZ",65,0)
 D BLD^DIALOG(1700,"Compiling Edit Template (IEN="_DIEZRIEN_")"_$S(DIEZRLAF=0:", routine name too long",1:""))
"RTN","DIEZ",66,0)
EN2E I 'DIEZS D MSG^DIALOG() Q
"RTN","DIEZ",67,0)
 I $G(DIEZZMSG)]"" D CALLOUT^DIEFU(DIEZZMSG)
"RTN","DIEZ",68,0)
 Q
"RTN","DIEZ",69,0)
 ;
"RTN","DIEZ",70,0)
RECOMP S DIX=1 D DIEZ Q:'$D(DIX)  N DIMAX S DIMAX=DMAX
"RTN","DIEZ",71,0)
 F DIX=0:0 S DIX=$O(^DIE(DIX)) Q:DIX'>0  I $D(^(DIX,0)),$D(^("ROU")) S %=$P(^(0),"^",1),X=$E(^("ROU"),2,99) I X]"" S Y=DIX,DMAX=DIMAX D EN
"RTN","DIEZ",72,0)
 ;
"RTN","DIEZ",73,0)
K K %,DDH,DIC,DIX,DIPZ,DMAX,DNM,DTOUT,DIRUT,DIROUT,DUOUT,X,Y Q
"RTN","DIEZ",74,0)
 ;DIALOG #101  'only those with programmer's access'
"RTN","DIEZ",75,0)
 ;       #820  'no way to save routines on the system'
"RTN","DIEZ",76,0)
 ;       #8020 'Should the compilation run now?'
"RTN","DIEZ",77,0)
 ;       #8024 'Compiling template name Input template of file n'
"RTN","DIEZ",78,0)
 ;       #8033 'Input template'
"RTN","DIEZ",79,0)
UNCAF(DIEZ) ;
"RTN","DIEZ",80,0)
 ; for one compiled input template (DIEZ), delete its "AF" entries
"RTN","DIEZ",81,0)
 N %,X S X=""
"RTN","DIEZ",82,0)
 F  S X=$O(^DIE("AF",X)) Q:X=""  K:'X ^(X,DIEZ) S %=0 F  S %=$O(^DIE("AF",X,%)) Q:%'>0  K:$D(^(%,DIEZ)) ^(DIEZ)
"RTN","DIEZ",83,0)
 Q
"RTN","DIEZ",84,0)
 ;
"RTN","DIEZ",85,0)
UNC(DIEZ,DIFLAGS) ;
"RTN","DIEZ",86,0)
 ; DBS: silent entry point to uncompile an input template
"RTN","DIEZ",87,0)
 ; DIEZ = IEN of input template to uncompile
"RTN","DIEZ",88,0)
 ; DIFLAGS = flags:
"RTN","DIEZ",89,0)
 ;     D = compiled routines are also deleted
"RTN","DIEZ",90,0)
 K ^DIE(DIEZ,"ROU")
"RTN","DIEZ",91,0)
 D UNCAF(DIEZ)
"RTN","DIEZ",92,0)
 I $G(DIFLAGS)["D" D
"RTN","DIEZ",93,0)
 . N DINAME S DINAME=$G(^DIE(DIEZ,"ROUOLD")) Q:DINAME=""
"RTN","DIEZ",94,0)
 . N DIROU,DISUF F DISUF="",1:1 D  Q:DIROU=""
"RTN","DIEZ",95,0)
 . . S DIROU=DINAME_DISUF I '$$ROUEXIST^DILIBF(DIROU) S DIROU="" Q
"RTN","DIEZ",96,0)
 . . N X S X=DIROU X ^%ZOSF("DEL")
"RTN","DIEZ",97,0)
 Q
"RTN","DIEZ",98,0)
 ;
"RTN","DIEZ",99,0)
 ;
"RTN","DIEZ",100,0)
DELETROU(DIEZNAME) ;DELETE THE ROUTINES NAMED 'DIEZNAME' CONCATENATED WITH NUMBER
"RTN","DIEZ",101,0)
 Q:DIEZNAME=""  Q:$L($T(+2^@DIEZNAME),";")>2  ;TRY TO KEEP FROM BLOWING AWAY A REAL ROUTINE!
"RTN","DIEZ",102,0)
 N DIEZ,DIEZDEL,X,DIEZEXST,C
"RTN","DIEZ",103,0)
 S C=0,DIEZEXST="I $L($T(^@X))",DIEZDEL=$G(^%ZOSF("DEL")) Q:DIEZDEL=""
"RTN","DIEZ",104,0)
 F DIEZ=1:1:1000 D  Q:C>20  ;STOP IF THERE IS A GAP OF 20
"RTN","DIEZ",105,0)
 .S X=DIEZNAME_DIEZ X DIEZEXST I  X DIEZDEL S C=0 Q
"RTN","DIEZ",106,0)
 .S C=C+1
"RTN","DIEZ",107,0)
 S X=DIEZNAME X DIEZEXST I  X DIEZDEL
"RTN","DIEZ",108,0)
 Q
"RTN","DIKZ")
0^6^B29922049^B29541347
"RTN","DIKZ",1,0)
DIKZ ;SFISC/XAK-XREF COMPILER ;19JAN2010
"RTN","DIKZ",2,0)
 ;;22.0;VA FileMan;**140,163**;Mar 30, 1999;Build 28
"RTN","DIKZ",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DIKZ",4,0)
 I $G(DUZ(0))'="@" W $C(7),$$EZBLD^DIALOG(101) Q
"RTN","DIKZ",5,0)
EN1 N DIKJ,%X D:'$D(DISYS) OS^DII
"RTN","DIKZ",6,0)
 I '$D(^DD("OS",DISYS,"ZS")) W $C(7),$$EZBLD^DIALOG(820) Q
"RTN","DIKZ",7,0)
 S U="^" S:'$G(DTIME) DTIME=300
"RTN","DIKZ",8,0)
 D SIZ^DIPZ0(8036) G:$D(DTOUT)!($D(DUOUT))!('X) Q1 S DMAX=X
"RTN","DIKZ",9,0)
FILE K DIC S DMAX=X,DIC="^DIC(",DIC(0)="AEQ" D ^DIC G Q1:Y'>0 N DIPZ S DIPZ=+Y
"RTN","DIKZ",10,0)
 D RNM^DIPZ0(8036) G:$D(DTOUT)!($D(DUOUT))!(X="") Q1 S DNM=X
"RTN","DIKZ",11,0)
 W ! S DIR(0)="Y",DIR("A")=$$EZBLD^DIALOG(8020) D ^DIR K DIR G:'Y!($D(DIRUT)) Q1
"RTN","DIKZ",12,0)
 S X=DNM,Y=DIPZ K DIPZ
"RTN","DIKZ",13,0)
EN ;
"RTN","DIKZ",14,0)
 S Y(1)=$$EZBLD^DIALOG(8036),Y(3)=Y D BLD^DIALOG(8024,.Y,"","DIR") W:'$G(DIKZS) !!,DIR,! K Y(1),Y(3)
"RTN","DIKZ",15,0)
 K ^UTILITY($J),^UTILITY("DIK",$J) N DIK,DIFILENO
"RTN","DIKZ",16,0)
 S DNM=X,(DH,DIFILENO)=+Y I $D(^DIC(+Y,0,"GL")) S DIK2=^("GL")
"RTN","DIKZ",17,0)
 I '$D(DIK2)!(DMAX<2400) G Q
"RTN","DIKZ",18,0)
 S X=DH D DELETROU^DIEZ(DNM),A^DIU21,WAIT^DICD:'$G(DIKZS),DT^DICRW ;DELETE OLD ROUTINES, DELETE "DIK" NODES
"RTN","DIKZ",19,0)
 S (DRN,DIKZQ,T)=0,DMAX=DMAX-100
"RTN","DIKZ",20,0)
 ;
"RTN","DIKZ",21,0)
 ;Load indexes defined in Index file
"RTN","DIKZ",22,0)
 N DIXRLIST,DIKMF
"RTN","DIKZ",23,0)
 K ^TMP("DIKC",$J)
"RTN","DIKZ",24,0)
 D LOADALL^DIKC1(DIFILENO,"KS","R","",$NA(^TMP("DIKC",$J)),"",.DIKMF)
"RTN","DIKZ",25,0)
 ;
"RTN","DIKZ",26,0)
 ; compile kill logic
"RTN","DIKZ",27,0)
 S (DIKA,A)=1,X=2,DIKVR="DIKILL",DIK=DIK2
"RTN","DIKZ",28,0)
 D Q2,NEWR S ^UTILITY($J,0,3)=" S DIKZK="_X
"RTN","DIKZ",29,0)
 S DIKGO="^"_DNM_1 ;starting ROUTINE name
"RTN","DIKZ",30,0)
 D ^DIKZ0 G:DIKZQ Q D RTE
"RTN","DIKZ",31,0)
 ;
"RTN","DIKZ",32,0)
 ; compile set logic
"RTN","DIKZ",33,0)
 S (DIKA,A)=1,X=1,DIKVR="DISET",DIK=DIK2
"RTN","DIKZ",34,0)
 D Q2,NEWR S ^UTILITY($J,0,3)=" S DIKZK="_X
"RTN","DIKZ",35,0)
 S DIKGO=DIKGO_",^"_DNM_DRN
"RTN","DIKZ",36,0)
 D ^DIKZ0 G:DIKZQ Q D RTE
"RTN","DIKZ",37,0)
 ;
"RTN","DIKZ",38,0)
 ; compile driver code
"RTN","DIKZ",39,0)
 D Q2,^DIKZ1
"RTN","DIKZ",40,0)
 ;
"RTN","DIKZ",41,0)
 ; finish up
"RTN","DIKZ",42,0)
 S:'DIKZQ ^DD(DIFILENO,0,"DIKOLD")=DNM
"RTN","DIKZ",43,0)
Q I DIKZQ S X=DH(1) D A^DIU21
"RTN","DIKZ",44,0)
Q1 K DH,X,Y,DIK4,DIKQ,DIKC,T,DV,DIK8,DU,DW,DW1,DIKGO,DRN,DNM,DTOUT,DIRUT,DIROUT,DUOUT,DIC,A,%,%H,%Y
"RTN","DIKZ",45,0)
 K DIKVR,DIK6,DIKA,DIKR,DMAX,DIK2,DIKCT,DIK1,DIK0,^UTILITY($J),^("DIK"),DIK,DIKZQ,DIKZZ,DIKZZ1,DIKZOVFL
"RTN","DIKZ",46,0)
 K ^TMP("DIKC",$J)
"RTN","DIKZ",47,0)
Q2 K DIKRT,DIKLW,DIKL2
"RTN","DIKZ",48,0)
 Q
"RTN","DIKZ",49,0)
SV ; transfer the accumulated code in ^UTILITY($J,#) to ^UTILITY($J,0,#)
"RTN","DIKZ",50,0)
 ; (the routine buffer) and call SAVE to flush the buffer into a routine
"RTN","DIKZ",51,0)
 ; whenever it's full. Flush the buffer one more time when done.
"RTN","DIKZ",52,0)
 S DNM(1)=DNM_DRN
"RTN","DIKZ",53,0)
 F DIKR=0:0 S DIKR=$O(^UTILITY($J,DIKR)) Q:DIKR'>0  S %=^(DIKR) K ^(DIKR) D:T+$L(%)>DMAX  S ^UTILITY($J,0,DIKR)=%,T=T+$L(%)+2
"RTN","DIKZ",54,0)
 . N DIKZMORE S DIKZMORE=1 D SAVE
"RTN","DIKZ",55,0)
 D SAVE
"RTN","DIKZ",56,0)
 Q
"RTN","DIKZ",57,0)
SAVE ; save the accumulated code in ^UTILITY($J,0,#) as a routine
"RTN","DIKZ",58,0)
 I DIKR,$E($P(%," ",2))="." F  D  Q:$E($P(%," ",2))'="."
"RTN","DIKZ",59,0)
 . S ^UTILITY($J,DIKR)=%
"RTN","DIKZ",60,0)
 . S DIKR=$O(^UTILITY($J,0,DIKR),-1),%=^(DIKR) K ^(DIKR)
"RTN","DIKZ",61,0)
 I $D(DIKLW),'DIKR S ^UTILITY($J,0,997)=" G:'$D(DIKLM) "_$C(64+DIKCT)_$S(DNM_DRN'=DNM(1):"^"_DNM(1),1:"")_" Q:$D("_DIKVR_")"
"RTN","DIKZ",62,0)
 I $D(DIKLW),DIKR S ^UTILITY($J,0,998)=" G ^"_DNM_(DRN+1)
"RTN","DIKZ",63,0)
 S ^UTILITY($J,0,999)="END "_$S($D(DIKRT)&'DIKR:"Q",1:"G "_$S(DIKR&($D(DIKLW)):"END",1:"")_U_DNM_(DRN+1))
"RTN","DIKZ",64,0)
 N X,DIR S X=DNM_DRN X ^DD("OS",DISYS,"ZS") S X(1)=X D BLD^DIALOG(8025,.X,"","DIR") W:'$G(DIKZS) !,DIR S:$G(DIKZRLA)]"" @DIKZRLA@(DNM_DRN)="",DIKZRLAF=1
"RTN","DIKZ",65,0)
 D NEWR:'$D(DIKRT)!$G(DIKZMORE) Q:DIKZQ  S ^DD(DH,0,"DIK")=DNM K DIKL2
"RTN","DIKZ",66,0)
 Q
"RTN","DIKZ",67,0)
NEWR ;
"RTN","DIKZ",68,0)
 I '$D(DIKRT),T,$D(%),T+$L(%)>DMAX S DIKZDH=+$P(^UTILITY($J,0,1),"#",2)
"RTN","DIKZ",69,0)
 K ^UTILITY($J,0) S DIKR=4,T=0,DRN=DRN+1 I $L(DNM_DRN)>8 W:'$G(DIKZS) $C(7),!,DNM_DRN_$$EZBLD^DIALOG(1503) S:$G(DIKZRLA)]"" DIKZRLAF=0 S DIKZQ=1 Q
"RTN","DIKZ",70,0)
 S ^UTILITY($J,0,1)=DNM_DRN_" ; COMPILED XREF FOR FILE #"_$S($D(DIKZDH):DIKZDH,1:DH)_" ; "_$E(DT,4,5)_"/"_$E(DT,6,7)_"/"_$E(DT,2,3),^(2)=" ; "
"RTN","DIKZ",71,0)
 K DIKZDH Q
"RTN","DIKZ",72,0)
RTE ;
"RTN","DIKZ",73,0)
 N DIKFIL,DIKSUB,DIKLIST,DIKP
"RTN","DIKZ",74,0)
 ;Build DIKSUB(file)=subfile1,subfile2,... list
"RTN","DIKZ",75,0)
 S DIKFIL=0 F  S DIKFIL=$O(DIK(X,DIKFIL)) Q:'DIKFIL  D
"RTN","DIKZ",76,0)
 . S DIKSUB=0 F  S DIKSUB=$O(^DD(DIKFIL,"SB",DIKSUB)) Q:'DIKSUB  D
"RTN","DIKZ",77,0)
 .. S:$D(DIK(X,DIKSUB))#2 DIKSUB(DIKFIL)=$G(DIKSUB(DIKFIL))_DIKSUB_","
"RTN","DIKZ",78,0)
 ;
"RTN","DIKZ",79,0)
 ;Build DIKLIST(file)=subfile1,subfile2,...
"RTN","DIKZ",80,0)
 M DIKLIST=DIKSUB
"RTN","DIKZ",81,0)
 S DIKFIL=0 F  S DIKFIL=$O(DIKSUB(DIKFIL)) Q:'DIKFIL  D
"RTN","DIKZ",82,0)
 . S DIKP=0
"RTN","DIKZ",83,0)
 . F  D  Q:DIKP'<($L(DIKLIST(DIKFIL),",")-1)
"RTN","DIKZ",84,0)
 .. F DIKP=DIKP+1:1:$L(DIKLIST(DIKFIL),",")-1 D
"RTN","DIKZ",85,0)
 ... S DIKSUB=$P(DIKLIST(DIKFIL),",",DIKP)
"RTN","DIKZ",86,0)
 ... S DIKLIST(DIKFIL)=DIKLIST(DIKFIL)_$G(DIKSUB(DIKSUB))
"RTN","DIKZ",87,0)
 K DIKSUB
"RTN","DIKZ",88,0)
 ;
"RTN","DIKZ",89,0)
 ;Convert file numbers in DIKLIST to routine list
"RTN","DIKZ",90,0)
 S DIKFIL=0 F  S DIKFIL=$O(DIKLIST(DIKFIL)) Q:'DIKFIL  D
"RTN","DIKZ",91,0)
 . S $E(DIKLIST(DIKFIL),$L(DIKLIST(DIKFIL)))=""
"RTN","DIKZ",92,0)
 . S DIKLIST(DIKFIL)=DIKFIL_","_DIKLIST(DIKFIL)
"RTN","DIKZ",93,0)
 . F DIKP=1:1:$L(DIKLIST(DIKFIL),",") D
"RTN","DIKZ",94,0)
 .. S DIKSUB=$P(DIKLIST(DIKFIL),",",DIKP)
"RTN","DIKZ",95,0)
 .. S $P(DIKLIST(DIKFIL),",",DIKP)=DIK(X,DIKSUB)
"RTN","DIKZ",96,0)
 ;
"RTN","DIKZ",97,0)
 ;Move list to DIK
"RTN","DIKZ",98,0)
 M DIK(X)=DIKLIST
"RTN","DIKZ",99,0)
 K DIKFIL,DIKLIST,DIKP
"RTN","DIKZ",100,0)
 S DIKRT=1,A=A-1,DH=DH(1) G SV
"RTN","DIKZ",101,0)
 ;
"RTN","DIKZ",102,0)
EN2(Y,DIKZFLGS,X,DMAX,DIKZRLA,DIKZZMSG) ;Silent or Talking with parameter passing
"RTN","DIKZ",103,0)
 ;and optionally return list of routines built and if successful
"RTN","DIKZ",104,0)
 ;FILE#,FLAGS,ROUTINE,RTNMAXSIZE,RTNLISTARRAY,MSGARRAY
"RTN","DIKZ",105,0)
 ;Y=FILE NUMBER (required)
"RTN","DIKZ",106,0)
 ;FLAGS="T"alk (optional)
"RTN","DIKZ",107,0)
 ;X=ROUTINE NAME (required)
"RTN","DIKZ",108,0)
 ;DMAX=ROUTINE SIZE (optional)
"RTN","DIKZ",109,0)
 ;DIKZRLA=ROUTINE LIST ARRAY, by value (optional)
"RTN","DIKZ",110,0)
 ;DIKZZMSG=MESSAGE ARRAY (optional) (default ^TMP)
"RTN","DIKZ",111,0)
 ;*
"RTN","DIKZ",112,0)
 ;DIKZS will be used to indicate "silent" if set to 1
"RTN","DIKZ",113,0)
 ;Write statements are made conditional, if not "silent"
"RTN","DIKZ",114,0)
 ;*
"RTN","DIKZ",115,0)
 N DIKZS,DNM,DIQUIET,DIKZRIEN,DIKZRLAZ,%X,DIKJ,DIR,DIKZRLAF,DK1
"RTN","DIKZ",116,0)
 N DIK,DIC,%I,DICS
"RTN","DIKZ",117,0)
 S DIKZS=$G(DIKZFLGS)'["T"
"RTN","DIKZ",118,0)
 S:DIKZS DIQUIET=1
"RTN","DIKZ",119,0)
 I '$D(DIFM) N DIFM S DIFM=1 D
"RTN","DIKZ",120,0)
 .N Y,DIKZFLGS,X,DMAX,DIKZRLA,DIKZS
"RTN","DIKZ",121,0)
 .D INIZE^DIEFU
"RTN","DIKZ",122,0)
 I $G(Y)'>0 D BLD^DIALOG(1700,"File Number missing or invalid") G EN2E
"RTN","DIKZ",123,0)
 I '$D(^DD(Y,0)) D BLD^DIALOG(1700,"File Number: "_Y_" Invalid") G EN2E
"RTN","DIKZ",124,0)
 I $G(X)']"" D BLD^DIALOG(1700,"Routine name missing") G EN2E
"RTN","DIKZ",125,0)
 I X'?1U.NU&(X'?1"%"1U.NU) D BLD^DIALOG(1700,"Routine name invalid") G EN2E
"RTN","DIKZ",126,0)
 I $L(X)>7 D BLD^DIALOG(1700,"Routine name too long") G EN2E
"RTN","DIKZ",127,0)
 S DIKZRLA=$G(DIKZRLA,"DIKZRLAZ"),DIKZRIEN=Y
"RTN","DIKZ",128,0)
 S:DIKZRLA="" DIKZRLA="DIKZRLAZ" S:$G(DMAX)<2500!($G(DMAX)>^DD("ROU")) DMAX=^DD("ROU")
"RTN","DIKZ",129,0)
 S DIKZRLAF=""
"RTN","DIKZ",130,0)
 K @DIKZRLA
"RTN","DIKZ",131,0)
 D EN
"RTN","DIKZ",132,0)
 G:'DIKZS!(DIKZRLAF) EN2E
"RTN","DIKZ",133,0)
 D BLD^DIALOG(1700,"Compiling Cross-references (FILE#:"_DIKZRIEN_")"_$S(DIKZRLAF=0:", routine name too long",1:""))
"RTN","DIKZ",134,0)
EN2E I 'DIKZS D MSG^DIALOG() Q
"RTN","DIKZ",135,0)
 I $G(DIKZZMSG)]"" D CALLOUT^DIEFU(DIKZZMSG)
"RTN","DIKZ",136,0)
 Q
"RTN","DIKZ",137,0)
 ;
"RTN","DIKZ",138,0)
 ;DIALOG #101    'only those with programmer's access'
"RTN","DIKZ",139,0)
 ;       #820    'no way to save routines on the system'
"RTN","DIKZ",140,0)
 ;       #8020   'Should the compilation run now?'
"RTN","DIKZ",141,0)
 ;       #8024   'Compiling template name Input template of file n'
"RTN","DIKZ",142,0)
 ;       #8036   'Cross-References'
"RTN","DIKZ",143,0)
 ;       #8025   'Routine filed'
"RTN","DIKZ",144,0)
 ;       #1503   'routine name is too long...'
"RTN","DINIT12")
0^11^B20226922^B20522056
"RTN","DINIT12",1,0)
DINIT12 ;SFISC/GFT,XAK-INITIALIZE VA FILEMAN ;16FEB2010
"RTN","DINIT12",2,0)
 ;;22.0;VA FileMan;**104,163**;Mar 30, 1999;Build 28
"RTN","DINIT12",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DINIT12",4,0)
DD F I=1:1 S X=$T(DD+I),Y=$P(X," ",3,99) G T:X?.P S @("^DD("_$E($P(X," ",2),3,99)_")=Y")
"RTN","DINIT12",5,0)
 ;;.4,0 FIELD^^1819^21
"RTN","DINIT12",6,0)
 ;;.4,0,"DT" 2950909
"RTN","DINIT12",7,0)
 ;;.4,.01,0 NAME^F^^0;1^K:$L(X)<2!($L(X)>30) X
"RTN","DINIT12",8,0)
 ;;.4,.01,1,0 ^.1^2^2
"RTN","DINIT12",9,0)
 ;;.4,.01,1,1,0 .4^B
"RTN","DINIT12",10,0)
 ;;.4,.01,1,1,1 S @(DIC_"""B"",X,DA)=""""")
"RTN","DINIT12",11,0)
 ;;.4,.01,1,1,2 K @(DIC_"""B"",X,DA)")
"RTN","DINIT12",12,0)
 ;;.4,.01,1,2,0 ^^MUMPS
"RTN","DINIT12",13,0)
 ;;.4,.01,1,2,1 X "S %=$P("_DIC_"DA,0),U,4) S:$L(%) "_DIC_"""F""_+%,X,DA)=1"
"RTN","DINIT12",14,0)
 ;;.4,.01,1,2,2 X "S %=$P("_DIC_"DA,0),U,4) K:$L(%) "_DIC_"""F""_+%,X,DA)"
"RTN","DINIT12",15,0)
 ;;.4,.01,1,3,0 ^^MUMPS
"RTN","DINIT12",16,0)
 ;;.4,.01,1,3,1 Q
"RTN","DINIT12",17,0)
 ;;.4,.01,1,3,2 S X=-1 X "F  S X=$O("_DIC_"""AF"",X)) Q:X=""""  K:'X ^(X,DA) S Y=0 F  S Y=$O("_DIC_"""AF"",X,Y)) Q:Y'>0  K:$D(^(Y,DA)) ^(DA)" S X=-1 S:$G(Y)="" Y=-1
"RTN","DINIT12",18,0)
 ;;.4,.01,3 2-30 CHARACTERS
"RTN","DINIT12",19,0)
 ;;.4,2,0 DATE CREATED^D^^0;2^S %DT="ET" D ^%DT S X=Y K:Y<1 X
"RTN","DINIT12",20,0)
 ;;.4,3,0 READ ACCESS^F^^0;3^I DUZ(0)'="@" F I=1:1:$L(X) I DUZ(0)'[$E(X,I) K X Q
"RTN","DINIT12",21,0)
 ;;.4,4,0 FILE^P1'I^DIC(^0;4^Q
"RTN","DINIT12",22,0)
 ;;.4,4,1,0 ^.1^1^1
"RTN","DINIT12",23,0)
 ;;.4,4,1,1,0 ^^^MUMPS
"RTN","DINIT12",24,0)
 ;;.4,4,1,1,1 X "S %=$P("_DIC_"DA,0),U,1),"_DIC_"""F""_+X,%,DA)=1"
"RTN","DINIT12",25,0)
 ;;.4,4,1,1,2 Q
"RTN","DINIT12",26,0)
 ;;.4,5,0 USER #^N^^0;5^Q
"RTN","DINIT12",27,0)
 ;;.4,6,0 WRITE ACCESS^F^^0;6^I DUZ(0)'="@" F I=1:1:$L(X) I DUZ(0)'[$E(X,I) K X Q
"RTN","DINIT12",28,0)
 ;;.4,7,0 DATE LAST USED^D^^0;7^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"RTN","DINIT12",29,0)
 ;;.4,1815,0 ROUTINE INVOKED^F^^ROU;E1,13^Q
"RTN","DINIT12",30,0)
 ;;.4,1815,9 @
"RTN","DINIT12",31,0)
 ;;.4,1815,1,0 ^.1^1^1
"RTN","DINIT12",32,0)
 ;;.4,1815,1,1,0 ^^^MUMPS
"RTN","DINIT12",33,0)
 ;;.4,1815,1,1,1 Q
"RTN","DINIT12",34,0)
 ;;.4,1815,1,1,2 D DELETROU^DIEZ($TR(X,U))
"RTN","DINIT12",35,0)
 ;;.4,1816,0 PREVIOUS ROUTINE INVOKED^F^^ROUOLD;E1,13^Q
"RTN","DINIT12",36,0)
 ;;.4,1816,9 @
"RTN","DINIT12",37,0)
 ;;.4,10,0 DESCRIPTION^.4001^^%D;0
"RTN","DINIT12",38,0)
 ;;.4001,0 DESCRIPTION SUB-FIELD^^.01^1
"RTN","DINIT12",39,0)
 ;;.4001,0,"NM","DESCRIPTION"
"RTN","DINIT12",40,0)
 ;;.4001,0,"UP" .4
"RTN","DINIT12",41,0)
 ;;.4001,.01,0 DESCRIPTION^W^^0;1^Q
"RTN","DINIT12",42,0)
 ;
"RTN","DINIT12",43,0)
T ;
"RTN","DINIT12",44,0)
 ;;N D,D1,D2 S D2=^(0) S:$X>30 D1(1,"F")="!" S D=$P(D2,U,2) S:D D1(2)="("_$$FMTE^DILIBF(D)_")",D1(2,"F")="?30" S D=$P(D2,U,5) S:D D1(3)=" User #"_D,D1(3,"F")="?50" S D=$P(D2,U,4) S:D D1(4)=" File #"_D,D1(4,"F")="?59" D EN^DDIOL(.D1)
"RTN","DINIT12",45,0)
 S ^DD(.4,0,"ID","WRITE")=$P($T(T+1),";",3,99)
"RTN","DINIT12",46,0)
 S %X="^DD(.4," S %Y="^DD(.402," D %XY^%RCR
"RTN","DINIT12",47,0)
 S %X="^DD(.4001," S %Y="^DD(.4021," D %XY^%RCR
"RTN","DINIT12",48,0)
 K ^DD(.402,1804),^("SB",.404),^DD(.402,"GL","RD",0,1804)
"RTN","DINIT12",49,0)
 S ^DIC(.4,"%D",0)="^^3^3^2940908^"
"RTN","DINIT12",50,0)
 S ^DIC(.4,"%D",1,0)="This file stores the PRINT FIELDS data and other information about print"
"RTN","DINIT12",51,0)
 S ^DIC(.4,"%D",2,0)="templates.  These templates are used in the Print, Filegram, Extract, and"
"RTN","DINIT12",52,0)
 S ^DIC(.4,"%D",3,0)="Export options."
"RTN","DINIT12",53,0)
 S ^DIC(.402,"%D",0)="^^1^1^2940908^^"
"RTN","DINIT12",54,0)
 S ^DIC(.402,"%D",1,0)="This file stores the EDIT FIELDS data from an input template."
"RTN","DINIT12",55,0)
DD1 F I=1:1 S X=$T(DD1+I),Y=$P(X," ",3,99) G DD2:X?.P S @("^DD("_$E($P(X," ",2),3,99)_")=Y")
"RTN","DINIT12",56,0)
 ;;.4,0,"ID","WRIT" I $P(^(0),U,8) N D1 S @("D1=$P($P($C(59)_$S($D(^DD(.4,8,0)):$P(^(0),U,3),1:0)_$E("_DIC_"Y,0),0),$C(59)_$P(^(0),U,8)_"":"",2),$C(59),1)") D EN^DDIOL("**"_D1_"**","","?0")
"RTN","DINIT12",57,0)
 ;;.4,0,"ID","WRITED" I $G(DZ)?1"???".E N % S %=0 F  S %=$O(^DIPT(Y,"%D",%)) Q:%'>0  I $D(^(%,0))#2 D EN^DDIOL(^(0),"","!?5")
"RTN","DINIT12",58,0)
 ;;.402,0,"ID","WRITED" I $G(DZ)?1"???".E N % S %=0 F  S %=$O(^DIE(Y,"%D",%)) Q:%'>0  I $D(^(%,0))#2 D EN^DDIOL(^(0),"","!?5")
"RTN","DINIT12",59,0)
 ;;.4,1620,9 ^
"RTN","DINIT12",60,0)
 ;;.4,1620,9.01
"RTN","DINIT12",61,0)
 ;;.4,1620,9.1 D ^DIET
"RTN","DINIT12",62,0)
 ;;.402,1620,0 EDIT FIELDS^Cm^^ ; ^D EN^DIET
"RTN","DINIT12",63,0)
 ;;.402,1620,21,0 ^
"RTN","DINIT12",64,0)
 ;;.402,1620,21,1,0 This multi-line field displays all the "EDIT" prompts of this Input Template
"RTN","DINIT12",65,0)
 ;;.402,1620,23,0 ^
"RTN","DINIT12",66,0)
 ;;.402,1620,23,1,0 This Computed Multiple uses code in ^DIETED to build the entire displayable Input Template.  Then it is output node-by-node.
"RTN","DINIT12",67,0)
 ;;.402,1819,9.1 S X=$S('$D(^DIE(D0,"ROU"))#2:"NO",^("ROU")="":"NO",1:"YES")
"RTN","DINIT12",68,0)
 ;;.4,1819,0 COMPILED^CJ3^^ ; ^S X=$S('$D(^DIPT(D0,"ROU"))#2:"NO",^("ROU")="":"NO",1:"YES")
"RTN","DINIT12",69,0)
 ;;.4,1819,9 ^
"RTN","DINIT12",70,0)
 ;;.4,1819,9.01
"RTN","DINIT12",71,0)
 ;;.4,1819,9.1 S X=$S('$D(^DIPT(D0,"ROU"))#2:"NO",^("ROU")="":"NO",1:"YES")
"RTN","DINIT12",72,0)
 ;;.402,1819,0 COMPILED^CJ3^^ ; ^S X=$S('$D(^DIE(D0,"ROU"))#2:"NO",^("ROU")="":"NO",1:"YES")
"RTN","DINIT12",73,0)
 ;;.402,1819,9.1 S X=$S('$D(^DIE(D0,"ROU"))#2:"NO",^("ROU")="":"NO",1:"YES")
"RTN","DINIT12",74,0)
 ;;
"RTN","DINIT12",75,0)
DD2 N DICNT F DICNT=0:1:7 D @("^DINIT12"_DICNT)
"RTN","DINIT12",76,0)
 K DICNT G ^DINIT13
"RTN","DIP11")
0^2^B21981037^B17961202
"RTN","DIP11",1,0)
DIP11 ;SFISC/XAK,TKW-GET SORT TEMPLATE ;29MAR2010
"RTN","DIP11",2,0)
 ;;22.0;VA FileMan;**97,163*;Mar 30, 1999;Build 28
"RTN","DIP11",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DIP11",4,0)
SCREENTM(Z,D2) ;Z=ZERO NODE OF SORT TEMPLATE;  D2 = THERE IS SORT-BY LOGIC
"RTN","DIP11",5,0)
 I $P(Z,U,4)-DL Q 0 ;TEMPLATE MUST BE FOR THIS FILE
"RTN","DIP11",6,0)
 I 'D2&'L D  Q $D(Z) ;IN SILENT MODE (L=0), DON'T PICK SEARCH OR INQUIRY TYPE IF THERE'S A SORT TYPE OF SAME NAME
"RTN","DIP11",7,0)
 .N NAME,I S NAME=$P(Z,U) F I=0:0 S I=$O(^DIBT("B",NAME,I)) Q:'I  I I-Y,$P($G(^DIBT(I,0)),U,4)=DL,$D(^(2)) K Z Q
"RTN","DIP11",8,0)
 I DUZ(0)="@" Q 1
"RTN","DIP11",9,0)
 I D2 Q:'L 1 Q:$P(Z,U,3)="" 1 Q $TR($P(Z,U,3),DUZ(0))'=$P(Z,U,3) ;IF A SORT TEMPLATE, ACCESS CODES MUST MATCH
"RTN","DIP11",10,0)
 I '$P(Z,U,5) Q 1
"RTN","DIP11",11,0)
 I $P(Z,U,5)=DUZ Q 1 ;If a SEARCH or INQUIRY TEMPLATE, USER MUST MATCH
"RTN","DIP11",12,0)
 Q 0
"RTN","DIP11",13,0)
 ;
"RTN","DIP11",14,0)
TEM ;
"RTN","DIP11",15,0)
 G B^DIP:DJ-1 K DPP,DIC
"RTN","DIP11",16,0)
 S X=$P($E(X,2,99),"]",1),DIC(0)="ZQS"_$E("E",'($D(BY)#2)!''L),DIC="^DIBT(",D="F"_DL
"RTN","DIP11",17,0)
 S DIC("S")="I $$SCREENTM^DIP11(^(0),$D(^(2)))"
"RTN","DIP11",18,0)
 ;I $P(^(0),U,4)=DL,$S(L=0!(DUZ(0)=""@""):1,'$D(^(1)):$TR(DUZ(0),$P(^(^(0),U,6)'=DUZ(0)&$L(DUZ(0),'$P(^(0),U,5):1,1:$P(^(0),U,5)=DUZ),$D(^(1))!'$D(^(""DIS""))"
"RTN","DIP11",19,0)
 I X?."?" S:X'?1"???" X="??" D IX^DIC S DJ=0 Q
"RTN","DIP11",20,0)
 D ^DIC I Y<0 S DJ=0 Q
"RTN","DIP11",21,0)
EMPTY I '$D(^DIBT(+Y,2)),'$D(^(1)) W:'$G(DIQUIET) !,"This SEARCH template has no search results!" S DJ=0 Q
"RTN","DIP11",22,0)
 S DPP(DJ)=DL_"^^'"_$P(Y,U,2)_"' NUMBER^@'"_P,(DIBT1,X)=+Y,DIBT2=$P(Y(0),U),D=DIC_X_C K DIC
"RTN","DIP11",23,0)
 I '$D(FLDS),$G(^DIBT(X,"DIPT"))]"" S FLDS="["_^("DIPT")_"]" I L D
"RTN","DIP11",24,0)
 . N %,A S %(1)=^("DIPT") D BLD^DIALOG(8030,.%,"","A") W ! F %=0:0 S %=$O(A(%)) Q:'%  W A(%),!
"RTN","DIP11",25,0)
 . S L=0 Q
"RTN","DIP11",26,0)
 I $D(^DIBT(X,1)) S DIC=D_1_C,DPP(DJ,"SER")="998^998" D ENT^DIP10(DJ,DIBT1) I $D(^DIBT(X,1)) S Y=1 D
"RTN","DIP11",27,0)
 .F DY=1:1 S Y=$O(^(Y,-1)) S:Y="" Y=-1 S:$O(^(Y)) Y=$O(^(Y)) I $D(^(Y))<9 S DPP(DJ,"IX")=DIC_DI_U_DY,DIBT=X Q
"RTN","DIP11",28,0)
 .Q
"RTN","DIP11",29,0)
ENDIPT I $G(^DIBT(X,"BY0"))="",'$D(^DIBT(X,2)) Q
"RTN","DIP11",30,0)
 I $G(^DIBT(X,"BY0"))="",$G(^DIBT(X,2,0))="" S %Y="DPP(",%X=D_2_C D %XY^%RCR S DIBTOLD="" D CNVCM G T0
"RTN","DIP11",31,0)
 S D=$G(^DIBT(X,"BY0")) I $P(D,U)]"",$P(D,U,2) D
"RTN","DIP11",32,0)
 . N Y K DISPAR(0) S BY(0)="^"_$P(D,U),L(0)=$P(D,U,2)
"RTN","DIP11",33,0)
 . F D=1:1:(L(0)-1) D
"RTN","DIP11",34,0)
 .. S Y=$G(^DIBT(X,"BY0D",D,0))
"RTN","DIP11",35,0)
 .. I '$D(FR(0,D))#2,$P(Y,U,2)]"" S FR(0,D)=$P(Y,U,2)
"RTN","DIP11",36,0)
 .. I '$D(TO(0,D))#2,$P(Y,U,3)]"" S TO(0,D)=$P(Y,U,3)
"RTN","DIP11",37,0)
 .. I $G(^DIBT(X,"BY0D",D,1))]"" S DISPAR(0,D)=^(1) S:$G(^DIBT(X,"BY0D",D,2))]"" DISPAR(0,D,"OUT")=^(2)
"RTN","DIP11",38,0)
 .. Q
"RTN","DIP11",39,0)
 . N X D EN^DIP10 Q
"RTN","DIP11",40,0)
 ;S DJ=$O(DPP(999),-1)+1
"RTN","DIP11",41,0)
 F D=0:0 S D=$O(^DIBT(X,2,D)) Q:'D  D
"RTN","DIP11",42,0)
 .N A,B,C S DPP(DJ)=$G(^DIBT(X,2,D,0))
"RTN","DIP11",43,0)
 .S A="A" F  S A=$O(^DIBT(X,2,D,A)) Q:A=""  I A'="SER" S DPP(DJ,A)=^(A)
"RTN","DIP11",44,0)
 .F B=1,2,3 F A=0:0 S A=$O(^DIBT(X,2,D,B,A)) Q:'A  S C=$G(^(A,0)) D
"RTN","DIP11",45,0)
 ..I B=1 S:$P(C,U)=+C DPP(DJ,+C)=$P(C,U,2) Q
"RTN","DIP11",46,0)
 ..I B=2 S:($P(C,U)=+C)&($P(C,U,2)=+$P(C,U,2)) DPP(DJ,+C,$P(C,U,2))=$P(C,U,3,7)_U_$G(^DIBT(X,2,D,2,A,"RCOD")) Q
"RTN","DIP11",47,0)
 ..I $P(C,U,1)]"",$P(C,U,2)]"" S DPP(DJ,$P(C,U,1),$P(C,U,2))=$G(^DIBT(X,2,D,3,A,"OVF0"))
"RTN","DIP11",48,0)
 ..Q
"RTN","DIP11",49,0)
 .S DJ=DJ+1 Q
"RTN","DIP11",50,0)
T0 Q:$D(DIBTRPT)
"RTN","DIP11",51,0)
 I $D(DIAR) S DIARU=X ;I '$P(DIARB,U,2) S $P(DIARB,U,2)=DIARU
"RTN","DIP11",52,0)
 F D=0:0 S D=$O(^DIBT(X,3,D)) Q:D=""  S DSC(D)=^(D)
"RTN","DIP11",53,0)
 I 'L!($D(DPP(0))&(DUZ(0)'="@")) G T1
"RTN","DIP11",54,0)
 S %=$P(^DIBT(X,0),U,6)
"RTN","DIP11",55,0)
 I %]"" F D=1:1:$L(%) I DUZ(0)[$E(%,D)!(DUZ(0)="@") S %="" Q
"RTN","DIP11",56,0)
 I %="",X'<1 S %=$P(Y(0),U,1) D  G Q:$D(DIRUT) I %=1 K DIBTOLD G EDT^DIP0
"RTN","DIP11",57,0)
 . N X,Y K DIR S DIR(0)="Y",DIR("B")="NO",DIR("A")="WANT TO EDIT '"_%_"' TEMPLATE" D ^DIR K DIR
"RTN","DIP11",58,0)
 . S %=Y Q
"RTN","DIP11",59,0)
T1 F DJ=$G(DPP(0))+1:1 Q:'$D(DPP(DJ))  D  I '$D(DJ)!($D(DTOUT))!($D(DIRUT)) G Q
"RTN","DIP11",60,0)
 . N DL,DU,DV,X,Y,Z,DIFLD,DIFLDREG K DPP(DJ,"PTRIX") S DL=$P(DPP(DJ),U),Y=$P(DPP(DJ),U,2,3)
"RTN","DIP11",61,0)
 . D DTYP^DIP1,STXT^DIP1(DJ,$G(DPP(DJ,"F")),$G(DPP(DJ,"T")),DITYP)
"RTN","DIP11",62,0)
 .; Save off old "IX" node to preserve it if template is hand-edited.
"RTN","DIP11",63,0)
 . I DJ=1 N DISAVIX,DIRECSRT S DISAVIX=$G(DPP(DJ,"IX")),DIRECSRT=0
"RTN","DIP11",64,0)
 . K DPP(DJ,"IX")
"RTN","DIP11",65,0)
 . I $P(DPP(DJ),U,4)'["-",'$D(DPP(DJ,"SRTTXT")),$P($G(DPP(DJ,"F")),U)'="?z",$P($G(DPP(DJ,"T")),U)'="@" D XR^DIP I DJ=1,DISAVIX]"",DISAVIX'=$G(DPP(DJ,"IX")) D
"RTN","DIP11",66,0)
 .. N I,X,Y,Z S X=$P(DISAVIX,U,3),Z=$P(DISAVIX,U,2) I $E(Z,1,$L(X))'=X S DIRECSRT=1 G T12
"RTN","DIP11",67,0)
 .. S Z=$E(Z,($L(X)+1),99),Z=$P(Z,"""",2) Q:Z=""  I '$D(^DD(S,0,"IX",Z)) D  Q:Z=""
"RTN","DIP11",68,0)
 ... Q:S=405&(Z="ATT3")  S Z="" Q
"RTN","DIP11",69,0)
T12 .. S DPP(DJ,"IX")=DISAVIX,DPP(DJ,"SER")="998^998"
"RTN","DIP11",70,0)
 .. I DIRECSRT=1,$P(DPP(DJ),U,2)="",'($P($P(DPP(DJ),U,4),"""",2)),'$D(DPP(DJ,"CM")) S $P(DPP(DJ),U,2)=0
"RTN","DIP11",71,0)
PROMPT . I $D(DPP(DJ,"ASK")) S DPP(DJ,"ASK")=1 I $G(DICNVDPP)'=1 D DIP11^DIP1 Q  ;GFT PATCH 97
"RTN","DIP11",72,0)
 . I DJ=1,DISAVIX=1 Q
"RTN","DIP11",73,0)
 . D OPT^DIP12 Q
"RTN","DIP11",74,0)
 Q:$G(DICNVDPP)=1
"RTN","DIP11",75,0)
 D DPQ^DIP1 S X="["_DIBT2 K DIARE,DIARS,DIARB Q
"RTN","DIP11",76,0)
 ;
"RTN","DIP11",77,0)
CNVCM ;Convert V20 DPP array to V21 DPP array (for prints queued in V20 to run in V21)
"RTN","DIP11",78,0)
 N D,I,J,X,Y,Z,N
"RTN","DIP11",79,0)
 F D=0:0 S D=$O(DPP(D)) Q:'D  S X=$G(DPP(D,"CM")) I X["S X(" D
"RTN","DIP11",80,0)
 . S (I,Z)=0 F  S Y=$F(X,"S X(",Z) Q:'Y  S Z=Y,I=I+1
"RTN","DIP11",81,0)
 . Q:'Z  S N=+$E(X,Z) Q:'N
"RTN","DIP11",82,0)
 . I $L(X)+16>248 D  Q
"RTN","DIP11",83,0)
 .. S Z="OVF",I=-1 F  S Z=$O(DPP(D,Z)) Q:$E(Z,1,3)'="OVF"  S I=$E(Z,4,99)
"RTN","DIP11",84,0)
 .. S Z="OVF"_(I+1),Y=$P(X," S X=",1) S:Y]"" Y=Y_" "
"RTN","DIP11",85,0)
 .. S DPP(D,"CM")=Y_"X DPP("_D_","""_Z_""",9.2) I $G(X("_N_"))]"""" S DISX("_N_")=X("_N_")"
"RTN","DIP11",86,0)
 .. S Y=$P(X," S X=",2,99),DPP(D,Z,9.2)=$P("S X=",U,(Y]""))_Y Q
"RTN","DIP11",87,0)
 . S DPP(D,"CM")=$P(X,"S X(",1,I)_"S DISX("_$P(X,"S X(",I+1,99)
"RTN","DIP11",88,0)
 . Q
"RTN","DIP11",89,0)
 Q
"RTN","DIP11",90,0)
 ;
"RTN","DIP11",91,0)
Q S:$D(DUOUT)!($D(DTOUT)) X="^" G Q^DIP
"RTN","DIP11",92,0)
 ;DIALOG #8030  'Because...sort template...linked w/Print template...
"RTN","DIPR163")
0^9^B6521718^n/a
"RTN","DIPR163",1,0)
DIPR163 ;O-OIFO/GMB-Envirocheck and Post Init ;2/23/2010
"RTN","DIPR163",2,0)
 ;;22.0;VA FileMan;**163**;Mar 30, 1999;Build 28
"RTN","DIPR163",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DIPR163",4,0)
ENV ; Environmental Check
"RTN","DIPR163",5,0)
 D BMES^XPDUTL("Perform Environment Check...")
"RTN","DIPR163",6,0)
 D CHKSTOP
"RTN","DIPR163",7,0)
 D BMES^XPDUTL("Finished Environment Check.")
"RTN","DIPR163",8,0)
 Q
"RTN","DIPR163",9,0)
POST ; Set DD changes to the PRINT TEMPLATE (#.4) file.
"RTN","DIPR163",10,0)
 S ^DD(.4,1815,1,0)="^.1^1^1"
"RTN","DIPR163",11,0)
 S ^DD(.4,1815,1,1,0)="^^^MUMPS"
"RTN","DIPR163",12,0)
 S ^DD(.4,1815,1,1,1)="Q"
"RTN","DIPR163",13,0)
 S ^DD(.4,1815,1,1,2)="D DELETROU^DIEZ($TR(X,U))"
"RTN","DIPR163",14,0)
 S ^DD(.4,"IX",1815)=""
"RTN","DIPR163",15,0)
 ; Set DD changes to the INPUT TEMPLATE (#.402) file.
"RTN","DIPR163",16,0)
 S ^DD(.402,1815,1,0)="^.1^1^1"
"RTN","DIPR163",17,0)
 S ^DD(.402,1815,1,1,0)="^^^MUMPS"
"RTN","DIPR163",18,0)
 S ^DD(.402,1815,1,1,1)="Q"
"RTN","DIPR163",19,0)
 S ^DD(.402,1815,1,1,2)="D DELETROU^DIEZ($TR(X,U))"
"RTN","DIPR163",20,0)
 S ^DD(.402,"IX",1815)=""
"RTN","DIPR163",21,0)
 S ^DD(.402,0,"ID","WRITED")="I $G(DZ)?1""???"".E N % S %=0 F  S %=$O(^DIE(Y,""%D"",%)) Q:%'>0  I $D(^(%,0))#2 D EN^DDIOL(^(0),"""",""!?5"")"
"RTN","DIPR163",22,0)
 Q
"RTN","DIPR163",23,0)
CHKSTOP ;
"RTN","DIPR163",24,0)
 ; Check XPDENV 0 = Loading; 1 = Installing
"RTN","DIPR163",25,0)
 Q:'XPDENV  ; Loading Distribution - No Check
"RTN","DIPR163",26,0)
 ;
"RTN","DIPR163",27,0)
 ;
"RTN","DIPR163",28,0)
INSCHK ; Do Checks During Install Only
"RTN","DIPR163",29,0)
 W $C(7)
"RTN","DIPR163",30,0)
 D MES^XPDUTL("** Although Queuing is allowed - it is HIGHLY recommended that ALL Users and")
"RTN","DIPR163",31,0)
 D MES^XPDUTL("VISTA Background jobs be STOPPED before installation of this patch.  Failure")
"RTN","DIPR163",32,0)
 D MES^XPDUTL("to do so may result in 'source routine edited' error(s). Edits will be")
"RTN","DIPR163",33,0)
 D MES^XPDUTL("lost and record(s) may be left in an inconsistent state, for example,")
"RTN","DIPR163",34,0)
 D MES^XPDUTL("not all Cross-Referencing completed; which in turn may cause FUTURE")
"RTN","DIPR163",35,0)
 D MES^XPDUTL("VistA/FileMan Hard Errors or corrupted Data. **")
"RTN","DIPR163",36,0)
 ;
"RTN","DIPR163",37,0)
TMCHK ; Check to see if TaskMan is still running
"RTN","DIPR163",38,0)
 S X=$$TM^%ZTLOAD
"RTN","DIPR163",39,0)
 I X,'$D(^%ZTSCH("WAIT")) D
"RTN","DIPR163",40,0)
 . W $C(7)
"RTN","DIPR163",41,0)
 . D BMES^XPDUTL("* Warning TaskMan Has NOT Been Stopped or Placed in a WAIT State!")
"RTN","DIPR163",42,0)
 ;
"RTN","DIPR163",43,0)
LINH ; Check to see if Logons are Inhibited
"RTN","DIPR163",44,0)
 D GETENV^%ZOSV  ; $P(Y,"^",2) = Installing Volume
"RTN","DIPR163",45,0)
 Q:$G(^%ZIS(14.5,"LOGON",$P(Y,"^",2)))
"RTN","DIPR163",46,0)
 W $C(7)
"RTN","DIPR163",47,0)
 D BMES^XPDUTL("* Warning Logons are NOT Inhibited!")
"RTN","DIPR163",48,0)
 Q
"RTN","DIPZ")
0^7^B17402853^B17203752
"RTN","DIPZ",1,0)
DIPZ ;SFISC/XAK,TKW-COMPILE PRINT TEMPLATES ;18JAN2010
"RTN","DIPZ",2,0)
 ;;22.0;VA FileMan;**163**;Mar 30, 1999;Build 28
"RTN","DIPZ",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DIPZ",4,0)
 I $G(DUZ(0))'="@" W $C(7),$$EZBLD^DIALOG(101) Q
"RTN","DIPZ",5,0)
EN1 N DNM,X,Y,Z D K I '$D(DISYS) N DISYS D OS^DII
"RTN","DIPZ",6,0)
 I '$D(^DD("OS",DISYS,"ZS")) W $C(7),$$EZBLD^DIALOG(820) Q
"RTN","DIPZ",7,0)
 S DTIME=$S('$D(DTIME):300,1:DTIME)
"RTN","DIPZ",8,0)
 D SIZ^DIPZ0(8034) G:$D(DTOUT)!$D(DUOUT)!'X K S DMAX=X
"RTN","DIPZ",9,0)
TEM K DIC S DIC="^DIPT(",DIC(0)="AIEQ"
"RTN","DIPZ",10,0)
 S DIC("W")="W ?40,""FILE #"",$P(^(0),U,4) W:$D(^(""ROU"")) ?60,^(""ROU"")"
"RTN","DIPZ",11,0)
 S DIC("S")="I $D(^(""F""))>9,'$P(^(0),U,8),Y'<1" D ^DIC G K:Y<0
"RTN","DIPZ",12,0)
 S DIPZ=+Y
"RTN","DIPZ",13,0)
 D RNM^DIPZ0(8034) G:$D(DTOUT)!($D(DUOUT))!(X="") K S DNM=X K DIC
"RTN","DIPZ",14,0)
IOM K DIR S DIR("B")=$G(^DIPT(DIPZ,"IOM")) K:'DIR("B") DIR
"RTN","DIPZ",15,0)
 S DIR(0)="N^19:255",DIR("A")=$$EZBLD^DIALOG(8022) D BLD^DIALOG(8023,"","","DIR(""?"")")
"RTN","DIPZ",16,0)
 D ^DIR K DIR G:$D(DTOUT)!($D(DUOUT))!'X K S IOM=X
"RTN","DIPZ",17,0)
 W ! S DIR(0)="Y",DIR("A")=$$EZBLD^DIALOG(8020) D ^DIR K DIR G K:'Y!($D(DIRUT))
"RTN","DIPZ",18,0)
 S X=DNM,Y=DIPZ D ENZ
"RTN","DIPZ",19,0)
K K DMAX,DIC,DCL,R,M,DE,DI,DPP,DIPZ,DHD,DIWL,DIWR,DK,DP,DNP,DCL,DITTO,DUOUT,DIRUT,DIROUT,DTOUT
"RTN","DIPZ",20,0)
 K %,%H,I,O,C,D,DD,DHT,DIL0,DIP,DN,DU,F,H,L,N,S,Q,CP,DINC Q
"RTN","DIPZ",21,0)
 ;
"RTN","DIPZ",22,0)
EN ;
"RTN","DIPZ",23,0)
 Q:'$D(^DIPT(Y,"IOM"))!($P($G(^DIPT(Y,0)),U,8))  S IOM=^("IOM") D ENZ G K
"RTN","DIPZ",24,0)
 ;
"RTN","DIPZ",25,0)
ENZ S (R,DCL,DPP)=0 F %=0:0 S R=$O(^DIPT(+Y,"DCL",R)) Q:R=""  F %=1:1 Q:%>$L(^(R))  S Z=$E(^(R),%) I Z?1P S DCL(R)=$G(DCL(R))_Z
"RTN","DIPZ",26,0)
ENDIP ;
"RTN","DIPZ",27,0)
 W:'$G(DIPZS) ! K ^UTILITY($J),^("DIL",$J),^UTILITY("DIPZ",$J),DIPZ,DNP,DIPZLR,DRN,DIPZL,DX,DXS,R N DIPZQ S DIPZQ=0 D DELETROU^DIEZ(X)
"RTN","DIPZ",28,0)
 S DNM=X,DIPZ=+Y,DRD=0,DP=$P(^DIPT(DIPZ,0),U,4),DHD=$S(^("H")="@":"@",1:3) S:$D(^("DNP")) DNP=1
"RTN","DIPZ",29,0)
 S DK=^DIC(DP,0,"GL"),DMAX=DMAX-$S($D(DCL)>9:1600,1:1300),DRN=0,R="",L=0,DINC=1
"RTN","DIPZ",30,0)
 I '$D(IOM) Q:$D(^DIPT(DIPZ,"IOM"))[0  S IOM=^("IOM")
"RTN","DIPZ",31,0)
AF D DT^DICRW,INIT^DIP5 S X=-1
"RTN","DIPZ",32,0)
 S T(1)=$P(^DIPT(DIPZ,0),U),T(2)=$$EZBLD^DIALOG(8034),T(3)=DP D BLD^DIALOG(8024,.T,"","DIR")
"RTN","DIPZ",33,0)
 W:'$G(DIPZS) !,DIR K DIR
"RTN","DIPZ",34,0)
 F T=0:0 S X=$O(^DIPT("AF",X)) Q:X=""  F %=0:0 S %=$O(^DIPT("AF",X,%)) Q:'%  K:$D(^(%,DIPZ)) ^(DIPZ)
"RTN","DIPZ",35,0)
 F C=1:1 Q:'$D(^DIPT(DIPZ,"DXS",C,9.2))&'$D(^(9))  D DXS S:DIDXS DXS(C)=""
"RTN","DIPZ",36,0)
 S DL=1,DIPZL=0,DHT=-1,C=",",Q="""",^UTILITY($J,1)=""
"RTN","DIPZ",37,0)
 F DIP=-1:0 S DIP=$O(^DIPT(DIPZ,"F",DIP)) Q:DIP=""  S R=^(DIP) D ^DIL
"RTN","DIPZ",38,0)
 D UNSTACK^DIL:DM,A^DIL,T^DIL2 K ^DIPT(DIPZ,"T") F R=-1:0 S R=$O(^UTILITY($J,"T",R)) Q:R=""  S ^DIPT(DIPZ,"T",R)=^(R)
"RTN","DIPZ",39,0)
 S DX=DX+999,Y=$P(" D ^DIWW",1,''$D(DIWR))_" K Y" I DIWL S Y=Y_" K DIWF" S:DIWL=1 ^UTILITY("DIPZ",$J,.5)=" S DIWF=""W"""
"RTN","DIPZ",40,0)
 D PX^DIPZ1 G ^DIPZ2
"RTN","DIPZ",41,0)
DXS S DIDXS=1
"RTN","DIPZ",42,0)
 I $D(^DIPT(DIPZ,"DXS",C,9)) S X=^(9) D ^DIM I '$D(X) S DIDXS=0
"RTN","DIPZ",43,0)
 Q
"RTN","DIPZ",44,0)
 ;
"RTN","DIPZ",45,0)
EN2(Y,DIPZFLGS,X,DMAX,DIPZRLA,DIPZZMSG) ;Silent or Talking with parameter passing
"RTN","DIPZ",46,0)
 ;and optionally return list of routines built and if successful
"RTN","DIPZ",47,0)
 ;IEN,FLAGS,ROUTINE,RTNMAXSIZE,RTNLISTARRAY,MSGARRAY
"RTN","DIPZ",48,0)
 ;Y=TEMPLATE IEN (required)
"RTN","DIPZ",49,0)
 ;FLAGS="T"alk (optional)
"RTN","DIPZ",50,0)
 ;X=ROUTINE NAME (required)
"RTN","DIPZ",51,0)
 ;DMAX=ROUTINE SIZE (optional)
"RTN","DIPZ",52,0)
 ;DIPZRLA=ROUTINE LIST ARRAY, by value (optional)
"RTN","DIPZ",53,0)
 ;DIPZZMSG=MESSAGE ARRAY (optional) (default ^TMP)
"RTN","DIPZ",54,0)
 ;*
"RTN","DIPZ",55,0)
 ;DIPZS will be used to indicate "silent" if set to 1
"RTN","DIPZ",56,0)
 ;Write statements are made conditional, if not "silent"
"RTN","DIPZ",57,0)
 ;*
"RTN","DIPZ",58,0)
 N DIPZS,DNM,DIQUIET,DIPZRIEN,DIPZRLAZ,Z,DIPZRLAF
"RTN","DIPZ",59,0)
 N DIK,DIC,%I,DICS
"RTN","DIPZ",60,0)
 S DIPZS=$G(DIPZFLGS)'["T"
"RTN","DIPZ",61,0)
 S:DIPZS DIQUIET=1
"RTN","DIPZ",62,0)
 I '$D(DIFM) N DIFM S DIFM=1 D
"RTN","DIPZ",63,0)
 .N Y,DIPZFLGS,X,DMAX,DIPZRLA,DIPZS
"RTN","DIPZ",64,0)
 .D INIZE^DIEFU
"RTN","DIPZ",65,0)
 I $G(Y)'>0 D BLD^DIALOG(1700,"IEN for Print Template missing or invalid") G EN2E
"RTN","DIPZ",66,0)
 I '$D(^DIPT(Y,0)) D BLD^DIALOG(1700,"No Print Template on file with IEN="_Y) G EN2E
"RTN","DIPZ",67,0)
 I $G(^DIPT(Y,"IOM"))'>0 D BLD^DIALOG(1700,"No Margin Width for Print Template, IEN="_Y) G EN2E
"RTN","DIPZ",68,0)
 I $P($G(^DIPT(Y,0)),"^",8) D BLD^DIALOG(1700,"Print Template Invalid, IEN="_Y) G EN2E
"RTN","DIPZ",69,0)
 I $G(X)']"" D BLD^DIALOG(1700,"Routine name missing this Print Template, IEN="_Y) G EN2E
"RTN","DIPZ",70,0)
 I X'?1U.NU&(X'?1"%"1U.NU) D BLD^DIALOG(1700,"Routine name invalid") G EN2E
"RTN","DIPZ",71,0)
 I $L(X)>7 D BLD^DIALOG(1700,"Routine name too long") G EN2E
"RTN","DIPZ",72,0)
 S DIPZRLA=$G(DIPZRLA,"DIPZRLAZ"),DIPZRIEN=Y
"RTN","DIPZ",73,0)
 S:DIPZRLA="" DIPZRLA="DIPZRLAZ" S:$G(DMAX)'>0!($G(DMAX)>^DD("ROU")) DMAX=^DD("ROU")
"RTN","DIPZ",74,0)
 S DIPZRLAF=""
"RTN","DIPZ",75,0)
 K @DIPZRLA
"RTN","DIPZ",76,0)
 D EN
"RTN","DIPZ",77,0)
 G:'DIPZS!(DIPZRLAF) EN2E
"RTN","DIPZ",78,0)
 D BLD^DIALOG(1700,"Compiling Print Template (IEN="_DIPZRIEN_")"_$S(DIPZRLAF=0:", routine name too long",1:""))
"RTN","DIPZ",79,0)
EN2E I 'DIPZS D MSG^DIALOG() Q
"RTN","DIPZ",80,0)
 I $G(DIPZZMSG)]"" D CALLOUT^DIEFU(DIPZZMSG)
"RTN","DIPZ",81,0)
 Q
"RTN","DIPZ",82,0)
 ;
"RTN","DIPZ",83,0)
 ;DIALOG #101    'only those with programmer's access'
"RTN","DIPZ",84,0)
 ;       #820    'no way to save routines on the system'
"RTN","DIPZ",85,0)
 ;       #8020   'Should the compilation run now?'
"RTN","DIPZ",86,0)
 ;       #8022   'Margin Width for output.'
"RTN","DIPZ",87,0)
 ;       #8023   'Type a number from 19 to 255.  This is the number...'
"RTN","DIPZ",88,0)
 ;       #8024   'Compiling template name Print template of file n'
"RTN","DIPZ",89,0)
 ;       #8034   'Print template'
"RTN","DIPZ0")
0^8^B4753333^B4318484
"RTN","DIPZ0",1,0)
DIPZ0 ;SFISC/TKW-COMPILE PRINT TEMPLATES ;19JAN2010
"RTN","DIPZ0",2,0)
 ;;22.0;VA FileMan;**160,163**;Mar 30, 1999;Build 28
"RTN","DIPZ0",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DIPZ0",4,0)
 ;
"RTN","DIPZ0",5,0)
SIZ(DITYP) ;PROMPT FOR SIZE OF COMPILED ROUTINE
"RTN","DIPZ0",6,0)
 ;PARAMETER DITYP CONTAINS A NUMBER IN DIALOG FILE POINTING TO EITHER
"RTN","DIPZ0",7,0)
 ;TEXT FOR A TEMPLATE TYPE, OR TO THE TEXT 'CROSS-REFERENCES'.
"RTN","DIPZ0",8,0)
 N %,DIR
"RTN","DIPZ0",9,0)
 S %=$G(^DD("ROU")) S:'% %=$P($G(^DD("OS",DISYS,0)),U,4) S:'% %=5000
"RTN","DIPZ0",10,0)
 S DIR(0)="N^2400:"_%_":0",DIR("B")=%,DIR("A")=$$EZBLD^DIALOG(8027)
"RTN","DIPZ0",11,0)
 K % S %(1)=$$EZBLD^DIALOG(DITYP) D BLD^DIALOG(9002,.%,"","DIR(""?"")")
"RTN","DIPZ0",12,0)
 D ^DIR Q
"RTN","DIPZ0",13,0)
 ;
"RTN","DIPZ0",14,0)
RNM(DITYP) ;PROMPT FOR COMPILED ROUTINE NAME
"RTN","DIPZ0",15,0)
 ;PARAMETER SAME AS FOR SIZ.
"RTN","DIPZ0",16,0)
 N %,DIR,DIRNM
"RTN","DIPZ0",17,0)
 S DIRNM="" D
"RTN","DIPZ0",18,0)
 .I DITYP<8036 S DIRNM=$G(@(DIC_DIPZ_",""ROUOLD"")")),DIRNM(1)=$G(@(DIC_DIPZ_",""ROU"")"))
"RTN","DIPZ0",19,0)
 .E  S DIRNM=$G(@("^DD("_DIPZ_",0,""DIKOLD"")")),DIRNM(1)=$G(@("^DD("_DIPZ_",0,""DIK"")")) S:DIRNM="" DIRNM=DIRNM(1)
"RTN","DIPZ0",20,0)
 .Q
"RTN","DIPZ0",21,0)
 I DIRNM(1)]"" S DIR(0)="Y",DIR("B")="NO" D  D ^DIR K DIR Q:$D(DIRUT)  I Y D UNC Q
"RTN","DIPZ0",22,0)
 .K % S %(1)=$$EZBLD^DIALOG(DITYP),%(2)=DIRNM(1)
"RTN","DIPZ0",23,0)
 .D BLD^DIALOG(8028,.%,"","DIR(""A"")")
"RTN","DIPZ0",24,0)
 .K %(2) D BLD^DIALOG(9004,.%,"","DIR(""?"")")
"RTN","DIPZ0",25,0)
 .Q
"RTN","DIPZ0",26,0)
 S %=7 ;S:DITYP=8036 %=6
"RTN","DIPZ0",27,0)
 S DIR(0)="F^3:"_%_"^K:X'?1U.NU&(X'?1""%""1U.NU)!(X?1""DI"".E) X" S:DIRNM]"" DIR("B")=DIRNM
"RTN","DIPZ0",28,0)
 D BLD^DIALOG(8001,"","","DIR(""A"")"),BLD^DIALOG(9006,%,"","DIR(""?"")")
"RTN","DIPZ0",29,0)
 D ^DIR K DIR Q:$D(DIRUT)!(X="")
"RTN","DIPZ0",30,0)
 I $L(X)>6 D
"RTN","DIPZ0",31,0)
 .N A,% D BLD^DIALOG(8031,"","","A") W $C(7),! F %=0:0 S %=$O(A(%)) Q:'%  W A(%),!
"RTN","DIPZ0",32,0)
 .W ! Q
"RTN","DIPZ0",33,0)
 I $$ROUEXIST^DILIBF(X) K % S %(1)=U_X D BLD^DIALOG(8016,.%,"","DIR") W $C(7),!?5,DIR K DIR
"RTN","DIPZ0",34,0)
 Q
"RTN","DIPZ0",35,0)
UNC ;UNCOMPILE TEMPLATES/CROSS-REFS
"RTN","DIPZ0",36,0)
 N %,DIR,DIPZ0 I DITYP<8036 K @(DIC_DIPZ_",""ROU"")") S DIPZ0=$G(^("ROUOLD")) D
"RTN","DIPZ0",37,0)
 .I DITYP=8033 D UNCAF^DIEZ(DIPZ)
"RTN","DIPZ0",38,0)
 .D DELETROU^DIEZ(DIPZ0)
"RTN","DIPZ0",39,0)
 E  S X=DIPZ D A^DIU21
"RTN","DIPZ0",40,0)
 S %(1)=$$EZBLD^DIALOG(DITYP) D BLD^DIALOG(8026,.%,"","DIR(""A"")") ;'IS NOW UNCOMPILED'
"RTN","DIPZ0",41,0)
 W $C(7),!!,DIR("A")
"RTN","DIPZ0",42,0)
 S X="" Q
"RTN","DIPZ0",43,0)
 ;
"RTN","DIPZ0",44,0)
 ;DIALOG #8001  'Routine Name'
"RTN","DIPZ0",45,0)
 ;       #8016  'Note that...is already in the routine directory'
"RTN","DIPZ0",46,0)
 ;       #8027  'Maximum routine size on this computer...'
"RTN","DIPZ0",47,0)
 ;       #8028  '...currently compiled under namespace...UNCOMPILE...'
"RTN","DIPZ0",48,0)
 ;       #8031  'WARNING!!  Since the namespace...routine...so long...'
"RTN","DIPZ0",49,0)
 ;       #8033  'Input template'
"RTN","DIPZ0",50,0)
 ;       #8034  'Print Template'
"RTN","DIPZ0",51,0)
 ;       #8036  'Cross-Reference(s)'
"RTN","DIPZ0",52,0)
 ;       #9002  'This number will be used to determine how large...'
"RTN","DIPZ0",53,0)
 ;       #9004  'Answer YES to UNCOMPILE the ...'
"RTN","DIPZ0",54,0)
 ;       #9006  'Enter a valid MUMPS routine name...'
"RTN","DIQ")
0^4^B47760134^B37013741
"RTN","DIQ",1,0)
DIQ ;SFISC/GFT-CAPTIONED TEMPLATE ;6DEC2009
"RTN","DIQ",2,0)
 ;;22.0;VA FileMan;**19,64,74,81,99,133,163**;Mar 30, 1999;Build 28
"RTN","DIQ",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DIQ",4,0)
 G INQ^DII
"RTN","DIQ",5,0)
 ;
"RTN","DIQ",6,0)
GET1(DIQGR,DA,DR,DIQGPARM,DIQGETA,DIQGERRA,DIQGIPAR) ;Extrinsic Function
"RTN","DIQ",7,0)
 ; file,record,field,parm,targetarray,errortargetarray,internal
"RTN","DIQ",8,0)
 I '$D(DIQUIET) N DIQUIET S DIQUIET=1
"RTN","DIQ",9,0)
 I '$D(DIFM) N DIFM S DIFM=1 D INIZE^DIEFU
"RTN","DIQ",10,0)
 G DDENTRY^DIQG
"RTN","DIQ",11,0)
 ;
"RTN","DIQ",12,0)
GETS(DIQGR,DA,DR,DIQGPARM,DIQGTA,DIQGERRA,DIQGIPAR) ;Procedure Call
"RTN","DIQ",13,0)
 ; file,record,field,parm,targetarray,errortargetarray,internal
"RTN","DIQ",14,0)
 I '$D(DIQUIET) N DIQUIET S DIQUIET=1
"RTN","DIQ",15,0)
 I '$D(DIFM) N DIFM S DIFM=1 D INIZE^DIEFU
"RTN","DIQ",16,0)
 N DIQGQERR
"RTN","DIQ",17,0)
 D DDENTRY^DIQGQ
"RTN","DIQ",18,0)
 I $G(DIQGQERR)]"" S DIERR=DIQGQERR
"RTN","DIQ",19,0)
 D:$G(DIQGERRA)]"" CALLOUT^DIEFU(DIQGERRA)
"RTN","DIQ",20,0)
 Q
"RTN","DIQ",21,0)
 ;
"RTN","DIQ",22,0)
 ;
"RTN","DIQ",23,0)
CAPTION(DD,DA,A,N,E) ;
"RTN","DIQ",24,0)
 ; Newing of Line Counter 'S' needs to be before call
"RTN","DIQ",25,0)
 N D0,DIQ,DIC,DIQS
"RTN","DIQ",26,0)
 S DIQ(0)=$G(A),DIC=^DIC(DD,0,"GL") I $G(DIA),DD=.6!(DD=1.1) S DIC=DIC_DIA_"," ;In DIQ(0), 'A' means AUDIT, 'R' means SHOW RECORD NUMBER
"RTN","DIQ",27,0)
 S E=$S($G(E)="":"N<0",1:"N]]"""_E_"""")
"RTN","DIQ",28,0)
 S N=$S($G(N)="":-1,1:$O(@(DIC_"DA,N)"),-1))
"RTN","DIQ",29,0)
 D R
"RTN","DIQ",30,0)
 S X=""
"RTN","DIQ",31,0)
 Q
"RTN","DIQ",32,0)
 ;
"RTN","DIQ",33,0)
GUY ;from DII
"RTN","DIQ",34,0)
 N N S N=-1
"RTN","DIQ",35,0)
R S:'$G(IOM) IOM=80 S:'$G(IOSL) IOSL=24,IOST="C-OTHER"
"RTN","DIQ",36,0)
 S:'$D(DTIME) DTIME=300 K DTOUT,DUOUT,DIRUT,DIR
"RTN","DIQ",37,0)
 N DIQDD,DIQAUDE,DIQAUDD,DIQZ,D,DL,D1,D2,D3,D4,D5,D6,D7,D8,D9,DIQE
"RTN","DIQ",38,0)
 S D0=DA,D=DIC_DA_",",DL=1,DIQDD=DD S:'$G(S) S=3
"RTN","DIQ",39,0)
 I '$D(DIQS) W !
"RTN","DIQ",40,0)
 E  D
"RTN","DIQ",41,0)
 .S DIQZ=0,A=0 F  S @("DIQZ=$O("_DIQS_"DIQZ))") Q:DIQZ=""  S @(DIQS_"DIQZ)=""""")
"RTN","DIQ",42,0)
 D 1(DA)
"RTN","DIQ",43,0)
 G Q
"RTN","DIQ",44,0)
 ;
"RTN","DIQ",45,0)
1(DA) ;recursive, for 1 entry or subentry
"RTN","DIQ",46,0)
 N DIQAUD
"RTN","DIQ",47,0)
 I $D(DIQS) D  ;old parameter -- undocumented
"RTN","DIQ",48,0)
 .S DIQZ=0,A=0 F  S @("DIQZ=$O("_DIQS_"DIQZ))") Q:DIQZ=""  D
"RTN","DIQ",49,0)
 ..S A=$O(^DD(DD,"B",DIQZ,0)) Q:'A
"RTN","DIQ",50,0)
 ..I $D(^DD(DD,A,0)) S C=$P(^(0),U,2) I C["C" D COM S @(DIQS_"DIQZ)=X")
"RTN","DIQ",51,0)
 I N<0,$D(^DD(DD,.001,0)) S W=.001,A=-1,Y=@("D"_(DL\2)) D W Q:'S  G A
"RTN","DIQ",52,0)
 I $G(DIQ(0))["R",DL=1 S W=.001,A=-1,O="NUMBER",Y=D0 D W2 Q:'S
"RTN","DIQ",53,0)
A I DIQ(0)["A" D  ;Get AUDIT TRAIL data
"RTN","DIQ",54,0)
 .N Z,D,SUB
"RTN","DIQ",55,0)
 .I DL=1 S DIQAUDD="",(DIQAUDE(0),DIQAUDE)=D0 F Z=2:2 Q:'$D(^DD(DIQDD,0,"UP"))  D
"RTN","DIQ",56,0)
 ..S A=DIQDD,DIQDD=^("UP"),(DIQAUDE,DIQAUDE(0))=$P(DIC,",",$L(DIC,",")-Z)_","_DIQAUDE,(DIQAUDD(0),DIQAUDD)=$O(^DD(DIQDD,"SB",A,0))_","_DIQAUDD
"RTN","DIQ",57,0)
 .E  S DIQAUDD=$G(DIQAUDD(0)),DIQAUDE=DIQAUDE(0) F A=3:2:DL S DIQAUDE=DIQAUDE_","_(@("D"_(A\2))),DIQAUDD=DIQAUDD_DIQAUDD(A-1)_","
"RTN","DIQ",58,0)
 .F Z=0:0 S Z=$O(^DIA(DIQDD,"B",DIQAUDE,Z)) Q:'Z  D
"RTN","DIQ",59,0)
 ..S D=$P($G(^DIA(DIQDD,Z,0)),U,3) Q:'D  ;get field number
"RTN","DIQ",60,0)
 ..I DIQAUDD]"" S D=$P(D,DIQAUDD,2,9)
"RTN","DIQ",61,0)
 ..E  I E["]]"!(N]]0) S SUB=$P($P($G(^DD(DIQDD,+D,0)),U,4),";") D
"RTN","DIQ",62,0)
 ...I N]]SUB S D=0 Q
"RTN","DIQ",63,0)
 ...N N S N=SUB I @E S D=0 Q
"RTN","DIQ",64,0)
 ..I D,D'["," S DIQAUD(D,Z)="" Q
"RTN","DIQ",65,0)
N S @("N=$O("_D_"N))") I N="" S N=-1 G END:DL#2,MISSAUD
"RTN","DIQ",66,0)
 I DL=1,@E G END
"RTN","DIQ",67,0)
 S DIQZ=$G(^(N)) I DIQZ]"" S A="" F  S A=$O(^DD(DD,"GL",N,A)) G N:A="" D  G Q:'S ;write out what's on one data node
"RTN","DIQ",68,0)
 .S W=$O(^(A,0)) Q:'W  I A S Y=$P(DIQZ,U,A) Q:Y=""
"RTN","DIQ",69,0)
 .E  S Y=$E(DIQZ,+$E(A,2,9),$P(A,",",2)) Q:Y?." "
"RTN","DIQ",70,0)
 .D W
"RTN","DIQ",71,0)
 I DL#2 S DIQZ=$O(^DD(DD,"GL",N,0,0)) G N:DIQZ="" S O=0,X=+$P(^DD(DD,DIQZ,0),U,2) X:$D(DICS) DICS E  G N
"RTN","DIQ",72,0)
 E  G MISSAUD:N'>0 S X=DD,O=-1,@("D"_(DL\2)_"=N") Q:$$STOP  I $D(DSC(X)) X DSC(X) E  G N ;we've found a new sub-entry
"RTN","DIQ",73,0)
 S DD(DL)=DD,D(DL)=D,N(DL)=N,DL=DL+1,DIQAUDD(DL)=DIQZ S:+N'=N N=""""_N_"""" S D=D_N_",",N=O,DD=X ;down a level
"RTN","DIQ",74,0)
FIND1 I DL#2=0 S N=0 N DIQAUDR K:$G(DIQAUDE) @("DIQE("_DIQAUDE_")") G N ;let's look for the 1st multiple
"RTN","DIQ",75,0)
WP I '$D(DIQS),$P(^DD(DD,.01,0),U,2)["W" S O=$P(^(0),U),C=$P(^(0),U,2) D  S DL=DL-1 G UP:S Q
"RTN","DIQ",76,0)
 .N DIWF,DIWL,DIWR,DN,N,DD ;Word-processing field
"RTN","DIQ",77,0)
 .D DIQ^DIWW I $D(DN),'DN S S=0
"RTN","DIQ",78,0)
 S N=-1 D 1(DA) Q:'S
"RTN","DIQ",79,0)
UP S DL=DL-1,D=D(DL),DD=DD(DL),N=N(DL) Q:$$STOP  G N ;go back UP a level
"RTN","DIQ",80,0)
 ;
"RTN","DIQ",81,0)
MISSAUD I $G(DIQAUDE) S DIQE=DIQAUDE(0)_"," F  S DIQE=$O(^DIA(DIQDD,"B",DIQE)) Q:'DIQE  Q:DIQE-DIQAUDE  Q:$$STOP  I '$D(@("DIQE("_DIQE_")")) D  ;SHOW MISSING ENTRIES THAT WERE CAPTURED BY AUDIT TRAIL
"RTN","DIQ",82,0)
 .N E,DIQEMISS
"RTN","DIQ",83,0)
 .S E="" F  S E=$O(^DIA(DIQDD,"B",DIQE,E),-1) Q:'E  Q:$$STOP  I $P($G(^DIA(DIQDD,E,0)),U,3)=(DIQAUDD(DL)_",.01") D:'$G(DIQEMISS)  D WRITEAUD
"RTN","DIQ",84,0)
 ..D WRITE($P(^DD(DD,.01,0),U)_":") W ! S DIQEMISS=1 ;Write the label of the missing multiple
"RTN","DIQ",85,0)
 G UP
"RTN","DIQ",86,0)
 ;
"RTN","DIQ",87,0)
 ;
"RTN","DIQ",88,0)
END Q:$$STOP
"RTN","DIQ",89,0)
 F DIQZ=0:0 S DIQZ=$O(DIQAUD(DIQZ)) Q:'DIQZ  I $D(^DD(DD,DIQZ,0)) D  ;write out audited DELETED fields
"RTN","DIQ",90,0)
 .N D W ?2,$P(^(0),U),":" I $P(^(0),U,2) Q
"RTN","DIQ",91,0)
 .D PRINTAUD(DIQZ) Q:$$STOP
"RTN","DIQ",92,0)
 I S,$G(DIQ(0))["C",$D(@(D_"0)")) D ^DIQ1 ;Computed fields at this level -- ONLY IF ENTRY EXISTS
"RTN","DIQ",93,0)
 Q
"RTN","DIQ",94,0)
 ;
"RTN","DIQ",95,0)
W S O=$P(^DD(DD,W,0),U),C=$P(^(0),U,2) I $D(DICS) X DICS E  Q
"RTN","DIQ",96,0)
 D Y
"RTN","DIQ",97,0)
 I $D(DIQS) S:$D(@(DIQS_"O)")) @(DIQS_"O)=Y") S:$D(^(W)) @(DIQS_"W)=Y") Q
"RTN","DIQ",98,0)
W2 ;from DIQ1
"RTN","DIQ",99,0)
 N DIQX
"RTN","DIQ",100,0)
 S O=$E(O,1,253-$L(Y))_": "_Y
"RTN","DIQ",101,0)
 D  I $L(O)+DIQX>IOM!$D(DIQAUD(W)) Q:$$STOP  D
"RTN","DIQ",102,0)
 .S DIQX=$S($X:$X+1\40+1*40,W=.01!(W=.001):0,1:2)
"RTN","DIQ",103,0)
 W ?DIQX
"RTN","DIQ",104,0)
 D WRITE(O) D:$D(DIQAUD(W)) PRINTAUD(W) Q
"RTN","DIQ",105,0)
 ;
"RTN","DIQ",106,0)
PRINTAUD(FLD) N E
"RTN","DIQ",107,0)
 S E="" F  S E=$O(DIQAUD(FLD,E),-1) Q:'E  Q:$$STOP  D WRITEAUD
"RTN","DIQ",108,0)
 K DIQAUD(FLD) S @("DIQE("_DIQAUDE_")")=""
"RTN","DIQ",109,0)
 D LF Q
"RTN","DIQ",110,0)
 ;
"RTN","DIQ",111,0)
WRITEAUD N O,Z,W,N ;WRITE AN ENTRY FROM THE AUDIT TRAIL
"RTN","DIQ",112,0)
 S O=$G(^DIA(DIQDD,E,2)),N=$G(^(3))
"RTN","DIQ",113,0)
 I N="" S W="Deleted """_O_""""
"RTN","DIQ",114,0)
 E  S W=$S(O]"":"Changed from """_O_"""",1:"Created")
"RTN","DIQ",115,0)
 I $D(^DIA(DIQDD,E,0)) S:$P(^(0),U,6)="i" W="Accessed" S Z=$P(^(0),U,4),W=W_" on "_$$FMTE^DILIBF($P(^(0),U,2),"IL") I Z]"" S W=W_" by User #"_Z
"RTN","DIQ",116,0)
 W ?4 D WRITE(W)
"RTN","DIQ",117,0)
 K W S Z=$G(^DIA(DIQDD,E,4.1)),O=$P(Z,U),Z=$P(Z,U,2) I O,$D(^DIC(19,O,0)) S W="  ("_$P(^(0),U)_" Option)"
"RTN","DIQ",118,0)
 I Z S O=+Z,Z=$P(Z,";",2) I Z]"",$D(@(U_Z_O_",0)")) S W="  ("_$P(^(0),U)_" Protocol)"
"RTN","DIQ",119,0)
 I $D(W) D:$X+$L(W)>79 LF Q:'S  W ?(79-$L(W)),W
"RTN","DIQ",120,0)
 Q
"RTN","DIQ",121,0)
 ;
"RTN","DIQ",122,0)
WRITE(DIQW) N DIQWL
"RTN","DIQ",123,0)
 F  S DIQWL=IOM-$X W $E(DIQW,1,DIQWL) S DIQW=$E(DIQW,DIQWL+1,999) Q:DIQW=""  Q:$$STOP
"RTN","DIQ",124,0)
 Q
"RTN","DIQ",125,0)
 ;
"RTN","DIQ",126,0)
Y ;PRINT TEMPLATES CALL HERE    NAKED REFERENCE IS TO ^DD(FILE#,FIELD#,0)
"RTN","DIQ",127,0)
 I $G(Y)="" S Y="" Q
"RTN","DIQ",128,0)
 I C["O",$D(^(2)) X ^(2) Q
"RTN","DIQ",129,0)
S I C["S" S C=";"_$P(^(0),U,3),%=$F(C,";"_Y_":") S:% Y=$P($E(C,%,999),";",1) Q
"RTN","DIQ",130,0)
 I C["P",$D(@("^"_$P(^(0),U,3)_"0)")) S C=$P(^(0),U,2) Q:'$D(^(+Y,0))  S Y=$P(^(0),U) I $D(^DD(+C,.01,0)) S C=$P(^(0),U,2) G S
"RTN","DIQ",131,0)
 I C["V",+Y,Y["(",$D(@("^"_$P(Y,";",2)_"0)")) S C=$P(^(0),U,2) Q:'$D(^(+Y,0))  S Y=$P(^(0),U) I $D(^DD(+C,.01,0)) S C=$P(^(0),U,2) G S
"RTN","DIQ",132,0)
 Q:C'["D"  Q:'Y
"RTN","DIQ",133,0)
D S Y=$$FMTE^DILIBF(Y,"1U") Q
"RTN","DIQ",134,0)
 ;
"RTN","DIQ",135,0)
DT D D:Y W Y Q
"RTN","DIQ",136,0)
H G H^DIO2
"RTN","DIQ",137,0)
 ;
"RTN","DIQ",138,0)
STOP() D LF Q 'S
"RTN","DIQ",139,0)
LF I '$D(DIQS),$X W ! S S=S+1
"RTN","DIQ",140,0)
 I '$D(DIOT(2)),$G(IOSL),$S('$D(DIWF):1,$P(DIWF,"B",2):$P(DIWF,"B",2),1:1)+$Y'<IOSL D
"RTN","DIQ",141,0)
 .I '$D(DX(0)),$G(IOST)?1"C".E D:S>(IOSL-3)  Q
"RTN","DIQ",142,0)
 ..N X,Y,DIR S DIR(0)="E" D ^DIR W ! S S='$D(DIRUT)
"RTN","DIQ",143,0)
 .I $G(^UTILITY($J,1))?1U1P1E.E D  S:Y=U!($D(DTOUT))!($D(DUOUT)) S=0
"RTN","DIQ",144,0)
 ..N S X ^(1)
"RTN","DIQ",145,0)
 .S $Y=0
"RTN","DIQ",146,0)
 Q
"RTN","DIQ",147,0)
 ;
"RTN","DIQ",148,0)
EN1 S DRX=DR
"RTN","DIQ",149,0)
EN2 S DR=$P(DRX,";",1),DRX=$P(DRX,";",2,999) D EN W ! G EN2:DRX]""&S
"RTN","DIQ",150,0)
 K DRX Q
"RTN","DIQ",151,0)
EN ;
"RTN","DIQ",152,0)
 N C,O,W,N,E,Z,D,DD S S=0 S:$D(DICSS) DICS=DICSS
"RTN","DIQ",153,0)
 I '$D(IOST)!'$D(IOSL)!'$D(IOM) S IOP="HOME" D ^%ZIS Q:POP  S:'$G(IOM) IOM=80
"RTN","DIQ",154,0)
 G Q:'$D(@(DIC_"0)")) S U="^",DD=+$P(^(0),U,2),DK=DD
"RTN","DIQ",155,0)
 I '$D(DR) S N=-1,O=""
"RTN","DIQ",156,0)
 E  S N=$P(DR,":"),N=$S(0[N:-1,+N=N:N-.000001,1:$E(N,1,$L(N)-1)_$C($A(N,$L(N))-1)),O=$P(DR,":",DR[":"+1) G EN1:DR[";"
"RTN","DIQ",157,0)
 S E="N<0" I O]"" S E=E_"!(N]"""_$S(+O=O:"?"")!(N>"_O_")",1:O_""")")
"RTN","DIQ",158,0)
 I '$D(DIQ(0)) N DIQ S DIQ(0)=""
"RTN","DIQ",159,0)
 D R S DA=D0
"RTN","DIQ",160,0)
Q K C,O,W,N,E,Z,D,DD,IOP Q
"RTN","DIQ",161,0)
 ;
"RTN","DIQ",162,0)
COM X $P(^(0),U,5,99) S C=$P($P(C,"J",2),",",2) I C?1N.E,X S X=$J(X,0,C)
"RTN","DIQGU")
0^10^B6424161^B8156081
"RTN","DIQGU",1,0)
DIQGU ;SFISC/DCL-DATA RETRIEVAL INTERNAL FUNCTIONS ;16JAN2010
"RTN","DIQGU",2,0)
 ;;22.0;VA FileMan;**163**;Mar 30, 1999;Build 28
"RTN","DIQGU",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DIQGU",4,0)
DT(H) Q $$HTFM^DILIBF(H,1)
"RTN","DIQGU",5,0)
 ;
"RTN","DIQGU",6,0)
ROOT(DIC,DA,CP,ERR) ;
"RTN","DIQGU",7,0)
ENROOT S ERR=$G(ERR)=1
"RTN","DIQGU",8,0)
 N DIQGUFN,DIQGUIEN
"RTN","DIQGU",9,0)
 S DIQGUFN=$G(DIC),DIQGUIEN=$G(DA)
"RTN","DIQGU",10,0)
 I DIC="" D:ERR BLD^DIALOG(200) Q ""
"RTN","DIQGU",11,0)
 N RQ
"RTN","DIQGU",12,0)
 S RQ=$G(CP)'["Q"
"RTN","DIQGU",13,0)
 S CP=$G(CP)'[1
"RTN","DIQGU",14,0)
 G:$L($G(DA),",,")>1 ERR
"RTN","DIQGU",15,0)
 D:$G(DA)["," DAIEN(DA,.DA)
"RTN","DIQGU",16,0)
 I $G(^DIC(DIC,0,"GL"))]"" N DIQGUX S DIQGUX=^("GL") D:ERR  Q:CP DIQGUX Q $$CREF(DIQGUX)
"RTN","DIQGU",17,0)
 .Q:$G(DIQGUIEN)'[","
"RTN","DIQGU",18,0)
 .N X S X=$$IENCHK^DIT3(DIQGUFN,DIQGUIEN)
"RTN","DIQGU",19,0)
 .Q:X
"RTN","DIQGU",20,0)
 .S (CP,DIQGUX)=""
"RTN","DIQGU",21,0)
 .Q
"RTN","DIQGU",22,0)
 N A,A2
"RTN","DIQGU",23,0)
 I $D(DA)>9,$G(^DIC(+$$UP(DIC,.A),0,"GL"))]"" S DIC=^("GL"),A=$P($O(A("")),"-",2) I A>0,$D(DA(A))=1,'$O(DA(A)) D  Q:CP DIC Q $$CREF(DIC)
"RTN","DIQGU",24,0)
 .S A="" F  S A=$O(A(A)) Q:A'<0  D
"RTN","DIQGU",25,0)
 ..I RQ S A2=$P(A(A),"^",2),DIC=DIC_DA($P(A,"-",2))_","_$$Q(A2)_"," Q
"RTN","DIQGU",26,0)
 ..S A2=$P(A(A),"^",2),DIC=DIC_DA($P(A,"-",2))_","""_A2_"""," Q
"RTN","DIQGU",27,0)
ERR Q:'ERR ""
"RTN","DIQGU",28,0)
 S DIQGUIEN=$$IENS^DILF(.DA)
"RTN","DIQGU",29,0)
 S A=$$IENCHK^DIT3(DIQGUFN,DIQGUIEN) Q:'A ""
"RTN","DIQGU",30,0)
 D BLD^DIALOG(200) Q ""
"RTN","DIQGU",31,0)
N9(FN,DA) Q:$G(DA)="" 0 N N9 S N9=$$ROOT($$UP(FN),"",1) Q:N9="" 0 Q:$D(@N9@($$DA(.DA),-9)) 1 Q 0
"RTN","DIQGU",32,0)
DA(Y) Q:$D(Y)=1 Y Q Y($O(Y(""),-1))
"RTN","DIQGU",33,0)
UP(Y,A) N D
"RTN","DIQGU",34,0)
 S A(0)=Y F D=0:-1 Q:'$D(^DD(+A(D),0,"UP"))  S A(D-1)=$P(^("UP"),"^")_"^"_$P($P(^DD($P(^("UP"),"^"),$O(^DD($P(^("UP"),"^"),"SB",+A(D),"")),0),"^",4),";")
"RTN","DIQGU",35,0)
 Q $P(A($O(A(""))),"^")
"RTN","DIQGU",36,0)
CREF(X) ;
"RTN","DIQGU",37,0)
ENCREF N L,X1,X2,X3 S X1=$P(X,"("),X2=$P(X,"(",2,99),L=$L(X2),X3=$TR($E(X2,L),",)"),X2=$E(X2,1,(L-1))_X3 Q X1_$S(X2]"":"("_X2_")",1:"")
"RTN","DIQGU",38,0)
OREF(X) ;
"RTN","DIQGU",39,0)
ENOREF N X1,X2 S X1=$P(X,"(")_"(",X2=$$OR2($P(X,"(",2,999)) Q:X2="" X1 Q X1_X2_","
"RTN","DIQGU",40,0)
OR2(%) Q:%=")"!(%=",") "" Q:$L(%)=1 %  S:"),"[$E(%,$L(%)) %=$E(%,1,$L(%)-1) Q %
"RTN","DIQGU",41,0)
RCP(%DIQGRCP) Q $$CREF($$R^DIQGU0(%DIQGRCP))
"RTN","DIQGU",42,0)
Q(%Z) S %Z(%Z)="",%Z=$Q(%Z("")) Q $E(%Z,4,$L(%Z)-1)
"RTN","DIQGU",43,0)
DY(Y) X ^DD("DD") Q Y ;*CCO/NI   DATE FORMAT
"RTN","DIQGU",44,0)
DAIEN(IEN,DA) ;
"RTN","DIQGU",45,0)
 K DA
"RTN","DIQGU",46,0)
 S DA=$P(IEN,",")
"RTN","DIQGU",47,0)
 N I F I=2:1 Q:$P(IEN,",",I)=""  S DA(I-1)=$P(IEN,",",I)
"RTN","DIQGU",48,0)
 Q
"RTN","DIQGU",49,0)
 ;
"RTN","DIQGU",50,0)
EXTERNAL(DIFILE,DIFIELD,DIFLAGS,DINTERNL,DIOUTPUT) ;SEA/TOAD
"RTN","DIQGU",51,0)
 G XTRNLX^DIDU
"RTN","DIQGU",52,0)
 ;
"RTN","DIR")
0^3^B22459740^B22317316
"RTN","DIR",1,0)
DIR ;SFISC/XAK-READER, HELP ;17NOV2009
"RTN","DIR",2,0)
 ;;22.0;VA FileMan;**30,163**;Mar 30, 1999;Build 28
"RTN","DIR",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DIR",4,0)
 N %,%A,%B,%B1,%B2,%B3,%BA,%C,%E,%G,%H,%I,%J,%N,%P,%S,%T,%W,%X,%Y,A0,C,D,DD,DDH,DDQ,DDSV,DG,DH,DIC,DIFLD,DIRO,DO,DP,DQ,DU,DZ,X1,XQH,DIX,DIY,DISYS,%BU,%J1,%A0,%W0,%D1,%D2,%DT,%K,%M
"RTN","DIR",5,0)
 S:$D(DDH)[0 DDH=0 Q:'$D(DIR(0))  D ^DIR2 G Q:%T=""
"RTN","DIR",6,0)
 I $D(DIR("V"))#2 D ^DIR1 S DDER=%E G Q
"RTN","DIR",7,0)
A I $D(DDM) K:DDM DDQ S:'DDM DDQ=IOSL-7
"RTN","DIR",8,0)
 I $G(DDH) D LIST^DDSU
"RTN","DIR",9,0)
 D W:%A'["V" I $D(DDS),$D(DIR0) S DDACT=Y I DDO=.5 S DDM=1 G Q
"RTN","DIR",10,0)
 I %A'["V",%E D QUES S A0="" D MSG D:$G(DDH) LIST^DDSU G A
"RTN","DIR",11,0)
 I $D(DTOUT) K Y S DIRUT=1,Y="" G Q
"RTN","DIR",12,0)
 I %T'="E",X?1."^".E K Y S (DUOUT,DIRUT)=1,Y=X S:X="^^" DIROUT=1 S:%T="Y" %=-1 G Q
"RTN","DIR",13,0)
 I %T'="E","@"[X,%A["O" S Y="",DIRUT=1 S:%T="P" Y=-1 G Q
"RTN","DIR",14,0)
 I %A'["O","@"[X,%T'="E" S A0=$C(7)_%A0 D MSG G A
"RTN","DIR",15,0)
 I $D(DDS),$D(DIR0),DIR0N G Q
"RTN","DIR",16,0)
 I $D(%G),$D(DIR("B")),X=DIR("B") S Y=%G G Q
"RTN","DIR",17,0)
 I X'?1."?" K DDQ D ^DIR1 I '%E,$P(DIR(0),U,3)]"" S %X=X D  S:'$D(X) %E=1 S X=%X
"RTN","DIR",18,0)
 . N %A,%B,%B1,%B2,%B3,%E,%N,%P,%T,%X,%W,%W0
"RTN","DIR",19,0)
 . X $P(DIR(0),U,3,99)
"RTN","DIR",20,0)
 I %A["V" K:%E Y G Q
"RTN","DIR",21,0)
 I X?1."?"!%E D QUES:%E'<0 S A0="" D MSG D:$G(DDH) LIST^DDSU G A
"RTN","DIR",22,0)
 G Q
"RTN","DIR",23,0)
 ;
"RTN","DIR",24,0)
W ; write the prompt and read the user's response
"RTN","DIR",25,0)
 S %W=%W0,%N=$E(%W)=U
"RTN","DIR",26,0)
SCREEN K DTOUT,DUOUT,DIRUT,DIROUT S %E=0 I $D(DDS),$D(DIR0) D ^DIR0 Q  ;READ in DIR01 via DIR0
"RTN","DIR",27,0)
 I %T="S",%A'["A",%A'["B" D S
"RTN","DIR",28,0)
 I $D(DIR("A"))=11 F %=0:0 S %=$O(DIR("A",%)) Q:%'>0  W !,DIR("A",%)
"RTN","DIR",29,0)
 W ! W:$L(%P) %P
"RTN","DIR",30,0)
 I $L($G(DIR("B")))>19,%A'["r",%T'="D",%T'="S",(%B'["D"&%T)!'%T,%B'["P"!'$P(%A,",",2) W DIR("B") S Y=DIR("B") D RW^DIR2 S:X="" X=DIR("B") Q
"RTN","DIR",31,0)
 W:$D(DIR("B")) DIR("B")_"// "
"RTN","DIR",32,0)
 R X:$S($D(DIR("T")):DIR("T"),'$D(DTIME):300,1:DTIME) I '$T S DTOUT=1
"RTN","DIR",33,0)
 I $D(DIR("PRE")) X DIR("PRE") I '$D(X) S %E=1,X="" Q
"RTN","DIR",34,0)
 I X="",$D(DIR("B")) S X=DIR("B") I %T'="D",%B'["D"&%T W X
"RTN","DIR",35,0)
 I X'?.ANP S X="?"
"RTN","DIR",36,0)
 Q
"RTN","DIR",37,0)
 ;
"RTN","DIR",38,0)
QU I %E!(X="?")!($O(^DD(%B1,%B2,21,0))'>0) K %Y S A0="" D MSG F %C=3,12 I $D(^DD(%B1,%B2,%C)) S X1=^(%C),%J=75,%Y=1 D W1
"RTN","DIR",39,0)
 I $D(^DD(%B1,%B2,4)) S A0=^(4),A0(0)=1 D MSG
"RTN","DIR",40,0)
 I X?1"??".E D
"RTN","DIR",41,0)
 . I $D(DDS) N DDC,DDSQ S DDC=7
"RTN","DIR",42,0)
 . S A0="" D MSG S %C=0
"RTN","DIR",43,0)
 . F  S %C=$O(^DD(%B1,%B2,21,%C)) Q:'%C!$D(DDSQ)  S A0=^(%C,0) D
"RTN","DIR",44,0)
 .. I $D(DDS),$G(DDH),'(DDH#DDC) D LIST^DDSU Q:$D(DDSQ)
"RTN","DIR",45,0)
 .. D MSG
"RTN","DIR",46,0)
 I %B["P" K DO S DIC=U_$P(%B3,U,3),DIC(0)="M"_$E("L",%B'["'") D AST:%B["*",DQ
"RTN","DIR",47,0)
 I %B["D" S %DT=$P($P($P(%B3,U,5,99),"%DT=""",2),"""",1) D HELP^%DTC
"RTN","DIR",48,0)
 I %B["S" X:$D(^DD(%B1,%B2,12.1)) ^(12.1) S A0=$$EZBLD^DIALOG(8068)_" " D MSG F %C=1:1 S Y=$P($P(%B3,U,3),";",%C) Q:Y=""  S %I=$P(Y,":",2),Y=$P(Y,":") I 1 X:$D(DIC("S")) DIC("S") I  S A0=Y_$E("         ",$L(Y)+1,999)_%I D MSG
"RTN","DIR",49,0)
 I %B["V" S A0="" D MSG S X1=X,DU=%B1,D=%B2,DZ=X D V^DIEQ S X=X1
"RTN","DIR",50,0)
 Q
"RTN","DIR",51,0)
DQ N %W S:$D(D)[0 D="B" S (X1,DZ)=X D DQ^DICQ S DDSV=DIC K DD,% S:$D(X1) X=X1
"RTN","DIR",52,0)
 Q
"RTN","DIR",53,0)
AST F %=" D ^DIC"," D IX^DIC"," D MIX^DIC1" S Y=$F(%B3,%),%=$L(%)+1 Q:Y
"RTN","DIR",54,0)
 Q:'Y
"RTN","DIR",55,0)
 I $D(DDS) S A0=" " D MSG
"RTN","DIR",56,0)
 X $P($E(%B3,1,Y-%),U,5,99)
"RTN","DIR",57,0)
 Q
"RTN","DIR",58,0)
QUES ;
"RTN","DIR",59,0)
 I %T D QU
"RTN","DIR",60,0)
 I X="??",$D(DIR("??")) D:$P(DIR("??"),U)]"" HF S:$P(DIR("??"),U,2)]"" A0(0)=1,A0=$P(DIR("??"),U,2,99) D:$P(DIR("??"),U,2)]"" MSG Q
"RTN","DIR",61,0)
 I X="??",%T="D" D  Q
"RTN","DIR",62,0)
 . N DIHELP,DIJUNK,DILINE,DIROOT
"RTN","DIR",63,0)
 . D DT^DILF(%DT,"?",.DIJUNK,"","DIROOT")
"RTN","DIR",64,0)
 . S A0="" D MSG
"RTN","DIR",65,0)
 . F DILINE=1:1:DIHELP S A0=DIROOT("DIHELP",DILINE) D MSG
"RTN","DIR",66,0)
 I %T="P" S DIC=%B1,DIC(0)=%B2 S:$D(DIR("S"))#2 DIC("S")=DIR("S") D DQ K DIC("S")
"RTN","DIR",67,0)
 I '%N S A0="" D MSG
"RTN","DIR",68,0)
 I X'["?" W $C(7)
"RTN","DIR",69,0)
 I %N S A0(0)=1,A0=$E(%W,2,999) D MSG
"RTN","DIR",70,0)
 D:'%N WRAP:%W]"" I %T["S",(%A["A"!(%A["B")) D S
"RTN","DIR",71,0)
 Q
"RTN","DIR",72,0)
WRAP I $D(DIR("?"))=11 F %I=1:1 Q:'$D(DIR("?",%I))  S A0=DIR("?",%I) D MSG
"RTN","DIR",73,0)
 K %Y S %J=$S($G(IOM,80)>6:$G(IOM,80)-6,IOM>1:IOM,1:2),%Y=1 S X1=$S(($D(DIR("?"))&'%N):DIR("?"),1:%W)
"RTN","DIR",74,0)
 I '%N,$D(DIR("?"))'=11,$E(X1,$L(X1))'="." S X1=X1_"."
"RTN","DIR",75,0)
W1 I $L(X1)<%J S %Y(%Y)=X1
"RTN","DIR",76,0)
 E  D  G W1
"RTN","DIR",77,0)
 . I $E(X1,1,%J-1)'?.E1P.E S %I=%J-1
"RTN","DIR",78,0)
 . E  F %I=%J-1:-1:1 Q:$E(X1,%I)?1P
"RTN","DIR",79,0)
 . S %Y(%Y)=$E(X1,1,%I),X1=$E(X1,%I+1,999),%Y=%Y+1
"RTN","DIR",80,0)
 F %I=1:1:%Y S A0=%Y(%I) D MSG
"RTN","DIR",81,0)
 I $D(DDS),%T="S" D
"RTN","DIR",82,0)
 . S A0="Choose from:" D MSG
"RTN","DIR",83,0)
 . F %I=1:1 Q:$P(%B,";",%I,999)=""  D
"RTN","DIR",84,0)
 .. S %Y=$P(%B,";",%I),Y=$P(%Y,":") Q:Y=""
"RTN","DIR",85,0)
 .. I $D(DIR("S"))#2 X DIR("S") E  Q
"RTN","DIR",86,0)
 .. S A0=Y_$J("",9-$L(Y))_$P(%Y,":",2) D MSG
"RTN","DIR",87,0)
 K %Y,%,X1
"RTN","DIR",88,0)
 Q
"RTN","DIR",89,0)
HF S XQH=$P(DIR("??"),U) N %A,%B,%E,DIR D EN1^XQH
"RTN","DIR",90,0)
 Q
"RTN","DIR",91,0)
MSG ;
"RTN","DIR",92,0)
 I $D(DDS),A0]"" D
"RTN","DIR",93,0)
 . S DDH=$G(DDH)+1
"RTN","DIR",94,0)
 . I $D(A0)>9 S DDH(DDH,"T")="",DDH=DDH+1,DDH(DDH,"X")=A0
"RTN","DIR",95,0)
 . E  S DDH(DDH,"T")=A0
"RTN","DIR",96,0)
 I '$D(DDS),$D(A0)>9 W:$X ! X A0
"RTN","DIR",97,0)
 I '$D(DDS),$D(A0)=1 W !,A0
"RTN","DIR",98,0)
 K A0
"RTN","DIR",99,0)
 Q
"RTN","DIR",100,0)
S W:$G(X)'?1."?"!(%A["A") !
"RTN","DIR",101,0)
 I $D(DIR("L"))#2 D
"RTN","DIR",102,0)
 . I $D(DIR("L"))=11 F %=0:0 S %=$O(DIR("L",%)) Q:%'>0  W !,DIR("L",%)
"RTN","DIR",103,0)
 . W !,DIR("L")
"RTN","DIR",104,0)
 E  I %B'[":",$O(DIR("C",""))]"" D
"RTN","DIR",105,0)
 . W !?5,"Select one of the following:",!
"RTN","DIR",106,0)
 . S %I="" F  S %I=$O(DIR("C",%I)) Q:%I=""  D
"RTN","DIR",107,0)
 .. S Y=$P(DIR("C",%I),":")
"RTN","DIR",108,0)
 .. I $D(DIR("S"))#2 X DIR("S") E  Q
"RTN","DIR",109,0)
 .. W !?10,Y,?20,$P(DIR("C",%I),":",2)
"RTN","DIR",110,0)
 E  D
"RTN","DIR",111,0)
 . W !?5,"Select one of the following:",!
"RTN","DIR",112,0)
 . F %I=1:1 Q:$P(%B,";",%I,999)=""  D
"RTN","DIR",113,0)
 .. S Y=$P($P(%B,";",%I),":") Q:'$L($P(%B,";",%I,99))
"RTN","DIR",114,0)
 .. I $D(DIR("S"))#2 X DIR("S") E  Q
"RTN","DIR",115,0)
 .. W !?10,Y,?20,$P($P(%B,";",%I),":",2)
"RTN","DIR",116,0)
 W:%A'["A" !
"RTN","DIR",117,0)
 Q
"RTN","DIR",118,0)
Q G ^DIRQ
"RTN","DIR",119,0)
 ;
"RTN","DIR",120,0)
 ;#8068  Choose from
"RTN","DIT1")
0^1^B22503370^B21997622
"RTN","DIT1",1,0)
DIT1 ;SFISC/GFT,TKW-TRANSFER DD'S ;30JAN2010
"RTN","DIT1",2,0)
 ;;22.0;VA FileMan;**6,63,163**;Mar 30, 1999;Build 28
"RTN","DIT1",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","DIT1",4,0)
 K A W !! S A=+Y,E=A
"RTN","DIT1",5,0)
CHK F V=0:0 S V=$O(^DD(A,"SB",V)) Q:'V  S A(V)=0,L(V)=V#1+DHIT
"RTN","DIT1",6,0)
 S A=$O(A(0)),B=A#1+DHIT I A'="" K A(A) G P:$P(DHIT,".")+1'>B,CHK:'$D(^DD(B)),P:DHIT["." S X=$P(^(B,0),U) S:$D(^DIC(B,0)) X=$P(^(0),U)_" FILE" W $P(^DD(A,0),U)_" WOULD COLLIDE WITH "_X,$C(7),! K L,A Q
"RTN","DIT1",7,0)
 S A=$O(L(0)) I A S %X="^DIC("_A_",""%D"",",%Y="^DIC("_L(A)_",""%D""," D %XY^%RCR
"RTN","DIT1",8,0)
 D WAIT^DICD F A="^DIE(","^DIPT(","^DIBT(" F V=0:0 S V=$O(@(A_"V)")) Q:'V  I $D(^(V,0)),$P(^(0),U,4)-Y=0 S ^UTILITY("DITR",$J,A,V)=$P(^(0),U)
"RTN","DIT1",9,0)
 S A="F B=0:0 Q:F=DTO!'$F(W,DTO)  S W=$P(W,DTO)_F_$P(W,DTO,2,9)"
"RTN","DIT1",10,0)
 I $O(^UTILITY("DITR",$J,""))]"" W !,"DO YOU WANT TO COPY '",$P(Y,U,2),"'S TEMPLATES INTO YOUR NEW FILE" D YN^DICN W ! D:%=1
"RTN","DIT1",11,0)
 .S E="I DIK=""^DIBT("",%Z=1,$D(L(+W)) S $P(W,U)=L(+W)"
"RTN","DIT1",12,0)
 .F DIK="^DIE(","^DIPT(","^DIBT(" S V=$P(@(DIK_"0)"),U,3),%X=DIK_"Z,",%Y=DIK_"V," D ^DIT2,IXALL^DIK
"RTN","DIT1",13,0)
GO S Y=DLAYGO K ^UTILITY("DITR",$J),^DD(Y,"B"),^(.01),^("IX"),^("RQ"),^(0,"IX"),E
"RTN","DIT1",14,0)
 S @("V=$P("_DTO_"0),U,2)"),@("^(0)=$P("_DTO(0)_"0),U,1,2)_$P(V,DDF(1),2)_U_U")
"RTN","DIT1",15,0)
DD W ! S L=$O(L(L)) Q:L=""  S Y=L(L),B=0,V=$O(^DD(L,0,"NM",0)),^DD(Y,0)=^DD(L,0) I V]"",$O(^(0,"NM",0))="" S ^(V)=""
"RTN","DIT1",16,0)
 S V=-1 I $D(^DD(L,0,"UP")) S ^DD(Y,0,"UP")=^("UP")#1+DHIT
"RTN","DIT1",17,0)
ID S V=$O(^DD(L,0,"ID",V)) I V]"",$D(^(V))#2 S W=^(V) X A S ^DD(Y,0,"ID",V)=W G ID
"RTN","DIT1",18,0)
 F V=0:0 S V=$O(^DD(L,V)) Q:'V  W "." D MOVEFLD
"RTN","DIT1",19,0)
 D IXKEY(.L,DTO,Y,F)
"RTN","DIT1",20,0)
 S DA(1)=Y,DIK="^DD("_Y_"," D IXALL^DIK K %A,%B,%C,%Z
"RTN","DIT1",21,0)
 G DD
"RTN","DIT1",22,0)
 ;
"RTN","DIT1",23,0)
MOVEFLD S W=$G(^DD(L,V,0)),D=$P(W,U,2),%Z=0,%A="" Q:W=""
"RTN","DIT1",24,0)
 I D["C" D  Q  ;copy COMPUTED FIELD, replacing Y variable with DIT
"RTN","DIT1",25,0)
 .N DITN
"RTN","DIT1",26,0)
 .S D=$P(W,U,5,99),^DD(Y,V,0)=$P(W,U,1,4)_"^N DIT "_$$DITRPL(D)
"RTN","DIT1",27,0)
 .S ^DD(Y,V,9)="^",^DD(Y,V,9.1)=$G(^DD(L,V,9.1))
"RTN","DIT1",28,0)
 .F DITN=9.01,9.02 S W=$G(^DD(L,V,DITN)) I W]"" D Y S ^DD(Y,V,DITN)=W
"RTN","DIT1",29,0)
 .S DITN=9.15 F  S DITN=$O(^DD(L,V,DITN)) Q:DITN=""  I $D(^(DITN))#2 S ^DD(Y,V,DITN)=$$DITRPL(^(DITN))
"RTN","DIT1",30,0)
MULFLD I D S L(+D)=D#1+DHIT,W=$P(W,U)_U_L(+D)_$P(D,+D,2,9)_U_$P(W,U,3,99)
"RTN","DIT1",31,0)
 E  X A ;D Y ;DO NOT REPLACE NUMBERS IN THE '0' NODE --GFT 1/30/2010
"RTN","DIT1",32,0)
 S ^DD(Y,V,0)=W,%B=0
"RTN","DIT1",33,0)
N S %B=$O(@("^DD(L,V,"_%A_"%B)")) G:((%B=5)&(%A="")) N I %B="" Q:'%Z  S @("%B="_$P(%A,",",%Z)),%Z=%Z-1,%A=$P(%A,",",1,%Z)_$E(",",%Z>0) G N
"RTN","DIT1",34,0)
 I @("$D(^DD(L,V,"_%A_"%B))#2") S W=^(%B) D D S @("^DD(Y,V,"_%A_"%B)=W")
"RTN","DIT1",35,0)
 I @("$D(^DD(L,V,"_%A_"%B))<9") G N
"RTN","DIT1",36,0)
 S:+%B'=%B %B=""""_%B_"""" S %A=%A_%B_",",%Z=%Z+1,%B="" G N
"RTN","DIT1",37,0)
 ;
"RTN","DIT1",38,0)
DITRPL(W) S W=$$REPLACE(W,"Y("_L_","_V_",","DIT(") D D Q W
"RTN","DIT1",39,0)
 ;
"RTN","DIT1",40,0)
D X A
"RTN","DIT1",41,0)
Y ;REPLACE THE NUMBERS; CALLED FROM DIT2
"RTN","DIT1",42,0)
 N O
"RTN","DIT1",43,0)
 F O=0:0 S O=$O(L(O)) Q:'O  S W=$$REPLACE(W,O,L(O))
"RTN","DIT1",44,0)
 Q
"RTN","DIT1",45,0)
 ;
"RTN","DIT1",46,0)
REPLACE(X,OLD,NEW) ;
"RTN","DIT1",47,0)
 N %,C
"RTN","DIT1",48,0)
 S C=$L(NEW)-$L(OLD)
"RTN","DIT1",49,0)
 F %=0:0 S %=$F(X,OLD,%) Q:%<1  I C+$L(X)<256,$E(X,%)'=".",$E(X,%-$L(OLD)-1)'?1N S X=$E(X,1,%-$L(OLD)-1)_NEW_$E(X,%,9999),%=%+C
"RTN","DIT1",50,0)
 Q X
"RTN","DIT1",51,0)
 ;
"RTN","DIT1",52,0)
IXKEY(DIFRN,DIFRGBL,DITON,DITOGBL) ; transfer KEY and INDEX file entries
"RTN","DIT1",53,0)
 ; DIFRN=from file#, DIFRN(DIFRN)=from file list, DIFRGBL=from file global, DITON=to file#, DITOGBL=to file global
"RTN","DIT1",54,0)
 N A,B,E,F,V,Y
"RTN","DIT1",55,0)
 N DIFRNAME,DIFRD0,DIG,DITOD0,DIL1,DIL2,DIL3,DIFRPRT,I,X S DIFRNAME=""
"RTN","DIT1",56,0)
 S DIL1=$L(DIFRGBL)
"RTN","DIT1",57,0)
 S DIL3=$O(DIFRN("")) S:DIL3 DIL3=$F(DIFRGBL,DIL3) S:DIL3 DIL3=DIL3-1,DIFRPRT=$E(DIFRGBL,1,DIL3)
"RTN","DIT1",58,0)
 ; INDEX file entries
"RTN","DIT1",59,0)
 F  S DIFRNAME=$O(^DD("IX","BB",DIFRN,DIFRNAME)) Q:DIFRNAME=""  D
"RTN","DIT1",60,0)
 . S DIFRD0=$O(^DD("IX","BB",DIFRN,DIFRNAME,0)) Q:'DIFRD0
"RTN","DIT1",61,0)
 . S DITOD0=$O(^DD("IX","BB",DITON,DIFRNAME,0)) I DITOD0 D ERR("IX",DITON,DIFRNAME) Q
"RTN","DIT1",62,0)
 . S DITOD0=$$NXTNO^DICLIB("^DD(""IX"",","","U")
"RTN","DIT1",63,0)
 . M ^DD("IX",DITOD0)=^DD("IX",DIFRD0)
"RTN","DIT1",64,0)
 . K ^DD("IX",DITOD0,11.1,"AC"),^("B"),^("BB")
"RTN","DIT1",65,0)
 . I DIFRGBL'=DITOGBL!(DIFRN'=DITON) S DIG="^DD(""IX"","_DITOD0_")" D ADJ
"RTN","DIT1",66,0)
 . S DIK="^DD(""IX"",",DA=DITOD0 D IX1^DIK
"RTN","DIT1",67,0)
 . Q
"RTN","DIT1",68,0)
 ; KEY file entries
"RTN","DIT1",69,0)
 S DIFRNAME=""
"RTN","DIT1",70,0)
 F  S DIFRNAME=$O(^DD("KEY","BB",DIFRN,DIFRNAME)) Q:DIFRNAME=""  D
"RTN","DIT1",71,0)
 . S DIFRD0=$O(^DD("KEY","BB",DIFRN,DIFRNAME,0)) Q:'DIFRD0
"RTN","DIT1",72,0)
 . S DITOD0=$O(^DD("KEY","BB",DITON,DIFRNAME,0)) I DITOD0 D ERR("KEY",DITON,DIFRNAME) Q
"RTN","DIT1",73,0)
 . S DITOD0=$$NXTNO^DICLIB("^DD(""KEY"",","","U")
"RTN","DIT1",74,0)
 . M ^DD("KEY",DITOD0)=^DD("KEY",DIFRD0)
"RTN","DIT1",75,0)
 . K ^DD("KEY",DITOD0,2,"B"),^("BB"),^("S")
"RTN","DIT1",76,0)
 . I DIFRGBL'=DITOGBL!(DIFRN'=DITON) S DIG="^DD(""KEY"","_DITOD0_")" D ADJ
"RTN","DIT1",77,0)
 . S DIK="^DD(""KEY"",",DA=DITOD0 D IX1^DIK
"RTN","DIT1",78,0)
 . Q
"RTN","DIT1",79,0)
 Q
"RTN","DIT1",80,0)
ADJ ; Change data to contain new file number and global reference.
"RTN","DIT1",81,0)
 F  S DIG=$Q(@DIG),X=$QS(DIG,2) Q:X'=DITOD0  D
"RTN","DIT1",82,0)
 . S X=@DIG,I=0
"RTN","DIT1",83,0)
 . I DIFRGBL'=DITOGBL F  S I=$F(X,DIFRGBL,I) Q:'I  D
"RTN","DIT1",84,0)
 . . S $E(X,I-DIL1,I-1)=DITOGBL,I=I+$L(DITOGBL)-DIL1
"RTN","DIT1",85,0)
 . Q:DIFRN=DITON  N DIF,DIT
"RTN","DIT1",86,0)
 . F DIF=0:0 S DIF=$O(DIFRN(DIF)) Q:'DIF  S DIT=DIFRN(DIF),DIL2=$L(DIF),I=0 F  D  Q:'I
"RTN","DIT1",87,0)
 . . S I=$F(X,DIF,I) Q:'I  Q:$E(X,I,999)
"RTN","DIT1",88,0)
 . . I DIL3,$E(X,(I-DIL3+1),(I-DIL1+DIL3-1))=DIFRPRT Q
"RTN","DIT1",89,0)
 . . S $E(X,I-DIL2,I-1)=DIT,I=I+$L(DIT)-DIL2
"RTN","DIT1",90,0)
 . S @DIG=X Q
"RTN","DIT1",91,0)
 Q
"RTN","DIT1",92,0)
 ;
"RTN","DIT1",93,0)
ERR(DITYPE,DITON,DIFRNAME) ;
"RTN","DIT1",94,0)
 ;DITYPE=IX or KEY, DITON=file/subfile#, DIFRNAME=Index/Key name
"RTN","DIT1",95,0)
 N DIPAR,DIER S DIPAR(1)=$S(DITYPE="IX":"INDEX",1:"KEY")
"RTN","DIT1",96,0)
 S DIPAR(2)=DIFRNAME,DIPAR(3)=DITON
"RTN","DIT1",97,0)
 D BLD^DIALOG(9548,.DIPAR),MSG^DIALOG("WE")
"RTN","DIT1",98,0)
 Q
"RTN","DIT1",99,0)
 ;
"RTN","DIT1",100,0)
 ; Error list
"RTN","DIT1",101,0)
 ;9548 - |1| '|2|' for file |3| already exists.
"RTN","DIT1",102,0)
 ;
"RTN","DIT1",103,0)
 Q
"RTN","DIT1",104,0)
 ;
"RTN","DIT1",105,0)
P W $C(7),"FILE #"_+Y_" SHOULD ONLY BE TRANSFERRED TO A FILE WHOSE NUMBER",!?8,"ALSO "_$S(Y#1:"ENDS WITH '"_(Y#1)_"'",1:"IS INTEGER") K L,A Q
"RTN","DIT1",106,0)
 ;
"VER")
8^22.0
**END**
**END**
