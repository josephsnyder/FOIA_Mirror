KIDS Distribution saved on Jun 18, 2008@09:19:26
CPRS27 REQUIRED BUNDLE - RELEASED
**KIDS**:CPRS BUNDLE GUI 27.0^WV*1.0*23^TIU*1.0*219^GMPL*2.0*35^GMRA*4.0*38^GMTS*2.7*80^LR*5.2*365^

**INSTALL NAME**
CPRS BUNDLE GUI 27.0
"BLD",6678,0)
CPRS BUNDLE GUI 27.0^^1^3080618^n
"BLD",6678,6.3)
49
"BLD",6678,10,0)
^9.63^6^6
"BLD",6678,10,1,0)
WV*1.0*23^1
"BLD",6678,10,2,0)
TIU*1.0*219^1
"BLD",6678,10,3,0)
GMPL*2.0*35^1
"BLD",6678,10,4,0)
GMRA*4.0*38^1
"BLD",6678,10,5,0)
GMTS*2.7*80^1
"BLD",6678,10,6,0)
LR*5.2*365^1
"BLD",6678,10,"B","GMPL*2.0*35",3)

"BLD",6678,10,"B","GMRA*4.0*38",4)

"BLD",6678,10,"B","GMTS*2.7*80",5)

"BLD",6678,10,"B","LR*5.2*365",6)

"BLD",6678,10,"B","TIU*1.0*219",2)

"BLD",6678,10,"B","WV*1.0*23",1)

"BLD",6678,"INID")
n
"BLD",6678,"PRE")

"MBREQ")
0
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"VER")
8.0^22.0
**INSTALL NAME**
WV*1.0*23
"BLD",18245,0)
WV*1.0*23^WOMEN'S HEALTH^0^3070801^y
"BLD",18245,1,0)
^^2^2^3070801^
"BLD",18245,1,1,0)
The description of this patch may be found in the National Patch Module 
"BLD",18245,1,2,0)
under WV*1.0*23.
"BLD",18245,4,0)
^9.64PA^^
"BLD",18245,6)
3^
"BLD",18245,6.3)
5
"BLD",18245,"ABPKG")
n
"BLD",18245,"KRN",0)
^9.67PA^8989.52^19
"BLD",18245,"KRN",.4,0)
.4
"BLD",18245,"KRN",.401,0)
.401
"BLD",18245,"KRN",.402,0)
.402
"BLD",18245,"KRN",.403,0)
.403
"BLD",18245,"KRN",.5,0)
.5
"BLD",18245,"KRN",.84,0)
.84
"BLD",18245,"KRN",3.6,0)
3.6
"BLD",18245,"KRN",3.8,0)
3.8
"BLD",18245,"KRN",9.2,0)
9.2
"BLD",18245,"KRN",9.8,0)
9.8
"BLD",18245,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",18245,"KRN",9.8,"NM",1,0)
WVLABCHK^^0^B25232765
"BLD",18245,"KRN",9.8,"NM",2,0)
WVRALINK^^0^B50520938
"BLD",18245,"KRN",9.8,"NM",3,0)
WVSNOMED^^0^B25930871
"BLD",18245,"KRN",9.8,"NM","B","WVLABCHK",1)
 
"BLD",18245,"KRN",9.8,"NM","B","WVRALINK",2)
 
"BLD",18245,"KRN",9.8,"NM","B","WVSNOMED",3)
 
"BLD",18245,"KRN",19,0)
19
"BLD",18245,"KRN",19.1,0)
19.1
"BLD",18245,"KRN",101,0)
101
"BLD",18245,"KRN",409.61,0)
409.61
"BLD",18245,"KRN",771,0)
771
"BLD",18245,"KRN",870,0)
870
"BLD",18245,"KRN",8989.51,0)
8989.51
"BLD",18245,"KRN",8989.52,0)
8989.52
"BLD",18245,"KRN",8994,0)
8994
"BLD",18245,"KRN","B",.4,.4)
 
"BLD",18245,"KRN","B",.401,.401)
 
"BLD",18245,"KRN","B",.402,.402)
 
"BLD",18245,"KRN","B",.403,.403)
 
"BLD",18245,"KRN","B",.5,.5)
 
"BLD",18245,"KRN","B",.84,.84)
 
"BLD",18245,"KRN","B",3.6,3.6)
 
"BLD",18245,"KRN","B",3.8,3.8)
 
"BLD",18245,"KRN","B",9.2,9.2)
 
"BLD",18245,"KRN","B",9.8,9.8)
 
"BLD",18245,"KRN","B",19,19)
 
"BLD",18245,"KRN","B",19.1,19.1)
 
"BLD",18245,"KRN","B",101,101)
 
"BLD",18245,"KRN","B",409.61,409.61)
 
"BLD",18245,"KRN","B",771,771)
 
"BLD",18245,"KRN","B",870,870)
 
"BLD",18245,"KRN","B",8989.51,8989.51)
 
"BLD",18245,"KRN","B",8989.52,8989.52)
 
"BLD",18245,"KRN","B",8994,8994)
 
"BLD",18245,"QUES",0)
^9.62^^
"BLD",18245,"REQB",0)
^9.611^2^2
"BLD",18245,"REQB",1,0)
WV*1.0*16^2
"BLD",18245,"REQB",2,0)
WV*1.0*18^2
"BLD",18245,"REQB","B","WV*1.0*16",1)
 
"BLD",18245,"REQB","B","WV*1.0*18",2)
 
"MBREQ")
0
"PKG",368,-1)
1^1
"PKG",368,0)
WOMEN'S HEALTH^WV^Tracks health issues specific to female patients.
"PKG",368,20,0)
^9.402P^^
"PKG",368,22,0)
^9.49I^1^1
"PKG",368,22,1,0)
1.0^2980925^2981001^50
"PKG",368,22,1,"PAH",1,0)
23^3070801
"PKG",368,22,1,"PAH",1,1,0)
^^2^2^3070801
"PKG",368,22,1,"PAH",1,1,1,0)
The description of this patch may be found in the National Patch Module 
"PKG",368,22,1,"PAH",1,1,2,0)
under WV*1.0*23.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")
 
"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","WVLABCHK")
0^1^B25232765^B24588923
"RTN","WVLABCHK",1,0)
WVLABCHK ;HIOFO/FT-IS LAB TEST A PAP SMEAR? ;10/25/04  10:23
"RTN","WVLABCHK",2,0)
 ;;1.0;WOMEN'S HEALTH;**16,23**;Sep 30, 1998;Build 5
"RTN","WVLABCHK",3,0)
 ;
"RTN","WVLABCHK",4,0)
 ; This routine uses the following IAs:
"RTN","WVLABCHK",5,0)
 ;   #525 - ^LR references      (controlled)
"RTN","WVLABCHK",6,0)
 ;  #4298 - ^LR references      (private)
"RTN","WVLABCHK",7,0)
 ; #10103 - ^XLFDT calls        (supported)
"RTN","WVLABCHK",8,0)
 ; #10063 - ^%ZTLOAD            (supported)
"RTN","WVLABCHK",9,0)
 ; #10141 - ^XPDUTL             (supported)
"RTN","WVLABCHK",10,0)
 ; #10035 - ^DPT                (supported)
"RTN","WVLABCHK",11,0)
 ;
"RTN","WVLABCHK",12,0)
 ; This routine supports the following IAs:
"RTN","WVLABCHK",13,0)
 ; CREATE - 4525
"RTN","WVLABCHK",14,0)
 ;
"RTN","WVLABCHK",15,0)
CREATE(DFN,LRDFN,LRI,LRA,LRSS) ;
"RTN","WVLABCHK",16,0)
 ; Add lab test to WH file (#790.08).
"RTN","WVLABCHK",17,0)
 ; Called by REPORT RELEASE DATE/TIME field in:
"RTN","WVLABCHK",18,0)
 ; a) File 63, Field 63.08,.11
"RTN","WVLABCHK",19,0)
 ; b) File 63, Field 63.09,.11
"RTN","WVLABCHK",20,0)
 ; Input: DFN    = PATIENT DFN
"RTN","WVLABCHK",21,0)
 ;        LRDFN  = FILE 63 IEN (+^DPT(DFN,"LR"))
"RTN","WVLABCHK",22,0)
 ;        LRI    = INVERSE DATE/TIME OF TEST
"RTN","WVLABCHK",23,0)
 ;        LRA    = ZERO NODE OF THE CY or SP ENTRY
"RTN","WVLABCHK",24,0)
 ;        LRSS   = File 63 subscript (e.g., CY or SP)
"RTN","WVLABCHK",25,0)
 ;
"RTN","WVLABCHK",26,0)
 Q:($G(DFN)']"")!($G(LRDFN)']"")!($G(LRI)']"")!($G(LRA)']"")!($G(LRSS)']"")
"RTN","WVLABCHK",27,0)
 Q:'$D(^WV(790.02,DUZ(2)))  ;no site parameter entry
"RTN","WVLABCHK",28,0)
 Q:'$P($G(^WV(790.02,+$G(DUZ(2)),0)),U,24)  ;lab link is NO or null
"RTN","WVLABCHK",29,0)
 N ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE
"RTN","WVLABCHK",30,0)
 S ZTRTN="CREATEQ^WVLABCHK",ZTDESC="WV CHECK SNOMED CODE CHANGES"
"RTN","WVLABCHK",31,0)
 S ZTSAVE("DFN")="",ZTSAVE("LRDFN")="",ZTSAVE("LRI")="",ZTSAVE("LRA")=""
"RTN","WVLABCHK",32,0)
 S ZTSAVE("LRSS")="",ZTIO=""
"RTN","WVLABCHK",33,0)
 S ZTDTH=$$HADD^XLFDT($H,"","","",150) ;don't want the SNOMED trigger to 
"RTN","WVLABCHK",34,0)
 ; conflict with the report verification trigger
"RTN","WVLABCHK",35,0)
 D ^%ZTLOAD
"RTN","WVLABCHK",36,0)
 Q
"RTN","WVLABCHK",37,0)
CREATEQ ; Called from CREATE above
"RTN","WVLABCHK",38,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","WVLABCHK",39,0)
 N WVDATE,WVDFN,WVDUZ2,WVIEN,WVLABAN,WVLOC,WVLRDFN,WVLRI,WVLRSS,WVNODE,WVPAP,WVPIEN,WVPROV,WVTOP,X,Y
"RTN","WVLABCHK",40,0)
 Q:$P($G(^DPT(DFN,0)),U,2)'="F"  ;not female
"RTN","WVLABCHK",41,0)
 S WVLABAN=$P(LRA,U,6) ;lab accession#
"RTN","WVLABCHK",42,0)
 Q:$D(^WV(790.1,"F",WVLABAN))  ;already tracked
"RTN","WVLABCHK",43,0)
 ; check WH site parameters
"RTN","WVLABCHK",44,0)
 Q:'$D(^WV(790.02,DUZ(2)))  ;no site parameter entry
"RTN","WVLABCHK",45,0)
 Q:'$P($G(^WV(790.02,+$G(DUZ(2)),0)),U,24)  ;lab link is NO or null
"RTN","WVLABCHK",46,0)
 Q:'$$VNVEC^WVLRLINK()  ;vet/non-vet/eligibility code check
"RTN","WVLABCHK",47,0)
 D CODES ;what SNOMED codes are we looking for?
"RTN","WVLABCHK",48,0)
 I WVTOP(0)=0 Q  ;no SNOMED codes identified
"RTN","WVLABCHK",49,0)
 S WVPIEN=$$PAPIEN^WVRPCPR()
"RTN","WVLABCHK",50,0)
 Q:'WVPIEN
"RTN","WVLABCHK",51,0)
 S WVIEN=$O(^WV(790.08,"B",WVLABAN,0))
"RTN","WVLABCHK",52,0)
 Q:'WVIEN
"RTN","WVLABCHK",53,0)
 S WVNODE=$G(^WV(790.08,WVIEN,0))
"RTN","WVLABCHK",54,0)
 Q:WVNODE=""
"RTN","WVLABCHK",55,0)
 S WVLRDFN=$P(WVNODE,U,36)
"RTN","WVLABCHK",56,0)
 Q:'WVLRDFN
"RTN","WVLABCHK",57,0)
 S WVLRI=$P(WVNODE,U,37)
"RTN","WVLABCHK",58,0)
 Q:'WVLRI
"RTN","WVLABCHK",59,0)
 S WVLRSS=$P(WVNODE,U,38)
"RTN","WVLABCHK",60,0)
 S WVDFN=$P(WVNODE,U,2)
"RTN","WVLABCHK",61,0)
 S WVPROV=$P(WVNODE,U,7)
"RTN","WVLABCHK",62,0)
 S WVLOC=$P(WVNODE,U,11)
"RTN","WVLABCHK",63,0)
 S WVDATE=$P(WVNODE,U,12)
"RTN","WVLABCHK",64,0)
 S WVLABAN=$P(WVNODE,U,1)
"RTN","WVLABCHK",65,0)
 S WVDUZ2=$P(WVNODE,U,10)
"RTN","WVLABCHK",66,0)
 I WVLRSS="CY" D  Q
"RTN","WVLABCHK",67,0)
 .S WVPAP=$$CY()
"RTN","WVLABCHK",68,0)
 .D:WVPAP ADD
"RTN","WVLABCHK",69,0)
 .Q
"RTN","WVLABCHK",70,0)
 I WVLRSS="SP" D  Q
"RTN","WVLABCHK",71,0)
 .S WVPAP=$$SP()
"RTN","WVLABCHK",72,0)
 .D:WVPAP ADD
"RTN","WVLABCHK",73,0)
 .Q
"RTN","WVLABCHK",74,0)
 Q
"RTN","WVLABCHK",75,0)
 ;
"RTN","WVLABCHK",76,0)
CODES ; WVTOP array identifies SNOMED codes (IENS) used for pap smears
"RTN","WVLABCHK",77,0)
 N WVPIEN,WVPIEN1,WVSNOMED
"RTN","WVLABCHK",78,0)
 S WVTOP(0)=0
"RTN","WVLABCHK",79,0)
 S WVPIEN=$$PAPIEN^WVRPCPR()
"RTN","WVLABCHK",80,0)
 I 'WVPIEN Q  ;pap smear procedure not identified
"RTN","WVLABCHK",81,0)
 S WVPIEN1=0
"RTN","WVLABCHK",82,0)
 F  S WVPIEN1=$O(^WV(790.2,WVPIEN,2,WVPIEN1)) Q:'WVPIEN1  D
"RTN","WVLABCHK",83,0)
 .S WVSNOMED=$P($G(^WV(790.2,WVPIEN,2,WVPIEN1,0)),U,1)
"RTN","WVLABCHK",84,0)
 .Q:'WVSNOMED
"RTN","WVLABCHK",85,0)
 .S WVTOP(0)=WVTOP(0)+1
"RTN","WVLABCHK",86,0)
 .S WVTOP(WVSNOMED)=""
"RTN","WVLABCHK",87,0)
 .Q
"RTN","WVLABCHK",88,0)
 Q
"RTN","WVLABCHK",89,0)
CY() ; Check SNOMED codes used by cytology entry
"RTN","WVLABCHK",90,0)
 N WVFLAG,WVLOOP,WVSNOMED
"RTN","WVLABCHK",91,0)
 S (WVFLAG,WVLOOP)=0
"RTN","WVLABCHK",92,0)
 ; check topography multiple
"RTN","WVLABCHK",93,0)
 F  S WVLOOP=$O(^LR(WVLRDFN,"CY",WVLRI,2,WVLOOP)) Q:'WVLOOP!(WVFLAG=1)  D
"RTN","WVLABCHK",94,0)
 .S WVSNOMED=+$P($G(^LR(WVLRDFN,"CY",WVLRI,2,WVLOOP,0)),U,1)
"RTN","WVLABCHK",95,0)
 .Q:'WVSNOMED
"RTN","WVLABCHK",96,0)
 .I $D(WVTOP(WVSNOMED)) S WVFLAG=1
"RTN","WVLABCHK",97,0)
 .Q
"RTN","WVLABCHK",98,0)
 Q WVFLAG
"RTN","WVLABCHK",99,0)
 ;
"RTN","WVLABCHK",100,0)
SP() ; Check SNOMED codes used by surgical pathology entry
"RTN","WVLABCHK",101,0)
 N WVFLAG,WVLOOP,WVSNOMED
"RTN","WVLABCHK",102,0)
 ; check topography multiple
"RTN","WVLABCHK",103,0)
 S (WVFLAG,WVLOOP)=0
"RTN","WVLABCHK",104,0)
 F  S WVLOOP=$O(^LR(WVLRDFN,"SP",WVLRI,2,WVLOOP)) Q:'WVLOOP!(WVFLAG=1)  D
"RTN","WVLABCHK",105,0)
 .S WVSNOMED=+$P($G(^LR(WVLRDFN,"SP",WVLRI,2,WVLOOP,0)),U,1)
"RTN","WVLABCHK",106,0)
 .Q:'WVSNOMED
"RTN","WVLABCHK",107,0)
 .I $D(WVTOP(WVSNOMED)) S WVFLAG=1
"RTN","WVLABCHK",108,0)
 .Q
"RTN","WVLABCHK",109,0)
 Q WVFLAG
"RTN","WVLABCHK",110,0)
 ;
"RTN","WVLABCHK",111,0)
ADD ; Add pap smear to FILE 790.1
"RTN","WVLABCHK",112,0)
 N WVDR,WVERR
"RTN","WVLABCHK",113,0)
 S WVERR=0
"RTN","WVLABCHK",114,0)
 I '$D(^WV(790,WVDFN,0)) D  ;add patient to File 790, if not there
"RTN","WVLABCHK",115,0)
 .D AUTOADD^WVPATE(WVDFN,WVDUZ2,.WVERR)
"RTN","WVLABCHK",116,0)
 .Q
"RTN","WVLABCHK",117,0)
 Q:WVERR<0  ;quit if new patient could not be added to File 790
"RTN","WVLABCHK",118,0)
 S WVDR=".02////"_WVDFN
"RTN","WVLABCHK",119,0)
 S WVDR=WVDR_";.04////"_WVPIEN ;File 790.2 pointer
"RTN","WVLABCHK",120,0)
 S:WVPROV]"" WVDR=WVDR_";.07////"_WVPROV ;provider
"RTN","WVLABCHK",121,0)
 S WVDR=WVDR_";.1////"_WVDUZ2 ;health care facility
"RTN","WVLABCHK",122,0)
 S:WVLOC]"" WVDR=WVDR_";.11////"_WVLOC ;patient location
"RTN","WVLABCHK",123,0)
 S WVDR=WVDR_";.12////"_WVDATE ;procedure date/time
"RTN","WVLABCHK",124,0)
 S WVDR=WVDR_";.14////"_"o" ;status
"RTN","WVLABCHK",125,0)
 S WVDR=WVDR_";.18////.5;.19////"_DT ;entering user and date
"RTN","WVLABCHK",126,0)
 S WVDR=WVDR_";.34////"_WVDUZ2 ;accessioning facility
"RTN","WVLABCHK",127,0)
 S WVDR=WVDR_";2.17////"_WVLABAN ;lab accession#
"RTN","WVLABCHK",128,0)
 S WVDR=WVDR_";2.18////"_WVLRDFN ;Lab Data file (#63) pointer
"RTN","WVLABCHK",129,0)
 S WVDR=WVDR_";2.19////"_WVLRI ;Lab Data file inverse d/t
"RTN","WVLABCHK",130,0)
 S WVDR=WVDR_";2.2////"_WVLRSS ;Lab Data file subscript (CY/SP)
"RTN","WVLABCHK",131,0)
 ; add procedure to File 790.1
"RTN","WVLABCHK",132,0)
 D NEW2^WVPROC(WVDFN,WVPIEN,WVDATE,WVDR,"","",.WVERR)
"RTN","WVLABCHK",133,0)
 Q:'Y
"RTN","WVLABCHK",134,0)
 I $$PATCH^XPDUTL("OR*3.0*210") D
"RTN","WVLABCHK",135,0)
 .D CPRS^WVSNOMED(70,WVDFN,"",WVPROV,"Pap Smear results available.",WVLRSS_U_WVLABAN_U_WVLRI)
"RTN","WVLABCHK",136,0)
 .D DELETE^WVLABADD(WVIEN)
"RTN","WVLABCHK",137,0)
 .Q 
"RTN","WVLABCHK",138,0)
 Q
"RTN","WVRALINK")
0^2^B50520938^B49986932
"RTN","WVRALINK",1,0)
WVRALINK ;HCIOFO/FT-RAD/NM-WOMEN'S HEALTH LINK  ;6/10/04  14:51
"RTN","WVRALINK",2,0)
 ;;1.0;WOMEN'S HEALTH;**3,5,7,9,10,16,18,23**;Sep 30, 1998;Build 5
"RTN","WVRALINK",3,0)
 ;
"RTN","WVRALINK",4,0)
 ; This routine uses the following IAs:
"RTN","WVRALINK",5,0)
 ; #2480  - FILE 70         (private)
"RTN","WVRALINK",6,0)
 ; #2481  - FILE 71         (private)
"RTN","WVRALINK",7,0)
 ; #2482  - FILE 71.2       (private)
"RTN","WVRALINK",8,0)
 ; #10035 - FILE 2          (supported)
"RTN","WVRALINK",9,0)
 ; #10063 - ^%ZTLOAD        (supported)
"RTN","WVRALINK",10,0)
 ; #10070 - ^XMD            (supported)
"RTN","WVRALINK",11,0)
 ; #10141 - ^XPDUTL         (supported)
"RTN","WVRALINK",12,0)
 ; #2541  - ^XUPARAM        (supported)
"RTN","WVRALINK",13,0)
 ;
"RTN","WVRALINK",14,0)
 ;;  Original routine created by IHS/ANMC/MWR
"RTN","WVRALINK",15,0)
 ;;* MICHAEL REMILLARD, DDS * ALASKA NATIVE MEDICAL CENTER *
"RTN","WVRALINK",16,0)
 ;;  CREATE MAMMOGRAM PROCEDURE IN WOMEN'S HEALTH FOR THIS PATIENT.
"RTN","WVRALINK",17,0)
 ;;  CALLED BY ^RART WHEN A RADIOLOGY REPORT IS VERIFIED.
"RTN","WVRALINK",18,0)
 ;;  CALLED BY ^RARTE1 WHEN A RADIOLOGY REPORT IS UNVERIFIED.
"RTN","WVRALINK",19,0)
 ;;  CALLED BY ^WVEXPTRA WHEN EXPORTING HISTORICAL MAMS TO WOMEN'S HEALTH
"RTN","WVRALINK",20,0)
 ;
"RTN","WVRALINK",21,0)
 ;---> REQUIRED VARIABLES: DFN  = DFN OF RADIOLOGY PATIENT.
"RTN","WVRALINK",22,0)
 ;--->                     DATE = INVERSE DATE/TIME OF VISIT.
"RTN","WVRALINK",23,0)
 ;--->                     CASE = IEN OF RADIOLOGY EXAM (CASE).
"RTN","WVRALINK",24,0)
 ;
"RTN","WVRALINK",25,0)
 ;---> OPTIONAL VARIABLE:  WVNEWP = TOTAL NEW WH PATIENTS ADDED.
"RTN","WVRALINK",26,0)
 ;--->                     WVMCNT = TOTAL NEW MAMS PROCEDURES ADDED.
"RTN","WVRALINK",27,0)
 ;--->                     THESE IF CALLED FROM ^WVEXPTRA ROUTINE.
"RTN","WVRALINK",28,0)
 ;
"RTN","WVRALINK",29,0)
 ;---> GENERATED VARIBLES:
"RTN","WVRALINK",30,0)
 ;---> WVPROC = IEN OF RADIOLOGY PROCEDURE (FILE #71), THEN IT
"RTN","WVRALINK",31,0)
 ;--->          GETS CHANGED TO WOMEN'S HEALTH PROCEDURE TYPE
"RTN","WVRALINK",32,0)
 ;--->                                   (FILE #790.2).
"RTN","WVRALINK",33,0)
 ;---> WVLOC  = WARD/CLINIC/LOCATION (FILE #44).
"RTN","WVRALINK",34,0)
 ;---> WVDATE = DATE OF THE PROCEDURE.
"RTN","WVRALINK",35,0)
 ;---> WVPROV = ORDERING PROVIDER.
"RTN","WVRALINK",36,0)
 ;---> WVMOD  = LEFT OR RIGHT, IF IT'S A UNILATERAL MAMMOGRAM.
"RTN","WVRALINK",37,0)
 ;---> WVDX   = RADIOLOGY DIAGNOSTIC CODE.
"RTN","WVRALINK",38,0)
 ;---> WVBWDX = WOMEN'S HEALTH RESULT/DIAGNOSIS.
"RTN","WVRALINK",39,0)
 ;
"RTN","WVRALINK",40,0)
CREATE(DFN,DATE,CASE) ;
"RTN","WVRALINK",41,0)
 Q:'+$$VERSION^XPDUTL("WV")
"RTN","WVRALINK",42,0)
 Q:($G(DFN)']"")!($G(DATE)']"")!($G(CASE)']"")
"RTN","WVRALINK",43,0)
 N ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE
"RTN","WVRALINK",44,0)
 S:'$D(DUZ)#2 DUZ=.5
"RTN","WVRALINK",45,0)
 S:'$D(DUZ(2))#2 DUZ(2)=$$KSP^XUPARAM("INST")
"RTN","WVRALINK",46,0)
 S ZTRTN="CREATEQ^WVRALINK",ZTDESC="WV CREATE MAMMOGRAM ENTRY"
"RTN","WVRALINK",47,0)
 S ZTSAVE("DFN")="",ZTSAVE("DATE")="",ZTSAVE("CASE")=""
"RTN","WVRALINK",48,0)
 S ZTIO="",ZTDTH=$H
"RTN","WVRALINK",49,0)
 D ^%ZTLOAD
"RTN","WVRALINK",50,0)
 Q
"RTN","WVRALINK",51,0)
CREATEH(DFN,DATE,CASE,STATUS) ; Entry from ^WVEXPTRA which looks for exams
"RTN","WVRALINK",52,0)
 ; created before the WH package was installed.
"RTN","WVRALINK",53,0)
 Q:($G(DFN)']"")!($G(DATE)']"")!($G(CASE)']"")!($G(STATUS)']"")
"RTN","WVRALINK",54,0)
 ; 
"RTN","WVRALINK",55,0)
CREATEQ ; Queue data entry creation. Called from CREATE above
"RTN","WVRALINK",56,0)
 N WVPROC,WVLOC,WVDATE,WVDR,WVPROV,WVMOD,WVDX,WVBWDX,WVLEFT,WVRIGHT
"RTN","WVRALINK",57,0)
 N WVCASE,WVCPT,WVERR,WVCREDIT,WVEXAM0,WVZSTAT
"RTN","WVRALINK",58,0)
 ;---> QUIT IF RADIOLOGY DATA IS NOT DEFINED OR ="".
"RTN","WVRALINK",59,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","WVRALINK",60,0)
 Q:'$D(^RADPT(DFN,"DT",DATE,"P",CASE,0))
"RTN","WVRALINK",61,0)
 ;
"RTN","WVRALINK",62,0)
 ;---> QUIT IF THIS PROCEDURE DOES NOT HAVE A MAM CPT CODE.
"RTN","WVRALINK",63,0)
 ;---> QUIT IF THIS PROCEDURE DOES NOT HAVE AN ULTRASOUND CPT CODE.
"RTN","WVRALINK",64,0)
 ;---> WVEXAM0=ZERO NODE OF RADIOLOGY EXAM.
"RTN","WVRALINK",65,0)
 S WVEXAM0=^RADPT(DFN,"DT",DATE,"P",CASE,0)
"RTN","WVRALINK",66,0)
 S WVCPT=$$GET1^DIQ(71,$P(WVEXAM0,U,2),9,"I") Q:WVCPT=""
"RTN","WVRALINK",67,0)
 S WVPROC=$O(^WV(790.2,"AC",WVCPT,0)) ;cpt code x-ref to get 790.2 ien
"RTN","WVRALINK",68,0)
 Q:'WVPROC  ;cpt code is not tracked in 790.2
"RTN","WVRALINK",69,0)
 Q:$P($G(^WV(790.2,+WVPROC,0)),U,5)'="R"  ;cpt is not rad/nm procedure
"RTN","WVRALINK",70,0)
 Q:$P($G(^DPT(DFN,0)),U,2)'="F"  ;not female
"RTN","WVRALINK",71,0)
 ;
"RTN","WVRALINK",72,0)
 ;---> QUIT IF NO WOMEN'S HEALTH SITE PARAMETER FILE ON THIS MACHINE.
"RTN","WVRALINK",73,0)
 ;     OR NO DEFAULT CASE MANAGER
"RTN","WVRALINK",74,0)
 Q:'$D(^WV(790.02,DUZ(2)))
"RTN","WVRALINK",75,0)
 Q:'$P($G(^WV(790.02,+$G(DUZ(2)),0)),U,2)
"RTN","WVRALINK",76,0)
 ;
"RTN","WVRALINK",77,0)
 ;---> IF NOT CALLED FROM ^WVEXPTRA (i.e., STATUS is undefined) CHECK
"RTN","WVRALINK",78,0)
 ;---> SITE PARAMETER AND QUIT IF "IMPORT MAMMOGRAMS FROM RADIOLOGY"
"RTN","WVRALINK",79,0)
 ;---> IS NOT SET TO "YES". CHECK VETERAN STATUS AND ELIGIBILITY CODE.
"RTN","WVRALINK",80,0)
 N Y S Y=^WV(790.02,DUZ(2),0)
"RTN","WVRALINK",81,0)
 I '$D(STATUS) Q:'$P(Y,U,10)
"RTN","WVRALINK",82,0)
 I '$D(STATUS) Q:'$$VNVEC^WVRALIN1()  ;vet/non-vet/eligibility code check
"RTN","WVRALINK",83,0)
 ;
"RTN","WVRALINK",84,0)
 ;---> SET WVZSTAT =THE STATUS (OPEN OR CLOSED) IN WOMEN'S HEALTH.
"RTN","WVRALINK",85,0)
 ;---> THAT MAMMOGRAMS SHOULD RECEIVE WHEN COPIED OVER FROM RADIOLOGY.
"RTN","WVRALINK",86,0)
 S WVZSTAT=$P(Y,U,23) S:WVZSTAT="" WVZSTAT="o"
"RTN","WVRALINK",87,0)
 I $G(STATUS)]"" S WVZSTAT=$G(STATUS) ;status selected in ^WVEXPTRA
"RTN","WVRALINK",88,0)
 ;
"RTN","WVRALINK",89,0)
 D COPY(WVEXAM0)
"RTN","WVRALINK",90,0)
 ;
"RTN","WVRALINK",91,0)
EXIT ;EP
"RTN","WVRALINK",92,0)
 K I,N,X
"RTN","WVRALINK",93,0)
 Q
"RTN","WVRALINK",94,0)
 ;
"RTN","WVRALINK",95,0)
COPY(Y) ;EP
"RTN","WVRALINK",96,0)
 ;---> COPY MAM PROCEDURE DATA FROM RADIOLOGY TO WOMEN'S HEALTH.
"RTN","WVRALINK",97,0)
 ;---> VARIABLE DFN=PATIENT
"RTN","WVRALINK",98,0)
 ;---> LOCATION=DUZ(2)
"RTN","WVRALINK",99,0)
 ;---> WARD/CLINIC/LOCATION
"RTN","WVRALINK",100,0)
 N X
"RTN","WVRALINK",101,0)
 S WVLOC=$P(Y,U,8)
"RTN","WVRALINK",102,0)
 ;
"RTN","WVRALINK",103,0)
 ;---> WVDATE=DATE OF THE PROCEDURE.
"RTN","WVRALINK",104,0)
 S WVDATE=$P($P(^RADPT(DFN,"DT",DATE,0),U),".")
"RTN","WVRALINK",105,0)
 ;
"RTN","WVRALINK",106,0)
 ;---> RECONSTRUCT THE FULL CASE# FOR THIS RAD PROCEDURE.
"RTN","WVRALINK",107,0)
 ;---> THIS IS USED AS A LINK (XREF) BETWEEN THE RADIOLOGY PROCEDURE
"RTN","WVRALINK",108,0)
 ;---> AND THE WOMEN'S HEALTH PROCEDURE.
"RTN","WVRALINK",109,0)
 S WVCASE=$E(WVDATE,4,7)_$E(WVDATE,2,3)_"-"_$P(Y,U)
"RTN","WVRALINK",110,0)
 ;---> CHECK TO BE SURE THE CASE# XREF IS REALLY DOWN THERE.
"RTN","WVRALINK",111,0)
 S:'$D(^RADPT("ADC",WVCASE,DFN,DATE,CASE)) WVCASE="UNKNOWN"
"RTN","WVRALINK",112,0)
 ;
"RTN","WVRALINK",113,0)
 ;---> QUIT IF THIS PROCEDURE HAS ALREADY BEEN SENT TO WOMEN'S HEALTH.
"RTN","WVRALINK",114,0)
 Q:$D(^WV(790.1,"E",WVCASE))
"RTN","WVRALINK",115,0)
 ;
"RTN","WVRALINK",116,0)
 ;---> REQUESTING PROVIDER/ORDERING PROVIDER
"RTN","WVRALINK",117,0)
 S WVPROV=$P(Y,U,14)
"RTN","WVRALINK",118,0)
 ;
"RTN","WVRALINK",119,0)
 ;---> IF UNILATERAL, ATTEMPT TO PICK UP LEFT OR RIGHT MODIFIER.
"RTN","WVRALINK",120,0)
 I WVPROC=26 D
"RTN","WVRALINK",121,0)
 .I $D(^RADPT(DFN,"DT",DATE,"P",CASE,"M",0)) D
"RTN","WVRALINK",122,0)
 ..N N S N=0
"RTN","WVRALINK",123,0)
 ..F  S N=$O(^RADPT(DFN,"DT",DATE,"P",CASE,"M",N)) Q:'N  D
"RTN","WVRALINK",124,0)
 ...S WVMOD=$P(^RADPT(DFN,"DT",DATE,"P",CASE,"M",N,0),U)
"RTN","WVRALINK",125,0)
 ...S WVMOD=$$GET1^DIQ(71.2,WVMOD,.01,"I")
"RTN","WVRALINK",126,0)
 ...I "LEFTleft"[WVMOD S WVLEFT=1
"RTN","WVRALINK",127,0)
 ...I "RIGHTright"[WVMOD S WVRIGHT=1
"RTN","WVRALINK",128,0)
 ..Q:$D(WVLEFT)&($D(WVRIGHT))
"RTN","WVRALINK",129,0)
 ..I $D(WVLEFT) S WVMOD="l" Q
"RTN","WVRALINK",130,0)
 ..I $D(WVRIGHT) S WVMOD="r" Q
"RTN","WVRALINK",131,0)
 ;
"RTN","WVRALINK",132,0)
 ;---> IF THERE'S A DIAGNOSTIC CODE, ATTEMPT TO PICK UP DIAGNOSIS.
"RTN","WVRALINK",133,0)
 ;---> USE "WV DIAGNOSTIC CODE TRANSLATION" FILE #790.32.
"RTN","WVRALINK",134,0)
 S WVDX=$P(Y,U,13)
"RTN","WVRALINK",135,0)
 I +WVDX I $D(^WV(790.32,"C",WVDX)) S WVBWDX=$O(^WV(790.32,"C",WVDX,0))
"RTN","WVRALINK",136,0)
 ;
"RTN","WVRALINK",137,0)
 ;---> GET CREDIT METHOD.
"RTN","WVRALINK",138,0)
 S WVCREDIT=$P(Y,U,26)
"RTN","WVRALINK",139,0)
 ;
"RTN","WVRALINK",140,0)
PATIENT ;---> IF PATIENT ISN'T IN WOMEN'S HEALTH DATABASE, ADD HER.
"RTN","WVRALINK",141,0)
 S WVERR=1
"RTN","WVRALINK",142,0)
 I '$D(^WV(790,DFN,0)) D
"RTN","WVRALINK",143,0)
 .D AUTOADD^WVPATE(DFN,DUZ(2),.WVERR)
"RTN","WVRALINK",144,0)
 .I $D(WVNEWP) S:WVERR WVNEWP=WVNEWP+1
"RTN","WVRALINK",145,0)
 Q:WVERR<0
"RTN","WVRALINK",146,0)
 D FIND^WVRALIN1 ;check for 'unlinked' entry in File 790.1
"RTN","WVRALINK",147,0)
 Q:$D(^WV(790.1,"E",WVCASE))  ;quit if link was made in WVRALIN1
"RTN","WVRALINK",148,0)
PROC ;---> CREATE MAMMOGRAM PROCEDURE IN WV PROCEDURE FILE #790.1.
"RTN","WVRALINK",149,0)
 S WVDR=".02////"_DFN_";.04////"_WVPROC
"RTN","WVRALINK",150,0)
 S WVDR=WVDR_";.05////"_$G(WVBWDX)_";.07////"_WVPROV
"RTN","WVRALINK",151,0)
 S WVDR=WVDR_";.09////"_$G(WVMOD)_";.1////"_DUZ(2)_";.11////"_WVLOC
"RTN","WVRALINK",152,0)
 S WVDR=WVDR_";.12////"_WVDATE_";.14////"_WVZSTAT_";.15////"_WVCASE
"RTN","WVRALINK",153,0)
 S WVDR=WVDR_";.18////.5;.19////"_DT_";.34////"_$G(DUZ(2))_";.35////"_WVCREDIT
"RTN","WVRALINK",154,0)
 ;
"RTN","WVRALINK",155,0)
 D NEW2^WVPROC(DFN,WVPROC,WVDATE,WVDR,"","",.WVERR)
"RTN","WVRALINK",156,0)
 I $D(WVMCNT) S:WVERR>-1 WVMCNT=WVMCNT+1
"RTN","WVRALINK",157,0)
 Q:WVERR<0  ;procedure not added
"RTN","WVRALINK",158,0)
 Q:$D(WVMCNT)  ;mass import of Rad/NM exams
"RTN","WVRALINK",159,0)
 ;Q:$P($G(^WV(790.02,+DUZ(2),0)),U,23)="c"  ;Status=closed
"RTN","WVRALINK",160,0)
 I (WVCPT=76856)!(WVCPT=76830)!(WVCPT=76645) D  Q  ;not breast related
"RTN","WVRALINK",161,0)
 .D MAIL^WVRADWP(DFN,+Y,WVPROC,WVPROV) ;iens for patient, accession, procedure, provider/requestor
"RTN","WVRALINK",162,0)
 .Q
"RTN","WVRALINK",163,0)
 D CPRS^WVSNOMED(69,DFN,"",WVPROV,"Mammogram results available.",DATE_"~"_CASE)
"RTN","WVRALINK",164,0)
 Q
"RTN","WVRALINK",165,0)
 ;
"RTN","WVRALINK",166,0)
DELETE(DFN,DATE,CASE) ;EP
"RTN","WVRALINK",167,0)
 ;---> MODIFY WOMEN'S HEALTH PROCEDURE TO REFLECT CHANGE.
"RTN","WVRALINK",168,0)
 ;---> CALLED FROM RARTE1 (DELETE A REPORT AND UNVERIFY A REPORT).
"RTN","WVRALINK",169,0)
 ;
"RTN","WVRALINK",170,0)
 Q:'+$$VERSION^XPDUTL("WV")
"RTN","WVRALINK",171,0)
 Q:'$D(DFN)!('$D(DATE))!('$D(CASE))
"RTN","WVRALINK",172,0)
 N ZTDESC,ZTDTH,ZTIO,ZTRTN,ZTSAVE
"RTN","WVRALINK",173,0)
 S ZTRTN="DELETEQ^WVRALINK",ZTDESC="WV MAMMOGRAM RPT CHANGE"
"RTN","WVRALINK",174,0)
 S ZTSAVE("DFN")="",ZTSAVE("DATE")="",ZTSAVE("CASE")=""
"RTN","WVRALINK",175,0)
 S ZTIO="",ZTDTH=$H
"RTN","WVRALINK",176,0)
 D ^%ZTLOAD
"RTN","WVRALINK",177,0)
 Q
"RTN","WVRALINK",178,0)
DELETEQ ; Modify WV entry when mammogram report is unverified or deleted
"RTN","WVRALINK",179,0)
 Q:'$D(^RADPT(DFN,"DT",DATE,"P",CASE,0))
"RTN","WVRALINK",180,0)
 N WVIEN,WVDATE,WVCASE,WVCMGR,WVLOOP,WVMSG,WVPROV
"RTN","WVRALINK",181,0)
 N XMDUZ,XMSUB,XMTEXT,XMY ;send mail message to case manager
"RTN","WVRALINK",182,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","WVRALINK",183,0)
 ;
"RTN","WVRALINK",184,0)
 ;---> WVDATE=DATE OF PROCEDURE.
"RTN","WVRALINK",185,0)
 S WVDATE=$P($P(^RADPT(DFN,"DT",DATE,0),U),".")
"RTN","WVRALINK",186,0)
 S WVCASE=$P(^RADPT(DFN,"DT",DATE,"P",CASE,0),U)
"RTN","WVRALINK",187,0)
 ;
"RTN","WVRALINK",188,0)
 ;---> WVCASE=RECONSTRUCTED CASE# OF PROCEDURE.
"RTN","WVRALINK",189,0)
 S WVCASE=$E(WVDATE,4,7)_$E(WVDATE,2,3)_"-"_WVCASE
"RTN","WVRALINK",190,0)
 ;---> QUIT IF NO CASE# XREF IN WOMEN'S HEALTH PROCEDURE FILE.
"RTN","WVRALINK",191,0)
 Q:'$D(^WV(790.1,"E",WVCASE))
"RTN","WVRALINK",192,0)
 ;
"RTN","WVRALINK",193,0)
 S WVIEN=$O(^WV(790.1,"E",WVCASE,0))
"RTN","WVRALINK",194,0)
 Q:'$D(^WV(790.1,WVIEN,0))
"RTN","WVRALINK",195,0)
 D RADMOD^WVPROC(WVIEN) ;update wh status to "open"
"RTN","WVRALINK",196,0)
 S WVPROV=+$$GET1^DIQ(790.1,WVIEN,.07,"I") ;get provider/requestor
"RTN","WVRALINK",197,0)
 S WVCMGR=+$$GET1^DIQ(790,DFN,.1,"I") ;get case manager
"RTN","WVRALINK",198,0)
 S:WVCMGR XMY(WVCMGR)=""
"RTN","WVRALINK",199,0)
 ; if no case manager, then get default case manager(s)
"RTN","WVRALINK",200,0)
 I 'WVCMGR S WVLOOP=0 F  S WVLOOP=$O(^WV(790.02,WVLOOP)) Q:'WVLOOP  D
"RTN","WVRALINK",201,0)
 .S WVCMGR=$$GET1^DIQ(790.02,WVLOOP,.02,"I")
"RTN","WVRALINK",202,0)
 .S:WVCMGR XMY(WVCMGR)=""
"RTN","WVRALINK",203,0)
 .Q
"RTN","WVRALINK",204,0)
 Q:$O(XMY(0))'>0  ;no case manager(s)
"RTN","WVRALINK",205,0)
 S:WVPROV XMY(WVPROV)=""
"RTN","WVRALINK",206,0)
 S XMDUZ=.5 ;message sender
"RTN","WVRALINK",207,0)
 S XMSUB="RAD/NM Rpt for WH patient is UNVERIFIED/DELETED"
"RTN","WVRALINK",208,0)
 S WVMSG(1)="        Patient: "_$P($G(^DPT(DFN,0)),U,1)_" (SSN: "_$$SSN^WVUTL1(DFN)_")"
"RTN","WVRALINK",209,0)
 S WVMSG(2)=" WH Accession #: "_$P($G(^WV(790.1,+WVIEN,0)),U,1)
"RTN","WVRALINK",210,0)
 S WVMSG(3)="  RAD/NM Case #: "_WVCASE
"RTN","WVRALINK",211,0)
 S WVMSG(4)=" "
"RTN","WVRALINK",212,0)
 S WVMSG(5)="NOTE: THIS PROCEDURE HAS BEEN ALTERED IN RADIOLOGY/NM."
"RTN","WVRALINK",213,0)
 S WVMSG(6)="Follow-up is required in the WOMEN'S HEALTH package!"
"RTN","WVRALINK",214,0)
 S XMTEXT="WVMSG("
"RTN","WVRALINK",215,0)
 D ^XMD
"RTN","WVRALINK",216,0)
 Q
"RTN","WVSNOMED")
0^3^B25930871^B25679304
"RTN","WVSNOMED",1,0)
WVSNOMED ;HIOFO/FT-IS LAB TEST A PAP SMEAR? ;2/12/04  14:37
"RTN","WVSNOMED",2,0)
 ;;1.0;WOMEN'S HEALTH;**16,23**;Sep 30, 1998;Build 5
"RTN","WVSNOMED",3,0)
 ;
"RTN","WVSNOMED",4,0)
 ; This routine uses the following IAs:
"RTN","WVSNOMED",5,0)
 ;  #1362 - ^ORB3               (controlled)
"RTN","WVSNOMED",6,0)
 ;   #525 - ^LR references      (controlled)
"RTN","WVSNOMED",7,0)
 ;  #4298 - ^LR references      (private)
"RTN","WVSNOMED",8,0)
 ; #10035 - ^DPT( references    (supported)
"RTN","WVSNOMED",9,0)
 ; #10070 - ^XMD                (supported)
"RTN","WVSNOMED",10,0)
 ; #10141 - ^XPDUTL             (supported)
"RTN","WVSNOMED",11,0)
 ;
"RTN","WVSNOMED",12,0)
SNOMED() ; Check lab test for SNOMED codes that indicate if pap smear.
"RTN","WVSNOMED",13,0)
 ; LRDFN,LRI,LRSS must be defined.
"RTN","WVSNOMED",14,0)
 ; Returns: 0 - lab test is not a pap smear
"RTN","WVSNOMED",15,0)
 ;          1 - lab test is a pap smear
"RTN","WVSNOMED",16,0)
 ; 
"RTN","WVSNOMED",17,0)
 N WVPAP,WVPIEN,WVPIEN1,WVSNOMED,WVTOP
"RTN","WVSNOMED",18,0)
 ; WVTOP array identifies SNOMED codes (IENS) used for pap smears
"RTN","WVSNOMED",19,0)
 S WVTOP(0)=0
"RTN","WVSNOMED",20,0)
 S WVPIEN=$$PAPIEN^WVRPCPR()
"RTN","WVSNOMED",21,0)
 I 'WVPIEN Q 0  ;pap smear procedure entry not found
"RTN","WVSNOMED",22,0)
 S WVPIEN1=0
"RTN","WVSNOMED",23,0)
 F  S WVPIEN1=$O(^WV(790.2,WVPIEN,2,WVPIEN1)) Q:'WVPIEN1  D
"RTN","WVSNOMED",24,0)
 .S WVSNOMED=$P($G(^WV(790.2,WVPIEN,2,WVPIEN1,0)),U,1)
"RTN","WVSNOMED",25,0)
 .Q:'WVSNOMED
"RTN","WVSNOMED",26,0)
 .S WVTOP(0)=WVTOP(0)+1
"RTN","WVSNOMED",27,0)
 .S WVTOP(WVSNOMED)=""
"RTN","WVSNOMED",28,0)
 .Q
"RTN","WVSNOMED",29,0)
 I WVTOP(0)=0 Q 0  ;no SNOMED codes identified
"RTN","WVSNOMED",30,0)
 K WVTOP(0)
"RTN","WVSNOMED",31,0)
 S WVPAP=0
"RTN","WVSNOMED",32,0)
 I LRSS="CY" S WVPAP=$$CY()
"RTN","WVSNOMED",33,0)
 I LRSS="SP" S WVPAP=$$SP()
"RTN","WVSNOMED",34,0)
 Q WVPAP
"RTN","WVSNOMED",35,0)
 ;
"RTN","WVSNOMED",36,0)
CY() ; Check SNOMED codes used by cytology entry
"RTN","WVSNOMED",37,0)
 N WVFLAG,WVLOOP,WVLOOP1,WVSNOMED
"RTN","WVSNOMED",38,0)
 S (WVFLAG,WVLOOP)=0
"RTN","WVSNOMED",39,0)
 ; check topography multiple
"RTN","WVSNOMED",40,0)
 F  S WVLOOP=$O(^LR(LRDFN,"CY",LRI,2,WVLOOP)) Q:'WVLOOP!(WVFLAG=1)  D
"RTN","WVSNOMED",41,0)
 .S WVSNOMED=+$P($G(^LR(LRDFN,"CY",LRI,2,WVLOOP,0)),U,1)
"RTN","WVSNOMED",42,0)
 .Q:'WVSNOMED
"RTN","WVSNOMED",43,0)
 .I $D(WVTOP(WVSNOMED)) S WVFLAG=1
"RTN","WVSNOMED",44,0)
 .Q
"RTN","WVSNOMED",45,0)
 Q WVFLAG
"RTN","WVSNOMED",46,0)
 ;
"RTN","WVSNOMED",47,0)
SP() ; Check SNOMED codes used by surgical pathology entry
"RTN","WVSNOMED",48,0)
 N WVFLAG,WVLOOP,WVLOOP1,WVSNOMED
"RTN","WVSNOMED",49,0)
 ; check topography multiple
"RTN","WVSNOMED",50,0)
 S (WVFLAG,WVLOOP)=0
"RTN","WVSNOMED",51,0)
 F  S WVLOOP=$O(^LR(LRDFN,"SP",LRI,2,WVLOOP)) Q:'WVLOOP!(WVFLAG=1)  D
"RTN","WVSNOMED",52,0)
 .S WVSNOMED=+$P($G(^LR(LRDFN,"SP",LRI,2,WVLOOP,0)),U,1)
"RTN","WVSNOMED",53,0)
 .Q:'WVSNOMED
"RTN","WVSNOMED",54,0)
 .I $D(WVTOP(WVSNOMED)) S WVFLAG=1
"RTN","WVSNOMED",55,0)
 .Q
"RTN","WVSNOMED",56,0)
 Q WVFLAG
"RTN","WVSNOMED",57,0)
 ;
"RTN","WVSNOMED",58,0)
ADD ; Add pap smear to FILE 790.1
"RTN","WVSNOMED",59,0)
 N WV7901,WVDR,WVPIEN,WVERR
"RTN","WVSNOMED",60,0)
 S WVERR=0
"RTN","WVSNOMED",61,0)
 I '$D(^WV(790,DFN,0)) D  ;add patient to File 790, if not there
"RTN","WVSNOMED",62,0)
 .D AUTOADD^WVPATE(DFN,DUZ(2),.WVERR)
"RTN","WVSNOMED",63,0)
 .Q
"RTN","WVSNOMED",64,0)
 Q:WVERR<0  ;quit if new patient could not be added to File 790
"RTN","WVSNOMED",65,0)
 S WVPIEN=$$PAPIEN^WVRPCPR()
"RTN","WVSNOMED",66,0)
 S WVDR=".02////"_DFN
"RTN","WVSNOMED",67,0)
 S WVDR=WVDR_";.04////"_WVPIEN ;File 790.2 pointer
"RTN","WVSNOMED",68,0)
 S:WVPROV]"" WVDR=WVDR_";.07////"_WVPROV ;provider
"RTN","WVSNOMED",69,0)
 S WVDR=WVDR_";.1////"_$G(DUZ(2)) ;health care facility
"RTN","WVSNOMED",70,0)
 S:WVLOC]"" WVDR=WVDR_";.11////"_WVLOC ;patient location
"RTN","WVSNOMED",71,0)
 S WVDR=WVDR_";.12////"_WVDATE ;procedure date/time
"RTN","WVSNOMED",72,0)
 S WVDR=WVDR_";.14////"_"o" ;status
"RTN","WVSNOMED",73,0)
 S WVDR=WVDR_";.18////.5;.19////"_DT ;entering user and date
"RTN","WVSNOMED",74,0)
 S WVDR=WVDR_";.34////"_$G(DUZ(2)) ;accessioning facility
"RTN","WVSNOMED",75,0)
 S WVDR=WVDR_";2.17////"_WVLABAN ;lab accession#
"RTN","WVSNOMED",76,0)
 S WVDR=WVDR_";2.18////"_LRDFN ;Lab Data file (#63) pointer
"RTN","WVSNOMED",77,0)
 S WVDR=WVDR_";2.19////"_LRI ;Lab Data file inverse d/t
"RTN","WVSNOMED",78,0)
 S WVDR=WVDR_";2.2////"_LRSS ;Lab Data file subscript (CY/SP)
"RTN","WVSNOMED",79,0)
 ; add procedure to File 790.1
"RTN","WVSNOMED",80,0)
 D NEW2^WVPROC(DFN,WVPIEN,WVDATE,WVDR,"","",.WVERR)
"RTN","WVSNOMED",81,0)
 Q:'Y
"RTN","WVSNOMED",82,0)
 S WV7901=+Y
"RTN","WVSNOMED",83,0)
 I $$PATCH^XPDUTL("OR*3.0*210") D  Q
"RTN","WVSNOMED",84,0)
 .D CPRS^WVSNOMED(70,DFN,"",WVPROV,"Pap Smear results available.",LRSS_U_WVLABAN_U_LRI)
"RTN","WVSNOMED",85,0)
 .Q
"RTN","WVSNOMED",86,0)
 D MAIL(DFN,WVLABAN,WVPROV,LRSS,WV7901)
"RTN","WVSNOMED",87,0)
 Q
"RTN","WVSNOMED",88,0)
MAIL(DFN,WVLABAN,WVPROV,LRSS,WV7901) ; Send mail message to case manager
"RTN","WVSNOMED",89,0)
 ; when pap smear added to FILE 790.1
"RTN","WVSNOMED",90,0)
 ; Called from above
"RTN","WVSNOMED",91,0)
 ;      DFN -> Patient ien
"RTN","WVSNOMED",92,0)
 ;  WVLABAN -> Lab Accession# (e.g., CY 99 1)
"RTN","WVSNOMED",93,0)
 ;   WVPROV -> File 200   IEN (provider/requestor)
"RTN","WVSNOMED",94,0)
 ;     LRSS -> File 63 subscript (e.g., CY or SP)
"RTN","WVSNOMED",95,0)
 ;   WV7901 -> FILE 790.1 IEN
"RTN","WVSNOMED",96,0)
 Q:'$G(DFN)!($G(WVLABAN)="")!($G(LRSS)="")
"RTN","WVSNOMED",97,0)
 N WVCMGR,WVLOOP,WVMSG,XMDUZ,XMSUB,XMTEXT,XMY
"RTN","WVSNOMED",98,0)
 S WVCMGR=+$$GET1^DIQ(790,DFN,.1,"I") ;get case manager
"RTN","WVSNOMED",99,0)
 S:WVCMGR XMY(WVCMGR)=""
"RTN","WVSNOMED",100,0)
 ; if no case manager, then get default case manager(s)
"RTN","WVSNOMED",101,0)
 I 'WVCMGR S WVLOOP=0 F  S WVLOOP=$O(^WV(790.02,WVLOOP)) Q:'WVLOOP  D
"RTN","WVSNOMED",102,0)
 .S WVCMGR=$$GET1^DIQ(790.02,WVLOOP,.02,"I")
"RTN","WVSNOMED",103,0)
 .S:WVCMGR XMY(WVCMGR)=""
"RTN","WVSNOMED",104,0)
 .Q
"RTN","WVSNOMED",105,0)
 Q:$O(XMY(0))'>0  ;no case manager(s)
"RTN","WVSNOMED",106,0)
 S XMDUZ=.5 ;message sender
"RTN","WVSNOMED",107,0)
 S XMSUB="Pap Smear report verified for a WH patient"
"RTN","WVSNOMED",108,0)
 S WVMSG(1)="A "_$S(LRSS="CY":"Cytology ",LRSS="SP":"Surgical Pathology ",1:"")_"lab test was verified for:"
"RTN","WVSNOMED",109,0)
 S WVMSG(2)=" "
"RTN","WVSNOMED",110,0)
 S WVMSG(3)="                Patient: "_$P($G(^DPT(DFN,0)),U,1)_" (SSN: "_$$SSN^WVUTL1(DFN)_")"
"RTN","WVSNOMED",111,0)
 S WVMSG(4)="         WH Accession #: "_$P($G(^WV(790.1,+WV7901,0)),U,1)
"RTN","WVSNOMED",112,0)
 S WVMSG(5)="        LAB Accession #: "_WVLABAN
"RTN","WVSNOMED",113,0)
 S WVMSG(6)="Test Requestor/Provider: "_$S(+WVPROV:$$GET1^DIQ(200,+WVPROV,.01,"E"),1:"UNKNOWN")
"RTN","WVSNOMED",114,0)
 S WVMSG(7)=" "
"RTN","WVSNOMED",115,0)
 S WVMSG(8)="Please use CPRS to resolve the Clinical Reminder for this procedure and"
"RTN","WVSNOMED",116,0)
 S WVMSG(9)="complete the result."
"RTN","WVSNOMED",117,0)
 S XMTEXT="WVMSG("
"RTN","WVSNOMED",118,0)
 D ^XMD
"RTN","WVSNOMED",119,0)
 Q
"RTN","WVSNOMED",120,0)
 ;
"RTN","WVSNOMED",121,0)
CPRS(WVORN,WVDFN,WVORDER,WVPROV,WVMSG,WVIEN) ; Generate a CPRS alert
"RTN","WVSNOMED",122,0)
 ;   WVORN - FILE 100.9 IEN
"RTN","WVSNOMED",123,0)
 ;   WVDFN - FILE 2 IEN
"RTN","WVSNOMED",124,0)
 ; WVORDER - FILE 100 IEN (not currently used)
"RTN","WVSNOMED",125,0)
 ;  WVPROV - FILE 200 IEN
"RTN","WVSNOMED",126,0)
 ;   WVMSG - Free text message
"RTN","WVSNOMED",127,0)
 ;   WVIEN - IEN for a lab or radiology report (not currently used)
"RTN","WVSNOMED",128,0)
 ;
"RTN","WVSNOMED",129,0)
 Q:'$$PATCH^XPDUTL("OR*3.0*210")  ;no pap & mam alerts 
"RTN","WVSNOMED",130,0)
 Q:'WVDFN
"RTN","WVSNOMED",131,0)
 Q:'WVORN
"RTN","WVSNOMED",132,0)
 I WVPROV]"" S WVARRAY(WVPROV)="" ;provider's IEN
"RTN","WVSNOMED",133,0)
 S WVCMGR=$P($G(^WV(790,WVDFN,0)),U,10)
"RTN","WVSNOMED",134,0)
 I WVCMGR]"" S WVARRAY(WVCMGR)="" ;women's health case manager's IEN
"RTN","WVSNOMED",135,0)
 D EN^ORB3(WVORN,WVDFN,WVORDER,.WVARRAY,WVMSG,WVIEN)
"RTN","WVSNOMED",136,0)
 K WVARRAY,WVCMGR
"RTN","WVSNOMED",137,0)
 Q
"VER")
8.0^22.0
**INSTALL NAME**
TIU*1.0*219
"BLD",6007,0)
TIU*1.0*219^TEXT INTEGRATION UTILITIES^0^3080204^y
"BLD",6007,1,0)
^^1^1^3071105^
"BLD",6007,1,1,0)
See National Patch Module, TIU*1*219.
"BLD",6007,4,0)
^9.64PA^8925.95^2
"BLD",6007,4,8925,0)
8925
"BLD",6007,4,8925,2,0)
^9.641^8925^1
"BLD",6007,4,8925,2,8925,0)
TIU DOCUMENT  (File-top level)
"BLD",6007,4,8925,2,8925,1,0)
^9.6411^1301^2
"BLD",6007,4,8925,2,8925,1,1209,0)
ATTENDING PHYSICIAN
"BLD",6007,4,8925,2,8925,1,1301,0)
REFERENCE DATE
"BLD",6007,4,8925,222)
y^y^p^^^^n^^n
"BLD",6007,4,8925,224)

"BLD",6007,4,8925.95,0)
8925.95
"BLD",6007,4,8925.95,2,0)
^9.641^8925.955^1
"BLD",6007,4,8925.95,2,8925.955,0)
USERS REQUIRING COSIGNATURE  (sub-file)
"BLD",6007,4,8925.95,2,8925.955,1,0)
^9.6411^.01^1
"BLD",6007,4,8925.95,2,8925.955,1,.01,0)
USERS REQUIRING COSIGNATURE
"BLD",6007,4,8925.95,222)
y^y^p^^^^n^^n
"BLD",6007,4,8925.95,224)

"BLD",6007,4,"APDD",8925,8925)

"BLD",6007,4,"APDD",8925,8925,1209)

"BLD",6007,4,"APDD",8925,8925,1301)

"BLD",6007,4,"APDD",8925.95,8925.955)

"BLD",6007,4,"APDD",8925.95,8925.955,.01)

"BLD",6007,4,"B",8925,8925)

"BLD",6007,4,"B",8925.95,8925.95)

"BLD",6007,6)
7^
"BLD",6007,6.3)
11
"BLD",6007,"INID")
^n
"BLD",6007,"INIT")
TIUPS219
"BLD",6007,"KRN",0)
^9.67PA^8989.52^19
"BLD",6007,"KRN",.4,0)
.4
"BLD",6007,"KRN",.401,0)
.401
"BLD",6007,"KRN",.402,0)
.402
"BLD",6007,"KRN",.402,"NM",0)
^9.68A^^0
"BLD",6007,"KRN",.403,0)
.403
"BLD",6007,"KRN",.5,0)
.5
"BLD",6007,"KRN",.84,0)
.84
"BLD",6007,"KRN",3.6,0)
3.6
"BLD",6007,"KRN",3.8,0)
3.8
"BLD",6007,"KRN",9.2,0)
9.2
"BLD",6007,"KRN",9.8,0)
9.8
"BLD",6007,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",6007,"KRN",9.8,"NM",1,0)
TIULX^^0^B45161741
"BLD",6007,"KRN",9.8,"NM",2,0)
TIUSRVP1^^0^B41331651
"BLD",6007,"KRN",9.8,"NM",3,0)
TIULA3^^0^B16648234
"BLD",6007,"KRN",9.8,"NM","B","TIULA3",3)

"BLD",6007,"KRN",9.8,"NM","B","TIULX",1)

"BLD",6007,"KRN",9.8,"NM","B","TIUSRVP1",2)

"BLD",6007,"KRN",19,0)
19
"BLD",6007,"KRN",19,"NM",0)
^9.68A^^
"BLD",6007,"KRN",19.1,0)
19.1
"BLD",6007,"KRN",101,0)
101
"BLD",6007,"KRN",409.61,0)
409.61
"BLD",6007,"KRN",771,0)
771
"BLD",6007,"KRN",870,0)
870
"BLD",6007,"KRN",8989.51,0)
8989.51
"BLD",6007,"KRN",8989.52,0)
8989.52
"BLD",6007,"KRN",8994,0)
8994
"BLD",6007,"KRN",8994,"NM",0)
^9.68A^1^1
"BLD",6007,"KRN",8994,"NM",1,0)
TIU IS USER A USR PROVIDER^^0
"BLD",6007,"KRN",8994,"NM","B","TIU IS USER A USR PROVIDER",1)

"BLD",6007,"KRN","B",.4,.4)

"BLD",6007,"KRN","B",.401,.401)

"BLD",6007,"KRN","B",.402,.402)

"BLD",6007,"KRN","B",.403,.403)

"BLD",6007,"KRN","B",.5,.5)

"BLD",6007,"KRN","B",.84,.84)

"BLD",6007,"KRN","B",3.6,3.6)

"BLD",6007,"KRN","B",3.8,3.8)

"BLD",6007,"KRN","B",9.2,9.2)

"BLD",6007,"KRN","B",9.8,9.8)

"BLD",6007,"KRN","B",19,19)

"BLD",6007,"KRN","B",19.1,19.1)

"BLD",6007,"KRN","B",101,101)

"BLD",6007,"KRN","B",409.61,409.61)

"BLD",6007,"KRN","B",771,771)

"BLD",6007,"KRN","B",870,870)

"BLD",6007,"KRN","B",8989.51,8989.51)

"BLD",6007,"KRN","B",8989.52,8989.52)

"BLD",6007,"KRN","B",8994,8994)

"BLD",6007,"QDEF")
^^^^^^^^^^YES
"BLD",6007,"QUES",0)
^9.62^^
"BLD",6007,"REQB",0)
^9.611^7^3
"BLD",6007,"REQB",5,0)
TIU*1.0*136^2
"BLD",6007,"REQB",6,0)
TIU*1.0*112^2
"BLD",6007,"REQB",7,0)
TIU*1.0*98^2
"BLD",6007,"REQB","B","TIU*1.0*112",6)

"BLD",6007,"REQB","B","TIU*1.0*136",5)

"BLD",6007,"REQB","B","TIU*1.0*98",7)

"FIA",8925)
TIU DOCUMENT
"FIA",8925,0)
^TIU(8925,
"FIA",8925,0,0)
8925IsP
"FIA",8925,0,1)
y^y^p^^^^n^^n
"FIA",8925,0,10)

"FIA",8925,0,11)

"FIA",8925,0,"RLRO")

"FIA",8925,0,"VR")
1.0^TIU
"FIA",8925,8925)
1
"FIA",8925,8925,1209)

"FIA",8925,8925,1301)

"FIA",8925.95)
TIU DOCUMENT PARAMETERS
"FIA",8925.95,0)
^TIU(8925.95,
"FIA",8925.95,0,0)
8925.95P
"FIA",8925.95,0,1)
y^y^p^^^^n^^n
"FIA",8925.95,0,10)

"FIA",8925.95,0,11)

"FIA",8925.95,0,"RLRO")

"FIA",8925.95,0,"VR")
1.0^TIU
"FIA",8925.95,8925.95)
1
"FIA",8925.95,8925.95,5)

"FIA",8925.95,8925.955)
1
"FIA",8925.95,8925.955,.01)

"INIT")
TIUPS219
"IX",8925,8925,"ADIV",0)
8925^ADIV^Index on DIVISION, DOCUMENT TYPE, STATUS, and REFERENCE DATE^R^^R^IR^I^8925^^^^^S
"IX",8925,8925,"ADIV",.1,0)
^^2^2^3030418^
"IX",8925,8925,"ADIV",.1,1,0)
This Regular New style-type, multi- field cross-reference is optimized for
"IX",8925,8925,"ADIV",.1,2,0)
searching division, document type, status, and reference date range.
"IX",8925,8925,"ADIV",1)
S ^TIU(8925,"ADIV",X(1),X(2),X(3),X(4),DA)=""
"IX",8925,8925,"ADIV",2)
K ^TIU(8925,"ADIV",X(1),X(2),X(3),X(4),DA)
"IX",8925,8925,"ADIV",2.5)
K ^TIU(8925,"ADIV")
"IX",8925,8925,"ADIV",11.1,0)
^.114IA^4^4
"IX",8925,8925,"ADIV",11.1,1,0)
1^F^8925^1212^^1^F
"IX",8925,8925,"ADIV",11.1,1,3)

"IX",8925,8925,"ADIV",11.1,2,0)
2^F^8925^.01^^2^F
"IX",8925,8925,"ADIV",11.1,2,3)

"IX",8925,8925,"ADIV",11.1,3,0)
3^F^8925^.05^^3^F
"IX",8925,8925,"ADIV",11.1,3,3)

"IX",8925,8925,"ADIV",11.1,4,0)
4^F^8925^1301^^4^F
"IX",8925,8925,"ADIV",11.1,4,2)
S X=9999999-X
"IX",8925,8925,"ADIV",11.1,4,3)
S X=9999999-X
"KRN",8994,2014,-1)
0^1
"KRN",8994,2014,0)
TIU IS USER A USR PROVIDER^USRPROV^TIUSRVP1^1
"KRN",8994,2014,1,0)
^^2^2^3070815^
"KRN",8994,2014,1,1,0)
This Boolean RPC returns TRUE if the user was a member of USR CLASS 
"KRN",8994,2014,1,2,0)
PROVIDER on the date specified.
"KRN",8994,2014,2,0)
^8994.02A^2^2
"KRN",8994,2014,2,1,0)
USER^1^^0^1
"KRN",8994,2014,2,1,1,0)
^^2^2^3070815^
"KRN",8994,2014,2,1,1,1,0)
This is the IEN of the user in the NEW PERSON FILE 200.  If no user is 
"KRN",8994,2014,2,1,1,2,0)
specified, DUZ (the current user of the software) is the default.
"KRN",8994,2014,2,2,0)
DATE^1^^0^2
"KRN",8994,2014,2,2,1,0)
^^4^4^3070815^
"KRN",8994,2014,2,2,1,1,0)
This is the date in internal FILEMAN format for which the user's 
"KRN",8994,2014,2,2,1,2,0)
membership in USR CLASS PROVIDER is evaluated.  If no date is received, 
"KRN",8994,2014,2,2,1,3,0)
TODAY is the default. Date must be a strict date; time must NOT be
"KRN",8994,2014,2,2,1,4,0)
included.
"KRN",8994,2014,2,"B","DATE",2)

"KRN",8994,2014,2,"B","USER",1)

"KRN",8994,2014,2,"PARAMSEQ",1,1)

"KRN",8994,2014,2,"PARAMSEQ",2,2)

"KRN",8994,2014,3,0)
^^2^2^3070815^
"KRN",8994,2014,3,1,0)
TRUE is returned if user is an active member of USR CLASS PROVIDER on 
"KRN",8994,2014,3,2,0)
the given date. If not, FALSE is returned.
"MBREQ")
0
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"PKG",362,-1)
1^1
"PKG",362,0)
TEXT INTEGRATION UTILITIES^TIU^Text Integration Utilities 
"PKG",362,20,0)
^9.402P^^
"PKG",362,22,0)
^9.49I^1^1
"PKG",362,22,1,0)
1.0^3010119^2970819^64
"PKG",362,22,1,"PAH",1,0)
219^3080204^222222243
"PKG",362,22,1,"PAH",1,1,0)
^^1^1^3080204
"PKG",362,22,1,"PAH",1,1,1,0)
See National Patch Module, TIU*1*219.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","TIULA3")
0^3^B16648234^B10926325
"RTN","TIULA3",1,0)
TIULA3 ; SLC/JER - Still more interactive functions ;1/31/08
"RTN","TIULA3",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**50,79,98,219**;Jun 20, 1997;Build 11
"RTN","TIULA3",3,0)
TITLE ; Title Look-up
"RTN","TIULA3",4,0)
 N TIUI,TYPE,TIUCLASS S TIUI=0
"RTN","TIULA3",5,0)
 S TIUTYP=$NA(^TMP("TIUTYP",$J))
"RTN","TIULA3",6,0)
 K @TIUTYP
"RTN","TIULA3",7,0)
 I +$G(TIUPICT)'>0 Q
"RTN","TIULA3",8,0)
 I $P($G(TIUPICT(1)),U,4)="ALL" D
"RTN","TIULA3",9,0)
 . S TIUCLASS=+$O(^TIU(8925.1,"AD",+$P(TIUPICT(1),U,2),0))
"RTN","TIULA3",10,0)
 . K TIUPICT
"RTN","TIULA3",11,0)
 . S TIUPICT=1,TIUPICT(1)="1^"_TIUCLASS_U_$$PNAME^TIULC1(TIUCLASS)
"RTN","TIULA3",12,0)
 F  S TIUI=$O(TIUPICT(TIUI)) Q:+TIUI'>0  D
"RTN","TIULA3",13,0)
 . S TIUCLASS=$P(TIUPICT(TIUI),U,2)
"RTN","TIULA3",14,0)
 . W !!,"For ",$$UP^XLFSTR($$PNAME^TIULC1(TIUCLASS)),":  "
"RTN","TIULA3",15,0)
 . D TITLPICK(.TYPE,TIUCLASS)
"RTN","TIULA3",16,0)
 M @TIUTYP=TYPE
"RTN","TIULA3",17,0)
 S Y="ANY"
"RTN","TIULA3",18,0)
 Q
"RTN","TIULA3",19,0)
TITLPICK(TIUTYP,CLASS) ; Select multiple titles
"RTN","TIULA3",20,0)
 N TIUI,TYPE,TIUPRMT S TIUI=0
"RTN","TIULA3",21,0)
 W !!,"Please Select the ",$$UP^XLFSTR($$PNAME^TIULC1(CLASS))
"RTN","TIULA3",22,0)
 W " TITLES to search for:",!
"RTN","TIULA3",23,0)
 F  D  Q:+$G(TYPE)'>0
"RTN","TIULA3",24,0)
 . K TYPE
"RTN","TIULA3",25,0)
 . S TIUI=TIUI+1,TIUPRMT=$J(TIUI,3)_")  "
"RTN","TIULA3",26,0)
 . D DOCSPICK^TIULA2(.TYPE,CLASS,"A",0,TIUPRMT)
"RTN","TIULA3",27,0)
 . I +TYPE>0 S TIUTYP=+$G(TIUTYP)+1,TIUTYP(TIUTYP)=$G(TYPE(1))
"RTN","TIULA3",28,0)
 . I  I $P(TYPE(1),U,4)="SINGLE ITEM" D
"RTN","TIULA3",29,0)
 . . W !,"There is only one TITLE under ",$$UP^XLFSTR($$PNAME^TIULC1(CLASS))
"RTN","TIULA3",30,0)
 . . S TYPE=0
"RTN","TIULA3",31,0)
 . I $S($D(DTOUT):1,$D(DUOUT):1,(+TYPE'>0&'$D(TIUTYP)):1,1:0) S TIUQUIT=1
"RTN","TIULA3",32,0)
 W !
"RTN","TIULA3",33,0)
 Q
"RTN","TIULA3",34,0)
ASKTITLE(CLASS,TIUTTL) ; Ask for a different title, same class
"RTN","TIULA3",35,0)
 N TIUY,TIUTYP,DFLT,SCREEN,X,Y
"RTN","TIULA3",36,0)
 S DFLT=$$RSLVTITL(TIUTTL)
"RTN","TIULA3",37,0)
 S SCREEN="I $P(^TIU(8925.1,+Y,0),U,4)=""DOC"",($P(^(0),U)'[""ADDENDUM""),+$$ISA^TIULX(+Y,CLASS),+$$CANPICK^TIULP(+Y),+$$CANENTR^TIULP(+Y)"
"RTN","TIULA3",38,0)
 S TIUY=+$$ASKTYP^TIULA2(+CLASS,DFLT,SCREEN,"TITLE: ")
"RTN","TIULA3",39,0)
 I +$G(TIUY)'>0 S TIUY=TIUTTL
"RTN","TIULA3",40,0)
 Q TIUY
"RTN","TIULA3",41,0)
RSLVTITL(TIUTTL) ; Resolve pointers to titles
"RTN","TIULA3",42,0)
 Q $P($G(^TIU(8925.1,+TIUTTL,0)),U)
"RTN","TIULA3",43,0)
ASKSEQ(TIUDFLT) ; Ask preferred sort sequence
"RTN","TIULA3",44,0)
 N TIUPRMT,TIUSET,TIUY S TIUDFLT=$G(TIUDFLT,"D")
"RTN","TIULA3",45,0)
 S TIUPRMT="Please Specify Sort Order: "
"RTN","TIULA3",46,0)
 S TIUSET="A:ascending (OLDEST FIRST);D:descending (NEWEST FIRST)"
"RTN","TIULA3",47,0)
 S TIUY=$$READ^TIUU("SA^"_TIUSET,TIUPRMT,$S(TIUDFLT="A":"ascending",1:"descending"))
"RTN","TIULA3",48,0)
 Q TIUY
"RTN","TIULA3",49,0)
DATENOTE(X) ; Ask for date/time of note
"RTN","TIULA3",50,0)
 N %DT,Y
"RTN","TIULA3",51,0)
 ;S TIUPRMT="DATE/TIME OF NOTE"
"RTN","TIULA3",52,0)
 ;S TIUY=$$READ^TIUU("D^:NOW:RS",TIUPRMT,$G(DFLT,"NOW"),TIUHLP)
"RTN","TIULA3",53,0)
 ;I +TIUY W "     ",$P(TIUY,U,2)
"RTN","TIULA3",54,0)
 S %DT="RSX",%DT(0)="-NOW" D ^%DT
"RTN","TIULA3",55,0)
 I +Y'>0 D
"RTN","TIULA3",56,0)
 . W !,$C(7),"Enter DATE AND TIME of the note [TIME REQUIRED] (future dates prohibited)."
"RTN","TIULA3",57,0)
 Q +$G(Y)
"RTN","TIULA3",58,0)
SCRCSNR(TIUDA,Y) ; Evaluate whether a person may be selected to cosign
"RTN","TIULA3",59,0)
 N TIUI,TIUY,TIUD0,TIUD12 S TIUY=1 ; most people may be selected
"RTN","TIULA3",60,0)
 S TIUD0=$G(^TIU(8925,+TIUDA,0)),TIUD12=$G(^TIU(8925,+TIUDA,12))
"RTN","TIULA3",61,0)
 ; If he requires cosignature for this document a user may NOT select
"RTN","TIULA3",62,0)
 ; himself
"RTN","TIULA3",63,0)
 I +$$REQCOSIG^TIULP(+TIUD0,+TIUDA,+$G(DUZ)),(Y=+$G(DUZ)) S TIUY=0 G SCREENX
"RTN","TIULA3",64,0)
 ; A TERMINATED User may NOT be selected
"RTN","TIULA3",65,0)
 I +$$ACTIVE^XUSER(+Y)'>0 S TIUY=0 G SCREENX
"RTN","TIULA3",66,0)
 ; A non-PROVIDER may NOT be selected
"RTN","TIULA3",67,0)
 I +$$PROVIDER^TIUPXAP1(+Y,DT)'>0 S TIUY=0 G SCREENX
"RTN","TIULA3",68,0)
 ; Author may NOT be selected
"RTN","TIULA3",69,0)
 I Y=+$P(TIUD12,U,2) S TIUY=0 G SCREENX
"RTN","TIULA3",70,0)
 ; Expected Signer may NOT be selected
"RTN","TIULA3",71,0)
 I Y=+$P(TIUD12,U,4) S TIUY=0 G SCREENX
"RTN","TIULA3",72,0)
 ; Others who require Cosignature may NOT be selected
"RTN","TIULA3",73,0)
 I +$$REQCOSIG^TIULP(+TIUD0,+TIUDA,+Y) S TIUY=0
"RTN","TIULA3",74,0)
SCREENX Q +$G(TIUY)
"RTN","TIULA3",75,0)
 ;
"RTN","TIULA3",76,0)
SCRATT(TIUDA,PERSON) ; Can a person be an Attending for a given docmt?
"RTN","TIULA3",77,0)
 N TIUD0,TIUTYP,CANSEL,DICTDT,TIUISDS,TIUPRNT,TIUPTYP,TIUPD0,TIUISAD
"RTN","TIULA3",78,0)
 S PERSON=+PERSON,TIUDA=+TIUDA,CANSEL=1
"RTN","TIULA3",79,0)
 S TIUD0=$G(^TIU(8925,TIUDA,0)),TIUPRNT=+$P(TIUD0,U,6)
"RTN","TIULA3",80,0)
 S DICTDT=+$P($G(^TIU(8925,+TIUDA,13)),U,7)
"RTN","TIULA3",81,0)
 I DICTDT>0 S DICTDT=$P(DICTDT,".")
"RTN","TIULA3",82,0)
 ; Is Docmt an Addendum, a DS?
"RTN","TIULA3",83,0)
 S TIUTYP=+TIUD0,(TIUPTYP,TIUISAD)=0
"RTN","TIULA3",84,0)
 I TIUPRNT>0 S TIUPTYP=+$G(^TIU(8925,TIUPRNT,0))
"RTN","TIULA3",85,0)
 I TIUPTYP>0,$P($G(^TIU(8925.1,TIUTYP,0)),U)["ADDENDUM" S TIUISAD=1
"RTN","TIULA3",86,0)
 S TIUISDS=+$S('TIUISAD:$$ISDS^TIULX(TIUTYP),1:$$ISDS^TIULX(TIUPTYP))
"RTN","TIULA3",87,0)
 ; A TERMINATED (as of NOW) User may NOT be selected:
"RTN","TIULA3",88,0)
 I $$ISTERM^USRLM(PERSON) S CANSEL=0 G SCRATTX
"RTN","TIULA3",89,0)
 ; If not DS, is person an active provider?
"RTN","TIULA3",90,0)
 I 'TIUISDS S:'$$PROVIDER^TIUPXAP1(PERSON,DT) CANSEL=0 G SCRATTX
"RTN","TIULA3",91,0)
 ; TIUDA is a DS:
"RTN","TIULA3",92,0)
 ; Attendings must be in USR Class PROVIDER NOW:
"RTN","TIULA3",93,0)
 I '$$ISA^USRLM(+PERSON,"PROVIDER") S CANSEL=0 G SCRATTX
"RTN","TIULA3",94,0)
 ; Persons who require Cosignature on Dictation Dt may NOT be selected:
"RTN","TIULA3",95,0)
 I +$$REQCOSIG^TIULP(TIUTYP,+TIUDA,PERSON,DICTDT) S CANSEL=0
"RTN","TIULA3",96,0)
SCRATTX Q +$G(CANSEL)
"RTN","TIULA3",97,0)
 ;
"RTN","TIULA3",98,0)
SCRDFCS(USER,Y) ; Screen Default Cosigner selection for USER
"RTN","TIULA3",99,0)
 N TIUY S TIUY=1
"RTN","TIULA3",100,0)
 S USER=$G(USER,DUZ)
"RTN","TIULA3",101,0)
 ; A user may NOT select himself
"RTN","TIULA3",102,0)
 I Y=USER S TIUY=0 G SCRDFX
"RTN","TIULA3",103,0)
 ; A TERMINATED User may NOT be selected
"RTN","TIULA3",104,0)
 I +$$ACTIVE^XUSER(+Y)'>0 S TIUY=0 G SCREENX
"RTN","TIULA3",105,0)
 ; A non-PROVIDER may NOT be selected
"RTN","TIULA3",106,0)
 I +$$PROVIDER^TIUPXAP1(+Y,DT)'>0 S TIUY=0 G SCREENX
"RTN","TIULA3",107,0)
SCRDFX Q TIUY
"RTN","TIULX")
0^1^B45161741^B41667839
"RTN","TIULX",1,0)
TIULX ; SLC/JER - Cross-reference library functions ;6/21/06
"RTN","TIULX",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**1,28,79,100,136,219**;Jun 20, 1997;Build 11
"RTN","TIULX",3,0)
 ; File 200 - IA 10060
"RTN","TIULX",4,0)
 ; ^ORD(101 - IA 872
"RTN","TIULX",5,0)
 ; ^DISV    - IA 510
"RTN","TIULX",6,0)
ALOCP(DA) ; Should record be included in daily print queue by location?
"RTN","TIULX",7,0)
 ; Receives DA = record # in 8925
"RTN","TIULX",8,0)
 Q +$$ISPN(+$G(^TIU(8925,+DA,0)))
"RTN","TIULX",9,0)
APTP(DA) ; Should record be included in daily print queue by patient?
"RTN","TIULX",10,0)
 ; Receives DA = record # in 8925
"RTN","TIULX",11,0)
 Q +$$ISPN(+$G(^TIU(8925,+DA,0)))
"RTN","TIULX",12,0)
AAUP(DA) ; Should record be included in daily print queue by author?
"RTN","TIULX",13,0)
 ; Receives DA = record # in 8925
"RTN","TIULX",14,0)
 Q +$$ISPN(+$G(^TIU(8925,+DA,0)))
"RTN","TIULX",15,0)
BELONGS(TIUDA,CLASS) ; Evaluate whether a given document belongs to a
"RTN","TIULX",16,0)
 ;                 particular document class
"RTN","TIULX",17,0)
 N TIUY
"RTN","TIULX",18,0)
 I +$$ISADDNDM^TIULC1(TIUDA) S TIUDA=+$P($G(^TIU(8925,+TIUDA,0)),U,6)
"RTN","TIULX",19,0)
 S TIUY=+$$ISA(+$G(^TIU(8925,+TIUDA,0)),CLASS)
"RTN","TIULX",20,0)
 Q TIUY
"RTN","TIULX",21,0)
ISA(DA,CLASS) ; Evaluate whether a given document type is a member of a
"RTN","TIULX",22,0)
 ;         particular document class
"RTN","TIULX",23,0)
 ; Receives DA = record # in 8925.1, and
"RTN","TIULX",24,0)
 ;       CLASS = record # of class in 8925.1
"RTN","TIULX",25,0)
 N TIUI,TIUY S (TIUI,TIUY)=0
"RTN","TIULX",26,0)
 F  S TIUI=$O(^TIU(8925.1,"AD",DA,TIUI)) Q:+TIUI'>0!(TIUY=1)  D
"RTN","TIULX",27,0)
 . I TIUI=CLASS S TIUY=1 Q
"RTN","TIULX",28,0)
 . S TIUY=$$ISA(TIUI,CLASS)
"RTN","TIULX",29,0)
 Q TIUY
"RTN","TIULX",30,0)
ISPN(DA) ; Evaluate whether a given document is a Progress Note
"RTN","TIULX",31,0)
 ; Receives DA = record # in 8925.1
"RTN","TIULX",32,0)
 N TIUI,TIUY S (TIUI,TIUY)=0
"RTN","TIULX",33,0)
 F  S TIUI=$O(^TIU(8925.1,"AD",DA,TIUI)) Q:+TIUI'>0!(TIUY=1)  D
"RTN","TIULX",34,0)
 . I TIUI=3 S TIUY=1 Q
"RTN","TIULX",35,0)
 . S TIUY=$$ISPN(TIUI)
"RTN","TIULX",36,0)
 Q TIUY
"RTN","TIULX",37,0)
ISCWAD(DA) ; Evaluate whether a given title is a CWAD
"RTN","TIULX",38,0)
 ;Is the given title in a CWAD document class?
"RTN","TIULX",39,0)
 ;New for ID notes
"RTN","TIULX",40,0)
 ; Receives DA = record # in 8925.1
"RTN","TIULX",41,0)
 Q $S($$ISA(DA,25):1,$$ISA(DA,27):1,$$ISA(DA,30):1,$$ISA(DA,31):1,1:0)
"RTN","TIULX",42,0)
ISDS(DA) ; Evaluate whether a given document is a Discharge Summary
"RTN","TIULX",43,0)
 ; Receives DA = record # in 8925.1
"RTN","TIULX",44,0)
 N TIUI,TIUY S (TIUI,TIUY)=0
"RTN","TIULX",45,0)
 F  S TIUI=$O(^TIU(8925.1,"AD",DA,TIUI)) Q:+TIUI'>0!(TIUY=1)  D
"RTN","TIULX",46,0)
 . I TIUI=244 S TIUY=1 Q
"RTN","TIULX",47,0)
 . S TIUY=$$ISDS(TIUI)
"RTN","TIULX",48,0)
 Q TIUY
"RTN","TIULX",49,0)
TRNSFRM(RTYPE,FLD,X) ; Executes Transform code for a given header field
"RTN","TIULX",50,0)
 N XFORM
"RTN","TIULX",51,0)
 S FLD=$O(^TIU(8925.1,+RTYPE("TYPE"),"HEAD","D",+FLD,0))
"RTN","TIULX",52,0)
 I +FLD'>0 G TRNSFRMX
"RTN","TIULX",53,0)
 S XFORM=$G(^TIU(8925.1,+RTYPE("TYPE"),"HEAD",+FLD,1))
"RTN","TIULX",54,0)
 I XFORM']"" G TRNSFRMX
"RTN","TIULX",55,0)
 X XFORM
"RTN","TIULX",56,0)
TRNSFRMX Q X
"RTN","TIULX",57,0)
MENUS ; Evaluate/enforce user's menu display preference
"RTN","TIULX",58,0)
 N TIUI,TIUPREF S TIUPREF=$$PERSPRF^TIULE(DUZ),TIUI=0
"RTN","TIULX",59,0)
 F  S TIUI=$O(^DISV(DUZ,"VALMMENU",TIUI)) Q:+TIUI'>0  D
"RTN","TIULX",60,0)
 . I $P($G(^ORD(101,+TIUI,0)),U)["TIU" S ^DISV(DUZ,"VALMMENU",TIUI)=$S($P(TIUPREF,U,5)=0:0,1:1)
"RTN","TIULX",61,0)
 Q
"RTN","TIULX",62,0)
XTRASIGN(TIUY,TIUDA) ; Get list of extra signers for a document
"RTN","TIULX",63,0)
 N TIUI,TIUJ,TIUL,DA,DR,DIC,DIQ,TIUXTRA S (TIUI,TIUJ,TIUL)=0
"RTN","TIULX",64,0)
 S DIC="^TIU(8925.7,",DIQ="TIUXTRA"
"RTN","TIULX",65,0)
 F  S TIUI=$O(^TIU(8925.7,"B",TIUDA,TIUI)) Q:+TIUI'>0  D
"RTN","TIULX",66,0)
 . N TIUX,TIUSGNR
"RTN","TIULX",67,0)
 . S DA=TIUI,DR=".03;.04" D EN^DIQ1 Q:+$D(TIUXTRA)'>9
"RTN","TIULX",68,0)
 . I $L($G(TIUXTRA(8925.7,DA,.04))) Q
"RTN","TIULX",69,0)
 . S TIUJ=+$G(TIUJ)+1,TIUL=+$G(TIUL)+1
"RTN","TIULX",70,0)
 . S TIUSGNR=$G(TIUXTRA(8925.7,DA,.03))
"RTN","TIULX",71,0)
 . S TIUX=$$SETSTR^VALM1($G(TIUJ)_")  "_TIUSGNR,$G(TIUX),1,39)
"RTN","TIULX",72,0)
 . S TIUY(TIUL)=DA_U_TIUX
"RTN","TIULX",73,0)
 Q
"RTN","TIULX",74,0)
ASKSIGN(TIUY) ; Identify which Signature to edit
"RTN","TIULX",75,0)
 N I,L,Y
"RTN","TIULX",76,0)
 W !!,"Please Indicate Which Expected Signer to Change:",!
"RTN","TIULX",77,0)
 S (I,L,Y)=0 F  S I=$O(TIUY(I)) Q:+I'>0!+Y  D
"RTN","TIULX",78,0)
 . W:$P(TIUY(I),U)]"" !,$P(TIUY(I),U,2)
"RTN","TIULX",79,0)
 . I I#20=0 S Y=$P($$PICK(1,I,"Select Signer","NO"),U)
"RTN","TIULX",80,0)
 . S L=I
"RTN","TIULX",81,0)
 I L#20,'+Y S Y=$P($$PICK(1,L,"Select Signer","NO"),U)
"RTN","TIULX",82,0)
 I +Y,+$G(TIUY(+Y)) S Y=+$G(TIUY(+Y))
"RTN","TIULX",83,0)
 Q Y
"RTN","TIULX",84,0)
PICK(LOW,HIGH,PROMPT,TYPE) ; List selection
"RTN","TIULX",85,0)
 N X,Y S PROMPT=$G(PROMPT,"Select Item"),TYPE=$G(TYPE,"LO")
"RTN","TIULX",86,0)
 W !
"RTN","TIULX",87,0)
 S Y=$$READ^TIUU(TYPE_U_LOW_":"_HIGH,PROMPT)
"RTN","TIULX",88,0)
 W !
"RTN","TIULX",89,0)
 Q Y
"RTN","TIULX",90,0)
CWAD ; Entry action for CWAD protocol
"RTN","TIULX",91,0)
 N GMRPALG,GMRPCWAD,GMRPDFN,GMRPOPT,GMRPEN,GMRPAGE,GMRPCWAD,GMRPDOB
"RTN","TIULX",92,0)
 N GMRPLOC,GMRPRB,GMRPSSN,GMRPQT
"RTN","TIULX",93,0)
 I $G(TIUGLINK) W !,"Please finish attaching the interdisciplinay note before displaying alerts.",! H 3 Q
"RTN","TIULX",94,0)
 D FULL^VALM1
"RTN","TIULX",95,0)
 I '+$G(DFN),'+$G(ORVP) D  Q
"RTN","TIULX",96,0)
 . W !!,"No Patient Selected...",!
"RTN","TIULX",97,0)
 . I $$READ^TIUU("EA","Press RETURN to continue...") ; pause
"RTN","TIULX",98,0)
 . S VALMBCK="R"
"RTN","TIULX",99,0)
 D PAT^GMRPNOR1 I $D(GMRPQT) S VALMBCK="R" Q
"RTN","TIULX",100,0)
 S Y=GMRPDFN,GMRPOPT=1,GMRPEN=1 W !!,"** Current Patient:  "_$P(Y,U,2)
"RTN","TIULX",101,0)
 D ENPAT^GMRPNCW S VALMBCK="R"
"RTN","TIULX",102,0)
 Q
"RTN","TIULX",103,0)
IDSIGNRS(TIUY,TIUDA,TIULIST) ; Add list of Add'l Signers for a TIU Document
"RTN","TIULX",104,0)
 ; TIULIST(TIUI) [By Ref] = array of users to add/remove as signers
"RTN","TIULX",105,0)
 ; TIUDA                  = IEN in ^TIU(8925,
"RTN","TIULX",106,0)
 N TIUI S TIUI=0
"RTN","TIULX",107,0)
 F  S TIUI=$O(TIULIST(TIUI)) Q:+TIUI'>0  D
"RTN","TIULX",108,0)
 . N DA,DIC,DLAYGO,DIE,DR,X,Y
"RTN","TIULX",109,0)
 . ; if current user is already an additional signer, and current user
"RTN","TIULX",110,0)
 . ; is NOT being removed as an additional signer, then QUIT
"RTN","TIULX",111,0)
 . I +$O(^TIU(8925.7,"AE",TIUDA,+TIULIST(TIUI),0)),($P(TIULIST(TIUI),U,3)'="REMOVE") Q
"RTN","TIULX",112,0)
 . ; if current user is being removed as a cosigner, then remove him
"RTN","TIULX",113,0)
 . I $P(TIULIST(TIUI),U,3)="REMOVE" D REMSIGNR(TIUDA,+TIULIST(TIUI)) Q
"RTN","TIULX",114,0)
 . ; otherwise, add the current user as an additional signer
"RTN","TIULX",115,0)
 . S X=""""_"`"_TIUDA_"""",(DIC,DLAYGO)=8925.7,DIC(0)="LX" D ^DIC Q:+Y'>0
"RTN","TIULX",116,0)
 . S DIE=DIC,TIUY=$G(TIUY)_$S($G(TIUY)]"":U,1:"")_+TIULIST(TIUI)
"RTN","TIULX",117,0)
 . S DR=".02////"_0_";.03////"_+$G(TIULIST(TIUI))
"RTN","TIULX",118,0)
 . D ^DIE
"RTN","TIULX",119,0)
 . D SEND^TIUALRT(TIUDA)
"RTN","TIULX",120,0)
 Q
"RTN","TIULX",121,0)
REMSIGNR(TIUDA,TIUDUZ) ; Remove user from additional signer list
"RTN","TIULX",122,0)
 N DA,DIE,DR,DIDEL
"RTN","TIULX",123,0)
 S DA=+$O(^TIU(8925.7,"AE",TIUDA,TIUDUZ,0)) Q:+DA'>0
"RTN","TIULX",124,0)
 S (DIDEL,DIE)=8925.7,DR=".01///@" D ^DIE
"RTN","TIULX",125,0)
 D SEND^TIUALRT(TIUDA)
"RTN","TIULX",126,0)
 Q
"RTN","TIULX",127,0)
GETSIGNR(TIUY,TIUDA) ; RPC to Get list of extra signers for a document
"RTN","TIULX",128,0)
 N TIUI,DA,DR,DIC,DIQ,TIUXTRA,TIUD12,TIUAU,TIUEC S (DA,TIUI)=0
"RTN","TIULX",129,0)
 S DIC="^TIU(8925.7,",DIQ="TIUXTRA"
"RTN","TIULX",130,0)
 F  S DA=$O(^TIU(8925.7,"B",TIUDA,DA)) Q:+DA'>0  D
"RTN","TIULX",131,0)
 . N TIUX,TIUSGNR
"RTN","TIULX",132,0)
 . S DR=".03;.04",DIQ(0)="IE" D EN^DIQ1 Q:+$D(TIUXTRA)'>9
"RTN","TIULX",133,0)
 . I +$G(TIUXTRA(8925.7,DA,.04,"I")) Q
"RTN","TIULX",134,0)
 . S TIUI=+$G(TIUI)+1
"RTN","TIULX",135,0)
 . S TIUY(TIUI)=$G(TIUXTRA(8925.7,DA,.03,"I"))_U_$G(TIUXTRA(8925.7,DA,.03,"E"))
"RTN","TIULX",136,0)
 S TIUD12=$G(^TIU(8925,TIUDA,12))
"RTN","TIULX",137,0)
 S TIUAU=$P(TIUD12,U,4),TIUEC=$P(TIUD12,U,8)
"RTN","TIULX",138,0)
 S TIUI=+$G(TIUI)+1,TIUY(TIUI)=TIUAU_U_$$PERSNAME^TIULC1(TIUAU)_U_"AUTHOR"
"RTN","TIULX",139,0)
 I +TIUEC'>0 Q
"RTN","TIULX",140,0)
 I '$$FIND1^DIC(200,"","","`"_+TIUEC) D CLEAN^DILF Q
"RTN","TIULX",141,0)
 S TIUI=+$G(TIUI)+1,TIUY(TIUI)=TIUEC_U_$$PERSNAME^TIULC1(TIUEC)_U_"EXPECTED COSIGNER"
"RTN","TIULX",142,0)
 Q
"RTN","TIULX",143,0)
HASDS(DFN,VSTR) ; Does an admission have a Discharge Summary?
"RTN","TIULX",144,0)
 N TITLE,TIUDA S (TIUDA,TITLE)=0
"RTN","TIULX",145,0)
 F  S TITLE=$O(^TIU(8925,"APTLD",DFN,TITLE)) Q:+TITLE'>0  D  Q:+TIUDA>0
"RTN","TIULX",146,0)
 . N STATUS,CONTEXT S TIUDA=0
"RTN","TIULX",147,0)
 . I '+$$ISDS(TITLE) S TIUDA=0_U_0 Q
"RTN","TIULX",148,0)
 . F  S TIUDA=$O(^TIU(8925,"APTLD",DFN,TITLE,VSTR,+TIUDA)) Q:+TIUDA'>0  D  Q:+$P(TIUDA,U,2)
"RTN","TIULX",149,0)
 . . S STATUS=+$P($G(^TIU(8925,+TIUDA,0)),U,5)
"RTN","TIULX",150,0)
 . . S CONTEXT=$S(STATUS=0:0,STATUS>13:0,STATUS'>5:2,1:1)
"RTN","TIULX",151,0)
 . . S TIUDA=TIUDA_U_CONTEXT
"RTN","TIULX",152,0)
 I '+TIUDA,($L(TIUDA,U)<2) S TIUDA=TIUDA_U_0
"RTN","TIULX",153,0)
 Q TIUDA
"RTN","TIULX",154,0)
NEEDSIG(TIUY,USER,CLASS)        ; Get list of documents for which USER is an additional signer
"RTN","TIULX",155,0)
 N TIUDA,TIUI,TIUJ S (TIUDA,TIUJ)=0
"RTN","TIULX",156,0)
 S USER=$G(USER,DUZ),CLASS=$G(CLASS,38),TIUY=$NA(^TMP("TIUSIGN",$J))
"RTN","TIULX",157,0)
 K @TIUY ; Clear out return array before query
"RTN","TIULX",158,0)
 F  S TIUDA=$O(^TIU(8925.7,"AES",USER,TIUDA)) Q:+TIUDA'>0  D
"RTN","TIULX",159,0)
 . S TIUI=0 F  S TIUI=$O(^TIU(8925.7,"AES",USER,TIUDA,TIUI)) Q:+TIUI'>0  D
"RTN","TIULX",160,0)
 . . N TIUD0 S TIUD0=$G(^TIU(8925.7,TIUI,0)) Q:+$P(TIUD0,U,4)
"RTN","TIULX",161,0)
 . . Q:'+$$ISA(+$G(^TIU(8925,TIUDA,0)),CLASS)
"RTN","TIULX",162,0)
 . . S TIUJ=+$G(TIUJ)+1,@TIUY@(TIUJ)=TIUDA
"RTN","TIULX",163,0)
 Q
"RTN","TIULX",164,0)
TITLIENS ; Get IENs of DDEF entries that have type Title
"RTN","TIULX",165,0)
 ; in Document Definition file 8925.1
"RTN","TIULX",166,0)
 ;Creates array ^TMP("TIUTLS,$J,TLIEN)=  
"RTN","TIULX",167,0)
 ;Caller must kill ^TMP("TIUTLS",$J) when finished with the global.
"RTN","TIULX",168,0)
 N TIUIDX S TIUIDX=0 K ^TMP("TIUTLS",$J)
"RTN","TIULX",169,0)
 F  S TIUIDX=$O(^TIU(8925.1,"AT","DOC",TIUIDX)) Q:TIUIDX'>0  D
"RTN","TIULX",170,0)
 . S ^TMP("TIUTLS",$J,TIUIDX)=""
"RTN","TIULX",171,0)
 Q
"RTN","TIULX",172,0)
HASDOCMT(DFN) ;Does patient have ANY entries in TIU DOCUMENT file 8925?
"RTN","TIULX",173,0)
 ;Any entries includes original documents, addenda, components
"RTN","TIULX",174,0)
 ;(like S in SOAP notes), "deleted"  documents, retracted documents, etc!
"RTN","TIULX",175,0)
 Q $O(^TIU(8925,"C",+$G(DFN),0))>0
"RTN","TIULX",176,0)
         
"RTN","TIUPS219")
0^^B947121^n/a
"RTN","TIUPS219",1,0)
TIUPS219 ; SLC/JER - Post-Init Routine for TIU*1*219 ;9/12/07
"RTN","TIUPS219",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**219**;Jun 20, 1997;Build 11
"RTN","TIUPS219",3,0)
COMPILE ;Recompile DS Input Template
"RTN","TIUPS219",4,0)
 N TIUERR,Y,X,DMAX,MSGOK,MSGBAD,MSG
"RTN","TIUPS219",5,0)
 S MSGBAD="The DS Input Template could not be recompiled. Contact the Help Desk."
"RTN","TIUPS219",6,0)
 S Y=$$FIND1^DIC(.402,,"BX","TIU ENTER/EDIT DS",,,"TIUERR")
"RTN","TIUPS219",7,0)
 I Y'>0 S MSG=MSGBAD G COMPILEX
"RTN","TIUPS219",8,0)
 S X=$$GET1^DIQ(.402,Y_",",1815,,,"TIUERR") I $D(TIUERR) S MSG=MSGBAD G COMPILEX
"RTN","TIUPS219",9,0)
 S X=$P(X,U,2)
"RTN","TIUPS219",10,0)
 S DMAX=$$ROUSIZE^DILF
"RTN","TIUPS219",11,0)
 D EN^DIEZ
"RTN","TIUPS219",12,0)
COMPILEX ;
"RTN","TIUPS219",13,0)
 I $D(MSG) D BMES^XPDUTL(MSGBAD) Q
"RTN","TIUPS219",14,0)
 Q
"RTN","TIUPS219",15,0)
 ;
"RTN","TIUSRVP1")
0^2^B41331651^B37579653
"RTN","TIUSRVP1",1,0)
TIUSRVP1 ; SLC/JER - More API's in support of PUT ;8/14/07
"RTN","TIUSRVP1",2,0)
 ;;1.0;TEXT INTEGRATION UTILITIES;**19,59,89,100,109,167,113,112,219**;Jun 20, 1997;Build 11
"RTN","TIUSRVP1",3,0)
SITEPARM(TIUY) ; Get site parameters for GUI
"RTN","TIUSRVP1",4,0)
 N TIUPRM0,TIUPRM1
"RTN","TIUSRVP1",5,0)
 D SETPARM^TIULE
"RTN","TIUSRVP1",6,0)
 S TIUY=TIUPRM0
"RTN","TIUSRVP1",7,0)
 Q
"RTN","TIUSRVP1",8,0)
DEFDOC(TIUY,HLOC,USER,TIUDT,TIUIEN) ; Get default primary provider
"RTN","TIUSRVP1",9,0)
 N TIUSPRM,TIUDDOC,TIUAUTH
"RTN","TIUSRVP1",10,0)
 D SITEPARM(.TIUSPRM)
"RTN","TIUSRVP1",11,0)
 S TIUDDOC=+$P(TIUSPRM,U,8)
"RTN","TIUSRVP1",12,0)
 S TIUAUTH=$S((+$G(USER)!('+$G(TIUIEN))):0,1:+$P($G(^TIU(8925,+$G(TIUIEN),12)),U,2))
"RTN","TIUSRVP1",13,0)
 S USER=$S(+$G(USER):+$G(USER),+$G(TIUAUTH):+$G(TIUAUTH),1:DUZ)
"RTN","TIUSRVP1",14,0)
 S TIUDT=$S(+$G(TIUDT):+$G(TIUDT),1:DT)
"RTN","TIUSRVP1",15,0)
 S TIUY=$S(TIUDDOC=1:$$DFLTDOC^TIUPXAPI(HLOC),TIUDDOC=2:$$CURDOC(USER),1:"0^")
"RTN","TIUSRVP1",16,0)
 Q
"RTN","TIUSRVP1",17,0)
CURDOC(USER,TIUDT) ; Is the current user a known Provider?
"RTN","TIUSRVP1",18,0)
 N TIUY,TIUPROV S TIUY="0^"
"RTN","TIUSRVP1",19,0)
 S USER=$S(+$G(USER):+$G(USER),1:DUZ)
"RTN","TIUSRVP1",20,0)
 S TIUDT=$S(+$G(TIUDT):+$G(TIUDT),1:DT)
"RTN","TIUSRVP1",21,0)
 S TIUPROV=$$PROVIDER^TIUPXAP1(USER,TIUDT)
"RTN","TIUSRVP1",22,0)
 I +TIUPROV S TIUY=USER_U_$$PERSNAME^TIULC1(USER)
"RTN","TIUSRVP1",23,0)
 Q TIUY
"RTN","TIUSRVP1",24,0)
ISAPROV(TIUY,USER,DATE) ; Is user a provider?
"RTN","TIUSRVP1",25,0)
 ; Checks USR CLASS PROVIDER AND 200 Person Class
"RTN","TIUSRVP1",26,0)
 ; DATE must not include time (for ISA^USRLM)
"RTN","TIUSRVP1",27,0)
 S USER=$G(USER,DUZ)
"RTN","TIUSRVP1",28,0)
 S DATE=$G(DATE,DT)
"RTN","TIUSRVP1",29,0)
 S TIUY=$$PROVIDER^TIUPXAP1(USER,DATE)
"RTN","TIUSRVP1",30,0)
 Q
"RTN","TIUSRVP1",31,0)
USRPROV(TIUY,USER,DATE) ; Is USER a USR CLASS provider?
"RTN","TIUSRVP1",32,0)
 ; Checks USR CLASS PROVIDER only
"RTN","TIUSRVP1",33,0)
 ; DATE must not include time
"RTN","TIUSRVP1",34,0)
 N TIUERR
"RTN","TIUSRVP1",35,0)
 S USER=$G(USER,DUZ)
"RTN","TIUSRVP1",36,0)
 S DATE=$G(DATE,DT),TIUY=0
"RTN","TIUSRVP1",37,0)
 I +$$ISA^USRLM(USER,"PROVIDER",.TIUERR,DATE) S TIUY=1 ;  DBIA/ICR 2324
"RTN","TIUSRVP1",38,0)
 Q
"RTN","TIUSRVP1",39,0)
DOCPARM(TIUY,TIUDA,TIUTYP) ; Get document parameters for GUI
"RTN","TIUSRVP1",40,0)
 I '+$G(TIUTYP),+$G(TIUDA) S TIUTYP=+$G(^TIU(8925,+TIUDA,0))
"RTN","TIUSRVP1",41,0)
 I '+$G(TIUTYP) S TIUY(0)="" Q
"RTN","TIUSRVP1",42,0)
 D DOCPRM^TIULC1(TIUTYP,.TIUY,$G(TIUDA))
"RTN","TIUSRVP1",43,0)
 I '$D(TIUY) S TIUY(0)=""
"RTN","TIUSRVP1",44,0)
 Q
"RTN","TIUSRVP1",45,0)
CONSTUB(TIUDA,GMRCVP,DFN) ; Create a stub for a Consult Report
"RTN","TIUSRVP1",46,0)
 N DIE,DR,DA
"RTN","TIUSRVP1",47,0)
 D STUB(.TIUDA,"CONSULT REPORT",DFN)
"RTN","TIUSRVP1",48,0)
 I +TIUDA'>0 Q
"RTN","TIUSRVP1",49,0)
 S DIE=8925,DA=+TIUDA,DR="1405////^S X=GMRCVP"
"RTN","TIUSRVP1",50,0)
 D ^DIE
"RTN","TIUSRVP1",51,0)
 Q
"RTN","TIUSRVP1",52,0)
STUB(TIUDA,TIUTITL,DFN) ; Create a stub
"RTN","TIUSRVP1",53,0)
 N TIUVSIT,TIUFPRIV,DIC,DIE,DR,DA,DLAYGO,X,Y S TIUFPRIV=1
"RTN","TIUSRVP1",54,0)
 I +$G(TIUTITL)'>0 S TIUTITL=$$WHATITLE^TIUPUTU(TIUTITL)
"RTN","TIUSRVP1",55,0)
 I +TIUTITL'>0 S TIUDA=-1 Q
"RTN","TIUSRVP1",56,0)
 S (DIC,DLAYGO)=8925,DIC(0)="LF"
"RTN","TIUSRVP1",57,0)
 S X=""""_"`"_+TIUTITL_""""
"RTN","TIUSRVP1",58,0)
 D ^DIC S TIUDA=+Y Q:+Y'>0
"RTN","TIUSRVP1",59,0)
 D EVENT(.TIU,DFN) I $L($G(TIU("VSTR")))'>0 S TIUDA=-1 Q
"RTN","TIUSRVP1",60,0)
 S DIE=DIC,DA=TIUDA
"RTN","TIUSRVP1",61,0)
 S DR=".02////"_+DFN_";.03////"_$P($G(TIU("VISIT")),U)_";.04////"_+$$DOCCLASS^TIULC1(TIUTITL)_";.05///UNDICTATED;.13////E;1301////"_+$$NOW^XLFDT
"RTN","TIUSRVP1",62,0)
 D ^DIE
"RTN","TIUSRVP1",63,0)
 Q
"RTN","TIUSRVP1",64,0)
EVENT(TIUY,DFN) ; Create an Event-type Visit Entry
"RTN","TIUSRVP1",65,0)
 N VDT,VSTR,DGPM
"RTN","TIUSRVP1",66,0)
 S DGPM=$G(^DPT(DFN,.105)) ;DBIA/ICR 10035
"RTN","TIUSRVP1",67,0)
 I +DGPM'>0 D
"RTN","TIUSRVP1",68,0)
 . S VDT=$$NOW^XLFDT
"RTN","TIUSRVP1",69,0)
 . S VSTR=";"_VDT_";"_"E"
"RTN","TIUSRVP1",70,0)
 D PATVADPT^TIULV(.TIUY,+DFN,DGPM,$G(VSTR))
"RTN","TIUSRVP1",71,0)
 I $G(TIUY("LOC"))="",+DUZ D
"RTN","TIUSRVP1",72,0)
 .N TIUPREF,IDX
"RTN","TIUSRVP1",73,0)
 .S TIUPREF=$$PERSPRF^TIULE(DUZ)
"RTN","TIUSRVP1",74,0)
 .S IDX=+$P(TIUPREF,U,2)
"RTN","TIUSRVP1",75,0)
 .I IDX S TIUY("LOC")=IDX_U_$P($G(^SC(IDX,0)),U,1) ; DBIA/ICR 10040
"RTN","TIUSRVP1",76,0)
 Q
"RTN","TIUSRVP1",77,0)
GETPNAME(TIUY,TIUTYPE)  ; Get Print Name of a Document
"RTN","TIUSRVP1",78,0)
 S TIUY=$$PNAME^TIULC1(TIUTYPE)
"RTN","TIUSRVP1",79,0)
 Q
"RTN","TIUSRVP1",80,0)
SAVED(TIUY,TIUDA) ; Was the document committed to the database?
"RTN","TIUSRVP1",81,0)
 N TIUD12,TIUD13,TIUEBY,TIUAUT,TIUECS S TIUY=1
"RTN","TIUSRVP1",82,0)
 S TIUD12=$G(^TIU(8925,TIUDA,12)),TIUD13=$G(^(13))
"RTN","TIUSRVP1",83,0)
 S TIUEBY=$P(TIUD13,U,2),TIUAUT=$P(TIUD12,U,2),TIUECS=$P(TIUD12,U,8)
"RTN","TIUSRVP1",84,0)
 I $D(^TIU(8925,"ASAVE",+DUZ,TIUDA)) D  Q
"RTN","TIUSRVP1",85,0)
 . S TIUY="0^You appear to have been disconnected..."
"RTN","TIUSRVP1",86,0)
 I DUZ'=TIUEBY,(TIUEBY'=TIUAUT),$D(^TIU(8925,"ASAVE",+TIUEBY,TIUDA)) D  Q
"RTN","TIUSRVP1",87,0)
 . S TIUY="0^The transcriber appears to have been disconnected..."
"RTN","TIUSRVP1",88,0)
 I DUZ'=TIUAUT,$D(^TIU(8925,"ASAVE",+TIUAUT,TIUDA)) D  Q
"RTN","TIUSRVP1",89,0)
 . S TIUY="0^The author appears to have been disconnected..."
"RTN","TIUSRVP1",90,0)
 I DUZ'=TIUECS,$D(^TIU(8925,"ASAVE",+TIUECS,TIUDA)) D  Q
"RTN","TIUSRVP1",91,0)
 . S TIUY="0^The expected cosigner appears to have been disconnected..."
"RTN","TIUSRVP1",92,0)
 Q
"RTN","TIUSRVP1",93,0)
STUFREC(TIUDA,TIUREC,DFN,PARENT,TITLE,TIU) ; load TIUREC for create
"RTN","TIUSRVP1",94,0)
 N TIUREQCS,TIUSCAT,TIUSTAT,TIUCPF
"RTN","TIUSRVP1",95,0)
 ;Set a flag to indicate whether or not a Title is a member of the
"RTN","TIUSRVP1",96,0)
 ;Clinical Procedures Class (1=Yes and 0=No)
"RTN","TIUSRVP1",97,0)
 S TIUCPF=+$$ISA^TIULX(TITLE,+$$CLASS^TIUCP)
"RTN","TIUSRVP1",98,0)
 S TIUSTAT=$$STATUS(TIUDA,+$G(SUPPRESS),$G(TITLE))
"RTN","TIUSRVP1",99,0)
 D REQCOS^TIUSRVA(.TIUREQCS,+TITLE,"",$S(+$G(TIUREC(1202)):+$G(TIUREC(1202)),1:DUZ))
"RTN","TIUSRVP1",100,0)
 I +$G(PARENT)'>0 D
"RTN","TIUSRVP1",101,0)
 . S TIUREC(.02)=$G(DFN),TIUREC(.03)=$P($G(TIU("VISIT")),U)
"RTN","TIUSRVP1",102,0)
 . S TIUREC(.05)=$S(+$G(TIUREC(.05)):+$G(TIUREC(.05)),+TIUSTAT:TIUSTAT,1:5)
"RTN","TIUSRVP1",103,0)
 . S TIUREC(.07)=$P($G(TIU("EDT")),U),TIUREC(.08)=$P($G(TIU("LDT")),U)
"RTN","TIUSRVP1",104,0)
 . S TIUREC(1401)=$P($G(TIU("AD#")),U)
"RTN","TIUSRVP1",105,0)
 . S TIUREC(1402)=$P($G(TIU("TS")),U)
"RTN","TIUSRVP1",106,0)
 . S TIUREC(1404)=$P($G(TIU("SVC")),U)
"RTN","TIUSRVP1",107,0)
 I +$G(PARENT)>0 D
"RTN","TIUSRVP1",108,0)
 . S TIUREC(.02)=+$P($G(^TIU(8925,+PARENT,0)),U,2)
"RTN","TIUSRVP1",109,0)
 . S TIUREC(.03)=+$P($G(^TIU(8925,+PARENT,0)),U,3)
"RTN","TIUSRVP1",110,0)
 . S TIUREC(.05)=$S(+$G(TIUREC(.05)):+$G(TIUREC(.05)),+TIUSTAT:TIUSTAT,1:5)
"RTN","TIUSRVP1",111,0)
 . S TIUREC(.06)=PARENT,TIUREC(.07)=$P(TIU("EDT"),U)
"RTN","TIUSRVP1",112,0)
 . S TIUREC(.08)=$P(TIU("LDT"),U)
"RTN","TIUSRVP1",113,0)
 . S TIUREC(1401)=$P($G(^TIU(8925,+PARENT,14)),U)
"RTN","TIUSRVP1",114,0)
 . S TIUREC(1402)=$P($G(^TIU(8925,+PARENT,14)),U,2)
"RTN","TIUSRVP1",115,0)
 . S TIUREC(1404)=$P($G(^TIU(8925,+PARENT,14)),U,4)
"RTN","TIUSRVP1",116,0)
 . S TIUREC(1405)=$P($G(^TIU(8925,+PARENT,14)),U,5)
"RTN","TIUSRVP1",117,0)
 S TIUREC(.04)=$$DOCCLASS^TIULC1(TITLE)
"RTN","TIUSRVP1",118,0)
 S TIUSCAT=$S(+$L($P($G(TIU("CAT")),U)):$P($G(TIU("CAT")),U),+$L($P($G(TIU("VSTR")),";",3)):$P($G(TIU("VSTR")),";",3),1:"")
"RTN","TIUSRVP1",119,0)
 S TIUREC(.13)=TIUSCAT
"RTN","TIUSRVP1",120,0)
 ;If the document is a member of the Clinical Procedures Class, set the
"RTN","TIUSRVP1",121,0)
 ;Author/Dictator and the Expected Signer fields to Null
"RTN","TIUSRVP1",122,0)
 S (TIUREC(1202),TIUREC(1204))=$S(+$G(TIUREC(1202)):+$G(TIUREC(1202)),TIUCPF:"",1:+$G(DUZ))
"RTN","TIUSRVP1",123,0)
 S TIUREC(1212)=$P($G(TIU("INST")),U)
"RTN","TIUSRVP1",124,0)
 S TIUREC(1205)=$P($G(TIU("LOC")),U)
"RTN","TIUSRVP1",125,0)
 S TIUREC(1211)=$P($G(TIU("VLOC")),U)
"RTN","TIUSRVP1",126,0)
 S TIUREC(1201)=$$NOW^XLFDT
"RTN","TIUSRVP1",127,0)
 S TIUREC(1301)=$S($G(TIUREC(1301))]"":$P(TIUREC(1301),U),1:$$NOW^XLFDT)
"RTN","TIUSRVP1",128,0)
 I +$$ISDS^TIULX(TITLE) D
"RTN","TIUSRVP1",129,0)
 . I +$G(TIU("LDT"))'>0 S TIUREC(.12)=1
"RTN","TIUSRVP1",130,0)
 . S TIUREC(.13)="H"
"RTN","TIUSRVP1",131,0)
 . D REFDT(.TIUREC)
"RTN","TIUSRVP1",132,0)
 ;If the document is a member of the Clinical Procedures Class, set the
"RTN","TIUSRVP1",133,0)
 ;Entered By field to Null
"RTN","TIUSRVP1",134,0)
 S TIUREC(1303)="R",TIUREC(1302)=$S(TIUCPF:"",1:$G(DUZ))
"RTN","TIUSRVP1",135,0)
 I $S(+$G(TIUREC(1208))&(+$G(TIUREC(1204))'=+$G(TIUREC(1208))):1,+$G(TIUREQCS):1,1:0) S TIUREC(1506)=1
"RTN","TIUSRVP1",136,0)
 Q
"RTN","TIUSRVP1",137,0)
REFDT(TIUX) ; Hack Ref Date/time for DS's
"RTN","TIUSRVP1",138,0)
 S TIUX(1301)=$S(+$G(TIU("LDT")):+$G(TIU("LDT")),1:$G(TIUX(1301)))
"RTN","TIUSRVP1",139,0)
 Q
"RTN","TIUSRVP1",140,0)
STATUS(TIUDA,SUPPRESS,TITLE)  ; Compute the status of the current record
"RTN","TIUSRVP1",141,0)
 N TIUDPRM,TIUY
"RTN","TIUSRVP1",142,0)
 ; If the document is an addendum, compute status based on processing
"RTN","TIUSRVP1",143,0)
 ; requirements of the Parent document or its ancestors
"RTN","TIUSRVP1",144,0)
 I +$$ISADDNDM^TIULC1(TIUDA) D
"RTN","TIUSRVP1",145,0)
 . S TIUDA=$S(+$P(^TIU(8925,TIUDA,0),U,6):$P(^(0),U,6),1:TIUDA)
"RTN","TIUSRVP1",146,0)
 . S TITLE=+$G(^TIU(8925,TIUDA,0))
"RTN","TIUSRVP1",147,0)
 D DOCPRM^TIULC1(TITLE,.TIUDPRM,$G(TIUDA))
"RTN","TIUSRVP1",148,0)
 I +$P(TIUDPRM(0),U,2),+$G(SUPPRESS) S TIUY=3 G STATUX
"RTN","TIUSRVP1",149,0)
 S TIUY=$S(+$$REQVER^TIULC(+TIUDA,+$P($G(TIUDPRM(0)),U,3)):4,1:5)
"RTN","TIUSRVP1",150,0)
STATUX Q TIUY
"RTN","TIUSRVP1",151,0)
IDATTCH(TIUY,TIUDA,TIUDAD) ; Attach TIUDA as ID Child entry to TIUDAD
"RTN","TIUSRVP1",152,0)
 N TIUX
"RTN","TIUSRVP1",153,0)
 S TIUX(2101)=TIUDAD
"RTN","TIUSRVP1",154,0)
 D FILE^TIUSRVP(.TIUY,TIUDA,.TIUX,1)
"RTN","TIUSRVP1",155,0)
 D AUDLINK^TIUGR1(TIUDA,"a",TIUDAD)
"RTN","TIUSRVP1",156,0)
 D SENDID^TIUALRT1(TIUDA)
"RTN","TIUSRVP1",157,0)
 Q
"RTN","TIUSRVP1",158,0)
IDDTCH(TIUY,TIUDA) ; Detach TIUDA from its ID Parent
"RTN","TIUSRVP1",159,0)
 N TIUX,IDDAD
"RTN","TIUSRVP1",160,0)
 I '+$G(^TIU(8925,TIUDA,21)) D  Q
"RTN","TIUSRVP1",161,0)
 . S TIUY="0^Record #"_TIUDA_" is NOT an ID Entry."
"RTN","TIUSRVP1",162,0)
 S IDDAD=+$G(^TIU(8925,TIUDA,21))
"RTN","TIUSRVP1",163,0)
 S TIUX(2101)="@"
"RTN","TIUSRVP1",164,0)
 D FILE^TIUSRVP(.TIUY,TIUDA,.TIUX,1)
"RTN","TIUSRVP1",165,0)
 D AUDLINK^TIUGR1(TIUDA,"d",IDDAD)
"RTN","TIUSRVP1",166,0)
 D IDDEL^TIUALRT1(TIUDA)
"RTN","TIUSRVP1",167,0)
 Q
"RTN","TIUSRVP1",168,0)
CANDEL(TIUDA) ; Boolean function to evaluate delete request
"RTN","TIUSRVP1",169,0)
 Q $S($P(^TIU(8925,TIUDA,0),U,5)>3:0,'+$$EMPTYDOC^TIULF(TIUDA):0,1:1)
"UP",8925.95,8925.955,-1)
8925.95^5
"UP",8925.95,8925.955,0)
8925.955
"VER")
8.0^22.0
"^DD",8925,8925,1209,0)
ATTENDING PHYSICIAN^*P200'X^VA(200,^12;9^S DIC("S")="I +$G(DA),+$$SCRATT^TIULA3(+DA,+Y)" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",8925,8925,1209,1,0)
^.1^^0
"^DD",8925,8925,1209,3)
Enter the name of the Attending Physician.
"^DD",8925,8925,1209,12)
Discharge Summary Attendings may not be terminated, must be in USR Class PROVIDER, and may not require cosignature.  Other Attendings must be active providers.
"^DD",8925,8925,1209,12.1)
S DIC("S")="I +$G(DA),+$$SCRATT^TIULA3(+DA,+Y)"
"^DD",8925,8925,1209,"DT")
3070907
"^DD",8925,8925,1301,0)
REFERENCE DATE^D^^13;1^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",8925,8925,1301,.1)
DATE/TIME OF NOTE
"^DD",8925,8925,1301,1,0)
^.1
"^DD",8925,8925,1301,1,1,0)
8925^AAU1^MUMPS
"^DD",8925,8925,1301,1,1,1)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,12)),U,2),+$P($G(^TIU(8925,+DA,0)),U,5) S ^TIU(8925,"AAU",+$P(^TIU(8925,+DA,12),U,2),+$P(^TIU(8925,+DA,0),U),+$P(^TIU(8925,+DA,0),U,5),(9999999-X),+DA)=""
"^DD",8925,8925,1301,1,1,2)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,12)),U,2),+$P($G(^TIU(8925,+DA,0)),U,5) K ^TIU(8925,"AAU",+$P(^TIU(8925,+DA,12),U,2),+$P(^TIU(8925,+DA,0),U),+$P(^TIU(8925,+DA,0),U,5),(9999999-X),+DA)
"^DD",8925,8925,1301,1,1,"%D",0)
^^2^2^2940722^^^
"^DD",8925,8925,1301,1,1,"%D",1,0)
This MUMPS-type, multi-field cross-reference is used for look-ups by
"^DD",8925,8925,1301,1,1,"%D",2,0)
author, document type, status, and date range.
"^DD",8925,8925,1301,1,1,"DT")
2940322
"^DD",8925,8925,1301,1,2,0)
8925^ASUP1^MUMPS
"^DD",8925,8925,1301,1,2,1)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,12)),U,8),+$P($G(^TIU(8925,+DA,0)),U,5) S ^TIU(8925,"ASUP",+$P(^TIU(8925,+DA,12),U,8),+$P(^TIU(8925,+DA,0),U),+$P(^TIU(8925,+DA,0),U,5),(9999999-X),+DA)=""
"^DD",8925,8925,1301,1,2,2)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,12)),U,8),+$P($G(^TIU(8925,+DA,0)),U,5) K ^TIU(8925,"ASUP",+$P(^TIU(8925,+DA,12),U,8),+$P(^TIU(8925,+DA,0),U),+$P(^TIU(8925,+DA,0),U,5),(9999999-X),+DA)
"^DD",8925,8925,1301,1,2,"%D",0)
^^3^3^2950125^^
"^DD",8925,8925,1301,1,2,"%D",1,0)
This MUMPS-type, multi-field cross-reference by EXPECTED COSIGNER),
"^DD",8925,8925,1301,1,2,"%D",2,0)
DOCUMENT TYPE, STATUS, and INVERSE ENTRY/DICTATION DATE/TIME will
"^DD",8925,8925,1301,1,2,"%D",3,0)
be used for look-ups and queries.
"^DD",8925,8925,1301,1,2,"DT")
2950125
"^DD",8925,8925,1301,1,3,0)
8925^APT1^MUMPS
"^DD",8925,8925,1301,1,3,1)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,0)),U,2),+$P($G(^TIU(8925,+DA,0)),U,5) S ^TIU(8925,"APT",+$P(^TIU(8925,+DA,0),U,2),+$P(^TIU(8925,+DA,0),U),+$P(^TIU(8925,+DA,0),U,5),(9999999-X),+DA)=""
"^DD",8925,8925,1301,1,3,2)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,0)),U,2),+$P($G(^TIU(8925,+DA,0)),U,5) K ^TIU(8925,"APT",+$P(^TIU(8925,+DA,0),U,2),+$P(^TIU(8925,+DA,0),U),+$P(^TIU(8925,+DA,0),U,5),(9999999-X),+DA)
"^DD",8925,8925,1301,1,3,"%D",0)
^^2^2^2950925^^^
"^DD",8925,8925,1301,1,3,"%D",1,0)
This MUMPS-type, multi-field cross-reference is used for look-ups by
"^DD",8925,8925,1301,1,3,"%D",2,0)
patient, document type, status, and date range.
"^DD",8925,8925,1301,1,3,"DT")
2940322
"^DD",8925,8925,1301,1,4,0)
8925^ATS1^MUMPS
"^DD",8925,8925,1301,1,4,1)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,14)),U,2),+$P($G(^TIU(8925,+DA,0)),U,5) S ^TIU(8925,"ATS",+$P(^TIU(8925,+DA,14),U,2),+$P(^TIU(8925,+DA,0),U),+$P(^TIU(8925,+DA,0),U,5),(9999999-X),+DA)=""
"^DD",8925,8925,1301,1,4,2)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,14)),U,2),+$P($G(^TIU(8925,+DA,0)),U,5) K ^TIU(8925,"ATS",+$P(^TIU(8925,+DA,14),U,2),+$P(^TIU(8925,+DA,0),U),+$P(^TIU(8925,+DA,0),U,5),(9999999-X),+DA)
"^DD",8925,8925,1301,1,4,"%D",0)
^^2^2^2941122^^
"^DD",8925,8925,1301,1,4,"%D",1,0)
This MUMPS-type, multi-field cross-reference is used for look-ups by
"^DD",8925,8925,1301,1,4,"%D",2,0)
Treating Specialty, document type, status, and date range.
"^DD",8925,8925,1301,1,4,"DT")
2940325
"^DD",8925,8925,1301,1,5,0)
8925^ATC1^MUMPS
"^DD",8925,8925,1301,1,5,1)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,13)),U,2),+$P($G(^TIU(8925,+DA,0)),U,5) S ^TIU(8925,"ATC",+$P(^TIU(8925,+DA,13),U,2),+$P(^TIU(8925,+DA,0),U),+$P(^TIU(8925,+DA,0),U,5),(9999999-X),+DA)=""
"^DD",8925,8925,1301,1,5,2)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,13)),U,2),+$P($G(^TIU(8925,+DA,0)),U,5) K ^TIU(8925,"ATC",+$P(^TIU(8925,+DA,13),U,2),+$P(^TIU(8925,+DA,0),U),+$P(^TIU(8925,+DA,0),U,5),(9999999-X),+DA)
"^DD",8925,8925,1301,1,5,"%D",0)
^^2^2^2940323^
"^DD",8925,8925,1301,1,5,"%D",1,0)
This MUMPS-type, multi-field cross-reference is used for look-ups by
"^DD",8925,8925,1301,1,5,"%D",2,0)
Entry person, document type, status, and date range.
"^DD",8925,8925,1301,1,5,"DT")
2940323
"^DD",8925,8925,1301,1,6,0)
8925^ALL1^MUMPS
"^DD",8925,8925,1301,1,6,1)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,0)),U,5) S ^TIU(8925,"ALL","ANY",+$P(^TIU(8925,+DA,0),U),+$P(^TIU(8925,+DA,0),U,5),(9999999-X),+DA)=""
"^DD",8925,8925,1301,1,6,2)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,0)),U,5) K ^TIU(8925,"ALL","ANY",+$P(^TIU(8925,+DA,0),U),+$P(^TIU(8925,+DA,0),U,5),(9999999-X),+DA)
"^DD",8925,8925,1301,1,6,"%D",0)
^^2^2^2940325^
"^DD",8925,8925,1301,1,6,"%D",1,0)
This MUMPS-type, multi-field cross-reference is used for look-ups by
"^DD",8925,8925,1301,1,6,"%D",2,0)
document type and date range.
"^DD",8925,8925,1301,1,6,"DT")
2940325
"^DD",8925,8925,1301,1,7,0)
8925^ASUB1^MUMPS
"^DD",8925,8925,1301,1,7,1)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,0)),U,5),$L($P($G(^TIU(8925,+DA,17)),U)) D ASUBS^TIUDD($P($G(^TIU(8925,+DA,17)),U),+$G(^TIU(8925,+DA,0)),+$P($G(^TIU(8925,+DA,0)),U,5),(9999999-+X),DA)
"^DD",8925,8925,1301,1,7,2)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,0)),U,5),$L($P($G(^TIU(8925,+DA,17)),U)) D ASUBK^TIUDD($P($G(^TIU(8925,+DA,17)),U),+$G(^TIU(8925,+DA,0)),+$P($G(^TIU(8925,+DA,0)),U,5),(9999999-+X),DA)
"^DD",8925,8925,1301,1,7,"%D",0)
^^2^2^2950928^^
"^DD",8925,8925,1301,1,7,"%D",1,0)
This MULTI-fields, MUMPS-type cross-reference is used for queries by
"^DD",8925,8925,1301,1,7,"%D",2,0)
subject.
"^DD",8925,8925,1301,1,7,"DT")
2950928
"^DD",8925,8925,1301,1,8,0)
8925^ASVC1^MUMPS
"^DD",8925,8925,1301,1,8,1)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,14)),U,4),+$P($G(^TIU(8925,+DA,0)),U,5) S ^TIU(8925,"ASVC",+$P(^TIU(8925,+DA,14),U,4),+$P(^TIU(8925,+DA,0),U),+$P(^TIU(8925,+DA,0),U,5),(9999999-X),+DA)=""
"^DD",8925,8925,1301,1,8,2)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,14)),U,4),+$P($G(^TIU(8925,+DA,0)),U,5) K ^TIU(8925,"ASVC",+$P(^TIU(8925,+DA,14),U,4),+$P(^TIU(8925,+DA,0),U),+$P(^TIU(8925,+DA,0),U,5),(9999999-X),+DA)
"^DD",8925,8925,1301,1,8,"%D",0)
^^2^2^2960710^^
"^DD",8925,8925,1301,1,8,"%D",1,0)
This MUMPS-type, multi-field cross-reference is used for look-ups SERVICE, 
"^DD",8925,8925,1301,1,8,"%D",2,0)
document type, status, and date 
"^DD",8925,8925,1301,1,8,"DT")
2941122
"^DD",8925,8925,1301,1,9,0)
8925^APRB1^MUMPS
"^DD",8925,8925,1301,1,9,1)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,0)),U,5),+$O(^TIU(8925.9,"B",+DA,0)) D APRBS^TIUDD(+$G(^TIU(8925,+DA,0)),+$P($G(^TIU(8925,+DA,0)),U,5),(9999999-+X),DA)
"^DD",8925,8925,1301,1,9,2)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,0)),U,5),+$O(^TIU(8925.9,"B",+DA,0)) D APRBK^TIUDD(+$G(^TIU(8925,+DA,0)),+$P($G(^TIU(8925,+DA,0)),U,5),(9999999-+X),DA)
"^DD",8925,8925,1301,1,9,"%D",0)
^^3^3^2950928^^
"^DD",8925,8925,1301,1,9,"%D",1,0)
This MUMPS-type, multi-field cross-reference by Problem, Document type,
"^DD",8925,8925,1301,1,9,"%D",2,0)
Status, and Inverse Reference Date/time is used to facilitate query by
"^DD",8925,8925,1301,1,9,"%D",3,0)
problem.
"^DD",8925,8925,1301,1,9,"DT")
2950928
"^DD",8925,8925,1301,1,10,0)
8925^AVSIT1^MUMPS
"^DD",8925,8925,1301,1,10,1)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,0)),U,3),+$P($G(^TIU(8925,+DA,0)),U,5) S ^TIU(8925,"AVSIT",+$P(^TIU(8925,+DA,0),U,3),+$P(^TIU(8925,+DA,0),U),+$P(^TIU(8925,+DA,0),U,5),(9999999-X),DA)=""
"^DD",8925,8925,1301,1,10,2)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,0)),U,3),+$P($G(^TIU(8925,+DA,0)),U,5) K ^TIU(8925,"AVSIT",+$P(^TIU(8925,+DA,0),U,3),+$P(^TIU(8925,+DA,0),U),+$P(^TIU(8925,+DA,0),U,5),(9999999-X),DA)
"^DD",8925,8925,1301,1,10,"%D",0)
^^2^2^2951207^^^^
"^DD",8925,8925,1301,1,10,"%D",1,0)
This MUMPS-type, multi-field cross-reference by VISIT, DOCUMENT TYPE,
"^DD",8925,8925,1301,1,10,"%D",2,0)
STATUS, and INVERSE ENTRY/DICTATION DATE facilitates look-ups by visit.
"^DD",8925,8925,1301,1,10,"DT")
2950925
"^DD",8925,8925,1301,1,11,0)
8925^ADCPT1^MUMPS
"^DD",8925,8925,1301,1,11,1)
I +$P($G(^TIU(8925,+DA,0)),U,4),+$P($G(^TIU(8925,+DA,0)),U,2),+$P($G(^TIU(8925,+DA,0)),U,5) S ^TIU(8925,"ADCPT",+$P(^TIU(8925,+DA,0),U,2),+$P(^TIU(8925,+DA,0),U,4),+$P(^TIU(8925,+DA,0),U,5),(9999999-X),DA)=""
"^DD",8925,8925,1301,1,11,2)
I +$P($G(^TIU(8925,+DA,0)),U,4),+$P($G(^TIU(8925,+DA,0)),U,2),+$P($G(^TIU(8925,+DA,0)),U,5) K ^TIU(8925,"ADCPT",+$P(^TIU(8925,+DA,0),U,2),+$P(^TIU(8925,+DA,0),U,4),+$P(^TIU(8925,+DA,0),U,5),(9999999-X),DA)
"^DD",8925,8925,1301,1,11,"%D",0)
^^3^3^2950925^
"^DD",8925,8925,1301,1,11,"%D",1,0)
This MUMPS-type, multi-field cross-reference by PATIENT, DOCUMENT CLASS,
"^DD",8925,8925,1301,1,11,"%D",2,0)
STATUS, and INVERSE REFERENCE DATE facilitates look-ups by PATIENT AND
"^DD",8925,8925,1301,1,11,"%D",3,0)
DOCUMENT CLASS (e.g., all SIGNED Violence Postings for patient John Doe).
"^DD",8925,8925,1301,1,11,"DT")
2950925
"^DD",8925,8925,1301,1,12,0)
8925^D
"^DD",8925,8925,1301,1,12,1)
S ^TIU(8925,"D",$E(X,1,30),DA)=""
"^DD",8925,8925,1301,1,12,2)
K ^TIU(8925,"D",$E(X,1,30),DA)
"^DD",8925,8925,1301,1,12,"%D",0)
^^2^2^2951215^
"^DD",8925,8925,1301,1,12,"%D",1,0)
This REGULAR FileMan Cross-reference by Reference Date/time is used
"^DD",8925,8925,1301,1,12,"%D",2,0)
for both look-ups and sorts.
"^DD",8925,8925,1301,1,12,"DT")
2951215
"^DD",8925,8925,1301,1,13,0)
8925^APTCL1^MUMPS
"^DD",8925,8925,1301,1,13,1)
I +$P(^TIU(8925,+DA,0),U),+$P($G(^TIU(8925,+DA,0)),U,2) S ^TIU(8925,"APTCL",+$P(^TIU(8925,+DA,0),U,2),+$$CLINDOC^TIULC1(+$P(^TIU(8925,+DA,0),U),+DA),(9999999-X),DA)=""
"^DD",8925,8925,1301,1,13,2)
I +$P(^TIU(8925,+DA,0),U),+$P($G(^TIU(8925,+DA,0)),U,2) K ^TIU(8925,"APTCL",+$P(^TIU(8925,+DA,0),U,2),+$$CLINDOC^TIULC1(+$P(^TIU(8925,+DA,0),U),+DA),(9999999-X),DA)
"^DD",8925,8925,1301,1,13,"%D",0)
^^2^2^2960823^^^^
"^DD",8925,8925,1301,1,13,"%D",1,0)
This MUMPS-type, multi-field cross-reference by PATIENT, CLINICAL DOCUMENT
"^DD",8925,8925,1301,1,13,"%D",2,0)
CLASS, and INVERSE REFERENCE DATE facilitates look-ups by patient.
"^DD",8925,8925,1301,1,13,"DT")
2960823
"^DD",8925,8925,1301,1,14,0)
8925^APTCL381^MUMPS
"^DD",8925,8925,1301,1,14,1)
I +$P(^TIU(8925,+DA,0),U),+$P($G(^TIU(8925,+DA,0)),U,2) S ^TIU(8925,"APTCL",+$P(^TIU(8925,+DA,0),U,2),38,(9999999-X),DA)=""
"^DD",8925,8925,1301,1,14,2)
I +$P(^TIU(8925,+DA,0),U),+$P($G(^TIU(8925,+DA,0)),U,2) K ^TIU(8925,"APTCL",+$P(^TIU(8925,+DA,0),U,2),38,(9999999-X),DA)
"^DD",8925,8925,1301,1,14,"%D",0)
^^2^2^2960506^
"^DD",8925,8925,1301,1,14,"%D",1,0)
This MUMPS-type, multi-field cross-reference by PATIENT, ROOT CLASS, and
"^DD",8925,8925,1301,1,14,"%D",2,0)
INVERSE REFERENCE DATE facilitates look-ups by patient.
"^DD",8925,8925,1301,1,14,"DT")
2960506
"^DD",8925,8925,1301,1,15,0)
8925^ALOC1^MUMPS
"^DD",8925,8925,1301,1,15,1)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,12)),U,5),+$P($G(^TIU(8925,+DA,0)),U,5) S ^TIU(8925,"ALOC",+$P(^TIU(8925,+DA,12),U,5),+$P(^TIU(8925,+DA,0),U),+$P(^TIU(8925,+DA,0),U,5),(9999999-X),+DA)=""
"^DD",8925,8925,1301,1,15,2)
I +$P($G(^TIU(8925,+DA,0)),U),+$P($G(^TIU(8925,+DA,12)),U,5),+$P($G(^TIU(8925,+DA,0)),U,5) K ^TIU(8925,"ALOC",+$P(^TIU(8925,+DA,12),U,5),+$P(^TIU(8925,+DA,0),U),+$P(^TIU(8925,+DA,0),U,5),(9999999-X),+DA)
"^DD",8925,8925,1301,1,15,"%D",0)
^^2^2^2960710^^^
"^DD",8925,8925,1301,1,15,"%D",1,0)
This MUMPS-type, multi-field cross-reference is used for look-ups
"^DD",8925,8925,1301,1,15,"%D",2,0)
LOCATION, document type, status, and date
"^DD",8925,8925,1301,1,15,"DT")
2960710
"^DD",8925,8925,1301,1,16,0)
8925^ACLPT03^MUMPS
"^DD",8925,8925,1301,1,16,1)
D SACLPT^TIUDD0(1301,X)
"^DD",8925,8925,1301,1,16,2)
D KACLPT^TIUDD01(1301,X)
"^DD",8925,8925,1301,1,16,"%D",0)
^^3^3^2970617^
"^DD",8925,8925,1301,1,16,"%D",1,0)
This multi-field, MUMPS-type cross-reference on CLASS, PATIENT, INVERSE
"^DD",8925,8925,1301,1,16,"%D",2,0)
REFERENCE DATE/TIME, and RECORD # is designed to support rapid queries by
"^DD",8925,8925,1301,1,16,"%D",3,0)
patient.
"^DD",8925,8925,1301,1,16,"DT")
2970617
"^DD",8925,8925,1301,1,17,0)
8925^ACLAU01^MUMPS
"^DD",8925,8925,1301,1,17,1)
D SACLAU^TIUDD0(1301,X),SACLAU1^TIUDD0(1301,X)
"^DD",8925,8925,1301,1,17,2)
D KACLAU^TIUDD01(1301,X),KACLAU1^TIUDD01(1301,X)
"^DD",8925,8925,1301,1,17,"%D",0)
^^4^4^2970617^
"^DD",8925,8925,1301,1,17,"%D",1,0)
This multi-field, MUMPS-type cross-reference on CLASS, AUTHOR (or ENTERED
"^DD",8925,8925,1301,1,17,"%D",2,0)
BY), PATIENT, INVERSE REFERENCE DATE/TIME, and RECORD # is designed to
"^DD",8925,8925,1301,1,17,"%D",3,0)
facilitate rapid access to the current users unsigned notes about a
"^DD",8925,8925,1301,1,17,"%D",4,0)
patient.
"^DD",8925,8925,1301,1,17,"DT")
2970617
"^DD",8925,8925,1301,1,18,0)
8925^ACLEC02^MUMPS
"^DD",8925,8925,1301,1,18,1)
D SACLEC^TIUDD0(1301,X)
"^DD",8925,8925,1301,1,18,2)
D KACLEC^TIUDD01(1301,X)
"^DD",8925,8925,1301,1,18,"%D",0)
^^3^3^2970617^
"^DD",8925,8925,1301,1,18,"%D",1,0)
This multi-field, MUMPS-type Cross-reference on CLASS, EXPECTED COSIGNER,
"^DD",8925,8925,1301,1,18,"%D",2,0)
PATIENT, INVERSE REFERENCE DATE/TIME, and RECORD # is useful for finding
"^DD",8925,8925,1301,1,18,"%D",3,0)
the uncosigned notes by the current user for a given patient.
"^DD",8925,8925,1301,1,18,"DT")
2970617
"^DD",8925,8925,1301,1,19,0)
8925^ACLSB02^MUMPS
"^DD",8925,8925,1301,1,19,1)
D SACLSB^TIUDD0(1301,X)
"^DD",8925,8925,1301,1,19,2)
D KACLSB^TIUDD01(1301,X)
"^DD",8925,8925,1301,1,19,"%D",0)
^^3^3^2970617^
"^DD",8925,8925,1301,1,19,"%D",1,0)
This cross-reference by CLASS, SIGNED BY, PATIENT, INVERSE REFERENCE
"^DD",8925,8925,1301,1,19,"%D",2,0)
DATE/TIME, and RECORD # will facilitate finding records signed by a given
"^DD",8925,8925,1301,1,19,"%D",3,0)
user about the current patient.
"^DD",8925,8925,1301,1,19,"DT")
2970617
"^DD",8925,8925,1301,3)
This is the date (and time) by which the document will be referenced.
"^DD",8925,8925,1301,21,0)
^^8^8^3071101^
"^DD",8925,8925,1301,21,1,0)
This is the Date (and time) by which the clinician will reference the 
"^DD",8925,8925,1301,21,2,0)
document.  For Progress Notes, this will likely be the date of the 
"^DD",8925,8925,1301,21,3,0)
provider's encounter with the patient.  For Discharge Summaries, it will 
"^DD",8925,8925,1301,21,4,0)
correspond to the Discharge Date of the Admission referenced in the 
"^DD",8925,8925,1301,21,5,0)
document.  (If there is no Discharge Date when dictated, it will 
"^DD",8925,8925,1301,21,6,0)
correspond to the dictation date of the record instead.)
"^DD",8925,8925,1301,21,7,0)
In all cases, this is the date by which the document will be referenced
"^DD",8925,8925,1301,21,8,0)
and sorted.
"^DD",8925,8925,1301,"DT")
3071108
"^DD",8925.95,8925.95,5,0)
USERS REQUIRING COSIGNATURE^8925.955P^^5;0
"^DD",8925.95,8925.95,5,21,0)
^^9^9^3080204^
"^DD",8925.95,8925.95,5,21,1,0)
Please indicate which groups of users (i.e., User Classes) require
"^DD",8925.95,8925.95,5,21,2,0)
cosignature for the type of document in question.  For example, 
"^DD",8925.95,8925.95,5,21,3,0)
STUDENTS, INTERNS, LPNs, and other user classes may be identified 
"^DD",8925.95,8925.95,5,21,4,0)
as requiring a cosignature for PROGRESS NOTES.
"^DD",8925.95,8925.95,5,21,5,0)
 
"^DD",8925.95,8925.95,5,21,6,0)
NOTE: Users specified as requiring a cosignature for DISCHARGE SUMMARY 
"^DD",8925.95,8925.95,5,21,7,0)
documents cannot be selected as Attending Physicians for these
"^DD",8925.95,8925.95,5,21,8,0)
documents. This ensures that users who require a cosignature
"^DD",8925.95,8925.95,5,21,9,0)
cannot cosign these documents.
"^DD",8925.95,8925.955,0)
USERS REQUIRING COSIGNATURE SUB-FIELD^^.01^1
"^DD",8925.95,8925.955,0,"NM","USERS REQUIRING COSIGNATURE")

"^DD",8925.95,8925.955,.01,0)
USERS REQUIRING COSIGNATURE^MP8930'^USR(8930,^0;1^Q
"^DD",8925.95,8925.955,.01,1,0)
^.1
"^DD",8925.95,8925.955,.01,1,1,0)
8925.955^B
"^DD",8925.95,8925.955,.01,1,1,1)
S ^TIU(8925.95,DA(1),5,"B",$E(X,1,30),DA)=""
"^DD",8925.95,8925.955,.01,1,1,2)
K ^TIU(8925.95,DA(1),5,"B",$E(X,1,30),DA)
"^DD",8925.95,8925.955,.01,3)
Specify which user class(es) require cosignature
"^DD",8925.95,8925.955,.01,21,0)
^^9^9^3080204^
"^DD",8925.95,8925.955,.01,21,1,0)
Please indicate which groups of users (i.e., User Classes) require
"^DD",8925.95,8925.955,.01,21,2,0)
cosignature for the type of document in question.  For example, 
"^DD",8925.95,8925.955,.01,21,3,0)
STUDENTS, INTERNS, LPNs, and other user classes may be identified 
"^DD",8925.95,8925.955,.01,21,4,0)
as requiring a cosignature for PROGRESS NOTES.
"^DD",8925.95,8925.955,.01,21,5,0)
 
"^DD",8925.95,8925.955,.01,21,6,0)
NOTE: Users specified as requiring a cosignature for DISCHARGE SUMMARY 
"^DD",8925.95,8925.955,.01,21,7,0)
documents cannot be selected as Attending Physicians for these
"^DD",8925.95,8925.955,.01,21,8,0)
documents. This ensures that users who require a cosignature cannot
"^DD",8925.95,8925.955,.01,21,9,0)
cosign these documents.
"^DD",8925.95,8925.955,.01,"DT")
3030121
**INSTALL NAME**
GMPL*2.0*35
"BLD",17934,0)
GMPL*2.0*35^PROBLEM LIST^0^3080321^y
"BLD",17934,4,0)
^9.64PA^9000011^1
"BLD",17934,4,9000011,0)
9000011
"BLD",17934,4,9000011,2,0)
^9.641^9000011^1
"BLD",17934,4,9000011,2,9000011,0)
PROBLEM  (File-top level)
"BLD",17934,4,9000011,2,9000011,1,0)
^9.6411^1.17^2
"BLD",17934,4,9000011,2,9000011,1,1.17,0)
COMBAT VETERAN
"BLD",17934,4,9000011,2,9000011,1,1.18,0)
SHIPBOARD HAZARD & DEFENSE
"BLD",17934,4,9000011,222)
y^y^p^^^^n^^n
"BLD",17934,4,9000011,224)

"BLD",17934,4,"APDD",9000011,9000011)

"BLD",17934,4,"APDD",9000011,9000011,1.17)

"BLD",17934,4,"APDD",9000011,9000011,1.18)

"BLD",17934,4,"B",9000011,9000011)

"BLD",17934,6)
3^
"BLD",17934,6.3)
26
"BLD",17934,"KRN",0)
^9.67PA^8989.52^19
"BLD",17934,"KRN",.4,0)
.4
"BLD",17934,"KRN",.401,0)
.401
"BLD",17934,"KRN",.402,0)
.402
"BLD",17934,"KRN",.403,0)
.403
"BLD",17934,"KRN",.5,0)
.5
"BLD",17934,"KRN",.84,0)
.84
"BLD",17934,"KRN",3.6,0)
3.6
"BLD",17934,"KRN",3.8,0)
3.8
"BLD",17934,"KRN",9.2,0)
9.2
"BLD",17934,"KRN",9.8,0)
9.8
"BLD",17934,"KRN",9.8,"NM",0)
^9.68A^13^13
"BLD",17934,"KRN",9.8,"NM",1,0)
GMPLX1^^0^B44650031
"BLD",17934,"KRN",9.8,"NM",2,0)
GMPLEDT3^^0^B27556139
"BLD",17934,"KRN",9.8,"NM",3,0)
GMPLEDT2^^0^B28884081
"BLD",17934,"KRN",9.8,"NM",4,0)
GMPLEDT1^^0^B36199470
"BLD",17934,"KRN",9.8,"NM",5,0)
GMPLDISP^^0^B29081516
"BLD",17934,"KRN",9.8,"NM",6,0)
GMPLHIST^^0^B13031139
"BLD",17934,"KRN",9.8,"NM",7,0)
GMPLUTL^^0^B40604448
"BLD",17934,"KRN",9.8,"NM",8,0)
GMPLUTL1^^0^B25017636
"BLD",17934,"KRN",9.8,"NM",9,0)
GMPLUTL2^^0^B69909833
"BLD",17934,"KRN",9.8,"NM",10,0)
GMPLEDIT^^0^B29858214
"BLD",17934,"KRN",9.8,"NM",11,0)
GMPLHS^^0^B13486016
"BLD",17934,"KRN",9.8,"NM",12,0)
GMPLSAVE^^0^B28058379
"BLD",17934,"KRN",9.8,"NM",13,0)
GMPLENFM^^0^B21546471
"BLD",17934,"KRN",9.8,"NM","B","GMPLDISP",5)

"BLD",17934,"KRN",9.8,"NM","B","GMPLEDIT",10)

"BLD",17934,"KRN",9.8,"NM","B","GMPLEDT1",4)

"BLD",17934,"KRN",9.8,"NM","B","GMPLEDT2",3)

"BLD",17934,"KRN",9.8,"NM","B","GMPLEDT3",2)

"BLD",17934,"KRN",9.8,"NM","B","GMPLENFM",13)

"BLD",17934,"KRN",9.8,"NM","B","GMPLHIST",6)

"BLD",17934,"KRN",9.8,"NM","B","GMPLHS",11)

"BLD",17934,"KRN",9.8,"NM","B","GMPLSAVE",12)

"BLD",17934,"KRN",9.8,"NM","B","GMPLUTL",7)

"BLD",17934,"KRN",9.8,"NM","B","GMPLUTL1",8)

"BLD",17934,"KRN",9.8,"NM","B","GMPLUTL2",9)

"BLD",17934,"KRN",9.8,"NM","B","GMPLX1",1)

"BLD",17934,"KRN",19,0)
19
"BLD",17934,"KRN",19.1,0)
19.1
"BLD",17934,"KRN",101,0)
101
"BLD",17934,"KRN",409.61,0)
409.61
"BLD",17934,"KRN",771,0)
771
"BLD",17934,"KRN",870,0)
870
"BLD",17934,"KRN",8989.51,0)
8989.51
"BLD",17934,"KRN",8989.52,0)
8989.52
"BLD",17934,"KRN",8994,0)
8994
"BLD",17934,"KRN","B",.4,.4)

"BLD",17934,"KRN","B",.401,.401)

"BLD",17934,"KRN","B",.402,.402)

"BLD",17934,"KRN","B",.403,.403)

"BLD",17934,"KRN","B",.5,.5)

"BLD",17934,"KRN","B",.84,.84)

"BLD",17934,"KRN","B",3.6,3.6)

"BLD",17934,"KRN","B",3.8,3.8)

"BLD",17934,"KRN","B",9.2,9.2)

"BLD",17934,"KRN","B",9.8,9.8)

"BLD",17934,"KRN","B",19,19)

"BLD",17934,"KRN","B",19.1,19.1)

"BLD",17934,"KRN","B",101,101)

"BLD",17934,"KRN","B",409.61,409.61)

"BLD",17934,"KRN","B",771,771)

"BLD",17934,"KRN","B",870,870)

"BLD",17934,"KRN","B",8989.51,8989.51)

"BLD",17934,"KRN","B",8989.52,8989.52)

"BLD",17934,"KRN","B",8994,8994)

"BLD",17934,"QUES",0)
^9.62^^
"BLD",17934,"REQB",0)
^9.611^^
"FIA",9000011)
PROBLEM
"FIA",9000011,0)
^AUPNPROB(
"FIA",9000011,0,0)
9000011IP
"FIA",9000011,0,1)
y^y^p^^^^n^^n
"FIA",9000011,0,10)

"FIA",9000011,0,11)

"FIA",9000011,0,"RLRO")

"FIA",9000011,0,"VR")
2.0^GMPL
"FIA",9000011,9000011)
1
"FIA",9000011,9000011,1.17)

"FIA",9000011,9000011,1.18)

"MBREQ")
0
"PKG",232,-1)
1^1
"PKG",232,0)
PROBLEM LIST^GMPL^Automated Patient Problem List
"PKG",232,20,0)
^9.402P^^
"PKG",232,22,0)
^9.49I^1^1
"PKG",232,22,1,0)
2.0^2940825^2941214
"PKG",232,22,1,"PAH",1,0)
35^3080321^1392
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
13
"RTN","GMPLDISP")
0^5^B29081516^B28642725
"RTN","GMPLDISP",1,0)
GMPLDISP ; SLC/MKB -- Problem List detailed display ; 04/15/2002
"RTN","GMPLDISP",2,0)
 ;;2.0;Problem List;**21,26,35**;Aug 25, 1994;Build 26
"RTN","GMPLDISP",3,0)
 ;
"RTN","GMPLDISP",4,0)
 ; External References
"RTN","GMPLDISP",5,0)
 ;   DBIA  3106  ^DIC(49
"RTN","GMPLDISP",6,0)
 ;   DBIA 10082  ^ICD9( file 80
"RTN","GMPLDISP",7,0)
 ;   DBIA 10040  ^SC(  file 44
"RTN","GMPLDISP",8,0)
 ;   DBIA 10060  ^VA(200
"RTN","GMPLDISP",9,0)
 ;   DBIA 10116  $$SETSTR^VALM1
"RTN","GMPLDISP",10,0)
 ;   DBIA 10117  CLEAN^VALM10
"RTN","GMPLDISP",11,0)
 ;   DBIA 10117  CNTRL^VALM10
"RTN","GMPLDISP",12,0)
 ;   DBIA 10103  $$FMTE^XLFDT
"RTN","GMPLDISP",13,0)
 ;   DBIA 10103  $$HTFM^XLFDT
"RTN","GMPLDISP",14,0)
 ;   DBIA 10104  $$REPEAT^XLFSTR
"RTN","GMPLDISP",15,0)
 ;                      
"RTN","GMPLDISP",16,0)
EN ; Init Variables (need GMPLSEL,GMPLNO) and List Array
"RTN","GMPLDISP",17,0)
 G:'$D(GMPLSEL) ERROR G:'$G(GMPLNO) ERROR
"RTN","GMPLDISP",18,0)
 S GMPI=+$G(GMPI)+1 I GMPI>GMPLNO D  Q
"RTN","GMPLDISP",19,0)
 . W !!,"There are no more problems that have been selected to view!",! S VALMBCK="" H 2
"RTN","GMPLDISP",20,0)
 S GMPLNUM=$P(GMPLSEL,",",GMPI) G:GMPLNUM'>0 ERROR
"RTN","GMPLDISP",21,0)
 S GMPIFN=$P($G(^TMP("GMPLIDX",$J,+GMPLNUM)),U,2) G:GMPIFN'>0 ERROR
"RTN","GMPLDISP",22,0)
 W !!,"Retrieving current data for problem #"_GMPLNUM_" ...",!
"RTN","GMPLDISP",23,0)
 ;                        
"RTN","GMPLDISP",24,0)
PROB ; Display problem GMPIFN
"RTN","GMPLDISP",25,0)
 N LINE,STR,I,TEXT,NOTE,GMPL0,GMPL1,X,Y,IDT,FAC,AIFN,SP,LCNT,NIFN
"RTN","GMPLDISP",26,0)
 G:'$G(GMPIFN) ERROR D CLEAN^VALM10
"RTN","GMPLDISP",27,0)
 S GMPL0=$G(^AUPNPROB(GMPIFN,0)),GMPL1=$G(^(1)),LCNT=1,SP=""
"RTN","GMPLDISP",28,0)
 F I=11,12,13,15,16,17,18 S:+$P(GMPL1,U,I) SP=SP_$S(I=11:"AGENT ORANGE",I=12:"RADIATION",I=13:"ENV CONTAMINANTS",I=15:"HEAD/NECK CANCER",I=16:"MIL SEXUAL TRAUMA",I=17:"COMBAT VET",1:"SHAD")_U
"RTN","GMPLDISP",29,0)
 F  Q:$E(SP,$L(SP))'="^"  S SP=$E(SP,1,($L(SP)-1))
"RTN","GMPLDISP",30,0)
 D WRAP^GMPLX($$PROBTEXT^GMPLX(GMPIFN),65,.TEXT)
"RTN","GMPLDISP",31,0)
 S GMPDT(LCNT,0)="  Problem: "_TEXT(1)
"RTN","GMPLDISP",32,0)
 I TEXT>1 F I=2:1:TEXT S LCNT=LCNT+1,GMPDT(LCNT,0)=TEXT(I)
"RTN","GMPLDISP",33,0)
 S LCNT=LCNT+1,GMPDT(LCNT,0)="       "
"RTN","GMPLDISP",34,0)
PR1 ;   Onset
"RTN","GMPLDISP",35,0)
 ;   SC Condition
"RTN","GMPLDISP",36,0)
 ;   Status
"RTN","GMPLDISP",37,0)
 ;   Exposure
"RTN","GMPLDISP",38,0)
 ;   Provider
"RTN","GMPLDISP",39,0)
 ;   Service/Clinic
"RTN","GMPLDISP",40,0)
 S LINE="    Onset: "_$S($P(GMPL0,U,13):$$EXTDT^GMPLX($P(GMPL0,U,13)),1:"date unknown"),STR=""
"RTN","GMPLDISP",41,0)
 S:GMPVA STR="SC Condition: "_$S(+$P(GMPL1,U,10):"YES",$P(GMPL1,U,10)=0:"NO",1:"unknown")
"RTN","GMPLDISP",42,0)
 S LINE=$$SETSTR^VALM1(STR,LINE,49,30),LCNT=LCNT+1,GMPDT(LCNT,0)=LINE
"RTN","GMPLDISP",43,0)
 S X=$P(GMPL0,U,12),LINE="   Status: "_$S(X="A":"ACTIVE",1:"INACTIVE")
"RTN","GMPLDISP",44,0)
 I X="A",$L($P(GMPL1,U,14)) S LINE=LINE_"/"_$S($P(GMPL1,U,14)="A":"ACUTE",1:"CHRONIC")
"RTN","GMPLDISP",45,0)
 I X="I",$P(GMPL1,U,7) S LINE=LINE_", Resolved "_$$EXTDT^GMPLX($P(GMPL1,U,7))
"RTN","GMPLDISP",46,0)
 S STR="",LCNT=LCNT+1
"RTN","GMPLDISP",47,0)
 S:GMPVA STR="    Exposure: "_$S('$L(SP):"none",1:$P(SP,U))
"RTN","GMPLDISP",48,0)
 S LINE=$$SETSTR^VALM1(STR,LINE,49,30),GMPDT(LCNT,0)=LINE
"RTN","GMPLDISP",49,0)
 S LINE=" Provider: "_$P($G(^VA(200,+$P(GMPL1,U,5),0)),U),LCNT=LCNT+1,STR=""
"RTN","GMPLDISP",50,0)
 I GMPVA,$L(SP,U)>1 S STR=$P(SP,U,2)
"RTN","GMPLDISP",51,0)
 S LINE=$$SETSTR^VALM1(STR,LINE,63,16),GMPDT(LCNT,0)=LINE
"RTN","GMPLDISP",52,0)
 I $E(GMPLVIEW("VIEW"))="S" S LINE="  Service: "_$P($G(^DIC(49,+$P(GMPL1,U,6),0)),U)
"RTN","GMPLDISP",53,0)
 E  S LINE="   Clinic: "_$P($G(^SC(+$P(GMPL1,U,8),0)),U)
"RTN","GMPLDISP",54,0)
 S LCNT=LCNT+1,STR="" I GMPVA,$L(SP,U)>2 S STR=$P(SP,U,3)
"RTN","GMPLDISP",55,0)
 S LINE=$$SETSTR^VALM1(STR,LINE,63,16),GMPDT(LCNT,0)=LINE
"RTN","GMPLDISP",56,0)
 S LCNT=LCNT+1,GMPDT(LCNT,0)="       "
"RTN","GMPLDISP",57,0)
PR2 ;   Recorded
"RTN","GMPLDISP",58,0)
 ;   Entered
"RTN","GMPLDISP",59,0)
 ;   Provider Narrative
"RTN","GMPLDISP",60,0)
 ;   ICD code
"RTN","GMPLDISP",61,0)
 S LINE=" Recorded: "_$S($P(GMPL1,U,9):$$EXTDT^GMPLX($P(GMPL1,U,9)),1:"date unknown")
"RTN","GMPLDISP",62,0)
 S:$P(GMPL1,U,4) LINE=LINE_", by "_$P($G(^VA(200,+$P(GMPL1,U,4),0)),U)
"RTN","GMPLDISP",63,0)
 S LCNT=LCNT+1,GMPDT(LCNT,0)=LINE
"RTN","GMPLDISP",64,0)
 S LINE="  Entered: "_$$EXTDT^GMPLX($P(GMPL0,U,8))
"RTN","GMPLDISP",65,0)
 S LINE=LINE_", by "_$P($G(^VA(200,+$P(GMPL1,U,3),0)),U),LCNT=LCNT+1
"RTN","GMPLDISP",66,0)
 S:GMPARAM("VER")&($P(GMPL1,U,2)="T") LINE=LINE_"  <unconfirmed>"
"RTN","GMPLDISP",67,0)
 S GMPDT(LCNT,0)=LINE
"RTN","GMPLDISP",68,0)
 S LINE=" ICD Code: "_$P($G(^ICD9(+GMPL0,0)),U),LCNT=LCNT+1,GMPDT(LCNT,0)=LINE
"RTN","GMPLDISP",69,0)
 S LCNT=LCNT+1,GMPDT(LCNT,0)="       "
"RTN","GMPLDISP",70,0)
PR3 ;   Comments
"RTN","GMPLDISP",71,0)
 S LCNT=LCNT+1,GMPDT(LCNT,0)="Comments:"
"RTN","GMPLDISP",72,0)
 D CNTRL^VALM10(LCNT,1,8,IOUON,IOUOFF)
"RTN","GMPLDISP",73,0)
 ;     By Facility
"RTN","GMPLDISP",74,0)
 F FAC=0:0 S FAC=$O(^AUPNPROB(GMPIFN,11,FAC)) Q:+FAC'>0  D
"RTN","GMPLDISP",75,0)
 . I 'FAC S LCNT=LCNT+1,GMPDT(LCNT,0)="   <None>" G PR4
"RTN","GMPLDISP",76,0)
 . F NIFN=0:0 S NIFN=$O(^AUPNPROB(GMPIFN,11,FAC,11,NIFN)) Q:+NIFN'>0  D
"RTN","GMPLDISP",77,0)
 . . S NOTE=$G(^AUPNPROB(GMPIFN,11,FAC,11,NIFN,0)) Q:NOTE=""
"RTN","GMPLDISP",78,0)
 . . S LINE=$J($$EXTDT^GMPLX($P(NOTE,U,5)),10)_": "_$P(NOTE,U,3)
"RTN","GMPLDISP",79,0)
 . . S LCNT=LCNT+1,GMPDT(LCNT,0)=LINE
"RTN","GMPLDISP",80,0)
 . . I $P(NOTE,U,6) S LINE="            "_$P($G(^VA(200,+$P(NOTE,U,6),0)),U),LCNT=LCNT+1,GMPDT(LCNT,0)=LINE
"RTN","GMPLDISP",81,0)
 S:'($G(NOTE)) LCNT=LCNT+1,GMPDT(LCNT,0)="   <None>"
"RTN","GMPLDISP",82,0)
PR4 ;   Audit Trail
"RTN","GMPLDISP",83,0)
 S LCNT=LCNT+1,GMPDT(LCNT,0)="       "
"RTN","GMPLDISP",84,0)
 S LCNT=LCNT+1,GMPDT(LCNT,0)="History:"
"RTN","GMPLDISP",85,0)
 D CNTRL^VALM10(LCNT,1,7,IOUON,IOUOFF)
"RTN","GMPLDISP",86,0)
 I '$D(^GMPL(125.8,"B",GMPIFN)) S LCNT=LCNT+1,GMPDT(LCNT,0)="   <No changes>" G PRQ
"RTN","GMPLDISP",87,0)
 F IDT=0:0 S IDT=$O(^GMPL(125.8,"AD",GMPIFN,IDT)) Q:IDT'>0  D
"RTN","GMPLDISP",88,0)
 . F AIFN=0:0 S AIFN=$O(^GMPL(125.8,"AD",GMPIFN,IDT,AIFN)) Q:AIFN'>0  D DT^GMPLHIST
"RTN","GMPLDISP",89,0)
PRQ ;   Header Node
"RTN","GMPLDISP",90,0)
 S VALMCNT=LCNT,GMPDT(0)=VALMCNT,VALMSG=$$MSG^GMPLX,VALMBG=1,VALMBCK="R"
"RTN","GMPLDISP",91,0)
 Q
"RTN","GMPLDISP",92,0)
 ;                     
"RTN","GMPLDISP",93,0)
HDR ; Header Code (uses GMPDFN, GMPIFN)
"RTN","GMPLDISP",94,0)
 N LASTMOD,PAT S PAT=$P(GMPDFN,U,2)_"  ("_$P(GMPDFN,U,3)_")"
"RTN","GMPLDISP",95,0)
 S LASTMOD=$S($G(GMPIFN):$P(^AUPNPROB(GMPIFN,0),U,3),1:$E($$HTFM^XLFDT($H),1,12))
"RTN","GMPLDISP",96,0)
 S LASTMOD="Last Updated: "_$$FMTE^XLFDT(LASTMOD)
"RTN","GMPLDISP",97,0)
 S VALMHDR(1)=PAT_$$REPEAT^XLFSTR(" ",(79-$L(PAT)-$L(LASTMOD)))_LASTMOD
"RTN","GMPLDISP",98,0)
 Q
"RTN","GMPLDISP",99,0)
 ;
"RTN","GMPLDISP",100,0)
HELP ; Help Code
"RTN","GMPLDISP",101,0)
 N X W !!?4,"You may view detailed information here on this problem;"
"RTN","GMPLDISP",102,0)
 W !?4,"more data may be available by entering 'Next Screen'."
"RTN","GMPLDISP",103,0)
 W !?4,"If you have selected multiple problems to view, you may"
"RTN","GMPLDISP",104,0)
 W !?4,"enter 'Continue to Next Selected Problem'; to return to"
"RTN","GMPLDISP",105,0)
 W !?4,"the patient's problem list, enter 'Quit to Problem List'."
"RTN","GMPLDISP",106,0)
 W !!,"Press <return> to continue ... " R X:DTIME
"RTN","GMPLDISP",107,0)
 S VALMSG=$$MSG^GMPLX,VALMBCK=$S(VALMCC:"",1:"R")
"RTN","GMPLDISP",108,0)
 Q
"RTN","GMPLDISP",109,0)
 ;
"RTN","GMPLDISP",110,0)
DEFLT() ; Default Action, using GMPI and GMPLNO
"RTN","GMPLDISP",111,0)
 I GMPI<GMPLNO Q "Continue to Next Selected Problem"
"RTN","GMPLDISP",112,0)
 Q "Quit to Problem List"
"RTN","GMPLDISP",113,0)
 ;
"RTN","GMPLDISP",114,0)
ERROR ; Error Message - drop into EXIT
"RTN","GMPLDISP",115,0)
 W !!,"ERROR -- Cannot continue ... Returning to Problem List.",!
"RTN","GMPLDISP",116,0)
 S VALMBCK="Q" H 1
"RTN","GMPLDISP",117,0)
EXIT ; Exit Code
"RTN","GMPLDISP",118,0)
 K GMPDT Q
"RTN","GMPLEDIT")
0^10^B29858214^B29800503
"RTN","GMPLEDIT",1,0)
GMPLEDIT ; SLC/MKB/KER -- VALM Utilities for Edit sub-list ; 04/15/2002
"RTN","GMPLEDIT",2,0)
 ;;2.0;Problem List;**26,35**;Aug 25, 1994;Build 26
"RTN","GMPLEDIT",3,0)
 ;
"RTN","GMPLEDIT",4,0)
 ; External References
"RTN","GMPLEDIT",5,0)
 ;   DBIA 10060  ^VA(200
"RTN","GMPLEDIT",6,0)
 ;   DBIA 10076  ^XUSEC("GMPL ICD CODE"
"RTN","GMPLEDIT",7,0)
 ;   DBIA 10009  YN^DICN
"RTN","GMPLEDIT",8,0)
 ;   DBIA 10116  $$SETSTR^VALM1
"RTN","GMPLEDIT",9,0)
 ;   DBIA 10117  CLEAN^VALM10
"RTN","GMPLEDIT",10,0)
 ;   DBIA 10117  CNTRL^VALM10
"RTN","GMPLEDIT",11,0)
 ;   DBIA 10103  $$FMTE^XLFDT
"RTN","GMPLEDIT",12,0)
 ;   DBIA 10104  $$REPEAT^XLFSTR
"RTN","GMPLEDIT",13,0)
 ;                    
"RTN","GMPLEDIT",14,0)
EN ; Init Variables, list array
"RTN","GMPLEDIT",15,0)
 ;   Expects GMPIFN   IEN of file 900011 (required)
"RTN","GMPLEDIT",16,0)
 ;           GMPLNUM  Sequence # of Problem Edit (optional)
"RTN","GMPLEDIT",17,0)
 W !!,"Retrieving current data for problem "
"RTN","GMPLEDIT",18,0)
 W $S($G(GMPLNUM):"#"_GMPLNUM_" ",1:"")_"...",! K GMPFLD,GMPORIG
"RTN","GMPLEDIT",19,0)
 ;   Set GMPFLD() and GMPORIG() Arrays
"RTN","GMPLEDIT",20,0)
 D GETFLDS^GMPLEDT3(GMPIFN)
"RTN","GMPLEDIT",21,0)
 I '$D(GMPFLD) W !!,"ERROR -- Cannot continue.",! S VALMBCK="Q" G KILL
"RTN","GMPLEDIT",22,0)
INIT ;   Build list from GMPFLD()
"RTN","GMPLEDIT",23,0)
 N LCNT,TEXT,I,SP,LINE,STR,NUM,NOTE,ICD
"RTN","GMPLEDIT",24,0)
 S LCNT=1,ICD=$S($D(^XUSEC("GMPL ICD CODE",DUZ)):1,1:0)
"RTN","GMPLEDIT",25,0)
 S SP="" F I=1.11,1.12,1.13,1.15,1.16,1.17,1.18 S:GMPFLD(I) SP=SP_$P(GMPFLD(I),U,2)_U
"RTN","GMPLEDIT",26,0)
 S:$L(SP) SP=$E(SP,1,$L(SP)-1)
"RTN","GMPLEDIT",27,0)
 K GMPSAVED,GMPREBLD D CLEAN^VALM10
"RTN","GMPLEDIT",28,0)
 D WRAP^GMPLX($P(GMPFLD(.05),U,2),65,.TEXT)
"RTN","GMPLEDIT",29,0)
 ;   Line 1
"RTN","GMPLEDIT",30,0)
 S LINE="1  Problem:  "_TEXT(1)
"RTN","GMPLEDIT",31,0)
 S ^TMP("GMPLEDIT",$J,LCNT,0)=LINE D HI(LCNT,1)
"RTN","GMPLEDIT",32,0)
 I $D(GMPLUSER),GMPARAM("VER"),GMPFLD(1.02)="T" S LINE=$E(LINE,1,12)_"$"_$E(LINE,14,79),^TMP("GMPLEDIT",$J,LCNT,0)=LINE D HI(LCNT,13)
"RTN","GMPLEDIT",33,0)
 I TEXT>1 F I=2:1:TEXT S LCNT=LCNT+1,^TMP("GMPLEDIT",$J,LCNT,0)="              "_TEXT(I)
"RTN","GMPLEDIT",34,0)
 S LCNT=LCNT+1,^TMP("GMPLEDIT",$J,LCNT,0)="   "
"RTN","GMPLEDIT",35,0)
IN1 ;   Line 2
"RTN","GMPLEDIT",36,0)
 S LINE="2  Onset:    ",STR=$P(GMPFLD(.13),U,2)
"RTN","GMPLEDIT",37,0)
 S LINE=LINE_$S(STR="":"unknown",1:STR),LCNT=LCNT+1
"RTN","GMPLEDIT",38,0)
 I GMPVA S STR=$S(ICD:7,1:6)_"  SC Condition: "_$S(GMPFLD(1.1)="":"unknown",1:$P(GMPFLD(1.1),U,2)),LINE=$$SETSTR^VALM1(STR,LINE,45,34)
"RTN","GMPLEDIT",39,0)
 S ^TMP("GMPLEDIT",$J,LCNT,0)=LINE F I=1,45 D HI(LCNT,I)
"RTN","GMPLEDIT",40,0)
IN2 ;   Line 3
"RTN","GMPLEDIT",41,0)
 S LINE="3  Status:   "_$P(GMPFLD(.12),U,2),LCNT=LCNT+1
"RTN","GMPLEDIT",42,0)
 I $E(GMPFLD(.12))="A",$L(GMPFLD(1.14)) S LINE=LINE_"/"_$P(GMPFLD(1.14),U,2)
"RTN","GMPLEDIT",43,0)
 I $E(GMPFLD(.12))="I",GMPFLD(1.07) S LINE=LINE_", Resolved "_$P(GMPFLD(1.07),U,2)
"RTN","GMPLEDIT",44,0)
 I GMPVA S STR=$S(ICD:8,1:7)_"  Exposure:     "_$S('$L(SP):"<None>",1:$P(SP,U)),LINE=$$SETSTR^VALM1(STR,LINE,45,34)
"RTN","GMPLEDIT",45,0)
 S ^TMP("GMPLEDIT",$J,LCNT,0)=LINE F I=1,45 D HI(LCNT,I)
"RTN","GMPLEDIT",46,0)
IN3 ;   Line 4
"RTN","GMPLEDIT",47,0)
 S LINE="4  Provider: "_$P(GMPFLD(1.05),U,2),LCNT=LCNT+1
"RTN","GMPLEDIT",48,0)
 I GMPVA,$L(SP,U)>1 S STR=$P(SP,U,2),LINE=$$SETSTR^VALM1(STR,LINE,60,20)
"RTN","GMPLEDIT",49,0)
 S ^TMP("GMPLEDIT",$J,LCNT,0)=LINE D HI(LCNT,1)
"RTN","GMPLEDIT",50,0)
 ;   Line 5
"RTN","GMPLEDIT",51,0)
 I $E(GMPLVIEW("VIEW"))="S" S LINE="5  Service:  "_$P(GMPFLD(1.06),U,2)
"RTN","GMPLEDIT",52,0)
 E  S LINE="5  Clinic:   "_$P(GMPFLD(1.08),U,2)
"RTN","GMPLEDIT",53,0)
 I GMPVA,$L(SP,U)>2 S STR=$P(SP,U,3),LINE=$$SETSTR^VALM1(STR,LINE,60,20)
"RTN","GMPLEDIT",54,0)
 S LCNT=LCNT+1,^TMP("GMPLEDIT",$J,LCNT,0)=LINE D HI(LCNT,1) G:'ICD IN4
"RTN","GMPLEDIT",55,0)
 ;   Line 6
"RTN","GMPLEDIT",56,0)
 S LINE="6  ICD Code: "_$P(GMPFLD(.01),U,2),LCNT=LCNT+1
"RTN","GMPLEDIT",57,0)
 S ^TMP("GMPLEDIT",$J,LCNT,0)=LINE D HI(LCNT,1)
"RTN","GMPLEDIT",58,0)
IN4 ;   Line 7/8
"RTN","GMPLEDIT",59,0)
 S LCNT=LCNT+1,^TMP("GMPLEDIT",$J,LCNT,0)="   "
"RTN","GMPLEDIT",60,0)
 S LCNT=LCNT+1,^TMP("GMPLEDIT",$J,LCNT,0)="Comments: "
"RTN","GMPLEDIT",61,0)
 D CNTRL^VALM10(LCNT,1,8,IOUON,IOUOFF)
"RTN","GMPLEDIT",62,0)
 S NUM=$S(GMPVA:7,1:5) S:ICD NUM=NUM+1
"RTN","GMPLEDIT",63,0)
 I GMPFLD(10,0) F I=1:1:GMPFLD(10,0) D
"RTN","GMPLEDIT",64,0)
 . S NUM=NUM+1,NOTE=GMPFLD(10,I)
"RTN","GMPLEDIT",65,0)
 . S LINE=NUM_$E("   ",1,3-$L(NUM))_$J($$EXTDT^GMPLX($P(NOTE,U,5)),8)
"RTN","GMPLEDIT",66,0)
 . I $P(GMPFLD(10,I),U,3)="",$P(GMPORIG(10,I),U,3)'="" S $P(NOTE,U,3)="<Deleted>"
"RTN","GMPLEDIT",67,0)
 . S LCNT=LCNT+1,^TMP("GMPLEDIT",$J,LCNT,0)=LINE_": "_$P(NOTE,U,3)
"RTN","GMPLEDIT",68,0)
 . D HI(LCNT,1) Q:'$D(GMPLMGR)
"RTN","GMPLEDIT",69,0)
 . S LINE="             "_$P($G(^VA(200,+$P(NOTE,U,6),0)),U)
"RTN","GMPLEDIT",70,0)
 . S LCNT=LCNT+1,^TMP("GMPLEDIT",$J,LCNT,0)=LINE
"RTN","GMPLEDIT",71,0)
IN5 ;   Last Line
"RTN","GMPLEDIT",72,0)
 I $D(GMPFLD(10,"NEW"))>9 S NUM=NUM+1 D
"RTN","GMPLEDIT",73,0)
 . S LINE=NUM_$E("   ",1,3-$L(NUM))_$J($$EXTDT^GMPLX(DT),8)_": "
"RTN","GMPLEDIT",74,0)
 . S I=$O(GMPFLD(10,"NEW",0)),LINE=LINE_GMPFLD(10,"NEW",I)
"RTN","GMPLEDIT",75,0)
 . S LCNT=LCNT+1,^TMP("GMPLEDIT",$J,LCNT,0)=LINE D HI(LCNT,1)
"RTN","GMPLEDIT",76,0)
 . F  S I=$O(GMPFLD(10,"NEW",I)) Q:I'>0  D
"RTN","GMPLEDIT",77,0)
 . . S LINE="             "_GMPFLD(10,"NEW",I)
"RTN","GMPLEDIT",78,0)
 . . S LCNT=LCNT+1,^TMP("GMPLEDIT",$J,LCNT,0)=LINE
"RTN","GMPLEDIT",79,0)
 S VALMCNT=LCNT,^TMP("GMPLEDIT",$J,0)=NUM_U_LCNT,VALMSG=$$MSG^GMPLEDT3
"RTN","GMPLEDIT",80,0)
 Q
"RTN","GMPLEDIT",81,0)
 ;          
"RTN","GMPLEDIT",82,0)
HI(LINE,COL) ; Hi-lite #
"RTN","GMPLEDIT",83,0)
 D CNTRL^VALM10(LINE,COL,3,IOINHI,IOINORM)
"RTN","GMPLEDIT",84,0)
 Q
"RTN","GMPLEDIT",85,0)
 ;          
"RTN","GMPLEDIT",86,0)
HDR ; Header code
"RTN","GMPLEDIT",87,0)
 N LASTMOD,PAT S PAT=$P(GMPDFN,U,2)_"  ("_$P(GMPDFN,U,3)_")"
"RTN","GMPLEDIT",88,0)
 S LASTMOD=$P(^AUPNPROB(GMPIFN,0),U,3)
"RTN","GMPLEDIT",89,0)
 S LASTMOD="Last Updated: "_$$FMTE^XLFDT(LASTMOD)
"RTN","GMPLEDIT",90,0)
 S VALMHDR(1)=PAT_$$REPEAT^XLFSTR(" ",(79-$L(PAT)-$L(LASTMOD)))_LASTMOD
"RTN","GMPLEDIT",91,0)
 Q
"RTN","GMPLEDIT",92,0)
 ;
"RTN","GMPLEDIT",93,0)
HELP ; Help code
"RTN","GMPLEDIT",94,0)
 N X,CNT S CNT=+$G(^TMP("GMPLEDIT",$J,0))
"RTN","GMPLEDIT",95,0)
 W !!?4,"You may change one or more of the above listed values describing"
"RTN","GMPLEDIT",96,0)
 W !?4,"this problem by entering its display number (1-"_CNT_") at the prompt;"
"RTN","GMPLEDIT",97,0)
 W !?4,"you may then enter a new value, or '@' to delete an existing value."
"RTN","GMPLEDIT",98,0)
 W !!?4,"Enter RM to remove this problem from the patient's list completely,"
"RTN","GMPLEDIT",99,0)
 W !?4,"SC to save your changes, or Q to simply return to the problem list."
"RTN","GMPLEDIT",100,0)
 W:VALMCNT>11 !?4,"Enter '+' to see more information, as in the problem list."
"RTN","GMPLEDIT",101,0)
 W !!,"Press <return> to continue ... " R X:DTIME
"RTN","GMPLEDIT",102,0)
 S VALMSG=$$MSG^GMPLEDT3,VALMBCK=$S(VALMCC:"",1:"R")
"RTN","GMPLEDIT",103,0)
 Q
"RTN","GMPLEDIT",104,0)
 ;          
"RTN","GMPLEDIT",105,0)
EXIT ; Exit code
"RTN","GMPLEDIT",106,0)
 N DIFFRENT,% G:$D(GMPSAVED) KILL
"RTN","GMPLEDIT",107,0)
 S DIFFRENT=$$EDITED^GMPLEDT2 I 'DIFFRENT G KILL
"RTN","GMPLEDIT",108,0)
 W $C(7),!!,">>>  THIS PROBLEM HAS CHANGED!!"
"RTN","GMPLEDIT",109,0)
EX1 ;   Ask to Save Changes on Exit
"RTN","GMPLEDIT",110,0)
 W !?5,"Do you want to save these changes"
"RTN","GMPLEDIT",111,0)
 S %=1 D YN^DICN G:(%<0)!(%=2) KILL I %=0 D  G EX1
"RTN","GMPLEDIT",112,0)
 . W !!?5,"Enter YES or <return> to save the current values listed above"
"RTN","GMPLEDIT",113,0)
 . W !?5,"describing this problem; enter NO to exit without saving.",!
"RTN","GMPLEDIT",114,0)
 W !!,"Saving ..." D EN^GMPLSAVE W " done."
"RTN","GMPLEDIT",115,0)
KILL ;   Clean-up
"RTN","GMPLEDIT",116,0)
 S CNT=+$G(^TMP("GMPLEDIT",$J,0))
"RTN","GMPLEDIT",117,0)
 F I=1:1:CNT K XQORM("KEY",I)
"RTN","GMPLEDIT",118,0)
 D CLEAN^VALM10 K XQORM("KEY","$")
"RTN","GMPLEDIT",119,0)
 K GMPFLD,GMPORIG,GMPQUIT,DUOUT,DTOUT,I,CNT
"RTN","GMPLEDIT",120,0)
 Q
"RTN","GMPLEDT1")
0^4^B36199470^B35847612
"RTN","GMPLEDT1",1,0)
GMPLEDT1 ; SLC/MKB/KER/AJB -- Edit Problem List fields ; 04/21/2003
"RTN","GMPLEDT1",2,0)
 ;;2.0;Problem List;**17,20,26,28,35**;Aug 25, 1994;Build 26
"RTN","GMPLEDT1",3,0)
 ;
"RTN","GMPLEDT1",4,0)
 ; External References
"RTN","GMPLEDT1",5,0)
 ;   DBIA 10006  ^DIC
"RTN","GMPLEDT1",6,0)
 ;   DBIA 10026  ^DIR
"RTN","GMPLEDT1",7,0)
 ;   DBIA   341  DIS^SDROUT2
"RTN","GMPLEDT1",8,0)
 ;                
"RTN","GMPLEDT1",9,0)
ONSET ; Edit Date of Onset - field .13
"RTN","GMPLEDT1",10,0)
 N X,Y,ENTERED,PROMPT,HELPMSG,DEFAULT
"RTN","GMPLEDT1",11,0)
 S ENTERED=$S($G(GMPFLD(.08)):+GMPFLD(.08),1:DT),DEFAULT=$G(GMPFLD(.13))
"RTN","GMPLEDT1",12,0)
 S PROMPT="DATE OF ONSET: ",HELPMSG="Enter the date this problem was first observed, as precisely as known."
"RTN","GMPLEDT1",13,0)
O1 ;   Get Date of Onset
"RTN","GMPLEDT1",14,0)
 D DATE^GMPLEDT2 Q:$D(GMPQUIT)!($G(GMPLJUMP))
"RTN","GMPLEDT1",15,0)
 I Y>ENTERED W !!,"Date of Onset cannot be later than the date the problem was entered!",$C(7) G O1
"RTN","GMPLEDT1",16,0)
 I +$P(GMPDFN,U,4),Y>$P(GMPDFN,U,4) W !!,"Date of Onset cannot be later than the date of death!",$C(7) G O1
"RTN","GMPLEDT1",17,0)
 S GMPFLD(.13)=Y S:Y'="" GMPFLD(.13)=GMPFLD(.13)_U_$$EXTDT^GMPLX(Y)
"RTN","GMPLEDT1",18,0)
 Q
"RTN","GMPLEDT1",19,0)
STATUS ; Edit Status - field .12
"RTN","GMPLEDT1",20,0)
 ;   Then Edit Date Resolved - Field 1.07, if inactive
"RTN","GMPLEDT1",21,0)
 N DIR,X,Y
"RTN","GMPLEDT1",22,0)
 S DIR(0)="9000011,.12"
"RTN","GMPLEDT1",23,0)
 S:$L($G(GMPFLD(.12))) DIR("B")=$P(GMPFLD(.12),U,2)
"RTN","GMPLEDT1",24,0)
ST1 ;   Get Status
"RTN","GMPLEDT1",25,0)
 D ^DIR I $D(DTOUT)!(Y="^") S GMPQUIT=1 Q
"RTN","GMPLEDT1",26,0)
 I Y?1"^".E D JUMP^GMPLEDT3(Y) Q:$D(GMPQUIT)!($G(GMPLJUMP))  K:$G(GMPIFN) GMPLJUMP G ST1
"RTN","GMPLEDT1",27,0)
 S:Y'="" Y=Y_U_$S(Y="A":"ACTIVE",1:"INACTIVE") S GMPFLD(.12)=Y
"RTN","GMPLEDT1",28,0)
 S:$E(Y)'="I" GMPFLD(1.07)="" S:$E(Y)'="A" GMPFLD(1.14)=""
"RTN","GMPLEDT1",29,0)
 D:$E(GMPFLD(.12))="I" RESOLVED^GMPLEDT4
"RTN","GMPLEDT1",30,0)
 D:$E(GMPFLD(.12))="A" PRIORITY^GMPLEDT4
"RTN","GMPLEDT1",31,0)
 Q
"RTN","GMPLEDT1",32,0)
RECORDED ; Edit Date Recorded - field 1.09
"RTN","GMPLEDT1",33,0)
 N X,Y,PROMPT,HELPMSG,DEFAULT,ENTERED
"RTN","GMPLEDT1",34,0)
 S ENTERED=$S($G(GMPFLD(.08)):+GMPFLD(.08),1:DT),DEFAULT=$G(GMPFLD(1.09))
"RTN","GMPLEDT1",35,0)
 S PROMPT="DATE RECORDED: ",HELPMSG="Enter the date this problem was first recorded, as precisely as known."
"RTN","GMPLEDT1",36,0)
RC1 ;   Get Date
"RTN","GMPLEDT1",37,0)
 D DATE^GMPLEDT2 Q:$D(GMPQUIT)!($G(GMPLJUMP))
"RTN","GMPLEDT1",38,0)
 I Y>ENTERED W !!,"Date Recorded cannot be later than the problem was entered!",$C(7) G RC1
"RTN","GMPLEDT1",39,0)
 S GMPFLD(1.09)=Y S:Y'="" GMPFLD(1.09)=GMPFLD(1.09)_U_$$EXTDT^GMPLX(Y)
"RTN","GMPLEDT1",40,0)
 Q
"RTN","GMPLEDT1",41,0)
SC ; Edit Service Connected - field 1.1
"RTN","GMPLEDT1",42,0)
 N DFN,DIR,X,Y
"RTN","GMPLEDT1",43,0)
 ;
"RTN","GMPLEDT1",44,0)
 ;   The following allows changing a problem's SC/NSC to
"RTN","GMPLEDT1",45,0)
 ;   NSC if there is no SC on file for patient and Problem 
"RTN","GMPLEDT1",46,0)
 ;   original SC was set to "YES"
"RTN","GMPLEDT1",47,0)
 ;
"RTN","GMPLEDT1",48,0)
 I +$G(GMPORIG(1.1))=1 D
"RTN","GMPLEDT1",49,0)
 . W !!,">>>  Currently known service-connection data for "_$P(GMPDFN,U,2)_":"
"RTN","GMPLEDT1",50,0)
 ELSE  Q:'GMPSC
"RTN","GMPLEDT1",51,0)
 S DFN=+GMPDFN D DIS^SDROUT2
"RTN","GMPLEDT1",52,0)
 I +GMPSC=0,+$G(GMPORIG(1.1))=1 D
"RTN","GMPLEDT1",53,0)
 . S DIR("A")="Patient has no service-connected condition !! "
"RTN","GMPLEDT1",54,0)
 . S DIR("B")="NO"
"RTN","GMPLEDT1",55,0)
 ELSE  D
"RTN","GMPLEDT1",56,0)
 . S DIR("A")="Is this problem related to a service-connected condition? "
"RTN","GMPLEDT1",57,0)
 . S:$L($G(GMPFLD(1.1))) DIR("B")=$P(GMPFLD(1.1),U,2) W !
"RTN","GMPLEDT1",58,0)
 S DIR("?",1)="If this problem is due to a service-connected condition, enter YES;",DIR("?")="press <return> and leave blank if this is unknown.",DIR(0)="YAO"
"RTN","GMPLEDT1",59,0)
SC1 ;   Get Service Connection
"RTN","GMPLEDT1",60,0)
 D ^DIR I $D(DTOUT)!(Y="^") S GMPQUIT=1 Q
"RTN","GMPLEDT1",61,0)
 I Y?1"^".E D JUMP^GMPLEDT3(Y) Q:$D(GMPQUIT)!($G(GMPLJUMP))  K:$G(GMPIFN) GMPLJUMP G SC1
"RTN","GMPLEDT1",62,0)
 I X="@" G:'$$SURE^GMPLX SC1 S Y=""
"RTN","GMPLEDT1",63,0)
 S GMPFLD(1.1)=Y S:Y'="" GMPFLD(1.1)=GMPFLD(1.1)_U_$S(Y:"YES",1:"NO")
"RTN","GMPLEDT1",64,0)
 Q
"RTN","GMPLEDT1",65,0)
SP ; Edit Exposures/Conditions
"RTN","GMPLEDT1",66,0)
 ;   Agent Orange - field 1.11
"RTN","GMPLEDT1",67,0)
 ;   Ionizing Radiation - field 1.12
"RTN","GMPLEDT1",68,0)
 ;   Persian Gulf/Environmental Contaminants - field 1.13
"RTN","GMPLEDT1",69,0)
 ;   Head and/or Neck Cancer - field 1.15
"RTN","GMPLEDT1",70,0)
 ;   Military Sexual Trauma - field 1.16
"RTN","GMPLEDT1",71,0)
 ;   Combat Vet - field 1.17
"RTN","GMPLEDT1",72,0)
 ;   SHAD - field 1.18
"RTN","GMPLEDT1",73,0)
 G SPEXP^GMPLEDT2
"RTN","GMPLEDT1",74,0)
 Q
"RTN","GMPLEDT1",75,0)
SOURCE ; Edit Service - field 1.06
"RTN","GMPLEDT1",76,0)
 ; or Clinic - field 1.08
"RTN","GMPLEDT1",77,0)
 N DIC,X,Y,HELPMSG,PROMPT,DEFAULT,VIEW S VIEW=$E(GMPLVIEW("VIEW"))
"RTN","GMPLEDT1",78,0)
 S DIC=$S(VIEW="S":"^DIC(49,",1:"^SC("),DIC(0)="EMQ"
"RTN","GMPLEDT1",79,0)
 S DIC("S")="I $P(^(0),U,"_$S(VIEW="S":9,1:3)_")=""C"""
"RTN","GMPLEDT1",80,0)
 I VIEW="S" S PROMPT="SERVICE: ",DEFAULT=$P(GMPFLD(1.06),U,2)
"RTN","GMPLEDT1",81,0)
 E  S PROMPT="CLINIC: ",DEFAULT=$P(GMPFLD(1.08),U,2)
"RTN","GMPLEDT1",82,0)
 S HELPMSG="Enter the clinic"_$S(VIEW="S":"al service",1:"")_" to be associated with this problem."
"RTN","GMPLEDT1",83,0)
S1 ;   Get Service/Clinic
"RTN","GMPLEDT1",84,0)
 W !,PROMPT_$S($L(DEFAULT):DEFAULT_"//",1:"")
"RTN","GMPLEDT1",85,0)
 R X:DTIME S:'$T X="^",DTOUT=1 S:X="^" GMPQUIT=1 Q:(X="^")!(X="")
"RTN","GMPLEDT1",86,0)
 I X?1"^".E D JUMP^GMPLEDT3(X) Q:$D(GMPQUIT)!($G(GMPLJUMP))  K:$G(GMPIFN) GMPLJUMP G S1
"RTN","GMPLEDT1",87,0)
 I X="?" W !!,HELPMSG,! G S1
"RTN","GMPLEDT1",88,0)
 I X["??" D @("LIST"_$S(VIEW="S":"SERV",1:"CLIN")_"^GMPLMGR1") W !,HELPMSG G S1
"RTN","GMPLEDT1",89,0)
 I X="@" G:'$$SURE^GMPLX S1 S Y="" G SQ
"RTN","GMPLEDT1",90,0)
 D ^DIC I Y'>0 W !?5,"Only clinic"_$S(VIEW="S":"al service",1:"")_"s are allowed!",! G S1
"RTN","GMPLEDT1",91,0)
SQ ;   Quit Service/Clinic
"RTN","GMPLEDT1",92,0)
 S:VIEW'="S" GMPFLD(1.08)=Y S:VIEW="S" GMPFLD(1.06)=Y
"RTN","GMPLEDT1",93,0)
 Q
"RTN","GMPLEDT1",94,0)
AUTHOR ; Edit Recording Provider - field 1.04
"RTN","GMPLEDT1",95,0)
 N X,Y,PROMPT,HELPMSG,DEFAULT S PROMPT="RECORDING PROVIDER: "
"RTN","GMPLEDT1",96,0)
 S DEFAULT=$G(GMPFLD(1.04)),HELPMSG="Enter the name of the provider responsible for the recording of this data."
"RTN","GMPLEDT1",97,0)
 D NPERSON^GMPLEDT2 Q:$D(GMPQUIT)!($G(GMPLJUMP))
"RTN","GMPLEDT1",98,0)
 S GMPFLD(1.04)=$S(+Y>0:Y,1:"")
"RTN","GMPLEDT1",99,0)
 Q
"RTN","GMPLEDT1",100,0)
PROV ; Edit Responsible Provider - field 1.05
"RTN","GMPLEDT1",101,0)
 N X,Y,PROMPT,DEFAULT,HELPMSG S DEFAULT=$G(GMPFLD(1.05))
"RTN","GMPLEDT1",102,0)
 S PROMPT="PROVIDER: ",HELPMSG="Enter the name of the local provider treating this problem."
"RTN","GMPLEDT1",103,0)
 D NPERSON^GMPLEDT2 Q:$D(GMPQUIT)!($G(GMPLJUMP))
"RTN","GMPLEDT1",104,0)
 S GMPFLD(1.05)=$S(+Y>0:Y,1:"")
"RTN","GMPLEDT1",105,0)
 Q
"RTN","GMPLEDT1",106,0)
ICD ; Edit ICD-9-CM Code - field .01
"RTN","GMPLEDT1",107,0)
 N DIC,DIR,X,Y
"RTN","GMPLEDT1",108,0)
ICD0 ;   Prompt for ICD Code
"RTN","GMPLEDT1",109,0)
 K DIR S DIR(0)="FAO^2:6",DIR("A")="ICD CODE: "
"RTN","GMPLEDT1",110,0)
 S:$P($G(GMPFLD(.01)),U,2)="799.9" DIR("A")=IORVON_"ICD CODE: "
"RTN","GMPLEDT1",111,0)
 S:+$G(GMPFLD(.01)) DIR("B")=$P(GMPFLD(.01),U,2)
"RTN","GMPLEDT1",112,0)
 S DIR("?")="Enter the ICD code to be associated with this problem"
"RTN","GMPLEDT1",113,0)
ICD1 ;   Get ICD Code
"RTN","GMPLEDT1",114,0)
 D ^DIR W IORVOFF I $D(DTOUT)!(Y="^") S GMPQUIT=1 Q
"RTN","GMPLEDT1",115,0)
 I Y?1"^".E D JUMP^GMPLEDT3(Y) Q:$D(GMPQUIT)!($G(GMPLJUMP))  K:$G(GMPIFN) GMPLJUMP G ICD1
"RTN","GMPLEDT1",116,0)
 I X="@" W !!,"ICD Code may not be deleted!",!,$C(7) G ICD1
"RTN","GMPLEDT1",117,0)
 Q:X=""  Q:$P($G(GMPFLD(.01)),U,2)=Y
"RTN","GMPLEDT1",118,0)
 S DIC=80,DIC(0)="EQM" D ^DIC G:Y'>0 ICD0
"RTN","GMPLEDT1",119,0)
 S GMPFLD(.01)=Y
"RTN","GMPLEDT1",120,0)
 Q
"RTN","GMPLEDT1",121,0)
NOTE ; Attach a note to problem - field 11
"RTN","GMPLEDT1",122,0)
 N X,Y,I,DEFAULT,PROMPT,DONE,NXT,NCNT S (I,NCNT,DONE)=0
"RTN","GMPLEDT1",123,0)
 ; added for Code Set Versioning (CSV)
"RTN","GMPLEDT1",124,0)
 I $G(GMPICD),'+$$STATCHK^ICDAPIU(GMPICD,DT) D  Q
"RTN","GMPLEDT1",125,0)
 . W !!,"This problem has an inactive ICD code. Please edit the problem before using.",! H 3
"RTN","GMPLEDT1",126,0)
 I $G(GMPIFN),'$$CODESTS^GMPLX(GMPIFN,DT) D  Q
"RTN","GMPLEDT1",127,0)
 . W !!,"This problem has an inactive ICD code. Please edit the problem before using.",! H 3
"RTN","GMPLEDT1",128,0)
 F  D  Q:$D(GMPQUIT)!($G(GMPLJUMP))!DONE
"RTN","GMPLEDT1",129,0)
 . S NXT=$O(GMPFLD(10,"NEW",I)) S:'NXT NXT=I+1
"RTN","GMPLEDT1",130,0)
 . S I=NXT,NCNT=NCNT+1
"RTN","GMPLEDT1",131,0)
 . S PROMPT=$S(NCNT=1:"",1:"ANOTHER ")_"COMMENT"_$S(NCNT=1:" (<60 char): ",1:": "),DEFAULT=$G(GMPFLD(10,"NEW",I))
"RTN","GMPLEDT1",132,0)
 . D EDNOTE^GMPLEDT4 Q:$D(GMPQUIT)!($G(GMPLJUMP))
"RTN","GMPLEDT1",133,0)
 . I X="@" K GMPFLD(10,"NEW",I) Q
"RTN","GMPLEDT1",134,0)
 . I Y="" S DONE=1 Q
"RTN","GMPLEDT1",135,0)
 . S GMPFLD(10,"NEW",I)=Y
"RTN","GMPLEDT1",136,0)
 Q
"RTN","GMPLEDT1",137,0)
TERM ; Edit Problem - field 1.01
"RTN","GMPLEDT1",138,0)
 G TERM^GMPLEDT4
"RTN","GMPLEDT1",139,0)
 Q
"RTN","GMPLEDT1",140,0)
Q ; No Editing
"RTN","GMPLEDT1",141,0)
 Q
"RTN","GMPLEDT2")
0^3^B28884081^B26618641
"RTN","GMPLEDT2",1,0)
GMPLEDT2 ; SLC/MKB/KER -- Problem List edit actions ; 04/15/2002
"RTN","GMPLEDT2",2,0)
 ;;2.0;Problem List;**26,35**;Aug 25, 1994;Build 26
"RTN","GMPLEDT2",3,0)
 ;
"RTN","GMPLEDT2",4,0)
 ; External References
"RTN","GMPLEDT2",5,0)
 ;   DBIA 10060  ^VA(200
"RTN","GMPLEDT2",6,0)
 ;   DBIA 10003  ^%DT
"RTN","GMPLEDT2",7,0)
 ;   DBIA 10006  ^DIC
"RTN","GMPLEDT2",8,0)
 ;   DBIA 10026  ^DIR
"RTN","GMPLEDT2",9,0)
 ;   DBIA 10103  $$HTFM^XLFDT
"RTN","GMPLEDT2",10,0)
 ;   DBIA 10104  $$UP^XLFSTR
"RTN","GMPLEDT2",11,0)
 ;                   
"RTN","GMPLEDT2",12,0)
EDITED() ; Returns 1 if problem has been altered
"RTN","GMPLEDT2",13,0)
 N FLD,NOTE,DIFFRENT S DIFFRENT=0
"RTN","GMPLEDT2",14,0)
 F FLD=0:0 S FLD=$O(GMPORIG(FLD)) Q:(FLD'>0)!(FLD'<10)  I GMPORIG(FLD)'=GMPFLD(FLD) S DIFFRENT=1 Q
"RTN","GMPLEDT2",15,0)
 G:DIFFRENT EDQ
"RTN","GMPLEDT2",16,0)
 I $D(GMPFLD(10,"NEW"))>9 S DIFFRENT=1 G EDQ
"RTN","GMPLEDT2",17,0)
 F NOTE=0:0 S NOTE=$O(GMPORIG(10,NOTE)) Q:NOTE'>0  I $P(GMPORIG(10,NOTE),U,3)'=$P(GMPFLD(10,NOTE),U,3) S DIFFRENT=1 Q
"RTN","GMPLEDT2",18,0)
EDQ Q DIFFRENT
"RTN","GMPLEDT2",19,0)
 ;
"RTN","GMPLEDT2",20,0)
SUREDEL(NUM) ; -- sure you want to delete problems?
"RTN","GMPLEDT2",21,0)
 N DIR,X,Y
"RTN","GMPLEDT2",22,0)
 W !!,"CAUTION:  "_$S(NUM=1:"This problem",1:"These "_NUM_" problems")_" will be completely removed",!,"          from this patient's list!!",!
"RTN","GMPLEDT2",23,0)
 S DIR(0)="YA",DIR("A")="Are you sure? ",DIR("B")="NO"
"RTN","GMPLEDT2",24,0)
 S DIR("?",1)="Enter YES to delete "_$S(NUM=1:"this problem",1:"these problems")_" from the current patient's list."
"RTN","GMPLEDT2",25,0)
 S DIR("?",2)="DO NOT use this option to remove problems from your currently"
"RTN","GMPLEDT2",26,0)
 S DIR("?")="displayed view of the Problem List!!"
"RTN","GMPLEDT2",27,0)
 W $C(7) D ^DIR
"RTN","GMPLEDT2",28,0)
 Q +Y
"RTN","GMPLEDT2",29,0)
 ;
"RTN","GMPLEDT2",30,0)
DELETE ; Remove current problem from patient's list
"RTN","GMPLEDT2",31,0)
 N CHNGE S VALMBCK=$S(VALMCC:"",1:"R") Q:'$$SUREDEL(1)
"RTN","GMPLEDT2",32,0)
 S CHNGE=GMPIFN_"^1.02^"_$$HTFM^XLFDT($H)_U_DUZ_"^P^H^Deleted^"_+$G(GMPROV) W "."
"RTN","GMPLEDT2",33,0)
 S $P(^AUPNPROB(GMPIFN,1),U,2)="H",GMPSAVED=1,VALMBCK="Q" W "."
"RTN","GMPLEDT2",34,0)
 D AUDIT^GMPLX(CHNGE,""),DTMOD^GMPLX(GMPIFN) W "."
"RTN","GMPLEDT2",35,0)
 W "... removed!",!!,"Returning to Problem List.",! H 1
"RTN","GMPLEDT2",36,0)
 Q
"RTN","GMPLEDT2",37,0)
 ;
"RTN","GMPLEDT2",38,0)
VERIFY ; Mark current problem as verified
"RTN","GMPLEDT2",39,0)
 I GMPFLD(1.02)'="T" W $C(7),!!,"This problem does not require verification.",! H 1 Q
"RTN","GMPLEDT2",40,0)
 S GMPFLD(1.02)="P" W !,"."
"RTN","GMPLEDT2",41,0)
 W "... verified!" H 1
"RTN","GMPLEDT2",42,0)
 Q
"RTN","GMPLEDT2",43,0)
 ;
"RTN","GMPLEDT2",44,0)
NPERSON ; look up into #200, given PROMPT,HELPMSG,DEFAULT (returns X, Y)
"RTN","GMPLEDT2",45,0)
 N DIC
"RTN","GMPLEDT2",46,0)
NP W !,PROMPT_$S(+DEFAULT:$P(DEFAULT,U,2)_"//",1:"")
"RTN","GMPLEDT2",47,0)
 R X:DTIME S:'$T DTOUT=1 I $D(DTOUT)!(X="^") S GMPQUIT=1 Q
"RTN","GMPLEDT2",48,0)
 I X?1"^".E D JUMP^GMPLEDT3(X) Q:$D(GMPQUIT)!($G(GMPLJUMP))  K:$G(GMPIFN) GMPLJUMP G NP
"RTN","GMPLEDT2",49,0)
 I X="" S Y=DEFAULT Q
"RTN","GMPLEDT2",50,0)
 I X="@" G:'$$SURE^GMPLX NP S Y="" Q
"RTN","GMPLEDT2",51,0)
 I X="?" W !!,HELPMSG,! G NP
"RTN","GMPLEDT2",52,0)
 I X["??" D NPHELP G NP
"RTN","GMPLEDT2",53,0)
 S DIC="^VA(200,",DIC(0)="EMQ" D ^DIC
"RTN","GMPLEDT2",54,0)
 I Y'>0 W !!,HELPMSG,!,$C(7) G NP
"RTN","GMPLEDT2",55,0)
 Q
"RTN","GMPLEDT2",56,0)
 ;
"RTN","GMPLEDT2",57,0)
NPHELP ; List names in New Person file
"RTN","GMPLEDT2",58,0)
 N NM,CNT,I,Y S CNT=0,(NM,Y)="" W !,"Choose from: "
"RTN","GMPLEDT2",59,0)
 F  S NM=$O(^VA(200,"B",NM)) Q:NM=""  D  Q:Y'=""
"RTN","GMPLEDT2",60,0)
 . S CNT=CNT+1 I '(CNT#9) D  Q:Y="^"
"RTN","GMPLEDT2",61,0)
 . . W "      ... more, or ^ to stop: " R Y:DTIME S:'$T Y="^"
"RTN","GMPLEDT2",62,0)
 . S I=$O(^VA(200,"B",NM,0)) W !,"   "_$P($G(^VA(200,I,0)),U)
"RTN","GMPLEDT2",63,0)
 W !
"RTN","GMPLEDT2",64,0)
 Q
"RTN","GMPLEDT2",65,0)
 ;
"RTN","GMPLEDT2",66,0)
DATE ; Edit date fields given PROMPT,HELPMSG,DEFAULT (ret'ns X,Y)
"RTN","GMPLEDT2",67,0)
 N %DT S %DT="EP"
"RTN","GMPLEDT2",68,0)
D1 W !,PROMPT_$S(+DEFAULT:$P(DEFAULT,U,2)_"//",1:"")
"RTN","GMPLEDT2",69,0)
 R X:DTIME S:'$T DTOUT=1 I $D(DTOUT)!(X="^") S GMPQUIT=1 Q
"RTN","GMPLEDT2",70,0)
 I X?1"^".E D JUMP^GMPLEDT3(X) Q:$D(GMPQUIT)!($G(GMPLJUMP))  K:$G(GMPIFN) GMPLJUMP G D1
"RTN","GMPLEDT2",71,0)
 I X="" S Y=DEFAULT Q
"RTN","GMPLEDT2",72,0)
 I X="@" G:'$$SURE^GMPLX D1 S Y="" Q
"RTN","GMPLEDT2",73,0)
 I X="?" W !!,HELPMSG,! G D1
"RTN","GMPLEDT2",74,0)
 I X["??" D DTHELP G D1
"RTN","GMPLEDT2",75,0)
 D ^%DT I Y<1 W "  INVALID DATE" D DTHELP W !,HELPMSG G D1
"RTN","GMPLEDT2",76,0)
 I Y>DT W !!,"Date cannot be in the future!",!,$C(7) G D1
"RTN","GMPLEDT2",77,0)
 Q
"RTN","GMPLEDT2",78,0)
 ;
"RTN","GMPLEDT2",79,0)
DTHELP ; Date help
"RTN","GMPLEDT2",80,0)
 W !!,"Examples of valid dates:"
"RTN","GMPLEDT2",81,0)
 W !,"   Jan 20 1957 or 20 Jan 57 or 1/20/57 or 012057"
"RTN","GMPLEDT2",82,0)
 W !,"   T   (for TODAY),  T-1 (for YESTERDAY),  T-3W (for 3 WEEKS AGO), etc."
"RTN","GMPLEDT2",83,0)
 W !,"You may omit the precise day, such as Jan 1957, or"
"RTN","GMPLEDT2",84,0)
 W !,"If the year is omitted, a date in the PAST will be assumed.",!
"RTN","GMPLEDT2",85,0)
 Q
"RTN","GMPLEDT2",86,0)
 ;
"RTN","GMPLEDT2",87,0)
SPEXP ; Edit Fields 1.11, 1.12, 1.13, 1.15, 1.16, 1.17, 1.18
"RTN","GMPLEDT2",88,0)
 D:GMPAGTOR SP(1.11,"Agent Orange") Q:$D(GMPQUIT)!($G(GMPLJUMP))
"RTN","GMPLEDT2",89,0)
 S:$G(GMPFLD(1.11)) $P(GMPFLD(1.11),U,2)="AGENT ORANGE"
"RTN","GMPLEDT2",90,0)
 D:GMPION SP(1.12,"Radiation") Q:$D(GMPQUIT)!($G(GMPLJUMP))
"RTN","GMPLEDT2",91,0)
 S:$G(GMPFLD(1.12)) $P(GMPFLD(1.12),U,2)="RADIATION"
"RTN","GMPLEDT2",92,0)
 D:GMPGULF SP(1.13,"Environmental Contaminants") Q:$D(GMPQUIT)!($G(GMPLJUMP))
"RTN","GMPLEDT2",93,0)
 S:$G(GMPFLD(1.13)) $P(GMPFLD(1.13),U,2)="ENV CONTAMINANTS"
"RTN","GMPLEDT2",94,0)
 D:GMPHNC SP(1.15,"Head and/or Neck Cancer") Q:$D(GMPQUIT)!($G(GMPLJUMP))
"RTN","GMPLEDT2",95,0)
 S:$G(GMPFLD(1.15)) $P(GMPFLD(1.15),U,2)="HEAD/NECK CANCER"
"RTN","GMPLEDT2",96,0)
 D:GMPMST SP(1.16,"Military Sexual Trauma") Q:$D(GMPQUIT)!($G(GMPLJUMP))
"RTN","GMPLEDT2",97,0)
 S:$G(GMPFLD(1.16)) $P(GMPFLD(1.16),U,2)="MIL SEXUAL TRAUMA"
"RTN","GMPLEDT2",98,0)
 D:GMPCV SP(1.17,"Combat Veteran") Q:$D(GMPQUIT)!($G(GMPLJUMP))
"RTN","GMPLEDT2",99,0)
 S:$G(GMPFLD(1.17)) $P(GMPFLD(1.17),U,2)="COMBAT VET"
"RTN","GMPLEDT2",100,0)
 D:GMPSHD SP(1.18,"Shipboard Hazard and Defense") Q:$D(GMPQUIT)!($G(GMPLJUMP))
"RTN","GMPLEDT2",101,0)
 S:$G(GMPFLD(1.18)) $P(GMPFLD(1.18),U,2)="SHAD"
"RTN","GMPLEDT2",102,0)
 Q
"RTN","GMPLEDT2",103,0)
SP(FLD,NAME) ; edit exposure fields -- Requires FLD number & field NAME
"RTN","GMPLEDT2",104,0)
 N DIR,X,Y,GMPLN S DIR(0)="YAO",GMPLN=$$UP^XLFSTR(NAME)
"RTN","GMPLEDT2",105,0)
 S DIR("A")="Is this problem related to "_GMPLN
"RTN","GMPLEDT2",106,0)
 S:GMPLN'["SEXUAL"&(GMPLN'["CANCER") DIR("A")=DIR("A")_" EXPOSURE" S DIR("A")=DIR("A")_"? "
"RTN","GMPLEDT2",107,0)
 S DIR("?",1)="Enter YES if this problem is related in some way to the patient's"
"RTN","GMPLEDT2",108,0)
 S DIR("?")="diagnosed "_NAME_"." S:GMPLN["SEXUAL" DIR("?")="reported "_NAME_"." S:GMPLN'["SEXUAL"&(GMPLN'["CANCER") DIR("?")="exposure to "_NAME_"."
"RTN","GMPLEDT2",109,0)
 S:$L($G(GMPFLD(FLD))) DIR("B")=$S(+GMPFLD(FLD):"YES",1:"NO")
"RTN","GMPLEDT2",110,0)
SP1 D ^DIR I $D(DTOUT)!(Y="^") S GMPQUIT=1 Q
"RTN","GMPLEDT2",111,0)
 I Y?1"^".E D JUMP^GMPLEDT3(Y) Q:$D(GMPQUIT)!($G(GMPLJUMP))  K:$G(GMPIFN) GMPLJUMP G SP1
"RTN","GMPLEDT2",112,0)
 I X="@" G:'$$SURE^GMPLX SP1 S Y=""
"RTN","GMPLEDT2",113,0)
 S GMPFLD(FLD)=Y S:Y'="" GMPFLD(FLD)=GMPFLD(FLD)_U_$S(Y:"YES",1:"NO")
"RTN","GMPLEDT2",114,0)
 Q
"RTN","GMPLEDT3")
0^2^B27556139^B25232452
"RTN","GMPLEDT3",1,0)
GMPLEDT3 ; SLC/MKB/KER -- Problem List edit utilities ; 04/15/2002
"RTN","GMPLEDT3",2,0)
 ;;2.0;Problem List;**26,35**;Aug 25, 1994;Build 26
"RTN","GMPLEDT3",3,0)
 ;
"RTN","GMPLEDT3",4,0)
 ; External References
"RTN","GMPLEDT3",5,0)
 ;   DBIA   872  ^ORD(101
"RTN","GMPLEDT3",6,0)
 ;   DBIA 10026  ^XUSEC("GMPL ICD CODE"
"RTN","GMPLEDT3",7,0)
 ;   DBIA 10015  EN^DIQ1
"RTN","GMPLEDT3",8,0)
 ;   DBIA 10026  ^DIR
"RTN","GMPLEDT3",9,0)
 ;   DBIA 10104  $$UP^XLFSTR
"RTN","GMPLEDT3",10,0)
 ;                     
"RTN","GMPLEDT3",11,0)
MSG() ; List Manager Message Bar
"RTN","GMPLEDT3",12,0)
 Q "Enter the number of the item(s) you wish to change"
"RTN","GMPLEDT3",13,0)
 ;
"RTN","GMPLEDT3",14,0)
KEYS ; Setup XQORM("KEY") array
"RTN","GMPLEDT3",15,0)
 ;   Numbers ref'd also in IN4^-EDIT, NTES^-EDT4
"RTN","GMPLEDT3",16,0)
 N I,PROTCL,NUM,ICD
"RTN","GMPLEDT3",17,0)
 S ICD=$S($D(^XUSEC("GMPL ICD CODE",DUZ)):1,1:0)
"RTN","GMPLEDT3",18,0)
 S XQORM("KEY","1")=$O(^ORD(101,"B","GMPL EDIT REFORMULATE",0))_"^1"
"RTN","GMPLEDT3",19,0)
 S XQORM("KEY","2")=$O(^ORD(101,"B","GMPL EDIT ONSET",0))_"^1"
"RTN","GMPLEDT3",20,0)
 S XQORM("KEY","3")=$O(^ORD(101,"B","GMPL EDIT STATUS",0))_"^1"
"RTN","GMPLEDT3",21,0)
 S XQORM("KEY","4")=$O(^ORD(101,"B","GMPL EDIT PROVIDER",0))_"^1"
"RTN","GMPLEDT3",22,0)
 S XQORM("KEY","5")=$O(^ORD(101,"B","GMPL EDIT SERVICE",0))_"^1",NUM=5
"RTN","GMPLEDT3",23,0)
 S:ICD XQORM("KEY","6")=$O(^ORD(101,"B","GMPL EDIT ICD",0))_"^1",NUM=6
"RTN","GMPLEDT3",24,0)
 I GMPVA D
"RTN","GMPLEDT3",25,0)
 . S NUM=NUM+1,XQORM("KEY",NUM)=$O(^ORD(101,"B","GMPL EDIT SC",0))_"^1"
"RTN","GMPLEDT3",26,0)
 . S NUM=NUM+1,XQORM("KEY",NUM)=$O(^ORD(101,"B","GMPL EDIT SP",0))_"^1"
"RTN","GMPLEDT3",27,0)
 S PROTCL=$O(^ORD(101,"B","GMPL EDIT NOTES",0))_"^1"
"RTN","GMPLEDT3",28,0)
 I GMPFLD(10,0) F I=1:1:GMPFLD(10,0) S NUM=NUM+1,XQORM("KEY",NUM)=PROTCL
"RTN","GMPLEDT3",29,0)
 S XQORM("KEY",NUM+1)=$O(^ORD(101,"B","GMPL EDIT NEW NOTE",0))_"^1"
"RTN","GMPLEDT3",30,0)
 S:$G(GMPARAM("VER"))&$D(GMPLUSER) XQORM("KEY","$")=$O(^ORD(101,"B","GMPL EDIT VERIFY",0))_"^1"
"RTN","GMPLEDT3",31,0)
 S XQORM("KEY","=")=$O(^ORD(101,"B","VALM NEXT SCREEN",0))_"^1"
"RTN","GMPLEDT3",32,0)
 S VALMSG=$$MSG
"RTN","GMPLEDT3",33,0)
 Q
"RTN","GMPLEDT3",34,0)
 ;
"RTN","GMPLEDT3",35,0)
GETFLDS(DA) ; Define GMPFLD(#) and GMPORIG(#) Arrays with Current Values
"RTN","GMPLEDT3",36,0)
 N DIC,DIQ,DR,I,GMPL,CNT,NIFN,FAC,EXT
"RTN","GMPLEDT3",37,0)
 S DIC="^AUPNPROB(",DIQ="GMPL",DIQ(0)="IE"
"RTN","GMPLEDT3",38,0)
 S DR=".01;.03;.05;.08:1.02;1.05:1.18" D EN^DIQ1
"RTN","GMPLEDT3",39,0)
 F I=.01,.03,.05,.08,.12,.13,1.01,1.02,1.05,1.06,1.07,1.08,1.09,1.1,1.11,1.12,1.13,1.14,1.15,1.16,1.17,1.18 D
"RTN","GMPLEDT3",40,0)
 . S GMPORIG(I)=$G(GMPL(9000011,DA,I,"I")),EXT=""
"RTN","GMPLEDT3",41,0)
 . I I=1.01,GMPL(9000011,DA,I,"I")'>1 S GMPORIG(I)="" Q
"RTN","GMPLEDT3",42,0)
 . Q:(GMPORIG(I)="")!(I=1.02)
"RTN","GMPLEDT3",43,0)
 . I "^.01^.05^.12^1.01^1.05^1.06^1.08^1.1^1.14^"[(U_I_U) S EXT=GMPL(9000011,DA,I,"E")
"RTN","GMPLEDT3",44,0)
 . I "^.03^.08^.13^1.07^1.09^"[(U_I_U) S EXT=$$EXTDT^GMPLX(GMPORIG(I))
"RTN","GMPLEDT3",45,0)
 . I "^1.11^1.12^1.13^"[(U_I_U) S EXT=$S(I=1.11:"AGENT ORANGE",I=1.12:"RADIATION",1:"ENV CONTAMINANTS")
"RTN","GMPLEDT3",46,0)
 . I "^1.15^1.16^1.17^1.18^"[(U_I_U) S EXT=$S(I=1.15:"HEAD/NECK CANCER",1=1.16:"MIL SEXUAL TRAUMA",1=1.17:"COMBAT VET",1:"SHAD")
"RTN","GMPLEDT3",47,0)
 . S GMPORIG(I)=GMPORIG(I)_U_EXT
"RTN","GMPLEDT3",48,0)
 S I=0 F  S I=$O(GMPORIG(I)) Q:I'>0  S GMPFLD(I)=GMPORIG(I)
"RTN","GMPLEDT3",49,0)
 S (CNT,GMPORIG(10,0),GMPFLD(10,0))=0
"RTN","GMPLEDT3",50,0)
 S FAC=$O(^AUPNPROB(DA,11,"B",+GMPVAMC,0)) Q:'FAC
"RTN","GMPLEDT3",51,0)
 F NIFN=0:0 S NIFN=$O(^AUPNPROB(DA,11,FAC,11,"B",NIFN)) Q:NIFN'>0  D
"RTN","GMPLEDT3",52,0)
 . I '$D(GMPLMGR),$P($G(^AUPNPROB(DA,11,FAC,11,NIFN,0)),U,6)'=+GMPROV Q
"RTN","GMPLEDT3",53,0)
 . S CNT=CNT+1,GMPORIG(10,CNT)=$G(^AUPNPROB(DA,11,FAC,11,NIFN,0))
"RTN","GMPLEDT3",54,0)
 . S $P(GMPORIG(10,CNT),U,2)=FAC
"RTN","GMPLEDT3",55,0)
 . S GMPFLD(10,CNT)=GMPORIG(10,CNT)
"RTN","GMPLEDT3",56,0)
 S (GMPORIG(10,0),GMPFLD(10,0))=CNT
"RTN","GMPLEDT3",57,0)
 Q
"RTN","GMPLEDT3",58,0)
 ;
"RTN","GMPLEDT3",59,0)
FLDS ; Define GMPFLD("FLD") Array for Editing
"RTN","GMPLEDT3",60,0)
 S (GMPFLD("FLD",2),GMPFLD("FLD",6),GMPFLD("FLD",7))="Q"
"RTN","GMPLEDT3",61,0)
 S GMPFLD("FLD",1)="TERM",GMPFLD("FLD","PROBLEM")=1
"RTN","GMPLEDT3",62,0)
 S:$D(^XUSEC("GMPL ICD CODE",DUZ)) GMPFLD("FLD",2)="ICD",GMPFLD("FLD","ICD CODE")=2
"RTN","GMPLEDT3",63,0)
 S GMPFLD("FLD",3)="NOTE",GMPFLD("FLD","COMMENT")=3
"RTN","GMPLEDT3",64,0)
 S GMPFLD("FLD",4)="ONSET",GMPFLD("FLD","DATE OF ONSET")=4
"RTN","GMPLEDT3",65,0)
 S GMPFLD("FLD",5)="STATUS",GMPFLD("FLD","STATUS")=5
"RTN","GMPLEDT3",66,0)
 S:GMPSC GMPFLD("FLD",6)="SC",GMPFLD("FLD","IS THIS PROBLEM RELATED TO A SERVICE-CONNECTED CONDITION?")=6
"RTN","GMPLEDT3",67,0)
 S:GMPAGTOR GMPFLD("FLD",7)="SP",GMPFLD("FLD","IS THIS PROBLEM RELATED TO AGENT ORANGE EXPOSURE?")=7
"RTN","GMPLEDT3",68,0)
 S:GMPION GMPFLD("FLD",7)="SP",GMPFLD("FLD","IS THIS PROBLEM RELATED TO RADIATION EXPOSURE?")=7
"RTN","GMPLEDT3",69,0)
 S:GMPGULF GMPFLD("FLD",7)="SP",GMPFLD("FLD","IS THIS PROBLEM RELATED TO ENVIRONMENTAL CONTAMINANTS EXPOSURE?")=7
"RTN","GMPLEDT3",70,0)
 S:GMPHNC GMPFLD("FLD",7)="SP",GMPFLD("FLD","IS THIS PROBLEM RELATED TO DIAGNOSED HEAD AND/OR NECK CANCER?")=7
"RTN","GMPLEDT3",71,0)
 S:GMPMST GMPFLD("FLD",7)="SP",GMPFLD("FLD","IS THIS PROBLEM RELATED TO REPORTED MILITARY SEXUAL TRAUMA?")=7
"RTN","GMPLEDT3",72,0)
 S:GMPCV GMPFLD("FLD",7)="SP",GMPFLD("FLD","IS THIS PROBLEM RELATED TO REPORTED COMBAT VET?")=7
"RTN","GMPLEDT3",73,0)
 S:GMPSHD GMPFLD("FLD",7)="SP",GMPFLD("FLD","IS THIS PROBLEM RELATED TO REPORTED SHIPBOARD HAZARD AND DEFENSE?")=7
"RTN","GMPLEDT3",74,0)
 S GMPFLD("FLD",8)="PROV",GMPFLD("FLD","RESPONSIBLE PROVIDER")=8
"RTN","GMPLEDT3",75,0)
 S GMPFLD("FLD",9)="SOURCE"
"RTN","GMPLEDT3",76,0)
 S:$E(GMPLVIEW("VIEW"))="C" GMPFLD("FLD","CLINIC")=9
"RTN","GMPLEDT3",77,0)
 S:$E(GMPLVIEW("VIEW"))'="C" GMPFLD("FLD","SERVICE")=9
"RTN","GMPLEDT3",78,0)
 S GMPFLD("FLD",10)="RECORDED",GMPFLD("FLD","DATE RECORDED")=10
"RTN","GMPLEDT3",79,0)
 S GMPFLD("FLD",11)="AUTHOR",GMPFLD("FLD","RECORDING PROVIDER")=11
"RTN","GMPLEDT3",80,0)
 S GMPFLD("FLD",0)=11
"RTN","GMPLEDT3",81,0)
 Q
"RTN","GMPLEDT3",82,0)
 ;
"RTN","GMPLEDT3",83,0)
JUMP(XFLD) ; Resolve ^- Jump Out of Field Order in Edit
"RTN","GMPLEDT3",84,0)
 N I,MATCH,CNT,PROMPT,DIR,X,Y
"RTN","GMPLEDT3",85,0)
 ;   Passed in as ^XXX
"RTN","GMPLEDT3",86,0)
 S XFLD=$$UP^XLFSTR($P(XFLD,U,2))
"RTN","GMPLEDT3",87,0)
 I (XFLD="")!(XFLD["^") S GMPQUIT=1 Q
"RTN","GMPLEDT3",88,0)
 I '$D(GMPLJUMP) W $C(7),"  ^-jumping not allowed now!" S GMPLJUMP=0 Q
"RTN","GMPLEDT3",89,0)
 ;   Field is Exact
"RTN","GMPLEDT3",90,0)
 I $G(GMPFLD("FLD",XFLD)) S GMPLJUMP=GMPFLD("FLD",XFLD) Q
"RTN","GMPLEDT3",91,0)
 S CNT=0,PROMPT=" "
"RTN","GMPLEDT3",92,0)
 F  S PROMPT=$O(GMPFLD("FLD",PROMPT)) Q:PROMPT=""  D
"RTN","GMPLEDT3",93,0)
 . Q:$E(PROMPT,1,$L(XFLD))'=XFLD
"RTN","GMPLEDT3",94,0)
 . S CNT=CNT+1,MATCH(CNT)=GMPFLD("FLD",PROMPT)_U_PROMPT
"RTN","GMPLEDT3",95,0)
 I CNT=0 W $C(7),"  ??" Q
"RTN","GMPLEDT3",96,0)
 I CNT=1 S PROMPT=$P(MATCH(1),U,2),GMPLJUMP=+MATCH(1) W $E(PROMPT,$L(XFLD)+1,$L(PROMPT)) Q
"RTN","GMPLEDT3",97,0)
 ;   Select which Field to Jump To.
"RTN","GMPLEDT3",98,0)
 F I=1:1:CNT S DIR("A",I)=I_"  "_$P(MATCH(I),U,2)
"RTN","GMPLEDT3",99,0)
 S DIR("A")="Select 1-"_CNT_": ",DIR(0)="NAO^1:"_CNT
"RTN","GMPLEDT3",100,0)
 S DIR("?")="Select the field you wish to jump to, by number"
"RTN","GMPLEDT3",101,0)
 D ^DIR I $D(DTOUT)!($D(DUOUT))!(Y="") Q
"RTN","GMPLEDT3",102,0)
 S GMPLJUMP=+MATCH(+Y)
"RTN","GMPLEDT3",103,0)
 Q
"RTN","GMPLEDT3",104,0)
 ;
"RTN","GMPLEDT3",105,0)
CK ; Check whether to Stop Processing
"RTN","GMPLEDT3",106,0)
 ;   Called from Exit Action of GMPL EDIT XXX Protocols
"RTN","GMPLEDT3",107,0)
 S:$D(GMPQUIT) XQORPOP=1 S:'$D(GMPQUIT) GMPREBLD=1 K GMPQUIT
"RTN","GMPLEDT3",108,0)
 I $D(DTOUT)!($G(VALMBCK)="Q") S VALMBCK="Q" Q
"RTN","GMPLEDT3",109,0)
 S VALMBCK="R",VALMSG=$$MSG
"RTN","GMPLEDT3",110,0)
 Q
"RTN","GMPLENFM")
0^13^B21546471^B16551386
"RTN","GMPLENFM",1,0)
GMPLENFM ; SLC/MKB/KER -- Problem List Enc Form utilities ; 04/15/2002
"RTN","GMPLENFM",2,0)
 ;;2.0;Problem List;**3,4,7,26,35**;Aug 25, 1994;Build 26
"RTN","GMPLENFM",3,0)
 ;
"RTN","GMPLENFM",4,0)
 ; External References
"RTN","GMPLENFM",5,0)
 ;   DBIA 10082  ^ICD9(
"RTN","GMPLENFM",6,0)
 ;   DBIA 10006  ^DIC
"RTN","GMPLENFM",7,0)
 ;   DBIA  1609  CONFIG^LEXSET
"RTN","GMPLENFM",8,0)
 ;                    
"RTN","GMPLENFM",9,0)
ACTIVE ; List of Active Problems for DFN
"RTN","GMPLENFM",10,0)
 ;   Sets Global Array:                   
"RTN","GMPLENFM",11,0)
 ;   ^TMP("IB",$J,"INTERFACES",DFN,"GMP PATIENT ACTIVE PROBLEMS",#) =
"RTN","GMPLENFM",12,0)
 ;                      
"RTN","GMPLENFM",13,0)
 ;   Piece 1:  Problem text
"RTN","GMPLENFM",14,0)
 ;         2:  ICD code
"RTN","GMPLENFM",15,0)
 ;         3:  Date of Onset     00/00/00 format
"RTN","GMPLENFM",16,0)
 ;         4:  SC/NSC/""         serv-conn/not sc/unknown
"RTN","GMPLENFM",17,0)
 ;         5:  Y/N/""            serv-conn/not sc/unknown
"RTN","GMPLENFM",18,0)
 ;         6:  A/I/E/H/M/C/S/""      If problem is flagged as:
"RTN","GMPLENFM",19,0)
 ;                               A - Agent Orange
"RTN","GMPLENFM",20,0)
 ;                               I - Ionizing Radiation
"RTN","GMPLENFM",21,0)
 ;                               E - Environmental Contaminants
"RTN","GMPLENFM",22,0)
 ;                               H - Head/Neck Cancer
"RTN","GMPLENFM",23,0)
 ;                               M - Mil Sexual Trauma
"RTN","GMPLENFM",24,0)
 ;                               C - Combat Vet
"RTN","GMPLENFM",25,0)
 ;                               S - SHAD
"RTN","GMPLENFM",26,0)
 ;                                 - None
"RTN","GMPLENFM",27,0)
 ;         7:  Special Exposure  Full text of piece 6
"RTN","GMPLENFM",28,0)
 ;                    
"RTN","GMPLENFM",29,0)
 N IFN,PROB,CNT,GMPL0,GMPL1,SC,NUM,GMPLIST,GMPARAM,GMPLVIEW,GMPTOTAL
"RTN","GMPLENFM",30,0)
 N GMPDFN,NODE
"RTN","GMPLENFM",31,0)
 Q:$G(DFN)'>0  S GMPDFN=DFN,CNT=0,NODE=$G(^GMPL(125.99,1,0))
"RTN","GMPLENFM",32,0)
 S GMPARAM("VER")=$P(NODE,U,2),GMPARAM("REV")=$P(NODE,U,5)="R",GMPARAM("QUIET")=1
"RTN","GMPLENFM",33,0)
 S GMPLVIEW("ACT")="A",GMPLVIEW("PROV")=0,GMPLVIEW("VIEW")=""
"RTN","GMPLENFM",34,0)
 D GETPLIST^GMPLMGR1(.GMPLIST,.GMPTOTAL,.GMPLVIEW)
"RTN","GMPLENFM",35,0)
 F NUM=0:0 S NUM=$O(GMPLIST(NUM)) Q:NUM'>0  D
"RTN","GMPLENFM",36,0)
 . S IFN=GMPLIST(NUM) Q:IFN'>0
"RTN","GMPLENFM",37,0)
 . S GMPL0=$G(^AUPNPROB(IFN,0)),GMPL1=$G(^(1))
"RTN","GMPLENFM",38,0)
 . S PROB=$$PROBTEXT^GMPLX(IFN),CNT=CNT+1
"RTN","GMPLENFM",39,0)
 . I GMPARAM("VER"),$P(GMPL1,U,2)="T" S PROB="$"_PROB
"RTN","GMPLENFM",40,0)
 . S PROB=PROB_U_$P($G(^ICD9(+$P(GMPL0,U),0)),U)
"RTN","GMPLENFM",41,0)
 . S PROB=PROB_U_$$EXTDT^GMPLX($P(GMPL0,U,13)),SC=$P(GMPL1,U,10)
"RTN","GMPLENFM",42,0)
 . S PROB=PROB_U_$S(+SC:"SC^Y",SC=0:"NSC^N",1:"^")
"RTN","GMPLENFM",43,0)
 . S PROB=PROB_U_$$GMPL1
"RTN","GMPLENFM",44,0)
 . ;S PROB=PROB_U_$S($P(GMPL1,U,11):"A^Agent Orange",$P(GMPL1,U,12):"I^Ionizing Radiation",$P(GMPL1,U,13):"E^Env. Contaminants"
"RTN","GMPLENFM",45,0)
 . ;,$P(GMPL1,U,13):"H^Head/Neck Cancer",$P(GMPL1,U,16):"M^Mil Sexual Trauma",$P(GMPL1,U,17):"C^Combat Vet",$P(GMPL1,U,18):"S^SHAD",1:"^")
"RTN","GMPLENFM",46,0)
 . S ^TMP("IB",$J,"INTERFACES",+$G(DFN),"GMP PATIENT ACTIVE PROBLEMS",CNT)=PROB
"RTN","GMPLENFM",47,0)
 S ^TMP("IB",$J,"INTERFACES",+$G(DFN),"GMP PATIENT ACTIVE PROBLEMS",0)=CNT
"RTN","GMPLENFM",48,0)
 Q
"RTN","GMPLENFM",49,0)
 ;
"RTN","GMPLENFM",50,0)
SELECT ; Select Common Problems
"RTN","GMPLENFM",51,0)
 ;   Sets Global Array:
"RTN","GMPLENFM",52,0)
 ;   ^TMP("IB",$J,"INTERFACES","GMP SELECT CLINIC COMMON PROBLEMS")
"RTN","GMPLENFM",53,0)
 ;   Piece 1:  Pointer to Clinical Lexicon
"RTN","GMPLENFM",54,0)
 ;         2:  Problem Text
"RTN","GMPLENFM",55,0)
 ;         3:  ICD Code (null if unknown)
"RTN","GMPLENFM",56,0)
 ;            
"RTN","GMPLENFM",57,0)
 N X,Y,DIC,PROB D CONFIG^LEXSET("ICD","ICD")
"RTN","GMPLENFM",58,0)
 K ^TMP("IB",$J,"INTERFACES","GMP SELECT CLINIC COMMON PROBLEMS")
"RTN","GMPLENFM",59,0)
 S DIC("A")="Select PROBLEM: ",DIC(0)="AEQM",DIC="^LEX(757.01,"
"RTN","GMPLENFM",60,0)
 D ^DIC Q:+Y<0  S PROB=Y I +Y'>1 S PROB=+Y_U_X
"RTN","GMPLENFM",61,0)
 S PROB=PROB_U_$G(Y(1))
"RTN","GMPLENFM",62,0)
 S ^TMP("IB",$J,"INTERFACES","GMP SELECT CLINIC COMMON PROBLEMS")=PROB
"RTN","GMPLENFM",63,0)
 Q
"RTN","GMPLENFM",64,0)
 ;
"RTN","GMPLENFM",65,0)
DSELECT ; List of Active Problems for DFN
"RTN","GMPLENFM",66,0)
 ;   Sets Global Array"
"RTN","GMPLENFM",67,0)
 ;   ^TMP("IB",$J,"INTERFACES","GMP SELECT PATIENT ACTIVE PROBLEMS",#) =
"RTN","GMPLENFM",68,0)
 ;            
"RTN","GMPLENFM",69,0)
 ;   Piece 1:  Problem IEN
"RTN","GMPLENFM",70,0)
 ;         2:  Problem Text
"RTN","GMPLENFM",71,0)
 ;         3:  ICD code
"RTN","GMPLENFM",72,0)
 ;         4:  Date of Onset     00/00/00 format
"RTN","GMPLENFM",73,0)
 ;         5:  SC/NSC/""         serv-conn/not sc/unknown
"RTN","GMPLENFM",74,0)
 ;         6:  Y/N/""            serv-conn/not sc/unknown
"RTN","GMPLENFM",75,0)
 ;         7:  A/I/E/H/M/C/S/""      If problem is flagged as:
"RTN","GMPLENFM",76,0)
 ;                               A - Agent Orange
"RTN","GMPLENFM",77,0)
 ;                               I - Ionizing Radiation
"RTN","GMPLENFM",78,0)
 ;                               E - Environmental Contaminants
"RTN","GMPLENFM",79,0)
 ;                               H - Head/Neck Cancer
"RTN","GMPLENFM",80,0)
 ;                               M - Mil Sexual Trauma
"RTN","GMPLENFM",81,0)
 ;                               C - Combat Vet
"RTN","GMPLENFM",82,0)
 ;                               S - SHAD
"RTN","GMPLENFM",83,0)
 ;                                 - None
"RTN","GMPLENFM",84,0)
 ;         8:  Special Exposure  Full text of piece 6
"RTN","GMPLENFM",85,0)
 ;                
"RTN","GMPLENFM",86,0)
 N IFN,PROB,CNT,GMPL0,GMPL1,SC,NUM,GMPLIST,GMPARAM,GMPLVIEW,GMPTOTAL,GMPDFN,NODE
"RTN","GMPLENFM",87,0)
 Q:$G(DFN)'>0  S GMPDFN=DFN,CNT=0,NODE=$G(^GMPL(125.99,1,0))
"RTN","GMPLENFM",88,0)
 S GMPARAM("VER")=$P(NODE,U,2),GMPARAM("REV")=$P(NODE,U,5)="R",GMPARAM("QUIET")=1
"RTN","GMPLENFM",89,0)
 S GMPLVIEW("ACT")="A",GMPLVIEW("PROV")=0,GMPLVIEW("VIEW")=""
"RTN","GMPLENFM",90,0)
 D GETPLIST^GMPLMGR1(.GMPLIST,.GMPTOTAL,.GMPLVIEW)
"RTN","GMPLENFM",91,0)
 F NUM=0:0 S NUM=$O(GMPLIST(NUM)) Q:NUM'>0  D
"RTN","GMPLENFM",92,0)
 . S IFN=GMPLIST(NUM) Q:IFN'>0
"RTN","GMPLENFM",93,0)
 . S GMPL0=$G(^AUPNPROB(IFN,0)),GMPL1=$G(^(1))
"RTN","GMPLENFM",94,0)
 . S PROB=$$PROBTEXT^GMPLX(IFN),CNT=CNT+1
"RTN","GMPLENFM",95,0)
 . I GMPARAM("VER"),$P(GMPL1,U,2)="T" S PROB="$"_PROB
"RTN","GMPLENFM",96,0)
 . S PROB=IFN_U_PROB
"RTN","GMPLENFM",97,0)
 . S PROB=PROB_U_$P($G(^ICD9(+$P(GMPL0,U),0)),U)
"RTN","GMPLENFM",98,0)
 . S PROB=PROB_U_$$EXTDT^GMPLX($P(GMPL0,U,13)),SC=$P(GMPL1,U,10)
"RTN","GMPLENFM",99,0)
 . S PROB=PROB_U_$S(+SC:"SC^Y",SC=0:"NSC^N",1:"^")
"RTN","GMPLENFM",100,0)
 . S PROB=PROB_U_$$GMPL1
"RTN","GMPLENFM",101,0)
 . ;S PROB=PROB_U_$S($P(GMPL1,U,11):"A^Agent Orange",$P(GMPL1,U,12):"I^Radiation",$P(GMPL1,U,13):"E^Contaminants",$P(GMPL1,U,13):"H^Head/Neck Cancer"
"RTN","GMPLENFM",102,0)
 . ;,$P(GMPL1,U,16):"M^Mil Sexual Trauma",$P(GMPL1,U,17):"C^Combat Vet",$P(GMPL1,U,18):"S^SHAD",1:"^")
"RTN","GMPLENFM",103,0)
 . S ^TMP("IB",$J,"INTERFACES","GMP SELECT PATIENT ACTIVE PROBLEMS",CNT)=PROB
"RTN","GMPLENFM",104,0)
 S ^TMP("IB",$J,"INTERFACES","GMP SELECT PATIENT ACTIVE PROBLEMS",0)=CNT
"RTN","GMPLENFM",105,0)
 Q
"RTN","GMPLENFM",106,0)
 ;
"RTN","GMPLENFM",107,0)
GMPL1() ;Determine Treatment Factor, if any
"RTN","GMPLENFM",108,0)
 N NXTTF,TXFACTOR
"RTN","GMPLENFM",109,0)
 S TXFACTOR="^"
"RTN","GMPLENFM",110,0)
 F NXTTF=11,12,13,15,16,17,18 I $P(GMPL1,U,NXTTF) S TXFACTOR=$P("A^Agent Orange;I^Ionizing Radiation;E^Env. Contaminants;;H^Head/Neck Cancer;M^Mil Sexual Trauma;C^Combat Vet;S^SHAD",";",NXTTF-10) Q
"RTN","GMPLENFM",111,0)
 Q TXFACTOR
"RTN","GMPLHIST")
0^6^B13031139^B12712340
"RTN","GMPLHIST",1,0)
GMPLHIST ; SLC/MKB/KER -- Problem List Historical data ; 04/15/2002
"RTN","GMPLHIST",2,0)
 ;;2.0;Problem List;**7,26,,31,35**;Aug 25, 1994;Build 26
"RTN","GMPLHIST",3,0)
 ;
"RTN","GMPLHIST",4,0)
 ; External References
"RTN","GMPLHIST",5,0)
 ;   DBIA 10060  ^VA(200
"RTN","GMPLHIST",6,0)
 ;            
"RTN","GMPLHIST",7,0)
DT ; Add historical data (audit trail) to DT list
"RTN","GMPLHIST",8,0)
 ;   Called from ^GMPLDISP, requires AIFN and adds to GMPDT()
"RTN","GMPLHIST",9,0)
 N NODE,DATE,FLD,PROV,OLD,NEW,ROOT,CHNGE,REASON
"RTN","GMPLHIST",10,0)
 S NODE=$G(^GMPL(125.8,AIFN,0)) Q:NODE=""
"RTN","GMPLHIST",11,0)
 S DATE=$$EXTDT^GMPLX($P(NODE,U,3)),FLD=+$P(NODE,U,2),PROV=+$P(NODE,U,8)
"RTN","GMPLHIST",12,0)
 S:'PROV PROV=$P(NODE,U,4)
"RTN","GMPLHIST",13,0)
 S FLD=FLD_U_$$FLDNAME(+FLD),PROV=$P($G(^VA(200,PROV,0)),U)
"RTN","GMPLHIST",14,0)
 S OLD=$P(NODE,U,5),NEW=$P(NODE,U,6),LCNT=LCNT+1
"RTN","GMPLHIST",15,0)
 I +FLD=1101 D  Q
"RTN","GMPLHIST",16,0)
 . S REASON=" removed by "
"RTN","GMPLHIST",17,0)
 . S:OLD="C" REASON=" changed by "
"RTN","GMPLHIST",18,0)
 . S NODE=$G(^GMPL(125.8,AIFN,1))
"RTN","GMPLHIST",19,0)
 . S GMPDT(LCNT,0)=$J(DATE,10)_": NOTE "_$$EXTDT^GMPLX($P(NODE,U,5))_REASON_PROV_":"
"RTN","GMPLHIST",20,0)
 . S LCNT=LCNT+1,GMPDT(LCNT,0)="            "_$P(NODE,U,3)
"RTN","GMPLHIST",21,0)
 I +FLD=1.02 D  Q
"RTN","GMPLHIST",22,0)
 . S CHNGE=$S(NEW="H":"removed",OLD="T":"verified",1:"placed back on list")
"RTN","GMPLHIST",23,0)
 . S GMPDT(LCNT,0)=$J(DATE,10)_": PROBLEM "_CHNGE_" by "_PROV
"RTN","GMPLHIST",24,0)
 S GMPDT(LCNT,0)=$J(DATE,10)_": "_$P(FLD,U,2)_" changed by "_PROV,LCNT=LCNT+1
"RTN","GMPLHIST",25,0)
 I +FLD=.12 S GMPDT(LCNT,0)=$J("from ",17)_$S(OLD="A":"ACTIVE",OLD="I":"INACTIVE",1:"UNKNOWN")_" to "_$S(NEW="A":"ACTIVE",NEW="I":"INACTIVE",1:"UNKNOWN") Q
"RTN","GMPLHIST",26,0)
 I (+FLD=.13)!(+FLD=1.07) S GMPDT(LCNT,0)=$J("from ",17)_$$EXTDT^GMPLX(OLD)_" to "_$$EXTDT^GMPLX(NEW) Q
"RTN","GMPLHIST",27,0)
 I +FLD=1.14 S GMPDT(LCNT,0)=$J("from ",17)_$S(OLD="A":"ACUTE",OLD="C":"CHRONIC",1:"UNSPECIFIED")_" to "_$S(NEW="A":"ACUTE",NEW="C":"CHRONIC",1:"UNSPECIFIED") Q
"RTN","GMPLHIST",28,0)
 I +FLD>1.09 S GMPDT(LCNT,0)=$J("from ",17)_$S(+OLD:"YES",OLD=0:"NO",1:"UNKNOWN")_" to "_$S(+NEW:"YES",NEW=0:"NO",1:"UNKNOWN") Q
"RTN","GMPLHIST",29,0)
 I "^.01^.05^1.01^1.04^1.05^1.06^1.08^"[(U_+FLD_U) D
"RTN","GMPLHIST",30,0)
 . S ROOT=$S(+FLD=.01:"ICD9(",+FLD=.05:"AUTNPOV(",+FLD=1.01:"LEX(757.01,",(+FLD=1.04)!(+FLD=1.05):"VA(200,",+FLD=1.06:"DIC(49,",+FLD=1.08:"SC(",1:"") Q:ROOT=""
"RTN","GMPLHIST",31,0)
 . S GMPDT(LCNT,0)=$J("from ",17)_$S(OLD:$P(@(U_ROOT_OLD_",0)"),U),1:"UNSPECIFIED")
"RTN","GMPLHIST",32,0)
 . S LCNT=LCNT+1,GMPDT(LCNT,0)=$J("to ",17)_$S(NEW:$P(@(U_ROOT_NEW_",0)"),U),1:"UNSPECIFIED")
"RTN","GMPLHIST",33,0)
 Q
"RTN","GMPLHIST",34,0)
 ;            
"RTN","GMPLHIST",35,0)
FLDNAME(NUM) ; Returns Field Name for Display
"RTN","GMPLHIST",36,0)
 N NAME,NM1,NM2,I,J S J=0,NAME="" D NUM(.NM1),ALP(.NM2) S:+($G(NM1(+NUM)))=+NUM J=+NUM
"RTN","GMPLHIST",37,0)
 S:$L($G(NM2(+J))) NAME=$G(NM2(+J))
"RTN","GMPLHIST",38,0)
 Q NAME
"RTN","GMPLHIST",39,0)
ALP(X) ; Alpha Field Names
"RTN","GMPLHIST",40,0)
 S X(.01)="DIAGNOSIS",X(.02)="PATIENT NAME",X(.03)="DATE LAST MODIFIED",X(.04)="CLASS",X(.05)="PROVIDER NARRATIVE"
"RTN","GMPLHIST",41,0)
 S X(.06)="FACILITY",X(.07)="NUMBER",X(.08)="DATE ENTERED",X(.12)="STATUS",X(.13)="DATE OF ONSET",X(1.01)="PROBLEM",X(1.02)="CONDITION"
"RTN","GMPLHIST",42,0)
 S X(1.03)="ENTERED BY",X(1.04)="RECORDING PROVIDER",X(1.05)="RESPONSIBLE PROVIDER",X(1.06)="SERVICE",X(1.07)="DATE RESOLVED"
"RTN","GMPLHIST",43,0)
 S X(1.08)="CLINIC",X(1.09)="DATE RECORDED",X(1.1)="SERVICE CONNECTED",X(1.11)="AGENT ORANGE EXP",X(1.12)="RADIATION EXP",X(1.13)="ENV CONTAMINANTS EXP"
"RTN","GMPLHIST",44,0)
 S X(1.14)="PRIORITY",X(1.15)="HEAD/NECK CANCER",X(1.16)="MIL SEXUAL TRAUMA",X(1.17)="COMBAT VET",X(1.18)="SHAD",X(1101)="NOTE"
"RTN","GMPLHIST",45,0)
 Q
"RTN","GMPLHIST",46,0)
NUM(X) ; Numeric Field Designations
"RTN","GMPLHIST",47,0)
 N FN F FN=.01:.01:.08 S X(+FN)=+FN
"RTN","GMPLHIST",48,0)
 F FN=.12:.01:.13 S X(+FN)=+FN
"RTN","GMPLHIST",49,0)
 F FN=1.01:.01:1.18 S X(+FN)=+FN
"RTN","GMPLHIST",50,0)
 S X(1101)=1101
"RTN","GMPLHIST",51,0)
 Q
"RTN","GMPLHS")
0^11^B13486016^B12944829
"RTN","GMPLHS",1,0)
GMPLHS ; SLC/MKB/KER - Extract Prob List Health Summary ; 04/15/2002
"RTN","GMPLHS",2,0)
 ;;2.0;Problem List;**22,26,35**;Aug 25, 1994;Build 26
"RTN","GMPLHS",3,0)
 ;
"RTN","GMPLHS",4,0)
 ; External References
"RTN","GMPLHS",5,0)
 ;   DBIA  3106  ^DIC(49
"RTN","GMPLHS",6,0)
 ;   DBIA 10060  ^VA(200
"RTN","GMPLHS",7,0)
 ;   DBIA 10015  EN^DIQ1
"RTN","GMPLHS",8,0)
 ;                    
"RTN","GMPLHS",9,0)
GETLIST(GMPDFN,STATUS) ; Define List 
"RTN","GMPLHS",10,0)
 N GMPLIST,GMPLVIEW,GMPARAM,GMPTOTAL K ^TMP("GMPLHS",$J) Q:+GMPDFN'>0
"RTN","GMPLHS",11,0)
 S GMPARAM("QUIET")=1,GMPARAM("REV")=$P($G(^GMPL(125.99,1,0)),U,5)="R"
"RTN","GMPLHS",12,0)
 S GMPLVIEW("ACT")=STATUS,GMPLVIEW("PROV")=0,GMPLVIEW("VIEW")=""
"RTN","GMPLHS",13,0)
 D GETPLIST^GMPLMGR1(.GMPLIST,.GMPTOTAL,.GMPLVIEW)
"RTN","GMPLHS",14,0)
BUILD ; Build list for selected patient
"RTN","GMPLHS",15,0)
 ;   Sets Global Array:
"RTN","GMPLHS",16,0)
 ;   ^TMP("GMPLHS",$J,STATUS,0)
"RTN","GMPLHS",17,0)
 ;                  
"RTN","GMPLHS",18,0)
 ;   Piece 1:  GMPCNT     # of entries extracted
"RTN","GMPLHS",19,0)
 ;         2:  GMPTOTAL   # of entries that exist
"RTN","GMPLHS",20,0)
 N IFN,GMPCNT,NUM S (NUM,GMPCNT)=0 F  S NUM=$O(GMPLIST(NUM)) Q:NUM'>0  D
"RTN","GMPLHS",21,0)
 . S IFN=+GMPLIST(NUM) Q:IFN'>0  D GETPROB(IFN)
"RTN","GMPLHS",22,0)
 I $G(GMPCNT)'>0 K ^TMP("GMPLHS",$J) Q
"RTN","GMPLHS",23,0)
 S ^TMP("GMPLHS",$J,STATUS,0)=GMPCNT_U_GMPTOTAL
"RTN","GMPLHS",24,0)
 Q
"RTN","GMPLHS",25,0)
GETPROB(IFN) ; Get problem data and set it to ^TMP array
"RTN","GMPLHS",26,0)
 ;   Sets Global Arrays:
"RTN","GMPLHS",27,0)
 ;   ^TMP("GMPLHS",$J,CNT,0)
"RTN","GMPLHS",28,0)
 ;   Piece 1:  Pointer to ICD9 file #80
"RTN","GMPLHS",29,0)
 ;         2:  Internal Date Last Modified
"RTN","GMPLHS",30,0)
 ;         3:  Facility Name
"RTN","GMPLHS",31,0)
 ;         4:  Internal Date Entered
"RTN","GMPLHS",32,0)
 ;         5:  Internal Status (A/I/"")
"RTN","GMPLHS",33,0)
 ;         6:  Internal Date of Onset
"RTN","GMPLHS",34,0)
 ;         7:  Responsible Provider Name
"RTN","GMPLHS",35,0)
 ;         8:  Service Name
"RTN","GMPLHS",36,0)
 ;         9:  Service Abbreviation
"RTN","GMPLHS",37,0)
 ;        10:  Internal Date Resolved
"RTN","GMPLHS",38,0)
 ;        11:  Clinic Name
"RTN","GMPLHS",39,0)
 ;        12:  Internal Date Recorded
"RTN","GMPLHS",40,0)
 ;        13:  Problem Term (from Lexicon)
"RTN","GMPLHS",41,0)
 ;        14:  Exposure String (AO/IR/EC/HNC/MST/CV/SHD)
"RTN","GMPLHS",42,0)
 ;                        
"RTN","GMPLHS",43,0)
 ;   ^TMP("GMPLHS",$J,CNT,"N")
"RTN","GMPLHS",44,0)
 ;   Piece 1:  Provider Narrative
"RTN","GMPLHS",45,0)
 ;                   
"RTN","GMPLHS",46,0)
 ;   ^TMP("GMPLHS",$J,CNT,"IEN")
"RTN","GMPLHS",47,0)
 ;   Piece 1:  Pointer to Problem file 9000011
"RTN","GMPLHS",48,0)
 ;                   
"RTN","GMPLHS",49,0)
 N DIC,DIQ,DR,DA,REC,DIAG,LASTMDT,NARR,SITE,ENTDT,STAT,ONSETDT,RPROV
"RTN","GMPLHS",50,0)
 N SERV,SERVABB,RESDT,CLIN,RECDT,LEXI,LEX,PG,AO,EXP,HNC,MST,CV,SHD,IR,SCS
"RTN","GMPLHS",51,0)
 S DIC=9000011,DA=IFN,DIQ="REC(",DIQ(0)="IE"
"RTN","GMPLHS",52,0)
 S DR=".01;.03;.05;.06;.08;.12;.13;1.01;1.05;1.06;1.07;1.08;1.09;1.11;1.12;1.13;1.15;1.16;1.17;1.18"
"RTN","GMPLHS",53,0)
 D EN^DIQ1
"RTN","GMPLHS",54,0)
 S DIAG=REC(9000011,DA,.01,"I"),LASTMDT=REC(9000011,DA,.03,"I")
"RTN","GMPLHS",55,0)
 S NARR=REC(9000011,DA,.05,"E"),SITE=REC(9000011,DA,.06,"E")
"RTN","GMPLHS",56,0)
 S ENTDT=REC(9000011,DA,.08,"I"),STAT=REC(9000011,DA,.12,"I")
"RTN","GMPLHS",57,0)
 S ONSETDT=REC(9000011,DA,.13,"I")
"RTN","GMPLHS",58,0)
 S LEXI=REC(9000011,DA,1.01,"I")
"RTN","GMPLHS",59,0)
 S LEX=REC(9000011,DA,1.01,"E")
"RTN","GMPLHS",60,0)
 S RPROV=REC(9000011,DA,1.05,"E")
"RTN","GMPLHS",61,0)
 S SERV=REC(9000011,DA,1.06,"E")
"RTN","GMPLHS",62,0)
 S SERVABB=$$SERV(REC(9000011,DA,1.06,"I"),SERV)
"RTN","GMPLHS",63,0)
 S RESDT=REC(9000011,DA,1.07,"I")
"RTN","GMPLHS",64,0)
 S CLIN=REC(9000011,DA,1.08,"E")
"RTN","GMPLHS",65,0)
 S RECDT=REC(9000011,DA,1.09,"I")
"RTN","GMPLHS",66,0)
 S AO=+REC(9000011,DA,1.11,"I")
"RTN","GMPLHS",67,0)
 S IR=+REC(9000011,DA,1.12,"I")
"RTN","GMPLHS",68,0)
 S PG=+REC(9000011,DA,1.13,"I")
"RTN","GMPLHS",69,0)
 S HNC=+REC(9000011,DA,1.15,"I")
"RTN","GMPLHS",70,0)
 S MST=+REC(9000011,DA,1.16,"I")
"RTN","GMPLHS",71,0)
 S CV=+REC(9000011,DA,1.17,"I")
"RTN","GMPLHS",72,0)
 S SHD=+REC(9000011,DA,1.18,"I")
"RTN","GMPLHS",73,0)
 K SCS D SCS^GMPLX1(DA,.SCS) S EXP=$G(SCS(1))
"RTN","GMPLHS",74,0)
 S GMPCNT=GMPCNT+1,^TMP("GMPLHS",$J,GMPCNT,0)=DIAG_U_LASTMDT_U_SITE_U_ENTDT_U_STAT_U_ONSETDT_U_RPROV_U_SERV_U_SERVABB_U_RESDT_U_CLIN_U_RECDT_U_LEX_U_EXP
"RTN","GMPLHS",75,0)
 S ^TMP("GMPLHS",$J,GMPCNT,"N")=NARR,^TMP("GMPLHS",$J,GMPCNT,"IEN")=IFN
"RTN","GMPLHS",76,0)
 S:+LEXI>0 ^TMP("GMPLHS",$J,GMPCNT,"L")=LEXI_"^"_LEX
"RTN","GMPLHS",77,0)
 D GETCOMM(IFN,GMPCNT)
"RTN","GMPLHS",78,0)
 Q
"RTN","GMPLHS",79,0)
GETCOMM(IFN,CNT) ; Get Active Comments for a Note
"RTN","GMPLHS",80,0)
 ;   Sets Global Array:
"RTN","GMPLHS",81,0)
 ;   ^TMP("GMPLHS",$J,CNT,"C",LOCATION,NOTE NMBR,0)
"RTN","GMPLHS",82,0)
 ;                     
"RTN","GMPLHS",83,0)
 ;   Piece 1:  Note Narrative
"RTN","GMPLHS",84,0)
 ;         2:  Internal Date Note Added 
"RTN","GMPLHS",85,0)
 ;         3;  Name of Note's Author 
"RTN","GMPLHS",86,0)
 ;                        
"RTN","GMPLHS",87,0)
 N IFN2,IFN3,LOC,NODE S LOC=0 Q:$D(^AUPNPROB(IFN,11))'>0  S IFN2=0
"RTN","GMPLHS",88,0)
 F  S IFN2=$O(^AUPNPROB(IFN,11,IFN2)) Q:IFN2'>0  D
"RTN","GMPLHS",89,0)
 . Q:$D(^AUPNPROB(IFN,11,IFN2,11))'>0
"RTN","GMPLHS",90,0)
 . S LOC=+$G(^AUPNPROB(IFN,11,IFN2,0)),IFN3=0
"RTN","GMPLHS",91,0)
 . F  S IFN3=$O(^AUPNPROB(IFN,11,IFN2,11,IFN3)) Q:IFN3'>0  D
"RTN","GMPLHS",92,0)
 . . S NODE=$G(^AUPNPROB(IFN,11,IFN2,11,IFN3,0)) Q:$P(NODE,U,4)']""
"RTN","GMPLHS",93,0)
 . . S ^TMP("GMPLHS",$J,CNT,"C",LOC,$P(NODE,U),0)=$P(NODE,U,3)_U_$P(NODE,U,5)_U_$P($G(^VA(200,+$P(NODE,U,6),0)),U)
"RTN","GMPLHS",94,0)
 Q
"RTN","GMPLHS",95,0)
SERV(X,SERV) ; Returns Service Name Abbreviation
"RTN","GMPLHS",96,0)
 N ABBREV S ABBREV=$P($G(^DIC(49,+X,0)),U,2) S:ABBREV="" ABBREV=$E($G(SERV),1,5)
"RTN","GMPLHS",97,0)
 Q ABBREV
"RTN","GMPLSAVE")
0^12^B28058379^B27626278
"RTN","GMPLSAVE",1,0)
GMPLSAVE ; SLC/MKB/KER -- Save Problem List data ; 03/13/2008
"RTN","GMPLSAVE",2,0)
 ;;2.0;Problem List;**26,31,35**;Aug 25, 1994;Build 26
"RTN","GMPLSAVE",3,0)
 ;
"RTN","GMPLSAVE",4,0)
 ; External References
"RTN","GMPLSAVE",5,0)
 ;   DBIA 10018  ^DIE
"RTN","GMPLSAVE",6,0)
 ;   DBIA 10013  ^DIK
"RTN","GMPLSAVE",7,0)
 ;   DBIA 10013  IX1^DIK
"RTN","GMPLSAVE",8,0)
 ;   DBIA 10103  $$HTFM^XLFDT
"RTN","GMPLSAVE",9,0)
 ;
"RTN","GMPLSAVE",10,0)
EN ; Save Changes made to Existing Problem
"RTN","GMPLSAVE",11,0)
 N FLD,NOW,CHNGE,I,NIFN,TEXT,OLDTEXT,FAC,NODE,AUDITED,DR,DA,DIE,DIK
"RTN","GMPLSAVE",12,0)
 S:'GMPORIG(.01) GMPORIG(.01)=$$NOS^GMPLX
"RTN","GMPLSAVE",13,0)
 S:'GMPFLD(.01) GMPFLD(.01)=$$NOS^GMPLX
"RTN","GMPLSAVE",14,0)
 S:$D(GMPFLD(.01)) GMPFLD(.01)=+GMPFLD(.01)
"RTN","GMPLSAVE",15,0)
 S:$P(+GMPFLD(.01),U)=-1 GMPFLD(.01)=$$NOS^GMPLX ;chk for error from ICD
"RTN","GMPLSAVE",16,0)
 S:'GMPORIG(1.01) GMPORIG(1.01)="1^Unresolved"
"RTN","GMPLSAVE",17,0)
 S:'GMPFLD(1.01) GMPFLD(1.01)="1^Unresolved"
"RTN","GMPLSAVE",18,0)
 S:'GMPFLD(.05) I=$P(GMPFLD(.05),U,2),GMPFLD(.05)=$$PROVNARR^GMPLX(I,+GMPFLD(1.01))
"RTN","GMPLSAVE",19,0)
 S NOW=$$HTFM^XLFDT($H),AUDITED=0
"RTN","GMPLSAVE",20,0)
 S DR="1.02////"_$S('$D(GMPLUSER):"T",1:GMPFLD(1.02))
"RTN","GMPLSAVE",21,0)
 I GMPORIG(1.02)="T",GMPFLD(1.02)="P" D
"RTN","GMPLSAVE",22,0)
 . S CHNGE=GMPIFN_"^1.02^"_NOW_U_DUZ_"^T^P^Verified^"_DUZ
"RTN","GMPLSAVE",23,0)
 . D AUDIT^GMPLX(CHNGE,"")
"RTN","GMPLSAVE",24,0)
 I $P($G(GMPORIG(.12)),U)="I",$P(GMPFLD(.12),U)="A" D REACTV S AUDITED=1
"RTN","GMPLSAVE",25,0)
 I +$G(GMPORIG(1.01))'=(+GMPFLD(1.01)) D REFORM S AUDITED=1
"RTN","GMPLSAVE",26,0)
 S GMPFLD(.01)=+GMPFLD(.01) ;to remove text left by ?? lex (~)
"RTN","GMPLSAVE",27,0)
 F FLD=.01,.05,.12,.13,1.01,1.05,1.06,1.07,1.08,1.09,1.1,1.11,1.12,1.13,1.14,1.15,1.16,1.17,1.18 D
"RTN","GMPLSAVE",28,0)
 . Q:'$D(GMPFLD(FLD))  Q:$P($G(GMPORIG(FLD)),U)=$P($G(GMPFLD(FLD)),U)
"RTN","GMPLSAVE",29,0)
 . S DR=DR_";"_FLD_"////"_$S($P(GMPFLD(FLD),U)'="":$P(GMPFLD(FLD),U),1:"@")
"RTN","GMPLSAVE",30,0)
 . Q:AUDITED  S CHNGE=GMPIFN_U_FLD_U_NOW_U_DUZ_U_$P(GMPORIG(FLD),U)_U_$P(GMPFLD(FLD),U)_"^^"_+$G(GMPROV)
"RTN","GMPLSAVE",31,0)
 . D AUDIT^GMPLX(CHNGE,"")
"RTN","GMPLSAVE",32,0)
 S DA=GMPIFN,DIE="^AUPNPROB(" D ^DIE S GMPSAVED=1
"RTN","GMPLSAVE",33,0)
NOTES ; Save Changes to Notes
"RTN","GMPLSAVE",34,0)
 F I=0:0 S I=$O(GMPORIG(10,I)) Q:I'>0  I GMPORIG(10,I)'=GMPFLD(10,I) D
"RTN","GMPLSAVE",35,0)
 . S NIFN=+GMPFLD(10,I),FAC=$P(GMPFLD(10,I),U,2),TEXT=$P(GMPFLD(10,I),U,3),OLDTEXT=$P(GMPORIG(10,I),U,3)
"RTN","GMPLSAVE",36,0)
 . S NODE=$G(^AUPNPROB(GMPIFN,11,FAC,11,NIFN,0))
"RTN","GMPLSAVE",37,0)
 . I TEXT'="" S $P(^AUPNPROB(GMPIFN,11,FAC,11,NIFN,0),U,3)=TEXT D
"RTN","GMPLSAVE",38,0)
 .. I TEXT=OLDTEXT Q
"RTN","GMPLSAVE",39,0)
 .. S CHNGE=GMPIFN_"^1101^"_NOW_U_DUZ_"^C^^Note Modified^"_+$G(GMPROV)
"RTN","GMPLSAVE",40,0)
 . I TEXT=OLDTEXT Q
"RTN","GMPLSAVE",41,0)
 . I TEXT="" S CHNGE=GMPIFN_"^1101^"_NOW_U_DUZ_"^A^^Deleted Note^"_+$G(GMPROV)
"RTN","GMPLSAVE",42,0)
 . D AUDIT^GMPLX(CHNGE,NODE)
"RTN","GMPLSAVE",43,0)
 . I TEXT="" D
"RTN","GMPLSAVE",44,0)
 .. S DIK="^AUPNPROB("_GMPIFN_",11,"_FAC_",11,"
"RTN","GMPLSAVE",45,0)
 .. S DA(2)=GMPIFN,DA(1)=FAC,DA=NIFN D ^DIK
"RTN","GMPLSAVE",46,0)
 I $D(GMPFLD(10,"NEW"))>9 D NEWNOTE
"RTN","GMPLSAVE",47,0)
EXIT ; Quit Saving Changes
"RTN","GMPLSAVE",48,0)
 D:$G(GMPSAVED) DTMOD^GMPLX(GMPIFN)
"RTN","GMPLSAVE",49,0)
 Q
"RTN","GMPLSAVE",50,0)
 ;
"RTN","GMPLSAVE",51,0)
REFORM ; Audit Entry that has been Reformulated
"RTN","GMPLSAVE",52,0)
 S CHNGE=GMPIFN_"^1.01^"_NOW_U_DUZ_U_+GMPORIG(1.01)_U_+GMPFLD(1.01)_"^Reformulated^"_+$G(GMPROV)
"RTN","GMPLSAVE",53,0)
 S NODE=$G(^AUPNPROB(GMPIFN,0))_U_$G(^AUPNPROB(GMPIFN,1))
"RTN","GMPLSAVE",54,0)
 D AUDIT^GMPLX(CHNGE,NODE)
"RTN","GMPLSAVE",55,0)
 Q
"RTN","GMPLSAVE",56,0)
 ;
"RTN","GMPLSAVE",57,0)
REACTV ; Audit Entry that has been Reactivated
"RTN","GMPLSAVE",58,0)
 S CHNGE=GMPIFN_"^.12^"_NOW_U_DUZ_"^I^A^Reactivated^"_+$G(GMPROV)
"RTN","GMPLSAVE",59,0)
 S NODE=$G(^AUPNPROB(GMPIFN,0))_U_$G(^AUPNPROB(GMPIFN,1))
"RTN","GMPLSAVE",60,0)
 D AUDIT^GMPLX(CHNGE,NODE)
"RTN","GMPLSAVE",61,0)
 Q
"RTN","GMPLSAVE",62,0)
 ;
"RTN","GMPLSAVE",63,0)
NEW ; Save Collected Values in new Problem Entry
"RTN","GMPLSAVE",64,0)
 ;   Output   DA (left defined)
"RTN","GMPLSAVE",65,0)
 N DATA,APCDLOOK,APCDALVR,NUM,I,DIK,GMPIFN,X
"RTN","GMPLSAVE",66,0)
 S:'GMPFLD(.01) GMPFLD(.01)=$$NOS^GMPLX
"RTN","GMPLSAVE",67,0)
 S:$P(+GMPFLD(.01),U)=-1 GMPFLD(.01)=$$NOS^GMPLX ;chk for error from ICD
"RTN","GMPLSAVE",68,0)
 S GMPFLD(.01)=+GMPFLD(.01) ;to remove text left by ?? lex (~)
"RTN","GMPLSAVE",69,0)
 S:'GMPFLD(1.01) GMPFLD(1.01)="1^Unresolved"
"RTN","GMPLSAVE",70,0)
 S:'GMPFLD(.05) X=$P(GMPFLD(.05),U,2),GMPFLD(.05)=$$PROVNARR^GMPLX(X,+GMPFLD(1.01))
"RTN","GMPLSAVE",71,0)
 S DA=$$NEWPROB(+GMPFLD(.01),+GMPDFN) Q:DA'>0
"RTN","GMPLSAVE",72,0)
 S NUM=$$NEXTNMBR(+GMPDFN,+GMPVAMC),GMPSAVED=1 S:'NUM NUM=""
"RTN","GMPLSAVE",73,0)
 ;   Set Node 0
"RTN","GMPLSAVE",74,0)
 S DATA=^AUPNPROB(DA,0)_U_DT_"^^"_$P(GMPFLD(.05),U)_U_+GMPVAMC_U_+NUM_U_DT_"^^^^"_$P(GMPFLD(.12),U)_U_$P(GMPFLD(.13),U)
"RTN","GMPLSAVE",75,0)
 S ^AUPNPROB(DA,0)=DATA
"RTN","GMPLSAVE",76,0)
 ;   Set Node 1
"RTN","GMPLSAVE",77,0)
 S DATA=$P(GMPFLD(1.01),U) F I=1.02:.01:1.18 S DATA=DATA_U_$P($G(GMPFLD(+I)),U)
"RTN","GMPLSAVE",78,0)
 S ^AUPNPROB(DA,1)=DATA
"RTN","GMPLSAVE",79,0)
 ;   Set X-Refs
"RTN","GMPLSAVE",80,0)
 S DIK="^AUPNPROB(",(APCDLOOK,APCDALVR)=1 D IX1^DIK
"RTN","GMPLSAVE",81,0)
 I $D(GMPFLD(10,"NEW"))>9 S GMPIFN=DA D NEWNOTE
"RTN","GMPLSAVE",82,0)
 Q
"RTN","GMPLSAVE",83,0)
 ;
"RTN","GMPLSAVE",84,0)
NEWPROB(ICD,DFN) ; Creates New Problem Entry in file #9000011
"RTN","GMPLSAVE",85,0)
 N I,HDR,LAST,TOTAL,DA
"RTN","GMPLSAVE",86,0)
 L +^AUPNPROB(0):1 I '$T D  Q -1
"RTN","GMPLSAVE",87,0)
 . W !!,"Someone else is currently editing this file."
"RTN","GMPLSAVE",88,0)
 . W !,"Please try again later.",!
"RTN","GMPLSAVE",89,0)
 S HDR=$G(^AUPNPROB(0)) Q:HDR="" -1
"RTN","GMPLSAVE",90,0)
 S LAST=$P(HDR,U,3),TOTAL=$P(HDR,U,4)
"RTN","GMPLSAVE",91,0)
 F I=(LAST+1):1 Q:'$D(^AUPNPROB(I,0))
"RTN","GMPLSAVE",92,0)
 S DA=I,^AUPNPROB(DA,0)=ICD_U_DFN
"RTN","GMPLSAVE",93,0)
 S ^AUPNPROB("B",ICD,DA)="",^AUPNPROB("AC",DFN,DA)=""
"RTN","GMPLSAVE",94,0)
 S $P(^AUPNPROB(0),U,3,4)=DA_U_(TOTAL+1) L -^AUPNPROB(0)
"RTN","GMPLSAVE",95,0)
 Q DA
"RTN","GMPLSAVE",96,0)
 ;
"RTN","GMPLSAVE",97,0)
NEWNOTE ; Creates New Note Entries for Problem
"RTN","GMPLSAVE",98,0)
 ;   Requires GMPIFN   Pointer to Problem
"RTN","GMPLSAVE",99,0)
 ;            GMPROV   Current Provider
"RTN","GMPLSAVE",100,0)
 ;            GMPVAMC  Facility
"RTN","GMPLSAVE",101,0)
 N HDR,LAST,TOTAL,I,FAC,NIFN
"RTN","GMPLSAVE",102,0)
 L +^AUPNPROB(GMPIFN,11):1 I '$T Q
"RTN","GMPLSAVE",103,0)
 S FAC=+$O(^AUPNPROB(GMPIFN,11,"B",GMPVAMC,0)) I 'FAC D
"RTN","GMPLSAVE",104,0)
 . S:'$D(^AUPNPROB(GMPIFN,11,0)) ^(0)="^9000011.11PA^^"
"RTN","GMPLSAVE",105,0)
 . S HDR=^AUPNPROB(GMPIFN,11,0),LAST=$P(HDR,U,3),TOTAL=$P(HDR,U,4)
"RTN","GMPLSAVE",106,0)
 . F I=(LAST+1):1 Q:'$D(^AUPNPROB(GMPIFN,11,I,0))
"RTN","GMPLSAVE",107,0)
 . S ^AUPNPROB(GMPIFN,11,I,0)=GMPVAMC,^AUPNPROB(GMPIFN,11,"B",GMPVAMC,I)=""
"RTN","GMPLSAVE",108,0)
 . S FAC=I,$P(^AUPNPROB(GMPIFN,11,0),U,3,4)=FAC_U_(TOTAL+1)
"RTN","GMPLSAVE",109,0)
 I FAC'>0 G NNQ
"RTN","GMPLSAVE",110,0)
NN1 ; Get New Note
"RTN","GMPLSAVE",111,0)
 S:'$D(^AUPNPROB(GMPIFN,11,FAC,11,0)) ^(0)="^9000011.1111IA^^"
"RTN","GMPLSAVE",112,0)
 S HDR=^AUPNPROB(GMPIFN,11,FAC,11,0),LAST=$P(HDR,U,3),TOTAL=$P(HDR,U,4)
"RTN","GMPLSAVE",113,0)
 F I=(LAST+1):1 Q:'$D(^AUPNPROB(GMPIFN,11,FAC,11,I,0))
"RTN","GMPLSAVE",114,0)
 S NIFN=I
"RTN","GMPLSAVE",115,0)
 F I=0:0 S I=$O(GMPFLD(10,"NEW",I)) Q:I'>0  D
"RTN","GMPLSAVE",116,0)
 . S ^AUPNPROB(GMPIFN,11,FAC,11,NIFN,0)=NIFN_"^^"_GMPFLD(10,"NEW",I)_"^A^"_DT_U_+$G(GMPROV)
"RTN","GMPLSAVE",117,0)
 . S ^AUPNPROB(GMPIFN,11,FAC,11,"B",NIFN,NIFN)=""
"RTN","GMPLSAVE",118,0)
 . S TOTAL=TOTAL+1,LAST=NIFN,NIFN=NIFN+1
"RTN","GMPLSAVE",119,0)
 S $P(^AUPNPROB(GMPIFN,11,FAC,11,0),U,3,4)=LAST_U_TOTAL
"RTN","GMPLSAVE",120,0)
NNQ ; Quit Getting New Notes
"RTN","GMPLSAVE",121,0)
 L -^AUPNPROB(GMPIFN,11)
"RTN","GMPLSAVE",122,0)
 Q
"RTN","GMPLSAVE",123,0)
 ;
"RTN","GMPLSAVE",124,0)
NEXTNMBR(DFN,VAMC) ; Returns Next Available Problem Number
"RTN","GMPLSAVE",125,0)
 N I,J,NUM S NUM=1,I="" I '$D(^AUPNPROB("AA",DFN,VAMC)) Q NUM
"RTN","GMPLSAVE",126,0)
 F  S I=$O(^AUPNPROB("AA",DFN,VAMC,I)) Q:I=""  S J=$E(I,2,999),NUM=+J
"RTN","GMPLSAVE",127,0)
 S NUM=NUM+1
"RTN","GMPLSAVE",128,0)
 Q NUM
"RTN","GMPLUTL")
0^7^B40604448^B37651336
"RTN","GMPLUTL",1,0)
GMPLUTL ; SLC/MKB/KER -- PL Utilities                      ; 4/15/2002
"RTN","GMPLUTL",2,0)
 ;;2.0;Problem List;**3,6,8,10,16,26,35**;Aug 25, 1994;Build 26
"RTN","GMPLUTL",3,0)
 ;
"RTN","GMPLUTL",4,0)
 ; External References
"RTN","GMPLUTL",5,0)
 ;   DBIA    348  ^DPT(
"RTN","GMPLUTL",6,0)
 ;   DBIA  10082  ^ICD9(
"RTN","GMPLUTL",7,0)
 ;   DBIA  10006  ^VA(200
"RTN","GMPLUTL",8,0)
 ;          
"RTN","GMPLUTL",9,0)
ACTIVE(GMPDFN,GMPL) ; Returns list of Active Problems for a Patient
"RTN","GMPLUTL",10,0)
 ;          
"RTN","GMPLUTL",11,0)
 ;   GMPDFN   Pointer to Patient
"RTN","GMPLUTL",12,0)
 ;   GMPL     Array in which the problems will be
"RTN","GMPLUTL",13,0)
 ;            returned, passed by reference
"RTN","GMPLUTL",14,0)
 ;          
"RTN","GMPLUTL",15,0)
 ;   GMPL(#,0)  Problem file (#9000011) IEN
"RTN","GMPLUTL",16,0)
 ;   GMPL(#,1)  Piece 1:  Pointer to Problem (Lexicon file #757.01)
"RTN","GMPLUTL",17,0)
 ;                    2:  Provider Narrative 
"RTN","GMPLUTL",18,0)
 ;                 NOTE:  the provider narrative may be different
"RTN","GMPLUTL",19,0)
 ;                        from the Lexicon term in file 757.01
"RTN","GMPLUTL",20,0)
 ;   GMPL(#,2)  Piece 1:  Pointer to ICD Diagnosis (file #80)
"RTN","GMPLUTL",21,0)
 ;                    2:  ICD-9 Code
"RTN","GMPLUTL",22,0)
 ;   GMPL(#,3)  Piece 1:  Internal Date of Onset
"RTN","GMPLUTL",23,0)
 ;                    2:  External Date of Onset 00/00/00
"RTN","GMPLUTL",24,0)
 ;   GMPL(#,4)  Piece 1:  Abbreviated Service Connection
"RTN","GMPLUTL",25,0)
 ;                            SC^Service Connected
"RTN","GMPLUTL",26,0)
 ;                            NSC^Not Service Connected
"RTN","GMPLUTL",27,0)
 ;                            null
"RTN","GMPLUTL",28,0)
 ;                    2:  Full text Service Connection
"RTN","GMPLUTL",29,0)
 ;   GMPL(#,5)  Piece 1:  Abbreviated Exposure
"RTN","GMPLUTL",30,0)
 ;                        Full text Exposure
"RTN","GMPLUTL",31,0)
 ;                            AO^Agent Orange
"RTN","GMPLUTL",32,0)
 ;                            IR^Radiation
"RTN","GMPLUTL",33,0)
 ;                            EC^Evn Contaminants
"RTN","GMPLUTL",34,0)
 ;                            HNC^Head/Neck Cancer
"RTN","GMPLUTL",35,0)
 ;                            MST^Mil Sexual Trauma
"RTN","GMPLUTL",36,0)
 ;                            CV^Combat Vet
"RTN","GMPLUTL",37,0)
 ;                            SHD^SHAD
"RTN","GMPLUTL",38,0)
 ;                            null
"RTN","GMPLUTL",39,0)
 ;          
"RTN","GMPLUTL",40,0)
 N I,IFN,CNT,GMPL0,GMPL1,SP,NUM,ONSET,GMPLIST,GMPLVIEW,GMPARAM,GMPTOTAL
"RTN","GMPLUTL",41,0)
 Q:$G(GMPDFN)'>0  S CNT=0,SP=""
"RTN","GMPLUTL",42,0)
 S GMPARAM("QUIET")=1,GMPARAM("REV")=$P($G(^GMPL(125.99,1,0)),U,5)="R"
"RTN","GMPLUTL",43,0)
 S GMPLVIEW("ACT")="A",GMPLVIEW("PROV")=0,GMPLVIEW("VIEW")=""
"RTN","GMPLUTL",44,0)
 D GETPLIST^GMPLMGR1(.GMPLIST,.GMPTOTAL,.GMPLVIEW)
"RTN","GMPLUTL",45,0)
 F NUM=0:0 S NUM=$O(GMPLIST(NUM)) Q:NUM'>0  D
"RTN","GMPLUTL",46,0)
 . S IFN=+GMPLIST(NUM) Q:IFN'>0
"RTN","GMPLUTL",47,0)
 . S GMPL0=$G(^AUPNPROB(IFN,0)),GMPL1=$G(^(1)),CNT=CNT+1,GMPL(CNT,0)=IFN
"RTN","GMPLUTL",48,0)
 . S GMPL(CNT,1)=+GMPL1_U_$$PROBTEXT^GMPLX(IFN)
"RTN","GMPLUTL",49,0)
 . S GMPL(CNT,2)=+GMPL0_U_$P($G(^ICD9(+GMPL0,0)),U),ONSET=$P(GMPL0,U,13)
"RTN","GMPLUTL",50,0)
 . S GMPL(CNT,3)=$S(ONSET:ONSET_U_$$EXTDT^GMPLX(ONSET),1:"")
"RTN","GMPLUTL",51,0)
 . S GMPL(CNT,4)=$S(+$P(GMPL1,U,10):"SC^SERVICE-CONNECTED",$P(GMPL1,U,10)=0:"NSC^NOT SERVICE-CONNECTED",1:"")
"RTN","GMPLUTL",52,0)
 . F I=11,12,13,15,16,17,18 S:$P(GMPL1,U,I) SP=$S(I=11:"A",I=12:"I",I=13:"P",I=15:"H",16:"M",17:"C",1:"S")
"RTN","GMPLUTL",53,0)
 . S GMPL(CNT,5)=$S(SP="A":"AO^AGENT ORANGE",SP="I":"IR^RADIATION",SP="P":"EC^ENV CONTAMINANTS",SP="H":"HNC^HEAD AND/OR NECK CANCER",SP="M":"MST^MILIARY SEXUAL TRAUMA",SP="C":"CV^COMBAT VET",SP="S":"SHD^SHAD",1:"")
"RTN","GMPLUTL",54,0)
 S GMPL(0)=CNT
"RTN","GMPLUTL",55,0)
 Q
"RTN","GMPLUTL",56,0)
 ;
"RTN","GMPLUTL",57,0)
CREATE(PL,PLY) ; Creates a new problem
"RTN","GMPLUTL",58,0)
 ;           
"RTN","GMPLUTL",59,0)
 ;  Input array, passed by reference
"RTN","GMPLUTL",60,0)
 ;    Required
"RTN","GMPLUTL",61,0)
 ;      PL("PATIENT")    Pointer to Patient #2
"RTN","GMPLUTL",62,0)
 ;      PL("NARRATIVE")  Text as entered by provider
"RTN","GMPLUTL",63,0)
 ;      PL("PROVIDER")   Pointer to provider #200
"RTN","GMPLUTL",64,0)
 ;    Optional
"RTN","GMPLUTL",65,0)
 ;      PL("DIAGNOSIS")  Pointer to ICD-9 #80
"RTN","GMPLUTL",66,0)
 ;      PL("LEXICON")    Pointer to Lexicon #757.01
"RTN","GMPLUTL",67,0)
 ;      PL("STATUS")     A = Active   I = Inactive
"RTN","GMPLUTL",68,0)
 ;      PL("ONSET")      Internal Date of Onset
"RTN","GMPLUTL",69,0)
 ;      PL("RECORDED")   Internal Date Recorded
"RTN","GMPLUTL",70,0)
 ;      PL("RESOLVED")   Internal Date Problem was Resolved
"RTN","GMPLUTL",71,0)
 ;      PL("COMMENT")    Comment text, up to 60 characters
"RTN","GMPLUTL",72,0)
 ;      PL("LOCATION")   Pointer to Hospital Location
"RTN","GMPLUTL",73,0)
 ;      PL("SC")         Service Connected 1 = Yes 0 = No
"RTN","GMPLUTL",74,0)
 ;      PL("AO")         Agent Orange      1 = Yes 0 = No
"RTN","GMPLUTL",75,0)
 ;      PL("IR")         Radiation         1 = Yes 0 = No
"RTN","GMPLUTL",76,0)
 ;      PL("EC")         Env Contamination 1 = Yes 0 = No
"RTN","GMPLUTL",77,0)
 ;      PL("HNC")        Head/Neck Cancer  1 = Yes 0 = No
"RTN","GMPLUTL",78,0)
 ;      PL("MST")        Mil Sexual Trauma 1 = Yes 0 = No
"RTN","GMPLUTL",79,0)
 ;      PL("CV")         Combat Vet        1 = Yes 0 = No
"RTN","GMPLUTL",80,0)
 ;      PL("SHD")        Shipboard Hazard & Defense 1=Yes  0=No
"RTN","GMPLUTL",81,0)
 ;                   
"RTN","GMPLUTL",82,0)
 ;  Output, passed by reference
"RTN","GMPLUTL",83,0)
 ;      PLY              Equivalent of Fileman Y, DA
"RTN","GMPLUTL",84,0)
 ;      PLY(0)           Equivalent of Fileman Y(0)
"RTN","GMPLUTL",85,0)
 ;               
"RTN","GMPLUTL",86,0)
 N GMPI,GMPQUIT,GMPVAMC,GMPVA,GMPFLD,GMPSC,GMPAGTOR,GMPION,GMPGULF
"RTN","GMPLUTL",87,0)
 N GMPHNC,GMPMST,GMPCV,GMPSHD,DA,GMPDFN,GMPROV
"RTN","GMPLUTL",88,0)
 K PLY S PLY=-1,PLY(0)=""
"RTN","GMPLUTL",89,0)
 S GMPVAMC=+$G(DUZ(2)),GMPVA=$S($G(DUZ("AG"))="V":1,1:0)
"RTN","GMPLUTL",90,0)
 I '$L($G(PL("NARRATIVE"))) S PLY(0)="Missing problem narrative" Q
"RTN","GMPLUTL",91,0)
 I '$D(^DPT(+$G(PL("PATIENT")),0)) S PLY(0)="Invalid patient" Q
"RTN","GMPLUTL",92,0)
 I '$D(^VA(200,+$G(PL("PROVIDER")),0)) S PLY(0)="Invalid provider" Q
"RTN","GMPLUTL",93,0)
 S GMPDFN=+PL("PATIENT"),(GMPSC,GMPAGTOR,GMPION,GMPGULF,GMPHNC,GMPMST)=0
"RTN","GMPLUTL",94,0)
 D:GMPVA VADPT^GMPLX1(GMPDFN)
"RTN","GMPLUTL",95,0)
 F GMPI="DIAGNOSI","LEXICON","DUPLICAT","LOCATION","STATUS" D @(GMPI_"^GMPLUTL1") Q:$D(GMPQUIT)
"RTN","GMPLUTL",96,0)
 Q:$D(GMPQUIT)
"RTN","GMPLUTL",97,0)
 F GMPI="ONSET","RESOLVED","RECORDED","SC","AO","IR","EC","HNC","MST","CV","SHD" D @(GMPI_"^GMPLUTL1") Q:$D(GMPQUIT)
"RTN","GMPLUTL",98,0)
 Q:$D(GMPQUIT)
"RTN","GMPLUTL",99,0)
CR1 ; Ok to Create
"RTN","GMPLUTL",100,0)
 S GMPFLD(.01)=PL("DIAGNOSIS"),GMPFLD(1.01)=PL("LEXICON")
"RTN","GMPLUTL",101,0)
 S GMPFLD(.05)=U_$E(PL("NARRATIVE"),1,80)
"RTN","GMPLUTL",102,0)
 S (GMPROV,GMPFLD(1.04),GMPFLD(1.05))=+PL("PROVIDER")
"RTN","GMPLUTL",103,0)
 S GMPFLD(1.06)=$$SERVICE^GMPLX1(+PL("PROVIDER"))
"RTN","GMPLUTL",104,0)
 S GMPFLD(.13)=PL("ONSET"),GMPFLD(1.09)=PL("RECORDED")
"RTN","GMPLUTL",105,0)
 S GMPFLD(1.02)=$S('$P(^GMPL(125.99,1,0),U,2):"P",$G(GMPLUSER):"P",1:"T")
"RTN","GMPLUTL",106,0)
 S GMPFLD(.12)=PL("STATUS"),GMPFLD(1.14)="",GMPFLD(1.07)=PL("RESOLVED")
"RTN","GMPLUTL",107,0)
 S GMPFLD(10,0)=0,GMPFLD(1.03)=$G(DUZ),GMPFLD(1.08)=PL("LOCATION")
"RTN","GMPLUTL",108,0)
 S:$L($G(PL("COMMENT"))) GMPFLD(10,"NEW",1)=$E(PL("COMMENT"),1,60)
"RTN","GMPLUTL",109,0)
 S GMPFLD(1.1)=PL("SC"),GMPFLD(1.11)=PL("AO"),GMPFLD(1.12)=PL("IR")
"RTN","GMPLUTL",110,0)
 S GMPFLD(1.13)=PL("EC"),GMPFLD(1.15)=$G(PL("HNC")),GMPFLD(1.16)=$G(PL("MST"))
"RTN","GMPLUTL",111,0)
 S GMPFLD(1.17)=$G(PL("CV")),GMPFLD(1.18)=$G(PL("SHD"))
"RTN","GMPLUTL",112,0)
 D NEW^GMPLSAVE S PLY=DA
"RTN","GMPLUTL",113,0)
CRQ ; Quit Create
"RTN","GMPLUTL",114,0)
 Q
"RTN","GMPLUTL",115,0)
 ;            
"RTN","GMPLUTL",116,0)
UPDATE(PL,PLY) ; Update a Problem/Create if Not Found
"RTN","GMPLUTL",117,0)
 ;            
"RTN","GMPLUTL",118,0)
 ;  Input array, passed by reference
"RTN","GMPLUTL",119,0)
 ;    Required
"RTN","GMPLUTL",120,0)
 ;      PL("PROBLEM")    Pointer to Problem #9000011
"RTN","GMPLUTL",121,0)
 ;      PL("PROVIDER")   Pointer to provider #200
"RTN","GMPLUTL",122,0)
 ;            
"RTN","GMPLUTL",123,0)
 ;    Optional
"RTN","GMPLUTL",124,0)
 ;      PL("NARRATIVE")  Text as entered by provider
"RTN","GMPLUTL",125,0)
 ;      PL("DIAGNOSIS")  Pointer to ICD-9 #80
"RTN","GMPLUTL",126,0)
 ;      PL("LEXICON")    Pointer to Lexicon #757.01
"RTN","GMPLUTL",127,0)
 ;      PL("STATUS")     A = Active   I = Inactive
"RTN","GMPLUTL",128,0)
 ;      PL("ONSET")      Internal Date of Onset
"RTN","GMPLUTL",129,0)
 ;      PL("RECORDED")   Internal Date Recorded
"RTN","GMPLUTL",130,0)
 ;      PL("RESOLVED")   Internal Date Problem was Resolved
"RTN","GMPLUTL",131,0)
 ;      PL("COMMENT")    Comment text, up to 60 characters
"RTN","GMPLUTL",132,0)
 ;      PL("LOCATION")   Pointer to Hospital Location
"RTN","GMPLUTL",133,0)
 ;      PL("SC")         Service Connected 1 = Yes 0 = No
"RTN","GMPLUTL",134,0)
 ;      PL("AO")         Agent Orange      1 = Yes 0 = No
"RTN","GMPLUTL",135,0)
 ;      PL("IR")         Radiation         1 = Yes 0 = No
"RTN","GMPLUTL",136,0)
 ;      PL("EC")         Env Contamination 1 = Yes 0 = No
"RTN","GMPLUTL",137,0)
 ;      PL("HNC")        Head/Neck Cancer  1 = Yes 0 = No
"RTN","GMPLUTL",138,0)
 ;      PL("MST")        Mil Sexual Trauma 1 = Yes 0 = No
"RTN","GMPLUTL",139,0)
 ;      PL("CV")         Combat Veteran    1 = Yes 0 = No
"RTN","GMPLUTL",140,0)
 ;      PL("SHD")        SHAD              1 = Yes 0 = No
"RTN","GMPLUTL",141,0)
 ;            
"RTN","GMPLUTL",142,0)
 ;  Output, passed by reference
"RTN","GMPLUTL",143,0)
 ;      PLY              Equivalent of Fileman Y, DA
"RTN","GMPLUTL",144,0)
 ;      PLY(0)           Equivalent of Fileman Y(0)
"RTN","GMPLUTL",145,0)
 ;            
"RTN","GMPLUTL",146,0)
 N GMPORIG,GMPFLD,FLD,ITEMS,SUB,GMPI,DIFFRENT,GMPIFN,GMPVAMC,GMPVA,GMPROV,GMPQUIT,GMPDFN
"RTN","GMPLUTL",147,0)
 S GMPVAMC=+$G(DUZ(2)),GMPVA=$S($G(DUZ("AG"))="V":1,1:0),PLY=-1,PLY(0)=""
"RTN","GMPLUTL",148,0)
 S GMPIFN=$G(PL("PROBLEM")) I GMPIFN="" D CREATE(.PL,.PLY) Q
"RTN","GMPLUTL",149,0)
 I '$D(^AUPNPROB(GMPIFN,0)) S PLY(0)="Invalid problem" Q
"RTN","GMPLUTL",150,0)
 I '$D(^VA(200,+$G(PL("PROVIDER")),0)) S PLY(0)="Invalid provider" Q
"RTN","GMPLUTL",151,0)
 S GMPROV=+$G(PL("PROVIDER")),GMPDFN=+$P(^AUPNPROB(GMPIFN,0),U,2)
"RTN","GMPLUTL",152,0)
 D GETFLDS^GMPLEDT3(GMPIFN) I '$D(GMPFLD) S PLY(0)="Invalid problem" Q
"RTN","GMPLUTL",153,0)
 I +$G(PL("PATIENT")),+PL("PATIENT")'=GMPDFN S PLY(0)="Patient does not match for this problem" Q
"RTN","GMPLUTL",154,0)
 I $L($G(PL("RECORDED"))) S PLY(0)="Date Recorded is not editable" Q
"RTN","GMPLUTL",155,0)
 S (GMPSC,GMPAGTOR,GMPION,GMPGULF)=0 D:GMPVA VADPT^GMPLX1(GMPDFN)
"RTN","GMPLUTL",156,0)
 S ITEMS="LEXICON^DIAGNOSIS^LOCATION^STATUS^ONSET^RESOLVED^SC^AO^IR^EC^HNC^MST^SHD",FLD="1.01^.01^1.08^.12^.13^1.07^1.1^1.11^1.12^1.13^1.15^1.16^1.17^1.18"
"RTN","GMPLUTL",157,0)
 F GMPI=1:1 S SUB=$P(ITEMS,U,GMPI) Q:SUB=""  D  Q:$D(GMPQUIT)
"RTN","GMPLUTL",158,0)
 . I '$L($G(PL(SUB))) S PL(SUB)=$P(GMPFLD($P(FLD,U,GMPI)),U) Q
"RTN","GMPLUTL",159,0)
 . I SUB="STATUS",PL(SUB)="@" S GMPQUIT=1,PLY(0)="Cannot delete problem status" Q
"RTN","GMPLUTL",160,0)
 . I PL(SUB)'="@" D @($E(SUB,1,8)_"^GMPLUTL1") Q:$D(GMPQUIT)
"RTN","GMPLUTL",161,0)
 . S GMPFLD($P(FLD,U,GMPI))=$S(PL(SUB)="@":"",1:PL(SUB)),DIFFRENT=1
"RTN","GMPLUTL",162,0)
 Q:$D(GMPQUIT)
"RTN","GMPLUTL",163,0)
 I +GMPFLD(1.07),GMPFLD(1.07)<GMPFLD(.13) S PLY(0)="Date Resolved cannot be prior to Date of Onset" Q
"RTN","GMPLUTL",164,0)
 I +GMPFLD(1.09),GMPFLD(1.09)<GMPFLD(.13) S PLY(0)="Date Recorded cannot be prior to Date of Onset" Q
"RTN","GMPLUTL",165,0)
 S:$L($G(PL("NARRATIVE"))) GMPFLD(.05)=U_PL("NARRATIVE"),DIFFRENT=1
"RTN","GMPLUTL",166,0)
 S:$L($G(PL("COMMENT"))) GMPFLD(10,"NEW",1)=$E(PL("COMMENT"),1,60),DIFFRENT=1
"RTN","GMPLUTL",167,0)
 D:$D(DIFFRENT) EN^GMPLSAVE S PLY=GMPIFN,PLY(0)=""
"RTN","GMPLUTL",168,0)
 Q
"RTN","GMPLUTL1")
0^8^B25017636^B21019316
"RTN","GMPLUTL1",1,0)
GMPLUTL1 ; SLC/MKB/KER -- PL Utilities (cont)               ; 04/15/2002
"RTN","GMPLUTL1",2,0)
 ;;2.0;Problem List;**3,8,7,9,26,35**;Aug 25, 1994;Build 26
"RTN","GMPLUTL1",3,0)
 ;
"RTN","GMPLUTL1",4,0)
 ; External References
"RTN","GMPLUTL1",5,0)
 ;   DBIA   446  ^AUTNPOV(
"RTN","GMPLUTL1",6,0)
 ;   DBIA 10082  ^ICD9(
"RTN","GMPLUTL1",7,0)
 ;   DBIA  1571  ^LEX(757.01
"RTN","GMPLUTL1",8,0)
 ;   DBIA 10040  ^SC(
"RTN","GMPLUTL1",9,0)
 ;   DBIA 10060  ^VA(200
"RTN","GMPLUTL1",10,0)
 ;   DBIA 10003  ^%DT
"RTN","GMPLUTL1",11,0)
 ;   DBIA 10104  $$UP^XLFSTR
"RTN","GMPLUTL1",12,0)
 ;                   
"RTN","GMPLUTL1",13,0)
 ; All entry points in this routine expect the 
"RTN","GMPLUTL1",14,0)
 ; PL("data item") array from routine ^GMPLUTL.
"RTN","GMPLUTL1",15,0)
 ;                   
"RTN","GMPLUTL1",16,0)
 ;   Entry     Expected Variable
"RTN","GMPLUTL1",17,0)
 ;   Point     From VADPT^GMPLX1
"RTN","GMPLUTL1",18,0)
 ;    AO           GMPAGTOR
"RTN","GMPLUTL1",19,0)
 ;    IR           GMPION
"RTN","GMPLUTL1",20,0)
 ;    EC           GMPGULF
"RTN","GMPLUTL1",21,0)
 ;    HNC          GMPHNC
"RTN","GMPLUTL1",22,0)
 ;    MST          GMPMST
"RTN","GMPLUTL1",23,0)
 ;    CV           GMPCV
"RTN","GMPLUTL1",24,0)
 ;    SHD          GMPSHD
"RTN","GMPLUTL1",25,0)
 ;                   
"RTN","GMPLUTL1",26,0)
 Q
"RTN","GMPLUTL1",27,0)
DIAGNOSI ; ICD Diagnosis Pointer
"RTN","GMPLUTL1",28,0)
 S:'$L($G(PL("DIAGNOSIS"))) PL("DIAGNOSIS")=$$NOS^GMPLX
"RTN","GMPLUTL1",29,0)
 Q:$D(^ICD9(+PL("DIAGNOSIS"),0))
"RTN","GMPLUTL1",30,0)
 S GMPQUIT=1,PLY(0)="Invalid ICD Diagnosis"
"RTN","GMPLUTL1",31,0)
 Q
"RTN","GMPLUTL1",32,0)
 ;
"RTN","GMPLUTL1",33,0)
LEXICON ; Clinical Lexicon Pointer
"RTN","GMPLUTL1",34,0)
 S:'$L($G(PL("LEXICON"))) PL("LEXICON")=1
"RTN","GMPLUTL1",35,0)
 Q:$D(^LEX(757.01,+PL("LEXICON"),0))
"RTN","GMPLUTL1",36,0)
 S GMPQUIT=1,PLY(0)="Invalid Lexicon term"
"RTN","GMPLUTL1",37,0)
 Q
"RTN","GMPLUTL1",38,0)
DUPLICAT ; Problem Already on the List 
"RTN","GMPLUTL1",39,0)
 N DUPL
"RTN","GMPLUTL1",40,0)
 Q:$P($G(^GMPL(125.99,1,0)),U,6)'=1
"RTN","GMPLUTL1",41,0)
 S:'$L($G(PL("DIAGNOSIS"))) PL("DIAGNOSIS")=$$NOS^GMPLX
"RTN","GMPLUTL1",42,0)
 I '$D(^AUPNPROB("B",+PL("DIAGNOSIS")))!('$D(^AUPNPROB("AC",GMPDFN))) Q
"RTN","GMPLUTL1",43,0)
 F IFN=0:0 S IFN=$O(^AUPNPROB("AC",GMPDFN,IFN)) Q:IFN'>0  D  Q:$D(GMPQUIT)
"RTN","GMPLUTL1",44,0)
 . S (DUPL(1),DUPL(2))=0
"RTN","GMPLUTL1",45,0)
 . S NODE0=$G(^AUPNPROB(IFN,0)),NODE1=$G(^(1)) Q:$P(NODE1,U,2)="H"
"RTN","GMPLUTL1",46,0)
 . I +PL("DIAGNOSIS")=+NODE0 S DUPL(1)=IFN
"RTN","GMPLUTL1",47,0)
 . S:PL("NARRATIVE")=$$UP^XLFSTR($P(^AUTNPOV($P(NODE0,U,5),0),U)) DUPL(2)=IFN
"RTN","GMPLUTL1",48,0)
 . I DUPL(1)>0&DUPL(2)>0 S GMPQUIT=1,PLY(0)="Duplicate problem"
"RTN","GMPLUTL1",49,0)
 Q
"RTN","GMPLUTL1",50,0)
 ;
"RTN","GMPLUTL1",51,0)
LOCATION ; Hospital Location (Clinic) Pointer
"RTN","GMPLUTL1",52,0)
 S:'$D(PL("LOCATION")) PL("LOCATION")="" Q:'$L(PL("LOCATION"))
"RTN","GMPLUTL1",53,0)
 I $D(^SC(+PL("LOCATION"),0)),$P(^(0),U,3)="C" Q
"RTN","GMPLUTL1",54,0)
 S GMPQUIT=1,PLY(0)="Invalid hospital location"
"RTN","GMPLUTL1",55,0)
 Q
"RTN","GMPLUTL1",56,0)
 ;
"RTN","GMPLUTL1",57,0)
PROVIDER ; Responsible Provider
"RTN","GMPLUTL1",58,0)
 S:'$D(PL("PROVIDER")) PL("PROVIDER")=""
"RTN","GMPLUTL1",59,0)
 Q:'$L(PL("PROVIDER"))  Q:$D(^VA(200,+PL("PROVIDER"),0))
"RTN","GMPLUTL1",60,0)
 S GMPQUIT=1,PLY(0)="Invalid provider"
"RTN","GMPLUTL1",61,0)
 Q
"RTN","GMPLUTL1",62,0)
 ;
"RTN","GMPLUTL1",63,0)
STATUS ; Problem Status
"RTN","GMPLUTL1",64,0)
 S:$G(PL("STATUS"))="" PL("STATUS")="A"
"RTN","GMPLUTL1",65,0)
 I "^A^I^a^i^"[(U_PL("STATUS")_U) S PL("STATUS")=$$UP^XLFSTR(PL("STATUS")) Q
"RTN","GMPLUTL1",66,0)
 S GMPQUIT=1,PLY(0)="Invalid problem status"
"RTN","GMPLUTL1",67,0)
 Q
"RTN","GMPLUTL1",68,0)
 ;
"RTN","GMPLUTL1",69,0)
ONSET ; Date of Onset
"RTN","GMPLUTL1",70,0)
 N %DT,Y,X
"RTN","GMPLUTL1",71,0)
 S:'$D(PL("ONSET")) PL("ONSET")="" Q:'$L(PL("ONSET"))
"RTN","GMPLUTL1",72,0)
 S %DT="P",%DT(0)="-NOW",X=PL("ONSET") D ^%DT
"RTN","GMPLUTL1",73,0)
 I Y>0 S PL("ONSET")=Y Q
"RTN","GMPLUTL1",74,0)
 S GMPQUIT=1,PLY(0)="Invalid Date of Onset"
"RTN","GMPLUTL1",75,0)
 Q
"RTN","GMPLUTL1",76,0)
 ;
"RTN","GMPLUTL1",77,0)
RESOLVED ; Date Resolved (Requires STATUS, ONSET)
"RTN","GMPLUTL1",78,0)
 N %DT,Y,X
"RTN","GMPLUTL1",79,0)
 S:'$D(PL("RESOLVED")) PL("RESOLVED")="" Q:'$L(PL("RESOLVED"))
"RTN","GMPLUTL1",80,0)
 S %DT="P",%DT(0)="-NOW",X=PL("RESOLVED") D ^%DT
"RTN","GMPLUTL1",81,0)
 I Y'>0 S GMPQUIT=1,PLY(0)="Invalid Date Resolved" Q
"RTN","GMPLUTL1",82,0)
 I PL("STATUS")="A" S GMPQUIT=1,PLY(0)="Active problems cannot have a Date Resolved" Q
"RTN","GMPLUTL1",83,0)
 I Y<PL("ONSET") S GMPQUIT=1,PLY(0)="Date Resolved cannot be prior to Date of Onset" Q
"RTN","GMPLUTL1",84,0)
 S PL("RESOLVED")=Y
"RTN","GMPLUTL1",85,0)
 Q
"RTN","GMPLUTL1",86,0)
 ;
"RTN","GMPLUTL1",87,0)
RECORDED ; Date Recorded (Requires ONSET)
"RTN","GMPLUTL1",88,0)
 N %DT,Y,X
"RTN","GMPLUTL1",89,0)
 S:'$D(PL("RECORDED")) PL("RECORDED")="" Q:'$L(PL("RECORDED"))
"RTN","GMPLUTL1",90,0)
 S %DT="P",%DT(0)="-NOW",X=PL("RECORDED") D ^%DT
"RTN","GMPLUTL1",91,0)
 I Y'>0 S GMPQUIT=1,PLY(0)="Invalid Date Recorded" Q
"RTN","GMPLUTL1",92,0)
 I PL("RECORDED")<PL("ONSET") S GMPQUIT=1,PLY(0)="Date Recorded cannot be prior to Date of Onset" Q
"RTN","GMPLUTL1",93,0)
 S PL("RECORDED")=Y
"RTN","GMPLUTL1",94,0)
 Q
"RTN","GMPLUTL1",95,0)
 ;
"RTN","GMPLUTL1",96,0)
SC ; SC condition flag
"RTN","GMPLUTL1",97,0)
 S:'$D(PL("SC")) PL("SC")=""
"RTN","GMPLUTL1",98,0)
 I "^^1^0^"'[(U_PL("SC")_U) S GMPQUIT=1,PLY(0)="Invalid SC flag" Q
"RTN","GMPLUTL1",99,0)
 I 'GMPSC,+PL("SC") S GMPQUIT=1,PLY(0)="Invalid SC flag"
"RTN","GMPLUTL1",100,0)
 Q
"RTN","GMPLUTL1",101,0)
 ;
"RTN","GMPLUTL1",102,0)
AO ; AO exposure flag (Requires GMPAGTOR)
"RTN","GMPLUTL1",103,0)
 S:'$D(PL("AO")) PL("AO")=""
"RTN","GMPLUTL1",104,0)
 I "^^1^0^"'[(U_PL("AO")_U) S GMPQUIT=1,PLY(0)="Invalid AO flag" Q
"RTN","GMPLUTL1",105,0)
 I 'GMPAGTOR,+PL("AO") S GMPQUIT=1,PLY(0)="Invalid AO flag"
"RTN","GMPLUTL1",106,0)
 Q
"RTN","GMPLUTL1",107,0)
 ;
"RTN","GMPLUTL1",108,0)
IR ; IR exposure flag (Requires GMPION)
"RTN","GMPLUTL1",109,0)
 S:'$D(PL("IR")) PL("IR")=""
"RTN","GMPLUTL1",110,0)
 I "^^1^0^"'[(U_PL("IR")_U) S GMPQUIT=1,PLY(0)="Invalid IR flag" Q
"RTN","GMPLUTL1",111,0)
 I 'GMPION,+PL("IR") S GMPQUIT=1,PLY(0)="Invalid IR flag"
"RTN","GMPLUTL1",112,0)
 Q
"RTN","GMPLUTL1",113,0)
 ;
"RTN","GMPLUTL1",114,0)
EC ; EC exposure flag (Requires GMPGULF)
"RTN","GMPLUTL1",115,0)
 S:'$D(PL("EC")) PL("EC")=""
"RTN","GMPLUTL1",116,0)
 I "^^1^0^"'[(U_PL("EC")_U) S GMPQUIT=1,PLY(0)="Invalid EC flag" Q
"RTN","GMPLUTL1",117,0)
 I 'GMPGULF,+PL("EC") S GMPQUIT=1,PLY(0)="Invalid EC flag"
"RTN","GMPLUTL1",118,0)
 Q
"RTN","GMPLUTL1",119,0)
HNC ; HNC/NTR exposure flag (Requires GMPHNC)
"RTN","GMPLUTL1",120,0)
 S:'$D(PL("HNC")) PL("HNC")=""
"RTN","GMPLUTL1",121,0)
 I "^^1^0^"'[(U_PL("HNC")_U) S GMPQUIT=1,PLY(0)="Invalid HNC flag" Q
"RTN","GMPLUTL1",122,0)
 I 'GMPHNC,+PL("HNC") S GMPQUIT=1,PLY(0)="Invalid HNC flag"
"RTN","GMPLUTL1",123,0)
 Q
"RTN","GMPLUTL1",124,0)
MST ; MST exposure flag (Requires GMPMST)
"RTN","GMPLUTL1",125,0)
 S:'$D(PL("MST")) PL("MST")=""
"RTN","GMPLUTL1",126,0)
 I "^^1^0^"'[(U_PL("MST")_U) S GMPQUIT=1,PLY(0)="Invalid MST flag" Q
"RTN","GMPLUTL1",127,0)
 I 'GMPMST,+PL("MST") S GMPQUIT=1,PLY(0)="Invalid MST flag"
"RTN","GMPLUTL1",128,0)
 Q
"RTN","GMPLUTL1",129,0)
CV ; CV exposure flag (Requires GMPCV)
"RTN","GMPLUTL1",130,0)
 S:'$D(PL("CV")) PL("CV")=""
"RTN","GMPLUTL1",131,0)
 I "^^1^0^"'[(U_PL("CV")_U) S GMPQUIT=1,PLY(0)="Invalid CV flag" Q
"RTN","GMPLUTL1",132,0)
 I 'GMPSHD,+PL("CV") S GMPQUIT=1,PLY(0)="Invalid CV flag"
"RTN","GMPLUTL1",133,0)
 Q
"RTN","GMPLUTL1",134,0)
SHD ; SHD exposure flag (Requires GMPSHD)
"RTN","GMPLUTL1",135,0)
 S:'$D(PL("SHD")) PL("SHD")=""
"RTN","GMPLUTL1",136,0)
 I "^^1^0^"'[(U_PL("SHD")_U) S GMPQUIT=1,PLY(0)="Invalid SHD flag" Q
"RTN","GMPLUTL1",137,0)
 I 'GMPSHD,+PL("SHD") S GMPQUIT=1,PLY(0)="Invalid SHD flag"
"RTN","GMPLUTL1",138,0)
 Q
"RTN","GMPLUTL2")
0^9^B69909833^B67316994
"RTN","GMPLUTL2",1,0)
GMPLUTL2 ; SLC/MKB/KER -- PL Utilities (OE/TIU)             ; 04/15/2002
"RTN","GMPLUTL2",2,0)
 ;;2.0;Problem List;**10,18,21,26,35**;Aug 25, 1994;Build 26
"RTN","GMPLUTL2",3,0)
 ; External References
"RTN","GMPLUTL2",4,0)
 ;   DBIA   348  ^DPT(  file #2
"RTN","GMPLUTL2",5,0)
 ;   DBIA 10082  ^ICD9(  file #80
"RTN","GMPLUTL2",6,0)
 ;   DBIA 10040  ^SC(  file #44
"RTN","GMPLUTL2",7,0)
 ;   DBIA 10060  ^VA(200
"RTN","GMPLUTL2",8,0)
 ;   DBIA  2716  $$GETSTAT^DGMSTAPI
"RTN","GMPLUTL2",9,0)
 ;   DBIA  3457  $$GETCUR^DGNTAPI
"RTN","GMPLUTL2",10,0)
 ;   DBIA 10062  7^VADPT
"RTN","GMPLUTL2",11,0)
 ;   DBIA 10062  DEM^VADPT
"RTN","GMPLUTL2",12,0)
 ;   DBIA 10118  EN^VALM
"RTN","GMPLUTL2",13,0)
 ;   DBIA 10116  CLEAR^VALM1
"RTN","GMPLUTL2",14,0)
 ;   DBIA 10103  $$HTFM^XLFDT
"RTN","GMPLUTL2",15,0)
LIST(GMPL,GMPDFN,GMPSTAT,GMPCOMM) ; Returns list of Prob for Pt.           
"RTN","GMPLUTL2",16,0)
 ;   Input   GMPDFN  Pointer to Patient file #2
"RTN","GMPLUTL2",17,0)
 ;           GMPCOMP Display Comments 1/0
"RTN","GMPLUTL2",18,0)
 ;           GMTSTAT Status A/I/""
"RTN","GMPLUTL2",19,0)
 ;   Output  GMPL    Array, passed by reference
"RTN","GMPLUTL2",20,0)
 ;           GMPL(#)
"RTN","GMPLUTL2",21,0)
 ;             Piece 1:  Pointer to Problem #9000011
"RTN","GMPLUTL2",22,0)
 ;                   2:  Status 
"RTN","GMPLUTL2",23,0)
 ;                   3:  Description
"RTN","GMPLUTL2",24,0)
 ;                   4:  ICD-9 code
"RTN","GMPLUTL2",25,0)
 ;                   5:  Date of Onset
"RTN","GMPLUTL2",26,0)
 ;                   6:  Date Last Modified
"RTN","GMPLUTL2",27,0)
 ;                   7:  Service Connected
"RTN","GMPLUTL2",28,0)
 ;                   8:  Special Exposures
"RTN","GMPLUTL2",29,0)
 ;           GMPL(#,C#)  Comments
"RTN","GMPLUTL2",30,0)
 ;           GMPL(0)     Number of Problems Returned
"RTN","GMPLUTL2",31,0)
 N I,IFN,CNT,GMPL0,GMPL1,SP,ST,NUM,ONSET,ICD,LASTMOD,SC,GMPLIST,GMPLVIEW,GMPARAM,GMPTOTAL
"RTN","GMPLUTL2",32,0)
 Q:$G(GMPDFN)'>0  S CNT=0,SP=""
"RTN","GMPLUTL2",33,0)
 S GMPARAM("QUIET")=1,GMPARAM("REV")=$P($G(^GMPL(125.99,1,0)),U,5)="R"
"RTN","GMPLUTL2",34,0)
 S GMPLVIEW("ACT")=GMPSTAT,GMPLVIEW("PROV")=0,GMPLVIEW("VIEW")=""
"RTN","GMPLUTL2",35,0)
 D GETPLIST^GMPLMGR1(.GMPLIST,.GMPTOTAL,.GMPLVIEW)
"RTN","GMPLUTL2",36,0)
 F NUM=0:0 S NUM=$O(GMPLIST(NUM)) Q:NUM'>0  D
"RTN","GMPLUTL2",37,0)
 . S IFN=+GMPLIST(NUM) Q:IFN'>0
"RTN","GMPLUTL2",38,0)
 . S GMPL0=$G(^AUPNPROB(IFN,0)),GMPL1=$G(^(1)),CNT=CNT+1
"RTN","GMPLUTL2",39,0)
 . S ICD=$P($G(^ICD9(+GMPL0,0)),U),LASTMOD=$P(GMPL0,U,3)
"RTN","GMPLUTL2",40,0)
 . S ST=$P(GMPL0,U,12),ONSET=$P(GMPL0,U,13)
"RTN","GMPLUTL2",41,0)
 . S SC=$S(+$P(GMPL1,U,10):"SC",$P(GMPL1,U,10)=0:"NSC",1:"")
"RTN","GMPLUTL2",42,0)
 . N SCS D SCS^GMPLX1(IFN,.SCS) S SP=$G(SCS(3))
"RTN","GMPLUTL2",43,0)
 . S GMPL(CNT)=IFN_U_ST_U_$$PROBTEXT^GMPLX(IFN)_U_ICD_U_ONSET_U_LASTMOD_U_SC_U_SP_U_$S($P(GMPL1,U,14)="A":"*",1:"")_U_$S('$P($G(^GMPL(125.99,1,0)),U,2):"",$P(GMPL1,U,2)'="T":"",1:"$")
"RTN","GMPLUTL2",44,0)
 . I $G(GMPCOMM) D
"RTN","GMPLUTL2",45,0)
 . . N FAC,NIFN,NOTE,NOTECNT
"RTN","GMPLUTL2",46,0)
 . . S NOTECNT=0,FAC=0
"RTN","GMPLUTL2",47,0)
 . . F  S FAC=$O(^AUPNPROB(IFN,11,FAC)) Q:+FAC'>0  D
"RTN","GMPLUTL2",48,0)
 . . . S NIFN=0
"RTN","GMPLUTL2",49,0)
 . . . F  S NIFN=$O(^AUPNPROB(IFN,11,FAC,11,NIFN)) Q:NIFN'>0  D
"RTN","GMPLUTL2",50,0)
 . . . . S NOTE=$P($G(^AUPNPROB(IFN,11,FAC,11,NIFN,0)),U,3)
"RTN","GMPLUTL2",51,0)
 . . . . S NOTECNT=NOTECNT+1,GMPL(CNT,NOTECNT)=NOTE
"RTN","GMPLUTL2",52,0)
 S GMPL(0)=CNT
"RTN","GMPLUTL2",53,0)
 Q
"RTN","GMPLUTL2",54,0)
 ;
"RTN","GMPLUTL2",55,0)
DETAIL(IFN,GMPL) ; Returns Detailed Data for Problem
"RTN","GMPLUTL2",56,0)
 ;                
"RTN","GMPLUTL2",57,0)
 ; Input   IFN  Pointer to Problem file #9000011
"RTN","GMPLUTL2",58,0)
 ;                
"RTN","GMPLUTL2",59,0)
 ; Output  GMPL Array, passed by reference
"RTN","GMPLUTL2",60,0)
 ;         GMPL("DATA NAME") = External Format of Value
"RTN","GMPLUTL2",61,0)
 ;
"RTN","GMPLUTL2",62,0)
 ;         GMPL("DIAGNOSIS")  ICD Code
"RTN","GMPLUTL2",63,0)
 ;         GMPL("PATIENT")    Patient Name
"RTN","GMPLUTL2",64,0)
 ;         GMPL("MODIFIED")   Date Last Modified
"RTN","GMPLUTL2",65,0)
 ;         GMPL("NARRATIVE")  Provider Narrative 
"RTN","GMPLUTL2",66,0)
 ;         GMPL("ENTERED")    Date Entered ^ Entered by
"RTN","GMPLUTL2",67,0)
 ;         GMPL("STATUS")     Status
"RTN","GMPLUTL2",68,0)
 ;         GMPL("PRIORITY")   Priority Acute/Chronic
"RTN","GMPLUTL2",69,0)
 ;         GMPL("ONSET")      Date of Onset
"RTN","GMPLUTL2",70,0)
 ;         GMPL("PROVIDER")   Responsible Provider
"RTN","GMPLUTL2",71,0)
 ;         GMPL("RECORDED")   Date Recorded ^ Recorded by
"RTN","GMPLUTL2",72,0)
 ;         GMPL("CLINIC")     Hospital Location
"RTN","GMPLUTL2",73,0)
 ;         GMPL("SC")         Service Connected SC/NSC/""
"RTN","GMPLUTL2",74,0)
 ;
"RTN","GMPLUTL2",75,0)
 ;         GMPL("EXPOSURE") = #
"RTN","GMPLUTL2",76,0)
 ;         GMPL("EXPOSURE",X)="AGENT ORANGE"
"RTN","GMPLUTL2",77,0)
 ;         GMPL("EXPOSURE",X)="RADIATION"
"RTN","GMPLUTL2",78,0)
 ;         GMPL("EXPOSURE",X)="ENV CONTAMINANTS"
"RTN","GMPLUTL2",79,0)
 ;         GMPL("EXPOSURE",X)="HEAD AND/OR NECK CANCER"
"RTN","GMPLUTL2",80,0)
 ;         GMPL("EXPOSURE",X)="MILITARY SEXUAL TRAUMA"
"RTN","GMPLUTL2",81,0)
 ;         GMPL("EXPOSURE",X)="COMBAT VET"
"RTN","GMPLUTL2",82,0)
 ;         GMPL("EXPOSURE",X)="SHAD"
"RTN","GMPLUTL2",83,0)
 ;
"RTN","GMPLUTL2",84,0)
 ;         GMPL("COMMENT") = #
"RTN","GMPLUTL2",85,0)
 ;         GMPL("COMMENT",CNT) = Date ^ Author ^ Text of Note
"RTN","GMPLUTL2",86,0)
 ;              
"RTN","GMPLUTL2",87,0)
 N GMPL0,GMPL1,GMPLP,X,I,FAC,CNT,NIFN Q:'$D(^AUPNPROB(IFN,0))
"RTN","GMPLUTL2",88,0)
 S GMPLP=+($$PTR^GMPLUTL4),GMPL0=$G(^AUPNPROB(IFN,0)),GMPL1=$G(^(1))
"RTN","GMPLUTL2",89,0)
 S GMPL("DIAGNOSIS")=$P($G(^ICD9(+GMPL0,0)),U)
"RTN","GMPLUTL2",90,0)
 S GMPL("PATIENT")=$P($G(^DPT(+$P(GMPL0,U,2),0)),U)
"RTN","GMPLUTL2",91,0)
 S GMPL("MODIFIED")=$$EXTDT^GMPLX($P(GMPL0,U,3))
"RTN","GMPLUTL2",92,0)
 S GMPL("NARRATIVE")=$$PROBTEXT^GMPLX(IFN)
"RTN","GMPLUTL2",93,0)
 S GMPL("ENTERED")=$$EXTDT^GMPLX($P(GMPL0,U,8))_U_$P($G(^VA(200,+$P(GMPL1,U,3),0)),U)
"RTN","GMPLUTL2",94,0)
 S X=$P(GMPL0,U,12),GMPL("STATUS")=$S(X="A":"ACTIVE",1:"INACTIVE")
"RTN","GMPLUTL2",95,0)
 S X=$S(X'="A":"",1:$P(GMPL1,U,14)),GMPL("PRIORITY")=$S(X="A":"ACUTE",X="C":"CHRONIC",1:"")
"RTN","GMPLUTL2",96,0)
 S GMPL("ONSET")=$$EXTDT^GMPLX($P(GMPL0,U,13))
"RTN","GMPLUTL2",97,0)
 S GMPL("PROVIDER")=$P($G(^VA(200,+$P(GMPL1,U,5),0)),U)
"RTN","GMPLUTL2",98,0)
 S GMPL("RECORDED")=$$EXTDT^GMPLX($P(GMPL1,U,9))_U_$P($G(^VA(200,+$P(GMPL1,U,4),0)),U)
"RTN","GMPLUTL2",99,0)
 S GMPL("CLINIC")=$P($G(^SC(+$P(GMPL1,U,8),0)),U)
"RTN","GMPLUTL2",100,0)
 S GMPL("SC")=$S($P(GMPL1,U,10):"YES",$P(GMPL1,U,10)=0:"NO",1:"UNKNOWN")
"RTN","GMPLUTL2",101,0)
 S GMPL("EXPOSURE")=0
"RTN","GMPLUTL2",102,0)
 I $P(GMPL1,U,11) S X=GMPL("EXPOSURE")+1,GMPL("EXPOSURE",X)="AGENT ORANGE",GMPL("EXPOSURE")=X
"RTN","GMPLUTL2",103,0)
 I $P(GMPL1,U,12) S X=GMPL("EXPOSURE")+1,GMPL("EXPOSURE",X)="RADIATION",GMPL("EXPOSURE")=X
"RTN","GMPLUTL2",104,0)
 I $P(GMPL1,U,13) S X=GMPL("EXPOSURE")+1,GMPL("EXPOSURE",X)="ENV CONTAMINANTS",GMPL("EXPOSURE")=X
"RTN","GMPLUTL2",105,0)
 I $P(GMPL1,U,15) S X=GMPL("EXPOSURE")+1,GMPL("EXPOSURE",X)="HEAD AND/OR NECK CANCER",GMPL("EXPOSURE")=X
"RTN","GMPLUTL2",106,0)
 I $P(GMPL1,U,16) S X=GMPL("EXPOSURE")+1,GMPL("EXPOSURE",X)="MILITARY SEXUAL TRAUMA",GMPL("EXPOSURE")=X
"RTN","GMPLUTL2",107,0)
 I $P(GMPL1,U,17) S X=GMPL("EXPOSURE")+1,GMPL("EXPOSURE",X)="COMBAT VET",GMPL("EXPOSURE")=X
"RTN","GMPLUTL2",108,0)
 I $P(GMPL1,U,18)&(GMPLP'>0) S X=GMPL("EXPOSURE")+1,GMPL("EXPOSURE",X)="SHAD",GMPL("EXPOSURE")=X
"RTN","GMPLUTL2",109,0)
 S (FAC,CNT)=0,GMPL("COMMENT")=0
"RTN","GMPLUTL2",110,0)
 F FAC=0:0 S FAC=$O(^AUPNPROB(IFN,11,FAC)) Q:+FAC'>0  D
"RTN","GMPLUTL2",111,0)
 . F NIFN=0:0 S NIFN=$O(^AUPNPROB(IFN,11,FAC,11,NIFN)) Q:NIFN'>0  D
"RTN","GMPLUTL2",112,0)
 . . S X=$G(^AUPNPROB(IFN,11,FAC,11,NIFN,0))
"RTN","GMPLUTL2",113,0)
 . . S CNT=CNT+1,GMPL("COMMENT",CNT)=$$EXTDT^GMPLX($P(X,U,5))_U_$P($G(^VA(200,+$P(X,U,6),0)),U)_U_$P(X,U,3)
"RTN","GMPLUTL2",114,0)
 S GMPL("COMMENT")=CNT D AUDIT
"RTN","GMPLUTL2",115,0)
 Q
"RTN","GMPLUTL2",116,0)
 ;
"RTN","GMPLUTL2",117,0)
AUDIT ; 14 Sep 99 - MA - Add audit trail to OE Problem List.
"RTN","GMPLUTL2",118,0)
 ; Called from DETAIL, requires IFN and sets GMPL("AUDIT")
"RTN","GMPLUTL2",119,0)
 N IDT,AIFN,X0,X1,FLD,CNT
"RTN","GMPLUTL2",120,0)
 S CNT=0,GMPL("AUDIT")=CNT
"RTN","GMPLUTL2",121,0)
 F IDT=0:0 S IDT=$O(^GMPL(125.8,"AD",IFN,IDT)) Q:IDT'>0  D
"RTN","GMPLUTL2",122,0)
 . F AIFN=0:0 S AIFN=$O(^GMPL(125.8,"AD",IFN,IDT,AIFN)) Q:AIFN'>0  D
"RTN","GMPLUTL2",123,0)
 .. S X0=$G(^GMPL(125.8,AIFN,0)),X1=$G(^(1)) Q:'$L(X0)
"RTN","GMPLUTL2",124,0)
 .. S FLD=$$FLDNAME(+$P(X0,U,2))
"RTN","GMPLUTL2",125,0)
 .. S CNT=CNT+1
"RTN","GMPLUTL2",126,0)
 .. S GMPL("AUDIT",CNT,0)=$P(X0,U,2)_U_FLD_U_$P(X0,U,3,8)
"RTN","GMPLUTL2",127,0)
 .. ; = pointer#^fld name^date mod^who mod^old^new^reason^prov
"RTN","GMPLUTL2",128,0)
 .. S:$L(X1) GMPL("AUDIT",CNT,1)=X1
"RTN","GMPLUTL2",129,0)
 S GMPL("AUDIT")=CNT
"RTN","GMPLUTL2",130,0)
 Q
"RTN","GMPLUTL2",131,0)
 ;
"RTN","GMPLUTL2",132,0)
FLDNAME(NUM)    ; Returns field name for display
"RTN","GMPLUTL2",133,0)
 N NAME,NM1,NM2,I,J S J=0,NAME=""
"RTN","GMPLUTL2",134,0)
 S NM1=".01^.05^.12^.13^1.01^1.02^1.04^1.05^1.06^1.07^1.08^1.09^1.1^1.11^1.12^1.13^1.14^1.17^1.18^1101"
"RTN","GMPLUTL2",135,0)
 F I=1:1:$L(NM1,U) I +$P(NM1,U,I)=+NUM S J=I Q
"RTN","GMPLUTL2",136,0)
 G:J'>0 FNQ
"RTN","GMPLUTL2",137,0)
 S NM2="DIAGNOSIS^PROVIDER NARRATIVE^STATUS^DATE OF ONSET^PROBLEM^CONDITION^RECORDING PROVIDER^RESPONSIBLE PROVIDER"
"RTN","GMPLUTL2",138,0)
 S NM2=NM2_"^SERVICE^DATE RESOLVED^CLINIC^DATE RECORDED^SERVICE CONNECTED^AGENT ORANGE EXP^RADIATION EXP^ENV CONTAMINANTS EXP"
"RTN","GMPLUTL2",139,0)
 S NM2=NM2_"^COMBAT VET^SHIPBOARD HAZARD EXP^PRIORITY^NOTE"
"RTN","GMPLUTL2",140,0)
 S NAME=$P(NM2,U,J)
"RTN","GMPLUTL2",141,0)
FNQ Q NAME
"RTN","GMPLUTL2",142,0)
 ;
"RTN","GMPLUTL2",143,0)
ADD(DFN,LOC,GMPROV) ; -- Interactive LMgr action to add new problem
"RTN","GMPLUTL2",144,0)
 N X,Y,GMPDFN,GMPVA,GMPVAMC,GMPSC,GMPAGTOR,GMPION,GMPGULF,GMPHNC,GMPMST,GMPCV,GMPSHD
"RTN","GMPLUTL2",145,0)
 N GMPARAM,GMPLVIEW,GMPLUSER,GMPCLIN,GMPLSLST,GMPQUIT,VALMCC,GMPSAVED
"RTN","GMPLUTL2",146,0)
 Q:'DFN  Q:'LOC  D SETVARS
"RTN","GMPLUTL2",147,0)
 S GMPLSLST=$P($G(^VA(200,DUZ,125)),U,2),VALMCC=0
"RTN","GMPLUTL2",148,0)
 I 'GMPLSLST,GMPCLIN,$D(^GMPL(125,"C",+GMPCLIN)) S GMPLSLST=$O(^(+GMPCLIN,0))
"RTN","GMPLUTL2",149,0)
 I GMPLSLST D  Q
"RTN","GMPLUTL2",150,0)
 . S $P(GMPLSLST,U,2)=$P($G(^GMPL(125,+GMPLSLST,0)),U)
"RTN","GMPLUTL2",151,0)
 . D EN^VALM("GMPL LIST MENU")
"RTN","GMPLUTL2",152,0)
 F  D ADD^GMPL1 Q:$D(GMPQUIT)  K DUOUT,DTOUT,GMPSAVED W !!,">>>  Please enter another problem, or press <return> to exit."
"RTN","GMPLUTL2",153,0)
 Q
"RTN","GMPLUTL2",154,0)
 ;
"RTN","GMPLUTL2",155,0)
SETVARS ; -- Define GMP* variables used in ADD and EDIT
"RTN","GMPLUTL2",156,0)
 N VA,VADM,VAEL,VASV,X
"RTN","GMPLUTL2",157,0)
 Q:'DFN  D DEM^VADPT,7^VADPT
"RTN","GMPLUTL2",158,0)
 S GMPDFN=DFN_U_VADM(1)_U_$E(VADM(1))_VA("BID")_$S(VADM(6):U_+VADM(6),1:"")
"RTN","GMPLUTL2",159,0)
 S AUPNSEX=$P(VADM(5),U),GMPVA=1,GMPSC=VAEL(3),GMPAGTOR=VASV(2),GMPION=VASV(3)
"RTN","GMPLUTL2",160,0)
 S X=$P($G(^DPT(DFN,.322)),U,10),GMPGULF=$S(X="Y":1,X="N":0,1:"")
"RTN","GMPLUTL2",161,0)
 S GMPCV=0 I +$G(VASV(10)) S:DT'>$P($G(VASV(10,1)),U) GMPCV=1 ;CV
"RTN","GMPLUTL2",162,0)
 S GMPSHD=+$G(VASV(14,1)) ;SHAD
"RTN","GMPLUTL2",163,0)
 S X=$$GETCUR^DGNTAPI(DFN,"HNC"),X=+($G(HNC("STAT"))),GMPHNC=$S(X=4:1,X=5:1,X=1:0,X=6:0,1:"")
"RTN","GMPLUTL2",164,0)
 S X=$P($$GETSTAT^DGMSTAPI(DFN),"^",2),GMPMST=$S(X="Y":1,X="N":0,1:"")
"RTN","GMPLUTL2",165,0)
 S GMPLVIEW("VIEW")=$S($P($G(^SC(+$G(LOC),0)),U,3)="C":"C",1:"S")
"RTN","GMPLUTL2",166,0)
 S GMPCLIN="" I $G(LOC),GMPLVIEW("VIEW")="C" S GMPCLIN=+LOC_U_$P(^SC(+LOC,0),U)
"RTN","GMPLUTL2",167,0)
 S X=$$PARAM,GMPARAM("VER")=+$P(X,U,2),GMPARAM("CLU")=+$P(X,U,4),GMPARAM("REV")=+$P(X,U,5)
"RTN","GMPLUTL2",168,0)
 S:+GMPROV=DUZ GMPLUSER=1 S GMPVAMC=+$G(DUZ(2)),GMPLIST(0)=0
"RTN","GMPLUTL2",169,0)
 Q
"RTN","GMPLUTL2",170,0)
 ;
"RTN","GMPLUTL2",171,0)
EDIT(DFN,LOC,GMPROV,GMPIFN) ; Interactive LMgr action to edit a problem
"RTN","GMPLUTL2",172,0)
 N GMPARAM,GMPDFN,GMPVA,GMPSC,GMPAGTOR,GMPION,GMPGULF,GMPHNC,GMPMST,GMPCV,GMPSHD
"RTN","GMPLUTL2",173,0)
 N GMPLVIEW,GMPCLIN,GMPLJUMP,GMPQUIT,GMPLUSER,GMPLVAMC,AUPNSEX
"RTN","GMPLUTL2",174,0)
 L +^AUPNPROB(GMPIFN,0):1 I '$T W $C(7),!!,$$LOCKED^GMPLX,! H 2 Q
"RTN","GMPLUTL2",175,0)
 D SETVARS,EN^VALM("GMPL EDIT PROBLEM")
"RTN","GMPLUTL2",176,0)
 L -^AUPNPROB(GMPIFN,0)
"RTN","GMPLUTL2",177,0)
 Q
"RTN","GMPLUTL2",178,0)
 ;
"RTN","GMPLUTL2",179,0)
REMOVE(GMPIFN,GMPROV,TEXT,PLY) ; -- Remove problem GMPIFN
"RTN","GMPLUTL2",180,0)
 N GMPVAMC,CHANGE
"RTN","GMPLUTL2",181,0)
 S GMPVAMC=+$G(DUZ(2)),PLY=-1,PLY(0)=""
"RTN","GMPLUTL2",182,0)
 I '$L($G(^AUPNPROB(GMPIFN,0))) S PLY(0)="Invalid problem" Q
"RTN","GMPLUTL2",183,0)
 I '$D(^VA(200,+$G(GMPROV),0)) S PLY(0)="Invalid provider" Q
"RTN","GMPLUTL2",184,0)
 I $L($G(TEXT)) S GMPFLD(10,"NEW",1)=TEXT D NEWNOTE^GMPLSAVE
"RTN","GMPLUTL2",185,0)
 S CHANGE=GMPIFN_"^1.02^"_$$HTFM^XLFDT($H)_U_DUZ_U_$P($G(^AUPNPROB(GMPIFN,1)),U,2)_"^H^Deleted^"_+$G(GMPROV),$P(^AUPNPROB(GMPIFN,1),U,2)="H",PLY=GMPIFN
"RTN","GMPLUTL2",186,0)
 D AUDIT^GMPLX(CHANGE,""),DTMOD^GMPLX(GMPIFN)
"RTN","GMPLUTL2",187,0)
 Q
"RTN","GMPLUTL2",188,0)
 ;
"RTN","GMPLUTL2",189,0)
PARAM() ; -- Returns parameter values from 125.99
"RTN","GMPLUTL2",190,0)
 Q $G(^GMPL(125.99,1,0))
"RTN","GMPLUTL2",191,0)
 ;
"RTN","GMPLUTL2",192,0)
VAF(DFN,SILENT) ; -- print PL VA Form chart copy
"RTN","GMPLUTL2",193,0)
 ;
"RTN","GMPLUTL2",194,0)
 N VA,VADM,VAERR,GMPDFN,GMPVAMC,X,GMPARAM,GMPRT,GMPQUIT,GMPLCURR
"RTN","GMPLUTL2",195,0)
 Q:'$G(DFN)  D DEM^VADPT S GMPDFN=DFN_U_VADM(1)_U_$E(VADM(1))_VA("BID")
"RTN","GMPLUTL2",196,0)
 S GMPVAMC=+$G(DUZ(2)),GMPARAM("QUIET")=1
"RTN","GMPLUTL2",197,0)
 S X=$G(^GMPL(125.99,1,0)),GMPARAM("VER")=+$P(X,U,2),GMPARAM("PRT")=+$P(X,U,3),GMPARAM("CLU")=+$P(X,U,4),GMPARAM("REV")=$S($P(X,U,5)="R":1,1:0) K X
"RTN","GMPLUTL2",198,0)
 D VAF^GMPLPRNT I '$G(SILENT) D  Q:$G(GMPQUIT)
"RTN","GMPLUTL2",199,0)
 . I GMPRT'>0 W !!,"No problems available." S GMPQUIT=1 Q
"RTN","GMPLUTL2",200,0)
 . D DEVICE^GMPLPRNT Q:$G(GMPQUIT)  D CLEAR^VALM1
"RTN","GMPLUTL2",201,0)
 D PRT^GMPLPRNT
"RTN","GMPLUTL2",202,0)
 Q
"RTN","GMPLX1")
0^1^B44650031^B38999085
"RTN","GMPLX1",1,0)
GMPLX1 ; SLC/MKB/KER -- Problem List Person Utilities ; 04/15/2002
"RTN","GMPLX1",2,0)
 ;;2.0;Problem List;**3,26,35**;Aug 25, 1994;Build 26
"RTN","GMPLX1",3,0)
 ;
"RTN","GMPLX1",4,0)
 ; External References
"RTN","GMPLX1",5,0)
 ;   DBIA   348  ^DPT(
"RTN","GMPLX1",6,0)
 ;   DBIA  3106  ^DIC(49
"RTN","GMPLX1",7,0)
 ;   DBIA   872  ^ORD(101
"RTN","GMPLX1",8,0)
 ;   DBIA 10060  ^VA(200
"RTN","GMPLX1",9,0)
 ;   DBIA 10062  7^VADPT
"RTN","GMPLX1",10,0)
 ;   DBIA 10062  DEM^VADPT
"RTN","GMPLX1",11,0)
 ;   DBIA  2716  $$GETSTAT^DGMSTAPI
"RTN","GMPLX1",12,0)
 ;   DBIA  3457  $$GETCUR^DGNTAPI
"RTN","GMPLX1",13,0)
 ;   DBIA 10104  $$REPEAT^XLFSTR
"RTN","GMPLX1",14,0)
 ;   DBIA 10006  ^DIC
"RTN","GMPLX1",15,0)
 ;   DBIA 10018  ^DIE
"RTN","GMPLX1",16,0)
 ;   DBIA 10026  ^DIR
"RTN","GMPLX1",17,0)
 ;
"RTN","GMPLX1",18,0)
PAT() ; Select patient -- returns DFN^NAME^BID
"RTN","GMPLX1",19,0)
 N DIC,X,Y,DFN,VADM,VA,PAT
"RTN","GMPLX1",20,0)
P1 S DIC="^AUPNPAT(",DIC(0)="AEQM" D ^DIC I +Y<1 Q -1
"RTN","GMPLX1",21,0)
 I $P(Y,U,2)'=$P(^DPT(+Y,0),U) W $C(7),!!,"ERROR -- Please check your Patient Files #2 and #9000001 for inconsistencies.",! G P1
"RTN","GMPLX1",22,0)
 S DFN=+Y,PAT=Y D DEM^VADPT
"RTN","GMPLX1",23,0)
 S PAT=PAT_U_$E($P(PAT,U,2))_VA("BID"),AUPNSEX=$P(VADM(5),U)
"RTN","GMPLX1",24,0)
 I VADM(6) S PAT=PAT_U_+VADM(6) ; date of death
"RTN","GMPLX1",25,0)
 Q PAT
"RTN","GMPLX1",26,0)
 ;          
"RTN","GMPLX1",27,0)
VADPT(DFN) ; Get Service/Elig Flags
"RTN","GMPLX1",28,0)
 ;          
"RTN","GMPLX1",29,0)
 ; Returns = 1/0/"" if Y/N/unknown
"RTN","GMPLX1",30,0)
 ;   GMPSC     Service Connected
"RTN","GMPLX1",31,0)
 ;   GMPAGTOR  Agent Orange Exposure
"RTN","GMPLX1",32,0)
 ;   GMPION    Ionizing Radiation Exposure
"RTN","GMPLX1",33,0)
 ;   GMPGULF   Persian Gulf Exposure
"RTN","GMPLX1",34,0)
 ;   GMPMST    Military Sexual Trauma
"RTN","GMPLX1",35,0)
 ;   GMPHNC    Head and/or Neck Cancer
"RTN","GMPLX1",36,0)
 ;   GMPCV     Combat Veteran
"RTN","GMPLX1",37,0)
 ;   GMPSHD    Shipboard Hazard and Defense
"RTN","GMPLX1",38,0)
 ;          
"RTN","GMPLX1",39,0)
 N VAEL,VASV,VAERR,HNC,X D 7^VADPT S GMPSC=VAEL(3),GMPAGTOR=VASV(2)
"RTN","GMPLX1",40,0)
 S GMPION=VASV(3),X=$P($G(^DPT(DFN,.322)),U,10),GMPGULF=$S(X="Y":1,X="N":0,1:"")
"RTN","GMPLX1",41,0)
 S GMPCV=0 I +$G(VASV(10)) S:DT'>$P($G(VASV(10,1)),U) GMPCV=1  ;CV
"RTN","GMPLX1",42,0)
 S GMPSHD=+$G(VASV(14,1))  ;SHAD
"RTN","GMPLX1",43,0)
 S X=$P($$GETSTAT^DGMSTAPI(DFN),"^",2),GMPMST=$S(X="Y":1,X="N":0,1:"")
"RTN","GMPLX1",44,0)
 S X=$$GETCUR^DGNTAPI(DFN,"HNC"),X=+($G(HNC("STAT"))),GMPHNC=$S(X=4:1,X=5:1,X=1:0,X=6:0,1:"")
"RTN","GMPLX1",45,0)
 Q
"RTN","GMPLX1",46,0)
SCS(PROB,SC) ; Get Exposure/Conditions Strings
"RTN","GMPLX1",47,0)
 ;                 
"RTN","GMPLX1",48,0)
 ;   Input     PROB  Pointer to Problem #9000011
"RTN","GMPLX1",49,0)
 ;               
"RTN","GMPLX1",50,0)
 ;   Returns   SC Array passed by reference
"RTN","GMPLX1",51,0)
 ;             SC(1)="AO/IR/EC/HNC/MST/CV/SHD"
"RTN","GMPLX1",52,0)
 ;             SC(2)="A/I/E/H/M/C/S"
"RTN","GMPLX1",53,0)
 ;             SC(3)="AIEHMCS"
"RTN","GMPLX1",54,0)
 ;                     
"RTN","GMPLX1",55,0)
 ;   NOTE:  Military Sexual Trauma (MST) is suppressed
"RTN","GMPLX1",56,0)
 ;          if the current device is a printer.
"RTN","GMPLX1",57,0)
 ;                     
"RTN","GMPLX1",58,0)
 N ND,DA,FL,AO,IR,EC,HNC,MST,PTR S DA=+($G(PROB)) Q:+DA=0
"RTN","GMPLX1",59,0)
 S ND=$G(^AUPNPROB(+DA,1)),AO=+($P(ND,"^",11)),IR=+($P(ND,"^",12))
"RTN","GMPLX1",60,0)
 S EC=+($P(ND,"^",13)),HNC=+($P(ND,"^",15)),MST=+($P(ND,"^",16))
"RTN","GMPLX1",61,0)
 S CV=+($P(ND,"^",17)),SHD=+($P(ND,"^",18))
"RTN","GMPLX1",62,0)
 S PTR=$$PTR^GMPLUTL4
"RTN","GMPLX1",63,0)
 I +AO>0 D
"RTN","GMPLX1",64,0)
 . S:$G(SC(1))'["AO" SC(1)=$G(SC(1))_"/AO" S:$G(SC(2))'["A" SC(2)=$G(SC(2))_"/A" S:$G(SC(3))'["A" SC(3)=$G(SC(3))_"A"
"RTN","GMPLX1",65,0)
 I +IR>0 D
"RTN","GMPLX1",66,0)
 . S:$G(SC(1))'["IR" SC(1)=$G(SC(1))_"/IR" S:$G(SC(2))'["I" SC(2)=$G(SC(2))_"/I" S:$G(SC(3))'["I" SC(3)=$G(SC(3))_"I"
"RTN","GMPLX1",67,0)
 I +EC>0 D
"RTN","GMPLX1",68,0)
 . S:$G(SC(1))'["EC" SC(1)=$G(SC(1))_"/EC" S:$G(SC(2))'["E" SC(2)=$G(SC(2))_"/E" S:$G(SC(3))'["E" SC(3)=$G(SC(3))_"E"
"RTN","GMPLX1",69,0)
 I +HNC>0 D
"RTN","GMPLX1",70,0)
 . S:$G(SC(1))'["HNC" SC(1)=$G(SC(1))_"/HNC" S:$G(SC(2))'["H" SC(2)=$G(SC(2))_"/H" S:$G(SC(3))'["H" SC(3)=$G(SC(3))_"H"
"RTN","GMPLX1",71,0)
 I +MST>0 D
"RTN","GMPLX1",72,0)
 . S:$G(SC(1))'["MST" SC(1)=$G(SC(1))_"/MST" S:$G(SC(2))'["M" SC(2)=$G(SC(2))_"/M" S:$G(SC(3))'["M" SC(3)=$G(SC(3))_"M"
"RTN","GMPLX1",73,0)
 I +CV>0 D
"RTN","GMPLX1",74,0)
 . S:$G(SC(1))'["CV" SC(1)=$G(SC(1))_"/CV" S:$G(SC(2))'["C" SC(2)=$G(SC(2))_"/C" S:$G(SC(3))'["C" SC(3)=$G(SC(3))_"C"
"RTN","GMPLX1",75,0)
 I +PTR'>0 D
"RTN","GMPLX1",76,0)
 . I +SHD>0 S:$G(SC(1))'["SHD" SC(1)=$G(SC(1))_"/SHD" S:$G(SC(2))'["D" SC(2)=$G(SC(2))_"/S" S:$G(SC(3))'["S" SC(3)=$G(SC(3))_"S"
"RTN","GMPLX1",77,0)
 S:$D(SC(1)) SC(1)=$$RS(SC(1)) S:$D(SC(2)) SC(2)=$$RS(SC(2))
"RTN","GMPLX1",78,0)
 Q
"RTN","GMPLX1",79,0)
SCCOND(DFN,SC) ; Get Service/Elig Flags (array)
"RTN","GMPLX1",80,0)
 ; Returns local array .SC passed by value
"RTN","GMPLX1",81,0)
 N HNC,VAEL,VASV,VAERR,X D 7^VADPT
"RTN","GMPLX1",82,0)
 S SC("DFN")=$G(DFN),SC("SC")=$P(VAEL(3),"^",1)
"RTN","GMPLX1",83,0)
 S SC("AO")=$P(VASV(2),"^",1)
"RTN","GMPLX1",84,0)
 S SC("IR")=$P(VASV(3),"^",1)
"RTN","GMPLX1",85,0)
 S X=$P($G(^DPT(DFN,.322)),U,10),SC("PG")=$S(X="Y":1,X="N":0,1:"")
"RTN","GMPLX1",86,0)
 S SC("CV")=0 I +$G(VASV(10)) S:DT'>$P($G(VASV(10,1)),U) SC("CV")=1  ;CV
"RTN","GMPLX1",87,0)
 S SC("SHD")=+$G(VASV(14,1))  ;SHAD
"RTN","GMPLX1",88,0)
 S X=$P($$GETSTAT^DGMSTAPI(DFN),"^",2),SC("MST")=$S(X="Y":1,X="N":0,1:"")
"RTN","GMPLX1",89,0)
 S X=$$GETCUR^DGNTAPI(DFN,"HNC"),X=+($G(HNC("STAT"))),SC("HNC")=$S(X=4:1,X=5:1,X=1:0,X=6:0,1:"")
"RTN","GMPLX1",90,0)
 Q
"RTN","GMPLX1",91,0)
 ;
"RTN","GMPLX1",92,0)
CKDEAD(DATE) ; Dead patient ... continue?  Returns 1 if YES, 0 otherwise
"RTN","GMPLX1",93,0)
 N DIR,X,Y S DIR(0)="YA",DIR("B")="NO"
"RTN","GMPLX1",94,0)
 S DIR("A")="Are you sure you want to continue? "
"RTN","GMPLX1",95,0)
 S DIR("?",1)="   Enter YES to continue and add new problem(s) for this patient:",DIR("?")="   press <return> to select another action."
"RTN","GMPLX1",96,0)
 W $C(7),!!,"DATE OF DEATH: "_$$EXTDT^GMPLX(DATE)
"RTN","GMPLX1",97,0)
 D ^DIR
"RTN","GMPLX1",98,0)
 Q +Y
"RTN","GMPLX1",99,0)
 ;
"RTN","GMPLX1",100,0)
REQPROV() ; Returns requesting provider
"RTN","GMPLX1",101,0)
 N DIR,X,Y
"RTN","GMPLX1",102,0)
 I $D(GMPLUSER) S Y=DUZ_U_$P(^VA(200,DUZ,0),U) Q Y
"RTN","GMPLX1",103,0)
 S DIR("?")="Enter the name of the provider responsible for this data."
"RTN","GMPLX1",104,0)
 S DIR(0)="PA^200:AEQM",DIR("A")="Provider: "
"RTN","GMPLX1",105,0)
 S:$G(GMPROV) DIR("B")=$P(GMPROV,U,2) W ! D ^DIR
"RTN","GMPLX1",106,0)
 I $D(DUOUT)!($D(DTOUT))!(+Y'>0) Q -1
"RTN","GMPLX1",107,0)
 Q Y
"RTN","GMPLX1",108,0)
 ;
"RTN","GMPLX1",109,0)
NAME(USER) ; Formats user name into "Lastname,F"
"RTN","GMPLX1",110,0)
 N NAME,LAST,FIRST
"RTN","GMPLX1",111,0)
 S NAME=$P($G(^VA(200,+USER,0)),U) I '$L(NAME) Q ""
"RTN","GMPLX1",112,0)
 S LAST=$P(NAME,","),FIRST=$P(NAME,",",2)
"RTN","GMPLX1",113,0)
 S:$E(FIRST)=" " FIRST=$E(FIRST,2,99)
"RTN","GMPLX1",114,0)
 Q $E(LAST,1,15)_","_$E(FIRST)
"RTN","GMPLX1",115,0)
 ;
"RTN","GMPLX1",116,0)
SERVICE(USER) ; Returns User's service/section from file #49
"RTN","GMPLX1",117,0)
 N X S X=+$P($G(^VA(200,USER,5)),U)
"RTN","GMPLX1",118,0)
 I $P($G(^DIC(49,X,0)),U,9)'="C" S X=0
"RTN","GMPLX1",119,0)
 S:X>0 X=X_U_$P($G(^DIC(49,X,0)),U) S:X'>0 X=""
"RTN","GMPLX1",120,0)
 Q X
"RTN","GMPLX1",121,0)
 ;
"RTN","GMPLX1",122,0)
SERV(X) ; Return service name abbreviation
"RTN","GMPLX1",123,0)
 N NODE,ABBREV
"RTN","GMPLX1",124,0)
 S NODE=$G(^DIC(49,+X,0)) I NODE="" Q ""
"RTN","GMPLX1",125,0)
 S ABBREV=$P(NODE,U,2) I ABBREV="" S ABBREV=$E($P(NODE,U),1,4)
"RTN","GMPLX1",126,0)
 Q ABBREV_"/"
"RTN","GMPLX1",127,0)
 ;
"RTN","GMPLX1",128,0)
CLINIC(LAST) ; Returns clinic from file #44
"RTN","GMPLX1",129,0)
 N X,Y,DIC,DIR S Y="" G:$E(GMPLVIEW("VIEW"))="S" CLINQ
"RTN","GMPLX1",130,0)
 S DIR(0)="FAO^1:30",DIR("A")="Clinic: " S:$L(LAST) DIR("B")=$P(LAST,U,2)
"RTN","GMPLX1",131,0)
 S DIR("?")="Enter the clinic to be associated with these problems, if available"
"RTN","GMPLX1",132,0)
 S DIR("??")="^D LISTCLIN^GMPLMGR1 W !,DIR(""?"")_""."""
"RTN","GMPLX1",133,0)
CLIN1 ; Ask Clinic
"RTN","GMPLX1",134,0)
 D ^DIR S:$D(DUOUT)!($D(DTOUT)) Y="^" S:Y="@" Y="" G:("^"[Y) CLINQ
"RTN","GMPLX1",135,0)
 S DIC="^SC(",DIC(0)="EMQ",DIC("S")="I $P(^(0),U,3)=""C"""
"RTN","GMPLX1",136,0)
 D ^DIC I Y'>0 W !?5,"Only clinics are allowed!",! G CLIN1
"RTN","GMPLX1",137,0)
CLINQ ; Quit Asking
"RTN","GMPLX1",138,0)
 Q Y
"RTN","GMPLX1",139,0)
 ;
"RTN","GMPLX1",140,0)
VIEW(USER) ; Returns user's preferred view
"RTN","GMPLX1",141,0)
 N X S X=$P($G(^VA(200,USER,125)),U)
"RTN","GMPLX1",142,0)
 Q X
"RTN","GMPLX1",143,0)
 ;
"RTN","GMPLX1",144,0)
VOCAB() ; Select search vocabulary
"RTN","GMPLX1",145,0)
 N DIR,X,Y S DIR(0)="SAOM^N:NURSING;I:IMMUNOLOGIC;D:DENTAL;S:SOCIAL WORK;P:GENERAL PROBLEM"
"RTN","GMPLX1",146,0)
 S DIR("A")="Select Specialty Subset: ",DIR("B")="GENERAL PROBLEM"
"RTN","GMPLX1",147,0)
 S DIR("?",1)="Because many discipline-specific terms are synonyms to other terms,"
"RTN","GMPLX1",148,0)
 S DIR("?",2)="they are not accessible unless you specify the appropriate subset of the"
"RTN","GMPLX1",149,0)
 S DIR("?",3)="Clinical Lexicon to select from.  Choose from:  Nursing"
"RTN","GMPLX1",150,0)
 S DIR("?",4)=$$REPEAT^XLFSTR(" ",48)_"Immunologic"
"RTN","GMPLX1",151,0)
 S DIR("?",5)=$$REPEAT^XLFSTR(" ",48)_"Dental"
"RTN","GMPLX1",152,0)
 S DIR("?",6)=$$REPEAT^XLFSTR(" ",48)_"Social Work"
"RTN","GMPLX1",153,0)
 S DIR("?")=$$REPEAT^XLFSTR(" ",48)_"General Problem"
"RTN","GMPLX1",154,0)
 D ^DIR S X=$S(Y="N":"NUR",Y="I":"IMM",Y="D":"DEN",Y="S":"SOC",Y="P":"PL1",1:"^")
"RTN","GMPLX1",155,0)
 Q X
"RTN","GMPLX1",156,0)
 ;
"RTN","GMPLX1",157,0)
PARAMS ; Edit pkg parameters in file #125.99
"RTN","GMPLX1",158,0)
 N DIE,DA,DR,OLDVERFY,VERFY,BLANK S BLANK="       "
"RTN","GMPLX1",159,0)
 S OLDVERFY=+$P($G(^GMPL(125.99,1,0)),U,2)
"RTN","GMPLX1",160,0)
 S DIE="^GMPL(125.99,",DA=1,DR="1:6" D ^DIE
"RTN","GMPLX1",161,0)
 Q:+$P($G(^GMPL(125.99,1,0)),U,2)=OLDVERFY
"RTN","GMPLX1",162,0)
 S DA(1)=$O(^ORD(101,"B","GMPL PROBLEM LIST",0)) Q:'DA(1)
"RTN","GMPLX1",163,0)
 S VERFY=$O(^ORD(101,"B","GMPL VERIFY",0)) W "."
"RTN","GMPLX1",164,0)
 S DA=$O(^ORD(101,DA(1),10,"B",VERFY,0)) Q:'DA
"RTN","GMPLX1",165,0)
 S DR=$S(OLDVERFY:"2///@;6///^S X=BLANK",1:"2////$;6///@") W "."
"RTN","GMPLX1",166,0)
 S DIE="^ORD(101,"_DA(1)_",10,"
"RTN","GMPLX1",167,0)
 D ^DIE W "."
"RTN","GMPLX1",168,0)
 Q
"RTN","GMPLX1",169,0)
RS(X) ; Remove Slashes
"RTN","GMPLX1",170,0)
 S X=$G(X) F  Q:$E(X,1)'="/"  S X=$E(X,2,$L(X))
"RTN","GMPLX1",171,0)
 F  Q:$E(X,$L(X))'="/"  S X=$E(X,1,($L(X)-1))
"RTN","GMPLX1",172,0)
 Q X
"VER")
8.0^22.0
"^DD",9000011,9000011,1.17,0)
COMBAT VETERAN^S^1:YES;0:NO;^1;17^Q
"^DD",9000011,9000011,1.17,3)
If this problem is a result of combat it may be flagged here
"^DD",9000011,9000011,1.17,"DT")
3031125
"^DD",9000011,9000011,1.18,0)
SHIPBOARD HAZARD & DEFENSE^S^1:YES;0:NO;^1;18^Q
"^DD",9000011,9000011,1.18,3)
If this problem is a result of SHAD, it may be flagged here
"^DD",9000011,9000011,1.18,"DT")
3060918
**INSTALL NAME**
GMRA*4.0*38
"BLD",6452,0)
GMRA*4.0*38^ADVERSE REACTION TRACKING^0^3070504^y
"BLD",6452,4,0)
^9.64PA^^
"BLD",6452,6)
2^
"BLD",6452,6.3)
2
"BLD",6452,"ABPKG")
n
"BLD",6452,"INIT")
POST^GMRAY38
"BLD",6452,"KRN",0)
^9.67PA^8989.52^19
"BLD",6452,"KRN",.4,0)
.4
"BLD",6452,"KRN",.401,0)
.401
"BLD",6452,"KRN",.402,0)
.402
"BLD",6452,"KRN",.403,0)
.403
"BLD",6452,"KRN",.5,0)
.5
"BLD",6452,"KRN",.84,0)
.84
"BLD",6452,"KRN",3.6,0)
3.6
"BLD",6452,"KRN",3.8,0)
3.8
"BLD",6452,"KRN",9.2,0)
9.2
"BLD",6452,"KRN",9.8,0)
9.8
"BLD",6452,"KRN",9.8,"NM",0)
^9.68A^3^3
"BLD",6452,"KRN",9.8,"NM",1,0)
GMRAGUI1^^0^B59106496
"BLD",6452,"KRN",9.8,"NM",2,0)
GMRAPET0^^0^B32334932
"BLD",6452,"KRN",9.8,"NM",3,0)
GMRAY38^^0^B7269151
"BLD",6452,"KRN",9.8,"NM","B","GMRAGUI1",1)

"BLD",6452,"KRN",9.8,"NM","B","GMRAPET0",2)

"BLD",6452,"KRN",9.8,"NM","B","GMRAY38",3)

"BLD",6452,"KRN",19,0)
19
"BLD",6452,"KRN",19.1,0)
19.1
"BLD",6452,"KRN",101,0)
101
"BLD",6452,"KRN",409.61,0)
409.61
"BLD",6452,"KRN",771,0)
771
"BLD",6452,"KRN",870,0)
870
"BLD",6452,"KRN",8989.51,0)
8989.51
"BLD",6452,"KRN",8989.52,0)
8989.52
"BLD",6452,"KRN",8994,0)
8994
"BLD",6452,"KRN","B",.4,.4)

"BLD",6452,"KRN","B",.401,.401)

"BLD",6452,"KRN","B",.402,.402)

"BLD",6452,"KRN","B",.403,.403)

"BLD",6452,"KRN","B",.5,.5)

"BLD",6452,"KRN","B",.84,.84)

"BLD",6452,"KRN","B",3.6,3.6)

"BLD",6452,"KRN","B",3.8,3.8)

"BLD",6452,"KRN","B",9.2,9.2)

"BLD",6452,"KRN","B",9.8,9.8)

"BLD",6452,"KRN","B",19,19)

"BLD",6452,"KRN","B",19.1,19.1)

"BLD",6452,"KRN","B",101,101)

"BLD",6452,"KRN","B",409.61,409.61)

"BLD",6452,"KRN","B",771,771)

"BLD",6452,"KRN","B",870,870)

"BLD",6452,"KRN","B",8989.51,8989.51)

"BLD",6452,"KRN","B",8989.52,8989.52)

"BLD",6452,"KRN","B",8994,8994)

"BLD",6452,"QUES",0)
^9.62^^
"BLD",6452,"REQB",0)
^9.611^1^1
"BLD",6452,"REQB",1,0)
GMRA*4.0*36^1
"BLD",6452,"REQB","B","GMRA*4.0*36",1)

"INIT")
POST^GMRAY38
"MBREQ")
0
"PKG",140,-1)
1^1
"PKG",140,0)
ADVERSE REACTION TRACKING^GMRA^Allergy Tracking System
"PKG",140,20,0)
^9.402P^^
"PKG",140,22,0)
^9.49I^1^1
"PKG",140,22,1,0)
4.0^2960328^2960506^10
"PKG",140,22,1,"PAH",1,0)
38^3070504^1326
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
3
"RTN","GMRAGUI1")
0^1^B59106496^B56993804
"RTN","GMRAGUI1",1,0)
GMRAGUI1 ;SLC/DAN - CPRS GUI support ;11/17/06  09:50
"RTN","GMRAGUI1",2,0)
 ;;4.0;Adverse Reaction Tracking;**21,25,36,38**;Mar 29, 1996;Build 2
"RTN","GMRAGUI1",3,0)
 ;
"RTN","GMRAGUI1",4,0)
 Q
"RTN","GMRAGUI1",5,0)
EN1 ; GETREC, cont'd
"RTN","GMRAGUI1",6,0)
OBSV ;  Get OBSERVATIONS from file 120.85
"RTN","GMRAGUI1",7,0)
 S STRING="~OBSERVATIONS" D NEXT
"RTN","GMRAGUI1",8,0)
 S OBSIEN=0
"RTN","GMRAGUI1",9,0)
OBSLOOP S OBSIEN=$O(^GMR(120.85,"C",GMRAIEN,OBSIEN)) G:OBSIEN<1 EXIT
"RTN","GMRAGUI1",10,0)
 S GMRA(1)=$G(^GMR(120.85,OBSIEN,0)) Q:'$L(GMRA(1))
"RTN","GMRAGUI1",11,0)
 S STRING="tRecord            : "_OBSIEN D NEXT
"RTN","GMRAGUI1",12,0)
 S USRNAM=""
"RTN","GMRAGUI1",13,0)
 S USR=$P(GMRA(1),U,13) I USR'="" D GETUSR
"RTN","GMRAGUI1",14,0)
 S Y=$P(GMRA(1),U,1) X ^DD("DD")
"RTN","GMRAGUI1",15,0)
 S STRING="tDate/Time of Event: "_Y D NEXT
"RTN","GMRAGUI1",16,0)
 S STRING="tObserver          : "_USRNAM D NEXT
"RTN","GMRAGUI1",17,0)
 S SEVCOD=$P(GMRA(1),U,14)
"RTN","GMRAGUI1",18,0)
 S SEVER=$S(SEVCOD=1:"MILD",SEVCOD=2:"MODERATE",SEVCOD=3:"SEVERE",1:"")
"RTN","GMRAGUI1",19,0)
 S STRING="tSeverity          : "_SEVER D NEXT
"RTN","GMRAGUI1",20,0)
 S Y=$P(GMRA(1),U,18) X ^DD("DD")
"RTN","GMRAGUI1",21,0)
 S STRING="tDate Reported     : "_Y D NEXT
"RTN","GMRAGUI1",22,0)
 S USRNAM=""
"RTN","GMRAGUI1",23,0)
 S USR=$P(GMRA(1),U,19) I USR'="" D GETUSR
"RTN","GMRAGUI1",24,0)
 S STRING="tReporting User    : "_USRNAM D NEXT
"RTN","GMRAGUI1",25,0)
 S STRING="t" F I=1:1:60 S STRING=STRING_"-"
"RTN","GMRAGUI1",26,0)
 D NEXT
"RTN","GMRAGUI1",27,0)
 G OBSLOOP
"RTN","GMRAGUI1",28,0)
EXIT Q
"RTN","GMRAGUI1",29,0)
NEXT ;SET ARRAY NODE AND INCREMENT ARRAY COUNTER
"RTN","GMRAGUI1",30,0)
 S @GMRARRAY@(ND)=STRING,ND=ND+1,STRING=""
"RTN","GMRAGUI1",31,0)
 Q
"RTN","GMRAGUI1",32,0)
GETUSR S USRNAM=$$GET1^DIQ(200,USR_",",".01")
"RTN","GMRAGUI1",33,0)
 Q
"RTN","GMRAGUI1",34,0)
 ;
"RTN","GMRAGUI1",35,0)
EIE(GMRAIEN,GMRADFN,GMRARRAY) ;Mark individual entry as entered in error
"RTN","GMRAGUI1",36,0)
 N DIE,DA,DR,Y,DIK,DFN,OROLD,VAIN,X,GMRAOUT,GMRAPA
"RTN","GMRAGUI1",37,0)
 L +^XTMP("GMRAED",GMRADFN):1 I '$T D MESS Q
"RTN","GMRAGUI1",38,0)
 S GMRAPA=GMRAIEN
"RTN","GMRAGUI1",39,0)
 S DIE="^GMR(120.8,",DA=GMRAPA,DR="15///1;22///1;23///"_@GMRARRAY@("GMRAERRDT")_";24////"_$G(@GMRARRAY@("GMRAERRBY"),.5) ;36
"RTN","GMRAGUI1",40,0)
 D ^DIE ;Entered in error on date/time by user
"RTN","GMRAGUI1",41,0)
 I $D(@GMRARRAY@("GMRAERRCMTS")) D ADCOM(GMRAPA,"E",$NA(@GMRARRAY@("GMRAERRCMTS"))) ;add comments
"RTN","GMRAGUI1",42,0)
 I $$NKASCR^GMRANKA($P(^GMR(120.8,GMRAPA,0),U)) D
"RTN","GMRAGUI1",43,0)
 .S DIK="^GMR(120.86,",DA=$P(^GMR(120.8,GMRAPA,0),U)
"RTN","GMRAGUI1",44,0)
 .D ^DIK ;If patient's last allergy marked as entered in error then delete assessment
"RTN","GMRAGUI1",45,0)
 S GMRAPA(0)=$G(^GMR(120.8,GMRAPA,0)) Q:GMRAPA(0)=""
"RTN","GMRAGUI1",46,0)
 S GMRAOUT=0
"RTN","GMRAGUI1",47,0)
 D EN1^GMRAEAB ;Sends entered in error bulletin to appropriate mail groups
"RTN","GMRAGUI1",48,0)
 D EN1^GMRAPET0(GMRADFN,GMRAPA,"E",.GMRAOUT) ;21 File Progress Note
"RTN","GMRAGUI1",49,0)
 S DFN=GMRADFN
"RTN","GMRAGUI1",50,0)
 D INP^VADPT S X=$$FIND1^DIC(101,,"BX","GMRA ENTERED IN ERROR")_";ORD(101,"
"RTN","GMRAGUI1",51,0)
 D:X EN^XQOR ;Process protocols hanging off of "entered in error" protocol
"RTN","GMRAGUI1",52,0)
 L -^XTMP("GMRAED",GMRADFN)
"RTN","GMRAGUI1",53,0)
 S ORY=0_$S(+$G(GMRAPN)>0:("^"_+$G(GMRAPN)),1:"") ;38 Return IEN of progress note if created
"RTN","GMRAGUI1",54,0)
 Q
"RTN","GMRAGUI1",55,0)
 ;
"RTN","GMRAGUI1",56,0)
ADCOM(ENTRY,TYPE,GMRACOM) ;Add comments to allergies
"RTN","GMRAGUI1",57,0)
 ;
"RTN","GMRAGUI1",58,0)
 N FDA,GMRAI,X,DIWL,DIWR
"RTN","GMRAGUI1",59,0)
 K ^UTILITY($J,"W") S DIWL=1,DIWR=60 S GMRAI=0 F  S GMRAI=$O(@GMRACOM@(GMRAI)) Q:'+GMRAI  S X=@GMRACOM@(GMRAI) D ^DIWP
"RTN","GMRAGUI1",60,0)
 S GMRACOM="^UTILITY($J,""W"",1)"
"RTN","GMRAGUI1",61,0)
 S FDA(120.826,"+1,"_ENTRY_",",.01)=$$NOW^XLFDT
"RTN","GMRAGUI1",62,0)
 S FDA(120.826,"+1,"_ENTRY_",",1)=DUZ
"RTN","GMRAGUI1",63,0)
 S FDA(120.826,"+1,"_ENTRY_",",1.5)=TYPE
"RTN","GMRAGUI1",64,0)
 S FDA(120.826,"+1,"_ENTRY_",",2)=GMRACOM
"RTN","GMRAGUI1",65,0)
 D UPDATE^DIE("","FDA")
"RTN","GMRAGUI1",66,0)
 Q
"RTN","GMRAGUI1",67,0)
 ;
"RTN","GMRAGUI1",68,0)
NKA ;Change patient assessment to NKA
"RTN","GMRAGUI1",69,0)
 ;
"RTN","GMRAGUI1",70,0)
 N DA,DR,DIE,NKA,DFN
"RTN","GMRAGUI1",71,0)
 S DFN=ORDFN
"RTN","GMRAGUI1",72,0)
 L +^XTMP("GMRAED",DFN):1 I '$T D MESS Q
"RTN","GMRAGUI1",73,0)
 S NKA=$$NKA^GMRANKA(DFN)
"RTN","GMRAGUI1",74,0)
 I NKA=0 Q  ;Patient is already NKA
"RTN","GMRAGUI1",75,0)
 I NKA=1 S ORY="-1^Patient has active allergies - can't mark as NKA" Q
"RTN","GMRAGUI1",76,0)
 L +^GMR(120.86,0):5 I '$T S ORY="-1^Unable to update assessment - try again." Q
"RTN","GMRAGUI1",77,0)
 I '$D(^GMR(120.86,DFN,0)) D  ;Add assessment entry
"RTN","GMRAGUI1",78,0)
 .S $P(^GMR(120.86,0),U,3,4)=(DFN_"^"_($P(^GMR(120.86,0),U,4)+1))
"RTN","GMRAGUI1",79,0)
 .S ^GMR(120.86,DFN,0)=DFN_U,^GMR(120.86,"B",DFN,DFN)=""
"RTN","GMRAGUI1",80,0)
 L -^GMR(120.86,0) L +^GMR(120.86,DFN,0):5 I '$T S ORY="-1^Unable to update assessment - try again." Q
"RTN","GMRAGUI1",81,0)
 S DIE="^GMR(120.86,",DA=DFN,DR="1////0;2////"_DUZ_";3///NOW" D ^DIE
"RTN","GMRAGUI1",82,0)
 S ORY=0
"RTN","GMRAGUI1",83,0)
 L -^XTMP("GMRAED",DFN)
"RTN","GMRAGUI1",84,0)
 Q
"RTN","GMRAGUI1",85,0)
 ;
"RTN","GMRAGUI1",86,0)
UPDATE(GMRAIEN,DFN,GMRARRAY) ;Add/edit allergies
"RTN","GMRAGUI1",87,0)
 N NEW,NKA,FDA,NODE,IEN,SUB,FILE,DA,DIK,SIEN,GMRAS0,GMRAIEN,GMRAL,GMRAPA,GMRAAR,GMRALL,GMRADFN,GMRAOUT,GMRAROT
"RTN","GMRAGUI1",88,0)
 S NEW='$G(GMRAIEN)
"RTN","GMRAGUI1",89,0)
 I NEW,$$DUPCHK^GMRAOR0(DFN,$P(@GMRARRAY@("GMRAGNT"),U))=1 S ORY="-1^Patient already has a "_$P(@GMRARRAY@("GMRAGNT"),U)_" reaction entered.  No duplicates allowed." Q
"RTN","GMRAGUI1",90,0)
 L +^XTMP("GMRAED",DFN):1 I '$T D MESS Q
"RTN","GMRAGUI1",91,0)
 D SITE^GMRAUTL S GMRASITE(0)=$G(^GMRD(120.84,+GMRASITE,0))
"RTN","GMRAGUI1",92,0)
 S NKA='$$NKA^GMRANKA(DFN) ;is patient NKA?
"RTN","GMRAGUI1",93,0)
 I NKA,NEW D
"RTN","GMRAGUI1",94,0)
 .S FDA(120.86,"?+"_DFN_",",.01)=DFN
"RTN","GMRAGUI1",95,0)
 .S FDA(120.86,"?+"_DFN_",",1)=1
"RTN","GMRAGUI1",96,0)
 .S FDA(120.86,"?+"_DFN_",",2)=DUZ
"RTN","GMRAGUI1",97,0)
 .S FDA(120.86,"?+"_DFN_",",3)=$G(@GMRARRAY@("GMRAORDT"),$$NOW^XLFDT)
"RTN","GMRAGUI1",98,0)
 .S IEN(DFN)=DFN
"RTN","GMRAGUI1",99,0)
 .D UPDATE^DIE("","FDA","IEN")
"RTN","GMRAGUI1",100,0)
 K FDA,IEN
"RTN","GMRAGUI1",101,0)
 S NODE=$S($G(NEW):"+1,",1:(GMRAIEN_","))
"RTN","GMRAGUI1",102,0)
 S:$G(NEW) FDA(120.8,NODE,.01)=DFN
"RTN","GMRAGUI1",103,0)
 I $P($G(@GMRARRAY@("GMRAGNT")),U,2)["50.67" S $P(@GMRARRAY@("GMRAGNT"),U,2)=$$TGTOG^PSNAPIS($P(@GMRARRAY@("GMRAGNT"),U))_";PSNDF(50.6,"
"RTN","GMRAGUI1",104,0)
 F SUB="GMRAGNT;.02","GMRATYPE;3.1","GMRANATR;17","GMRAORIG;5","GMRAORDT;4","GMRAOBHX;6" D
"RTN","GMRAGUI1",105,0)
 .S FDA(120.8,NODE,$P(SUB,";",2))=$P(@GMRARRAY@($P(SUB,";")),U)
"RTN","GMRAGUI1",106,0)
 .I (SUB["GMRAGNT"),NEW S FDA(120.8,NODE,1)=$P(@GMRARRAY@($P(SUB,";")),U,2)
"RTN","GMRAGUI1",107,0)
 D UPDATE^DIE("","FDA","IEN")
"RTN","GMRAGUI1",108,0)
 S:NEW GMRAIEN=IEN(1)
"RTN","GMRAGUI1",109,0)
 K FDA
"RTN","GMRAGUI1",110,0)
 F SUB="GMRACHT","GMRAIDBN" D
"RTN","GMRAGUI1",111,0)
 .Q:'$D(@GMRARRAY@(SUB))  ;Stop if no updates
"RTN","GMRAGUI1",112,0)
 .S FILE=$S(SUB="GMRACHT":120.813,1:120.814)
"RTN","GMRAGUI1",113,0)
 .S FDA(FILE,"+1,"_GMRAIEN_",",.01)=@GMRARRAY@(SUB,1)
"RTN","GMRAGUI1",114,0)
 .S FDA(FILE,"+1,"_GMRAIEN_",",1)=DUZ
"RTN","GMRAGUI1",115,0)
 .D UPDATE^DIE("","FDA")
"RTN","GMRAGUI1",116,0)
 I $D(@GMRARRAY@("GMRACMTS")) D ADCOM(GMRAIEN,"O",$NA(@GMRARRAY@("GMRACMTS"))) ;Add comments if included
"RTN","GMRAGUI1",117,0)
 K FDA
"RTN","GMRAGUI1",118,0)
 S SUB=0 F  S SUB=$O(@GMRARRAY@("GMRASYMP",SUB)) Q:'+SUB  D
"RTN","GMRAGUI1",119,0)
 .S GMRAS0=^(SUB) ;Naked from above
"RTN","GMRAGUI1",120,0)
 .Q:$P(^(SUB),U)=""  ;25 No text or free text entered so don't store
"RTN","GMRAGUI1",121,0)
 .S SIEN=$O(^GMR(120.8,GMRAIEN,10,"B",$P(GMRAS0,U),0))
"RTN","GMRAGUI1",122,0)
 .I SIEN,$P(^GMR(120.8,GMRAIEN,10,SIEN,0),U,4)=$P(GMRAS0,U,3) Q  ;Exists and nothing has changed
"RTN","GMRAGUI1",123,0)
 .I SIEN,$P(GMRAS0,U,5)="@" S DIK="^GMR(120.8,"_GMRAIEN_",",DA(1)=GMRAIEN,DA=SIEN D ^DIK Q  ;Sign/symptom deleted
"RTN","GMRAGUI1",124,0)
 .S:'SIEN FDA(120.81,"+1,"_GMRAIEN_",",.01)=$S($P(GMRAS0,U)="FT":$O(^GMRD(120.83,"B","OTHER REACTION",0)),1:$P(GMRAS0,U))
"RTN","GMRAGUI1",125,0)
 .S NODE=$S(SIEN:SIEN_","_GMRAIEN,1:"+1,"_GMRAIEN_",")
"RTN","GMRAGUI1",126,0)
 .S:$P(GMRAS0,U)="FT" FDA(120.81,NODE,1)=$P(GMRAS0,U,2)
"RTN","GMRAGUI1",127,0)
 .S FDA(120.81,NODE,2)=DUZ
"RTN","GMRAGUI1",128,0)
 .S FDA(120.81,NODE,3)=$P(GMRAS0,U,3)
"RTN","GMRAGUI1",129,0)
 .D UPDATE^DIE("","FDA","","ERR")
"RTN","GMRAGUI1",130,0)
 .S GMRAROT($P(GMRAS0,U,2))="" ;21 record s/s added
"RTN","GMRAGUI1",131,0)
 I NEW D
"RTN","GMRAGUI1",132,0)
 .S GMRALL(GMRAIEN)="" D VAD^GMRAUTL1(DFN,,.GMRALOC,.GMRANAM) D EN7^GMRAMCB ;Send mark chart/ID band bulletin if needed.
"RTN","GMRAGUI1",133,0)
 .I $P(@GMRARRAY@("GMRAOBHX"),U)="o" D  ;if observed reaction add data to 120.85
"RTN","GMRAGUI1",134,0)
 ..S GMRAOUT=0 ;21
"RTN","GMRAGUI1",135,0)
 ..S GMRAL(GMRAIEN,"O",GMRAIEN)=$G(@GMRARRAY@("GMRARDT"))_"^"_$G(@GMRARRAY@("GMRASEVR"))
"RTN","GMRAGUI1",136,0)
 ..S GMRADFN=DFN
"RTN","GMRAGUI1",137,0)
 ..S GMRAL(GMRAIEN)="^^"_$P($G(@GMRARRAY@("GMRAGNT")),U)_"^^^^"_$G(@GMRARRAY@("GMRAORIG"))
"RTN","GMRAGUI1",138,0)
 ..M GMRAL(GMRAIEN,"S")=@GMRARRAY@("GMRASYMP")
"RTN","GMRAGUI1",139,0)
 ..S SUB=0 F  S SUB=$O(GMRAL(GMRAIEN,"S",SUB)) Q:'+SUB  S $P(GMRAL(GMRAIEN,"S",SUB),U,2)=$P(GMRAL(GMRAIEN,"S",SUB),U,2)_"^" S:$P(GMRAL(GMRAIEN,"S",SUB),U)="FT" $P(GMRAL(GMRAIEN,"S",SUB),U)=$O(^GMRD(120.83,"B","OTHER REACTION",0))
"RTN","GMRAGUI1",140,0)
 ..S GMRAL=GMRAIEN
"RTN","GMRAGUI1",141,0)
 ..D ADVERSE^GMRAOR7(GMRAIEN,.GMRAL) ;adds entry to 120.85
"RTN","GMRAGUI1",142,0)
 ..S GMRAIEN(GMRAIEN)="" ;21
"RTN","GMRAGUI1",143,0)
 ..D EN1^GMRAPET0(GMRADFN,.GMRAIEN,"S",.GMRAOUT) ;21 File progress note
"RTN","GMRAGUI1",144,0)
 ..I $G(@GMRARRAY@("GMRATYPE"))["D" S GMRAPA=GMRAIEN D EN1^GMRAPTB ;21 Send med-watch update
"RTN","GMRAGUI1",145,0)
 .S GMRAAR=$P($G(@GMRARRAY@("GMRAGNT")),U,2),GMRAPA=GMRAIEN
"RTN","GMRAGUI1",146,0)
 .D EN1^GMRAOR9 S ^TMP($J,"GMRASF",1,GMRAPA)="" D RANGE^GMRASIGN(1) ;add ingredients/classes send appropriate bulletins
"RTN","GMRAGUI1",147,0)
 S ORY=0_$S(+$G(GMRAPN)>0:("^"_+$G(GMRAPN)),1:"") ;38 If note was created send back IEN
"RTN","GMRAGUI1",148,0)
 L -^XTMP("GMRAED",DFN)
"RTN","GMRAGUI1",149,0)
 Q
"RTN","GMRAGUI1",150,0)
 ;
"RTN","GMRAGUI1",151,0)
MESS ;Give out locked message
"RTN","GMRAGUI1",152,0)
 N GMRAXBOS,GMRAL1,GMRAL2
"RTN","GMRAGUI1",153,0)
 S GMRAXBOS=$$BROKER^XWBLIB ;In GUI?
"RTN","GMRAGUI1",154,0)
 S GMRAL1="Another user is editing this patient's allergy information."
"RTN","GMRAGUI1",155,0)
 S GMRAL2="Please refresh/review the patient's information before proceeding."
"RTN","GMRAGUI1",156,0)
 I 'GMRAXBOS W !,GMRAL1,!,GMRAL2 D WAIT^GMRAFX3 Q
"RTN","GMRAGUI1",157,0)
 S ORY="-1^"_GMRAL1_"  "_GMRAL2
"RTN","GMRAGUI1",158,0)
 Q
"RTN","GMRAPET0")
0^2^B32334932^B31689941
"RTN","GMRAPET0",1,0)
GMRAPET0 ;HIRMFO/RM-VERIFIED ALLERGY TASKS ;11/17/06  10:27
"RTN","GMRAPET0",2,0)
 ;;4.0;Adverse Reaction Tracking;**6,17,21,20,38**;Mar 29, 1996;Build 2
"RTN","GMRAPET0",3,0)
EN1(GMRADFN,GMRAPA,GMRACT,GMRAOUT) ;
"RTN","GMRAPET0",4,0)
 ; ENTRY TO PERFORM ALL OF THE TASKS NECESSARY FOR
"RTN","GMRAPET0",5,0)
 ;                 A PROGRESS NOTE TO BE ENTERED BY ART
"RTN","GMRAPET0",6,0)
 ;     INPUT:
"RTN","GMRAPET0",7,0)
 ;           GMRADFN = PATIENT IEN IN THE PATIENT FILE
"RTN","GMRAPET0",8,0)
 ;           GMRAPA  = THE IEN IN THE PATIENT ALLERGY FILE
"RTN","GMRAPET0",9,0)
 ;           GMRACT  = THE ACTION TO BE ENTERED FOR THIS REACTION
"RTN","GMRAPET0",10,0)
 ;                   = "V" VERIFICATION OF A REACTION
"RTN","GMRAPET0",11,0)
 ;                   = "S" SIGN OFF OF A REACTION
"RTN","GMRAPET0",12,0)
 ;                   = "M" MEDWATCH FORM ENTERD
"RTN","GMRAPET0",13,0)
 ;                   = "E" REACTION ENERED IN ERROR
"RTN","GMRAPET0",14,0)
 ;      OUTPUT:
"RTN","GMRAPET0",15,0)
 ;           GMRAOUT = REACTION ALL WAS PASSED
"RTN","GMRAPET0",16,0)
 ;                   = 1 USER ABORT OR PN FAIL IN SOME WAY
"RTN","GMRAPET0",17,0)
 ;                   = 0 PASSED
"RTN","GMRAPET0",18,0)
 ;
"RTN","GMRAPET0",19,0)
 ;      VARABLE LIST
"RTN","GMRAPET0",20,0)
 ;        GMRACW = IS THE PROGRESS NOTE TITLE
"RTN","GMRAPET0",21,0)
 ;       GMRALOC = IS THE LOCATION OF THE PATIENT
"RTN","GMRAPET0",22,0)
 ;      GMRAHLOC = IS THE LOCATION IN FILE 44
"RTN","GMRAPET0",23,0)
 ;       GMRADFN = IS THE PATIENT IEN
"RTN","GMRAPET0",24,0)
 ;        GMRADT = IS THE DATE THE EVENT TOOK PLACE
"RTN","GMRAPET0",25,0)
 ;       GMRADUZ = IS THE USER WHO ENTERED THE INFORMATION
"RTN","GMRAPET0",26,0)
 ;        GMRAPN = IS THE IEN OF THE PROGRESS NOTE THAT WAS ENTERED
"RTN","GMRAPET0",27,0)
 ;
"RTN","GMRAPET0",28,0)
 ;CHECKING FOR A VALID TITLE
"RTN","GMRAPET0",29,0)
 K ^TMP("TIUP",$J),GMRAPN
"RTN","GMRAPET0",30,0)
 N GMRACW,GMRALOC,GMRAHLOC,GMRAXBOS ;21
"RTN","GMRAPET0",31,0)
 S GMRAPN=-1,GMRAXBOS=$$BROKER^XWBLIB ;21 Got GUI?
"RTN","GMRAPET0",32,0)
 I "VSME"'[GMRACT S GMRAOUT=1 D EXIT Q
"RTN","GMRAPET0",33,0)
 ; The following lines of code which reference Progress Notes files and
"RTN","GMRAPET0",34,0)
 ; routines will have to change when TIU replaces Progress Notes.
"RTN","GMRAPET0",35,0)
 ;S GMRACW=0 F  S GMRACW=$O(^GMR(121.2,"B","ADVERSE REACTION/ALLERGY",GMRACW)) Q:GMRACW<1  I $P($G(^GMR(121.1,$P($G(^GMR(121.2,GMRACW,0)),U,2),0)),U)="GENERAL NOTE" Q
"RTN","GMRAPET0",36,0)
 ;-----ADDED BY VAUGHN 1/13/97 FOR TIU REPLACES LINE ABOVE----
"RTN","GMRAPET0",37,0)
 S GMRACW=+$$WHATITLE^TIUPUTU("ADVERSE REACTION/ALLERGY")
"RTN","GMRAPET0",38,0)
 ;------END---
"RTN","GMRAPET0",39,0)
 ;-----CHANGED BY VAUGHN 1/13/97 FOR TIU---
"RTN","GMRAPET0",40,0)
 I GMRACW<1!($T(NEW^TIUPNAPI)']"")!('$$CANPICK^TIULP(GMRACW)) S GMRAOUT=1 D EXIT Q  ;21
"RTN","GMRAPET0",41,0)
 ;I GMRACW<1!($T(PN^GMRPART)']"") S GMRAOUT=1 D EXIT Q
"RTN","GMRAPET0",42,0)
 ;-----END----
"RTN","GMRAPET0",43,0)
 D @GMRACT I GMRAOUT D EXIT Q  ; THIS TELL'S THE PROGRAM WHERE TO GO
"RTN","GMRAPET0",44,0)
 S GMRALOC=""
"RTN","GMRAPET0",45,0)
 D VAD^GMRAUTL1(GMRADFN,"",.GMRALOC,"","","")
"RTN","GMRAPET0",46,0)
 I GMRALOC'="" S GMRAHLOC=+$G(^DIC(42,GMRALOC,44))
"RTN","GMRAPET0",47,0)
 ;E  I '$G(GMRAXBOS) D ASK ;20
"RTN","GMRAPET0",48,0)
 ; Call to Progress Notes
"RTN","GMRAPET0",49,0)
 ; vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv
"RTN","GMRAPET0",50,0)
 ;S:'GMRAOUT GMRAPN=+$$PN^GMRPART(GMRADFN,GMRADUZ,GMRADT,GMRACW,GMRAHLOC)
"RTN","GMRAPET0",51,0)
 ;---REPLACED LINE ABOVE WITH LINE BELOW;1/13/97 VAUGHN---
"RTN","GMRAPET0",52,0)
 I 'GMRAOUT D
"RTN","GMRAPET0",53,0)
 .S GMRAPN=0 D NEW^TIUPNAPI(.GMRAPN,GMRADFN,GMRADUZ,GMRADT,GMRACW,$G(GMRAHLOC),$S($G(GMRAXBOS):0,1:1)) ;17,21 Allow editing if not in GUI
"RTN","GMRAPET0",54,0)
 ;----------END-------
"RTN","GMRAPET0",55,0)
 I GMRAPN=-1,'$G(GMRAXBOS) S GMRAOUT=1 W !,"No Progress Note was created." ;21
"RTN","GMRAPET0",56,0)
 I GMRAPN=0,'$G(GMRAXBOS) W !,"Progress note has not been signed." ;21
"RTN","GMRAPET0",57,0)
 D EXIT
"RTN","GMRAPET0",58,0)
 Q
"RTN","GMRAPET0",59,0)
EXIT ; Clean up of variables
"RTN","GMRAPET0",60,0)
 K ^TMP("TIUP",$J),GMRALOC,GMRAHLOC,GMRADUZ ;38 Removed variable GMRAPN from list of variables to kill
"RTN","GMRAPET0",61,0)
 Q
"RTN","GMRAPET0",62,0)
ASK ; Simple file manager query for a location in file 44
"RTN","GMRAPET0",63,0)
 N DIC
"RTN","GMRAPET0",64,0)
 S X=""
"RTN","GMRAPET0",65,0)
 S DIC=44,DIC(0)="AEQ",DIC("A")="Select a Hospital Location: ",DIC("S")="I ""CMW""[$P(^(0),U,3)" ;20
"RTN","GMRAPET0",66,0)
 W !,"A progress note is being created because you "_$S(GMRACT="V":"verified",GMRACT="E":"inactivated",GMRACT="S":"activated",1:"entered a medwatch form for"),!,$P($G(^GMR(120.8,GMRAPA,0)),U,2),"." ;20
"RTN","GMRAPET0",67,0)
 W !,"Enter a hospital location to be associated with this note." ;20
"RTN","GMRAPET0",68,0)
 D ^DIC
"RTN","GMRAPET0",69,0)
 I $D(DTOUT)!($D(DUOUT)) S GMRAOUT=1 Q
"RTN","GMRAPET0",70,0)
 S GMRAHLOC=+Y
"RTN","GMRAPET0",71,0)
 Q
"RTN","GMRAPET0",72,0)
V ; Verified Reaction
"RTN","GMRAPET0",73,0)
 N GMRAI ;21
"RTN","GMRAPET0",74,0)
 S GMRAPA(0)=$G(^GMR(120.8,GMRAPA,0))
"RTN","GMRAPET0",75,0)
 S GMRADT=$P(GMRAPA(0),U,17),GMRADUZ=$P(GMRAPA(0),U,18)
"RTN","GMRAPET0",76,0)
 S:GMRADUZ="" GMRADUZ=DUZ ; Autoverified reaction being reverified
"RTN","GMRAPET0",77,0)
 S ^TMP("TIUP",$J,1,0)="This patient has had an "_$S($P(GMRAPA(0),"^",14)="P":"adverse reaction reported for ",1:"allergy to ")_$P(GMRAPA(0),"^",2)
"RTN","GMRAPET0",78,0)
 S ^TMP("TIUP",$J,2,0)="verified on "_$$FMTE^XLFDT(GMRADT,1)_"."
"RTN","GMRAPET0",79,0)
 S GMRAI=2 D ADDCOM("V",.GMRAI) ;21
"RTN","GMRAPET0",80,0)
 S ^TMP("TIUP",$J,0)=U_U_GMRAI_U_GMRAI_U_GMRADT_"^^^" ;21
"RTN","GMRAPET0",81,0)
 Q
"RTN","GMRAPET0",82,0)
S ; Signed Reaction
"RTN","GMRAPET0",83,0)
 N GMRAI,GMRAREAC ;21
"RTN","GMRAPET0",84,0)
 D NOW^%DTC
"RTN","GMRAPET0",85,0)
 S GMRADT=%,GMRADUZ=DUZ
"RTN","GMRAPET0",86,0)
 S GMRAREAC=0,GMRAI=3 F  S GMRAREAC=$O(GMRAPA(GMRAREAC)) Q:GMRAREAC<1  S GMRAI=GMRAI+1,^TMP("TIUP",$J,GMRAI,0)=$P($G(^GMR(120.8,GMRAREAC,0)),U,2) S GMRAPA=GMRAREAC D  ;21
"RTN","GMRAPET0",87,0)
 .D ADDCOM("O",.GMRAI) ;21
"RTN","GMRAPET0",88,0)
 .S GMRAI=GMRAI+1,^TMP("TIUP",$J,GMRAI,0)="" ;21
"RTN","GMRAPET0",89,0)
 S ^TMP("TIUP",$J,1,0)="This patient has had the following reaction"_$S(GMRAI=3:" ",1:"s ")
"RTN","GMRAPET0",90,0)
 S ^TMP("TIUP",$J,2,0)="signed-off on "_$$FMTE^XLFDT(GMRADT,1)_"."
"RTN","GMRAPET0",91,0)
 S ^TMP("TIUP",$J,3,0)="" ;21
"RTN","GMRAPET0",92,0)
 S ^TMP("TIUP",$J,0)=U_U_GMRAI_U_GMRAI_U_GMRADT_"^^^"
"RTN","GMRAPET0",93,0)
 Q
"RTN","GMRAPET0",94,0)
M ; MedWATCH data entered
"RTN","GMRAPET0",95,0)
 N X
"RTN","GMRAPET0",96,0)
 S GMRAPA(0)=$G(^GMR(120.8,GMRAPA,0))
"RTN","GMRAPET0",97,0)
 D NOW^%DTC
"RTN","GMRAPET0",98,0)
 S GMRADT=%,GMRADUZ=DUZ
"RTN","GMRAPET0",99,0)
 S ^TMP("TIUP",$J,1,0)="This patient has had a MEDWatch report completed on "_$$FMTE^XLFDT(GMRADT,1)_" for"
"RTN","GMRAPET0",100,0)
 S ^TMP("TIUP",$J,2,0)=$S($P(GMRAPA(0),"^",14)="P":"an adverse reaction to ",1:"allergy to ")_$P(GMRAPA(0),"^",2)_"."
"RTN","GMRAPET0",101,0)
 S ^TMP("TIUP",$J,0)=U_U_"2"_U_"2"_U_GMRADT_"^^^"
"RTN","GMRAPET0",102,0)
 Q
"RTN","GMRAPET0",103,0)
E ; Reaction Entered in Error
"RTN","GMRAPET0",104,0)
 N GMRAER,GMRAI ;21
"RTN","GMRAPET0",105,0)
 S GMRAPA(0)=$G(^GMR(120.8,GMRAPA,0))
"RTN","GMRAPET0",106,0)
 S GMRAER=$G(^GMR(120.8,GMRAPA,"ER")) I GMRAER="" S GMRAOUT=1 Q
"RTN","GMRAPET0",107,0)
 S GMRADT=$P(GMRAER,U,2),GMRADUZ=$P(GMRAER,U,3)
"RTN","GMRAPET0",108,0)
 S ^TMP("TIUP",$J,1,0)="The "_$S($P(GMRAPA(0),"^",14)="P":"adverse reaction ",1:"allergy ")_"to "_$P(GMRAPA(0),"^",2)_" was removed on "_$$FMTE^XLFDT($P(GMRADT,"."),2)_"." ;20
"RTN","GMRAPET0",109,0)
 S ^TMP("TIUP",$J,2,0)="This reaction was either an erroneous entry or was found" ;20
"RTN","GMRAPET0",110,0)
 S ^TMP("TIUP",$J,3,0)="to no longer be a true "_$S($P(GMRAPA(0),"^",14)="P":"adverse reaction",1:"allergy")_"." ;20
"RTN","GMRAPET0",111,0)
 S GMRAI=3 D ADDCOM("E",.GMRAI) ;21,20
"RTN","GMRAPET0",112,0)
 S ^TMP("TIUP",$J,0)=U_U_GMRAI_U_GMRAI_U_GMRADT_"^^^" ;21
"RTN","GMRAPET0",113,0)
 Q
"RTN","GMRAPET0",114,0)
 ;
"RTN","GMRAPET0",115,0)
ADDCOM(TYPE,CNT) ;Add any comments to progress note - section added in patch 21
"RTN","GMRAPET0",116,0)
 N SUB,ENTRY
"RTN","GMRAPET0",117,0)
 S ENTRY=$O(^GMR(120.8,GMRAPA,26,"AVER",TYPE,0)) Q:'+ENTRY
"RTN","GMRAPET0",118,0)
 S CNT=CNT+1,^TMP("TIUP",$J,CNT,0)="",CNT=CNT+1,^TMP("TIUP",$J,CNT,0)="Author's comments:"
"RTN","GMRAPET0",119,0)
 S CNT=CNT+1,^TMP("TIUP",$J,CNT,0)=""
"RTN","GMRAPET0",120,0)
 S SUB=0 F  S SUB=$O(^GMR(120.8,GMRAPA,26,ENTRY,2,SUB)) Q:'+SUB  S CNT=CNT+1,^TMP("TIUP",$J,CNT,0)=^GMR(120.8,GMRAPA,26,ENTRY,2,SUB,0)
"RTN","GMRAPET0",121,0)
 Q
"RTN","GMRAY38")
0^3^B7269151^n/a
"RTN","GMRAY38",1,0)
GMRAY38 ;SLC/DAN Post-install for patch 38 ;5/3/07  14:53
"RTN","GMRAY38",2,0)
 ;;4.0;Adverse Reaction Tracking;**38**;Mar 29, 1996;Build 2
"RTN","GMRAY38",3,0)
 ;
"RTN","GMRAY38",4,0)
POST ;Find varible pointers associated with IEN zero
"RTN","GMRAY38",5,0)
 N TMP,IEN,FREE,REACTANT,FDA,COM
"RTN","GMRAY38",6,0)
 S FREE=$O(^GMRD(120.82,"B","OTHER ALLERGY/ADVERSE REACTION",0)) Q:'FREE  S:FREE FREE=FREE_";GMRD(120.82,"
"RTN","GMRAY38",7,0)
 S IEN=0 F  S IEN=$O(^GMR(120.8,IEN)) Q:'+IEN  D
"RTN","GMRAY38",8,0)
 .I $E($P($G(^GMR(120.8,IEN,0)),U,3),1,2)="0;" D
"RTN","GMRAY38",9,0)
 ..S $P(^GMR(120.8,IEN,0),U,3)=FREE ;Update pointer to free text entry
"RTN","GMRAY38",10,0)
 ..S REACTANT=$P(^GMR(120.8,IEN,0),U,2)_" ( FREE TEXT )"
"RTN","GMRAY38",11,0)
 ..S FDA(120.8,(IEN_","),.02)=REACTANT
"RTN","GMRAY38",12,0)
 ..D FILE^DIE(,"FDA")
"RTN","GMRAY38",13,0)
 ..S COM="Updated by patch GMRA*4*38 to free text due to bad pointer value." D ADCOM^GMRAFX(IEN,"O",COM) ;Add comment to record
"RTN","GMRAY38",14,0)
 ..S TMP($P(^GMR(120.8,IEN,0),U),$P(^GMR(120.8,IEN,0),U,2))=""
"RTN","GMRAY38",15,0)
 ;
"RTN","GMRAY38",16,0)
MAIL ;Send message indicating post install is finished
"RTN","GMRAY38",17,0)
 N XMSUB,XMTEXT,XMDUZ,XMY,XMZ,GMRATXT,CNT,VADM,DFN,REACTANT,LOOP,DIFROM,NAME,REACT
"RTN","GMRAY38",18,0)
 S XMDUZ="PATCH GMRA*4*38 POST-INSTALL",XMY(.5)="" S:$G(DUZ) XMY(DUZ)=""
"RTN","GMRAY38",19,0)
 S GMRATXT(1)="The post-install routine for patch GMRA*4*38"
"RTN","GMRAY38",20,0)
 S GMRATXT(2)="finished on "_$$FMTE^XLFDT($$NOW^XLFDT)_"."
"RTN","GMRAY38",21,0)
 S GMRATXT(3)=""
"RTN","GMRAY38",22,0)
 S CNT=4
"RTN","GMRAY38",23,0)
 I $D(TMP) D
"RTN","GMRAY38",24,0)
 .S GMRATXT(CNT)="The following patients had reactants updated to free text entries",CNT=CNT+1,GMRATXT(CNT)="because of a problem with the pointer data.",CNT=CNT+1
"RTN","GMRAY38",25,0)
 .S GMRATXT(CNT)="",CNT=CNT+1,GMRATXT(CNT)="Please use the Allergy Update Utility to fix these entries.",CNT=CNT+1,GMRATXT(CNT)="",CNT=CNT+1
"RTN","GMRAY38",26,0)
 .S IEN=0 F  S IEN=$O(TMP(IEN)) Q:'+IEN  S NAME=$$GET1^DIQ(2,IEN,.01)_" ("_$E($$GET1^DIQ(2,IEN,.09),6,9)_")" S REACT="" F  S REACT=$O(TMP(IEN,REACT)) Q:REACT=""  D
"RTN","GMRAY38",27,0)
 ..S GMRATXT(CNT)=NAME_$$REPEAT^XLFSTR(" ",(38-$L(NAME)))_REACT,CNT=CNT+1
"RTN","GMRAY38",28,0)
 S XMTEXT="GMRATXT(",XMSUB="PATCH GMRA*4*38 Post Install COMPLETED"
"RTN","GMRAY38",29,0)
 D ^XMD
"RTN","GMRAY38",30,0)
 Q
"VER")
8.0^22.0
**INSTALL NAME**
GMTS*2.7*80
"BLD",18204,0)
GMTS*2.7*80^HEALTH SUMMARY^0^3070521^y
"BLD",18204,4,0)
^9.64PA^^
"BLD",18204,6)
2^
"BLD",18204,6.3)
9
"BLD",18204,"KRN",0)
^9.67PA^8989.52^19
"BLD",18204,"KRN",.4,0)
.4
"BLD",18204,"KRN",.401,0)
.401
"BLD",18204,"KRN",.402,0)
.402
"BLD",18204,"KRN",.403,0)
.403
"BLD",18204,"KRN",.5,0)
.5
"BLD",18204,"KRN",.84,0)
.84
"BLD",18204,"KRN",3.6,0)
3.6
"BLD",18204,"KRN",3.8,0)
3.8
"BLD",18204,"KRN",9.2,0)
9.2
"BLD",18204,"KRN",9.8,0)
9.8
"BLD",18204,"KRN",9.8,"NM",0)
^9.68A^4^4
"BLD",18204,"KRN",9.8,"NM",1,0)
GMTSPSO7^^0^B10663260
"BLD",18204,"KRN",9.8,"NM",2,0)
GMTSPSO^^0^B13050347
"BLD",18204,"KRN",9.8,"NM",3,0)
GMTSPSZO^^0^B8603355
"BLD",18204,"KRN",9.8,"NM",4,0)
GMTSDA^^0^B7592185
"BLD",18204,"KRN",9.8,"NM","B","GMTSDA",4)

"BLD",18204,"KRN",9.8,"NM","B","GMTSPSO",2)

"BLD",18204,"KRN",9.8,"NM","B","GMTSPSO7",1)

"BLD",18204,"KRN",9.8,"NM","B","GMTSPSZO",3)

"BLD",18204,"KRN",19,0)
19
"BLD",18204,"KRN",19.1,0)
19.1
"BLD",18204,"KRN",101,0)
101
"BLD",18204,"KRN",409.61,0)
409.61
"BLD",18204,"KRN",771,0)
771
"BLD",18204,"KRN",870,0)
870
"BLD",18204,"KRN",8989.51,0)
8989.51
"BLD",18204,"KRN",8989.52,0)
8989.52
"BLD",18204,"KRN",8994,0)
8994
"BLD",18204,"KRN","B",.4,.4)

"BLD",18204,"KRN","B",.401,.401)

"BLD",18204,"KRN","B",.402,.402)

"BLD",18204,"KRN","B",.403,.403)

"BLD",18204,"KRN","B",.5,.5)

"BLD",18204,"KRN","B",.84,.84)

"BLD",18204,"KRN","B",3.6,3.6)

"BLD",18204,"KRN","B",3.8,3.8)

"BLD",18204,"KRN","B",9.2,9.2)

"BLD",18204,"KRN","B",9.8,9.8)

"BLD",18204,"KRN","B",19,19)

"BLD",18204,"KRN","B",19.1,19.1)

"BLD",18204,"KRN","B",101,101)

"BLD",18204,"KRN","B",409.61,409.61)

"BLD",18204,"KRN","B",771,771)

"BLD",18204,"KRN","B",870,870)

"BLD",18204,"KRN","B",8989.51,8989.51)

"BLD",18204,"KRN","B",8989.52,8989.52)

"BLD",18204,"KRN","B",8994,8994)

"BLD",18204,"QUES",0)
^9.62^^
"BLD",18204,"REQB",0)
^9.611^^
"MBREQ")
0
"PKG",56,-1)
1^1
"PKG",56,0)
HEALTH SUMMARY^GMTS^Integrated Health Summary Tools
"PKG",56,22,0)
^9.49I^1^1
"PKG",56,22,1,0)
2.7^2951020^2960605
"PKG",56,22,1,"PAH",1,0)
80^3070521^1392
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
YES
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
YES
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
4
"RTN","GMTSDA")
0^4^B7592185^B7380587
"RTN","GMTSDA",1,0)
GMTSDA ; SLC/DLT,KER/NDBI - Appointments ; 5/21/07 11:12am
"RTN","GMTSDA",2,0)
 ;;2.7;Health Summary;**5,19,28,49,70,80**;Oct 20, 1995;Build 9
"RTN","GMTSDA",3,0)
 ;               
"RTN","GMTSDA",4,0)
 ; External Reference
"RTN","GMTSDA",5,0)
 ;   DBIA  1024  ^DIC(40.7
"RTN","GMTSDA",6,0)
 ;   DBIA 10040  ^SC(
"RTN","GMTSDA",7,0)
 ;   DBIA  2065  ^SCE(
"RTN","GMTSDA",8,0)
 ;   DBIA  2065  ^SCE("ADFN"
"RTN","GMTSDA",9,0)
 ;   DBIA  2929  CVP^A7RHSM
"RTN","GMTSDA",10,0)
 ;   DBIA 10061  SDA^VADPT
"RTN","GMTSDA",11,0)
 ;                   
"RTN","GMTSDA",12,0)
PAST ; Gets Patient's Past Appointments for date range
"RTN","GMTSDA",13,0)
 N GMDT,GMIDT,MAX S X=1
"RTN","GMTSDA",14,0)
 S VASD("F")=$S(GMTSBEG=1:2560101,1:GMTSBEG),VASD("T")=$S(GMTS1=6666666:DT,1:9999999-GMTS1)
"RTN","GMTSDA",15,0)
 S MAX=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:99999)
"RTN","GMTSDA",16,0)
 S VASD("W")=123456789 D SDA^VADPT
"RTN","GMTSDA",17,0)
 I VAERR=1 D CKP^GMTSUP W "RSA ERROR",! D END Q
"RTN","GMTSDA",18,0)
 I VAERR=2 D CKP^GMTSUP W "DATABASE NOT AVAILABLE",! D END Q
"RTN","GMTSDA",19,0)
 S (YCNT,Y)=0 F  S Y=$O(^UTILITY("VASD",$J,Y)) Q:'Y  S YCNT=YCNT+1,ADATE=$P(^(Y,"I"),U,1),^UTILITY("GMTSVASD",$J,9999999-ADATE)=ADATE_U_$P(^UTILITY("VASD",$J,Y,"E"),U,2,99)
"RTN","GMTSDA",20,0)
 S GMDT=VASD("F")
"RTN","GMTSDA",21,0)
 F  S GMDT=$O(^SCE("ADFN",DFN,GMDT)) Q:GMDT'>0!(GMDT>VASD("T"))  D
"RTN","GMTSDA",22,0)
 . S GMI=0 F  S GMI=$O(^SCE("ADFN",DFN,GMDT,GMI)) Q:GMI'>0  D
"RTN","GMTSDA",23,0)
 . . S GMIDT=9999999-GMDT
"RTN","GMTSDA",24,0)
 . . I '$D(^UTILITY("GMTSVASD",$J,GMIDT)) D
"RTN","GMTSDA",25,0)
 . . . Q:$P($G(^SCE(GMI,0)),U,6)'=""
"RTN","GMTSDA",26,0)
 . . . I $P($G(^SCE(GMI,0)),U,4) Q:$P($G(^SC($P(^SCE(GMI,0),U,4),"OOS")),U)
"RTN","GMTSDA",27,0)
 . . . S ^UTILITY("GMTSVASD",$J,GMIDT)=GMDT_U_$S(+$P(^SCE(GMI,0),U,4):$P($G(^SC(+$P(^(0),U,4),0)),U),1:$P($G(^DIC(40.7,$P(^SCE(GMI,0),U,3),0)),U))_U_"UNSCHEDULED"
"RTN","GMTSDA",28,0)
 D:$$ROK^GMTSU("A7RHSM")&($$NDBI^GMTSU) CVP^A7RHSM
"RTN","GMTSDA",29,0)
 I '$D(^UTILITY("GMTSVASD",$J)) D END Q
"RTN","GMTSDA",30,0)
 S IDATE="",YCNT=0
"RTN","GMTSDA",31,0)
 F  S IDATE=$O(^UTILITY("GMTSVASD",$J,IDATE)) Q:+IDATE'>0!(YCNT=MAX)  D
"RTN","GMTSDA",32,0)
 . S ADATE=+^(IDATE),ADATE(0)=^(IDATE) D PRINT S YCNT=YCNT+1
"RTN","GMTSDA",33,0)
 D END Q
"RTN","GMTSDA",34,0)
FUTURE ; Gets Patient's Future Appointments 
"RTN","GMTSDA",35,0)
 D SDA^VADPT N MAX S MAX=$S(+($G(GMTSNDM))>0:+($G(GMTSNDM)),1:99999)
"RTN","GMTSDA",36,0)
 I VAERR=2 D CKP^GMTSUP W "DATABASE NOT AVAILABLE",! D END Q
"RTN","GMTSDA",37,0)
 S (YCNT,Y)=0 F  S Y=$O(^UTILITY("VASD",$J,Y)) Q:'Y  S YCNT=YCNT+1,ADATE=$P(^(Y,"I"),U,1),ADATE(0)=^UTILITY("VASD",$J,Y,"E") D PRINT Q:YCNT=MAX
"RTN","GMTSDA",38,0)
 D END Q
"RTN","GMTSDA",39,0)
PRINT ; Output
"RTN","GMTSDA",40,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  S X=ADATE D REGDTM4^GMTSU,CKP^GMTSUP
"RTN","GMTSDA",41,0)
 W X,?18,$E($P(ADATE(0),"^",2),1,25),?58,$E($P(ADATE(0),"^",3),1,21)
"RTN","GMTSDA",42,0)
 W ! Q
"RTN","GMTSDA",43,0)
END ; Clean-up and Quit
"RTN","GMTSDA",44,0)
 K %I,IDATE,IDATES,ADATE,VASD,X,Y,YCNT,Z,^UTILITY("VASD",$J),^UTILITY("GMTSVASD",$J) Q
"RTN","GMTSPSO")
0^2^B13050347^B11904487
"RTN","GMTSPSO",1,0)
GMTSPSO ; SLC/JER,KER/NDBI - OP Rx Summary Component (V6) ; 08/27/2002
"RTN","GMTSPSO",2,0)
 ;;2.7;Health Summary;**15,28,37,56,78,80**;Oct 20, 1995;Build 9
"RTN","GMTSPSO",3,0)
 ;
"RTN","GMTSPSO",4,0)
 ; External References
"RTN","GMTSPSO",5,0)
 ;   DBIA  10141  $$VERSION^XPDUTL
"RTN","GMTSPSO",6,0)
 ;   DBIA   2931  HS^A7RPSOHS
"RTN","GMTSPSO",7,0)
 ;   DBIA   2931  HS^A7RPSOHS
"RTN","GMTSPSO",8,0)
 ;   DBIA    330  ^PSOHCSUM, ACS^PSOHCSUM
"RTN","GMTSPSO",9,0)
 ;   DBIA    522  ^PS(55,
"RTN","GMTSPSO",10,0)
 ;   DBIA  10035  ^DPT(  file #2
"RTN","GMTSPSO",11,0)
 ;   DBIA   3136  ^PS(59.7,
"RTN","GMTSPSO",12,0)
 ;                    
"RTN","GMTSPSO",13,0)
MAIN ; OP Rx HS Comp
"RTN","GMTSPSO",14,0)
 ;   Check for version 7 (or greater)   MAIN^GMTSPSO7
"RTN","GMTSPSO",15,0)
 I $$VERSION^XPDUTL("PSO")'<7 G MAIN^GMTSPSO7
"RTN","GMTSPSO",16,0)
 ;   If not version 7                   MAIN^GMTSPSO
"RTN","GMTSPSO",17,0)
 N ECD,GMR,IX,PSOBEGIN,PSOACT,GMX,GMTOP
"RTN","GMTSPSO",18,0)
 S PSOBEGIN=$S(GMTS2'=9999999:(9999999-GMTS2),1:"")
"RTN","GMTSPSO",19,0)
 I PSOBEGIN="" S PSOACT=1 K PSOBEGIN
"RTN","GMTSPSO",20,0)
 K ^TMP("PSOO",$J),^TMP($J,"GMTSPS")
"RTN","GMTSPSO",21,0)
 D PROF^PSO52API(DFN,"GMTSPS",1,9999999)
"RTN","GMTSPSO",22,0)
 D:$$ROK^GMTSU("A7RPSOHS")&($$NDBI^GMTSU) HS^A7RPSOHS(DFN)
"RTN","GMTSPSO",23,0)
 I +$G(^TMP($J,"GMTSPS",DFN,0))<1,'$D(^TMP($J,"GMTSPS",DFN,"ARC")) Q
"RTN","GMTSPSO",24,0)
 I '$G(^TMP($J,"GMTSPS",DFN,0)),$D(^TMP($J,"GMTSPS",DFN,"ARC")) D CKP^GMTSUP Q:$D(GMTSQIT)  W "Patient Has Archived OP Prescriptions",!
"RTN","GMTSPSO",25,0)
 ;I '$D(^PS(55,DFN,"P")),'$D(^("ARC")),'$D(^TMP("PSOO",$J)) Q
"RTN","GMTSPSO",26,0)
 ;I '$O(^PS(55,DFN,"P",0)),$D(^PS(55,DFN,"ARC")) D CKP^GMTSUP Q:$D(GMTSQIT)  W "Patient Has Archived OP Prescriptions",!
"RTN","GMTSPSO",27,0)
 I $L($T(ACS^PSOHCSUM))>0 D ACS^PSOHCSUM D:$$ROK^GMTSU("A7RPSOHS")&($$NDBI^GMTSU) HS^A7RPSOHS(DFN) I '$D(^TMP("PSOO",$J)) Q
"RTN","GMTSPSO",28,0)
 I $L($T(ACS^PSOHCSUM))'>0 D ^PSOHCSUM D:$$ROK^GMTSU("A7RPSOHS")&($$NDBI^GMTSU) HS^A7RPSOHS(DFN) I '$D(^TMP("PSOO",$J)) Q
"RTN","GMTSPSO",29,0)
 S GMTSLO=GMTSLO+3
"RTN","GMTSPSO",30,0)
 S (GMX,GMTOP,IX)=0
"RTN","GMTSPSO",31,0)
 F  S IX=$O(^TMP("PSOO",$J,IX)) Q:IX'>0  S GMR=$G(^(IX,0)) D WRT
"RTN","GMTSPSO",32,0)
 S GMTSLO=GMTSLO-3
"RTN","GMTSPSO",33,0)
 K ^TMP("PSOO",$J)
"RTN","GMTSPSO",34,0)
 Q
"RTN","GMTSPSO",35,0)
WRT ; Writes OP Pharmacy Segment Record
"RTN","GMTSPSO",36,0)
 N ID,LFD,X,MI,NL,CF,GMD,GMV,GMI,GUI S GUI=$$HF^GMTSU
"RTN","GMTSPSO",37,0)
 S ID=$P(GMR,U),LFD=$P(GMR,U,2),ECD=$P(GMR,U,11),CF=$P(GMR,U,10)
"RTN","GMTSPSO",38,0)
 ;   Don't display when issue date is after To Date
"RTN","GMTSPSO",39,0)
 Q:+$G(GMRANGE)&(ID>(9999999-GMTS1))
"RTN","GMTSPSO",40,0)
 F GMV="ID","LFD","ECD" S X=@GMV D REGDT4^GMTSU S @GMV=X K X
"RTN","GMTSPSO",41,0)
 S MI=$G(^TMP("PSOO",$J,IX,1)),NL=0 I $L(MI)>73 D PARSE
"RTN","GMTSPSO",42,0)
 S GMD=$P($P(GMR,U,4),";",2)
"RTN","GMTSPSO",43,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPSO",44,0)
 D:GMTSNPG!(GMX'>0) HEAD W:'GMTOP ! S GMTOP=0 W $P($P(GMR,U,3),";",2)
"RTN","GMTSPSO",45,0)
 W !,?18,$P(GMR,U,6),?31,$S($P($P(GMR,U,5),";")="S":"ACTIVE/SUSP",1:$P($P(GMR,U,5),";",2)),?45,$P(GMR,U,7),?54,ID,?65,LFD,?76,"("_$P(GMR,U,8)_")",!
"RTN","GMTSPSO",46,0)
 S GMX=1 I 'NL D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HEAD W ?2,"SIG: ",MI,! S GMTOP=0
"RTN","GMTSPSO",47,0)
 F GMI=1:1:NL D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HEAD W:GMI=1 ?2,"SIG: " W ?7,MI(GMI),! S GMTOP=0
"RTN","GMTSPSO",48,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HEAD W ?4,"Provider: ",$E(GMD,1,22) W:CF ?37,"Cost/Fill: $",$J(CF,6,2)
"RTN","GMTSPSO",49,0)
 I "EC"[$P($P(GMR,U,5),";"),ECD]"" W ?57,"Exp/Can Dt: "_ECD
"RTN","GMTSPSO",50,0)
 W ! S GMTOP=0
"RTN","GMTSPSO",51,0)
 Q
"RTN","GMTSPSO",52,0)
PARSE ; Parses Medication Instructions
"RTN","GMTSPSO",53,0)
 N GMI,NW,WPL
"RTN","GMTSPSO",54,0)
 S NL=$S(($L(MI)/73)>($L(MI)\73):($L(MI)\73)+1,1:$L(MI)\73)
"RTN","GMTSPSO",55,0)
 S NW=$L(MI," "),WPL=$S((NW/NL)>(NW\NL):(NW\NL)+1,1:NW\NL)
"RTN","GMTSPSO",56,0)
 F GMI=1:1:NL S MI(GMI)=$P(MI," ",(GMI-1)*WPL+1,GMI*WPL)
"RTN","GMTSPSO",57,0)
 Q
"RTN","GMTSPSO",58,0)
HEAD ; Prints Header
"RTN","GMTSPSO",59,0)
 S GMTOP=1
"RTN","GMTSPSO",60,0)
 K ^TMP($J,"GMTSPSSYS") D PSS^PSS59P7(1,,"GMTSPSSYS")
"RTN","GMTSPSO",61,0)
 I GMX'>0,$D(^DPT(DFN,.1)),^(.1)]"",+$G(^TMP($J,"GMTSPSSYS",1,40.1)) D CKP^GMTSUP Q:$D(GMTSQIT)  W "Outpatient prescriptions are cancelled 72 hours after admission",!
"RTN","GMTSPSO",62,0)
 ;I GMX'>0,$D(^DPT(DFN,.1)),^(.1)]"",+($P($G(^PS(59.7,1,40.1)),"^")) D CKP^GMTSUP Q:$D(GMTSQIT)  W "Outpatient prescriptions are cancelled 72 hours after admission",!
"RTN","GMTSPSO",63,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"Drug....................................",?65,"Last",!
"RTN","GMTSPSO",64,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPSO",65,0)
 W ?18,"Rx #",?31,"Stat",?45,"Qty",?54,"Issued",?65,"Filled",?76,"Rem"
"RTN","GMTSPSO",66,0)
 W:$Y'>(IOSL-GMTSLO)!(+($G(GUI))>0) !
"RTN","GMTSPSO",67,0)
 Q
"RTN","GMTSPSO7")
0^1^B10663260^B9519932
"RTN","GMTSPSO7",1,0)
GMTSPSO7 ; SLC/JER/KER - OP Rx Summary Component (V7) ; 08/27/2002
"RTN","GMTSPSO7",2,0)
 ;;2.7;Health Summary;**15,28,37,56,78,80**;Oct 20, 1995;Build 9
"RTN","GMTSPSO7",3,0)
 ;
"RTN","GMTSPSO7",4,0)
 ; External References
"RTN","GMTSPSO7",5,0)
 ;   DBIA    330  ^PSOHCSUM, ACS^PSOHCSUM
"RTN","GMTSPSO7",6,0)
 ;   DBIA    522  ^PS(55,
"RTN","GMTSPSO7",7,0)
 ;   DBIA  10035  ^DPT(  file #2
"RTN","GMTSPSO7",8,0)
 ;   DBIA   3136  ^PS(59.7,
"RTN","GMTSPSO7",9,0)
 ;   DBIA  10011  ^DIWP
"RTN","GMTSPSO7",10,0)
 ;                      
"RTN","GMTSPSO7",11,0)
MAIN ; OP Rx HS Component
"RTN","GMTSPSO7",12,0)
 N ECD,GMR,IX,PSOBEGIN,PSOACT,GMX,GMTOP
"RTN","GMTSPSO7",13,0)
 S PSOBEGIN=$S(GMTS2'=9999999:(9999999-GMTS2),1:"")
"RTN","GMTSPSO7",14,0)
 I PSOBEGIN="" S PSOACT=1 K PSOBEGIN
"RTN","GMTSPSO7",15,0)
 K ^TMP("PSOO",$J),^TMP($J,"GMTSPS")
"RTN","GMTSPSO7",16,0)
 D PROF^PSO52API(DFN,"GMTSPS",1,9999999)
"RTN","GMTSPSO7",17,0)
 I +$G(^TMP($J,"GMTSPS",DFN,0))<1,'$D(^TMP($J,"GMTSPS",DFN,"ARC")) Q
"RTN","GMTSPSO7",18,0)
 I '$G(^TMP($J,"GMTSPS",DFN,0)),$D(^TMP($J,"GMTSPS",DFN,"ARC")) D CKP^GMTSUP Q:$D(GMTSQIT)  W "Patient Has Archived OP Prescriptions",!
"RTN","GMTSPSO7",19,0)
 ;I '$D(^PS(55,DFN,"P")),'$D(^("ARC")) Q
"RTN","GMTSPSO7",20,0)
 ;I '$O(^PS(55,DFN,"P",0)),$D(^PS(55,DFN,"ARC")) D CKP^GMTSUP Q:$D(GMTSQIT)  W "Patient Has Archived OP Prescriptions",!
"RTN","GMTSPSO7",21,0)
 I $L($T(ACS^PSOHCSUM))>0 D ACS^PSOHCSUM I '$D(^TMP("PSOO",$J)) Q
"RTN","GMTSPSO7",22,0)
 I $L($T(ACS^PSOHCSUM))'>0 D ^PSOHCSUM I '$D(^TMP("PSOO",$J)) Q
"RTN","GMTSPSO7",23,0)
 S GMTSLO=GMTSLO+3
"RTN","GMTSPSO7",24,0)
 S (GMTOP,GMX,IX)=0
"RTN","GMTSPSO7",25,0)
 F  S IX=$O(^TMP("PSOO",$J,IX)) Q:IX'>0  S GMR=$G(^(IX,0)) D WRT
"RTN","GMTSPSO7",26,0)
 S GMTSLO=GMTSLO-3
"RTN","GMTSPSO7",27,0)
 K ^TMP("PSOO",$J),^UTILITY($J,"W")
"RTN","GMTSPSO7",28,0)
 Q
"RTN","GMTSPSO7",29,0)
WRT ; Writes OP Pharmacy Segment Record
"RTN","GMTSPSO7",30,0)
 N ID,LFD,X,MI,NL,CF,GMD,GMV,GMI,DIWL,DIWR,DIWF,GMSIG,GUI S GUI=$$HF^GMTSU
"RTN","GMTSPSO7",31,0)
 S ID=$P(GMR,U),LFD=$P(GMR,U,2),ECD=$P(GMR,U,11),CF=$P(GMR,U,10)
"RTN","GMTSPSO7",32,0)
 ;   Don't display when issue date is after To Date
"RTN","GMTSPSO7",33,0)
 Q:+$G(GMRANGE)&(ID>(9999999-GMTS1))
"RTN","GMTSPSO7",34,0)
 F GMV="ID","LFD","ECD" S X=@GMV D REGDT4^GMTSU S @GMV=X K X
"RTN","GMTSPSO7",35,0)
 S NL=0,DIWL=1,DIWR=73,DIWF="" K ^UTILITY($J,"W")
"RTN","GMTSPSO7",36,0)
 F  S NL=$O(^TMP("PSOO",$J,IX,NL)) Q:NL'>0  D
"RTN","GMTSPSO7",37,0)
 . S X=$G(^TMP("PSOO",$J,IX,NL,0)) D ^DIWP
"RTN","GMTSPSO7",38,0)
 S GMD=$P($P(GMR,U,4),";",2)
"RTN","GMTSPSO7",39,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPSO7",40,0)
 D:GMTSNPG!(GMX'>0) HEAD W:'GMTOP ! S GMTOP=0 W $P($P(GMR,U,3),";",2)
"RTN","GMTSPSO7",41,0)
 W !,?18,$P(GMR,U,6),?31,$S($G(GMR)["SUSPENDED":"ACTIVE/SUSP",1:$P($P(GMR,U,5),";",2)),?45,$P(GMR,U,7),?54,ID,?65,LFD,?76,"("_$P(GMR,U,8)_")",!
"RTN","GMTSPSO7",42,0)
 S GMX=1,GMI=0,GMSIG=1
"RTN","GMTSPSO7",43,0)
 F  S GMI=$O(^UTILITY($J,"W",DIWL,GMI)) Q:GMI'>0!$D(GMTSQIT)  D
"RTN","GMTSPSO7",44,0)
 . D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HEAD
"RTN","GMTSPSO7",45,0)
 . S MI=$G(^UTILITY($J,"W",DIWL,GMI,0))
"RTN","GMTSPSO7",46,0)
 . W:GMSIG=1 ?2,"SIG: " S:GMSIG=1 GMSIG=0 W ?7,MI,! S GMTOP=0
"RTN","GMTSPSO7",47,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HEAD W ?4,"Provider: ",$E(GMD,1,22) W:CF ?37,"Cost/Fill: $",$J(CF,6,2)
"RTN","GMTSPSO7",48,0)
 I "EC"[$P($P(GMR,U,5),";"),ECD]"" W ?57,"Exp/Can Dt: "_ECD
"RTN","GMTSPSO7",49,0)
 W ! S GMTOP=0
"RTN","GMTSPSO7",50,0)
 Q
"RTN","GMTSPSO7",51,0)
HEAD ; Prints Header
"RTN","GMTSPSO7",52,0)
 ;   Only write the next line when there is data
"RTN","GMTSPSO7",53,0)
 S GMTOP=1
"RTN","GMTSPSO7",54,0)
 K ^TMP($J,"GMTSPSSYS") D PSS^PSS59P7(1,,"GMTSPSSYS")
"RTN","GMTSPSO7",55,0)
 I GMX'>0,$D(^DPT(DFN,.1)),^(.1)]"",+$G(^TMP($J,"GMTSPSSYS",1,40.1)) D CKP^GMTSUP Q:$D(GMTSQIT)  W "Outpatient prescriptions are cancelled 72 hours after admission",!
"RTN","GMTSPSO7",56,0)
 ;I GMX'>0,$D(^DPT(DFN,.1)),^(.1)]"",+($P($G(^PS(59.7,1,40.1)),"^")) D CKP^GMTSUP Q:$D(GMTSQIT)  W "Outpatient prescriptions are cancelled 72 hours after admission",!
"RTN","GMTSPSO7",57,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W !,"Drug....................................",?65,"Last",!
"RTN","GMTSPSO7",58,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPSO7",59,0)
 W ?18,"Rx #",?31,"Stat",?45,"Qty",?54,"Issued",?65,"Filled",?76,"Rem"
"RTN","GMTSPSO7",60,0)
 W:$Y'>(IOSL-GMTSLO)!(+($G(GUI))>0) !
"RTN","GMTSPSO7",61,0)
 Q
"RTN","GMTSPSZO")
0^3^B8603355^B7870590
"RTN","GMTSPSZO",1,0)
GMTSPSZO ;SLC/JER - OP Rx 5.6 Summary Component ;12/2/91  13:45 ;
"RTN","GMTSPSZO",2,0)
 ;;2.7;Health Summary;**80**;Oct 20, 1995;Build 9
"RTN","GMTSPSZO",3,0)
GMTSPSO ;SLC/JER - OP Rx Summary Component ;12/2/91  13:45 ;
"RTN","GMTSPSZO",4,0)
 ;;2.7;Health Summary;;Oct 20, 1995
"RTN","GMTSPSZO",5,0)
MAIN N ECD,GMR,GMW,IX,PSOBEGIN
"RTN","GMTSPSZO",6,0)
 S PSOBEGIN=$S(GMTS2'=9999999:(9999999-GMTS2),1:"")
"RTN","GMTSPSZO",7,0)
 I PSOBEGIN="" S PSOACT=1
"RTN","GMTSPSZO",8,0)
 K ^UTILITY("PSOO",$J),^TMP($J,"GMTSPS")
"RTN","GMTSPSZO",9,0)
 D PROF^PSO52API(DFN,"GMTSPS",1,9999999)
"RTN","GMTSPSZO",10,0)
 I +$G(^TMP($J,"GMTSPS",DFN,0))<1,'$D(^TMP($J,"GMTSPS",DFN,"ARC")) Q
"RTN","GMTSPSZO",11,0)
 I '$G(^TMP($J,"GMTSPS",DFN,0)),$D(^TMP($J,"GMTSPS",DFN,"ARC")) D CKP^GMTSUP Q:$D(GMTSQIT)  W "Patient Has Archived OP Prescriptions",!
"RTN","GMTSPSZO",12,0)
 ;I '$D(^PS(55,DFN,"P")),'$D(^("ARC")) Q
"RTN","GMTSPSZO",13,0)
 ;I '$O(^PS(55,DFN,"P",0)),$D(^PS(55,DFN,"ARC")) D CKP^GMTSUP Q:$D(GMTSQIT)  W "Patient Has Archived OP Prescriptions",!
"RTN","GMTSPSZO",14,0)
 D ^PSOHCSUM I '$D(^UTILITY("PSOO",$J)) Q
"RTN","GMTSPSZO",15,0)
 I $D(^DPT(DFN,.1)),^(.1)]"",$D(^DIC(59,+$O(^DIC(59,0)),1)),$P(^(1),"^",8) D CKP^GMTSUP Q:$D(GMTSQIT)  W "Outpatient prescriptions are cancelled 72 hours after admission",!
"RTN","GMTSPSZO",16,0)
 S GMTSLO=GMTSLO+3
"RTN","GMTSPSZO",17,0)
 D HEAD
"RTN","GMTSPSZO",18,0)
 S IX=0 F  S IX=$O(^UTILITY("PSOO",$J,IX)) Q:IX'>0  S GMR=$G(^(IX,0)) D WRT
"RTN","GMTSPSZO",19,0)
 S GMTSLO=GMTSLO-3
"RTN","GMTSPSZO",20,0)
 K ^UTILITY("PSOO",$J)
"RTN","GMTSPSZO",21,0)
 Q
"RTN","GMTSPSZO",22,0)
HEAD ; Prints Header
"RTN","GMTSPSZO",23,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  W ?67,"Last",!
"RTN","GMTSPSZO",24,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)
"RTN","GMTSPSZO",25,0)
 W "Drug",?27,"Rx #",?38,"St (Exp/Can)",?51,"Qty",?58,"Issued",?67,"Filled",?76,"Rem",! W:$Y'>(IOSL-GMTSLO) !
"RTN","GMTSPSZO",26,0)
 Q
"RTN","GMTSPSZO",27,0)
WRT ; Writes OP Pharmacy Segment Record
"RTN","GMTSPSZO",28,0)
 N ID,LFD,X,MI,NL,CF,GMD,GMV,GMI
"RTN","GMTSPSZO",29,0)
 S ID=$P(GMR,U),LFD=$P(GMR,U,2),ECD=$P(GMR,U,11),CF=$P(GMR,U,10)
"RTN","GMTSPSZO",30,0)
 F GMV="ID","LFD","ECD" S X=@GMV D REGDT^GMTSU S @GMV=X K X
"RTN","GMTSPSZO",31,0)
 S MI=$G(^UTILITY("PSOO",$J,IX,1)),NL=0 I $L(MI)>73 D PARSE
"RTN","GMTSPSZO",32,0)
 S GMD=$P($P(GMR,U,4),";",2)
"RTN","GMTSPSZO",33,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HEAD W $E($P($P(GMR,U,3),";",2),1,25),?27,$P(GMR,U,6),?38,$P($P(GMR,U,5),";"),?40,$S("EC"[$P($P(GMR,U,5),";"):"("_ECD_")",1:""),?51,$P(GMR,U,7),?57,ID,?67,LFD,?76,"("_$P(GMR,U,8)_")",!
"RTN","GMTSPSZO",34,0)
 I 'NL D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HEAD W ?2,MI,!
"RTN","GMTSPSZO",35,0)
 F GMI=1:1:NL D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HEAD W ?2,MI(GMI),!
"RTN","GMTSPSZO",36,0)
 D CKP^GMTSUP Q:$D(GMTSQIT)  D:GMTSNPG HEAD W ?4,"Provider: ",$E(GMD,1,26) W:CF ?41,"Cost/Fill: $",$J(CF,6,2) W !
"RTN","GMTSPSZO",37,0)
 Q
"RTN","GMTSPSZO",38,0)
PARSE ; Parses Medication Instructions
"RTN","GMTSPSZO",39,0)
 N GMI,NW,WPL
"RTN","GMTSPSZO",40,0)
 S NL=$S(($L(MI)/73)>($L(MI)\73):($L(MI)\73)+1,1:$L(MI)\73)
"RTN","GMTSPSZO",41,0)
 S NW=$L(MI," "),WPL=$S((NW/NL)>(NW\NL):(NW\NL)+1,1:NW\NL)
"RTN","GMTSPSZO",42,0)
 F GMI=1:1:NL S MI(GMI)=$P(MI," ",(GMI-1)*WPL+1,GMI*WPL)
"RTN","GMTSPSZO",43,0)
 Q
"VER")
8.0^22.0
**INSTALL NAME**
LR*5.2*365
"BLD",5707,0)
LR*5.2*365^LAB SERVICE^0^3080423^y
"BLD",5707,1,0)
^^355^355^3080423^
"BLD",5707,1,1,0)
EFFECT ON BLOOD BANK FUNCTIONAL REQUIREMENTS: Patch LR*5.2*365 does not 
"BLD",5707,1,2,0)
contain any changes to the VISTA BLOOD BANK Software as defined by VHA 
"BLD",5707,1,3,0)
DIRECTIVE 2004-053 titled VISTA BLOOD BANK SOFTWARE VERSION 5.2.
"BLD",5707,1,4,0)
 
"BLD",5707,1,5,0)
EFFECT ON BLOOD BANK FUNCTIONAL REQUIREMENTS: Patch LR*5.2*365 does
"BLD",5707,1,6,0)
not alter or modify any software design safeguards or safety critical
"BLD",5707,1,7,0)
elements functions.
"BLD",5707,1,8,0)
 
"BLD",5707,1,9,0)
RISK ANALYSIS: Changes made by patch LR*5.2*365 have no effect on Blood 
"BLD",5707,1,10,0)
Bank software functionality, therefore RISK is none.
"BLD",5707,1,11,0)
 
"BLD",5707,1,12,0)
VALIDATION REQUIREMENTS BY OPTION: Because of the nature of the changes 
"BLD",5707,1,13,0)
made, no specific validation requirements exist as a result of 
"BLD",5707,1,14,0)
installation of this patch.
"BLD",5707,1,15,0)
 
"BLD",5707,1,16,0)
This patch is being distributed in the OR*3*243 CPRS v27 build.
"BLD",5707,1,17,0)
 
"BLD",5707,1,18,0)
VistA Laboratory Anatomic Pathology (AP) Alerts and Clinical Patient 
"BLD",5707,1,19,0)
Record System (CPRS) Report Changes Patch LR*5.2*365 software 
"BLD",5707,1,20,0)
release addresses 7 Patient Safety Issues (PSIs). Individual reports 
"BLD",5707,1,21,0)
are displayed as one continuous scrolling display. A single row of 
"BLD",5707,1,22,0)
the equal (=) sign is used to separate one report from the next. 
"BLD",5707,1,23,0)
Additionally, the text- "Next SURGICAL PATHOLOGY Specimen..." is 
"BLD",5707,1,24,0)
also used to separate reports. However, with multiple reports and 
"BLD",5707,1,25,0)
the use of single dashed lines in each report, it can be difficult 
"BLD",5707,1,26,0)
to distinguish the separation between AP reports. A new API has been 
"BLD",5707,1,27,0)
created (EN^LR7OSAP4) for retrieving a detailed report for an 
"BLD",5707,1,28,0)
individual Anatomic Pathology Specimen. This helps resolve the PSI 
"BLD",5707,1,29,0)
by allowing a package interface, like CPRS, to present each 
"BLD",5707,1,30,0)
accession and related specimens to the user and then display the 
"BLD",5707,1,31,0)
related report for the accession/specimens.
"BLD",5707,1,32,0)
 
"BLD",5707,1,33,0)
Patches OR*3*210 and LR*5.2*311 implemented informational alerts 
"BLD",5707,1,34,0)
generated for AP pathology results. Recipients of VA view alerts for 
"BLD",5707,1,35,0)
Anatomic Pathology complained that clicking on the alert did not 
"BLD",5707,1,36,0)
open up or display the report to them in the same manner as other 
"BLD",5707,1,37,0)
lab alerts are displayed. Once the recipients click on the alert, it 
"BLD",5707,1,38,0)
is gone from view. If they did not make a note as to who the patient 
"BLD",5707,1,39,0)
was, they can not get the alert back. Providers can easily erase the 
"BLD",5707,1,40,0)
alerts without recording the patient's name. A potential malignancy 
"BLD",5707,1,41,0)
report could be missed. Problem was identified from complaints of 
"BLD",5707,1,42,0)
surgeons and oncologists/hematologists. To correct this issue the 
"BLD",5707,1,43,0)
new action alert is provided to display AP reports. The Anatomic 
"BLD",5707,1,44,0)
Pathology informational alerts are now modified into action alerts 
"BLD",5707,1,45,0)
that upon processing will direct the user to the associated report 
"BLD",5707,1,46,0)
in the Clinical Reports section under the Reports tab of the CPRS 
"BLD",5707,1,47,0)
GUI or to a List manager display of the associated report results. 
"BLD",5707,1,48,0)
 
"BLD",5707,1,49,0)
This patch provides action alerts for Anatomic Pathology tests 
"BLD",5707,1,50,0)
including Electron Microscopy (EM), Surgical Pathology (SP), 
"BLD",5707,1,51,0)
Cytology (CY), and Autopsy (AU) results. These action alerts are 
"BLD",5707,1,52,0)
sent automatically to the Ordering Provider, Primary Physician, or 
"BLD",5707,1,53,0)
Primary Care Provider at the time the report is released. If 
"BLD",5707,1,54,0)
requested, alerts may be sent to additional person(s) and 
"BLD",5707,1,55,0)
mail group(s). These additional alerts are also action alerts. This 
"BLD",5707,1,56,0)
functionality is now the same whether electronic signature (ES) is 
"BLD",5707,1,57,0)
turned ON or OFF. Before this patch, additional alerts could not be 
"BLD",5707,1,58,0)
requested with electronic signature (ES) turned OFF.
"BLD",5707,1,59,0)
 
"BLD",5707,1,60,0)
This patch provides the new Send an AP Alert [LRAP ALERT] option 
"BLD",5707,1,61,0)
that is available on the Verify/release menu, anat path [LRAPVR] 
"BLD",5707,1,62,0)
which allows a pathologist to send an action alert to a provider, 
"BLD",5707,1,63,0)
other individuals, or mail group(s) after the report has been 
"BLD",5707,1,64,0)
released. Before this software release if the user did not answer 
"BLD",5707,1,65,0)
YES to the prompt to send an alert after a report was released, an 
"BLD",5707,1,66,0)
alert could not be sent unless the AP report was reopened and 
"BLD",5707,1,67,0)
re-released.
"BLD",5707,1,68,0)
 
"BLD",5707,1,69,0)
1) PSI-05-027 and PSI-07-135 identified a patient safety issue using the
"BLD",5707,1,70,0)
CPRS Graphic User Interface (GUI) Lab Tab, Laboratory Results- Anatomic
"BLD",5707,1,71,0)
Pathology (AP).  The individual reports are displayed as one continuous
"BLD",5707,1,72,0)
scrolling display.  A single row of equal (=) signs is used to separate
"BLD",5707,1,73,0)
one report from the next.  Additionally, the text- "Next SURGICAL
"BLD",5707,1,74,0)
PATHOLOGY Specimen..." is also used to separate reports.  However, with
"BLD",5707,1,75,0)
multiple reports and the use of single dashed lines in each report, it
"BLD",5707,1,76,0)
can be difficult to distinguish the separation between AP reports.
"BLD",5707,1,77,0)
 
"BLD",5707,1,78,0)
Resolution:
"BLD",5707,1,79,0)
A new API has been created (EN^LR7OSAP4) for retrieving a detailed report 
"BLD",5707,1,80,0)
for an individual Anatomic Pathology Specimen.  This resolves the 
"BLD",5707,1,81,0)
PSI by allowing a package interface, like CPRS, to present each specimen 
"BLD",5707,1,82,0)
to the user and then get the report on the specimen.
"BLD",5707,1,83,0)
 
"BLD",5707,1,84,0)
2) PSI-06-068, PSI-07-014, PSI-05-001, PSI-06-134, and PSI-07-031
"BLD",5707,1,85,0)
identified a patient safety issue with the Anatomic Pathology notification
"BLD",5707,1,86,0)
alerts. Patches OR*3*210 and LR*5.2*311 implemented informational alerts
"BLD",5707,1,87,0)
generated for pathology results.  Recipients of VA view alerts for 
"BLD",5707,1,88,0)
Anatomic Pathology have complained that clicking on the alert does not
"BLD",5707,1,89,0)
open up or display the report to them in the same manner as other lab
"BLD",5707,1,90,0)
alerts do (CH subscripted).  Once they click on the alert, it's gone from
"BLD",5707,1,91,0)
view.  If they didn't make a note as to who the patient was, they can't
"BLD",5707,1,92,0)
get it back.  It would be helpful to have an action alert for these
"BLD",5707,1,93,0)
results. Providers can easily erase them without recording the patient's
"BLD",5707,1,94,0)
name.  A potential malignancy report could be missed. Problem was
"BLD",5707,1,95,0)
identified from complaints of surgeons and oncologists/hematologists.
"BLD",5707,1,96,0)
 
"BLD",5707,1,97,0)
Resolution:
"BLD",5707,1,98,0)
The Anatomic Pathology informational alerts are now modified into action
"BLD",5707,1,99,0)
alerts that upon processing will direct the user to the associated report
"BLD",5707,1,100,0)
in the Clinical Reports section under the Reports tab of the CPRS GUI or 
"BLD",5707,1,101,0)
to a List manager display of the associated report results.
"BLD",5707,1,102,0)
 
"BLD",5707,1,103,0)
This patch provides action alerts for Anatomic Pathology reports including
"BLD",5707,1,104,0)
Electron Microscopy (EM), Surgical Pathology (SP), Cytology (CY), and 
"BLD",5707,1,105,0)
Autopsy (AU) reports.  These action alerts are sent automatically to the
"BLD",5707,1,106,0)
ordering provider and the primary care physician (PCP) at the time the
"BLD",5707,1,107,0)
report is released.  If requested, alerts may be sent to additional
"BLD",5707,1,108,0)
person(s).  These additional alerts are also action alerts.  This
"BLD",5707,1,109,0)
functionality is now the same whether electronic signature (ES) is 
"BLD",5707,1,110,0)
turned ON or OFF.  Before this patch, additional alerts could not be
"BLD",5707,1,111,0)
requested with electronic signature (ES) turned OFF.
"BLD",5707,1,112,0)
 
"BLD",5707,1,113,0)
The Supplementary report release, anat path [LRAPRS] option now sends 
"BLD",5707,1,114,0)
action alerts automatically to the ordering provider and the PCP at the
"BLD",5707,1,115,0)
time the supplementary report is released.  If requested, alerts may be
"BLD",5707,1,116,0)
sent to additional person(s).  These additional alerts are also action
"BLD",5707,1,117,0)
alerts.  These alerts are sent whether electronic signature is turned ON
"BLD",5707,1,118,0)
or OFF.
"BLD",5707,1,119,0)
 
"BLD",5707,1,120,0)
 Modified options:
"BLD",5707,1,121,0)
 ================
"BLD",5707,1,122,0)
  NAME: LRAPR
"BLD",5707,1,123,0)
  MENU TEXT: Verify/release reports, anat path
"BLD",5707,1,124,0)
  TYPE: run routine
"BLD",5707,1,125,0)
  LOCK: LRVERIFY
"BLD",5707,1,126,0)
  DESCRIPTION:   This option is used to verify/release pathology reports.
"BLD",5707,1,127,0)
 The user is prompted for the accession number of the report to be
"BLD",5707,1,128,0)
 released.  If electronic signature is not activated, the user is asked if
"BLD",5707,1,129,0)
 the report is to be released, yes or no. If electronic signature has been
"BLD",5707,1,130,0)
 activated, the option is used to electronically sign and store pathology
"BLD",5707,1,131,0)
 reports.  It also allows CPT coding to be performed regardless of the
"BLD",5707,1,132,0)
 release status of the chosen report.  Another feature is the ability to
"BLD",5707,1,133,0)
 print SNOMED codes for the given accession/report.  Action alerts are
"BLD",5707,1,134,0)
 sent automatically to the ordering provider and the primary physician or
"BLD",5707,1,135,0)
 PCP at the time the report is released. If requested, alerts may be sent
"BLD",5707,1,136,0)
 to additional person(s) and/or mail group(s). These additional alerts are
"BLD",5707,1,137,0)
 also action alerts.
"BLD",5707,1,138,0)
  ROUTINE: LRAPR  
"BLD",5707,1,139,0)
 
"BLD",5707,1,140,0)
  NAME: LRAPRS
"BLD",5707,1,141,0)
  MENU TEXT: Supplementary report release, anat path
"BLD",5707,1,142,0)
  TYPE: run routine
"BLD",5707,1,143,0)
  DESCRIPTION:   Releases supplementary reports for Surgical Pathology,
"BLD",5707,1,144,0)
 Cytopathology, Electron Microscopy, or Autopsy.  If all supplementary 
"BLD",5707,1,145,0)
 reports that exist for the chosen accession have already been released or
"BLD",5707,1,146,0)
 if no supplementary reports exist for the accession, the user will be
"BLD",5707,1,147,0)
 notified.  If electronic signature is not activated, the user is asked if
"BLD",5707,1,148,0)
 the report is to be released, yes or no.  If electronic signature has
"BLD",5707,1,149,0)
 been activated, the option is used to sign and store the supplementary
"BLD",5707,1,150,0)
 report. Action alerts are sent automatically to the ordering provider and
"BLD",5707,1,151,0)
 the primary physician or PCP at the time the supplementary reports are
"BLD",5707,1,152,0)
 released.  If requested, alerts may be sent to additional person(s)
"BLD",5707,1,153,0)
 and/or mail group(s). These additional alerts are also action alerts.
"BLD",5707,1,154,0)
 These alerts are sent whether electronic signature is on or off.
"BLD",5707,1,155,0)
  ROUTINE: EN^LRAPR
"BLD",5707,1,156,0)
 
"BLD",5707,1,157,0)
3) This patch provides a new option, Send an AP Alert [LRAP ALERT] 
"BLD",5707,1,158,0)
available on the Verify/release menu, anat path [LRAPVR] menu which
"BLD",5707,1,159,0)
allows a pathologist to send an action alert to a provider or other
"BLD",5707,1,160,0)
person(s) or mail group(s) after the case has been released.  The use
"BLD",5707,1,161,0)
of this option requires the LRVERIFY key.  Before, if they did not answer
"BLD",5707,1,162,0)
YES to the prompt to send an alert after a report was released, an alert
"BLD",5707,1,163,0)
could not be sent unless the case was reopened and re-released.
"BLD",5707,1,164,0)
 
"BLD",5707,1,165,0)
 
"BLD",5707,1,166,0)
 New Option:
"BLD",5707,1,167,0)
 ===========
"BLD",5707,1,168,0)
  NAME: LRAP ALERT                      MENU TEXT: Send an AP Alert
"BLD",5707,1,169,0)
  TYPE: run routine
"BLD",5707,1,170,0)
  LOCK: LRVERIFY
"BLD",5707,1,171,0)
  DESCRIPTION:   This option allows a pathologist to send an action alert 
"BLD",5707,1,172,0)
 to a provider or other person(s) or mail group(s) after the case has been
"BLD",5707,1,173,0)
 released.  
"BLD",5707,1,174,0)
  ROUTINE: LRAPALRT  
"BLD",5707,1,175,0)
 
"BLD",5707,1,176,0)
The following option was modified to include the new option, Send an AP 
"BLD",5707,1,177,0)
Alert [LRAP ALERT] on the Verify/release menu, anat path [LRAPVR] menu.
"BLD",5707,1,178,0)
 
"BLD",5707,1,179,0)
 Modified Option:
"BLD",5707,1,180,0)
 ================
"BLD",5707,1,181,0)
  NAME: LRAPVR
"BLD",5707,1,182,0)
  MENU TEXT: Verify/release menu, anat path
"BLD",5707,1,183,0)
  TYPE: menu
"BLD",5707,1,184,0)
  DESCRIPTION:   Anatomic pathology verify and release option menu.  
"BLD",5707,1,185,0)
 ITEM: LRAPR                             SYNONYM: RR
"BLD",5707,1,186,0)
  DISPLAY ORDER: 1
"BLD",5707,1,187,0)
 ITEM: LRAPV                             SYNONYM: LU
"BLD",5707,1,188,0)
  DISPLAY ORDER: 3
"BLD",5707,1,189,0)
 ITEM: LRAPRS                            SYNONYM: RS
"BLD",5707,1,190,0)
  DISPLAY ORDER: 2
"BLD",5707,1,191,0)
 ITEM: LRCAPES                           SYNONYM: CPT
"BLD",5707,1,192,0)
  DISPLAY ORDER: 4
"BLD",5707,1,193,0)
 ITEM: LRAP ALERT                        SYNONYM: SA
"BLD",5707,1,194,0)
 
"BLD",5707,1,195,0)
 Associated E3R:
"BLD",5707,1,196,0)
 ===============
"BLD",5707,1,197,0)
 19879
"BLD",5707,1,198,0)
 18132
"BLD",5707,1,199,0)
 19040
"BLD",5707,1,200,0)
 19516
"BLD",5707,1,201,0)
 19106
"BLD",5707,1,202,0)
 
"BLD",5707,1,203,0)
 
"BLD",5707,1,204,0)
 
"BLD",5707,1,205,0)
 Associated Remedy:
"BLD",5707,1,206,0)
 ==================
"BLD",5707,1,207,0)
 HD0000000087038
"BLD",5707,1,208,0)
 HD0000000145148
"BLD",5707,1,209,0)
 HD0000000175194
"BLD",5707,1,210,0)
 HD0000000071165
"BLD",5707,1,211,0)
 HD0000000175887
"BLD",5707,1,212,0)
 
"BLD",5707,1,213,0)
 Duplicate Remedy:
"BLD",5707,1,214,0)
 =================
"BLD",5707,1,215,0)
 HD0000000200282
"BLD",5707,1,216,0)
 HD0000000161040
"BLD",5707,1,217,0)
 HD0000000117241
"BLD",5707,1,218,0)
 HD0000000131803
"BLD",5707,1,219,0)
 HD0000000159885
"BLD",5707,1,220,0)
 
"BLD",5707,1,221,0)
 Associated PSI:
"BLD",5707,1,222,0)
 ===============
"BLD",5707,1,223,0)
 PSI-05-027
"BLD",5707,1,224,0)
 PSI-07-135
"BLD",5707,1,225,0)
 PSI-05-001
"BLD",5707,1,226,0)
 PSI-06-134
"BLD",5707,1,227,0)
 PSI-06-068
"BLD",5707,1,228,0)
 PSI-07-031
"BLD",5707,1,229,0)
 PSI-07-014
"BLD",5707,1,230,0)
 
"BLD",5707,1,231,0)
 
"BLD",5707,1,232,0)
 Test Sites:
"BLD",5707,1,233,0)
 ===========
"BLD",5707,1,234,0)
 
"BLD",5707,1,235,0)
Charleston, SC - Large
"BLD",5707,1,236,0)
Cleveland, OH - Large
"BLD",5707,1,237,0)
Heartland-East HCS - Large/Integrated
"BLD",5707,1,238,0)
Hudson Valley HCS - Medium/Integrated
"BLD",5707,1,239,0)
Loma Linda, CA - Large
"BLD",5707,1,240,0)
Northern California HCS - Large
"BLD",5707,1,241,0)
Palo Alto HCS - Large/Integrated
"BLD",5707,1,242,0)
Philadelphia, PA - Large
"BLD",5707,1,243,0)
Puget Sound HCS - Large/Integrated
"BLD",5707,1,244,0)
San Diego, CA - Large
"BLD",5707,1,245,0)
Tampa, FL - Large
"BLD",5707,1,246,0)
 
"BLD",5707,1,247,0)
 
"BLD",5707,1,248,0)
Software Retrieval
"BLD",5707,1,249,0)
==================
"BLD",5707,1,250,0)
VistA Laboratory AP Alerts and CPRS Report Changes Patch LR*5.2*365
"BLD",5707,1,251,0)
software is distributed by PackMan.
"BLD",5707,1,252,0)
 
"BLD",5707,1,253,0)
Documentation Retrieval
"BLD",5707,1,254,0)
=======================
"BLD",5707,1,255,0)
VistA AP Alerts and CPRS Report Changes Patch LR*5.2*365 
"BLD",5707,1,256,0)
User Guide is available at the following Office of Information Field
"BLD",5707,1,257,0)
Offices (OIFOs) ANONYMOUS.SOFTWARE directories:
"BLD",5707,1,258,0)
 
"BLD",5707,1,259,0)
OI Field Office     FTP Address                 Directory
"BLD",5707,1,260,0)
---------------     -----------                 ---------
"BLD",5707,1,261,0)
ALBANY              ftp.fo-albany.med.va.gov    [ANONYMOUS.SOFTWARE]
"BLD",5707,1,262,0)
HINES               ftp.fo-hines.med.va.gov     [ANONYMOUS.SOFTWARE]
"BLD",5707,1,263,0)
SALT LAKE CITY      ftp.fo-slc.med.va.gov       [ANONYMOUS.SOFTWARE]
"BLD",5707,1,264,0)
 
"BLD",5707,1,265,0)
 
"BLD",5707,1,266,0)
Documentation Retrieval Formats
"BLD",5707,1,267,0)
===============================
"BLD",5707,1,268,0)
VistA AP Alerts and CPRS Report Changes Patch LR*5.2*365 User 
"BLD",5707,1,269,0)
Guide files are exported in the following retrieval formats:
"BLD",5707,1,270,0)
 
"BLD",5707,1,271,0)
File Name          Contents                       Retrieval Formats
"BLD",5707,1,272,0)
---------          --------                       -----------------
"BLD",5707,1,273,0)
LAB_LR_52_365_UG.doc AP Alerts and CPRS Report Changes  
"BLD",5707,1,274,0)
                     Patch LR*5.2*365 User Guide      BINARY
"BLD",5707,1,275,0)
 
"BLD",5707,1,276,0)
LAB_LR_52_365_UG.pdf AP Alerts and CPRS Report Changes
"BLD",5707,1,277,0)
                     Patch LR*5.2*365 User Guide      BINARY
"BLD",5707,1,278,0)
 
"BLD",5707,1,279,0)
VistA Website Locations:
"BLD",5707,1,280,0)
========================
"BLD",5707,1,281,0)
VistA AP Alerts and CPRS Report Changes Patch LR*5.2*365 User Guide is
"BLD",5707,1,282,0)
accessible in MS Word (.doc) and Portable Document Format 
"BLD",5707,1,283,0)
(.pdf) at the following VistA locations:
"BLD",5707,1,284,0)
 
"BLD",5707,1,285,0)
Laboratory Version 5.2 Home Page
"BLD",5707,1,286,0)
--------------------------------
"BLD",5707,1,287,0)
http://vista.med.va.gov/ClinicalSpecialties/lab/
"BLD",5707,1,288,0)
 
"BLD",5707,1,289,0)
VistA Documentation Library (VDL)
"BLD",5707,1,290,0)
---------------------------------
"BLD",5707,1,291,0)
www.va.gov/vdl/
"BLD",5707,1,292,0)
 
"BLD",5707,1,293,0)
 
"BLD",5707,1,294,0)
Installation Instructions:
"BLD",5707,1,295,0)
==========================
"BLD",5707,1,296,0)
This patch is being distributed in the OR*3.0*243 CPRS v27 build.
"BLD",5707,1,297,0)
 
"BLD",5707,1,298,0)
This patch may be installed with users on the system; however, it should
"BLD",5707,1,299,0)
be installed at a non-peak time to minimize disruption to the users.
"BLD",5707,1,300,0)
Installation of this patch should take less than 1 minute.
"BLD",5707,1,301,0)
 
"BLD",5707,1,302,0)
1.  Use the INSTALL/CHECK MESSAGE option on the PackMan Menu.  
"BLD",5707,1,303,0)
  
"BLD",5707,1,304,0)
2.  From the Kernel Installation and Distribution System (KIDS) Menu, 
"BLD",5707,1,305,0)
    select the Installation menu.  
"BLD",5707,1,306,0)
 
"BLD",5707,1,307,0)
3.  From the Installation menu, you may select to use the following 
"BLD",5707,1,308,0)
    options (when prompted for INSTALL NAME, enter LR*5.2*365): 
"BLD",5707,1,309,0)
 
"BLD",5707,1,310,0)
    a.  Backup a Transport Global 
"BLD",5707,1,311,0)
    b.  Compare Transport Global to Current System
"BLD",5707,1,312,0)
    c.  Print Transport Global 
"BLD",5707,1,313,0)
    d.  Verify Checksums in Transport Global
"BLD",5707,1,314,0)
 
"BLD",5707,1,315,0)
4.  Use the Install Package(s) option and select the package LR*5.2*365.
"BLD",5707,1,316,0)
 
"BLD",5707,1,317,0)
5.  When prompted 'Want KIDS to Rebuild Menu Trees Upon Completion of 
"BLD",5707,1,318,0)
    Install? YES//', respond YES.  Responding "Yes" to this prompt can
"BLD",5707,1,319,0)
    significantly increase install time.
"BLD",5707,1,320,0)
 
"BLD",5707,1,321,0)
6.  When prompted 'Want KIDS to INHIBIT LOGONs during the install? YES//',
"BLD",5707,1,322,0)
    respond NO.
"BLD",5707,1,323,0)
 
"BLD",5707,1,324,0)
7.  When prompted 'Want to DISABLE Scheduled Options, Menu Options, and 
"BLD",5707,1,325,0)
    Protocols? YES//', respond NO.
"BLD",5707,1,326,0)
 
"BLD",5707,1,327,0)
 Note: Routine LR365 will be deleted after successful patch installation.
"BLD",5707,1,328,0)
 
"BLD",5707,1,329,0)
Routine Information:
"BLD",5707,1,330,0)
====================
"BLD",5707,1,331,0)
The second line of each of these routines now looks like:
"BLD",5707,1,332,0)
 ;;5.2;LAB SERVICE;**[Patch List]**;Sep 27, 1994
"BLD",5707,1,333,0)
 
"BLD",5707,1,334,0)
The checksums below are new checksums, and
"BLD",5707,1,335,0)
 can be checked with CHECK1^XTSUMBLD.
"BLD",5707,1,336,0)
 
"BLD",5707,1,337,0)
Routine Name: LR365
"BLD",5707,1,338,0)
    Before:       n/a   After:  B3322693  **365**
"BLD",5707,1,339,0)
Routine Name: LR7OSAP2
"BLD",5707,1,340,0)
    Before: B59162352   After: B59966352  **230,256,259,317,365**
"BLD",5707,1,341,0)
Routine Name: LR7OSAP4
"BLD",5707,1,342,0)
    Before:       n/a   After:  B2801060  **365**
"BLD",5707,1,343,0)
Routine Name: LRAPALRT
"BLD",5707,1,344,0)
    Before:       n/a   After:  B3310137  **365**
"BLD",5707,1,345,0)
Routine Name: LRAPDA
"BLD",5707,1,346,0)
    Before: B76606340   After: B81540087  
"BLD",5707,1,347,0)
**72,73,91,121,248,259,295,317,365**
"BLD",5707,1,348,0)
Routine Name: LRAPR
"BLD",5707,1,349,0)
    Before: B84430863   After: B88035016  **72,248,259,317,365**
"BLD",5707,1,350,0)
Routine Name: LRAPRES1
"BLD",5707,1,351,0)
    Before: B43595923   After: B43214564  **259,336,369,365**
"BLD",5707,1,352,0)
Routine Name: LRWOMEN
"BLD",5707,1,353,0)
    Before:  B1458269   After:  B1173687  **231,248,311,324,365**
"BLD",5707,1,354,0)
 
"BLD",5707,1,355,0)
Routine list of preceding patches: 317, 324, 369
"BLD",5707,4,0)
^9.64PA^^
"BLD",5707,6)
11^
"BLD",5707,6.3)
9
"BLD",5707,"INID")
y
"BLD",5707,"KRN",0)
^9.67PA^8989.52^19
"BLD",5707,"KRN",.4,0)
.4
"BLD",5707,"KRN",.401,0)
.401
"BLD",5707,"KRN",.402,0)
.402
"BLD",5707,"KRN",.403,0)
.403
"BLD",5707,"KRN",.5,0)
.5
"BLD",5707,"KRN",.84,0)
.84
"BLD",5707,"KRN",3.6,0)
3.6
"BLD",5707,"KRN",3.8,0)
3.8
"BLD",5707,"KRN",9.2,0)
9.2
"BLD",5707,"KRN",9.8,0)
9.8
"BLD",5707,"KRN",9.8,"NM",0)
^9.68A^8^7
"BLD",5707,"KRN",9.8,"NM",2,0)
LR7OSAP4^^0^B2801060
"BLD",5707,"KRN",9.8,"NM",3,0)
LRAPDA^^0^B81540087
"BLD",5707,"KRN",9.8,"NM",4,0)
LRWOMEN^^0^B1173687
"BLD",5707,"KRN",9.8,"NM",5,0)
LRAPR^^0^B88035016
"BLD",5707,"KRN",9.8,"NM",6,0)
LRAPRES1^^0^B43214564
"BLD",5707,"KRN",9.8,"NM",7,0)
LRAPALRT^^0^B3310137
"BLD",5707,"KRN",9.8,"NM",8,0)
LR7OSAP2^^0^B59966352
"BLD",5707,"KRN",9.8,"NM","B","LR7OSAP2",8)

"BLD",5707,"KRN",9.8,"NM","B","LR7OSAP4",2)

"BLD",5707,"KRN",9.8,"NM","B","LRAPALRT",7)

"BLD",5707,"KRN",9.8,"NM","B","LRAPDA",3)

"BLD",5707,"KRN",9.8,"NM","B","LRAPR",5)

"BLD",5707,"KRN",9.8,"NM","B","LRAPRES1",6)

"BLD",5707,"KRN",9.8,"NM","B","LRWOMEN",4)

"BLD",5707,"KRN",19,0)
19
"BLD",5707,"KRN",19,"NM",0)
^9.68A^4^4
"BLD",5707,"KRN",19,"NM",1,0)
LRAP ALERT^^0
"BLD",5707,"KRN",19,"NM",2,0)
LRAPVR^^2
"BLD",5707,"KRN",19,"NM",3,0)
LRAPR^^0
"BLD",5707,"KRN",19,"NM",4,0)
LRAPRS^^0
"BLD",5707,"KRN",19,"NM","B","LRAP ALERT",1)

"BLD",5707,"KRN",19,"NM","B","LRAPR",3)

"BLD",5707,"KRN",19,"NM","B","LRAPRS",4)

"BLD",5707,"KRN",19,"NM","B","LRAPVR",2)

"BLD",5707,"KRN",19.1,0)
19.1
"BLD",5707,"KRN",101,0)
101
"BLD",5707,"KRN",409.61,0)
409.61
"BLD",5707,"KRN",771,0)
771
"BLD",5707,"KRN",870,0)
870
"BLD",5707,"KRN",8989.51,0)
8989.51
"BLD",5707,"KRN",8989.52,0)
8989.52
"BLD",5707,"KRN",8994,0)
8994
"BLD",5707,"KRN","B",.4,.4)

"BLD",5707,"KRN","B",.401,.401)

"BLD",5707,"KRN","B",.402,.402)

"BLD",5707,"KRN","B",.403,.403)

"BLD",5707,"KRN","B",.5,.5)

"BLD",5707,"KRN","B",.84,.84)

"BLD",5707,"KRN","B",3.6,3.6)

"BLD",5707,"KRN","B",3.8,3.8)

"BLD",5707,"KRN","B",9.2,9.2)

"BLD",5707,"KRN","B",9.8,9.8)

"BLD",5707,"KRN","B",19,19)

"BLD",5707,"KRN","B",19.1,19.1)

"BLD",5707,"KRN","B",101,101)

"BLD",5707,"KRN","B",409.61,409.61)

"BLD",5707,"KRN","B",771,771)

"BLD",5707,"KRN","B",870,870)

"BLD",5707,"KRN","B",8989.51,8989.51)

"BLD",5707,"KRN","B",8989.52,8989.52)

"BLD",5707,"KRN","B",8994,8994)

"BLD",5707,"PRE")
LR365
"BLD",5707,"QDEF")
^^^^^^^^YES
"BLD",5707,"QUES",0)
^9.62^^
"BLD",5707,"REQB",0)
^9.611^5^5
"BLD",5707,"REQB",1,0)
OR*3.0*210^2
"BLD",5707,"REQB",2,0)
LR*5.2*311^2
"BLD",5707,"REQB",3,0)
LR*5.2*317^2
"BLD",5707,"REQB",4,0)
LR*5.2*324^2
"BLD",5707,"REQB",5,0)
LR*5.2*369^2
"BLD",5707,"REQB","B","LR*5.2*311",2)

"BLD",5707,"REQB","B","LR*5.2*317",3)

"BLD",5707,"REQB","B","LR*5.2*324",4)

"BLD",5707,"REQB","B","LR*5.2*369",5)

"BLD",5707,"REQB","B","OR*3.0*210",1)

"KRN",19,982,-1)
0^3
"KRN",19,982,0)
LRAPR^Verify/release reports, anat path^^R^^LRVERIFY^^^^^^LAB SERVICE
"KRN",19,982,1,0)
^^12^12^3080423^
"KRN",19,982,1,1,0)
This option is used to verify/release pathology reports.  The user is prompted
"KRN",19,982,1,2,0)
for the accession number of the report to be released.  If electronic signature
"KRN",19,982,1,3,0)
is not activated, the user is asked if the report is to be released, yes or no. 
"KRN",19,982,1,4,0)
If electronic signature has been activated, the option is used to
"KRN",19,982,1,5,0)
electronically sign and store pathology reports.  It also allows CPT coding to
"KRN",19,982,1,6,0)
be performed regardless of the release status of the chosen report.  Another
"KRN",19,982,1,7,0)
feature is the ability to print SNOMED codes for the given accession/report.
"KRN",19,982,1,8,0)
Action alerts are sent automatically to the ordering provider and the 
"KRN",19,982,1,9,0)
primary physician or PCP at the time the report is released.  If 
"KRN",19,982,1,10,0)
requested, alerts may be sent to additional person(s) and or mail
"KRN",19,982,1,11,0)
group(s).  These additional alerts are also action alerts.  These alerts
"KRN",19,982,1,12,0)
are sent whether electronic signature is on or off.
"KRN",19,982,25)
LRAPR
"KRN",19,982,99)
55477,35597
"KRN",19,982,"U")
VERIFY/RELEASE REPORTS, ANAT P
"KRN",19,2653,-1)
2^2
"KRN",19,2653,0)
LRAPVR^Verify/release menu, anat path^^M^6473^^^^^^^26
"KRN",19,2653,10,0)
^19.01IP^8^8
"KRN",19,2653,10,1,0)
982^RR^1
"KRN",19,2653,10,1,"^")
LRAPR
"KRN",19,2653,10,5,0)
14216^SA
"KRN",19,2653,10,5,"^")
LRAP ALERT
"KRN",19,2653,10,6,0)
4225^RS^2
"KRN",19,2653,10,6,"^")
LRAPRS
"KRN",19,2653,"U")
VERIFY/RELEASE MENU, ANAT PATH
"KRN",19,4225,-1)
0^4
"KRN",19,4225,0)
LRAPRS^Supplementary report release, anat path^^R^^^^^^^^LAB SERVICE
"KRN",19,4225,1,0)
^^12^12^3080423^
"KRN",19,4225,1,1,0)
Releases supplementary reports for Surgical Pathology, Cytopathology,
"KRN",19,4225,1,2,0)
Electron Microscopy, or Autopsy.  If all supplementary reports that exist
"KRN",19,4225,1,3,0)
for the chosen accession have already been released or if no supplementary
"KRN",19,4225,1,4,0)
reports exist for the accession, the user will be notified.  If 
"KRN",19,4225,1,5,0)
electronic signature is not activated, the user is asked if the report is 
"KRN",19,4225,1,6,0)
to be released, yes or no.  If electronic signature has been activated, 
"KRN",19,4225,1,7,0)
the option is used to sign and store the supplementary report.  Action
"KRN",19,4225,1,8,0)
alerts are sent automatically to the ordering provider and the primary
"KRN",19,4225,1,9,0)
physician or PCP at the time the supplementary reports are released.  If
"KRN",19,4225,1,10,0)
requested, alerts may be sent to additional person(s) and/or mail
"KRN",19,4225,1,11,0)
group(s).  These additional alerts are also action alerts.  These alerts
"KRN",19,4225,1,12,0)
are sent whether electronic signature is on or off.
"KRN",19,4225,3.91,0)
^19.391
"KRN",19,4225,25)
EN^LRAPR
"KRN",19,4225,"U")
SUPPLEMENTARY REPORT RELEASE, 
"KRN",19,14216,-1)
0^1
"KRN",19,14216,0)
LRAP ALERT^Send an AP Alert^^R^^LRVERIFY^^^^^^LAB SERVICE
"KRN",19,14216,1,0)
^^2^2^3080423^
"KRN",19,14216,1,1,0)
This option allows a pathologist to send an action alert to a provider
"KRN",19,14216,1,2,0)
or other person(s) or mail group(s) after the case has been released.
"KRN",19,14216,25)
LRAPALRT
"KRN",19,14216,"U")
SEND AN AP ALERT
"MBREQ")
0
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",26,-1)
1^1
"PKG",26,0)
LAB SERVICE^LR^CORE LAB SYSTEM
"PKG",26,20,0)
^9.402P^1^1
"PKG",26,20,1,0)
2^^LRXDRPT
"PKG",26,20,1,1)

"PKG",26,20,"B",2,1)

"PKG",26,22,0)
^9.49I^1^1
"PKG",26,22,1,0)
5.2^2940927^2941128
"PKG",26,22,1,"PAH",1,0)
365^3080423^6473
"PKG",26,22,1,"PAH",1,1,0)
^^355^355^3080423
"PKG",26,22,1,"PAH",1,1,1,0)
EFFECT ON BLOOD BANK FUNCTIONAL REQUIREMENTS: Patch LR*5.2*365 does not 
"PKG",26,22,1,"PAH",1,1,2,0)
contain any changes to the VISTA BLOOD BANK Software as defined by VHA 
"PKG",26,22,1,"PAH",1,1,3,0)
DIRECTIVE 2004-053 titled VISTA BLOOD BANK SOFTWARE VERSION 5.2.
"PKG",26,22,1,"PAH",1,1,4,0)
 
"PKG",26,22,1,"PAH",1,1,5,0)
EFFECT ON BLOOD BANK FUNCTIONAL REQUIREMENTS: Patch LR*5.2*365 does
"PKG",26,22,1,"PAH",1,1,6,0)
not alter or modify any software design safeguards or safety critical
"PKG",26,22,1,"PAH",1,1,7,0)
elements functions.
"PKG",26,22,1,"PAH",1,1,8,0)
 
"PKG",26,22,1,"PAH",1,1,9,0)
RISK ANALYSIS: Changes made by patch LR*5.2*365 have no effect on Blood 
"PKG",26,22,1,"PAH",1,1,10,0)
Bank software functionality, therefore RISK is none.
"PKG",26,22,1,"PAH",1,1,11,0)
 
"PKG",26,22,1,"PAH",1,1,12,0)
VALIDATION REQUIREMENTS BY OPTION: Because of the nature of the changes 
"PKG",26,22,1,"PAH",1,1,13,0)
made, no specific validation requirements exist as a result of 
"PKG",26,22,1,"PAH",1,1,14,0)
installation of this patch.
"PKG",26,22,1,"PAH",1,1,15,0)
 
"PKG",26,22,1,"PAH",1,1,16,0)
This patch is being distributed in the OR*3*243 CPRS v27 build.
"PKG",26,22,1,"PAH",1,1,17,0)
 
"PKG",26,22,1,"PAH",1,1,18,0)
VistA Laboratory Anatomic Pathology (AP) Alerts and Clinical Patient 
"PKG",26,22,1,"PAH",1,1,19,0)
Record System (CPRS) Report Changes Patch LR*5.2*365 software 
"PKG",26,22,1,"PAH",1,1,20,0)
release addresses 7 Patient Safety Issues (PSIs). Individual reports 
"PKG",26,22,1,"PAH",1,1,21,0)
are displayed as one continuous scrolling display. A single row of 
"PKG",26,22,1,"PAH",1,1,22,0)
the equal (=) sign is used to separate one report from the next. 
"PKG",26,22,1,"PAH",1,1,23,0)
Additionally, the text- "Next SURGICAL PATHOLOGY Specimen..." is 
"PKG",26,22,1,"PAH",1,1,24,0)
also used to separate reports. However, with multiple reports and 
"PKG",26,22,1,"PAH",1,1,25,0)
the use of single dashed lines in each report, it can be difficult 
"PKG",26,22,1,"PAH",1,1,26,0)
to distinguish the separation between AP reports. A new API has been 
"PKG",26,22,1,"PAH",1,1,27,0)
created (EN^LR7OSAP4) for retrieving a detailed report for an 
"PKG",26,22,1,"PAH",1,1,28,0)
individual Anatomic Pathology Specimen. This helps resolve the PSI 
"PKG",26,22,1,"PAH",1,1,29,0)
by allowing a package interface, like CPRS, to present each 
"PKG",26,22,1,"PAH",1,1,30,0)
accession and related specimens to the user and then display the 
"PKG",26,22,1,"PAH",1,1,31,0)
related report for the accession/specimens.
"PKG",26,22,1,"PAH",1,1,32,0)
 
"PKG",26,22,1,"PAH",1,1,33,0)
Patches OR*3*210 and LR*5.2*311 implemented informational alerts 
"PKG",26,22,1,"PAH",1,1,34,0)
generated for AP pathology results. Recipients of VA view alerts for 
"PKG",26,22,1,"PAH",1,1,35,0)
Anatomic Pathology complained that clicking on the alert did not 
"PKG",26,22,1,"PAH",1,1,36,0)
open up or display the report to them in the same manner as other 
"PKG",26,22,1,"PAH",1,1,37,0)
lab alerts are displayed. Once the recipients click on the alert, it 
"PKG",26,22,1,"PAH",1,1,38,0)
is gone from view. If they did not make a note as to who the patient 
"PKG",26,22,1,"PAH",1,1,39,0)
was, they can not get the alert back. Providers can easily erase the 
"PKG",26,22,1,"PAH",1,1,40,0)
alerts without recording the patient's name. A potential malignancy 
"PKG",26,22,1,"PAH",1,1,41,0)
report could be missed. Problem was identified from complaints of 
"PKG",26,22,1,"PAH",1,1,42,0)
surgeons and oncologists/hematologists. To correct this issue the 
"PKG",26,22,1,"PAH",1,1,43,0)
new action alert is provided to display AP reports. The Anatomic 
"PKG",26,22,1,"PAH",1,1,44,0)
Pathology informational alerts are now modified into action alerts 
"PKG",26,22,1,"PAH",1,1,45,0)
that upon processing will direct the user to the associated report 
"PKG",26,22,1,"PAH",1,1,46,0)
in the Clinical Reports section under the Reports tab of the CPRS 
"PKG",26,22,1,"PAH",1,1,47,0)
GUI or to a List manager display of the associated report results. 
"PKG",26,22,1,"PAH",1,1,48,0)
 
"PKG",26,22,1,"PAH",1,1,49,0)
This patch provides action alerts for Anatomic Pathology tests 
"PKG",26,22,1,"PAH",1,1,50,0)
including Electron Microscopy (EM), Surgical Pathology (SP), 
"PKG",26,22,1,"PAH",1,1,51,0)
Cytology (CY), and Autopsy (AU) results. These action alerts are 
"PKG",26,22,1,"PAH",1,1,52,0)
sent automatically to the Ordering Provider, Primary Physician, or 
"PKG",26,22,1,"PAH",1,1,53,0)
Primary Care Provider at the time the report is released. If 
"PKG",26,22,1,"PAH",1,1,54,0)
requested, alerts may be sent to additional person(s) and 
"PKG",26,22,1,"PAH",1,1,55,0)
mail group(s). These additional alerts are also action alerts. This 
"PKG",26,22,1,"PAH",1,1,56,0)
functionality is now the same whether electronic signature (ES) is 
"PKG",26,22,1,"PAH",1,1,57,0)
turned ON or OFF. Before this patch, additional alerts could not be 
"PKG",26,22,1,"PAH",1,1,58,0)
requested with electronic signature (ES) turned OFF.
"PKG",26,22,1,"PAH",1,1,59,0)
 
"PKG",26,22,1,"PAH",1,1,60,0)
This patch provides the new Send an AP Alert [LRAP ALERT] option 
"PKG",26,22,1,"PAH",1,1,61,0)
that is available on the Verify/release menu, anat path [LRAPVR] 
"PKG",26,22,1,"PAH",1,1,62,0)
which allows a pathologist to send an action alert to a provider, 
"PKG",26,22,1,"PAH",1,1,63,0)
other individuals, or mail group(s) after the report has been 
"PKG",26,22,1,"PAH",1,1,64,0)
released. Before this software release if the user did not answer 
"PKG",26,22,1,"PAH",1,1,65,0)
YES to the prompt to send an alert after a report was released, an 
"PKG",26,22,1,"PAH",1,1,66,0)
alert could not be sent unless the AP report was reopened and 
"PKG",26,22,1,"PAH",1,1,67,0)
re-released.
"PKG",26,22,1,"PAH",1,1,68,0)
 
"PKG",26,22,1,"PAH",1,1,69,0)
1) PSI-05-027 and PSI-07-135 identified a patient safety issue using the
"PKG",26,22,1,"PAH",1,1,70,0)
CPRS Graphic User Interface (GUI) Lab Tab, Laboratory Results- Anatomic
"PKG",26,22,1,"PAH",1,1,71,0)
Pathology (AP).  The individual reports are displayed as one continuous
"PKG",26,22,1,"PAH",1,1,72,0)
scrolling display.  A single row of equal (=) signs is used to separate
"PKG",26,22,1,"PAH",1,1,73,0)
one report from the next.  Additionally, the text- "Next SURGICAL
"PKG",26,22,1,"PAH",1,1,74,0)
PATHOLOGY Specimen..." is also used to separate reports.  However, with
"PKG",26,22,1,"PAH",1,1,75,0)
multiple reports and the use of single dashed lines in each report, it
"PKG",26,22,1,"PAH",1,1,76,0)
can be difficult to distinguish the separation between AP reports.
"PKG",26,22,1,"PAH",1,1,77,0)
 
"PKG",26,22,1,"PAH",1,1,78,0)
Resolution:
"PKG",26,22,1,"PAH",1,1,79,0)
A new API has been created (EN^LR7OSAP4) for retrieving a detailed report 
"PKG",26,22,1,"PAH",1,1,80,0)
for an individual Anatomic Pathology Specimen.  This resolves the 
"PKG",26,22,1,"PAH",1,1,81,0)
PSI by allowing a package interface, like CPRS, to present each specimen 
"PKG",26,22,1,"PAH",1,1,82,0)
to the user and then get the report on the specimen.
"PKG",26,22,1,"PAH",1,1,83,0)
 
"PKG",26,22,1,"PAH",1,1,84,0)
2) PSI-06-068, PSI-07-014, PSI-05-001, PSI-06-134, and PSI-07-031
"PKG",26,22,1,"PAH",1,1,85,0)
identified a patient safety issue with the Anatomic Pathology notification
"PKG",26,22,1,"PAH",1,1,86,0)
alerts. Patches OR*3*210 and LR*5.2*311 implemented informational alerts
"PKG",26,22,1,"PAH",1,1,87,0)
generated for pathology results.  Recipients of VA view alerts for 
"PKG",26,22,1,"PAH",1,1,88,0)
Anatomic Pathology have complained that clicking on the alert does not
"PKG",26,22,1,"PAH",1,1,89,0)
open up or display the report to them in the same manner as other lab
"PKG",26,22,1,"PAH",1,1,90,0)
alerts do (CH subscripted).  Once they click on the alert, it's gone from
"PKG",26,22,1,"PAH",1,1,91,0)
view.  If they didn't make a note as to who the patient was, they can't
"PKG",26,22,1,"PAH",1,1,92,0)
get it back.  It would be helpful to have an action alert for these
"PKG",26,22,1,"PAH",1,1,93,0)
results. Providers can easily erase them without recording the patient's
"PKG",26,22,1,"PAH",1,1,94,0)
name.  A potential malignancy report could be missed. Problem was
"PKG",26,22,1,"PAH",1,1,95,0)
identified from complaints of surgeons and oncologists/hematologists.
"PKG",26,22,1,"PAH",1,1,96,0)
 
"PKG",26,22,1,"PAH",1,1,97,0)
Resolution:
"PKG",26,22,1,"PAH",1,1,98,0)
The Anatomic Pathology informational alerts are now modified into action
"PKG",26,22,1,"PAH",1,1,99,0)
alerts that upon processing will direct the user to the associated report
"PKG",26,22,1,"PAH",1,1,100,0)
in the Clinical Reports section under the Reports tab of the CPRS GUI or 
"PKG",26,22,1,"PAH",1,1,101,0)
to a List manager display of the associated report results.
"PKG",26,22,1,"PAH",1,1,102,0)
 
"PKG",26,22,1,"PAH",1,1,103,0)
This patch provides action alerts for Anatomic Pathology reports including
"PKG",26,22,1,"PAH",1,1,104,0)
Electron Microscopy (EM), Surgical Pathology (SP), Cytology (CY), and 
"PKG",26,22,1,"PAH",1,1,105,0)
Autopsy (AU) reports.  These action alerts are sent automatically to the
"PKG",26,22,1,"PAH",1,1,106,0)
ordering provider and the primary care physician (PCP) at the time the
"PKG",26,22,1,"PAH",1,1,107,0)
report is released.  If requested, alerts may be sent to additional
"PKG",26,22,1,"PAH",1,1,108,0)
person(s).  These additional alerts are also action alerts.  This
"PKG",26,22,1,"PAH",1,1,109,0)
functionality is now the same whether electronic signature (ES) is 
"PKG",26,22,1,"PAH",1,1,110,0)
turned ON or OFF.  Before this patch, additional alerts could not be
"PKG",26,22,1,"PAH",1,1,111,0)
requested with electronic signature (ES) turned OFF.
"PKG",26,22,1,"PAH",1,1,112,0)
 
"PKG",26,22,1,"PAH",1,1,113,0)
The Supplementary report release, anat path [LRAPRS] option now sends 
"PKG",26,22,1,"PAH",1,1,114,0)
action alerts automatically to the ordering provider and the PCP at the
"PKG",26,22,1,"PAH",1,1,115,0)
time the supplementary report is released.  If requested, alerts may be
"PKG",26,22,1,"PAH",1,1,116,0)
sent to additional person(s).  These additional alerts are also action
"PKG",26,22,1,"PAH",1,1,117,0)
alerts.  These alerts are sent whether electronic signature is turned ON
"PKG",26,22,1,"PAH",1,1,118,0)
or OFF.
"PKG",26,22,1,"PAH",1,1,119,0)
 
"PKG",26,22,1,"PAH",1,1,120,0)
 Modified options:
"PKG",26,22,1,"PAH",1,1,121,0)
 ================
"PKG",26,22,1,"PAH",1,1,122,0)
  NAME: LRAPR
"PKG",26,22,1,"PAH",1,1,123,0)
  MENU TEXT: Verify/release reports, anat path
"PKG",26,22,1,"PAH",1,1,124,0)
  TYPE: run routine
"PKG",26,22,1,"PAH",1,1,125,0)
  LOCK: LRVERIFY
"PKG",26,22,1,"PAH",1,1,126,0)
  DESCRIPTION:   This option is used to verify/release pathology reports.
"PKG",26,22,1,"PAH",1,1,127,0)
 The user is prompted for the accession number of the report to be
"PKG",26,22,1,"PAH",1,1,128,0)
 released.  If electronic signature is not activated, the user is asked if
"PKG",26,22,1,"PAH",1,1,129,0)
 the report is to be released, yes or no. If electronic signature has been
"PKG",26,22,1,"PAH",1,1,130,0)
 activated, the option is used to electronically sign and store pathology
"PKG",26,22,1,"PAH",1,1,131,0)
 reports.  It also allows CPT coding to be performed regardless of the
"PKG",26,22,1,"PAH",1,1,132,0)
 release status of the chosen report.  Another feature is the ability to
"PKG",26,22,1,"PAH",1,1,133,0)
 print SNOMED codes for the given accession/report.  Action alerts are
"PKG",26,22,1,"PAH",1,1,134,0)
 sent automatically to the ordering provider and the primary physician or
"PKG",26,22,1,"PAH",1,1,135,0)
 PCP at the time the report is released. If requested, alerts may be sent
"PKG",26,22,1,"PAH",1,1,136,0)
 to additional person(s) and/or mail group(s). These additional alerts are
"PKG",26,22,1,"PAH",1,1,137,0)
 also action alerts.
"PKG",26,22,1,"PAH",1,1,138,0)
  ROUTINE: LRAPR  
"PKG",26,22,1,"PAH",1,1,139,0)
 
"PKG",26,22,1,"PAH",1,1,140,0)
  NAME: LRAPRS
"PKG",26,22,1,"PAH",1,1,141,0)
  MENU TEXT: Supplementary report release, anat path
"PKG",26,22,1,"PAH",1,1,142,0)
  TYPE: run routine
"PKG",26,22,1,"PAH",1,1,143,0)
  DESCRIPTION:   Releases supplementary reports for Surgical Pathology,
"PKG",26,22,1,"PAH",1,1,144,0)
 Cytopathology, Electron Microscopy, or Autopsy.  If all supplementary 
"PKG",26,22,1,"PAH",1,1,145,0)
 reports that exist for the chosen accession have already been released or
"PKG",26,22,1,"PAH",1,1,146,0)
 if no supplementary reports exist for the accession, the user will be
"PKG",26,22,1,"PAH",1,1,147,0)
 notified.  If electronic signature is not activated, the user is asked if
"PKG",26,22,1,"PAH",1,1,148,0)
 the report is to be released, yes or no.  If electronic signature has
"PKG",26,22,1,"PAH",1,1,149,0)
 been activated, the option is used to sign and store the supplementary
"PKG",26,22,1,"PAH",1,1,150,0)
 report. Action alerts are sent automatically to the ordering provider and
"PKG",26,22,1,"PAH",1,1,151,0)
 the primary physician or PCP at the time the supplementary reports are
"PKG",26,22,1,"PAH",1,1,152,0)
 released.  If requested, alerts may be sent to additional person(s)
"PKG",26,22,1,"PAH",1,1,153,0)
 and/or mail group(s). These additional alerts are also action alerts.
"PKG",26,22,1,"PAH",1,1,154,0)
 These alerts are sent whether electronic signature is on or off.
"PKG",26,22,1,"PAH",1,1,155,0)
  ROUTINE: EN^LRAPR
"PKG",26,22,1,"PAH",1,1,156,0)
 
"PKG",26,22,1,"PAH",1,1,157,0)
3) This patch provides a new option, Send an AP Alert [LRAP ALERT] 
"PKG",26,22,1,"PAH",1,1,158,0)
available on the Verify/release menu, anat path [LRAPVR] menu which
"PKG",26,22,1,"PAH",1,1,159,0)
allows a pathologist to send an action alert to a provider or other
"PKG",26,22,1,"PAH",1,1,160,0)
person(s) or mail group(s) after the case has been released.  The use
"PKG",26,22,1,"PAH",1,1,161,0)
of this option requires the LRVERIFY key.  Before, if they did not answer
"PKG",26,22,1,"PAH",1,1,162,0)
YES to the prompt to send an alert after a report was released, an alert
"PKG",26,22,1,"PAH",1,1,163,0)
could not be sent unless the case was reopened and re-released.
"PKG",26,22,1,"PAH",1,1,164,0)
 
"PKG",26,22,1,"PAH",1,1,165,0)
 
"PKG",26,22,1,"PAH",1,1,166,0)
 New Option:
"PKG",26,22,1,"PAH",1,1,167,0)
 ===========
"PKG",26,22,1,"PAH",1,1,168,0)
  NAME: LRAP ALERT                      MENU TEXT: Send an AP Alert
"PKG",26,22,1,"PAH",1,1,169,0)
  TYPE: run routine
"PKG",26,22,1,"PAH",1,1,170,0)
  LOCK: LRVERIFY
"PKG",26,22,1,"PAH",1,1,171,0)
  DESCRIPTION:   This option allows a pathologist to send an action alert 
"PKG",26,22,1,"PAH",1,1,172,0)
 to a provider or other person(s) or mail group(s) after the case has been
"PKG",26,22,1,"PAH",1,1,173,0)
 released.  
"PKG",26,22,1,"PAH",1,1,174,0)
  ROUTINE: LRAPALRT  
"PKG",26,22,1,"PAH",1,1,175,0)
 
"PKG",26,22,1,"PAH",1,1,176,0)
The following option was modified to include the new option, Send an AP 
"PKG",26,22,1,"PAH",1,1,177,0)
Alert [LRAP ALERT] on the Verify/release menu, anat path [LRAPVR] menu.
"PKG",26,22,1,"PAH",1,1,178,0)
 
"PKG",26,22,1,"PAH",1,1,179,0)
 Modified Option:
"PKG",26,22,1,"PAH",1,1,180,0)
 ================
"PKG",26,22,1,"PAH",1,1,181,0)
  NAME: LRAPVR
"PKG",26,22,1,"PAH",1,1,182,0)
  MENU TEXT: Verify/release menu, anat path
"PKG",26,22,1,"PAH",1,1,183,0)
  TYPE: menu
"PKG",26,22,1,"PAH",1,1,184,0)
  DESCRIPTION:   Anatomic pathology verify and release option menu.  
"PKG",26,22,1,"PAH",1,1,185,0)
 ITEM: LRAPR                             SYNONYM: RR
"PKG",26,22,1,"PAH",1,1,186,0)
  DISPLAY ORDER: 1
"PKG",26,22,1,"PAH",1,1,187,0)
 ITEM: LRAPV                             SYNONYM: LU
"PKG",26,22,1,"PAH",1,1,188,0)
  DISPLAY ORDER: 3
"PKG",26,22,1,"PAH",1,1,189,0)
 ITEM: LRAPRS                            SYNONYM: RS
"PKG",26,22,1,"PAH",1,1,190,0)
  DISPLAY ORDER: 2
"PKG",26,22,1,"PAH",1,1,191,0)
 ITEM: LRCAPES                           SYNONYM: CPT
"PKG",26,22,1,"PAH",1,1,192,0)
  DISPLAY ORDER: 4
"PKG",26,22,1,"PAH",1,1,193,0)
 ITEM: LRAP ALERT                        SYNONYM: SA
"PKG",26,22,1,"PAH",1,1,194,0)
 
"PKG",26,22,1,"PAH",1,1,195,0)
 Associated E3R:
"PKG",26,22,1,"PAH",1,1,196,0)
 ===============
"PKG",26,22,1,"PAH",1,1,197,0)
 19879
"PKG",26,22,1,"PAH",1,1,198,0)
 18132
"PKG",26,22,1,"PAH",1,1,199,0)
 19040
"PKG",26,22,1,"PAH",1,1,200,0)
 19516
"PKG",26,22,1,"PAH",1,1,201,0)
 19106
"PKG",26,22,1,"PAH",1,1,202,0)
 
"PKG",26,22,1,"PAH",1,1,203,0)
 
"PKG",26,22,1,"PAH",1,1,204,0)
 
"PKG",26,22,1,"PAH",1,1,205,0)
 Associated Remedy:
"PKG",26,22,1,"PAH",1,1,206,0)
 ==================
"PKG",26,22,1,"PAH",1,1,207,0)
 HD0000000087038
"PKG",26,22,1,"PAH",1,1,208,0)
 HD0000000145148
"PKG",26,22,1,"PAH",1,1,209,0)
 HD0000000175194
"PKG",26,22,1,"PAH",1,1,210,0)
 HD0000000071165
"PKG",26,22,1,"PAH",1,1,211,0)
 HD0000000175887
"PKG",26,22,1,"PAH",1,1,212,0)
 
"PKG",26,22,1,"PAH",1,1,213,0)
 Duplicate Remedy:
"PKG",26,22,1,"PAH",1,1,214,0)
 =================
"PKG",26,22,1,"PAH",1,1,215,0)
 HD0000000200282
"PKG",26,22,1,"PAH",1,1,216,0)
 HD0000000161040
"PKG",26,22,1,"PAH",1,1,217,0)
 HD0000000117241
"PKG",26,22,1,"PAH",1,1,218,0)
 HD0000000131803
"PKG",26,22,1,"PAH",1,1,219,0)
 HD0000000159885
"PKG",26,22,1,"PAH",1,1,220,0)
 
"PKG",26,22,1,"PAH",1,1,221,0)
 Associated PSI:
"PKG",26,22,1,"PAH",1,1,222,0)
 ===============
"PKG",26,22,1,"PAH",1,1,223,0)
 PSI-05-027
"PKG",26,22,1,"PAH",1,1,224,0)
 PSI-07-135
"PKG",26,22,1,"PAH",1,1,225,0)
 PSI-05-001
"PKG",26,22,1,"PAH",1,1,226,0)
 PSI-06-134
"PKG",26,22,1,"PAH",1,1,227,0)
 PSI-06-068
"PKG",26,22,1,"PAH",1,1,228,0)
 PSI-07-031
"PKG",26,22,1,"PAH",1,1,229,0)
 PSI-07-014
"PKG",26,22,1,"PAH",1,1,230,0)
 
"PKG",26,22,1,"PAH",1,1,231,0)
 
"PKG",26,22,1,"PAH",1,1,232,0)
 Test Sites:
"PKG",26,22,1,"PAH",1,1,233,0)
 ===========
"PKG",26,22,1,"PAH",1,1,234,0)
 
"PKG",26,22,1,"PAH",1,1,235,0)
Charleston, SC - Large
"PKG",26,22,1,"PAH",1,1,236,0)
Cleveland, OH - Large
"PKG",26,22,1,"PAH",1,1,237,0)
Heartland-East HCS - Large/Integrated
"PKG",26,22,1,"PAH",1,1,238,0)
Hudson Valley HCS - Medium/Integrated
"PKG",26,22,1,"PAH",1,1,239,0)
Loma Linda, CA - Large
"PKG",26,22,1,"PAH",1,1,240,0)
Northern California HCS - Large
"PKG",26,22,1,"PAH",1,1,241,0)
Palo Alto HCS - Large/Integrated
"PKG",26,22,1,"PAH",1,1,242,0)
Philadelphia, PA - Large
"PKG",26,22,1,"PAH",1,1,243,0)
Puget Sound HCS - Large/Integrated
"PKG",26,22,1,"PAH",1,1,244,0)
San Diego, CA - Large
"PKG",26,22,1,"PAH",1,1,245,0)
Tampa, FL - Large
"PKG",26,22,1,"PAH",1,1,246,0)
 
"PKG",26,22,1,"PAH",1,1,247,0)
 
"PKG",26,22,1,"PAH",1,1,248,0)
Software Retrieval
"PKG",26,22,1,"PAH",1,1,249,0)
==================
"PKG",26,22,1,"PAH",1,1,250,0)
VistA Laboratory AP Alerts and CPRS Report Changes Patch LR*5.2*365
"PKG",26,22,1,"PAH",1,1,251,0)
software is distributed by PackMan.
"PKG",26,22,1,"PAH",1,1,252,0)
 
"PKG",26,22,1,"PAH",1,1,253,0)
Documentation Retrieval
"PKG",26,22,1,"PAH",1,1,254,0)
=======================
"PKG",26,22,1,"PAH",1,1,255,0)
VistA AP Alerts and CPRS Report Changes Patch LR*5.2*365 
"PKG",26,22,1,"PAH",1,1,256,0)
User Guide is available at the following Office of Information Field
"PKG",26,22,1,"PAH",1,1,257,0)
Offices (OIFOs) ANONYMOUS.SOFTWARE directories:
"PKG",26,22,1,"PAH",1,1,258,0)
 
"PKG",26,22,1,"PAH",1,1,259,0)
OI Field Office     FTP Address                 Directory
"PKG",26,22,1,"PAH",1,1,260,0)
---------------     -----------                 ---------
"PKG",26,22,1,"PAH",1,1,261,0)
ALBANY              ftp.fo-albany.med.va.gov    [ANONYMOUS.SOFTWARE]
"PKG",26,22,1,"PAH",1,1,262,0)
HINES               ftp.fo-hines.med.va.gov     [ANONYMOUS.SOFTWARE]
"PKG",26,22,1,"PAH",1,1,263,0)
SALT LAKE CITY      ftp.fo-slc.med.va.gov       [ANONYMOUS.SOFTWARE]
"PKG",26,22,1,"PAH",1,1,264,0)
 
"PKG",26,22,1,"PAH",1,1,265,0)
 
"PKG",26,22,1,"PAH",1,1,266,0)
Documentation Retrieval Formats
"PKG",26,22,1,"PAH",1,1,267,0)
===============================
"PKG",26,22,1,"PAH",1,1,268,0)
VistA AP Alerts and CPRS Report Changes Patch LR*5.2*365 User 
"PKG",26,22,1,"PAH",1,1,269,0)
Guide files are exported in the following retrieval formats:
"PKG",26,22,1,"PAH",1,1,270,0)
 
"PKG",26,22,1,"PAH",1,1,271,0)
File Name          Contents                       Retrieval Formats
"PKG",26,22,1,"PAH",1,1,272,0)
---------          --------                       -----------------
"PKG",26,22,1,"PAH",1,1,273,0)
LAB_LR_52_365_UG.doc AP Alerts and CPRS Report Changes  
"PKG",26,22,1,"PAH",1,1,274,0)
                     Patch LR*5.2*365 User Guide      BINARY
"PKG",26,22,1,"PAH",1,1,275,0)
 
"PKG",26,22,1,"PAH",1,1,276,0)
LAB_LR_52_365_UG.pdf AP Alerts and CPRS Report Changes
"PKG",26,22,1,"PAH",1,1,277,0)
                     Patch LR*5.2*365 User Guide      BINARY
"PKG",26,22,1,"PAH",1,1,278,0)
 
"PKG",26,22,1,"PAH",1,1,279,0)
VistA Website Locations:
"PKG",26,22,1,"PAH",1,1,280,0)
========================
"PKG",26,22,1,"PAH",1,1,281,0)
VistA AP Alerts and CPRS Report Changes Patch LR*5.2*365 User Guide is
"PKG",26,22,1,"PAH",1,1,282,0)
accessible in MS Word (.doc) and Portable Document Format 
"PKG",26,22,1,"PAH",1,1,283,0)
(.pdf) at the following VistA locations:
"PKG",26,22,1,"PAH",1,1,284,0)
 
"PKG",26,22,1,"PAH",1,1,285,0)
Laboratory Version 5.2 Home Page
"PKG",26,22,1,"PAH",1,1,286,0)
--------------------------------
"PKG",26,22,1,"PAH",1,1,287,0)
http://vista.med.va.gov/ClinicalSpecialties/lab/
"PKG",26,22,1,"PAH",1,1,288,0)
 
"PKG",26,22,1,"PAH",1,1,289,0)
VistA Documentation Library (VDL)
"PKG",26,22,1,"PAH",1,1,290,0)
---------------------------------
"PKG",26,22,1,"PAH",1,1,291,0)
www.va.gov/vdl/
"PKG",26,22,1,"PAH",1,1,292,0)
 
"PKG",26,22,1,"PAH",1,1,293,0)
 
"PKG",26,22,1,"PAH",1,1,294,0)
Installation Instructions:
"PKG",26,22,1,"PAH",1,1,295,0)
==========================
"PKG",26,22,1,"PAH",1,1,296,0)
This patch is being distributed in the OR*3.0*243 CPRS v27 build.
"PKG",26,22,1,"PAH",1,1,297,0)
 
"PKG",26,22,1,"PAH",1,1,298,0)
This patch may be installed with users on the system; however, it should
"PKG",26,22,1,"PAH",1,1,299,0)
be installed at a non-peak time to minimize disruption to the users.
"PKG",26,22,1,"PAH",1,1,300,0)
Installation of this patch should take less than 1 minute.
"PKG",26,22,1,"PAH",1,1,301,0)
 
"PKG",26,22,1,"PAH",1,1,302,0)
1.  Use the INSTALL/CHECK MESSAGE option on the PackMan Menu.  
"PKG",26,22,1,"PAH",1,1,303,0)
  
"PKG",26,22,1,"PAH",1,1,304,0)
2.  From the Kernel Installation and Distribution System (KIDS) Menu, 
"PKG",26,22,1,"PAH",1,1,305,0)
    select the Installation menu.  
"PKG",26,22,1,"PAH",1,1,306,0)
 
"PKG",26,22,1,"PAH",1,1,307,0)
3.  From the Installation menu, you may select to use the following 
"PKG",26,22,1,"PAH",1,1,308,0)
    options (when prompted for INSTALL NAME, enter LR*5.2*365): 
"PKG",26,22,1,"PAH",1,1,309,0)
 
"PKG",26,22,1,"PAH",1,1,310,0)
    a.  Backup a Transport Global 
"PKG",26,22,1,"PAH",1,1,311,0)
    b.  Compare Transport Global to Current System
"PKG",26,22,1,"PAH",1,1,312,0)
    c.  Print Transport Global 
"PKG",26,22,1,"PAH",1,1,313,0)
    d.  Verify Checksums in Transport Global
"PKG",26,22,1,"PAH",1,1,314,0)
 
"PKG",26,22,1,"PAH",1,1,315,0)
4.  Use the Install Package(s) option and select the package LR*5.2*365.
"PKG",26,22,1,"PAH",1,1,316,0)
 
"PKG",26,22,1,"PAH",1,1,317,0)
5.  When prompted 'Want KIDS to Rebuild Menu Trees Upon Completion of 
"PKG",26,22,1,"PAH",1,1,318,0)
    Install? YES//', respond YES.  Responding "Yes" to this prompt can
"PKG",26,22,1,"PAH",1,1,319,0)
    significantly increase install time.
"PKG",26,22,1,"PAH",1,1,320,0)
 
"PKG",26,22,1,"PAH",1,1,321,0)
6.  When prompted 'Want KIDS to INHIBIT LOGONs during the install? YES//',
"PKG",26,22,1,"PAH",1,1,322,0)
    respond NO.
"PKG",26,22,1,"PAH",1,1,323,0)
 
"PKG",26,22,1,"PAH",1,1,324,0)
7.  When prompted 'Want to DISABLE Scheduled Options, Menu Options, and 
"PKG",26,22,1,"PAH",1,1,325,0)
    Protocols? YES//', respond NO.
"PKG",26,22,1,"PAH",1,1,326,0)
 
"PKG",26,22,1,"PAH",1,1,327,0)
 Note: Routine LR365 will be deleted after successful patch installation.
"PKG",26,22,1,"PAH",1,1,328,0)
 
"PKG",26,22,1,"PAH",1,1,329,0)
Routine Information:
"PKG",26,22,1,"PAH",1,1,330,0)
====================
"PKG",26,22,1,"PAH",1,1,331,0)
The second line of each of these routines now looks like:
"PKG",26,22,1,"PAH",1,1,332,0)
 ;;5.2;LAB SERVICE;**[Patch List]**;Sep 27, 1994
"PKG",26,22,1,"PAH",1,1,333,0)
 
"PKG",26,22,1,"PAH",1,1,334,0)
The checksums below are new checksums, and
"PKG",26,22,1,"PAH",1,1,335,0)
 can be checked with CHECK1^XTSUMBLD.
"PKG",26,22,1,"PAH",1,1,336,0)
 
"PKG",26,22,1,"PAH",1,1,337,0)
Routine Name: LR365
"PKG",26,22,1,"PAH",1,1,338,0)
    Before:       n/a   After:  B3322693  **365**
"PKG",26,22,1,"PAH",1,1,339,0)
Routine Name: LR7OSAP2
"PKG",26,22,1,"PAH",1,1,340,0)
    Before: B59162352   After: B59966352  **230,256,259,317,365**
"PKG",26,22,1,"PAH",1,1,341,0)
Routine Name: LR7OSAP4
"PKG",26,22,1,"PAH",1,1,342,0)
    Before:       n/a   After:  B2801060  **365**
"PKG",26,22,1,"PAH",1,1,343,0)
Routine Name: LRAPALRT
"PKG",26,22,1,"PAH",1,1,344,0)
    Before:       n/a   After:  B3310137  **365**
"PKG",26,22,1,"PAH",1,1,345,0)
Routine Name: LRAPDA
"PKG",26,22,1,"PAH",1,1,346,0)
    Before: B76606340   After: B81540087  
"PKG",26,22,1,"PAH",1,1,347,0)
**72,73,91,121,248,259,295,317,365**
"PKG",26,22,1,"PAH",1,1,348,0)
Routine Name: LRAPR
"PKG",26,22,1,"PAH",1,1,349,0)
    Before: B84430863   After: B88035016  **72,248,259,317,365**
"PKG",26,22,1,"PAH",1,1,350,0)
Routine Name: LRAPRES1
"PKG",26,22,1,"PAH",1,1,351,0)
    Before: B43595923   After: B43214564  **259,336,369,365**
"PKG",26,22,1,"PAH",1,1,352,0)
Routine Name: LRWOMEN
"PKG",26,22,1,"PAH",1,1,353,0)
    Before:  B1458269   After:  B1173687  **231,248,311,324,365**
"PKG",26,22,1,"PAH",1,1,354,0)
 
"PKG",26,22,1,"PAH",1,1,355,0)
Routine list of preceding patches: 317, 324, 369
"PRE")
LR365
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
YES
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
8
"RTN","LR365")
0^^B3322693^n/a
"RTN","LR365",1,0)
LR365 ;DALOI/CKA - LR*5.2*365 PATCH ENVIRONMENT CHECK ROUTINE ;05/7/07
"RTN","LR365",2,0)
 ;;5.2;LAB SERVICE;**365**;Sep 27, 1994;Build 9
"RTN","LR365",3,0)
EN ; Does not prevent loading of the transport global.
"RTN","LR365",4,0)
 ; Environment check is done only during the install.
"RTN","LR365",5,0)
 ;
"RTN","LR365",6,0)
 I '$G(XPDENV) D  Q
"RTN","LR365",7,0)
 .N XQA,XQAMSG
"RTN","LR365",8,0)
 .S XQAMSG="Transport global for patch "_$G(XPDNM,"Unknown patch")
"RTN","LR365",9,0)
 .S XQAMSG=XQAMSG_" loaded on "_$$HTE^XLFDT($H)
"RTN","LR365",10,0)
 .S XQA("G.LMI")=""
"RTN","LR365",11,0)
 .D SETUP^XQALERT
"RTN","LR365",12,0)
 .S MSG="Sending transport global loaded alert to mail group G.LMI"
"RTN","LR365",13,0)
 .D BMES^XPDUTL($$CJ^XLFSTR(MSG,80)) K MSG
"RTN","LR365",14,0)
 ;
"RTN","LR365",15,0)
 D CHECK
"RTN","LR365",16,0)
 D EXIT
"RTN","LR365",17,0)
 Q
"RTN","LR365",18,0)
 ;
"RTN","LR365",19,0)
CHECK ; Perform environment check
"RTN","LR365",20,0)
 ;
"RTN","LR365",21,0)
 I $S('$G(IOM):1,'$G(IOSL):1,$G(U)'="^":1,1:0) D  Q
"RTN","LR365",22,0)
 .D BMES^XPDUTL($$CJ^XLFSTR("Terminal Device is not defined",80))
"RTN","LR365",23,0)
 .S XPDQUIT=2
"RTN","LR365",24,0)
 ;
"RTN","LR365",25,0)
 I $S('$G(DUZ):1,$D(DUZ)[0:1,$D(DUZ(0))[0:1,1:0) D  Q
"RTN","LR365",26,0)
 .S MSG="Please log in to set local DUZ... variables"
"RTN","LR365",27,0)
 .D BMES^XPDUTL($$CJ^XLFSTR(MSG,80)) K MSG
"RTN","LR365",28,0)
 .S XPDQUIT=2
"RTN","LR365",29,0)
 ;
"RTN","LR365",30,0)
 I '$D(^VA(200,$G(DUZ),0))#2 D  Q
"RTN","LR365",31,0)
 .S MSG="You are not a valid user on this system"
"RTN","LR365",32,0)
 .D BMES^XPDUTL($$CJ^XLFSTR(MSG,80)) K MSG
"RTN","LR365",33,0)
 .S XPDQUIT=2
"RTN","LR365",34,0)
 ;
"RTN","LR365",35,0)
 S XPDIQ("XPZ1","B")="NO"
"RTN","LR365",36,0)
 ;
"RTN","LR365",37,0)
 Q
"RTN","LR365",38,0)
 ;
"RTN","LR365",39,0)
EXIT ;
"RTN","LR365",40,0)
 I $G(XPDQUIT) D
"RTN","LR365",41,0)
 .S MSG="--- Install Environment Check FAILED ---"
"RTN","LR365",42,0)
 .D BMES^XPDUTL($$CJ^XLFSTR(MSG,80)) K MSG
"RTN","LR365",43,0)
 I '$G(XPDQUIT) D
"RTN","LR365",44,0)
 .D BMES^XPDUTL($$CJ^XLFSTR("--- Environment Check is Ok ---",80))
"RTN","LR365",45,0)
 Q
"RTN","LR365",46,0)
 ;
"RTN","LR365",47,0)
PRE ; KIDS Pre install for LR*5.2*365
"RTN","LR365",48,0)
 Q
"RTN","LR365",49,0)
 ;
"RTN","LR365",50,0)
POST ; KIDS Post install for LR*5.2*365
"RTN","LR365",51,0)
 ;
"RTN","LR365",52,0)
 Q
"RTN","LR7OSAP2")
0^8^B59966352^B59162352
"RTN","LR7OSAP2",1,0)
LR7OSAP2 ;ISL/RAB/WTY/KLL - Silent Routine for autopsy report;3/28/2002
"RTN","LR7OSAP2",2,0)
 ;;5.2;LAB SERVICE;**230,256,259,317,365**;Sep 27, 1994;Build 9
"RTN","LR7OSAP2",3,0)
 ;
"RTN","LR7OSAP2",4,0)
 ;Reference  to ^DD(63 supported by IA #999
"RTN","LR7OSAP2",5,0)
 ;
"RTN","LR7OSAP2",6,0)
EN(LRDFN) ;
"RTN","LR7OSAP2",7,0)
 N CCNT,GIOM,XPOS,LR,LRSS,X,I,LRAU,LRS,VERIFIED,LRTEXT,LRPTR,X2
"RTN","LR7OSAP2",8,0)
 S XPOS=0,(LRS(5),LR("M"),CCNT)=1,LRSS="AU",GIOM=80
"RTN","LR7OSAP2",9,0)
 D EN^LRUA,^LRAPU
"RTN","LR7OSAP2",10,0)
 S X=$S($D(^LRO(69.2,+Y,0)):^(0),1:""),LRAU(3)=$P(X,"^",3),LRAU(4)=$P(X,"^",4)
"RTN","LR7OSAP2",11,0)
 D LINE,LN
"RTN","LR7OSAP2",12,0)
 S ^TMP("LRH",$J,"AUTOPSY")=GCNT,^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(28,CCNT,"---- AUTOPSY ----")
"RTN","LR7OSAP2",13,0)
 S VERIFIED=$P($G(^LR(LRDFN,"AU")),U,15)
"RTN","LR7OSAP2",14,0)
 I 'VERIFIED D  Q
"RTN","LR7OSAP2",15,0)
 . D LN
"RTN","LR7OSAP2",16,0)
 . S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(XPOS,CCNT,"Report not verified.")
"RTN","LR7OSAP2",17,0)
 D TIUCHK^LRAPUTL(.LRPTR,LRDFN,LRSS)
"RTN","LR7OSAP2",18,0)
 I +$G(LRPTR) D  Q
"RTN","LR7OSAP2",19,0)
 .D MAIN^LR7OSAP3(LRPTR)
"RTN","LR7OSAP2",20,0)
 D ZZ,LINE
"RTN","LR7OSAP2",21,0)
 I $D(^LR(LRDFN,84)) D
"RTN","LR7OSAP2",22,0)
 .D LN
"RTN","LR7OSAP2",23,0)
 .S LRTEXT="SUPPLEMENTARY REPORT HAS BEEN ADDED"
"RTN","LR7OSAP2",24,0)
 .S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(14,CCNT,"*+* "_LRTEXT_" *+*")
"RTN","LR7OSAP2",25,0)
 .D LN
"RTN","LR7OSAP2",26,0)
 .S LRTEXT="REFER TO BOTTOM OF REPORT"
"RTN","LR7OSAP2",27,0)
 .S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(19,CCNT,"*+* "_LRTEXT_" *+*")
"RTN","LR7OSAP2",28,0)
 .D LN
"RTN","LR7OSAP2",29,0)
 I $D(^LR(LRDFN,81)) D 
"RTN","LR7OSAP2",30,0)
 . D LN
"RTN","LR7OSAP2",31,0)
 . S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(XPOS,CCNT,LRAU(3))
"RTN","LR7OSAP2",32,0)
 . D F(81)
"RTN","LR7OSAP2",33,0)
 I $D(^LR(LRDFN,82)) D 
"RTN","LR7OSAP2",34,0)
 . D LN
"RTN","LR7OSAP2",35,0)
 . S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(XPOS,CCNT,LRAU(4))
"RTN","LR7OSAP2",36,0)
 . D F(82)
"RTN","LR7OSAP2",37,0)
 I $O(^LR(LRDFN,84,0)) D
"RTN","LR7OSAP2",38,0)
 . S I=0 F  S I=$O(^LR(LRDFN,84,I)) Q:'I  S X=^(I,0) D
"RTN","LR7OSAP2",39,0)
 .. ;Don't print supp date and text if supp has not been released
"RTN","LR7OSAP2",40,0)
 .. S X1=$P(X,"^",1),X2=$P(X,"^",2)
"RTN","LR7OSAP2",41,0)
 .. Q:'X2
"RTN","LR7OSAP2",42,0)
 .. D LINE,LN
"RTN","LR7OSAP2",43,0)
 .. S LRTEXT="SUPPLEMENTARY REPORT DATE: "_$$FMTE^XLFDT(X1,"1P")
"RTN","LR7OSAP2",44,0)
 .. S ^TMP("LRC",$J,GCNT,0)=LRTEXT
"RTN","LR7OSAP2",45,0)
 .. I $O(^LR(LRDFN,84,I,2,0)) D MODSR
"RTN","LR7OSAP2",46,0)
 .. D WRAP^LR7OSAP1("^LR("_LRDFN_",84,"_I_",1)",79)
"RTN","LR7OSAP2",47,0)
 Q:'$D(^LR(LRDFN,"AW"))&('$D(^("AY")))&('$D(^("AWI")))
"RTN","LR7OSAP2",48,0)
 D WT
"RTN","LR7OSAP2",49,0)
 D LRAPT3
"RTN","LR7OSAP2",50,0)
 ;Removed code that prints SNOMED codes per LR*5.2*259
"RTN","LR7OSAP2",51,0)
 Q
"RTN","LR7OSAP2",52,0)
MODSR ;Modified Autopsy Supplementary Report Audit Info
"RTN","LR7OSAP2",53,0)
 N LRTEXT,LRSP1,LRSP2,LRFILE,LRIENS,LRR1,LRR2
"RTN","LR7OSAP2",54,0)
 S LRFILE=63.3242
"RTN","LR7OSAP2",55,0)
 D LN
"RTN","LR7OSAP2",56,0)
 S LRTEXT="SUPPLEMENTARY REPORT HAS BEEN ADDED/MODIFIED"
"RTN","LR7OSAP2",57,0)
 S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(14,CCNT,"*** "_LRTEXT_" ***")
"RTN","LR7OSAP2",58,0)
 D LN
"RTN","LR7OSAP2",59,0)
 S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,"(Added/Last modified: ")
"RTN","LR7OSAP2",60,0)
 S LRIENS=I_","_LRDFN_","
"RTN","LR7OSAP2",61,0)
 S LRSP1=0
"RTN","LR7OSAP2",62,0)
 F  S LRSP1=$O(^LR(LRDFN,84,I,2,LRSP1)) Q:'LRSP1  D
"RTN","LR7OSAP2",63,0)
 .S LRSP2=LRSP1
"RTN","LR7OSAP2",64,0)
 Q:'$D(^LR(LRDFN,84,I,2,LRSP2,0))
"RTN","LR7OSAP2",65,0)
 S LRS2=^LR(LRDFN,84,I,2,LRSP2,0),Y=+LRS2,LRS2A=$P(LRS2,"^",2),LRSGN=" typed by "
"RTN","LR7OSAP2",66,0)
 ;If supp rpt is released, display 'signed by' instead of 'typed by'
"RTN","LR7OSAP2",67,0)
 I $P(LRS2,"^",3) S Y=$P(LRS2,"^",4),LRS2A=$P(LRS2,"^",3),LRSGN=" signed by "
"RTN","LR7OSAP2",68,0)
 S LRS2A=$S($D(^VA(200,LRS2A,0)):$P(^(0),"^"),1:LRS2A)
"RTN","LR7OSAP2",69,0)
 D D^LRU
"RTN","LR7OSAP2",70,0)
 S LRR1=Y,LRR2=LRS2A
"RTN","LR7OSAP2",71,0)
 S ^(0)=^TMP("LRC",$J,GCNT,0)_LRR1_LRSGN_LRR2_")"
"RTN","LR7OSAP2",72,0)
 ;If RELEASED SUPP REPORT MODIFIED set to 1, display "NOT VERIFIED"
"RTN","LR7OSAP2",73,0)
 I $P(^LR(LRDFN,84,I,0),"^",3) D
"RTN","LR7OSAP2",74,0)
 .D LN
"RTN","LR7OSAP2",75,0)
 .S LRTEXT="NOT VERIFIED"
"RTN","LR7OSAP2",76,0)
 .S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(25,CCNT,"**-* "_LRTEXT_" *-**")
"RTN","LR7OSAP2",77,0)
 Q
"RTN","LR7OSAP2",78,0)
LN ;Increment the counter
"RTN","LR7OSAP2",79,0)
 S GCNT=GCNT+1,CCNT=1
"RTN","LR7OSAP2",80,0)
 Q
"RTN","LR7OSAP2",81,0)
LINE ;Fill in the global with bank lines
"RTN","LR7OSAP2",82,0)
 N X
"RTN","LR7OSAP2",83,0)
 D LN
"RTN","LR7OSAP2",84,0)
 S X="",$P(X," ",GIOM)="",^TMP("LRC",$J,GCNT,0)=X
"RTN","LR7OSAP2",85,0)
 Q
"RTN","LR7OSAP2",86,0)
F(NODE) ;;
"RTN","LR7OSAP2",87,0)
 D WRAP^LR7OSAP1("^LR("_LRDFN_","_NODE_")",79)
"RTN","LR7OSAP2",88,0)
 Q
"RTN","LR7OSAP2",89,0)
D ;
"RTN","LR7OSAP2",90,0)
 N LRB,M,X
"RTN","LR7OSAP2",91,0)
 S LRB=0
"RTN","LR7OSAP2",92,0)
 F  S LRB=$O(^LR(LRDFN,"AY",I,1,LRB)) Q:'LRB  S X=^(LRB,0) D LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(5,CCNT,$P(^LAB(61.4,+X,0),"^"))
"RTN","LR7OSAP2",93,0)
 S LRB=0
"RTN","LR7OSAP2",94,0)
 F  S LRB=$O(^LR(LRDFN,"AY",I,3,LRB)) Q:'LRB  S X=^(LRB,0) D LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(5,CCNT,$P(^LAB(61.3,+X,0),"^"))
"RTN","LR7OSAP2",95,0)
 S LRB=0
"RTN","LR7OSAP2",96,0)
 F  S LRB=$O(^LR(LRDFN,"AY",I,4,LRB)) Q:'LRB  S X=^(LRB,0) D LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(5,CCNT,$P(^LAB(61.5,+X,0),"^"))
"RTN","LR7OSAP2",97,0)
 S M=0
"RTN","LR7OSAP2",98,0)
 F  S M=$O(^LR(LRDFN,"AY",I,2,M)) Q:'M  S X=^(M,0) D LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(5,CCNT,$P(^LAB(61.1,+X,0),"^")) D E
"RTN","LR7OSAP2",99,0)
 Q
"RTN","LR7OSAP2",100,0)
E ;
"RTN","LR7OSAP2",101,0)
 N E
"RTN","LR7OSAP2",102,0)
 S E=0
"RTN","LR7OSAP2",103,0)
 F  S E=$O(^LR(LRDFN,"AY",I,2,M,1,E)) Q:'E  S X=^(E,0) D LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(7,CCNT,$P(^LAB(61.2,+X,0),"^"))
"RTN","LR7OSAP2",104,0)
 Q
"RTN","LR7OSAP2",105,0)
HD ;
"RTN","LR7OSAP2",106,0)
 D LINE
"RTN","LR7OSAP2",107,0)
 D LN
"RTN","LR7OSAP2",108,0)
 S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(XPOS,CCNT,"Organ/tissue:")_$$S^LR7OS(33,CCNT,"SNOMED CODING")
"RTN","LR7OSAP2",109,0)
 Q
"RTN","LR7OSAP2",110,0)
WT ;
"RTN","LR7OSAP2",111,0)
 N B,X,OUT
"RTN","LR7OSAP2",112,0)
 I '$D(^LR(LRDFN,"AW")) D 
"RTN","LR7OSAP2",113,0)
 . D LINE,LN
"RTN","LR7OSAP2",114,0)
 . S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(20,CCNT,"No organ weights entered.")
"RTN","LR7OSAP2",115,0)
 . D LINE
"RTN","LR7OSAP2",116,0)
 I $D(^LR(LRDFN,"AW")) S X=^("AW") D 
"RTN","LR7OSAP2",117,0)
 . S B(9)=$P(X,"^",9),B(1)=$P(X,"^",11,99)
"RTN","LR7OSAP2",118,0)
 . D LINE,LN
"RTN","LR7OSAP2",119,0)
 . S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(XPOS,CCNT,"Rt--Lung--Lt  Liver Spleen  RT--Kidney--Lt  Brain  Body Wt(lb)    Ht(in)")
"RTN","LR7OSAP2",120,0)
 I $D(B) D
"RTN","LR7OSAP2",121,0)
 . D LN
"RTN","LR7OSAP2",122,0)
 . S OUT=$$S^LR7OS(XPOS,CCNT,$J($P(X,"^",3),4))_$$S^LR7OS(9,CCNT,$J($P(X,"^",4),4))_$$S^LR7OS(15,CCNT,$J($P(X,"^",5),5))_$$S^LR7OS(22,CCNT,$J($P(X,"^",6),5))_$$S^LR7OS(29,CCNT,$J($P(X,"^",7),4))_$$S^LR7OS(39,CCNT,$J($P(X,"^",8),4))
"RTN","LR7OSAP2",123,0)
 . S OUT=OUT_$$S^LR7OS(45,CCNT,$J($P(X,"^",10),4))_$$S^LR7OS(55,CCNT,$P(X,"^",2))_$$S^LR7OS(68,CCNT,$P(X,"^"))
"RTN","LR7OSAP2",124,0)
 . S ^TMP("LRC",$J,GCNT,0)=OUT
"RTN","LR7OSAP2",125,0)
 D LINE,LN
"RTN","LR7OSAP2",126,0)
 S ^TMP("LRC",$J,GCNT,0)=""
"RTN","LR7OSAP2",127,0)
 I $D(B) S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(XPOS,CCNT,"Heart(gm)")
"RTN","LR7OSAP2",128,0)
 I $D(^LR(LRDFN,"AV")) S X=^("AV"),B(2)=$P(X,"^",7,99),^(0)=^TMP("LRC",$J,GCNT,0)_$$S^LR7OS(12,CCNT,"TV(cm)  PV(cm)  MV(cm)  AV(cm)  RV(cm)  LV(cm)")
"RTN","LR7OSAP2",129,0)
 D LN
"RTN","LR7OSAP2",130,0)
 S ^TMP("LRC",$J,GCNT,0)=""
"RTN","LR7OSAP2",131,0)
 I $D(B(9)) S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(XPOS,CCNT,$J(B(9),5))
"RTN","LR7OSAP2",132,0)
 I $D(B(2)) D
"RTN","LR7OSAP2",133,0)
 . S OUT=$$S^LR7OS(12,CCNT,$J($P(X,"^"),4))_$$S^LR7OS(20,CCNT,$J($P(X,"^",2),4))_$$S^LR7OS(28,CCNT,$J($P(X,"^",3),4))_$$S^LR7OS(36,CCNT,$J($P(X,"^",4),4))_$$S^LR7OS(44,CCNT,$J($P(X,"^",5),4))_$$S^LR7OS(52,CCNT,$J($P(X,"^",6),4))
"RTN","LR7OSAP2",134,0)
 . S ^(0)=^TMP("LRC",$J,GCNT,0)_OUT
"RTN","LR7OSAP2",135,0)
 . D LINE,LN
"RTN","LR7OSAP2",136,0)
 . S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(XPOS,CCNT,"Cavities(ml): Rt--Pleural--Lt  Pericardial  Peritoneal")
"RTN","LR7OSAP2",137,0)
 . D LN
"RTN","LR7OSAP2",138,0)
 . S OUT=$$S^LR7OS(14,CCNT,$J($P(B(2),"^",2),4))_$$S^LR7OS(25,CCNT,$J($P(B(2),"^"),4))_$$S^LR7OS(33,CCNT,$J($P(B(2),"^",3),4))_$$S^LR7OS(45,CCNT,$J($P(B(2),"^",4),4))
"RTN","LR7OSAP2",139,0)
 . S ^TMP("LRC",$J,GCNT,0)=OUT
"RTN","LR7OSAP2",140,0)
 I $D(B(1)) F B=1:1:8 D 
"RTN","LR7OSAP2",141,0)
 . I $P(B(1),"^",B) D 
"RTN","LR7OSAP2",142,0)
 .. S X="25."_B
"RTN","LR7OSAP2",143,0)
 .. D LN
"RTN","LR7OSAP2",144,0)
 .. S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(XPOS,CCNT,$P(^DD(63,X,0),"^")_": "_$P(B(1),"^",B))
"RTN","LR7OSAP2",145,0)
 I $D(^LR(LRDFN,"AWI")) S Y=^("AWI") F B=1:1:5 I $P(Y,"^",B) D LN S X=$S(B=1:25.9,1:25.9_(B-1)),^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(XPOS,CCNT,$P(^DD(63,X,0),"^")_": "_$P(Y,"^",B))
"RTN","LR7OSAP2",146,0)
 Q
"RTN","LR7OSAP2",147,0)
ZZ ;;
"RTN","LR7OSAP2",148,0)
 D LN
"RTN","LR7OSAP2",149,0)
 N OUT,X,LRLLOC,DA,A,B,C,LR,Y
"RTN","LR7OSAP2",150,0)
 S:$G(PNM)="" PNM=$P(^DPT(DFN,0),U) ;DBIA #10035
"RTN","LR7OSAP2",151,0)
 S OUT=$$S^LR7OS(XPOS,CCNT,"Acc #")_$$S^LR7OS(9,CCNT,"Date/time Died")_$$S^LR7OS(27,CCNT,"Age")_$$S^LR7OS(33,CCNT,"AUTOPSY DATA")_$$S^LR7OS(53,CCNT,"Date/time of Autopsy"),^TMP("LRC",$J,GCNT,0)=OUT
"RTN","LR7OSAP2",152,0)
 S X=^LR(LRDFN,"AU"),LRLLOC=$P(X,"^",8),DA=LRDFN
"RTN","LR7OSAP2",153,0)
 D D^LRAUAW
"RTN","LR7OSAP2",154,0)
 S Y=LR(63,12)
"RTN","LR7OSAP2",155,0)
 D D^LRU,LN
"RTN","LR7OSAP2",156,0)
 S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(XPOS,CCNT,($P(X,"^",6)_" "_Y))_$$S^LR7OS(26,CCNT,$J($P(X,"^",9),3))_$$S^LR7OS(33,CCNT,$G(PNM))
"RTN","LR7OSAP2",157,0)
 S Y=+X
"RTN","LR7OSAP2",158,0)
 D D^LRU
"RTN","LR7OSAP2",159,0)
 I Y'[1700 S ^(0)=^TMP("LRC",$J,GCNT,0)_$$S^LR7OS(53,CCNT,Y)
"RTN","LR7OSAP2",160,0)
 D LN
"RTN","LR7OSAP2",161,0)
 S ^TMP("LRC",$J,GCNT,0)=""
"RTN","LR7OSAP2",162,0)
 F X(1)=7,10 D
"RTN","LR7OSAP2",163,0)
 . S Y=$P(X,"^",X(1)),Y=$S(Y="":Y,$D(^VA(200,Y,0)):$P(^(0),"^"),1:Y)
"RTN","LR7OSAP2",164,0)
 . I Y]"" S ^TMP("LRC",$J,GCNT,0)=^TMP("LRC",$J,GCNT,0)_$S(X(1)=7:$$S^LR7OS(1,CCNT,"Resident: ")_Y,1:$$S^LR7OS(38,CCNT,"Senior: ")_Y)
"RTN","LR7OSAP2",165,0)
 Q
"RTN","LR7OSAP2",166,0)
LRAPT3 ;COPIED FROM ^LRAPT3
"RTN","LR7OSAP2",167,0)
 ;;
"RTN","LR7OSAP2",168,0)
 N A,C,X,T,F
"RTN","LR7OSAP2",169,0)
 S (F,A)=0
"RTN","LR7OSAP2",170,0)
 F  S A=$O(^LR(LRDFN,"AY",A)) Q:'A  D
"RTN","LR7OSAP2",171,0)
 .I $D(^LR(LRDFN,"AY",A,0)) S T=+^(0) D
"RTN","LR7OSAP2",172,0)
 ..S T(1)=$P($G(^LAB(61,T,0)),"^")
"RTN","LR7OSAP2",173,0)
 ..S C=0 F  S C=$O(^LR(LRDFN,"AY",A,5,C)) Q:'C  D
"RTN","LR7OSAP2",174,0)
 ...S X=^LR(LRDFN,"AY",A,5,C,0) D SP(X) S F=1
"RTN","LR7OSAP2",175,0)
 ;Removed code that prints ICD codes per LR*5.2*259
"RTN","LR7OSAP2",176,0)
 Q
"RTN","LR7OSAP2",177,0)
SP(NODE) ;
"RTN","LR7OSAP2",178,0)
 N Y,E,X,A1,B
"RTN","LR7OSAP2",179,0)
 S Y=$P(NODE,"^",2),E=$P(NODE,"^",3),X=$P(NODE,"^")_":",A1=$P($P(LRAU("S"),X,2),";",1)
"RTN","LR7OSAP2",180,0)
 D D^LRU
"RTN","LR7OSAP2",181,0)
 S T(2)=Y
"RTN","LR7OSAP2",182,0)
 I 'F D LINE,LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,T(1))
"RTN","LR7OSAP2",183,0)
 D LN S ^TMP("LRC",$J,GCNT,0)=$$S^LR7OS(1,CCNT,A1_" "_E_" Date: "_T(2))
"RTN","LR7OSAP2",184,0)
 D WRAP^LR7OSAP1("^LR("_LRDFN_",""AY"","_A_",5,"_C_",1)",80)
"RTN","LR7OSAP2",185,0)
 Q
"RTN","LR7OSAP2",186,0)
OUT ;Show output
"RTN","LR7OSAP2",187,0)
 Q:'$D(^TMP("LRC",$J))
"RTN","LR7OSAP2",188,0)
 N I
"RTN","LR7OSAP2",189,0)
 S I=0
"RTN","LR7OSAP2",190,0)
 F  S I=$O(^TMP("LRC",$J,I)) Q:'I  W !,^(I,0)
"RTN","LR7OSAP2",191,0)
 Q
"RTN","LR7OSAP4")
0^2^B2801060^n/a
"RTN","LR7OSAP4",1,0)
LR7OSAP4 ;slc/dcm - Silent AP API ;3/22/2007
"RTN","LR7OSAP4",2,0)
 ;;5.2;LAB SERVICE;**365**;Sep 27, 1994;Build 9
"RTN","LR7OSAP4",3,0)
 ;
"RTN","LR7OSAP4",4,0)
EN(LRX,LRDFN,LRSS,LRI,GIOM)        ;Get Anatomic Path results from either TIU or Lab files
"RTN","LR7OSAP4",5,0)
 ; LRX is the global where the output is placed. Calling package is responsible for cleaning this up
"RTN","LR7OSAP4",6,0)
 ; LRDFN = Lab Patient ID
"RTN","LR7OSAP4",7,0)
 ; LRSS = Lab Subscript
"RTN","LR7OSAP4",8,0)
 ; LRI = Inverse Date/Time from ^LR(LRDFN,LRSS,LRIDT)
"RTN","LR7OSAP4",9,0)
 Q:'LRDFN  Q:$G(LRSS)=""  Q:'LRI  Q:'$D(^LR(+LRDFN,LRSS,LRI))&(LRSS'="AU")
"RTN","LR7OSAP4",10,0)
 N LRAA,FST,GCNT,B
"RTN","LR7OSAP4",11,0)
 K ^TMP("LRC",$J)
"RTN","LR7OSAP4",12,0)
 D:LRSS="CY" CY D:LRSS="SP" SPA D:LRSS="EM" EM
"RTN","LR7OSAP4",13,0)
 S FST=0,GCNT=0,GIOM=$G(GIOM,96),B=$G(^LR(LRDFN,LRSS,LRI,0))
"RTN","LR7OSAP4",14,0)
 D:LRSS="AU" AU
"RTN","LR7OSAP4",15,0)
 I LRSS'="AU" D W^LR7OSAP
"RTN","LR7OSAP4",16,0)
 M @LRX=^TMP("LRC",$J)
"RTN","LR7OSAP4",17,0)
 Q
"RTN","LR7OSAP4",18,0)
 ;
"RTN","LR7OSAP4",19,0)
CY S LRSS="CY",LRAA(1)="CYTOPATHOLOGY",LRAA=+$O(^LRO(68,"B",LRAA(1),0)) S:'LRAA LRAA=$$FIND(LRSS)
"RTN","LR7OSAP4",20,0)
 Q
"RTN","LR7OSAP4",21,0)
 ;
"RTN","LR7OSAP4",22,0)
SPA S LRSS="SP",LRAA(1)="SURGICAL PATHOLOGY",LRAA=+$O(^LRO(68,"B",LRAA(1),0)) S:'LRAA LRAA=$$FIND(LRSS)
"RTN","LR7OSAP4",23,0)
 Q
"RTN","LR7OSAP4",24,0)
 ;
"RTN","LR7OSAP4",25,0)
EM S LRSS="EM",LRAA(1)="ELECTRON MICROSCOPY",LRAA=+$O(^LRO(68,"B","EM",0)) S:'LRAA LRAA=$$FIND(LRSS)
"RTN","LR7OSAP4",26,0)
 Q
"RTN","LR7OSAP4",27,0)
 ;
"RTN","LR7OSAP4",28,0)
AU D EN^LR7OSAP2(LRDFN)
"RTN","LR7OSAP4",29,0)
 Q
"RTN","LR7OSAP4",30,0)
 ;
"RTN","LR7OSAP4",31,0)
FIND(SS) ;Find a valid entry in 68
"RTN","LR7OSAP4",32,0)
 ;SS=LRSS value to look for
"RTN","LR7OSAP4",33,0)
 N I,Y
"RTN","LR7OSAP4",34,0)
 S I=0,Y="" F  S I=$O(^LRO(68,I)) Q:I<1  I $P($G(^LRO(68,I,0)),"^",2)=SS S Y=I Q
"RTN","LR7OSAP4",35,0)
 Q Y
"RTN","LRAPALRT")
0^7^B3310137^n/a
"RTN","LRAPALRT",1,0)
LRAPALRT ;DALOI/CKA - SEND AN AP ALERT AFTER THE REPORT HAS BEEN RELEASED;2/26/08
"RTN","LRAPALRT",2,0)
 ;;5.2;LAB SERVICE;**365**;Sep 27, 1994;Build 9
"RTN","LRAPALRT",3,0)
 ; 
"RTN","LRAPALRT",4,0)
 ;
"RTN","LRAPALRT",5,0)
 N LRMSG,LREND,LRQUIT,LRIENS,LRSF,LRZ
"RTN","LRAPALRT",6,0)
 S LRQUIT=0
"RTN","LRAPALRT",7,0)
 D SECTION^LRAPRES
"RTN","LRAPALRT",8,0)
 I LRQUIT D END Q
"RTN","LRAPALRT",9,0)
 D ACCYR^LRAPRES
"RTN","LRAPALRT",10,0)
 I LRQUIT D END Q
"RTN","LRAPALRT",11,0)
 D LOOKUP^LRAPUTL(.LRDATA,LRH(0),LRO(68),LRSS,LRAD,LRAA)
"RTN","LRAPALRT",12,0)
 I LRDATA<1 S LRQUIT=1
"RTN","LRAPALRT",13,0)
 I LRQUIT D END Q
"RTN","LRAPALRT",14,0)
 I 'LRAU D
"RTN","LRAPALRT",15,0)
 .S LRDFN=LRDATA,LRI=LRDATA(1)
"RTN","LRAPALRT",16,0)
 .S LRA=^LR(LRDFN,LRSS,LRI,0)
"RTN","LRAPALRT",17,0)
 .S LRIENS=LRI_","_LRDFN_","
"RTN","LRAPALRT",18,0)
 .S LRZ(2)=$$GET1^DIQ(LRSF,LRIENS,.11,"I")
"RTN","LRAPALRT",19,0)
 .S LRAC=$$GET1^DIQ(LRSF,LRIENS,.06,"I")
"RTN","LRAPALRT",20,0)
 .D:'LRZ(2)
"RTN","LRAPALRT",21,0)
 ..W $C(7)
"RTN","LRAPALRT",22,0)
 ..S LRMSG="Report has not been released.  An alert cannot be sent."
"RTN","LRAPALRT",23,0)
 ..D EN^DDIOL(LRMSG,"","!!") K LRMSG
"RTN","LRAPALRT",24,0)
 ..S LRQUIT=1 Q
"RTN","LRAPALRT",25,0)
 I LRQUIT D END Q
"RTN","LRAPALRT",26,0)
 I LRAU D
"RTN","LRAPALRT",27,0)
 .S LRDFN=LRDATA
"RTN","LRAPALRT",28,0)
 .I $G(^LR(LRDFN,"AU"))="" D  Q
"RTN","LRAPALRT",29,0)
 ..S LRMSG="No information found for this accession in the "
"RTN","LRAPALRT",30,0)
 ..S LRMSG=LRMSG_"LAB DATA file (#63)."
"RTN","LRAPALRT",31,0)
 ..D EN^DDIOL(LRMSG,"","!!") K LRMSG
"RTN","LRAPALRT",32,0)
 ..S LRQUIT=1 Q
"RTN","LRAPALRT",33,0)
 .S LRZ=$$GET1^DIQ(63,LRDFN_",",14.7,"I")
"RTN","LRAPALRT",34,0)
 .D:'LRZ
"RTN","LRAPALRT",35,0)
 ..W $C(7)
"RTN","LRAPALRT",36,0)
 ..S LRMSG="Report has not been released.  An alert cannot be sent."
"RTN","LRAPALRT",37,0)
 ..D EN^DDIOL(LRMSG,"","!!") K LRMSG
"RTN","LRAPALRT",38,0)
 ..S LRQUIT=1 Q
"RTN","LRAPALRT",39,0)
 .S LRA=^LR(LRDFN,"AU")
"RTN","LRAPALRT",40,0)
 .S LRI=$P(LRA,U)
"RTN","LRAPALRT",41,0)
 .S LRAC=$$GET1^DIQ(63,LRDFN_",",14,"I")
"RTN","LRAPALRT",42,0)
 I LRQUIT D END Q
"RTN","LRAPALRT",43,0)
 D MAIN^LRAPRES1(LRDFN,LRSS,LRI,LRSF,LRP,LRAC)
"RTN","LRAPALRT",44,0)
END D END^LRAPRES
"RTN","LRAPALRT",45,0)
 Q
"RTN","LRAPDA")
0^3^B81540087^B76606340
"RTN","LRAPDA",1,0)
LRAPDA ;DALOI/REG/WTY/KLL/CKA - ANATOMIC PATH DATA ENTRY;11/02/01
"RTN","LRAPDA",2,0)
 ;;5.2;LAB SERVICE;**72,73,91,121,248,259,295,317,365**;Sep 27, 1994;Build 9
"RTN","LRAPDA",3,0)
 ;
"RTN","LRAPDA",4,0)
 ;Reference to ^%DT supported by IA #10003
"RTN","LRAPDA",5,0)
 ;Reference to ^DIE supported by IA #10018
"RTN","LRAPDA",6,0)
 ;Reference to ^VA(200 supported by IA #10060
"RTN","LRAPDA",7,0)
 ;Reference to EN^DDIOL supported by IA #10142
"RTN","LRAPDA",8,0)
 ;
"RTN","LRAPDA",9,0)
 W !?20,LRO(68)," (",LRABV,")",!
"RTN","LRAPDA",10,0)
 S:'$D(LRSOP) LRSOP=1 S:'$D(LRD(1)) LRD(1)="0"
"RTN","LRAPDA",11,0)
 S:'$D(^LRO(69.2,LRAA,2,0)) ^(0)="^69.23A^0^0"
"RTN","LRAPDA",12,0)
SEL K LR(1)
"RTN","LRAPDA",13,0)
 I $D(LR(2)) D  G:%<1 END S:%=1 LR(1)=1
"RTN","LRAPDA",14,0)
 .W !!,"Enter Etiology, Function, Procedure & Disease "
"RTN","LRAPDA",15,0)
 .S %=2 D YN^LRU
"RTN","LRAPDA",16,0)
AK ;from LRAPD1
"RTN","LRAPDA",17,0)
 N CORRECT
"RTN","LRAPDA",18,0)
 S:'$D(LRSFLG) LRSFLG=""
"RTN","LRAPDA",19,0)
 W !!,"Data entry for ",LRH(0)," "
"RTN","LRAPDA",20,0)
 S %=1 D YN^LRU G:%<1 END
"RTN","LRAPDA",21,0)
 I %=2 D  G:Y<1 END S LRAD=$E(Y,1,3)_"0000",LRH(0)=$E(Y,1,3)+1700
"RTN","LRAPDA",22,0)
 .S %DT="AE",%DT(0)="-N",%DT("A")="Enter YEAR: " D ^%DT K %DT
"RTN","LRAPDA",23,0)
 I '$O(^LRO(68,LRAA,1,LRAD,1,0)) D  Q
"RTN","LRAPDA",24,0)
 .W $C(7),!!,"NO ",LRO(68)," ACCESSIONS IN FILE FOR ",LRH(0),!!
"RTN","LRAPDA",25,0)
W K X,Y,LR("CK")
"RTN","LRAPDA",26,0)
 R !!,"Select Accession Number/Pt name: ",LRAN:DTIME
"RTN","LRAPDA",27,0)
 G:LRAN=""!(LRAN[U) END
"RTN","LRAPDA",28,0)
 I LRAN["?" D  G W
"RTN","LRAPDA",29,0)
 .W !!,"Enter the year ",LRH(0)," ",LRO(68)," accession number to be "
"RTN","LRAPDA",30,0)
 .W "updated"
"RTN","LRAPDA",31,0)
 .W !,"or locate the accession by entering the patient name."
"RTN","LRAPDA",32,0)
 I LRAN'?1N.N D PNAME G:LRAN<1 W D OE1^LR7OB63D,REST,OERR^LR7OB63D G W
"RTN","LRAPDA",33,0)
 D OE1^LR7OB63D,REST S:$D(DR(1))#2 DR=DR(1) D OERR^LR7OB63D G W
"RTN","LRAPDA",34,0)
REST ;
"RTN","LRAPDA",35,0)
 N LRXSTOP,LRX,LRX1
"RTN","LRAPDA",36,0)
 W "  for ",LRH(0)
"RTN","LRAPDA",37,0)
 I '$D(^LRO(68,LRAA,1,LRAD,1,LRAN,0)) D  Q
"RTN","LRAPDA",38,0)
 .W $C(7),!!,"Accession # ",LRAN," for ",LRH(0)," not in ",LRO(68),!!
"RTN","LRAPDA",39,0)
 S X=^LRO(68,LRAA,1,LRAD,1,LRAN,0),LRLLOC=$P(X,"^",7),LRDFN=+X
"RTN","LRAPDA",40,0)
 Q:'$D(^LR(LRDFN,0))  S X=^(0) D ^LRUP
"RTN","LRAPDA",41,0)
 W !,LRP,"  ID: ",SSN
"RTN","LRAPDA",42,0)
 S LRI=+$P($G(^LRO(68,LRAA,1,LRAD,1,LRAN,3)),"^",5)
"RTN","LRAPDA",43,0)
 I LRSS'="AU",'$D(^LR(LRDFN,LRSS,LRI,0)) D  Q
"RTN","LRAPDA",44,0)
 .W $C(7),!,"Inverse date missing or incorrect in Accession Area file "
"RTN","LRAPDA",45,0)
 .W "for",!,LRO(68),"  Year: ",$E(LRAD,2,3),"  Accession: ",LRAN
"RTN","LRAPDA",46,0)
 I "SPCYEM"[LRSS,$O(^LR(LRDFN,LRSS,LRI,.1,0)) D
"RTN","LRAPDA",47,0)
 .W !,"Specimen(s):"
"RTN","LRAPDA",48,0)
 .S X=0 F  S X=$O(^LR(LRDFN,LRSS,LRI,.1,X)) Q:'X  D
"RTN","LRAPDA",49,0)
 ..W !,$P($G(^LR(LRDFN,LRSS,LRI,.1,X,0)),"^")
"RTN","LRAPDA",50,0)
 ;
"RTN","LRAPDA",51,0)
 ;Don't allow supp. report to be added to a released report if 
"RTN","LRAPDA",52,0)
 ; modifications are being added via MM option
"RTN","LRAPDA",53,0)
 S LRXSTOP=0,(LRX,LRX1)=""
"RTN","LRAPDA",54,0)
 I LRSS'="AU",LRD(1)="S" D
"RTN","LRAPDA",55,0)
 .S LRX=$P($G(^LR(LRDFN,LRSS,LRI,0)),"^",11) ;release date/time
"RTN","LRAPDA",56,0)
 .S LRX1=$P($G(^LR(LRDFN,LRSS,LRI,0)),"^",15) ;orig rel date/time
"RTN","LRAPDA",57,0)
 I LRSS="AU",LRSOP="R" D
"RTN","LRAPDA",58,0)
 .S LRX=$P($G(^LR(LRDFN,"AU")),"^",15)  ;release date/time
"RTN","LRAPDA",59,0)
 .S LRX1=$P($G(^LR(LRDFN,"AU")),"^",3)  ;date report completed
"RTN","LRAPDA",60,0)
 I 'LRX,LRX1 D
"RTN","LRAPDA",61,0)
 .W $C(7),!!,"This "_$G(LRAA(1))_" report is currently being"
"RTN","LRAPDA",62,0)
 .W !,"modified; it must first be released before Supplementary"
"RTN","LRAPDA",63,0)
 .W !,"report can be added.",!
"RTN","LRAPDA",64,0)
 .S LRXSTOP=1
"RTN","LRAPDA",65,0)
 Q:LRXSTOP 
"RTN","LRAPDA",66,0)
 ;
"RTN","LRAPDA",67,0)
DIE ;Edit
"RTN","LRAPDA",68,0)
 I LRSS="AU" D AUE Q
"RTN","LRAPDA",69,0)
 N LRRDT1,LRRDT2,LRIENS,LREL,LRQUIT,LRSNO,LRCPT,LRESCPT
"RTN","LRAPDA",70,0)
 S (LREL,LRESCPT,LRQUIT,LRSNO,LRCPT)=0,LRIENS=LRI_","_LRDFN_","
"RTN","LRAPDA",71,0)
 S LRRDT1=$$GET1^DIQ(LRSF,LRIENS,.11,"I")
"RTN","LRAPDA",72,0)
 S LRRDT2=$$GET1^DIQ(LRSF,LRIENS,.15,"I")
"RTN","LRAPDA",73,0)
 S:LRRDT1!LRRDT2 LREL=1
"RTN","LRAPDA",74,0)
 ;Determine if CPT activated
"RTN","LRAPDA",75,0)
 I $T(ES^LRCAPES)'="" S LRESCPT=$$ES^LRCAPES()
"RTN","LRAPDA",76,0)
 I LRSOP="G",LREL D  Q
"RTN","LRAPDA",77,0)
 .W $C(7),!!,"Report verified.  Cannot edit with this option."
"RTN","LRAPDA",78,0)
 I LRSOP'="","ABM"[LRSOP,LREL D  Q:LRQUIT
"RTN","LRAPDA",79,0)
 .;Allow SNOMED and CPT coding even after release.
"RTN","LRAPDA",80,0)
 .W $C(7),!!,"Report has been verified.  "
"RTN","LRAPDA",81,0)
 .I 'LRESCPT,LRSOP'="B" D  Q
"RTN","LRAPDA",82,0)
 ..W "Cannot edit with this option."
"RTN","LRAPDA",83,0)
 ..S LRQUIT=1
"RTN","LRAPDA",84,0)
 .W "Only "
"RTN","LRAPDA",85,0)
 .I LRESCPT W "CPT " W:LRSOP="B" "and "
"RTN","LRAPDA",86,0)
 .W:LRSOP="B" "SNOMED "
"RTN","LRAPDA",87,0)
 .W "coding permitted.",!
"RTN","LRAPDA",88,0)
 .I LRSOP="B" D
"RTN","LRAPDA",89,0)
 ..K DIR S DIR(0)="Y",DIR("A")="Enter SNOMED coding",DIR("B")="NO"
"RTN","LRAPDA",90,0)
 ..D ^DIR W !
"RTN","LRAPDA",91,0)
 ..S LRSNO=+Y
"RTN","LRAPDA",92,0)
 .Q:'LRESCPT
"RTN","LRAPDA",93,0)
 .K DIR S DIR(0)="Y",DIR("A")="Enter CPT coding",DIR("B")="NO"
"RTN","LRAPDA",94,0)
 .D ^DIR W !
"RTN","LRAPDA",95,0)
 .S LRCPT=+Y
"RTN","LRAPDA",96,0)
 .I "AM"[LRSOP,'LRCPT S LRQUIT=1 Q
"RTN","LRAPDA",97,0)
 .I LRSOP="B",'LRCPT,'LRSNO S LRQUIT=1
"RTN","LRAPDA",98,0)
RESET ;Reset DR string if altered by prior accession/patient
"RTN","LRAPDA",99,0)
 ;Reset DR to orig value in LRAPD1
"RTN","LRAPDA",100,0)
 I LRSOP'="","AMBS"[LRSOP,$G(LRD)'="" D @LRD
"RTN","LRAPDA",101,0)
 I LRSFLG="S",$G(LRD)'="" D @LRD  ;For CY,EM Supp entry
"RTN","LRAPDA",102,0)
 S:LRSNO DR=10    ;Modify DR string if only SNOMED coding permitted
"RTN","LRAPDA",103,0)
 I 'LRSNO,LRCPT S DR=""  ;Set DR string to null in only CPT coding
"RTN","LRAPDA",104,0)
 ;If adding supp rpt to released rpt, remove date rpt completed from DR
"RTN","LRAPDA",105,0)
 I LRRDT1,LRSOP="S"!(LRSFLG="S") S DR=".09///^S X=LRWHO;10"
"RTN","LRAPDA",106,0)
EDIT ;Call to ^DIE
"RTN","LRAPDA",107,0)
 W ! S LRA=^LR(LRDFN,LRSS,LRI,0),LRRC=$P(LRA,"^",10)
"RTN","LRAPDA",108,0)
 I LRCAPA,"SPCYEM"[LRSS D C^LRAPSWK
"RTN","LRAPDA",109,0)
 S DIE="^LR(LRDFN,LRSS,",DA=LRI,DA(1)=LRDFN
"RTN","LRAPDA",110,0)
 D CK^LRU Q:$D(LR("CK"))
"RTN","LRAPDA",111,0)
 I LRSS="SP",LRSOP="B",$O(^LR(LRDFN,LRSS,LRI,1.3,0)) D
"RTN","LRAPDA",112,0)
 .W $C(7),!!,"This accession has a FROZEN SECTION report."
"RTN","LRAPDA",113,0)
 .W !,"Be sure 'FROZEN SECTION' is entered as a SNOMED code in the "
"RTN","LRAPDA",114,0)
 .W "PROCEDURE field"
"RTN","LRAPDA",115,0)
 .W !,"for the appropriate organ or tissue.",!!
"RTN","LRAPDA",116,0)
 ;Code S LRELSD is in DR string setup in LRAPR
"RTN","LRAPDA",117,0)
 N LRELSD S LRELSD=0
"RTN","LRAPDA",118,0)
 D ^DIE
"RTN","LRAPDA",119,0)
 S LRAC=$P(LRA,U,6)
"RTN","LRAPDA",120,0)
 I LRELSD D MAIN^LRAPRES1(LRDFN,LRSS,LRI,LRSF,LRP,LRAC)
"RTN","LRAPDA",121,0)
 D UPDATE^LRPXRM(LRDFN,LRSS,LRI)
"RTN","LRAPDA",122,0)
 D:LRSFLG="S"&('$D(Y)) ^LRAPDSR
"RTN","LRAPDA",123,0)
 D FRE^LRU
"RTN","LRAPDA",124,0)
 I LRSOP'="","ABM"[LRSOP D CPTCOD
"RTN","LRAPDA",125,0)
WKLD ;Capture Workload
"RTN","LRAPDA",126,0)
 I LRSOP="Z","CYSP"[LRSS,LRCAPA D S^LRAPR Q
"RTN","LRAPDA",127,0)
 I LRCAPA,"SPCYEM"[LRSS,LRD(1)'="","MBA"[LRD(1) D C1^LRAPSWK
"RTN","LRAPDA",128,0)
 I LRCAPA,"SPCYEM"[LRSS,LRSOP="G" D C1^LRAPSWK
"RTN","LRAPDA",129,0)
QUEUES ;Update Queues
"RTN","LRAPDA",130,0)
 S X=$P(^LR(LRDFN,LRSS,LRI,0),"^",4)
"RTN","LRAPDA",131,0)
 I X,$D(^VA(200,X,0)) S LR("TR")=$P(^(0),"^")
"RTN","LRAPDA",132,0)
 I "CYEMSP"[LRSS,$D(LR(6)),LRSOP="G" Q:$D(^LRO(69.2,LRAA,1,LRAN,0))  D  Q
"RTN","LRAPDA",133,0)
 .L +^LRO(69.2,LRAA,1):5 I '$T D  Q
"RTN","LRAPDA",134,0)
 ..S MSG(1)="The preliminary reports queue is in use by another person."
"RTN","LRAPDA",135,0)
 ..S MSG(1,"F")="!!"
"RTN","LRAPDA",136,0)
 ..S MSG(2)="  You will need to add this accession to the queue later."
"RTN","LRAPDA",137,0)
 ..D EN^DDIOL(.MSG) K MSG
"RTN","LRAPDA",138,0)
 .S ^LRO(69.2,LRAA,1,LRAN,0)=LRDFN_"^"_LRI_"^"_LRH(0)
"RTN","LRAPDA",139,0)
 .S X=^LRO(69.2,LRAA,1,0),^(0)=$P(X,"^",1,2)_"^"_LRAN_"^"_($P(X,"^",4)+1)
"RTN","LRAPDA",140,0)
 .L -^LRO(69.2,LRAA,1)
"RTN","LRAPDA",141,0)
 I "CYEMSP"[LRSS,$D(LR(7)),'$D(^LRO(69.2,LRAA,2,LRAN,0)),LRD(1)'="S" D
"RTN","LRAPDA",142,0)
 .L +^LRO(69.2,LRAA,2):5 I '$T D  Q
"RTN","LRAPDA",143,0)
 ..S MSG(1)="The final reports queue is in use by another person.  "
"RTN","LRAPDA",144,0)
 ..S MSG(1,"F")="!!"
"RTN","LRAPDA",145,0)
 ..S MSG(2)="You will need to add this accession to the queue later."
"RTN","LRAPDA",146,0)
 ..D EN^DDIOL(.MSG) K MSG
"RTN","LRAPDA",147,0)
 .S ^LRO(69.2,LRAA,2,LRAN,0)=LRDFN_"^"_LRI_"^"_LRH(0)
"RTN","LRAPDA",148,0)
 .S X=^LRO(69.2,LRAA,2,0),^(0)=$P(X,"^",1,2)_"^"_LRAN_"^"_($P(X,"^",4)+1)
"RTN","LRAPDA",149,0)
 .L -^LRO(69.2,LRAA,2)
"RTN","LRAPDA",150,0)
 D:LRSOP="M"!(LRSOP="B") EN^LRSPGD
"RTN","LRAPDA",151,0)
 Q
"RTN","LRAPDA",152,0)
NM ;
"RTN","LRAPDA",153,0)
 I X'["@"!(X["@"&(Y(Z)="")) D  Q
"RTN","LRAPDA",154,0)
 .W $C(7),!?4,"ENTER WHOLE NUMBERS ONLY",! K X
"RTN","LRAPDA",155,0)
 I Y(Z)'="" W $C(7),?40,"OK TO DELETE" S %=2 D YN^LRU I %'=1 K X Q
"RTN","LRAPDA",156,0)
 S Y(Z)="" Q
"RTN","LRAPDA",157,0)
 ;
"RTN","LRAPDA",158,0)
AUE ;Autopsy Data Entry
"RTN","LRAPDA",159,0)
 W !
"RTN","LRAPDA",160,0)
 N LREL,LRQUIT,LRSNO,LRESCPT,LRCPT
"RTN","LRAPDA",161,0)
 S (LREL,LRQUIT,LRSNO,LRCPT)=0
"RTN","LRAPDA",162,0)
 S LREL=+$$GET1^DIQ(63,LRDFN_",",14.7,"I")
"RTN","LRAPDA",163,0)
 ;Determine if CPT activated
"RTN","LRAPDA",164,0)
 I $T(ES^LRCAPES)'="" S LRESCPT=$$ES^LRCAPES()
"RTN","LRAPDA",165,0)
 ;  Allow supp report to be added on verified AU
"RTN","LRAPDA",166,0)
 I LRSOP'="","AFIP"[LRSOP,LREL D  Q:LRQUIT
"RTN","LRAPDA",167,0)
 .Q:LRESCPT&("AP"[LRSOP)
"RTN","LRAPDA",168,0)
 .W $C(7),!!,"Report verified.  Cannot edit with this option!"
"RTN","LRAPDA",169,0)
 .S LRQUIT=1
"RTN","LRAPDA",170,0)
 I LRSOP'="","ABP"[LRSOP,LREL D  Q:LRQUIT
"RTN","LRAPDA",171,0)
 .W $C(7),!!,"Report has been verified.  "
"RTN","LRAPDA",172,0)
 .W "Only "
"RTN","LRAPDA",173,0)
 .I LRESCPT W "CPT " W:LRSOP="B" "and "
"RTN","LRAPDA",174,0)
 .W:LRSOP="B" "SNOMED "
"RTN","LRAPDA",175,0)
 .W "coding permitted.",!
"RTN","LRAPDA",176,0)
 .I LRSOP="B" D
"RTN","LRAPDA",177,0)
 ..K DIR S DIR(0)="Y",DIR("A")="Enter SNOMED coding",DIR("B")="NO"
"RTN","LRAPDA",178,0)
 ..D ^DIR W !
"RTN","LRAPDA",179,0)
 ..S LRSNO=+Y
"RTN","LRAPDA",180,0)
 .Q:'LRESCPT
"RTN","LRAPDA",181,0)
 .K DIR S DIR(0)="Y",DIR("A")="Enter CPT coding",DIR("B")="NO"
"RTN","LRAPDA",182,0)
 .D ^DIR W !
"RTN","LRAPDA",183,0)
 .S LRCPT=+Y
"RTN","LRAPDA",184,0)
 .I "AP"[LRSOP,'LRCPT S LRQUIT=1 Q
"RTN","LRAPDA",185,0)
 .I LRSOP="B",'LRCPT,'LRSNO S LRQUIT=1
"RTN","LRAPDA",186,0)
AURESET ;Reset DR to orig value in LRAUDA
"RTN","LRAPDA",187,0)
 I LRSOP'="","AP"[LRSOP D @(LRSOP_"DR^LRAUDA")
"RTN","LRAPDA",188,0)
 I LRSOP="B" D BDR^LRAUDA
"RTN","LRAPDA",189,0)
 S:LRSNO DR=32       ;Modify DR string if only SNOMED coding permitted
"RTN","LRAPDA",190,0)
 I 'LRSNO,LRCPT S DR=""  ;Set DR string to null inf only CPT coding
"RTN","LRAPDA",191,0)
 ;                              ;
"RTN","LRAPDA",192,0)
 ;Not all of the autopsy fields are within the AU subscript.
"RTN","LRAPDA",193,0)
 ;Therefore, we must lock the entire LRDFN.
"RTN","LRAPDA",194,0)
 L +^LR(LRDFN):5 I '$T D  Q
"RTN","LRAPDA",195,0)
 .S MSG="This record is locked by another user.  "
"RTN","LRAPDA",196,0)
 .S MSG=MSG_"Please wait and try again."
"RTN","LRAPDA",197,0)
 .D EN^DDIOL(MSG,"","!!") K MSG
"RTN","LRAPDA",198,0)
 I LRSFLG'="S" D
"RTN","LRAPDA",199,0)
 .N LRELSD S LRELSD=0
"RTN","LRAPDA",200,0)
 .S DIE="^LR(",DA=LRDFN
"RTN","LRAPDA",201,0)
 .D ^DIE
"RTN","LRAPDA",202,0)
 .S LRA=^LR(LRDFN,"AU")
"RTN","LRAPDA",203,0)
 .S LRI=$P(LRA,U)
"RTN","LRAPDA",204,0)
 .S LRAC=$P(LRA,U,6)
"RTN","LRAPDA",205,0)
 .I LRELSD D MAIN^LRAPRES1(LRDFN,LRSS,LRI,LRSF,LRP,LRAC)
"RTN","LRAPDA",206,0)
 D:LRSFLG="S" ^LRAPDSR
"RTN","LRAPDA",207,0)
 D UPDATE^LRPXRM(LRDFN,"AU")
"RTN","LRAPDA",208,0)
 L -^LR(LRDFN)
"RTN","LRAPDA",209,0)
 D:"BAP"[LRSOP AU
"RTN","LRAPDA",210,0)
 D:LRSOP="R" R
"RTN","LRAPDA",211,0)
 I LRSOP'="","ABP"[LRSOP D CPTCOD
"RTN","LRAPDA",212,0)
 Q
"RTN","LRAPDA",213,0)
AU I '$D(^LRO(69.2,LRAA,2,LRAN,0)) D
"RTN","LRAPDA",214,0)
 .L +^LRO(69.2,LRAA,2):5 I '$T D  Q
"RTN","LRAPDA",215,0)
 ..S MSG(1)="The final reports queue is in use by another person.  "
"RTN","LRAPDA",216,0)
 ..S MSG(1,"F")="!!"
"RTN","LRAPDA",217,0)
 ..S MSG(2)="You will need to add this accession to the queue later."
"RTN","LRAPDA",218,0)
 ..D EN^DDIOL(.MSG) K MSG
"RTN","LRAPDA",219,0)
 .S ^LRO(69.2,LRAA,2,LRAN,0)=LRDFN
"RTN","LRAPDA",220,0)
 .S X=^LRO(69.2,LRAA,2,0),^(0)=$P(X,"^",1,2)_"^"_LRAN_"^"_($P(X,"^",4)+1)
"RTN","LRAPDA",221,0)
 .L -^LRO(69.2,LRAA,2)
"RTN","LRAPDA",222,0)
 D AU^LRSPGD
"RTN","LRAPDA",223,0)
 Q
"RTN","LRAPDA",224,0)
R I '$D(^LRO(69.2,LRAA,3,LRAN,0)) D
"RTN","LRAPDA",225,0)
 .L +^LRO(69.2,LRAA,3):5 I '$T D  Q
"RTN","LRAPDA",226,0)
 ..S MSG(1)="The interim reports queue is in use by another person.  "
"RTN","LRAPDA",227,0)
 ..S MSG(1,"F")="!!"
"RTN","LRAPDA",228,0)
 ..S MSG(2)="You will need to add this accession to the queue later."
"RTN","LRAPDA",229,0)
 ..D EN^DDIOL(.MSG) K MSG
"RTN","LRAPDA",230,0)
 .S ^LRO(69.2,LRAA,3,LRAN,0)=LRDFN
"RTN","LRAPDA",231,0)
 .S X=^LRO(69.2,LRAA,3,0),^(0)=$P(X,"^",1,2)_"^"_LRAN_"^"_($P(X,"^",4)+1)
"RTN","LRAPDA",232,0)
 .L -^LRO(69.2,LRAA,3)
"RTN","LRAPDA",233,0)
 Q
"RTN","LRAPDA",234,0)
PNAME ;Patient Name Lookup
"RTN","LRAPDA",235,0)
 N LRPFLG            ;LRPFLG tells LRUPS to limit accessions to 
"RTN","LRAPDA",236,0)
 S X=LRAN,LRPFLG=1   ;the chosen year.
"RTN","LRAPDA",237,0)
 K LRAN,DIC,VADM,VAIN,VA
"RTN","LRAPDA",238,0)
 S DFN=-1,DIC(0)="EQM",(LRX,LRDPF)=""
"RTN","LRAPDA",239,0)
 D:'$D(LRLABKY) LABKEY^LRPARAM
"RTN","LRAPDA",240,0)
 D DPA1^LRDPA
"RTN","LRAPDA",241,0)
 I DFN=-1 S LRAN=-1 Q
"RTN","LRAPDA",242,0)
 D I^LRUPS
"RTN","LRAPDA",243,0)
 Q
"RTN","LRAPDA",244,0)
CPTCOD ;CPT Coding
"RTN","LRAPDA",245,0)
 N LRPRO
"RTN","LRAPDA",246,0)
 Q:$T(CPT^LRCAPES)=""
"RTN","LRAPDA",247,0)
 Q:LREL&('LRCPT)
"RTN","LRAPDA",248,0)
 I 'LREL D
"RTN","LRAPDA",249,0)
 .K DIR S DIR(0)="Y",DIR("A")="Enter CPT coding",DIR("B")="NO"
"RTN","LRAPDA",250,0)
 .D ^DIR W !
"RTN","LRAPDA",251,0)
 .S LRCPT=+Y
"RTN","LRAPDA",252,0)
 Q:'LRCPT
"RTN","LRAPDA",253,0)
 ;SET PROVIDER TO CURRENT USER, ALLOW UPDATES
"RTN","LRAPDA",254,0)
 S LRPRO=DUZ
"RTN","LRAPDA",255,0)
 D PROVIDR^LRAPUTL
"RTN","LRAPDA",256,0)
 Q:LRQUIT
"RTN","LRAPDA",257,0)
 D CPT^LRCAPES(LRAA,LRAD,LRAN,LRPRO)
"RTN","LRAPDA",258,0)
 Q
"RTN","LRAPDA",259,0)
END K LRSFLG
"RTN","LRAPDA",260,0)
 D:$T(CLEAN^LRCAPES)'="" CLEAN^LRCAPES
"RTN","LRAPDA",261,0)
 D V^LRU
"RTN","LRAPDA",262,0)
 Q
"RTN","LRAPR")
0^5^B88035016^B84430863
"RTN","LRAPR",1,0)
LRAPR ;DALOI/REG/WTY/KLL/CKA - ANAT RELEASE REPORTS ;10/30/01
"RTN","LRAPR",2,0)
 ;;5.2;LAB SERVICE;**72,248,259,317,365**;Sep 27, 1994;Build 9
"RTN","LRAPR",3,0)
 ;
"RTN","LRAPR",4,0)
 N LRESSW
"RTN","LRAPR",5,0)
 D SWITCH
"RTN","LRAPR",6,0)
 I +LRESSW D  Q
"RTN","LRAPR",7,0)
 .D ^LRAPRES
"RTN","LRAPR",8,0)
 .D END
"RTN","LRAPR",9,0)
 W !!?27,"Release Pathology Reports",!!
"RTN","LRAPR",10,0)
 D A
"RTN","LRAPR",11,0)
 I '$D(LRSS) D END Q
"RTN","LRAPR",12,0)
 I LRCAPA D  G:'$D(X) END
"RTN","LRAPR",13,0)
 .S X=$S(LRSS="CY":"CYTOLOGY REPORTING",LRSS="SP":"SURGICAL PATH REPORTING",1:"")
"RTN","LRAPR",14,0)
 .D:X]"" X^LRUWK
"RTN","LRAPR",15,0)
 I LRSS="AU" D B Q
"RTN","LRAPR",16,0)
 S LRSOP="Z"
"RTN","LRAPR",17,0)
 S DR="S A=^LR(LRDFN,LRSS,LRI,0),LRZ=$P(A,U,3),LRZ(1)=$P(A,U,13),"
"RTN","LRAPR",18,0)
 S DR=DR_"LRZ(2)=$P(A,U,11),LRZ(3)=$P(A,U,2);"
"RTN","LRAPR",19,0)
 S DR=DR_"I 'LRZ W $C(7),!,""No date report completed.   "
"RTN","LRAPR",20,0)
 S DR=DR_"Cannot release."" S Y=0;"
"RTN","LRAPR",21,0)
 S DR=DR_"I 'LRZ(2) D NMPATH^LRAPR;"
"RTN","LRAPR",22,0)
 S DR=DR_"I LRZ(2) D RINFO^LRAPR S Y=0;"
"RTN","LRAPR",23,0)
 ;Perform supp edit regardless if date rept released since supp rpt
"RTN","LRAPR",24,0)
 ; is added to released report
"RTN","LRAPR",25,0)
 S DR=DR_"D SUPCHK^LRAPR;"
"RTN","LRAPR",26,0)
 S DR=DR_"S DIR(0)=""YA"",DIR(""A"")=""Release report? """
"RTN","LRAPR",27,0)
 S DR=DR_",DIR(""B"")=""NO"" D ^DIR K:Y Y S:$D(Y) Y=0;"
"RTN","LRAPR",28,0)
 S DR=DR_".11////^D NOW^%DTC S X=%;.13////^S X=DUZ;"
"RTN","LRAPR",29,0)
 S DR=DR_"S LRELSD=1 W !!,""Report released..."""
"RTN","LRAPR",30,0)
 D ^LRAPDA
"RTN","LRAPR",31,0)
 D END
"RTN","LRAPR",32,0)
 Q
"RTN","LRAPR",33,0)
 ;
"RTN","LRAPR",34,0)
B ;Autopsy
"RTN","LRAPR",35,0)
 S LRSOP="Z"
"RTN","LRAPR",36,0)
 S DR="S A=$G(^LR(LRDFN,""AU"")) I A="""" S Y=0;"
"RTN","LRAPR",37,0)
 S DR=DR_"S LRZ=$P(A,U,3),LRZ(1)=$P(A,U,16),LRZ(2)=$P(A,U,15),"
"RTN","LRAPR",38,0)
 ;KLL-LRZ(3)=SR PATHOLOGIST,LRZ(4)=PROVISIONAL DATE
"RTN","LRAPR",39,0)
 S DR=DR_"LRZ(3)=$P(A,U,10),LRZ(4)=$P(A,U,17);"
"RTN","LRAPR",40,0)
 ;KLL-PROVISIONAL OR DATE REPORT COMPLETED IS REQUIRED
"RTN","LRAPR",41,0)
 S DR=DR_"I 'LRZ(4),'LRZ W $C(7),!,""Provisional date or date report completed required.   "
"RTN","LRAPR",42,0)
 S DR=DR_"Cannot release."" S Y=0;"
"RTN","LRAPR",43,0)
 S DR=DR_"I 'LRZ(2) D NMPATH^LRAPR;"
"RTN","LRAPR",44,0)
 S DR=DR_"I LRZ(2) D RINFO^LRAPR S Y=0;"
"RTN","LRAPR",45,0)
 ;Perform supp edit regardless if date rept released since supp rpt
"RTN","LRAPR",46,0)
 ; is added to released report
"RTN","LRAPR",47,0)
 S DR=DR_"D SUPCHK^LRAPR;"
"RTN","LRAPR",48,0)
 S DR=DR_"D RELEASE^LRAPR;"
"RTN","LRAPR",49,0)
 S DR=DR_"D NOW^%DTC S LRDTE=%;"
"RTN","LRAPR",50,0)
 S DR=DR_"14.7////^S X=$S(LRZ(2):""@"",1:LRDTE);"
"RTN","LRAPR",51,0)
 S DR=DR_"14.8////^S X=$S(LRZ(2):""@"",1:DUZ);"
"RTN","LRAPR",52,0)
 S DR=DR_"S:'LRZ(2) LRELSD=1 "
"RTN","LRAPR",53,0)
 S DR=DR_"W !!,""Report "" W:LRZ(2) ""un"" W ""released..."";K LRDTE"
"RTN","LRAPR",54,0)
 D ^LRAPDA
"RTN","LRAPR",55,0)
 D END
"RTN","LRAPR",56,0)
 Q
"RTN","LRAPR",57,0)
EN ;Supplementary Report Entry Point
"RTN","LRAPR",58,0)
 N LRESSW
"RTN","LRAPR",59,0)
 D SWITCH
"RTN","LRAPR",60,0)
 W !!?20,"Release Supplementary Pathology Reports",!
"RTN","LRAPR",61,0)
 ;D A
"RTN","LRAPR",62,0)
 ;Section prompt replaces the line above
"RTN","LRAPR",63,0)
 S LRQUIT=0
"RTN","LRAPR",64,0)
 D SECTION^LRAPRES
"RTN","LRAPR",65,0)
 I '$D(LRSS) D END Q
"RTN","LRAPR",66,0)
 ;Verify User ID has access to release supp. reports
"RTN","LRAPR",67,0)
 S LREND=0
"RTN","LRAPR",68,0)
 I LRESSW D CLSSCHK^LRAPRES1(DUZ,.LREND)
"RTN","LRAPR",69,0)
 Q:LREND
"RTN","LRAPR",70,0)
 ;
"RTN","LRAPR",71,0)
 W !!,"Data entry for ",LRH(0)," "
"RTN","LRAPR",72,0)
 S %=1 D YN^LRU G:%<1 END
"RTN","LRAPR",73,0)
 I %=2 D  G:Y<1 END
"RTN","LRAPR",74,0)
 .S %DT="AE",%DT(0)="-N",%DT("A")="Enter YEAR: " D ^%DT K %DT
"RTN","LRAPR",75,0)
 .Q:Y<1  S LRAD=$E(Y,1,3)_"0000",LRH(0)=$E(Y,1,3)+1700
"RTN","LRAPR",76,0)
 I '$D(^LRO(68,LRAA,1,LRAD,0)) D  Q
"RTN","LRAPR",77,0)
 .W $C(7),!!,"NO ",LRAA(1)," ACCESIONS IN FILE FOR ",LRH(0),!!
"RTN","LRAPR",78,0)
W K X,Y,LR("CK") R !!,"Select Accession Number/Pt name: ",LRAN:DTIME
"RTN","LRAPR",79,0)
 G:LRAN=""!(LRAN[U) END
"RTN","LRAPR",80,0)
 I LRAN'?1N.N D  G:LRAN<1 END  G W
"RTN","LRAPR",81,0)
 .D PNAME^LRAPDA
"RTN","LRAPR",82,0)
 .Q:LRAN<1
"RTN","LRAPR",83,0)
 .D DIE
"RTN","LRAPR",84,0)
 D REST
"RTN","LRAPR",85,0)
 G W
"RTN","LRAPR",86,0)
REST W "  for ",LRH(0)
"RTN","LRAPR",87,0)
 I '$D(^LRO(68,LRAA,1,LRAD,1,LRAN,0)) D  Q
"RTN","LRAPR",88,0)
 .W $C(7),!!,"Accession # ",LRAN," for ",LRH(0)
"RTN","LRAPR",89,0)
 .W " not in ACCESSION file",!!
"RTN","LRAPR",90,0)
 S X=^LRO(68,LRAA,1,LRAD,1,LRAN,0),LRLLOC=$P(X,"^",7),LRDFN=+X
"RTN","LRAPR",91,0)
 Q:'$D(^LR(LRDFN,0))  S X=^(0) D ^LRUP
"RTN","LRAPR",92,0)
 W !,LRP,"  ID: ",SSN
"RTN","LRAPR",93,0)
 I LRSS'="AU" D
"RTN","LRAPR",94,0)
 .S LRI=$P(^LRO(68,LRAA,1,LRAD,1,LRAN,3),"^",5)
"RTN","LRAPR",95,0)
 .W !,"Specimen(s):"
"RTN","LRAPR",96,0)
 .S X=0 F  S X=$O(^LR(LRDFN,LRSS,LRI,.1,X)) Q:'X  D
"RTN","LRAPR",97,0)
 ..I $D(^LR(LRDFN,LRSS,LRI,.1,X,0)),$L(^(0)) W !,^(0)
"RTN","LRAPR",98,0)
DIE ;Define default supplementary report
"RTN","LRAPR",99,0)
 N LRFILE,LRIENS,LRIENS1,LRX,LRRLS,LRFDA,LRLKFL,LRDA,LRQUIT,LRNOSP
"RTN","LRAPR",100,0)
 N LRMSG,LRSRFL,LRFDA2,LRSRMD,LRRLM
"RTN","LRAPR",101,0)
 S DIC("B")="",LRNOSP=0
"RTN","LRAPR",102,0)
 I LRSS'="AU" D
"RTN","LRAPR",103,0)
 .S LRFILE=+$$GET1^DID(LRSF,1.2,"","SPECIFIER")
"RTN","LRAPR",104,0)
 .S LRIENS1=LRI_","_LRDFN_","
"RTN","LRAPR",105,0)
 .I '+$P($G(^LR(LRDFN,LRSS,LRI,1.2,0)),"^",4) S LRNOSP=1 Q
"RTN","LRAPR",106,0)
 .S LRX=0 F  S LRX=$O(^LR(LRDFN,LRSS,LRI,1.2,LRX)) Q:'LRX  D
"RTN","LRAPR",107,0)
 ..S LRIENS=LRX_","_LRIENS1
"RTN","LRAPR",108,0)
 ..S LRSRFL=$$GET1^DIQ(LRFILE,LRIENS,.02,"I")
"RTN","LRAPR",109,0)
 ..;LRSRMD-set to 1 if supp rpt modified and requires release
"RTN","LRAPR",110,0)
 ..S LRSRMD=$$GET1^DIQ(LRFILE,LRIENS,.03,"I")
"RTN","LRAPR",111,0)
 ..Q:LRSRFL&('LRSRMD)
"RTN","LRAPR",112,0)
 ..S DIC("B")=$$GET1^DIQ(LRFILE,LRIENS,.01,"I")
"RTN","LRAPR",113,0)
 I LRSS="AU" D
"RTN","LRAPR",114,0)
 .S LRFILE=63.324,LRIENS1=LRDFN_","
"RTN","LRAPR",115,0)
 .I '+$P($G(^LR(LRDFN,84,0)),"^",4) S LRNOSP=1 Q
"RTN","LRAPR",116,0)
 .S LRX=0 F  S LRX=$O(^LR(LRDFN,84,LRX)) Q:'LRX  D
"RTN","LRAPR",117,0)
 ..S LRIENS=LRX_","_LRIENS1
"RTN","LRAPR",118,0)
 ..S LRSRFL=$$GET1^DIQ(LRFILE,LRIENS,.02,"I")
"RTN","LRAPR",119,0)
 ..;LRSRMD-set to 1 if supp rpt modified and requires release
"RTN","LRAPR",120,0)
 ..S LRSRMD=$$GET1^DIQ(LRFILE,LRIENS,.03,"I")
"RTN","LRAPR",121,0)
 ..Q:LRSRFL&('LRSRMD)
"RTN","LRAPR",122,0)
 ..S DIC("B")=$$GET1^DIQ(LRFILE,LRIENS,.01,"I")
"RTN","LRAPR",123,0)
 I LRNOSP D  Q
"RTN","LRAPR",124,0)
 .K LRMSG
"RTN","LRAPR",125,0)
 .S LRMSG=$C(7)_"No supplementary reports exist for this accession."
"RTN","LRAPR",126,0)
 .D EN^DDIOL(LRMSG,"","!!")
"RTN","LRAPR",127,0)
 I 'DIC("B") D  Q
"RTN","LRAPR",128,0)
 .K LRMSG
"RTN","LRAPR",129,0)
 .S LRMSG=$C(7)_"All supplementary reports have been released."
"RTN","LRAPR",130,0)
 .D EN^DDIOL(LRMSG,"","!!")
"RTN","LRAPR",131,0)
DIE1 ;
"RTN","LRAPR",132,0)
 S (LRQUIT,LRRLM)=0
"RTN","LRAPR",133,0)
 F  D  Q:LRQUIT
"RTN","LRAPR",134,0)
 .W !
"RTN","LRAPR",135,0)
 .S:LRSS="AU" (LRLKFL,DIC)="^LR(LRDFN,84,"
"RTN","LRAPR",136,0)
 .S:LRSS'="AU" (LRLKFL,DIC)="^LR(LRDFN,LRSS,LRI,1.2,"
"RTN","LRAPR",137,0)
 .S DIC("A")="Select SUPPLEMENTARY REPORT DATE: "
"RTN","LRAPR",138,0)
 .S DIC(0)="AEQM"
"RTN","LRAPR",139,0)
 .D ^DIC K DIC
"RTN","LRAPR",140,0)
 .I Y<1 S LRQUIT=1 Q
"RTN","LRAPR",141,0)
 .S LRDA=+Y
"RTN","LRAPR",142,0)
 .S LRIENS=LRDA_","_LRIENS1
"RTN","LRAPR",143,0)
 .S LRRLS=+$$GET1^DIQ(LRFILE,LRIENS,.02,"I")
"RTN","LRAPR",144,0)
 .;If E-Sign OFF, must check LRRLM.  LRRLM=1 if supp rpt has been
"RTN","LRAPR",145,0)
 .;  modified and requires release
"RTN","LRAPR",146,0)
 .S LRRLM=+$$GET1^DIQ(LRFILE,LRIENS,.03,"I")
"RTN","LRAPR",147,0)
 .I LRESSW,LRRLS D  Q
"RTN","LRAPR",148,0)
 ..W !!,"This supplementary report has already been released.",!
"RTN","LRAPR",149,0)
 .I 'LRESSW,LRRLS D  Q:'LRRLM
"RTN","LRAPR",150,0)
 ..I 'LRRLM W !!,"This supplementary rept has already been released.",!
"RTN","LRAPR",151,0)
 .W !
"RTN","LRAPR",152,0)
 .I LRESSW D  Q
"RTN","LRAPR",153,0)
 ..D ESIG Q:LRQUIT
"RTN","LRAPR",154,0)
 ..D UPDATE
"RTN","LRAPR",155,0)
 .S DIR("A")="Release supplementary report",DIR(0)="Y",DIR("B")="NO"
"RTN","LRAPR",156,0)
 .D ^DIR K DIR
"RTN","LRAPR",157,0)
 .Q:'Y
"RTN","LRAPR",158,0)
 .D UPDATE
"RTN","LRAPR",159,0)
 .;If E-sign switch OFF and orig report released, must verify all
"RTN","LRAPR",160,0)
 .;  supp reports released before release main report.
"RTN","LRAPR",161,0)
 .I LRCKREL,'LRESSW D CHKSUP^LRAPR1
"RTN","LRAPR",162,0)
 Q
"RTN","LRAPR",163,0)
 ;
"RTN","LRAPR",164,0)
A D ^LRAP G:'$D(Y) END
"RTN","LRAPR",165,0)
 Q
"RTN","LRAPR",166,0)
C ;
"RTN","LRAPR",167,0)
 S LRDICS="SPCYEM" D ^LRAP
"RTN","LRAPR",168,0)
 G:'$D(Y) END
"RTN","LRAPR",169,0)
 Q
"RTN","LRAPR",170,0)
S ;from LRAPDA
"RTN","LRAPR",171,0)
 S LRK=$P(^LR(LRDFN,LRSS,LRI,0),"^",11) Q:'LRK  S:'$D(^LRO(68,LRAA,1,LRAD,1,LRAN,4,0)) ^(0)="^68.04PA^^"
"RTN","LRAPR",172,0)
 Q:$D(^LRO(68,LRAA,1,LRAD,1,LRAN,4,LRT,0))  S ^(0)=LRT_"^50^^"_DUZ_"^"_LRK,X=^LRO(68,LRAA,1,LRAD,1,LRAN,4,0),^(0)=$P(X,"^",1,2)_"^"_LRT_"^"_($P(X,"^",4)+1)
"RTN","LRAPR",173,0)
 S:'$D(^LRO(68,LRAA,1,LRAD,1,LRAN,4,LRT,1,0)) ^(0)="^68.14P^^"
"RTN","LRAPR",174,0)
 S C=0 F  S C=$O(LRT(C)) Q:'C  D CAP
"RTN","LRAPR",175,0)
 S ^LRO(68,"AA",LRAA_"|"_LRAD_"|"_LRAN_"|"_LRT)=""
"RTN","LRAPR",176,0)
 Q
"RTN","LRAPR",177,0)
 ;
"RTN","LRAPR",178,0)
CAP S ^LRO(68,LRAA,1,LRAD,1,LRAN,4,LRT,1,C,0)=C_"^1^0^0^^"_LRK_"^"_DUZ_"^"_DUZ(2)_"^"_LRAA_"^"_LRAA_"^"_LRAA
"RTN","LRAPR",179,0)
 S X=^LRO(68,LRAA,1,LRAD,1,LRAN,4,LRT,1,0),^(0)=$P(X,"^",1,2)_"^"_C_"^"_($P(X,"^",4)+1)
"RTN","LRAPR",180,0)
 Q
"RTN","LRAPR",181,0)
 ;
"RTN","LRAPR",182,0)
SWITCH ;Check to see if electronic signature is enabled
"RTN","LRAPR",183,0)
 D GETDATA^LRAPESON(.LRESSW)
"RTN","LRAPR",184,0)
 Q
"RTN","LRAPR",185,0)
ESIG ;Prompt for electronic signature
"RTN","LRAPR",186,0)
 S LRQUIT=0
"RTN","LRAPR",187,0)
 D SIG^XUSESIG
"RTN","LRAPR",188,0)
 I X1="" D
"RTN","LRAPR",189,0)
 .W "  SIGNATURE NOT VERIFIED"
"RTN","LRAPR",190,0)
 .S LRQUIT=1
"RTN","LRAPR",191,0)
 Q
"RTN","LRAPR",192,0)
UPDATE ;
"RTN","LRAPR",193,0)
 S LRLKFL=LRLKFL_LRDA_",0)"
"RTN","LRAPR",194,0)
 L +@(LRLKFL):5 I '$T D  Q
"RTN","LRAPR",195,0)
 .S LRMSG="This record is locked by another user.  "
"RTN","LRAPR",196,0)
 .S LRMSG=LRMSG_"Please wait and try again."
"RTN","LRAPR",197,0)
 .D EN^DDIOL(LRMSG,"","!!")
"RTN","LRAPR",198,0)
 S LRFDA(LRFILE,LRIENS,.02)=1
"RTN","LRAPR",199,0)
 S LRFDA2(LRFILE,LRIENS,.02)="@" ;Set but don't file unless unrel needed
"RTN","LRAPR",200,0)
 ;File signer ID and Date/time of released supp report
"RTN","LRAPR",201,0)
 D CKSIGNR^LRAPR1
"RTN","LRAPR",202,0)
 D FILE^DIE("","LRFDA")
"RTN","LRAPR",203,0)
 W "...Released"
"RTN","LRAPR",204,0)
 L -@(LRLKFL)
"RTN","LRAPR",205,0)
 I LRSS="AU" D
"RTN","LRAPR",206,0)
 .S LRA=^LR(LRDFN,"AU")
"RTN","LRAPR",207,0)
 .S LRAC=$$GET1^DIQ(63,LRDFN_",",14,"I")
"RTN","LRAPR",208,0)
 .S LRI=$P(LRA,U)
"RTN","LRAPR",209,0)
 I LRSS'="AU" D
"RTN","LRAPR",210,0)
 .S LRA=^LR(LRDFN,LRSS,LRI,0)
"RTN","LRAPR",211,0)
 .S LRAC=$$GET1^DIQ(LRSF,LRIENS,.06,"I")
"RTN","LRAPR",212,0)
 D MAIN^LRAPRES1(LRDFN,LRSS,LRI,LRSF,LRP,LRAC)
"RTN","LRAPR",213,0)
 ;If all supp reports released, and E-Sign switch is ON, proceed to
"RTN","LRAPR",214,0)
 ;  release main report
"RTN","LRAPR",215,0)
 S LRCKREL=0
"RTN","LRAPR",216,0)
 S:LRSS'="AU" LRCKREL=$P(^LR(LRDFN,LRSS,LRI,0),"^",11)
"RTN","LRAPR",217,0)
 S:LRSS="AU" LRCKREL=$P(^LR(LRDFN,LRSS),"^",15)
"RTN","LRAPR",218,0)
 I LRCKREL,LRESSW D RELMN
"RTN","LRAPR",219,0)
 Q
"RTN","LRAPR",220,0)
SUPCHK ;Check for unreleased supplementary reports
"RTN","LRAPR",221,0)
 N LRSR,LRSR1,LRSR2
"RTN","LRAPR",222,0)
 S LRSR=0,LRSR1=1
"RTN","LRAPR",223,0)
 I LRSS'="AU" D
"RTN","LRAPR",224,0)
 .Q:'+$P($G(^LR(LRDFN,LRSS,LRI,1.2,0)),U,4)
"RTN","LRAPR",225,0)
 .F  S LRSR=$O(^LR(LRDFN,LRSS,LRI,1.2,LRSR)) Q:LRSR'>0!('LRSR1)  D
"RTN","LRAPR",226,0)
 ..S LRSR1=+$P(^LR(LRDFN,LRSS,LRI,1.2,LRSR,0),U,2)
"RTN","LRAPR",227,0)
 ..I 'LRSR1 D
"RTN","LRAPR",228,0)
 ...S Y=+$P(^LR(LRDFN,LRSS,LRI,1.2,LRSR,0),U)
"RTN","LRAPR",229,0)
 ...D DD^%DT S LRSR2=Y
"RTN","LRAPR",230,0)
 I LRSS="AU" D
"RTN","LRAPR",231,0)
 .Q:'+$P($G(^LR(LRDFN,84,0)),U,4)
"RTN","LRAPR",232,0)
 .F  S LRSR=$O(^LR(LRDFN,84,LRSR)) Q:LRSR'>0!('LRSR1)  D
"RTN","LRAPR",233,0)
 ..S LRSR1=+$P(^LR(LRDFN,84,LRSR,0),U,2)
"RTN","LRAPR",234,0)
 ..I 'LRSR1 D
"RTN","LRAPR",235,0)
 ...S Y=+$P(^LR(LRDFN,84,LRSR,0),U)
"RTN","LRAPR",236,0)
 ...D DD^%DT S LRSR2=Y
"RTN","LRAPR",237,0)
 I 'LRSR1 D
"RTN","LRAPR",238,0)
 .W $C(7),!,"Supplementary report "_LRSR2_" has not been released.  "
"RTN","LRAPR",239,0)
 .W "Cannot release."
"RTN","LRAPR",240,0)
 .S Y=0
"RTN","LRAPR",241,0)
 Q
"RTN","LRAPR",242,0)
RINFO ;Display release information
"RTN","LRAPR",243,0)
 W $C(7),!,"Report "
"RTN","LRAPR",244,0)
 W:LRZ(2)=1 "has already been "
"RTN","LRAPR",245,0)
 W "released "
"RTN","LRAPR",246,0)
 S Y=LRZ(2)
"RTN","LRAPR",247,0)
 D DD^%DT
"RTN","LRAPR",248,0)
 W:LRZ(2)>1 Y
"RTN","LRAPR",249,0)
 W:LRZ(1)'="" " by "_$P($G(^VA(200,LRZ(1),0)),U)
"RTN","LRAPR",250,0)
 K Y
"RTN","LRAPR",251,0)
 Q
"RTN","LRAPR",252,0)
NMPATH ;Check for missing pathologist name
"RTN","LRAPR",253,0)
 I 'LRZ(3) D
"RTN","LRAPR",254,0)
 .W $C(7),!,"Pathologist name missing.  Cannot release."
"RTN","LRAPR",255,0)
 .S Y=0
"RTN","LRAPR",256,0)
 Q
"RTN","LRAPR",257,0)
RELEASE ;Prompt for release/unrelease
"RTN","LRAPR",258,0)
 W ! S DIR(0)="YA",DIR("B")="NO"
"RTN","LRAPR",259,0)
 S:LRZ(2) DIR("A")="Unrelease report? "
"RTN","LRAPR",260,0)
 S:'LRZ(2) DIR("A")="Release report? "
"RTN","LRAPR",261,0)
 D ^DIR
"RTN","LRAPR",262,0)
 K:Y Y
"RTN","LRAPR",263,0)
 I $D(Y) S Y=0
"RTN","LRAPR",264,0)
 Q
"RTN","LRAPR",265,0)
RELMN ;Allow release of main report as long as all supp reports are
"RTN","LRAPR",266,0)
 ;  released, and signer is same person for main and supp report(s)
"RTN","LRAPR",267,0)
 ;Make sure all supp reports signed out
"RTN","LRAPR",268,0)
 S LRQT=0
"RTN","LRAPR",269,0)
 D RELCHK^LRAPR1
"RTN","LRAPR",270,0)
 Q:LRQT
"RTN","LRAPR",271,0)
 ;
"RTN","LRAPR",272,0)
 ;Continue with electronic signature and storage in TIU
"RTN","LRAPR",273,0)
 S LRAU=$S(LRSS="AU":1,1:0)
"RTN","LRAPR",274,0)
 I 'LRAU D
"RTN","LRAPR",275,0)
 .S LRPAT=+$$GET1^DIQ(LRSF,LRIENS1,.02,"I")
"RTN","LRAPR",276,0)
 .S LRZ=$$GET1^DIQ(LRSF,LRIENS1,.03,"I")
"RTN","LRAPR",277,0)
 .S LRZ(1)=$$GET1^DIQ(LRSF,LRIENS1,.13,"I")
"RTN","LRAPR",278,0)
 .S LRZ(1.1)=$$GET1^DIQ(LRSF,LRIENS1,.13)
"RTN","LRAPR",279,0)
 .S LRZ(2)=$$GET1^DIQ(LRSF,LRIENS1,.11,"I")
"RTN","LRAPR",280,0)
 I LRAU D
"RTN","LRAPR",281,0)
 .S LRPAT=+$$GET1^DIQ(63,LRDFN_",",13.6,"I")
"RTN","LRAPR",282,0)
 .S LRZ=$$GET1^DIQ(63,LRDFN_",",13,"I")
"RTN","LRAPR",283,0)
 .S LRZ(1)=$$GET1^DIQ(63,LRDFN_",",14.8,"I")
"RTN","LRAPR",284,0)
 .S LRZ(1.1)=$$GET1^DIQ(63,LRDFN_",",14.8)
"RTN","LRAPR",285,0)
 .S LRZ(2)=$$GET1^DIQ(63,LRDFN_",",14.7,"I")
"RTN","LRAPR",286,0)
 W !!,?25,"*** Main Report Release ***",!
"RTN","LRAPR",287,0)
 D NOW^%DTC S LRNTIME=%
"RTN","LRAPR",288,0)
 D TIUPREP^LRAPRES
"RTN","LRAPR",289,0)
 D STORE^LRAPRES
"RTN","LRAPR",290,0)
 I LRQUIT D FILE^DIE("","LRFDA2") Q
"RTN","LRAPR",291,0)
 D UNRLSE^LRAPR1
"RTN","LRAPR",292,0)
 D RELEASE^LRAPRES
"RTN","LRAPR",293,0)
 I LRQUIT D FILE^DIE("","LRFDA2") Q
"RTN","LRAPR",294,0)
 D OERR^LR7OB63D
"RTN","LRAPR",295,0)
 S LRQUIT=1
"RTN","LRAPR",296,0)
 Q
"RTN","LRAPR",297,0)
END ;
"RTN","LRAPR",298,0)
 D V^LRU
"RTN","LRAPR",299,0)
 Q
"RTN","LRAPRES1")
0^6^B43214564^B43595923
"RTN","LRAPRES1",1,0)
LRAPRES1 ;DALOI/WTY/KLL/CKA - AP ESIG RELEASE REPORT/ALERT;11/13/01
"RTN","LRAPRES1",2,0)
 ;;5.2;LAB SERVICE;**259,336,369,365**;Sep 27, 1994;Build 9
"RTN","LRAPRES1",3,0)
 ;
"RTN","LRAPRES1",4,0)
 ;Reference to FILE^TIUSRVP supported by IA #3540
"RTN","LRAPRES1",5,0)
 ;Reference to ^TIULQ supported by IA #2693 
"RTN","LRAPRES1",6,0)
 ;Reference to ^ORB3LAB supported by IA #4287
"RTN","LRAPRES1",7,0)
 ;Reference to DIC lookup on MAIL GROUP file (#3.8) supported by IA #10111
"RTN","LRAPRES1",8,0)
 ;
"RTN","LRAPRES1",9,0)
MAIN(LRDFN,LRSS,LRI,LRSF,LRP,LRAC) ;Main subroutine
"RTN","LRAPRES1",10,0)
 Q:'$D(LRDFN)!('$D(LRSS))!('$D(LRP))!('$D(LRAC))
"RTN","LRAPRES1",11,0)
 N LRDOCS,LRMSG,LRC,LRDOCSN,LRNUM,LRADL,LRMORE,LRQUIT,LRXQA
"RTN","LRAPRES1",12,0)
 N DIR,DIRUT,DTOUT,DUOUT,X,Y,DIC,XQA,XQAMSG
"RTN","LRAPRES1",13,0)
 S LRQUIT=0
"RTN","LRAPRES1",14,0)
 I $G(LRAU) D
"RTN","LRAPRES1",15,0)
 .S LRA=^LR(LRDFN,"AU")
"RTN","LRAPRES1",16,0)
 .S LRI=$P(LRA,U)
"RTN","LRAPRES1",17,0)
 D DOCS
"RTN","LRAPRES1",18,0)
 Q:LRQUIT
"RTN","LRAPRES1",19,0)
 D MORE
"RTN","LRAPRES1",20,0)
 I LRMORE D LOOKUP
"RTN","LRAPRES1",21,0)
 D SEND
"RTN","LRAPRES1",22,0)
 Q
"RTN","LRAPRES1",23,0)
DOCS ;GET ORDERING PROVIDER AND PCP TO SEND ALERT
"RTN","LRAPRES1",24,0)
 W !
"RTN","LRAPRES1",25,0)
 S:$G(LRSF)="" LRSF=63
"RTN","LRAPRES1",26,0)
 D GETDOCS^LRAPUTL(.LRDOCS,LRDFN,LRSS,$G(LRI),LRSF)
"RTN","LRAPRES1",27,0)
 S:LRDOCS(1)=LRDOCS(2) LRDOCS(2)=0
"RTN","LRAPRES1",28,0)
 F LRC=1:1:2 D
"RTN","LRAPRES1",29,0)
 .I LRDOCS(LRC) D
"RTN","LRAPRES1",30,0)
 ..S LRDOCSN(LRC)=$$NAME^XUSER(LRDOCS(LRC),"F")
"RTN","LRAPRES1",31,0)
 ..I LRDOCSN(LRC)'="" S LRXQA(LRDOCS(LRC))=""
"RTN","LRAPRES1",32,0)
 S LRNUM=1
"RTN","LRAPRES1",33,0)
 K LRMSG
"RTN","LRAPRES1",34,0)
 D
"RTN","LRAPRES1",35,0)
 .S LRMSG(LRNUM)="Alert will be sent to:",LRMSG(LRNUM,"F")="!!"
"RTN","LRAPRES1",36,0)
 .I LRDOCS(1) D
"RTN","LRAPRES1",37,0)
 ..S LRNUM=LRNUM+1,LRMSG(LRNUM)=LRDOCSN(1),LRMSG(LRNUM,"F")="?24"
"RTN","LRAPRES1",38,0)
 .I LRDOCS(2) D
"RTN","LRAPRES1",39,0)
 ..S LRNUM=LRNUM+1,LRMSG(LRNUM)=LRDOCSN(2)
"RTN","LRAPRES1",40,0)
 ..S LRMSG(LRNUM,"F")=$S(LRDOCS(1):"!",1:"")_"?24"
"RTN","LRAPRES1",41,0)
 I LRQUIT D
"RTN","LRAPRES1",42,0)
 .S LRMSG(LRNUM)="No Ordering Provider or PCP for alert"
"RTN","LRAPRES1",43,0)
 .S LRMSG(LRNUM,"F")="!!"
"RTN","LRAPRES1",44,0)
 D EN^DDIOL(.LRMSG)
"RTN","LRAPRES1",45,0)
 Q
"RTN","LRAPRES1",46,0)
MORE ;Add names or mail groups to the lookup list?
"RTN","LRAPRES1",47,0)
 N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","LRAPRES1",48,0)
 W !
"RTN","LRAPRES1",49,0)
 S LRMORE=1
"RTN","LRAPRES1",50,0)
 S DIR(0)="Y"
"RTN","LRAPRES1",51,0)
 S DIR("A")="Send the alert to additional names or mail groups"
"RTN","LRAPRES1",52,0)
 S X=$$GET^XPAR("USR^DIV^PKG","LRAPRES1 AP ALERT",1,"Q")
"RTN","LRAPRES1",53,0)
 S X=$S(X=1:"YES",X=0:"NO",1:"NO")
"RTN","LRAPRES1",54,0)
 S DIR("B")=X
"RTN","LRAPRES1",55,0)
 D ^DIR
"RTN","LRAPRES1",56,0)
 I Y=0 S LRMORE=0 Q
"RTN","LRAPRES1",57,0)
 I $D(DUOUT)!($D(DTOUT)) S LRQUIT=1,LRMORE=0
"RTN","LRAPRES1",58,0)
 Q
"RTN","LRAPRES1",59,0)
LOOKUP ;Add additional names or mail groups to alert list.
"RTN","LRAPRES1",60,0)
 F  D  Q:LRQUIT
"RTN","LRAPRES1",61,0)
 .W !
"RTN","LRAPRES1",62,0)
 .K DIR
"RTN","LRAPRES1",63,0)
 .;S DIR(0)="F^3:30^I X'?1""U."".E&(X'?1""G."".E) K X"
"RTN","LRAPRES1",64,0)
 .S DIR(0)="FO^3:30^I X["".""&((X'?1""G."".E)&(X'?1""g."".E)) K X"
"RTN","LRAPRES1",65,0)
 .S DIR("A")="Enter name or mail group"
"RTN","LRAPRES1",66,0)
 .S DIR("?")="Enter lastname,firstname OR G.mailgroup OR ^ to exit"
"RTN","LRAPRES1",67,0)
 .D ^DIR
"RTN","LRAPRES1",68,0)
 .I $D(DIRUT) S LRQUIT=1 Q
"RTN","LRAPRES1",69,0)
 .S X=Y,LRADL=""
"RTN","LRAPRES1",70,0)
 .I Y["." S LRADL=$P(Y,"."),X=$P(Y,".",2)
"RTN","LRAPRES1",71,0)
 .S Y=$$UP^XLFSTR(Y)
"RTN","LRAPRES1",72,0)
 .I LRADL="g" S LRADL="G"
"RTN","LRAPRES1",73,0)
 .K DIC
"RTN","LRAPRES1",74,0)
 .S DIC(0)="QEZ"
"RTN","LRAPRES1",75,0)
 .S DIC=$S(LRADL="G":3.8,1:200)
"RTN","LRAPRES1",76,0)
 .D ^DIC
"RTN","LRAPRES1",77,0)
 .Q:Y=-1
"RTN","LRAPRES1",78,0)
 .S:LRADL="" XQA($P(Y,"^"))=""
"RTN","LRAPRES1",79,0)
 .S:LRADL="G" XQA("G."_$P(Y,"^",2))=""
"RTN","LRAPRES1",80,0)
 Q
"RTN","LRAPRES1",81,0)
SEND ;Send the alert
"RTN","LRAPRES1",82,0)
 ;S XQAMSG=$E(LRP,1,9)_" ("_$E(LRP,1)_VA("BID")_"): Pathology report signed for "_LRAC_"."
"RTN","LRAPRES1",83,0)
 ;D SETUP^XQALERT
"RTN","LRAPRES1",84,0)
 M XQA=LRXQA
"RTN","LRAPRES1",85,0)
 D LAB^ORB3LAB(DFN,LRDFN,LRI,$G(LRA),LRSS,.XQA)
"RTN","LRAPRES1",86,0)
 I $D(LRADL) D
"RTN","LRAPRES1",87,0)
 .S LRMSG="Alerts have been sent to the specified additional users."
"RTN","LRAPRES1",88,0)
 .D EN^DDIOL(LRMSG,"","!!")
"RTN","LRAPRES1",89,0)
 .K LRMSG
"RTN","LRAPRES1",90,0)
 Q
"RTN","LRAPRES1",91,0)
AHELP ;Help Frame
"RTN","LRAPRES1",92,0)
 K LRMSG
"RTN","LRAPRES1",93,0)
 S LRMSG(1)="If answered 'Yes', the alert will notify the primary care"
"RTN","LRAPRES1",94,0)
 S LRMSG(1,"F")="!"
"RTN","LRAPRES1",95,0)
 S LRMSG(2)="provider and the surgeon/physician that this report has"
"RTN","LRAPRES1",96,0)
 S LRMSG(3)="been electronically signed and is now available for"
"RTN","LRAPRES1",97,0)
 S LRMSG(4)="viewing. You will also have the opportunity to send the"
"RTN","LRAPRES1",98,0)
 S LRMSG(5)="alert to additional names or mail groups."
"RTN","LRAPRES1",99,0)
 D EN^DDIOL(.LRMSG)
"RTN","LRAPRES1",100,0)
 Q
"RTN","LRAPRES1",101,0)
RETRACT(LRDFN,LRSS,LRI,LRTIUPTR) ;
"RTN","LRAPRES1",102,0)
 ;Change prior TIU versions of report to RETRACTED status
"RTN","LRAPRES1",103,0)
 N LRROOT,LRIENS,LRFILE,LRTIUP,LRTIUAR,LRERR,LRSTAT,LRTIUX,LREXRR
"RTN","LRAPRES1",104,0)
 I LRSS=""!("AUSPEMCY"'[LRSS) S LRPTR=0 Q
"RTN","LRAPRES1",105,0)
 I LRSS="AU" D
"RTN","LRAPRES1",106,0)
 .S LRROOT="^LR(LRDFN,101,""C""",LRIENS=LRDFN_","
"RTN","LRAPRES1",107,0)
 .S LRFILE=63.101
"RTN","LRAPRES1",108,0)
 I LRSS'="AU" D
"RTN","LRAPRES1",109,0)
 .S LRROOT="^LR(LRDFN,LRSS,LRI,.05,""C"""
"RTN","LRAPRES1",110,0)
 .S LRIENS=LRI_","_LRDFN_","
"RTN","LRAPRES1",111,0)
 .S LRFILE=$S(LRSS="SP":63.19,LRSS="CY":63.47,LRSS="EM":63.49,1:"")
"RTN","LRAPRES1",112,0)
 Q:'$D(@(LRROOT_")"))
"RTN","LRAPRES1",113,0)
 S LRTIUP=0,LRTIUX(.05)=15
"RTN","LRAPRES1",114,0)
 F  S LRTIUP=$O(@(LRROOT_",LRTIUP)"))  Q:LRTIUP'>0!(LRTIUP=LRTIUPTR)  D
"RTN","LRAPRES1",115,0)
 .K LRTIUAR S (LRSTAT,LRERR)=0
"RTN","LRAPRES1",116,0)
 .D EXTRACT^TIULQ(LRTIUP,"LRTIUAR",.LRERR,".05",,,"I")
"RTN","LRAPRES1",117,0)
 .Q:+LRERR
"RTN","LRAPRES1",118,0)
 .M LRSTAT=LRTIUAR(LRTIUP,.05,"I")
"RTN","LRAPRES1",119,0)
 .Q:LRSTAT'=7  ;Quit if current status is not COMPLETED
"RTN","LRAPRES1",120,0)
 .D FILE^TIUSRVP(.LREXRR,LRTIUP,.LRTIUX)
"RTN","LRAPRES1",121,0)
 .;Update new TIU version of report with previous TIU pointer value
"RTN","LRAPRES1",122,0)
 .N LREXRR,LRTIUX
"RTN","LRAPRES1",123,0)
 .S LRTIUX(1406)=LRTIUP
"RTN","LRAPRES1",124,0)
 .D FILE^TIUSRVP(.LREXRR,LRTIUPTR,.LRTIUX)
"RTN","LRAPRES1",125,0)
 Q
"RTN","LRAPRES1",126,0)
CLSSCHK(DUZ,LREND) ;Determine if user has the proper class settings and
"RTN","LRAPRES1",127,0)
 ;PROVIDER key
"RTN","LRAPRES1",128,0)
 N LRMSG,LRPRCLSS,LRPCEXP,LRVCDE,LRPCSTR,LRMTCH
"RTN","LRAPRES1",129,0)
 ;First, check for PROVIDER key
"RTN","LRAPRES1",130,0)
 I '$D(^XUSEC("PROVIDER",DUZ)) D  Q
"RTN","LRAPRES1",131,0)
 .K LRMSG S LRMSG=$C(7)_"Electronic signature not authorized.  Missing "
"RTN","LRAPRES1",132,0)
 .S LRMSG=LRMSG_"PROVIDER key."
"RTN","LRAPRES1",133,0)
 .D EN^DDIOL(LRMSG,"","!!")
"RTN","LRAPRES1",134,0)
 .K LRMSG S LREND=1
"RTN","LRAPRES1",135,0)
 ;Next, check the provider class
"RTN","LRAPRES1",136,0)
 S LRPRCLSS=$$GET1^DIQ(200,DUZ_",",53.5)
"RTN","LRAPRES1",137,0)
 ;PROVIDER CL MUST CONTAIN PHYSICIAN, OR CYTOTECH ONLY FOR CY SECTION
"RTN","LRAPRES1",138,0)
 ;OR DENTIST FOR ORAL AND MAXILLOFACIAL PATHOLOGY
"RTN","LRAPRES1",139,0)
 S LRMTCH=0
"RTN","LRAPRES1",140,0)
 I LRPRCLSS'["PHYSICIAN",LRPRCLSS'["DENTIST" D
"RTN","LRAPRES1",141,0)
 .I LRPRCLSS'["CYTOTECH" S LRMTCH=1
"RTN","LRAPRES1",142,0)
 .I LRSS'="CY" S LRMTCH=1
"RTN","LRAPRES1",143,0)
 I LRMTCH=1 D  Q
"RTN","LRAPRES1",144,0)
 .K LRMSG
"RTN","LRAPRES1",145,0)
 .S LRMSG(1)=$C(7)_"You are not authorized to electronically sign "
"RTN","LRAPRES1",146,0)
 .S LRMSG(1)=LRMSG(1)_"reports."
"RTN","LRAPRES1",147,0)
 .S LRMSG(1,"F")="!!"
"RTN","LRAPRES1",148,0)
 .S LRMSG(2)="PROVIDER CLASS must include PHYSICIAN,"
"RTN","LRAPRES1",149,0)
 .S LRMSG(2,"F")="!"
"RTN","LRAPRES1",150,0)
 .S LRMSG(3)="  OR CYTOTECHNOLOGIST FOR CY SECTIONS ONLY,"
"RTN","LRAPRES1",151,0)
 .S LRMSG(3,"F")="!"
"RTN","LRAPRES1",152,0)
 .S LRMSG(4)=" OR DENTIST FOR ORAL AND MAXILLOFACIAL PATHOLOGY."
"RTN","LRAPRES1",153,0)
 .S LRMSG(4,"F")="!"
"RTN","LRAPRES1",154,0)
 .D EN^DDIOL(.LRMSG) K LRMSG
"RTN","LRAPRES1",155,0)
 .S LREND=1
"RTN","LRAPRES1",156,0)
 ;Finally, check the person class
"RTN","LRAPRES1",157,0)
 S LRPCSTR=$$GET^XUA4A72(DUZ)   ;Supported reference #1625
"RTN","LRAPRES1",158,0)
 I LRPCSTR<0 D  Q
"RTN","LRAPRES1",159,0)
 .K LRMSG
"RTN","LRAPRES1",160,0)
 .S LRMSG="PERSON CLASS is inactive or undefined.  Electronic signature"
"RTN","LRAPRES1",161,0)
 .S LRMSG=LRMSG_" is not authorized."
"RTN","LRAPRES1",162,0)
 .D EN^DDIOL(LRMSG,"","!!")
"RTN","LRAPRES1",163,0)
 .K LRMSG
"RTN","LRAPRES1",164,0)
 .S LREND=1
"RTN","LRAPRES1",165,0)
 S LRPCEXP=+$P(LRPCSTR,"^",6)
"RTN","LRAPRES1",166,0)
 I LRPCEXP D  Q
"RTN","LRAPRES1",167,0)
 .K LRMSG
"RTN","LRAPRES1",168,0)
 .S LRMSG="PERSON CLASS has expired.  Electronic signature"
"RTN","LRAPRES1",169,0)
 .S LRMSG=LRMSG_" is not authorized."
"RTN","LRAPRES1",170,0)
 .D EN^DDIOL(LRMSG,"","!!") K LRMSG
"RTN","LRAPRES1",171,0)
 .S LREND=1
"RTN","LRAPRES1",172,0)
 S LRVCDE=$P(LRPCSTR,"^",7),LRMTCH=0
"RTN","LRAPRES1",173,0)
 ;CORRECT PERSON CLASS SHOULD MATCH PROVIDER CLASS
"RTN","LRAPRES1",174,0)
 I LRPRCLSS["PHYSICIAN" D
"RTN","LRAPRES1",175,0)
 .I $E(LRVCDE,1,6)="V11370","123568"[+$E(LRVCDE,7) S LRMTCH=1
"RTN","LRAPRES1",176,0)
 .I $E(LRVCDE,1,6)="V11371","03"[+$E(LRVCDE,7) S LRMTCH=1
"RTN","LRAPRES1",177,0)
 .I $E(LRVCDE,1,6)="V18240","124579"[+$E(LRVCDE,7) S LRMTCH=1
"RTN","LRAPRES1",178,0)
 .I LRVCDE="V182413" S LRMTCH=1
"RTN","LRAPRES1",179,0)
 I LRPRCLSS["CYTOTECH" D
"RTN","LRAPRES1",180,0)
 .I LRVCDE="V150113" S LRMTCH=1
"RTN","LRAPRES1",181,0)
 I LRPRCLSS["DENTIST" D
"RTN","LRAPRES1",182,0)
 .I LRVCDE="V030503" S LRMTCH=1
"RTN","LRAPRES1",183,0)
 I 'LRMTCH D
"RTN","LRAPRES1",184,0)
 .K LRMSG
"RTN","LRAPRES1",185,0)
 .S LRMSG="Invalid PERSON CLASS.  Electronic Signature is not "
"RTN","LRAPRES1",186,0)
 .S LRMSG=LRMSG_"authorized."
"RTN","LRAPRES1",187,0)
 .D EN^DDIOL(LRMSG,"","!!")
"RTN","LRAPRES1",188,0)
 .K LRMSG
"RTN","LRAPRES1",189,0)
 .S LREND=1
"RTN","LRAPRES1",190,0)
 Q
"RTN","LRWOMEN")
0^4^B1173687^B1458269
"RTN","LRWOMEN",1,0)
LRWOMEN ;DALOI/CYM/FT/CKA - LINK TO WOMEN'S HEALTH PROGRAM ;10/22/04  13:14
"RTN","LRWOMEN",2,0)
 ;;5.2;LAB SERVICE;**231,248,311,324,365**;Sep 27, 1994;Build 9
"RTN","LRWOMEN",3,0)
 ;
"RTN","LRWOMEN",4,0)
 ;Reference to CREATE^WVLRLINK supported by IA #2772
"RTN","LRWOMEN",5,0)
 ;Reference to DELETE^WVLRLINK supported by IA #2772
"RTN","LRWOMEN",6,0)
 ;Reference to CREATE^WVLABCHK supported by IA #4525
"RTN","LRWOMEN",7,0)
 ;
"RTN","LRWOMEN",8,0)
ADD ; From DD 63.08,.11 and 63.09,.11
"RTN","LRWOMEN",9,0)
 Q:+$G(LRDPF)'=2
"RTN","LRWOMEN",10,0)
 Q:'$D(LRSS)
"RTN","LRWOMEN",11,0)
 Q:$P(^LR(LRDFN,LRSS,LRI,0),U,11)']""
"RTN","LRWOMEN",12,0)
 Q:$G(SEX)'["F"
"RTN","LRWOMEN",13,0)
 Q:$T(CREATE^WVLRLINK)']""
"RTN","LRWOMEN",14,0)
 D CREATE^WVLRLINK(DFN,LRDFN,LRI,$G(LRA),LRSS)
"RTN","LRWOMEN",15,0)
 Q
"RTN","LRWOMEN",16,0)
 ;
"RTN","LRWOMEN",17,0)
 ;
"RTN","LRWOMEN",18,0)
DEL ; From LRAPM
"RTN","LRWOMEN",19,0)
 Q:$G(SEX)'["F"
"RTN","LRWOMEN",20,0)
 Q:+$G(LRDPF)'=2
"RTN","LRWOMEN",21,0)
 Q:'$D(LRSS)
"RTN","LRWOMEN",22,0)
 Q:$P(^LR(LRDFN,LRSS,LRI,0),U,11)]""
"RTN","LRWOMEN",23,0)
 Q:$T(DELETE^WVLRLINK)']""
"RTN","LRWOMEN",24,0)
 D DELETE^WVLRLINK(DFN,LRDFN,LRI,X,LRSS)
"RTN","LRWOMEN",25,0)
 Q
"RTN","LRWOMEN",26,0)
 ;
"RTN","LRWOMEN",27,0)
 ;
"RTN","LRWOMEN",28,0)
MOVE ; From LRAPMV
"RTN","LRWOMEN",29,0)
 ; no longer used after LR*5.2*259
"RTN","LRWOMEN",30,0)
 Q
"RTN","LRWOMEN",31,0)
 ;
"RTN","LRWOMEN",32,0)
 ;
"RTN","LRWOMEN",33,0)
SNOMED ; From DD 63.08,10 and 63.09,10
"RTN","LRWOMEN",34,0)
 Q:+$G(LRDPF)'=2
"RTN","LRWOMEN",35,0)
 Q:'$D(LRSS)
"RTN","LRWOMEN",36,0)
 Q:$P(^LR(LRDFN,LRSS,LRI,0),U,11)=""
"RTN","LRWOMEN",37,0)
 Q:$G(SEX)'["F"
"RTN","LRWOMEN",38,0)
 Q:$T(CREATE^WVLABCHK)']""
"RTN","LRWOMEN",39,0)
 D CREATE^WVLABCHK(DFN,LRDFN,LRI,$G(LRA),LRSS)
"RTN","LRWOMEN",40,0)
 Q
"VER")
8.0^22.0
**END**
**END**
