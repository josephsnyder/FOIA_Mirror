KIDS Distribution saved on Aug 25, 2009@13:00:25
RECALL BUNDLE V1.0
**KIDS**:SD*5.3*536^OR*3.0*302^

**INSTALL NAME**
SD*5.3*536
"BLD",7344,0)
SD*5.3*536^SCHEDULING^0^3090825^y
"BLD",7344,1,0)
^^1^1^3080915^
"BLD",7344,1,1,0)
See National Patch Module, SD*5.3*536
"BLD",7344,4,0)
^9.64PA^403.53^7
"BLD",7344,4,403.5,0)
403.5
"BLD",7344,4,403.5,222)
y^y^f^^^^n
"BLD",7344,4,403.51,0)
403.51
"BLD",7344,4,403.51,222)
y^y^f^^^^n^^
"BLD",7344,4,403.51,224)

"BLD",7344,4,403.52,0)
403.52
"BLD",7344,4,403.52,222)
y^y^f^^^^n
"BLD",7344,4,403.53,0)
403.53
"BLD",7344,4,403.53,222)
y^y^f^^^^n
"BLD",7344,4,403.54,0)
403.54
"BLD",7344,4,403.54,222)
y^y^f^^^^n
"BLD",7344,4,403.55,0)
403.55
"BLD",7344,4,403.55,222)
y^y^f^^^^n
"BLD",7344,4,403.56,0)
403.56
"BLD",7344,4,403.56,222)
y^y^f^^^^n
"BLD",7344,4,"B",403.5,403.5)

"BLD",7344,4,"B",403.51,403.51)

"BLD",7344,4,"B",403.52,403.52)

"BLD",7344,4,"B",403.53,403.53)

"BLD",7344,4,"B",403.54,403.54)

"BLD",7344,4,"B",403.55,403.55)

"BLD",7344,4,"B",403.56,403.56)

"BLD",7344,6.3)
53
"BLD",7344,"ABNS",0)
^9.66A^^
"BLD",7344,"ABPKG")
^n
"BLD",7344,"KRN",0)
^9.67PA^8989.52^19
"BLD",7344,"KRN",.4,0)
.4
"BLD",7344,"KRN",.401,0)
.401
"BLD",7344,"KRN",.402,0)
.402
"BLD",7344,"KRN",.402,"NM",0)
^9.68A^7^7
"BLD",7344,"KRN",.402,"NM",1,0)
SDRR RECALL CARD ADD    FILE #403.5^403.5^0
"BLD",7344,"KRN",.402,"NM",2,0)
SDRREMARKS    FILE #403.5^403.5^0
"BLD",7344,"KRN",.402,"NM",3,0)
SDRR ADD PROVIDER    FILE #403.54^403.54^0
"BLD",7344,"KRN",.402,"NM",4,0)
SDRR APPT TYPE    FILE #403.51^403.51^0
"BLD",7344,"KRN",.402,"NM",5,0)
SDRR PARAMS ENTER    FILE #403.53^403.53^0
"BLD",7344,"KRN",.402,"NM",6,0)
SDRR TEAM NAMES    FILE #403.55^403.55^0
"BLD",7344,"KRN",.402,"NM",7,0)
SDRR ADD LETTERS    FILE #403.52^403.52^0
"BLD",7344,"KRN",.402,"NM","B","SDRR ADD LETTERS    FILE #403.52",7)

"BLD",7344,"KRN",.402,"NM","B","SDRR ADD PROVIDER    FILE #403.54",3)

"BLD",7344,"KRN",.402,"NM","B","SDRR APPT TYPE    FILE #403.51",4)

"BLD",7344,"KRN",.402,"NM","B","SDRR PARAMS ENTER    FILE #403.53",5)

"BLD",7344,"KRN",.402,"NM","B","SDRR RECALL CARD ADD    FILE #403.5",1)

"BLD",7344,"KRN",.402,"NM","B","SDRR TEAM NAMES    FILE #403.55",6)

"BLD",7344,"KRN",.402,"NM","B","SDRREMARKS    FILE #403.5",2)

"BLD",7344,"KRN",.403,0)
.403
"BLD",7344,"KRN",.403,"NM",0)
^9.68A^^
"BLD",7344,"KRN",.5,0)
.5
"BLD",7344,"KRN",.84,0)
.84
"BLD",7344,"KRN",3.6,0)
3.6
"BLD",7344,"KRN",3.8,0)
3.8
"BLD",7344,"KRN",3.8,"NM",0)
^9.68A^1^1
"BLD",7344,"KRN",3.8,"NM",1,0)
SDRR BAD ADDRESS^^0
"BLD",7344,"KRN",3.8,"NM","B","SDRR BAD ADDRESS",1)

"BLD",7344,"KRN",9.2,0)
9.2
"BLD",7344,"KRN",9.8,0)
9.8
"BLD",7344,"KRN",9.8,"NM",0)
^9.68A^38^33
"BLD",7344,"KRN",9.8,"NM",1,0)
SDRR1^^0^B13934931
"BLD",7344,"KRN",9.8,"NM",2,0)
SDRR5^^0^B9146765
"BLD",7344,"KRN",9.8,"NM",3,0)
SDRRC15^^0^B35948677
"BLD",7344,"KRN",9.8,"NM",4,0)
SDRRCLR^^0^B6432300
"BLD",7344,"KRN",9.8,"NM",5,0)
SDRRCLR2^^0^B10431466
"BLD",7344,"KRN",9.8,"NM",6,0)
SDRRCRR^^0^B75514794
"BLD",7344,"KRN",9.8,"NM",7,0)
SDRRCRR1^^0^B30605766
"BLD",7344,"KRN",9.8,"NM",8,0)
SDRRCRRP^^0^B40214532
"BLD",7344,"KRN",9.8,"NM",9,0)
SDRRDEL^^0^B3357699
"BLD",7344,"KRN",9.8,"NM",10,0)
SDRRISB^^0^B778508
"BLD",7344,"KRN",9.8,"NM",11,0)
SDRRISRA^^0^B33542930
"BLD",7344,"KRN",9.8,"NM",12,0)
SDRRISRD^^0^B26348770
"BLD",7344,"KRN",9.8,"NM",13,0)
SDRRISRL^^0^B31811224
"BLD",7344,"KRN",9.8,"NM",14,0)
SDRRISRU^^0^B13362967
"BLD",7344,"KRN",9.8,"NM",15,0)
SDRRISRX^^0^B30760645
"BLD",7344,"KRN",9.8,"NM",16,0)
SDRRLRP^^0^B1446323
"BLD",7344,"KRN",9.8,"NM",20,0)
SDRROR^^0^B3486735
"BLD",7344,"KRN",9.8,"NM",22,0)
SDRRPXC^^0^B35140878
"BLD",7344,"KRN",9.8,"NM",23,0)
SDRRRECL^^0^B83067983
"BLD",7344,"KRN",9.8,"NM",24,0)
SDRRRECP^^0^B67349870
"BLD",7344,"KRN",9.8,"NM",25,0)
SDRRSEG3^^0^B2988411
"BLD",7344,"KRN",9.8,"NM",26,0)
SDRRSLC1^^0^B40514848
"BLD",7344,"KRN",9.8,"NM",27,0)
SDRRSLCT^^0^B60537302
"BLD",7344,"KRN",9.8,"NM",28,0)
SDRRTSK^^0^B13148697
"BLD",7344,"KRN",9.8,"NM",29,0)
SDRRTSK1^^0^B7882942
"BLD",7344,"KRN",9.8,"NM",30,0)
SDRRUTL^^0^B34000828
"BLD",7344,"KRN",9.8,"NM",31,0)
SDRRUTL1^^0^B26580492
"BLD",7344,"KRN",9.8,"NM",32,0)
SDRRC16^^0^B36122202
"BLD",7344,"KRN",9.8,"NM",33,0)
SDRRC17^^0^B35448060
"BLD",7344,"KRN",9.8,"NM",34,0)
SDRRC18^^0^B38268527
"BLD",7344,"KRN",9.8,"NM",36,0)
SDRRC20^^0^B61232869
"BLD",7344,"KRN",9.8,"NM",37,0)
SDRRINQ^^0^B72514446
"BLD",7344,"KRN",9.8,"NM",38,0)
SDRRINQ1^^0^B55827759
"BLD",7344,"KRN",9.8,"NM","B","SDRR1",1)

"BLD",7344,"KRN",9.8,"NM","B","SDRR5",2)

"BLD",7344,"KRN",9.8,"NM","B","SDRRC15",3)

"BLD",7344,"KRN",9.8,"NM","B","SDRRC16",32)

"BLD",7344,"KRN",9.8,"NM","B","SDRRC17",33)

"BLD",7344,"KRN",9.8,"NM","B","SDRRC18",34)

"BLD",7344,"KRN",9.8,"NM","B","SDRRC20",36)

"BLD",7344,"KRN",9.8,"NM","B","SDRRCLR",4)

"BLD",7344,"KRN",9.8,"NM","B","SDRRCLR2",5)

"BLD",7344,"KRN",9.8,"NM","B","SDRRCRR",6)

"BLD",7344,"KRN",9.8,"NM","B","SDRRCRR1",7)

"BLD",7344,"KRN",9.8,"NM","B","SDRRCRRP",8)

"BLD",7344,"KRN",9.8,"NM","B","SDRRDEL",9)

"BLD",7344,"KRN",9.8,"NM","B","SDRRINQ",37)

"BLD",7344,"KRN",9.8,"NM","B","SDRRINQ1",38)

"BLD",7344,"KRN",9.8,"NM","B","SDRRISB",10)

"BLD",7344,"KRN",9.8,"NM","B","SDRRISRA",11)

"BLD",7344,"KRN",9.8,"NM","B","SDRRISRD",12)

"BLD",7344,"KRN",9.8,"NM","B","SDRRISRL",13)

"BLD",7344,"KRN",9.8,"NM","B","SDRRISRU",14)

"BLD",7344,"KRN",9.8,"NM","B","SDRRISRX",15)

"BLD",7344,"KRN",9.8,"NM","B","SDRRLRP",16)

"BLD",7344,"KRN",9.8,"NM","B","SDRROR",20)

"BLD",7344,"KRN",9.8,"NM","B","SDRRPXC",22)

"BLD",7344,"KRN",9.8,"NM","B","SDRRRECL",23)

"BLD",7344,"KRN",9.8,"NM","B","SDRRRECP",24)

"BLD",7344,"KRN",9.8,"NM","B","SDRRSEG3",25)

"BLD",7344,"KRN",9.8,"NM","B","SDRRSLC1",26)

"BLD",7344,"KRN",9.8,"NM","B","SDRRSLCT",27)

"BLD",7344,"KRN",9.8,"NM","B","SDRRTSK",28)

"BLD",7344,"KRN",9.8,"NM","B","SDRRTSK1",29)

"BLD",7344,"KRN",9.8,"NM","B","SDRRUTL",30)

"BLD",7344,"KRN",9.8,"NM","B","SDRRUTL1",31)

"BLD",7344,"KRN",19,0)
19
"BLD",7344,"KRN",19,"NM",0)
^9.68A^27^26
"BLD",7344,"KRN",19,"NM",1,0)
SDRR DELETE RECALL^^0
"BLD",7344,"KRN",19,"NM",2,0)
SDRR CLEAN-UP^^0
"BLD",7344,"KRN",19,"NM",3,0)
SDRR CARD ADD^^0
"BLD",7344,"KRN",19,"NM",4,0)
SDRR RECALL MAIN MENU^^0
"BLD",7344,"KRN",19,"NM",5,0)
SDRR CONVERT ENTRIES^^0
"BLD",7344,"KRN",19,"NM",6,0)
SDRR RECALL DELINQUENCIES^^0
"BLD",7344,"KRN",19,"NM",7,0)
SDRR RECALL DELETIONS^^0
"BLD",7344,"KRN",19,"NM",8,0)
SDRR RECALL APPOINTMENTS^^0
"BLD",7344,"KRN",19,"NM",9,0)
SDRR PATIENT LIST^^0
"BLD",7344,"KRN",19,"NM",10,0)
SDRR RECALL LIST^^0
"BLD",7344,"KRN",19,"NM",11,0)
SDRR PRINT MENU^^0
"BLD",7344,"KRN",19,"NM",12,0)
SDRR TASK JOB^^0
"BLD",7344,"KRN",19,"NM",13,0)
SDRR ADD RECALL PROVIDER^^0
"BLD",7344,"KRN",19,"NM",14,0)
SDRR ADD RECALL TEAM^^0
"BLD",7344,"KRN",19,"NM",15,0)
SDRR APPT TYPE^^0
"BLD",7344,"KRN",19,"NM",16,0)
SDRR CLINIC LETTER^^0
"BLD",7344,"KRN",19,"NM",17,0)
SDRR MANAGER MENU^^0
"BLD",7344,"KRN",19,"NM",18,0)
SDRR RECALL REMINDER PARAMS^^0
"BLD",7344,"KRN",19,"NM",20,0)
SDRR CON RECALL APPT TYPES^^0
"BLD",7344,"KRN",19,"NM",21,0)
SDRR CONV OUTPATIENT RECALL^^0
"BLD",7344,"KRN",19,"NM",22,0)
SDRR CONVERSION PARAMS FILE^^0
"BLD",7344,"KRN",19,"NM",23,0)
SDRR CONVERSION PROVIDER FILE^^0
"BLD",7344,"KRN",19,"NM",24,0)
SDRR CONVERSION TEAM FILE^^0
"BLD",7344,"KRN",19,"NM",25,0)
SDRR IRM MENU^^0
"BLD",7344,"KRN",19,"NM",26,0)
SDRR PATIENT INQUIRY^^0
"BLD",7344,"KRN",19,"NM",27,0)
SDRR TASK JOB CARD^^0
"BLD",7344,"KRN",19,"NM","B","SDRR ADD RECALL PROVIDER",13)

"BLD",7344,"KRN",19,"NM","B","SDRR ADD RECALL TEAM",14)

"BLD",7344,"KRN",19,"NM","B","SDRR APPT TYPE",15)

"BLD",7344,"KRN",19,"NM","B","SDRR CARD ADD",3)

"BLD",7344,"KRN",19,"NM","B","SDRR CLEAN-UP",2)

"BLD",7344,"KRN",19,"NM","B","SDRR CLINIC LETTER",16)

"BLD",7344,"KRN",19,"NM","B","SDRR CON RECALL APPT TYPES",20)

"BLD",7344,"KRN",19,"NM","B","SDRR CONV OUTPATIENT RECALL",21)

"BLD",7344,"KRN",19,"NM","B","SDRR CONVERSION PARAMS FILE",22)

"BLD",7344,"KRN",19,"NM","B","SDRR CONVERSION PROVIDER FILE",23)

"BLD",7344,"KRN",19,"NM","B","SDRR CONVERSION TEAM FILE",24)

"BLD",7344,"KRN",19,"NM","B","SDRR CONVERT ENTRIES",5)

"BLD",7344,"KRN",19,"NM","B","SDRR DELETE RECALL",1)

"BLD",7344,"KRN",19,"NM","B","SDRR IRM MENU",25)

"BLD",7344,"KRN",19,"NM","B","SDRR MANAGER MENU",17)

"BLD",7344,"KRN",19,"NM","B","SDRR PATIENT INQUIRY",26)

"BLD",7344,"KRN",19,"NM","B","SDRR PATIENT LIST",9)

"BLD",7344,"KRN",19,"NM","B","SDRR PRINT MENU",11)

"BLD",7344,"KRN",19,"NM","B","SDRR RECALL APPOINTMENTS",8)

"BLD",7344,"KRN",19,"NM","B","SDRR RECALL DELETIONS",7)

"BLD",7344,"KRN",19,"NM","B","SDRR RECALL DELINQUENCIES",6)

"BLD",7344,"KRN",19,"NM","B","SDRR RECALL LIST",10)

"BLD",7344,"KRN",19,"NM","B","SDRR RECALL MAIN MENU",4)

"BLD",7344,"KRN",19,"NM","B","SDRR RECALL REMINDER PARAMS",18)

"BLD",7344,"KRN",19,"NM","B","SDRR TASK JOB",12)

"BLD",7344,"KRN",19,"NM","B","SDRR TASK JOB CARD",27)

"BLD",7344,"KRN",19.1,0)
19.1
"BLD",7344,"KRN",19.1,"NM",0)
^9.68A^1^1
"BLD",7344,"KRN",19.1,"NM",1,0)
SDRR MANAGER^^0
"BLD",7344,"KRN",19.1,"NM","B","SDRR MANAGER",1)

"BLD",7344,"KRN",101,0)
101
"BLD",7344,"KRN",101,"NM",0)
^9.68A^1^1
"BLD",7344,"KRN",101,"NM",1,0)
SDRR EVENT^^0
"BLD",7344,"KRN",101,"NM","B","SDRR EVENT",1)

"BLD",7344,"KRN",409.61,0)
409.61
"BLD",7344,"KRN",771,0)
771
"BLD",7344,"KRN",870,0)
870
"BLD",7344,"KRN",8989.51,0)
8989.51
"BLD",7344,"KRN",8989.52,0)
8989.52
"BLD",7344,"KRN",8994,0)
8994
"BLD",7344,"KRN","B",.4,.4)

"BLD",7344,"KRN","B",.401,.401)

"BLD",7344,"KRN","B",.402,.402)

"BLD",7344,"KRN","B",.403,.403)

"BLD",7344,"KRN","B",.5,.5)

"BLD",7344,"KRN","B",.84,.84)

"BLD",7344,"KRN","B",3.6,3.6)

"BLD",7344,"KRN","B",3.8,3.8)

"BLD",7344,"KRN","B",9.2,9.2)

"BLD",7344,"KRN","B",9.8,9.8)

"BLD",7344,"KRN","B",19,19)

"BLD",7344,"KRN","B",19.1,19.1)

"BLD",7344,"KRN","B",101,101)

"BLD",7344,"KRN","B",409.61,409.61)

"BLD",7344,"KRN","B",771,771)

"BLD",7344,"KRN","B",870,870)

"BLD",7344,"KRN","B",8989.51,8989.51)

"BLD",7344,"KRN","B",8989.52,8989.52)

"BLD",7344,"KRN","B",8994,8994)

"BLD",7344,"QUES",0)
^9.62^^
"BLD",7344,"REQB",0)
^9.611^^
"FIA",403.5)
RECALL REMINDERS
"FIA",403.5,0)
^SD(403.5,
"FIA",403.5,0,0)
403.5IP
"FIA",403.5,0,1)
y^y^f^^^^n
"FIA",403.5,0,10)

"FIA",403.5,0,11)

"FIA",403.5,0,"RLRO")

"FIA",403.5,0,"VR")
5.3^SD
"FIA",403.5,403.5)
0
"FIA",403.51)
RECALL REMINDERS APPT TYPE
"FIA",403.51,0)
^SD(403.51,
"FIA",403.51,0,0)
403.51I
"FIA",403.51,0,1)
y^y^f^^^^n^^
"FIA",403.51,0,10)

"FIA",403.51,0,11)

"FIA",403.51,0,"RLRO")

"FIA",403.51,0,"VR")
5.3^SD
"FIA",403.51,403.51)
0
"FIA",403.52)
RECALL REMINDERS LETTERS
"FIA",403.52,0)
^SD(403.52,
"FIA",403.52,0,0)
403.52P
"FIA",403.52,0,1)
y^y^f^^^^n
"FIA",403.52,0,10)

"FIA",403.52,0,11)

"FIA",403.52,0,"RLRO")

"FIA",403.52,0,"VR")
5.3^SD
"FIA",403.52,403.52)
0
"FIA",403.52,403.521)
0
"FIA",403.53)
RECALL REMINDERS PARAMETERS
"FIA",403.53,0)
^SD(403.53,
"FIA",403.53,0,0)
403.53
"FIA",403.53,0,1)
y^y^f^^^^n
"FIA",403.53,0,10)

"FIA",403.53,0,11)

"FIA",403.53,0,"RLRO")

"FIA",403.53,0,"VR")
5.3^SD
"FIA",403.53,403.53)
0
"FIA",403.54)
RECALL REMINDERS PROVIDERS
"FIA",403.54,0)
^SD(403.54,
"FIA",403.54,0,0)
403.54IP
"FIA",403.54,0,1)
y^y^f^^^^n
"FIA",403.54,0,10)

"FIA",403.54,0,11)

"FIA",403.54,0,"RLRO")

"FIA",403.54,0,"VR")
5.3^SD
"FIA",403.54,403.54)
0
"FIA",403.55)
RECALL REMINDERS TEAM
"FIA",403.55,0)
^SD(403.55,
"FIA",403.55,0,0)
403.55
"FIA",403.55,0,1)
y^y^f^^^^n
"FIA",403.55,0,10)

"FIA",403.55,0,11)

"FIA",403.55,0,"RLRO")

"FIA",403.55,0,"VR")
5.3^SD
"FIA",403.55,403.55)
0
"FIA",403.56)
RECALL REMINDERS REMOVED
"FIA",403.56,0)
^SD(403.56,
"FIA",403.56,0,0)
403.56P
"FIA",403.56,0,1)
y^y^f^^^^n
"FIA",403.56,0,10)

"FIA",403.56,0,11)

"FIA",403.56,0,"RLRO")

"FIA",403.56,0,"VR")
5.3^SD
"FIA",403.56,403.56)
0
"IX",403.5,403.5,"A66201",0)
403.5^A66201^Save copy of record before deletion.^MU^^F^IR^I^403.5^^^^^A
"IX",403.5,403.5,"A66201",.1,0)
^^6^6^3080221^
"IX",403.5,403.5,"A66201",.1,1,0)
Before deleting a record from this file, save a copy of it in file
"IX",403.5,403.5,"A66201",.1,2,0)
403.56.  Deletion can be either because a clerk deletes a patient from the
"IX",403.5,403.5,"A66201",.1,3,0)
recall list, or because a patient has been given an appointment in a
"IX",403.5,403.5,"A66201",.1,4,0)
clinic requested by the recall list and therefore is deleted by the
"IX",403.5,403.5,"A66201",.1,5,0)
nightly job.  We save this information so that we can look back at
"IX",403.5,403.5,"A66201",.1,6,0)
appointments given to patients and see how timely the appointments were.
"IX",403.5,403.5,"A66201",1)
Q
"IX",403.5,403.5,"A66201",2)
D DELETE^SDRRISRU
"IX",403.5,403.5,"A66201",2.4)
S X=(X1'=""&(X2=""))
"IX",403.5,403.5,"A66201",11.1,0)
^.114IA^1^1
"IX",403.5,403.5,"A66201",11.1,1,0)
1^F^403.5^.01^^^F
"IX",403.5,403.5,"A66201",11.1,1,1)

"IX",403.56,403.56,"D",0)
403.56^D^Look up by clinic and recall date^R^^R^IR^I^403.56^^^^^LS
"IX",403.56,403.56,"D",1)
S ^SD(403.56,"D",X(1),X(2),DA)=""
"IX",403.56,403.56,"D",2)
K ^SD(403.56,"D",X(1),X(2),DA)
"IX",403.56,403.56,"D",2.5)
K ^SD(403.56,"D")
"IX",403.56,403.56,"D",11.1,0)
^.114IA^2^2
"IX",403.56,403.56,"D",11.1,1,0)
1^F^403.56^4.5^^1^F
"IX",403.56,403.56,"D",11.1,1,3)

"IX",403.56,403.56,"D",11.1,2,0)
2^F^403.56^5^^2^F
"IX",403.56,403.56,"D",11.1,2,3)

"KRN",.402,2657,-1)
0^1
"KRN",.402,2657,0)
SDRR RECALL CARD ADD^3080528.1026^^403.5^^^3090824
"KRN",.402,2657,"DR",1,403.5)
.01;5;5.5;4;4.5;4.7;Q;3;Q;2.6;2.5;7////^S X=DUZ;
"KRN",.402,2658,-1)
0^5
"KRN",.402,2658,0)
SDRR PARAMS ENTER^3080303.0949^@^403.53^^@^3090409
"KRN",.402,2658,"DR",1,403.53)
.01;I '$D(^ROUTINE("R1ACSX",0)) W !!,"**Your Site can only select either CARDS or LETTERS",!;1;2;3;4;
"KRN",.402,2659,-1)
0^4
"KRN",.402,2659,0)
SDRR APPT TYPE^3080301.1317^@^403.51^^@^3090409
"KRN",.402,2659,"DR",1,403.51)
.01;1;
"KRN",.402,2660,-1)
0^2
"KRN",.402,2660,0)
SDRREMARKS^3080222.0941^@^403.5^^@^3090723
"KRN",.402,2660,"DR",1,403.5)
2.5;
"KRN",.402,2661,-1)
0^3
"KRN",.402,2661,0)
SDRR ADD PROVIDER^3080301.1318^@^403.54^^@^3090409
"KRN",.402,2661,"DR",1,403.54)
.01;1;2;3;4;5//A;6;
"KRN",.402,2662,-1)
0^6
"KRN",.402,2662,0)
SDRR TEAM NAMES^3080301.1318^@^403.55^^@^3090409
"KRN",.402,2662,"DR",1,403.55)
.01;1;2;3;
"KRN",.402,2663,-1)
0^7
"KRN",.402,2663,0)
SDRR ADD LETTERS^3080301.1335^@^403.52^^@^3090409
"KRN",.402,2663,"DR",1,403.52)
.01;1;
"KRN",3.8,399,-1)
0^1
"KRN",3.8,399,0)
SDRR BAD ADDRESS^PU^n^^^0^
"KRN",3.8,399,2,0)
^3.801^2^2^3090302^^^^
"KRN",3.8,399,2,1,0)
This mail group will receive messages for patients who have been 
"KRN",3.8,399,2,2,0)
scheduled in Recall Reminder, but have a bad address flag set.
"KRN",3.8,399,3)

"KRN",19,13002,-1)
0^1
"KRN",19,13002,0)
SDRR DELETE RECALL^Delete/Cancel Clinic Recall Entry^^R^^^^^^^^SCHEDULING^^1
"KRN",19,13002,1,0)
^^1^1^3090817^
"KRN",19,13002,1,1,0)
This option allows Recall Reminder entries to be cancelled or deleted.  
"KRN",19,13002,20)
S DIDEL=403.5
"KRN",19,13002,25)
SDRRDEL
"KRN",19,13002,30)
SD(403.5
"KRN",19,13002,31)
AEMQ
"KRN",19,13002,50)

"KRN",19,13002,51)

"KRN",19,13002,99.1)
60935,54705
"KRN",19,13002,"U")
DELETE/CANCEL CLINIC RECALL EN
"KRN",19,13003,-1)
0^2
"KRN",19,13003,0)
SDRR CLEAN-UP^Clean Up Clinic Recall Entries^^R^^^^^^^^SCHEDULING
"KRN",19,13003,1,0)
^^8^8^3090817^
"KRN",19,13003,1,1,0)
This option is a Recall Reminder option which should be queued to run
"KRN",19,13003,1,2,0)
after 10:00pm every night.  It will check those patients in Recall
"KRN",19,13003,1,3,0)
Reminder against scheduled appointments and will delete a patient from
"KRN",19,13003,1,4,0)
Recall Reminder if the scheduled appointment date and clinic are within a 
"KRN",19,13003,1,5,0)
number of days from the Recall Date.  The Recall clinic must match
"KRN",19,13003,1,6,0)
the clinic that the patient has been scheduled for.  If the Clinic name is
"KRN",19,13003,1,7,0)
different, it will not delete the patient from the Recall Reminders file.
"KRN",19,13003,1,8,0)
The number of days is set within RECALL REMINDERS PARAMETERS.
"KRN",19,13003,25)
SDRRCLR
"KRN",19,13003,200.9)
y
"KRN",19,13003,"U")
CLEAN UP CLINIC RECALL ENTRIES
"KRN",19,13004,-1)
0^3
"KRN",19,13004,0)
SDRR CARD ADD^Add/Edit Clinic Recall Patient^^R^^^^^^^^SCHEDULING
"KRN",19,13004,1,0)
^^2^2^3090811^
"KRN",19,13004,1,1,0)
This option allows users to enter or edit a patient into
"KRN",19,13004,1,2,0)
the Recall Reminder file without using Appointment Management.
"KRN",19,13004,25)
SDRRCLR2
"KRN",19,13004,99.1)
59604,48493
"KRN",19,13004,"U")
ADD/EDIT CLINIC RECALL PATIENT
"KRN",19,13005,-1)
0^4
"KRN",19,13005,0)
SDRR RECALL MAIN MENU^Recall Reminder Main Menu^^M^^^^^^^^SCHEDULING
"KRN",19,13005,1,0)
^^3^3^3090817^
"KRN",19,13005,1,1,0)
Main menu for all Recall Reminder options.  Some of the options are 
"KRN",19,13005,1,2,0)
locked with SDRR MANAGER security key which should be assigned to the 
"KRN",19,13005,1,3,0)
Recall Reminder coordinator.
"KRN",19,13005,10,0)
^19.01IP^20^20
"KRN",19,13005,10,9,0)
13002^1^1
"KRN",19,13005,10,9,"^")
SDRR DELETE RECALL
"KRN",19,13005,10,11,0)
13004^2^2
"KRN",19,13005,10,11,"^")
SDRR CARD ADD
"KRN",19,13005,10,13,0)
13007^3^3
"KRN",19,13005,10,13,"^")
SDRR RECALL DELINQUENCIES
"KRN",19,13005,10,14,0)
13008^4^4
"KRN",19,13005,10,14,"^")
SDRR RECALL DELETIONS
"KRN",19,13005,10,15,0)
13009^5^5
"KRN",19,13005,10,15,"^")
SDRR RECALL APPOINTMENTS
"KRN",19,13005,10,16,0)
13010^6^6
"KRN",19,13005,10,16,"^")
SDRR RECALL LIST
"KRN",19,13005,10,17,0)
13012^8^8
"KRN",19,13005,10,17,"^")
SDRR PRINT MENU
"KRN",19,13005,10,18,0)
13020^9^9
"KRN",19,13005,10,18,"^")
SDRR PATIENT INQUIRY
"KRN",19,13005,10,19,0)
13014^10^10
"KRN",19,13005,10,19,"^")
SDRR MANAGER MENU
"KRN",19,13005,10,20,0)
13011^7^7
"KRN",19,13005,10,20,"^")
SDRR PATIENT LIST
"KRN",19,13005,99)
61598,46600
"KRN",19,13005,99.1)
61537,43107
"KRN",19,13005,"U")
RECALL REMINDER MAIN MENU
"KRN",19,13006,-1)
0^5
"KRN",19,13006,0)
SDRR CONVERT ENTRIES^Convert Retired Providers/Clinic Recalls^^R^^SDRR MANAGER^^^^^^SCHEDULING
"KRN",19,13006,1,0)
^^3^3^3090817^
"KRN",19,13006,1,1,0)
This option will allow an approved user to convert Recall providers
"KRN",19,13006,1,2,0)
and clinics.  If a provider leaves and there are Clinic Recalls already 
"KRN",19,13006,1,3,0)
scheduled, you can convert these recalls to the new provider.
"KRN",19,13006,25)
SDRR5
"KRN",19,13006,"U")
CONVERT RETIRED PROVIDERS/CLIN
"KRN",19,13007,-1)
0^6
"KRN",19,13007,0)
SDRR RECALL DELINQUENCIES^Recall List Delinquencies^^R^^^^^^^^SCHEDULING
"KRN",19,13007,1,0)
^^7^7^3090817^
"KRN",19,13007,1,1,0)
This option is essentially the same report as those produced by the two
"KRN",19,13007,1,2,0)
"Delinquent  Recall" reports, except it provides better control of
"KRN",19,13007,1,3,0)
clinic selection and it reports on how many days delinquent each patient
"KRN",19,13007,1,4,0)
is. The user is asked for the recall date range, a set of clinics, and
"KRN",19,13007,1,5,0)
whether the report should break on clinic. It reports on patients who have
"KRN",19,13007,1,6,0)
been sent recall reminders, but haven't yet called to schedule an
"KRN",19,13007,1,7,0)
appointment.
"KRN",19,13007,25)
EN^SDRRISRD
"KRN",19,13007,99.1)
60939,58069
"KRN",19,13007,"U")
RECALL LIST DELINQUENCIES
"KRN",19,13008,-1)
0^7
"KRN",19,13008,0)
SDRR RECALL DELETIONS^Recall List Deletions^^R^^^^^^^^SCHEDULING
"KRN",19,13008,1,0)
^19.06^3^3^3080227^^^
"KRN",19,13008,1,1,0)
This option reports on the patients who were deleted from the Recall List
"KRN",19,13008,1,2,0)
by a clerk.
"KRN",19,13008,1,3,0)

"KRN",19,13008,25)
EN^SDRRISRX
"KRN",19,13008,99.1)
60939,32780
"KRN",19,13008,"U")
RECALL LIST DELETIONS
"KRN",19,13009,-1)
0^8
"KRN",19,13009,0)
SDRR RECALL APPOINTMENTS^Scheduled Recall Appointments^^R^^^^^^^^SCHEDULING
"KRN",19,13009,1,0)
^19.06^3^3^3080227^^^
"KRN",19,13009,1,1,0)
This option lists the patient appointments which caused patients to drop off
"KRN",19,13009,1,2,0)
the Recall List.
"KRN",19,13009,1,3,0)

"KRN",19,13009,25)
EN^SDRRISRA
"KRN",19,13009,99.1)
60941,31045
"KRN",19,13009,"U")
SCHEDULED RECALL APPOINTMENTS
"KRN",19,13010,-1)
0^10
"KRN",19,13010,0)
SDRR RECALL LIST^Recall List w/Available Slots^^R^^^^^^^^SCHEDULING
"KRN",19,13010,1,0)
^^5^5^3090817^
"KRN",19,13010,1,1,0)
This option is essentially the same report as that produced by the
"KRN",19,13010,1,2,0)
"Recall List Print" [SDRR PATIENT LIST], except it also reports
"KRN",19,13010,1,3,0)
on slot availability by month for each clinic.  The user is asked for a
"KRN",19,13010,1,4,0)
date range, a set of clinics, and whether the report should page break on
"KRN",19,13010,1,5,0)
clinic.  It reports on patients who are on the RECALL LIST.
"KRN",19,13010,25)
EN^SDRRISRL
"KRN",19,13010,99.1)
60939,32806
"KRN",19,13010,"U")
RECALL LIST W/AVAILABLE SLOTS
"KRN",19,13011,-1)
0^9
"KRN",19,13011,0)
SDRR PATIENT LIST^Recall List Print^^R^^^^^^^^SCHEDULING
"KRN",19,13011,1,0)
^^3^3^3090817^
"KRN",19,13011,1,1,0)
This menu allows users to print Recall Reminders by division, clinic or 
"KRN",19,13011,1,2,0)
Recall Reminder teams. It will ask for a date range and must be 
"KRN",19,13011,1,3,0)
queued to a printer.
"KRN",19,13011,25)
SDRRCRR
"KRN",19,13011,"U")
RECALL LIST PRINT
"KRN",19,13012,-1)
0^11
"KRN",19,13012,0)
SDRR PRINT MENU^Clinic Recall Print Menu^^R^^SDRR MANAGER^^^^^^SCHEDULING
"KRN",19,13012,1,0)
^^2^2^3090817^
"KRN",19,13012,1,1,0)
This menu allows users to print either Recall Letters or Cards for
"KRN",19,13012,1,2,0)
patients who have been entered into the Recall Reminders file.
"KRN",19,13012,25)
SDRRLRP
"KRN",19,13012,"U")
CLINIC RECALL PRINT MENU
"KRN",19,13013,-1)
0^12
"KRN",19,13013,0)
SDRR TASK JOB^Auto Print for Recall Reminder^^R^^^^^^^^SCHEDULING
"KRN",19,13013,1,0)
^^2^2^3090817^
"KRN",19,13013,1,1,0)
This option should be queued to print every night. It does not need to be
"KRN",19,13013,1,2,0)
queued to a device.
"KRN",19,13013,25)
SDRRTSK
"KRN",19,13013,200.9)
y
"KRN",19,13013,"U")
AUTO PRINT FOR RECALL REMINDER
"KRN",19,13014,-1)
0^17
"KRN",19,13014,0)
SDRR MANAGER MENU^Manager menu for Recall Reminder^^M^^SDRR MANAGER^^^^^^SCHEDULING
"KRN",19,13014,1,0)
^^2^2^3090817^
"KRN",19,13014,1,1,0)
This menu will be locked with SDRR MANAGER Key.  This menu will house 
"KRN",19,13014,1,2,0)
all options for setting up Recall Reminder.
"KRN",19,13014,10,0)
^19.01IP^14^14
"KRN",19,13014,10,8,0)
13006^1^1
"KRN",19,13014,10,8,"^")
SDRR CONVERT ENTRIES
"KRN",19,13014,10,10,0)
13015^3^3
"KRN",19,13014,10,10,"^")
SDRR ADD RECALL TEAM
"KRN",19,13014,10,11,0)
13016^5^5
"KRN",19,13014,10,11,"^")
SDRR ADD RECALL PROVIDER
"KRN",19,13014,10,12,0)
13017^6^6
"KRN",19,13014,10,12,"^")
SDRR CLINIC LETTER
"KRN",19,13014,10,13,0)
13018^4^4
"KRN",19,13014,10,13,"^")
SDRR APPT TYPE
"KRN",19,13014,10,14,0)
13019^2^2
"KRN",19,13014,10,14,"^")
SDRR RECALL REMINDER PARAMS
"KRN",19,13014,99)
61598,46600
"KRN",19,13014,99.1)
60982,17440
"KRN",19,13014,"U")
MANAGER MENU FOR RECALL REMIND
"KRN",19,13015,-1)
0^14
"KRN",19,13015,0)
SDRR ADD RECALL TEAM^Edit/Add Recall Teams^^E^^^^^^^^SCHEDULING^^1^1
"KRN",19,13015,1,0)
^^1^1^3090817^
"KRN",19,13015,1,1,0)
Will be used to add or edit team names for the Recall Reminder software. 
"KRN",19,13015,15)
K DLAYGO
"KRN",19,13015,20)
S DLAYGO=403.55
"KRN",19,13015,30)
SD(403.55,
"KRN",19,13015,31)
AEMQL
"KRN",19,13015,32)
Select Recall Reminder Team: 
"KRN",19,13015,50)
SD(403.55,
"KRN",19,13015,51)
[SDRR TEAM NAMES]
"KRN",19,13015,"U")
EDIT/ADD RECALL TEAMS
"KRN",19,13016,-1)
0^13
"KRN",19,13016,0)
SDRR ADD RECALL PROVIDER^Edit/Add Clinic Recall Provider^^E^^^^^^^^SCHEDULING^^1^1
"KRN",19,13016,1,0)
^^1^1^3090825^
"KRN",19,13016,1,1,0)
This option will allow for enter/edit of Recall Reminder Providers.
"KRN",19,13016,15)
K DLAYGO
"KRN",19,13016,20)
S DLAYGO=403.54
"KRN",19,13016,30)
SD(403.54,
"KRN",19,13016,31)
AEMQL
"KRN",19,13016,50)
SD(403.54,
"KRN",19,13016,51)
[SDRR ADD PROVIDER]
"KRN",19,13016,99.1)
57776,382
"KRN",19,13016,"U")
EDIT/ADD CLINIC RECALL PROVIDE
"KRN",19,13017,-1)
0^16
"KRN",19,13017,0)
SDRR CLINIC LETTER^Enter/Edit Clinic Letters^^E^^^^^^^^SCHEDULING^^1^1
"KRN",19,13017,1,0)
^^3^3^3090817^
"KRN",19,13017,1,1,0)
If you have setup a Clinic Recall entry with the Letter type as 
"KRN",19,13017,1,2,0)
notification, you will need to enter the letter text using this option.  
"KRN",19,13017,1,3,0)
You can refer to the clinic within the text or enter generic text format.
"KRN",19,13017,15)
K DLAYGO
"KRN",19,13017,20)
S DLAYGO=403.52
"KRN",19,13017,30)
SD(403.52,
"KRN",19,13017,31)
AEMQL
"KRN",19,13017,50)
SD(403.52,
"KRN",19,13017,51)
[SDRR ADD LETTERS]
"KRN",19,13017,"U")
ENTER/EDIT CLINIC LETTERS
"KRN",19,13018,-1)
0^15
"KRN",19,13018,0)
SDRR APPT TYPE^Enter/Edit Appt Types^^E^^^^^^^^SCHEDULING^^1
"KRN",19,13018,1,0)
^^3^3^3090817^
"KRN",19,13018,1,1,0)
Recall Appt types are used in viewing recall information on the CPRS
"KRN",19,13018,1,2,0)
cover sheet.  This information also shows during Recall Patient Inquiry
"KRN",19,13018,1,3,0)
and on reports.  DELETION OF ENTRIES IS NOT ALLOWED.
"KRN",19,13018,20)
S DLAYGO=403.51
"KRN",19,13018,30)
SD(403.51,
"KRN",19,13018,31)
AEMQL
"KRN",19,13018,50)
SD(403.51,
"KRN",19,13018,51)
[SDRR APPT TYPE]
"KRN",19,13018,"U")
ENTER/EDIT APPT TYPES
"KRN",19,13019,-1)
0^18
"KRN",19,13019,0)
SDRR RECALL REMINDER PARAMS^Enter/Edit Clinic Recall Site Params^^E^^^^^^^^SCHEDULING^^1^1
"KRN",19,13019,1,0)
^^1^1^3090817^
"KRN",19,13019,1,1,0)
This option will allow a site to set up the Recall Reminder software.
"KRN",19,13019,15)
K DLAYGO
"KRN",19,13019,20)
S DLAYGO=403.53
"KRN",19,13019,30)
SD(403.53,
"KRN",19,13019,31)
AEMQL
"KRN",19,13019,50)
SD(403.53,
"KRN",19,13019,51)
[SDRR PARAMS ENTER]
"KRN",19,13019,"U")
ENTER/EDIT CLINIC RECALL SITE 
"KRN",19,13020,-1)
0^26
"KRN",19,13020,0)
SDRR PATIENT INQUIRY^Recall Patient Inquiry^^R^^^^^^^^SCHEDULING^^1
"KRN",19,13020,1,0)
^^1^1^3080404^
"KRN",19,13020,1,1,0)
Allows for range or full patient inquiry.
"KRN",19,13020,20)
K DIC
"KRN",19,13020,25)
EN^SDRRINQ
"KRN",19,13020,"U")
RECALL PATIENT INQUIRY
"KRN",19,13021,-1)
0^25
"KRN",19,13021,0)
SDRR IRM MENU^Conversion Menu^^M^^XUPROG^^^^^^SCHEDULING
"KRN",19,13021,1,0)
^^3^3^3090817^
"KRN",19,13021,1,1,0)
This menu has all items for converting older versions of Clinic Recall 
"KRN",19,13021,1,2,0)
into the national version of Recall Reminder.  Options should only be run 
"KRN",19,13021,1,3,0)
once then put out of order.
"KRN",19,13021,10,0)
^19.01IP^5^5
"KRN",19,13021,10,1,0)
13022^1^1
"KRN",19,13021,10,1,"^")
SDRR CONVERSION PARAMS FILE
"KRN",19,13021,10,2,0)
13024^2^2
"KRN",19,13021,10,2,"^")
SDRR CON RECALL APPT TYPES
"KRN",19,13021,10,3,0)
13023^3^3
"KRN",19,13021,10,3,"^")
SDRR CONVERSION TEAM FILE
"KRN",19,13021,10,4,0)
13025^4^4
"KRN",19,13021,10,4,"^")
SDRR CONVERSION PROVIDER FILE
"KRN",19,13021,10,5,0)
13026^5^5
"KRN",19,13021,10,5,"^")
SDRR CONV OUTPATIENT RECALL
"KRN",19,13021,99)
61598,46600
"KRN",19,13021,"U")
CONVERSION MENU
"KRN",19,13022,-1)
0^22
"KRN",19,13022,0)
SDRR CONVERSION PARAMS FILE^Convert OUTPATIENT CLINIC RECALL PARAM^^R^^^^^^^^SCHEDULING
"KRN",19,13022,1,0)
^^2^2^3090817^
"KRN",19,13022,1,1,0)
If there is an OUTPATIENT CLINIC RECALL PARAM file, will convert to RECALL 
"KRN",19,13022,1,2,0)
REMINDERS PARAMETERS.
"KRN",19,13022,25)
ENV^SDRRC16
"KRN",19,13022,"U")
CONVERT OUTPATIENT CLINIC RECA
"KRN",19,13023,-1)
0^24
"KRN",19,13023,0)
SDRR CONVERSION TEAM FILE^Convert OUTPATIENT CLINIC RECALL TEAM^^R^^^^^^^^SCHEDULING
"KRN",19,13023,1,0)
^^1^1^3080407^
"KRN",19,13023,1,1,0)
Convert OUTPATIENT CLINIC RECALL TEAM to RECALL REMINDERS TEAM.
"KRN",19,13023,25)
ENV^SDRRC15
"KRN",19,13023,"U")
CONVERT OUTPATIENT CLINIC RECA
"KRN",19,13024,-1)
0^20
"KRN",19,13024,0)
SDRR CON RECALL APPT TYPES^Convert OUTPATIENT CLINIC RECALL APPT TYPES^^R^^^^^^^^SCHEDULING
"KRN",19,13024,1,0)
^^1^1^3080407^
"KRN",19,13024,1,1,0)
Convert OUTPATIENT CLINIC RECALL APPT TYPES to RECALL REMINDERS APPT TYPE.
"KRN",19,13024,25)
ENV^SDRRC17
"KRN",19,13024,"U")
CONVERT OUTPATIENT CLINIC RECA
"KRN",19,13025,-1)
0^23
"KRN",19,13025,0)
SDRR CONVERSION PROVIDER FILE^Convert OUTPATIENT CLINIC RECALL PROVIDERS^^R^^^^^^^^SCHEDULING
"KRN",19,13025,1,0)
^^2^2^3080407^
"KRN",19,13025,1,1,0)
Convert OUTPATIENT CLINIC RECALL PROVIDERS to RECALL REMINDERS PROVIDERS 
"KRN",19,13025,1,2,0)
file.
"KRN",19,13025,25)
ENV^SDRRC18
"KRN",19,13025,"U")
CONVERT OUTPATIENT CLINIC RECA
"KRN",19,13026,-1)
0^21
"KRN",19,13026,0)
SDRR CONV OUTPATIENT RECALL^Convert OUTPATIENT CLINIC RECALL^^R^^^^^^^^SCHEDULING
"KRN",19,13026,1,0)
^^1^1^3080407^
"KRN",19,13026,1,1,0)
Convert OUTPATIENT CLINIC RECALL to RECALL REMINDERS file.
"KRN",19,13026,25)
ENV^SDRRC20
"KRN",19,13026,"U")
CONVERT OUTPATIENT CLINIC RECA
"KRN",19,13027,-1)
0^27
"KRN",19,13027,0)
SDRR TASK JOB CARD^Auto Print for Recall Reminder Cards^^R^^^^^^^^
"KRN",19,13027,1,0)
^^2^2^3090817^
"KRN",19,13027,1,1,0)
This option should be queued to print every night if your facility will be
"KRN",19,13027,1,2,0)
using Recall cards.  It does not need to be queued to a device.
"KRN",19,13027,25)
SDRRTSK1
"KRN",19,13027,"U")
AUTO PRINT FOR RECALL REMINDER
"KRN",19.1,542,-1)
0^1
"KRN",19.1,542,0)
SDRR MANAGER^Recall Reminder Manager Key
"KRN",19.1,542,1,0)
^^1^1^3080222^
"KRN",19.1,542,1,1,0)
This key in lock all SDRR manager options.
"KRN",101,4650,-1)
0^1
"KRN",101,4650,0)
SDRR EVENT^Recall Reminder Action^^A^^^^^^^^
"KRN",101,4650,1,0)
^^3^3^3080227^
"KRN",101,4650,1,1,0)
This protocol will hang off SDAM menu - it is used for the RECALL REMINDER
"KRN",101,4650,1,2,0)
project. This protocol will allow for user to enter or edit information 
"KRN",101,4650,1,3,0)
that has been stored in the RECALL REMINDERS file.
"KRN",101,4650,20)
D SDAM^SDRR1
"KRN",101,4650,99)
61598,46599
"MBREQ")
0
"ORD",3,19.1)
19.1;3;;;KEY^XPDTA1;KEYF1^XPDIA1;KEYE1^XPDIA1;KEYF2^XPDIA1;;KEYDEL^XPDIA1
"ORD",3,19.1,0)
SECURITY KEY
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",11,3.8)
3.8;11;;;MAILG^XPDTA1;MAILGF1^XPDIA1;MAILGE1^XPDIA1;MAILGF2^XPDIA1;;MAILGDEL^XPDIA1(%)
"ORD",11,3.8,0)
MAIL GROUP
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",16,-1)
1^1
"PKG",16,0)
SCHEDULING^SD^APPOINTMENTS,PROFILES,LETTERS,AMIS REPORTS
"PKG",16,20,0)
^9.402P^^
"PKG",16,22,0)
^9.49I^1^1
"PKG",16,22,1,0)
5.3^2930813
"PKG",16,22,1,"PAH",1,0)
536^3090825^123456810
"PKG",16,22,1,"PAH",1,1,0)
^^1^1^3090825
"PKG",16,22,1,"PAH",1,1,1,0)
See National Patch Module, SD*5.3*536
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
33
"RTN","SDRR1")
0^1^B13934931
"RTN","SDRR1",1,0)
SDRR1   ;10N20/MAH ;RECALL REMINDER ENTER EDIT 7/28/04
"RTN","SDRR1",2,0)
 ;;5.3;Scheduling;**536**;Aug 13, 1993;Build 53
"RTN","SDRR1",3,0)
EN ;Entry point
"RTN","SDRR1",4,0)
 ;Tag STR will determine if the patient has already been enter into open access
"RTN","SDRR1",5,0)
 ;This routine is SDRRCLR EVENT protocol which is put on to SDAM MENU
"RTN","SDRR1",6,0)
 ;protocol
"RTN","SDRR1",7,0)
 ;This routine does not kill off DFN
"RTN","SDRR1",8,0)
STR(SDFN) ;Start checking entries in 403.5 if there is a "b" goes to update - if not goes to NEW   
"RTN","SDRR1",9,0)
 N I,Y,CLINIC,C,D,KEY,KY,COMM
"RTN","SDRR1",10,0)
 S DFN=SDFN
"RTN","SDRR1",11,0)
 I '$D(^SD(403.5,"B",DFN)) W !,"No Clinic Recall on file",! S DIR(0)="Y",DIR("A")="Are you sure you want to add a Recall entry ",DIR("B")="NO" D ^DIR I Y'=1 G QUIT
"RTN","SDRR1",12,0)
 I $G(Y)>0 I '$D(^SD(403.5,"B",DFN)) G NEW
"RTN","SDRR1",13,0)
EN1 S C=0 F I=0:0 S I=$O(^SD(403.5,"B",DFN,I)) Q:'I  I $D(^SD(403.5,I,0)) S D=^(0),C=C+1 S ^TMP("SDRRCLR",$J,C)=I_"^"_D
"RTN","SDRR1",14,0)
 S (ER,OK)=0 W !,"CHOOSE FROM:" F I=0:0 S I=$O(^TMP("SDRRCLR",$J,I)) Q:'I   S CLINIC=$P($G(^TMP("SDRRCLR",$J,I)),"^",3) D
"RTN","SDRR1",15,0)
 .W !,$J(I,4),">  "
"RTN","SDRR1",16,0)
 .I CLINIC'="" S CLINIC=$$GET1^DIQ(44,CLINIC_",",.01)
"RTN","SDRR1",17,0)
 .I CLINIC="" S CLINIC="UNK. CLINIC"
"RTN","SDRR1",18,0)
 .S PROV=$P($G(^TMP("SDRRCLR",$J,I)),"^",6) I PROV'="" S PROV=$P($G(^SD(403.54,PROV,0)),"^",1) I PROV'="" S PROV=$$NAME^XUSER(PROV,"F")
"RTN","SDRR1",19,0)
 .I PROV="" S PROV="UNK. PROVIDER"
"RTN","SDRR1",20,0)
 .S RDT=$P(^TMP("SDRRCLR",$J,I),"^",7) S Y=RDT D DD^%DT S RDT=Y
"RTN","SDRR1",21,0)
 .S RS=$P(^TMP("SDRRCLR",$J,I),"^",11) S Y=RS D DD^%DT S RS=Y
"RTN","SDRR1",22,0)
 .S COMM="",COMM=$P(^TMP("SDRRCLR",$J,I),"^",8)
"RTN","SDRR1",23,0)
 .W "CLINIC:"_$E(CLINIC,1,15),?28," R/DATE:"_RDT,?53," NOTICE SENT:"_RS
"RTN","SDRR1",24,0)
 .W !,?5,"PROVIDER:"_$E(PROV,1,20) S Z=I I $G(COMM)]"" W !,?5,$G(COMM) S Z=I
"RTN","SDRR1",25,0)
 W !,"CHOOSE 1-",Z_" OR TYPE ""A"" TO ADD:" W:$D(^TMP("SDRRCLR",$J,I+1)) !,"OR '^' TO QUIT" W ": " R X:DTIME I $S('$T!(X["^"):1,X="":1,1:0) S ER=1 G QUIT
"RTN","SDRR1",26,0)
 ;CHECK PARAM IF NEEDED
"RTN","SDRR1",27,0)
 G QUIT:ER
"RTN","SDRR1",28,0)
 I X["A" G NEW
"RTN","SDRR1",29,0)
 S DA=$P($G(^TMP("SDRRCLR",$J,X)),"^",1) I DA="" K DA,C,CLINIC,PROV,RDT G EN1
"RTN","SDRR1",30,0)
 S (PROV1,KEY,FLAG)="" S PROV1=$P($G(^SD(403.5,DA,0)),"^",5) I PROV1'="" S KEY=$P($G(^SD(403.54,PROV1,0)),"^",7) D
"RTN","SDRR1",31,0)
 .I PROV1="" Q
"RTN","SDRR1",32,0)
 .I KEY="" Q
"RTN","SDRR1",33,0)
 .N VALUE
"RTN","SDRR1",34,0)
 .S VALUE=$$LKUP^XPDKEY(KEY) K KY D OWNSKEY^XUSRB(.KY,VALUE,DUZ)
"RTN","SDRR1",35,0)
 .I $P(KY(0),"^",1)=0 W !,?25,"**YOU DO NOT HAVE ACCESS TO THIS ENTRY**",!,?12,"PLEASE CHECK WITH YOUR ADPAC OR IRM TO GET THE PROPER SECURITY KEY" R X:3 K KEY,PROV1 D QUIT S FLAG=1
"RTN","SDRR1",36,0)
 .Q
"RTN","SDRR1",37,0)
 I FLAG=1 K FLAG Q
"RTN","SDRR1",38,0)
 ;END OF NEW CHANGE
"RTN","SDRR1",39,0)
 G UPDATE
"RTN","SDRR1",40,0)
 Q
"RTN","SDRR1",41,0)
 ;
"RTN","SDRR1",42,0)
NEW ;Adds new entry
"RTN","SDRR1",43,0)
 W !!,"*Must have Recall Date,approved Recall Clinic,Recall Provider and Type of Recall"
"RTN","SDRR1",44,0)
 S DIR(0)="Y",DIR("A")="Do you have this information",DIR("B")="NO" D ^DIR I Y'=1 G QUIT
"RTN","SDRR1",45,0)
 S (DIC,DIE)="^SD(403.5,",DIC(0)="LZ",X=DFN,DLAYGO=403.5 D FILE^DICN S NUM=+Y
"RTN","SDRR1",46,0)
 S DA=NUM,DR="[SDRR RECALL CARD ADD]",DIE("NO^")="Not Allowed" D ^DIE
"RTN","SDRR1",47,0)
 K DIC,DIE,DR,D0,DA,DLAYGO,NUM,PROV,X,Y,Z,OK,RDT,CLINIC,RS,KEY,COMM,DIR
"RTN","SDRR1",48,0)
 K ^TMP("SDRRCLR",$J)
"RTN","SDRR1",49,0)
 Q
"RTN","SDRR1",50,0)
UPDATE ;Asks for new data
"RTN","SDRR1",51,0)
 K DIC,DIE,DR S DIE="^SD(403.5,",DR="[SDRR RECALL CARD ADD]",DIE("NO^")="BACKOUTOK" D ^DIE
"RTN","SDRR1",52,0)
 K DIC,DIE,DR,D0,DA,DLAYGO,NUM,PROV,X,Y,Z,OK,RDT,CLINIC,RS,KEY,COMM
"RTN","SDRR1",53,0)
 D QUIT
"RTN","SDRR1",54,0)
 Q
"RTN","SDRR1",55,0)
SDAM ;Entry Point for Appointment Management protocol
"RTN","SDRR1",56,0)
 N ORACTION,ORVP,XQORQUIT,SDAMERR,SDCOAP,VALMY
"RTN","SDRR1",57,0)
 S VALMBCK=""
"RTN","SDRR1",58,0)
 D FULL^VALM1
"RTN","SDRR1",59,0)
 I SDAMTYP="P" W !!,VALMHDR(1),! D STR(SDFN)
"RTN","SDRR1",60,0)
 I SDAMTYP="C" D
"RTN","SDRR1",61,0)
 .D EN^VALM2(XQORNOD(0))
"RTN","SDRR1",62,0)
 .S SDCOAP=0 F  S SDCOAP=$O(VALMY(SDCOAP)) Q:'SDCOAP  D
"RTN","SDRR1",63,0)
 ..I $D(^TMP("SDAMIDX",$J,SDCOAP)) K SDAT S SDAT=^(SDCOAP) D
"RTN","SDRR1",64,0)
 ...W !!,^TMP("SDAM",$J,+SDAT,0),!
"RTN","SDRR1",65,0)
 ...D STR(+$P(SDAT,"^",2))
"RTN","SDRR1",66,0)
 S VALMBCK="R"
"RTN","SDRR1",67,0)
QUIT K PROV,CLINIC,X,Y,C,D,ER,OK,PROV1,KEY,RS,FLAG,DIR,DFN,DIR
"RTN","SDRR1",68,0)
 K ^TMP("SDRRCLR",$J)
"RTN","SDRR1",69,0)
 Q
"RTN","SDRR5")
0^2^B9146765
"RTN","SDRR5",1,0)
SDRR5 ;10N20/MAH; RECALL REMINDER Remove and Replace Providers and Clinics; 01/22/2008
"RTN","SDRR5",2,0)
 ;;5.3;Scheduling;**536**;Aug 13, 1993;Build 53
"RTN","SDRR5",3,0)
 ;This routine was written per requests from VISN20 sites
"RTN","SDRR5",4,0)
 ;^SD(403.5 -- RECALL REMINDERS FILE
"RTN","SDRR5",5,0)
 ;403.54 -- RECALL REMINDERS PROVIDERS FILE
"RTN","SDRR5",6,0)
 ;44 -- HOSPITAL LOCATION FILE
"RTN","SDRR5",7,0)
 ;Used in option [SDRR CONVERT ENTRIES]
"RTN","SDRR5",8,0)
STRT S (NIEN,OIEN,SDT,EDT,OHIEN,NHIEN,FLAG,OLDC,NEWC)=""
"RTN","SDRR5",9,0)
 S DIC="^SD(403.54,",DIC(0)="AEQMZ",DIC("A")="Select Retiring Provider: " D ^DIC G:Y<0 QUIT S OIEN=+Y,OPROV=$P(^SD(403.54,OIEN,0),"^",1),SDRROLD=$$NAME^XUSER(OPROV,"F")
"RTN","SDRR5",10,0)
 S DIC="^SD(403.54,",DIC(0)="AEQMZ",DIC("A")="Select New Provider: " D ^DIC G:Y<0 QUIT S NIEN=+Y,OPROV=$P(^SD(403.54,NIEN,0),"^",1),SDRRNEW=$$NAME^XUSER(OPROV,"F")
"RTN","SDRR5",11,0)
 W !,?1,"Do you want to change Clinic names that the recall is pointed to: " S %=2 D YN^DICN I %=2 G SELDT
"RTN","SDRR5",12,0)
 K %
"RTN","SDRR5",13,0)
CLINC S DIC="^SC(",DIC(0)="AEQMZ",DIC("A")="Select Retiring Clinic: " D ^DIC G:Y<0 CLEAN S OHIEN=+Y,OLDC=$$GET1^DIQ(44,OHIEN_",",.01)
"RTN","SDRR5",14,0)
 S DIC="^SC(",DIC(0)="AEQMZ",DIC("A")="Select New Clinic: " D ^DIC G:Y<0 CLEAN S NHIEN=+Y,FLAG="C",NEWC=$$GET1^DIQ(44,NHIEN_",",.01)
"RTN","SDRR5",15,0)
CLEAN ;CLINIC NOT SELECTED BUT CHECK
"RTN","SDRR5",16,0)
 I FLAG'["C" W !,?1,"You have selected not to move clinic recall applications to a different clinic is this correct: " S %=2 D YN^DICN I %=2 G CLINC
"RTN","SDRR5",17,0)
SELDT S %DT="AEX",%DT("A")="Start with RECALL DATE: " D ^%DT Q:Y<0  S SDT=Y,%DT("A")="End with RECALL DATE: " D ^%DT I Y<SDT W $C(7),"  ??" G SELDT
"RTN","SDRR5",18,0)
 S EDT=Y S EDT=EDT_".9999"
"RTN","SDRR5",19,0)
 W !!,?5,"****You will be converting all Clinic Recalls for****"
"RTN","SDRR5",20,0)
 W !!,?3,SDRROLD_" -They will be converted to- "_SDRRNEW
"RTN","SDRR5",21,0)
 I NEWC'="" W !,?3,OLDC_" Clinic will be converted to "_NEWC_" Clinic"
"RTN","SDRR5",22,0)
 I FLAG["C" S D0=0 F  S D0=$O(^SD(403.5,"C",OIEN,D0)) Q:D0'>0  D
"RTN","SDRR5",23,0)
 .S RD=$P($G(^SD(403.5,D0,0)),"^",6) Q:RD<SDT!(RD>EDT)  S DIE="^SD(403.5," S DA=D0,DR="4///^S X=""`""_NIEN;4.5///^S X=""`""_NHIEN" D ^DIE K DIE,DR,DA
"RTN","SDRR5",24,0)
 I FLAG="" S D0=0 F  S D0=$O(^SD(403.5,"C",OIEN,D0)) Q:D0'>0  D
"RTN","SDRR5",25,0)
 .S RD=$P($G(^SD(403.5,D0,0)),"^",6) Q:RD<SDT!(RD>EDT)  S DIE="^SD(403.5," S DA=D0,DR="4///^S X=""`""_NIEN" D ^DIE K DIE,DR,DA
"RTN","SDRR5",26,0)
QUIT K Y,OIEN,NIEN,FLAG,OPROV,SDT,RD,EDT,SDRRNEW,SDRROLD,D0,NEWC,NHIEN,OHIEN,OLDC,X,DIC,FLAG,%DT
"RTN","SDRRC15")
0^3^B35948677
"RTN","SDRRC15",1,0)
SDRRC15 ;10N20/MAH - POST-INSTALL FOR PATCH SD*5.3*536 CONVERT TEAM FILE ; 3/01/2008 12:24pm
"RTN","SDRRC15",2,0)
 ;;5.3;Scheduling;**536**;Aug 13, 1993;Build 53
"RTN","SDRRC15",3,0)
 ;;SDRR-RECALL REMINDER
"RTN","SDRRC15",4,0)
 Q
"RTN","SDRRC15",5,0)
ENV ;Environment check
"RTN","SDRRC15",6,0)
 K ^XTMP("SDRRC15")
"RTN","SDRRC15",7,0)
 S XPDABORT=""
"RTN","SDRRC15",8,0)
 ;checks programmer variables
"RTN","SDRRC15",9,0)
 D PROGCHK(.XPDABORT)
"RTN","SDRRC15",10,0)
 ;check if install is running
"RTN","SDRRC15",11,0)
 D ISRUNING(.XPDABORT)
"RTN","SDRRC15",12,0)
 I XPDABORT="" K XPDABORT
"RTN","SDRRC15",13,0)
POST ;Check for Clinic Recall Teams file)
"RTN","SDRRC15",14,0)
 I '$D(^DIZ(190004)) D  Q
"RTN","SDRRC15",15,0)
 . D NOFILE
"RTN","SDRRC15",16,0)
 D TASK
"RTN","SDRRC15",17,0)
 Q
"RTN","SDRRC15",18,0)
START ;Background job entry point
"RTN","SDRRC15",19,0)
 N SDAIEN,SDANUSB,SDX,SDFDAIEN,SDARAY,SDERAY,SDSAVE,SDRRREC,SDRRFDA
"RTN","SDRRC15",20,0)
 N SDTOT,SDTOT2,SDTOT3,SDENCPTR,SDCKCNT,SDRRSTOP,SDENT,SDFIL,DFN,TEAM,TOTAL
"RTN","SDRRC15",21,0)
 S TOTAL=0
"RTN","SDRRC15",22,0)
 D XTMP
"RTN","SDRRC15",23,0)
 ;seed var's if Re-Run
"RTN","SDRRC15",24,0)
 I $D(^XTMP("SDRRC15","TOT")) D
"RTN","SDRRC15",25,0)
 . S SDTOT=+$G(^XTMP("SDRRC15","TOT"))
"RTN","SDRRC15",26,0)
 . S (SDSAVE,SDAIEN)=+$G(^XTMP("SDRRC15","TEAM"))
"RTN","SDRRC15",27,0)
 E  D
"RTN","SDRRC15",28,0)
 . S SDAIEN=0 F  S SDAIEN=$O(^DIZ(190004,SDAIEN)) Q:SDAIEN<1  S SDRRREC=$G(^DIZ(190004,SDAIEN,0)) D
"RTN","SDRRC15",29,0)
 ..S SDRRFDA(403.55,"+1,",.01)=$P(SDRRREC,U,1)
"RTN","SDRRC15",30,0)
 ..S SDRRFDA(403.55,"+1,",1)=$P(SDRRREC,U,2)
"RTN","SDRRC15",31,0)
 ..I $P($G(SDRRREC),U,3)'="" S SDRRFDA(403.55,"+1,",2)=$P($G(SDRRREC),U,3)
"RTN","SDRRC15",32,0)
 ..I $P($G(SDRRREC),U,4)'="" S SDRRFDA(403.55,"+1,",3)=$P($G(SDRRREC),U,4)
"RTN","SDRRC15",33,0)
 ..N NEWREC S NEWREC(1)=SDAIEN
"RTN","SDRRC15",34,0)
 ..D UPDATE^DIE("","SDRRFDA","NEWREC")
"RTN","SDRRC15",35,0)
 ..S TOTAL=TOTAL+1
"RTN","SDRRC15",36,0)
 S ^XTMP("SDRRC15","COMPLETED")=$$NOW^XLFDT()
"RTN","SDRRC15",37,0)
 S ^XTMP("SDRRC15","TOT")=TOTAL
"RTN","SDRRC15",38,0)
 K ^XTMP("SDRRC15","RUNNING")
"RTN","SDRRC15",39,0)
 D SENDMSG
"RTN","SDRRC15",40,0)
 Q
"RTN","SDRRC15",41,0)
SENDMSG ;send MailMan msg to patch installer
"RTN","SDRRC15",42,0)
 N DIFROM,SDMSG,SDTXT,SDLN,XMY,XMDUZ,XMSUB,XMTEXT,XMDUN,XMZ
"RTN","SDRRC15",43,0)
 K ^TMP("SDRRC15",$J)
"RTN","SDRRC15",44,0)
 S XMSUB="SD*5.3*536 OUTPATIENT CLINIC TEAM FILE CONVERSION REPORT"
"RTN","SDRRC15",45,0)
 S XMTEXT="^TMP(""SDRRC15"",$J,",XMDUZ=.5,(XMY(DUZ),XMY(XMDUZ))=""
"RTN","SDRRC15",46,0)
 S SDLN=0
"RTN","SDRRC15",47,0)
 D ADD(.SDLN,"Patch:  SD*5.3*536 RECALL REMINDER TEAM FILE CONVERSION PROCESSING")
"RTN","SDRRC15",48,0)
 D ADD(.SDLN," "),ADD(.SDLN,"************")
"RTN","SDRRC15",49,0)
 D ADD(.SDLN,"The existing Class III file called OUTPATIENT CLINIC RECALL TEAM (190004), ")
"RTN","SDRRC15",50,0)
 D ADD(.SDLN,"which contains Clinic Recall Team Names have been converted to")
"RTN","SDRRC15",51,0)
 D ADD(.SDLN,"a new Class I file called Recall Reminder Team (403.55)")
"RTN","SDRRC15",52,0)
 D ADD(.SDLN,"which will provide the same functionality.")
"RTN","SDRRC15",53,0)
 D ADD(.SDLN,"************"),ADD(.SDLN," "),ADD(.SDLN," ")
"RTN","SDRRC15",54,0)
 D ADD(.SDLN,"SUMMARY OF PROCESSING RESULTS:")
"RTN","SDRRC15",55,0)
 D ADD(.SDLN,"==============================")
"RTN","SDRRC15",56,0)
 D ADD(.SDLN," ")
"RTN","SDRRC15",57,0)
 D ADD(.SDLN,"<<< The Class III OUTPATIENT CLINIC RECALL TEAM File Conversion has "_$S(+$G(SDRRSTOP):"NOT ",1:"")_"Completed. >>>")
"RTN","SDRRC15",58,0)
 I +$G(SDRRSTOP) D
"RTN","SDRRC15",59,0)
 . D ADD(.SDLN,"    Please restart the post-install process from the following")
"RTN","SDRRC15",60,0)
 . D ADD(.SDLN,"    programmer's prompt:")
"RTN","SDRRC15",61,0)
 . D ADD(.SDLN,"                          D POST^SDRRC15")
"RTN","SDRRC15",62,0)
 D ADD(.SDLN," "),ADD(.SDLN," ")
"RTN","SDRRC15",63,0)
 D ADD(.SDLN,"  DATE/TIME TASK STARTED: "_$$FMTE^XLFDT(+$G(^XTMP("SDRRC15","START")),"P"))
"RTN","SDRRC15",64,0)
 D ADD(.SDLN,"DATE/TIME TASK COMPLETED: "_$$FMTE^XLFDT(+$G(^XTMP("SDRRC15","COMPLETED")),"P"))
"RTN","SDRRC15",65,0)
 I $D(^XTMP("SDRRC15","LAST RUN")) D
"RTN","SDRRC15",66,0)
 . D ADD(.SDLN,"      DATE/TIME LAST RUN: "_$$FMTE^XLFDT(+$G(^XTMP("SDRRC15","LAST RUN")),"P"))
"RTN","SDRRC15",67,0)
 D ADD(.SDLN," "),ADD(.SDLN," ")
"RTN","SDRRC15",68,0)
 D ADD(.SDLN,"    TOTAL RECORDS THAT HAVE BEEN CONVERTED: "_+$G(^XTMP("SDRRC15","TOT")))
"RTN","SDRRC15",69,0)
 D ADD(.SDLN,"                         <END OF REPORT> :")
"RTN","SDRRC15",70,0)
 D ^XMD
"RTN","SDRRC15",71,0)
 K ^TMP("SDRRC15",$J)
"RTN","SDRRC15",72,0)
 Q
"RTN","SDRRC15",73,0)
ADD(SDLN,SDTXT) ;add line
"RTN","SDRRC15",74,0)
 Q:$L(SDTXT)'>0
"RTN","SDRRC15",75,0)
 S SDLN=$G(SDLN)+1
"RTN","SDRRC15",76,0)
 S ^TMP("SDRRC15",$J,SDLN)=SDTXT
"RTN","SDRRC15",77,0)
 Q
"RTN","SDRRC15",78,0)
PROGCHK(XPDABORT) ;checks programmer variables
"RTN","SDRRC15",79,0)
 I '$G(DUZ)!($G(DUZ(0))'="@")!('$G(DT))!($G(U)'="^") D
"RTN","SDRRC15",80,0)
 . D BMES^XPDUTL("******")
"RTN","SDRRC15",81,0)
 . D MES^XPDUTL("Your programming variables are not set up properly.")
"RTN","SDRRC15",82,0)
 . D MES^XPDUTL("Installation aborted.")
"RTN","SDRRC15",83,0)
 . D MES^XPDUTL("******")
"RTN","SDRRC15",84,0)
 . S XPDABORT=2
"RTN","SDRRC15",85,0)
 Q
"RTN","SDRRC15",86,0)
ISRUNING(XPDABORT) ;check if running
"RTN","SDRRC15",87,0)
 I +$G(^XTMP("SDRRC15","RUNNING")) D
"RTN","SDRRC15",88,0)
 . D BMES^XPDUTL("******")
"RTN","SDRRC15",89,0)
 . D MES^XPDUTL("This patch is currently being Installed.  Try later.")
"RTN","SDRRC15",90,0)
 . D MES^XPDUTL("Installation aborted...")
"RTN","SDRRC15",91,0)
 . D MES^XPDUTL("******")
"RTN","SDRRC15",92,0)
 . S XPDABORT=2
"RTN","SDRRC15",93,0)
 Q
"RTN","SDRRC15",94,0)
NOFILE ;no File
"RTN","SDRRC15",95,0)
 D BMES^XPDUTL("******")
"RTN","SDRRC15",96,0)
 D MES^XPDUTL("The Class III Outpatient Clinic Recall Team File Conversion is NOT necessary because")
"RTN","SDRRC15",97,0)
 D MES^XPDUTL("file (#190004) does not exist on this system.")
"RTN","SDRRC15",98,0)
 D MES^XPDUTL("Post-Install process terminated...For conversion to Recall Reminder Team (#403.55)")
"RTN","SDRRC15",99,0)
 D MES^XPDUTL("******")
"RTN","SDRRC15",100,0)
 Q
"RTN","SDRRC15",101,0)
TASK ;run TaskMan
"RTN","SDRRC15",102,0)
 N ZTSK,ZTDTH,ZTRTN,ZTDESC,ZTIO,ZTSAVE,ZTREQ,ZTSTOP,SDSTOP
"RTN","SDRRC15",103,0)
 S SDSTOP=+$G(^XTMP("SDRRC15","STOPPED"))
"RTN","SDRRC15",104,0)
 S ZTRTN="START^SDRRC15"
"RTN","SDRRC15",105,0)
 S ZTDESC="SD*5.3*536 RECALL REMINDER TEAM FILE CONVERSION PROCESSING"
"RTN","SDRRC15",106,0)
 S ZTIO="",ZTDTH=$H,ZTREQ="@",ZTSAVE("ZTREQ")=""
"RTN","SDRRC15",107,0)
 D ^%ZTLOAD
"RTN","SDRRC15",108,0)
 D BMES^XPDUTL("******")
"RTN","SDRRC15",109,0)
 I '$D(ZTSK) D
"RTN","SDRRC15",110,0)
 . D MES^XPDUTL("Unable to schedule TaskMan task to run the Class III (190004) File")
"RTN","SDRRC15",111,0)
 . D MES^XPDUTL("Conversion.")
"RTN","SDRRC15",112,0)
 . D BMES^XPDUTL("Please re-run Post-Install routine POST^SSDRRC15 from")
"RTN","SDRRC15",113,0)
 . D MES^XPDUTL("the programmer prompt.")
"RTN","SDRRC15",114,0)
 . ;
"RTN","SDRRC15",115,0)
 E  D
"RTN","SDRRC15",116,0)
 . D MES^XPDUTL("Task "_ZTSK_" has been "_$S(+SDSTOP:"Re-",1:"")_"started to run the Class III (190004) File")
"RTN","SDRRC15",117,0)
 . D MES^XPDUTL("Conversion.")
"RTN","SDRRC15",118,0)
 . I SDSTOP D
"RTN","SDRRC15",119,0)
 . . D MES^XPDUTL("  <<< The last task run was STOPPED on "_$$FMTE^XLFDT(SDSTOP,"P")_". >>>")
"RTN","SDRRC15",120,0)
 . D BMES^XPDUTL("You will receive a MailMan message when this task is completed")
"RTN","SDRRC15",121,0)
 . D MES^XPDUTL("or if it has been manually stopped.")
"RTN","SDRRC15",122,0)
 D MES^XPDUTL("******")
"RTN","SDRRC15",123,0)
 Q
"RTN","SDRRC15",124,0)
XTMP ;setup ^XTMP to control output for 90 days
"RTN","SDRRC15",125,0)
 I $D(^XTMP("SDRRC15",0)) D
"RTN","SDRRC15",126,0)
 . S ^XTMP("SDRRC15","LAST RUN")=$G(^XTMP("SDRRC15","START"))
"RTN","SDRRC15",127,0)
 E  D
"RTN","SDRRC15",128,0)
 . N SDX
"RTN","SDRRC15",129,0)
 . S SDX=$$FMADD^XLFDT($$NOW^XLFDT(),90)_U_$$NOW^XLFDT()
"RTN","SDRRC15",130,0)
 . S SDX=SDX_"^SD*5.3*536 RECALL REMINDER TEAM FILE CONVERSION PROCESSING"
"RTN","SDRRC15",131,0)
 . S ^XTMP("SDRRC15",0)=SDX
"RTN","SDRRC15",132,0)
 S ^XTMP("SDRRC15","START")=$$NOW^XLFDT()
"RTN","SDRRC15",133,0)
 S ^XTMP("SDRRC15","RUNNING")="1"
"RTN","SDRRC15",134,0)
 Q
"RTN","SDRRC15",135,0)
UPXTMP(SDENCPTR,NODE,SDENT) ;add to ^XTMP
"RTN","SDRRC15",136,0)
 ; Input:
"RTN","SDRRC15",137,0)
 ;       NODE - Unique subscript
"RTN","SDRRC15",138,0)
 ; Output: none
"RTN","SDRRC15",139,0)
 Q:'$G(SDENCPTR)
"RTN","SDRRC15",140,0)
 I $G(NODE)="" S NODE="UNKNOWN"
"RTN","SDRRC15",141,0)
 S ^XTMP("SDRRC15","TOT2",NODE,SDENCPTR)=$G(SDENT)
"RTN","SDRRC15",142,0)
 Q
"RTN","SDRRC16")
0^32^B36122202
"RTN","SDRRC16",1,0)
SDRRC16 ;10N20/MAH - POST-INSTALL FOR PATCH SD*5.3*536 CONVERT PARAMS FILE; 3/01/2008 12:24pm
"RTN","SDRRC16",2,0)
 ;;5.3;Scheduling;**536**;Aug 13, 1993;Build 53
"RTN","SDRRC16",3,0)
 ;;SDRR-RECALL REMINDER
"RTN","SDRRC16",4,0)
 Q
"RTN","SDRRC16",5,0)
ENV ;Environment check
"RTN","SDRRC16",6,0)
 K ^XTMP("SDRRC16")
"RTN","SDRRC16",7,0)
 S XPDABORT=""
"RTN","SDRRC16",8,0)
 ;checks programmer variables
"RTN","SDRRC16",9,0)
 D PROGCHK(.XPDABORT)
"RTN","SDRRC16",10,0)
 ;check if install is running
"RTN","SDRRC16",11,0)
 D ISRUNING(.XPDABORT)
"RTN","SDRRC16",12,0)
 I XPDABORT="" K XPDABORT
"RTN","SDRRC16",13,0)
POST ;Check for Clinic Recall PARAMS file)
"RTN","SDRRC16",14,0)
 I '$D(^DIZ(190004.1)) D  Q
"RTN","SDRRC16",15,0)
 . D NOFILE
"RTN","SDRRC16",16,0)
 D TASK
"RTN","SDRRC16",17,0)
 Q
"RTN","SDRRC16",18,0)
START ;Background job entry point
"RTN","SDRRC16",19,0)
 N SDAIEN,SDANUSB,SDX,SDFDAIEN,SDARAY,SDERAY,SDSAVE,SDRRREC,SDRRFDA,TOTAL
"RTN","SDRRC16",20,0)
 N SDTOT,SDENCPTR,SDCKCNT,SDRRSTOP,SDENT,SDFIL,PARAM
"RTN","SDRRC16",21,0)
 S TOTAL=0
"RTN","SDRRC16",22,0)
 D XTMP
"RTN","SDRRC16",23,0)
 ;seed var's if Re-Run
"RTN","SDRRC16",24,0)
 I $D(^XTMP("SDRRC16","TOT")) D
"RTN","SDRRC16",25,0)
 . S SDTOT=+$G(^XTMP("SDRRC16","TOT"))
"RTN","SDRRC16",26,0)
 . S (SDSAVE,SDAIEN)=+$G(^XTMP("SDRRC16","PARAM"))
"RTN","SDRRC16",27,0)
 E  D
"RTN","SDRRC16",28,0)
 . S SDAIEN=0 F  S SDAIEN=$O(^DIZ(190004.1,SDAIEN)) Q:SDAIEN<1  S SDRRREC=$G(^DIZ(190004.1,SDAIEN,0)) D
"RTN","SDRRC16",29,0)
 . .S SDRRFDA(403.53,"+1,",.01)=$P(SDRRREC,U,1)
"RTN","SDRRC16",30,0)
 . .S SDRRFDA(403.53,"+1,",1)=$P(SDRRREC,U,2)
"RTN","SDRRC16",31,0)
 . .I $P($G(SDRRREC),U,4)'="" S SDRRFDA(403.53,"+1,",3)=$P($G(SDRRREC),U,4)
"RTN","SDRRC16",32,0)
 . .I $P($G(SDRRREC),U,5)'="" S SDRRFDA(403.53,"+1,",4)=$P($G(SDRRREC),U,5)
"RTN","SDRRC16",33,0)
 . .N NEWREC S NEWREC(1)=SDAIEN
"RTN","SDRRC16",34,0)
 . .D UPDATE^DIE("","SDRRFDA","NEWREC","")
"RTN","SDRRC16",35,0)
 . .S TOTAL=TOTAL+1
"RTN","SDRRC16",36,0)
 S ^XTMP("SDRRC16","COMPLETED")=$$NOW^XLFDT()
"RTN","SDRRC16",37,0)
 S ^XTMP("SDRRC16","TOT")=TOTAL
"RTN","SDRRC16",38,0)
 K ^XTMP("SDRRC16","RUNNING")
"RTN","SDRRC16",39,0)
 D SENDMSG
"RTN","SDRRC16",40,0)
 Q
"RTN","SDRRC16",41,0)
SENDMSG ;send MailMan msg to patch installer
"RTN","SDRRC16",42,0)
 N DIFROM,SDMSG,SDTXT,SDLN,XMY,XMDUZ,XMSUB,XMTEXT,XMDUN,XMZ
"RTN","SDRRC16",43,0)
 K ^TMP("SDRRC16",$J)
"RTN","SDRRC16",44,0)
 S XMSUB="SD*5.3*536 OUTPATIENT CLINIC PARAM FILE CONVERSION REPORT"
"RTN","SDRRC16",45,0)
 S XMTEXT="^TMP(""SDRRC16"",$J,",XMDUZ=.5,(XMY(DUZ),XMY(XMDUZ))=""
"RTN","SDRRC16",46,0)
 S SDLN=0
"RTN","SDRRC16",47,0)
 D ADD(.SDLN,"Patch:  SD*5.3*536 RECALL REMINDER TEAM FILE CONVERSION PROCESSING")
"RTN","SDRRC16",48,0)
 D ADD(.SDLN," "),ADD(.SDLN,"************")
"RTN","SDRRC16",49,0)
 D ADD(.SDLN,"The existing Class III file called OUTPATIENT CLINIC RECALL PARAM (190004.1), ")
"RTN","SDRRC16",50,0)
 D ADD(.SDLN,"which contains Clinic Recall params have been converted to")
"RTN","SDRRC16",51,0)
 D ADD(.SDLN,"a new Class I file called Recall Reminder Parameters (403.53)")
"RTN","SDRRC16",52,0)
 D ADD(.SDLN,"which will provide the same functionality.")
"RTN","SDRRC16",53,0)
 D ADD(.SDLN,"************"),ADD(.SDLN," "),ADD(.SDLN," ")
"RTN","SDRRC16",54,0)
 D ADD(.SDLN,"SUMMARY OF PROCESSING RESULTS:")
"RTN","SDRRC16",55,0)
 D ADD(.SDLN,"==============================")
"RTN","SDRRC16",56,0)
 D ADD(.SDLN," ")
"RTN","SDRRC16",57,0)
 D ADD(.SDLN,"<<< The Class III OUTPATIENT CLINIC RECALL PARAM File Conversion has "_$S(+$G(SDRRSTOP):"NOT ",1:"")_"Completed. >>>")
"RTN","SDRRC16",58,0)
 I +$G(SDRRSTOP) D
"RTN","SDRRC16",59,0)
 . D ADD(.SDLN,"    Please restart the post-install process from the following")
"RTN","SDRRC16",60,0)
 . D ADD(.SDLN,"    programmer's prompt:")
"RTN","SDRRC16",61,0)
 . D ADD(.SDLN,"                          D POST^SDRRC16")
"RTN","SDRRC16",62,0)
 D ADD(.SDLN," "),ADD(.SDLN," ")
"RTN","SDRRC16",63,0)
 D ADD(.SDLN,"  DATE/TIME TASK STARTED: "_$$FMTE^XLFDT(+$G(^XTMP("SDRRC16","START")),"P"))
"RTN","SDRRC16",64,0)
 D ADD(.SDLN,"DATE/TIME TASK COMPLETED: "_$$FMTE^XLFDT(+$G(^XTMP("SDRRC16","COMPLETED")),"P"))
"RTN","SDRRC16",65,0)
 I $D(^XTMP("SDRRC16","LAST RUN")) D
"RTN","SDRRC16",66,0)
 . D ADD(.SDLN,"      DATE/TIME LAST RUN: "_$$FMTE^XLFDT(+$G(^XTMP("SDRRC16","LAST RUN")),"P"))
"RTN","SDRRC16",67,0)
 D ADD(.SDLN," "),ADD(.SDLN," ")
"RTN","SDRRC16",68,0)
 D ADD(.SDLN,"    TOTAL RECORDS THAT HAVE BEEN CONVERTED: "_+$G(^XTMP("SDRRC16","TOT")))
"RTN","SDRRC16",69,0)
 D ADD(.SDLN,"                         <END OF REPORT> :")
"RTN","SDRRC16",70,0)
 D ^XMD
"RTN","SDRRC16",71,0)
 K ^TMP("SDRRC16",$J)
"RTN","SDRRC16",72,0)
 Q
"RTN","SDRRC16",73,0)
ADD(SDLN,SDTXT) ;add line
"RTN","SDRRC16",74,0)
 Q:$L(SDTXT)'>0
"RTN","SDRRC16",75,0)
 S SDLN=$G(SDLN)+1
"RTN","SDRRC16",76,0)
 S ^TMP("SDRRC16",$J,SDLN)=SDTXT
"RTN","SDRRC16",77,0)
 Q
"RTN","SDRRC16",78,0)
PROGCHK(XPDABORT) ;checks programmer variables
"RTN","SDRRC16",79,0)
 I '$G(DUZ)!($G(DUZ(0))'="@")!('$G(DT))!($G(U)'="^") D
"RTN","SDRRC16",80,0)
 . D BMES^XPDUTL("******")
"RTN","SDRRC16",81,0)
 . D MES^XPDUTL("Your programming variables are not set up properly.")
"RTN","SDRRC16",82,0)
 . D MES^XPDUTL("Installation aborted.")
"RTN","SDRRC16",83,0)
 . D MES^XPDUTL("******")
"RTN","SDRRC16",84,0)
 . S XPDABORT=2
"RTN","SDRRC16",85,0)
 Q
"RTN","SDRRC16",86,0)
ISRUNING(XPDABORT) ;check if running
"RTN","SDRRC16",87,0)
 I +$G(^XTMP("SDRRC16","RUNNING")) D
"RTN","SDRRC16",88,0)
 . D BMES^XPDUTL("******")
"RTN","SDRRC16",89,0)
 . D MES^XPDUTL("This patch is currently being Installed.  Try later.")
"RTN","SDRRC16",90,0)
 . D MES^XPDUTL("Installation aborted...")
"RTN","SDRRC16",91,0)
 . D MES^XPDUTL("******")
"RTN","SDRRC16",92,0)
 . S XPDABORT=2
"RTN","SDRRC16",93,0)
 Q
"RTN","SDRRC16",94,0)
NOFILE ;no File
"RTN","SDRRC16",95,0)
 D BMES^XPDUTL("******")
"RTN","SDRRC16",96,0)
 D MES^XPDUTL("The Class III Outpatient Clinic Recall Params File Conversion is NOT necessary because")
"RTN","SDRRC16",97,0)
 D MES^XPDUTL("file (#190004.1) does not exist on this system.")
"RTN","SDRRC16",98,0)
 D MES^XPDUTL("Post-Install process terminated...For conversion to OUTPATIENT CLINIC PARAM FILE (#403.53)")
"RTN","SDRRC16",99,0)
 D MES^XPDUTL("******")
"RTN","SDRRC16",100,0)
 Q
"RTN","SDRRC16",101,0)
TASK ;run TaskMan
"RTN","SDRRC16",102,0)
 N ZTSK,ZTDTH,ZTRTN,ZTDESC,ZTIO,ZTSAVE,ZTREQ,ZTSTOP,SDSTOP
"RTN","SDRRC16",103,0)
 S SDSTOP=+$G(^XTMP("SDRRC16","STOPPED"))
"RTN","SDRRC16",104,0)
 S ZTRTN="START^SDRRC16"
"RTN","SDRRC16",105,0)
 S ZTDESC="SD*5.3*536 OUTPATIENT CLINIC PARAM FILE CONVERSION REPORT"
"RTN","SDRRC16",106,0)
 S ZTIO="",ZTDTH=$H,ZTREQ="@",ZTSAVE("ZTREQ")=""
"RTN","SDRRC16",107,0)
 D ^%ZTLOAD
"RTN","SDRRC16",108,0)
 D BMES^XPDUTL("******")
"RTN","SDRRC16",109,0)
 I '$D(ZTSK) D
"RTN","SDRRC16",110,0)
 . D MES^XPDUTL("Unable to schedule TaskMan task to run the Class III (190004.1) File")
"RTN","SDRRC16",111,0)
 . D MES^XPDUTL("Conversion.")
"RTN","SDRRC16",112,0)
 . D BMES^XPDUTL("Please re-run Post-Install routine POST^SSDRRC16 from")
"RTN","SDRRC16",113,0)
 . D MES^XPDUTL("the programmer prompt.")
"RTN","SDRRC16",114,0)
 . ;
"RTN","SDRRC16",115,0)
 E  D
"RTN","SDRRC16",116,0)
 . D MES^XPDUTL("Task "_ZTSK_" has been "_$S(+SDSTOP:"Re-",1:"")_"started to run the Class III (190004.1) File")
"RTN","SDRRC16",117,0)
 . D MES^XPDUTL("Conversion.")
"RTN","SDRRC16",118,0)
 . I SDSTOP D
"RTN","SDRRC16",119,0)
 . . D MES^XPDUTL("  <<< The last task run was STOPPED on "_$$FMTE^XLFDT(SDSTOP,"P")_". >>>")
"RTN","SDRRC16",120,0)
 . D BMES^XPDUTL("You will receive a MailMan message when this task is completed")
"RTN","SDRRC16",121,0)
 . D MES^XPDUTL("or if it has been manually stopped.")
"RTN","SDRRC16",122,0)
 D MES^XPDUTL("******")
"RTN","SDRRC16",123,0)
 Q
"RTN","SDRRC16",124,0)
XTMP ;setup ^XTMP to control output for 90 days
"RTN","SDRRC16",125,0)
 I $D(^XTMP("SDRRC16",0)) D
"RTN","SDRRC16",126,0)
 . S ^XTMP("SDRRC16","LAST RUN")=$G(^XTMP("SDRRC16","START"))
"RTN","SDRRC16",127,0)
 E  D
"RTN","SDRRC16",128,0)
 . N SDX
"RTN","SDRRC16",129,0)
 . S SDX=$$FMADD^XLFDT($$NOW^XLFDT(),90)_U_$$NOW^XLFDT()
"RTN","SDRRC16",130,0)
 . S SDX=SDX_"^SD*5.3*536 OUTPATIENT CLINIC PARAM FILE CONVERSION REPORT"
"RTN","SDRRC16",131,0)
 . S ^XTMP("SDRRC16",0)=SDX
"RTN","SDRRC16",132,0)
 S ^XTMP("SDRRC16","START")=$$NOW^XLFDT()
"RTN","SDRRC16",133,0)
 S ^XTMP("SDRRC16","RUNNING")="1"
"RTN","SDRRC16",134,0)
 Q
"RTN","SDRRC16",135,0)
UPXTMP(SDENCPTR,NODE,SDENT) ;add to ^XTMP
"RTN","SDRRC16",136,0)
 ; Input:
"RTN","SDRRC16",137,0)
 ;       NODE - Unique subscript
"RTN","SDRRC16",138,0)
 ; Output: none
"RTN","SDRRC16",139,0)
 Q:'$G(SDENCPTR)
"RTN","SDRRC16",140,0)
 I $G(NODE)="" S NODE="UNKNOWN"
"RTN","SDRRC16",141,0)
 S ^XTMP("SDRRC16","TOT2",NODE,SDENCPTR)=$G(SDENT)
"RTN","SDRRC16",142,0)
 Q
"RTN","SDRRC17")
0^33^B35448060
"RTN","SDRRC17",1,0)
SDRRC17 ;10N20/MAH - POST-INSTALL FOR PATCH SD*5.3*536 CONVERT APPT TYPES; 3/01/2008 12:24pm
"RTN","SDRRC17",2,0)
 ;;5.3;Scheduling;**536**;Aug 13, 1993;Build 53
"RTN","SDRRC17",3,0)
 ;;SDRR-RECALL REMINDER
"RTN","SDRRC17",4,0)
 Q
"RTN","SDRRC17",5,0)
ENV ;Environment check
"RTN","SDRRC17",6,0)
 K ^XTMP("SDRRC17")
"RTN","SDRRC17",7,0)
 S XPDABORT=""
"RTN","SDRRC17",8,0)
 ;checks programmer variables
"RTN","SDRRC17",9,0)
 D PROGCHK(.XPDABORT)
"RTN","SDRRC17",10,0)
 ;check if install is running
"RTN","SDRRC17",11,0)
 D ISRUNING(.XPDABORT)
"RTN","SDRRC17",12,0)
 I XPDABORT="" K XPDABORT
"RTN","SDRRC17",13,0)
POST ;Check for Clinic Recall APPT/TYPE file)
"RTN","SDRRC17",14,0)
 I '$D(^DIZ(653204)) D  Q
"RTN","SDRRC17",15,0)
 . D NOFILE
"RTN","SDRRC17",16,0)
 D TASK
"RTN","SDRRC17",17,0)
 Q
"RTN","SDRRC17",18,0)
START ;Background job entry point
"RTN","SDRRC17",19,0)
 N SDAIEN,SDANUSB,SDX,SDFDAIEN,SDARAY,SDERAY,SDSAVE,TOTAL,SDRRREC,SDRRFDA
"RTN","SDRRC17",20,0)
 N SDTOT,SDENCPTR,SDCKCNT,SDRRSTOP,SDENT,SDFIL,PARAM
"RTN","SDRRC17",21,0)
 S TOTAL=0
"RTN","SDRRC17",22,0)
 D XTMP
"RTN","SDRRC17",23,0)
 ;seed var's if Re-Run
"RTN","SDRRC17",24,0)
 I $D(^XTMP("SDRRC17","TOT")) D
"RTN","SDRRC17",25,0)
 . S SDTOT=+$G(^XTMP("SDRRC17","TOT"))
"RTN","SDRRC17",26,0)
 . S (SDSAVE,SDAIEN)=+$G(^XTMP("SDRRC17","TYPES"))
"RTN","SDRRC17",27,0)
 E  D
"RTN","SDRRC17",28,0)
 . S SDAIEN=0 F  S SDAIEN=$O(^DIZ(653204,SDAIEN)) Q:SDAIEN<1  S SDRRREC=$G(^DIZ(653204,SDAIEN,0)) D
"RTN","SDRRC17",29,0)
 . .S SDRRFDA(403.51,"+1,",.01)=$P(SDRRREC,U,1)
"RTN","SDRRC17",30,0)
 . .S SDRRFDA(403.51,"+1,",1)=$P(SDRRREC,U,2)
"RTN","SDRRC17",31,0)
 . .N NEWREC S NEWREC(1)=SDAIEN
"RTN","SDRRC17",32,0)
 . .D UPDATE^DIE("","SDRRFDA","NEWREC")
"RTN","SDRRC17",33,0)
 . .S TOTAL=TOTAL+1
"RTN","SDRRC17",34,0)
 S ^XTMP("SDRRC17","COMPLETED")=$$NOW^XLFDT()
"RTN","SDRRC17",35,0)
 S ^XTMP("SDRRC17","TOT")=TOTAL
"RTN","SDRRC17",36,0)
 K ^XTMP("SDRRC17","RUNNING")
"RTN","SDRRC17",37,0)
 D SENDMSG
"RTN","SDRRC17",38,0)
 Q
"RTN","SDRRC17",39,0)
SENDMSG ;send MailMan msg to patch installer
"RTN","SDRRC17",40,0)
 N DIFROM,SDMSG,SDTXT,SDLN,XMY,XMDUZ,XMSUB,XMTEXT,XMDUN,XMZ
"RTN","SDRRC17",41,0)
 K ^TMP("SDRRC17",$J)
"RTN","SDRRC17",42,0)
 S XMSUB="SD*5.3*536 OUTPATIENT CLINIC APPT TYPES FILE CONVERSION REPORT"
"RTN","SDRRC17",43,0)
 S XMTEXT="^TMP(""SDRRC17"",$J,",XMDUZ=.5,(XMY(DUZ),XMY(XMDUZ))=""
"RTN","SDRRC17",44,0)
 S SDLN=0
"RTN","SDRRC17",45,0)
 D ADD(.SDLN,"Patch:  SD*5.3*536 RECALL REMINDER APPT TYPES FILE CONVERSION PROCESSING")
"RTN","SDRRC17",46,0)
 D ADD(.SDLN," "),ADD(.SDLN,"************")
"RTN","SDRRC17",47,0)
 D ADD(.SDLN,"The existing Class III file called OUTPATIENT CLINIC RECALL APPT TYPES (653204), ")
"RTN","SDRRC17",48,0)
 D ADD(.SDLN,"which contains Outpatient Clinic Recall Appt Types have been converted to")
"RTN","SDRRC17",49,0)
 D ADD(.SDLN,"a new Class I file called Recall Reminder Appt Types (403.51)")
"RTN","SDRRC17",50,0)
 D ADD(.SDLN,"which will provide the same functionality.")
"RTN","SDRRC17",51,0)
 D ADD(.SDLN,"************"),ADD(.SDLN," "),ADD(.SDLN," ")
"RTN","SDRRC17",52,0)
 D ADD(.SDLN,"SUMMARY OF PROCESSING RESULTS:")
"RTN","SDRRC17",53,0)
 D ADD(.SDLN,"==============================")
"RTN","SDRRC17",54,0)
 D ADD(.SDLN," ")
"RTN","SDRRC17",55,0)
 D ADD(.SDLN,"<<< The Class III OUTPATIENT CLINIC RECALL APPT TYPES File Conversion has "_$S(+$G(SDRRSTOP):"NOT ",1:"")_"Completed. >>>")
"RTN","SDRRC17",56,0)
 I +$G(SDRRSTOP) D
"RTN","SDRRC17",57,0)
 . D ADD(.SDLN,"    Please restart the post-install process from the following")
"RTN","SDRRC17",58,0)
 . D ADD(.SDLN,"    programmer's prompt:")
"RTN","SDRRC17",59,0)
 . D ADD(.SDLN,"                          D POST^SDRRC17")
"RTN","SDRRC17",60,0)
 D ADD(.SDLN," "),ADD(.SDLN," ")
"RTN","SDRRC17",61,0)
 D ADD(.SDLN,"  DATE/TIME TASK STARTED: "_$$FMTE^XLFDT(+$G(^XTMP("SDRRC17","START")),"P"))
"RTN","SDRRC17",62,0)
 D ADD(.SDLN,"DATE/TIME TASK COMPLETED: "_$$FMTE^XLFDT(+$G(^XTMP("SDRRC17","COMPLETED")),"P"))
"RTN","SDRRC17",63,0)
 I $D(^XTMP("SDRRC17","LAST RUN")) D
"RTN","SDRRC17",64,0)
 . D ADD(.SDLN,"      DATE/TIME LAST RUN: "_$$FMTE^XLFDT(+$G(^XTMP("SDRRC17","LAST RUN")),"P"))
"RTN","SDRRC17",65,0)
 D ADD(.SDLN," "),ADD(.SDLN," ")
"RTN","SDRRC17",66,0)
 D ADD(.SDLN,"    TOTAL RECORDS THAT HAVE BEEN CONVERTED: "_+$G(^XTMP("SDRRC17","TOT")))
"RTN","SDRRC17",67,0)
 D ADD(.SDLN,"                         <END OF REPORT> :")
"RTN","SDRRC17",68,0)
 D ^XMD
"RTN","SDRRC17",69,0)
 K ^TMP("SDRRC17",$J)
"RTN","SDRRC17",70,0)
 Q
"RTN","SDRRC17",71,0)
ADD(SDLN,SDTXT) ;add line
"RTN","SDRRC17",72,0)
 Q:$L(SDTXT)'>0
"RTN","SDRRC17",73,0)
 S SDLN=$G(SDLN)+1
"RTN","SDRRC17",74,0)
 S ^TMP("SDRRC17",$J,SDLN)=SDTXT
"RTN","SDRRC17",75,0)
 Q
"RTN","SDRRC17",76,0)
PROGCHK(XPDABORT) ;checks programmer variables
"RTN","SDRRC17",77,0)
 I '$G(DUZ)!($G(DUZ(0))'="@")!('$G(DT))!($G(U)'="^") D
"RTN","SDRRC17",78,0)
 . D BMES^XPDUTL("******")
"RTN","SDRRC17",79,0)
 . D MES^XPDUTL("Your programming variables are not set up properly.")
"RTN","SDRRC17",80,0)
 . D MES^XPDUTL("Installation aborted.")
"RTN","SDRRC17",81,0)
 . D MES^XPDUTL("******")
"RTN","SDRRC17",82,0)
 . S XPDABORT=2
"RTN","SDRRC17",83,0)
 Q
"RTN","SDRRC17",84,0)
ISRUNING(XPDABORT) ;check if running
"RTN","SDRRC17",85,0)
 I +$G(^XTMP("SDRRC17","RUNNING")) D
"RTN","SDRRC17",86,0)
 . D BMES^XPDUTL("******")
"RTN","SDRRC17",87,0)
 . D MES^XPDUTL("This patch is currently being Installed.  Try later.")
"RTN","SDRRC17",88,0)
 . D MES^XPDUTL("Installation aborted...")
"RTN","SDRRC17",89,0)
 . D MES^XPDUTL("******")
"RTN","SDRRC17",90,0)
 . S XPDABORT=2
"RTN","SDRRC17",91,0)
 Q
"RTN","SDRRC17",92,0)
NOFILE ;no File
"RTN","SDRRC17",93,0)
 D BMES^XPDUTL("******")
"RTN","SDRRC17",94,0)
 D MES^XPDUTL("The Class III OUTPATIENT CLINIC RECALL APPT TYPES  File Conversion is NOT necessary because")
"RTN","SDRRC17",95,0)
 D MES^XPDUTL("file (#653204) does not exist on this system.")
"RTN","SDRRC17",96,0)
 D MES^XPDUTL("Post-Install process terminated...For conversion to Recall Reminder Appt Types (#403.51)")
"RTN","SDRRC17",97,0)
 D MES^XPDUTL("******")
"RTN","SDRRC17",98,0)
 Q
"RTN","SDRRC17",99,0)
TASK ;run TaskMan
"RTN","SDRRC17",100,0)
 N ZTSK,ZTDTH,ZTRTN,ZTDESC,ZTIO,ZTSAVE,ZTREQ,ZTSTOP,SDSTOP
"RTN","SDRRC17",101,0)
 S SDSTOP=+$G(^XTMP("SDRRC17","STOPPED"))
"RTN","SDRRC17",102,0)
 S ZTRTN="START^SDRRC17"
"RTN","SDRRC17",103,0)
 S ZTDESC="SD*5.3*536 OUTPATIENT CLINIC APPT TYPES FILE CONVERSION REPORT"
"RTN","SDRRC17",104,0)
 S ZTIO="",ZTDTH=$H,ZTREQ="@",ZTSAVE("ZTREQ")=""
"RTN","SDRRC17",105,0)
 D ^%ZTLOAD
"RTN","SDRRC17",106,0)
 D BMES^XPDUTL("******")
"RTN","SDRRC17",107,0)
 I '$D(ZTSK) D
"RTN","SDRRC17",108,0)
 . D MES^XPDUTL("Unable to schedule TaskMan task to run the Class III (653204) File")
"RTN","SDRRC17",109,0)
 . D MES^XPDUTL("Conversion.")
"RTN","SDRRC17",110,0)
 . D BMES^XPDUTL("Please re-run Post-Install routine POST^SSDRRC17 from")
"RTN","SDRRC17",111,0)
 . D MES^XPDUTL("the programmer prompt.")
"RTN","SDRRC17",112,0)
 . ;
"RTN","SDRRC17",113,0)
 E  D
"RTN","SDRRC17",114,0)
 . D MES^XPDUTL("Task "_ZTSK_" has been "_$S(+SDSTOP:"Re-",1:"")_"started to run the Class III (653204) File")
"RTN","SDRRC17",115,0)
 . D MES^XPDUTL("Conversion.")
"RTN","SDRRC17",116,0)
 . I SDSTOP D
"RTN","SDRRC17",117,0)
 . . D MES^XPDUTL("  <<< The last task run was STOPPED on "_$$FMTE^XLFDT(SDSTOP,"P")_". >>>")
"RTN","SDRRC17",118,0)
 . D BMES^XPDUTL("You will receive a MailMan message when this task is completed")
"RTN","SDRRC17",119,0)
 . D MES^XPDUTL("or if it has been manually stopped.")
"RTN","SDRRC17",120,0)
 D MES^XPDUTL("******")
"RTN","SDRRC17",121,0)
 Q
"RTN","SDRRC17",122,0)
XTMP ;setup ^XTMP to control output for 90 days
"RTN","SDRRC17",123,0)
 I $D(^XTMP("SDRRC17",0)) D
"RTN","SDRRC17",124,0)
 . S ^XTMP("SDRRC17","LAST RUN")=$G(^XTMP("SDRRC17","START"))
"RTN","SDRRC17",125,0)
 E  D
"RTN","SDRRC17",126,0)
 . N SDX
"RTN","SDRRC17",127,0)
 . S SDX=$$FMADD^XLFDT($$NOW^XLFDT(),90)_U_$$NOW^XLFDT()
"RTN","SDRRC17",128,0)
 . S SDX=SDX_"^SD*5.3*536 OUTPATIENT CLINIC APPT/TYPES FILE CONVERSION REPORT"
"RTN","SDRRC17",129,0)
 . S ^XTMP("SDRRC17",0)=SDX
"RTN","SDRRC17",130,0)
 S ^XTMP("SDRRC17","START")=$$NOW^XLFDT()
"RTN","SDRRC17",131,0)
 S ^XTMP("SDRRC17","RUNNING")="1"
"RTN","SDRRC17",132,0)
 Q
"RTN","SDRRC17",133,0)
UPXTMP(SDENCPTR,NODE,SDENT) ;add to ^XTMP
"RTN","SDRRC17",134,0)
 ; Input:
"RTN","SDRRC17",135,0)
 ;       NODE - Unique subscript
"RTN","SDRRC17",136,0)
 ; Output: none
"RTN","SDRRC17",137,0)
 Q:'$G(SDENCPTR)
"RTN","SDRRC17",138,0)
 I $G(NODE)="" S NODE="UNKNOWN"
"RTN","SDRRC17",139,0)
 S ^XTMP("SDRRC17","TOT2",NODE,SDENCPTR)=$G(SDENT)
"RTN","SDRRC17",140,0)
 Q
"RTN","SDRRC18")
0^34^B38268527
"RTN","SDRRC18",1,0)
SDRRC18 ;10N20/MAH - ENV/POST-INSTALL FOR PATCH SD*5.3*536 CONVERT PROVIDERS; 3/01/2008 12:24pm
"RTN","SDRRC18",2,0)
 ;;5.3;Scheduling;**536**;Aug 13, 1993;Build 53
"RTN","SDRRC18",3,0)
 ;;SDRR-RECALL REMINDER
"RTN","SDRRC18",4,0)
 Q
"RTN","SDRRC18",5,0)
ENV ;Environment check
"RTN","SDRRC18",6,0)
 K ^XTMP("SDRRC18")
"RTN","SDRRC18",7,0)
 S XPDABORT=""
"RTN","SDRRC18",8,0)
 ;checks programmer variables
"RTN","SDRRC18",9,0)
 D PROGCHK(.XPDABORT)
"RTN","SDRRC18",10,0)
 ;check if install is running
"RTN","SDRRC18",11,0)
 D ISRUNING(.XPDABORT)
"RTN","SDRRC18",12,0)
 I XPDABORT="" K XPDABORT
"RTN","SDRRC18",13,0)
POST ;Check for Clinic Recall provider file)
"RTN","SDRRC18",14,0)
 I '$D(^DIZ(687067)) D  Q
"RTN","SDRRC18",15,0)
 . D NOFILE
"RTN","SDRRC18",16,0)
 D TASK
"RTN","SDRRC18",17,0)
 Q
"RTN","SDRRC18",18,0)
START ;Background job entry point
"RTN","SDRRC18",19,0)
 N SDAIEN,SDANUSB,SDX,SDFDAIEN,SDARAY,SDERAY,SDSAVE,SDRRREC,SDRRFDA,TOTAL
"RTN","SDRRC18",20,0)
 N SDTOT,SDENCPTR,SDCKCNT,SDRRSTOP,SDENT,SDFIL,PROVIDER
"RTN","SDRRC18",21,0)
 S TOTAL=0
"RTN","SDRRC18",22,0)
 D XTMP
"RTN","SDRRC18",23,0)
 ;seed var's if Re-Run
"RTN","SDRRC18",24,0)
 I $D(^XTMP("SDRRC18","TOT")) D
"RTN","SDRRC18",25,0)
 . S SDTOT=+$G(^XTMP("SDRRC18","TOT"))
"RTN","SDRRC18",26,0)
 . S (SDSAVE,SDAIEN)=+$G(^XTMP("SDRRC18","PROVIDER"))
"RTN","SDRRC18",27,0)
 E  D
"RTN","SDRRC18",28,0)
 . S SDAIEN=0 F  S SDAIEN=$O(^DIZ(687067,SDAIEN)) Q:SDAIEN<1  S SDRRREC=$G(^DIZ(687067,SDAIEN,0)) D
"RTN","SDRRC18",29,0)
 . .S SDRRFDA(403.54,"+1,",.01)=$P(SDRRREC,U,1)
"RTN","SDRRC18",30,0)
 . .S SDRRFDA(403.54,"+1,",1)=$P(SDRRREC,U,2)
"RTN","SDRRC18",31,0)
 . .I $P($G(SDRRREC),U,3)'="" S SDRRFDA(403.54,"+1,",2)=$P($G(SDRRREC),U,3)
"RTN","SDRRC18",32,0)
 . .I $P($G(SDRRREC),U,4)'="" S SDRRFDA(403.54,"+1,",3)=$P($G(SDRRREC),U,4)
"RTN","SDRRC18",33,0)
 . .I $P($G(SDRRREC),U,5)'="" S SDRRFDA(403.54,"+1,",4)=$P($G(SDRRREC),U,5)
"RTN","SDRRC18",34,0)
 . .I $P($G(SDRRREC),U,6)'="" S SDRRFDA(403.54,"+1,",5)=$P($G(SDRRREC),U,6)
"RTN","SDRRC18",35,0)
 . .I $P($G(SDRRREC),U,7)'="" S SDRRFDA(403.54,"+1,",6)=$P($G(SDRRREC),U,7)
"RTN","SDRRC18",36,0)
 . .N NEWREC S NEWREC(1)=SDAIEN
"RTN","SDRRC18",37,0)
 . .D UPDATE^DIE("","SDRRFDA","NEWREC")
"RTN","SDRRC18",38,0)
 . .S TOTAL=TOTAL+1
"RTN","SDRRC18",39,0)
 S ^XTMP("SDRRC18","COMPLETED")=$$NOW^XLFDT()
"RTN","SDRRC18",40,0)
 S ^XTMP("SDRRC18","TOT")=TOTAL
"RTN","SDRRC18",41,0)
 K ^XTMP("SDRRC18","RUNNING")
"RTN","SDRRC18",42,0)
 D SENDMSG
"RTN","SDRRC18",43,0)
 Q
"RTN","SDRRC18",44,0)
SENDMSG ;send MailMan msg to patch installer
"RTN","SDRRC18",45,0)
 N DIFROM,SDMSG,SDTXT,SDLN,XMY,XMDUZ,XMSUB,XMTEXT,XMDUN,XMZ
"RTN","SDRRC18",46,0)
 K ^TMP("SDRRC18",$J)
"RTN","SDRRC18",47,0)
 S XMSUB="SD*5.3*536 OUTPATIENT CLINIC PROVIDER FILE CONVERSION REPORT"
"RTN","SDRRC18",48,0)
 S XMTEXT="^TMP(""SDRRC18"",$J,",XMDUZ=.5,(XMY(DUZ),XMY(XMDUZ))=""
"RTN","SDRRC18",49,0)
 S SDLN=0
"RTN","SDRRC18",50,0)
 D ADD(.SDLN,"Patch:  SD*5.3*536 RECALL REMINDER PROVIDER FILE CONVERSION PROCESSING")
"RTN","SDRRC18",51,0)
 D ADD(.SDLN," "),ADD(.SDLN,"************")
"RTN","SDRRC18",52,0)
 D ADD(.SDLN,"The existing Class III file called OUTPATIENT CLINIC RECALL PROVIDER (687067), ")
"RTN","SDRRC18",53,0)
 D ADD(.SDLN,"which contains Outpatient Clinic Recall Providers have been converted to")
"RTN","SDRRC18",54,0)
 D ADD(.SDLN,"a new Class I file called Recall Reminder Providers (403.54)")
"RTN","SDRRC18",55,0)
 D ADD(.SDLN,"which will provide the same functionality.")
"RTN","SDRRC18",56,0)
 D ADD(.SDLN,"************"),ADD(.SDLN," "),ADD(.SDLN," ")
"RTN","SDRRC18",57,0)
 D ADD(.SDLN,"SUMMARY OF PROCESSING RESULTS:")
"RTN","SDRRC18",58,0)
 D ADD(.SDLN,"==============================")
"RTN","SDRRC18",59,0)
 D ADD(.SDLN," ")
"RTN","SDRRC18",60,0)
 D ADD(.SDLN,"<<< The Class III OUTPATIENT CLINIC RECALL PROVIDER File Conversion has "_$S(+$G(SDRRSTOP):"NOT ",1:"")_"Completed. >>>")
"RTN","SDRRC18",61,0)
 I +$G(SDRRSTOP) D
"RTN","SDRRC18",62,0)
 . D ADD(.SDLN,"    Please restart the post-install process from the following")
"RTN","SDRRC18",63,0)
 . D ADD(.SDLN,"    programmer's prompt:")
"RTN","SDRRC18",64,0)
 . D ADD(.SDLN,"                          D POST^SDRRC18")
"RTN","SDRRC18",65,0)
 D ADD(.SDLN," "),ADD(.SDLN," ")
"RTN","SDRRC18",66,0)
 D ADD(.SDLN,"  DATE/TIME TASK STARTED: "_$$FMTE^XLFDT(+$G(^XTMP("SDRRC18","START")),"P"))
"RTN","SDRRC18",67,0)
 D ADD(.SDLN,"DATE/TIME TASK COMPLETED: "_$$FMTE^XLFDT(+$G(^XTMP("SDRRC18","COMPLETED")),"P"))
"RTN","SDRRC18",68,0)
 I $D(^XTMP("SDRRC18","LAST RUN")) D
"RTN","SDRRC18",69,0)
 . D ADD(.SDLN,"      DATE/TIME LAST RUN: "_$$FMTE^XLFDT(+$G(^XTMP("SDRRC18","LAST RUN")),"P"))
"RTN","SDRRC18",70,0)
 D ADD(.SDLN," "),ADD(.SDLN," ")
"RTN","SDRRC18",71,0)
 D ADD(.SDLN,"    TOTAL RECORDS THAT HAVE BEEN CONVERTED: "_+$G(^XTMP("SDRRC18","TOT")))
"RTN","SDRRC18",72,0)
 D ADD(.SDLN,"                         <END OF REPORT> :")
"RTN","SDRRC18",73,0)
 D ^XMD
"RTN","SDRRC18",74,0)
 K ^TMP("SDRRC18",$J)
"RTN","SDRRC18",75,0)
 Q
"RTN","SDRRC18",76,0)
ADD(SDLN,SDTXT) ;add line
"RTN","SDRRC18",77,0)
 Q:$L(SDTXT)'>0
"RTN","SDRRC18",78,0)
 S SDLN=$G(SDLN)+1
"RTN","SDRRC18",79,0)
 S ^TMP("SDRRC18",$J,SDLN)=SDTXT
"RTN","SDRRC18",80,0)
 Q
"RTN","SDRRC18",81,0)
PROGCHK(XPDABORT) ;checks programmer variables
"RTN","SDRRC18",82,0)
 I '$G(DUZ)!($G(DUZ(0))'="@")!('$G(DT))!($G(U)'="^") D
"RTN","SDRRC18",83,0)
 . D BMES^XPDUTL("******")
"RTN","SDRRC18",84,0)
 . D MES^XPDUTL("Your programming variables are not set up properly.")
"RTN","SDRRC18",85,0)
 . D MES^XPDUTL("Installation aborted.")
"RTN","SDRRC18",86,0)
 . D MES^XPDUTL("******")
"RTN","SDRRC18",87,0)
 . S XPDABORT=2
"RTN","SDRRC18",88,0)
 Q
"RTN","SDRRC18",89,0)
ISRUNING(XPDABORT) ;check if running
"RTN","SDRRC18",90,0)
 I +$G(^XTMP("SDRRC18","RUNNING")) D
"RTN","SDRRC18",91,0)
 . D BMES^XPDUTL("******")
"RTN","SDRRC18",92,0)
 . D MES^XPDUTL("This patch is currently being Installed.  Try later.")
"RTN","SDRRC18",93,0)
 . D MES^XPDUTL("Installation aborted...")
"RTN","SDRRC18",94,0)
 . D MES^XPDUTL("******")
"RTN","SDRRC18",95,0)
 . S XPDABORT=2
"RTN","SDRRC18",96,0)
 Q
"RTN","SDRRC18",97,0)
NOFILE ;no File
"RTN","SDRRC18",98,0)
 D BMES^XPDUTL("******")
"RTN","SDRRC18",99,0)
 D MES^XPDUTL("The Class III OUTPATIENT CLINIC RECALL PROVIDER  File Conversion is NOT necessary because")
"RTN","SDRRC18",100,0)
 D MES^XPDUTL("file (#687067) does not exist on this system.")
"RTN","SDRRC18",101,0)
 D MES^XPDUTL("Post-Install process terminated...For conversion to Recall Reminder Appt Types (#403.54)")
"RTN","SDRRC18",102,0)
 D MES^XPDUTL("******")
"RTN","SDRRC18",103,0)
 Q
"RTN","SDRRC18",104,0)
TASK ;run TaskMan
"RTN","SDRRC18",105,0)
 N ZTSK,ZTDTH,ZTRTN,ZTDESC,ZTIO,ZTSAVE,ZTREQ,ZTSTOP,SDSTOP
"RTN","SDRRC18",106,0)
 S SDSTOP=+$G(^XTMP("SDRRC18","STOPPED"))
"RTN","SDRRC18",107,0)
 S ZTRTN="START^SDRRC18"
"RTN","SDRRC18",108,0)
 S ZTDESC="SD*5.3*536 OUTPATIENT CLINIC PROVIDER FILE CONVERSION REPORT"
"RTN","SDRRC18",109,0)
 S ZTIO="",ZTDTH=$H,ZTREQ="@",ZTSAVE("ZTREQ")=""
"RTN","SDRRC18",110,0)
 D ^%ZTLOAD
"RTN","SDRRC18",111,0)
 D BMES^XPDUTL("******")
"RTN","SDRRC18",112,0)
 I '$D(ZTSK) D
"RTN","SDRRC18",113,0)
 . D MES^XPDUTL("Unable to schedule TaskMan task to run the Class III (687067) File")
"RTN","SDRRC18",114,0)
 . D MES^XPDUTL("Conversion.")
"RTN","SDRRC18",115,0)
 . D BMES^XPDUTL("Please re-run Post-Install routine POST^SDRRC18 from")
"RTN","SDRRC18",116,0)
 . D MES^XPDUTL("the programmer prompt.")
"RTN","SDRRC18",117,0)
 . ;
"RTN","SDRRC18",118,0)
 E  D
"RTN","SDRRC18",119,0)
 . D MES^XPDUTL("Task "_ZTSK_" has been "_$S(+SDSTOP:"Re-",1:"")_"started to run the Class III (687067) File")
"RTN","SDRRC18",120,0)
 . D MES^XPDUTL("Conversion.")
"RTN","SDRRC18",121,0)
 . I SDSTOP D
"RTN","SDRRC18",122,0)
 . . D MES^XPDUTL("  <<< The last task run was STOPPED on "_$$FMTE^XLFDT(SDSTOP,"P")_". >>>")
"RTN","SDRRC18",123,0)
 . D BMES^XPDUTL("You will receive a MailMan message when this task is completed")
"RTN","SDRRC18",124,0)
 . D MES^XPDUTL("or if it has been manually stopped.")
"RTN","SDRRC18",125,0)
 D MES^XPDUTL("******")
"RTN","SDRRC18",126,0)
 Q
"RTN","SDRRC18",127,0)
XTMP ;setup ^XTMP to control output for 90 days
"RTN","SDRRC18",128,0)
 I $D(^XTMP("SDRRC18",0)) D
"RTN","SDRRC18",129,0)
 . S ^XTMP("SDRRC18","LAST RUN")=$G(^XTMP("SDRRC18","START"))
"RTN","SDRRC18",130,0)
 E  D
"RTN","SDRRC18",131,0)
 . N SDX
"RTN","SDRRC18",132,0)
 . S SDX=$$FMADD^XLFDT($$NOW^XLFDT(),90)_U_$$NOW^XLFDT()
"RTN","SDRRC18",133,0)
 . S SDX=SDX_"^SD*5.3*536 OUTPATIENT CLINIC PROVIDER FILE CONVERSION REPORT"
"RTN","SDRRC18",134,0)
 . S ^XTMP("SDRRC18",0)=SDX
"RTN","SDRRC18",135,0)
 S ^XTMP("SDRRC18","START")=$$NOW^XLFDT()
"RTN","SDRRC18",136,0)
 S ^XTMP("SDRRC18","RUNNING")="1"
"RTN","SDRRC18",137,0)
 Q
"RTN","SDRRC18",138,0)
UPXTMP(SDENCPTR,NODE,SDENT) ;add to ^XTMP
"RTN","SDRRC18",139,0)
 ; Input:
"RTN","SDRRC18",140,0)
 ;       NODE - Unique subscript
"RTN","SDRRC18",141,0)
 ; Output: none
"RTN","SDRRC18",142,0)
 Q:'$G(SDENCPTR)
"RTN","SDRRC18",143,0)
 I $G(NODE)="" S NODE="UNKNOWN"
"RTN","SDRRC18",144,0)
 S ^XTMP("SDRRC18","TOT2",NODE,SDENCPTR)=$G(SDENT)
"RTN","SDRRC18",145,0)
 Q
"RTN","SDRRC20")
0^36^B61232869
"RTN","SDRRC20",1,0)
SDRRC20 ;10N20/MAH - ENV/POST-INSTALL FOR PATCH SD*5.3*536 CONVERT PATIENT FILE ; 3/01/2008 12:24pm
"RTN","SDRRC20",2,0)
 ;;5.3;Scheduling;**536**;Aug 13, 1993;Build 53
"RTN","SDRRC20",3,0)
 ;;SDRR-RECALL REMINDER
"RTN","SDRRC20",4,0)
 Q
"RTN","SDRRC20",5,0)
ENV ;Environment check
"RTN","SDRRC20",6,0)
 K ^XTMP("SDRRC20")
"RTN","SDRRC20",7,0)
 S XPDABORT=""
"RTN","SDRRC20",8,0)
 ;checks programmer variables
"RTN","SDRRC20",9,0)
 D PROGCHK(.XPDABORT)
"RTN","SDRRC20",10,0)
 ;check if install is running
"RTN","SDRRC20",11,0)
 D ISRUNING(.XPDABORT)
"RTN","SDRRC20",12,0)
 I XPDABORT="" K XPDABORT
"RTN","SDRRC20",13,0)
POST ;Check for Clinic Recall PATIENTs file)
"RTN","SDRRC20",14,0)
 I '$D(^DIZ(687065)) D  Q
"RTN","SDRRC20",15,0)
 . D NOFILE
"RTN","SDRRC20",16,0)
 D CHECKDD
"RTN","SDRRC20",17,0)
 I DDISSUE=1 K DDISSUE,PFLAG,PFLAG1 Q
"RTN","SDRRC20",18,0)
 K DDISSUE,PFLAG,PFLAG1
"RTN","SDRRC20",19,0)
 D TASK
"RTN","SDRRC20",20,0)
 Q
"RTN","SDRRC20",21,0)
START ;Background job entry point
"RTN","SDRRC20",22,0)
 N SDAIEN,SDANUSB,SDX,SDFDAIEN,SDARAY,SDERAY,SDSAVE,SDRRREC,SDRRFDA,TOTAL
"RTN","SDRRC20",23,0)
 N SDTOT,SDTOT2,SDTOT3,SDENCPTR,SDCKCNT,SDRRSTOP,SDENT,SDFIL,DFN,PATIENT
"RTN","SDRRC20",24,0)
 S TOTAL=0
"RTN","SDRRC20",25,0)
 D XTMP
"RTN","SDRRC20",26,0)
 ;seed var's if Re-Run
"RTN","SDRRC20",27,0)
 I $D(^XTMP("SDRRC20","TOT")) D
"RTN","SDRRC20",28,0)
 . S SDTOT=+$G(^XTMP("SDRRC20","TOT"))
"RTN","SDRRC20",29,0)
 . S (SDSAVE,SDAIEN)=+$G(^XTMP("SDRRC20","PATIENT"))
"RTN","SDRRC20",30,0)
 E  D
"RTN","SDRRC20",31,0)
 . S SDAIEN=0 F  S SDAIEN=$O(^DIZ(687065,SDAIEN)) Q:SDAIEN<1  S SDRRREC=$G(^DIZ(687065,SDAIEN,0)) D
"RTN","SDRRC20",32,0)
 . .Q:$P($G(SDRRREC),U,6)=""
"RTN","SDRRC20",33,0)
 . .S SDRRFDA(403.5,"+1,",.01)=$P(SDRRREC,U,1)
"RTN","SDRRC20",34,0)
 . .S SDRRFDA(403.5,"+1,",2)=$P(SDRRREC,U,3)
"RTN","SDRRC20",35,0)
 . .S SDRRFDA(403.5,"+1,",2.5)=$P(SDRRREC,U,7)
"RTN","SDRRC20",36,0)
 . .S SDRRFDA(403.5,"+1,",2.6)=$P(SDRRREC,U,8)
"RTN","SDRRC20",37,0)
 . .I $P($G(SDRRREC),U,4)'="" S SDRRFDA(403.5,"+1,",3)=$P($G(SDRRREC),U,4)
"RTN","SDRRC20",38,0)
 . .I $P($G(SDRRREC),U,5)'="" S SDRRFDA(403.5,"+1,",4)=$P($G(SDRRREC),U,5)
"RTN","SDRRC20",39,0)
 . .I $P($G(SDRRREC),U,2)'="" S SDRRFDA(403.5,"+1,",4.5)=$P($G(SDRRREC),U,2)
"RTN","SDRRC20",40,0)
 . .I $P($G(SDRRREC),U,9)'="" S SDRRFDA(403.5,"+1,",4.7)=$P($G(SDRRREC),U,9)
"RTN","SDRRC20",41,0)
 . .S SDRRFDA(403.5,"+1,",5)=$P($G(SDRRREC),U,6)
"RTN","SDRRC20",42,0)
 . .I $P($G(SDRRREC),U,10)'="" S SDRRFDA(403.5,"+1,",6)=$P($G(SDRRREC),U,10)
"RTN","SDRRC20",43,0)
 . .I $P($G(SDRRREC),U,11)'="" S SDRRFDA(403.5,"+1,",7)=$P($G(SDRRREC),U,11)  ;WILL STUFF PROGRAMMER DUZ IF NOT ALREADY SET
"RTN","SDRRC20",44,0)
 . .N NEWREC S NEWREC(1)=SDAIEN
"RTN","SDRRC20",45,0)
 . .D UPDATE^DIE("","SDRRFDA","NEWREC")
"RTN","SDRRC20",46,0)
 . .S TOTAL=TOTAL+1
"RTN","SDRRC20",47,0)
 S ^XTMP("SDRRC20","COMPLETED")=$$NOW^XLFDT()
"RTN","SDRRC20",48,0)
 S ^XTMP("SDRRC20","TOT")=TOTAL
"RTN","SDRRC20",49,0)
 K ^XTMP("SDRRC20","RUNNING")
"RTN","SDRRC20",50,0)
 D SENDMSG
"RTN","SDRRC20",51,0)
 Q
"RTN","SDRRC20",52,0)
SENDMSG ;send MailMan msg to patch installer
"RTN","SDRRC20",53,0)
 N DIFROM,SDMSG,SDTXT,SDLN,XMY,XMDUZ,XMSUB,XMTEXT,XMDUN,XMZ
"RTN","SDRRC20",54,0)
 K ^TMP("SDRRC20",$J)
"RTN","SDRRC20",55,0)
 S XMSUB="SD*5.3*536 OUTPATIENT CLINIC RECALL FILE CONVERSION REPORT"
"RTN","SDRRC20",56,0)
 S XMTEXT="^TMP(""SDRRC20"",$J,",XMDUZ=.5,(XMY(DUZ),XMY(XMDUZ))=""
"RTN","SDRRC20",57,0)
 S SDLN=0
"RTN","SDRRC20",58,0)
 D ADD(.SDLN,"Patch:  SD*5.3*536 RECALL REMINDER FILE CONVERSION PROCESSING")
"RTN","SDRRC20",59,0)
 D ADD(.SDLN," "),ADD(.SDLN,"************")
"RTN","SDRRC20",60,0)
 D ADD(.SDLN,"The existing Class III file called OUTPATIENT CLINIC RECALL (687065), ")
"RTN","SDRRC20",61,0)
 D ADD(.SDLN,"which contains Clinic Recall ENTRIES have been converted to")
"RTN","SDRRC20",62,0)
 D ADD(.SDLN,"a new Class I file called Recall Reminder (403.5)")
"RTN","SDRRC20",63,0)
 D ADD(.SDLN,"which will provide the same functionality. If you have added")
"RTN","SDRRC20",64,0)
 D ADD(.SDLN,"any local site field to file 687065 they will not be moved over.")
"RTN","SDRRC20",65,0)
 D ADD(.SDLN,"************"),ADD(.SDLN," "),ADD(.SDLN," ")
"RTN","SDRRC20",66,0)
 D ADD(.SDLN,"SUMMARY OF PROCESSING RESULTS:")
"RTN","SDRRC20",67,0)
 D ADD(.SDLN,"==============================")
"RTN","SDRRC20",68,0)
 D ADD(.SDLN," ")
"RTN","SDRRC20",69,0)
 D ADD(.SDLN,"<<< The Class III OUTPATIENT CLINIC RECALL PATIENT File Conversion has "_$S(+$G(SDRRSTOP):"NOT ",1:"")_"Completed. >>>")
"RTN","SDRRC20",70,0)
 I +$G(SDRRSTOP) D
"RTN","SDRRC20",71,0)
 . D ADD(.SDLN,"    Please restart the post-install process from the following")
"RTN","SDRRC20",72,0)
 . D ADD(.SDLN,"    programmer's prompt:")
"RTN","SDRRC20",73,0)
 . D ADD(.SDLN,"                          D POST^SDRRC20")
"RTN","SDRRC20",74,0)
 D ADD(.SDLN," "),ADD(.SDLN," ")
"RTN","SDRRC20",75,0)
 D ADD(.SDLN,"  DATE/TIME TASK STARTED: "_$$FMTE^XLFDT(+$G(^XTMP("SDRRC20","START")),"P"))
"RTN","SDRRC20",76,0)
 D ADD(.SDLN,"DATE/TIME TASK COMPLETED: "_$$FMTE^XLFDT(+$G(^XTMP("SDRRC20","COMPLETED")),"P"))
"RTN","SDRRC20",77,0)
 I $D(^XTMP("SDRRC20","LAST RUN")) D
"RTN","SDRRC20",78,0)
 . D ADD(.SDLN,"      DATE/TIME LAST RUN: "_$$FMTE^XLFDT(+$G(^XTMP("SDRRC20","LAST RUN")),"P"))
"RTN","SDRRC20",79,0)
 D ADD(.SDLN," "),ADD(.SDLN," ")
"RTN","SDRRC20",80,0)
 D ADD(.SDLN,"    TOTAL RECORDS THAT HAVE BEEN CONVERTED: "_+$G(^XTMP("SDRRC20","TOT")))
"RTN","SDRRC20",81,0)
 D ADD(.SDLN,"                         <END OF REPORT> :")
"RTN","SDRRC20",82,0)
 D ^XMD
"RTN","SDRRC20",83,0)
 K ^TMP("SDRRC20",$J)
"RTN","SDRRC20",84,0)
 Q
"RTN","SDRRC20",85,0)
ADD(SDLN,SDTXT) ;add line
"RTN","SDRRC20",86,0)
 Q:$L(SDTXT)'>0
"RTN","SDRRC20",87,0)
 S SDLN=$G(SDLN)+1
"RTN","SDRRC20",88,0)
 S ^TMP("SDRRC20",$J,SDLN)=SDTXT
"RTN","SDRRC20",89,0)
 Q
"RTN","SDRRC20",90,0)
PROGCHK(XPDABORT) ;checks programmer variables
"RTN","SDRRC20",91,0)
 I '$G(DUZ)!($G(DUZ(0))'="@")!('$G(DT))!($G(U)'="^") D
"RTN","SDRRC20",92,0)
 . D BMES^XPDUTL("******")
"RTN","SDRRC20",93,0)
 . D MES^XPDUTL("Your programming variables are not set up properly.")
"RTN","SDRRC20",94,0)
 . D MES^XPDUTL("Installation aborted.")
"RTN","SDRRC20",95,0)
 . D MES^XPDUTL("******")
"RTN","SDRRC20",96,0)
 . S XPDABORT=2
"RTN","SDRRC20",97,0)
 Q
"RTN","SDRRC20",98,0)
ISRUNING(XPDABORT) ;check if running
"RTN","SDRRC20",99,0)
 I +$G(^XTMP("SDRRC20","RUNNING")) D
"RTN","SDRRC20",100,0)
 . D BMES^XPDUTL("******")
"RTN","SDRRC20",101,0)
 . D MES^XPDUTL("This patch is currently being Installed.  Try later.")
"RTN","SDRRC20",102,0)
 . D MES^XPDUTL("Installation aborted...")
"RTN","SDRRC20",103,0)
 . D MES^XPDUTL("******")
"RTN","SDRRC20",104,0)
 . S XPDABORT=2
"RTN","SDRRC20",105,0)
 Q
"RTN","SDRRC20",106,0)
NOFILE ;no File
"RTN","SDRRC20",107,0)
 D BMES^XPDUTL("******")
"RTN","SDRRC20",108,0)
 D MES^XPDUTL("The Class III Outpatient Clinic Recall File Conversion is NOT necessary because")
"RTN","SDRRC20",109,0)
 D MES^XPDUTL("file (#687065) does not exist on this system.")
"RTN","SDRRC20",110,0)
 D MES^XPDUTL("Post-Install process terminated...For conversion to Recall Reminder PATIENT (#403.5)")
"RTN","SDRRC20",111,0)
 D MES^XPDUTL("******")
"RTN","SDRRC20",112,0)
 Q
"RTN","SDRRC20",113,0)
TASK ;run TaskMan
"RTN","SDRRC20",114,0)
 N ZTSK,ZTDTH,ZTRTN,ZTDESC,ZTIO,ZTSAVE,ZTREQ,ZTSTOP,SDSTOP
"RTN","SDRRC20",115,0)
 S SDSTOP=+$G(^XTMP("SDRRC20","STOPPED"))
"RTN","SDRRC20",116,0)
 S ZTRTN="START^SDRRC20"
"RTN","SDRRC20",117,0)
 S ZTDESC="SD*5.3*536 RECALL REMINDER PATIENT FILE CONVERSION PROCESSING"
"RTN","SDRRC20",118,0)
 S ZTIO="",ZTDTH=$H,ZTREQ="@",ZTSAVE("ZTREQ")=""
"RTN","SDRRC20",119,0)
 D ^%ZTLOAD
"RTN","SDRRC20",120,0)
 D BMES^XPDUTL("******")
"RTN","SDRRC20",121,0)
 I '$D(ZTSK) D
"RTN","SDRRC20",122,0)
 . D MES^XPDUTL("Unable to schedule TaskMan task to run the Class III (687065) File")
"RTN","SDRRC20",123,0)
 . D MES^XPDUTL("Conversion.")
"RTN","SDRRC20",124,0)
 . D BMES^XPDUTL("Please re-run Post-Install routine POST^SDRRC20 from")
"RTN","SDRRC20",125,0)
 . D MES^XPDUTL("the programmer prompt.")
"RTN","SDRRC20",126,0)
 . ;
"RTN","SDRRC20",127,0)
 E  D
"RTN","SDRRC20",128,0)
 . D MES^XPDUTL("Task "_ZTSK_" has been "_$S(+SDSTOP:"Re-",1:"")_"started to run the Class III (687065) File")
"RTN","SDRRC20",129,0)
 . D MES^XPDUTL("Conversion.")
"RTN","SDRRC20",130,0)
 . I SDSTOP D
"RTN","SDRRC20",131,0)
 . . D MES^XPDUTL("  <<< The last task run was STOPPED on "_$$FMTE^XLFDT(SDSTOP,"P")_". >>>")
"RTN","SDRRC20",132,0)
 . D BMES^XPDUTL("You will receive a MailMan message when this task is completed")
"RTN","SDRRC20",133,0)
 . D MES^XPDUTL("or if it has been manually stopped.")
"RTN","SDRRC20",134,0)
 D MES^XPDUTL("******")
"RTN","SDRRC20",135,0)
 Q
"RTN","SDRRC20",136,0)
XTMP ;setup ^XTMP to control output for 90 days
"RTN","SDRRC20",137,0)
 I $D(^XTMP("SDRRC20",0)) D
"RTN","SDRRC20",138,0)
 . S ^XTMP("SDRRC20","LAST RUN")=$G(^XTMP("SDRRC20","START"))
"RTN","SDRRC20",139,0)
 E  D
"RTN","SDRRC20",140,0)
 . N SDX
"RTN","SDRRC20",141,0)
 . S SDX=$$FMADD^XLFDT($$NOW^XLFDT(),90)_U_$$NOW^XLFDT()
"RTN","SDRRC20",142,0)
 . S SDX=SDX_"^SD*5.3*536 RECALL REMINDER PATIENT FILE CONVERSION PROCESSING"
"RTN","SDRRC20",143,0)
 . S ^XTMP("SDRRC20",0)=SDX
"RTN","SDRRC20",144,0)
 S ^XTMP("SDRRC20","START")=$$NOW^XLFDT()
"RTN","SDRRC20",145,0)
 S ^XTMP("SDRRC20","RUNNING")="1"
"RTN","SDRRC20",146,0)
 Q
"RTN","SDRRC20",147,0)
UPXTMP(SDENCPTR,NODE,SDENT) ;add to ^XTMP
"RTN","SDRRC20",148,0)
 ; Input:
"RTN","SDRRC20",149,0)
 ;       NODE - Unique subscript
"RTN","SDRRC20",150,0)
 ; Output: none
"RTN","SDRRC20",151,0)
 Q:'$G(SDENCPTR)
"RTN","SDRRC20",152,0)
 I $G(NODE)="" S NODE="UNKNOWN"
"RTN","SDRRC20",153,0)
 S ^XTMP("SDRRC20","TOT2",NODE,SDENCPTR)=$G(SDENT)
"RTN","SDRRC20",154,0)
 Q
"RTN","SDRRC20",155,0)
CHECKDD ;CHECKS CURRENT FIELDS IN 687065
"RTN","SDRRC20",156,0)
 S (DDISSUE,PFLAG,PFLAG1)=""
"RTN","SDRRC20",157,0)
 S PFLAG=$P(^DD(687065,.01,0),U,2) I PFLAG'["RP2'" S DDISSUE=1  W !,"1  "_PFLAG G NOENTRY
"RTN","SDRRC20",158,0)
 S PFLAG=$P(^DD(687065,2,0),U,2) I PFLAG'["F" S DDISSUE=1 W !,"2  "_PFLAG G NOENTRY
"RTN","SDRRC20",159,0)
 S PFLAG=$P(^DD(687065,2.5,0),U,2) I PFLAG'["F" S DDISSUE=1 W !,"3  "_PFLAG G NOENTRY
"RTN","SDRRC20",160,0)
 S PFLAG=$P(^DD(687065,2.6,0),U,2),PFLAG1=$P(^DD(687065,2.6,0),U,3) I PFLAG'["S"!(PFLAG1'["f:FASTING;n:NON-FASTING") S DDISSUE=1 W !,"4  "_PFLAG G NOENTRY
"RTN","SDRRC20",161,0)
 S PFLAG=$P(^DD(687065,3,0),U,2) I PFLAG'["RP653204'" S DDISSUE=1 W !,"5  "_PFLAG G NOENTRY
"RTN","SDRRC20",162,0)
 S PFLAG=$P(^DD(687065,4,0),U,2) I PFLAG'["RP687067'" S DDISSUE=1 W !,"6  "_PFLAG G NOENTRY
"RTN","SDRRC20",163,0)
 S PFLAG=$P(^DD(687065,4.5,0),U,2) I PFLAG'["P44'" S DDISSUE=1 W !,"7  "_PFLAG G NOENTRY
"RTN","SDRRC20",164,0)
 S PFLAG=$P(^DD(687065,4.7,0),U,2) I PFLAG'["NJ3,0" S DDISSUE=1 W !,"8  "_PFLAG G NOENTRY
"RTN","SDRRC20",165,0)
 S PFLAG=$P(^DD(687065,5,0),U,2) I PFLAG'["RD" S DDISSUE=1 W !,"9  "_PFLAG G NOENTRY
"RTN","SDRRC20",166,0)
 S PFLAG=$P(^DD(687065,6,0),U,2) I PFLAG'["D" S DDISSUE=1 W !,"10  "_PFLAG G NOENTRY
"RTN","SDRRC20",167,0)
 S PFLAG=$P(^DD(687065,7,0),U,2) I PFLAG'["P200'" S DDISSUE=1 W !,"11  "_PFLAG G NOENTRY
"RTN","SDRRC20",168,0)
 Q
"RTN","SDRRC20",169,0)
NOENTRY ;no File
"RTN","SDRRC20",170,0)
 D BMES^XPDUTL("******")
"RTN","SDRRC20",171,0)
 D MES^XPDUTL("The Class III Outpatient Clinic Recall File Conversion WILL NOT happen because")
"RTN","SDRRC20",172,0)
 D MES^XPDUTL("file (#687065) has DD changes to needed fields.")
"RTN","SDRRC20",173,0)
 D MES^XPDUTL("Post-Install process terminated...For conversion to Recall Reminder(#403.5)")
"RTN","SDRRC20",174,0)
 D MES^XPDUTL("******")
"RTN","SDRRC20",175,0)
 Q 
"RTN","SDRRCLR")
0^4^B6432300
"RTN","SDRRCLR",1,0)
SDRRCLR  ;10N20/MAH;-Reminder Recall CLEAN UP ;01/18/2008  11:32
"RTN","SDRRCLR",2,0)
 ;;5.3;Scheduling;**536**;Aug 13, 1993;Build 53
"RTN","SDRRCLR",3,0)
 ; Option: SDRR CLEAN-UP
"RTN","SDRRCLR",4,0)
EN ;Entry point
"RTN","SDRRCLR",5,0)
 ;Will look at the "D" in file SD(403.5 - and loop through file 2 
"RTN","SDRRCLR",6,0)
 ;to see if appt. has been made then delete entry in file 687065
"RTN","SDRRCLR",7,0)
 ;SDRRDA=IEN FOR FILE SD(403.5
"RTN","SDRRCLR",8,0)
 ;DFN= THE PATIENTS NUMBER
"RTN","SDRRCLR",9,0)
 ;REDT = RECALL DATE
"RTN","SDRRCLR",10,0)
 ;CLINIC = CLINIC ASSIGNED FOR THAT RECALL VISIT
"RTN","SDRRCLR",11,0)
 ;CLIN1 = CLINIC ASSIGN FOR THE APPT - IN FILE 2
"RTN","SDRRCLR",12,0)
 ;CK = APPT DATE IN FILE 2 
"RTN","SDRRCLR",13,0)
 ;CK1 = IS THE APPT DATE MINUS TIME
"RTN","SDRRCLR",14,0)
 ;CAP = DIFFERENCE BETWEEN RECALL DATE AND APPT DATE - LOOKS AT -30 TO +30
"RTN","SDRRCLR",15,0)
DIV Q:'$D(^SD(403.53,0))
"RTN","SDRRCLR",16,0)
 S CRP=0 F  S CRP=$O(^SD(403.53,CRP)) Q:'CRP  D
"RTN","SDRRCLR",17,0)
 . S PDT=$P($G(^SD(403.53,CRP,0)),"^",5) Q:PDT=""
"RTN","SDRRCLR",18,0)
 . S (CNT,SDRRDA)=1
"RTN","SDRRCLR",19,0)
 . F  S CNT=$O(^SD(403.5,"D",CNT)) Q:CNT<1  D
"RTN","SDRRCLR",20,0)
 .. F  S SDRRDA=$O(^SD(403.5,"D",CNT,SDRRDA)) Q:SDRRDA<1  D
"RTN","SDRRCLR",21,0)
 ...S PROV=$P($G(^SD(403.5,SDRRDA,0)),"^",5) Q:PROV=""
"RTN","SDRRCLR",22,0)
 ...S TEAM=$P($G(^SD(403.54,PROV,0)),"^",2) Q:TEAM=""
"RTN","SDRRCLR",23,0)
 ...S DIV=$P($G(^SD(403.55,TEAM,0)),"^",4) Q:DIV'=CRP
"RTN","SDRRCLR",24,0)
 ... S DFN=$P($G(^SD(403.5,SDRRDA,0)),"^",1) I DFN="" Q
"RTN","SDRRCLR",25,0)
 ... S CLINIC=$P($G(^SD(403.5,SDRRDA,0)),"^",2) I CLINIC="" Q
"RTN","SDRRCLR",26,0)
 ... S REDT=$P($G(^SD(403.5,SDRRDA,0)),"^",6) I REDT="" Q
"RTN","SDRRCLR",27,0)
 ... D DEM^VADPT
"RTN","SDRRCLR",28,0)
 ... I $G(VADM(6),U)'="" S DA=SDRRDA,SDRRFTR=3,DIK="^SD(403.5," D ^DIK K DA,DIK Q
"RTN","SDRRCLR",29,0)
 ... N SDARRAY,SDCOUNT,SDDATE,SDAPPT,STATUS,APPT,CC,EDT,SDT
"RTN","SDRRCLR",30,0)
 ... S X1=REDT,X2=+PDT D C^%DTC S EDT=$P(X,".",1) K X,X1,X2
"RTN","SDRRCLR",31,0)
 ... S X1=REDT,X2=-PDT D C^%DTC S SDT=$P(X,".",1) K X,X1,X2
"RTN","SDRRCLR",32,0)
 ... S SDARRAY(1)=""_SDT_";"_EDT_""
"RTN","SDRRCLR",33,0)
 ... S SDARRAY(2)=CLINIC
"RTN","SDRRCLR",34,0)
 ... S SDARRAY(4)=DFN
"RTN","SDRRCLR",35,0)
 ... S SDARRAY("FLDS")="1;2;3"
"RTN","SDRRCLR",36,0)
 ... S SDCOUNT=$$SDAPI^SDAMA301(.SDARRAY)
"RTN","SDRRCLR",37,0)
 ... I SDCOUNT>0 D
"RTN","SDRRCLR",38,0)
 .... S SDDATE=0 F  S SDDATE=$O(^TMP($J,"SDAMA301",DFN,CLINIC,SDDATE)) Q:SDDATE=""  D
"RTN","SDRRCLR",39,0)
 ..... S SDAPPT=$G(^TMP($J,"SDAMA301",DFN,CLINIC,SDDATE))
"RTN","SDRRCLR",40,0)
 ..... S STATUS=$P($G(SDAPPT),"^",3)
"RTN","SDRRCLR",41,0)
 ..... S STATUS=$P(STATUS,";",1)
"RTN","SDRRCLR",42,0)
 ..... I STATUS'="R" Q
"RTN","SDRRCLR",43,0)
 ..... S APPT=$P(SDAPPT,"^",1)
"RTN","SDRRCLR",44,0)
 ..... S CK1=$P(APPT,".",1)
"RTN","SDRRCLR",45,0)
 ..... S CC=$P(SDAPPT,"^",2)
"RTN","SDRRCLR",46,0)
 ..... S CLIN1=$P(CC,";",1)
"RTN","SDRRCLR",47,0)
 ..... S CAP=$$FMDIFF^XLFDT(CK1,REDT)
"RTN","SDRRCLR",48,0)
 ..... I CAP>-PDT,CAP<PDT I CLIN1=CLINIC S DA=SDRRDA,SDRRFTR=7,DIK="^SD(403.5," D ^DIK K DA,DIK
"RTN","SDRRCLR",49,0)
 ..... Q
"RTN","SDRRCLR",50,0)
 ... I SDCOUNT<0 K ^TMP($J,"SDAMA301")
"RTN","SDRRCLR",51,0)
 .. Q
"RTN","SDRRCLR",52,0)
QUIT K CNT,SDRRDA,DFN,CLINIC,CLIN1,REDT,CK,CK1,X,CAP,STATUS,PDT,TEAM,DIV,PROV,CRP,DEATH,SDRRFTR,VADM,^TMP($J,"SDAMA301")
"RTN","SDRRCLR",53,0)
 D KVAR^VADPT
"RTN","SDRRCLR",54,0)
 Q
"RTN","SDRRCLR2")
0^5^B10431466
"RTN","SDRRCLR2",1,0)
SDRRCLR2 ;10N20/MAH- Recall Reminder ENTER EDIT 9/28/04
"RTN","SDRRCLR2",2,0)
 ;;5.3;Scheduling;**536**;Aug 13, 1993;Build 53
"RTN","SDRRCLR2",3,0)
 ;;THIS ROUTINE WILL USE OPTION SDRR CARD ADD
"RTN","SDRRCLR2",4,0)
STR ;Start checking entries in 403.5 if there is a "b" goes to update - if not goes to NEW   
"RTN","SDRRCLR2",5,0)
 N I,Y,CLINIC,C,D,KY,COMM
"RTN","SDRRCLR2",6,0)
 K ^TMP("SDRRCLR")
"RTN","SDRRCLR2",7,0)
 D ^DPTLK Q:Y<1
"RTN","SDRRCLR2",8,0)
 S DFN=+Y
"RTN","SDRRCLR2",9,0)
 I '$D(^SD(403.5,"B",DFN)) W !,"No Clinic Recall on file",! G NEW
"RTN","SDRRCLR2",10,0)
EN1 S C=0 F I=0:0 S I=$O(^SD(403.5,"B",DFN,I)) Q:'I  I $D(^SD(403.5,I,0)) S D=^(0),C=C+1 S ^TMP("SDRRCLR",$J,C)=I_"^"_D
"RTN","SDRRCLR2",11,0)
 S (ER,OK)=0 W !,"CHOOSE FROM:" F I=0:0 S I=$O(^TMP("SDRRCLR",$J,I)) Q:'I   S CLINIC=$P($G(^TMP("SDRRCLR",$J,I)),"^",3) D
"RTN","SDRRCLR2",12,0)
 .W !,$J(I,4),">  "
"RTN","SDRRCLR2",13,0)
 .I CLINIC'="" S CLINIC=$$GET1^DIQ(44,CLINIC_",",.01)
"RTN","SDRRCLR2",14,0)
 .I CLINIC="" S CLINIC="UNK. CLINIC"
"RTN","SDRRCLR2",15,0)
 .S PROV=$P($G(^TMP("SDRRCLR",$J,I)),"^",6) I PROV'="" S PROV=$P($G(^SD(403.54,PROV,0)),"^",1) I PROV'="" S PROV=$$NAME^XUSER(PROV,"F")
"RTN","SDRRCLR2",16,0)
 .I PROV="" S PROV="UNK. PROVIDER"
"RTN","SDRRCLR2",17,0)
 .S RDT=$P(^TMP("SDRRCLR",$J,I),"^",7) S Y=RDT D DD^%DT S RDT=Y
"RTN","SDRRCLR2",18,0)
 .S RS=$P(^TMP("SDRRCLR",$J,I),"^",11) S Y=RS D DD^%DT S RS=Y
"RTN","SDRRCLR2",19,0)
 .S COMM="",COMM=$P(^TMP("SDRRCLR",$J,I),"^",8)
"RTN","SDRRCLR2",20,0)
 .W ?1,"CLINIC:"_$E(CLINIC,1,15),?28," R/DATE:"_RDT,?53," NOTICE SENT:"_RS
"RTN","SDRRCLR2",21,0)
 .W !,?5,"PROVIDER:"_$E(PROV,1,20) S Z=I I $G(COMM)]"" W !,?5,$G(COMM) S Z=I
"RTN","SDRRCLR2",22,0)
 W !,"CHOOSE 1-",Z_" OR TYPE ""A"" TO ADD:" W:$D(^TMP("SDRRCLR",$J,I+1)) !,"OR '^' TO QUIT" W ": " R X:DTIME I $S('$T!(X["^"):1,X="":1,1:0) S ER=1 G QUIT
"RTN","SDRRCLR2",23,0)
 G QUIT:ER
"RTN","SDRRCLR2",24,0)
 I X["A" G NEW
"RTN","SDRRCLR2",25,0)
 S DA=$P($G(^TMP("SDRRCLR",$J,X)),"^",1) I DA="" K DA,C,CLINIC,PROV,RDT G EN1
"RTN","SDRRCLR2",26,0)
 S (PROV1,KEY,FLAG)="" S PROV1=$P($G(^SD(403.5,DA,0)),"^",5) I PROV1'="" S KEY=$P($G(^SD(403.54,PROV1,0)),"^",7) D
"RTN","SDRRCLR2",27,0)
 .I PROV1="" Q
"RTN","SDRRCLR2",28,0)
 .I KEY="" Q
"RTN","SDRRCLR2",29,0)
 .N VALUE
"RTN","SDRRCLR2",30,0)
 .S VALUE=$$LKUP^XPDKEY(KEY) K KY D OWNSKEY^XUSRB(.KY,VALUE,DUZ)
"RTN","SDRRCLR2",31,0)
 .I $P(KY(0),"^",1)=0 W !,?25,"**YOU DO NOT HAVE ACCESS TO THIS ENTRY**",!,?12,"PLEASE CHECK WITH YOUR ADPAC OR IRM TO GET THE PROPER SECURITY KEY" R X:3 K KEY,PROV1 D QUIT S FLAG=1
"RTN","SDRRCLR2",32,0)
 .Q
"RTN","SDRRCLR2",33,0)
 I FLAG=1 K FLAG Q
"RTN","SDRRCLR2",34,0)
 ;END OF NEW CHANGE
"RTN","SDRRCLR2",35,0)
 G UPDATE
"RTN","SDRRCLR2",36,0)
 Q
"RTN","SDRRCLR2",37,0)
 ;
"RTN","SDRRCLR2",38,0)
 ;
"RTN","SDRRCLR2",39,0)
NEW ;Adds new entry
"RTN","SDRRCLR2",40,0)
 W !!,"*Must have Recall Date,approved Recall Clinic,Recall Provider and Type of Recall"
"RTN","SDRRCLR2",41,0)
 S DIR(0)="Y",DIR("A")="Do you have this information",DIR("B")="NO" D ^DIR I Y'=1 G QUIT
"RTN","SDRRCLR2",42,0)
 S (DIC,DIE)="^SD(403.5,",DIC(0)="LZ",X=DFN,DLAYGO=403.5 D FILE^DICN S NUM=+Y
"RTN","SDRRCLR2",43,0)
 S DA=NUM,DR="[SDRR RECALL CARD ADD]",DIE("NO^")="Not Allowed" D ^DIE
"RTN","SDRRCLR2",44,0)
 K DIC,DIE,DR,D0,DA,DLAYGO,NUM,PROV,X,Y,Z,OK,RDT,DIR
"RTN","SDRRCLR2",45,0)
 Q
"RTN","SDRRCLR2",46,0)
UPDATE ;Asks for new data
"RTN","SDRRCLR2",47,0)
 K DIC,DIE,DR S DIE="^SD(403.5,",DR="[SDRR RECALL CARD ADD]",DIE("NO^")="BACKOUTOK" D ^DIE
"RTN","SDRRCLR2",48,0)
 K DIC,DIE,DR,D0,DA,DLAYGO,NUM,PROV,X,Y,Z,OK,RDT
"RTN","SDRRCLR2",49,0)
 D QUIT
"RTN","SDRRCLR2",50,0)
 Q
"RTN","SDRRCLR2",51,0)
QUIT K PROV,CLINIC,X,Y,C,D,ER,OK,DFN,FLAG,RS,KEY,KEYIFN,PROV1,PTN,RDT,DIR
"RTN","SDRRCLR2",52,0)
 K ^TMP("SDRRCLR",$J)
"RTN","SDRRCLR2",53,0)
 Q
"RTN","SDRRCRR")
0^6^B75514794
"RTN","SDRRCRR",1,0)
SDRRCRR ;10N20/MAH;clinic recall list report; 11/8/2006
"RTN","SDRRCRR",2,0)
 ;;5.3;Scheduling;**536**;Aug 13, 1993;Build 53
"RTN","SDRRCRR",3,0)
STR K DIR,Y,DTOUT,DIROUT,DIRUT,DUOUT,Q,X
"RTN","SDRRCRR",4,0)
 S DIR(0)="SO^1:All Clinics;2:Selected Clinics;3:Selected Team"
"RTN","SDRRCRR",5,0)
 W ! S DIR("A")="Please select what type of Clinic Recall List you are looking for"
"RTN","SDRRCRR",6,0)
 D ^DIR G:$D(DUOUT)!($D(DTOUT)!($D(DIRUT))) QUIT S Q=Y
"RTN","SDRRCRR",7,0)
 I Q=1 K DIR D DATE,EN G QUIT
"RTN","SDRRCRR",8,0)
 I Q=2 K DIR D DATE,EN1 G QUIT
"RTN","SDRRCRR",9,0)
 I Q=3 K DIR D DATE G EN2^SDRRCRR1
"RTN","SDRRCRR",10,0)
DATE ;SETS UP TO FROM DATE AND WILL GROUP BY MONTH IF SELECTED MULTIPLE MONTHS
"RTN","SDRRCRR",11,0)
 S %DT="AEX",%DT("A")="Start with Recall Date First: " D ^%DT G:Y<0 STR S SDT=Y K Y
"RTN","SDRRCRR",12,0)
 S %DT("A")="Recall Date Lasted: " D ^%DT I Y<SDT W $C(7),"  Can't be before Recall Date First - Try Again" G DATE
"RTN","SDRRCRR",13,0)
 Q:Y<0  S EDT=Y K Y
"RTN","SDRRCRR",14,0)
 Q
"RTN","SDRRCRR",15,0)
EN ;all clinics by division
"RTN","SDRRCRR",16,0)
 Q:'$D(SDT)
"RTN","SDRRCRR",17,0)
 W ! S SDEND=1 D ASK2^SDDIV G:Y<0 QUIT
"RTN","SDRRCRR",18,0)
 I VAUTD=1 G ENDIV
"RTN","SDRRCRR",19,0)
 I VAUTD=0 G ONDIV
"RTN","SDRRCRR",20,0)
 Q
"RTN","SDRRCRR",21,0)
ENDIV ;
"RTN","SDRRCRR",22,0)
 W !!,"***This report requires 132 columns",!! S %ZIS="QM" D ^%ZIS G:POP QUIT
"RTN","SDRRCRR",23,0)
 I $D(IO("Q")) S ZTDESC="Print Recall List for Division",ZTRTN="EDIV^SDRRCRR" S ZTSAVE("*")="" D ^%ZTLOAD G QUIT
"RTN","SDRRCRR",24,0)
EDIV K ^TMP($J,"ENDIV")
"RTN","SDRRCRR",25,0)
 S (PRO,PRO1,PRO2,RDT,CDT,CDT1,PAT,PHONE,CLINIC,COMMENT)=""
"RTN","SDRRCRR",26,0)
 S ZPR=0 F  S ZPR=$O(^SD(403.5,"C",ZPR)) Q:ZPR=""  S DIV=$P($G(^SD(403.54,ZPR,0)),"^",3) S D0=0 F  S D0=$O(^SD(403.5,"C",ZPR,D0)) Q:D0=""  S DTA=$G(^SD(403.5,D0,0)) D:DTA]""
"RTN","SDRRCRR",27,0)
 .S RDT=$P($G(DTA),"^",6) Q:RDT=""
"RTN","SDRRCRR",28,0)
 .Q:RDT<SDT!(RDT>EDT)
"RTN","SDRRCRR",29,0)
 .S MONTH=$E(RDT,4,5),YR=$E(RDT,2,3)
"RTN","SDRRCRR",30,0)
 .S CLINIC=$P($G(DTA),"^",2) I CLINIC'="" S CLINIC=$$GET1^DIQ(44,CLINIC_",",.01)
"RTN","SDRRCRR",31,0)
 .I CLINIC="" S CLINIC="Unknown Clinic"  ;CLINIC
"RTN","SDRRCRR",32,0)
 .S Y=RDT D DD^%DT S DATE=Y K Y  ;RECALL DATE
"RTN","SDRRCRR",33,0)
 .S PAT=$P($G(DTA),"^",1)
"RTN","SDRRCRR",34,0)
 .Q:$$TESTPAT^VADPT(PAT)
"RTN","SDRRCRR",35,0)
 .S DFN=PAT
"RTN","SDRRCRR",36,0)
 .D ADD^VADPT,DEM^VADPT
"RTN","SDRRCRR",37,0)
 .S LN=$E(VADM(1),1)_$P(VA("BID"),U)
"RTN","SDRRCRR",38,0)
 .S PAT1=$P(VADM(1),U)
"RTN","SDRRCRR",39,0)
 .S (CDT,CDT1)="",Y=$P($G(DTA),"^",10) I Y'="" D DD^%DT S CDT=Y K Y D
"RTN","SDRRCRR",40,0)
 ..S Z=$P($G(DTA),"^",13) I Z'=""
"RTN","SDRRCRR",41,0)
 ..S CDT1="*"_CDT K Z
"RTN","SDRRCRR",42,0)
 ..I CDT1'="" S CDT=CDT1
"RTN","SDRRCRR",43,0)
 .I CDT="" S CDT="NotSent"
"RTN","SDRRCRR",44,0)
 .S PHONE=$P(VAPA(8),U)
"RTN","SDRRCRR",45,0)
 .I PHONE="" S PHONE="Unk. Phone"  ;phone
"RTN","SDRRCRR",46,0)
 .S COMMENT=$P($G(DTA),"^",7)
"RTN","SDRRCRR",47,0)
 .S PRO=$P($G(DTA),"^",5) I PRO'="" S PRO1=$P($G(^SD(403.54,PRO,0)),"^",1)
"RTN","SDRRCRR",48,0)
 .I PRO1'="" S PRO2=$$NAME^XUSER(PRO1,"F")
"RTN","SDRRCRR",49,0)
 .I PRO="" S PRO2="Unk. Provider"
"RTN","SDRRCRR",50,0)
 .S USER=$P($G(DTA),"^",11) I USER'="" S USER1=$$NAME^XUSER(USER)
"RTN","SDRRCRR",51,0)
 .I USER="" S USER1="Unk. User"
"RTN","SDRRCRR",52,0)
 .S ^TMP($J,"ENDIV",DIV,CLINIC,PRO2,MONTH,RDT,PAT1)=CLINIC_"^"_PRO2_"^"_DATE_"^"_CDT_"^"_PAT1_"^"_PHONE_"^"_COMMENT_"^"_USER1_"^"_LN
"RTN","SDRRCRR",53,0)
 .K CLINIC,USER,PRO,PAT,RDT,CDT,CDT1
"RTN","SDRRCRR",54,0)
 D PRT1^SDRRCRRP
"RTN","SDRRCRR",55,0)
 D ^%ZISC
"RTN","SDRRCRR",56,0)
 G QUIT
"RTN","SDRRCRR",57,0)
ONDIV ;
"RTN","SDRRCRR",58,0)
 W !!,"***This report requires 132 columns",!! S %ZIS="QM" D ^%ZIS G:POP QUIT
"RTN","SDRRCRR",59,0)
 I $D(IO("Q")) S ZTIO=ION,ZTDESC="Print Recall List for Division",ZTRTN="ONDIV1^SDRRCRR" S ZTSAVE("*")="" D ^%ZTLOAD G QUIT
"RTN","SDRRCRR",60,0)
ONDIV1 ;
"RTN","SDRRCRR",61,0)
 K ^TMP($J,"ONDIV")
"RTN","SDRRCRR",62,0)
 U IO
"RTN","SDRRCRR",63,0)
 S (PRO,RDT,CDT,CDT1,PAT,PHONE,CLINIC,COMMENT)=""
"RTN","SDRRCRR",64,0)
 S DIV=0
"RTN","SDRRCRR",65,0)
 F  S DIV=$O(VAUTD(DIV)) Q:DIV=""  D
"RTN","SDRRCRR",66,0)
 .S ZPR=0 F  S ZPR=$O(^SD(403.5,"C",ZPR)) Q:ZPR=""  I $P($G(^SD(403.54,ZPR,0)),"^",3)=DIV S D0=0 F  S D0=$O(^SD(403.5,"C",ZPR,D0)) Q:D0=""  S DTA=$G(^SD(403.5,D0,0)) D:DTA]""
"RTN","SDRRCRR",67,0)
 ..S RDT=$P($G(DTA),"^",6) Q:RDT=""
"RTN","SDRRCRR",68,0)
 ..Q:RDT<SDT!(RDT>EDT)
"RTN","SDRRCRR",69,0)
 ..S MONTH=$E(RDT,4,5),YR=$E(RDT,2,3)
"RTN","SDRRCRR",70,0)
 ..S CLINIC=$P($G(DTA),"^",2) I CLINIC'="" S CLINIC=$$GET1^DIQ(44,CLINIC_",",.01)
"RTN","SDRRCRR",71,0)
 ..I CLINIC="" S CLINIC="Unknown Clinic"  ;CLINIC
"RTN","SDRRCRR",72,0)
 ..S Y=RDT D DD^%DT S DATE=Y K Y  ;RECALL DATE
"RTN","SDRRCRR",73,0)
 ..S PAT=$P($G(DTA),"^",1)
"RTN","SDRRCRR",74,0)
 ..Q:$$TESTPAT^VADPT(PAT)
"RTN","SDRRCRR",75,0)
 ..S DFN=PAT
"RTN","SDRRCRR",76,0)
 ..D ADD^VADPT,DEM^VADPT
"RTN","SDRRCRR",77,0)
 ..S LN=$E(VADM(1),1)_$P(VA("BID"),U)
"RTN","SDRRCRR",78,0)
 ..S PAT1=$P(VADM(1),U)
"RTN","SDRRCRR",79,0)
 ..S (CDT,CDT1)="",Y=$P($G(DTA),"^",10) I Y'="" D DD^%DT S CDT=Y K Y
"RTN","SDRRCRR",80,0)
 ..S Z=$P($G(DTA),"^",13) I Z'="" S CDT1="*"_CDT K Z D
"RTN","SDRRCRR",81,0)
 ...I CDT1'="" S CDT=CDT1
"RTN","SDRRCRR",82,0)
 .. I CDT="" S CDT="NotSent"
"RTN","SDRRCRR",83,0)
 ..S PHONE=$P(VAPA(8),U)
"RTN","SDRRCRR",84,0)
 ..I PHONE="" S PHONE="Unk. Phone"  ;phone
"RTN","SDRRCRR",85,0)
 ..S COMMENT=$P($G(DTA),"^",7)
"RTN","SDRRCRR",86,0)
 ..S PRO=$P($G(DTA),"^",5) I PRO'="" S PRO1=$P($G(^SD(403.54,PRO,0)),"^",1),PRO2=$$NAME^XUSER(PRO1,"F")
"RTN","SDRRCRR",87,0)
 ..I PRO="" S PRO2="Unk. Provider"
"RTN","SDRRCRR",88,0)
 ..S USER=$P($G(DTA),"^",11) I USER'="" S USER1=$$NAME^XUSER(USER)
"RTN","SDRRCRR",89,0)
 ..I USER="" S USER1="Unk. User"
"RTN","SDRRCRR",90,0)
 ..S ^TMP($J,"ONDIV",DIV,CLINIC,PRO2,MONTH,RDT,PAT1)=CLINIC_"^"_PRO2_"^"_DATE_"^"_CDT_"^"_PAT1_"^"_PHONE_"^"_COMMENT_"^"_USER1_"^"_LN
"RTN","SDRRCRR",91,0)
 ..K CLINIC,USER,PRO,PAT,RDT,CDT,CDT1
"RTN","SDRRCRR",92,0)
 D PRT^SDRRCRRP
"RTN","SDRRCRR",93,0)
 D ^%ZISC
"RTN","SDRRCRR",94,0)
 G QUIT
"RTN","SDRRCRR",95,0)
EN1 ;BY CLINIC SELECTED CLINIC
"RTN","SDRRCRR",96,0)
 Q:'$D(SDT)
"RTN","SDRRCRR",97,0)
 N VAUTSTR,VAUTVB
"RTN","SDRRCRR",98,0)
 S DIC="^SC(",VAUTVB="VAUTC",VAUTSTR="clinic",VAUTNI="1"     ;G FIRST^VAUTOMA
"RTN","SDRRCRR",99,0)
 S DIC(0)="EQMNZ",DIC("A")="Select "_VAUTSTR_": " K @VAUTVB S (@VAUTVB,Y)=0
"RTN","SDRRCRR",100,0)
REDO N VAERR,VAI,VAUTNALL,VAUTX
"RTN","SDRRCRR",101,0)
 W !,DIC("A") W:'$D(VAUTNALL) "ALL// " R X:DTIME G QUIT:(X="^")!'$T D:X["?" QQ I X="" G:$D(VAUTNALL) QUIT S @VAUTVB=1 G CLIN
"RTN","SDRRCRR",102,0)
 S DIC("A")="Select another "_VAUTSTR_": " D ^DIC G:Y'>0 REDO D SET
"RTN","SDRRCRR",103,0)
 F VAI=1:0:19 W !,DIC("A") R X:DTIME G QUIT:(X="^")!'$T K Y Q:X=""  D QQ:X["?" S:$E(X)="-" VAUTX=X,X=$E(VAUTX,2,999) D ^DIC I Y>0 D SET G:VAX REDO S:'VAERR VAI=VAI+1
"RTN","SDRRCRR",104,0)
CLIN ;
"RTN","SDRRCRR",105,0)
 I VAUTC=1 G ENCLIN
"RTN","SDRRCRR",106,0)
 I VAUTC=0 G ONCLIN
"RTN","SDRRCRR",107,0)
 Q
"RTN","SDRRCRR",108,0)
QQ W !!,"Please select up to 20 clinics that you would like to print"
"RTN","SDRRCRR",109,0)
 Q
"RTN","SDRRCRR",110,0)
ONCLIN  W !!,"***This report requires 132 columns",!! S %ZIS="QM" D ^%ZIS G:POP QUIT
"RTN","SDRRCRR",111,0)
 I $D(IO("Q")) S ZTIO=ION,ZTDESC="Print Recall List for Clinics",ZTRTN="ONCLIN1^SDRRCRR" S ZTSAVE("*")="" D ^%ZTLOAD G QUIT
"RTN","SDRRCRR",112,0)
ONCLIN1 ;
"RTN","SDRRCRR",113,0)
 K ^TMP($J,"ONCLIN")
"RTN","SDRRCRR",114,0)
 S (PRO,RDT,CDT,CDT1,PAT,PHONE,CLINIC,COMMENT)=""
"RTN","SDRRCRR",115,0)
 S DIV=0
"RTN","SDRRCRR",116,0)
 F  S DIV=$O(VAUTC(DIV)) Q:DIV=""  S ZPR=$P(VAUTC(DIV),"^",1) D
"RTN","SDRRCRR",117,0)
 .S D0=0 F  S D0=$O(^SD(403.5,"E",ZPR,D0)) Q:D0=""  S DTA=$G(^SD(403.5,D0,0)) D:DTA]""
"RTN","SDRRCRR",118,0)
 ..S RDT=$P($G(DTA),"^",6) Q:RDT=""
"RTN","SDRRCRR",119,0)
 ..Q:RDT<SDT!(RDT>EDT)
"RTN","SDRRCRR",120,0)
 ..S MONTH=$E(RDT,4,5),YR=$E(RDT,2,3)
"RTN","SDRRCRR",121,0)
 ..S CLINIC=$P($G(DTA),"^",2) Q:CLINIC'=ZPR  I CLINIC'="" S CLINIC=$$GET1^DIQ(44,CLINIC_",",.01)
"RTN","SDRRCRR",122,0)
 ..I CLINIC="" S CLINIC="Unknown Clinic"  ;CLINIC
"RTN","SDRRCRR",123,0)
 ..S Y=RDT D DD^%DT S DATE=Y K Y  ;RECALL DATE
"RTN","SDRRCRR",124,0)
 ..S PAT=$P($G(DTA),"^",1)
"RTN","SDRRCRR",125,0)
 ..Q:$$TESTPAT^VADPT(PAT)
"RTN","SDRRCRR",126,0)
 ..S DFN=PAT
"RTN","SDRRCRR",127,0)
 ..D ADD^VADPT,DEM^VADPT
"RTN","SDRRCRR",128,0)
 ..S LN=$E(VADM(1),1)_$P(VA("BID"),U)
"RTN","SDRRCRR",129,0)
 ..S PAT1=$P(VADM(1),U)
"RTN","SDRRCRR",130,0)
 ..S CDT="",Y=$P($G(DTA),"^",10) I Y'="" D DD^%DT S CDT=Y K Y
"RTN","SDRRCRR",131,0)
 ..S Z=$P($G(DTA),"^",13) I Z'="" S CDT1="*"_CDT K Z D
"RTN","SDRRCRR",132,0)
 ...I CDT1'="" S CDT=CDT1
"RTN","SDRRCRR",133,0)
 ..I CDT="" S CDT="NotSent"
"RTN","SDRRCRR",134,0)
 ..S PHONE=$P(VAPA(8),U)
"RTN","SDRRCRR",135,0)
 ..I PHONE="" S PHONE="Unk. Phone"  ;phone
"RTN","SDRRCRR",136,0)
 ..S COMMENT=$P($G(DTA),"^",7)
"RTN","SDRRCRR",137,0)
 ..S PRO=$P($G(DTA),"^",5) I PRO'="" S PRO1=$P($G(^SD(403.54,PRO,0)),"^",1),PRO2=$$NAME^XUSER(PRO1,"F")
"RTN","SDRRCRR",138,0)
 ..I PRO="" S PRO2="Unk. Provider"
"RTN","SDRRCRR",139,0)
 ..S USER=$P($G(DTA),"^",11) I USER'="" S USER1=$$NAME^XUSER(USER)
"RTN","SDRRCRR",140,0)
 ..I USER="" S USER1="Unk. User"
"RTN","SDRRCRR",141,0)
 ..S ^TMP($J,"ONCLIN",DIV,CLINIC,PRO2,MONTH,RDT,PAT1)=CLINIC_"^"_PRO2_"^"_DATE_"^"_CDT_"^"_PAT1_"^"_PHONE_"^"_COMMENT_"^"_USER1_"^"_LN
"RTN","SDRRCRR",142,0)
 ..K CLINIC,USER,PRO,PAT,RDT,CDT,CDT1
"RTN","SDRRCRR",143,0)
 D PRT2^SDRRCRRP
"RTN","SDRRCRR",144,0)
 D ^%ZISC
"RTN","SDRRCRR",145,0)
 G QUIT
"RTN","SDRRCRR",146,0)
 ;by division works fine
"RTN","SDRRCRR",147,0)
ENCLIN  W !!,"***This report requires 132 columns",!! S %ZIS="QM" D ^%ZIS Q:POP 
"RTN","SDRRCRR",148,0)
 I $D(IO("Q")) D ^%ZIS G:POP QUIT S ZTIO=ION,ZTDESC="Print Recall List for Clinics",ZTRTN="ENCLIN1^SDRRCRR" S ZTSAVE("*")="" D ^%ZTLOAD G QUIT
"RTN","SDRRCRR",149,0)
ENCLIN1 ;
"RTN","SDRRCRR",150,0)
 K ^TMP($J,"ENCLIN")
"RTN","SDRRCRR",151,0)
 S (PRO,RDT,CDT,CDT1,PAT,PHONE,CLINIC,COMMENT)=""
"RTN","SDRRCRR",152,0)
 S ZPR=0 F  S ZPR=$O(^SD(403.5,"E",ZPR)) Q:ZPR=""  S D0=0 F  S D0=$O(^SD(403.5,"E",ZPR,D0)) Q:D0=""  S DTA=$G(^SD(403.5,D0,0)) D:DTA]""
"RTN","SDRRCRR",153,0)
 .S RDT=$P($G(DTA),"^",6) Q:RDT=""
"RTN","SDRRCRR",154,0)
 .Q:RDT<SDT!(RDT>EDT)
"RTN","SDRRCRR",155,0)
 .S MONTH=$E(RDT,4,5),YR=$E(RDT,2,3)
"RTN","SDRRCRR",156,0)
 .S CLINIC=$P($G(DTA),"^",2),DIV=CLINIC I CLINIC'="" S CLINIC=$$GET1^DIQ(44,CLINIC_",",.01)
"RTN","SDRRCRR",157,0)
 .I DIV="" S DIV="Unknown"
"RTN","SDRRCRR",158,0)
 .I CLINIC="" S CLINIC="Unknown Clinic"  ;CLINIC
"RTN","SDRRCRR",159,0)
 .S Y=RDT D DD^%DT S DATE=Y K Y  ;RECALL DATE
"RTN","SDRRCRR",160,0)
 .S PAT=$P($G(DTA),"^",1)
"RTN","SDRRCRR",161,0)
 .Q:$$TESTPAT^VADPT(PAT)
"RTN","SDRRCRR",162,0)
 .S DFN=PAT
"RTN","SDRRCRR",163,0)
 .D ADD^VADPT,DEM^VADPT
"RTN","SDRRCRR",164,0)
 .S LN=$E(VADM(1),1)_$P(VA("BID"),U)
"RTN","SDRRCRR",165,0)
 .S PAT1=$P(VADM(1),U)
"RTN","SDRRCRR",166,0)
 .S (CDT,CDT1)="",Y=$P($G(DTA),"^",10) I Y'="" D DD^%DT S CDT=Y K Y
"RTN","SDRRCRR",167,0)
 .S Z=$P($G(DTA),"^",13) I Z'="" S CDT1="*"_CDT K Z D
"RTN","SDRRCRR",168,0)
 ..I CDT1'="" S CDT=CDT1
"RTN","SDRRCRR",169,0)
 .I CDT="" S CDT="NotSent"
"RTN","SDRRCRR",170,0)
 .S PHONE=$P(VAPA(8),U)
"RTN","SDRRCRR",171,0)
 .I PHONE="" S PHONE="Unk. Phone"  ;phone
"RTN","SDRRCRR",172,0)
 .S COMMENT=$P($G(DTA),"^",7)
"RTN","SDRRCRR",173,0)
 .S PRO=$P($G(DTA),"^",5) I PRO'="" S PRO1=$P($G(^SD(403.54,PRO,0)),"^",1),PRO2=$$NAME^XUSER(PRO1,"F")
"RTN","SDRRCRR",174,0)
 .I PRO="" S PRO2="Unk. Provider"
"RTN","SDRRCRR",175,0)
 .S USER=$P($G(DTA),"^",11) I USER'="" S USER1=$$NAME^XUSER(USER)
"RTN","SDRRCRR",176,0)
 .I USER="" S USER1="Unk. User"
"RTN","SDRRCRR",177,0)
 .S ^TMP($J,"ENCLIN",DIV,CLINIC,PRO2,MONTH,RDT,PAT1)=CLINIC_"^"_PRO2_"^"_DATE_"^"_CDT_"^"_PAT1_"^"_PHONE_"^"_COMMENT_"^"_USER1_"^"_LN
"RTN","SDRRCRR",178,0)
 .K CLINIC,USER,PRO,PAT,RDT,CDT,CDT1
"RTN","SDRRCRR",179,0)
 D PRT3^SDRRCRRP
"RTN","SDRRCRR",180,0)
 D ^%ZISC
"RTN","SDRRCRR",181,0)
  G QUIT
"RTN","SDRRCRR",182,0)
 ;BY CLINICS WORK FINE
"RTN","SDRRCRR",183,0)
SET S VAX=0 I $D(VAUTX) S J=$S(VAUTNI=2:+Y,1:$P(Y(0),"^")) K VAUTX S VAERR=$S($D(@VAUTVB@(J)):0,1:1) W $S('VAERR:"...removed from list...",1:"...not on list...can't remove") Q:VAERR  S VAI=VAI-1 K @VAUTVB@(J) S:$O(@VAUTVB@(0))']"" VAX=1 Q
"RTN","SDRRCRR",184,0)
 S VAERR=0 I $S($D(@VAUTVB@($P(Y(0),U))):1,$D(@VAUTVB@(+Y)):1,1:0) W !?3,*7,"You have already selected that ",VAUTSTR,".  Try again." S VAERR=1
"RTN","SDRRCRR",185,0)
 I VAUTNI=1 S @VAUTVB@($P(Y(0),U))=+Y Q
"RTN","SDRRCRR",186,0)
 I VAUTNI=3 S @VAUTVB@($P(Y(0,0),U))=+Y Q
"RTN","SDRRCRR",187,0)
 S @VAUTVB@(+Y)=$P(Y(0),U) Q
"RTN","SDRRCRR",188,0)
QUIT K DIR,Y,SDT,EDT,X,D0,COMMENT,DATE,DIC,I,DTA,DIV,J,LN,MONTH,PAT1,PHONE,POP,PRO1,PRO2,Q,SDEND,SSN,USER1,%,VAUTC,VAUTD,VA,YR,ZPR,VAUTNI
"RTN","SDRRCRR",189,0)
 K ZTDESC,ZTIO,ZTRTN,ZTSAVE,%DT,%ZIS,DFN,VAX,VADM,VAPA
"RTN","SDRRCRR",190,0)
 D KVAR^VADPT
"RTN","SDRRCRR",191,0)
 Q
"RTN","SDRRCRR1")
0^7^B30605766
"RTN","SDRRCRR1",1,0)
SDRRCRR1 ;10N20/MAH;Recall Reminder list report; 11/8/2006
"RTN","SDRRCRR1",2,0)
 ;;5.3;Scheduling;**536**;Aug 13, 1993;Build 53
"RTN","SDRRCRR1",3,0)
EN2 ;BY Teams SELECTED Team
"RTN","SDRRCRR1",4,0)
 G:'$D(SDT) QUIT
"RTN","SDRRCRR1",5,0)
 N VAUTSTR,VAUTVB
"RTN","SDRRCRR1",6,0)
 S DIC="^SD(403.55,",VAUTVB="VAUTT",VAUTSTR="Team",VAUTNI="1"
"RTN","SDRRCRR1",7,0)
 S DIC(0)="EQMNZ",DIC("A")="Select "_VAUTSTR_": " K @VAUTVB S (@VAUTVB,Y)=0
"RTN","SDRRCRR1",8,0)
REDO1 N VAERR,VAI,VAUTNALL,VAUTX
"RTN","SDRRCRR1",9,0)
 W !,DIC("A") W:'$D(VAUTNALL) "ALL// " R X:DTIME G QUIT:(X="^")!'$T D:X["?" QQQ I X="" G:$D(VAUTNALL) QUIT S @VAUTVB=1 G TEAM
"RTN","SDRRCRR1",10,0)
 S DIC("A")="Select another "_VAUTSTR_": " D ^DIC G:Y'>0 REDO1 D SET
"RTN","SDRRCRR1",11,0)
 F VAI=1:0:19 W !,DIC("A") R X:DTIME G QUIT:(X="^")!'$T K Y Q:X=""  D QQQ:X["?" S:$E(X)="-" VAUTX=X,X=$E(VAUTX,2,999) D ^DIC I Y>0 D SET G:VAX REDO1 S:'VAERR VAI=VAI+1
"RTN","SDRRCRR1",12,0)
TEAM ;
"RTN","SDRRCRR1",13,0)
 I VAUTT=1 G ENTEAM
"RTN","SDRRCRR1",14,0)
 I VAUTT=0 G ONTEAM
"RTN","SDRRCRR1",15,0)
 Q
"RTN","SDRRCRR1",16,0)
QQQ W !!,"Please select up to 20 Team that you would like to print" Q
"RTN","SDRRCRR1",17,0)
ENTEAM  W !!,"***This report requires 132 columns",!! S %ZIS="QM" D ^%ZIS G:POP QUIT
"RTN","SDRRCRR1",18,0)
 I $D(IO("Q")) S ZTIO=ION,ZTDESC="Print Recall List for Clinics",ZTRTN="ENTEAM1^SDRRCRR1" S ZTSAVE("*")="" D ^%ZTLOAD G QUIT
"RTN","SDRRCRR1",19,0)
ENTEAM1 ;ALL TEAMS
"RTN","SDRRCRR1",20,0)
 K ^TMP($J,"ENTEAM")
"RTN","SDRRCRR1",21,0)
 S (PRO,RDT,CDT,CDT1,PAT,PHONE,CLINIC,COMMENT,DIV,DIV1,TEST)=""
"RTN","SDRRCRR1",22,0)
 S ZPR=0 F  S ZPR=$O(^SD(403.5,"C",ZPR)) Q:ZPR=""  S D0=0 F  S D0=$O(^SD(403.5,"C",ZPR,D0)) Q:D0=""  S DTA=$G(^SD(403.5,D0,0)) D:DTA]""
"RTN","SDRRCRR1",23,0)
 .S TEST=$P($G(^SD(403.5,D0,0)),U,5) S DIV=$P($G(^SD(403.54,TEST,0)),U,2)
"RTN","SDRRCRR1",24,0)
 .I DIV'="" S DIV1=$P($G(^SD(403.55,DIV,0)),"^",1)
"RTN","SDRRCRR1",25,0)
 .I DIV1="" S DIV1="Unknown"
"RTN","SDRRCRR1",26,0)
 .S RDT=$P($G(DTA),"^",6) Q:RDT=""
"RTN","SDRRCRR1",27,0)
 .Q:RDT<SDT!(RDT>EDT)
"RTN","SDRRCRR1",28,0)
 .S MONTH=$E(RDT,4,5),YR=$E(RDT,2,3)
"RTN","SDRRCRR1",29,0)
 .S CLINIC=$P($G(DTA),"^",2),DIV=CLINIC I CLINIC'="" S CLINIC=$$GET1^DIQ(44,CLINIC_",",.01)
"RTN","SDRRCRR1",30,0)
 .I CLINIC="" S CLINIC="Unknown Clinic"  ;CLINIC
"RTN","SDRRCRR1",31,0)
 .S Y=RDT D DD^%DT S DATE=Y K Y  ;RECALL DATE
"RTN","SDRRCRR1",32,0)
 .S PAT=$P($G(DTA),"^",1)
"RTN","SDRRCRR1",33,0)
 .Q:$$TESTPAT^VADPT(PAT)
"RTN","SDRRCRR1",34,0)
 .S DFN=PAT
"RTN","SDRRCRR1",35,0)
 .D ADD^VADPT,DEM^VADPT
"RTN","SDRRCRR1",36,0)
 .S LN=$E(VADM(1),1)_$P(VA("BID"),U)
"RTN","SDRRCRR1",37,0)
 .S PAT1=$P(VADM(1),U)
"RTN","SDRRCRR1",38,0)
 .S (CDT,CDT1)="",Y=$P($G(DTA),"^",10) I Y'="" D DD^%DT S CDT=Y K Y
"RTN","SDRRCRR1",39,0)
 .S Z=$P($G(DTA),"^",13) I Z'="" S CDT1="*"_CDT K Z D
"RTN","SDRRCRR1",40,0)
 ..I CDT1'="" S CDT=CDT1
"RTN","SDRRCRR1",41,0)
 .I CDT="" S CDT="NotSent"
"RTN","SDRRCRR1",42,0)
 .S PHONE=$P(VAPA(8),U)
"RTN","SDRRCRR1",43,0)
 .I PHONE="" S PHONE="Unk. Phone"  ;phone
"RTN","SDRRCRR1",44,0)
 .S COMMENT=$P($G(DTA),"^",7)
"RTN","SDRRCRR1",45,0)
 .S PRO=$P($G(DTA),"^",5) I PRO'="" S PRO1=$P($G(^SD(403.54,PRO,0)),"^",1),PRO2=$$NAME^XUSER(PRO1,"F")
"RTN","SDRRCRR1",46,0)
 .I PRO="" S PRO2="Unk. Provider"
"RTN","SDRRCRR1",47,0)
 .S USER=$P($G(DTA),"^",11) I USER'="" S USER1=$$NAME^XUSER(USER)
"RTN","SDRRCRR1",48,0)
 .I USER="" S USER1="Unk. User"
"RTN","SDRRCRR1",49,0)
 .S ^TMP($J,"ENTEAM",DIV1,CLINIC,PRO2,MONTH,RDT,PAT1)=CLINIC_"^"_PRO2_"^"_DATE_"^"_CDT_"^"_PAT1_"^"_PHONE_"^"_COMMENT_"^"_USER1_"^"_LN
"RTN","SDRRCRR1",50,0)
 .K CLINIC,USER,PRO,PAT,RDT,CDT,CDT1
"RTN","SDRRCRR1",51,0)
 D PRT4^SDRRCRRP
"RTN","SDRRCRR1",52,0)
 D ^%ZISC
"RTN","SDRRCRR1",53,0)
 G QUIT
"RTN","SDRRCRR1",54,0)
 ;THIS PART OF THE TEAMS IS OK
"RTN","SDRRCRR1",55,0)
ONTEAM  W !!,"***This report requires 132 columns",!! S %ZIS="QM" D ^%ZIS G:POP QUIT
"RTN","SDRRCRR1",56,0)
 I $D(IO("Q")) S ZTIO=ION,ZTDESC="Print Recall List for Clinics",ZTRTN="ONTEAM1^SDRRCRR1" S ZTSAVE("*")="" D ^%ZTLOAD G QUIT
"RTN","SDRRCRR1",57,0)
ONTEAM1 ;SELECTED TEAMS
"RTN","SDRRCRR1",58,0)
 K ^TMP($J,"ONTEAM")
"RTN","SDRRCRR1",59,0)
 S (PRO,RDT,CDT,CDT1,PAT,PHONE,CLINIC,COMMENT,DIV,DIV1,TEST)=""
"RTN","SDRRCRR1",60,0)
 S TM=0
"RTN","SDRRCRR1",61,0)
 F  S TM=$O(VAUTT(TM)) Q:TM=""  S TEAM=$P(VAUTT(TM),"^",1) D
"RTN","SDRRCRR1",62,0)
 .S ZPR=0 F  S ZPR=$O(^SD(403.5,"C",ZPR)) Q:ZPR=""  S D0=0 F  S D0=$O(^SD(403.5,"C",ZPR,D0)) Q:D0=""  S DTA=$G(^SD(403.5,D0,0)) D:DTA]""
"RTN","SDRRCRR1",63,0)
 ..S TEST=$P($G(^SD(403.5,D0,0)),U,5) S DIV=$P($G(^SD(403.54,TEST,0)),U,2)
"RTN","SDRRCRR1",64,0)
 ..Q:DIV'=TEAM
"RTN","SDRRCRR1",65,0)
 ..I DIV'="" S DIV1=$P($G(^SD(403.55,DIV,0)),"^",1)
"RTN","SDRRCRR1",66,0)
 ..I DIV1="" S DIV1="Unknown"
"RTN","SDRRCRR1",67,0)
 ..S RDT=$P($G(DTA),"^",6) Q:RDT=""
"RTN","SDRRCRR1",68,0)
 ..Q:RDT<SDT!(RDT>EDT)
"RTN","SDRRCRR1",69,0)
 ..S MONTH=$E(RDT,4,5),YR=$E(RDT,2,3)
"RTN","SDRRCRR1",70,0)
 ..S CLINIC=$P($G(DTA),"^",2),DIV=CLINIC I CLINIC'="" S CLINIC=$$GET1^DIQ(44,CLINIC_",",.01)
"RTN","SDRRCRR1",71,0)
 ..I CLINIC="" S CLINIC="Unknown Clinic"  ;CLINIC
"RTN","SDRRCRR1",72,0)
 ..S Y=RDT D DD^%DT S DATE=Y K Y  ;RECALL DATE
"RTN","SDRRCRR1",73,0)
 ..S PAT=$P($G(DTA),"^",1)
"RTN","SDRRCRR1",74,0)
 ..Q:$$TESTPAT^VADPT(PAT)
"RTN","SDRRCRR1",75,0)
 ..S DFN=PAT
"RTN","SDRRCRR1",76,0)
 ..D ADD^VADPT,DEM^VADPT
"RTN","SDRRCRR1",77,0)
 ..S LN=$E(VADM(1),1)_$P(VA("BID"),U)
"RTN","SDRRCRR1",78,0)
 ..S PAT1=$P(VADM(1),U)
"RTN","SDRRCRR1",79,0)
 ..S (CDT,CDT1)="",Y=$P($G(DTA),"^",10) I Y'="" D DD^%DT S CDT=Y K Y
"RTN","SDRRCRR1",80,0)
 ..S Z=$P($G(DTA),"^",13) I Z'="" S CDT1="*"_CDT K Z D
"RTN","SDRRCRR1",81,0)
 ...I CDT1'="" S CDT=CDT1
"RTN","SDRRCRR1",82,0)
 ..I CDT="" S CDT="NotSent"
"RTN","SDRRCRR1",83,0)
 ..S PHONE=$P(VAPA(8),U)
"RTN","SDRRCRR1",84,0)
 ..I PHONE="" S PHONE="Unk. Phone"  ;phone
"RTN","SDRRCRR1",85,0)
 ..S COMMENT=$P($G(DTA),"^",7)
"RTN","SDRRCRR1",86,0)
 ..S PRO=$P($G(DTA),"^",5) I PRO'="" S PRO1=$P($G(^SD(403.54,PRO,0)),"^",1),PRO2=$$NAME^XUSER(PRO1,"F")
"RTN","SDRRCRR1",87,0)
 ..I PRO="" S PRO2="Unk. Provider"
"RTN","SDRRCRR1",88,0)
 ..S USER=$P($G(DTA),"^",11) I USER'="" S USER1=$$NAME^XUSER(USER)
"RTN","SDRRCRR1",89,0)
 ..I USER="" S USER1="Unk. User"
"RTN","SDRRCRR1",90,0)
 ..S ^TMP($J,"ONTEAM",DIV1,CLINIC,PRO2,MONTH,RDT,PAT1)=CLINIC_"^"_PRO2_"^"_DATE_"^"_CDT_"^"_PAT1_"^"_PHONE_"^"_COMMENT_"^"_USER1_"^"_LN
"RTN","SDRRCRR1",91,0)
 ..K CLINIC,USER,PRO,PAT,RDT,CDT,CDT1
"RTN","SDRRCRR1",92,0)
 D PRT5^SDRRCRRP
"RTN","SDRRCRR1",93,0)
 D ^%ZISC
"RTN","SDRRCRR1",94,0)
 G QUIT
"RTN","SDRRCRR1",95,0)
 ;BY CLINICS WORK FINE
"RTN","SDRRCRR1",96,0)
SET S VAX=0 I $D(VAUTX) S J=$S(VAUTNI=2:+Y,1:$P(Y(0),"^")) K VAUTX S VAERR=$S($D(@VAUTVB@(J)):0,1:1) W $S('VAERR:"...removed from list...",1:"...not on list...can't remove") Q:VAERR  S VAI=VAI-1 K @VAUTVB@(J) S:$O(@VAUTVB@(0))']"" VAX=1 Q
"RTN","SDRRCRR1",97,0)
 S VAERR=0 I $S($D(@VAUTVB@($P(Y(0),U))):1,$D(@VAUTVB@(+Y)):1,1:0) W !?3,*7,"You have already selected that ",VAUTSTR,".  Try again." S VAERR=1
"RTN","SDRRCRR1",98,0)
 I VAUTNI=1 S @VAUTVB@($P(Y(0),U))=+Y Q
"RTN","SDRRCRR1",99,0)
 I VAUTNI=3 S @VAUTVB@($P(Y(0,0),U))=+Y Q
"RTN","SDRRCRR1",100,0)
 S @VAUTVB@(+Y)=$P(Y(0),U) Q
"RTN","SDRRCRR1",101,0)
QUIT K DIR,Y,SDT,EDT,COMMENT,D0,DATE,DIC,DIV,DIV1,DTA,I,J,LN,MONTH,PAT1,PHONE,POP,PRO1,PRO2,SSN,TEAM,TEST,TM,USER1,X,YR,ZPR
"RTN","SDRRCRR1",102,0)
 K ZTDESC,ZTIO,ZTRTN,ZTSAVE,%DT,%ZIS,%,VAUTC,VAUTD,VA,VAUTNI,VAUTT,DFN,VAX,VAERR,VADM,VAPA
"RTN","SDRRCRR1",103,0)
 D KVAR^VADPT
"RTN","SDRRCRR1",104,0)
 Q
"RTN","SDRRCRRP")
0^8^B40214532
"RTN","SDRRCRRP",1,0)
SDRRCRRP ;10n20/MAH;Print Clinic Recall List Routine ;Nov 16, 2006
"RTN","SDRRCRRP",2,0)
 ;;5.3;Scheduling;**536**;Aug 13, 1993;Build 53
"RTN","SDRRCRRP",3,0)
 ;
"RTN","SDRRCRRP",4,0)
PRT U IO S (PAGE,DIV,CLINIC,PROV,MONTH,RDT,PAT)=0
"RTN","SDRRCRRP",5,0)
 D HDR
"RTN","SDRRCRRP",6,0)
 F  S DIV=$O(^TMP($J,"ONDIV",DIV)) Q:DIV=""  D
"RTN","SDRRCRRP",7,0)
 .F  S CLINIC=$O(^TMP($J,"ONDIV",DIV,CLINIC)) Q:CLINIC=""  W !,?1,"Clinic: "_CLINIC D
"RTN","SDRRCRRP",8,0)
 ..F  S PROV=$O(^TMP($J,"ONDIV",DIV,CLINIC,PROV)) Q:PROV=""  W !,?1,"Provider: "_PROV D
"RTN","SDRRCRRP",9,0)
 ...F  S MONTH=$O(^TMP($J,"ONDIV",DIV,CLINIC,PROV,MONTH)) Q:MONTH=""  D
"RTN","SDRRCRRP",10,0)
 ....F  S RDT=$O(^TMP($J,"ONDIV",DIV,CLINIC,PROV,MONTH,RDT)) Q:RDT=""   D
"RTN","SDRRCRRP",11,0)
 .....S CNT=0 F  S PAT=$O(^TMP($J,"ONDIV",DIV,CLINIC,PROV,MONTH,RDT,PAT)) Q:PAT=""  S CNT=CNT+1 D
"RTN","SDRRCRRP",12,0)
 ......S DTA=$G(^TMP($J,"ONDIV",DIV,CLINIC,PROV,MONTH,RDT,PAT))
"RTN","SDRRCRRP",13,0)
 ......S DATE=$P($G(DTA),"^",3),CDT=$P($G(DTA),"^",4),PAT=$P($G(DTA),"^",5),PHONE=$P($G(DTA),"^",6)
"RTN","SDRRCRRP",14,0)
 ......S USER1=$P($G(DTA),"^",8),COMMENT=$P($G(DTA),"^",7),LN=$P($G(DTA),"^",9)
"RTN","SDRRCRRP",15,0)
 ......I ($Y+3)>IOSL D HDR
"RTN","SDRRCRRP",16,0)
 ......W !,?5,DATE,?18,CDT,?34,PAT,?65,LN,?71,PHONE,?88,USER1,!,?5,COMMENT
"RTN","SDRRCRRP",17,0)
 .....W !!,"Daily Sub-Total for "_CLINIC_" - ("_CNT_")",!!
"RTN","SDRRCRRP",18,0)
 K ^TMP($J,"ONDIV"),DIV,CLINIC,PROV,MONTH,RDT,PAT,CNT,CDT,COMMENT,DATE,DT1,DTA,EDT,EDT1,LN,PAGE,SDT,SDT1,PHONE,USER1
"RTN","SDRRCRRP",19,0)
 Q
"RTN","SDRRCRRP",20,0)
PRT1 U IO S (PAGE,DIV,CLINIC,PROV,MONTH,RDT,PAT)=0
"RTN","SDRRCRRP",21,0)
 D HDR
"RTN","SDRRCRRP",22,0)
 F  S DIV=$O(^TMP($J,"ENDIV",DIV)) Q:DIV=""  D
"RTN","SDRRCRRP",23,0)
 .I $Y>(IOSL-6) D HDR
"RTN","SDRRCRRP",24,0)
 .F  S CLINIC=$O(^TMP($J,"ENDIV",DIV,CLINIC)) Q:CLINIC=""  W !,?1,"Clinic: "_CLINIC D
"RTN","SDRRCRRP",25,0)
 ..F  S PROV=$O(^TMP($J,"ENDIV",DIV,CLINIC,PROV)) Q:PROV=""  W !,?1,"Provider: "_PROV D
"RTN","SDRRCRRP",26,0)
 ...F  S MONTH=$O(^TMP($J,"ENDIV",DIV,CLINIC,PROV,MONTH)) Q:MONTH=""  D
"RTN","SDRRCRRP",27,0)
 ....F  S RDT=$O(^TMP($J,"ENDIV",DIV,CLINIC,PROV,MONTH,RDT)) Q:RDT=""   D
"RTN","SDRRCRRP",28,0)
 .....S CNT=0 F  S PAT=$O(^TMP($J,"ENDIV",DIV,CLINIC,PROV,MONTH,RDT,PAT)) Q:PAT=""  S CNT=CNT+1 D
"RTN","SDRRCRRP",29,0)
 ......S DTA=$G(^TMP($J,"ENDIV",DIV,CLINIC,PROV,MONTH,RDT,PAT))
"RTN","SDRRCRRP",30,0)
 ......S DATE=$P($G(DTA),"^",3),CDT=$P($G(DTA),"^",4),PAT=$P($G(DTA),"^",5),PHONE=$P($G(DTA),"^",6)
"RTN","SDRRCRRP",31,0)
 ......S USER1=$P($G(DTA),"^",8),COMMENT=$P($G(DTA),"^",7),LN=$P($G(DTA),"^",9)
"RTN","SDRRCRRP",32,0)
 ......I ($Y+3)>IOSL D HDR
"RTN","SDRRCRRP",33,0)
 ......W !,?5,DATE,?18,CDT,?34,PAT,?65,LN,?71,PHONE,?88,USER1,!,?5,COMMENT
"RTN","SDRRCRRP",34,0)
 .....W !!,"Daily Sub-Total for "_CLINIC_" - ("_CNT_")",!!
"RTN","SDRRCRRP",35,0)
 K ^TMP($J,"ENDIV"),DIV,CLINIC,PROV,MONTH,RDT,PAT,CNT,CDT,COMMENT,DATE,DT1,DTA,EDT,EDT1,LN,PAGE,SDT,SDT1,PHONE,USER1
"RTN","SDRRCRRP",36,0)
 Q
"RTN","SDRRCRRP",37,0)
PRT2 U IO S (PAGE,DIV,CLINIC,PROV,MONTH,RDT,PAT)=0
"RTN","SDRRCRRP",38,0)
 D HDR
"RTN","SDRRCRRP",39,0)
 F  S DIV=$O(^TMP($J,"ONCLIN",DIV)) Q:DIV=""  D
"RTN","SDRRCRRP",40,0)
 .F  S CLINIC=$O(^TMP($J,"ONCLIN",DIV,CLINIC)) Q:CLINIC=""  W !,?1,"Clinic: "_CLINIC D
"RTN","SDRRCRRP",41,0)
 ..F  S PROV=$O(^TMP($J,"ONCLIN",DIV,CLINIC,PROV)) Q:PROV=""  W !,?1,"Provider: "_PROV D
"RTN","SDRRCRRP",42,0)
 ...F  S MONTH=$O(^TMP($J,"ONCLIN",DIV,CLINIC,PROV,MONTH)) Q:MONTH=""  D
"RTN","SDRRCRRP",43,0)
 ....F  S RDT=$O(^TMP($J,"ONCLIN",DIV,CLINIC,PROV,MONTH,RDT)) Q:RDT=""   D
"RTN","SDRRCRRP",44,0)
 .....S CNT=0 F  S PAT=$O(^TMP($J,"ONCLIN",DIV,CLINIC,PROV,MONTH,RDT,PAT)) Q:PAT=""  S CNT=CNT+1 D
"RTN","SDRRCRRP",45,0)
 ......S DTA=$G(^TMP($J,"ONCLIN",DIV,CLINIC,PROV,MONTH,RDT,PAT))
"RTN","SDRRCRRP",46,0)
 ......S DATE=$P($G(DTA),"^",3),CDT=$P($G(DTA),"^",4),PAT=$P($G(DTA),"^",5),PHONE=$P($G(DTA),"^",6)
"RTN","SDRRCRRP",47,0)
 ......S USER1=$P($G(DTA),"^",8),COMMENT=$P($G(DTA),"^",7),LN=$P($G(DTA),"^",9)
"RTN","SDRRCRRP",48,0)
 ......I ($Y+3)>IOSL D HDR
"RTN","SDRRCRRP",49,0)
 ......W !,?5,DATE,?18,CDT,?34,PAT,?65,LN,?71,PHONE,?88,USER1,!,?5,COMMENT
"RTN","SDRRCRRP",50,0)
 .....W !!,"Daily Sub-Total for "_CLINIC_" - ("_CNT_")",!!
"RTN","SDRRCRRP",51,0)
 K ^TMP($J,"ONCLIN"),DIV,CLINIC,PROV,MONTH,RDT,PAT,CNT,CDT,COMMENT,DATE,DT1,DTA,EDT,EDT1,LN,PAGE,SDT,SDT1,PHONE,USER1
"RTN","SDRRCRRP",52,0)
 Q
"RTN","SDRRCRRP",53,0)
PRT3 U IO S (PAGE,DIV,CLINIC,PROV,MONTH,RDT,PAT)=0
"RTN","SDRRCRRP",54,0)
 D HDR
"RTN","SDRRCRRP",55,0)
 F  S DIV=$O(^TMP($J,"ENCLIN",DIV)) Q:DIV=""  D
"RTN","SDRRCRRP",56,0)
 .F  S CLINIC=$O(^TMP($J,"ENCLIN",DIV,CLINIC)) Q:CLINIC=""  W !,?1,"Clinic: "_CLINIC D
"RTN","SDRRCRRP",57,0)
 ..F  S PROV=$O(^TMP($J,"ENCLIN",DIV,CLINIC,PROV)) Q:PROV=""  W !,?1,"Provider: "_PROV D
"RTN","SDRRCRRP",58,0)
 ...F  S MONTH=$O(^TMP($J,"ENCLIN",DIV,CLINIC,PROV,MONTH)) Q:MONTH=""  D
"RTN","SDRRCRRP",59,0)
 ....F  S RDT=$O(^TMP($J,"ENCLIN",DIV,CLINIC,PROV,MONTH,RDT)) Q:RDT=""   D
"RTN","SDRRCRRP",60,0)
 .....S CNT=0 F  S PAT=$O(^TMP($J,"ENCLIN",DIV,CLINIC,PROV,MONTH,RDT,PAT)) Q:PAT=""  S CNT=CNT+1 D
"RTN","SDRRCRRP",61,0)
 ......S DTA=$G(^TMP($J,"ENCLIN",DIV,CLINIC,PROV,MONTH,RDT,PAT))
"RTN","SDRRCRRP",62,0)
 ......S DATE=$P($G(DTA),"^",3),CDT=$P($G(DTA),"^",4),PAT=$P($G(DTA),"^",5),PHONE=$P($G(DTA),"^",6)
"RTN","SDRRCRRP",63,0)
 ......S USER1=$P($G(DTA),"^",8),COMMENT=$P($G(DTA),"^",7),LN=$P($G(DTA),"^",9)
"RTN","SDRRCRRP",64,0)
 ......I ($Y+3)>IOSL D HDR
"RTN","SDRRCRRP",65,0)
 ......W !,?5,DATE,?18,CDT,?34,PAT,?65,LN,?71,PHONE,?88,USER1,!,?5,COMMENT
"RTN","SDRRCRRP",66,0)
 .....W !!,"Daily Sub-Total for "_CLINIC_" - ("_CNT_")",!!
"RTN","SDRRCRRP",67,0)
 K ^TMP($J,"ENCLIN"),DIV,CLINIC,PROV,MONTH,RDT,PAT,CNT,CDT,COMMENT,DATE,DT1,DTA,EDT,EDT1,LN,PAGE,SDT,SDT1,PHONE,USER1
"RTN","SDRRCRRP",68,0)
 Q
"RTN","SDRRCRRP",69,0)
PRT4 U IO S (PAGE,DIV,CLINIC,PROV,MONTH,RDT,PAT)=0
"RTN","SDRRCRRP",70,0)
 D HDR
"RTN","SDRRCRRP",71,0)
 F  S DIV=$O(^TMP($J,"ENTEAM",DIV)) Q:DIV=""  W !,?1,"Team: "_DIV D
"RTN","SDRRCRRP",72,0)
 .F  S CLINIC=$O(^TMP($J,"ENTEAM",DIV,CLINIC)) Q:CLINIC=""  W !,?1,"Clinic: "_CLINIC D
"RTN","SDRRCRRP",73,0)
 ..F  S PROV=$O(^TMP($J,"ENTEAM",DIV,CLINIC,PROV)) Q:PROV=""  W !,?1,"Provider: "_PROV D
"RTN","SDRRCRRP",74,0)
 ...F  S MONTH=$O(^TMP($J,"ENTEAM",DIV,CLINIC,PROV,MONTH)) Q:MONTH=""  D
"RTN","SDRRCRRP",75,0)
 ....F  S RDT=$O(^TMP($J,"ENTEAM",DIV,CLINIC,PROV,MONTH,RDT)) Q:RDT=""   D
"RTN","SDRRCRRP",76,0)
 .....S CNT=0 F  S PAT=$O(^TMP($J,"ENTEAM",DIV,CLINIC,PROV,MONTH,RDT,PAT)) Q:PAT=""  S CNT=CNT+1 D
"RTN","SDRRCRRP",77,0)
 ......S DTA=$G(^TMP($J,"ENTEAM",DIV,CLINIC,PROV,MONTH,RDT,PAT))
"RTN","SDRRCRRP",78,0)
 ......S DATE=$P($G(DTA),"^",3),CDT=$P($G(DTA),"^",4),PAT=$P($G(DTA),"^",5),PHONE=$P($G(DTA),"^",6)
"RTN","SDRRCRRP",79,0)
 ......S USER1=$P($G(DTA),"^",8),COMMENT=$P($G(DTA),"^",7),LN=$P($G(DTA),"^",9)
"RTN","SDRRCRRP",80,0)
 ......I ($Y+3)>IOSL D HDR
"RTN","SDRRCRRP",81,0)
 ......W !,?5,DATE,?18,CDT,?34,PAT,?65,LN,?71,PHONE,?88,USER1,!,?5,COMMENT
"RTN","SDRRCRRP",82,0)
 .....W !!,"Daily Sub-Total for "_CLINIC_" - ("_CNT_")",!!
"RTN","SDRRCRRP",83,0)
 K ^TMP($J,"ENTEAM"),DIV,CLINIC,PROV,MONTH,RDT,PAT,CNT,CDT,COMMENT,DATE,DT1,DTA,EDT,EDT1,LN,PAGE,SDT,SDT1,PHONE,USER1
"RTN","SDRRCRRP",84,0)
 Q
"RTN","SDRRCRRP",85,0)
PRT5 U IO S (PAGE,DIV,CLINIC,PROV,MONTH,RDT,PAT)=0
"RTN","SDRRCRRP",86,0)
 D HDR
"RTN","SDRRCRRP",87,0)
 F  S DIV=$O(^TMP($J,"ONTEAM",DIV)) Q:DIV=""  W !,?1,"Team: "_DIV D
"RTN","SDRRCRRP",88,0)
 .F  S CLINIC=$O(^TMP($J,"ONTEAM",DIV,CLINIC)) Q:CLINIC=""  W !,?1,"Clinic: "_CLINIC D
"RTN","SDRRCRRP",89,0)
 ..F  S PROV=$O(^TMP($J,"ONTEAM",DIV,CLINIC,PROV)) Q:PROV=""  W !,?1,"Provider: "_PROV D
"RTN","SDRRCRRP",90,0)
 ...F  S MONTH=$O(^TMP($J,"ONTEAM",DIV,CLINIC,PROV,MONTH)) Q:MONTH=""  D
"RTN","SDRRCRRP",91,0)
 ....F  S RDT=$O(^TMP($J,"ONTEAM",DIV,CLINIC,PROV,MONTH,RDT)) Q:RDT=""   D
"RTN","SDRRCRRP",92,0)
 .....S CNT=0 F  S PAT=$O(^TMP($J,"ONTEAM",DIV,CLINIC,PROV,MONTH,RDT,PAT)) Q:PAT=""  S CNT=CNT+1 D
"RTN","SDRRCRRP",93,0)
 ......S DTA=$G(^TMP($J,"ONTEAM",DIV,CLINIC,PROV,MONTH,RDT,PAT))
"RTN","SDRRCRRP",94,0)
 ......S DATE=$P($G(DTA),"^",3),CDT=$P($G(DTA),"^",4),PAT=$P($G(DTA),"^",5),PHONE=$P($G(DTA),"^",6)
"RTN","SDRRCRRP",95,0)
 ......S USER1=$P($G(DTA),"^",8),COMMENT=$P($G(DTA),"^",7),LN=$P($G(DTA),"^",9)
"RTN","SDRRCRRP",96,0)
 ......I ($Y+3)>IOSL D HDR
"RTN","SDRRCRRP",97,0)
 ......W !,?5,DATE,?18,CDT,?34,PAT,?65,LN,?71,PHONE,?88,USER1,!,?5,COMMENT
"RTN","SDRRCRRP",98,0)
 .....W !!,"Daily Sub-Total for "_CLINIC_" - ("_CNT_")",!!
"RTN","SDRRCRRP",99,0)
 K ^TMP($J,"ONTEAM"),DIV,CLINIC,PROV,MONTH,RDT,PAT,CNT,CDT,COMMENT,DATE,DT1,DTA,EDT,EDT1,LN,PAGE,SDT,SDT1,PHONE,USER1
"RTN","SDRRCRRP",100,0)
 Q
"RTN","SDRRCRRP",101,0)
 ;
"RTN","SDRRCRRP",102,0)
HDR ;
"RTN","SDRRCRRP",103,0)
 S PAGE=PAGE+1
"RTN","SDRRCRRP",104,0)
 S Y=DT D DD^%DT S DT1=Y K Y
"RTN","SDRRCRRP",105,0)
 S Y=SDT D DD^%DT S SDT1=Y K Y
"RTN","SDRRCRRP",106,0)
 S Y=EDT D DD^%DT S EDT1=Y K Y
"RTN","SDRRCRRP",107,0)
 W @IOF
"RTN","SDRRCRRP",108,0)
 W ?30,"OUTPATIENT CLINIC RECALL LIST"
"RTN","SDRRCRRP",109,0)
 W !,?25,"For date range: "_SDT1_" to "_EDT1
"RTN","SDRRCRRP",110,0)
 W !,?30,"Date printed:  "_DT1_"   Page: ",$J(PAGE,3),!
"RTN","SDRRCRRP",111,0)
 W !,"Provider",?5,"Recall Date",?18,"Date CS",?34,"Patient",?65,"1U4N",?71,"Phone",?88,"Entered by"
"RTN","SDRRCRRP",112,0)
 W !,?5,"Comments",!
"RTN","SDRRCRRP",113,0)
 S $P(LINE,"-",IOM)="-"
"RTN","SDRRCRRP",114,0)
 W LINE,! K LINE
"RTN","SDRRCRRP",115,0)
 Q
"RTN","SDRRDEL")
0^9^B3357699
"RTN","SDRRDEL",1,0)
SDRRDEL ;10N20/MAH;DELETE/EDIT RECALL REMINDERS ;01/18/2008
"RTN","SDRRDEL",2,0)
 ;;5.3;Scheduling;**536**;Aug 13, 1993;Build 53
"RTN","SDRRDEL",3,0)
 ;;THIS ROUTINE WILL USE OPTION SDRR DELETE RECALL
"RTN","SDRRDEL",4,0)
 ;
"RTN","SDRRDEL",5,0)
 S DIDEL=403.5,Q=0,(CLIN,CLINZ)=""
"RTN","SDRRDEL",6,0)
 S DIC=403.5,DIC(0)="AELM",DIC("A")="Select Clinic Recall Patient:  " D ^DIC  S Q=+Y I +Y<0 G EXIT
"RTN","SDRRDEL",7,0)
 I +Y>0 S CLIN=$P($G(^SD(403.5,+Y,0)),U,2) I $G(CLIN)]"" S CLINZ=$$GET1^DIQ(44,CLIN_",",.01)
"RTN","SDRRDEL",8,0)
 I +Y>0 S DIR(0)="Y",DIR("A")="Are you sure you want to delete: "_$G(CLINZ),DIR("B")="NO" D ^DIR
"RTN","SDRRDEL",9,0)
 I Y'=1 G EXIT
"RTN","SDRRDEL",10,0)
 I Y=1 G KIL
"RTN","SDRRDEL",11,0)
 Q
"RTN","SDRRDEL",12,0)
KIL      N SDRRFTR
"RTN","SDRRDEL",13,0)
 S Y=0
"RTN","SDRRDEL",14,0)
 K DIR
"RTN","SDRRDEL",15,0)
 S DIR(0)="SO^1:Failure to respond;2:Moved;3:Deceased;4:Doesn't want VA services;5:Received care at another VA;6:Other",DIR("A")="Reason for Removal" D ^DIR Q:$D(DIRUT) 
"RTN","SDRRDEL",16,0)
 I Y>0 S SDRRFTR=Y
"RTN","SDRRDEL",17,0)
 S DA=+Q S DIE="^SD(403.5,",DR="[SDRREMARKS]",DIE("NO^")="BACKOUTOK" D ^DIE
"RTN","SDRRDEL",18,0)
 S DIK="^SD(403.5,",DA=+Q D ^DIK
"RTN","SDRRDEL",19,0)
 W !!?20,"*** Now Deleting Patient Recall ***" H .5
"RTN","SDRRDEL",20,0)
EXIT     ;
"RTN","SDRRDEL",21,0)
 K SDRRFTR,Q,DA,DIC,X,Y,DIDEL,DIC,DIK,DIR,CLIN,CLINZ,DIE,DR,DIRUT
"RTN","SDRRDEL",22,0)
 Q
"RTN","SDRRINQ")
0^37^B72514446
"RTN","SDRRINQ",1,0)
SDRRINQ  ;10N20/MAH;-Recall Reminder PATIENT INQUIRY ;01/28/2008  11:32
"RTN","SDRRINQ",2,0)
 ;;5.3;Scheduling;**536**;Aug 13, 1993;Build 53
"RTN","SDRRINQ",3,0)
 ; Option: SDRR PATIENT INQUIRY
"RTN","SDRRINQ",4,0)
EN ;Looping through both active recalls and archive entries
"RTN","SDRRINQ",5,0)
 N DFN
"RTN","SDRRINQ",6,0)
 K ^TMP("SDRRINQ",$J)
"RTN","SDRRINQ",7,0)
 S (SHOW,SHOW1)=1
"RTN","SDRRINQ",8,0)
 D ^DPTLK Q:Y<0  S DFN=+Y K Y
"RTN","SDRRINQ",9,0)
 I '$D(^SD(403.5,"B",DFN)) W !!,"**No Active Clinic Recall on file",! S SHOW=0
"RTN","SDRRINQ",10,0)
 I '$D(^SD(403.56,"B",DFN)) W !,"**No Archive Clinic Recalls on file",! S SHOW1=0
"RTN","SDRRINQ",11,0)
 G:(SHOW<1)&(SHOW1<1) QUIT
"RTN","SDRRINQ",12,0)
 D DATE
"RTN","SDRRINQ",13,0)
 I $D(ERR) K ERR Q
"RTN","SDRRINQ",14,0)
SELDT I RANGE=1 S %DT="AEX",%DT("A")="Beginning Date: " D ^%DT Q:Y<0  S SDT=Y,%DT("A")="Ending DATE: " D ^%DT I Y<SDT W $C(7),"  ??" G SELDT
"RTN","SDRRINQ",15,0)
 S EDT=Y
"RTN","SDRRINQ",16,0)
 I RANGE=0 S (SDT,EDT)=0
"RTN","SDRRINQ",17,0)
 I RANGE=0 D PRT
"RTN","SDRRINQ",18,0)
 I $D(ERROR)  K ERROR Q
"RTN","SDRRINQ",19,0)
 I Y=1 G QUE^SDRRINQ1
"RTN","SDRRINQ",20,0)
 I RANGE=0 D ACT,ARC,REPORT,REPORT1 G QUIT
"RTN","SDRRINQ",21,0)
 I RANGE=1 D SEL,SEL1,REPORT,REPORT1 G QUIT
"RTN","SDRRINQ",22,0)
 Q
"RTN","SDRRINQ",23,0)
SEL I $D(^SD(403.5,"B",DFN)) S (RSENT,SSENT,PRDT,TYPE)="" S IEN=0 F  S IEN=$O(^SD(403.5,"B",DFN,IEN)) Q:'IEN  S NODE=$G(^SD(403.5,IEN,0)) D
"RTN","SDRRINQ",24,0)
 .S CLINIC=$P($G(NODE),"^",2),CLINIC=$$GET1^DIQ(44,CLINIC_",",.01),ACCINFOR=$P($G(NODE),"^",3)
"RTN","SDRRINQ",25,0)
 .S TYPE=$P($G(NODE),"^",4) I TYPE'="" S TYPE=$P(^SD(403.51,TYPE,0),"^",1)
"RTN","SDRRINQ",26,0)
 .S PROVIDER=$P(NODE,"^",5) I PROVIDER'="" S PROVIDER=$P($G(^SD(403.54,PROVIDER,0)),"^",1) S PROVIDER=$$NAME^XUSER(PROVIDER,"F")
"RTN","SDRRINQ",27,0)
 .I PROVIDER="" S PROVIDER="Unknown"
"RTN","SDRRINQ",28,0)
 .S RDT=""
"RTN","SDRRINQ",29,0)
 .S Y=$P(NODE,"^",6) Q:Y<SDT!(Y>EDT)
"RTN","SDRRINQ",30,0)
 .I Y>SDT,(Y<EDT) D DD^%DT S RDT=Y K Y,X
"RTN","SDRRINQ",31,0)
 .S COMMENT=$P($G(NODE),"^",7)
"RTN","SDRRINQ",32,0)
 .S FAST=$S($P(NODE,"^",8)["n":"NO",$P(NODE,"^",8)["f":"YES",1:"")
"RTN","SDRRINQ",33,0)
 .S LOA=$P(NODE,"^",9)
"RTN","SDRRINQ",34,0)
 .S Y=$P($G(NODE),"^",10) I Y'="" D DD^%DT S RSENT=Y K Y,X
"RTN","SDRRINQ",35,0)
 .I RSENT="" S RSENT="NOTSENT"
"RTN","SDRRINQ",36,0)
 .S USER=$P($G(NODE),"^",11),USER=$$NAME^XUSER(USER,"F")
"RTN","SDRRINQ",37,0)
 .S Y=$P(NODE,"^",12) I Y'="" D DD^%DT S PRDT=Y K Y,X
"RTN","SDRRINQ",38,0)
 .S Y=$P(NODE,"^",13) I Y'="" D DD^%DT S SSENT="*"_Y K Y,X
"RTN","SDRRINQ",39,0)
 .S ^TMP("SDRRINQ",$J,"ACT",IEN)=CLINIC_"^"_ACCINFOR_"^"_TYPE_"^"_PROVIDER_"^"_RDT_"^"_COMMENT_"^"_FAST_"^"_LOA_"^"_RSENT_"^"_USER_"^"_PRDT_"^"_SSENT
"RTN","SDRRINQ",40,0)
 Q
"RTN","SDRRINQ",41,0)
SEL1 I $D(^SD(403.56,"B",DFN))  S (SSENT,RSENT,PRDTA,TYPE)="" S IENA=0 F  S IENA=$O(^SD(403.56,"B",DFN,IENA)) Q:'IENA  S NODEA=$G(^SD(403.56,IENA,0)) D
"RTN","SDRRINQ",42,0)
 .S CLINIC=$P($G(NODEA),"^",2),CLINIC=$$GET1^DIQ(44,CLINIC_",",.01),ACCINFOR=$P($G(NODEA),"^",3)
"RTN","SDRRINQ",43,0)
 .S TYPE=$P($G(NODEA),"^",4) I TYPE'="" S TYPE=$P(^SD(403.51,TYPE,0),"^",1)
"RTN","SDRRINQ",44,0)
 .S PROVIDER=$P(NODEA,"^",5) I PROVIDER'="" S PROVIDER=$P($G(^SD(403.54,PROVIDER,0)),"^",1) S PROVIDER=$$NAME^XUSER(PROVIDER,"F")
"RTN","SDRRINQ",45,0)
 .I PROVIDER="" S PROVIDER="Unknown"
"RTN","SDRRINQ",46,0)
 .S RDT=""
"RTN","SDRRINQ",47,0)
 .S Y=$P(NODEA,"^",6) Q:Y<SDT!(Y>EDT)
"RTN","SDRRINQ",48,0)
 .I Y>SDT&(Y<EDT) D DD^%DT S RDT=Y K Y,X
"RTN","SDRRINQ",49,0)
 .S COMMENT=$P($G(NODEA),"^",7)
"RTN","SDRRINQ",50,0)
 .S FAST=$S($P(NODEA,"^",8)["n":"NO",$P(NODEA,"^",8)["f":"YES",1:"")
"RTN","SDRRINQ",51,0)
 .S LOA=$P(NODEA,"^",9)
"RTN","SDRRINQ",52,0)
 .S Y=$P($G(NODEA),"^",10) I Y'="" D DD^%DT S RSENT=Y K Y,X
"RTN","SDRRINQ",53,0)
 .I RSENT="" S RSENT="NOTSENT"
"RTN","SDRRINQ",54,0)
 .S USER=$P($G(NODEA),"^",11),USER=$$NAME^XUSER(USER,"F")
"RTN","SDRRINQ",55,0)
 .I $D(^SD(403.56,IENA,2)) S NODEA2=$G(^SD(403.56,IENA,2)) D
"RTN","SDRRINQ",56,0)
 ..S Y=$P(NODEA2,"^",1) D DD^%DT S PRDTA=Y K Y,X
"RTN","SDRRINQ",57,0)
 ..S USER2=$P($G(NODEA2),"^",2),USER2=$$NAME^XUSER(USER2,"F")
"RTN","SDRRINQ",58,0)
 ..S SDRREASN=$S($P(NODEA2,"^",3)=1:"FTR",$P(NODEA2,"^",3)=2:"MOVED",$P(NODEA2,"^",3)=3:"DECEASED",$P(NODEA2,"^",3)=4:"DNWC",$P(NODEA2,"^",3)=5:"RCOVA",$P(NODEA2,"^",3)=6:"OTHER",$P(NODEA2,"^",3)=7:"Scheduled",1:"")
"RTN","SDRRINQ",59,0)
 ..S ^TMP("SDRRINQ",$J,"ARC",IENA)=CLINIC_"^"_ACCINFOR_"^"_TYPE_"^"_PROVIDER_"^"_RDT_"^"_COMMENT_"^"_FAST_"^"_LOA_"^"_RSENT_"^"_USER2_"^"_SSENT_"^"_SDRREASN_"^"_PRDTA
"RTN","SDRRINQ",60,0)
 Q
"RTN","SDRRINQ",61,0)
HDR ;Review all Recall Reminder on screen for all
"RTN","SDRRINQ",62,0)
 D DEM^VADPT S NAME=VADM(1),LAST4=VA("BID"),DOB=$P(VADM(3),"^",2) S HDR="Patient Name: "_NAME_"  Date of Birth: "_DOB_" Last4: "_LAST4
"RTN","SDRRINQ",63,0)
 W @IOF,HDR
"RTN","SDRRINQ",64,0)
 Q
"RTN","SDRRINQ",65,0)
ACT I $D(^SD(403.5,"B",DFN)) S (RSENT,SSENT,IEN,PRDT,TYPE)="" F  S IEN=$O(^SD(403.5,"B",DFN,IEN)) Q:'IEN  S NODE=$G(^SD(403.5,IEN,0)) D
"RTN","SDRRINQ",66,0)
 .S CLINIC=$P($G(NODE),"^",2),CLINIC=$$GET1^DIQ(44,CLINIC_",",.01),ACCINFOR=$P($G(NODE),"^",3)
"RTN","SDRRINQ",67,0)
 .S TYPE=$P($G(NODE),"^",4) I TYPE'="" S TYPE=$P(^SD(403.51,TYPE,0),"^",1)
"RTN","SDRRINQ",68,0)
 .S PROVIDER=$P(NODE,"^",5) I PROVIDER'="" S PROVIDER=$P($G(^SD(403.54,PROVIDER,0)),"^",1) S PROVIDER=$$NAME^XUSER(PROVIDER,"F")
"RTN","SDRRINQ",69,0)
 .I PROVIDER="" S PROVIDER="Unknown"
"RTN","SDRRINQ",70,0)
 .S RDT=""
"RTN","SDRRINQ",71,0)
 .S Y=$P(NODE,"^",6) D DD^%DT S RDT=Y K Y,X
"RTN","SDRRINQ",72,0)
 .S COMMENT=$P($G(NODE),"^",7)
"RTN","SDRRINQ",73,0)
 .S FAST=$S($P(NODE,"^",8)["n":"NO",$P(NODE,"^",8)["f":"YES",1:"")
"RTN","SDRRINQ",74,0)
 .S LOA=$P(NODE,"^",9)
"RTN","SDRRINQ",75,0)
 .S Y=$P($G(NODE),"^",10) I Y'="" D DD^%DT S RSENT=Y K Y,X
"RTN","SDRRINQ",76,0)
 .I RSENT="" S RSENT="NOTSENT"
"RTN","SDRRINQ",77,0)
 .S USER=$P($G(NODE),"^",11),USER=$$NAME^XUSER(USER,"F")
"RTN","SDRRINQ",78,0)
 .S Y=$P(NODE,"^",12) I Y'="" D DD^%DT S PRDT=Y K Y,X
"RTN","SDRRINQ",79,0)
 .S Y=$P(NODE,"^",13) I Y'="" D DD^%DT S SSENT="*"_Y K Y,X
"RTN","SDRRINQ",80,0)
 .S ^TMP("SDRRINQ",$J,"ACT",IEN)=CLINIC_"^"_ACCINFOR_"^"_TYPE_"^"_PROVIDER_"^"_RDT_"^"_COMMENT_"^"_FAST_"^"_LOA_"^"_RSENT_"^"_USER_"^"_PRDT_"^"_SSENT
"RTN","SDRRINQ",81,0)
 Q
"RTN","SDRRINQ",82,0)
ARC I $D(^SD(403.56,"B",DFN))  S (SSENT,RSENT,PRDTA,TYPE)="" S IENA=0 F  S IENA=$O(^SD(403.56,"B",DFN,IENA)) Q:'IENA  S NODEA=$G(^SD(403.56,IENA,0)) D
"RTN","SDRRINQ",83,0)
 .S CLINIC=$P($G(NODEA),"^",2),CLINIC=$$GET1^DIQ(44,CLINIC_",",.01),ACCINFOR=$P($G(NODEA),"^",3)
"RTN","SDRRINQ",84,0)
 .S TYPE=$P($G(NODEA),"^",4) I TYPE'="" S TYPE=$P(^SD(403.51,TYPE,0),"^",1)
"RTN","SDRRINQ",85,0)
 .S PROVIDER=$P(NODEA,"^",5) I PROVIDER'="" S PROVIDER=$P($G(^SD(403.54,PROVIDER,0)),"^",1) S PROVIDER=$$NAME^XUSER(PROVIDER,"F")
"RTN","SDRRINQ",86,0)
 .I PROVIDER="" S PROVIDER="Unknown"
"RTN","SDRRINQ",87,0)
 .S RDT=""
"RTN","SDRRINQ",88,0)
 .S Y=$P(NODEA,"^",6) D DD^%DT S RDT=Y K Y,X
"RTN","SDRRINQ",89,0)
 .S COMMENT=$P($G(NODEA),"^",7)
"RTN","SDRRINQ",90,0)
 .S FAST=$S($P(NODEA,"^",8)["n":"NO",$P(NODEA,"^",8)["f":"YES",1:"")
"RTN","SDRRINQ",91,0)
 .S LOA=$P(NODEA,"^",9)
"RTN","SDRRINQ",92,0)
 .S Y=$P($G(NODEA),"^",10) I Y'="" D DD^%DT S RSENT=Y K Y,X
"RTN","SDRRINQ",93,0)
 .I RSENT="" S RSENT="NOTSENT"
"RTN","SDRRINQ",94,0)
 .S USER=$P($G(NODEA),"^",11),USER=$$NAME^XUSER(USER,"F")
"RTN","SDRRINQ",95,0)
 .I $D(^SD(403.56,IENA,2)) S NODEA2=$G(^SD(403.56,IENA,2)) D
"RTN","SDRRINQ",96,0)
 ..S Y=$P(NODEA2,"^",1) D DD^%DT S PRDTA=Y K Y,X
"RTN","SDRRINQ",97,0)
 ..S USER2=$P($G(NODEA2),"^",2),USER2=$$NAME^XUSER(USER2,"F")
"RTN","SDRRINQ",98,0)
 ..S SDRREASN=$S($P(NODEA2,"^",3)=1:"FTR",$P(NODEA2,"^",3)=2:"MOVED",$P(NODEA2,"^",3)=3:"DECEASED",$P(NODEA2,"^",3)=4:"DNWC",$P(NODEA2,"^",3)=5:"RCOVA",$P(NODEA2,"^",3)=6:"OTHER",$P(NODEA2,"^",3)=7:"Scheduled",1:"")
"RTN","SDRRINQ",99,0)
 ..S ^TMP("SDRRINQ",$J,"ARC",IENA)=CLINIC_"^"_ACCINFOR_"^"_TYPE_"^"_PROVIDER_"^"_RDT_"^"_COMMENT_"^"_FAST_"^"_LOA_"^"_RSENT_"^"_USER2_"^"_SSENT_"^"_SDRREASN_"^"_PRDTA
"RTN","SDRRINQ",100,0)
 Q
"RTN","SDRRINQ",101,0)
DATE ; DIR call
"RTN","SDRRINQ",102,0)
 S (YES,RANGE)=0,DIR("B")="All" K SDHDR
"RTN","SDRRINQ",103,0)
 S DIR(0)="S^R:Range;A:All",DIR("A")="Do you want a (R)ange or (A)ll" I $D(DIRUT) S ERR=1 G QUIT
"RTN","SDRRINQ",104,0)
 S DIR("?",1)="",DIR("?",2)="     (A)ll gives the user all dates.",DIR("?")="     (R)ange allows the user to select a range of dates."
"RTN","SDRRINQ",105,0)
 D ^DIR K DIR I $D(DIRUT) S ERR=1 G QUIT
"RTN","SDRRINQ",106,0)
 I "RA"'[Y W !!,"Enter 'R' for a date range or 'A' for all dates." G DATE
"RTN","SDRRINQ",107,0)
 I "R"[Y S RANGE=1
"RTN","SDRRINQ",108,0)
 Q
"RTN","SDRRINQ",109,0)
PRT ;
"RTN","SDRRINQ",110,0)
 S YES=0
"RTN","SDRRINQ",111,0)
 S DIR(0)="Y",DIR("B")="NO",DIR("A")="Do you want to print the profile"
"RTN","SDRRINQ",112,0)
 S DIR("?",1)="     Enter 'YES' to print the profile.",DIR("?")="     If you enter 'NO', it will take you to the Recall Reminder report."
"RTN","SDRRINQ",113,0)
 D ^DIR K DIR I $D(DIRUT) S ERROR=1 G QUIT
"RTN","SDRRINQ",114,0)
 Q
"RTN","SDRRINQ",115,0)
REPORT D HDR
"RTN","SDRRINQ",116,0)
 I '$D(^TMP("SDRRINQ",$J,"ACT")) W !!,?25,"No ACTIVE Recalls Reminders on file" Q
"RTN","SDRRINQ",117,0)
 I $D(^TMP("SDRRINQ",$J,"ACT")) W !!,?25,"ACTIVE RECALL REMINDERS"
"RTN","SDRRINQ",118,0)
 S ITEM=0 F  S ITEM=$O(^TMP("SDRRINQ",$J,"ACT",ITEM)) Q:'ITEM  D
"RTN","SDRRINQ",119,0)
 .S INFOR=$G(^TMP("SDRRINQ",$J,"ACT",ITEM))
"RTN","SDRRINQ",120,0)
 .W !!,?5,"Clinic: "_$P($G(INFOR),"^",1),?45,"Recall Date: "_$P($G(INFOR),"^",5)
"RTN","SDRRINQ",121,0)
 .W !,?5,"Provider: "_$P($G(INFOR),"^",4),?45,"Appt/Type: "_$P($G(INFOR),"^",3)
"RTN","SDRRINQ",122,0)
 .W !,?5,"Fasting/NonFasting: "_$P($G(INFOR),"^",7)
"RTN","SDRRINQ",123,0)
 .W !,?5,"Appt Requested Length: "_$P($G(INFOR),"^",8),?45,"Date Reminder Sent: "_$P($G(INFOR),"^",9)
"RTN","SDRRINQ",124,0)
 .W !,?5,"User who Entered: "_$P($G(INFOR),"^",10),?45,"Patient Requested Dt: "_$P($G(INFOR),"^",11)
"RTN","SDRRINQ",125,0)
 .W !,?5,"Date Second Reminder Sent: "_$P($G(INFOR),"^",12)
"RTN","SDRRINQ",126,0)
 .W !,?5,"Comments: "_$P($G(INFOR),"^",6)
"RTN","SDRRINQ",127,0)
 .I $Y>(IOSL-6) K DIR S DIR(0)="E",DIR("A")="Press Return for more Information.." D ^DIR Q:$D(DUOUT)!($D(DTOUT))  D HDR
"RTN","SDRRINQ",128,0)
 K DIR S DIR(0)="E",DIR("A")="Press Return to continue.." D ^DIR Q:$D(DUOUT)!($D(DTOUT))
"RTN","SDRRINQ",129,0)
 Q
"RTN","SDRRINQ",130,0)
REPORT1 D HDR
"RTN","SDRRINQ",131,0)
 I '$D(^TMP("SDRRINQ",$J,"ARC")) W !!,?25,"No INACTIVE Recalls Reminders on file" Q
"RTN","SDRRINQ",132,0)
 I $D(^TMP("SDRRINQ",$J,"ARC")) W !!,?25,"INACTIVE RECALL REMINDERS"
"RTN","SDRRINQ",133,0)
 S ITEM=0 F  S ITEM=$O(^TMP("SDRRINQ",$J,"ARC",ITEM)) Q:'ITEM  D
"RTN","SDRRINQ",134,0)
 .S INFOR=$G(^TMP("SDRRINQ",$J,"ARC",ITEM))
"RTN","SDRRINQ",135,0)
 .W !!,?5,"Clinic: "_$P($G(INFOR),"^",1),?45,"Recall Date: "_$P($G(INFOR),"^",5)
"RTN","SDRRINQ",136,0)
 .W !,?5,"Provider: "_$P($G(INFOR),"^",4),?45,"Appt/Type: "_$P($G(INFOR),"^",3)
"RTN","SDRRINQ",137,0)
 .W !,?5,"Fasting/NonFasting: "_$P($G(INFOR),"^",7)
"RTN","SDRRINQ",138,0)
 .W !,?5,"Appt Requested Length: "_$P($G(INFOR),"^",8),?45,"Date Reminder Sent: "_$P($G(INFOR),"^",9)
"RTN","SDRRINQ",139,0)
 .W !,?5,"User who Entered: "_$P($G(INFOR),"^",10),?45,"Patient Requested Dt: "_$P($G(INFOR),"^",11)
"RTN","SDRRINQ",140,0)
 .W !,?5,"Date Removed from Active File: "_$P($G(INFOR),"^",13)
"RTN","SDRRINQ",141,0)
 .W !,?5,"Reason for Removal: "_$P($G(INFOR),"^",12)
"RTN","SDRRINQ",142,0)
 .W !,?5,"User who Deleted Entry: "_$P($G(INFOR),"^",10)
"RTN","SDRRINQ",143,0)
 .W !,?5,"Comments: "_$P($G(INFOR),"^",6)
"RTN","SDRRINQ",144,0)
 .I $Y>(IOSL-6) K DIR S DIR(0)="E",DIR("A")="Press Return for more Information.." D ^DIR Q:$D(DUOUT)!($D(DTOUT))  D HDR
"RTN","SDRRINQ",145,0)
 K DIR S DIR(0)="E",DIR("A")="Press Return to continue.." D ^DIR Q:$D(DUOUT)!($D(DTOUT))
"RTN","SDRRINQ",146,0)
 Q
"RTN","SDRRINQ",147,0)
QUIT K DFN,Y,SHOW,SHOW1,ACCINFOR,CLINIC,COMMENT,DOB,DIRUT,DTOUT,DUOUT,EDT,FAST,HDR,IEN,IENA,INFOR,ITEM,LAST4,LOA,NAME
"RTN","SDRRINQ",148,0)
 K NODE,NODEA,PRDT,PRDTA,PROVIDER,RANGE,RDT,RSENT,SDRREASN,SDT,SSENT,TYPE,USER,USER2,NODEA2,DIR,YES
"RTN","SDRRINQ",149,0)
 K ^TMP("SDRRINQ",$J),%DT,VA,VADM,YES
"RTN","SDRRINQ",150,0)
 Q
"RTN","SDRRINQ1")
0^38^B55827759
"RTN","SDRRINQ1",1,0)
SDRRINQ1 ;10N20/MAH;-Recall Reminder PATIENT INQUIRY ;01/28/2008  11:32
"RTN","SDRRINQ1",2,0)
 ;;5.3;Scheduling;**536**;Aug 13, 1993;Build 53
"RTN","SDRRINQ1",3,0)
 ; Option: SDRR PATIENT INQUIRY - PRINT
"RTN","SDRRINQ1",4,0)
QUE S %ZIS="MQ" D ^%ZIS Q:POP
"RTN","SDRRINQ1",5,0)
 I $D(IO("Q")) S ZTRTN="ALL^SDRRINQ1",ZTDTH=$H,ZTDESC="RECALL REMINDER INQUIRY",ZTSAVE("DFN")="",ZTSAVE("SDT")="",ZTSAVE("EDT")="",ZTSAVE("RANGE")="" D ^%ZTLOAD W:$D(ZTSK) !,"Your Task has been Queued" G QUIT
"RTN","SDRRINQ1",6,0)
ALL ;SHOW ON SCREEN
"RTN","SDRRINQ1",7,0)
 U IO
"RTN","SDRRINQ1",8,0)
 D:RANGE=0 ACT,ARC,REPORT,REPORT1 G QUIT
"RTN","SDRRINQ1",9,0)
 D:RANGE=1 SEL,SEL1,REPORT,REPORT1 G QUIT
"RTN","SDRRINQ1",10,0)
 Q
"RTN","SDRRINQ1",11,0)
SEL I $D(^SD(403.5,"B",DFN)) S (RSENT,SSENT,PRDT,TYPE)="" S IEN=0 F  S IEN=$O(^SD(403.5,"B",DFN,IEN)) Q:'IEN  S NODE=$G(^SD(403.5,IEN,0)) D
"RTN","SDRRINQ1",12,0)
 .S CLINIC=$P($G(NODE),"^",2),CLINIC=$$GET1^DIQ(44,CLINIC_",",.01),ACCINFOR=$P($G(NODE),"^",3)
"RTN","SDRRINQ1",13,0)
 .S TYPE=$P($G(NODE),"^",4) I TYPE'="" S TYPE=$P(^SD(403.51,TYPE,0),"^",1)
"RTN","SDRRINQ1",14,0)
 .S PROVIDER=$P(NODE,"^",5) I PROVIDER'="" S PROVIDER=$P($G(^SD(403.54,PROVIDER,0)),"^",1) S PROVIDER=$$NAME^XUSER(PROVIDER,"F")
"RTN","SDRRINQ1",15,0)
 .I PROVIDER="" S PROVIDER="Unknown"
"RTN","SDRRINQ1",16,0)
 .S RDT=""
"RTN","SDRRINQ1",17,0)
 .S Y=$P(NODE,"^",6) Q:Y<SDT!(Y>EDT)
"RTN","SDRRINQ1",18,0)
 .I Y>SDT,(Y<EDT) D DD^%DT S RDT=Y K Y,X
"RTN","SDRRINQ1",19,0)
 .S COMMENT=$P($G(NODE),"^",7)
"RTN","SDRRINQ1",20,0)
 .S FAST=$S($P(NODE,"^",8)["n":"NO",$P(NODE,"^",8)["y":"YES",1:"")
"RTN","SDRRINQ1",21,0)
 .S LOA=$P(NODE,"^",9)
"RTN","SDRRINQ1",22,0)
 .S Y=$P($G(NODE),"^",10) I Y'="" D DD^%DT S RSENT=Y K Y,X
"RTN","SDRRINQ1",23,0)
 .I RSENT="" S RSENT="NOTSENT"
"RTN","SDRRINQ1",24,0)
 .S USER=$P($G(NODE),"^",11),USER=$$NAME^XUSER(USER,"F")
"RTN","SDRRINQ1",25,0)
 .S Y=$P(NODE,"^",12) I Y'="" D DD^%DT S PRDT=Y K Y,X
"RTN","SDRRINQ1",26,0)
 .S Y=$P(NODE,"^",13) I Y'="" D DD^%DT S SSENT="*"_Y K Y,X
"RTN","SDRRINQ1",27,0)
 .S ^TMP("SDRRINQ",$J,"ACT",IEN)=CLINIC_"^"_ACCINFOR_"^"_TYPE_"^"_PROVIDER_"^"_RDT_"^"_COMMENT_"^"_FAST_"^"_LOA_"^"_RSENT_"^"_USER_"^"_PRDT_"^"_SSENT
"RTN","SDRRINQ1",28,0)
 Q
"RTN","SDRRINQ1",29,0)
SEL1 I $D(^SD(403.56,"B",DFN))  S (SSENT,RSENT,PRDTA,TYPE)="" S IENA=0 F  S IENA=$O(^SD(403.56,"B",DFN,IENA)) Q:'IENA  S NODEA=$G(^SD(403.56,IENA,0)) D
"RTN","SDRRINQ1",30,0)
 .S CLINIC=$P($G(NODEA),"^",2),CLINIC=$$GET1^DIQ(44,CLINIC_",",.01),ACCINFOR=$P($G(NODEA),"^",3)
"RTN","SDRRINQ1",31,0)
 .S TYPE=$P($G(NODEA),"^",4) I TYPE'="" S TYPE=$P(^SD(403.51,TYPE,0),"^",1)
"RTN","SDRRINQ1",32,0)
 .S PROVIDER=$P(NODEA,"^",5) I PROVIDER'="" S PROVIDER=$P($G(^SD(403.54,PROVIDER,0)),"^",1) S PROVIDER=$$NAME^XUSER(PROVIDER,"F")
"RTN","SDRRINQ1",33,0)
 .I PROVIDER="" S PROVIDER="Unknown"
"RTN","SDRRINQ1",34,0)
 .S RDT=""
"RTN","SDRRINQ1",35,0)
 .S Y=$P(NODEA,"^",6) Q:Y<SDT!(Y>EDT)
"RTN","SDRRINQ1",36,0)
 .I Y>SDT&(Y<EDT) D DD^%DT S RDT=Y K Y,X
"RTN","SDRRINQ1",37,0)
 .S COMMENT=$P($G(NODEA),"^",7)
"RTN","SDRRINQ1",38,0)
 .S FAST=$S($P(NODEA,"^",8)["n":"NO",$P(NODEA,"^",8)["y":"YES",1:"")
"RTN","SDRRINQ1",39,0)
 .S LOA=$P(NODEA,"^",9)
"RTN","SDRRINQ1",40,0)
 .S Y=$P($G(NODEA),"^",10) I Y'="" D DD^%DT S RSENT=Y K Y,X
"RTN","SDRRINQ1",41,0)
 .I RSENT="" S RSENT="NOTSENT"
"RTN","SDRRINQ1",42,0)
 .S USER=$P($G(NODEA),"^",11),USER=$$NAME^XUSER(USER,"F")
"RTN","SDRRINQ1",43,0)
 .I $D(^SD(403.56,IENA,2)) S NODEA2=$G(^SD(403.56,IENA,2)) D
"RTN","SDRRINQ1",44,0)
 ..S Y=$P(NODEA2,"^",1) D DD^%DT S PRDTA=Y K Y,X
"RTN","SDRRINQ1",45,0)
 ..S USER2=$P($G(NODEA2),"^",2),USER2=$$NAME^XUSER(USER2,"F")
"RTN","SDRRINQ1",46,0)
 ..S SDRREASN=$S($P(NODEA2,"^",3)=1:"FTR",$P(NODEA2,"^",3)=2:"MOVED",$P(NODEA2,"^",3)=3:"DECEASED",$P(NODEA2,"^",3)=4:"DNWC",$P(NODEA2,"^",3)=5:"RCOVA",$P(NODEA2,"^",3)=6:"OTHER",$P(NODEA2,"^",3)=7:"Scheduled",1:"")
"RTN","SDRRINQ1",47,0)
 ..S ^TMP("SDRRINQ",$J,"ARC",IENA)=CLINIC_"^"_ACCINFOR_"^"_TYPE_"^"_PROVIDER_"^"_RDT_"^"_COMMENT_"^"_FAST_"^"_LOA_"^"_RSENT_"^"_USER2_"^"_SSENT_"^"_SDRREASN_"^"_PRDTA
"RTN","SDRRINQ1",48,0)
 Q
"RTN","SDRRINQ1",49,0)
HDR ;Review all Recall Reminder on screen for all
"RTN","SDRRINQ1",50,0)
 D DEM^VADPT S NAME=VADM(1),LAST4=VA("BID"),DOB=$P(VADM(3),"^",2) S HDR="Patient Name: "_NAME_"  Date of Birth: "_DOB_" Last4: "_LAST4
"RTN","SDRRINQ1",51,0)
 W @IOF,HDR
"RTN","SDRRINQ1",52,0)
 Q
"RTN","SDRRINQ1",53,0)
ACT I $D(^SD(403.5,"B",DFN)) S (RSENT,SSENT,IEN,PRDT,TYPE)="" F  S IEN=$O(^SD(403.5,"B",DFN,IEN)) Q:'IEN  S NODE=$G(^SD(403.5,IEN,0)) D
"RTN","SDRRINQ1",54,0)
 .S CLINIC=$P($G(NODE),"^",2),CLINIC=$$GET1^DIQ(44,CLINIC_",",.01),ACCINFOR=$P($G(NODE),"^",3)
"RTN","SDRRINQ1",55,0)
 .S TYPE=$P($G(NODE),"^",4) I TYPE'="" S TYPE=$P(^SD(403.51,TYPE,0),"^",1)
"RTN","SDRRINQ1",56,0)
 .S PROVIDER=$P(NODE,"^",5) I PROVIDER'="" S PROVIDER=$P($G(^SD(403.54,PROVIDER,0)),"^",1) S PROVIDER=$$NAME^XUSER(PROVIDER,"F")
"RTN","SDRRINQ1",57,0)
 .I PROVIDER="" S PROVIDER="Unknown"
"RTN","SDRRINQ1",58,0)
 .S RDT=""
"RTN","SDRRINQ1",59,0)
 .S Y=$P(NODE,"^",6) D DD^%DT S RDT=Y K Y,X
"RTN","SDRRINQ1",60,0)
 .S COMMENT=$P($G(NODE),"^",7)
"RTN","SDRRINQ1",61,0)
 .S FAST=$S($P(NODE,"^",8)["n":"NO",$P(NODE,"^",8)["f":"YES",1:"")
"RTN","SDRRINQ1",62,0)
 .S LOA=$P(NODE,"^",9)
"RTN","SDRRINQ1",63,0)
 .S Y=$P($G(NODE),"^",10) I Y'="" D DD^%DT S RSENT=Y K Y,X
"RTN","SDRRINQ1",64,0)
 .I RSENT="" S RSENT="NOTSENT"
"RTN","SDRRINQ1",65,0)
 .S USER=$P($G(NODE),"^",11),USER=$$NAME^XUSER(USER,"F")
"RTN","SDRRINQ1",66,0)
 .S Y=$P(NODE,"^",12) I Y'="" D DD^%DT S PRDT=Y K Y,X
"RTN","SDRRINQ1",67,0)
 .S Y=$P(NODE,"^",13) I Y'="" D DD^%DT S SSENT="*"_Y K Y,X
"RTN","SDRRINQ1",68,0)
 .S ^TMP("SDRRINQ",$J,"ACT",IEN)=CLINIC_"^"_ACCINFOR_"^"_TYPE_"^"_PROVIDER_"^"_RDT_"^"_COMMENT_"^"_FAST_"^"_LOA_"^"_RSENT_"^"_USER_"^"_PRDT_"^"_SSENT
"RTN","SDRRINQ1",69,0)
 Q
"RTN","SDRRINQ1",70,0)
ARC I $D(^SD(403.56,"B",DFN))  S (SSENT,RSENT,PRDTA,TYPE)="" S IENA=0 F  S IENA=$O(^SD(403.56,"B",DFN,IENA)) Q:'IENA  S NODEA=$G(^SD(403.56,IENA,0)) D
"RTN","SDRRINQ1",71,0)
 .S CLINIC=$P($G(NODEA),"^",2),CLINIC=$$GET1^DIQ(44,CLINIC_",",.01),ACCINFOR=$P($G(NODEA),"^",3)
"RTN","SDRRINQ1",72,0)
 .S TYPE=$P($G(NODEA),"^",4) I TYPE'="" S TYPE=$P(^SD(403.51,TYPE,0),"^",1)
"RTN","SDRRINQ1",73,0)
 .S PROVIDER=$P(NODEA,"^",5) I PROVIDER'="" S PROVIDER=$P($G(^SD(403.54,PROVIDER,0)),"^",1) S PROVIDER=$$NAME^XUSER(PROVIDER,"F")
"RTN","SDRRINQ1",74,0)
 .I PROVIDER="" S PROVIDER="Unknown"
"RTN","SDRRINQ1",75,0)
 .S RDT=""
"RTN","SDRRINQ1",76,0)
 .S Y=$P(NODEA,"^",6) D DD^%DT S RDT=Y K Y,X
"RTN","SDRRINQ1",77,0)
 .S COMMENT=$P($G(NODEA),"^",7)
"RTN","SDRRINQ1",78,0)
 .S FAST=$S($P(NODEA,"^",8)["n":"NO",$P(NODEA,"^",8)["f":"YES",1:"")
"RTN","SDRRINQ1",79,0)
 .S LOA=$P(NODEA,"^",9)
"RTN","SDRRINQ1",80,0)
 .S Y=$P($G(NODEA),"^",10) I Y'="" D DD^%DT S RSENT=Y K Y,X
"RTN","SDRRINQ1",81,0)
 .I RSENT="" S RSENT="NOTSENT"
"RTN","SDRRINQ1",82,0)
 .S USER=$P($G(NODEA),"^",11),USER=$$NAME^XUSER(USER,"F")
"RTN","SDRRINQ1",83,0)
 .I $D(^SD(403.56,IENA,2)) S NODEA2=$G(^SD(403.56,IENA,2)) D
"RTN","SDRRINQ1",84,0)
 ..S Y=$P(NODEA2,"^",1) D DD^%DT S PRDTA=Y K Y,X
"RTN","SDRRINQ1",85,0)
 ..S USER2=$P($G(NODEA2),"^",2),USER2=$$NAME^XUSER(USER2,"F")
"RTN","SDRRINQ1",86,0)
 ..S SDRREASN=$S($P(NODEA2,"^",3)=1:"FTR",$P(NODEA2,"^",3)=2:"MOVED",$P(NODEA2,"^",3)=3:"DECEASED",$P(NODEA2,"^",3)=4:"DNWC",$P(NODEA2,"^",3)=5:"RCOVA",$P(NODEA2,"^",3)=6:"OTHER",$P(NODEA2,"^",3)=7:"Scheduled",1:"")
"RTN","SDRRINQ1",87,0)
 ..S ^TMP("SDRRINQ",$J,"ARC",IENA)=CLINIC_"^"_ACCINFOR_"^"_TYPE_"^"_PROVIDER_"^"_RDT_"^"_COMMENT_"^"_FAST_"^"_LOA_"^"_RSENT_"^"_USER2_"^"_SSENT_"^"_SDRREASN_"^"_PRDTA
"RTN","SDRRINQ1",88,0)
 Q
"RTN","SDRRINQ1",89,0)
REPORT D HDR
"RTN","SDRRINQ1",90,0)
 I '$D(^TMP("SDRRINQ",$J,"ACT")) W !!,?25,"No ACTIVE Recalls Reminders on file"
"RTN","SDRRINQ1",91,0)
 I $D(^TMP("SDRRINQ",$J,"ACT")) S ITEM=0 F  S ITEM=$O(^TMP("SDRRINQ",$J,"ACT",ITEM)) Q:'ITEM  D
"RTN","SDRRINQ1",92,0)
 .S INFOR=$G(^TMP("SDRRINQ",$J,"ACT",ITEM))
"RTN","SDRRINQ1",93,0)
 .W !!,?5,"Clinic: "_$P($G(INFOR),"^",1),?45,"Recall Date: "_$P($G(INFOR),"^",5)
"RTN","SDRRINQ1",94,0)
 .W !,?5,"Provider: "_$P($G(INFOR),"^",4),?45,"Appt/Type: "_$P($G(INFOR),"^",3)
"RTN","SDRRINQ1",95,0)
 .W !,?5,"Fasting/NonFasting: "_$P($G(INFOR),"^",7)
"RTN","SDRRINQ1",96,0)
 .W !,?5,"Appt Requested Length: "_$P($G(INFOR),"^",8),?45,"Date Reminder Sent: "_$P($G(INFOR),"^",9)
"RTN","SDRRINQ1",97,0)
 .W !,?5,"User who Entered: "_$P($G(INFOR),"^",10),?45,"Patient Requested Dt: "_$P($G(INFOR),"^",11)
"RTN","SDRRINQ1",98,0)
 .W !,?5,"Date Second Reminder Sent: "_$P($G(INFOR),"^",12)
"RTN","SDRRINQ1",99,0)
 .W !,?5,"Comments: "_$P($G(INFOR),"^",6)
"RTN","SDRRINQ1",100,0)
 .I IOST["C-",($Y>(IOSL-6)) K DIR S DIR(0)="E",DIR("A")="Press Return for more Information.." D ^DIR Q:$D(DUOUT)!($D(DTOUT))  D HDR K DIR
"RTN","SDRRINQ1",101,0)
 Q
"RTN","SDRRINQ1",102,0)
REPORT1 D HDR
"RTN","SDRRINQ1",103,0)
 I '$D(^TMP("SDRRINQ",$J,"ARC")) W !!,?25,"No INACTIVE Recalls Reminders on file" Q
"RTN","SDRRINQ1",104,0)
 I $D(^TMP("SDRRINQ",$J,"ARC")) W !!,?25,"INACTIVE RECALL REMINDERS"
"RTN","SDRRINQ1",105,0)
 S ITEM=0 F  S ITEM=$O(^TMP("SDRRINQ",$J,"ARC",ITEM)) Q:'ITEM  D
"RTN","SDRRINQ1",106,0)
 .S INFOR=$G(^TMP("SDRRINQ",$J,"ARC",ITEM))
"RTN","SDRRINQ1",107,0)
 .W !!,?5,"Clinic: "_$P($G(INFOR),"^",1),?45,"Recall Date: "_$P($G(INFOR),"^",5)
"RTN","SDRRINQ1",108,0)
 .W !,?5,"Provider: "_$P($G(INFOR),"^",4),?45,"Appt/Type: "_$P($G(INFOR),"^",3)
"RTN","SDRRINQ1",109,0)
 .W !,?5,"Fasting/NonFasting: "_$P($G(INFOR),"^",7)
"RTN","SDRRINQ1",110,0)
 .W !,?5,"Appt Requested Length: "_$P($G(INFOR),"^",8),?45,"Date Reminder Sent: "_$P($G(INFOR),"^",9)
"RTN","SDRRINQ1",111,0)
 .W !,?5,"User who Entered: "_$P($G(INFOR),"^",10),?45,"Patient Requested Dt: "_$P($G(INFOR),"^",11)
"RTN","SDRRINQ1",112,0)
 .W !,?5,"Date Removed from Active File: "_$P($G(INFOR),"^",13)
"RTN","SDRRINQ1",113,0)
 .W !,?5,"Reason for Removal: "_$P($G(INFOR),"^",12)
"RTN","SDRRINQ1",114,0)
 .W !,?5,"User who Deleted Entry: "_$P($G(INFOR),"^",10)
"RTN","SDRRINQ1",115,0)
 .W !,?5,"Comments: "_$P($G(INFOR),"^",6)
"RTN","SDRRINQ1",116,0)
 .I IOST["C-",($Y>(IOSL-6)) K DIR S DIR(0)="E",DIR("A")="Press Return for more Information.." D ^DIR Q:$D(DUOUT)!($D(DTOUT))  D HDR K DIR
"RTN","SDRRINQ1",117,0)
 Q
"RTN","SDRRINQ1",118,0)
QUIT D ^%ZISC K POP,%ZIS,IOP,ZTDESC,ZTDTH,ZTRTN,ZTSAVE,ZTSK
"RTN","SDRRINQ1",119,0)
 K DFN,Y,SHOW,SHOW1,ACCINFOR,CLINIC,COMMENT,DOB,DIRUT,DTOUT,DUOUT,EDT,ERR,FAST,HDR,IEN,IENA,INFOR,ITEM,LAST4,LOA,NAME
"RTN","SDRRINQ1",120,0)
 K NODE,NODEA,PRDT,PRDTA,PROVIDER,RANGE,RDT,RSENT,SDRREASN,SDT,SSENT,TYPE,USER,USER2,NODEA2,YES,DIR
"RTN","SDRRINQ1",121,0)
 K ^TMP("SDRRINQ",$J),VA,VA,VADM
"RTN","SDRRINQ1",122,0)
 Q
"RTN","SDRRISB")
0^10^B778508
"RTN","SDRRISB",1,0)
SDRRISB ;10N20/MAH;Recall Reminder appointments ;01/15/2008 07:35
"RTN","SDRRISB",2,0)
 ;;5.3;Scheduling;**536**;Aug 13, 1993;Build 53
"RTN","SDRRISB",3,0)
 ; 
"RTN","SDRRISB",4,0)
 ; 
"RTN","SDRRISB",5,0)
CLINLIST(SDRRCLIST) ;
"RTN","SDRRISB",6,0)
 N SDRRDIEN,SDRRCLIN
"RTN","SDRRISB",7,0)
 S (SDRRDIEN,SDRRCLIN)=""
"RTN","SDRRISB",8,0)
 F  S SDRRDIEN=$O(^TMP("SDRR",$J,"DIV",SDRRDIEN)) Q:SDRRDIEN=""  D
"RTN","SDRRISB",9,0)
 . F  S SDRRCLIN=$O(^TMP("SDRR",$J,"DIV",SDRRDIEN,"CLIN",SDRRCLIN)) Q:SDRRCLIN=""  S SDRRCLIST(+^(SDRRCLIN))=SDRRCLIN
"RTN","SDRRISB",10,0)
 Q
"RTN","SDRRISRA")
0^11^B33542930
"RTN","SDRRISRA",1,0)
SDRRISRA ;10N20/MAH;Recall Reminder Scheduled Report;01/18/2008
"RTN","SDRRISRA",2,0)
 ;;5.3;Scheduling;**536**;Aug 13, 1993;Build 53
"RTN","SDRRISRA",3,0)
 ; Option: SDRR RECALL APPOINTMENTS
"RTN","SDRRISRA",4,0)
EN ;
"RTN","SDRRISRA",5,0)
 N ARHST,ARHND,ARHSTX,ARHNDX,ARHBRK,ARHABORT,I,ZTSAVE,XMDUZ,XMSUB,ZTSK
"RTN","SDRRISRA",6,0)
 N ARHDIV,ARHDAYS,DIR,X,Y,Z,ZTDESC,ZTQUEUED
"RTN","SDRRISRA",7,0)
 I '$D(^SD(403.56,"C")) W !!,"***No Entries Have Been Scheduled For Appointments***" Q
"RTN","SDRRISRA",8,0)
 S ARHABORT=0
"RTN","SDRRISRA",9,0)
 W !!,"Select a time period and a set of clinics, and I'll tell you all the"
"RTN","SDRRISRA",10,0)
 W !,"patients who were on the Recall List, but were deleted from the list"
"RTN","SDRRISRA",11,0)
 W !,"because they've made appointments."
"RTN","SDRRISRA",12,0)
 W !!,"First select the Recall Date range. The default dates are determined by the"
"RTN","SDRRISRA",13,0)
 W !,"entries in Recall Reminders Removed File."
"RTN","SDRRISRA",14,0)
 S ARHST=$O(^SD(403.56,"C",""))
"RTN","SDRRISRA",15,0)
 S ARHND=$O(^SD(403.56,"C",""),-1)
"RTN","SDRRISRA",16,0)
 D DRANGE^SDRRUTL(.ARHST,.ARHND,.ARHSTX,.ARHNDX,.ARHABORT,ARHST,ARHND) Q:ARHABORT
"RTN","SDRRISRA",17,0)
 K ^TMP("SDRR",$J)
"RTN","SDRRISRA",18,0)
 D ASKDIV^SDRRPXC(.ARHDIV) Q:'ARHDIV
"RTN","SDRRISRA",19,0)
 D ASKCLIN^SDRRPXC(.ARHDIV,ARHST,ARHND) Q:'$D(^TMP("SDRR",$J))
"RTN","SDRRISRA",20,0)
 W !
"RTN","SDRRISRA",21,0)
 K DIR,X,Y
"RTN","SDRRISRA",22,0)
 S DIR(0)="Y"
"RTN","SDRRISRA",23,0)
 S DIR("A")="Page break on clinic"
"RTN","SDRRISRA",24,0)
 S DIR("B")="Yes"
"RTN","SDRRISRA",25,0)
 D ^DIR Q:$D(DIRUT)
"RTN","SDRRISRA",26,0)
 K DIRUT
"RTN","SDRRISRA",27,0)
 S ARHBRK=Y ; Page break on Clinic
"RTN","SDRRISRA",28,0)
 S XMSUB="Scheduled Recall Appointments, "_$S(ARHST=ARHND:ARHSTX,1:ARHSTX_"-"_ARHNDX)
"RTN","SDRRISRA",29,0)
 F I="ARHDIV","ARHDIV(","ARHST","ARHSTX","ARHND","ARHNDX","ARHBRK","ARHDAYS","^TMP(""SDRR"",$J," S ZTSAVE(I)=""
"RTN","SDRRISRA",30,0)
 D EN^XUTMDEVQ("CONTROL^SDRRISRA",XMSUB,.ZTSAVE,,1)
"RTN","SDRRISRA",31,0)
 I '$D(ZTQUEUED),$D(ZTSK) W !,"Request queued.  (Task: ",ZTSK,")"
"RTN","SDRRISRA",32,0)
 Q
"RTN","SDRRISRA",33,0)
CONTROL ;
"RTN","SDRRISRA",34,0)
 N ARHIA,ARHCLIST
"RTN","SDRRISRA",35,0)
 S ARHIA=$E($G(IOST),1,2)="C-"
"RTN","SDRRISRA",36,0)
 D CLINLIST^SDRRISB(.ARHCLIST)
"RTN","SDRRISRA",37,0)
 D GATHER
"RTN","SDRRISRA",38,0)
 D PRINT
"RTN","SDRRISRA",39,0)
 K ^TMP("SDRR",$J)
"RTN","SDRRISRA",40,0)
 Q
"RTN","SDRRISRA",41,0)
GATHER ; Gather Patient from Recall Deletions List
"RTN","SDRRISRA",42,0)
 N ARHDT,ARHIEN,ARHDFN,ARHREC,ARHDFN0,ARHCLIN,ARHSDT,ARHADT,ARHADAYS,DFN,ARHMADE,ARHCOM
"RTN","SDRRISRA",43,0)
 S ARHND=ARHND+.9999
"RTN","SDRRISRA",44,0)
 S (ARHCLIN,ARHIEN)="" ; "D" xref is on Clinic and Recall Date
"RTN","SDRRISRA",45,0)
 F  S ARHCLIN=$O(ARHCLIST(ARHCLIN)) Q:'ARHCLIN  D
"RTN","SDRRISRA",46,0)
 . Q:'$D(^SD(403.56,"D",ARHCLIN))
"RTN","SDRRISRA",47,0)
 . S ARHDT=ARHST-.1
"RTN","SDRRISRA",48,0)
 . F  S ARHDT=$O(^SD(403.56,"D",ARHCLIN,ARHDT)) Q:ARHDT>ARHND!'ARHDT  D
"RTN","SDRRISRA",49,0)
 . . F  S ARHIEN=$O(^SD(403.56,"D",ARHCLIN,ARHDT,ARHIEN)) Q:'ARHIEN  D
"RTN","SDRRISRA",50,0)
 . . . S ARHADT=+$G(^SD(403.56,ARHIEN,1)) ; Appointment date
"RTN","SDRRISRA",51,0)
 . . . Q:'ARHADT  ; got appt.?
"RTN","SDRRISRA",52,0)
 . . . S ARHREC=$G(^SD(403.56,ARHIEN,0))
"RTN","SDRRISRA",53,0)
 . . . S ARHDFN=+ARHREC
"RTN","SDRRISRA",54,0)
 . . . Q:$$TESTPAT^VADPT(ARHDFN)  ; Test patient
"RTN","SDRRISRA",55,0)
 . . . S DFN=ARHDFN
"RTN","SDRRISRA",56,0)
 . . . D ADD^VADPT,DEM^VADPT
"RTN","SDRRISRA",57,0)
 . . . Q:$G(VADM(6),U)'=""
"RTN","SDRRISRA",58,0)
 . . . S ARHSDT=$P(ARHREC,U,10) ; Reminder sent date
"RTN","SDRRISRA",59,0)
 . . . N SDARRAY,SDCOUNT,SDDATE,SDAPPT
"RTN","SDRRISRA",60,0)
 . . . S SDARRAY(1)=""_$P(ARHADT,".",1)_";"_$P(ARHADT,".",1)_""
"RTN","SDRRISRA",61,0)
 . . . S SDARRAY(2)=ARHCLIN
"RTN","SDRRISRA",62,0)
 . . . S SDARRAY(4)=DFN
"RTN","SDRRISRA",63,0)
 . . . S SDARRAY("FLDS")="16"
"RTN","SDRRISRA",64,0)
 . . . S SDCOUNT=$$SDAPI^SDAMA301(.SDARRAY)
"RTN","SDRRISRA",65,0)
 . . . I SDCOUNT>0 D
"RTN","SDRRISRA",66,0)
 . . . . S SDDATE=0 F  S SDDATE=$O(^TMP($J,"SDAMA301",DFN,ARHCLIN,SDDATE)) Q:SDDATE=""  D
"RTN","SDRRISRA",67,0)
 . . . . . S SDAPPT=$G(^TMP($J,"SDAMA301",DFN,ARHCLIN,SDDATE))
"RTN","SDRRISRA",68,0)
 . . . . . S ARHMADE=$P(SDAPPT,"^",16)
"RTN","SDRRISRA",69,0)
 . . . I SDCOUNT'=0 K ^TMP($J,"SDAMA301")
"RTN","SDRRISRA",70,0)
 . . . S ARHADAYS=$$FMDIFF^XLFDT(ARHADT,ARHDT)
"RTN","SDRRISRA",71,0)
 . . . S ARHCOM=$P($G(ARHREC),"^",7)
"RTN","SDRRISRA",72,0)
 . . . S ^TMP("SDRR",$J,"PRT",ARHCLIST(ARHCLIN)_U_ARHCLIN,ARHADAYS,$P(VADM(1),U)_U_ARHDFN,ARHADT)=$P(VA("BID"),U)_U_ARHDT_U_ARHSDT_U_ARHMADE_U_ARHCOM
"RTN","SDRRISRA",73,0)
 D KVAR^VADPT
"RTN","SDRRISRA",74,0)
 Q
"RTN","SDRRISRA",75,0)
PRINT ;
"RTN","SDRRISRA",76,0)
 N ARHTODAY,ARHCLIN,ARHCLSAV,ARHDT,ARHREC,ARHPAGE,ARHABORT,ARHDR,ARHADT,ARHSP
"RTN","SDRRISRA",77,0)
 N ARHPAT,ARHSSN,ARHCNT,ARHDTX,ARHSDT,ARHADAYS,ARHPROV,ARHDFN,ARHOTHER,ARHCOMM
"RTN","SDRRISRA",78,0)
 S (ARHABORT,ARHPAGE)=0
"RTN","SDRRISRA",79,0)
 I ARHIA W @IOF
"RTN","SDRRISRA",80,0)
 S ARHTODAY=$$FMTE^XLFDT(DT)
"RTN","SDRRISRA",81,0)
 S ARHDR=$$CJ^XLFSTR(ZTDESC,IOM-1)
"RTN","SDRRISRA",82,0)
 S $E(ARHDR,1,$L(ARHTODAY))=ARHTODAY
"RTN","SDRRISRA",83,0)
 S ARHDR=$E(ARHDR,1,IOM-8)_"Page"
"RTN","SDRRISRA",84,0)
 D HEADER
"RTN","SDRRISRA",85,0)
 I '$D(^TMP("SDRR",$J,"PRT")) W !,"No Scheduled Recall Appointments found for this date range." Q
"RTN","SDRRISRA",86,0)
 S (ARHCLIN,ARHPAT,ARHADAYS,ARHADT)=""
"RTN","SDRRISRA",87,0)
 S ARHCLSAV=ARHCLIN
"RTN","SDRRISRA",88,0)
 F  S ARHCLIN=$O(^TMP("SDRR",$J,"PRT",ARHCLIN)) Q:ARHCLIN=""  D  Q:ARHABORT
"RTN","SDRRISRA",89,0)
 . I ARHCLSAV'="",ARHBRK!($Y+5+ARHIA>IOSL) D  Q:ARHABORT
"RTN","SDRRISRA",90,0)
 . . I ARHIA D PAGE^XMXUTIL(.ARHABORT) Q:ARHABORT
"RTN","SDRRISRA",91,0)
 . . W @IOF D HEADER
"RTN","SDRRISRA",92,0)
 . S ARHCLSAV=ARHCLIN
"RTN","SDRRISRA",93,0)
 . S ARHPROV=$$PRDEF^SDCO31($P(ARHCLIN,U,2))
"RTN","SDRRISRA",94,0)
 . I ARHPROV="" S ARHPROV="(No Default Provider)"
"RTN","SDRRISRA",95,0)
 . W !!,$$CJ^XLFSTR(" "_$P(ARHCLIN,U)_"    "_ARHPROV_" ",79,"-")
"RTN","SDRRISRA",96,0)
 . S ARHCNT=0
"RTN","SDRRISRA",97,0)
 . F  S ARHADAYS=$O(^TMP("SDRR",$J,"PRT",ARHCLIN,ARHADAYS),-1) Q:ARHADAYS=""  D  Q:ARHABORT
"RTN","SDRRISRA",98,0)
 . . F  S ARHPAT=$O(^TMP("SDRR",$J,"PRT",ARHCLIN,ARHADAYS,ARHPAT)) Q:ARHPAT=""  D  Q:ARHABORT
"RTN","SDRRISRA",99,0)
 . . . S ARHDFN=$P(ARHPAT,U,2)
"RTN","SDRRISRA",100,0)
 . . . F  S ARHADT=$O(^TMP("SDRR",$J,"PRT",ARHCLIN,ARHADAYS,ARHPAT,ARHADT)) Q:'ARHADT  S ARHREC=^(ARHADT) D  Q:ARHABORT
"RTN","SDRRISRA",101,0)
 . . . . S ARHCNT=ARHCNT+1
"RTN","SDRRISRA",102,0)
 . . . . S ARHSSN=$E(ARHREC,1,4)
"RTN","SDRRISRA",103,0)
 . . . . S ARHDT=$P(ARHREC,U,2)
"RTN","SDRRISRA",104,0)
 . . . . S ARHSDT=$P(ARHREC,U,3)
"RTN","SDRRISRA",105,0)
 . . . . S ARHMADE=$P(ARHREC,U,4)
"RTN","SDRRISRA",106,0)
 . . . . S ARHCOMM=$P(ARHREC,U,5)
"RTN","SDRRISRA",107,0)
 . . . . I $Y+2+($L(ARHCOMM)>18)+ARHIA>IOSL D  Q:ARHABORT
"RTN","SDRRISRA",108,0)
 . . . . . I ARHIA D PAGE^XMXUTIL(.ARHABORT) Q:ARHABORT
"RTN","SDRRISRA",109,0)
 . . . . . W @IOF D HEADER
"RTN","SDRRISRA",110,0)
 . . . . W !,$E($P(ARHPAT,U),1,14),?15,ARHSSN,?20,$$FMTE^XLFDT($E(ARHSDT,1,7),"2Z"),?29,$$FMTE^XLFDT($E(ARHDT,1,7),"2Z"),?38,$$FMTE^XLFDT($E(ARHADT,1,7),"2Z"),?47,$J(ARHADAYS,4)
"RTN","SDRRISRA",111,0)
 . . . . W ?52,$$FMTE^XLFDT($E(ARHMADE,1,7),"2Z") I $L(ARHCOMM)<19 W ?61,ARHCOMM Q
"RTN","SDRRISRA",112,0)
 . . . . Q:ARHCOMM=""
"RTN","SDRRISRA",113,0)
 . . . . W !,$$RJ^XLFSTR($E(ARHCOMM,1,79),79)
"RTN","SDRRISRA",114,0)
 . Q:ARHABORT
"RTN","SDRRISRA",115,0)
 . D SUBTOT
"RTN","SDRRISRA",116,0)
 Q:ARHABORT
"RTN","SDRRISRA",117,0)
 I ARHIA D WAIT^XMXUTIL
"RTN","SDRRISRA",118,0)
 Q
"RTN","SDRRISRA",119,0)
HEADER ;
"RTN","SDRRISRA",120,0)
 S ARHPAGE=ARHPAGE+1
"RTN","SDRRISRA",121,0)
 W ARHDR,$J(ARHPAGE,3)
"RTN","SDRRISRA",122,0)
 W !!,?20,"Reminder",?47,"Days",?52,"Appt"
"RTN","SDRRISRA",123,0)
 W !,"Patient",?15,"SSN",?20,"Sent",?29,"Recall",?38,"Appt",?47,"Diff",?52,"Made",?61,"Other Info"
"RTN","SDRRISRA",124,0)
 W !,"-------------- ---- -------- -------- -------- ---- -------- ------------------"
"RTN","SDRRISRA",125,0)
 Q
"RTN","SDRRISRA",126,0)
SUBTOT ;
"RTN","SDRRISRA",127,0)
 I $Y+3+ARHIA>IOSL D  Q:ARHABORT
"RTN","SDRRISRA",128,0)
 . I ARHIA D PAGE^XMXUTIL(.ARHABORT) Q:ARHABORT
"RTN","SDRRISRA",129,0)
 . W @IOF D HEADER
"RTN","SDRRISRA",130,0)
 W !!,"Scheduled Recall Appointments: ",ARHCNT
"RTN","SDRRISRA",131,0)
 Q
"RTN","SDRRISRD")
0^12^B26348770
"RTN","SDRRISRD",1,0)
SDRRISRD ;10N20/MAH;-Recall List Delinquencies ;01/18/2008  11:32
"RTN","SDRRISRD",2,0)
 ;;5.3;Scheduling;**536**;Aug 13, 1993;Build 53
"RTN","SDRRISRD",3,0)
 ;
"RTN","SDRRISRD",4,0)
 ; Option: SDRR RECALL DELINQUENCIES
"RTN","SDRRISRD",5,0)
EN ;
"RTN","SDRRISRD",6,0)
 N SDRRST,SDRRND,SDRRSTX,SDRRNDX,SDRRBRK,SDRRABORT,I,ZTSAVE,XMDUZ,XMSUB,ZTSK,VA,VADM,VAPA
"RTN","SDRRISRD",7,0)
 N SDRRDIV,SDRRDAYS,DIR,X,Y,Z,ZTDESC,ZTQUEUED
"RTN","SDRRISRD",8,0)
 S SDRRABORT=0
"RTN","SDRRISRD",9,0)
 W !!,"Select a time period and a set of clinics, and I'll tell you all the"
"RTN","SDRRISRD",10,0)
 W !,"patients who are on the Recall List for that time period at those clinics"
"RTN","SDRRISRD",11,0)
 W !,"who've been sent reminders, but haven't yet made an appointment."
"RTN","SDRRISRD",12,0)
 W !!,"First select the Recall Date range."
"RTN","SDRRISRD",13,0)
 S SDRRND=$$FMADD^XLFDT(DT,-1)
"RTN","SDRRISRD",14,0)
 D DRANGE^SDRRUTL(.SDRRST,.SDRRND,.SDRRSTX,.SDRRNDX,.SDRRABORT) Q:SDRRABORT
"RTN","SDRRISRD",15,0)
 K ^TMP("SDRR",$J)
"RTN","SDRRISRD",16,0)
 D ASKDIV^SDRRPXC(.SDRRDIV) Q:'SDRRDIV
"RTN","SDRRISRD",17,0)
 D ASKCLIN^SDRRPXC(.SDRRDIV,SDRRST,SDRRND) Q:'$D(^TMP("SDRR",$J))
"RTN","SDRRISRD",18,0)
 W !
"RTN","SDRRISRD",19,0)
 K DIR,X,Y
"RTN","SDRRISRD",20,0)
 S DIR(0)="Y"
"RTN","SDRRISRD",21,0)
 S DIR("A")="Page break on clinic"
"RTN","SDRRISRD",22,0)
 S DIR("B")="Yes"
"RTN","SDRRISRD",23,0)
 D ^DIR Q:$D(DIRUT)
"RTN","SDRRISRD",24,0)
 K DIRUT
"RTN","SDRRISRD",25,0)
 S SDRRBRK=Y ; Page break on Clinic
"RTN","SDRRISRD",26,0)
 S XMSUB="Recall Delinquency List, "_$S(SDRRST=SDRRND:SDRRSTX,1:SDRRSTX_"-"_SDRRNDX)
"RTN","SDRRISRD",27,0)
 F I="SDRRDIV","SDRRDIV(","SDRRST","SDRRSTX","SDRRND","SDRRNDX","SDRRBRK","SDRRDAYS","^TMP(""SDRR"",$J," S ZTSAVE(I)=""
"RTN","SDRRISRD",28,0)
 D EN^XUTMDEVQ("CONTROL^SDRRISRD",XMSUB,.ZTSAVE,,1)
"RTN","SDRRISRD",29,0)
 I '$D(ZTQUEUED),$D(ZTSK) W !,"Request queued.  (Task: ",ZTSK,")"
"RTN","SDRRISRD",30,0)
 Q
"RTN","SDRRISRD",31,0)
CONTROL ;
"RTN","SDRRISRD",32,0)
 N SDRRIA,SDRRCLIST
"RTN","SDRRISRD",33,0)
 S SDRRIA=$E($G(IOST),1,2)="C-"
"RTN","SDRRISRD",34,0)
 D CLINLIST^SDRRISB(.SDRRCLIST)
"RTN","SDRRISRD",35,0)
 D GATHER
"RTN","SDRRISRD",36,0)
 D PRINT
"RTN","SDRRISRD",37,0)
 K ^TMP("SDRR",$J)
"RTN","SDRRISRD",38,0)
 Q
"RTN","SDRRISRD",39,0)
GATHER ; Gather Patient from Recall List
"RTN","SDRRISRD",40,0)
 N SDRRDT,SDRRIEN,SDRRDFN,SDRRREC,SDRRDFN0,SDRRCLIN,SDRRSDT,SDRRPH,SDRRDDAYS,DFN,VA,VADM,VAPA
"RTN","SDRRISRD",41,0)
 S SDRRND=SDRRND+.9999
"RTN","SDRRISRD",42,0)
 S SDRRDT=SDRRST-.1
"RTN","SDRRISRD",43,0)
 S SDRRIEN="" ; "D" xref is on the RECALL DATE field
"RTN","SDRRISRD",44,0)
 F  S SDRRDT=$O(^SD(403.5,"D",SDRRDT)) Q:SDRRDT>SDRRND!'SDRRDT  D
"RTN","SDRRISRD",45,0)
 . F  S SDRRIEN=$O(^SD(403.5,"D",SDRRDT,SDRRIEN)) Q:'SDRRIEN  D
"RTN","SDRRISRD",46,0)
 . . S SDRRREC=$G(^SD(403.5,SDRRIEN,0))
"RTN","SDRRISRD",47,0)
 . . S SDRRCLIN=+$P(SDRRREC,U,2)
"RTN","SDRRISRD",48,0)
 . . Q:'$D(SDRRCLIST(SDRRCLIN))  ; Must be clinic we want
"RTN","SDRRISRD",49,0)
 . . S SDRRSDT=$P(SDRRREC,U,10) ; Reminder sent date
"RTN","SDRRISRD",50,0)
 . . S Z=$P(SDRRREC,U,13) I Z'="" S Z="*"
"RTN","SDRRISRD",51,0)
 . . Q:'SDRRSDT  ; Reminder must have been sent
"RTN","SDRRISRD",52,0)
 . . S SDRRDFN=+SDRRREC
"RTN","SDRRISRD",53,0)
 . . Q:$$TESTPAT^VADPT(SDRRDFN)  ; Test patient
"RTN","SDRRISRD",54,0)
 . . S DFN=SDRRDFN
"RTN","SDRRISRD",55,0)
 . . D ADD^VADPT,DEM^VADPT
"RTN","SDRRISRD",56,0)
 . . Q:$G(VADM(6),U)'=""
"RTN","SDRRISRD",57,0)
 . . S SDRRDDAYS=$$FMDIFF^XLFDT(DT,SDRRDT)
"RTN","SDRRISRD",58,0)
 . . N SDRRPW
"RTN","SDRRISRD",59,0)
 . . S SDRRPW="" S SDRRPW=$$GET1^DIQ(2,DFN_",",.132)
"RTN","SDRRISRD",60,0)
 . . S ^TMP("SDRR",$J,"PRT",SDRRCLIST(SDRRCLIN)_U_SDRRCLIN,SDRRDDAYS,$P(VADM(1),U)_U_SDRRDFN)=$P(VA("BID"),U)_U_$P(VAPA(8),U,1)_U_SDRRPW_U_SDRRDT_U_Z_U_SDRRSDT
"RTN","SDRRISRD",61,0)
 D KVAR^VADPT
"RTN","SDRRISRD",62,0)
 Q
"RTN","SDRRISRD",63,0)
PRINT ;
"RTN","SDRRISRD",64,0)
 N SDRRTODAY,SDRRCLIN,SDRRCLSAV,SDRRDT,SDRRREC,SDRRPAGE,SDRRABORT,SDRRDR,SDRRRP
"RTN","SDRRISRD",65,0)
 N SDRRPAT,SDRRSSN,SDRRCNT,SDRRDTX,SDRRPH,SDRRPW,SDRRSDT,SDRRDDAYS,SDRRPROV
"RTN","SDRRISRD",66,0)
 S (SDRRABORT,SDRRPAGE)=0
"RTN","SDRRISRD",67,0)
 I SDRRIA W @IOF
"RTN","SDRRISRD",68,0)
 S SDRRTODAY=$$FMTE^XLFDT(DT)
"RTN","SDRRISRD",69,0)
 S SDRRDR=$$CJ^XLFSTR(ZTDESC,IOM-1)
"RTN","SDRRISRD",70,0)
 S $E(SDRRDR,1,$L(SDRRTODAY))=SDRRTODAY
"RTN","SDRRISRD",71,0)
 S SDRRDR=$E(SDRRDR,1,IOM-8)_"Page"
"RTN","SDRRISRD",72,0)
 D HEADER
"RTN","SDRRISRD",73,0)
 I '$D(^TMP("SDRR",$J,"PRT")) W !,"No Recall Delinquencies found for this date range." Q
"RTN","SDRRISRD",74,0)
 S (SDRRCLIN,SDRRPAT,SDRRDDAYS)=""
"RTN","SDRRISRD",75,0)
 S SDRRCLSAV=SDRRCLIN
"RTN","SDRRISRD",76,0)
 F  S SDRRCLIN=$O(^TMP("SDRR",$J,"PRT",SDRRCLIN)) Q:SDRRCLIN=""  D  Q:SDRRABORT
"RTN","SDRRISRD",77,0)
 . I SDRRCLSAV'="",SDRRBRK!($Y+4+SDRRIA>IOSL) D  Q:SDRRABORT
"RTN","SDRRISRD",78,0)
 . . I SDRRIA D PAGE^XMXUTIL(.SDRRABORT) Q:SDRRABORT
"RTN","SDRRISRD",79,0)
 . . W @IOF D HEADER
"RTN","SDRRISRD",80,0)
 . S SDRRCLSAV=SDRRCLIN
"RTN","SDRRISRD",81,0)
 . S SDRRPROV=$$PRDEF^SDCO31($P(SDRRCLIN,U,2))
"RTN","SDRRISRD",82,0)
 . I SDRRPROV="" S SDRRPROV="(No Default Provider)"
"RTN","SDRRISRD",83,0)
 . W !!,$$CJ^XLFSTR(" "_$P(SDRRCLIN,U)_"    "_SDRRPROV_" ",79,"-")
"RTN","SDRRISRD",84,0)
 . S SDRRCNT=0
"RTN","SDRRISRD",85,0)
 . F  S SDRRDDAYS=$O(^TMP("SDRR",$J,"PRT",SDRRCLIN,SDRRDDAYS),-1) Q:SDRRDDAYS=""  D  Q:SDRRABORT
"RTN","SDRRISRD",86,0)
 . . F  S SDRRPAT=$O(^TMP("SDRR",$J,"PRT",SDRRCLIN,SDRRDDAYS,SDRRPAT)) Q:SDRRPAT=""  S SDRRREC=^(SDRRPAT) D  Q:SDRRABORT
"RTN","SDRRISRD",87,0)
 . . . S SDRRCNT=SDRRCNT+1
"RTN","SDRRISRD",88,0)
 . . . S SDRRSSN=$E(SDRRREC,1,4)
"RTN","SDRRISRD",89,0)
 . . . S SDRRPH=$P(SDRRREC,U,2)
"RTN","SDRRISRD",90,0)
 . . . S SDRRPW=$P(SDRRREC,U,3)
"RTN","SDRRISRD",91,0)
 . . . S SDRRDT=$P(SDRRREC,U,4)
"RTN","SDRRISRD",92,0)
 . . . S SDRRRP=$P(SDRRREC,U,5)
"RTN","SDRRISRD",93,0)
 . . . S SDRRSDT=$P(SDRRREC,U,6)
"RTN","SDRRISRD",94,0)
 . . . I $Y+2+SDRRIA>IOSL D  Q:SDRRABORT
"RTN","SDRRISRD",95,0)
 . . . . I SDRRIA D PAGE^XMXUTIL(.SDRRABORT) Q:SDRRABORT
"RTN","SDRRISRD",96,0)
 . . . . W @IOF D HEADER
"RTN","SDRRISRD",97,0)
 . . . W !,$E($P(SDRRPAT,U),1,14),?15,SDRRSSN,?20,$E(SDRRPH,1,18),?38,$E(SDRRPW,1,20),?58,$$FMTE^XLFDT(SDRRDT,"2Z"),?66,$J(SDRRDDAYS,4),?71,SDRRRP_$$FMTE^XLFDT(SDRRSDT,"2Z")
"RTN","SDRRISRD",98,0)
 . Q:SDRRABORT
"RTN","SDRRISRD",99,0)
 . D SUBTOT
"RTN","SDRRISRD",100,0)
 Q:SDRRABORT
"RTN","SDRRISRD",101,0)
 I SDRRIA D WAIT^XMXUTIL
"RTN","SDRRISRD",102,0)
 Q
"RTN","SDRRISRD",103,0)
HEADER ;
"RTN","SDRRISRD",104,0)
 S SDRRPAGE=SDRRPAGE+1
"RTN","SDRRISRD",105,0)
 W SDRRDR,$J(SDRRPAGE,3)
"RTN","SDRRISRD",106,0)
 W !!,?71,"Reminder"
"RTN","SDRRISRD",107,0)
 W !,"Patient",?15,"SSN",?20,"Home Phone",?38,"Work Phone",?58,"Recall",?66,"Days",?71,"Sent"
"RTN","SDRRISRD",108,0)
 Q
"RTN","SDRRISRD",109,0)
SUBTOT ;
"RTN","SDRRISRD",110,0)
 I $Y+3+SDRRIA>IOSL D  Q:SDRRABORT
"RTN","SDRRISRD",111,0)
 . I SDRRIA D PAGE^XMXUTIL(.SDRRABORT) Q:SDRRABORT
"RTN","SDRRISRD",112,0)
 . W @IOF D HEADER
"RTN","SDRRISRD",113,0)
 W !!,"Delinquent Patient Recalls: ",SDRRCNT
"RTN","SDRRISRD",114,0)
 Q
"RTN","SDRRISRL")
0^13^B31811224
"RTN","SDRRISRL",1,0)
SDRRISRL ;10N20/MAH;Recall Reminder Open Slots Report;01/18/2008
"RTN","SDRRISRL",2,0)
 ;;5.3;Scheduling;**536**;Aug 13, 1993;Build 53
"RTN","SDRRISRL",3,0)
 ; Option: SDRR RECALL LIST
"RTN","SDRRISRL",4,0)
EN ;
"RTN","SDRRISRL",5,0)
 N SDRRST,SDRRND,SDRRSTX,SDRRNDX,SDRRBRK,SDRRABORT,DIRUT,I,ZTSAVE,XMDUZ,XMSUB,ZTQUEUED,ZTSK
"RTN","SDRRISRL",6,0)
 N SDRRDIV,ZTDESC
"RTN","SDRRISRL",7,0)
 S SDRRABORT=0
"RTN","SDRRISRL",8,0)
 W !!,"Select a time period and a set of clinics, and I'll tell you all the"
"RTN","SDRRISRL",9,0)
 W !,"patients who are on the Recall List for that time period at those clinics."
"RTN","SDRRISRL",10,0)
 W !,"For each month, I'll also tell you how many slots are available in each clinic.",!
"RTN","SDRRISRL",11,0)
 W !,"First select the Recall Date range."
"RTN","SDRRISRL",12,0)
 S SDRRST=$E(DT,1,5)_"01" ; 1st of this month
"RTN","SDRRISRL",13,0)
 I $E(DT,4,5)>27 S SDRRST=$E($$FMADD^XLFDT(SDRRST,31),1,5)_"01" ; 1st of next month
"RTN","SDRRISRL",14,0)
 S SDRRND=$E($$SCH^XLFDT("3M",SDRRST),1,7) ; 3 months later
"RTN","SDRRISRL",15,0)
 D DRANGE^SDRRUTL(.SDRRST,.SDRRND,.SDRRSTX,.SDRRNDX,.SDRRABORT,SDRRST,$$FMADD^XLFDT(DT,366),1) Q:SDRRABORT
"RTN","SDRRISRL",16,0)
 K ^TMP("SDRR",$J)
"RTN","SDRRISRL",17,0)
 D ASKDIV^SDRRPXC(.SDRRDIV) Q:'SDRRDIV
"RTN","SDRRISRL",18,0)
 D ASKCLIN^SDRRPXC(.SDRRDIV,SDRRST,SDRRND) Q:'$D(^TMP("SDRR",$J))
"RTN","SDRRISRL",19,0)
 W !
"RTN","SDRRISRL",20,0)
 N DIR,X,Y
"RTN","SDRRISRL",21,0)
 S DIR(0)="Y"
"RTN","SDRRISRL",22,0)
 S DIR("A")="Page break on clinic"
"RTN","SDRRISRL",23,0)
 S DIR("B")="Yes"
"RTN","SDRRISRL",24,0)
 D ^DIR Q:$D(DIRUT)
"RTN","SDRRISRL",25,0)
 S SDRRBRK=Y ; Page break on Clinic
"RTN","SDRRISRL",26,0)
 S XMSUB="Future Recall Slots, "_$S(SDRRST=SDRRND:SDRRSTX,1:SDRRSTX_"-"_SDRRNDX)
"RTN","SDRRISRL",27,0)
 F I="SDRRDIV","SDRRDIV(","SDRRST","SDRRSTX","SDRRND","SDRRNDX","SDRRBRK","^TMP(""SDRR"",$J," S ZTSAVE(I)=""
"RTN","SDRRISRL",28,0)
 D EN^XUTMDEVQ("CONTROL^SDRRISRL",XMSUB,.ZTSAVE,,1)
"RTN","SDRRISRL",29,0)
 I '$D(ZTQUEUED),$D(ZTSK) W !,"Request queued.  (Task: ",ZTSK,")"
"RTN","SDRRISRL",30,0)
 Q
"RTN","SDRRISRL",31,0)
CONTROL ;
"RTN","SDRRISRL",32,0)
 N SDRRIA,SDRRCLIST
"RTN","SDRRISRL",33,0)
 S SDRRIA=$E($G(IOST),1,2)="C-"
"RTN","SDRRISRL",34,0)
 D CLINLIST^SDRRISB(.SDRRCLIST)
"RTN","SDRRISRL",35,0)
 D GATHER
"RTN","SDRRISRL",36,0)
 D PRINT
"RTN","SDRRISRL",37,0)
 K ^TMP("SDRR",$J)
"RTN","SDRRISRL",38,0)
 Q
"RTN","SDRRISRL",39,0)
GATHER ; Gather Patient from Recall List
"RTN","SDRRISRL",40,0)
 N SDRRDT,SDRRIEN,SDRRDFN,SDRRREC,SDRRDFN0,SDRRCLIN,SDRRCLERK,SDRRSDT,SDRRPHONE,DFN,VA,VADM,VAPA,Z
"RTN","SDRRISRL",41,0)
 S SDRRND=SDRRND+.9999
"RTN","SDRRISRL",42,0)
 S SDRRDT=SDRRST-.1
"RTN","SDRRISRL",43,0)
 S SDRRIEN="" ; "D" xref is on the RECALL DATE field
"RTN","SDRRISRL",44,0)
 F  S SDRRDT=$O(^SD(403.5,"D",SDRRDT)) Q:SDRRDT>SDRRND!'SDRRDT  D
"RTN","SDRRISRL",45,0)
 . F  S SDRRIEN=$O(^SD(403.5,"D",SDRRDT,SDRRIEN)) Q:'SDRRIEN  D
"RTN","SDRRISRL",46,0)
 . . S SDRRREC=$G(^SD(403.5,SDRRIEN,0))
"RTN","SDRRISRL",47,0)
 . . S SDRRCLIN=+$P(SDRRREC,U,2)
"RTN","SDRRISRL",48,0)
 . . Q:'$D(SDRRCLIST(SDRRCLIN))  ; Must be clinic we want
"RTN","SDRRISRL",49,0)
 . . S SDRRDFN=+SDRRREC
"RTN","SDRRISRL",50,0)
 . . Q:$$TESTPAT^VADPT(SDRRDFN)  ; Test patient
"RTN","SDRRISRL",51,0)
 . . S SDRRSDT=$P(SDRRREC,U,10) ; Reminder sent date
"RTN","SDRRISRL",52,0)
 . . S SDRRCLERK=+$P(SDRRREC,U,11) ; Clerk who entered the recall
"RTN","SDRRISRL",53,0)
 . . S Z=$P(SDRRREC,U,13) I Z'="" S Z="*"
"RTN","SDRRISRL",54,0)
 . . S DFN=SDRRDFN
"RTN","SDRRISRL",55,0)
 . . D ADD^VADPT,DEM^VADPT
"RTN","SDRRISRL",56,0)
 . . S ^TMP("SDRR",$J,"PRT",SDRRCLIST(SDRRCLIN)_U_SDRRCLIN,SDRRDT,$P(VADM(1),U)_U_SDRRDFN)=$P(VA("BID"),U)_U_$P(VAPA(8),U)_U_SDRRCLERK_U_SDRRSDT_U_Z
"RTN","SDRRISRL",57,0)
 D KVAR^VADPT
"RTN","SDRRISRL",58,0)
 Q
"RTN","SDRRISRL",59,0)
PRINT ;
"RTN","SDRRISRL",60,0)
 N SDRRTODAY,SDRRCLIN,SDRRCLSAV,SDRRDT,SDRRDTSAV,SDRRREC,SDRRPAGE,SDRRABORT,SDRRDR,SDRRRP
"RTN","SDRRISRL",61,0)
 N SDRRCLERK,SDRRPAT,SDRRSSN,SDRRCNT,SDRRDTX,SDRRPHONE,SDRRSDT,SDRRMDT,SDRRMDTX
"RTN","SDRRISRL",62,0)
 N SDRRPROV
"RTN","SDRRISRL",63,0)
 S SDRRMDT=$$FMADD^XLFDT(DT,1) ; earliest date to look for slot availability
"RTN","SDRRISRL",64,0)
 S SDRRMDTX=$$FMTE^XLFDT(SDRRMDT,"2Z")
"RTN","SDRRISRL",65,0)
 S (SDRRABORT,SDRRPAGE,SDRRCNT)=0
"RTN","SDRRISRL",66,0)
 I SDRRIA W @IOF
"RTN","SDRRISRL",67,0)
 S SDRRTODAY=$$FMTE^XLFDT(DT)
"RTN","SDRRISRL",68,0)
 S SDRRDR=$$CJ^XLFSTR(ZTDESC,IOM-1)
"RTN","SDRRISRL",69,0)
 S $E(SDRRDR,1,$L(SDRRTODAY))=SDRRTODAY
"RTN","SDRRISRL",70,0)
 S SDRRDR=$E(SDRRDR,1,IOM-8)_"Page"
"RTN","SDRRISRL",71,0)
 D HEADER
"RTN","SDRRISRL",72,0)
 I '$D(^TMP("SDRR",$J,"PRT")) W !,"No Recalls found for this date range." Q
"RTN","SDRRISRL",73,0)
 S (SDRRCLIN,SDRRDT,SDRRPAT)=""
"RTN","SDRRISRL",74,0)
 S SDRRCLSAV=SDRRCLIN
"RTN","SDRRISRL",75,0)
 F  S SDRRCLIN=$O(^TMP("SDRR",$J,"PRT",SDRRCLIN)) Q:SDRRCLIN=""  D  Q:SDRRABORT
"RTN","SDRRISRL",76,0)
 . I SDRRCLSAV'="",SDRRBRK!($Y+5+SDRRIA>IOSL) D  Q:SDRRABORT
"RTN","SDRRISRL",77,0)
 . . I SDRRIA D PAGE^XMXUTIL(.SDRRABORT) Q:SDRRABORT
"RTN","SDRRISRL",78,0)
 . . W @IOF D HEADER
"RTN","SDRRISRL",79,0)
 . S SDRRCLSAV=SDRRCLIN
"RTN","SDRRISRL",80,0)
 . S SDRRPROV=$$PRDEF^SDCO31($P(SDRRCLIN,U,2))
"RTN","SDRRISRL",81,0)
 . I SDRRPROV="" S SDRRPROV="(No Default Provider)"
"RTN","SDRRISRL",82,0)
 . W !!,$$CJ^XLFSTR(" "_$P(SDRRCLIN,U)_"    "_SDRRPROV_" ",79,"-")
"RTN","SDRRISRL",83,0)
 . S SDRRDTSAV=SDRRDT
"RTN","SDRRISRL",84,0)
 . F  S SDRRDT=$O(^TMP("SDRR",$J,"PRT",SDRRCLIN,SDRRDT)) Q:'SDRRDT  D  Q:SDRRABORT
"RTN","SDRRISRL",85,0)
 . . S SDRRDTX=$$FMTE^XLFDT(SDRRDT,"2Z")
"RTN","SDRRISRL",86,0)
 . . I SDRRDTSAV'=$E(SDRRDT,1,5) D  Q:SDRRABORT
"RTN","SDRRISRL",87,0)
 . . . I SDRRDTSAV D SUBTOT
"RTN","SDRRISRL",88,0)
 . . . S SDRRCNT=0
"RTN","SDRRISRL",89,0)
 . . . S SDRRDTSAV=$E(SDRRDT,1,5)
"RTN","SDRRISRL",90,0)
 . . . I $Y+2+SDRRIA>IOSL D  Q:SDRRABORT
"RTN","SDRRISRL",91,0)
 . . . . I SDRRIA D PAGE^XMXUTIL(.SDRRABORT) Q:SDRRABORT
"RTN","SDRRISRL",92,0)
 . . . . W @IOF D HEADER
"RTN","SDRRISRL",93,0)
 . . . W !
"RTN","SDRRISRL",94,0)
 . . F  S SDRRPAT=$O(^TMP("SDRR",$J,"PRT",SDRRCLIN,SDRRDT,SDRRPAT)) Q:SDRRPAT=""  S SDRRREC=^(SDRRPAT) D  Q:SDRRABORT
"RTN","SDRRISRL",95,0)
 . . . S SDRRCNT=SDRRCNT+1
"RTN","SDRRISRL",96,0)
 . . . S SDRRSSN=$E(SDRRREC,1,4)
"RTN","SDRRISRL",97,0)
 . . . S SDRRPHONE=$P(SDRRREC,U,2)
"RTN","SDRRISRL",98,0)
 . . . S SDRRCLERK=$P(SDRRREC,U,3) S SDRRCLERK=$$NAME^XUSER(SDRRCLERK,"F")
"RTN","SDRRISRL",99,0)
 . . . S SDRRSDT=$P(SDRRREC,U,4)
"RTN","SDRRISRL",100,0)
 . . . S SDRRRP=$P(SDRRREC,U,5)
"RTN","SDRRISRL",101,0)
 . . . I $Y+2+SDRRIA>IOSL D  Q:SDRRABORT
"RTN","SDRRISRL",102,0)
 . . . . I SDRRIA D PAGE^XMXUTIL(.SDRRABORT) Q:SDRRABORT
"RTN","SDRRISRL",103,0)
 . . . . W @IOF D HEADER
"RTN","SDRRISRL",104,0)
 . . . W !,SDRRDTX,?10,SDRRRP_$$FMTE^XLFDT(SDRRSDT,"2Z"),?20,$E($P(SDRRPAT,U),1,17),?38,SDRRSSN,?43,SDRRPHONE,?64,$E(SDRRCLERK,1,15)
"RTN","SDRRISRL",105,0)
 . Q:SDRRABORT
"RTN","SDRRISRL",106,0)
 . D SUBTOT
"RTN","SDRRISRL",107,0)
 Q:SDRRABORT
"RTN","SDRRISRL",108,0)
 I SDRRIA D WAIT^XMXUTIL
"RTN","SDRRISRL",109,0)
 Q
"RTN","SDRRISRL",110,0)
HEADER ;
"RTN","SDRRISRL",111,0)
 S SDRRPAGE=SDRRPAGE+1
"RTN","SDRRISRL",112,0)
 W SDRRDR,$J(SDRRPAGE,3)
"RTN","SDRRISRL",113,0)
 W !!,?10,"Reminder",?64,"Recall"
"RTN","SDRRISRL",114,0)
 W !,"Recall",?10,"Sent",?20,"Patient",?38,"SSN",?43,"Home Phone",?64,"Entered by"
"RTN","SDRRISRL",115,0)
 Q
"RTN","SDRRISRL",116,0)
SUBTOT ;
"RTN","SDRRISRL",117,0)
 I $Y+3+SDRRIA>IOSL D  Q:SDRRABORT
"RTN","SDRRISRL",118,0)
 . I SDRRIA D PAGE^XMXUTIL(.SDRRABORT) Q:SDRRABORT
"RTN","SDRRISRL",119,0)
 . W @IOF D HEADER
"RTN","SDRRISRL",120,0)
 W !!,$$FMTE^XLFDT(SDRRDTSAV_"00",1)," Patient Recalls: ",SDRRCNT,", Available Slots: ",$$OPENSLOT^SDRRISRU($P(SDRRCLIN,U,2),$S(SDRRDTSAV=$E(SDRRMDT,1,5):SDRRMDT,1:SDRRDTSAV_"01"))
"RTN","SDRRISRL",121,0)
 I SDRRDTSAV=$E(SDRRMDT,1,5) W " (",SDRRMDTX," through EOM)"
"RTN","SDRRISRL",122,0)
 Q
"RTN","SDRRISRU")
0^14^B13362967
"RTN","SDRRISRU",1,0)
SDRRISRU ;10N20/MAH;Recall Reminder Utilities ;01/18/2008  11:32
"RTN","SDRRISRU",2,0)
 ;;5.3;Scheduling;**536**;Aug 13, 1993;Build 53
"RTN","SDRRISRU",3,0)
OPENSLOT(SDRRIEN,SDRRST,SDRRND) ; Function returns the number of open (available)
"RTN","SDRRISRU",4,0)
 ; slots at the clinic during the time period.
"RTN","SDRRISRU",5,0)
 ; SDRRIEN - IEN of clinic in file #44
"RTN","SDRRISRU",6,0)
 ; SDRRST  - (optional) start checking on this date (default=today)
"RTN","SDRRISRU",7,0)
 ; SDRRND  - (optional) end of time period (default=last day of month)
"RTN","SDRRISRU",8,0)
 N SDRRNOAV,SDRRTOT,SDRRHOL,SDRRT,SDRRTPT,SDRRTPDT,SDRRDT,SDRRDA
"RTN","SDRRISRU",9,0)
 N SDRRFTR,CK,CLIN1,DA,DFN
"RTN","SDRRISRU",10,0)
 I '$D(SDRRST) S SDRRST=DT
"RTN","SDRRISRU",11,0)
 I '$D(SDRRND) D  ; end of month
"RTN","SDRRISRU",12,0)
 . S SDRRND=$E($$SCH^XLFDT("1M(L)",SDRRST),1,7)
"RTN","SDRRISRU",13,0)
 . S SDRRND=$$FMADD^XLFDT(SDRRND,1)
"RTN","SDRRISRU",14,0)
 . Q:$E(SDRRST,1,5)=$E(SDRRND,1,5)
"RTN","SDRRISRU",15,0)
 . S SDRRND=$$FMADD^XLFDT($E(SDRRND,1,5)_"01",-1)
"RTN","SDRRISRU",16,0)
 S SDRRST=$$FMADD^XLFDT(SDRRST,-1)
"RTN","SDRRISRU",17,0)
 S SDRRNOAV=0
"RTN","SDRRISRU",18,0)
 I '$O(^SC(SDRRIEN,"OST",SDRRST)),'$O(^SC(SDRRIEN,"ST",SDRRST,0)) D
"RTN","SDRRISRU",19,0)
 . N SDRRI,SDRRDOW
"RTN","SDRRISRU",20,0)
 . F SDRRI=0:1:6 S SDRRDOW=$O(^SC(SDRRIEN,"T"_SDRRI,SDRRST)) Q:SDRRDOW  S:SDRRDOW SDRRNOAV=1
"RTN","SDRRISRU",21,0)
 I SDRRNOAV Q 0  ; No future dates available
"RTN","SDRRISRU",22,0)
 I '$D(SDRRYEAR) N SDRRYEAR D YEAR
"RTN","SDRRISRU",23,0)
 S SDRRHOL=($P($G(^SC(SDRRIEN,"SL")),U,8)="Y")
"RTN","SDRRISRU",24,0)
 S SDRRTOT=0,SDRRDT=SDRRST
"RTN","SDRRISRU",25,0)
 F  S SDRRDT=$O(SDRRYEAR(SDRRDT)) Q:SDRRDT>SDRRND!'SDRRDT  D
"RTN","SDRRISRU",26,0)
 . I 'SDRRHOL,$P(SDRRYEAR(SDRRDT),U,2) Q
"RTN","SDRRISRU",27,0)
 . S SDRRTPDT=$G(^SC(SDRRIEN,"ST",SDRRDT,1)) ; Pattern
"RTN","SDRRISRU",28,0)
 . I SDRRTPDT="" D  Q:SDRRTPDT=""
"RTN","SDRRISRU",29,0)
 . . S SDRRT="T"_+SDRRYEAR(SDRRDT)
"RTN","SDRRISRU",30,0)
 . . S SDRRTPT=$O(^SC(SDRRIEN,SDRRT,SDRRDT)) Q:SDRRTPT=""
"RTN","SDRRISRU",31,0)
 . . S SDRRTPDT=$G(^SC(SDRRIEN,SDRRT,SDRRTPT,1))
"RTN","SDRRISRU",32,0)
 . S SDRRTOT=SDRRTOT+$$AVAIL(SDRRTPDT)
"RTN","SDRRISRU",33,0)
 Q SDRRTOT
"RTN","SDRRISRU",34,0)
AVAIL(SDRRPAT) ; Given pattern, returns number of available slots.
"RTN","SDRRISRU",35,0)
 ; Check the pattern for available slots
"RTN","SDRRISRU",36,0)
 ; 0-9 and j-z = available slots where j=10, k=11...z=26
"RTN","SDRRISRU",37,0)
 ; $A(1)=49 $A(9)=57 $A("j")=106 $A("z")=122
"RTN","SDRRISRU",38,0)
 N SDRRCNT,SDRRCHAR,I
"RTN","SDRRISRU",39,0)
 S SDRRCNT=0
"RTN","SDRRISRU",40,0)
 S SDRRPAT=$TR($E(SDRRPAT,6,$L(SDRRPAT)),"|[] ","")
"RTN","SDRRISRU",41,0)
 F I=1:1:$L(SDRRPAT) S SDRRCHAR=$A(SDRRPAT,I) D
"RTN","SDRRISRU",42,0)
 . I SDRRCHAR>48,SDRRCHAR<58 S SDRRCNT=SDRRCNT+$C(SDRRCHAR) Q
"RTN","SDRRISRU",43,0)
 . I SDRRCHAR>105,SDRRCHAR<123 S SDRRCNT=SDRRCNT+SDRRCHAR-96
"RTN","SDRRISRU",44,0)
 Q SDRRCNT
"RTN","SDRRISRU",45,0)
YEAR ; Set-up 1 year dates
"RTN","SDRRISRU",46,0)
 ; This array is used for available appointments
"RTN","SDRRISRU",47,0)
 N SDRRI,SDRRDT
"RTN","SDRRISRU",48,0)
 S SDRRDT=SDRRST
"RTN","SDRRISRU",49,0)
 F SDRRI=1:1:365 D  Q:SDRRDT=SDRRND
"RTN","SDRRISRU",50,0)
 . S SDRRDT=$$FMADD^XLFDT(SDRRDT,1)
"RTN","SDRRISRU",51,0)
 . S SDRRYEAR(SDRRDT)=$$DOW^XLFDT(SDRRDT,1)
"RTN","SDRRISRU",52,0)
 . I $D(^HOLIDAY(SDRRDT)) S $P(SDRRYEAR(SDRRDT),U,2)=1
"RTN","SDRRISRU",53,0)
 Q
"RTN","SDRRISRU",54,0)
DELETE ; This entry point is invoked by the new style xref A66201 on the .01 field of file 403.5
"RTN","SDRRISRU",55,0)
 I $D(SDRRDA),$D(APPT),$D(CLIN1) D  Q
"RTN","SDRRISRU",56,0)
 .D DELAPPT(SDRRDA,APPT,CLIN1)
"RTN","SDRRISRU",57,0)
 D DELUSER(DA)
"RTN","SDRRISRU",58,0)
 Q
"RTN","SDRRISRU",59,0)
DELAPPT(SDRRIEN,APPT,CLIN1) ; Record deleted from Recall List because of appointment.
"RTN","SDRRISRU",60,0)
 N SDRRFDA
"RTN","SDRRISRU",61,0)
 S SDRRFDA(403.56,"+1,",101)=APPT ; appt date
"RTN","SDRRISRU",62,0)
 S SDRRFDA(403.56,"+1,",102)=CLIN1 ; appt clinic
"RTN","SDRRISRU",63,0)
 D DELSET(SDRRIEN,.SDRRFDA)
"RTN","SDRRISRU",64,0)
 Q
"RTN","SDRRISRU",65,0)
DELUSER(SDRRIEN) ; Record deleted by a user.
"RTN","SDRRISRU",66,0)
 N SDRRFDA
"RTN","SDRRISRU",67,0)
 S SDRRFDA(403.56,"+1,",201)=$E($$NOW^XLFDT(),1,12) ; delete date
"RTN","SDRRISRU",68,0)
 S SDRRFDA(403.56,"+1,",202)=DUZ ; delete clerk
"RTN","SDRRISRU",69,0)
 S:$G(SDRRFTR) SDRRFDA(403.56,"+1,",203)=SDRRFTR ; delete reason: 
"RTN","SDRRISRU",70,0)
 D DELSET(SDRRIEN,.SDRRFDA)
"RTN","SDRRISRU",71,0)
 Q
"RTN","SDRRISRU",72,0)
DELSET(SDRRIEN,SDRRFDA) ;
"RTN","SDRRISRU",73,0)
 N SDRRREC
"RTN","SDRRISRU",74,0)
 S SDRRREC=$G(^SD(403.5,SDRRIEN,0))
"RTN","SDRRISRU",75,0)
 S SDRRFDA(403.56,"+1,",.01)=$P(SDRRREC,U,1) ; patient
"RTN","SDRRISRU",76,0)
 S SDRRFDA(403.56,"+1,",2)=$P(SDRRREC,U,3)   ; accession #
"RTN","SDRRISRU",77,0)
 S SDRRFDA(403.56,"+1,",2.5)=$P(SDRRREC,U,7) ; comment
"RTN","SDRRISRU",78,0)
 S SDRRFDA(403.56,"+1,",2.6)=$P(SDRRREC,U,8) ; fast / non-fast
"RTN","SDRRISRU",79,0)
 S SDRRFDA(403.56,"+1,",3)=$P(SDRRREC,U,4)   ; test/app.
"RTN","SDRRISRU",80,0)
 S SDRRFDA(403.56,"+1,",4)=$P(SDRRREC,U,5)   ; provider
"RTN","SDRRISRU",81,0)
 S SDRRFDA(403.56,"+1,",4.5)=$P(SDRRREC,U,2) ; clinic
"RTN","SDRRISRU",82,0)
 S SDRRFDA(403.56,"+1,",4.7)=$P(SDRRREC,U,9) ; length of appt.
"RTN","SDRRISRU",83,0)
 S SDRRFDA(403.56,"+1,",5)=$P(SDRRREC,U,6)   ; recall date
"RTN","SDRRISRU",84,0)
 S SDRRFDA(403.56,"+1,",6)=$P(SDRRREC,U,10)  ; date reminder sent
"RTN","SDRRISRU",85,0)
 S SDRRFDA(403.56,"+1,",7)=$P(SDRRREC,U,11)  ; user who entered recall
"RTN","SDRRISRU",86,0)
 D UPDATE^DIE("","SDRRFDA")
"RTN","SDRRISRU",87,0)
 Q
"RTN","SDRRISRX")
0^15^B30760645
"RTN","SDRRISRX",1,0)
SDRRISRX ;10N20/MAH;-Recall List Clerk Deletions;01/18/2008  11:32
"RTN","SDRRISRX",2,0)
 ;;5.3;Scheduling;**536**;Aug 13, 1993;Build 53
"RTN","SDRRISRX",3,0)
 ; Option: SDRR RECALL DELETIONS
"RTN","SDRRISRX",4,0)
EN ;
"RTN","SDRRISRX",5,0)
 N SDRRST,SDRRND,SDRRSTX,SDRRNDX,SDRRBRK,SDRRABORT,I,ZTSAVE,XMDUZ,XMSUB,ZTSK,VA,VADM,VAPA
"RTN","SDRRISRX",6,0)
 N SDRRDIV,SDRRDAYS,DIR,X,Y,Z,DIRUT,ZTQUEUED,ZTDESC,DFN
"RTN","SDRRISRX",7,0)
 I '$D(^SD(403.56,"C")) W !!,"***No Entries Have Been Deleted***" Q
"RTN","SDRRISRX",8,0)
 S SDRRABORT=0
"RTN","SDRRISRX",9,0)
 W !!,"Select a time period and a set of clinics, and I'll tell you all the patients"
"RTN","SDRRISRX",10,0)
 W !,"who were on the Recall List, but were deleted from the list by clerks."
"RTN","SDRRISRX",11,0)
 W !!,"First select the Recall Date range. The default dates are determined by the"
"RTN","SDRRISRX",12,0)
 W !,"entries in Recall Reminders Removed File."
"RTN","SDRRISRX",13,0)
 S SDRRST=$O(^SD(403.56,"C",""))
"RTN","SDRRISRX",14,0)
 S SDRRND=$O(^SD(403.56,"C",""),-1)
"RTN","SDRRISRX",15,0)
 D DRANGE^SDRRUTL(.SDRRST,.SDRRND,.SDRRSTX,.SDRRNDX,.SDRRABORT,SDRRST,SDRRND) Q:SDRRABORT
"RTN","SDRRISRX",16,0)
 K ^TMP("SDRR",$J)
"RTN","SDRRISRX",17,0)
 D ASKDIV^SDRRPXC(.SDRRDIV) Q:'SDRRDIV
"RTN","SDRRISRX",18,0)
 D ASKCLIN^SDRRPXC(.SDRRDIV,SDRRST,SDRRND) Q:'$D(^TMP("SDRR",$J))
"RTN","SDRRISRX",19,0)
 W !
"RTN","SDRRISRX",20,0)
 K DIR,X,Y
"RTN","SDRRISRX",21,0)
 S DIR(0)="Y"
"RTN","SDRRISRX",22,0)
 S DIR("A")="Page break on clinic"
"RTN","SDRRISRX",23,0)
 S DIR("B")="Yes"
"RTN","SDRRISRX",24,0)
 D ^DIR Q:$D(DIRUT)
"RTN","SDRRISRX",25,0)
 S SDRRBRK=Y ; Page break on Clinic
"RTN","SDRRISRX",26,0)
 S XMSUB="Recall List Clerk Deletions, "_$S(SDRRST=SDRRND:SDRRSTX,1:SDRRSTX_"-"_SDRRNDX)
"RTN","SDRRISRX",27,0)
 F I="SDRRDIV","SDRRDIV(","SDRRST","SDRRSTX","SDRRND","SDRRNDX","SDRRBRK","SDRRDAYS","^TMP(""SDRR"",$J," S ZTSAVE(I)=""
"RTN","SDRRISRX",28,0)
 D EN^XUTMDEVQ("CONTROL^SDRRISRX",XMSUB,.ZTSAVE,,1)
"RTN","SDRRISRX",29,0)
 I '$D(ZTQUEUED),$D(ZTSK) W !,"Request queued.  (Task: ",ZTSK,")"
"RTN","SDRRISRX",30,0)
 Q
"RTN","SDRRISRX",31,0)
CONTROL ;
"RTN","SDRRISRX",32,0)
 N SDRRIA,SDRRCLIST
"RTN","SDRRISRX",33,0)
 S SDRRIA=$E($G(IOST),1,2)="C-"
"RTN","SDRRISRX",34,0)
 D CLINLIST^SDRRISB(.SDRRCLIST)
"RTN","SDRRISRX",35,0)
 D GATHER
"RTN","SDRRISRX",36,0)
 D PRINT
"RTN","SDRRISRX",37,0)
 K ^TMP("SDRR",$J)
"RTN","SDRRISRX",38,0)
 D KVAR^VADPT
"RTN","SDRRISRX",39,0)
 Q
"RTN","SDRRISRX",40,0)
GATHER ; Gather Patient from Recall Deletions List
"RTN","SDRRISRX",41,0)
 N SDRRDT,SDRRIEN,SDRRDFN,SDRRREC,SDRRDFN0,SDRRCLIN,SDRRSDT,SDRRDDT,SDRRREC2,SDRRCLERK,SDRRREASN
"RTN","SDRRISRX",42,0)
 S SDRRND=SDRRND+.9999
"RTN","SDRRISRX",43,0)
 S (SDRRCLIN,SDRRIEN)="" ; "D" xref is on Clinic and Recall Date
"RTN","SDRRISRX",44,0)
 F  S SDRRCLIN=$O(SDRRCLIST(SDRRCLIN)) Q:'SDRRCLIN  D
"RTN","SDRRISRX",45,0)
 . Q:'$D(^SD(403.56,"D",SDRRCLIN))
"RTN","SDRRISRX",46,0)
 . S SDRRDT=SDRRST-.1
"RTN","SDRRISRX",47,0)
 . F  S SDRRDT=$O(^SD(403.56,"D",SDRRCLIN,SDRRDT)) Q:SDRRDT>SDRRND!'SDRRDT  D
"RTN","SDRRISRX",48,0)
 . . F  S SDRRIEN=$O(^SD(403.56,"D",SDRRCLIN,SDRRDT,SDRRIEN)) Q:'SDRRIEN  D
"RTN","SDRRISRX",49,0)
 . . . S SDRRREC2=$G(^SD(403.56,SDRRIEN,2))
"RTN","SDRRISRX",50,0)
 . . . S SDRRDDT=+SDRRREC2 ; Deletion date
"RTN","SDRRISRX",51,0)
 . . . Q:'SDRRDDT  ; got appt.?
"RTN","SDRRISRX",52,0)
 . . . S SDRRCLERK=$P(SDRRREC2,U,2)
"RTN","SDRRISRX",53,0)
 . . . S SDRRREASN=$P(SDRRREC2,U,3)
"RTN","SDRRISRX",54,0)
 . . . S SDRRREC=$G(^SD(403.56,SDRRIEN,0))
"RTN","SDRRISRX",55,0)
 . . . S SDRRDFN=+SDRRREC
"RTN","SDRRISRX",56,0)
 . . . Q:$$TESTPAT^VADPT(SDRRDFN)  ; Test patient
"RTN","SDRRISRX",57,0)
 . . . S DFN=SDRRDFN
"RTN","SDRRISRX",58,0)
 . . .D ADD^VADPT,DEM^VADPT
"RTN","SDRRISRX",59,0)
 . . . S SDRRSDT=$P(SDRRREC,U,10) ; Reminder sent date
"RTN","SDRRISRX",60,0)
 . . . S Z=$P(SDRRREC,U,13) I Z'="" S Z="*"
"RTN","SDRRISRX",61,0)
 . . . S ^TMP("SDRR",$J,"PRT",SDRRCLIST(SDRRCLIN)_U_SDRRCLIN,$P(VADM(1),U)_U_SDRRDFN,SDRRDT)=$P(VA("BID"),U)_U_SDRRSDT_U_Z_U_SDRRDDT_U_SDRRCLERK_U_SDRRREASN
"RTN","SDRRISRX",62,0)
 Q
"RTN","SDRRISRX",63,0)
PRINT ;
"RTN","SDRRISRX",64,0)
 N SDRRTODAY,SDRRCLIN,SDRRCLSAV,SDRRDT,SDRRREC,SDRRPAGE,SDRRABORT,SDRRDR,SDRRRP
"RTN","SDRRISRX",65,0)
 N SDRRPAT,SDRRSSN,SDRRCNT,SDRRDTX,SDRRSDT,SDRRPROV,SDRRDFN,SDRRDDT,SDRRREASN
"RTN","SDRRISRX",66,0)
 S (SDRRABORT,SDRRPAGE)=0
"RTN","SDRRISRX",67,0)
 I SDRRIA W @IOF
"RTN","SDRRISRX",68,0)
 S SDRRTODAY=$$FMTE^XLFDT(DT)
"RTN","SDRRISRX",69,0)
 S SDRRDR=$$CJ^XLFSTR(ZTDESC,IOM-1)
"RTN","SDRRISRX",70,0)
 S $E(SDRRDR,1,$L(SDRRTODAY))=SDRRTODAY
"RTN","SDRRISRX",71,0)
 S SDRRDR=$E(SDRRDR,1,IOM-8)_"Page"
"RTN","SDRRISRX",72,0)
 D HEADER
"RTN","SDRRISRX",73,0)
 I '$D(^TMP("SDRR",$J,"PRT")) W !,"No Recall List deletions found for this date range." Q
"RTN","SDRRISRX",74,0)
 S (SDRRCLIN,SDRRPAT,SDRRDT)=""
"RTN","SDRRISRX",75,0)
 S SDRRCLSAV=SDRRCLIN
"RTN","SDRRISRX",76,0)
 F  S SDRRCLIN=$O(^TMP("SDRR",$J,"PRT",SDRRCLIN)) Q:SDRRCLIN=""  D  Q:SDRRABORT
"RTN","SDRRISRX",77,0)
 . I SDRRCLSAV'="",SDRRBRK!($Y+5+SDRRIA>IOSL) D  Q:SDRRABORT
"RTN","SDRRISRX",78,0)
 . . I SDRRIA D PAGE^XMXUTIL(.SDRRABORT) Q:SDRRABORT
"RTN","SDRRISRX",79,0)
 . . W @IOF D HEADER
"RTN","SDRRISRX",80,0)
 . S SDRRCLSAV=SDRRCLIN
"RTN","SDRRISRX",81,0)
 . S SDRRPROV=$$PRDEF^SDCO31($P(SDRRCLIN,U,2))
"RTN","SDRRISRX",82,0)
 . I SDRRPROV="" S SDRRPROV="(No Default Provider)"
"RTN","SDRRISRX",83,0)
 . W !!,$$CJ^XLFSTR(" "_$P(SDRRCLIN,U)_"    "_SDRRPROV_" ",79,"-")
"RTN","SDRRISRX",84,0)
 . S SDRRCNT=0
"RTN","SDRRISRX",85,0)
 . F  S SDRRPAT=$O(^TMP("SDRR",$J,"PRT",SDRRCLIN,SDRRPAT)) Q:SDRRPAT=""  D  Q:SDRRABORT
"RTN","SDRRISRX",86,0)
 . . S SDRRDFN=$P(SDRRPAT,U,2)
"RTN","SDRRISRX",87,0)
 . . F  S SDRRDT=$O(^TMP("SDRR",$J,"PRT",SDRRCLIN,SDRRPAT,SDRRDT)) Q:'SDRRDT  S SDRRREC=^(SDRRDT) D  Q:SDRRABORT
"RTN","SDRRISRX",88,0)
 . . . S SDRRCNT=SDRRCNT+1
"RTN","SDRRISRX",89,0)
 . . . S SDRRSSN=$E(SDRRREC,1,4)
"RTN","SDRRISRX",90,0)
 . . . S SDRRSDT=$P(SDRRREC,U,2)
"RTN","SDRRISRX",91,0)
 . . . S SDRRRP=$P(SDRRREC,U,3)
"RTN","SDRRISRX",92,0)
 . . . S SDRRDDT=$P(SDRRREC,U,4)
"RTN","SDRRISRX",93,0)
 . . . S SDRRCLERK=$P(SDRRREC,U,5) S SDRRCLERK=$$NAME^XUSER(SDRRCLERK,"F")
"RTN","SDRRISRX",94,0)
 . . . S SDRRREASN=$S($P(SDRRREC,U,6)=1:"FTR",$P(SDRRREC,U,6)=2:"MOVED",$P(SDRRREC,U,6)=3:"DECEASED",$P(SDRRREC,U,6)=4:"DNWC",$P(SDRRREC,U,6)=5:"RCOVA",$P(SDRRREC,U,6)=6:"OTHER",1:"")
"RTN","SDRRISRX",95,0)
 . . . I $Y+2+SDRRIA>IOSL D  Q:SDRRABORT
"RTN","SDRRISRX",96,0)
 . . . . I SDRRIA D PAGE^XMXUTIL(.SDRRABORT) Q:SDRRABORT
"RTN","SDRRISRX",97,0)
 . . . . W @IOF D HEADER
"RTN","SDRRISRX",98,0)
 . . . W !,$E($P(SDRRPAT,U),1,14),?15,SDRRSSN,?20,SDRRRP_$$FMTE^XLFDT($E(SDRRSDT,1,7),"2Z"),?29,$$FMTE^XLFDT($E(SDRRDT,1,7),"2Z"),?38,$$FMTE^XLFDT($E(SDRRDDT,1,7),"2Z"),?47,$E(SDRRCLERK,1,19),?67,SDRRREASN
"RTN","SDRRISRX",99,0)
 . Q:SDRRABORT
"RTN","SDRRISRX",100,0)
 . D SUBTOT
"RTN","SDRRISRX",101,0)
 Q:SDRRABORT
"RTN","SDRRISRX",102,0)
 I SDRRIA D WAIT^XMXUTIL
"RTN","SDRRISRX",103,0)
 Q
"RTN","SDRRISRX",104,0)
HEADER ;
"RTN","SDRRISRX",105,0)
 S SDRRPAGE=SDRRPAGE+1
"RTN","SDRRISRX",106,0)
 W SDRRDR,$J(SDRRPAGE,3)
"RTN","SDRRISRX",107,0)
 W !!,?20,"Reminder"
"RTN","SDRRISRX",108,0)
 W !,"Patient",?15,"SSN",?20,"Sent",?29,"Recall",?38,"Deleted",?47,"Deleted by",?67,"Reason"
"RTN","SDRRISRX",109,0)
 W !,"-------------- ---- -------- -------- -------- ------------------- ------"
"RTN","SDRRISRX",110,0)
 Q
"RTN","SDRRISRX",111,0)
SUBTOT ;
"RTN","SDRRISRX",112,0)
 I $Y+3+SDRRIA>IOSL D  Q:SDRRABORT
"RTN","SDRRISRX",113,0)
 . I SDRRIA D PAGE^XMXUTIL(.SDRRABORT) Q:SDRRABORT
"RTN","SDRRISRX",114,0)
 . W @IOF D HEADER
"RTN","SDRRISRX",115,0)
 W !!,"Patient Recall List Deletions: ",SDRRCNT
"RTN","SDRRISRX",116,0)
 Q
"RTN","SDRRLRP")
0^16^B1446323
"RTN","SDRRLRP",1,0)
SDRRLRP ;10N20/MAH ; Recall Reminder Manual Printing; 01/22/2008
"RTN","SDRRLRP",2,0)
 ;;5.3;Scheduling;**536**;Aug 13, 1993;Build 53
"RTN","SDRRLRP",3,0)
 ;;CHECK TO SEE HOW A SITE HAS BEEN SETUP FOR CLINIC RECALL
"RTN","SDRRLRP",4,0)
 ;;in the OUTPATIENT CLINIC RECALL PARAM FILE
"RTN","SDRRLRP",5,0)
 ;;if set to letters it will run SDRRRECL routine
"RTN","SDRRLRP",6,0)
 ;;if set to cards it will run SDRRRECP routine
"RTN","SDRRLRP",7,0)
STR N DIRUT,TYPE
"RTN","SDRRLRP",8,0)
 W ! S DIR("A")="What Clinic Recall Division will you be printing From ",DIR(0)="P^403.53:AEMQZ" D ^DIR Q:$D(DIRUT)  S IEN=+Y K Y,Q,DIR
"RTN","SDRRLRP",9,0)
 S TYPE=$P($G(^SD(403.53,IEN,0)),"^",2) I TYPE="" S TYPE="C" K IEN
"RTN","SDRRLRP",10,0)
 I TYPE["C" D ^SDRRRECP Q
"RTN","SDRRLRP",11,0)
 I TYPE["L" D ^SDRRRECL Q
"RTN","SDRRLRP",12,0)
 Q
"RTN","SDRROR")
0^20^B3486735
"RTN","SDRROR",1,0)
SDRROR ;10N20/MAH;Recall Reminder CPRS Display;01/15/2008
"RTN","SDRROR",2,0)
 ;;5.3;Scheduling;**536**;Aug 13, 1993;Build 53
"RTN","SDRROR",3,0)
 ;;This routine is called from ORWCV
"RTN","SDRROR",4,0)
 ;;and will be called if Outpatient Clinic param entry is either
"RTN","SDRROR",5,0)
 ;;null or cards
"RTN","SDRROR",6,0)
 ;VAR BEG,END,AND DFN WILL BE KILLED WITH OR ROUTINES
"RTN","SDRROR",7,0)
COVER   ; GET RECALL DATES FOR A PATIENT
"RTN","SDRROR",8,0)
 ;At ORWCV TAG VST+24 ADD D COVER^SDRROR
"RTN","SDRROR",9,0)
 Q:BEG<1!(END<1)
"RTN","SDRROR",10,0)
 F RCIFN=0:0 S RCIFN=$O(^SD(403.5,"B",DFN,RCIFN)) Q:RCIFN<1  D
"RTN","SDRROR",11,0)
 .S RCX=$G(^SD(403.5,RCIFN,0)) Q:RCX=""
"RTN","SDRROR",12,0)
 .S RCDT=$P(RCX,U,6) Q:RCDT<BEG  Q:RCDT>END
"RTN","SDRROR",13,0)
 .S RCTYPE=$P(RCX,U,4),RCCLIN=$P(RCX,U,2)
"RTN","SDRROR",14,0)
 .S:RCTYPE]"" RCTYPE=$P($G(^SD(403.51,RCTYPE,0)),U,2)
"RTN","SDRROR",15,0)
 .S:RCCLIN]"" RCCLIN=$$GET1^DIQ(44,RCCLIN_",",.01)
"RTN","SDRROR",16,0)
 .S DATE1=RCDT S:$D(^TMP("ORVSTLIST",$J,RCDT)) DATE1=RCDT+.0001
"RTN","SDRROR",17,0)
 .S RCNODE="RECALL ("_RCTYPE_") "_RCCLIN,RCNODE=$E(RCNODE,1,25)
"RTN","SDRROR",18,0)
 .S ^TMP("ORVSTLIST",$J,DATE1,"R",1)="R;"_RCDT_";"_RCIFN_U_RCDT_U_RCNODE
"RTN","SDRROR",19,0)
 K RCIFN,RCX,RCTYPE,RCCLIN,RCDT,RCNODE,DATE1
"RTN","SDRROR",20,0)
 Q
"RTN","SDRROR",21,0)
RCDTL ; RECALL DETAILS At ORWCV TAG DTLVST+18 ADD I $P(APPTINFO,";")="R" D RCDTL^SDRROR
"RTN","SDRROR",22,0)
 S RPT(1)="The patient will be sent a letter on this date reminding them to make an"
"RTN","SDRROR",23,0)
 S RPT(2)="appointment with the listed clinic."
"RTN","SDRROR",24,0)
 S RCIFN=$P(APPTINFO,";",3) Q:RCIFN=""
"RTN","SDRROR",25,0)
 S APPTINFO=$G(^SD(403.5,RCIFN,0)) Q:APPTINFO=""
"RTN","SDRROR",26,0)
 S COMM=$P(APPTINFO,U,7),FAST=$P(APPTINFO,U,8)
"RTN","SDRROR",27,0)
 S:FAST]"" FAST=$P($P(^DD(403.5,2.6,0),FAST_":",2),";")
"RTN","SDRROR",28,0)
 S RPT(3)="  "
"RTN","SDRROR",29,0)
 S:FAST]"" RPT(4)="Patient should be "_FAST
"RTN","SDRROR",30,0)
 S RPT($S(FAST]"":5,1:4))="Comment: "_COMM
"RTN","SDRROR",31,0)
 K RCIFN,COMM,FAST
"RTN","SDRROR",32,0)
 Q
"RTN","SDRRPXC")
0^22^B35140878
"RTN","SDRRPXC",1,0)
SDRRPXC ;;10N20/MAH;Recall Reminder Utilities ;01/18/2008  11:32
"RTN","SDRRPXC",2,0)
 ;;5.3;Scheduling;**536**;Aug 13, 1993;Build 53
"RTN","SDRRPXC",3,0)
  ;
"RTN","SDRRPXC",4,0)
STOPCODE(SDRRI) ; Return a clinic stop code
"RTN","SDRRPXC",5,0)
 Q $S('SDRRI:SDRRI,1:$P($G(^DIC(40.7,SDRRI,0)),U,2))
"RTN","SDRRPXC",6,0)
PERDIV(SDRRDIV) ;
"RTN","SDRRPXC",7,0)
 S I=0
"RTN","SDRRPXC",8,0)
 F  S I=$O(SDRRDIV(I)) Q:'I  S SDRRDIV(I)=$P($G(^DG(40.8,I,0),"Unknown Division"),U)
"RTN","SDRRPXC",9,0)
 Q
"RTN","SDRRPXC",10,0)
ASKDIV(SDRRDIV) ;
"RTN","SDRRPXC",11,0)
 N DIC,X,Y,I,DUOUT,DTOUT
"RTN","SDRRPXC",12,0)
 K SDRRDIV
"RTN","SDRRPXC",13,0)
 S SDRRDIV=0
"RTN","SDRRPXC",14,0)
 W !
"RTN","SDRRPXC",15,0)
 S DIC("A")="Select Medical Center Division: All// "
"RTN","SDRRPXC",16,0)
 S DIC="^DG(40.8,"
"RTN","SDRRPXC",17,0)
 S DIC(0)="AEQMN"
"RTN","SDRRPXC",18,0)
 F  D  Q:Y=-1
"RTN","SDRRPXC",19,0)
 . D ^DIC Q:Y=-1
"RTN","SDRRPXC",20,0)
 . S SDRRDIV(+Y)=$P(Y,U,2)
"RTN","SDRRPXC",21,0)
 . S DIC("A")="Another Medical Center Division: "
"RTN","SDRRPXC",22,0)
 Q:$D(DTOUT)!$D(DUOUT)
"RTN","SDRRPXC",23,0)
 S I=0
"RTN","SDRRPXC",24,0)
 I $O(SDRRDIV(0)) D  Q
"RTN","SDRRPXC",25,0)
 . F  S I=$O(SDRRDIV(I)) Q:'I  S SDRRDIV=SDRRDIV+1
"RTN","SDRRPXC",26,0)
 F  S I=$O(^DG(40.8,I)) Q:'I  S SDRRDIV(I)=$P(^(I,0),U),SDRRDIV=SDRRDIV+1
"RTN","SDRRPXC",27,0)
 Q
"RTN","SDRRPXC",28,0)
ASKCLIN(SDRRDIV,SDRRST,SDRRND) ;
"RTN","SDRRPXC",29,0)
 N DIR,X,Y,DIRUT,SDRRABORT
"RTN","SDRRPXC",30,0)
 W !!,"Now you'll select the clinics."
"RTN","SDRRPXC",31,0)
 S DIR(0)="SO^R:Range of Clinics;I:Individual Clinics;S:Stop Codes"
"RTN","SDRRPXC",32,0)
 S DIR("A")="Select Clinics by"
"RTN","SDRRPXC",33,0)
 S DIR("?",1)="Choose 'Range of Clinics' if you want to select a group of clinics in"
"RTN","SDRRPXC",34,0)
 S DIR("?",2)="consecutive name order.  You'll be asked for the starting clinic and the"
"RTN","SDRRPXC",35,0)
 S DIR("?",3)="ending clinic.  All the clinics in that range will be selected for you."
"RTN","SDRRPXC",36,0)
 S DIR("?",4)=""
"RTN","SDRRPXC",37,0)
 S DIR("?",5)="Choose 'Individual Clinics' if you want to select clinics individually."
"RTN","SDRRPXC",38,0)
 S DIR("?",6)="You'll be able to use ranges here, too, as well as wild cards.  You'll"
"RTN","SDRRPXC",39,0)
 S DIR("?",7)="even be able to de-select clinics."
"RTN","SDRRPXC",40,0)
 S DIR("?",8)=""
"RTN","SDRRPXC",41,0)
 S DIR("?",9)="Choose 'Stop Codes' if you want to select Stop Codes.  All clinics whose"
"RTN","SDRRPXC",42,0)
 S DIR("?",10)="Stop Codes or Credit Stops match the ones you've chosen will be selected"
"RTN","SDRRPXC",43,0)
 S DIR("?",11)="for you."
"RTN","SDRRPXC",44,0)
 D ^DIR I $D(DIRUT) S SDRRABORT=1 Q
"RTN","SDRRPXC",45,0)
 D @Y
"RTN","SDRRPXC",46,0)
 Q
"RTN","SDRRPXC",47,0)
I ; Select individual clinics
"RTN","SDRRPXC",48,0)
 N SDRRDIC,SDRRNAME,SDRRIEN,SDRRREC
"RTN","SDRRPXC",49,0)
 W !!,"You'll be able to use ranges and wild cards to select clinics."
"RTN","SDRRPXC",50,0)
 W !,"You'll even be able to deselect clinics."
"RTN","SDRRPXC",51,0)
 W !,"Enter '?' at the prompt to see how."
"RTN","SDRRPXC",52,0)
 S SDRRDIC=44
"RTN","SDRRPXC",53,0)
 S SDRRDIC(0)="AEMNQZ"
"RTN","SDRRPXC",54,0)
 S SDRRDIC("A")="Select Clinic: "
"RTN","SDRRPXC",55,0)
 S SDRRDIC("B")="All"
"RTN","SDRRPXC",56,0)
 S SDRRDIC("S")="I $$ACTIVE^SDRRPXC(+Y,.SDRRDIV,.SDRRST,.SDRRND,^(0))"
"RTN","SDRRPXC",57,0)
 I '$$EN^SDRRSLCT(.SDRRDIC,"SDRR") S SDRRABORT=1 Q
"RTN","SDRRPXC",58,0)
 S (SDRRNAME,SDRRIEN)=""
"RTN","SDRRPXC",59,0)
 F  S SDRRNAME=$O(^TMP($J,"SDRR",SDRRNAME)) Q:SDRRNAME=""  D
"RTN","SDRRPXC",60,0)
 . F  S SDRRIEN=$O(^TMP($J,"SDRR",SDRRNAME,SDRRIEN)) Q:SDRRIEN=""  D
"RTN","SDRRPXC",61,0)
 . . S SDRRREC=$G(^SC(SDRRIEN,0))
"RTN","SDRRPXC",62,0)
 . . S ^TMP("SDRR",$J,"DIV",$P(SDRRREC,U,15),"CLIN",$P(SDRRREC,U))=SDRRIEN_U_$$STOPCODE($P(SDRRREC,U,7))_U_$$STOPCODE($P(SDRRREC,U,18))
"RTN","SDRRPXC",63,0)
 K ^TMP($J,"SDRR")
"RTN","SDRRPXC",64,0)
 Q
"RTN","SDRRPXC",65,0)
R ; Select range of clinics
"RTN","SDRRPXC",66,0)
 N SDRRCLIN,SDRRIEN,SDRRREC,SDRRFROM,SDRRTHRU,SDRRI
"RTN","SDRRPXC",67,0)
 D ASKRANGE(.SDRRCLIN,.SDRRDIV,.SDRRST,.SDRRND)
"RTN","SDRRPXC",68,0)
 I 'SDRRCLIN S SDRRABORT=1 Q
"RTN","SDRRPXC",69,0)
 S SDRRI=0
"RTN","SDRRPXC",70,0)
 F  S SDRRI=$O(SDRRCLIN(SDRRI)) Q:'SDRRI  D
"RTN","SDRRPXC",71,0)
 . S SDRRFROM=$P($P(SDRRCLIN(SDRRI),":"),U,2)
"RTN","SDRRPXC",72,0)
 . S SDRRFROM=$O(^SC("B",SDRRFROM),-1)
"RTN","SDRRPXC",73,0)
 . S SDRRTHRU=$P($P(SDRRCLIN(SDRRI),":",2),U,2)
"RTN","SDRRPXC",74,0)
 . S SDRRCLIN=SDRRFROM
"RTN","SDRRPXC",75,0)
 . F  S SDRRCLIN=$O(^SC("B",SDRRCLIN)) Q:SDRRCLIN=""  D  Q:SDRRCLIN=SDRRTHRU
"RTN","SDRRPXC",76,0)
 . . S SDRRIEN=$O(^SC("B",SDRRCLIN,0))
"RTN","SDRRPXC",77,0)
 . . S SDRRREC=$G(^SC(SDRRIEN,0))
"RTN","SDRRPXC",78,0)
 . . Q:'$$ACTIVE(SDRRIEN,.SDRRDIV,.SDRRST,.SDRRND,SDRRREC)
"RTN","SDRRPXC",79,0)
 . . S ^TMP("SDRR",$J,"DIV",$P(SDRRREC,U,15),"CLIN",$P(SDRRREC,U))=SDRRIEN_U_$$STOPCODE($P(SDRRREC,U,7))_U_$$STOPCODE($P(SDRRREC,U,18))
"RTN","SDRRPXC",80,0)
 Q
"RTN","SDRRPXC",81,0)
S ; Select stop codes
"RTN","SDRRPXC",82,0)
 N SDRRDIC,SDRRSC,SDRRSCI,SDRRNDX,SDRRIEN,SDRRREC
"RTN","SDRRPXC",83,0)
 S SDRRDIC=40.7
"RTN","SDRRPXC",84,0)
 S SDRRDIC(0)="AEMQZ"
"RTN","SDRRPXC",85,0)
 S SDRRDIC("A")="Select Stop Code: "
"RTN","SDRRPXC",86,0)
 S SDRRDIC("S")="S %=$P(^(0),U,3) I '%!(%>"_$G(SDRRST,DT)_")"
"RTN","SDRRPXC",87,0)
 I '$$EN^SDRRSLCT(.SDRRDIC,"SDRR") S SDRRABORT=1 Q
"RTN","SDRRPXC",88,0)
 S (SDRRSC,SDRRSCI,SDRRIEN)=""
"RTN","SDRRPXC",89,0)
 F  S SDRRSC=$O(^TMP($J,"SDRR",SDRRSC)) Q:SDRRSC=""  D
"RTN","SDRRPXC",90,0)
 . F  S SDRRSCI=$O(^TMP($J,"SDRR",SDRRSC,SDRRSCI)) Q:'SDRRSCI  D
"RTN","SDRRPXC",91,0)
 . . F SDRRNDX="AST","ACST" D  ; xrefs on STOP CODE and CREDIT STOP fields
"RTN","SDRRPXC",92,0)
 . . . F  S SDRRIEN=$O(^SC(SDRRNDX,SDRRSCI,SDRRIEN)) Q:'SDRRIEN  D
"RTN","SDRRPXC",93,0)
 . . . . S SDRRREC=$G(^SC(SDRRIEN,0))
"RTN","SDRRPXC",94,0)
 . . . . Q:'$$ACTIVE(SDRRIEN,.SDRRDIV,.SDRRST,.SDRRND,SDRRREC)
"RTN","SDRRPXC",95,0)
 . . . . S ^TMP("SDRR",$J,"DIV",$P(SDRRREC,U,15),"CLIN",$P(SDRRREC,U))=SDRRIEN_U_$$STOPCODE($P(SDRRREC,U,7))_U_$$STOPCODE($P(SDRRREC,U,18))
"RTN","SDRRPXC",96,0)
 K ^TMP($J,"SDRR")
"RTN","SDRRPXC",97,0)
 Q
"RTN","SDRRPXC",98,0)
ASKRANGE(SDRRCLIN,SDRRDIV,SDRRST,SDRRND) ;
"RTN","SDRRPXC",99,0)
 N DIC,X,Y,DTOUT,DUOUT,SDRRCNT,SDRRFROM
"RTN","SDRRPXC",100,0)
 S SDRRCNT=0
"RTN","SDRRPXC",101,0)
 S DIC="^SC(",DIC(0)="AEQM"
"RTN","SDRRPXC",102,0)
 W !
"RTN","SDRRPXC",103,0)
 W !,"To select a range of clinics, first you select the start of the range,"
"RTN","SDRRPXC",104,0)
 W !,"or the 'from' clinic.  Next, you select the end of the range,"
"RTN","SDRRPXC",105,0)
 W !,"or the 'thru' clinic.  We'll select all the clinics in that range for you."
"RTN","SDRRPXC",106,0)
 F  D  Q:Y<0
"RTN","SDRRPXC",107,0)
 . W !
"RTN","SDRRPXC",108,0)
 . S DIC("A")="From Clinic: "
"RTN","SDRRPXC",109,0)
 . S DIC("S")="I $$ACTIVE^SDRRPXC(+Y,.SDRRDIV,.SDRRST,.SDRRND,^(0))"
"RTN","SDRRPXC",110,0)
 . D ^DIC Q:Y<0
"RTN","SDRRPXC",111,0)
 . S SDRRFROM=Y ;S SDRRDIV(+Y)=$P(Y,U,2)
"RTN","SDRRPXC",112,0)
 . S DIC("A")="Thru Clinic: "
"RTN","SDRRPXC",113,0)
 . S DIC("S")="I $P(^(0),U)]"""_$O(^SC("B",$P(SDRRFROM,U,2)),-1)_""",$$ACTIVE^SDRRPXC(+Y,.SDRRDIV,.SDRRST,.SDRRND,^(0))"
"RTN","SDRRPXC",114,0)
 . D ^DIC Q:Y<0
"RTN","SDRRPXC",115,0)
 . S SDRRCNT=SDRRCNT+1
"RTN","SDRRPXC",116,0)
 . S SDRRCLIN(SDRRCNT)=SDRRFROM_":"_Y
"RTN","SDRRPXC",117,0)
 I $D(DTOUT)!$D(DUOUT) K SDRRCLIN S SDRRCLIN=0
"RTN","SDRRPXC",118,0)
 S SDRRCLIN=SDRRCNT
"RTN","SDRRPXC",119,0)
 Q
"RTN","SDRRPXC",120,0)
ACTIVE(SDRRIEN,SDRRDIV,SDRRST,SDRRND,SDRRREC) ; Is the clinic active?
"RTN","SDRRPXC",121,0)
 ; SDRRIEN - IEN of clinic in HOSPITAL LOCATION (#44) file
"RTN","SDRRPXC",122,0)
 ; SDRRDIV - (optional) clinic must be in Division(s)
"RTN","SDRRPXC",123,0)
 ;          SDRRDIV=ien  or SDRRDIV(ien)="", where ien is IEN in file 40.8
"RTN","SDRRPXC",124,0)
 ; SDRRST  - (optional) date range start date - default=DT
"RTN","SDRRPXC",125,0)
 ; SDRRND  - (optional) date range end date - default=SDRRST
"RTN","SDRRPXC",126,0)
 ; SDRRREC - (optional) zero node of clinic
"RTN","SDRRPXC",127,0)
 I '$D(SDRRREC) S SDRRREC=$G(^SC(SDRRIEN,0))
"RTN","SDRRPXC",128,0)
 Q:$P(SDRRREC,U,3)'="C" 0  ; Not a clinic
"RTN","SDRRPXC",129,0)
 Q:$P(SDRRREC,U,1)["*" 0
"RTN","SDRRPXC",130,0)
 I $D(SDRRDIV)=1,$P(SDRRREC,U,15)'=SDRRDIV Q 0
"RTN","SDRRPXC",131,0)
 I $D(SDRRDIV)>9,'$D(SDRRDIV(+$P(SDRRREC,U,15))) Q 0
"RTN","SDRRPXC",132,0)
 S SDRRREC=$G(^SC(SDRRIEN,"I"))
"RTN","SDRRPXC",133,0)
 Q:'SDRRREC 1
"RTN","SDRRPXC",134,0)
 I '$G(SDRRST) S SDRRST=DT
"RTN","SDRRPXC",135,0)
 I '$G(SDRRND) S SDRRND=SDRRST
"RTN","SDRRPXC",136,0)
 I $P(SDRRREC,U,1)<SDRRST Q $S($P(SDRRREC,U,2)="":0,$P(SDRRREC,U,2)>SDRRND:0,1:1)
"RTN","SDRRPXC",137,0)
 Q 1  ; Active
"RTN","SDRRRECL")
0^23^B83067983
"RTN","SDRRRECL",1,0)
SDRRRECL ;10N20/MAH;Recall Reminder Manual Printing; 09/20/2004
"RTN","SDRRRECL",2,0)
 ;;5.3;Scheduling;**536**;Aug 13, 1993;Build 53
"RTN","SDRRRECL",3,0)
 ;;This routine is called from SDRRCLRP 
"RTN","SDRRRECL",4,0)
 ;;If the site has set TYPE OF NOTIFICATION to LETTER this routine
"RTN","SDRRRECL",5,0)
 ;;will run.
"RTN","SDRRRECL",6,0)
 K TYPE
"RTN","SDRRRECL",7,0)
MEN ;SET UP WHAT ARE THEY WOULD LIKE TO PRINT FOR LETTERS
"RTN","SDRRRECL",8,0)
 K DIR,Y,DTOUT,DIROUT,DIRUT,DUOUT
"RTN","SDRRRECL",9,0)
 S DIR(0)="SO^1:Print Letters by Clinic;2:Print Letters by Provider;3:Print Letters by Team;4:Print a Letter by Patient;5:Print Letters for Nonresponsive Patients"
"RTN","SDRRRECL",10,0)
 W ! S DIR("A")="Please select what you are looking for"
"RTN","SDRRRECL",11,0)
 D ^DIR G:$D(DUOUT)!($D(DTOUT)!($D(DIRUT))) QUIT S Q=Y
"RTN","SDRRRECL",12,0)
 I Q=1 G EN
"RTN","SDRRRECL",13,0)
 I Q=2 G EN1
"RTN","SDRRRECL",14,0)
 I Q=3 G EN3
"RTN","SDRRRECL",15,0)
 I Q=4 G EN4
"RTN","SDRRRECL",16,0)
 I Q=5 G EN5
"RTN","SDRRRECL",17,0)
 Q
"RTN","SDRRRECL",18,0)
EN ;PRINT BY CLINIC
"RTN","SDRRRECL",19,0)
 S DIC="^SC(",DIC(0)="AEQMZ" D ^DIC Q:Y<0  S DIV=+Y G:Y<0 QUIT
"RTN","SDRRRECL",20,0)
 I '$D(^SD(403.52,"B",DIV)) W !,?5,"**NO RECALL LETTER ON FILE**" G QUIT
"RTN","SDRRRECL",21,0)
 D SELDT
"RTN","SDRRRECL",22,0)
 S %ZIS="QM" D ^%ZIS G:POP QUIT I $D(IO("Q")) S ZTDESC="Print Recall Letters by Clinic",ZTRTN="DQD^SDRRRECL" S ZTSAVE("*")="" D ^%ZTLOAD G QUIT
"RTN","SDRRRECL",23,0)
DQD K ^TMP($J)
"RTN","SDRRRECL",24,0)
 U IO S D0=0 F  S D0=$O(^SD(403.5,"E",DIV,D0)) Q:D0=""  S DTA=$G(^SD(403.5,D0,0)) D:DTA]""
"RTN","SDRRRECL",25,0)
 .S TIME=""
"RTN","SDRRRECL",26,0)
 .I $P(^SD(403.5,D0,0),"^",9)>30 S TIME=$P(^SD(403.5,D0,0),"^",9) S TIME="**"_TIME_"**"
"RTN","SDRRRECL",27,0)
 .S LAB=$S($P($G(^SD(403.5,D0,0)),"^",8)="f":"Lab test(s) have been ordered that require you to FAST",$P(^SD(403.5,D0,0),"^",8)="n":"Lab test(s) have been ordered, which need to be done before an appointment is made",1:"")
"RTN","SDRRRECL",28,0)
 .S DFN=+DTA
"RTN","SDRRRECL",29,0)
 .Q:$P(DTA,U,6)<SDT!($P(DTA,U,6)>EDT)
"RTN","SDRRRECL",30,0)
 .Q:$$TESTPAT^VADPT(DFN)
"RTN","SDRRRECL",31,0)
 .D ADD^VADPT,DEM^VADPT
"RTN","SDRRRECL",32,0)
 .S STATE=$P(VAPA(5),"^",1),STATE=$$GET1^DIQ(5,STATE_",",1)
"RTN","SDRRRECL",33,0)
 .S PN=$P(VADM(1),U)
"RTN","SDRRRECL",34,0)
 .I $G(VADM(6),U)'="" Q
"RTN","SDRRRECL",35,0)
 .S CHECK=$$BADADR^DGUTL3 I CHECK>0 S XMSUB="Bad Address for Recall Reminder Patient",XMTEXT="SDRR(" D
"RTN","SDRRRECL",36,0)
 ..S XMY("G.SDRR BAD ADDRESS")="",XMDUZ=.5
"RTN","SDRRRECL",37,0)
 ..S SDRR(1)="Bad Address- card will not be printed for:"_"   "_PN_"   "_VA("BID")
"RTN","SDRRRECL",38,0)
 ..D ^XMD
"RTN","SDRRRECL",39,0)
 ..K XMY,XMSUB,XMTEXT,XMDUZ
"RTN","SDRRRECL",40,0)
 .;ADDED THE DATE INFORMATION
"RTN","SDRRRECL",41,0)
 .S $P(^SD(403.5,D0,0),"^",10)=DT
"RTN","SDRRRECL",42,0)
 .D PR
"RTN","SDRRRECL",43,0)
 D ^%ZISC G QUIT
"RTN","SDRRRECL",44,0)
 ;;done and tested
"RTN","SDRRRECL",45,0)
QUIT K ADTA,D0,DFN,DIC,DIR,DIRUT,DTA,I,L,PN,POP,Y,DIV,EDT,PR,SDT,FAST,TIME,ACC
"RTN","SDRRRECL",46,0)
 K LINE,LETTER,MESSAGE,TEST,DOD,CLINIC,FAIL,TEAM,LAB,SDRR,Q,%DT,%ZIS,CHECK,VA,ZTDESC,ZTIO,ZTRTN,ZTSAVE,STATE Q
"RTN","SDRRRECL",47,0)
 D KVAR^VADPT
"RTN","SDRRRECL",48,0)
 Q
"RTN","SDRRRECL",49,0)
SELDT S %DT="AEX",%DT("A")="Start with RECALL DATE: " D ^%DT Q:Y<0  S SDT=Y,%DT("A")="End with RECALL DATE: " D ^%DT I Y<SDT W $C(7),"  ??" G SELDT
"RTN","SDRRRECL",50,0)
 S EDT=Y Q
"RTN","SDRRRECL",51,0)
PR S LETTER=0
"RTN","SDRRRECL",52,0)
 W @IOF F L=1:1:11 W !
"RTN","SDRRRECL",53,0)
 W !?20,$P(PN,",",2)," ",$P(PN,",")
"RTN","SDRRRECL",54,0)
 I $P(VAPA(1),U)'="" W !?20,$P(VAPA(1),U)
"RTN","SDRRRECL",55,0)
 I $P(VAPA(2),U)'="" W !?20,$P(VAPA(2),U)
"RTN","SDRRRECL",56,0)
 I $P(VAPA(3),U)'="" W !?20,$P(VAPA(3),U)
"RTN","SDRRRECL",57,0)
 W !?20,$P(VAPA(4),U),", "_STATE_"  ",$P(VAPA(6),U)
"RTN","SDRRRECL",58,0)
 I $D(MESSAGE) W !!!!!,?25,MESSAGE
"RTN","SDRRRECL",59,0)
 I TIME'="" W !!!!?25,TIME
"RTN","SDRRRECL",60,0)
 I LAB'="" W !!,?25,"** "_LAB
"RTN","SDRRRECL",61,0)
 W !!!
"RTN","SDRRRECL",62,0)
 S:'$D(MESSAGE) LETTER=$O(^SD(403.52,"B",DIV,LETTER))
"RTN","SDRRRECL",63,0)
 I LETTER>0 S LINE=0 F  S LINE=$O(^SD(403.52,LETTER,1,LINE)) Q:'LINE  W !,?2,$P(^SD(403.52,LETTER,1,LINE,0),"^",1)
"RTN","SDRRRECL",64,0)
 K MESSAGE
"RTN","SDRRRECL",65,0)
 Q
"RTN","SDRRRECL",66,0)
EN1 ;print letters by provider
"RTN","SDRRRECL",67,0)
 S DIC="^SD(403.54,",DIC(0)="AEQMZ",DIC("A")="Select Provider: " D ^DIC G:Y<0 QUIT S PR=+Y
"RTN","SDRRRECL",68,0)
 D SELDT
"RTN","SDRRRECL",69,0)
 S %ZIS="QM" D ^%ZIS G:POP QUIT I $D(IO("Q")) S ZTDESC="Print Recall Letters by Provider",ZTRTN="DQD1^SDRRRECL" S ZTSAVE("*")="" D ^%ZTLOAD G QUIT
"RTN","SDRRRECL",70,0)
DQD1 K ^TMP($J)
"RTN","SDRRRECL",71,0)
 U IO S D0=0 F  S D0=$O(^SD(403.5,"C",PR,D0)) Q:D0=""  S (CLINIC,FAIL)=0 S CLINIC=$P($G(^SD(403.5,D0,0)),"^",2) D
"RTN","SDRRRECL",72,0)
 .S DTA=$G(^SD(403.5,D0,0))
"RTN","SDRRRECL",73,0)
 .I CLINIC="" S FAIL=1 S MESSAGE="***NO CLINIC ON FILE**"
"RTN","SDRRRECL",74,0)
 .I CLINIC'=""  I '$D(^SD(403.52,"B",CLINIC))  S MESSAGE="***NO CLINIC LETTER ON FILE**" S FAIL=1
"RTN","SDRRRECL",75,0)
 .I CLINIC'="",(FAIL=0) S DIV=CLINIC S LETTER=0,LETTER=$O(^SD(403.52,"B",CLINIC,LETTER))
"RTN","SDRRRECL",76,0)
 .S TIME=""
"RTN","SDRRRECL",77,0)
 .I $P(^SD(403.5,D0,0),"^",9)>30 S TIME=$P(^SD(403.5,D0,0),"^",9) S TIME="**"_TIME_"**"
"RTN","SDRRRECL",78,0)
 .S LAB=$S($P($G(^SD(403.5,D0,0)),"^",8)="f":"Lab test(s) have been ordered that require you to FAST",$P(^SD(403.5,D0,0),"^",8)="n":"Lab test(s) have been ordered, which need to be done before an appointment is made",1:"")
"RTN","SDRRRECL",79,0)
 .S DFN=+DTA
"RTN","SDRRRECL",80,0)
 .Q:$P(DTA,U,6)<SDT!($P(DTA,U,6)>EDT)
"RTN","SDRRRECL",81,0)
 .Q:$$TESTPAT^VADPT(DFN)
"RTN","SDRRRECL",82,0)
 .D ADD^VADPT,DEM^VADPT
"RTN","SDRRRECL",83,0)
 .S STATE=$P(VAPA(5),"^",1),STATE=$$GET1^DIQ(5,STATE_",",1)
"RTN","SDRRRECL",84,0)
 .S PN=$P(VADM(1),U)
"RTN","SDRRRECL",85,0)
 .I $G(VADM(6),U)'="" Q
"RTN","SDRRRECL",86,0)
 .S CHECK=$$BADADR^DGUTL3 I CHECK>0 S XMSUB="Bad Address for Recall Reminder Patient",XMTEXT="SDRR(" D
"RTN","SDRRRECL",87,0)
 ..S XMY("G.SDRR BAD ADDRESS")="",XMDUZ=.5
"RTN","SDRRRECL",88,0)
 ..S SDRR(1)="Bad Address- card will not be printed for:"_"   "_PN_"   "_VA("BID")
"RTN","SDRRRECL",89,0)
 ..D ^XMD
"RTN","SDRRRECL",90,0)
 ..K XMY,XMSUB,XMTEXT,XMDUZ
"RTN","SDRRRECL",91,0)
 .;ADDED THE DATE INFORMATION
"RTN","SDRRRECL",92,0)
 .S $P(^SD(403.5,D0,0),"^",10)=DT
"RTN","SDRRRECL",93,0)
 .D PR
"RTN","SDRRRECL",94,0)
 D ^%ZISC G QUIT
"RTN","SDRRRECL",95,0)
EN3 ;PRINT LETTER FOR A TEAM
"RTN","SDRRRECL",96,0)
 W ! S DIC="^SD(403.55,",DIC(0)="AEQMZ",DIC("A")="Select Clinic Recall Team: " D ^DIC S TEAM=+Y K DIC G:Y<0 QUIT
"RTN","SDRRRECL",97,0)
 D SELDT
"RTN","SDRRRECL",98,0)
 S %ZIS="QM" D ^%ZIS G:POP QUIT I $D(IO("Q")) S ZTDESC="Print Recall Letters for a Team",ZTRTN="DQD4^SDRRRECL" S ZTSAVE("*")="" D ^%ZTLOAD G QUIT
"RTN","SDRRRECL",99,0)
DQD4 S PR=0 F  S PR=$O(^SD(403.54,"C",TEAM,PR)) Q:'PR  S D0=0 D
"RTN","SDRRRECL",100,0)
 .F  S D0=$O(^SD(403.5,"C",PR,D0)) Q:D0=""  S (CLINIC,FAIL)=0 S CLINIC=$P($G(^SD(403.5,D0,0)),"^",2) D
"RTN","SDRRRECL",101,0)
 ..S DTA=$G(^SD(403.5,D0,0))
"RTN","SDRRRECL",102,0)
 ..I CLINIC="" S FAIL=1 S MESSAGE="***NO CLINIC ON FILE**"
"RTN","SDRRRECL",103,0)
 ..I CLINIC'=""  I '$D(^SD(403.52,"B",CLINIC))  S MESSAGE="***NO CLINIC LETTER ON FILE**" S FAIL=1
"RTN","SDRRRECL",104,0)
 ..I CLINIC'="",(FAIL=0) S DIV=CLINIC S LETTER=0,LETTER=$O(^SD(403.52,"B",CLINIC,LETTER))
"RTN","SDRRRECL",105,0)
 ..S TIME=""
"RTN","SDRRRECL",106,0)
 ..I $P(^SD(403.5,D0,0),"^",9)>30 S TIME=$P(^SD(403.5,D0,0),"^",9) S TIME="**"_TIME_"**"
"RTN","SDRRRECL",107,0)
 ..S LAB=$S($P($G(^SD(403.5,D0,0)),"^",8)="f":"Lab test(s) have been ordered that require you to FAST",$P(^SD(403.5,D0,0),"^",8)="n":"Lab test(s) have been ordered, which need to be done before an appointment is made",1:"")
"RTN","SDRRRECL",108,0)
 ..S DFN=+DTA
"RTN","SDRRRECL",109,0)
 ..Q:$$TESTPAT^VADPT(DFN)
"RTN","SDRRRECL",110,0)
 ..D ADD^VADPT,DEM^VADPT
"RTN","SDRRRECL",111,0)
 ..S STATE=$P(VAPA(5),"^",1),STATE=$$GET1^DIQ(5,STATE_",",1)
"RTN","SDRRRECL",112,0)
 ..S PN=$P(VADM(1),U)
"RTN","SDRRRECL",113,0)
 ..I $G(VADM(6),U)'="" Q
"RTN","SDRRRECL",114,0)
 ..S CHECK=$$BADADR^DGUTL3 I CHECK>0 S XMSUB="Bad Address for Recall Reminder Patient",XMTEXT="SDRR(" D
"RTN","SDRRRECL",115,0)
 ...S XMY("G.SDRR BAD ADDRESS")="",XMDUZ=.5
"RTN","SDRRRECL",116,0)
 ...S SDRR(1)="Bad Address- card will not be printed for:"_"   "_PN_"   "_VA("BID")
"RTN","SDRRRECL",117,0)
 ...D ^XMD
"RTN","SDRRRECL",118,0)
 ...K XMY,XMSUB,XMTEXT,XMDUZ
"RTN","SDRRRECL",119,0)
 ..;ADDED THE DATE INFORMATION
"RTN","SDRRRECL",120,0)
 ..S $P(^SD(403.5,D0,0),"^",10)=DT
"RTN","SDRRRECL",121,0)
 ..D PR
"RTN","SDRRRECL",122,0)
 D ^%ZISC G QUIT
"RTN","SDRRRECL",123,0)
 ;done and tested
"RTN","SDRRRECL",124,0)
EN4 ;PRINT LETTER FOR ONE PATIENT
"RTN","SDRRRECL",125,0)
 W ! S DIC="^SD(403.5,",DIC(0)="AEQMZ",DIC("A")="Select Patient: " D ^DIC S D0=+Y K DIC G:Y<0 QUIT
"RTN","SDRRRECL",126,0)
 S DIC="^SC(",DIC(0)="AEQMZ" D ^DIC Q:Y<0  S DIV=+Y K DIC G:Y<0 QUIT
"RTN","SDRRRECL",127,0)
 I '$D(^SD(403.52,"B",DIV)) W !,?5,"**NO RECALL LETTER ON FILE**" G QUIT
"RTN","SDRRRECL",128,0)
 S %ZIS="QM" D ^%ZIS G:POP QUIT I $D(IO("Q")) S ZTDESC="Print Recall Letters for a Patient",ZTRTN="DQD3^SDRRRECL" S ZTSAVE("*")="" D ^%ZTLOAD G QUIT
"RTN","SDRRRECL",129,0)
DQD3 K ^TMP($J)
"RTN","SDRRRECL",130,0)
 S DTA=$G(^SD(403.5,D0,0)) D:DTA]""
"RTN","SDRRRECL",131,0)
 .S TIME=""
"RTN","SDRRRECL",132,0)
 .I $P(^SD(403.5,D0,0),"^",9)>30 S TIME=$P(^SD(403.5,D0,0),"^",9) S TIME="**"_TIME_"**"
"RTN","SDRRRECL",133,0)
 .S LAB=$S($P($G(^SD(403.5,D0,0)),"^",8)="f":"Lab test(s) have been ordered that require you to FAST",$P(^SD(403.5,D0,0),"^",8)="n":"Lab test(s) have been ordered, which need to be done before an appointment is made",1:"")
"RTN","SDRRRECL",134,0)
 .S DFN=+DTA
"RTN","SDRRRECL",135,0)
 .Q:$$TESTPAT^VADPT(DFN)
"RTN","SDRRRECL",136,0)
 .D ADD^VADPT,DEM^VADPT
"RTN","SDRRRECL",137,0)
 .S STATE=$P(VAPA(5),"^",1),STATE=$$GET1^DIQ(5,STATE_",",1)
"RTN","SDRRRECL",138,0)
 .S PN=$P(VADM(1),U)
"RTN","SDRRRECL",139,0)
 .I $G(VADM(6),U)'="" Q
"RTN","SDRRRECL",140,0)
 .S CHECK=$$BADADR^DGUTL3 I CHECK>0 S XMSUB="Bad Address for Recall Reminder Patient",XMTEXT="SDRR(" D
"RTN","SDRRRECL",141,0)
 ..S XMY("G.SDRR BAD ADDRESS")="",XMDUZ=.5
"RTN","SDRRRECL",142,0)
 ..S SDRR(1)="Bad Address- card will not be printed for:"_"   "_PN_"   "_VA("BID")
"RTN","SDRRRECL",143,0)
 ..D ^XMD
"RTN","SDRRRECL",144,0)
 ..K XMY,XMSUB,XMTEXT,XMDUZ
"RTN","SDRRRECL",145,0)
 .;ADDED THE DATE INFORMATION
"RTN","SDRRRECL",146,0)
 .S $P(^SD(403.5,D0,0),"^",10)=DT
"RTN","SDRRRECL",147,0)
 .D PR
"RTN","SDRRRECL",148,0)
 D ^%ZISC G QUIT
"RTN","SDRRRECL",149,0)
EN5 ;Print LETTERS for Nonresponsive
"RTN","SDRRRECL",150,0)
 S TEAM=""
"RTN","SDRRRECL",151,0)
 S DIC="^SD(403.55,",DIC(0)="AEQMZ",DIC("A")="Select Clinic Recall Team: " D ^DIC S TEAM=+Y K DIC G:TEAM<0 QUIT
"RTN","SDRRRECL",152,0)
 S %ZIS="QM" D ^%ZIS G:POP QUIT I $D(IO("Q")) S ZTDESC="Print Recall Letters for Nonresponsive",ZTRTN="DQD5^SDRRRECL" S ZTSAVE("*")="" D ^%ZTLOAD G QUIT
"RTN","SDRRRECL",153,0)
DQD5 N CHKDATE
"RTN","SDRRRECL",154,0)
 S PR=0,CHKDATE=5 F  S PR=$O(^SD(403.54,"C",TEAM,PR)) Q:'PR  W !,TEAM_"^"_PR D
"RTN","SDRRRECL",155,0)
 .S D0=0 F  S D0=$O(^SD(403.5,"C",PR,D0)) Q:'D0  S (CLINIC,FAIL)=0 S CLINIC=$P($G(^SD(403.5,D0,0)),"^",2) D
"RTN","SDRRRECL",156,0)
 ..I $P($G(^SD(403.5,D0,0)),"^",10)="" QUIT
"RTN","SDRRRECL",157,0)
 ..S RDATE=$P($G(^SD(403.5,D0,0)),"^",6) S CHECK=$$FMDIFF^XLFDT(RDATE,DT) I CHECK>CHKDATE K RDATE QUIT
"RTN","SDRRRECL",158,0)
 ..S DTA=$G(^SD(403.5,D0,0))
"RTN","SDRRRECL",159,0)
 ..I CLINIC="" S FAIL=1 S MESSAGE="***NO CLINIC ON FILE**"
"RTN","SDRRRECL",160,0)
 ..I CLINIC'=""  I '$D(^SD(403.52,"B",CLINIC))  S MESSAGE="***NO CLINIC LETTER ON FILE**" S FAIL=1
"RTN","SDRRRECL",161,0)
 ..I CLINIC'="",(FAIL=0) S DIV=CLINIC S LETTER=0,LETTER=$O(^SD(403.52,"B",CLINIC,LETTER))
"RTN","SDRRRECL",162,0)
 ..S TIME=""
"RTN","SDRRRECL",163,0)
 ..I $P(^SD(403.5,D0,0),"^",9)>30 S TIME=$P(^SD(403.5,D0,0),"^",9) S TIME="**"_TIME_"**"
"RTN","SDRRRECL",164,0)
 ..S LAB=$S($P($G(^SD(403.5,D0,0)),"^",8)="f":"Lab test(s) have been ordered that require you to FAST",$P(^SD(403.5,D0,0),"^",8)="n":"Lab test(s) have been ordered, which need to be done before an appointment is made",1:"")
"RTN","SDRRRECL",165,0)
 ..S DFN=+DTA
"RTN","SDRRRECL",166,0)
 ..Q:$$TESTPAT^VADPT(DFN)
"RTN","SDRRRECL",167,0)
 ..D ADD^VADPT,DEM^VADPT
"RTN","SDRRRECL",168,0)
 ..S STATE=$P(VAPA(5),"^",1),STATE=$$GET1^DIQ(5,STATE_",",1)
"RTN","SDRRRECL",169,0)
 ..S PN=$P(VADM(1),U)
"RTN","SDRRRECL",170,0)
 ..I $G(VADM(6),U)'="" Q
"RTN","SDRRRECL",171,0)
 ..S CHECK=$$BADADR^DGUTL3 I CHECK>0 S XMSUB="Bad Address for Recall Reminder Patient",XMTEXT="SDRR(" D
"RTN","SDRRRECL",172,0)
 ...S XMY("G.SDRR BAD ADDRESS")="",XMDUZ=.5
"RTN","SDRRRECL",173,0)
 ...S SDRR(1)="Bad Address- card will not be printed for:"_"   "_PN_"   "_VA("BID")
"RTN","SDRRRECL",174,0)
 ...D ^XMD
"RTN","SDRRRECL",175,0)
 ...K XMY,XMSUB,XMTEXT,XMDUZ
"RTN","SDRRRECL",176,0)
 ..;ADDED THE DATE INFORMATION
"RTN","SDRRRECL",177,0)
 ..S $P(^SD(403.5,D0,0),"^",13)=DT
"RTN","SDRRRECL",178,0)
 ..D PR
"RTN","SDRRRECL",179,0)
 D ^%ZISC G QUIT
"RTN","SDRRRECL",180,0)
 Q
"RTN","SDRRRECP")
0^24^B67349870
"RTN","SDRRRECP",1,0)
SDRRRECP ;10N20/MAH;Recall Reminder Manual Printing; 09/20/2004
"RTN","SDRRRECP",2,0)
 ;;5.3;Scheduling;**536**;Aug 13, 1993;Build 53
"RTN","SDRRRECP",3,0)
 ;;This routine is called from SDRRCLRP 
"RTN","SDRRRECP",4,0)
 ;;If the site has set TYPE OF NOTIFICATION to CARDS this routine
"RTN","SDRRRECP",5,0)
 ;;will run.
"RTN","SDRRRECP",6,0)
 K TYPE
"RTN","SDRRRECP",7,0)
MEN ;SET UP WHAT ARE THEY WOULD LIKE TO PRINT FOR CARDS
"RTN","SDRRRECP",8,0)
 K DIR,Y,DTOUT,DIROUT,DIRUT,DUOUT
"RTN","SDRRRECP",9,0)
 S DIR(0)="SO^1:Print Cards by Division;2:Print Cards by Clinic;3:Print Cards by Provider;4:Print Cards by Team;5:Print a Card by Patient;6:Print Cards for Nonresponsive Patients"
"RTN","SDRRRECP",10,0)
 W ! S DIR("A")="Please select what you are looking for"
"RTN","SDRRRECP",11,0)
 D ^DIR G:$D(DUOUT)!($D(DTOUT)!($D(DIRUT))) QUIT S Q=Y
"RTN","SDRRRECP",12,0)
 I Q=1 G EN3
"RTN","SDRRRECP",13,0)
 I Q=2 G EN
"RTN","SDRRRECP",14,0)
 I Q=3 G EN2
"RTN","SDRRRECP",15,0)
 I Q=4 G EN1
"RTN","SDRRRECP",16,0)
 I Q=5 G EN4
"RTN","SDRRRECP",17,0)
 I Q=6 G EN5
"RTN","SDRRRECP",18,0)
 Q
"RTN","SDRRRECP",19,0)
 ;ALLK Q,Y,DIR
"RTN","SDRRRECP",20,0)
EN3 ;PRINT BY DIVISION
"RTN","SDRRRECP",21,0)
 S DIC="^DG(40.8,",DIC(0)="AEQMZ" D ^DIC G:Y<0 QUIT S DIV=+Y D SELDT G:Y<0 QUIT
"RTN","SDRRRECP",22,0)
 S %ZIS="QM" D ^%ZIS G:POP QUIT I $D(IO("Q")) S ZTDSC="Print Recall Cards by Division",ZTRTN="DQD1^SDRRRECP" S ZTSAVE("*")="" D ^%ZTLOAD G QUIT
"RTN","SDRRRECP",23,0)
DQD1 K ^TMP($J)
"RTN","SDRRRECP",24,0)
 S PR=0 F  S PR=$O(^SD(403.5,"C",PR)) Q:PR=""  I $P($G(^SD(403.54,PR,0)),"^",3)=DIV S D0=0 F  S D0=$O(^SD(403.5,"C",PR,D0)) Q:D0=""  S DTA=$G(^SD(403.5,D0,0)) D:DTA]""
"RTN","SDRRRECP",25,0)
 .S TIME=""
"RTN","SDRRRECP",26,0)
 .I $P(^SD(403.5,D0,0),"^",9)["60" S TIME=$P(^SD(403.5,D0,0),"^",9) S TIME="**"_TIME_"**"
"RTN","SDRRRECP",27,0)
 .S LAB=$S($P($G(^SD(403.5,D0,0)),"^",8)="f":"**FL",$P(^SD(403.5,D0,0),"^",8)="n":"**NFL",1:"")
"RTN","SDRRRECP",28,0)
 .S DFN=+DTA
"RTN","SDRRRECP",29,0)
 .Q:$$TESTPAT^VADPT(DFN)
"RTN","SDRRRECP",30,0)
 .D ADD^VADPT,DEM^VADPT
"RTN","SDRRRECP",31,0)
 .S PN=$P(VADM(1),U)
"RTN","SDRRRECP",32,0)
 .S STATE=$P(VAPA(5),"^",1),STATE=$$GET1^DIQ(5,STATE_",",1)
"RTN","SDRRRECP",33,0)
 .I $G(VADM(6),U)'="" Q
"RTN","SDRRRECP",34,0)
 .Q:$P(DTA,"^",6)<SDT!($P(DTA,"^",6)>EDT) 
"RTN","SDRRRECP",35,0)
 .S CHECK=$$BADADR^DGUTL3 I CHECK>0 S XMSUB="Bad Address for Recall Reminder Patient",XMTEXT="SDRR(" D
"RTN","SDRRRECP",36,0)
 ..S XMY("G.SDRR BAD ADDRESS")="",XMDUZ=.5
"RTN","SDRRRECP",37,0)
 ..S SDRR(1)="Bad Address- card will not be printed for:"_"   "_PN_"   "_VA("BID")
"RTN","SDRRRECP",38,0)
 ..D ^XMD
"RTN","SDRRRECP",39,0)
 ..K XMY,XMSUB,XMTEXT,XMDUZ
"RTN","SDRRRECP",40,0)
 .;ADDED THE DATE INFORMATION
"RTN","SDRRRECP",41,0)
 .S $P(^SD(403.5,D0,0),"^",10)=DT
"RTN","SDRRRECP",42,0)
 .D PR
"RTN","SDRRRECP",43,0)
 D ^%ZISC G QUIT
"RTN","SDRRRECP",44,0)
EN ;PRINT BY CLINIC
"RTN","SDRRRECP",45,0)
 S DIC="^SC(",DIC(0)="AEQMZ" D ^DIC Q:Y<0  S DIV=+Y D SELDT G:Y<0 QUIT
"RTN","SDRRRECP",46,0)
 S %ZIS="QM" D ^%ZIS G:POP QUIT I $D(IO("Q")) S ZTDESC="Print Recall Cards by Clinic",ZTRTN="DQD^SDRRRECP" S ZTSAVE("*")="" D ^%ZTLOAD G QUIT
"RTN","SDRRRECP",47,0)
DQD K ^TMP($J)
"RTN","SDRRRECP",48,0)
 S D0=0 F  S D0=$O(^SD(403.5,"E",DIV,D0)) Q:D0=""  S DTA=$G(^SD(403.5,D0,0)) D:DTA]""
"RTN","SDRRRECP",49,0)
 .S TIME=""
"RTN","SDRRRECP",50,0)
 .I $P(^SD(403.5,D0,0),"^",9)["60" S TIME=$P(^SD(403.5,D0,0),"^",9) S TIME="**"_TIME_"**"
"RTN","SDRRRECP",51,0)
 .S LAB=$S($P($G(^SD(403.5,D0,0)),"^",8)="f":"**FL",$P(^SD(403.5,D0,0),"^",8)="n":"**NFL",1:"")
"RTN","SDRRRECP",52,0)
 .S DFN=+DTA
"RTN","SDRRRECP",53,0)
 .Q:$$TESTPAT^VADPT(DFN)
"RTN","SDRRRECP",54,0)
 .D ADD^VADPT,DEM^VADPT
"RTN","SDRRRECP",55,0)
 .S STATE=$P(VAPA(5),"^",1),STATE=$$GET1^DIQ(5,STATE_",",1)
"RTN","SDRRRECP",56,0)
 .S PN=$P(VADM(1),U)
"RTN","SDRRRECP",57,0)
 .I $G(VADM(6),U)'="" Q
"RTN","SDRRRECP",58,0)
 .Q:$P(DTA,"^",6)<SDT!($P(DTA,"^",6)>EDT) 
"RTN","SDRRRECP",59,0)
 .S CHECK=$$BADADR^DGUTL3 I CHECK>0 S XMSUB="Bad Address for Recall Reminder Patient",XMTEXT="SDRR(" D
"RTN","SDRRRECP",60,0)
 ..S XMY("G.SDRR BAD ADDRESS")="",XMDUZ=.5
"RTN","SDRRRECP",61,0)
 ..S SDRR(1)="Bad Address- card will not be printed for:"_"   "_PN_"   "_VA("BID")
"RTN","SDRRRECP",62,0)
 ..D ^XMD
"RTN","SDRRRECP",63,0)
 ..K XMY,XMSUB,XMTEXT,XMDUZ
"RTN","SDRRRECP",64,0)
 .;ADDED THE DATE INFORMATION
"RTN","SDRRRECP",65,0)
 .S $P(^SD(403.5,D0,0),"^",10)=DT
"RTN","SDRRRECP",66,0)
 .D PR
"RTN","SDRRRECP",67,0)
 D ^%ZISC G QUIT
"RTN","SDRRRECP",68,0)
QUIT K ADTA,D0,DFN,DIC,DIR,DIRUT,DTA,I,L,PN,POP,Y,DIV,EDT,PR,SDT,TIME,LAB,Y,STATE
"RTN","SDRRRECP",69,0)
 K DATE,DOD,X,Q,%DT,%ZIS,SDRR,VA,CHECK,ZTDESC,ZTDSC,ZTEAM,ZTIO,ZTRTN,ZTSAVE
"RTN","SDRRRECP",70,0)
 Q
"RTN","SDRRRECP",71,0)
SELDT S %DT="AEX",%DT("A")="Start with RECALL DATE: " D ^%DT Q:Y<0  S SDT=Y,%DT("A")="End with RECALL DATE: " D ^%DT I Y<SDT W $C(7),"  ??" G SELDT
"RTN","SDRRRECP",72,0)
 S EDT=Y Q
"RTN","SDRRRECP",73,0)
PR W @IOF F L=1:1:7 W !
"RTN","SDRRRECP",74,0)
 W !?20,$P($P(PN,",",2)," ",1)_" "_$P(PN,",")
"RTN","SDRRRECP",75,0)
 I $P(VAPA(1),U)'="" W !?20,$P(VAPA(1),U)
"RTN","SDRRRECP",76,0)
 I $P(VAPA(2),U)'="" W !?20,$P(VAPA(2),U)
"RTN","SDRRRECP",77,0)
 I $P(VAPA(3),U)'="" W !?20,$P(VAPA(3),U)
"RTN","SDRRRECP",78,0)
 W !?20,$P(VAPA(4),U),", "_STATE_"  ",$P(VAPA(6),U)
"RTN","SDRRRECP",79,0)
 I TIME'="" W !!?45,TIME
"RTN","SDRRRECP",80,0)
 I LAB'="" W !!?45,LAB
"RTN","SDRRRECP",81,0)
 Q
"RTN","SDRRRECP",82,0)
EN1 ;PRINT BY TEAM
"RTN","SDRRRECP",83,0)
 S DIC="^SD(403.55,",DIC(0)="AEQMZ",DIC("A")="Select Clinic Team: " D ^DIC Q:Y<0  S ZTEAM=+Y D SELDT G:Y<0 QUIT
"RTN","SDRRRECP",84,0)
 S %ZIS="QM" D ^%ZIS G:POP QUIT I $D(IO("Q")) S ZTDESC="Print Recall Cards by Team",ZTRTN="DQT^SDRRRECP" S ZTSAVE("*")="" D ^%ZTLOAD G QUIT
"RTN","SDRRRECP",85,0)
DQT K ^TMP($J)
"RTN","SDRRRECP",86,0)
 S PR=0 F  S PR=$O(^SD(403.5,"C",PR)) Q:PR=""  I $P($G(^SD(403.54,PR,0)),U,2)=+ZTEAM S D0=0 F  S D0=$O(^SD(403.5,"C",PR,D0)) Q:D0=""  S DTA=$G(^SD(403.5,D0,0)) D:DTA]""
"RTN","SDRRRECP",87,0)
 .S TIME=""
"RTN","SDRRRECP",88,0)
 .I $P(^SD(403.5,D0,0),"^",9)["60" S TIME=$P(^SD(403.5,D0,0),"^",9) S TIME="**"_TIME_"**"
"RTN","SDRRRECP",89,0)
 .S LAB=$S($P($G(^SD(403.5,D0,0)),"^",8)="f":"**FL",$P(^SD(403.5,D0,0),"^",8)="n":"**NFL",1:"")
"RTN","SDRRRECP",90,0)
 .S DFN=+DTA
"RTN","SDRRRECP",91,0)
 .Q:$$TESTPAT^VADPT(DFN)
"RTN","SDRRRECP",92,0)
 .D ADD^VADPT,DEM^VADPT
"RTN","SDRRRECP",93,0)
 .S PN=$P(VADM(1),U)
"RTN","SDRRRECP",94,0)
 .S STATE=$P(VAPA(5),"^",1),STATE=$$GET1^DIQ(5,STATE_",",1)
"RTN","SDRRRECP",95,0)
 .I $G(VADM(6),U)'="" Q
"RTN","SDRRRECP",96,0)
 .Q:$P(DTA,"^",6)<SDT!($P(DTA,"^",6)>EDT) 
"RTN","SDRRRECP",97,0)
 .S CHECK=$$BADADR^DGUTL3 I CHECK>0 S XMSUB="Bad Address for Recall Reminder Patient",XMTEXT="SDRR(" D
"RTN","SDRRRECP",98,0)
 ..S XMY("G.SDRR BAD ADDRESS")="",XMDUZ=.5
"RTN","SDRRRECP",99,0)
 ..S SDRR(1)="Bad Address- card will not be printed for:"_"   "_PN_"   "_VA("BID")
"RTN","SDRRRECP",100,0)
 ..D ^XMD
"RTN","SDRRRECP",101,0)
 ..K XMY,XMSUB,XMTEXT,XMDUZ
"RTN","SDRRRECP",102,0)
 ..D ^%ZISC G QUIT
"RTN","SDRRRECP",103,0)
 .;ADDED THE DATE INFORMATION
"RTN","SDRRRECP",104,0)
 .S $P(^SD(403.5,D0,0),"^",10)=DT
"RTN","SDRRRECP",105,0)
 .D PR
"RTN","SDRRRECP",106,0)
 D ^%ZISC G QUIT
"RTN","SDRRRECP",107,0)
EN2 ;PRINT BY PROV
"RTN","SDRRRECP",108,0)
 S DIC="^SD(403.54,",DIC(0)="AEQMZ",DIC("A")="Select Provider: " D ^DIC G:Y<0 QUIT S PR=+Y  D SELDT G:Y<0 QUIT
"RTN","SDRRRECP",109,0)
 S %ZIS="QM" D ^%ZIS G:POP QUIT I $D(IO("Q")) S ZTDESC="Print Recall Cards by Prov",ZTRTN="DQP^SDRRRECP" S ZTSAVE("*")="" D ^%ZTLOAD G QUIT
"RTN","SDRRRECP",110,0)
DQP K ^TMP($J)
"RTN","SDRRRECP",111,0)
 S D0=0 F  S D0=$O(^SD(403.5,"C",PR,D0)) Q:D0=""  S DTA=$G(^SD(403.5,D0,0)) D:DTA]""
"RTN","SDRRRECP",112,0)
 .S TIME=""
"RTN","SDRRRECP",113,0)
 .I $P(^SD(403.5,D0,0),"^",9)>30 S TIME=$P(^SD(403.5,D0,0),"^",9) S TIME="**"_TIME_"**"
"RTN","SDRRRECP",114,0)
 .S LAB=$S($P($G(^SD(403.5,D0,0)),"^",8)="f":"**FL",$P(^SD(403.5,D0,0),"^",8)="n":"**NFL",1:"")
"RTN","SDRRRECP",115,0)
 .S DFN=+DTA
"RTN","SDRRRECP",116,0)
 .Q:$$TESTPAT^VADPT(DFN)
"RTN","SDRRRECP",117,0)
 .D ADD^VADPT,DEM^VADPT
"RTN","SDRRRECP",118,0)
 .S STATE=$P(VAPA(5),"^",1),STATE=$$GET1^DIQ(5,STATE_",",1)
"RTN","SDRRRECP",119,0)
 .S PN=$P(VADM(1),U)
"RTN","SDRRRECP",120,0)
 .I $G(VADM(6),U)'="" Q
"RTN","SDRRRECP",121,0)
 .Q:$P(DTA,"^",6)<SDT!($P(DTA,"^",6)>EDT) 
"RTN","SDRRRECP",122,0)
 .S CHECK=$$BADADR^DGUTL3 I CHECK>0 S XMSUB="Bad Address for Recall Reminder Patient",XMTEXT="SDRR(" D
"RTN","SDRRRECP",123,0)
 ..S XMY("G.SDRR BAD ADDRESS")="",XMDUZ=.5
"RTN","SDRRRECP",124,0)
 ..S SDRR(1)="Bad Address- card will not be printed for:"_"   "_PN_"   "_VA("BID")
"RTN","SDRRRECP",125,0)
 ..D ^XMD
"RTN","SDRRRECP",126,0)
 ..K XMY,XMSUB,XMTEXT,XMDUZ
"RTN","SDRRRECP",127,0)
 .;ADDED THE DATE INFORMATION
"RTN","SDRRRECP",128,0)
 .S $P(^SD(403.5,D0,0),"^",10)=DT
"RTN","SDRRRECP",129,0)
 .D PR
"RTN","SDRRRECP",130,0)
 D ^%ZISC G QUIT
"RTN","SDRRRECP",131,0)
EN4 ;PRINT BY Patient
"RTN","SDRRRECP",132,0)
 W ! S DIC="^SD(403.5,",DIC(0)="AEQMZ",DIC("A")="Select Patient: " D ^DIC G:Y<0 QUIT S D0=+Y
"RTN","SDRRRECP",133,0)
 S %ZIS="QM" D ^%ZIS G:POP QUIT I $D(IO("Q")) S ZTDESC="Print Recall Cards by Prov",ZTRTN="DPP^SDRRRECP" S ZTSAVE("*")="" D ^%ZTLOAD G QUIT
"RTN","SDRRRECP",134,0)
DPP K ^TMP($J)
"RTN","SDRRRECP",135,0)
 S DTA=$G(^SD(403.5,D0,0)) D:DTA]""
"RTN","SDRRRECP",136,0)
 .S TIME=""
"RTN","SDRRRECP",137,0)
 .I $P(^SD(403.5,D0,0),"^",9)>30 S TIME=$P(^SD(403.5,D0,0),"^",9) S TIME="**"_TIME_"**"
"RTN","SDRRRECP",138,0)
 .S LAB=$S($P($G(^SD(403.5,D0,0)),"^",8)="f":"**FL",$P(^SD(403.5,D0,0),"^",8)="n":"**NFL",1:"")
"RTN","SDRRRECP",139,0)
 .S DFN=+DTA
"RTN","SDRRRECP",140,0)
 .Q:$$TESTPAT^VADPT(DFN)
"RTN","SDRRRECP",141,0)
 .D ADD^VADPT,DEM^VADPT
"RTN","SDRRRECP",142,0)
 .S STATE=$P(VAPA(5),"^",1),STATE=$$GET1^DIQ(5,STATE_",",1)
"RTN","SDRRRECP",143,0)
 .S PN=$P(VADM(1),U)
"RTN","SDRRRECP",144,0)
 .I $G(VADM(6),U)'="" Q 
"RTN","SDRRRECP",145,0)
 .S CHECK=$$BADADR^DGUTL3 I CHECK>0 S XMSUB="Bad Address for Recall Reminder Patient",XMTEXT="SDRR(" D
"RTN","SDRRRECP",146,0)
 ..S XMY("G.SDRR BAD ADDRESS")="",XMDUZ=.5
"RTN","SDRRRECP",147,0)
 ..S SDRR(1)="Bad Address- card will not be printed for:"_"   "_PN_"   "_VA("BID")
"RTN","SDRRRECP",148,0)
 ..D ^XMD
"RTN","SDRRRECP",149,0)
 ..K XMY,XMSUB,XMTEXT,XMDUZ
"RTN","SDRRRECP",150,0)
 .;ADDED THE DATE INFORMATION
"RTN","SDRRRECP",151,0)
 .S $P(^SD(403.5,D0,0),"^",10)=DT
"RTN","SDRRRECP",152,0)
 .D PR
"RTN","SDRRRECP",153,0)
 D ^%ZISC G QUIT
"RTN","SDRRRECP",154,0)
EN5 ;PRINT BY TEAM
"RTN","SDRRRECP",155,0)
 S DIC="^SD(403.55,",DIC(0)="AEQMZ",DIC("A")="Select Clinic Team: " D ^DIC S ZTEAM=+Y G:Y<0 QUIT
"RTN","SDRRRECP",156,0)
 S %ZIS="QM" D ^%ZIS G:POP QUIT I $D(IO("Q")) S ZTDESC="Print Nonresponsive Recall Cards by Team",ZTRTN="DQDD^SDRRRECP" S ZTSAVE("*")="" D ^%ZTLOAD G QUIT
"RTN","SDRRRECP",157,0)
DQDD K ^TMP($J)
"RTN","SDRRRECP",158,0)
 N CHKDATE
"RTN","SDRRRECP",159,0)
 S PR=0 F  S PR=$O(^SD(403.5,"C",PR)) Q:PR=""  I $P($G(^SD(403.54,PR,0)),U,2)=+ZTEAM S D0=0 F  S D0=$O(^SD(403.5,"C",PR,D0)) Q:D0=""  S DTA=$G(^SD(403.5,D0,0)) D:DTA]""
"RTN","SDRRRECP",160,0)
 .I $P($G(^SD(403.5,D0,0)),"^",10)="" QUIT
"RTN","SDRRRECP",161,0)
 .S CHKDATE=5 S RDATE=$P($G(^SD(403.5,D0,0)),"^",6) S CHECK=$$FMDIFF^XLFDT(RDATE,DT) I CHECK>CHKDATE K RDATE QUIT
"RTN","SDRRRECP",162,0)
 .S TIME=""
"RTN","SDRRRECP",163,0)
 .I $P(^SD(403.5,D0,0),"^",9)["60" S TIME=$P(^SD(403.5,D0,0),"^",9) S TIME="**"_TIME_"**"
"RTN","SDRRRECP",164,0)
 .S LAB=$S($P($G(^SD(403.5,D0,0)),"^",8)="f":"**FL",$P(^SD(403.5,D0,0),"^",8)="n":"**NFL",1:"")
"RTN","SDRRRECP",165,0)
 .S DFN=+DTA
"RTN","SDRRRECP",166,0)
 .Q:$$TESTPAT^VADPT(DFN)
"RTN","SDRRRECP",167,0)
 .D ADD^VADPT,DEM^VADPT
"RTN","SDRRRECP",168,0)
 .S STATE=$P(VAPA(5),"^",1),STATE=$$GET1^DIQ(5,STATE_",",1)
"RTN","SDRRRECP",169,0)
 .S PN=$P(VADM(1),U)
"RTN","SDRRRECP",170,0)
 .I $G(VADM(6),U)'="" Q
"RTN","SDRRRECP",171,0)
 .S CHECK=$$BADADR^DGUTL3 I CHECK>0 S XMSUB="Bad Address for Recall Reminder Patient",XMTEXT="SDRR(" D
"RTN","SDRRRECP",172,0)
 ..S XMY("G.SDRR BAD ADDRESS")="",XMDUZ=.5
"RTN","SDRRRECP",173,0)
 ..S SDRR(1)="Bad Address- card will not be printed for:"_"   "_PN_"   "_VA("BID")
"RTN","SDRRRECP",174,0)
 ..D ^XMD
"RTN","SDRRRECP",175,0)
 ..K XMY,XMSUB,XMTEXT,XMDUZ
"RTN","SDRRRECP",176,0)
 .;ADDED THE DATE INFORMATION
"RTN","SDRRRECP",177,0)
 .S $P(^SD(403.5,D0,0),"^",13)=DT
"RTN","SDRRRECP",178,0)
 .D PR
"RTN","SDRRRECP",179,0)
 D ^%ZISC G QUIT
"RTN","SDRRRECP",180,0)
 Q
"RTN","SDRRSEG3")
0^25^B2988411
"RTN","SDRRSEG3",1,0)
SDRRSEG3 ;10N20/MAH;Display Future Clinic Recalls in Brief Patient Inquiry; 1/15/08  
"RTN","SDRRSEG3",2,0)
 ;;5.3;Scheduling;**536**;Aug 13, 1993;Build 53
"RTN","SDRRSEG3",3,0)
 N I,Y,CLINIC,C,D,KEY
"RTN","SDRRSEG3",4,0)
 W !!,"Future Clinic Recalls:"
"RTN","SDRRSEG3",5,0)
 I '$D(^SD(403.5,"B",DFN)) W ?25,"<No Clinic Recall on file>",! G EXIT
"RTN","SDRRSEG3",6,0)
 W !
"RTN","SDRRSEG3",7,0)
 W ?2,"Clinic",?32,"Recall Date",?55,"Notice Sent",!
"RTN","SDRRSEG3",8,0)
 F Q=1:1:79 W "="
"RTN","SDRRSEG3",9,0)
EN1 ;
"RTN","SDRRSEG3",10,0)
 K ^TMP("SDRRCLR")
"RTN","SDRRSEG3",11,0)
 S C=0 F I=0:0 S I=$O(^SD(403.5,"B",DFN,I)) Q:'I  I $D(^SD(403.5,I,0)) S D=^(0),C=C+1 S ^TMP("SDRRCLR",$J,C)=I_"^"_D
"RTN","SDRRSEG3",12,0)
 S (ER,OK)=0 W ! F  S I=$O(^TMP("SDRRCLR",$J,I)) Q:'I   S CLINIC=$P($G(^TMP("SDRRCLR",$J,I)),"^",3) D
"RTN","SDRRSEG3",13,0)
 .I CLINIC'="" S CLINIC=$$GET1^DIQ(44,CLINIC_",",.01)
"RTN","SDRRSEG3",14,0)
 .I CLINIC="" S CLINIC="UNK. CLINIC"
"RTN","SDRRSEG3",15,0)
 .S PROV=$P($G(^TMP("SDRRCLR",$J,I)),"^",6) I PROV'="" S PROV=$P($G(^SD(403.54,PROV,0)),"^",1) I PROV'="" S PROV=$$NAME^XUSER(PROV,"F")
"RTN","SDRRSEG3",16,0)
 .I PROV="" S PROV="UNK. PROVIDER"
"RTN","SDRRSEG3",17,0)
 .S RDT="",RDT=$P(^TMP("SDRRCLR",$J,I),"^",7) I $G(RDT)]"" S Y=RDT D DD^%DT S RDT=Y
"RTN","SDRRSEG3",18,0)
 .S RS=$P(^TMP("SDRRCLR",$J,I),"^",11) I $G(RS)]"" S Y=RS D DD^%DT S RS=Y
"RTN","SDRRSEG3",19,0)
 .I RS="" S RS="NO"
"RTN","SDRRSEG3",20,0)
 .W ?2,$E(CLINIC,1,30),?32,RDT,?55,RS,! S Z=I
"RTN","SDRRSEG3",21,0)
EXIT ;
"RTN","SDRRSEG3",22,0)
 K ER,OK,PROV,RDT,RS,X,Z,Q
"RTN","SDRRSEG3",23,0)
 Q
"RTN","SDRRSLC1")
0^26^B40514848
"RTN","SDRRSLC1",1,0)
SDRRSLC1 ;10N20/MAH;-Generic Recall Reminder file entry selector ;12/16/2002  14:21
"RTN","SDRRSLC1",2,0)
 ;;5.3;Scheduling;**536**;Aug 13, 1993;Build 53
"RTN","SDRRSLC1",3,0)
 ;
"RTN","SDRRSLC1",4,0)
RANGE(SDRRDX,SDRRDDIC,SDRRDUTIL,SDRRDFLD,SDRRDDSEL,SDRRDNUM) ;
"RTN","SDRRSLC1",5,0)
 N %DT,SDRRD,SDRRD0,SDRRDALL,SDRRDDATE,SDRRDDONE,SDRRDFL01,SDRRDFNAM,SDRRDFNUM
"RTN","SDRRSLC1",6,0)
 N SDRRDFSCR,SDRRDLAST,SDRRDLINE,SDRRDPATT,SDRRDQUIT,SDRRDVALU,SDRRDXBEG
"RTN","SDRRSLC1",7,0)
 N SDRRDXEND,SDRRDXREF,SDRRDXX,D0,DA,DIC
"RTN","SDRRSLC1",8,0)
 D FILEATTR^SDRRSLCT(SDRRDDIC,SDRRDDIC(0),.SDRRDFNUM,.SDRRDFNAM,.SDRRDFL01,.SDRRDFSCR)
"RTN","SDRRSLC1",9,0)
 S SDRRDXBEG=$P(SDRRDX,"-")
"RTN","SDRRSLC1",10,0)
 S SDRRDXEND=$P(SDRRDX,"-",2)
"RTN","SDRRSLC1",11,0)
 S (SDRRDDONE,SDRRDQUIT)=0
"RTN","SDRRSLC1",12,0)
 I SDRRDXEND']]SDRRDXBEG Q SDRRDQUIT
"RTN","SDRRSLC1",13,0)
 S SDRRDPATT=$$PATTERN(SDRRDX)
"RTN","SDRRSLC1",14,0)
 S SDRRDDATE=$S($$CHFLD^SDRRSLCT(SDRRDFNUM)["D":1,1:0)
"RTN","SDRRSLC1",15,0)
 I SDRRDDATE D  Q:SDRRDDONE SDRRDQUIT
"RTN","SDRRSLC1",16,0)
 . S X=SDRRDXBEG,%DT="ST" D ^%DT S SDRRDXBEG=Y
"RTN","SDRRSLC1",17,0)
 . S X=SDRRDXEND,%DT="ST" D ^%DT S SDRRDXEND=Y
"RTN","SDRRSLC1",18,0)
 . I (SDRRDXBEG'>0)!(SDRRDXEND'>0) S SDRRDDONE=1
"RTN","SDRRSLC1",19,0)
 . Q
"RTN","SDRRSLC1",20,0)
 S SDRRD=$$ASK(SDRRDX,.SDRRDDIC,SDRRDFNAM,SDRRDFL01,"RANGE")
"RTN","SDRRSLC1",21,0)
 S SDRRDALL=$P(SDRRD,U),SDRRDQUIT=$P(SDRRD,U,2)
"RTN","SDRRSLC1",22,0)
 I SDRRDQUIT!'SDRRDALL W:'SDRRDQUIT !!,SDRRDX Q SDRRDQUIT
"RTN","SDRRSLC1",23,0)
 S SDRRDXREF="""B"""
"RTN","SDRRSLC1",24,0)
 I +SDRRDFNUM=80 D  ; Kludge!
"RTN","SDRRSLC1",25,0)
 . S SDRRDXREF="""BA"""
"RTN","SDRRSLC1",26,0)
 . S SDRRDXBEG=SDRRDXBEG_" "
"RTN","SDRRSLC1",27,0)
 . S SDRRDXEND=SDRRDXEND_" "
"RTN","SDRRSLC1",28,0)
 . Q
"RTN","SDRRSLC1",29,0)
 I SDRRDDATE D
"RTN","SDRRSLC1",30,0)
 . S SDRRDXX=SDRRDXBEG-.0000001
"RTN","SDRRSLC1",31,0)
 . S SDRRDXEND=$S(SDRRDXEND'[".":SDRRDXEND+.24,1:SDRRDXEND)
"RTN","SDRRSLC1",32,0)
 . Q
"RTN","SDRRSLC1",33,0)
 E  D
"RTN","SDRRSLC1",34,0)
 . S SDRRDLAST=$E(SDRRDXBEG,$L(SDRRDXBEG))
"RTN","SDRRSLC1",35,0)
 . S SDRRDLAST=$C($A(SDRRDLAST)-1)_"~"
"RTN","SDRRSLC1",36,0)
 . S SDRRDXX=$E(SDRRDXBEG,1,$L(SDRRDXBEG)-1)_SDRRDLAST
"RTN","SDRRSLC1",37,0)
 . Q
"RTN","SDRRSLC1",38,0)
 S SDRRDNUM("B4")=SDRRDNUM
"RTN","SDRRSLC1",39,0)
 F  S SDRRDXX=$O(@(SDRRDDIC_SDRRDXREF_",SDRRDXX)")) Q:(SDRRDXX="")!(SDRRDXX]]SDRRDXEND)  D
"RTN","SDRRSLC1",40,0)
 . S SDRRD0=0
"RTN","SDRRSLC1",41,0)
 . F  S SDRRD0=$O(@(SDRRDDIC_SDRRDXREF_",SDRRDXX,SDRRD0)")) Q:SDRRD0'>0  D
"RTN","SDRRSLC1",42,0)
 .. D DATALOOP
"RTN","SDRRSLC1",43,0)
 .. Q
"RTN","SDRRSLC1",44,0)
 . Q
"RTN","SDRRSLC1",45,0)
 I SDRRDNUM=SDRRDNUM("B4")&'SDRRDDSEL D
"RTN","SDRRSLC1",46,0)
 . S SDRRD="No "_SDRRDFNAM_" "_SDRRDFL01_$$PLURAL^SDRRSLCT(SDRRDFL01)
"RTN","SDRRSLC1",47,0)
 . S SDRRD=SDRRD_" found in the range '"_SDRRDX_"'."
"RTN","SDRRSLC1",48,0)
 . D WRAP^SDRRSLCT(SDRRD,.SDRRDLINE)
"RTN","SDRRSLC1",49,0)
 . W !
"RTN","SDRRSLC1",50,0)
 . S SDRRD=0
"RTN","SDRRSLC1",51,0)
 . F  S SDRRD=$O(SDRRDLINE(SDRRD)) Q:SDRRD'>0  W !,SDRRDLINE(SDRRD)
"RTN","SDRRSLC1",52,0)
 . W $C(7)
"RTN","SDRRSLC1",53,0)
 . Q
"RTN","SDRRSLC1",54,0)
 Q -1
"RTN","SDRRSLC1",55,0)
 ;
"RTN","SDRRSLC1",56,0)
ALL(SDRRDX,SDRRDDIC,SDRRDUTIL,SDRRDFLD,SDRRDDSEL,SDRRDNUM) ;
"RTN","SDRRSLC1",57,0)
 N %DT,SDRRD,SDRRD0,SDRRDALL,SDRRDDATE,SDRRDDONE,SDRRDFL01,SDRRDFNAM,SDRRDFNUM
"RTN","SDRRSLC1",58,0)
 N SDRRDFSCR,SDRRDLINE,SDRRDPATT,SDRRDQUIT,SDRRDVALU,CHAR,D0,DA,DIR,DIROUT
"RTN","SDRRSLC1",59,0)
 N DIRUT,DO,DTOUT,DUOUT,I,TEMP,X,Y
"RTN","SDRRSLC1",60,0)
 D FILEATTR^SDRRSLCT(SDRRDDIC,SDRRDDIC(0),.SDRRDFNUM,.SDRRDFNAM,.SDRRDFL01,.SDRRDFSCR)
"RTN","SDRRSLC1",61,0)
 S (SDRRDDONE,SDRRDQUIT)=0
"RTN","SDRRSLC1",62,0)
 S SDRRD=$$ASK(SDRRDX,.SDRRDDIC,SDRRDFNAM,SDRRDFL01,"PATTERN")
"RTN","SDRRSLC1",63,0)
 S SDRRDALL=$P(SDRRD,U),SDRRDQUIT=$P(SDRRD,U,2)
"RTN","SDRRSLC1",64,0)
 I SDRRDQUIT!'SDRRDALL W:'SDRRDQUIT !!,SDRRDX Q SDRRDQUIT
"RTN","SDRRSLC1",65,0)
 S SDRRDPATT=$$PATTERN(SDRRDX)
"RTN","SDRRSLC1",66,0)
 S SDRRDDATE=$S($$CHFLD^SDRRSLCT(SDRRDFNUM)["D":1,1:0)
"RTN","SDRRSLC1",67,0)
 S SDRRDNUM("B4")=SDRRDNUM
"RTN","SDRRSLC1",68,0)
 S SDRRD0=0
"RTN","SDRRSLC1",69,0)
 F  S SDRRD0=$O(@(SDRRDDIC_"SDRRD0)")) Q:SDRRD0'>0  D
"RTN","SDRRSLC1",70,0)
 . D DATALOOP
"RTN","SDRRSLC1",71,0)
 . Q
"RTN","SDRRSLC1",72,0)
 I SDRRDNUM=SDRRDNUM("B4")&'SDRRDDSEL D
"RTN","SDRRSLC1",73,0)
 . S SDRRD="No "_SDRRDFNAM_" "_SDRRDFL01_$$PLURAL^SDRRSLCT(SDRRDFL01)
"RTN","SDRRSLC1",74,0)
 . S SDRRD=SDRRD_" found matching '"_SDRRDX_"'."
"RTN","SDRRSLC1",75,0)
 . D WRAP^SDRRSLCT(SDRRD,.SDRRDLINE)
"RTN","SDRRSLC1",76,0)
 . W !
"RTN","SDRRSLC1",77,0)
 . S SDRRD=0
"RTN","SDRRSLC1",78,0)
 . F  S SDRRD=$O(SDRRDLINE(SDRRD)) Q:SDRRD'>0  W !,SDRRDLINE(SDRRD)
"RTN","SDRRSLC1",79,0)
 . W $C(7)
"RTN","SDRRSLC1",80,0)
 . Q
"RTN","SDRRSLC1",81,0)
 Q -1
"RTN","SDRRSLC1",82,0)
 ;
"RTN","SDRRSLC1",83,0)
PATTERN(SDRRDX) ;
"RTN","SDRRSLC1",84,0)
 N SDRRD,SDRRDCHAR,SDRRDPATT,SDRRDQUOT,SDRRDTEMP
"RTN","SDRRSLC1",85,0)
 I SDRRDX["*" D
"RTN","SDRRSLC1",86,0)
 . I SDRRDX["""" S SDRRDQUOT("""")="""""",SDRRDX=$$REPLACE^XLFSTR(SDRRDX,.SDRRDQUOT)
"RTN","SDRRSLC1",87,0)
 . S SDRRDPATT="Y'?"
"RTN","SDRRSLC1",88,0)
 . S SDRRDTEMP=""
"RTN","SDRRSLC1",89,0)
 . F SDRRD=1:1:$L(SDRRDX) D
"RTN","SDRRSLC1",90,0)
 .. S SDRRDCHAR=$E(SDRRDX,SDRRD)
"RTN","SDRRSLC1",91,0)
 .. I SDRRDCHAR'="*" S SDRRDTEMP=SDRRDTEMP_SDRRDCHAR Q
"RTN","SDRRSLC1",92,0)
 .. D PATRN(.SDRRDPATT,.SDRRDTEMP,SDRRDCHAR)
"RTN","SDRRSLC1",93,0)
 .. Q
"RTN","SDRRSLC1",94,0)
 . D PATRN(.SDRRDPATT,.SDRRDTEMP,SDRRDCHAR)
"RTN","SDRRSLC1",95,0)
 . Q
"RTN","SDRRSLC1",96,0)
 E  D
"RTN","SDRRSLC1",97,0)
 . S SDRRDPATT=""
"RTN","SDRRSLC1",98,0)
 . Q
"RTN","SDRRSLC1",99,0)
 Q SDRRDPATT
"RTN","SDRRSLC1",100,0)
 ;
"RTN","SDRRSLC1",101,0)
PATRN(PAT,TEMP,CHAR)  ;
"RTN","SDRRSLC1",102,0)
 I TEMP]"" S PAT=PAT_"1"""_TEMP_""""
"RTN","SDRRSLC1",103,0)
 I CHAR="*",$E(PAT,$L(PAT)-1,$L(PAT))'=".E" S PAT=PAT_".E"
"RTN","SDRRSLC1",104,0)
 S TEMP=""
"RTN","SDRRSLC1",105,0)
 Q
"RTN","SDRRSLC1",106,0)
 ;
"RTN","SDRRSLC1",107,0)
DATALOOP ;
"RTN","SDRRSLC1",108,0)
 I $$SCREEN(SDRRD0,.SDRRDDIC,$G(SDRRDFSCR))'>0 Q
"RTN","SDRRSLC1",109,0)
 S Y=$P($G(@(SDRRDDIC_"SDRRD0,0)")),U)
"RTN","SDRRSLC1",110,0)
 I Y="" Q
"RTN","SDRRSLC1",111,0)
 S Y=$$EXTERNAL^DILFD(SDRRDFNUM,.01,"",Y)
"RTN","SDRRSLC1",112,0)
 I SDRRDDATE S X=Y,%DT="ST" D ^%DT
"RTN","SDRRSLC1",113,0)
 I SDRRDX["*",SDRRDPATT]"",@SDRRDPATT Q
"RTN","SDRRSLC1",114,0)
 I SDRRDFLD="" D
"RTN","SDRRSLC1",115,0)
 . D SETDATA^SDRRSLCT(Y,SDRRD0,SDRRDUTIL,SDRRDDSEL,.SDRRDNUM)
"RTN","SDRRSLC1",116,0)
 . Q
"RTN","SDRRSLC1",117,0)
 E  D
"RTN","SDRRSLC1",118,0)
 . S Y=+SDRRD0,Y(0)=$G(@(SDRRDDIC_+Y_",0)")),Y(0,0)=$P(Y(0),U)
"RTN","SDRRSLC1",119,0)
 . S SDRRDVALU=$$FLDSRT^SDRRSLCT(SDRRDFNUM,SDRRDFLD,Y(0))
"RTN","SDRRSLC1",120,0)
 . I SDRRDVALU]"" D
"RTN","SDRRSLC1",121,0)
 .. D SETDATA^SDRRSLCT(SDRRDVALU,SDRRD0,SDRRDUTIL,SDRRDDSEL,.SDRRDNUM)
"RTN","SDRRSLC1",122,0)
 .. Q
"RTN","SDRRSLC1",123,0)
 . Q
"RTN","SDRRSLC1",124,0)
 Q
"RTN","SDRRSLC1",125,0)
 ;
"RTN","SDRRSLC1",126,0)
SCREEN(SDRRD0,SDRRDDIC,SDRRDFSCR) ;
"RTN","SDRRSLC1",127,0)
 N SDRRDDONE,D0,DA,Y
"RTN","SDRRSLC1",128,0)
 S SDRRDDONE=1
"RTN","SDRRSLC1",129,0)
 I SDRRDFSCR]"" D
"RTN","SDRRSLC1",130,0)
 . D SETDIC^SDRRSLCT(.SDRRDDIC,.DIC,.DO)
"RTN","SDRRSLC1",131,0)
 . S (D0,DA,Y)=SDRRD0
"RTN","SDRRSLC1",132,0)
 . I $D(@(SDRRDDIC_"SDRRD0,0)"))#2 X SDRRDFSCR S SDRRDDONE=$T
"RTN","SDRRSLC1",133,0)
 . Q
"RTN","SDRRSLC1",134,0)
 I SDRRDDONE>0,SDRRDDIC("S")]"" D
"RTN","SDRRSLC1",135,0)
 . D SETDIC^SDRRSLCT(.SDRRDDIC,.DIC,.DO)
"RTN","SDRRSLC1",136,0)
 . S (D0,DA,Y)=SDRRD0
"RTN","SDRRSLC1",137,0)
 . I $D(@(SDRRDDIC_"SDRRD0,0)"))#2 X DIC("S") S SDRRDDONE=$T
"RTN","SDRRSLC1",138,0)
 . Q
"RTN","SDRRSLC1",139,0)
 Q SDRRDDONE
"RTN","SDRRSLC1",140,0)
 ;
"RTN","SDRRSLC1",141,0)
ASK(SDRRDX,SDRRDDIC,SDRRDFNAM,SDRRDFL01,SDRRDASKT) ;
"RTN","SDRRSLC1",142,0)
 N SDRRD,SDRRDALL,SDRRDCASE,SDRRDLINE,SDRRDQUIT,DIR,DIROUT,DIRUT,DTOUT,DUOUT
"RTN","SDRRSLC1",143,0)
 S SDRRDCASE=$$PLURAL^SDRRSLCT(SDRRDFL01)
"RTN","SDRRSLC1",144,0)
 S DIR(0)="YAO"
"RTN","SDRRSLC1",145,0)
 S SDRRD="By '"_SDRRDX_"' do you mean all "
"RTN","SDRRSLC1",146,0)
 I $$UP^XLFSTR(SDRRDX)="ALL",$G(SDRRDFSCR)="",$G(SDRRDDIC("S"))="" D
"RTN","SDRRSLC1",147,0)
 . S SDRRD=SDRRD_$P($G(@(SDRRDDIC_"0)")),U,4)_" "
"RTN","SDRRSLC1",148,0)
 . Q
"RTN","SDRRSLC1",149,0)
 S SDRRD=SDRRD_$S((SDRRDASKT="PATTERN")&(SDRRDX["*"):"matching ",1:"")
"RTN","SDRRSLC1",150,0)
 S SDRRD=SDRRD_SDRRDFNAM_" "_SDRRDFL01_SDRRDCASE
"RTN","SDRRSLC1",151,0)
 I SDRRDASKT="RANGE",SDRRDX?1.ANP1"-"1.ANP D
"RTN","SDRRSLC1",152,0)
 . S SDRRD=SDRRD_" between '"_SDRRDXBEG_"' and '"_SDRRDXEND_"'"
"RTN","SDRRSLC1",153,0)
 . Q
"RTN","SDRRSLC1",154,0)
 D WRAP^SDRRSLCT(SDRRD,.SDRRDLINE)
"RTN","SDRRSLC1",155,0)
 S SDRRD=0
"RTN","SDRRSLC1",156,0)
 F  S SDRRD=$O(SDRRDLINE(SDRRD)) Q:SDRRD'>0  D
"RTN","SDRRSLC1",157,0)
 . I $O(SDRRDLINE(SDRRD))>0 S DIR("A",SDRRD)=SDRRDLINE(SDRRD)
"RTN","SDRRSLC1",158,0)
 . E  S DIR("A")=SDRRDLINE(SDRRD)_": "
"RTN","SDRRSLC1",159,0)
 . Q
"RTN","SDRRSLC1",160,0)
 S DIR("B")="Yes"
"RTN","SDRRSLC1",161,0)
 S DIR("?")="Answer Y(es) if you want all of the "_SDRRDFNAM_" "
"RTN","SDRRSLC1",162,0)
 S DIR("?")=DIR("?")_SDRRDFL01_SDRRDCASE_", otherwise answer N(o)."
"RTN","SDRRSLC1",163,0)
 W ! D ^DIR S SDRRDALL=+$G(Y)
"RTN","SDRRSLC1",164,0)
 S SDRRDQUIT=$S($D(DTOUT)!$D(DUOUT)!$D(DIROUT)!$D(DIRUT):1,1:0)
"RTN","SDRRSLC1",165,0)
 Q SDRRDALL_U_SDRRDQUIT
"RTN","SDRRSLC1",166,0)
 ;
"RTN","SDRRSLC1",167,0)
INTERNAL(SDRRDIN,SDRRDOUT) ;
"RTN","SDRRSLC1",168,0)
 ; Copy @SDRRDIN@(External,Internal) to @SDRRDOUT@(Internal)
"RTN","SDRRSLC1",169,0)
 N SDRRDEXT,SDRRDINT
"RTN","SDRRSLC1",170,0)
 S SDRRDEXT=""
"RTN","SDRRSLC1",171,0)
 F  S SDRRDEXT=$O(@SDRRDIN@(SDRRDEXT)) Q:SDRRDEXT=""  D
"RTN","SDRRSLC1",172,0)
 . S SDRRDINT=""
"RTN","SDRRSLC1",173,0)
 . F  S SDRRDINT=$O(@SDRRDIN@(SDRRDEXT,SDRRDINT)) Q:SDRRDINT=""  D
"RTN","SDRRSLC1",174,0)
 .. S @SDRRDOUT@(SDRRDINT)=""
"RTN","SDRRSLC1",175,0)
 .. Q
"RTN","SDRRSLC1",176,0)
 . Q
"RTN","SDRRSLC1",177,0)
 Q
"RTN","SDRRSLCT")
0^27^B60537302
"RTN","SDRRSLCT",1,0)
SDRRSLCT ;10N20/MAH;-RECALL REMINDER Generic file entry selector ;12/09/2007  14:26
"RTN","SDRRSLCT",2,0)
 ;;5.3;Scheduling;**536**;Aug 13, 1993;Build 53
"RTN","SDRRSLCT",3,0)
 ;
"RTN","SDRRSLCT",4,0)
 ;
"RTN","SDRRSLCT",5,0)
 ;Requires:
"RTN","SDRRSLCT",6,0)
 ; SDRRDDIC      = File number or global root
"RTN","SDRRSLCT",7,0)
 ; SDRRDDIC(0)   = DIC(0) string
"RTN","SDRRSLCT",8,0)
 ; SDRRDUTIL     = Node to store data under in ^TMP($J,SDRRDUTIL,
"RTN","SDRRSLCT",9,0)
 ;
"RTN","SDRRSLCT",10,0)
 ;Optional:
"RTN","SDRRSLCT",11,0)
 ; SDRRDDIC("A") = DIC("A") string
"RTN","SDRRSLCT",12,0)
 ; SDRRDDIC("B") = DIC("B") string
"RTN","SDRRSLCT",13,0)
 ; SDRRDDIC("S") = DIC("S") string
"RTN","SDRRSLCT",14,0)
 ; SDRRDDIC("W") = DIC("W") string
"RTN","SDRRSLCT",15,0)
 ; SDRRDROOT     = Closed array reference where data should be stored
"RTN","SDRRSLCT",16,0)
 ;                Defaluts to ^TMP($J,SDRRDUTIL)
"RTN","SDRRSLCT",17,0)
 ; SDRRDFLD      = Field to sort by if valid data to be stored as
"RTN","SDRRSLCT",18,0)
 ;                @Root@(SDRRDUTIL,ExternalValueSDRRDFLD,IEN)=""
"RTN","SDRRSLCT",19,0)
 ;                SDRRDFLD must reside on the zero (0) node to be valid
"RTN","SDRRSLCT",20,0)
 ;
"RTN","SDRRSLCT",21,0)
 ;Returns:
"RTN","SDRRSLCT",22,0)
 ; $$EN() = $S(UpArrowOut:0, NothingSelected:0, 1:1)
"RTN","SDRRSLCT",23,0)
 ; @SDRRDROOT@(SDRRDUTIL,ExternalFieldData,IEN)=""
"RTN","SDRRSLCT",24,0)
 ;
"RTN","SDRRSLCT",25,0)
 ;Example:
"RTN","SDRRSLCT",26,0)
 ; SET SDRRDDIC=44,SDRRDDIC(0)="EMNQZ",SDRRDDIC("A")="Select CLINIC: "
"RTN","SDRRSLCT",27,0)
 ; SET SDRRDDIC("B")="ALL",SDRRDDIC("S")="IF $PIECE(^(0),U,3)=""C"""
"RTN","SDRRSLCT",28,0)
 ; IF $$EN^SDRRSLCT(.SDRRDDIC,"ClinicNode","MYARRAY",1)'>0 QUIT
"RTN","SDRRSLCT",29,0)
 ;
"RTN","SDRRSLCT",30,0)
EN(SDRRDDIC,SDRRDUTIL,SDRRDROOT,SDRRDFLD) ;
"RTN","SDRRSLCT",31,0)
 N %DT,SDRRDDONE,SDRRDDSEL,SDRRDFL01,SDRRDFNAM,SDRRDFNUM,SDRRDFSCR,SDRRDMASK
"RTN","SDRRSLCT",32,0)
 N SDRRDNUM,SDRRDQUIT,SDRRDVALU,SDRRDX,DIC,DO,DTOUT,DUOUT,I,X,Y
"RTN","SDRRSLCT",33,0)
 S SDRRDFLD=$G(SDRRDFLD)
"RTN","SDRRSLCT",34,0)
 I $G(SDRRDROOT)]"" S SDRRDROOT=$NA(@SDRRDROOT@(SDRRDUTIL))
"RTN","SDRRSLCT",35,0)
 E  S SDRRDROOT=$NA(^TMP($J,SDRRDUTIL))
"RTN","SDRRSLCT",36,0)
 K @SDRRDROOT
"RTN","SDRRSLCT",37,0)
 S (SDRRDQUIT,SDRRDDONE)=0
"RTN","SDRRSLCT",38,0)
 S SDRRDQUIT=(($G(SDRRDDIC)="")!($G(SDRRDDIC(0))="")!($G(SDRRDUTIL)=""))
"RTN","SDRRSLCT",39,0)
 I SDRRDQUIT>0 G EXIT
"RTN","SDRRSLCT",40,0)
 S DIC=SDRRDDIC
"RTN","SDRRSLCT",41,0)
 I DIC>0 D  I SDRRDQUIT G EXIT
"RTN","SDRRSLCT",42,0)
 . S (SDRRDDIC,DIC)=$$GET1^DID(DIC,"","","GLOBAL NAME")
"RTN","SDRRSLCT",43,0)
 . S SDRRDQUIT=$S(DIC="":1,1:0)
"RTN","SDRRSLCT",44,0)
 . Q
"RTN","SDRRSLCT",45,0)
 S (DIC(0),SDRRDDIC(0))=$TR(SDRRDDIC(0),"AL")_$S(SDRRDDIC(0)'["Z":"Z",1:"")
"RTN","SDRRSLCT",46,0)
 D FILEATTR(DIC,DIC(0),.SDRRDFNUM,.SDRRDFNAM,.SDRRDFL01,.SDRRDFSCR)
"RTN","SDRRSLCT",47,0)
 I SDRRDFLD]"" S SDRRDQUIT=$$FLD(SDRRDFNUM,SDRRDFLD) I SDRRDQUIT G EXIT
"RTN","SDRRSLCT",48,0)
 F I="A","B","S","W" S SDRRDDIC(I)=$G(SDRRDDIC(I))
"RTN","SDRRSLCT",49,0)
 I SDRRDDIC("A")="" S SDRRDDIC("A")="Select "_SDRRDFNAM_" "_SDRRDFL01_": "
"RTN","SDRRSLCT",50,0)
 S SDRRDNUM=1
"RTN","SDRRSLCT",51,0)
 D HOME^%ZIS
"RTN","SDRRSLCT",52,0)
 F  D  Q:SDRRDQUIT!SDRRDDONE
"RTN","SDRRSLCT",53,0)
 . D SETDIC(.SDRRDDIC,.DIC,.DO)
"RTN","SDRRSLCT",54,0)
 . W !!,$S(SDRRDNUM>1:"Another one (Select/De-Select): ",1:DIC("A"))
"RTN","SDRRSLCT",55,0)
 . W $S((SDRRDNUM=1)&(SDRRDDIC("B")]""):SDRRDDIC("B")_"// ",1:"")
"RTN","SDRRSLCT",56,0)
 . R SDRRDX:DTIME S:('$T)!($E(SDRRDX)=U) SDRRDQUIT=1 Q:SDRRDQUIT
"RTN","SDRRSLCT",57,0)
 . I (SDRRDNUM=1)&(SDRRDX="")&(SDRRDDIC("B")]"") S SDRRDX=SDRRDDIC("B")
"RTN","SDRRSLCT",58,0)
 . I SDRRDX="" S SDRRDDONE=1 Q
"RTN","SDRRSLCT",59,0)
 . S SDRRDDSEL=$S(SDRRDX?1"-"1.E:1,1:0)
"RTN","SDRRSLCT",60,0)
 . I SDRRDDSEL S SDRRDX=$E(SDRRDX,2,$L(SDRRDX))
"RTN","SDRRSLCT",61,0)
 . I SDRRDX?1.ANP1"-"1.ANP D  Q:SDRRDQUIT=1  I SDRRDQUIT=-1 S SDRRDQUIT=0 Q
"RTN","SDRRSLCT",62,0)
 .. S SDRRDQUIT=$$RANGE^SDRRSLC1(SDRRDX,.SDRRDDIC,SDRRDUTIL,SDRRDFLD,SDRRDDSEL,.SDRRDNUM)
"RTN","SDRRSLCT",63,0)
 .. Q
"RTN","SDRRSLCT",64,0)
 . I ($$UP^XLFSTR(SDRRDX)="ALL")!(SDRRDX["*") D  Q:SDRRDQUIT=1  I SDRRDQUIT=-1 S SDRRDQUIT=0 Q
"RTN","SDRRSLCT",65,0)
 .. S SDRRDQUIT=$$ALL^SDRRSLC1(SDRRDX,.SDRRDDIC,SDRRDUTIL,SDRRDFLD,SDRRDDSEL,.SDRRDNUM)
"RTN","SDRRSLCT",66,0)
 .. Q
"RTN","SDRRSLCT",67,0)
 . I $E(SDRRDX)="?" D HELP(.SDRRDDIC,SDRRDUTIL,SDRRDFLD)
"RTN","SDRRSLCT",68,0)
 . I $L($G(DIC("S")))<235 D
"RTN","SDRRSLCT",69,0)
 .. S DIC("S")=$S($G(DIC("S"))]"":DIC("S")_" ",1:"")
"RTN","SDRRSLCT",70,0)
 .. S DIC("S")=DIC("S")_"I $$SEL^SDRRSLCT(Y,"_SDRRDFNUM_","_SDRRDDSEL
"RTN","SDRRSLCT",71,0)
 .. S DIC("S")=DIC("S")_$S($G(SDRRDFLD)]"":","_SDRRDFLD,1:"")_")"
"RTN","SDRRSLCT",72,0)
 .. Q
"RTN","SDRRSLCT",73,0)
 . S X=SDRRDX D ^DIC K DIC I +Y'>0 Q
"RTN","SDRRSLCT",74,0)
 . S SDRRDMASK=+Y
"RTN","SDRRSLCT",75,0)
 . I $$CHFLD(SDRRDFNUM)["D" D
"RTN","SDRRSLCT",76,0)
 .. N %DT,X
"RTN","SDRRSLCT",77,0)
 .. S X=Y(0,0),%DT="ST" D ^%DT S Y(0,0)=Y
"RTN","SDRRSLCT",78,0)
 .. Q
"RTN","SDRRSLCT",79,0)
 . S Y=SDRRDMASK
"RTN","SDRRSLCT",80,0)
 . I SDRRDFLD="" D
"RTN","SDRRSLCT",81,0)
 .. D SETDATA(Y(0,0),+Y,SDRRDUTIL,SDRRDDSEL,.SDRRDNUM)
"RTN","SDRRSLCT",82,0)
 .. Q
"RTN","SDRRSLCT",83,0)
 . E  D
"RTN","SDRRSLCT",84,0)
 .. S SDRRDVALU=$$FLDSRT(SDRRDFNUM,SDRRDFLD,Y(0))
"RTN","SDRRSLCT",85,0)
 .. I SDRRDVALU]"" D SETDATA(SDRRDVALU,+Y,SDRRDUTIL,SDRRDDSEL,.SDRRDNUM)
"RTN","SDRRSLCT",86,0)
 .. Q
"RTN","SDRRSLCT",87,0)
 . Q
"RTN","SDRRSLCT",88,0)
 ;
"RTN","SDRRSLCT",89,0)
EXIT ;
"RTN","SDRRSLCT",90,0)
 S SDRRDQUIT=$S(SDRRDQUIT>0:0,$O(@SDRRDROOT@(""))="":0,1:1)
"RTN","SDRRSLCT",91,0)
 I SDRRDQUIT'>0 K @SDRRDROOT
"RTN","SDRRSLCT",92,0)
 Q SDRRDQUIT
"RTN","SDRRSLCT",93,0)
 ;
"RTN","SDRRSLCT",94,0)
SETDATA(SDRRDVALU,SDRRD0,SDRRDUTIL,SDRRDDSEL,SDRRDNUM) ;
"RTN","SDRRSLCT",95,0)
 I 'SDRRDDSEL,'$D(@SDRRDROOT@($E(SDRRDVALU,1,63),SDRRD0)) D
"RTN","SDRRSLCT",96,0)
 . S @SDRRDROOT@($E(SDRRDVALU,1,63),SDRRD0)=""
"RTN","SDRRSLCT",97,0)
 . S SDRRDNUM=SDRRDNUM+1
"RTN","SDRRSLCT",98,0)
 . Q
"RTN","SDRRSLCT",99,0)
 I SDRRDDSEL,$D(@SDRRDROOT@($E(SDRRDVALU,1,63),SDRRD0)) D
"RTN","SDRRSLCT",100,0)
 . K @SDRRDROOT@($E(SDRRDVALU,1,63),SDRRD0)
"RTN","SDRRSLCT",101,0)
 . S SDRRDNUM=SDRRDNUM-$S(SDRRDNUM>0:1,1:0)
"RTN","SDRRSLCT",102,0)
 . Q
"RTN","SDRRSLCT",103,0)
 Q
"RTN","SDRRSLCT",104,0)
 ;
"RTN","SDRRSLCT",105,0)
HELP(SDRRDDIC,SDRRDUTIL,SDRRDFLD) ;
"RTN","SDRRSLCT",106,0)
 N SDRRD,SDRRD0,SDRRDCASE,SDRRDFL01,SDRRDFNAM,SDRRDFNUM
"RTN","SDRRSLCT",107,0)
 N SDRRDFSCR,SDRRDLINE,SDRRDQUIT,DIC,D0,DA,DO,X
"RTN","SDRRSLCT",108,0)
 S SDRRDQUIT=0
"RTN","SDRRSLCT",109,0)
 D FILEATTR(SDRRDDIC,SDRRDDIC(0),.SDRRDFNUM,.SDRRDFNAM,.SDRRDFL01,.SDRRDFSCR)
"RTN","SDRRSLCT",110,0)
 S SDRRDCASE=$$PLURAL(SDRRDFL01)
"RTN","SDRRSLCT",111,0)
 W !
"RTN","SDRRSLCT",112,0)
 S SDRRD="Select a "_SDRRDFNAM_" "_SDRRDFL01_" from the displayed list."
"RTN","SDRRSLCT",113,0)
 D WRAP(SDRRD,.SDRRDLINE)
"RTN","SDRRSLCT",114,0)
 S SDRRD=0
"RTN","SDRRSLCT",115,0)
 F  S SDRRD=$O(SDRRDLINE(SDRRD)) Q:SDRRD'>0  W !?5,SDRRDLINE(SDRRD)
"RTN","SDRRSLCT",116,0)
 W !?5,"To deselect a ",SDRRDFL01," type a minus sign (-)"
"RTN","SDRRSLCT",117,0)
 W !?5,"in front of it, e.g.,  -",SDRRDFL01,"."
"RTN","SDRRSLCT",118,0)
 W !?5,"To get all ",SDRRDFL01,SDRRDCASE," type ALL."
"RTN","SDRRSLCT",119,0)
 W !?5,"Use an asterisk (*) to do a wildcard selection, e.g.,"
"RTN","SDRRSLCT",120,0)
 W !?5,"enter ",SDRRDFL01,"* to select all entries that begin"
"RTN","SDRRSLCT",121,0)
 W !?5,"with the text '",SDRRDFL01,"'.  Wildcard selection is"
"RTN","SDRRSLCT",122,0)
 W !?5,"case sensitive.  A range may be selected by entering"
"RTN","SDRRSLCT",123,0)
 W !?5,"'AAA-CCC', i.e., select all records from 'AAA' to"
"RTN","SDRRSLCT",124,0)
 W !?5,"'CCC' inclusive."
"RTN","SDRRSLCT",125,0)
 W !
"RTN","SDRRSLCT",126,0)
 I $O(@SDRRDROOT@(""))]"" D
"RTN","SDRRSLCT",127,0)
 . S SDRRDLINE=$Y
"RTN","SDRRSLCT",128,0)
 . S SDRRD=""
"RTN","SDRRSLCT",129,0)
 . W !,"You have already selected:"
"RTN","SDRRSLCT",130,0)
 . F  S SDRRD=$O(@SDRRDROOT@(SDRRD)) Q:SDRRD=""!SDRRDQUIT  D
"RTN","SDRRSLCT",131,0)
 .. S SDRRD0=0
"RTN","SDRRSLCT",132,0)
 .. F  S SDRRD0=$O(@SDRRDROOT@(SDRRD,SDRRD0)) Q:SDRRD0'>0!SDRRDQUIT  D
"RTN","SDRRSLCT",133,0)
 ... I SDRRDFLD]"" S SDRRD(0)=$P($G(@(SDRRDDIC_+SDRRD0_",0)")),U)
"RTN","SDRRSLCT",134,0)
 ... E  S SDRRD(0)=SDRRD
"RTN","SDRRSLCT",135,0)
 ... I $$CHFLD(SDRRDFNUM)["D" S SDRRD(0)=$$FMTE^XLFDT(SDRRD(0),"5Z")
"RTN","SDRRSLCT",136,0)
 ... I SDRRDDIC(0)["N" W !?3,SDRRD0,?15,SDRRD(0)
"RTN","SDRRSLCT",137,0)
 ... E  W !?3,SDRRD(0)
"RTN","SDRRSLCT",138,0)
 ... D SETDIC(.SDRRDDIC,.DIC,.DO)
"RTN","SDRRSLCT",139,0)
 ... I $D(DIC("W"))#2,DIC("W")]"",$D(@(SDRRDDIC_"SDRRD0,0)"))#2 D
"RTN","SDRRSLCT",140,0)
 .... S (D0,DA,Y)=SDRRD0
"RTN","SDRRSLCT",141,0)
 .... X DIC("W")
"RTN","SDRRSLCT",142,0)
 .... Q
"RTN","SDRRSLCT",143,0)
 ... I $Y>(IOSL+SDRRDLINE-3) S SDRRDQUIT=$$PAUSE,SDRRDLINE=$Y
"RTN","SDRRSLCT",144,0)
 ... Q
"RTN","SDRRSLCT",145,0)
 .. Q
"RTN","SDRRSLCT",146,0)
 . Q
"RTN","SDRRSLCT",147,0)
 Q
"RTN","SDRRSLCT",148,0)
 ;
"RTN","SDRRSLCT",149,0)
WRAP(X,LINE) ;
"RTN","SDRRSLCT",150,0)
 N I,Y
"RTN","SDRRSLCT",151,0)
 K LINE
"RTN","SDRRSLCT",152,0)
 S I=0
"RTN","SDRRSLCT",153,0)
 F  S Y=$L($E(X,1,IOM-20)," ") D  Q:X=""
"RTN","SDRRSLCT",154,0)
 . S I=I+1
"RTN","SDRRSLCT",155,0)
 . S LINE(I)=$P(X," ",1,Y)
"RTN","SDRRSLCT",156,0)
 . S X=$P(X," ",Y+1,$L(X," "))
"RTN","SDRRSLCT",157,0)
 . Q
"RTN","SDRRSLCT",158,0)
 Q
"RTN","SDRRSLCT",159,0)
 ;
"RTN","SDRRSLCT",160,0)
PAUSE() ;
"RTN","SDRRSLCT",161,0)
 N DIR,DIROUT,DIRUT,DTOUT,DUOUT,X,Y
"RTN","SDRRSLCT",162,0)
 S DIR(0)="E"
"RTN","SDRRSLCT",163,0)
 D ^DIR
"RTN","SDRRSLCT",164,0)
 Q $S(''$G(Y):0,1:1)
"RTN","SDRRSLCT",165,0)
 ;
"RTN","SDRRSLCT",166,0)
CHFLD(X) ;
"RTN","SDRRSLCT",167,0)
 N A
"RTN","SDRRSLCT",168,0)
 S A=$$GET1^DID(X,.01,"","SPECIFIER")
"RTN","SDRRSLCT",169,0)
 I A["P" D
"RTN","SDRRSLCT",170,0)
 . F  D  Q:A'["P"
"RTN","SDRRSLCT",171,0)
 .. S A=$TR(A,$TR(A,".0123456789"))
"RTN","SDRRSLCT",172,0)
 .. S A=$$CHFLD(A)
"RTN","SDRRSLCT",173,0)
 .. Q
"RTN","SDRRSLCT",174,0)
 . Q
"RTN","SDRRSLCT",175,0)
 Q A
"RTN","SDRRSLCT",176,0)
 ;
"RTN","SDRRSLCT",177,0)
SEL(SDRRD0,SDRRDFNUM,SDRRDDSEL,SDRRDFLD) ;
"RTN","SDRRSLCT",178,0)
 N %DT,SDRRDPNTR,SDRRDXTRN,DA,DIC,DIQ,DR,X,Y
"RTN","SDRRSLCT",179,0)
 S SDRRDFLD=$S($G(SDRRDFLD)]"":SDRRDFLD,1:.01)
"RTN","SDRRSLCT",180,0)
 S (SDRRDPNTR,DA)=SDRRD0
"RTN","SDRRSLCT",181,0)
 S DIC=SDRRDFNUM,DIQ(0)="E",DIQ="SDRRDXTRN(",DR=SDRRDFLD
"RTN","SDRRSLCT",182,0)
 D EN^DIQ1
"RTN","SDRRSLCT",183,0)
 S SDRRDXTRN=$G(SDRRDXTRN(SDRRDFNUM,SDRRDPNTR,SDRRDFLD,"E"))
"RTN","SDRRSLCT",184,0)
 I $$CHFLD(SDRRDFNUM)["D" S X=SDRRDXTRN,%DT="ST" D ^%DT S SDRRDXTRN=Y
"RTN","SDRRSLCT",185,0)
 S X=$D(@SDRRDROOT@(SDRRDXTRN,SDRRDPNTR))
"RTN","SDRRSLCT",186,0)
 Q $S(X#2&SDRRDDSEL:1,X[0&'SDRRDDSEL:1,1:0)
"RTN","SDRRSLCT",187,0)
 ;
"RTN","SDRRSLCT",188,0)
FLD(SDRRDFNUM,SDRRDFLD) ; Validate if field can be sorted on i.e, if 
"RTN","SDRRSLCT",189,0)
 ; non-multiple and is either a pointer, free text, set of codes,
"RTN","SDRRSLCT",190,0)
 ; numeric or a date/time field.
"RTN","SDRRSLCT",191,0)
 ; SDRRDFNUM = File #
"RTN","SDRRSLCT",192,0)
 ; SDRRDFLD  = Field #
"RTN","SDRRSLCT",193,0)
 ; returns SDRRDPASS: 0 if valid, else 1
"RTN","SDRRSLCT",194,0)
 N SDRRD,SDRRDPASS,I
"RTN","SDRRSLCT",195,0)
 I SDRRDFLD=.01 Q 1 ; .01 field is not valid!
"RTN","SDRRSLCT",196,0)
 I $$VFIELD^DILFD(SDRRDFNUM,SDRRDFLD)'>0 Q 1 ; field does not exist
"RTN","SDRRSLCT",197,0)
 S SDRRD(2)=$$GET1^DID(SDRRDFNUM,SDRRDFLD,"","SPECIFIER")
"RTN","SDRRSLCT",198,0)
 S SDRRD(4)=$$GET1^DID(SDRRDFNUM,SDRRDFLD,"","GLOBAL SUBSCRIPT LOCATION")
"RTN","SDRRSLCT",199,0)
 I +SDRRD(2)>0&($$VFIELD^DILFD(+SDRRD(2),.01)>0) Q 1 ; mult field not valid
"RTN","SDRRSLCT",200,0)
 I $P(SDRRD(4),";")'=0 Q 1 ; field not on the 0 node not valid
"RTN","SDRRSLCT",201,0)
 S SDRRDPASS=1 ; set initially to not valid
"RTN","SDRRSLCT",202,0)
 F I="D","F","N","P","S" S:SDRRD(2)[I SDRRDPASS=0 Q:'SDRRDPASS
"RTN","SDRRSLCT",203,0)
 Q SDRRDPASS
"RTN","SDRRSLCT",204,0)
 ;
"RTN","SDRRSLCT",205,0)
FLDSRT(SDRRDFNUM,SDRRDFLD,SDRRDINTR) ; Converts internal to external value
"RTN","SDRRSLCT",206,0)
 ; for sets of codes & pointers.
"RTN","SDRRSLCT",207,0)
 ; SDRRDFNUM = File #
"RTN","SDRRSLCT",208,0)
 ; SDRRDFLD  = Field #
"RTN","SDRRSLCT",209,0)
 ; SDRRDPIEC = piece position on 0 node
"RTN","SDRRSLCT",210,0)
 N SDRRDPIEC
"RTN","SDRRSLCT",211,0)
 S SDRRDPIEC=$$GET1^DID(SDRRDFNUM,SDRRDFLD,"","GLOBAL SUBSCRIPT LOCATION")
"RTN","SDRRSLCT",212,0)
 S SDRRDPIEC=$P(SDRRDPIEC,";",2)
"RTN","SDRRSLCT",213,0)
 Q $$EXTERNAL^DILFD(SDRRDFNUM,SDRRDFLD,"",$P(SDRRDINTR,U,SDRRDPIEC))
"RTN","SDRRSLCT",214,0)
 ;
"RTN","SDRRSLCT",215,0)
SETDIC(SDRRDDIC,DIC,DO) ;
"RTN","SDRRSLCT",216,0)
 N I K DIC,DO
"RTN","SDRRSLCT",217,0)
 S DIC=SDRRDDIC
"RTN","SDRRSLCT",218,0)
 D DO^DIC1
"RTN","SDRRSLCT",219,0)
 F I="0","A","B","S","W" I $G(SDRRDDIC(I))]"" S DIC(I)=SDRRDDIC(I)
"RTN","SDRRSLCT",220,0)
 Q
"RTN","SDRRSLCT",221,0)
 ;
"RTN","SDRRSLCT",222,0)
FILEATTR(DIC,DIC0,SDRRDFNUM,SDRRDFNAM,SDRRDFL01,SDRRDFSCR) ;
"RTN","SDRRSLCT",223,0)
 N DO
"RTN","SDRRSLCT",224,0)
 S DIC(0)=DIC0
"RTN","SDRRSLCT",225,0)
 D DO^DIC1
"RTN","SDRRSLCT",226,0)
 S SDRRDFNUM=+DO(2)
"RTN","SDRRSLCT",227,0)
 S SDRRDFNAM=$P(DO,U)
"RTN","SDRRSLCT",228,0)
 S SDRRDFL01=$$GET1^DID(SDRRDFNUM,.01,"","LABEL")
"RTN","SDRRSLCT",229,0)
 S SDRRDFSCR=$G(DO("SCR"))
"RTN","SDRRSLCT",230,0)
 Q
"RTN","SDRRSLCT",231,0)
 ;
"RTN","SDRRSLCT",232,0)
PLURAL(SDRRDFL01) ;
"RTN","SDRRSLCT",233,0)
 Q $S($E(SDRRDFL01,($L(SDRRDFL01)))?1L:"s",1:"S")
"RTN","SDRRTSK")
0^28^B13148697
"RTN","SDRRTSK",1,0)
SDRRTSK ;10N20/MAH;Recall Reminder-Clinic Print Task; 01/15/2008
"RTN","SDRRTSK",2,0)
 ;;5.3;Scheduling;**536**;Aug 13, 1993;Build 53
"RTN","SDRRTSK",3,0)
 ;THIS ROUTINE WILL PRINT LETTER FOR SELECTED METHOD OF PRINTING
"RTN","SDRRTSK",4,0)
 ;WILL LOOK AT CLINIC RECALL LOCATION
"RTN","SDRRTSK",5,0)
DATE ;lOOKS TO SEE HOW MANY DAYS IN ADVANCE TO PRINT LETTER
"RTN","SDRRTSK",6,0)
 Q:'$D(^SD(403.53,0))
"RTN","SDRRTSK",7,0)
 S CRP=0
"RTN","SDRRTSK",8,0)
 F  S CRP=$O(^SD(403.53,CRP)) Q:'CRP  D
"RTN","SDRRTSK",9,0)
 .S TYPE=$P($G(^SD(403.53,CRP,0)),"^",2)
"RTN","SDRRTSK",10,0)
 .Q:TYPE["C"
"RTN","SDRRTSK",11,0)
 .S DATE=$P($G(^SD(403.53,CRP,0)),"^",4) Q:DATE=""   ;IF NOT SET ROUTINE WILL QUIT
"RTN","SDRRTSK",12,0)
 .S X="T+"_DATE D ^%DT S (ZSDT,ZEDT)=Y K Y
"RTN","SDRRTSK",13,0)
 .S (PRT,TEAM)=0
"RTN","SDRRTSK",14,0)
 .F  S TEAM=$O(^SD(403.55,"C",CRP,TEAM)) Q:TEAM=""  S PRT=$P($G(^SD(403.55,TEAM,0)),"^",3) D
"RTN","SDRRTSK",15,0)
 ..Q:PRT=""
"RTN","SDRRTSK",16,0)
 ..S DA=PRT
"RTN","SDRRTSK",17,0)
 ..S DIC="^%ZIS(1,",DR=".01;1;3",DIQ="DPTR",DIQ(0)="I" D EN^DIQ1
"RTN","SDRRTSK",18,0)
 ..N IOP S IOP=$G(DPTR("3.5",DA,".01","I")) D ^%ZIS
"RTN","SDRRTSK",19,0)
 ..S PROV=0 F  S PROV=$O(^SD(403.54,"C",TEAM,PROV)) Q:PROV=""  D
"RTN","SDRRTSK",20,0)
 ...S (MESSAGE,D0,LETTER)=0 F  S D0=$O(^SD(403.5,"C",PROV,D0)) Q:D0=""  S (CLINIC,FAIL)=0 S CLINIC=$P($G(^SD(403.5,D0,0)),"^",2) D
"RTN","SDRRTSK",21,0)
 ....S DTA=$G(^SD(403.5,D0,0))
"RTN","SDRRTSK",22,0)
 ....I CLINIC="" S MESSAGE="***NO CLINIC ON FILE**"
"RTN","SDRRTSK",23,0)
 ....I CLINIC'=""  I '$D(^SD(403.52,"B",CLINIC)) S MESSAGE="***NO CLINIC LETTER ON FILE**" S FAIL=1
"RTN","SDRRTSK",24,0)
 ....I CLINIC'="",(FAIL=0) S ZDIV=CLINIC S LETTER=0,LETTER=$O(^SD(403.52,"B",CLINIC,LETTER))
"RTN","SDRRTSK",25,0)
 ....S TIME=""
"RTN","SDRRTSK",26,0)
 ....I $P(^SD(403.5,D0,0),"^",9)>45 S TIME=$P(^SD(403.5,D0,0),"^",9) S TIME="**"_TIME_"**"
"RTN","SDRRTSK",27,0)
 ....S LAB=$S($P($G(^SD(403.5,D0,0)),"^",8)="f":"Lab test(s) have been ordered that require you to FAST",$P(^SD(403.5,D0,0),"^",8)="n":"Lab test(s) have been ordered,which need to be done before an appointment is made",1:"")
"RTN","SDRRTSK",28,0)
 ....S DFN=+DTA
"RTN","SDRRTSK",29,0)
 ....Q:$P(DTA,U,6)<ZSDT!($P(DTA,U,6)>ZEDT)
"RTN","SDRRTSK",30,0)
 ....Q:$$TESTPAT^VADPT(DFN)
"RTN","SDRRTSK",31,0)
 ....D ADD^VADPT,DEM^VADPT
"RTN","SDRRTSK",32,0)
 ....S STATE=$P(VAPA(5),"^",1),STATE=$$GET1^DIQ(5,STATE_",",1)
"RTN","SDRRTSK",33,0)
 ....S PN=$P(VADM(1),U)
"RTN","SDRRTSK",34,0)
 ....I $G(VADM(6),U)'="" Q
"RTN","SDRRTSK",35,0)
 ....N CHECK
"RTN","SDRRTSK",36,0)
 ....I $$BADADR^DGUTL3(DFN) S CHECK=1 S XMSUB="Bad Address for Recall Reminder Patient",XMTEXT="SDRR(" D
"RTN","SDRRTSK",37,0)
 .....S XMY("G.SDRR BAD ADDRESS")="",XMDUZ=.5
"RTN","SDRRTSK",38,0)
 .....S SDRR(1)="Bad Address- card will not be printed for:"_"   "_PN_"   "_VA("BID")
"RTN","SDRRTSK",39,0)
 .....D ^XMD
"RTN","SDRRTSK",40,0)
 .....K XMY,XMSUB,XMTEXT,XMDUZ
"RTN","SDRRTSK",41,0)
 .....Q
"RTN","SDRRTSK",42,0)
 ....;ADDED THE DATE INFORMATION
"RTN","SDRRTSK",43,0)
 ....I '$D(CHECK) S $P(^SD(403.5,D0,0),"^",10)=DT   ;NEW CODE
"RTN","SDRRTSK",44,0)
 ....Q:$D(CHECK)
"RTN","SDRRTSK",45,0)
 ....U IO
"RTN","SDRRTSK",46,0)
 ....W @IOF F L=1:1:11 W !
"RTN","SDRRTSK",47,0)
 ....W !?20,$P(PN,",",2)," ",$P(PN,",")
"RTN","SDRRTSK",48,0)
 ....I $P(VAPA(1),U)'="" W !?20,$P(VAPA(1),U)
"RTN","SDRRTSK",49,0)
 ....I $P(VAPA(2),U)'="" W !?20,$P(VAPA(2),U)
"RTN","SDRRTSK",50,0)
 ....I $P(VAPA(3),U)'="" W !?20,$P(VAPA(3),U)
"RTN","SDRRTSK",51,0)
 ....W !?20,$P(VAPA(4),U),", "_STATE_"  ",$P(VAPA(6),U)
"RTN","SDRRTSK",52,0)
 ....I LETTER=0 W !!!!!,?25,MESSAGE
"RTN","SDRRTSK",53,0)
 ....I TIME'="" W !!!!?2,"**"_TIME
"RTN","SDRRTSK",54,0)
 ....I LAB'="" W !!!!!,?2,"*"_LAB
"RTN","SDRRTSK",55,0)
 ....W !!!
"RTN","SDRRTSK",56,0)
 ....S:'$D(MESSAGE) LETTER=$O(^SD(403.52,"B",CLINIC,LETTER))
"RTN","SDRRTSK",57,0)
 ....I LETTER>0 S LINE=0 F  S LINE=$O(^SD(403.52,LETTER,1,LINE)) Q:'LINE  W !,?2,$P(^SD(403.52,LETTER,1,LINE,0),"^",1)
"RTN","SDRRTSK",58,0)
 ..D ^%ZISC
"RTN","SDRRTSK",59,0)
 K DPTR,DEVSB,DEVSB1,DIQ,DEVSB1,DA,DA1,DR
"RTN","SDRRTSK",60,0)
 K MESSAGE,LETTER
"RTN","SDRRTSK",61,0)
QUIT K DEV,PRT,ADTA,D0,DFN,DIC,DIR,DIRUT,DTA,I,L,PN,POP,Y,ZDIV,ZEDT,ZPR,ZSDT,FAST,TIME,ACC,LAB,STATE
"RTN","SDRRTSK",62,0)
 K LINE,LETTER,MESSAGE,TEST,CLINIC,DA,DATE,DEV1,DEVSB,DOD,FAIL,PROV,TEAM,X,PROV,TEAM,CRP,DATE,TYPE,SDRR,DPT,VA
"RTN","SDRRTSK",63,0)
 D KVAR^VADPT
"RTN","SDRRTSK",64,0)
 Q
"RTN","SDRRTSK1")
0^29^B7882942
"RTN","SDRRTSK1",1,0)
SDRRTSK1 ;10N20/MAH;Recall Reminder-Clinic Print Task; 09/20/2004
"RTN","SDRRTSK1",2,0)
 ;;5.3;Scheduling;**536**;Aug 13, 1993;Build 53
"RTN","SDRRTSK1",3,0)
 ;;This routine is called from SDRR TASK JOB CARD
"RTN","SDRRTSK1",4,0)
 ;;and will be called if PARAM IS cards
"RTN","SDRRTSK1",5,0)
START Q:'$D(^SD(403.53,0))
"RTN","SDRRTSK1",6,0)
 S CRP=0
"RTN","SDRRTSK1",7,0)
 F  S CRP=$O(^SD(403.53,CRP)) Q:'CRP  D
"RTN","SDRRTSK1",8,0)
 .S TYPE=$P($G(^SD(403.53,CRP,0)),"^",2)
"RTN","SDRRTSK1",9,0)
 .Q:TYPE["L"
"RTN","SDRRTSK1",10,0)
 .S DATE=$P($G(^SD(403.53,CRP,0)),"^",4) Q:DATE=""  ;IF NOT SET ROUTINE WILL QUIT
"RTN","SDRRTSK1",11,0)
 .S X="T+"_DATE D ^%DT S (ZSDT,ZEDT)=Y K Y
"RTN","SDRRTSK1",12,0)
 .S (PRT,TEAM)=0
"RTN","SDRRTSK1",13,0)
 .F  S TEAM=$O(^SD(403.55,"C",CRP,TEAM)) Q:TEAM=""  S PRT=$P($G(^SD(403.55,TEAM,0)),"^",3) D
"RTN","SDRRTSK1",14,0)
 ..Q:PRT=""
"RTN","SDRRTSK1",15,0)
 ..S DA=PRT
"RTN","SDRRTSK1",16,0)
 ..S DIC="^%ZIS(1,",DR=".01;1;3",DIQ="DPTR",DIQ(0)="I" D EN^DIQ1
"RTN","SDRRTSK1",17,0)
 ..N IOP S IOP=$G(DPTR("3.5",DA,".01","I")) D ^%ZIS
"RTN","SDRRTSK1",18,0)
 ..S PROV=0 F  S PROV=$O(^SD(403.54,"C",TEAM,PROV)) Q:PROV=""  D
"RTN","SDRRTSK1",19,0)
 ...S D0=0 F  S D0=$O(^SD(403.5,"C",PROV,D0)) Q:D0=""  D
"RTN","SDRRTSK1",20,0)
 ....S DTA=$G(^SD(403.5,D0,0))
"RTN","SDRRTSK1",21,0)
 ....S TIME=""
"RTN","SDRRTSK1",22,0)
 ....I $P(^SD(403.5,D0,0),"^",9)>45 S TIME=$P(^SD(403.5,D0,0),"^",9) S TIME="**"_TIME_"**"
"RTN","SDRRTSK1",23,0)
 ....S LAB=$S($P($G(^SD(403.5,D0,0)),"^",8)="f":"**FL",$P(^SD(403.5,D0,0),"^",8)="n":"**NFL",1:"")
"RTN","SDRRTSK1",24,0)
 ....S DFN=+DTA
"RTN","SDRRTSK1",25,0)
 ....Q:$P(DTA,U,6)<ZSDT!($P(DTA,U,6)>ZEDT)
"RTN","SDRRTSK1",26,0)
 ....Q:$$TESTPAT^VADPT(DFN)
"RTN","SDRRTSK1",27,0)
 ....D ADD^VADPT,DEM^VADPT
"RTN","SDRRTSK1",28,0)
 ....S STATE=$P(VAPA(5),"^",1),STATE=$$GET1^DIQ(5,STATE_",",1)
"RTN","SDRRTSK1",29,0)
 ....S PN=$P(VADM(1),U)
"RTN","SDRRTSK1",30,0)
 ....I $G(VADM(6),U)'="" Q
"RTN","SDRRTSK1",31,0)
 ....N CHECK
"RTN","SDRRTSK1",32,0)
 ....I $$BADADR^DGUTL3(DFN) S CHECK=1 S XMSUB="Bad Address for Recall Reminder Patient",XMTEXT="SDRR(" D
"RTN","SDRRTSK1",33,0)
 .....S XMY("G.SDRR BAD ADDRESS")="",XMDUZ=.5
"RTN","SDRRTSK1",34,0)
 .....S SDRR(1)="Bad Address- card will not be printed for:"_"   "_PN_"   "_VA("BID")
"RTN","SDRRTSK1",35,0)
 .....D ^XMD
"RTN","SDRRTSK1",36,0)
 .....K XMY,XMSUB,XMTEXT,XMDUZ
"RTN","SDRRTSK1",37,0)
 .....Q
"RTN","SDRRTSK1",38,0)
 .....;ADDED THE DATE INFORMATION
"RTN","SDRRTSK1",39,0)
 ....I '$D(CHECK) S $P(^SD(403.5,D0,0),"^",10)=DT
"RTN","SDRRTSK1",40,0)
 ....Q:$D(CHECK)
"RTN","SDRRTSK1",41,0)
 ....U IO
"RTN","SDRRTSK1",42,0)
 ....W @IOF F L=1:1:7 W !
"RTN","SDRRTSK1",43,0)
 ....W !?20,$P(PN,",",2)," ",$P(PN,",")
"RTN","SDRRTSK1",44,0)
 ....I $P(VAPA(1),U)'="" W !?20,$P(VAPA(1),U)
"RTN","SDRRTSK1",45,0)
 ....I $P(VAPA(2),U)'="" W !?20,$P(VAPA(2),U)
"RTN","SDRRTSK1",46,0)
 ....I $P(VAPA(3),U)'="" W !?20,$P(VAPA(3),U)
"RTN","SDRRTSK1",47,0)
 ....W !?20,$P(VAPA(4),U),", "_STATE_"  ",$P(VAPA(6),U)
"RTN","SDRRTSK1",48,0)
 ....I TIME'="" W !!?45,TIME
"RTN","SDRRTSK1",49,0)
 ....I LAB'="" W !,?45,LAB
"RTN","SDRRTSK1",50,0)
 ..D ^%ZISC
"RTN","SDRRTSK1",51,0)
 K DPTR,DEVSB,DEVSB1,DIQ,DEVSB1,DA,DA1,DR
"RTN","SDRRTSK1",52,0)
QUIT K DEV,PRT,ADTA,D0,DFN,DIC,DIR,DIRUT,DTA,I,L,PN,POP,Y,ZDIV,ZEDT,ZPR,ZSDT,FAST,TIME,ACC,TYPE,PTN,CRP,STATE
"RTN","SDRRTSK1",53,0)
 K LINE,LETTER,MESSAGE,TEST,CLINIC,DA,DATE,DEV1,DEVSB,DOD,FAIL,PROV,TEAM,X,DPT,LAB,SDRR,VA,LAB,DPT,SDRR,VA
"RTN","SDRRTSK1",54,0)
 D KVAR^VADPT
"RTN","SDRRTSK1",55,0)
 Q
"RTN","SDRRUTL")
0^30^B34000828
"RTN","SDRRUTL",1,0)
SDRRUTL ;10N20/MAH;Recall Reminder-Clinic Utilities;01/18/2008  11:32
"RTN","SDRRUTL",2,0)
 ;;5.3;Scheduling;**536**;Aug 13, 1993;Build 53
"RTN","SDRRUTL",3,0)
ASKDIV(SDRRDIV) ;
"RTN","SDRRUTL",4,0)
 N DIC,X,Y,I,DUOUT,DTOUT
"RTN","SDRRUTL",5,0)
 K SDRRDIV
"RTN","SDRRUTL",6,0)
 S SDRRDIV=0
"RTN","SDRRUTL",7,0)
 W !
"RTN","SDRRUTL",8,0)
 S DIC("A")="Select Medical Center Division: All// "
"RTN","SDRRUTL",9,0)
 S DIC="^DG(40.8,"
"RTN","SDRRUTL",10,0)
 S DIC(0)="AEQMN"
"RTN","SDRRUTL",11,0)
 F  D  Q:Y=-1
"RTN","SDRRUTL",12,0)
 . D ^DIC Q:Y=-1
"RTN","SDRRUTL",13,0)
 . S SDRRDIV(+Y)=$P(Y,U,2)
"RTN","SDRRUTL",14,0)
 . S DIC("A")="Another Medical Center Division: "
"RTN","SDRRUTL",15,0)
 Q:$D(DTOUT)!$D(DUOUT)
"RTN","SDRRUTL",16,0)
 S I=0
"RTN","SDRRUTL",17,0)
 I $O(SDRRDIV(0)) D  Q
"RTN","SDRRUTL",18,0)
 . F  S I=$O(SDRRDIV(I)) Q:'I  S SDRRDIV=SDRRDIV+1
"RTN","SDRRUTL",19,0)
 F  S I=$O(^DG(40.8,I)) Q:'I  S SDRRDIV(I)=$P(^(I,0),U),SDRRDIV=SDRRDIV+1
"RTN","SDRRUTL",20,0)
 Q
"RTN","SDRRUTL",21,0)
ASKSTOP(SDRRSC,SDRRST,SDRRND) ;
"RTN","SDRRUTL",22,0)
 N DIC,X,Y,I,DUOUT,DTOUT,SDRRREC
"RTN","SDRRUTL",23,0)
 K SDRRSC
"RTN","SDRRUTL",24,0)
 S SDRRSC=0
"RTN","SDRRUTL",25,0)
 W !
"RTN","SDRRUTL",26,0)
 S DIC("A")="Select Clinic Stop Code: All// "
"RTN","SDRRUTL",27,0)
 S DIC="^DIC(40.7,"
"RTN","SDRRUTL",28,0)
 S:$G(SDRRST) DIC("S")="N SDRRXD S SDRRXD=$P(^(0),U,3) I 'SDRRXD!(SDRRXD'<SDRRST)"
"RTN","SDRRUTL",29,0)
 S DIC(0)="AEQMZ"
"RTN","SDRRUTL",30,0)
 F  D  Q:Y=-1
"RTN","SDRRUTL",31,0)
 . D ^DIC Q:Y=-1
"RTN","SDRRUTL",32,0)
 . S SDRRSC(+Y)=$P(Y(0),U,2)
"RTN","SDRRUTL",33,0)
 . S DIC("A")="Another Clinic Stop Code: "
"RTN","SDRRUTL",34,0)
 Q:$D(DTOUT)!$D(DUOUT)
"RTN","SDRRUTL",35,0)
 S I=0
"RTN","SDRRUTL",36,0)
 I $O(SDRRSC(0)) D  Q
"RTN","SDRRUTL",37,0)
 . F  S I=$O(SDRRSC(I)) Q:'I  S SDRRSC=SDRRSC+1
"RTN","SDRRUTL",38,0)
 F  S I=$O(^DIC(40.7,I)) Q:'I  S SDRRREC=^(I,0) D
"RTN","SDRRUTL",39,0)
 . Q:$P(SDRRREC,U,3)<SDRRST
"RTN","SDRRUTL",40,0)
 . S SDRRSC(I)=$P(SDRRREC,U),SDRRSC=SDRRSC+1
"RTN","SDRRUTL",41,0)
 Q
"RTN","SDRRUTL",42,0)
ASKCLIN(SDRRCLIN,SDRRDIV,SDRRST,SDRRND) ;
"RTN","SDRRUTL",43,0)
 N DIR,X,Y,DIRUT
"RTN","SDRRUTL",44,0)
 K SDRRCLIN
"RTN","SDRRUTL",45,0)
 S SDRRCLIN=0
"RTN","SDRRUTL",46,0)
 W !
"RTN","SDRRUTL",47,0)
 S DIR(0)="Y"
"RTN","SDRRUTL",48,0)
 S DIR("A")="All Clinics"
"RTN","SDRRUTL",49,0)
 S DIR("B")="No"
"RTN","SDRRUTL",50,0)
 D ^DIR Q:$D(DIRUT)
"RTN","SDRRUTL",51,0)
 I Y S SDRRCLIN="ALL" Q
"RTN","SDRRUTL",52,0)
 D ASKRANGE^SDRRUTL1(.SDRRCLIN,.SDRRDIV,.SDRRST,.SDRRND)
"RTN","SDRRUTL",53,0)
 Q
"RTN","SDRRUTL",54,0)
DELIM() ;
"RTN","SDRRUTL",55,0)
 N DIR,X,Y,DIRUT
"RTN","SDRRUTL",56,0)
 S DIR(0)="Y"
"RTN","SDRRUTL",57,0)
 S DIR("A")="Delimited Output"
"RTN","SDRRUTL",58,0)
 S DIR("B")="No"
"RTN","SDRRUTL",59,0)
 D ^DIR Q:$D(DIRUT) -1
"RTN","SDRRUTL",60,0)
 Q Y
"RTN","SDRRUTL",61,0)
REVERSE(SDRRST,SDRRND) ; Given starting and ending dates return reverse starting and ending dates
"RTN","SDRRUTL",62,0)
 N SDRRRST,SDRRRND
"RTN","SDRRUTL",63,0)
 S SDRRRST=9999999-SDRRST+.9999
"RTN","SDRRUTL",64,0)
 S SDRRRND=9999999-SDRRND
"RTN","SDRRUTL",65,0)
 S SDRRST=SDRRRND
"RTN","SDRRUTL",66,0)
 S SDRRND=SDRRRST
"RTN","SDRRUTL",67,0)
 Q
"RTN","SDRRUTL",68,0)
DRANGE(SDRRST,SDRRND,SDRRSTX,SDRRNDX,SDRRABORT,SDRRMIN,SDRRMAX,SDRRFUTR) ;
"RTN","SDRRUTL",69,0)
 ; Set SDRRFUTR=1 if dates in the future are OK.
"RTN","SDRRUTL",70,0)
 N DIR,DIRUT,X,Y
"RTN","SDRRUTL",71,0)
 I $G(SDRRFUTR) S DIR(0)="D^"_$G(SDRRMIN)_":"_$G(SDRRMAX)_":AEFX"
"RTN","SDRRUTL",72,0)
 E  S DIR(0)="D^"_$G(SDRRMIN)_":"_$G(SDRRMAX,DT)_":AEPX"
"RTN","SDRRUTL",73,0)
 S DIR("A")="Enter start date"
"RTN","SDRRUTL",74,0)
 I $D(SDRRST) D
"RTN","SDRRUTL",75,0)
 . S SDRRSTX=$$FMTE^XLFDT(SDRRST,5)
"RTN","SDRRUTL",76,0)
 . S DIR("B")=SDRRSTX
"RTN","SDRRUTL",77,0)
 D ^DIR I $D(DIRUT) S SDRRABORT=1 Q
"RTN","SDRRUTL",78,0)
 S SDRRST=Y
"RTN","SDRRUTL",79,0)
 K DIR
"RTN","SDRRUTL",80,0)
 I $G(SDRRFUTR) S DIR(0)="D^"_SDRRST_":"_$G(SDRRMAX)_":AEFX"
"RTN","SDRRUTL",81,0)
 E  S DIR(0)="D^"_SDRRST_":"_$G(SDRRMAX,DT)_":AEPX"
"RTN","SDRRUTL",82,0)
 S DIR("A")="Enter end date"
"RTN","SDRRUTL",83,0)
 I $D(SDRRND) D
"RTN","SDRRUTL",84,0)
 . S SDRRNDX=$$FMTE^XLFDT(SDRRND,5)
"RTN","SDRRUTL",85,0)
 . S DIR("B")=SDRRNDX
"RTN","SDRRUTL",86,0)
 D ^DIR I $D(DIRUT) S SDRRABORT=1 Q
"RTN","SDRRUTL",87,0)
 S SDRRND=Y
"RTN","SDRRUTL",88,0)
 S SDRRNDX=$$FMTE^XLFDT(SDRRND,2)
"RTN","SDRRUTL",89,0)
 S SDRRSTX=$$FMTE^XLFDT(SDRRST,2)
"RTN","SDRRUTL",90,0)
 Q
"RTN","SDRRUTL",91,0)
ASKDATE(SDRRST,SDRRSTX,SDRRABORT,SDRRMIN,SDRRMAX,SDRRFUTR) ;
"RTN","SDRRUTL",92,0)
 N DIR,DIRUT,X,Y
"RTN","SDRRUTL",93,0)
 I $G(SDRRFUTR) S DIR(0)="D^"_$G(SDRRMIN)_":"_$G(SDRRMAX)_":AEFX"
"RTN","SDRRUTL",94,0)
 E  S DIR(0)="D^"_$G(SDRRMIN)_":"_$G(SDRRMAX,DT)_":AEPX"
"RTN","SDRRUTL",95,0)
 S DIR("A")="Enter start date"
"RTN","SDRRUTL",96,0)
 I $D(SDRRST) D
"RTN","SDRRUTL",97,0)
 . S SDRRSTX=$$FMTE^XLFDT(SDRRST,2)
"RTN","SDRRUTL",98,0)
 . S DIR("B")=SDRRSTX
"RTN","SDRRUTL",99,0)
 D ^DIR I $D(DIRUT) S SDRRABORT=1 Q
"RTN","SDRRUTL",100,0)
 S SDRRST=Y
"RTN","SDRRUTL",101,0)
 S SDRRSTX=$$FMTE^XLFDT(SDRRST,2)
"RTN","SDRRUTL",102,0)
 Q
"RTN","SDRRUTL",103,0)
FYRANGE(SDRRST,SDRRND,SDRRSTX,SDRRNDX,SDRRABORT,SDRRMIN,SDRRMAX) ;
"RTN","SDRRUTL",104,0)
 N SDRRMAXFY,SDRRFRFY,SDRRTOFY
"RTN","SDRRUTL",105,0)
 S (SDRRMAXFY,SDRRTOFY)=$$FY($$FMADD^XLFDT($E(DT,1,5)_"01",-1)) ; FY of last month
"RTN","SDRRUTL",106,0)
 S SDRRFRFY=$$ASKFY($G(SDRRMIN),$G(SDRRMAX),,"From")
"RTN","SDRRUTL",107,0)
 I SDRRFRFY=0 S SDRRABORT=1 Q
"RTN","SDRRUTL",108,0)
 I SDRRFRFY'=SDRRMAXFY D  Q:SDRRABORT
"RTN","SDRRUTL",109,0)
 . S SDRRTOFY=$$ASKFY($P(SDRRFRFY,U,3),$G(SDRRMAX),+$P(SDRRMAXFY," ",2),"Through")
"RTN","SDRRUTL",110,0)
 . I SDRRTOFY=0 S SDRRABORT=1
"RTN","SDRRUTL",111,0)
 S SDRRST=$P(SDRRFRFY,U,2)
"RTN","SDRRUTL",112,0)
 S SDRRND=$P(SDRRTOFY,U,3)
"RTN","SDRRUTL",113,0)
 S SDRRSTX=$$FMTE^XLFDT($E(SDRRST,1,5)_"01",2)
"RTN","SDRRUTL",114,0)
 S SDRRNDX=$$FMTE^XLFDT($$FMADD^XLFDT($E(SDRRND,1,5)_"01",-1),2)
"RTN","SDRRUTL",115,0)
 S SDRRSTX("FY")=$P(SDRRFRFY,U)
"RTN","SDRRUTL",116,0)
 S SDRRNDX("FY")=$P(SDRRTOFY,U)
"RTN","SDRRUTL",117,0)
 Q
"RTN","SDRRUTL",118,0)
ASKFY(SDRRMIN,SDRRMAX,SDRRDEF,SDRRPRMPT) ; Function asks user which FY.
"RTN","SDRRUTL",119,0)
 N DIR,X,Y,DIRUT,SDRRFY
"RTN","SDRRUTL",120,0)
 S DIR("A")=$G(SDRRPRMPT,"Select")_" FY ("
"RTN","SDRRUTL",121,0)
 I '$G(SDRRMAX) D
"RTN","SDRRUTL",122,0)
 . S SDRRMAX=$$FMADD^XLFDT($E(DT,1,5)_"01",-1) ; last month
"RTN","SDRRUTL",123,0)
 . S SDRRMAX=$E($P($$FY(SDRRMAX),U,3),1,3)_"0000"
"RTN","SDRRUTL",124,0)
 I $G(SDRRMIN) S DIR("A")=DIR("A")_($E(SDRRMIN,1,3)+1700)_" "
"RTN","SDRRUTL",125,0)
 S DIR("A")=DIR("A")_"through "_($E(SDRRMAX,1,3)+1700)_"): "
"RTN","SDRRUTL",126,0)
 S DIR(0)="DA^"_$G(SDRRMIN)_":"_SDRRMAX_":AEM"
"RTN","SDRRUTL",127,0)
 S DIR("B")=$$FMTE^XLFDT($G(SDRRDEF,SDRRMAX))
"RTN","SDRRUTL",128,0)
 D ^DIR I $D(DIRUT) Q 0
"RTN","SDRRUTL",129,0)
 S SDRRFY=$$FY(Y)
"RTN","SDRRUTL",130,0)
 W "     ",$P(SDRRFY,U)
"RTN","SDRRUTL",131,0)
 Q SDRRFY
"RTN","SDRRUTL",132,0)
FY(SDRRDT) ; Pass in a date (default = today's date),
"RTN","SDRRUTL",133,0)
 ; and this function returns what FY we are in,
"RTN","SDRRUTL",134,0)
 ; followed by the FY start date and FY end date.
"RTN","SDRRUTL",135,0)
 ; ie. S X=$$FY^SDRRUTL(3050208) results in X="FY 2005^3041000^3051000"
"RTN","SDRRUTL",136,0)
 N SDRRST,SDRRND
"RTN","SDRRUTL",137,0)
 S:'$D(SDRRDT) SDRRDT=DT
"RTN","SDRRUTL",138,0)
 S SDRRST=$E(SDRRDT,1,3)-($E(SDRRDT,4,5)<10)_"1000"
"RTN","SDRRUTL",139,0)
 S SDRRND=$E(SDRRST,1,3)+1_"1000"
"RTN","SDRRUTL",140,0)
 Q "FY "_(1701+$E(SDRRST,1,3))_U_SDRRST_U_SDRRND
"RTN","SDRRUTL",141,0)
ASKMON(SDRRMON) ; Function asks user which month.
"RTN","SDRRUTL",142,0)
 ; SDRRMON - (optional) default month
"RTN","SDRRUTL",143,0)
 N DIR,X,Y,DIRUT,SDRRDT
"RTN","SDRRUTL",144,0)
 S DIR("A")="Select Month"
"RTN","SDRRUTL",145,0)
 I $D(SDRRMON) S SDRRDT=SDRRMON
"RTN","SDRRUTL",146,0)
 E  D
"RTN","SDRRUTL",147,0)
 . S SDRRDT=$$FMADD^XLFDT($E(DT,1,5)_"01",-1) ; last month
"RTN","SDRRUTL",148,0)
 . S SDRRDT=$E(SDRRDT,1,5)_"00"
"RTN","SDRRUTL",149,0)
 S DIR(0)="D^:"_SDRRDT_":AEM"
"RTN","SDRRUTL",150,0)
 S DIR("B")=$$FMTE^XLFDT(SDRRDT)
"RTN","SDRRUTL",151,0)
 D ^DIR I $D(DIRUT) Q 0
"RTN","SDRRUTL",152,0)
 Q Y
"RTN","SDRRUTL",153,0)
MON(SDRRDT) ; Pass in a date (default = today's date),
"RTN","SDRRUTL",154,0)
 ; and this function returns the first and last dates of the month.
"RTN","SDRRUTL",155,0)
 N SDRRMST,SDRRMND
"RTN","SDRRUTL",156,0)
 S:'$D(SDRRDT) SDRRDT=DT
"RTN","SDRRUTL",157,0)
 S SDRRMST=$E(SDRRDT,1,5)_"01"
"RTN","SDRRUTL",158,0)
 S SDRRMND=$$SCH^XLFDT("1M(1)",SDRRMST)\1
"RTN","SDRRUTL",159,0)
 Q SDRRMST_U_SDRRMND
"RTN","SDRRUTL",160,0)
BDAY ;
"RTN","SDRRUTL",161,0)
 N GDAYS,JDAYS,YR1DAYS
"RTN","SDRRUTL",162,0)
 S GDAYS=$$FMDIFF^XLFDT(3050830,3050628) W !,"GDAYS=",GDAYS
"RTN","SDRRUTL",163,0)
 S JDAYS=$$FMDIFF^XLFDT(3050830,3050811) W !,"JDAYS=",JDAYS
"RTN","SDRRUTL",164,0)
 S YR1DAYS=365-GDAYS-JDAYS W !,"YR1DAYS=",YR1DAYS
"RTN","SDRRUTL",165,0)
 W !,"99th Birthday= ",$$FMADD^XLFDT(3050830,YR1DAYS\4)
"RTN","SDRRUTL",166,0)
 W !,"100th Birthday=",$$FMADD^XLFDT(3050830,(YR1DAYS+365)\4)
"RTN","SDRRUTL",167,0)
 W !,"101st Birthday=",$$FMADD^XLFDT(3050830,YR1DAYS+730\4)
"RTN","SDRRUTL",168,0)
 Q
"RTN","SDRRUTL1")
0^31^B26580492
"RTN","SDRRUTL1",1,0)
SDRRUTL1 ;10N20/MAH;Recall Reminder-Clinic Utilities ;07/13/06  11:32
"RTN","SDRRUTL1",2,0)
 ;;5.3;Scheduling;**536**;Aug 13, 1993;Build 53
"RTN","SDRRUTL1",3,0)
ASKCLIN(SDRRDIV,SDRRST,SDRRND) ;
"RTN","SDRRUTL1",4,0)
 N DIR,X,Y,DIRUT,SDRRABORT
"RTN","SDRRUTL1",5,0)
 W !!,"Now you'll select the clinics."
"RTN","SDRRUTL1",6,0)
 S DIR(0)="SO^R:Range of Clinics;I:Individual Clinics;S:Stop Codes"
"RTN","SDRRUTL1",7,0)
 S DIR("A")="Select Clinics by"
"RTN","SDRRUTL1",8,0)
 S DIR("?",1)="Choose 'Range of Clinics' if you want to select a group of clinics in"
"RTN","SDRRUTL1",9,0)
 S DIR("?",2)="consecutive name order.  You'll be asked for the starting clinic and the"
"RTN","SDRRUTL1",10,0)
 S DIR("?",3)="ending clinic.  All the clinics in that range will be selected for you."
"RTN","SDRRUTL1",11,0)
 S DIR("?",4)=""
"RTN","SDRRUTL1",12,0)
 S DIR("?",5)="Choose 'Individual Clinics' if you want to select clinics individually."
"RTN","SDRRUTL1",13,0)
 S DIR("?",6)="You'll be able to use ranges here, too, as well as wild cards.  You'll"
"RTN","SDRRUTL1",14,0)
 S DIR("?",7)="even be able to de-select clinics."
"RTN","SDRRUTL1",15,0)
 S DIR("?",8)=""
"RTN","SDRRUTL1",16,0)
 S DIR("?",9)="Choose 'Stop Codes' if you want to select Stop Codes.  All clinics whose"
"RTN","SDRRUTL1",17,0)
 S DIR("?",10)="Stop Codes or Credit Stops match the ones you've chosen will be selected"
"RTN","SDRRUTL1",18,0)
 S DIR("?")="for you."
"RTN","SDRRUTL1",19,0)
 D ^DIR I $D(DIRUT) S SDRRABORT=1 Q
"RTN","SDRRUTL1",20,0)
 D @Y
"RTN","SDRRUTL1",21,0)
 Q
"RTN","SDRRUTL1",22,0)
STOPCODE(SDRRI) ; Return a clinic stop code
"RTN","SDRRUTL1",23,0)
 Q $S('SDRRI:SDRRI,1:$P($G(^DIC(40.7,SDRRI,0)),U,2))
"RTN","SDRRUTL1",24,0)
I ; Select individual clinics
"RTN","SDRRUTL1",25,0)
 N SDRRDIC,SDRRNAME,SDRRIEN,SDRRREC
"RTN","SDRRUTL1",26,0)
 W !!,"You'll be able to use ranges and wild cards to select clinics."
"RTN","SDRRUTL1",27,0)
 W !,"You'll even be able to deselect clinics."
"RTN","SDRRUTL1",28,0)
 W !,"Enter '?' at the prompt to see how."
"RTN","SDRRUTL1",29,0)
 S SDRRDIC=44
"RTN","SDRRUTL1",30,0)
 S SDRRDIC(0)="AEMNQZ"
"RTN","SDRRUTL1",31,0)
 S SDRRDIC("A")="Select Clinic: "
"RTN","SDRRUTL1",32,0)
 S SDRRDIC("B")="All"
"RTN","SDRRUTL1",33,0)
 S SDRRDIC("S")="I $$ACTIVE^SDRRUTL1(+Y,.SDRRDIV,.SDRRST,.SDRRND,^(0))"
"RTN","SDRRUTL1",34,0)
 I '$$EN^SDRRSLCT(.SDRRDIC,"SDRR") S SDRRABORT=1 Q
"RTN","SDRRUTL1",35,0)
 S (SDRRNAME,SDRRIEN)=""
"RTN","SDRRUTL1",36,0)
 F  S SDRRNAME=$O(^TMP($J,"SDRR",SDRRNAME)) Q:SDRRNAME=""  D
"RTN","SDRRUTL1",37,0)
 . F  S SDRRIEN=$O(^TMP($J,"SDRR",SDRRNAME,SDRRIEN)) Q:SDRRIEN=""  D
"RTN","SDRRUTL1",38,0)
 . . S SDRRREC=$G(^SC(SDRRIEN,0))
"RTN","SDRRUTL1",39,0)
 . . S ^TMP("SDRR",$J,"DIV",$P(SDRRREC,U,15),"CLIN",$P(SDRRREC,U))=SDRRIEN_U_$$STOPCODE($P(SDRRREC,U,7))_U_$$STOPCODE($P(SDRRREC,U,18))
"RTN","SDRRUTL1",40,0)
 K ^TMP($J,"SDRR")
"RTN","SDRRUTL1",41,0)
 Q
"RTN","SDRRUTL1",42,0)
R ; Select range of clinics
"RTN","SDRRUTL1",43,0)
 N SDRRCLIN,SDRRIEN,SDRRREC,SDRRFROM,SDRRTHRU,SDRRI
"RTN","SDRRUTL1",44,0)
 D ASKRANGE(.SDRRCLIN,.SDRRDIV,.SDRRST,.SDRRND)
"RTN","SDRRUTL1",45,0)
 I 'SDRRCLIN S SDRRABORT=1 Q
"RTN","SDRRUTL1",46,0)
 S SDRRI=0
"RTN","SDRRUTL1",47,0)
 F  S SDRRI=$O(SDRRCLIN(SDRRI)) Q:'SDRRI  D
"RTN","SDRRUTL1",48,0)
 . S SDRRFROM=$P($P(SDRRCLIN(SDRRI),":"),U,2)
"RTN","SDRRUTL1",49,0)
 . S SDRRFROM=$O(^SC("B",SDRRFROM),-1)
"RTN","SDRRUTL1",50,0)
 . S SDRRTHRU=$P($P(SDRRCLIN(SDRRI),":",2),U,2)
"RTN","SDRRUTL1",51,0)
 . S SDRRCLIN=SDRRFROM
"RTN","SDRRUTL1",52,0)
 . F  S SDRRCLIN=$O(^SC("B",SDRRCLIN)) Q:SDRRCLIN=""  D  Q:SDRRCLIN=SDRRTHRU
"RTN","SDRRUTL1",53,0)
 . . S SDRRIEN=$O(^SC("B",SDRRCLIN,0))
"RTN","SDRRUTL1",54,0)
 . . S SDRRREC=$G(^SC(SDRRIEN,0))
"RTN","SDRRUTL1",55,0)
 . . Q:'$$ACTIVE(SDRRIEN,.SDRRDIV,.SDRRST,.SDRRND,SDRRREC)
"RTN","SDRRUTL1",56,0)
 . . S ^TMP("SDRR",$J,"DIV",$P(SDRRREC,U,15),"CLIN",$P(SDRRREC,U))=SDRRIEN_U_$$STOPCODE($P(SDRRREC,U,7))_U_$$STOPCODE($P(SDRRREC,U,18))
"RTN","SDRRUTL1",57,0)
 Q
"RTN","SDRRUTL1",58,0)
S ; Select stop codes
"RTN","SDRRUTL1",59,0)
 N SDRRDIC,SDRRSC,SDRRSCI,SDRRNDX,SDRRIEN,SDRRREC
"RTN","SDRRUTL1",60,0)
 S SDRRDIC=40.7
"RTN","SDRRUTL1",61,0)
 S SDRRDIC(0)="AEMQZ"
"RTN","SDRRUTL1",62,0)
 S SDRRDIC("A")="Select Stop Code: "
"RTN","SDRRUTL1",63,0)
 S SDRRDIC("S")="S %=$P(^(0),U,3) I '%!(%>"_$G(SDRRST,DT)_")"
"RTN","SDRRUTL1",64,0)
 I '$$EN^SDRRSLCT(.SDRRDIC,"SDRR") S SDRRABORT=1 Q
"RTN","SDRRUTL1",65,0)
 S (SDRRSC,SDRRSCI,SDRRIEN)=""
"RTN","SDRRUTL1",66,0)
 F  S SDRRSC=$O(^TMP($J,"SDRR",SDRRSC)) Q:SDRRSC=""  D
"RTN","SDRRUTL1",67,0)
 . F  S SDRRSCI=$O(^TMP($J,"SDRR",SDRRSC,SDRRSCI)) Q:'SDRRSCI  D
"RTN","SDRRUTL1",68,0)
 . . F SDRRNDX="AST","ACST" D  ; xrefs on STOP CODE and CREDIT STOP fields
"RTN","SDRRUTL1",69,0)
 . . . F  S SDRRIEN=$O(^SC(SDRRNDX,SDRRSCI,SDRRIEN)) Q:'SDRRIEN  D
"RTN","SDRRUTL1",70,0)
 . . . . S SDRRREC=$G(^SC(SDRRIEN,0))
"RTN","SDRRUTL1",71,0)
 . . . . Q:'$$ACTIVE(SDRRIEN,.SDRRDIV,.SDRRST,.SDRRND,SDRRREC)
"RTN","SDRRUTL1",72,0)
 . . . . S ^TMP("SDRR",$J,"DIV",$P(SDRRREC,U,15),"CLIN",$P(SDRRREC,U))=SDRRIEN_U_$$STOPCODE($P(SDRRREC,U,7))_U_$$STOPCODE($P(SDRRREC,U,18))
"RTN","SDRRUTL1",73,0)
 K ^TMP($J,"SDRR")
"RTN","SDRRUTL1",74,0)
 Q
"RTN","SDRRUTL1",75,0)
ASKRANGE(SDRRCLIN,SDRRDIV,SDRRST,SDRRND) ;
"RTN","SDRRUTL1",76,0)
 ;   DBIA #10040; Direct global reference of (#44) file 
"RTN","SDRRUTL1",77,0)
 N DIC,X,Y,DTOUT,DUOUT,SDRRCNT,SDRRFROM
"RTN","SDRRUTL1",78,0)
 S SDRRCNT=0
"RTN","SDRRUTL1",79,0)
 S DIC="^SC(",DIC(0)="AEQM"
"RTN","SDRRUTL1",80,0)
 W !
"RTN","SDRRUTL1",81,0)
 W !,"To select a range of clinics, first you select the start of the range,"
"RTN","SDRRUTL1",82,0)
 W !,"or the 'from' clinic.  Next, you select the end of the range,"
"RTN","SDRRUTL1",83,0)
 W !,"or the 'thru' clinic.  We'll select all the clinics in that range for you."
"RTN","SDRRUTL1",84,0)
 F  D  Q:Y<0
"RTN","SDRRUTL1",85,0)
 . W !
"RTN","SDRRUTL1",86,0)
 . S DIC("A")="From Clinic: "
"RTN","SDRRUTL1",87,0)
 . S DIC("S")="I $$ACTIVE^SDRRUTL1(+Y,.SDRRDIV,.SDRRST,.SDRRND,^(0))"
"RTN","SDRRUTL1",88,0)
 . D ^DIC Q:Y<0
"RTN","SDRRUTL1",89,0)
 . S SDRRFROM=Y ;S SDRRDIV(+Y)=$P(Y,U,2)
"RTN","SDRRUTL1",90,0)
 . S DIC("A")="Thru Clinic: "
"RTN","SDRRUTL1",91,0)
 . S DIC("S")="I $P(^(0),U)]"""_$O(^SC("B",$P(SDRRFROM,U,2)),-1)_""",$$ACTIVE^SDRRUTL1(+Y,.SDRRDIV,.SDRRST,.SDRRND,^(0))"
"RTN","SDRRUTL1",92,0)
 . D ^DIC Q:Y<0
"RTN","SDRRUTL1",93,0)
 . S SDRRCNT=SDRRCNT+1
"RTN","SDRRUTL1",94,0)
 . S SDRRCLIN(SDRRCNT)=SDRRFROM_":"_Y
"RTN","SDRRUTL1",95,0)
 I $D(DTOUT)!$D(DUOUT) K SDRRCLIN S SDRRCLIN=0
"RTN","SDRRUTL1",96,0)
 S SDRRCLIN=SDRRCNT
"RTN","SDRRUTL1",97,0)
 Q
"RTN","SDRRUTL1",98,0)
ACTIVE(SDRRIEN,SDRRDIV,SDRRST,SDRRND,SDRRREC) ; Is the clinic active?
"RTN","SDRRUTL1",99,0)
 ;   DBIA #10040; Direct global reference of (#44) file 
"RTN","SDRRUTL1",100,0)
 ; SDRRIEN - IEN of clinic in HOSPITAL LOCATION (#44) file
"RTN","SDRRUTL1",101,0)
 ; SDRRDIV - (optional) clinic must be in Division(s)
"RTN","SDRRUTL1",102,0)
 ;          SDRRDIV=ien  or SDRRDIV(ien)="", where ien is IEN in file 40.8
"RTN","SDRRUTL1",103,0)
 ; SDRRST  - (optional) date range start date - default=DT
"RTN","SDRRUTL1",104,0)
 ; SDRRND  - (optional) date range end date - default=SDRRST
"RTN","SDRRUTL1",105,0)
 ; SDRRREC - (optional) zero node of clinic
"RTN","SDRRUTL1",106,0)
 I '$D(SDRRREC) S SDRRREC=$G(^SC(SDRRIEN,0))
"RTN","SDRRUTL1",107,0)
 Q:$P(SDRRREC,U,3)'="C" 0  ; Not a clinic
"RTN","SDRRUTL1",108,0)
 Q:$P(SDRRREC,U,1)["*" 0
"RTN","SDRRUTL1",109,0)
 I $D(SDRRDIV)=1,$P(SDRRREC,U,15)'=SDRRDIV Q 0
"RTN","SDRRUTL1",110,0)
 I $D(SDRRDIV)>9,'$D(SDRRDIV(+$P(SDRRREC,U,15))) Q 0
"RTN","SDRRUTL1",111,0)
 S SDRRREC=$G(^SC(SDRRIEN,"I"))
"RTN","SDRRUTL1",112,0)
 Q:'SDRRREC 1
"RTN","SDRRUTL1",113,0)
 I '$G(SDRRST) S SDRRST=DT
"RTN","SDRRUTL1",114,0)
 I '$G(SDRRND) S SDRRND=SDRRST
"RTN","SDRRUTL1",115,0)
 I $P(SDRRREC,U,1)<SDRRST Q $S($P(SDRRREC,U,2)="":0,$P(SDRRREC,U,2)>SDRRND:0,1:1)
"RTN","SDRRUTL1",116,0)
 Q 1  ; Active
"SEC","^DIC",403.5,403.5,0,"AUDIT")
@
"SEC","^DIC",403.5,403.5,0,"DD")
@
"SEC","^DIC",403.5,403.5,0,"DEL")
@
"SEC","^DIC",403.5,403.5,0,"LAYGO")
@
"SEC","^DIC",403.5,403.5,0,"RD")

"SEC","^DIC",403.5,403.5,0,"WR")

"SEC","^DIC",403.51,403.51,0,"AUDIT")
@
"SEC","^DIC",403.51,403.51,0,"DD")
@
"SEC","^DIC",403.51,403.51,0,"DEL")
@
"SEC","^DIC",403.51,403.51,0,"LAYGO")
@
"SEC","^DIC",403.51,403.51,0,"RD")

"SEC","^DIC",403.51,403.51,0,"WR")

"SEC","^DIC",403.52,403.52,0,"AUDIT")
@
"SEC","^DIC",403.52,403.52,0,"DD")
@
"SEC","^DIC",403.52,403.52,0,"DEL")
@
"SEC","^DIC",403.52,403.52,0,"LAYGO")
@
"SEC","^DIC",403.52,403.52,0,"RD")

"SEC","^DIC",403.52,403.52,0,"WR")

"SEC","^DIC",403.53,403.53,0,"AUDIT")
@
"SEC","^DIC",403.53,403.53,0,"DD")
@
"SEC","^DIC",403.53,403.53,0,"DEL")
@
"SEC","^DIC",403.53,403.53,0,"LAYGO")
@
"SEC","^DIC",403.53,403.53,0,"RD")

"SEC","^DIC",403.53,403.53,0,"WR")

"SEC","^DIC",403.54,403.54,0,"AUDIT")
@
"SEC","^DIC",403.54,403.54,0,"DD")
@
"SEC","^DIC",403.54,403.54,0,"DEL")
@
"SEC","^DIC",403.54,403.54,0,"LAYGO")
@
"SEC","^DIC",403.54,403.54,0,"RD")

"SEC","^DIC",403.54,403.54,0,"WR")

"SEC","^DIC",403.55,403.55,0,"AUDIT")
@
"SEC","^DIC",403.55,403.55,0,"DD")
@
"SEC","^DIC",403.55,403.55,0,"DEL")
@
"SEC","^DIC",403.55,403.55,0,"LAYGO")
@
"SEC","^DIC",403.55,403.55,0,"RD")

"SEC","^DIC",403.55,403.55,0,"WR")

"SEC","^DIC",403.56,403.56,0,"AUDIT")
@
"SEC","^DIC",403.56,403.56,0,"DD")
@
"SEC","^DIC",403.56,403.56,0,"DEL")
@
"SEC","^DIC",403.56,403.56,0,"LAYGO")
@
"SEC","^DIC",403.56,403.56,0,"RD")

"SEC","^DIC",403.56,403.56,0,"WR")

"VER")
8.0^22.0
"^DD",403.5,403.5,0)
FIELD^^2^13
"^DD",403.5,403.5,0,"DDA")
N
"^DD",403.5,403.5,0,"DT")
3080715
"^DD",403.5,403.5,0,"ID",4.5)
S %I=Y,Y=$S('$D(^(0)):"",$D(^SC(+$P(^(0),U,2),0))#2:$P(^(0),U,1),1:""),C=$P(^DD(44,.01,0),U,2) D Y^DIQ:Y]"" W "   ",Y,@("$E("_DIC_"%I,0),0)") S Y=%I K %I
"^DD",403.5,403.5,0,"ID",5)
W "   ",$E($P(^(0),U,6),4,5)_"-"_$E($P(^(0),U,6),6,7)_"-"_$E($P(^(0),U,6),2,3)
"^DD",403.5,403.5,0,"IX","B",403.5,.01)

"^DD",403.5,403.5,0,"IX","C",403.5,4)

"^DD",403.5,403.5,0,"IX","D",403.5,5)

"^DD",403.5,403.5,0,"IX","E",403.5,4.5)

"^DD",403.5,403.5,0,"NM","RECALL REMINDERS")

"^DD",403.5,403.5,0,"VRPK")
SD
"^DD",403.5,403.5,.01,0)
PATIENT NAME^RP2'^DPT(^0;1^Q
"^DD",403.5,403.5,.01,1,0)
^.1^^-1
"^DD",403.5,403.5,.01,1,1,0)
403.5^B
"^DD",403.5,403.5,.01,1,1,1)
S ^SD(403.5,"B",$E(X,1,30),DA)=""
"^DD",403.5,403.5,.01,1,1,2)
K ^SD(403.5,"B",$E(X,1,30),DA)
"^DD",403.5,403.5,.01,1,1,"%D",0)
^^2^2^3080715^
"^DD",403.5,403.5,.01,1,1,"%D",1,0)
Used for checking to see if the patient is in the Recall file and display 
"^DD",403.5,403.5,.01,1,1,"%D",2,0)
recall information before a new entry is made.
"^DD",403.5,403.5,.01,1,1,"DT")
3040729
"^DD",403.5,403.5,.01,3)
Enter the name of the Patient you wish to enter a Recall for.
"^DD",403.5,403.5,.01,21,0)
^^1^1^3080715^
"^DD",403.5,403.5,.01,21,1,0)
Recall Reminder patient name this is a pointer to the patient file #2.
"^DD",403.5,403.5,.01,"DT")
3080715
"^DD",403.5,403.5,2,0)
ACCESSION#^F^^0;3^K:$L(X)>25!($L(X)<1) X
"^DD",403.5,403.5,2,3)
Answer must be 1-25 characters in length.
"^DD",403.5,403.5,2,21,0)
^^1^1^3080715^
"^DD",403.5,403.5,2,21,1,0)
This is the lab order number or the lab accession number if known.
"^DD",403.5,403.5,2,"DT")
3080715
"^DD",403.5,403.5,2.5,0)
COMMENT^F^^0;7^K:$L(X)>80!($L(X)<1) X
"^DD",403.5,403.5,2.5,3)
Answer must be 1-80 characters in length.
"^DD",403.5,403.5,2.5,21,0)
^.001^1^1^3080715^^
"^DD",403.5,403.5,2.5,21,1,0)
Comments needed for this recall entry. 
"^DD",403.5,403.5,2.5,"DT")
3080715
"^DD",403.5,403.5,2.6,0)
FAST/NON-FASTING^S^f:FASTING;n:NON-FASTING;^0;8^Q
"^DD",403.5,403.5,2.6,3)
Are the labs Fasting or Non-Fasting? leave blank if no labs have been ordered.
"^DD",403.5,403.5,2.6,21,0)
^^3^3^3080715^
"^DD",403.5,403.5,2.6,21,1,0)
If the  patient has had lab tests ordered for this recall visit, select
"^DD",403.5,403.5,2.6,21,2,0)
either Fasting or Non-Fasting labs. If the patient has no labs orders
"^DD",403.5,403.5,2.6,21,3,0)
leave blank.
"^DD",403.5,403.5,2.6,"DT")
3080715
"^DD",403.5,403.5,3,0)
TEST/APP.^RP403.51'^SD(403.51,^0;4^Q
"^DD",403.5,403.5,3,3)
Select the type of Recall visit
"^DD",403.5,403.5,3,21,0)
^^1^1^3080715^
"^DD",403.5,403.5,3,21,1,0)
This is the type of Recall Visit that is assigned for this entry.
"^DD",403.5,403.5,3,"DT")
3080715
"^DD",403.5,403.5,4,0)
PROVIDER^RP403.54'^SD(403.54,^0;5^Q
"^DD",403.5,403.5,4,1,0)
^.1^^-1
"^DD",403.5,403.5,4,1,1,0)
403.5^C
"^DD",403.5,403.5,4,1,1,1)
S ^SD(403.5,"C",$E(X,1,30),DA)=""
"^DD",403.5,403.5,4,1,1,2)
K ^SD(403.5,"C",$E(X,1,30),DA)
"^DD",403.5,403.5,4,1,1,"%D",0)
^^2^2^3080715^
"^DD",403.5,403.5,4,1,1,"%D",1,0)
Used for printing of the cards/letter and reports by Provider or Recall 
"^DD",403.5,403.5,4,1,1,"%D",2,0)
Team.
"^DD",403.5,403.5,4,1,1,"DT")
3041018
"^DD",403.5,403.5,4,3)
Select the provider for this Recall entry.
"^DD",403.5,403.5,4,21,0)
^^1^1^3080715^
"^DD",403.5,403.5,4,21,1,0)
The provider who is assigned for this Recall entry.
"^DD",403.5,403.5,4,"DT")
3080715
"^DD",403.5,403.5,4.5,0)
CLINIC^P44'^SC(^0;2^Q
"^DD",403.5,403.5,4.5,1,0)
^.1
"^DD",403.5,403.5,4.5,1,1,0)
403.5^E
"^DD",403.5,403.5,4.5,1,1,1)
S ^SD(403.5,"E",$E(X,1,30),DA)=""
"^DD",403.5,403.5,4.5,1,1,2)
K ^SD(403.5,"E",$E(X,1,30),DA)
"^DD",403.5,403.5,4.5,1,1,"%D",0)
^^3^3^3080715^
"^DD",403.5,403.5,4.5,1,1,"%D",1,0)
Used during the display of Recall information and for selecting the 
"^DD",403.5,403.5,4.5,1,1,"%D",2,0)
printing of cards/letters, Also, used in selecting reports printed by 
"^DD",403.5,403.5,4.5,1,1,"%D",3,0)
Recall clinic.
"^DD",403.5,403.5,4.5,1,1,"DT")
3041018
"^DD",403.5,403.5,4.5,3)
Select the clinic that this Recall will be linked to.
"^DD",403.5,403.5,4.5,21,0)
^^2^2^3080715^
"^DD",403.5,403.5,4.5,21,1,0)
This is the Hospital Location which this patient will have the Recall 
"^DD",403.5,403.5,4.5,21,2,0)
entry assigned. 
"^DD",403.5,403.5,4.5,"DT")
3080715
"^DD",403.5,403.5,4.7,0)
LENGTH OF APPT.^NJ3,0^^0;9^K:+X'=X!(X>120)!(X<10)!(X?.E1"."1N.N) X
"^DD",403.5,403.5,4.7,3)
Type a Number between 10 and 120, 0 Decimal Digits
"^DD",403.5,403.5,4.7,21,0)
^^2^2^3080715^
"^DD",403.5,403.5,4.7,21,1,0)
The length of appointment (in minutes) that will be required once
"^DD",403.5,403.5,4.7,21,2,0)
scheduled.
"^DD",403.5,403.5,4.7,"DT")
3080715
"^DD",403.5,403.5,5,0)
RECALL DATE^RDX^^0;6^S %DT="EF" D ^%DT S X=Y K:Y<1 X
"^DD",403.5,403.5,5,1,0)
^.1
"^DD",403.5,403.5,5,1,1,0)
403.5^D
"^DD",403.5,403.5,5,1,1,1)
S ^SD(403.5,"D",$E(X,1,30),DA)=""
"^DD",403.5,403.5,5,1,1,2)
K ^SD(403.5,"D",$E(X,1,30),DA)
"^DD",403.5,403.5,5,1,1,"%D",0)
^^2^2^3080715^
"^DD",403.5,403.5,5,1,1,"%D",1,0)
Used in selecting a date range for printing Recall cards/letters and 
"^DD",403.5,403.5,5,1,1,"%D",2,0)
in all Recall reports.
"^DD",403.5,403.5,5,1,1,"DT")
3041018
"^DD",403.5,403.5,5,1,1900001,0)
^^TRIGGER^403.5^7
"^DD",403.5,403.5,5,1,1900001,1)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(1)=$S($D(^SD(403.5,D0,0)):^(0),1:"") S X=$P(Y(1),U,11),X=X S DIU=X K Y S X=DIV S X=DUZ S DIH=$G(^SD(403.5,DIV(0),0)),DIV=X S $P(^(0),U,11)=DIV,DIH=403.5,DIG=7 D ^DICR
"^DD",403.5,403.5,5,1,1900001,2)
Q
"^DD",403.5,403.5,5,1,1900001,"%D",0)
^^1^1^3080715^
"^DD",403.5,403.5,5,1,1900001,"%D",1,0)
Used to update USER THAT ENTER RECALL field #7
"^DD",403.5,403.5,5,1,1900001,"CREATE VALUE")
S X=DUZ
"^DD",403.5,403.5,5,1,1900001,"DELETE VALUE")
NO EFFECT
"^DD",403.5,403.5,5,1,1900001,"DT")
3050615
"^DD",403.5,403.5,5,1,1900001,"FIELD")
#7
"^DD",403.5,403.5,5,3)
Enter the Recall Date that the provider has requested for this patient
"^DD",403.5,403.5,5,21,0)
^.001^1^1^3090807^^^^
"^DD",403.5,403.5,5,21,1,0)
Recall Date is the date requested by the Provider.
"^DD",403.5,403.5,5,"DT")
3090807
"^DD",403.5,403.5,5.5,0)
RECALL DATE (PER PATIENT)^DX^^0;12^S %DT="EF" D ^%DT S X=Y K:Y<1 X
"^DD",403.5,403.5,5.5,3)
Enter the Date that the patient is requesting for their Recall Visit
"^DD",403.5,403.5,5.5,21,0)
^^2^2^3080715^
"^DD",403.5,403.5,5.5,21,1,0)
This is the Recall Date that the patient is requesting. It can be 
"^DD",403.5,403.5,5.5,21,2,0)
different then the Recall Date, which is what the Provider has requested.
"^DD",403.5,403.5,5.5,"DT")
3090807
"^DD",403.5,403.5,6,0)
DATE REMINDER SENT^D^^0;10^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",403.5,403.5,6,3)
Date letter/card first printed.
"^DD",403.5,403.5,6,21,0)
^^2^2^3080715^
"^DD",403.5,403.5,6,21,1,0)
This is the date that the first letter/card was printed and sent to 
"^DD",403.5,403.5,6,21,2,0)
the Veteran.
"^DD",403.5,403.5,6,"DT")
3080715
"^DD",403.5,403.5,7,0)
USER WHO ENTERED RECALL^P200'^VA(200,^0;11^Q
"^DD",403.5,403.5,7,3)
New person who entered or edited Recall entry
"^DD",403.5,403.5,7,5,1,0)
403.5^5^1900001
"^DD",403.5,403.5,7,21,0)
^^1^1^3080715^
"^DD",403.5,403.5,7,21,1,0)
User who enter or edit a Recall entry.
"^DD",403.5,403.5,7,"DT")
3080716
"^DD",403.5,403.5,8,0)
SECOND PRINT^D^^0;13^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",403.5,403.5,8,3)
Date for second printing of card or letter
"^DD",403.5,403.5,8,21,0)
^^1^1^3080715^
"^DD",403.5,403.5,8,21,1,0)
This is the date that the second letter/card was printed and sent.
"^DD",403.5,403.5,8,"DT")
3080715
"^DD",403.51,403.51,0)
FIELD^^1^2
"^DD",403.51,403.51,0,"DDA")
N
"^DD",403.51,403.51,0,"ID",1)
W "   ",$P(^(0),U,2)
"^DD",403.51,403.51,0,"IX","B",403.51,.01)

"^DD",403.51,403.51,0,"IX","B",403.51,1)

"^DD",403.51,403.51,0,"NM","RECALL REMINDERS APPT TYPE")

"^DD",403.51,403.51,0,"PT",403.5,3)

"^DD",403.51,403.51,0,"PT",403.56,3)

"^DD",403.51,403.51,0,"VRPK")
SD
"^DD",403.51,403.51,.01,0)
NAME^RF^^0;1^K:$L(X)>21!($L(X)<3)!'(X'?1P.E) X
"^DD",403.51,403.51,.01,1,0)
^.1
"^DD",403.51,403.51,.01,1,1,0)
403.51^B
"^DD",403.51,403.51,.01,1,1,1)
S ^SD(403.51,"B",$E(X,1,30),DA)=""
"^DD",403.51,403.51,.01,1,1,2)
K ^SD(403.51,"B",$E(X,1,30),DA)
"^DD",403.51,403.51,.01,1,1,"%D",0)
^^1^1^3080715^
"^DD",403.51,403.51,.01,1,1,"%D",1,0)
Used for looking up Recall Type - full name.
"^DD",403.51,403.51,.01,3)
Answer must be 3-21 characters in length.
"^DD",403.51,403.51,.01,21,0)
^^4^4^3080716^
"^DD",403.51,403.51,.01,21,1,0)
Type of Recall is asked when an Recall entry is made. This "type" is  
"^DD",403.51,403.51,.01,21,2,0)
created by the Recall Coordinator, and is used as a description as why
"^DD",403.51,403.51,.01,21,3,0)
the Veteran will need a Recall made. Some examples: (Followup, 6Month 
"^DD",403.51,403.51,.01,21,4,0)
Cleaning, and Yearly Exam).
"^DD",403.51,403.51,.01,"DT")
3080716
"^DD",403.51,403.51,1,0)
SYNONYM^F^^0;2^K:$L(X)>4!($L(X)<1) X
"^DD",403.51,403.51,1,1,0)
^.1
"^DD",403.51,403.51,1,1,1,0)
403.51^B^MNEMONIC
"^DD",403.51,403.51,1,1,1,1)
S:'$D(^SD(403.51,"B",$E(X,1,30),DA)) ^(DA)=1
"^DD",403.51,403.51,1,1,1,2)
I $D(^SD(403.51,"B",$E(X,1,30),DA)),^(DA) K ^(DA)
"^DD",403.51,403.51,1,1,1,"%D",0)
^^1^1^3080715^
"^DD",403.51,403.51,1,1,1,"%D",1,0)
Look up by Recall type synonym.
"^DD",403.51,403.51,1,1,1,"DT")
3000726
"^DD",403.51,403.51,1,3)
Answer must be 1-4 characters in length.
"^DD",403.51,403.51,1,21,0)
^^1^1^3080716^
"^DD",403.51,403.51,1,21,1,0)
Enter the Letter or Number that has been assigned to a Recall Type.
"^DD",403.51,403.51,1,"DT")
3080716
"^DD",403.52,403.52,0)
FIELD^^1^2
"^DD",403.52,403.52,0,"DDA")
N
"^DD",403.52,403.52,0,"DT")
3080221
"^DD",403.52,403.52,0,"IX","B",403.52,.01)

"^DD",403.52,403.52,0,"NM","RECALL REMINDERS LETTERS")

"^DD",403.52,403.52,0,"VRPK")
SD
"^DD",403.52,403.52,.01,0)
CLINIC^RP44'^SC(^0;1^Q
"^DD",403.52,403.52,.01,1,0)
^.1
"^DD",403.52,403.52,.01,1,1,0)
403.52^B
"^DD",403.52,403.52,.01,1,1,1)
S ^SD(403.52,"B",$E(X,1,30),DA)=""
"^DD",403.52,403.52,.01,1,1,2)
K ^SD(403.52,"B",$E(X,1,30),DA)
"^DD",403.52,403.52,.01,1,1,"%D",0)
^.101^1^1^3080715^^
"^DD",403.52,403.52,.01,1,1,"%D",1,0)
Store by Clinic name used for printing of Recall Letters.
"^DD",403.52,403.52,.01,3)
Select the clinic that is using Recall Letters
"^DD",403.52,403.52,.01,21,0)
^^1^1^3080716^
"^DD",403.52,403.52,.01,21,1,0)
The Clinic name that this letter should be used with.
"^DD",403.52,403.52,.01,"DT")
3080716
"^DD",403.52,403.52,1,0)
LETTER TEXT^403.521^^1;0
"^DD",403.52,403.52,1,21,0)
^^2^2^3080716^
"^DD",403.52,403.52,1,21,1,0)
Enter the text that you would like the patient to see in their Recall 
"^DD",403.52,403.52,1,21,2,0)
letter.
"^DD",403.52,403.521,0)
LETTER TEXT SUB-FIELD^^.01^1
"^DD",403.52,403.521,0,"DT")
3080221
"^DD",403.52,403.521,0,"NM","LETTER TEXT")

"^DD",403.52,403.521,0,"UP")
403.52
"^DD",403.52,403.521,.01,0)
LETTER TEXT^Wx^^0;1^Q
"^DD",403.52,403.521,.01,3)
Letter Text needed for this clinic
"^DD",403.52,403.521,.01,21,0)
^^1^1^3080716^
"^DD",403.52,403.521,.01,21,1,0)
the text you would like shown of this clinic Recall letter.
"^DD",403.52,403.521,.01,"DT")
3080716
"^DD",403.53,403.53,0)
FIELD^^4^4
"^DD",403.53,403.53,0,"DDA")
N
"^DD",403.53,403.53,0,"DT")
3081007
"^DD",403.53,403.53,0,"IX","B",403.53,.01)

"^DD",403.53,403.53,0,"NM","RECALL REMINDERS PARAMETERS")

"^DD",403.53,403.53,0,"PT",403.55,3)

"^DD",403.53,403.53,0,"VRPK")
SD
"^DD",403.53,403.53,.01,0)
DIVISION NAME^RFX^^0;1^S X=$$UP^XLFSTR(X) K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"^DD",403.53,403.53,.01,1,0)
^.1
"^DD",403.53,403.53,.01,1,1,0)
403.53^B
"^DD",403.53,403.53,.01,1,1,1)
S ^SD(403.53,"B",$E(X,1,30),DA)=""
"^DD",403.53,403.53,.01,1,1,2)
K ^SD(403.53,"B",$E(X,1,30),DA)
"^DD",403.53,403.53,.01,1,1,"%D",0)
^^2^2^3080715^
"^DD",403.53,403.53,.01,1,1,"%D",1,0)
For the selecting the printing of Letters or Cards from a selected Recall
"^DD",403.53,403.53,.01,1,1,"%D",2,0)
Parameter.
"^DD",403.53,403.53,.01,3)
Answer must be 3-30 characters in length.
"^DD",403.53,403.53,.01,21,0)
^.001^9^9^3081007^^^^
"^DD",403.53,403.53,.01,21,1,0)
Enter in this field the name of a Recall "subset". If your site chooses to
"^DD",403.53,403.53,.01,21,2,0)
have all clinical areas send out recall notifications the same number of 
"^DD",403.53,403.53,.01,21,3,0)
days before a recall date, all areas would be using Recall Letters, and 
"^DD",403.53,403.53,.01,21,4,0)
all areas want to scan patient scheduled appointments the same number of 
"^DD",403.53,403.53,.01,21,5,0)
days, you would need to only enter one entry.  This entry can be your 
"^DD",403.53,403.53,.01,21,6,0)
site's name. But, if your site has areas that want to have different 
"^DD",403.53,403.53,.01,21,7,0)
settings for notification type, timeframe to send out cards/letters or 
"^DD",403.53,403.53,.01,21,8,0)
the number of days to scan for looking at scheduled appointments then you 
"^DD",403.53,403.53,.01,21,9,0)
would want separate entries.
"^DD",403.53,403.53,.01,"DT")
3081007
"^DD",403.53,403.53,1,0)
TYPE OF NOTIFICATION^S^L:LETTERS;C:CARDS;^0;2^Q
"^DD",403.53,403.53,1,3)
How should notification be sent?
"^DD",403.53,403.53,1,21,0)
^^1^1^3080715^
"^DD",403.53,403.53,1,21,1,0)
How should this Recall Reminder Division send out Notifications. 
"^DD",403.53,403.53,1,"DT")
3080716
"^DD",403.53,403.53,3,0)
AUTO PRINT DAYS^NJ2,0^^0;4^K:+X'=X!(X>99)!(X<0)!(X?.E1"."1.N) X
"^DD",403.53,403.53,3,3)
Type a number between 0 and 99, 0 Decimal Digits
"^DD",403.53,403.53,3,21,0)
^^2^2^3080715^
"^DD",403.53,403.53,3,21,1,0)
Please put in the number of days ahead of the Recall Reminder date that 
"^DD",403.53,403.53,3,21,2,0)
you would like to send out Notification.
"^DD",403.53,403.53,3,"DT")
3080716
"^DD",403.53,403.53,4,0)
CLEAN UP DAY SETTING^NJ3,0^^0;5^K:+X'=X!(X>365)!(X<0)!(X?.E1"."1.N) X
"^DD",403.53,403.53,4,3)
Type a number between 0 and 365, 0 Decimal Digits
"^DD",403.53,403.53,4,21,0)
^^9^9^3080716^
"^DD",403.53,403.53,4,21,1,0)
A background job runs nightly to delete recall reminders from the RECALL 
"^DD",403.53,403.53,4,21,2,0)
REMINDERS file if an appointment has been scheduled for the patient at 
"^DD",403.53,403.53,4,21,3,0)
the requested clinic. The background job scans the scheduled 
"^DD",403.53,403.53,4,21,4,0)
appointments, and if an appointment has been scheduled within the CLEAN 
"^DD",403.53,403.53,4,21,5,0)
UP DAY SETTING number of days (before or after) of the requested 
"^DD",403.53,403.53,4,21,6,0)
appointment date, then the appointment is considered to have fulfilled 
"^DD",403.53,403.53,4,21,7,0)
the recall reminder request, and the recall reminder is deleted. A copy 
"^DD",403.53,403.53,4,21,8,0)
of the recall reminder record is added to the RECALL REMINDERS REMOVED 
"^DD",403.53,403.53,4,21,9,0)
file, and the DELETE REASON is set to APPT SCHEDULED.
"^DD",403.53,403.53,4,"DT")
3080716
"^DD",403.54,403.54,0)
FIELD^^6^7
"^DD",403.54,403.54,0,"DDA")
N
"^DD",403.54,403.54,0,"DT")
3080229
"^DD",403.54,403.54,0,"ID",1)
S %I=Y,Y=$S('$D(^(0)):"",$D(^SD(403.55,+$P(^(0),U,2),0))#2:$P(^(0),U,1),1:""),C=$P(^DD(403.55,.01,0),U,2) D Y^DIQ:Y]"" W "   ",Y,@("$E("_DIC_"%I,0),0)") S Y=%I K %I
"^DD",403.54,403.54,0,"ID",5)
W "   ",@("$P($P($C(59)_$S($D(^DD(403.54,5,0)):$P(^(0),U,3),1:0)_$E("_DIC_"Y,0),0),$C(59)_$P(^(0),U,6)_"":"",2),$C(59),1)")
"^DD",403.54,403.54,0,"IX","B",403.54,.01)

"^DD",403.54,403.54,0,"IX","C",403.54,1)

"^DD",403.54,403.54,0,"NM","RECALL REMINDERS PROVIDERS")

"^DD",403.54,403.54,0,"PT",403.5,4)

"^DD",403.54,403.54,0,"PT",403.56,4)

"^DD",403.54,403.54,0,"VRPK")
SD
"^DD",403.54,403.54,.01,0)
PROVIDER^RP200'^VA(200,^0;1^Q
"^DD",403.54,403.54,.01,1,0)
^.1
"^DD",403.54,403.54,.01,1,1,0)
403.54^B
"^DD",403.54,403.54,.01,1,1,1)
S ^SD(403.54,"B",$E(X,1,30),DA)=""
"^DD",403.54,403.54,.01,1,1,2)
K ^SD(403.54,"B",$E(X,1,30),DA)
"^DD",403.54,403.54,.01,1,1,"%D",0)
^^1^1^3080716^
"^DD",403.54,403.54,.01,1,1,"%D",1,0)
Printing cards/letters and all reports by selected provider.
"^DD",403.54,403.54,.01,3)
Select a Recall provider.
"^DD",403.54,403.54,.01,21,0)
^^2^2^3080716^
"^DD",403.54,403.54,.01,21,1,0)
The provider name who has been entered as a Recall Provider. The provider 
"^DD",403.54,403.54,.01,21,2,0)
must already be in the New Person file #200.
"^DD",403.54,403.54,.01,"DT")
3080716
"^DD",403.54,403.54,1,0)
TEAM^P403.55'^SD(403.55,^0;2^Q
"^DD",403.54,403.54,1,1,0)
^.1
"^DD",403.54,403.54,1,1,1,0)
403.54^C
"^DD",403.54,403.54,1,1,1,1)
S ^SD(403.54,"C",$E(X,1,30),DA)=""
"^DD",403.54,403.54,1,1,1,2)
K ^SD(403.54,"C",$E(X,1,30),DA)
"^DD",403.54,403.54,1,1,1,"%D",0)
^^1^1^3080716^
"^DD",403.54,403.54,1,1,1,"%D",1,0)
Printing cards/letters and all reports by selected Recall Teams.
"^DD",403.54,403.54,1,1,1,"DT")
3060515
"^DD",403.54,403.54,1,3)
Select a Recall Team for which this provider belongs.
"^DD",403.54,403.54,1,21,0)
^^1^1^3080717^
"^DD",403.54,403.54,1,21,1,0)
The Recall Reminder Team that this provider is assigned to.
"^DD",403.54,403.54,1,"DT")
3080717
"^DD",403.54,403.54,2,0)
DIVISION^RP40.8'^DG(40.8,^0;3^Q
"^DD",403.54,403.54,2,3)
Select the Division where this provider works.
"^DD",403.54,403.54,2,21,0)
^^2^2^3080717^
"^DD",403.54,403.54,2,21,1,0)
This field is used when selecting Recall reports by Division. Enter the 
"^DD",403.54,403.54,2,21,2,0)
medical Center Division where this providers works.
"^DD",403.54,403.54,2,"DT")
3080717
"^DD",403.54,403.54,3,0)
DIRECT PHONE^F^^0;4^K:$L(X)>14!($L(X)<7) X
"^DD",403.54,403.54,3,3)
Answer must be 7-14 characters in length.
"^DD",403.54,403.54,3,21,0)
^^1^1^3080715^
"^DD",403.54,403.54,3,21,1,0)
The Recall Provider office phone number or voice pager.
"^DD",403.54,403.54,3,"DT")
3080715
"^DD",403.54,403.54,4,0)
EXT.^F^^0;5^K:$L(X)>20!($L(X)<4) X
"^DD",403.54,403.54,4,3)
Answer must be 4-20 characters in length.
"^DD",403.54,403.54,4,21,0)
^^1^1^3080715^
"^DD",403.54,403.54,4,21,1,0)
Office phone extension if needed.
"^DD",403.54,403.54,4,"DT")
3080715
"^DD",403.54,403.54,5,0)
STATUS^S^A:ACTIVE;I:INACTIVE;^0;6^Q
"^DD",403.54,403.54,5,3)
Enter Status for Recall Provider
"^DD",403.54,403.54,5,21,0)
^^3^3^3080716^
"^DD",403.54,403.54,5,21,1,0)
When a new Recall Provider is entered they will be set as an Active
"^DD",403.54,403.54,5,21,2,0)
Recall Provider. When a Provider should no longer be used as a Recall
"^DD",403.54,403.54,5,21,3,0)
Provider set to Inactive.
"^DD",403.54,403.54,5,"DT")
3080716
"^DD",403.54,403.54,6,0)
KEY^P19.1'^DIC(19.1,^0;7^Q
"^DD",403.54,403.54,6,3)
Select security key
"^DD",403.54,403.54,6,21,0)
^^4^4^3080716^
"^DD",403.54,403.54,6,21,1,0)
If this field is blank, then any clerk may view and enter/edit recall 
"^DD",403.54,403.54,6,21,2,0)
reminders for this provider. If this field contains a security key, then
"^DD",403.54,403.54,6,21,3,0)
any clerk may view the recall reminders for this provider, but only clerks
"^DD",403.54,403.54,6,21,4,0)
holding the security key may enter/edit them.
"^DD",403.54,403.54,6,"DT")
3080716
"^DD",403.55,403.55,0)
FIELD^^3^4
"^DD",403.55,403.55,0,"DDA")
N
"^DD",403.55,403.55,0,"DT")
3081007
"^DD",403.55,403.55,0,"IX","B",403.55,.01)

"^DD",403.55,403.55,0,"IX","C",403.55,3)

"^DD",403.55,403.55,0,"NM","RECALL REMINDERS TEAM")

"^DD",403.55,403.55,0,"PT",403.54,1)

"^DD",403.55,403.55,0,"VRPK")
SD
"^DD",403.55,403.55,.01,0)
NAME^FX^^0;1^S X=$$UP^XLFSTR(X) K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"^DD",403.55,403.55,.01,1,0)
^.1^^-1
"^DD",403.55,403.55,.01,1,1,0)
403.55^B
"^DD",403.55,403.55,.01,1,1,1)
S ^SD(403.55,"B",$E(X,1,30),DA)=""
"^DD",403.55,403.55,.01,1,1,2)
K ^SD(403.55,"B",$E(X,1,30),DA)
"^DD",403.55,403.55,.01,1,1,"%D",0)
^^1^1^3080715^
"^DD",403.55,403.55,.01,1,1,"%D",1,0)
Printing of Report, cards or letters by Team.
"^DD",403.55,403.55,.01,3)
Answer must be 3-30 characters in length.
"^DD",403.55,403.55,.01,21,0)
^.001^1^1^3081007^^^^
"^DD",403.55,403.55,.01,21,1,0)
This is the name of a team that will be using Recall program.
"^DD",403.55,403.55,.01,"DT")
3081007
"^DD",403.55,403.55,1,0)
ACTIVE/INACTIVE^S^A:ACTIVE;I:INACTIVE;^0;2^Q
"^DD",403.55,403.55,1,3)
Select the status of the Team.
"^DD",403.55,403.55,1,21,0)
^^3^3^3080717^
"^DD",403.55,403.55,1,21,1,0)
When a team is entered it will be marked as Active. The Recall Reminder 
"^DD",403.55,403.55,1,21,2,0)
Coordinator can "Mark" a Team as inactive, so that it will not be used 
"^DD",403.55,403.55,1,21,3,0)
when linking to a Recall Reminder Provider.
"^DD",403.55,403.55,1,"DT")
3080717
"^DD",403.55,403.55,2,0)
PRINTER ASSIGN^P3.5'^%ZIS(1,^0;3^Q
"^DD",403.55,403.55,2,3)
Select the Vista printer that should print Team's cards or letters
"^DD",403.55,403.55,2,21,0)
^^3^3^3080717^
"^DD",403.55,403.55,2,21,1,0)
This is the printer assigned to this Recall Team. This printer will be
"^DD",403.55,403.55,2,21,2,0)
used during the nightly print job of either cards or letters in a Team
"^DD",403.55,403.55,2,21,3,0)
area.
"^DD",403.55,403.55,2,"DT")
3080717
"^DD",403.55,403.55,3,0)
CLINIC RECALL PARAM^P403.53'^SD(403.53,^0;4^Q
"^DD",403.55,403.55,3,1,0)
^.1
"^DD",403.55,403.55,3,1,1,0)
403.55^C
"^DD",403.55,403.55,3,1,1,1)
S ^SD(403.55,"C",$E(X,1,30),DA)=""
"^DD",403.55,403.55,3,1,1,2)
K ^SD(403.55,"C",$E(X,1,30),DA)
"^DD",403.55,403.55,3,1,1,"%D",0)
^^1^1^3080715^
"^DD",403.55,403.55,3,1,1,"%D",1,0)
What type of notication should be used for each team.
"^DD",403.55,403.55,3,1,1,"DT")
3080117
"^DD",403.55,403.55,3,3)
Select Recall Reminders Parameters
"^DD",403.55,403.55,3,21,0)
^^1^1^3080715^
"^DD",403.55,403.55,3,21,1,0)
Used When printing reports, cards or Letters by Recall Team.
"^DD",403.55,403.55,3,"DT")
3080715
"^DD",403.56,403.56,0)
FIELD^^7^16
"^DD",403.56,403.56,0,"DDA")
N
"^DD",403.56,403.56,0,"DT")
3080308
"^DD",403.56,403.56,0,"IX","B",403.56,.01)

"^DD",403.56,403.56,0,"IX","C",403.56,5)

"^DD",403.56,403.56,0,"NM","RECALL REMINDERS REMOVED")

"^DD",403.56,403.56,0,"VRPK")
SD
"^DD",403.56,403.56,.01,0)
PATIENT NAME^RP2'^DPT(^0;1^Q
"^DD",403.56,403.56,.01,1,0)
^.1
"^DD",403.56,403.56,.01,1,1,0)
403.56^B
"^DD",403.56,403.56,.01,1,1,1)
S ^SD(403.56,"B",$E(X,1,30),DA)=""
"^DD",403.56,403.56,.01,1,1,2)
K ^SD(403.56,"B",$E(X,1,30),DA)
"^DD",403.56,403.56,.01,1,1,"%D",0)
^^1^1^3080715^
"^DD",403.56,403.56,.01,1,1,"%D",1,0)
Look up by Recall patient name.
"^DD",403.56,403.56,.01,3)
Select Recall Reminder patient.
"^DD",403.56,403.56,.01,21,0)
^^2^2^3080715^
"^DD",403.56,403.56,.01,21,1,0)
Recall Reminder Patient who has been removed from the Recall Reminder 
"^DD",403.56,403.56,.01,21,2,0)
file.
"^DD",403.56,403.56,.01,"DT")
3080717
"^DD",403.56,403.56,2,0)
ACCESSION #^F^^0;3^K:$L(X)>25!($L(X)<1) X
"^DD",403.56,403.56,2,3)
Answer must be 1-25 characters in length.
"^DD",403.56,403.56,2,21,0)
^^1^1^3080715^
"^DD",403.56,403.56,2,21,1,0)
Lab order number or accession number moved from the Recall File.
"^DD",403.56,403.56,2,"DT")
3080715
"^DD",403.56,403.56,2.5,0)
COMMENT^F^^0;7^K:$L(X)>80!($L(X)<1) X
"^DD",403.56,403.56,2.5,3)
Answer must be 1-80 characters in length.
"^DD",403.56,403.56,2.5,21,0)
^^1^1^3080715^
"^DD",403.56,403.56,2.5,21,1,0)
Comments that have been moved from the Recall Reminder File.
"^DD",403.56,403.56,2.5,"DT")
3080715
"^DD",403.56,403.56,2.6,0)
FAST / NON-FASTING^S^f:FASTING;n:NON-FASTING;^0;8^Q
"^DD",403.56,403.56,2.6,3)
Either f - fasting, n - non fasting or blank for no labs
"^DD",403.56,403.56,2.6,21,0)
^^1^1^3080715^
"^DD",403.56,403.56,2.6,21,1,0)
Fasting and Non fasting information moved from the Recall Reminder file.
"^DD",403.56,403.56,2.6,"DT")
3080715
"^DD",403.56,403.56,3,0)
TEST/APP^P403.51'^SD(403.51,^0;4^Q
"^DD",403.56,403.56,3,3)
Select from the available list of Test/App types
"^DD",403.56,403.56,3,21,0)
^^2^2^3080715^
"^DD",403.56,403.56,3,21,1,0)
This is the type of Recall Visit that is assigned for this entry and has 
"^DD",403.56,403.56,3,21,2,0)
been moved from the Recall Reminder file.
"^DD",403.56,403.56,3,"DT")
3080715
"^DD",403.56,403.56,4,0)
PROVIDER^P403.54'^SD(403.54,^0;5^Q
"^DD",403.56,403.56,4,3)
Select from the available list of Recall Providers
"^DD",403.56,403.56,4,21,0)
^^1^1^3080715^
"^DD",403.56,403.56,4,21,1,0)
The provider who is assigned for this Recall entry.
"^DD",403.56,403.56,4,"DT")
3080715
"^DD",403.56,403.56,4.5,0)
CLINIC^P44'^SC(^0;2^Q
"^DD",403.56,403.56,4.5,3)
Select the clinic at which the patient had the recall entry.
"^DD",403.56,403.56,4.5,21,0)
^^1^1^3080715^
"^DD",403.56,403.56,4.5,21,1,0)
Select from the Hospital Location for this Recall entry.
"^DD",403.56,403.56,4.5,"DT")
3080717
"^DD",403.56,403.56,4.7,0)
LENGTH OF APPT.^NJ3,0^^0;9^K:+X'=X!(X>120)!(X<10)!(X?.E1"."1N.N) X
"^DD",403.56,403.56,4.7,3)
Type a Number between 10 and 120, 0 Decimal Digits
"^DD",403.56,403.56,4.7,21,0)
^^1^1^3080715^
"^DD",403.56,403.56,4.7,21,1,0)
The length of appointment that will be required once scheduled.
"^DD",403.56,403.56,4.7,"DT")
3080715
"^DD",403.56,403.56,5,0)
RECALL DATE^D^^0;6^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",403.56,403.56,5,1,0)
^.1
"^DD",403.56,403.56,5,1,1,0)
403.56^C
"^DD",403.56,403.56,5,1,1,1)
S ^SD(403.56,"C",$E(X,1,30),DA)=""
"^DD",403.56,403.56,5,1,1,2)
K ^SD(403.56,"C",$E(X,1,30),DA)
"^DD",403.56,403.56,5,1,1,"%D",0)
^^1^1^3080716^
"^DD",403.56,403.56,5,1,1,"%D",1,0)
look up by Recall date for entries no longer active.
"^DD",403.56,403.56,5,1,1,"DT")
3070417
"^DD",403.56,403.56,5,3)
Enter the appt date requested by the Provider.
"^DD",403.56,403.56,5,21,0)
^^2^2^3080715^
"^DD",403.56,403.56,5,21,1,0)
Recall date moved from Recall Reminder file once the patient had been 
"^DD",403.56,403.56,5,21,2,0)
removed.
"^DD",403.56,403.56,5,"DT")
3080717
"^DD",403.56,403.56,6,0)
DATE REMINDER SENT^D^^0;10^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",403.56,403.56,6,3)
Enter the date the Recall card or letter was printed and sent.
"^DD",403.56,403.56,6,21,0)
^^1^1^3080717^
"^DD",403.56,403.56,6,21,1,0)
Date the reminder was sent to the patient.
"^DD",403.56,403.56,6,"DT")
3080717
"^DD",403.56,403.56,7,0)
USER WHO ENTERED RECALL^P200'^VA(200,^0;11^Q
"^DD",403.56,403.56,7,3)
Select user who last entered or edited the recall entry.
"^DD",403.56,403.56,7,21,0)
^^1^1^3080717^
"^DD",403.56,403.56,7,21,1,0)
The person who entered or edited Recall entry.
"^DD",403.56,403.56,7,"DT")
3080717
"^DD",403.56,403.56,101,0)
APPT DATE^D^^1;1^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",403.56,403.56,101,3)
Enter date of scheduled appointment.
"^DD",403.56,403.56,101,21,0)
^^2^2^3080715^
"^DD",403.56,403.56,101,21,1,0)
If the patient was deleted from the recall list because s/he got an
"^DD",403.56,403.56,101,21,2,0)
appointment, this is the date/time of the appointment.
"^DD",403.56,403.56,101,"DT")
3080717
"^DD",403.56,403.56,102,0)
APPT CLINIC^P44'^SC(^1;2^Q
"^DD",403.56,403.56,102,3)
Select the clinic matching the Recall entry.
"^DD",403.56,403.56,102,21,0)
^^2^2^3080715^
"^DD",403.56,403.56,102,21,1,0)
If the patient was deleted from the recall list because s/he got an
"^DD",403.56,403.56,102,21,2,0)
appointment, this is the clinic of the appointment.
"^DD",403.56,403.56,102,"DT")
3080717
"^DD",403.56,403.56,201,0)
DELETE DATE^D^^2;1^S %DT="ETXR" D ^%DT S X=Y K:Y<1 X
"^DD",403.56,403.56,201,3)
Enter the date the entry was cancelled or deleted.
"^DD",403.56,403.56,201,21,0)
^^2^2^3080717^
"^DD",403.56,403.56,201,21,1,0)
If the patient was deleted from the recall list because a clerk deleted
"^DD",403.56,403.56,201,21,2,0)
him/her, this is the date/time of the deletion.
"^DD",403.56,403.56,201,"DT")
3080717
"^DD",403.56,403.56,202,0)
DELETE CLERK^P200'^VA(200,^2;2^Q
"^DD",403.56,403.56,202,3)
Select the clerk who deleted or cancelled the Recall entry.
"^DD",403.56,403.56,202,21,0)
^^2^2^3080715^
"^DD",403.56,403.56,202,21,1,0)
If the patient was deleted from the recall list because a clerk deleted
"^DD",403.56,403.56,202,21,2,0)
him/her, this is the clerk who deleted the patient.
"^DD",403.56,403.56,202,"DT")
3080717
"^DD",403.56,403.56,203,0)
DELETE REASON^S^1:FAILURE TO RESPOND;2:MOVED;3:DECEASED;4:DOESN'T WANT VA SERVICES;5:RECEIVED CARE AT ANOTHER VA;6:OTHER;7:APPT SCHEDULED;^2;3^Q
"^DD",403.56,403.56,203,3)
Select the reason the entry was deleted or cancelled.
"^DD",403.56,403.56,203,21,0)
^^1^1^3080717^
"^DD",403.56,403.56,203,21,1,0)
The reason why a patient was removed from Recall.
"^DD",403.56,403.56,203,"DT")
3080717
"^DIC",403.5,403.5,0)
RECALL REMINDERS^403.5
"^DIC",403.5,403.5,0,"GL")
^SD(403.5,
"^DIC",403.5,403.5,"%",0)
^1.005^^0
"^DIC",403.5,403.5,"%D",0)
^^5^5^3080715^
"^DIC",403.5,403.5,"%D",1,0)
This file contains records for all active Recall Reminders. Once a 
"^DIC",403.5,403.5,"%D",2,0)
patient has called to make an appointment, the entry is then moved
"^DIC",403.5,403.5,"%D",3,0)
from this file to RECALL REMINDERS REMOVED file. Patients should not be
"^DIC",403.5,403.5,"%D",4,0)
entered into this file when their future appoitment is less than 30 days.
"^DIC",403.5,403.5,"%D",5,0)
The records are maintained by Recall Date and patient name.
"^DIC",403.5,"B","RECALL REMINDERS",403.5)

"^DIC",403.51,403.51,0)
RECALL REMINDERS APPT TYPE^403.51
"^DIC",403.51,403.51,0,"GL")
^SD(403.51,
"^DIC",403.51,403.51,"%",0)
^1.005^^0
"^DIC",403.51,403.51,"%D",0)
^^3^3^3080716^
"^DIC",403.51,403.51,"%D",1,0)
This file contains the Recall Types that a Recall Coordinator has created 
"^DIC",403.51,403.51,"%D",2,0)
for their hospital. The recall type is asked during creation of a Recall 
"^DIC",403.51,403.51,"%D",3,0)
entry for a patient. 
"^DIC",403.51,"B","RECALL REMINDERS APPT TYPE",403.51)

"^DIC",403.52,403.52,0)
RECALL REMINDERS LETTERS^403.52
"^DIC",403.52,403.52,0,"GL")
^SD(403.52,
"^DIC",403.52,403.52,"%",0)
^1.005^^0
"^DIC",403.52,403.52,"%D",0)
^^3^3^3080716^
"^DIC",403.52,403.52,"%D",1,0)
This file will contain all the clinics which will be using Recall Reminder
"^DIC",403.52,403.52,"%D",2,0)
and have decided to use Recall Letters. There is a wordprocessing field 
"^DIC",403.52,403.52,"%D",3,0)
within this file that can be designed for each clinic.
"^DIC",403.52,"B","RECALL REMINDERS LETTERS",403.52)

"^DIC",403.53,403.53,0)
RECALL REMINDERS PARAMETERS^403.53
"^DIC",403.53,403.53,0,"GL")
^SD(403.53,
"^DIC",403.53,403.53,"%",0)
^1.005^^0
"^DIC",403.53,403.53,"%D",0)
^^2^2^3080716^
"^DIC",403.53,403.53,"%D",1,0)
This file contains what type of Recall notification should be used. It 
"^DIC",403.53,403.53,"%D",2,0)
holds various settings for each entry.
"^DIC",403.53,"B","RECALL REMINDERS PARAMETERS",403.53)

"^DIC",403.54,403.54,0)
RECALL REMINDERS PROVIDERS^403.54
"^DIC",403.54,403.54,0,"GL")
^SD(403.54,
"^DIC",403.54,403.54,"%",0)
^1.005^^0
"^DIC",403.54,403.54,"%D",0)
^^3^3^3080715^
"^DIC",403.54,403.54,"%D",1,0)
This file will contain all Providers who have been entered into the 
"^DIC",403.54,403.54,"%D",2,0)
Recall Reminder application. Entries in this file must be in the New 
"^DIC",403.54,403.54,"%D",3,0)
Person file first.
"^DIC",403.54,"B","RECALL REMINDERS PROVIDERS",403.54)

"^DIC",403.55,403.55,0)
RECALL REMINDERS TEAM^403.55
"^DIC",403.55,403.55,0,"GL")
^SD(403.55,
"^DIC",403.55,403.55,"%",0)
^1.005^^0
"^DIC",403.55,403.55,"%D",0)
^^3^3^3080715^
"^DIC",403.55,403.55,"%D",1,0)
This file contains Recall Reminder Teams, which can be entered for 
"^DIC",403.55,403.55,"%D",2,0)
specialty areas or physical location. Entries in the file will be used 
"^DIC",403.55,403.55,"%D",3,0)
when setting up a Recall Provider.
"^DIC",403.55,"B","RECALL REMINDERS TEAM",403.55)

"^DIC",403.56,403.56,0)
RECALL REMINDERS REMOVED^403.56
"^DIC",403.56,403.56,0,"GL")
^SD(403.56,
"^DIC",403.56,403.56,"%",0)
^1.005^^0
"^DIC",403.56,403.56,"%D",0)
^1.001^2^2^3090611^^
"^DIC",403.56,403.56,"%D",1,0)
This file holds records deleted from the RECALL REMINDERS [#403.5]
"^DIC",403.56,403.56,"%D",2,0)
file, whether deleted by the user or because they were given appointments.
"^DIC",403.56,"B","RECALL REMINDERS REMOVED",403.56)

**INSTALL NAME**
OR*3.0*302
"BLD",7345,0)
OR*3.0*302^ORDER ENTRY/RESULTS REPORTING^0^3090825^y
"BLD",7345,4,0)
^9.64PA^^
"BLD",7345,6.3)
37
"BLD",7345,"ABPKG")
n
"BLD",7345,"KRN",0)
^9.67PA^779.2^20
"BLD",7345,"KRN",.4,0)
.4
"BLD",7345,"KRN",.401,0)
.401
"BLD",7345,"KRN",.402,0)
.402
"BLD",7345,"KRN",.403,0)
.403
"BLD",7345,"KRN",.5,0)
.5
"BLD",7345,"KRN",.84,0)
.84
"BLD",7345,"KRN",3.6,0)
3.6
"BLD",7345,"KRN",3.8,0)
3.8
"BLD",7345,"KRN",9.2,0)
9.2
"BLD",7345,"KRN",9.8,0)
9.8
"BLD",7345,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",7345,"KRN",9.8,"NM",1,0)
ORWCV^^0^B79773226
"BLD",7345,"KRN",9.8,"NM","B","ORWCV",1)

"BLD",7345,"KRN",19,0)
19
"BLD",7345,"KRN",19.1,0)
19.1
"BLD",7345,"KRN",101,0)
101
"BLD",7345,"KRN",409.61,0)
409.61
"BLD",7345,"KRN",771,0)
771
"BLD",7345,"KRN",779.2,0)
779.2
"BLD",7345,"KRN",870,0)
870
"BLD",7345,"KRN",8989.51,0)
8989.51
"BLD",7345,"KRN",8989.52,0)
8989.52
"BLD",7345,"KRN",8994,0)
8994
"BLD",7345,"KRN","B",.4,.4)

"BLD",7345,"KRN","B",.401,.401)

"BLD",7345,"KRN","B",.402,.402)

"BLD",7345,"KRN","B",.403,.403)

"BLD",7345,"KRN","B",.5,.5)

"BLD",7345,"KRN","B",.84,.84)

"BLD",7345,"KRN","B",3.6,3.6)

"BLD",7345,"KRN","B",3.8,3.8)

"BLD",7345,"KRN","B",9.2,9.2)

"BLD",7345,"KRN","B",9.8,9.8)

"BLD",7345,"KRN","B",19,19)

"BLD",7345,"KRN","B",19.1,19.1)

"BLD",7345,"KRN","B",101,101)

"BLD",7345,"KRN","B",409.61,409.61)

"BLD",7345,"KRN","B",771,771)

"BLD",7345,"KRN","B",779.2,779.2)

"BLD",7345,"KRN","B",870,870)

"BLD",7345,"KRN","B",8989.51,8989.51)

"BLD",7345,"KRN","B",8989.52,8989.52)

"BLD",7345,"KRN","B",8994,8994)

"BLD",7345,"QUES",0)
^9.62^^
"BLD",7345,"REQB",0)
^9.611^1^1
"BLD",7345,"REQB",1,0)
OR*3.0*282^2
"BLD",7345,"REQB","B","OR*3.0*282",1)

"MBREQ")
0
"PKG",174,-1)
1^1
"PKG",174,0)
ORDER ENTRY/RESULTS REPORTING^OR^Order Entry/Results Reporting
"PKG",174,22,0)
^9.49I^1^1
"PKG",174,22,1,0)
3.0^2971217^2990526^2441
"PKG",174,22,1,"PAH",1,0)
302^3090825^123456810
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","ORWCV")
0^1^B79773226
"RTN","ORWCV",1,0)
ORWCV ; SLC/KCM - Background Cover Sheet Load; ; 3/6/08 6:34am
"RTN","ORWCV",2,0)
 ;;3.0;ORDER ENTRY/RESULTS REPORTING;**10,85,109,132,209,214,195,215,260,243,282,302**;Dec 17, 1997;Build 37
"RTN","ORWCV",3,0)
 ;
"RTN","ORWCV",4,0)
 ;
"RTN","ORWCV",5,0)
 ; DBIA 1096    Reference to ^DGPM("ATID1"
"RTN","ORWCV",6,0)
 ; DBIA 1894    Reference to GETENC^PXAPI
"RTN","ORWCV",7,0)
 ; DBIA 1895    Reference to APPT2VST^PXAPI
"RTN","ORWCV",8,0)
 ; DBIA 2096    Reference to ^SD(409.63
"RTN","ORWCV",9,0)
 ; DBIA 2437    Reference to ^DGPM(
"RTN","ORWCV",10,0)
 ; DBIA 2965    Reference to ^DIC(405.1
"RTN","ORWCV",11,0)
 ; DBIA 4011    Access ^XWB(8994)
"RTN","ORWCV",12,0)
 ; DBIA 4313    Direct R/W permission to capacity mgmt global ^KMPTMP("KMPDT")
"RTN","ORWCV",13,0)
 ; DBIA 4325    References to AWCMCPR1
"RTN","ORWCV",14,0)
 ; DBIA 10061   Reference to ^UTILITY
"RTN","ORWCV",15,0)
 ; CPRS has a SACC exemption for usage of the variable $ZE
"RTN","ORWCV",16,0)
 ; 
"RTN","ORWCV",17,0)
START(VAL,DFN,IP,HWND,LOC,NODO,NEWREM) ; start cover sheet build in background
"RTN","ORWCV",18,0)
 N ZTIO,ZTRTN,ZTDTH,ZTSAVE,ZTDESC,SECT,BACK,X,I,ORLIST,STR,FILE,NODE,ORHTIME,ORX
"RTN","ORWCV",19,0)
 ; Capacity planning timing code uses ORHTIME
"RTN","ORWCV",20,0)
 S ORHTIME=$H
"RTN","ORWCV",21,0)
 S LOC=$G(LOC),NODO=";"_$G(NODO),NEWREM=+$G(NEWREM)
"RTN","ORWCV",22,0)
 D GETLST^XPAR(.ORX,"SYS^PKG","ORWOR COVER RETRIEVAL NEW","Q")
"RTN","ORWCV",23,0)
 S I=0 F  S I=$O(ORX(I)) Q:'I  I $D(^ORD(101.24,+ORX(I),0)) S SECT(+$P(^(0),"^",2))=$P(ORX(I),"^",2)
"RTN","ORWCV",24,0)
 D GETLST^XPAR(.ORLIST,"ALL","ORWCV1 COVERSHEET LIST")
"RTN","ORWCV",25,0)
 S (VAL,BACK,STR,FILE)=""
"RTN","ORWCV",26,0)
 F  S I=$O(ORLIST(I)) Q:'I  I $D(^ORD(101.24,$P(ORLIST(I),"^",2),0))  S X0=^(0) D
"RTN","ORWCV",27,0)
 . Q:$P(X0,"^",8)'="C"
"RTN","ORWCV",28,0)
 . S X=$P(X0,"^",2)
"RTN","ORWCV",29,0)
 . I NODO[(";"_X_";") Q                                  ; if in NODO, dont do section
"RTN","ORWCV",30,0)
 . S STR=STR_X_";"
"RTN","ORWCV",31,0)
 . I '$G(SECT(X)) S VAL=VAL_X_";"                        ; load section in foreground
"RTN","ORWCV",32,0)
 . E  S BACK=BACK_X_";",FILE=FILE_$P(ORLIST(I),"^",2)_";"  ; load section in background
"RTN","ORWCV",33,0)
 Q:BACK=""
"RTN","ORWCV",34,0)
 S ZTIO="ORW THREAD RESOURCE",ZTRTN="BUILD^ORWCV",ZTDTH=$H
"RTN","ORWCV",35,0)
 S (ZTSAVE("DFN"),ZTSAVE("IP"),ZTSAVE("HWND"),ZTSAVE("NEWREM"),ZTSAVE("LOC"),ZTSAVE("BACK"),ZTSAVE("FILE"))=""
"RTN","ORWCV",36,0)
 S ZTDESC="CPRS GUI Background Data Retrieval"
"RTN","ORWCV",37,0)
 D ^%ZTLOAD I '$D(ZTSK) S VAL=STR Q
"RTN","ORWCV",38,0)
 S NODE="ORWCV "_IP_"-"_HWND_"-"_DFN
"RTN","ORWCV",39,0)
 K ^XTMP(NODE)
"RTN","ORWCV",40,0)
 S ^XTMP(NODE,0)=$$FMADD^XLFDT(DT,1)_U_DT_U_"Background CPRS "_ZTSK
"RTN","ORWCV",41,0)
 ; Start capacity planning timing clock - will be stopped in POLL code
"RTN","ORWCV",42,0)
 I +$G(^KMPTMP("KMPD-CPRS")) S ^KMPTMP("KMPDT","ORWCV",NODE)=$G(ORHTIME)_"^^"_$G(DUZ)_"^"_$G(IO("CLNM"))
"RTN","ORWCV",43,0)
 Q
"RTN","ORWCV",44,0)
BUILD ; called in background by task manager, expects DFN, JobID 
"RTN","ORWCV",45,0)
 N NODE,IFLE,ORFNUM,ID,ENT,RTN,INODE,PARAM1,PARAM2,DETAIL,X0,X2
"RTN","ORWCV",46,0)
 S NODE="ORWCV "_IP_"-"_HWND_"-"_DFN
"RTN","ORWCV",47,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","ORWCV",48,0)
 I $G(^XTMP(NODE,"STOP")) K ^XTMP(NODE) Q  ; client no longer polling
"RTN","ORWCV",49,0)
 I '$D(^XTMP(NODE,0)) Q                    ; XTMP node has been purged
"RTN","ORWCV",50,0)
 L +^XTMP(NODE)
"RTN","ORWCV",51,0)
 S ^XTMP(NODE,"DFN")=DFN
"RTN","ORWCV",52,0)
 ;N $ETRAP,$ESTACK
"RTN","ORWCV",53,0)
 ;S $ETRAP="D ERR^ORWCV Q"
"RTN","ORWCV",54,0)
 I $L($G(FILE),";")>0 F IFLE=1:1:$L(FILE,";") S ORFNUM=$P(FILE,";",IFLE)  Q:'$D(^ORD(101.24,+ORFNUM,0))  S X0=^(0),X2=$G(^(2)) D
"RTN","ORWCV",55,0)
 . S ID=$P(X0,"^",2),ENT=$P(X0,"^",6),RTN=$P(X0,"^",5),PARAM1=$P(X2,"^"),PARAM2=$P(X2,"^",2),INODE=$P(X2,"^",5),DETAIL=""
"RTN","ORWCV",56,0)
 . I $P(X0,"^",18) S DETAIL=$P($G(^ORD(101.24,+$P(X0,"^",18),0)),"^",13),DETAIL=$P($G(^XWB(8994,+DETAIL,0)),"^")  ;DBIA 4011
"RTN","ORWCV",57,0)
 . I '$L(INODE) Q
"RTN","ORWCV",58,0)
 . I '$L(ENT) S LST(IFLE)="0^ERROR: Missing ENTRY POINT field in file 101.24 for "_$P(X0,"^")_", IFN="_+ORFNUM D LST2XTMP(INODE) Q
"RTN","ORWCV",59,0)
 . I '$L(RTN) S LST(IFLE)="0^ERROR: Missing ROUTINE field in file 101.24 for "_$P(X0,"^")_", IFN="_+ORFNUM D LST2XTMP(INODE) Q
"RTN","ORWCV",60,0)
 . I '$L($T(@(ENT_"^"_RTN))) S LST(IFLE)="0^ERROR: "_ENT_"~"_RTN_" does not exist. See file 101.24 entry: "_$P(X0,"^")_", IFN="_+ORFNUM D LST2XTMP(INODE) Q
"RTN","ORWCV",61,0)
 . I ID=50 D:$L($T(STRT3^AWCMCPR1)) STRT3^AWCMCPR1 D  D:$L($T(END^AWCMCPR1)) END^AWCMCPR1 Q  ;Special case for reminders
"RTN","ORWCV",62,0)
 .. I $G(NEWREM) D APPL^ORQQPXRM(.LST,DFN,LOC) I 1
"RTN","ORWCV",63,0)
 .. E  D @(ENT_"^"_RTN_"(.LST,DFN)")
"RTN","ORWCV",64,0)
 .. D LST2XTMP(INODE)
"RTN","ORWCV",65,0)
 . I $L(PARAM1),$L(PARAM2) D @(ENT_"^"_RTN_"(.LST,DFN,PARAM1,PARAM2)"),LST2XTMP(INODE) Q
"RTN","ORWCV",66,0)
 . I $L(PARAM1) D @(ENT_"^"_RTN_"(.LST,DFN,PARAM1)"),LST2XTMP(INODE) Q
"RTN","ORWCV",67,0)
 . D @(ENT_"^"_RTN_"(.LST,DFN)"),LST2XTMP(INODE)
"RTN","ORWCV",68,0)
 S ^XTMP(NODE,"DONE")=1
"RTN","ORWCV",69,0)
 I $G(^XTMP(NODE,"STOP")) K ^XTMP(NODE)
"RTN","ORWCV",70,0)
 L -^XTMP(NODE)
"RTN","ORWCV",71,0)
 Q
"RTN","ORWCV",72,0)
ERR ;Error trap
"RTN","ORWCV",73,0)
 S $ETRAP="D UNWIND^ORWCV Q"
"RTN","ORWCV",74,0)
 I $D(NODE) D
"RTN","ORWCV",75,0)
 . I $D(INODE) S LST(0)="",LST(1)="0^ERROR DURING COVER SHEET BUILD:"_$ZERROR D LST2XTMP(INODE)
"RTN","ORWCV",76,0)
 . S ^XTMP(NODE,"DONE")=1
"RTN","ORWCV",77,0)
 . L -^XTMP(NODE)
"RTN","ORWCV",78,0)
 D @^%ZOSF("ERRTN") ;file error
"RTN","ORWCV",79,0)
 S $ECODE=",UOR70 error during Cover Sheet build,"
"RTN","ORWCV",80,0)
 Q
"RTN","ORWCV",81,0)
UNWIND ;Unwind Error stack
"RTN","ORWCV",82,0)
 Q:$ESTACK>1  ;pop the stack
"RTN","ORWCV",83,0)
 ;add additional code here, if needed
"RTN","ORWCV",84,0)
 Q
"RTN","ORWCV",85,0)
LST2XTMP(ID) ; put the list in ^XTMP(NODE,ID)
"RTN","ORWCV",86,0)
 I $G(^XTMP(NODE,"STOP")) Q
"RTN","ORWCV",87,0)
 N I
"RTN","ORWCV",88,0)
 I $L($G(DETAIL)) S I=0 F  S I=$O(LST(I)) Q:'I  S $P(LST(I),"^",12)=DETAIL
"RTN","ORWCV",89,0)
 K ^XTMP(NODE,ID) M ^XTMP(NODE,ID)=LST S ^XTMP(NODE,ID)=1 K LST
"RTN","ORWCV",90,0)
 Q
"RTN","ORWCV",91,0)
POLL(LST,DFN,IP,HWND) ; poll for completed cover sheet parts
"RTN","ORWCV",92,0)
 N I,ILST,ID,NODE,DONE
"RTN","ORWCV",93,0)
 S NODE="ORWCV "_IP_"-"_HWND_"-"_DFN,ILST=0,DONE=0
"RTN","ORWCV",94,0)
 I '$D(^XTMP(NODE,"DFN")) Q
"RTN","ORWCV",95,0)
 I ^XTMP(NODE,"DFN")'=DFN S LST(1)="~DONE=1" Q
"RTN","ORWCV",96,0)
 I $G(^XTMP(NODE,"DONE")) S ILST=ILST+1,LST(ILST)="~DONE=1",DONE=1
"RTN","ORWCV",97,0)
 F ID="PROB","CWAD","MEDS","RMND","LABS","VITL","VSIT" D
"RTN","ORWCV",98,0)
 . I '$G(^XTMP(NODE,ID)) Q
"RTN","ORWCV",99,0)
 . S ILST=ILST+1,LST(ILST)="~"_ID
"RTN","ORWCV",100,0)
 . S I=0 F  S I=$O(^XTMP(NODE,ID,I)) Q:'I  S ILST=ILST+1,LST(ILST)="i"_^(I)
"RTN","ORWCV",101,0)
 . K ^XTMP(NODE,ID)
"RTN","ORWCV",102,0)
 ; Stop capacity planning timing clock - was started in START code
"RTN","ORWCV",103,0)
 I DONE K ^XTMP(NODE) I +$G(^KMPTMP("KMPD-CPRS")) S $P(^KMPTMP("KMPDT","ORWCV",NODE),"^",2)=$H
"RTN","ORWCV",104,0)
 Q
"RTN","ORWCV",105,0)
STOP(OK,DFN,IP,HWND) ; stop cover sheet data retrieval
"RTN","ORWCV",106,0)
 S NODE="ORWCV "_IP_"-"_HWND_"-"_DFN,ILST=0,DONE=0
"RTN","ORWCV",107,0)
 S ^XTMP(NODE,"STOP")=1,OK=1
"RTN","ORWCV",108,0)
 L +^XTMP(NODE)
"RTN","ORWCV",109,0)
 I $G(^XTMP(NODE,"DONE")) K ^XTMP(NODE)
"RTN","ORWCV",110,0)
 L -^XTMP(NODE)
"RTN","ORWCV",111,0)
 Q
"RTN","ORWCV",112,0)
CLEAN ; clean up ^XTMP nodes
"RTN","ORWCV",113,0)
 S X="ORWCV"
"RTN","ORWCV",114,0)
 F  S X=$O(^XTMP(X)) Q:$E(X,1,5)'="ORWCV"  W !,X K ^XTMP(X)
"RTN","ORWCV",115,0)
 Q
"RTN","ORWCV",116,0)
LAB(LST,DFN) ; return labs for patient
"RTN","ORWCV",117,0)
 D:$L($T(STRT2^AWCMCPR1)) STRT2^AWCMCPR1
"RTN","ORWCV",118,0)
 D LIST^ORQOR1(.LST,DFN,"LAB",4,"T-"_$$RNGLAB(DFN),"T","AW",1)
"RTN","ORWCV",119,0)
 D:$L($T(END^AWCMCPR1)) END^AWCMCPR1
"RTN","ORWCV",120,0)
 Q
"RTN","ORWCV",121,0)
 ;
"RTN","ORWCV",122,0)
VST1(ORVISIT,DFN,BEG,END,SKIP) ;
"RTN","ORWCV",123,0)
 N ERR,ERRMSG
"RTN","ORWCV",124,0)
 S ERR=0 ; kludge to return errors
"RTN","ORWCV",125,0)
 Q:'$G(DFN)
"RTN","ORWCV",126,0)
 D VST(.ORVISIT,DFN,.BEG,.END,$G(SKIP),.ERR,.ERRMSG)
"RTN","ORWCV",127,0)
 I ERR K ORVISIT S ORVISIT(1)=ERRMSG
"RTN","ORWCV",128,0)
 Q
"RTN","ORWCV",129,0)
 ;
"RTN","ORWCV",130,0)
TEST ;D VST(.ZZZ,76,2950101,3050401,777,1,1)
"RTN","ORWCV",131,0)
 Q
"RTN","ORWCV",132,0)
VST(ORVISIT,DFN,BEG,END,SKIP,ERR,ERRMSG) ; return appts/admissions for patient
"RTN","ORWCV",133,0)
 N CHECKERR,VAERR,VASD,BDT,COUNT,DTM,EDT,LOC,NOW,ORQUERY,ORLST,STI,STS,TODAY,I,J,K,XI,XE,X
"RTN","ORWCV",134,0)
 S CHECKERR=($G(ERR)=0) ; kludge to check for errors
"RTN","ORWCV",135,0)
 S NOW=$$NOW^XLFDT(),TODAY=$P(NOW,".",1)
"RTN","ORWCV",136,0)
 I '$G(BEG) S BEG=$$X2FM($$RNGVBEG)
"RTN","ORWCV",137,0)
 I '$G(END) S END=$$X2FM($$RNGVEND)+0.2359
"RTN","ORWCV",138,0)
 S COUNT=0
"RTN","ORWCV",139,0)
 K ^TMP("ORVSTLIST",$J)
"RTN","ORWCV",140,0)
 S VAERR=0
"RTN","ORWCV",141,0)
 I END>NOW D   Q:VAERR  ; get future encounters, past cancels/no-shows from VADPT
"RTN","ORWCV",142,0)
 . S VASD("F")=BEG
"RTN","ORWCV",143,0)
 . S VASD("T")=END
"RTN","ORWCV",144,0)
 . S VASD("W")="123456789"
"RTN","ORWCV",145,0)
 . D SDA^ORQRY01(.ERR,.ERRMSG)
"RTN","ORWCV",146,0)
 . I CHECKERR,ERR K ^UTILITY("VASD",$J) S ORVISIT(1)=ERRMSG Q  ;IA 10061
"RTN","ORWCV",147,0)
 . S I=0 F  S I=$O(^UTILITY("VASD",$J,I)) Q:'I  D
"RTN","ORWCV",148,0)
 . . S XI=^UTILITY("VASD",$J,I,"I"),XE=^("E")
"RTN","ORWCV",149,0)
 . . S DTM=$P(XI,U),IEN=$P(XI,U,2),STI=$P(XI,U,3)
"RTN","ORWCV",150,0)
 . . S LOC=$P(XE,U,2),STS=$P(XE,U,3)
"RTN","ORWCV",151,0)
 . . I DTM<TODAY,(STI=""!(STI["I")!(STI="NT")) Q  ; no prior kept appts
"RTN","ORWCV",152,0)
 . . S ^TMP("ORVSTLIST",$J,DTM,"A",1)="A;"_DTM_";"_IEN_U_DTM_U_LOC_U_STS
"RTN","ORWCV",153,0)
 . K ^UTILITY("VASD",$J)
"RTN","ORWCV",154,0)
 I BEG'>NOW D  ;past encounters from ACRP Toolkit - set in CALLBACK
"RTN","ORWCV",155,0)
 . S BDT=BEG
"RTN","ORWCV",156,0)
 . S EDT=$S(END<NOW:END,1:NOW)
"RTN","ORWCV",157,0)
 . D COVER^SDRROR
"RTN","ORWCV",158,0)
 . D OPEN^SDQ(.ORQUERY)
"RTN","ORWCV",159,0)
 . I '$$ERRCHK^SDQUT() D INDEX^SDQ(.ORQUERY,"PATIENT/DATE","SET")
"RTN","ORWCV",160,0)
 . I '$$ERRCHK^SDQUT() D PAT^SDQ(.ORQUERY,DFN,"SET")
"RTN","ORWCV",161,0)
 . I '$$ERRCHK^SDQUT() D DATE^SDQ(.ORQUERY,BDT,EDT,"SET")
"RTN","ORWCV",162,0)
 . I '$$ERRCHK^SDQUT() D
"RTN","ORWCV",163,0)
 . . S ORLST=$NA(^TMP("ORVSTLIST",$J))
"RTN","ORWCV",164,0)
 . . D SCANCB^SDQ(.ORQUERY,"D CALLBACK^ORWCV(Y,Y0,.ORLST,.ORSTOP)","SET")
"RTN","ORWCV",165,0)
 . I '$$ERRCHK^SDQUT() D ACTIVE^SDQ(.ORQUERY,"TRUE","SET")
"RTN","ORWCV",166,0)
 . I '$$ERRCHK^SDQUT() D SCAN^SDQ(.ORQUERY,"FORWARD")
"RTN","ORWCV",167,0)
 . D CLOSE^SDQ(.ORQUERY)
"RTN","ORWCV",168,0)
 ;
"RTN","ORWCV",169,0)
 I '$G(SKIP) D
"RTN","ORWCV",170,0)
 . N TIM,MOV,X0,Y,MTIM,XTYP,XLOC,HLOC,EARLY,DONE                ; admits
"RTN","ORWCV",171,0)
 . S EARLY=$$X2FM($$RNGVBEG),DONE=0
"RTN","ORWCV",172,0)
 . S TIM="" F  S TIM=$O(^DGPM("ATID1",DFN,TIM)) Q:TIM'>0  D  Q:DONE
"RTN","ORWCV",173,0)
 . . S MOV=0  F  S MOV=$O(^DGPM("ATID1",DFN,TIM,MOV)) Q:MOV'>0  D  Q:DONE
"RTN","ORWCV",174,0)
 . . . S X0=^DGPM(MOV,0),MTIM=$P(X0,U)
"RTN","ORWCV",175,0)
 . . . I MTIM<EARLY S DONE=1 Q
"RTN","ORWCV",176,0)
 . . . S XTYP=$P($G(^DG(405.1,+$P(X0,U,4),0)),U,1)
"RTN","ORWCV",177,0)
 . . . S XLOC=$P($G(^DIC(42,+$P(X0,U,6),0)),U,1),HLOC=+$G(^(44))
"RTN","ORWCV",178,0)
 . . . S ^TMP("ORVSTLIST",$J,MTIM,"I",1)="I;"_MTIM_";"_HLOC_U_MTIM_U_"Inpatient Stay"_U_XLOC_U_XTYP
"RTN","ORWCV",179,0)
 ;
"RTN","ORWCV",180,0)
 S COUNT=0
"RTN","ORWCV",181,0)
 S I=0 F  S I=$O(^TMP("ORVSTLIST",$J,I)) Q:'I  D
"RTN","ORWCV",182,0)
 . S J="" F  S J=$O(^TMP("ORVSTLIST",$J,I,J)) Q:J=""  D
"RTN","ORWCV",183,0)
 . . S K=0 F  S K=$O(^TMP("ORVSTLIST",$J,I,J,K)) Q:'K  D
"RTN","ORWCV",184,0)
 . . . S COUNT=COUNT+1
"RTN","ORWCV",185,0)
 . . . S ORVISIT(COUNT)=^TMP("ORVSTLIST",$J,I,J,K)
"RTN","ORWCV",186,0)
 K ^TMP("ORVSTLIST",$J)
"RTN","ORWCV",187,0)
 Q
"RTN","ORWCV",188,0)
CALLBACK(IEN,NODE0,ARRAY,STOP) ; called back from ACRP Toolkit for encounters
"RTN","ORWCV",189,0)
 ;
"RTN","ORWCV",190,0)
 ; IEN and NODE0 relate to Outpatient Encounter File
"RTN","ORWCV",191,0)
 ; set STOP to 1 if need to quit
"RTN","ORWCV",192,0)
 ;
"RTN","ORWCV",193,0)
 N COUNT,DTM,LOC,OOS,TYPE,XSTAT,XLOC
"RTN","ORWCV",194,0)
 S DTM=+NODE0,COUNT=1
"RTN","ORWCV",195,0)
 S LOC=$P(NODE0,"^",4)
"RTN","ORWCV",196,0)
 S XLOC=$P($G(^SC(+LOC,0)),U),OOS=$G(^("OOS"))
"RTN","ORWCV",197,0)
 I OOS Q              ; ignore OOS locations
"RTN","ORWCV",198,0)
 I $P(NODE0,"^",6) Q  ; not parent encounter
"RTN","ORWCV",199,0)
 S XSTAT=$P($G(^SD(409.63,+$P(NODE0,"^",12),0)),"^")
"RTN","ORWCV",200,0)
 S TYPE=$S($P(NODE0,"^",8)=1:"A",1:"V")
"RTN","ORWCV",201,0)
 I TYPE="V",$D(@ARRAY@(DTM,"V")) S COUNT=$O(@ARRAY@(DTM,"V","A"),-1)+1 ; same d/t
"RTN","ORWCV",202,0)
 S @ARRAY@(DTM,TYPE,COUNT)=TYPE_";"_DTM_";"_LOC_U_DTM_U_XLOC_U_XSTAT
"RTN","ORWCV",203,0)
 Q
"RTN","ORWCV",204,0)
DTLVST(RPT,DFN,IEN,APPTINFO) ; return progress notes / discharge summary
"RTN","ORWCV",205,0)
 N VISIT
"RTN","ORWCV",206,0)
 I $P(APPTINFO,";")="A" D  Q
"RTN","ORWCV",207,0)
 . S VISIT=$$APPT2VST^PXAPI(DFN,$P(APPTINFO,";",2),$P(APPTINFO,";",3))
"RTN","ORWCV",208,0)
 . I VISIT=0 S VISIT=+$$GETENC^PXAPI(DFN,$P(APPTINFO,";",2),$P(APPTINFO,";",3))
"RTN","ORWCV",209,0)
 . D DETNOTE^ORQQVS(.RPT,DFN,VISIT)
"RTN","ORWCV",210,0)
 I $P(APPTINFO,";")="V" D  Q
"RTN","ORWCV",211,0)
 . S VISIT=+$$GETENC^PXAPI(DFN,$P(APPTINFO,";",2),$P(APPTINFO,";",3))
"RTN","ORWCV",212,0)
 . D DETNOTE^ORQQVS(.RPT,DFN,VISIT)
"RTN","ORWCV",213,0)
 I $P(APPTINFO,";")="I" D  Q
"RTN","ORWCV",214,0)
 . S VISIT=+$$GETENC^PXAPI(DFN,$P(APPTINFO,";",2),$P(APPTINFO,";",3))
"RTN","ORWCV",215,0)
 . D DETSUM^ORQQVS(.RPT,DFN,VISIT)
"RTN","ORWCV",216,0)
 . K ^TMP("PXKENC",$J)
"RTN","ORWCV",217,0)
 I $P(APPTINFO,";")="R" D RCDTL^SDRROR
"RTN","ORWCV",218,0)
 Q
"RTN","ORWCV",219,0)
X2FM(X) ; return FM date given relative date
"RTN","ORWCV",220,0)
 N %DT S %DT="TS" D ^%DT
"RTN","ORWCV",221,0)
 Q Y
"RTN","ORWCV",222,0)
RNGLAB(DFN) ; return days back for patient
"RTN","ORWCV",223,0)
 N INPT,PAR,LOC
"RTN","ORWCV",224,0)
 S INPT=0 I $L($G(^DPT(DFN,.1))) S INPT=1,LOC=^(.1)
"RTN","ORWCV",225,0)
 S PAR="ORQQLR DATE RANGE "_$S(INPT:"INPT",1:"OUTPT")
"RTN","ORWCV",226,0)
 Q $$GET^XPAR("ALL"_$S(INPT:"^LOC."_LOC,1:""),PAR,1,"I")
"RTN","ORWCV",227,0)
 ;
"RTN","ORWCV",228,0)
RNGVBEG() ; return start date for encounters
"RTN","ORWCV",229,0)
 Q $$GET^XPAR("ALL","ORQQCSDR CS RANGE START",1,"I")
"RTN","ORWCV",230,0)
 ;
"RTN","ORWCV",231,0)
RNGVEND() ; return stop date for encounters
"RTN","ORWCV",232,0)
 Q $$GET^XPAR("ALL","ORQQCSDR CS RANGE STOP",1,"I")
"RTN","ORWCV",233,0)
 ;
"RTN","ORWCV",234,0)
RANGES(REC,DFN) ; return ranges given a patient
"RTN","ORWCV",235,0)
 N REC
"RTN","ORWCV",236,0)
 S REC=$$RNGLAB(DFN)_U_$$RNGVBEG_U_$$RNGVEND
"RTN","ORWCV",237,0)
 Q
"VER")
8.0^22.0
**END**
**END**
