KIDS Distribution saved on Aug 04, 2009@13:40:34
PATCH RMPR*151/PRC*123
**KIDS**:RMPR*3.0*151^PRC*5.1*123^

**INSTALL NAME**
RMPR*3.0*151
"BLD",8060,0)
RMPR*3.0*151^PROSTHETICS^0^3090804^y
"BLD",8060,1,0)
^^1^1^3090507^
"BLD",8060,1,1,0)
1. <UNDEFINED>DT442+7^PRCFFUD1
"BLD",8060,4,0)
^9.64PA^^
"BLD",8060,6.3)
6
"BLD",8060,"ABPKG")
n
"BLD",8060,"KRN",0)
^9.67PA^779.2^20
"BLD",8060,"KRN",.4,0)
.4
"BLD",8060,"KRN",.401,0)
.401
"BLD",8060,"KRN",.402,0)
.402
"BLD",8060,"KRN",.403,0)
.403
"BLD",8060,"KRN",.5,0)
.5
"BLD",8060,"KRN",.84,0)
.84
"BLD",8060,"KRN",3.6,0)
3.6
"BLD",8060,"KRN",3.8,0)
3.8
"BLD",8060,"KRN",9.2,0)
9.2
"BLD",8060,"KRN",9.8,0)
9.8
"BLD",8060,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",8060,"KRN",9.8,"NM",1,0)
RMPR121B^^0^B20025708
"BLD",8060,"KRN",9.8,"NM","B","RMPR121B",1)

"BLD",8060,"KRN",19,0)
19
"BLD",8060,"KRN",19.1,0)
19.1
"BLD",8060,"KRN",101,0)
101
"BLD",8060,"KRN",409.61,0)
409.61
"BLD",8060,"KRN",771,0)
771
"BLD",8060,"KRN",779.2,0)
779.2
"BLD",8060,"KRN",870,0)
870
"BLD",8060,"KRN",8989.51,0)
8989.51
"BLD",8060,"KRN",8989.52,0)
8989.52
"BLD",8060,"KRN",8994,0)
8994
"BLD",8060,"KRN","B",.4,.4)

"BLD",8060,"KRN","B",.401,.401)

"BLD",8060,"KRN","B",.402,.402)

"BLD",8060,"KRN","B",.403,.403)

"BLD",8060,"KRN","B",.5,.5)

"BLD",8060,"KRN","B",.84,.84)

"BLD",8060,"KRN","B",3.6,3.6)

"BLD",8060,"KRN","B",3.8,3.8)

"BLD",8060,"KRN","B",9.2,9.2)

"BLD",8060,"KRN","B",9.8,9.8)

"BLD",8060,"KRN","B",19,19)

"BLD",8060,"KRN","B",19.1,19.1)

"BLD",8060,"KRN","B",101,101)

"BLD",8060,"KRN","B",409.61,409.61)

"BLD",8060,"KRN","B",771,771)

"BLD",8060,"KRN","B",779.2,779.2)

"BLD",8060,"KRN","B",870,870)

"BLD",8060,"KRN","B",8989.51,8989.51)

"BLD",8060,"KRN","B",8989.52,8989.52)

"BLD",8060,"KRN","B",8994,8994)

"BLD",8060,"QUES",0)
^9.62^^
"BLD",8060,"REQB",0)
^9.611^1^1
"BLD",8060,"REQB",1,0)
RMPR*3.0*147^2
"BLD",8060,"REQB","B","RMPR*3.0*147",1)

"MBREQ")
0
"PKG",280,-1)
1^1
"PKG",280,0)
PROSTHETICS^RMPR^PROSTHETICS VERSION 3.0 ALPHA
"PKG",280,20,0)
^9.402P^^0
"PKG",280,22,0)
^9.49I^1^1
"PKG",280,22,1,0)
3.0^2960209^2970624
"PKG",280,22,1,"PAH",1,0)
151^3090804
"PKG",280,22,1,"PAH",1,1,0)
^^1^1^3090804
"PKG",280,22,1,"PAH",1,1,1,0)
1. <UNDEFINED>DT442+7^PRCFFUD1
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","RMPR121B")
0^1^B20025708
"RTN","RMPR121B",1,0)
RMPR121B ;PHX/HNC -POST GUI PURCHASE ORDER TRANSACTION ;3/1/2003
"RTN","RMPR121B",2,0)
 ;;3.0;PROSTHETICS;**90,75,137,147,151**;FEB 09,1996;Build 6
"RTN","RMPR121B",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","RMPR121B",4,0)
A1(SIG,RMPRA,RMPRSITE) S RMPRGUI=1 G A2
"RTN","RMPR121B",5,0)
GUI(RESULT,SIG,RMPRA,RMPRSITE,RMPRPTR) ;
"RTN","RMPR121B",6,0)
A2 I (SIG="")!($E(SIG)="^") S RESULT=1_"^"_"Not Valid, Try Again..." Q
"RTN","RMPR121B",7,0)
 K RESULT D SIGN
"RTN","RMPR121B",8,0)
 Q
"RTN","RMPR121B",9,0)
 ;
"RTN","RMPR121B",10,0)
SIGN ; Validate /es/-code
"RTN","RMPR121B",11,0)
 ;
"RTN","RMPR121B",12,0)
 S X=SIG
"RTN","RMPR121B",13,0)
 S RMPRY=0
"RTN","RMPR121B",14,0)
 D HASH^XUSHSHP I X]"",(X=$P($G(^VA(200,+DUZ,20)),U,4)) S RMPRY=1
"RTN","RMPR121B",15,0)
 I RMPRY=0 S RESULT=1_"^"_"Checked signature Not Valid, Try Again..." Q
"RTN","RMPR121B",16,0)
 ;
"RTN","RMPR121B",17,0)
 S RMPRV=$P(^RMPR(664,RMPRA,0),U,4)
"RTN","RMPR121B",18,0)
 S RMPRPER=$P(^RMPR(664,RMPRA,2),U,6)/100
"RTN","RMPR121B",19,0)
 D GUIVAR
"RTN","RMPR121B",20,0)
 S PRCRMPR=1,X=1
"RTN","RMPR121B",21,0)
 D UP1^PRCH7PUC(.X,PRCA,PRCB,PRCC,PRCSITE,PRCVEN,PRCRMPR)
"RTN","RMPR121B",22,0)
 I X="^"!(X="#") D C664 G QUIT
"RTN","RMPR121B",23,0)
 S PRC442=$P(^RMPR(664,RMPRA,4),U,6)
"RTN","RMPR121B",24,0)
 I $P(^PRC(442,PRC442,7),U,1)'=6 G QUT
"RTN","RMPR121B",25,0)
 S $P(^RMPR(664,RMPRA,0),U,5)="",$P(^RMPR(664,RMPRA,2),U)="",$P(^RMPR(664,RMPRA,2),U,2)=""
"RTN","RMPR121B",26,0)
 I $D(RMPRPSC) S $P(^RMPR(664,RMPRA,2),U,5)=RMPRPSC
"RTN","RMPR121B",27,0)
 S RMPRPCD=$P(^RMPR(664,RMPRA,4),U,1),$P(^RMPR(664,RMPRA,4),U,1)=$$ENC^RMPR4LI(RMPRPCD,DUZ,RMPRA)
"RTN","RMPR121B",28,0)
 S DA=RMPRA,DIK="^RMPR(664," D IX1^DIK
"RTN","RMPR121B",29,0)
 ;get AMIS grouper number
"RTN","RMPR121B",30,0)
 L +^RMPR(669.9,RMPRSITE,0):999 I $T=0 S RMPRG=DT_99 G GGC
"RTN","RMPR121B",31,0)
 S RMPRG=$P(^RMPR(669.9,RMPRSITE,0),U,7),RMPRG=RMPRG-1,$P(^(0),U,7)=RMPRG L -^RMPR(669.9,RMPRSITE,0)
"RTN","RMPR121B",32,0)
 ;
"RTN","RMPR121B",33,0)
GGC S B2=0
"RTN","RMPR121B",34,0)
 F  S B2=$O(^RMPR(664,RMPRA,1,B2)) Q:B2'>0  D R19^RMPR121C
"RTN","RMPR121B",35,0)
 K RMPRDP
"RTN","RMPR121B",36,0)
 ; Shipping Record
"RTN","RMPR121B",37,0)
 I +RMPRSH'>0 G NS
"RTN","RMPR121B",38,0)
 K DD,DO S X=DT,DIC="^RMPR(660,",DIC(0)="LZ" D FILE^DICN K DIC,D0 S (RMPR660,DA)=+Y
"RTN","RMPR121B",39,0)
 S RMPRTRN=$P(^RMPR(664,RMPRA,4),U,5)
"RTN","RMPR121B",40,0)
 S $P(^RMPR(660,RMPR660,4),U,3)=RMPRV
"RTN","RMPR121B",41,0)
 S ^RMPR(660,RMPR660,0)=DT_U_RMPRDFN_U_DT_"^X^^^^^"_U_RMPR("STA")_"^^^14"_U_RMPRS_"^^"_RMPRSH_"^"_RMPRSH_"^^^^^",^("AMS")=RMPRG,^("AM")=U_U_RMPRDIS_U_RMPRSC,$P(^(0),U,27)=DUZ
"RTN","RMPR121B",42,0)
 ; /SPS Removed the following 2 lines for 75 may re-use at a later time
"RTN","RMPR121B",43,0)
 ; I $D(RMPRWO),RMPRWO S $P(^("AM"),U,2)=1 D
"RTN","RMPR121B",44,0)
 ;.I $D(^RMPR(664.2,RMPRWO,0)) S $P(^(0),U,6)=$P(^(0),U,6)+RMPRSH
"RTN","RMPR121B",45,0)
 S:$D(RMPRDELN) ^RMPR(660,RMPR660,3)=RMPRDELN S ^(1)=RMPRTRN
"RTN","RMPR121B",46,0)
 S DIK="^RMPR(660," D IX1^DIK S $P(^RMPR(664,RMPRA,0),U,12)=RMPR660 K RMPRDP
"RTN","RMPR121B",47,0)
NS S $P(^RMPR(664,RMPRA,2),U,4)="2421PC"
"RTN","RMPR121B",48,0)
 S RESULT=0_"^"_"PO COMPLETE"
"RTN","RMPR121B",49,0)
 S ^TMP("SPS",0)=RMPRPTR
"RTN","RMPR121B",50,0)
 I RMPRPTR=0 D ^RMPR4P21
"RTN","RMPR121B",51,0)
 I +RMPRPTR>0 D EN1^RMPR4P21(RMPRPTR)
"RTN","RMPR121B",52,0)
 Q
"RTN","RMPR121B",53,0)
QUIT ; Quit where IFCAP encountered a problem
"RTN","RMPR121B",54,0)
 S:XBAD="^" RESULT=1_"^"_"**STAND BY**  Your IFCAP order may be canceled due to a lack of funds. If you can immediately get an increase of funds re-enter your e-sig and complete this PO.  IF YOU LEAVE THIS SCREEN YOUR PO WILL BE LOST"
"RTN","RMPR121B",55,0)
 S:XBAD="#" RESULT="1^Your IFCAP order has been cancelled due to reaching the max seq for the Fund Control Point Activity requisition."
"RTN","RMPR121B",56,0)
 Q
"RTN","RMPR121B",57,0)
QUT ;
"RTN","RMPR121B",58,0)
 S RESULT="1^IFCAP did not update your Purchase Order, Please Log out and start over."
"RTN","RMPR121B",59,0)
 Q
"RTN","RMPR121B",60,0)
GUIVAR ; Get variable setup from the GUI application
"RTN","RMPR121B",61,0)
 ; Setup Site Variables
"RTN","RMPR121B",62,0)
 D INF^RMPRSIT
"RTN","RMPR121B",63,0)
 ; Shipping info
"RTN","RMPR121B",64,0)
 S $P(^RMPR(664,RMPRA,0),U,14)=RMPR("STA")
"RTN","RMPR121B",65,0)
 S (R1,RMPRCT,RMPRQT,RMPRTO,RMPRI,RMPRR)=0
"RTN","RMPR121B",66,0)
 S RMPRSH=$S($P(^RMPR(664,RMPRA,0),U,10):$P(^(0),U,10),1:"")
"RTN","RMPR121B",67,0)
 F  S R1=$O(^RMPR(664,RMPRA,1,R1)) Q:R1'>0  D
"RTN","RMPR121B",68,0)
 .S RB=^RMPR(664,RMPRA,1,R1,0)
"RTN","RMPR121B",69,0)
 .S RMPRCT=$P(RB,U,3)
"RTN","RMPR121B",70,0)
 .S RMPRQT=$P(RB,U,4)
"RTN","RMPR121B",71,0)
 .S RMPRR=$P(RB,U,8) ;REMARKS
"RTN","RMPR121B",72,0)
 .S RMPRTO=RMPRTO+$J(RMPRCT*RMPRQT,0,2)
"RTN","RMPR121B",73,0)
 S RMPRTOTC=$P($G(^RMPR(664,RMPRA,4)),U,3)
"RTN","RMPR121B",74,0)
 S PRCA=RMPRA
"RTN","RMPR121B",75,0)
 S PRCB=$P(^RMPR(664,RMPRA,4),U,6)
"RTN","RMPR121B",76,0)
 S PRCC=RMPRTOTC
"RTN","RMPR121B",77,0)
 S PRCSITE=$P(^RMPR(664,RMPRA,0),U,14)
"RTN","RMPR121B",78,0)
 S PRCVEN=$P(^RMPR(664,RMPRA,0),U,4)
"RTN","RMPR121B",79,0)
 S RMPRDFN=$P(^RMPR(664,RMPRA,0),U,2)
"RTN","RMPR121B",80,0)
 S RMPRPPA=$P(^VA(200,DUZ,1),U,9)
"RTN","RMPR121B",81,0)
 ; Setup Delivery to Variables
"RTN","RMPR121B",82,0)
 S RMPRY(0)=$P($G(^RMPR(664,RMPRA,3)),U)
"RTN","RMPR121B",83,0)
TST S RMPRY=$S(RMPRY(0)="VETERAN":1,RMPRY(0)="PROSTHETICS":2,RMPRY(0)="OTHER LOCATION AT THIS SITE":3,RMPRY(0)="OTHER LOCATION NOT AT THIS SITE":4,1:"")
"RTN","RMPR121B",84,0)
 D DELIV^RMPR121A
"RTN","RMPR121B",85,0)
 Q
"RTN","RMPR121B",86,0)
C664 ;CANCEL 664 ENTRY WHEN IFCAP IS CANCELLED
"RTN","RMPR121B",87,0)
 S XBAD=X
"RTN","RMPR121B",88,0)
 S $P(^RMPR(664,RMPRA,0),U,5)=$P(^RMPR(664,RMPRA,0),U),$P(^RMPR(664,RMPRA,2),U,2)=+DUZ
"RTN","RMPR121B",89,0)
 S WDS="INSUFF FUNDS CANCEL" S:XBAD="#" WDS="Max FCP req seq reached"
"RTN","RMPR121B",90,0)
 S DA=RMPRA,DR="3.1////^S X=WDS",DIE="^RMPR(664," D ^DIE K WDS
"RTN","RMPR121B",91,0)
 Q
"VER")
8.0^22.0
**INSTALL NAME**
PRC*5.1*123
"BLD",8059,0)
PRC*5.1*123^IFCAP^0^3090804^y
"BLD",8059,1,0)
^^3^3^3090507^
"BLD",8059,1,1,0)
1. <UNDEFINED>DT442+7^PRCFFUD1
"BLD",8059,1,2,0)
 
"BLD",8059,1,3,0)
2. Unable to process IFCAP requests
"BLD",8059,4,0)
^9.64PA^^
"BLD",8059,6.3)
6
"BLD",8059,"ABPKG")
n
"BLD",8059,"KRN",0)
^9.67PA^779.2^20
"BLD",8059,"KRN",.4,0)
.4
"BLD",8059,"KRN",.401,0)
.401
"BLD",8059,"KRN",.402,0)
.402
"BLD",8059,"KRN",.403,0)
.403
"BLD",8059,"KRN",.5,0)
.5
"BLD",8059,"KRN",.84,0)
.84
"BLD",8059,"KRN",3.6,0)
3.6
"BLD",8059,"KRN",3.8,0)
3.8
"BLD",8059,"KRN",9.2,0)
9.2
"BLD",8059,"KRN",9.8,0)
9.8
"BLD",8059,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",8059,"KRN",9.8,"NM",1,0)
PRCH410^^0^B34933376
"BLD",8059,"KRN",9.8,"NM",2,0)
PRCH7PUC^^0^B8077993
"BLD",8059,"KRN",9.8,"NM",3,0)
PRCHNPO^^0^B58254846
"BLD",8059,"KRN",9.8,"NM",4,0)
PRCSUT3^^0^B12450340
"BLD",8059,"KRN",9.8,"NM",5,0)
PRCSX123^^0^B11445599
"BLD",8059,"KRN",9.8,"NM","B","PRCH410",1)

"BLD",8059,"KRN",9.8,"NM","B","PRCH7PUC",2)

"BLD",8059,"KRN",9.8,"NM","B","PRCHNPO",3)

"BLD",8059,"KRN",9.8,"NM","B","PRCSUT3",4)

"BLD",8059,"KRN",9.8,"NM","B","PRCSX123",5)

"BLD",8059,"KRN",19,0)
19
"BLD",8059,"KRN",19.1,0)
19.1
"BLD",8059,"KRN",101,0)
101
"BLD",8059,"KRN",409.61,0)
409.61
"BLD",8059,"KRN",771,0)
771
"BLD",8059,"KRN",779.2,0)
779.2
"BLD",8059,"KRN",870,0)
870
"BLD",8059,"KRN",8989.51,0)
8989.51
"BLD",8059,"KRN",8989.52,0)
8989.52
"BLD",8059,"KRN",8994,0)
8994
"BLD",8059,"KRN","B",.4,.4)

"BLD",8059,"KRN","B",.401,.401)

"BLD",8059,"KRN","B",.402,.402)

"BLD",8059,"KRN","B",.403,.403)

"BLD",8059,"KRN","B",.5,.5)

"BLD",8059,"KRN","B",.84,.84)

"BLD",8059,"KRN","B",3.6,3.6)

"BLD",8059,"KRN","B",3.8,3.8)

"BLD",8059,"KRN","B",9.2,9.2)

"BLD",8059,"KRN","B",9.8,9.8)

"BLD",8059,"KRN","B",19,19)

"BLD",8059,"KRN","B",19.1,19.1)

"BLD",8059,"KRN","B",101,101)

"BLD",8059,"KRN","B",409.61,409.61)

"BLD",8059,"KRN","B",771,771)

"BLD",8059,"KRN","B",779.2,779.2)

"BLD",8059,"KRN","B",870,870)

"BLD",8059,"KRN","B",8989.51,8989.51)

"BLD",8059,"KRN","B",8989.52,8989.52)

"BLD",8059,"KRN","B",8994,8994)

"BLD",8059,"QUES",0)
^9.62^^
"BLD",8059,"REQB",0)
^9.611^3^3
"BLD",8059,"REQB",1,0)
PRC*5.1*108^2
"BLD",8059,"REQB",2,0)
PRC*5.1*115^2
"BLD",8059,"REQB",3,0)
PRC*5.1*68^2
"BLD",8059,"REQB","B","PRC*5.1*108",1)

"BLD",8059,"REQB","B","PRC*5.1*115",2)

"BLD",8059,"REQB","B","PRC*5.1*68",3)

"MBREQ")
0
"PKG",455,-1)
1^1
"PKG",455,0)
IFCAP^PRC^IFCAP System Files
"PKG",455,20,0)
^9.402P^^
"PKG",455,22,0)
^9.49I^1^1
"PKG",455,22,1,0)
5.1
"PKG",455,22,1,"PAH",1,0)
123^3090804
"PKG",455,22,1,"PAH",1,1,0)
^^3^3^3090804
"PKG",455,22,1,"PAH",1,1,1,0)
1. <UNDEFINED>DT442+7^PRCFFUD1
"PKG",455,22,1,"PAH",1,1,2,0)
 
"PKG",455,22,1,"PAH",1,1,3,0)
2. Unable to process IFCAP requests
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","PRCH410")
0^1^B34933376
"RTN","PRCH410",1,0)
PRCH410 ;WISC/KMB/DXH/DGL - CREATE 2237 FROM PURCHASE CARD ORDER ; 4/4/00 7:56am
"RTN","PRCH410",2,0)
 ;;5.1;IFCAP;**123**;Oct 20, 2000;Build 6
"RTN","PRCH410",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCH410",4,0)
 ;
"RTN","PRCH410",5,0)
 ; prcsip is package-wide variable for inv pt that may or may not be
"RTN","PRCH410",6,0)
 ; passed to this routine
"RTN","PRCH410",7,0)
START ;
"RTN","PRCH410",8,0)
 N VV,ST,Y,Z,Z0,Z1,Z2,I,J,CCEN,ESTS,NET,SERV,EMER,COUNT,COUNT1,L,PDUZ,FY,QTR,CP,LOC,ADATE,TDATE,SDATE,LL,PC,PCREF,XDA
"RTN","PRCH410",9,0)
 N SCP,SGRP,COR,VEN,VEND
"RTN","PRCH410",10,0)
 Q:'$D(DA)  Q:+DA=0  S XDA=DA
"RTN","PRCH410",11,0)
 S Z0=$G(^PRC(442,XDA,0)),PRC("SITE")=$P(Z0,"-"),CP=$P(Z0,"^",3),SCP=$P(CP," "),PRC("SST")=$P($G(^PRC(442,XDA,23)),"^",7),PCREF=$P(Z0,"^"),PCREF=$P(PCREF,"-",2)
"RTN","PRCH410",12,0)
 S TDATE=$$DATE^PRC0C($P($G(^PRC(442,XDA,1)),"^",15),"I"),PRC("FY")=$E(TDATE,3,4),PRC("QTR")=$P(TDATE,"^",2),(TDATE,SDATE)=$P($$DATE^PRC0C("T","E"),"^",7)
"RTN","PRCH410",13,0)
 S CCEN=$P(Z0,"^",5),ESTS=$P(Z0,"^",13),ADATE=$P(Z0,"^",10)
"RTN","PRCH410",14,0)
 I CCEN'="" S CCEN=$E($P(^PRCD(420.1,CCEN,0),"^"),1,30)
"RTN","PRCH410",15,0)
 S Z1=$G(^PRC(442,XDA,1)),(VV,VEND)=$P(Z1,"^"),SERV=$P(Z1,"^",2),EMER=$P(Z1,"^",17),LOC=$P(Z1,"^",11),PDUZ=DUZ
"RTN","PRCH410",16,0)
 S ST="ST" S:EMER="Y" ST="EM"
"RTN","PRCH410",17,0)
 S PRC("CP")=+SCP
"RTN","PRCH410",18,0)
 I $G(PRCSIP) I '$O(^PRC(420,PRC("SITE"),1,PRC("CP"),7,"B",PRCSIP,0)) K PRCSIP ; Kill inventory point if not match FCP
"RTN","PRCH410",19,0)
 I '$G(PRCSIP) S J=0 F  S J=$O(^PRC(442,XDA,2,J)) Q:'J!($G(PRCSIP))  S K=0 F  S K=$O(^PRC(442,XDA,2,J,5,0)) Q:'K!($G(PRCSIP))  S PRCSIP=$P($G(^PRC(442,XDA,2,J,5,K,0)),U)
"RTN","PRCH410",20,0)
IP D:'$G(PRCSIP) IP^PRCSUT
"RTN","PRCH410",21,0)
 I '$G(PRCSIP),$O(^PRC(420,PRC("SITE"),1,PRC("CP"),7,0)) D  I Y=0 G IP
"RTN","PRCH410",22,0)
 . K DIR S DIR("A")="** WARNING ** No inventory point selected - Continue anyway",DIR("B")="NO",DIR(0)="Y"
"RTN","PRCH410",23,0)
 . S DIR("?",1)="The FCP you entered has Inventory points associated with it, but none have been selected."
"RTN","PRCH410",24,0)
 . S DIR("?")="Press 'Y' to return to the inventory point prompt or 'N' to continue the order without one."
"RTN","PRCH410",25,0)
 . D ^DIR K DIR
"RTN","PRCH410",26,0)
 . I $E(X)="^"!(Y=1) W !,"No inventory point was attached.",! Q
"RTN","PRCH410",27,0)
 . Q
"RTN","PRCH410",28,0)
 S PC=$P($G(^PRC(442,XDA,23)),"^",8)
"RTN","PRCH410",29,0)
 S COUNT=$P($G(^PRC(442,XDA,2,0)),"^",4) I +COUNT'=0 D ITEM I $G(X)="#",$G(PRCRMPR)=1 Q
"RTN","PRCH410",30,0)
 S CDA=$P($G(^PRC(442,XDA,23)),"^",23)
"RTN","PRCH410",31,0)
 S:$G(PRCHPC)=3 CDA=$P($G(^PRC(442,XDA,13,0)),U,3)
"RTN","PRCH410",32,0)
 I CDA="" D REC Q:CDA=""
"RTN","PRCH410",33,0)
 S CCDA=CDA
"RTN","PRCH410",34,0)
SET ;set item data and vendor on record
"RTN","PRCH410",35,0)
 L +^PRCS(410,CDA):15 Q:'$T
"RTN","PRCH410",36,0)
 ;
"RTN","PRCH410",37,0)
 I VEND'="",$P($G(^PRC(440,VEND,0)),"^")'="SIMPLIFIED" S ^PRCS(410,CDA,2)=$G(^PRC(440,VEND,0))
"RTN","PRCH410",38,0)
 I $P($G(^PRC(440,+VEND,0)),"^")="SIMPLIFIED" S VEND="SIMPLIFIED" S:$P($G(^PRC(442,XDA,24)),"^",2)'="" VEND=$P($G(^PRC(442,XDA,24)),"^",2) S ^PRCS(410,CDA,2)=VEND
"RTN","PRCH410",39,0)
 S VEN=$P(^PRCS(410,CDA,2),"^")
"RTN","PRCH410",40,0)
 S COR=$P($G(^PRC(442,XDA,23)),"^",12),SGRP=$P($G(^PRC(442,XDA,23)),"^",13)
"RTN","PRCH410",41,0)
 S DA=CDA,DIE="^PRCS(410,",DR="3////4"_";"_"5///"_TDATE_";"_"7////"_SDATE_";"_"15////"_CP_";"_"15.5////"_CCEN_";"_"21////"_TDATE_";"_"12////"_VV D ^DIE
"RTN","PRCH410",42,0)
 S DR="1////O"_";"_"6.3////"_SERV_";"_"7.5////"_ST_";"_"40////"_DUZ_";"_"68////"_DUZ_";"_"8////"_COR D ^DIE
"RTN","PRCH410",43,0)
 S DR="46////^S X=LOC"_";"_"47////"_ADATE_";"_"48.1////"_ESTS_";"_"52///"_XDA_";"_"24///"_PCREF D ^DIE
"RTN","PRCH410",44,0)
 I $G(PRCSIP) S DR="4////^S X=PRCSIP" D ^DIE
"RTN","PRCH410",45,0)
 I PC="" S PC=9999999
"RTN","PRCH410",46,0)
 S DR="451////^S X=PC" D ^DIE
"RTN","PRCH410",47,0)
 I +COUNT'=0 F IT=1:1:COUNT D
"RTN","PRCH410",48,0)
 .S ^PRCS(410,CDA,"IT",IT,0)=BB(IT)
"RTN","PRCH410",49,0)
 .I +COUNT1'=0 F J=1:1:COUNT1 D
"RTN","PRCH410",50,0)
 ..S:$D(BB(IT,J)) ^PRCS(410,CDA,"IT",IT,1,J,0)=BB(IT,J)
"RTN","PRCH410",51,0)
 .I COUNT1="" S ^PRCS(410,CDA,"IT",IT,1,0)="^^1^1^"_TDATE_"^^"
"RTN","PRCH410",52,0)
 .F LL="AB","B" S ^PRCS(410,CDA,"IT",LL,IT,IT)=""
"RTN","PRCH410",53,0)
 .I $P(BB(IT),"^",4)'="" S ^PRCS(410,CDA,"IT","AG",$P(BB(IT),"^",4),IT)=""
"RTN","PRCH410",54,0)
 .S:+COUNT1'=0 ^PRCS(410,CDA,"IT",IT,1,0)="^410.03^"_COUNT1_"^"_COUNT1
"RTN","PRCH410",55,0)
 I $D(VEN) S ^PRCS(410,"E",$E(VEN,1,30),CDA)=""
"RTN","PRCH410",56,0)
 S ^PRCS(410,"AQ",1,CDA)="" S:COUNT'="" ^PRCS(410,CDA,"IT",0)="^410.02AI^"_COUNT_"^"_COUNT
"RTN","PRCH410",57,0)
 I '$G(PRCPROST),$G(RPUSE)'=1,$G(COMMENT)'="delivery",$G(PRCHPC)'="" S DA=CDA,DR=49 D ^DIE
"RTN","PRCH410",58,0)
 L -^PRCS(410,CDA)
"RTN","PRCH410",59,0)
 L +^PRC(442,XDA):15 Q:'$T  S $P(^PRC(442,XDA,23),"^",23)=CDA,$P(^PRC(442,XDA,23),"^",13)=$P($G(^PRCS(410,CDA,11)),"^") L -^PRC(442,XDA)
"RTN","PRCH410",60,0)
 S DA=XDA K DIE QUIT
"RTN","PRCH410",61,0)
ITEM ;
"RTN","PRCH410",62,0)
 F IT=1:1:COUNT D
"RTN","PRCH410",63,0)
 .F J=1,2,3,4,5,6,8 S $P(BB(IT),"^",J)=$P($G(^PRC(442,XDA,2,IT,0)),"^",J)
"RTN","PRCH410",64,0)
 .S $P(BB(IT),"^",7)=$P($G(^PRC(442,XDA,2,IT,0)),"^",9)
"RTN","PRCH410",65,0)
 .S COUNT1=$P($G(^PRC(442,XDA,2,IT,1,0)),"^",4) I +COUNT1'=0 F J=1:1:COUNT1 S BB(IT,J)=$G(^PRC(442,XDA,2,IT,1,J,0))
"RTN","PRCH410",66,0)
 QUIT
"RTN","PRCH410",67,0)
REC ;create skeleton 410 record
"RTN","PRCH410",68,0)
 S:$G(XDA)'="" PRC("CP")=$P($G(^PRC(442,XDA,0)),U,3)
"RTN","PRCH410",69,0)
 Q:+$G(PRC("CP"))=0
"RTN","PRCH410",70,0)
 S T(2)="",Z=PRC("SITE")_"-"_PRC("FY")_"-"_PRC("QTR")_"-"_$P(PRC("CP")," ")
"RTN","PRCH410",71,0)
 S PRC("BBFY")=$$BBFY^PRCSUT(PRC("SITE"),PRC("FY"),$P(PRC("CP")," "),1)
"RTN","PRCH410",72,0)
 S X=$P(Z,"-",1,2)_"-"_$P(PRC("CP")," ")
"RTN","PRCH410",73,0)
 D EN1^PRCSUT3 Q:'$D(X)  Q:$G(X)="#"&($G(PRCRMPR)=1)  S X1=X D EN2^PRCSUT3 Q:$G(DA)=""  Q:'$D(X1)  S CDA=DA
"RTN","PRCH410",74,0)
 K X,T(2) QUIT
"RTN","PRCH410",75,0)
ESIG ;put ESIG on record, update due-ins
"RTN","PRCH410",76,0)
 S NET=$P($G(^PRC(442,PODA,0)),"^",15) L +^PRCS(410,DA):15 Q:'$T  F I=1,8 S $P(^PRCS(410,DA,4),"^",I)=NET
"RTN","PRCH410",77,0)
 I $D(PRCHDELV) S $P(^PRCS(410,DA,4),"^",3)=NET,$P(^PRCS(410,DA,4),"^",4)=$P(^PRCS(410,DA,1),"^")
"RTN","PRCH410",78,0)
 S:'$D(PRC("CP")) ZIP=$P(^PRC(442,PODA,0),"^",3),PRC("CP")=$P(ZIP," ") Q:PRC("CP")=""
"RTN","PRCH410",79,0)
 S BAL=$P($G(^PRC(420,PRC("SITE"),1,+PRC("CP"),4,PRC("FY"),0)),"^",PRC("QTR")+1)
"RTN","PRCH410",80,0)
 L -^PRCS(410,DA)
"RTN","PRCH410",81,0)
 D ERS410^PRC0G(DA_"^A")
"RTN","PRCH410",82,0)
 S MESSAGE="" D ENCODE^PRCSC1(DA,DUZ,.MESSAGE)
"RTN","PRCH410",83,0)
 S:'$D(PRC("CP")) ZIP=$P(^PRC(442,PODA,0),"^",3),PRC("CP")=$P(ZIP," ") Q:PRC("CP")=""
"RTN","PRCH410",84,0)
 D:'$D(PRC("FY")) FY^PRCH442
"RTN","PRCH410",85,0)
 N KTEMP S KTEMP=X
"RTN","PRCH410",86,0)
 S AA=PRC("SITE")_"^"_+PRC("CP")_"^"_PRC("FY")_"^"_PRC("QTR")_"^"_NET D EBAL^PRCSEZ(AA,"C") D:$G(PRCHDELV)'="" EBAL^PRCSEZ(AA,"O")
"RTN","PRCH410",87,0)
 S X=KTEMP
"RTN","PRCH410",88,0)
 S BAL=$P($G(^PRC(420,PRC("SITE"),1,+PRC("CP"),4,PRC("FY"),0)),"^",PRC("QTR")+1)
"RTN","PRCH410",89,0)
 W !,"Cost of this request: $",$J(X,0,2),!,"Current Control Point Balance: $",$J(BAL,0,2),!
"RTN","PRCH410",90,0)
 S PRCSN=$G(^PRCS(410,DA,0))
"RTN","PRCH410",91,0)
 I $P(PRCSN,U,4)>1 S X=$P(PRCSN,U,1),DIC="^PRC(443,",DIC(0)="L",DLAYGO=443 D ^DIC K DIC,DLAYGO,X
"RTN","PRCH410",92,0)
 I $P(PRCSN,U,4)>1 S X=$O(^PRCD(442.3,"C",60,0)) S $P(^PRC(443,DA,0),U,7)=X,^PRC(443,"AC",X,DA)="",$P(^PRC(443,DA,0),U,11)=$P(PRCSN,U,6)
"RTN","PRCH410",93,0)
 I '$G(PRCHPHAM),$G(PRCHPC)'=1 D EN2^PRCPWI
"RTN","PRCH410",94,0)
 S PRCSINV=$P(^PRCS(410,DA,0),U,6)
"RTN","PRCH410",95,0)
 S DIE="^PRC(443,",DR="9///^S X=1;10///^S X=4;11////^S X=PRCSINV;13///^S X=""E"";3.7///^S X=5730;3.5///^S X=1;2////^S X=DUZ"
"RTN","PRCH410",96,0)
 D ^DIE K DIE,DR
"RTN","PRCH410",97,0)
 S BAL=$P($G(^PRC(420,PRC("SITE"),1,+PRC("CP"),4,PRC("FY"),0)),"^",PRC("QTR")+1)
"RTN","PRCH410",98,0)
 D ES1^PRCHG
"RTN","PRCH410",99,0)
 S PRCHSY(0)=^PRC(443,CDA,0) ;After Signature use 443 entry
"RTN","PRCH410",100,0)
 S PRCHS="",PRCHSY=DA,PRCHSP="" D LST1^PRCHNPO2
"RTN","PRCH410",101,0)
 S BAL=$P($G(^PRC(420,PRC("SITE"),1,+PRC("CP"),4,PRC("FY"),0)),"^",PRC("QTR")+1)
"RTN","PRCH410",102,0)
 S DA=CDA,DIK="^PRC(443," D ^DIK K DIK
"RTN","PRCH410",103,0)
 K BAL,ZIP,PRCSN,X,MESSAGE QUIT
"RTN","PRCH7PUC")
0^2^B8077993
"RTN","PRCH7PUC",1,0)
PRCH7PUC ;Hines OIFO/RVD - GUI PURCHASE CARD PROS ORDER INTERFACE ;8/13/03  09:50
"RTN","PRCH7PUC",2,0)
 ;;5.1;IFCAP;**68,123**;Oct 20, 2000;Build 6
"RTN","PRCH7PUC",3,0)
 ;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","PRCH7PUC",4,0)
 ;
"RTN","PRCH7PUC",5,0)
 ;This routine is for Obligating and canceling a PO using a GUI interface.
"RTN","PRCH7PUC",6,0)
 ;Line label UP1 is for MUMPS entry point.
"RTN","PRCH7PUC",7,0)
 ;
"RTN","PRCH7PUC",8,0)
 ; PRCSITE     - station number
"RTN","PRCH7PUC",9,0)
 ; PRCVEN      - vendor
"RTN","PRCH7PUC",10,0)
 ; RESULTS     - return variable
"RTN","PRCH7PUC",11,0)
 ; PRCA        - IEN of Prosthetics Order file 664
"RTN","PRCH7PUC",12,0)
 ; PRCB        - IEN of file 442
"RTN","PRCH7PUC",13,0)
 ; PRCC        - Total Cost
"RTN","PRCH7PUC",14,0)
 ; PRCRMPR   - Variable to quit in IFCAP E-Sig routine PRCUESIG
"RTN","PRCH7PUC",15,0)
UP1(X,PRCA,PRCB,PRCC,PRCSITE,PRCVEN,PRCRMPR) ;ENTRY FOR GUI PURCHASING
"RTN","PRCH7PUC",16,0)
 ;
"RTN","PRCH7PUC",17,0)
 N PRCPROST,PRCHPC,PRCRI,A,B,Y,DIE
"RTN","PRCH7PUC",18,0)
 N PRCHPO,PRCHTOT,PRCHBOCC,PRCHBOC1,PRCHN
"RTN","PRCH7PUC",19,0)
 S PRC("PER")=+DUZ
"RTN","PRCH7PUC",20,0)
 K X S X=$S('$D(^VA(200,+PRC("PER"),20)):"",1:^VA(200,+PRC("PER"),20))
"RTN","PRCH7PUC",21,0)
 I $P(X,"^",2)="" S %X=$P(^VA(200,+PRC("PER"),0),"^"),%X=$P(%X,",",2)_" "_$P(%X,",")_$P(%X,",",3),$P(^VA(200,+PRC("PER"),20),"^",2)=%X,X=%X K %X
"RTN","PRCH7PUC",22,0)
 S $P(PRC("PER"),"^",2,4)=$P(X,"^",2)_"^"_$P(X,"^",3)_"^"_$S($D(^VA(200,+PRC("PER"),.13)):$P(^(.13),"^",2),1:"")
"RTN","PRCH7PUC",23,0)
 S PRCHVEN=PRCVEN
"RTN","PRCH7PUC",24,0)
 S PRCPROST=3,PRCHPC=1
"RTN","PRCH7PUC",25,0)
 S PRCRI(442)=PRCB
"RTN","PRCH7PUC",26,0)
 S PRCHPO=PRCRI(442),PRCHTOT=PRCC
"RTN","PRCH7PUC",27,0)
 S A=^PRC(440.5,$P(^PRC(442,PRCRI(442),23),"^",8),0),PRCHBOC1=$P(A,U,4)
"RTN","PRCH7PUC",28,0)
 S DIE="^PRC(442,",DA=PRCHPO,DR="60////"_PRCHTOT_";91////"_PRCHTOT_";65////RMPR" D ^DIE K DR
"RTN","PRCH7PUC",29,0)
 S PRCHN("SFC")=+$P(^PRC(442,PRCRI(442),0),U,19)
"RTN","PRCH7PUC",30,0)
 S:'$D(^PRC(442,PRCHPO,2,0)) $P(^PRC(442,PRCHPO,2,0),U,2)=$P(^DD(442,40,0),U,2)
"RTN","PRCH7PUC",31,0)
 S DA(1)=PRCHPO,DIE="^PRC(442,"_DA(1)_",2,",DA=1
"RTN","PRCH7PUC",32,0)
 S DR=".01///^S X=1;1///Prosthetic Order;2///^S X=1;3///^S X=""EA"";5////^S X=PRCHTOT;3.1///^S X=1;9.7///^S X=1;9///^S X="""";8///^S X=9999;K PRCHBOCC;"
"RTN","PRCH7PUC",33,0)
 S DR(1,442.01,1)="I PRCHN(""SFC"")=2 S PRCHBOCC=2696;I '$G(PRCHBOCC) S Y=""@87"";"
"RTN","PRCH7PUC",34,0)
 S DR(1,442.01,2)="S PRCHBOCC=$P($G(^PRCD(420.2,PRCHBOCC,0)),U);3.5////^S X=PRCHBOCC;S Y=""@89"";@87;3.5////^S X=PRCHBOC1;@89;K PRCHBOCC"
"RTN","PRCH7PUC",35,0)
 D ^DIE
"RTN","PRCH7PUC",36,0)
 I '$D(Y) D PROS^PRCHNPO
"RTN","PRCH7PUC",37,0)
 I $G(X)="#",$G(PRCRMPR)=1 D CANIC(PRCRI(442)) Q
"RTN","PRCH7PUC",38,0)
 S X="" I PRCPROST=3 D CANIC(PRCRI(442)) S X="^"
"RTN","PRCH7PUC",39,0)
 QUIT
"RTN","PRCH7PUC",40,0)
 ;
"RTN","PRCH7PUC",41,0)
CANIC(PRCA) ;cancel order, prca=ri of prosthetic order, prcb=ri file 442
"RTN","PRCH7PUC",42,0)
 N PRCPROST,PRCHPC,A,B,X,Y
"RTN","PRCH7PUC",43,0)
 S PRCPROST=99,PRCHPC=1
"RTN","PRCH7PUC",44,0)
 D EDIT^PRC0B(.X,"442;^PRC(442,;"_PRCA,".5///^S X=45")
"RTN","PRCH7PUC",45,0)
 S DA=PRCA D C2237^PRCH442A K DA,%A,%B,%
"RTN","PRCH7PUC",46,0)
 QUIT
"RTN","PRCH7PUC",47,0)
 ;
"RTN","PRCH7PUC",48,0)
 ;PRCPONO - IEN of file #442
"RTN","PRCH7PUC",49,0)
 ;PRCA    - IEN of file #664
"RTN","PRCH7PUC",50,0)
 ;RESULTS  - a return value
"RTN","PRCH7PUC",51,0)
 ;
"RTN","PRCH7PUC",52,0)
 ;cancel a PO.  Call by Prosthetics GUI.
"RTN","PRCH7PUC",53,0)
C1(PRCA) G C2
"RTN","PRCH7PUC",54,0)
CAN(RESULTS,PRCPONO) ;broker entry point.
"RTN","PRCH7PUC",55,0)
C2 ;
"RTN","PRCH7PUC",56,0)
 N PRCPROST,PRCHPC,A,B,X,Y
"RTN","PRCH7PUC",57,0)
 S PRCPROST=99,PRCHPC=1
"RTN","PRCH7PUC",58,0)
 L +^PRC(442,PRCA):1
"RTN","PRCH7PUC",59,0)
 I '$T S RESULTS="Unable to Access P.O. in IFCAP." Q
"RTN","PRCH7PUC",60,0)
 D EDIT^PRC0B(.X,"442;^PRC(442,;"_PRCA,".5///^S X=45")
"RTN","PRCH7PUC",61,0)
 S DA=PRCA D C2237^PRCH442A K DA,%A,%B,%
"RTN","PRCH7PUC",62,0)
 S RESULTS(0)="P.O. has been cancelled."
"RTN","PRCH7PUC",63,0)
 Q
"RTN","PRCH7PUC",64,0)
 ;END
"RTN","PRCHNPO")
0^3^B58254846
"RTN","PRCHNPO",1,0)
PRCHNPO ;WISC/SC,ID/RSD/RHD/DGL/BGJ-ENTER NEW PURCHASE ORDER/REQUISITION ; 4/2/01 1:50pm
"RTN","PRCHNPO",2,0)
V ;;5.1;IFCAP;**7,11,79,108,123**;Oct 20, 2000;Build 6
"RTN","PRCHNPO",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCHNPO",4,0)
 S NOTCOMPL=0 ;Initialize for Incomplete Template.
"RTN","PRCHNPO",5,0)
 D SWITCH^PRCHUTL K ERRFLG ; SET LOG/ISMS SWITCH
"RTN","PRCHNPO",6,0)
 K PRCSIP ; Initialize Inventory point variable
"RTN","PRCHNPO",7,0)
 I $S('$G(PRCHPO):1,'$D(PRC("SITE")):1,1:0) G Q
"RTN","PRCHNPO",8,0)
 S DIE="^PRC(442,",DR="["_$S($D(PRCHNRQ):"PRCHNREQ",1:"PRCH2138")_"]",DIC("DR")="[PRCHVENDOR]"
"RTN","PRCHNPO",9,0)
 I $G(PRCPROST)=1 S DR="[PRCH PROSTHETIC]" D ^DIE QUIT
"RTN","PRCHNPO",10,0)
 I $G(PRCHPC)=1 S DR="[PRCHSIMP]"
"RTN","PRCHNPO",11,0)
 I $G(PRCHPC)=2 S DR="[PRCH DETAILED PURCHASE CARD]"
"RTN","PRCHNPO",12,0)
 I $G(PRCHPC)=3 S DR="[PRCH PC DIRECT DELIVERY]"
"RTN","PRCHNPO",13,0)
 I $G(PRCHDELV)=1,'$G(PRCHPHAM) S DR="[PRCH DELIVERY ORDER]"
"RTN","PRCHNPO",14,0)
 I $G(PRCHPHAM)=1 S DR="[PRCH DIRECT DELIVERY ORDER]"
"RTN","PRCHNPO",15,0)
 D ^DIE
"RTN","PRCHNPO",16,0)
 ;
"RTN","PRCHNPO",17,0)
 ; Check ERRFLG to see if the user entered an up-arrow to get out or
"RTN","PRCHNPO",18,0)
 ; did not select a credit card name. The flag ERRFLG is set at the
"RTN","PRCHNPO",19,0)
 ; input templates above.
"RTN","PRCHNPO",20,0)
 I $G(ERRFLG)=42 G ERR
"RTN","PRCHNPO",21,0)
 I $G(ERRFLG)=38 G ERR
"RTN","PRCHNPO",22,0)
 I $G(ERRFLG)=1 G ERR
"RTN","PRCHNPO",23,0)
 I $G(ERRFLG)=2 G ERR
"RTN","PRCHNPO",24,0)
 I $G(ERRFLG)=3 G ERR
"RTN","PRCHNPO",25,0)
 ;Look for incomplete Input-Template when PRCHPC is defined.
"RTN","PRCHNPO",26,0)
 I $D(PRCHPC)  D
"RTN","PRCHNPO",27,0)
 . I $D(Y)'=0 S NOTCOMPL=1
"RTN","PRCHNPO",28,0)
 I NOTCOMPL G INCMSG
"RTN","PRCHNPO",29,0)
 I $G(PRCHPC)=1 Q:$D(Y)  D  Q:$D(Y)
"RTN","PRCHNPO",30,0)
 . S:'$D(^PRC(442,PRCHPO,2,0)) $P(^PRC(442,PRCHPO,2,0),U,2)=$P(^DD(442,40,0),U,2)
"RTN","PRCHNPO",31,0)
 . S DA(1)=PRCHPO,DIE="^PRC(442,"_DA(1)_",2,",DA=1
"RTN","PRCHNPO",32,0)
 . S DR=".01///^S X=1;1;I '$D(^PRC(442,DA(1),2,DA,1)) W !,""Description is Required!!"" S Y=1;2///^S X=1;3///^S X=""EA"";5////^S X=PRCHTOT;3.1///^S X=1;9.7///^S X=1;9///^S X="""";8///^S X=9999;K PRCHBOCC;"
"RTN","PRCHNPO",33,0)
 . S DR(1,442.01,1)="I PRCHN(""SFC"")=2 S PRCHBOCC=2696;I '$G(PRCHBOCC) S Y=""@87"";"
"RTN","PRCHNPO",34,0)
 . S DR(1,442.01,2)="S PRCHBOCC=$P($G(^PRCD(420.2,PRCHBOCC,0)),U);3.5////^S X=PRCHBOCC;S Y=""@89"";@87;3.5//^S X=PRCHBOC1;@89;K PRCHBOCC"
"RTN","PRCHNPO",35,0)
 . D ^DIE Q:$D(Y)
"RTN","PRCHNPO",36,0)
 . S DIE="^PRC(442,",DA=PRCHPO,DR=20 D ^DIE
"RTN","PRCHNPO",37,0)
PROS I $P($G(^PRC(442,PRCHPO,23)),U,11)]"" Q:$D(Y)  D  Q:$D(Y)  Q:'$G(CDA)
"RTN","PRCHNPO",38,0)
 . S PODIE=DIE,PODA=DA
"RTN","PRCHNPO",39,0)
 . S CDA=$P($G(^PRC(442,PRCHPO,23)),U,23),PRC("CP")=$P($G(^PRC(442,PRCHPO,0)),U,3)
"RTN","PRCHNPO",40,0)
 . I +$G(PRC("CP"))'=0 S DA=PRCHPO D START^PRCH410 I $G(PRCRMPR)=1,$G(X)="#" Q
"RTN","PRCHNPO",41,0)
 . I '$G(PRCHPHAM),'$G(PRCPROST),+$G(PRC("CP"))'=0 S DIE="^PRCS(410,",DA=$P($G(^PRC(442,PRCHPO,23)),U,23),DR=16 D ^DIE
"RTN","PRCHNPO",42,0)
 . S DIE=PODIE,DA=PODA
"RTN","PRCHNPO",43,0)
 I $G(PRCRMPR)=1,X="#" Q
"RTN","PRCHNPO",44,0)
 S VEN=+$G(^PRC(442,PRCHPO,1))
"RTN","PRCHNPO",45,0)
 I '$P($G(^PRC(442,PRCHPO,23)),U,11),$P($G(PRCHNVF),U,3)!($G(^PRC(440.3,+$G(VEN),0))]"") D
"RTN","PRCHNPO",46,0)
 . I $P($G(^PRC(411,PRC("SITE"),9)),U,3)="Y" D  Q
"RTN","PRCHNPO",47,0)
 . . S PRCHXXDA=DA
"RTN","PRCHNPO",48,0)
 . . S PRCHXDIE=DIE
"RTN","PRCHNPO",49,0)
 . . S DA=VEN
"RTN","PRCHNPO",50,0)
 . . Q:$$NEW^PRCOVTST(VEN,PRC("SITE"),1)
"RTN","PRCHNPO",51,0)
 . . I $P($G(PRCHNVF),U,3) D
"RTN","PRCHNPO",52,0)
 . . . S %X="^PRC(440,DA,"
"RTN","PRCHNPO",53,0)
 . . . S %Y="^PRC(440.3,DA,"
"RTN","PRCHNPO",54,0)
 . . . D %XY^%RCR
"RTN","PRCHNPO",55,0)
 . . . Q
"RTN","PRCHNPO",56,0)
 . . S DIE="^PRC(440.3,",DR="47///^S X=1;48///^S X=VEN;49///^S X=PRC(""SITE"")"
"RTN","PRCHNPO",57,0)
 . . D ^DIE
"RTN","PRCHNPO",58,0)
 . . S DA=PRCHXXDA
"RTN","PRCHNPO",59,0)
 . . S DIE=PRCHXDIE
"RTN","PRCHNPO",60,0)
 . . K PRCHXXDA
"RTN","PRCHNPO",61,0)
 . . K PRCHXDIE
"RTN","PRCHNPO",62,0)
 . D NEW^PRCOVRQ(VEN,PRC("SITE"))
"RTN","PRCHNPO",63,0)
 K VEN
"RTN","PRCHNPO",64,0)
 L +^PRC(442,PRCHPO):0 G ERR:'$T S PRCHSTAT=$P($G(^PRC(442,PRCHPO,7)),U,2) S:$D(Y)&('$D(PRCHNRQ))&(PRCHSTAT'=22) PRCHER="" S (PRCH,PRCHEC,PRCHX)=0
"RTN","PRCHNPO",65,0)
 S PRCHSC="" I $D(^PRC(442,PRCHPO,1)),$D(^PRCD(420.8,+$P(^(1),U,7),0)) S PRCHSC=$P(^(0),U,1) S $P(^PRC(442,PRCHPO,1),U,14)=$S(PRCHSC="B":"*",1:"")
"RTN","PRCHNPO",66,0)
 ;K PRCHER F  S PRCH=$O(^PRC(442,PRCHPO,2,PRCH)) Q:PRCH=""!(PRCH'>0)  D  G ERR:$D(PRCHER)
"RTN","PRCHNPO",67,0)
 K PRCHER F  S PRCH=$O(^PRC(442,PRCHPO,2,PRCH)) Q:PRCH=""!(PRCH'>0)  D
"RTN","PRCHNPO",68,0)
 .S $P(^PRC(442,PRCHPO,2,PRCH,2),U,6)=""
"RTN","PRCHNPO",69,0)
 .S PRCHLN=$G(^PRC(442,PRCHPO,2,PRCH,0)) ;I PRCHLN="" D ERR2 Q
"RTN","PRCHNPO",70,0)
 .S SUBACC=$P(PRCHLN,U,4) ;I SUBACC="" D ERR2 Q
"RTN","PRCHNPO",71,0)
 .D ERR2
"RTN","PRCHNPO",72,0)
 .Q
"RTN","PRCHNPO",73,0)
 K ^PRC(442,PRCHPO,2,"B"),^("C"),^("AC"),^("AE"),^("AH")
"RTN","PRCHNPO",74,0)
 N PRCHCNYS,PRCHCNNO S (PRCHCNYS,PRCHCNNO)=0 ;FLGS FOR CONTRACT # ON ITEM
"RTN","PRCHNPO",75,0)
 S PRCH=0 F I=1:1 S PRCH=$O(^PRC(442,PRCHPO,2,PRCH)) Q:PRCH=""!(PRCH'>0)  D CHG I $D(^PRC(442,PRCHPO,2,PRCH,0)) D
"RTN","PRCHNPO",76,0)
 .S PRCHAM=+$P(^PRC(442,PRCHPO,2,PRCH,2),U,1),PRCHCN=$P(^(2),U,2) D CN:PRCHCN]"",OM:PRCHCN=""
"RTN","PRCHNPO",77,0)
 .I PRCHCN]"" S PRCHCNYS=1
"RTN","PRCHNPO",78,0)
 .E  S PRCHCNNO=1
"RTN","PRCHNPO",79,0)
 .S $P(^PRC(442,PRCHPO,2,PRCH,2),U,5)=""
"RTN","PRCHNPO",80,0)
 .Q
"RTN","PRCHNPO",81,0)
 S PRCHLCNT=I-1,$P(^PRC(442,PRCHPO,0),U,14)=PRCHLCNT S:$D(^PRC(442,PRCHPO,2,0)) $P(^(0),U,3,4)="1^"_PRCHLCNT I 'PRCHLCNT S PRCHER="" W !,"There are no line items listed in the Purchase Order."
"RTN","PRCHNPO",82,0)
 G ERRCHKS:'$D(^PRC(442,PRCHPO,1))!('$D(^(2)))
"RTN","PRCHNPO",83,0)
 I $P(^PRC(442,PRCHPO,0),U,3)=""!($P(^(0),U,4))="" W !!?5,"Fund Control Point is undefined  !",$C(7)
"RTN","PRCHNPO",84,0)
 S PRCHV=$P(^PRC(442,PRCHPO,1),U,1) I PRCHV="" W !!?5,"Vendor is undefined !",$C(7) ;G ERR
"RTN","PRCHNPO",85,0)
ERRCHKS S ERRFL=0 D ERRCHKS^PRCHNPO9 ;I ERRFL=0 K ERRFL G CONT
"RTN","PRCHNPO",86,0)
 ;K ERRFL G ERR
"RTN","PRCHNPO",87,0)
CONT ;
"RTN","PRCHNPO",88,0)
 S ERROR1="" D ^PRCHNPO9
"RTN","PRCHNPO",89,0)
 I ERROR1=1!(ERRFL>0)!($D(PRCHER)) G ERR
"RTN","PRCHNPO",90,0)
 D BBFY^PRCHNPO8(PRCHPO) I PRC("BBFY")'>0 W !!?5,"BBFY can not be checked/updated.",$C(7) G ERR
"RTN","PRCHNPO",91,0)
 S PRCH=0 F I=0:1 S PRCH=$O(PRCH("AM",PRCH)) Q:PRCH=""  S PRCH("COUNT",+PRCH("AM",PRCH),PRCH)=""
"RTN","PRCHNPO",92,0)
 I PRCHCNNO,PRCHCNYS D ASTR ; <<< only call on ASTR
"RTN","PRCHNPO",93,0)
 G:I=1 ^PRCHNRQ:$D(PRCHNRQ),^PRCHNPO1 S J=1 F PRCHJ=0:0 S PRCH=$O(PRCH("COUNT",PRCH)) Q:PRCH=""  D MISS
"RTN","PRCHNPO",94,0)
 G ^PRCHNRQ:$D(PRCHNRQ),^PRCHNPO1
"RTN","PRCHNPO",95,0)
 ;
"RTN","PRCHNPO",96,0)
LI S PRCHL0=$P(PRCH("AM",PRCHL3),U,3) Q:PRCHL0=""  F J=1:1 S PRCHL1=$E(PRCHL0,$L(PRCHL0)-J) Q:PRCHL1'=+PRCHL1
"RTN","PRCHNPO",97,0)
 S PRCHL2=$E(PRCHL0,$L(PRCHL0)-J+1,$L(PRCHL0)-1),PRCHL2=PRCHL2+1 I PRCHL2'=PRCHLI S PRCHLI=PRCHL0_PRCHLI Q
"RTN","PRCHNPO",98,0)
 I PRCHL1=":" S PRCHLI=$E(PRCHL0,1,$L(PRCHL0)-J)_PRCHLI Q
"RTN","PRCHNPO",99,0)
 S PRCHLI=$E(PRCHL0,1,$L(PRCHL0)-1)_":1:"_PRCHLI
"RTN","PRCHNPO",100,0)
 Q
"RTN","PRCHNPO",101,0)
 ;
"RTN","PRCHNPO",102,0)
CHG I '$P(^PRC(442,PRCHPO,2,PRCH,0),"^",5),'$O(^(1,0)) S $P(^PRC(442,PRCHPO,2,PRCH,2),U,4,6)="^^" W !,"Line item ",+^PRC(442,PRCHPO,2,PRCH,0)," is missing its description!" S PRCHER=""
"RTN","PRCHNPO",103,0)
 S $P(^PRC(442,PRCHPO,2,PRCH,0),U,1)=I,X=$P(^(0),U,5),X1=$P(^(0),U,4)
"RTN","PRCHNPO",104,0)
 S ^PRC(442,PRCHPO,2,"B",I,PRCH)="",^PRC(442,PRCHPO,2,"C",I,PRCH)="",^PRC(442,PRCHPO,2,"AH",+X1,I,PRCH)="",PRCHLI=I,PRCHX=PRCH S:X]"" ^PRC(442,PRCHPO,2,"AE",X,PRCH)=""
"RTN","PRCHNPO",105,0)
 Q
"RTN","PRCHNPO",106,0)
 ;
"RTN","PRCHNPO",107,0)
ERR2 I $S('$D(^PRC(442,PRCHPO,2,PRCH,2)):1,$P(^(2),U,1)="":1,1:0) S $P(^(2),U,1)="",$P(^(2),U,4,7)="" W !,"Line item ",+^(0)," is incomplete !",$C(7) S PRCHER=""
"RTN","PRCHNPO",108,0)
 I '$G(PRCHPC),$D(PRCHNRQ),PRCHSC'=9,$P(^PRC(442,PRCHPO,2,PRCH,0),U,13)="" W !,"Line item ",+^(0)," is missing NSN !",$C(7) S PRCHER=""
"RTN","PRCHNPO",109,0)
 I $P(^PRC(442,PRCHPO,2,PRCH,0),U,4)="" W !,"Line item ",+^(0)," is missing BOC !",!,$C(7) S PRCHER=""
"RTN","PRCHNPO",110,0)
 Q
"RTN","PRCHNPO",111,0)
 ;
"RTN","PRCHNPO",112,0)
CN S:'$D(PRCH("AM",PRCHCN)) PRCH("AM",PRCHCN)="",PRCHEC=PRCHEC+1 S PRCHL3=PRCHCN
"RTN","PRCHNPO",113,0)
 D LI S PRCH("AM",PRCHCN)=($P(PRCH("AM",PRCHCN),U,1)+1)_U_($P(PRCH("AM",PRCHCN),U,2)+PRCHAM)_U_PRCHLI_",",^PRC(442,PRCHPO,2,"AC",$E(PRCHCN,1,30),PRCH)=""
"RTN","PRCHNPO",114,0)
 Q
"RTN","PRCHNPO",115,0)
 ;
"RTN","PRCHNPO",116,0)
OM S:'$D(PRCH("AM",".OM")) PRCH("AM",".OM")="",PRCHEC=PRCHEC+1 S PRCHL3=".OM" D LI S PRCH("AM",".OM")=($P(PRCH("AM",".OM"),U,1)+1)_U_($P(PRCH("AM",".OM"),U,2)+PRCHAM)_U_PRCHLI_","
"RTN","PRCHNPO",117,0)
 Q
"RTN","PRCHNPO",118,0)
 ;
"RTN","PRCHNPO",119,0)
MISS S PRCHN=0 F K=1:1 S PRCHN=$O(PRCH("COUNT",PRCH,PRCHN)) Q:PRCHN=""!(J>(I-1))  S J=J+1,L=0,Y=$P(PRCH("AM",PRCHN),U,3),Y="F PRCHLI="_$E(Y,1,$L(Y)-1)_" S L=L+1 G ERR2:PRCHX<0" X Y
"RTN","PRCHNPO",120,0)
 Q
"RTN","PRCHNPO",121,0)
 ;
"RTN","PRCHNPO",122,0)
ASTR ;IF SOME ITEMS HAVE CN, SOME DO NOT, PLACE '*' ON DISPLAY OF PO
"RTN","PRCHNPO",123,0)
 N CN,ITM,DESC,ROOT
"RTN","PRCHNPO",124,0)
 S ROOT="^PRC(442,PRCHPO)"
"RTN","PRCHNPO",125,0)
 S CN=0 F M=1:1 S CN=$O(@ROOT@(2,"AC",CN)) Q:CN=""  S:$D(^(CN)) ITM=$O(^(CN,0)) S ^PRC(442,PRCHPO,2,"AC",CN,ITM)="*"
"RTN","PRCHNPO",126,0)
 S:PRCHSC="B" $P(^PRC(442,PRCHPO,1),U,14)="*"
"RTN","PRCHNPO",127,0)
 S DESC=0 F I=1:1 S DESC=$O(@ROOT@(2,DESC)) Q:DESC=""!(DESC'>0)  I $P(@ROOT@(2,DESC,2),U,2)']"" S $P(^PRC(442,PRCHPO,2,DESC,2),U,5)="*"
"RTN","PRCHNPO",128,0)
 ;S PRCHX=$O(^PRC(442,PRCHPO,2,"B",PRCHLI,0)) Q:PRCHX=""!('$D(^PRC(442,PRCHPO,2,PRCHX,2)))  S $P(^(2),U,5)=PRCHN("*") S:PRCHN'=".OM" ^PRC(442,PRCHPO,2,"AC",PRCHN,PRCHLI)=PRCHN("*")
"RTN","PRCHNPO",129,0)
 ;I PRCHSC="B",PRCHN=".OM",$D(^PRC(442,PRCHPO,1)),L=1 S ^(1)=$P(^(1),U,1,13)_U_PRCHN("*")_U_$P(^(1),U,15,99)
"RTN","PRCHNPO",130,0)
 Q
"RTN","PRCHNPO",131,0)
 ;
"RTN","PRCHNPO",132,0)
ERR ;
"RTN","PRCHNPO",133,0)
 W !!?5,$S($D(PRCHNRQ):"Requisition",1:"Purchase Order")_" is incomplete and must be re-edited !",$C(7)
"RTN","PRCHNPO",134,0)
INCMSG ;
"RTN","PRCHNPO",135,0)
 I '$D(NOTCOMPL)  D
"RTN","PRCHNPO",136,0)
 . S NOTCOMPL=0
"RTN","PRCHNPO",137,0)
 I NOTCOMPL  D
"RTN","PRCHNPO",138,0)
 . W !!,?5,"Incomplete transaction. It must be re-edited !",$C(7)
"RTN","PRCHNPO",139,0)
Q K ERRDEL,ERRPC,ERRPO,DR,NOTCOMPL,DRTY,IMF,IMFD,LI,MUL,MULMSG,PRCHDRTY,PRCHFSCD,PRCHLCNT,PRCHMUL,PRCHM10,PRCHMS10,PRCHMS11,PRCHUCF,PRTY,SUPUSR,UCF,UCFMSG,UFL,VND
"RTN","PRCHNPO",140,0)
 G Q^PRCHNPO4
"RTN","PRCHNPO",141,0)
 ;
"RTN","PRCHNPO",142,0)
MSG ;Call by the "ENTRY ACTION" for Simplified PC (PRC*5.1*79)
"RTN","PRCHNPO",143,0)
 NEW MSG
"RTN","PRCHNPO",144,0)
 S MSG(1)="*********************************************"
"RTN","PRCHNPO",145,0)
 S MSG(1,"F")="!!?15"
"RTN","PRCHNPO",146,0)
 S MSG(2)="*  IF THE ORDER IS MORE THAN $3000.00       *"
"RTN","PRCHNPO",147,0)
 S MSG(2,"F")="!?15"
"RTN","PRCHNPO",148,0)
 S MSG(3)="*  OR IS ON A CONTRACT, YOU CANNOT USE      *"
"RTN","PRCHNPO",149,0)
 S MSG(3,"F")="!?15"
"RTN","PRCHNPO",150,0)
 S MSG(4)="*        SIMPLIFIED PURCHASE CARD.          *"
"RTN","PRCHNPO",151,0)
 S MSG(4,"F")="!?15"
"RTN","PRCHNPO",152,0)
 S MSG(5)="*  YOU MUST USE DETAILED PURCHASE CARD!!    *"
"RTN","PRCHNPO",153,0)
 S MSG(5,"F")="!?15"
"RTN","PRCHNPO",154,0)
 S MSG(6)="*********************************************"
"RTN","PRCHNPO",155,0)
 S MSG(6,"F")="!?15"
"RTN","PRCHNPO",156,0)
 S MSG(7,"F")="!"
"RTN","PRCHNPO",157,0)
 ;
"RTN","PRCHNPO",158,0)
 D EN^DDIOL(.MSG)
"RTN","PRCHNPO",159,0)
 QUIT
"RTN","PRCSUT3")
0^4^B12450340
"RTN","PRCSUT3",1,0)
PRCSUT3 ;WISC/SAW/PLT/BGJ-TRANSACTION UTILITY PROGRAM ; 21 Apr 93  10:18 AM
"RTN","PRCSUT3",2,0)
V ;;5.1;IFCAP;**115,123**;Oct 20, 2000;Build 6
"RTN","PRCSUT3",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","PRCSUT3",4,0)
EN ;CREATE NEW TRANSACTION NUMBER
"RTN","PRCSUT3",5,0)
 D EN1^PRCSUT K DA,DIC G W5:'$D(PRC("SITE")) Q
"RTN","PRCSUT3",6,0)
EN1 G:'$D(X) OUT1 S NODE=0,PIECE=2 I $D(PRCS("TYPE")) G:'X OUT1 S T(1)=$O(^DD(410.1,"B",PRCS("TYPE"),0)) G:'T(1)!('$D(^DD(410.1,+T(1),0))) OUT1
"RTN","PRCSUT3",7,0)
 S DIC="^PRCS(410.1,",MSG="",ZERSW=0
"RTN","PRCSUT3",8,0)
 ;I $D(^PRCS(410.1,"B",X)) S N="",N=$O(^PRCS(410.1,"B",X,N)),DA=N L +^PRCS410.1,N):15 G:$T=0 OUT1 S T=$P(^PRCS(410.1,N,NODE),"^",PIECE)+1 S:T<1 T=1 L -^PRCS(410.1,N))
"RTN","PRCSUT3",9,0)
 I $D(^PRCS(410.1,"B",X)) S N="",N=$O(^PRCS(410.1,"B",X,N)),DA=N S T=$P(^PRCS(410.1,N,NODE),"^",PIECE)+1 S:T<1 T=1
"RTN","PRCSUT3",10,0)
 I '$D(^PRCS(410.1,"B",X)) S T=1,DLAYGO=410.1,DIC="^PRCS(410.1,",DIC(0)="FLXZ" D ^DIC K DLAYGO G:Y<0 W4 S DA=+Y
"RTN","PRCSUT3",11,0)
 S HDA=DA
"RTN","PRCSUT3",12,0)
T S T="000"_T,T=$E(T,$L(T)-3,$L(T))
"RTN","PRCSUT3",13,0)
T1 I $D(REP) S X=X_"-"_T I $D(^PRCS(410,"B",X)) S T=+T+1,X=$P(X,"-",1,4) G:T>9999 CANCK G T
"RTN","PRCSUT3",14,0)
 I '$D(REP),'$D(PRCS("TYPE")) S X=Z,X=X_"-"_T I $D(^PRCS(410,"B",X)) S T=+T+1 G:T>9999 CANCK G T
"RTN","PRCSUT3",15,0)
 I '$D(REP),$D(PRCS("TYPE")) S Z=X,X=X_"-"_T I $D(^PRC(424,"B",X)) S T=+T+1,X=Z G T
"RTN","PRCSUT3",16,0)
TEX S DA=HDA L +^PRCS(410.1,DA):15 S $P(^PRCS(410.1,DA,NODE),U,PIECE)=+T,$P(^(0),U,3)=DT L -^PRCS(410.1,DA)
"RTN","PRCSUT3",17,0)
OUT K DA,DIC,N,NODE,PIECE,PRCS("TYPE"),PRCSL,T,Z,HDA Q
"RTN","PRCSUT3",18,0)
OUT1 S X="",Y=-1 D OUT Q
"RTN","PRCSUT3",19,0)
EN2 ;add record in file 410
"RTN","PRCSUT3",20,0)
 S DLAYGO=410,DIC="^PRCS(410,",DIC(0)="LXZ" D ^DIC K DLAYGO G:Y<0 W4
"RTN","PRCSUT3",21,0)
EN2A S DA=+Y S:'$D(T(2)) T(2)=""
"RTN","PRCSUT3",22,0)
 S PRC("ACC")=$$ACC^PRC0C(PRC("SITE"),PRC("CP")_"^"_PRC("FY")_"^"_PRC("BBFY"))
"RTN","PRCSUT3",23,0)
 S PRCSAPP=$P(PRC("ACC"),"^",11)
"RTN","PRCSUT3",24,0)
 S ^PRCS(410,DA,0)=$P(^PRCS(410,DA,0),U)_"^^"_T(2)_"^^"_PRC("SITE"),^PRCS(410,DA,3)=PRC("CP")_"^"_PRCSAPP,$P(^(3),"^",12)=$P(PRC("ACC"),"^",3)
"RTN","PRCSUT3",25,0)
 S $P(^PRCS(410,DA,3),"^",11)=$P($$DATE^PRC0C(PRC("BBFY"),"E"),"^",7)
"RTN","PRCSUT3",26,0)
 S ^PRCS(410,"AN",$E(PRC("CP"),1,30),DA)=""
"RTN","PRCSUT3",27,0)
 D ERS410^PRC0G(DA_"^E")
"RTN","PRCSUT3",28,0)
 S:T(2)'="" ^PRCS(410,"H",$E(T(2),1,30),DA)=DUZ,$P(^PRCS(410,DA,11),"^",2)=DUZ,^PRCS(410,"K",+$P(PRC("CP")," "),DA)="",$P(^PRCS(410,DA,6),"^",4)=+$P(PRC("CP")," ") K PRCSAPP
"RTN","PRCSUT3",29,0)
EN2B S:$D(PRC("SST")) $P(^PRCS(410,DA,0),"^",10)=PRC("SST")
"RTN","PRCSUT3",30,0)
 D:$D(MYY) ERS410^PRC0G(DA_"^E") Q
"RTN","PRCSUT3",31,0)
EN3 ;INPUT TRANSFORM FOR REORDERING 410 FILE ENTRIES
"RTN","PRCSUT3",32,0)
 Q:'$D(X)  I $D(^PRCS(410,"B",X)) Q
"RTN","PRCSUT3",33,0)
 S DINUM=$O(^PRCS(410,500000))-1 S:DINUM<500000 DINUM=99999999
"RTN","PRCSUT3",34,0)
EN3A F DINUM=DINUM:-1:500000 I '$D(^PRCS(410,DINUM)) L +^PRCS(410,DINUM):0 Q:$T
"RTN","PRCSUT3",35,0)
 I DINUM=500000 S DINUM=99999999 G EN3A
"RTN","PRCSUT3",36,0)
 L -^PRCS(410,DINUM) Q
"RTN","PRCSUT3",37,0)
 ;
"RTN","PRCSUT3",38,0)
CANCK ;Look for cancelled activity when all seq used
"RTN","PRCSUT3",39,0)
 I ZERSW=0 S ZERSW=1,T=1 G T
"RTN","PRCSUT3",40,0)
CK0 S ZZH=Z,ZHOLD=Z
"RTN","PRCSUT3",41,0)
CK1 S ZZH=$O(^PRCS(410,"B",ZZH)),IEN410=0 G CER:ZZH](Z_"-9999")
"RTN","PRCSUT3",42,0)
CK2 S IEN410=$O(^PRCS(410,"B",ZZH,IEN410)) G CK1:IEN410=""
"RTN","PRCSUT3",43,0)
 I $P($G(^PRCS(410,IEN410,0)),U,2)'="CA" G CK2
"RTN","PRCSUT3",44,0)
 S DA=IEN410,DIK="^PRCS(410," D ^DIK
"RTN","PRCSUT3",45,0)
 S T=$P(ZZH,"-",5)
"RTN","PRCSUT3",46,0)
CKQ S Z=ZHOLD K DA,DIK,ZZH,ZHOLD,IEN410
"RTN","PRCSUT3",47,0)
 G T1
"RTN","PRCSUT3",48,0)
CER S MSG="No open sequence number found for "_Z_" for adjustment transaction"
"RTN","PRCSUT3",49,0)
 I $G(PRCRMPR)=1 S X="#"
"RTN","PRCSUT3",50,0)
 K DA,DIK,ZZH,IEN410
"RTN","PRCSUT3",51,0)
 G OUT
"RTN","PRCSUT3",52,0)
W1 S %=2 Q:T4'="O"  W !!,"Would you like to edit this request" D YN^DICN G W1:%=0 Q
"RTN","PRCSUT3",53,0)
W4 W !!,"Another user is accessing this file...  Try later.",$C(7) R:$E(IOST,1,2)="C-" X:5 G EXIT
"RTN","PRCSUT3",54,0)
W5 W !!,"You are not an authorized control point user.",!,"Contact your control point official." R X:5
"RTN","PRCSUT3",55,0)
EXIT K %,DA,DIC,DIE,DR,I,L,N,PRCS,PRCSAPP,PRCSDIC,PRC("FY"),PRCSL,PRCSY,PRC("QTR"),T,T1,T2,T3,T4,X,X1,Z,ZERSW Q
"RTN","PRCSX123")
0^5^B11445599
"RTN","PRCSX123",1,0)
PRCSX123 ;RB-SET TRANSACTION SEQUENCE FOR ALL 9999 ENTRIES
"RTN","PRCSX123",2,0)
V ;;5.1;IFCAP;**123**;MAR 25, 2009;Build 6
"RTN","PRCSX123",3,0)
 ;Per VHA Directive 2004-038, this routine should not be modified
"RTN","PRCSX123",4,0)
 Q  ;STOPS TOP DOWN ENTRY
"RTN","PRCSX123",5,0)
EN ;For patch RMPR*3.0*151 testing only and only on test system
"RTN","PRCSX123",6,0)
 ;Sets PRCS(410,"B" nodes for all 9999 entries for station,FY,fiscal qtr and FCP
"RTN","PRCSX123",7,0)
 I $$PROD^XUPROD() W !,"Can ONLY be run on test/mirror system" Q
"RTN","PRCSX123",8,0)
 W #,"The following process will set all unused transaction numbers through 9999 for"
"RTN","PRCSX123",9,0)
 W !,"selected station, FY, FQ and FCP used when entering a Prosthetics GUI PO",!!
"RTN","PRCSX123",10,0)
 S TOT=0
"RTN","PRCSX123",11,0)
1 R !!,"ENTER STATION: ",PRCSTA:60 Q:PRCSTA=""!(PRCSTA["^")
"RTN","PRCSX123",12,0)
2 R !!,"ENTER FISCAL YEAR (EX. 09): ",PRCFY:60 G 1:PRCFY=""!(PRCFY["^")
"RTN","PRCSX123",13,0)
 I $L(PRCFY)'=2 W ?30,"FISCAL YEAR MUST BE 2 DIGITS" G 2
"RTN","PRCSX123",14,0)
3 R !!,"ENTER FISCAL QUARTER (1-4): ",PRCFQ:60 G 2:PRCFQ=""!(PRCFQ["^")
"RTN","PRCSX123",15,0)
 I "1234"'[PRCFQ!($L(PRCFQ)>1) W ?40,"INVALID FISCAL QUARTER, MUST BE 1-4" G 3
"RTN","PRCSX123",16,0)
4 R !!,"ENTER FUND CONTROL POINT (FOR PROSTHETICS ORDERS): ",PRCFCP:60 G 3:PRCFCP=""!(PRCFCP["^")
"RTN","PRCSX123",17,0)
 I '$D(^PRC(420,PRCSTA,1,+PRCFCP)) W ?40,"INVALID FCP USED" G 4
"RTN","PRCSX123",18,0)
 S CHK=PRCSTA_"-"_PRCFY_"-"_PRCFCP
"RTN","PRCSX123",19,0)
 I '$D(^PRCS(410.1,"B",CHK)) W !!,CHK,"IS NOT A VALID SEQUENCE START BASE POINT FOR FILE ^PRCS(410.1,""B"")",!,"** You MUST enter accurate station, FY and FCP that you will using when doing Prosthetics GUI PO" G 1
"RTN","PRCSX123",20,0)
 S PRCSIEN=$O(^PRCS(410.1,"B",CHK,0)),PRCRSQSV=$P($G(^PRCS(410.1,PRCSIEN,0)),"^",2)
"RTN","PRCSX123",21,0)
 F I=1:1:9998 D
"RTN","PRCSX123",22,0)
 . S PRCSQ=$E("000",1,4-$L(I))_I
"RTN","PRCSX123",23,0)
 . S PRCRSQ=PRCSTA_"-"_PRCFY_"-"_PRCFQ_"-"_PRCFCP_"-"_PRCSQ
"RTN","PRCSX123",24,0)
 . I $D(^PRCS(410,"B",PRCRSQ)) W !,"** ALREADY USED: ",PRCRSQ Q
"RTN","PRCSX123",25,0)
 . S ^PRCS(410,"B",PRCRSQ,111)="##",TOT=TOT+1
"RTN","PRCSX123",26,0)
 . W !,"SET ^PRCS(410,""B"",",PRCRSQ,",111)=##"
"RTN","PRCSX123",27,0)
 S PRCSIEN=$O(^PRCS(410.1,"B",PRCSTA_"-"_PRCFY_"-"_PRCFCP,"")) I PRCSIEN S $P(^PRCS(410.1,PRCSIEN,0),"^",2)=9998,$P(^PRCS(410.1,PRCSIEN,0),"^",5)=PRCRSQSV
"RTN","PRCSX123",28,0)
 W !!,"** ALL 9999 SLOTS HAVE BEEN SET FOR REQ #: ",$P(PRCRSQ,"-",1,4),"  TOTAL SET = ",TOT
"RTN","PRCSX123",29,0)
 W !!,"PATCH RMPR*3.0*151 MAY BE TESTED AT THIS POINT"
"RTN","PRCSX123",30,0)
 K PRCSTA,PRCFY,PRCFQ,PRCFCP,I,PRCSQ,PRCRSQ,XX,CHK,PRCSIEN,PRCRSQSV,TOT
"RTN","PRCSX123",31,0)
 Q
"RTN","PRCSX123",32,0)
DEL ;DELETE DUMMY ^PRCS(410,"B" ENTRIES CREATED FOR RMPR*3.0*151 TESTING
"RTN","PRCSX123",33,0)
 I $$PROD^XUPROD() W !,"Can ONLY be run on test/mirror system" Q
"RTN","PRCSX123",34,0)
 S IEN=0,PRCRSQ=0,TOT=0
"RTN","PRCSX123",35,0)
 F  S PRCRSQ=$O(^PRCS(410,"B",PRCRSQ)),IEN=0 Q:PRCRSQ=""  D
"RTN","PRCSX123",36,0)
 . F  S IEN=$O(^PRCS(410,"B",PRCRSQ,IEN)) Q:IEN=""  D
"RTN","PRCSX123",37,0)
 .. S PRCREC=^PRCS(410,"B",PRCRSQ,IEN) Q:PRCREC'="##"
"RTN","PRCSX123",38,0)
 .. W !,"KILLING ^PRCS(410,""B"",",PRCRSQ,",",IEN S HPRCRSQ=PRCRSQ,TOT=TOT+1
"RTN","PRCSX123",39,0)
 .. K ^PRCS(410,"B",PRCRSQ,IEN)
"RTN","PRCSX123",40,0)
 I TOT=0 G DQ
"RTN","PRCSX123",41,0)
 S PRCRSQ=$P(HPRCRSQ,"-")_"-"_$P(HPRCRSQ,"-",2)_"-"_$P(HPRCRSQ,"-",4)
"RTN","PRCSX123",42,0)
 S PRCSIEN=$O(^PRCS(410.1,"B",PRCRSQ,"")) I PRCSIEN S $P(^PRCS(410.1,PRCSIEN,0),"^",2)=$P(^PRCS(410.1,PRCSIEN,0),"^",5),$P(^PRCS(410.1,PRCSIEN,0),"^",5)=""
"RTN","PRCSX123",43,0)
 W !!,"ALL ADDED (",TOT,") TESTING ENTRIES FOR REQ SERIES ",$P(HPRCRSQ,"-",1,4)," HAVE BEEN DELETED",!
"RTN","PRCSX123",44,0)
DQ K IEN,PRCRSQ,PRCSIEN,HPRCRSQ,TOT,PRCREC
"RTN","PRCSX123",45,0)
 Q
"VER")
8.0^22.0
**END**
**END**
