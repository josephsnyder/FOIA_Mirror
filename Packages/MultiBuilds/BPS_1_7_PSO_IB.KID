KIDS Distribution saved on Jun 15, 2009@13:48:11
BPS*1.0*7, PSO*7.0*289, IB*2.0*384 BUNDLE
**KIDS**:BPS PSO IB BUNDLE 3.0^BPS*1.0*7^PSO*7.0*289^IB*2.0*384^

**INSTALL NAME**
BPS PSO IB BUNDLE 3.0
"BLD",7425,0)
BPS PSO IB BUNDLE 3.0^^1^3090615^n
"BLD",7425,1,0)
^^4^4^3080624^
"BLD",7425,1,1,0)
Multi-build bundle of:
"BLD",7425,1,2,0)
        BPS*1.0*7
"BLD",7425,1,3,0)
        PSO*7.0*289
"BLD",7425,1,4,0)
        IB*2.0*384
"BLD",7425,6.3)
32
"BLD",7425,10,0)
^9.63^3^3
"BLD",7425,10,1,0)
BPS*1.0*7^1
"BLD",7425,10,2,0)
PSO*7.0*289^1
"BLD",7425,10,3,0)
IB*2.0*384^1
"BLD",7425,10,"B","BPS*1.0*7",1)

"BLD",7425,10,"B","IB*2.0*384",3)

"BLD",7425,10,"B","PSO*7.0*289",2)

"BLD",7425,"KRN",0)
^9.67PA^8989.52^19
"BLD",7425,"KRN",.4,0)
.4
"BLD",7425,"KRN",.401,0)
.401
"BLD",7425,"KRN",.402,0)
.402
"BLD",7425,"KRN",.403,0)
.403
"BLD",7425,"KRN",.5,0)
.5
"BLD",7425,"KRN",.84,0)
.84
"BLD",7425,"KRN",3.6,0)
3.6
"BLD",7425,"KRN",3.8,0)
3.8
"BLD",7425,"KRN",9.2,0)
9.2
"BLD",7425,"KRN",9.8,0)
9.8
"BLD",7425,"KRN",19,0)
19
"BLD",7425,"KRN",19.1,0)
19.1
"BLD",7425,"KRN",101,0)
101
"BLD",7425,"KRN",409.61,0)
409.61
"BLD",7425,"KRN",771,0)
771
"BLD",7425,"KRN",870,0)
870
"BLD",7425,"KRN",8989.51,0)
8989.51
"BLD",7425,"KRN",8989.52,0)
8989.52
"BLD",7425,"KRN",8994,0)
8994
"BLD",7425,"KRN","B",.4,.4)

"BLD",7425,"KRN","B",.401,.401)

"BLD",7425,"KRN","B",.402,.402)

"BLD",7425,"KRN","B",.403,.403)

"BLD",7425,"KRN","B",.5,.5)

"BLD",7425,"KRN","B",.84,.84)

"BLD",7425,"KRN","B",3.6,3.6)

"BLD",7425,"KRN","B",3.8,3.8)

"BLD",7425,"KRN","B",9.2,9.2)

"BLD",7425,"KRN","B",9.8,9.8)

"BLD",7425,"KRN","B",19,19)

"BLD",7425,"KRN","B",19.1,19.1)

"BLD",7425,"KRN","B",101,101)

"BLD",7425,"KRN","B",409.61,409.61)

"BLD",7425,"KRN","B",771,771)

"BLD",7425,"KRN","B",870,870)

"BLD",7425,"KRN","B",8989.51,8989.51)

"BLD",7425,"KRN","B",8989.52,8989.52)

"BLD",7425,"KRN","B",8994,8994)

"MBREQ")
0
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"VER")
8.0^22.0
**INSTALL NAME**
BPS*1.0*7
"BLD",7385,0)
BPS*1.0*7^E CLAIMS MGMT ENGINE^0^3090615^y
"BLD",7385,1,0)
^^1^1^3080528^
"BLD",7385,1,1,0)
E-PHARMACY ENHANCEMENTS
"BLD",7385,4,0)
^9.64PA^9002313.32^15
"BLD",7385,4,9002313.02,0)
9002313.02
"BLD",7385,4,9002313.02,222)
y^y^f^^^^n
"BLD",7385,4,9002313.03,0)
9002313.03
"BLD",7385,4,9002313.03,222)
y^y^f^^^^n
"BLD",7385,4,9002313.15,0)
9002313.15
"BLD",7385,4,9002313.15,222)
y^y^f^^^^n
"BLD",7385,4,9002313.25,0)
9002313.25
"BLD",7385,4,9002313.25,222)
y^y^f^^n^^y^o^n
"BLD",7385,4,9002313.26,0)
9002313.26
"BLD",7385,4,9002313.26,222)
y^y^f^^n^^y^o^n
"BLD",7385,4,9002313.32,0)
9002313.32
"BLD",7385,4,9002313.32,2,0)
^9.641^9002313.32^1
"BLD",7385,4,9002313.32,2,9002313.32,0)
BPS PAYER RESPONSE OVERRIDES  (File-top level)
"BLD",7385,4,9002313.32,2,9002313.32,1,0)
^9.6411^.07^1
"BLD",7385,4,9002313.32,2,9002313.32,1,.07,0)
DELAY
"BLD",7385,4,9002313.32,222)
y^n^p^^^^n^^n
"BLD",7385,4,9002313.32,224)

"BLD",7385,4,9002313.56,0)
9002313.56
"BLD",7385,4,9002313.56,222)
y^y^f^^^^n
"BLD",7385,4,9002313.57,0)
9002313.57
"BLD",7385,4,9002313.57,222)
y^y^f^^^^n
"BLD",7385,4,9002313.59,0)
9002313.59
"BLD",7385,4,9002313.59,222)
y^y^f^^^^n^^n
"BLD",7385,4,9002313.59,224)

"BLD",7385,4,9002313.77,0)
9002313.77
"BLD",7385,4,9002313.77,222)
y^n^f^^^^n
"BLD",7385,4,9002313.78,0)
9002313.78
"BLD",7385,4,9002313.78,222)
y^y^f^^^^n
"BLD",7385,4,9002313.91,0)
9002313.91
"BLD",7385,4,9002313.91,222)
y^y^f^^^^n
"BLD",7385,4,9002313.92,0)
9002313.92
"BLD",7385,4,9002313.92,222)
y^y^f^^^^n
"BLD",7385,4,9002313.93,0)
9002313.93
"BLD",7385,4,9002313.93,222)
y^y^f^^n^^y^r^n
"BLD",7385,4,9002313.99,0)
9002313.99
"BLD",7385,4,9002313.99,222)
y^y^f^^^^n
"BLD",7385,4,"APDD",9002313.32,9002313.32)

"BLD",7385,4,"APDD",9002313.32,9002313.32,.07)

"BLD",7385,4,"B",9002313.02,9002313.02)

"BLD",7385,4,"B",9002313.03,9002313.03)

"BLD",7385,4,"B",9002313.15,9002313.15)

"BLD",7385,4,"B",9002313.25,9002313.25)

"BLD",7385,4,"B",9002313.26,9002313.26)

"BLD",7385,4,"B",9002313.32,9002313.32)

"BLD",7385,4,"B",9002313.56,9002313.56)

"BLD",7385,4,"B",9002313.57,9002313.57)

"BLD",7385,4,"B",9002313.59,9002313.59)

"BLD",7385,4,"B",9002313.77,9002313.77)

"BLD",7385,4,"B",9002313.78,9002313.78)

"BLD",7385,4,"B",9002313.91,9002313.91)

"BLD",7385,4,"B",9002313.92,9002313.92)

"BLD",7385,4,"B",9002313.93,9002313.93)

"BLD",7385,4,"B",9002313.99,9002313.99)

"BLD",7385,6.3)
46
"BLD",7385,"ABPKG")
n
"BLD",7385,"INI")
PRE^BPS10P7
"BLD",7385,"INID")
^n^n
"BLD",7385,"INIT")
POST^BPS10P7
"BLD",7385,"KRN",0)
^9.67PA^8989.52^19
"BLD",7385,"KRN",.4,0)
.4
"BLD",7385,"KRN",.4,"NM",0)
^9.68A^^
"BLD",7385,"KRN",.401,0)
.401
"BLD",7385,"KRN",.401,"NM",0)
^9.68A^2^2
"BLD",7385,"KRN",.401,"NM",1,0)
BPS TECH - FILES    FILE #1^1^1^
"BLD",7385,"KRN",.401,"NM",2,0)
BPS TECH - OPTIONS    FILE #19^19^1^
"BLD",7385,"KRN",.401,"NM","B","BPS TECH - FILES    FILE #1",1)

"BLD",7385,"KRN",.401,"NM","B","BPS TECH - OPTIONS    FILE #19",2)

"BLD",7385,"KRN",.402,0)
.402
"BLD",7385,"KRN",.402,"NM",0)
^9.68A^8^8
"BLD",7385,"KRN",.402,"NM",1,0)
BPSJ ALT CONTACT ENTER/EDIT    FILE #9002313.99^9002313.99^1^
"BLD",7385,"KRN",.402,"NM",2,0)
BPSJ CONTACT ENTER/EDIT    FILE #9002313.99^9002313.99^1^
"BLD",7385,"KRN",.402,"NM",3,0)
BPSJ SITE SETUP    FILE #9002313.99^9002313.99^0
"BLD",7385,"KRN",.402,"NM",4,0)
BPSJ PHARMACY SITE ENTER/EDIT    FILE #9002313.56^9002313.56^1^
"BLD",7385,"KRN",.402,"NM",5,0)
BPSJ PHARM CONTACT ENTER/EDIT    FILE #9002313.56^9002313.56^1^
"BLD",7385,"KRN",.402,"NM",6,0)
BPSJ PHARM ALT CONT ENTER/EDIT    FILE #9002313.56^9002313.56^1^
"BLD",7385,"KRN",.402,"NM",7,0)
BPSJ PHARMACIST ENTER/EDIT    FILE #9002313.56^9002313.56^1^
"BLD",7385,"KRN",.402,"NM",8,0)
BPSJ PHARMACY ENTER/EDIT    FILE #9002313.56^9002313.56^0
"BLD",7385,"KRN",.402,"NM","B","BPSJ ALT CONTACT ENTER/EDIT    FILE #9002313.99",1)

"BLD",7385,"KRN",.402,"NM","B","BPSJ CONTACT ENTER/EDIT    FILE #9002313.99",2)

"BLD",7385,"KRN",.402,"NM","B","BPSJ PHARM ALT CONT ENTER/EDIT    FILE #9002313.56",6)

"BLD",7385,"KRN",.402,"NM","B","BPSJ PHARM CONTACT ENTER/EDIT    FILE #9002313.56",5)

"BLD",7385,"KRN",.402,"NM","B","BPSJ PHARMACIST ENTER/EDIT    FILE #9002313.56",7)

"BLD",7385,"KRN",.402,"NM","B","BPSJ PHARMACY ENTER/EDIT    FILE #9002313.56",8)

"BLD",7385,"KRN",.402,"NM","B","BPSJ PHARMACY SITE ENTER/EDIT    FILE #9002313.56",4)

"BLD",7385,"KRN",.402,"NM","B","BPSJ SITE SETUP    FILE #9002313.99",3)

"BLD",7385,"KRN",.403,0)
.403
"BLD",7385,"KRN",.5,0)
.5
"BLD",7385,"KRN",.84,0)
.84
"BLD",7385,"KRN",3.6,0)
3.6
"BLD",7385,"KRN",3.8,0)
3.8
"BLD",7385,"KRN",9.2,0)
9.2
"BLD",7385,"KRN",9.8,0)
9.8
"BLD",7385,"KRN",9.8,"NM",0)
^9.68A^92^88
"BLD",7385,"KRN",9.8,"NM",2,0)
BPSSCRU5^^0^B61189921
"BLD",7385,"KRN",9.8,"NM",3,0)
BPSOSRB^^0^B38286741
"BLD",7385,"KRN",9.8,"NM",4,0)
BPSOSRX^^0^B40176170
"BLD",7385,"KRN",9.8,"NM",5,0)
BPSNCPDP^^0^B54845917
"BLD",7385,"KRN",9.8,"NM",6,0)
BPSUSCR1^^0^B33759524
"BLD",7385,"KRN",9.8,"NM",7,0)
BPSNCPD1^^0^B46831868
"BLD",7385,"KRN",9.8,"NM",9,0)
BPSOSIZ^^0^B14362353
"BLD",7385,"KRN",9.8,"NM",10,0)
BPSOSU^^0^B40258951
"BLD",7385,"KRN",9.8,"NM",11,0)
BPSOSUC^^0^B6202882
"BLD",7385,"KRN",9.8,"NM",12,0)
BPSSCR03^^0^B48894943
"BLD",7385,"KRN",9.8,"NM",13,0)
BPSSCRRS^^0^B34449344
"BLD",7385,"KRN",9.8,"NM",14,0)
BPSSCRRV^^0^B37049932
"BLD",7385,"KRN",9.8,"NM",15,0)
BPSSCRU3^^0^B30240821
"BLD",7385,"KRN",9.8,"NM",16,0)
BPSRPAY^^0^B35245645
"BLD",7385,"KRN",9.8,"NM",17,0)
BPSGRPL^^0^B2437536
"BLD",7385,"KRN",9.8,"NM",18,0)
BPSOSIY^^0^B55797518
"BLD",7385,"KRN",9.8,"NM",19,0)
BPSUTIL2^^0^B11085686
"BLD",7385,"KRN",9.8,"NM",20,0)
BPSRPT0^^0^B22975830
"BLD",7385,"KRN",9.8,"NM",21,0)
BPSRPT1^^0^B52062138
"BLD",7385,"KRN",9.8,"NM",22,0)
BPSRPT3^^0^B37506169
"BLD",7385,"KRN",9.8,"NM",23,0)
BPSRPT4^^0^B67405446
"BLD",7385,"KRN",9.8,"NM",24,0)
BPSRPT5^^0^B72711123
"BLD",7385,"KRN",9.8,"NM",25,0)
BPSRPT6^^0^B59574231
"BLD",7385,"KRN",9.8,"NM",26,0)
BPSRPT7^^0^B77006502
"BLD",7385,"KRN",9.8,"NM",27,0)
BPSRPT8^^0^B78632943
"BLD",7385,"KRN",9.8,"NM",28,0)
BPSOSS8^^0^B1703935
"BLD",7385,"KRN",9.8,"NM",29,0)
BPSOSQ4^^0^B46598620
"BLD",7385,"KRN",9.8,"NM",30,0)
BPS10P7^^0^B26269995
"BLD",7385,"KRN",9.8,"NM",31,0)
BPSWRKLS^^0^B27286584
"BLD",7385,"KRN",9.8,"NM",32,0)
BPSSCRCL^^0^B65041094
"BLD",7385,"KRN",9.8,"NM",33,0)
BPSSCRSL^^0^B14489161
"BLD",7385,"KRN",9.8,"NM",34,0)
BPSSCR02^^0^B42664540
"BLD",7385,"KRN",9.8,"NM",35,0)
BPSREOP1^^0^B59193506
"BLD",7385,"KRN",9.8,"NM",38,0)
BPSJAREG^^0^B11441916
"BLD",7385,"KRN",9.8,"NM",39,0)
BPSJINIT^^0^B16011071
"BLD",7385,"KRN",9.8,"NM",40,0)
BPSJZQR^^0^B3046471
"BLD",7385,"KRN",9.8,"NM",41,0)
BPSJVAL1^^0^B16799335
"BLD",7385,"KRN",9.8,"NM",42,0)
BPSJZRP^^0^B12105763
"BLD",7385,"KRN",9.8,"NM",43,0)
BPSJINI1^^1^
"BLD",7385,"KRN",9.8,"NM",44,0)
BPSJPREG^^0^B20416052
"BLD",7385,"KRN",9.8,"NM",45,0)
BPS01P2^^1^
"BLD",7385,"KRN",9.8,"NM",46,0)
BPSECFM^^0^B10863158
"BLD",7385,"KRN",9.8,"NM",47,0)
BPSOSO1^^0^B2986345
"BLD",7385,"KRN",9.8,"NM",48,0)
BPSOSU1^^0^B17364253
"BLD",7385,"KRN",9.8,"NM",49,0)
BPSOSU2^^0^B3696571
"BLD",7385,"KRN",9.8,"NM",50,0)
BPSOSU3^^0^B2862686
"BLD",7385,"KRN",9.8,"NM",51,0)
BPSOSU4^^0^B25067052
"BLD",7385,"KRN",9.8,"NM",52,0)
BPSOSU5^^0^B2226067
"BLD",7385,"KRN",9.8,"NM",53,0)
BPSOSU9^^0^B6204766
"BLD",7385,"KRN",9.8,"NM",54,0)
BPSOSUE^^0^B23427846
"BLD",7385,"KRN",9.8,"NM",55,0)
BPSUSCR^^0^B1332566
"BLD",7385,"KRN",9.8,"NM",56,0)
BPSOSQL^^0^B22164075
"BLD",7385,"KRN",9.8,"NM",57,0)
BPSECMPS^^0^B75418064
"BLD",7385,"KRN",9.8,"NM",58,0)
BPSRES^^0^B66886236
"BLD",7385,"KRN",9.8,"NM",59,0)
BPS01P5^^1^
"BLD",7385,"KRN",9.8,"NM",60,0)
BPS01P5A^^1^
"BLD",7385,"KRN",9.8,"NM",61,0)
BPS01P5B^^1^
"BLD",7385,"KRN",9.8,"NM",62,0)
BPS01P5C^^1^
"BLD",7385,"KRN",9.8,"NM",63,0)
BPSJACK^^0^B36662405
"BLD",7385,"KRN",9.8,"NM",64,0)
BPSJUTL^^0^B9363342
"BLD",7385,"KRN",9.8,"NM",65,0)
BPSNCPD4^^0^B40771134
"BLD",7385,"KRN",9.8,"NM",66,0)
BPSNCPD5^^0^B64980990
"BLD",7385,"KRN",9.8,"NM",67,0)
BPSNCPD6^^0^B36903046
"BLD",7385,"KRN",9.8,"NM",68,0)
BPSOSRX2^^0^B19493151
"BLD",7385,"KRN",9.8,"NM",69,0)
BPSOSRX3^^0^B60624911
"BLD",7385,"KRN",9.8,"NM",70,0)
BPSOSRX4^^0^B38901734
"BLD",7385,"KRN",9.8,"NM",71,0)
BPSOSRX5^^0^B30558901
"BLD",7385,"KRN",9.8,"NM",72,0)
BPSOSRX6^^0^B25462490
"BLD",7385,"KRN",9.8,"NM",73,0)
BPSOSRX7^^0^B26288315
"BLD",7385,"KRN",9.8,"NM",74,0)
BPSOSRX8^^0^B22051341
"BLD",7385,"KRN",9.8,"NM",75,0)
BPSOSQ2^^0^B18999575
"BLD",7385,"KRN",9.8,"NM",76,0)
BPSOSQF^^0^B8536069
"BLD",7385,"KRN",9.8,"NM",77,0)
BPSUSCR4^^0^B12367629
"BLD",7385,"KRN",9.8,"NM",78,0)
BPSUSCR2^^0^B9480735
"BLD",7385,"KRN",9.8,"NM",79,0)
BPSSCRCU^^0^B9528540
"BLD",7385,"KRN",9.8,"NM",80,0)
BPSSCR05^^0^B7623180
"BLD",7385,"KRN",9.8,"NM",81,0)
BPSSCRCV^^0^B45399490
"BLD",7385,"KRN",9.8,"NM",82,0)
BPSNCPD3^^0^B28795294
"BLD",7385,"KRN",9.8,"NM",83,0)
BPSSCRLG^^0^B95335082
"BLD",7385,"KRN",9.8,"NM",84,0)
BPSOSCE^^0^B13508896
"BLD",7385,"KRN",9.8,"NM",85,0)
BPSOSQA^^0^B8495270
"BLD",7385,"KRN",9.8,"NM",86,0)
BPSOSCD^^0^B38794587
"BLD",7385,"KRN",9.8,"NM",87,0)
BPSBCKJ^^0^B46863482
"BLD",7385,"KRN",9.8,"NM",88,0)
BPSTEST^^0^B58349994
"BLD",7385,"KRN",9.8,"NM",89,0)
BPSNCPD2^^0^B37810791
"BLD",7385,"KRN",9.8,"NM",90,0)
BPSJVAL2^^0^B28993477
"BLD",7385,"KRN",9.8,"NM",91,0)
BPSBUTL^^0^B52438241
"BLD",7385,"KRN",9.8,"NM",92,0)
BPSECMP2^^0^B65381768
"BLD",7385,"KRN",9.8,"NM","B","BPS01P2",45)

"BLD",7385,"KRN",9.8,"NM","B","BPS01P5",59)

"BLD",7385,"KRN",9.8,"NM","B","BPS01P5A",60)

"BLD",7385,"KRN",9.8,"NM","B","BPS01P5B",61)

"BLD",7385,"KRN",9.8,"NM","B","BPS01P5C",62)

"BLD",7385,"KRN",9.8,"NM","B","BPS10P7",30)

"BLD",7385,"KRN",9.8,"NM","B","BPSBCKJ",87)

"BLD",7385,"KRN",9.8,"NM","B","BPSBUTL",91)

"BLD",7385,"KRN",9.8,"NM","B","BPSECFM",46)

"BLD",7385,"KRN",9.8,"NM","B","BPSECMP2",92)

"BLD",7385,"KRN",9.8,"NM","B","BPSECMPS",57)

"BLD",7385,"KRN",9.8,"NM","B","BPSGRPL",17)

"BLD",7385,"KRN",9.8,"NM","B","BPSJACK",63)

"BLD",7385,"KRN",9.8,"NM","B","BPSJAREG",38)

"BLD",7385,"KRN",9.8,"NM","B","BPSJINI1",43)

"BLD",7385,"KRN",9.8,"NM","B","BPSJINIT",39)

"BLD",7385,"KRN",9.8,"NM","B","BPSJPREG",44)

"BLD",7385,"KRN",9.8,"NM","B","BPSJUTL",64)

"BLD",7385,"KRN",9.8,"NM","B","BPSJVAL1",41)

"BLD",7385,"KRN",9.8,"NM","B","BPSJVAL2",90)

"BLD",7385,"KRN",9.8,"NM","B","BPSJZQR",40)

"BLD",7385,"KRN",9.8,"NM","B","BPSJZRP",42)

"BLD",7385,"KRN",9.8,"NM","B","BPSNCPD1",7)

"BLD",7385,"KRN",9.8,"NM","B","BPSNCPD2",89)

"BLD",7385,"KRN",9.8,"NM","B","BPSNCPD3",82)

"BLD",7385,"KRN",9.8,"NM","B","BPSNCPD4",65)

"BLD",7385,"KRN",9.8,"NM","B","BPSNCPD5",66)

"BLD",7385,"KRN",9.8,"NM","B","BPSNCPD6",67)

"BLD",7385,"KRN",9.8,"NM","B","BPSNCPDP",5)

"BLD",7385,"KRN",9.8,"NM","B","BPSOSCD",86)

"BLD",7385,"KRN",9.8,"NM","B","BPSOSCE",84)

"BLD",7385,"KRN",9.8,"NM","B","BPSOSIY",18)

"BLD",7385,"KRN",9.8,"NM","B","BPSOSIZ",9)

"BLD",7385,"KRN",9.8,"NM","B","BPSOSO1",47)

"BLD",7385,"KRN",9.8,"NM","B","BPSOSQ2",75)

"BLD",7385,"KRN",9.8,"NM","B","BPSOSQ4",29)

"BLD",7385,"KRN",9.8,"NM","B","BPSOSQA",85)

"BLD",7385,"KRN",9.8,"NM","B","BPSOSQF",76)

"BLD",7385,"KRN",9.8,"NM","B","BPSOSQL",56)

"BLD",7385,"KRN",9.8,"NM","B","BPSOSRB",3)

"BLD",7385,"KRN",9.8,"NM","B","BPSOSRX",4)

"BLD",7385,"KRN",9.8,"NM","B","BPSOSRX2",68)

"BLD",7385,"KRN",9.8,"NM","B","BPSOSRX3",69)

"BLD",7385,"KRN",9.8,"NM","B","BPSOSRX4",70)

"BLD",7385,"KRN",9.8,"NM","B","BPSOSRX5",71)

"BLD",7385,"KRN",9.8,"NM","B","BPSOSRX6",72)

"BLD",7385,"KRN",9.8,"NM","B","BPSOSRX7",73)

"BLD",7385,"KRN",9.8,"NM","B","BPSOSRX8",74)

"BLD",7385,"KRN",9.8,"NM","B","BPSOSS8",28)

"BLD",7385,"KRN",9.8,"NM","B","BPSOSU",10)

"BLD",7385,"KRN",9.8,"NM","B","BPSOSU1",48)

"BLD",7385,"KRN",9.8,"NM","B","BPSOSU2",49)

"BLD",7385,"KRN",9.8,"NM","B","BPSOSU3",50)

"BLD",7385,"KRN",9.8,"NM","B","BPSOSU4",51)

"BLD",7385,"KRN",9.8,"NM","B","BPSOSU5",52)

"BLD",7385,"KRN",9.8,"NM","B","BPSOSU9",53)

"BLD",7385,"KRN",9.8,"NM","B","BPSOSUC",11)

"BLD",7385,"KRN",9.8,"NM","B","BPSOSUE",54)

"BLD",7385,"KRN",9.8,"NM","B","BPSREOP1",35)

"BLD",7385,"KRN",9.8,"NM","B","BPSRES",58)

"BLD",7385,"KRN",9.8,"NM","B","BPSRPAY",16)

"BLD",7385,"KRN",9.8,"NM","B","BPSRPT0",20)

"BLD",7385,"KRN",9.8,"NM","B","BPSRPT1",21)

"BLD",7385,"KRN",9.8,"NM","B","BPSRPT3",22)

"BLD",7385,"KRN",9.8,"NM","B","BPSRPT4",23)

"BLD",7385,"KRN",9.8,"NM","B","BPSRPT5",24)

"BLD",7385,"KRN",9.8,"NM","B","BPSRPT6",25)

"BLD",7385,"KRN",9.8,"NM","B","BPSRPT7",26)

"BLD",7385,"KRN",9.8,"NM","B","BPSRPT8",27)

"BLD",7385,"KRN",9.8,"NM","B","BPSSCR02",34)

"BLD",7385,"KRN",9.8,"NM","B","BPSSCR03",12)

"BLD",7385,"KRN",9.8,"NM","B","BPSSCR05",80)

"BLD",7385,"KRN",9.8,"NM","B","BPSSCRCL",32)

"BLD",7385,"KRN",9.8,"NM","B","BPSSCRCU",79)

"BLD",7385,"KRN",9.8,"NM","B","BPSSCRCV",81)

"BLD",7385,"KRN",9.8,"NM","B","BPSSCRLG",83)

"BLD",7385,"KRN",9.8,"NM","B","BPSSCRRS",13)

"BLD",7385,"KRN",9.8,"NM","B","BPSSCRRV",14)

"BLD",7385,"KRN",9.8,"NM","B","BPSSCRSL",33)

"BLD",7385,"KRN",9.8,"NM","B","BPSSCRU3",15)

"BLD",7385,"KRN",9.8,"NM","B","BPSSCRU5",2)

"BLD",7385,"KRN",9.8,"NM","B","BPSTEST",88)

"BLD",7385,"KRN",9.8,"NM","B","BPSUSCR",55)

"BLD",7385,"KRN",9.8,"NM","B","BPSUSCR1",6)

"BLD",7385,"KRN",9.8,"NM","B","BPSUSCR2",78)

"BLD",7385,"KRN",9.8,"NM","B","BPSUSCR4",77)

"BLD",7385,"KRN",9.8,"NM","B","BPSUTIL2",19)

"BLD",7385,"KRN",9.8,"NM","B","BPSWRKLS",31)

"BLD",7385,"KRN",19,0)
19
"BLD",7385,"KRN",19,"NM",0)
^9.68A^3^3
"BLD",7385,"KRN",19,"NM",1,0)
BPS SETUP REGISTER PHARMACY^^0
"BLD",7385,"KRN",19,"NM",2,0)
BPS MENU MAINTENANCE^^2
"BLD",7385,"KRN",19,"NM",3,0)
IB DRUGS NON COVERED REPORT^^0
"BLD",7385,"KRN",19,"NM","B","BPS MENU MAINTENANCE",2)

"BLD",7385,"KRN",19,"NM","B","BPS SETUP REGISTER PHARMACY",1)

"BLD",7385,"KRN",19,"NM","B","IB DRUGS NON COVERED REPORT",3)

"BLD",7385,"KRN",19.1,0)
19.1
"BLD",7385,"KRN",101,0)
101
"BLD",7385,"KRN",101,"NM",0)
^9.68A^21^21
"BLD",7385,"KRN",101,"NM",1,0)
BPS PRTCL USRSCR REOPEN CLOSED CLAIMS^^0
"BLD",7385,"KRN",101,"NM",2,0)
BPS PRTCL USRSCR CLOSE^^0
"BLD",7385,"KRN",101,"NM",3,0)
BPS PRTCL RSCH ON HOLD COPAY^^0
"BLD",7385,"KRN",101,"NM",4,0)
BPS PRTCL RSCH GRPL^^0
"BLD",7385,"KRN",101,"NM",5,0)
BPS PRTCL IBCNR EDIT PLAN^^0
"BLD",7385,"KRN",101,"NM",6,0)
BPS PRTCL IBCNR PLAN MATCH^^0
"BLD",7385,"KRN",101,"NM",7,0)
BPS PRTCL IBCNR GROUP PLAN MATCH^^0
"BLD",7385,"KRN",101,"NM",8,0)
BPS PRTCL USRSCR PHARM WRKLST^^0
"BLD",7385,"KRN",101,"NM",9,0)
BPS PRTCL ECME USRSCR^^0
"BLD",7385,"KRN",101,"NM",10,0)
BPS PRTCL USRSCR EXIT^^0
"BLD",7385,"KRN",101,"NM",11,0)
BPS PRTCL USRSCR HIDDEN ACTIONS^^2
"BLD",7385,"KRN",101,"NM",12,0)
BPS PRTCL RSCH MENU^^2
"BLD",7385,"KRN",101,"NM",13,0)
BPS PRTCL USRSCR REVERSE^^0
"BLD",7385,"KRN",101,"NM",14,0)
BPS PRTCL USRSCR CONTINUOUS^^0
"BLD",7385,"KRN",101,"NM",15,0)
BPS PRTCL USRSCR RESUBMIT^^0
"BLD",7385,"KRN",101,"NM",16,0)
BPS PRTCL USRSCR UPDATE^^0
"BLD",7385,"KRN",101,"NM",17,0)
BPS PRTCL USRSCR SORTLIST^^0
"BLD",7385,"KRN",101,"NM",18,0)
BPS PRTCL USRSCR COMMENT^^0
"BLD",7385,"KRN",101,"NM",19,0)
BPS PRTCL USRSCR RESEARCH MENU^^0
"BLD",7385,"KRN",101,"NM",20,0)
BPS PRTCL USRSCR CLAIM LOG^^0
"BLD",7385,"KRN",101,"NM",21,0)
BPS PRTCL USRSCR CHANGE VIEW^^0
"BLD",7385,"KRN",101,"NM","B","BPS PRTCL ECME USRSCR",9)

"BLD",7385,"KRN",101,"NM","B","BPS PRTCL IBCNR EDIT PLAN",5)

"BLD",7385,"KRN",101,"NM","B","BPS PRTCL IBCNR GROUP PLAN MATCH",7)

"BLD",7385,"KRN",101,"NM","B","BPS PRTCL IBCNR PLAN MATCH",6)

"BLD",7385,"KRN",101,"NM","B","BPS PRTCL RSCH GRPL",4)

"BLD",7385,"KRN",101,"NM","B","BPS PRTCL RSCH MENU",12)

"BLD",7385,"KRN",101,"NM","B","BPS PRTCL RSCH ON HOLD COPAY",3)

"BLD",7385,"KRN",101,"NM","B","BPS PRTCL USRSCR CHANGE VIEW",21)

"BLD",7385,"KRN",101,"NM","B","BPS PRTCL USRSCR CLAIM LOG",20)

"BLD",7385,"KRN",101,"NM","B","BPS PRTCL USRSCR CLOSE",2)

"BLD",7385,"KRN",101,"NM","B","BPS PRTCL USRSCR COMMENT",18)

"BLD",7385,"KRN",101,"NM","B","BPS PRTCL USRSCR CONTINUOUS",14)

"BLD",7385,"KRN",101,"NM","B","BPS PRTCL USRSCR EXIT",10)

"BLD",7385,"KRN",101,"NM","B","BPS PRTCL USRSCR HIDDEN ACTIONS",11)

"BLD",7385,"KRN",101,"NM","B","BPS PRTCL USRSCR PHARM WRKLST",8)

"BLD",7385,"KRN",101,"NM","B","BPS PRTCL USRSCR REOPEN CLOSED CLAIMS",1)

"BLD",7385,"KRN",101,"NM","B","BPS PRTCL USRSCR RESEARCH MENU",19)

"BLD",7385,"KRN",101,"NM","B","BPS PRTCL USRSCR RESUBMIT",15)

"BLD",7385,"KRN",101,"NM","B","BPS PRTCL USRSCR REVERSE",13)

"BLD",7385,"KRN",101,"NM","B","BPS PRTCL USRSCR SORTLIST",17)

"BLD",7385,"KRN",101,"NM","B","BPS PRTCL USRSCR UPDATE",16)

"BLD",7385,"KRN",409.61,0)
409.61
"BLD",7385,"KRN",771,0)
771
"BLD",7385,"KRN",870,0)
870
"BLD",7385,"KRN",8989.51,0)
8989.51
"BLD",7385,"KRN",8989.52,0)
8989.52
"BLD",7385,"KRN",8994,0)
8994
"BLD",7385,"KRN","B",.4,.4)

"BLD",7385,"KRN","B",.401,.401)

"BLD",7385,"KRN","B",.402,.402)

"BLD",7385,"KRN","B",.403,.403)

"BLD",7385,"KRN","B",.5,.5)

"BLD",7385,"KRN","B",.84,.84)

"BLD",7385,"KRN","B",3.6,3.6)

"BLD",7385,"KRN","B",3.8,3.8)

"BLD",7385,"KRN","B",9.2,9.2)

"BLD",7385,"KRN","B",9.8,9.8)

"BLD",7385,"KRN","B",19,19)

"BLD",7385,"KRN","B",19.1,19.1)

"BLD",7385,"KRN","B",101,101)

"BLD",7385,"KRN","B",409.61,409.61)

"BLD",7385,"KRN","B",771,771)

"BLD",7385,"KRN","B",870,870)

"BLD",7385,"KRN","B",8989.51,8989.51)

"BLD",7385,"KRN","B",8989.52,8989.52)

"BLD",7385,"KRN","B",8994,8994)

"BLD",7385,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",7385,"QUES",0)
^9.62^^
"BLD",7385,"REQB",0)
^9.611^1^1
"BLD",7385,"REQB",1,0)
BPS*1.0*6^2
"BLD",7385,"REQB","B","BPS*1.0*6",1)

"DATA",9002313.25,1,0)
0^NOT SPECIFIED, DEFAULT
"DATA",9002313.25,2,0)
1^NO OVERRIDE
"DATA",9002313.25,3,0)
2^OTHER OVERRIDE
"DATA",9002313.25,4,0)
3^VACATION SUPPLY
"DATA",9002313.25,5,0)
4^LOST PRESCRIPTION
"DATA",9002313.25,6,0)
5^THERAPY CHANGE
"DATA",9002313.25,7,0)
6^STARTER DOSE
"DATA",9002313.25,8,0)
7^MEDICALLY NECESSARY
"DATA",9002313.25,9,0)
8^PROCESS COMPOUND FOR APPROVED INGREDIENTS
"DATA",9002313.25,10,0)
9^ENCOUNTERS
"DATA",9002313.25,11,0)
99^OTHER
"DATA",9002313.25,12,0)
10^MEETS PLAN LIMITATIONS
"DATA",9002313.25,13,0)
11^CERTIFICATION ON FILE
"DATA",9002313.25,14,0)
12^DME REPLACEMENT INDICATOR
"DATA",9002313.25,15,0)
13^PAYER-RECOGNIZED EMERGENCY/DISASTER ASSISTANCE REQUEST
"DATA",9002313.25,16,0)
14^LONG TERM CARE LEAVE OF ABSENCE
"DATA",9002313.25,17,0)
15^LONG TERM CARE REPLACEMENT MEDICATION
"DATA",9002313.25,18,0)
16^LONG TERM CARE EMERGENCY BOX (KIT) OR AUTOMATED DISPENSING MACHINE
"DATA",9002313.25,19,0)
17^LONG TERM CARE EMERGENCY SUPPLY REMAINDER
"DATA",9002313.25,20,0)
18^LONG TERM CARE PATIENT ADMIT/READMIT INDICATOR
"DATA",9002313.25,21,0)
19^SPLIT BILLING
"DATA",9002313.26,1,0)
0^NOT SPECIFIED
"DATA",9002313.26,2,0)
1^PRIOR AUTHORIZATION
"DATA",9002313.26,2,1,0)
^^7^7^3080312^
"DATA",9002313.26,2,1,1,0)
a) Code assigned for use with claim billing to allow processing of a 
"DATA",9002313.26,2,1,2,0)
claim which would otherwise reject based upon benefit or program design. 
"DATA",9002313.26,2,1,3,0)
b) Indicator to convey that coverage of the specified product is 
"DATA",9002313.26,2,1,4,0)
dependant upon the prescriber submitting the request (including required 
"DATA",9002313.26,2,1,5,0)
documentation) to the payer/plan or designated utilization management 
"DATA",9002313.26,2,1,6,0)
organization for approval/authorization prior to ordering/dispensing the 
"DATA",9002313.26,2,1,7,0)
product.
"DATA",9002313.26,3,0)
2^MEDICAL CERTIFICATION
"DATA",9002313.26,3,1,0)
^^3^3^3080312^
"DATA",9002313.26,3,1,1,0)
A code indicating that a health care provider practitioner certifies to 
"DATA",9002313.26,3,1,2,0)
an incapacitation, examination, or treatment or to a period of disability 
"DATA",9002313.26,3,1,3,0)
while a patient was or is receiving professional treatment.
"DATA",9002313.26,4,0)
3^EPSDT
"DATA",9002313.26,4,1,0)
^^5^5^3080312^
"DATA",9002313.26,4,1,1,0)
(Early Periodic Screening Diagnosis Treatment)-Code indicating 
"DATA",9002313.26,4,1,2,0)
information about services involving preventative health measures for 
"DATA",9002313.26,4,1,3,0)
children, e.g., screening assessments, tests and their subsequent results 
"DATA",9002313.26,4,1,4,0)
and findings, immunization information, guidance and education given, and 
"DATA",9002313.26,4,1,5,0)
follow-up care required.
"DATA",9002313.26,5,0)
4^EXEMPT FROM COPAY
"DATA",9002313.26,5,1,0)
^^3^3^3080312^
"DATA",9002313.26,5,1,1,0)
Code used to classify the reason for the prior authorization request as 
"DATA",9002313.26,5,1,2,0)
one used when the member has qualified for an exemption from copay and/or 
"DATA",9002313.26,5,1,3,0)
coinsurance payments according to the benefit design.
"DATA",9002313.26,6,0)
5^EXEMPT FROM RX
"DATA",9002313.26,6,1,0)
^^4^4^3080312^
"DATA",9002313.26,6,1,1,0)
Code used to classify the reason for the prior authorization request as 
"DATA",9002313.26,6,1,2,0)
one used when the member has qualified for an exemption from limitations 
"DATA",9002313.26,6,1,3,0)
on the number of prescriptions covered by the program/plan in a specified 
"DATA",9002313.26,6,1,4,0)
period of time.
"DATA",9002313.26,7,0)
6^FAMILY PLANNING INDICATOR
"DATA",9002313.26,7,1,0)
^^1^1^3080312^
"DATA",9002313.26,7,1,1,0)
Code to indicate the drug prescribed is for management of reproduction.
"DATA",9002313.26,8,0)
7^TANF
"DATA",9002313.26,8,1,0)
^^4^4^3080312^
"DATA",9002313.26,8,1,1,0)
(Temporary Assistance for Needy Families) - An organization that provides 
"DATA",9002313.26,8,1,2,0)
assistance and work opportunities to needy families by granting states 
"DATA",9002313.26,8,1,3,0)
the federal funds and the flexibility to develop and implement their own 
"DATA",9002313.26,8,1,4,0)
welfare programs.
"DATA",9002313.26,9,0)
8^PAYER DEFINED EXEMPTION
"DATA",9002313.26,9,1,0)
^^3^3^3080312^
"DATA",9002313.26,9,1,1,0)
Used to indicate the provider is submitting the prior authorization for 
"DATA",9002313.26,9,1,2,0)
the purpose of utilizing a payer defined exemption not covered by one of 
"DATA",9002313.26,9,1,3,0)
the other type codes.
"DATA",9002313.26,10,0)
9^EMERGENCY PREPAREDNESS
"DATA",9002313.26,10,1,0)
^^1^1^3080312^
"DATA",9002313.26,10,1,1,0)
Code used to override claim edits during an emergency situation.
"DATA",9002313.93,1,0)
01^M/I Bin Number
"DATA",9002313.93,2,0)
02^M/I Version/Release Number
"DATA",9002313.93,3,0)
03^M/I Transaction Code
"DATA",9002313.93,4,0)
04^M/I Processor Control Number
"DATA",9002313.93,5,0)
05^M/I Service Provider Number
"DATA",9002313.93,6,0)
06^M/I Group ID
"DATA",9002313.93,7,0)
07^M/I Cardholder ID
"DATA",9002313.93,8,0)
08^M/I Person Code
"DATA",9002313.93,9,0)
09^M/I Date Of Birth
"DATA",9002313.93,10,0)
10^M/I Patient Gender Code
"DATA",9002313.93,11,0)
11^M/I Patient Relationship Code
"DATA",9002313.93,12,0)
12^M/I Place of Service
"DATA",9002313.93,13,0)
13^M/I Other Coverage Code
"DATA",9002313.93,14,0)
14^M/I Eligibility Clarification Code
"DATA",9002313.93,15,0)
15^M/I Date of Service
"DATA",9002313.93,16,0)
16^M/I Prescription/Service Reference Number
"DATA",9002313.93,17,0)
17^M/I Fill Number
"DATA",9002313.93,18,0)
18^M/I Metric Quantity
"DATA",9002313.93,19,0)
19^M/I Days Supply
"DATA",9002313.93,20,0)
20^M/I Compound Code
"DATA",9002313.93,21,0)
21^M/I Product/Service ID
"DATA",9002313.93,22,0)
22^M/I Dispense As Written (DAW)/Product Selection Code
"DATA",9002313.93,23,0)
23^M/I Ingredient Cost Submitted
"DATA",9002313.93,24,0)
24^M/I SALES TAX
"DATA",9002313.93,25,0)
25^M/I Prescriber ID
"DATA",9002313.93,26,0)
26^M/I Unit Of Measure
"DATA",9002313.93,27,0)
27^(FUTURE USE)
"DATA",9002313.93,28,0)
28^M/I Date Prescription Written
"DATA",9002313.93,29,0)
29^M/I Number Of Refills Authorized
"DATA",9002313.93,30,0)
30^M/I PA/MC Code And Number
"DATA",9002313.93,31,0)
31^(FUTURE USE)
"DATA",9002313.93,32,0)
32^M/I Level Of Service
"DATA",9002313.93,33,0)
33^M/I Prescription Origin Code
"DATA",9002313.93,34,0)
34^M/I Submission Clarification Code
"DATA",9002313.93,35,0)
35^M/I Primary Care Provider ID
"DATA",9002313.93,36,0)
36^M/I Clinic ID
"DATA",9002313.93,37,0)
37^(FUTURE USE)
"DATA",9002313.93,38,0)
38^M/I Basis Of Cost Determination
"DATA",9002313.93,39,0)
39^M/I Diagnosis Code
"DATA",9002313.93,40,0)
40^Pharmacy Not Contracted With Plan On Date Of Service
"DATA",9002313.93,41,0)
41^Submit Bill To Other Processor Or Primary Payer
"DATA",9002313.93,42,0)
42^(FUTURE USE)
"DATA",9002313.93,43,0)
43^(FUTURE USE)
"DATA",9002313.93,44,0)
44^(FUTURE USE)
"DATA",9002313.93,45,0)
45^(FUTURE USE)
"DATA",9002313.93,46,0)
46^(FUTURE USE)
"DATA",9002313.93,47,0)
47^(FUTURE USE)
"DATA",9002313.93,48,0)
48^(FUTURE USE)
"DATA",9002313.93,49,0)
49^(FUTURE USE)
"DATA",9002313.93,50,0)
50^Non-Matched Pharmacy Number
"DATA",9002313.93,51,0)
51^Non-Matched Group ID
"DATA",9002313.93,52,0)
52^Non-Matched Cardholder ID
"DATA",9002313.93,53,0)
53^Non-Matched Person Code
"DATA",9002313.93,54,0)
54^Non-Matched Product/Service ID Number
"DATA",9002313.93,55,0)
55^Non-Matched Product Package Size
"DATA",9002313.93,56,0)
56^Non-Matched Prescriber ID
"DATA",9002313.93,57,0)
57^Non-Matched PA/MC Number
"DATA",9002313.93,58,0)
58^Non-Matched Primary Prescriber
"DATA",9002313.93,59,0)
59^Non-Matched Clinic ID
"DATA",9002313.93,60,0)
60^Product/Service Not Covered For Patient Age
"DATA",9002313.93,61,0)
61^Product/Service Not Covered For Patient Gender
"DATA",9002313.93,62,0)
62^Patient/Card Holder ID Name Mismatch
"DATA",9002313.93,63,0)
63^Institutionalized Patient Product/Service ID Not Covered
"DATA",9002313.93,64,0)
64^Claim Submitted Does Not Match Prior Authorization
"DATA",9002313.93,65,0)
65^Patient Is Not Covered
"DATA",9002313.93,66,0)
66^Patient Age Exceeds Maximum Age
"DATA",9002313.93,67,0)
67^Filled Before Coverage Effective
"DATA",9002313.93,68,0)
68^Filled After Coverage Expired
"DATA",9002313.93,69,0)
69^Filled After Coverage Terminated
"DATA",9002313.93,70,0)
70^Product/Service Not Covered
"DATA",9002313.93,71,0)
71^Prescriber Is Not Covered
"DATA",9002313.93,72,0)
72^Primary Prescriber Is Not Covered
"DATA",9002313.93,73,0)
73^Refills Are Not Covered
"DATA",9002313.93,74,0)
74^Other Carrier Payment Meets Or Exceeds Payable
"DATA",9002313.93,75,0)
75^Prior Authorization Required
"DATA",9002313.93,76,0)
76^Plan Limitations Exceeded
"DATA",9002313.93,77,0)
77^Discontinued Product/Service ID Number
"DATA",9002313.93,78,0)
78^Cost Exceeds Maximum
"DATA",9002313.93,79,0)
79^Refill Too Soon
"DATA",9002313.93,80,0)
80^Drug-Diagnosis Mismatch
"DATA",9002313.93,81,0)
81^Claim Too Old
"DATA",9002313.93,82,0)
82^Claim Is Post-Dated
"DATA",9002313.93,83,0)
83^Duplicate Paid/Captured Claim
"DATA",9002313.93,84,0)
84^Claim Has Not Been Paid/Captured
"DATA",9002313.93,85,0)
85^Claim Not Processed
"DATA",9002313.93,86,0)
86^Submit Manual Reversal
"DATA",9002313.93,87,0)
87^Reversal Not Processed
"DATA",9002313.93,88,0)
88^DUR Reject Error
"DATA",9002313.93,89,0)
89^Rejected Claim Fees Paid
"DATA",9002313.93,90,0)
90^Host Hung Up
"DATA",9002313.93,91,0)
91^Host Response Error
"DATA",9002313.93,92,0)
92^System Unavailable/Host Unavailable
"DATA",9002313.93,93,0)
93^Planned Unavailable
"DATA",9002313.93,94,0)
94^Invalid Message
"DATA",9002313.93,95,0)
95^Time Out
"DATA",9002313.93,96,0)
96^Scheduled Downtime
"DATA",9002313.93,97,0)
97^Payer Unavailable
"DATA",9002313.93,98,0)
98^Connection To Payer Is Down
"DATA",9002313.93,99,0)
99^Host Processing Error
"DATA",9002313.93,100,0)
CA^M/I Patient First Name
"DATA",9002313.93,101,0)
CB^M/I Patient Last Name
"DATA",9002313.93,102,0)
CC^M/I Cardholder First Name
"DATA",9002313.93,103,0)
CD^M/I Cardholder Last Name
"DATA",9002313.93,104,0)
CE^M/I Home Plan
"DATA",9002313.93,105,0)
CF^M/I Employer Name
"DATA",9002313.93,106,0)
CG^M/I Employer Street Address
"DATA",9002313.93,107,0)
CH^M/I Employer City Address
"DATA",9002313.93,108,0)
CI^M/I Employer State/Province Address
"DATA",9002313.93,109,0)
CJ^M/I Employer Zip Postal Zone
"DATA",9002313.93,110,0)
CK^M/I Employer Phone Number
"DATA",9002313.93,111,0)
CL^M/I Employer Contact Name
"DATA",9002313.93,112,0)
CM^M/I Patient Street Address
"DATA",9002313.93,113,0)
CN^M/I Patient City Address
"DATA",9002313.93,114,0)
CO^M/I Patient State/Province Address
"DATA",9002313.93,115,0)
CP^M/I Patient Zip/Postal Zone
"DATA",9002313.93,116,0)
CQ^M/I Patient Phone Number
"DATA",9002313.93,117,0)
CR^M/I Carrier ID
"DATA",9002313.93,118,0)
CT^Patient Social Security Number
"DATA",9002313.93,119,0)
DP^M/I DRUG TYPE OVERRIDE
"DATA",9002313.93,120,0)
DR^M/I Prescriber Last Name
"DATA",9002313.93,121,0)
DQ^M/I Usual And Customary Charge
"DATA",9002313.93,122,0)
DS^M/I Postage Amount Claimed
"DATA",9002313.93,123,0)
DT^M/I Special Packaging Indicator
"DATA",9002313.93,124,0)
DU^M/I Gross Amount Due
"DATA",9002313.93,125,0)
DV^M/I Other Payer Amount Paid
"DATA",9002313.93,126,0)
DW^M/I Basis Of Days Supply Determination
"DATA",9002313.93,127,0)
DX^M/I Patient Paid Amount Submitted
"DATA",9002313.93,128,0)
DY^M/I Date Of Injury
"DATA",9002313.93,129,0)
DZ^M/I Claim/Reference ID
"DATA",9002313.93,130,0)
E1^M/I Product/Service ID Qualifier
"DATA",9002313.93,131,0)
E2^M/I Route of Administration
"DATA",9002313.93,132,0)
E3^M/I Incentive Amount Submitted
"DATA",9002313.93,133,0)
E4^M/I Reason For Service Code
"DATA",9002313.93,134,0)
E5^M/I Professional Service Code
"DATA",9002313.93,135,0)
E6^M/I Result Of Service Code
"DATA",9002313.93,136,0)
E7^M/I Quantity Dispensed
"DATA",9002313.93,137,0)
E8^M/I Other Payer Date
"DATA",9002313.93,138,0)
M1^Patient Not Covered In This Aid Category
"DATA",9002313.93,139,0)
M2^Recipient Locked In
"DATA",9002313.93,140,0)
M3^Host PA/MC Error
"DATA",9002313.93,141,0)
M4^Prescription/Service Reference Number/Time Limit Exceeded
"DATA",9002313.93,142,0)
M5^Requires Manual Claim
"DATA",9002313.93,143,0)
M6^Host Eligibility Error
"DATA",9002313.93,144,0)
M7^Host Drug File Error
"DATA",9002313.93,145,0)
M8^Host Provider File Error
"DATA",9002313.93,146,0)
MZ^Error Overflow
"DATA",9002313.93,147,0)
1C^M/I Smoker/Non-Smoker Code
"DATA",9002313.93,148,0)
1E^M/I Prescriber Location Code
"DATA",9002313.93,149,0)
2C^M/I Pregnancy Indicator
"DATA",9002313.93,150,0)
2E^M/I Primary Care Provider ID Qualifier
"DATA",9002313.93,151,0)
3A^M/I Request Type
"DATA",9002313.93,152,0)
3B^M/I Request Period Date-Begin
"DATA",9002313.93,153,0)
3C^M/I Request Period Date-End
"DATA",9002313.93,154,0)
3D^M/I Basis Of Request
"DATA",9002313.93,155,0)
3E^M/I Authorized Representative First Name
"DATA",9002313.93,156,0)
3F^M/I Authorized Representative Last Name
"DATA",9002313.93,157,0)
3G^M/I Authorized Representative Street Address
"DATA",9002313.93,158,0)
3H^M/I Authorized Representative City Address
"DATA",9002313.93,159,0)
3J^M/I Authorized Representative State/Province Address
"DATA",9002313.93,160,0)
3K^M/I Authorized Representative Zip/Postal Zone
"DATA",9002313.93,161,0)
3M^M/I Prescriber Phone Number
"DATA",9002313.93,162,0)
3N^M/I Prior Authorized Number-Assigned
"DATA",9002313.93,163,0)
3P^M/I Authorization Number
"DATA",9002313.93,164,0)
3R^Prior Authorization Not Required
"DATA",9002313.93,165,0)
3S^M/I Prior Authorization Supporting Documentation
"DATA",9002313.93,166,0)
3T^Active Prior Auth Exists Resubmit At Expiration Of Prior Auth
"DATA",9002313.93,167,0)
3W^Prior Authorization In Process
"DATA",9002313.93,168,0)
3X^Authorization Number Not Found
"DATA",9002313.93,169,0)
3Y^Prior Authorization Denied
"DATA",9002313.93,170,0)
4C^M/I Coordination Of Benefits/Other Payments Count
"DATA",9002313.93,171,0)
4E^M/I Primary Care Provider Last Name
"DATA",9002313.93,172,0)
5C^M/I Other Payer Coverage Type
"DATA",9002313.93,173,0)
5E^M/I Other Payer Reject Count
"DATA",9002313.93,174,0)
6C^M/I Other Payer ID Qualifier
"DATA",9002313.93,175,0)
6E^M/I Other Payer Reject Code
"DATA",9002313.93,176,0)
7C^M/I Other Payer ID
"DATA",9002313.93,177,0)
7E^M/I DUR/PPS Code Counter
"DATA",9002313.93,178,0)
8C^M/I Facility ID
"DATA",9002313.93,179,0)
8E^M/I DUR/PPS Level of Effort
"DATA",9002313.93,180,0)
AA^Patient Spenddown Not Met
"DATA",9002313.93,181,0)
AB^Date Written Is After Date Filled
"DATA",9002313.93,182,0)
AC^Product Not Covered Non-Participating Manufacturer
"DATA",9002313.93,183,0)
AD^Billing Provider Not Eligible To Bill This Claim Type
"DATA",9002313.93,184,0)
AE^QMB (Qualified Medicare Beneficiary)-Bill Medicare
"DATA",9002313.93,185,0)
AF^Patient Enrolled Under Managed Care
"DATA",9002313.93,186,0)
AG^Days Supply Limitation For Product/Service
"DATA",9002313.93,187,0)
AH^Unit Dose Packaging Only Payable For Nursing Home Recipients
"DATA",9002313.93,188,0)
AJ^Generic Drug Required
"DATA",9002313.93,189,0)
AK^M/I Software Vendor/Certification ID
"DATA",9002313.93,190,0)
AM^M/I Segment Identification
"DATA",9002313.93,191,0)
A9^M/I Transaction Count
"DATA",9002313.93,192,0)
BE^M/I Professional Service Fee Submitted
"DATA",9002313.93,193,0)
B2^M/I Service Provider ID Qualifier
"DATA",9002313.93,194,0)
CW^M/I Alternate ID
"DATA",9002313.93,195,0)
CX^M/I Patient ID Qualifier
"DATA",9002313.93,196,0)
CY^M/I Patient ID
"DATA",9002313.93,197,0)
CZ^M/I Employer ID
"DATA",9002313.93,198,0)
DC^M/I Dispensing Fee Submitted
"DATA",9002313.93,199,0)
DN^M/I Basis Of Cost Determination
"DATA",9002313.93,200,0)
EA^M/I Originally Prescribed Product/Service Code
"DATA",9002313.93,201,0)
EB^M/I Originally Prescribed Quantity
"DATA",9002313.93,202,0)
EC^M/I Compound Ingredient Component Count
"DATA",9002313.93,203,0)
ED^M/I Compound Ingredient Quantity
"DATA",9002313.93,204,0)
EE^M/I Compound Ingredient Drug Cost
"DATA",9002313.93,205,0)
EF^M/I Compound Dosage Form Description Code
"DATA",9002313.93,206,0)
EG^M/I Compound Dispensing Unit Form Indicator
"DATA",9002313.93,207,0)
EH^M/I Compound Route of Administration
"DATA",9002313.93,208,0)
EJ^M/I Originally Prescribed Product/Service ID Qualifier
"DATA",9002313.93,209,0)
EK^M/I Scheduled Prescription ID Number
"DATA",9002313.93,210,0)
EM^M/I Prescription/Service Reference Number Qualifier
"DATA",9002313.93,211,0)
EN^M/I Associated Prescription/Service Reference Number
"DATA",9002313.93,212,0)
Ep^M/I Associated Prescription/Service Date
"DATA",9002313.93,213,0)
ER^M/I Procedure Modifier Code
"DATA",9002313.93,214,0)
ET^M/I Quantity Prescribed
"DATA",9002313.93,215,0)
EU^M/I Prior Authorization Type Code
"DATA",9002313.93,216,0)
EV^M/I Prior Authorization Number Submitted
"DATA",9002313.93,217,0)
EW^M/I Intermediary Authorization Type ID
"DATA",9002313.93,218,0)
EX^M/I Intermediary Authorization ID
"DATA",9002313.93,219,0)
EY^M/I Provider ID Qualifier
"DATA",9002313.93,220,0)
EZ^M/I Prescriber ID Qualifier
"DATA",9002313.93,221,0)
E9^M/I Provider ID
"DATA",9002313.93,222,0)
FO^M/I Plan ID
"DATA",9002313.93,223,0)
GE^M/I Percentage Sales Tax Amount Submitted
"DATA",9002313.93,224,0)
HA^M/I Flat Sales Tax Amount Submitted
"DATA",9002313.93,225,0)
HB^M/I Other Payer Amount Paid Count
"DATA",9002313.93,226,0)
HC^M/I Other Payer Amount Paid Qualifier
"DATA",9002313.93,227,0)
HD^M/I Dispensing Status
"DATA",9002313.93,228,0)
HE^M/I Percentage Sales Tax Rate Submitted
"DATA",9002313.93,229,0)
HF^M/I Quantity Intended To Be Dispensed
"DATA",9002313.93,230,0)
HG^M/I Days Supply Intended To Be Dispensed
"DATA",9002313.93,231,0)
H1^M/I Measurement Time
"DATA",9002313.93,232,0)
H2^M/I Measurement Dimension
"DATA",9002313.93,233,0)
H3^M/I Measurement Unit
"DATA",9002313.93,234,0)
H4^M/I Measurement Value
"DATA",9002313.93,235,0)
H5^M/I Primary Care Provider Location Code
"DATA",9002313.93,236,0)
H6^M/I DUR Co-Agent ID
"DATA",9002313.93,237,0)
H7^M/I Other Amount Claimed Submitted Count
"DATA",9002313.93,238,0)
H8^M/I Other Amount Claimed Submitted Qualifier
"DATA",9002313.93,239,0)
H9^M/I Other Amount Claimed Submitted
"DATA",9002313.93,240,0)
JE^M/I Percentage Sales Tax Basis Submitted
"DATA",9002313.93,241,0)
J9^M/I DUR Co-Agent ID Qualifier
"DATA",9002313.93,242,0)
KE^M/I Coupon Type
"DATA",9002313.93,243,0)
ME^M/I Coupon Number
"DATA",9002313.93,244,0)
NE^M/I Coupon Value Amount
"DATA",9002313.93,245,0)
NN^Transaction Rejected At Switch Or Intermediary
"DATA",9002313.93,246,0)
PA^PA Exhausted/Not Renewable
"DATA",9002313.93,247,0)
PB^Invalid Transaction Count For This Transaction Code
"DATA",9002313.93,248,0)
PC^M/I Request Claim Segment
"DATA",9002313.93,249,0)
PD^M/I Request Clinical Segment
"DATA",9002313.93,250,0)
PE^M/I Request Coordination Of Benefits/Other Payments Segment
"DATA",9002313.93,251,0)
PF^M/I Request Compound Segment
"DATA",9002313.93,252,0)
PG^M/I Request Coupon Segment
"DATA",9002313.93,253,0)
PH^M/I Request DUR/PPS Segment
"DATA",9002313.93,254,0)
PJ^M/I Request Insurance Segment
"DATA",9002313.93,255,0)
PK^M/I Request Patient Segment
"DATA",9002313.93,256,0)
PM^M/I Request Pharmacy Provider Segment
"DATA",9002313.93,257,0)
PN^M/I Request Prescriber Segment
"DATA",9002313.93,258,0)
PP^M/I Request Pricing Segment
"DATA",9002313.93,259,0)
PR^M/I Request Prior Authorization Segment
"DATA",9002313.93,260,0)
PS^M/I Transaction Header Segment
"DATA",9002313.93,261,0)
PT^M/I Request Worker's Compensation Segment
"DATA",9002313.93,262,0)
PV^Non-Matched Associated Prescription/Service Date
"DATA",9002313.93,263,0)
PW^Non-Matched Employer ID
"DATA",9002313.93,264,0)
PX^Non-Matched Other Payer ID
"DATA",9002313.93,265,0)
PY^Non-Matched Unit Form/Route of Administration
"DATA",9002313.93,266,0)
PZ^Non-Matched Unit Of Measure To Product/Service ID
"DATA",9002313.93,267,0)
P1^Associated Prescription/Service Reference Number Not Found
"DATA",9002313.93,268,0)
P2^Clinical Information Counter Out Of Sequence
"DATA",9002313.93,269,0)
P3^Compound Ingredient Component Count Doesn't Match # Of Repetitions
"DATA",9002313.93,270,0)
P4^COB/Other Payments Count Does Not Match Number Of Repetitions
"DATA",9002313.93,271,0)
P5^Coupon Expired
"DATA",9002313.93,272,0)
P6^Date Of Service Prior To Date Of Birth
"DATA",9002313.93,273,0)
P7^Diagnosis Code Count Does Not Match Number Of Repetitions
"DATA",9002313.93,274,0)
P8^DUR/PPS Code Counter Out Of Sequence
"DATA",9002313.93,275,0)
P9^Field Is Non-Repeatable
"DATA",9002313.93,276,0)
RA^PA Reversal Out Of Order
"DATA",9002313.93,277,0)
RB^Multiple Partials Not Allowed
"DATA",9002313.93,278,0)
RC^Different Drug Entity Between Partial & Completion
"DATA",9002313.93,279,0)
RD^Mismatched Cardholder/Group ID-Partial To Completion
"DATA",9002313.93,280,0)
RE^M/I Compound Product ID Qualifier
"DATA",9002313.93,281,0)
RF^Improper Order Of 'Dispensing Status' Code On Partial Fill Transaction
"DATA",9002313.93,282,0)
RG^M/I Associated Rx/Service Reference # On Completion Transaction
"DATA",9002313.93,283,0)
RH^M/I Associated Prescription/Service Date On Completion Transaction
"DATA",9002313.93,284,0)
RJ^Associated Partial Fill Transaction Not On File
"DATA",9002313.93,285,0)
RK^Partial Fill Transaction Not Supported
"DATA",9002313.93,286,0)
RM^Completion Trans Not Permitted W/ Same 'Date of Service' Partl Trans
"DATA",9002313.93,287,0)
RN^Plan Limits Exceeded On Intended Partial Fill Field Limitations
"DATA",9002313.93,288,0)
RP^Out Of Sequence 'P' Reversal On Partial Fill Transaction
"DATA",9002313.93,289,0)
RS^M/I Associated Prescription/Service Date On Partial Transaction
"DATA",9002313.93,290,0)
RT^M/I Associated Prescription/Service Ref Number on Partial Trans
"DATA",9002313.93,291,0)
RU^Mandatory Elements Must Occur Befr Optional Data Elements In Segment
"DATA",9002313.93,292,0)
R1^Other Amount Claimed Submitted Count Does Not Match # of Repetitions
"DATA",9002313.93,293,0)
R2^Other Payer Reject Count Does Not Match Number Of Repetitions
"DATA",9002313.93,294,0)
R3^Procedure Modifier Code Count Does Not Match Number Of Repetitions
"DATA",9002313.93,295,0)
R4^Procedure Modifier Code Invalid For Product/Service ID
"DATA",9002313.93,296,0)
R5^Product/Service ID Must Be Zero When Product/Service ID Qual Equals 06
"DATA",9002313.93,297,0)
R6^Product/Service Not Appropriate For This Location
"DATA",9002313.93,298,0)
R7^Repeating Segment Not Allowed In Same Transaction
"DATA",9002313.93,299,0)
R8^Syntax Error
"DATA",9002313.93,300,0)
R9^Value In Gross Amount Due Does Not Follow Pricing Formulae
"DATA",9002313.93,301,0)
SE^M/I Procedure Modifier Code Count
"DATA",9002313.93,302,0)
TE^Missing/Invalid Compound Product ID
"DATA",9002313.93,303,0)
UE^M/I Compound Ingredient Basis Of Cost Determination
"DATA",9002313.93,304,0)
VE^M/I Diagnosis Code Count
"DATA",9002313.93,305,0)
WE^M/I Diagnosis Code Qualifier
"DATA",9002313.93,306,0)
XE^M/I Clinical Information Counter
"DATA",9002313.93,307,0)
ZE^M/I Measurement Date
"DATA",9002313.93,308,0)
*95^The Clearinghous did not respond in time
"DATA",9002313.93,309,0)
*96^Scheduled Downtime
"DATA",9002313.93,310,0)
*97^Payor Unavailable
"DATA",9002313.93,311,0)
*98^Connection To Payer Is Down
"DATA",9002313.93,312,0)
*95^The Clearinghouse Did Not Respond In Time.
"DATA",9002313.93,313,0)
*97^Payer Unavailable
"DATA",9002313.93,314,0)
1R^Version/Release Not Supported
"DATA",9002313.93,315,0)
1S^Transaction Code/Type Not Supported
"DATA",9002313.93,316,0)
1T^PCN Must Contain Processor/Payer Assigned Value
"DATA",9002313.93,317,0)
1U^Transaction Count Does Not Match Number of Transactions
"DATA",9002313.93,318,0)
1V^Multiple Transactions Not Supported
"DATA",9002313.93,319,0)
1W^Multi-Ingredient Compound Must Be A Single Transaction
"DATA",9002313.93,320,0)
1X^Vendor Not Certified For Processor/Payer
"DATA",9002313.93,321,0)
1Y^Claim Segment Required For Adjudication
"DATA",9002313.93,322,0)
1Z^Clinical Segment Required For Adjudication
"DATA",9002313.93,323,0)
2A^M/I Medigap ID
"DATA",9002313.93,324,0)
2B^M/I Medicaid Indicator
"DATA",9002313.93,325,0)
2D^M/I Provider Accept Assignment Indicator
"DATA",9002313.93,326,0)
2G^M/I Compound Ingredient Modifier Code Count
"DATA",9002313.93,327,0)
2H^M/I Compound Ingredient Modifier Code
"DATA",9002313.93,328,0)
2J^M/I Prescriber First Name
"DATA",9002313.93,329,0)
2K^M/I Prescriber Street Address
"DATA",9002313.93,330,0)
2M^M/I Prescriber City Address
"DATA",9002313.93,331,0)
2N^M/I Prescriber State/Province Address
"DATA",9002313.93,332,0)
2P^M/I Prescriber Zip/Postal Zone
"DATA",9002313.93,333,0)
2Q^M/I Additional Documentation Type ID
"DATA",9002313.93,334,0)
2R^M/I Length of Need
"DATA",9002313.93,335,0)
2S^M/I Length of Need Qualifier
"DATA",9002313.93,336,0)
2T^M/I Prescriber/Supplier Date Signed
"DATA",9002313.93,337,0)
2U^M/I Request Status
"DATA",9002313.93,338,0)
2V^M/I Request Period Begin Date
"DATA",9002313.93,339,0)
2W^M/I Request Period Recert/Revised Date
"DATA",9002313.93,340,0)
2X^M/I Supporting Documentation
"DATA",9002313.93,341,0)
2Z^M/I Question Number/Letter Count
"DATA",9002313.93,342,0)
3Q^M/I Facility Name
"DATA",9002313.93,343,0)
3U^M/I Facility Street Address
"DATA",9002313.93,344,0)
3V^M/I Facility State/Province Address
"DATA",9002313.93,345,0)
4B^M/I Question Number/Letter
"DATA",9002313.93,346,0)
4D^M/I Question Percent Response
"DATA",9002313.93,347,0)
4G^M/I Question Date Response
"DATA",9002313.93,348,0)
4H^M/I Question Dollar Amount Response
"DATA",9002313.93,349,0)
4J^M/I Question Numeric Response
"DATA",9002313.93,350,0)
4K^M/I Question Alphanumeric Response
"DATA",9002313.93,351,0)
4M^Compound Ingredient Modifier Code Count Doesn't Match # of Repetitions
"DATA",9002313.93,352,0)
4N^Question Number/Letter Count Does Not Match Number of Repetitions
"DATA",9002313.93,353,0)
4P^Question Number/Letter Not Valid for Identified Document
"DATA",9002313.93,354,0)
4Q^Question Response Not Appropriate for Question Number/Letter
"DATA",9002313.93,355,0)
4R^Required Question Number/Letter
"DATA",9002313.93,356,0)
4S^Compound Product ID Requires a Modifier Code
"DATA",9002313.93,357,0)
4T^M/I Additional Documentation Segment
"DATA",9002313.93,358,0)
4W^Must Fill Through Specialty Pharmacy
"DATA",9002313.93,359,0)
4X^M/I Patient Residence
"DATA",9002313.93,360,0)
4Y^Patient Residence not supported by plan
"DATA",9002313.93,361,0)
4Z^Place of Service Not Support By Plan
"DATA",9002313.93,362,0)
5J^M/I Facility City Address
"DATA",9002313.93,363,0)
6D^M/I Facility Zip/Postal Zone
"DATA",9002313.93,364,0)
6G^Coordination Of Benefits/Other Payments Segment Required
"DATA",9002313.93,365,0)
6H^Coupon Segment Required For Adjudication
"DATA",9002313.93,366,0)
6J^Insurance Segment Required For Adjudication
"DATA",9002313.93,367,0)
6K^Patient Segment Required For Adjudication
"DATA",9002313.93,368,0)
6M^Pharmacy Provider Segment Required For Adjudication
"DATA",9002313.93,369,0)
6N^Prescriber Segment Required For Adjudication
"DATA",9002313.93,370,0)
6P^Pricing Segment Required For Adjudication
"DATA",9002313.93,371,0)
6Q^Prior Authorization Segment Required For Adjudication
"DATA",9002313.93,372,0)
6R^Worker's Compensation Segment Required For Adjudication
"DATA",9002313.93,373,0)
6S^Transaction Segment Required For Adjudication
"DATA",9002313.93,374,0)
6T^Compound Segment Required For Adjudication
"DATA",9002313.93,375,0)
6U^Compound Segment Incorrectly Formatted
"DATA",9002313.93,376,0)
6V^Multi-ingredient Compounds Not Supported
"DATA",9002313.93,377,0)
6W^DUR/PPS Segment Required For Adjudication
"DATA",9002313.93,378,0)
6X^DUR/PPS Segment Incorrectly Formatted
"DATA",9002313.93,379,0)
6Y^Not Authorized To Submit Electronically
"DATA",9002313.93,380,0)
6Z^Provider Not Eligible To Perform Service/Dispense Product
"DATA",9002313.93,381,0)
7A^Provider Does Not Match Authorization On File
"DATA",9002313.93,382,0)
7B^Service Provider ID Qualifier Value Not Supported For Processor/Payer
"DATA",9002313.93,383,0)
7D^Non-Matched DOB
"DATA",9002313.93,384,0)
7G^Future Date Not Allowed For DOB
"DATA",9002313.93,385,0)
7H^Non-Matched Gender Code
"DATA",9002313.93,386,0)
7J^Patient Relationship Code Not Supported
"DATA",9002313.93,387,0)
7K^Discrepancy Between Other Coverage Code And Other Payer Amt
"DATA",9002313.93,388,0)
7M^Discrepancy Between Other Coverage Code And Other Coverage Information
"DATA",9002313.93,389,0)
7N^Patient ID Qualifier Submitted Not Supported
"DATA",9002313.93,390,0)
7P^Coordination Of Benefits/Other Payments Count Exceeds Number Supported
"DATA",9002313.93,391,0)
7Q^Other Payer ID Qualifier Not Supported
"DATA",9002313.93,392,0)
7R^Other Payer Amount Paid Count Exceeds Number of Supported Groupings
"DATA",9002313.93,393,0)
7S^Other Payer Amount Paid Qualifier Not Supported
"DATA",9002313.93,394,0)
7T^Quantity Intended To Be Dispensed Required For Partial Fill
"DATA",9002313.93,395,0)
7U^Days Supply Intended To Be Dispensed Required For Partial Fill
"DATA",9002313.93,396,0)
7V^Duplicate Refills
"DATA",9002313.93,397,0)
7W^Refills Exceed allowable Refills
"DATA",9002313.93,398,0)
7X^Days Supply Exceeds Plan Limitation
"DATA",9002313.93,399,0)
7Y^Compounds Not Covered
"DATA",9002313.93,400,0)
7Z^Compound Requires Two Or More Ingredients
"DATA",9002313.93,401,0)
8A^Compound Requires At Least One Covered Ingredient
"DATA",9002313.93,402,0)
8B^Compound Segment Missing on a Compound Claim
"DATA",9002313.93,403,0)
8D^Compound Segment Present On A Non-Compound Claim
"DATA",9002313.93,404,0)
8G^Primary Product In A Compound Claim Is Not Zero
"DATA",9002313.93,405,0)
8H^Product/Service Only Covered On Compound Claim
"DATA",9002313.93,406,0)
8J^Incorrect Product/Service ID For Processor/Payer
"DATA",9002313.93,407,0)
8K^DAW Code Not Supported
"DATA",9002313.93,408,0)
8M^Sum Of Compound Ingredient Costs Does Not Equal Ingredient Cost
"DATA",9002313.93,409,0)
8N^Future Date Prescription Written Not Allowed
"DATA",9002313.93,410,0)
8P^Date Written Different On Previous Filling
"DATA",9002313.93,411,0)
8Q^Excessive Refills Authorized
"DATA",9002313.93,412,0)
8R^Submission Clarification Code Not Supported
"DATA",9002313.93,413,0)
8S^Basis Of Cost Not Supported
"DATA",9002313.93,414,0)
8T^U&C Must Be Greater Than Zero
"DATA",9002313.93,415,0)
8U^GAD Must Be Greater Than Zero
"DATA",9002313.93,416,0)
8V^Negative Dollar Amount Is Not Supported In Other Payer Amount Paid
"DATA",9002313.93,417,0)
8W^Discrepancy Between Other Coverage Code and Other Payer Amount Paid
"DATA",9002313.93,418,0)
8X^Collection From Cardholder Not Allowed
"DATA",9002313.93,419,0)
8Y^Excessive Amount Collected
"DATA",9002313.93,420,0)
8Z^Product/Service ID Qualifier Value Not Supported
"DATA",9002313.93,421,0)
9B^Reason For Service Code Value Not Supported
"DATA",9002313.93,422,0)
9C^Professional Service Code Value Not Supported
"DATA",9002313.93,423,0)
9D^Result Of Service Code Value Not Supported
"DATA",9002313.93,424,0)
9E^Quantity Does Not Match Dispensing Unit
"DATA",9002313.93,425,0)
9G^Quantity Dispensed Exceeds Maximum Allowed
"DATA",9002313.93,426,0)
9H^Quantity Not Valid For Product/Service ID Submitted
"DATA",9002313.93,427,0)
9J^Future Other Payer Date Not Allowed
"DATA",9002313.93,428,0)
9K^Compound Ingredient Component Count Exceeds Ingredients Supported
"DATA",9002313.93,429,0)
9M^Minimum Of Two Ingredients Required
"DATA",9002313.93,430,0)
9N^Compound Ingredient Quantity Exceeds Maximum Allowed
"DATA",9002313.93,431,0)
9P^Compound Ingredient Drug Cost Must Be Greater Than Zero
"DATA",9002313.93,432,0)
9Q^Route Of Administration Submitted Not Covered
"DATA",9002313.93,433,0)
9R^Prescription/Service Reference Number Qualifier Submitted Not Covered
"DATA",9002313.93,434,0)
9S^Future Associated Prescription/Service Date Not Allowed
"DATA",9002313.93,435,0)
9T^Prior Authorization Type Code Submitted Not Covered
"DATA",9002313.93,436,0)
9U^Provider ID Qualifier Submitted Not Covered
"DATA",9002313.93,437,0)
9V^Prescriber ID Qualifier Submitted Not Covered
"DATA",9002313.93,438,0)
9W^DUR/PPS Code Counter Exceeds Number Of Occurrences Supported
"DATA",9002313.93,439,0)
9X^Coupon Type Submitted Not Covered
"DATA",9002313.93,440,0)
9Y^Compound Product ID Qualifier Submitted Not Covered
"DATA",9002313.93,441,0)
9Z^Duplicate Product ID In Compound
"DATA",9002313.93,442,0)
AQ^M/I Facility Segment
"DATA",9002313.93,443,0)
A5^Not Covered Under Part D Law
"DATA",9002313.93,444,0)
A6^This Medication May Be Covered Under Part B
"DATA",9002313.93,445,0)
A7^M/I Internal Control Number
"DATA",9002313.93,446,0)
BA^Compound Basis of Cost Determination Submitted Not Covered
"DATA",9002313.93,447,0)
BB^Diagnosis Code Qualifier Submitted Not Covered
"DATA",9002313.93,448,0)
BC^Future Measurement Date Not Allowed
"DATA",9002313.93,449,0)
BD^Sender Not Authorized To Submit File Type
"DATA",9002313.93,450,0)
BF^M/I File Type
"DATA",9002313.93,451,0)
BG^Sender ID Not Certified For Processor/Payer
"DATA",9002313.93,452,0)
BH^M/I Sender ID
"DATA",9002313.93,453,0)
BJ^Transmission Type Submitted Not Supported
"DATA",9002313.93,454,0)
BK^M/I Transmission Type
"DATA",9002313.93,455,0)
BM^M/I Narrative Message
"DATA",9002313.93,456,0)
EP^M/I Associated Prescription/Service Date
"DATA",9002313.93,457,0)
G1^M/I Compound Type
"DATA",9002313.93,458,0)
G2^M/I CMS Part D Defined Qualified Facility
"DATA",9002313.93,459,0)
G4^Physician must contact plan
"DATA",9002313.93,460,0)
G5^Pharmacist must contact plan
"DATA",9002313.93,461,0)
G6^Pharmacy Not Contracted in Specialty Network
"DATA",9002313.93,462,0)
G7^Pharmacy Not Contracted in Home Infusion Network
"DATA",9002313.93,463,0)
G8^Pharmacy Not Contracted in Long Term Care Network
"DATA",9002313.93,464,0)
G9^Pharmacy Not Contracted in 9 Day Retail Network
"DATA",9002313.93,465,0)
HN^M/I Patient E-Mail Address
"DATA",9002313.93,466,0)
K5^M/I Transaction Reference Number
"DATA",9002313.93,467,0)
MG^M/I Other Payer BIN Number
"DATA",9002313.93,468,0)
MH^M/I Other Payer Processor Control Number
"DATA",9002313.93,469,0)
MJ^M/I Other Payer Group ID
"DATA",9002313.93,470,0)
MK^Non-Matched Other Payer BIN Number
"DATA",9002313.93,471,0)
MM^Non-Matched Other Payer Processor Control Number
"DATA",9002313.93,472,0)
MN^Non-Matched Other Payer Group ID
"DATA",9002313.93,473,0)
MP^Non-Matched Other Payer Cardholder ID
"DATA",9002313.93,474,0)
MR^Drug Not on Formulary
"DATA",9002313.93,475,0)
MS^More than 1 Cardholder Found - Narrow Search Criteria
"DATA",9002313.93,476,0)
MT^M/I Patient Assignment Indicator
"DATA",9002313.93,477,0)
MU^M/I Benefit Stage Count
"DATA",9002313.93,478,0)
MV^M/I Benefit Stage Qualifier
"DATA",9002313.93,479,0)
MW^M/I Benefit Stage Amount
"DATA",9002313.93,480,0)
MX^Benefit Stage Count Does Not Match Number Of Repetitions
"DATA",9002313.93,481,0)
NP^M/I Other Payer-Patient Responsibility Amount Qualifier
"DATA",9002313.93,482,0)
NQ^M/I Other Payer-Patient Responsibility Amount
"DATA",9002313.93,483,0)
NR^M/I Other Payer-Patient Responsibility Amount Count
"DATA",9002313.93,484,0)
NU^M/I Other Payer Cardholder ID
"DATA",9002313.93,485,0)
NV^M/I Delay Reason Code
"DATA",9002313.93,486,0)
NX^M/I Submission Clarification Code Count
"DATA",9002313.93,487,0)
N1^No patient match found
"DATA",9002313.93,488,0)
N3^M/I Medicaid Paid Amount
"DATA",9002313.93,489,0)
N4^M/I Medicaid Subrogation Internal Control Number
"DATA",9002313.93,490,0)
N5^M/I Medicaid ID Number
"DATA",9002313.93,491,0)
N6^M/I Medicaid Agency Number
"DATA",9002313.93,492,0)
N7^Use Prior Authorization Code Provided During Transition Period
"DATA",9002313.93,493,0)
N8^Use Prior Authorization Code Provided For Emergency Fill
"DATA",9002313.93,494,0)
N9^Use Prior Authorization Code Provided For Level of Care Change
"DATA",9002313.93,495,0)
PQ^M/I Narrative Segment
"DATA",9002313.93,496,0)
RL^Transitional Benefit/Resubmit Claim
"DATA",9002313.93,497,0)
RV^Multiple Reversals Per Transmission Not Supported
"DATA",9002313.93,498,0)
SF^Other Payer Amount Paid Count Does Not Match Number Of Repetitions
"DATA",9002313.93,499,0)
SG^Submission Clarification Code Count Doesn't Match # of Repetitions
"DATA",9002313.93,500,0)
SH^Other Payer-Patient Resp Amount Count Doesn't Match # of Repetitions
"DATA",9002313.93,501,0)
TN^Emergency Fill/Resubmit Claim
"DATA",9002313.93,502,0)
TP^Level of Care Change/Resubmit Claim
"DATA",9002313.93,503,0)
TQ^Dosage Exceeds Product Labeling Limit
"DATA",9002313.93,504,0)
TR^M/I Billing Entity Type Indicator
"DATA",9002313.93,505,0)
TS^M/I Pay To Qualifier
"DATA",9002313.93,506,0)
TT^M/I Pay To ID
"DATA",9002313.93,507,0)
TU^M/I Pay To Name
"DATA",9002313.93,508,0)
TV^M/I Pay To Street Address
"DATA",9002313.93,509,0)
TW^M/I Pay To City Address
"DATA",9002313.93,510,0)
TX^M/I Pay to State/Province Address
"DATA",9002313.93,511,0)
TY^M/I Pay To Zip/Postal Zone
"DATA",9002313.93,512,0)
TZ^M/I Generic Equivalent Product ID Qualifier
"DATA",9002313.93,513,0)
UA^M/I Generic Equivalent Product ID
"DATA",9002313.93,514,0)
UU^DAW  cannot be submitted on a multi-source drug w/available generics
"DATA",9002313.93,515,0)
UZ^Other Payer Coverage Type required on reversals to downstream payers
"DATA",9002313.93,516,0)
U7^M/I Pharmacy Service Type
"DATA",9002313.93,517,0)
VA^Pay To Qualifier Submitted Not Supported
"DATA",9002313.93,518,0)
VB^Generic Equivalent Product ID Qualifier Submitted Not Supported
"DATA",9002313.93,519,0)
VC^Pharmacy Service Type Submitted Not Supported
"DATA",9002313.93,520,0)
VD^Eligibility Search Time Frame Exceeded
"DATA",9002313.93,521,0)
ZA^The COB/Other Payments Segment is mandatory to a downstream payer
"FIA",9002313.02)
BPS CLAIMS
"FIA",9002313.02,0)
^BPSC(
"FIA",9002313.02,0,0)
9002313.02
"FIA",9002313.02,0,1)
y^y^f^^^^n
"FIA",9002313.02,0,10)

"FIA",9002313.02,0,11)

"FIA",9002313.02,0,"RLRO")

"FIA",9002313.02,0,"VR")
1.0^BPS
"FIA",9002313.02,9002313.02)
0
"FIA",9002313.02,9002313.0201)
0
"FIA",9002313.02,9002313.0401)
0
"FIA",9002313.02,9002313.0501)
0
"FIA",9002313.02,9002313.0601)
0
"FIA",9002313.02,9002313.0701)
0
"FIA",9002313.02,9002313.0801)
0
"FIA",9002313.02,9002313.0901)
0
"FIA",9002313.02,9002313.1001)
0
"FIA",9002313.02,9002313.201459)
0
"FIA",9002313.02,9002313.29999)
0
"FIA",9002313.02,9002313.401342)
0
"FIA",9002313.02,9002313.401472)
0
"FIA",9002313.03)
BPS RESPONSES
"FIA",9002313.03,0)
^BPSR(
"FIA",9002313.03,0,0)
9002313.03P
"FIA",9002313.03,0,1)
y^y^f^^^^n
"FIA",9002313.03,0,10)

"FIA",9002313.03,0,11)

"FIA",9002313.03,0,"RLRO")

"FIA",9002313.03,0,"VR")
1.0^BPS
"FIA",9002313.03,9002313.03)
0
"FIA",9002313.03,9002313.0301)
0
"FIA",9002313.03,9002313.03511)
0
"FIA",9002313.03,9002313.1101)
0
"FIA",9002313.03,9002313.1301)
0
"FIA",9002313.03,9002313.1401)
0
"FIA",9002313.03,9002313.301548)
0
"FIA",9002313.03,9002313.39999)
0
"FIA",9002313.15)
BPS ASLEEP PAYERS
"FIA",9002313.15,0)
^BPS(9002313.15,
"FIA",9002313.15,0,0)
9002313.15P
"FIA",9002313.15,0,1)
y^y^f^^^^n
"FIA",9002313.15,0,10)

"FIA",9002313.15,0,11)

"FIA",9002313.15,0,"RLRO")

"FIA",9002313.15,0,"VR")
1.0^BPS
"FIA",9002313.15,9002313.15)
0
"FIA",9002313.25)
BPS NCPDP CLARIFICATION CODES
"FIA",9002313.25,0)
^BPS(9002313.25,
"FIA",9002313.25,0,0)
9002313.25I
"FIA",9002313.25,0,1)
y^y^f^^n^^y^o^n
"FIA",9002313.25,0,10)

"FIA",9002313.25,0,11)

"FIA",9002313.25,0,"RLRO")

"FIA",9002313.25,0,"VR")
1.0^BPS
"FIA",9002313.25,9002313.25)
0
"FIA",9002313.26)
BPS NCPDP PRIOR AUTHORIZATION TYPE CODE
"FIA",9002313.26,0)
^BPS(9002313.26,
"FIA",9002313.26,0,0)
9002313.26I
"FIA",9002313.26,0,1)
y^y^f^^n^^y^o^n
"FIA",9002313.26,0,10)

"FIA",9002313.26,0,11)

"FIA",9002313.26,0,"RLRO")

"FIA",9002313.26,0,"VR")
1.0^BPS
"FIA",9002313.26,9002313.26)
0
"FIA",9002313.26,9002313.261)
0
"FIA",9002313.32)
BPS PAYER RESPONSE OVERRIDES
"FIA",9002313.32,0)
^BPS(9002313.32,
"FIA",9002313.32,0,0)
9002313.32
"FIA",9002313.32,0,1)
y^n^p^^^^n^^n
"FIA",9002313.32,0,10)

"FIA",9002313.32,0,11)

"FIA",9002313.32,0,"RLRO")

"FIA",9002313.32,0,"VR")
1.0^BPS
"FIA",9002313.32,9002313.32)
1
"FIA",9002313.32,9002313.32,.07)

"FIA",9002313.56)
BPS PHARMACIES
"FIA",9002313.56,0)
^BPS(9002313.56,
"FIA",9002313.56,0,0)
9002313.56
"FIA",9002313.56,0,1)
y^y^f^^^^n
"FIA",9002313.56,0,10)

"FIA",9002313.56,0,11)

"FIA",9002313.56,0,"RLRO")

"FIA",9002313.56,0,"VR")
1.0^BPS
"FIA",9002313.56,9002313.56)
0
"FIA",9002313.56,9002313.5601)
0
"FIA",9002313.57)
BPS LOG OF TRANSACTIONS
"FIA",9002313.57,0)
^BPSTL(
"FIA",9002313.57,0,0)
9002313.57
"FIA",9002313.57,0,1)
y^y^f^^^^n
"FIA",9002313.57,0,10)

"FIA",9002313.57,0,11)

"FIA",9002313.57,0,"RLRO")

"FIA",9002313.57,0,"VR")
1.0^BPS
"FIA",9002313.57,9002313.57)
0
"FIA",9002313.57,9002313.57111)
0
"FIA",9002313.57,9002313.5713)
0
"FIA",9002313.57,9002313.57902)
0
"FIA",9002313.59)
BPS TRANSACTION
"FIA",9002313.59,0)
^BPST(
"FIA",9002313.59,0,0)
9002313.59O
"FIA",9002313.59,0,1)
y^y^f^^^^n^^n
"FIA",9002313.59,0,10)

"FIA",9002313.59,0,11)

"FIA",9002313.59,0,"RLRO")

"FIA",9002313.59,0,"VR")
1.0^BPS
"FIA",9002313.59,9002313.59)
0
"FIA",9002313.59,9002313.59111)
0
"FIA",9002313.59,9002313.5913)
0
"FIA",9002313.59,9002313.59902)
0
"FIA",9002313.77)
BPS REQUESTS
"FIA",9002313.77,0)
^BPS(9002313.77,
"FIA",9002313.77,0,0)
9002313.77P
"FIA",9002313.77,0,1)
y^n^f^^^^n
"FIA",9002313.77,0,10)

"FIA",9002313.77,0,11)

"FIA",9002313.77,0,"RLRO")

"FIA",9002313.77,0,"VR")
1.0^BPS
"FIA",9002313.77,9002313.77)
0
"FIA",9002313.77,9002313.771)
0
"FIA",9002313.77,9002313.772)
0
"FIA",9002313.78)
BPS INSURER DATA
"FIA",9002313.78,0)
^BPS(9002313.78,
"FIA",9002313.78,0,0)
9002313.78
"FIA",9002313.78,0,1)
y^y^f^^^^n
"FIA",9002313.78,0,10)

"FIA",9002313.78,0,11)

"FIA",9002313.78,0,"RLRO")

"FIA",9002313.78,0,"VR")
1.0^BPS
"FIA",9002313.78,9002313.78)
0
"FIA",9002313.91)
BPS NCPDP FIELD DEFS
"FIA",9002313.91,0)
^BPSF(9002313.91,
"FIA",9002313.91,0,0)
9002313.91I
"FIA",9002313.91,0,1)
y^y^f^^^^n
"FIA",9002313.91,0,10)

"FIA",9002313.91,0,11)

"FIA",9002313.91,0,"RLRO")

"FIA",9002313.91,0,"VR")
1.0^BPS
"FIA",9002313.91,9002313.91)
0
"FIA",9002313.91,9002313.9101)
0
"FIA",9002313.91,9002313.9103)
0
"FIA",9002313.91,9002313.9104)
0
"FIA",9002313.92)
BPS NCPDP FORMATS
"FIA",9002313.92,0)
^BPSF(9002313.92,
"FIA",9002313.92,0,0)
9002313.92
"FIA",9002313.92,0,1)
y^y^f^^^^n
"FIA",9002313.92,0,10)

"FIA",9002313.92,0,11)

"FIA",9002313.92,0,"RLRO")

"FIA",9002313.92,0,"VR")
1.0^BPS
"FIA",9002313.92,9002313.92)
0
"FIA",9002313.92,9002313.9205)
0
"FIA",9002313.92,9002313.92051)
0
"FIA",9002313.92,9002313.92052)
0
"FIA",9002313.92,9002313.9206)
0
"FIA",9002313.92,9002313.92061)
0
"FIA",9002313.92,9002313.92062)
0
"FIA",9002313.92,9002313.9207)
0
"FIA",9002313.92,9002313.92071)
0
"FIA",9002313.92,9002313.92072)
0
"FIA",9002313.92,9002313.9208)
0
"FIA",9002313.92,9002313.92081)
0
"FIA",9002313.92,9002313.92082)
0
"FIA",9002313.92,9002313.9209)
0
"FIA",9002313.92,9002313.92091)
0
"FIA",9002313.92,9002313.92092)
0
"FIA",9002313.92,9002313.921)
0
"FIA",9002313.92,9002313.9211)
0
"FIA",9002313.92,9002313.9212)
0
"FIA",9002313.92,9002313.9213)
0
"FIA",9002313.92,9002313.92131)
0
"FIA",9002313.92,9002313.92132)
0
"FIA",9002313.92,9002313.9214)
0
"FIA",9002313.92,9002313.92141)
0
"FIA",9002313.92,9002313.92142)
0
"FIA",9002313.92,9002313.9215)
0
"FIA",9002313.92,9002313.92151)
0
"FIA",9002313.92,9002313.92152)
0
"FIA",9002313.92,9002313.9216)
0
"FIA",9002313.92,9002313.92161)
0
"FIA",9002313.92,9002313.92162)
0
"FIA",9002313.92,9002313.9217)
0
"FIA",9002313.92,9002313.92171)
0
"FIA",9002313.92,9002313.92172)
0
"FIA",9002313.92,9002313.9218)
0
"FIA",9002313.92,9002313.92181)
0
"FIA",9002313.92,9002313.92182)
0
"FIA",9002313.92,9002313.9219)
0
"FIA",9002313.92,9002313.921901)
0
"FIA",9002313.92,9002313.92191)
0
"FIA",9002313.92,9002313.92192)
0
"FIA",9002313.92,9002313.922)
0
"FIA",9002313.92,9002313.9221)
0
"FIA",9002313.92,9002313.9222)
0
"FIA",9002313.93)
BPS NCPDP REJECT CODES
"FIA",9002313.93,0)
^BPSF(9002313.93,
"FIA",9002313.93,0,0)
9002313.93I
"FIA",9002313.93,0,1)
y^y^f^^n^^y^r^n
"FIA",9002313.93,0,10)

"FIA",9002313.93,0,11)

"FIA",9002313.93,0,"RLRO")

"FIA",9002313.93,0,"VR")
1.0^BPS
"FIA",9002313.93,9002313.93)
0
"FIA",9002313.99)
BPS SETUP
"FIA",9002313.99,0)
^BPS(9002313.99,
"FIA",9002313.99,0,0)
9002313.99
"FIA",9002313.99,0,1)
y^y^f^^^^n
"FIA",9002313.99,0,10)

"FIA",9002313.99,0,11)

"FIA",9002313.99,0,"RLRO")

"FIA",9002313.99,0,"VR")
1.0^BPS
"FIA",9002313.99,9002313.99)
0
"INI")
PRE^BPS10P7
"INIT")
POST^BPS10P7
"IX",9002313.77,9002313.77,"AC",0)
9002313.77^AC^By the Process Flag^MU^^R^IR^I^9002313.77^^^^^S
"IX",9002313.77,9002313.77,"AC",.1,0)
^^1^1^3080620^
"IX",9002313.77,9002313.77,"AC",.1,1,0)
This index is used to retrieve entries with certain PROCESS FLAG value.
"IX",9002313.77,9002313.77,"AC",1)
S ^BPS(9002313.77,"AC",$E(X(1),1,30),$E(X(2),1,30),+$E(X(3),1,30),DA)=X(4)
"IX",9002313.77,9002313.77,"AC",2)
K ^BPS(9002313.77,"AC",$E(X(1),1,30),$E(X(2),1,30),+$E(X(3),1,30),DA)
"IX",9002313.77,9002313.77,"AC",2.5)
K ^BPS(9002313.77,"AC")
"IX",9002313.77,9002313.77,"AC",11.1,0)
^.114IA^4^4
"IX",9002313.77,9002313.77,"AC",11.1,1,0)
1^F^9002313.77^.04^2^1^F
"IX",9002313.77,9002313.77,"AC",11.1,2,0)
2^F^9002313.77^.01^10^2^F
"IX",9002313.77,9002313.77,"AC",11.1,3,0)
3^F^9002313.77^.02^3^3^F
"IX",9002313.77,9002313.77,"AC",11.1,4,0)
4^F^9002313.77^.03^^^F
"IX",9002313.77,9002313.77,"AN",0)
9002313.77^AN^The Next Request^MU^^R^IR^I^9002313.77^^^^^S
"IX",9002313.77,9002313.77,"AN",.1,0)
^^2^2^3080620^
"IX",9002313.77,9002313.77,"AN",.1,1,0)
This index is used to determine the Next Request that needs to be
"IX",9002313.77,9002313.77,"AN",.1,2,0)
processed after the current is completed.
"IX",9002313.77,9002313.77,"AN",1)
I X(3)<3 S ^BPS(9002313.77,"AN",DA,$E(X(2),1,30))=X(3)_"^"_X(4)_"^"_X(5)
"IX",9002313.77,9002313.77,"AN",2)
K ^BPS(9002313.77,"AN",DA,$E(X(2),1,30))
"IX",9002313.77,9002313.77,"AN",2.5)
K ^BPS(9002313.77,"AN")
"IX",9002313.77,9002313.77,"AN",11.1,0)
^.114IA^5^5
"IX",9002313.77,9002313.77,"AN",11.1,1,0)
1^C^^^^1
"IX",9002313.77,9002313.77,"AN",11.1,1,1.5)
S X=DA
"IX",9002313.77,9002313.77,"AN",11.1,2,0)
2^F^9002313.77^.05^30^2^F
"IX",9002313.77,9002313.77,"AN",11.1,3,0)
3^F^9002313.77^.04^2^^F
"IX",9002313.77,9002313.77,"AN",11.1,4,0)
4^F^9002313.77^1.04^2^^F
"IX",9002313.77,9002313.77,"AN",11.1,5,0)
5^F^9002313.77^.03^2^^F
"IX",9002313.77,9002313.77,"D",0)
9002313.77^D^By Prescription #, Refill#, COB and Process Flag^R^^R^IR^I^9002313.77^^^^^LS
"IX",9002313.77,9002313.77,"D",.1,0)
^^3^3^3080620^
"IX",9002313.77,9002313.77,"D",.1,1,0)
This index is used to retrieve all requests by the Prescription #, the 
"IX",9002313.77,9002313.77,"D",.1,2,0)
refill #, the type of the insurer (Primary/Secondary/Tertiary) and by the 
"IX",9002313.77,9002313.77,"D",.1,3,0)
PROCESS FLAG value (request status).
"IX",9002313.77,9002313.77,"D",1)
S ^BPS(9002313.77,"D",X(1),X(2),X(3),X(4),DA)=""
"IX",9002313.77,9002313.77,"D",2)
K ^BPS(9002313.77,"D",X(1),X(2),X(3),X(4),DA)
"IX",9002313.77,9002313.77,"D",2.5)
K ^BPS(9002313.77,"D")
"IX",9002313.77,9002313.77,"D",11.1,0)
^.114IA^4^4
"IX",9002313.77,9002313.77,"D",11.1,1,0)
1^F^9002313.77^.01^^1^F
"IX",9002313.77,9002313.77,"D",11.1,2,0)
2^F^9002313.77^.02^^2^F
"IX",9002313.77,9002313.77,"D",11.1,3,0)
3^F^9002313.77^.03^^3^F
"IX",9002313.77,9002313.77,"D",11.1,4,0)
4^F^9002313.77^.04^^4^F
"KRN",.401,449569,-1)
1^1
"KRN",.401,449569,0)
BPS TECH - FILES    FILE #1
"KRN",.401,449570,-1)
1^2
"KRN",.401,449570,0)
BPS TECH - OPTIONS    FILE #19
"KRN",.402,2709,-1)
0^3
"KRN",.402,2709,0)
BPSJ SITE SETUP^3080305.1635^@^9002313.99^^@^3090311
"KRN",.402,2709,"DIAB",3,0,9002313.99,0)
SITE CONTACT:
"KRN",.402,2709,"DIAB",3,0,9002313.99,1)
ALTERNATE SITE CONTACT:
"KRN",.402,2709,"DR",1,9002313.99)
W !!!," -- PRIMARY SITE CONTACT DATA --",!;6000;^200^VA(200,^^S I(0,0)=D0 S Y(1)=$S($D(^BPS(9002313.99,D0,"VITRIA")):^("VITRIA"),1:"") S X=$P(Y(1),U,1),X=X S D(0)=+X S X=$S(D(0)>0:D(0),1:"");S:$O(Y(99)) Y=0,BPSOUT=1;
"KRN",.402,2709,"DR",1,9002313.99,1)
W !!!," -- ALTERNATE SITE CONTACT DATA --",!;6001;^200^VA(200,^^S I(0,0)=D0 S Y(1)=$S($D(^BPS(9002313.99,D0,"VITRIA")):^("VITRIA"),1:"") S X=$P(Y(1),U,2),X=X S D(0)=+X S X=$S(D(0)>0:D(0),1:"");S:$O(Y(99)) BPSOUT=1;
"KRN",.402,2709,"DR",2,200)
.132;.151;
"KRN",.402,2710,-1)
0^8
"KRN",.402,2710,0)
BPSJ PHARMACY ENTER/EDIT^3080305.164^@^9002313.56^^@^3090126
"KRN",.402,2710,"DIAB",1,0,9002313.56,1)
VA CONTACT:
"KRN",.402,2710,"DIAB",1,0,9002313.56,2)
VA ALTERNATE CONTACT:
"KRN",.402,2710,"DIAB",1,0,9002313.56,3)
VA LEAD PHARMACIST:
"KRN",.402,2710,"DR",1,9002313.56)
W !!," --SITE DATA",!;.1;.02;.03;120.03;120.01;120.02;102.03;120.04;120.05;130.01;130.02;130.03;130.6;130.07;130.08;W !!," --PRIMARY CONTACT DATA",!;1900.01;
"KRN",.402,2710,"DR",1,9002313.56,1)
^200^VA(200,^^S I(0,0)=D0 S Y(1)=$S($D(^BPS(9002313.56,D0,"REP")):^("REP"),1:"") S X=$P(Y(1),U,3),X=X S D(0)=+X S X=$S(D(0)>0:D(0),1:"");S:$O(Y(99)) Y=0,BPSOUT=1;W !!," --ALTERNATE CONTACT DATA",!;1900.02;
"KRN",.402,2710,"DR",1,9002313.56,2)
^200^VA(200,^^S I(0,0)=D0 S Y(1)=$S($D(^BPS(9002313.56,D0,"REP")):^("REP"),1:"") S X=$P(Y(1),U,4),X=X S D(0)=+X S X=$S(D(0)>0:D(0),1:"");S:$O(Y(99)) Y=0,BPSOUT=1;W !!," --PHARMACIST DATA",!;1900.03;
"KRN",.402,2710,"DR",1,9002313.56,3)
^200^VA(200,^^S I(0,0)=D0 S Y(1)=$S($D(^BPS(9002313.56,D0,"REP")):^("REP"),1:"") S X=$P(Y(1),U,5),X=X S D(0)=+X S X=$S(D(0)>0:D(0),1:"");S:$O(Y(99)) Y=0,BPSOUT=1;1900.04;
"KRN",.402,2710,"DR",2,200)
.132;.151;8;
"KRN",.402,2718,-1)
1^1
"KRN",.402,2718,0)
BPSJ ALT CONTACT ENTER/EDIT    FILE #9002313.99
"KRN",.402,2719,-1)
1^2
"KRN",.402,2719,0)
BPSJ CONTACT ENTER/EDIT    FILE #9002313.99
"KRN",.402,2720,-1)
1^4
"KRN",.402,2720,0)
BPSJ PHARMACY SITE ENTER/EDIT    FILE #9002313.56
"KRN",.402,2721,-1)
1^5
"KRN",.402,2721,0)
BPSJ PHARM CONTACT ENTER/EDIT    FILE #9002313.56
"KRN",.402,2722,-1)
1^6
"KRN",.402,2722,0)
BPSJ PHARM ALT CONT ENTER/EDIT    FILE #9002313.56
"KRN",.402,2723,-1)
1^7
"KRN",.402,2723,0)
BPSJ PHARMACIST ENTER/EDIT    FILE #9002313.56
"KRN",19,2919763,-1)
0^1
"KRN",19,2919763,0)
BPS SETUP REGISTER PHARMACY^Register Pharmacy with Austin Automation Center^^R^^BPS MASTER^^^^^y^
"KRN",19,2919763,1,0)
^^2^2^3060602^
"KRN",19,2919763,1,1,0)
Registers the VistA site and valid BPS Pharmacy with the Austin
"KRN",19,2919763,1,2,0)
Automation Center (AAC)
"KRN",19,2919763,25)
BPSJINIT
"KRN",19,2919763,99.1)
59647,50769
"KRN",19,2919763,"U")
REGISTER PHARMACY WITH AUSTIN 
"KRN",19,2920233,-1)
2^2
"KRN",19,2920233,0)
BPS MENU MAINTENANCE^ECME transaction maintenance options^^M^520665213^BPS MANAGER^^^^^^^^^^^1
"KRN",19,2920233,10,0)
^19.01IP^3^3
"KRN",19,2920233,10,3,0)
2920681^NON^3
"KRN",19,2920233,10,3,"^")
IB DRUGS NON COVERED REPORT
"KRN",19,2920233,"U")
ECME TRANSACTION MAINTENANCE O
"KRN",19,2920681,-1)
0^3
"KRN",19,2920681,0)
IB DRUGS NON COVERED REPORT^Drugs non covered report^^R^^^^^^^^
"KRN",19,2920681,1,0)
^^1^1^3080312^
"KRN",19,2920681,1,1,0)
This option will print non covered drugs, plans and dates.
"KRN",19,2920681,25)
RPT^IBNCDNC
"KRN",19,2920681,"U")
DRUGS NON COVERED REPORT
"KRN",101,7085,-1)
0^9
"KRN",101,7085,0)
BPS PRTCL ECME USRSCR^ECME User Options^^M^^^^^^^^
"KRN",101,7085,4)
26^4
"KRN",101,7085,10,0)
^101.01PA^14^14
"KRN",101,7085,10,2,0)
7086^REV^5^
"KRN",101,7085,10,2,"^")
BPS PRTCL USRSCR REVERSE
"KRN",101,7085,10,3,0)
7087^CU^1^
"KRN",101,7085,10,3,"^")
BPS PRTCL USRSCR CONTINUOUS
"KRN",101,7085,10,4,0)
7088^RES^6^
"KRN",101,7085,10,4,"^")
BPS PRTCL USRSCR RESUBMIT
"KRN",101,7085,10,5,0)
7089^UD^2^
"KRN",101,7085,10,5,"^")
BPS PRTCL USRSCR UPDATE
"KRN",101,7085,10,6,0)
7090^SO^4^
"KRN",101,7085,10,6,"^")
BPS PRTCL USRSCR SORTLIST
"KRN",101,7085,10,7,0)
7091^CMT^8^
"KRN",101,7085,10,7,"^")
BPS PRTCL USRSCR COMMENT
"KRN",101,7085,10,8,0)
7092^FR^9^
"KRN",101,7085,10,8,"^")
BPS PRTCL USRSCR RESEARCH MENU
"KRN",101,7085,10,10,0)
7094^LOG^11^
"KRN",101,7085,10,10,"^")
BPS PRTCL USRSCR CLAIM LOG
"KRN",101,7085,10,11,0)
7095^CLO^7^
"KRN",101,7085,10,11,"^")
BPS PRTCL USRSCR CLOSE
"KRN",101,7085,10,12,0)
7105^CV^3^
"KRN",101,7085,10,12,"^")
BPS PRTCL USRSCR CHANGE VIEW
"KRN",101,7085,10,13,0)
7107^EX^14^
"KRN",101,7085,10,13,"^")
BPS PRTCL USRSCR EXIT
"KRN",101,7085,10,14,0)
7338^WRK^12^
"KRN",101,7085,10,14,"^")
BPS PRTCL USRSCR PHARM WRKLST
"KRN",101,7085,26)
DO SHOW^VALM
"KRN",101,7085,28)
Select Action: 
"KRN",101,7085,99)
61468,47260
"KRN",101,7086,-1)
0^13
"KRN",101,7086,0)
BPS PRTCL USRSCR REVERSE^Reverse Payable Claim^^A^^^^^^^^
"KRN",101,7086,20)
D REV^BPSSCRRV
"KRN",101,7086,99)
61468,47260
"KRN",101,7087,-1)
0^14
"KRN",101,7087,0)
BPS PRTCL USRSCR CONTINUOUS^Continuous Update^^A^^^^^^^^
"KRN",101,7087,20)
D CU^BPSSCRCU
"KRN",101,7087,99)
61468,47260
"KRN",101,7088,-1)
0^15
"KRN",101,7088,0)
BPS PRTCL USRSCR RESUBMIT^Resubmit Claim^^A^^^^^^^^
"KRN",101,7088,20)
D RES^BPSSCRRS
"KRN",101,7088,99)
61468,47260
"KRN",101,7089,-1)
0^16
"KRN",101,7089,0)
BPS PRTCL USRSCR UPDATE^Display Update^^A^^^^^^^^
"KRN",101,7089,20)
D UD^BPSSCRUD
"KRN",101,7089,99)
61468,47260
"KRN",101,7090,-1)
0^17
"KRN",101,7090,0)
BPS PRTCL USRSCR SORTLIST^Sort List^^A^^^^^^^^
"KRN",101,7090,20)
D SL^BPSSCRSL
"KRN",101,7090,99)
61468,47260
"KRN",101,7091,-1)
0^18
"KRN",101,7091,0)
BPS PRTCL USRSCR COMMENT^Add/View Comments^^A^^^^^^^^
"KRN",101,7091,20)
D CMT^BPSCMT
"KRN",101,7091,99)
61468,47260
"KRN",101,7092,-1)
0^19
"KRN",101,7092,0)
BPS PRTCL USRSCR RESEARCH MENU^Further Research^^A^^^^^^^^
"KRN",101,7092,20)
D RM^BPSRSM
"KRN",101,7092,99)
61468,47260
"KRN",101,7094,-1)
0^20
"KRN",101,7094,0)
BPS PRTCL USRSCR CLAIM LOG^Print Claim Log^^A^^^^^^^^
"KRN",101,7094,20)
D LOG^BPSSCRLG
"KRN",101,7094,99)
61468,47260
"KRN",101,7095,-1)
0^2
"KRN",101,7095,0)
BPS PRTCL USRSCR CLOSE^Close Claim^^A^^^^^^^^
"KRN",101,7095,20)
D CLO^BPSSCRCL
"KRN",101,7095,99)
61468,47260
"KRN",101,7096,-1)
2^12
"KRN",101,7096,0)
BPS PRTCL RSCH MENU^Research Menu^^M^520665238^^^^^^^
"KRN",101,7096,10,0)
^101.01PA^11^11
"KRN",101,7096,10,7,0)
7103^OH^30^
"KRN",101,7096,10,7,"^")
BPS PRTCL RSCH ON HOLD COPAY
"KRN",101,7096,10,10,0)
7091^CMT^10^
"KRN",101,7096,10,10,"^")
BPS PRTCL USRSCR COMMENT
"KRN",101,7096,10,11,0)
7334^GRPL^40^
"KRN",101,7096,10,11,"^")
BPS PRTCL RSCH GRPL
"KRN",101,7103,-1)
0^3
"KRN",101,7103,0)
BPS PRTCL RSCH ON HOLD COPAY^On Hold Copay List^^A^^^^^^^^
"KRN",101,7103,20)
D OH^BPSRSHLD
"KRN",101,7103,99)
61468,47260
"KRN",101,7105,-1)
0^21
"KRN",101,7105,0)
BPS PRTCL USRSCR CHANGE VIEW^Change View^^A^^^^^^^^
"KRN",101,7105,20)
D CV^BPSSCRCV
"KRN",101,7105,99)
61468,47260
"KRN",101,7107,-1)
0^10
"KRN",101,7107,0)
BPS PRTCL USRSCR EXIT^Exit^^A^^^^^^^^
"KRN",101,7107,20)

"KRN",101,7107,99)
61468,47260
"KRN",101,7111,-1)
2^11
"KRN",101,7111,0)
BPS PRTCL USRSCR HIDDEN ACTIONS^ECME User Screen Hidden Actions^^M^520665238^^^^^^^
"KRN",101,7111,10,0)
^101.01PA^29^29
"KRN",101,7111,10,29,0)
7333^ROC^35^
"KRN",101,7111,10,29,"^")
BPS PRTCL USRSCR REOPEN CLOSED CLAIMS
"KRN",101,7333,-1)
0^1
"KRN",101,7333,0)
BPS PRTCL USRSCR REOPEN CLOSED CLAIMS^Reopen Closed Claims^^A^^^^^^^^
"KRN",101,7333,3,0)
^101.03P^^0
"KRN",101,7333,4)
^^^ROC
"KRN",101,7333,20)
D EUSCREOP^BPSREOP1
"KRN",101,7333,99)
61468,47260
"KRN",101,7334,-1)
0^4
"KRN",101,7334,0)
BPS PRTCL RSCH GRPL^Group Plan Menu^^M^^^^^^^^
"KRN",101,7334,10,0)
^101.01PA^3^3
"KRN",101,7334,10,1,0)
7335^EPLA^1^
"KRN",101,7334,10,1,"^")
BPS PRTCL IBCNR EDIT PLAN
"KRN",101,7334,10,2,0)
7336^MGP^2^
"KRN",101,7334,10,2,"^")
BPS PRTCL IBCNR PLAN MATCH
"KRN",101,7334,10,3,0)
7337^MMGP^3^
"KRN",101,7334,10,3,"^")
BPS PRTCL IBCNR GROUP PLAN MATCH
"KRN",101,7334,15)
S VALMBCK="R"
"KRN",101,7334,20)
D FULL^VALM1
"KRN",101,7334,99)
61468,47260
"KRN",101,7335,-1)
0^5
"KRN",101,7335,0)
BPS PRTCL IBCNR EDIT PLAN^Edit PLAN APPLICATION Sub-file^^A^^IBCNR E-PHARMACY SUPERVISOR^^^^^^
"KRN",101,7335,1,0)
^101.06^2^2^3080722^^
"KRN",101,7335,1,1,0)
This option allows the user to edit the PLAN APPLICATION sub-file
"KRN",101,7335,1,2,0)
(#366.033).  Specific to e-Pharmacy.
"KRN",101,7335,2,0)
^101.02A^^0
"KRN",101,7335,4)
^^^EPLA
"KRN",101,7335,15)
S VALMBCK="R"
"KRN",101,7335,20)
D ^IBCNRE4
"KRN",101,7335,99)
61468,47260
"KRN",101,7336,-1)
0^6
"KRN",101,7336,0)
BPS PRTCL IBCNR PLAN MATCH^Match Group Plan to a Pharmacy Plan^^A^^IBCNR E-PHARMACY SUPERVISOR^^^^^^
"KRN",101,7336,1,0)
^^2^2^3071212^
"KRN",101,7336,1,1,0)
This option allows a user to match a GROUP INSURANCE PLAN file (#355.3)
"KRN",101,7336,1,2,0)
record to a PHARMACY PLAN file (#366.03) record.
"KRN",101,7336,4)
^^^MGP
"KRN",101,7336,15)
S VALMBCK="R"
"KRN",101,7336,20)
D EN^IBCNRPMT
"KRN",101,7336,99)
61468,47260
"KRN",101,7337,-1)
0^7
"KRN",101,7337,0)
BPS PRTCL IBCNR GROUP PLAN MATCH^Match Multiple Group Plans to a Pharmacy Plan^^A^^IBCNR E-PHARMACY SUPERVISOR^^^^^^
"KRN",101,7337,1,0)
^^2^2^3071212^
"KRN",101,7337,1,1,0)
This option allows a user to match multiple GROUP INSURANCE PLAN file
"KRN",101,7337,1,2,0)
(#355.3) records to a PHARMACY PLAN file (#366.03) record.  
"KRN",101,7337,4)
^^^MMGP
"KRN",101,7337,15)
S VALMBCK="R"
"KRN",101,7337,20)
D EN^IBCNRPM1
"KRN",101,7337,99)
61468,47260
"KRN",101,7338,-1)
0^8
"KRN",101,7338,0)
BPS PRTCL USRSCR PHARM WRKLST^Send to Worklist^^A^^^^^^^^E CLAIMS MGMT ENGINE
"KRN",101,7338,20)
D EN^BPSWRKLS
"KRN",101,7338,99)
61468,47260
"MBREQ")
1
"ORD",0,9.8)
9.8;;1;RTNF^XPDTA;RTNE^XPDTA
"ORD",0,9.8,0)
ROUTINE
"ORD",6,.401)
.401;6;;;EDEOUT^DIFROMSO(.401,DA,"",XPDA);FPRE^DIFROMSI(.401,"",XPDA);EPRE^DIFROMSI(.401,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.401,DA,"",XPDA);DEL^DIFROMSK(.401,"",%)
"ORD",6,.401,0)
SORT TEMPLATE
"ORD",7,.402)
.402;7;;;EDEOUT^DIFROMSO(.402,DA,"",XPDA);FPRE^DIFROMSI(.402,"",XPDA);EPRE^DIFROMSI(.402,DA,$E("N",$G(XPDNEW)),XPDA,"",OLDA);;EPOST^DIFROMSI(.402,DA,"",XPDA);DEL^DIFROMSK(.402,"",%)
"ORD",7,.402,0)
INPUT TEMPLATE
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",632,-1)
1^1
"PKG",632,0)
E CLAIMS MGMT ENGINE^BPS^ELECTRONIC CLAIMS MGT
"PKG",632,22,0)
^9.49I^1^1
"PKG",632,22,1,0)
1.0^3041008^3041130^568
"PKG",632,22,1,"PAH",1,0)
7^3090615^520665238
"PKG",632,22,1,"PAH",1,1,0)
^^1^1^3090615
"PKG",632,22,1,"PAH",1,1,1,0)
E-PHARMACY ENHANCEMENTS
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
88
"RTN","BPS01P2")
1^45
"RTN","BPS01P5")
1^59
"RTN","BPS01P5A")
1^60
"RTN","BPS01P5B")
1^61
"RTN","BPS01P5C")
1^62
"RTN","BPS10P7")
0^30^B26269995
"RTN","BPS10P7",1,0)
BPS10P7 ;OAK/ELZ - BPS*1*7 PRE/POST INSTALL ROUTINE ;6/9/08  11:02
"RTN","BPS10P7",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**7**;JUN 2004;Build 46
"RTN","BPS10P7",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPS10P7",4,0)
 ;
"RTN","BPS10P7",5,0)
PRE ; pre-install of BPS*1*7
"RTN","BPS10P7",6,0)
 ;
"RTN","BPS10P7",7,0)
 ; delete the following files (leaving the data), the actual
"RTN","BPS10P7",8,0)
 ; install of BPS*1*7 will re-install the updated files.
"RTN","BPS10P7",9,0)
 ;          9002313.91 -- BPS NCPDP FIELD DEFS
"RTN","BPS10P7",10,0)
 ;          9002313.92 -- BPS NCPDP FORMATS
"RTN","BPS10P7",11,0)
 ;          9002313.93 -- BPS NCPDP REJECT CODES ** REMOVE DATA **
"RTN","BPS10P7",12,0)
 ;          9002313.59 -- BPS TRANSACTION
"RTN","BPS10P7",13,0)
 ;          9002313.02 -- BPS CLAIMS
"RTN","BPS10P7",14,0)
 ;          9002313.03 -- BPS RESPONSES
"RTN","BPS10P7",15,0)
 ;          9002313.56 -- BPS PHARMACIES
"RTN","BPS10P7",16,0)
 ;          9002313.57 -- BPS LOG OF TRANSACTIONS
"RTN","BPS10P7",17,0)
 ;          9002313.77 -- BPS REQUESTS
"RTN","BPS10P7",18,0)
 ;          9002313.78 -- BPS INSURER DATA
"RTN","BPS10P7",19,0)
 ;          9002313.99 -- BPS SETUP
"RTN","BPS10P7",20,0)
 ;
"RTN","BPS10P7",21,0)
 ; DBIA2172,DBIA10141,DBIA10014
"RTN","BPS10P7",22,0)
 ;
"RTN","BPS10P7",23,0)
 N BPSX,DIU,XPDIDTOT,BPSC,BPSP
"RTN","BPS10P7",24,0)
 D MES^XPDUTL("  Starting pre-install of BPS*1*7")
"RTN","BPS10P7",25,0)
 S XPDIDTOT=11,BPSC=0
"RTN","BPS10P7",26,0)
 D MES^XPDUTL("  - Deleting files to be restored during install.")
"RTN","BPS10P7",27,0)
 F BPSX=9002313.91,9002313.92,9002313.93,9002313.59,9002313.02,9002313.03,9002313.56,9002313.57,9002313.77,9002313.78,9002313.99 D
"RTN","BPS10P7",28,0)
 . S BPSP=$G(DILOCKTM,3)
"RTN","BPS10P7",29,0)
 . D MES^XPDUTL("    - Deleting file #"_BPSX_", Waiting for hardware "_BPSP_" seconds...")
"RTN","BPS10P7",30,0)
 . S DIU=BPSX
"RTN","BPS10P7",31,0)
 . S DIU(0)=$S(BPSX=9002313.93:"DE",1:"E")
"RTN","BPS10P7",32,0)
 . D EN^DIU2
"RTN","BPS10P7",33,0)
 . S BPSC=BPSC+1
"RTN","BPS10P7",34,0)
 . D UPDATE^XPDID(BPSC)
"RTN","BPS10P7",35,0)
 . H BPSP  ; need to pause so we don't hit the globals too hard
"RTN","BPS10P7",36,0)
 D MES^XPDUTL("  Finished pre-install of BPS*1*7")
"RTN","BPS10P7",37,0)
 Q
"RTN","BPS10P7",38,0)
 ;
"RTN","BPS10P7",39,0)
POST ; post install for BPS*1*7
"RTN","BPS10P7",40,0)
 ;   - need to build the new AD cross reference on Status
"RTN","BPS10P7",41,0)
 ;     of the BPS LOG OF TRANSACTIONS so it matches the
"RTN","BPS10P7",42,0)
 ;     BPS TRANSACTION file.
"RTN","BPS10P7",43,0)
 ;
"RTN","BPS10P7",44,0)
 ; DBIA2172,DBIA10141
"RTN","BPS10P7",45,0)
 ;
"RTN","BPS10P7",46,0)
 N BPSX,BPSY,BPSC,XPDIDTOT,ZTRTN,ZTDESC,ZTDTH,ZTIO,ZTSK,BPSTIME,DIU,BPSP
"RTN","BPS10P7",47,0)
 D MES^XPDUTL("  Starting post-install of BPS*1*7")
"RTN","BPS10P7",48,0)
 D MES^XPDUTL("  - Building AD xref on BPS LOG OF TRANSACTIONS file")
"RTN","BPS10P7",49,0)
 S XPDIDTOT=$P($G(^BPST(0)),"^",4)
"RTN","BPS10P7",50,0)
 S (BPSC,BPSX)=0
"RTN","BPS10P7",51,0)
 F  S BPSX=$O(^BPST(BPSX)) Q:'BPSX  S BPSC=BPSC+1,BPSY=$P($G(^BPST(BPSX,0)),"^",2) D:'(BPSC#500) UPDATE^XPDID(BPSC) I $L(BPSY) S ^BPST("AD",$E(BPSY,1,30),BPSX)=""
"RTN","BPS10P7",52,0)
 ;
"RTN","BPS10P7",53,0)
 ; need to clean up old fields from BPS Pharmacies 9002313.56
"RTN","BPS10P7",54,0)
 D MES^XPDUTL("  - Cleaning out old data from BPS PHARMACIES")
"RTN","BPS10P7",55,0)
 S BPSX=0 F  S BPSX=$O(^BPS(9002313.56,BPSX)) Q:'BPSX  K ^BPS(9002313.56,BPSX,"HOURS"),^("TCLOSE"),^("TOPEN")
"RTN","BPS10P7",56,0)
 D MES^XPDUTL("  - Done cleaning out old data from BPS PHARMACIES")
"RTN","BPS10P7",57,0)
 ;
"RTN","BPS10P7",58,0)
 ; Clean up the old field being removed with tasked job 9002313.0301,508Sales Tax Paid
"RTN","BPS10P7",59,0)
 D MES^XPDUTL("  - Queing task to clean up old data")
"RTN","BPS10P7",60,0)
 S ZTRTN="DQ^BPS10P7",ZTDESC="Post Install BPS*1*7, Clean-up of Data"
"RTN","BPS10P7",61,0)
 S (BPSTIME,ZTDTH)=$$FMADD^XLFDT($$NOW^XLFDT,,,5),ZTIO=""
"RTN","BPS10P7",62,0)
 D ^%ZTLOAD
"RTN","BPS10P7",63,0)
 I $G(ZTSK) D
"RTN","BPS10P7",64,0)
 . D MES^XPDUTL("  - Task Queued, #"_ZTSK_" to run at "_$$FMTE^XLFDT(BPSTIME))
"RTN","BPS10P7",65,0)
 E  D MES^XPDUTL("  - ERROR:  Task not queued!!!")
"RTN","BPS10P7",66,0)
 ;
"RTN","BPS10P7",67,0)
 ; populate new fields in setup file
"RTN","BPS10P7",68,0)
 D MES^XPDUTL("   - Setting up New Insurer Asleep fields in site param file")
"RTN","BPS10P7",69,0)
 S:$P($G(^BPS(9002313.99,1,0)),"^",5)="" $P(^(0),"^",5)=20
"RTN","BPS10P7",70,0)
 S:$P($G(^BPS(9002313.99,1,0)),"^",6)="" $P(^(0),"^",6)=10
"RTN","BPS10P7",71,0)
 D MES^XPDUTL("   - New Insurer Asleep fields set")
"RTN","BPS10P7",72,0)
 ;
"RTN","BPS10P7",73,0)
 ; delete the following obsolete files leaving no data
"RTN","BPS10P7",74,0)
 ;         9002313.82103 BPS NCPDP FIELD 103
"RTN","BPS10P7",75,0)
 ;         9002313.82305 BPS NCPDP FIELD 305
"RTN","BPS10P7",76,0)
 ;         9002313.82306 BPS NCPDP FIELD 306
"RTN","BPS10P7",77,0)
 ;         9002313.82307 BPS NCPDP FIELD 307
"RTN","BPS10P7",78,0)
 ;         9002313.82308 BPS NCPDP FIELD 308
"RTN","BPS10P7",79,0)
 ;         9002313.82309 BPS NCPDP FIELD 309
"RTN","BPS10P7",80,0)
 ;         9002313.82406 BPS NCPDP FIELD 406
"RTN","BPS10P7",81,0)
 ;         9002313.82408 BPS NCPDP FIELD 408
"RTN","BPS10P7",82,0)
 ;         9002313.82416 BPS NCPDP FIELD 416
"RTN","BPS10P7",83,0)
 ;         9002313.82419 BPS NCPDP FIELD 419
"RTN","BPS10P7",84,0)
 ;         9002313.8242  BPS NCPDP FIELD 420
"RTN","BPS10P7",85,0)
 ;         9002313.82423 BPS NCPDP FIELD 423
"RTN","BPS10P7",86,0)
 ;         9002313.82425 BPS NCPDP FIELD 425
"RTN","BPS10P7",87,0)
 ;         9002313.82429 BPS NCPDP FIELD 429
"RTN","BPS10P7",88,0)
 ;         9002313.82432 BPS NCPDP FIELD 432
"RTN","BPS10P7",89,0)
 ;         9002313.82436 BPS NCPDP FIELD 436
"RTN","BPS10P7",90,0)
 ;         9002313.82439 BPS NCPDP FIELD 439
"RTN","BPS10P7",91,0)
 ;         9002313.8244  BPS NCPDP FIELD 440
"RTN","BPS10P7",92,0)
 ;         9002313.82441 BPS NCPDP FIELD 441
"RTN","BPS10P7",93,0)
 ;         9002313.82461 BPS NCPDP FIELD 461
"RTN","BPS10P7",94,0)
 ;         9002313.82501 BPS NCPDP FIELD 501
"RTN","BPS10P7",95,0)
 ;         9002313.82522 BPS NCPDP FIELD 522
"RTN","BPS10P7",96,0)
 ;         9002313.82528 BPS NCPDP FIELD 528
"RTN","BPS10P7",97,0)
 ;         9002313.82529 BPS NCPDP FIELD 529
"RTN","BPS10P7",98,0)
 ;         9002313.82532 BPS NCPDP FIELD 532
"RTN","BPS10P7",99,0)
 ;         9002313.82533 BPS NCPDP FIELD 533
"RTN","BPS10P7",100,0)
 ;         9002313.82535 BPS NCPDP FIELD 535
"RTN","BPS10P7",101,0)
 ;
"RTN","BPS10P7",102,0)
 ; DBIA2172,DBIA10141,DBIA10014
"RTN","BPS10P7",103,0)
 ;
"RTN","BPS10P7",104,0)
 D MES^XPDUTL("   - Deleting obsolete files.")
"RTN","BPS10P7",105,0)
 S XPDIDTOT=27,BPSC=0
"RTN","BPS10P7",106,0)
 F BPSY=1:1 S BPSX=$P($T(DELFILE+BPSY),";",3) Q:BPSX=""  D
"RTN","BPS10P7",107,0)
 . S BPSP=$G(DILOCKTM,3)
"RTN","BPS10P7",108,0)
 . D MES^XPDUTL("    - Deleting obsolete file #"_BPSX_", Waiting for hardware "_BPSP_" seconds...")
"RTN","BPS10P7",109,0)
 . S DIU=BPSX,DIU(0)="EDT"
"RTN","BPS10P7",110,0)
 . D EN^DIU2
"RTN","BPS10P7",111,0)
 . S BPSC=BPSC+1
"RTN","BPS10P7",112,0)
 . D UPDATE^XPDID(BPSC)
"RTN","BPS10P7",113,0)
 . H BPSP  ; need to pause so we don't hit the globals too hard
"RTN","BPS10P7",114,0)
 ;
"RTN","BPS10P7",115,0)
 D MES^XPDUTL("  Finished post-install of BPS*1*7")
"RTN","BPS10P7",116,0)
 Q
"RTN","BPS10P7",117,0)
 ;
"RTN","BPS10P7",118,0)
DQ ; taskman entry to clean up data
"RTN","BPS10P7",119,0)
 N BPSX,BPSY,Y,%DT,X
"RTN","BPS10P7",120,0)
 S BPSX=0 F  S BPSX=$O(^BPSR(BPSX)) Q:'BPSX  S BPSY=0 F  S BPSY=$O(^BPSR(BPSX,1000,BPSY)) Q:'BPSY  D
"RTN","BPS10P7",121,0)
 . I $D(^BPSR(BPSX,1000,BPSY,500)) S $P(^(500),"^",8)=""
"RTN","BPS10P7",122,0)
 ;
"RTN","BPS10P7",123,0)
 ; reset *M Vendor field to be null if a date is not stored there
"RTN","BPS10P7",124,0)
 I $L($P($G(^BPS(9002313.99,1,0)),"^",4)),$E($P(^(0),"^",4),1,7)'?7N S $P(^(0),"^",4)=""
"RTN","BPS10P7",125,0)
 ;
"RTN","BPS10P7",126,0)
 ; Cleaning up BPS Claims file, Date Reopened field (906)
"RTN","BPS10P7",127,0)
 ; some data stored in there is in external format, like 8-31-2006@13:20:04
"RTN","BPS10P7",128,0)
 S BPSX=0 F  S BPSX=$O(^BPSC(BPSX))  Q:'BPSX  D
"RTN","BPS10P7",129,0)
 . S BPSY=$P($G(^BPSC(BPSX,900)),"^",6)
"RTN","BPS10P7",130,0)
 . I '$L(BPSY) Q
"RTN","BPS10P7",131,0)
 . I $E(BPSY,1,7)?7N Q
"RTN","BPS10P7",132,0)
 . S %DT="PT",X=$P(BPSY,"@")
"RTN","BPS10P7",133,0)
 . D ^%DT
"RTN","BPS10P7",134,0)
 . I Y>0 S $P(^BPSC(BPSX,900),"^",6)=+(Y_$S(BPSY["@":"."_$TR($P(BPSY,"@",2),":"),1:""))
"RTN","BPS10P7",135,0)
 ;
"RTN","BPS10P7",136,0)
 ; clean out the data for:
"RTN","BPS10P7",137,0)
 ;  ^BPSC(ien,400,"AC")
"RTN","BPS10P7",138,0)
 ;  $P(^BPSC(BPS(9002313.02),400,0),"^",3)
"RTN","BPS10P7",139,0)
 S BPSX=0 F  S BPSX=$O(^BPSC(BPSX)) Q:'BPSX  K ^BPSC(BPSX,400,"AC")  S BPSY=0 F  S BPSY=$O(^BPSC(BPSX,400,BPSY)) Q:'BPSY  I $L($G(^BPSC(BPSX,400,BPSY,0))) S $P(^(0),"^",3)=""
"RTN","BPS10P7",140,0)
 ;
"RTN","BPS10P7",141,0)
 Q
"RTN","BPS10P7",142,0)
DELFILE ; list of files to go bye bye with their data
"RTN","BPS10P7",143,0)
 ;;9002313.82103
"RTN","BPS10P7",144,0)
 ;;9002313.82305
"RTN","BPS10P7",145,0)
 ;;9002313.82306
"RTN","BPS10P7",146,0)
 ;;9002313.82307
"RTN","BPS10P7",147,0)
 ;;9002313.82308
"RTN","BPS10P7",148,0)
 ;;9002313.82309
"RTN","BPS10P7",149,0)
 ;;9002313.82406
"RTN","BPS10P7",150,0)
 ;;9002313.82408
"RTN","BPS10P7",151,0)
 ;;9002313.82416
"RTN","BPS10P7",152,0)
 ;;9002313.82419
"RTN","BPS10P7",153,0)
 ;;9002313.82423
"RTN","BPS10P7",154,0)
 ;;9002313.82425
"RTN","BPS10P7",155,0)
 ;;9002313.82429
"RTN","BPS10P7",156,0)
 ;;9002313.82432
"RTN","BPS10P7",157,0)
 ;;9002313.82436
"RTN","BPS10P7",158,0)
 ;;9002313.8244
"RTN","BPS10P7",159,0)
 ;;9002313.82441
"RTN","BPS10P7",160,0)
 ;;9002313.82501
"RTN","BPS10P7",161,0)
 ;;9002313.82522
"RTN","BPS10P7",162,0)
 ;;9002313.82528
"RTN","BPS10P7",163,0)
 ;;9002313.82529
"RTN","BPS10P7",164,0)
 ;;9002313.82532
"RTN","BPS10P7",165,0)
 ;;9002313.82533
"RTN","BPS10P7",166,0)
 ;;9002313.82535
"RTN","BPS10P7",167,0)
 ;;9002313.8242
"RTN","BPS10P7",168,0)
 ;;9002313.82439
"RTN","BPS10P7",169,0)
 ;;9002313.82461
"RTN","BPS10P7",170,0)
 ;;
"RTN","BPS10P7",171,0)
 ;
"RTN","BPSBCKJ")
0^87^B46863482
"RTN","BPSBCKJ",1,0)
BPSBCKJ ;BHAM ISC/AAT - BPS NIGHTLY BACKGROUND JOB ;02/27/2005
"RTN","BPSBCKJ",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,2,5,7**;JUN 2004;Build 46
"RTN","BPSBCKJ",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSBCKJ",4,0)
 ;
"RTN","BPSBCKJ",5,0)
 Q
"RTN","BPSBCKJ",6,0)
 ;
"RTN","BPSBCKJ",7,0)
EN ; The ECME NIGHTLY PROCESS
"RTN","BPSBCKJ",8,0)
 ;
"RTN","BPSBCKJ",9,0)
 ; The list of nightly actions
"RTN","BPSBCKJ",10,0)
 D AUTOREV     ; Auto-Reversals (normal and inpatient)
"RTN","BPSBCKJ",11,0)
 D MAIN^BPSOSK ; Purge BPS LOG
"RTN","BPSBCKJ",12,0)
 D TASKMAN^BPSJAREG ; Do automatic registration.
"RTN","BPSBCKJ",13,0)
 Q
"RTN","BPSBCKJ",14,0)
 ;
"RTN","BPSBCKJ",15,0)
AUTOREV ; The Auto-Reverse Procedure
"RTN","BPSBCKJ",16,0)
 N BDT,BTRAN,BPHARM,BTRAN0,BTRAN1,BTRAN4,BDAYS,BRX,BFIL,BDATE,BNOW,BCLAIM,BRES,BREV,BTEST,REF,BCNT,BTX,X,X1,X2
"RTN","BPSBCKJ",17,0)
 ;
"RTN","BPSBCKJ",18,0)
 S BTEST=0 ; Debugging flag 1 - TEST, 0 - LIVE
"RTN","BPSBCKJ",19,0)
 S BCNT=0 ; Count reversals
"RTN","BPSBCKJ",20,0)
 ;
"RTN","BPSBCKJ",21,0)
 S REF=$NA(^TMP($J,"BPSBCKJ")) K @REF
"RTN","BPSBCKJ",22,0)
 ;
"RTN","BPSBCKJ",23,0)
 S (X1,BNOW)=$$DT^XLFDT()
"RTN","BPSBCKJ",24,0)
 ;
"RTN","BPSBCKJ",25,0)
 ;Define number of days to look back - Auto Reverse days can be from 0-31
"RTN","BPSBCKJ",26,0)
 ;To make sure every claim is caught, moving back 45 days
"RTN","BPSBCKJ",27,0)
 S X2=-45 D C^%DTC S BDT=X
"RTN","BPSBCKJ",28,0)
 ;
"RTN","BPSBCKJ",29,0)
 ;Loop through 'LAST UPDATE' 'AH' index
"RTN","BPSBCKJ",30,0)
 F  S BDT=$O(^BPST("AH",BDT)) Q:'BDT  S BTRAN=0 F  S BTRAN=$O(^BPST("AH",BDT,BTRAN)) Q:'BTRAN  D
"RTN","BPSBCKJ",31,0)
 . W:BTEST !,"TRAN=",BTRAN," ",?20
"RTN","BPSBCKJ",32,0)
 . S BTRAN0=$G(^BPST(BTRAN,0)),BTRAN1=$G(^(1)),BTRAN4=$G(^(4))
"RTN","BPSBCKJ",33,0)
 . I BTRAN0=""!(BTRAN1="") W:BTEST "ZERO OR ONE NODE MISSING" Q
"RTN","BPSBCKJ",34,0)
 . I '$$PAID^BPSOSQ4(BTRAN) W:BTEST "NOT PAID" Q  ; Not paid
"RTN","BPSBCKJ",35,0)
 . S BPHARM=$P(BTRAN1,U,7) I 'BPHARM W:BTEST "NO BPS PHARM" Q  ; BPS PHARMACY
"RTN","BPSBCKJ",36,0)
 . W:BTEST "BPHARM=",$P($G(^BPS(9002313.56,BPHARM,0)),U,1),"  "
"RTN","BPSBCKJ",37,0)
 . ;
"RTN","BPSBCKJ",38,0)
 . ;Handle 'Inpatient' Auto-Reversals
"RTN","BPSBCKJ",39,0)
 . S BREV=$$REVINP(BNOW,BTRAN,BTRAN0,BTRAN1,BPHARM) Q:BREV
"RTN","BPSBCKJ",40,0)
 . ;
"RTN","BPSBCKJ",41,0)
 . ;Handle Regular Auto-Reversals
"RTN","BPSBCKJ",42,0)
 . S BDAYS=+$P($G(^BPS(9002313.56,BPHARM,0)),U,9)
"RTN","BPSBCKJ",43,0)
 . I 'BDAYS W:BTEST "AUTO-REV DISABLED" Q  ;disabled
"RTN","BPSBCKJ",44,0)
 . I $P(BTRAN4,U,1) Q  ;Reversal claim exist
"RTN","BPSBCKJ",45,0)
 . S BCLAIM=$P(BTRAN0,U,4) I 'BCLAIM W:BTEST "NO BCLAIM" Q
"RTN","BPSBCKJ",46,0)
 . I $P($G(^BPSC(BCLAIM,0)),U,7) W:BTEST "AUTO-REVERSE FLAG" Q 
"RTN","BPSBCKJ",47,0)
 . S BDATE=$P($G(^BPSC(BCLAIM,0)),U,5)
"RTN","BPSBCKJ",48,0)
 . I 'BDATE S BDATE=$P($G(^BPSC(BCLAIM,0)),U,6)
"RTN","BPSBCKJ",49,0)
 . S BDATE=$P(BDATE,".")
"RTN","BPSBCKJ",50,0)
 . I 'BDATE="" W:BTEST "NO DATE" Q
"RTN","BPSBCKJ",51,0)
 . W:BTEST "DATE=",BDATE,"  "
"RTN","BPSBCKJ",52,0)
 . I $$FMDIFF^XLFDT(BNOW,BDATE,1)'>BDAYS W:BTEST "TOO EARLY" Q
"RTN","BPSBCKJ",53,0)
 . S BRX=$P(BTRAN1,U,11) I 'BRX W:BTEST "NO RX" Q
"RTN","BPSBCKJ",54,0)
 . S BFIL=$P(BTRAN1,U,1)
"RTN","BPSBCKJ",55,0)
 . I $$RELDATE(BRX,BFIL) W:BTEST " RELEASED" Q  ;released
"RTN","BPSBCKJ",56,0)
 . S BRES=$$REVERSE(BRX,BFIL,BCLAIM,1)
"RTN","BPSBCKJ",57,0)
 . W:BTEST " *REV CLM=",BCLAIM," STAT=",BRES
"RTN","BPSBCKJ",58,0)
 . I BRES=0!(BRES=4) D
"RTN","BPSBCKJ",59,0)
 .. S (BCNT,@REF@(BRES))=$G(@REF@(BRES))+1
"RTN","BPSBCKJ",60,0)
 .. S @REF@(BRES,BCNT)=BTRAN_U_BCLAIM_U_BRX_U_BFIL_U_BPHARM
"RTN","BPSBCKJ",61,0)
 . ; Any notifications to IB?
"RTN","BPSBCKJ",62,0)
 D BULL(REF) ; Send the bulletin
"RTN","BPSBCKJ",63,0)
 K @REF
"RTN","BPSBCKJ",64,0)
 Q
"RTN","BPSBCKJ",65,0)
 ;
"RTN","BPSBCKJ",66,0)
 ;Auto-Reverse Claims for Current Inpatients
"RTN","BPSBCKJ",67,0)
 ;
"RTN","BPSBCKJ",68,0)
 ;20050810;BEE;Phase III - CR11
"RTN","BPSBCKJ",69,0)
 ;
"RTN","BPSBCKJ",70,0)
REVINP(BNOW,BTRAN,BTRAN0,BTRAN1,BPHARM) ;
"RTN","BPSBCKJ",71,0)
 N BRX,BFIL,BCLAIM,BDATE,BRES,DFN,VAIP
"RTN","BPSBCKJ",72,0)
 ;
"RTN","BPSBCKJ",73,0)
 ;Only process Window fills
"RTN","BPSBCKJ",74,0)
 S BRX=+$P(BTRAN1,U,11) I BRX=0 Q 0
"RTN","BPSBCKJ",75,0)
 S BFIL=+$P(BTRAN1,U)
"RTN","BPSBCKJ",76,0)
 I $$MWC^BPSRPT6(BRX,BFIL)'="W" Q 0
"RTN","BPSBCKJ",77,0)
 ;
"RTN","BPSBCKJ",78,0)
 ;Check for Fill date - Must be equal to T-5
"RTN","BPSBCKJ",79,0)
 S BCLAIM=$P(BTRAN0,U,4) I 'BCLAIM Q 0
"RTN","BPSBCKJ",80,0)
 S BDATE=$$FILDATE(BRX,BFIL)
"RTN","BPSBCKJ",81,0)
 S BDATE=$P(BDATE,".")
"RTN","BPSBCKJ",82,0)
 I 'BDATE="" Q 0
"RTN","BPSBCKJ",83,0)
 I $$FMDIFF^XLFDT(BNOW,BDATE,1)'=5 Q 0
"RTN","BPSBCKJ",84,0)
 ;
"RTN","BPSBCKJ",85,0)
 ;Check for current Inpatient
"RTN","BPSBCKJ",86,0)
 S DFN=+$P(BTRAN0,U,6) I DFN=0 Q 0
"RTN","BPSBCKJ",87,0)
 D IN5^VADPT
"RTN","BPSBCKJ",88,0)
 I $G(VAIP(3))="" Q 0
"RTN","BPSBCKJ",89,0)
 ;
"RTN","BPSBCKJ",90,0)
 ;Auto-Reverse Claim
"RTN","BPSBCKJ",91,0)
 S BRES=$$REVERSE(BRX,BFIL,BCLAIM,2)
"RTN","BPSBCKJ",92,0)
 W:BTEST " *REV CLM=",BCLAIM," STAT=",BRES
"RTN","BPSBCKJ",93,0)
 I BRES=0!(BRES=4) D
"RTN","BPSBCKJ",94,0)
 . S (BCNT,@REF@(BRES))=$G(@REF@(BRES))+1
"RTN","BPSBCKJ",95,0)
 . S @REF@(BRES,BCNT)=BTRAN_U_BCLAIM_U_BRX_U_BFIL_U_BPHARM
"RTN","BPSBCKJ",96,0)
 Q 1
"RTN","BPSBCKJ",97,0)
 ;
"RTN","BPSBCKJ",98,0)
RELDATE(BRX,BFIL) ;Get the Released Date
"RTN","BPSBCKJ",99,0)
 I BFIL Q $$RXSUBF1^BPSUTIL1(BRX,52,52.1,+BFIL,17,"I")
"RTN","BPSBCKJ",100,0)
 Q $$RXAPI1^BPSUTIL1(BRX,31,"I")
"RTN","BPSBCKJ",101,0)
 ;
"RTN","BPSBCKJ",102,0)
FILDATE(BRX,BFIL) ;Get the Fill Date
"RTN","BPSBCKJ",103,0)
 I BFIL Q $$RXSUBF1^BPSUTIL1(BRX,52,52.1,+BFIL,.01,"I")
"RTN","BPSBCKJ",104,0)
 Q $$RXAPI1^BPSUTIL1(BRX,22,"I")
"RTN","BPSBCKJ",105,0)
 ;
"RTN","BPSBCKJ",106,0)
REVERSE(BRX,BFIL,BCLAIM,BTYPE) ;Auto-Reverse the claim
"RTN","BPSBCKJ",107,0)
 ;PUBLIC BTEST
"RTN","BPSBCKJ",108,0)
 N BDOS,BRES,BDAT,BMES,BRSN
"RTN","BPSBCKJ",109,0)
 I $G(BTEST) Q 0  ; Test mode
"RTN","BPSBCKJ",110,0)
 ;
"RTN","BPSBCKJ",111,0)
 ; Get Date of Service and set reversal reason
"RTN","BPSBCKJ",112,0)
 S BDOS=$$DOSDATE^BPSSCRRS(BRX,BFIL)
"RTN","BPSBCKJ",113,0)
 S BRSN=$S(BTYPE=2:"CURRENT INPATIENT",1:"PRESCRIPTION NOT RELEASED")
"RTN","BPSBCKJ",114,0)
 ;
"RTN","BPSBCKJ",115,0)
 ; Call ECME to process reversal
"RTN","BPSBCKJ",116,0)
 S BRES=$$EN^BPSNCPDP(BRX,BFIL,BDOS,"AREV","",BRSN,"")
"RTN","BPSBCKJ",117,0)
 ;
"RTN","BPSBCKJ",118,0)
 ; If successful, log message to the Prescription Activity Log
"RTN","BPSBCKJ",119,0)
 ;  and set the auto-reversal flag
"RTN","BPSBCKJ",120,0)
 S BRES=+BRES,BMES="Submitted to ECME: AUTO REVERSAL JOB"
"RTN","BPSBCKJ",121,0)
 I BRES=0 D
"RTN","BPSBCKJ",122,0)
 . D ECMEACT^PSOBPSU1(BRX,BFIL,BMES,.5)
"RTN","BPSBCKJ",123,0)
 . S BDAT(9002313.02,BCLAIM_",",.07)=BTYPE D FILE^DIE("","BDAT")
"RTN","BPSBCKJ",124,0)
 Q BRES
"RTN","BPSBCKJ",125,0)
 ;
"RTN","BPSBCKJ",126,0)
 ;
"RTN","BPSBCKJ",127,0)
BULL(REF) ;Bulletin to the OPECC
"RTN","BPSBCKJ",128,0)
 ;PUBLIC BTEST,DUZ,DT
"RTN","BPSBCKJ",129,0)
 N XMSUB,XMY,XMTEXT,XMDUZ,BLNUM
"RTN","BPSBCKJ",130,0)
 ;
"RTN","BPSBCKJ",131,0)
 I BCNT<1,'$G(BTEST),(+$G(@REF@(4)))=0 Q
"RTN","BPSBCKJ",132,0)
 S BLNUM=0,BCNT=+$G(@REF@(0))
"RTN","BPSBCKJ",133,0)
 S XMSUB="ECME AUTO-REVERSAL PROCESS"
"RTN","BPSBCKJ",134,0)
 I $G(BTEST) D T("*** P L E A S E   D I S R E G A R D    T H I S    E M A I L ***"),T(),T("NOT ACTUALLY REVERSED - THIS IS A TEST"),T()
"RTN","BPSBCKJ",135,0)
 D T("The ECME Nightly Process submitted auto-reversals for the following e-Pharmacy")
"RTN","BPSBCKJ",136,0)
 D T("prescriptions.")
"RTN","BPSBCKJ",137,0)
 D T()
"RTN","BPSBCKJ",138,0)
 D T("TOTAL CLAIMS SUBMITTED FOR AUTO-REVERSALS: "_BCNT)
"RTN","BPSBCKJ",139,0)
 D T()
"RTN","BPSBCKJ",140,0)
 D T("Claims Submitted for Auto-Reversals on "_$$DAT(DT)_":") D ARLIST(0,REF)
"RTN","BPSBCKJ",141,0)
 D T()
"RTN","BPSBCKJ",142,0)
 S BCNT=+$G(@REF@(4))
"RTN","BPSBCKJ",143,0)
 I BCNT'=0 D
"RTN","BPSBCKJ",144,0)
 . D T()
"RTN","BPSBCKJ",145,0)
 . D T("The ECME Nightly Process attempted to auto-reverse the following claims but")
"RTN","BPSBCKJ",146,0)
 . D T("could not because the previous request was IN PROGRESS.  Please verify that")
"RTN","BPSBCKJ",147,0)
 . D T("the previous request is not stranded.")
"RTN","BPSBCKJ",148,0)
 . D T()
"RTN","BPSBCKJ",149,0)
 . D T("Total number of claims that could not be auto-reversed: "_BCNT)
"RTN","BPSBCKJ",150,0)
 . D T()
"RTN","BPSBCKJ",151,0)
 . D T("Claims not auto-reversed on "_$$DAT(DT)_":")
"RTN","BPSBCKJ",152,0)
 . D ARLIST(4,REF)
"RTN","BPSBCKJ",153,0)
 . D T()
"RTN","BPSBCKJ",154,0)
 ;
"RTN","BPSBCKJ",155,0)
 S XMDUZ="BPS PACKAGE",XMTEXT="BTX("
"RTN","BPSBCKJ",156,0)
 S XMY("G.BPS OPECC")=""
"RTN","BPSBCKJ",157,0)
 I $G(DUZ)'<1 S XMY(DUZ)=""
"RTN","BPSBCKJ",158,0)
 D ^XMD
"RTN","BPSBCKJ",159,0)
 Q
"RTN","BPSBCKJ",160,0)
 ;
"RTN","BPSBCKJ",161,0)
T(BTXT) ; Add text to the message
"RTN","BPSBCKJ",162,0)
 ;PUBLIC BLNUM,BTEST
"RTN","BPSBCKJ",163,0)
 S BLNUM=BLNUM+1,BTX(BLNUM)=$G(BTXT," ")
"RTN","BPSBCKJ",164,0)
 I $G(BTEST) W !,$G(BTXT)
"RTN","BPSBCKJ",165,0)
 Q
"RTN","BPSBCKJ",166,0)
 ;
"RTN","BPSBCKJ",167,0)
ARLIST(BRES,REF) ;Auto-Rev List
"RTN","BPSBCKJ",168,0)
 N I,TXT,BCLAIM,BTRAN,Y,BRX,BFIL,BFDATE,BPHARM,BRXN,BPHARMN,BPAT,BPSTAT
"RTN","BPSBCKJ",169,0)
 D T()
"RTN","BPSBCKJ",170,0)
 D T(" #    RX     FILL  STATUS FILL DATE PATIENT                      BPS PHARMACY")
"RTN","BPSBCKJ",171,0)
 D T("------------------------------------------------------------------------------")
"RTN","BPSBCKJ",172,0)
 S I=0 F  S I=$O(@REF@(BRES,I)) Q:'I   D
"RTN","BPSBCKJ",173,0)
 . S Y=@REF@(BRES,I)
"RTN","BPSBCKJ",174,0)
 . S BTRAN=$P(Y,U)
"RTN","BPSBCKJ",175,0)
 . S BCLAIM=$P(Y,U,2)
"RTN","BPSBCKJ",176,0)
 . S BRX=$P(Y,U,3),BRXN=$$RXAPI1^BPSUTIL1(BRX,.01,"I")
"RTN","BPSBCKJ",177,0)
 . S BPAT=$P($G(^DPT(+$$RXAPI1^BPSUTIL1(BRX,2,"I"),0)),U)
"RTN","BPSBCKJ",178,0)
 . S BFIL=$P(Y,U,4)
"RTN","BPSBCKJ",179,0)
 . S BPHARM=$P(Y,U,5),BPHARMN=$P($G(^BPS(9002313.56,BPHARM,0)),U)
"RTN","BPSBCKJ",180,0)
 . S BFDATE=$$FILDATE(BRX,BFIL)
"RTN","BPSBCKJ",181,0)
 . S BPSTAT=$$MWC^BPSRPT6(BRX,BFIL)_"/"_$S($$RELDATE(BRX,BFIL)]"":"RL",1:"NR")
"RTN","BPSBCKJ",182,0)
 . S TXT=$J(I,3)_" "_$$J(BRXN,10)_" "_$$J(BFIL,2)_"  "_$J(BPSTAT,4)_"  "_$$J($$DAT(BFDATE),11)_$$J(BPAT,25)_" "_$J($E(BPHARMN,1,15),15)
"RTN","BPSBCKJ",183,0)
 . D T(TXT)
"RTN","BPSBCKJ",184,0)
 D T("------------------------------------------------------------------------------")
"RTN","BPSBCKJ",185,0)
 Q
"RTN","BPSBCKJ",186,0)
 ;
"RTN","BPSBCKJ",187,0)
J(TXT,LEN) ;Left justify
"RTN","BPSBCKJ",188,0)
 Q TXT_$J("",LEN-$L(TXT))
"RTN","BPSBCKJ",189,0)
 ;
"RTN","BPSBCKJ",190,0)
DAT(X,Y) ; Convert FM date to displayable (mm/dd/yy) format.
"RTN","BPSBCKJ",191,0)
 ; -- optional output of time, if $g(y) 
"RTN","BPSBCKJ",192,0)
 N DATE,T
"RTN","BPSBCKJ",193,0)
 S DATE=$S(X:$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3),1:"")
"RTN","BPSBCKJ",194,0)
 I $G(Y) S T="."_$E($P(X,".",2)_"000000",1,7) I T>0 S DATE=DATE_" "_$S($E(T,2,3)>12:$E(T,2,3)-12,$E(T,2,3)="00":"00",1:+$E(T,2,3))_":"_$E(T,4,5)_$S($E(T,2,5)>1200:" pm",1:" am")
"RTN","BPSBCKJ",195,0)
 Q DATE
"RTN","BPSBUTL")
0^91^B52438241
"RTN","BPSBUTL",1,0)
BPSBUTL ;BHAM ISC/MFR/VA/DLF - IB Communication Utilities ;06/01/2004
"RTN","BPSBUTL",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,3,2,5,7**;JUN 2004;Build 46
"RTN","BPSBUTL",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSBUTL",4,0)
 ;Reference to STORESP^IBNCPDP supported by DBIA 4299
"RTN","BPSBUTL",5,0)
 Q
"RTN","BPSBUTL",6,0)
 ;
"RTN","BPSBUTL",7,0)
 ;CLAIM - pointer to #9002313.02
"RTN","BPSBUTL",8,0)
 ;TRNDX - ptr to #9002313.59
"RTN","BPSBUTL",9,0)
 ;REASON -  text name of the close reason
"RTN","BPSBUTL",10,0)
 ;PAPER - 1=drop to paper
"RTN","BPSBUTL",11,0)
 ;RELCOP - 1 (Yes) or 0 (No) release copay or not?
"RTN","BPSBUTL",12,0)
 ;COMMENT - comment
"RTN","BPSBUTL",13,0)
 ;ERROR - array by reference for error details
"RTN","BPSBUTL",14,0)
 ;
"RTN","BPSBUTL",15,0)
CLOSE(CLAIM,TRNDX,REASON,PAPER,RELCOP,COMMENT,ERROR) ; Send IB an update on the CLAIM status for a Closed Claim
"RTN","BPSBUTL",16,0)
 N DFN,BPSARRY,BILLNUM,CLAIMNFO,FILLNUM,RXIEN,TRANINFO
"RTN","BPSBUTL",17,0)
 ;
"RTN","BPSBUTL",18,0)
 ; - Data gathering
"RTN","BPSBUTL",19,0)
 D GETS^DIQ("9002313.59",TRNDX,"1.11;9","I","TRANINFO")
"RTN","BPSBUTL",20,0)
 S RXIEN=TRANINFO(9002313.59,TRNDX_",",1.11,"I")
"RTN","BPSBUTL",21,0)
 I $$RXAPI1^BPSUTIL1(RXIEN,.01)="" S ERROR="Prescription not found." Q
"RTN","BPSBUTL",22,0)
 S BPSARRY("FILL NUMBER")=TRANINFO(9002313.59,TRNDX_",",9,"I")
"RTN","BPSBUTL",23,0)
 D GETS^DIQ("9002313.02",CLAIM,"400*;401;402;403;426","","CLAIMNFO")
"RTN","BPSBUTL",24,0)
 S BPSARRY("FILL DATE")=$$EXT2FM^BPSOSU1(CLAIMNFO("9002313.0201","1,"_CLAIM_",","401"))
"RTN","BPSBUTL",25,0)
 S FILLNUM=+BPSARRY("FILL NUMBER")
"RTN","BPSBUTL",26,0)
 S DFN=$$RXAPI1^BPSUTIL1(RXIEN,2,"I")
"RTN","BPSBUTL",27,0)
 S BPSARRY("FILLED BY")=$$RXAPI1^BPSUTIL1(RXIEN,16,"I")
"RTN","BPSBUTL",28,0)
 S BPSARRY("PRESCRIPTION")=RXIEN
"RTN","BPSBUTL",29,0)
 S BPSARRY("BILLED")=$$DFF2EXT^BPSECFM($P(CLAIMNFO("9002313.0201","1,"_CLAIM_",","426"),"DQ",2))
"RTN","BPSBUTL",30,0)
 S BPSARRY("CLAIMID")=$P(CLAIMNFO("9002313.0201","1,"_CLAIM_",","402"),"D2",2)
"RTN","BPSBUTL",31,0)
 S BPSARRY("PLAN")=$P(^BPST(TRNDX,10,1,0),"^")
"RTN","BPSBUTL",32,0)
 S BPSARRY("STATUS")="CLOSED"
"RTN","BPSBUTL",33,0)
 S BPSARRY("PAID")=0
"RTN","BPSBUTL",34,0)
 S BPSARRY("RELEASE DATE")=$S(FILLNUM=0:$$RXAPI1^BPSUTIL1(RXIEN,31,"I"),1:$$RXSUBF1^BPSUTIL1(RXIEN,52,52.1,FILLNUM,17,"I"))
"RTN","BPSBUTL",35,0)
 S BPSARRY("USER")=DUZ
"RTN","BPSBUTL",36,0)
 S BPSARRY("EPHARM")=$$GET1^DIQ(9002313.59,TRNDX,1.07,"I")
"RTN","BPSBUTL",37,0)
 I REASON'="" D
"RTN","BPSBUTL",38,0)
 . S BPSARRY("CLOSE REASON")=$O(^IBE(356.8,"B",REASON,0))
"RTN","BPSBUTL",39,0)
 . S BPSARRY("DROP TO PAPER")=+$G(PAPER)
"RTN","BPSBUTL",40,0)
 . S BPSARRY("RELEASE COPAY")=+$G(RELCOP)
"RTN","BPSBUTL",41,0)
 I $G(COMMENT)]"" S BPSARRY("CLOSE COMMENT")=COMMENT
"RTN","BPSBUTL",42,0)
 ;
"RTN","BPSBUTL",43,0)
 ; If dropped to Paper, increment the counter in BPS Statistics
"RTN","BPSBUTL",44,0)
 I BPSARRY("DROP TO PAPER")=1 D INCSTAT^BPSOSUD("R",8)
"RTN","BPSBUTL",45,0)
 ;
"RTN","BPSBUTL",46,0)
 ; Call IB
"RTN","BPSBUTL",47,0)
 S BILLNUM=$$STORESP^IBNCPDP(DFN,.BPSARRY)
"RTN","BPSBUTL",48,0)
 Q
"RTN","BPSBUTL",49,0)
 ; Send IB an update on the CLAIM status for a restocked or deleted prescription
"RTN","BPSBUTL",50,0)
CLOSE2(RXIEN,BFILL,BWHERE) ;
"RTN","BPSBUTL",51,0)
 N IEN59,BPSARRY,DFN,BILLNUM,FILL,REASON
"RTN","BPSBUTL",52,0)
 N CLAIMNFO
"RTN","BPSBUTL",53,0)
 N DIE,DA,DR
"RTN","BPSBUTL",54,0)
 ;
"RTN","BPSBUTL",55,0)
 ; Check parameters
"RTN","BPSBUTL",56,0)
 I '$G(RXIEN) S ERROR="No prescription parameter" Q
"RTN","BPSBUTL",57,0)
 ;
"RTN","BPSBUTL",58,0)
 I $$RXAPI1^BPSUTIL1(RXIEN,.01)="" S ERROR="Prescription not found." Q
"RTN","BPSBUTL",59,0)
 I ",DDED,DE,RS,"'[(","_BWHERE_",") S ERROR="Invalid BWHERE parameter" Q
"RTN","BPSBUTL",60,0)
 ;
"RTN","BPSBUTL",61,0)
 ; Calculate the transaction IEN and see that it exists
"RTN","BPSBUTL",62,0)
 S FILL=".0000"_+BFILL
"RTN","BPSBUTL",63,0)
 S IEN59=RXIEN_"."_$E(FILL,$L(FILL)-3,$L(FILL))_"1"
"RTN","BPSBUTL",64,0)
 I '$D(^BPST(IEN59,0)) Q
"RTN","BPSBUTL",65,0)
 ;
"RTN","BPSBUTL",66,0)
 ; Get claim data
"RTN","BPSBUTL",67,0)
 S CLAIM=$P(^BPST(IEN59,0),"^",4)
"RTN","BPSBUTL",68,0)
 D GETS^DIQ("9002313.02",CLAIM,"400*;401;402;426","","CLAIMNFO")
"RTN","BPSBUTL",69,0)
 S BPSARRY("FILL NUMBER")=+BFILL
"RTN","BPSBUTL",70,0)
 S BPSARRY("FILL DATE")=$$EXT2FM^BPSOSU1(CLAIMNFO("9002313.0201","1,"_CLAIM_",","401"))
"RTN","BPSBUTL",71,0)
 ;
"RTN","BPSBUTL",72,0)
 ; Get prescription data
"RTN","BPSBUTL",73,0)
 S FILLNUM=BPSARRY("FILL NUMBER")
"RTN","BPSBUTL",74,0)
 S DFN=$$RXAPI1^BPSUTIL1(RXIEN,2,"I")
"RTN","BPSBUTL",75,0)
 S BPSARRY("FILLED BY")=$$RXAPI1^BPSUTIL1(RXIEN,16,"I")
"RTN","BPSBUTL",76,0)
 S BPSARRY("PRESCRIPTION")=RXIEN
"RTN","BPSBUTL",77,0)
 S BPSARRY("BILLED")=$$DFF2EXT^BPSECFM($P(CLAIMNFO("9002313.0201","1,"_CLAIM_",","426"),"DQ",2))
"RTN","BPSBUTL",78,0)
 S BPSARRY("CLAIMID")=$P(CLAIMNFO("9002313.0201","1,"_CLAIM_",","402"),"D2",2)
"RTN","BPSBUTL",79,0)
 S BPSARRY("PLAN")=$P(^BPST(IEN59,10,1,0),"^")
"RTN","BPSBUTL",80,0)
 S BPSARRY("STATUS")="CLOSED"
"RTN","BPSBUTL",81,0)
 S BPSARRY("PAID")=0
"RTN","BPSBUTL",82,0)
 S BPSARRY("RELEASE DATE")=$S(FILLNUM=0:$$RXAPI1^BPSUTIL1(RXIEN,31,"I"),1:$$RXSUBF1^BPSUTIL1(RXIEN,52,52.1,FILLNUM,17,"I"))
"RTN","BPSBUTL",83,0)
 S BPSARRY("USER")=.5
"RTN","BPSBUTL",84,0)
 S BPSARRY("EPHARM")=$$GET1^DIQ(9002313.59,IEN59,1.07,"I")
"RTN","BPSBUTL",85,0)
 ;
"RTN","BPSBUTL",86,0)
 ; Determine the reversal reason based on the BWHERE value
"RTN","BPSBUTL",87,0)
 I BWHERE="RS" S REASON="PRESCRIPTION NOT RELEASED"
"RTN","BPSBUTL",88,0)
 I BWHERE="DE"!(BWHERE="DDED") S REASON="PRESCRIPTION DELETED"
"RTN","BPSBUTL",89,0)
 I REASON]"" S BPSARRY("CLOSE REASON")=$O(^IBE(356.8,"B",REASON,0))
"RTN","BPSBUTL",90,0)
 ;
"RTN","BPSBUTL",91,0)
 ;if a refill was deleted while RX is still active (not deleted) then send DELETION OF REFILL comment for CT record
"RTN","BPSBUTL",92,0)
 I BWHERE="DE",$$RXSTATUS^BPSSCRU2(RXIEN)'=13 S BPSARRY("CLOSE COMMENT")="DELETION OF REFILL ONLY - ORIGINAL RX MAY REMAIN ACTIVE"
"RTN","BPSBUTL",93,0)
 ;
"RTN","BPSBUTL",94,0)
 ;
"RTN","BPSBUTL",95,0)
 ; Update IB
"RTN","BPSBUTL",96,0)
 S BILLNUM=$$STORESP^IBNCPDP(DFN,.BPSARRY)
"RTN","BPSBUTL",97,0)
 ;
"RTN","BPSBUTL",98,0)
 ; Update the claim file that the claim is closed and the reason why.
"RTN","BPSBUTL",99,0)
 S DIE="^BPSC(",DA=CLAIM
"RTN","BPSBUTL",100,0)
 S DR="901///1;902///"_$$NOW^XLFDT()_";903////.5;904///"_BPSARRY("CLOSE REASON")
"RTN","BPSBUTL",101,0)
 D ^DIE
"RTN","BPSBUTL",102,0)
 Q
"RTN","BPSBUTL",103,0)
 ;
"RTN","BPSBUTL",104,0)
 ; Function to return Transaction, claim, and response IENs
"RTN","BPSBUTL",105,0)
 ; Parameters:
"RTN","BPSBUTL",106,0)
 ;    RXI: Prescription IEN
"RTN","BPSBUTL",107,0)
 ;    RXR: Fill Number
"RTN","BPSBUTL",108,0)
 ; Returns:
"RTN","BPSBUTL",109,0)
 ;    IEN59^Claim IEN^Response IEN^Reversal Claim IEN^Reversal Response IEN
"RTN","BPSBUTL",110,0)
CLAIM(RXI,RXR) ;
"RTN","BPSBUTL",111,0)
 N IEN59,CLAIMIEN,RESPIEN,REVCLAIM,REVRESP
"RTN","BPSBUTL",112,0)
 I '$G(RXI) Q
"RTN","BPSBUTL",113,0)
 S IEN59=$$IEN59^BPSOSRX(RXI,RXR)
"RTN","BPSBUTL",114,0)
 I '$D(^BPST(IEN59,0)) Q ""
"RTN","BPSBUTL",115,0)
 S CLAIMIEN=$P(^BPST(IEN59,0),"^",4),RESPIEN=$P(^BPST(IEN59,0),"^",5)
"RTN","BPSBUTL",116,0)
 S REVCLAIM=$P($G(^BPST(IEN59,4)),"^",1),REVRESP=$P($G(^BPST(IEN59,4)),"^",2)
"RTN","BPSBUTL",117,0)
 Q IEN59_U_CLAIMIEN_U_RESPIEN_U_REVCLAIM_U_REVRESP
"RTN","BPSBUTL",118,0)
 ;
"RTN","BPSBUTL",119,0)
 ; NABP - Return the value in the Service Provider ID (201-B1) field
"RTN","BPSBUTL",120,0)
 ;   of the claim.  Note that as of the NPI release (BPS*1*2), this
"RTN","BPSBUTL",121,0)
 ;   API may return NPI instead of NABP/NCPDP
"RTN","BPSBUTL",122,0)
NABP(RXP,BFILL) ;
"RTN","BPSBUTL",123,0)
 I '$G(RXP) Q ""
"RTN","BPSBUTL",124,0)
 I $G(BFILL)="" S BFILL=0
"RTN","BPSBUTL",125,0)
 N BPSTIEN,BPSCIEN,DFILL,NABP
"RTN","BPSBUTL",126,0)
 S DFILL=$E($TR($J("",4-$L(BFILL))," ","0")_BFILL,1,4)
"RTN","BPSBUTL",127,0)
 S BPSTIEN=RXP_"."_DFILL_"1"
"RTN","BPSBUTL",128,0)
 I 'BPSTIEN Q ""
"RTN","BPSBUTL",129,0)
 S BPSCIEN=$P($G(^BPST(BPSTIEN,0)),U,4)
"RTN","BPSBUTL",130,0)
 I 'BPSCIEN Q ""
"RTN","BPSBUTL",131,0)
 S NABP=$P($G(^BPSC(BPSCIEN,200)),U)
"RTN","BPSBUTL",132,0)
 Q NABP
"RTN","BPSBUTL",133,0)
 ;
"RTN","BPSBUTL",134,0)
 ; DIVNCPDP - For a specific outpatient site, return the NPI & NCPDP.
"RTN","BPSBUTL",135,0)
 ; Note that the procedure name is misleading but when originally
"RTN","BPSBUTL",136,0)
 ;   coded, this procedure only returned NCPDP.
"RTN","BPSBUTL",137,0)
 ;
"RTN","BPSBUTL",138,0)
 ; Input
"RTN","BPSBUTL",139,0)
 ;   BPSDIV - Outpatient Site (#59)
"RTN","BPSBUTL",140,0)
 ; Output
"RTN","BPSBUTL",141,0)
 ;   "" - No BPSDIV passed in
"RTN","BPSBUTL",142,0)
 ;   NCPDP and NPI separated by a caret
"RTN","BPSBUTL",143,0)
DIVNCPDP(BPSDIV) ;
"RTN","BPSBUTL",144,0)
 N BPSPHARM,NPI,NCPDP
"RTN","BPSBUTL",145,0)
 I '$G(BPSDIV) Q "^"
"RTN","BPSBUTL",146,0)
 ;
"RTN","BPSBUTL",147,0)
 ; Get the NCPDP
"RTN","BPSBUTL",148,0)
 S NCPDP=""
"RTN","BPSBUTL",149,0)
 S BPSPHARM=$$GETPHARM^BPSUTIL(BPSDIV)
"RTN","BPSBUTL",150,0)
 I BPSPHARM S NCPDP=$$GET1^DIQ(9002313.56,BPSPHARM_",",.02)
"RTN","BPSBUTL",151,0)
 ;
"RTN","BPSBUTL",152,0)
 ; Get the NPI and validate it
"RTN","BPSBUTL",153,0)
 S NPI=+$$NPI^BPSNPI("Pharmacy_ID",BPSDIV)
"RTN","BPSBUTL",154,0)
 I NPI=-1 S NPI=""
"RTN","BPSBUTL",155,0)
 ;
"RTN","BPSBUTL",156,0)
 Q NCPDP_"^"_NPI
"RTN","BPSBUTL",157,0)
 ;
"RTN","BPSBUTL",158,0)
 ;ADDCOMM - Add a comment to a ECME claim
"RTN","BPSBUTL",159,0)
 ;Input:
"RTN","BPSBUTL",160,0)
 ; BPRX - ien in file #52 
"RTN","BPSBUTL",161,0)
 ; BPREF - refill number (0,1,2,...)
"RTN","BPSBUTL",162,0)
 ; BPRCMNT - comment text 
"RTN","BPSBUTL",163,0)
 ;Output:
"RTN","BPSBUTL",164,0)
 ;  1 - okay
"RTN","BPSBUTL",165,0)
 ; -1 - failed
"RTN","BPSBUTL",166,0)
ADDCOMM(BPRX,BPREF,BPRCMNT) ;
"RTN","BPSBUTL",167,0)
 N BP59,BPNOW,BPLCK,BPREC,BPDA,BPERR
"RTN","BPSBUTL",168,0)
 N %,%H,%I,X
"RTN","BPSBUTL",169,0)
 I $L(BPRX)<1 Q -1
"RTN","BPSBUTL",170,0)
 I $G(BPRCMNT)="" Q -1
"RTN","BPSBUTL",171,0)
 S BP59=BPRX_$S($L(+BPREF)=1:".000",1:".00")_+BPREF_"1" ;borrowed from CLOSE2 above
"RTN","BPSBUTL",172,0)
 D NOW^%DTC
"RTN","BPSBUTL",173,0)
 S BPNOW=%
"RTN","BPSBUTL",174,0)
 L +^BPST(9002313.59111,+BP59):10
"RTN","BPSBUTL",175,0)
 S BPLCK=$T
"RTN","BPSBUTL",176,0)
 I 'BPLCK Q -1  ;quit
"RTN","BPSBUTL",177,0)
 D INSITEM^BPSCMT01(9002313.59111,+BP59,BPNOW)
"RTN","BPSBUTL",178,0)
 S BPREC=$O(^BPST(BP59,11,"B",BPNOW,0))
"RTN","BPSBUTL",179,0)
 I BPREC>0 D
"RTN","BPSBUTL",180,0)
 . S BPDA(9002313.59111,BPREC_","_BP59_",",.02)=+$G(DUZ)
"RTN","BPSBUTL",181,0)
 . S BPDA(9002313.59111,BPREC_","_BP59_",",.03)=$E($G(BPRCMNT),1,63)
"RTN","BPSBUTL",182,0)
 . D FILE^DIE("","BPDA","BPERR")
"RTN","BPSBUTL",183,0)
 I BPLCK L -^BPST(9002313.59111,+BP59)
"RTN","BPSBUTL",184,0)
 I BPREC>0,'$D(BPERR) Q 1
"RTN","BPSBUTL",185,0)
 Q -1
"RTN","BPSBUTL",186,0)
 ;
"RTN","BPSBUTL",187,0)
 ;REOPEN - Reopen closed claim
"RTN","BPSBUTL",188,0)
 ;Input:
"RTN","BPSBUTL",189,0)
 ; BP59 - ien in BPS TRANSACTION file
"RTN","BPSBUTL",190,0)
 ; BP02 - ien in BPS CLAIMS file
"RTN","BPSBUTL",191,0)
 ; BPREOPDT - reopen date/time 
"RTN","BPSBUTL",192,0)
 ; BPDUZ - user DUZ (#200 ien)
"RTN","BPSBUTL",193,0)
 ; BPCOMM - reopen comment text
"RTN","BPSBUTL",194,0)
 ;Output:
"RTN","BPSBUTL",195,0)
 ; 0^message_error - error
"RTN","BPSBUTL",196,0)
 ; 1 - success
"RTN","BPSBUTL",197,0)
REOPEN(BP59,BP02,BPREOPDT,BPDUZ,BPCOMM) ;
"RTN","BPSBUTL",198,0)
 N RECIENS,BPDA,ERRARR,BPREFNO,BPRXIEN,BPFILLDT,BPCLMID,BPZ,BPSARRY,BPDFN,BPRETVAL,BPZ1
"RTN","BPSBUTL",199,0)
 S BPDFN=$P($G(^BPST(BP59,0)),U,6)
"RTN","BPSBUTL",200,0)
 S BPREFNO=$P($G(^BPST(BP59,1)),U)
"RTN","BPSBUTL",201,0)
 I BPREFNO="" Q "0^Null Fill Number"
"RTN","BPSBUTL",202,0)
 S BPRXIEN=$P($G(^BPST(BP59,1)),U,11)
"RTN","BPSBUTL",203,0)
 I BPRXIEN="" Q "0^Null RX ien Number"
"RTN","BPSBUTL",204,0)
 ;in VA there is only one med/claim but in some cases it can different than "1"
"RTN","BPSBUTL",205,0)
 ;so take the latest one
"RTN","BPSBUTL",206,0)
 S BPZ=$O(^BPSC(BP02,400,9999999),-1)
"RTN","BPSBUTL",207,0)
 I BPRXIEN="" Q "0^Database Error"
"RTN","BPSBUTL",208,0)
 S BPFILLDT=$$YMD2FM^BPSSCRU6(+$P($G(^BPSC(BP02,400,+BPZ,400)),U))
"RTN","BPSBUTL",209,0)
 S BPCLMID=$$CONVCLID^BPSSCRU6($P($G(^BPSC(BP02,400,+BPZ,400)),U,2))
"RTN","BPSBUTL",210,0)
 ;============
"RTN","BPSBUTL",211,0)
 ;Now update ECME database
"RTN","BPSBUTL",212,0)
 S BPRETVAL=$$UPDREOP^BPSREOP1(BP02,0,BPREOPDT,BPDUZ,BPCOMM)
"RTN","BPSBUTL",213,0)
 I +BPRETVAL=0 D  Q BPRETVAL
"RTN","BPSBUTL",214,0)
 . ;try to reverse it in case it was done partially
"RTN","BPSBUTL",215,0)
 . I $$UPDREOP^BPSREOP1(BP02,1,"@",+BPDUZ,"@")
"RTN","BPSBUTL",216,0)
 ;============
"RTN","BPSBUTL",217,0)
 ;Now call IB API for "REOPEN" event
"RTN","BPSBUTL",218,0)
 S BPSARRY("STATUS")="REOPEN"
"RTN","BPSBUTL",219,0)
 S BPSARRY("FILL DATE")=BPFILLDT
"RTN","BPSBUTL",220,0)
 S BPSARRY("FILL NUMBER")=BPREFNO
"RTN","BPSBUTL",221,0)
 S BPSARRY("PRESCRIPTION")=BPRXIEN
"RTN","BPSBUTL",222,0)
 S BPSARRY("CLAIMID")=BPCLMID
"RTN","BPSBUTL",223,0)
 S BPSARRY("DRUG")=$$DRUGIEN^BPSSCRU6(BPRXIEN,BPDFN)
"RTN","BPSBUTL",224,0)
 S BPSARRY("PLAN")=$P($G(^BPST(BP59,10,1,0)),"^")
"RTN","BPSBUTL",225,0)
 S BPSARRY("USER")=BPDUZ
"RTN","BPSBUTL",226,0)
 S BPSARRY("REOPEN COMMENT")=BPCOMM
"RTN","BPSBUTL",227,0)
 S BPSARRY("EPHARM")=$$GET1^DIQ(9002313.59,BP59,1.07,"I")
"RTN","BPSBUTL",228,0)
 S BPRETVAL=$$STORESP^IBNCPDP(BPDFN,.BPSARRY)
"RTN","BPSBUTL",229,0)
 ;if successful
"RTN","BPSBUTL",230,0)
 I +BPRETVAL>0 Q "1^ReOpening Claim: "_$P($G(^BPSC(BP02,0)),U)_" ... OK"
"RTN","BPSBUTL",231,0)
 ;===========
"RTN","BPSBUTL",232,0)
 ;if it was unsuccessful
"RTN","BPSBUTL",233,0)
 ;reverse ECME database (keep the user who made the attempt)
"RTN","BPSBUTL",234,0)
 I $$UPDREOP^BPSREOP1(BP02,1,"@",+BPDUZ,"@")
"RTN","BPSBUTL",235,0)
 ;return IB error message
"RTN","BPSBUTL",236,0)
 Q BPRETVAL
"RTN","BPSECFM")
0^46^B10863158
"RTN","BPSECFM",1,0)
BPSECFM ;BHAM ISC/FCS/DRS/VA/DLF - NCPDP Field Format Functions ;3/12/08  13:01
"RTN","BPSECFM",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,7**;JUN 2004;Build 46
"RTN","BPSECFM",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSECFM",4,0)
 ;
"RTN","BPSECFM",5,0)
 ;----------------------------------------------------------------------
"RTN","BPSECFM",6,0)
 ;NCPDP Field Format Functions
"RTN","BPSECFM",7,0)
 ; These are all $$ functions called from lots of places.
"RTN","BPSECFM",8,0)
 ;--------------------------------------------------------
"RTN","BPSECFM",9,0)
 ; IHS/SD/lwj 8/28/02 NCPDP 5.1 changes
"RTN","BPSECFM",10,0)
 ;  Added a new subroutine to translate the rejection code
"RTN","BPSECFM",11,0)
 ;  Added a new subroutine to translate the reason for service code
"RTN","BPSECFM",12,0)
 ;  Used for AdvancePCS certification process
"RTN","BPSECFM",13,0)
 ;--------------------------------------------------------
"RTN","BPSECFM",14,0)
 ;Numeric Format Function
"RTN","BPSECFM",15,0)
NFF(X,L) ;EP -
"RTN","BPSECFM",16,0)
 Q $E($TR($J("",L-$L(X))," ","0")_X,1,L)
"RTN","BPSECFM",17,0)
 ;----------------------------------------------------------------------
"RTN","BPSECFM",18,0)
 ;Signed Numeric Field Format
"RTN","BPSECFM",19,0)
DFF(X,L) ;
"RTN","BPSECFM",20,0)
 N FNUMBER,DOLLAR,CENTS,SVALUE
"RTN","BPSECFM",21,0)
 Q:X="" $TR($J("",L)," ","0")
"RTN","BPSECFM",22,0)
 S DOLLAR=+$TR($P(X,".",1),"-","")
"RTN","BPSECFM",23,0)
 S CENTS=$E($P(X,".",2),1,2)
"RTN","BPSECFM",24,0)
 S:$L(CENTS)=0 CENTS="00"
"RTN","BPSECFM",25,0)
 S:$L(CENTS)=1 CENTS=CENTS_"0"
"RTN","BPSECFM",26,0)
 S SVALUE=$S(X<0:"}JKLMNOPQR",1:"{ABCDEFGHI")
"RTN","BPSECFM",27,0)
 S $E(CENTS,2)=$E(SVALUE,$E(CENTS,2)+1)
"RTN","BPSECFM",28,0)
 Q $E($TR($J("",L-$L(DOLLAR_CENTS))," ","0")_DOLLAR_CENTS,1,L)
"RTN","BPSECFM",29,0)
 ;----------------------------------------------------------------------
"RTN","BPSECFM",30,0)
 ;Converts Signed Numeric Field to Decimal Value
"RTN","BPSECFM",31,0)
DFF2EXT(X) ;EP -
"RTN","BPSECFM",32,0)
 N LCHAR
"RTN","BPSECFM",33,0)
 S LCHAR=$E(X,$L(X))
"RTN","BPSECFM",34,0)
 S X=$TR(X,"{ABCDEFGHI","0123456789")
"RTN","BPSECFM",35,0)
 S X=$TR(X,"}JKLMNOPQR","0123456789")
"RTN","BPSECFM",36,0)
 S X=X*.01
"RTN","BPSECFM",37,0)
 I "}JKLMNOPQR"[LCHAR S X=X*-1
"RTN","BPSECFM",38,0)
 Q $J(+X,$L(+X),2)
"RTN","BPSECFM",39,0)
 ;----------------------------------------------------------------------
"RTN","BPSECFM",40,0)
 ;Alpha-Numeric Field Format
"RTN","BPSECFM",41,0)
ANFF(X,L) ;EP
"RTN","BPSECFM",42,0)
 Q $E(X_$J("",L-$L(X)),1,L)
"RTN","BPSECFM",43,0)
 ;----------------------------------------------------------------------
"RTN","BPSECFM",44,0)
 ;Numerics Field Format
"RTN","BPSECFM",45,0)
 ; DUPLICATE TAGS!   commented out this one
"RTN","BPSECFM",46,0)
 ; The other one appears to zero fill.
"RTN","BPSECFM",47,0)
 ; NFF(X,L)
"RTN","BPSECFM",48,0)
 ; Q $E(X_$J("",L-$L(X)),1,L)
"RTN","BPSECFM",49,0)
 ;----------------------------------------------------------------------
"RTN","BPSECFM",50,0)
 ;Convert FileManager date into CCYYMMDD format
"RTN","BPSECFM",51,0)
DTF1(X) ;EP -
"RTN","BPSECFM",52,0)
 N Y,%DT
"RTN","BPSECFM",53,0)
 ;Q:X'["." X
"RTN","BPSECFM",54,0)
 S X=$P(X,".",1)
"RTN","BPSECFM",55,0)
 Q:X="" "00000000"
"RTN","BPSECFM",56,0)
 S Y=X D DD^%DT
"RTN","BPSECFM",57,0)
 S X=Y,%DT="X" D ^%DT
"RTN","BPSECFM",58,0)
 Q:Y=-1 "00000000"
"RTN","BPSECFM",59,0)
 S X=Y+17000000
"RTN","BPSECFM",60,0)
 Q X
"RTN","BPSECFM",61,0)
 ;----------------------------------------------------------------------
"RTN","BPSECFM",62,0)
 ;Reformats NDC number
"RTN","BPSECFM",63,0)
NDCF(X) ;EP -
"RTN","BPSECFM",64,0)
 S X=$TR(X,"-","")
"RTN","BPSECFM",65,0)
 I X?11N Q X                                 ; no reformatting needed
"RTN","BPSECFM",66,0)
 I $L(X)<11 F I=1:1:(11-$L(X)) S X="0"_X
"RTN","BPSECFM",67,0)
 I $L(X)>11 S X=$E(X,2,12)
"RTN","BPSECFM",68,0)
 S X=$E(X,1,5)_"-"_$E(X,6,9)_"-"_$E(X,10,11)
"RTN","BPSECFM",69,0)
 N Y,I
"RTN","BPSECFM",70,0)
 F I=1:1:3 S Y(I)=$P(X,"-",I)
"RTN","BPSECFM",71,0)
 S X=$$RJZF(Y(1),5)_$$RJZF(Y(2),4)_$$RJZF(Y(3),2)
"RTN","BPSECFM",72,0)
 Q X
"RTN","BPSECFM",73,0)
 ;----------------------------------------------------------------------
"RTN","BPSECFM",74,0)
 ;Right justify and zero fill X in a string of length L
"RTN","BPSECFM",75,0)
RJZF(X,L) ;
"RTN","BPSECFM",76,0)
 I $L(X)<L Q $E($TR($J("",L-$L(X))," ","0")_X,1,L)
"RTN","BPSECFM",77,0)
 Q $E(X,$L(X)-L+1,$L(X))
"RTN","BPSECFM",78,0)
 ;----------------------------------------------------------------------
"RTN","BPSECFM",79,0)
 ;Right justify and blank fill X in a string of length L
"RTN","BPSECFM",80,0)
RJBF(X,L) ;EP -
"RTN","BPSECFM",81,0)
 Q $E($J("",L-$L(X))_X,1,L)
"RTN","BPSECFM",82,0)
 ;----------------------------------------------------------------------
"RTN","BPSECFM",83,0)
 ;STRIP TEXT of all non-numerics
"RTN","BPSECFM",84,0)
STRIPN(TEXT) ;
"RTN","BPSECFM",85,0)
 N NUM,I,CH
"RTN","BPSECFM",86,0)
 S NUM=""
"RTN","BPSECFM",87,0)
 F I=1:1:$L(TEXT) D
"RTN","BPSECFM",88,0)
 .S CH=$E(TEXT,I,I)
"RTN","BPSECFM",89,0)
 .S:CH?1N NUM=NUM_CH
"RTN","BPSECFM",90,0)
 Q NUM
"RTN","BPSECFM",91,0)
 ;----------------------------------------------------------------------
"RTN","BPSECFM",92,0)
 ;IHS/SD/lwj 8/28/02  NCPDP 5.1 changes
"RTN","BPSECFM",93,0)
 ; For the certification process with AdvancePCS, they require that the
"RTN","BPSECFM",94,0)
 ; reject explanation appear with the rejection code.  The following
"RTN","BPSECFM",95,0)
 ; Additionally, they require that within the DUR segment, the
"RTN","BPSECFM",96,0)
 ; description for the reason for service code also appear (fld 439).
"RTN","BPSECFM",97,0)
 ; To accomodate this requirement, the following subroutines were
"RTN","BPSECFM",98,0)
 ; created to act as an output transform for the reject codes and the
"RTN","BPSECFM",99,0)
 ; reason for service code.  These routine will not currently be used
"RTN","BPSECFM",100,0)
 ; any where else, but will be kept in the software in case they are
"RTN","BPSECFM",101,0)
 ; needed.
"RTN","BPSECFM",102,0)
 ;
"RTN","BPSECFM",103,0)
TRANREJ(REJCD) ;EP - REJCD will be the incoming rejection code
"RTN","BPSECFM",104,0)
 ;
"RTN","BPSECFM",105,0)
 I $G(REJCD)="" Q ""
"RTN","BPSECFM",106,0)
 N REJECT,REJIEN
"RTN","BPSECFM",107,0)
 ;
"RTN","BPSECFM",108,0)
 S REJIEN=0
"RTN","BPSECFM",109,0)
 S REJIEN=$O(^BPSF(9002313.93,"B",REJCD,REJIEN))  ;find record
"RTN","BPSECFM",110,0)
 I REJIEN S REJECT=$P($G(^BPSF(9002313.93,REJIEN,0)),U,2)
"RTN","BPSECFM",111,0)
 E  S REJECT="Description not found for rejection code"
"RTN","BPSECFM",112,0)
 S REJECT=REJCD_" ("_REJECT_")"
"RTN","BPSECFM",113,0)
 S REJECT=$$ANFF(REJECT,50)
"RTN","BPSECFM",114,0)
 ;
"RTN","BPSECFM",115,0)
 Q REJECT
"RTN","BPSECFM",116,0)
 ;----------------------------------------------------------------------
"RTN","BPSECFM",117,0)
TRANSCD(SRVCD) ;EP - SRCCD will be the incoming reason for service code
"RTN","BPSECFM",118,0)
 ;
"RTN","BPSECFM",119,0)
 N SCDIEN,SCDESC
"RTN","BPSECFM",120,0)
 ;
"RTN","BPSECFM",121,0)
 S SCDIEN=0
"RTN","BPSECFM",122,0)
 S SRVCD=$E(SRVCD,1,2)
"RTN","BPSECFM",123,0)
 S:$G(SRVCD)'="" SCDIEN=$O(^BPS(9002313.23,"B",SRVCD,SCDIEN))  ;find record
"RTN","BPSECFM",124,0)
 S:$G(SCDIEN) SCDESC=$P($G(^BPS(9002313.23,SCDIEN,0)),U,2)
"RTN","BPSECFM",125,0)
 S:$G(SCDESC)="" SCDESC="Description not found for service code"
"RTN","BPSECFM",126,0)
 S SCDESC=SRVCD_" ("_SCDESC_" )"
"RTN","BPSECFM",127,0)
 S SCDESC=$$ANFF(SCDESC,50)
"RTN","BPSECFM",128,0)
 ;
"RTN","BPSECFM",129,0)
 Q SCDESC
"RTN","BPSECFM",130,0)
 ;----------------------------------------------------------------------
"RTN","BPSECMP2")
0^92^B65381768
"RTN","BPSECMP2",1,0)
BPSECMP2 ;BHAM ISC/FCS/DRS - Parse Claim Response ;11/14/07  13:23
"RTN","BPSECMP2",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5,6,7**;JUN 2004;Build 46
"RTN","BPSECMP2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSECMP2",4,0)
 ;Reference to STORESP^IBNCPDP supported by DBIA 4299
"RTN","BPSECMP2",5,0)
 Q
"RTN","BPSECMP2",6,0)
 ; Parameters:
"RTN","BPSECMP2",7,0)
 ;    CLAIMIEN: IEN from BPS Claims
"RTN","BPSECMP2",8,0)
 ;    RESPIEN:  IEN from BPS Response
"RTN","BPSECMP2",9,0)
 ;    EVENT:    This is used by PSO to create specific events (BILL).
"RTN","BPSECMP2",10,0)
 ;    USER:     User who is creating the event.  This is required when EVENT is sent.
"RTN","BPSECMP2",11,0)
IBSEND(CLAIMIEN,RESPIEN,EVENT,USER) ;
"RTN","BPSECMP2",12,0)
 N BPSARRY,RXIEN,FILLNUM,IND,TRNDX,RELDATE,X,Y,%DT
"RTN","BPSECMP2",13,0)
 N CLAIMNFO,RESPNFO,RXINFO,RFINFO,TRANINFO
"RTN","BPSECMP2",14,0)
 N RESPONSE,RXACT,CLREAS,BILLNUM,DFN,REQCLAIM
"RTN","BPSECMP2",15,0)
 N DIE,DA,DR
"RTN","BPSECMP2",16,0)
 ;
"RTN","BPSECMP2",17,0)
 ; Quit if there is not a Response or Claim IEN
"RTN","BPSECMP2",18,0)
 I '$G(RESPIEN) Q
"RTN","BPSECMP2",19,0)
 I '$G(CLAIMIEN) Q
"RTN","BPSECMP2",20,0)
 ;
"RTN","BPSECMP2",21,0)
 ; Get Claims and Response Data
"RTN","BPSECMP2",22,0)
 D GETS^DIQ("9002313.02",CLAIMIEN,"103;400*;401;402;403;426","","CLAIMNFO")
"RTN","BPSECMP2",23,0)
 D GETS^DIQ("9002313.0301","1,"_RESPIEN,"112;503;509;518","I","RESPNFO")
"RTN","BPSECMP2",24,0)
 ;
"RTN","BPSECMP2",25,0)
 ; Get the Transaction IEN and Data
"RTN","BPSECMP2",26,0)
 S IND=$S(CLAIMNFO("9002313.02",CLAIMIEN_",","103")="B2":"AER",1:"AE")
"RTN","BPSECMP2",27,0)
 S TRNDX=$O(^BPST(IND,CLAIMIEN,""))
"RTN","BPSECMP2",28,0)
 I TRNDX="" Q
"RTN","BPSECMP2",29,0)
 D GETS^DIQ("9002313.59",TRNDX,"3;13;404;501;1201","I","TRANINFO")
"RTN","BPSECMP2",30,0)
 ;
"RTN","BPSECMP2",31,0)
 ; Determine Prescription IEN
"RTN","BPSECMP2",32,0)
 S RXIEN=$P(^BPSC(CLAIMIEN,400,1,0),"^",5)
"RTN","BPSECMP2",33,0)
 ;
"RTN","BPSECMP2",34,0)
 ; If Certify Mode is On, don't send to IB
"RTN","BPSECMP2",35,0)
 I $$GET1^DIQ(9002313.59902,"1,"_TRNDX_",","902.22")["MODE ON" Q
"RTN","BPSECMP2",36,0)
 ;
"RTN","BPSECMP2",37,0)
 ; Testing for Certification Only - DLF
"RTN","BPSECMP2",38,0)
 I $$RXAPI1^BPSUTIL1(RXIEN,.01)="" Q
"RTN","BPSECMP2",39,0)
 ;
"RTN","BPSECMP2",40,0)
 ; Store RXACT into a local variable as it is will be used a lot
"RTN","BPSECMP2",41,0)
 S RXACT=TRANINFO("9002313.59",TRNDX_",",1201,"I")
"RTN","BPSECMP2",42,0)
 ;
"RTN","BPSECMP2",43,0)
 ; Setup User data
"RTN","BPSECMP2",44,0)
 ; If event is passed in, the user should be passed in as well
"RTN","BPSECMP2",45,0)
 ; If no Event, but action is Auto-Reversal (AREV) or CMOP (CR*/PC/RL),
"RTN","BPSECMP2",46,0)
 ;     user postmaster (.5)
"RTN","BPSECMP2",47,0)
 ; Else use the user from BPS Transaction
"RTN","BPSECMP2",48,0)
 I EVENT]"" S BPSARRY("USER")=USER
"RTN","BPSECMP2",49,0)
 E  I ",AREV,CRLB,CRLX,CRLR,PC,RL,"[(","_RXACT_",") S BPSARRY("USER")=.5
"RTN","BPSECMP2",50,0)
 E  S BPSARRY("USER")=TRANINFO("9002313.59",TRNDX_",",13,"I")
"RTN","BPSECMP2",51,0)
 ;
"RTN","BPSECMP2",52,0)
 ; Determine Payer Response
"RTN","BPSECMP2",53,0)
 ; Treat Duplicate of Accepted Reversal ("S") as accepted
"RTN","BPSECMP2",54,0)
 S RESPONSE=RESPNFO(9002313.0301,"1,"_RESPIEN_",",112,"I")
"RTN","BPSECMP2",55,0)
 S RESPONSE=$S(RESPONSE="A":"ACCEPTED",RESPONSE="C":"CAPTURED",RESPONSE="D":"DUPLICATE",RESPONSE="P":"PAYABLE",RESPONSE="R":"REJECTED",RESPONSE="S":"ACCEPTED",1:"OTHER")
"RTN","BPSECMP2",56,0)
 ;
"RTN","BPSECMP2",57,0)
 ; Get Prescription Information
"RTN","BPSECMP2",58,0)
 D RXAPI^BPSUTIL1(RXIEN,".01;4;6;8;16;27","RXINFO","IE")
"RTN","BPSECMP2",59,0)
 ;
"RTN","BPSECMP2",60,0)
 ; Get Refill Info if this is a refill
"RTN","BPSECMP2",61,0)
 S FILLNUM=+$E($P(TRNDX,".",2),1,4)
"RTN","BPSECMP2",62,0)
 I FILLNUM>0 D RXSUBF^BPSUTIL1(RXIEN,52,52.1,FILLNUM,".01;1.1;11","RFINFO","E")
"RTN","BPSECMP2",63,0)
 ;
"RTN","BPSECMP2",64,0)
 ; Fill Date
"RTN","BPSECMP2",65,0)
 S BPSARRY("FILL DATE")=CLAIMNFO("9002313.0201","1,"_CLAIMIEN_",","401")
"RTN","BPSECMP2",66,0)
 S %DT="X",X=BPSARRY("FILL DATE") D ^%DT S:Y'=-1 BPSARRY("FILL DATE")=Y
"RTN","BPSECMP2",67,0)
 ;
"RTN","BPSECMP2",68,0)
 ; Information needed for PAID/BILLING event
"RTN","BPSECMP2",69,0)
 S BPSARRY("PAID")=0
"RTN","BPSECMP2",70,0)
 I RESPONSE="PAYABLE" D
"RTN","BPSECMP2",71,0)
 . S BPSARRY("PAID")=$$DFF2EXT^BPSECFM(RESPNFO(9002313.0301,"1,"_RESPIEN_",",509,"I"))
"RTN","BPSECMP2",72,0)
 . S BPSARRY("COPAY")=$$DFF2EXT^BPSECFM(RESPNFO(9002313.0301,"1,"_RESPIEN_",",518,"I"))
"RTN","BPSECMP2",73,0)
 . S BPSARRY("AUTH #")=RESPNFO(9002313.0301,"1,"_RESPIEN_",",503,"I")
"RTN","BPSECMP2",74,0)
 . S BPSARRY("RX NO")=RXINFO(52,RXIEN,.01,"E")
"RTN","BPSECMP2",75,0)
 . S BPSARRY("DRUG")=$$RXAPI1^BPSUTIL1(RXIEN,6,"I")
"RTN","BPSECMP2",76,0)
 . S BPSARRY("QTY")=$G(TRANINFO(9002313.59,TRNDX_",",501,"I"))
"RTN","BPSECMP2",77,0)
 . I FILLNUM<1  D
"RTN","BPSECMP2",78,0)
 .. S BPSARRY("DAYS SUPPLY")=RXINFO(52,RXIEN,8,"E")
"RTN","BPSECMP2",79,0)
 . E  D
"RTN","BPSECMP2",80,0)
 .. S BPSARRY("DAYS SUPPLY")=$G(RFINFO(52.1,FILLNUM,1.1,"E"))
"RTN","BPSECMP2",81,0)
 ;
"RTN","BPSECMP2",82,0)
 ; Get Plan info
"RTN","BPSECMP2",83,0)
 I $D(^BPST(TRNDX,10,1,0)) S BPSARRY("PLAN")=$P(^BPST(TRNDX,10,1,0),"^")
"RTN","BPSECMP2",84,0)
 ;
"RTN","BPSECMP2",85,0)
 ; Setup miscellaneous values
"RTN","BPSECMP2",86,0)
 S DFN=$$RXAPI1^BPSUTIL1(RXIEN,2,"I")
"RTN","BPSECMP2",87,0)
 S BPSARRY("NDC")=$$GETNDC^PSONDCUT(RXIEN,FILLNUM)
"RTN","BPSECMP2",88,0)
 S BPSARRY("FILL NUMBER")=FILLNUM
"RTN","BPSECMP2",89,0)
 S BPSARRY("FILLED BY")=RXINFO(52,RXIEN,16,"I")
"RTN","BPSECMP2",90,0)
 S BPSARRY("PRESCRIPTION")=RXIEN
"RTN","BPSECMP2",91,0)
 S BPSARRY("BILLED")=$P(CLAIMNFO("9002313.0201","1,"_CLAIMIEN_",","426"),"DQ",2)
"RTN","BPSECMP2",92,0)
 S BPSARRY("BILLED")=$$DFF2EXT^BPSECFM(BPSARRY("BILLED"))
"RTN","BPSECMP2",93,0)
 S BPSARRY("CLAIMID")=$P(CLAIMNFO("9002313.0201","1,"_CLAIMIEN_",","402"),"D2",2)
"RTN","BPSECMP2",94,0)
 S RELDATE=$S(FILLNUM=0:$$RXAPI1^BPSUTIL1(RXIEN,31,"I"),1:$$RXSUBF1^BPSUTIL1(RXIEN,52,52.1,FILLNUM,17,"I"))
"RTN","BPSECMP2",95,0)
 S BPSARRY("RELEASE DATE")=$P(RELDATE,".")
"RTN","BPSECMP2",96,0)
 S BPSARRY("RESPONSE")=RESPONSE
"RTN","BPSECMP2",97,0)
 S BPSARRY("EPHARM")=$$GET1^DIQ(9002313.59,TRNDX,1.07,"I")
"RTN","BPSECMP2",98,0)
 ;
"RTN","BPSECMP2",99,0)
 ; For reversals, get reversal reason and check for closed reason
"RTN","BPSECMP2",100,0)
 ; Call IB with Reversal Event
"RTN","BPSECMP2",101,0)
 ; If there is a close reason, call IB with CLOSE event
"RTN","BPSECMP2",102,0)
 ;    and update BPS Claim with close information
"RTN","BPSECMP2",103,0)
 I EVENT="",$$ISREVERS^BPSOSU(CLAIMIEN) D  Q
"RTN","BPSECMP2",104,0)
 . S REQCLAIM=TRANINFO("9002313.59",TRNDX_",",3,"I")
"RTN","BPSECMP2",105,0)
 . S BPSARRY("REVERSAL REASON")=TRANINFO("9002313.59",TRNDX_",",404,"I")
"RTN","BPSECMP2",106,0)
 . S BPSARRY("RTS-DEL")=0
"RTN","BPSECMP2",107,0)
 . ; Get RX action, which determine close event
"RTN","BPSECMP2",108,0)
 . I RXACT="RS" S CLREAS="PRESCRIPTION NOT RELEASED",BPSARRY("RTS-DEL")=1
"RTN","BPSECMP2",109,0)
 . I RXACT="DE" D
"RTN","BPSECMP2",110,0)
 . . S CLREAS="PRESCRIPTION DELETED",BPSARRY("RTS-DEL")=1
"RTN","BPSECMP2",111,0)
 . . ; check whether RX was in fact deleted in Pharmacy
"RTN","BPSECMP2",112,0)
 . . ; if not then the refill was deleted
"RTN","BPSECMP2",113,0)
 . . I $$RXSTATUS^BPSSCRU2(RXIEN)'=13 S BPSARRY("CLOSE COMMENT")="DELETION OF REFILL ONLY - ORIGINAL RX MAY REMAIN ACTIVE"
"RTN","BPSECMP2",114,0)
 . ; If accepted inpatient autoreversal, then close the claim
"RTN","BPSECMP2",115,0)
 . I RXACT="AREV",RESPONSE="ACCEPTED",REQCLAIM,$P($G(^BPSC(REQCLAIM,0)),U,7)=2 D
"RTN","BPSECMP2",116,0)
 .. S CLREAS="OTHER",BPSARRY("CLOSE COMMENT")="INPATIENT PRESCRIPTION"
"RTN","BPSECMP2",117,0)
 . I $D(CLREAS) S BPSARRY("CLOSE REASON")=$O(^IBE(356.8,"B",CLREAS,0))
"RTN","BPSECMP2",118,0)
 . ;
"RTN","BPSECMP2",119,0)
 . ; Call IB for Reversal Event
"RTN","BPSECMP2",120,0)
 . S BPSARRY("STATUS")="REVERSED",BILLNUM=$$STORESP^IBNCPDP(DFN,.BPSARRY)
"RTN","BPSECMP2",121,0)
 . ; If there is no close reason, quit
"RTN","BPSECMP2",122,0)
 . I '$D(BPSARRY("CLOSE REASON")) Q
"RTN","BPSECMP2",123,0)
 . ; Call IB for CLOSE event
"RTN","BPSECMP2",124,0)
 . ;  Note for close, user is always postmaster (.5)
"RTN","BPSECMP2",125,0)
 . S BPSARRY("STATUS")="CLOSED",BPSARRY("USER")=.5
"RTN","BPSECMP2",126,0)
 . S BILLNUM=$$STORESP^IBNCPDP(DFN,.BPSARRY)
"RTN","BPSECMP2",127,0)
 . ;
"RTN","BPSECMP2",128,0)
 . ; Populate the original claim request with the close reason
"RTN","BPSECMP2",129,0)
 . I REQCLAIM D
"RTN","BPSECMP2",130,0)
 .. S DIE="^BPSC(",DA=REQCLAIM
"RTN","BPSECMP2",131,0)
 .. S DR="901///1;902///"_$$NOW^XLFDT()_";903////.5;904///"_BPSARRY("CLOSE REASON")
"RTN","BPSECMP2",132,0)
 .. D ^DIE
"RTN","BPSECMP2",133,0)
 ;
"RTN","BPSECMP2",134,0)
 ; If we got here, then it is not a reversal
"RTN","BPSECMP2",135,0)
 ; If EVENT is set, send Submit event
"RTN","BPSECMP2",136,0)
 I EVENT="" S BPSARRY("STATUS")="SUBMITTED",BILLNUM=$$STORESP^IBNCPDP(DFN,.BPSARRY)
"RTN","BPSECMP2",137,0)
 ;
"RTN","BPSECMP2",138,0)
 ; Sent Paid (Billable) event is the claim was paid and released or EVENT is BILL
"RTN","BPSECMP2",139,0)
 ;   Note: User is always postmaster except for BackBilling (BB)
"RTN","BPSECMP2",140,0)
 I EVENT="BILL"!(RESPONSE="PAYABLE"&(BPSARRY("RELEASE DATE")]"")) D
"RTN","BPSECMP2",141,0)
 . I RXACT'="BB" S BPSARRY("USER")=.5
"RTN","BPSECMP2",142,0)
 . S BPSARRY("STATUS")="PAID",BILLNUM=$$STORESP^IBNCPDP(DFN,.BPSARRY)
"RTN","BPSECMP2",143,0)
 Q
"RTN","BPSECMP2",144,0)
 ;
"RTN","BPSECMP2",145,0)
 ; Synch DURs between ECME and PSO
"RTN","BPSECMP2",146,0)
 ; Parameters:
"RTN","BPSECMP2",147,0)
 ;   IEN59 is the BPS Transaction IEN
"RTN","BPSECMP2",148,0)
DURSYNC(IEN59) ;
"RTN","BPSECMP2",149,0)
 N RXIEN,RXFILL
"RTN","BPSECMP2",150,0)
 ;
"RTN","BPSECMP2",151,0)
 ; Check Parameter
"RTN","BPSECMP2",152,0)
 I IEN59="" Q
"RTN","BPSECMP2",153,0)
 ;
"RTN","BPSECMP2",154,0)
 ; Get Prescription and Fill number
"RTN","BPSECMP2",155,0)
 S RXIEN=$$GET1^DIQ(9002313.59,IEN59_",",1.11,"I")
"RTN","BPSECMP2",156,0)
 S RXFILL=$$GET1^DIQ(9002313.59902,"1,"_IEN59_",",902.17,"E")
"RTN","BPSECMP2",157,0)
 I RXIEN=""!(RXFILL="") Q
"RTN","BPSECMP2",158,0)
 ;
"RTN","BPSECMP2",159,0)
 ; Call PSO to sync reject codes
"RTN","BPSECMP2",160,0)
 D SYNC^PSOREJUT(RXIEN,RXFILL,"")
"RTN","BPSECMP2",161,0)
 Q
"RTN","BPSECMP2",162,0)
 ;
"RTN","BPSECMP2",163,0)
PROCOTH ;
"RTN","BPSECMP2",164,0)
 Q:$G(FDATA(TRANSACT,563.01,1))=""
"RTN","BPSECMP2",165,0)
 N NNDX,FILE,ROOT,FDATA3,FLDNUM
"RTN","BPSECMP2",166,0)
 S FILE="9002313.1401"
"RTN","BPSECMP2",167,0)
 S ROOT="FDATA3(9002313.1401)"
"RTN","BPSECMP2",168,0)
 S NNDX=""
"RTN","BPSECMP2",169,0)
 F  S NNDX=$O(FDATA(FDAIEN(TRANSACT),563.01,NNDX)) Q:NNDX=""  D
"RTN","BPSECMP2",170,0)
 .S FLDNUM=".01" D FDA^DILF(FILE,"+"_NNDX_","_FDAIEN03(TRANSACT)_","_FDAIEN(TRANSACT),FLDNUM,"",FDATA(TRANSACT,563.01,NNDX),ROOT)
"RTN","BPSECMP2",171,0)
 D UPDATE^DIE("S","FDATA3(9002313.1401)")
"RTN","BPSECMP2",172,0)
 Q
"RTN","BPSECMP2",173,0)
PROCDUR ;
"RTN","BPSECMP2",174,0)
 Q:$G(FDATA(TRANSACT,567,1))=""
"RTN","BPSECMP2",175,0)
 N NNDX,FILE,ROOT,FDAT1101,FLDNUM
"RTN","BPSECMP2",176,0)
 S FILE="9002313.1101"
"RTN","BPSECMP2",177,0)
 S ROOT="FDAT1101(9002313.1101)"
"RTN","BPSECMP2",178,0)
 S NNDX=""
"RTN","BPSECMP2",179,0)
 F  S NNDX=$O(FDATA(TRANSACT,567,NNDX)) Q:NNDX=""  D
"RTN","BPSECMP2",180,0)
 .S FLDNUM=".01" D FDA^DILF(FILE,"+"_NNDX_","_FDAIEN03(TRANSACT)_","_FDAIEN(TRANSACT),FLDNUM,"",FDATA(TRANSACT,567,NNDX),ROOT)
"RTN","BPSECMP2",181,0)
 .I $D(FDATA(TRANSACT,439,NNDX))  D
"RTN","BPSECMP2",182,0)
 ..S FLDNUM="439"
"RTN","BPSECMP2",183,0)
 ..D FDA^DILF(FILE,"+"_NNDX_","_FDAIEN03(TRANSACT)_","_FDAIEN(TRANSACT),FLDNUM,"",FDATA(TRANSACT,439,NNDX),ROOT)
"RTN","BPSECMP2",184,0)
 .I $D(FDATA(TRANSACT,528,NNDX))  D
"RTN","BPSECMP2",185,0)
 ..S FLDNUM="528"
"RTN","BPSECMP2",186,0)
 ..D FDA^DILF(FILE,"+"_NNDX_","_FDAIEN03(TRANSACT)_","_FDAIEN(TRANSACT),FLDNUM,"",FDATA(TRANSACT,528,NNDX),ROOT)
"RTN","BPSECMP2",187,0)
 .I $D(FDATA(TRANSACT,529,NNDX))  D
"RTN","BPSECMP2",188,0)
 ..S FLDNUM="529"
"RTN","BPSECMP2",189,0)
 ..D FDA^DILF(FILE,"+"_NNDX_","_FDAIEN03(TRANSACT)_","_FDAIEN(TRANSACT),FLDNUM,"",FDATA(TRANSACT,529,NNDX),ROOT)
"RTN","BPSECMP2",190,0)
 .I $D(FDATA(TRANSACT,530,NNDX))  D
"RTN","BPSECMP2",191,0)
 ..S FLDNUM="530"
"RTN","BPSECMP2",192,0)
 ..D FDA^DILF(FILE,"+"_NNDX_","_FDAIEN03(TRANSACT)_","_FDAIEN(TRANSACT),FLDNUM,"",FDATA(TRANSACT,530,NNDX),ROOT)
"RTN","BPSECMP2",193,0)
 .I $D(FDATA(TRANSACT,531,NNDX))  D
"RTN","BPSECMP2",194,0)
 ..S FLDNUM="531"
"RTN","BPSECMP2",195,0)
 ..D FDA^DILF(FILE,"+"_NNDX_","_FDAIEN03(TRANSACT)_","_FDAIEN(TRANSACT),FLDNUM,"",FDATA(TRANSACT,531,NNDX),ROOT)
"RTN","BPSECMP2",196,0)
 .I $D(FDATA(TRANSACT,532,NNDX))  D
"RTN","BPSECMP2",197,0)
 ..S FLDNUM="532"
"RTN","BPSECMP2",198,0)
 ..D FDA^DILF(FILE,"+"_NNDX_","_FDAIEN03(TRANSACT)_","_FDAIEN(TRANSACT),FLDNUM,"",FDATA(TRANSACT,532,NNDX),ROOT)
"RTN","BPSECMP2",199,0)
 .I $D(FDATA(TRANSACT,533,NNDX))  D
"RTN","BPSECMP2",200,0)
 ..S FLDNUM="533"
"RTN","BPSECMP2",201,0)
 ..D FDA^DILF(FILE,"+"_NNDX_","_FDAIEN03(TRANSACT)_","_FDAIEN(TRANSACT),FLDNUM,"",FDATA(TRANSACT,533,NNDX),ROOT)
"RTN","BPSECMP2",202,0)
 .I $D(FDATA(TRANSACT,544,NNDX)) D
"RTN","BPSECMP2",203,0)
 ..S FLDNUM="544"
"RTN","BPSECMP2",204,0)
 ..D FDA^DILF(FILE,"+"_NNDX_","_FDAIEN03(TRANSACT)_","_FDAIEN(TRANSACT),FLDNUM,"",FDATA(TRANSACT,544,NNDX),ROOT)
"RTN","BPSECMP2",205,0)
 D UPDATE^DIE("S","FDAT1101(9002313.1101)")
"RTN","BPSECMP2",206,0)
 Q
"RTN","BPSECMPS")
0^57^B75418064
"RTN","BPSECMPS",1,0)
BPSECMPS ;BHAM ISC/FCS/DRS - Parse Claim Response ;3/10/08  12:31
"RTN","BPSECMPS",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,2,5,6,7**;JUN 2004;Build 46
"RTN","BPSECMPS",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSECMPS",4,0)
 ;
"RTN","BPSECMPS",5,0)
PARSE(RREC,CLAIMIEN,RESPIEN) ;
"RTN","BPSECMPS",6,0)
 N GS,FS,SS,FILE,ROOT,TRANSACT,TRANSCNT
"RTN","BPSECMPS",7,0)
 N FDATA,FDAIEN,FDAIEN03
"RTN","BPSECMPS",8,0)
 ;
"RTN","BPSECMPS",9,0)
 ;Make sure input variables are defined
"RTN","BPSECMPS",10,0)
 Q:$G(RREC)=""
"RTN","BPSECMPS",11,0)
 Q:$G(CLAIMIEN)=""
"RTN","BPSECMPS",12,0)
 ;
"RTN","BPSECMPS",13,0)
 ;group and field separator characters
"RTN","BPSECMPS",14,0)
 S GS="\X1D\",FS="\X1C\",SS="\X1E\"
"RTN","BPSECMPS",15,0)
 S FILE="9002313.03"
"RTN","BPSECMPS",16,0)
 S ROOT="FDATA(9002313.03)"
"RTN","BPSECMPS",17,0)
 D TRANSMSN            ;process the transmission level data
"RTN","BPSECMPS",18,0)
 D TRANSACT            ;process the transaction level data
"RTN","BPSECMPS",19,0)
 ;
"RTN","BPSECMPS",20,0)
 ; If test system and test active, call the override routine
"RTN","BPSECMPS",21,0)
 ; IEN59 and TRANTYPE are set in BPSECMC2
"RTN","BPSECMPS",22,0)
 ;
"RTN","BPSECMPS",23,0)
 I $$CHECK^BPSTEST D SETOVER^BPSTEST(IEN59,TRANTYPE,.FDATA)
"RTN","BPSECMPS",24,0)
 D UPDATE^DIE("S","FDATA(9002313.03)","FDAIEN")
"RTN","BPSECMPS",25,0)
 F TRANSACT=1:1:TRANSCNT  D
"RTN","BPSECMPS",26,0)
 .D PROCRESP
"RTN","BPSECMPS",27,0)
 .D PROCREJ
"RTN","BPSECMPS",28,0)
 .D PROCAPP
"RTN","BPSECMPS",29,0)
 .D PROCPPR
"RTN","BPSECMPS",30,0)
 .D PROCOTH^BPSECMP2
"RTN","BPSECMPS",31,0)
 .D PROCDUR^BPSECMP2
"RTN","BPSECMPS",32,0)
 .S RESPIEN=FDAIEN(TRANSACT)
"RTN","BPSECMPS",33,0)
 .D IBSEND^BPSECMP2(CLAIMIEN,RESPIEN,"","")
"RTN","BPSECMPS",34,0)
 D RAW(RESPIEN,RREC)
"RTN","BPSECMPS",35,0)
 Q
"RTN","BPSECMPS",36,0)
 ;
"RTN","BPSECMPS",37,0)
TRANSMSN ;This subroutine will work through the transmission level information
"RTN","BPSECMPS",38,0)
 ;
"RTN","BPSECMPS",39,0)
 N RTRANM,RHEADER,SEG,SEGMENT,SEGID
"RTN","BPSECMPS",40,0)
 ;
"RTN","BPSECMPS",41,0)
 ;Parse response transmission level from ascii record
"RTN","BPSECMPS",42,0)
 S RTRANM=$P(RREC,GS,1)
"RTN","BPSECMPS",43,0)
 ;
"RTN","BPSECMPS",44,0)
 ; get just the header segment
"RTN","BPSECMPS",45,0)
 S RHEADER=$P(RTRANM,SS,1)    ;header- required/fixed length
"RTN","BPSECMPS",46,0)
 D PARSEH
"RTN","BPSECMPS",47,0)
 ;
"RTN","BPSECMPS",48,0)
 ; There are 2 optional segments on the transmission level - message
"RTN","BPSECMPS",49,0)
 ; and insurance.  We'll check for both and parse what we find.
"RTN","BPSECMPS",50,0)
 F SEG=2:1:3 D
"RTN","BPSECMPS",51,0)
 . S SEGMENT=$P(RTRANM,SS,SEG)
"RTN","BPSECMPS",52,0)
 . Q:SEGMENT=""
"RTN","BPSECMPS",53,0)
 . S SEGID=$P(SEGMENT,FS,2)
"RTN","BPSECMPS",54,0)
 . I $E(SEGID,1,2)="AM" D                ;segment identification
"RTN","BPSECMPS",55,0)
 .. S SEGFID=$E(SEGID,3,4)
"RTN","BPSECMPS",56,0)
 .. D:(SEGFID=20)!(SEGFID=25) PARSETM
"RTN","BPSECMPS",57,0)
 ;
"RTN","BPSECMPS",58,0)
 Q
"RTN","BPSECMPS",59,0)
 ;
"RTN","BPSECMPS",60,0)
TRANSACT ;This subroutine will work through the transaction level information
"RTN","BPSECMPS",61,0)
 ;
"RTN","BPSECMPS",62,0)
 N RTRAN,SEG,SEGMENT,MEDN,GRP
"RTN","BPSECMPS",63,0)
 S MEDN=0
"RTN","BPSECMPS",64,0)
 ;
"RTN","BPSECMPS",65,0)
 F GRP=2:1 D  Q:RTRAN=""
"RTN","BPSECMPS",66,0)
 . S RTRAN=$P(RREC,GS,GRP)     ;get the next transaction (could be 4)
"RTN","BPSECMPS",67,0)
 . Q:RTRAN=""                  ;we're done if it's empty
"RTN","BPSECMPS",68,0)
 . S MEDN=MEDN+1               ;transaction counter
"RTN","BPSECMPS",69,0)
 . ;
"RTN","BPSECMPS",70,0)
 . F SEG=2:1 D  Q:SEGMENT=""   ;break the record down by segments
"RTN","BPSECMPS",71,0)
 .. S SEGMENT=$P(RTRAN,SS,SEG) ;get the segment
"RTN","BPSECMPS",72,0)
 .. Q:SEGMENT=""
"RTN","BPSECMPS",73,0)
 .. D PARSETN                  ;get the fields
"RTN","BPSECMPS",74,0)
 Q
"RTN","BPSECMPS",75,0)
 ;
"RTN","BPSECMPS",76,0)
PARSEH ; The header record is required on all responses, and is fixed
"RTN","BPSECMPS",77,0)
 ; length.  It is the only record that is fixed length.
"RTN","BPSECMPS",78,0)
 ;
"RTN","BPSECMPS",79,0)
 N FIELD,%,%H,%I
"RTN","BPSECMPS",80,0)
 S FIELD=".01" D FDA^DILF(FILE,"+1",FIELD,"",CLAIMIEN,ROOT)
"RTN","BPSECMPS",81,0)
 D NOW^%DTC
"RTN","BPSECMPS",82,0)
 S FIELD=".02" D FDA^DILF(FILE,"+1",FIELD,"",%,ROOT)
"RTN","BPSECMPS",83,0)
 S FIELD=".03" D FDA^DILF(FILE,"+1",FIELD,"",$H,ROOT)
"RTN","BPSECMPS",84,0)
 S FIELD=102 D FDA^DILF(FILE,"+1",FIELD,"",$E(RHEADER,33,34),ROOT)    ;version/release number
"RTN","BPSECMPS",85,0)
 S FIELD=103 D FDA^DILF(FILE,"+1",FIELD,"",$E(RHEADER,35,36),ROOT)    ;transaction code
"RTN","BPSECMPS",86,0)
 S FIELD=109 D FDA^DILF(FILE,"+1",FIELD,"",$E(RHEADER,37,37),ROOT)    ;transaction count
"RTN","BPSECMPS",87,0)
 S TRANSCNT=$E(RHEADER,37,37)
"RTN","BPSECMPS",88,0)
 S FIELD=501 D FDA^DILF(FILE,"+1",FIELD,"",$E(RHEADER,38,38),ROOT)    ;response status header
"RTN","BPSECMPS",89,0)
 S FIELD=202 D FDA^DILF(FILE,"+1",FIELD,"",$E(RHEADER,39,40),ROOT)    ;service provider id qualifier
"RTN","BPSECMPS",90,0)
 S FIELD=201 D FDA^DILF(FILE,"+1",FIELD,"",$E(RHEADER,41,55),ROOT)    ;service provider id
"RTN","BPSECMPS",91,0)
 S FIELD=401 D FDA^DILF(FILE,"+1",FIELD,"",$E(RHEADER,56,63),ROOT)    ;date of service
"RTN","BPSECMPS",92,0)
 Q
"RTN","BPSECMPS",93,0)
 ;
"RTN","BPSECMPS",94,0)
PARSETM ; This subroutine will parse the variable portions of the transmission
"RTN","BPSECMPS",95,0)
 ;
"RTN","BPSECMPS",96,0)
 N FIELD,PC,FLDNUM
"RTN","BPSECMPS",97,0)
 ;
"RTN","BPSECMPS",98,0)
 F PC=3:1 D  Q:FIELD=""        ;skip the seg id -already know its value
"RTN","BPSECMPS",99,0)
 . S FIELD=$P(SEGMENT,FS,PC)   ;piece through the record
"RTN","BPSECMPS",100,0)
 . Q:FIELD=""                  ;stop - we hit the end
"RTN","BPSECMPS",101,0)
 . S FLDNUM=$$GETNUM(FIELD)    ;get the field number used for storage
"RTN","BPSECMPS",102,0)
 . Q:FLDNUM=""                 ;shouldn't happen - but lets skip
"RTN","BPSECMPS",103,0)
 . S FIELD=$E(FIELD,3,999)
"RTN","BPSECMPS",104,0)
 . D FDA^DILF(FILE,"+1",FLDNUM,"",FIELD,ROOT)
"RTN","BPSECMPS",105,0)
 Q
"RTN","BPSECMPS",106,0)
 ;
"RTN","BPSECMPS",107,0)
PARSETN ; This subroutine will parse the transaction level segments. For
"RTN","BPSECMPS",108,0)
 ;
"RTN","BPSECMPS",109,0)
 ; Possible values of the SEGFID field:
"RTN","BPSECMPS",110,0)
 ;  21 = Response Status Segment
"RTN","BPSECMPS",111,0)
 ;  22 = Response Claim Segment
"RTN","BPSECMPS",112,0)
 ;  23 = Response Pricing Segment
"RTN","BPSECMPS",113,0)
 ;  24 = Response DUR/PPS Segment
"RTN","BPSECMPS",114,0)
 ;  26 = Response Prior Authorization Segment
"RTN","BPSECMPS",115,0)
 ;
"RTN","BPSECMPS",116,0)
 N FIELD,PC,FLDNUM,RPTFLD,RCNT,REPEAT
"RTN","BPSECMPS",117,0)
 N SEGID,SEGFID,CKRPT
"RTN","BPSECMPS",118,0)
 ;
"RTN","BPSECMPS",119,0)
 S RPTFLD=""
"RTN","BPSECMPS",120,0)
 S SEGID=$P(SEGMENT,FS,2)           ;this should be the segment id
"RTN","BPSECMPS",121,0)
 Q:SEGID=""                         ;don't process without a Seg id
"RTN","BPSECMPS",122,0)
 Q:$E(SEGID,1,2)'="AM"              ;don't know what we have - skip
"RTN","BPSECMPS",123,0)
 ;
"RTN","BPSECMPS",124,0)
 S SEGFID=$E(SEGID,3,4)             ;this should be the field ID
"RTN","BPSECMPS",125,0)
 ;
"RTN","BPSECMPS",126,0)
 ; setup the repeating flds based on the segment
"RTN","BPSECMPS",127,0)
 I SEGFID=21 D               ;status segment
"RTN","BPSECMPS",128,0)
 . S RPTFLD=",548,511,546,"
"RTN","BPSECMPS",129,0)
 . S (RCNT(548),RCNT(511),RCNT(546))=0
"RTN","BPSECMPS",130,0)
 ;
"RTN","BPSECMPS",131,0)
 I SEGFID=22 D                 ;claim segment
"RTN","BPSECMPS",132,0)
 . S RPTFLD=",552,553,554,555,556,"
"RTN","BPSECMPS",133,0)
 . S (RCNT(552),RCNT(553),RCNT(554),RCNT(555),RCNT(556))=0
"RTN","BPSECMPS",134,0)
 ;
"RTN","BPSECMPS",135,0)
 I SEGFID=23 D                ;pricing segment
"RTN","BPSECMPS",136,0)
 . S RPTFLD=",564,565,"
"RTN","BPSECMPS",137,0)
 . S (RCNT(564),RCNT(565))=0
"RTN","BPSECMPS",138,0)
 ;
"RTN","BPSECMPS",139,0)
 I SEGFID=24 D                ;DUR/PPS segment
"RTN","BPSECMPS",140,0)
 . S RPTFLD=",439,528,529,530,531,532,533,9002313,544,567,"
"RTN","BPSECMPS",141,0)
 . S (RCNT(439),RCNT(528),RCNT(529),RCNT(530),RCNT(531))=0
"RTN","BPSECMPS",142,0)
 . S (RCNT(532),RCNT(533),RCNT(9002313),RCNT(567))=0,RCNT(544)=0
"RTN","BPSECMPS",143,0)
 ;
"RTN","BPSECMPS",144,0)
 ; now lets parse out the fields
"RTN","BPSECMPS",145,0)
 ;
"RTN","BPSECMPS",146,0)
 F PC=3:1 D  Q:FIELD=""        ;skip the seg id -jump to the other flds
"RTN","BPSECMPS",147,0)
 . S FIELD=$P(SEGMENT,FS,PC)   ;piece through the record
"RTN","BPSECMPS",148,0)
 . Q:FIELD=""                  ;stop - we hit the end
"RTN","BPSECMPS",149,0)
 . S FLDNUM=$$GETNUM(FIELD)    ;get the field number used for storage
"RTN","BPSECMPS",150,0)
 . Q:FLDNUM=""                 ;shouldn't happen - but lets skip
"RTN","BPSECMPS",151,0)
 . S REPEAT=0                  ;for this segment, lets figure
"RTN","BPSECMPS",152,0)
 . S CKRPT=","_FLDNUM_","      ;out if the field is a repeating
"RTN","BPSECMPS",153,0)
 . S:RPTFLD[CKRPT REPEAT=1     ;field
"RTN","BPSECMPS",154,0)
 . ;
"RTN","BPSECMPS",155,0)
 . I REPEAT D                  ;if rptg, store with a counter
"RTN","BPSECMPS",156,0)
 .. S RCNT(FLDNUM)=$G(RCNT(FLDNUM))+1
"RTN","BPSECMPS",157,0)
 .. S FDATA(MEDN,FLDNUM,RCNT(FLDNUM))=$E(FIELD,3,$L(FIELD))
"RTN","BPSECMPS",158,0)
 . ;
"RTN","BPSECMPS",159,0)
 . I 'REPEAT D                 ;not rptg, store without counter
"RTN","BPSECMPS",160,0)
 .. S FDATA(MEDN,FLDNUM)=$E(FIELD,3,$L(FIELD))
"RTN","BPSECMPS",161,0)
 Q
"RTN","BPSECMPS",162,0)
 ;
"RTN","BPSECMPS",163,0)
GETNUM(FIELD) ; This routine will translate the field ID into a field number.
"RTN","BPSECMPS",164,0)
 ; We will use the NCPDP field Defs files, cross ref "D" to
"RTN","BPSECMPS",165,0)
 ; perform this translation.  (The field number is needed to store
"RTN","BPSECMPS",166,0)
 ; the data in the correct field within the response file.)
"RTN","BPSECMPS",167,0)
 ;
"RTN","BPSECMPS",168,0)
 N FLDID,FLDIEN,FLDNUM
"RTN","BPSECMPS",169,0)
 S (FLDID,FLDNUM)=""
"RTN","BPSECMPS",170,0)
 S FLDIEN=0
"RTN","BPSECMPS",171,0)
 ;
"RTN","BPSECMPS",172,0)
 S FLDID=$E(FIELD,1,2)       ;field identifier
"RTN","BPSECMPS",173,0)
 Q:FLDID=""
"RTN","BPSECMPS",174,0)
 ;
"RTN","BPSECMPS",175,0)
 I FLDID'="" D
"RTN","BPSECMPS",176,0)
 . S FLDIEN=$O(^BPSF(9002313.91,"D",FLDID,FLDIEN))  ;internal fld #
"RTN","BPSECMPS",177,0)
 . S:FLDIEN FLDNUM=$P($G(^BPSF(9002313.91,FLDIEN,0)),U) ;fld number
"RTN","BPSECMPS",178,0)
 Q FLDNUM
"RTN","BPSECMPS",179,0)
 ;
"RTN","BPSECMPS",180,0)
PROCRESP ;
"RTN","BPSECMPS",181,0)
 N FILE,ROOT,FDATA03,FLDNUM,FIELD
"RTN","BPSECMPS",182,0)
 S FILE="9002313.0301"
"RTN","BPSECMPS",183,0)
 S ROOT="FDATA03(9002313.0301)"
"RTN","BPSECMPS",184,0)
 K FDATA03
"RTN","BPSECMPS",185,0)
 I '$D(FDATA(TRANSACT,501)) S FDATA(TRANSACT,501)=FDATA(TRANSACT,112)
"RTN","BPSECMPS",186,0)
 I '$D(FDATA(TRANSACT,112)) S FDATA(TRANSACT,112)=FDATA(TRANSACT,501)
"RTN","BPSECMPS",187,0)
 S FLDNUM=".01" D FDA^DILF(FILE,"+1,"_FDAIEN(TRANSACT),FLDNUM,"",TRANSACT,ROOT)
"RTN","BPSECMPS",188,0)
 S FIELD=""
"RTN","BPSECMPS",189,0)
 F  S FIELD=$O(FDATA(TRANSACT,FIELD)) Q:FIELD=""  D   ;set all the non-repeating fields for 9002313.0301
"RTN","BPSECMPS",190,0)
 .I $G(FDATA(TRANSACT,FIELD))'=""  D
"RTN","BPSECMPS",191,0)
 ..I FIELD=402 S FDATA(TRANSACT,FIELD)=$TR(FDATA(TRANSACT,FIELD),"\","") ;REMOVE EXTRANEOUS "\"
"RTN","BPSECMPS",192,0)
 ..D FDA^DILF(FILE,"+"_TRANSACT_","_FDAIEN(TRANSACT),FIELD,"",FDATA(TRANSACT,FIELD),ROOT)
"RTN","BPSECMPS",193,0)
 .E  D
"RTN","BPSECMPS",194,0)
 ..;
"RTN","BPSECMPS",195,0)
 D UPDATE^DIE("S","FDATA03(9002313.0301)","FDAIEN03")
"RTN","BPSECMPS",196,0)
 Q
"RTN","BPSECMPS",197,0)
 ;
"RTN","BPSECMPS",198,0)
PROCREJ ;
"RTN","BPSECMPS",199,0)
 Q:$G(FDATA(TRANSACT,510))=""
"RTN","BPSECMPS",200,0)
 N FILE,ROOT,FLDNUM,FDAT3511,NUMREJS,NNDX
"RTN","BPSECMPS",201,0)
 S FILE="9002313.03511"
"RTN","BPSECMPS",202,0)
 S ROOT="FDAT3511(9002313.03511)"
"RTN","BPSECMPS",203,0)
 S NUMREJS=FDATA(TRANSACT,510)
"RTN","BPSECMPS",204,0)
 S NNDX=""
"RTN","BPSECMPS",205,0)
 F  S NNDX=$O(FDATA(TRANSACT,511,NNDX)) Q:NNDX=""  D   ;set all the non-repeating fields for 9002313.3511 rejections
"RTN","BPSECMPS",206,0)
 .S FDATA(TRANSACT,511,NNDX)=$TR(FDATA(TRANSACT,511,NNDX),"\","")
"RTN","BPSECMPS",207,0)
 .S FLDNUM=".01" D FDA^DILF(FILE,"+"_NNDX_","_FDAIEN03(TRANSACT)_","_FDAIEN(TRANSACT),FLDNUM,"",FDATA(TRANSACT,511,NNDX),ROOT)
"RTN","BPSECMPS",208,0)
 D UPDATE^DIE("S","FDAT3511(9002313.03511)")
"RTN","BPSECMPS",209,0)
 Q
"RTN","BPSECMPS",210,0)
 ;
"RTN","BPSECMPS",211,0)
PROCAPP ;
"RTN","BPSECMPS",212,0)
 Q:$G(FDATA(TRANSACT,548,1))=""
"RTN","BPSECMPS",213,0)
 N FILE,ROOT,FLDNUM,FDAT1548,NNDX
"RTN","BPSECMPS",214,0)
 S FILE="9002313.301548"
"RTN","BPSECMPS",215,0)
 S ROOT="FDAT1548(9002313.0301548)"
"RTN","BPSECMPS",216,0)
 S NNDX=""
"RTN","BPSECMPS",217,0)
 F  S NNDX=$O(FDATA(FDAIEN(TRANSACT),548,NNDX)) Q:NNDX=""  D
"RTN","BPSECMPS",218,0)
 .S FLDNUM=".01" D FDA^DILF(FILE,"+"_NNDX_","_FDAIEN03(TRANSACT)_","_FDAIEN(TRANSACT),FLDNUM,"",FDATA(TRANSACT,548,NNDX),ROOT)
"RTN","BPSECMPS",219,0)
 D UPDATE^DIE("S","FDAT1548(9002313.301548)")
"RTN","BPSECMPS",220,0)
 Q
"RTN","BPSECMPS",221,0)
 ;
"RTN","BPSECMPS",222,0)
PROCPPR ;
"RTN","BPSECMPS",223,0)
 Q:$G(FDATA(TRANSACT,551.01,1))=""
"RTN","BPSECMPS",224,0)
 N FILE,ROOT,FLDNUM,FDAT1301,NNDX
"RTN","BPSECMPS",225,0)
 S FILE="9002313.1301"
"RTN","BPSECMPS",226,0)
 S ROOT="FDAT1301(9002313.1301)"
"RTN","BPSECMPS",227,0)
 S NNDX=""
"RTN","BPSECMPS",228,0)
 F  S NNDX=$O(FDATA(FDAIEN(TRANSACT),551.01,NNDX)) Q:NNDX=""  D
"RTN","BPSECMPS",229,0)
 .S FLDNUM=".01" D FDA^DILF(FILE,"+"_NNDX_","_FDAIEN03(TRANSACT)_","_FDAIEN(TRANSACT),FLDNUM,"",FDATA(TRANSACT,551.01,NNDX),ROOT)
"RTN","BPSECMPS",230,0)
 D UPDATE^DIE("S","FDAT1301(9002313.1301)")
"RTN","BPSECMPS",231,0)
 Q
"RTN","BPSECMPS",232,0)
 ;
"RTN","BPSECMPS",233,0)
RAW(RESPIEN,RREC) ; store raw data received from the payer
"RTN","BPSECMPS",234,0)
 ; pass in the response IEN (9002313.03) and the raw data to be stored.
"RTN","BPSECMPS",235,0)
 N X,DIWL,DIWR,DIWF
"RTN","BPSECMPS",236,0)
 K ^UTILITY($J,"W")
"RTN","BPSECMPS",237,0)
 S X=RREC,DIWL=1,DIWR=79,DIWF="|" D ^DIWP
"RTN","BPSECMPS",238,0)
 S ^BPSR(RESPIEN,"M",0)=U_U_$G(^UTILITY($J,"W",1))_U_$G(^UTILITY($J,"W",1))_U_DT
"RTN","BPSECMPS",239,0)
 S X=0 F  S X=$O(^UTILITY($J,"W",1,X)) Q:'X  S:$L($G(^UTILITY($J,"W",1,X,0))) ^BPSR(RESPIEN,"M",X,0)=^UTILITY($J,"W",1,X,0)
"RTN","BPSECMPS",240,0)
 K ^UTILITY($J,"W")
"RTN","BPSECMPS",241,0)
 Q
"RTN","BPSGRPL")
0^17^B2437536
"RTN","BPSGRPL",1,0)
BPSGRPL ;BHAM ISC/BNT - ECME USER SCREEN GROUP PLAN ;01-NOV-07
"RTN","BPSGRPL",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**7**;JUN 2004;Build 46
"RTN","BPSGRPL",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSGRPL",4,0)
 ;
"RTN","BPSGRPL",5,0)
 ; Main entry from ECME User Screen - Further Research Menu
"RTN","BPSGRPL",6,0)
EN ;
"RTN","BPSGRPL",7,0)
 N BPSOP,BPRTN
"RTN","BPSGRPL",8,0)
 D FULL^VALM1
"RTN","BPSGRPL",9,0)
 S BPSOP=$$PROMPT^BPSSCRCV("S^EPLA:Edit PLAN APPLICATION Sub-file;MGP:Match Group Plan to a Pharmacy Plan;MMGP:Match Multiple Group Plans to a Pharmacy Plan","Select Group Plan menu Option","")
"RTN","BPSGRPL",10,0)
 I BPSOP="^" S VALMBCK="R" Q
"RTN","BPSGRPL",11,0)
 S BPRTN=$S(BPSOP="EPLA":"^IBCNRE4",BPSOP="MGP":"EN^IBCNRPMT",BPSOP="MMGP":"EN^IBCNRPM1",1:"")
"RTN","BPSGRPL",12,0)
 D:BPRTN]"" @BPRTN
"RTN","BPSGRPL",13,0)
 ;
"RTN","BPSGRPL",14,0)
 S VALMBCK="R"
"RTN","BPSGRPL",15,0)
 Q
"RTN","BPSGRPL",16,0)
 ;
"RTN","BPSGRPL",17,0)
EXIT Q
"RTN","BPSJACK")
0^63^B36662405
"RTN","BPSJACK",1,0)
BPSJACK ;BHAM ISC/LJF - HL7 Acknowledgement Messages ;3/13/08  16:08
"RTN","BPSJACK",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,2,5,7**;JUN 2004;Build 46
"RTN","BPSJACK",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSJACK",4,0)
 ;
"RTN","BPSJACK",5,0)
 ; This routine examines an Acknowledgement Message. If the message is
"RTN","BPSJACK",6,0)
 ; the E-PHARM Application Acknowledgement Message, and it is "AA",
"RTN","BPSJACK",7,0)
 ; it kicks off the Pharmacy Registration Messages.
"RTN","BPSJACK",8,0)
 ; If the message flags an error, then error notification is processed.
"RTN","BPSJACK",9,0)
 ;
"RTN","BPSJACK",10,0)
EN(HL) N ACK,AREG,BPSJSEG,ERR,HCT,SEG
"RTN","BPSJACK",11,0)
 N MFI,MFIIX,MSGCTLID,MSGID,MSGIX,MSH
"RTN","BPSJACK",12,0)
 ;
"RTN","BPSJACK",13,0)
 I '$D(HL) Q
"RTN","BPSJACK",14,0)
 ;
"RTN","BPSJACK",15,0)
 S (AREG,HCT,MFIIX,MSGCTLID,MSGID,MSGIX)=0,(ACK,MFI,MSH)=""
"RTN","BPSJACK",16,0)
 S ERR("MSA")=""
"RTN","BPSJACK",17,0)
 ;  Loop through the message and find each segment for processing
"RTN","BPSJACK",18,0)
 F  S HCT=$O(^TMP($J,"BPSJHLI",HCT)) Q:HCT=""  D
"RTN","BPSJACK",19,0)
 . K BPSJSEG D SPAR^BPSJUTL(.HL,.BPSJSEG,HCT) S SEG=$G(BPSJSEG(1))
"RTN","BPSJACK",20,0)
 . ;
"RTN","BPSJACK",21,0)
 . I SEG="MSH" D  Q
"RTN","BPSJACK",22,0)
 . . S MSGCTLID=$G(BPSJSEG(10))    ; get the message control id
"RTN","BPSJACK",23,0)
 . ;
"RTN","BPSJACK",24,0)
 . I SEG="MSA" D  Q  ; MSA seg looks like this -> MSA|AA|509133482
"RTN","BPSJACK",25,0)
 . . S ACK=$G(BPSJSEG(2)),MSGID=$G(BPSJSEG(3)) K ERR("MSA")
"RTN","BPSJACK",26,0)
 . ;
"RTN","BPSJACK",27,0)
 . I SEG="MFI",ACK="AA",$P($G(BPSJSEG(2)),$E($G(HL("ECH"))))="Facility Table" S AREG=1
"RTN","BPSJACK",28,0)
 . ;
"RTN","BPSJACK",29,0)
 . ;GET NPI
"RTN","BPSJACK",30,0)
 . I SEG="MFI",ACK="AA",$P($G(BPSJSEG(2)),$E($G(HL("ECH"))))="Pharmacy Table" D
"RTN","BPSJACK",31,0)
 . . I '$G(MSGID) Q
"RTN","BPSJACK",32,0)
 . . N BPSJNPI,BPSJPIX,BPSJNDT,BPSJ,HLMAID,HLID
"RTN","BPSJACK",33,0)
 . . ; back track AA/ACK to message sent out to find NPI sent out
"RTN","BPSJACK",34,0)
 . . S HLMAID=$O(^HLMA("C",MSGID,"")) I '$G(HLMAID) Q
"RTN","BPSJACK",35,0)
 . . S HLID=$P(^HLMA(HLMAID,0),U) I '$G(HLID) Q
"RTN","BPSJACK",36,0)
 . . S BPSJNPI=$P($G(^HL(772,HLID,"IN",22,0)),"|") I '$G(BPSJNPI) Q
"RTN","BPSJACK",37,0)
 . . S BPSJ=$G(^XTMP("BPSJ","NPI",BPSJNPI)) I 'BPSJ Q
"RTN","BPSJACK",38,0)
 . . S BPSJPIX=$P(BPSJ,U),BPSJNDT=$P(BPSJ,U,2)
"RTN","BPSJACK",39,0)
 . . N DA,DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","BPSJACK",40,0)
 . . S DA=BPSJPIX,DIE=$$ROOT^DILFD(9002313.56)
"RTN","BPSJACK",41,0)
 . . S DR="41.01////"_BPSJNPI_";41.02////"_BPSJNDT D ^DIE
"RTN","BPSJACK",42,0)
 . . K ^XTMP("BPSJ","NPI",BPSJNPI)
"RTN","BPSJACK",43,0)
 . ;
"RTN","BPSJACK",44,0)
 . I SEG="MFA",ACK="AE" S ERR("MFA",U_$G(BPSJSEG(5)))="" Q
"RTN","BPSJACK",45,0)
 ;
"RTN","BPSJACK",46,0)
 ; Pharmacy Registrations
"RTN","BPSJACK",47,0)
 I AREG S AREG=0 D
"RTN","BPSJACK",48,0)
 . S $P(^BPS(9002313.99,1,0),"^",7)=$$NOW^XLFDT
"RTN","BPSJACK",49,0)
 . F  S AREG=$O(^BPS(9002313.56,AREG)) Q:'AREG  D REG^BPSJPREG(AREG)
"RTN","BPSJACK",50,0)
 ;
"RTN","BPSJACK",51,0)
 I $D(ERR) D ERRORM D MSG^BPSJUTL(.ERR,"BPSJACK")
"RTN","BPSJACK",52,0)
 Q
"RTN","BPSJACK",53,0)
 ;
"RTN","BPSJACK",54,0)
ERRORM ; Error message setup
"RTN","BPSJACK",55,0)
 N ERRT
"RTN","BPSJACK",56,0)
 ;
"RTN","BPSJACK",57,0)
 S ERR(1)="Error(s) indicated for HL7 Application Acknowledge Message ID: "_$G(MSGCTLID)
"RTN","BPSJACK",58,0)
 I $D(ERR("MSA")) S ERR(2)="Error:NO MSA - No MSA segment found."
"RTN","BPSJACK",59,0)
 I $D(ERR("MFA")) S ERRT="" F  S ERRT=$O(ERR("MFA",ERRT)) Q:ERRT=""  D
"RTN","BPSJACK",60,0)
 . I ERRT["NC100" S ERR(100)="Error:NC100 - Invalid OP Interface version." Q
"RTN","BPSJACK",61,0)
 . I ERRT["NC200" S ERR(200)="Error:NC200 - Not e-IIV registered." Q
"RTN","BPSJACK",62,0)
 . I ERRT["NC201" S ERR(201)="Error:NC201 - Invalid IIV Interface version." Q
"RTN","BPSJACK",63,0)
 . I ERRT["NC202" S ERR(202)="Error:NC202 - Invalid e-IIV registration state." Q
"RTN","BPSJACK",64,0)
 . I ERRT["NC300" S ERR(300)="Error:NC300 - OP pharmacy not registered.  Failed to update Pharmacy information." Q
"RTN","BPSJACK",65,0)
 . I ERRT["NC301" S ERR(301)="Error:NC301 - Unable to update Pharmacy information due to outpatient pharmacy registration has invalid OP interface version." Q
"RTN","BPSJACK",66,0)
 . I ERRT["NC302" S ERR(302)="Error:NC302 - Unable to update Pharmacy information due to invalid e-IIV registration state." Q
"RTN","BPSJACK",67,0)
 . S ERR(399)="Error:"_ERRT_" - Unknown error."
"RTN","BPSJACK",68,0)
 K ERR("MFA"),ERR("MSA")
"RTN","BPSJACK",69,0)
 ;
"RTN","BPSJACK",70,0)
 Q
"RTN","BPSJACK",71,0)
 ;
"RTN","BPSJACK",72,0)
APPACK(HL,APPACK,PSIEN) ; Application Acknowledgement for Payer Sheets
"RTN","BPSJACK",73,0)
 N MGRP,MSG,MCT,BPSGENR
"RTN","BPSJACK",74,0)
 N TLN,FS,FS2,FS3,CS
"RTN","BPSJACK",75,0)
 ;
"RTN","BPSJACK",76,0)
 K ^TMP("HLA",$J)
"RTN","BPSJACK",77,0)
 ;
"RTN","BPSJACK",78,0)
 ;-Set up HL7
"RTN","BPSJACK",79,0)
 D INIT^HLFNC2("BPSJ REGISTER",.HL)
"RTN","BPSJACK",80,0)
 ;
"RTN","BPSJACK",81,0)
 D DGAPPACK  ; Dollar G the APPACK variable (bullet proofing)
"RTN","BPSJACK",82,0)
 ;
"RTN","BPSJACK",83,0)
 S FS=$G(HL("FS")) I FS="" S FS="|"      ; field separator
"RTN","BPSJACK",84,0)
 S CS=$E($G(HL("ECH"))) I CS="" S CS="^"  ; component separator
"RTN","BPSJACK",85,0)
 ;
"RTN","BPSJACK",86,0)
 S MCT=0,FS2=FS_FS,FS3=FS_FS_FS
"RTN","BPSJACK",87,0)
 ;
"RTN","BPSJACK",88,0)
 ;-MSA SEG
"RTN","BPSJACK",89,0)
 I APPACK("MFA",4,1)="S" S ^TMP("HLA",$J,1)="MSA"_FS_"AA"_FS_APPACK("MSA",2)
"RTN","BPSJACK",90,0)
 E  S ^TMP("HLA",$J,1)="MSA"_FS_"AE"_FS_APPACK("MSA",2)
"RTN","BPSJACK",91,0)
 ;
"RTN","BPSJACK",92,0)
 ;-MFI SEG
"RTN","BPSJACK",93,0)
 S TLN="MFI"_FS_APPACK("MFI",1,1)_CS_APPACK("MFI",1,2)_FS2
"RTN","BPSJACK",94,0)
 S ^TMP("HLA",$J,2)=TLN_APPACK("MFI",3)_FS3_APPACK("MFI",6)
"RTN","BPSJACK",95,0)
 ;
"RTN","BPSJACK",96,0)
 ;-MFA SEG(S)
"RTN","BPSJACK",97,0)
 I APPACK("MFA",4,1)="S" D  S ^TMP("HLA",$J,3)=TLN
"RTN","BPSJACK",98,0)
 . S TLN="MFA"_FS_APPACK("MFA",1)_FS_APPACK("MFA",2)_FS2
"RTN","BPSJACK",99,0)
 . S TLN=TLN_APPACK("MFA",4,1)_CS_APPACK("MFA",4,2)_FS
"RTN","BPSJACK",100,0)
 . S TLN=TLN_APPACK("MFA",5)_FS_APPACK("MFA",6)
"RTN","BPSJACK",101,0)
 E  D MFASEGS
"RTN","BPSJACK",102,0)
 ;
"RTN","BPSJACK",103,0)
 D GENACK^HLMA1($G(HL("EID")),$G(HL("HLMTIENS")),$G(HL("EIDS")),"GM",1,.BPSGENR)
"RTN","BPSJACK",104,0)
 ;
"RTN","BPSJACK",105,0)
 K ^TMP("HLA",$J)
"RTN","BPSJACK",106,0)
 Q
"RTN","BPSJACK",107,0)
 ;
"RTN","BPSJACK",108,0)
MFASEGS ; Set up the MFA segs for Reject message
"RTN","BPSJACK",109,0)
 N MFAP1,MFAP2,MFACNTR,FIELD,RECORD,ZPRERR
"RTN","BPSJACK",110,0)
 ;
"RTN","BPSJACK",111,0)
 S MFAP1="MFA"_FS_APPACK("MFA",1)_FS_APPACK("MFA",2)
"RTN","BPSJACK",112,0)
 S MFAP1=MFAP1_FS2_APPACK("MFA",4,1)_CS
"RTN","BPSJACK",113,0)
 S MFAP2=FS_APPACK("MFA",5)_FS_APPACK("MFA",6)
"RTN","BPSJACK",114,0)
 S MFACNTR=2
"RTN","BPSJACK",115,0)
 ;
"RTN","BPSJACK",116,0)
 I $D(^TMP($J,"BPSJ-ERROR","MFI")) S FIELD="" D
"RTN","BPSJACK",117,0)
 . F  S FIELD=$O(^TMP($J,"BPSJ-ERROR","MFI",FIELD)) Q:'FIELD  D
"RTN","BPSJACK",118,0)
 .. S MFACNTR=MFACNTR+1
"RTN","BPSJACK",119,0)
 .. S ^TMP("HLA",$J,MFACNTR)=MFAP1_"V60"_FIELD_MFAP2
"RTN","BPSJACK",120,0)
 ;
"RTN","BPSJACK",121,0)
 I $D(^TMP($J,"BPSJ-ERROR","MFE")) S FIELD="" D
"RTN","BPSJACK",122,0)
 . F  S FIELD=$O(^TMP($J,"BPSJ-ERROR","MFE",FIELD)) Q:'FIELD  D
"RTN","BPSJACK",123,0)
 .. S MFACNTR=MFACNTR+1
"RTN","BPSJACK",124,0)
 .. S ^TMP("HLA",$J,MFACNTR)=MFAP1_"V61"_FIELD_MFAP2
"RTN","BPSJACK",125,0)
 ;
"RTN","BPSJACK",126,0)
 I $D(^TMP($J,"BPSJ-ERROR","ZPS")) S FIELD="" D
"RTN","BPSJACK",127,0)
 . F  S FIELD=$O(^TMP($J,"BPSJ-ERROR","ZPS",FIELD)) Q:'FIELD  D
"RTN","BPSJACK",128,0)
 .. S MFACNTR=MFACNTR+1
"RTN","BPSJACK",129,0)
 .. S ^TMP("HLA",$J,MFACNTR)=MFAP1_"V62"_FIELD_MFAP2
"RTN","BPSJACK",130,0)
 ;
"RTN","BPSJACK",131,0)
 I $D(^TMP($J,"BPSJ-ERROR","ZPR")) S RECORD="" D
"RTN","BPSJACK",132,0)
 . F  S RECORD=$O(^TMP($J,"BPSJ-ERROR","ZPR",RECORD)),FIELD="" Q:'RECORD  D
"RTN","BPSJACK",133,0)
 .. F  S FIELD=$O(^TMP($J,"BPSJ-ERROR","ZPR",RECORD,FIELD)) Q:'FIELD  D
"RTN","BPSJACK",134,0)
 ... S ZPRERR=$G(^TMP($J,"BPSJ-ERROR","ZPR",RECORD,FIELD))
"RTN","BPSJACK",135,0)
 ... S MFACNTR=MFACNTR+1,^TMP("HLA",$J,MFACNTR)=MFAP1_ZPRERR_MFAP2
"RTN","BPSJACK",136,0)
 ;
"RTN","BPSJACK",137,0)
 Q
"RTN","BPSJACK",138,0)
DGAPPACK ; $G the APPACK var
"RTN","BPSJACK",139,0)
 S APPACK("MFA",1)=$G(APPACK("MFA",1))
"RTN","BPSJACK",140,0)
 S APPACK("MFA",2)=$G(APPACK("MFA",2))
"RTN","BPSJACK",141,0)
 S APPACK("MFA",3)=$G(APPACK("MFA",3))
"RTN","BPSJACK",142,0)
 S APPACK("MFA",4,1)=$G(APPACK("MFA",4,1))
"RTN","BPSJACK",143,0)
 S APPACK("MFA",4,2)=$G(APPACK("MFA",4,2))
"RTN","BPSJACK",144,0)
 S APPACK("MFA",5)=$G(APPACK("MFA",5))
"RTN","BPSJACK",145,0)
 S APPACK("MFA",6)=$G(APPACK("MFA",6))
"RTN","BPSJACK",146,0)
 S APPACK("MFI",1,1)=$G(APPACK("MFI",1,1))
"RTN","BPSJACK",147,0)
 S APPACK("MFI",1,2)=$G(APPACK("MFI",1,2))
"RTN","BPSJACK",148,0)
 S APPACK("MFI",3)=$G(APPACK("MFI",3))
"RTN","BPSJACK",149,0)
 S APPACK("MFI",6)=$G(APPACK("MFI",6))
"RTN","BPSJACK",150,0)
 S APPACK("MSA",1)=$G(APPACK("MSA",1))
"RTN","BPSJACK",151,0)
 S APPACK("MSA",2)=$G(APPACK("MSA",2))
"RTN","BPSJACK",152,0)
 Q
"RTN","BPSJAREG")
0^38^B11441916
"RTN","BPSJAREG",1,0)
BPSJAREG ;BHAM ISC/LJF - HL7 Application Registration MFN Message ;03/07/08  13:26
"RTN","BPSJAREG",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,2,5,7**;JUN 2004;Build 46
"RTN","BPSJAREG",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSJAREG",4,0)
 ;
"RTN","BPSJAREG",5,0)
 ;  This program will process the outgoing registration MFN message
"RTN","BPSJAREG",6,0)
 ;
"RTN","BPSJAREG",7,0)
 ;  Variables
"RTN","BPSJAREG",8,0)
 ; HL      = HL7 parameters
"RTN","BPSJAREG",9,0)
 ; HL7DTG  = Date time in HL7 format
"RTN","BPSJAREG",10,0)
 ; HLECH   = HL7 Encoding Characters
"RTN","BPSJAREG",11,0)
 ; HLEID   = HL7 Link id
"RTN","BPSJAREG",12,0)
 ; HLFS    = HL7 Field separator
"RTN","BPSJAREG",13,0)
 ; HLLNK   = HL7 E-Pharm Link
"RTN","BPSJAREG",14,0)
 ; HLRESET = HL7 generate results
"RTN","BPSJAREG",15,0)
 ; IPP     = IP Port
"RTN","BPSJAREG",16,0)
 ; IPA     = IP Address
"RTN","BPSJAREG",17,0)
 ; MCT     = Message Count
"RTN","BPSJAREG",18,0)
 ; MGRP    = E-Mail message group
"RTN","BPSJAREG",19,0)
 ; MSG     = Message
"RTN","BPSJAREG",20,0)
 ;
"RTN","BPSJAREG",21,0)
 ;
"RTN","BPSJAREG",22,0)
BPSJVAL(BPSJVAL) ; Validation entry point - HL7 message processing prevented
"RTN","BPSJAREG",23,0)
 ;
"RTN","BPSJAREG",24,0)
TASKMAN ; Entry point for taskman to run this routine
"RTN","BPSJAREG",25,0)
 ;
"RTN","BPSJAREG",26,0)
 N DA,HL,HL7DTG,HLECH,HLEID,HLFS,HLLNK,HLRESET,HLPRO
"RTN","BPSJAREG",27,0)
 N IPA,IPP
"RTN","BPSJAREG",28,0)
 N MGRP,MSG,MCT,BPSJARES,BPVALFN,DA
"RTN","BPSJAREG",29,0)
 ;
"RTN","BPSJAREG",30,0)
 S MCT=0,BPSJVAL=+$G(BPSJVAL)
"RTN","BPSJAREG",31,0)
 K ^TMP("HLS",$J)
"RTN","BPSJAREG",32,0)
 ;
"RTN","BPSJAREG",33,0)
 S BPVALFN=9002313.99,DA=1
"RTN","BPSJAREG",34,0)
 ;
"RTN","BPSJAREG",35,0)
 ;  Get Link data from HL7 table
"RTN","BPSJAREG",36,0)
 S HLPRO="BPSJ REGISTER",(IPA,IPP)=""
"RTN","BPSJAREG",37,0)
 S HLLNK=$$FIND1^DIC(870,"",,"EPHARM OUT","B")
"RTN","BPSJAREG",38,0)
 I HLLNK S IPA=$$GET1^DIQ(870,HLLNK_",",400.01),IPP=$$GET1^DIQ(870,HLLNK_",",400.02)
"RTN","BPSJAREG",39,0)
 ;
"RTN","BPSJAREG",40,0)
 ;  Error if any missing data
"RTN","BPSJAREG",41,0)
 I IPA=""!(IPP="") S MCT=MCT+1,MSG(MCT)="IP Address or Port is not defined.  "
"RTN","BPSJAREG",42,0)
 ;
"RTN","BPSJAREG",43,0)
 I MCT,'BPSJVAL D MSG^BPSJUTL(.MSG,"BPSJAREG") Q
"RTN","BPSJAREG",44,0)
 ;
"RTN","BPSJAREG",45,0)
 ;  Initialize the HL7
"RTN","BPSJAREG",46,0)
 D INIT^HLFNC2(HLPRO,.HL)
"RTN","BPSJAREG",47,0)
 I $G(HL) S MCT=MCT+1,MSG(MCT)="HL7 initialization failed.",MCT=MCT+1,MSG(MCT)=HL Q
"RTN","BPSJAREG",48,0)
 S HLFS=$G(HL("FS")) I HLFS="" S HLFS="|"
"RTN","BPSJAREG",49,0)
 S HLECH=$E($G(HL("ECH")),1) I HLECH="" S HLECH="^"
"RTN","BPSJAREG",50,0)
 S HL("SITE")=$$SITE^VASITE,HL("SAF")=$P(HL("SITE"),U,2,3)
"RTN","BPSJAREG",51,0)
 S HL("EPPORT")=IPP,HLEID=$$HLP^BPSJUTL(HLPRO)
"RTN","BPSJAREG",52,0)
 ;
"RTN","BPSJAREG",53,0)
 ;Get fileman date/time, ensuring seconds are included: 3031029.135636
"RTN","BPSJAREG",54,0)
 S HL7DTG=$E($$HTFM^XLFDT($H)_"000000",1,14)
"RTN","BPSJAREG",55,0)
 ;Set HL7 Date/Time format: 20031029135636-0400
"RTN","BPSJAREG",56,0)
 S HL7DTG=$$FMTHL7^XLFDT(HL7DTG)
"RTN","BPSJAREG",57,0)
 ;
"RTN","BPSJAREG",58,0)
 ;   Set the MFI segment
"RTN","BPSJAREG",59,0)
 S ^TMP("HLS",$J,1)="MFI"_HLFS_"Facility Table"_HLFS_HLFS_"UPD"_HLFS
"RTN","BPSJAREG",60,0)
 S ^TMP("HLS",$J,1)=^TMP("HLS",$J,1)_HL7DTG_HLFS_HL7DTG_HLFS_"NE"
"RTN","BPSJAREG",61,0)
 ;
"RTN","BPSJAREG",62,0)
 ;  Set the MFE segment
"RTN","BPSJAREG",63,0)
 S ^TMP("HLS",$J,2)="MFE"_HLFS_"MUP"_HLFS_HLFS_HL7DTG_HLFS
"RTN","BPSJAREG",64,0)
 S ^TMP("HLS",$J,2)=^TMP("HLS",$J,2)_$P(HL("SITE"),"^",3)_HLFS_"ST"
"RTN","BPSJAREG",65,0)
 ;
"RTN","BPSJAREG",66,0)
 ; Set the ZQR segment
"RTN","BPSJAREG",67,0)
 S ^TMP("HLS",$J,3)=$$EN^BPSJZQR(.HL)
"RTN","BPSJAREG",68,0)
 ;
"RTN","BPSJAREG",69,0)
 S BPSJARES=$$VAL1^BPSJVAL(BPSJVAL)   ; 0 = ok,
"RTN","BPSJAREG",70,0)
 I BPSJVAL=3 G FINI   ; Just checking to see if data valid.
"RTN","BPSJAREG",71,0)
 ;
"RTN","BPSJAREG",72,0)
 ;-Check if msg valid.
"RTN","BPSJAREG",73,0)
 I 'BPSJARES D  G FINI
"RTN","BPSJAREG",74,0)
 . N BPSHLRS
"RTN","BPSJAREG",75,0)
 . D GENERATE^HLMA(HLEID,"GM",1,.BPSHLRS,"")
"RTN","BPSJAREG",76,0)
 . I $P($G(BPSHLRS),U,2)]"" D  Q
"RTN","BPSJAREG",77,0)
 .. I BPSJVAL D  Q   ; Interactive: show no success
"RTN","BPSJAREG",78,0)
 ... W !!,"ECME Application Registration HL7 Message not created: "_BPSHLRS
"RTN","BPSJAREG",79,0)
 .. S MCT=MCT+1,MSG(MCT)="ECME Application Registration HL7 Message not created."
"RTN","BPSJAREG",80,0)
 .. S MCT=MCT+1,MSG(MCT)=BPSHLRS
"RTN","BPSJAREG",81,0)
 .. D MSG^BPSJUTL(.MSG,"ECME Application Registration")
"RTN","BPSJAREG",82,0)
 . I BPSJVAL D    ;Interactive: show success
"RTN","BPSJAREG",83,0)
 .. W !!,"ECME Application Registration HL7 Message successfully created."
"RTN","BPSJAREG",84,0)
 . S $P(^BPS(9002313.99,1,0),"^",4)=$$NOW^XLFDT
"RTN","BPSJAREG",85,0)
 ;
"RTN","BPSJAREG",86,0)
FINI ; Clean up
"RTN","BPSJAREG",87,0)
 K ^TMP("HLS",$J)
"RTN","BPSJAREG",88,0)
 Q
"RTN","BPSJINI1")
1^43
"RTN","BPSJINIT")
0^39^B16011071
"RTN","BPSJINIT",1,0)
BPSJINIT ;BHAM ISC/LJF - HL7 Application Registration ;03/07/08  14:09
"RTN","BPSJINIT",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,3,2,5,7**;JUN 2004;Build 46
"RTN","BPSJINIT",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSJINIT",4,0)
 ;
"RTN","BPSJINIT",5,0)
 N DA,DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","BPSJINIT",6,0)
 N BPSJAPPR,BPSJVALR,PHIX,BPSOUT
"RTN","BPSJINIT",7,0)
 ;
"RTN","BPSJINIT",8,0)
 ;  This program will allow user to enter site data.
"RTN","BPSJINIT",9,0)
 ;
"RTN","BPSJINIT",10,0)
 ; Programmer Note: D BPSJVAL^BPSJAREG(X) will validate with following.
"RTN","BPSJINIT",11,0)
 ;   where X is: 0 = HL7 trigger, no validation display
"RTN","BPSJINIT",12,0)
 ;               1 = HL7 trigger, display validation
"RTN","BPSJINIT",13,0)
 ;               2 = no HL7 trigger, display validation
"RTN","BPSJINIT",14,0)
 ;               3 = no validation display, no HL7 trigger
"RTN","BPSJINIT",15,0)
 ;
"RTN","BPSJINIT",16,0)
 W !!,?IOM/2-14,"** ECME Site Registration **"
"RTN","BPSJINIT",17,0)
 ;
"RTN","BPSJINIT",18,0)
 ; Create/update BPS Setup record
"RTN","BPSJINIT",19,0)
 D VERSION
"RTN","BPSJINIT",20,0)
 ;
"RTN","BPSJINIT",21,0)
 S BPSOUT=0
"RTN","BPSJINIT",22,0)
 S DIE="^BPS(9002313.99,",DA=1
"RTN","BPSJINIT",23,0)
 S DR="[BPSJ SITE SETUP]" D ^DIE
"RTN","BPSJINIT",24,0)
 I BPSOUT!($D(Y)) Q
"RTN","BPSJINIT",25,0)
 ;
"RTN","BPSJINIT",26,0)
 W !!!,"-- Application Registration Validation Results:"
"RTN","BPSJINIT",27,0)
 S BPSJVALR=-1
"RTN","BPSJINIT",28,0)
 D BPSJVAL^BPSJAREG(2)
"RTN","BPSJINIT",29,0)
 S BPSJAPPR=BPSJVALR
"RTN","BPSJINIT",30,0)
 ;
"RTN","BPSJINIT",31,0)
 I 'BPSJAPPR W !!,?IOM/2-21,"** Application Registration Data VALID **",!
"RTN","BPSJINIT",32,0)
 E  D
"RTN","BPSJINIT",33,0)
 . W !!,"** Application Registration Data INVALID!!!  **"
"RTN","BPSJINIT",34,0)
 . W !,"**  Application Registration and Pharmacy    **"
"RTN","BPSJINIT",35,0)
 . W !,"**    Registrations will NOT be sent!        **",!
"RTN","BPSJINIT",36,0)
 ;
"RTN","BPSJINIT",37,0)
 S DIR(0)="EO" D ^DIR I X=U Q
"RTN","BPSJINIT",38,0)
 ;
"RTN","BPSJINIT",39,0)
 D PHARM(.BPSOUT)
"RTN","BPSJINIT",40,0)
 I BPSOUT Q
"RTN","BPSJINIT",41,0)
 I BPSJAPPR D  Q
"RTN","BPSJINIT",42,0)
 . W !!,"Registration ABORTED due to invalid site registration data",!!
"RTN","BPSJINIT",43,0)
 ;
"RTN","BPSJINIT",44,0)
 W !!!,"Application Registration Data is VALID"
"RTN","BPSJINIT",45,0)
 W !!,"Pharmacy Registration Data is:"
"RTN","BPSJINIT",46,0)
 S PHIX=$O(^BPS(9002313.56,0))
"RTN","BPSJINIT",47,0)
 F  Q:'PHIX  D  S PHIX=$O(^BPS(9002313.56,PHIX))
"RTN","BPSJINIT",48,0)
 . S BPSJVALR=-1 D REG^BPSJPREG(PHIX,3)
"RTN","BPSJINIT",49,0)
 . I BPSJVALR>0 S DIR=" *INVALID",DIE=" and will NOT be transmitted."
"RTN","BPSJINIT",50,0)
 . E  S DIR="    VALID",DIE=" and will be transmitted."
"RTN","BPSJINIT",51,0)
 . W !,DIR_" for "_$P($G(^BPS(9002313.56,PHIX,0)),U)_DIE
"RTN","BPSJINIT",52,0)
 W !
"RTN","BPSJINIT",53,0)
 K DA,DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","BPSJINIT",54,0)
 S DIR(0)="YEO",DIR("A")="Send Application Registration: Y/N " D ^DIR
"RTN","BPSJINIT",55,0)
 I $TR($E(X),"y","Y")'="Y" Q
"RTN","BPSJINIT",56,0)
 ;
"RTN","BPSJINIT",57,0)
 K DA,DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","BPSJINIT",58,0)
 D BPSJVAL^BPSJAREG(0)
"RTN","BPSJINIT",59,0)
 W !!,"Application Registration SUBMITTED..."
"RTN","BPSJINIT",60,0)
 Q
"RTN","BPSJINIT",61,0)
 ;
"RTN","BPSJINIT",62,0)
PHARM(BPSOUT) ;CYCLE THROUGH PHARMACIES
"RTN","BPSJINIT",63,0)
 ;
"RTN","BPSJINIT",64,0)
 N DA,DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","BPSJINIT",65,0)
 N BPSJVALR,BPSJPHPR,BPSPHARM
"RTN","BPSJINIT",66,0)
 ;
"RTN","BPSJINIT",67,0)
 S BPSPHARM=0 F  D  Q:BPSPHARM=""!(BPSOUT)
"RTN","BPSJINIT",68,0)
 . W !!!,"Enter/verify Pharmacy Registration Data"
"RTN","BPSJINIT",69,0)
 . ;
"RTN","BPSJINIT",70,0)
 . ;check for drop dead date
"RTN","BPSJINIT",71,0)
 . S DIC(0)="QAELM"
"RTN","BPSJINIT",72,0)
 . S DIC="^BPS(9002313.56,",DLAYGO=DIC D ^DIC
"RTN","BPSJINIT",73,0)
 . ;
"RTN","BPSJINIT",74,0)
 . I X'=U,0<+Y S BPSPHARM=+Y
"RTN","BPSJINIT",75,0)
 . E  S BPSPHARM="" Q
"RTN","BPSJINIT",76,0)
 . D MOD(BPSPHARM,.BPSOUT) I 'BPSPHARM!(BPSOUT) Q
"RTN","BPSJINIT",77,0)
 . W !!!,"-- Pharmacy Registration Validation Results --",!
"RTN","BPSJINIT",78,0)
 . ;
"RTN","BPSJINIT",79,0)
 . S BPSJVALR=-1
"RTN","BPSJINIT",80,0)
 . D REG^BPSJPREG(BPSPHARM,2)
"RTN","BPSJINIT",81,0)
 . S BPSJPHPR=BPSJVALR
"RTN","BPSJINIT",82,0)
 . ;
"RTN","BPSJINIT",83,0)
 . I 'BPSJPHPR W !!,"-- Pharmacy Registration Data VALID. --",!
"RTN","BPSJINIT",84,0)
 . E  D
"RTN","BPSJINIT",85,0)
 .. W !!,"**     Pharmacy Registration Data INVALID!!!      **"
"RTN","BPSJINIT",86,0)
 .. W !,"** This pharmacy's registration will NOT be sent! **",!
"RTN","BPSJINIT",87,0)
 ;
"RTN","BPSJINIT",88,0)
 Q
"RTN","BPSJINIT",89,0)
 ;
"RTN","BPSJINIT",90,0)
MOD(DA,BPSOUT) ;
"RTN","BPSJINIT",91,0)
 N DIE,DR,DTOUT,X,Y
"RTN","BPSJINIT",92,0)
 ;
"RTN","BPSJINIT",93,0)
 ; Set STATUS default to ACTIVE if not set
"RTN","BPSJINIT",94,0)
 I $P($G(^BPS(9002313.56,DA,0)),"^",10)="" D
"RTN","BPSJINIT",95,0)
 . S DR=".1///ACTIVE",DIE="^BPS(9002313.56,"
"RTN","BPSJINIT",96,0)
 . D ^DIE
"RTN","BPSJINIT",97,0)
 ;
"RTN","BPSJINIT",98,0)
 S DIE="^BPS(9002313.56,"
"RTN","BPSJINIT",99,0)
 S DR="[BPSJ PHARMACY ENTER/EDIT]" D ^DIE
"RTN","BPSJINIT",100,0)
 I $D(Y) S BPSOUT=1
"RTN","BPSJINIT",101,0)
 ;
"RTN","BPSJINIT",102,0)
 Q
"RTN","BPSJINIT",103,0)
 ;
"RTN","BPSJINIT",104,0)
VERSION ;
"RTN","BPSJINIT",105,0)
 ; Create entry if missing
"RTN","BPSJINIT",106,0)
 ; Sets in defaults:
"RTN","BPSJINIT",107,0)
 ;    ECME TIMEOUT: 10
"RTN","BPSJINIT",108,0)
 ;    SITE TYPE: VA
"RTN","BPSJINIT",109,0)
 ;    WINNOW TESTING FLAG: NO
"RTN","BPSJINIT",110,0)
 ;    VA LAST SEQUENCE: = $P($P($G(^BPSC(+$P(^BPSC(0),U,3),0)),U),?=?,4)
"RTN","BPSJINIT",111,0)
 ;    WINNOW BPS LOG: 36
"RTN","BPSJINIT",112,0)
 ;    VITRIA INTERFACE VERSION: 3
"RTN","BPSJINIT",113,0)
 ;
"RTN","BPSJINIT",114,0)
 N BPSDA,DIC,DLAYGO,X,Y,DTOUT,DUOUT,DINUM
"RTN","BPSJINIT",115,0)
 S BPSDA=$O(^BPS(9002313.99,0))
"RTN","BPSJINIT",116,0)
 I BPSDA'=1 D
"RTN","BPSJINIT",117,0)
 . S (DIC,DLAYGO)=9002313.99,DIC(0)="L",X="MAIN SETUP ENTRY",DINUM=1
"RTN","BPSJINIT",118,0)
 . S DIC("DR")="3.01///10;1000///^S X=$P($P($G(^BPSC(+$P(^BPSC(0),U,3),0)),U),"=",4);9999///VA;6003///3;2341.01///NO;2341.03///36"
"RTN","BPSJINIT",119,0)
 . D ^DIC
"RTN","BPSJINIT",120,0)
 ;
"RTN","BPSJINIT",121,0)
 Q
"RTN","BPSJINIT",122,0)
 ;
"RTN","BPSJPREG")
0^44^B20416052
"RTN","BPSJPREG",1,0)
BPSJPREG ;BHAM ISC/LJF - HL7 Registration MFN Message ;6/12/08  15:38
"RTN","BPSJPREG",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,3,2,5,7**;JUN 2004;Build 46
"RTN","BPSJPREG",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSJPREG",4,0)
 ;
"RTN","BPSJPREG",5,0)
 ;**Program Description**
"RTN","BPSJPREG",6,0)
 ;  This program will process the outgoing registration MFN message
"RTN","BPSJPREG",7,0)
 ;
"RTN","BPSJPREG",8,0)
 ;  Variable
"RTN","BPSJPREG",9,0)
 ; HL      = HL7 parameters
"RTN","BPSJPREG",10,0)
 ; HL7DTG  = Date time in HL7 format
"RTN","BPSJPREG",11,0)
 ; HLECH   = HL7 Encoding Characters
"RTN","BPSJPREG",12,0)
 ; HLEID   = HL7 Link id
"RTN","BPSJPREG",13,0)
 ; HLFS    = HL7 Field separator
"RTN","BPSJPREG",14,0)
 ; HLLNK   = HL7 E-Pharm Link
"RTN","BPSJPREG",15,0)
 ; HLRESET = HL7 generate results
"RTN","BPSJPREG",16,0)
 ; IPP     = IP Port
"RTN","BPSJPREG",17,0)
 ; IPA     = IP Address
"RTN","BPSJPREG",18,0)
 ; MCT     = Message Count
"RTN","BPSJPREG",19,0)
 ; MGRP    = E-Mail message group
"RTN","BPSJPREG",20,0)
 ; MSG     = Message
"RTN","BPSJPREG",21,0)
 ;
"RTN","BPSJPREG",22,0)
 ; Don't allow direct execution
"RTN","BPSJPREG",23,0)
 ;
"RTN","BPSJPREG",24,0)
 W !!!,"DIRECT ENTRY NOT ALLOWED",!!!
"RTN","BPSJPREG",25,0)
 Q
"RTN","BPSJPREG",26,0)
 ;
"RTN","BPSJPREG",27,0)
REG(PHARMIX,BPSJVAL) ;  Registration message for when a site installs
"RTN","BPSJPREG",28,0)
 ;
"RTN","BPSJPREG",29,0)
 N HL,HL7DTG,HLECH,HLEID,HLFS,HLLNK,HLPRO,BPSHLRS,IPA,IPP,NPKEY,NCPDP
"RTN","BPSJPREG",30,0)
 N MGRP,MCT,MSG,TAXID,ZRPSEG,BPSJVAL2,BPSJPRES,BPSZ
"RTN","BPSJPREG",31,0)
 ;
"RTN","BPSJPREG",32,0)
 S (MCT,TAXID)=0,BPSJVAL=$G(BPSJVAL)
"RTN","BPSJPREG",33,0)
 ;
"RTN","BPSJPREG",34,0)
 I '$G(PHARMIX) Q
"RTN","BPSJPREG",35,0)
 K ^TMP("HLS",$J)
"RTN","BPSJPREG",36,0)
 ;
"RTN","BPSJPREG",37,0)
 ; only send Active or recently made inactive pharmacies, no reason to send
"RTN","BPSJPREG",38,0)
 ; inactive ones over and over
"RTN","BPSJPREG",39,0)
 S BPSZ=$G(^BPS(9002313.56,PHARMIX,0))
"RTN","BPSJPREG",40,0)
 I 'BPSJVAL,'$P(BPSZ,"^",10),'$P(BPSZ,"^",4) Q
"RTN","BPSJPREG",41,0)
 ;
"RTN","BPSJPREG",42,0)
 ; NPI Processing
"RTN","BPSJPREG",43,0)
 ; Get DropDeadDate and Date/Time Last Change
"RTN","BPSJPREG",44,0)
 N BPSJAPI,BPSJNPI,BPSJNDT,BPSJOP,BPSJOPS,BPSJDDD,NPKEY
"RTN","BPSJPREG",45,0)
 S BPSJDDD=$$NPIREQ^BPSNPI(DT)
"RTN","BPSJPREG",46,0)
 N NOW,%,%H,%I,X D NOW^%DTC S BPSJNDT=%
"RTN","BPSJPREG",47,0)
 ; Get OP site for pharmacy and NPIAPI
"RTN","BPSJPREG",48,0)
 S BPSJOP=0,BPSJAPI=""
"RTN","BPSJPREG",49,0)
 F  S BPSJOP=$O(^BPS(9002313.56,PHARMIX,"OPSITE",BPSJOP)) Q:'BPSJOP  D  I BPSJAPI'="" Q
"RTN","BPSJPREG",50,0)
 . S BPSJOPS=$G(^BPS(9002313.56,PHARMIX,"OPSITE",BPSJOP,0))
"RTN","BPSJPREG",51,0)
 . S BPSJAPI=$$NPI^BPSNPI("Pharmacy_ID",BPSJOPS)
"RTN","BPSJPREG",52,0)
 . I $P(BPSJAPI,U,1)=-1 S BPSJAPI="" Q
"RTN","BPSJPREG",53,0)
 . I $P(BPSJAPI,U)>0 S BPSJAPI=$P(BPSJAPI,U)
"RTN","BPSJPREG",54,0)
 ; Check for existing NPI
"RTN","BPSJPREG",55,0)
 S BPSJNPI=$P($G(^BPS(9002313.56,PHARMIX,"NPI")),U)
"RTN","BPSJPREG",56,0)
 I 'BPSJAPI,BPSJNPI,BPSJVAL<2 D
"RTN","BPSJPREG",57,0)
 . N DA,DIC,DIE,DINUM,DIR,DIRUT,DIROUT,DLAYGO,DR,DTOUT,DUOUT,X,Y
"RTN","BPSJPREG",58,0)
 . S DA=PHARMIX,DIE=$$ROOT^DILFD(9002313.56)
"RTN","BPSJPREG",59,0)
 . S DR="41.01///@;41.02///@" D ^DIE
"RTN","BPSJPREG",60,0)
 I BPSJAPI,BPSJVAL<2 D
"RTN","BPSJPREG",61,0)
 . S ^XTMP("BPSJ",0)=(BPSJNDT+7)_U_BPSJNDT_U_"BPS NPI HL7 DATA"
"RTN","BPSJPREG",62,0)
 . S ^XTMP("BPSJ","NPI",BPSJAPI)=PHARMIX_U_BPSJNDT
"RTN","BPSJPREG",63,0)
 ;
"RTN","BPSJPREG",64,0)
 ;  Get Link data from HL7 table
"RTN","BPSJPREG",65,0)
 S HLPRO="BPSJ REGISTER",(IPA,IPP)=""
"RTN","BPSJPREG",66,0)
 S HLLNK=$$FIND1^DIC(870,"",,"EPHARM OUT","B")
"RTN","BPSJPREG",67,0)
 I HLLNK S IPA=$$GET1^DIQ(870,HLLNK_",",400.01),IPP=$$GET1^DIQ(870,HLLNK_",",400.02)
"RTN","BPSJPREG",68,0)
 ;
"RTN","BPSJPREG",69,0)
 ;  Error if any missing data
"RTN","BPSJPREG",70,0)
 I IPA=""!(IPP="") S MCT=MCT+1,MSG(MCT)="IP Address or Port is not defined.  "
"RTN","BPSJPREG",71,0)
 ;
"RTN","BPSJPREG",72,0)
 ;  Initialize the HL7
"RTN","BPSJPREG",73,0)
 D INIT^HLFNC2(HLPRO,.HL)
"RTN","BPSJPREG",74,0)
 S HLFS=$G(HL("FS")) I HLFS="" S HLFS="|"
"RTN","BPSJPREG",75,0)
 S HLECH=$E($G(HL("ECH"),1)) I HLECH="" S HLECH="^"
"RTN","BPSJPREG",76,0)
 S HL("EPPORT")=IPP,HLEID=$$HLP^BPSJUTL(HLPRO)
"RTN","BPSJPREG",77,0)
 ;
"RTN","BPSJPREG",78,0)
 ;Get fileman date/time, ensuring seconds are included: 3031029.135636
"RTN","BPSJPREG",79,0)
 S HL7DTG=$E($$HTFM^XLFDT($H)_"000000",1,14)
"RTN","BPSJPREG",80,0)
 ;Set HL7 Date/Time format: 20031029135636-0400
"RTN","BPSJPREG",81,0)
 S HL7DTG=$$FMTHL7^XLFDT(HL7DTG)
"RTN","BPSJPREG",82,0)
 ;
"RTN","BPSJPREG",83,0)
 ;  Set the ZRP Segment
"RTN","BPSJPREG",84,0)
 D EN^BPSJZRP(.HL,PHARMIX,.ZRPSEG,BPSJAPI,.NCPDP)
"RTN","BPSJPREG",85,0)
 M ^TMP("HLS",$J,3)=ZRPSEG K ZRPSEG
"RTN","BPSJPREG",86,0)
 ;
"RTN","BPSJPREG",87,0)
 ;  Set the MFE segment
"RTN","BPSJPREG",88,0)
 N BPSMFE S BPSMFE="MUP"
"RTN","BPSJPREG",89,0)
 S NPKEY=$$NPKEY^BPSNPI(NCPDP,BPSJNPI,BPSJAPI)
"RTN","BPSJPREG",90,0)
 I NPKEY D
"RTN","BPSJPREG",91,0)
 . I '$$BPSACTV^BPSUTIL(PHARMIX) S BPSMFE="MDC"
"RTN","BPSJPREG",92,0)
 . S ^TMP("HLS",$J,2)="MFE"_HLFS_BPSMFE_HLFS_HLFS_HL7DTG
"RTN","BPSJPREG",93,0)
 . S ^TMP("HLS",$J,2)=^TMP("HLS",$J,2)_HLFS_NPKEY_HLFS_"ST"
"RTN","BPSJPREG",94,0)
 ;
"RTN","BPSJPREG",95,0)
 ;   Set the MFI segment
"RTN","BPSJPREG",96,0)
 S ^TMP("HLS",$J,1)="MFI"_HLFS_"Pharmacy Table"_HLFS_HLFS_"UPD"_HLFS
"RTN","BPSJPREG",97,0)
 S ^TMP("HLS",$J,1)=^TMP("HLS",$J,1)_HL7DTG_HLFS_HL7DTG_HLFS_"NE"
"RTN","BPSJPREG",98,0)
 ;
"RTN","BPSJPREG",99,0)
 S BPSJPRES=$$VAL2^BPSJVAL(BPSJVAL,BPSJDDD)  ; 0 = ok
"RTN","BPSJPREG",100,0)
 I BPSJVAL=3 G FINI   ; Just checking to see if data valid.
"RTN","BPSJPREG",101,0)
 ;
"RTN","BPSJPREG",102,0)
 ;-Check if msg valid.
"RTN","BPSJPREG",103,0)
 I 'BPSJPRES D  G FINI
"RTN","BPSJPREG",104,0)
 . N BPSHLRS
"RTN","BPSJPREG",105,0)
 . D GENERATE^HLMA(HLEID,"GM",1,.BPSHLRS,"")
"RTN","BPSJPREG",106,0)
 . I $P($G(BPSHLRS),U,2)]"" D  Q
"RTN","BPSJPREG",107,0)
 .. I BPSJVAL D  Q   ; Interactive: show no success
"RTN","BPSJPREG",108,0)
 ... W !!,"ECME Pharmacy Registration HL7 Message not created: "_BPSHLRS
"RTN","BPSJPREG",109,0)
 ... W !," PHARMIX: "_PHARMIX_""
"RTN","BPSJPREG",110,0)
 .. S MCT=MCT+1,MSG(MCT)="ECME Pharmacy Registration HL7 Message not created. (PHARMIX: "_PHARMIX_")"
"RTN","BPSJPREG",111,0)
 .. S MCT=MCT+1,MSG(MCT)=BPSHLRS
"RTN","BPSJPREG",112,0)
 .. D MSG^BPSJUTL(.MSG,"ECME Pharmacy Registration")
"RTN","BPSJPREG",113,0)
 . ; update last status sent
"RTN","BPSJPREG",114,0)
 . S $P(^BPS(9002313.56,PHARMIX,0),"^",4)=$P(^BPS(9002313.56,PHARMIX,0),"^",10)
"RTN","BPSJPREG",115,0)
 . I BPSJVAL D    ;Interactive: show success
"RTN","BPSJPREG",116,0)
 .. W !!,"ECME Pharmacy Registration HL7 Message was created successfully."
"RTN","BPSJPREG",117,0)
 ;
"RTN","BPSJPREG",118,0)
 ;
"RTN","BPSJPREG",119,0)
FINI ; Clean up
"RTN","BPSJPREG",120,0)
 K ^TMP("HLS",$J)
"RTN","BPSJPREG",121,0)
 Q
"RTN","BPSJUTL")
0^64^B9363342
"RTN","BPSJUTL",1,0)
BPSJUTL ;BHAM ISC/LJF - e-Pharmacy Utils ;4/17/08  16:13
"RTN","BPSJUTL",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,2,5,7**;JUN 2004;Build 46
"RTN","BPSJUTL",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSJUTL",4,0)
 ;
"RTN","BPSJUTL",5,0)
HLP(PROTOCOL) ;  Find the Protocol IEN
"RTN","BPSJUTL",6,0)
 Q +$O(^ORD(101,"B",PROTOCOL,0))
"RTN","BPSJUTL",7,0)
 ;
"RTN","BPSJUTL",8,0)
VAHL7ECH(HL) ; Hl7 Encoding Characters
"RTN","BPSJUTL",9,0)
 S FS=$G(HL("FS")) I FS="" S FS="|"
"RTN","BPSJUTL",10,0)
 S ECH=$G(HL("ECH")) I ECH="" S ECH="^~\&"
"RTN","BPSJUTL",11,0)
 S CPS=$E(ECH),REP=$E(ECH,2)
"RTN","BPSJUTL",12,0)
 ;
"RTN","BPSJUTL",13,0)
 Q
"RTN","BPSJUTL",14,0)
 ;
"RTN","BPSJUTL",15,0)
MSG(BPSJMM,BPSJRTN) ; Message Handler
"RTN","BPSJUTL",16,0)
 ;
"RTN","BPSJUTL",17,0)
 N XMDUZ,XMSUB,XMY,XMTEXT,XMZ,BPSX,BPSY
"RTN","BPSJUTL",18,0)
 ;
"RTN","BPSJUTL",19,0)
 I $G(BPSJRTN)]"" S BPSJMM(.0001)="Source Process: "_BPSJRTN
"RTN","BPSJUTL",20,0)
 F BPSX=1,2 S BPSY=$P($G(^BPS(9002313.99,1,"VITRIA")),"^",BPSX) I BPSY S XMY(BPSY)="" S:$L($G(^VA(200,BPSY,.15))) XMY(^(.15))=""
"RTN","BPSJUTL",21,0)
 Q:'$D(XMY)
"RTN","BPSJUTL",22,0)
 S XMTEXT="BPSJMM(",XMSUB="ECME Registration Problem.",XMDUZ="ECME PACKAGE"
"RTN","BPSJUTL",23,0)
 D ^XMD
"RTN","BPSJUTL",24,0)
 ;
"RTN","BPSJUTL",25,0)
 Q
"RTN","BPSJUTL",26,0)
 ;
"RTN","BPSJUTL",27,0)
VA200NM(VAIX,VATITLE,HL) ;
"RTN","BPSJUTL",28,0)
 ;
"RTN","BPSJUTL",29,0)
 N RETDATA,BPSNMDAT
"RTN","BPSJUTL",30,0)
 N FS,CPS,REP
"RTN","BPSJUTL",31,0)
 ;
"RTN","BPSJUTL",32,0)
 I '$G(VAIX) Q ""
"RTN","BPSJUTL",33,0)
 S BPSNMDAT=$P($G(^VA(200,VAIX,0)),U,1) I BPSNMDAT="" Q ""
"RTN","BPSJUTL",34,0)
 ;
"RTN","BPSJUTL",35,0)
 D VAHL7ECH(.HL)
"RTN","BPSJUTL",36,0)
 D STDNAME^XLFNAME(.BPSNMDAT,"C")
"RTN","BPSJUTL",37,0)
 ;
"RTN","BPSJUTL",38,0)
 S RETDATA=$G(BPSNMDAT("FAMILY"))              ;1
"RTN","BPSJUTL",39,0)
 S RETDATA=RETDATA_CPS_$G(BPSNMDAT("GIVEN"))   ;2
"RTN","BPSJUTL",40,0)
 S RETDATA=RETDATA_CPS_$G(BPSNMDAT("MIDDLE"))  ;3
"RTN","BPSJUTL",41,0)
 S RETDATA=RETDATA_CPS_$G(BPSNMDAT("SUFFIX"))  ;4
"RTN","BPSJUTL",42,0)
 S RETDATA=RETDATA_CPS_$G(BPSNMDAT("PREFIX"))  ;5
"RTN","BPSJUTL",43,0)
 S RETDATA=RETDATA_CPS_$G(BPSNMDAT("DEGREE"))  ;6
"RTN","BPSJUTL",44,0)
 ;
"RTN","BPSJUTL",45,0)
 S VATITLE=$P($G(^VA(200,VAIX,0)),U,9)
"RTN","BPSJUTL",46,0)
 I VATITLE S VATITLE=$G(^DIC(3.1,VATITLE,0))
"RTN","BPSJUTL",47,0)
 ;
"RTN","BPSJUTL",48,0)
 Q RETDATA
"RTN","BPSJUTL",49,0)
 ;
"RTN","BPSJUTL",50,0)
VA20013(VAIX,HL) ; Build the HL7 Contact Means data field
"RTN","BPSJUTL",51,0)
 ;
"RTN","BPSJUTL",52,0)
 N FDATA,RETDATA
"RTN","BPSJUTL",53,0)
 N FS,CPS,REP
"RTN","BPSJUTL",54,0)
 ;
"RTN","BPSJUTL",55,0)
 I '$G(VAIX) Q ""
"RTN","BPSJUTL",56,0)
 ; VAIX is the index to ^VA(200,n
"RTN","BPSJUTL",57,0)
 D VAHL7ECH(.HL)
"RTN","BPSJUTL",58,0)
 S RETDATA=$P($G(^VA(200,VAIX,.15)),U,1)   ; LJF@DAOU.COM
"RTN","BPSJUTL",59,0)
 I RETDATA]"",RETDATA["@" S RETDATA=CPS_"NET"_CPS_"INTERNET"_CPS_RETDATA
"RTN","BPSJUTL",60,0)
 S FDATA=$$EN^BPSJPHNM(VAIX,CPS,REP)
"RTN","BPSJUTL",61,0)
 I $L(FDATA) D
"RTN","BPSJUTL",62,0)
 . I $L(RETDATA) S RETDATA=RETDATA_REP
"RTN","BPSJUTL",63,0)
 . S RETDATA=RETDATA_FDATA
"RTN","BPSJUTL",64,0)
 Q RETDATA
"RTN","BPSJUTL",65,0)
 ;
"RTN","BPSJUTL",66,0)
ENCODE(INSTR,TCH) ;  Encode data - Primarily HL7
"RTN","BPSJUTL",67,0)
 N X,WCHR,OSTR
"RTN","BPSJUTL",68,0)
 S OSTR=""
"RTN","BPSJUTL",69,0)
 I $G(INSTR)]"" F X=1:1:$L(INSTR) D  S OSTR=OSTR_WCHR
"RTN","BPSJUTL",70,0)
 . S WCHR=$E(INSTR,X) I $D(TCH(WCHR)) S WCHR=TCH(WCHR)
"RTN","BPSJUTL",71,0)
 Q OSTR
"RTN","BPSJUTL",72,0)
 ;
"RTN","BPSJUTL",73,0)
SPAR(HL,BPSJSEG,HCTS) ;  Segment Parsing
"RTN","BPSJUTL",74,0)
 N II,IJ,IK,ISDATA
"RTN","BPSJUTL",75,0)
 N FS,CPS,REP,ECH
"RTN","BPSJUTL",76,0)
 ;
"RTN","BPSJUTL",77,0)
 I '$G(HCTS) Q
"RTN","BPSJUTL",78,0)
 ;
"RTN","BPSJUTL",79,0)
 D VAHL7ECH(.HL)
"RTN","BPSJUTL",80,0)
 M ISDATA=^TMP($J,"BPSJHLI",HCTS)
"RTN","BPSJUTL",81,0)
 S IK=0,IJ=1,II=""
"RTN","BPSJUTL",82,0)
 F  S II=$O(ISDATA(II)) Q:II=""  D
"RTN","BPSJUTL",83,0)
 . S ISDATA=$G(ISDATA(II)) Q:ISDATA=""
"RTN","BPSJUTL",84,0)
 . F  D  Q:ISDATA=""
"RTN","BPSJUTL",85,0)
 . . S IK=IK+1,BPSJSEG(IJ,IK)=$P(ISDATA,FS)
"RTN","BPSJUTL",86,0)
 . . S $P(ISDATA,FS)=""
"RTN","BPSJUTL",87,0)
 . . I $E(ISDATA)=FS S IJ=IJ+1,$E(ISDATA)=""
"RTN","BPSJUTL",88,0)
 ;
"RTN","BPSJUTL",89,0)
 ; Promote data in 1st subnode and kill subnode
"RTN","BPSJUTL",90,0)
 S II=""
"RTN","BPSJUTL",91,0)
 F  S II=$O(BPSJSEG(II)) Q:II=""  D
"RTN","BPSJUTL",92,0)
 . S IJ=$O(BPSJSEG(II,"")) Q:'IJ
"RTN","BPSJUTL",93,0)
 . S BPSJSEG(II)=BPSJSEG(II,IJ) K BPSJSEG(II,IJ)
"RTN","BPSJUTL",94,0)
 Q
"RTN","BPSJVAL1")
0^41^B16799335
"RTN","BPSJVAL1",1,0)
BPSJVAL1 ;BHAM ISC/LJF - Pharmacy Application Validation ;3/5/08  11:17
"RTN","BPSJVAL1",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5,7**;JUN 2004;Build 46
"RTN","BPSJVAL1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSJVAL1",4,0)
 ;
"RTN","BPSJVAL1",5,0)
 N BPSJVAL1,VERBOSE
"RTN","BPSJVAL1",6,0)
 W !!!,"SITE REGISTRATION VALIDATION.",!
"RTN","BPSJVAL1",7,0)
 D BPSJVAL^BPSJAREG(2)
"RTN","BPSJVAL1",8,0)
 W !!!!
"RTN","BPSJVAL1",9,0)
 ;
"RTN","BPSJVAL1",10,0)
 Q
"RTN","BPSJVAL1",11,0)
 ;
"RTN","BPSJVAL1",12,0)
VALIDATE ; Validate ZQR Data
"RTN","BPSJVAL1",13,0)
 ;
"RTN","BPSJVAL1",14,0)
 N SEG,SEGIX,ZQR,RIX,PIX,PIXL,SEGDAT,ZNOTE,ZMAX
"RTN","BPSJVAL1",15,0)
 N HL7EOIEN,HL7EOIP
"RTN","BPSJVAL1",16,0)
 N HL7VOIEN,HL7VOIP
"RTN","BPSJVAL1",17,0)
 N HL7EDOM,HL7PDOM,HL7OPORT,HL7PORT,CMA
"RTN","BPSJVAL1",18,0)
 ;
"RTN","BPSJVAL1",19,0)
 ; Constants
"RTN","BPSJVAL1",20,0)
 S HL7PORT=5105,ZMAX=8,CMA=","
"RTN","BPSJVAL1",21,0)
 S HL7PDOM=$S($$PROD^XUPROD:"EPHARMACY.VITRIA-EDI.AAC.VA.GOV",1:"EPHARMACY.VITRIA-EDI-TEST.AAC.VA.GOV")
"RTN","BPSJVAL1",22,0)
 ;
"RTN","BPSJVAL1",23,0)
 S RETCODE=+$G(RETCODE)
"RTN","BPSJVAL1",24,0)
 S ZQR="",RIX=0
"RTN","BPSJVAL1",25,0)
 ;
"RTN","BPSJVAL1",26,0)
 S HL7EOIEN=$$FIND1^DIC(870,"",,"EPHARM OUT","B")_CMA   ;EPHARM OUT
"RTN","BPSJVAL1",27,0)
 S HL7VOIEN=$$FIND1^DIC(870,"",,"IIV EC","B")_CMA       ;IIV EC
"RTN","BPSJVAL1",28,0)
 ;
"RTN","BPSJVAL1",29,0)
 ; Vitria Domain name
"RTN","BPSJVAL1",30,0)
 S HL7EDOM=$$GET1^DIQ(870,HL7EOIEN,.03)   ;EPHARM OUT
"RTN","BPSJVAL1",31,0)
 I HL7EDOM=HL7PDOM S ZNOTE="   DOMAIN NAME - Required - VALID: "_HL7PDOM
"RTN","BPSJVAL1",32,0)
 E  D
"RTN","BPSJVAL1",33,0)
 . I HL7EDOM="" S ZNOTE="** DOMAIN NAME - Required - INVALID" S RETCODE=.3 Q
"RTN","BPSJVAL1",34,0)
 . S ZNOTE=" * WARNING: EXPECTED DOMAIN NAME: "_HL7PDOM_"                            CURRENT DOMAIN NAME: "_HL7EDOM
"RTN","BPSJVAL1",35,0)
 S RETCODE(.3)=ZNOTE
"RTN","BPSJVAL1",36,0)
 I +$G(VERBOSE) W !,RETCODE(.3)
"RTN","BPSJVAL1",37,0)
 ;
"RTN","BPSJVAL1",38,0)
 ; Get IP addresses
"RTN","BPSJVAL1",39,0)
 S HL7EOIP=$$GET1^DIQ(870,HL7EOIEN,400.01)   ;EPHARM OUT
"RTN","BPSJVAL1",40,0)
 S HL7VOIP=$$GET1^DIQ(870,HL7VOIEN,400.01)   ;IIV EC
"RTN","BPSJVAL1",41,0)
 ;
"RTN","BPSJVAL1",42,0)
 I HL7EOIP,HL7EOIP=HL7VOIP S ZNOTE="   TCP/IP ADDRESS FOR ""EPHARM OUT"" - Required - VALID: "_HL7EOIP
"RTN","BPSJVAL1",43,0)
 E  D
"RTN","BPSJVAL1",44,0)
 . I 'HL7EOIP S ZNOTE="** TCP/IP ADDRESS FOR ""EPHARM OUT"" - Required - INVALID",RETCODE=.7 Q
"RTN","BPSJVAL1",45,0)
 . I HL7VOIP,HL7EOIP'=HL7VOIP S ZNOTE=" * WARNING: ""EPHARM OUT"" TCP/IP ADDRESS DIFFERENT THAN ""IIV EC"" TCP/IP ADDRESS.        EPHARM OUT: "_HL7EOIP_"   IIV EC: "_HL7VOIP
"RTN","BPSJVAL1",46,0)
 S RETCODE(.7)=ZNOTE
"RTN","BPSJVAL1",47,0)
 I +$G(VERBOSE) W !,RETCODE(.7)
"RTN","BPSJVAL1",48,0)
 ;
"RTN","BPSJVAL1",49,0)
 ; Get Outgoing Port and IP Address
"RTN","BPSJVAL1",50,0)
 S HL7OPORT=$$GET1^DIQ(870,HL7EOIEN,400.02)   ;EPHARM OUT
"RTN","BPSJVAL1",51,0)
 I HL7OPORT,HL7OPORT=HL7PORT S ZNOTE="   ""EPHARM OUT"" PORT NUMBER - Required - VALID: "_HL7OPORT
"RTN","BPSJVAL1",52,0)
 E  D
"RTN","BPSJVAL1",53,0)
 . S ZNOTE=" * WARNING: EXPECTED ""EPHARM OUT"" PORT NUMBER: "_HL7PORT
"RTN","BPSJVAL1",54,0)
 . S ZNOTE=ZNOTE_"                                         CURRENT "
"RTN","BPSJVAL1",55,0)
 . S ZNOTE=ZNOTE_"""EPHARM OUT"" PORT NUMBER: "_HL7OPORT
"RTN","BPSJVAL1",56,0)
 . I 'HL7OPORT S ZNOTE="** ""EPHARM OUT"" PORT NUMBER - Required - INVALID",RETCODE=.9 Q
"RTN","BPSJVAL1",57,0)
 S RETCODE(.9)=ZNOTE
"RTN","BPSJVAL1",58,0)
 I +$G(VERBOSE) W !,RETCODE(.9)
"RTN","BPSJVAL1",59,0)
 ;
"RTN","BPSJVAL1",60,0)
 F SEGIX=3:1 S SEG=$G(^TMP("HLS",$J,SEGIX)),PIX=0 Q:SEG=""  D
"RTN","BPSJVAL1",61,0)
 . I $E(SEG,1,3)="ZQR" S ZQR=$E(SEG,4) S $E(SEG,1,4)=""
"RTN","BPSJVAL1",62,0)
 . I ZQR="" Q
"RTN","BPSJVAL1",63,0)
 . S PIXL=$L(SEG,ZQR)
"RTN","BPSJVAL1",64,0)
 . F  S RIX=RIX+1,PIX=PIX+1 Q:RIX>ZMAX  D
"RTN","BPSJVAL1",65,0)
 .. S RETCODE(RIX)=$P(SEG,ZQR,PIX) D @RIX
"RTN","BPSJVAL1",66,0)
 .. ; RIX 4 - EPHARM IN Port - no longer required nor validated
"RTN","BPSJVAL1",67,0)
 .. I +$G(VERBOSE),$L($G(RETCODE(RIX))),RIX'=4 W !,RETCODE(RIX) Q
"RTN","BPSJVAL1",68,0)
 ;
"RTN","BPSJVAL1",69,0)
 Q
"RTN","BPSJVAL1",70,0)
 ; NS=Not Supported, R=Required, RE=Required or empty, C=Conditional
"RTN","BPSJVAL1",71,0)
 ; CE=Conditional or empty, O=Optional,
"RTN","BPSJVAL1",72,0)
 ;
"RTN","BPSJVAL1",73,0)
1 ; Set ID - NS
"RTN","BPSJVAL1",74,0)
 Q
"RTN","BPSJVAL1",75,0)
2 ; Site Number - R
"RTN","BPSJVAL1",76,0)
 S ZNOTE="   SITE NUMBER - Required - VALID: "_RETCODE(RIX)
"RTN","BPSJVAL1",77,0)
 I RETCODE(RIX)="" S ZNOTE="** SITE NUMBER - Required - INVALID",RETCODE=2
"RTN","BPSJVAL1",78,0)
 S RETCODE(RIX)=ZNOTE
"RTN","BPSJVAL1",79,0)
 Q
"RTN","BPSJVAL1",80,0)
3 ; Interface Version - R
"RTN","BPSJVAL1",81,0)
 ;     Must equal 2 or greater for this validation version
"RTN","BPSJVAL1",82,0)
 S ZNOTE="   INTERFACE VERSION - Required - VALID: "
"RTN","BPSJVAL1",83,0)
 I RETCODE(RIX)<2 S ZNOTE="** INTERFACE VERSION - Required - INVALID: ",RETCODE=3
"RTN","BPSJVAL1",84,0)
 S RETCODE(RIX)=ZNOTE_RETCODE(RIX)
"RTN","BPSJVAL1",85,0)
 Q
"RTN","BPSJVAL1",86,0)
4 ; EPHARM IN port - NS
"RTN","BPSJVAL1",87,0)
 Q
"RTN","BPSJVAL1",88,0)
5 ; Contact Name
"RTN","BPSJVAL1",89,0)
 S RETCODE(RIX)="   CONTACT NAME - VALID: "_$$FMNAME^HLFNC(RETCODE(RIX))
"RTN","BPSJVAL1",90,0)
 Q
"RTN","BPSJVAL1",91,0)
6 ; Contact Means
"RTN","BPSJVAL1",92,0)
 S RETCODE(RIX)="   CONTACT MEANS - VALID: "_$P($TR(RETCODE(RIX),"^"," "),"~")
"RTN","BPSJVAL1",93,0)
 Q
"RTN","BPSJVAL1",94,0)
7 ; Alternate Contact NAME
"RTN","BPSJVAL1",95,0)
 S RETCODE(RIX)="   ALTERNATE CONTACT NAME - VALID: "_$$FMNAME^HLFNC(RETCODE(RIX))
"RTN","BPSJVAL1",96,0)
 Q
"RTN","BPSJVAL1",97,0)
8 ; Alternate Contact Means
"RTN","BPSJVAL1",98,0)
 S RETCODE(RIX)="   ALTERNATE CONTACT MEANS - VALID: "_$P($TR(RETCODE(RIX),"^"," "),"~")
"RTN","BPSJVAL1",99,0)
 Q
"RTN","BPSJVAL2")
0^90^B28993477
"RTN","BPSJVAL2",1,0)
BPSJVAL2 ;BHAM ISC/LJF - Validate Pharmacy data ;3/5/08  11:14
"RTN","BPSJVAL2",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,2,5,7**;JUN 2004;Build 46
"RTN","BPSJVAL2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSJVAL2",4,0)
 ;
"RTN","BPSJVAL2",5,0)
 N PHARMIX,RET,DIR,X
"RTN","BPSJVAL2",6,0)
 ;
"RTN","BPSJVAL2",7,0)
 S PHARMIX=0,X=""
"RTN","BPSJVAL2",8,0)
 F  S PHARMIX=$O(^BPS(9002313.56,PHARMIX)) Q:'PHARMIX  D  Q:X=U
"RTN","BPSJVAL2",9,0)
 . W !!,"VERIFY PHARMACY REGISTRATIONS DATA.",!
"RTN","BPSJVAL2",10,0)
 . D REG^BPSJPREG(PHARMIX,2)
"RTN","BPSJVAL2",11,0)
 . W !
"RTN","BPSJVAL2",12,0)
 . S DIR(0)="EO" D ^DIR
"RTN","BPSJVAL2",13,0)
 ;
"RTN","BPSJVAL2",14,0)
 Q
"RTN","BPSJVAL2",15,0)
 ;
"RTN","BPSJVAL2",16,0)
 ; Array HL and variable VERBOSE newed/set by calling routine
"RTN","BPSJVAL2",17,0)
 ; RETCODE returned to calling routine
"RTN","BPSJVAL2",18,0)
VALIDATE(BPSJDDD) ;
"RTN","BPSJVAL2",19,0)
 N SEG,SEGIX,ZRP,RAY,RIX,PIX,PIXL,SEGDAT,ZNOTE,ZMAX,CPS,FS,REP
"RTN","BPSJVAL2",20,0)
 N VALDATA,TMP
"RTN","BPSJVAL2",21,0)
 S ZMAX=17
"RTN","BPSJVAL2",22,0)
 ;
"RTN","BPSJVAL2",23,0)
 S RETCODE=$G(RETCODE)
"RTN","BPSJVAL2",24,0)
 S ZRP="",RIX=0
"RTN","BPSJVAL2",25,0)
 ;
"RTN","BPSJVAL2",26,0)
 ; Set HL7 Delimiters - use standard defaults if none provided
"RTN","BPSJVAL2",27,0)
 S FS=$G(HL("FS")) I FS="" S FS="|"
"RTN","BPSJVAL2",28,0)
 S CPS=$E($G(HL("ECH"))) I CPS="" S CPS="^"
"RTN","BPSJVAL2",29,0)
 S REP=$E($G(HL("ECH")),2) I REP="" S REP="~"
"RTN","BPSJVAL2",30,0)
 ;
"RTN","BPSJVAL2",31,0)
 F SEGIX=3:1 S SEG=$G(^TMP("HLS",$J,SEGIX)),PIX=0 Q:SEG=""  D  I ZRP]"" Q
"RTN","BPSJVAL2",32,0)
 . I $E(SEG,1,3)="ZRP" S ZRP=$E(SEG,4) S $E(SEG,1,4)=""
"RTN","BPSJVAL2",33,0)
 I ZRP="" Q
"RTN","BPSJVAL2",34,0)
 F  S RIX=$O(^TMP("HLS",$J,SEGIX,RIX)) Q:'RIX  I RIX<(ZMAX+1) D
"RTN","BPSJVAL2",35,0)
 . S TMP=$P($G(^TMP("HLS",$J,SEGIX,RIX)),ZRP)
"RTN","BPSJVAL2",36,0)
 . I $G(TMP)="" S RETCODE(RIX)=""
"RTN","BPSJVAL2",37,0)
 . I RIX=3 S RETCODE(RIX)=TMP ;capture pharmacy name
"RTN","BPSJVAL2",38,0)
 F  S RIX=$O(RETCODE(RIX)) Q:'RIX  D
"RTN","BPSJVAL2",39,0)
 . D @RIX
"RTN","BPSJVAL2",40,0)
 . I +$G(VERBOSE),$L($G(RETCODE(RIX))) W !,RETCODE(RIX)
"RTN","BPSJVAL2",41,0)
 ;
"RTN","BPSJVAL2",42,0)
 Q
"RTN","BPSJVAL2",43,0)
 ;
"RTN","BPSJVAL2",44,0)
 ; NS=Not Supported, R=Required, RE=Required or empty, C=Conditional
"RTN","BPSJVAL2",45,0)
 ; CE=Conditional or empty, O=Optional,
"RTN","BPSJVAL2",46,0)
 ;
"RTN","BPSJVAL2",47,0)
1 ; Set ID - NS
"RTN","BPSJVAL2",48,0)
 Q
"RTN","BPSJVAL2",49,0)
2 ; NCPDP Number - C
"RTN","BPSJVAL2",50,0)
 S ZNOTE="   NCPDP NUMBER - VALID"
"RTN","BPSJVAL2",51,0)
 I RETCODE(RIX)="" D
"RTN","BPSJVAL2",52,0)
 . I BPSJDDD=0 D
"RTN","BPSJVAL2",53,0)
 . . I '$D(RETCODE(17)) Q
"RTN","BPSJVAL2",54,0)
 . . S ZNOTE="** NCPDP NUMBER - NCPDP OR NPI - Missing/Invalid",RETCODE=2
"RTN","BPSJVAL2",55,0)
 . . S RETCODE(RIX)=ZNOTE_RETCODE(RIX)
"RTN","BPSJVAL2",56,0)
 Q
"RTN","BPSJVAL2",57,0)
3 ; PHARMACY NAME - R
"RTN","BPSJVAL2",58,0)
 S ZNOTE="   PHARMACY NAME"
"RTN","BPSJVAL2",59,0)
 I RETCODE(RIX)="" D
"RTN","BPSJVAL2",60,0)
 . S ZNOTE="** PHARMACY NAME - Missing/Invalid",RETCODE=3
"RTN","BPSJVAL2",61,0)
 I RETCODE(RIX)]"" S RETCODE(RIX)=": "_$$DECODE(RETCODE(RIX))
"RTN","BPSJVAL2",62,0)
 S RETCODE(RIX)=ZNOTE_RETCODE(RIX)
"RTN","BPSJVAL2",63,0)
 Q
"RTN","BPSJVAL2",64,0)
4 ; DEA Number - R
"RTN","BPSJVAL2",65,0)
 S ZNOTE="   DEA NUMBER - Required - VALID"
"RTN","BPSJVAL2",66,0)
 I RETCODE(RIX)="" D
"RTN","BPSJVAL2",67,0)
 . S ZNOTE="** DEA NUMBER - Missing/Invalid",RETCODE=4
"RTN","BPSJVAL2",68,0)
 . S RETCODE(RIX)=ZNOTE_RETCODE(RIX)
"RTN","BPSJVAL2",69,0)
 Q
"RTN","BPSJVAL2",70,0)
5 ; Hour of Operation
"RTN","BPSJVAL2",71,0)
 S ZNOTE="" ; not sending anymore
"RTN","BPSJVAL2",72,0)
 Q
"RTN","BPSJVAL2",73,0)
6 ; Mailing Address - R
"RTN","BPSJVAL2",74,0)
 S ZNOTE=$$TRIMTAIL(RETCODE(RIX))
"RTN","BPSJVAL2",75,0)
 S VALDATA=($L($P(ZNOTE,CPS,1))<1)          ; Street address
"RTN","BPSJVAL2",76,0)
 S VALDATA=($L($P(ZNOTE,CPS,3))<1)+VALDATA  ; City
"RTN","BPSJVAL2",77,0)
 S VALDATA=($L($P(ZNOTE,CPS,4))<1)+VALDATA  ; State
"RTN","BPSJVAL2",78,0)
 S VALDATA=($L($P(ZNOTE,CPS,5))<1)+VALDATA  ; Zip
"RTN","BPSJVAL2",79,0)
 S ZNOTE="   MAILING ADDRESS - Required - VALID"
"RTN","BPSJVAL2",80,0)
 I VALDATA D
"RTN","BPSJVAL2",81,0)
 . S ZNOTE="** MAILING ADDRESS - Missing/Invalid",RETCODE=6
"RTN","BPSJVAL2",82,0)
 . S RETCODE(RIX)=ZNOTE_RETCODE(RIX)
"RTN","BPSJVAL2",83,0)
 Q
"RTN","BPSJVAL2",84,0)
7 ; Remittance Address - R
"RTN","BPSJVAL2",85,0)
 S ZNOTE=$$TRIMTAIL(RETCODE(RIX))
"RTN","BPSJVAL2",86,0)
 S VALDATA=($L($P(ZNOTE,CPS,1))<1)          ; Street Address
"RTN","BPSJVAL2",87,0)
 S VALDATA=($L($P(ZNOTE,CPS,3))<1)+VALDATA  ; City
"RTN","BPSJVAL2",88,0)
 S VALDATA=($L($P(ZNOTE,CPS,4))<1)+VALDATA  ; State
"RTN","BPSJVAL2",89,0)
 S VALDATA=($L($P(ZNOTE,CPS,5))<1)+VALDATA  ; Zip
"RTN","BPSJVAL2",90,0)
 S ZNOTE="   REMITTANCE ADDRESS - Required - VALID"
"RTN","BPSJVAL2",91,0)
 I VALDATA D
"RTN","BPSJVAL2",92,0)
 . S ZNOTE="** REMITTANCE ADDRESS - Missing/Invalid",RETCODE=7
"RTN","BPSJVAL2",93,0)
 . S RETCODE(RIX)=ZNOTE_RETCODE(RIX)
"RTN","BPSJVAL2",94,0)
 Q
"RTN","BPSJVAL2",95,0)
8 ; Contact Name
"RTN","BPSJVAL2",96,0)
 S ZNOTE=$$TRIMTAIL(RETCODE(RIX))
"RTN","BPSJVAL2",97,0)
 S VALDATA=($L($P(ZNOTE,CPS,1))<1)  ; Surname
"RTN","BPSJVAL2",98,0)
 S ZNOTE="   CONTACT NAME - Required - VALID"
"RTN","BPSJVAL2",99,0)
 I VALDATA D
"RTN","BPSJVAL2",100,0)
 . S ZNOTE="** CONTACT NAME - Missing/Invalid",RETCODE=8
"RTN","BPSJVAL2",101,0)
 . S RETCODE(RIX)=ZNOTE_RETCODE(RIX)
"RTN","BPSJVAL2",102,0)
 Q
"RTN","BPSJVAL2",103,0)
9 ; Contact Title
"RTN","BPSJVAL2",104,0)
 S ZNOTE="   CONTACT TITLE - VALID"
"RTN","BPSJVAL2",105,0)
 Q
"RTN","BPSJVAL2",106,0)
10 ; Contact means
"RTN","BPSJVAL2",107,0)
 S ZNOTE="   CONTACT MEANS - VALID"
"RTN","BPSJVAL2",108,0)
 ;S RETCODE(RIX)=ZNOTE_RETCODE(RIX)
"RTN","BPSJVAL2",109,0)
 Q
"RTN","BPSJVAL2",110,0)
11 ; Alternate Contact Name
"RTN","BPSJVAL2",111,0)
 S ZNOTE=$$TRIMTAIL(RETCODE(RIX))
"RTN","BPSJVAL2",112,0)
 S VALDATA=($L($P(ZNOTE,CPS,1))<1)  ; Surname
"RTN","BPSJVAL2",113,0)
 S ZNOTE="   ALTERNATE CONTACT NAME - Required - VALID"
"RTN","BPSJVAL2",114,0)
 I VALDATA D
"RTN","BPSJVAL2",115,0)
 . S ZNOTE="** ALTERNATE CONTACT NAME - Missing/Invalid",RETCODE=11
"RTN","BPSJVAL2",116,0)
 . S RETCODE(RIX)=ZNOTE_RETCODE(RIX)
"RTN","BPSJVAL2",117,0)
 Q
"RTN","BPSJVAL2",118,0)
12 ; Alternate Contact Title
"RTN","BPSJVAL2",119,0)
 S ZNOTE="   ALTERNATE CONTACT TITLE - VALID"
"RTN","BPSJVAL2",120,0)
 Q
"RTN","BPSJVAL2",121,0)
13 ; Alternate Contact means
"RTN","BPSJVAL2",122,0)
 S ZNOTE="   ALTERNATE CONTACT MEANS - VALID"
"RTN","BPSJVAL2",123,0)
 Q
"RTN","BPSJVAL2",124,0)
14 ; Lead Pharmacist Name - R
"RTN","BPSJVAL2",125,0)
 S ZNOTE=$$TRIMTAIL(RETCODE(RIX))
"RTN","BPSJVAL2",126,0)
 S VALDATA=($L($P(ZNOTE,CPS,1))<1)  ; Surname
"RTN","BPSJVAL2",127,0)
 S ZNOTE="   LEAD PHARMACIST NAME - Required - VALID"
"RTN","BPSJVAL2",128,0)
 I VALDATA D
"RTN","BPSJVAL2",129,0)
 . S ZNOTE="** LEAD PHARMACIST NAME - Missing/Invalid",RETCODE=14
"RTN","BPSJVAL2",130,0)
 . S RETCODE(RIX)=ZNOTE_RETCODE(RIX)
"RTN","BPSJVAL2",131,0)
 Q
"RTN","BPSJVAL2",132,0)
15 ; Lead Pharmacist Title
"RTN","BPSJVAL2",133,0)
 S ZNOTE="   LEAD PHARMACIST TITLE - VALID"
"RTN","BPSJVAL2",134,0)
 Q
"RTN","BPSJVAL2",135,0)
16 ; Lead Pharmacist License Number
"RTN","BPSJVAL2",136,0)
 S ZNOTE="   LEAD PHARMACIST LICENSE NUMBER - VALID"
"RTN","BPSJVAL2",137,0)
 Q
"RTN","BPSJVAL2",138,0)
17 ; NPI Number - C (R - AFTER DDD)
"RTN","BPSJVAL2",139,0)
 S ZNOTE="   NPI NUMBER - Required - VALID "
"RTN","BPSJVAL2",140,0)
 I RETCODE(RIX)="" D
"RTN","BPSJVAL2",141,0)
 . I BPSJDDD=0 D
"RTN","BPSJVAL2",142,0)
 . . I '$D(RETCODE(2)) S ZNOTE="   NPI NUMBER - Warning NPI NUMBER Missing " Q
"RTN","BPSJVAL2",143,0)
 . . S ZNOTE="** NPI NUMBER - NPI OR NCPDP - Missing/Invalid" S RETCODE=17
"RTN","BPSJVAL2",144,0)
 . I BPSJDDD>0 D
"RTN","BPSJVAL2",145,0)
 . . S ZNOTE="** NPI NUMBER - Missing/Invalid" S RETCODE=17
"RTN","BPSJVAL2",146,0)
 . S RETCODE(RIX)=ZNOTE_RETCODE(RIX)
"RTN","BPSJVAL2",147,0)
 Q
"RTN","BPSJVAL2",148,0)
 ;
"RTN","BPSJVAL2",149,0)
TRIMTAIL(INSTR) ;
"RTN","BPSJVAL2",150,0)
 N OUTSTR,CHR
"RTN","BPSJVAL2",151,0)
 ;
"RTN","BPSJVAL2",152,0)
 I $G(INSTR)="" Q ""   ; quit if nothing there
"RTN","BPSJVAL2",153,0)
 ;
"RTN","BPSJVAL2",154,0)
 S INSTR=$RE(INSTR)
"RTN","BPSJVAL2",155,0)
 S CHR=$E($TR(INSTR,CPS_REP))
"RTN","BPSJVAL2",156,0)
 I CHR]"" Q $RE($P(INSTR,CHR,2,200))_CHR
"RTN","BPSJVAL2",157,0)
 Q ""
"RTN","BPSJVAL2",158,0)
 ;
"RTN","BPSJVAL2",159,0)
 ; DECODE - Normalize data for display
"RTN","BPSJVAL2",160,0)
 ; Input:
"RTN","BPSJVAL2",161,0)
 ;   INSTR - String to normalize
"RTN","BPSJVAL2",162,0)
 ; Output
"RTN","BPSJVAL2",163,0)
 ;   Normalize data
"RTN","BPSJVAL2",164,0)
DECODE(INSTR) ;
"RTN","BPSJVAL2",165,0)
 N TRCH
"RTN","BPSJVAL2",166,0)
 S TRCH("\F\")="|",TRCH("\R\")="~",TRCH("\E\")="\"
"RTN","BPSJVAL2",167,0)
 S TRCH("\T\")="&",TRCH("\S\")="^"
"RTN","BPSJVAL2",168,0)
 Q $$DECODE^BPSJZPR(INSTR,.TRCH)
"RTN","BPSJZQR")
0^40^B3046471
"RTN","BPSJZQR",1,0)
BPSJZQR ;BHAM ISC/LJF - HL7 Registration ZQR Message ;3/3/08  17:03
"RTN","BPSJZQR",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,3,7**;JUN 2004;Build 46
"RTN","BPSJZQR",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSJZQR",4,0)
 ;
"RTN","BPSJZQR",5,0)
 ; ZQR is pharmacy site registration info
"RTN","BPSJZQR",6,0)
 ;
"RTN","BPSJZQR",7,0)
EN(HL) N BPSZQR,BPSFS,BPSCPS,BPSREP,BPSVA1,BPSVA2,BPSCNF,BPSI
"RTN","BPSJZQR",8,0)
 ;
"RTN","BPSJZQR",9,0)
 ; Normally: HL("FS")="|"  HL("ECH")="^~\&"
"RTN","BPSJZQR",10,0)
 S BPSFS=$G(HL("FS")) I BPSFS="" S BPSFS="|"
"RTN","BPSJZQR",11,0)
 S BPSCPS=$E($G(HL("ECH"))) I BPSCPS="" S BPSCPS="^"
"RTN","BPSJZQR",12,0)
 S BPSREP=$E($G(HL("ECH")),2) I BPSREP="" S BPSREP="~"
"RTN","BPSJZQR",13,0)
 ;
"RTN","BPSJZQR",14,0)
 S BPSZQR=BPSFS_(+$P($G(HL("SITE")),"^",3))
"RTN","BPSJZQR",15,0)
 ;
"RTN","BPSJZQR",16,0)
 ; Get Contact Info
"RTN","BPSJZQR",17,0)
 S BPSVA1=$G(^BPS(9002313.99,1,"VITRIA")),BPSVA2=$P(BPSVA1,"^",2)
"RTN","BPSJZQR",18,0)
 ;
"RTN","BPSJZQR",19,0)
 ; Get Version number
"RTN","BPSJZQR",20,0)
 S BPSZQR=BPSZQR_BPSFS_$P(BPSVA1,"^",3)
"RTN","BPSJZQR",21,0)
 ;
"RTN","BPSJZQR",22,0)
 ; Port
"RTN","BPSJZQR",23,0)
 S BPSZQR=BPSZQR_BPSFS_$G(HL("EPPORT"))
"RTN","BPSJZQR",24,0)
 ;
"RTN","BPSJZQR",25,0)
 ; Load the Name and Means Fields
"RTN","BPSJZQR",26,0)
 ; Default the values to null
"RTN","BPSJZQR",27,0)
 F BPSI=5:1:8 S $P(BPSZQR,BPSFS,BPSI)=""
"RTN","BPSJZQR",28,0)
 ; Contact
"RTN","BPSJZQR",29,0)
 I BPSVA1 D
"RTN","BPSJZQR",30,0)
 . S BPSCNF=$$VA200NM^BPSJUTL(+BPSVA1,"",.HL) I BPSCNF]"" S $P(BPSZQR,BPSFS,5)=BPSCNF
"RTN","BPSJZQR",31,0)
 . S BPSCNF=$$VA20013^BPSJUTL(+BPSVA1,.HL) I BPSCNF]"" S $P(BPSZQR,BPSFS,6)=BPSCNF
"RTN","BPSJZQR",32,0)
 ;
"RTN","BPSJZQR",33,0)
 ; Alternate Contact
"RTN","BPSJZQR",34,0)
 I BPSVA2 D
"RTN","BPSJZQR",35,0)
 . S BPSCNF=$$VA200NM^BPSJUTL(BPSVA2,"",.HL) I BPSCNF]"" S $P(BPSZQR,BPSFS,7)=BPSCNF
"RTN","BPSJZQR",36,0)
 . S BPSCNF=$$VA20013^BPSJUTL(BPSVA2,.HL) I BPSCNF]"" S $P(BPSZQR,BPSFS,8)=BPSCNF
"RTN","BPSJZQR",37,0)
 ;
"RTN","BPSJZQR",38,0)
 Q "ZQR|"_BPSZQR
"RTN","BPSJZRP")
0^42^B12105763
"RTN","BPSJZRP",1,0)
BPSJZRP ;BHAM ISC/LJF - HL7 Registration ZRP Message ;3/5/08  10:41
"RTN","BPSJZRP",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,2,7**;JUN 2004;Build 46
"RTN","BPSJZRP",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSJZRP",4,0)
 ;
"RTN","BPSJZRP",5,0)
EN(HL,PHIX,ZRP,NPI,NCP) ;
"RTN","BPSJZRP",6,0)
 ; ZRP array contains pharmacy registration info
"RTN","BPSJZRP",7,0)
 N ZRPS,FS,CPS,REP,NDZRO,NDHRS,NDREM,NDREP,NDREP1,NDADD,STATE
"RTN","BPSJZRP",8,0)
 N VAIX1,VAIX2,VAIXLP,VATLE,CNF,MSGCNT,TCH
"RTN","BPSJZRP",9,0)
 ;
"RTN","BPSJZRP",10,0)
 ; Quit if no Pharmacy index provided
"RTN","BPSJZRP",11,0)
 I '$G(PHIX) Q
"RTN","BPSJZRP",12,0)
 ;
"RTN","BPSJZRP",13,0)
 K ZRP S ZRPS=""
"RTN","BPSJZRP",14,0)
 ;
"RTN","BPSJZRP",15,0)
 ; Set HL7 Delimiters - use standard defaults if none provided
"RTN","BPSJZRP",16,0)
 S FS=$G(HL("FS")) I FS="" S FS="|"
"RTN","BPSJZRP",17,0)
 S CPS=$E($G(HL("ECH"))) I CPS="" S CPS="^"
"RTN","BPSJZRP",18,0)
 S REP=$E($G(HL("ECH")),2) I REP="" S REP="~"
"RTN","BPSJZRP",19,0)
 ;
"RTN","BPSJZRP",20,0)
 S NDZRO=$G(^BPS(9002313.56,PHIX,0))
"RTN","BPSJZRP",21,0)
 S NDREM=$G(^BPS(9002313.56,PHIX,"REMIT"))
"RTN","BPSJZRP",22,0)
 S NDREP=$G(^BPS(9002313.56,PHIX,"REP"))
"RTN","BPSJZRP",23,0)
 S NDREP1=$G(^BPS(9002313.56,PHIX,"REP1"))
"RTN","BPSJZRP",24,0)
 S NDADD=$G(^BPS(9002313.56,PHIX,"ADDR"))
"RTN","BPSJZRP",25,0)
 ;
"RTN","BPSJZRP",26,0)
 F ZRP=1:1:17 S ZRP(ZRP)="" ;Initialize
"RTN","BPSJZRP",27,0)
 S (ZRP(2),NCP)=$P(NDZRO,U,2)     ;NCPDP #
"RTN","BPSJZRP",28,0)
 S ZRP(3)=$P(NDZRO,U)       ;NAME
"RTN","BPSJZRP",29,0)
 S ZRP(4)=$P(NDZRO,U,3)     ;DEFAULT DEA #
"RTN","BPSJZRP",30,0)
 ;
"RTN","BPSJZRP",31,0)
 I $L($P(NDADD,U,8)) S $P(ZRPS,CPS,1)=$P(NDADD,U,8)  ;SITE ADDRESS NAME
"RTN","BPSJZRP",32,0)
 I $L($P(NDADD,U,1)) S $P(ZRPS,CPS,1)=$P(ZRPS,CPS,1)_" "_$P(NDADD,U,1)  ;SITE ADDRESS 1
"RTN","BPSJZRP",33,0)
 I $L($P(NDADD,U,2)) S $P(ZRPS,CPS,2)=$P(NDADD,U,2)  ;SITE ADDRESS 2
"RTN","BPSJZRP",34,0)
 I $L($P(NDADD,U,3)) S $P(ZRPS,CPS,3)=$P(NDADD,U,3)  ;CITY
"RTN","BPSJZRP",35,0)
 I $L($P(NDADD,U,4)) S STATE=$P(NDADD,U,4) I STATE D  ; State
"RTN","BPSJZRP",36,0)
 . S STATE=$P($G(^DIC(5,STATE,0)),U,2)
"RTN","BPSJZRP",37,0)
 . I STATE]"" S $P(ZRPS,CPS,4)=STATE
"RTN","BPSJZRP",38,0)
 I $L($P(NDADD,U,5)) S $P(ZRPS,CPS,5)=$P(NDADD,U,5)  ;ZIP
"RTN","BPSJZRP",39,0)
 I ZRPS]"" S ZRP(6)=ZRPS,ZRPS=""
"RTN","BPSJZRP",40,0)
 ;
"RTN","BPSJZRP",41,0)
 I $L($P(NDREM,U,1)) S $P(ZRPS,CPS,1)=$P(NDREM,U,1)   ;REMITTANCE ADDRESS NAME
"RTN","BPSJZRP",42,0)
 I $L($P(NDREM,U,2)) S $P(ZRPS,CPS,1)=$P(ZRPS,CPS,1)_" "_$P(NDREM,U,2)  ;REMIT ADDRESS LINE 1
"RTN","BPSJZRP",43,0)
 I $L($P(NDREM,U,3)) S $P(ZRPS,CPS,2)=$P(NDREM,U,3)   ;REMIT ADDRESS LINE 2
"RTN","BPSJZRP",44,0)
 I $L($P(NDREM,U,6)) S $P(ZRPS,CPS,3)=$P(NDREM,U,6)   ;CITY
"RTN","BPSJZRP",45,0)
 I $L($P(NDREM,U,7)) S STATE=$P(NDREM,U,7) I STATE D  ;State
"RTN","BPSJZRP",46,0)
 . S STATE=$P($G(^DIC(5,STATE,0)),U,2)
"RTN","BPSJZRP",47,0)
 . I STATE]"" S $P(ZRPS,CPS,4)=STATE
"RTN","BPSJZRP",48,0)
 I $L($P(NDREM,U,8)) S $P(ZRPS,CPS,5)=$P(NDREM,U,8)  ;ZIP
"RTN","BPSJZRP",49,0)
 I ZRPS]"" S ZRP(7)=ZRPS,ZRPS=""
"RTN","BPSJZRP",50,0)
 ;
"RTN","BPSJZRP",51,0)
 ; Load the Name and Means Fields
"RTN","BPSJZRP",52,0)
 S VAIX1=$P(NDREP,U,3)
"RTN","BPSJZRP",53,0)
 S VAIX2=$P(NDREP,U,4)
"RTN","BPSJZRP",54,0)
 S VAIXLP=$P(NDREP,U,5)
"RTN","BPSJZRP",55,0)
 ;
"RTN","BPSJZRP",56,0)
 ; Contact
"RTN","BPSJZRP",57,0)
 I $G(VAIX1) S VATLE="" D
"RTN","BPSJZRP",58,0)
 . S CNF=$$VA200NM^BPSJUTL(VAIX1,.VATLE,.HL) I CNF]"" S ZRP(8)=CNF
"RTN","BPSJZRP",59,0)
 . I VATLE]"" S ZRP(9)=VATLE
"RTN","BPSJZRP",60,0)
 . S CNF=$$VA20013^BPSJUTL(VAIX1,.HL) I CNF]"" S ZRP(10)=CNF
"RTN","BPSJZRP",61,0)
 ;
"RTN","BPSJZRP",62,0)
 ; Alternate Contact
"RTN","BPSJZRP",63,0)
 I $G(VAIX2) S VATLE="" D
"RTN","BPSJZRP",64,0)
 . S CNF=$$VA200NM^BPSJUTL(VAIX2,.VATLE,.HL) I CNF]"" S ZRP(11)=CNF
"RTN","BPSJZRP",65,0)
 . I VATLE]"" S ZRP(12)=VATLE
"RTN","BPSJZRP",66,0)
 . S CNF=$$VA20013^BPSJUTL(VAIX2,.HL) I CNF]"" S ZRP(13)=CNF
"RTN","BPSJZRP",67,0)
 ;
"RTN","BPSJZRP",68,0)
 ; Lead Pharmacist
"RTN","BPSJZRP",69,0)
 I $G(VAIXLP) S VATLE="" D
"RTN","BPSJZRP",70,0)
 . S CNF=$$VA200NM^BPSJUTL(VAIXLP,.VATLE,.HL) I CNF]"" S ZRP(14)=CNF
"RTN","BPSJZRP",71,0)
 . I VATLE]"" S ZRP(15)=VATLE
"RTN","BPSJZRP",72,0)
 ;
"RTN","BPSJZRP",73,0)
 ; Pharmacist's License
"RTN","BPSJZRP",74,0)
 I $L($P(NDREP1,U)) S ZRP(16)=$P(NDREP1,U)
"RTN","BPSJZRP",75,0)
 ;
"RTN","BPSJZRP",76,0)
 ; NPI
"RTN","BPSJZRP",77,0)
 S ZRP(17)=$G(NPI)
"RTN","BPSJZRP",78,0)
 ;
"RTN","BPSJZRP",79,0)
 ; Encode special chars. Add Field separators.
"RTN","BPSJZRP",80,0)
 S TCH("\")="\E\",TCH("&")="\T\",TCH("|")="\F\"
"RTN","BPSJZRP",81,0)
 S (ZRPS(5),ZRPS(10),ZRPS(13))=1  ;Fields with HL7 repetion chars
"RTN","BPSJZRP",82,0)
 F ZRP=17:-1:1 D  S ZRP(ZRP)=$$ENCODE^BPSJUTL(ZRP(ZRP),.TCH)_FS
"RTN","BPSJZRP",83,0)
 . I $G(ZRPS(ZRP)) K TCH("~")  ; don't convert repetion chars
"RTN","BPSJZRP",84,0)
 . E  S TCH("~")="\R\"         ; ok to convert repetion chars
"RTN","BPSJZRP",85,0)
 S ZRP="ZRP|"
"RTN","BPSJZRP",86,0)
 ;
"RTN","BPSJZRP",87,0)
 Q
"RTN","BPSJZRP",88,0)
 ;
"RTN","BPSNCPD1")
0^7^B46831868
"RTN","BPSNCPD1",1,0)
BPSNCPD1 ;BHAM ISC/LJE - Pharmacy API part 2 ;06/16/2004
"RTN","BPSNCPD1",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,3,5,6,7**;JUN 2004;Build 46
"RTN","BPSNCPD1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSNCPD1",4,0)
 ;
"RTN","BPSNCPD1",5,0)
 ; External reference to $$NCPDPQTY^PSSBPSUT supported by IA4992
"RTN","BPSNCPD1",6,0)
 ;
"RTN","BPSNCPD1",7,0)
 ;
"RTN","BPSNCPD1",8,0)
 ; Procedure STARRAY - Retrieve information for API call to IB and store in BPSARRY
"RTN","BPSNCPD1",9,0)
 ; Incoming Parameters
"RTN","BPSNCPD1",10,0)
 ;    BRXIEN - Prescription IEN
"RTN","BPSNCPD1",11,0)
 ;    BFILL  - Fill Number
"RTN","BPSNCPD1",12,0)
 ;    BWHERE - RX action
"RTN","BPSNCPD1",13,0)
 ;    BPSARRY  - Array that is built (passed by reference)
"RTN","BPSNCPD1",14,0)
 ;    BPSITE - OUTPATIENT SITE file #59 ien
"RTN","BPSNCPD1",15,0)
 ; background parameters:
"RTN","BPSNCPD1",16,0)
 ; DFN - patient's IEN
"RTN","BPSNCPD1",17,0)
 ; BILLNDC - NDC
"RTN","BPSNCPD1",18,0)
 ; BFILLDAT - fill date
"RTN","BPSNCPD1",19,0)
STARRAY(BRXIEN,BFILL,BWHERE,BPSARRY,BPSITE) ;
"RTN","BPSNCPD1",20,0)
 N DRUGIEN,BPARR,BPSARR,QTY
"RTN","BPSNCPD1",21,0)
 D RXAPI^BPSUTIL1(BRXIEN,"6;7;8;17;31","BPARR","I")
"RTN","BPSNCPD1",22,0)
 I BFILL>0 D RXSUBF^BPSUTIL1(BRXIEN,52,52.1,BFILL,"1;1.1;1.2;17","BPARR","I")
"RTN","BPSNCPD1",23,0)
 S BPSARRY("DFN")=DFN
"RTN","BPSNCPD1",24,0)
 S BPSARRY("DAYS SUPPLY")=$S(BFILL=0:$G(BPARR(52,BRXIEN,8,"I")),1:$G(BPARR(52.1,BFILL,1.1,"I")))
"RTN","BPSNCPD1",25,0)
 S BPSARRY("IEN")=BRXIEN
"RTN","BPSNCPD1",26,0)
 S BPSARRY("FILL NUMBER")=BFILL
"RTN","BPSNCPD1",27,0)
 S BPSARRY("NDC")=BILLNDC
"RTN","BPSNCPD1",28,0)
 S (BPSARRY("DRUG"),DRUGIEN)=BPARR(52,BRXIEN,6,"I")
"RTN","BPSNCPD1",29,0)
 S BPSARRY("DEA")=$$DRUGDIE^BPSUTIL1(DRUGIEN,3)
"RTN","BPSNCPD1",30,0)
 S BPSARRY("COST")=$S(BFILL=0:$G(BPARR(52,BRXIEN,17,"I")),1:$G(BPARR(52.1,BFILL,1.2,"I")))
"RTN","BPSNCPD1",31,0)
 S QTY=$S(BFILL=0:$G(BPARR(52,BRXIEN,7,"I")),1:$G(BPARR(52.1,BFILL,1,"I")))
"RTN","BPSNCPD1",32,0)
 S QTY=$$NCPDPQTY^PSSBPSUT(DRUGIEN,QTY)
"RTN","BPSNCPD1",33,0)
 S BPSARRY("QTY")=$P(QTY,U,1)
"RTN","BPSNCPD1",34,0)
 S BPSARRY("UNITS")=$P(QTY,U,2)
"RTN","BPSNCPD1",35,0)
 S BPSARRY("FILL DATE")=BFILLDAT
"RTN","BPSNCPD1",36,0)
 S BPSARRY("RELEASE DATE")=$P($S(BFILL=0:$G(BPARR(52,BRXIEN,31,"I")),1:$G(BPARR(52.1,BFILL,17,"I"))),".")
"RTN","BPSNCPD1",37,0)
 S BPSARRY("SC/EI OVR")=0
"RTN","BPSNCPD1",38,0)
 ;determine BPS PHARMACY
"RTN","BPSNCPD1",39,0)
 I $G(BPSITE)>0 S BPSARRY("EPHARM")=$$GETPHARM^BPSUTIL(BPSITE)
"RTN","BPSNCPD1",40,0)
 ;
"RTN","BPSNCPD1",41,0)
 ; Add user so that it is stored correctly in the IB Event Log
"RTN","BPSNCPD1",42,0)
 ;  Note: Auto-Reversals (AREV) and CMOP/OPAI (CR*/PC/RL) use postmaster (.5)
"RTN","BPSNCPD1",43,0)
 I ",AREV,CRLB,CRLX,CRLR,PC,RL,"[(","_BWHERE_",") S BPSARRY("USER")=.5
"RTN","BPSNCPD1",44,0)
 E  S BPSARRY("USER")=DUZ
"RTN","BPSNCPD1",45,0)
 Q
"RTN","BPSNCPD1",46,0)
 ;
"RTN","BPSNCPD1",47,0)
 ; Called by BPSNCPDP to display progress of claim
"RTN","BPSNCPD1",48,0)
 ; BRXIEN = Prescription IEN
"RTN","BPSNCPD1",49,0)
 ; BFILL = Fill Number
"RTN","BPSNCPD1",50,0)
 ; REBILL = rebill flag
"RTN","BPSNCPD1",51,0)
 ; REVONLY = reversal only flag
"RTN","BPSNCPD1",52,0)
 ; BPSTART = date/time
"RTN","BPSNCPD1",53,0)
 ; BWHERE  = RX Action (see BPSNCPDP comments above for details)
"RTN","BPSNCPD1",54,0)
 ; BPREQIEN = the BPS REQUESTS (#9002313.77) IEN
"RTN","BPSNCPD1",55,0)
STATUS(BRXIEN,BFILL,REBILL,REVONLY,BPSTART,BWHERE,BPREQIEN) ;
"RTN","BPSNCPD1",56,0)
 ; Initialization
"RTN","BPSNCPD1",57,0)
 N TRANSIEN,CERTUSER,BPSTO,END,IBSEQ,BPQ,BP77OLD,BP77,BPQQ
"RTN","BPSNCPD1",58,0)
 N CLMSTAT,OCLMSTAT,RESFL,BPACTTYP,BPSCOB
"RTN","BPSNCPD1",59,0)
 S BPSCOB=1 ;default - primary
"RTN","BPSNCPD1",60,0)
 S BPACTTYP=$$ACTTYPE^BPSOSRX5(BWHERE)
"RTN","BPSNCPD1",61,0)
 S (CLMSTAT,OCLMSTAT)=0
"RTN","BPSNCPD1",62,0)
 ;
"RTN","BPSNCPD1",63,0)
 ; Set CERTUSER to true if this user is the certifier
"RTN","BPSNCPD1",64,0)
 S CERTUSER=^BPS(9002313.99,1,"CERTIFIER")=DUZ
"RTN","BPSNCPD1",65,0)
 ;
"RTN","BPSNCPD1",66,0)
 ; Build Transaction IEN
"RTN","BPSNCPD1",67,0)
 S TRANSIEN=BRXIEN_"."_$E($TR($J("",4-$L(BFILL))," ","0")_BFILL,1,4)_1
"RTN","BPSNCPD1",68,0)
 ;
"RTN","BPSNCPD1",69,0)
 ; Write Rebill and Status Messages
"RTN","BPSNCPD1",70,0)
 ;
"RTN","BPSNCPD1",71,0)
 W !!,"Claim Status: "
"RTN","BPSNCPD1",72,0)
 I REBILL,BPACTTYP="UC" W !,"Reversing and Rebilling a previously submitted claim..." ;,!,"Reversing..."
"RTN","BPSNCPD1",73,0)
 I REBILL,BPACTTYP="U" W !,"Reversing..."
"RTN","BPSNCPD1",74,0)
 ;
"RTN","BPSNCPD1",75,0)
 ; Get the ECME Timeout and set the display timeout
"RTN","BPSNCPD1",76,0)
 S BPSTO=$$GET1^DIQ(9002313.99,"1,",3.01),END=$S(CERTUSER:50,$G(BPSTO)]"":BPSTO,1:5)
"RTN","BPSNCPD1",77,0)
 ;
"RTN","BPSNCPD1",78,0)
 ; For remaining time, loop through and display status
"RTN","BPSNCPD1",79,0)
 S (BPQ,RESFL,BP77OLD)=0
"RTN","BPSNCPD1",80,0)
 F IBSEQ=1:1:END D  Q:BPQ=1
"RTN","BPSNCPD1",81,0)
 . H 1
"RTN","BPSNCPD1",82,0)
 . ;
"RTN","BPSNCPD1",83,0)
 . ; Get status of resubmit, last update, and claim status
"RTN","BPSNCPD1",84,0)
 . S CLMSTAT=$$STATUS^BPSOSRX(BRXIEN,BFILL,1,$G(BPREQIEN))
"RTN","BPSNCPD1",85,0)
 . ;
"RTN","BPSNCPD1",86,0)
 . ; Format status message
"RTN","BPSNCPD1",87,0)
 . S CLMSTAT=$P(CLMSTAT,"^",1)_$S($P(CLMSTAT,"^",1)["IN PROGRESS":"-"_$P(CLMSTAT,"^",3),1:"")
"RTN","BPSNCPD1",88,0)
 . ;
"RTN","BPSNCPD1",89,0)
 . ;If the status has changed, display the new message
"RTN","BPSNCPD1",90,0)
 . I OCLMSTAT'=CLMSTAT W !,CLMSTAT S OCLMSTAT=CLMSTAT I CLMSTAT="E REJECTED",$G(BPSELIG)'="V" D
"RTN","BPSNCPD1",91,0)
 .. N BPSRTEXT,BPSRESP,BPSPOS,X
"RTN","BPSNCPD1",92,0)
 .. S BPSRESP=$P($G(^BPST(IEN59,0)),"^",5) Q:'BPSRESP
"RTN","BPSNCPD1",93,0)
 .. S BPSPOS=+$O(^BPSR(BPSRESP,1000,":"),-1) Q:'BPSPOS
"RTN","BPSNCPD1",94,0)
 .. D REJTEXT^BPSOS03(BPSRESP,BPSPOS,.BPSRTEXT)
"RTN","BPSNCPD1",95,0)
 .. S X=0 F  S X=$O(BPSRTEXT(X)) Q:'X  W !?4,$P(BPSRTEXT(X),":")," - ",$P(BPSRTEXT(X),":",2)
"RTN","BPSNCPD1",96,0)
 . ;
"RTN","BPSNCPD1",97,0)
 . ; If the status is not IN PROGRESS, then we are done
"RTN","BPSNCPD1",98,0)
 . I CLMSTAT'["IN PROGRESS",'$D(^BPS(9002313.77,"D",BRXIEN,BFILL,BPSCOB)) S BPQ=1
"RTN","BPSNCPD1",99,0)
 W !
"RTN","BPSNCPD1",100,0)
 Q
"RTN","BPSNCPD1",101,0)
 ;
"RTN","BPSNCPD1",102,0)
 ; Bulletin to the OPECC
"RTN","BPSNCPD1",103,0)
 ; BPST=Tricare flag 1 is Tricare Related
"RTN","BPSNCPD1",104,0)
BULL(RXI,RXR,SITE,DFN,PATNAME,BPST,BPSERTXT,BPSRESP) ;
"RTN","BPSNCPD1",105,0)
 N BTXT,XMSUB,XMY,XMTEXT,XMDUZ
"RTN","BPSNCPD1",106,0)
 N SSN,X,SITENM
"RTN","BPSNCPD1",107,0)
 I $G(SITE) D
"RTN","BPSNCPD1",108,0)
 . K ^TMP($J,"BPSARR")
"RTN","BPSNCPD1",109,0)
 . D PSS^PSO59(SITE,,"BPSARR")
"RTN","BPSNCPD1",110,0)
 . S SITENM=$G(^TMP($J,"BPSARR",SITE,.01))
"RTN","BPSNCPD1",111,0)
 I $G(DFN) D
"RTN","BPSNCPD1",112,0)
 . S X=$P($G(^DPT(DFN,0)),U,9)
"RTN","BPSNCPD1",113,0)
 . S SSN=$E(X,$L(X)-3,$L(X))
"RTN","BPSNCPD1",114,0)
 ;
"RTN","BPSNCPD1",115,0)
 ; Need to do in the background
"RTN","BPSNCPD1",116,0)
 ;   Mailman calls CMOP which calls EN^BPSNCPDP.
"RTN","BPSNCPD1",117,0)
 ;   If BPSNCPDP* (same process) then calls mailman, it gets confused.
"RTN","BPSNCPD1",118,0)
 N ZTIO,ZTRTN,ZTDTH,ZTSAVE,ZTDESC
"RTN","BPSNCPD1",119,0)
 N %,%H,%I,X
"RTN","BPSNCPD1",120,0)
 D NOW^%DTC
"RTN","BPSNCPD1",121,0)
 S ZTIO="",ZTDTH=%,ZTDESC="IN PROGRESS BULLETIN"
"RTN","BPSNCPD1",122,0)
 S (ZTSAVE("RXR"),ZTSAVE("RXI"),ZTSAVE("BPSERTXT"))="",ZTSAVE("BPSRESP")=""
"RTN","BPSNCPD1",123,0)
 S (ZTSAVE("SITENM"),ZTSAVE("PATNAME"),ZTSAVE("SSN"),ZTSAVE("BPST"))=""
"RTN","BPSNCPD1",124,0)
 S ZTRTN="BULL1^BPSNCPD1"
"RTN","BPSNCPD1",125,0)
 D ^%ZTLOAD
"RTN","BPSNCPD1",126,0)
 Q
"RTN","BPSNCPD1",127,0)
 ;
"RTN","BPSNCPD1",128,0)
 ;
"RTN","BPSNCPD1",129,0)
BULL1    ;
"RTN","BPSNCPD1",130,0)
 N BPSRX,BPSL,XMDUZ,XMY,BPSX,XMZ,XMSUB
"RTN","BPSNCPD1",131,0)
 S BPSL=0,BPSRX=$$RXAPI1^BPSUTIL1(RXI,.01,"E")
"RTN","BPSNCPD1",132,0)
 S XMSUB=$S($G(BPST):"TRICARE ",1:"")_"RX not processed for site "_$G(SITENM)
"RTN","BPSNCPD1",133,0)
 I $G(BPST) D
"RTN","BPSNCPD1",134,0)
 . S BPSL=BPSL+1,BPSX(BPSL)="Prescription "_BPSRX_" for fill number "_(+RXR)_" could not be filled because of a"
"RTN","BPSNCPD1",135,0)
 . S BPSL=BPSL+1,BPSX(BPSL)="delay in processing the third party claim. The Rx was placed on suspense"
"RTN","BPSNCPD1",136,0)
 . S BPSL=BPSL+1,BPSX(BPSL)="because TRICARE Rx's may not be filled unless they have a payable third"
"RTN","BPSNCPD1",137,0)
 . S BPSL=BPSL+1,BPSX(BPSL)="party claim."
"RTN","BPSNCPD1",138,0)
 . S BPSL=BPSL+1,BPSX(BPSL)=" "
"RTN","BPSNCPD1",139,0)
 . S BPSL=BPSL+1,BPSX(BPSL)="Please monitor the progress of the claim.  If the claim is eventually"
"RTN","BPSNCPD1",140,0)
 . S BPSL=BPSL+1,BPSX(BPSL)="returned as payable, the Rx label will be printed when Print from Suspense"
"RTN","BPSNCPD1",141,0)
 . S BPSL=BPSL+1,BPSX(BPSL)="occurs or it may be Pulled Early from Suspense.  If a reject occurs, the"
"RTN","BPSNCPD1",142,0)
 . S BPSL=BPSL+1,BPSX(BPSL)="Rx will be placed in the REFILL TOO SOON/DUR REJECTS (Third Party) section"
"RTN","BPSNCPD1",143,0)
 . S BPSL=BPSL+1,BPSX(BPSL)="of the medication profile and placed on the Pharmacy Reject Worklist."
"RTN","BPSNCPD1",144,0)
 ;
"RTN","BPSNCPD1",145,0)
 ;
"RTN","BPSNCPD1",146,0)
 I $G(BPSERTXT)'="" S BPSL=BPSL+1,BPSX(BPSL)=BPSERTXT
"RTN","BPSNCPD1",147,0)
 S BPSL=BPSL+1,BPSX(BPSL)=" "
"RTN","BPSNCPD1",148,0)
 I $G(BPSRESP)'=4 D
"RTN","BPSNCPD1",149,0)
 . S BPSL=BPSL+1,BPSX(BPSL)="For more information on this prescription's activity, please view the ECME"
"RTN","BPSNCPD1",150,0)
 . S BPSL=BPSL+1,BPSX(BPSL)="log within the View Prescription (VP) option on the Further Research (FR)"
"RTN","BPSNCPD1",151,0)
 . S BPSL=BPSL+1,BPSX(BPSL)="menu of the ECME user screen."
"RTN","BPSNCPD1",152,0)
 . S BPSL=BPSL+1,BPSX(BPSL)=" "
"RTN","BPSNCPD1",153,0)
 S BPSL=BPSL+1,BPSX(BPSL)=$S($G(BPST):"TRICARE ",1:"")_"Patient Name: "_$G(PATNAME)_" ("_$G(SSN)_")"
"RTN","BPSNCPD1",154,0)
 S BPSL=BPSL+1,BPSX(BPSL)="Prescription: "_BPSRX_"  Fill: "_(+RXR)
"RTN","BPSNCPD1",155,0)
 S BPSL=BPSL+1,BPSX(BPSL)="Drug Name:  "_$$RXAPI1^BPSUTIL1(RXI,6,"E")
"RTN","BPSNCPD1",156,0)
 ;
"RTN","BPSNCPD1",157,0)
 S XMDUZ="BPS PACKAGE",XMTEXT="BPSX("
"RTN","BPSNCPD1",158,0)
 S XMY("G.BPS OPECC")=""
"RTN","BPSNCPD1",159,0)
 I $G(DUZ)'<1 S XMY(DUZ)=""
"RTN","BPSNCPD1",160,0)
 D ^XMD
"RTN","BPSNCPD1",161,0)
 I $G(BPST) D PRIORITY^XMXEDIT(XMZ)
"RTN","BPSNCPD1",162,0)
 Q 
"RTN","BPSNCPD2")
0^89^B37810791
"RTN","BPSNCPD2",1,0)
BPSNCPD2 ;BHAM ISC/LJE - Continuation of BPSNCPDP (IB Billing Determination) ;11/7/07  16:01
"RTN","BPSNCPD2",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5,6,7**;JUN 2004;Build 46
"RTN","BPSNCPD2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSNCPD2",4,0)
 ;External reference $$RX^IBNCPDP supported by DBIA 4299
"RTN","BPSNCPD2",5,0)
 ;
"RTN","BPSNCPD2",6,0)
 ;
"RTN","BPSNCPD2",7,0)
 ; EN - Call IB Billing Determination.  If good to go, update MOREDATA array
"RTN","BPSNCPD2",8,0)
 ; Notes about variables
"RTN","BPSNCPD2",9,0)
 ;input:
"RTN","BPSNCPD2",10,0)
 ;   DFN - PATIENT file #2 ien
"RTN","BPSNCPD2",11,0)
 ;   BWHERE - shows where the code is called from and what needs to be done
"RTN","BPSNCPD2",12,0)
 ;   the following should be passed by reference:
"RTN","BPSNCPD2",13,0)
 ;   MOREDATA - Initialized by BPSNCPDP and more data is added here
"RTN","BPSNCPD2",14,0)
 ;   BPSARRY  - Created by STARRAY^BPSNCPD1 and used for IB Determination
"RTN","BPSNCPD2",15,0)
 ;   IB    - Returned to BPSNCPDP
"RTN","BPSNCPD2",16,0)
 ;   CERTIEN - BPS Certification IEN - Not passed but newed/set in BPSNCPDP
"RTN","BPSNCPD2",17,0)
 ;
"RTN","BPSNCPD2",18,0)
EN(DFN,BWHERE,MOREDATA,BPSARRY,IB) ;
"RTN","BPSNCPD2",19,0)
 I '$G(CERTIEN) D  I IB=2 Q
"RTN","BPSNCPD2",20,0)
 . ;
"RTN","BPSNCPD2",21,0)
 . ;For NCPDP IB call to see if we need to 3rd Party Bill and if so, get insurance/payer sheet info
"RTN","BPSNCPD2",22,0)
 . S MOREDATA("BILL")=$$RX^IBNCPDP(DFN,.BPSARRY)  ;IB CALL
"RTN","BPSNCPD2",23,0)
 . Q:'$D(MOREDATA("BILL"))
"RTN","BPSNCPD2",24,0)
 . ;
"RTN","BPSNCPD2",25,0)
 . ; If calling program is the ECME user screen and we can't bill because of NEEDS SC DETERMINATION
"RTN","BPSNCPD2",26,0)
 . ; or EI, then prompt the user to see if they want to bill
"RTN","BPSNCPD2",27,0)
 . I BWHERE="ERES",$P(MOREDATA("BILL"),U,1)=0,$G(BPSARRY("SC/EI NO ANSW"))]"",$G(BPJOBFLG)'="B" D
"RTN","BPSNCPD2",28,0)
 .. N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT,I,BPEISC
"RTN","BPSNCPD2",29,0)
 .. F I=1:1:$L($G(BPSARRY("SC/EI NO ANSW")),",") S BPEISC=$P($G(BPSARRY("SC/EI NO ANSW")),",",I) I BPEISC]"" D
"RTN","BPSNCPD2",30,0)
 ... W !,"The prescription is potentially ",BPEISC,"-related and needs ",BPEISC," determination."
"RTN","BPSNCPD2",31,0)
 ... W !,"Prescriptions related to ",BPEISC," cannot be billed to Third Party Insurance.",!
"RTN","BPSNCPD2",32,0)
 .. S DIR(0)="Y",DIR("A")="Are you sure you want to bill this prescription"
"RTN","BPSNCPD2",33,0)
 .. S DIR("B")="NO"
"RTN","BPSNCPD2",34,0)
 .. S DIR("?")="If you want to bill this prescription, enter 'Yes' - otherwise, enter 'No'"
"RTN","BPSNCPD2",35,0)
 .. W ! D ^DIR K DIR
"RTN","BPSNCPD2",36,0)
 .. I '+Y Q
"RTN","BPSNCPD2",37,0)
 .. S BPSARRY("SC/EI OVR")=1
"RTN","BPSNCPD2",38,0)
 .. S MOREDATA("BILL")=$$RX^IBNCPDP(DFN,.BPSARRY)  ;Call IB again
"RTN","BPSNCPD2",39,0)
 . ;
"RTN","BPSNCPD2",40,0)
 . ; Quit if no response from IB call
"RTN","BPSNCPD2",41,0)
 . Q:'$D(MOREDATA("BILL"))
"RTN","BPSNCPD2",42,0)
 . S MOREDATA("ELIG")=$P(MOREDATA("BILL"),"^",3)
"RTN","BPSNCPD2",43,0)
 . I $P(MOREDATA("BILL"),U,1)=0 S IB=2 Q  ;IB says not to bill
"RTN","BPSNCPD2",44,0)
 . S IB=1
"RTN","BPSNCPD2",45,0)
 . M MOREDATA("IBDATA")=BPSARRY("INS")
"RTN","BPSNCPD2",46,0)
 . S $P(MOREDATA("BPSDATA",1),U,1)=BPSARRY("QTY")
"RTN","BPSNCPD2",47,0)
 . S $P(MOREDATA("BPSDATA",1),U,2)=BPSARRY("COST")
"RTN","BPSNCPD2",48,0)
 . S $P(MOREDATA("BPSDATA",1),U,3)=BPSARRY("NDC")
"RTN","BPSNCPD2",49,0)
 . S $P(MOREDATA("BPSDATA",1),U,4)=BFILL
"RTN","BPSNCPD2",50,0)
 . S $P(MOREDATA("BPSDATA",1),U,5)=""  ; Certify Mode
"RTN","BPSNCPD2",51,0)
 . S $P(MOREDATA("BPSDATA",1),U,6)=""  ; Cert IEN
"RTN","BPSNCPD2",52,0)
 . S $P(MOREDATA("BPSDATA",1),U,7)=BPSARRY("UNITS")
"RTN","BPSNCPD2",53,0)
 ;
"RTN","BPSNCPD2",54,0)
 ; If certification mode on and no IB result (somewhat redundant since IB is not called
"RTN","BPSNCPD2",55,0)
 ;   for certification), get data from BPS Certification table
"RTN","BPSNCPD2",56,0)
 I $G(CERTIEN),'$G(IB) D
"RTN","BPSNCPD2",57,0)
 . N NODE,FLD,NFLD,CERTARY
"RTN","BPSNCPD2",58,0)
 . S MOREDATA("BILL")=1
"RTN","BPSNCPD2",59,0)
 . S MOREDATA("IBDATA",1,1)="",MOREDATA("IBDATA",1,2)="",MOREDATA("BPSDATA",1)=""
"RTN","BPSNCPD2",60,0)
 . S $P(MOREDATA("BPSDATA",1),U,5)=1  ;Certify Mode
"RTN","BPSNCPD2",61,0)
 . S $P(MOREDATA("BPSDATA",1),U,6)=CERTIEN  ;Cert IEN
"RTN","BPSNCPD2",62,0)
 . S $P(MOREDATA("IBDATA",1,1),U,1)=1  ;Plan IEN
"RTN","BPSNCPD2",63,0)
 . S $P(MOREDATA("IBDATA",1,1),U,4)=$$GET1^DIQ(9002313.31,CERTIEN,.04,"E")  ;Payer Sheet
"RTN","BPSNCPD2",64,0)
 . S $P(MOREDATA("IBDATA",1,1),U,10)="01"  ;Home State Plan
"RTN","BPSNCPD2",65,0)
 . S $P(MOREDATA("IBDATA",1,1),U,11)=""  ;B2 Payer Sheet (reversal)
"RTN","BPSNCPD2",66,0)
 . S $P(MOREDATA("IBDATA",1,1),U,12)=""  ;B3 Payer Sheet (rebill)
"RTN","BPSNCPD2",67,0)
 . S $P(MOREDATA("IBDATA",1,1),U,14)=""  ;Plan Name
"RTN","BPSNCPD2",68,0)
 . S $P(MOREDATA("IBDATA",1,2),U,5)=0    ;Admin Fee
"RTN","BPSNCPD2",69,0)
 . ;
"RTN","BPSNCPD2",70,0)
 . ;Get data from non-multiple fields and add to MOREDATA
"RTN","BPSNCPD2",71,0)
 . K CERTARY D GETS^DIQ(9002313.31,CERTIEN_",","1*","","CERTARY")
"RTN","BPSNCPD2",72,0)
 . S NODE="" F  S NODE=$O(CERTARY(9002313.311,NODE)) Q:NODE=""  D
"RTN","BPSNCPD2",73,0)
 .. S FLD="" F  S FLD=$O(CERTARY(9002313.311,NODE,FLD)) Q:FLD=""  D
"RTN","BPSNCPD2",74,0)
 ... I FLD=.01 S NFLD=CERTARY(9002313.311,NODE,FLD) D
"RTN","BPSNCPD2",75,0)
 .... I NFLD=101 S $P(MOREDATA("IBDATA",1,1),U,2)=CERTARY(9002313.311,NODE,.02) ;BIN
"RTN","BPSNCPD2",76,0)
 .... I NFLD=104 S $P(MOREDATA("IBDATA",1,1),U,3)=CERTARY(9002313.311,NODE,.02)  ;PCN
"RTN","BPSNCPD2",77,0)
 .... I NFLD=110 S $P(MOREDATA("IBDATA",1,1),U,13)=CERTARY(9002313.311,NODE,.02)  ;Certification ID
"RTN","BPSNCPD2",78,0)
 . ;
"RTN","BPSNCPD2",79,0)
 . ;Get data from multiple fields and add to MOREDATA
"RTN","BPSNCPD2",80,0)
 . K CERTARY D GETS^DIQ(9002313.31,CERTIEN_",","2*","","CERTARY")
"RTN","BPSNCPD2",81,0)
 . S NODE="" F  S NODE=$O(CERTARY(9002313.3121,NODE)) Q:NODE=""  D
"RTN","BPSNCPD2",82,0)
 ..  S FLD="" F  S FLD=$O(CERTARY(9002313.3121,NODE,FLD)) Q:FLD=""  D
"RTN","BPSNCPD2",83,0)
 ... I FLD=.01 S NFLD=CERTARY(9002313.3121,NODE,FLD) D
"RTN","BPSNCPD2",84,0)
 .... I NFLD=301 S $P(MOREDATA("IBDATA",1,1),U,5)=CERTARY(9002313.3121,NODE,.02)  ;Group ID
"RTN","BPSNCPD2",85,0)
 .... I NFLD=302 S $P(MOREDATA("IBDATA",1,1),U,6)=CERTARY(9002313.3121,NODE,.02)  ;Cardholder ID
"RTN","BPSNCPD2",86,0)
 .... I NFLD=306 S $P(MOREDATA("IBDATA",1,1),U,7)=CERTARY(9002313.3121,NODE,.02)  ;Patient Rel Code
"RTN","BPSNCPD2",87,0)
 .... I NFLD=312 S $P(MOREDATA("IBDATA",1,1),U,8)=CERTARY(9002313.3121,NODE,.02)  ;Cardholder First Name
"RTN","BPSNCPD2",88,0)
 .... I NFLD=313 S $P(MOREDATA("IBDATA",1,1),U,9)=CERTARY(9002313.3121,NODE,.02)  ;Cardholder Last Name
"RTN","BPSNCPD2",89,0)
 .... I NFLD=412 S $P(MOREDATA("IBDATA",1,2),U,1)=CERTARY(9002313.3121,NODE,.02)  ;Dispensing Fee
"RTN","BPSNCPD2",90,0)
 .... I NFLD=423 S $P(MOREDATA("IBDATA",1,2),U,2)=CERTARY(9002313.3121,NODE,.02)  ;Basis of Cost Determination
"RTN","BPSNCPD2",91,0)
 .... I NFLD=426 S $P(MOREDATA("IBDATA",1,2),U,3)=CERTARY(9002313.3121,NODE,.02)  ;Usual & Customary - Base Price
"RTN","BPSNCPD2",92,0)
 .... I NFLD=430 S $P(MOREDATA("IBDATA",1,2),U,4)=CERTARY(9002313.3121,NODE,.02)  ;Gross Amt Due
"RTN","BPSNCPD2",93,0)
 .... I NFLD=442 S $P(MOREDATA("BPSDATA",1),U,1)=CERTARY(9002313.3121,NODE,.02)  ;Qty
"RTN","BPSNCPD2",94,0)
 .... I NFLD=409 S $P(MOREDATA("BPSDATA",1),U,2)=CERTARY(9002313.3121,NODE,.02)  ;Unit Cost
"RTN","BPSNCPD2",95,0)
 .... I NFLD=407 S $P(MOREDATA("BPSDATA",1),U,3)=CERTARY(9002313.3121,NODE,.02)  ;NDC
"RTN","BPSNCPD2",96,0)
 .... I NFLD=403 S $P(MOREDATA("BPSDATA",1),U,4)=CERTARY(9002313.3121,NODE,.02)  ;Fill #
"RTN","BPSNCPD2",97,0)
 .... I NFLD=600 S $P(MOREDATA("BPSDATA",1),U,7)=CERTARY(9002313.3121,NODE,.02)  ;Unit of Measure
"RTN","BPSNCPD2",98,0)
 . ;
"RTN","BPSNCPD2",99,0)
 . ; If Gross Amt Due is missing, use Usual and Customary
"RTN","BPSNCPD2",100,0)
 . I $P(MOREDATA("IBDATA",1,2),U,4)="" S $P(MOREDATA("IBDATA",1,2),U,4)=$P(MOREDATA("IBDATA",1,2),U,3)
"RTN","BPSNCPD2",101,0)
 ;
"RTN","BPSNCPD2",102,0)
 ; The code below checks if Sequence one is missing and move the next number down if needed.
"RTN","BPSNCPD2",103,0)
 ; DMB - This is existing code so I am not sure if it is needed or not.
"RTN","BPSNCPD2",104,0)
 I '$D(MOREDATA("IBDATA",1)) D
"RTN","BPSNCPD2",105,0)
 . N WW
"RTN","BPSNCPD2",106,0)
 . S WW=$O(MOREDATA("IBDATA",""))
"RTN","BPSNCPD2",107,0)
 . I WW'="" M MOREDATA("IBDATA",1)=MOREDATA("IBDATA",WW) K MOREDATA("IBDATA",WW)
"RTN","BPSNCPD2",108,0)
 ;
"RTN","BPSNCPD2",109,0)
 ; Uppercase the IBDATA
"RTN","BPSNCPD2",110,0)
 ; DMB - Assume this was adding in case any of the BPS Certification data was entered as lowercase
"RTN","BPSNCPD2",111,0)
 S MOREDATA("IBDATA",1,1)=$TR(MOREDATA("IBDATA",1,1),"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","BPSNCPD2",112,0)
 S MOREDATA("IBDATA",1,2)=$TR(MOREDATA("IBDATA",1,2),"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","BPSNCPD2",113,0)
 S MOREDATA("BPSDATA",1)=$TR(MOREDATA("BPSDATA",1),"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","BPSNCPD2",114,0)
 ;
"RTN","BPSNCPD2",115,0)
 Q
"RTN","BPSNCPD3")
0^82^B28795294
"RTN","BPSNCPD3",1,0)
BPSNCPD3 ;BHAM ISC/LJE - Continuation of BPSNCPDP - DUR HANDLING ;06/16/2004
"RTN","BPSNCPD3",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5,6,7**;JUN 2004;Build 46
"RTN","BPSNCPD3",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSNCPD3",4,0)
 ;
"RTN","BPSNCPD3",5,0)
 ; Due to space considerations, these comments were moved from BPSNPCPD
"RTN","BPSNCPD3",6,0)
 ;   to this routine.
"RTN","BPSNCPD3",7,0)
 ;
"RTN","BPSNCPD3",8,0)
 ; ------------------ Beginning of BPSNCPDP comments ------------------
"RTN","BPSNCPD3",9,0)
 ;Input
"RTN","BPSNCPD3",10,0)
 ; BRXIEN = Prescription IEN
"RTN","BPSNCPD3",11,0)
 ; BFILL = Fill Number
"RTN","BPSNCPD3",12,0)
 ; BFILLDAT = Fill Date of current prescription and fill number
"RTN","BPSNCPD3",13,0)
 ; BWHERE (RX Action)
"RTN","BPSNCPD3",14,0)
 ;    ARES = Resubmit for an auto-reversed claim was released while waiting
"RTN","BPSNCPD3",15,0)
 ;           for the payer response
"RTN","BPSNCPD3",16,0)
 ;    AREV = Auto-Reversal
"RTN","BPSNCPD3",17,0)
 ;    BB   = Back Billing
"RTN","BPSNCPD3",18,0)
 ;    CRLB = CMOP Release & Rebill
"RTN","BPSNCPD3",19,0)
 ;    CRLR = CMOP Release & Reverse (successful release)
"RTN","BPSNCPD3",20,0)
 ;    CRLX = CMOP unsuccessful release & reverse
"RTN","BPSNCPD3",21,0)
 ;    DC   = Discontinue - only reverse un-released PAYABLE DC's, release date check
"RTN","BPSNCPD3",22,0)
 ;           should be in calling routine.
"RTN","BPSNCPD3",23,0)
 ;    DDED = Delete in edit
"RTN","BPSNCPD3",24,0)
 ;    DE   = Delete
"RTN","BPSNCPD3",25,0)
 ;    ED   = Edit
"RTN","BPSNCPD3",26,0)
 ;    ERES = Resubmit from ECME user screen
"RTN","BPSNCPD3",27,0)
 ;    EREV = Reversal from ECME user screen
"RTN","BPSNCPD3",28,0)
 ;    HLD  = Put prescription on Hold
"RTN","BPSNCPD3",29,0)
 ;    OF   = Original Fill
"RTN","BPSNCPD3",30,0)
 ;    PC   = Pull CMOPs
"RTN","BPSNCPD3",31,0)
 ;    PE   = Pull early from suspense
"RTN","BPSNCPD3",32,0)
 ;    PL   = Pull local from suspense
"RTN","BPSNCPD3",33,0)
 ;    PP   = PP from Patient Prescription Processing option
"RTN","BPSNCPD3",34,0)
 ;    RF   = Refill
"RTN","BPSNCPD3",35,0)
 ;    RL   = Release Rx NDC check - Rebill if billed NDC doesn't match release NDC
"RTN","BPSNCPD3",36,0)
 ;    RN   = Renew
"RTN","BPSNCPD3",37,0)
 ;    RRL  = Original claim rejected, submit another claim, no reversal
"RTN","BPSNCPD3",38,0)
 ;    RS   = Return-to-Stock
"RTN","BPSNCPD3",39,0)
 ; BILLNDC = Valid NDC# with format 5-4-2
"RTN","BPSNCPD3",40,0)
 ; REVREAS = Reversal Reason
"RTN","BPSNCPD3",41,0)
 ; DURREC  = String of DUR info - Three "^" pieces
"RTN","BPSNCPD3",42,0)
 ;                Professional Service Code
"RTN","BPSNCPD3",43,0)
 ;                Reason for Service Code
"RTN","BPSNCPD3",44,0)
 ;                Result of Service Code
"RTN","BPSNCPD3",45,0)
 ; BPOVRIEN = Pointer to BPS NCPDP OVERIDE file.  This parameter will 
"RTN","BPSNCPD3",46,0)
 ;            only be passed if there are overrides entered by the
"RTN","BPSNCPD3",47,0)
 ;            user via the Resubmit with Edits (RED) option in the 
"RTN","BPSNCPD3",48,0)
 ;            user screen.
"RTN","BPSNCPD3",49,0)
 ; BPSAUTH = pre-authorization code (preauth. code^preauth number)
"RTN","BPSNCPD3",50,0)
 ; BPSCLARF = Submission Clarification Code (ien of the #9002313.25), entered by pharmacist and passed
"RTN","BPSNCPD3",51,0)
 ;            by Outpatient Pharmacy to ECME to put into the claim  
"RTN","BPSNCPD3",52,0)
 ; BPCOBIND = (optional, default is Primary) for COB indicators - so when the API is called for the particular
"RTN","BPSNCPD3",53,0)
 ;            COB claim the BPSNCPDP can handle it.
"RTN","BPSNCPD3",54,0)
 ; BPJOBFLG = (optional, default is "F") B - if is called by unqueueing logic in background, F - by other (foreground) process, 
"RTN","BPSNCPD3",55,0)
 ; BPREQIEN = (optional) ien of BPS REQUEST file record, that needs to be unqueued 
"RTN","BPSNCPD3",56,0)
 ; BPSCLOSE = (optional) local array used with BWHERE="EREV" only, if the user had chosen to close the claim after reversal
"RTN","BPSNCPD3",57,0)
 ;   if claim needs to be closed then
"RTN","BPSNCPD3",58,0)
 ;   BPSCLOSE("CLOSE AFT REV")=1
"RTN","BPSNCPD3",59,0)
 ;   BPSCLOSE("CLOSE AFT REV REASON")=<#356.8 ien>
"RTN","BPSNCPD3",60,0)
 ;   BPSCLOSE("CLOSE AFT REV COMMENT")=<some text>
"RTN","BPSNCPD3",61,0)
 ; 
"RTN","BPSNCPD3",62,0)
 ;Output (RESPONSE^MESSAGE^ELIGIBILITY^CLAIMSTATUS)
"RTN","BPSNCPD3",63,0)
 ; RESPONSE
"RTN","BPSNCPD3",64,0)
 ;    0  Submitted through ECME
"RTN","BPSNCPD3",65,0)
 ;    1  No submission through ECME
"RTN","BPSNCPD3",66,0)
 ;    2  IB not billable
"RTN","BPSNCPD3",67,0)
 ;    3  Claim was closed, not submitted (RTS/Deletes)
"RTN","BPSNCPD3",68,0)
 ;    4  Unable to queue claim
"RTN","BPSNCPD3",69,0)
 ;    5  Incorrect information supplied to ECME
"RTN","BPSNCPD3",70,0)
 ;    6  Inactive ECME - Primarily used for Tricare to say ok to process rx
"RTN","BPSNCPD3",71,0)
 ;    10 Reversal but no resubmit
"RTN","BPSNCPD3",72,0)
 ; MESSAGE = Message associated with the response (error/submitted)
"RTN","BPSNCPD3",73,0)
 ; ELIGIBILITY = V - VA, T - Tricare
"RTN","BPSNCPD3",74,0)
 ; CLAIMSTATUS = claim status (null or IN PROGRESS/E PAYABLE/etc...)
"RTN","BPSNCPD3",75,0)
 ; ----------------- End of BPSNCPDP comments ----------------------
"RTN","BPSNCPD3",76,0)
 ;
"RTN","BPSNCPD3",77,0)
 ; ----------------- DUR1 ------------------------------------------
"RTN","BPSNCPD3",78,0)
 ; DUR1 is called by PSO to get the reject info so that should NOT be removed
"RTN","BPSNCPD3",79,0)
 ;
"RTN","BPSNCPD3",80,0)
 ;
"RTN","BPSNCPD3",81,0)
 ; IA 4560
"RTN","BPSNCPD3",82,0)
 ; Function call for DUR INFORMATION 
"RTN","BPSNCPD3",83,0)
 ; Parameters: BRXIEN = Prescription IEN
"RTN","BPSNCPD3",84,0)
 ;             BFILL = fill number
"RTN","BPSNCPD3",85,0)
 ;             DUR = DUR info passed back
"RTN","BPSNCPD3",86,0)
 ;             ERROR = error passed back
"RTN","BPSNCPD3",87,0)
 ; Note:
"RTN","BPSNCPD3",88,0)
 ;    DUR("BILLED")=0 if ecme off for pharmacy or no transaction in ECME
"RTN","BPSNCPD3",89,0)
 ;    DUR(<Insurance counter>,"BILLED")=1 if billed through ecme
"RTN","BPSNCPD3",90,0)
DUR1(BRXIEN,BFILL,DUR,ERROR) ;
"RTN","BPSNCPD3",91,0)
 N SITE,DFILL,TRANIEN,JJ,DUR1,DURIEN,I
"RTN","BPSNCPD3",92,0)
 ;
"RTN","BPSNCPD3",93,0)
 ; Get Site info and check is ECME is turned on
"RTN","BPSNCPD3",94,0)
 ; If not, set DUR("BILLED")=0 and quit
"RTN","BPSNCPD3",95,0)
 I '$G(BFILL) S SITE=$$RXAPI1^BPSUTIL1(BRXIEN,20,"I")
"RTN","BPSNCPD3",96,0)
 I $G(BFILL) S SITE=$$RXSUBF1^BPSUTIL1(BRXIEN,52,52.1,BFILL,8,"I")
"RTN","BPSNCPD3",97,0)
 I '$$ECMEON^BPSUTIL(SITE) S DUR("BILLED")=0 Q
"RTN","BPSNCPD3",98,0)
 ;
"RTN","BPSNCPD3",99,0)
 ; Set up the Transaction IEN
"RTN","BPSNCPD3",100,0)
 S DFILL="",DFILL=$E($TR($J("",4-$L(BFILL))," ","0")_BFILL,1,4)_1
"RTN","BPSNCPD3",101,0)
 S TRANIEN=BRXIEN_"."_DFILL
"RTN","BPSNCPD3",102,0)
 ;
"RTN","BPSNCPD3",103,0)
 ; If the transaction record does not exist, set DUR("BILLED")=0 and quit
"RTN","BPSNCPD3",104,0)
 I '$D(^BPST(TRANIEN)) S DUR("BILLED")=0 Q
"RTN","BPSNCPD3",105,0)
 ;
"RTN","BPSNCPD3",106,0)
 ; Loop through the insurance multiple and set DUR array
"RTN","BPSNCPD3",107,0)
 S JJ=0
"RTN","BPSNCPD3",108,0)
 F  S JJ=$O(^BPST(TRANIEN,10,JJ)) Q:JJ=""!(JJ'?1N.N)  D
"RTN","BPSNCPD3",109,0)
 . ;
"RTN","BPSNCPD3",110,0)
 . ; We are good so set Billed
"RTN","BPSNCPD3",111,0)
 . S DUR(JJ,"BILLED")=1
"RTN","BPSNCPD3",112,0)
 . ;
"RTN","BPSNCPD3",113,0)
 . S DUR(JJ,"ELIGBLT")=$P($G(^BPST(TRANIEN,9)),U,4)
"RTN","BPSNCPD3",114,0)
 . ; Get Insurance Info and set into DUR array
"RTN","BPSNCPD3",115,0)
 . D GETS^DIQ(9002313.59902,JJ_","_TRANIEN_",","902.05;902.06;902.24;902.25;902.26","E","DUR1","ERROR")
"RTN","BPSNCPD3",116,0)
 . S DUR(JJ,"INSURANCE NAME")=$G(DUR1(9002313.59902,JJ_","_TRANIEN_",",902.24,"E"))  ; Insurance Company Name
"RTN","BPSNCPD3",117,0)
 . S DUR(JJ,"GROUP NUMBER")=$G(DUR1(9002313.59902,JJ_","_TRANIEN_",",902.05,"E"))    ; Insurance Group Number
"RTN","BPSNCPD3",118,0)
 . S DUR(JJ,"GROUP NAME")=$G(DUR1(9002313.59902,JJ_","_TRANIEN_",",902.25,"E"))      ; Insurance Group Name
"RTN","BPSNCPD3",119,0)
 . S DUR(JJ,"PLAN CONTACT")=$G(DUR1(9002313.59902,JJ_","_TRANIEN_",",902.26,"E"))    ; Insurance Contact Number
"RTN","BPSNCPD3",120,0)
 . S DUR(JJ,"CARDHOLDER ID")=$G(DUR1(9002313.59902,JJ_","_TRANIEN_",",902.06,"E"))   ; Cardholder ID
"RTN","BPSNCPD3",121,0)
 . ;
"RTN","BPSNCPD3",122,0)
 . ; Get Response IEN and Data
"RTN","BPSNCPD3",123,0)
 . S DURIEN="",DURIEN=$P(^BPST(TRANIEN,0),"^",5)                             ;Note: in future will need to store/get DURIEN for each insurance
"RTN","BPSNCPD3",124,0)
 . S DUR(JJ,"RESPONSE IEN")=DURIEN
"RTN","BPSNCPD3",125,0)
 . D GETS^DIQ(9002313.0301,"1,"_DURIEN_",","501;567.01*;526","E","DUR1","ERROR")
"RTN","BPSNCPD3",126,0)
 . S DUR(JJ,"PAYER MESSAGE")=$G(DUR1(9002313.0301,"1,"_DURIEN_",",526,"E"))           ;Additional free text message info from payer
"RTN","BPSNCPD3",127,0)
 . S DUR(JJ,"STATUS")=$G(DUR1(9002313.0301,"1,"_DURIEN_",",501,"E"))                  ;Status of Response
"RTN","BPSNCPD3",128,0)
 . S DUR(JJ,"REASON")=$G(DUR1(9002313.1101,"1,1,"_DURIEN_",",439,"E"))                ;Reason of Service Code
"RTN","BPSNCPD3",129,0)
 . S DUR(JJ,"PREV FILL DATE")=$G(DUR1(9002313.1101,"1,1,"_DURIEN_",",530,"E"))        ;Previous Date of Fill
"RTN","BPSNCPD3",130,0)
 . S DUR(JJ,"DUR FREE TEXT DESC")=$G(DUR1(9002313.1101,"1,1,"_DURIEN_",",544,"E"))    ;DUR Free Text Message from Payer
"RTN","BPSNCPD3",131,0)
 . ;
"RTN","BPSNCPD3",132,0)
 . ; Get DUR reject codes and description and store in DUR 
"RTN","BPSNCPD3",133,0)
 . D GETS^DIQ(9002313.0301,"1,"_DURIEN_",","511*","I","DUR1","ERROR")                 ;get DUR codes and descriptions
"RTN","BPSNCPD3",134,0)
 . S DUR(JJ,"REJ CODE LST")=""
"RTN","BPSNCPD3",135,0)
 . F I=1:1 Q:'$D(DUR1(9002313.03511,I_",1,"_DURIEN_","))  D
"RTN","BPSNCPD3",136,0)
 .. S DUR(JJ,"REJ CODES",I,DUR1(9002313.03511,I_",1,"_DURIEN_",",.01,"I"))=$$GET1^DIQ(9002313.93,DUR1(9002313.03511,I_",1,"_DURIEN_",",.01,"I"),".02")
"RTN","BPSNCPD3",137,0)
 .. S DUR(JJ,"REJ CODE LST")=DUR(JJ,"REJ CODE LST")_","_DUR1(9002313.03511,I_",1,"_DURIEN_",",.01,"I")
"RTN","BPSNCPD3",138,0)
 . S DUR(JJ,"REJ CODE LST")=$E(DUR(JJ,"REJ CODE LST"),2,9999)
"RTN","BPSNCPD3",139,0)
 Q
"RTN","BPSNCPD4")
0^65^B40771134
"RTN","BPSNCPD4",1,0)
BPSNCPD4 ;OAK/ELZ - Extension of BPSNCPDP ;4/16/08  17:07
"RTN","BPSNCPD4",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**6,7**;JUN 2004;Build 46
"RTN","BPSNCPD4",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSNCPD4",4,0)
 ;
"RTN","BPSNCPD4",5,0)
 ;
"RTN","BPSNCPD4",6,0)
 ; Certification Testing
"RTN","BPSNCPD4",7,0)
CERTTEST(BILLNDC,CERTIEN) ;
"RTN","BPSNCPD4",8,0)
 N QUIT,RESPONSE,CLMSTAT
"RTN","BPSNCPD4",9,0)
 S RESPONSE=1,CLMSTAT=""
"RTN","BPSNCPD4",10,0)
 ; If this is Certification Testing - ask questions
"RTN","BPSNCPD4",11,0)
 S QUIT=0,CERTIEN=""
"RTN","BPSNCPD4",12,0)
 I ^BPS(9002313.99,1,"CERTIFIER")=DUZ D  I QUIT S CLMSTAT="User exited from certification questions",RESPONSE=1 Q RESPONSE_U_CLMSTAT
"RTN","BPSNCPD4",13,0)
C1 . R !,"ENTER NDC: ",BILLNDC:120 S:BILLNDC="^" QUIT=1 Q:QUIT  I BILLNDC="" G C1
"RTN","BPSNCPD4",14,0)
C3 . R !,"CERTIFICATION ENTRY: ",CERTIEN:120 I '$D(^BPS(9002313.31,CERTIEN)) S:CERTIEN="^" QUIT=1 Q:QUIT  W !,"INVALID IEN" G C3
"RTN","BPSNCPD4",15,0)
 I WFLG W !!
"RTN","BPSNCPD4",16,0)
 Q 0
"RTN","BPSNCPD4",17,0)
 ;
"RTN","BPSNCPD4",18,0)
 ;== reversal+resubmit for payables
"RTN","BPSNCPD4",19,0)
 ;returns:
"RTN","BPSNCPD4",20,0)
 ; 0 - Submitted through ECME
"RTN","BPSNCPD4",21,0)
 ; or 
"RTN","BPSNCPD4",22,0)
 ; RESPONSE code^CLAMSTAT^D(display message)^number of seconds to hang^additional info
"RTN","BPSNCPD4",23,0)
 ; see EN^BPSNCPD4 for RESPONSE values
"RTN","BPSNCPD4",24,0)
REVRESUB(BPREVREQ,BRXIEN,BFILL,BFILLDAT,BWHERE,BILLNDC,REVREAS,DURREC,BPOVRIEN,BPSCLARF,BPSAUTH,BPCOBIND,BPJOBFLG,IEN59,DFN,BPSTART,BPREQIEN,OLDRESP,BPSELIG) ;
"RTN","BPSNCPD4",25,0)
 N BPSITE,BPECMOFF,BPSARRY,MOREDATA,IB,BPRETV,BPZRET,BPCLMST,BPONLREV,BPRETVAL,BPUSRMSG,CERTIEN,BPRESP,BPRETUNC
"RTN","BPSNCPD4",26,0)
 I BPJOBFLG'="F",BPJOBFLG'="B" D LOG(IEN59,"Job Flag missing") Q "5^Job Flag missing"  ;RESPONSE^CLMSTAT
"RTN","BPSNCPD4",27,0)
 I BPJOBFLG="B" D LOG(IEN59,"Reversal+Resubmit cannot be done in background") Q "5^Reversal+Resubmit cannot be done in background"  ;RESPONSE^CLMSTAT
"RTN","BPSNCPD4",28,0)
 S BPCLMST="",BPONLREV=0,BPRESP=""
"RTN","BPSNCPD4",29,0)
 ;
"RTN","BPSNCPD4",30,0)
 S BPSITE=+$$GETSITE^BPSOSRX8(BRXIEN,BFILL)
"RTN","BPSNCPD4",31,0)
 ;
"RTN","BPSNCPD4",32,0)
 ;populate MOREDATA with bacis data
"RTN","BPSNCPD4",33,0)
 D BASICMOR^BPSOSRX8(BWHERE,BFILLDAT,REVREAS,DURREC,BPOVRIEN,BPSCLARF,BPSAUTH,.MOREDATA)
"RTN","BPSNCPD4",34,0)
 ;
"RTN","BPSNCPD4",35,0)
 ;Certification Testing
"RTN","BPSNCPD4",36,0)
 ;sets:
"RTN","BPSNCPD4",37,0)
 ; BILLNDC which is used in STARRAY^BPSNCPD1
"RTN","BPSNCPD4",38,0)
 ; CERTIEN which is used in BILLABLE
"RTN","BPSNCPD4",39,0)
 S BPRESP=$$CERTTEST(.BILLNDC,.CERTIEN) I +BPRESP=1 Q BPRESP
"RTN","BPSNCPD4",40,0)
 ;populate BPSARRY
"RTN","BPSNCPD4",41,0)
 ;Note:
"RTN","BPSNCPD4",42,0)
 ;the following is passed as backdoor parameters
"RTN","BPSNCPD4",43,0)
 ; DFN - patient's IEN
"RTN","BPSNCPD4",44,0)
 ; BILLNDC - NDC
"RTN","BPSNCPD4",45,0)
 ; BFILLDAT - fill date
"RTN","BPSNCPD4",46,0)
 D STARRAY^BPSNCPD1(BRXIEN,BFILL,BWHERE,.BPSARRY,BPSITE)
"RTN","BPSNCPD4",47,0)
 ;Billing determination
"RTN","BPSNCPD4",48,0)
 S IB=$$BILLABLE(DFN,BWHERE,.MOREDATA,.BPSARRY,CERTIEN,.BPSELIG)
"RTN","BPSNCPD4",49,0)
 ;if no response from IB
"RTN","BPSNCPD4",50,0)
 I +IB=0 Q $P(IB,U,2,5)
"RTN","BPSNCPD4",51,0)
 ;if non-billable
"RTN","BPSNCPD4",52,0)
 I +IB=2 S BPONLREV=1 ;set "ONLY REVERSAL IS POSSIBLE" flag
"RTN","BPSNCPD4",53,0)
 ;Set the User message if necessary
"RTN","BPSNCPD4",54,0)
 S BPUSRMSG=$S(BPONLREV=1:"Claim Will Be Reversed But Will Not Be Resubmitted",1:"")
"RTN","BPSNCPD4",55,0)
 I BPONLREV=1 D LOG(IEN59,$P($G(MOREDATA("BILL")),"^",2)_" - "_BPUSRMSG)
"RTN","BPSNCPD4",56,0)
 ;check IB data if it is billable
"RTN","BPSNCPD4",57,0)
 I BPONLREV'=1 S BPRETV=$$IBDATAOK^BPSOSRX8(.MOREDATA,$G(BPSARRY("NO ECME INSURANCE"))) I BPRETV>0 Q BPRETV
"RTN","BPSNCPD4",58,0)
 ;
"RTN","BPSNCPD4",59,0)
 ;schedule request(s)
"RTN","BPSNCPD4",60,0)
 ;
"RTN","BPSNCPD4",61,0)
 ; If override flag is set, prompt for override values - TEST ONLY
"RTN","BPSNCPD4",62,0)
 I $$CHECK^BPSTEST D
"RTN","BPSNCPD4",63,0)
 . I BPONLREV=1 D GETOVER^BPSTEST(BRXIEN,BFILL,OLDRESP,BWHERE,"R") Q
"RTN","BPSNCPD4",64,0)
 . ;if it is billable and we will doing resubmit
"RTN","BPSNCPD4",65,0)
 . D GETOVER^BPSTEST(BRXIEN,BFILL,OLDRESP,BWHERE,"S")
"RTN","BPSNCPD4",66,0)
 ;
"RTN","BPSNCPD4",67,0)
 ;.... Step 1, Schedule a Reversal
"RTN","BPSNCPD4",68,0)
 ; Log message to ECME log
"RTN","BPSNCPD4",69,0)
 ; Needed for Turn-Around Stats - Do NOT delete/alter!!
"RTN","BPSNCPD4",70,0)
 D LOG(IEN59,"Before Submit of Reversal")
"RTN","BPSNCPD4",71,0)
 S BPSTART=$$STTM()
"RTN","BPSNCPD4",72,0)
 ;
"RTN","BPSNCPD4",73,0)
 ;schedule an UNCLAIM request
"RTN","BPSNCPD4",74,0)
 S BPRETV=$$REQST^BPSOSRX("U",BRXIEN,BFILL,.MOREDATA,BPCOBIND,IEN59,$G(BILLNDC))
"RTN","BPSNCPD4",75,0)
 S BPREVREQ=+$P(BPRETV,U,2) ;BPS REQUEST ien of  the reversal
"RTN","BPSNCPD4",76,0)
 ;if error
"RTN","BPSNCPD4",77,0)
 I +BPRETV=0 D  Q $$RSPCLMS^BPSOSRX8("UC",4,.MOREDATA,$P(BPRETV,U,2))
"RTN","BPSNCPD4",78,0)
 . D LOG(IEN59,"Create request error: "_$P(BPRETV,U,2)_". Claim Will Not Be submitted.")
"RTN","BPSNCPD4",79,0)
 . L -^BPST
"RTN","BPSNCPD4",80,0)
 ;if ok
"RTN","BPSNCPD4",81,0)
 D LOG(IEN59,"The request "_BPREVREQ_" has been created")
"RTN","BPSNCPD4",82,0)
 ;if "Reversal only not resubmit" return appropriate RESPONSE and CLMSTAT, 
"RTN","BPSNCPD4",83,0)
 ;store MOREDATA("BILL" for the "final CLMSTAT"
"RTN","BPSNCPD4",84,0)
 ;and quit
"RTN","BPSNCPD4",85,0)
 I BPONLREV=1 D  Q $$RSPCLMS^BPSOSRX8("UC",10,.MOREDATA)_U_$P($G(MOREDATA("BILL")),U,2)
"RTN","BPSNCPD4",86,0)
 . ;activate the scheduled UNCLAIM request
"RTN","BPSNCPD4",87,0)
 . S BPRETUNC=$$ACTIVATE(BPREVREQ,"U")
"RTN","BPSNCPD4",88,0)
 ;
"RTN","BPSNCPD4",89,0)
 ;.... Step 2, Schedule a Resubmit
"RTN","BPSNCPD4",90,0)
 ; Log message to ECME log
"RTN","BPSNCPD4",91,0)
 D LOG(IEN59,"Before submit of claim")
"RTN","BPSNCPD4",92,0)
 S BPRETV=$$REQST^BPSOSRX("C",BRXIEN,BFILL,.MOREDATA,BPCOBIND,IEN59,$G(BILLNDC))
"RTN","BPSNCPD4",93,0)
 ; if error
"RTN","BPSNCPD4",94,0)
 I +BPRETV=0 D  Q $$RSPCLMS^BPSOSRX8("C",4,.MOREDATA)_U_BPUSRMSG
"RTN","BPSNCPD4",95,0)
 . ;activate the scheduled UNCLAIM request
"RTN","BPSNCPD4",96,0)
 . S BPRETUNC=$$ACTIVATE(BPREVREQ,"U")
"RTN","BPSNCPD4",97,0)
 . D LOG(IEN59,"Create request error: "_$P(BPRETV,U,2)_". Claim Will Not Be submitted.")
"RTN","BPSNCPD4",98,0)
 . ;Set the User message if necessary
"RTN","BPSNCPD4",99,0)
 . I +BPRETUNC=0 S BPUSRMSG="Cannot schedule resubmit: Claim Will Be Reversed But Will Not Be Resubmitted "
"RTN","BPSNCPD4",100,0)
 ;if ok
"RTN","BPSNCPD4",101,0)
 D LOG(IEN59,"BPS REQUEST: "_+$P(BPRETV,U,2)_" has been created")
"RTN","BPSNCPD4",102,0)
 ;
"RTN","BPSNCPD4",103,0)
 I +$$NXTREQST^BPSOSRX6(BPREVREQ,+$P(BPRETV,U,2))=0 D  Q $$RSPCLMS^BPSOSRX8("C",4,.MOREDATA)_U_BPUSRMSG
"RTN","BPSNCPD4",104,0)
 . ;activate the scheduled UNCLAIM request
"RTN","BPSNCPD4",105,0)
 . S BPRETUNC=$$ACTIVATE(BPREVREQ,"U")
"RTN","BPSNCPD4",106,0)
 . D LOG(IEN59,"Cannot make "_+$P(BPRETV,U,2)_"as a NEXT REQUEST in "_BPREVREQ)
"RTN","BPSNCPD4",107,0)
 . I +BPRETUNC=0 S BPUSRMSG="Cannot schedule resubmit: Claim Will Be Reversed But Will Not Be Resubmitted "
"RTN","BPSNCPD4",108,0)
 ;
"RTN","BPSNCPD4",109,0)
 ;activate the scheduled UNCLAIM request
"RTN","BPSNCPD4",110,0)
 S BPRETUNC=$$ACTIVATE(BPREVREQ,"U")
"RTN","BPSNCPD4",111,0)
 ; save RETVAL for the 2st step
"RTN","BPSNCPD4",112,0)
 S BPRETVAL=$$RSPCLMS^BPSOSRX8("UC",+BPRETUNC,.MOREDATA)_U_$P(BPRETUNC,U,2)
"RTN","BPSNCPD4",113,0)
 Q BPRETVAL_U_BPUSRMSG
"RTN","BPSNCPD4",114,0)
 ;
"RTN","BPSNCPD4",115,0)
 ;
"RTN","BPSNCPD4",116,0)
 ;
"RTN","BPSNCPD4",117,0)
 ;display submission results
"RTN","BPSNCPD4",118,0)
 ;BPRETVAL - RESPONSE ^ CLAIMSTAT ^ flag:D-display on the screen ^ Hang time
"RTN","BPSNCPD4",119,0)
DISPL(WFLG,BPRETVAL,BPELIGIB) ;
"RTN","BPSNCPD4",120,0)
 N BPHANG
"RTN","BPSNCPD4",121,0)
 ;if Tricare then shall print messages to the screen
"RTN","BPSNCPD4",122,0)
 I $G(BPELIGIB)="T" S WFLG=1
"RTN","BPSNCPD4",123,0)
 I WFLG=0 Q
"RTN","BPSNCPD4",124,0)
 I $P(BPRETVAL,U,3)'="D" Q
"RTN","BPSNCPD4",125,0)
 W !!,$P(BPRETVAL,U,2)
"RTN","BPSNCPD4",126,0)
 W:+BPRETVAL'=0 !
"RTN","BPSNCPD4",127,0)
 S BPHANG=+$P(BPRETVAL,U,4)
"RTN","BPSNCPD4",128,0)
 I BPHANG>0 H BPHANG
"RTN","BPSNCPD4",129,0)
 Q
"RTN","BPSNCPD4",130,0)
 ;IB (billing) determination
"RTN","BPSNCPD4",131,0)
 ;input:
"RTN","BPSNCPD4",132,0)
 ;DFN - PATIENT file #2 ien
"RTN","BPSNCPD4",133,0)
 ;BWHERE - shows where the code is called from and what needs to be done
"RTN","BPSNCPD4",134,0)
 ;the following should be passed by reference:
"RTN","BPSNCPD4",135,0)
 ;MOREDATA - Initialized by BPSNCPDP and more data is added here
"RTN","BPSNCPD4",136,0)
 ;BPSARRY  - Created by STARRAY^BPSNCPD1 and used for IB Determination
"RTN","BPSNCPD4",137,0)
 ;CERTIEN - BPS Certification IEN - Not passed but newed/set in BPSNCPDP, is used by EN^BPSNCPD2 as a backdoor parameter
"RTN","BPSNCPD4",138,0)
 ;BPSELIG - to return eligibility, by ref
"RTN","BPSNCPD4",139,0)
 ;output: 
"RTN","BPSNCPD4",140,0)
 ;if billable :1
"RTN","BPSNCPD4",141,0)
 ;no response : 0^RESPONSE code=2 or 6^CLMSTAT message^D(display message)^seconds to hang 
"RTN","BPSNCPD4",142,0)
 ;non billable : 2^RESPONSE code=2 or 6^CLMSTAT message 
"RTN","BPSNCPD4",143,0)
BILLABLE(DFN,BWHERE,MOREDATA,BPSARRY,CERTIEN,BPSELIG) ;
"RTN","BPSNCPD4",144,0)
 N IB S IB=0
"RTN","BPSNCPD4",145,0)
 D EN^BPSNCPD2(DFN,BWHERE,.MOREDATA,.BPSARRY,.IB)
"RTN","BPSNCPD4",146,0)
 S BPSELIG=$G(MOREDATA("ELIG"))
"RTN","BPSNCPD4",147,0)
 I IB=2 Q $S($G(BPSARRY("NO ECME INSURANCE")):"2^6^",1:"2^2^")_$P(MOREDATA("BILL"),"^",2)
"RTN","BPSNCPD4",148,0)
 I (IB=0)!('$G(MOREDATA("BILL"))) Q $S($G(BPSARRY("NO ECME INSURANCE")):"0^6^",1:"0^2^")_"Flagged by IB to not 3rd Party Insurance bill through ECME.^D^2"
"RTN","BPSNCPD4",149,0)
 Q 1
"RTN","BPSNCPD4",150,0)
 ;activate the request
"RTN","BPSNCPD4",151,0)
 ;returns:
"RTN","BPSNCPD4",152,0)
 ; 0 - Submitted through ECME
"RTN","BPSNCPD4",153,0)
 ; or 
"RTN","BPSNCPD4",154,0)
 ; RESPONSE code^message^D(display message)^seconds to hang
"RTN","BPSNCPD4",155,0)
 ; see EN^BPSNCPD4 for RESPONSE values
"RTN","BPSNCPD4",156,0)
ACTIVATE(BPIEN77,BPACTYP) ;
"RTN","BPSNCPD4",157,0)
 I +$G(BPIEN77)=0 Q "4^There is no request to activate"
"RTN","BPSNCPD4",158,0)
 S BPACTYP=$S($G(BPACTYP)="C":"CLAIM",$G(BPACTYP)="U":"UNCLAIM",1:"")
"RTN","BPSNCPD4",159,0)
 ;if there is no existing requests for the RX/RF then simply activate the new request
"RTN","BPSNCPD4",160,0)
 I +$$ACTIVATE^BPSOSRX4(BPIEN77)=0 D INACTIVE^BPSOSRX4(BPIEN77) D  Q "4^Cannot ACTIVATE the scheduled """_BPACTYP_""" request^D^2"
"RTN","BPSNCPD4",161,0)
 . D LOG(IEN59,"BPS REQUEST: "_+BPIEN77_" Cannot ACTIVATE the scheduled """_BPACTYP_""" request, it has been inactivated")
"RTN","BPSNCPD4",162,0)
 Q "0"
"RTN","BPSNCPD4",163,0)
 ;
"RTN","BPSNCPD4",164,0)
 ;======== end of API
"RTN","BPSNCPD4",165,0)
LOG(IEN59,MSG,BPDTFLG) ;
"RTN","BPSNCPD4",166,0)
 D LOG^BPSOSL(IEN59,$T(+0)_"-"_MSG,$G(BPDTFLG))
"RTN","BPSNCPD4",167,0)
 Q
"RTN","BPSNCPD4",168,0)
STTM() ;
"RTN","BPSNCPD4",169,0)
 Q $$NOW^XLFDT
"RTN","BPSNCPD4",170,0)
 ;
"RTN","BPSNCPD5")
0^66^B64980990
"RTN","BPSNCPD5",1,0)
BPSNCPD5 ;ALB/SS - Pharmacy API part 5 ;10-JAN-08
"RTN","BPSNCPD5",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**7**;JUN 2004;Build 46
"RTN","BPSNCPD5",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSNCPD5",4,0)
 ;
"RTN","BPSNCPD5",5,0)
 ;schedule a reversal for the future
"RTN","BPSNCPD5",6,0)
 ; BPNEWREQ -by ref to return new BPS REQUEST ien
"RTN","BPSNCPD5",7,0)
 ; BRXIEN - #52 ien
"RTN","BPSNCPD5",8,0)
 ; BFILL -refill no
"RTN","BPSNCPD5",9,0)
 ; BFILLDAT - Date of service
"RTN","BPSNCPD5",10,0)
 ; BWHERE - see
"RTN","BPSNCPD5",11,0)
 ; BILLNDC
"RTN","BPSNCPD5",12,0)
 ; REVREAS
"RTN","BPSNCPD5",13,0)
 ; DURREC
"RTN","BPSNCPD5",14,0)
 ; BPOVRIEN
"RTN","BPSNCPD5",15,0)
 ; BPSCLARF
"RTN","BPSNCPD5",16,0)
 ; BPSAUTH
"RTN","BPSNCPD5",17,0)
 ; IEN59
"RTN","BPSNCPD5",18,0)
 ; BPCOBIND
"RTN","BPSNCPD5",19,0)
 ; BPREVREQ - ien of the previous BPS REQUEST
"RTN","BPSNCPD5",20,0)
 ; BPACTTYP - U - unclaim(reversal request), UC - reversal+resubmit, C - claim request
"RTN","BPSNCPD5",21,0)
 ; BPSCLS - BPSCLOSE parameter of EN^BPSNCPDP
"RTN","BPSNCPD5",22,0)
 ;returns:
"RTN","BPSNCPD5",23,0)
 ; RESPONSE code^CLAMSTAT message^D(display message)^number of seconds to hang^IEN of the new request
"RTN","BPSNCPD5",24,0)
 ; RESPONSE code = 0 - Submitted through ECME
"RTN","BPSNCPD5",25,0)
 ; see EN^BPSNCPD4 for other RESPONSE values;
"RTN","BPSNCPD5",26,0)
SCHREQ(BPNEWREQ,BRXIEN,BFILL,BFILLDAT,BWHERE,BILLNDC,REVREAS,DURREC,BPOVRIEN,BPSCLARF,BPSAUTH,IEN59,BPCOBIND,BPREVREQ,BPACTTYP,BPSCLS) ;
"RTN","BPSNCPD5",27,0)
 N RESP,RESPONSE,MOREDATA,BPRETV
"RTN","BPSNCPD5",28,0)
 N BPUSRMSG
"RTN","BPSNCPD5",29,0)
 ;populate MOREDATA with basic data
"RTN","BPSNCPD5",30,0)
 D BASICMOR^BPSOSRX8(BWHERE,BFILLDAT,REVREAS,DURREC,BPOVRIEN,BPSCLARF,BPSAUTH,.MOREDATA)
"RTN","BPSNCPD5",31,0)
 ; if the user has chosen to close the claim after reversal
"RTN","BPSNCPD5",32,0)
 ; BPSCLS contains the value of the BPSCLOSE parameter of EN^BPSNCPDP
"RTN","BPSNCPD5",33,0)
 I $G(BPSCLS("CLOSE AFT REV"))=1 M MOREDATA=BPSCLS
"RTN","BPSNCPD5",34,0)
 ; 
"RTN","BPSNCPD5",35,0)
 ; Needed for Turn-Around Stats - Do NOT delete/alter!!
"RTN","BPSNCPD5",36,0)
 D LOG^BPSNCPD6(IEN59,$T(+0)_"-Before Submit of Reversal")
"RTN","BPSNCPD5",37,0)
 S BPSTART=$$STTM^BPSNCPD4()
"RTN","BPSNCPD5",38,0)
 ;schedule a request
"RTN","BPSNCPD5",39,0)
 S BPRETV=$$REQST^BPSOSRX(BPACTTYP,BRXIEN,BFILL,.MOREDATA,BPCOBIND,IEN59,$G(BILLNDC),1)
"RTN","BPSNCPD5",40,0)
 S BPNEWREQ=+$P(BPRETV,U,2)
"RTN","BPSNCPD5",41,0)
 ;if error
"RTN","BPSNCPD5",42,0)
 I +BPRETV=0 D  Q $$RSPCLMS^BPSOSRX8(BPACTTYP,4,.MOREDATA)
"RTN","BPSNCPD5",43,0)
 . D LOG^BPSNCPD6(IEN59,$T(+0)_"-Create request error: "_$P(BPRETV,U,2)_". Claim Will Not Be submitted.")
"RTN","BPSNCPD5",44,0)
 . L -^BPST
"RTN","BPSNCPD5",45,0)
 ;if ok
"RTN","BPSNCPD5",46,0)
 D LOG^BPSNCPD6(IEN59,$T(+0)_"-BPS REQUEST: "_BPNEWREQ_" has been created")
"RTN","BPSNCPD5",47,0)
 ;determine the last request
"RTN","BPSNCPD5",48,0)
 I +$$NXTREQST^BPSOSRX6(BPREVREQ,BPNEWREQ)=0 D  Q $$RSPCLMS^BPSOSRX8("C",4,.MOREDATA)
"RTN","BPSNCPD5",49,0)
 . D LOG^BPSNCPD6(IEN59,$T(+0)_"-Cannot make "_BPNEWREQ_"as a NEXT REQUEST in "_BPREVREQ)
"RTN","BPSNCPD5",50,0)
 Q $$RSPCLMS^BPSOSRX8(BPACTTYP,0,.MOREDATA)_U_BPNEWREQ
"RTN","BPSNCPD5",51,0)
 ;
"RTN","BPSNCPD5",52,0)
 ;====== Schedule a reversal
"RTN","BPSNCPD5",53,0)
 ;BPSCLS - BPSCLOSE parameter of EN^BPSNCPDP
"RTN","BPSNCPD5",54,0)
REVERSAL(BPNEWREQ,BRXIEN,BFILL,OLDRESP,BFILLDAT,BWHERE,BILLNDC,REVREAS,DURREC,BPOVRIEN,BPSCLARF,BPSAUTH,IEN59,BPCOBIND,BPJOBFLG,BPACTTYP,BPSTART,BPREQIEN,BPSCLS) ;
"RTN","BPSNCPD5",55,0)
 N RESP,RESPONSE,MOREDATA,BPRETV
"RTN","BPSNCPD5",56,0)
 ;populate MOREDATA with basic data
"RTN","BPSNCPD5",57,0)
 D BASICMOR^BPSOSRX8(BWHERE,BFILLDAT,REVREAS,DURREC,BPOVRIEN,BPSCLARF,BPSAUTH,.MOREDATA)
"RTN","BPSNCPD5",58,0)
 ; if the user has chosen to close the claim after reversal
"RTN","BPSNCPD5",59,0)
 ; BPSCLS contains the value of the BPSCLOSE parameter of EN^BPSNCPDP
"RTN","BPSNCPD5",60,0)
 I $G(BPSCLS("CLOSE AFT REV"))=1 M MOREDATA=BPSCLS
"RTN","BPSNCPD5",61,0)
 ;
"RTN","BPSNCPD5",62,0)
 ; Do a reversal for the appropriate actions
"RTN","BPSNCPD5",63,0)
 ; If override flag is set, prompt for override values - TEST ONLY
"RTN","BPSNCPD5",64,0)
 ;
"RTN","BPSNCPD5",65,0)
 I $$CHECK^BPSTEST D GETOVER^BPSTEST(BRXIEN,BFILL,OLDRESP,BWHERE,"R")
"RTN","BPSNCPD5",66,0)
 ;
"RTN","BPSNCPD5",67,0)
 ; Needed for Turn-Around Stats - Do NOT delete/alter!!
"RTN","BPSNCPD5",68,0)
 D LOG^BPSNCPD6(IEN59,$T(+0)_"-Before Submit of Reversal")
"RTN","BPSNCPD5",69,0)
 S BPSTART=$$STTM^BPSNCPD4()
"RTN","BPSNCPD5",70,0)
 ;if background job
"RTN","BPSNCPD5",71,0)
 I BPJOBFLG="B" S BPRETV=$$ACTIVATE^BPSNCPD4(BPREQIEN,"U") Q $$RSPCLMS^BPSOSRX8(BPACTTYP,+BPRETV,.MOREDATA)_U_$P(BPRETV,U,2)
"RTN","BPSNCPD5",72,0)
 ;if foreground job then schedule an UNCLAIM request
"RTN","BPSNCPD5",73,0)
 S BPRETV=$$REQST^BPSOSRX("U",BRXIEN,BFILL,.MOREDATA,BPCOBIND,IEN59,$G(BILLNDC))
"RTN","BPSNCPD5",74,0)
 S BPNEWREQ=+$P(BPRETV,U,2)
"RTN","BPSNCPD5",75,0)
 ;if error
"RTN","BPSNCPD5",76,0)
 I +BPRETV=0 D  Q $$RSPCLMS^BPSOSRX8(BPACTTYP,4,.MOREDATA)
"RTN","BPSNCPD5",77,0)
 . D LOG^BPSNCPD6(IEN59,$T(+0)_"-Create request error: "_$P(BPRETV,U,2)_". Claim Will Not Be submitted.")
"RTN","BPSNCPD5",78,0)
 . L -^BPST
"RTN","BPSNCPD5",79,0)
 ;if ok
"RTN","BPSNCPD5",80,0)
 D LOG^BPSNCPD6(IEN59,$T(+0)_"-BPS REQUEST: "_BPNEWREQ_" has been created")
"RTN","BPSNCPD5",81,0)
 ;activate the scheduled request
"RTN","BPSNCPD5",82,0)
 S BPRETV=$$ACTIVATE^BPSNCPD4(BPNEWREQ,"U")
"RTN","BPSNCPD5",83,0)
 Q $$RSPCLMS^BPSOSRX8(BPACTTYP,+BPRETV,.MOREDATA)_U_BPNEWREQ
"RTN","BPSNCPD5",84,0)
 ;
"RTN","BPSNCPD5",85,0)
 ;====== Process a brand new RX/RF, which never was processed by ECME yet
"RTN","BPSNCPD5",86,0)
 ;returns:
"RTN","BPSNCPD5",87,0)
 ; 0 - Submitted through ECME
"RTN","BPSNCPD5",88,0)
 ; or 
"RTN","BPSNCPD5",89,0)
 ; RESPONSE code^CLAMSTAT^D(display message)^number of seconds to hang^additional info
"RTN","BPSNCPD5",90,0)
 ; see EN^BPSNCPD1 for RESPONSE values
"RTN","BPSNCPD5",91,0)
NEWCLM(BPNEWREQ,BRXIEN,BFILL,BFILLDAT,BWHERE,BILLNDC,REVREAS,DURREC,BPOVRIEN,BPSCLARF,BPSAUTH,BPCOBIND,BPJOBFLG,IEN59,BPACTTYP,DFN,BPSTART,BPREQIEN,BPSELIG) ;
"RTN","BPSNCPD5",92,0)
 N BPSITE,BPECMOFF,BPSARRY,MOREDATA,IB,BPRETV,BPZRET,BPCLMST,CERTIEN,BPRESP
"RTN","BPSNCPD5",93,0)
 I BPJOBFLG'="F",BPJOBFLG'="B" D LOG^BPSNCPD6(IEN59,$T(+0)_"-Job Flag missing") Q "5^Job Flag missing"  ;RESPONSE^CLMSTAT
"RTN","BPSNCPD5",94,0)
 S BPCLMST=""
"RTN","BPSNCPD5",95,0)
 I BPACTTYP'="C" Q "1^Prescription not previously billed through ECME. Cannot Reverse claim.^D^2"
"RTN","BPSNCPD5",96,0)
 S BPSITE=+$$GETSITE^BPSOSRX8(BRXIEN,BFILL)
"RTN","BPSNCPD5",97,0)
 ;check ECME availability
"RTN","BPSNCPD5",98,0)
 S BPECMOFF=$$ECMESITE^BPSOSRX5(BPSITE) I +BPECMOFF=1 Q BPECMOFF
"RTN","BPSNCPD5",99,0)
 ;populate MOREDATA with basic data
"RTN","BPSNCPD5",100,0)
 D BASICMOR^BPSOSRX8(BWHERE,BFILLDAT,REVREAS,DURREC,BPOVRIEN,BPSCLARF,BPSAUTH,.MOREDATA)
"RTN","BPSNCPD5",101,0)
 ;Certification Testing
"RTN","BPSNCPD5",102,0)
 ;sets:
"RTN","BPSNCPD5",103,0)
 ; BILLNDC which is used in STARRAY^BPSNCPD1
"RTN","BPSNCPD5",104,0)
 ; CERTIEN which is used in BILLABLE
"RTN","BPSNCPD5",105,0)
 S BPRESP=$$CERTTEST^BPSNCPD4(.BILLNDC,.CERTIEN) I +BPRESP=1 Q BPRESP
"RTN","BPSNCPD5",106,0)
 ;populate BPSARRY
"RTN","BPSNCPD5",107,0)
 ;Note:
"RTN","BPSNCPD5",108,0)
 ;the following is passed as backdoor parameters
"RTN","BPSNCPD5",109,0)
 ; DFN - patient's IEN
"RTN","BPSNCPD5",110,0)
 ; BILLNDC - NDC
"RTN","BPSNCPD5",111,0)
 ; BFILLDAT - fill date
"RTN","BPSNCPD5",112,0)
 D STARRAY^BPSNCPD1(BRXIEN,BFILL,BWHERE,.BPSARRY,BPSITE)
"RTN","BPSNCPD5",113,0)
 ;Billing determination
"RTN","BPSNCPD5",114,0)
 S IB=$$BILLABLE^BPSNCPD4(DFN,BWHERE,.MOREDATA,.BPSARRY,CERTIEN,.BPSELIG)
"RTN","BPSNCPD5",115,0)
 ;if non-billable or no response from IB
"RTN","BPSNCPD5",116,0)
 I +IB'=1 Q $P(IB,U,2,5)_"^D^"
"RTN","BPSNCPD5",117,0)
 ;check IB data
"RTN","BPSNCPD5",118,0)
 S BPRETV=$$IBDATAOK^BPSOSRX8(.MOREDATA,$G(BPSARRY("NO ECME INSURANCE"))) I BPRETV>0 Q BPRETV
"RTN","BPSNCPD5",119,0)
 ; Log message to ECME log
"RTN","BPSNCPD5",120,0)
 ; Needed for Turn-Around Stats - Do NOT delete/alter!!
"RTN","BPSNCPD5",121,0)
 D LOG^BPSNCPD6(IEN59,$T(+0)_"-Before submit of claim")
"RTN","BPSNCPD5",122,0)
 S BPSTART=$$STTM^BPSNCPD4()
"RTN","BPSNCPD5",123,0)
 ;if background job
"RTN","BPSNCPD5",124,0)
 I BPJOBFLG="B",+$G(BPREQIEN)=0 D  Q "5^BPS REQUEST IEN missing"  ;should never happen
"RTN","BPSNCPD5",125,0)
 . D LOG^BPSNCPD6(IEN59,$T(+0)_"-BPS REQUEST IEN missing for background job. Claim cannot be processed.")
"RTN","BPSNCPD5",126,0)
 I BPJOBFLG="B" D  Q $$RSPCLMS^BPSOSRX8(BPACTTYP,+BPRETV,.MOREDATA)_U_BPREQIEN
"RTN","BPSNCPD5",127,0)
 . ;Update IB data
"RTN","BPSNCPD5",128,0)
 . D UPDINSDT^BPSOSRX7(BPREQIEN,.MOREDATA,IEN59) ;
"RTN","BPSNCPD5",129,0)
 . S BPRETV=$$ACTIVATE^BPSNCPD4(BPREQIEN,"C")
"RTN","BPSNCPD5",130,0)
 ;if foreground job then schedule a CLAIM request
"RTN","BPSNCPD5",131,0)
 ;
"RTN","BPSNCPD5",132,0)
 ; If override flag is set, prompt for override values - TEST ONLY
"RTN","BPSNCPD5",133,0)
 I $$CHECK^BPSTEST D GETOVER^BPSTEST(BRXIEN,BFILL,"",BWHERE,"S")
"RTN","BPSNCPD5",134,0)
 ;
"RTN","BPSNCPD5",135,0)
 S BPRETV=$$REQST^BPSOSRX("C",BRXIEN,BFILL,.MOREDATA,BPCOBIND,IEN59,$G(BILLNDC))
"RTN","BPSNCPD5",136,0)
 S BPNEWREQ=+$P(BPRETV,U,2)
"RTN","BPSNCPD5",137,0)
 ;if error
"RTN","BPSNCPD5",138,0)
 I +BPRETV=0 D  Q $$RSPCLMS^BPSOSRX8(BPACTTYP,4,.MOREDATA,$P(BPRETV,U,2))
"RTN","BPSNCPD5",139,0)
 . D LOG^BPSNCPD6(IEN59,$T(+0)_"-Create request error: "_$P(BPRETV,U,2)_". Claim Will Not Be submitted.")
"RTN","BPSNCPD5",140,0)
 ;if ok
"RTN","BPSNCPD5",141,0)
 D LOG^BPSNCPD6(IEN59,$T(+0)_"-BPS REQUEST: "_BPNEWREQ_" has been created")
"RTN","BPSNCPD5",142,0)
 ;activate the scheduled request
"RTN","BPSNCPD5",143,0)
 S BPRETV=$$ACTIVATE^BPSNCPD4(BPNEWREQ,"C")
"RTN","BPSNCPD5",144,0)
 Q $$RSPCLMS^BPSOSRX8(BPACTTYP,+BPRETV,.MOREDATA)_U_BPNEWREQ
"RTN","BPSNCPD5",145,0)
 ;
"RTN","BPSNCPD5",146,0)
 ;Process RX/RF resubmit OR reversal+resubmit for non-payables
"RTN","BPSNCPD5",147,0)
 ;returns:
"RTN","BPSNCPD5",148,0)
 ; 0 - Submitted through ECME
"RTN","BPSNCPD5",149,0)
 ; or 
"RTN","BPSNCPD5",150,0)
 ; RESPONSE code^CLAMSTAT^D(display message)^number of seconds to hang^additional info
"RTN","BPSNCPD5",151,0)
 ; see EN^BPSNCPDP for RESPONSE values
"RTN","BPSNCPD5",152,0)
REVRESNP(BPNEWREQ,BRXIEN,BFILL,BFILLDAT,BWHERE,BILLNDC,REVREAS,DURREC,BPOVRIEN,BPSCLARF,BPSAUTH,BPCOBIND,BPJOBFLG,IEN59,BPACTTYP,DFN,BPSTART,BPREQIEN,OLDRESP,BPSELIG) ;
"RTN","BPSNCPD5",153,0)
 N BPSITE,BPECMOFF,BPSARRY,MOREDATA,IB,BPRETV,BPZRET,BPCLMST,CERTIEN,BPRESP
"RTN","BPSNCPD5",154,0)
 I BPJOBFLG'="F",BPJOBFLG'="B" D LOG^BPSNCPD6(IEN59,$T(+0)_"-Job Flag missing") Q "5^Job Flag missing"  ;RESPONSE^CLMSTAT
"RTN","BPSNCPD5",155,0)
 S BPCLMST=""
"RTN","BPSNCPD5",156,0)
 I BPACTTYP="U" Q "1^Prescription is not payable. Cannot Reverse claim.^D^2"
"RTN","BPSNCPD5",157,0)
 S BPSITE=+$$GETSITE^BPSOSRX8(BRXIEN,BFILL)
"RTN","BPSNCPD5",158,0)
 ;check ECME availability
"RTN","BPSNCPD5",159,0)
 S BPECMOFF=$$ECMESITE^BPSOSRX5(BPSITE) I +BPECMOFF=1 Q BPECMOFF
"RTN","BPSNCPD5",160,0)
 ;
"RTN","BPSNCPD5",161,0)
 ;populate MOREDATA with basic data
"RTN","BPSNCPD5",162,0)
 D BASICMOR^BPSOSRX8(BWHERE,BFILLDAT,REVREAS,DURREC,BPOVRIEN,BPSCLARF,BPSAUTH,.MOREDATA)
"RTN","BPSNCPD5",163,0)
 ;Certification Testing
"RTN","BPSNCPD5",164,0)
 ;sets:
"RTN","BPSNCPD5",165,0)
 ; BILLNDC which is used in STARRAY^BPSNCPD1
"RTN","BPSNCPD5",166,0)
 ; CERTIEN which is used in BILLABLE
"RTN","BPSNCPD5",167,0)
 S BPRESP=$$CERTTEST^BPSNCPD4(.BILLNDC,.CERTIEN) I +BPRESP=1 Q BPRESP
"RTN","BPSNCPD5",168,0)
 ;populate BPSARRY
"RTN","BPSNCPD5",169,0)
 ;Note:
"RTN","BPSNCPD5",170,0)
 ;the following is passed as backdoor parameters
"RTN","BPSNCPD5",171,0)
 ; DFN - patient's IEN
"RTN","BPSNCPD5",172,0)
 ; BILLNDC - NDC
"RTN","BPSNCPD5",173,0)
 ; BFILLDAT - fill date
"RTN","BPSNCPD5",174,0)
 D STARRAY^BPSNCPD1(BRXIEN,BFILL,BWHERE,.BPSARRY,BPSITE)
"RTN","BPSNCPD5",175,0)
 ;set BPSARRY("SC/EI OVR") flag for scheduled requests
"RTN","BPSNCPD5",176,0)
 I $G(BPJOBFLG)="B",$G(BPREQIEN) S BPSARRY("SC/EI OVR")=$P($G(^BPS(9002313.77,+$G(BPREQIEN),2)),U,9)
"RTN","BPSNCPD5",177,0)
 ;Billing determination
"RTN","BPSNCPD5",178,0)
 S IB=$$BILLABLE^BPSNCPD4(DFN,BWHERE,.MOREDATA,.BPSARRY,CERTIEN,.BPSELIG)
"RTN","BPSNCPD5",179,0)
 ;if non-billable or no response from IB
"RTN","BPSNCPD5",180,0)
 I +IB'=1 Q $P(IB,U,2,5)_"^D^"
"RTN","BPSNCPD5",181,0)
 ;check IB data
"RTN","BPSNCPD5",182,0)
 S BPRETV=$$IBDATAOK^BPSOSRX8(.MOREDATA,$G(BPSARRY("NO ECME INSURANCE"))) I BPRETV>0 Q BPRETV
"RTN","BPSNCPD5",183,0)
 ; Log message to ECME log
"RTN","BPSNCPD5",184,0)
 ; Needed for Turn-Around Stats - Do NOT delete/alter!!
"RTN","BPSNCPD5",185,0)
 D LOG^BPSNCPD6(IEN59,$T(+0)_"-Before submit of claim")
"RTN","BPSNCPD5",186,0)
 S BPSTART=$$STTM^BPSNCPD4()
"RTN","BPSNCPD5",187,0)
 ;if background job
"RTN","BPSNCPD5",188,0)
 I BPJOBFLG="B" D  Q $$RSPCLMS^BPSOSRX8(BPACTTYP,+BPRETV,.MOREDATA)_U_$P(BPRETV,U,2)
"RTN","BPSNCPD5",189,0)
 . ;Update IB data
"RTN","BPSNCPD5",190,0)
 . D UPDINSDT^BPSOSRX7(BPREQIEN,.MOREDATA,IEN59) ;
"RTN","BPSNCPD5",191,0)
 . S BPRETV=$$ACTIVATE^BPSNCPD4(BPREQIEN,"C")
"RTN","BPSNCPD5",192,0)
 ;if foreground job then schedule a CLAIM request
"RTN","BPSNCPD5",193,0)
 ;
"RTN","BPSNCPD5",194,0)
 ; If override flag is set, prompt for override values - TEST ONLY
"RTN","BPSNCPD5",195,0)
 I $$CHECK^BPSTEST D GETOVER^BPSTEST(BRXIEN,BFILL,OLDRESP,BWHERE,"S")
"RTN","BPSNCPD5",196,0)
 ;
"RTN","BPSNCPD5",197,0)
 S BPRETV=$$REQST^BPSOSRX("C",BRXIEN,BFILL,.MOREDATA,BPCOBIND,IEN59,$G(BILLNDC))
"RTN","BPSNCPD5",198,0)
 S BPNEWREQ=+$P(BPRETV,U,2)
"RTN","BPSNCPD5",199,0)
 ;if error
"RTN","BPSNCPD5",200,0)
 I +BPRETV=0 D  Q $$RSPCLMS^BPSOSRX8(BPACTTYP,4,.MOREDATA,$P(BPRETV,U,2))
"RTN","BPSNCPD5",201,0)
 . D LOG^BPSNCPD6(IEN59,$T(+0)_"-Create request error: "_$P(BPRETV,U,2)_". Claim Will Not Be submitted.")
"RTN","BPSNCPD5",202,0)
 ;if ok
"RTN","BPSNCPD5",203,0)
 D LOG^BPSNCPD6(IEN59,$T(+0)_"-BPS REQUEST: "_BPNEWREQ_" has been created")
"RTN","BPSNCPD5",204,0)
 ;activate the scheduled request
"RTN","BPSNCPD5",205,0)
 S BPRETV=$$ACTIVATE^BPSNCPD4(BPNEWREQ,"C")
"RTN","BPSNCPD5",206,0)
 Q $$RSPCLMS^BPSOSRX8(BPACTTYP,+BPRETV,.MOREDATA)_U_BPNEWREQ
"RTN","BPSNCPD5",207,0)
 ;
"RTN","BPSNCPD6")
0^67^B36903046
"RTN","BPSNCPD6",1,0)
BPSNCPD6 ;ALB/SS - Pharmacy API part 6 ;10-JAN-08
"RTN","BPSNCPD6",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**7**;JUN 2004;Build 46
"RTN","BPSNCPD6",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSNCPD6",4,0)
 ;
"RTN","BPSNCPD6",5,0)
 ;Moved portions of the BPSNCPDP code because of routine size issues
"RTN","BPSNCPD6",6,0)
 ;== New Claim 
"RTN","BPSNCPD6",7,0)
NEWCLAIM ;
"RTN","BPSNCPD6",8,0)
 S BPRETV=$$NEWCLM^BPSNCPD5(.BP77NEW,BRXIEN,BFILL,BFILLDAT,BWHERE,BILLNDC,REVREAS,DURREC,BPOVRIEN,BPSCLARF,BPSAUTH,BPCOBIND,BPJOBFLG,IEN59,BPACTTYP,DFN,.BPSTART,$G(BPREQIEN),.BPSELIG)
"RTN","BPSNCPD6",9,0)
 S RESPONSE=+BPRETV
"RTN","BPSNCPD6",10,0)
 ;to make LOG backward compatible
"RTN","BPSNCPD6",11,0)
 D LOG(IEN59,$T(+0)_"-After Submit of Claim.  Return Value: "_$S(RESPONSE=0:1,1:0))
"RTN","BPSNCPD6",12,0)
 S CLMSTAT=$P(BPRETV,U,2)
"RTN","BPSNCPD6",13,0)
 D DISPL^BPSNCPD4(WFLG,BPRETV,$G(BPSELIG))
"RTN","BPSNCPD6",14,0)
 I RESPONSE=0 Q
"RTN","BPSNCPD6",15,0)
 D LOG(IEN59,$T(+0)_"-"_CLMSTAT)
"RTN","BPSNCPD6",16,0)
 Q
"RTN","BPSNCPD6",17,0)
 ;
"RTN","BPSNCPD6",18,0)
 ;== Reversals for Payable claims
"RTN","BPSNCPD6",19,0)
 ;(Note: BPSCLOSE parameter of EN^BPSNCPDP can be used in this case)
"RTN","BPSNCPD6",20,0)
RVPAID ;
"RTN","BPSNCPD6",21,0)
 ;If Last Action was REVERSAL type Then we should expect Rejected and Stranded/Other reversal responses
"RTN","BPSNCPD6",22,0)
 ;(because the claim is still Payable)
"RTN","BPSNCPD6",23,0)
 ;And if so then DO NOT REVERSE it again 
"RTN","BPSNCPD6",24,0)
 ;Exceptions (from pre-existing logic): 
"RTN","BPSNCPD6",25,0)
 ; EREV - can be re-reversed if the previous submission is Payable or Rejected Reversal
"RTN","BPSNCPD6",26,0)
 ; DE,RS - pre-existing logic
"RTN","BPSNCPD6",27,0)
 I OLDRESP["REVERSAL",BWHERE'="EREV",BWHERE'="DE",BWHERE'="RS" D  Q
"RTN","BPSNCPD6",28,0)
 . S RESPONSE=1
"RTN","BPSNCPD6",29,0)
 . S CLMSTAT="Claim has status "_OLDRESP_".  Not reversed."
"RTN","BPSNCPD6",30,0)
 . D DISPL^BPSNCPD4(WFLG,RESPONSE_U_CLMSTAT_"^D^2",$G(BPSELIG))
"RTN","BPSNCPD6",31,0)
 . D LOG(IEN59,$T(+0)_"-"_CLMSTAT)
"RTN","BPSNCPD6",32,0)
 ; do all the rest - E PAYABLE, etc
"RTN","BPSNCPD6",33,0)
 S BPRETV=$$REVERSAL^BPSNCPD5(.BP77NEW,BRXIEN,BFILL,OLDRESP,BFILLDAT,BWHERE,$G(BILLNDC),REVREAS,DURREC,BPOVRIEN,BPSCLARF,BPSAUTH,IEN59,BPCOBIND,BPJOBFLG,BPACTTYP,.BPSTART,$G(BPREQIEN),.BPSCLOSE)
"RTN","BPSNCPD6",34,0)
 S RESPONSE=+BPRETV
"RTN","BPSNCPD6",35,0)
 ;to make LOG backward compatible
"RTN","BPSNCPD6",36,0)
 D LOG(IEN59,$T(+0)_"-After Submit of Reversal. Return Value: "_$S(RESPONSE=0:1,1:0))
"RTN","BPSNCPD6",37,0)
 S CLMSTAT=$P(BPRETV,U,2)
"RTN","BPSNCPD6",38,0)
 I BWHERE'="EREV" D DISPL^BPSNCPD4(WFLG,BPRETV,$G(BPSELIG))
"RTN","BPSNCPD6",39,0)
 I RESPONSE=0 Q
"RTN","BPSNCPD6",40,0)
 D LOG(IEN59,$T(+0)_"-"_CLMSTAT)
"RTN","BPSNCPD6",41,0)
 Q
"RTN","BPSNCPD6",42,0)
 ;
"RTN","BPSNCPD6",43,0)
 ;== Reversals+Resubmits for Payable claims
"RTN","BPSNCPD6",44,0)
RVRSPAID ;
"RTN","BPSNCPD6",45,0)
 ;Last Action was REVERSAL type? 
"RTN","BPSNCPD6",46,0)
 ;we should expect rejected and stranded reversal but not accepted one since the claim is Payable
"RTN","BPSNCPD6",47,0)
 ;exception for Tricare - "reversal rejected" and "reversal unstranded" can be resubmitted, others - not
"RTN","BPSNCPD6",48,0)
 I OLDRESP["REVERSAL" I ($P($G(^BPST(IEN59,9)),U,4)'="T")!($P($G(^BPST(IEN59,9)),U,4)="T"&(OLDRESP'["E REVERSAL REJECTED")&(OLDRESP'["E REVERSAL UNSTRANDED")) D  Q
"RTN","BPSNCPD6",49,0)
 . S RESPONSE=1
"RTN","BPSNCPD6",50,0)
 . S CLMSTAT="Can not resubmit a rejected or stranded reversal"
"RTN","BPSNCPD6",51,0)
 . D DISPL^BPSNCPD4(WFLG,RESPONSE_U_CLMSTAT_"^D^2",$G(BPSELIG))
"RTN","BPSNCPD6",52,0)
 . D LOG(IEN59,$T(+0)_"-"_CLMSTAT)
"RTN","BPSNCPD6",53,0)
 ; do all the rest - E PAYABLE, etc
"RTN","BPSNCPD6",54,0)
 S BPRETV=$$REVRESUB^BPSNCPD4(.BP77NEW,BRXIEN,BFILL,BFILLDAT,BWHERE,BILLNDC,REVREAS,DURREC,BPOVRIEN,BPSCLARF,BPSAUTH,BPCOBIND,BPJOBFLG,IEN59,DFN,.BPSTART,$G(BPREQIEN),OLDRESP,.BPSELIG)
"RTN","BPSNCPD6",55,0)
 S RESPONSE=+BPRETV
"RTN","BPSNCPD6",56,0)
 ;if "Reversal only not resubmit" - display a message for the user
"RTN","BPSNCPD6",57,0)
 I RESPONSE=10 D DISPL^BPSNCPD4(WFLG,"10^Claim Will Be Reversed But Will Not Be Resubmitted^D^2",$G(BPSELIG))
"RTN","BPSNCPD6",58,0)
 ;to make LOG backward compatible
"RTN","BPSNCPD6",59,0)
 D LOG(IEN59,$T(+0)_"-After Submit of Reversal. Return Value: "_$S(RESPONSE=0:1,1:0))
"RTN","BPSNCPD6",60,0)
 D DISPL^BPSNCPD4(WFLG,BPRETV,$G(BPSELIG))
"RTN","BPSNCPD6",61,0)
 I RESPONSE=10 S CLMSTAT=$P(BPRETV,U,5) Q
"RTN","BPSNCPD6",62,0)
 S CLMSTAT=$P(BPRETV,U,2)
"RTN","BPSNCPD6",63,0)
 I RESPONSE=0 Q
"RTN","BPSNCPD6",64,0)
 D LOG(IEN59,$T(+0)_"-"_CLMSTAT)
"RTN","BPSNCPD6",65,0)
 Q
"RTN","BPSNCPD6",66,0)
 ;
"RTN","BPSNCPD6",67,0)
 ;== Resubmits for Payable claims - DO NOT resubmit
"RTN","BPSNCPD6",68,0)
RSPAID ;
"RTN","BPSNCPD6",69,0)
 S RESPONSE=1
"RTN","BPSNCPD6",70,0)
 ;Last Action was REVERSAL type? 
"RTN","BPSNCPD6",71,0)
 ;(we should expect rejected and stranded reversal but not accepted one since the claim is Payable)
"RTN","BPSNCPD6",72,0)
 I OLDRESP["REVERSAL" D  Q
"RTN","BPSNCPD6",73,0)
 . S CLMSTAT="Can not resubmit a rejected or stranded reversal"
"RTN","BPSNCPD6",74,0)
 . D DISPL^BPSNCPD4(WFLG,RESPONSE_U_CLMSTAT_"^D^2",$G(BPSELIG))
"RTN","BPSNCPD6",75,0)
 . D LOG(IEN59,$T(+0)_"-"_CLMSTAT)
"RTN","BPSNCPD6",76,0)
 ; do all the rest - E PAYABLE, etc
"RTN","BPSNCPD6",77,0)
 S CLMSTAT="Previously billed through ECME: "_OLDRESP
"RTN","BPSNCPD6",78,0)
 D DISPL^BPSNCPD4(WFLG,RESPONSE_U_CLMSTAT_"^D^2",$G(BPSELIG))
"RTN","BPSNCPD6",79,0)
 D LOG(IEN59,$T(+0)_"-"_CLMSTAT)
"RTN","BPSNCPD6",80,0)
 Q
"RTN","BPSNCPD6",81,0)
 ;== Reversals for Non-Payable claims - DO NOT reverse
"RTN","BPSNCPD6",82,0)
RVNPAID ;
"RTN","BPSNCPD6",83,0)
 ;if this is return to stock OR delete - close the claim
"RTN","BPSNCPD6",84,0)
 I ",RS,DE,"[(","_BWHERE_",") D  Q
"RTN","BPSNCPD6",85,0)
 . D CLOSE2^BPSBUTL(BRXIEN,BFILL,BWHERE)
"RTN","BPSNCPD6",86,0)
 . S RESPONSE=3
"RTN","BPSNCPD6",87,0)
 . S CLMSTAT="Claim was not payable so it has been closed.  No ECME claim created."
"RTN","BPSNCPD6",88,0)
 . D DISPL^BPSNCPD4(WFLG,RESPONSE_U_CLMSTAT_"^D^2",$G(BPSELIG))
"RTN","BPSNCPD6",89,0)
 . D LOG(IEN59,$T(+0)_"-"_CLMSTAT)
"RTN","BPSNCPD6",90,0)
 S RESPONSE=1
"RTN","BPSNCPD6",91,0)
 S CLMSTAT="Claim has status "_OLDRESP_".  Not reversed."
"RTN","BPSNCPD6",92,0)
 D DISPL^BPSNCPD4(WFLG,RESPONSE_U_CLMSTAT_"^D^2",$G(BPSELIG))
"RTN","BPSNCPD6",93,0)
 D LOG(IEN59,$T(+0)_"-"_CLMSTAT)
"RTN","BPSNCPD6",94,0)
 Q
"RTN","BPSNCPD6",95,0)
 ;== Resubmits AND Reversals+Resubmits for Non-Payable claims
"RTN","BPSNCPD6",96,0)
RVRSNPD ;
"RTN","BPSNCPD6",97,0)
 ; if this is a single resubmit action ("C")
"RTN","BPSNCPD6",98,0)
 ; and the claim is NON-PAYABLE because of some reason other than 
"RTN","BPSNCPD6",99,0)
 ;   successful reversal 
"RTN","BPSNCPD6",100,0)
 ;   or
"RTN","BPSNCPD6",101,0)
 ;   claim rejected by the payer
"RTN","BPSNCPD6",102,0)
 ; then do not submit a claim
"RTN","BPSNCPD6",103,0)
 I BPACTTYP="C",OLDRESP'="E REVERSAL ACCEPTED",OLDRESP'="E REJECTED" D  Q
"RTN","BPSNCPD6",104,0)
 . S RESPONSE=1
"RTN","BPSNCPD6",105,0)
 . S CLMSTAT="Previously billed through ECME: "_OLDRESP
"RTN","BPSNCPD6",106,0)
 . D DISPL^BPSNCPD4(WFLG,RESPONSE_U_CLMSTAT_"^D^2",$G(BPSELIG))
"RTN","BPSNCPD6",107,0)
 . D LOG(IEN59,$T(+0)_"-"_CLMSTAT)
"RTN","BPSNCPD6",108,0)
 ; resubmit a claim
"RTN","BPSNCPD6",109,0)
 S BPRETV=$$REVRESNP^BPSNCPD5(.BP77NEW,BRXIEN,BFILL,BFILLDAT,BWHERE,BILLNDC,REVREAS,DURREC,BPOVRIEN,BPSCLARF,BPSAUTH,BPCOBIND,BPJOBFLG,IEN59,BPACTTYP,DFN,.BPSTART,$G(BPREQIEN),OLDRESP,.BPSELIG)
"RTN","BPSNCPD6",110,0)
 S RESPONSE=+BPRETV
"RTN","BPSNCPD6",111,0)
 ;to make LOG backward compatible
"RTN","BPSNCPD6",112,0)
 D LOG(IEN59,$T(+0)_"-After Submit of Reversal. Return Value: "_$S(RESPONSE=0:1,1:0))
"RTN","BPSNCPD6",113,0)
 S CLMSTAT=$P(BPRETV,U,2)
"RTN","BPSNCPD6",114,0)
 D DISPL^BPSNCPD4(WFLG,BPRETV,$G(BPSELIG))
"RTN","BPSNCPD6",115,0)
 I RESPONSE=0 Q
"RTN","BPSNCPD6",116,0)
 D LOG(IEN59,$T(+0)_"-"_CLMSTAT)
"RTN","BPSNCPD6",117,0)
 Q
"RTN","BPSNCPD6",118,0)
 ;
"RTN","BPSNCPD6",119,0)
 ; if Back Billing
"RTN","BPSNCPD6",120,0)
BB ;
"RTN","BPSNCPD6",121,0)
 S RESPONSE=1
"RTN","BPSNCPD6",122,0)
 S CLMSTAT="Previously billed through ECME: "_OLDRESP
"RTN","BPSNCPD6",123,0)
 D DISPL^BPSNCPD4(WFLG,RESPONSE_U_CLMSTAT_"^D^2",$G(BPSELIG))
"RTN","BPSNCPD6",124,0)
 D LOG(IEN59,$T(+0)_"-"_CLMSTAT)
"RTN","BPSNCPD6",125,0)
 Q
"RTN","BPSNCPD6",126,0)
 ;
"RTN","BPSNCPD6",127,0)
 ; if we do not have a status for pre-existing claim AND this is a reversal request - DO NOT reverse
"RTN","BPSNCPD6",128,0)
RVNEW ;
"RTN","BPSNCPD6",129,0)
 S RESPONSE=1
"RTN","BPSNCPD6",130,0)
 S CLMSTAT="Prescription not previously billed through ECME.  Cannot Reverse claim."
"RTN","BPSNCPD6",131,0)
 D DISPL^BPSNCPD4(WFLG,RESPONSE_U_CLMSTAT_"^D^2",$G(BPSELIG))
"RTN","BPSNCPD6",132,0)
 D LOG(IEN59,$T(+0)_"-"_CLMSTAT)
"RTN","BPSNCPD6",133,0)
 Q
"RTN","BPSNCPD6",134,0)
LOG(IEN59,MSG,BPDTFLG) ;
"RTN","BPSNCPD6",135,0)
 D LOG^BPSOSL(IEN59,MSG,$G(BPDTFLG))
"RTN","BPSNCPD6",136,0)
 Q
"RTN","BPSNCPD6",137,0)
 ;
"RTN","BPSNCPD6",138,0)
 ;use in BPSSCR04 to collect requests for the User Screen that don't have BPS TRANSACTION records 
"RTN","BPSNCPD6",139,0)
 ; D LOOK77^BPSNCPD6(BPBDT,BPEDT,BPTMP1)
"RTN","BPSNCPD6",140,0)
LOOK77(BPBEGDT,BPENDDT,BPTMP) ;
"RTN","BPSNCPD6",141,0)
 N BPLDT77,BP77,BP59,BPRXRF
"RTN","BPSNCPD6",142,0)
 S BPLDT77=BPBEGDT-0.00001
"RTN","BPSNCPD6",143,0)
 F  S BPLDT77=+$O(^BPS(9002313.77,"E",BPLDT77)) Q:BPLDT77=0!(BPLDT77>BPENDDT)  D
"RTN","BPSNCPD6",144,0)
 . S BP77=0 F  S BP77=$O(^BPS(9002313.77,"E",BPLDT77,BP77)) Q:+BP77=0  D
"RTN","BPSNCPD6",145,0)
 . . S BPRXRF=$P($G(^BPS(9002313.77,BP77,0)),U,1,2)
"RTN","BPSNCPD6",146,0)
 . . S BP59=$$IEN59^BPSOSRX(+BPRXRF,$P(BPRXRF,U,2)) ;calculate BPS TRANSACTION ien (even if it doesn't exist yet)
"RTN","BPSNCPD6",147,0)
 . . I $D(@BPTMP@(BP59)) Q  ;don't create an entry if the claim is already there
"RTN","BPSNCPD6",148,0)
 . . S @BPTMP@(BP59)=(BPLDT77\1)_"^77-"
"RTN","BPSNCPD6",149,0)
 Q
"RTN","BPSNCPD6",150,0)
 ;
"RTN","BPSNCPDP")
0^5^B54845917
"RTN","BPSNCPDP",1,0)
BPSNCPDP ;BHAM ISC/LJE/SS - API to submit a claim to ECME ;11/7/07  16:58
"RTN","BPSNCPDP",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,3,4,2,5,6,7**;JUN 2004;Build 46
"RTN","BPSNCPDP",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSNCPDP",4,0)
 ;
"RTN","BPSNCPDP",5,0)
 ; For comments regarding this API, see routine BPSNCPD3.
"RTN","BPSNCPDP",6,0)
 ;
"RTN","BPSNCPDP",7,0)
EN(BRXIEN,BFILL,BFILLDAT,BWHERE,BILLNDC,REVREAS,DURREC,BPOVRIEN,BPSCLARF,BPSAUTH,BPCOBIND,BPJOBFLG,BPREQIEN,BPSCLOSE) ;
"RTN","BPSNCPDP",8,0)
 N BPRETV,CLMSTAT,BRX,RESPONSE,BPSCOB,IEN59,DFN,PNAME,WFLG,BPLCK,BPACTTYP,BPRET
"RTN","BPSNCPDP",9,0)
 N BPNEWCLM,OLDRESP,BPPAYABL,BPSTART,BPRESLT,BPSELIG,BP77NEW,BPTODAY,BPPREVRQ,BPSSTAT
"RTN","BPSNCPDP",10,0)
 ; test not ecme active
"RTN","BPSNCPDP",11,0)
 I '$$PROD^XUPROD,'$P($G(^BPS(9002313.99,1,0)),"^",3) Q "1^ECME switch is not on for the site"
"RTN","BPSNCPDP",12,0)
 ;== Set default values and other required vars
"RTN","BPSNCPDP",13,0)
 ; default is foreground ("F")
"RTN","BPSNCPDP",14,0)
 S BPJOBFLG=$S($G(BPJOBFLG)="":"F",1:$G(BPJOBFLG))
"RTN","BPSNCPDP",15,0)
 S RESPONSE="",CLMSTAT="",BP77NEW=0
"RTN","BPSNCPDP",16,0)
 S BPLCK=0 ;0 - default for "B" jobs
"RTN","BPSNCPDP",17,0)
 S REVREAS=$G(REVREAS),DURREC=$G(DURREC),BPSCLARF=$G(BPSCLARF),BPSAUTH=$G(BPSAUTH),BPOVRIEN=$G(BPOVRIEN)
"RTN","BPSNCPDP",18,0)
 ; BPCOBIND will be used as a flag to indicate the following
"RTN","BPSNCPDP",19,0)
 ;    If BPCOBIND>0 then the API is called for the particular COB claim
"RTN","BPSNCPDP",20,0)
 ;    if BPCOBIND=0 then the API is called for a whole RX/RF
"RTN","BPSNCPDP",21,0)
 S BPCOBIND=+$G(BPCOBIND)
"RTN","BPSNCPDP",22,0)
 ; BPSCOB variable will be used to store COB value (default is PRIMARY)
"RTN","BPSNCPDP",23,0)
 S BPSCOB=$S($G(BPCOBIND)>0:$G(BPCOBIND),1:1)
"RTN","BPSNCPDP",24,0)
 ; default is original fill
"RTN","BPSNCPDP",25,0)
 I '$G(BFILL) S BFILL=0
"RTN","BPSNCPDP",26,0)
 ; Get prescription number
"RTN","BPSNCPDP",27,0)
 S BRX=$$RXAPI1^BPSUTIL1(BRXIEN,.01,"I")
"RTN","BPSNCPDP",28,0)
 ; Make sure fill date is not in the future or empty
"RTN","BPSNCPDP",29,0)
 S BPTODAY=$$TODAY^BPSOSRX5() I '$G(BFILLDAT)!($G(BFILLDAT)>BPTODAY) S BFILLDAT=BPTODAY
"RTN","BPSNCPDP",30,0)
 ; Get the NDC if it was not passed in
"RTN","BPSNCPDP",31,0)
 I $G(BILLNDC)="" S BILLNDC=$$GETNDC^PSONDCUT(BRXIEN,BFILL)
"RTN","BPSNCPDP",32,0)
 ; Patient Info
"RTN","BPSNCPDP",33,0)
 S DFN=$$RXAPI1^BPSUTIL1(BRXIEN,2,"I"),PNAME=$$GET1^DIQ(2,DFN,.01)
"RTN","BPSNCPDP",34,0)
 ;
"RTN","BPSNCPDP",35,0)
 ;== Check parameters and vars
"RTN","BPSNCPDP",36,0)
 S BPRETV=$$CHCKPAR^BPSOSRX8($G(BRXIEN),$G(BRX),$G(BWHERE),$G(DFN),$G(PNAME),$G(BILLNDC)) I +BPRETV=0 S CLMSTAT=$P(BPRETV,U,2),RESPONSE=5 G END
"RTN","BPSNCPDP",37,0)
 ;
"RTN","BPSNCPDP",38,0)
 ; Calculate IEN59
"RTN","BPSNCPDP",39,0)
 S IEN59=$$IEN59^BPSOSRX(BRXIEN,BFILL,BPSCOB) I IEN59="" S CLMSTAT="BPS Transaction IEN could not be calculated",RESPONSE=1 G END
"RTN","BPSNCPDP",40,0)
 ;
"RTN","BPSNCPDP",41,0)
 ; Initialize log
"RTN","BPSNCPDP",42,0)
 D LOG^BPSNCPD6(IEN59,$T(+0)_"-Start of claim","DT")
"RTN","BPSNCPDP",43,0)
 D LOG^BPSNCPD6(IEN59,$T(+0)_"-Job flag = "_BPJOBFLG_$S(BPJOBFLG="B":" BPS REQUEST ien = "_$G(BPREQIEN),1:""))
"RTN","BPSNCPDP",44,0)
 ;
"RTN","BPSNCPDP",45,0)
 ; Check if we need to print the messages to the screen (WFLG=1 : YES)
"RTN","BPSNCPDP",46,0)
 S WFLG=0
"RTN","BPSNCPDP",47,0)
 S:BPJOBFLG="F" WFLG=$$PRINTSCR^BPSOSRX8(BWHERE)
"RTN","BPSNCPDP",48,0)
 ;
"RTN","BPSNCPDP",49,0)
 ;== LOCK RX/RF - only one action can be scheduled for the RX/RF at a time
"RTN","BPSNCPDP",50,0)
 ;ONLY if BPJOBFLG="F" job! "B" jobs are called from REQST99^BPSOSRX5 and RX/RF should be already locked by this point
"RTN","BPSNCPDP",51,0)
 ; get the lock for the RX/RF - so the STATUS99 cannot complete the request without activaing NEXT REQUEST
"RTN","BPSNCPDP",52,0)
 I BPJOBFLG="F" S BPLCK=$$LOCKRF^BPSOSRX(BRXIEN,BFILL,10,$G(IEN59),$T(+0))
"RTN","BPSNCPDP",53,0)
 I BPJOBFLG="F" I 'BPLCK S RESPONSE=4,CLMSTAT="BRXIEN,BFILL Locked" G END  ;two (or more) requests for the same RX/refill (like payment and reverse)
"RTN","BPSNCPDP",54,0)
 ;
"RTN","BPSNCPDP",55,0)
 ;== Determine the action type
"RTN","BPSNCPDP",56,0)
 ;if foreground job then can be C,U and UC actions types
"RTN","BPSNCPDP",57,0)
 I BPJOBFLG="F" S BPACTTYP=$$ACTTYPE^BPSOSRX5(BWHERE)
"RTN","BPSNCPDP",58,0)
 ;if background/unqueueing job then only two action types are allowed - C and U
"RTN","BPSNCPDP",59,0)
 I BPJOBFLG="B" D  I RESPONSE=5 G END
"RTN","BPSNCPDP",60,0)
 . S BPACTTYP=$P($G(^BPS(9002313.77,+$G(BPREQIEN),1)),U,4)
"RTN","BPSNCPDP",61,0)
 . I BPACTTYP="" S RESPONSE=5,CLMSTAT="Unknown Action type in BPS REQUEST ien="_BPREQIEN
"RTN","BPSNCPDP",62,0)
 ;
"RTN","BPSNCPDP",63,0)
 ;== IF BPJOBFLG="F" THEN determine if there are any scheduled/active/in process requests for the RX/RF 
"RTN","BPSNCPDP",64,0)
 ;CHKREQST^BPSOSRX7 returns
"RTN","BPSNCPDP",65,0)
 ; negative number^message : cannot be accepted for some reason 
"RTN","BPSNCPDP",66,0)
 ; 0 : can be accepted because there are NO requests for this RX/RF, 
"RTN","BPSNCPDP",67,0)
 ;      we will create a new record in BPS REQUEST for it and ACTIVATE it.
"RTN","BPSNCPDP",68,0)
 ; 1 : there are ACTIVATED/IN PROCESS requests already for this RX/RF
"RTN","BPSNCPDP",69,0)
 S BPPREVRQ="-10^Background queuing." ;default
"RTN","BPSNCPDP",70,0)
 I BPJOBFLG="F" D  I BPPREVRQ'=0 G STATUS:RESPONSE=0,END:RESPONSE>0
"RTN","BPSNCPDP",71,0)
 . S BPPREVRQ=$$CHKREQST^BPSOSRX7(BRXIEN,BFILL,.BPRESLT)
"RTN","BPSNCPDP",72,0)
 . D LOG^BPSNCPD6(IEN59,$T(+0)_"-CHKREQ^BPSOSRX7 result: "_BPPREVRQ)
"RTN","BPSNCPDP",73,0)
 . ;if error
"RTN","BPSNCPDP",74,0)
 . I BPPREVRQ<0 S RESPONSE=4,CLMSTAT=$P(BPPREVRQ,U,2) D LOG^BPSNCPD6(IEN59,$T(+0)_"- - Cannot be accepted because of issues with already scheduled requests")
"RTN","BPSNCPDP",75,0)
 . ;if there are prior requests for the RX/RF in the queue already then schedule additional request(s) 
"RTN","BPSNCPDP",76,0)
 . ;for the future and quit since we do not know the result of prior requests 
"RTN","BPSNCPDP",77,0)
 . I BPPREVRQ>0 D
"RTN","BPSNCPDP",78,0)
 . . D LOG^BPSNCPD6(IEN59,$T(+0)_"-There are requests in the queue, do not process - schedule additional request(s)")
"RTN","BPSNCPDP",79,0)
 . . I BPACTTYP="U" S BPRET=$$SCHREQ^BPSNCPD5(.BP77NEW,BRXIEN,BFILL,BFILLDAT,BWHERE,$G(BILLNDC),REVREAS,DURREC,BPOVRIEN,BPSCLARF,BPSAUTH,IEN59,BPCOBIND,BPPREVRQ,"U",.BPSCLOSE)
"RTN","BPSNCPDP",80,0)
 . . I BPACTTYP="UC" D
"RTN","BPSNCPDP",81,0)
 . . . S BPRET=$$SCHREQ^BPSNCPD5(.BP77NEW,BRXIEN,BFILL,BFILLDAT,BWHERE,$G(BILLNDC),REVREAS,DURREC,BPOVRIEN,BPSCLARF,BPSAUTH,IEN59,BPCOBIND,BPPREVRQ,"U")
"RTN","BPSNCPDP",82,0)
 . . . I +BPRET=0 S BPRET=$$SCHREQ^BPSNCPD5(.BP77NEW,BRXIEN,BFILL,BFILLDAT,BWHERE,$G(BILLNDC),REVREAS,DURREC,BPOVRIEN,BPSCLARF,BPSAUTH,IEN59,BPCOBIND,BP77NEW,"C")
"RTN","BPSNCPDP",83,0)
 . . I BPACTTYP="C" S BPRET=$$SCHREQ^BPSNCPD5(.BP77NEW,BRXIEN,BFILL,BFILLDAT,BWHERE,$G(BILLNDC),REVREAS,DURREC,BPOVRIEN,BPSCLARF,BPSAUTH,IEN59,BPCOBIND,BPPREVRQ,"C")
"RTN","BPSNCPDP",84,0)
 . . I +BPRET=0 S RESPONSE=0,CLMSTAT=$P(BPRET,U,2) D LOG^BPSNCPD6(IEN59,$T(+0)_"-The new request(s) scheduled. The last one for the RX/RF now is: "_(BP77NEW)) Q
"RTN","BPSNCPDP",85,0)
 . . I +BPRET>0 S RESPONSE=+BPRET,CLMSTAT=$P(BPRET,U,2) D LOG^BPSNCPD6(IEN59,$T(+0)_"-Cannot create request(s)")
"RTN","BPSNCPDP",86,0)
 ;
"RTN","BPSNCPDP",87,0)
 ;== So we can continue only if either 
"RTN","BPSNCPDP",88,0)
 ;  BPJOBFLG="B" 
"RTN","BPSNCPDP",89,0)
 ;  or 
"RTN","BPSNCPDP",90,0)
 ;  BPJOBFLG="F" and BPPREVRQ=0
"RTN","BPSNCPDP",91,0)
 ;
"RTN","BPSNCPDP",92,0)
 ; If a new RX/RF - i.e. RX/RF was never processed thru ECME - process and quit
"RTN","BPSNCPDP",93,0)
 S BPNEWCLM=$S(+$G(^BPST(IEN59,0)):0,1:1)
"RTN","BPSNCPDP",94,0)
 ; get pre-existing RX/RFs status
"RTN","BPSNCPDP",95,0)
 ;S OLDRESP=$P($$STATUS^BPSOSRX(BRXIEN,BFILL,1),U,1)
"RTN","BPSNCPDP",96,0)
 S OLDRESP=$P($$STATUS^BPSOSRX(BRXIEN,BFILL,0),U,1)
"RTN","BPSNCPDP",97,0)
 ; check if the payer IS going to PAY according the last response
"RTN","BPSNCPDP",98,0)
 S BPPAYABL=$$PAYABLE^BPSOSRX5(OLDRESP)
"RTN","BPSNCPDP",99,0)
 ; set starttime
"RTN","BPSNCPDP",100,0)
 S BPSTART=$$STTM^BPSNCPD4()
"RTN","BPSNCPDP",101,0)
 ;  
"RTN","BPSNCPDP",102,0)
 ; if this is a new RX/RF
"RTN","BPSNCPDP",103,0)
 I BPNEWCLM D NEWCLAIM^BPSNCPD6 G STATUS:RESPONSE=0,END:RESPONSE>0
"RTN","BPSNCPDP",104,0)
 ;
"RTN","BPSNCPDP",105,0)
 ; if we do not have a status for the previous claim AND this is not a reversal request - treat it as a new claim 
"RTN","BPSNCPDP",106,0)
 I (OLDRESP=""),(BPACTTYP'="U") D NEWCLAIM^BPSNCPD6 G STATUS:RESPONSE=0,END:RESPONSE>0
"RTN","BPSNCPDP",107,0)
 ;
"RTN","BPSNCPDP",108,0)
 ; if we do not have a status for the pre-existing claim AND this is a reversal request - DO NOT reverse
"RTN","BPSNCPDP",109,0)
 I (OLDRESP=""),(BPACTTYP="U") D RVNEW^BPSNCPD6 G END
"RTN","BPSNCPDP",110,0)
 ;
"RTN","BPSNCPDP",111,0)
 ;== Further below - all claims with some response (i.e. OLDRESP]""=1)
"RTN","BPSNCPDP",112,0)
 ;
"RTN","BPSNCPDP",113,0)
 ; if Back Billing - impossible
"RTN","BPSNCPDP",114,0)
 I BWHERE="BB" D BB^BPSNCPD6 G END
"RTN","BPSNCPDP",115,0)
 ;
"RTN","BPSNCPDP",116,0)
 ; If returning to stock or deleting and the previous claim was not paid, then no reversal is needed
"RTN","BPSNCPDP",117,0)
 ;   so close the prescription and quit
"RTN","BPSNCPDP",118,0)
 ; Note: this is inherited "fuzzy logic" - 
"RTN","BPSNCPDP",119,0)
 ; it checks only two statuses to determine that the claim "was not paid"
"RTN","BPSNCPDP",120,0)
 I OLDRESP'["E PAYABLE",OLDRESP'["E REVERSAL REJECTED",(",RS,DE,"[(","_BWHERE_",")) D  G END
"RTN","BPSNCPDP",121,0)
 . D CLOSE2^BPSBUTL(BRXIEN,BFILL,BWHERE)
"RTN","BPSNCPDP",122,0)
 . S RESPONSE=3
"RTN","BPSNCPDP",123,0)
 . S CLMSTAT="Claim was not payable so it has been closed.  No ECME claim created."
"RTN","BPSNCPDP",124,0)
 . D DISPL^BPSNCPD4(WFLG,RESPONSE_U_CLMSTAT_"^D^2",$G(BPSELIG))
"RTN","BPSNCPDP",125,0)
 . D LOG^BPSNCPD6(IEN59,$T(+0)_"-"_CLMSTAT)
"RTN","BPSNCPDP",126,0)
 ;
"RTN","BPSNCPDP",127,0)
 ; Reversals for Payable claims 
"RTN","BPSNCPDP",128,0)
 ; (Note: BPSCLOSE can be used in this case only)
"RTN","BPSNCPDP",129,0)
 I BPPAYABL,BPACTTYP="U" D RVPAID^BPSNCPD6 G STATUS:RESPONSE=0,END:RESPONSE>0
"RTN","BPSNCPDP",130,0)
 ;
"RTN","BPSNCPDP",131,0)
 ; Reversals+Resubmits for Payable claims
"RTN","BPSNCPDP",132,0)
 I BPPAYABL,BPACTTYP="UC" D RVRSPAID^BPSNCPD6 G STATUS:((RESPONSE=0)!(RESPONSE=10)),END:RESPONSE>0
"RTN","BPSNCPDP",133,0)
 ;
"RTN","BPSNCPDP",134,0)
 ; Resubmits for Payable claims - DO NOt resubmit
"RTN","BPSNCPDP",135,0)
 I BPPAYABL,BPACTTYP="C" D RSPAID^BPSNCPD6 G END
"RTN","BPSNCPDP",136,0)
 ;
"RTN","BPSNCPDP",137,0)
 ; Reversals for Non-Payable claims - DO NOT reverse
"RTN","BPSNCPDP",138,0)
 I 'BPPAYABL,BPACTTYP="U" D RVNPAID^BPSNCPD6 G END
"RTN","BPSNCPDP",139,0)
 ;
"RTN","BPSNCPDP",140,0)
 ; Resubmits AND Reversals+Resubmits for Non-Payable claims
"RTN","BPSNCPDP",141,0)
 I 'BPPAYABL,((BPACTTYP="C")!(BPACTTYP="UC")) D RVRSNPD^BPSNCPD6 G STATUS:RESPONSE=0,END:RESPONSE>0
"RTN","BPSNCPDP",142,0)
 ;
"RTN","BPSNCPDP",143,0)
 S RESPONSE=5,CLMSTAT="Unknown error"
"RTN","BPSNCPDP",144,0)
 G END
"RTN","BPSNCPDP",145,0)
 ;
"RTN","BPSNCPDP",146,0)
 ;== Display status
"RTN","BPSNCPDP",147,0)
STATUS ;
"RTN","BPSNCPDP",148,0)
 ;if succesful scheduling or/and activation of the request then make sure the background job is running
"RTN","BPSNCPDP",149,0)
 I BPJOBFLG="F",BPLCK D UNLCKRF^BPSOSRX(BRXIEN,BFILL,$G(IEN59),$T(+0)) S BPLCK=0 ;to prevent unlocking in END
"RTN","BPSNCPDP",150,0)
 I (RESPONSE=0)!(RESPONSE=10) D LOG^BPSNCPD6(IEN59,$T(+0)_"-Call RUNNING^BPSOSRX") D RUNNING^BPSOSRX()
"RTN","BPSNCPDP",151,0)
 ;if Tricare then shall print messages to the screen
"RTN","BPSNCPDP",152,0)
 I $G(BPSELIG)="T" S WFLG=1
"RTN","BPSNCPDP",153,0)
 I BPJOBFLG="F" D
"RTN","BPSNCPDP",154,0)
 . I 'WFLG H 1
"RTN","BPSNCPDP",155,0)
 . E  D STATUS^BPSNCPD1(BRXIEN,BFILL,+$G(BPPAYABL),$S(BPACTTYP="U":1,1:0),BPSTART,BWHERE,$G(BP77NEW))
"RTN","BPSNCPDP",156,0)
 ;
"RTN","BPSNCPDP",157,0)
 ;== Clean up and quit
"RTN","BPSNCPDP",158,0)
END ;
"RTN","BPSNCPDP",159,0)
 I BPJOBFLG="F",BPLCK D UNLCKRF^BPSOSRX(BRXIEN,BFILL,$G(IEN59),$T(+0)) S BPLCK=0
"RTN","BPSNCPDP",160,0)
 ;if foreground AND we can't schedule request for any reason AND this is not OP - send bulletin
"RTN","BPSNCPDP",161,0)
 D:BPJOBFLG="F" SENDBUL^BPSOSRX8(RESPONSE,BWHERE,BRXIEN,BFILL,$G(SITE),$G(DFN),$G(PNAME),$G(CLMSTAT),$G(RESPONSE))
"RTN","BPSNCPDP",162,0)
 I $G(BPSELIG)="" S BPSELIG=""
"RTN","BPSNCPDP",163,0)
 ;I $G(BPSELIG)="" S BPSELIG=$$ELIG^BPSOSRX7(+$G(DFN))
"RTN","BPSNCPDP",164,0)
 ; need to look up current status and return (mm if tricare in progress)
"RTN","BPSNCPDP",165,0)
 S BPSSTAT=$S($G(BRXIEN):$P($$STATUS^BPSOSRX(BRXIEN,BFILL),U),1:"")
"RTN","BPSNCPDP",166,0)
 I BPSELIG="T",BPSSTAT="IN PROGRESS",$G(DURREC)'="RX RELEASE-NDC CHANGE" D BULL^BPSNCPD1(BRXIEN,BFILL,$G(SITE),$G(DFN),$G(PNAME),1)
"RTN","BPSNCPDP",167,0)
 ;
"RTN","BPSNCPDP",168,0)
 S:'$D(RESPONSE) RESPONSE=1
"RTN","BPSNCPDP",169,0)
 K BRXIEN,BFILL,BFILLDAT,BWHERE,MOREDATA
"RTN","BPSNCPDP",170,0)
 I $G(IEN59) D
"RTN","BPSNCPDP",171,0)
 . N MSG
"RTN","BPSNCPDP",172,0)
 . S MSG="Foreground Process Complete-RESPONSE="_$G(RESPONSE)
"RTN","BPSNCPDP",173,0)
 . I $G(RESPONSE)'=0 S MSG=MSG_", CLMSTAT="_$G(CLMSTAT)
"RTN","BPSNCPDP",174,0)
 . D LOG^BPSNCPD6(IEN59,$T(+0)_"-"_MSG)
"RTN","BPSNCPDP",175,0)
 Q RESPONSE_U_$G(CLMSTAT)_U_BPSELIG_U_BPSSTAT
"RTN","BPSOSCD")
0^86^B38794587
"RTN","BPSOSCD",1,0)
BPSOSCD ;BHAM ISC/FCS/DRS/DLF - Set BPS() "RX" nodes for current medication ;06/01/2004
"RTN","BPSOSCD",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,3,2,5,7**;JUN 2004;Build 46
"RTN","BPSOSCD",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSCD",4,0)
 ;
"RTN","BPSOSCD",5,0)
 Q
"RTN","BPSOSCD",6,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSCD",7,0)
 ;Set BPS() "RX" nodes for current medication:
"RTN","BPSOSCD",8,0)
 ;
"RTN","BPSOSCD",9,0)
 ;Parameters:   IEN59   - Pointer to BPS Transactions
"RTN","BPSOSCD",10,0)
 ;              IEN5902 - IEN for Insurance multiple of BPS Transactions
"RTN","BPSOSCD",11,0)
 ;              MEDN    - Index number indicating what medication is
"RTN","BPSOSCD",12,0)
 ;                        being processed
"RTN","BPSOSCD",13,0)
 ;
"RTN","BPSOSCD",14,0)
 ; Note that the BPS array is shared by all of the BPSOSC* routines and
"RTN","BPSOSCD",15,0)
 ;  is newed by BPSOSCA
"RTN","BPSOSCD",16,0)
 ; Note that VAINFO is newed/set in BPSOSCB
"RTN","BPSOSCD",17,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSCD",18,0)
 ; Called from BPSOSCA for every prescription in the multiple
"RTN","BPSOSCD",19,0)
MEDINFO(IEN59,IEN5902,MEDN) ;
"RTN","BPSOSCD",20,0)
 ; Verify Parameters
"RTN","BPSOSCD",21,0)
 I $G(IEN59)="" Q
"RTN","BPSOSCD",22,0)
 I $G(IEN5902)="" Q
"RTN","BPSOSCD",23,0)
 I $G(MEDN)="" Q
"RTN","BPSOSCD",24,0)
 ;
"RTN","BPSOSCD",25,0)
 ; New variables and basic setup
"RTN","BPSOSCD",26,0)
 N RXIEN,RXRFIEN,IENS,DRUGIEN,PROVIEN,RXI,FILLDT,NDC,NPI
"RTN","BPSOSCD",27,0)
 S RXIEN=$P(IEN59,".",1)
"RTN","BPSOSCD",28,0)
 S RXRFIEN=+$E($P(IEN59,".",2),1,4)
"RTN","BPSOSCD",29,0)
 S IENS=IEN5902_","_IEN59_","
"RTN","BPSOSCD",30,0)
 ;
"RTN","BPSOSCD",31,0)
 ; Get any user-entered overrides stored in BPS NCPDP OVERRIDES
"RTN","BPSOSCD",32,0)
 D OVERRIDE(IEN59,MEDN)
"RTN","BPSOSCD",33,0)
 ;
"RTN","BPSOSCD",34,0)
 ; Retrieve DUR values
"RTN","BPSOSCD",35,0)
 D DURVALUE(IEN59,MEDN)
"RTN","BPSOSCD",36,0)
 ;
"RTN","BPSOSCD",37,0)
 ; Get Drug and Prescriber IEN
"RTN","BPSOSCD",38,0)
 S DRUGIEN=$$RXAPI1^BPSUTIL1(RXIEN,6,"I")
"RTN","BPSOSCD",39,0)
 S PROVIEN=$$RXAPI1^BPSUTIL1(RXIEN,4,"I")
"RTN","BPSOSCD",40,0)
 ;
"RTN","BPSOSCD",41,0)
 ; Basic RX info
"RTN","BPSOSCD",42,0)
 S BPS("RX",MEDN,"IEN59")=IEN59
"RTN","BPSOSCD",43,0)
 S BPS("RX",MEDN,"RX IEN")=RXIEN
"RTN","BPSOSCD",44,0)
 S BPS("RX",MEDN,"RX Number")=RXIEN
"RTN","BPSOSCD",45,0)
 S BPS("RX",MEDN,"Date Written")=$$RXAPI1^BPSUTIL1(RXIEN,1,"I")
"RTN","BPSOSCD",46,0)
 S BPS("RX",MEDN,"New/Refill")=$S(RXRFIEN="":"N",1:"R")
"RTN","BPSOSCD",47,0)
 ;
"RTN","BPSOSCD",48,0)
 ; Get/format the Service Date - It should be in BPS Transaction.  If not,
"RTN","BPSOSCD",49,0)
 ;   use the established algorithm, which is $$DOSDATE^BPSSCRRS
"RTN","BPSOSCD",50,0)
 S FILLDT=$P($G(^BPST(IEN59,12)),U,2)
"RTN","BPSOSCD",51,0)
 I FILLDT="" S FILLDT=$$DOSDATE^BPSSCRRS(RXIEN,RXRFIEN) D LOG^BPSOSL(IEN59,$T(+0)_"-Fill Date sent as "_FILLDT)
"RTN","BPSOSCD",52,0)
 S BPS("RX",MEDN,"Date Filled")=$$FMTHL7^XLFDT(FILLDT)
"RTN","BPSOSCD",53,0)
 ;
"RTN","BPSOSCD",54,0)
 ; PreAuth and Prior Auth (use same fields)
"RTN","BPSOSCD",55,0)
 S BPS("RX",MEDN,"Preauth #")=$P(^BPST(IEN59,1),U,15)_$P(^BPST(IEN59,1),U,9)
"RTN","BPSOSCD",56,0)
 S BPS("Claim",MEDN,"Prior Auth Type")=$P(^BPST(IEN59,1),U,15)
"RTN","BPSOSCD",57,0)
 S BPS("Claim",MEDN,"Prior Auth Num Sub")=$P(^BPST(IEN59,1),U,9)
"RTN","BPSOSCD",58,0)
 ;
"RTN","BPSOSCD",59,0)
 ; NDC - Get from transaction first.  If not there (which should not happen),
"RTN","BPSOSCD",60,0)
 ;   get it from the RX/Fill
"RTN","BPSOSCD",61,0)
 S NDC=$P(^BPST(IEN59,1),U,2)
"RTN","BPSOSCD",62,0)
 I NDC="" S NDC=$$GETNDC^PSONDCUT(RXIEN,RXRFIEN) D LOG^BPSOSL(IEN59,$T(+0)_"-NDC sent as "_NDC)
"RTN","BPSOSCD",63,0)
 S BPS("RX",MEDN,"NDC")=NDC
"RTN","BPSOSCD",64,0)
 ;
"RTN","BPSOSCD",65,0)
 ; Prescription Data
"RTN","BPSOSCD",66,0)
 S BPS("RX",MEDN,"# Refills")=$$RXAPI1^BPSUTIL1(RXIEN,9,"I")
"RTN","BPSOSCD",67,0)
 S BPS("RX",MEDN,"Refill #")=+RXRFIEN
"RTN","BPSOSCD",68,0)
 ;
"RTN","BPSOSCD",69,0)
 ; Prescription Data dependent on original vs. refill
"RTN","BPSOSCD",70,0)
 I 'RXRFIEN D  ; first fill
"RTN","BPSOSCD",71,0)
 . S BPS("RX",MEDN,"Days Supply")=$$RXAPI1^BPSUTIL1(RXIEN,8,"I")
"RTN","BPSOSCD",72,0)
 . S BPS("RX",MEDN,"DAW")=$$RXAPI1^BPSUTIL1(RXIEN,81,"I")
"RTN","BPSOSCD",73,0)
 E  D  ; refill
"RTN","BPSOSCD",74,0)
 . S BPS("RX",MEDN,"Days Supply")=$$RXSUBF1^BPSUTIL1(RXIEN,52,52.1,+RXRFIEN,1.1,"I")
"RTN","BPSOSCD",75,0)
 . S BPS("RX",MEDN,"DAW")=$$RXSUBF1^BPSUTIL1(RXIEN,52,52.1,+RXRFIEN,81,"I")
"RTN","BPSOSCD",76,0)
 ;
"RTN","BPSOSCD",77,0)
 ; Provider Info
"RTN","BPSOSCD",78,0)
 S BPS("RX",MEDN,"Prescriber IEN")=+PROVIEN
"RTN","BPSOSCD",79,0)
 I PROVIEN'="" D
"RTN","BPSOSCD",80,0)
 . S BPS("RX",MEDN,"Prescriber Name")=$$GET1^DIQ(200,+PROVIEN,.01)
"RTN","BPSOSCD",81,0)
 . S BPS("RX",MEDN,"Prescriber Phone #")=$$ACPHONE^IBNCPDPI() ; Agent Cashier Phone Number)
"RTN","BPSOSCD",82,0)
 . I ^BPS(9002313.99,1,"CERTIFIER")=DUZ S BPS("RX",MEDN,"Prescriber DEA #")=$G(BPS("RX",1,"Provider ID"))
"RTN","BPSOSCD",83,0)
 . S BPS("RX",MEDN,"Prescriber DEA #")=$$GET1^DIQ(200,+PROVIEN,53.2)
"RTN","BPSOSCD",84,0)
 . S BPS("RX",MEDN,"Prescriber CAID #")=""
"RTN","BPSOSCD",85,0)
 . S BPS("RX",MEDN,"Prescriber UPIN #")=""
"RTN","BPSOSCD",86,0)
 . S BPS("RX",MEDN,"Prescriber Billing Location")=""
"RTN","BPSOSCD",87,0)
 . S NPI=$$NPI^BPSNPI("Individual_ID",+PROVIEN)
"RTN","BPSOSCD",88,0)
 . I +NPI=-1 S NPI=""
"RTN","BPSOSCD",89,0)
 . S BPS("RX",MEDN,"Prescriber NPI")=$P(NPI,U,1)
"RTN","BPSOSCD",90,0)
 . S BPS("RX",MEDN,"Primary Care Provider NPI")=$P(NPI,U,1)
"RTN","BPSOSCD",91,0)
 . S BPS("RX",MEDN,"Provider NPI")=$P(NPI,U,1)
"RTN","BPSOSCD",92,0)
 ;
"RTN","BPSOSCD",93,0)
 ; Set Prescriber ID field to individual DEA if it exists, else default DEA
"RTN","BPSOSCD",94,0)
 N %
"RTN","BPSOSCD",95,0)
 S %=$G(BPS("RX",MEDN,"Prescriber DEA #"))
"RTN","BPSOSCD",96,0)
 I %="" S %=$G(BPS("Site","Default DEA #"))
"RTN","BPSOSCD",97,0)
 S BPS("RX",MEDN,"Prescriber ID")=%
"RTN","BPSOSCD",98,0)
 ;
"RTN","BPSOSCD",99,0)
 ; Get State IDs for providers
"RTN","BPSOSCD",100,0)
 D STLIC^BPSJPAY(MEDN,PROVIEN,BPS("RX",MEDN,"Date Filled"))
"RTN","BPSOSCD",101,0)
 ;
"RTN","BPSOSCD",102,0)
 ; Origin Code
"RTN","BPSOSCD",103,0)
 N VANATURE,VAOIEN
"RTN","BPSOSCD",104,0)
 S (VANATURE,VAOIEN)="",VAOIEN=+$$RXAPI1^BPSUTIL1(RXIEN,39.3,"I"),VANATURE=$$GET1^DIQ(100.008,"1,"_VAOIEN_",","12")
"RTN","BPSOSCD",105,0)
 S BPS("RX",MEDN,"Origin Code")=$S(VANATURE="AUTO":2,VANATURE["ELECTRONIC":3,VANATURE="DUPLICATE":0,VANATURE["TELEPHONE":2,1:1)
"RTN","BPSOSCD",106,0)
 ;
"RTN","BPSOSCD",107,0)
 ;Submission Clarification Code
"RTN","BPSOSCD",108,0)
 S BPS("RX",MEDN,"Clarification")=$P($G(^BPST(IEN59,12)),U,3)
"RTN","BPSOSCD",109,0)
 ;
"RTN","BPSOSCD",110,0)
 ; Drug Info
"RTN","BPSOSCD",111,0)
 I DRUGIEN'="" D
"RTN","BPSOSCD",112,0)
 . S BPS("RX",MEDN,"Drug IEN")=DRUGIEN
"RTN","BPSOSCD",113,0)
 . S BPS("RX",MEDN,"Drug Name")=$$DRUGDIE^BPSUTIL1(DRUGIEN,.01,"E")
"RTN","BPSOSCD",114,0)
 ;
"RTN","BPSOSCD",115,0)
 ; Pricing Info
"RTN","BPSOSCD",116,0)
 S BPS("RX",MEDN,"Alt. Product Type")="03"
"RTN","BPSOSCD",117,0)
 S BPS("RX",MEDN,"Gross Amount Due")=$G(VAINFO(9002313.59902,IENS,902.15,"I"))
"RTN","BPSOSCD",118,0)
 S BPS("RX",MEDN,"Usual & Customary")=$G(VAINFO(9002313.59902,IENS,902.14,"I"))
"RTN","BPSOSCD",119,0)
 S BPS("RX",MEDN,"Basis of Cost Determination")=$G(VAINFO(9002313.59902,IENS,902.13,"I"))
"RTN","BPSOSCD",120,0)
 ;
"RTN","BPSOSCD",121,0)
 ; More pricing info
"RTN","BPSOSCD",122,0)
 N PRICING
"RTN","BPSOSCD",123,0)
 S PRICING=^BPST(IEN59,5)
"RTN","BPSOSCD",124,0)
 S BPS("RX",MEDN,"Quantity")=$P(PRICING,U) ; 01/31/2001
"RTN","BPSOSCD",125,0)
 S BPS("RX",MEDN,"Unit Price")=$P(PRICING,U,2)
"RTN","BPSOSCD",126,0)
 S BPS("RX",MEDN,"Ingredient Cost")=$J($P(PRICING,U,2),0,2)
"RTN","BPSOSCD",127,0)
 S BPS("RX",MEDN,"Dispensing Fee")=$J($P(PRICING,U,4),0,2)
"RTN","BPSOSCD",128,0)
 S BPS("Site","Dispensing Fee")=BPS("RX",MEDN,"Dispensing Fee")
"RTN","BPSOSCD",129,0)
 S BPS("RX",MEDN,"Usual & Customary")=$J($P(PRICING,U,5),0,2)
"RTN","BPSOSCD",130,0)
 S BPS("RX",MEDN,"Unit of Measure")=$P(PRICING,U,8)
"RTN","BPSOSCD",131,0)
 I $G(BPS("NCPDP","Add Disp. Fee to Ingr. Cost")) D
"RTN","BPSOSCD",132,0)
 . S BPS("RX",MEDN,"Ingredient Cost")=BPS("RX",MEDN,"Ingredient Cost")+BPS("RX",MEDN,"Dispensing Fee")
"RTN","BPSOSCD",133,0)
 Q
"RTN","BPSOSCD",134,0)
 ;
"RTN","BPSOSCD",135,0)
 ; OVERRIDE - Retrieve OVERRIDE nodes and put into BPS array
"RTN","BPSOSCD",136,0)
 ; They will be fetched from BPS("OVERRIDE"
"RTN","BPSOSCD",137,0)
 ;   during low-level construction of the actual encoded claim packet.
"RTN","BPSOSCD",138,0)
 ; BPS("OVERRIDE",field)=value  for fields 101-401
"RTN","BPSOSCD",139,0)
 ; BPS("OVERRIDE","RX",MEDN,field) for med #N, fields 402+
"RTN","BPSOSCD",140,0)
 ; Note that if you have multiple prescriptions bundled, the
"RTN","BPSOSCD",141,0)
 ;   union of overrides from 101-401 apply to all; and if there's a
"RTN","BPSOSCD",142,0)
 ;   conflict, the last one overwrites the previous ones.
"RTN","BPSOSCD",143,0)
OVERRIDE(IEN59,MEDN) ;
"RTN","BPSOSCD",144,0)
 N IEN511 S IEN511=$P(^BPST(IEN59,1),U,13) Q:'IEN511
"RTN","BPSOSCD",145,0)
 N RETVAL S RETVAL=$$GET511^BPSOSO2(IEN511,"BPS(""OVERRIDE"")","BPS(""OVERRIDE"",""RX"","_MEDN_")")
"RTN","BPSOSCD",146,0)
 Q
"RTN","BPSOSCD",147,0)
 ;
"RTN","BPSOSCD",148,0)
 ; DURVALUE - Will read in the DUR data from the DUR multiple
"RTN","BPSOSCD",149,0)
 ;   in BPS Transactions and store the values into BPS("RX",MEDN,DUR,....)
"RTN","BPSOSCD",150,0)
 ; NOTE - unlike most values, these fields are stored by their
"RTN","BPSOSCD",151,0)
 ;   field number.  Since they are repeating, it will ease the
"RTN","BPSOSCD",152,0)
 ;   retrieval of them, when we populate the claim.
"RTN","BPSOSCD",153,0)
DURVALUE(IEN59,MEDN) ;
"RTN","BPSOSCD",154,0)
 N DUR,DCNT,DURREC
"RTN","BPSOSCD",155,0)
 ;
"RTN","BPSOSCD",156,0)
 S (DUR,DCNT)=0
"RTN","BPSOSCD",157,0)
 F  S DCNT=$O(^BPST(IEN59,13,DCNT)) Q:'+DCNT  D
"RTN","BPSOSCD",158,0)
 . S DURREC=$G(^BPST(IEN59,13,DCNT,0))
"RTN","BPSOSCD",159,0)
 . I DURREC="" Q
"RTN","BPSOSCD",160,0)
 . S DUR=DUR+1
"RTN","BPSOSCD",161,0)
 . S BPS("RX",MEDN,"DUR",DUR,473)=DUR  ;dur/pps cntr
"RTN","BPSOSCD",162,0)
 . S BPS("RX",MEDN,"DUR",DUR,439)=$P(DURREC,U,3) ;Reason Srv Cd
"RTN","BPSOSCD",163,0)
 . S BPS("RX",MEDN,"DUR",DUR,440)=$P(DURREC,U,2) ;Prof Srv Cd
"RTN","BPSOSCD",164,0)
 . S BPS("RX",MEDN,"DUR",DUR,441)=$P(DURREC,U,4) ;Result Src Cd
"RTN","BPSOSCD",165,0)
 . S BPS("RX",MEDN,"DUR",DUR,474)=""             ;Level of Effort
"RTN","BPSOSCD",166,0)
 . S BPS("RX",MEDN,"DUR",DUR,475)=""             ;Co-agent Qual
"RTN","BPSOSCD",167,0)
 . S BPS("RX",MEDN,"DUR",DUR,476)=""             ;Co-agent ID
"RTN","BPSOSCD",168,0)
 Q
"RTN","BPSOSCE")
0^84^B13508896
"RTN","BPSOSCE",1,0)
BPSOSCE ;BHAM ISC/FCS/DRS/DLF - New entry in 9002313.02 ;06/01/2004
"RTN","BPSOSCE",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5,7**;JUN 2004;Build 46
"RTN","BPSOSCE",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSCE",4,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSCE",5,0)
 ;Creates an Electronic Claim Submission record
"RTN","BPSOSCE",6,0)
 ;
"RTN","BPSOSCE",7,0)
 ;Parameters:  START     - START Medication Number
"RTN","BPSOSCE",8,0)
 ;             END       - END Medication Number
"RTN","BPSOSCE",9,0)
 ;             TOTAL     - TOTAL Medications in Claim
"RTN","BPSOSCE",10,0)
 ;                       - The BPS(*) array pointed to by START, END
"RTN","BPSOSCE",11,0)
 ;
"RTN","BPSOSCE",12,0)
 ; Note that the BPS array is shared by all of the BPSOSC* routines
"RTN","BPSOSCE",13,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSCE",14,0)
 ; NEWCLAIM^BPSOSCE called from BPSOSCA from BPSOSQG from BPSOSQ2
"RTN","BPSOSCE",15,0)
 ;
"RTN","BPSOSCE",16,0)
 ; This routine is responsible for creating a new entry in the
"RTN","BPSOSCE",17,0)
 ; claims file, and for calling the routines that then populate
"RTN","BPSOSCE",18,0)
 ; that new entry.
"RTN","BPSOSCE",19,0)
 ;
"RTN","BPSOSCE",20,0)
 Q
"RTN","BPSOSCE",21,0)
 ;
"RTN","BPSOSCE",22,0)
NEWCLAIM(START,END,TOTAL) ;EP
"RTN","BPSOSCE",23,0)
 ;
"RTN","BPSOSCE",24,0)
 ;Manage local variables
"RTN","BPSOSCE",25,0)
 N CLAIMID,DIC,DLAYGO,X,Y,COUNT,INDEX,DIK,DA,NODE0,ROU,ERROR,SEG
"RTN","BPSOSCE",26,0)
 S ROU=$T(+0),START=+$G(START),END=+$G(END),TOTAL=+$G(TOTAL)
"RTN","BPSOSCE",27,0)
 ;
"RTN","BPSOSCE",28,0)
 ;Create new record in Claim Submission File (9002313.02)
"RTN","BPSOSCE",29,0)
L L +^TMP($J,"BPSOSCE"):300 I '$T G L:$$IMPOSS^BPSOSUE("L","RTI","Single-threaded routine",,,$T(+0))
"RTN","BPSOSCE",30,0)
 ;
"RTN","BPSOSCE",31,0)
 ; Generate Claim ID
"RTN","BPSOSCE",32,0)
 S CLAIMID=$$CLAIMID^BPSECX1($G(BPS("RX",START,"IEN59")))
"RTN","BPSOSCE",33,0)
 I CLAIMID="" D  Q ERROR
"RTN","BPSOSCE",34,0)
 . S ERROR="320^VA Claim ID not created"
"RTN","BPSOSCE",35,0)
 . D LOG(ROU_"-Failed to create Claim ID")
"RTN","BPSOSCE",36,0)
 ;
"RTN","BPSOSCE",37,0)
 ; Create claim record
"RTN","BPSOSCE",38,0)
 S DLAYGO=9002313.02,DIC="^BPSC(",DIC(0)="LXZ",X=CLAIMID
"RTN","BPSOSCE",39,0)
 D ^DIC S Y=+Y
"RTN","BPSOSCE",40,0)
 L -^TMP($J,"BPSOSCE")
"RTN","BPSOSCE",41,0)
 I Y<1 D  Q ERROR
"RTN","BPSOSCE",42,0)
 . S ERROR="321^Failed to create claim record"
"RTN","BPSOSCE",43,0)
 . D LOG(ROU_"-Failed to create an entry in file 9002313.02")
"RTN","BPSOSCE",44,0)
 ;
"RTN","BPSOSCE",45,0)
 ; Update BPS and Log it
"RTN","BPSOSCE",46,0)
 S BPS(9002313.02)=Y
"RTN","BPSOSCE",47,0)
 ;
"RTN","BPSOSCE",48,0)
 ; Needed for Turn-Around Stats - Do NOT delete/alter!!
"RTN","BPSOSCE",49,0)
 D LOG(ROU_"-Created claim ID "_CLAIMID_" (IEN "_BPS(9002313.02)_")")
"RTN","BPSOSCE",50,0)
 ;
"RTN","BPSOSCE",51,0)
 ; Update the zero node of the claim
"RTN","BPSOSCE",52,0)
 S NODE0=$G(^BPSC(BPS(9002313.02),0))
"RTN","BPSOSCE",53,0)
 S $P(NODE0,U,2)=$G(BPS("NCPDP","IEN")) ; Electronic Payor (Payer Sheet)
"RTN","BPSOSCE",54,0)
 S $P(NODE0,U,4)=2 ; Transmit Flag - 2 is 'Yes (Point of Sale)'
"RTN","BPSOSCE",55,0)
 S $P(NODE0,U,6)=$$NOWFM^BPSOSU1() ; Created On
"RTN","BPSOSCE",56,0)
 S ^BPSC(BPS(9002313.02),0)=NODE0
"RTN","BPSOSCE",57,0)
 ;
"RTN","BPSOSCE",58,0)
 ; Update Patient Name
"RTN","BPSOSCE",59,0)
 S $P(^BPSC(BPS(9002313.02),1),U,1)=$G(BPS("Patient","Name"))
"RTN","BPSOSCE",60,0)
 S $P(^BPSC(BPS(9002313.02),1),U,4)=$G(BPS("Insurer","IEN"))
"RTN","BPSOSCE",61,0)
 ;
"RTN","BPSOSCE",62,0)
 ; Only Billing Request call this routine so the transaction code
"RTN","BPSOSCE",63,0)
 ;   is always "B1"
"RTN","BPSOSCE",64,0)
 S BPS("Transaction Code")="B1"
"RTN","BPSOSCE",65,0)
 S BPS("Transaction Count")=TOTAL
"RTN","BPSOSCE",66,0)
 ;
"RTN","BPSOSCE",67,0)
 ; Process the 'non-multiple' segments (Header, Patient, Cardholder)
"RTN","BPSOSCE",68,0)
 F SEG=100:10:120 D XLOOP^BPSOSCF(BPS("NCPDP","IEN"),SEG)
"RTN","BPSOSCE",69,0)
 ;
"RTN","BPSOSCE",70,0)
 ; Create the definition node for the multiple
"RTN","BPSOSCE",71,0)
 S ^BPSC(BPS(9002313.02),400,0)="^9002313.0201PA^^"
"RTN","BPSOSCE",72,0)
 ;
"RTN","BPSOSCE",73,0)
 S COUNT=0
"RTN","BPSOSCE",74,0)
 F INDEX=START:1:END D
"RTN","BPSOSCE",75,0)
 . ;
"RTN","BPSOSCE",76,0)
 . ;Create node zero of the medication multiple
"RTN","BPSOSCE",77,0)
 . S COUNT=COUNT+1
"RTN","BPSOSCE",78,0)
 . S NODE0=""
"RTN","BPSOSCE",79,0)
 . S $P(NODE0,U,1)=INDEX
"RTN","BPSOSCE",80,0)
 . S $P(NODE0,U,4)=$G(BPS("RX",INDEX,"Drug Name"))
"RTN","BPSOSCE",81,0)
 . S $P(NODE0,U,5)=$G(BPS("RX",INDEX,"RX IEN"))
"RTN","BPSOSCE",82,0)
 . S ^BPSC(BPS(9002313.02),400,INDEX,0)=NODE0
"RTN","BPSOSCE",83,0)
 . ;
"RTN","BPSOSCE",84,0)
 . ;
"RTN","BPSOSCE",85,0)
 . I ^BPS(9002313.99,1,"CERTIFIER")=DUZ S INDEX=1 ;LJE
"RTN","BPSOSCE",86,0)
 . S $P(^BPSC(BPS(9002313.02),400,INDEX,400),U,1)=BPS("RX",INDEX,"Date Filled")
"RTN","BPSOSCE",87,0)
 . S BPS(9002313.0201)=INDEX ;07/28/96.
"RTN","BPSOSCE",88,0)
 . ;
"RTN","BPSOSCE",89,0)
 . ; Process multiples in the medication multiple
"RTN","BPSOSCE",90,0)
 . F SEG=130:10:230 D XLOOP^BPSOSCF(BPS("NCPDP","IEN"),SEG,INDEX)
"RTN","BPSOSCE",91,0)
 . ;
"RTN","BPSOSCE",92,0)
 . ; Update the indices
"RTN","BPSOSCE",93,0)
 . S ^BPSC(BPS(9002313.02),400,"B",INDEX,INDEX)=""
"RTN","BPSOSCE",94,0)
 . S NODE0=$G(^BPSC(BPS(9002313.02),400,0))
"RTN","BPSOSCE",95,0)
 . ;
"RTN","BPSOSCE",96,0)
 . ; Update the definition node of the multiple
"RTN","BPSOSCE",97,0)
 . S $P(NODE0,U,4)=COUNT
"RTN","BPSOSCE",98,0)
 . S ^BPSC(BPS(9002313.02),400,0)=NODE0
"RTN","BPSOSCE",99,0)
 . ;
"RTN","BPSOSCE",100,0)
 ;
"RTN","BPSOSCE",101,0)
 ; Cross-Reference Claim Submission Record
"RTN","BPSOSCE",102,0)
 S DIK="^BPSC("
"RTN","BPSOSCE",103,0)
 S DA=BPS(9002313.02)
"RTN","BPSOSCE",104,0)
 D IX1^DIK
"RTN","BPSOSCE",105,0)
 Q ""
"RTN","BPSOSCE",106,0)
 ;
"RTN","BPSOSCE",107,0)
 ; LOG - Write the message to all of transactions that are
"RTN","BPSOSCE",108,0)
 ; being bundled into this 9002313.02 claim
"RTN","BPSOSCE",109,0)
LOG(MSG) ;
"RTN","BPSOSCE",110,0)
 N IEN59,I
"RTN","BPSOSCE",111,0)
 F I=START:1:END D
"RTN","BPSOSCE",112,0)
 . S IEN59=$G(BPS("RX",I,"IEN59"))
"RTN","BPSOSCE",113,0)
 . I IEN59 D LOG^BPSOSL(IEN59,MSG)
"RTN","BPSOSCE",114,0)
 Q
"RTN","BPSOSIY")
0^18^B55797518
"RTN","BPSOSIY",1,0)
BPSOSIY ;BHAM ISC/FCS/DRS/DLF - Updating BPS Transaction record ;11/7/07  17:29
"RTN","BPSOSIY",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,3,5,6,7**;JUN 2004;Build 46
"RTN","BPSOSIY",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSIY",4,0)
 Q
"RTN","BPSOSIY",5,0)
 ;
"RTN","BPSOSIY",6,0)
 ; INIT - Update BPS Transaction
"RTN","BPSOSIY",7,0)
 ; Input
"RTN","BPSOSIY",8,0)
 ;   IEN59 - BPS Transaction
"RTN","BPSOSIY",9,0)
 ;   MOREDATA is not passed but assumed to exist
"RTN","BPSOSIY",10,0)
 ;   BP77 - BPS REQUEST ien
"RTN","BPSOSIY",11,0)
 ; Returns
"RTN","BPSOSIY",12,0)
 ;   ERROR - 0 or error number
"RTN","BPSOSIY",13,0)
INIT(IEN59,BP77) ;EP - from BPSOSIZ
"RTN","BPSOSIY",14,0)
 N BPCOB,BPSTIME
"RTN","BPSOSIY",15,0)
 ;
"RTN","BPSOSIY",16,0)
 I $G(BP77)>0 D UPD7759^BPSOSRX4(BP77,IEN59)
"RTN","BPSOSIY",17,0)
 ;   
"RTN","BPSOSIY",18,0)
 ; Initialize variables
"RTN","BPSOSIY",19,0)
 N FDA,MSG,FN,IENS,REC,B1,X1,X2,X3,ERROR,SEQ
"RTN","BPSOSIY",20,0)
 N RXI,RXR,DIV
"RTN","BPSOSIY",21,0)
 S FN=9002313.59,REC=IEN59_",",ERROR=0
"RTN","BPSOSIY",22,0)
 S RXI=$P(IEN59,".",1),RXR=+$E($P(IEN59,".",2),1,4)
"RTN","BPSOSIY",23,0)
 I RXI="" Q 11
"RTN","BPSOSIY",24,0)
 ;
"RTN","BPSOSIY",25,0)
 ; Change status to 0% (Waiting to Start), which will reset START TIME,
"RTN","BPSOSIY",26,0)
 ;   and then to 10% (Building transaction)
"RTN","BPSOSIY",27,0)
 D SETSTAT^BPSOSU(IEN59,0)
"RTN","BPSOSIY",28,0)
 D SETSTAT^BPSOSU(IEN59,10)
"RTN","BPSOSIY",29,0)
 ;
"RTN","BPSOSIY",30,0)
 ; Get the Outpatient Site
"RTN","BPSOSIY",31,0)
 S DIV=$$GETDIV^BPSOSQC(RXI,RXR)
"RTN","BPSOSIY",32,0)
 ;
"RTN","BPSOSIY",33,0)
 ; If there are Prior Auth or Sub Clar Code override, create override
"RTN","BPSOSIY",34,0)
 ;   record.  Note that setting of MOREDATA("BPOVRIEN") in this routine
"RTN","BPSOSIY",35,0)
 ;   will not conflict with prior setting of this value of BPOVRIEN
"RTN","BPSOSIY",36,0)
 ;   since BPOVRIEN and BPSAUTH/BPSCLARF are mutually exclusive
"RTN","BPSOSIY",37,0)
 I $G(MOREDATA("BPSAUTH"))]""!($G(MOREDATA("BPSCLARF"))]"") S MOREDATA("BPOVRIEN")=$$OVERRIDE(IEN59)
"RTN","BPSOSIY",38,0)
 ;
"RTN","BPSOSIY",39,0)
 ; Set BPSDATA into local variable
"RTN","BPSOSIY",40,0)
 S B1=$G(MOREDATA("BPSDATA",1))
"RTN","BPSOSIY",41,0)
 ;
"RTN","BPSOSIY",42,0)
 ; Get first record from MOREDATA("IBDATA") as there are some
"RTN","BPSOSIY",43,0)
 ;   non-multiple fields that need it
"RTN","BPSOSIY",44,0)
 S X2="",SEQ=$O(MOREDATA("IBDATA",""))
"RTN","BPSOSIY",45,0)
 I SEQ S X2=$G(MOREDATA("IBDATA",SEQ,2))
"RTN","BPSOSIY",46,0)
 ;
"RTN","BPSOSIY",47,0)
 ; Set non-multiple fields
"RTN","BPSOSIY",48,0)
 S FDA(FN,REC,1.07)=$$GETPHARM^BPSUTIL(DIV) ;BPS Pharmacy
"RTN","BPSOSIY",49,0)
 S FDA(FN,REC,1.08)=1   ;PINS piece
"RTN","BPSOSIY",50,0)
 S FDA(FN,REC,1.11)=RXI ;Prescription
"RTN","BPSOSIY",51,0)
 I $P($G(^BPST(IEN59,1)),U,12)=1 S FDA(FN,REC,1.12)=2 ;Resubmit after reversal
"RTN","BPSOSIY",52,0)
 S FDA(FN,REC,1.13)=$G(MOREDATA("BPOVRIEN"))  ;NCPDP Overrides
"RTN","BPSOSIY",53,0)
 S FDA(FN,REC,5)=$$RXAPI1^BPSUTIL1(RXI,2,"I") ;Patient
"RTN","BPSOSIY",54,0)
 I '$P($G(^BPST(IEN59,1)),U,12) S FDA(FN,REC,6)=$G(MOREDATA("SUBMIT TIME")) ;Submit Date/Time
"RTN","BPSOSIY",55,0)
 S FDA(FN,REC,9)=RXR  ;Refill
"RTN","BPSOSIY",56,0)
 S FDA(FN,REC,10)=$P(B1,U,3)  ;NDC
"RTN","BPSOSIY",57,0)
 S FDA(FN,REC,11)=DIV ;Outpatient Site
"RTN","BPSOSIY",58,0)
 S FDA(FN,REC,13)=$G(MOREDATA("USER")) ;User
"RTN","BPSOSIY",59,0)
 S FDA(FN,REC,501)=$P(B1,U,1) ;Drug Quanity
"RTN","BPSOSIY",60,0)
 S FDA(FN,REC,502)=$P(B1,U,2) ;Ingredient Cost
"RTN","BPSOSIY",61,0)
 S FDA(FN,REC,504)=$P(X2,U,1) ;Dispense Fee
"RTN","BPSOSIY",62,0)
 S FDA(FN,REC,505)=$P(X2,U,3) ;Total Price
"RTN","BPSOSIY",63,0)
 S FDA(FN,REC,507)=$P(X2,U,5) ;Administrative Fee
"RTN","BPSOSIY",64,0)
 S FDA(FN,REC,508)=$E($P(B1,U,7),1,2) ;Dispense Unit
"RTN","BPSOSIY",65,0)
 S FDA(FN,REC,901)=1          ;Current VA Insurer
"RTN","BPSOSIY",66,0)
 S FDA(FN,REC,1201)=$G(MOREDATA("RX ACTION")) ;RX Action
"RTN","BPSOSIY",67,0)
 S FDA(FN,REC,1202)=$G(MOREDATA("DATE OF SERVICE")) ;Date of Service
"RTN","BPSOSIY",68,0)
 S FDA(FN,REC,901.04)=$G(MOREDATA("ELIG")) ;Eligibility info returned from billing determination
"RTN","BPSOSIY",69,0)
 ;
"RTN","BPSOSIY",70,0)
 ; File non-multiple fields - Record is already defined
"RTN","BPSOSIY",71,0)
 D FILE^DIE("","FDA","MSG")
"RTN","BPSOSIY",72,0)
 I $D(MSG) D  Q ERROR
"RTN","BPSOSIY",73,0)
 . S ERROR=12
"RTN","BPSOSIY",74,0)
 . D LOG^BPSOSL(IEN59,$T(+0)_"-Non-multiple fields did not file")
"RTN","BPSOSIY",75,0)
 . D LOG^BPSOSL(IEN59,"MSG Array:")
"RTN","BPSOSIY",76,0)
 . D LOGARRAY^BPSOSL(IEN59,"MSG")
"RTN","BPSOSIY",77,0)
 . D LOG^BPSOSL(IEN59,"FDA Array:")
"RTN","BPSOSIY",78,0)
 . D LOGARRAY^BPSOSL(IEN59,"FDA")
"RTN","BPSOSIY",79,0)
 ;
"RTN","BPSOSIY",80,0)
 ; Build Multiple
"RTN","BPSOSIY",81,0)
 S SEQ=""
"RTN","BPSOSIY",82,0)
 F  S SEQ=$O(MOREDATA("IBDATA",SEQ)) Q:SEQ=""  D  I ERROR Q
"RTN","BPSOSIY",83,0)
 . K FDA,MSG,IENS
"RTN","BPSOSIY",84,0)
 . S FN=9002313.59902,IENS="+1,"_REC,IENS(1)=SEQ
"RTN","BPSOSIY",85,0)
 . S X1=$G(MOREDATA("IBDATA",SEQ,1)),X2=$G(MOREDATA("IBDATA",SEQ,2)),X3=$G(MOREDATA("IBDATA",SEQ,3))
"RTN","BPSOSIY",86,0)
 . ;
"RTN","BPSOSIY",87,0)
 . ; Update fields
"RTN","BPSOSIY",88,0)
 . S FDA(FN,IENS,.01)=$P(X1,U,1)    ;Plan ID
"RTN","BPSOSIY",89,0)
 . S FDA(FN,IENS,902.03)=$P(X1,U,2) ;BIN
"RTN","BPSOSIY",90,0)
 . S FDA(FN,IENS,902.04)=$P(X1,U,3) ;PCN
"RTN","BPSOSIY",91,0)
 . S FDA(FN,IENS,902.05)=$P(X1,U,5) ;Group ID
"RTN","BPSOSIY",92,0)
 . S FDA(FN,IENS,902.06)=$P(X1,U,6) ;Cardholder ID
"RTN","BPSOSIY",93,0)
 . S FDA(FN,IENS,902.07)=$S(+$P(X1,U,7)>4:4,1:+$P(X1,U,7)) ;Patient Relationship Code
"RTN","BPSOSIY",94,0)
 . S FDA(FN,IENS,902.08)=$P($P(X1,U,8)," ") ;Cardholder First Name
"RTN","BPSOSIY",95,0)
 . S FDA(FN,IENS,902.09)=$P(X1,U,9)  ;Cardholder Last Name
"RTN","BPSOSIY",96,0)
 . S FDA(FN,IENS,902.11)=$P(X1,U,10) ;Home Plan State
"RTN","BPSOSIY",97,0)
 . S FDA(FN,IENS,902.12)=$P(X2,U,1)  ;Dispense Fee
"RTN","BPSOSIY",98,0)
 . S FDA(FN,IENS,902.13)=$P(X2,U,2)  ;Basis of Cost Determination
"RTN","BPSOSIY",99,0)
 . S FDA(FN,IENS,902.14)=$P(X2,U,3)  ;Usual & Customary Charge
"RTN","BPSOSIY",100,0)
 . S FDA(FN,IENS,902.15)=$P(X2,U,4)  ;Gross Amt Due
"RTN","BPSOSIY",101,0)
 . S FDA(FN,IENS,902.16)=$P(X2,U,5)  ;Administrative Fee
"RTN","BPSOSIY",102,0)
 . S FDA(FN,IENS,902.17)=$P(B1,U,4)  ;VA Fill Number
"RTN","BPSOSIY",103,0)
 . S FDA(FN,IENS,902.18)=$P(X1,U,13) ;Software/Vendor Cert ID
"RTN","BPSOSIY",104,0)
 . S FDA(FN,IENS,902.22)=$P(B1,U,5)  ;Certify Mode
"RTN","BPSOSIY",105,0)
 . S FDA(FN,IENS,902.23)=$P(B1,U,6)  ;Certification IEN
"RTN","BPSOSIY",106,0)
 . S FDA(FN,IENS,902.24)=$P(X1,U,14) ;Plan Name
"RTN","BPSOSIY",107,0)
 . S FDA(FN,IENS,902.25)=$P(X3,U,1)  ;Group Name
"RTN","BPSOSIY",108,0)
 . S FDA(FN,IENS,902.26)=$P(X3,U,2)  ;Insurance Co Phone #
"RTN","BPSOSIY",109,0)
 . S FDA(FN,IENS,902.27)=$P(X3,U,3)  ;Pharmacy Plan ID
"RTN","BPSOSIY",110,0)
 . ;
"RTN","BPSOSIY",111,0)
 . ; File the data
"RTN","BPSOSIY",112,0)
 . D UPDATE^DIE("","FDA","IENS","MSG")
"RTN","BPSOSIY",113,0)
 . I $D(MSG) D
"RTN","BPSOSIY",114,0)
 .. S ERROR=13
"RTN","BPSOSIY",115,0)
 .. D LOG^BPSOSL(IEN59,$T(+0)_"-Multiple fields did not file, SEQ="_SEQ)
"RTN","BPSOSIY",116,0)
 .. D LOG^BPSOSL(IEN59,"MSG Array:")
"RTN","BPSOSIY",117,0)
 .. D LOGARRAY^BPSOSL(IEN59,"MSG")
"RTN","BPSOSIY",118,0)
 .. D LOG^BPSOSL(IEN59,"IENS Array:")
"RTN","BPSOSIY",119,0)
 .. D LOGARRAY^BPSOSL(IEN59,"IENS")
"RTN","BPSOSIY",120,0)
 .. D LOG^BPSOSL(IEN59,"FDA Array:")
"RTN","BPSOSIY",121,0)
 .. D LOGARRAY^BPSOSL(IEN59,"FDA")
"RTN","BPSOSIY",122,0)
 . ;
"RTN","BPSOSIY",123,0)
 . ; Payer sheets are in external format
"RTN","BPSOSIY",124,0)
 . K FDA,MSG
"RTN","BPSOSIY",125,0)
 . S FN=9002313.59902,IENS=IENS(1)_","_REC
"RTN","BPSOSIY",126,0)
 . S FDA(FN,IENS,902.02)=$P(X1,U,4)  ;Payer Sheet IEN
"RTN","BPSOSIY",127,0)
 . S FDA(FN,IENS,902.19)=$P(X1,U,11) ;B2 Payer Sheet (Reversal)
"RTN","BPSOSIY",128,0)
 . S FDA(FN,IENS,902.21)=$P(X1,U,12) ;B3 Payer Sheet (Rebill)
"RTN","BPSOSIY",129,0)
 . D FILE^DIE("E","FDA","MSG")
"RTN","BPSOSIY",130,0)
 . I $D(MSG) D
"RTN","BPSOSIY",131,0)
 .. S ERROR=14
"RTN","BPSOSIY",132,0)
 .. D LOG^BPSOSL(IEN59,$T(+0)_"-Payer sheets did not file, SEQ="_SEQ)
"RTN","BPSOSIY",133,0)
 .. D LOG^BPSOSL(IEN59,"MSG Array:")
"RTN","BPSOSIY",134,0)
 .. D LOGARRAY^BPSOSL(IEN59,"MSG")
"RTN","BPSOSIY",135,0)
 .. D LOG^BPSOSL(IEN59,"FDA Array:")
"RTN","BPSOSIY",136,0)
 .. D LOGARRAY^BPSOSL(IEN59,"FDA")
"RTN","BPSOSIY",137,0)
 ;
"RTN","BPSOSIY",138,0)
 ; Store DUR multiple if it exists
"RTN","BPSOSIY",139,0)
 N DUR,DURREC
"RTN","BPSOSIY",140,0)
 S FN=9002313.5913,DUR=0
"RTN","BPSOSIY",141,0)
 F  S DUR=$O(MOREDATA("DUR",DUR)) Q:DUR=""  D  I ERROR Q
"RTN","BPSOSIY",142,0)
 . K FDA,MSG,IENS
"RTN","BPSOSIY",143,0)
 . S DURREC=$G(MOREDATA("DUR",DUR,0))
"RTN","BPSOSIY",144,0)
 . S IENS="+1,"_REC,IENS(1)=DUR
"RTN","BPSOSIY",145,0)
 . S FDA(FN,IENS,.01)=DUR  ; DUR Counter
"RTN","BPSOSIY",146,0)
 . S FDA(FN,IENS,1)=$P(DURREC,U,1)    ; DUR Professional Service Code
"RTN","BPSOSIY",147,0)
 . S FDA(FN,IENS,2)=$P(DURREC,U,2)    ; DUR Reason for Service Code
"RTN","BPSOSIY",148,0)
 . S FDA(FN,IENS,3)=$P(DURREC,U,3)    ; DUR Result of Service Code
"RTN","BPSOSIY",149,0)
 . D UPDATE^DIE("","FDA","IENS","MSG")
"RTN","BPSOSIY",150,0)
 . I $D(MSG) D
"RTN","BPSOSIY",151,0)
 .. S ERROR=15
"RTN","BPSOSIY",152,0)
 .. D LOG^BPSOSL(IEN59,$T(+0)_"-DUR fields did not file, DUR="_DUR)
"RTN","BPSOSIY",153,0)
 .. D LOG^BPSOSL(IEN59,"DURREC="_DURREC)
"RTN","BPSOSIY",154,0)
 .. D LOG^BPSOSL(IEN59,"MSG Array:")
"RTN","BPSOSIY",155,0)
 .. D LOGARRAY^BPSOSL(IEN59,"MSG")
"RTN","BPSOSIY",156,0)
 .. D LOG^BPSOSL(IEN59,"IENS Array:")
"RTN","BPSOSIY",157,0)
 .. D LOGARRAY^BPSOSL(IEN59,"IENS")
"RTN","BPSOSIY",158,0)
 .. D LOG^BPSOSL(IEN59,"FDA Array:")
"RTN","BPSOSIY",159,0)
 .. D LOGARRAY^BPSOSL(IEN59,"FDA")
"RTN","BPSOSIY",160,0)
 ;
"RTN","BPSOSIY",161,0)
 Q ERROR
"RTN","BPSOSIY",162,0)
 ;
"RTN","BPSOSIY",163,0)
 ; OVERRIDE - Function to create override record
"RTN","BPSOSIY",164,0)
OVERRIDE(IEN59) ;
"RTN","BPSOSIY",165,0)
 ;Save values into BPS NCPDP OVERRIDES (#9002313.511)
"RTN","BPSOSIY",166,0)
 N BPSFDA,BPSFLD,BPOVRIEN,BPSMSG,BPSQ
"RTN","BPSOSIY",167,0)
 ;
"RTN","BPSOSIY",168,0)
 ; Set Name (.01) to transaction number
"RTN","BPSOSIY",169,0)
 S BPSFDA(9002313.511,"+1,",.01)=IEN59
"RTN","BPSOSIY",170,0)
 ;
"RTN","BPSOSIY",171,0)
 ; Set Created On (.02) to current date/time
"RTN","BPSOSIY",172,0)
 S BPSFDA(9002313.511,"+1,",.02)=$$NOW^BPSOSRX()
"RTN","BPSOSIY",173,0)
 ;
"RTN","BPSOSIY",174,0)
 ; Submission Clarification Code
"RTN","BPSOSIY",175,0)
 I $G(MOREDATA("BPSCLARF"))]"" D
"RTN","BPSOSIY",176,0)
 . S BPSFLD=$O(^BPSF(9002313.91,"B",420,""))
"RTN","BPSOSIY",177,0)
 . I BPSFLD]"" S BPSFDA(9002313.5111,"+2,+1,",.01)=BPSFLD,BPSFDA(9002313.5111,"+2,+1,",.02)=$E(MOREDATA("BPSCLARF"),1,2)
"RTN","BPSOSIY",178,0)
 ;
"RTN","BPSOSIY",179,0)
 ; Prior Auth Fields (Code and Number)
"RTN","BPSOSIY",180,0)
 I $G(MOREDATA("BPSAUTH"))]"" D
"RTN","BPSOSIY",181,0)
 . S BPSFLD=$O(^BPSF(9002313.91,"B",461,""))
"RTN","BPSOSIY",182,0)
 . I BPSFLD]"" S BPSFDA(9002313.5111,"+3,+1,",.01)=BPSFLD,BPSFDA(9002313.5111,"+3,+1,",.02)=$E($P(MOREDATA("BPSAUTH"),U,1),1,2)
"RTN","BPSOSIY",183,0)
 . S BPSFLD=$O(^BPSF(9002313.91,"B",462,""))
"RTN","BPSOSIY",184,0)
 . I BPSFLD]"" S BPSFDA(9002313.5111,"+4,+1,",.01)=BPSFLD,BPSFDA(9002313.5111,"+4,+1,",.02)=$E($P(MOREDATA("BPSAUTH"),U,2),1,11)
"RTN","BPSOSIY",185,0)
 ;
"RTN","BPSOSIY",186,0)
 ; Create the record
"RTN","BPSOSIY",187,0)
 D UPDATE^DIE("","BPSFDA","BPOVRIEN","BPMSG")
"RTN","BPSOSIY",188,0)
 ;
"RTN","BPSOSIY",189,0)
 I $G(BPOVRIEN(1))]"" S BPSQ=BPOVRIEN(1)
"RTN","BPSOSIY",190,0)
 E  S BPSQ=""
"RTN","BPSOSIY",191,0)
 Q BPSQ
"RTN","BPSOSIY",192,0)
 ;
"RTN","BPSOSIY",193,0)
 ; RXPAID - Check for status of previous claim
"RTN","BPSOSIY",194,0)
 ; INPUT
"RTN","BPSOSIY",195,0)
 ;   IEN59 - BPS Transaction
"RTN","BPSOSIY",196,0)
 ; Return
"RTN","BPSOSIY",197,0)
 ;   0 - OK
"RTN","BPSOSIY",198,0)
 ;   1 - Payable
"RTN","BPSOSIY",199,0)
 ;   2 - Reversal not accepted
"RTN","BPSOSIY",200,0)
 ;   3 - Duplicate
"RTN","BPSOSIY",201,0)
RXPAID(IEN59) ;EP - from BPSOSIZ
"RTN","BPSOSIY",202,0)
 N N57
"RTN","BPSOSIY",203,0)
 S N57=$$RXPREV(IEN59)
"RTN","BPSOSIY",204,0)
 I 'N57 Q ""  ; no ECME record of this
"RTN","BPSOSIY",205,0)
 ; If it's a reversal, then our result depends on the reversal:
"RTN","BPSOSIY",206,0)
 ;   Was the reversal accepted?   If so, then No, not paid.
"RTN","BPSOSIY",207,0)
 ;   Was the reversal rejected?   Assume Paid, since we try to
"RTN","BPSOSIY",208,0)
 ;        allow reversals only in the case of a paid original.
"RTN","BPSOSIY",209,0)
 I $$ISREVERS^BPSOS57(N57) Q $S($$REVACC^BPSOS57(N57):0,1:2)
"RTN","BPSOSIY",210,0)
 ;
"RTN","BPSOSIY",211,0)
 ; Not a reversal:
"RTN","BPSOSIY",212,0)
 N X S X=$$CATEG^BPSOSUC(N57)
"RTN","BPSOSIY",213,0)
 Q $S(X="E PAYABLE":1,X="E DUPLICATE":3,1:0)
"RTN","BPSOSIY",214,0)
 ;
"RTN","BPSOSIY",215,0)
 ; RXPREV - Has this item previously been through ECME?
"RTN","BPSOSIY",216,0)
 ; Return false if not
"RTN","BPSOSIY",217,0)
 ; Return pointer to BPS Log of Transactions if true
"RTN","BPSOSIY",218,0)
RXPREV(IEN59) ;
"RTN","BPSOSIY",219,0)
 N RXI,RXR
"RTN","BPSOSIY",220,0)
 S RXI=$P(IEN59,".",1),RXR=+$E($P(IEN59,".",2),1,4)
"RTN","BPSOSIY",221,0)
 Q $O(^BPSTL("NON-FILEMAN","RXIRXR",RXI,RXR,""),-1)
"RTN","BPSOSIZ")
0^9^B14362353
"RTN","BPSOSIZ",1,0)
BPSOSIZ ;BHAM ISC/FCS/DRS/DLF - Filing BPS Transaction ;06/01/2004
"RTN","BPSOSIZ",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5,7**;JUN 2004;Build 46
"RTN","BPSOSIZ",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSIZ",4,0)
 ;
"RTN","BPSOSIZ",5,0)
 Q
"RTN","BPSOSIZ",6,0)
 ;
"RTN","BPSOSIZ",7,0)
 ; EN - Create and/or update BPS Transaction
"RTN","BPSOSIZ",8,0)
 ; Input
"RTN","BPSOSIZ",9,0)
 ;   IEN59    - BPS Transaction number
"RTN","BPSOSIZ",10,0)
 ;   MOREDATA - Array of data created by BPSNCPD*
"RTN","BPSOSIZ",11,0)
 ;   BP77 - BPS REQUEST file ien
"RTN","BPSOSIZ",12,0)
EN(IEN59,MOREDATA,BP77) ;EP - BPSOSRB
"RTN","BPSOSIZ",13,0)
 ; Initialize variables
"RTN","BPSOSIZ",14,0)
 N RX,RXR,EXISTS,ERROR,X
"RTN","BPSOSIZ",15,0)
 S ERROR=0,RX=$P(IEN59,"."),RXR=+$E($P(IEN59,".",2),1,4)
"RTN","BPSOSIZ",16,0)
 ;
"RTN","BPSOSIZ",17,0)
 ;
"RTN","BPSOSIZ",18,0)
 D LOG^BPSOSL(IEN59,$T(+0)_"-Building Transaction")
"RTN","BPSOSIZ",19,0)
 ;
"RTN","BPSOSIZ",20,0)
 ; Lock the transaction
"RTN","BPSOSIZ",21,0)
 I '$$LOCK59(IEN59) D ERROR(IEN59,"Could not lock the BPS Transaction") Q
"RTN","BPSOSIZ",22,0)
 ;
"RTN","BPSOSIZ",23,0)
 ; Check for claims that should not be resubmitted
"RTN","BPSOSIZ",24,0)
 ; 
"RTN","BPSOSIZ",25,0)
 ; Remove call to RXPAID^BPSOSIY since this needs to be done in BPSOSRB.
"RTN","BPSOSIZ",26,0)
 S X=$$RXPAID^BPSOSIY(IEN59)
"RTN","BPSOSIZ",27,0)
 I X D ERROR(IEN59,"RXPAID^BPSOSIY returned "_X) Q
"RTN","BPSOSIZ",28,0)
 ; 
"RTN","BPSOSIZ",29,0)
 ;
"RTN","BPSOSIZ",30,0)
 ; Make sure that the record is not already IN PROGRESS
"RTN","BPSOSIZ",31,0)
 S X=+$$STATUS59^BPSOSRX(IEN59)
"RTN","BPSOSIZ",32,0)
 I X'=0,X'=31,X'=99 D ERROR(IEN59,"STATUS is "_X) Q
"RTN","BPSOSIZ",33,0)
 ;
"RTN","BPSOSIZ",34,0)
 ; Check if the BPS Transaction exists
"RTN","BPSOSIZ",35,0)
 S EXISTS=$$EXIST59(IEN59)
"RTN","BPSOSIZ",36,0)
 ;
"RTN","BPSOSIZ",37,0)
 ; If the record exists, delete all but the essential fields
"RTN","BPSOSIZ",38,0)
 I EXISTS D CLEAR59(IEN59) I $G(BP77)>0 D UPD7759^BPSOSRX4(BP77,IEN59)
"RTN","BPSOSIZ",39,0)
 ;
"RTN","BPSOSIZ",40,0)
 ; If the record does not exist, create new record and validate the IEN
"RTN","BPSOSIZ",41,0)
 I 'EXISTS S X=$$NEW59(IEN59,$G(BP77)) I X'=IEN59 D ERROR(IEN59,"NEW59 returned "_X) Q
"RTN","BPSOSIZ",42,0)
 ;
"RTN","BPSOSIZ",43,0)
 ; Update the fields.  If error is returned, log to the BPS Transaction, which
"RTN","BPSOSIZ",44,0)
 ;   we know exists at this point
"RTN","BPSOSIZ",45,0)
 S ERROR=$$INIT^BPSOSIY(IEN59,$G(BP77))
"RTN","BPSOSIZ",46,0)
 I ERROR D ERROR^BPSOSU($T(+0),IEN59,ERROR,"BPS Transaction not updated"),UNLOCK59(IEN59) Q
"RTN","BPSOSIZ",47,0)
 ;
"RTN","BPSOSIZ",48,0)
 ; Validate the transaction
"RTN","BPSOSIZ",49,0)
 D ONE59^BPSOSQA(IEN59)
"RTN","BPSOSIZ",50,0)
 ;
"RTN","BPSOSIZ",51,0)
 ; Unlock the transaction
"RTN","BPSOSIZ",52,0)
 D UNLOCK59(IEN59)
"RTN","BPSOSIZ",53,0)
 Q
"RTN","BPSOSIZ",54,0)
 ;
"RTN","BPSOSIZ",55,0)
 ; LOCK59 - Lock Transaction
"RTN","BPSOSIZ",56,0)
LOCK59(IEN59) ;
"RTN","BPSOSIZ",57,0)
 D LOG^BPSOSL(IEN59,$T(+0)_"-Lock BPS Transaction")
"RTN","BPSOSIZ",58,0)
 L +^BPST(IEN59):5
"RTN","BPSOSIZ",59,0)
 Q $T
"RTN","BPSOSIZ",60,0)
 ;
"RTN","BPSOSIZ",61,0)
 ; UNLOCK59 - Unlock record
"RTN","BPSOSIZ",62,0)
UNLOCK59(IEN59) ;
"RTN","BPSOSIZ",63,0)
 D LOG^BPSOSL(IEN59,$T(+0)_"-Unlock BPS Transaction")
"RTN","BPSOSIZ",64,0)
 L -^BPST(IEN59)
"RTN","BPSOSIZ",65,0)
 Q
"RTN","BPSOSIZ",66,0)
 ;
"RTN","BPSOSIZ",67,0)
 ; EXISTS - See if the BPS Transaction already exists
"RTN","BPSOSIZ",68,0)
EXIST59(IEN59) ;
"RTN","BPSOSIZ",69,0)
 N X
"RTN","BPSOSIZ",70,0)
 S X=$$FIND1^DIC(9002313.59,,"QX","`"_IEN59)
"RTN","BPSOSIZ",71,0)
 Q $S(X>0:X,X=0:0)
"RTN","BPSOSIZ",72,0)
 ;
"RTN","BPSOSIZ",73,0)
 ; NEW59 - Create a new BPS Transaction record
"RTN","BPSOSIZ",74,0)
 ; IEN59 - BPS TRANSACTION ien
"RTN","BPSOSIZ",75,0)
 ; BP77 - BPS REQUEST file ien
"RTN","BPSOSIZ",76,0)
NEW59(IEN59,BP77) ;
"RTN","BPSOSIZ",77,0)
 ; Initialize variables
"RTN","BPSOSIZ",78,0)
 N FDA,IEN,MSG,FN,BPSTIME,BPCOB
"RTN","BPSOSIZ",79,0)
 ;
"RTN","BPSOSIZ",80,0)
 ; The .01 node and IEN should be the transaction number
"RTN","BPSOSIZ",81,0)
 S FN=9002313.59
"RTN","BPSOSIZ",82,0)
 S (IEN(1),FDA(FN,"+1,",.01))=IEN59
"RTN","BPSOSIZ",83,0)
 ;
"RTN","BPSOSIZ",84,0)
 ; Create the new BPS Transaction record
"RTN","BPSOSIZ",85,0)
 D UPDATE^DIE("","FDA","IEN","MSG")
"RTN","BPSOSIZ",86,0)
 I $D(MSG) Q 0
"RTN","BPSOSIZ",87,0)
 ; check if fields (#16),(#17),(#18) of BPS TRANSACTION are not populated - populate them
"RTN","BPSOSIZ",88,0)
 I $G(BP77)>0 D UPD7759^BPSOSRX4(BP77,IEN59)
"RTN","BPSOSIZ",89,0)
 ; 
"RTN","BPSOSIZ",90,0)
 Q IEN(1)
"RTN","BPSOSIZ",91,0)
 ;
"RTN","BPSOSIZ",92,0)
 ; CLEAR59 - If it exists, clear out the old values
"RTN","BPSOSIZ",93,0)
CLEAR59(IEN59) ;
"RTN","BPSOSIZ",94,0)
 ; Deletes all values except for fields:
"RTN","BPSOSIZ",95,0)
 ;   Entry # (.01)
"RTN","BPSOSIZ",96,0)
 ;   Resubmit after reversal (1.12)
"RTN","BPSOSIZ",97,0)
 ;   Result Text (202)
"RTN","BPSOSIZ",98,0)
 ;   Comments (111 multiple)
"RTN","BPSOSIZ",99,0)
 ; If reverse/resubmit, then also do not clear fields:
"RTN","BPSOSIZ",100,0)
 ;   Status (1)
"RTN","BPSOSIZ",101,0)
 ;   Submit Date/Time (6)
"RTN","BPSOSIZ",102,0)
 ;   Last Update (7)
"RTN","BPSOSIZ",103,0)
 ;   Start Date (15)
"RTN","BPSOSIZ",104,0)
 ;
"RTN","BPSOSIZ",105,0)
 ; Initialize variables
"RTN","BPSOSIZ",106,0)
 N FN,FDA,MSG,FIELD,SKIP,ENTRY
"RTN","BPSOSIZ",107,0)
 S FN=9002313.59
"RTN","BPSOSIZ",108,0)
 ;
"RTN","BPSOSIZ",109,0)
 ; Set up fields that we do not want to delete
"RTN","BPSOSIZ",110,0)
 S SKIP(1.12)="",SKIP(202)=""
"RTN","BPSOSIZ",111,0)
 I $G(MOREDATA("REVERSE THEN RESUBMIT"))=1 S SKIP(1)="",SKIP(6)="",SKIP(7)="",SKIP(15)=""
"RTN","BPSOSIZ",112,0)
 ;
"RTN","BPSOSIZ",113,0)
 ; Start with field .01 so it will not be deleted
"RTN","BPSOSIZ",114,0)
 ; Place 'non-skip' fields in FDA to be deleted
"RTN","BPSOSIZ",115,0)
 S FIELD=.01
"RTN","BPSOSIZ",116,0)
 F  S FIELD=$O(^DD(FN,FIELD)) Q:'FIELD  I '$D(SKIP(FIELD)) S FDA(FN,IEN59_",",FIELD)=""
"RTN","BPSOSIZ",117,0)
 ;
"RTN","BPSOSIZ",118,0)
 ; Delete Insurance multiple
"RTN","BPSOSIZ",119,0)
 S FN=9002313.59902,ENTRY=0
"RTN","BPSOSIZ",120,0)
 F  S ENTRY=$O(^BPST(IEN59,10,ENTRY)) Q:ENTRY="B"!(ENTRY="")  D
"RTN","BPSOSIZ",121,0)
 . S FDA(FN,ENTRY_","_IEN59_",",.01)=""
"RTN","BPSOSIZ",122,0)
 ;
"RTN","BPSOSIZ",123,0)
 ; Delete DUR multiple
"RTN","BPSOSIZ",124,0)
 S FN=9002313.5913,ENTRY=0
"RTN","BPSOSIZ",125,0)
 F  S ENTRY=$O(^BPST(IEN59,13,ENTRY)) Q:+ENTRY=0  D
"RTN","BPSOSIZ",126,0)
 . S FDA(FN,ENTRY_","_IEN59_",",.01)=""
"RTN","BPSOSIZ",127,0)
 ;
"RTN","BPSOSIZ",128,0)
 ; Fileman call to do the delete
"RTN","BPSOSIZ",129,0)
 D FILE^DIE("","FDA","MSG")
"RTN","BPSOSIZ",130,0)
 ;
"RTN","BPSOSIZ",131,0)
 ; Update Result Text File with 'PREVIOUSLY['
"RTN","BPSOSIZ",132,0)
 D PREVISLY(IEN59) ; for result text field 202
"RTN","BPSOSIZ",133,0)
 Q
"RTN","BPSOSIZ",134,0)
 ;
"RTN","BPSOSIZ",135,0)
 ; PREVISLY - Add semicolon in between the result text
"RTN","BPSOSIZ",136,0)
PREVISLY(IEN59) ;EP - BPSOSRB, BPSOSU
"RTN","BPSOSIZ",137,0)
 N X
"RTN","BPSOSIZ",138,0)
 S X=$$GET1^DIQ(9002313.59,IEN59,202)
"RTN","BPSOSIZ",139,0)
 I X="" Q
"RTN","BPSOSIZ",140,0)
 S X=$E(";"_X,1,200)
"RTN","BPSOSIZ",141,0)
 N FN,FDA,MSG
"RTN","BPSOSIZ",142,0)
 S FDA(9002313.59,IEN59_",",202)=X
"RTN","BPSOSIZ",143,0)
 D FILE^DIE("","FDA","MSG")
"RTN","BPSOSIZ",144,0)
 Q
"RTN","BPSOSIZ",145,0)
 ;
"RTN","BPSOSIZ",146,0)
 ; ERROR - Log an error to the log
"RTN","BPSOSIZ",147,0)
ERROR(IEN59,MSG) ;
"RTN","BPSOSIZ",148,0)
 N RX,RXR
"RTN","BPSOSIZ",149,0)
 S RX=$P(IEN59,"."),RXR=+$E($P(IEN59,".",2),1,4)
"RTN","BPSOSIZ",150,0)
 D LOG^BPSOSL(IEN59,$T(+0)_"-Skipping: "_$G(MSG))
"RTN","BPSOSIZ",151,0)
 K ^XTMP("BPSOSRX",RX,RXR)
"RTN","BPSOSIZ",152,0)
 D UNLOCK59(IEN59)
"RTN","BPSOSIZ",153,0)
 Q
"RTN","BPSOSO1")
0^47^B2986345
"RTN","BPSOSO1",1,0)
BPSOSO1 ;BHAM ISC/FCS/DRS - NCPDP Override Main menu ;03/07/08  10:33
"RTN","BPSOSO1",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,7**;JUN 2004;Build 46
"RTN","BPSOSO1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSO1",4,0)
 ;---------------------------------------------------------------
"RTN","BPSOSO1",5,0)
 ; IHS/SD/lwj  9/3/02  NCPDP 5.1 changes
"RTN","BPSOSO1",6,0)
 ; In 3.2, prior authorization was updated and stored in field 416.
"RTN","BPSOSO1",7,0)
 ; In 5.1, 416 is obsolete, and the information could be stored
"RTN","BPSOSO1",8,0)
 ; in field 461, and 462 or in the prior authorization segment.
"RTN","BPSOSO1",9,0)
 ; For now, the insurer/processors appear to be using 461, and
"RTN","BPSOSO1",10,0)
 ; 462 rather than the segment.  In any case, we needed to change
"RTN","BPSOSO1",11,0)
 ; the way we capture prior authorization information - AND - we
"RTN","BPSOSO1",12,0)
 ; have to keep populating 416 since we have to still process 3.2
"RTN","BPSOSO1",13,0)
 ; claims.  This routine was changed to call PRIORA in BPSOSo2
"RTN","BPSOSO1",14,0)
 ; rather than EDIT^BPSOSO2 when we are processing a prior auth.
"RTN","BPSOSO1",15,0)
 ;(Field prompts also altered to match 5.1 standards.)
"RTN","BPSOSO1",16,0)
 ;---------------------------------------------------------------
"RTN","BPSOSO1",17,0)
 Q
"RTN","BPSOSO1",18,0)
TEST D MENU("") Q
"RTN","BPSOSO1",19,0)
MENU(IEN)          ;EP -
"RTN","BPSOSO1",20,0)
 D SETLIST
"RTN","BPSOSO1",21,0)
 N PROMPT S PROMPT(1)="Select which claim data you wish to override."
"RTN","BPSOSO1",22,0)
 S PROMPT(2)="Use   ^   to exit this menu."
"RTN","BPSOSO1",23,0)
 N SEL F  D  Q:'SEL  Q:SEL=-1
"RTN","BPSOSO1",24,0)
 . S SEL=$$LIST^BPSOSU4("S",$$LISTROOT,$$ANSROOT,"Override Claim Defaults",.PROMPT,1,20,$S($G(DTOUT):DTOUT,1:300))
"RTN","BPSOSO1",25,0)
 . I SEL W ! H 1 D @$P($T(LIST+SEL),";",4) ;
"RTN","BPSOSO1",26,0)
 Q
"RTN","BPSOSO1",27,0)
LISTROOT()         Q "^TMP("""_$T(+0)_""","_$J_","
"RTN","BPSOSO1",28,0)
ANSROOT()          Q "^TMP("""_$T(+0)_""","_($J+.1)_","
"RTN","BPSOSO1",29,0)
SETLIST K ^TMP("BPSOSO1",$J),^TMP("BPSOSO1",$J+.1)
"RTN","BPSOSO1",30,0)
 N I,X F I=1:1 D  Q:X="*"
"RTN","BPSOSO1",31,0)
 . S X=$T(LIST+I),X=$P(X,";",2,$L(X)) Q:X="*"
"RTN","BPSOSO1",32,0)
 . S ^TMP("BPSOSO1",$J,I,"I")=$P(X,";")
"RTN","BPSOSO1",33,0)
 . S ^TMP("BPSOSO1",$J,I,"E")=$P(X,";",2)
"RTN","BPSOSO1",34,0)
 S ^TMP("BPSOSO1",$J,0)=I-1
"RTN","BPSOSO1",35,0)
 Q
"RTN","BPSOSO1",36,0)
 ;
"RTN","BPSOSO1",37,0)
 ; IHS/SD/lwj 9/3/02 - the following 3 lines were removed from LIST -
"RTN","BPSOSO1",38,0)
 ; new 1 - 3 lines were added to replace them
"RTN","BPSOSO1",39,0)
 ;1;Preauthorization #;EDIT^BPSOSO2(IEN,416)
"RTN","BPSOSO1",40,0)
 ;2;Person Code;EDIT^BPSOSO2(IEN,303)
"RTN","BPSOSO1",41,0)
 ;3;Relationship Code;EDIT^BPSOSO2(IEN,306)
"RTN","BPSOSO1",42,0)
 ;
"RTN","BPSOSO1",43,0)
 ; IHS/SD/lwj 9/3/02 - since still unimplemented, the following
"RTN","BPSOSO1",44,0)
 ; lines were removed from the menu options in LIST
"RTN","BPSOSO1",45,0)
 ;I;Order of insurance;NOTIMP
"RTN","BPSOSO1",46,0)
 ;P;Pricing;NOTIMP
"RTN","BPSOSO1",47,0)
 ;
"RTN","BPSOSO1",48,0)
LIST ;
"RTN","BPSOSO1",49,0)
 ;1;Prior Authorization;PRIORA^BPSOSO2(IEN)  ;IHS/SD/lwj 9/3/02
"RTN","BPSOSO1",50,0)
 ;2;Patient Gender Code;EDIT^BPSOSO2(IEN,303)
"RTN","BPSOSO1",51,0)
 ;3;Patient Relationship Code;EDIT^BPSOSO2(IEN,306)
"RTN","BPSOSO1",52,0)
 ;4;Eligibility Clarification Code;EDIT^BPSOSO2(IEN,309)
"RTN","BPSOSO1",53,0)
 ;*;Enter/edit/override any NCPDP field;EDIT^BPSOSO2(IEN)
"RTN","BPSOSO1",54,0)
 ;*
"RTN","BPSOSO1",55,0)
NOTIMP W !,"That option isn't yet implemented.",! N % R %:3 Q
"RTN","BPSOSQ2")
0^75^B18999575
"RTN","BPSOSQ2",1,0)
BPSOSQ2 ;BHAM ISC/FCS/DRS/DLF - form transmission packets ;06/01/2004
"RTN","BPSOSQ2",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5,7**;JUN 2004;Build 46
"RTN","BPSOSQ2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSQ2",4,0)
 ; Construct packets for transmission
"RTN","BPSOSQ2",5,0)
 Q
"RTN","BPSOSQ2",6,0)
 ;
"RTN","BPSOSQ2",7,0)
PACKETS ; EP - Tasked by BPSOSQA
"RTN","BPSOSQ2",8,0)
 ;
"RTN","BPSOSQ2",9,0)
 ; Initialize
"RTN","BPSOSQ2",10,0)
 N ERROR,RXILIST,STATUS
"RTN","BPSOSQ2",11,0)
 ;
"RTN","BPSOSQ2",12,0)
 ; First handle insurer alseep transactions
"RTN","BPSOSQ2",13,0)
 D STATUS31^BPSOSQF
"RTN","BPSOSQ2",14,0)
 ;
"RTN","BPSOSQ2",15,0)
 ; Handle claims that need the packet to be built
"RTN","BPSOSQ2",16,0)
 I $D(^BPST("AD",30)) D STATUS30
"RTN","BPSOSQ2",17,0)
 ;
"RTN","BPSOSQ2",18,0)
 ; If there are still any claims with status 30 (perhaps due to failed
"RTN","BPSOSQ2",19,0)
 ;   LOCK59), queue up BPSOSQ2 to run again
"RTN","BPSOSQ2",20,0)
 I $O(^BPST("AD",30,0)) H 60 D TASK^BPSOSQA
"RTN","BPSOSQ2",21,0)
 Q
"RTN","BPSOSQ2",22,0)
 ;
"RTN","BPSOSQ2",23,0)
 ; Walk through claims at 30%, bundle, and create the claim
"RTN","BPSOSQ2",24,0)
STATUS30 ;
"RTN","BPSOSQ2",25,0)
 N IEN59
"RTN","BPSOSQ2",26,0)
 S IEN59=""
"RTN","BPSOSQ2",27,0)
 I '$$LOCK59(30) Q
"RTN","BPSOSQ2",28,0)
 ;
"RTN","BPSOSQ2",29,0)
 ; Loop though claims at 30%, bundle with other 30% claims, and process
"RTN","BPSOSQ2",30,0)
 F  S IEN59=$$NEXT59(IEN59,30) Q:IEN59=""  D
"RTN","BPSOSQ2",31,0)
 . ; Intialize the list
"RTN","BPSOSQ2",32,0)
 . K RXILIST
"RTN","BPSOSQ2",33,0)
 . S RXILIST(IEN59)=""
"RTN","BPSOSQ2",34,0)
 . ;
"RTN","BPSOSQ2",35,0)
 . ; Update the status to 40 (Building the packet)
"RTN","BPSOSQ2",36,0)
 . D SETSTAT^BPSOSU(IEN59,40)
"RTN","BPSOSQ2",37,0)
 . ;
"RTN","BPSOSQ2",38,0)
 . ; If reversal, only one claim per packet
"RTN","BPSOSQ2",39,0)
 . I $G(^BPST(IEN59,4)) G POINTX
"RTN","BPSOSQ2",40,0)
 . ;
"RTN","BPSOSQ2",41,0)
 . ; If prior auth are entered, only one claim per packet
"RTN","BPSOSQ2",42,0)
 . G:$$CHKPA() POINTX
"RTN","BPSOSQ2",43,0)
 . ;
"RTN","BPSOSQ2",44,0)
 . ; Code below is for bundling claims.  The VA is not doing this
"RTN","BPSOSQ2",45,0)
 . ; so we are skipping it.  However, the code is left here in
"RTN","BPSOSQ2",46,0)
 . ; case we do bundling in the future.  If so, the code will need to be
"RTN","BPSOSQ2",47,0)
 . ; rewritten to look at the corect fields.
"RTN","BPSOSQ2",48,0)
 . G POINTX
"RTN","BPSOSQ2",49,0)
 . ;
"RTN","BPSOSQ2",50,0)
 . N RA0,RA1 S RA0=^BPST(IEN59,0),RA1=^(1)
"RTN","BPSOSQ2",51,0)
 . N IEN59 S IEN59="" ; preserve the top-level index!
"RTN","BPSOSQ2",52,0)
 . F  S IEN59=$$NEXT59(IEN59,30) Q:'IEN59  D
"RTN","BPSOSQ2",53,0)
 .. N RB0,RB1 S RB0=^BPST(IEN59,0),RB1=^(1)
"RTN","BPSOSQ2",54,0)
 .. ; Only bundle when you have the same:
"RTN","BPSOSQ2",55,0)
 .. ; Patient, Visit, Division, Division Source, Insurer, Pharmacy
"RTN","BPSOSQ2",56,0)
 .. I $P(RA0,U,6,7)'=$P(RB0,U,6,7) Q
"RTN","BPSOSQ2",57,0)
 .. I $P(RA1,U,4,7)'=$P(RB1,U,4,7) Q
"RTN","BPSOSQ2",58,0)
 .. I $P(RB0,U,2)'=30 Q  ; might have been canceled, or maybe 31'd
"RTN","BPSOSQ2",59,0)
 .. D SETSTAT^BPSOSU(IEN59,40)
"RTN","BPSOSQ2",60,0)
 .. S RXILIST(IEN59)=""
"RTN","BPSOSQ2",61,0)
POINTX . ; Reversals and prior auth claims branch to here to bypass multi-claim packeting
"RTN","BPSOSQ2",62,0)
 . ;
"RTN","BPSOSQ2",63,0)
 . ; BPSOSQG will build the claim data, create the packet, and send to HL7
"RTN","BPSOSQ2",64,0)
 . S ERROR=$$PACKET^BPSOSQG
"RTN","BPSOSQ2",65,0)
 . ;
"RTN","BPSOSQ2",66,0)
 . ; If an error is returned, log the error to each transaction
"RTN","BPSOSQ2",67,0)
 . I ERROR S IEN59="" F  S IEN59=$O(RXILIST(IEN59)) Q:IEN59=""  D
"RTN","BPSOSQ2",68,0)
 .. D ERROR^BPSOSU($T(+0),IEN59,$P(ERROR,U),$P(ERROR,U,2,$L(ERROR,U)))
"RTN","BPSOSQ2",69,0)
 D UNLOCK59(30)
"RTN","BPSOSQ2",70,0)
 Q
"RTN","BPSOSQ2",71,0)
 ;
"RTN","BPSOSQ2",72,0)
NEXT59(IEN59,STATUS) ;EP - BPSOSQF
"RTN","BPSOSQ2",73,0)
 N GRPLAN,PAYSH,PAYSHNM,RETRY,BPASLEEP,BPAIEN,PROBER,BPSIEN77
"RTN","BPSOSQ2",74,0)
N59A ;
"RTN","BPSOSQ2",75,0)
 ; Get next transaction for the given status
"RTN","BPSOSQ2",76,0)
 S IEN59=$O(^BPST("AD",STATUS,IEN59))
"RTN","BPSOSQ2",77,0)
 I IEN59="" Q IEN59  ; end of list, return ""
"RTN","BPSOSQ2",78,0)
 ;
"RTN","BPSOSQ2",79,0)
 ;
"RTN","BPSOSQ2",80,0)
 ; Get the BPS REQUEST
"RTN","BPSOSQ2",81,0)
 S BPSIEN77=+$P($G(^BPST(IEN59,0)),U,12)
"RTN","BPSOSQ2",82,0)
 ;
"RTN","BPSOSQ2",83,0)
 ; Get the GROUP INSURANCE PLAN
"RTN","BPSOSQ2",84,0)
 S GRPLAN=$$GETPLN59^BPSUTIL2(IEN59)
"RTN","BPSOSQ2",85,0)
 ;
"RTN","BPSOSQ2",86,0)
 ; If the GROUP INSURANCE PLAN isn't asleep or if the IGNORE ASLEEP flag
"RTN","BPSOSQ2",87,0)
 ; is set then return this transaction
"RTN","BPSOSQ2",88,0)
 I '$$ISASLEEP^BPSOSQF(+$G(GRPLAN)) Q IEN59
"RTN","BPSOSQ2",89,0)
 ;
"RTN","BPSOSQ2",90,0)
 ; Insurer is asleep -
"RTN","BPSOSQ2",91,0)
 S BPASLEEP=+$G(^BPST(IEN59,8))
"RTN","BPSOSQ2",92,0)
 S BPAIEN=$O(^BPS(9002313.15,"B",+$G(GRPLAN),0))
"RTN","BPSOSQ2",93,0)
 ; Get Retry Time
"RTN","BPSOSQ2",94,0)
 S RETRY=$$GET1^DIQ(9002313.15,BPAIEN_",",.05,"I")
"RTN","BPSOSQ2",95,0)
 ; If time to retry AND this is the transaction for the Prober claim
"RTN","BPSOSQ2",96,0)
 ; return this transaction for processing
"RTN","BPSOSQ2",97,0)
 I RETRY'>$$NOW,BPSIEN77>0,BPSIEN77=$$PROBER^BPSOSQF(+$G(GRPLAN)) Q IEN59
"RTN","BPSOSQ2",98,0)
 ;
"RTN","BPSOSQ2",99,0)
 ; If necessary, update the .59's record with BPS ASLEEP PAYER
"RTN","BPSOSQ2",100,0)
 I BPASLEEP'=BPAIEN D
"RTN","BPSOSQ2",101,0)
 . S DA=IEN59,DIE=9002313.59,DR="801////^S X=BPAIEN" D ^DIE
"RTN","BPSOSQ2",102,0)
 . D SETSTAT^BPSOSU(IEN59,31) ; force screen update, too
"RTN","BPSOSQ2",103,0)
 . D LOG^BPSOSL(IEN59,$T(+0)_"-Insurer asleep - Waiting for Prober Request "_$$PROBER^BPSOSQF(+$G(GRPLAN))_" to complete")
"RTN","BPSOSQ2",104,0)
 ;
"RTN","BPSOSQ2",105,0)
 ; If we are checking status 30, convert to insurer asleep
"RTN","BPSOSQ2",106,0)
 I STATUS=30 D SETSTAT^BPSOSU(IEN59,31)
"RTN","BPSOSQ2",107,0)
 ;
"RTN","BPSOSQ2",108,0)
 ; Still asleep, go to next transaction
"RTN","BPSOSQ2",109,0)
 G N59A
"RTN","BPSOSQ2",110,0)
 ;
"RTN","BPSOSQ2",111,0)
 ;
"RTN","BPSOSQ2",112,0)
LOCK59(STATUS) ;EP - BPSOSQF
"RTN","BPSOSQ2",113,0)
 L +^BPST("AD",STATUS):60
"RTN","BPSOSQ2",114,0)
 Q $T
"RTN","BPSOSQ2",115,0)
 ;
"RTN","BPSOSQ2",116,0)
UNLOCK59(STATUS) ;EP - BPSOSQF
"RTN","BPSOSQ2",117,0)
 L -^BPST("AD",STATUS)
"RTN","BPSOSQ2",118,0)
 Q
"RTN","BPSOSQ2",119,0)
 ;
"RTN","BPSOSQ2",120,0)
CHKPA() ;
"RTN","BPSOSQ2",121,0)
 N PATYP,PANUM,PACLM
"RTN","BPSOSQ2",122,0)
 S PACLM=0
"RTN","BPSOSQ2",123,0)
 ;
"RTN","BPSOSQ2",124,0)
 S PATYP=$P($G(^BPST(IEN59,1)),U,15)    ;prior auth type code
"RTN","BPSOSQ2",125,0)
 S PANUM=$P($G(^BPST(IEN59,1)),U,9)     ;prior auth number
"RTN","BPSOSQ2",126,0)
 I ($G(PATYP)'="")!($G(PANUM)'="") S PACLM=1
"RTN","BPSOSQ2",127,0)
 ;
"RTN","BPSOSQ2",128,0)
 Q PACLM
"RTN","BPSOSQ2",129,0)
 ;
"RTN","BPSOSQ2",130,0)
NOW() N %,%H,%I,X D NOW^%DTC Q %
"RTN","BPSOSQ4")
0^29^B46598620
"RTN","BPSOSQ4",1,0)
BPSOSQ4 ;BHAM ISC/FCS/DRS/DLF - Process responses ;12/7/07  15:48
"RTN","BPSOSQ4",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5,7**;JUN 2004;Build 46
"RTN","BPSOSQ4",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSQ4",4,0)
 ;
"RTN","BPSOSQ4",5,0)
 ; This routine has two components
"RTN","BPSOSQ4",6,0)
 ;   Procedures to report Response info
"RTN","BPSOSQ4",7,0)
 ;   Procedures to handle insurer asleep functions
"RTN","BPSOSQ4",8,0)
 Q
"RTN","BPSOSQ4",9,0)
 ;
"RTN","BPSOSQ4",10,0)
 ; The following are separate little utilities called from elsewhere.
"RTN","BPSOSQ4",11,0)
 ;
"RTN","BPSOSQ4",12,0)
PAID(IEN59) ;quick query to see if it's paid
"RTN","BPSOSQ4",13,0)
 N TMP D RESPINFO(IEN59,.TMP) Q:'$D(TMP("RSP")) 0
"RTN","BPSOSQ4",14,0)
 N X S X=TMP("RSP")
"RTN","BPSOSQ4",15,0)
 I X="Payable" Q 1
"RTN","BPSOSQ4",16,0)
 Q 0
"RTN","BPSOSQ4",17,0)
RESPINFO(RXI,DST) ;EP - BPSOS6M
"RTN","BPSOSQ4",18,0)
 ; quick way to get all the response info for a given RXI
"RTN","BPSOSQ4",19,0)
 ; IMPORTANT!!  Do not change spelling, case, wording, or spacing!!!
"RTN","BPSOSQ4",20,0)
 ; If a reversal was attempted, it complicates things.
"RTN","BPSOSQ4",21,0)
 ;  fills DST array as follows:
"RTN","BPSOSQ4",22,0)
 ; DST("HDR")=Response Status (header)
"RTN","BPSOSQ4",23,0)
 ; DST("RSP")=Response Status (prescription)
"RTN","BPSOSQ4",24,0)
 ;   This could be:  "Payable"  "Rejected"  "Captured"  "Duplicate"
"RTN","BPSOSQ4",25,0)
 ;   or  "Accepted reversal"  or  "Rejected reversal"
"RTN","BPSOSQ4",26,0)
 ;   or  "null"   or "null reversal"  (no response or corrupt response
"RTN","BPSOSQ4",27,0)
 ;    or maybe someone without insurance, so no request was sent)
"RTN","BPSOSQ4",28,0)
 ; DST("REJ",0)=count of reject codes
"RTN","BPSOSQ4",29,0)
 ; DST("REJ",n)=each reject code
"RTN","BPSOSQ4",30,0)
 ; DST("MSG")=message with the response
"RTN","BPSOSQ4",31,0)
 ; All of these are defined, even if originals were '$D.
"RTN","BPSOSQ4",32,0)
 ; The external forms are returned.
"RTN","BPSOSQ4",33,0)
 N REVERSAL S REVERSAL=$G(^BPST(RXI,4))>0
"RTN","BPSOSQ4",34,0)
 N RESP
"RTN","BPSOSQ4",35,0)
 I 'REVERSAL S RESP=$P(^BPST(RXI,0),U,5)
"RTN","BPSOSQ4",36,0)
 E  S RESP=$P(^BPST(RXI,4),U,2)
"RTN","BPSOSQ4",37,0)
 I 'RESP Q
"RTN","BPSOSQ4",38,0)
 N ECME S POS=$P(^BPST(RXI,0),U,9) Q:'POS
"RTN","BPSOSQ4",39,0)
 N FMT S FMT="E"
"RTN","BPSOSQ4",40,0)
 S DST("HDR")=$$RESP500(RESP,FMT)
"RTN","BPSOSQ4",41,0)
 S DST("RSP")=$$RESP1000(RESP,POS,FMT)
"RTN","BPSOSQ4",42,0)
 S DST("REJ",0)=$$REJCOUNT(RESP,POS,FMT)
"RTN","BPSOSQ4",43,0)
 I DST("REJ",0) D
"RTN","BPSOSQ4",44,0)
 . N I F I=1:1:DST("REJ",0) S DST("REJ",I)=$$REJCODE(RESP,POS,I,FMT)
"RTN","BPSOSQ4",45,0)
 S DST("MSG")=$$RESPMSG(RESP,POS,FMT)
"RTN","BPSOSQ4",46,0)
 ; Dealing with oddities of PCS (and others'?) response to reversals
"RTN","BPSOSQ4",47,0)
 I REVERSAL,DST("RSP")["null" D
"RTN","BPSOSQ4",48,0)
 . I DST("RSP")["null" S DST("RSP")=DST("HDR")_" reversal"
"RTN","BPSOSQ4",49,0)
 Q
"RTN","BPSOSQ4",50,0)
 ; In the following quickies:
"RTN","BPSOSQ4",51,0)
 ; RESP = RESPIEN, pointer to 9002313.03
"RTN","BPSOSQ4",52,0)
 ; FMT = "I" for internal, "E" for external, defaults to internal
"RTN","BPSOSQ4",53,0)
RESP500(RESP,FMT) ;EP - BPSOS57,BPSOSUC
"RTN","BPSOSQ4",54,0)
 ; returns the response header status
"RTN","BPSOSQ4",55,0)
 N X S X=$P($G(^BPSR(RESP,500)),U)
"RTN","BPSOSQ4",56,0)
 I $G(FMT)'="E" Q X
"RTN","BPSOSQ4",57,0)
 I X="" S X="null"
"RTN","BPSOSQ4",58,0)
 S X=$S(X="A":"Accepted",X="R":"Rejected",1:"?"_X)
"RTN","BPSOSQ4",59,0)
 Q X
"RTN","BPSOSQ4",60,0)
RESP1000(RESP,POS,FMT) ;EP - BPSOSUC
"RTN","BPSOSQ4",61,0)
 ; returns the prescription response status
"RTN","BPSOSQ4",62,0)
 ; Note!  Could be DP or DC for duplicates
"RTN","BPSOSQ4",63,0)
 N X S X=$P($G(^BPSR(RESP,1000,POS,500)),U)
"RTN","BPSOSQ4",64,0)
 I $G(FMT)'="E" Q X
"RTN","BPSOSQ4",65,0)
 I X="" S X="null"
"RTN","BPSOSQ4",66,0)
 ;
"RTN","BPSOSQ4",67,0)
 ;IHS/SD/lwj 10/07/02 NCPDP 5.1 changes - they will send an "A" back
"RTN","BPSOSQ4",68,0)
 ; now on the transaction level to indicate that it has been accepted
"RTN","BPSOSQ4",69,0)
 ; Next code line remarked out - following added
"RTN","BPSOSQ4",70,0)
 ;
"RTN","BPSOSQ4",71,0)
 S X=$S(X="A":"Accepted",X="P":"Payable",X="R":"Rejected",X="C":"Captured",X="D"!(X="DP")!(X="DC"):"Duplicate",1:"?"_X)
"RTN","BPSOSQ4",72,0)
 Q X
"RTN","BPSOSQ4",73,0)
 ;
"RTN","BPSOSQ4",74,0)
REJCOUNT(RESP,POS,FMT) ; returns rejection count
"RTN","BPSOSQ4",75,0)
 Q +$P($G(^BPSR(RESP,1000,POS,511,0)),U,3)
"RTN","BPSOSQ4",76,0)
 ;
"RTN","BPSOSQ4",77,0)
REJCODE(RESP,POS,N,FMT) ; returns Nth rejection code
"RTN","BPSOSQ4",78,0)
 ; if FMT="E", returns code:text
"RTN","BPSOSQ4",79,0)
 N CODE S CODE=$P($G(^BPSR(RESP,1000,POS,511,N,0)),U)
"RTN","BPSOSQ4",80,0)
 I CODE="" S CODE="null"
"RTN","BPSOSQ4",81,0)
 I FMT'="E" Q CODE
"RTN","BPSOSQ4",82,0)
 N X S X=$O(^BPSF(9002313.93,"B",CODE,0))
"RTN","BPSOSQ4",83,0)
 I X]"" S CODE=CODE_":"_$P($G(^BPSF(9002313.93,X,0)),U,2)
"RTN","BPSOSQ4",84,0)
 E  S CODE="?"_CODE
"RTN","BPSOSQ4",85,0)
 Q CODE
"RTN","BPSOSQ4",86,0)
 ;
"RTN","BPSOSQ4",87,0)
 ; NCPDP 5.1 changes - message may not come back in 504.  They may
"RTN","BPSOSQ4",88,0)
 ;  come back in 526 instead
"RTN","BPSOSQ4",89,0)
RESPMSG(RESP,POS,FMT) ; response message - additional text from insurer
"RTN","BPSOSQ4",90,0)
 ;
"RTN","BPSOSQ4",91,0)
 N MSG
"RTN","BPSOSQ4",92,0)
 S MSG=""
"RTN","BPSOSQ4",93,0)
 S MSG=$G(^BPSR(RESP,504))
"RTN","BPSOSQ4",94,0)
 S:MSG="" MSG=$G(^BPSR(RESP,1000,POS,504))
"RTN","BPSOSQ4",95,0)
 S:MSG="" MSG=$G(^BPSR(RESP,1000,POS,526))
"RTN","BPSOSQ4",96,0)
 Q MSG
"RTN","BPSOSQ4",97,0)
 ;
"RTN","BPSOSQ4",98,0)
 ;
"RTN","BPSOSQ4",99,0)
NOW() ;
"RTN","BPSOSQ4",100,0)
 Q $$NOW^XLFDT
"RTN","BPSOSQ4",101,0)
 ;
"RTN","BPSOSQ4",102,0)
 ; The xxxSLEEP functions are called from BPSOSQL
"RTN","BPSOSQ4",103,0)
 ;
"RTN","BPSOSQ4",104,0)
REJSLEEP(BPSRESP,BPSPOS,IEN59) ;
"RTN","BPSOSQ4",105,0)
 ;
"RTN","BPSOSQ4",106,0)
 ; - Check if the insurer should be asleep
"RTN","BPSOSQ4",107,0)
 ;   based on the reject codes
"RTN","BPSOSQ4",108,0)
 ; Input
"RTN","BPSOSQ4",109,0)
 ;   BPSRESP - BPS Response IEN
"RTN","BPSOSQ4",110,0)
 ;   BPSPOS  - Multiple IEN
"RTN","BPSOSQ4",111,0)
 ;   IEN59   - BPS TRANSACTION IEN
"RTN","BPSOSQ4",112,0)
 ; Return
"RTN","BPSOSQ4",113,0)
 ;   1 if the insurer should go to sleep
"RTN","BPSOSQ4",114,0)
 ;   0 if the insurer should not go to sleep
"RTN","BPSOSQ4",115,0)
 ;
"RTN","BPSOSQ4",116,0)
 N BPSSITE,BPSSLEEP,BPSI,BPSPLAN,BPAIEN,BPSRET
"RTN","BPSOSQ4",117,0)
 ;
"RTN","BPSOSQ4",118,0)
 ; Validate parameters
"RTN","BPSOSQ4",119,0)
 I '$G(BPSRESP) Q 0
"RTN","BPSOSQ4",120,0)
 I '$G(BPSPOS) Q 0
"RTN","BPSOSQ4",121,0)
 ;
"RTN","BPSOSQ4",122,0)
 ; Check site params to see if disabled
"RTN","BPSOSQ4",123,0)
 S BPSSITE=$G(^BPS(9002313.99,1,0))
"RTN","BPSOSQ4",124,0)
 I '$P(BPSSITE,"^",5)!('$P(BPSSITE,"^",6)) Q 0
"RTN","BPSOSQ4",125,0)
 ;
"RTN","BPSOSQ4",126,0)
 ; Find the Group Insurance Plan from the Submit Request
"RTN","BPSOSQ4",127,0)
 S BPSPLAN=$$GETPLN77^BPSUTIL2(+$P($G(^BPST(IEN59,0)),U,12)) I 'BPSPLAN Q 0
"RTN","BPSOSQ4",128,0)
 ;
"RTN","BPSOSQ4",129,0)
 ; Is this a reject code to consider?
"RTN","BPSOSQ4",130,0)
 S BPSRET=0 F BPSI=90,91,92,95,96,97,98 D  Q:BPSRET
"RTN","BPSOSQ4",131,0)
 . I $D(^BPSR(BPSRESP,1000,BPSPOS,511,"B",BPSI)) S BPSRET=1
"RTN","BPSOSQ4",132,0)
 ;
"RTN","BPSOSQ4",133,0)
 ; Make sure reject 88 (DUR) or 79 (Refill Too Soon) doesn't exist (it shouldn't)
"RTN","BPSOSQ4",134,0)
 I $D(^BPSR(BPSRESP,1000,BPSPOS,511,"B",88)) S BPSRET=0
"RTN","BPSOSQ4",135,0)
 I $D(^BPSR(BPSRESP,1000,BPSPOS,511,"B",79)) S BPSRET=0
"RTN","BPSOSQ4",136,0)
 ;
"RTN","BPSOSQ4",137,0)
 ; Check to Ignore Asleep
"RTN","BPSOSQ4",138,0)
 I BPSRET,$$IGNORE^BPSOSQF(+BPSPLAN) S BPSRET=0
"RTN","BPSOSQ4",139,0)
 ;
"RTN","BPSOSQ4",140,0)
 Q BPSRET
"RTN","BPSOSQ4",141,0)
 ;
"RTN","BPSOSQ4",142,0)
ADDSLEEP(BPSIEN59) ;
"RTN","BPSOSQ4",143,0)
 ; Adds a payer (if not already there) to the Asleep file
"RTN","BPSOSQ4",144,0)
 ;     BPSIEN59 - BPS TRANSACTION IEN
"RTN","BPSOSQ4",145,0)
 ;
"RTN","BPSOSQ4",146,0)
 N BPSPLAN,DIC,X,Y,DO,DTOUT,DUOUT,BPSIEN77
"RTN","BPSOSQ4",147,0)
 ;
"RTN","BPSOSQ4",148,0)
 ; Get BPS Request entry for Prober
"RTN","BPSOSQ4",149,0)
 S BPSIEN77=+$P($G(^BPST(BPSIEN59,0)),U,12)
"RTN","BPSOSQ4",150,0)
 ;
"RTN","BPSOSQ4",151,0)
 ; Find the Group Insurance Plan
"RTN","BPSOSQ4",152,0)
 S BPSPLAN=$$GETPLN77^BPSUTIL2(BPSIEN77) I 'BPSPLAN Q 0
"RTN","BPSOSQ4",153,0)
 ;
"RTN","BPSOSQ4",154,0)
 ; If already in file quit
"RTN","BPSOSQ4",155,0)
 I $D(^BPS(9002313.15,"B",+BPSPLAN)) Q 0
"RTN","BPSOSQ4",156,0)
 ;
"RTN","BPSOSQ4",157,0)
 S DIC=9002313.15,DIC(0)="",X=+BPSPLAN
"RTN","BPSOSQ4",158,0)
 S DIC("DR")=".02///0;.03///0;.04////^S X=BPSIEN77"
"RTN","BPSOSQ4",159,0)
 D FILE^DICN
"RTN","BPSOSQ4",160,0)
 ;
"RTN","BPSOSQ4",161,0)
 Q Y
"RTN","BPSOSQ4",162,0)
 ;
"RTN","BPSOSQ4",163,0)
INCSLEEP(BPSIEN59) ; called from BPSOSQL
"RTN","BPSOSQ4",164,0)
 ; INCSLEEP - Increment sleep time for this insurer
"RTN","BPSOSQ4",165,0)
 ; Input
"RTN","BPSOSQ4",166,0)
 ;   BPSIEN59 - BPS TRANSACTION IEN
"RTN","BPSOSQ4",167,0)
 ; Return the scheduled retry time
"RTN","BPSOSQ4",168,0)
 ;
"RTN","BPSOSQ4",169,0)
 N BPSPLAN,BPSIEN15,BPS15Z,BPSPARAM,BPSRETRY,BPSIEN77,BPERRMSG
"RTN","BPSOSQ4",170,0)
 ;
"RTN","BPSOSQ4",171,0)
 S BPERRMSG="Cannot populate in BPS REQUEST, field#: "
"RTN","BPSOSQ4",172,0)
 ; Get BPS Request entry for Prober
"RTN","BPSOSQ4",173,0)
 S BPSIEN77=+$P($G(^BPST(BPSIEN59,0)),U,12)
"RTN","BPSOSQ4",174,0)
 ; Get GROUP INSURANCE PLAN
"RTN","BPSOSQ4",175,0)
 S BPSPLAN=$$GETPLN59^BPSUTIL2(BPSIEN59) I 'BPSPLAN Q 0
"RTN","BPSOSQ4",176,0)
 ; Get BPS PARAMETERS
"RTN","BPSOSQ4",177,0)
 S BPSPARAM=^BPS(9002313.99,1,0)
"RTN","BPSOSQ4",178,0)
 ;
"RTN","BPSOSQ4",179,0)
 ; If the payer is not already asleep, add it to the BPS ASLEEP PAYERS file
"RTN","BPSOSQ4",180,0)
 S BPSIEN15=$O(^BPS(9002313.15,"B",+BPSPLAN,0)) I 'BPSIEN15 S BPSIEN15=+$$ADDSLEEP(BPSIEN59)
"RTN","BPSOSQ4",181,0)
 I BPSIEN15<1 Q 0
"RTN","BPSOSQ4",182,0)
 ; If the BPS TRANSACTION is not already pointing to the asleep payer, update it
"RTN","BPSOSQ4",183,0)
 I '$D(^BPST("ASL",BPSIEN15,BPSIEN59)) D
"RTN","BPSOSQ4",184,0)
 . S DA=BPSIEN59,DIE=9002313.59,DR="801////^S X=BPSIEN15" D ^DIE
"RTN","BPSOSQ4",185,0)
 ;
"RTN","BPSOSQ4",186,0)
 S BPS15Z=^BPS(9002313.15,BPSIEN15,0)
"RTN","BPSOSQ4",187,0)
 ; If maximum retries reached, flag to ignore and set status to complete.
"RTN","BPSOSQ4",188,0)
 I $P(BPS15Z,"^",2)+1>$P(BPSPARAM,"^",6) D  Q 0
"RTN","BPSOSQ4",189,0)
 . I $$FILLFLDS^BPSUTIL2(9002313.15,".03",BPSIEN15,1)<1 Q
"RTN","BPSOSQ4",190,0)
 . D LOG^BPSOSL(BPSIEN59,$T(+0)_"Maximum retries reached for insurer. Completing BPS TRANSACTION: "_BPSIEN59)
"RTN","BPSOSQ4",191,0)
 . D SETSTAT^BPSOSU(BPSIEN59,99)
"RTN","BPSOSQ4",192,0)
 ;
"RTN","BPSOSQ4",193,0)
 ; Set RETRY TIME based on site parameters
"RTN","BPSOSQ4",194,0)
 S BPSRETRY=$$FMADD^XLFDT($$NOW^XLFDT,,,$P(BPSPARAM,"^",5),10) ; add 10 seconds
"RTN","BPSOSQ4",195,0)
 ; Increment the RETRY COUNT and RETRY TIME
"RTN","BPSOSQ4",196,0)
 I $$FILLFLDS^BPSUTIL2(9002313.15,".02",BPSIEN15,$P(BPS15Z,U,2)+1)<1 Q 0
"RTN","BPSOSQ4",197,0)
 I $$FILLFLDS^BPSUTIL2(9002313.15,".05",BPSIEN15,BPSRETRY)<1 Q 0
"RTN","BPSOSQ4",198,0)
 ;S DIE=9002313.15,DA=BPSIEN15,DR=".02////^S X=$P(BPS15Z,U,2)+1;.05///^S X=BPSRETRY" D ^DIE
"RTN","BPSOSQ4",199,0)
 ; Update BPS REQUEST to ACTIVATED with the DON'T PROCESS UNTIL field set to retry time.
"RTN","BPSOSQ4",200,0)
 I $$FILLFLDS^BPSUTIL2(9002313.77,".08",BPSIEN77,BPSRETRY)<1 Q "0^"_BPERRMSG_".08"
"RTN","BPSOSQ4",201,0)
 I $$FILLFLDS^BPSUTIL2(9002313.77,".04",BPSIEN77,1)<1 Q "0^"_BPERRMSG_".04"
"RTN","BPSOSQ4",202,0)
 N BPZ S BPZ=$$UPUSRTIM^BPSOSRX6(BPSIEN77,$S($G(DUZ):+DUZ,1:.5)) Q:+BPZ=0 BPZ
"RTN","BPSOSQ4",203,0)
 ; queue prober based on site params
"RTN","BPSOSQ4",204,0)
 D TASK(BPSRETRY)
"RTN","BPSOSQ4",205,0)
 ;
"RTN","BPSOSQ4",206,0)
 Q BPSRETRY
"RTN","BPSOSQ4",207,0)
 ;
"RTN","BPSOSQ4",208,0)
TASK(BPSDELAY) ;
"RTN","BPSOSQ4",209,0)
 ; This will resubmit an entry in BPS REQUEST based on the time distance passed in
"RTN","BPSOSQ4",210,0)
 ;    BPSDELAY = Delay time to resubmit (if any)
"RTN","BPSOSQ4",211,0)
 ;
"RTN","BPSOSQ4",212,0)
 N ZTDTH,ZTRTN,ZTSAVE,ZTDESC,ZTIO,ZTSK
"RTN","BPSOSQ4",213,0)
 S ZTDTH=BPSDELAY
"RTN","BPSOSQ4",214,0)
 S ZTRTN="BACKGR^BPSOSRB"
"RTN","BPSOSQ4",215,0)
 S ZTDESC="Resubmit a prober claim for a sleeping payer."
"RTN","BPSOSQ4",216,0)
 S ZTIO=""
"RTN","BPSOSQ4",217,0)
 D ^%ZTLOAD
"RTN","BPSOSQ4",218,0)
 Q
"RTN","BPSOSQ4",219,0)
 ;
"RTN","BPSOSQ4",220,0)
 ; Clear insurer sleeping condition
"RTN","BPSOSQ4",221,0)
 ; GRPLAN = Group Insurance Plan IEN
"RTN","BPSOSQ4",222,0)
CLRSLEEP(GRPLAN) ;EP - BPSOSQL
"RTN","BPSOSQ4",223,0)
 N RETRY,BPS15IEN,PROBER,DA,DIE,DR,DIK
"RTN","BPSOSQ4",224,0)
 ; Get the BPS ASLEEP PAYER record
"RTN","BPSOSQ4",225,0)
 S BPS15IEN=$O(^BPS(9002313.15,"B",+GRPLAN,0))
"RTN","BPSOSQ4",226,0)
 Q:BPS15IEN=""
"RTN","BPSOSQ4",227,0)
 ; Delete the BPS ASLEEP PAYER record
"RTN","BPSOSQ4",228,0)
 S DA=BPS15IEN,DIK="^BPS(9002313.15," D ^DIK
"RTN","BPSOSQ4",229,0)
 ; If there are other BPS TRANSACTIONS with the asleep payer pointer
"RTN","BPSOSQ4",230,0)
 ; defined, remove it. (This shouldn't happen since DIK removes the pointers,
"RTN","BPSOSQ4",231,0)
 ; but just in case.)
"RTN","BPSOSQ4",232,0)
 I $D(^BPST("ASL",BPS15IEN)) D
"RTN","BPSOSQ4",233,0)
 . N IEN59
"RTN","BPSOSQ4",234,0)
 . S IEN59=""
"RTN","BPSOSQ4",235,0)
 . F  S IEN59=$O(^BPST("ASL",BPS15IEN,IEN59)) Q:IEN59=""  D
"RTN","BPSOSQ4",236,0)
 . . S DA=IEN59,DIE=9002313.59,DR="801///@" D ^DIE
"RTN","BPSOSQ4",237,0)
 ; If this insurer was asleep and there are other asleep transactions, fire off
"RTN","BPSOSQ4",238,0)
 ; the Packeter task to see if they should be done
"RTN","BPSOSQ4",239,0)
 I $D(^BPST("AD",31)) D
"RTN","BPSOSQ4",240,0)
 . N IEN59,IEN77 S IEN59=0
"RTN","BPSOSQ4",241,0)
 . F  S IEN59=$O(^BPST("AD",31,IEN59)) Q:'IEN59  D
"RTN","BPSOSQ4",242,0)
 . . ; Set status back to 0
"RTN","BPSOSQ4",243,0)
 . . D SETSTAT^BPSOSU(IEN59,0)
"RTN","BPSOSQ4",244,0)
 . . S IEN77=+$P($G(^BPST(IEN59,0)),U,12)
"RTN","BPSOSQ4",245,0)
 . . Q:IEN77=""
"RTN","BPSOSQ4",246,0)
 . . ; Activate BPS REQUEST
"RTN","BPSOSQ4",247,0)
 . . I $$FILLFLDS^BPSUTIL2(9002313.77,".04",IEN77,1)<1 Q
"RTN","BPSOSQ4",248,0)
 D TASK($$NOW^XLFDT())
"RTN","BPSOSQ4",249,0)
 Q
"RTN","BPSOSQ4",250,0)
 ;
"RTN","BPSOSQA")
0^85^B8495270
"RTN","BPSOSQA",1,0)
BPSOSQA ;BHAM ISC/FCS/DRS/DLF - ECME background, Part 1 ;06/02/2004
"RTN","BPSOSQA",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5,7**;JUN 2004;Build 46
"RTN","BPSOSQA",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSQA",4,0)
 Q
"RTN","BPSOSQA",5,0)
 ;
"RTN","BPSOSQA",6,0)
 ; ONE59 - Validate BPS Transaction data
"RTN","BPSOSQA",7,0)
 ; Input
"RTN","BPSOSQA",8,0)
 ;   IEN59 - BPS Transaction
"RTN","BPSOSQA",9,0)
 ;
"RTN","BPSOSQA",10,0)
ONE59(IEN59) ;EP - from BPSOSIZ
"RTN","BPSOSQA",11,0)
 ; Process this one IEN59
"RTN","BPSOSQA",12,0)
 ;
"RTN","BPSOSQA",13,0)
 ; Initialize variables
"RTN","BPSOSQA",14,0)
 N X1,RX,RXI,RTN
"RTN","BPSOSQA",15,0)
 S X1=$G(^BPST(IEN59,1))
"RTN","BPSOSQA",16,0)
 S RXI=$P(X1,U),RX=$P(X1,U,11),RTN=$T(+0)
"RTN","BPSOSQA",17,0)
 ;
"RTN","BPSOSQA",18,0)
 I RX="" D ERROR^BPSOSU(RTN,IEN59,106,"Prescription Number not found in Transaction") G END
"RTN","BPSOSQA",19,0)
 I RXI="" D ERROR^BPSOSU(RTN,IEN59,107,"Fill Number not found in Transaction") G END
"RTN","BPSOSQA",20,0)
 ; Create log entry
"RTN","BPSOSQA",21,0)
 ; Needed for Turn-Around Stats - Do NOT delete/alter!!
"RTN","BPSOSQA",22,0)
 D LOG^BPSOSL(IEN59,$T(+0)_"-Validating the BPS Transaction")
"RTN","BPSOSQA",23,0)
 ;
"RTN","BPSOSQA",24,0)
 ; Check for existance of the prescription
"RTN","BPSOSQA",25,0)
 I $$RXAPI1^BPSUTIL1(RX,.01,"I")="" D ERROR^BPSOSU(RTN,IEN59,101,"Missing RX # field .01") G END
"RTN","BPSOSQA",26,0)
 ;
"RTN","BPSOSQA",27,0)
 ; If there is a refill, check for the existance of the refill
"RTN","BPSOSQA",28,0)
 I RXI,$$RXSUBF1^BPSUTIL1(RX,52,52.1,RXI,.01,"I")="" D ERROR^BPSOSU(RTN,IEN59,102,"Missing RX Refill field .01") G END
"RTN","BPSOSQA",29,0)
 ;
"RTN","BPSOSQA",30,0)
 ; Check for missing patient
"RTN","BPSOSQA",31,0)
 I '$P(^BPST(IEN59,0),U,6) D ERROR^BPSOSU(RTN,IEN59,103,"Patient missing from BPS Transaction") G END
"RTN","BPSOSQA",32,0)
 ;
"RTN","BPSOSQA",33,0)
 ; Check for missing division
"RTN","BPSOSQA",34,0)
 I '$P(X1,U,4) D ERROR^BPSOSU(RTN,IEN59,104,"Division missing from BPS Transaction") G END
"RTN","BPSOSQA",35,0)
 ;
"RTN","BPSOSQA",36,0)
 ; Check for missing BPS Pharmacy
"RTN","BPSOSQA",37,0)
 I '$P(X1,U,7)="" D ERROR^BPSOSU(RTN,IEN59,105,"ECME Pharmacy missing from BPS Transaction") G END
"RTN","BPSOSQA",38,0)
 ;
"RTN","BPSOSQA",39,0)
 ; Check for missing insurance node
"RTN","BPSOSQA",40,0)
 I '$D(^BPST(IEN59,10,1,0)) D ERROR^BPSOSU(RTN,IEN59,106,"Missing Insurance in BPST("_IEN59_",10,1,0)") G END
"RTN","BPSOSQA",41,0)
 ;
"RTN","BPSOSQA",42,0)
 ; Check if insurer is asleep and this is not the prober transaction,
"RTN","BPSOSQA",43,0)
 ; and if so set status to 31.
"RTN","BPSOSQA",44,0)
 N GRPLAN S GRPLAN=$$GETPLN59^BPSUTIL2(IEN59)
"RTN","BPSOSQA",45,0)
 N BPSIEN77 S BPSIEN77=$P(^BPST(IEN59,0),U,12)
"RTN","BPSOSQA",46,0)
 I $$ISASLEEP^BPSOSQF(+GRPLAN),BPSIEN77'=$$PROBER^BPSOSQF(+GRPLAN) D  G END
"RTN","BPSOSQA",47,0)
 . D LOG^BPSOSL(IEN59,$T(+0)_"-Insurer "_$P(GRPLAN,U,2)_" is asleep. Will retry later.")
"RTN","BPSOSQA",48,0)
 . D SETSTAT^BPSOSU(IEN59,31)
"RTN","BPSOSQA",49,0)
 ;
"RTN","BPSOSQA",50,0)
 ; If we got this far, we did not get an error
"RTN","BPSOSQA",51,0)
 ; Change status to 30 (Waiting for packet build)
"RTN","BPSOSQA",52,0)
 D SETSTAT^BPSOSU(IEN59,30)
"RTN","BPSOSQA",53,0)
 ;
"RTN","BPSOSQA",54,0)
END ; Common exit point
"RTN","BPSOSQA",55,0)
 ;
"RTN","BPSOSQA",56,0)
 ; Log the contents of Transaction record
"RTN","BPSOSQA",57,0)
 D LOG^BPSOSL(IEN59,$T(+0)_"-Contents of ^BPST("_IEN59_"):")
"RTN","BPSOSQA",58,0)
 D LOG59(IEN59)
"RTN","BPSOSQA",59,0)
 ;
"RTN","BPSOSQA",60,0)
 ; If there are claims at 30%, fire up the packet process
"RTN","BPSOSQA",61,0)
 I $O(^BPST("AD",30,0)) D TASK
"RTN","BPSOSQA",62,0)
 Q
"RTN","BPSOSQA",63,0)
 ;
"RTN","BPSOSQA",64,0)
 ;
"RTN","BPSOSQA",65,0)
LOG59(IEN59) ; Log the IEN59 array
"RTN","BPSOSQA",66,0)
 N A
"RTN","BPSOSQA",67,0)
 M A=^BPST(IEN59)
"RTN","BPSOSQA",68,0)
 D LOGARRAY^BPSOSL(IEN59,"A")
"RTN","BPSOSQA",69,0)
 Q
"RTN","BPSOSQA",70,0)
 ;
"RTN","BPSOSQA",71,0)
TASK ;EP - from BPSOSQ2,BPSOSQ4,BPSOSRB
"RTN","BPSOSQA",72,0)
 N X,%DT,Y S X="N",%DT="ST" D ^%DT
"RTN","BPSOSQA",73,0)
 D TASKAT(Y)
"RTN","BPSOSQA",74,0)
 Q
"RTN","BPSOSQA",75,0)
 ;
"RTN","BPSOSQA",76,0)
TASKAT(ZTDTH) ;EP - from BPSOSQ4 (requeue if insurer is sleeping)
"RTN","BPSOSQA",77,0)
 N ZTRTN,ZTIO
"RTN","BPSOSQA",78,0)
 S ZTRTN="PACKETS^BPSOSQ2",ZTIO=""
"RTN","BPSOSQA",79,0)
 D ^%ZTLOAD
"RTN","BPSOSQA",80,0)
 Q
"RTN","BPSOSQF")
0^76^B8536069
"RTN","BPSOSQF",1,0)
BPSOSQF ;BHAM ISC/FCS/DRS/FLS - Insurer asleep - status 31 ;06/01/2004
"RTN","BPSOSQF",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5,7**;JUN 2004;Build 46
"RTN","BPSOSQF",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSQF",4,0)
 Q
"RTN","BPSOSQF",5,0)
 ;
"RTN","BPSOSQF",6,0)
 ; Check for insurer asleep claims
"RTN","BPSOSQF",7,0)
 ;
"RTN","BPSOSQF",8,0)
STATUS31 ;EP - BPSOSQ2
"RTN","BPSOSQF",9,0)
 ; Situation:  you have 1 or 2 or maybe 200 claims in status 31,
"RTN","BPSOSQF",10,0)
 ; because we've determined that the insurer is asleep.
"RTN","BPSOSQF",11,0)
 ; change at most one claim per insurer to status 30, to let it
"RTN","BPSOSQF",12,0)
 ; go through and try again.  But if the insurer is awake for sure,
"RTN","BPSOSQF",13,0)
 ; let all of the claims for that insurer go on through.
"RTN","BPSOSQF",14,0)
 ;
"RTN","BPSOSQF",15,0)
 ; Initialization
"RTN","BPSOSQF",16,0)
 N RETRY,PROBER,IEN59,PAYERSH,X
"RTN","BPSOSQF",17,0)
 S IEN59=""
"RTN","BPSOSQF",18,0)
 K ^TMP("BPSOSQF",$J) ; build ^TMP("BPSOSQF",$J,PAYERSH,IEN59)=""
"RTN","BPSOSQF",19,0)
 ;
"RTN","BPSOSQF",20,0)
 ; Make sure we can get the lock
"RTN","BPSOSQF",21,0)
 I '$$LOCK59^BPSOSQ2(31) Q
"RTN","BPSOSQF",22,0)
 ;
"RTN","BPSOSQF",23,0)
 ; Loop through transaction that are 31 per cent
"RTN","BPSOSQF",24,0)
 F  S IEN59=$$NEXT59^BPSOSQ2(IEN59,31) Q:'IEN59  D
"RTN","BPSOSQF",25,0)
 . ; if $$NEXT59() returned us an IEN59, then the waiting time
"RTN","BPSOSQF",26,0)
 . ; has expired or this is the Prober - or better yet, the insurer has awakened
"RTN","BPSOSQF",27,0)
 . ;
"RTN","BPSOSQF",28,0)
 . ; Get the payer sheet for the transaction
"RTN","BPSOSQF",29,0)
 . S PAYERSH=$$PAYERSH(IEN59)
"RTN","BPSOSQF",30,0)
 . I PAYERSH="" D LOG^BPSOSL(IEN59,$T(+0)_"-No payersheet was found") Q
"RTN","BPSOSQF",31,0)
 . ;
"RTN","BPSOSQF",32,0)
 . S ^TMP("BPSOSQF",$J,PAYERSH,IEN59)=""
"RTN","BPSOSQF",33,0)
 D UNLOCK59^BPSOSQ2(31)
"RTN","BPSOSQF",34,0)
 ;
"RTN","BPSOSQF",35,0)
 ; Loop through payer sheet and transactions and change status to 30%
"RTN","BPSOSQF",36,0)
 S PAYERSH="" F  S PAYERSH=$O(^TMP("BPSOSQF",$J,PAYERSH)) Q:'PAYERSH  D
"RTN","BPSOSQF",37,0)
 . S IEN59="" F  S IEN59=$O(^TMP("BPSOSQF",$J,PAYERSH,IEN59)) Q:'IEN59  D
"RTN","BPSOSQF",38,0)
 . . D SETSTAT^BPSOSU(IEN59,30) ; reset to status 30
"RTN","BPSOSQF",39,0)
 . . D LOG^BPSOSL(IEN59,$T(+0)_"-Retrying Asleep Claim. BPS TRANSACTION IEN: "_IEN59)
"RTN","BPSOSQF",40,0)
 Q
"RTN","BPSOSQF",41,0)
 ;
"RTN","BPSOSQF",42,0)
 ; Function to get the payer sheet for a given transaction
"RTN","BPSOSQF",43,0)
PAYERSH(IEN59) ;
"RTN","BPSOSQF",44,0)
 N POS
"RTN","BPSOSQF",45,0)
 S POS=$P($G(^BPST(IEN59,9)),U,1)
"RTN","BPSOSQF",46,0)
 I POS="" Q ""
"RTN","BPSOSQF",47,0)
 Q $$GET1^DIQ(9002313.59902,POS_","_IEN59_",",902.02,"I")
"RTN","BPSOSQF",48,0)
 ;
"RTN","BPSOSQF",49,0)
 ; Function to check if Payer is asleep. This function will remove an asleep payer if it has woken up and will queue
"RTN","BPSOSQF",50,0)
 ; other asleep claims if needed.
"RTN","BPSOSQF",51,0)
 ; Input:
"RTN","BPSOSQF",52,0)
 ; GRPLAN = GROUP INSURANCE PLAN file IEN
"RTN","BPSOSQF",53,0)
 ; Returns:
"RTN","BPSOSQF",54,0)
 ; 1 = Yes, payer is asleep
"RTN","BPSOSQF",55,0)
 ; 0 = No, payer is not asleep
"RTN","BPSOSQF",56,0)
ISASLEEP(GRPLAN) ;
"RTN","BPSOSQF",57,0)
 N PROBER,BPAIEN,BPSRETRY,IEN59,IEN77,BPQ,RETV
"RTN","BPSOSQF",58,0)
 S (IEN59,IEN77,BPQ,RETV)=0
"RTN","BPSOSQF",59,0)
 S BPAIEN=$O(^BPS(9002313.15,"B",$G(GRPLAN),0))
"RTN","BPSOSQF",60,0)
 Q:'BPAIEN RETV
"RTN","BPSOSQF",61,0)
 I $$IGNORE(GRPLAN) Q RETV
"RTN","BPSOSQF",62,0)
 ; Prober has completed, clear the sleeping condition
"RTN","BPSOSQF",63,0)
 S PROBER=$$PROBER(GRPLAN) I PROBER<1 D CLRSLEEP^BPSOSQ4(GRPLAN) Q RETV
"RTN","BPSOSQF",64,0)
 F  S IEN59=$O(^BPS(9002313.77,"C",IEN59)) Q:IEN59=""!BPQ  D  Q:BPQ
"RTN","BPSOSQF",65,0)
 . F  S IEN77=$O(^BPS(9002313.77,"C",IEN59,IEN77)) Q:IEN77=""  D  Q:BPQ
"RTN","BPSOSQF",66,0)
 . . I IEN77=PROBER S BPQ=1 D
"RTN","BPSOSQF",67,0)
 . . . I $$STATUS59^BPSOSRX(IEN59)'=99 S RETV=1 Q
"RTN","BPSOSQF",68,0)
 . . . D CLRSLEEP^BPSOSQ4(GRPLAN)
"RTN","BPSOSQF",69,0)
 ;
"RTN","BPSOSQF",70,0)
 Q RETV
"RTN","BPSOSQF",71,0)
 ;
"RTN","BPSOSQF",72,0)
 ; Function to check if IGNORE ASLEEP flag set for Plan
"RTN","BPSOSQF",73,0)
 ; Input:
"RTN","BPSOSQF",74,0)
 ; GRPLAN = Group Insurance Plan file IEN
"RTN","BPSOSQF",75,0)
 ; Returns:
"RTN","BPSOSQF",76,0)
 ; 1 = Ignore
"RTN","BPSOSQF",77,0)
 ; 0 = Don't Ignore
"RTN","BPSOSQF",78,0)
IGNORE(GRPLAN) ;
"RTN","BPSOSQF",79,0)
 N BPAIEN
"RTN","BPSOSQF",80,0)
 S BPAIEN=$O(^BPS(9002313.15,"B",$G(GRPLAN),0))
"RTN","BPSOSQF",81,0)
 Q:'BPAIEN 0
"RTN","BPSOSQF",82,0)
 Q $S($P($G(^BPS(9002313.15,BPAIEN,0)),U,3)=1:1,1:0)
"RTN","BPSOSQF",83,0)
 ;
"RTN","BPSOSQF",84,0)
 ; Function to return the PROBER CLAIM for an insurer
"RTN","BPSOSQF",85,0)
 ; Input:
"RTN","BPSOSQF",86,0)
 ; GRPLAN = Group Insurance Plan file IEN
"RTN","BPSOSQF",87,0)
 ; Returns:
"RTN","BPSOSQF",88,0)
 ; PROBER CLAIM - Pointer to BPS REQUESTS file
"RTN","BPSOSQF",89,0)
PROBER(GRPLAN) ;
"RTN","BPSOSQF",90,0)
 N BPAIEN
"RTN","BPSOSQF",91,0)
 S BPAIEN=$O(^BPS(9002313.15,"B",$G(GRPLAN),0))
"RTN","BPSOSQF",92,0)
 Q:'BPAIEN 0
"RTN","BPSOSQF",93,0)
 Q $P($G(^BPS(9002313.15,BPAIEN,0)),U,4)
"RTN","BPSOSQF",94,0)
 ;
"RTN","BPSOSQL")
0^56^B22164075
"RTN","BPSOSQL",1,0)
BPSOSQL ;BHAM ISC/FCS/DRS/FLS - Process responses ;12/7/07  15:28
"RTN","BPSOSQL",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5,7**;JUN 2004;Build 46
"RTN","BPSOSQL",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSQL",4,0)
 ;
"RTN","BPSOSQL",5,0)
 Q
"RTN","BPSOSQL",6,0)
 ;
"RTN","BPSOSQL",7,0)
 ;  ONE(CLAIMIEN,RESPIEN)
"RTN","BPSOSQL",8,0)
 ;     Process the Response for the claim.  Loop through the
"RTN","BPSOSQL",9,0)
 ;     transaction associated with the claim and call RESP1
"RTN","BPSOSQL",10,0)
 ;  RESP1
"RTN","BPSOSQL",11,0)
 ;     The real work of response handling for one IEN59 is in here
"RTN","BPSOSQL",12,0)
 ;  RESPBAD
"RTN","BPSOSQL",13,0)
 ;     Branch from RESP1 if there is no response value in the
"RTN","BPSOSQL",14,0)
 ;     prescription
"RTN","BPSOSQL",15,0)
 ;
"RTN","BPSOSQL",16,0)
 ; ONE - Both the claim and response record are correct and complete
"RTN","BPSOSQL",17,0)
 ;   Now update all of the prescription records affected by them.
"RTN","BPSOSQL",18,0)
ONE(CLAIMIEN,RESPIEN) ;
"RTN","BPSOSQL",19,0)
 N ISREVERS,INDEX,IEN59
"RTN","BPSOSQL",20,0)
 S ISREVERS=$$ISREVERS^BPSOSU(CLAIMIEN)
"RTN","BPSOSQL",21,0)
 S INDEX=$S(ISREVERS:"AER",1:"AE")
"RTN","BPSOSQL",22,0)
 S IEN59=0
"RTN","BPSOSQL",23,0)
 F  S IEN59=$O(^BPST(INDEX,CLAIMIEN,IEN59)) Q:IEN59=""  D
"RTN","BPSOSQL",24,0)
 . D RESP1(IEN59,ISREVERS,CLAIMIEN,RESPIEN)
"RTN","BPSOSQL",25,0)
 Q
"RTN","BPSOSQL",26,0)
 ;
"RTN","BPSOSQL",27,0)
 ; RESP1 - Process each transaction associated with the claim
"RTN","BPSOSQL",28,0)
RESP1(IEN59,REVERSAL,CLAIMIEN,RESPIEN) ; called from ONE
"RTN","BPSOSQL",29,0)
 N ERROR,ERRTXT,X,MSG
"RTN","BPSOSQL",30,0)
 ;
"RTN","BPSOSQL",31,0)
 ; Store pointer to response
"RTN","BPSOSQL",32,0)
 N DIE,DA,DR
"RTN","BPSOSQL",33,0)
 S DIE=9002313.59,DA=IEN59
"RTN","BPSOSQL",34,0)
 S DR=$S(REVERSAL:402,1:4)_"////"_RESPIEN
"RTN","BPSOSQL",35,0)
 D ^DIE
"RTN","BPSOSQL",36,0)
 ;
"RTN","BPSOSQL",37,0)
 ; Update the status
"RTN","BPSOSQL",38,0)
 D SETSTAT^BPSOSU(IEN59,90) ; "Processing response"
"RTN","BPSOSQL",39,0)
 ;
"RTN","BPSOSQL",40,0)
 ; Get Position and log it
"RTN","BPSOSQL",41,0)
 N POSITION S POSITION=$P(^BPST(IEN59,0),U,9)
"RTN","BPSOSQL",42,0)
 I REVERSAL S POSITION=1 ; but reversals have only 1 transaction
"RTN","BPSOSQL",43,0)
 ;
"RTN","BPSOSQL",44,0)
 ;
"RTN","BPSOSQL",45,0)
 S MSG=$T(+0)_"-Processing "
"RTN","BPSOSQL",46,0)
 I REVERSAL S MSG=MSG_"Reversal "
"RTN","BPSOSQL",47,0)
 S MSG=MSG_"Response #"_RESPIEN_" for Claim #"_CLAIMIEN_" and position "_POSITION
"RTN","BPSOSQL",48,0)
 D LOG^BPSOSL(IEN59,MSG)
"RTN","BPSOSQL",49,0)
 ;
"RTN","BPSOSQL",50,0)
 ; If the Response Status is missing for the prescription, quit with error
"RTN","BPSOSQL",51,0)
 I '$D(^BPSR(RESPIEN,1000,POSITION,500)) D  G RESPBAD
"RTN","BPSOSQL",52,0)
 . S ERROR=901,ERRTXT="Corrupted response `"_RESPIEN
"RTN","BPSOSQL",53,0)
 ;
"RTN","BPSOSQL",54,0)
 ; Get the Respose Status for the prescription and update the statistics
"RTN","BPSOSQL",55,0)
 N RESP S RESP=$P(^BPSR(RESPIEN,1000,POSITION,500),U)
"RTN","BPSOSQL",56,0)
 D INCSTAT^BPSOSUD("R",$S(RESP="R"&REVERSAL:7,RESP="R":2,RESP="P":3,RESP="D":4,RESP="C":5,RESP="A":6,1:19))
"RTN","BPSOSQL",57,0)
 ;
"RTN","BPSOSQL",58,0)
 ; Log Response and if Payable, Amount Paid
"RTN","BPSOSQL",59,0)
 S MSG=$T(+0)_"-Response = "_RESP
"RTN","BPSOSQL",60,0)
 I RESP="P" S MSG=MSG_"-$"_$$INSPAID1^BPSOS03(RESPIEN,POSITION)
"RTN","BPSOSQL",61,0)
 D LOG^BPSOSL(IEN59,MSG)
"RTN","BPSOSQL",62,0)
 ;
"RTN","BPSOSQL",63,0)
 ; If the claims was rejected, log the reject reason
"RTN","BPSOSQL",64,0)
 I RESP="R" D  ; rejected, give rejection reasons
"RTN","BPSOSQL",65,0)
 . N J S J=0 F  S J=$O(^BPSR(RESPIEN,1000,POSITION,511,J)) Q:'J  D
"RTN","BPSOSQL",66,0)
 .. N R S R=$P($G(^BPSR(RESPIEN,1000,POSITION,511,J,0)),U)
"RTN","BPSOSQL",67,0)
 .. ;check if reject lists for non-covered drug needs to be updated IA# 5185
"RTN","BPSOSQL",68,0)
 .. ;I 'REVERSAL D UPDLST^IBNCDNC(+($G(IEN59)\1),$P($G(^BPST(+$G(IEN59),1)),U,2),$P($G(^BPSC(+$G(CLAIMIEN),1)),U,4),R)
"RTN","BPSOSQL",69,0)
 .. N X
"RTN","BPSOSQL",70,0)
 .. I R]"" D
"RTN","BPSOSQL",71,0)
 ... S X=$O(^BPSF(9002313.93,"B",R,0))
"RTN","BPSOSQL",72,0)
 ... ;check if reject lists for non-covered drug needs to be updated IA# 5185
"RTN","BPSOSQL",73,0)
 ... I 'REVERSAL D UPDLST^IBNCDNC(+($G(IEN59)\1),$P($G(^BPST(+$G(IEN59),1)),U,2),$P($G(^BPSC(+$G(CLAIMIEN),1)),U,4),X)
"RTN","BPSOSQL",74,0)
 ... I X]"" S X=$P($G(^BPSF(9002313.93,X,0)),U,2)
"RTN","BPSOSQL",75,0)
 .. E  S X=""
"RTN","BPSOSQL",76,0)
 .. D LOG^BPSOSL(IEN59,"Reject Code: "_R_" - "_X)
"RTN","BPSOSQL",77,0)
 . ;
"RTN","BPSOSQL",78,0)
 . ; If there are reject codes and the claim is not a reversal, synch reject codes
"RTN","BPSOSQL",79,0)
 . ;   with Outpatient Pharmacy
"RTN","BPSOSQL",80,0)
 . I 'REVERSAL D DURSYNC^BPSECMP2(IEN59)
"RTN","BPSOSQL",81,0)
 ;
"RTN","BPSOSQL",82,0)
 ; Get response messages and log them.
"RTN","BPSOSQL",83,0)
 S X=$G(^BPSR(RESPIEN,504))
"RTN","BPSOSQL",84,0)
 I X]"" D LOG^BPSOSL(IEN59,"Response Message: "_X)
"RTN","BPSOSQL",85,0)
 S X=$G(^BPSR(RESPIEN,1000,POSITION,504))
"RTN","BPSOSQL",86,0)
 I X]"" D LOG^BPSOSL(IEN59,"Response Message: "_X)
"RTN","BPSOSQL",87,0)
 S X=$G(^BPSR(RESPIEN,1000,POSITION,526))
"RTN","BPSOSQL",88,0)
 I X]"" D LOG^BPSOSL(IEN59,"Response Message: "_X)
"RTN","BPSOSQL",89,0)
 ;
"RTN","BPSOSQL",90,0)
 ; Get the GROUP INSURANCE PLAN
"RTN","BPSOSQL",91,0)
 N GRPLAN
"RTN","BPSOSQL",92,0)
 S GRPLAN=$$GETPLN77^BPSUTIL2(+$P($G(^BPST(IEN59,0)),U,12))
"RTN","BPSOSQL",93,0)
 ;
"RTN","BPSOSQL",94,0)
 ; Check if the payer should go to sleep based on the reject codes
"RTN","BPSOSQL",95,0)
 I $$REJSLEEP^BPSOSQ4(RESPIEN,POSITION,IEN59) D  ; ins. asleep: want to retry
"RTN","BPSOSQL",96,0)
 . N BPSRETRY
"RTN","BPSOSQL",97,0)
 . D SETSTAT^BPSOSU(IEN59,31)
"RTN","BPSOSQL",98,0)
 . S BPSRETRY=$$INCSLEEP^BPSOSQ4(IEN59) I 'BPSRETRY Q
"RTN","BPSOSQL",99,0)
 . ; Convert to External date/time for logging
"RTN","BPSOSQL",100,0)
 . S BPSRETRY=$$FMTE^XLFDT(BPSRETRY)
"RTN","BPSOSQL",101,0)
 . D LOG^BPSOSL(IEN59,$T(+0)_"-Insurer asleep; retry scheduled for "_BPSRETRY_" for "_$P(GRPLAN,U,2))
"RTN","BPSOSQL",102,0)
 E  D  ; else: a normal kind of response, so we are done
"RTN","BPSOSQL",103,0)
 . N RESULT
"RTN","BPSOSQL",104,0)
 . D CLRSLEEP^BPSOSQ4(+GRPLAN)
"RTN","BPSOSQL",105,0)
 . I REVERSAL S RESULT="Reversal "
"RTN","BPSOSQL",106,0)
 . S RESULT=$G(RESULT)_$S(RESP="R":"Rejected",RESP="P":"Payable",RESP="D":"Duplicate",RESP="C":"Captured",RESP="A":"Accepted",1:"Completed")
"RTN","BPSOSQL",107,0)
 . D SETRESU^BPSOSU(IEN59,0,RESULT)
"RTN","BPSOSQL",108,0)
 . D SETSTAT^BPSOSU(IEN59,99) ; "Done"
"RTN","BPSOSQL",109,0)
 Q
"RTN","BPSOSQL",110,0)
 ;
"RTN","BPSOSQL",111,0)
RESPBAD ; corrupted response escape from RESP1 - reached by a GOTO from RESP
"RTN","BPSOSQL",112,0)
 ; Log the error
"RTN","BPSOSQL",113,0)
 D ERROR^BPSOSU($T(+0),IEN59,$G(ERROR),$G(ERRTXT))
"RTN","BPSOSQL",114,0)
 Q
"RTN","BPSOSRB")
0^3^B38286741
"RTN","BPSOSRB",1,0)
BPSOSRB ;BHAM ISC/FCS/DRS/FLS - Process claim on processing queue ;06/01/2004
"RTN","BPSOSRB",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5,7**;JUN 2004;Build 46
"RTN","BPSOSRB",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSRB",4,0)
 ;
"RTN","BPSOSRB",5,0)
 Q
"RTN","BPSOSRB",6,0)
BACKGR ;
"RTN","BPSOSRB",7,0)
 I '$$LOCKNOW^BPSOSRX("BACKGROUND") Q
"RTN","BPSOSRB",8,0)
 N TYPE,RXI,RXR,IEN59,IEN59PR,BPNOW,BPUNTIL
"RTN","BPSOSRB",9,0)
 N BPIEN77,BPLCKRX,BPQ,BPCOBIND,GRPLAN
"RTN","BPSOSRB",10,0)
 S BPNOW=$$NOW^BPSOSRX()
"RTN","BPSOSRB",11,0)
 ;goto thru all ACTIVATED
"RTN","BPSOSRB",12,0)
 S RXI="" F  S RXI=$O(^BPS(9002313.77,"AC",1,RXI)) Q:RXI=""  D
"RTN","BPSOSRB",13,0)
 . S RXR="" F  S RXR=$O(^BPS(9002313.77,"AC",1,RXI,RXR)) Q:RXR=""  D
"RTN","BPSOSRB",14,0)
 . . S IEN59PR=+$$IEN59^BPSOSRX(RXI,RXR,0)
"RTN","BPSOSRB",15,0)
 . . S BPLCKRX=$$LOCKRF^BPSOSRX(RXI,RXR,10,IEN59PR,$T(+0)) I BPLCKRX=0 D  Q
"RTN","BPSOSRB",16,0)
 . . . D LOG^BPSOSL(IEN59PR,$T(+0)_"-Failed to $$LOCKRF^BPSOSRX.  Will retry later.")
"RTN","BPSOSRB",17,0)
 . . S BPQ=0
"RTN","BPSOSRB",18,0)
 . . S BPIEN77="" F  S BPIEN77=$O(^BPS(9002313.77,"AC",1,RXI,RXR,BPIEN77)) Q:(+BPIEN77=0)!(BPQ=1)  D
"RTN","BPSOSRB",19,0)
 . . . ;check DONT PROCESS UNTIL field #.08 and if it is greater than NOW then DO NOT process it
"RTN","BPSOSRB",20,0)
 . . . S BPUNTIL=+$P($G(^BPS(9002313.77,BPIEN77,0)),U,8) I BPUNTIL>BPNOW S BPQ=1 Q  ;D LOG^BPSOSL(IEN59,$T(+0)_"-The request cannot be processed until."_BPUNTIL_" Will retry later.") Q
"RTN","BPSOSRB",21,0)
 . . . ;check if PROCESS FLAG is IN PROCESS - if the earlier record for this RX refill is in progress - 
"RTN","BPSOSRB",22,0)
 . . . ;we should not process the next operation queued - go to the next refill (BPQ=1)
"RTN","BPSOSRB",23,0)
 . . . I $P($G(^BPS(9002313.77,BPIEN77,0)),U,4)=2 S BPQ=1 D  Q
"RTN","BPSOSRB",24,0)
 . . . . D LOG^BPSOSL(IEN59,$T(+0)_"-Status is 'IN PROCESS'.  Will retry later.")
"RTN","BPSOSRB",25,0)
 . . . S BPCOBIND=$P(^BPS(9002313.77,BPIEN77,0),U,3)
"RTN","BPSOSRB",26,0)
 . . . S IEN59=$$IEN59^BPSOSRX(RXI,RXR,BPCOBIND)
"RTN","BPSOSRB",27,0)
 . . . ; Removed code to check Insurer Asleep
"RTN","BPSOSRB",28,0)
 . . . S TYPE=$P($G(^BPS(9002313.77,+BPIEN77,1)),U,4),TYPE=$S(TYPE="C":"CLAIM",TYPE="U":"UNCLAIM",1:"UNKNW")
"RTN","BPSOSRB",29,0)
 . . . I TYPE="UNKNW" D LOG^BPSOSL(IEN59,$T(+0)_"-Request Type is unknown. Cannot be processed.") D INACTIVE^BPSOSRX4(+BPIEN77) Q  ;make it inactive
"RTN","BPSOSRB",30,0)
 . . . D LOG^BPSOSL(IEN59,$T(+0)_"-Processing the Activated request "_BPIEN77)
"RTN","BPSOSRB",31,0)
 . . . D LOG^BPSOSL(IEN59,$T(+0)_"-Dequeuing.  Type is "_TYPE)
"RTN","BPSOSRB",32,0)
 . . . ; if this is ACTIVATED then make it IN PROCESS (see SETPRFLG below)
"RTN","BPSOSRB",33,0)
 . . . S BPQ=1 ;
"RTN","BPSOSRB",34,0)
 . . . N TIME,MOREDATA
"RTN","BPSOSRB",35,0)
 . . . S TIME=$P($G(^BPS(9002313.77,+BPIEN77,6)),U,1) ; time requested
"RTN","BPSOSRB",36,0)
 . . . D READMORE^BPSOSRX4(BPIEN77,.MOREDATA)
"RTN","BPSOSRB",37,0)
 . . . ;now it is IN PROCESS - i.e. goes to BACKGR1 (as K ^XTMP("BPS-PROC",TYPE,RXI,RXR in old logic) 
"RTN","BPSOSRB",38,0)
 . . . I +$$INPROCES^BPSOSRX4(BPIEN77)=0 D LOG^BPSOSL(IEN59,$T(+0)_"-Cannot change the PROCESS FLAG to IN PROCESS. Cannot be processed.") Q
"RTN","BPSOSRB",39,0)
 . . . D LOG^BPSOSL(IEN59,$T(+0)_"-the request "_BPIEN77_" has been changed to IN PROCESS")
"RTN","BPSOSRB",40,0)
 . . . D BACKGR1(TYPE,RXI,RXR,TIME,.MOREDATA,IEN59,+BPIEN77)
"RTN","BPSOSRB",41,0)
 . . I BPLCKRX D UNLCKRF^BPSOSRX(RXI,RXR,IEN59PR,$T(+0))
"RTN","BPSOSRB",42,0)
 D UNLOCK^BPSOSRX("BACKGROUND")
"RTN","BPSOSRB",43,0)
 Q
"RTN","BPSOSRB",44,0)
 ;
"RTN","BPSOSRB",45,0)
 ;
"RTN","BPSOSRB",46,0)
 ; BACKGR1 - Further processing of the claim
"RTN","BPSOSRB",47,0)
 ; Besides the parameter below, IEN59 also needs to be defined
"RTN","BPSOSRB",48,0)
 ; TYPE - "CLAIM" or "UNCLAIM" 
"RTN","BPSOSRB",49,0)
 ; RXI - PRESCRIPTION file #52 ien
"RTN","BPSOSRB",50,0)
 ; RXR - refill number (0-original)
"RTN","BPSOSRB",51,0)
 ; TIME - time requested
"RTN","BPSOSRB",52,0)
 ; MOREDATA - array with claim data
"RTN","BPSOSRB",53,0)
 ; IEN59 - BPS TRANSACTION ien
"RTN","BPSOSRB",54,0)
 ; BPS77 - BPS REQUEST file ien
"RTN","BPSOSRB",55,0)
BACKGR1(TYPE,RXI,RXR,TIME,MOREDATA,IEN59,BPS77) ;
"RTN","BPSOSRB",56,0)
 ; Resolve multiple requests
"RTN","BPSOSRB",57,0)
 N SKIP S SKIP=0 ; skip if you already got desired result
"RTN","BPSOSRB",58,0)
 N SKIPREAS
"RTN","BPSOSRB",59,0)
 N RESULT,BPSSTAT S BPSSTAT=$$STATUS^BPSOSRX(RXI,RXR,0),RESULT=$P(BPSSTAT,U)
"RTN","BPSOSRB",60,0)
 ;N STARTTIM S STARTTIM=$$STARTTIM(RXI,RXR)
"RTN","BPSOSRB",61,0)
 I TYPE="CLAIM" D
"RTN","BPSOSRB",62,0)
 . I $$RXDEL^BPSOS(RXI,RXR) D  Q
"RTN","BPSOSRB",63,0)
 .. S SKIP=1,SKIPREAS="Prescription is marked as DELETED or CANCELLED"
"RTN","BPSOSRB",64,0)
 . ; If it's never been through ECME before, good.
"RTN","BPSOSRB",65,0)
 . I RESULT="" Q
"RTN","BPSOSRB",66,0)
 . ; There's already a complete transaction for this RXI,RXR
"RTN","BPSOSRB",67,0)
 . ; (We screened out "IN PROGRESS" earlier)
"RTN","BPSOSRB",68,0)
 . ; The program to poll indexes would have set DO NOT RESUBMIT.
"RTN","BPSOSRB",69,0)
 . ; Calls from pharm pkg to ECME have '$D(MOREDATA("DO NOT RESUBMIT"))
"RTN","BPSOSRB",70,0)
 . I $D(MOREDATA("DO NOT RESUBMIT")) D
"RTN","BPSOSRB",71,0)
 .. S SKIP=1
"RTN","BPSOSRB",72,0)
 .. S SKIPREAS="MOREDATA(""DO NOT RESUBMIT"") is set"
"RTN","BPSOSRB",73,0)
 E  I TYPE="UNCLAIM" D
"RTN","BPSOSRB",74,0)
 . ; It must have gone through ECME with a payable result
"RTN","BPSOSRB",75,0)
 . I RESULT="E PAYABLE" Q
"RTN","BPSOSRB",76,0)
 . I RESULT="E DUPLICATE" Q
"RTN","BPSOSRB",77,0)
 . N RXACTION S RXACTION=$G(MOREDATA("RX ACTION"))
"RTN","BPSOSRB",78,0)
 . I $P($G(^BPST(IEN59,9)),U,4)="T",((RESULT="E REVERSAL REJECTED")!(RESULT="E REVERSAL UNSTRANDED")),RXACTION="ERES" Q  ;allow to resubmit rejected reversals for Tricare
"RTN","BPSOSRB",79,0)
 . I RESULT="E REVERSAL REJECTED",(",DE,EREV,RS,"[(","_RXACTION_",")) Q
"RTN","BPSOSRB",80,0)
 . ;
"RTN","BPSOSRB",81,0)
 . I RESULT="E REVERSAL UNSTRANDED",RXACTION="EREV" Q
"RTN","BPSOSRB",82,0)
 . ;
"RTN","BPSOSRB",83,0)
 . I RESULT="E REVERSAL OTHER",RXACTION="EREV" Q
"RTN","BPSOSRB",84,0)
 . ;
"RTN","BPSOSRB",85,0)
 . ;allow to process "insurer asleep" status = 31, other IN PROGRESS statuses are not allowed to be processed
"RTN","BPSOSRB",86,0)
 . I RESULT="IN PROGRESS",$P(BPSSTAT,U,4)=31 Q
"RTN","BPSOSRB",87,0)
 . ;
"RTN","BPSOSRB",88,0)
 . S SKIP=1
"RTN","BPSOSRB",89,0)
 . S SKIPREAS="Cannot reverse - previous result was "_RESULT
"RTN","BPSOSRB",90,0)
 E  D IMPOSS^BPSOSUE("P","TI","bad arg TYPE="_TYPE,,"BACKGR1",$T(+0))
"RTN","BPSOSRB",91,0)
 I SKIP D  Q
"RTN","BPSOSRB",92,0)
 . D LOG^BPSOSL(IEN59,$T(+0)_"-Skipping.  Reason: "_SKIPREAS)
"RTN","BPSOSRB",93,0)
 S MOREDATA("SUBMIT TIME")=TIME
"RTN","BPSOSRB",94,0)
 ;
"RTN","BPSOSRB",95,0)
 I TYPE="UNCLAIM" D REVERSE(IEN59,.MOREDATA,$G(BPS77))
"RTN","BPSOSRB",96,0)
 I TYPE="CLAIM" D CLAIM(IEN59,.MOREDATA,$G(BPS77))
"RTN","BPSOSRB",97,0)
 Q
"RTN","BPSOSRB",98,0)
 ;
"RTN","BPSOSRB",99,0)
 ; STARTTIM - Get START TIME field from BPS Transactions
"RTN","BPSOSRB",100,0)
STARTTIM(RXI,RXR) Q $P($G(^BPST($$IEN59^BPSOSRX(RXI,RXR),0)),U,11)
"RTN","BPSOSRB",101,0)
 ;
"RTN","BPSOSRB",102,0)
 ; Process claim request
"RTN","BPSOSRB",103,0)
 ; EP - Above and BPSOSU (for a resubmit after a reversal)
"RTN","BPSOSRB",104,0)
 ; BPS77 - BPS REQUEST file ien
"RTN","BPSOSRB",105,0)
CLAIM(IEN59,MOREDATA,BPS77) ;
"RTN","BPSOSRB",106,0)
 D LOG^BPSOSL(IEN59,$T(+0)_"-Initiating Claim")
"RTN","BPSOSRB",107,0)
 D EN^BPSOSIZ(IEN59,.MOREDATA,$G(BPS77))
"RTN","BPSOSRB",108,0)
 Q
"RTN","BPSOSRB",109,0)
 ;
"RTN","BPSOSRB",110,0)
 ; Process the reversal
"RTN","BPSOSRB",111,0)
REVERSE(IEN59,MOREDATA,BP77) ;
"RTN","BPSOSRB",112,0)
 N MSG,RETVAL,REV
"RTN","BPSOSRB",113,0)
 ;update/populate fields in BPS REQUEST and BPS TRANSACTION
"RTN","BPSOSRB",114,0)
 I $G(BP77)>0 D UPD7759^BPSOSRX4(BP77,IEN59)
"RTN","BPSOSRB",115,0)
 ;
"RTN","BPSOSRB",116,0)
 ; Log Reversal or Reversal/Resubmit message.
"RTN","BPSOSRB",117,0)
 ; Note that the reversal/resubmit message is needed
"RTN","BPSOSRB",118,0)
 ;   for Turn-Around Stats - Do NOT delete/alter!!
"RTN","BPSOSRB",119,0)
 S MSG=$T(+0)_"-Initiating Reversal"
"RTN","BPSOSRB",120,0)
 D LOG^BPSOSL(IEN59,MSG)
"RTN","BPSOSRB",121,0)
 ;
"RTN","BPSOSRB",122,0)
 ; Change status to 0% (Waiting to Start), which will reset START TIME,
"RTN","BPSOSRB",123,0)
 ;   and then to 10% (Building transaction)
"RTN","BPSOSRB",124,0)
 D SETSTAT^BPSOSU(IEN59,0)
"RTN","BPSOSRB",125,0)
 D SETSTAT^BPSOSU(IEN59,10)
"RTN","BPSOSRB",126,0)
 ;
"RTN","BPSOSRB",127,0)
 ; Update User (#13), RX Action (#1201), and Reversal Reason (#404)
"RTN","BPSOSRB",128,0)
 ;   in BPS Transactions
"RTN","BPSOSRB",129,0)
 N DIE,DR,DA
"RTN","BPSOSRB",130,0)
 S DIE=9002313.59,DA=IEN59
"RTN","BPSOSRB",131,0)
 S DR="6////"_$G(MOREDATA("SUBMIT TIME"))_";13////"_$G(MOREDATA("USER"))
"RTN","BPSOSRB",132,0)
 S DR=DR_";404////"_$G(MOREDATA("REVERSAL REASON"))_";1201////"_$G(MOREDATA("RX ACTION"))
"RTN","BPSOSRB",133,0)
 ;
"RTN","BPSOSRB",134,0)
 D ^DIE
"RTN","BPSOSRB",135,0)
 ;
"RTN","BPSOSRB",136,0)
 ; Store contents of BPST in the Log
"RTN","BPSOSRB",137,0)
 D LOG^BPSOSL(IEN59,$T(+0)_"-Contents of ^BPST("_IEN59_") :")
"RTN","BPSOSRB",138,0)
 D LOG59^BPSOSQA(IEN59) ; Log contents of 9002313.59
"RTN","BPSOSRB",139,0)
 ;
"RTN","BPSOSRB",140,0)
 ; Add semi-colon to result text
"RTN","BPSOSRB",141,0)
 D PREVISLY^BPSOSIZ(IEN59)
"RTN","BPSOSRB",142,0)
 ;
"RTN","BPSOSRB",143,0)
 ; Construct reversal claim
"RTN","BPSOSRB",144,0)
 ;   If no reversal claim is returned, log error and quit.
"RTN","BPSOSRB",145,0)
 S REV=$$REVERSE^BPSECA8(IEN59)
"RTN","BPSOSRB",146,0)
 I REV=0 D  Q
"RTN","BPSOSRB",147,0)
 . D LOG^BPSOSL(IEN59,$T(+0)_"-Reversal claim not created for "_IEN59)
"RTN","BPSOSRB",148,0)
 . D ERROR^BPSOSU($T(+0),IEN59,100,"Reversal Claim not created")
"RTN","BPSOSRB",149,0)
 ;
"RTN","BPSOSRB",150,0)
 ; Update Reversal Field in the transaction
"RTN","BPSOSRB",151,0)
 S DIE=9002313.59,DA=IEN59,DR="401////"_REV
"RTN","BPSOSRB",152,0)
 D ^DIE
"RTN","BPSOSRB",153,0)
 ;
"RTN","BPSOSRB",154,0)
 ; Update Log
"RTN","BPSOSRB",155,0)
 D LOG^BPSOSL(IEN59,$T(+0)_"-Reversal claim "_$P(^BPSC(REV,0),U)_" ("_REV_")")
"RTN","BPSOSRB",156,0)
 ;
"RTN","BPSOSRB",157,0)
 ; Update status to 30% (Building the claim)
"RTN","BPSOSRB",158,0)
 D SETSTAT^BPSOSU(IEN59,30)
"RTN","BPSOSRB",159,0)
 ;
"RTN","BPSOSRB",160,0)
 ; Fire off task to get this on the HL7 queue
"RTN","BPSOSRB",161,0)
 D TASK^BPSOSQA
"RTN","BPSOSRB",162,0)
 Q
"RTN","BPSOSRX")
0^4^B40176170
"RTN","BPSOSRX",1,0)
BPSOSRX ;BHAM ISC/FCS/DRS/FLS - callable from RPMS pharm ;06/01/2004
"RTN","BPSOSRX",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5,7**;JUN 2004;Build 46
"RTN","BPSOSRX",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSRX",4,0)
 ;
"RTN","BPSOSRX",5,0)
 ; There are three callable entry points:
"RTN","BPSOSRX",6,0)
 ; $$REQST^BPSOSRX     Schedule claim/unclaim request
"RTN","BPSOSRX",7,0)
 ; $$STATUS^BPSOSRX    Inquire about a claim's status
"RTN","BPSOSRX",8,0)
 ; SHOWQ^BPSOSRX       Display queue of claims to be processed
"RTN","BPSOSRX",9,0)
 Q
"RTN","BPSOSRX",10,0)
 ;
"RTN","BPSOSRX",11,0)
 ; Schedule CLAIM or UNCLAIM request
"RTN","BPSOSRX",12,0)
 ; Process both types of requests - CLAIMs and UNCLAIMs
"RTN","BPSOSRX",13,0)
 ;
"RTN","BPSOSRX",14,0)
 ; Input: see MKRQST
"RTN","BPSOSRX",15,0)
 ; Return values:
"RTN","BPSOSRX",16,0)
 ;  1^BPS REQUEST ien = accepted for processing
"RTN","BPSOSRX",17,0)
 ;  0^reason = failure (should never happen)
"RTN","BPSOSRX",18,0)
REQST(BPREQTYP,RXI,RXR,MOREDATA,BPCOBIND,IEN59,BILLNDC,BPSKIP) ;
"RTN","BPSOSRX",19,0)
 N BPRETV,BPIEN77,BPIENS78
"RTN","BPSOSRX",20,0)
 S BPSKIP=+$G(BPSKIP)
"RTN","BPSOSRX",21,0)
 D LOG^BPSOSL(IEN59,$T(+0)_"- Start creating request")
"RTN","BPSOSRX",22,0)
 S BPRETV=$$MKINSUR^BPSOSRX2(RXI,RXR,.MOREDATA,.BPIENS78)
"RTN","BPSOSRX",23,0)
 I +BPRETV=0 Q BPRETV
"RTN","BPSOSRX",24,0)
 ;create BPS REQUEST records for primary insurer only and populate its IBDATA multiple with the iens of BPS INSURER DATA
"RTN","BPSOSRX",25,0)
 S BPRETV=$$MKRQST^BPSOSRX3(BPREQTYP,RXI,RXR,.MOREDATA,.BPIENS78,1,$G(BILLNDC),BPSKIP)
"RTN","BPSOSRX",26,0)
 Q BPRETV
"RTN","BPSOSRX",27,0)
 ;
"RTN","BPSOSRX",28,0)
 ; $$STATUS(RXI,RXR,QUE,BPRQIEN) - Returns the Status of the prescription/fill
"RTN","BPSOSRX",29,0)
 ; Input
"RTN","BPSOSRX",30,0)
 ;   RXI - Prescription IEN (required)
"RTN","BPSOSRX",31,0)
 ;   RXR - Refill Number (required)
"RTN","BPSOSRX",32,0)
 ;   QUE (optional):  0 - Do not check if a RX/fill is on the queue 
"RTN","BPSOSRX",33,0)
 ;         1/null - Check if RX/fill is on the queue
"RTN","BPSOSRX",34,0)
 ;   BPRQIEN (optional) -  the BPS REQUESTS (#9002313.77) IEN
"RTN","BPSOSRX",35,0)
 ;
"RTN","BPSOSRX",36,0)
 ; Returns
"RTN","BPSOSRX",37,0)
 ;    RESULT^LAST UPDATE DATE/TIME^DESCRIPTION^STATUS %
"RTN","BPSOSRX",38,0)
 ;    Returns null if there's no ECME record of this RX/fill
"RTN","BPSOSRX",39,0)
 ;
"RTN","BPSOSRX",40,0)
 ;    RESULT is either:
"RTN","BPSOSRX",41,0)
 ;      1. IN PROGRESS for incomplete claims
"RTN","BPSOSRX",42,0)
 ;      2. Final status for complete claims.  See comments for
"RTN","BPSOSRX",43,0)
 ;         BPSOSUC for complete list of possible statuses.
"RTN","BPSOSRX",44,0)
 ;      3. SCHEDULED for scheduled (not ACTIVATED yet) requests
"RTN","BPSOSRX",45,0)
 ;         
"RTN","BPSOSRX",46,0)
 ;    LAST UPDATE DATE/TIME is the Fileman date and time of the
"RTN","BPSOSRX",47,0)
 ;         last update to the status of this claim.
"RTN","BPSOSRX",48,0)
 ;         
"RTN","BPSOSRX",49,0)
 ;    DESCRIPTION is either:
"RTN","BPSOSRX",50,0)
 ;      1. Incomplete claims will be the status (i.e., Waiting to Start,
"RTN","BPSOSRX",51,0)
 ;         Transmitting)
"RTN","BPSOSRX",52,0)
 ;      2. Completed claims will have the reason that the ECME process
"RTN","BPSOSRX",53,0)
 ;         was aborted if the result is  E OTHER.  Otherwise, it will
"RTN","BPSOSRX",54,0)
 ;         be similiar to the RESULT
"RTN","BPSOSRX",55,0)
 ;         
"RTN","BPSOSRX",56,0)
 ;    STATUS % is the completion percentage.  Note that 99 is considered
"RTN","BPSOSRX",57,0)
 ;         complete.
"RTN","BPSOSRX",58,0)
 ;         
"RTN","BPSOSRX",59,0)
STATUS(RXI,RXR,QUE,BPRQIEN) ;
"RTN","BPSOSRX",60,0)
 ; Setup needed variables
"RTN","BPSOSRX",61,0)
 N IEN59,SDT,SUBDT,BPCOB,BP59REQ,BPTRTYP,BP59ZERO,BP59REQ
"RTN","BPSOSRX",62,0)
 I '$G(RXI) Q ""
"RTN","BPSOSRX",63,0)
 I $G(RXR)="" Q ""
"RTN","BPSOSRX",64,0)
 I $G(QUE)="" S QUE=1
"RTN","BPSOSRX",65,0)
 ;
"RTN","BPSOSRX",66,0)
 ;if BPRQIEN then it is called from BPSNCPD1 to display progress to the user. So we need to check queue anyway
"RTN","BPSOSRX",67,0)
 I $G(BPRQIEN)>0 S QUE=1
"RTN","BPSOSRX",68,0)
 ;
"RTN","BPSOSRX",69,0)
 ;default COB = primary
"RTN","BPSOSRX",70,0)
 S BPCOB=1
"RTN","BPSOSRX",71,0)
 ;
"RTN","BPSOSRX",72,0)
 ;get IEN of BPS TRANSACTION
"RTN","BPSOSRX",73,0)
 S IEN59=$$IEN59(RXI,RXR,BPCOB)
"RTN","BPSOSRX",74,0)
 ;
"RTN","BPSOSRX",75,0)
 ;read zeroth node of the BPS TRANSACTION record
"RTN","BPSOSRX",76,0)
 S BP59ZERO=$G(^BPST(IEN59,0))
"RTN","BPSOSRX",77,0)
 ;
"RTN","BPSOSRX",78,0)
 ;if doesn't have BPS TRANSACTION record AND doesn't have any BPS REQUEST records then
"RTN","BPSOSRX",79,0)
 ;this is an old claim OR it is not e-billable - so use the old logic
"RTN","BPSOSRX",80,0)
 I $G(BPRQIEN)="" I BP59ZERO="" I '$D(^BPS(9002313.77,"D",RXI,RXR,BPCOB)) Q $$OLDSTAT^BPSOSRX6(RXI,RXR,$G(QUE))
"RTN","BPSOSRX",81,0)
 ;
"RTN","BPSOSRX",82,0)
 ;if doesn't have BPS TRANSACTION record (not created yet) AND has BPS REQUEST record(s)
"RTN","BPSOSRX",83,0)
 I BP59ZERO="" Q $$QUESTAT(RXI,RXR,BPCOB)
"RTN","BPSOSRX",84,0)
 ;
"RTN","BPSOSRX",85,0)
 ;get transaction type
"RTN","BPSOSRX",86,0)
 S BPTRTYP=$P(BP59ZERO,U,15)
"RTN","BPSOSRX",87,0)
 ;if Transaction type is not defined then this is an OLD claim so use the old logic
"RTN","BPSOSRX",88,0)
 I $G(BPRQIEN)="" I BPTRTYP="" Q $$OLDSTAT^BPSOSRX6(RXI,RXR,$G(QUE))
"RTN","BPSOSRX",89,0)
 ;
"RTN","BPSOSRX",90,0)
 ;get the current BPS REQUEST
"RTN","BPSOSRX",91,0)
 I BPTRTYP="C" S BP59REQ=$P(BP59ZERO,U,12)
"RTN","BPSOSRX",92,0)
 I BPTRTYP="U" S BP59REQ=$P($G(^BPST(IEN59,4)),U,5)
"RTN","BPSOSRX",93,0)
 I $G(BP59REQ)="" Q $$QUESTAT(RXI,RXR,BPCOB)
"RTN","BPSOSRX",94,0)
 ;
"RTN","BPSOSRX",95,0)
 ;get request date/time
"RTN","BPSOSRX",96,0)
 S SDT=$P($G(^BPS(9002313.77,+$G(BP59REQ),6)),U,1) ;REQUEST DATE AND TIME
"RTN","BPSOSRX",97,0)
 ;
"RTN","BPSOSRX",98,0)
 ; Loop: Get data, quit if times and status match (no change during gather)
"RTN","BPSOSRX",99,0)
 N C,T1,T2,S1,S2
"RTN","BPSOSRX",100,0)
 F  D  I T1=T2,S1=S2 Q
"RTN","BPSOSRX",101,0)
 . S T1=$$LASTUP59^BPSOSRX(IEN59)
"RTN","BPSOSRX",102,0)
 . S S1=$$STATUS59^BPSOSRX(IEN59)
"RTN","BPSOSRX",103,0)
 . I S1=99 D  ; completed
"RTN","BPSOSRX",104,0)
 . . S A=$$CATEG^BPSOSUC(IEN59)
"RTN","BPSOSRX",105,0)
 . . S C=$$RESTXT59^BPSOSRX(IEN59)
"RTN","BPSOSRX",106,0)
 . I S1'=99 D
"RTN","BPSOSRX",107,0)
 . . S A="IN PROGRESS"
"RTN","BPSOSRX",108,0)
 . . S C=$$STATI^BPSOSU($S(S1="":10,1:S1))
"RTN","BPSOSRX",109,0)
 . S T2=$$LASTUP59^BPSOSRX(IEN59)
"RTN","BPSOSRX",110,0)
 . S S2=$$STATUS59^BPSOSRX(IEN59)
"RTN","BPSOSRX",111,0)
 ;
"RTN","BPSOSRX",112,0)
 ; If the queue parameter is set and the submit date from the queue
"RTN","BPSOSRX",113,0)
 ;   follows the SUBMIT DATE/LAST UPDATE date from BPS TRANSACTION 
"RTN","BPSOSRX",114,0)
 ;   or the RX/fill is still on the queue, then change the response
"RTN","BPSOSRX",115,0)
 ;   to IN PROGRESS^Submit Date^WAITING TO START
"RTN","BPSOSRX",116,0)
 S SUBDT=$$SUBMIT59^BPSOSRX(IEN59)
"RTN","BPSOSRX",117,0)
 I SUBDT="" S SUBDT=T1
"RTN","BPSOSRX",118,0)
 ;
"RTN","BPSOSRX",119,0)
 ;if we need to check the queue
"RTN","BPSOSRX",120,0)
 I $G(QUE),$$QUETIME(RXI,RXR,BPCOB,1)>SUBDT S A="IN PROGRESS",T1=SDT,S1=-1,C=$$STATI^BPSOSU(0)
"RTN","BPSOSRX",121,0)
 I $G(QUE),$$QUETIME(RXI,RXR,BPCOB,0)>SUBDT S A="IN PROGRESS",T1=SDT,S1=-1,C=$$STATI^BPSOSU(0)
"RTN","BPSOSRX",122,0)
 I $G(QUE),$$QUETIME(RXI,RXR,BPCOB,2)>SUBDT S A="IN PROGRESS",T1=SDT,S1=-1,C=$$STATI^BPSOSU(0) ;To check IN PROCESS
"RTN","BPSOSRX",123,0)
 ;
"RTN","BPSOSRX",124,0)
 ; Return results
"RTN","BPSOSRX",125,0)
 Q A_U_T1_U_$E(C,1,255-$L(A)-$L(T1)-2)_U_S1
"RTN","BPSOSRX",126,0)
 ;
"RTN","BPSOSRX",127,0)
 ;the most current queue status as text
"RTN","BPSOSRX",128,0)
QUESTAT(RXI,RXR,BPCOB) ;
"RTN","BPSOSRX",129,0)
 I $D(^BPS(9002313.77,"D",RXI,RXR,BPCOB,2)) Q "IN PROGRESS"_U_$$QUETIME(RXI,RXR,BPCOB,2)_U_$$STATI^BPSOSU(-96)_U_-1
"RTN","BPSOSRX",130,0)
 I $D(^BPS(9002313.77,"D",RXI,RXR,BPCOB,1)) Q "IN PROGRESS"_U_$$QUETIME(RXI,RXR,BPCOB,1)_U_$$STATI^BPSOSU(0)_U_-1
"RTN","BPSOSRX",131,0)
 I $D(^BPS(9002313.77,"D",RXI,RXR,BPCOB,0)) Q "IN PROGRESS"_U_$$QUETIME(RXI,RXR,BPCOB,0)_U_$$STATI^BPSOSU(-99)_U_-1
"RTN","BPSOSRX",132,0)
 ;if PROCESS FLAG=3,4,5 return null
"RTN","BPSOSRX",133,0)
 Q ""
"RTN","BPSOSRX",134,0)
 ;
"RTN","BPSOSRX",135,0)
 ;the most current queue status as process flag
"RTN","BPSOSRX",136,0)
QUECUR(RXI,RXR,BPCOB) ;
"RTN","BPSOSRX",137,0)
 I $D(^BPS(9002313.77,"D",RXI,RXR,BPCOB,3)) Q 3
"RTN","BPSOSRX",138,0)
 I $D(^BPS(9002313.77,"D",RXI,RXR,BPCOB,2)) Q 2
"RTN","BPSOSRX",139,0)
 I $D(^BPS(9002313.77,"D",RXI,RXR,BPCOB,1)) Q 1
"RTN","BPSOSRX",140,0)
 I $D(^BPS(9002313.77,"D",RXI,RXR,BPCOB,0)) Q 0
"RTN","BPSOSRX",141,0)
 ;if PROCESS FLAG=3,4,5 return null
"RTN","BPSOSRX",142,0)
 Q ""
"RTN","BPSOSRX",143,0)
 ;
"RTN","BPSOSRX",144,0)
 ;the most current queue status as process flag
"RTN","BPSOSRX",145,0)
QUETIME(RXI,RXR,BPCOB,BPROCFL) ;
"RTN","BPSOSRX",146,0)
 N BP77
"RTN","BPSOSRX",147,0)
 S BP77=$O(^BPS(9002313.77,"D",RXI,RXR,BPCOB,BPROCFL,0))
"RTN","BPSOSRX",148,0)
 I BP77>0 Q $P($G(^BPS(9002313.77,+BP77,6)),U,1) ;REQUEST DATE AND TIME
"RTN","BPSOSRX",149,0)
 Q ""
"RTN","BPSOSRX",150,0)
 ;
"RTN","BPSOSRX",151,0)
 ; SHOWQ - Show RX/Fill on the Queue.  Since claims are generally processed
"RTN","BPSOSRX",152,0)
 ;   immediately, this report will generally have no output.
"RTN","BPSOSRX",153,0)
SHOWQ G SHOWQ^BPSOSR2
"RTN","BPSOSRX",154,0)
 ;
"RTN","BPSOSRX",155,0)
NOW() N %,%H,%I,X D NOW^%DTC Q %
"RTN","BPSOSRX",156,0)
 ;
"RTN","BPSOSRX",157,0)
 ; RESTXT59 - Return first semi-colon piece of the Result Text (202) field
"RTN","BPSOSRX",158,0)
 ;    from BPS Transaction
"RTN","BPSOSRX",159,0)
RESTXT59(IEN59) ;
"RTN","BPSOSRX",160,0)
 I '$G(IEN59) Q ""
"RTN","BPSOSRX",161,0)
 Q $P($P($G(^BPST(IEN59,2)),U,2,99),";",1)
"RTN","BPSOSRX",162,0)
 ;
"RTN","BPSOSRX",163,0)
 ; LASTUP59 - Return last update date/time from BPS Transactions
"RTN","BPSOSRX",164,0)
LASTUP59(IEN59) ;
"RTN","BPSOSRX",165,0)
 I '$G(IEN59) Q ""
"RTN","BPSOSRX",166,0)
 Q $P($G(^BPST(IEN59,0)),U,8)
"RTN","BPSOSRX",167,0)
 ;
"RTN","BPSOSRX",168,0)
 ; STATUS59 returns STATUS field from BPS Transaction
"RTN","BPSOSRX",169,0)
 ; Note: 99 means complete
"RTN","BPSOSRX",170,0)
STATUS59(IEN59) ;
"RTN","BPSOSRX",171,0)
 I '$G(IEN59) Q ""
"RTN","BPSOSRX",172,0)
 Q $P($G(^BPST(IEN59,0)),U,2)
"RTN","BPSOSRX",173,0)
 ;
"RTN","BPSOSRX",174,0)
 ; SUBMIT59 - Return Submit date/time from BPS Transactions (#6) SUBMIT DATE/TIME
"RTN","BPSOSRX",175,0)
SUBMIT59(IEN59) ;
"RTN","BPSOSRX",176,0)
 I '$G(IEN59) Q ""
"RTN","BPSOSRX",177,0)
 Q $P($G(^BPST(IEN59,0)),U,7)
"RTN","BPSOSRX",178,0)
 ;
"RTN","BPSOSRX",179,0)
 ; RXRDEF - Get last refill
"RTN","BPSOSRX",180,0)
RXRDEF(RXI) ;
"RTN","BPSOSRX",181,0)
 I '$G(RXI) Q ""
"RTN","BPSOSRX",182,0)
 K ^TMP($J)
"RTN","BPSOSRX",183,0)
 N BPSPT S BPSPT=$$RXAPI1^BPSUTIL1(RXI,2,"I")
"RTN","BPSOSRX",184,0)
 I BPSPT="" Q ""
"RTN","BPSOSRX",185,0)
 D RX^PSO52API(BPSPT,"BPSREF",RXI,,"R")
"RTN","BPSOSRX",186,0)
 Q +$O(^TMP($J,"BPSREF",BPSPT,RXI,"RF",""),-1)
"RTN","BPSOSRX",187,0)
 ;
"RTN","BPSOSRX",188,0)
 ; Utilities
"RTN","BPSOSRX",189,0)
 ;
"RTN","BPSOSRX",190,0)
 ;  LOCKING:  Just one user of this routine at a time.
"RTN","BPSOSRX",191,0)
 ;  X = "SUBMIT" to interlock the claim submission
"RTN","BPSOSRX",192,0)
 ;  X = "BACKGROUND" to interlock the background job
"RTN","BPSOSRX",193,0)
LOCK(X,TIMEOUT) ;EP - BPSOSRB
"RTN","BPSOSRX",194,0)
 I $G(TIMEOUT)="" S TIMEOUT=0
"RTN","BPSOSRX",195,0)
 L +^XTMP("BPS-PROC",X):TIMEOUT
"RTN","BPSOSRX",196,0)
 Q $T
"RTN","BPSOSRX",197,0)
 ;
"RTN","BPSOSRX",198,0)
LOCKNOW(X) ;EP - BPSOSRB
"RTN","BPSOSRX",199,0)
 L +^XTMP("BPS-PROC",X):0
"RTN","BPSOSRX",200,0)
 Q $T
"RTN","BPSOSRX",201,0)
 ;
"RTN","BPSOSRX",202,0)
UNLOCK(X) ;EP - BPSOSRB
"RTN","BPSOSRX",203,0)
 L -^XTMP("BPS-PROC",X)
"RTN","BPSOSRX",204,0)
 Q
"RTN","BPSOSRX",205,0)
 ;
"RTN","BPSOSRX",206,0)
RUNNING() ;
"RTN","BPSOSRX",207,0)
 I '$$LOCKNOW("BACKGROUND") Q  ; it is running; don't start another
"RTN","BPSOSRX",208,0)
 D UNLOCK("BACKGROUND") ; it's not running; release our probing lock
"RTN","BPSOSRX",209,0)
 D TASK
"RTN","BPSOSRX",210,0)
 Q
"RTN","BPSOSRX",211,0)
 ;
"RTN","BPSOSRX",212,0)
 ;RXI - #52 ien
"RTN","BPSOSRX",213,0)
 ;RXR - refill #
"RTN","BPSOSRX",214,0)
 ;BPCOBIND - COB indicator
"RTN","BPSOSRX",215,0)
IEN59(RXI,RXR,BPCOBIND) ;EP - from BPSOS, BPSOSRB
"RTN","BPSOSRX",216,0)
 I '$G(RXI) Q ""
"RTN","BPSOSRX",217,0)
 I '$G(RXR) S RXR=0
"RTN","BPSOSRX",218,0)
 I +$G(BPCOBIND)=0 S BPCOBIND=1 ;default is primary
"RTN","BPSOSRX",219,0)
 I BPCOBIND>3!(BPCOBIND<1) Q ""
"RTN","BPSOSRX",220,0)
 Q RXI_"."_$TR($J(RXR,4)," ","0")_+BPCOBIND
"RTN","BPSOSRX",221,0)
 ;
"RTN","BPSOSRX",222,0)
 ;
"RTN","BPSOSRX",223,0)
 ; The background job
"RTN","BPSOSRX",224,0)
TASK N X,Y,%DT
"RTN","BPSOSRX",225,0)
 S X="N",%DT="ST"
"RTN","BPSOSRX",226,0)
 D ^%DT,TASKAT(Y)
"RTN","BPSOSRX",227,0)
 Q
"RTN","BPSOSRX",228,0)
 ;
"RTN","BPSOSRX",229,0)
TASKAT(ZTDTH) ;
"RTN","BPSOSRX",230,0)
 N ZTIO S ZTIO="" ; no device
"RTN","BPSOSRX",231,0)
 N ZTRTN S ZTRTN="BACKGR^BPSOSRB"
"RTN","BPSOSRX",232,0)
 D ^%ZTLOAD
"RTN","BPSOSRX",233,0)
 Q
"RTN","BPSOSRX",234,0)
 ;
"RTN","BPSOSRX",235,0)
 ;Lock <Rx ien + refill#> pair  - So two (or more) requests for the same RX/refill (like payment and reverse) 
"RTN","BPSOSRX",236,0)
 ; cannot be processed simultaneously
"RTN","BPSOSRX",237,0)
LOCKRF(RXIEN,REFIL,BPTIMOUT,IEN59,BPSRC) ;EP - BPSOSRB
"RTN","BPSOSRX",238,0)
 N BPRET
"RTN","BPSOSRX",239,0)
 L +^XTMP("BPSOSRX-RX/REF",RXIEN,REFIL):+$G(BPTIMOUT)
"RTN","BPSOSRX",240,0)
 S BPRET=$T
"RTN","BPSOSRX",241,0)
 ;I $G(IEN59)>0 D LOG^BPSOSL(IEN59,$G(BPSRC)_$S(BPRET=1:"-Lock",1:"-Failed to Lock")_" RX/RF: "_RXIEN_"/"_REFIL)
"RTN","BPSOSRX",242,0)
 Q BPRET
"RTN","BPSOSRX",243,0)
 ;
"RTN","BPSOSRX",244,0)
 ;UnLock <Rx ien + refill#> pair
"RTN","BPSOSRX",245,0)
UNLCKRF(RXIEN,REFIL,IEN59,BPSRC) ;EP - BPSOSRB
"RTN","BPSOSRX",246,0)
 L -^XTMP("BPSOSRX-RX/REF",RXIEN,REFIL)
"RTN","BPSOSRX",247,0)
 ;I $G(IEN59)>0 D LOG^BPSOSL(IEN59,$G(BPSRC)_"-Unlock RX/RF: "_RXIEN_"/"_REFIL)
"RTN","BPSOSRX",248,0)
 Q
"RTN","BPSOSRX",249,0)
 ;BPSOSRX
"RTN","BPSOSRX2")
0^68^B19493151
"RTN","BPSOSRX2",1,0)
BPSOSRX2 ;ALB/SS - ECME REQUESTS ;30-NOV-07
"RTN","BPSOSRX2",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**7**;JUN 2004;Build 46
"RTN","BPSOSRX2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSRX2",4,0)
 ;
"RTN","BPSOSRX2",5,0)
 ;to store insurer data in BPS INSURER file
"RTN","BPSOSRX2",6,0)
 ; RXI - RX ien 
"RTN","BPSOSRX2",7,0)
 ; RXR - refill number
"RTN","BPSOSRX2",8,0)
 ; MOREDATA - Array of data needed for transaction/claim
"RTN","BPSOSRX2",9,0)
 ; BPCOBIND - "active" COB indicator (the one is processed currently) COB
"RTN","BPSOSRX2",10,0)
 ; BPIEN77 - BPS REQUEST ien (request for which the BPS INSURER DATA record is created)
"RTN","BPSOSRX2",11,0)
 ;
"RTN","BPSOSRX2",12,0)
 ; 
"RTN","BPSOSRX2",13,0)
INSURER(RXI,RXR,MOREDATA,BPCOBIND) ;
"RTN","BPSOSRX2",14,0)
 N BPIEN78,BPIEN59
"RTN","BPSOSRX2",15,0)
 ;IBDATA
"RTN","BPSOSRX2",16,0)
 ;Create a new record with .01 field only
"RTN","BPSOSRX2",17,0)
 S BPIEN59=$$IEN59^BPSOSRX(RXI,RXR,BPCOBIND)
"RTN","BPSOSRX2",18,0)
 ;
"RTN","BPSOSRX2",19,0)
 S BPIEN78=+$$INSITEM^BPSUTIL2(9002313.78,"",BPIEN59,"","") ;RX ien
"RTN","BPSOSRX2",20,0)
 I BPIEN78<1 Q "0^Cannot create a record in BPS INSURER DATA"
"RTN","BPSOSRX2",21,0)
 I $$FILLFLDS^BPSUTIL2(9002313.78,".07",BPIEN78,$P($G(MOREDATA("IBDATA",BPCOBIND,1)),U,14))
"RTN","BPSOSRX2",22,0)
 I $$FILLFLDS^BPSUTIL2(9002313.78,".08",BPIEN78,$P($G(MOREDATA("IBDATA",BPCOBIND,1)),U,1))
"RTN","BPSOSRX2",23,0)
 I $$FILLFLDS^BPSUTIL2(9002313.78,".09",BPIEN78,BPCOBIND)
"RTN","BPSOSRX2",24,0)
 ;
"RTN","BPSOSRX2",25,0)
 I $$FILLFLDS^BPSUTIL2(9002313.78,"1.01",BPIEN78,$P($G(MOREDATA("IBDATA",BPCOBIND,1)),U,2))
"RTN","BPSOSRX2",26,0)
 I $$FILLFLDS^BPSUTIL2(9002313.78,"1.02",BPIEN78,$P($G(MOREDATA("IBDATA",BPCOBIND,1)),U,3))
"RTN","BPSOSRX2",27,0)
 I $$FILLFLDS^BPSUTIL2(9002313.78,"1.03",BPIEN78,$P($G(MOREDATA("IBDATA",BPCOBIND,1)),U,5))
"RTN","BPSOSRX2",28,0)
 I $P($G(MOREDATA("IBDATA",BPCOBIND,1)),U,6)'="" I $$FILLFLDS^BPSUTIL2(9002313.78,"1.04",BPIEN78,$P($G(MOREDATA("IBDATA",BPCOBIND,1)),U,6))
"RTN","BPSOSRX2",29,0)
 I $$FILLFLDS^BPSUTIL2(9002313.78,"1.05",BPIEN78,$P($G(MOREDATA("IBDATA",BPCOBIND,1)),U,7))
"RTN","BPSOSRX2",30,0)
 I $$FILLFLDS^BPSUTIL2(9002313.78,"1.06",BPIEN78,$P($G(MOREDATA("IBDATA",BPCOBIND,1)),U,8))
"RTN","BPSOSRX2",31,0)
 I $$FILLFLDS^BPSUTIL2(9002313.78,"1.07",BPIEN78,$P($G(MOREDATA("IBDATA",BPCOBIND,1)),U,9))
"RTN","BPSOSRX2",32,0)
 I $$FILLFLDS^BPSUTIL2(9002313.78,"1.08",BPIEN78,$P($G(MOREDATA("IBDATA",BPCOBIND,1)),U,10))
"RTN","BPSOSRX2",33,0)
 ;
"RTN","BPSOSRX2",34,0)
 I $$FILLFLDS^BPSUTIL2(9002313.78,"2.01",BPIEN78,$P($G(MOREDATA("IBDATA",BPCOBIND,2)),U,1))
"RTN","BPSOSRX2",35,0)
 I $$FILLFLDS^BPSUTIL2(9002313.78,"2.02",BPIEN78,$P($G(MOREDATA("IBDATA",BPCOBIND,2)),U,2))
"RTN","BPSOSRX2",36,0)
 I $$FILLFLDS^BPSUTIL2(9002313.78,"2.03",BPIEN78,$P($G(MOREDATA("IBDATA",BPCOBIND,2)),U,3))
"RTN","BPSOSRX2",37,0)
 I $$FILLFLDS^BPSUTIL2(9002313.78,"2.04",BPIEN78,$P($G(MOREDATA("IBDATA",BPCOBIND,2)),U,4))
"RTN","BPSOSRX2",38,0)
 I $$FILLFLDS^BPSUTIL2(9002313.78,"2.05",BPIEN78,$P($G(MOREDATA("IBDATA",BPCOBIND,2)),U,5))
"RTN","BPSOSRX2",39,0)
 I $P($G(MOREDATA("IBDATA",BPCOBIND,1)),U,13)'="" I $$FILLFLDS^BPSUTIL2(9002313.78,"2.06",BPIEN78,$P($G(MOREDATA("IBDATA",BPCOBIND,1)),U,13))
"RTN","BPSOSRX2",40,0)
 ;
"RTN","BPSOSRX2",41,0)
 I $$FILLFLDS^BPSUTIL2(9002313.78,"3.01",BPIEN78,$P($G(MOREDATA("IBDATA",BPCOBIND,3)),U,1))
"RTN","BPSOSRX2",42,0)
 I $P($G(MOREDATA("IBDATA",BPCOBIND,3)),U,2)'="" I $$FILLFLDS^BPSUTIL2(9002313.78,"3.02",BPIEN78,$P($G(MOREDATA("IBDATA",BPCOBIND,3)),U,2))
"RTN","BPSOSRX2",43,0)
 I $$FILLFLDS^BPSUTIL2(9002313.78,"3.03",BPIEN78,$P($G(MOREDATA("IBDATA",BPCOBIND,3)),U,3))
"RTN","BPSOSRX2",44,0)
 I $$FILLFLDS^BPSUTIL2(9002313.78,"3.04",BPIEN78,$P($G(MOREDATA("IBDATA",BPCOBIND,3)),U,4))
"RTN","BPSOSRX2",45,0)
 I $$FILLFLDS^BPSUTIL2(9002313.78,"3.05",BPIEN78,$P($G(MOREDATA("IBDATA",BPCOBIND,3)),U,5))
"RTN","BPSOSRX2",46,0)
 ;
"RTN","BPSOSRX2",47,0)
 I $$FILLFLDS^BPSUTIL2(9002313.78,"4.01",BPIEN78,$P($G(MOREDATA("IBDATA",BPCOBIND,1)),U,4))
"RTN","BPSOSRX2",48,0)
 I $P($G(MOREDATA("IBDATA",BPCOBIND,1)),U,11)'="" I $$FILLFLDS^BPSUTIL2(9002313.78,"4.02",BPIEN78,$P($G(MOREDATA("IBDATA",BPCOBIND,1)),U,11))
"RTN","BPSOSRX2",49,0)
 I $P($G(MOREDATA("IBDATA",BPCOBIND,1)),U,12)'="" I $$FILLFLDS^BPSUTIL2(9002313.78,"4.03",BPIEN78,$P($G(MOREDATA("IBDATA",BPCOBIND,1)),U,12))
"RTN","BPSOSRX2",50,0)
 ;
"RTN","BPSOSRX2",51,0)
 I $$FILLFLDS^BPSUTIL2(9002313.78,"5.01",BPIEN78,+DUZ)
"RTN","BPSOSRX2",52,0)
 I $$FILLFLDS^BPSUTIL2(9002313.78,"5.02",BPIEN78,DT)
"RTN","BPSOSRX2",53,0)
 ;
"RTN","BPSOSRX2",54,0)
 Q "1^"_BPIEN78
"RTN","BPSOSRX2",55,0)
 ;
"RTN","BPSOSRX2",56,0)
ERRFIELD(BP78,BPFIELD) ;
"RTN","BPSOSRX2",57,0)
 N DIK,DA
"RTN","BPSOSRX2",58,0)
 S DIK="^BPS(9002313.78,"
"RTN","BPSOSRX2",59,0)
 S DA=BP78
"RTN","BPSOSRX2",60,0)
 D ^DIK ;delete incomplete record
"RTN","BPSOSRX2",61,0)
 ;return the error message
"RTN","BPSOSRX2",62,0)
 Q $$FIELDMSG(0,"",9002313.78,$G(BPFIELD))
"RTN","BPSOSRX2",63,0)
 ;
"RTN","BPSOSRX2",64,0)
 ;store MOREDATE("IBDATA") in IB INSURER DATA
"RTN","BPSOSRX2",65,0)
 ;  RXI - Prescription IEN
"RTN","BPSOSRX2",66,0)
 ;  RXR - Fill Number
"RTN","BPSOSRX2",67,0)
 ;  MOREDATA - Array of data needed for transaction/claim
"RTN","BPSOSRX2",68,0)
 ;  BPINSUR(COB,IEN78) = array to return back BPS INSURERE DATA iens created 
"RTN","BPSOSRX2",69,0)
 ;  return value:
"RTN","BPSOSRX2",70,0)
 ;  1 = success
"RTN","BPSOSRX2",71,0)
 ;  0^message = if one of the records wasn't created
"RTN","BPSOSRX2",72,0)
MKINSUR(RXI,RXR,MOREDATA,BPINSUR) ;
"RTN","BPSOSRX2",73,0)
 ;store MOREDATE("IBDATA") in IB INSURER DATA
"RTN","BPSOSRX2",74,0)
 N BPQ,BPCOB,BPERRMSG
"RTN","BPSOSRX2",75,0)
 S BPERRMSG=""
"RTN","BPSOSRX2",76,0)
 S BPQ=0,BPCOB=0
"RTN","BPSOSRX2",77,0)
 F  S BPCOB=$O(MOREDATA("IBDATA",BPCOB)) Q:+BPCOB=0!(BPQ=1)  D
"RTN","BPSOSRX2",78,0)
 . S BPIEN78=$$INSURER(RXI,RXR,.MOREDATA,BPCOB)
"RTN","BPSOSRX2",79,0)
 . I BPIEN78<1 S BPERRMSG="Missing data for the file #9002313.78, "_$P(BPIEN78,U,2),BPQ=1 Q
"RTN","BPSOSRX2",80,0)
 . S BPINSUR(BPCOB)=+$P(BPIEN78,U,2)
"RTN","BPSOSRX2",81,0)
 I BPQ=1 Q "0^"_BPERRMSG
"RTN","BPSOSRX2",82,0)
 Q 1
"RTN","BPSOSRX2",83,0)
 ;add field name to the message
"RTN","BPSOSRX2",84,0)
 ;BPRFILE - if 1 then add file # to the message
"RTN","BPSOSRX2",85,0)
 ;BPMESS,BPFILENO,BPFLDNO - message text, file # and field #
"RTN","BPSOSRX2",86,0)
FIELDMSG(BPRFILE,BPMESS,BPFILENO,BPFLDNO) ;
"RTN","BPSOSRX2",87,0)
 N BPFLDNM
"RTN","BPSOSRX2",88,0)
 I ('$G(BPFILENO))!('$G(BPFLDNO)) Q $G(BPMESS)
"RTN","BPSOSRX2",89,0)
 D FIELD^DID(BPFILENO,BPFLDNO,"","LABEL","BPFLDNM")
"RTN","BPSOSRX2",90,0)
 Q $G(BPMESS)_$S($G(BPRFILE)=1:"file #"_BPFILENO_",",1:"")_"field #"_BPFLDNO_"("_$G(BPFLDNM("LABEL"))_")"
"RTN","BPSOSRX2",91,0)
 ;BPSOSRX2
"RTN","BPSOSRX3")
0^69^B60624911
"RTN","BPSOSRX3",1,0)
BPSOSRX3 ;ALB/SS - ECME REQUESTS ;02-JAN-08
"RTN","BPSOSRX3",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**7**;JUN 2004;Build 46
"RTN","BPSOSRX3",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSRX3",4,0)
 ;
"RTN","BPSOSRX3",5,0)
 ;Input
"RTN","BPSOSRX3",6,0)
 ;BPREQTYP - request type:
"RTN","BPSOSRX3",7,0)
 ; "C" - Submit a claim to ECME
"RTN","BPSOSRX3",8,0)
 ;  If the claim has already been processed, and it's  resubmitted, then a reversal will be
"RTN","BPSOSRX3",9,0)
 ;   done first,  and then the resubmit. Intervening cal ;  to $$STATUS may show progress 
"RTN","BPSOSRX3",10,0)
 ;  of the reversal before  the resubmitted claim is processed.
"RTN","BPSOSRX3",11,0)
 ; "U"- Reverse submitted claim.
"RTN","BPSOSRX3",12,0)
 ;  The reversal will actually be done ONLY if the  most recent processing of the clai
"RTN","BPSOSRX3",13,0)
 ;   resulted in something reversible, namely E PAYABLE or E REVERSAL REJECTED
"RTN","BPSOSRX3",14,0)
 ;RXI - Prescription IEN
"RTN","BPSOSRX3",15,0)
 ;RXR - Fill Number
"RTN","BPSOSRX3",16,0)
 ;MOREDATA - Array of data for transaction/claim
"RTN","BPSOSRX3",17,0)
 ;BPCOBIND - payer sequence
"RTN","BPSOSRX3",18,0)
 ;BILLNDC - NDC passed into EN^BPSNCPDP sent in BILLNDC variable or determined by EN^BPSNCPDP if it was null 
"RTN","BPSOSRX3",19,0)
 ;at the very first time when EN^BPSNCPDP was called in "F" (foreground) mode
"RTN","BPSOSRX3",20,0)
 ;BPSKIP(optional)=1 : skip the field, used when CLAIM request is created while the previous 
"RTN","BPSOSRX3",21,0)
 ;request is in progress. That means - billing determination will be done upon activation)
"RTN","BPSOSRX3",22,0)
 ;Return values:
"RTN","BPSOSRX3",23,0)
 ; 1^BPS REQUEST ien = accepted for processing
"RTN","BPSOSRX3",24,0)
 ; 0^reason = failure (should never happen)
"RTN","BPSOSRX3",25,0)
MKRQST(BPREQTYP,RXI,RXR,MOREDATA,BPIENS78,BPCOBIND,BILLNDC,BPSKIP) ;
"RTN","BPSOSRX3",26,0)
 N BPIEN77,BPCOB,BPQ,BPIEN772,BPERRMSG,BPIEN59,BPIEN78,BPZ
"RTN","BPSOSRX3",27,0)
 N RETVAL,STAT,TYPE,RESULT,SUBMITDT,BPNOW,BPACTTYP,BP77LCK
"RTN","BPSOSRX3",28,0)
 N DUR,BPIEN771,BPCNT,BPSDUPL
"RTN","BPSOSRX3",29,0)
 S BPSKIP=+$G(BPSKIP)
"RTN","BPSOSRX3",30,0)
 I '$G(RXI) Q "0^Parameter error"
"RTN","BPSOSRX3",31,0)
 I '$G(RXR) S RXR=0
"RTN","BPSOSRX3",32,0)
 S BPIEN59=+$$IEN59^BPSOSRX(RXI,RXR,BPCOBIND)
"RTN","BPSOSRX3",33,0)
 ; cannot be processed simultaneously
"RTN","BPSOSRX3",34,0)
 ;new record
"RTN","BPSOSRX3",35,0)
 S BPERRMSG="Cannot create record in BPS REQUEST"
"RTN","BPSOSRX3",36,0)
 S BPIEN77=$$INSITEM^BPSUTIL2(9002313.77,"",RXI,"","","^BPS(9002313.77)",10) ;RX ien
"RTN","BPSOSRX3",37,0)
 I BPIEN77<1 Q "0^"_BPERRMSG
"RTN","BPSOSRX3",38,0)
 S BPNOW=$$NOW^BPSOSRX()
"RTN","BPSOSRX3",39,0)
 S BPACTTYP=$G(MOREDATA("RX ACTION"))
"RTN","BPSOSRX3",40,0)
 ; fill out the fields
"RTN","BPSOSRX3",41,0)
 S BPERRMSG="Missing data for the "
"RTN","BPSOSRX3",42,0)
 I $$FILLFLDS^BPSUTIL2(9002313.77,".02",BPIEN77,RXR)<1 Q "0^"_$$ERRFIELD(BPIEN77,1,BPERRMSG,9002313.77,.02)
"RTN","BPSOSRX3",43,0)
 I $$FILLFLDS^BPSUTIL2(9002313.77,".03",BPIEN77,BPCOBIND)<1 Q "0^"_$$ERRFIELD(BPIEN77,1,BPERRMSG,9002313.77,.03)
"RTN","BPSOSRX3",44,0)
 ;set delay with the testing tool
"RTN","BPSOSRX3",45,0)
 S BPZ=+$$SETDELAY^BPSTEST(BPIEN59) I BPZ>0 I $$FILLFLDS^BPSUTIL2(9002313.77,".08",BPIEN77,BPZ)<1 Q "0^"_$$ERRFIELD(BPIEN77,1,BPERRMSG,9002313.77,.08)
"RTN","BPSOSRX3",46,0)
 ;set the process flag to "WAITING"
"RTN","BPSOSRX3",47,0)
 I $$FILLFLDS^BPSUTIL2(9002313.77,".04",BPIEN77,0)<1 Q "0^"_$$ERRFIELD(BPIEN77,1,BPERRMSG,9002313.77,.04)
"RTN","BPSOSRX3",48,0)
 I $$FILLFLDS^BPSUTIL2(9002313.77,"6.01",BPIEN77,BPNOW)<1 Q "0^"_$$ERRFIELD(BPIEN77,1,BPERRMSG,9002313.77,6.01)
"RTN","BPSOSRX3",49,0)
 I $$FILLFLDS^BPSUTIL2(9002313.77,"6.05",BPIEN77,BPNOW)<1 Q "0^"_$$ERRFIELD(BPIEN77,1,BPERRMSG,9002313.77,6.05)
"RTN","BPSOSRX3",50,0)
 I $$ACTFIELD(BPSKIP,BPREQTYP,"6.02") I $$FILLFLDS^BPSUTIL2(9002313.77,"6.02",BPIEN77,+$G(MOREDATA("USER")))<1 Q "0^"_$$ERRFIELD(BPIEN77,1,BPERRMSG,9002313.77,6.02)
"RTN","BPSOSRX3",51,0)
 I $$FILLFLDS^BPSUTIL2(9002313.77,"6.06",BPIEN77,+DUZ)<1 Q "0^"_$$ERRFIELD(BPIEN77,1,BPERRMSG,9002313.77,6.06)
"RTN","BPSOSRX3",52,0)
 I $$ACTFIELD(BPSKIP,BPREQTYP,"1.01") I $$FILLFLDS^BPSUTIL2(9002313.77,"1.01",BPIEN77,$G(MOREDATA("RX ACTION")))<1 Q "0^"_$$ERRFIELD(BPIEN77,1,BPERRMSG,9002313.77,1.01)
"RTN","BPSOSRX3",53,0)
 I BPREQTYP="C" I $$FILLFLDS^BPSUTIL2(9002313.77,"1.04",BPIEN77,"C")<1 Q "0^"_$$ERRFIELD(BPIEN77,1,BPERRMSG,9002313.77,1.04)
"RTN","BPSOSRX3",54,0)
 I BPREQTYP="U" I $$FILLFLDS^BPSUTIL2(9002313.77,"1.04",BPIEN77,"U")<1 Q "0^"_$$ERRFIELD(BPIEN77,1,BPERRMSG,9002313.77,1.04)
"RTN","BPSOSRX3",55,0)
 ;if this is a queued "C" request then the billing will be done again upon activation so MOREDATA(BILL) is undefined
"RTN","BPSOSRX3",56,0)
 ;that is why we are not checking this field
"RTN","BPSOSRX3",57,0)
 I $$ACTFIELD(BPSKIP,BPREQTYP,"1.05") I $$FILLFLDS^BPSUTIL2(9002313.77,"1.05",BPIEN77,$P($G(MOREDATA("BILL")),U))<1 Q "0^"_$$ERRFIELD(BPIEN77,1,BPERRMSG,9002313.77,1.05)
"RTN","BPSOSRX3",58,0)
 I '$D(MOREDATA("ELIG")) I $$ACTFIELD(BPSKIP,BPREQTYP,"1.06") I $$FILLFLDS^BPSUTIL2(9002313.77,"1.06",BPIEN77,$P($G(MOREDATA("BILL")),U,3))<1 Q "0^"_$$ERRFIELD(BPIEN77,1,BPERRMSG,9002313.77,1.06)
"RTN","BPSOSRX3",59,0)
 I $D(MOREDATA("ELIG")) I $$ACTFIELD(BPSKIP,BPREQTYP,"1.06") I $$FILLFLDS^BPSUTIL2(9002313.77,"1.06",BPIEN77,$G(MOREDATA("ELIG")))<1 Q "0^"_$$ERRFIELD(BPIEN77,1,BPERRMSG,9002313.77,1.06)
"RTN","BPSOSRX3",60,0)
 I $P($G(MOREDATA("BILL")),U,2)'="" I $$ACTFIELD(BPSKIP,BPREQTYP,"1.07") I $$FILLFLDS^BPSUTIL2(9002313.77,"1.07",BPIEN77,$P($G(MOREDATA("BILL")),U,2))<1 Q "0^"_$$ERRFIELD(BPIEN77,1,BPERRMSG,9002313.77,1.07)
"RTN","BPSOSRX3",61,0)
 I $$ACTFIELD(BPSKIP,BPREQTYP,"2.01") I $$FILLFLDS^BPSUTIL2(9002313.77,"2.01",BPIEN77,+$G(MOREDATA("DATE OF SERVICE")))<1 Q "0^"_$$ERRFIELD(BPIEN77,1,BPERRMSG,9002313.77,2.01)
"RTN","BPSOSRX3",62,0)
 I $$ACTFIELD(BPSKIP,BPREQTYP,"2.02") I $$FILLFLDS^BPSUTIL2(9002313.77,"2.02",BPIEN77,$G(MOREDATA("REVERSAL REASON")))<1 Q "0^"_$$ERRFIELD(BPIEN77,1,BPERRMSG,9002313.77,2.02)
"RTN","BPSOSRX3",63,0)
 I $L($G(MOREDATA("BPOVRIEN")))>0 I $$FILLFLDS^BPSUTIL2(9002313.77,"2.04",BPIEN77,$G(MOREDATA("BPOVRIEN")))<1 Q "0^"_$$ERRFIELD(BPIEN77,1,BPERRMSG,9002313.77,2.04)
"RTN","BPSOSRX3",64,0)
 I $L($G(MOREDATA("BPSCLARF")))>0 I $$FILLFLDS^BPSUTIL2(9002313.77,"2.05",BPIEN77,$G(MOREDATA("BPSCLARF")))<1 Q "0^"_$$ERRFIELD(BPIEN77,1,BPERRMSG,9002313.77,2.05)
"RTN","BPSOSRX3",65,0)
 I $L($G(BILLNDC))>0 I $$FILLFLDS^BPSUTIL2(9002313.77,"2.06",BPIEN77,BILLNDC)<1 Q "0^"_$$ERRFIELD(BPIEN77,1,BPERRMSG,9002313.77,2.06)
"RTN","BPSOSRX3",66,0)
 I $L($P($G(MOREDATA("BPSAUTH")),U))>0 I $$FILLFLDS^BPSUTIL2(9002313.77,"2.07",BPIEN77,$E($P(MOREDATA("BPSAUTH"),U,1),1,2))<1 Q "0^"_$$ERRFIELD(BPIEN77,1,BPERRMSG,9002313.77,2.07)
"RTN","BPSOSRX3",67,0)
 I $L($P($G(MOREDATA("BPSAUTH")),U,2))>0 I $$FILLFLDS^BPSUTIL2(9002313.77,"2.08",BPIEN77,$E($P(MOREDATA("BPSAUTH"),U,2),1,11))<1 Q "0^"_$$ERRFIELD(BPIEN77,1,BPERRMSG,9002313.77,2.08)
"RTN","BPSOSRX3",68,0)
 I $$ACTFIELD(BPSKIP,BPREQTYP,"4.01") I $$FILLFLDS^BPSUTIL2(9002313.77,"4.01",BPIEN77,$P($G(MOREDATA("BPSDATA",1)),U,1))
"RTN","BPSOSRX3",69,0)
 I $$ACTFIELD(BPSKIP,BPREQTYP,"4.02") I $$FILLFLDS^BPSUTIL2(9002313.77,"4.02",BPIEN77,$P($G(MOREDATA("BPSDATA",1)),U,2))
"RTN","BPSOSRX3",70,0)
 I $$ACTFIELD(BPSKIP,BPREQTYP,"4.03") I $$FILLFLDS^BPSUTIL2(9002313.77,"4.03",BPIEN77,$P($G(MOREDATA("BPSDATA",1)),U,3))
"RTN","BPSOSRX3",71,0)
 I $$ACTFIELD(BPSKIP,BPREQTYP,"4.04") I $$FILLFLDS^BPSUTIL2(9002313.77,"4.04",BPIEN77,$P($G(MOREDATA("BPSDATA",1)),U,4))
"RTN","BPSOSRX3",72,0)
 I $P($G(MOREDATA("BPSDATA",1)),U,5)'="" I $$ACTFIELD(BPSKIP,BPREQTYP,"4.05") I $$FILLFLDS^BPSUTIL2(9002313.77,"4.05",BPIEN77,$P($G(MOREDATA("BPSDATA",1)),U,5))
"RTN","BPSOSRX3",73,0)
 I $P($G(MOREDATA("BPSDATA",1)),U,6)'="" I $$ACTFIELD(BPSKIP,BPREQTYP,"4.06") I $$FILLFLDS^BPSUTIL2(9002313.77,"4.06",BPIEN77,$P($G(MOREDATA("BPSDATA",1)),U,6))
"RTN","BPSOSRX3",74,0)
 I $$ACTFIELD(BPSKIP,BPREQTYP,"4.07") I $$FILLFLDS^BPSUTIL2(9002313.77,"4.07",BPIEN77,$P($G(MOREDATA("BPSDATA",1)),U,7))
"RTN","BPSOSRX3",75,0)
 I $G(MOREDATA("CLOSE AFT REV"))=1 I $$FILLFLDS^BPSUTIL2(9002313.77,"7.01",BPIEN77,1)<1 Q "0^"_$$ERRFIELD(BPIEN77,1,BPERRMSG,9002313.77,7.01)
"RTN","BPSOSRX3",76,0)
 I $G(MOREDATA("CLOSE AFT REV REASON"))>0 I $$FILLFLDS^BPSUTIL2(9002313.77,"7.02",BPIEN77,+$G(MOREDATA("CLOSE AFT REV REASON")))<1 Q "0^"_$$ERRFIELD(BPIEN77,1,BPERRMSG,9002313.77,7.02)
"RTN","BPSOSRX3",77,0)
 I $L($G(MOREDATA("CLOSE AFT REV COMMENT")))>0 I $$FILLFLDS^BPSUTIL2(9002313.77,"7.03",BPIEN77,$G(MOREDATA("CLOSE AFT REV COMMENT")))<1 Q "0^"_$$ERRFIELD(BPIEN77,1,BPERRMSG,9002313.77,7.03)
"RTN","BPSOSRX3",78,0)
 I $G(BPSARRY("SC/EI OVR"))=1 I $$FILLFLDS^BPSUTIL2(9002313.77,"2.09",BPIEN77,1)<1 Q "0^"_$$ERRFIELD(BPIEN77,1,BPERRMSG,9002313.77,2.09)
"RTN","BPSOSRX3",79,0)
 ;
"RTN","BPSOSRX3",80,0)
 ;store DURREC info
"RTN","BPSOSRX3",81,0)
 S BPQ=0
"RTN","BPSOSRX3",82,0)
 S DUR=0
"RTN","BPSOSRX3",83,0)
 F  S DUR=$O(MOREDATA("DUR",DUR)) Q:+DUR=0!(BPQ=1)  D
"RTN","BPSOSRX3",84,0)
 . S BPIEN771=$$INSITEM^BPSUTIL2(9002313.771,BPIEN77,$P(MOREDATA("DUR",DUR,0),U),DUR,"",,0)
"RTN","BPSOSRX3",85,0)
 . I BPIEN771<1 S BPERRMSG="Cannot create DUR record in DUR multiple of the BPS REQUEST file",BPQ=1 Q
"RTN","BPSOSRX3",86,0)
 . S BPERRMSG="Cannot populate a field in DUR multiple"
"RTN","BPSOSRX3",87,0)
 . I $$FILLFLDS^BPSUTIL2(9002313.771,".02",DUR_","_BPIEN77,$P(MOREDATA("DUR",DUR,0),U,2))<1 S BPQ=1 Q
"RTN","BPSOSRX3",88,0)
 . I $$FILLFLDS^BPSUTIL2(9002313.771,".03",DUR_","_BPIEN77,$P(MOREDATA("DUR",DUR,0),U,3))<1 S BPQ=1 Q
"RTN","BPSOSRX3",89,0)
 I BPQ=1 Q "0^"_BPERRMSG_" DUR DATA"
"RTN","BPSOSRX3",90,0)
 ;store ins to IB INSURER DATA
"RTN","BPSOSRX3",91,0)
 S BPQ=0
"RTN","BPSOSRX3",92,0)
 S BPCOB=0 F  S BPCOB=$O(BPIENS78(BPCOB)) Q:+BPCOB=0!(BPQ=1)  D
"RTN","BPSOSRX3",93,0)
 . S BPIEN772=$$INSITEM^BPSUTIL2(9002313.772,BPIEN77,BPCOB,BPCOB,"",,0)
"RTN","BPSOSRX3",94,0)
 . I BPIEN772<1 S BPERRMSG="Cannot create record in IBDATA multiple of the BPS REQUEST file",BPQ=1 Q
"RTN","BPSOSRX3",95,0)
 . S BPERRMSG="Cannot populate a field in IBDATA multiple"
"RTN","BPSOSRX3",96,0)
 . I $$FILLFLDS^BPSUTIL2(9002313.772,".02",BPCOB_","_BPIEN77,$S(BPCOBIND=BPCOB:1,1:0))<1 S BPQ=1 Q
"RTN","BPSOSRX3",97,0)
 . I $$FILLFLDS^BPSUTIL2(9002313.772,".03",BPCOB_","_BPIEN77,BPIENS78(BPCOB))<1 S BPQ=1 Q
"RTN","BPSOSRX3",98,0)
 I BPQ=1 Q "0^"_BPERRMSG_"INSURER DATA"
"RTN","BPSOSRX3",99,0)
 ;
"RTN","BPSOSRX3",100,0)
 ;return 1 (success) and IEN of the 9002313.77
"RTN","BPSOSRX3",101,0)
 Q "1^"_BPIEN77
"RTN","BPSOSRX3",102,0)
 ;
"RTN","BPSOSRX3",103,0)
 ;check if the field is used in MOREDATA for the specified REQUEST TYPE - CLAIM="C" /UNCLAIM="U"
"RTN","BPSOSRX3",104,0)
ACTFIELD(BPSKIP,BPREQTYP,BPFLD) ;
"RTN","BPSOSRX3",105,0)
 ;if reverse
"RTN","BPSOSRX3",106,0)
 I (BPREQTYP="U")!(BPSKIP=1) Q ";1.01;2.01;2.02;6.02;"[(";"_BPFLD_";")
"RTN","BPSOSRX3",107,0)
 Q 1  ;if "ERES","OF","RF"
"RTN","BPSOSRX3",108,0)
 ;
"RTN","BPSOSRX3",109,0)
 ;Lock BPS REQUEST
"RTN","BPSOSRX3",110,0)
LOCK77(BPTIMOUT,IEN59,BPSRC) ;
"RTN","BPSOSRX3",111,0)
 N BPRET
"RTN","BPSOSRX3",112,0)
 L +^BPS(9002313.77):+$G(BPTIMOUT)
"RTN","BPSOSRX3",113,0)
 S BPRET=$T
"RTN","BPSOSRX3",114,0)
 I $G(IEN59)>0 D LOG^BPSOSL(IEN59,$G(BPSRC)_$S(BPRET=1:"-Lock",1:"-Failed to Lock")_" BPS REQUEST file")
"RTN","BPSOSRX3",115,0)
 Q BPRET
"RTN","BPSOSRX3",116,0)
 ;
"RTN","BPSOSRX3",117,0)
 ;UnLock BPS REQUEST
"RTN","BPSOSRX3",118,0)
UNLOCK77(IEN59,BPSRC) ;
"RTN","BPSOSRX3",119,0)
 L -^BPS(9002313.77)
"RTN","BPSOSRX3",120,0)
 I $G(IEN59)>0 D LOG^BPSOSL(IEN59,$G(BPSRC)_"-Unlock BPS REQUEST file")
"RTN","BPSOSRX3",121,0)
 Q
"RTN","BPSOSRX3",122,0)
 ;calculate new BPS REQUEST ien
"RTN","BPSOSRX3",123,0)
NEWIEN77(BPRX,BPRF,BPTYPE) ;
"RTN","BPSOSRX3",124,0)
 N BPL,BPL1,BPDT,BPTM
"RTN","BPSOSRX3",125,0)
 S BPRX="00"_BPRX
"RTN","BPSOSRX3",126,0)
 S BPL=$L(BPRX)
"RTN","BPSOSRX3",127,0)
 S BPDT=$H
"RTN","BPSOSRX3",128,0)
 S BPL1=$L(+BPDT)
"RTN","BPSOSRX3",129,0)
 S BPTM=$P(BPDT,",",2)_"00000"
"RTN","BPSOSRX3",130,0)
 Q +($E(+BPDT,BPL1-3,BPL1)_$E(BPTM,1,5)_"."_$S($G(BPTYPE)="U":0,1:1)_$E(BPRX,BPL-2,BPL)_BPRF)
"RTN","BPSOSRX3",131,0)
 ;
"RTN","BPSOSRX3",132,0)
 ;BP77 - ien of BPS REQUEST
"RTN","BPSOSRX3",133,0)
ERRFIELD(BP77,BPRFILE,BPMESS,BPFILENO,BPFLDNO) ;
"RTN","BPSOSRX3",134,0)
 I $G(BP77)>0 D DELREQST^BPSOSRX4(BP77) ;delete incomplete record
"RTN","BPSOSRX3",135,0)
 Q $$FIELDMSG^BPSOSRX2(BPRFILE,BPMESS,BPFILENO,BPFLDNO)
"RTN","BPSOSRX3",136,0)
 ;
"RTN","BPSOSRX3",137,0)
 ;BPSOSRX3
"RTN","BPSOSRX4")
0^70^B38901734
"RTN","BPSOSRX4",1,0)
BPSOSRX4 ;ALB/SS - ECME REQUESTS ;04-JAN-08
"RTN","BPSOSRX4",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**7**;JUN 2004;Build 46
"RTN","BPSOSRX4",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSRX4",4,0)
 ;
"RTN","BPSOSRX4",5,0)
 Q
"RTN","BPSOSRX4",6,0)
 ;restore MOREDATA from the file 9002313.77
"RTN","BPSOSRX4",7,0)
READMORE(BPIEN77,MOREDATA) ;
"RTN","BPSOSRX4",8,0)
 N BPIEN772,BPCOB,BPIEN78,BPACTTYP,BPDURCNT
"RTN","BPSOSRX4",9,0)
 N BPY S BPY=""
"RTN","BPSOSRX4",10,0)
 ;S MOREDATA=0
"RTN","BPSOSRX4",11,0)
 S MOREDATA("USER")=$P($G(^BPS(9002313.77,BPIEN77,6)),U,2) ;6.02
"RTN","BPSOSRX4",12,0)
 S MOREDATA("RX ACTION")=$P($G(^BPS(9002313.77,BPIEN77,1)),U,1) ;1.01
"RTN","BPSOSRX4",13,0)
 S BPACTTYP=MOREDATA("RX ACTION")
"RTN","BPSOSRX4",14,0)
 S MOREDATA("ELIG")=$P($G(^BPS(9002313.77,BPIEN77,1)),U,6) ;1.06
"RTN","BPSOSRX4",15,0)
 S $P(MOREDATA("BILL"),U,1)=$P($G(^BPS(9002313.77,BPIEN77,1)),U,5) ;1,05
"RTN","BPSOSRX4",16,0)
 S $P(MOREDATA("BILL"),U,2)=$P($G(^BPS(9002313.77,BPIEN77,1)),U,7) ;1,07
"RTN","BPSOSRX4",17,0)
 S $P(MOREDATA("BILL"),U,3)=$P($G(^BPS(9002313.77,BPIEN77,1)),U,6) ;1,06
"RTN","BPSOSRX4",18,0)
 ;S MOREDATA("BILL")=$P($G(^BPS(9002313.77,BPIEN77,1)),U,5)_U_$P($G(^BPS(9002313.77,BPIEN77,1)),U,7)_U_$P($G(^BPS(9002313.77,BPIEN77,1)),U,6) ;1,05^1.07^1.06
"RTN","BPSOSRX4",19,0)
 S MOREDATA("DATE OF SERVICE")=$P($G(^BPS(9002313.77,BPIEN77,2)),U,1) ;2.01
"RTN","BPSOSRX4",20,0)
 S MOREDATA("REVERSAL REASON")=$P($G(^BPS(9002313.77,BPIEN77,2)),U,2) ;2.02
"RTN","BPSOSRX4",21,0)
 S $P(MOREDATA("BPSDATA",1),U,1)=$P($G(^BPS(9002313.77,BPIEN77,4)),U,1) ;4.01
"RTN","BPSOSRX4",22,0)
 S $P(MOREDATA("BPSDATA",1),U,2)=$P($G(^BPS(9002313.77,BPIEN77,4)),U,2) ;4.02
"RTN","BPSOSRX4",23,0)
 S $P(MOREDATA("BPSDATA",1),U,3)=$P($G(^BPS(9002313.77,BPIEN77,4)),U,3) ;4.03
"RTN","BPSOSRX4",24,0)
 S $P(MOREDATA("BPSDATA",1),U,4)=$P($G(^BPS(9002313.77,BPIEN77,4)),U,4) ;4.04
"RTN","BPSOSRX4",25,0)
 S $P(MOREDATA("BPSDATA",1),U,5)=$P($G(^BPS(9002313.77,BPIEN77,4)),U,5) ;4.05
"RTN","BPSOSRX4",26,0)
 S $P(MOREDATA("BPSDATA",1),U,6)=$P($G(^BPS(9002313.77,BPIEN77,4)),U,6) ;4.06
"RTN","BPSOSRX4",27,0)
 S $P(MOREDATA("BPSDATA",1),U,7)=$P($G(^BPS(9002313.77,BPIEN77,4)),U,7) ;4.07
"RTN","BPSOSRX4",28,0)
 I $L($P($G(^BPS(9002313.77,BPIEN77,2)),U,5))>0 S MOREDATA("BPSCLARF")=$$GET1^DIQ(9002313.77,BPIEN77_",",2.05,"E") ; clarification code
"RTN","BPSOSRX4",29,0)
 ;DUR override codes Reason for Service Code, Professional Service Code, Result of Service Code
"RTN","BPSOSRX4",30,0)
 S BPDURCNT=0 F  S BPDURCNT=$O(^BPS(9002313.77,BPIEN77,3,BPDURCNT)) Q:+BPDURCNT=0  D
"RTN","BPSOSRX4",31,0)
 . S MOREDATA("DUR",BPDURCNT,0)=$G(^BPS(9002313.77,BPIEN77,3,BPDURCNT,0))
"RTN","BPSOSRX4",32,0)
 I $L($P($G(^BPS(9002313.77,BPIEN77,2)),U,7))>0 S $P(MOREDATA("BPSAUTH"),U,1)=$P($G(^BPS(9002313.77,BPIEN77,2)),U,7) ;preauth.code
"RTN","BPSOSRX4",33,0)
 I $L($P($G(^BPS(9002313.77,BPIEN77,2)),U,8))>0 S $P(MOREDATA("BPSAUTH"),U,2)=$P($G(^BPS(9002313.77,BPIEN77,2)),U,8) ;preauth number
"RTN","BPSOSRX4",34,0)
 I $L($P($G(^BPS(9002313.77,BPIEN77,2)),U,4))>0 S MOREDATA("BPOVRIEN")=$P($G(^BPS(9002313.77,BPIEN77,2)),U,4) ;overide code (RED option)
"RTN","BPSOSRX4",35,0)
 S BPIEN772=0 F  S BPIEN772=$O(^BPS(9002313.77,BPIEN77,5,BPIEN772)) Q:+BPIEN772=0  D
"RTN","BPSOSRX4",36,0)
 . S BPCOB=+$G(^BPS(9002313.77,BPIEN77,5,BPIEN772,0)) ;.01
"RTN","BPSOSRX4",37,0)
 . S BPIEN78=+$P($G(^BPS(9002313.77,BPIEN77,5,BPIEN772,0)),U,3) ;.03
"RTN","BPSOSRX4",38,0)
 . S $P(MOREDATA("IBDATA",BPCOB,1),U,1)=$P($G(^BPS(9002313.78,BPIEN78,0)),U,8) ;.08
"RTN","BPSOSRX4",39,0)
 . S $P(MOREDATA("IBDATA",BPCOB,1),U,2)=$P($G(^BPS(9002313.78,BPIEN78,1)),U,1) ;1.01
"RTN","BPSOSRX4",40,0)
 . S $P(MOREDATA("IBDATA",BPCOB,1),U,3)=$P($G(^BPS(9002313.78,BPIEN78,1)),U,2) ;1.02
"RTN","BPSOSRX4",41,0)
 . S $P(MOREDATA("IBDATA",BPCOB,1),U,4)=$P($G(^BPS(9002313.78,BPIEN78,4)),U,1) ;4.01
"RTN","BPSOSRX4",42,0)
 . S $P(MOREDATA("IBDATA",BPCOB,1),U,5)=$P($G(^BPS(9002313.78,BPIEN78,1)),U,3) ;1.03
"RTN","BPSOSRX4",43,0)
 . S $P(MOREDATA("IBDATA",BPCOB,1),U,6)=$P($G(^BPS(9002313.78,BPIEN78,1)),U,4) ;1.04
"RTN","BPSOSRX4",44,0)
 . S $P(MOREDATA("IBDATA",BPCOB,1),U,7)=$P($G(^BPS(9002313.78,BPIEN78,1)),U,5) ;1.05
"RTN","BPSOSRX4",45,0)
 . S $P(MOREDATA("IBDATA",BPCOB,1),U,8)=$P($G(^BPS(9002313.78,BPIEN78,1)),U,6) ;1.06
"RTN","BPSOSRX4",46,0)
 . S $P(MOREDATA("IBDATA",BPCOB,1),U,9)=$P($G(^BPS(9002313.78,BPIEN78,1)),U,7) ;1.07
"RTN","BPSOSRX4",47,0)
 . S $P(MOREDATA("IBDATA",BPCOB,1),U,10)=$P($G(^BPS(9002313.78,BPIEN78,1)),U,8) ;1.08
"RTN","BPSOSRX4",48,0)
 . S $P(MOREDATA("IBDATA",BPCOB,1),U,11)=$P($G(^BPS(9002313.78,BPIEN78,4)),U,2) ;4.02
"RTN","BPSOSRX4",49,0)
 . S $P(MOREDATA("IBDATA",BPCOB,1),U,12)=$P($G(^BPS(9002313.78,BPIEN78,4)),U,3) ;4.03
"RTN","BPSOSRX4",50,0)
 . S $P(MOREDATA("IBDATA",BPCOB,1),U,13)=$P($G(^BPS(9002313.78,BPIEN78,2)),U,6) ;2.06
"RTN","BPSOSRX4",51,0)
 . S $P(MOREDATA("IBDATA",BPCOB,1),U,14)=$P($G(^BPS(9002313.78,BPIEN78,0)),U,7) ;.07
"RTN","BPSOSRX4",52,0)
 . S $P(MOREDATA("IBDATA",BPCOB,2),U,1)=$P($G(^BPS(9002313.78,BPIEN78,2)),U,1) ;2.01
"RTN","BPSOSRX4",53,0)
 . S $P(MOREDATA("IBDATA",BPCOB,2),U,2)=$P($G(^BPS(9002313.78,BPIEN78,2)),U,2) ;2.02
"RTN","BPSOSRX4",54,0)
 . S $P(MOREDATA("IBDATA",BPCOB,2),U,3)=$P($G(^BPS(9002313.78,BPIEN78,2)),U,3) ;2.03
"RTN","BPSOSRX4",55,0)
 . S $P(MOREDATA("IBDATA",BPCOB,2),U,4)=$P($G(^BPS(9002313.78,BPIEN78,2)),U,4) ;2.04
"RTN","BPSOSRX4",56,0)
 . S $P(MOREDATA("IBDATA",BPCOB,2),U,5)=$P($G(^BPS(9002313.78,BPIEN78,2)),U,5) ;2.05
"RTN","BPSOSRX4",57,0)
 . S $P(MOREDATA("IBDATA",BPCOB,3),U,1)=$P($G(^BPS(9002313.78,BPIEN78,3)),U,1) ;3.01
"RTN","BPSOSRX4",58,0)
 . S $P(MOREDATA("IBDATA",BPCOB,3),U,2)=$P($G(^BPS(9002313.78,BPIEN78,3)),U,2) ;3.02
"RTN","BPSOSRX4",59,0)
 . S $P(MOREDATA("IBDATA",BPCOB,3),U,3)=$P($G(^BPS(9002313.78,BPIEN78,3)),U,3) ;3.03
"RTN","BPSOSRX4",60,0)
 . S $P(MOREDATA("IBDATA",BPCOB,3),U,4)=$P($G(^BPS(9002313.78,BPIEN78,3)),U,4) ;3.04
"RTN","BPSOSRX4",61,0)
 . S $P(MOREDATA("IBDATA",BPCOB,3),U,5)=$P($G(^BPS(9002313.78,BPIEN78,3)),U,5) ;3.05
"RTN","BPSOSRX4",62,0)
 Q
"RTN","BPSOSRX4",63,0)
 ;
"RTN","BPSOSRX4",64,0)
 ;change Process flag to "COMPLETED"
"RTN","BPSOSRX4",65,0)
COMPLETD(BPIEN77) ;
"RTN","BPSOSRX4",66,0)
 Q $$CHNGPRFL^BPSOSRX6(BPIEN77,3)
"RTN","BPSOSRX4",67,0)
 ;
"RTN","BPSOSRX4",68,0)
 ;inactivate BPS REQUEST
"RTN","BPSOSRX4",69,0)
INACTIVE(BPIEN77) ;
"RTN","BPSOSRX4",70,0)
 Q $$CHNGPRFL^BPSOSRX6(BPIEN77,5)
"RTN","BPSOSRX4",71,0)
 ;activate the request - change Process flag to "ACTIVATED"
"RTN","BPSOSRX4",72,0)
ACTIVATE(BPIEN77) ;
"RTN","BPSOSRX4",73,0)
 ;do we need to check what was the status of previous one - if it was rejected then we shouldn't activate it?
"RTN","BPSOSRX4",74,0)
 Q $$CHNGPRFL^BPSOSRX6(BPIEN77,1)
"RTN","BPSOSRX4",75,0)
 ;
"RTN","BPSOSRX4",76,0)
 ;change Process flag to "IN PROCESS"
"RTN","BPSOSRX4",77,0)
INPROCES(BPIEN77) ;
"RTN","BPSOSRX4",78,0)
 Q $$CHNGPRFL^BPSOSRX6(BPIEN77,2)
"RTN","BPSOSRX4",79,0)
 ;
"RTN","BPSOSRX4",80,0)
 ;delete BPS REQUEST record
"RTN","BPSOSRX4",81,0)
DELREQST(BPIEN77) ;
"RTN","BPSOSRX4",82,0)
 N BPCOB
"RTN","BPSOSRX4",83,0)
 N DIK,DA
"RTN","BPSOSRX4",84,0)
 I $$INACTIVE(BPIEN77)
"RTN","BPSOSRX4",85,0)
 ;Q
"RTN","BPSOSRX4",86,0)
 S BPCOB=0
"RTN","BPSOSRX4",87,0)
 F  S BPCOB=$O(^BPS(9002313.77,BPIEN77,5,BPCOB)) Q:+BPCOB=0  D
"RTN","BPSOSRX4",88,0)
 . S DIK="^BPS(9002313.78,"
"RTN","BPSOSRX4",89,0)
 . S DA=+$P($G(^BPS(9002313.77,BPIEN77,5,BPCOB,0)),U,3)
"RTN","BPSOSRX4",90,0)
 . D ^DIK
"RTN","BPSOSRX4",91,0)
 ;
"RTN","BPSOSRX4",92,0)
 S DIK="^BPS(9002313.77,"
"RTN","BPSOSRX4",93,0)
 S DA=BPIEN77
"RTN","BPSOSRX4",94,0)
 D ^DIK
"RTN","BPSOSRX4",95,0)
 Q
"RTN","BPSOSRX4",96,0)
 ;
"RTN","BPSOSRX4",97,0)
 ;update fields in BPS REQUEST and BPS TRANSACTION
"RTN","BPSOSRX4",98,0)
UPD7759(BP77,IEN59) ;
"RTN","BPSOSRX4",99,0)
 N BPTYPE,BPSTIME,BPCOB,BPZ
"RTN","BPSOSRX4",100,0)
 I +$G(BP77)=0!(+$G(IEN59)=0) Q
"RTN","BPSOSRX4",101,0)
 D LOG^BPSOSL(IEN59,$T(+0)_"-Populating fields in BPS Transaction "_IEN59_" and request "_BP77)
"RTN","BPSOSRX4",102,0)
 I $$FILLFLDS^BPSUTIL2(9002313.59,"16",IEN59,BP77)<1 D LOG^BPSOSL(IEN59,$T(+0)_"-Cannot populate (#16) of (#9002313.59)")
"RTN","BPSOSRX4",103,0)
 S BPSTIME=+$P($G(^BPS(9002313.77,BP77,6)),U,1) I $$FILLFLDS^BPSUTIL2(9002313.59,"17",IEN59,BPSTIME)<1 D LOG^BPSOSL(IEN59,$T(+0)_"-Cannot populate (#17) of (#9002313.59)")
"RTN","BPSOSRX4",104,0)
 S BPCOB=+$P($G(^BPS(9002313.77,BP77,0)),U,3) I $$FILLFLDS^BPSUTIL2(9002313.59,"18",IEN59,$S(BPCOB=0:1,1:BPCOB))<1 D LOG^BPSOSL(IEN59,$T(+0)_"-Cannot populate (#18) of (#9002313.59)")
"RTN","BPSOSRX4",105,0)
 I $$FILLFLDS^BPSUTIL2(9002313.77,".06",BP77,IEN59)<1 D LOG^BPSOSL(IEN59,$T(+0)_"-Cannot populate (#.06) of (#9002313.77)")
"RTN","BPSOSRX4",106,0)
 S BPZ=$$UPUSRTIM^BPSOSRX6(BP77,$S($G(DUZ):+DUZ,1:.5)) I +BPZ=0 D LOG^BPSOSL(IEN59,$T(+0)_$P(BPZ,U,2))
"RTN","BPSOSRX4",107,0)
 S BPTYPE=$P($G(^BPS(9002313.77,BP77,1)),U,4)
"RTN","BPSOSRX4",108,0)
 I BPTYPE="C"!(BPTYPE="U") D  Q
"RTN","BPSOSRX4",109,0)
 . I $$FILLFLDS^BPSUTIL2(9002313.59,"19",IEN59,BPTYPE)<1 D LOG^BPSOSL(IEN59,$T(+0)_"-Cannot populate (#19) of (#9002313.59)")
"RTN","BPSOSRX4",110,0)
 . I $$FILLFLDS^BPSUTIL2(9002313.59,"7",IEN59,+$$NOW^BPSOSRX())<1 D LOG^BPSOSL(IEN59,$T(+0)_"-Cannot populate (#7) of (#9002313.59)")
"RTN","BPSOSRX4",111,0)
 . I BPTYPE="C" Q
"RTN","BPSOSRX4",112,0)
 . ;if UNCLAIM (reversal)
"RTN","BPSOSRX4",113,0)
 . I $$FILLFLDS^BPSUTIL2(9002313.59,"405",IEN59,BP77)<1 D LOG^BPSOSL(IEN59,$T(+0)_"-Cannot populate (#405) of (#9002313.59)")
"RTN","BPSOSRX4",114,0)
 . I $$FILLFLDS^BPSUTIL2(9002313.59,"406",IEN59,BPSTIME)<1 D LOG^BPSOSL(IEN59,$T(+0)_"-Cannot populate (#406) of (#9002313.59)")
"RTN","BPSOSRX4",115,0)
 ; verify and populate the field (#.06) of BPS REQUEST with the BPS TRANSACTION ien
"RTN","BPSOSRX4",116,0)
 D LOG^BPSOSL(IEN59,$T(+0)_"-Unknown Transaction Type")
"RTN","BPSOSRX4",117,0)
 Q
"RTN","BPSOSRX4",118,0)
 ;
"RTN","BPSOSRX5")
0^71^B30558901
"RTN","BPSOSRX5",1,0)
BPSOSRX5 ;ALB/SS - ECME REQUESTS ;10-JAN-08
"RTN","BPSOSRX5",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**7**;JUN 2004;Build 46
"RTN","BPSOSRX5",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSRX5",4,0)
 ;
"RTN","BPSOSRX5",5,0)
 ; if Resubmit then check was the previous UNCLAIM accepted 
"RTN","BPSOSRX5",6,0)
 ; (Cannot resubmit reversed claims unless they are accepted)
"RTN","BPSOSRX5",7,0)
 ;
"RTN","BPSOSRX5",8,0)
TODAY() ;
"RTN","BPSOSRX5",9,0)
 D NOW^%DTC
"RTN","BPSOSRX5",10,0)
 Q $P(%,".",1)
"RTN","BPSOSRX5",11,0)
 ;
"RTN","BPSOSRX5",12,0)
 ;check if according the last response the payer IS going to PAY
"RTN","BPSOSRX5",13,0)
 ;(Note: reversals can be done only on previously payable claims, if reversal failed then the claim stays PAYABLE)
"RTN","BPSOSRX5",14,0)
PAYABLE(BPRESP) ;
"RTN","BPSOSRX5",15,0)
 Q ",E PAYABLE,E DUPLICATE,E REVERSAL REJECTED,E REVERSAL OTHER,E REVERSAL UNSTRANDED,"[(","_BPRESP_",")
"RTN","BPSOSRX5",16,0)
 ;
"RTN","BPSOSRX5",17,0)
 ;Action type
"RTN","BPSOSRX5",18,0)
ACTTYPE(BWHR) ;
"RTN","BPSOSRX5",19,0)
 Q:",AREV,CRLR,CRLX,DC,DDED,DE,EREV,HLD,RS,"[(","_BWHR_",") "U"  ;UNCLAIM (reversal)
"RTN","BPSOSRX5",20,0)
 Q:",CRLB,ED,ERES,RL,RRL,"[(","_BWHR_",") "UC"  ;UNCLAIM (reversal) + CLAIM (resubmit)
"RTN","BPSOSRX5",21,0)
 Q:",ARES,BB,OF,PC,PE,PL,PP,RF,RN,"[(","_BWHR_",") "C"  ;CLAIM (the very first submit OR resubmit only)
"RTN","BPSOSRX5",22,0)
 Q ""  ;unknown
"RTN","BPSOSRX5",23,0)
 ;
"RTN","BPSOSRX5",24,0)
 ;Check ECME availability at the site
"RTN","BPSOSRX5",25,0)
 ;return :
"RTN","BPSOSRX5",26,0)
 ; 1^CLMSTAT -off
"RTN","BPSOSRX5",27,0)
 ; null -on
"RTN","BPSOSRX5",28,0)
ECMESITE(SITE) ;
"RTN","BPSOSRX5",29,0)
 I '$G(SITE) Q "1^No Site Information"
"RTN","BPSOSRX5",30,0)
 I '$$ECMEON^BPSUTIL(SITE) Q "1^ECME switch is not on for the site"
"RTN","BPSOSRX5",31,0)
 Q ""
"RTN","BPSOSRX5",32,0)
 ;
"RTN","BPSOSRX5",33,0)
 ;is called by STATUS99^BPSOSU when the status of the current claim becomes 99%
"RTN","BPSOSRX5",34,0)
 ;Activates the next scheduled request if any
"RTN","BPSOSRX5",35,0)
 ;
"RTN","BPSOSRX5",36,0)
 ;input:
"RTN","BPSOSRX5",37,0)
 ;IEN59 - BPS TRANSACTION ien
"RTN","BPSOSRX5",38,0)
 ;BPCLMST - claim status
"RTN","BPSOSRX5",39,0)
 ;     For submissions (type =C):
"RTN","BPSOSRX5",40,0)
 ;       E PAYABLE, E CAPTURED, E DUPLICATE, E REJECTED, E OTHER, and
"RTN","BPSOSRX5",41,0)
 ;       E STRANDED
"RTN","BPSOSRX5",42,0)
 ;
"RTN","BPSOSRX5",43,0)
 ;     For Reversals (type =U):
"RTN","BPSOSRX5",44,0)
 ;       E REVERSAL ACCEPTED, E REVERSAL REJECTED, E REVERSAL OTHER, and
"RTN","BPSOSRX5",45,0)
 ;       E REVERSAL STRANDED
"RTN","BPSOSRX5",46,0)
 ;
"RTN","BPSOSRX5",47,0)
 ;output:
"RTN","BPSOSRX5",48,0)
 ; return 0 if there is no any next request for the RX/refill
"RTN","BPSOSRX5",49,0)
 ; otherwise - return IEN of next BPS REQUEST
"RTN","BPSOSRX5",50,0)
REQST99(IEN59,BPCLMST) ;
"RTN","BPSOSRX5",51,0)
 N BPLCK,BPRXRF,RXI,RXR,BPRETV,BPTYPE,RESAFTRV
"RTN","BPSOSRX5",52,0)
 N BFILLDAT,BWHERE,BILLNDC,REVREAS,DURREC,BPOVRIEN,BPSCLARF,BPSAUTH,BPCOBIND,BPDUR,BPTYPNXT
"RTN","BPSOSRX5",53,0)
 S RESAFTRV=0
"RTN","BPSOSRX5",54,0)
 ;get RX and Rf by ien59
"RTN","BPSOSRX5",55,0)
 S BPRXRF=$$RXREF^BPSSCRU2(IEN59)
"RTN","BPSOSRX5",56,0)
 S RXI=+BPRXRF,RXR=$P(BPRXRF,U,2)
"RTN","BPSOSRX5",57,0)
 ;get lock - to decide what to do with the new next request
"RTN","BPSOSRX5",58,0)
 ;Example 
"RTN","BPSOSRX5",59,0)
 ;if this request (Request A) is the last one in the chain and we just received a new request (Request B)
"RTN","BPSOSRX5",60,0)
 ;for the same RX/RF, - then the Request B needs to be activated after Request A has been completed. 
"RTN","BPSOSRX5",61,0)
 ;Who will be doing this?
"RTN","BPSOSRX5",62,0)
 ;Situation 1:
"RTN","BPSOSRX5",63,0)
 ;if this code REQST99^BPSOSRX5 gets the lock first then it will not be able to activate Request B (because we don't have it 
"RTN","BPSOSRX5",64,0)
 ;in the NEXT REQUEST field). So Request A will be completed and when the REQST^BPSOSRX code gets the lock it will 
"RTN","BPSOSRX5",65,0)
 ;find Request A as completed and will not populate the NEXT REQUEST field of Request A - instead it will just activate
"RTN","BPSOSRX5",66,0)
 ;the new Request B.
"RTN","BPSOSRX5",67,0)
 ;Situation 2:
"RTN","BPSOSRX5",68,0)
 ;if the REQST^BPSOSRX code gets the lock first then it will check the status of the Request A and since it is still "IN PROCESS"
"RTN","BPSOSRX5",69,0)
 ;then it will populate the NEXT REQUEST field of the Request 1 with ien of Request 2, and then release the lock.
"RTN","BPSOSRX5",70,0)
 ;Then when the REQST99^BPSOSRX5 gets the lock it checks the NEXT REQUEST field and activate the request 2
"RTN","BPSOSRX5",71,0)
 ;
"RTN","BPSOSRX5",72,0)
 S BPLCK=$$LOCKRF^BPSOSRX(RXI,RXR,10,IEN59,$T(+0))
"RTN","BPSOSRX5",73,0)
 I 'BPLCK D  Q 0
"RTN","BPSOSRX5",74,0)
 . D LOG^BPSOSL(IEN59,$T(+0)_"-RX/RF Locked")
"RTN","BPSOSRX5",75,0)
 . D LOG^BPSOSL(IEN59,$T(+0)_"-Cannot lock RX/RF in REQST99 (STATUS99) "_$P(BPRETV,U,2))
"RTN","BPSOSRX5",76,0)
 N BP77,BPNXT77,BPRET
"RTN","BPSOSRX5",77,0)
 S BP77=+$P($G(^BPST(IEN59,0)),U,12)
"RTN","BPSOSRX5",78,0)
 I BP77=0 D LOG^BPSOSL(IEN59,$T(+0)_"-SUBMIT REQUEST not populated") D:BPLCK UNLCKRF^BPSOSRX(RXI,RXR,IEN59,$T(+0)) Q 0
"RTN","BPSOSRX5",79,0)
 S BPRETV=$$COMPLETD^BPSOSRX4(BP77) I +BPRETV=0 D  Q 0
"RTN","BPSOSRX5",80,0)
 . D LOG^BPSOSL(IEN59,$T(+0)_"-Cannot change the PROCESS FLAG to COMPLETED: "_$P(BPRETV,U,2))
"RTN","BPSOSRX5",81,0)
 . D:BPLCK UNLCKRF^BPSOSRX(RXI,RXR,IEN59,$T(+0))
"RTN","BPSOSRX5",82,0)
 D LOG^BPSOSL(IEN59,$T(+0)_"-The request "_BP77_" has been changed to COMPLETED ("_+$P($G(^BPS(9002313.77,BP77,0)),U,4)_")")
"RTN","BPSOSRX5",83,0)
 S BPTYPE=$P($G(^BPS(9002313.77,BP77,1)),U,4)
"RTN","BPSOSRX5",84,0)
 ;
"RTN","BPSOSRX5",85,0)
 ;Skip and delete duplicate requests if any
"RTN","BPSOSRX5",86,0)
 ;and get the NEXT REQUEST
"RTN","BPSOSRX5",87,0)
 S BPNXT77=+$$GETNXREQ^BPSOSRX6(BP77,1,1,IEN59)
"RTN","BPSOSRX5",88,0)
 ;
"RTN","BPSOSRX5",89,0)
 ;if this was reversal (UNCLAIM)
"RTN","BPSOSRX5",90,0)
 ;- the following request is scheduled
"RTN","BPSOSRX5",91,0)
 ;- the next request is "CLAIM"
"RTN","BPSOSRX5",92,0)
 ;- the RX action is = resubmit (ERES)
"RTN","BPSOSRX5",93,0)
 ;then this is a submit after reversal
"RTN","BPSOSRX5",94,0)
 I BPTYPE="U",$P($G(^BPS(9002313.77,+BPNXT77,1)),U,4)="C",$P($G(^BPS(9002313.77,+BPNXT77,1)),U,1)="ERES" S RESAFTRV=1
"RTN","BPSOSRX5",95,0)
 I RESAFTRV=1 D LOG^BPSOSL(IEN59,$T(+0)_"-Reverse then Resubmit attempt")
"RTN","BPSOSRX5",96,0)
 ;
"RTN","BPSOSRX5",97,0)
 ;if the current request is failed then cancel and delete all sequential requests and quit
"RTN","BPSOSRX5",98,0)
 I $$SUCCESS^BPSOSRX7(BPTYPE,BPCLMST)=0 D  D:BPLCK UNLCKRF^BPSOSRX(RXI,RXR,IEN59,$T(+0)) Q 0
"RTN","BPSOSRX5",99,0)
 . D LOG^BPSOSL(IEN59,$T(+0)_" request failed - removing this and all sequential requests")
"RTN","BPSOSRX5",100,0)
 . I RESAFTRV=1 D LOG^BPSOSL(IEN59,$T(+0)_"Cannot - Reversal failed - E REVERSAL REJECTED")
"RTN","BPSOSRX5",101,0)
 . D DELALLRQ^BPSOSRX7(BP77,IEN59)
"RTN","BPSOSRX5",102,0)
 ;
"RTN","BPSOSRX5",103,0)
 ;If there is no any "next request" for the RX/refill - delete the completed request and quit with 0
"RTN","BPSOSRX5",104,0)
 I BPNXT77=0 D  Q 0
"RTN","BPSOSRX5",105,0)
 . D LOG^BPSOSL(IEN59,$T(+0)_"-There is no NEXT REQUEST")
"RTN","BPSOSRX5",106,0)
 . D DELREQST^BPSOSRX4(BP77) D:BPLCK UNLCKRF^BPSOSRX(RXI,RXR,IEN59,$T(+0))
"RTN","BPSOSRX5",107,0)
 ;
"RTN","BPSOSRX5",108,0)
 ;if NEXT REQUEST
"RTN","BPSOSRX5",109,0)
 D LOG^BPSOSL(IEN59,$T(+0)_"-The NEXT "_$P($G(^BPS(9002313.77,+BPNXT77,1)),U,4)_"-type REQUEST is "_BPNXT77)
"RTN","BPSOSRX5",110,0)
 ;
"RTN","BPSOSRX5",111,0)
 I RESAFTRV=1 D LOG^BPSOSL(IEN59,$T(+0)_"-Now resubmit")
"RTN","BPSOSRX5",112,0)
 S BFILLDAT=+$P($G(^BPS(9002313.77,BPNXT77,2)),U)
"RTN","BPSOSRX5",113,0)
 S BWHERE=$P($G(^BPS(9002313.77,BPNXT77,1)),U)
"RTN","BPSOSRX5",114,0)
 S BILLNDC=$P($G(^BPS(9002313.77,BPNXT77,2)),U,6) ;if we do not send it then BPSNCPDP will get the latest NDC
"RTN","BPSOSRX5",115,0)
 S REVREAS=$P($G(^BPS(9002313.77,BPNXT77,2)),U,2)
"RTN","BPSOSRX5",116,0)
 S DURREC=""
"RTN","BPSOSRX5",117,0)
 S BPDUR=$O(^BPS(9002313.77,BPNXT77,3,"")) I BPDUR S DURREC=^BPS(9002313.77,BPNXT77,3,BPDUR,0)
"RTN","BPSOSRX5",118,0)
 S BPOVRIEN=$P($G(^BPS(9002313.77,BPNXT77,2)),U,4)
"RTN","BPSOSRX5",119,0)
 S BPSCLARF=$P($G(^BPS(9002313.77,BPNXT77,2)),U,5)
"RTN","BPSOSRX5",120,0)
 S BPSAUTH=$P($G(^BPS(9002313.77,BPNXT77,2)),U,7) I BPSAUTH'="" S BPSAUTH=BPSAUTH_U_$P($G(^BPS(9002313.77,BPNXT77,2)),U,8)
"RTN","BPSOSRX5",121,0)
 S BPCOBIND=+$P($G(^BPS(9002313.77,BPNXT77,0)),U,3)
"RTN","BPSOSRX5",122,0)
 ;S BPJOBFLG="B"
"RTN","BPSOSRX5",123,0)
 ;S BPREQIEN=BPNXT77
"RTN","BPSOSRX5",124,0)
 ;call ECME engine in "B" (background) mode to:
"RTN","BPSOSRX5",125,0)
 ; perform checks if necessary,
"RTN","BPSOSRX5",126,0)
 ; update billing info if this is a CLAIM
"RTN","BPSOSRX5",127,0)
 ; and then activate the request
"RTN","BPSOSRX5",128,0)
 S BPRET=$$EN^BPSNCPDP(RXI,RXR,BFILLDAT,BWHERE,BILLNDC,REVREAS,DURREC,BPOVRIEN,BPSCLARF,BPSAUTH,BPCOBIND,"B",BPNXT77)
"RTN","BPSOSRX5",129,0)
 ;if wasn't successful
"RTN","BPSOSRX5",130,0)
 I +BPRET'=0 D  Q 0
"RTN","BPSOSRX5",131,0)
 . D LOG^BPSOSL(IEN59,$T(+0)_"-Cannot activate the next request: "_$P(BPRET,U,2))
"RTN","BPSOSRX5",132,0)
 . D DELALLRQ^BPSOSRX7(BP77,IEN59)
"RTN","BPSOSRX5",133,0)
 . D:BPLCK UNLCKRF^BPSOSRX(RXI,RXR,IEN59,$T(+0))
"RTN","BPSOSRX5",134,0)
 ;if successful
"RTN","BPSOSRX5",135,0)
 D LOG^BPSOSL(IEN59,$T(+0)_"-The NEXT "_$P($G(^BPS(9002313.77,+BPNXT77,1)),U,4)_"-type REQUEST "_BPNXT77_" has been activated")
"RTN","BPSOSRX5",136,0)
 ;delete the completed REQUEST only if the next one has been activated successfully
"RTN","BPSOSRX5",137,0)
 D DELREQST^BPSOSRX4(BP77)
"RTN","BPSOSRX5",138,0)
 D:BPLCK UNLCKRF^BPSOSRX(RXI,RXR,IEN59,$T(+0))
"RTN","BPSOSRX5",139,0)
 Q BPNXT77
"RTN","BPSOSRX5",140,0)
 ;BPSOSRX5
"RTN","BPSOSRX6")
0^72^B25462490
"RTN","BPSOSRX6",1,0)
BPSOSRX6 ;ALB/SS - ECME REQUESTS ;02-JAN-08
"RTN","BPSOSRX6",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**7**;JUN 2004;Build 46
"RTN","BPSOSRX6",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSRX6",4,0)
 ;
"RTN","BPSOSRX6",5,0)
 ;to change the PROCESS FLAG status of the request
"RTN","BPSOSRX6",6,0)
 ; BPIEN77 - BPS REQUEST ien
"RTN","BPSOSRX6",7,0)
 ; BPSTAT - new PROCESS FLAG value
"RTN","BPSOSRX6",8,0)
 ; returns
"RTN","BPSOSRX6",9,0)
 ; 1^the BPIEN77
"RTN","BPSOSRX6",10,0)
 ; or 
"RTN","BPSOSRX6",11,0)
 ; 0^error message
"RTN","BPSOSRX6",12,0)
CHNGPRFL(BPIEN77,BPSTAT) ;
"RTN","BPSOSRX6",13,0)
 N BPNODES,RXI,RXR
"RTN","BPSOSRX6",14,0)
 S BPNODES(0)=$G(^BPS(9002313.77,BPIEN77,0))
"RTN","BPSOSRX6",15,0)
 S RXI=+$P(BPNODES(0),U)
"RTN","BPSOSRX6",16,0)
 S RXR=+$P(BPNODES(0),U,2)
"RTN","BPSOSRX6",17,0)
 I '$G(RXI) Q "0^RX null error"
"RTN","BPSOSRX6",18,0)
 I '$G(RXR) S RXR=0
"RTN","BPSOSRX6",19,0)
 I $$FILLFLDS^BPSUTIL2(9002313.77,".04",BPIEN77,BPSTAT)<1 Q "0^Cannot update field #.04 (PROCESS FLAG) in BPS REQUEST"
"RTN","BPSOSRX6",20,0)
 ;update user and time
"RTN","BPSOSRX6",21,0)
 Q $$UPUSRTIM(BPIEN77,+$G(MOREDATA("USER")))
"RTN","BPSOSRX6",22,0)
 ;
"RTN","BPSOSRX6",23,0)
 ;to set NEXT REQUEST field
"RTN","BPSOSRX6",24,0)
 ; BPIEN77 - BPS REQUEST ien
"RTN","BPSOSRX6",25,0)
 ; BPNXTREQ - the NEXT REQUEST ien 
"RTN","BPSOSRX6",26,0)
 ; returns
"RTN","BPSOSRX6",27,0)
 ; 1^the BPIEN77
"RTN","BPSOSRX6",28,0)
 ; or 
"RTN","BPSOSRX6",29,0)
 ; 0^error message
"RTN","BPSOSRX6",30,0)
NXTREQST(BPIEN77,BPNXTREQ) ;
"RTN","BPSOSRX6",31,0)
 N BPNODES,RXI,RXR
"RTN","BPSOSRX6",32,0)
 S BPNODES(0)=$G(^BPS(9002313.77,BPIEN77,0))
"RTN","BPSOSRX6",33,0)
 S RXI=+$P(BPNODES(0),U)
"RTN","BPSOSRX6",34,0)
 S RXR=+$P(BPNODES(0),U,2)
"RTN","BPSOSRX6",35,0)
 I '$G(RXI) Q "0^RX null error"
"RTN","BPSOSRX6",36,0)
 I '$G(RXR) S RXR=0
"RTN","BPSOSRX6",37,0)
 I BPIEN77=BPNXTREQ Q "0^Next and current requests cannot be the same"
"RTN","BPSOSRX6",38,0)
 I $$FILLFLDS^BPSUTIL2(9002313.77,".05",BPIEN77,BPNXTREQ)<1 Q "0^Cannot update field #.05 (NEXT REQUEST) in BPS REQUEST"
"RTN","BPSOSRX6",39,0)
 ;update user and time and quit (return 1^ien77 if success)
"RTN","BPSOSRX6",40,0)
 Q $$UPUSRTIM(BPIEN77,+$G(MOREDATA("USER")))
"RTN","BPSOSRX6",41,0)
 ;
"RTN","BPSOSRX6",42,0)
 ;any active requests for the RX/refill? = scheduled,activated,in process,comleted but not activated yet
"RTN","BPSOSRX6",43,0)
 ;BPSRX - ien #52
"RTN","BPSOSRX6",44,0)
 ;BPSRF - refill no
"RTN","BPSOSRX6",45,0)
 ;BPONLY - 
"RTN","BPSOSRX6",46,0)
 ;returns
"RTN","BPSOSRX6",47,0)
 ;1 - yes
"RTN","BPSOSRX6",48,0)
 ;0 -no
"RTN","BPSOSRX6",49,0)
ACTREQS(BPSRX,BPSRF,BPONLY) ;
"RTN","BPSOSRX6",50,0)
 N BPZZ,BPACTRQ
"RTN","BPSOSRX6",51,0)
 S BPACTRQ=0
"RTN","BPSOSRX6",52,0)
 F BPZZ=0,1,2,3 I $D(^BPS(9002313.77,"AC",BPZZ,BPSRX,BPSRF)) S BPACTRQ=1 Q:BPACTRQ=1
"RTN","BPSOSRX6",53,0)
 Q BPACTRQ
"RTN","BPSOSRX6",54,0)
 ;update time and user id
"RTN","BPSOSRX6",55,0)
 ;BPIEN77 - BPS REQUEST ien
"RTN","BPSOSRX6",56,0)
 ;BPUSER - user's DUZ
"RTN","BPSOSRX6",57,0)
 ;returns 1^BPIEN77
"RTN","BPSOSRX6",58,0)
 ;or 0^error message
"RTN","BPSOSRX6",59,0)
UPUSRTIM(BPIEN77,BPUSER) ;
"RTN","BPSOSRX6",60,0)
 I $$FILLFLDS^BPSUTIL2(9002313.77,"6.05",BPIEN77,+$$NOW^BPSOSRX())<1 Q "0^Cannot update the field #6.05 in BPS REQUEST"  ;S SUBMITDT=$$NOW
"RTN","BPSOSRX6",61,0)
 I $$FILLFLDS^BPSUTIL2(9002313.77,"6.06",BPIEN77,+BPUSER)<1 Q "0^Cannot update the field #6.06 in BPS REQUEST"  ;USER
"RTN","BPSOSRX6",62,0)
 Q "1^"_BPIEN77
"RTN","BPSOSRX6",63,0)
 ;remove all active requests for the RX/refill
"RTN","BPSOSRX6",64,0)
DELACTRQ(BPSRX,BPSRF) ;
"RTN","BPSOSRX6",65,0)
 N BP77
"RTN","BPSOSRX6",66,0)
 F BPZZ=0,1,2,3 D
"RTN","BPSOSRX6",67,0)
 . S BP77=0 F  S BP77=$O(^BPS(9002313.77,"AC",BPZZ,BPSRX,BPSRF,BP77)) Q:+BP77=0  D
"RTN","BPSOSRX6",68,0)
 . . D DELREQST^BPSOSRX4(BP77)
"RTN","BPSOSRX6",69,0)
 Q
"RTN","BPSOSRX6",70,0)
 ;Old status logic - to process claims that were submitted before Processing queue mods
"RTN","BPSOSRX6",71,0)
OLDSTAT(RXI,RXR,QUE) ;
"RTN","BPSOSRX6",72,0)
 ;
"RTN","BPSOSRX6",73,0)
 ; Setup needed variables
"RTN","BPSOSRX6",74,0)
 N IEN59,SDT,A,SUBDT
"RTN","BPSOSRX6",75,0)
 I '$G(RXI) Q ""
"RTN","BPSOSRX6",76,0)
 I $G(RXR)="" Q ""
"RTN","BPSOSRX6",77,0)
 I $G(QUE)="" S QUE=1
"RTN","BPSOSRX6",78,0)
 S IEN59=$$IEN59^BPSOSRX(RXI,RXR)
"RTN","BPSOSRX6",79,0)
 S SDT=$G(^XTMP("BPSOSRX",RXI,RXR))
"RTN","BPSOSRX6",80,0)
 ;
"RTN","BPSOSRX6",81,0)
 ; ECME record not created
"RTN","BPSOSRX6",82,0)
 I '$D(^BPST(IEN59)) D  Q A
"RTN","BPSOSRX6",83,0)
 . I QUE,SDT S A="IN PROGRESS"_U_SDT_U_$$STATI^BPSOSU(0)_U_-1 Q
"RTN","BPSOSRX6",84,0)
 . I QUE,$D(^XTMP("BPS-PROC","CLAIM",RXI,RXR)) S A="IN PROGRESS"_U_SDT_U_$$STATI^BPSOSU(0)_U_-1 Q
"RTN","BPSOSRX6",85,0)
 . S A=""
"RTN","BPSOSRX6",86,0)
 ;
"RTN","BPSOSRX6",87,0)
 ; Loop: Get data, quit if times and status match (no change during gather)
"RTN","BPSOSRX6",88,0)
 N C,T1,T2,S1,S2 F  D  I T1=T2,S1=S2 Q
"RTN","BPSOSRX6",89,0)
 . S T1=$$LASTUP59^BPSOSRX(IEN59)
"RTN","BPSOSRX6",90,0)
 . S S1=$$STATUS59^BPSOSRX(IEN59)
"RTN","BPSOSRX6",91,0)
 . I S1=99 D  ; completed
"RTN","BPSOSRX6",92,0)
 . . S A=$$CATEG^BPSOSUC(IEN59)
"RTN","BPSOSRX6",93,0)
 . . S C=$$RESTXT59^BPSOSRX(IEN59)
"RTN","BPSOSRX6",94,0)
 . I S1'=99 D
"RTN","BPSOSRX6",95,0)
 . . S A="IN PROGRESS"
"RTN","BPSOSRX6",96,0)
 . . S C=$$STATI^BPSOSU($S(S1="":10,1:S1))
"RTN","BPSOSRX6",97,0)
 . S T2=$$LASTUP59^BPSOSRX(IEN59)
"RTN","BPSOSRX6",98,0)
 . S S2=$$STATUS59^BPSOSRX(IEN59)
"RTN","BPSOSRX6",99,0)
 ;
"RTN","BPSOSRX6",100,0)
 ; If the queue parameter is set and the submit date from the queue
"RTN","BPSOSRX6",101,0)
 ;   follows the SUBMIT DATE/LAST UPDATE date from BPS TRANSACTION 
"RTN","BPSOSRX6",102,0)
 ;   or the RX/fill is still on the queue, then change the response
"RTN","BPSOSRX6",103,0)
 ;   to IN PROGRESS^Submit Date^WAITING TO START
"RTN","BPSOSRX6",104,0)
 S SUBDT=$$SUBMIT59^BPSOSRX(IEN59)
"RTN","BPSOSRX6",105,0)
 I SUBDT="" S SUBDT=T1
"RTN","BPSOSRX6",106,0)
 I $G(QUE),SDT>SUBDT!($D(^XTMP("BPS-PROC","CLAIM",RXI,RXR)))!($D(^XTMP("BPS-PROC","UNCLAIM",RXI,RXR))) S A="IN PROGRESS",T1=SDT,S1=-1,C=$$STATI^BPSOSU(0)
"RTN","BPSOSRX6",107,0)
 ;
"RTN","BPSOSRX6",108,0)
 ; When finishing the reversal of a Reversal/Resubmit, display IN PROGRESS
"RTN","BPSOSRX6",109,0)
 I $P($G(^BPST(IEN59,1)),"^",12)=1,S1=99 S A="IN PROGRESS",S1=98,C=$$STATI^BPSOSU(S1)
"RTN","BPSOSRX6",110,0)
 ;
"RTN","BPSOSRX6",111,0)
 ; Return results
"RTN","BPSOSRX6",112,0)
 Q A_U_T1_U_$E(C,1,255-$L(A)-$L(T1)-2)_U_S1
"RTN","BPSOSRX6",113,0)
 ;
"RTN","BPSOSRX6",114,0)
 ;check for duplicates and determine the NEXT REQUEST
"RTN","BPSOSRX6",115,0)
 ;BP77 - the current request (ien of #9002313.77)
"RTN","BPSOSRX6",116,0)
 ;BPDEL=1 - delete duplicates
"RTN","BPSOSRX6",117,0)
 ;BPUPDNXT=1 - update the NEXT REQUEST field of the current request after skipping (deleting) duplicates
"RTN","BPSOSRX6",118,0)
 ;(Note - if BPDEL=1 then BPUPDNXT will be set to 1 to avoid "hanging" requests
"RTN","BPSOSRX6",119,0)
 ;BP59 - (optional) the ien of BPS TRANSACTION file
"RTN","BPSOSRX6",120,0)
 ;Returns the next request or NULL (if there is no next request)
"RTN","BPSOSRX6",121,0)
GETNXREQ(BP77,BPDEL,BPUPDNXT,BP59) ;
"RTN","BPSOSRX6",122,0)
 N BPCUR,BPCURTYP,BPARRDEL
"RTN","BPSOSRX6",123,0)
 N BPNXT77,BPTYPNXT,BP77DEL
"RTN","BPSOSRX6",124,0)
 S BPCUR=BP77,BPCURTYP=$P($G(^BPS(9002313.77,BP77,1)),U,4)
"RTN","BPSOSRX6",125,0)
 F  D  Q:BPNXT77=0  Q:BPCURTYP'=BPTYPNXT  S BPCUR=BPNXT77,BPCURTYP=BPTYPNXT,BPARRDEL(BPNXT77)=""
"RTN","BPSOSRX6",126,0)
 . S BPNXT77=+$P($G(^BPS(9002313.77,BPCUR,0)),U,5)
"RTN","BPSOSRX6",127,0)
 . Q:BPNXT77=0
"RTN","BPSOSRX6",128,0)
 . S BPTYPNXT=$P($G(^BPS(9002313.77,BPNXT77,1)),U,4)
"RTN","BPSOSRX6",129,0)
 ;if nothing to skip then quit now
"RTN","BPSOSRX6",130,0)
 I '$O(BPARRDEL("")) Q BPNXT77
"RTN","BPSOSRX6",131,0)
 ; delete duplicates
"RTN","BPSOSRX6",132,0)
 I $G(BPDEL)=1 S BP77DEL=0 F  S BP77DEL=$O(BPARRDEL(BP77DEL)) Q:+BP77DEL=0  D
"RTN","BPSOSRX6",133,0)
 . I $G(BP59)>0 D LOG^BPSOSL(BP59,$T(+0)_"-Delete the duplicate request "_BP77DEL)
"RTN","BPSOSRX6",134,0)
 . D DELREQST^BPSOSRX4(BP77DEL)
"RTN","BPSOSRX6",135,0)
 I $G(BPDEL)=1 S BPUPDNXT=1
"RTN","BPSOSRX6",136,0)
 I $G(BPUPDNXT)=1 D
"RTN","BPSOSRX6",137,0)
 . I $$FILLFLDS^BPSUTIL2(9002313.77,".05",BP77,BPNXT77)<1 D
"RTN","BPSOSRX6",138,0)
 . . I $G(BP59)>0 D LOG^BPSOSL(BP59,$T(+0)_"-Cannot update field #.05 (NEXT REQUEST) in BPS REQUEST")
"RTN","BPSOSRX6",139,0)
 . I $G(BP59)>0 D LOG^BPSOSL(BP59,$T(+0)_"-Update field #.05 (NEXT REQUEST) to "_BPNXT77_" in the request #"_BP77)
"RTN","BPSOSRX6",140,0)
 ;return the NEXT request
"RTN","BPSOSRX6",141,0)
 Q BPNXT77
"RTN","BPSOSRX6",142,0)
 ;BPSOSRX6
"RTN","BPSOSRX6",143,0)
 ;
"RTN","BPSOSRX7")
0^73^B26288315
"RTN","BPSOSRX7",1,0)
BPSOSRX7 ;ALB/SS - ECME REQUESTS ;04-JAN-08
"RTN","BPSOSRX7",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**7**;JUN 2004;Build 46
"RTN","BPSOSRX7",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSRX7",4,0)
 ;
"RTN","BPSOSRX7",5,0)
 Q
"RTN","BPSOSRX7",6,0)
 ;
"RTN","BPSOSRX7",7,0)
 ;Input:
"RTN","BPSOSRX7",8,0)
 ;BPRXIEN - RX ien (#52)
"RTN","BPSOSRX7",9,0)
 ;BPREFIL - refill number
"RTN","BPSOSRX7",10,0)
 ;BPREQS (by reference)- local array to convey results back to the caller
"RTN","BPSOSRX7",11,0)
 ;   BPREQS = number of nodes stored in the array
"RTN","BPSOSRX7",12,0)
 ;   BPREQS(n)=BPS REQUEST ien ^ Claim type ^ COB
"RTN","BPSOSRX7",13,0)
 ;
"RTN","BPSOSRX7",14,0)
 ;return values:
"RTN","BPSOSRX7",15,0)
 ; -5 : Unexpected ACTIVATED or IN PROCESS request has been found
"RTN","BPSOSRX7",16,0)
 ; -4 : Multiple BPS REQUEST records with the same NEXT REQUEST value
"RTN","BPSOSRX7",17,0)
 ; -3 : SCHEDULED request(s) were found but they is not ACTIVATED for some reason
"RTN","BPSOSRX7",18,0)
 ; -2 : duplicate ACTVATED / IN PROCESS requests for the same RX/RF - this should not happen
"RTN","BPSOSRX7",19,0)
 ; -1 : cannot be accepted - because reversal was requested 
"RTN","BPSOSRX7",20,0)
 ; and there are requests already for this RX/RF in the queue
"RTN","BPSOSRX7",21,0)
 ; and the last one is REVERSAL too for the same COB
"RTN","BPSOSRX7",22,0)
 ; so we will return "-1^Sequential duplicate reversal"
"RTN","BPSOSRX7",23,0)
 ; 0 : can be accepted because there are NO requests for this RX/RF 
"RTN","BPSOSRX7",24,0)
 ; we will create a new record in BPS REQUEST for it and ACTIVATE it.
"RTN","BPSOSRX7",25,0)
 ; >0 : IEN of the last BPS REQUEST in the queue - there are requests already for this RX/RF.
"RTN","BPSOSRX7",26,0)
 ;
"RTN","BPSOSRX7",27,0)
CHKREQST(BPRXIEN,BPREFIL,BPREQS) ;
"RTN","BPSOSRX7",28,0)
 N BPPRFLG,BPCURNT,BPNEXT,BPCOB,BPRCUR,BPRNXT,BPQ,BPCNT,BPZ
"RTN","BPSOSRX7",29,0)
 ;get the current IN PROCESS request for this RX/refill
"RTN","BPSOSRX7",30,0)
 S BPPRFLG=2 D  I BPCURNT>0 I $O(^BPS(9002313.77,"AC",2,BPRXIEN,BPREFIL,+BPCURNT))>0 Q "-2^Error: More than one IN PROCESS request for RXIEN="_BPRXIEN_", REFILL="_BPREFIL
"RTN","BPSOSRX7",31,0)
 . S BPCURNT=$O(^BPS(9002313.77,"AC",BPPRFLG,BPRXIEN,BPREFIL,""))
"RTN","BPSOSRX7",32,0)
 ;if there is no IN PROCESS then check ACTIVATED
"RTN","BPSOSRX7",33,0)
 I BPCURNT="" S BPPRFLG=1 D  I BPCURNT>0 I $O(^BPS(9002313.77,"AC",BPPRFLG,BPRXIEN,BPREFIL,+BPCURNT))>0 Q "-2^Error: More than one ACTIVATED request for RXIEN="_BPRXIEN_", REFILL="_BPREFIL
"RTN","BPSOSRX7",34,0)
 . S BPCURNT=$O(^BPS(9002313.77,"AC",BPPRFLG,BPRXIEN,BPREFIL,""))
"RTN","BPSOSRX7",35,0)
 ;if there is no IACTIVATED then check SCHEDULED
"RTN","BPSOSRX7",36,0)
 I BPCURNT="" S BPPRFLG=0 D  I BPCURNT>0 Q "-3^Error: There is a SCHEDULED request without ACTIVATED requests, RXIEN="_BPRXIEN_", REFILL="_BPREFIL
"RTN","BPSOSRX7",37,0)
 . S BPCURNT=$O(^BPS(9002313.77,"AC",BPPRFLG,BPRXIEN,BPREFIL,""))
"RTN","BPSOSRX7",38,0)
 ;if there is no any requests then return 0 
"RTN","BPSOSRX7",39,0)
 I BPCURNT="" Q 0  ;can be accepted because there are NO requests for this RX/RF
"RTN","BPSOSRX7",40,0)
 ;Otherwise...
"RTN","BPSOSRX7",41,0)
 S BPQ=0,BPREQS=1
"RTN","BPSOSRX7",42,0)
 S BPRCUR=BPCURNT
"RTN","BPSOSRX7",43,0)
 ;save current_ien ^ actype ^ COB
"RTN","BPSOSRX7",44,0)
 S BPREQS(BPREQS)=BPCURNT_U_$P($G(^BPS(9002313.77,BPCURNT,1)),U,4)_U_$P($G(^BPS(9002313.77,BPCURNT,0)),U,3)
"RTN","BPSOSRX7",45,0)
 ;loop thru all SCHEDULED,ACTIVATED and IN PROCESS records starting with BPCURNT
"RTN","BPSOSRX7",46,0)
 F  S BPRNXT=$O(^BPS(9002313.77,"AN",BPRCUR,"")) Q:BPRNXT=""  Q:BPQ'=0  D
"RTN","BPSOSRX7",47,0)
 . I $D(BPREQS("R",BPRNXT)) S BPQ=-1 Q  ;error - more than one records with the same next request
"RTN","BPSOSRX7",48,0)
 . ;BPZ - process flag ^ act type ^ COB
"RTN","BPSOSRX7",49,0)
 . S BPZ=$G(^BPS(9002313.77,"AN",BPRCUR,BPRNXT))
"RTN","BPSOSRX7",50,0)
 . I BPRCUR'=BPCURNT I +BPZ>0 S BPQ=+BPZ Q  ;except the first record in the loop - all others should be SCHEDULED (i.e. process flag =0)
"RTN","BPSOSRX7",51,0)
 . S BPREQS=BPREQS+1
"RTN","BPSOSRX7",52,0)
 . S BPREQS(BPREQS)=BPRNXT_U_$P($G(^BPS(9002313.77,BPRNXT,1)),U,4)_U_$P($G(^BPS(9002313.77,BPRNXT,0)),U,3)
"RTN","BPSOSRX7",53,0)
 . S BPREQS("R",BPRNXT)="" ;used to check uniqueness
"RTN","BPSOSRX7",54,0)
 . S BPRCUR=BPRNXT
"RTN","BPSOSRX7",55,0)
 ;
"RTN","BPSOSRX7",56,0)
 K BPREQS("R")
"RTN","BPSOSRX7",57,0)
 I BPQ=-1 Q "-4^Error: Multiple BPS REQUEST records with the same NEXT REQUEST value for RXIEN="_BPRXIEN_", REFILL="_BPREFIL
"RTN","BPSOSRX7",58,0)
 I BPQ=1 Q "-5^Error: Unexpected ACTIVATED request has been found for RXIEN="_BPRXIEN_", REFILL="_BPREFIL
"RTN","BPSOSRX7",59,0)
 I BPQ=2 Q "-5^Error: Unexpected IN PROCESS request has been found for RXIEN="_BPRXIEN_", REFILL="_BPREFIL
"RTN","BPSOSRX7",60,0)
 S BPZ=BPREQS(BPREQS)
"RTN","BPSOSRX7",61,0)
 Q +BPZ
"RTN","BPSOSRX7",62,0)
 ;
"RTN","BPSOSRX7",63,0)
 ;
"RTN","BPSOSRX7",64,0)
 ;BPTYPE: C -CLAIM, U- UNCLAIM
"RTN","BPSOSRX7",65,0)
 ;BPCLMST:
"RTN","BPSOSRX7",66,0)
 ;     For submissions (type =C):
"RTN","BPSOSRX7",67,0)
 ;       E PAYABLE, E CAPTURED, E DUPLICATE, E REJECTED, E OTHER, and
"RTN","BPSOSRX7",68,0)
 ;       E STRANDED
"RTN","BPSOSRX7",69,0)
 ;
"RTN","BPSOSRX7",70,0)
 ;     For Reversals (type =U):
"RTN","BPSOSRX7",71,0)
 ;       E REVERSAL ACCEPTED, E REVERSAL REJECTED, E REVERSAL OTHER, and
"RTN","BPSOSRX7",72,0)
 ;       E REVERSAL STRANDED
"RTN","BPSOSRX7",73,0)
 ;returns:
"RTN","BPSOSRX7",74,0)
 ;1 - request was succesful 
"RTN","BPSOSRX7",75,0)
 ;0 - request failed
"RTN","BPSOSRX7",76,0)
SUCCESS(BPTYPE,BPCLMST) ;
"RTN","BPSOSRX7",77,0)
 I BPTYPE="C" Q $S((BPCLMST="E PAYABLE")!(BPCLMST="E DUPLICATE"):1,1:0)
"RTN","BPSOSRX7",78,0)
 I BPTYPE="U" Q $S((BPCLMST="E REVERSAL ACCEPTED"):1,1:0)
"RTN","BPSOSRX7",79,0)
 Q 0
"RTN","BPSOSRX7",80,0)
 ;delete all sequential requests and quit
"RTN","BPSOSRX7",81,0)
DELALLRQ(BP77,IEN59) ;
"RTN","BPSOSRX7",82,0)
 N BPNXT77
"RTN","BPSOSRX7",83,0)
 F  S BPNXT77=+$P($G(^BPS(9002313.77,BP77,0)),U,5) D  Q:+BPNXT77=0
"RTN","BPSOSRX7",84,0)
 . D LOG^BPSOSL(IEN59,$T(+0)_" deleting "_$P($G(^BPS(9002313.77,BP77,1)),U,4)_"-type request = "_BP77)
"RTN","BPSOSRX7",85,0)
 . D DELREQST^BPSOSRX4(BP77)
"RTN","BPSOSRX7",86,0)
 . S BP77=BPNXT77
"RTN","BPSOSRX7",87,0)
 Q
"RTN","BPSOSRX7",88,0)
 ; All this does is to put it on a list and start a background job.
"RTN","BPSOSRX7",89,0)
 ; Process both types of requests - CLAIMs and UNCLAIMs
"RTN","BPSOSRX7",90,0)
 ;
"RTN","BPSOSRX7",91,0)
 ; Input: see MKRQST
"RTN","BPSOSRX7",92,0)
 ; $G(DONTACTV)=1 - do not ACTIVATE schduled request
"RTN","BPSOSRX7",93,0)
 ; Return values:
"RTN","BPSOSRX7",94,0)
 ;  1^BPS REQUEST ien = accepted for processing
"RTN","BPSOSRX7",95,0)
 ;  0^reason = failure (should never happen)
"RTN","BPSOSRX7",96,0)
UPDINSDT(BPIEN77,MOREDATA,IEN59) ;
"RTN","BPSOSRX7",97,0)
 N BPRETV,BPIENS78
"RTN","BPSOSRX7",98,0)
 N BPZ,RXI,RXR
"RTN","BPSOSRX7",99,0)
 N BPCOB,BPQ,BPIEN772
"RTN","BPSOSRX7",100,0)
 S BPZ=$G(^BPS(9002313.77,BPIEN77,0))
"RTN","BPSOSRX7",101,0)
 S RXI=$P(BPZ,U,1),RXR=$P(BPZ,U,2)
"RTN","BPSOSRX7",102,0)
 D LOG^BPSOSL(IEN59,$T(+0)_"- Gathering IB data for the request: "_BPIEN77)
"RTN","BPSOSRX7",103,0)
 S BPRETV=$$MKINSUR^BPSOSRX2(RXI,RXR,.MOREDATA,.BPIENS78)
"RTN","BPSOSRX7",104,0)
 I +BPRETV=0 Q BPRETV
"RTN","BPSOSRX7",105,0)
 ;
"RTN","BPSOSRX7",106,0)
 ;store ins to IB INSURER DATA multiple
"RTN","BPSOSRX7",107,0)
 S BPQ=0
"RTN","BPSOSRX7",108,0)
 S BPCOB=0 F  S BPCOB=$O(BPIENS78(BPCOB)) Q:+BPCOB=0!(BPQ=1)  D
"RTN","BPSOSRX7",109,0)
 . I '$D(^BPS(9002313.77,BPIEN77,5,BPCOB)) D  I BPQ=1 Q
"RTN","BPSOSRX7",110,0)
 . . S BPIEN772=$$INSITEM^BPSUTIL2(9002313.772,BPIEN77,BPCOB,BPCOB,"",,0)
"RTN","BPSOSRX7",111,0)
 . . I BPIEN772<1 S BPERRMSG="Cannot create record in IBDATA multiple of the BPS REQUEST file",BPQ=1 Q
"RTN","BPSOSRX7",112,0)
 . S BPERRMSG="Cannot populate a field in IBDATA multiple"
"RTN","BPSOSRX7",113,0)
 . I $$FILLFLDS^BPSUTIL2(9002313.772,".02",BPCOB_","_BPIEN77,$S(BPCOBIND=BPCOB:1,1:0))<1 S BPQ=1 Q
"RTN","BPSOSRX7",114,0)
 . I $$FILLFLDS^BPSUTIL2(9002313.772,".03",BPCOB_","_BPIEN77,BPIENS78(BPCOB))<1 S BPQ=1 Q
"RTN","BPSOSRX7",115,0)
 I BPQ=1 Q "0^"_BPERRMSG_"INSURER DATA"
"RTN","BPSOSRX7",116,0)
 ;
"RTN","BPSOSRX7",117,0)
 Q "1^"_BPIEN77
"RTN","BPSOSRX7",118,0)
 ;get eligibility
"RTN","BPSOSRX7",119,0)
ELIG(DFN) ;
"RTN","BPSOSRX7",120,0)
 N BPSARRY
"RTN","BPSOSRX7",121,0)
 Q $P($$RX^IBNCPDP(DFN,.BPSARRY),U,3)  ;Call IB again
"RTN","BPSOSRX7",122,0)
 ;BPSOSRX7
"RTN","BPSOSRX8")
0^74^B22051341
"RTN","BPSOSRX8",1,0)
BPSOSRX8 ;ALB/SS - ECME REQUESTS ;10-JAN-08
"RTN","BPSOSRX8",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**7**;JUN 2004;Build 46
"RTN","BPSOSRX8",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSRX8",4,0)
 ;
"RTN","BPSOSRX8",5,0)
 ;check parameters for EN^BPSNCPDP
"RTN","BPSOSRX8",6,0)
 ;BRXIEN - Rx ien
"RTN","BPSOSRX8",7,0)
 ;BRX - rx refil no
"RTN","BPSOSRX8",8,0)
 ;BWHERE - RX action
"RTN","BPSOSRX8",9,0)
 ;DFN - patient's ien
"RTN","BPSOSRX8",10,0)
 ;PNAME - patient name
"RTN","BPSOSRX8",11,0)
 ;BILLNDC - NDC
"RTN","BPSOSRX8",12,0)
 ;return 
"RTN","BPSOSRX8",13,0)
 ;1 - passed
"RTN","BPSOSRX8",14,0)
 ;0^message - failed
"RTN","BPSOSRX8",15,0)
CHCKPAR(BRXIEN,BRX,BWHERE,DFN,PNAME,BILLNDC) ;
"RTN","BPSOSRX8",16,0)
 I '$G(BRXIEN) Q "0^Prescription IEN parameter missing"
"RTN","BPSOSRX8",17,0)
 I $G(BWHERE)="" Q "0^RX Action parameter missing"
"RTN","BPSOSRX8",18,0)
 I $G(BRX)="" Q "0^Prescription does not exist"
"RTN","BPSOSRX8",19,0)
 I $G(DFN)="" Q "0^Patient's IEN does not exist"
"RTN","BPSOSRX8",20,0)
 I $G(PNAME)="" Q "0^Patient name missing"
"RTN","BPSOSRX8",21,0)
 I $G(BILLNDC)="" Q "0^Invalid NDC"
"RTN","BPSOSRX8",22,0)
 Q 1
"RTN","BPSOSRX8",23,0)
 ;
"RTN","BPSOSRX8",24,0)
 ;===== check if we need to print the messages to the screen =======
"RTN","BPSOSRX8",25,0)
PRINTSCR(BWHER) ;
"RTN","BPSOSRX8",26,0)
 I ",ARES,AREV,CRLB,CRLR,CRLX,DDED,DE,HLD,PC,PE,PL,RS,"[(","_BWHER_",") Q 0
"RTN","BPSOSRX8",27,0)
 Q 1  ;print messages to the screen
"RTN","BPSOSRX8",28,0)
 ;check if any IB DATA is missing
"RTN","BPSOSRX8",29,0)
 ;returns 
"RTN","BPSOSRX8",30,0)
 ; 0 - passed
"RTN","BPSOSRX8",31,0)
 ; or 
"RTN","BPSOSRX8",32,0)
 ; RESPONSE code^CLMSTAT message^D(display message)^number of seconds to hang if display 
"RTN","BPSOSRX8",33,0)
IBDATAOK(MOREDATA,BPSARRY) ;
"RTN","BPSOSRX8",34,0)
 N BPRESP S BPRESP=2
"RTN","BPSOSRX8",35,0)
 I $G(BPSARRY("NO ECME INSURANCE")) S BPRESP=6
"RTN","BPSOSRX8",36,0)
 ; Check for missing data (Will IB billing determination catch this?)
"RTN","BPSOSRX8",37,0)
 I $D(MOREDATA("IBDATA",1,1)),$P(MOREDATA("IBDATA",1,1),"^",1)="" Q BPRESP_U_"Information missing from IB data.^D^2"
"RTN","BPSOSRX8",38,0)
 ; Check for missing/invalid payer sheets (I think IB billing determination will catch this)
"RTN","BPSOSRX8",39,0)
 I $P($G(MOREDATA("IBDATA",1,1)),"^",4)="" Q BPRESP_U_"Invalid/missing payer sheet from IB data.^D^2"
"RTN","BPSOSRX8",40,0)
 ; Check if IB says to bill
"RTN","BPSOSRX8",41,0)
 I '$G(MOREDATA("BILL")) Q BPRESP_U_"Flagged by IB to not 3rd Party Insurance bill through ECME.^D^2"
"RTN","BPSOSRX8",42,0)
 Q 0
"RTN","BPSOSRX8",43,0)
 ;Get Site
"RTN","BPSOSRX8",44,0)
GETSITE(BRXIEN,BFILL) ;
"RTN","BPSOSRX8",45,0)
 I 'BFILL Q $$RXAPI1^BPSUTIL1(BRXIEN,20,"I")
"RTN","BPSOSRX8",46,0)
 I BFILL Q $$RXSUBF1^BPSUTIL1(BRXIEN,52,52.1,+BFILL,8,"I")
"RTN","BPSOSRX8",47,0)
 Q 0
"RTN","BPSOSRX8",48,0)
 ;
"RTN","BPSOSRX8",49,0)
 ; Store general information/parameters into MOREDATA
"RTN","BPSOSRX8",50,0)
 ; In instances where duz is null set it equal to .5 (postmaster)
"RTN","BPSOSRX8",51,0)
BASICMOR(BWHERE,BFILLDAT,REVREAS,DURREC,BPOVRIEN,BPSCLARF,BPSAUTH,MOREDATA) ;
"RTN","BPSOSRX8",52,0)
 S MOREDATA("USER")=$S('DUZ:.5,1:DUZ)
"RTN","BPSOSRX8",53,0)
 S MOREDATA("RX ACTION")=$G(BWHERE)
"RTN","BPSOSRX8",54,0)
 S MOREDATA("DATE OF SERVICE")=$P($G(BFILLDAT),".",1)
"RTN","BPSOSRX8",55,0)
 S MOREDATA("REVERSAL REASON")=$S($G(REVREAS)="":"UNKNOWN",1:$E($G(REVREAS),1,40))
"RTN","BPSOSRX8",56,0)
 I $G(DURREC)]"" S MOREDATA("DUR",1,0)=DURREC
"RTN","BPSOSRX8",57,0)
 I $G(BPOVRIEN)]"" S MOREDATA("BPOVRIEN")=BPOVRIEN
"RTN","BPSOSRX8",58,0)
 I $G(BPSCLARF)]"" S MOREDATA("BPSCLARF")=BPSCLARF
"RTN","BPSOSRX8",59,0)
 I $TR($G(BPSAUTH),"^")]"" S MOREDATA("BPSAUTH")=BPSAUTH
"RTN","BPSOSRX8",60,0)
 Q
"RTN","BPSOSRX8",61,0)
 ;====== Prepare ret. value
"RTN","BPSOSRX8",62,0)
 ;return RESPONSE ^ CLMSTAT ^ Display= D ^ seconds to HANG
"RTN","BPSOSRX8",63,0)
RSPCLMS(BPREQTYP,RESPONSE,MOREDATA,BPADDINF) ;
"RTN","BPSOSRX8",64,0)
 I BPREQTYP="C",RESPONSE=0 Q RESPONSE_U_$S($G(MOREDATA("ELIG"))="T":"TRICARE ",1:"")_"Prescription "_BRX_$S($G(MOREDATA("ELIG"))="T":"",1:" successfully")_" submitted to ECME for claim generation.^D^"
"RTN","BPSOSRX8",65,0)
 I BPREQTYP="C",RESPONSE>0 Q RESPONSE_U_"No claim submission made: "_$S($G(BPADDINF)'="":BPADDINF,1:"Unable to queue claim submission.")_"^D"
"RTN","BPSOSRX8",66,0)
 I BPREQTYP="U",RESPONSE=0 Q RESPONSE_U_"Reversing prescription "_BRX_".^D^2"
"RTN","BPSOSRX8",67,0)
 I BPREQTYP="U",RESPONSE>0 Q RESPONSE_U_"No claim submission made.  Unable to queue reversal.^D^2"
"RTN","BPSOSRX8",68,0)
 I BPREQTYP="UC",RESPONSE=10 Q RESPONSE_U_$S($G(MOREDATA("ELIG"))="T":"TRICARE ",1:"")_"Prescription "_BRX_$S($G(MOREDATA("ELIG"))="T":"",1:" successfully")_" submitted to ECME for claim reversal.^D^"
"RTN","BPSOSRX8",69,0)
 I BPREQTYP="UC",RESPONSE=0 Q RESPONSE_U_$S($G(MOREDATA("ELIG"))="T":"TRICARE ",1:"")_"Prescription "_BRX_$S($G(MOREDATA("ELIG"))="T":"",1:" successfully")_" submitted to ECME for claim generation.^D^"
"RTN","BPSOSRX8",70,0)
 I BPREQTYP="UC",RESPONSE>0,RESPONSE'=10 Q RESPONSE_U_"No claim submission made: "_$S($G(BPADDINF)'="":BPADDINF,1:"Unable to queue claim submission.")_"^D"
"RTN","BPSOSRX8",71,0)
 Q ""
"RTN","BPSOSRX8",72,0)
 ;
"RTN","BPSOSRX8",73,0)
SENDBUL(RESPONSE,BWHERE,BRXIEN,BFILL,SITE,DFN,PNAME,BPSERTXT,BPSRESP) ;
"RTN","BPSOSRX8",74,0)
 ; if RESPONSE=4 (Unable to queue claim)
"RTN","BPSOSRX8",75,0)
 ; and
"RTN","BPSOSRX8",76,0)
 ; If not OP, then send an email to the OPECC
"RTN","BPSOSRX8",77,0)
 I RESPONSE=4,",AREV,BB,ERES,EREV,"'[(","_BWHERE_",") D BULL^BPSNCPD1(BRXIEN,BFILL,$G(SITE),$G(DFN),$G(PNAME),,$G(BPSERTXT),$G(BPSRESP))
"RTN","BPSOSRX8",78,0)
 Q
"RTN","BPSOSS8")
0^28^B1703935
"RTN","BPSOSS8",1,0)
BPSOSS8 ;BHAM ISC/FCS/DRS/FLS - Edit Basic ECME Parameters ;03/07/08  14:09
"RTN","BPSOSS8",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5,7**;JUN 2004;Build 46
"RTN","BPSOSS8",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSS8",4,0)
 ;
"RTN","BPSOSS8",5,0)
EN ;EP - Option BPS SETUP BASIC PARAMS
"RTN","BPSOSS8",6,0)
 N DIE,DA,DR,DTOUT
"RTN","BPSOSS8",7,0)
 W !!,"Edit Pharmacy ECME configuration",!
"RTN","BPSOSS8",8,0)
 ;
"RTN","BPSOSS8",9,0)
 ; If the BPS Setup record is not created, create it.
"RTN","BPSOSS8",10,0)
 ; Quit if there is an error.
"RTN","BPSOSS8",11,0)
 D VERSION^BPSJINIT
"RTN","BPSOSS8",12,0)
 ;
"RTN","BPSOSS8",13,0)
 ; Check for errors
"RTN","BPSOSS8",14,0)
 I '$D(^BPS(9002313.99,1,0)) D  Q
"RTN","BPSOSS8",15,0)
 . W !!,"BPS Setup not defined and can not be created.  Quitting."
"RTN","BPSOSS8",16,0)
 ;
"RTN","BPSOSS8",17,0)
 ; Prompts and input
"RTN","BPSOSS8",18,0)
 S DA=1
"RTN","BPSOSS8",19,0)
 S DIE=9002313.99
"RTN","BPSOSS8",20,0)
 S DR="3.01ECME timeout? (0 to 30 seconds)//10;.05Insurer Asleep Interval (0 to 29 minutes): //20;.06Insurer Asleep Retries (0 to 99): //10"
"RTN","BPSOSS8",21,0)
 D ^DIE
"RTN","BPSOSS8",22,0)
 Q
"RTN","BPSOSS8",23,0)
 ;
"RTN","BPSOSU")
0^10^B40258951
"RTN","BPSOSU",1,0)
BPSOSU ;BHAM ISC/FCS/DRS/FLS - Common utilities ;06/01/2004
"RTN","BPSOSU",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,2,5,7**;JUN 2004;Build 46
"RTN","BPSOSU",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSU",4,0)
 Q
"RTN","BPSOSU",5,0)
 ; Common utilities called a lot.
"RTN","BPSOSU",6,0)
 ;
"RTN","BPSOSU",7,0)
 ; SETSTAT - set status field for ^BPST(IEN59,
"RTN","BPSOSU",8,0)
 ; Input:
"RTN","BPSOSU",9,0)
 ;   IEN59   - BPS Transaction
"RTN","BPSOSU",10,0)
 ;   STATUS  - Value to set into BPS Transaction
"RTN","BPSOSU",11,0)
SETSTAT(IEN59,STATUS) ; EP - from many places
"RTN","BPSOSU",12,0)
 ;
"RTN","BPSOSU",13,0)
 ; Lock the record - something is very wrong if you can't get the lock
"RTN","BPSOSU",14,0)
 F  L +^BPST(IEN59):300 Q:$T  Q:'$$IMPOSS^BPSOSUE("L","RTI","LOCK +^BPST",,"SETSTAT",$T(+0))
"RTN","BPSOSU",15,0)
 N DIE,DA,DR,X
"RTN","BPSOSU",16,0)
 S DIE=9002313.59,DA=IEN59,DR="1///"_STATUS_";7///NOW" ; Status and Last Update
"RTN","BPSOSU",17,0)
 I STATUS=0 S DR=DR_";15///NOW" ; If Status is 0, init START TIME
"RTN","BPSOSU",18,0)
 D ^DIE
"RTN","BPSOSU",19,0)
 ;
"RTN","BPSOSU",20,0)
 ; Verify that there no other statuses in the X-ref
"RTN","BPSOSU",21,0)
 S X=""
"RTN","BPSOSU",22,0)
 F  S X=$O(^BPST("AD",X)) Q:X=""  D
"RTN","BPSOSU",23,0)
 . I X'=STATUS K ^BPST("AD",X,IEN59)
"RTN","BPSOSU",24,0)
 I STATUS=99 D STATUS99(IEN59)
"RTN","BPSOSU",25,0)
 L -^BPST(IEN59)
"RTN","BPSOSU",26,0)
 Q
"RTN","BPSOSU",27,0)
 ;
"RTN","BPSOSU",28,0)
 ; STATUS99 - Special activity when a claim reaches status 99
"RTN","BPSOSU",29,0)
 ; Input:
"RTN","BPSOSU",30,0)
 ;   IEN59 - BPS Transaction IEN
"RTN","BPSOSU",31,0)
STATUS99(IEN59) ;
"RTN","BPSOSU",32,0)
 N CLMSTAT,BPS57,BPNXTREQ,BPRQUSED
"RTN","BPSOSU",33,0)
 N BPSCLNOD,BPTYPE
"RTN","BPSOSU",34,0)
 ;
"RTN","BPSOSU",35,0)
 ; Get status of the claim
"RTN","BPSOSU",36,0)
 S CLMSTAT=$$CATEG^BPSOSUC(IEN59)
"RTN","BPSOSU",37,0)
 ;
"RTN","BPSOSU",38,0)
 S BPS57=$$NEW57(IEN59)
"RTN","BPSOSU",39,0)
 D LOG^BPSOSL(IEN59,$T(+0)_"-Created BPS Log of Transaction record "_BPS57)
"RTN","BPSOSU",40,0)
 ;
"RTN","BPSOSU",41,0)
 ;
"RTN","BPSOSU",42,0)
 ; check if BPS REQUEST is used then see if the next request needs to be activated
"RTN","BPSOSU",43,0)
 S BPRQUSED=+$P($G(^BPST(IEN59,0)),U,12)
"RTN","BPSOSU",44,0)
 S BPSCLNOD=$G(^BPS(9002313.77,BPRQUSED,7))
"RTN","BPSOSU",45,0)
 S BPTYPE=$P($G(^BPS(9002313.77,BPRQUSED,1)),U,4)
"RTN","BPSOSU",46,0)
 D LOG^BPSOSL(IEN59,$T(+0)_"-Claim of the request "_BPRQUSED_" has reached 99%")
"RTN","BPSOSU",47,0)
 ;
"RTN","BPSOSU",48,0)
 S BPNXTREQ=$$REQST99^BPSOSRX5(IEN59,CLMSTAT)
"RTN","BPSOSU",49,0)
 ;
"RTN","BPSOSU",50,0)
 I +BPSCLNOD=1,$P(BPSCLNOD,U,2)>0 D
"RTN","BPSOSU",51,0)
 . N BPSCLA,BPLCK,BPDROP,ERROR,DA,DR,DIE
"RTN","BPSOSU",52,0)
 . ;if reversal was not accepted
"RTN","BPSOSU",53,0)
 . I $$SUCCESS^BPSOSRX7(BPTYPE,CLMSTAT)=0 Q
"RTN","BPSOSU",54,0)
 . I BPNXTREQ>0 D LOG^BPSOSL(IEN59,$T(+0)_"-Cannot close after reversal due to sequential requests in the queue") Q
"RTN","BPSOSU",55,0)
 . D LOG^BPSOSL(IEN59,$T(+0)_"-Closing the claim after accepted reversal")
"RTN","BPSOSU",56,0)
 . S BPSCLA=$$GET1^DIQ(9002313.59,IEN59,3,"I"),BPLCK=0,BPDROP="N"
"RTN","BPSOSU",57,0)
 . L +^BPSC(BPSCLA):0 I '$T D  Q
"RTN","BPSOSU",58,0)
 . . D LOG^BPSOSL(IEN59,$T(+0)_"-Unable to close claim. Could not lock BPS CLAIMS file.") Q
"RTN","BPSOSU",59,0)
 . D CLOSE^BPSBUTL(BPSCLA,IEN59,$P(^IBE(356.8,$P(BPSCLNOD,U,2),0),U),0,1,$P(BPSCLNOD,U,3),.ERROR)
"RTN","BPSOSU",60,0)
 . I $D(ERROR) D  Q
"RTN","BPSOSU",61,0)
 . . D LOG^BPSOSL(IEN59,$T(+0)_"Unable to close Bill in IB. "_ERROR)
"RTN","BPSOSU",62,0)
 . . L -^BPSC(BPSCLA)
"RTN","BPSOSU",63,0)
 . S DIE="^BPSC(",DA=BPSCLA,DR="901///1;902///"_$$NOW^XLFDT()_";903////"_DUZ_";904///"_$P(BPSCLNOD,U,2)_";905////"_BPDROP D ^DIE
"RTN","BPSOSU",64,0)
 . L -^BPSC(BPSCLA)
"RTN","BPSOSU",65,0)
 . Q
"RTN","BPSOSU",66,0)
 ;
"RTN","BPSOSU",67,0)
 ;
"RTN","BPSOSU",68,0)
 ; If claims completed normally, log its completion.
"RTN","BPSOSU",69,0)
 ; Do not log error'ed or stranded claims as we don't want to show these in the
"RTN","BPSOSU",70,0)
 ;   turn-around stats
"RTN","BPSOSU",71,0)
 ; Needed for Turn-Around Stats - Do NOT delete/alter!!
"RTN","BPSOSU",72,0)
 I CLMSTAT'["E OTHER",CLMSTAT'["E UNSTRANDED",CLMSTAT'["E REVERSAL UNSTRANDED" D LOG^BPSOSL(IEN59,$T(+0)_"-Claim Complete")
"RTN","BPSOSU",73,0)
 Q
"RTN","BPSOSU",74,0)
 ;
"RTN","BPSOSU",75,0)
 ; NEW57 - Copy the BPS Transaction into BPS Log of Transaction
"RTN","BPSOSU",76,0)
 ;  Input
"RTN","BPSOSU",77,0)
 ;    IEN59 - BPS Transaction
"RTN","BPSOSU",78,0)
 ;  Returns
"RTN","BPSOSU",79,0)
 ;    BPS Log of Transaction IEN
"RTN","BPSOSU",80,0)
NEW57(IEN59) ;
"RTN","BPSOSU",81,0)
 F  L +^BPSTL:300 Q:$T  Q:'$$IMPOSS^BPSOSUE("L","RTI","LOCK ^BPSTL",,"NEW57",$T(+0))
"RTN","BPSOSU",82,0)
 ;
"RTN","BPSOSU",83,0)
 ; Get next record number in BPS Log of Transactions
"RTN","BPSOSU",84,0)
NEW57A N N,C
"RTN","BPSOSU",85,0)
 S N=$P(^BPSTL(0),U,3)+1
"RTN","BPSOSU",86,0)
 S C=$P(^BPSTL(0),U,4)+1
"RTN","BPSOSU",87,0)
 S $P(^BPSTL(0),U,3,4)=N_U_C
"RTN","BPSOSU",88,0)
 I $D(^BPSTL(N)) G NEW57A ; should never happen
"RTN","BPSOSU",89,0)
 L -^BPSTL
"RTN","BPSOSU",90,0)
 ;
"RTN","BPSOSU",91,0)
 ; Merge BPS Transaction into Log of Transactions
"RTN","BPSOSU",92,0)
 M ^BPSTL(N)=^BPST(IEN59)
"RTN","BPSOSU",93,0)
 ;
"RTN","BPSOSU",94,0)
 ; Indexing - First, fileman indexing
"RTN","BPSOSU",95,0)
 D
"RTN","BPSOSU",96,0)
 . N DIK,DA S DIK="^BPSTL(",DA=N N N D IX1^DIK
"RTN","BPSOSU",97,0)
 ;
"RTN","BPSOSU",98,0)
 ; Setup the NON-FILEMAN index on RX and Fill
"RTN","BPSOSU",99,0)
 N A,B
"RTN","BPSOSU",100,0)
 S A=$P(^BPSTL(N,1),U,11)
"RTN","BPSOSU",101,0)
 S B=$P(^BPSTL(N,1),U)
"RTN","BPSOSU",102,0)
 S ^BPSTL("NON-FILEMAN","RXIRXR",A,B,N)=""
"RTN","BPSOSU",103,0)
 ;
"RTN","BPSOSU",104,0)
 ; Quit with the new record number
"RTN","BPSOSU",105,0)
 Q N
"RTN","BPSOSU",106,0)
 ;
"RTN","BPSOSU",107,0)
 ; ISREVES - Is this a reversal claim
"RTN","BPSOSU",108,0)
 ; Input
"RTN","BPSOSU",109,0)
 ;   CLAIMIEN - Pointer to BPS Claims
"RTN","BPSOSU",110,0)
 ;
"RTN","BPSOSU",111,0)
 ; Return Value
"RTN","BPSOSU",112,0)
 ;   1 - Reversal claim
"RTN","BPSOSU",113,0)
 ;   0 - Not a reversal claim
"RTN","BPSOSU",114,0)
ISREVERS(CLAIM) ;
"RTN","BPSOSU",115,0)
 Q $P($G(^BPSC(CLAIM,100)),"^",3)="B2"
"RTN","BPSOSU",116,0)
 ;
"RTN","BPSOSU",117,0)
 ; SETCSTAT - Set the status for every transaction associated with
"RTN","BPSOSU",118,0)
 ;   this claim
"RTN","BPSOSU",119,0)
SETCSTAT(CLAIM,STATUS) ;
"RTN","BPSOSU",120,0)
 N IEN59,INDEX
"RTN","BPSOSU",121,0)
 ;
"RTN","BPSOSU",122,0)
 ; Determine correct index
"RTN","BPSOSU",123,0)
 I $$ISREVERS(CLAIM) S INDEX="AER"
"RTN","BPSOSU",124,0)
 E  S INDEX="AE"
"RTN","BPSOSU",125,0)
 ;
"RTN","BPSOSU",126,0)
 ; Loop through the transactions and set the status
"RTN","BPSOSU",127,0)
 S IEN59=""
"RTN","BPSOSU",128,0)
 F  S IEN59=$O(^BPST(INDEX,CLAIM,IEN59)) Q:IEN59=""  D SETSTAT(IEN59,STATUS)
"RTN","BPSOSU",129,0)
 Q
"RTN","BPSOSU",130,0)
 ;
"RTN","BPSOSU",131,0)
 ; ERROR - Handle any errors
"RTN","BPSOSU",132,0)
 ;   Log them into BPS Transactions
"RTN","BPSOSU",133,0)
 ;   Change status to 99
"RTN","BPSOSU",134,0)
 ;   Update the LOG
"RTN","BPSOSU",135,0)
 ;   Increment the statistics
"RTN","BPSOSU",136,0)
 ;   We should be okay for the resubmit flag since the STATUS
"RTN","BPSOSU",137,0)
 ;     will be E OTHER instead of E REVERSAL ACCEPTED
"RTN","BPSOSU",138,0)
 ; Input
"RTN","BPSOSU",139,0)
 ;   RTN     - Routine reporting the error
"RTN","BPSOSU",140,0)
 ;   IEN59   - BPS Transaction
"RTN","BPSOSU",141,0)
 ;   ERROR   - Error Number (goes in RESULT CODE)
"RTN","BPSOSU",142,0)
 ;   ERRTEXT - Error Text (goes in RESULT TEXT)
"RTN","BPSOSU",143,0)
 ;
"RTN","BPSOSU",144,0)
 ; To prevent conflicts, set the error number to the first digit of
"RTN","BPSOSU",145,0)
 ;   Status and a unique number for the status.
"RTN","BPSOSU",146,0)
ERROR(RTN,IEN59,ERROR,ERRTEXT) ;
"RTN","BPSOSU",147,0)
 ;
"RTN","BPSOSU",148,0)
 ; Check parameters
"RTN","BPSOSU",149,0)
 I '$G(IEN59) Q
"RTN","BPSOSU",150,0)
 I '$G(ERROR) S ERROR=0
"RTN","BPSOSU",151,0)
 I $G(ERRTEXT)="" S ERRTEXT="ERROR - see LOG"
"RTN","BPSOSU",152,0)
 ;
"RTN","BPSOSU",153,0)
 ; Set Error and Error Text in BPS Transaction
"RTN","BPSOSU",154,0)
 D SETRESU(IEN59,ERROR,ERRTEXT)
"RTN","BPSOSU",155,0)
 ;
"RTN","BPSOSU",156,0)
 ; Log Message
"RTN","BPSOSU",157,0)
 D LOG^BPSOSL(IEN59,RTN_" returned error - "_ERRTEXT)
"RTN","BPSOSU",158,0)
 ;
"RTN","BPSOSU",159,0)
 ; Update unbillable count in stats
"RTN","BPSOSU",160,0)
 D INCSTAT^BPSOSUD("R",1)
"RTN","BPSOSU",161,0)
 ;
"RTN","BPSOSU",162,0)
 ; Update Status to complete
"RTN","BPSOSU",163,0)
 D SETSTAT(IEN59,99)
"RTN","BPSOSU",164,0)
 Q
"RTN","BPSOSU",165,0)
 ;
"RTN","BPSOSU",166,0)
 ; SETRESU - Set Result into ^BPST(IEN59,2)
"RTN","BPSOSU",167,0)
 ; Input
"RTN","BPSOSU",168,0)
 ;   IEN59 - BPS Transaction IEN
"RTN","BPSOSU",169,0)
 ;   RESULT - Result Code
"RTN","BPSOSU",170,0)
 ;   TEXT   - Result Text.  Semi-colons (";") should not in the text data as
"RTN","BPSOSU",171,0)
 ;            this is used as a separator between current and previous text
"RTN","BPSOSU",172,0)
 ;            messages.  If there is a semi-colon, it is converted to a dash.
"RTN","BPSOSU",173,0)
SETRESU(IEN59,RESULT,TEXT) ;
"RTN","BPSOSU",174,0)
 ;
"RTN","BPSOSU",175,0)
 ; First, store the Result Code
"RTN","BPSOSU",176,0)
 S $P(^BPST(IEN59,2),U)=$G(RESULT)
"RTN","BPSOSU",177,0)
 ;
"RTN","BPSOSU",178,0)
 ; Second, store the Result Text
"RTN","BPSOSU",179,0)
 ; Considerations:
"RTN","BPSOSU",180,0)
 ;   Convert any semi-colons to dashes
"RTN","BPSOSU",181,0)
 ;   Add semi-colon delimiter if needed
"RTN","BPSOSU",182,0)
 ;   Truncate data if needed
"RTN","BPSOSU",183,0)
 I $G(TEXT)]"" D
"RTN","BPSOSU",184,0)
 . N X
"RTN","BPSOSU",185,0)
 . S TEXT=$TR(TEXT,";","-")
"RTN","BPSOSU",186,0)
 . S X=$P(^BPST(IEN59,2),U,2,99)
"RTN","BPSOSU",187,0)
 . I X]"",$E(X)'=";" S X=";"_X
"RTN","BPSOSU",188,0)
 . S X=$E(TEXT_X,1,255-$L(RESULT)-1)
"RTN","BPSOSU",189,0)
 . S $P(^BPST(IEN59,2),U,2)=X
"RTN","BPSOSU",190,0)
 Q
"RTN","BPSOSU",191,0)
 ;
"RTN","BPSOSU",192,0)
 ; SETCRESU - set the result code for every transaction assoc'd with
"RTN","BPSOSU",193,0)
 ;   this claim.  Note that this will only work for billing requests (B1)
"RTN","BPSOSU",194,0)
 ; Input
"RTN","BPSOSU",195,0)
 ;   CLAIMIEN - BPS Claim IEN
"RTN","BPSOSU",196,0)
 ;   RESULT   - Result Code
"RTN","BPSOSU",197,0)
 ;   TEXT     - Result Text
"RTN","BPSOSU",198,0)
SETCRESU(CLAIM,RESULT,TEXT) ;
"RTN","BPSOSU",199,0)
 N IEN59
"RTN","BPSOSU",200,0)
 S IEN59=""
"RTN","BPSOSU",201,0)
 F  S IEN59=$O(^BPST("AE",CLAIM,IEN59)) Q:IEN59=""  D SETRESU(IEN59,RESULT,$G(TEXT))
"RTN","BPSOSU",202,0)
 Q
"RTN","BPSOSU",203,0)
 ;
"RTN","BPSOSU",204,0)
 ; STATI(X) gives a text version of what status code X means.
"RTN","BPSOSU",205,0)
 ;   For effeciency, put more common ones at the top.
"RTN","BPSOSU",206,0)
 ; Also note that you should check the display on the stats screen if you
"RTN","BPSOSU",207,0)
 ;   modify any of these.
"RTN","BPSOSU",208,0)
STATI(X) ;
"RTN","BPSOSU",209,0)
 I X=99 Q "Done"
"RTN","BPSOSU",210,0)
 I X=60 Q "Transmitting"
"RTN","BPSOSU",211,0)
 I X=0 Q "Waiting to start"
"RTN","BPSOSU",212,0)
 I X=40 Q "Building the HL7 packet"
"RTN","BPSOSU",213,0)
 I X=70 Q "Parsing response"
"RTN","BPSOSU",214,0)
 I X=30 Q "Building the claim"
"RTN","BPSOSU",215,0)
 I X=10 Q "Building the transaction"
"RTN","BPSOSU",216,0)
 I X=90 Q "Processing response"
"RTN","BPSOSU",217,0)
 I X=98 Q "Resubmitting" ; Used only by STATUS^BPSOSRX (Not stored in BPS Transactions)
"RTN","BPSOSU",218,0)
 I X=50 Q "Preparing for transmit"
"RTN","BPSOSU",219,0)
 I X=31 Q "Wait for retry (insurer asleep)"
"RTN","BPSOSU",220,0)
 I X=80 Q "Waiting to process response"
"RTN","BPSOSU",221,0)
 I X=-99 Q "Waiting for activation (scheduled)" ; Used only by STATUS^BPSOSRX (Not stored in BPS Transactions)
"RTN","BPSOSU",222,0)
 I X=-98 Q "Cancelled" ; Used only by STATUS^BPSOSRX (Not stored in BPS Transactions)
"RTN","BPSOSU",223,0)
 I X=-97 Q "Inactive" ; Used only by STATUS^BPSOSRX (Not stored in BPS Transactions)
"RTN","BPSOSU",224,0)
 I X=-96 Q "Processing request" ; Used only by STATUS^BPSOSRX (Not stored in BPS Transactions)
"RTN","BPSOSU",225,0)
 Q "?"_X_"?"
"RTN","BPSOSU1")
0^48^B17364253
"RTN","BPSOSU1",1,0)
BPSOSU1 ;BHAM ISC/FCS/DRS/FLS/DLF - copied for ECME ;03/07/08  10:34
"RTN","BPSOSU1",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,7**;JUN 2004;Build 46
"RTN","BPSOSU1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSU1",4,0)
 ;
"RTN","BPSOSU1",5,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU1",6,0)
 ;Standard Date Functions
"RTN","BPSOSU1",7,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU1",8,0)
 ;Standard Date PROMPT:
"RTN","BPSOSU1",9,0)
 ;
"RTN","BPSOSU1",10,0)
 ;Parameters:
"RTN","BPSOSU1",11,0)
 ;    PROMPT  = Text to be displayed before read
"RTN","BPSOSU1",12,0)
 ;    DFLT    = Default date (internal format)
"RTN","BPSOSU1",13,0)
 ;    OPT     = 1 - Answer optional       0 - Answer required
"RTN","BPSOSU1",14,0)
 ;    SDATE   = Minimum date (internal format or NOW and DT)
"RTN","BPSOSU1",15,0)
 ;    EDATE   = Maximum date (internal format or NOW and DT)
"RTN","BPSOSU1",16,0)
 ;    %DT     = E - Echo answer           R - Require time
"RTN","BPSOSU1",17,0)
 ;              S - Seconds returned      T - Time allowed but not req
"RTN","BPSOSU1",18,0)
 ;              X - Exact date req
"RTN","BPSOSU1",19,0)
 ;    TIMEOUT = Number of seconds
"RTN","BPSOSU1",20,0)
 ;
"RTN","BPSOSU1",21,0)
 ;Returns:
"RTN","BPSOSU1",22,0)
 ;    <null>  = No response             <^> - Up-arrow entered
"RTN","BPSOSU1",23,0)
 ;    <-1>    = Timeout occurred       <^^> - Two up-arrows entered
"RTN","BPSOSU1",24,0)
 ;    <date>  = Internal FM Date
"RTN","BPSOSU1",25,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU1",26,0)
 ; IHS/SD/lwj 8/5/02  NCPDP 5.1 changes
"RTN","BPSOSU1",27,0)
 ;  Subroutine FM3EXT cloned from FM2EXT - routine used to transfer
"RTN","BPSOSU1",28,0)
 ;  the dates.  Now that NCPDP 5.1 stores the field ID with all the
"RTN","BPSOSU1",29,0)
 ;  fields, we needed currently just want to skip transforming the
"RTN","BPSOSU1",30,0)
 ;  date for 5.1 type claims
"RTN","BPSOSU1",31,0)
 ;
"RTN","BPSOSU1",32,0)
 ;
"RTN","BPSOSU1",33,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU1",34,0)
DATE(PROMPT,DFLT,OPT,SDATE,EDATE,%DT,TIMEOUT) ;EP -
"RTN","BPSOSU1",35,0)
 ;
"RTN","BPSOSU1",36,0)
 N XDATA,DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","BPSOSU1",37,0)
 ;
"RTN","BPSOSU1",38,0)
 Q:$G(PROMPT)="" ""
"RTN","BPSOSU1",39,0)
 ;
"RTN","BPSOSU1",40,0)
 S $P(DIR(0),"^",1)="DA"_$S(OPT=1:"O",1:"")
"RTN","BPSOSU1",41,0)
 S $P(XDATA,":",1)=SDATE
"RTN","BPSOSU1",42,0)
 S $P(XDATA,":",2)=EDATE
"RTN","BPSOSU1",43,0)
 S $P(XDATA,":",3)=%DT
"RTN","BPSOSU1",44,0)
 S $P(DIR(0),"^",2)=XDATA
"RTN","BPSOSU1",45,0)
 S DIR("A")=PROMPT
"RTN","BPSOSU1",46,0)
 S:$G(DFLT)'="" DIR("B")=$$FM2EXT(DFLT)
"RTN","BPSOSU1",47,0)
 S:+$G(TIMEOUT)>0 DIR("T")=TIMEOUT
"RTN","BPSOSU1",48,0)
 D ^DIR
"RTN","BPSOSU1",49,0)
 Q $S($G(DTOUT)=1:-1,$G(DIROUT)=1:"^^",$G(DUOUT)=1:"^",1:Y)
"RTN","BPSOSU1",50,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU1",51,0)
 ;Convert FileMan Date to External Date Format
"RTN","BPSOSU1",52,0)
 ;
"RTN","BPSOSU1",53,0)
 ;Parameters:    Y       - FileMan formatted date (YYYMMDD.HHMMSS)
"RTN","BPSOSU1",54,0)
 ;Returns:      Y       - External date
"RTN","BPSOSU1",55,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU1",56,0)
FM2EXT(Y) ;EP
"RTN","BPSOSU1",57,0)
 Q:$G(^DD("DD"))="" ""
"RTN","BPSOSU1",58,0)
 X ^DD("DD")
"RTN","BPSOSU1",59,0)
 Q $S($E(Y,1,3)?3A:Y,1:"")
"RTN","BPSOSU1",60,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU1",61,0)
 ;
"RTN","BPSOSU1",62,0)
FM3EXT(Y) ;EP   IHS/SD/lwj 8/5/02 clone of FM2EXT- accommodates 5.1 type clms
"RTN","BPSOSU1",63,0)
 Q:$E(Y,1,1)["C" Y
"RTN","BPSOSU1",64,0)
 S Y=Y-17000000
"RTN","BPSOSU1",65,0)
 Q:$G(^DD("DD"))="" ""
"RTN","BPSOSU1",66,0)
 X ^DD("DD")
"RTN","BPSOSU1",67,0)
 Q $S($E(Y,1,3)?3A:Y,1:"")
"RTN","BPSOSU1",68,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU1",69,0)
 ;
"RTN","BPSOSU1",70,0)
FM2MDY(Y) ;EP
"RTN","BPSOSU1",71,0)
 Q:Y="" ""
"RTN","BPSOSU1",72,0)
 Q $E(Y,4,5)_"/"_$E(Y,6,7)_"/"_$E(Y,2,3)
"RTN","BPSOSU1",73,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU1",74,0)
 ;Convert External Date to FileMan Date Format
"RTN","BPSOSU1",75,0)
 ;
"RTN","BPSOSU1",76,0)
 ;Parameters:   X       - External date
"RTN","BPSOSU1",77,0)
 ;Returns:      Y       - FileMan formatted date (YYYMMDD.HHMMSS)
"RTN","BPSOSU1",78,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU1",79,0)
EXT2FM(X) ;
"RTN","BPSOSU1",80,0)
 N %DT,Y
"RTN","BPSOSU1",81,0)
 Q:$G(X)="" ""
"RTN","BPSOSU1",82,0)
 D ^%DT
"RTN","BPSOSU1",83,0)
 Q Y
"RTN","BPSOSU1",84,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU1",85,0)
 ;Returns current Date/Time in FileMan date format
"RTN","BPSOSU1",86,0)
NOWFM() ;EP
"RTN","BPSOSU1",87,0)
 N %,%H,%I,X
"RTN","BPSOSU1",88,0)
 D NOW^%DTC
"RTN","BPSOSU1",89,0)
 Q %
"RTN","BPSOSU1",90,0)
NOWEXT() ;EP - External form of $$NOWFM
"RTN","BPSOSU1",91,0)
 N Y S Y=$$NOWFM X ^DD("DD") Q Y
"RTN","BPSOSU1",92,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU1",93,0)
 ;Takes a FileMan date and adds or subtracts days
"RTN","BPSOSU1",94,0)
 ;
"RTN","BPSOSU1",95,0)
 ;Parameters:   X1   - FileMan formatted date
"RTN","BPSOSU1",96,0)
 ;              X2   - Number of days (ECME = add, neg = subtract)
"RTN","BPSOSU1",97,0)
 ;Returns:      X    - Resulting FileMan formatted date
"RTN","BPSOSU1",98,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU1",99,0)
CDTFM(X1,X2) ;EP - BPSER*,BPSES02
"RTN","BPSOSU1",100,0)
 N X,%H
"RTN","BPSOSU1",101,0)
 Q:$G(X1)="" ""
"RTN","BPSOSU1",102,0)
 Q:$G(X2)="" ""
"RTN","BPSOSU1",103,0)
 D C^%DTC
"RTN","BPSOSU1",104,0)
 Q X
"RTN","BPSOSU1",105,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU1",106,0)
 ;Takes a FileMan date and returns 3-digit julian date
"RTN","BPSOSU1",107,0)
JULDATE(DT) ;
"RTN","BPSOSU1",108,0)
 N X,X1,X2,%H,%T,%Y
"RTN","BPSOSU1",109,0)
 Q:'(DT?7N) ""
"RTN","BPSOSU1",110,0)
 S X2=$E(DT,1,3)_"0101",X1=DT
"RTN","BPSOSU1",111,0)
 D ^%DTC
"RTN","BPSOSU1",112,0)
 S X=X+1
"RTN","BPSOSU1",113,0)
 Q $TR($J(X,3)," ","0")
"RTN","BPSOSU1",114,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU1",115,0)
 ;
"RTN","BPSOSU1",116,0)
 ;$$DTR(AA,AB,ADEF,BDEF,T) Input Beginning & Ending prompts, return
"RTN","BPSOSU1",117,0)
 ;                       "Begin date^End date" or 0 if unsuccessful.
"RTN","BPSOSU1",118,0)
 ;$$DTR() is okay - all args are optional
"RTN","BPSOSU1",119,0)
 ;$$DTP(AA,DEF) Input a prompt, return a single date "Internal^External"
"RTN","BPSOSU1",120,0)
 ;$$DTM(AA,DEF) Input a prompt, return month/year "Internal^External"
"RTN","BPSOSU1",121,0)
 ;--------------------------------------------------------------------
"RTN","BPSOSU1",122,0)
 ;
"RTN","BPSOSU1",123,0)
DTR(AA,AB,ADEF,BDEF,T) ;EP - GET THE DATE RANGE (beginning and ending dates)
"RTN","BPSOSU1",124,0)
 ; IN:
"RTN","BPSOSU1",125,0)
 ;    AA   = PROMPT for BEGINNING DATE
"RTN","BPSOSU1",126,0)
 ;    AB   = PROMPT for ENDING DATE
"RTN","BPSOSU1",127,0)
 ;    ADEF = DEFAULT date for BEGINNING DATE
"RTN","BPSOSU1",128,0)
 ;    BDEF = DEFAULT date for ENDING DATE
"RTN","BPSOSU1",129,0)
 ;    T    = whether TIME is allowed as entry, and if REQUIRED
"RTN","BPSOSU1",130,0)
 ;           (If T="T" then TIME is allowed; is REQ'd if T="R").
"RTN","BPSOSU1",131,0)
 ; OUT:
"RTN","BPSOSU1",132,0)
 ;    Beginning Date^Ending Date in 7digit FileMan format
"RTN","BPSOSU1",133,0)
 ;      If user enters "^" then out=0
"RTN","BPSOSU1",134,0)
 ;
"RTN","BPSOSU1",135,0)
 NEW %DT,X,Y,U,PROMPT,DEFAULT,BEGDT,ENDDT
"RTN","BPSOSU1",136,0)
 S U="^"
"RTN","BPSOSU1",137,0)
 ;
"RTN","BPSOSU1",138,0)
DTR1 ; -- Get beginning date
"RTN","BPSOSU1",139,0)
 S %DT="AE"_$G(T)
"RTN","BPSOSU1",140,0)
 I $D(AA) S PROMPT=AA
"RTN","BPSOSU1",141,0)
 E  S PROMPT="Enter the Beginning Date"_$S($G(T)]"":" @ Time",1:"")_": "
"RTN","BPSOSU1",142,0)
 S:$D(ADEF) DEFAULT=ADEF
"RTN","BPSOSU1",143,0)
 S BEGDT=$$DATE^BPSOSU1(PROMPT,$G(DEFAULT),1,1000101,3991231,%DT,$G(DTIME))
"RTN","BPSOSU1",144,0)
 I BEGDT<1 QUIT 0
"RTN","BPSOSU1",145,0)
 ;
"RTN","BPSOSU1",146,0)
 WRITE !
"RTN","BPSOSU1",147,0)
 S %DT="AE"_$G(T)
"RTN","BPSOSU1",148,0)
 I $D(AB) S PROMPT=AB
"RTN","BPSOSU1",149,0)
 E  S PROMPT="Enter the Ending Date"_$S($G(T)]"":" @ Time",1:"")_": "
"RTN","BPSOSU1",150,0)
 S:$D(BDEF) DEFAULT=BDEF
"RTN","BPSOSU1",151,0)
 S ENDDT=$$DATE^BPSOSU1(PROMPT,$G(DEFAULT),1,BEGDT,3991231,%DT,$G(DTIME))
"RTN","BPSOSU1",152,0)
 I ENDDT["^" Q 0  ;user wants out if "^"
"RTN","BPSOSU1",153,0)
 ; -- Ensure END date is not earlier than BEG date
"RTN","BPSOSU1",154,0)
 I ENDDT<BEGDT WRITE $C(7),!!,"Ending date must not be less than beginning date!",!! HANG 2 GOTO DTR1
"RTN","BPSOSU1",155,0)
 QUIT BEGDT_U_ENDDT
"RTN","BPSOSU1",156,0)
 ;--------------------------------------------------------------------
"RTN","BPSOSU1",157,0)
 ;
"RTN","BPSOSU1",158,0)
 ;
"RTN","BPSOSU1",159,0)
DTP(AA,DEF) ;EP - *** GET A SINGLE PAST DATE, TIME NOT ALLOWED ***
"RTN","BPSOSU1",160,0)
 ;
"RTN","BPSOSU1",161,0)
 ; IN:  AA  = PROMPT you want displayed to user
"RTN","BPSOSU1",162,0)
 ;      DEF = DEFAULT date
"RTN","BPSOSU1",163,0)
 ; OUT: FileMan Date^readable Date
"RTN","BPSOSU1",164,0)
 ;      If user enters "^" then OUT=0
"RTN","BPSOSU1",165,0)
 ;
"RTN","BPSOSU1",166,0)
 NEW %DT,Y,DATE
"RTN","BPSOSU1",167,0)
 S:'$D(U) U="^"
"RTN","BPSOSU1",168,0)
 I '$D(DT)#2 DO DT^DICRW ;get today's date
"RTN","BPSOSU1",169,0)
 S U="^"
"RTN","BPSOSU1",170,0)
 S %DT="AEPX" ;ask, echo, past dates assumed, exact date reqd
"RTN","BPSOSU1",171,0)
 S %DT("A")=$S($D(AA):AA,1:"What DATE: ")
"RTN","BPSOSU1",172,0)
 S:$D(DEF) %DT("B")=DEF
"RTN","BPSOSU1",173,0)
 DO ^%DT KILL %DT
"RTN","BPSOSU1",174,0)
 ; -- Q if no data
"RTN","BPSOSU1",175,0)
 I Y<1 QUIT 0  ;quit if date was invalid
"RTN","BPSOSU1",176,0)
 I $D(DTOUT) QUIT 0  ;quit if timeout occurred
"RTN","BPSOSU1",177,0)
 ; -- Define dates
"RTN","BPSOSU1",178,0)
 ; DATE("Y") is FM format date; DATE is MON DD,YEAR format.
"RTN","BPSOSU1",179,0)
 S DATE("Y")=Y XECUTE ^DD("DD") S DATE=Y
"RTN","BPSOSU1",180,0)
 QUIT DATE("Y")_U_DATE
"RTN","BPSOSU1",181,0)
 ;--------------------------------------------------------------------
"RTN","BPSOSU2")
0^49^B3696571
"RTN","BPSOSU2",1,0)
BPSOSU2 ;BHAM ISC/FCS/DRS/FLS - copied for ECME ;03/07/08  10:36
"RTN","BPSOSU2",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,7**;JUN 2004;Build 46
"RTN","BPSOSU2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSU2",4,0)
 ;
"RTN","BPSOSU2",5,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU2",6,0)
 ;Standard FREETEXT and Numeric Functions
"RTN","BPSOSU2",7,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU2",8,0)
 ;Standard FREETEXT PROMPT:
"RTN","BPSOSU2",9,0)
 ;
"RTN","BPSOSU2",10,0)
 ;Parameters:
"RTN","BPSOSU2",11,0)
 ;    PROMPT  = Text to be displayed before read
"RTN","BPSOSU2",12,0)
 ;    DFLT    = DEFAULT text
"RTN","BPSOSU2",13,0)
 ;    OPT     = 1 - Answer optional       0 - Answer required
"RTN","BPSOSU2",14,0)
 ;    MINLEN  = Minimum length of response text
"RTN","BPSOSU2",15,0)
 ;    MAXLEN  = Maximum length of response text
"RTN","BPSOSU2",16,0)
 ;    TIMEOUT = Number of seconds
"RTN","BPSOSU2",17,0)
 ;
"RTN","BPSOSU2",18,0)
 ;Returns:
"RTN","BPSOSU2",19,0)
 ;    <null>  = No response             <^> - Up-arrow entered
"RTN","BPSOSU2",20,0)
 ;    <-1>    = Timeout occurred       <^^> - Two up-arrows entered
"RTN","BPSOSU2",21,0)
 ;    <text>  = Response text
"RTN","BPSOSU2",22,0)
 ;---------------------------------------------------------------------
"RTN","BPSOSU2",23,0)
FREETEXT(PROMPT,DFLT,OPT,MINLEN,MAXLEN,TIMEOUT) ;EP
"RTN","BPSOSU2",24,0)
 ;
"RTN","BPSOSU2",25,0)
 N XDATA,DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","BPSOSU2",26,0)
 ;
"RTN","BPSOSU2",27,0)
 Q:$G(PROMPT)="" ""
"RTN","BPSOSU2",28,0)
 S:$G(MINLEN)="" MINLEN=0
"RTN","BPSOSU2",29,0)
 S:$G(MAXLEN)="" MAXLEN=245
"RTN","BPSOSU2",30,0)
 ;
"RTN","BPSOSU2",31,0)
 S $P(DIR(0),"^",1)="FA"_$S(OPT=1:"O",1:"")
"RTN","BPSOSU2",32,0)
 S $P(XDATA,":",1)=MINLEN
"RTN","BPSOSU2",33,0)
 S $P(XDATA,":",2)=MAXLEN
"RTN","BPSOSU2",34,0)
 S $P(DIR(0),"^",2)=XDATA
"RTN","BPSOSU2",35,0)
 S DIR("A")=PROMPT
"RTN","BPSOSU2",36,0)
 S:$G(DFLT)'="" DIR("B")=DFLT
"RTN","BPSOSU2",37,0)
 S:+$G(TIMEOUT)>0 DIR("T")=TIMEOUT
"RTN","BPSOSU2",38,0)
 D ^DIR
"RTN","BPSOSU2",39,0)
 Q $S($G(DTOUT)=1:-1,$G(DIROUT)=1:"^^",$G(DUOUT)=1:"^",1:Y)
"RTN","BPSOSU2",40,0)
 ;---------------------------------------------------------------------
"RTN","BPSOSU2",41,0)
 ;Standard Numeric PROMPT:
"RTN","BPSOSU2",42,0)
 ;
"RTN","BPSOSU2",43,0)
 ;Parameters:
"RTN","BPSOSU2",44,0)
 ;    PROMPT  = Text to be displayed before read
"RTN","BPSOSU2",45,0)
 ;    DFLT    = DEFAULT Numeric
"RTN","BPSOSU2",46,0)
 ;    OPT     = 1 - Answer optional       0 - Answer required
"RTN","BPSOSU2",47,0)
 ;    MINNUM  = Minimum numeric value
"RTN","BPSOSU2",48,0)
 ;    MAXNUM  = Maximum numeric value
"RTN","BPSOSU2",49,0)
 ;    MAXDEC  = Maximum number of decimal places allowed
"RTN","BPSOSU2",50,0)
 ;    TIMEOUT = Number of seconds
"RTN","BPSOSU2",51,0)
 ;
"RTN","BPSOSU2",52,0)
 ;Returns:
"RTN","BPSOSU2",53,0)
 ;    <null>     = No response             <^> - Up-arrow entered
"RTN","BPSOSU2",54,0)
 ;    <-1>       = Timeout occurred       <^^> - Two up-arrows entered
"RTN","BPSOSU2",55,0)
 ;    <Numeric>  = Response Numeric
"RTN","BPSOSU2",56,0)
 ;---------------------------------------------------------------------
"RTN","BPSOSU2",57,0)
NUMERIC(PROMPT,DFLT,OPT,MINNUM,MAXNUM,MAXDEC,TIMEOUT) ;EP
"RTN","BPSOSU2",58,0)
 ;
"RTN","BPSOSU2",59,0)
 N XDATA,DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","BPSOSU2",60,0)
 ;
"RTN","BPSOSU2",61,0)
 Q:$G(PROMPT)="" ""
"RTN","BPSOSU2",62,0)
 ;
"RTN","BPSOSU2",63,0)
 S $P(DIR(0),"^",1)="NA"_$S(OPT=1:"O",1:"")
"RTN","BPSOSU2",64,0)
 S $P(XDATA,":",1)=$G(MINNUM)
"RTN","BPSOSU2",65,0)
 S $P(XDATA,":",2)=$G(MAXNUM)
"RTN","BPSOSU2",66,0)
 S $P(XDATA,":",3)=$G(MAXDEC)
"RTN","BPSOSU2",67,0)
 S $P(DIR(0),"^",2)=XDATA
"RTN","BPSOSU2",68,0)
 S DIR("A")=PROMPT
"RTN","BPSOSU2",69,0)
 S:$G(DFLT)'="" DIR("B")=DFLT
"RTN","BPSOSU2",70,0)
 S:+$G(TIMEOUT)>0 DIR("T")=TIMEOUT
"RTN","BPSOSU2",71,0)
 D ^DIR
"RTN","BPSOSU2",72,0)
 Q $S($G(DTOUT)=1:-1,$G(DIROUT)=1:"^^",$G(DUOUT)=1:"^",1:Y)
"RTN","BPSOSU3")
0^50^B2862686
"RTN","BPSOSU3",1,0)
BPSOSU3 ;BHAM ISC/FCS/DRS/FLS - copied for ECME ;03/07/08  10:37
"RTN","BPSOSU3",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,7**;JUN 2004;Build 46
"RTN","BPSOSU3",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSU3",4,0)
 ;
"RTN","BPSOSU3",5,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU3",6,0)
 ;Standard SET and YESNO Functions
"RTN","BPSOSU3",7,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU3",8,0)
 ;Standard SET PROMPT:
"RTN","BPSOSU3",9,0)
 ;
"RTN","BPSOSU3",10,0)
 ;Parameters:
"RTN","BPSOSU3",11,0)
 ;    PROMPT  = Text to be displayed before read
"RTN","BPSOSU3",12,0)
 ;    DFLT    = DEFAULT choice (external format)
"RTN","BPSOSU3",13,0)
 ;    OPT     = 1 - Answer optional       0 - Answer required
"RTN","BPSOSU3",14,0)
 ;    DISPLAY = V - Vertical display      H - Horizontal display
"RTN","BPSOSU3",15,0)
 ;              N - No display
"RTN","BPSOSU3",16,0)
 ;    CHOICES = <code>:<choice>;<code>:<choice>.....
"RTN","BPSOSU3",17,0)
 ;    TIMEOUT = Number of seconds
"RTN","BPSOSU3",18,0)
 ;
"RTN","BPSOSU3",19,0)
 ;Returns:
"RTN","BPSOSU3",20,0)
 ;    <null>     = No response             <^> - Up-arrow entered
"RTN","BPSOSU3",21,0)
 ;    <-1>       = Timeout occurred       <^^> - Two up-arrows entered
"RTN","BPSOSU3",22,0)
 ;    <Choice>   = Response choice (internal format)
"RTN","BPSOSU3",23,0)
 ;---------------------------------------------------------------------
"RTN","BPSOSU3",24,0)
SET(PROMPT,DFLT,OPT,DISPLAY,CHOICES,TIMEOUT) ;EP
"RTN","BPSOSU3",25,0)
 ;
"RTN","BPSOSU3",26,0)
 N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","BPSOSU3",27,0)
 ;
"RTN","BPSOSU3",28,0)
 Q:$G(PROMPT)="" ""
"RTN","BPSOSU3",29,0)
 Q:$G(DISPLAY)="" ""
"RTN","BPSOSU3",30,0)
 Q:$G(CHOICES)="" ""
"RTN","BPSOSU3",31,0)
 ;
"RTN","BPSOSU3",32,0)
 S $P(DIR(0),"^",1)="S"_$S(DISPLAY="H":"B",DISPLAY="N":"A",1:"")_$S(OPT=1:"O",1:"")
"RTN","BPSOSU3",33,0)
 S $P(DIR(0),"^",2)=CHOICES
"RTN","BPSOSU3",34,0)
 S DIR("A")=PROMPT
"RTN","BPSOSU3",35,0)
 S:$G(DFLT)'="" DIR("B")=DFLT
"RTN","BPSOSU3",36,0)
 S:+$G(TIMEOUT)>0 DIR("T")=TIMEOUT
"RTN","BPSOSU3",37,0)
 D ^DIR
"RTN","BPSOSU3",38,0)
 Q $S($G(DTOUT)=1:-1,$G(DIROUT)=1:"^^",$G(DUOUT)=1:"^",1:Y)
"RTN","BPSOSU3",39,0)
 ;---------------------------------------------------------------------
"RTN","BPSOSU3",40,0)
 ;Standard Yes/No PROMPT:
"RTN","BPSOSU3",41,0)
 ;
"RTN","BPSOSU3",42,0)
 ;Parameters:
"RTN","BPSOSU3",43,0)
 ;    PROMPT  = Text to be displayed before read
"RTN","BPSOSU3",44,0)
 ;    DFLT    = YES, NO or <Null>
"RTN","BPSOSU3",45,0)
 ;    OPT     = 1 - Answer optional       0 - Answer required
"RTN","BPSOSU3",46,0)
 ;    TIMEOUT = Number of seconds
"RTN","BPSOSU3",47,0)
 ;
"RTN","BPSOSU3",48,0)
 ;Returns:
"RTN","BPSOSU3",49,0)
 ;    <null>     = No response             <^> - Up-arrow entered
"RTN","BPSOSU3",50,0)
 ;    <-1>       = Timeout occurred       <^^> - Two up-arrows entered
"RTN","BPSOSU3",51,0)
 ;    <0>        = No                      <1> - Yes
"RTN","BPSOSU3",52,0)
 ;---------------------------------------------------------------------
"RTN","BPSOSU3",53,0)
YESNO(PROMPT,DFLT,OPT,TIMEOUT) ;EP
"RTN","BPSOSU3",54,0)
 ;
"RTN","BPSOSU3",55,0)
 N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","BPSOSU3",56,0)
 ;
"RTN","BPSOSU3",57,0)
 Q:$G(PROMPT)="" ""
"RTN","BPSOSU3",58,0)
 ;
"RTN","BPSOSU3",59,0)
 S $P(DIR(0),"^",1)="Y"_$S(OPT=1:"O",1:"")
"RTN","BPSOSU3",60,0)
 S DIR("A")=PROMPT
"RTN","BPSOSU3",61,0)
 S:$G(DFLT)'="" DIR("B")=DFLT
"RTN","BPSOSU3",62,0)
 S:+$G(TIMEOUT)>0 DIR("T")=TIMEOUT
"RTN","BPSOSU3",63,0)
 D ^DIR
"RTN","BPSOSU3",64,0)
 Q $S($G(DTOUT)=1:-1,$G(DIROUT)=1:"^^",$G(DUOUT)=1:"^",1:Y)
"RTN","BPSOSU4")
0^51^B25067052
"RTN","BPSOSU4",1,0)
BPSOSU4 ;BHAM ISC/FCS/DRS/FLS - copied for ECME ;03/07/08  10:38
"RTN","BPSOSU4",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,7**;JUN 2004;Build 46
"RTN","BPSOSU4",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSU4",4,0)
 ;
"RTN","BPSOSU4",5,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU4",6,0)
 ;Standard List PROMPT:
"RTN","BPSOSU4",7,0)
 ;
"RTN","BPSOSU4",8,0)
 ;Parameters:
"RTN","BPSOSU4",9,0)
 ;   TYPE     - S or M (single or multiple selection)
"RTN","BPSOSU4",10,0)
 ;   LROOT    - List global root (eg: "^LIST($J,")
"RTN","BPSOSU4",11,0)
 ;   AROOT    - Answer global root (eg: "^LISTANS($J,")
"RTN","BPSOSU4",12,0)
 ;   STITLE   - Screen Title
"RTN","BPSOSU4",13,0)
 ;   .PROMPT  - List PROMPT Array
"RTN","BPSOSU4",14,0)
 ;   OPTIONAL - 1 or 0 (optional or required)
"RTN","BPSOSU4",15,0)
 ;   PGLEN    - Page length
"RTN","BPSOSU4",16,0)
 ;   TIMEOUT  - Number of seconds
"RTN","BPSOSU4",17,0)
 ;
"RTN","BPSOSU4",18,0)
 ;Returns:
"RTN","BPSOSU4",19,0)
 ;   <null>   - Unable to process list
"RTN","BPSOSU4",20,0)
 ;   <Ans>    - For TYPE="S", item selected
"RTN","BPSOSU4",21,0)
 ;   <^>      - Up-arrow entered
"RTN","BPSOSU4",22,0)
 ;   <^^>     - Two up-arrows entered
"RTN","BPSOSU4",23,0)
 ;   <-1>     - Timeout occurred
"RTN","BPSOSU4",24,0)
 ;
"RTN","BPSOSU4",25,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU4",26,0)
LIST(TYPE,LROOT,AROOT,STITLE,PROMPT,OPTIONAL,PGLEN,TIMEOUT) ;EP
"RTN","BPSOSU4",27,0)
 ;
"RTN","BPSOSU4",28,0)
 ;Manage local variables
"RTN","BPSOSU4",29,0)
 N CPAGE,NPAGES,START,END,ANS,NLINES,CHEAD1,CHEAD2,I,CMD
"RTN","BPSOSU4",30,0)
 ;
"RTN","BPSOSU4",31,0)
 Q:$G(TYPE)="" ""
"RTN","BPSOSU4",32,0)
 Q:$G(LROOT)="" ""
"RTN","BPSOSU4",33,0)
 Q:$G(AROOT)="" ""
"RTN","BPSOSU4",34,0)
 ;
"RTN","BPSOSU4",35,0)
 S STITLE=$G(STITLE)
"RTN","BPSOSU4",36,0)
 S OPTIONAL=+$G(OPTIONAL)
"RTN","BPSOSU4",37,0)
 S:$G(PGLEN)="" PGLEN=10
"RTN","BPSOSU4",38,0)
 S:$G(TIMEOUT)="" TIMEOUT=$G(DTIME)
"RTN","BPSOSU4",39,0)
 ;
"RTN","BPSOSU4",40,0)
 D INIT
"RTN","BPSOSU4",41,0)
LP1 D DPAGE
"RTN","BPSOSU4",42,0)
 S ANS=$$PROMPT()
"RTN","BPSOSU4",43,0)
 I ANS="?" D DHELP G LP1
"RTN","BPSOSU4",44,0)
 Q:(TYPE="M")&('OPTIONAL)&(ANS="^")&($D(@($E(AROOT,1,$L(AROOT)-1)_")"))'=0) ANS
"RTN","BPSOSU4",45,0)
 Q:OPTIONAL&(ANS="^") ANS
"RTN","BPSOSU4",46,0)
 Q:ANS="^^" ANS
"RTN","BPSOSU4",47,0)
 Q:ANS="TIMEOUT" -1
"RTN","BPSOSU4",48,0)
 I ANS="" D NEXTPG G LP1
"RTN","BPSOSU4",49,0)
 I $E(ANS,1)="P" D JUMPPG G LP1
"RTN","BPSOSU4",50,0)
 ;
"RTN","BPSOSU4",51,0)
 I TYPE="S"&(+ANS<1!(+ANS>END)) G LP1
"RTN","BPSOSU4",52,0)
 I TYPE="S"&(+ANS>0&(+ANS'>END)) S @(AROOT_(+ANS)_")")="" Q ANS
"RTN","BPSOSU4",53,0)
 I TYPE="M" F I=1:1:$L(ANS,",") D
"RTN","BPSOSU4",54,0)
 .S CMD=$P(ANS,",",I)
"RTN","BPSOSU4",55,0)
 .I CMD?1N.N D MARK(CMD) Q
"RTN","BPSOSU4",56,0)
 .I CMD?1"-".N D UNMARK($P(CMD,"-",2)) Q
"RTN","BPSOSU4",57,0)
 .I CMD?1N.N1"-"1N.N D RMARK(CMD) Q
"RTN","BPSOSU4",58,0)
 .I CMD?1"-"1N.N1"-"1N.N D RUNMARK(CMD) Q
"RTN","BPSOSU4",59,0)
 G LP1
"RTN","BPSOSU4",60,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU4",61,0)
HEADER N LINE
"RTN","BPSOSU4",62,0)
 W @IOF,!
"RTN","BPSOSU4",63,0)
 D:STITLE'="" WCENTER^BPSOSU9(STITLE,IOM)
"RTN","BPSOSU4",64,0)
 D:STITLE'="" WCENTER^BPSOSU9($TR($J("",$L(STITLE))," ","-"),IOM)
"RTN","BPSOSU4",65,0)
 ;
"RTN","BPSOSU4",66,0)
 ;DISPLAY PROMPT LINEs
"RTN","BPSOSU4",67,0)
 S LINE=0
"RTN","BPSOSU4",68,0)
 F  D  Q:LINE=""
"RTN","BPSOSU4",69,0)
 .S LINE=$O(PROMPT(LINE))
"RTN","BPSOSU4",70,0)
 .Q:LINE=""
"RTN","BPSOSU4",71,0)
 .W:LINE=1 !!
"RTN","BPSOSU4",72,0)
 .W PROMPT(LINE),!
"RTN","BPSOSU4",73,0)
 ;
"RTN","BPSOSU4",74,0)
 W:$G(CHEAD1)'="" !,?9,CHEAD1,!
"RTN","BPSOSU4",75,0)
 W:$G(CHEAD2)'="" ?9,CHEAD2
"RTN","BPSOSU4",76,0)
 Q
"RTN","BPSOSU4",77,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU4",78,0)
INIT N CNSPACES,CNAMES,CDEF,INDEX,COLUMNS
"RTN","BPSOSU4",79,0)
 S NLINES=+$G(@(LROOT_"0)")) I 'NLINES D  Q
"RTN","BPSOSU4",80,0)
 . D IMPOSS^BPSOSUE("P","TI","0 lines indicated in "_LROOT,,"INIT",$T(+0))
"RTN","BPSOSU4",81,0)
 S NPAGES=((NLINES-1)\PGLEN)+1
"RTN","BPSOSU4",82,0)
 S CPAGE=1
"RTN","BPSOSU4",83,0)
 S COLUMNS=$G(@(LROOT_"""Column HEADERs"""_")"))
"RTN","BPSOSU4",84,0)
 D:COLUMNS'=""
"RTN","BPSOSU4",85,0)
 .S (CHEAD1,CHEAD2)=""
"RTN","BPSOSU4",86,0)
 .S CNSPACES=$P(COLUMNS,"|",1)
"RTN","BPSOSU4",87,0)
 .S CNAMES=$P(COLUMNS,"|",2)
"RTN","BPSOSU4",88,0)
 .F INDEX=1:1:$L(CNAMES,",") D
"RTN","BPSOSU4",89,0)
 ..S CDEF=$P(CNAMES,",",INDEX)
"RTN","BPSOSU4",90,0)
 ..S CHEAD1=CHEAD1_$S(INDEX=1:"",1:$J("",CNSPACES))_$$LJBF^BPSOSU9($P(CDEF,":",1),$P(CDEF,":",2))
"RTN","BPSOSU4",91,0)
 ..S CHEAD2=CHEAD2_$S(INDEX=1:"",1:$J("",CNSPACES))_$TR($J("",$P(CDEF,":",2))," ","-")
"RTN","BPSOSU4",92,0)
 Q
"RTN","BPSOSU4",93,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU4",94,0)
MARK(X) ;
"RTN","BPSOSU4",95,0)
 Q:X<1!(X>NLINES)
"RTN","BPSOSU4",96,0)
 S @(AROOT_X_")")=""
"RTN","BPSOSU4",97,0)
 Q
"RTN","BPSOSU4",98,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU4",99,0)
RMARK(X) ;
"RTN","BPSOSU4",100,0)
 N START,END,INDEX
"RTN","BPSOSU4",101,0)
 S START=$P(X,"-",1)
"RTN","BPSOSU4",102,0)
 S END=$P(X,"-",2)
"RTN","BPSOSU4",103,0)
 F INDEX=START:1:END D MARK(INDEX)
"RTN","BPSOSU4",104,0)
 Q
"RTN","BPSOSU4",105,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU4",106,0)
UNMARK(X) ;
"RTN","BPSOSU4",107,0)
 Q:X<1!(X>NLINES)
"RTN","BPSOSU4",108,0)
 K @(AROOT_X_")")
"RTN","BPSOSU4",109,0)
 Q
"RTN","BPSOSU4",110,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU4",111,0)
RUNMARK(X) ;
"RTN","BPSOSU4",112,0)
 N START,END,INDEX
"RTN","BPSOSU4",113,0)
 S START=$P(X,"-",2)
"RTN","BPSOSU4",114,0)
 S END=$P(X,"-",3)
"RTN","BPSOSU4",115,0)
 F INDEX=START:1:END D UNMARK(INDEX)
"RTN","BPSOSU4",116,0)
 Q
"RTN","BPSOSU4",117,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU4",118,0)
DPAGE N LNUM
"RTN","BPSOSU4",119,0)
 D HEADER
"RTN","BPSOSU4",120,0)
 W !
"RTN","BPSOSU4",121,0)
 S START=((CPAGE-1)*PGLEN)+1
"RTN","BPSOSU4",122,0)
 S END=START+PGLEN-1
"RTN","BPSOSU4",123,0)
 S:END>NLINES END=NLINES
"RTN","BPSOSU4",124,0)
 F LNUM=START:1:END D
"RTN","BPSOSU4",125,0)
 .W $S($D(@(AROOT_LNUM_")")):"*",1:" ")
"RTN","BPSOSU4",126,0)
 .W $J(LNUM,5)," - "
"RTN","BPSOSU4",127,0)
 .W $G(@(LROOT_LNUM_","_"""E"""_")")),!
"RTN","BPSOSU4",128,0)
 Q
"RTN","BPSOSU4",129,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU4",130,0)
PROMPT() ;
"RTN","BPSOSU4",131,0)
 W:TYPE="S" !,"[Page "_CPAGE_" of "_NPAGES_"]  Commands: #, P#, <Enter>, ^, ^^ or ?",!
"RTN","BPSOSU4",132,0)
 W:TYPE="M" !,"[Page "_CPAGE_" of "_NPAGES_"]  Commands: #, -#, #-#, -#-#, P#, <Enter>, ^, ^^ or ?",!
"RTN","BPSOSU4",133,0)
 W "Select Item #: "
"RTN","BPSOSU4",134,0)
 R ANS:TIMEOUT
"RTN","BPSOSU4",135,0)
 I '$T S ANS="TIMEOUT"
"RTN","BPSOSU4",136,0)
 Q ANS
"RTN","BPSOSU4",137,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU4",138,0)
NEXTPG S CPAGE=CPAGE+1
"RTN","BPSOSU4",139,0)
 S:CPAGE>NPAGES CPAGE=NPAGES
"RTN","BPSOSU4",140,0)
 Q
"RTN","BPSOSU4",141,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU4",142,0)
JUMPPG N NUM
"RTN","BPSOSU4",143,0)
 Q:$E(ANS,1)'="P"
"RTN","BPSOSU4",144,0)
 S NUM=+$P(ANS,"P",2)
"RTN","BPSOSU4",145,0)
 Q:NUM<1!(NUM>NPAGES)
"RTN","BPSOSU4",146,0)
 S CPAGE=NUM
"RTN","BPSOSU4",147,0)
 Q
"RTN","BPSOSU4",148,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU4",149,0)
DHELP ;
"RTN","BPSOSU4",150,0)
 N X
"RTN","BPSOSU4",151,0)
 W !!,"Enter one of the following commands:",!!
"RTN","BPSOSU4",152,0)
 W ?10,"#",?20,"- Selects entry number # from the list",!
"RTN","BPSOSU4",153,0)
 W:TYPE="M" ?10,"-#",?20,"- Deselects entry number # from the list",!
"RTN","BPSOSU4",154,0)
 W:TYPE="M" ?10,"#-#",?20,"- Selects the range of entries # thru #",!
"RTN","BPSOSU4",155,0)
 W:TYPE="M" ?10,"-#-#",?20,"- Deselects the range of entries # thru #",!
"RTN","BPSOSU4",156,0)
 W:TYPE="M"!(TYPE="S"&(OPTIONAL)) ?10,"^",?20,"- Exit the list",!
"RTN","BPSOSU4",157,0)
 W ?10,"P#",?20,"- Jumps to page number #",!
"RTN","BPSOSU4",158,0)
 W ?10,"<Enter>",?20,"- DISPLAYs next page",!
"RTN","BPSOSU4",159,0)
 W ?10,"^^",?20,"- Aborts and returns to menu",!
"RTN","BPSOSU4",160,0)
 W ?10,"?",?20,"- DISPLAYs this help text",!!
"RTN","BPSOSU4",161,0)
 D PRESSANY^BPSOSU5(0,TIMEOUT)
"RTN","BPSOSU4",162,0)
 Q
"RTN","BPSOSU5")
0^52^B2226067
"RTN","BPSOSU5",1,0)
BPSOSU5 ;BHAM ISC/FCS/DRS/FLS - utilities ;03/07/08  10:39
"RTN","BPSOSU5",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,7**;JUN 2004;Build 46
"RTN","BPSOSU5",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSU5",4,0)
 ;
"RTN","BPSOSU5",5,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU5",6,0)
TOSCREEN()         ;EP; True or False, is output to screen?
"RTN","BPSOSU5",7,0)
 I $E(IOST)'="C" Q 0
"RTN","BPSOSU5",8,0)
 I $D(ZTQUEUED) Q 0
"RTN","BPSOSU5",9,0)
 I IOT'="TRM",IOT'="VTRM" Q 0
"RTN","BPSOSU5",10,0)
 I $D(IO("S")) Q 0
"RTN","BPSOSU5",11,0)
 Q 1
"RTN","BPSOSU5",12,0)
PRESSANY(NLF,TIMEOUT) ;EP
"RTN","BPSOSU5",13,0)
 I '$$TOSCREEN Q
"RTN","BPSOSU5",14,0)
 N X,I
"RTN","BPSOSU5",15,0)
 S NLF=+$G(NLF)
"RTN","BPSOSU5",16,0)
 S:+$G(TIMEOUT)=0 TIMEOUT=30
"RTN","BPSOSU5",17,0)
 F I=1:1:NLF W !
"RTN","BPSOSU5",18,0)
 I $$FREETEXT^BPSOSU2("Press ENTER to continue: ",,1,1,1,300)
"RTN","BPSOSU5",19,0)
 Q
"RTN","BPSOSU5",20,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU5",21,0)
 ;'Press the return key to continue of ^ to exit:' PROMPT
"RTN","BPSOSU5",22,0)
 ; See also $$EOPQ^BPSOSU8
"RTN","BPSOSU5",23,0)
ENDPAGE(NLF,TIMEOUT) ;EP
"RTN","BPSOSU5",24,0)
 I '$$TOSCREEN Q 1
"RTN","BPSOSU5",25,0)
 N X,Y,I,DIR,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","BPSOSU5",26,0)
 S NLF=+$G(NLF)
"RTN","BPSOSU5",27,0)
 F I=1:1:NLF W !
"RTN","BPSOSU5",28,0)
 S:+$G(TIMEOUT)>0 DIR("T")=TIMEOUT
"RTN","BPSOSU5",29,0)
 S DIR(0)="E"
"RTN","BPSOSU5",30,0)
 D ^DIR
"RTN","BPSOSU5",31,0)
 Q $S(Y="":-1,Y=0:"^",1:Y)
"RTN","BPSOSU5",32,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU5",33,0)
ENDRPT() ; EP
"RTN","BPSOSU5",34,0)
 N RETVAL
"RTN","BPSOSU5",35,0)
 S RETVAL=$$ENDRPT^BPSOSU8() Q
"RTN","BPSOSU5",36,0)
 ;=====================================================================
"RTN","BPSOSU5",37,0)
BYE ; EP
"RTN","BPSOSU5",38,0)
 ; Most routines should come here when they exit.
"RTN","BPSOSU5",39,0)
 ; Example: GOTO BYE^BPSOSU3
"RTN","BPSOSU5",40,0)
 ; IN: FLGSTOP   1=user wanted out
"RTN","BPSOSU5",41,0)
 ;
"RTN","BPSOSU5",42,0)
 I $G(FLGSTOP) W "  < exit >" HANG 1
"RTN","BPSOSU5",43,0)
 D ^%ZISC
"RTN","BPSOSU5",44,0)
 Q
"RTN","BPSOSU5",45,0)
 ;=====================================================================
"RTN","BPSOSU5",46,0)
BOTTOM(LINES) ;07/26/96
"RTN","BPSOSU5",47,0)
 ;  IN:  lines (optional) = lines from the bottom  (default=1)
"RTN","BPSOSU5",48,0)
 ;       This line-feeds down to the bottom of the screen
"RTN","BPSOSU5",49,0)
 ;
"RTN","BPSOSU5",50,0)
 Q:'$G(IOSL)
"RTN","BPSOSU5",51,0)
 N X1,X2,J S LINES=$S($D(LINES):LINES,1:1)
"RTN","BPSOSU5",52,0)
 S X1=($Y+2)
"RTN","BPSOSU5",53,0)
 I X1>(IOSL-LINES) DO
"RTN","BPSOSU5",54,0)
 . S X1=($Y+2)
"RTN","BPSOSU5",55,0)
 S X2=(IOSL-X1) F J=1:1:X2 W !
"RTN","BPSOSU5",56,0)
 Q
"RTN","BPSOSU5",57,0)
 ;=================================================================
"RTN","BPSOSU9")
0^53^B6204766
"RTN","BPSOSU9",1,0)
BPSOSU9 ;BHAM ISC/FCS/DRS/FLS - copied for ECME ;03/07/08  10:41
"RTN","BPSOSU9",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,7**;JUN 2004;Build 46
"RTN","BPSOSU9",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSU9",4,0)
 ;
"RTN","BPSOSU9",5,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU9",6,0)
 ;Standard W and String Formatting Functions
"RTN","BPSOSU9",7,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU9",8,0)
WCENTER(TEXT,IOM,UL) ;EP
"RTN","BPSOSU9",9,0)
 S:$G(IOM)="" IOM=80
"RTN","BPSOSU9",10,0)
 W ?IOM-$L(TEXT)/2,TEXT,!
"RTN","BPSOSU9",11,0)
 I $G(UL) W ?IOM-$L(TEXT)/2,$TR($J("",$L(TEXT))," ","-"),!
"RTN","BPSOSU9",12,0)
 Q
"RTN","BPSOSU9",13,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU9",14,0)
 ;W Standard Underlined HEADER
"RTN","BPSOSU9",15,0)
WHEADER(TEXT,IOF,IOM) ;EP
"RTN","BPSOSU9",16,0)
 Q:$G(TEXT)=""
"RTN","BPSOSU9",17,0)
 S:$G(IOF)="" IOF="#"
"RTN","BPSOSU9",18,0)
 S:$G(IOM)="" IOM=80
"RTN","BPSOSU9",19,0)
 W @IOF,!
"RTN","BPSOSU9",20,0)
 D WCENTER(TEXT,IOM)
"RTN","BPSOSU9",21,0)
 D WCENTER($TR($J("",$L(TEXT))," ","-"),IOM)
"RTN","BPSOSU9",22,0)
 Q
"RTN","BPSOSU9",23,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU9",24,0)
 ;W Column HEADERs (with option to underline)
"RTN","BPSOSU9",25,0)
WCOLUMNS(INDENT,COLDEFS,CNAMES,ULINE) ;EP
"RTN","BPSOSU9",26,0)
 N CHEAD1,CHEAD2,INDEX,CDEF
"RTN","BPSOSU9",27,0)
 Q:$G(CNAMES)=""
"RTN","BPSOSU9",28,0)
 S:$G(INDENT)="" INDENT=0
"RTN","BPSOSU9",29,0)
 S:$G(COLDEFS)="" COLDEFS=2
"RTN","BPSOSU9",30,0)
 S:$G(ULINE)="" ULINE=1
"RTN","BPSOSU9",31,0)
 ;
"RTN","BPSOSU9",32,0)
 S COLDEFS=$J("",COLDEFS)
"RTN","BPSOSU9",33,0)
 S (CHEAD1,CHEAD2)=""
"RTN","BPSOSU9",34,0)
 F INDEX=1:1:$L(CNAMES,",") D
"RTN","BPSOSU9",35,0)
 .S CDEF=$P(CNAMES,",",INDEX)
"RTN","BPSOSU9",36,0)
 .S CHEAD1=CHEAD1_$S(INDEX=1:"",1:COLDEFS)_$$LJBF($P(CDEF,":",1),$P(CDEF,":",2))
"RTN","BPSOSU9",37,0)
 .S:ULINE CHEAD2=CHEAD2_$S(INDEX=1:"",1:COLDEFS)_$TR($J("",$P(CDEF,":",2))," ","-")
"RTN","BPSOSU9",38,0)
 W ?INDENT,CHEAD1,!
"RTN","BPSOSU9",39,0)
 W:ULINE ?INDENT,CHEAD2,!
"RTN","BPSOSU9",40,0)
 Q
"RTN","BPSOSU9",41,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU9",42,0)
WDATA(INDENT,COLDEFS,VNAMES) ;EP
"RTN","BPSOSU9",43,0)
 N INDEX,DEF,DLINE,VAR,LEN
"RTN","BPSOSU9",44,0)
 Q:$G(VNAMES)=""
"RTN","BPSOSU9",45,0)
 S:$G(INDENT)="" INDENT=0
"RTN","BPSOSU9",46,0)
 S:$G(COLDEFS)="" COLDEFS=2
"RTN","BPSOSU9",47,0)
 ;
"RTN","BPSOSU9",48,0)
 S COLDEFS=$J("",COLDEFS)
"RTN","BPSOSU9",49,0)
 S DLINE=""
"RTN","BPSOSU9",50,0)
 F INDEX=1:1:$L(VNAMES,",") D
"RTN","BPSOSU9",51,0)
 .S DEF=$P(VNAMES,",",INDEX)
"RTN","BPSOSU9",52,0)
 .S VAR=$P(DEF,":",1)
"RTN","BPSOSU9",53,0)
 .S LEN=$P(DEF,":",2)
"RTN","BPSOSU9",54,0)
 .S DLINE=DLINE_$S(INDEX=1:"",1:COLDEFS)_$$LJBF($S(VAR="":"",1:$G(@VAR)),LEN)
"RTN","BPSOSU9",55,0)
 W ?INDENT,DLINE,!
"RTN","BPSOSU9",56,0)
 Q
"RTN","BPSOSU9",57,0)
 ;
"RTN","BPSOSU9",58,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU9",59,0)
 ;Left justifies and blank fills
"RTN","BPSOSU9",60,0)
LJBF(X,L) ;EP
"RTN","BPSOSU9",61,0)
 Q $E(X_$J("",L-$L(X)),1,L)
"RTN","BPSOSU9",62,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU9",63,0)
 ;Right justifies and blank fills
"RTN","BPSOSU9",64,0)
RJBF(X,L) ;EP
"RTN","BPSOSU9",65,0)
 Q $E($J("",L-$L(X))_X,1,L)
"RTN","BPSOSU9",66,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU9",67,0)
 ;CENTER justifies and blank fills
"RTN","BPSOSU9",68,0)
CJBF(X,L) ;
"RTN","BPSOSU9",69,0)
 Q $$LJBF($E($J("",(L-$L(X))\2)_X,1,L),L)
"RTN","BPSOSU9",70,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU9",71,0)
 ;Convert lower case characters to upper case characters
"RTN","BPSOSU9",72,0)
UCASE(X) ;EP
"RTN","BPSOSU9",73,0)
 Q $TR(X,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")
"RTN","BPSOSU9",74,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU9",75,0)
 ;Convert upper case characters to lower case characters
"RTN","BPSOSU9",76,0)
LCASE(X) ;
"RTN","BPSOSU9",77,0)
 Q $TR(X,"ABCDEFGHIJKLMNOPQRSTUVWXYZ","abcdefghijklmnopqrstuvwxyz")
"RTN","BPSOSU9",78,0)
 ;----------------------------------------------------------------------
"RTN","BPSOSU9",79,0)
 ;Delete leading and trailing blanks
"RTN","BPSOSU9",80,0)
CLIP(X) ;EP
"RTN","BPSOSU9",81,0)
 F  D  Q:$E(X,1)'=" "
"RTN","BPSOSU9",82,0)
 .S:$E(X,1)=" " X=$E(X,2,$L(X))
"RTN","BPSOSU9",83,0)
 F  D  Q:$E(X,$L(X))'=" "
"RTN","BPSOSU9",84,0)
 .S:$E(X,$L(X))=" " X=$E(X,1,$L(X)-1)
"RTN","BPSOSU9",85,0)
 Q X
"RTN","BPSOSUC")
0^11^B6202882
"RTN","BPSOSUC",1,0)
BPSOSUC ;BHAM ISC/FCS/DRS/FLS - ECME utilities ;06/01/2004
"RTN","BPSOSUC",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5,7**;JUN 2004;Build 46
"RTN","BPSOSUC",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSUC",4,0)
 Q
"RTN","BPSOSUC",5,0)
 ; CATEG returns the status of a Transaction or Log of Transaction
"RTN","BPSOSUC",6,0)
 ;   entry.  It is used mainly by STATUS^BPSOSRX but is also
"RTN","BPSOSUC",7,0)
 ;   called by some other routines as well as computed fields of BPS Log
"RTN","BPSOSUC",8,0)
 ;   of Transactions and BPS Tranasctions
"RTN","BPSOSUC",9,0)
CATEG(N,WANTREV) ;
"RTN","BPSOSUC",10,0)
 ; N - If decimal, IEN from BPS Transaction
"RTN","BPSOSUC",11,0)
 ;   - If integer, IEN from BPS Log of Transactions
"RTN","BPSOSUC",12,0)
 ; $G(WANTREV) = true if you care about reversals
"RTN","BPSOSUC",13,0)
 ;      (that's the default if N is an IEN59)
"RTN","BPSOSUC",14,0)
 ; $G(WANTREV) = false if you want to ignore reversals
"RTN","BPSOSUC",15,0)
 ;      (that's the default if IEN57)
"RTN","BPSOSUC",16,0)
 ;
"RTN","BPSOSUC",17,0)
 ; Many routines rely on these exact return values; do not change them:
"RTN","BPSOSUC",18,0)
 ; Return values:
"RTN","BPSOSUC",19,0)
 ;     For both reversals and submissions:
"RTN","BPSOSUC",20,0)
 ;       CORRUPT - Should never happen
"RTN","BPSOSUC",21,0)
 ;
"RTN","BPSOSUC",22,0)
 ;     For submissions:
"RTN","BPSOSUC",23,0)
 ;       E PAYABLE, E CAPTURED, E DUPLICATE, E REJECTED, E OTHER, and
"RTN","BPSOSUC",24,0)
 ;       E UNSTRANDED
"RTN","BPSOSUC",25,0)
 ;
"RTN","BPSOSUC",26,0)
 ;     For Reversals:
"RTN","BPSOSUC",27,0)
 ;       E REVERSAL ACCEPTED, E REVERSAL REJECTED, E REVERSAL OTHER, and
"RTN","BPSOSUC",28,0)
 ;       E REVERSAL UNSTRANDED
"RTN","BPSOSUC",29,0)
 ;
"RTN","BPSOSUC",30,0)
 I N<1 Q "" ; Should not happen
"RTN","BPSOSUC",31,0)
 N FILENUM S FILENUM=$S(N[".":9002313.59,1:9002313.57)
"RTN","BPSOSUC",32,0)
 I '$D(WANTREV) S WANTREV=$S(FILENUM=9002313.57:0,FILENUM=9002313.59:1)
"RTN","BPSOSUC",33,0)
 N RETVAL,CLAIM,RESP,X,RESP500,CODE,STAT,DISYS
"RTN","BPSOSUC",34,0)
 I '$$GET1^DIQ(FILENUM,N_",",.01) Q "CORRUPT"
"RTN","BPSOSUC",35,0)
 S CLAIM=$$GET1^DIQ(FILENUM,N_",",3,"I")
"RTN","BPSOSUC",36,0)
 S RESP=$$GET1^DIQ(FILENUM,N_",",4,"I")
"RTN","BPSOSUC",37,0)
 S CODE=$$GET1^DIQ(FILENUM,N_",",201,"I")
"RTN","BPSOSUC",38,0)
 S STAT=$$GET1^DIQ(FILENUM,N_",",202,"I")
"RTN","BPSOSUC",39,0)
 I $P(STAT,";")="E REVERSAL UNSTRANDED" Q "E REVERSAL UNSTRANDED"
"RTN","BPSOSUC",40,0)
 I $P(STAT,";")="E UNSTRANDED" Q "E UNSTRANDED"
"RTN","BPSOSUC",41,0)
 ; During a reversal/resubmit, you may get the next line between the reversal and
"RTN","BPSOSUC",42,0)
 ;   and the resubmit
"RTN","BPSOSUC",43,0)
 I 'CLAIM S RETVAL="E OTHER" Q RETVAL
"RTN","BPSOSUC",44,0)
 I WANTREV S X=$$GET1^DIQ(FILENUM,N_",",401,"I") I X D  Q RETVAL
"RTN","BPSOSUC",45,0)
 . S RESP=$$GET1^DIQ(FILENUM,N_",",402,"I")
"RTN","BPSOSUC",46,0)
 . S RETVAL="E REVERSAL "
"RTN","BPSOSUC",47,0)
 . I 'RESP S RETVAL=RETVAL_"OTHER" Q
"RTN","BPSOSUC",48,0)
 . S RESP500=$$RESP500^BPSOSQ4(RESP,"I")
"RTN","BPSOSUC",49,0)
 . S X=$$RESP1000^BPSOSQ4(RESP,1,"I")
"RTN","BPSOSUC",50,0)
 . I RESP500="R"!(X="R") S RETVAL=RETVAL_"REJECTED" Q
"RTN","BPSOSUC",51,0)
 . ; Treat Duplicate of Accepted Reversal ("S") as Accepted
"RTN","BPSOSUC",52,0)
 . I RESP500="A",X="A"!(X="S") S RETVAL=RETVAL_"ACCEPTED" Q
"RTN","BPSOSUC",53,0)
 . S RETVAL=RETVAL_"OTHER"
"RTN","BPSOSUC",54,0)
 ; Response not received yet
"RTN","BPSOSUC",55,0)
 I 'RESP S RETVAL="E OTHER" Q RETVAL
"RTN","BPSOSUC",56,0)
 S RESP500=$$RESP500^BPSOSQ4(RESP,"I")
"RTN","BPSOSUC",57,0)
 N POS S POS=$$GET1^DIQ(FILENUM,N_",",14)
"RTN","BPSOSUC",58,0)
 S X=$$RESP1000^BPSOSQ4(RESP,POS,"I")
"RTN","BPSOSUC",59,0)
 I X="P"!(X="DP") Q "E PAYABLE"
"RTN","BPSOSUC",60,0)
 I X="D" Q "E DUPLICATE" ; SHOULD NEVER HAPPEN as of 02/06/2001
"RTN","BPSOSUC",61,0)
 I X="R" Q "E REJECTED"
"RTN","BPSOSUC",62,0)
 I X="C"!(X="DC") Q "E CAPTURED"
"RTN","BPSOSUC",63,0)
 ; 1000 indefinite, fall back to 500
"RTN","BPSOSUC",64,0)
 I RESP500="R" Q "E REJECTED"
"RTN","BPSOSUC",65,0)
 Q "E OTHER" ; corrupt?
"RTN","BPSOSUE")
0^54^B23427846
"RTN","BPSOSUE",1,0)
BPSOSUE ;BHAM ISC/FCS/DRS/FLS - impossible errors ;03/07/08  10:42
"RTN","BPSOSUE",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,7**;JUN 2004;Build 46
"RTN","BPSOSUE",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSOSUE",4,0)
 ;
"RTN","BPSOSUE",5,0)
 ; Deal with impossible errors (errors which should never occur,
"RTN","BPSOSUE",6,0)
 ; and which weren't already trapped by M).
"RTN","BPSOSUE",7,0)
 ;
"RTN","BPSOSUE",8,0)
IMPOSS(UETYPE,UEOPT,UEMSG,UEMSG2,UELOC,UEROU,UENOLOG) ;EP - deal with impossible errors - called from many places
"RTN","BPSOSUE",9,0)
 ; $$IMPOSS^BPSOSUE(UETYPE,UEOPT,UEMSG,UELOC,UEROU)
"RTN","BPSOSUE",10,0)
 ; UETYPE = kinds of problems which may have occured
"RTN","BPSOSUE",11,0)
 ;     ["FM" a Fileman call has returned an error
"RTN","BPSOSUE",12,0)
 ;     ["L"  a LOCK with ample time has failed
"RTN","BPSOSUE",13,0)
 ;     ["DB" a database error (some missing/incorrect field)
"RTN","BPSOSUE",14,0)
 ;     ["P"  a programming error / some unexpected condition
"RTN","BPSOSUE",15,0)
 ;     ["DEV" some kind of device or file error
"RTN","BPSOSUE",16,0)
 ; UEOPT = options available; first one listed is the default
"RTN","BPSOSUE",17,0)
 ;     Defaults to "TRI"
"RTN","BPSOSUE",18,0)
 ;     ["R" retry - retry the operation; log err
"RTN","BPSOSUE",19,0)
 ;     ["I" ignore - continue as though operation had succeeded; log err
"RTN","BPSOSUE",20,0)
 ;     ["T" abort - log err and terminate
"RTN","BPSOSUE",21,0)
 ; UEMSG = optionally, an additional message to output
"RTN","BPSOSUE",22,0)
 ;    can be .MSG, and we'll walk the array for you.
"RTN","BPSOSUE",23,0)
 ; UEMSG2 = even more message, like UEMSG.  In a Fileman call failure,
"RTN","BPSOSUE",24,0)
 ;    you'd probably send   .FDA,.MSG
"RTN","BPSOSUE",25,0)
 ; UELOC = location, any number or name unique to the calling routine
"RTN","BPSOSUE",26,0)
 ; UEROU = the name of the calling routine
"RTN","BPSOSUE",27,0)
 ; UENOLOG = true if you do not want error log entry to be made
"RTN","BPSOSUE",28,0)
 ;
"RTN","BPSOSUE",29,0)
 ; $$ returns 1 to retry, 0 to ignore
"RTN","BPSOSUE",30,0)
 ;
"RTN","BPSOSUE",31,0)
 ; Caller may do with these values what he desires.
"RTN","BPSOSUE",32,0)
 ;
"RTN","BPSOSUE",33,0)
 ; To prevent excessive errors, we won't actually log an error if
"RTN","BPSOSUE",34,0)
 ; another one has been logged recently.
"RTN","BPSOSUE",35,0)
 ;
"RTN","BPSOSUE",36,0)
 ; This routine really isn't as important as it looks.   In fact,
"RTN","BPSOSUE",37,0)
 ; it will almost never be encountered in practice.  Its existence
"RTN","BPSOSUE",38,0)
 ; owes mostly to an outrageous ruling made in the name of,
"RTN","BPSOSUE",39,0)
 ; but contrary to, the very quality and maintainability that forced
"RTN","BPSOSUE",40,0)
 ; errors give you.  This in turn led to a significant delay
"RTN","BPSOSUE",41,0)
 ; in the release of a product which has been proven to be dependable
"RTN","BPSOSUE",42,0)
 ; in practice.
"RTN","BPSOSUE",43,0)
 ;
"RTN","BPSOSUE",44,0)
 ; Formerly, a zero/zero forced error was found at various places
"RTN","BPSOSUE",45,0)
 ; in the code.  In 13 months at ANMC, 11 months at Sitka,
"RTN","BPSOSUE",46,0)
 ; and several months at Pawhuska, Wewoka, Santa Fe, and Taos, the
"RTN","BPSOSUE",47,0)
 ; zero div by zero traps were never encountered, but over $3,000,000
"RTN","BPSOSUE",48,0)
 ; in revenues were collected.  The ironic thing is,
"RTN","BPSOSUE",49,0)
 ; without those extra checking, of things like Fileman return values,
"RTN","BPSOSUE",50,0)
 ; sanity checks on input values, etc., the product would have been
"RTN","BPSOSUE",51,0)
 ; less reliable, yet it would have sailed through the verifiction
"RTN","BPSOSUE",52,0)
 ; phase of the project plan.
"RTN","BPSOSUE",53,0)
 ;
"RTN","BPSOSUE",54,0)
 ; Forced errors already pervade all of the M language.  <UNDEF> is
"RTN","BPSOSUE",55,0)
 ; a forced error, for example.  And forced errors are an integral part
"RTN","BPSOSUE",56,0)
 ; of the design of the very hardware that runs these programs.
"RTN","BPSOSUE",57,0)
 ; Follow the anti-forced error policy to its logical end and you
"RTN","BPSOSUE",58,0)
 ; go to Intersleaze and say "stop issuing <UNDEF> and instead,
"RTN","BPSOSUE",59,0)
 ; prompt the user for the opportunity to continue" and then you go
"RTN","BPSOSUE",60,0)
 ; to Intel and say "remove the addressing exception trap from your
"RTN","BPSOSUE",61,0)
 ; microcode; our support organization wouldn't be able to cope with
"RTN","BPSOSUE",62,0)
 ; the problem report on something like that."
"RTN","BPSOSUE",63,0)
 ;
"RTN","BPSOSUE",64,0)
 I $G(UEOPT)="" S UEOPT="TRI"
"RTN","BPSOSUE",65,0)
 I $G(ZTQUEUED) S UECHOICE=$E(UEOPT) G QD
"RTN","BPSOSUE",66,0)
 D:'$D(IOF) HOME^%ZIS ; make sure screen vars there
"RTN","BPSOSUE",67,0)
 U IO
"RTN","BPSOSUE",68,0)
 I '$D(IORVON) N IORVON,IORVOFF D
"RTN","BPSOSUE",69,0)
 . N X S X="IORVON;IORVOFF" D ENDR^%ZISS
"RTN","BPSOSUE",70,0)
 W !!,IORVON
"RTN","BPSOSUE",71,0)
 W "An unexpected problem has been detected; notify programmer!"
"RTN","BPSOSUE",72,0)
 I $D(UELOC)!$D(UEROU) D
"RTN","BPSOSUE",73,0)
 . W !?5,"The problem occurred "
"RTN","BPSOSUE",74,0)
 . I $D(UELOC) W "at location ",UELOC," " W:$X>60 !
"RTN","BPSOSUE",75,0)
 . I $D(UEROU) W "in routine ",UEROU
"RTN","BPSOSUE",76,0)
 . W ".",!
"RTN","BPSOSUE",77,0)
 W !?5,"The likely source" W:UETYPE["," "s"
"RTN","BPSOSUE",78,0)
 W " of such a problem " W $S(UETYPE[",":"are",1:"is"),":",!!?5
"RTN","BPSOSUE",79,0)
 I UETYPE["FM" D
"RTN","BPSOSUE",80,0)
 . W "Fileman has reported an error to the program.",!?5
"RTN","BPSOSUE",81,0)
 I UETYPE["L" D
"RTN","BPSOSUE",82,0)
 . W "An interlock could not be obtained.",!?5
"RTN","BPSOSUE",83,0)
 I UETYPE["DB" D
"RTN","BPSOSUE",84,0)
 . W "An inconsistency in the database was detected.",!?5
"RTN","BPSOSUE",85,0)
 I UETYPE["DEV" D
"RTN","BPSOSUE",86,0)
 . W "An error condition trying to open a device or a file.",!?5
"RTN","BPSOSUE",87,0)
 I UETYPE["P" D
"RTN","BPSOSUE",88,0)
 . W "A condition the program was unprepared to handle",!?5
"RTN","BPSOSUE",89,0)
 . W "or perhaps an error in the program logic.",!?5
"RTN","BPSOSUE",90,0)
 W !,"A programmer should be notified of this unfortunate event.",!
"RTN","BPSOSUE",91,0)
 D MSG(.UEMSG),MSG(.UEMSG2)
"RTN","BPSOSUE",92,0)
 W IORVOFF,!!
"RTN","BPSOSUE",93,0)
 ;
"RTN","BPSOSUE",94,0)
 N UECHOICE S UECHOICE=$$CHOICE ; Present the options; get I, R, T
"RTN","BPSOSUE",95,0)
QD ;
"RTN","BPSOSUE",96,0)
 D LOGERR ; always log an error (unless too soon after prev. error)
"RTN","BPSOSUE",97,0)
 I UECHOICE="T" G HALT
"RTN","BPSOSUE",98,0)
 ;LJE;H $R(10)+1 ; could help various things (locks, database conditions)
"RTN","BPSOSUE",99,0)
 H 2
"RTN","BPSOSUE",100,0)
 Q:$Q $S(UECHOICE="I":0,UECHOICE="R":1) Q
"RTN","BPSOSUE",101,0)
 ;
"RTN","BPSOSUE",102,0)
MSG(X) ; display message, directly or in array
"RTN","BPSOSUE",103,0)
 I '$D(X) W "X is undefined",! Q
"RTN","BPSOSUE",104,0)
 I $D(X)#10 W X,!
"RTN","BPSOSUE",105,0)
 I $D(X)>9 D
"RTN","BPSOSUE",106,0)
 . N R S R="X" F  S R=$Q(@R) Q:R=""  W @R,!
"RTN","BPSOSUE",107,0)
 W !
"RTN","BPSOSUE",108,0)
 Q
"RTN","BPSOSUE",109,0)
 ;
"RTN","BPSOSUE",110,0)
CHOICE() ; given UEOPT[letters, UETYPE too
"RTN","BPSOSUE",111,0)
 I UEOPT="" S UEOPT="T"
"RTN","BPSOSUE",112,0)
 N DIR,X,Y
"RTN","BPSOSUE",113,0)
 I $L(UEOPT)=1 S X=UEOPT G CH5
"RTN","BPSOSUE",114,0)
 S DIR(0)="SM^",X=""
"RTN","BPSOSUE",115,0)
 I UEOPT["I" S X=X_"I:Ignore the problem and try to continue"
"RTN","BPSOSUE",116,0)
 I UEOPT["R" S:X]"" X=X_";" S X=X_"R:Retry the operation"
"RTN","BPSOSUE",117,0)
 I UEOPT["T" S:X]"" X=X_";" S X=X_"T:Terminate the program"
"RTN","BPSOSUE",118,0)
 I UETYPE'="L" S X=X_" (WE RECOMMEND ""T"")"
"RTN","BPSOSUE",119,0)
 S DIR(0)=DIR(0)_X
"RTN","BPSOSUE",120,0)
 S DIR("B")=$E(UEOPT) D ^DIR
"RTN","BPSOSUE",121,0)
CH5 Q $S(X?1U:X,1:"T")
"RTN","BPSOSUE",122,0)
 ;
"RTN","BPSOSUE",123,0)
LOGERR ; log an error
"RTN","BPSOSUE",124,0)
 ; ^TMP($J,$T(+0),$J)=DUZ^$H last time we did this
"RTN","BPSOSUE",125,0)
 N X S X=$G(^TMP($J,$T(+0),$J))
"RTN","BPSOSUE",126,0)
 I $P(X,U)'=DUZ G LOG2
"RTN","BPSOSUE",127,0)
 S X=$P(X,U,2) I +$H'=+X G LOG2
"RTN","BPSOSUE",128,0)
 S X=$P(X,",",2) I $P($H,",",2)-X>300 G LOG2
"RTN","BPSOSUE",129,0)
 I '$G(ZTQUEUED) D
"RTN","BPSOSUE",130,0)
 . W !,"No additional error log entry will be made at this time.",!
"RTN","BPSOSUE",131,0)
 Q
"RTN","BPSOSUE",132,0)
LOG2 ;
"RTN","BPSOSUE",133,0)
 Q:$G(UENOLOG)  ; requested: no error log entry
"RTN","BPSOSUE",134,0)
 I '$G(ZTQUEUED) D
"RTN","BPSOSUE",135,0)
 . W !,"Now recording some error log information to help the programmer...",!
"RTN","BPSOSUE",136,0)
 D @^%ZOSF("ERRTN") ; trap an error
"RTN","BPSOSUE",137,0)
 S ^TMP($J,$T(+0),$J)=DUZ_U_$H
"RTN","BPSOSUE",138,0)
 I '$D(ZTQUEUED) D
"RTN","BPSOSUE",139,0)
 . W ?10,"..." H 2 W "done.",!
"RTN","BPSOSUE",140,0)
 Q
"RTN","BPSOSUE",141,0)
HALT ; halt
"RTN","BPSOSUE",142,0)
 D H^XUS
"RTN","BPSOSUE",143,0)
 ; at this point, the user is logged off
"RTN","BPSOSUE",144,0)
 ; programmer shouldn't reach here, either, if HALT^ZU disinstackifies
"RTN","BPSOSUE",145,0)
 Q ""  ; <DPARM> error gets you back into programmer mode
"RTN","BPSOSUE",146,0)
TEST ;
"RTN","BPSOSUE",147,0)
 N MYEXMSG,I F I=1:1:4 S MYEXMSG(I)="my extra msg line "_I
"RTN","BPSOSUE",148,0)
 N X S X=$$IMPOSS^BPSOSUE("P","TIR","Additional Message",.MYEXMSG,"point 1","MYROU")
"RTN","BPSOSUE",149,0)
 W !,"returned value = ",X,!
"RTN","BPSOSUE",150,0)
 Q
"RTN","BPSREOP1")
0^35^B59193506
"RTN","BPSREOP1",1,0)
BPSREOP1 ;BHAM ISC/SS - REOPEN CLOSED CLAIMS ;03/07/08  14:54
"RTN","BPSREOP1",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**3,7**;JUN 2004;Build 46
"RTN","BPSREOP1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSREOP1",4,0)
 ;Reopen closed claims
"RTN","BPSREOP1",5,0)
 ;
"RTN","BPSREOP1",6,0)
 ;create an ^TMP for the list manager
"RTN","BPSREOP1",7,0)
 ;
"RTN","BPSREOP1",8,0)
COLLECT(BPDFN,BPSTRT,BPEND) ;
"RTN","BPSREOP1",9,0)
 D CLEAN^VALM10
"RTN","BPSREOP1",10,0)
 N LINE
"RTN","BPSREOP1",11,0)
 N BPIEN02,BPIEN59
"RTN","BPSREOP1",12,0)
 S LINE=1
"RTN","BPSREOP1",13,0)
 S BPIEN59=0
"RTN","BPSREOP1",14,0)
 F  S BPIEN59=$O(^BPST("AC",BPDFN,BPIEN59)) Q:+BPIEN59=0  D
"RTN","BPSREOP1",15,0)
 . I $P($G(^BPST(BPIEN59,12)),U,2)<BPSTRT Q
"RTN","BPSREOP1",16,0)
 . I $P($G(^BPST(BPIEN59,12)),U,2)>BPEND Q
"RTN","BPSREOP1",17,0)
 . ; Don't display deleted prescriptions
"RTN","BPSREOP1",18,0)
 . I $$RXAPI1^BPSUTIL1($P(^BPST(BPIEN59,1),U,11),100,"I")=13 Q
"RTN","BPSREOP1",19,0)
 . S BPIEN02=+$P($G(^BPST(BPIEN59,0)),U,4)
"RTN","BPSREOP1",20,0)
 . ;if the is no BPS CLAIMS - error
"RTN","BPSREOP1",21,0)
 . Q:BPIEN02=0
"RTN","BPSREOP1",22,0)
 . ;if NOT closed
"RTN","BPSREOP1",23,0)
 . I +$P($G(^BPSC(BPIEN02,900)),U)=0 Q
"RTN","BPSREOP1",24,0)
 . D SET^VALM10(LINE,$$LJ^BPSSCR02(LINE,6)_$$CLAIMINF(BPIEN59),BPIEN59)
"RTN","BPSREOP1",25,0)
 . S LINE=LINE+1
"RTN","BPSREOP1",26,0)
 S VALMCNT=LINE-1 ;"of PAGE" fix - VALMCNT should be EXACT number of lines on the screen
"RTN","BPSREOP1",27,0)
 Q
"RTN","BPSREOP1",28,0)
 ;claim info for list manager screen
"RTN","BPSREOP1",29,0)
CLAIMINF(BP59) ;*/
"RTN","BPSREOP1",30,0)
 N BPX,BPX1
"RTN","BPSREOP1",31,0)
 S BPX1=$$RXREF^BPSSCRU2(BP59)
"RTN","BPSREOP1",32,0)
 S BPX=$$LJ^BPSSCR02($$DRGNAME^BPSSCRU2(BP59),17)_"  "_$$LJ^BPSSCR02($$NDC^BPSSCRU2(+BPX1,+$P(BPX1,U,2)),13)_" "
"RTN","BPSREOP1",33,0)
 S BPX=BPX_$$LJ^BPSSCR02($$FILLDATE^BPSSCRRS(+BPX1,+$P(BPX1,U,2)),5)_" "
"RTN","BPSREOP1",34,0)
 S BPX=BPX_$$LJ^BPSSCR02($$RXNUM^BPSSCRU2(+BPX1),11)_" "_+$P(BPX1,U,2)_"/"
"RTN","BPSREOP1",35,0)
 S BPX=BPX_$$LJ^BPSSCR02($$ECMENUM^BPSSCRU2(BP59),7)_" "_$$MWCNAME^BPSSCRU2($$GETMWC^BPSSCRU2(BP59))_"   "
"RTN","BPSREOP1",36,0)
 S BPX=BPX_$$RTBB^BPSSCRU2(BP59)_" "_$$RXST^BPSSCRU2(BP59)_"/"_$$RL^BPSSCRU2(BP59)
"RTN","BPSREOP1",37,0)
 Q BPX
"RTN","BPSREOP1",38,0)
 ;
"RTN","BPSREOP1",39,0)
 ;patient info for header
"RTN","BPSREOP1",40,0)
PATINF(BPDFN) ;*/
"RTN","BPSREOP1",41,0)
 N X
"RTN","BPSREOP1",42,0)
 S X=$E($$PATNAME(BPDFN),1,22)_" "_$$SSN4^BPSSCRU2(BPDFN)
"RTN","BPSREOP1",43,0)
 Q $$LJ^BPSSCR02(X,29) ;name
"RTN","BPSREOP1",44,0)
 ;
"RTN","BPSREOP1",45,0)
 ;------------ patient's name
"RTN","BPSREOP1",46,0)
PATNAME(BPDFN) ;
"RTN","BPSREOP1",47,0)
 Q $E($P($G(^DPT(BPDFN,0)),U),1,30)
"RTN","BPSREOP1",48,0)
 ;
"RTN","BPSREOP1",49,0)
 ;/**
"RTN","BPSREOP1",50,0)
 ;ECME User Screen Reopen Closed Claim Hidden Action (ROC)
"RTN","BPSREOP1",51,0)
 ;**/
"RTN","BPSREOP1",52,0)
EUSCREOP ;
"RTN","BPSREOP1",53,0)
 N BPREOP,BP59,BPDFN,BPDISP,BPCNT,BPI,BPJ,BPCOMM,BPRETV,BPIEN02,BPSRXNUM
"RTN","BPSREOP1",54,0)
 ; Check for BPS MANAGER security key
"RTN","BPSREOP1",55,0)
 I '$D(^XUSEC("BPS MANAGER",DUZ)) D  Q
"RTN","BPSREOP1",56,0)
 . W !,"You must hold the BPS MANAGER Security Key to access the",!,"Reopen Closed Claims option."
"RTN","BPSREOP1",57,0)
 . S VALMBCK="R"
"RTN","BPSREOP1",58,0)
 . D PAUSE^VALM1
"RTN","BPSREOP1",59,0)
 S (BP59,BPCNT,BPI,BPJ)=0
"RTN","BPSREOP1",60,0)
 I '$D(@(VALMAR)) G REOP
"RTN","BPSREOP1",61,0)
 D FULL^VALM1
"RTN","BPSREOP1",62,0)
 ; Select the claim(s) to reopen
"RTN","BPSREOP1",63,0)
 W !,"Enter the line number for the claim you want to reopen."
"RTN","BPSREOP1",64,0)
 I $$ASKLINES^BPSSCRU4("","C",.BPREOP,VALMAR) D
"RTN","BPSREOP1",65,0)
 . ; Build array to display to user
"RTN","BPSREOP1",66,0)
 . F  S BP59=$O(BPREOP(BP59)) Q:BP59=""  D
"RTN","BPSREOP1",67,0)
 . . S BPDFN=+$P($G(^BPST(BP59,0)),U,6)
"RTN","BPSREOP1",68,0)
 . . S BPCNT=BPCNT+1
"RTN","BPSREOP1",69,0)
 . . I '$D(BPDISP(BPDFN)) S BPDISP(BPDFN,BPCNT)=$$LJ^BPSSCR02($$PATNAME(BPDFN)_" :",50),BPCNT=BPCNT+1
"RTN","BPSREOP1",70,0)
 . . S BPDISP(BPDFN,BPCNT)=@VALMAR@($P(BPREOP(BP59),U,1),0)
"RTN","BPSREOP1",71,0)
 . . ; Make sure this claim is closed
"RTN","BPSREOP1",72,0)
 . . I '$$CLOSED02^BPSSCR03($P($G(^BPST(BP59,0)),U,4)) D
"RTN","BPSREOP1",73,0)
 . . . S BPCNT=BPCNT+1
"RTN","BPSREOP1",74,0)
 . . . S BPDISP(BPDFN,BPCNT)="Claim NOT closed and cannot be reopened."
"RTN","BPSREOP1",75,0)
 . . . K BPREOP(BP59)
"RTN","BPSREOP1",76,0)
 . . ; Make sure the Prescription isn't deleted
"RTN","BPSREOP1",77,0)
 . . I $$RXAPI1^BPSUTIL1($P(^BPST(BP59,1),U,11),100,"I")=13 D
"RTN","BPSREOP1",78,0)
 . . . S BPCNT=BPCNT+1
"RTN","BPSREOP1",79,0)
 . . . S BPDISP(BPDFN,BPCNT)="The prescription has been marked DELETED and cannot be reopened."
"RTN","BPSREOP1",80,0)
 . . . K BPREOP(BP59)
"RTN","BPSREOP1",81,0)
 . ; Display the selected claims from the display array
"RTN","BPSREOP1",82,0)
 . W !!,"You've chosen to reopen the following prescriptions(s) for"
"RTN","BPSREOP1",83,0)
 . F  S BPI=$O(BPDISP(BPI)) Q:BPI=""  D
"RTN","BPSREOP1",84,0)
 . . F  S BPJ=$O(BPDISP(BPI,BPJ)) Q:BPJ=""  D
"RTN","BPSREOP1",85,0)
 . . . W !,BPDISP(BPI,BPJ)
"RTN","BPSREOP1",86,0)
 . . Q
"RTN","BPSREOP1",87,0)
 . Q
"RTN","BPSREOP1",88,0)
 ; If there are any closed claims selected, verify if the users still wants to reopen
"RTN","BPSREOP1",89,0)
 I $D(BPREOP) D
"RTN","BPSREOP1",90,0)
 . W !!,"All Selected Rxs will be reopened using the same information gathered in the",!,"following prompts.",!!
"RTN","BPSREOP1",91,0)
 . I $$YESNO^BPSSCRRS("Are you sure?(Y/N)") D
"RTN","BPSREOP1",92,0)
 . . ; Get the Reopen Comments to be stored in the BPS CLAIMS file
"RTN","BPSREOP1",93,0)
 . . S BPCOMM=$$PROMPT("REOPEN COMMENTS","","F",1,40)
"RTN","BPSREOP1",94,0)
 . . Q:BPCOMM["^"
"RTN","BPSREOP1",95,0)
 . . ; Do we REALLY want to reopen the claims?
"RTN","BPSREOP1",96,0)
 . . I $$YESNO^BPSSCRRS("ARE YOU SURE YOU WANT TO RE-OPEN THIS CLAIM? (Y/N)","No") D
"RTN","BPSREOP1",97,0)
 . . . S (BPCNT,BP59)=0
"RTN","BPSREOP1",98,0)
 . . . ; Loop through all selected claims and reopen them one at a time
"RTN","BPSREOP1",99,0)
 . . . ; using the same comments
"RTN","BPSREOP1",100,0)
 . . . F  S BP59=$O(BPREOP(BP59)) Q:BP59=""  D
"RTN","BPSREOP1",101,0)
 . . . . S BPIEN02=+$P($G(^BPST(BP59,0)),U,4)
"RTN","BPSREOP1",102,0)
 . . . . S BPRETV=$$REOPEN^BPSBUTL(BP59,BPIEN02,$$NOW^XLFDT,+DUZ,BPCOMM)
"RTN","BPSREOP1",103,0)
 . . . . W !,$P(BPRETV,U,2)
"RTN","BPSREOP1",104,0)
 . . . . I +BPRETV S BPCNT=BPCNT+1
"RTN","BPSREOP1",105,0)
 . . . . Q
"RTN","BPSREOP1",106,0)
 . . . I BPCNT>1 W !!,BPCNT_" claims have been reopened.",! Q
"RTN","BPSREOP1",107,0)
 . . . I BPCNT=1 W !!,"1 claim has been reopened.",! Q
"RTN","BPSREOP1",108,0)
 . . . I BPCNT=0 W !!,"Unable to reopen claim" Q
"RTN","BPSREOP1",109,0)
 I '$D(BPREOP) S VALMBCK="R" D PAUSE^VALM1 Q
"RTN","BPSREOP1",110,0)
 D PAUSE^VALM1
"RTN","BPSREOP1",111,0)
 D REDRAW^BPSSCRUD("Updating screen for reopened claims...")
"RTN","BPSREOP1",112,0)
 Q
"RTN","BPSREOP1",113,0)
 ;
"RTN","BPSREOP1",114,0)
SELECT ;
"RTN","BPSREOP1",115,0)
 I VALMCNT<1 D  Q
"RTN","BPSREOP1",116,0)
 . W !,"No claims to select." D PAUSE^VALM1 S VALMBCK="R"
"RTN","BPSREOP1",117,0)
 N BP59,BPQ
"RTN","BPSREOP1",118,0)
 D FULL^VALM1
"RTN","BPSREOP1",119,0)
 S BP59=0
"RTN","BPSREOP1",120,0)
 S BPQ=0
"RTN","BPSREOP1",121,0)
 F  S BPLINE=$$PROMPT("Select item","","A") D  Q:BPQ
"RTN","BPSREOP1",122,0)
 . I BPLINE="^" S BPQ=1 Q
"RTN","BPSREOP1",123,0)
 . I '(BPLINE?1N.N) W !,"Please select a SINGLE Rx Line Item." Q
"RTN","BPSREOP1",124,0)
 . S BP59=+$$GET59(+BPLINE) I BP59>0 S BPQ=1 Q
"RTN","BPSREOP1",125,0)
 . W !,"Please select a VALID Rx Line Item."
"RTN","BPSREOP1",126,0)
 I BPLINE="^" S VALMBCK="R" Q
"RTN","BPSREOP1",127,0)
 I BP59=0 S VALMBCK="R" W !,"Invalid selection." D PAUSE^VALM1 Q
"RTN","BPSREOP1",128,0)
 I $$SELCLAIM(BP59)<1 S VALMBCK="R" Q
"RTN","BPSREOP1",129,0)
 ;D RE^VALM4
"RTN","BPSREOP1",130,0)
 D REDRAW
"RTN","BPSREOP1",131,0)
 S VALMBCK="R"
"RTN","BPSREOP1",132,0)
 Q
"RTN","BPSREOP1",133,0)
 ;
"RTN","BPSREOP1",134,0)
GET59(BPLINE) ;
"RTN","BPSREOP1",135,0)
 Q +$O(^TMP("BPSREOP",$J,"VALM","IDX",BPLINE,0))
"RTN","BPSREOP1",136,0)
 ;
"RTN","BPSREOP1",137,0)
 ;display selected claim information
"RTN","BPSREOP1",138,0)
SELCLAIM(BP59) ;
"RTN","BPSREOP1",139,0)
 D FULL^VALM1
"RTN","BPSREOP1",140,0)
 W @IOF
"RTN","BPSREOP1",141,0)
 N BPX,BPX1,BPDFN,BPIEN02,BPCLDATA,BPCOMM,BPRETV,BPQ
"RTN","BPSREOP1",142,0)
 S BPDFN=+$P($G(^BPST(BP59,0)),U,6)
"RTN","BPSREOP1",143,0)
 S BPX1=$$RXREF^BPSSCRU2(BP59)
"RTN","BPSREOP1",144,0)
 W !,?1,$$LJ^BPSSCR02("PATIENT NAME: "_$$PATNAME(BPDFN),30)
"RTN","BPSREOP1",145,0)
 W ?33,$$LJ^BPSSCR02("RX#: "_$$RXNUM^BPSSCRU2(+BPX1)_" "_$P(BPX1,U,2),22)
"RTN","BPSREOP1",146,0)
 W ?57,$$LJ^BPSSCR02("DRUG: "_$$DRGNAME^BPSSCRU2(BP59),22)
"RTN","BPSREOP1",147,0)
 ;ien in BPS CLAIMS
"RTN","BPSREOP1",148,0)
 S BPIEN02=+$P($G(^BPST(BP59,0)),U,4)
"RTN","BPSREOP1",149,0)
 I BPIEN02=0 W !,"BPS CLAIMS file error!" D PAUSE^VALM1 Q -1
"RTN","BPSREOP1",150,0)
 ;Close info
"RTN","BPSREOP1",151,0)
 S BPCLDATA=$G(^BPSC(BPIEN02,900))
"RTN","BPSREOP1",152,0)
 ;if the is no BPS CLAIMS - error
"RTN","BPSREOP1",153,0)
 W !,?3,"CLOSED  ",$$FORMDATE^BPSSCRU6(+$P($G(^BPSC(BPIEN02,900)),U,2),2)
"RTN","BPSREOP1",154,0)
 W !,?4,"ECME#: "_+BPX1_", FILL DATE: "_$$FORMDATE^BPSSCRU6($$DOSDATE^BPSSCRRS(+BPX1,+$P(BPX1,U,2)),2)
"RTN","BPSREOP1",155,0)
 W ", RELEASE DATE: "_$$FORMDATE^BPSSCRU6($$RELDATE^BPSSCRU6(+BPX1,+$P(BPX1,U,2)),2)
"RTN","BPSREOP1",156,0)
 W !,?4,"PLAN: ",$$PLANNAME^BPSSCRU6(BP59)," INSURANCE: ",$$INSNAME^BPSSCRU6(BP59)
"RTN","BPSREOP1",157,0)
 W !,?4,"CLOSE REASON: ",$$CLREASON^BPSSCRU6(+$P(BPCLDATA,U,4))
"RTN","BPSREOP1",158,0)
 W !,?4,"DROP TO PAPER: ",$S(+$P(BPCLDATA,U,5)=1:"YES",1:"NO")
"RTN","BPSREOP1",159,0)
 W !,?4,"CLOSE USER: ",$P($G(^VA(200,+$P(BPCLDATA,U,3),0)),U)
"RTN","BPSREOP1",160,0)
 W !!,"You have selected the CLOSED electronic claim listed above.",!
"RTN","BPSREOP1",161,0)
 S BPCOMM=$$PROMPT("REOPEN COMMENTS","","F",1,40)
"RTN","BPSREOP1",162,0)
 Q:BPCOMM["^" 0
"RTN","BPSREOP1",163,0)
 S BPQ=$$YESNO^BPSSCRRS("ARE YOU SURE YOU WANT TO RE-OPEN THIS CLAIM? (Y/N)","No")
"RTN","BPSREOP1",164,0)
 Q:BPQ<1 0
"RTN","BPSREOP1",165,0)
 S BPRETV=$$REOPEN^BPSBUTL(BP59,BPIEN02,$$NOW^XLFDT,+DUZ,BPCOMM)
"RTN","BPSREOP1",166,0)
 W !,$P(BPRETV,U,2),!
"RTN","BPSREOP1",167,0)
 W !,"1 claim has been reopened.",!
"RTN","BPSREOP1",168,0)
 D PAUSE^VALM1
"RTN","BPSREOP1",169,0)
 Q 1
"RTN","BPSREOP1",170,0)
 ;
"RTN","BPSREOP1",171,0)
REDRAW ;
"RTN","BPSREOP1",172,0)
 N BPARR
"RTN","BPSREOP1",173,0)
 D CLEAN^VALM10
"RTN","BPSREOP1",174,0)
 D COLLECT^BPSREOP1(BPDFN,BPSTRT,BPEND)
"RTN","BPSREOP1",175,0)
 S VALMBCK="R"
"RTN","BPSREOP1",176,0)
 Q
"RTN","BPSREOP1",177,0)
 ;input:
"RTN","BPSREOP1",178,0)
 ;BPSPROM - prompt text
"RTN","BPSREOP1",179,0)
 ;BPSDFVL - default value (optional)
"RTN","BPSREOP1",180,0)
 ;BPMODE - N- to enter numbers, F - free text, A - free text w/o limitations
"RTN","BPSREOP1",181,0)
 ;returns:
"RTN","BPSREOP1",182,0)
 ; "response"
"RTN","BPSREOP1",183,0)
 ; or "^" for quit
"RTN","BPSREOP1",184,0)
PROMPT(BPSPROM,BPSDFVL,BPMODE,MINLEN,MAXLEN) ;
"RTN","BPSREOP1",185,0)
 N IR,X,Y,DIRUT,DIR
"RTN","BPSREOP1",186,0)
 I BPMODE="N" S DIR(0)="N^::2"
"RTN","BPSREOP1",187,0)
 I BPMODE="A" S DIR(0)="F^::2"
"RTN","BPSREOP1",188,0)
 I BPMODE="F" S DIR(0)="F^"_MINLEN_":"_MAXLEN_":2^K:(X?1"" ""."" "") X"
"RTN","BPSREOP1",189,0)
 S DIR("A")=BPSPROM
"RTN","BPSREOP1",190,0)
 I $L($G(BPSDFVL))>0 S DIR("B")=$G(BPSDFVL)
"RTN","BPSREOP1",191,0)
 D ^DIR I $D(DIRUT) Q "^"
"RTN","BPSREOP1",192,0)
 I Y["^" Q "^"
"RTN","BPSREOP1",193,0)
 Q Y
"RTN","BPSREOP1",194,0)
 ;
"RTN","BPSREOP1",195,0)
 ;Update reopen record in BPS CLAIM
"RTN","BPSREOP1",196,0)
 ;Input:
"RTN","BPSREOP1",197,0)
 ; BP02 - ien in BPS CLAIMS file
"RTN","BPSREOP1",198,0)
 ; BPCLOSED - value for CLOSED field
"RTN","BPSREOP1",199,0)
 ; BPREOPDT - reopen date/time
"RTN","BPSREOP1",200,0)
 ; BPDUZ - user DUZ (#200 ien)
"RTN","BPSREOP1",201,0)
 ; BPCOMM - reopen comment text
"RTN","BPSREOP1",202,0)
 ;Output:
"RTN","BPSREOP1",203,0)
 ; 0^message_error - error
"RTN","BPSREOP1",204,0)
 ; 1 - success
"RTN","BPSREOP1",205,0)
UPDREOP(BP02,BPCLOSED,BPREOPDT,BPDUZ,BPCOMM) ;
"RTN","BPSREOP1",206,0)
 ;Now update ECME database
"RTN","BPSREOP1",207,0)
 N RECIENS,BPDA,BPLCK,ERRARR
"RTN","BPSREOP1",208,0)
 S RECIENS=BP02_","
"RTN","BPSREOP1",209,0)
 S BPDA(9002313.02,RECIENS,901)=BPCLOSED ;CLOSED = "NO"
"RTN","BPSREOP1",210,0)
 S BPDA(9002313.02,RECIENS,906)=BPREOPDT ;reopen date/time
"RTN","BPSREOP1",211,0)
 S BPDA(9002313.02,RECIENS,907)=+BPDUZ ;user
"RTN","BPSREOP1",212,0)
 S BPDA(9002313.02,RECIENS,908)=BPCOMM ;comment
"RTN","BPSREOP1",213,0)
 L +^BPST(9002313.02,+BP02):10
"RTN","BPSREOP1",214,0)
 S BPLCK=$T
"RTN","BPSREOP1",215,0)
 I 'BPLCK Q "0^Locked record"  ;quit
"RTN","BPSREOP1",216,0)
 D FILE^DIE("","BPDA","ERRARR")
"RTN","BPSREOP1",217,0)
 I BPLCK L -^BPST(9002313.02,+BP02)
"RTN","BPSREOP1",218,0)
 I $D(ERRARR) Q "0^"_ERRARR("DIERR",1,"TEXT",1)
"RTN","BPSREOP1",219,0)
 Q 1
"RTN","BPSREOP1",220,0)
 ;
"RTN","BPSREOP1",221,0)
 ; Reopen Closed Claim displayed in ECME User Screen
"RTN","BPSREOP1",222,0)
REOP ;
"RTN","BPSREOP1",223,0)
 Q
"RTN","BPSRES")
0^58^B66886236
"RTN","BPSRES",1,0)
BPSRES ;BHAM ISC/BEE - ECME SCREEN RESUBMIT W/EDITS ;3/12/08  14:01
"RTN","BPSRES",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**3,5,7**;JUN 2004;Build 46
"RTN","BPSRES",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSRES",4,0)
 ;
"RTN","BPSRES",5,0)
 ;ECME Resubmit w/EDITS Protocol (Hidden) - Called by [BPS USER SCREEN]
"RTN","BPSRES",6,0)
 ;
"RTN","BPSRES",7,0)
RESED N BPSEL
"RTN","BPSRES",8,0)
 ;
"RTN","BPSRES",9,0)
 I '$D(@(VALMAR)) G XRESED
"RTN","BPSRES",10,0)
 D FULL^VALM1
"RTN","BPSRES",11,0)
 ;
"RTN","BPSRES",12,0)
 ;Select the claim to resubmit
"RTN","BPSRES",13,0)
 W !,"Enter the line number for the claim to be resubmitted."
"RTN","BPSRES",14,0)
 S BPSEL=$$ASKLINE("Select item","Please select a SINGLE claim only when using the Resubmit w/EDITS action option.")
"RTN","BPSRES",15,0)
 I BPSEL<1 S VALMBCK="R" G XRESED
"RTN","BPSRES",16,0)
 ;
"RTN","BPSRES",17,0)
 ;Attempt to resubmit the claim, update the content of the screen, and display
"RTN","BPSRES",18,0)
 ;only if claim submitted successfully
"RTN","BPSRES",19,0)
 I $$DOSELCTD(BPSEL) D REDRAW^BPSSCRUD("Updating screen for resubmitted claim...")
"RTN","BPSRES",20,0)
 E  S VALMBCK="R"
"RTN","BPSRES",21,0)
 ;
"RTN","BPSRES",22,0)
XRESED Q
"RTN","BPSRES",23,0)
 ;
"RTN","BPSRES",24,0)
 ;Attempt to Edit and Resubmit Selected Claim
"RTN","BPSRES",25,0)
 ;
"RTN","BPSRES",26,0)
 ;   Input Value -> BPRXI - Entry with ptr to BPS TRANSACTION file
"RTN","BPSRES",27,0)
 ;
"RTN","BPSRES",28,0)
 ;  Return Value -> 0 - Claim was not resubmitted
"RTN","BPSRES",29,0)
 ;                  1 - Claim was resubmitted
"RTN","BPSRES",30,0)
 ;
"RTN","BPSRES",31,0)
DOSELCTD(BPRXI) N BP02,BP59,BPBILL,BPCLTOT,BPDFN,BPDOSDT,BPOVRIEN,BPQ,BPRXIEN,BPRXR,BPSTATUS,BPUPDFLG
"RTN","BPSRES",32,0)
 S (BPQ)=""
"RTN","BPSRES",33,0)
 S (BPCLTOT,BPUPDFLG)=0
"RTN","BPSRES",34,0)
 ;
"RTN","BPSRES",35,0)
 ;Pull BPS TRANSACTION/BPS CLAIMS entries
"RTN","BPSRES",36,0)
 S BP59=$P(BPRXI,U,4) I BP59="" W !!,"No Initial Claim Submission Found - Data Elements are NOT Editable for Re-Submission",! G XRES
"RTN","BPSRES",37,0)
 S BP02=+$P($G(^BPST(BP59,0)),U,4) I 'BP02 W !!,"No Initial Claim Submission Found - Data Elements are NOT Editable for Re-Submission",! G XRES
"RTN","BPSRES",38,0)
 ;
"RTN","BPSRES",39,0)
 ;Write Form Feed
"RTN","BPSRES",40,0)
 W @IOF
"RTN","BPSRES",41,0)
 ;
"RTN","BPSRES",42,0)
 ;Display selected claim and ask to submit
"RTN","BPSRES",43,0)
 S BPDFN=+$P($G(^BPST(BP59,0)),U,6)
"RTN","BPSRES",44,0)
 W !,"You've chosen to RESUBMIT the following prescription for "_$E($$PATNAME^BPSSCRU2(BPDFN),1,13)
"RTN","BPSRES",45,0)
 W !,@VALMAR@(+$P(BPRXI,U,5),0)
"RTN","BPSRES",46,0)
 S BPQ=$$YESNO^BPSSCRRS("Are you sure?(Y/N)")
"RTN","BPSRES",47,0)
 I BPQ'=1 S BPQ="^" G XRES
"RTN","BPSRES",48,0)
 ;
"RTN","BPSRES",49,0)
 ;Check to make sure claim can be Resubmitted w/EDITS
"RTN","BPSRES",50,0)
 S BPRXIEN=$P(BP59,".")
"RTN","BPSRES",51,0)
 S BPRXR=+$E($P(BP59,".",2),1,4)
"RTN","BPSRES",52,0)
 I $$RXDEL^BPSOS($P(BP59,".",1),+$E($P(BP59,".",2),1,4)) W !!,"The claim: ",!,@VALMAR@(+$P(BPRXI,U,5),0),!,"cannot be Resubmitted w/EDITS because it has been deleted in Pharmacy.",! G XRES
"RTN","BPSRES",53,0)
 S BPSTATUS=$P($$CLAIMST^BPSSCRU3(BP59),U)
"RTN","BPSRES",54,0)
 I BPSTATUS["IN PROGRESS" W !!,"The claim: ",!,@VALMAR@(+$P(BPRXI,U,5),0),!,"is still In Progress and cannot be Resubmitted w/EDITS",! G XRES
"RTN","BPSRES",55,0)
 I BPSTATUS'["E REJECTED" W !!,"The claim: ",!,@VALMAR@(+$P(BPRXI,U,5),0),!,"is NOT Rejected and cannot be Resubmitted w/EDITS",! G XRES
"RTN","BPSRES",56,0)
 ;can't resubmit a closed claim. The user must reopen first.
"RTN","BPSRES",57,0)
 I $$CLOSED02^BPSSCR03($P($G(^BPST(BP59,0)),U,4)) W !!,"The claim: ",!,@VALMAR@(+$P(BPRXI,U,5),0),!,"is Closed and cannot be Resubmitted w/EDITS.",! G XRES
"RTN","BPSRES",58,0)
 ;
"RTN","BPSRES",59,0)
 ;Prompt for EDIT Information
"RTN","BPSRES",60,0)
 S BPOVRIEN=$$PROMPTS(BP59,BP02) I BPOVRIEN=-1 G XRES
"RTN","BPSRES",61,0)
 ;
"RTN","BPSRES",62,0)
 ;Retrieve DOS
"RTN","BPSRES",63,0)
 S BPDOSDT=$$DOSDATE^BPSSCRRS(BPRXIEN,BPRXR)
"RTN","BPSRES",64,0)
 ;
"RTN","BPSRES",65,0)
 ;Resubmit Claim
"RTN","BPSRES",66,0)
 S BPBILL=$$EN^BPSNCPDP(BPRXIEN,BPRXR,BPDOSDT,"ERES","","ECME RESUBMIT","",BPOVRIEN)
"RTN","BPSRES",67,0)
 ;
"RTN","BPSRES",68,0)
 ;Print Return Value Message
"RTN","BPSRES",69,0)
 W !!
"RTN","BPSRES",70,0)
 W:+BPBILL>0 $S(+BPBILL=10:"Reversal but no Resubmit:",1:"Not Processed:"),!,"  "
"RTN","BPSRES",71,0)
 ;
"RTN","BPSRES",72,0)
 ;Change Return Message for SC/EI
"RTN","BPSRES",73,0)
 S:$P(BPBILL,U,2)="NEEDS SC DETERMINATION" $P(BPBILL,U,2)="NEEDS SC/EI DETERMINATION"
"RTN","BPSRES",74,0)
 W $P(BPBILL,U,2)
"RTN","BPSRES",75,0)
 ;
"RTN","BPSRES",76,0)
 ;0 Prescription/Fill successfully submitted to ECME
"RTN","BPSRES",77,0)
 ;1 ECME did not submit prescription/fill
"RTN","BPSRES",78,0)
 ;2 IB says prescription/fill is not ECME billable or the data returned from IB is not valid
"RTN","BPSRES",79,0)
 ;3 ECME closed the claim but did not submit it to the payer
"RTN","BPSRES",80,0)
 ;4 Unable to queue the ECME claim
"RTN","BPSRES",81,0)
 ;5 Invalid input
"RTN","BPSRES",82,0)
 ;10 Reversal Processed But Claim Was Not Resubmitted
"RTN","BPSRES",83,0)
 ;
"RTN","BPSRES",84,0)
 I +BPBILL=0 D
"RTN","BPSRES",85,0)
 . D ECMEACT^PSOBPSU1(+BPRXIEN,+BPRXR,"Claim resubmitted to 3rd party payer: ECME USER's SCREEN")
"RTN","BPSRES",86,0)
 . S BPUPDFLG=1,BPCLTOT=1
"RTN","BPSRES",87,0)
XRES I BPCLTOT W !,BPCLTOT," claim",$S(BPCLTOT'=1:"s have",1:" has")," been resubmitted.",!
"RTN","BPSRES",88,0)
 D PAUSE^VALM1
"RTN","BPSRES",89,0)
 Q BPUPDFLG
"RTN","BPSRES",90,0)
 ;
"RTN","BPSRES",91,0)
 ;Enter EDIT information for claim
"RTN","BPSRES",92,0)
 ;
"RTN","BPSRES",93,0)
 ;  Input Values -> BP59 - The BPS TRANSACTION entry
"RTN","BPSRES",94,0)
 ;                  BP02 - The BPS CLAIMS entry
"RTN","BPSRES",95,0)
 ;  Output Value -> BPQ  - -1 - The user chose to quit
"RTN","BPSRES",96,0)
 ;                         "" - The user completed the EDITS
"RTN","BPSRES",97,0)
PROMPTS(BP59,BP02) ;
"RTN","BPSRES",98,0)
 N %,BP300,BPCLCD,BPFDA,BPFLD,BPOVRIEN,BPMED,BPMSG,BPPSNCD,BPPREAUT,BPPRETYP,BPQ,BPRELCD,DIC,DIR,DIROUT,DTOUT,DUOUT,X,Y,DIRUT
"RTN","BPSRES",99,0)
 ;
"RTN","BPSRES",100,0)
 S BPQ=""
"RTN","BPSRES",101,0)
 ;
"RTN","BPSRES",102,0)
 ;Pull Information from Claim
"RTN","BPSRES",103,0)
 S BP300=$G(^BPSC(BP02,300))
"RTN","BPSRES",104,0)
 S BPRELCD=$TR($E($P(BP300,U,6),3,99)," ")
"RTN","BPSRES",105,0)
 S BPPSNCD=$TR($E($P(BP300,U,3),3,99)," ")
"RTN","BPSRES",106,0)
 S (BPPRETYP,BPPREAUT,BPCLCD)="",BPMED=0 F  S BPMED=$O(^BPSC(BP02,400,BPMED)) Q:'BPMED  D  I BPPREAUT]"",BPCLCD]"" Q
"RTN","BPSRES",107,0)
 .N BP460 S BP460=$G(^BPSC(BP02,400,BPMED,460))
"RTN","BPSRES",108,0)
 .S:BPPREAUT="" BPPREAUT=$TR($E($P(BP460,U,2),3,99)," "),BPPRETYP=$TR($E($P(BP460,U),3,99)," ")
"RTN","BPSRES",109,0)
 .S:BPCLCD="" BPCLCD=$TR($E($P($G(^BPSC(BP02,400,BPMED,400)),U,20),3,99)," ")
"RTN","BPSRES",110,0)
 ;
"RTN","BPSRES",111,0)
 W ! S DIR(0)="FO^1:1",DIR("A")="Relationship Code"
"RTN","BPSRES",112,0)
 S DIR("B")=BPRELCD
"RTN","BPSRES",113,0)
 K DIR("?")
"RTN","BPSRES",114,0)
 S DIR("?",1)="Select the relationship code that describes the relationship this patient has"
"RTN","BPSRES",115,0)
 S DIR("?",2)="to the holder of this insurance policy. The standard NCPDP Patient"
"RTN","BPSRES",116,0)
 S DIR("?",3)="Relationship Code list is shown below.  However, it is important to note"
"RTN","BPSRES",117,0)
 S DIR("?",4)="that some payers use their own set of codes for this field so the field"
"RTN","BPSRES",118,0)
 S DIR("?",5)="should be populated based upon the payer's expectations."
"RTN","BPSRES",119,0)
 S DIR("?",6)=" "
"RTN","BPSRES",120,0)
 S DIR("?",7)="Choose from:"
"RTN","BPSRES",121,0)
 S DIR("?",8)="  0   Not Specified"
"RTN","BPSRES",122,0)
 S DIR("?",9)="  1   Cardholder"
"RTN","BPSRES",123,0)
 S DIR("?",10)="  2   Spouse"
"RTN","BPSRES",124,0)
 S DIR("?",11)="  3   Child"
"RTN","BPSRES",125,0)
 S DIR("?")="  4   Other"
"RTN","BPSRES",126,0)
 D ^DIR
"RTN","BPSRES",127,0)
 I $D(DTOUT)!$D(DUOUT) S BPQ=-1 G XPROMPTS
"RTN","BPSRES",128,0)
 S BPRELCD=Y
"RTN","BPSRES",129,0)
 ;
"RTN","BPSRES",130,0)
 ;Person Code
"RTN","BPSRES",131,0)
 K DIR("?") S DIR(0)="FO^1:3",DIR("A")="Person Code",DIR("?")="Enter the Specific Person Code Assigned to the Patient by the Payer"
"RTN","BPSRES",132,0)
 S DIR("B")=BPPSNCD
"RTN","BPSRES",133,0)
 D ^DIR
"RTN","BPSRES",134,0)
 I $D(DTOUT)!$D(DUOUT) S BPQ=-1 G XPROMPTS
"RTN","BPSRES",135,0)
 S BPPSNCD=Y
"RTN","BPSRES",136,0)
 ;
"RTN","BPSRES",137,0)
 ;Pre-Authorization
"RTN","BPSRES",138,0)
 K DIR("?") S DIR(0)="FO^1:11",DIR("A")="Prior Authorization Number",DIR("?")="Enter the Number Submitted by the Provider to Identify the Prior Authorization"
"RTN","BPSRES",139,0)
 S DIR("B")=BPPREAUT
"RTN","BPSRES",140,0)
 D ^DIR
"RTN","BPSRES",141,0)
 I $D(DTOUT)!$D(DUOUT) S BPQ=-1 G XPROMPTS
"RTN","BPSRES",142,0)
 S BPPREAUT=Y
"RTN","BPSRES",143,0)
 ;
"RTN","BPSRES",144,0)
 ;Prior-Authorization Type Code
"RTN","BPSRES",145,0)
 N X,DIC,Y
"RTN","BPSRES",146,0)
 S DIC("B")=+BPPRETYP
"RTN","BPSRES",147,0)
 S DIC(0)="QEAM",DIC=9002313.26,DIC("A")="Prior Authorization Type Code: "
"RTN","BPSRES",148,0)
 D ^DIC
"RTN","BPSRES",149,0)
 ;
"RTN","BPSRES",150,0)
 ;Check for "^" or timeout
"RTN","BPSRES",151,0)
 I ($D(DUOUT))!($D(DTOUT))!(Y=-1) S BPQ=-1 K X,DIC,Y G XPROMPTS
"RTN","BPSRES",152,0)
 S BPPRETYP=$P(Y,U,2)
"RTN","BPSRES",153,0)
 K X,DIC,Y
"RTN","BPSRES",154,0)
 ;
"RTN","BPSRES",155,0)
 ;Submission Clarification Code
"RTN","BPSRES",156,0)
 S DIC("B")=+BPCLCD
"RTN","BPSRES",157,0)
 S DIC(0)="QEAM",DIC=9002313.25,DIC("A")="Submission Clarification Code: "
"RTN","BPSRES",158,0)
 D ^DIC
"RTN","BPSRES",159,0)
 ;
"RTN","BPSRES",160,0)
 ;Check for "^" or timeout
"RTN","BPSRES",161,0)
 I ($D(DUOUT))!($D(DTOUT))!(Y=-1) S BPQ=-1 K X,DIC,Y G XPROMPTS
"RTN","BPSRES",162,0)
 S BPCLCD=$P(Y,U,2)
"RTN","BPSRES",163,0)
 K X,DIC,Y
"RTN","BPSRES",164,0)
 ;
"RTN","BPSRES",165,0)
 ;Ask to proceed
"RTN","BPSRES",166,0)
 W ! S BPQ=$$YESNO^BPSSCRRS("Are you sure?(Y/N)")
"RTN","BPSRES",167,0)
 I BPQ'=1 S BPQ=-1 G XPROMPTS
"RTN","BPSRES",168,0)
 ;
"RTN","BPSRES",169,0)
 ;Save into BPS NCPDP OVERRIDES (#9002313.511)
"RTN","BPSRES",170,0)
 S BPFDA(9002313.511,"+1,",.01)=BP59
"RTN","BPSRES",171,0)
 D NOW^%DTC
"RTN","BPSRES",172,0)
 S BPFDA(9002313.511,"+1,",.02)=%
"RTN","BPSRES",173,0)
 S BPFLD=$O(^BPSF(9002313.91,"B",303,"")) I BPFLD]"" S BPFDA(9002313.5111,"+2,+1,",.01)=BPFLD,BPFDA(9002313.5111,"+2,+1,",.02)=BPPSNCD
"RTN","BPSRES",174,0)
 S BPFLD=$O(^BPSF(9002313.91,"B",306,"")) I BPFLD]"" S BPFDA(9002313.5111,"+3,+1,",.01)=BPFLD,BPFDA(9002313.5111,"+3,+1,",.02)=BPRELCD
"RTN","BPSRES",175,0)
 S BPFLD=$O(^BPSF(9002313.91,"B",462,"")) I BPFLD]"" S BPFDA(9002313.5111,"+4,+1,",.01)=BPFLD,BPFDA(9002313.5111,"+4,+1,",.02)=BPPREAUT
"RTN","BPSRES",176,0)
 S BPFLD=$O(^BPSF(9002313.91,"B",461,"")) I BPFLD]"" S BPFDA(9002313.5111,"+5,+1,",.01)=BPFLD,BPFDA(9002313.5111,"+5,+1,",.02)=BPPRETYP
"RTN","BPSRES",177,0)
 S BPFLD=$O(^BPSF(9002313.91,"B",420,"")) I BPFLD]"" S BPFDA(9002313.5111,"+6,+1,",.01)=BPFLD,BPFDA(9002313.5111,"+6,+1,",.02)=BPCLCD
"RTN","BPSRES",178,0)
 D UPDATE^DIE("","BPFDA","BPOVRIEN","BPMSG")
"RTN","BPSRES",179,0)
 ;
"RTN","BPSRES",180,0)
 I $D(BPMSG("DIERR")) W !!,"Could Not Save Override information into BPS NCPDP OVERRIDES FILES",! S BPQ=-1 G XPROMPTS
"RTN","BPSRES",181,0)
 ;
"RTN","BPSRES",182,0)
XPROMPTS S BPOVRIEN=$S(BPQ=-1:BPQ,$G(BPOVRIEN(1))]"":BPOVRIEN(1),1:-1)
"RTN","BPSRES",183,0)
 Q BPOVRIEN
"RTN","BPSRES",184,0)
 ;
"RTN","BPSRES",185,0)
 ;Prompt User for Claim to Resubmit (w/EDITS)
"RTN","BPSRES",186,0)
 ;
"RTN","BPSRES",187,0)
 ; Input values ->  BPROMPT - prompt string
"RTN","BPSRES",188,0)
 ;                 BPERRMES - the message to display when the user tries
"RTN","BPSRES",189,0)
 ;                           to make multi line selection (optional)
"RTN","BPSRES",190,0)
 ;                  Piece
"RTN","BPSRES",191,0)
 ;output values ->      1 - 1 = okay, <0 = errors, 0 = quit
"RTN","BPSRES",192,0)
 ;                      2 - patient ien #2
"RTN","BPSRES",193,0)
 ;                      3 - insurance ien #36
"RTN","BPSRES",194,0)
 ;                      4 - ptr to #9002313.59
"RTN","BPSRES",195,0)
 ;                      5 - 1st line for index(es) in LM "VALM" array
"RTN","BPSRES",196,0)
 ;                      6 - patient's index
"RTN","BPSRES",197,0)
 ;                      7 - claim's index
"RTN","BPSRES",198,0)
ASKLINE(BPROMPT,BPERRMES) ;
"RTN","BPSRES",199,0)
 N BPRET,BPCNT
"RTN","BPSRES",200,0)
 S BPRET="",BPCNT=0
"RTN","BPSRES",201,0)
 F  S BPRET=$$SELLINE^BPSSCRU4(BPROMPT,"C",VALMAR,"") Q:BPRET'<0  D
"RTN","BPSRES",202,0)
 . ;
"RTN","BPSRES",203,0)
 . I BPCNT<1 S BPCNT=BPCNT+1 W !
"RTN","BPSRES",204,0)
 . E  S BPCNT=0 D RE^VALM4
"RTN","BPSRES",205,0)
 . I BPRET=-1 W "Invalid line number" ; (invalid Patient summary line)"
"RTN","BPSRES",206,0)
 . I BPRET=-8 W $S($G(BPERRMES)]"":BPERRMES,1:" Invalid line number")
"RTN","BPSRES",207,0)
 . I BPRET=-4 W "Invalid line number" ; (invalid RX line)"
"RTN","BPSRES",208,0)
 . I BPRET=-2 W "Please select Patient's summary line."
"RTN","BPSRES",209,0)
 . I BPRET=-3 W "Please specify RX line."
"RTN","BPSRES",210,0)
 . I ",-1,-8,-4,-2,-3,"'[(","_BPRET_",") W "Incorrect format." ; Corrupted array (",BPRET,")"
"RTN","BPSRES",211,0)
 Q BPRET
"RTN","BPSRPAY")
0^16^B35245645
"RTN","BPSRPAY",1,0)
BPSRPAY ;BHAM ISC/BEE - ECME REPORTS ;11/15/07  14:13
"RTN","BPSRPAY",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,7**;JUN 2004;Build 46
"RTN","BPSRPAY",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSRPAY",4,0)
 ;
"RTN","BPSRPAY",5,0)
 Q
"RTN","BPSRPAY",6,0)
 ;
"RTN","BPSRPAY",7,0)
 ; Payer Sheet Display Report
"RTN","BPSRPAY",8,0)
 ;
"RTN","BPSRPAY",9,0)
 ;User Prompts
"RTN","BPSRPAY",10,0)
EN N BPFILE,BPIEN,BPSCR,BPQ
"RTN","BPSRPAY",11,0)
 S BPFILE=9002313.92
"RTN","BPSRPAY",12,0)
 ;
"RTN","BPSRPAY",13,0)
 ;Select Payer Sheet
"RTN","BPSRPAY",14,0)
 I $D(IOF) W @IOF
"RTN","BPSRPAY",15,0)
 W !,"Payer Sheet Detail Report",!!
"RTN","BPSRPAY",16,0)
 S BPIEN=$$BPIEN(BPFILE)
"RTN","BPSRPAY",17,0)
 ;
"RTN","BPSRPAY",18,0)
 ;Check for Valid Entry
"RTN","BPSRPAY",19,0)
 I BPIEN=-1 G EXIT
"RTN","BPSRPAY",20,0)
 ;
"RTN","BPSRPAY",21,0)
 ;Select Device
"RTN","BPSRPAY",22,0)
 I $$DEVICE=-1 G EXIT
"RTN","BPSRPAY",23,0)
 ;
"RTN","BPSRPAY",24,0)
 ;Display Data
"RTN","BPSRPAY",25,0)
 D RUN(BPFILE,BPIEN)
"RTN","BPSRPAY",26,0)
 ;
"RTN","BPSRPAY",27,0)
 ;Exit
"RTN","BPSRPAY",28,0)
EXIT Q
"RTN","BPSRPAY",29,0)
 ;
"RTN","BPSRPAY",30,0)
 ;Display the Payer Sheet Info
"RTN","BPSRPAY",31,0)
 ;
"RTN","BPSRPAY",32,0)
RUN(BPFILE,BPIEN) N BPQ
"RTN","BPSRPAY",33,0)
 D PSPRNT(BPFILE,BPIEN)
"RTN","BPSRPAY",34,0)
 Q
"RTN","BPSRPAY",35,0)
 ;
"RTN","BPSRPAY",36,0)
 ; Select a payer sheet
"RTN","BPSRPAY",37,0)
BPIEN(BPFILE) N DIC,DIRUT,DTOUT,DUOUT,X,Y
"RTN","BPSRPAY",38,0)
 S DIC=$$ROOT^DILFD(BPFILE),DIC(0)="AEMQ"
"RTN","BPSRPAY",39,0)
 S DIC("A")="Select Payer Sheet: "
"RTN","BPSRPAY",40,0)
 D ^DIC
"RTN","BPSRPAY",41,0)
 Q +Y
"RTN","BPSRPAY",42,0)
 ;
"RTN","BPSRPAY",43,0)
 ;Select the output Device
"RTN","BPSRPAY",44,0)
DEVICE() N %ZIS,ZTSK,ZTRTN,ZTIO,ZTSAVE,ZTDESC,POP,BPQ
"RTN","BPSRPAY",45,0)
 S BPQ=0
"RTN","BPSRPAY",46,0)
 S %ZIS="QM"
"RTN","BPSRPAY",47,0)
 W ! D ^%ZIS
"RTN","BPSRPAY",48,0)
 I POP Q -1
"RTN","BPSRPAY",49,0)
 S BPSCR=$S($E($G(IOST),1,2)="C-":1,1:0)
"RTN","BPSRPAY",50,0)
 I $D(IO("Q")) D  S BPQ=-1
"RTN","BPSRPAY",51,0)
 . S ZTRTN="RUN^BPSRPAY(BPFILE,BPIEN)"
"RTN","BPSRPAY",52,0)
 . S ZTIO=ION
"RTN","BPSRPAY",53,0)
 . S ZTSAVE("*")=""
"RTN","BPSRPAY",54,0)
 . S ZTDESC="PAYER SHEET DETAIL REPORT"
"RTN","BPSRPAY",55,0)
 . D ^%ZTLOAD
"RTN","BPSRPAY",56,0)
 . W !,$S($D(ZTSK):"REQUEST QUEUED TASK="_ZTSK,1:"REQUEST CANCELLED")
"RTN","BPSRPAY",57,0)
 . D HOME^%ZIS
"RTN","BPSRPAY",58,0)
 U IO
"RTN","BPSRPAY",59,0)
 Q BPQ
"RTN","BPSRPAY",60,0)
 ;
"RTN","BPSRPAY",61,0)
 ; Payer Sheet Display
"RTN","BPSRPAY",62,0)
PSPRNT(BPFILE,EN) N BPSHDR,BPIEN,BPPAGE,BPQ,CD,L,N,N1,N2,NAME,NM,NUM,SEG,SP
"RTN","BPSRPAY",63,0)
 N SEGNM,TB,WP,X,X0,X5,ZTREQ
"RTN","BPSRPAY",64,0)
 ;
"RTN","BPSRPAY",65,0)
 ; Build List of Segment Header Names
"RTN","BPSRPAY",66,0)
 D INIT
"RTN","BPSRPAY",67,0)
 ;
"RTN","BPSRPAY",68,0)
 ; Get header information
"RTN","BPSRPAY",69,0)
 S BPIEN=EN_","
"RTN","BPSRPAY",70,0)
 D GETS^DIQ(BPFILE,EN,".01;1.02;1.03;1.06;1.07;1.13;1.14;1001","","BPSHDR")
"RTN","BPSRPAY",71,0)
 ;
"RTN","BPSRPAY",72,0)
 ; Display Header Information
"RTN","BPSRPAY",73,0)
 S BPQ=0,BPPAGE=0,SEGNM=""
"RTN","BPSRPAY",74,0)
 D HDR
"RTN","BPSRPAY",75,0)
 ;
"RTN","BPSRPAY",76,0)
 ; Field Detail Information
"RTN","BPSRPAY",77,0)
 ; Loop through Segments
"RTN","BPSRPAY",78,0)
 S SEG=99 F  S SEG=$O(^BPSF(BPFILE,EN,SEG)) Q:SEG=""!(SEG>230)!(SEG="REVERSAL")  D  I BPQ Q
"RTN","BPSRPAY",79,0)
 . ;
"RTN","BPSRPAY",80,0)
 . ;Make sure there are entries for the segment
"RTN","BPSRPAY",81,0)
 . I $P($G(^BPSF(BPFILE,EN,SEG,0)),U,4)<1 Q
"RTN","BPSRPAY",82,0)
 . ;
"RTN","BPSRPAY",83,0)
 . ; Get and display Segment Name
"RTN","BPSRPAY",84,0)
 . S SEGNM=$G(NAME(SEG))
"RTN","BPSRPAY",85,0)
 . ; Check that we can display the Segment Name and at least one additional field
"RTN","BPSRPAY",86,0)
 . D CHKP(2) I BPQ Q
"RTN","BPSRPAY",87,0)
 . I BPPAGE=1!($Y>5) W !,?((60-$L(SEGNM)+8)/2),"*** ",SEGNM," ***"
"RTN","BPSRPAY",88,0)
 . ; Loop through the Field via the Sequence Number
"RTN","BPSRPAY",89,0)
 . S N=0 F  S N=$O(^BPSF(BPFILE,EN,SEG,"B",N)) Q:N=""  D  I BPQ Q
"RTN","BPSRPAY",90,0)
 .. S N1=0 F  S N1=$O(^BPSF(BPFILE,EN,SEG,"B",N,N1)) Q:N1=""  D  I BPQ Q
"RTN","BPSRPAY",91,0)
 ... ;
"RTN","BPSRPAY",92,0)
 ... ; Get Field Data and Format the Field Number
"RTN","BPSRPAY",93,0)
 ... S X=$G(^BPSF(BPFILE,EN,SEG,N1,0))
"RTN","BPSRPAY",94,0)
 ... S NUM=$P(X,U,2),SP=$P(X,U,3)
"RTN","BPSRPAY",95,0)
 ... I NUM S X0=$G(^BPSF(9002313.91,NUM,0)),X5=$G(^BPSF(9002313.91,NUM,5))
"RTN","BPSRPAY",96,0)
 ... E  S (X0,X5)=""
"RTN","BPSRPAY",97,0)
 ... S NUM=$P(X0,U,1)_"-"_$P(X5,U,1),NM=$P(X0,U,3)
"RTN","BPSRPAY",98,0)
 ... ;
"RTN","BPSRPAY",99,0)
 ... ; Display the field information
"RTN","BPSRPAY",100,0)
 ... D CHKP(1) I BPQ Q
"RTN","BPSRPAY",101,0)
 ... W !,N,?5,NUM,?17,NM,?71,$J(SP,9)
"RTN","BPSRPAY",102,0)
 ... ;
"RTN","BPSRPAY",103,0)
 ... ; If there is special code, display it
"RTN","BPSRPAY",104,0)
 ... I SP="X" S N2=0 F  S N2=$O(^BPSF(BPFILE,EN,SEG,N1,1,N2)) Q:N2=""  D  I BPQ Q
"RTN","BPSRPAY",105,0)
 .... S CD=$G(^BPSF(BPFILE,EN,SEG,N1,1,N2,0))
"RTN","BPSRPAY",106,0)
 .... S TB=19,L=61,WP=0
"RTN","BPSRPAY",107,0)
 .... F  D CHKP(1) Q:BPQ  W ! D  Q:CD=""
"RTN","BPSRPAY",108,0)
 ..... W:N2=1 ?5,"Special Code: "
"RTN","BPSRPAY",109,0)
 ..... W:WP=1 ?12,"<cont>"
"RTN","BPSRPAY",110,0)
 ..... W ?19,$E(CD,1,L)
"RTN","BPSRPAY",111,0)
 ..... S CD=$E(CD,L+1,200) Q:CD=""
"RTN","BPSRPAY",112,0)
 ..... S WP=1
"RTN","BPSRPAY",113,0)
 . I BPQ Q
"RTN","BPSRPAY",114,0)
 .D CHKP(1) Q:BPQ  W !
"RTN","BPSRPAY",115,0)
 I 'BPSCR W !,@IOF
"RTN","BPSRPAY",116,0)
 E  I 'BPQ D PAUSE2
"RTN","BPSRPAY",117,0)
 I $D(ZTQUEUED) S ZTREQ="@" Q
"RTN","BPSRPAY",118,0)
 D ^%ZISC
"RTN","BPSRPAY",119,0)
XPRT Q
"RTN","BPSRPAY",120,0)
 ;
"RTN","BPSRPAY",121,0)
 ;Display Report Header
"RTN","BPSRPAY",122,0)
 ;
"RTN","BPSRPAY",123,0)
HDR S BPPAGE=$G(BPPAGE)+1
"RTN","BPSRPAY",124,0)
 W @IOF
"RTN","BPSRPAY",125,0)
 W "Payer Sheet Detail Report"
"RTN","BPSRPAY",126,0)
 W ?48,"Print Date: "_$E(DT,4,5)_"/"_$E(DT,6,7)_"/"_$E(DT,2,3)
"RTN","BPSRPAY",127,0)
 W "    Page:",$J(BPPAGE,3)
"RTN","BPSRPAY",128,0)
 W !,$J("Payer Sheet Name: ",20),$G(BPSHDR(BPFILE,BPIEN,.01))
"RTN","BPSRPAY",129,0)
 W ?40,$J("Version Number: ",20),$G(BPSHDR(BPFILE,BPIEN,1.14))
"RTN","BPSRPAY",130,0)
 I BPPAGE=1 D
"RTN","BPSRPAY",131,0)
 . W !,$J("Status: ",20),$G(BPSHDR(BPFILE,BPIEN,1.06))
"RTN","BPSRPAY",132,0)
 . W ?40,$J("NCPDP Version: ",20),$G(BPSHDR(BPFILE,BPIEN,1.02))
"RTN","BPSRPAY",133,0)
 . W !,$J("Reversal Format: ",20),$G(BPSHDR(BPFILE,BPIEN,1.07))
"RTN","BPSRPAY",134,0)
 . W ?40,$J("Reversal Sheet: ",20),$G(BPSHDR(BPFILE,BPIEN,1001))
"RTN","BPSRPAY",135,0)
 . W !,$J("Transaction Count: ",20),$G(BPSHDR(BPFILE,BPIEN,1.03))
"RTN","BPSRPAY",136,0)
 . W ?40,$J("Certification ID: ",20),$G(BPSHDR(BPFILE,BPIEN,1.13))
"RTN","BPSRPAY",137,0)
 ;
"RTN","BPSRPAY",138,0)
 ; Display subheader
"RTN","BPSRPAY",139,0)
 W !!,"Seq",?5,"Field",?17,"Field Name",?71,"Proc Mode"
"RTN","BPSRPAY",140,0)
 W !,"---",?5,"-----",?17,"----------",?71,"---------"
"RTN","BPSRPAY",141,0)
 I $G(SEGNM)]"" W !,?((60-$L(SEGNM)+8)/2),"*** ",SEGNM," ***"
"RTN","BPSRPAY",142,0)
 Q
"RTN","BPSRPAY",143,0)
 ;
"RTN","BPSRPAY",144,0)
 ;Check for End of Page
"RTN","BPSRPAY",145,0)
 ;
"RTN","BPSRPAY",146,0)
 ; Input variable -> BPLINES - Number of lines from bottom
"RTN","BPSRPAY",147,0)
 ;                      CONT - 0 = New Entry, 1 = Continue Entry
"RTN","BPSRPAY",148,0)
 ;
"RTN","BPSRPAY",149,0)
CHKP(BPLINES) S BPLINES=BPLINES+1
"RTN","BPSRPAY",150,0)
 I $G(BPSCR) S BPLINES=BPLINES+3
"RTN","BPSRPAY",151,0)
 I $Y>(IOSL-BPLINES) D:$G(BPSCR) PAUSE Q:$G(BPQ) 0 D HDR Q 1
"RTN","BPSRPAY",152,0)
 Q 0
"RTN","BPSRPAY",153,0)
 ;
"RTN","BPSRPAY",154,0)
PAUSE ;
"RTN","BPSRPAY",155,0)
 N X
"RTN","BPSRPAY",156,0)
 U IO(0)
"RTN","BPSRPAY",157,0)
 R !!,"Press RETURN to continue, '^' to exit: ",X:DTIME
"RTN","BPSRPAY",158,0)
 I '$T S X="^"
"RTN","BPSRPAY",159,0)
 I X["^" S BPQ=1
"RTN","BPSRPAY",160,0)
 U IO
"RTN","BPSRPAY",161,0)
 Q
"RTN","BPSRPAY",162,0)
 ;
"RTN","BPSRPAY",163,0)
PAUSE2 ;
"RTN","BPSRPAY",164,0)
 N X
"RTN","BPSRPAY",165,0)
 U IO(0)
"RTN","BPSRPAY",166,0)
 R !,"Press RETURN to continue: ",X:DTIME
"RTN","BPSRPAY",167,0)
 U IO
"RTN","BPSRPAY",168,0)
 Q
"RTN","BPSRPAY",169,0)
 ;
"RTN","BPSRPAY",170,0)
INIT ; Create local array of segment header names
"RTN","BPSRPAY",171,0)
 S NAME(100)="Transaction Header Segment",NAME(110)="Patient Segment"
"RTN","BPSRPAY",172,0)
 S NAME(120)="Insurance Segment",NAME(130)="Claim Segment"
"RTN","BPSRPAY",173,0)
 S NAME(140)="Pharmacy Provider Segment",NAME(150)="Prescriber Segment"
"RTN","BPSRPAY",174,0)
 S NAME(160)="COB/Other Payments Segment",NAME(170)="Workers' Compensation Segment"
"RTN","BPSRPAY",175,0)
 S NAME(180)="DUR/PPS Segment",NAME(190)="Pricing Segment"
"RTN","BPSRPAY",176,0)
 S NAME(200)="Coupon Segment",NAME(210)="Compound Segment"
"RTN","BPSRPAY",177,0)
 S NAME(220)="Prior Authorization Segment",NAME(230)="Clinical Segment"
"RTN","BPSRPAY",178,0)
 Q
"RTN","BPSRPT0")
0^20^B22975830
"RTN","BPSRPT0",1,0)
BPSRPT0 ;BHAM ISC/BEE - ECME REPORTS ;14-FEB-05
"RTN","BPSRPT0",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5,7**;JUN 2004;Build 46
"RTN","BPSRPT0",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSRPT0",4,0)
 ;
"RTN","BPSRPT0",5,0)
 Q
"RTN","BPSRPT0",6,0)
 ;
"RTN","BPSRPT0",7,0)
 ; Front End for ECME Reports
"RTN","BPSRPT0",8,0)
 ; 
"RTN","BPSRPT0",9,0)
 ; Input variable: BPRTYPE -> 1 = Payable Claims
"RTN","BPSRPT0",10,0)
 ;                          2 = Rejected Claims
"RTN","BPSRPT0",11,0)
 ;                          3 = Claims Submitted, Not Yet Released
"RTN","BPSRPT0",12,0)
 ;                          4 = Reversed Claims
"RTN","BPSRPT0",13,0)
 ;                          5 = Recent Transactions
"RTN","BPSRPT0",14,0)
 ;                          6 = Totals By Date
"RTN","BPSRPT0",15,0)
 ;                          7 = Closed Claims
"RTN","BPSRPT0",16,0)
 ;                          
"RTN","BPSRPT0",17,0)
 ; Passed variables - The following local variables are passed around the BPSRPT* routines
"RTN","BPSRPT0",18,0)
 ;                    and are not passed as parameters but are assumed to be defined:
"RTN","BPSRPT0",19,0)
 ;                    BPACREJ,BPAUTREV,BPBEGDT,BPBLINE,BPCCRSN,BPDRGCL,BPDRUG,BPENDDT,BPEXCEL,
"RTN","BPSRPT0",20,0)
 ;                    BPINSINF,BPGRPLN,BPMWC,BPNOW,BPPAGE,BPPHARM,BPQ,BPQSTDRG,
"RTN","BPSRPT0",21,0)
 ;                    BPRLNRL,BPRTBCK,BPSDATA,BPSUMDET,BPRTYPE
"RTN","BPSRPT0",22,0)
 ;                          
"RTN","BPSRPT0",23,0)
EN(BPRTYPE) N %,BPACREJ,BPAUTREV,BPBEGDT,BPCCRSN,BPDRGCL,BPDRUG,BPENDDT,BPEXCEL,BPNOW,BPPHARM,BPINSINF,BPMWC,BPQ,BPQSTDRG
"RTN","BPSRPT0",24,0)
 N BPREJCD,BPRLNRL,BPRPTNAM,BPRTBCK,BPSCR,BPSUMDET,CODE,POS,STAT,X,Y,BPINS,BPARR,BPELIG,BPOPCL
"RTN","BPSRPT0",25,0)
 ;
"RTN","BPSRPT0",26,0)
 ;Verify that a valid report has been requested
"RTN","BPSRPT0",27,0)
 I ",1,2,3,4,5,6,7,"'[(","_$G(BPRTYPE)_",") W "<Invalid Menu Definition - Report Undefined>" H 3 Q
"RTN","BPSRPT0",28,0)
 S BPRPTNAM=$S(BPRTYPE=1:"PAYABLE CLAIMS",BPRTYPE=2:"REJECTED CLAIMS",BPRTYPE=3:"SUBMIT,NOT RELEASED CLAIMS",BPRTYPE=4:"REVERSED CLAIMS",BPRTYPE=5:"RECENT TRANSACTIONS",BPRTYPE=6:"TOTALS",BPRTYPE=7:"CLOSED CLAIMS",1:"")
"RTN","BPSRPT0",29,0)
 ;
"RTN","BPSRPT0",30,0)
 ;Get current Date/Time
"RTN","BPSRPT0",31,0)
 D NOW^%DTC S Y=% D DD^%DT S BPNOW=Y
"RTN","BPSRPT0",32,0)
 ;
"RTN","BPSRPT0",33,0)
 ;Prompt for ECME Pharmacy Division(s) (No Default)
"RTN","BPSRPT0",34,0)
 ;Sets up BPPHARM variable and array, BPPHARM =0 ALL or BPPHARM=1,BPPHARM(ptr) for list
"RTN","BPSRPT0",35,0)
 S X=$$SELPHARM^BPSRPT3() I X="^" G EXIT
"RTN","BPSRPT0",36,0)
 ;
"RTN","BPSRPT0",37,0)
 ;Prompt to Display Summary or Detail Format (Default to Detail)
"RTN","BPSRPT0",38,0)
 ;Returns 1 for Summary, 0 for Detail
"RTN","BPSRPT0",39,0)
 S BPSUMDET=$$SELSMDET^BPSRPT3(2) I BPSUMDET="^" G EXIT
"RTN","BPSRPT0",40,0)
 ;
"RTN","BPSRPT0",41,0)
 ;Prompt to allow selection of Multiple Insurances or All (Default to ALL)
"RTN","BPSRPT0",42,0)
 ;See description for $$INSURSEL^BPSSCRCU
"RTN","BPSRPT0",43,0)
 S BPINS=$$INSURSEL^BPSSCRCU(.BPARR,DUZ) I BPINS<1 G EXIT
"RTN","BPSRPT0",44,0)
 S BPINSINF=$S(BPARR(1.11)="I":BPARR("INS"),1:0)
"RTN","BPSRPT0",45,0)
 ;
"RTN","BPSRPT0",46,0)
 ;Prompt to Display (C)MOP or (M)ail or (W)indow or (A)LL (Default to ALL)
"RTN","BPSRPT0",47,0)
 ;Returns (A-ALL,M-Mail,W-Window,C-CMOP)
"RTN","BPSRPT0",48,0)
 S BPMWC=$$SELMWC^BPSRPT3("A") I BPMWC="^" G EXIT
"RTN","BPSRPT0",49,0)
 ;
"RTN","BPSRPT0",50,0)
 ;Prompt to Display (R)ealTime Fills or (B)ackbills or (A)LL (Default to ALL)
"RTN","BPSRPT0",51,0)
 ;Returns (1-ALL,2-RealTime Fills,3-Backbills)
"RTN","BPSRPT0",52,0)
 S BPRTBCK=$$SELRTBCK^BPSRPT3(1) I BPRTBCK="^" G EXIT
"RTN","BPSRPT0",53,0)
 ;
"RTN","BPSRPT0",54,0)
 ;Prompt to Display Specific (D)rug or Drug (C)lass or (A)ll (Default to ALL)
"RTN","BPSRPT0",55,0)
 ;Returns (1-ALL,2-Drug,3-Drug Class)
"RTN","BPSRPT0",56,0)
 S BPQSTDRG=$$SELDRGAL^BPSRPT3(1) I BPQSTDRG="^" Q
"RTN","BPSRPT0",57,0)
 ;
"RTN","BPSRPT0",58,0)
 ;Prompt to Select Drug (No Default)
"RTN","BPSRPT0",59,0)
 S BPDRUG=0 I BPQSTDRG=2 S BPDRUG=$$SELDRG^BPSRPT3() I BPDRUG="^" G EXIT
"RTN","BPSRPT0",60,0)
 ;
"RTN","BPSRPT0",61,0)
 ;Prompt to Select Drug Class (No Default)
"RTN","BPSRPT0",62,0)
 S BPDRGCL=0 I BPQSTDRG=3 S BPDRGCL=$$SELDRGCL^BPSRPT3() I BPDRGCL="^" G EXIT
"RTN","BPSRPT0",63,0)
 ;
"RTN","BPSRPT0",64,0)
 ;Report Specific Prompts
"RTN","BPSRPT0",65,0)
 ;
"RTN","BPSRPT0",66,0)
 ;Prompt to select Date Range
"RTN","BPSRPT0",67,0)
 ;Returns (Start Date^End Date)
"RTN","BPSRPT0",68,0)
 I (",1,2,3,4,5,6,7,")[BPRTYPE S BPBEGDT=$$SELDATE^BPSRPT3(BPRTYPE) D  I BPBEGDT="^" G EXIT
"RTN","BPSRPT0",69,0)
 .I BPBEGDT="^" Q
"RTN","BPSRPT0",70,0)
 .S BPENDDT=$P(BPBEGDT,U,2)
"RTN","BPSRPT0",71,0)
 .S BPBEGDT=$P(BPBEGDT,U)
"RTN","BPSRPT0",72,0)
 ;
"RTN","BPSRPT0",73,0)
 ;Prompt to Include (R)ELEASED or (N)OT RELEASED or (A)LL (Default to RELEASED)
"RTN","BPSRPT0",74,0)
 ;Returns (1-ALL,2-RELEASED,3-NOT RELEASED)
"RTN","BPSRPT0",75,0)
 S BPRLNRL=$S(BPRTYPE=3:3,1:1) I (",1,2,4,6,7,")[BPRTYPE S BPRLNRL=$$SELRLNRL^BPSRPT4(2) I BPRLNRL="^" G EXIT
"RTN","BPSRPT0",76,0)
 ;
"RTN","BPSRPT0",77,0)
 ;Prompt to Include (S)pecific Reject Code or (A)LL (Default to ALL)
"RTN","BPSRPT0",78,0)
 ;Returns (0-ALL,ptr-Pointer to Selected Reject Code in #9002313.93)
"RTN","BPSRPT0",79,0)
 S BPREJCD=0 I (",2,")[BPRTYPE S BPREJCD=$$SELREJCD^BPSRPT4(0) I BPREJCD="^" G EXIT
"RTN","BPSRPT0",80,0)
 ;
"RTN","BPSRPT0",81,0)
 ;Prompt to Include Auto(R)eversed or (A)LL (Default to ALL)
"RTN","BPSRPT0",82,0)
 ;Returns (0-All,1-AutoReversed)
"RTN","BPSRPT0",83,0)
 S BPAUTREV=0 I (",4,")[BPRTYPE S BPAUTREV=$$SELAUREV^BPSRPT4(0) I BPAUTREV="^" G EXIT
"RTN","BPSRPT0",84,0)
 ;
"RTN","BPSRPT0",85,0)
 ;Prompt to Include A(C)cepted or (R)ejected or (A)LL (Default to REJECTED)
"RTN","BPSRPT0",86,0)
 ;Returns (0-All,1-Rejected,2-Accepted)
"RTN","BPSRPT0",87,0)
 S BPACREJ=0 I (",4,")[BPRTYPE S BPACREJ=$$SELACREJ^BPSRPT4(1) I BPACREJ="^" G EXIT
"RTN","BPSRPT0",88,0)
 ;
"RTN","BPSRPT0",89,0)
 ;Prompt to Include (S)pecific Close Claim Reason or (A)ll (Default to All)
"RTN","BPSRPT0",90,0)
 ;Returns (0-All,ptr-Pointer to #356.8)
"RTN","BPSRPT0",91,0)
 S BPCCRSN=0 I (",7,")[BPRTYPE S BPCCRSN=$$SELCCRSN^BPSRPT4(0) I BPCCRSN="^" G EXIT
"RTN","BPSRPT0",92,0)
 ;
"RTN","BPSRPT0",93,0)
 ;Prompt for Eligibility Indicator for rejected claims report
"RTN","BPSRPT0",94,0)
 ;Returns (V=Veteran,T=TRICARE,0=All)
"RTN","BPSRPT0",95,0)
 S BPELIG=0 I (",2,")[BPRTYPE S BPELIG=$$SELELIG^BPSRPT3(1) I BPELIG="^" G EXIT
"RTN","BPSRPT0",96,0)
 ;
"RTN","BPSRPT0",97,0)
 ;Prompt for Open/Closed/All claims
"RTN","BPSRPT0",98,0)
 ;Returns (1=Closed,2=Open,0=All)
"RTN","BPSRPT0",99,0)
 S BPOPCL=0 I (",2,")[BPRTYPE S BPOPCL=$$SELOPCL^BPSRPT3(2) I BPOPCL="^" G EXIT
"RTN","BPSRPT0",100,0)
 ;
"RTN","BPSRPT0",101,0)
 ;Prompt for Excel Capture (Detail Only)
"RTN","BPSRPT0",102,0)
 S BPEXCEL=0 I 'BPSUMDET S BPEXCEL=$$SELEXCEL^BPSRPT4() I BPEXCEL="^" G EXIT
"RTN","BPSRPT0",103,0)
 ;
"RTN","BPSRPT0",104,0)
 ;Prompt for the Device
"RTN","BPSRPT0",105,0)
 I 'BPEXCEL D
"RTN","BPSRPT0",106,0)
 .W !!,"WARNING - THIS REPORT REQUIRES THAT A DEVICE WITH 132 COLUMN WIDTH BE USED."
"RTN","BPSRPT0",107,0)
 .W !,"IT WILL NOT DISPLAY CORRECTLY USING 80 COLUMN WIDTH DEVICES",!
"RTN","BPSRPT0",108,0)
 S BPQ=0 D DEVICE(BPRPTNAM) Q:BPQ
"RTN","BPSRPT0",109,0)
 ;
"RTN","BPSRPT0",110,0)
 ;Compile and Run the Report
"RTN","BPSRPT0",111,0)
 D RUN(BPEXCEL,BPRPTNAM,BPSUMDET)
"RTN","BPSRPT0",112,0)
 I 'BPQ D PAUSE2^BPSRPT1
"RTN","BPSRPT0",113,0)
 ;
"RTN","BPSRPT0",114,0)
EXIT Q
"RTN","BPSRPT0",115,0)
 ;
"RTN","BPSRPT0",116,0)
 ;Compile and Run the Report
"RTN","BPSRPT0",117,0)
 ;
"RTN","BPSRPT0",118,0)
RUN(BPEXCEL,BPRPTNAM,BPSUMDET) N BPPAGE,BPTMP
"RTN","BPSRPT0",119,0)
 S BPTMP=$NA(^TMP($J,"BPSRPT"))
"RTN","BPSRPT0",120,0)
 K @BPTMP
"RTN","BPSRPT0",121,0)
 S BPPAGE=0
"RTN","BPSRPT0",122,0)
 W:BPSCR&'BPEXCEL !,"Please wait...",!
"RTN","BPSRPT0",123,0)
 ;
"RTN","BPSRPT0",124,0)
 ;Compile the report
"RTN","BPSRPT0",125,0)
 Q:$$COLLECT^BPSRPT1(BPTMP)=-1
"RTN","BPSRPT0",126,0)
 U IO
"RTN","BPSRPT0",127,0)
 ;
"RTN","BPSRPT0",128,0)
 ;Display the report
"RTN","BPSRPT0",129,0)
 D REPORT^BPSRPT5(BPTMP,BPEXCEL,BPSCR,BPRPTNAM,BPSUMDET,BPPAGE)
"RTN","BPSRPT0",130,0)
 I 'BPSCR W !,@IOF
"RTN","BPSRPT0",131,0)
 K @BPTMP
"RTN","BPSRPT0",132,0)
 I $D(ZTQUEUED) S ZTREQ="@" Q
"RTN","BPSRPT0",133,0)
 D ^%ZISC
"RTN","BPSRPT0",134,0)
 Q
"RTN","BPSRPT0",135,0)
 ;
"RTN","BPSRPT0",136,0)
 ;Prompt For the Device
"RTN","BPSRPT0",137,0)
 ;
"RTN","BPSRPT0",138,0)
 ; Returns Device variables and BPSCR
"RTN","BPSRPT0",139,0)
 ;
"RTN","BPSRPT0",140,0)
DEVICE(BPRPTNAM) N %ZIS,ZTSK,ZTRTN,ZTIO,ZTDESC,ZTSAVE,POP
"RTN","BPSRPT0",141,0)
 S %ZIS="QM"
"RTN","BPSRPT0",142,0)
 D ^%ZIS
"RTN","BPSRPT0",143,0)
 I POP S BPQ=1
"RTN","BPSRPT0",144,0)
 ;
"RTN","BPSRPT0",145,0)
 ;Check for exit
"RTN","BPSRPT0",146,0)
 I $G(BPQ) G XDEV
"RTN","BPSRPT0",147,0)
 ;
"RTN","BPSRPT0",148,0)
 S BPSCR=$S($E($G(IOST),1,2)="C-":1,1:0)
"RTN","BPSRPT0",149,0)
 I $D(IO("Q")) D  S BPQ=1
"RTN","BPSRPT0",150,0)
 . S ZTRTN="RUN^BPSRPT0(BPEXCEL,BPRPTNAM,BPSUMDET)"
"RTN","BPSRPT0",151,0)
 . S ZTIO=ION
"RTN","BPSRPT0",152,0)
 . S ZTSAVE("*")=""
"RTN","BPSRPT0",153,0)
 . S ZTDESC="BPS REPORT: "_BPRPTNAM
"RTN","BPSRPT0",154,0)
 . D ^%ZTLOAD
"RTN","BPSRPT0",155,0)
 . W !,$S($D(ZTSK):"REQUEST QUEUED TASK="_ZTSK,1:"REQUEST CANCELLED")
"RTN","BPSRPT0",156,0)
 . D HOME^%ZIS
"RTN","BPSRPT0",157,0)
 U IO
"RTN","BPSRPT0",158,0)
XDEV Q
"RTN","BPSRPT1")
0^21^B52062138
"RTN","BPSRPT1",1,0)
BPSRPT1 ;BHAM ISC/BEE - ECME REPORTS ;14-FEB-05
"RTN","BPSRPT1",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5,7**;JUN 2004;Build 46
"RTN","BPSRPT1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSRPT1",4,0)
 Q
"RTN","BPSRPT1",5,0)
 ;
"RTN","BPSRPT1",6,0)
 ; ECME Report Compile Routine - Looping/Filtering Routine
"RTN","BPSRPT1",7,0)
 ;
"RTN","BPSRPT1",8,0)
 ;  Input Variables:
"RTN","BPSRPT1",9,0)
 ;                 BPRTYPE - Type of Report (1-7)
"RTN","BPSRPT1",10,0)
 ;               BPGLTMP - Temporary storage global
"RTN","BPSRPT1",11,0)
 ;  BPPHARM/BPPHARM(ptr) - Set to 0 for all pharmacies, if set to 1 array
"RTN","BPSRPT1",12,0)
 ;                         of internal pointers of selected pharmacies
"RTN","BPSRPT1",13,0)
 ;              BPSUMDET - (1) Summary or (0) Detail format
"RTN","BPSRPT1",14,0)
 ;              BPINSINF - Set to 0 for all insurances or list of file 36 IENs
"RTN","BPSRPT1",15,0)
 ;                 BPMWC - 1-ALL,2-Mail,3-Window,4-CMOP Prescriptions
"RTN","BPSRPT1",16,0)
 ;               BPRTBCK - 1-ALL,2-RealTime,3-Backbill Claim Submission
"RTN","BPSRPT1",17,0)
 ;               BPRLNRL - 1-ALL,2-RELEASED,3-NOT RELEASED
"RTN","BPSRPT1",18,0)
 ;                BPDRUG - DRUG to report on (ptr to #50)
"RTN","BPSRPT1",19,0)
 ;               BPDRGCL - DRUG CLASS to report on (0 for ALL)
"RTN","BPSRPT1",20,0)
 ;               BPBEGDT - Beginning Date
"RTN","BPSRPT1",21,0)
 ;               BPENDDT - Ending Date
"RTN","BPSRPT1",22,0)
 ;               BPCCRSN - Set to 0 for all closed claim reasons or ptr to #356.8
"RTN","BPSRPT1",23,0)
 ;              BPAUTREV - 0-ALL,1-Auto Reversed
"RTN","BPSRPT1",24,0)
 ;               BPACREJ - 0-ALL,1-REJECTED,2-ACCEPTED
"RTN","BPSRPT1",25,0)
 ;              
"RTN","BPSRPT1",26,0)
COLLECT(BPGLTMP) N BP02,BP57,BP59,BPENDDT1,BPLDT02,BPLDT57,X,Y,OK,BPIX
"RTN","BPSRPT1",27,0)
 ;
"RTN","BPSRPT1",28,0)
 ;Check Variables
"RTN","BPSRPT1",29,0)
 S OK=1
"RTN","BPSRPT1",30,0)
 S:'$G(BPBEGDT) BPBEGDT=0
"RTN","BPSRPT1",31,0)
 S:'$G(BPENDDT) BPENDDT=9999999
"RTN","BPSRPT1",32,0)
 S BPENDDT=BPENDDT+0.9
"RTN","BPSRPT1",33,0)
 I $G(BPRTYPE)=""!($G(BPGLTMP)="")!($G(BPPHARM)="")!($G(BPSUMDET)="")!($G(BPINSINF)="")!($G(BPMWC)="")!($G(BPRTBCK)="") S OK=-1 G EXIT
"RTN","BPSRPT1",34,0)
 ;
"RTN","BPSRPT1",35,0)
 ;Loop through BPS CLAIMS
"RTN","BPSRPT1",36,0)
 ;
"RTN","BPSRPT1",37,0)
 ;First look for fill/refill cross reference
"RTN","BPSRPT1",38,0)
 ;Loop through Date of Service Index in BPS CLAIMS file and find link to 
"RTN","BPSRPT1",39,0)
 ;claim in BPS TRANSACTION.  Process earliest Date of Service entry found in
"RTN","BPSRPT1",40,0)
 ;BPS TRANSACTION
"RTN","BPSRPT1",41,0)
 ;
"RTN","BPSRPT1",42,0)
 ;Choose Index to Loop through (different for Closed Claims)
"RTN","BPSRPT1",43,0)
 S BPIX="AF" S:BPRTYPE=7 BPIX="AG"
"RTN","BPSRPT1",44,0)
 ;
"RTN","BPSRPT1",45,0)
 S BPLDT02=$S(BPIX="AF":$$FM2YMD(BPBEGDT-0.00001),1:BPBEGDT) S:BPLDT02="" BPLDT02=0
"RTN","BPSRPT1",46,0)
 S BPENDDT1=$S(BPIX="AF":$$FM2YMD(BPENDDT),1:BPENDDT_".9999999999") S:BPENDDT1="" BPENDDT1=99999999
"RTN","BPSRPT1",47,0)
 F  S BPLDT02=+$O(^BPSC(BPIX,BPLDT02)) Q:BPLDT02=0!(BPLDT02>BPENDDT1)  D
"RTN","BPSRPT1",48,0)
 . S BP02=0 F  S BP02=$O(^BPSC(BPIX,BPLDT02,BP02)) Q:+BP02=0  D
"RTN","BPSRPT1",49,0)
 . . S BP59=+$O(^BPST("AE",BP02,0))
"RTN","BPSRPT1",50,0)
 . . Q:BP59=0
"RTN","BPSRPT1",51,0)
 . . I $D(@BPGLTMP@("FILE59",BP59)) Q
"RTN","BPSRPT1",52,0)
 . . S @BPGLTMP@("FILE59",BP59)=BPLDT02_"^02"
"RTN","BPSRPT1",53,0)
 . . D PROCESS(BP59)
"RTN","BPSRPT1",54,0)
 ;
"RTN","BPSRPT1",55,0)
 ;#9002313.59 has only one entry per claim with, which has a date 
"RTN","BPSRPT1",56,0)
 ;  of the latest update for the claim
"RTN","BPSRPT1",57,0)
 ;#9002313.57 has more than one entries per claim and keep all 
"RTN","BPSRPT1",58,0)
 ;  changes made the claim
"RTN","BPSRPT1",59,0)
 ;so we have to go thru #9002313.57 to find the earliest date 
"RTN","BPSRPT1",60,0)
 ;related to the claim to check it against BPBEGDT
"RTN","BPSRPT1",61,0)
 S BPLDT57=BPBEGDT-0.00001
"RTN","BPSRPT1",62,0)
 F  S BPLDT57=+$O(^BPSTL("AH",BPLDT57)) Q:BPLDT57=0!(BPLDT57>BPENDDT)  D
"RTN","BPSRPT1",63,0)
 . S BP57=0 F  S BP57=$O(^BPSTL("AH",BPLDT57,BP57)) Q:+BP57=0  D
"RTN","BPSRPT1",64,0)
 . . S BP59=+$G(^BPSTL(BP57,0))
"RTN","BPSRPT1",65,0)
 . . I $D(@BPGLTMP@("FILE59",BP59)) Q
"RTN","BPSRPT1",66,0)
 . . S @BPGLTMP@("FILE59",BP59)=BPLDT57_"^57"
"RTN","BPSRPT1",67,0)
 . . D PROCESS(BP59)
"RTN","BPSRPT1",68,0)
 ;
"RTN","BPSRPT1",69,0)
 ;Remove Portion of Scratch Global
"RTN","BPSRPT1",70,0)
EXIT K @BPGLTMP@("FILE59")
"RTN","BPSRPT1",71,0)
 Q OK
"RTN","BPSRPT1",72,0)
 ;
"RTN","BPSRPT1",73,0)
 ;Convert FB date to YYYYMMDD
"RTN","BPSRPT1",74,0)
FM2YMD(BPFMDT) N Y,Y1
"RTN","BPSRPT1",75,0)
 S Y=$E(BPFMDT,2,3),Y1=$E(BPFMDT,1,1) S Y=$S(Y1=3:"20"_Y,Y1=2:"19"_Y,1:"")
"RTN","BPSRPT1",76,0)
 Q:Y Y_$E(BPFMDT,4,7)
"RTN","BPSRPT1",77,0)
 Q ""
"RTN","BPSRPT1",78,0)
 ;
"RTN","BPSRPT1",79,0)
 ;Process each Entry
"RTN","BPSRPT1",80,0)
 ;
"RTN","BPSRPT1",81,0)
PROCESS(BP59) N BPBCK,BPDFN,BPREF,BPPAYBL,BPPLAN,BPREJ,BPRLSDT,BPRX,BPRXDRG,BPSTATUS
"RTN","BPSRPT1",82,0)
 ;
"RTN","BPSRPT1",83,0)
 ;Get ABSBRXI - ptr to #52
"RTN","BPSRPT1",84,0)
 S BPRX=+$P($G(^BPST(BP59,1)),U,11)
"RTN","BPSRPT1",85,0)
 ;
"RTN","BPSRPT1",86,0)
 ;Get ABSBRXR - Prescription Number IEN
"RTN","BPSRPT1",87,0)
 S BPREF=+$P($G(^BPST(BP59,1)),U)
"RTN","BPSRPT1",88,0)
 ;
"RTN","BPSRPT1",89,0)
 ;Get PATIENT - ptr to #2
"RTN","BPSRPT1",90,0)
 S BPDFN=+$P($G(^BPST(BP59,0)),U,6)
"RTN","BPSRPT1",91,0)
 ;
"RTN","BPSRPT1",92,0)
 ;Check for correct BPS Pharmacy (DIVISION)
"RTN","BPSRPT1",93,0)
 I $G(BPPHARM)=1,$$CHKPHRM(BP59)=0 G XPROC
"RTN","BPSRPT1",94,0)
 ;
"RTN","BPSRPT1",95,0)
 ;Check for Display 1-ALL,2-RELEASED,3-NOT RELEASED
"RTN","BPSRPT1",96,0)
 S BPRLSDT=$$RELEASED(BPRX,BPREF)
"RTN","BPSRPT1",97,0)
 I BPRLNRL'=1 I ((BPRLNRL=2)&(BPRLSDT=0))!((BPRLNRL=3)&(BPRLSDT)) G XPROC
"RTN","BPSRPT1",98,0)
 ;
"RTN","BPSRPT1",99,0)
 ;Get Status
"RTN","BPSRPT1",100,0)
 S BPSTATUS=$$STATUS^BPSRPT6(BPRX,BPREF)
"RTN","BPSRPT1",101,0)
 ;
"RTN","BPSRPT1",102,0)
 ;if REVERSAL
"RTN","BPSRPT1",103,0)
 I BPRTYPE=4,BPSTATUS'["REVERSAL" G XPROC  ; exclude non-reversed
"RTN","BPSRPT1",104,0)
 I BPRTYPE=4,$$CLOSED02^BPSSCR03($P(^BPST(BP59,0),U,4))=1 G XPROC  ; exclude closed claims for Reversal Report
"RTN","BPSRPT1",105,0)
 ;
"RTN","BPSRPT1",106,0)
 ;if PAYABLE
"RTN","BPSRPT1",107,0)
 S BPPAYBL=BPSTATUS["PAYABLE"
"RTN","BPSRPT1",108,0)
 I BPRTYPE=1,'BPPAYBL G XPROC  ; exclude non-payable
"RTN","BPSRPT1",109,0)
 I BPRTYPE=1,BPSTATUS["REVERSAL" G XPROC  ; reversed
"RTN","BPSRPT1",110,0)
 ;
"RTN","BPSRPT1",111,0)
 ;if REJECTED
"RTN","BPSRPT1",112,0)
 S BPREJ=BPSTATUS["REJECTED"
"RTN","BPSRPT1",113,0)
 I BPRTYPE=2,BPSTATUS["REVERSAL" G XPROC ; exclude rejected reversals
"RTN","BPSRPT1",114,0)
 I BPRTYPE=2,'BPREJ G XPROC  ; exclude non-rejected
"RTN","BPSRPT1",115,0)
 ;
"RTN","BPSRPT1",116,0)
 ;if SUBMITTED NOT RELEASED exclude released ones
"RTN","BPSRPT1",117,0)
 I BPRTYPE=3,BPRLSDT'=0 G XPROC
"RTN","BPSRPT1",118,0)
 I BPRTYPE=3,'BPPAYBL G XPROC  ; exclude non-payable
"RTN","BPSRPT1",119,0)
 ;
"RTN","BPSRPT1",120,0)
 ;Auto Reverse Check
"RTN","BPSRPT1",121,0)
 I BPRTYPE=4,BPAUTREV,'$$AUTOREV(BP59) G XPROC
"RTN","BPSRPT1",122,0)
 ;
"RTN","BPSRPT1",123,0)
 ;if CLOSED
"RTN","BPSRPT1",124,0)
 I BPRTYPE=7,'$$CLSCLM(BP59) G XPROC  ;exclude open claims
"RTN","BPSRPT1",125,0)
 ;I BPRTYPE=7,BPSTATUS'["REJECTED" G XPROC  ;exclude non-rejected closed claims
"RTN","BPSRPT1",126,0)
 ;
"RTN","BPSRPT1",127,0)
 ;if Recent Transactions, exclude closed claims
"RTN","BPSRPT1",128,0)
 I BPRTYPE=5,$$CLSCLM(BP59) G XPROC
"RTN","BPSRPT1",129,0)
 ;
"RTN","BPSRPT1",130,0)
 ;If Totals by Date, include only rejects and payables
"RTN","BPSRPT1",131,0)
 I BPRTYPE=6,BPSTATUS'["REJECTED",BPSTATUS'["PAYABLE" G XPROC  ; Reversed
"RTN","BPSRPT1",132,0)
 ;
"RTN","BPSRPT1",133,0)
 ;Realtime/Backbill Check
"RTN","BPSRPT1",134,0)
 S BPBCK=$$RTBCK(BP59)
"RTN","BPSRPT1",135,0)
 I BPRTBCK'=1 I ((BPRTBCK=2)&(BPBCK=0))!((BPRTBCK=3)&(BPBCK)) G XPROC
"RTN","BPSRPT1",136,0)
 ;
"RTN","BPSRPT1",137,0)
 ;Check for MAIL/WINDOW/CMOP/ALL
"RTN","BPSRPT1",138,0)
 I BPMWC'="A",$$MWC^BPSRPT6(BPRX,BPREF)'=BPMWC G XPROC
"RTN","BPSRPT1",139,0)
 ;
"RTN","BPSRPT1",140,0)
 ;Check for selected insurance
"RTN","BPSRPT1",141,0)
 S BPPLAN=$$INSNAM^BPSRPT6(BP59)
"RTN","BPSRPT1",142,0)
 I BPINSINF'=0,'$$CHKINS^BPSSCRCU($P(BPPLAN,U,1),BPINSINF) G XPROC
"RTN","BPSRPT1",143,0)
 S BPPLAN=$P(BPPLAN,U,2)
"RTN","BPSRPT1",144,0)
 ;
"RTN","BPSRPT1",145,0)
 ;Check for selected drug
"RTN","BPSRPT1",146,0)
 S BPRXDRG=$$GETDRUG^BPSRPT6(BPRX)
"RTN","BPSRPT1",147,0)
 I BPRXDRG=0 G XPROC
"RTN","BPSRPT1",148,0)
 I BPDRUG,BPDRUG'=BPRXDRG G XPROC
"RTN","BPSRPT1",149,0)
 ;
"RTN","BPSRPT1",150,0)
 ;Check for selected drug classes
"RTN","BPSRPT1",151,0)
 I BPDRGCL'=0,BPDRGCL'=$$DRGCLNAM^BPSRPT6($$GETDRGCL^BPSRPT6(BPRXDRG),99) G XPROC
"RTN","BPSRPT1",152,0)
 ;
"RTN","BPSRPT1",153,0)
 ;Check for selected Close Reason
"RTN","BPSRPT1",154,0)
 I BPCCRSN,BPCCRSN'=$P($$CLRSN^BPSRPT7(BP59),U) G XPROC
"RTN","BPSRPT1",155,0)
 ;
"RTN","BPSRPT1",156,0)
 ;Check for Accepted/Rejected
"RTN","BPSRPT1",157,0)
 I BPACREJ=1,BPSTATUS'["REJECTED" G XPROC
"RTN","BPSRPT1",158,0)
 I BPACREJ=2,BPSTATUS'["ACCEPTED" G XPROC
"RTN","BPSRPT1",159,0)
 ;
"RTN","BPSRPT1",160,0)
 ;Check for Specific Reject Code
"RTN","BPSRPT1",161,0)
 I BPREJCD'=0,'$$CKREJ(BP59,BPREJCD) G XPROC
"RTN","BPSRPT1",162,0)
 ;
"RTN","BPSRPT1",163,0)
 ;Check for Eligibility Code
"RTN","BPSRPT1",164,0)
 I BPELIG'=0,BPELIG'=$$ELIGCODE^BPSSCR05(BP59) G XPROC
"RTN","BPSRPT1",165,0)
 ;
"RTN","BPSRPT1",166,0)
 ;Check Open/Closed claim
"RTN","BPSRPT1",167,0)
 I BPOPCL'=0,((BPOPCL=2)&($$CLOSED02^BPSSCR03($P(^BPST(BP59,0),U,4))=1))!((BPOPCL=1)&($$CLOSED02^BPSSCR03($P(^BPST(BP59,0),U,4))'=1)) G XPROC
"RTN","BPSRPT1",168,0)
 ;
"RTN","BPSRPT1",169,0)
 ;Save Entry for Report
"RTN","BPSRPT1",170,0)
 D SETTMP^BPSRPT2(BPGLTMP,BPDFN,BPRX,BPREF,BP59,BPBEGDT,BPENDDT,.BPPHARM,BPSUMDET,BPPLAN,BPRLSDT,BPPAYBL,BPREJ,BPRXDRG,$P(BPSTATUS,U))
"RTN","BPSRPT1",171,0)
 ;
"RTN","BPSRPT1",172,0)
XPROC Q
"RTN","BPSRPT1",173,0)
 ;
"RTN","BPSRPT1",174,0)
 ;Check if selected BPS PHARMACY
"RTN","BPSRPT1",175,0)
 ;
"RTN","BPSRPT1",176,0)
 ; Defined Variable: BPPHARM(ptr) - List of BPS Pharmacies to Report on
"RTN","BPSRPT1",177,0)
 ; Input Variable: BP59 - Lookup to BPS TRANSACTION (#59)
"RTN","BPSRPT1",178,0)
 ; 
"RTN","BPSRPT1",179,0)
 ; Returned Value -> 0 = Entry not in list of selected pharmacies
"RTN","BPSRPT1",180,0)
 ;                   1 = Entry is in list of selected pharmacies
"RTN","BPSRPT1",181,0)
CHKPHRM(BP59) N PHARM
"RTN","BPSRPT1",182,0)
 S PHARM=+$P($G(^BPST(BP59,1)),"^",7)
"RTN","BPSRPT1",183,0)
 S PHARM=$S($D(BPPHARM(PHARM)):1,1:0)
"RTN","BPSRPT1",184,0)
 Q PHARM
"RTN","BPSRPT1",185,0)
 ;
"RTN","BPSRPT1",186,0)
 ;Determine whether claim is Released or Not Released
"RTN","BPSRPT1",187,0)
 ;
"RTN","BPSRPT1",188,0)
 ; Input Variables: BPRX - ptr to PRESCRIPTION (#52)
"RTN","BPSRPT1",189,0)
 ;                 BPREF - refill # (0-No Refills,1-1st Refill, 2-2nd, ...) 
"RTN","BPSRPT1",190,0)
 ;
"RTN","BPSRPT1",191,0)
 ; Return Value ->             0 = Not Released
"RTN","BPSRPT1",192,0)
 ;                 released date = Released
"RTN","BPSRPT1",193,0)
 ;                 
"RTN","BPSRPT1",194,0)
RELEASED(BPRX,BPREF) N RDT
"RTN","BPSRPT1",195,0)
 ;
"RTN","BPSRPT1",196,0)
 I BPREF=0 S RDT=$$RXRELDT^BPSRPT6(BPRX)\1
"RTN","BPSRPT1",197,0)
 I BPREF'=0 S RDT=$$REFRELDT^BPSRPT6(BPRX,BPREF)\1
"RTN","BPSRPT1",198,0)
 Q RDT
"RTN","BPSRPT1",199,0)
 ;
"RTN","BPSRPT1",200,0)
 ;Determine if claim was Auto Reversed
"RTN","BPSRPT1",201,0)
 ;
"RTN","BPSRPT1",202,0)
 ; Input Variable: BP59 - Lookup to BPS TRANSACTION (#59)
"RTN","BPSRPT1",203,0)
 ; Return Value -> 1 = Auto Reversed
"RTN","BPSRPT1",204,0)
 ;                 0 = Not Auto Reversed
"RTN","BPSRPT1",205,0)
 ;
"RTN","BPSRPT1",206,0)
AUTOREV(BP59) N AR,BP02
"RTN","BPSRPT1",207,0)
 S BP02=+$P($G(^BPST(BP59,0)),U,4)
"RTN","BPSRPT1",208,0)
 S AR=+$P($G(^BPSC(BP02,0)),U,7)
"RTN","BPSRPT1",209,0)
 Q AR
"RTN","BPSRPT1",210,0)
 ;
"RTN","BPSRPT1",211,0)
 ;Determine if claim was closed
"RTN","BPSRPT1",212,0)
 ;
"RTN","BPSRPT1",213,0)
 ; Input Variable: BP59 - Lookup to BPS TRANSACTION (#59)
"RTN","BPSRPT1",214,0)
 ; Return Value -> 1 = Closed
"RTN","BPSRPT1",215,0)
 ;                 0 = Not Closed
"RTN","BPSRPT1",216,0)
 ;                 
"RTN","BPSRPT1",217,0)
CLSCLM(BP59) N BP02,CL
"RTN","BPSRPT1",218,0)
 S BP02=+$P($G(^BPST(BP59,0)),U,4)
"RTN","BPSRPT1",219,0)
 S CL=+$G(^BPSC(BP02,900))
"RTN","BPSRPT1",220,0)
 Q CL
"RTN","BPSRPT1",221,0)
 ;
"RTN","BPSRPT1",222,0)
 ;Determine whether claim is Realtime or Backbilled
"RTN","BPSRPT1",223,0)
 ;
"RTN","BPSRPT1",224,0)
 ; Input Variable: BP59 - Lookup to BPS TRANSACTION (#59)
"RTN","BPSRPT1",225,0)
 ; Return Value -> 1 = Backbilled
"RTN","BPSRPT1",226,0)
 ;                 0 = Realtime
"RTN","BPSRPT1",227,0)
RTBCK(BP59) N BB
"RTN","BPSRPT1",228,0)
 S BB=$P($G(^BPST(BP59,12)),U)
"RTN","BPSRPT1",229,0)
 S BB=$S(BB="BB":0,1:1)
"RTN","BPSRPT1",230,0)
 Q BB
"RTN","BPSRPT1",231,0)
 ;
"RTN","BPSRPT1",232,0)
 ;Screen Pause 1
"RTN","BPSRPT1",233,0)
 ;
"RTN","BPSRPT1",234,0)
 ; Return variable - BPQ = 0 Continue
"RTN","BPSRPT1",235,0)
 ;                          2 Quit
"RTN","BPSRPT1",236,0)
PAUSE N X
"RTN","BPSRPT1",237,0)
 U IO(0) W !!,"Press RETURN to continue, '^' to exit:"
"RTN","BPSRPT1",238,0)
 R X:$G(DTIME) S:'$T X="^" S:X["^" BPQ=2
"RTN","BPSRPT1",239,0)
 U IO
"RTN","BPSRPT1",240,0)
 Q
"RTN","BPSRPT1",241,0)
 ;
"RTN","BPSRPT1",242,0)
 ;Screen Pause 2
"RTN","BPSRPT1",243,0)
 ;
"RTN","BPSRPT1",244,0)
 ; Return variable - BPQ = 0 Continue
"RTN","BPSRPT1",245,0)
 ;                         2 Quit
"RTN","BPSRPT1",246,0)
PAUSE2 N X
"RTN","BPSRPT1",247,0)
 U IO(0) W !!,"Press RETURN to continue:"
"RTN","BPSRPT1",248,0)
 R X:$G(DTIME) S:'$T X="^" S:X["^" BPQ=2
"RTN","BPSRPT1",249,0)
 U IO
"RTN","BPSRPT1",250,0)
 Q
"RTN","BPSRPT1",251,0)
 ;
"RTN","BPSRPT1",252,0)
 ;Get ECME#
"RTN","BPSRPT1",253,0)
 ;
"RTN","BPSRPT1",254,0)
 ; Input Variable: BP59 - Lookup to BPS TRANSACTION (#59)
"RTN","BPSRPT1",255,0)
 ; Returned value -> Last 7 digits of ECME#
"RTN","BPSRPT1",256,0)
 ; 
"RTN","BPSRPT1",257,0)
ECMENUM(BP59) N BPY1,BPY2
"RTN","BPSRPT1",258,0)
 S BPY1=(BP59\1),BPY2=$E(BPY1,$L(BPY1)-6,99) ;last 7 digits
"RTN","BPSRPT1",259,0)
 Q BPY2
"RTN","BPSRPT1",260,0)
 ;
"RTN","BPSRPT1",261,0)
 ;Convert FM date or date.time to displayable (mm/dd/yy HH:MM) format
"RTN","BPSRPT1",262,0)
 ;
"RTN","BPSRPT1",263,0)
DATTIM(X) N DATE,BPT,BPM,BPH,BPAP
"RTN","BPSRPT1",264,0)
 S DATE=$S(X:$E(X,4,5)_"/"_$E(X,6,7)_"/"_$E(X,2,3),1:"")
"RTN","BPSRPT1",265,0)
 S BPT=$P(X,".",2) S:$L(BPT)<4 BPT=BPT_$E("0000",1,4-$L(BPT))
"RTN","BPSRPT1",266,0)
 S BPH=$E(BPT,1,2),BPM=$E(BPT,3,4)
"RTN","BPSRPT1",267,0)
 S BPAP="AM" I BPH>12 S BPH=BPH-12,BPAP="PM" S:$L(BPH)<2 BPH="0"_BPH
"RTN","BPSRPT1",268,0)
 I BPT S:'BPH BPH=12 S DATE=DATE_" "_BPH_":"_BPM_BPAP
"RTN","BPSRPT1",269,0)
 Q $G(DATE)
"RTN","BPSRPT1",270,0)
 ;
"RTN","BPSRPT1",271,0)
 ;Display RT-Realtime,BB-Backbill, or " "
"RTN","BPSRPT1",272,0)
 ;
"RTN","BPSRPT1",273,0)
RTBCKNAM(BPINDEX) Q $S(BPINDEX=1:"RT",BPINDEX=0:"BB",1:" ")
"RTN","BPSRPT1",274,0)
 ;
"RTN","BPSRPT1",275,0)
 ;See for Specific Reject Code
"RTN","BPSRPT1",276,0)
 ;
"RTN","BPSRPT1",277,0)
CKREJ(BP59,BPREJCD) N FREJ,I,REJ,X
"RTN","BPSRPT1",278,0)
 S FREJ=0
"RTN","BPSRPT1",279,0)
 S X=$$REJTEXT^BPSRPT2(BP59,.REJ)
"RTN","BPSRPT1",280,0)
 S X="" F  S X=$O(REJ(X)) Q:X=""  D  Q:FREJ=1
"RTN","BPSRPT1",281,0)
 .S REJ=$P($G(REJ(X)),":") Q:REJ=""
"RTN","BPSRPT1",282,0)
 .S I="" F  S I=$O(^BPSF(9002313.93,"B",REJ,I)) Q:I=""  I I=BPREJCD S FREJ=1
"RTN","BPSRPT1",283,0)
 Q FREJ
"RTN","BPSRPT3")
0^22^B37506169
"RTN","BPSRPT3",1,0)
BPSRPT3 ;BHAM ISC/BEE - ECME REPORTS ;14-FEB-05
"RTN","BPSRPT3",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,3,5,7**;JUN 2004;Build 46
"RTN","BPSRPT3",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSRPT3",4,0)
 ;
"RTN","BPSRPT3",5,0)
 Q
"RTN","BPSRPT3",6,0)
 ;
"RTN","BPSRPT3",7,0)
 ; Select the ECME Pharmacy or Pharmacies
"RTN","BPSRPT3",8,0)
 ; 
"RTN","BPSRPT3",9,0)
 ; Input Variable -> none
"RTN","BPSRPT3",10,0)
 ; Return Value ->   "" = Valid Entry or Entries Selected
"RTN","BPSRPT3",11,0)
 ;                                        ^ = Exit
"RTN","BPSRPT3",12,0)
 ;                                       
"RTN","BPSRPT3",13,0)
 ; Output Variable -> BPPHARM = 1 One or More Pharmacies Selected
"RTN","BPSRPT3",14,0)
 ;                          = 0 User Entered 'ALL'
"RTN","BPSRPT3",15,0)
 ;                            
"RTN","BPSRPT3",16,0)
 ; If BPPHARM = 1 then the BPPHARM array will be defined where:
"RTN","BPSRPT3",17,0)
 ;    BPPHARM(ptr) = ptr ^ BPS PHARMACY NAME and
"RTN","BPSRPT3",18,0)
 ;    ptr = Internal Pointer to BPS PHARMACIES file (#9002313.56)
"RTN","BPSRPT3",19,0)
 ;                    
"RTN","BPSRPT3",20,0)
SELPHARM() N DIC,DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","BPSRPT3",21,0)
 ;
"RTN","BPSRPT3",22,0)
 ;Reset BPPHARM array
"RTN","BPSRPT3",23,0)
 K BPPHARM
"RTN","BPSRPT3",24,0)
 ;
"RTN","BPSRPT3",25,0)
 ;First see if they want to enter individual divisions or ALL
"RTN","BPSRPT3",26,0)
 S DIR(0)="S^D:DIVISION;A:ALL"
"RTN","BPSRPT3",27,0)
 S DIR("A")="Select Certain Pharmacy (D)ivisions or (A)LL"
"RTN","BPSRPT3",28,0)
 S DIR("L",1)="Select one of the following:"
"RTN","BPSRPT3",29,0)
 S DIR("L",2)=""
"RTN","BPSRPT3",30,0)
 S DIR("L",3)="     D         DIVISION"
"RTN","BPSRPT3",31,0)
 S DIR("L",4)="     A         ALL"
"RTN","BPSRPT3",32,0)
 D ^DIR K DIR
"RTN","BPSRPT3",33,0)
 ;
"RTN","BPSRPT3",34,0)
 ;Check for "^" or timeout, otherwise define BPPHARM
"RTN","BPSRPT3",35,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1) S Y="^"
"RTN","BPSRPT3",36,0)
 E  S BPPHARM=$S(Y="A":0,1:1)
"RTN","BPSRPT3",37,0)
 ;
"RTN","BPSRPT3",38,0)
 ;If division selected, ask prompt
"RTN","BPSRPT3",39,0)
 I $G(BPPHARM)=1 F  D  Q:Y="^"!(Y="") 
"RTN","BPSRPT3",40,0)
 .;
"RTN","BPSRPT3",41,0)
 .;Prompt for entry
"RTN","BPSRPT3",42,0)
 .K X S DIC(0)="QEAM",DIC=9002313.56,DIC("A")="Select ECME Pharmacy Division(s): "
"RTN","BPSRPT3",43,0)
 .W ! D ^DIC
"RTN","BPSRPT3",44,0)
 .;
"RTN","BPSRPT3",45,0)
 .;Check for "^" or timeout 
"RTN","BPSRPT3",46,0)
 .I ($G(DUOUT)=1)!($G(DTOUT)=1) K BPPHARM S Y="^" Q
"RTN","BPSRPT3",47,0)
 .;
"RTN","BPSRPT3",48,0)
 .;Check for blank entry, quit if no previous selections
"RTN","BPSRPT3",49,0)
 .I $G(X)="" S Y=$S($D(BPPHARM)>9:"",1:"^") K:Y="^" BPPHARM Q
"RTN","BPSRPT3",50,0)
 .;
"RTN","BPSRPT3",51,0)
 .;Handle Deletes
"RTN","BPSRPT3",52,0)
 .I $D(BPPHARM(+Y)) D  Q:Y="^"  I 1
"RTN","BPSRPT3",53,0)
 ..N P
"RTN","BPSRPT3",54,0)
 ..S P=Y  ;Save Original Value
"RTN","BPSRPT3",55,0)
 ..S DIR(0)="S^Y:YES;N:NO",DIR("A")="Delete "_$P(P,U,2)_" from your list?"
"RTN","BPSRPT3",56,0)
 ..S DIR("B")="NO" D ^DIR
"RTN","BPSRPT3",57,0)
 ..I ($G(DUOUT)=1)!($G(DTOUT)=1) K BPPHARM S Y="^" Q
"RTN","BPSRPT3",58,0)
 ..I Y="Y" K BPPHARM(+P),BPPHARM("B",$P(P,U,2),+P)
"RTN","BPSRPT3",59,0)
 ..S Y=P  ;Restore Original Value
"RTN","BPSRPT3",60,0)
 ..K P
"RTN","BPSRPT3",61,0)
 .E  D
"RTN","BPSRPT3",62,0)
 ..;Define new entries in BPPHARM array
"RTN","BPSRPT3",63,0)
 ..S BPPHARM(+Y)=Y
"RTN","BPSRPT3",64,0)
 ..S BPPHARM("B",$P(Y,U,2),+Y)=""
"RTN","BPSRPT3",65,0)
 .;
"RTN","BPSRPT3",66,0)
 .;Display a list of selected divisions
"RTN","BPSRPT3",67,0)
 .I $D(BPPHARM)>9 D
"RTN","BPSRPT3",68,0)
 ..N X
"RTN","BPSRPT3",69,0)
 ..W !,?2,"Selected:"
"RTN","BPSRPT3",70,0)
 ..S X="" F  S X=$O(BPPHARM("B",X)) Q:X=""  W !,?10,X
"RTN","BPSRPT3",71,0)
 ..K X
"RTN","BPSRPT3",72,0)
 .Q
"RTN","BPSRPT3",73,0)
 ;
"RTN","BPSRPT3",74,0)
 K BPPHARM("B")
"RTN","BPSRPT3",75,0)
 Q Y
"RTN","BPSRPT3",76,0)
 ;
"RTN","BPSRPT3",77,0)
 ; Display (S)ummary or (D)etail Format
"RTN","BPSRPT3",78,0)
 ; 
"RTN","BPSRPT3",79,0)
 ; Input Variable -> DFLT = 1 Summary
"RTN","BPSRPT3",80,0)
 ;                          2 Detail
"RTN","BPSRPT3",81,0)
 ;                          
"RTN","BPSRPT3",82,0)
 ; Return Value ->   1 = Summary
"RTN","BPSRPT3",83,0)
 ;                   0 = Detail
"RTN","BPSRPT3",84,0)
 ;                   ^ = Exit
"RTN","BPSRPT3",85,0)
 ;
"RTN","BPSRPT3",86,0)
SELSMDET(DFLT) N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","BPSRPT3",87,0)
 S DFLT=$S($G(DFLT)=1:"Summary",$G(DFLT)=0:"Detail",1:"Detail")
"RTN","BPSRPT3",88,0)
 S DIR(0)="S^S:Summary;D:Detail",DIR("A")="Display (S)ummary or (D)etail Format",DIR("B")=DFLT
"RTN","BPSRPT3",89,0)
 D ^DIR
"RTN","BPSRPT3",90,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1) S Y="^"
"RTN","BPSRPT3",91,0)
 S Y=$S(Y="S":1,Y="D":0,1:Y)
"RTN","BPSRPT3",92,0)
 Q Y
"RTN","BPSRPT3",93,0)
 ;
"RTN","BPSRPT3",94,0)
 ; Display (C)MOP or (M)ail or (W)indow or (A)ll
"RTN","BPSRPT3",95,0)
 ; 
"RTN","BPSRPT3",96,0)
 ;    Input Variable -> DFLT = C CMOP
"RTN","BPSRPT3",97,0)
 ;                             W Window
"RTN","BPSRPT3",98,0)
 ;                             M Mail
"RTN","BPSRPT3",99,0)
 ;                             A All
"RTN","BPSRPT3",100,0)
 ;                          
"RTN","BPSRPT3",101,0)
 ;    Return Value ->   C = CMOP
"RTN","BPSRPT3",102,0)
 ;                      W = Window
"RTN","BPSRPT3",103,0)
 ;                      M = Mail
"RTN","BPSRPT3",104,0)
 ;                      A = All
"RTN","BPSRPT3",105,0)
 ;                      ^ = Exit
"RTN","BPSRPT3",106,0)
 ; 
"RTN","BPSRPT3",107,0)
SELMWC(DFLT) N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","BPSRPT3",108,0)
 S DFLT=$S($G(DFLT)="C":"CMOP",$G(DFLT)="W":"Window",$G(DFLT)="M":"Mail",1:"ALL")
"RTN","BPSRPT3",109,0)
 S DIR(0)="S^C:CMOP;M:Mail;W:Window;A:ALL"
"RTN","BPSRPT3",110,0)
 S DIR("A")="Display (C)MOP or (M)ail or (W)indow or (A)LL",DIR("B")=DFLT
"RTN","BPSRPT3",111,0)
 D ^DIR
"RTN","BPSRPT3",112,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1) S Y="^"
"RTN","BPSRPT3",113,0)
 Q Y
"RTN","BPSRPT3",114,0)
 ;
"RTN","BPSRPT3",115,0)
 ; Display (R)ealTime Fills or (B)ackbills or (A)LL
"RTN","BPSRPT3",116,0)
 ;
"RTN","BPSRPT3",117,0)
 ;    Input Variable -> DFLT = 3 Backbill
"RTN","BPSRPT3",118,0)
 ;                             2 Real Time Fills
"RTN","BPSRPT3",119,0)
 ;                             1 ALL
"RTN","BPSRPT3",120,0)
 ;                          
"RTN","BPSRPT3",121,0)
 ;    Return Value ->   3 = Backbill (manually)
"RTN","BPSRPT3",122,0)
 ;                      2 = Real Time Fills (automatically during FINISH)
"RTN","BPSRPT3",123,0)
 ;                      1 = ALL
"RTN","BPSRPT3",124,0)
 ;                      ^ = Exit
"RTN","BPSRPT3",125,0)
 ;
"RTN","BPSRPT3",126,0)
SELRTBCK(DFLT) N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","BPSRPT3",127,0)
 S DFLT=$S($G(DFLT)=2:"Real Time",$G(DFLT)=3:"Backbill",1:"ALL")
"RTN","BPSRPT3",128,0)
 S DIR(0)="S^R:Real Time Fills;B:Backbill;A:ALL"
"RTN","BPSRPT3",129,0)
 S DIR("A")="Display (R)ealTime Fills or (B)ackbills or (A)LL",DIR("B")=DFLT
"RTN","BPSRPT3",130,0)
 D ^DIR
"RTN","BPSRPT3",131,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1) S Y="^"
"RTN","BPSRPT3",132,0)
 S Y=$S(Y="A":1,Y="R":2,Y="B":3,1:Y)
"RTN","BPSRPT3",133,0)
 Q Y
"RTN","BPSRPT3",134,0)
 ;
"RTN","BPSRPT3",135,0)
 ; Display Specific (D)rug or Drug (C)lass
"RTN","BPSRPT3",136,0)
 ; 
"RTN","BPSRPT3",137,0)
 ;    Input Variable -> DFLT = 3 Drug Class
"RTN","BPSRPT3",138,0)
 ;                             2 Drug
"RTN","BPSRPT3",139,0)
 ;                             1 ALL
"RTN","BPSRPT3",140,0)
 ;                          
"RTN","BPSRPT3",141,0)
 ;     Return Value ->   3 = Drug Class
"RTN","BPSRPT3",142,0)
 ;                       2 = Drug
"RTN","BPSRPT3",143,0)
 ;                       1 = ALL
"RTN","BPSRPT3",144,0)
 ;                       ^ = Exit
"RTN","BPSRPT3",145,0)
 ;                       
"RTN","BPSRPT3",146,0)
SELDRGAL(DFLT) N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","BPSRPT3",147,0)
 S DFLT=$S($G(DFLT)=2:"Drug",$G(DFLT)=3:"Drug Class",1:"ALL")
"RTN","BPSRPT3",148,0)
 S DIR(0)="S^D:Drug;C:Drug Class;A:ALL"
"RTN","BPSRPT3",149,0)
 S DIR("A")="Display Specific (D)rug or Drug (C)lass or (A)LL",DIR("B")=DFLT
"RTN","BPSRPT3",150,0)
 D ^DIR
"RTN","BPSRPT3",151,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1) S Y="^"
"RTN","BPSRPT3",152,0)
 S Y=$S(Y="A":1,Y="D":2,Y="C":3,1:Y)
"RTN","BPSRPT3",153,0)
 Q Y
"RTN","BPSRPT3",154,0)
 ;
"RTN","BPSRPT3",155,0)
 ; Select Drug
"RTN","BPSRPT3",156,0)
 ; 
"RTN","BPSRPT3",157,0)
 ; Input Variable -> none
"RTN","BPSRPT3",158,0)
 ; 
"RTN","BPSRPT3",159,0)
 ; Return Value -> ptr = pointer to DRUG file (#50)
"RTN","BPSRPT3",160,0)
 ;                   ^ = Exit
"RTN","BPSRPT3",161,0)
 ;                   
"RTN","BPSRPT3",162,0)
SELDRG() N DIC,DIRUT,DUOUT,X,Y
"RTN","BPSRPT3",163,0)
 ;
"RTN","BPSRPT3",164,0)
 ;Prompt for entry
"RTN","BPSRPT3",165,0)
 W ! D SELDRG^BPSRPT6
"RTN","BPSRPT3",166,0)
 ;
"RTN","BPSRPT3",167,0)
 ;Check for "^", timeout, or blank entry
"RTN","BPSRPT3",168,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1) S Y="^"
"RTN","BPSRPT3",169,0)
 ;
"RTN","BPSRPT3",170,0)
 ;Check for Valid Entry
"RTN","BPSRPT3",171,0)
 I +Y>0 S Y=+Y
"RTN","BPSRPT3",172,0)
 ;
"RTN","BPSRPT3",173,0)
 Q Y
"RTN","BPSRPT3",174,0)
 ;
"RTN","BPSRPT3",175,0)
 ; Select Drug Class
"RTN","BPSRPT3",176,0)
 ; 
"RTN","BPSRPT3",177,0)
 ; Input Variable -> none
"RTN","BPSRPT3",178,0)
 ; 
"RTN","BPSRPT3",179,0)
 ; Return Value -> ptr = pointer to VA DRUG CLASS file (#50.605)
"RTN","BPSRPT3",180,0)
 ;                   ^ = Exit
"RTN","BPSRPT3",181,0)
 ;
"RTN","BPSRPT3",182,0)
SELDRGCL() N DIC,DIRUT,DUOUT,Y
"RTN","BPSRPT3",183,0)
 ;
"RTN","BPSRPT3",184,0)
 ;Prompt for entry
"RTN","BPSRPT3",185,0)
 W ! D SELDRGC^BPSRPT6
"RTN","BPSRPT3",186,0)
 ;
"RTN","BPSRPT3",187,0)
 ;Check for "^", timeout, or blank entry
"RTN","BPSRPT3",188,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(Y)="") S Y="^"
"RTN","BPSRPT3",189,0)
 ;
"RTN","BPSRPT3",190,0)
 Q Y
"RTN","BPSRPT3",191,0)
 ;
"RTN","BPSRPT3",192,0)
 ; Enter Date Range
"RTN","BPSRPT3",193,0)
 ;
"RTN","BPSRPT3",194,0)
 ; Input Variable -> TYPE = 7 CLOSE REPORT
"RTN","BPSRPT3",195,0)
 ;                          1-6 OTHER REPORTS
"RTN","BPSRPT3",196,0)
 ;
"RTN","BPSRPT3",197,0)
 ; Return Value -> P1^P2
"RTN","BPSRPT3",198,0)
 ; 
"RTN","BPSRPT3",199,0)
 ;           where P1 = From Date
"RTN","BPSRPT3",200,0)
 ;                    = ^ Exit
"RTN","BPSRPT3",201,0)
 ;                 P2 = To Date
"RTN","BPSRPT3",202,0)
 ;                    = blank for Exit
"RTN","BPSRPT3",203,0)
 ;                 
"RTN","BPSRPT3",204,0)
SELDATE(TYPE) N BPSIBDT,DIR,DIRUT,DTOUT,DUOUT,VAL,X,Y
"RTN","BPSRPT3",205,0)
 S TYPE=$S($G(TYPE)=7:"CLOSE",1:"TRANSACTION")
"RTN","BPSRPT3",206,0)
SELDATE1 S VAL="",DIR(0)="DA^:DT:EX",DIR("A")="START WITH "_TYPE_" DATE: ",DIR("B")="T-1"
"RTN","BPSRPT3",207,0)
 W ! D ^DIR
"RTN","BPSRPT3",208,0)
 ;
"RTN","BPSRPT3",209,0)
 ;Check for "^", timeout, or blank entry
"RTN","BPSRPT3",210,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(X)="") S VAL="^"
"RTN","BPSRPT3",211,0)
 ;
"RTN","BPSRPT3",212,0)
 I VAL="" D
"RTN","BPSRPT3",213,0)
 .S $P(VAL,U)=Y
"RTN","BPSRPT3",214,0)
 .S DIR(0)="DA^"_VAL_":DT:EX",DIR("A")="  GO TO "_TYPE_" DATE: ",DIR("B")="T"
"RTN","BPSRPT3",215,0)
 .D ^DIR
"RTN","BPSRPT3",216,0)
 .;
"RTN","BPSRPT3",217,0)
 .;Check for "^", timeout, or blank entry
"RTN","BPSRPT3",218,0)
 .I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(X)="") S VAL="^" Q
"RTN","BPSRPT3",219,0)
 .;
"RTN","BPSRPT3",220,0)
 .;Define Entry
"RTN","BPSRPT3",221,0)
 .S $P(VAL,U,2)=Y
"RTN","BPSRPT3",222,0)
 ;
"RTN","BPSRPT3",223,0)
 Q VAL
"RTN","BPSRPT3",224,0)
 ;
"RTN","BPSRPT3",225,0)
 ; Select to Include Eligibility of (V)eteran, (T)ricare, or (A)ll
"RTN","BPSRPT3",226,0)
 ; 
"RTN","BPSRPT3",227,0)
 ; Input Variable -> DFLT = 0 = All
"RTN","BPSRPT3",228,0)
 ;                          1 = Veteran
"RTN","BPSRPT3",229,0)
 ;                          2 = Tricare
"RTN","BPSRPT3",230,0)
 ;                          3 = ChampVA (Reserved for future use)
"RTN","BPSRPT3",231,0)
 ; 
"RTN","BPSRPT3",232,0)
 ; Return Value ->  V, T, or 0 for All
"RTN","BPSRPT3",233,0)
SELELIG(DFLT) N DIC,DIR,DIRUT,DUOUT,X,Y
"RTN","BPSRPT3",234,0)
 ;
"RTN","BPSRPT3",235,0)
 S DFLT=$S($G(DFLT)=1:"V",$G(DFLT)=2:"T",$G(DFLT)=3:"C",1:"A")
"RTN","BPSRPT3",236,0)
 S DIR(0)="S^V:VETERAN;T:TRICARE;A:ALL"
"RTN","BPSRPT3",237,0)
 S DIR("A")="Include Certain Eligibility Type or (A)ll",DIR("B")=DFLT
"RTN","BPSRPT3",238,0)
 D ^DIR
"RTN","BPSRPT3",239,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1) S Y="^"
"RTN","BPSRPT3",240,0)
 ;
"RTN","BPSRPT3",241,0)
 S Y=$S(Y="A":0,1:Y)
"RTN","BPSRPT3",242,0)
 Q Y
"RTN","BPSRPT3",243,0)
 ;
"RTN","BPSRPT3",244,0)
 ; Select to Include Open or Closed or All claims
"RTN","BPSRPT3",245,0)
 ; 
"RTN","BPSRPT3",246,0)
 ; Input Variable -> DFLT = 0 = All
"RTN","BPSRPT3",247,0)
 ;                          1 = Closed
"RTN","BPSRPT3",248,0)
 ;                          2 = Open
"RTN","BPSRPT3",249,0)
 ; 
"RTN","BPSRPT3",250,0)
 ; Return Value -> 0 = All, 1 = Closed, 2 = Open
"RTN","BPSRPT3",251,0)
SELOPCL(DFLT) N DIC,DIR,DIRUT,DUOUT,X,Y
"RTN","BPSRPT3",252,0)
 ;
"RTN","BPSRPT3",253,0)
 S DFLT=$S($G(DFLT)=1:"C",$G(DFLT)=2:"O",1:"A")
"RTN","BPSRPT3",254,0)
 S DIR(0)="S^O:OPEN;C:CLOSED;A:ALL"
"RTN","BPSRPT3",255,0)
 S DIR("A")="Include (O)pen, (C)losed, or (A)ll Claims",DIR("B")=DFLT
"RTN","BPSRPT3",256,0)
 D ^DIR
"RTN","BPSRPT3",257,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1) S Y="^"
"RTN","BPSRPT3",258,0)
 ;
"RTN","BPSRPT3",259,0)
 S Y=$S(Y="C":1,Y="O":2,1:0)
"RTN","BPSRPT3",260,0)
 Q Y
"RTN","BPSRPT3",261,0)
 ;
"RTN","BPSRPT4")
0^23^B67405446
"RTN","BPSRPT4",1,0)
BPSRPT4 ;BHAM ISC/BEE - ECME REPORTS (CONT) ;14-FEB-05
"RTN","BPSRPT4",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5,7**;JUN 2004;Build 46
"RTN","BPSRPT4",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSRPT4",4,0)
 ;
"RTN","BPSRPT4",5,0)
 Q
"RTN","BPSRPT4",6,0)
 ;
"RTN","BPSRPT4",7,0)
 ; Include Rxs - (R)ELEASED or (N)OT RELEASED or (A)LL
"RTN","BPSRPT4",8,0)
 ;
"RTN","BPSRPT4",9,0)
 ;    Input Variable -> DFLT = 3 NOT RELEASED
"RTN","BPSRPT4",10,0)
 ;                             2 RELEASED
"RTN","BPSRPT4",11,0)
 ;                             1 ALL
"RTN","BPSRPT4",12,0)
 ;                          
"RTN","BPSRPT4",13,0)
 ;    Return Value ->   3 = NOT RELEASED
"RTN","BPSRPT4",14,0)
 ;                      2 = RELEASED
"RTN","BPSRPT4",15,0)
 ;                      1 = ALL
"RTN","BPSRPT4",16,0)
 ;                      ^ = Exit
"RTN","BPSRPT4",17,0)
 ;
"RTN","BPSRPT4",18,0)
SELRLNRL(DFLT) N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","BPSRPT4",19,0)
 S DFLT=$S($G(DFLT)=1:"ALL",$G(DFLT)=3:"NOT RELEASED",1:"RELEASED")
"RTN","BPSRPT4",20,0)
 S DIR(0)="S^R:RELEASED;N:NOT RELEASED;A:ALL"
"RTN","BPSRPT4",21,0)
 S DIR("A")="Include Rxs - (R)ELEASED or (N)OT RELEASED or (A)LL",DIR("B")=DFLT
"RTN","BPSRPT4",22,0)
 D ^DIR
"RTN","BPSRPT4",23,0)
 ;
"RTN","BPSRPT4",24,0)
 ;Check for "^", timeout, or blank entry
"RTN","BPSRPT4",25,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(X)="") S Y="^"
"RTN","BPSRPT4",26,0)
 ;
"RTN","BPSRPT4",27,0)
 S Y=$S(Y="A":1,Y="R":2,Y="N":3,1:Y)
"RTN","BPSRPT4",28,0)
 ;
"RTN","BPSRPT4",29,0)
 Q Y
"RTN","BPSRPT4",30,0)
 ;
"RTN","BPSRPT4",31,0)
 ; Select to Include (S)pecific Reject Code or (A)ll
"RTN","BPSRPT4",32,0)
 ;
"RTN","BPSRPT4",33,0)
 ; Input Variable -> DFLT = 1 Specific Reject Code
"RTN","BPSRPT4",34,0)
 ;                          0 All Reject Codes
"RTN","BPSRPT4",35,0)
 ;                          
"RTN","BPSRPT4",36,0)
 ; Return Value ->   ptr = pointer to BPS NCPDP REJECT CODES (#9002313.93)
"RTN","BPSRPT4",37,0)
 ;                     0 = All Reject Codes
"RTN","BPSRPT4",38,0)
 ;                     ^ = Exit
"RTN","BPSRPT4",39,0)
 ;
"RTN","BPSRPT4",40,0)
SELREJCD(DFLT) N DIC,DIR,DIRUT,DUOUT,REJ,X,Y
"RTN","BPSRPT4",41,0)
 ;
"RTN","BPSRPT4",42,0)
 S DFLT=$S($G(DFLT)=1:"Specific Reject Code",1:"ALL")
"RTN","BPSRPT4",43,0)
 S DIR(0)="S^S:Specific Reject Code;A:ALL"
"RTN","BPSRPT4",44,0)
 S DIR("A")="Include (S)pecific Reject Code or (A)LL",DIR("B")=DFLT
"RTN","BPSRPT4",45,0)
 D ^DIR
"RTN","BPSRPT4",46,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1) S Y="^"
"RTN","BPSRPT4",47,0)
 S REJ=$S(Y="S":1,Y="A":0,1:Y)
"RTN","BPSRPT4",48,0)
 ;
"RTN","BPSRPT4",49,0)
 ;Check for "^" or timeout
"RTN","BPSRPT4",50,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1) S (REJ,Y)="^"
"RTN","BPSRPT4",51,0)
 ;
"RTN","BPSRPT4",52,0)
 ;If Specific Reject Code selected, ask prompt
"RTN","BPSRPT4",53,0)
 I $G(REJ)=1 D
"RTN","BPSRPT4",54,0)
 .;
"RTN","BPSRPT4",55,0)
 .;Prompt for entry
"RTN","BPSRPT4",56,0)
 .K X S DIC(0)="QEAM",DIC=9002313.93,DIC("A")="Select Reject Code: "
"RTN","BPSRPT4",57,0)
 .W ! D ^DIC
"RTN","BPSRPT4",58,0)
 .;
"RTN","BPSRPT4",59,0)
 .;Check for "^", timeout, or blank entry
"RTN","BPSRPT4",60,0)
 .I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(X)="") S (REJ,Y)="^" Q
"RTN","BPSRPT4",61,0)
 .;
"RTN","BPSRPT4",62,0)
 .;If valid entry, setup REJ
"RTN","BPSRPT4",63,0)
 .I +Y>0 S REJ=+Y
"RTN","BPSRPT4",64,0)
 ;
"RTN","BPSRPT4",65,0)
 Q REJ
"RTN","BPSRPT4",66,0)
 ;
"RTN","BPSRPT4",67,0)
 ; Include Auto(R)eversed or (A)LL
"RTN","BPSRPT4",68,0)
 ; 
"RTN","BPSRPT4",69,0)
 ;    Input Variable -> DFLT = 1 AutoReversed
"RTN","BPSRPT4",70,0)
 ;                             0 ALL
"RTN","BPSRPT4",71,0)
 ;                          
"RTN","BPSRPT4",72,0)
 ;    Return Value ->   1 = AutoReversed
"RTN","BPSRPT4",73,0)
 ;                      0 = ALL
"RTN","BPSRPT4",74,0)
 ;                      ^ = Exit
"RTN","BPSRPT4",75,0)
 ;
"RTN","BPSRPT4",76,0)
SELAUREV(DFLT) N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","BPSRPT4",77,0)
 ;
"RTN","BPSRPT4",78,0)
 S DFLT=$S($G(DFLT)=1:"AutoReversed",1:"ALL")
"RTN","BPSRPT4",79,0)
 S DIR(0)="S^R:AutoReversed;A:ALL"
"RTN","BPSRPT4",80,0)
 S DIR("A")="Include Auto(R)eversed or (A)LL",DIR("B")=DFLT
"RTN","BPSRPT4",81,0)
 D ^DIR
"RTN","BPSRPT4",82,0)
 ;
"RTN","BPSRPT4",83,0)
 ;Check for "^", timeout, or blank entry
"RTN","BPSRPT4",84,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(X)="") S Y="^"
"RTN","BPSRPT4",85,0)
 ;
"RTN","BPSRPT4",86,0)
 S Y=$S(Y="A":0,Y="R":1,1:Y)
"RTN","BPSRPT4",87,0)
 ;
"RTN","BPSRPT4",88,0)
 Q Y
"RTN","BPSRPT4",89,0)
 ;
"RTN","BPSRPT4",90,0)
 ; Include A(C)cepted or (R)ejected or (A)LL
"RTN","BPSRPT4",91,0)
 ; 
"RTN","BPSRPT4",92,0)
 ;    Input Variable -> DFLT = 2 Accepted
"RTN","BPSRPT4",93,0)
 ;                             1 Rejected
"RTN","BPSRPT4",94,0)
 ;                             0 ALL
"RTN","BPSRPT4",95,0)
 ;                          
"RTN","BPSRPT4",96,0)
 ;    Return Value ->   2 = Accepted
"RTN","BPSRPT4",97,0)
 ;                      1 = Rejected
"RTN","BPSRPT4",98,0)
 ;                      0 = ALL
"RTN","BPSRPT4",99,0)
 ;                      ^ = Exit
"RTN","BPSRPT4",100,0)
 ;
"RTN","BPSRPT4",101,0)
SELACREJ(DFLT) N DIR,DIRUT,DTOUT,DUOUT,X,Y
"RTN","BPSRPT4",102,0)
 ;
"RTN","BPSRPT4",103,0)
 S DFLT=$S($G(DFLT)=2:"Accepted",$G(DFLT)=1:"Rejected",1:"ALL")
"RTN","BPSRPT4",104,0)
 S DIR(0)="S^C:Accepted;R:Rejected;A:ALL"
"RTN","BPSRPT4",105,0)
 S DIR("A")="Include A(C)cepted or (R)ejected or (A)LL",DIR("B")=DFLT
"RTN","BPSRPT4",106,0)
 D ^DIR
"RTN","BPSRPT4",107,0)
 ;
"RTN","BPSRPT4",108,0)
 ;Check for "^", timeout, or blank entry
"RTN","BPSRPT4",109,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(X)="") S Y="^"
"RTN","BPSRPT4",110,0)
 ;
"RTN","BPSRPT4",111,0)
 S Y=$S(Y="C":2,Y="R":1,Y="A":0,1:Y)
"RTN","BPSRPT4",112,0)
 ;
"RTN","BPSRPT4",113,0)
 Q Y
"RTN","BPSRPT4",114,0)
 ;
"RTN","BPSRPT4",115,0)
 ; Select to Include (S)pecific Close Claim Reason or (A)ll
"RTN","BPSRPT4",116,0)
 ;
"RTN","BPSRPT4",117,0)
 ; Input Variable -> DFLT = 1 Specific CLAIMS TRACKING NON-BILLABLE REASONS
"RTN","BPSRPT4",118,0)
 ;                          0 All Reasons
"RTN","BPSRPT4",119,0)
 ;                          
"RTN","BPSRPT4",120,0)
 ; Return Value ->   ptr = pointer to CLAIMS TRACKING NON-BILLABLE REASONS (#356.8)
"RTN","BPSRPT4",121,0)
 ;                     0 = All Reasons
"RTN","BPSRPT4",122,0)
 ;                     ^ = Exit
"RTN","BPSRPT4",123,0)
 ;
"RTN","BPSRPT4",124,0)
SELCCRSN(DFLT) N DIC,DIR,DIRUT,DUOUT,RSN,X,Y
"RTN","BPSRPT4",125,0)
 ;
"RTN","BPSRPT4",126,0)
 S DFLT=$S($G(DFLT)=1:"Specific Close Claim Reason",1:"ALL")
"RTN","BPSRPT4",127,0)
 S DIR(0)="S^S:Specific Close Claim Reason;A:ALL"
"RTN","BPSRPT4",128,0)
 S DIR("A")="Include (S)pecific Close Claim Reason or (A)LL",DIR("B")=DFLT
"RTN","BPSRPT4",129,0)
 D ^DIR
"RTN","BPSRPT4",130,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1) S Y="^"
"RTN","BPSRPT4",131,0)
 S RSN=$S(Y="S":1,Y="A":0,1:Y)
"RTN","BPSRPT4",132,0)
 ;
"RTN","BPSRPT4",133,0)
 ;Check for "^" or timeout
"RTN","BPSRPT4",134,0)
 I ($G(DUOUT)=1)!($G(DTOUT)=1) S (RSN,Y)="^"
"RTN","BPSRPT4",135,0)
 ;
"RTN","BPSRPT4",136,0)
 ;If Specific Reject Code selected, ask prompt
"RTN","BPSRPT4",137,0)
 I $G(RSN)=1 D
"RTN","BPSRPT4",138,0)
 .;
"RTN","BPSRPT4",139,0)
 .;Prompt for entry
"RTN","BPSRPT4",140,0)
 .K X S DIC(0)="QEAM",DIC=356.8,DIC("A")="Select Close Claim Reason: "
"RTN","BPSRPT4",141,0)
 .W ! D ^DIC
"RTN","BPSRPT4",142,0)
 .;
"RTN","BPSRPT4",143,0)
 .;Check for "^", timeout, or blank entry
"RTN","BPSRPT4",144,0)
 .I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(X)="") S (RSN,Y)="^" Q
"RTN","BPSRPT4",145,0)
 .;
"RTN","BPSRPT4",146,0)
 .;If valid entry, setup RSN
"RTN","BPSRPT4",147,0)
 .I +Y>0 S RSN=+Y
"RTN","BPSRPT4",148,0)
 ;
"RTN","BPSRPT4",149,0)
 Q RSN
"RTN","BPSRPT4",150,0)
 ;
"RTN","BPSRPT4",151,0)
 ;Pull Selected BPS Pharmacies for Display
"RTN","BPSRPT4",152,0)
 ;
"RTN","BPSRPT4",153,0)
 ;  Input Variables: 
"RTN","BPSRPT4",154,0)
 ;  BPPHARM/BPPHARM(ptr) - Set to 0 for all pharmacies, if set to 1 array of internal
"RTN","BPSRPT4",155,0)
 ;                         pointers of selected pharmacies       
"RTN","BPSRPT4",156,0)
 ;                       - BPLEN = The length of the display field
"RTN","BPSRPT4",157,0)
 ;  Returned value -> List of selected BPS Pharmacies (possibly cut short)                 
"RTN","BPSRPT4",158,0)
 ; 
"RTN","BPSRPT4",159,0)
GETDIVS(BPLEN,BPPHARM) N BPDIV,BPSTR,BPQUIT
"RTN","BPSRPT4",160,0)
 I $G(BPPHARM)=0 S BPSTR="ALL"
"RTN","BPSRPT4",161,0)
 E  D
"RTN","BPSRPT4",162,0)
 .S BPDIV="",BPQUIT=0,BPSTR=""
"RTN","BPSRPT4",163,0)
 .F  S BPDIV=$O(BPPHARM(BPDIV)) Q:+BPDIV=0  D  Q:BPQUIT=1
"RTN","BPSRPT4",164,0)
 .. I $L(BPSTR_$$DIVNAME^BPSSCRDS(BPDIV))>(BPLEN-4) D  S BPQUIT=1 Q
"RTN","BPSRPT4",165,0)
 ... S BPSTR=$$LJ^BPSSCR02(BPSTR_",...",BPLEN)
"RTN","BPSRPT4",166,0)
 .. S BPSTR=BPSTR_$S(BPSTR]"":", ",1:"")_$$DIVNAME^BPSSCRDS(BPDIV)
"RTN","BPSRPT4",167,0)
 Q BPSTR
"RTN","BPSRPT4",168,0)
 ;
"RTN","BPSRPT4",169,0)
 ;Get the Reject Code
"RTN","BPSRPT4",170,0)
 ;
"RTN","BPSRPT4",171,0)
 ; Input variable -> 0 for All Reject Codes or
"RTN","BPSRPT4",172,0)
 ;                   lookup to BPS NCPDP REJECT CODES (#9002313.93)
"RTN","BPSRPT4",173,0)
 ; Returned value -> ALL or the selected Reject Code
"RTN","BPSRPT4",174,0)
 ; 
"RTN","BPSRPT4",175,0)
GETREJ(REJ) ;
"RTN","BPSRPT4",176,0)
 I REJ="0" S REJ="ALL"
"RTN","BPSRPT4",177,0)
 E  S REJ=$P($G(^BPSF(9002313.93,+REJ,0)),U,2)
"RTN","BPSRPT4",178,0)
 Q REJ
"RTN","BPSRPT4",179,0)
 ;
"RTN","BPSRPT4",180,0)
 ;Print Header 2 Line 1
"RTN","BPSRPT4",181,0)
 ;
"RTN","BPSRPT4",182,0)
 ; Input variable: BPRTYPE -> Report Type (1-7)
"RTN","BPSRPT4",183,0)
 ;
"RTN","BPSRPT4",184,0)
HEADLN1(BPRTYPE) ;
"RTN","BPSRPT4",185,0)
 I (",1,2,3,4,5,7,")[BPRTYPE W !,"PATIENT NAME",?27,"Pt.ID",?35,"RX#",?47,"REF/ECME#"
"RTN","BPSRPT4",186,0)
 I (BPRTYPE=1)!(BPRTYPE=4) D  Q
"RTN","BPSRPT4",187,0)
 . W ?68,"DATE"
"RTN","BPSRPT4",188,0)
 . W ?78,$J("$BILLED",10)
"RTN","BPSRPT4",189,0)
 . W ?97,$J("$INS RESPONSE",13)
"RTN","BPSRPT4",190,0)
 . W ?122,$J("$COLLECT",10)
"RTN","BPSRPT4",191,0)
 ;
"RTN","BPSRPT4",192,0)
 I BPRTYPE=2 D  Q
"RTN","BPSRPT4",193,0)
 . W ?68,"DATE"
"RTN","BPSRPT4",194,0)
 . W ?78,"RELEASED ON"
"RTN","BPSRPT4",195,0)
 . W ?91,"RX INFO"
"RTN","BPSRPT4",196,0)
 . W ?109,"OPEN/CLOSED"
"RTN","BPSRPT4",197,0)
 . W ?124,"ELIG"
"RTN","BPSRPT4",198,0)
 ;
"RTN","BPSRPT4",199,0)
 I BPRTYPE=3 D  Q
"RTN","BPSRPT4",200,0)
 . W ?68,"DATE"
"RTN","BPSRPT4",201,0)
 . W ?100,$J("$BILLED",10)
"RTN","BPSRPT4",202,0)
 . W ?119,$J("$INS RESPONSE",13)
"RTN","BPSRPT4",203,0)
 ;
"RTN","BPSRPT4",204,0)
 I BPRTYPE=5 D  Q
"RTN","BPSRPT4",205,0)
 . W ?60,"COMPLETED"
"RTN","BPSRPT4",206,0)
 . W ?78,"TRANS TYPE"
"RTN","BPSRPT4",207,0)
 . W ?95,"PAYER RESPONSE"
"RTN","BPSRPT4",208,0)
 ;
"RTN","BPSRPT4",209,0)
 I BPRTYPE=6 D  Q
"RTN","BPSRPT4",210,0)
 . W !,?33,$J("AMOUNT",17)
"RTN","BPSRPT4",211,0)
 . W ?51,$J("RETURNED",17)
"RTN","BPSRPT4",212,0)
 . W ?69,$J("RETURNED",17)
"RTN","BPSRPT4",213,0)
 . W ?87,$J("AMOUNT",17)
"RTN","BPSRPT4",214,0)
 ;
"RTN","BPSRPT4",215,0)
 I BPRTYPE=7 D  Q
"RTN","BPSRPT4",216,0)
 . W ?65,"RX INFO"
"RTN","BPSRPT4",217,0)
 . W ?87,"DRUG"
"RTN","BPSRPT4",218,0)
 . W ?121,"NDC"
"RTN","BPSRPT4",219,0)
 Q
"RTN","BPSRPT4",220,0)
 ;
"RTN","BPSRPT4",221,0)
 ;Print Header 2 Line 2
"RTN","BPSRPT4",222,0)
 ;
"RTN","BPSRPT4",223,0)
 ; Input variable: BPRTYPE -> Report Type (1-7)
"RTN","BPSRPT4",224,0)
 ; 
"RTN","BPSRPT4",225,0)
HEADLN2(BPRTYPE) ;
"RTN","BPSRPT4",226,0)
 I (BPRTYPE=1)!(BPRTYPE=4) D  Q
"RTN","BPSRPT4",227,0)
 . W !,?4,"DRUG"
"RTN","BPSRPT4",228,0)
 . W ?36,"NDC"
"RTN","BPSRPT4",229,0)
 . I BPRTYPE=1 W ?47,"RELEASED ON"
"RTN","BPSRPT4",230,0)
 . W ?68,"RX INFO"
"RTN","BPSRPT4",231,0)
 . I BPRTYPE=1 W ?122,$J("BILL#",10)
"RTN","BPSRPT4",232,0)
 ;
"RTN","BPSRPT4",233,0)
 I BPRTYPE=2 D  Q
"RTN","BPSRPT4",234,0)
 . W !,?3,"CARDHOLD.ID"
"RTN","BPSRPT4",235,0)
 . W ?31,"GROUP ID"
"RTN","BPSRPT4",236,0)
 . W ?41,$J("$BILLED",10)
"RTN","BPSRPT4",237,0)
 . W ?54,"QTY"
"RTN","BPSRPT4",238,0)
 . W ?61,"NDC#"
"RTN","BPSRPT4",239,0)
 . W ?82,"DRUG"
"RTN","BPSRPT4",240,0)
 ;
"RTN","BPSRPT4",241,0)
 I BPRTYPE=3 D  Q
"RTN","BPSRPT4",242,0)
 . W !,?4,"DRUG"
"RTN","BPSRPT4",243,0)
 . W ?43,"NDC"
"RTN","BPSRPT4",244,0)
 . W ?68,"RX INFO"
"RTN","BPSRPT4",245,0)
 ;
"RTN","BPSRPT4",246,0)
 I BPRTYPE=5 D  Q
"RTN","BPSRPT4",247,0)
 . W !,?4,"DRUG"
"RTN","BPSRPT4",248,0)
 . W ?32,"NDC"
"RTN","BPSRPT4",249,0)
 . W ?47,"RX INFO"
"RTN","BPSRPT4",250,0)
 . W ?69,"INSURANCE"
"RTN","BPSRPT4",251,0)
 . W ?112,"ELAP TIME IN SECONDS"
"RTN","BPSRPT4",252,0)
 ;
"RTN","BPSRPT4",253,0)
 I BPRTYPE=6 D  Q
"RTN","BPSRPT4",254,0)
 .W !,?1,"DATE"
"RTN","BPSRPT4",255,0)
 .W ?15,$J("#CLAIMS",17)
"RTN","BPSRPT4",256,0)
 .W ?33,$J("SUBMITTED",17)
"RTN","BPSRPT4",257,0)
 .W ?51,$J("REJECTED",17)
"RTN","BPSRPT4",258,0)
 .W ?69,$J("PAYABLE",17)
"RTN","BPSRPT4",259,0)
 .W ?87,$J("TO RECEIVE",17)
"RTN","BPSRPT4",260,0)
 .W ?115,$J("DIFFERENCE",17)
"RTN","BPSRPT4",261,0)
 ;
"RTN","BPSRPT4",262,0)
 I BPRTYPE=7 D  Q
"RTN","BPSRPT4",263,0)
 . W !,?3,"CARDHOLD.ID"
"RTN","BPSRPT4",264,0)
 . W ?31,"GROUP ID"
"RTN","BPSRPT4",265,0)
 . W ?41,"CLOSE DATE/TIME"
"RTN","BPSRPT4",266,0)
 . W ?59,"CLOSED BY"
"RTN","BPSRPT4",267,0)
 . W ?87,"CLOSE REASON"
"RTN","BPSRPT4",268,0)
 Q
"RTN","BPSRPT4",269,0)
 ;
"RTN","BPSRPT4",270,0)
 ;Print Header 2 Line 3
"RTN","BPSRPT4",271,0)
 ;
"RTN","BPSRPT4",272,0)
 ; Input variable: BPRTYPE -> Report Type (1-7)
"RTN","BPSRPT4",273,0)
 ; 
"RTN","BPSRPT4",274,0)
HEADLN3(BPTYP) ;
"RTN","BPSRPT4",275,0)
 D:BPTYP=4
"RTN","BPSRPT4",276,0)
 . W !,?6,"RELEASED ON"
"RTN","BPSRPT4",277,0)
 . W ?22,"REVERSAL METHOD/RETURN STATUS/REASON"
"RTN","BPSRPT4",278,0)
 Q
"RTN","BPSRPT4",279,0)
 ;
"RTN","BPSRPT4",280,0)
SELEXCEL() ; - Returns whether to capture data for Excel report.
"RTN","BPSRPT4",281,0)
 ; Output: EXCEL = 1 - YES (capture data) / 0 - NO (DO NOT capture data)
"RTN","BPSRPT4",282,0)
 ;
"RTN","BPSRPT4",283,0)
 N EXCEL,DIR,DIRUT,DTOUT,DUOUT,DIROUT
"RTN","BPSRPT4",284,0)
 ;
"RTN","BPSRPT4",285,0)
 S DIR(0)="Y",DIR("B")="NO",DIR("T")=DTIME W !
"RTN","BPSRPT4",286,0)
 S DIR("A")="Do you want to capture report data for an Excel document"
"RTN","BPSRPT4",287,0)
 S DIR("?")="^D HEXC^BPSRPT4"
"RTN","BPSRPT4",288,0)
 D ^DIR K DIR I $D(DIRUT)!$D(DTOUT)!$D(DUOUT)!$D(DIROUT) Q "^"
"RTN","BPSRPT4",289,0)
 K DIROUT,DTOUT,DUOUT,DIRUT
"RTN","BPSRPT4",290,0)
 S EXCEL=0 I Y S EXCEL=1
"RTN","BPSRPT4",291,0)
 ;
"RTN","BPSRPT4",292,0)
 ;Display Excel display message
"RTN","BPSRPT4",293,0)
 I EXCEL=1 D EXMSG
"RTN","BPSRPT4",294,0)
 ;
"RTN","BPSRPT4",295,0)
 Q EXCEL
"RTN","BPSRPT4",296,0)
 ;
"RTN","BPSRPT4",297,0)
HEXC ; - 'Do you want to capture data...' prompt
"RTN","BPSRPT4",298,0)
 W !!,"      Enter:  'Y'    -  To capture detail report data to transfer"
"RTN","BPSRPT4",299,0)
 W !,"                        to an Excel document"
"RTN","BPSRPT4",300,0)
 W !,"              '<CR>' -  To skip this option"
"RTN","BPSRPT4",301,0)
 W !,"              '^'    -  To quit this option"
"RTN","BPSRPT4",302,0)
 Q
"RTN","BPSRPT4",303,0)
 ;
"RTN","BPSRPT4",304,0)
 ;Display the message about capturing to an Excel file format
"RTN","BPSRPT4",305,0)
 ; 
"RTN","BPSRPT4",306,0)
EXMSG ;
"RTN","BPSRPT4",307,0)
 W !!?5,"Before continuing, please set up your terminal to capture the"
"RTN","BPSRPT4",308,0)
 W !?5,"detail report data. On some terminals, this can  be  done  by"
"RTN","BPSRPT4",309,0)
 W !?5,"clicking  on the 'Tools' menu above, then click  on  'Capture"
"RTN","BPSRPT4",310,0)
 W !?5,"Incoming  Data' to save to  Desktop. This  report  may take a"
"RTN","BPSRPT4",311,0)
 W !?5,"while to run."
"RTN","BPSRPT4",312,0)
 W !!?5,"Note: To avoid  undesired  wrapping of the data  saved to the"
"RTN","BPSRPT4",313,0)
 W !?5,"      file, please enter '0;256;999' at the 'DEVICE:' prompt.",!
"RTN","BPSRPT4",314,0)
 Q
"RTN","BPSRPT5")
0^24^B72711123
"RTN","BPSRPT5",1,0)
BPSRPT5 ;BHAM ISC/BEE - ECME REPORTS ;14-FEB-05
"RTN","BPSRPT5",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,3,5,7**;JUN 2004;Build 46
"RTN","BPSRPT5",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSRPT5",4,0)
 ;
"RTN","BPSRPT5",5,0)
 ;Routine to Display the Reports
"RTN","BPSRPT5",6,0)
 ;
"RTN","BPSRPT5",7,0)
 ;Print Report Line 1
"RTN","BPSRPT5",8,0)
WRLINE1(BPRTYPE,BPREC,BPDIV,BPGRPLAN,BPDFN,BPRX,BPREF,BPX,BPSRTDT,BPBIL,BPINS,BPCOLL,BPEXCEL) ;
"RTN","BPSRPT5",9,0)
 ;Excel Output
"RTN","BPSRPT5",10,0)
 I $G(BPEXCEL) D WRLINE1^BPSRPT8(BPRTYPE,.BPREC,BPDIV,BPGRPLAN,BPDFN,BPRX,BPREF,BPX,BPSRTDT,BPBIL,BPINS,BPCOLL) Q
"RTN","BPSRPT5",11,0)
 ;Report Output
"RTN","BPSRPT5",12,0)
 W !,$$PATNAME^BPSRPT6(BPDFN)
"RTN","BPSRPT5",13,0)
 W ?27,"("_$$SSN4^BPSRPT6(BPDFN)_")"
"RTN","BPSRPT5",14,0)
 W ?35,$$RXNUM^BPSRPT6(BPRX)_$$COPAY^BPSRPT6(BPRX)
"RTN","BPSRPT5",15,0)
 W ?47,BPREF,"/",$$ECMENUM^BPSRPT1($P(BPX,U,3))
"RTN","BPSRPT5",16,0)
 I (BPRTYPE=1)!(BPRTYPE=4) D  Q
"RTN","BPSRPT5",17,0)
 . W ?68,$$DATTIM^BPSRPT1(BPSRTDT)
"RTN","BPSRPT5",18,0)
 . W ?78,$J(BPBIL,10,2),?100,$J(BPINS,10,2),?122,$S(BPCOLL]"":$J(BPCOLL,10,2),1:"")
"RTN","BPSRPT5",19,0)
 I BPRTYPE=2 D  Q
"RTN","BPSRPT5",20,0)
 . W ?68,$$DATTIM^BPSRPT1(BPSRTDT)
"RTN","BPSRPT5",21,0)
 . W ?78,$$DATTIM^BPSRPT1(+BPX)
"RTN","BPSRPT5",22,0)
 . W ?91,$$MWC^BPSRPT6(BPRX,BPREF)
"RTN","BPSRPT5",23,0)
 . W ?94,$$RTBCKNAM^BPSRPT1($$RTBCK^BPSRPT1($P(BPX,U,3)))
"RTN","BPSRPT5",24,0)
 . W ?98,$$RXSTATUS^BPSRPT6($P(BPX,U,3))
"RTN","BPSRPT5",25,0)
 . W ?101,$S($P(BPX,U):"/RL",1:"/NR")
"RTN","BPSRPT5",26,0)
 . W ?109,$S($$CLOSED02^BPSSCR03($P(^BPST($P(BPX,U,3),0),U,4))=1:"Closed",1:"Open")
"RTN","BPSRPT5",27,0)
 . W ?124,$S($$ELIGCODE^BPSSCR05($P(BPX,U,3))="V":"Vet",$$ELIGCODE^BPSSCR05($P(BPX,U,3))="T":"Tri",1:"UNK")
"RTN","BPSRPT5",28,0)
 I BPRTYPE=3 D  Q
"RTN","BPSRPT5",29,0)
 . W ?68,$$DATTIM^BPSRPT1(BPSRTDT)
"RTN","BPSRPT5",30,0)
 . W ?100,$J(BPBIL,10,2),?122,$J(BPINS,10,2)
"RTN","BPSRPT5",31,0)
 I BPRTYPE=5 D  Q
"RTN","BPSRPT5",32,0)
 . W ?60,$$DATTIM^BPSRPT1($$TRANDT^BPSRPT2($P(BPX,U,3),1))
"RTN","BPSRPT5",33,0)
 . W ?78,$$TTYPE^BPSRPT7($P(BPX,U,4),$P(BPX,U,5))
"RTN","BPSRPT5",34,0)
 . W ?95,$$RESPONSE^BPSRPT7($P(BPX,U,4),$P(BPX,U,5))
"RTN","BPSRPT5",35,0)
 I BPRTYPE=7 D  Q
"RTN","BPSRPT5",36,0)
 . W ?65,$$MWC^BPSRPT6(BPRX,BPREF)
"RTN","BPSRPT5",37,0)
 . W ?68,$$RTBCKNAM^BPSRPT1($$RTBCK^BPSRPT1($P(BPX,U,3)))
"RTN","BPSRPT5",38,0)
 . W ?72,$$RXSTATUS^BPSRPT6($P(BPX,U,3))
"RTN","BPSRPT5",39,0)
 . W ?75,$S($P(BPX,U):"/RL",1:"/NR")
"RTN","BPSRPT5",40,0)
 . W ?79,$S($P(BPX,U,13):"REJ",1:"")
"RTN","BPSRPT5",41,0)
 . W ?87,$$DRGNAM^BPSRPT6($P(BPX,U,14),30)
"RTN","BPSRPT5",42,0)
 . W ?118,$$GETNDC^BPSRPT6(BPRX,BPREF)
"RTN","BPSRPT5",43,0)
 Q
"RTN","BPSRPT5",44,0)
 ;
"RTN","BPSRPT5",45,0)
 ;Print Report Line 2
"RTN","BPSRPT5",46,0)
WRLINE2(BPRTYPE,BPREC,BPX,BPRX,BPREF,BPBIL,BPGRPLAN,BPEXCEL,BPICNT) ;
"RTN","BPSRPT5",47,0)
 ;Excel Output
"RTN","BPSRPT5",48,0)
 I $G(BPEXCEL) D WRLINE2^BPSRPT8(BPRTYPE,.BPREC,BPX,BPRX,BPREF,BPBIL,BPGRPLAN) Q
"RTN","BPSRPT5",49,0)
 ;Report Output
"RTN","BPSRPT5",50,0)
 I (BPRTYPE=1)!(BPRTYPE=4) D  Q
"RTN","BPSRPT5",51,0)
 . W !,?4,$$DRGNAM^BPSRPT6($P(BPX,U,14),27),?32,$$GETNDC^BPSRPT6(BPRX,BPREF)
"RTN","BPSRPT5",52,0)
 . I BPRTYPE=1 W ?47,$$DATTIM^BPSRPT1(+BPX)
"RTN","BPSRPT5",53,0)
 . W ?68,$$MWC^BPSRPT6(BPRX,BPREF)
"RTN","BPSRPT5",54,0)
 . W ?71,$$RTBCKNAM^BPSRPT1($$RTBCK^BPSRPT1($P(BPX,U,3)))
"RTN","BPSRPT5",55,0)
 . W ?75,$$RXSTATUS^BPSRPT6($P(BPX,U,3))
"RTN","BPSRPT5",56,0)
 . W ?78,$S($P(BPX,U):"/RL",1:"/NR")
"RTN","BPSRPT5",57,0)
 . W ?82,$S($P(BPX,U,13):"REJ",1:"")
"RTN","BPSRPT5",58,0)
 . I BPRTYPE=1 W ?122,$J($$BILL^BPSRPT6(BPRX,BPREF),10)
"RTN","BPSRPT5",59,0)
 I BPRTYPE=2 D  Q
"RTN","BPSRPT5",60,0)
 . W !,?3,$E($$CRDHLDID^BPSRPT2(+$P(BPX,U,3)),3,23)
"RTN","BPSRPT5",61,0)
 . W ?31,$E($$GRPID^BPSRPT2(+$P(BPX,U,3)),3,10)
"RTN","BPSRPT5",62,0)
 . W ?41,$J(BPBIL,10,2)
"RTN","BPSRPT5",63,0)
 . W ?54,$$QTY^BPSRPT6($P(BPX,U,3))
"RTN","BPSRPT5",64,0)
 . W ?61,$$GETNDC^BPSRPT6(BPRX,BPREF)
"RTN","BPSRPT5",65,0)
 . W ?82,$$DRGNAM^BPSRPT6($P(BPX,U,14),32)
"RTN","BPSRPT5",66,0)
 I BPRTYPE=3 D  Q
"RTN","BPSRPT5",67,0)
 . W !,?4,$$DRGNAM^BPSRPT6($P(BPX,U,14),32)
"RTN","BPSRPT5",68,0)
 . W ?41,$$GETNDC^BPSRPT6(BPRX,BPREF)
"RTN","BPSRPT5",69,0)
 . W ?68,$$MWC^BPSRPT6(BPRX,BPREF)
"RTN","BPSRPT5",70,0)
 . W ?71,$$RTBCKNAM^BPSRPT1($$RTBCK^BPSRPT1($P(BPX,U,3)))
"RTN","BPSRPT5",71,0)
 . W ?74,$$RXSTATUS^BPSRPT6($P(BPX,U,3))
"RTN","BPSRPT5",72,0)
 . W ?77,$S($P(BPX,U):"/RL",1:"/NR")
"RTN","BPSRPT5",73,0)
 . W ?81,$S($P(BPX,U,13):"REJ",1:"")
"RTN","BPSRPT5",74,0)
 I BPRTYPE=5 D  Q
"RTN","BPSRPT5",75,0)
 . W !,?4,$$DRGNAM^BPSRPT6($P(BPX,U,14),23)
"RTN","BPSRPT5",76,0)
 . W ?28,$$GETNDC^BPSRPT6(BPRX,BPREF)
"RTN","BPSRPT5",77,0)
 . W ?47,$$MWC^BPSRPT6(BPRX,BPREF)
"RTN","BPSRPT5",78,0)
 . W ?50,$$RTBCKNAM^BPSRPT1($$RTBCK^BPSRPT1($P(BPX,U,3)))
"RTN","BPSRPT5",79,0)
 . W ?53,$$RXSTATUS^BPSRPT6($P(BPX,U,3))
"RTN","BPSRPT5",80,0)
 . W ?56,$S($P(BPX,U):"/RL",1:"/NR")
"RTN","BPSRPT5",81,0)
 . W ?60,$S($P(BPX,U,13):"REJ",1:"")
"RTN","BPSRPT5",82,0)
 . I $P(BPGRPLAN,U,2)]"" W ?69,$E($P(BPGRPLAN,U,2),1,30)
"RTN","BPSRPT5",83,0)
 . W ?122,$J($$ELAPSE^BPSRPT6($P(BPX,U,3)),10)
"RTN","BPSRPT5",84,0)
 I BPRTYPE=7 D  Q
"RTN","BPSRPT5",85,0)
 . W !,?3,$E($$CRDHLDID^BPSRPT2(+$P(BPX,U,3)),3,23)
"RTN","BPSRPT5",86,0)
 . W ?31,$E($$GRPID^BPSRPT2(+$P(BPX,U,3)),3,10)
"RTN","BPSRPT5",87,0)
 . W ?41,$$DATTIM^BPSRPT1(+$$CLOSEDT^BPSRPT2(+$P(BPX,U,3)))
"RTN","BPSRPT5",88,0)
 . N BPCLBY S BPCLBY=$E($$CLSBY^BPSRPT6(+$P(BPX,U,3)),1,25) S:BPCLBY="" BPCLBY="BLANK"
"RTN","BPSRPT5",89,0)
 . W ?59,BPCLBY S BPCNT(BPCLBY)=$G(BPCNT(BPCLBY))+1,BPGCNT(BPCLBY)=$G(BPGCNT(BPCLBY))+1,BPICNT(BPCLBY)=$G(BPICNT(BPCLBY))+1
"RTN","BPSRPT5",90,0)
 . W ?87,$E($P($$CLRSN^BPSRPT7(+$P(BPX,U,3)),U,2),1,30)
"RTN","BPSRPT5",91,0)
 Q
"RTN","BPSRPT5",92,0)
 ;
"RTN","BPSRPT5",93,0)
 ;Print Report Line 3
"RTN","BPSRPT5",94,0)
WRLINE3(BPRTYPE,BPREC,BPX,BPEXCEL) N BP59
"RTN","BPSRPT5",95,0)
 S BP59=+$P(BPX,U,3)
"RTN","BPSRPT5",96,0)
 ;Excel Output
"RTN","BPSRPT5",97,0)
 I $G(BPEXCEL) D WRLINE3^BPSRPT8(BPRTYPE,.BPREC,BPX) Q
"RTN","BPSRPT5",98,0)
 ;Report Output
"RTN","BPSRPT5",99,0)
 I BPRTYPE=4 D
"RTN","BPSRPT5",100,0)
 . S NP=$$CHKP(1) Q:BPQ
"RTN","BPSRPT5",101,0)
 . ;Released On
"RTN","BPSRPT5",102,0)
 . W !,?6,$$DATTIM^BPSRPT1(+BPX)
"RTN","BPSRPT5",103,0)
 . ;Method
"RTN","BPSRPT5",104,0)
 . I $$AUTOREV^BPSRPT1(BP59) W ?22,"AUTO/"
"RTN","BPSRPT5",105,0)
 . E  W ?22,"REGULAR/"
"RTN","BPSRPT5",106,0)
 . ;Return Status
"RTN","BPSRPT5",107,0)
 . I $P(BPX,U,15)["ACCEPTED" W "ACCEPTED/"
"RTN","BPSRPT5",108,0)
 . E  W "REJECTED/"
"RTN","BPSRPT5",109,0)
 . ;Reason
"RTN","BPSRPT5",110,0)
 . W $$RVSRSN^BPSRPT7(+$P(BPX,U,3))
"RTN","BPSRPT5",111,0)
 Q
"RTN","BPSRPT5",112,0)
 ;
"RTN","BPSRPT5",113,0)
 ;Display the Report
"RTN","BPSRPT5",114,0)
REPORT(REF,BPEXCEL,BPSCR,BPRPTNAM,BPSUMDET,BPPAGE) N BPBIL,BPBLINE,BPCOLL,BPDFN,BPDIV,BPELTM,BPGELTM,BPGBIL,BPGINS,BPGCOLL,BPGCNT,BPGRPLAN,BPINS,BPLINES,BPREC,BPREF,BPRX,BPSRTDT,BPSTATUS,BPTBIL,BPTCOLL,BPTINS,BPX,BPSGTOT,NP,BPSDATA
"RTN","BPSRPT5",115,0)
 I '$D(@REF) D HDR^BPSRPT7(BPRTYPE,BPRPTNAM,.BPPAGE) W !,"No data meets the criteria." G XREPORT
"RTN","BPSRPT5",116,0)
 S (BPGBIL,BPGINS,BPGCOLL,BPGCNT,BPGELTM)=0
"RTN","BPSRPT5",117,0)
 S BPDIV="" F  S BPDIV=$O(@REF@(BPDIV)) Q:BPDIV=""  D  Q:BPQ
"RTN","BPSRPT5",118,0)
 .S BPGRPLAN=0 D HDR^BPSRPT7(BPRTYPE,BPRPTNAM,.BPPAGE)
"RTN","BPSRPT5",119,0)
 .N BPCNT S (BPTBIL,BPTINS,BPTCOLL,BPCNT,BPELTM)=0
"RTN","BPSRPT5",120,0)
 .F  S BPGRPLAN=$O(@REF@(BPDIV,BPGRPLAN)) Q:BPGRPLAN=""  D  Q:BPQ
"RTN","BPSRPT5",121,0)
 .. I BPSUMDET=0 D WRPLAN(BPGRPLAN) Q:BPQ
"RTN","BPSRPT5",122,0)
 .. S BPBLINE=""  ;Reset Blank Line Indicator
"RTN","BPSRPT5",123,0)
 .. N BPSCLM,BPREC,BPTOT,BPIBIL,BPICNT,BPICOL,BPIINS
"RTN","BPSRPT5",124,0)
 .. S (BPIBIL,BPICNT,BPICOL,BPIINS)=0
"RTN","BPSRPT5",125,0)
 .. S BPDFN="" F  S BPDFN=$O(@REF@(BPDIV,BPGRPLAN,BPDFN)) Q:BPDFN=""  D  Q:BPQ
"RTN","BPSRPT5",126,0)
 ... S BPSRTDT="" F  S BPSRTDT=$O(@REF@(BPDIV,BPGRPLAN,BPDFN,BPSRTDT)) Q:BPSRTDT=""  D  Q:BPQ
"RTN","BPSRPT5",127,0)
 .... S BPRX="" F  S BPRX=$O(@REF@(BPDIV,BPGRPLAN,BPDFN,BPSRTDT,BPRX)) Q:BPRX=""  D  Q:BPQ
"RTN","BPSRPT5",128,0)
 ..... S BPREF="" F  S BPREF=$O(@REF@(BPDIV,BPGRPLAN,BPDFN,BPSRTDT,BPRX,BPREF)) Q:BPREF=""  D  Q:BPQ
"RTN","BPSRPT5",129,0)
 ...... S BPX=@REF@(BPDIV,BPGRPLAN,BPDFN,BPSRTDT,BPRX,BPREF)
"RTN","BPSRPT5",130,0)
 ...... S BPCNT=BPCNT+1,BPGCNT=BPGCNT+1,BPICNT=BPICNT+1
"RTN","BPSRPT5",131,0)
 ...... I BPRTYPE=5 D
"RTN","BPSRPT5",132,0)
 ....... S BPELTM=BPELTM+$$ELAPSE^BPSRPT6($P(BPX,U,3))
"RTN","BPSRPT5",133,0)
 ....... S BPGELTM=BPGELTM+$$ELAPSE^BPSRPT6($P(BPX,U,3))
"RTN","BPSRPT5",134,0)
 ...... S BPBIL=$$BILLED^BPSRPT7($P(BPX,U,3)),BPTBIL=BPTBIL+BPBIL,BPGBIL=BPGBIL+BPBIL,BPIBIL=BPIBIL+BPBIL
"RTN","BPSRPT5",135,0)
 ...... S BPINS=$$INSPAID^BPSRPT2($P(BPX,U,3)),BPTINS=BPTINS+BPINS,BPGINS=BPGINS+BPINS,BPIINS=BPIINS+BPINS
"RTN","BPSRPT5",136,0)
 ...... S BPCOLL=$$COLLECTD^BPSRPT6(BPRX,BPREF),BPTCOLL=BPTCOLL+BPCOLL,BPGCOLL=BPGCOLL+BPCOLL,BPICOL=BPICOL+BPCOLL
"RTN","BPSRPT5",137,0)
 ...... I BPRTYPE=6 D  Q
"RTN","BPSRPT5",138,0)
 .......S BPSTATUS=$P(BPX,U,7)
"RTN","BPSRPT5",139,0)
 .......I BPSTATUS["REJECT" S $P(BPSCLM(BPSRTDT),U,3)=$P($G(BPSCLM(BPSRTDT)),U,3)+BPBIL
"RTN","BPSRPT5",140,0)
 .......I BPSTATUS["PAYABLE" S $P(BPSCLM(BPSRTDT),U,4)=$P($G(BPSCLM(BPSRTDT)),U,4)+BPBIL
"RTN","BPSRPT5",141,0)
 .......S $P(BPSCLM(BPSRTDT),U,2)=$P($G(BPSCLM(BPSRTDT)),U,2)+BPBIL
"RTN","BPSRPT5",142,0)
 .......S $P(BPSCLM(BPSRTDT),U,5)=$P($G(BPSCLM(BPSRTDT)),U,5)+BPINS
"RTN","BPSRPT5",143,0)
 .......S $P(BPSCLM(BPSRTDT),U)=$P($G(BPSCLM(BPSRTDT)),U)+1
"RTN","BPSRPT5",144,0)
 ...... ;
"RTN","BPSRPT5",145,0)
 ...... ;Display Detail Section
"RTN","BPSRPT5",146,0)
 ...... Q:BPSUMDET=1
"RTN","BPSRPT5",147,0)
 ...... S BPREC=""  ;Reset Excel Display Variable
"RTN","BPSRPT5",148,0)
 ...... I 'BPEXCEL,BPRTYPE=1,BPBLINE=1 S NP=$$CHKP(2) Q:BPQ  I BPBLINE=1 W !  ;Print blank line
"RTN","BPSRPT5",149,0)
 ...... S NP=$$CHKP(1) Q:BPQ  D WRLINE1(BPRTYPE,.BPREC,BPDIV,BPGRPLAN,BPDFN,BPRX,BPREF,BPX,BPSRTDT,BPBIL,BPINS,BPCOLL,BPEXCEL)
"RTN","BPSRPT5",150,0)
 ...... S NP=$$CHKP(1) Q:BPQ  D WRLINE2(BPRTYPE,.BPREC,BPX,BPRX,BPREF,BPBIL,BPGRPLAN,BPEXCEL,.BPICNT)
"RTN","BPSRPT5",151,0)
 ...... D WRLINE3(BPRTYPE,.BPREC,BPX,BPEXCEL)
"RTN","BPSRPT5",152,0)
 ...... I (",2,7,")[BPRTYPE,'BPEXCEL D  Q:BPQ
"RTN","BPSRPT5",153,0)
 ....... D COMMENT(+$P(BPX,U,3)) Q:BPQ
"RTN","BPSRPT5",154,0)
 ....... S NP=$$CHKP(1) Q:BPQ
"RTN","BPSRPT5",155,0)
 ....... W !,?10,"Claim ID: ",$$CLAIMID^BPSRPT2(+$P(BPX,U,3))
"RTN","BPSRPT5",156,0)
 ....... N BPSARR,BPRJCNT,BPZZ S BPRJCNT=$$REJTEXT^BPSRPT2(+$P(BPX,U,3),.BPSARR)
"RTN","BPSRPT5",157,0)
 ....... F BPZZ=1:1:BPRJCNT S NP=$$CHKP(1) Q:BPQ  W !,?10,BPSARR(BPZZ) Q:BPQ
"RTN","BPSRPT5",158,0)
 ...... I 'BPEXCEL,BPRTYPE=1 S BPBLINE=1  ;Set Blank Line Display Indicator
"RTN","BPSRPT5",159,0)
 .. I BPRTYPE=6 D PTBDT^BPSRPT7(BPDIV,BPSUMDET,.BPSCLM,.BPSGTOT)
"RTN","BPSRPT5",160,0)
 .. I 'BPQ,(",1,2,3,4,7,")[BPRTYPE,'BPEXCEL S NP=$$CHKP(5) Q:BPQ  D ITOT^BPSRPT8(BPRTYPE,BPDIV,BPGRPLAN,BPIBIL,BPIINS,BPICOL,.BPICNT)
"RTN","BPSRPT5",161,0)
 .I 'BPEXCEL,'BPQ,BPRTYPE'=6 S NP=$$CHKP(5) Q:BPQ  D TOTALS^BPSRPT7(BPRTYPE,BPDIV,BPTBIL,BPTINS,BPTCOLL,.BPCNT,BPELTM)
"RTN","BPSRPT5",162,0)
 .I 'BPEXCEL,'BPQ,$O(@REF@(BPDIV))]"" D:$G(BPSCR) PAUSE^BPSRPT1 Q:BPQ
"RTN","BPSRPT5",163,0)
 ;Print Grand Totals
"RTN","BPSRPT5",164,0)
 I 'BPEXCEL D
"RTN","BPSRPT5",165,0)
 .I 'BPQ,BPRTYPE=6 D PGTOT6^BPSRPT7($G(BPSGTOT))
"RTN","BPSRPT5",166,0)
 .I 'BPQ,BPRTYPE'=6 S NP=$$CHKP(5) Q:BPQ  D PGTOT^BPSRPT7(BPRTYPE,BPGBIL,BPGINS,BPGCOLL,.BPGCNT,BPGELTM)
"RTN","BPSRPT5",167,0)
 ;
"RTN","BPSRPT5",168,0)
XREPORT Q
"RTN","BPSRPT5",169,0)
 ;
"RTN","BPSRPT5",170,0)
 ;Display Comments
"RTN","BPSRPT5",171,0)
 ;Input Variable: BP59 - Lookup to BPS TRANSACTION (#59)
"RTN","BPSRPT5",172,0)
COMMENT(BP59) N CNODE,I,J,NP
"RTN","BPSRPT5",173,0)
 S I="" F  S I=$O(^BPST(BP59,11,"B",I),-1) Q:'I  D  Q:BPQ
"RTN","BPSRPT5",174,0)
 .S NP=$$CHKP(1) Q:BPQ
"RTN","BPSRPT5",175,0)
 .S J=$O(^BPST(BP59,11,"B",I,"")) Q:J=""
"RTN","BPSRPT5",176,0)
 .S CNODE=$G(^BPST(BP59,11,J,0))
"RTN","BPSRPT5",177,0)
 .W !,?10,$$DATTIM^BPSRPT1(+$P($P(CNODE,U),"."))," - ",$P(CNODE,U,3)
"RTN","BPSRPT5",178,0)
 Q
"RTN","BPSRPT5",179,0)
 ;
"RTN","BPSRPT5",180,0)
 ;Display the Insurance
"RTN","BPSRPT5",181,0)
 ; Input Variable -> BPSDATA -> if 0, skip page check
"RTN","BPSRPT5",182,0)
 ;                   BPEXCEL -> 1 - Print to Excel/0 Regular Display
"RTN","BPSRPT5",183,0)
WRPLAN(BPGRPLAN) N INS,NP
"RTN","BPSRPT5",184,0)
 ;
"RTN","BPSRPT5",185,0)
 I BPSUMDET'=0 Q
"RTN","BPSRPT5",186,0)
 I BPEXCEL Q
"RTN","BPSRPT5",187,0)
 ;Skip for Recent Transactions and Totals by Date Reports
"RTN","BPSRPT5",188,0)
 I BPRTYPE=5!(BPRTYPE=6) Q
"RTN","BPSRPT5",189,0)
 I $G(BPSDATA) S NP=$$CHKP(5) Q:BPQ!NP
"RTN","BPSRPT5",190,0)
 ;Get and display the Insurance Name
"RTN","BPSRPT5",191,0)
 S INS=$E(BPGRPLAN,1,90)
"RTN","BPSRPT5",192,0)
 I INS]"" D
"RTN","BPSRPT5",193,0)
 .D ULINE("-")
"RTN","BPSRPT5",194,0)
 .W !,INS
"RTN","BPSRPT5",195,0)
 .D ULINE("-")
"RTN","BPSRPT5",196,0)
 Q
"RTN","BPSRPT5",197,0)
 ;
"RTN","BPSRPT5",198,0)
 ;Check for End of Page
"RTN","BPSRPT5",199,0)
 ; Input variables -> BPLINES -> Number of lines from bottom
"RTN","BPSRPT5",200,0)
 ;                    BPEXCEL -> 1 - Print to Excel/0 Regular Display
"RTN","BPSRPT5",201,0)
 ; Output variable -> BPSDATA -> 0 -> New screen, no data displayed yet
"RTN","BPSRPT5",202,0)
 ;                               1 -> Data displayed on current screen
"RTN","BPSRPT5",203,0)
CHKP(BPLINES) Q:$G(BPEXCEL) 0
"RTN","BPSRPT5",204,0)
 S BPLINES=BPLINES+1
"RTN","BPSRPT5",205,0)
 I $G(BPSCR) S BPLINES=BPLINES+2
"RTN","BPSRPT5",206,0)
 I $G(BPSCR),'$G(BPSDATA) S BPSDATA=1 Q 0
"RTN","BPSRPT5",207,0)
 S BPSDATA=1
"RTN","BPSRPT5",208,0)
 I $Y>(IOSL-BPLINES) D:$G(BPSCR) PAUSE^BPSRPT1 Q:$G(BPQ) 0 D HDR^BPSRPT7(BPRTYPE,BPRPTNAM,.BPPAGE) Q 1
"RTN","BPSRPT5",209,0)
 Q 0
"RTN","BPSRPT5",210,0)
 ;
"RTN","BPSRPT5",211,0)
 ;Print one line of characters
"RTN","BPSRPT5",212,0)
ULINE(X) N I
"RTN","BPSRPT5",213,0)
 W ! F I=1:1:132 W $G(X,"-")
"RTN","BPSRPT5",214,0)
 Q
"RTN","BPSRPT6")
0^25^B59574231
"RTN","BPSRPT6",1,0)
BPSRPT6 ;BHAM ISC/BEE - ECME REPORTS ;14-FEB-05
"RTN","BPSRPT6",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,3,5,7**;JUN 2004;Build 46
"RTN","BPSRPT6",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSRPT6",4,0)
 ;
"RTN","BPSRPT6",5,0)
 Q
"RTN","BPSRPT6",6,0)
 ;
"RTN","BPSRPT6",7,0)
 ;Get the Insurance Company pointer and name
"RTN","BPSRPT6",8,0)
 ;
"RTN","BPSRPT6",9,0)
 ; Returned Value -> ptr^Insurance Company Name
"RTN","BPSRPT6",10,0)
 ; 
"RTN","BPSRPT6",11,0)
INSNAM(BP59) N BPIN,BPDOS,BPDFN,BPSZZ,BP36,BPX,BPINAME,BPIBA,BP36IEN
"RTN","BPSRPT6",12,0)
 ;
"RTN","BPSRPT6",13,0)
 ;Reset Insurance
"RTN","BPSRPT6",14,0)
 S BP36=""
"RTN","BPSRPT6",15,0)
 ;
"RTN","BPSRPT6",16,0)
 ;First Pull From BPS Transactions
"RTN","BPSRPT6",17,0)
 S BPIN=+$P($G(^BPST(BP59,9)),U)
"RTN","BPSRPT6",18,0)
 I +BPIN D
"RTN","BPSRPT6",19,0)
 . S BPINAME=$P($G(^BPST(BP59,10,BPIN,0)),U,7)
"RTN","BPSRPT6",20,0)
 . S BPIBA=$P($G(^BPST(BP59,10,BPIN,0)),U,1)
"RTN","BPSRPT6",21,0)
 . S BP36IEN=$$INSPL^IBNCPDPI(BPIBA)
"RTN","BPSRPT6",22,0)
 . S:BP36IEN]""&BPINAME]"" BP36=BP36IEN_"^"_BPINAME
"RTN","BPSRPT6",23,0)
 ;If Not Found, look up using API
"RTN","BPSRPT6",24,0)
 I BP36="" D
"RTN","BPSRPT6",25,0)
 .S BPDOS=+$P($G(^BPST(BP59,12)),U,2)\1
"RTN","BPSRPT6",26,0)
 .I BPDOS=0 S BPDOS=+$P($G(^BPST(BP59,0)),U,8)\1
"RTN","BPSRPT6",27,0)
 .S BPDFN=+$P($G(^BPST(BP59,0)),U,6)
"RTN","BPSRPT6",28,0)
 .S BPX=$$INSUR^IBBAPI(BPDFN,BPDOS,,.BPSZZ,"1")
"RTN","BPSRPT6",29,0)
 .S BP36=$G(BPSZZ("IBBAPI","INSUR",1,1))
"RTN","BPSRPT6",30,0)
 ;
"RTN","BPSRPT6",31,0)
 ;If Not Found, put in MISSING INSURANCE
"RTN","BPSRPT6",32,0)
 I $TR(BP36,U)="" S BP36=" ^**MISSING INSURANCE**"
"RTN","BPSRPT6",33,0)
 ;
"RTN","BPSRPT6",34,0)
 Q BP36
"RTN","BPSRPT6",35,0)
 ;
"RTN","BPSRPT6",36,0)
 ;Select an Insurance Company file entry (Fileman Lookup)
"RTN","BPSRPT6",37,0)
 ;
"RTN","BPSRPT6",38,0)
 ; Returned value -> Insurance Company Name
"RTN","BPSRPT6",39,0)
 ; 
"RTN","BPSRPT6",40,0)
SELINS() N INS
"RTN","BPSRPT6",41,0)
 S INS=$$SELINSUR^IBNCPDPI("Select Insurance","")
"RTN","BPSRPT6",42,0)
 I $P(INS,U)=-1 S INS="^"
"RTN","BPSRPT6",43,0)
 E  S INS=$P(INS,U,2)
"RTN","BPSRPT6",44,0)
 Q INS
"RTN","BPSRPT6",45,0)
 ;
"RTN","BPSRPT6",46,0)
 ;Get the drug name for display
"RTN","BPSRPT6",47,0)
 ;
"RTN","BPSRPT6",48,0)
 ; Input variable ->  BP50 - Lookup to DRUG (#50)
"RTN","BPSRPT6",49,0)
 ;                   BPLEN - Length of the display field
"RTN","BPSRPT6",50,0)
 ; Returned value -> Name of the drug
"RTN","BPSRPT6",51,0)
 ; 
"RTN","BPSRPT6",52,0)
DRGNAM(BP50,BPLEN) Q $E($$DRUGDIE^BPSUTIL1(+BP50,.01,"E"),1,BPLEN)
"RTN","BPSRPT6",53,0)
 ;       
"RTN","BPSRPT6",54,0)
 ;Select a DRUG file entry (Fileman Lookup)
"RTN","BPSRPT6",55,0)
 ;
"RTN","BPSRPT6",56,0)
 ; Returned Variable -> Y
"RTN","BPSRPT6",57,0)
 ; 
"RTN","BPSRPT6",58,0)
SELDRG N DIC S DIC(0)="QEAM",DIC=50,DIC("A")="Select Drug: "
"RTN","BPSRPT6",59,0)
 D DRUGDIC^BPSUTIL1(.DIC)
"RTN","BPSRPT6",60,0)
 Q
"RTN","BPSRPT6",61,0)
 ;
"RTN","BPSRPT6",62,0)
 ;Get the drug class for display
"RTN","BPSRPT6",63,0)
 ;
"RTN","BPSRPT6",64,0)
 ; Input variable -> BP50605 - Lookup to VA DRUG CLASS (#50.605)
"RTN","BPSRPT6",65,0)
 ;                   BPLEN - Length of the display field
"RTN","BPSRPT6",66,0)
 ; Returned value -> Name of the drug class
"RTN","BPSRPT6",67,0)
 ;                   
"RTN","BPSRPT6",68,0)
DRGCLNAM(BP50605,BPLEN) N IEN,Y
"RTN","BPSRPT6",69,0)
 K ^TMP($J,"BPSRPT6")
"RTN","BPSRPT6",70,0)
 S Y=""
"RTN","BPSRPT6",71,0)
 I BP50605]"" D 
"RTN","BPSRPT6",72,0)
 .D C^PSN50P65(BP50605,"","BPSRPT6")
"RTN","BPSRPT6",73,0)
 .S IEN=$O(^TMP($J,"BPSRPT6",0))
"RTN","BPSRPT6",74,0)
 .I IEN]"" S Y=$E($G(^TMP($J,"BPSRPT6",IEN,1)),1,BPLEN)
"RTN","BPSRPT6",75,0)
 K ^TMP($J,"BPSRPT6")
"RTN","BPSRPT6",76,0)
 Q Y
"RTN","BPSRPT6",77,0)
 ;
"RTN","BPSRPT6",78,0)
 ;Select a VA DRUG CLASS file entry (Fileman Lookup)
"RTN","BPSRPT6",79,0)
 ;
"RTN","BPSRPT6",80,0)
SELDRGC N DIR,DIRUT,DTOUT,DUOUT,IEN,TOT,X
"RTN","BPSRPT6",81,0)
 K ^TMP($J,"BPSRPT6")
"RTN","BPSRPT6",82,0)
 ;
"RTN","BPSRPT6",83,0)
 F  D  Q:Y]""
"RTN","BPSRPT6",84,0)
 .K ^TMP($J,"BPSRPT6"),^TMP($J,"BPSRPT6X")
"RTN","BPSRPT6",85,0)
 .S DIR(0)="FO^1:35"
"RTN","BPSRPT6",86,0)
 .S DIR("A")="Select Drug Class"
"RTN","BPSRPT6",87,0)
 .S DIR("?")="Answer with VA DRUG CLASS CODE, or CLASSIFICATION. TYPE '??' FOR A LIST"
"RTN","BPSRPT6",88,0)
 .S DIR("??")="^D DCLIST^BPSRPT6"
"RTN","BPSRPT6",89,0)
 .D ^DIR
"RTN","BPSRPT6",90,0)
 .I ($G(DUOUT)=1)!($G(DTOUT)=1)!($G(Y)="") S Y="^" Q
"RTN","BPSRPT6",91,0)
 .;
"RTN","BPSRPT6",92,0)
 .;Get list based on original user input
"RTN","BPSRPT6",93,0)
 .D C^PSN50P65("",Y,"BPSRPT6X")
"RTN","BPSRPT6",94,0)
 .;
"RTN","BPSRPT6",95,0)
 .;Get list based on uppercase input
"RTN","BPSRPT6",96,0)
 .S Y=$$UP^XLFSTR(Y)
"RTN","BPSRPT6",97,0)
 .D C^PSN50P65("",Y,"BPSRPT6")
"RTN","BPSRPT6",98,0)
 .;
"RTN","BPSRPT6",99,0)
 .;Merge lists together
"RTN","BPSRPT6",100,0)
 .M ^TMP($J,"BPSRPT6")=^TMP($J,"BPSRPT6X")
"RTN","BPSRPT6",101,0)
 .K ^TMP($J,"BPSRPT6X")
"RTN","BPSRPT6",102,0)
 .;
"RTN","BPSRPT6",103,0)
 .; Reset 0 node based on combined lists
"RTN","BPSRPT6",104,0)
 .S Y=0 F TOT=0:1 S Y=$O(^TMP($J,"BPSRPT6",Y)) Q:'+Y
"RTN","BPSRPT6",105,0)
 .S ^TMP($J,"BPSRPT6",0)=TOT
"RTN","BPSRPT6",106,0)
 .;
"RTN","BPSRPT6",107,0)
 .;Check for no entries found
"RTN","BPSRPT6",108,0)
 .I TOT<1 W "  ??" S Y="" Q
"RTN","BPSRPT6",109,0)
 .;
"RTN","BPSRPT6",110,0)
 .;Check for Unique Entry
"RTN","BPSRPT6",111,0)
 .I TOT=1 D  Q
"RTN","BPSRPT6",112,0)
 ..S Y="",IEN=$O(^TMP($J,"BPSRPT6",0))
"RTN","BPSRPT6",113,0)
 ..I IEN]"" S Y=$G(^TMP($J,"BPSRPT6",IEN,1)) W $C(13),"Select Drug Class: ",Y
"RTN","BPSRPT6",114,0)
 .;
"RTN","BPSRPT6",115,0)
 .;Check for multiple entries - allow user to pick
"RTN","BPSRPT6",116,0)
 .I TOT>1 S Y=$$DCSEL(TOT)
"RTN","BPSRPT6",117,0)
 .I Y="^^" S Y=""
"RTN","BPSRPT6",118,0)
 .;
"RTN","BPSRPT6",119,0)
 Q
"RTN","BPSRPT6",120,0)
 ;
"RTN","BPSRPT6",121,0)
 ;List Entries in VA DRUG CLASS
"RTN","BPSRPT6",122,0)
 ;
"RTN","BPSRPT6",123,0)
DCLIST N CL,DTOUT,IEN,Y
"RTN","BPSRPT6",124,0)
 K ^TMP($J,"BPSRPT6")
"RTN","BPSRPT6",125,0)
 D C^PSN50P65("","??","BPSRPT6")
"RTN","BPSRPT6",126,0)
 ;
"RTN","BPSRPT6",127,0)
 ;First create new index - sorted by CLASSIFICATION
"RTN","BPSRPT6",128,0)
 S IEN=0 F  S IEN=$O(^TMP($J,"BPSRPT6",IEN)) Q:'IEN  D
"RTN","BPSRPT6",129,0)
 .S CL=$G(^TMP($J,"BPSRPT6",IEN,1)) Q:CL=""
"RTN","BPSRPT6",130,0)
 .S ^TMP($J,"BPSRPT6","B",CL,IEN)=$G(^TMP($J,"BPSRPT6",IEN,".01"))
"RTN","BPSRPT6",131,0)
 ;
"RTN","BPSRPT6",132,0)
 ;Now loop through and display entries
"RTN","BPSRPT6",133,0)
 S $X=0,$Y=0 W !,?3,"Choose from: ",!
"RTN","BPSRPT6",134,0)
 S (Y,CL)="" F  S CL=$O(^TMP($J,"BPSRPT6","B",CL)) Q:CL=""  D  Q:Y]""
"RTN","BPSRPT6",135,0)
 .S IEN="" F  S IEN=$O(^TMP($J,"BPSRPT6","B",CL,IEN)) Q:IEN=""  D  Q:Y]""
"RTN","BPSRPT6",136,0)
 ..W ?3,$G(^TMP($J,"BPSRPT6","B",CL,IEN)),!,?3,CL,!
"RTN","BPSRPT6",137,0)
 ..I $Y>19!'$Y D
"RTN","BPSRPT6",138,0)
 ...W ?3 R "'^' TO STOP: ",Y:$G(DTIME,300)
"RTN","BPSRPT6",139,0)
 ...E  S DTOUT=1
"RTN","BPSRPT6",140,0)
 ...W $C(13),$J("",17),$C(13)
"RTN","BPSRPT6",141,0)
 ...I ($G(DTOUT)=1)!($G(Y)="^") S Y="^" Q
"RTN","BPSRPT6",142,0)
 ...S $X=0,$Y=0
"RTN","BPSRPT6",143,0)
 ;
"RTN","BPSRPT6",144,0)
 K ^TMP($J,"BPSRPT6")
"RTN","BPSRPT6",145,0)
 Q
"RTN","BPSRPT6",146,0)
 ;
"RTN","BPSRPT6",147,0)
 ;Allow user to pick VA DRUG CLASS entry based on initial input
"RTN","BPSRPT6",148,0)
 ;
"RTN","BPSRPT6",149,0)
 ; Input variable - TOT -> Total entries placed in ^TMP($J,"BPSRPT6")
"RTN","BPSRPT6",150,0)
 ; Returned value - VA DRUG CLASSIFICATION
"RTN","BPSRPT6",151,0)
 ;
"RTN","BPSRPT6",152,0)
DCSEL(TOT) N CL,DTOUT,I,IEN,IX,Y
"RTN","BPSRPT6",153,0)
 ;
"RTN","BPSRPT6",154,0)
 ;First create new index
"RTN","BPSRPT6",155,0)
 F IX="B","N" K ^TMP($J,"BPSRPT6",IX)
"RTN","BPSRPT6",156,0)
 S Y="",IEN=0 F  S IEN=$O(^TMP($J,"BPSRPT6",IEN)) Q:'IEN  D
"RTN","BPSRPT6",157,0)
 .S CL=$G(^TMP($J,"BPSRPT6",IEN,1)) Q:CL=""
"RTN","BPSRPT6",158,0)
 .S ^TMP($J,"BPSRPT6","B",CL,IEN)=$G(^TMP($J,"BPSRPT6",IEN,".01"))
"RTN","BPSRPT6",159,0)
 ;
"RTN","BPSRPT6",160,0)
 ;Now loop through and allow one to be picked
"RTN","BPSRPT6",161,0)
 S (Y,CL)="" F  S CL=$O(^TMP($J,"BPSRPT6","B",CL)) Q:CL=""  D  Q:Y]""
"RTN","BPSRPT6",162,0)
 .S IEN="" F  S IEN=$O(^TMP($J,"BPSRPT6","B",CL,IEN)) Q:IEN=""  D  Q:Y]""
"RTN","BPSRPT6",163,0)
 ..S I=$G(I)+1 W !,?5,I,?9,$G(^TMP($J,"BPSRPT6","B",CL,IEN)),!,?3,CL
"RTN","BPSRPT6",164,0)
 ..S ^TMP($J,"BPSRPT6","N",I)=CL
"RTN","BPSRPT6",165,0)
 ..;
"RTN","BPSRPT6",166,0)
 ..;Stop after every 5 entries
"RTN","BPSRPT6",167,0)
 ..I I#5=0 I TOT>I D  Q:$G(Y)="^"!($G(Y)="^^")
"RTN","BPSRPT6",168,0)
 ...W !,"Press <RETURN> to see more, '^' to exit this list, OR"
"RTN","BPSRPT6",169,0)
 ...W !,"CHOOSE 1 - "_I R ": ",Y:DTIME S:'$T DTOUT=1
"RTN","BPSRPT6",170,0)
 ...I ($G(DTOUT)=1)!(Y="^") S Y="^^"
"RTN","BPSRPT6",171,0)
 ..;
"RTN","BPSRPT6",172,0)
 ..;Stop after last entry
"RTN","BPSRPT6",173,0)
 ..I I=TOT D
"RTN","BPSRPT6",174,0)
 ...W !,"CHOOSE 1 - "_I R ": ",Y:DTIME S:'$T DTOUT=1
"RTN","BPSRPT6",175,0)
 ..I ($G(DTOUT)=1)!(Y="^") S Y="^^"
"RTN","BPSRPT6",176,0)
 ..;
"RTN","BPSRPT6",177,0)
 ..;Check for valid entry
"RTN","BPSRPT6",178,0)
 ..I Y="^^" S Y=""
"RTN","BPSRPT6",179,0)
 ..I Y]"",'$D(^TMP($J,"BPSRPT6","N",Y)) W "  ??" S Y=""
"RTN","BPSRPT6",180,0)
 ..I Y]"",$D(^TMP($J,"BPSRPT6","N",Y)) S Y=$G(^TMP($J,"BPSRPT6","N",Y))
"RTN","BPSRPT6",181,0)
 ;
"RTN","BPSRPT6",182,0)
 Q Y
"RTN","BPSRPT6",183,0)
 ;
"RTN","BPSRPT6",184,0)
 ;Get DRUG file pointer
"RTN","BPSRPT6",185,0)
 ;       
"RTN","BPSRPT6",186,0)
 ; Return Value -> n = ptr to DRUG (#50)
"RTN","BPSRPT6",187,0)
 ;                 0 = Unknown
"RTN","BPSRPT6",188,0)
 ; 
"RTN","BPSRPT6",189,0)
GETDRUG(BPRX) Q +$$RXAPI1^BPSUTIL1(BPRX,6,"I")
"RTN","BPSRPT6",190,0)
 ;
"RTN","BPSRPT6",191,0)
 ;Get VA DRUG CLASS pointer
"RTN","BPSRPT6",192,0)
 ;       
"RTN","BPSRPT6",193,0)
 ; Input Variables: BP50 - ptr to DRUG (#50)
"RTN","BPSRPT6",194,0)
 ;
"RTN","BPSRPT6",195,0)
 ; Return Value -> n = ptr to VA DRUG CLASS (#50.605)
"RTN","BPSRPT6",196,0)
 ;                 0 = Unknown
"RTN","BPSRPT6",197,0)
 ;
"RTN","BPSRPT6",198,0)
GETDRGCL(BP50) Q $$DRUGDIE^BPSUTIL1(BP50,25)
"RTN","BPSRPT6",199,0)
 ;
"RTN","BPSRPT6",200,0)
 ;Determine whether claim was Mail, Window, or CMOP
"RTN","BPSRPT6",201,0)
 ;
"RTN","BPSRPT6",202,0)
 ; Input Variables: BPREF - refill # (0-No Refills,1-1st Refill, 2-2nd, ...) 
"RTN","BPSRPT6",203,0)
 ;
"RTN","BPSRPT6",204,0)
 ; Return Value -> M = Mail
"RTN","BPSRPT6",205,0)
 ;                 W = Window
"RTN","BPSRPT6",206,0)
 ;                 C = CMOP
"RTN","BPSRPT6",207,0)
 ;
"RTN","BPSRPT6",208,0)
MWC(BPRX,BPREF) Q $$MWC^PSOBPSU2(BPRX,BPREF)
"RTN","BPSRPT6",209,0)
 ;
"RTN","BPSRPT6",210,0)
 ;Get Patient Name
"RTN","BPSRPT6",211,0)
 ;
"RTN","BPSRPT6",212,0)
 ; Input variable -> BPDFN - ptr to PATIENT (#2)
"RTN","BPSRPT6",213,0)
 ; Returned value -> Patient Name (shortened)
"RTN","BPSRPT6",214,0)
 ; 
"RTN","BPSRPT6",215,0)
PATNAME(BPDFN) Q $E($P($G(^DPT(BPDFN,0)),U),1,25)
"RTN","BPSRPT6",216,0)
 ;
"RTN","BPSRPT6",217,0)
 ;Get Last 4 of SSN
"RTN","BPSRPT6",218,0)
 ;
"RTN","BPSRPT6",219,0)
 ; Input variable -> BPDFN - ptr to PATIENT (#2)
"RTN","BPSRPT6",220,0)
 ; Returned value -> Last 4 digits of patient's SSN
"RTN","BPSRPT6",221,0)
 ; 
"RTN","BPSRPT6",222,0)
SSN4(BPDFN) N X
"RTN","BPSRPT6",223,0)
 S X=$P($G(^DPT(BPDFN,0)),U,9)
"RTN","BPSRPT6",224,0)
 Q $E(X,$L(X)-3,$L(X))
"RTN","BPSRPT6",225,0)
 ;
"RTN","BPSRPT6",226,0)
 ;Get RX#
"RTN","BPSRPT6",227,0)
 ;
"RTN","BPSRPT6",228,0)
 ; Returned value -> RX#
"RTN","BPSRPT6",229,0)
 ; 
"RTN","BPSRPT6",230,0)
RXNUM(BPRX) Q $$RXAPI1^BPSUTIL1(+BPRX,.01,"I")
"RTN","BPSRPT6",231,0)
 ;
"RTN","BPSRPT6",232,0)
 ;Determine $Collected
"RTN","BPSRPT6",233,0)
 ;
"RTN","BPSRPT6",234,0)
 ; Returned Value -> $Collected
"RTN","BPSRPT6",235,0)
 ;
"RTN","BPSRPT6",236,0)
COLLECTD(BPRX,BPREF) N COL,RET
"RTN","BPSRPT6",237,0)
 S RET=$$BILLINFO^IBNCPDPI(BPRX,BPREF)
"RTN","BPSRPT6",238,0)
 S COL=$P(RET,U,5) I COL="0",($P(RET,U,3)=16)!($P(RET,U,3)=27) S COL=""
"RTN","BPSRPT6",239,0)
 I $P(RET,U,7)=1 S COL="N/A"
"RTN","BPSRPT6",240,0)
 Q COL
"RTN","BPSRPT6",241,0)
 ;
"RTN","BPSRPT6",242,0)
 ;Determine Bill #
"RTN","BPSRPT6",243,0)
 ;
"RTN","BPSRPT6",244,0)
 ; Returned Value -> Bill Number
"RTN","BPSRPT6",245,0)
 ;
"RTN","BPSRPT6",246,0)
BILL(BPRX,BPREF) N BILL
"RTN","BPSRPT6",247,0)
 S BILL=$P($$BILLINFO^IBNCPDPI(BPRX,BPREF),U)
"RTN","BPSRPT6",248,0)
 Q BILL
"RTN","BPSRPT6",249,0)
 ;
"RTN","BPSRPT6",250,0)
 ;Get the Closed Claim Reason
"RTN","BPSRPT6",251,0)
 ;
"RTN","BPSRPT6",252,0)
 ; Input variable -> 0 for All Closed Claim Reasons or
"RTN","BPSRPT6",253,0)
 ;                   lookup to CLAIMS TRACKING NON-BILLABLE REASONS (#356.8)
"RTN","BPSRPT6",254,0)
 ; Returned value -> ALL or the selected Closed Claim Reason
"RTN","BPSRPT6",255,0)
 ; 
"RTN","BPSRPT6",256,0)
GETCLR(RSN) ;
"RTN","BPSRPT6",257,0)
 I RSN="0" S RSN="ALL"
"RTN","BPSRPT6",258,0)
 E  S RSN=$P($G(^IBE(356.8,+RSN,0)),U)
"RTN","BPSRPT6",259,0)
 Q RSN
"RTN","BPSRPT6",260,0)
 ;
"RTN","BPSRPT6",261,0)
 ;Get the Closed By Person
"RTN","BPSRPT6",262,0)
 ;
"RTN","BPSRPT6",263,0)
 ; Returned Value -> Closed By Name
"RTN","BPSRPT6",264,0)
 ; 
"RTN","BPSRPT6",265,0)
CLSBY(BP59) N BP02,CBY,Y
"RTN","BPSRPT6",266,0)
 S BP02=+$P($G(^BPST(BP59,0)),U,4)
"RTN","BPSRPT6",267,0)
 S CBY=+$P($G(^BPSC(BP02,900)),U,3)
"RTN","BPSRPT6",268,0)
 S Y=$$GET1^DIQ(200,CBY_",",".01")
"RTN","BPSRPT6",269,0)
 Q Y
"RTN","BPSRPT6",270,0)
 ;
"RTN","BPSRPT6",271,0)
 ;Get the Claim Status
"RTN","BPSRPT6",272,0)
 ;
"RTN","BPSRPT6",273,0)
 ; Input Variables: BPREF - refill # (0-No Refills,1-1st Refill, 2-2nd, ...) 
"RTN","BPSRPT6",274,0)
 ;
"RTN","BPSRPT6",275,0)
STATUS(BPRX,BPREF) Q $$STATUS^BPSOSRX(BPRX,BPREF,0)
"RTN","BPSRPT6",276,0)
 ;
"RTN","BPSRPT6",277,0)
 ;Elapsed Time
"RTN","BPSRPT6",278,0)
 ;
"RTN","BPSRPT6",279,0)
 ; Returned Value -> TIME - Elapsed Processing Time
"RTN","BPSRPT6",280,0)
 ; 
"RTN","BPSRPT6",281,0)
ELAPSE(BP59) Q $$TIMEDIFI^BPSOSUD($P($G(^BPST(BP59,0)),U,11),$P($G(^BPST(BP59,0)),U,8))
"RTN","BPSRPT6",282,0)
 ;
"RTN","BPSRPT6",283,0)
 ;Get RX issue date
"RTN","BPSRPT6",284,0)
 ;
"RTN","BPSRPT6",285,0)
RXISSDT(BPRX) Q +$$RXAPI1^BPSUTIL1(BPRX,1,"I")
"RTN","BPSRPT6",286,0)
 ;
"RTN","BPSRPT6",287,0)
 ;
"RTN","BPSRPT6",288,0)
 ;Get RX's fill date
"RTN","BPSRPT6",289,0)
RXFILDT(BPRX) Q +$$RXAPI1^BPSUTIL1(BPRX,22,"I")
"RTN","BPSRPT6",290,0)
 ;
"RTN","BPSRPT6",291,0)
 ;Get Refill's issue date
"RTN","BPSRPT6",292,0)
 ;
"RTN","BPSRPT6",293,0)
REFISSDT(BPRX,BPREF) Q $$REFDISDT(BPRX,BPREF)
"RTN","BPSRPT6",294,0)
 ;
"RTN","BPSRPT6",295,0)
 ;Get Refill's dispense date
"RTN","BPSRPT6",296,0)
 ;
"RTN","BPSRPT6",297,0)
REFDISDT(BPRX,BPREF) Q +$$RXSUBF1^BPSUTIL1(BPRX,52,52.1,+BPREF,10.1,"I")
"RTN","BPSRPT6",298,0)
 ;
"RTN","BPSRPT6",299,0)
 ;Get Refill's refill date
"RTN","BPSRPT6",300,0)
 ;
"RTN","BPSRPT6",301,0)
REFFILDT(BPRX,BPREF) Q +$$RXSUBF1^BPSUTIL1(BPRX,52,52.1,+BPREF,.01,"I")
"RTN","BPSRPT6",302,0)
 ;
"RTN","BPSRPT6",303,0)
 ;Get RX's release date
"RTN","BPSRPT6",304,0)
 ;
"RTN","BPSRPT6",305,0)
RXRELDT(BPRX) Q +$$RXAPI1^BPSUTIL1(BPRX,31,"I")
"RTN","BPSRPT6",306,0)
 ;
"RTN","BPSRPT6",307,0)
 ;Get Refill's release date
"RTN","BPSRPT6",308,0)
 ;
"RTN","BPSRPT6",309,0)
REFRELDT(BPRX,BPREF) Q +$$RXSUBF1^BPSUTIL1(BPRX,52,52.1,+BPREF,17,"I")
"RTN","BPSRPT6",310,0)
 ;
"RTN","BPSRPT6",311,0)
 ;See if refill exists
"RTN","BPSRPT6",312,0)
 ;
"RTN","BPSRPT6",313,0)
IFREFILL(BPRX,BPREF) Q $S(+$$RXSUBF1^BPSUTIL1(BPRX,52,52.1,+BPREF,.01,"I"):1,1:0)
"RTN","BPSRPT6",314,0)
 ;
"RTN","BPSRPT6",315,0)
 ;Get RX status
"RTN","BPSRPT6",316,0)
 ;
"RTN","BPSRPT6",317,0)
 ; Input Variables -> BP59 = ptr to BPS TRANSACTIONS
"RTN","BPSRPT6",318,0)
 ;                            
"RTN","BPSRPT6",319,0)
RXSTATUS(BP59) Q $$RXST^BPSSCRU2(BP59)
"RTN","BPSRPT6",320,0)
 ;
"RTN","BPSRPT6",321,0)
 ;Return RX Quantity (From BPS TRANSACTION)
"RTN","BPSRPT6",322,0)
 ;
"RTN","BPSRPT6",323,0)
QTY(BP59) Q +$P($G(^BPST(BP59,5)),U,1)
"RTN","BPSRPT6",324,0)
 ;
"RTN","BPSRPT6",325,0)
 ;Return NDC Number
"RTN","BPSRPT6",326,0)
GETNDC(BPRX,BPREF) Q $$GETNDC^PSONDCUT(BPRX,BPREF)
"RTN","BPSRPT6",327,0)
 ;
"RTN","BPSRPT6",328,0)
 ;Return Copay Status ($)
"RTN","BPSRPT6",329,0)
COPAY(BPRX) Q $S(+$$RXAPI1^BPSUTIL1(BPRX,105,"I"):"$",1:"")
"RTN","BPSRPT7")
0^26^B77006502
"RTN","BPSRPT7",1,0)
BPSRPT7 ;BHAM ISC/BEE - ECME REPORTS ;14-FEB-05
"RTN","BPSRPT7",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,3,5,7**;JUN 2004;Build 46
"RTN","BPSRPT7",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSRPT7",4,0)
 ;
"RTN","BPSRPT7",5,0)
 Q
"RTN","BPSRPT7",6,0)
 ;
"RTN","BPSRPT7",7,0)
 ;Routine to Display the Reports (Continued)
"RTN","BPSRPT7",8,0)
 ;
"RTN","BPSRPT7",9,0)
 ; Input Variables -> BPCLM = Array of report data by date
"RTN","BPSRPT7",10,0)
 ;                   BPDIV,BPSUMDET,GTOT
"RTN","BPSRPT7",11,0)
 ; Returned Value -> Cumulative Grand Totals
"RTN","BPSRPT7",12,0)
 ; 
"RTN","BPSRPT7",13,0)
PTBDT(BPDIV,BPSUMDET,BPCLM,GTOT) N DIFF,I,NP,RDT,TOT,X
"RTN","BPSRPT7",14,0)
 ;
"RTN","BPSRPT7",15,0)
 ;Loop through compiled array and display
"RTN","BPSRPT7",16,0)
 S TOT=""
"RTN","BPSRPT7",17,0)
 S RDT="" F  S RDT=$O(BPCLM(RDT)) Q:RDT=""  D  Q:BPQ
"RTN","BPSRPT7",18,0)
 .S NP=$$CHKP^BPSRPT5(1) Q:BPQ
"RTN","BPSRPT7",19,0)
 .S X=$G(BPCLM(RDT))
"RTN","BPSRPT7",20,0)
 .;
"RTN","BPSRPT7",21,0)
 .;Print Details - Report
"RTN","BPSRPT7",22,0)
 .I BPSUMDET=0,'BPEXCEL D
"RTN","BPSRPT7",23,0)
 ..W !,$$DATTIM^BPSRPT1(RDT) ;Date
"RTN","BPSRPT7",24,0)
 ..W ?15,$J(+$P(X,U),17) ;#Claims
"RTN","BPSRPT7",25,0)
 ..W ?33,$J(+$P(X,U,2),17,2)  ;Amount Submitted
"RTN","BPSRPT7",26,0)
 ..W ?51,$J(+$P(X,U,3),17,2)  ;Returned Rejected
"RTN","BPSRPT7",27,0)
 ..W ?69,$J(+$P(X,U,4),17,2)  ;Returned Payable
"RTN","BPSRPT7",28,0)
 ..W ?87,$J(+$P(X,U,5),17,2)  ;Amount to Receive
"RTN","BPSRPT7",29,0)
 ..;
"RTN","BPSRPT7",30,0)
 ..;Difference
"RTN","BPSRPT7",31,0)
 ..S DIFF=+$P(X,U,4)-$P(X,U,5)
"RTN","BPSRPT7",32,0)
 ..I DIFF<0 S DIFF="<"_$TR($J(-DIFF,15,2)," ")_">" W ?117,$J(DIFF,15)
"RTN","BPSRPT7",33,0)
 ..E  W ?116,$J(DIFF,15,2)
"RTN","BPSRPT7",34,0)
 ..;
"RTN","BPSRPT7",35,0)
 ..;Print Details - Excel
"RTN","BPSRPT7",36,0)
 .I BPSUMDET=0,BPEXCEL D
"RTN","BPSRPT7",37,0)
 ..;
"RTN","BPSRPT7",38,0)
 ..;Division
"RTN","BPSRPT7",39,0)
 ..W !,$S(BPDIV=0:"BLANK",$$DIVNAME^BPSSCRDS(BPDIV)]"":$$DIVNAME^BPSSCRDS(BPDIV),1:BPDIV),U
"RTN","BPSRPT7",40,0)
 ..W $$DATTIM^BPSRPT1(RDT),U  ;Date
"RTN","BPSRPT7",41,0)
 ..W +$P(X,U),U ;#Claims
"RTN","BPSRPT7",42,0)
 ..W $TR($J(+$P(X,U,2),17,2)," "),U  ;Amount Submitted
"RTN","BPSRPT7",43,0)
 ..W $TR($J(+$P(X,U,3),17,2)," "),U  ;Returned Rejected
"RTN","BPSRPT7",44,0)
 ..W $TR($J(+$P(X,U,4),17,2)," "),U  ;Returned Payable
"RTN","BPSRPT7",45,0)
 ..W $TR($J(+$P(X,U,5),17,2)," "),U  ;Amount to Receive
"RTN","BPSRPT7",46,0)
 ..;
"RTN","BPSRPT7",47,0)
 ..;Difference
"RTN","BPSRPT7",48,0)
 ..S DIFF=+$P(X,U,4)-$P(X,U,5)
"RTN","BPSRPT7",49,0)
 ..W $TR($J(DIFF,15,2)," ")
"RTN","BPSRPT7",50,0)
 .;
"RTN","BPSRPT7",51,0)
 .;Save Totals
"RTN","BPSRPT7",52,0)
 .F I=1:1:5 S $P(TOT,U,I)=$P(TOT,U,I)+$P(X,U,I),$P(GTOT,U,I)=$P($G(GTOT),U,I)+$P(X,U,I)
"RTN","BPSRPT7",53,0)
 ;
"RTN","BPSRPT7",54,0)
 ;Print Totals
"RTN","BPSRPT7",55,0)
 Q:BPEXCEL
"RTN","BPSRPT7",56,0)
 Q:BPQ  S NP=$$CHKP^BPSRPT5(2) Q:BPQ
"RTN","BPSRPT7",57,0)
 D ULINE^BPSRPT5("-")
"RTN","BPSRPT7",58,0)
 W !,"TOTALS"
"RTN","BPSRPT7",59,0)
 W ?15,$J(+$P(TOT,U),17)
"RTN","BPSRPT7",60,0)
 W ?33,$J(+$P(TOT,U,2),17,2)
"RTN","BPSRPT7",61,0)
 W ?51,$J(+$P(TOT,U,3),17,2)
"RTN","BPSRPT7",62,0)
 W ?69,$J(+$P(TOT,U,4),17,2)
"RTN","BPSRPT7",63,0)
 W ?87,$J(+$P(TOT,U,5),17,2)
"RTN","BPSRPT7",64,0)
 S X=$S((+$P(TOT,U,4))=0:0,1:(+$P(TOT,U,5))/(+$P(TOT,U,4)))
"RTN","BPSRPT7",65,0)
 S DIFF=+$P(TOT,U,4)-$P(TOT,U,5)
"RTN","BPSRPT7",66,0)
 I DIFF<0 S DIFF="<"_$TR($J(-DIFF,15,2)," ")_">" W ?117,$J(DIFF,15)
"RTN","BPSRPT7",67,0)
 E  W ?116,$J(DIFF,15,2)
"RTN","BPSRPT7",68,0)
 Q
"RTN","BPSRPT7",69,0)
 ;
"RTN","BPSRPT7",70,0)
 ;Print Grand Totals - Report 6
"RTN","BPSRPT7",71,0)
 ;
"RTN","BPSRPT7",72,0)
PGTOT6(GTOT) N DIFF,NP,X
"RTN","BPSRPT7",73,0)
 Q:BPQ  S NP=$$CHKP^BPSRPT5(2) Q:BPQ
"RTN","BPSRPT7",74,0)
 D ULINE^BPSRPT5("-")
"RTN","BPSRPT7",75,0)
 W !,"GRAND TOTALS"
"RTN","BPSRPT7",76,0)
 W ?15,$J(+$P(GTOT,U),17)
"RTN","BPSRPT7",77,0)
 W ?33,$J(+$P(GTOT,U,2),17,2)
"RTN","BPSRPT7",78,0)
 W ?51,$J(+$P(GTOT,U,3),17,2)
"RTN","BPSRPT7",79,0)
 W ?69,$J(+$P(GTOT,U,4),17,2)
"RTN","BPSRPT7",80,0)
 W ?87,$J(+$P(GTOT,U,5),17,2)
"RTN","BPSRPT7",81,0)
 S X=$S((+$P(GTOT,U,4))=0:0,1:(+$P(GTOT,U,5))/(+$P(GTOT,U,4)))
"RTN","BPSRPT7",82,0)
 S DIFF=+$P(GTOT,U,4)-$P(GTOT,U,5)
"RTN","BPSRPT7",83,0)
 I DIFF<0 S DIFF="<"_$TR($J(-DIFF,15,2)," ")_">" W ?117,$J(DIFF,15)
"RTN","BPSRPT7",84,0)
 E  W ?116,$J(DIFF,15,2)
"RTN","BPSRPT7",85,0)
 Q
"RTN","BPSRPT7",86,0)
 ;
"RTN","BPSRPT7",87,0)
 ;Print Grand Totals - Reports 1,2,3,4,5,7
"RTN","BPSRPT7",88,0)
 ;
"RTN","BPSRPT7",89,0)
PGTOT(BPRTYPE,BPGBIL,BPGINS,BPGCOLL,BPGCNT,BPGELTM) ;
"RTN","BPSRPT7",90,0)
 I (BPRTYPE=1)!(BPRTYPE=4) D  Q
"RTN","BPSRPT7",91,0)
 .W !!,?78,"----------",?100,"----------",?122,"----------"
"RTN","BPSRPT7",92,0)
 .W !,"GRAND TOTALS",?78,$J(BPGBIL,10,2),?100,$J(BPGINS,10,2),?122,$J(BPGCOLL,10,2)
"RTN","BPSRPT7",93,0)
 .W !,"COUNT",?78,$J(BPGCNT,10),?100,$J(BPGCNT,10),?122,$J(BPGCNT,10)
"RTN","BPSRPT7",94,0)
 .W:BPGCNT !,"MEAN",?78,$J(BPGBIL/BPGCNT,10,2),?100,$J(BPGINS/BPGCNT,10,2),?122,$J(BPGCOLL/BPGCNT,10,2)
"RTN","BPSRPT7",95,0)
 I BPRTYPE=3 D  Q
"RTN","BPSRPT7",96,0)
 .W !!,?100,"----------",?122,"----------"
"RTN","BPSRPT7",97,0)
 .W !,"GRAND TOTALS",?100,$J(BPGBIL,10,2),?122,$J(BPGINS,10,2)
"RTN","BPSRPT7",98,0)
 .W !,"COUNT",?100,$J(BPGCNT,10),?122,$J(BPGCNT,10)
"RTN","BPSRPT7",99,0)
 .W:BPGCNT !,"MEAN",?100,$J(BPGBIL/BPGCNT,10,2),?122,$J(BPGINS/BPGCNT,10,2)
"RTN","BPSRPT7",100,0)
 I BPRTYPE=2 D  Q
"RTN","BPSRPT7",101,0)
 .W !!,?41,"----------"
"RTN","BPSRPT7",102,0)
 .W !,"GRAND TOTALS",?41,$J(BPGBIL,10,2)
"RTN","BPSRPT7",103,0)
 .W !,"COUNT",?41,$J(BPGCNT,10)
"RTN","BPSRPT7",104,0)
 .W:BPGCNT !,"MEAN",?41,$J(BPGBIL/BPGCNT,10,2)
"RTN","BPSRPT7",105,0)
 I (BPRTYPE=5) D  Q
"RTN","BPSRPT7",106,0)
 .W !!,"GRAND TOTALS (ALL DIVISIONS)",?65,"---------------"
"RTN","BPSRPT7",107,0)
 .W !,"TOTAL CLAIMS",?65,$J(BPGCNT,15)
"RTN","BPSRPT7",108,0)
 .W !,"AVERAGE ELAPSED TIME PER CLAIM",?65,$J($S(BPGCNT=0:"0",1:(BPGELTM\BPGCNT)),15)
"RTN","BPSRPT7",109,0)
 I (BPRTYPE=7) D  Q
"RTN","BPSRPT7",110,0)
 .W !!,"GRAND TOTALS (ALL DIVISIONS) BY BILLER"
"RTN","BPSRPT7",111,0)
 .N BPBILR,BPDIV S BPDIV="ALL DIVISIONS"
"RTN","BPSRPT7",112,0)
 .S BPBILR="" F  S BPBILR=$O(BPGCNT(BPBILR)) Q:BPBILR=""  D  Q:BPQ
"RTN","BPSRPT7",113,0)
 ..S NP=$$CHKP^BPSRPT5(1) Q:BPQ
"RTN","BPSRPT7",114,0)
 ..W !,?3,BPBILR,?65,$J($G(BPGCNT(BPBILR)),5)
"RTN","BPSRPT7",115,0)
 .Q:$G(BPQ)
"RTN","BPSRPT7",116,0)
 .W !,?65,"-----"
"RTN","BPSRPT7",117,0)
 .W !,"CLOSED CLAIMS GRAND TOTAL",?65,$J(BPGCNT,5)
"RTN","BPSRPT7",118,0)
 ;
"RTN","BPSRPT7",119,0)
 Q
"RTN","BPSRPT7",120,0)
 ;
"RTN","BPSRPT7",121,0)
 ;Get Close Reason
"RTN","BPSRPT7",122,0)
 ;
"RTN","BPSRPT7",123,0)
 ; Input Variable -> BP59 = ptr to BPS TRANSACTIONS
"RTN","BPSRPT7",124,0)
 ; Returned Value -> Claim Close Reason
"RTN","BPSRPT7",125,0)
 ;
"RTN","BPSRPT7",126,0)
CLRSN(BP59) N BP02,CIEN,CL
"RTN","BPSRPT7",127,0)
 S CL=""
"RTN","BPSRPT7",128,0)
 S BP02=+$P($G(^BPST(BP59,0)),U,4)
"RTN","BPSRPT7",129,0)
 S CIEN=+$P($G(^BPSC(BP02,900)),U,4)
"RTN","BPSRPT7",130,0)
 I CIEN'=0 S CL=$$GETCLR^BPSRPT6(CIEN)
"RTN","BPSRPT7",131,0)
 Q CIEN_"^"_CL
"RTN","BPSRPT7",132,0)
 ;
"RTN","BPSRPT7",133,0)
 ;Get Reversal Reason
"RTN","BPSRPT7",134,0)
 ;
"RTN","BPSRPT7",135,0)
 ; Input Variable -> BP59 = ptr to BPS TRANSACTIONS
"RTN","BPSRPT7",136,0)
 ; Returned Value -> Claim Reversal Reason
"RTN","BPSRPT7",137,0)
 ;
"RTN","BPSRPT7",138,0)
RVSRSN(BP59) Q $P($G(^BPST(BP59,4)),U,4)
"RTN","BPSRPT7",139,0)
 ;
"RTN","BPSRPT7",140,0)
 ;Return the Billed Amount
"RTN","BPSRPT7",141,0)
 ;
"RTN","BPSRPT7",142,0)
BILLED(BP59) ;
"RTN","BPSRPT7",143,0)
 Q +$P($G(^BPST(BP59,5)),U,5)
"RTN","BPSRPT7",144,0)
 ;
"RTN","BPSRPT7",145,0)
 ;Return the Transaction Type - SUBMIT or REVERSAL
"RTN","BPSRPT7",146,0)
 ;
"RTN","BPSRPT7",147,0)
TTYPE(BPRX,BPREF) N BPSTATUS,TTYPE
"RTN","BPSRPT7",148,0)
 S TTYPE="SUBMIT"
"RTN","BPSRPT7",149,0)
 S BPSTATUS=$$STATUS^BPSRPT6(BPRX,BPREF)
"RTN","BPSRPT7",150,0)
 I BPSTATUS["REVERSAL" S TTYPE="REVERSAL"
"RTN","BPSRPT7",151,0)
 Q TTYPE
"RTN","BPSRPT7",152,0)
 ;
"RTN","BPSRPT7",153,0)
 ;Return the payer response
"RTN","BPSRPT7",154,0)
 ;
"RTN","BPSRPT7",155,0)
RESPONSE(BPRX,BPREF) Q $P($$STATUS^BPSRPT6(BPRX,BPREF),U)
"RTN","BPSRPT7",156,0)
 ;
"RTN","BPSRPT7",157,0)
 ;Print Report Subtotals
"RTN","BPSRPT7",158,0)
 ;
"RTN","BPSRPT7",159,0)
TOTALS(BPRTYPE,BPDIV,BPTBIL,BPTINS,BPTCOLL,BPCNT,BPELTM) ;
"RTN","BPSRPT7",160,0)
 I (BPRTYPE=1)!(BPRTYPE=4) D  Q
"RTN","BPSRPT7",161,0)
 .W !!,?78,"----------",?100,"----------",?122,"----------"
"RTN","BPSRPT7",162,0)
 .W !,"SUBTOTALS for DIV:",$E($$BPDIV(BPDIV),1,52),?78,$J(BPTBIL,10,2),?100,$J(BPTINS,10,2),?122,$J(BPTCOLL,10,2)
"RTN","BPSRPT7",163,0)
 .W !,"COUNT",?78,$J(BPCNT,10),?100,$J(BPCNT,10),?122,$J(BPCNT,10)
"RTN","BPSRPT7",164,0)
 .W:BPCNT !,"MEAN",?78,$J(BPTBIL/BPCNT,10,2),?100,$J(BPTINS/BPCNT,10,2),?122,$J(BPTCOLL/BPCNT,10,2)
"RTN","BPSRPT7",165,0)
 I BPRTYPE=3 D  Q
"RTN","BPSRPT7",166,0)
 .W !!,?100,"----------",?122,"----------"
"RTN","BPSRPT7",167,0)
 .W !,"SUBTOTALS for DIV:",$E($$BPDIV(BPDIV),1,52),?100,$J(BPTBIL,10,2),?122,$J(BPTINS,10,2)
"RTN","BPSRPT7",168,0)
 .W !,"COUNT",?100,$J(BPCNT,10),?122,$J(BPCNT,10)
"RTN","BPSRPT7",169,0)
 .W:BPCNT !,"MEAN",?100,$J(BPTBIL/BPCNT,10,2),?122,$J(BPTINS/BPCNT,10,2)
"RTN","BPSRPT7",170,0)
 I BPRTYPE=2 D  Q
"RTN","BPSRPT7",171,0)
 .W !!,?41,"----------"
"RTN","BPSRPT7",172,0)
 .W !,"SUBTOTALS for DIV:",$E($$BPDIV(BPDIV),1,22),?41,$J(BPTBIL,10,2)
"RTN","BPSRPT7",173,0)
 .W !,"COUNT",?41,$J(BPCNT,10)
"RTN","BPSRPT7",174,0)
 .W:BPCNT !,"MEAN",?41,$J(BPTBIL/BPCNT,10,2)
"RTN","BPSRPT7",175,0)
 I (BPRTYPE=5) D  Q
"RTN","BPSRPT7",176,0)
 .W !!,"SUBTOTALS for DIV: ",$E($$BPDIV(BPDIV),1,43),?65,"---------------"
"RTN","BPSRPT7",177,0)
 .W !,"TOTAL CLAIMS",?65,$J(BPCNT,15)
"RTN","BPSRPT7",178,0)
 .W !,"AVERAGE ELAPSED TIME PER CLAIM",?65,$J($S(BPCNT=0:"0",1:(BPELTM\BPCNT)),15)
"RTN","BPSRPT7",179,0)
 I (BPRTYPE=7) D  Q
"RTN","BPSRPT7",180,0)
 .W !!,"SUBTOTALS for DIV:",$E($$BPDIV(BPDIV),1,43)
"RTN","BPSRPT7",181,0)
 .N BPBILR
"RTN","BPSRPT7",182,0)
 .S BPBILR="" F  S BPBILR=$O(BPCNT(BPBILR)) Q:BPBILR=""  D  Q:BPQ
"RTN","BPSRPT7",183,0)
 ..S NP=$$CHKP^BPSRPT5(1) Q:BPQ
"RTN","BPSRPT7",184,0)
 ..W !,?3,BPBILR,?65,$J($G(BPCNT(BPBILR)),5)
"RTN","BPSRPT7",185,0)
 .Q:$G(BPQ)
"RTN","BPSRPT7",186,0)
 .W !,?65,"-----"
"RTN","BPSRPT7",187,0)
 .W !,"CLOSED CLAIMS SUBTOTAL",?65,$J(BPCNT,5)
"RTN","BPSRPT7",188,0)
 ;
"RTN","BPSRPT7",189,0)
 Q
"RTN","BPSRPT7",190,0)
 ;
"RTN","BPSRPT7",191,0)
 ;Print Report Header
"RTN","BPSRPT7",192,0)
 ; Input variables (defined in BPSRPT0) - BPPHARM,BPSUMDET,BPNOW,BPMWC,BPRTBCK,BPINSINF
"RTN","BPSRPT7",193,0)
 ;                                        BPREJCD,BPCCRSN,BPAUTREV,BPACREJ,BPQSTDRG
"RTN","BPSRPT7",194,0)
 ;                                        BPDRUG,BPDRGCL,BPRLNRL,BPSORT,BPBEGDT,BPENDDT
"RTN","BPSRPT7",195,0)
 ; Output variable - BPSDATA -> Reset to 0 to show no actual data has been printed
"RTN","BPSRPT7",196,0)
 ;                           on the screen
"RTN","BPSRPT7",197,0)
 ;                   BPPAGE -> First set in BPSRPT0
"RTN","BPSRPT7",198,0)
 ;                   BPBLINE -> Controls whether to print a blank line
"RTN","BPSRPT7",199,0)
 ;                   
"RTN","BPSRPT7",200,0)
HDR(BPRTYPE,BPRPTNAM,BPPAGE) ;
"RTN","BPSRPT7",201,0)
 ;Display Excel Header
"RTN","BPSRPT7",202,0)
 I BPEXCEL D HDR^BPSRPT8(BPRTYPE) Q
"RTN","BPSRPT7",203,0)
 ;
"RTN","BPSRPT7",204,0)
 ; Define BPPDATA - Tells whether data has been displayed for a screen
"RTN","BPSRPT7",205,0)
 S BPSDATA=0
"RTN","BPSRPT7",206,0)
 S BPBLINE=""
"RTN","BPSRPT7",207,0)
 S BPPAGE=$G(BPPAGE)+1
"RTN","BPSRPT7",208,0)
 W @IOF
"RTN","BPSRPT7",209,0)
 W "ECME "_BPRPTNAM_" "_$S(BPSUMDET=1:"SUMMARY",1:"DETAIL")_" REPORT"
"RTN","BPSRPT7",210,0)
 W ?89,"Print Date: "_$G(BPNOW)_"  Page:",$J(BPPAGE,3)
"RTN","BPSRPT7",211,0)
 W !,"DIVISION(S): ",$$GETDIVS^BPSRPT4(75,.BPPHARM)
"RTN","BPSRPT7",212,0)
 W ?93,"Fill Locations: "_$S(BPMWC="A":"C,M,W",1:BPMWC)
"RTN","BPSRPT7",213,0)
 W ?116,"Fill type: "_$S(BPRTBCK=2:"RT",BPRTBCK=3:"BB",1:"RT,BB")
"RTN","BPSRPT7",214,0)
 W !,"Insurance: "_$S(BPINSINF=0:"ALL",1:$$BPINS(BPINSINF))
"RTN","BPSRPT7",215,0)
 I (",7,")[BPRTYPE W ?44,"Close Reason: ",$E($$GETCLR^BPSRPT6(BPCCRSN),1,26)
"RTN","BPSRPT7",216,0)
 I (",4,")[BPRTYPE W ?44,$J($S(BPAUTREV=0:"ALL",1:"AUTO"),4)," Reversals"
"RTN","BPSRPT7",217,0)
 I (",4,")[BPRTYPE W ?60,$J($S(BPACREJ=1:"REJECTED",BPACREJ=2:"ACCEPTED",1:"ALL"),8)," Returned Status"
"RTN","BPSRPT7",218,0)
 W ?87,"Drugs/Classes: "_$S(BPQSTDRG=2:$$DRGNAM^BPSRPT6(BPDRUG,30),BPQSTDRG=3:$E(BPDRGCL,1,30),1:"ALL")
"RTN","BPSRPT7",219,0)
 I (",2,")[BPRTYPE W !,"Reject Code: ",$E($$GETREJ^BPSRPT4(BPREJCD),1,28),?89,"Elibility: ",$S(BPELIG="V":"VET",BPELIG="T":"TRI",1:"ALL"),?111,"Open/Closed: ",$S(BPOPCL=1:"CLOSED",BPOPCL=2:"OPEN",1:"ALL")
"RTN","BPSRPT7",220,0)
 W !,$S(BPRTYPE=5:"PRESCRIPTIONS",BPRLNRL=2:"RELEASED PRESCRIPTIONS",BPRLNRL=3:"PRESCRIPTIONS (NOT RELEASED)",1:"ALL PRESCRIPTIONS")
"RTN","BPSRPT7",221,0)
 W " BY "_$S(BPRTYPE=7:"CLOSE",1:"TRANSACTION")_" DATE: "
"RTN","BPSRPT7",222,0)
 W "From "_$$DATTIM^BPSRPT1(BPBEGDT)_" through "_$$DATTIM^BPSRPT1($P(BPENDDT,"."))
"RTN","BPSRPT7",223,0)
 ;
"RTN","BPSRPT7",224,0)
 D ULINE^BPSRPT5("=") Q:$G(BPQ)
"RTN","BPSRPT7",225,0)
 D HEADLN1^BPSRPT4(BPRTYPE)
"RTN","BPSRPT7",226,0)
 D HEADLN2^BPSRPT4(BPRTYPE)
"RTN","BPSRPT7",227,0)
 D HEADLN3^BPSRPT4(BPRTYPE)
"RTN","BPSRPT7",228,0)
 D ULINE^BPSRPT5("=")
"RTN","BPSRPT7",229,0)
 ;
"RTN","BPSRPT7",230,0)
 ;Print Division
"RTN","BPSRPT7",231,0)
 I $G(BPDIV)]"" D
"RTN","BPSRPT7",232,0)
 .W !,"DIVISION: ",$S(BPDIV=0:"BLANK",BPDIV="ALL DIVISIONS":"ALL DIVISIONS",$$DIVNAME^BPSSCRDS(BPDIV)]"":$$DIVNAME^BPSSCRDS(BPDIV),1:BPDIV)
"RTN","BPSRPT7",233,0)
 .I BPRTYPE=5!(BPRTYPE=6)!(BPSUMDET=1)!(BPGRPLAN="") D ULINE^BPSRPT5("-")
"RTN","BPSRPT7",234,0)
 ;
"RTN","BPSRPT7",235,0)
 ;Print Insurance If Defined
"RTN","BPSRPT7",236,0)
 I BPSUMDET=0,$G(BPGRPLAN)]"",$G(BPGRPLAN)'=0,$G(BPGRPLAN)'="~" D WRPLAN^BPSRPT5(BPGRPLAN)
"RTN","BPSRPT7",237,0)
 Q
"RTN","BPSRPT7",238,0)
 ;
"RTN","BPSRPT7",239,0)
 ;Special Division Handling
"RTN","BPSRPT7",240,0)
 ;
"RTN","BPSRPT7",241,0)
BPDIV(BPDIV) Q $S(BPDIV=0:"BLANK",$$DIVNAME^BPSSCRDS(BPDIV)]"":$$DIVNAME^BPSSCRDS(BPDIV),1:BPDIV)
"RTN","BPSRPT7",242,0)
 ;
"RTN","BPSRPT7",243,0)
 ;Get selected insurance names based on user selection
"RTN","BPSRPT7",244,0)
 ;If length is greater than 68 append "..."
"RTN","BPSRPT7",245,0)
 ;Input: BPINSINF = Semi-colon separated list of file 36 IENs
"RTN","BPSRPT7",246,0)
 ;Output: comma separated list of related file 36 names
"RTN","BPSRPT7",247,0)
BPINS(BPINSINF) ;
"RTN","BPSRPT7",248,0)
 N BPINS,BPINAME,RETV
"RTN","BPSRPT7",249,0)
 S RETV=""
"RTN","BPSRPT7",250,0)
 F I=2:1 S BPINS=$P($G(BPINSINF),";",I) Q:BPINS=""  D
"RTN","BPSRPT7",251,0)
 . S BPINAME=$$INSNM^IBNCPDPI(BPINS) Q:BPINAME=""
"RTN","BPSRPT7",252,0)
 . I RETV'="" S RETV=RETV_", "_BPINAME Q
"RTN","BPSRPT7",253,0)
 . S RETV=BPINAME
"RTN","BPSRPT7",254,0)
 I $L(RETV)>68 S RETV=$E(RETV,1,68)_"..."
"RTN","BPSRPT7",255,0)
 Q RETV
"RTN","BPSRPT8")
0^27^B78632943
"RTN","BPSRPT8",1,0)
BPSRPT8 ;BHAM ISC/BEE - ECME REPORTS ;14-FEB-05
"RTN","BPSRPT8",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,3,5,7**;JUN 2004;Build 46
"RTN","BPSRPT8",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSRPT8",4,0)
 ;
"RTN","BPSRPT8",5,0)
 Q
"RTN","BPSRPT8",6,0)
 ;
"RTN","BPSRPT8",7,0)
 ;Routine to Display the Reports in Excel
"RTN","BPSRPT8",8,0)
 ;
"RTN","BPSRPT8",9,0)
 ;Print Report Line 1
"RTN","BPSRPT8",10,0)
 ;
"RTN","BPSRPT8",11,0)
 ; Input Variable -> BPRTYPE,BPDIV,BPGRPLAN,BPDFN,BPRX,BPREF,BPX,BPSRTDT
"RTN","BPSRPT8",12,0)
 ;                   BPBIL,BPINS,BPCOLL
"RTN","BPSRPT8",13,0)
 ; 
"RTN","BPSRPT8",14,0)
WRLINE1(BPRTYPE,BPREC,BPDIV,BPGRPLAN,BPDFN,BPRX,BPREF,BPX,BPSRTDT,BPBIL,BPINS,BPCOLL) ;
"RTN","BPSRPT8",15,0)
 ;
"RTN","BPSRPT8",16,0)
 ;Division
"RTN","BPSRPT8",17,0)
 S BPREC=$S(BPDIV=0:"BLANK",$$DIVNAME^BPSSCRDS(BPDIV)]"":$$DIVNAME^BPSSCRDS(BPDIV),1:BPDIV)_U
"RTN","BPSRPT8",18,0)
 ;Insurance
"RTN","BPSRPT8",19,0)
 I BPRTYPE'=5,BPRTYPE'=6 S BPREC=BPREC_$E(BPGRPLAN,1,90)_U
"RTN","BPSRPT8",20,0)
 S BPREC=BPREC_$$PATNAME^BPSRPT6(BPDFN)_U  ;Patient Name
"RTN","BPSRPT8",21,0)
 S BPREC=BPREC_"("_$$SSN4^BPSRPT6(BPDFN)_")"_U ;L4SSN
"RTN","BPSRPT8",22,0)
 S BPREC=BPREC_$$RXNUM^BPSRPT6(BPRX)_$$COPAY^BPSRPT6(BPRX)_U ;RX Number
"RTN","BPSRPT8",23,0)
 S BPREC=BPREC_BPREF_"/"_$$ECMENUM^BPSRPT1($P(BPX,U,3))_U ;Refill/ECME Number
"RTN","BPSRPT8",24,0)
 ;
"RTN","BPSRPT8",25,0)
 I (BPRTYPE=1)!(BPRTYPE=4) D  Q
"RTN","BPSRPT8",26,0)
 . S BPREC=BPREC_$$DATTIM^BPSRPT1(BPSRTDT)_U  ;Date
"RTN","BPSRPT8",27,0)
 . S BPREC=BPREC_$TR($J(BPBIL,10,2)," ")_U ;$Billed
"RTN","BPSRPT8",28,0)
 . S BPREC=BPREC_$TR($J(BPINS,10,2)," ")_U ;$Ins. Paid
"RTN","BPSRPT8",29,0)
 . S BPREC=BPREC_$S(BPCOLL]"":$TR($J(BPCOLL,10,2)," "),1:"")_U ;$Collected
"RTN","BPSRPT8",30,0)
 ;
"RTN","BPSRPT8",31,0)
 I BPRTYPE=2 D  Q
"RTN","BPSRPT8",32,0)
 . S BPREC=BPREC_$$DATTIM^BPSRPT1(BPSRTDT)_U ;Date
"RTN","BPSRPT8",33,0)
 . S BPREC=BPREC_$$DATTIM^BPSRPT1(+BPX)_U  ;Released On
"RTN","BPSRPT8",34,0)
 . ;RX INFO
"RTN","BPSRPT8",35,0)
 . S BPREC=BPREC_$$MWC^BPSRPT6(BPRX,BPREF)_U ;Fill Location
"RTN","BPSRPT8",36,0)
 . S BPREC=BPREC_$$RTBCKNAM^BPSRPT1($$RTBCK^BPSRPT1($P(BPX,U,3)))_U  ;Fill Type
"RTN","BPSRPT8",37,0)
 . S BPREC=BPREC_$$RXSTATUS^BPSRPT6($P(BPX,U,3)) ;Status
"RTN","BPSRPT8",38,0)
 . S BPREC=BPREC_$S($P(BPX,U):"/RL",1:"/NR")_U ;RL/NR
"RTN","BPSRPT8",39,0)
 . S BPREC=BPREC_$S($$CLOSED02^BPSSCR03($P(^BPST($P(BPX,U,3),0),U,4))=1:"C",1:"O")_U ;Open/Closed
"RTN","BPSRPT8",40,0)
 . S BPREC=BPREC_$$ELIGCODE^BPSSCR05($P(BPX,U,3))_U ;Eligibility
"RTN","BPSRPT8",41,0)
 ;
"RTN","BPSRPT8",42,0)
 I BPRTYPE=3 D  Q
"RTN","BPSRPT8",43,0)
 . S BPREC=BPREC_$$DATTIM^BPSRPT1(BPSRTDT)_U ;Date
"RTN","BPSRPT8",44,0)
 . S BPREC=BPREC_$TR($J(BPBIL,10,2)," ")_U ;$Billed
"RTN","BPSRPT8",45,0)
 . S BPREC=BPREC_$TR($J(BPINS,10,2)," ")_U ;Insurance Response
"RTN","BPSRPT8",46,0)
 ;
"RTN","BPSRPT8",47,0)
 I BPRTYPE=5 D  Q
"RTN","BPSRPT8",48,0)
 . S BPREC=BPREC_$$DATTIM^BPSRPT1($$TRANDT^BPSRPT2($P(BPX,U,3),1))_U ;Completed
"RTN","BPSRPT8",49,0)
 . S BPREC=BPREC_$$TTYPE^BPSRPT7($P(BPX,U,4),$P(BPX,U,5))_U ;Trans Type
"RTN","BPSRPT8",50,0)
 . S BPREC=BPREC_$$RESPONSE^BPSRPT7($P(BPX,U,4),$P(BPX,U,5))_U ;Payer Response
"RTN","BPSRPT8",51,0)
 ;
"RTN","BPSRPT8",52,0)
 I BPRTYPE=7 D  Q
"RTN","BPSRPT8",53,0)
 . ;RX INFO
"RTN","BPSRPT8",54,0)
 . S BPREC=BPREC_$$MWC^BPSRPT6(BPRX,BPREF)_U ;Fill Location
"RTN","BPSRPT8",55,0)
 . S BPREC=BPREC_$$RTBCKNAM^BPSRPT1($$RTBCK^BPSRPT1($P(BPX,U,3)))_U ;Fill Type
"RTN","BPSRPT8",56,0)
 . S BPREC=BPREC_$$RXSTATUS^BPSRPT6($P(BPX,U,3)) ;Status
"RTN","BPSRPT8",57,0)
 . S BPREC=BPREC_$S($P(BPX,U):"/RL",1:"/NR")_U ;RL/NR
"RTN","BPSRPT8",58,0)
 . S BPREC=BPREC_$S($P(BPX,U,13):"REJ",1:"")_U
"RTN","BPSRPT8",59,0)
 . S BPREC=BPREC_$$DRGNAM^BPSRPT6($P(BPX,U,14),32)_U ;Drug
"RTN","BPSRPT8",60,0)
 . S BPREC=BPREC_$TR($$GETNDC^BPSRPT6(BPRX,BPREF),"-")_U
"RTN","BPSRPT8",61,0)
 Q
"RTN","BPSRPT8",62,0)
 ;
"RTN","BPSRPT8",63,0)
 ;Print Report Line 2
"RTN","BPSRPT8",64,0)
 ;
"RTN","BPSRPT8",65,0)
 ; Input Variable -> BPRTYPE,BPX,BPRX,BPREF,BPBIL,BPGRPLAN
"RTN","BPSRPT8",66,0)
 ; 
"RTN","BPSRPT8",67,0)
WRLINE2(BPRTYPE,BPREC,BPX,BPRX,BPREF,BPBIL,BPGRPLAN) ;
"RTN","BPSRPT8",68,0)
 I (BPRTYPE=1)!(BPRTYPE=4) D  Q
"RTN","BPSRPT8",69,0)
 . ;Drug, Released On
"RTN","BPSRPT8",70,0)
 . S BPREC=BPREC_$$DRGNAM^BPSRPT6($P(BPX,U,14),32)_U_$TR($$GETNDC^BPSRPT6(BPRX,BPREF),"-")_U
"RTN","BPSRPT8",71,0)
 . S BPREC=BPREC_$$DATTIM^BPSRPT1(+BPX)_U
"RTN","BPSRPT8",72,0)
 . ;RX INFO
"RTN","BPSRPT8",73,0)
 . S BPREC=BPREC_$$MWC^BPSRPT6(BPRX,BPREF)_U ;Fill Location
"RTN","BPSRPT8",74,0)
 . S BPREC=BPREC_$$RTBCKNAM^BPSRPT1($$RTBCK^BPSRPT1($P(BPX,U,3)))_U ;Fill Type
"RTN","BPSRPT8",75,0)
 . S BPREC=BPREC_$$RXSTATUS^BPSRPT6($P(BPX,U,3)) ;Status
"RTN","BPSRPT8",76,0)
 . S BPREC=BPREC_$S($P(BPX,U):"/RL",1:"/NR")_U ;RL/NR
"RTN","BPSRPT8",77,0)
 . S BPREC=BPREC_$S($P(BPX,U,13):"REJ",1:"")
"RTN","BPSRPT8",78,0)
 . I BPRTYPE=1 S BPREC=BPREC_U_$$BILL^BPSRPT6(BPRX,BPREF) ;Bill #
"RTN","BPSRPT8",79,0)
 ;
"RTN","BPSRPT8",80,0)
 I BPRTYPE=2 D  Q
"RTN","BPSRPT8",81,0)
 . S BPREC=BPREC_$E($$CRDHLDID^BPSRPT2(+$P(BPX,U,3)),3,23)_U ;Cardholder ID
"RTN","BPSRPT8",82,0)
 . S BPREC=BPREC_$E($$GRPID^BPSRPT2(+$P(BPX,U,3)),3,10)_U ;Group ID
"RTN","BPSRPT8",83,0)
 . S BPREC=BPREC_$TR($J(BPBIL,10,2)," ")_U ;$Billed
"RTN","BPSRPT8",84,0)
 . S BPREC=BPREC_$$QTY^BPSRPT6($P(BPX,U,3))_U ;Qty
"RTN","BPSRPT8",85,0)
 . S BPREC=BPREC_$$GETNDC^BPSRPT6(BPRX,BPREF)_U ;NDC#
"RTN","BPSRPT8",86,0)
 . S BPREC=BPREC_$$DRGNAM^BPSRPT6($P(BPX,U,14),32)_U ;Drug
"RTN","BPSRPT8",87,0)
 ;
"RTN","BPSRPT8",88,0)
 I BPRTYPE=3 D  Q
"RTN","BPSRPT8",89,0)
 . S BPREC=BPREC_$$DRGNAM^BPSRPT6($P(BPX,U,14),32)_U ;Drug
"RTN","BPSRPT8",90,0)
 . S BPREC=BPREC_$TR($$GETNDC^BPSRPT6(BPRX,BPREF),"-")_U
"RTN","BPSRPT8",91,0)
 . ;RX INFO
"RTN","BPSRPT8",92,0)
 . S BPREC=BPREC_$$MWC^BPSRPT6(BPRX,BPREF)_U ;Fill Location
"RTN","BPSRPT8",93,0)
 . S BPREC=BPREC_$$RTBCKNAM^BPSRPT1($$RTBCK^BPSRPT1($P(BPX,U,3)))_U ;Fill Type
"RTN","BPSRPT8",94,0)
 . S BPREC=BPREC_$$RXSTATUS^BPSRPT6($P(BPX,U,3)) ;Status
"RTN","BPSRPT8",95,0)
 . S BPREC=BPREC_$S($P(BPX,U):"/RL",1:"/NR")_U ;RL/NR
"RTN","BPSRPT8",96,0)
 . S BPREC=BPREC_$S($P(BPX,U,13):"REJ",1:"")
"RTN","BPSRPT8",97,0)
 ;
"RTN","BPSRPT8",98,0)
 I BPRTYPE=5 D  Q
"RTN","BPSRPT8",99,0)
 . S BPREC=BPREC_$$DRGNAM^BPSRPT6($P(BPX,U,14),32)_U ;Drug
"RTN","BPSRPT8",100,0)
 . S BPREC=BPREC_$TR($$GETNDC^BPSRPT6(BPRX,BPREF),"-")_U
"RTN","BPSRPT8",101,0)
 . ;RX INFO
"RTN","BPSRPT8",102,0)
 . S BPREC=BPREC_$$MWC^BPSRPT6(BPRX,BPREF)_U ;Fill Location
"RTN","BPSRPT8",103,0)
 . S BPREC=BPREC_$$RTBCKNAM^BPSRPT1($$RTBCK^BPSRPT1($P(BPX,U,3)))_U ;Fill Type
"RTN","BPSRPT8",104,0)
 . S BPREC=BPREC_$$RXSTATUS^BPSRPT6($P(BPX,U,3)) ;Status
"RTN","BPSRPT8",105,0)
 . S BPREC=BPREC_$S($P(BPX,U):"/RL",1:"/NR")_U ;RL/NR
"RTN","BPSRPT8",106,0)
 . S BPREC=BPREC_$S($P(BPX,U,13):"REJ",1:"")_U
"RTN","BPSRPT8",107,0)
 . I $P(BPGRPLAN,U,2)]"" S BPREC=BPREC_$E($P(BPGRPLAN,U,2),1,30) ;Insurance
"RTN","BPSRPT8",108,0)
 . S BPREC=BPREC_U_$$ELAPSE^BPSRPT6($P(BPX,U,3))  ;Elapsed Time
"RTN","BPSRPT8",109,0)
 ;
"RTN","BPSRPT8",110,0)
 I BPRTYPE=7 D  Q
"RTN","BPSRPT8",111,0)
 . S BPREC=BPREC_$E($$CRDHLDID^BPSRPT2(+$P(BPX,U,3)),3,23)_U ;Cardholder ID
"RTN","BPSRPT8",112,0)
 . S BPREC=BPREC_$E($$GRPID^BPSRPT2(+$P(BPX,U,3)),3,10)_U  ;Group ID
"RTN","BPSRPT8",113,0)
 . S BPREC=BPREC_$$DATTIM^BPSRPT1(+$$CLOSEDT^BPSRPT2(+$P(BPX,U,3)))_U ;Close Dt/Time
"RTN","BPSRPT8",114,0)
 . S BPREC=BPREC_$E($$CLSBY^BPSRPT6(+$P(BPX,U,3)),1,25)_U ;Close By
"RTN","BPSRPT8",115,0)
 . S BPREC=BPREC_$E($P($$CLRSN^BPSRPT7(+$P(BPX,U,3)),U,2),1,30)_U ;Close Reason
"RTN","BPSRPT8",116,0)
 Q
"RTN","BPSRPT8",117,0)
 ;
"RTN","BPSRPT8",118,0)
 ;Print Report Line 3
"RTN","BPSRPT8",119,0)
 ;
"RTN","BPSRPT8",120,0)
 ; Input Variable -> BPRTYPE,BPX
"RTN","BPSRPT8",121,0)
 ; 
"RTN","BPSRPT8",122,0)
WRLINE3(BPRTYPE,BPREC,BPX) N BP59,BPSARR,BPRJCNT,BPZZ
"RTN","BPSRPT8",123,0)
 S BP59=+$P(BPX,U,3)
"RTN","BPSRPT8",124,0)
 ;
"RTN","BPSRPT8",125,0)
 I (",2,7,")[BPRTYPE D  Q
"RTN","BPSRPT8",126,0)
 .S BPREC=BPREC_$$CLAIMID^BPSRPT2(BP59)_U ;Claim ID
"RTN","BPSRPT8",127,0)
 .S BPRJCNT=$$REJTEXT^BPSRPT2(BP59,.BPSARR)
"RTN","BPSRPT8",128,0)
 .F BPZZ=1:1:BPRJCNT S:BPZZ'=1 BPREC=BPREC_"," S BPREC=BPREC_$P(BPSARR(BPZZ),":")
"RTN","BPSRPT8",129,0)
 .;
"RTN","BPSRPT8",130,0)
 .;Write one record per reject/close code
"RTN","BPSRPT8",131,0)
 .S:+BPRJCNT=0 BPRJCNT=1
"RTN","BPSRPT8",132,0)
 .F BPZZ=1:1:BPRJCNT W !,$G(BPREC),U,$P($G(BPSARR(BPZZ)),":"),U,$P($G(BPSARR(BPZZ)),":",2)
"RTN","BPSRPT8",133,0)
 ;
"RTN","BPSRPT8",134,0)
 I BPRTYPE=4 D
"RTN","BPSRPT8",135,0)
 . ;Method
"RTN","BPSRPT8",136,0)
 . I $$AUTOREV^BPSRPT1(BP59) S BPREC=BPREC_U_"AUTO"_U
"RTN","BPSRPT8",137,0)
 . E  S BPREC=BPREC_U_"REGULAR"_U
"RTN","BPSRPT8",138,0)
 . ;Return Status
"RTN","BPSRPT8",139,0)
 . I $P(BPX,U,15)["ACCEPTED" S BPREC=BPREC_"ACCEPTED"_U
"RTN","BPSRPT8",140,0)
 . E  S BPREC=BPREC_"REJECTED"_U
"RTN","BPSRPT8",141,0)
 . ;Reason
"RTN","BPSRPT8",142,0)
 . S BPREC=BPREC_$$RVSRSN^BPSRPT7(+$P(BPX,U,3))
"RTN","BPSRPT8",143,0)
 ;
"RTN","BPSRPT8",144,0)
 ;Write the record
"RTN","BPSRPT8",145,0)
 W !,$G(BPREC)
"RTN","BPSRPT8",146,0)
 Q
"RTN","BPSRPT8",147,0)
 ;
"RTN","BPSRPT8",148,0)
 ;Print Excel Header
"RTN","BPSRPT8",149,0)
 ;
"RTN","BPSRPT8",150,0)
HDR(BPRTYPE) ;
"RTN","BPSRPT8",151,0)
 ;
"RTN","BPSRPT8",152,0)
 ;Check if header already printed
"RTN","BPSRPT8",153,0)
 I $G(BPSDATA) Q
"RTN","BPSRPT8",154,0)
 S BPSDATA=1
"RTN","BPSRPT8",155,0)
 ;
"RTN","BPSRPT8",156,0)
 ;Division
"RTN","BPSRPT8",157,0)
 W !,"DIVISION",U
"RTN","BPSRPT8",158,0)
 ;
"RTN","BPSRPT8",159,0)
 I BPRTYPE'=5,BPRTYPE'=6 W "INSURANCE",U
"RTN","BPSRPT8",160,0)
 ;
"RTN","BPSRPT8",161,0)
 I (",1,2,3,4,5,7,")[BPRTYPE W "PATIENT NAME",U,"Pt.ID",U,"RX#",U,"REF/ECME#",U
"RTN","BPSRPT8",162,0)
 ;
"RTN","BPSRPT8",163,0)
 I (BPRTYPE=1)!(BPRTYPE=4) D  Q
"RTN","BPSRPT8",164,0)
 . W "DATE",U
"RTN","BPSRPT8",165,0)
 . W "$BILLED",U
"RTN","BPSRPT8",166,0)
 . W "$INS RESPONSE",U
"RTN","BPSRPT8",167,0)
 . W "$COLLECT",U
"RTN","BPSRPT8",168,0)
 . W "DRUG",U
"RTN","BPSRPT8",169,0)
 . W "NDC",U
"RTN","BPSRPT8",170,0)
 . W "RELEASED ON",U
"RTN","BPSRPT8",171,0)
 . W "FILL LOCATION",U
"RTN","BPSRPT8",172,0)
 . W "FILL TYPE",U
"RTN","BPSRPT8",173,0)
 . W "STATUS",U
"RTN","BPSRPT8",174,0)
 . W "REJECTED"
"RTN","BPSRPT8",175,0)
 . I BPRTYPE=1 W U,"BILL#"
"RTN","BPSRPT8",176,0)
 . I BPRTYPE=4 W U,"REVERSAL METHOD",U,"RETURN STATUS",U,"REASON"
"RTN","BPSRPT8",177,0)
 ;
"RTN","BPSRPT8",178,0)
 I BPRTYPE=2 D  Q
"RTN","BPSRPT8",179,0)
 . W "DATE",U
"RTN","BPSRPT8",180,0)
 . W "RELEASED ON",U
"RTN","BPSRPT8",181,0)
 . W "FILL LOCATION",U
"RTN","BPSRPT8",182,0)
 . W "FILL TYPE",U
"RTN","BPSRPT8",183,0)
 . W "STATUS",U
"RTN","BPSRPT8",184,0)
 . W "OPEN/CLOSED",U
"RTN","BPSRPT8",185,0)
 . W "ELIGIBILITY",U
"RTN","BPSRPT8",186,0)
 . W "CARDHOLD.ID",U
"RTN","BPSRPT8",187,0)
 . W "GROUP ID",U
"RTN","BPSRPT8",188,0)
 . W "$BILLED",U
"RTN","BPSRPT8",189,0)
 . W "QTY",U
"RTN","BPSRPT8",190,0)
 . W "NDC#",U
"RTN","BPSRPT8",191,0)
 . W "DRUG",U
"RTN","BPSRPT8",192,0)
 . W "CLAIM ID",U
"RTN","BPSRPT8",193,0)
 . W "REJECT CODE(S)",U
"RTN","BPSRPT8",194,0)
 . W "REJECT CODE",U
"RTN","BPSRPT8",195,0)
 . W "REJECT EXPLANATION"
"RTN","BPSRPT8",196,0)
 ;
"RTN","BPSRPT8",197,0)
 I BPRTYPE=3 D  Q
"RTN","BPSRPT8",198,0)
 . W "DATE",U
"RTN","BPSRPT8",199,0)
 . W "$BILLED",U
"RTN","BPSRPT8",200,0)
 . W "$INS RESPONSE",U
"RTN","BPSRPT8",201,0)
 . W "DRUG",U
"RTN","BPSRPT8",202,0)
 . W "NDC",U
"RTN","BPSRPT8",203,0)
 . W "FILL LOCATION",U
"RTN","BPSRPT8",204,0)
 . W "FILL TYPE",U
"RTN","BPSRPT8",205,0)
 . W "STATUS",U
"RTN","BPSRPT8",206,0)
 . W "REJECTED"
"RTN","BPSRPT8",207,0)
 ;
"RTN","BPSRPT8",208,0)
 I BPRTYPE=5 D  Q
"RTN","BPSRPT8",209,0)
 . W "COMPLETED",U
"RTN","BPSRPT8",210,0)
 . W "TRANS TYPE",U
"RTN","BPSRPT8",211,0)
 . W "PAYER RESPONSE",U
"RTN","BPSRPT8",212,0)
 . W "DRUG",U
"RTN","BPSRPT8",213,0)
 . W "NDC",U
"RTN","BPSRPT8",214,0)
 . W "FILL LOCATION",U
"RTN","BPSRPT8",215,0)
 . W "FILL TYPE",U
"RTN","BPSRPT8",216,0)
 . W "STATUS",U
"RTN","BPSRPT8",217,0)
 . W "REJECTED",U
"RTN","BPSRPT8",218,0)
 . W "INSURANCE",U
"RTN","BPSRPT8",219,0)
 . W "ELAP TIME IN SECONDS"
"RTN","BPSRPT8",220,0)
 ;
"RTN","BPSRPT8",221,0)
 I BPRTYPE=6 D  Q
"RTN","BPSRPT8",222,0)
 .W "DATE",U
"RTN","BPSRPT8",223,0)
 .W "#CLAIMS",U
"RTN","BPSRPT8",224,0)
 .W "AMOUNT SUBMITTED",U
"RTN","BPSRPT8",225,0)
 .W "RETURNED REJECTED",U
"RTN","BPSRPT8",226,0)
 .W "RETURNED PAYABLE",U
"RTN","BPSRPT8",227,0)
 .W "AMOUNT TO RECEIVE",U
"RTN","BPSRPT8",228,0)
 .W "DIFFERENCE"
"RTN","BPSRPT8",229,0)
 ;
"RTN","BPSRPT8",230,0)
 I BPRTYPE=7 D  Q
"RTN","BPSRPT8",231,0)
 . W "FILL LOCATION",U
"RTN","BPSRPT8",232,0)
 . W "FILL TYPE",U
"RTN","BPSRPT8",233,0)
 . W "STATUS",U
"RTN","BPSRPT8",234,0)
 . W "REJECTED",U
"RTN","BPSRPT8",235,0)
 . W "DRUG",U
"RTN","BPSRPT8",236,0)
 . W "NDC",U
"RTN","BPSRPT8",237,0)
 . W "CARDHOLD.ID",U
"RTN","BPSRPT8",238,0)
 . W "GROUP ID",U
"RTN","BPSRPT8",239,0)
 . W "CLOSE DATE/TIME",U
"RTN","BPSRPT8",240,0)
 . W "CLOSED BY",U
"RTN","BPSRPT8",241,0)
 . W "CLOSE REASON",U
"RTN","BPSRPT8",242,0)
 . W "CLAIM ID",U
"RTN","BPSRPT8",243,0)
 . W "REJECT CODE(S)",U
"RTN","BPSRPT8",244,0)
 . W "REJECT CODE",U
"RTN","BPSRPT8",245,0)
 . W "REJECT EXPLANATION"
"RTN","BPSRPT8",246,0)
 Q
"RTN","BPSRPT8",247,0)
 ;
"RTN","BPSRPT8",248,0)
 ;Print Report Insurance Subtotals
"RTN","BPSRPT8",249,0)
 ;
"RTN","BPSRPT8",250,0)
ITOT(BPRTYPE,BPDIV,BPGRPLAN,BPTBIL,BPTINS,BPTCOLL,BPCNT) N BPNP
"RTN","BPSRPT8",251,0)
 I (BPRTYPE=1)!(BPRTYPE=4) D  Q
"RTN","BPSRPT8",252,0)
 .W !!,?78,"----------",?100,"----------",?122,"----------"
"RTN","BPSRPT8",253,0)
 .W !,"SUBTOTALS for INS:",$E(BPGRPLAN,1,50),?78,$J(BPTBIL,10,2),?100,$J(BPTINS,10,2),?122,$J(BPTCOLL,10,2)
"RTN","BPSRPT8",254,0)
 .W !,"COUNT",?78,$J(BPCNT,10),?100,$J(BPCNT,10),?122,$J(BPCNT,10)
"RTN","BPSRPT8",255,0)
 .W:BPCNT !,"MEAN",?78,$J(BPTBIL/BPCNT,10,2),?100,$J(BPTINS/BPCNT,10,2),?122,$J(BPTCOLL/BPCNT,10,2)
"RTN","BPSRPT8",256,0)
 I BPRTYPE=3 D  Q
"RTN","BPSRPT8",257,0)
 .W !!,?100,"----------",?122,"----------"
"RTN","BPSRPT8",258,0)
 .W !,"SUBTOTALS for INS:",$E(BPGRPLAN,1,50),?100,$J(BPTBIL,10,2),?122,$J(BPTINS,10,2)
"RTN","BPSRPT8",259,0)
 .W !,"COUNT",?100,$J(BPCNT,10),?122,$J(BPCNT,10)
"RTN","BPSRPT8",260,0)
 .W:BPCNT !,"MEAN",?100,$J(BPTBIL/BPCNT,10,2),?122,$J(BPTINS/BPCNT,10,2)
"RTN","BPSRPT8",261,0)
 I BPRTYPE=2 D  Q
"RTN","BPSRPT8",262,0)
 .W !!,?41,"----------"
"RTN","BPSRPT8",263,0)
 .W !,"SUBTOTALS for INS:",$E(BPGRPLAN,1,22),?41,$J(BPTBIL,10,2)
"RTN","BPSRPT8",264,0)
 .W !,"COUNT",?41,$J(BPCNT,10)
"RTN","BPSRPT8",265,0)
 .W:BPCNT !,"MEAN",?41,$J(BPTBIL/BPCNT,10,2)
"RTN","BPSRPT8",266,0)
 I (BPRTYPE=7) D  Q
"RTN","BPSRPT8",267,0)
 .W !!,"SUBTOTALS for INS:",$E(BPGRPLAN,1,50)
"RTN","BPSRPT8",268,0)
 .N BPBILR
"RTN","BPSRPT8",269,0)
 .S BPBILR="" F  S BPBILR=$O(BPCNT(BPBILR)) Q:BPBILR=""  D  Q:BPQ
"RTN","BPSRPT8",270,0)
 ..S BPNP=$$CHKP^BPSRPT5(1) Q:BPQ
"RTN","BPSRPT8",271,0)
 ..W !,?3,BPBILR,?65,$J($G(BPCNT(BPBILR)),5)
"RTN","BPSRPT8",272,0)
 .Q:$G(BPQ)
"RTN","BPSRPT8",273,0)
 .W !,?65,"-----"
"RTN","BPSRPT8",274,0)
 .W !,"CLOSED CLAIMS SUBTOTAL",?65,$J(BPCNT,5)
"RTN","BPSRPT8",275,0)
 ;
"RTN","BPSRPT8",276,0)
 Q
"RTN","BPSSCR02")
0^34^B42664540
"RTN","BPSSCR02",1,0)
BPSSCR02 ;BHAM ISC/SS - USER SCREEN UTILITIES ;05-APR-05
"RTN","BPSSCR02",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,3,7**;JUN 2004;Build 46
"RTN","BPSSCR02",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSSCR02",4,0)
 ;USER SCREEN
"RTN","BPSSCR02",5,0)
 ;
"RTN","BPSSCR02",6,0)
REVERSE ; 
"RTN","BPSSCR02",7,0)
 N BPSDFN,BPSRX
"RTN","BPSSCR02",8,0)
 D SELECT(.BPSDFN,.BPSRX)
"RTN","BPSSCR02",9,0)
 S VALMBCK="R"
"RTN","BPSSCR02",10,0)
 Q
"RTN","BPSSCR02",11,0)
 ;
"RTN","BPSSCR02",12,0)
SELECT(BPSDFN1,BPSRX1,BPSRF1,BPS59) ; Select a patient.  Returns patient IEN(s) in array
"RTN","BPSSCR02",13,0)
 N BPLN
"RTN","BPSSCR02",14,0)
 S BPLN=$$SELLINE("Select the line(s) with the paid claim(s) you wish to REVERSE","")
"RTN","BPSSCR02",15,0)
 Q
"RTN","BPSSCR02",16,0)
 ;
"RTN","BPSSCR02",17,0)
SELLINE(BPSPROM,BPSDFVL) ;
"RTN","BPSSCR02",18,0)
 N BPRET,DIR,X,Y,DIRUT
"RTN","BPSSCR02",19,0)
 S BPRET="^"
"RTN","BPSSCR02",20,0)
 W ! S DIR(0)="N^::2",DIR("A")=BPSPROM,DIR("B")=BPSDFVL D ^DIR I $D(DIRUT) Q "^"
"RTN","BPSSCR02",21,0)
 S $P(BPRET,U)=Y
"RTN","BPSSCR02",22,0)
 Q BPRET
"RTN","BPSSCR02",23,0)
 ;/**
"RTN","BPSSCR02",24,0)
 ;make array element
"RTN","BPSSCR02",25,0)
 ;BPLINE - line number in LM ARRAY (by ref)
"RTN","BPSSCR02",26,0)
 ;BPTMP - VALMAR (TMP global for LM)
"RTN","BPSSCR02",27,0)
 ;BP59 - ptr to 9002313.59
"RTN","BPSSCR02",28,0)
 ;BPLMIND - passed by ref - current patient(/insurance) index ( to make 1, 2,etc)
"RTN","BPSSCR02",29,0)
 ;BPDRIND - passed by ref - current claim level index ( to make .1, .2, .10,... .20,... )
"RTN","BPSSCR02",30,0)
 ;TMP structure gives on the screen:
"RTN","BPSSCR02",31,0)
 ;^TMP("BPSSCR",$J,"VALM","LMIND",1,0,DFN,0,0)=
"RTN","BPSSCR02",32,0)
 ;^TMP("BPSSCR",$J,"VALM",1,0)=1   BUMSTEAD,CHARLE (5444)/100-234-2345 *done* FINISHED
"RTN","BPSSCR02",33,0)
 ;BPLINE = 1
"RTN","BPSSCR02",34,0)
 ;BPLMIND=1
"RTN","BPSSCR02",35,0)
 ;on the screen:
"RTN","BPSSCR02",36,0)
 ;1   BUMSTEAD,CHARLE      (5444)   /100-234-2345 *done* FINISHED
"RTN","BPSSCR02",37,0)
 ;
"RTN","BPSSCR02",38,0)
 ;^TMP(538978189,"BPSSCR","SORT","T",1,401959.00001)=
"RTN","BPSSCR02",39,0)
 ;^TMP("BPSSCR",$J,"VALM","LMIND",1,1,DFN,401959.00001,1)=
"RTN","BPSSCR02",40,0)
 ;^TMP("BPSSCR",$J,"VALM",2,0)=  1.1   LOVASTATIN 20MG TAB
"RTN","BPSSCR02",41,0)
 ;BPLINE = 2
"RTN","BPSSCR02",42,0)
 ;BP59= 401959.00001
"RTN","BPSSCR02",43,0)
 ;on the screen:
"RTN","BPSSCR02",44,0)
 ;  1.1   LOVASTATIN 20MG TAB
"RTN","BPSSCR02",45,0)
 ;
"RTN","BPSSCR02",46,0)
 ;^TMP(538978189,"BPSSCR","SORT","T",1,501750.00011)=
"RTN","BPSSCR02",47,0)
 ;^TMP("BPSSCR",$J,"VALM","LMIND",1,2,DFN,501750.00011,2)=
"RTN","BPSSCR02",48,0)
 ;^TMP("BPSSCR",$J,"VALM",3,0)=  1.2   CIMETIDINE 300MG TAB
"RTN","BPSSCR02",49,0)
 ;BPLINE = 3
"RTN","BPSSCR02",50,0)
 ;BP59= 501750.00011
"RTN","BPSSCR02",51,0)
 ;on the screen:
"RTN","BPSSCR02",52,0)
 ;  1.2   CIMETIDINE 300MG TAB
"RTN","BPSSCR02",53,0)
 ;
"RTN","BPSSCR02",54,0)
MKARRELM(BPLINE,BPTMP,BP59,BPLMIND,BPDRIND,BPPREV) ;*/
"RTN","BPSSCR02",55,0)
 N BPSSTR,BPLNS,BPDFN,BPSTAT,BPSINSUR,BPINSDAT
"RTN","BPSSCR02",56,0)
 S BPDFN=+$P($G(^BPST(BP59,0)),U,6) ;patient's DFN
"RTN","BPSSCR02",57,0)
 S BPINSDAT=$$GETINSUR^BPSSCRU2(BP59)
"RTN","BPSSCR02",58,0)
 S BPSINSUR=+BPINSDAT ;patient's insurance IEN
"RTN","BPSSCR02",59,0)
 ;
"RTN","BPSSCR02",60,0)
 ;PATIENT SUMMARY level
"RTN","BPSSCR02",61,0)
 ; if last one was different DFN/INSURANCE combination then create a new Patient Summary level
"RTN","BPSSCR02",62,0)
 I (+$O(@BPTMP@("LMIND",BPLMIND,0,0))'=BPDFN)!(+$O(@BPTMP@("LMIND",BPLMIND,0,BPDFN,0))'=BPSINSUR) D
"RTN","BPSSCR02",63,0)
 . ;-------- first process previous patient & insurance group
"RTN","BPSSCR02",64,0)
 . ;determine patient summary statuses for the previous "patient" group
"RTN","BPSSCR02",65,0)
 . I BPLMIND>0,+BPPREV=BPLMIND D
"RTN","BPSSCR02",66,0)
 . . ;update the record for previous patient summary after we went thru all his claims
"RTN","BPSSCR02",67,0)
 . . D UPDPREV(BPTMP,BPLMIND,BPPREV)
"RTN","BPSSCR02",68,0)
 . ;process new "patient & insurance" group ------------------
"RTN","BPSSCR02",69,0)
 . S BPDRIND=0
"RTN","BPSSCR02",70,0)
 . S BPLMIND=(BPLMIND\1)+1
"RTN","BPSSCR02",71,0)
 . ;save the all necessary data for the patient & insurance to use as previous for STAT4PAT later on
"RTN","BPSSCR02",72,0)
 . S BPPREV=BPLMIND_U_BPLINE_U_BPDFN_U_$$PATINF(BPDFN,BPINSDAT)_U_BPSINSUR
"RTN","BPSSCR02",73,0)
 . S BPSSTR=$$LJ(BPLMIND,4)_$P(BPPREV,U,4)
"RTN","BPSSCR02",74,0)
 . D SAVEARR(BPTMP,BPLMIND,BPDRIND,BPDFN,0,BPLINE,BPSSTR,BPSINSUR)
"RTN","BPSSCR02",75,0)
 . S BPLINE=BPLINE+1
"RTN","BPSSCR02",76,0)
 ;
"RTN","BPSSCR02",77,0)
 ;CLAIMS level
"RTN","BPSSCR02",78,0)
 D
"RTN","BPSSCR02",79,0)
 . I +$O(@BPTMP@("LMIND",BPLMIND,BPDRIND,BPDFN,0))'=BP59 D
"RTN","BPSSCR02",80,0)
 . . S BPDRIND=BPDRIND+1
"RTN","BPSSCR02",81,0)
 . . S BPSSTR="  "_$$LJ(+$P(BPLMIND,".")_"."_BPDRIND,5)_" "_$$CLAIMINF(BP59)
"RTN","BPSSCR02",82,0)
 . . ;@debug,remove the next line after finish debugging
"RTN","BPSSCR02",83,0)
 . . ;S BPSSTR=BPSSTR_" 59:"_BP59_" DT:"_$$TRANDT^BPSSCRU2(BP59)_" DFN:"_BPDFN_" INS:"_BPSINSUR
"RTN","BPSSCR02",84,0)
 . . D SAVEARR(BPTMP,BPLMIND,BPDRIND,BPDFN,BP59,BPLINE,BPSSTR,BPSINSUR)
"RTN","BPSSCR02",85,0)
 . . S BPLINE=BPLINE+1
"RTN","BPSSCR02",86,0)
 . . N BPARR,X
"RTN","BPSSCR02",87,0)
 . . S BPLNS=$$ADDINF^BPSSCR03(BP59,.BPARR,74,"R")
"RTN","BPSSCR02",88,0)
 . . F X=1:1:BPLNS D
"RTN","BPSSCR02",89,0)
 . . . I $G(BPARR(X))="" Q
"RTN","BPSSCR02",90,0)
 . . . D SAVEARR(BPTMP,BPLMIND,BPDRIND,BPDFN,BP59,BPLINE,"      "_BPARR(X),BPSINSUR)
"RTN","BPSSCR02",91,0)
 . . . S BPLINE=BPLINE+1
"RTN","BPSSCR02",92,0)
 Q
"RTN","BPSSCR02",93,0)
 ;S BPS=BPX
"RTN","BPSSCR02",94,0)
 ;/**
"RTN","BPSSCR02",95,0)
 ;BP59
"RTN","BPSSCR02",96,0)
CLAIMINF(BP59) ;*/
"RTN","BPSSCR02",97,0)
 N BPX,BPX1
"RTN","BPSSCR02",98,0)
 S BPX1=$$RXREF^BPSSCRU2(BP59)
"RTN","BPSSCR02",99,0)
 ;S BPX=BP59_$$LJ($$DRGNAME^BPSSCRU2(BP59),22)_"  "_$$LJ($$NDC^BPSSCRU2(+BPX1,+$P(BPX1,U,2)),13)_"  "
"RTN","BPSSCR02",100,0)
 S BPX=$$LJ($$DRGNAME^BPSSCRU2(BP59),17)_"  "_$$LJ($$NDC^BPSSCRU2(+BPX1,+$P(BPX1,U,2)),13)_" "
"RTN","BPSSCR02",101,0)
 S BPX=BPX_$$LJ($$FILLDATE^BPSSCRRS(+BPX1,+$P(BPX1,U,2)),5)_" "
"RTN","BPSSCR02",102,0)
 S BPX=BPX_$$LJ($$RXNUM^BPSSCRU2(+BPX1),11)_" "_+$P(BPX1,U,2)_"/"
"RTN","BPSSCR02",103,0)
 S BPX=BPX_$$LJ($$ECMENUM^BPSSCRU2(BP59),7)_" "_$$MWCNAME^BPSSCRU2($$GETMWC^BPSSCRU2(BP59))_" "
"RTN","BPSSCR02",104,0)
 S BPX=BPX_$$RTBB^BPSSCRU2(BP59)_" "_$$RXST^BPSSCRU2(BP59)_"/"_$$RL^BPSSCRU2(BP59)
"RTN","BPSSCR02",105,0)
 Q BPX
"RTN","BPSSCR02",106,0)
 ;/**
"RTN","BPSSCR02",107,0)
 ;determine "done" and "FINISHED" status for patient/insurance group by BPLMIND in TMP global
"RTN","BPSSCR02",108,0)
STAT4PAT(BPLMIND) ;*/
"RTN","BPSSCR02",109,0)
 N BPCL,BPDFN,BP59,BPX,BPINS,BPX,BPCNT,BPELI
"RTN","BPSSCR02",110,0)
 N BPPB,BPRJ,BPACRV,BPRJRV,BPSR,BPFIN,BPPRCNTG
"RTN","BPSSCR02",111,0)
 S (BPCL,BPPB,BPRJ,BPACRV,BPSR,BPRJRV)=0
"RTN","BPSSCR02",112,0)
 S BPFIN=0 ; finished by default
"RTN","BPSSCR02",113,0)
 S BPPRCNTG=0
"RTN","BPSSCR02",114,0)
 S BPCNT=0
"RTN","BPSSCR02",115,0)
 F  S BPCL=+$O(@BPTMP@("LMIND",BPLMIND,BPCL)) Q:BPCL=0  D
"RTN","BPSSCR02",116,0)
 . S BPDFN=0
"RTN","BPSSCR02",117,0)
 . F  S BPDFN=+$O(@BPTMP@("LMIND",BPLMIND,BPCL,BPDFN)) Q:BPDFN=0  D
"RTN","BPSSCR02",118,0)
 . . S BPINS="" ;can be 0 in the TMP global if insurance plan
"RTN","BPSSCR02",119,0)
 . . ;is corrupted in file ##9002313.59
"RTN","BPSSCR02",120,0)
 . . F  S BPINS=$O(@BPTMP@("LMIND",BPLMIND,BPCL,BPDFN,BPINS)) Q:BPINS=""  D
"RTN","BPSSCR02",121,0)
 . . . S BP59=0,BPINS=+BPINS
"RTN","BPSSCR02",122,0)
 . . . F  S BP59=+$O(@BPTMP@("LMIND",BPLMIND,BPCL,BPDFN,BPINS,BP59)) Q:BP59=0  D
"RTN","BPSSCR02",123,0)
 . . . . S BPCNT=BPCNT+1
"RTN","BPSSCR02",124,0)
 . . . . S BPX=$P($$CLAIMST^BPSSCRU3(BP59),U)
"RTN","BPSSCR02",125,0)
 . . . . I BPX["E PAYABLE" S BPPB=BPPB+1 ;Payable
"RTN","BPSSCR02",126,0)
 . . . . I BPX["E REJECTED" S BPRJ=BPRJ+1 ;Rejected
"RTN","BPSSCR02",127,0)
 . . . . I BPX["E REVERSAL ACCEPTED" S BPACRV=BPACRV+1 ;Accepted Reversal 
"RTN","BPSSCR02",128,0)
 . . . . I BPX["E REVERSAL REJECTED" S BPRJRV=BPRJRV+1 ;Rejected Reversal
"RTN","BPSSCR02",129,0)
 . . . . I $D(BP59) S BPELI=$$ELIGCODE^BPSSCR05($G(BP59))
"RTN","BPSSCR02",130,0)
 S BPX=$S($G(BPELI)="V":"Vet",$G(BPELI)="T":"Tri",$G(BPELI)="C":"Cha",1:"Unk")
"RTN","BPSSCR02",131,0)
 ;
"RTN","BPSSCR02",132,0)
 I BPPB=BPCNT S BPX=BPX_" ALL payable"
"RTN","BPSSCR02",133,0)
 E  S BPX=BPX_" Pb:"_BPPB_" Rj:"_BPRJ_" AcRv:"_BPACRV_" RjRv:"_BPRJRV
"RTN","BPSSCR02",134,0)
 Q BPX
"RTN","BPSSCR02",135,0)
 ;/**
"RTN","BPSSCR02",136,0)
 ;gets the patient summary information
"RTN","BPSSCR02",137,0)
 ;input:
"RTN","BPSSCR02",138,0)
 ; BPDFN - ptr to #2
"RTN","BPSSCR02",139,0)
 ; BPINS - insurance ien^insurance name^phone 
"RTN","BPSSCR02",140,0)
 ;output:
"RTN","BPSSCR02",141,0)
 ; patient summary information
"RTN","BPSSCR02",142,0)
PATINF(BPDFN,BPINS) ;*/
"RTN","BPSSCR02",143,0)
 N X,BPINSNM
"RTN","BPSSCR02",144,0)
 S BPINSNM=$P(BPINS,U,2)
"RTN","BPSSCR02",145,0)
 S X=$$LJ^BPSSCR02($$PATNAME^BPSSCRU2(BPDFN),13) ;name
"RTN","BPSSCR02",146,0)
 S X=X_" "_$$LJ($$SSN4^BPSSCRU2(BPDFN),6) ;4digits of SSN
"RTN","BPSSCR02",147,0)
 S X=X_" "_$$LJ($S(BPINSNM="":"????",1:BPINSNM),8) ;insurance
"RTN","BPSSCR02",148,0)
 S X=X_"/"_$$LJ($P(BPINS,U,3),14) ;phone
"RTN","BPSSCR02",149,0)
 Q X
"RTN","BPSSCR02",150,0)
 ;
"RTN","BPSSCR02",151,0)
 ;/**
"RTN","BPSSCR02",152,0)
 ;creates an entry in LM array and builds a non-standard index
"RTN","BPSSCR02",153,0)
 ;BPLMIND - passed by ref - current LM index - patient_AND_insurance level 
"RTN","BPSSCR02",154,0)
 ;BPDRIND - passed by ref - current LM index  - claim level 
"RTN","BPSSCR02",155,0)
 ;BPTMP - VALMAR (TMP global for LM)
"RTN","BPSSCR02",156,0)
 ;BP59 - ptr to 9002313.59
"RTN","BPSSCR02",157,0)
 ;BPLINE - line number in LM ARRAY (by ref)
"RTN","BPSSCR02",158,0)
 ;BPSTR - string to save in ARRAY
"RTN","BPSSCR02",159,0)
 ;BPSINSUR - INSURANCE ien
"RTN","BPSSCR02",160,0)
SAVEARR(BPTMP1,BPLMIND,BPDRIND,BPDFN,BP59,BPLINE,BPSSTR,BPSINSUR) ;
"RTN","BPSSCR02",161,0)
 S @BPTMP1@("LMIND",BPLMIND,BPDRIND,BPDFN,BPSINSUR,BP59,BPLINE)=""
"RTN","BPSSCR02",162,0)
 D SET^VALM10(BPLINE,BPSSTR,BP59)
"RTN","BPSSCR02",163,0)
 Q
"RTN","BPSSCR02",164,0)
 ;left justified, blank padded
"RTN","BPSSCR02",165,0)
 ;adds spaces on right or truncates to make return string BPLEN characters long
"RTN","BPSSCR02",166,0)
 ;BPST- original string
"RTN","BPSSCR02",167,0)
 ;BPLEN - desired length
"RTN","BPSSCR02",168,0)
LJ(BPST,BPLEN) ;
"RTN","BPSSCR02",169,0)
 N BPL
"RTN","BPSSCR02",170,0)
 S BPL=BPLEN-$L(BPST)
"RTN","BPSSCR02",171,0)
 Q $E(BPST_$J("",$S(BPL<0:0,1:BPL)),1,BPLEN)
"RTN","BPSSCR02",172,0)
 ;
"RTN","BPSSCR02",173,0)
 ;right justified, blank padded
"RTN","BPSSCR02",174,0)
 ;adds spaces on left or truncates to make return string BPLEN characters long
"RTN","BPSSCR02",175,0)
 ;BPST- original string
"RTN","BPSSCR02",176,0)
 ;BPLEN - desired length
"RTN","BPSSCR02",177,0)
RJ(BPST,BPLEN)  ;
"RTN","BPSSCR02",178,0)
 S BPL=BPLEN-$L(BPST)
"RTN","BPSSCR02",179,0)
 I BPL>0 Q $J("",$S(BPL<0:0,1:BPL))_BPST
"RTN","BPSSCR02",180,0)
 Q $E(BPST,1,BPLEN)
"RTN","BPSSCR02",181,0)
 ;
"RTN","BPSSCR02",182,0)
 ;is the claim payable?
"RTN","BPSSCR02",183,0)
PAYABLE(BP59) ;
"RTN","BPSSCR02",184,0)
 I $P($$CLAIMST^BPSSCRU3(BP59),U)["E PAYABLE" Q 1
"RTN","BPSSCR02",185,0)
 Q 0
"RTN","BPSSCR02",186,0)
 ;
"RTN","BPSSCR02",187,0)
 ;is the claim rejected?
"RTN","BPSSCR02",188,0)
REJECTED(BP59) ;
"RTN","BPSSCR02",189,0)
 I $P($$CLAIMST^BPSSCRU3(BP59),U)["E REJECTED" Q 1
"RTN","BPSSCR02",190,0)
 I $P($$CLAIMST^BPSSCRU3(BP59),U)["E REVERSAL REJECTED" Q 1
"RTN","BPSSCR02",191,0)
 Q 0
"RTN","BPSSCR02",192,0)
 ;update patient summary information for the previous patient/insurance pair
"RTN","BPSSCR02",193,0)
UPDPREV(BPTMP,BPLMIND,BPPREV) ;
"RTN","BPSSCR02",194,0)
 N BPSSTR
"RTN","BPSSCR02",195,0)
 ;update the record for previous patient summary after we went thru all his claims
"RTN","BPSSCR02",196,0)
 S BPSSTR=$$LJ^BPSSCR02(BPLMIND,4)_$P(BPPREV,U,4)_" "_$$STAT4PAT^BPSSCR02(BPLMIND)
"RTN","BPSSCR02",197,0)
 D SAVEARR^BPSSCR02(BPTMP,BPLMIND,0,+$P(BPPREV,U,3),0,+$P(BPPREV,U,2),BPSSTR,+$P(BPPREV,U,5))
"RTN","BPSSCR02",198,0)
 Q
"RTN","BPSSCR02",199,0)
 ;
"RTN","BPSSCR03")
0^12^B48894943
"RTN","BPSSCR03",1,0)
BPSSCR03 ;BHAM ISC/SS - ECME USR SCREEN UTILITIES ;05-APR-05
"RTN","BPSSCR03",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5,7**;JUN 2004;Build 46
"RTN","BPSSCR03",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSSCR03",4,0)
 Q
"RTN","BPSSCR03",5,0)
 ;/**
"RTN","BPSSCR03",6,0)
 ;BP59 - ptr to 9002313.59
"RTN","BPSSCR03",7,0)
 ; BPARR to return formatted info via ref
"RTN","BPSSCR03",8,0)
 ; BPMLEM - max len for each line
"RTN","BPSSCR03",9,0)
 ; BPMODE - mode
"RTN","BPSSCR03",10,0)
 ;   R -regular for main screen, will show only latest comment
"RTN","BPSSCR03",11,0)
 ;   C - comment mode - show all comments
"RTN","BPSSCR03",12,0)
ADDINF(BP59,BPARR,BPMLEN,BPMODE) ;to return additional information about the claim*/
"RTN","BPSSCR03",13,0)
 N BPX,BPN,BPTXT1,BPTXT2,BPTXT3,BPTXT4,BPX1,BPPRCNTG,BPN2,BPSTATUS
"RTN","BPSSCR03",14,0)
 S BPN=0,(BPTXT1,BPTXT2,BPTXT3,BPTXT4,BPX1)=""
"RTN","BPSSCR03",15,0)
 I BPMODE="R" D
"RTN","BPSSCR03",16,0)
 . S BPX=$$COMMENT^BPSSCRU3(BP59)
"RTN","BPSSCR03",17,0)
 . I $L(BPX)>0 S BPN=BPN+1,BPARR(BPN)=$P(BPX,U)
"RTN","BPSSCR03",18,0)
 . I $P(BPX,U,2)]"" S BPN=BPN+1,BPARR(BPN)="("_$P(BPX,U,2)_")"
"RTN","BPSSCR03",19,0)
 E  D
"RTN","BPSSCR03",20,0)
 . N BPCMNT,BPX1 S BPCMNT=99999999
"RTN","BPSSCR03",21,0)
 . F  S BPCMNT=$O(^BPST(BP59,11,BPCMNT),-1) Q:+BPCMNT=0  D
"RTN","BPSSCR03",22,0)
 . . S BPX1=$G(^BPST(BP59,11,BPCMNT,0))
"RTN","BPSSCR03",23,0)
 . . I BPX1="" Q
"RTN","BPSSCR03",24,0)
 . . S BPX=$$DATTIM^BPSSCRU3($P(BPX1,U,1)\1)_" - "_$P(BPX1,U,3)
"RTN","BPSSCR03",25,0)
 . . I $L(BPX)>0 S BPN=BPN+1,BPARR(BPN)=BPX
"RTN","BPSSCR03",26,0)
 . . I +$P(BPX1,U,2)]"" D
"RTN","BPSSCR03",27,0)
 . . . S BPX=$$USERNAM^BPSCMT01(+$P(BPX1,U,2))
"RTN","BPSSCR03",28,0)
 . . . I BPX'="" S BPX="("_BPX_")",BPN=BPN+1,BPARR(BPN)=BPX
"RTN","BPSSCR03",29,0)
 S BPX=$$CLAIMST^BPSSCRU3(BP59)
"RTN","BPSSCR03",30,0)
 S BPSTATUS=$P(BPX,U)
"RTN","BPSSCR03",31,0)
 S BPPRCNTG=$$LJ^BPSSCR02("("_$$PRCNTG^BPSSCRU3(BP59)_"%) ",6)
"RTN","BPSSCR03",32,0)
 ;I BPX["AR" S BPARR(BPN)="Auto-Reversal",BPN=BPN+1
"RTN","BPSSCR03",33,0)
 I BPSTATUS["E REVERSAL ACCEPTED" S BPTXT1=$$CLMCLSTX(BP59,BPTXT1_"Reversal accepted")
"RTN","BPSSCR03",34,0)
 I BPSTATUS["E REVERSAL REJECTED" S BPTXT1=$$CLMCLSTX(BP59,BPTXT1_"Reversal rejected")
"RTN","BPSSCR03",35,0)
 I BPSTATUS["E PAYABLE" S BPTXT1=$$CLMCLSTX(BP59,BPTXT1_"Payable")
"RTN","BPSSCR03",36,0)
 I BPSTATUS["E REJECTED" S BPTXT1=$$CLMCLSTX(BP59,BPTXT1_"Rejected")
"RTN","BPSSCR03",37,0)
 I BPSTATUS["E UNSTRANDED" S BPTXT1=$$CLMCLSTX(BP59,BPTXT1_"Unstranded")
"RTN","BPSSCR03",38,0)
 I BPSTATUS["E REVERSAL UNSTRANDED" S BPTXT1=$$CLMCLSTX(BP59,BPTXT1_"Unstranded reversal")
"RTN","BPSSCR03",39,0)
 I BPSTATUS["E CAPTURED" S BPTXT1=$$CLMCLSTX(BP59,BPTXT1_"Captured")
"RTN","BPSSCR03",40,0)
 I BPSTATUS["E DUPLICATE" S BPTXT1=$$CLMCLSTX(BP59,BPTXT1_"Duplicate")
"RTN","BPSSCR03",41,0)
 I BPSTATUS["E OTHER" S BPTXT1=$$CLMCLSTX(BP59,BPTXT1_"Other")
"RTN","BPSSCR03",42,0)
 I BPSTATUS["IN PROGRESS" S BPTXT1=$$CLMCLSTX(BP59,BPTXT1_"In progress")
"RTN","BPSSCR03",43,0)
 I BPSTATUS["CORRUPT" S BPTXT1=$$CLMCLSTX(BP59,BPTXT1_"Corrupt")
"RTN","BPSSCR03",44,0)
 I BPSTATUS["E REVERSAL OTHER" S BPTXT1=$$CLMCLSTX(BP59,BPTXT1_"Reversal Other")
"RTN","BPSSCR03",45,0)
 I BPTXT1="" S BPTXT1="Unknown status "
"RTN","BPSSCR03",46,0)
 ;
"RTN","BPSSCR03",47,0)
 I (BPSTATUS["E REJECTED")!(BPSTATUS["E REVERSAL REJECTED") D
"RTN","BPSSCR03",48,0)
 . I $L(BPTXT1)>0 S BPN=BPN+1,BPARR(BPN)=BPTXT1
"RTN","BPSSCR03",49,0)
 . S BPTXT1=""
"RTN","BPSSCR03",50,0)
 . S BPN2=BPN
"RTN","BPSSCR03",51,0)
 . D GETRJCOD^BPSSCRU3(BP59,.BPARR,.BPN,74,"")
"RTN","BPSSCR03",52,0)
 . D WRAPLN2^BPSSCRU5(.BPN,.BPARR,$$GETMESS^BPSSCRU3(1000,504,BP59),74,"",0)
"RTN","BPSSCR03",53,0)
 . D WRAPLN2^BPSSCRU5(.BPN,.BPARR,$$GETMESS^BPSSCRU3(1000,526,BP59),74,"",0)
"RTN","BPSSCR03",54,0)
 . D WRAPLN2^BPSSCRU5(.BPN,.BPARR,$$GETMESS^BPSSCRU3(504,0,BP59),74,"",0)
"RTN","BPSSCR03",55,0)
 . I BPN>BPN2 Q  ;reject codes are enough
"RTN","BPSSCR03",56,0)
 . ;S BPX1=$P($P(BPX,U,3),"[") I BPTXT1=BPX1 S BPX1=""
"RTN","BPSSCR03",57,0)
 . S:BPX1="" BPX1=$$GETMESS^BPSSCRU3(504,0,BP59)
"RTN","BPSSCR03",58,0)
 . I $L(BPX1)>0 S BPTXT1=BPTXT1_"- "_$TR(BPX1,"]","")
"RTN","BPSSCR03",59,0)
 ;
"RTN","BPSSCR03",60,0)
 I (BPSTATUS["E OTHER")!(BPSTATUS["IN PROGRESS")!(BPSTATUS["E UNSTRANDED")!(BPSTATUS["E CAPTURED")!(BPSTATUS["E REVERSAL UNSTRANDED") D
"RTN","BPSSCR03",61,0)
 . I (BPSTATUS["E OTHER")!(BPSTATUS["IN PROGRESS") S BPX1=$P(BPX,U,3) I BPTXT1=BPX1 S BPX1=""
"RTN","BPSSCR03",62,0)
 . S:BPX1="" BPX1=$$GETMESS^BPSSCRU3(504,0,BP59)
"RTN","BPSSCR03",63,0)
 . I $L(BPX1)>0 S BPTXT1=BPTXT1_"- "_$TR(BPX1,"]","")
"RTN","BPSSCR03",64,0)
 ;
"RTN","BPSSCR03",65,0)
 S BPTXT2=$E(BPTXT1,1,BPMLEN)
"RTN","BPSSCR03",66,0)
 S BPTXT3=$E(BPTXT1,BPMLEN+1,2*BPMLEN)
"RTN","BPSSCR03",67,0)
 S BPTXT4=$E(BPTXT1,(2*BPMLEN)+1,3*BPMLEN)
"RTN","BPSSCR03",68,0)
 I $L(BPTXT2)>0 S BPN=BPN+1,BPARR(BPN)=BPTXT2
"RTN","BPSSCR03",69,0)
 I $L(BPTXT3)>0 S BPN=BPN+1,BPARR(BPN)=BPTXT3
"RTN","BPSSCR03",70,0)
 I $L(BPTXT4)>0 S BPN=BPN+1,BPARR(BPN)=BPTXT4
"RTN","BPSSCR03",71,0)
 Q BPN
"RTN","BPSSCR03",72,0)
 ;
"RTN","BPSSCR03",73,0)
CLMINF(BP59) ;ptr to #9002313.59
"RTN","BPSSCR03",74,0)
 W !,"Claim info. Press a key"
"RTN","BPSSCR03",75,0)
 D PAUSE^VALM1
"RTN","BPSSCR03",76,0)
 Q
"RTN","BPSSCR03",77,0)
 ;
"RTN","BPSSCR03",78,0)
 ;
"RTN","BPSSCR03",79,0)
COMM(BP59) ;ptr to #9002313.59
"RTN","BPSSCR03",80,0)
 W !,"the latest comment. Press a key"
"RTN","BPSSCR03",81,0)
 D PAUSE^VALM1
"RTN","BPSSCR03",82,0)
 Q
"RTN","BPSSCR03",83,0)
 ;
"RTN","BPSSCR03",84,0)
RESP(BP59) ;Payer Response Information
"RTN","BPSSCR03",85,0)
 W !,"payer Response Information. Press a key"
"RTN","BPSSCR03",86,0)
 D PAUSE^VALM1
"RTN","BPSSCR03",87,0)
 Q
"RTN","BPSSCR03",88,0)
 ;
"RTN","BPSSCR03",89,0)
 ;/**
"RTN","BPSSCR03",90,0)
 ;Checks if the claim is closed and sets the "/Closed" indicator at the end of the text
"RTN","BPSSCR03",91,0)
 ;BP59 - pointer to file #9002313.59
"RTN","BPSSCR03",92,0)
 ;BPTXT - Current status text to be displayed
"RTN","BPSSCR03",93,0)
 ;return:
"RTN","BPSSCR03",94,0)
 ;if the claim is not closed, BPTXT is returned. If it is closed BPTXT_"/Closed " is returned
"RTN","BPSSCR03",95,0)
CLMCLSTX(BP59,BPTXT) ;*/
"RTN","BPSSCR03",96,0)
 Q $S($$CLOSED02($P($G(^BPST(BP59,0)),U,4)):BPTXT_"/Closed ",1:BPTXT)
"RTN","BPSSCR03",97,0)
 ;
"RTN","BPSSCR03",98,0)
 ;/**
"RTN","BPSSCR03",99,0)
 ;Checks if the CLAIM for specific Transaction is CLOSED?
"RTN","BPSSCR03",100,0)
 ;BPCLAIM - ptr to #9002313.02
"RTN","BPSSCR03",101,0)
 ;see also CLOSED^BPSSCRU1
"RTN","BPSSCR03",102,0)
CLOSED02(BPCLAIM) ;*/
"RTN","BPSSCR03",103,0)
 I +$G(BPCLAIM)=0 Q 0
"RTN","BPSSCR03",104,0)
 ; get closed status
"RTN","BPSSCR03",105,0)
 Q +$P($G(^BPSC(BPCLAIM,900)),U)=1
"RTN","BPSSCR03",106,0)
 ;
"RTN","BPSSCR03",107,0)
 ;return:
"RTN","BPSSCR03",108,0)
 ; 1 - okay. matches criteria
"RTN","BPSSCR03",109,0)
 ; 0-  not okay, doesn't match criteria
"RTN","BPSSCR03",110,0)
FILTER(BP59,BPARR) ;
"RTN","BPSSCR03",111,0)
 N BPST0,BPST1,BPRXREF,BPRX52,BPREFNUM
"RTN","BPSSCR03",112,0)
 N BPRET
"RTN","BPSSCR03",113,0)
 S BPRET=1 ;1 - okay bt default
"RTN","BPSSCR03",114,0)
 S BPST0=$G(^BPST(BP59,0))
"RTN","BPSSCR03",115,0)
 S BPST1=$G(^BPST(BP59,1))
"RTN","BPSSCR03",116,0)
 S BPRXREF=$$RXREF^BPSSCRU2(BP59)
"RTN","BPSSCR03",117,0)
 S BPRX52=+$P(BPRXREF,U) ;ptr to #52
"RTN","BPSSCR03",118,0)
 S BPREFNUM=$P(BPRXREF,U,2) ;refill #
"RTN","BPSSCR03",119,0)
 ;Check for Open Claim
"RTN","BPSSCR03",120,0)
 I $G(BPARR(2.02))="O",$$CLOSED02(+$P(BPST0,U,4)) Q 0
"RTN","BPSSCR03",121,0)
 ;Check for Closed Claim
"RTN","BPSSCR03",122,0)
 I $G(BPARR(2.02))="C",'$$CLOSED02(+$P(BPST0,U,4)) Q 0
"RTN","BPSSCR03",123,0)
 ;Eligibility Indicator
"RTN","BPSSCR03",124,0)
 I '$$FLTELIG^BPSSCR05(BP59,.BPARR) Q 0
"RTN","BPSSCR03",125,0)
 ;Submission type
"RTN","BPSSCR03",126,0)
 I '$$FLTSUBTP^BPSSCR05(BP59,.BPARR) Q 0
"RTN","BPSSCR03",127,0)
 ;user
"RTN","BPSSCR03",128,0)
 I $G(BPARR(1.01))="U",$$FLTUSR(BPST0,.BPARR)=0 Q 0
"RTN","BPSSCR03",129,0)
 ;patient
"RTN","BPSSCR03",130,0)
 I $G(BPARR(1.02))="P",$$FLTPAT(BPST0,.BPARR)=0 Q 0
"RTN","BPSSCR03",131,0)
 ;RX
"RTN","BPSSCR03",132,0)
 I $G(BPARR(1.03))="R",$$FLTRX(BPST1,.BPARR)=0 Q 0
"RTN","BPSSCR03",133,0)
 ;only rejected
"RTN","BPSSCR03",134,0)
 I $G(BPARR(1.06))="R",$$REJECTED^BPSSCR02(BP59)=0 Q 0
"RTN","BPSSCR03",135,0)
 ;only payable
"RTN","BPSSCR03",136,0)
 I $G(BPARR(1.06))="P",$$PAYABLE^BPSSCR02(BP59)=0 Q 0
"RTN","BPSSCR03",137,0)
 ;released
"RTN","BPSSCR03",138,0)
 I $G(BPARR(1.07))="R",$$RL^BPSSCRU2(BP59)'="RL" Q 0
"RTN","BPSSCR03",139,0)
 ;non released
"RTN","BPSSCR03",140,0)
 I $G(BPARR(1.07))="N",$$RL^BPSSCRU2(BP59)="RL" Q 0
"RTN","BPSSCR03",141,0)
 ;window/cmop/mail
"RTN","BPSSCR03",142,0)
 I $G(BPARR(1.08))'="A",$$ISMWC(BPRX52,BPREFNUM,$G(BPARR(1.08)))=0 Q 0
"RTN","BPSSCR03",143,0)
 ;Back billing
"RTN","BPSSCR03",144,0)
 I $G(BPARR(1.09))="B",$$RTBB^BPSSCRU2(BP59)'="BB" Q 0
"RTN","BPSSCR03",145,0)
 ;real time
"RTN","BPSSCR03",146,0)
 I $G(BPARR(1.09))="R",$$RTBB^BPSSCRU2(BP59)="BB" Q 0
"RTN","BPSSCR03",147,0)
 ;if only rejected and only specific rejected codes should be displayed
"RTN","BPSSCR03",148,0)
 I $G(BPARR(1.06))="R",$G(BPARR(1.1))="R",$$FLTREJ(BP59,.BPARR)=0 Q 0
"RTN","BPSSCR03",149,0)
 ;insurance
"RTN","BPSSCR03",150,0)
 I '$$FLTINS^BPSSCR05(BP59,.BPARR) Q 0
"RTN","BPSSCR03",151,0)
 ;divisions - ECME pharmacies
"RTN","BPSSCR03",152,0)
 I $G(BPARR(1.13))="D",BPARR("DIVS")'[(";"_$P(BPST1,U,7)_";") Q 0
"RTN","BPSSCR03",153,0)
 Q 1
"RTN","BPSSCR03",154,0)
 ;
"RTN","BPSSCR03",155,0)
 ;check user filter
"RTN","BPSSCR03",156,0)
 ;input:
"RTN","BPSSCR03",157,0)
 ;BPST0 - zero node of #9002313.59
"RTN","BPSSCR03",158,0)
 ;BPARR array with user's preferences
"RTN","BPSSCR03",159,0)
 ;returns :
"RTN","BPSSCR03",160,0)
 ;1 -okay, leave in the list
"RTN","BPSSCR03",161,0)
 ;0 -not okay, exclude from the list
"RTN","BPSSCR03",162,0)
FLTUSR(BPST0,BPARR) ;
"RTN","BPSSCR03",163,0)
 I $L($G(BPARR(1.16)))=0 Q 0
"RTN","BPSSCR03",164,0)
 I $P(BPST0,U,10)'=$G(BPARR(1.16)) Q 0
"RTN","BPSSCR03",165,0)
 Q 1
"RTN","BPSSCR03",166,0)
 ;check patient filter
"RTN","BPSSCR03",167,0)
 ;input:
"RTN","BPSSCR03",168,0)
 ;BPST0 - zero node of #9002313.59
"RTN","BPSSCR03",169,0)
 ;BPARR array with user's preferences
"RTN","BPSSCR03",170,0)
 ;returns :
"RTN","BPSSCR03",171,0)
 ;1 -okay, leave in the list
"RTN","BPSSCR03",172,0)
 ;0 -not okay, exclude from the list
"RTN","BPSSCR03",173,0)
FLTPAT(BPST0,BPARR) ;
"RTN","BPSSCR03",174,0)
 I $L($G(BPARR(1.17)))=0 Q 0
"RTN","BPSSCR03",175,0)
 I $P(BPST0,U,6)'=$G(BPARR(1.17)) Q 0
"RTN","BPSSCR03",176,0)
 Q 1
"RTN","BPSSCR03",177,0)
 ;check RX filter
"RTN","BPSSCR03",178,0)
 ;input:
"RTN","BPSSCR03",179,0)
 ;BPST1 - 1st node of #9002313.59
"RTN","BPSSCR03",180,0)
 ;BPARR array with user's preferences
"RTN","BPSSCR03",181,0)
 ;returns :
"RTN","BPSSCR03",182,0)
 ;1 -okay, leave in the list
"RTN","BPSSCR03",183,0)
 ;0 -not okay, exclude from the list
"RTN","BPSSCR03",184,0)
FLTRX(BPST1,BPARR) ;
"RTN","BPSSCR03",185,0)
 I $L($G(BPARR(1.18)))=0 Q 0
"RTN","BPSSCR03",186,0)
 I $P(BPST1,U,11)'=$G(BPARR(1.18)) Q 0
"RTN","BPSSCR03",187,0)
 Q 1
"RTN","BPSSCR03",188,0)
 ;input:
"RTN","BPSSCR03",189,0)
 ;BP59 - zero node of #9002313.59
"RTN","BPSSCR03",190,0)
 ;BPARR array with user's preferences
"RTN","BPSSCR03",191,0)
 ;returns :
"RTN","BPSSCR03",192,0)
 ;1 -okay, leave in the list
"RTN","BPSSCR03",193,0)
 ;0 -not okay, exclude from the list
"RTN","BPSSCR03",194,0)
FLTREJ(BP59,BPARR) ;
"RTN","BPSSCR03",195,0)
 N BPRCODES
"RTN","BPSSCR03",196,0)
 N BPRJCD
"RTN","BPSSCR03",197,0)
 S BPRJCD=$P($G(^BPSF(9002313.93,+$G(BPARR(1.15)),0)),U)
"RTN","BPSSCR03",198,0)
 I $L(BPRJCD)=0 Q 0
"RTN","BPSSCR03",199,0)
 D REJCODES^BPSSCRU3(BP59,.BPRCODES)
"RTN","BPSSCR03",200,0)
 I $D(BPRCODES(BPRJCD)) Q 1
"RTN","BPSSCR03",201,0)
 Q 0
"RTN","BPSSCR03",202,0)
 ;
"RTN","BPSSCR03",203,0)
 ;check W(indow)/C(mop)/M(ail)
"RTN","BPSSCR03",204,0)
 ;input:
"RTN","BPSSCR03",205,0)
 ;BPRX52 - ptr to #52
"RTN","BPSSCR03",206,0)
 ;BPREFNUM - refill #
"RTN","BPSSCR03",207,0)
 ;BPMWC - given value from CMOP/MAIL/WINDOW instance 1.08 of BPS USRSCR parameters
"RTN","BPSSCR03",208,0)
 ;returns :
"RTN","BPSSCR03",209,0)
 ;1 -okay, leave in the list
"RTN","BPSSCR03",210,0)
 ;0 -not okay, exclude from the list
"RTN","BPSSCR03",211,0)
ISMWC(BPRX52,BPREFNUM,BPMWC) ;
"RTN","BPSSCR03",212,0)
 I $$MWCNAME^BPSSCRU2($$MWC^BPSSCRU2(BPRX52,BPREFNUM))=BPMWC Q 1
"RTN","BPSSCR03",213,0)
 Q 0
"RTN","BPSSCR03",214,0)
 ;
"RTN","BPSSCR03",215,0)
FILTRALL(BPTMP1,BPTMP2,BPARR) ;
"RTN","BPSSCR03",216,0)
 N BP59
"RTN","BPSSCR03",217,0)
 S BP59=0
"RTN","BPSSCR03",218,0)
 F  S BP59=+$O(@BPTMP1@(BP59)) Q:+BP59=0  D
"RTN","BPSSCR03",219,0)
 . I $$FILTER(BP59,.BPARR) S @BPTMP2@(BP59)=""
"RTN","BPSSCR03",220,0)
 Q
"RTN","BPSSCR03",221,0)
 ;
"RTN","BPSSCR03",222,0)
 ;go thru all FILE59 entries and run SETTRDFN for each of them
"RTN","BPSSCR03",223,0)
 ;
"RTN","BPSSCR03",224,0)
TRDFNALL(BPTMP) ;
"RTN","BPSSCR03",225,0)
 N BP59
"RTN","BPSSCR03",226,0)
 S BP59=0
"RTN","BPSSCR03",227,0)
 F  S BP59=+$O(@BPTMP@("FILE59",BP59)) Q:+BP59=0  D
"RTN","BPSSCR03",228,0)
 . D SETTRDFN(BPTMP,BP59)
"RTN","BPSSCR03",229,0)
 Q
"RTN","BPSSCR03",230,0)
 ;
"RTN","BPSSCR03",231,0)
 ;sorting for "TRANSACTION DATE" type is
"RTN","BPSSCR03",232,0)
 ;actually sorting by patients , but patient should be sorted not in alphabetical order:
"RTN","BPSSCR03",233,0)
 ;the first patient is the one which has the most recent transaction and so on
"RTN","BPSSCR03",234,0)
 ;BPTMP - TMP global
"RTN","BPSSCR03",235,0)
 ;BP59 - ptr to #9002313.59
"RTN","BPSSCR03",236,0)
SETTRDFN(BPTMP,BP59) ;
"RTN","BPSSCR03",237,0)
 ;the following stores the latest transaction date of the claims, which
"RTN","BPSSCR03",238,0)
 ;was found for this particular combination of patient and insurance
"RTN","BPSSCR03",239,0)
 ;@BPTMP@("DFN-TRDT",BPDFN,BPINSUR)=BPTRDT
"RTN","BPSSCR03",240,0)
 ;the following stores the latest transaction date BPTRDT,patient BPDFN and
"RTN","BPSSCR03",241,0)
 ;insurance BPINSUR to provide a proper order
"RTN","BPSSCR03",242,0)
 ;@BPTMP@("TRDTDFN",BPTRDT,BPDFN,BPINSUR)=""
"RTN","BPSSCR03",243,0)
 N BPZERO,BPTRDT,BPDFN,BPPREV,BPINSUR
"RTN","BPSSCR03",244,0)
 S BPZERO=$G(^BPST(BP59,0)) ;
"RTN","BPSSCR03",245,0)
 S BPTRDT=-$P(BPZERO,U,8) ;"transaction" date
"RTN","BPSSCR03",246,0)
 S BPDFN=+$P(BPZERO,U,6) ;patient ptr to #2
"RTN","BPSSCR03",247,0)
 S BPINSUR=+$$GETINSUR^BPSSCRU2(BP59) ;insurance ien
"RTN","BPSSCR03",248,0)
 ;in the beginning we don't have any "DFN-TRDT" and "TRDTDFN"
"RTN","BPSSCR03",249,0)
 ;so create them and quit
"RTN","BPSSCR03",250,0)
 I '$D(@BPTMP@("DFN-TRDT",BPDFN,BPINSUR)) D  Q
"RTN","BPSSCR03",251,0)
 . S @BPTMP@("DFN-TRDT",BPDFN,BPINSUR)=BPTRDT
"RTN","BPSSCR03",252,0)
 . S @BPTMP@("TRDTDFN",BPTRDT,BPDFN,BPINSUR)=""
"RTN","BPSSCR03",253,0)
 ;if we already have them then get the latest into BPPREV
"RTN","BPSSCR03",254,0)
 S BPPREV=+$G(@BPTMP@("DFN-TRDT",BPDFN,BPINSUR))
"RTN","BPSSCR03",255,0)
 ;and compare it against the BPTRDT for this BP59
"RTN","BPSSCR03",256,0)
 ;if the BPTRDT is greater then replace the values in "DFN-TRDT"
"RTN","BPSSCR03",257,0)
 ;and "TRDTDFN"
"RTN","BPSSCR03",258,0)
 I BPTRDT<BPPREV D
"RTN","BPSSCR03",259,0)
 . S @BPTMP@("TRDTDFN",BPTRDT,BPDFN,BPINSUR)=""
"RTN","BPSSCR03",260,0)
 . S @BPTMP@("DFN-TRDT",BPDFN,BPINSUR)=BPTRDT
"RTN","BPSSCR03",261,0)
 . K @BPTMP@("TRDTDFN",BPPREV,BPDFN,BPINSUR)
"RTN","BPSSCR03",262,0)
 Q
"RTN","BPSSCR05")
0^80^B7623180
"RTN","BPSSCR05",1,0)
BPSSCR05 ;BHAM ISC/BNT - ECME USR SCREEN UTILITIES ;05-APR-05
"RTN","BPSSCR05",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**7**;JUN 2004;Build 46
"RTN","BPSSCR05",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSSCR05",4,0)
 Q
"RTN","BPSSCR05",5,0)
 ;Filter Eligibility of Veteran, Tricare, or ChampVA (ChampVA is reserved for future use)
"RTN","BPSSCR05",6,0)
 ;input:
"RTN","BPSSCR05",7,0)
 ;BP59 - ptr to #59
"RTN","BPSSCR05",8,0)
 ;BPARR - array with user's preferences
"RTN","BPSSCR05",9,0)
 ;returns :
"RTN","BPSSCR05",10,0)
 ;1 -okay, leave in the list
"RTN","BPSSCR05",11,0)
 ;0 -not okay, exclude from the list
"RTN","BPSSCR05",12,0)
FLTELIG(BP59,BPARR) ;
"RTN","BPSSCR05",13,0)
 Q:$G(BPARR(2.01))="A" 1
"RTN","BPSSCR05",14,0)
 I $G(BPARR(2.01))="" S BPARR(2.01)="V"
"RTN","BPSSCR05",15,0)
 Q $S($$ELIGCODE(BP59)=$G(BPARR(2.01)):1,1:0)
"RTN","BPSSCR05",16,0)
 ;Filter Submission Type of Billing Requests or Reversals
"RTN","BPSSCR05",17,0)
 ;input:
"RTN","BPSSCR05",18,0)
 ;BP59 - ptr to #59
"RTN","BPSSCR05",19,0)
 ;BPARR - array with user's preferences
"RTN","BPSSCR05",20,0)
 ;returns :
"RTN","BPSSCR05",21,0)
 ;1 -okay, leave in the list
"RTN","BPSSCR05",22,0)
 ;0 -not okay, exclude from the list
"RTN","BPSSCR05",23,0)
FLTSUBTP(BP59,BPARR) ;
"RTN","BPSSCR05",24,0)
 N BPSCLM,BPTRCD
"RTN","BPSSCR05",25,0)
 Q:$G(BPARR(2.03))="A" 1
"RTN","BPSSCR05",26,0)
 Q:$G(BPARR(2.03))="" 1
"RTN","BPSSCR05",27,0)
 ; Get the claim IEN
"RTN","BPSSCR05",28,0)
 S BPSCLM=$S($P($G(^BPST(BP59,4)),U)>0:$P($G(^BPST(BP59,4)),U),1:$P($G(^BPST(BP59,0)),U,4))
"RTN","BPSSCR05",29,0)
 Q:BPSCLM="" 0
"RTN","BPSSCR05",30,0)
 ; Get the Transaction Code from BPS CLAIMS
"RTN","BPSSCR05",31,0)
 S BPTRCD=$$TRNSCODE(BPSCLM)
"RTN","BPSSCR05",32,0)
 Q:BPTRCD="" 0
"RTN","BPSSCR05",33,0)
 ; Transaction Code B1 = Billing Request, B2 = Reversal
"RTN","BPSSCR05",34,0)
 Q $S((BPTRCD="B1")&($G(BPARR(2.03))="B"):1,(BPTRCD="B2")&($G(BPARR(2.03))="R"):1,1:0)
"RTN","BPSSCR05",35,0)
 ;
"RTN","BPSSCR05",36,0)
 ;Filter Insurance companies
"RTN","BPSSCR05",37,0)
 ;input:
"RTN","BPSSCR05",38,0)
 ;BP59 - ptr to #59
"RTN","BPSSCR05",39,0)
 ;BPARR - array with user's preferences
"RTN","BPSSCR05",40,0)
 ;returns :
"RTN","BPSSCR05",41,0)
 ;1 -okay, leave in the list
"RTN","BPSSCR05",42,0)
 ;0 -not okay, exclude from the list
"RTN","BPSSCR05",43,0)
FLTINS(BP59,BPARR) ;
"RTN","BPSSCR05",44,0)
 Q:$G(BPARR(1.11))="A" 1
"RTN","BPSSCR05",45,0)
 Q:$G(BPARR(2.04))="" 1
"RTN","BPSSCR05",46,0)
 N BPINS,BPJ,BPINSIEN,I
"RTN","BPSSCR05",47,0)
 S BPINSIEN=$P($G(^BPST(BP59,10,+$G(^BPST(BP59,9)),0)),U)
"RTN","BPSSCR05",48,0)
 S BPINS=0
"RTN","BPSSCR05",49,0)
 F I=2:1 S BPJ=$P(BPARR(2.04),";",I) Q:BPJ=""  D  Q:BPINS
"RTN","BPSSCR05",50,0)
 . S BPINS=$S($$INSPL^IBNCPDPI(BPINSIEN)=BPJ:1,1:0)
"RTN","BPSSCR05",51,0)
 Q BPINS
"RTN","BPSSCR05",52,0)
 ;
"RTN","BPSSCR05",53,0)
 ;/**
"RTN","BPSSCR05",54,0)
 ;Returns the Eligibility Code for the entry in file 59
"RTN","BPSSCR05",55,0)
 ;input:
"RTN","BPSSCR05",56,0)
 ;BP59 - ptr to file 59
"RTN","BPSSCR05",57,0)
 ;returns:
"RTN","BPSSCR05",58,0)
 ;V=Veteran, T=Tricare, C=ChampVA, or null
"RTN","BPSSCR05",59,0)
ELIGCODE(BP59) ; **/
"RTN","BPSSCR05",60,0)
 Q $P($G(^BPST(BP59,9)),U,4)
"RTN","BPSSCR05",61,0)
 ;
"RTN","BPSSCR05",62,0)
 ;Returns the Transaction Code for a claim
"RTN","BPSSCR05",63,0)
 ;input:
"RTN","BPSSCR05",64,0)
 ;BP02 - ptr to BPS CLAIMS file
"RTN","BPSSCR05",65,0)
 ;returns:
"RTN","BPSSCR05",66,0)
 ;Internal value of TRANSACTION CODE field
"RTN","BPSSCR05",67,0)
 ;B1 = Billing, B2 = Reversal, B3 = Rebill, etc.
"RTN","BPSSCR05",68,0)
TRNSCODE(BP02) ;
"RTN","BPSSCR05",69,0)
 Q $P($G(^BPSC(BP02,100)),U,3)
"RTN","BPSSCR05",70,0)
 ;
"RTN","BPSSCR05",71,0)
 ;MKNEWARR is called by CLOSE^BPSSCRCL to create an array
"RTN","BPSSCR05",72,0)
 ;of BP59 records for use by the Close Claims option.
"RTN","BPSSCR05",73,0)
 ;
"RTN","BPSSCR05",74,0)
MKNEWARR(BPARR,BPNEWARR,BPINSARR) ;
"RTN","BPSSCR05",75,0)
 N BP59,BPREJ,BPREJCNT,BPRELCNT,BPREL,BPINS,BPCLST,BPDFN
"RTN","BPSSCR05",76,0)
 S BPREJCNT=0,BPRELCNT=0
"RTN","BPSSCR05",77,0)
 S BPINS=0
"RTN","BPSSCR05",78,0)
 S BP59="" F  S BP59=$O(BPARR(BP59)) Q:BP59=""  D
"RTN","BPSSCR05",79,0)
 . S BPREJ=0
"RTN","BPSSCR05",80,0)
 . S BPDFN=+$P($G(^BPST(BP59,0)),U,6)
"RTN","BPSSCR05",81,0)
 . S BPCLST=$$CLAIMST^BPSSCRU3(BP59)
"RTN","BPSSCR05",82,0)
 . S BPREJ=$S($P(BPCLST,U)="E REJECTED":1,$P(BPCLST,U)="E REVERSAL ACCEPTED":1,1:0)
"RTN","BPSSCR05",83,0)
 . S:BPREJ BPREJCNT=BPREJCNT+1
"RTN","BPSSCR05",84,0)
 . S BPREL=$S($$RXAPI1^BPSUTIL1(+$P($$RXREF^BPSSCRU2(BP59),U),106,"I"):1,1:0)
"RTN","BPSSCR05",85,0)
 . S:BPREL BPRELCNT=BPRELCNT+1
"RTN","BPSSCR05",86,0)
 . S BPNEWARR(BPDFN,BP59)=BPARR(BP59)_U_BPREJ_U_BPREL
"RTN","BPSSCR05",87,0)
 . S BPINS=$P($$GETINSUR^BPSSCRU2(BP59),U,2)
"RTN","BPSSCR05",88,0)
 . I BPREJ=1,$L(BPINS)>0 S BPINSARR(BPDFN,BPINS,BP59)=BPARR(BP59)
"RTN","BPSSCR05",89,0)
 Q BPREJCNT_U_BPRELCNT
"RTN","BPSSCR05",90,0)
 ;
"RTN","BPSSCRCL")
0^32^B65041094
"RTN","BPSSCRCL",1,0)
BPSSCRCL ;BHAM ISC/SS - ECME SCREEN CLOSE CLAIMS ;05-APR-05
"RTN","BPSSCRCL",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,3,5,7**;JUN 2004;Build 46
"RTN","BPSSCRCL",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSSCRCL",4,0)
 Q
"RTN","BPSSCRCL",5,0)
 ;
"RTN","BPSSCRCL",6,0)
CLO ;entry point to close claims
"RTN","BPSSCRCL",7,0)
 N BPRET,BPSARR59
"RTN","BPSSCRCL",8,0)
 I '$D(@(VALMAR)) Q
"RTN","BPSSCRCL",9,0)
 D FULL^VALM1
"RTN","BPSSCRCL",10,0)
 W !,"Enter the line numbers for the claim(s) to be closed."
"RTN","BPSSCRCL",11,0)
 S BPRET=$$ASKLINES^BPSSCRU4("Select item(s)","C",.BPSARR59,VALMAR)
"RTN","BPSSCRCL",12,0)
 I BPRET="^" S VALMBCK="R" Q
"RTN","BPSSCRCL",13,0)
 ;close claims
"RTN","BPSSCRCL",14,0)
 ;update the content of the screen
"RTN","BPSSCRCL",15,0)
 ;only if at least one claim was closed
"RTN","BPSSCRCL",16,0)
 I $$CLOSE(.BPSARR59) D REDRAW^BPSSCRUD("Updating screen for closed claims...")
"RTN","BPSSCRCL",17,0)
 E  S VALMBCK="R"
"RTN","BPSSCRCL",18,0)
 Q
"RTN","BPSSCRCL",19,0)
 ;
"RTN","BPSSCRCL",20,0)
 ;close claims
"RTN","BPSSCRCL",21,0)
 ;input:
"RTN","BPSSCRCL",22,0)
 ; BP59ARR - array with ptrs to BPS TRANSACTION FILE
"RTN","BPSSCRCL",23,0)
 ;       BP59ARR(ien59)="ien in TMP ^ number on the user screen"
"RTN","BPSSCRCL",24,0)
 ;returns:
"RTN","BPSSCRCL",25,0)
 ; BPCLTOT - number of closed claims
"RTN","BPSSCRCL",26,0)
CLOSE(BP59ARR) ;
"RTN","BPSSCRCL",27,0)
 N BPNEWARR,BPRETV,BPREJFLG,X
"RTN","BPSSCRCL",28,0)
 N BPDFN,BP59,BPIFANY,BPQ
"RTN","BPSSCRCL",29,0)
 N BPREAS,BPCOMM,BP90ANSW,BPRCOPAY,BPRXINFO,BPCOP,BPCLTOT,BPINS,BPINSNM,BP59FRST
"RTN","BPSSCRCL",30,0)
 S BPRETV=$$MKNEWARR^BPSSCR05(.BP59ARR,.BPNEWARR,.BPINS)
"RTN","BPSSCRCL",31,0)
 S BPQ="",BPIFANY=0,BPREJFLG=1
"RTN","BPSSCRCL",32,0)
 S BPDFN=""
"RTN","BPSSCRCL",33,0)
 F  S BPDFN=$O(BPNEWARR(BPDFN)) Q:BPDFN=""  D  Q:BPQ="^"
"RTN","BPSSCRCL",34,0)
 . W !!,"You've chosen to close the following prescription(s) for",!,$E($$PATNAME^BPSSCRU2(BPDFN),1,13)_" :"
"RTN","BPSSCRCL",35,0)
 . S BP59="" F  S BP59=$O(BPNEWARR(BPDFN,BP59)) Q:BP59=""  D  Q:BPQ="^"
"RTN","BPSSCRCL",36,0)
 . . I $Y>20 D PAUSE^VALM1 W @IOF I X="^" S BPQ="^" Q
"RTN","BPSSCRCL",37,0)
 . . S BPIFANY=1,BPQ=""
"RTN","BPSSCRCL",38,0)
 . . S BPREJFLG=+$P($G(BPNEWARR(BPDFN,BP59)),U,3)
"RTN","BPSSCRCL",39,0)
 . . W !,@VALMAR@(+$G(BPNEWARR(BPDFN,BP59)),0)
"RTN","BPSSCRCL",40,0)
 . . D DISPREJ^BPSSCRU6(BP59)
"RTN","BPSSCRCL",41,0)
 . .  ;can't close a closed claim. The user must reopen first.
"RTN","BPSSCRCL",42,0)
 . . I $$CLOSED02^BPSSCR03($P($G(^BPST(BP59,0)),U,4)) W !,"This claim is already closed." S BPQ="^" Q
"RTN","BPSSCRCL",43,0)
 . . W:BPREJFLG=0 !,"Claim Neither Rejected Nor Reversed and cannot be Closed."
"RTN","BPSSCRCL",44,0)
 I +BPRETV=0 Q $$QUITCL()
"RTN","BPSSCRCL",45,0)
 I BPQ="^" Q $$QUITCL()
"RTN","BPSSCRCL",46,0)
 ;
"RTN","BPSSCRCL",47,0)
 W !!,"ALL Selected Rxs will be CLOSED using the same information gathered in the following prompts.",!
"RTN","BPSSCRCL",48,0)
 S BPQ=$$YESNO^BPSSCRRS("Are you sure?(Y/N)")
"RTN","BPSSCRCL",49,0)
 I BPQ'=1 Q $$QUITCL()
"RTN","BPSSCRCL",50,0)
 ;
"RTN","BPSSCRCL",51,0)
 ; ask questions for all of them
"RTN","BPSSCRCL",52,0)
 W !!
"RTN","BPSSCRCL",53,0)
 I $$ASKQUEST(+$P(BPRETV,U,2),.BPREAS,.BPCOMM,.BP90ANSW,.BPRCOPAY)'=1 Q $$QUITCL()
"RTN","BPSSCRCL",54,0)
 ;
"RTN","BPSSCRCL",55,0)
 ; check 2nd insurance
"RTN","BPSSCRCL",56,0)
 S BPQ=""
"RTN","BPSSCRCL",57,0)
 I BP90ANSW'="D" D
"RTN","BPSSCRCL",58,0)
 . S BPDFN="" F  S BPDFN=$O(BPINS(BPDFN)) Q:BPDFN=""  D  Q:BPQ="^"
"RTN","BPSSCRCL",59,0)
 . . S BPINSNM="" F  S BPINSNM=$O(BPINS(BPDFN,BPINSNM)) Q:BPINSNM=""  D  Q:BPQ="^"
"RTN","BPSSCRCL",60,0)
 . . . S BP59FRST=0
"RTN","BPSSCRCL",61,0)
 . . . S BP59=""
"RTN","BPSSCRCL",62,0)
 . . . K BPRXINFO
"RTN","BPSSCRCL",63,0)
 . . . F  S BP59=$O(BPINS(BPDFN,BPINSNM,BP59)) Q:BP59=""  D  Q:BPQ="^"
"RTN","BPSSCRCL",64,0)
 . . . . S:BP59FRST=0 BP59FRST=BP59
"RTN","BPSSCRCL",65,0)
 . . . . S BPRXINFO(BP59)=$E($G(@VALMAR@(+$G(BP59ARR(BP59)),0)),7,99)
"RTN","BPSSCRCL",66,0)
 . . . ; call CH2NDINS^BPSSCRU5 only once for all claims for this patient and insurance
"RTN","BPSSCRCL",67,0)
 . . . ; you can use one BP59FRST for the group of claims here as a parameter since 
"RTN","BPSSCRCL",68,0)
 . . . ; they all are all identical from the "patient-insurance pair" point of view
"RTN","BPSSCRCL",69,0)
 . . . D:BP59FRST>0 CH2NDINS^BPSSCRU5(BP59FRST,$E($$PATNAME^BPSSCRU2(BPDFN),1,13),BPINSNM,.BPRXINFO)
"RTN","BPSSCRCL",70,0)
 ;
"RTN","BPSSCRCL",71,0)
 I BPQ="^" Q $$QUITCL()
"RTN","BPSSCRCL",72,0)
 ;
"RTN","BPSSCRCL",73,0)
 W @IOF
"RTN","BPSSCRCL",74,0)
 ;and finally close all
"RTN","BPSSCRCL",75,0)
 S BPCLTOT=0
"RTN","BPSSCRCL",76,0)
 S BPDFN="" F  S BPDFN=$O(BPNEWARR(BPDFN)) Q:BPDFN=""  D
"RTN","BPSSCRCL",77,0)
 . S BP59="" F  S BP59=$O(BPNEWARR(BPDFN,BP59)) Q:BP59=""  D
"RTN","BPSSCRCL",78,0)
 . . I $P($G(BPNEWARR(BPDFN,BP59)),U,3)=0 Q  ;can't be closed
"RTN","BPSSCRCL",79,0)
 . . S BPCOP=0
"RTN","BPSSCRCL",80,0)
 . . I +BPRCOPAY=1,$P($G(BPNEWARR(BPDFN,BP59)),U,4)=1 S BPCOP=1 ;release copay
"RTN","BPSSCRCL",81,0)
 . . I $$CLOSEIT(BP59,$P(BPREAS,U,2),BPCOMM,BP90ANSW,BPCOP)>0 D
"RTN","BPSSCRCL",82,0)
 . . . S BPCLTOT=BPCLTOT+1
"RTN","BPSSCRCL",83,0)
 ;
"RTN","BPSSCRCL",84,0)
 W !,BPCLTOT," claim",$S(BPCLTOT'=1:"s have",1:" has")," been closed.",!
"RTN","BPSSCRCL",85,0)
 D PAUSE^VALM1
"RTN","BPSSCRCL",86,0)
 Q BPCLTOT
"RTN","BPSSCRCL",87,0)
 ;
"RTN","BPSSCRCL",88,0)
QUITCL() ;
"RTN","BPSSCRCL",89,0)
 W !!,"0 claims have been closed."
"RTN","BPSSCRCL",90,0)
 D PAUSE^VALM1
"RTN","BPSSCRCL",91,0)
 Q 0
"RTN","BPSSCRCL",92,0)
 ;/**
"RTN","BPSSCRCL",93,0)
 ;Ask all necessary questions
"RTN","BPSSCRCL",94,0)
 ;Input
"RTN","BPSSCRCL",95,0)
 ; BPRELCOP - ask release copay question
"RTN","BPSSCRCL",96,0)
 ; .BPREAZ - ptr to #356.8 ^ CLOSE REASON NAME ^ ECME FLAG ^ ECME PAPER FLAG
"RTN","BPSSCRCL",97,0)
 ; .BPCOMZ - close comment (string)
"RTN","BPSSCRCL",98,0)
 ; .BP90ANSZ - "", "D"(drop to paper) or "N" (non-billable)
"RTN","BPSSCRCL",99,0)
 ; .BPRCOPAZ - 1(Yes) or 0(No) , answer to "release copay" question
"RTN","BPSSCRCL",100,0)
 ;Output:
"RTN","BPSSCRCL",101,0)
 ; 0 - cancel process
"RTN","BPSSCRCL",102,0)
 ; ^ - emergency quit (cancel process)
"RTN","BPSSCRCL",103,0)
 ; 1 - ok, can proceed
"RTN","BPSSCRCL",104,0)
ASKQUEST(BPRELCOP,BPREAZ,BPCOMZ,BP90ANSZ,BPRCOPAZ) ;*/
"RTN","BPSSCRCL",105,0)
 S BPCOMZ=""
"RTN","BPSSCRCL",106,0)
 S BP90ANSZ=""
"RTN","BPSSCRCL",107,0)
 S BPRCOPAZ=0
"RTN","BPSSCRCL",108,0)
 ;ask the user to choose the close reason from #356.8
"RTN","BPSSCRCL",109,0)
 ;using set of close reasons in IB file 356.8
"RTN","BPSSCRCL",110,0)
 S BPREAZ=$$REASON()
"RTN","BPSSCRCL",111,0)
 I BPREAZ="^" Q "^"
"RTN","BPSSCRCL",112,0)
 I ($P(BPREAZ,U,4)=1) D  ;if has ECME PAPER FLAG
"RTN","BPSSCRCL",113,0)
 . ;ask if the claim is still billable thru paper?
"RTN","BPSSCRCL",114,0)
 . S BP90ANSZ=$$PROMPT^BPSSCRCV("S^N:NON-BILLABLE;D:DROP TO PAPER","Treat as (N)on-Billable Episode or (D)rop Bill to Paper?","")
"RTN","BPSSCRCL",115,0)
 I BP90ANSZ=-1 Q "^"
"RTN","BPSSCRCL",116,0)
 S BPCOMZ=$$COMMENT("Comment ",40)
"RTN","BPSSCRCL",117,0)
 I (BPCOMZ="^") Q "^"
"RTN","BPSSCRCL",118,0)
 I $L(BPCOMZ)>0,BPCOMZ?1" "." " S BPCOMZ=""
"RTN","BPSSCRCL",119,0)
 ;check copay
"RTN","BPSSCRCL",120,0)
 ;ask "release copay?" in all NON-BILLABLE cases, i.e. except user answered "DROP TO PAPER"
"RTN","BPSSCRCL",121,0)
 ;(even in cases when he was not asked about it)
"RTN","BPSSCRCL",122,0)
 I BP90ANSZ'="D",BPRELCOP D
"RTN","BPSSCRCL",123,0)
 . ; Ask user if s/he wants to release a copay
"RTN","BPSSCRCL",124,0)
 . S BPRCOPAZ=$$YESNO^BPSSCRRS("Release Patient CoPay(Y/N)")
"RTN","BPSSCRCL",125,0)
 I BPRCOPAZ=-1 Q "^"
"RTN","BPSSCRCL",126,0)
 ;
"RTN","BPSSCRCL",127,0)
 S BPQ=$$YESNO^BPSSCRRS("Are you sure?(Y/N)")
"RTN","BPSSCRCL",128,0)
 I BPQ=-1 Q "^" ;quit by "^"
"RTN","BPSSCRCL",129,0)
 I BPQ'=1 Q 0 ;doesn't want to proceed
"RTN","BPSSCRCL",130,0)
 Q 1 ; answers can be used
"RTN","BPSSCRCL",131,0)
 ;
"RTN","BPSSCRCL",132,0)
 ;/**
"RTN","BPSSCRCL",133,0)
 ;ask for the close reason
"RTN","BPSSCRCL",134,0)
 ;return:
"RTN","BPSSCRCL",135,0)
 ;   ptr to #356.8 ^ CLOSE REASON NAME ^ ECME FLAG ^ ECME PAPER FLAG
"RTN","BPSSCRCL",136,0)
REASON() ;
"RTN","BPSSCRCL",137,0)
 N DIC,BPREASNM,BP3568,Y
"RTN","BPSSCRCL",138,0)
 ; - Asks for REASON for Closing
"RTN","BPSSCRCL",139,0)
 S DIC="^IBE(356.8,",DIC(0)="AEQMZ"
"RTN","BPSSCRCL",140,0)
 S DIC("S")="I $P(^(0),U,2)=1"
"RTN","BPSSCRCL",141,0)
 D ^DIC
"RTN","BPSSCRCL",142,0)
 I Y=-1 Q "^"
"RTN","BPSSCRCL",143,0)
 Q +Y_U_Y(0)
"RTN","BPSSCRCL",144,0)
 ;/**
"RTN","BPSSCRCL",145,0)
 ;enter the comment
"RTN","BPSSCRCL",146,0)
 ;BPSTR  -prompt string
"RTN","BPSSCRCL",147,0)
 ;BPMLEN -maxlen
"RTN","BPSSCRCL",148,0)
COMMENT(BPSTR,BPMLEN) ;*/
"RTN","BPSSCRCL",149,0)
 N DIR,DTOUT,DUOUT,BPQ
"RTN","BPSSCRCL",150,0)
 I '$D(BPSTR) S BPSTR="Comment "
"RTN","BPSSCRCL",151,0)
 I '$D(BPMLEN) S BPMLEN=40
"RTN","BPSSCRCL",152,0)
 S DIR(0)="FO^0:250"
"RTN","BPSSCRCL",153,0)
 S DIR("A")=BPSTR
"RTN","BPSSCRCL",154,0)
 S DIR("?",1)="This response must have no more than "_BPMLEN_" characters"
"RTN","BPSSCRCL",155,0)
 S DIR("?")="and must not contain embedded uparrow."
"RTN","BPSSCRCL",156,0)
 S BPQ=0
"RTN","BPSSCRCL",157,0)
 F  D  Q:+BPQ'=0
"RTN","BPSSCRCL",158,0)
 . D ^DIR
"RTN","BPSSCRCL",159,0)
 . I $D(DUOUT)!($D(DTOUT)) S BPQ=-1 Q
"RTN","BPSSCRCL",160,0)
 . I $L(Y)'>BPMLEN S BPQ=1 Q
"RTN","BPSSCRCL",161,0)
 . W !!,"This response must have no more than "_BPMLEN_" characters"
"RTN","BPSSCRCL",162,0)
 . W !,"and must not contain embedded uparrow.",!
"RTN","BPSSCRCL",163,0)
 . S DIR("B")=$E(Y,1,BPMLEN)
"RTN","BPSSCRCL",164,0)
 Q:BPQ<0 "^"
"RTN","BPSSCRCL",165,0)
 Q Y
"RTN","BPSSCRCL",166,0)
 ;/** 
"RTN","BPSSCRCL",167,0)
 ;close the claim
"RTN","BPSSCRCL",168,0)
 ;the approach and code partially borrowed from IHS code CLOSE^BPSOS6N
"RTN","BPSSCRCL",169,0)
 ;BPSTRA - ptr to #9002313.59
"RTN","BPSSCRCL",170,0)
 ;REASON - text name of the close reason 
"RTN","BPSSCRCL",171,0)
 ;BPSCLCM - comment 
"RTN","BPSSCRCL",172,0)
 ;BPDROP:
"RTN","BPSSCRCL",173,0)
 ;  "D" - DROP BILL TO PAPER
"RTN","BPSSCRCL",174,0)
 ;  "N" - NON-BILLABLE
"RTN","BPSSCRCL",175,0)
 ;BPRELCOP - 1 (Yes) or 0 (No) release copay or not?
"RTN","BPSSCRCL",176,0)
CLOSEIT(BPSTRA,REASON,BPSCLCM,BPDROP,BPRELCOP) ;
"RTN","BPSSCRCL",177,0)
 N BPSCLA,ERROR,DA,DR,BPLCK,DIE
"RTN","BPSSCRCL",178,0)
 S BPSCLA=$$GET1^DIQ(9002313.59,BPSTRA,3,"I")
"RTN","BPSSCRCL",179,0)
 W !,"Closing Claim ",$$GET1^DIQ(9002313.02,BPSCLA,.01),"..."
"RTN","BPSSCRCL",180,0)
 S BPLCK=0
"RTN","BPSSCRCL",181,0)
 L +^BPSC(BPSCLA):0
"RTN","BPSSCRCL",182,0)
 I $T S BPLCK=1
"RTN","BPSSCRCL",183,0)
 E  W !,"       *** CLAIM ",$$GET1^DIQ(9002313.02,BPSCLA,.01)," IN USE ***" Q 0
"RTN","BPSSCRCL",184,0)
 D CLOSE^BPSBUTL(BPSCLA,BPSTRA,REASON,$S($G(BPDROP)="D":1,1:0),BPRELCOP,BPSCLCM,.ERROR)
"RTN","BPSSCRCL",185,0)
 I $D(ERROR) W "NOT OK" D DSPERR(ERROR) D  Q 0
"RTN","BPSSCRCL",186,0)
 . I BPLCK=1 L -^BPSC(BPSCLA)
"RTN","BPSSCRCL",187,0)
 S DIE="^BPSC(",DA=BPSCLA,DR="901///1;902///"_$$NOW^XLFDT()_";903////"_DUZ_";904///"_REASON_";905////"_BPDROP D ^DIE
"RTN","BPSSCRCL",188,0)
 I BPLCK=1 L -^BPSC(BPSCLA)
"RTN","BPSSCRCL",189,0)
 H 1 W "OK"
"RTN","BPSSCRCL",190,0)
 Q 1
"RTN","BPSSCRCL",191,0)
 ;
"RTN","BPSSCRCL",192,0)
DSPERR(MSG) ; Display the ERROR message
"RTN","BPSSCRCL",193,0)
 W !,"Error: *** ",MSG," ***"
"RTN","BPSSCRCL",194,0)
 Q
"RTN","BPSSCRCL",195,0)
 ;
"RTN","BPSSCRCL",196,0)
 ;/**
"RTN","BPSSCRCL",197,0)
 ;ECME has tried to submit the claim to insurance with the name BPINSNAM
"RTN","BPSSCRCL",198,0)
 ;but the claim was rejected and now we need to determine if the patient
"RTN","BPSSCRCL",199,0)
 ;has any other insurance with pharmacy coverage that can be billed for the RX
"RTN","BPSSCRCL",200,0)
 ;Input:
"RTN","BPSSCRCL",201,0)
 ; BP59 - pointer to file #9002313.59
"RTN","BPSSCRCL",202,0)
 ; BPINSNAM - insurance that have already been used by ECME
"RTN","BPSSCRCL",203,0)
 ;Output:
"RTN","BPSSCRCL",204,0)
 ; 0 - not found
"RTN","BPSSCRCL",205,0)
 ; 1 ^ Insurance Name ^ Group Number ^ Date  of service
"RTN","BPSSCRCL",206,0)
NEXTINS(BP59,BPINSNAM) ;get insurance info by the pointer of #9002313.59
"RTN","BPSSCRCL",207,0)
 N BPDOS,BPDFN,BPZZ,BP36,BPX,BPHONE,BPY,BPINSNM
"RTN","BPSSCRCL",208,0)
 N BPPHARM,BPCOORD,BPINS,BPFOUND
"RTN","BPSSCRCL",209,0)
 S BPY=0
"RTN","BPSSCRCL",210,0)
 S BPHONE=$P($G(^BPST(BP59,10,+$G(^BPST(BP59,9)),3)),U,2)
"RTN","BPSSCRCL",211,0)
 S BPDOS=+$P($G(^BPST(BP59,12)),U,2)\1
"RTN","BPSSCRCL",212,0)
 I BPDOS=0 S BPDOS=+$P($G(^BPST(BP59,0)),U,8)\1
"RTN","BPSSCRCL",213,0)
 S BPDFN=+$P($G(^BPST(BP59,0)),U,6)
"RTN","BPSSCRCL",214,0)
 ; call INSUR^IBBAPI to get information about:
"RTN","BPSSCRCL",215,0)
 ;1 = Insurance Company Name
"RTN","BPSSCRCL",216,0)
 ;7 = Coordination of Benefits (primary, secondary, tertiary)
"RTN","BPSSCRCL",217,0)
 ;15 = Pharmacy Coverage?
"RTN","BPSSCRCL",218,0)
 ;18 = Group Number
"RTN","BPSSCRCL",219,0)
 S BPX=$$INSUR^IBBAPI(BPDFN,BPDOS,,.BPZZ,"1,7,15,18")
"RTN","BPSSCRCL",220,0)
 S BP1="" F  S BP1=$O(BPZZ("IBBAPI","INSUR",BP1)) Q:+BP1=0  D
"RTN","BPSSCRCL",221,0)
 . ;get pharmacy coverage
"RTN","BPSSCRCL",222,0)
 . S BPPHARM=+$G(BPZZ("IBBAPI","INSUR",BP1,15))
"RTN","BPSSCRCL",223,0)
 I BPX<1 Q 0
"RTN","BPSSCRCL",224,0)
 D PROCINS(.BPZZ)
"RTN","BPSSCRCL",225,0)
 ;check pharmacy coverage
"RTN","BPSSCRCL",226,0)
 S BPFOUND=0 ;if found will be set to insurance node in the INSUR^IBBAPI array
"RTN","BPSSCRCL",227,0)
 S BPPHARM=1 ;look only at those with pharmacy coverage
"RTN","BPSSCRCL",228,0)
 S BPCOORD=0
"RTN","BPSSCRCL",229,0)
 F  S BPCOORD=+$O(BPZZ("RES",BPPHARM,BPCOORD)) Q:BPCOORD=0!(BPFOUND'=0)  D
"RTN","BPSSCRCL",230,0)
 . S BPINS=+$O(BPZZ("RES",BPPHARM,BPCOORD,0))
"RTN","BPSSCRCL",231,0)
 . I BPINS>0 I $P($G(BPZZ("IBBAPI","INSUR",BPINS,1)),U,2)'=BPINSNAM S BPFOUND=BPINS
"RTN","BPSSCRCL",232,0)
 I BPFOUND=0 Q 0
"RTN","BPSSCRCL",233,0)
 Q 1_U_$P($G(BPZZ("IBBAPI","INSUR",BPFOUND,1)),U,2)_U_$P($G(BPZZ("IBBAPI","INSUR",BPFOUND,18)),U)_U_BPDOS
"RTN","BPSSCRCL",234,0)
 ;
"RTN","BPSSCRCL",235,0)
 ;process insurances
"RTN","BPSSCRCL",236,0)
 ;input: local array returned by INSUR^IBBAPI
"RTN","BPSSCRCL",237,0)
 ;output: BPZZ("RES",pharmacy coverage,coordination,insurance element # in BPZZ array)
"RTN","BPSSCRCL",238,0)
PROCINS(BPZZ) ;
"RTN","BPSSCRCL",239,0)
 N BP1,BP2,BP0,BPPHONE,BPPHARM,BPCOORD
"RTN","BPSSCRCL",240,0)
 S BP1="" F  S BP1=$O(BPZZ("IBBAPI","INSUR",BP1)) Q:+BP1=0  D
"RTN","BPSSCRCL",241,0)
 . ;get pharmacy coverage
"RTN","BPSSCRCL",242,0)
 . S BPPHARM=+$G(BPZZ("IBBAPI","INSUR",BP1,15))
"RTN","BPSSCRCL",243,0)
 . ;get coordination of benefits
"RTN","BPSSCRCL",244,0)
 . S BPCOORD=+$G(BPZZ("IBBAPI","INSUR",BP1,7))
"RTN","BPSSCRCL",245,0)
 . ;create ^TMP to sort results by pharmacy coverage and coordination of benefits
"RTN","BPSSCRCL",246,0)
 . S BPZZ("RES",BPPHARM,BPCOORD,BP1)=""
"RTN","BPSSCRCL",247,0)
 Q
"RTN","BPSSCRCU")
0^79^B9528540
"RTN","BPSSCRCU",1,0)
BPSSCRCU ;BHAM ISC/SS - ECME SCREEN CONTINUOUS UPDATE AND CHANGE VIEW ;05-APR-05
"RTN","BPSSCRCU",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5,7**;JUN 2004;Build 46
"RTN","BPSSCRCU",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSSCRCU",4,0)
 Q
"RTN","BPSSCRCU",5,0)
 ;
"RTN","BPSSCRCU",6,0)
CU ;
"RTN","BPSSCRCU",7,0)
 N BPKEY,BPTIME,X,Y
"RTN","BPSSCRCU",8,0)
 S BPTIME=15 ;update every 15 seconds
"RTN","BPSSCRCU",9,0)
 D RE^VALM4
"RTN","BPSSCRCU",10,0)
 W "Press ""Q"" to quit."
"RTN","BPSSCRCU",11,0)
 F  D  S BPKEY=$$READ^XGF(1,BPTIME) Q:(BPKEY="Q")!(BPKEY="q")
"RTN","BPSSCRCU",12,0)
 . D UD^BPSSCRUD
"RTN","BPSSCRCU",13,0)
 . D RE^VALM4
"RTN","BPSSCRCU",14,0)
 . N %
"RTN","BPSSCRCU",15,0)
 . D NOW^%DTC S Y=% X ^DD("DD")
"RTN","BPSSCRCU",16,0)
 . W "The screen has been updated on "_Y_". Press ""Q"" to quit."
"RTN","BPSSCRCU",17,0)
 Q
"RTN","BPSSCRCU",18,0)
 ;
"RTN","BPSSCRCU",19,0)
 ; Select Insurance using IB API - IA 4721
"RTN","BPSSCRCU",20,0)
 ; Input:  BPARR passed by ref to store user selection
"RTN","BPSSCRCU",21,0)
 ;         BPDUZ - User DUZ
"RTN","BPSSCRCU",22,0)
 ; Output: RETV = -1 if timeout or user enters "^"
"RTN","BPSSCRCU",23,0)
 ;         BPARR(1.11)="I" for individual insurance or "A" for all
"RTN","BPSSCRCU",24,0)
 ;         BPARR("INS")=semi-colon list of IENs from file 36 if individual insurances selected
"RTN","BPSSCRCU",25,0)
 ; Example output: BPARR(1.11)="I" BPARR("INS")=";7;499;200;"
"RTN","BPSSCRCU",26,0)
INSURSEL(BPARR,BPDUZ) ;
"RTN","BPSSCRCU",27,0)
 N RETV,BPQ,BPINP,BPINSARR,Y,BPCNT
"RTN","BPSSCRCU",28,0)
 S (BPARR(1.11),BPARR(2.04),BPARR("INS"))=""
"RTN","BPSSCRCU",29,0)
 S (BPINS,BPCNT)=0
"RTN","BPSSCRCU",30,0)
 S RETV=$$EDITFLD^BPSSCRCV(1.11,+BPDUZ,"S^I:SPECIFIC INSURANCE(S);A:ALL","Select Certain (I)NSURANCE or (A)LL)","ALL",.BPARR)
"RTN","BPSSCRCU",31,0)
 ; Quit if timeout or ^ entered
"RTN","BPSSCRCU",32,0)
 Q:RETV<0 +RETV
"RTN","BPSSCRCU",33,0)
 ; Quit if ALL selected
"RTN","BPSSCRCU",34,0)
 Q:$P(RETV,U,2)="A" +RETV
"RTN","BPSSCRCU",35,0)
 ; Get selected insurances from parameters and display them
"RTN","BPSSCRCU",36,0)
 I $$GETINS(BPDUZ,.BPINSARR) D DISPINS(.BPINSARR)
"RTN","BPSSCRCU",37,0)
 ; Select specific Insurances to add to BPARR("INS") array
"RTN","BPSSCRCU",38,0)
 S BPQ=0 F  D  Q:BPQ'=0
"RTN","BPSSCRCU",39,0)
 . S BPINP=$$SELINSUR^IBNCPDPI("Select INSURANCE","")
"RTN","BPSSCRCU",40,0)
 . S:+BPINP=-1 BPQ=-1 I BPQ'=0 Q
"RTN","BPSSCRCU",41,0)
 . ;
"RTN","BPSSCRCU",42,0)
 . ; Handle deletes
"RTN","BPSSCRCU",43,0)
 . I $D(BPINSARR(+BPINP)) D  Q
"RTN","BPSSCRCU",44,0)
 . . W !
"RTN","BPSSCRCU",45,0)
 . . S Y=$$PROMPT^BPSSCRCV("S^Y:YES;N:NO","Delete "_$P(BPINP,U,2)_" from your list?","NO")
"RTN","BPSSCRCU",46,0)
 . . I Y="Y" K BPINSARR(+BPINP),BPINSARR("B",$P(BPINP,U,2),+BPINP)
"RTN","BPSSCRCU",47,0)
 . . ; Display a list of selected Insurance Companies
"RTN","BPSSCRCU",48,0)
 . . D DISPINS(.BPINSARR)
"RTN","BPSSCRCU",49,0)
 . ; Save selection in Insurance Company array
"RTN","BPSSCRCU",50,0)
 . S BPINSARR(+BPINP)=BPINP,BPINSARR("B",$P(BPINP,U,2),+BPINP)=""
"RTN","BPSSCRCU",51,0)
 . ; Display a list of selected Insurance Companies
"RTN","BPSSCRCU",52,0)
 . D DISPINS(.BPINSARR)
"RTN","BPSSCRCU",53,0)
 ; Save selected Insurances in BPARR("INS") to be saved in instance 1.14 when filed.
"RTN","BPSSCRCU",54,0)
 S BPARR("INS")=""
"RTN","BPSSCRCU",55,0)
 F BPCNT=1:1 S BPINS=$O(BPINSARR(BPINS)) Q:+BPINS=0  D
"RTN","BPSSCRCU",56,0)
 . S BPARR("INS")=$G(BPARR("INS"))_";"_BPINS
"RTN","BPSSCRCU",57,0)
 S (BPARR("INS"),BPARR(2.04))=$G(BPARR("INS"))_";"
"RTN","BPSSCRCU",58,0)
 Q +RETV
"RTN","BPSSCRCU",59,0)
 ;
"RTN","BPSSCRCU",60,0)
 ;Reads insurance selection from the USER PROFILE file
"RTN","BPSSCRCU",61,0)
 ;Input: BPDUZ7 - DUZ
"RTN","BPSSCRCU",62,0)
 ;       BPINSUR by ref - array to return insurances saved in 2.04 Parameter : BPINSUR(IEN of file 36)
"RTN","BPSSCRCU",63,0)
 ;Return value:
"RTN","BPSSCRCU",64,0)
 ; 0 nothing saved
"RTN","BPSSCRCU",65,0)
 ; n number of IENs of #36 selected by the user and stored in BPINSUR
"RTN","BPSSCRCU",66,0)
 ;Returned by reference:
"RTN","BPSSCRCU",67,0)
 ; BPINSUR - array with IENs to file #36
"RTN","BPSSCRCU",68,0)
GETINS(BPDUZ7,BPINSUR) ;
"RTN","BPSSCRCU",69,0)
 N BPINS,BPCNT
"RTN","BPSSCRCU",70,0)
 S BPARRAY("INS")=$$GETPARAM^BPSSCRSL("2.04",BPDUZ7)
"RTN","BPSSCRCU",71,0)
 F BPCNT=1:1:20 S BPINS=$P($G(BPARRAY("INS")),";",BPCNT+1) Q:+BPINS=0  D
"RTN","BPSSCRCU",72,0)
 . S BPINSUR(BPINS)=BPINS,BPINSUR("B",$$INSNM^IBNCPDPI(BPINS),BPINS)=""
"RTN","BPSSCRCU",73,0)
 Q BPCNT-1
"RTN","BPSSCRCU",74,0)
 ;
"RTN","BPSSCRCU",75,0)
 ;Display selected Insurances
"RTN","BPSSCRCU",76,0)
 ;Input: BPINSARR = Array of insurances to display
"RTN","BPSSCRCU",77,0)
 ; BPINSARR("B",INSURANCE COMPANY NAME)
"RTN","BPSSCRCU",78,0)
DISPINS(BPINSARR) ;
"RTN","BPSSCRCU",79,0)
 I $D(BPINSARR)>9 D
"RTN","BPSSCRCU",80,0)
 . N X
"RTN","BPSSCRCU",81,0)
 . W !,?2,"Selected:"
"RTN","BPSSCRCU",82,0)
 . S X="" F  S X=$O(BPINSARR("B",X)) Q:X=""  W ?12,X,!
"RTN","BPSSCRCU",83,0)
 . K X
"RTN","BPSSCRCU",84,0)
 Q
"RTN","BPSSCRCU",85,0)
 ;
"RTN","BPSSCRCU",86,0)
 ;Check if PLAN ID for selected BP59 matches selected insurances
"RTN","BPSSCRCU",87,0)
 ;Input: BPPLAN = Insurance company IEN from PLAN ID field in BPS TRANSACTION file
"RTN","BPSSCRCU",88,0)
 ;       BPINS = Semi-colon separated list of insurances selected by the user.
"RTN","BPSSCRCU",89,0)
 ;               See INSURSEL
"RTN","BPSSCRCU",90,0)
 ;Output: 1 = Yes a match was found
"RTN","BPSSCRCU",91,0)
 ;        0 = No match found
"RTN","BPSSCRCU",92,0)
CHKINS(BPPLAN,BPINS) ;
"RTN","BPSSCRCU",93,0)
 N BPIN,BPRETV
"RTN","BPSSCRCU",94,0)
 S BPRETV=0
"RTN","BPSSCRCU",95,0)
 F I=2:1 S BPIN=$P($G(BPINS),";",I) Q:BPIN=""  D  Q:BPRETV
"RTN","BPSSCRCU",96,0)
 . S BPRETV=$S(BPIN=BPPLAN:1,1:0)
"RTN","BPSSCRCU",97,0)
 Q BPRETV
"RTN","BPSSCRCU",98,0)
 ;
"RTN","BPSSCRCV")
0^81^B45399490
"RTN","BPSSCRCV",1,0)
BPSSCRCV ;BHAM ISC/SS - ECME SCREEN CHANGE VIEW ;05-APR-05
"RTN","BPSSCRCV",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5,7**;JUN 2004;Build 46
"RTN","BPSSCRCV",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSSCRCV",4,0)
 ;USER SCREEN
"RTN","BPSSCRCV",5,0)
 Q
"RTN","BPSSCRCV",6,0)
 ;****
"RTN","BPSSCRCV",7,0)
 ;This software is using PARAMETER TOOLS (see XT*7.3*26) to store user's settings:
"RTN","BPSSCRCV",8,0)
 ;PARAMETER DEFINITION NAME="BPS USRSCR" (file #8989.51, IA# 2263)
"RTN","BPSSCRCV",9,0)
 ;ENTITY is "USR" , i.e. IEN in ^VA(200  -- see definition for "BPS USRSCR"
"RTN","BPSSCRCV",10,0)
 ;INSTANCEs are as follows:
"RTN","BPSSCRCV",11,0)
 ;1.01 ONE/ALL USERS --'U' ONE USER, 'A' ALL; Display claims for ONE or ALL users 
"RTN","BPSSCRCV",12,0)
 ;1.02 ONE/ALL PATIENTS --'P' FOR ONE PATIENT; 'A' FOR ALL; Display claims for ONE/ALL PATIENTS 
"RTN","BPSSCRCV",13,0)
 ;1.03 ONE/ALL RX --'R' FOR ONE RX; 'A' FOR ALL; Display claims for ONE or ALL RX 
"RTN","BPSSCRCV",14,0)
 ;1.04 HOURS/DAYS -- 'D' FOR DAYS; 'H' FOR HOURS; Use HOURS or DAYS to specify timeframe 
"RTN","BPSSCRCV",15,0)
 ;1.05 TIMEFRAME -- NUMBER Depends on the value of the field "USR SCR HOURS/DAYS" this field will
"RTN","BPSSCRCV",16,0)
 ;store the default number of HOURS from NOW or DAYS from TODAY to select claims to display 
"RTN","BPSSCRCV",17,0)
 ;1.06 REJECTED/PAYABLE --'R' FOR REJECTS; 'P' FOR PAYABLES 'A' FOR ALL; Display Rejects or Payables or ALL claims 
"RTN","BPSSCRCV",18,0)
 ;1.07 RELEASED/NOT RELEASED --'R' FOR RELEASED; 'N' FOR NON-RELEASED; 'A' FOR ALL; Display Released Rxs or Non-Released Rxs or ALL 
"RTN","BPSSCRCV",19,0)
 ;1.08 CMOP/MAIL/WINDOW --'C' FOR CMOP; 'M' FOR MAIL;'W' FOR WINDOW;'A' FOR ALL; Display CMOP or Mail or Window or ALL Rxs 
"RTN","BPSSCRCV",20,0)
 ;1.09 REALTIME/BACKBILL --'R' FOR REALTIME; 'B' FOR BACKBILLS; 'A' FOR ALL; Display RealTime Fills or Backbills or ALL 
"RTN","BPSSCRCV",21,0)
 ;1.1 REJECT CODE/ALL --'R' FOR REJECT CODE; 'A' FOR ALL; Display Specific Reject Code or ALL Reject
"RTN","BPSSCRCV",22,0)
 ;Codes 0 means ALL Reject Codes otherwise - Reject Code value 
"RTN","BPSSCRCV",23,0)
 ;1.11 SPECIFIC/ALL INSURANCES --'I' FOR SPECIFIC INSURANCE(S);'A' FOR ALL; Display Specific Insurance Company(s) or All null - ALL otherwise - pointer to INSURANCE COMPANY file #36 
"RTN","BPSSCRCV",24,0)
 ;1.12 SORT LIST --'T' FOR TRANSACTION DATE;'D' FOR DIVISION; 'I' FOR INSURANCE; 'C' FOR REJECT CODE; 
"RTN","BPSSCRCV",25,0)
 ;'P' FOR PATIENT NAME -- 'N' FOR DRUG NAME; 'B' FOR BILL TYPE (BB/RT); 'L' FOR FILL LOCATION;
"RTN","BPSSCRCV",26,0)
 ;'R' FOR RELEASED/NON-RELEASED -- 'A' FOR ACTIVE/DISCONTINUED; the field used to sort claims in the list 
"RTN","BPSSCRCV",27,0)
 ;1.13 ALL ECME PHARMACY DIVISIONS --'D' FOR DIVISION; 'A' FOR ALL; 
"RTN","BPSSCRCV",28,0)
 ;1.14 SELECTED INSURANCE -- Single, or multiple, insurance(s) to select claims for the User Screen, to store INSURANCE COMPANY pointer (#36) 
"RTN","BPSSCRCV",29,0)
 ;1.15 SELECTED REJECTED CODE --POINTER TO BPS NCPDP REJECT CODES FILE (#9002313.93) Reject code selected by the user to filter claims.
"RTN","BPSSCRCV",30,0)
 ;1.16 SELECTED USER -- POINTER TO NEW PERSON FILE (#200) Selected user for the user screen 
"RTN","BPSSCRCV",31,0)
 ;1.17 SELECTED PATIENT -- POINTER TO PATIENT FILE (#2) Selected patient for the User Screen 
"RTN","BPSSCRCV",32,0)
 ;1.18 SELECTED RX -- POINTER TO PRESCRIPTION FILE (#52) Selected RX 
"RTN","BPSSCRCV",33,0)
 ;2    ECME PHARMACY DIVISION -- the list of POINTERs TO BPS PHARMACIES FILE (#9002313.56) separated by ";"
"RTN","BPSSCRCV",34,0)
 ;should start and end with ";", example: ";4;5;"
"RTN","BPSSCRCV",35,0)
 ;2.01 ELIGIBILITY TYPE --'V' FOR VETERAN;'T' FOR TRICARE;'A' FOR ALL; Display claims for specific Eligibility Type or ALL (BNT BPS*1.0*7)
"RTN","BPSSCRCV",36,0)
 ;2.02 OPEN/CLOSED/ALL --'O' OPEN CLAIMS;'C' CLOSED CLAIMS;'A' FOR ALL; Display Open, Closed, or ALL claims (BNT BPS*1.0*7)
"RTN","BPSSCRCV",37,0)
 ;2.03 SUBMISSION TYPE --'B' BILLING REQUESTS;'R' REVERSALS;'A' FOR ALL; Display specific submission type claims or ALL (BNT BPS*1.0*7)
"RTN","BPSSCRCV",38,0)
 ;2.04 INSURANCES -- List of POINTERs to the INSURANCE COMPANY FILE (#36) separated by ";"
"RTN","BPSSCRCV",39,0)
 ;should start and end with ";", example: ";4;5;"
"RTN","BPSSCRCV",40,0)
 ;NOTE: use D ^XPAREDIT to add/edit values
"RTN","BPSSCRCV",41,0)
 ;
"RTN","BPSSCRCV",42,0)
 ;*****
"RTN","BPSSCRCV",43,0)
 ;
"RTN","BPSSCRCV",44,0)
CV ;
"RTN","BPSSCRCV",45,0)
 D FULL^VALM1
"RTN","BPSSCRCV",46,0)
 W @IOF
"RTN","BPSSCRCV",47,0)
 K BPARR
"RTN","BPSSCRCV",48,0)
 I +$G(DUZ)=0 D ERRMSG^BPSSCRCV("Unknown User") Q
"RTN","BPSSCRCV",49,0)
 N BPDUZ7
"RTN","BPSSCRCV",50,0)
 S BPDUZ7=+DUZ
"RTN","BPSSCRCV",51,0)
 ;always get current profile from the file
"RTN","BPSSCRCV",52,0)
 D READPROF^BPSSCRSL(.BPARR,BPDUZ7)
"RTN","BPSSCRCV",53,0)
 D SAVEVIEW^BPSSCR01(.BPARR)
"RTN","BPSSCRCV",54,0)
 ;edit current profile
"RTN","BPSSCRCV",55,0)
 D EDITPROF(.BPARR,.BPDUZ7)
"RTN","BPSSCRCV",56,0)
 ;ask user if need to save everything in USR PROFILE file 
"RTN","BPSSCRCV",57,0)
 ;(except SORT LIST field)
"RTN","BPSSCRCV",58,0)
 N BPSRT S BPSRT=BPARR(1.12)
"RTN","BPSSCRCV",59,0)
 K BPARR(1.12)
"RTN","BPSSCRCV",60,0)
 D ENDEDIT^BPSSCRSL(.BPARR,+BPDUZ7)
"RTN","BPSSCRCV",61,0)
 S BPARR(1.12)=BPSRT
"RTN","BPSSCRCV",62,0)
 D SAVEVIEW^BPSSCR01(.BPARR)
"RTN","BPSSCRCV",63,0)
 S VALMBG=1
"RTN","BPSSCRCV",64,0)
 D REDRAW^BPSSCRUD("Updating screen...")
"RTN","BPSSCRCV",65,0)
 Q
"RTN","BPSSCRCV",66,0)
 ;edit user profile for CHANGE VIEW
"RTN","BPSSCRCV",67,0)
EDITPROF(BPARR,BPDUZ7) ;
"RTN","BPSSCRCV",68,0)
 I +$G(DUZ)=0 D ERRMSG("Unknown User") Q
"RTN","BPSSCRCV",69,0)
 N BP1,BPTF,BPQ,BPINP
"RTN","BPSSCRCV",70,0)
 N BPRET
"RTN","BPSSCRCV",71,0)
 N DIR,DR,DIE,DA
"RTN","BPSSCRCV",72,0)
 ;get ONE/ALL USERS?
"RTN","BPSSCRCV",73,0)
 ;EDITFLD(FILENO,FLDNO,RECIEN,CODESET,PRMTMSG,DFLTCODE)  ;
"RTN","BPSSCRCV",74,0)
 S BPRET=$$DS^BPSSCRDS(.BPARR,+BPDUZ7) ;get divisions
"RTN","BPSSCRCV",75,0)
 Q:BPRET=-2  ;quit due to timeout or ^
"RTN","BPSSCRCV",76,0)
 Q:$$EDITFLD(2.01,+BPDUZ7,"S^V:VETERAN;T:TRICARE;A:ALL","Select Certain Eligibility Type or (A)ll","V",.BPARR)=-1
"RTN","BPSSCRCV",77,0)
 S BPQ=0 F  D  Q:BPQ'=0
"RTN","BPSSCRCV",78,0)
 . S BPINP=$$EDITFLD(1.01,+BPDUZ7,"S^U:ONE USER;A:ALL","Display One ECME (U)ser or (A)LL","ALL",.BPARR)
"RTN","BPSSCRCV",79,0)
 . S:BPINP=-1 BPQ=-1 S:$P(BPINP,U,2)="A" BPQ=1 I BPQ'=0 Q
"RTN","BPSSCRCV",80,0)
 . S BPINP=$$EDITFLD(1.16,+BPDUZ7,"P^VA(200,","Select User","",.BPARR)
"RTN","BPSSCRCV",81,0)
 . S:BPINP=-1 BPQ=-1 S:$P(BPINP,U,2)'="" BPQ=1 I BPQ'=0 Q
"RTN","BPSSCRCV",82,0)
 Q:BPQ=-1  ;quit due to timeout or ^
"RTN","BPSSCRCV",83,0)
 S BPQ=0 F  D  Q:BPQ'=0
"RTN","BPSSCRCV",84,0)
 . S BPINP=$$EDITFLD(1.02,+BPDUZ7,"S^P:ONE PATIENT;A:ALL","Display One (P)atient or (A)LL","ALL",.BPARR)
"RTN","BPSSCRCV",85,0)
 . S:BPINP=-1 BPQ=-1 S:$P(BPINP,U,2)="A" BPQ=1 I BPQ'=0 Q
"RTN","BPSSCRCV",86,0)
 . S BPINP=$$EDITFLD(1.17,+BPDUZ7,"P^DPT(","Select Patient","",.BPARR)
"RTN","BPSSCRCV",87,0)
 . S:BPINP=-1 BPQ=-1 S:$P(BPINP,U,2)'="" BPQ=1 I BPQ'=0 Q
"RTN","BPSSCRCV",88,0)
 Q:BPQ=-1  ;quit due to timeout or ^
"RTN","BPSSCRCV",89,0)
 S BPQ=0 F  D  Q:BPQ'=0
"RTN","BPSSCRCV",90,0)
 . S BPINP=$$EDITFLD(1.03,+BPDUZ7,"S^R:ONE RX;A:ALL","Display One (R)x or (A)LL","ALL",.BPARR)
"RTN","BPSSCRCV",91,0)
 . S:BPINP=-1 BPQ=-1 S:$P(BPINP,U,2)="A" BPQ=1 I BPQ'=0 Q
"RTN","BPSSCRCV",92,0)
 . S BPINP=$$EDITRX^BPSSCRPR(1.18,+BPDUZ7,"Select RX","",.BPARR)
"RTN","BPSSCRCV",93,0)
 . S:BPINP=-1 BPQ=-1 S:$P(BPINP,U,2)'="" BPQ=1 I BPQ'=0 Q
"RTN","BPSSCRCV",94,0)
 Q:BPQ=-1  ;quit due to timeout or ^
"RTN","BPSSCRCV",95,0)
 S BPINP=$$EDITFLD(1.04,+BPDUZ7,"S^D:DAYS;H:HOURS","Activity Timeframe (H)ours or (D)ays","DAYS",.BPARR)
"RTN","BPSSCRCV",96,0)
 I BPINP=-1 Q  ;quit due to timeout or ^
"RTN","BPSSCRCV",97,0)
 S BPTF=$P(BPINP,U,2)
"RTN","BPSSCRCV",98,0)
 Q:$$EDITFLD(1.05,+BPDUZ7,"N^1:999:0","Activity Timeframe Value",$S(BPTF="H":24,1:7),.BPARR)=-1
"RTN","BPSSCRCV",99,0)
 Q:$$EDITFLD(2.02,+BPDUZ7,"S^O:OPEN CLAIMS;C:CLOSED CLAIMS;A:ALL","Select Open/Closed or All Claims","O",.BPARR)=-1
"RTN","BPSSCRCV",100,0)
 Q:$$EDITFLD(2.03,+BPDUZ7,"S^B:BILLING REQUESTS;R:REVERSALS;A:ALL","Select Submission Type","A",.BPARR)=-1
"RTN","BPSSCRCV",101,0)
 Q:$$EDITFLD(1.06,+BPDUZ7,"S^R:REJECTS;P:PAYABLES;A:ALL","Display (R)ejects or (P)ayables or (A)LL","REJECTS",.BPARR)=-1
"RTN","BPSSCRCV",102,0)
 Q:$$EDITFLD(1.07,+BPDUZ7,"S^R:RELEASED;N:NON-RELEASED;A:ALL","Display (R)eleased Rxs or (N)on-Released Rxs or (A)LL","RELEASED",.BPARR)=-1
"RTN","BPSSCRCV",103,0)
 Q:$$EDITFLD(1.08,+BPDUZ7,"S^C:CMOP;M:MAIL;W:WINDOW;A:ALL","Display (C)MOP or (M)ail or (W)indow or (A)LL","ALL",.BPARR)=-1
"RTN","BPSSCRCV",104,0)
 Q:$$EDITFLD(1.09,+BPDUZ7,"S^R:REALTIME;B:BACKBILLS;A:ALL","Display (R)ealTime Fills or (B)ackbills or (A)LL","ALL",.BPARR)=-1
"RTN","BPSSCRCV",105,0)
 S BPQ=0 F  D  Q:BPQ'=0
"RTN","BPSSCRCV",106,0)
 . S BPINP=$$EDITFLD(1.1,+BPDUZ7,"S^R:REJECT CODE;A:ALL","Display Specific (R)eject Code or (A)LL","ALL",.BPARR)
"RTN","BPSSCRCV",107,0)
 . S:BPINP=-1 BPQ=-1 S:$P(BPINP,U,2)="A" BPQ=1 I BPQ'=0 Q
"RTN","BPSSCRCV",108,0)
 . S BPINP=$$EDITFLD(1.15,+BPDUZ7,"P^BPSF(9002313.93,","Select Reject Code","",.BPARR)
"RTN","BPSSCRCV",109,0)
 . S:BPINP=-1 BPQ=-1 S:$P(BPINP,U,2)'="" BPQ=1 I BPQ'=0 Q
"RTN","BPSSCRCV",110,0)
 Q:BPQ=-1  ;quit due to timeout or ^
"RTN","BPSSCRCV",111,0)
 Q:$$INSURSEL^BPSSCRCU(.BPARR,+BPDUZ7)=-1
"RTN","BPSSCRCV",112,0)
 Q
"RTN","BPSSCRCV",113,0)
 ;
"RTN","BPSSCRCV",114,0)
ERRMSG(BPMSG) ;
"RTN","BPSSCRCV",115,0)
 W !,"***",BPMSG,"***",!
"RTN","BPSSCRCV",116,0)
 D PAUSE^VALM1
"RTN","BPSSCRCV",117,0)
 Q
"RTN","BPSSCRCV",118,0)
 ;/**
"RTN","BPSSCRCV",119,0)
 ;FLDNO - PARAMETERS INSTANCE
"RTN","BPSSCRCV",120,0)
 ;RECIEN - User DUZ
"RTN","BPSSCRCV",121,0)
 ;DIR0 - like DIR(0) node for ^DIR - i.e. field type, etc
"RTN","BPSSCRCV",122,0)
 ;PRMTMSG - user prompt
"RTN","BPSSCRCV",123,0)
 ;DFLTVAL - pass the default value for the case if there is no value in database
"RTN","BPSSCRCV",124,0)
 ;BPARRAY - array to store and change values in profile
"RTN","BPSSCRCV",125,0)
 ;returns:
"RTN","BPSSCRCV",126,0)
 ;as return value:
"RTN","BPSSCRCV",127,0)
 ; "1^value" - if selected
"RTN","BPSSCRCV",128,0)
 ; "-1" if timeout or uparrow
"RTN","BPSSCRCV",129,0)
 ;via BPARRAY
"RTN","BPSSCRCV",130,0)
 ; BPARRAY(filedno)=value
"RTN","BPSSCRCV",131,0)
EDITFLD(FLDNO,RECIEN,DIR0,PRMTMSG,DFLTVAL,BPARRAY) ;*/
"RTN","BPSSCRCV",132,0)
 N DIR,RETV,RETARR
"RTN","BPSSCRCV",133,0)
 N RECIENS,FDA,LCK,ERRARR
"RTN","BPSSCRCV",134,0)
 S RETV=$$GETPARAM^BPSSCRSL(FLDNO,RECIEN)
"RTN","BPSSCRCV",135,0)
 I FLDNO=1.17 S RETV=$P($G(^DPT(+RETV,0)),U)
"RTN","BPSSCRCV",136,0)
 ;if data then use it, otherwise use data from parameter
"RTN","BPSSCRCV",137,0)
 I $L($G(RETV))>0 S DFLTVAL=RETV E  S DFLTVAL=$G(DFLTVAL)
"RTN","BPSSCRCV",138,0)
 ;prompt the user
"RTN","BPSSCRCV",139,0)
 S RETV=$$PROMPT(DIR0,PRMTMSG,DFLTVAL)
"RTN","BPSSCRCV",140,0)
 Q:RETV<0 -1
"RTN","BPSSCRCV",141,0)
 ;save it in the database
"RTN","BPSSCRCV",142,0)
 S BPARRAY(FLDNO)=RETV
"RTN","BPSSCRCV",143,0)
 Q "1^"_RETV
"RTN","BPSSCRCV",144,0)
 ;
"RTN","BPSSCRCV",145,0)
 ;
"RTN","BPSSCRCV",146,0)
FILEIT(FILENO,FLDNO,RECIEN,NEWVAL) ;
"RTN","BPSSCRCV",147,0)
 N RECIENS
"RTN","BPSSCRCV",148,0)
 S RECIENS=RECIEN_","
"RTN","BPSSCRCV",149,0)
 S FDA(FILENO,RECIENS,FLDNO)=NEWVAL
"RTN","BPSSCRCV",150,0)
 L +^BPS(FILENO,RECIEN,1):10 S LCK=$T I 'LCK Q "0^"_NEWVAL_"^LOCKED"  ;quit
"RTN","BPSSCRCV",151,0)
 D FILE^DIE("","FDA","ERRARR")
"RTN","BPSSCRCV",152,0)
 I LCK L -^BPS(FILENO,RECIEN,1)
"RTN","BPSSCRCV",153,0)
 I $D(ERRARR) Q "0^"_NEWVAL_"^"_ERRARR("DIERR",1,"TEXT",1)
"RTN","BPSSCRCV",154,0)
 Q "1^"_NEWVAL
"RTN","BPSSCRCV",155,0)
 ;
"RTN","BPSSCRCV",156,0)
 ;prompts for selection
"RTN","BPSSCRCV",157,0)
 ;returns selection
"RTN","BPSSCRCV",158,0)
 ;OR -1 when timeout and uparrow
"RTN","BPSSCRCV",159,0)
PROMPT(ZERONODE,PRMTMSG,DFLTVAL) ;
"RTN","BPSSCRCV",160,0)
 N Y,DUOUT,DTOUT,BPQUIT,DIROUT
"RTN","BPSSCRCV",161,0)
 S BPQUIT=0
"RTN","BPSSCRCV",162,0)
 I $E(ZERONODE,1,1)="P" D
"RTN","BPSSCRCV",163,0)
 . N DIC
"RTN","BPSSCRCV",164,0)
 . S DIC="^"_$P(ZERONODE,U,2)
"RTN","BPSSCRCV",165,0)
 . S DIC(0)="AEMNQ"
"RTN","BPSSCRCV",166,0)
 . S:$L($G(DFLTVAL))>0 DIC("B")=DFLTVAL
"RTN","BPSSCRCV",167,0)
 . S DIC("A")=PRMTMSG_": "
"RTN","BPSSCRCV",168,0)
 . D ^DIC
"RTN","BPSSCRCV",169,0)
 . I (Y=-1)!$D(DUOUT)!$D(DTOUT) S BPQUIT=1
"RTN","BPSSCRCV",170,0)
 E  D
"RTN","BPSSCRCV",171,0)
 . N DIR
"RTN","BPSSCRCV",172,0)
 . S DIR(0)=ZERONODE
"RTN","BPSSCRCV",173,0)
 . S DIR("A")=PRMTMSG
"RTN","BPSSCRCV",174,0)
 . S:$L($G(DFLTVAL))>0 DIR("B")=DFLTVAL
"RTN","BPSSCRCV",175,0)
 . D ^DIR
"RTN","BPSSCRCV",176,0)
 . I (Y=-1)!$D(DIROUT)!$D(DUOUT)!$D(DTOUT) S BPQUIT=1
"RTN","BPSSCRCV",177,0)
 I BPQUIT=1 Q -1
"RTN","BPSSCRCV",178,0)
 Q $P(Y,U)
"RTN","BPSSCRCV",179,0)
 ;
"RTN","BPSSCRCV",180,0)
GETFLD(FILENO,FLDNO,RECIEN) ;
"RTN","BPSSCRCV",181,0)
 N RETV,RETARR
"RTN","BPSSCRCV",182,0)
 N RECIENS
"RTN","BPSSCRCV",183,0)
 S RECIENS=RECIEN_","
"RTN","BPSSCRCV",184,0)
 ; first try to get the value from file
"RTN","BPSSCRCV",185,0)
 D GETS^DIQ(FILENO,RECIENS,FLDNO,"E","RETARR")
"RTN","BPSSCRCV",186,0)
 S RETV=$G(RETARR(FILENO,RECIENS,FLDNO,"E"))
"RTN","BPSSCRCV",187,0)
 Q $G(RETV)
"RTN","BPSSCRCV",188,0)
 ;
"RTN","BPSSCRCV",189,0)
 ;save all profile array to file
"RTN","BPSSCRCV",190,0)
 ;BPARRAY - arrays with pointers to 9002313.56
"RTN","BPSSCRCV",191,0)
 ;BPDUZ7 - DUZ
"RTN","BPSSCRCV",192,0)
FILEALL(BPARRAY,BPDUZ7) ;
"RTN","BPSSCRCV",193,0)
 N BPFLD,BP2
"RTN","BPSSCRCV",194,0)
 S BPFLD=0
"RTN","BPSSCRCV",195,0)
 F  S BPFLD=+$O(BPARRAY(BPFLD)) Q:+BPFLD=0  D
"RTN","BPSSCRCV",196,0)
 . I $$SAVEPAR^BPSSCRSL(BPFLD,+BPDUZ7,$G(BPARRAY(BPFLD)))
"RTN","BPSSCRCV",197,0)
 I $$SAVEPAR^BPSSCRSL(2,BPDUZ7,$G(BPARRAY("DIVS")))
"RTN","BPSSCRCV",198,0)
 I $$SAVEPAR^BPSSCRSL(2.04,BPDUZ7,$G(BPARRAY("INS")))
"RTN","BPSSCRCV",199,0)
 Q
"RTN","BPSSCRLG")
0^83^B95335082
"RTN","BPSSCRLG",1,0)
BPSSCRLG ;BHAM ISC/SS - ECME LOGINFO ;05-APR-05
"RTN","BPSSCRLG",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5,7**;JUN 2004;Build 46
"RTN","BPSSCRLG",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSSCRLG",4,0)
 ;
"RTN","BPSSCRLG",5,0)
 Q
"RTN","BPSSCRLG",6,0)
 ;
"RTN","BPSSCRLG",7,0)
EN ; -- main entry point for BPS LSTMN LOG
"RTN","BPSSCRLG",8,0)
 D EN^VALM("BPS LSTMN LOG")
"RTN","BPSSCRLG",9,0)
 Q
"RTN","BPSSCRLG",10,0)
 ;
"RTN","BPSSCRLG",11,0)
HDR ; -- header code
"RTN","BPSSCRLG",12,0)
 S VALMHDR(1)="Claim Log information"
"RTN","BPSSCRLG",13,0)
 S VALMHDR(2)=""
"RTN","BPSSCRLG",14,0)
 Q
"RTN","BPSSCRLG",15,0)
 ;
"RTN","BPSSCRLG",16,0)
INIT ; -- init variables and list array
"RTN","BPSSCRLG",17,0)
 N BPSELCLM,LINE
"RTN","BPSSCRLG",18,0)
 S BPSELCLM=$G(@VALMAR@("SELLN"))
"RTN","BPSSCRLG",19,0)
 ;  piece 2: patient ien #2
"RTN","BPSSCRLG",20,0)
 ;  piece 3: insurance ien #36
"RTN","BPSSCRLG",21,0)
 ;  piece 4: ptr to #9002313.59
"RTN","BPSSCRLG",22,0)
 S LINE=1
"RTN","BPSSCRLG",23,0)
 S VALMCNT=$$PREPINFO(.LINE,$P(BPSELCLM,U,2),$P(BPSELCLM,U,3),$P(BPSELCLM,U,4))
"RTN","BPSSCRLG",24,0)
 S:VALMCNT>1 VALMCNT=VALMCNT-1
"RTN","BPSSCRLG",25,0)
 Q
"RTN","BPSSCRLG",26,0)
 ;
"RTN","BPSSCRLG",27,0)
HELP ; -- help code
"RTN","BPSSCRLG",28,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","BPSSCRLG",29,0)
 K X
"RTN","BPSSCRLG",30,0)
 Q
"RTN","BPSSCRLG",31,0)
 ;
"RTN","BPSSCRLG",32,0)
EXIT ; -- exit code
"RTN","BPSSCRLG",33,0)
 Q
"RTN","BPSSCRLG",34,0)
 ;
"RTN","BPSSCRLG",35,0)
EXPND ; -- expand code
"RTN","BPSSCRLG",36,0)
 Q
"RTN","BPSSCRLG",37,0)
 ;
"RTN","BPSSCRLG",38,0)
 ;
"RTN","BPSSCRLG",39,0)
LOG ;entry point for LOG menu option of the main User Screen
"RTN","BPSSCRLG",40,0)
 N BPRET,BPSEL
"RTN","BPSSCRLG",41,0)
 I '$D(@(VALMAR)) Q
"RTN","BPSSCRLG",42,0)
 D FULL^VALM1
"RTN","BPSSCRLG",43,0)
 W !,"Enter the line number for which you wish to print claim logs."
"RTN","BPSSCRLG",44,0)
 S BPSEL=$$ASKLINE^BPSSCRU4("Select item","C","Please select SINGLE Rx Line.")
"RTN","BPSSCRLG",45,0)
 I BPSEL<1 S VALMBCK="R" Q
"RTN","BPSSCRLG",46,0)
 D SAVESEL(BPSEL,VALMAR)
"RTN","BPSSCRLG",47,0)
 D EN
"RTN","BPSSCRLG",48,0)
 S VALMBCK="R"
"RTN","BPSSCRLG",49,0)
 Q
"RTN","BPSSCRLG",50,0)
 ;
"RTN","BPSSCRLG",51,0)
 ;save selection in order to use inside enclosed ListManager copy
"RTN","BPSSCRLG",52,0)
 ;BPSEL - selected line
"RTN","BPSSCRLG",53,0)
 ;BPVALMR - parent VALMAR 
"RTN","BPSSCRLG",54,0)
SAVESEL(BPSEL,BPVALMR) ;
"RTN","BPSSCRLG",55,0)
 D CLEANIT
"RTN","BPSSCRLG",56,0)
 S ^TMP("BPSLOG",$J,"VALM","SELLN")=BPSEL
"RTN","BPSSCRLG",57,0)
 S ^TMP("BPSLOG",$J,"VALM","PARENT")=BPVALMR
"RTN","BPSSCRLG",58,0)
 M ^TMP("BPSLOG",$J,"VALM","VIEWPARAMS")=@BPVALMR@("VIEWPARAMS")
"RTN","BPSSCRLG",59,0)
 Q
"RTN","BPSSCRLG",60,0)
 ;
"RTN","BPSSCRLG",61,0)
CLEANIT ;
"RTN","BPSSCRLG",62,0)
 K ^TMP("BPSLOG",$J,"VALM")
"RTN","BPSSCRLG",63,0)
 Q
"RTN","BPSSCRLG",64,0)
 ;input:
"RTN","BPSSCRLG",65,0)
 ; BPDFN: patient ien #2
"RTN","BPSSCRLG",66,0)
 ; BP36: insurance ien #36
"RTN","BPSSCRLG",67,0)
 ; BP59: ptr to #9002313.59
"RTN","BPSSCRLG",68,0)
 ; returns number of lines
"RTN","BPSSCRLG",69,0)
PREPINFO(BPLN,BPDFN,BP36,BP59) ;
"RTN","BPSSCRLG",70,0)
 I '$G(BP59) Q 0
"RTN","BPSSCRLG",71,0)
 I '$G(BP36) Q 0
"RTN","BPSSCRLG",72,0)
 I '$G(BPDFN) Q 0
"RTN","BPSSCRLG",73,0)
 N BPSCRLNS S BPSCRLNS=17 ;(see "BPS LSTMN LOG" LM template: Bottom=21, Top = 4, 21-4=17)
"RTN","BPSSCRLG",74,0)
 N BPX,BPRXIEN,BPREF,BP1,BPLSTCLM,BPLSTRSP,BPDAT59,BPUSR,BPSTRT,BPHIST,BPQ
"RTN","BPSSCRLG",75,0)
 N BPDT,BPLN0,BPCNT
"RTN","BPSSCRLG",76,0)
 S BP1=$$RXREF^BPSSCRU2(BP59)
"RTN","BPSSCRLG",77,0)
 S BPRXIEN=$P(BP1,U,1)
"RTN","BPSSCRLG",78,0)
 S BPREF=$P(BP1,U,2)
"RTN","BPSSCRLG",79,0)
 S BPDAT59(0)=$G(^BPST(BP59,0))
"RTN","BPSSCRLG",80,0)
 ;create a history
"RTN","BPSSCRLG",81,0)
 D MKHIST^BPSSCRU5(BP59,.BPHIST)
"RTN","BPSSCRLG",82,0)
 ;
"RTN","BPSSCRLG",83,0)
 S BPLN0=BPLN
"RTN","BPSSCRLG",84,0)
 D SETLINE(.BPLN,"Pharmacy ECME Log")
"RTN","BPSSCRLG",85,0)
 D SETLINE(.BPLN,"")
"RTN","BPSSCRLG",86,0)
 S BPX=$$RJ^BPSSCR02("VA Rx #: ",19)_$$LJ^BPSSCR02($$RXNUM^BPSSCRU2(+BPRXIEN),13)
"RTN","BPSSCRLG",87,0)
 S BPX=BPX_$$RJ^BPSSCR02("Fill #: ",10)_$$LJ^BPSSCR02(BPREF,4)
"RTN","BPSSCRLG",88,0)
 S BPX=BPX_$$RJ^BPSSCR02("ECME Claim Rx #: ",18)_$$LJ^BPSSCR02(BP59,20)
"RTN","BPSSCRLG",89,0)
 D SETLINE(.BPLN,BPX)
"RTN","BPSSCRLG",90,0)
 S BPX=$$RJ^BPSSCR02("Patient Name: ",19)
"RTN","BPSSCRLG",91,0)
 S BPX=BPX_$$LJ^BPSSCR02($$PATNAME^BPSSCRU2(BPDFN)_" "_$$SSN4^BPSSCRU2(BPDFN),30)
"RTN","BPSSCRLG",92,0)
 D SETLINE(.BPLN,BPX)
"RTN","BPSSCRLG",93,0)
 S BPX=$$RJ^BPSSCR02("Last Submitted: ",19)
"RTN","BPSSCRLG",94,0)
 S BPSTRT=$P(BPDAT59(0),U,11) ;@# need to check with analyst if this is a START DATE
"RTN","BPSSCRLG",95,0)
 I BPSTRT]"" S BPX=BPX_$$DATETIME^BPSSCRU5(BPSTRT)
"RTN","BPSSCRLG",96,0)
 D SETLINE(.BPLN,BPX)
"RTN","BPSSCRLG",97,0)
 S BPX=$$RJ^BPSSCR02("Last Submitted By: ",19)
"RTN","BPSSCRLG",98,0)
 S BPUSR=$P(BPDAT59(0),U,10)
"RTN","BPSSCRLG",99,0)
 I BPUSR]"" S BPX=BPX_$$GETUSRNM^BPSSCRU1(BPUSR)
"RTN","BPSSCRLG",100,0)
 D SETLINE(.BPLN,BPX)
"RTN","BPSSCRLG",101,0)
 ;
"RTN","BPSSCRLG",102,0)
 ;find the latest claim
"RTN","BPSSCRLG",103,0)
 S BP1=+$O(BPHIST("C",99999999),-1)
"RTN","BPSSCRLG",104,0)
 I BP1=0 D SETLINE(.BPLN,""),SETLINE(.BPLN,"------ No electronic claims ------") Q BPLN
"RTN","BPSSCRLG",105,0)
 S BP1=+$O(BPHIST("C",BP1,0))
"RTN","BPSSCRLG",106,0)
 S BPX=$$RJ^BPSSCR02("Last VA Claim #: ",19)_$P($G(^BPSC(+BP1,0)),U,1)
"RTN","BPSSCRLG",107,0)
 D SETLINE(.BPLN,BPX)
"RTN","BPSSCRLG",108,0)
 F BPCNT=BPLN:1:BPLN0+BPSCRLNS D SETLINE(.BPLN,"")
"RTN","BPSSCRLG",109,0)
 ;process history
"RTN","BPSSCRLG",110,0)
 N BPTYPE,BPIEN,BPIENRS
"RTN","BPSSCRLG",111,0)
 S BPDT=99999999
"RTN","BPSSCRLG",112,0)
 F  S BPDT=$O(BPHIST("C",BPDT),-1) Q:+BPDT=0  D
"RTN","BPSSCRLG",113,0)
 . S BPIEN=+$O(BPHIST("C",BPDT,0)) Q:BPIEN=""
"RTN","BPSSCRLG",114,0)
 . D DISPCLM(.BPLN,BP59,BPIEN,+BPHIST("C",BPDT,BPIEN),$P(BPHIST("C",BPDT,BPIEN),U,2),BPDT)
"RTN","BPSSCRLG",115,0)
 . S BPIENRS=0
"RTN","BPSSCRLG",116,0)
 . F  S BPIENRS=$O(BPHIST("C",BPDT,BPIEN,"R",BPIENRS)) Q:+BPIENRS=0  D
"RTN","BPSSCRLG",117,0)
 . . D DISPRSP(.BPLN,BP59,BPIENRS,+BPHIST("C",BPDT,BPIEN,"R",BPIENRS),$P(BPHIST("C",BPDT,BPIEN,"R",BPIENRS),U,2),BPDT)
"RTN","BPSSCRLG",118,0)
 Q BPLN
"RTN","BPSSCRLG",119,0)
 ;calls SET^VALM10,
"RTN","BPSSCRLG",120,0)
 ;increments BPLINE
"RTN","BPSSCRLG",121,0)
SETLINE(BPLINE,BPSTR) ;
"RTN","BPSSCRLG",122,0)
 D SET^VALM10(BPLINE,BPSTR)
"RTN","BPSSCRLG",123,0)
 S BPLINE=BPLINE+1
"RTN","BPSSCRLG",124,0)
 Q
"RTN","BPSSCRLG",125,0)
 ;display claim record
"RTN","BPSSCRLG",126,0)
DISPCLM(BPLN,BP59,BPIEN02,BP57,BPSTYPE,BPSDTALT) ;
"RTN","BPSSCRLG",127,0)
 N BPSCRLNS S BPSCRLNS=17 ;(see "BPS LSTMN LOG" LM template: Bottom=21, Top = 4, 21-4=17)
"RTN","BPSSCRLG",128,0)
 N BPX,BPLN0,BPCNT,BPSTR1,BPSTYP2
"RTN","BPSSCRLG",129,0)
 S BPLN0=BPLN
"RTN","BPSSCRLG",130,0)
 S BPSTYP2=$S(BPSTYPE="C":"CLAIM REQUEST",BPSTYPE="R":"REVERSAL",1:"")
"RTN","BPSSCRLG",131,0)
 S BPSTR1="Transmission Information ("_BPSTYP2_")(#"_BPIEN02_")"
"RTN","BPSSCRLG",132,0)
 D SETLINE(.BPLN,BPSTR1_$$LINE^BPSSCRU3(79-$L(BPSTR1),"-"))
"RTN","BPSSCRLG",133,0)
 D SETLINE(.BPLN,"")
"RTN","BPSSCRLG",134,0)
 D SETLINE(.BPLN,"Created on: "_$$CREATEDT(BPIEN02,BPSDTALT))
"RTN","BPSSCRLG",135,0)
 D SETLINE(.BPLN,"VA Claim ID: "_$P($G(^BPSC(+BPIEN02,0)),U,1))
"RTN","BPSSCRLG",136,0)
 D SETLINE(.BPLN,"Submitted By: "_$$SUBMTBY(BP57))
"RTN","BPSSCRLG",137,0)
 D SETLINE(.BPLN,"Transaction Type: "_$$TRTYPE^BPSSCRU5($$TRCODE(BPIEN02)))
"RTN","BPSSCRLG",138,0)
 D SETLINE(.BPLN,"Date of Service: "_$$DOSCLM(BPIEN02))
"RTN","BPSSCRLG",139,0)
 D SETLINE(.BPLN,"NDC: "_$$LNDC^BPSSCRU5(BPIEN02))
"RTN","BPSSCRLG",140,0)
 D SETLINE(.BPLN,"ECME Pharmacy: "_$$DIVNAME^BPSSCRDS($$LDIV(BP57)))
"RTN","BPSSCRLG",141,0)
 D SETLINE(.BPLN,"Days Supply: "_$$DAYSSUPL(BPIEN02))
"RTN","BPSSCRLG",142,0)
 S BPX="Qty: "_$$QTY(BP57)
"RTN","BPSSCRLG",143,0)
 S BPX=BPX_"     Unit Price: "_$$UNTPRICE(BP57)
"RTN","BPSSCRLG",144,0)
 S BPX=BPX_"     Total Price: "_$$TOTPRICE(BP57)
"RTN","BPSSCRLG",145,0)
 D SETLINE(.BPLN,BPX)
"RTN","BPSSCRLG",146,0)
 D SETLINE(.BPLN,"")
"RTN","BPSSCRLG",147,0)
 D SETLINE(.BPLN,"Insurance Name: "_$$INSUR57(BP57))
"RTN","BPSSCRLG",148,0)
 D SETLINE(.BPLN,"BIN: "_$$BIN(BPIEN02))
"RTN","BPSSCRLG",149,0)
 D SETLINE(.BPLN,"PCN: "_$$PCN(BPIEN02))
"RTN","BPSSCRLG",150,0)
 D SETLINE(.BPLN,"Group ID: "_$$GRPID(BPIEN02))
"RTN","BPSSCRLG",151,0)
 D SETLINE(.BPLN,"Cardholder ID: "_$$CRDHLDID(BPIEN02))
"RTN","BPSSCRLG",152,0)
 D SETLINE(.BPLN,"Patient Relationship Code: "_$$PATRELSH(BPIEN02,BP57))
"RTN","BPSSCRLG",153,0)
 D SETLINE(.BPLN,"Cardholder First Name: "_$$CRDHLDFN(BPIEN02,BP57))
"RTN","BPSSCRLG",154,0)
 D SETLINE(.BPLN,"Cardholder Last Name: "_$$CRDHLDLN(BPIEN02,BP57))
"RTN","BPSSCRLG",155,0)
 F BPCNT=BPLN:1:BPLN0+BPSCRLNS D SETLINE(.BPLN,"")
"RTN","BPSSCRLG",156,0)
 S BPLN0=BPLN
"RTN","BPSSCRLG",157,0)
 D SETLINE(.BPLN,"Plan ID: "_$$PLANID(BP57))
"RTN","BPSSCRLG",158,0)
 D SETLINE(.BPLN,"Payer Sheet IEN: "_$$PYRIEN^BPSSCRU5(BPIEN02))
"RTN","BPSSCRLG",159,0)
 D SETLINE(.BPLN,"B2 Payer Sheet IEN: "_$$B2PYRIEN^BPSSCRU5(BPIEN02,BP57))
"RTN","BPSSCRLG",160,0)
 D SETLINE(.BPLN,"B3 Rebill Payer Sheet: "_$$B3PYRIEN^BPSSCRU5(BPIEN02,BP59,BP57))
"RTN","BPSSCRLG",161,0)
 D SETLINE(.BPLN,"Certify Mode: "_$$CERTMOD(BP57))
"RTN","BPSSCRLG",162,0)
 D SETLINE(.BPLN,"Cert IEN: "_$$CERTIEN(BP57))
"RTN","BPSSCRLG",163,0)
 F BPCNT=BPLN:1:BPLN0+BPSCRLNS D SETLINE(.BPLN,"")
"RTN","BPSSCRLG",164,0)
 Q
"RTN","BPSSCRLG",165,0)
 ;Submitted By User from Log of Transactions file
"RTN","BPSSCRLG",166,0)
SUBMTBY(BP57) ;
"RTN","BPSSCRLG",167,0)
 N BPIEN,BPUSR
"RTN","BPSSCRLG",168,0)
 S BPIEN=$P($G(^BPSTL(BP57,0)),U,10)
"RTN","BPSSCRLG",169,0)
 S BPUSR=$$GETUSRNM^BPSSCRU1(BPIEN)
"RTN","BPSSCRLG",170,0)
 Q $S(BPUSR']"":"UNKNOWN",1:BPUSR)
"RTN","BPSSCRLG",171,0)
 ;
"RTN","BPSSCRLG",172,0)
 ;Date os service date in BPS CLAIM file
"RTN","BPSSCRLG",173,0)
DOSCLM(BPIEN02) ;
"RTN","BPSSCRLG",174,0)
 N BPDT
"RTN","BPSSCRLG",175,0)
 S BPDT=$P($G(^BPSC(BPIEN02,400,1,400)),U,1)\1
"RTN","BPSSCRLG",176,0)
 Q $E(BPDT,5,6)_"/"_$E(BPDT,7,8)_"/"_$E(BPDT,1,4)
"RTN","BPSSCRLG",177,0)
 ;record created on 
"RTN","BPSSCRLG",178,0)
CREATEDT(BPIEN02,BPSDTALT) ;
"RTN","BPSSCRLG",179,0)
 N BPSDT
"RTN","BPSSCRLG",180,0)
 S BPSDT=+$P($G(^BPSC(BPIEN02,0)),U,6)
"RTN","BPSSCRLG",181,0)
 Q $$DATETIME^BPSSCRU5($S(BPSDT>0:BPSDT,1:BPSDTALT))
"RTN","BPSSCRLG",182,0)
 Q
"RTN","BPSSCRLG",183,0)
 ;Plan ID from #9002313.57
"RTN","BPSSCRLG",184,0)
PLANID(BP57) ;
"RTN","BPSSCRLG",185,0)
 Q $P($G(^BPSTL(BP57,10,+$G(^BPSTL(BP57,9)),0)),U,1)
"RTN","BPSSCRLG",186,0)
 ;
"RTN","BPSSCRLG",187,0)
CERTMOD(BP57) ;
"RTN","BPSSCRLG",188,0)
 Q $P($G(^BPSTL(BP57,10,+$G(^BPSTL(BP57,9)),0)),U,5)
"RTN","BPSSCRLG",189,0)
 ;Software Vendor/Cert ID
"RTN","BPSSCRLG",190,0)
CERTIEN(BP57) ;
"RTN","BPSSCRLG",191,0)
 Q $P($G(^BPSTL(BP57,10,+$G(^BPSTL(BP57,9)),0)),U,6)
"RTN","BPSSCRLG",192,0)
 ;group ID
"RTN","BPSSCRLG",193,0)
GRPID(BPIEN02) ;
"RTN","BPSSCRLG",194,0)
 Q $E($P($G(^BPSC(BPIEN02,300)),U,1),3,99)
"RTN","BPSSCRLG",195,0)
 ;
"RTN","BPSSCRLG",196,0)
 ;Cardholder ID
"RTN","BPSSCRLG",197,0)
CRDHLDID(BPIEN02) ;
"RTN","BPSSCRLG",198,0)
 Q $E($P($G(^BPSC(BPIEN02,300)),U,2),3,99)
"RTN","BPSSCRLG",199,0)
 ;Cardholder First name
"RTN","BPSSCRLG",200,0)
CRDHLDFN(BPIEN02,BP57) ;
"RTN","BPSSCRLG",201,0)
 N Y
"RTN","BPSSCRLG",202,0)
 S Y=$P($G(^BPSC(BPIEN02,300)),U,12)
"RTN","BPSSCRLG",203,0)
 I $L(Y)=0 S Y=$P($G(^BPSTL(BP57,10,+$G(^BPSTL(BP57,9)),1)),U,6)
"RTN","BPSSCRLG",204,0)
 Q Y
"RTN","BPSSCRLG",205,0)
 ;Cardholder Last  Name
"RTN","BPSSCRLG",206,0)
CRDHLDLN(BPIEN02,BP57) ;
"RTN","BPSSCRLG",207,0)
 N Y
"RTN","BPSSCRLG",208,0)
 S Y=$P($G(^BPSC(BPIEN02,300)),U,13)
"RTN","BPSSCRLG",209,0)
 I $L(Y)=0 S Y=$P($G(^BPSTL(BP57,10,+$G(^BPSTL(BP57,9)),1)),U,7)
"RTN","BPSSCRLG",210,0)
 Q Y
"RTN","BPSSCRLG",211,0)
 ;Patient Relationship Code
"RTN","BPSSCRLG",212,0)
PATRELSH(BPIEN02,BP57) ;
"RTN","BPSSCRLG",213,0)
 N Y
"RTN","BPSSCRLG",214,0)
 S Y=$P($G(^BPSC(BPIEN02,300)),U,6)
"RTN","BPSSCRLG",215,0)
 I $L(Y)=0 S Y=$P($G(^BPSTL(BP57,10,+$G(^BPSTL(BP57,9)),1)),U,5)
"RTN","BPSSCRLG",216,0)
 Q $S(Y=1:"CARDHOLDER",Y=2:"SPOUSE",Y=3:"CHILD",1:Y)
"RTN","BPSSCRLG",217,0)
 ;
"RTN","BPSSCRLG",218,0)
PCN(BPIEN02) ;
"RTN","BPSSCRLG",219,0)
 Q $P($G(^BPSC(BPIEN02,100)),U,4)
"RTN","BPSSCRLG",220,0)
 ;
"RTN","BPSSCRLG",221,0)
BIN(BPIEN02) ;
"RTN","BPSSCRLG",222,0)
 Q $P($G(^BPSC(BPIEN02,100)),U,1)
"RTN","BPSSCRLG",223,0)
 ;insurance name by 9002313.57 pointer
"RTN","BPSSCRLG",224,0)
INSUR57(BPIEN57) ;
"RTN","BPSSCRLG",225,0)
 N BPINSN
"RTN","BPSSCRLG",226,0)
 S BPINSN=+$G(^BPSTL(BPIEN57,9))
"RTN","BPSSCRLG",227,0)
 Q $P($G(^BPSTL(BPIEN57,10,BPINSN,0)),U,7)
"RTN","BPSSCRLG",228,0)
 ;
"RTN","BPSSCRLG",229,0)
QTY(BPIEN57) ;
"RTN","BPSSCRLG",230,0)
 Q +$P($G(^BPSTL(BPIEN57,5)),U,1)
"RTN","BPSSCRLG",231,0)
UNTPRICE(BPIEN57) ;
"RTN","BPSSCRLG",232,0)
 Q +$P($G(^BPSTL(BPIEN57,5)),U,2)
"RTN","BPSSCRLG",233,0)
TOTPRICE(BPIEN57) ;
"RTN","BPSSCRLG",234,0)
 Q +$P($G(^BPSTL(BPIEN57,5)),U,5)
"RTN","BPSSCRLG",235,0)
 ;get ECME pharmacy division ptr for LOG
"RTN","BPSSCRLG",236,0)
LDIV(BPIEN57) ;
"RTN","BPSSCRLG",237,0)
 Q +$P($G(^BPSTL(BPIEN57,1)),U,7)
"RTN","BPSSCRLG",238,0)
 ;transaction code
"RTN","BPSSCRLG",239,0)
TRCODE(BPIEN02) ;
"RTN","BPSSCRLG",240,0)
 Q $P($G(^BPSC(BPIEN02,100)),U,3)
"RTN","BPSSCRLG",241,0)
 ;days supply
"RTN","BPSSCRLG",242,0)
DAYSSUPL(BPIEN02) ;
"RTN","BPSSCRLG",243,0)
 ;format D5NNN -> NNN
"RTN","BPSSCRLG",244,0)
 Q +$E($P($G(^BPSC(BPIEN02,400,1,400)),U,5),3,99)
"RTN","BPSSCRLG",245,0)
 ;
"RTN","BPSSCRLG",246,0)
 ;display response record
"RTN","BPSSCRLG",247,0)
DISPRSP(BPLN,BP59,BPIEN03,BP57,BPSTYPE,BPSDTALT) ;
"RTN","BPSSCRLG",248,0)
 N BPSCRLNS S BPSCRLNS=17 ;(see "BPS LSTMN LOG" LM template: Bottom=21, Top = 4, 21-4=17)
"RTN","BPSSCRLG",249,0)
 N BPX,BPLN0,BPCNT,BPRJCDS,BPRJ,BPSTR1,BPSTYP2
"RTN","BPSSCRLG",250,0)
 S BPLN0=BPLN
"RTN","BPSSCRLG",251,0)
 S BPSTYP2=$S(BPSTYPE="C":"CLAIM REQUEST",BPSTYPE="R":"REVERSAL",1:"")
"RTN","BPSSCRLG",252,0)
 S BPSTR1="Response Information  ("_BPSTYP2_")(#"_BPIEN03_")"
"RTN","BPSSCRLG",253,0)
 D SETLINE(.BPLN,BPSTR1_$$LINE^BPSSCRU3(79-$L(BPSTR1),"-"))
"RTN","BPSSCRLG",254,0)
 D SETLINE(.BPLN,"")
"RTN","BPSSCRLG",255,0)
 D SETLINE(.BPLN,"Response Received: "_$$RESPREC(BPIEN03,BPSDTALT))
"RTN","BPSSCRLG",256,0)
 D SETLINE(.BPLN,"Date of Service: "_$$DOSRSP(BPIEN03))
"RTN","BPSSCRLG",257,0)
 D SETLINE(.BPLN,"Transaction Response Status: "_$$RESPSTAT^BPSSCRU5(BPIEN03))
"RTN","BPSSCRLG",258,0)
 D SETLINE(.BPLN,"Total Amount Paid: $"_+$$TOTAMNT(BPIEN03,BP59,BP57))
"RTN","BPSSCRLG",259,0)
 D SETLINE(.BPLN,"Reject code(s): ")
"RTN","BPSSCRLG",260,0)
 D REJCODES^BPSSCRU5(BPIEN03,.BPRJCDS)
"RTN","BPSSCRLG",261,0)
 S BPRJ=""
"RTN","BPSSCRLG",262,0)
 F  S BPRJ=$O(BPRJCDS(BPRJ)) Q:BPRJ=""  D
"RTN","BPSSCRLG",263,0)
 . D SETLINE(.BPLN," "_$$GETRJNAM^BPSSCRU3(BPRJ))
"RTN","BPSSCRLG",264,0)
 D WRAPLN^BPSSCRU5(.BPLN,$$MESSAGE(BPIEN03),76,"Message: ",5)
"RTN","BPSSCRLG",265,0)
 D WRAPLN^BPSSCRU5(.BPLN,$$ADDMESS(BPIEN03),76,"Additional Message: ",5)
"RTN","BPSSCRLG",266,0)
 ;D WRAPLN^BPSSCRU5(.BPLN,$$DUR(BPIEN03),60,"DUR Information: ",5)
"RTN","BPSSCRLG",267,0)
 D WRAPLN^BPSSCRU5(.BPLN,$$DURRESP(BPIEN03),76,"DUR Response Info: ",5)
"RTN","BPSSCRLG",268,0)
 F BPCNT=BPLN:1:BPLN0+BPSCRLNS D SETLINE(.BPLN,"")
"RTN","BPSSCRLG",269,0)
 Q
"RTN","BPSSCRLG",270,0)
 ;
"RTN","BPSSCRLG",271,0)
RESPREC(BPIEN03,BPSDTALT) ;
"RTN","BPSSCRLG",272,0)
 N BPSDT
"RTN","BPSSCRLG",273,0)
 S BPSDT=+$P($G(^BPSR(BPIEN03,0)),U,2)
"RTN","BPSSCRLG",274,0)
 Q $$DATETIME^BPSSCRU5($S(BPSDT>0:BPSDT,1:BPSDTALT))
"RTN","BPSSCRLG",275,0)
 ;
"RTN","BPSSCRLG",276,0)
DOSRSP(BPIEN03) ;
"RTN","BPSSCRLG",277,0)
 N BPDT
"RTN","BPSSCRLG",278,0)
 S BPDT=$P($G(^BPSR(BPIEN03,400)),U,1)\1
"RTN","BPSSCRLG",279,0)
 Q $E(BPDT,5,6)_"/"_$E(BPDT,7,8)_"/"_$E(BPDT,1,4)
"RTN","BPSSCRLG",280,0)
 ;
"RTN","BPSSCRLG",281,0)
TOTAMNT(BPIEN03,BP59,BP57) ;
"RTN","BPSSCRLG",282,0)
 Q $$DFF2EXT^BPSECFM($P($G(^BPSR(BPIEN03,1000,1,500)),U,9))
"RTN","BPSSCRLG",283,0)
 ;
"RTN","BPSSCRLG",284,0)
MESSAGE(BPIEN03) ;
"RTN","BPSSCRLG",285,0)
 Q $P($G(^BPSR(BPIEN03,504)),U)
"RTN","BPSSCRLG",286,0)
 ;
"RTN","BPSSCRLG",287,0)
ADDMESS(BPIEN03) ;
"RTN","BPSSCRLG",288,0)
 Q $P($G(^BPSR(BPIEN03,1000,1,526)),U)
"RTN","BPSSCRLG",289,0)
 ;
"RTN","BPSSCRLG",290,0)
DUR(BPIEN03) ;
"RTN","BPSSCRLG",291,0)
 Q "???"
"RTN","BPSSCRLG",292,0)
 ;
"RTN","BPSSCRLG",293,0)
DURRESP(BPIEN03) ;
"RTN","BPSSCRLG",294,0)
 Q $P($G(^BPSR(BPIEN03,1000,1,525)),U)
"RTN","BPSSCRRS")
0^13^B34449344
"RTN","BPSSCRRS",1,0)
BPSSCRRS ;BHAM ISC/SS - ECME SCREEN RESUBMIT ;05-APR-05
"RTN","BPSSCRRS",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,3,5,7**;JUN 2004;Build 46
"RTN","BPSSCRRS",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSSCRRS",4,0)
 Q
"RTN","BPSSCRRS",5,0)
 ;IA 4702
"RTN","BPSSCRRS",6,0)
 ;
"RTN","BPSSCRRS",7,0)
RES ;
"RTN","BPSSCRRS",8,0)
 N BPRET,BPSARR59
"RTN","BPSSCRRS",9,0)
 I '$D(@(VALMAR)) Q
"RTN","BPSSCRRS",10,0)
 D FULL^VALM1
"RTN","BPSSCRRS",11,0)
 W !,"Enter the line numbers for the claim(s) to be resubmitted."
"RTN","BPSSCRRS",12,0)
 S BPRET=$$ASKLINES^BPSSCRU4("Select item(s)","C",.BPSARR59,VALMAR)
"RTN","BPSSCRRS",13,0)
 I BPRET="^" S VALMBCK="R" Q
"RTN","BPSSCRRS",14,0)
 ;go thru all selected claims and try to resubmit them separately
"RTN","BPSSCRRS",15,0)
 ;update the content of the screen and display it
"RTN","BPSSCRRS",16,0)
 ;only if at least one claim was submitted successfully
"RTN","BPSSCRRS",17,0)
 I $$RESUBMIT(.BPSARR59) D REDRAW^BPSSCRUD("Updating screen for resubmitted claims...")
"RTN","BPSSCRRS",18,0)
 E  S VALMBCK="R"
"RTN","BPSSCRRS",19,0)
 Q
"RTN","BPSSCRRS",20,0)
 ;
"RTN","BPSSCRRS",21,0)
 ;/**
"RTN","BPSSCRRS",22,0)
 ;go thru all selected claims and try to resubmit them separately
"RTN","BPSSCRRS",23,0)
 ;input:
"RTN","BPSSCRRS",24,0)
 ; RXI - array with ptrs to BPS TRANSACTION file (see ASKLINES^BPSSCRU4)
"RTN","BPSSCRRS",25,0)
 ;returns 
"RTN","BPSSCRRS",26,0)
 ; 0 - if no claims were resubmitted 
"RTN","BPSSCRRS",27,0)
 ; 1 - if at least one claim was resubmitted 
"RTN","BPSSCRRS",28,0)
RESUBMIT(RXI) ;*/
"RTN","BPSSCRRS",29,0)
 N BPRVRSED ;was successfully reversed
"RTN","BPSSCRRS",30,0)
 N BPRVNEED ;needs reversal
"RTN","BPSSCRRS",31,0)
 N BPRVWAIT ;cycles of waiting 
"RTN","BPSSCRRS",32,0)
 N BPRVRSNT ;reversal has been sent
"RTN","BPSSCRRS",33,0)
 N WHERE,DOSDATE,BILLNUM,RXIEN,RXR,BPDFN
"RTN","BPSSCRRS",34,0)
 N BP59
"RTN","BPSSCRRS",35,0)
 N UPDATFLG,BPCLTOT,BPCLTOTR
"RTN","BPSSCRRS",36,0)
 N BPQ
"RTN","BPSSCRRS",37,0)
 N BPSTATUS
"RTN","BPSSCRRS",38,0)
 N REVCOUNT S REVCOUNT=0
"RTN","BPSSCRRS",39,0)
 N BPIFANY S BPIFANY=0
"RTN","BPSSCRRS",40,0)
 N BPINPROG S BPINPROG=0
"RTN","BPSSCRRS",41,0)
 S BPCLTOT=0 ;total for resubmitted
"RTN","BPSSCRRS",42,0)
 S BPCLTOTR=0 ;total for reversed, not resubmitted
"RTN","BPSSCRRS",43,0)
 S UPDATFLG=0
"RTN","BPSSCRRS",44,0)
 S BP59="",BPQ=""
"RTN","BPSSCRRS",45,0)
 F  S BP59=$O(RXI(BP59)) Q:BP59=""  D  Q:BPQ="^"
"RTN","BPSSCRRS",46,0)
 . I BPIFANY=0 W @IOF
"RTN","BPSSCRRS",47,0)
 . S BPIFANY=1,BPQ=""
"RTN","BPSSCRRS",48,0)
 . S BPDFN=+$P($G(^BPST(BP59,0)),U,6)
"RTN","BPSSCRRS",49,0)
 . W !,"You've chosen to RESUBMIT the following prescription for "_$E($$PATNAME^BPSSCRU2(BPDFN),1,13)
"RTN","BPSSCRRS",50,0)
 . W !,@VALMAR@(+$G(RXI(BP59)),0)
"RTN","BPSSCRRS",51,0)
 . S (BPRVNEED,BPRVRSED,BPRVWAIT,BPRVRSNT)=0
"RTN","BPSSCRRS",52,0)
 . S BPQ=$$YESNO("Are you sure?(Y/N)")
"RTN","BPSSCRRS",53,0)
 . I BPQ=-1 S BPQ="^" Q
"RTN","BPSSCRRS",54,0)
 . I BPQ'=1 Q
"RTN","BPSSCRRS",55,0)
 . S RXIEN=$P(BP59,".")
"RTN","BPSSCRRS",56,0)
 . S RXR=+$E($P(BP59,".",2),1,4)
"RTN","BPSSCRRS",57,0)
 . I BPRVNEED=1&(BPRVRSED'=1) Q  ;cannot be resubmitted
"RTN","BPSSCRRS",58,0)
 . I $$RXDEL^BPSOS(+RXIEN,RXR) W !!,">> Cannot Reverse or Resubmit ",!,@VALMAR@(+$G(RXI(BP59)),0),!," because it has been deleted in Pharmacy.",! Q
"RTN","BPSSCRRS",59,0)
 . ;can't resubmit a closed claim. The user must reopen first.
"RTN","BPSSCRRS",60,0)
 . I $$CLOSED02^BPSSCR03($P($G(^BPST(BP59,0)),U,4))  D  Q
"RTN","BPSSCRRS",61,0)
 . . W !!,">> Cannot Resubmit ",!,$G(@VALMAR@(+$G(RXI(BP59)),0)),!," because the claim is Closed. Reopen the claim and try again.",! Q
"RTN","BPSSCRRS",62,0)
 . S BPSTATUS=$P($$CLAIMST^BPSSCRU3(BP59),U)
"RTN","BPSSCRRS",63,0)
 . I (BPSTATUS="IN PROGRESS")!(BPSTATUS="SCHEDULED") S BPINPROG=1
"RTN","BPSSCRRS",64,0)
 . I BPINPROG=1 D  I $$YESNO^BPSSCRRS("Do you want to proceed?(Y/N)")=0 S BPQ="^" Q
"RTN","BPSSCRRS",65,0)
 . . W !,"The claim is in progress. The request will be scheduled and processed after"
"RTN","BPSSCRRS",66,0)
 . . W !,"the previous request(s) are completed. Please be aware that the result of "
"RTN","BPSSCRRS",67,0)
 . . W !,"the resubmit depends on the payer's response to the prior incomplete requests."
"RTN","BPSSCRRS",68,0)
 . ;delete this I BPSTATUS["IN PROGRESS" W !!,">> Cannot Resubmit ",!,@VALMAR@(+$G(RXI(BP59)),0),!," because there is no response from the payer yet.",! Q
"RTN","BPSSCRRS",69,0)
 . I $P($G(^BPST(BP59,9)),U,4)'="T" I BPINPROG=0,BPSTATUS["E REVERSAL REJECTED" W !!,">> Cannot Resubmit ",!,@VALMAR@(+$G(RXI(BP59)),0),!," because the REVERSAL was rejected.",! Q
"RTN","BPSSCRRS",70,0)
 . I $P($G(^BPST(BP59,9)),U,4)'="T" I BPINPROG=0,BPSTATUS["E REVERSAL UNSTRANDED" W !!,">> Cannot Resubmit ",!,@VALMAR@(+$G(RXI(BP59)),0),!," because there is no response for reversal yet.",! Q
"RTN","BPSSCRRS",71,0)
 . S DOSDATE=$$DOSDATE(RXIEN,RXR)
"RTN","BPSSCRRS",72,0)
 . S BILLNUM=$$EN^BPSNCPDP(RXIEN,RXR,DOSDATE,"ERES","","ECME RESUBMIT")
"RTN","BPSSCRRS",73,0)
 . ;print return value message
"RTN","BPSSCRRS",74,0)
 . W !!
"RTN","BPSSCRRS",75,0)
 . W:+BILLNUM>0 $S(+BILLNUM=10:"Reversal but no Resubmit:",1:"Not Processed:"),!,"  "
"RTN","BPSSCRRS",76,0)
 . ;Change Return Message for SC/EI
"RTN","BPSSCRRS",77,0)
 . S:$P(BILLNUM,U,2)="NEEDS SC DETERMINATION" $P(BILLNUM,U,2)="NEEDS SC/EI DETERMINATION"
"RTN","BPSSCRRS",78,0)
 . W $P(BILLNUM,U,2)
"RTN","BPSSCRRS",79,0)
 . ;0 Prescription/Fill successfully submitted to ECME for claims processing
"RTN","BPSSCRRS",80,0)
 . ;1 ECME did not submit prescription/fill
"RTN","BPSSCRRS",81,0)
 . ;2 IB says prescription/fill is not ECME billable or the data returned from IB is not valid
"RTN","BPSSCRRS",82,0)
 . ;3 ECME closed the claim but did not submit it to the payer
"RTN","BPSSCRRS",83,0)
 . ;4 Unable to queue the ECME claim
"RTN","BPSSCRRS",84,0)
 . ;5 Invalid input
"RTN","BPSSCRRS",85,0)
 . ;10 Reversal but no resubmit
"RTN","BPSSCRRS",86,0)
 . I +BILLNUM=0 D 
"RTN","BPSSCRRS",87,0)
 . . D ECMEACT^PSOBPSU1(+RXIEN,+RXR,"Claim resubmitted to 3rd party payer: ECME USER's SCREEN")
"RTN","BPSSCRRS",88,0)
 . . S UPDATFLG=1,BPCLTOT=BPCLTOT+1
"RTN","BPSSCRRS",89,0)
 . I +BILLNUM=10 D 
"RTN","BPSSCRRS",90,0)
 . . D ECMEACT^PSOBPSU1(+RXIEN,+RXR,"Claim reversed but not resubmitted: ECME USER's SCREEN")
"RTN","BPSSCRRS",91,0)
 . . S UPDATFLG=1,BPCLTOTR=BPCLTOTR+1
"RTN","BPSSCRRS",92,0)
 W:BPIFANY=0 !,"No eligible items selected."
"RTN","BPSSCRRS",93,0)
 W !,BPCLTOT," claim",$S(BPCLTOT'=1:"s have",1:" has")," been resubmitted.",!
"RTN","BPSSCRRS",94,0)
 W:BPCLTOTR>0 !,BPCLTOTR," claim",$S(BPCLTOTR'=1:"s have",1:" has")," been reversed but not resubmitted.",!
"RTN","BPSSCRRS",95,0)
 D PAUSE^VALM1
"RTN","BPSSCRRS",96,0)
 Q UPDATFLG
"RTN","BPSSCRRS",97,0)
 ;
"RTN","BPSSCRRS",98,0)
 ; Ask
"RTN","BPSSCRRS",99,0)
 ; Input:
"RTN","BPSSCRRS",100,0)
 ;  BPQSTR - question
"RTN","BPSSCRRS",101,0)
 ;  BPDFL - default answer
"RTN","BPSSCRRS",102,0)
 ; Output: 
"RTN","BPSSCRRS",103,0)
 ; 1 YES
"RTN","BPSSCRRS",104,0)
 ; 0 NO
"RTN","BPSSCRRS",105,0)
 ; -1 if cancelled
"RTN","BPSSCRRS",106,0)
YESNO(BPQSTR,BPDFL) ; Default - YES
"RTN","BPSSCRRS",107,0)
 N DIR,Y,DUOUT
"RTN","BPSSCRRS",108,0)
 S DIR(0)="Y"
"RTN","BPSSCRRS",109,0)
 S DIR("A")=BPQSTR
"RTN","BPSSCRRS",110,0)
 S:$L($G(BPDFL)) DIR("B")=BPDFL
"RTN","BPSSCRRS",111,0)
 D ^DIR
"RTN","BPSSCRRS",112,0)
 Q $S($G(DUOUT)!$G(DUOUT)!(Y="^"):-1,1:Y)
"RTN","BPSSCRRS",113,0)
 ;
"RTN","BPSSCRRS",114,0)
 ;Date of service
"RTN","BPSSCRRS",115,0)
 ;RXIEN - IEN in file #52
"RTN","BPSSCRRS",116,0)
 ;RXR - refill number
"RTN","BPSSCRRS",117,0)
 ;returns:
"RTN","BPSSCRRS",118,0)
 ; date of service
"RTN","BPSSCRRS",119,0)
DOSDATE(RXIEN,RXR) ;
"RTN","BPSSCRRS",120,0)
 N BPDOS,BPDT
"RTN","BPSSCRRS",121,0)
 ;try release date
"RTN","BPSSCRRS",122,0)
 S BPDOS=$$RXRLDT^PSOBPSUT(RXIEN,RXR)\1
"RTN","BPSSCRRS",123,0)
 Q:+BPDOS>0 BPDOS
"RTN","BPSSCRRS",124,0)
 ;try fill date
"RTN","BPSSCRRS",125,0)
 S BPDOS=$$RXFLDT^PSOBPSUT(RXIEN,RXR)\1
"RTN","BPSSCRRS",126,0)
 I '$G(DT) Q BPDOS
"RTN","BPSSCRRS",127,0)
 I BPDOS>0,BPDOS'>DT Q BPDOS
"RTN","BPSSCRRS",128,0)
 ;use current date (today)
"RTN","BPSSCRRS",129,0)
 Q DT\1
"RTN","BPSSCRRS",130,0)
 ;
"RTN","BPSSCRRS",131,0)
 ;To display the FILL date on the screen
"RTN","BPSSCRRS",132,0)
 ; use Date Of Service date , later on it might be changed
"RTN","BPSSCRRS",133,0)
 ;input:
"RTN","BPSSCRRS",134,0)
 ;RXIEN - IEN in file #52
"RTN","BPSSCRRS",135,0)
 ;RXR - refill number
"RTN","BPSSCRRS",136,0)
 ;returns:
"RTN","BPSSCRRS",137,0)
 ; date of service
"RTN","BPSSCRRS",138,0)
 ; or empty date if failure
"RTN","BPSSCRRS",139,0)
FILLDATE(RXIEN,RXR) ;
"RTN","BPSSCRRS",140,0)
 N DOSDT
"RTN","BPSSCRRS",141,0)
 S DOSDT=$$DOSDATE(RXIEN,RXR)
"RTN","BPSSCRRS",142,0)
 I $L(DOSDT)'=7 Q "  /  "
"RTN","BPSSCRRS",143,0)
 Q $E(DOSDT,4,5)_"/"_$E(DOSDT,6,7)
"RTN","BPSSCRRS",144,0)
 ;       
"RTN","BPSSCRRV")
0^14^B37049932
"RTN","BPSSCRRV",1,0)
BPSSCRRV ;BHAM ISC/SS - ECME SCREEN REVERSE CLAIM ;05-APR-05
"RTN","BPSSCRRV",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5,6,7**;JUN 2004;Build 46
"RTN","BPSSCRRV",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSSCRRV",4,0)
 Q
"RTN","BPSSCRRV",5,0)
 ;IA 4702
"RTN","BPSSCRRV",6,0)
 ;
"RTN","BPSSCRRV",7,0)
REV ;entry point for "Reverse" menu item
"RTN","BPSSCRRV",8,0)
 N BPRET,BPSARR59
"RTN","BPSSCRRV",9,0)
 I '$D(@(VALMAR)) Q
"RTN","BPSSCRRV",10,0)
 D FULL^VALM1
"RTN","BPSSCRRV",11,0)
 W !,"Enter the line numbers for the Payable claim(s) to be Reversed."
"RTN","BPSSCRRV",12,0)
 S BPRET=$$ASKLINES^BPSSCRU4("Select item(s)","C",.BPSARR59,VALMAR)
"RTN","BPSSCRRV",13,0)
 I BPRET="^" S VALMBCK="R" Q
"RTN","BPSSCRRV",14,0)
 ;reverse selected lines
"RTN","BPSSCRRV",15,0)
 ;update the content of the screen and display it
"RTN","BPSSCRRV",16,0)
 ;only if at least one reversal was submitted successfully
"RTN","BPSSCRRV",17,0)
 I $$RVLINES(.BPSARR59)>0 D REDRAW^BPSSCRUD("Updating screen for reversed claims...")
"RTN","BPSSCRRV",18,0)
 E  S VALMBCK="R"
"RTN","BPSSCRRV",19,0)
 Q
"RTN","BPSSCRRV",20,0)
 ;/**
"RTN","BPSSCRRV",21,0)
 ;Reverse selected lines
"RTN","BPSSCRRV",22,0)
 ;input: 
"RTN","BPSSCRRV",23,0)
 ; BP59ARR(BP59)="line# in LM array "
"RTN","BPSSCRRV",24,0)
 ;output:
"RTN","BPSSCRRV",25,0)
 ; REVTOTAL - total number of claims for whose the reversal was submitted sucessfully  
"RTN","BPSSCRRV",26,0)
RVLINES(BP59ARR) ;*/
"RTN","BPSSCRRV",27,0)
 N BP59,REVTOTAL,BPRVREAS,BPDFN,BPQ,IBD,BPRXRF
"RTN","BPSSCRRV",28,0)
 N BPINPROG S BPINPROG=0
"RTN","BPSSCRRV",29,0)
 N BPIFANY S BPIFANY=0
"RTN","BPSSCRRV",30,0)
 N BPSTATS
"RTN","BPSSCRRV",31,0)
 S REVTOTAL=0,BPQ=""
"RTN","BPSSCRRV",32,0)
 S BP59="" F  S BP59=$O(BP59ARR(BP59)) Q:BP59=""  D  Q:BPQ="^"
"RTN","BPSSCRRV",33,0)
 . I BPIFANY=0 W @IOF
"RTN","BPSSCRRV",34,0)
 . S BPIFANY=1,BPQ=""
"RTN","BPSSCRRV",35,0)
 . ;can't reverse Tricare claims
"RTN","BPSSCRRV",36,0)
 . I $P($G(^BPST(BP59,9)),U,4)="T"  D  S BPQ=$$PAUSE() Q
"RTN","BPSSCRRV",37,0)
 . . W !,"The claim: ",!,$G(@VALMAR@(+$G(BP59ARR(BP59)),0)),!,"is Tricare claim and cannot be Reversed."
"RTN","BPSSCRRV",38,0)
 . ;can't reverse a closed claim. The user must reopen first.
"RTN","BPSSCRRV",39,0)
 . I $$CLOSED02^BPSSCR03($P($G(^BPST(BP59,0)),U,4))  D  S BPQ=$$PAUSE() Q
"RTN","BPSSCRRV",40,0)
 . . W !,"The claim: ",!,$G(@VALMAR@(+$G(BP59ARR(BP59)),0)),!,"is Closed and cannot be Reversed. Reopen the claim and try again."
"RTN","BPSSCRRV",41,0)
 . S BPDFN=+$P($G(^BPST(BP59,0)),U,6)
"RTN","BPSSCRRV",42,0)
 . S BPSTATS=$P($$CLAIMST^BPSSCRU3(BP59),U)
"RTN","BPSSCRRV",43,0)
 . I (BPSTATS="IN PROGRESS")!(BPSTATS="SCHEDULED") S BPINPROG=1
"RTN","BPSSCRRV",44,0)
 . I BPINPROG=0,'$$PAYABLE^BPSOSRX5(BPSTATS) D  S BPQ=$$PAUSE() Q
"RTN","BPSSCRRV",45,0)
 . . W !,"The claim: ",!,$G(@VALMAR@(+$G(BP59ARR(BP59)),0)),!,"is NOT Payable and cannot be Reversed."
"RTN","BPSSCRRV",46,0)
 . I BPINPROG=1 D  S BPQ=$$YESNO^BPSSCRRS("Do you want to proceed?(Y/N)") I BPQ<1 S BPQ="^" Q
"RTN","BPSSCRRV",47,0)
 . . W !,"The claim you've chosen to REVERSE for "_$E($$PATNAME^BPSSCRU2(BPDFN),1,13)
"RTN","BPSSCRRV",48,0)
 . . W !,$G(@VALMAR@(+$G(BP59ARR(BP59)),0))
"RTN","BPSSCRRV",49,0)
 . . W !,"is in progress. The reversal request will be scheduled and processed after"
"RTN","BPSSCRRV",50,0)
 . . W !,"the previous request(s) are completed. Please be aware that the result of "
"RTN","BPSSCRRV",51,0)
 . . W !,"the reversal depends on the payer's response to the prior incomplete requests."
"RTN","BPSSCRRV",52,0)
 . I BPINPROG=0 D
"RTN","BPSSCRRV",53,0)
 . . W !,"You've chosen to REVERSE the following prescription for "_$E($$PATNAME^BPSSCRU2(BPDFN),1,13)
"RTN","BPSSCRRV",54,0)
 . . W !,$G(@VALMAR@(+$G(BP59ARR(BP59)),0))
"RTN","BPSSCRRV",55,0)
 . F  S BPRVREAS=$$COMMENT^BPSSCRCL("Enter REQUIRED REVERSAL REASON",60) Q:BPRVREAS="^"  Q:($L(BPRVREAS)>0)&(BPRVREAS'="^")&('(BPRVREAS?1" "." "))  D
"RTN","BPSSCRRV",56,0)
 . . W !,"Please provide the reason or enter ^ to abandon the reversal."
"RTN","BPSSCRRV",57,0)
 . I BPRVREAS["^" W !,"The claim: ",!,$G(@VALMAR@(+$G(BP59ARR(BP59)),0)),!,"was NOT reversed!" S BPQ=$$PAUSE() Q
"RTN","BPSSCRRV",58,0)
 . S BPQ=$$YESNO^BPSSCRRS("Are you sure?(Y/N)")
"RTN","BPSSCRRV",59,0)
 . I BPQ=-1 S BPQ="^" Q
"RTN","BPSSCRRV",60,0)
 . I BPQ'=1 Q
"RTN","BPSSCRRV",61,0)
 . I $$REVERSIT(BP59,BPRVREAS)=0 S REVTOTAL=REVTOTAL+1
"RTN","BPSSCRRV",62,0)
 W:BPIFANY=0 !,"No eligible items selected."
"RTN","BPSSCRRV",63,0)
 W !,REVTOTAL," claim reversal",$S(REVTOTAL'=1:"s",1:"")," submitted.",!
"RTN","BPSSCRRV",64,0)
 D PAUSE^VALM1
"RTN","BPSSCRRV",65,0)
 Q REVTOTAL
"RTN","BPSSCRRV",66,0)
 ;
"RTN","BPSSCRRV",67,0)
 ;
"RTN","BPSSCRRV",68,0)
 ;the similar to REVERSE
"RTN","BPSSCRRV",69,0)
 ;with some information displayed for the user 
"RTN","BPSSCRRV",70,0)
 ;Input:
"RTN","BPSSCRRV",71,0)
 ; BP59 ptr in file #9002313.59
"RTN","BPSSCRRV",72,0)
 ; BPRVREAS - reversal reason (free text)
"RTN","BPSSCRRV",73,0)
 ;Output:
"RTN","BPSSCRRV",74,0)
 ;-1 Claim is not Payable
"RTN","BPSSCRRV",75,0)
 ;-2 no reversal, it's unreversable
"RTN","BPSSCRRV",76,0)
 ;-3 paper claim
"RTN","BPSSCRRV",77,0)
 ;>0 - IEN of reversal claim if electronic claim submitted for
"RTN","BPSSCRRV",78,0)
 ;   reversal.
"RTN","BPSSCRRV",79,0)
REVERSIT(BP59,BPRVREAS) ;
"RTN","BPSSCRRV",80,0)
 N BPRET
"RTN","BPSSCRRV",81,0)
 N BPRX
"RTN","BPSSCRRV",82,0)
 N BPRXRF
"RTN","BPSSCRRV",83,0)
 S BPRXRF=$$RXREF^BPSSCRU2(BP59)
"RTN","BPSSCRRV",84,0)
 S BPRET=+$$REVERSE(BP59,BPRVREAS,+BPRXRF,+$P(BPRXRF,U,2))
"RTN","BPSSCRRV",85,0)
 S BPRX=$$RXNUM^BPSSCRU2(+BPRXRF)
"RTN","BPSSCRRV",86,0)
 Q BPRET
"RTN","BPSSCRRV",87,0)
 ;
"RTN","BPSSCRRV",88,0)
 ;
"RTN","BPSSCRRV",89,0)
 ;/**
"RTN","BPSSCRRV",90,0)
 ;Reverse the claim 
"RTN","BPSSCRRV",91,0)
 ;Input:
"RTN","BPSSCRRV",92,0)
 ; BP59 ptr in file #9002313.59
"RTN","BPSSCRRV",93,0)
 ; BPRVREAS - reversal reason (free text)
"RTN","BPSSCRRV",94,0)
 ; BPRX - RX ien (#52)
"RTN","BPSSCRRV",95,0)
 ; BPFIL - refill number
"RTN","BPSSCRRV",96,0)
 ;Output:
"RTN","BPSSCRRV",97,0)
 ; code^message
"RTN","BPSSCRRV",98,0)
 ; where 
"RTN","BPSSCRRV",99,0)
 ; code :
"RTN","BPSSCRRV",100,0)
 ;  from $$EN^BPSNCPDP
"RTN","BPSSCRRV",101,0)
 ;  0 Prescription/Fill successfully submitted to ECME for claims processing
"RTN","BPSSCRRV",102,0)
 ;  1 ECME did not submit prescription/fill
"RTN","BPSSCRRV",103,0)
 ;  2 IB says prescription/fill is not ECME billable or the data returned from IB is not valid
"RTN","BPSSCRRV",104,0)
 ;  3 ECME closed the claim but did not submit it to the payer
"RTN","BPSSCRRV",105,0)
 ;  4 Unable to queue the ECME claim
"RTN","BPSSCRRV",106,0)
 ;  5 Invalid input
"RTN","BPSSCRRV",107,0)
 ;  and additional 
"RTN","BPSSCRRV",108,0)
 ;  12 Claim has been deleted in Pharmacy.
"RTN","BPSSCRRV",109,0)
 ; message - whatever $$EN^BPSNCPDP returns
"RTN","BPSSCRRV",110,0)
 ; for 12 - "Claim has been deleted in Pharmacy."
"RTN","BPSSCRRV",111,0)
 ; 
"RTN","BPSSCRRV",112,0)
REVERSE(BP59,BPRVREAS,BPRX,BPFIL) ;*/
"RTN","BPSSCRRV",113,0)
 N BPDOS,BPNDC,BPRET,BPSARRY,BPSCLOSE,ERROR,BPSTATUS,BPCOBIND,BPQ
"RTN","BPSSCRRV",114,0)
 S BPSCLOSE("CLOSE AFT REV")=0
"RTN","BPSSCRRV",115,0)
 S BPDOS=$$DOSDATE^BPSSCRRS(BPRX,BPFIL)
"RTN","BPSSCRRV",116,0)
 S BPNDC=$$NDC^BPSSCRU2(BPRX,BPFIL)
"RTN","BPSSCRRV",117,0)
 I $$RXDEL^BPSOS(BPRX,BPFIL) D  Q 12_U_"Claim has been deleted in Pharmacy."
"RTN","BPSSCRRV",118,0)
 . W !,"The claim cannot be reversed since it has been deleted in Pharmacy."
"RTN","BPSSCRRV",119,0)
 ;Prompt user to mark claim as non-billable and release patient copay
"RTN","BPSSCRRV",120,0)
 ;if selected claim is for the Primary Insurer - Check COB INDICATOR = 1,
"RTN","BPSSCRRV",121,0)
 ;or if COB INDICATOR is null for backward compatibitility.
"RTN","BPSSCRRV",122,0)
 I $P($G(^BPST(BP59,0)),U,14)'>1 D BILLCLM(.BPSCLOSE) I BPQ="-1" Q 1
"RTN","BPSSCRRV",123,0)
 ;Submit claim to ECME
"RTN","BPSSCRRV",124,0)
 S BPRET=$$EN^BPSNCPDP(BPRX,BPFIL,BPDOS,"EREV",BPNDC,BPRVREAS,"","","","","","","",.BPSCLOSE)
"RTN","BPSSCRRV",125,0)
 ;print return value message
"RTN","BPSSCRRV",126,0)
 W !!
"RTN","BPSSCRRV",127,0)
 W:+BPRET>0 "Not Processed:",!,"  ",$P(BPRET,U,2)
"RTN","BPSSCRRV",128,0)
 I +BPRET=0 S BPSTATUS=$$CLAIMST^BPSSCRU3(BP59) I $P(BPSTATUS,U)="E REVERSAL ACCEPTED" W $P(BPSTATUS,U,3)
"RTN","BPSSCRRV",129,0)
 ; 
"RTN","BPSSCRRV",130,0)
 ;0 Prescription/Fill successfully submitted to ECME for claims processing
"RTN","BPSSCRRV",131,0)
 ;1 ECME did not submit prescription/fill
"RTN","BPSSCRRV",132,0)
 ;2 IB says prescription/fill is not ECME billable or the data returned from IB is not valid
"RTN","BPSSCRRV",133,0)
 ;3 ECME closed the claim but did not submit it to the payer
"RTN","BPSSCRRV",134,0)
 ;4 Unable to queue the ECME claim
"RTN","BPSSCRRV",135,0)
 ;5 Invalid input
"RTN","BPSSCRRV",136,0)
 I +BPRET=0 D ECMEACT^PSOBPSU1(+BPRX,+BPFIL,"Claim reversal sent to 3rd party payer: ECME USER's SCREEN")
"RTN","BPSSCRRV",137,0)
 Q BPRET
"RTN","BPSSCRRV",138,0)
 ;
"RTN","BPSSCRRV",139,0)
 ;
"RTN","BPSSCRRV",140,0)
 ;Mark claim billable (YES/NO) question. If yes, ask for CLAIMS TRACKING
"RTN","BPSSCRRV",141,0)
 ;NON-BILLABLE REASONS NAME
"RTN","BPSSCRRV",142,0)
 ;Output: 
"RTN","BPSSCRRV",143,0)
 ;BPSCLOSE("CLOSE AFT REV")=1 or 0 (zero) (1 = YES, 0 = NO)
"RTN","BPSSCRRV",144,0)
 ;BPSCLOSE("CLOSE AFT REV REASON")=ptr to #356.8 ^ CLOSE REASON NAME ^ ECME FLAG ^ ECME PAPER FLAG
"RTN","BPSSCRRV",145,0)
 ;BPSCLOSE("CLOSE AFT REV COMMENT")=COMMENT TEXT
"RTN","BPSSCRRV",146,0)
BILLCLM(BPSCLOSE) ;
"RTN","BPSSCRRV",147,0)
 N BPREAZ,BPCMT,BPCLAR
"RTN","BPSSCRRV",148,0)
 S BPSCLOSE("CLOSE AFT REV")=0,BPSCLOSE("CLOSE AFT REV REASON")="",BPSCLOSE("CLOSE AFT REV COMMENT")=""
"RTN","BPSSCRRV",149,0)
 W !,"Do you want to mark the claim as non-billable in Claims Tracking and release the Patient Copay (if any)"
"RTN","BPSSCRRV",150,0)
 S BPQ=$$YESNO^BPSSCRRS("(Yes/No)") I BPQ<1 Q
"RTN","BPSSCRRV",151,0)
 S BPSCLOSE("CLOSE AFT REV")=BPQ
"RTN","BPSSCRRV",152,0)
 S BPREAZ=$$REASON^BPSSCRCL() I BPREAZ="^" S BPQ="-1" Q
"RTN","BPSSCRRV",153,0)
 S BPSCLOSE("CLOSE AFT REV REASON")=+$P(BPREAZ,U)
"RTN","BPSSCRRV",154,0)
 S BPCMT=$$COMMENT^BPSSCRCL("Comment ",40) I BPCMT="^" S BPQ="-1" Q
"RTN","BPSSCRRV",155,0)
 S BPSCLOSE("CLOSE AFT REV COMMENT")=BPCMT
"RTN","BPSSCRRV",156,0)
 S BPQ=$$YESNO^BPSSCRRS("Are you sure?(Y/N)")
"RTN","BPSSCRRV",157,0)
 I BPQ<1 S BPSCLOSE("CLOSE AFT REV")=0,BPSCLOSE("CLOSE AFT REV REASON")="",BPSCLOSE("CLOSE AFT REV COMMENT")="",BPQ="-1" Q
"RTN","BPSSCRRV",158,0)
 W !,"If the reversal is approved by the third-party payer, the claim will be marked as non-billable.",!
"RTN","BPSSCRRV",159,0)
 Q
"RTN","BPSSCRRV",160,0)
 ;
"RTN","BPSSCRRV",161,0)
PAUSE() ;
"RTN","BPSSCRRV",162,0)
 N X
"RTN","BPSSCRRV",163,0)
 W ! S DIR(0)="E" D ^DIR K DIR W !
"RTN","BPSSCRRV",164,0)
 Q X
"RTN","BPSSCRRV",165,0)
 ;
"RTN","BPSSCRSL")
0^33^B14489161
"RTN","BPSSCRSL",1,0)
BPSSCRSL ;BHAM ISC/SS - ECME SCREEN SORT LIST ;05-APR-05
"RTN","BPSSCRSL",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,7**;JUN 2004;Build 46
"RTN","BPSSCRSL",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSSCRSL",4,0)
 ;USER SCREEN
"RTN","BPSSCRSL",5,0)
 ;
"RTN","BPSSCRSL",6,0)
 ;This software is using PARAMETER TOOLS (see XT*7.3*26) to store user's settings:
"RTN","BPSSCRSL",7,0)
 ;PARAMETER DEFINITION NAME="BPS USRSCR" (file #8989.51, IA# 2263)
"RTN","BPSSCRSL",8,0)
 ;ENTITY is "USR" , i.e. IEN in ^VA(200  -- see definition for "BPS USRSCR"
"RTN","BPSSCRSL",9,0)
 ;INSTANCEs are as follows:
"RTN","BPSSCRSL",10,0)
 ;1.01 ONE/ALL USERS --'U' ONE USER, 'A' ALL; Display claims for ONE or ALL users 
"RTN","BPSSCRSL",11,0)
 ;1.02 ONE/ALL PATIENTS --'P' FOR ONE PATIENT; 'A' FOR ALL; Display claims for ONE/ALL PATIENTS 
"RTN","BPSSCRSL",12,0)
 ;1.03 ONE/ALL RX --'R' FOR ONE RX; 'A' FOR ALL; Display claims for ONE or ALL RX 
"RTN","BPSSCRSL",13,0)
 ;1.04 HOURS/DAYS -- 'D' FOR DAYS; 'H' FOR HOURS; Use HOURS or DAYS to specify timeframe 
"RTN","BPSSCRSL",14,0)
 ;1.05 TIMEFRAME -- NUMBER Depends on the value of the field "USR SCR HOURS/DAYS" this field will
"RTN","BPSSCRSL",15,0)
 ;store the default number of HOURS from NOW or DAYS from TODAY to select claims to display 
"RTN","BPSSCRSL",16,0)
 ;1.06 REJECTED/PAYABLE --'R' FOR REJECTS; 'P' FOR PAYABLES 'A' FOR ALL; Display Rejects or Payables or ALL claims 
"RTN","BPSSCRSL",17,0)
 ;1.07 RELEASED/NOT RELEASED --'R' FOR RELEASED; 'N' FOR NON-RELEASED; 'A' FOR ALL; Display Released Rxs or Non-Released Rxs or ALL 
"RTN","BPSSCRSL",18,0)
 ;1.08 CMOP/MAIL/WINDOW --'C' FOR CMOP; 'M' FOR MAIL;'W' FOR WINDOW;'A' FOR ALL; Display CMOP or Mail or Window or ALL Rxs 
"RTN","BPSSCRSL",19,0)
 ;1.09 REALTIME/BACKBILL --'R' FOR REALTIME; 'B' FOR BACKBILLS; 'A' FOR ALL; Display RealTime Fills or Backbills or ALL 
"RTN","BPSSCRSL",20,0)
 ;1.1 REJECT CODE/ALL --'R' FOR REJECT CODE; 'A' FOR ALL; Display Specific Reject Code or ALL Reject
"RTN","BPSSCRSL",21,0)
 ;Codes 0 means ALL Reject Codes otherwise - Reject Code value 
"RTN","BPSSCRSL",22,0)
 ;1.11 SPECIFIC/ALL INSURANCES --'I' FOR SPECIFIC INSURANCE(S);'A' FOR ALL; Display Specific Insurance Company(s) or All null - ALL otherwise - pointer to INSURANCE COMPANY file #36 
"RTN","BPSSCRSL",23,0)
 ;1.12 SORT LIST --'T' FOR TRANSACTION DATE;'D' FOR DIVISION; 'I' FOR INSURANCE; 'C' FOR REJECT CODE; 
"RTN","BPSSCRSL",24,0)
 ;'P' FOR PATIENT NAME -- 'N' FOR DRUG NAME; 'B' FOR BILL TYPE (BB/RT); 'L' FOR FILL LOCATION;
"RTN","BPSSCRSL",25,0)
 ;'R' FOR RELEASED/NON-RELEASED -- 'A' FOR ACTIVE/DISCONTINUED; the field used to sort claims in the list 
"RTN","BPSSCRSL",26,0)
 ;1.13 ALL ECME PHARMACY DIVISIONS --'D' FOR DIVISION; 'A' FOR ALL; 
"RTN","BPSSCRSL",27,0)
 ;1.14 SELECTED INSURANCE -- Single, or multiple, insurance(s) to select claims for the User Screen, to store INSURANCE COMPANY pointer (#36) 
"RTN","BPSSCRSL",28,0)
 ;1.15 SELECTED REJECTED CODE --POINTER TO BPS NCPDP REJECT CODES FILE (#9002313.93) Reject code selected by the user to filter claims.
"RTN","BPSSCRSL",29,0)
 ;1.16 SELECTED USER -- POINTER TO NEW PERSON FILE (#200) Selected user for the user screen 
"RTN","BPSSCRSL",30,0)
 ;1.17 SELECTED PATIENT -- POINTER TO PATIENT FILE (#2) Selected patient for the User Screen 
"RTN","BPSSCRSL",31,0)
 ;1.18 SELECTED RX -- POINTER TO PRESCRIPTION FILE (#52) Selected RX 
"RTN","BPSSCRSL",32,0)
 ;2    ECME PHARMACY DIVISION -- the list of POINTERs TO BPS PHARMACIES FILE (#9002313.56) separated by "^"
"RTN","BPSSCRSL",33,0)
 ;2.01 ELIGIBILITY TYPE --'V' FOR VETERAN;'T' FOR TRICARE;'A' FOR ALL; Display claims for specific Eligibility Type or ALL 
"RTN","BPSSCRSL",34,0)
 ;2.02 OPEN/CLOSED/ALL --'O' OPEN CLAIMS;'C' CLOSED CLAIMS;'A' FOR ALL; Display Open, Closed, or ALL claims 
"RTN","BPSSCRSL",35,0)
 ;2.03 SUBMISSION TYPE --'B' BILLING REQUESTS;'R' REVERSALS;'A' FOR ALL; Display specific submission type claims or ALL 
"RTN","BPSSCRSL",36,0)
 ;2.04 INSURANCES -- List of POINTERs to the INSURANCE COMPANY FILE (#36) separated by ";"
"RTN","BPSSCRSL",37,0)
 ;should start and end with ";", example: ";4;5;"
"RTN","BPSSCRSL",38,0)
 ;
"RTN","BPSSCRSL",39,0)
 ;NOTE: use D ^XPAREDIT to add/edit values
"RTN","BPSSCRSL",40,0)
 ;
"RTN","BPSSCRSL",41,0)
 ;*****
"RTN","BPSSCRSL",42,0)
SL ;
"RTN","BPSSCRSL",43,0)
 D FULL^VALM1
"RTN","BPSSCRSL",44,0)
 W @IOF
"RTN","BPSSCRSL",45,0)
 K BPARR
"RTN","BPSSCRSL",46,0)
 I +$G(DUZ)=0 D ERRMSG^BPSSCRCV("Unknown User") Q
"RTN","BPSSCRSL",47,0)
 N BPDUZ7
"RTN","BPSSCRSL",48,0)
 S BPDUZ7=+DUZ
"RTN","BPSSCRSL",49,0)
 ;always get current profile from the file
"RTN","BPSSCRSL",50,0)
 ;D READPRFP(.BPARR,+DUZ)
"RTN","BPSSCRSL",51,0)
 D READPROF(.BPARR,+BPDUZ7)
"RTN","BPSSCRSL",52,0)
 D SAVEVIEW^BPSSCR01(.BPARR)
"RTN","BPSSCRSL",53,0)
 ;edit current profile
"RTN","BPSSCRSL",54,0)
 D EDITPROF(.BPARR,.BPDUZ7)
"RTN","BPSSCRSL",55,0)
 D SAVEVIEW^BPSSCR01(.BPARR)
"RTN","BPSSCRSL",56,0)
 ;save it if necessary only for SORT LIST field
"RTN","BPSSCRSL",57,0)
 ;(so we used a separate array for this and save it only)
"RTN","BPSSCRSL",58,0)
 N BPSRT S BPSRT(1.12)=BPARR(1.12)
"RTN","BPSSCRSL",59,0)
 D ENDEDIT(.BPSRT,+BPDUZ7)
"RTN","BPSSCRSL",60,0)
 D SAVEVIEW^BPSSCR01(.BPARR)
"RTN","BPSSCRSL",61,0)
 ;redraw screen
"RTN","BPSSCRSL",62,0)
 D REDRAW^BPSSCRUD("Updating screen...")
"RTN","BPSSCRSL",63,0)
 Q
"RTN","BPSSCRSL",64,0)
 ;
"RTN","BPSSCRSL",65,0)
 ;input:
"RTN","BPSSCRSL",66,0)
 ;BPARRAY - array that all settings:  
"RTN","BPSSCRSL",67,0)
 ;   in the form BPARRAY(instance in "BPS USRSCR" parameter tool entry) = value
"RTN","BPSSCRSL",68,0)
 ;BPDUZ7 - DUZ
"RTN","BPSSCRSL",69,0)
EDITPROF(BPARR,BPDUZ7) ;
"RTN","BPSSCRSL",70,0)
 N BP1
"RTN","BPSSCRSL",71,0)
 N BPRET
"RTN","BPSSCRSL",72,0)
 N BPSTR
"RTN","BPSSCRSL",73,0)
 S BPSTR="S^T:TRANSACTION DATE;D:DIVISION;I:INSURANCE;C:REJECT CODE;P:PATIENT NAME;N:DRUG NAME;B:BILL TYPE (BB/RT);L:FILL LOCATION;R:RELEASED/NON-RELEASED;A:ACTIVE/DISCONTINUED"
"RTN","BPSSCRSL",74,0)
 I $$EDITFLD^BPSSCRCV(1.12,+BPDUZ7,BPSTR,"ENTER SORT TYPE","TRANSACTION DATE",.BPARR)=-1 S BPDUZ7=0 Q
"RTN","BPSSCRSL",75,0)
 Q
"RTN","BPSSCRSL",76,0)
 ;
"RTN","BPSSCRSL",77,0)
 ;input:
"RTN","BPSSCRSL",78,0)
 ;BPARRAY - array that all settings:  
"RTN","BPSSCRSL",79,0)
 ;in the form BPARRAY(instance in "BPS USRSCR" parameter tool entry) = value
"RTN","BPSSCRSL",80,0)
 ;BPDUZ7 - DUZ
"RTN","BPSSCRSL",81,0)
 ;
"RTN","BPSSCRSL",82,0)
ENDEDIT(BPARRAY,BPDUZ7) ;
"RTN","BPSSCRSL",83,0)
 I $$PROMPT^BPSSCRCV("S^Y:YES;N:NO","DO YOU WANT TO SAVE THIS VIEW AS YOUR PREFERRED VIEW (Y/N)?","")="Y" D
"RTN","BPSSCRSL",84,0)
 . D FILEALL^BPSSCRCV(.BPARRAY,BPDUZ7)
"RTN","BPSSCRSL",85,0)
 Q
"RTN","BPSSCRSL",86,0)
 ;read profile information (used in other routines as well)
"RTN","BPSSCRSL",87,0)
 ;input:
"RTN","BPSSCRSL",88,0)
 ;BPDUZ7 - DUZ
"RTN","BPSSCRSL",89,0)
 ;input/output:
"RTN","BPSSCRSL",90,0)
 ;BPARRAY - to return back profile information, as reference
"RTN","BPSSCRSL",91,0)
 ;see description in the top of the routine
"RTN","BPSSCRSL",92,0)
READPROF(BPARRAY,BPDUZ7) ;
"RTN","BPSSCRSL",93,0)
 N RETV,RETARR,BPFLDNO,BPDIV,BP1
"RTN","BPSSCRSL",94,0)
 N RECIENS
"RTN","BPSSCRSL",95,0)
 S RECIENS=BPDUZ7_","
"RTN","BPSSCRSL",96,0)
 F BPFLDNO=1.01,1.02,1.03,1.04,1.05,1.06,1.07,1.08,1.09,1.1,1.11,1.12,1.13,1.14,1.15,1.16,1.17,1.18,2.01,2.02,2.03,2.04 D
"RTN","BPSSCRSL",97,0)
 . S RETV=$$GETPARAM(BPFLDNO,+BPDUZ7)
"RTN","BPSSCRSL",98,0)
 . S BPARRAY(BPFLDNO)=RETV
"RTN","BPSSCRSL",99,0)
 I BPARRAY(1.13)="D" D
"RTN","BPSSCRSL",100,0)
 . S BPARRAY("DIVS")=$$GETPARAM(2,+BPDUZ7)
"RTN","BPSSCRSL",101,0)
 I BPARRAY(1.11)="I" D
"RTN","BPSSCRSL",102,0)
 . S BPARRAY("INS")=$$GETPARAM(2.04,+BPDUZ7)
"RTN","BPSSCRSL",103,0)
 Q
"RTN","BPSSCRSL",104,0)
 ;
"RTN","BPSSCRSL",105,0)
SORTTYPE(BPSTYPE) ;
"RTN","BPSSCRSL",106,0)
 Q:(BPSTYPE="T") "Transaction Date"
"RTN","BPSSCRSL",107,0)
 Q:(BPSTYPE="D") "ECME division"
"RTN","BPSSCRSL",108,0)
 Q:(BPSTYPE="I") "Insurance"
"RTN","BPSSCRSL",109,0)
 Q:(BPSTYPE="C") "Reject Code"
"RTN","BPSSCRSL",110,0)
 Q:(BPSTYPE="P") "Patient Name"
"RTN","BPSSCRSL",111,0)
 Q:(BPSTYPE="N") "Drug Name"
"RTN","BPSSCRSL",112,0)
 Q:(BPSTYPE="B") "Claim's Origin (BB/RT)"
"RTN","BPSSCRSL",113,0)
 Q:(BPSTYPE="L") "Fill Location"
"RTN","BPSSCRSL",114,0)
 Q:(BPSTYPE="R") "Released/Non-released"
"RTN","BPSSCRSL",115,0)
 Q:(BPSTYPE="A") "Active/Discontinued"
"RTN","BPSSCRSL",116,0)
 Q ""
"RTN","BPSSCRSL",117,0)
 ;
"RTN","BPSSCRSL",118,0)
 ;
"RTN","BPSSCRSL",119,0)
GETPARAM(BPFLDNO,BPDUZ) ;
"RTN","BPSSCRSL",120,0)
 Q $$GET^XPAR(BPDUZ_";VA(200,","BPS USRSCR",BPFLDNO,"I")
"RTN","BPSSCRSL",121,0)
 ;
"RTN","BPSSCRSL",122,0)
 ;save value of the parameter
"RTN","BPSSCRSL",123,0)
SAVEPAR(BPFLDNO,BPDUZ,BPVAL) ;
"RTN","BPSSCRSL",124,0)
 D EN^XPAR(BPDUZ_";VA(200,","BPS USRSCR",BPFLDNO,BPVAL,.BPERR)
"RTN","BPSSCRSL",125,0)
 I BPERR'="0" W !,BPERR,! Q 0
"RTN","BPSSCRSL",126,0)
 Q 1
"RTN","BPSSCRSL",127,0)
 ;
"RTN","BPSSCRU3")
0^15^B30240821
"RTN","BPSSCRU3",1,0)
BPSSCRU3 ;BHAM ISC/SS - ECME SCREEN UTILITIES ;05-APR-05
"RTN","BPSSCRU3",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5,7**;JUN 2004;Build 46
"RTN","BPSSCRU3",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSSCRU3",4,0)
 ;USER SCREEN
"RTN","BPSSCRU3",5,0)
 Q
"RTN","BPSSCRU3",6,0)
 ;get comment from BPS TRANSACTION file
"RTN","BPSSCRU3",7,0)
 ;BP59 - ien in that file
"RTN","BPSSCRU3",8,0)
COMMENT(BP59) ;
"RTN","BPSSCRU3",9,0)
 N BPCMNT,BPX
"RTN","BPSSCRU3",10,0)
 S BPCMNT=$O(^BPST(BP59,11,999999),-1)
"RTN","BPSSCRU3",11,0)
 I BPCMNT="" Q ""
"RTN","BPSSCRU3",12,0)
 S BPX=$G(^BPST(BP59,11,BPCMNT,0))
"RTN","BPSSCRU3",13,0)
 Q $$DATTIM($P(BPX,U,1)\1)_" - "_$P(BPX,U,3)_U_$$USERNAM^BPSCMT01($P(BPX,U,2))
"RTN","BPSSCRU3",14,0)
 ;
"RTN","BPSSCRU3",15,0)
DATTIM(X) ;Convert FM date to displayable (mm/dd/yy HH:MM) format.
"RTN","BPSSCRU3",16,0)
 I +X=0 W ""
"RTN","BPSSCRU3",17,0)
 N DATE,YR,BPT,BPM,BPH,BPAP
"RTN","BPSSCRU3",18,0)
 I $G(X) S YR=$E(X,2,3)
"RTN","BPSSCRU3",19,0)
 I $G(X) S DATE=$S(X:$E(X,4,5)_"/"_$E(X,6,7)_"/"_YR,1:"")
"RTN","BPSSCRU3",20,0)
 S BPT=$P(X,".",2) S:$L(BPT)<4 BPT=BPT_$E("0000",1,4-$L(BPT))
"RTN","BPSSCRU3",21,0)
 S BPH=$E(BPT,1,2),BPM=$E(BPT,3,4)
"RTN","BPSSCRU3",22,0)
 S BPAP="a" I BPH>12 S BPH=BPH-12,BPAP="p" S:$L(BPH)<2 BPH="0"_BPH
"RTN","BPSSCRU3",23,0)
 I BPT S:'BPH BPH=12 S DATE=DATE_" "_BPH_":"_BPM_BPAP
"RTN","BPSSCRU3",24,0)
 Q $G(DATE)
"RTN","BPSSCRU3",25,0)
 ;/**
"RTN","BPSSCRU3",26,0)
 ;a wrapper for $$STATUS^BPSOSRX to get the status by BPS TRANSACTION pointer
"RTN","BPSSCRU3",27,0)
 ;input BP59 - ptr to 9002313.59
"RTN","BPSSCRU3",28,0)
 ;output - pieces 1,2 and 3 of the $$STATUS^BPSOSRX output
"RTN","BPSSCRU3",29,0)
 ; example: "E REVERSAL ACCEPTED^3071206.152829^Reversal Accepted"
"RTN","BPSSCRU3",30,0)
CLAIMST(BP59) ;*/
"RTN","BPSSCRU3",31,0)
 N BPX,BPSTATUS,BPREF,BPSCHED
"RTN","BPSSCRU3",32,0)
 S BPSCHED=0
"RTN","BPSSCRU3",33,0)
 S BPX=$$RXREF^BPSSCRU2(BP59)
"RTN","BPSSCRU3",34,0)
 S BPREF=$P(BPX,U,2)
"RTN","BPSSCRU3",35,0)
 S BPSTATUS=$$STATUS^BPSOSRX(+BPX,BPREF)
"RTN","BPSSCRU3",36,0)
 ;if the request completed (99%) and there is another active (scheduled, activated, 
"RTN","BPSSCRU3",37,0)
 ;in process,completed but not inactivated yet) request then return IN PROGRESS
"RTN","BPSSCRU3",38,0)
 I $P(BPSTATUS,U,4)=99,$$ACTREQS^BPSOSRX6(+BPX,BPREF) S BPSCHED=1
"RTN","BPSSCRU3",39,0)
 I BPSCHED I ($P(BPSTATUS,U)="E PAYABLE")!($P(BPSTATUS,U)="E REVERSAL ACCEPTED") Q "IN PROGRESS"_U_$P(BPSTATUS,U,2)
"RTN","BPSSCRU3",40,0)
 Q $P(BPSTATUS,U,1,3)
"RTN","BPSSCRU3",41,0)
 ;
"RTN","BPSSCRU3",42,0)
 ;/**
"RTN","BPSSCRU3",43,0)
 ;pointers for RESPONSE file (#9002313.03) by pointer in TRANSACTION file #9002313.59
"RTN","BPSSCRU3",44,0)
 ;B59 - ptr to #9002313.59
"RTN","BPSSCRU3",45,0)
 ;BPRESP - ptr to #9002313.03
"RTN","BPSSCRU3",46,0)
 ;BPPOS - position inside #9002313.03 (i.e. the number 
"RTN","BPSSCRU3",47,0)
 ;of the claim in the transmission - currently we always have only 1
"RTN","BPSSCRU3",48,0)
GRESPPOS(BP59,BPRESP,BPPOS) ;*/
"RTN","BPSSCRU3",49,0)
 I $G(^BPST(BP59,4)) D  ; reversal kind of message
"RTN","BPSSCRU3",50,0)
 . S BPRESP=+$P(^BPST(BP59,4),U,2)
"RTN","BPSSCRU3",51,0)
 . S BPPOS=1
"RTN","BPSSCRU3",52,0)
 E  D
"RTN","BPSSCRU3",53,0)
 . S BPRESP=+$P($G(^BPST(BP59,0)),U,5)
"RTN","BPSSCRU3",54,0)
 . S BPPOS=+$P($G(^BPST(BP59,0)),U,9)
"RTN","BPSSCRU3",55,0)
 Q:+BPRESP=0 0
"RTN","BPSSCRU3",56,0)
 Q:+BPPOS=0 0
"RTN","BPSSCRU3",57,0)
 Q 1
"RTN","BPSSCRU3",58,0)
 ;
"RTN","BPSSCRU3",59,0)
 ;/**
"RTN","BPSSCRU3",60,0)
 ;reject message from RESPONSE file
"RTN","BPSSCRU3",61,0)
 ;BP59 - ptr to 9002313.59
"RTN","BPSSCRU3",62,0)
 ;BPTOP - top level index (for exmpl "504" for ^BPSR(D0,504)= (#504) Message [1F]
"RTN","BPSSCRU3",63,0)
 ;BPDEEP - lower level (for exmpl BPTOP=1000 and BPDEEP=525 for  
"RTN","BPSSCRU3",64,0)
 ;  ^BPSR(D0,1000,D1,525)= (#525) DUR Response Data [1F]
"RTN","BPSSCRU3",65,0)
 ;
"RTN","BPSSCRU3",66,0)
GETMESS(BPTOP,BPDEEP,BP59) ;
"RTN","BPSSCRU3",67,0)
 N BP59DAT,BPRESP,BPPOS
"RTN","BPSSCRU3",68,0)
 N BP1
"RTN","BPSSCRU3",69,0)
 ;S (BPRESP,BPPOS)=0
"RTN","BPSSCRU3",70,0)
 ;get response and position in the BPS RESPONSE file
"RTN","BPSSCRU3",71,0)
 I $$GRESPPOS(BP59,.BPRESP,.BPPOS)=0 Q ""
"RTN","BPSSCRU3",72,0)
 ; -------- transmission specific message ----------
"RTN","BPSSCRU3",73,0)
 I BPTOP=504 Q $P($G(^BPSR(BPRESP,504)),U)
"RTN","BPSSCRU3",74,0)
 ;
"RTN","BPSSCRU3",75,0)
 ; -------claim specific message-----------
"RTN","BPSSCRU3",76,0)
 ;assuming there is only one claim/response per transmission
"RTN","BPSSCRU3",77,0)
 S BP1=$O(^BPSR(BPRESP,BPTOP,0))
"RTN","BPSSCRU3",78,0)
 I BP1=0 Q ""
"RTN","BPSSCRU3",79,0)
 ;---525: DUR
"RTN","BPSSCRU3",80,0)
 ;---526: Additional Message Information
"RTN","BPSSCRU3",81,0)
 ;---504: Message for the claim
"RTN","BPSSCRU3",82,0)
 I (BPDEEP=525)!(BPDEEP=526)!(BPDEEP=504) Q $P($G(^BPSR(BPRESP,1000,BPPOS,BPDEEP)),U)
"RTN","BPSSCRU3",83,0)
 Q ""
"RTN","BPSSCRU3",84,0)
 ;
"RTN","BPSSCRU3",85,0)
 ;reject message from RESPONSE file
"RTN","BPSSCRU3",86,0)
 ;BP59 - ptr to 9002313.59
"RTN","BPSSCRU3",87,0)
 ;BPARR1 - array to return messages (by ref)
"RTN","BPSSCRU3",88,0)
 ;BPN1 - index for the array (by ref - will 
"RTN","BPSSCRU3",89,0)
 ;  be incremented if more than one node added)
"RTN","BPSSCRU3",90,0)
 ;BPMLEN - max length for each string
"RTN","BPSSCRU3",91,0)
 ;PBPREF - for prefix string
"RTN","BPSSCRU3",92,0)
 ;. D GETMESS^BPSSCRU3(1000,504,BP59,.BPARR,.BPN,50)
"RTN","BPSSCRU3",93,0)
 ;compare GETRJCOD from BPSSCRu2
"RTN","BPSSCRU3",94,0)
GETRJCOD(BP59,BPARR1,BPN1,BPMLEN,PBPREF) ;
"RTN","BPSSCRU3",95,0)
 N BP59DAT S BP59DAT=$G(^BPST(BP59,0))
"RTN","BPSSCRU3",96,0)
 N BPRESP,BPPOS
"RTN","BPSSCRU3",97,0)
 N BPRJCOD
"RTN","BPSSCRU3",98,0)
 N BPRJTXT
"RTN","BPSSCRU3",99,0)
 N BPSTR
"RTN","BPSSCRU3",100,0)
 N BPRJ
"RTN","BPSSCRU3",101,0)
 ;pointers for RESPONSE file (#9002313.03) by pointer in TRANSACTION file #9002313.59
"RTN","BPSSCRU3",102,0)
 ;get response and position 
"RTN","BPSSCRU3",103,0)
 I $$GRESPPOS(BP59,.BPRESP,.BPPOS)=0 Q
"RTN","BPSSCRU3",104,0)
 S BPRJ=0
"RTN","BPSSCRU3",105,0)
 S BPSTR=""
"RTN","BPSSCRU3",106,0)
 F  S BPRJ=$O(^BPSR(BPRESP,1000,BPPOS,511,BPRJ)) Q:+BPRJ=0  D
"RTN","BPSSCRU3",107,0)
 . S BPRJCOD=$P($G(^BPSR(BPRESP,1000,BPPOS,511,BPRJ,0)),U)
"RTN","BPSSCRU3",108,0)
 . Q:$L(BPRJCOD)=0
"RTN","BPSSCRU3",109,0)
 . S BPRJTXT=$$GETRJNAM(BPRJCOD)
"RTN","BPSSCRU3",110,0)
 . S BPN1=BPN1+1,BPARR1(BPN1)=PBPREF_BPRJTXT
"RTN","BPSSCRU3",111,0)
 Q BPN1
"RTN","BPSSCRU3",112,0)
 ;/**
"RTN","BPSSCRU3",113,0)
 ;Input:
"RTN","BPSSCRU3",114,0)
 ; BP59 - pointer to file #9002313.59
"RTN","BPSSCRU3",115,0)
 ;Output:
"RTN","BPSSCRU3",116,0)
 ; BPRCODES - array for reject codes by reference
"RTN","BPSSCRU3",117,0)
REJCODES(BP59,BPRCODES) ;get reject codes
"RTN","BPSSCRU3",118,0)
 N BPRESP,BPPOS,BPA,BPR
"RTN","BPSSCRU3",119,0)
 ;pointers for RESPONSE file (#9002313.03) by pointer in TRANSACTION file #9002313.59
"RTN","BPSSCRU3",120,0)
 ;get response and position
"RTN","BPSSCRU3",121,0)
 I $$GRESPPOS(BP59,.BPRESP,.BPPOS)=0 Q
"RTN","BPSSCRU3",122,0)
 ;
"RTN","BPSSCRU3",123,0)
 S BPA=0
"RTN","BPSSCRU3",124,0)
 F  S BPA=$O(^BPSR(BPRESP,1000,BPPOS,511,BPA)) Q:'BPA  D
"RTN","BPSSCRU3",125,0)
 . S BPR=$P(^BPSR(BPRESP,1000,BPPOS,511,BPA,0),U)
"RTN","BPSSCRU3",126,0)
 . I BPR'="" S BPRCODES(BPR)=""
"RTN","BPSSCRU3",127,0)
 Q
"RTN","BPSSCRU3",128,0)
 ;/**
"RTN","BPSSCRU3",129,0)
 ;BPRJCODE - code
"RTN","BPSSCRU3",130,0)
GETRJNAM(BPRJCODE) ;*/
"RTN","BPSSCRU3",131,0)
 N BPRJIEN
"RTN","BPSSCRU3",132,0)
 S BPRJIEN=$O(^BPSF(9002313.93,"B",BPRJCODE,0))
"RTN","BPSSCRU3",133,0)
 Q:+BPRJIEN=0 ""
"RTN","BPSSCRU3",134,0)
 Q BPRJCODE_":"_$P($G(^BPSF(9002313.93,BPRJIEN,0)),U,2)
"RTN","BPSSCRU3",135,0)
 ;/**
"RTN","BPSSCRU3",136,0)
 ;BP59 - ptr to 9002313.59
"RTN","BPSSCRU3",137,0)
 ;was the claim ever autoreversed ?
"RTN","BPSSCRU3",138,0)
AUTOREV(BP59) ;*/
"RTN","BPSSCRU3",139,0)
 N BP02
"RTN","BPSSCRU3",140,0)
 S BP02=+$P($G(^BPST(BP59,0)),U,4)
"RTN","BPSSCRU3",141,0)
 Q +$P($G(^BPSC(BP02,0)),U,7)
"RTN","BPSSCRU3",142,0)
 ;
"RTN","BPSSCRU3",143,0)
 ;/**
"RTN","BPSSCRU3",144,0)
 ;BP59 - ptr to 9002313.59
"RTN","BPSSCRU3",145,0)
 ;returns :
"RTN","BPSSCRU3",146,0)
 ;0 Waiting to start
"RTN","BPSSCRU3",147,0)
 ;10 Gathering claim info
"RTN","BPSSCRU3",148,0)
 ;19 Special Grouping
"RTN","BPSSCRU3",149,0)
 ;30 Waiting for packet build
"RTN","BPSSCRU3",150,0)
 ;31 Wait for retry (insurer asleep)
"RTN","BPSSCRU3",151,0)
 ;40 Packet being built
"RTN","BPSSCRU3",152,0)
 ;50 Waiting for transmit
"RTN","BPSSCRU3",153,0)
 ;51 Wait for retry (comms error)
"RTN","BPSSCRU3",154,0)
 ;60 Transmitting
"RTN","BPSSCRU3",155,0)
 ;70 Receiving Response
"RTN","BPSSCRU3",156,0)
 ;80 Waiting to process response
"RTN","BPSSCRU3",157,0)
 ;90 Processing response
"RTN","BPSSCRU3",158,0)
 ;99 Done
"RTN","BPSSCRU3",159,0)
 ;
"RTN","BPSSCRU3",160,0)
PRCNTG(BP59) ;*/
"RTN","BPSSCRU3",161,0)
 Q +$P($G(^BPST(BP59,0)),U,2)
"RTN","BPSSCRU3",162,0)
 ;
"RTN","BPSSCRU3",163,0)
 ;
"RTN","BPSSCRU3",164,0)
LINE(BPN,BPCH) ;
"RTN","BPSSCRU3",165,0)
 N BP1
"RTN","BPSSCRU3",166,0)
 S $P(BP1,BPCH,BPN+1)=""
"RTN","BPSSCRU3",167,0)
 Q BP1
"RTN","BPSSCRU3",168,0)
 ;
"RTN","BPSSCRU3",169,0)
DTTIME(X) ;Convert FM date to displayable (mm/dd/yy HH:MM) format.
"RTN","BPSSCRU3",170,0)
 I +X=0 W ""
"RTN","BPSSCRU3",171,0)
 N DATE,YR,BPT,BPM,BPH,BPAP,BPS
"RTN","BPSSCRU3",172,0)
 I $G(X) S YR=$E(X,1,3)+1700
"RTN","BPSSCRU3",173,0)
 I $G(X) S DATE=$S(X:$E(X,4,5)_"/"_$E(X,6,7)_"/"_YR,1:"")
"RTN","BPSSCRU3",174,0)
 S BPT=$P(X,".",2)
"RTN","BPSSCRU3",175,0)
 I BPT S:$L(BPT)<6 BPT=BPT_$E("000000",1,6-$L(BPT))
"RTN","BPSSCRU3",176,0)
 S BPH=$E(BPT,1,2),BPM=$E(BPT,3,4),BPS=$E(BPT,5,6)
"RTN","BPSSCRU3",177,0)
 I BPT S DATE=DATE_"@"_BPH_":"_BPM_":"_BPS
"RTN","BPSSCRU3",178,0)
 Q $G(DATE)
"RTN","BPSSCRU3",179,0)
 ;
"RTN","BPSSCRU3",180,0)
 ;call IB API to get insurance data, then select proper insurance by its name
"RTN","BPSSCRU3",181,0)
 ;get its phone number
"RTN","BPSSCRU3",182,0)
 ;input: 
"RTN","BPSSCRU3",183,0)
 ; DFN - patient IEN in #2
"RTN","BPSSCRU3",184,0)
 ; BPDOS - date of service
"RTN","BPSSCRU3",185,0)
 ; BPINSNM - insurance name
"RTN","BPSSCRU3",186,0)
 ;output: insurance ien^insurance name^phone
"RTN","BPSSCRU3",187,0)
GETPHONE(BPDFN,BPDOS,BPINSNM) ;
"RTN","BPSSCRU3",188,0)
 N BPX,BPZZ,BP1,BPPHONE
"RTN","BPSSCRU3",189,0)
 S BPPHONE=""
"RTN","BPSSCRU3",190,0)
 I $$INSUR^IBBAPI(BPDFN,BPDOS,,.BPZZ,"1,6")'=1 Q ""
"RTN","BPSSCRU3",191,0)
 S BP1="" F  S BP1=$O(BPZZ("IBBAPI","INSUR",BP1)) Q:+BP1=0  D
"RTN","BPSSCRU3",192,0)
 . I BPINSNM=$P($G(BPZZ("IBBAPI","INSUR",BP1,1)),U,2) S BPPHONE=$G(BPZZ("IBBAPI","INSUR",BP1,6)) Q
"RTN","BPSSCRU3",193,0)
 Q BPPHONE
"RTN","BPSSCRU3",194,0)
 ;
"RTN","BPSSCRU3",195,0)
 ;try to get insurance name and phone from #9002313.59, #9002313.57 and from INSUR^IBBAPI 
"RTN","BPSSCRU3",196,0)
 ;input: BP59 - ien in #9002313.59
"RTN","BPSSCRU3",197,0)
 ;return insurance_name^phone#
"RTN","BPSSCRU3",198,0)
NAMEPHON(BP59) ;
"RTN","BPSSCRU3",199,0)
 N BPHONE,BPINSNM,BPINSID,BP57,BPINSN
"RTN","BPSSCRU3",200,0)
 S BPHONE=$P($G(^BPST(BP59,10,+$G(^BPST(BP59,9)),3)),U,2)
"RTN","BPSSCRU3",201,0)
 S BPINSNM=$P($G(^BPST(BP59,10,+$G(^BPST(BP59,9)),0)),U,7)
"RTN","BPSSCRU3",202,0)
 S BP57=0
"RTN","BPSSCRU3",203,0)
 F  Q:(BPHONE'="")&(BPINSNM'="")  S BP57=$O(^BPSTL("B",BP59,BP57)) Q:+BP57=0  D
"RTN","BPSSCRU3",204,0)
 . S BPINSN=+$G(^BPSTL(BP57,9))
"RTN","BPSSCRU3",205,0)
 . S:BPHONE="" BPHONE=$P($G(^BPSTL(BP57,10,BPINSN,3)),U,2)
"RTN","BPSSCRU3",206,0)
 . S:BPINSNM="" BPINSNM=$P($G(^BPSTL(BP57,10,BPINSN,0)),U,7)
"RTN","BPSSCRU3",207,0)
 ;
"RTN","BPSSCRU3",208,0)
 I (BPINSNM'="")&(BPHONE="") D
"RTN","BPSSCRU3",209,0)
 . S BPDOS=+$P($G(^BPST(BP59,12)),U,2)\1
"RTN","BPSSCRU3",210,0)
 . I BPDOS=0 S BPDOS=+$P($G(^BPST(BP59,0)),U,8)\1
"RTN","BPSSCRU3",211,0)
 . S BPDFN=+$P($G(^BPST(BP59,0)),U,6)
"RTN","BPSSCRU3",212,0)
 . S BPHONE=$$GETPHONE(BPDFN,BPDOS,BPINSNM)
"RTN","BPSSCRU3",213,0)
 Q BPINSNM_U_BPHONE
"RTN","BPSSCRU3",214,0)
 ;
"RTN","BPSSCRU5")
0^2^B61189921
"RTN","BPSSCRU5",1,0)
BPSSCRU5 ;BHAM ISC/SS - ECME SCREEN UTILITIES ;05-APR-05
"RTN","BPSSCRU5",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5,7**;JUN 2004;Build 46
"RTN","BPSSCRU5",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSSCRU5",4,0)
 ;USER SCREEN
"RTN","BPSSCRU5",5,0)
 Q
"RTN","BPSSCRU5",6,0)
 ;
"RTN","BPSSCRU5",7,0)
DATETIME(Y) ;EP - convert fileman date.time to printable
"RTN","BPSSCRU5",8,0)
 X ^DD("DD")
"RTN","BPSSCRU5",9,0)
 Q Y
"RTN","BPSSCRU5",10,0)
 ;
"RTN","BPSSCRU5",11,0)
 ;create a history of claims and responses in #9002313.57 file 
"RTN","BPSSCRU5",12,0)
 ;record for the specified transaction in #9002313.59 file
"RTN","BPSSCRU5",13,0)
 ;input:
"RTN","BPSSCRU5",14,0)
 ; BP59 - ptr to #9002313.59
"RTN","BPSSCRU5",15,0)
 ; BPHIST - array to return results
"RTN","BPSSCRU5",16,0)
 ;output:
"RTN","BPSSCRU5",17,0)
 ; Array in BPHIST with the format:
"RTN","BPSSCRU5",18,0)
 ;  BPHIST(type,timedate,PointerToResponseClaimFile)=PointerTo#9002313.57^request type
"RTN","BPSSCRU5",19,0)
 ;  where:
"RTN","BPSSCRU5",20,0)
 ;  request type - "C" - billing request, "R" - reversal request
"RTN","BPSSCRU5",21,0)
 ;  type "C" - BPS CLAIM file, "R" - BPS RESPONSE file
"RTN","BPSSCRU5",22,0)
 ;  PointerToResponseClaimFile - pointer to 9002313.03 or 9002313.02
"RTN","BPSSCRU5",23,0)
MKHIST(BP59,BPHIST) ;
"RTN","BPSSCRU5",24,0)
 N BP57,BPLSTCLM,BPLSTRSP,BPDAT57,BP1,BPSSTDT
"RTN","BPSSCRU5",25,0)
 S BP57=0
"RTN","BPSSCRU5",26,0)
 N BPSARR02
"RTN","BPSSCRU5",27,0)
 N BPSARR03
"RTN","BPSSCRU5",28,0)
 ; -- process BPS LOG OF TRANSACTIONS file
"RTN","BPSSCRU5",29,0)
 F  S BP57=$O(^BPSTL("B",BP59,BP57)) Q:+BP57=0  D
"RTN","BPSSCRU5",30,0)
 . ;claim transmissions
"RTN","BPSSCRU5",31,0)
 . S BPDAT57(0)=$G(^BPSTL(BP57,0))
"RTN","BPSSCRU5",32,0)
 . S BPSSTDT=+$P(BPDAT57(0),U,11) ;start time
"RTN","BPSSCRU5",33,0)
 . S BPLSTCLM=+$P(BPDAT57(0),U,4) ;claim
"RTN","BPSSCRU5",34,0)
 . I BPLSTCLM>0 D
"RTN","BPSSCRU5",35,0)
 . . S BP1=+$P($G(^BPSC(BPLSTCLM,0)),U,5) ;transmitted on
"RTN","BPSSCRU5",36,0)
 . . I BP1=0 S BP1=+$P($G(^BPSC(BPLSTCLM,0)),U,6) ;rec created on
"RTN","BPSSCRU5",37,0)
 . . ;old BPS CLAIMS recs don't have dates, so use START TIME from .57 file but 
"RTN","BPSSCRU5",38,0)
 . . ;only at the very first time (using $D for this)
"RTN","BPSSCRU5",39,0)
 . . I BP1=0 I '$D(BPSARR02(BPLSTCLM)) S (BPSARR02(BPLSTCLM))=BPSSTDT,BP1=BPSSTDT
"RTN","BPSSCRU5",40,0)
 . . I BP1 I '$D(BPHIST("C",BP1,BPLSTCLM)) S BPHIST("C",BP1,BPLSTCLM)=BP57_U_"C"
"RTN","BPSSCRU5",41,0)
 . S BPLSTRSP=+$P(BPDAT57(0),U,5) ;response
"RTN","BPSSCRU5",42,0)
 . I BPLSTRSP>0 D
"RTN","BPSSCRU5",43,0)
 . . S BP1=+$P($G(^BPSR(BPLSTRSP,0)),U,2) ;received on
"RTN","BPSSCRU5",44,0)
 . . I BP1=0 I '$D(BPSARR03(BPLSTRSP)) S (BPSARR02(BPLSTCLM))=BPSSTDT,BP1=BPSSTDT
"RTN","BPSSCRU5",45,0)
 . . I BP1 I '$D(BPHIST("R",BP1,BPLSTRSP)) S BPHIST("R",BP1,BPLSTRSP)=BP57_U_"C"
"RTN","BPSSCRU5",46,0)
 . ;reversal transmissions
"RTN","BPSSCRU5",47,0)
 . S BPDAT57(4)=$G(^BPSTL(BP57,4))
"RTN","BPSSCRU5",48,0)
 . S BPLSTCLM=+$P(BPDAT57(4),U,1) ;reversal
"RTN","BPSSCRU5",49,0)
 . I BPLSTCLM>0 D
"RTN","BPSSCRU5",50,0)
 . . S BP1=+$P($G(^BPSC(BPLSTCLM,0)),U,5) ;transmitted on
"RTN","BPSSCRU5",51,0)
 . . I BP1=0 S BP1=+$P($G(^BPSC(BPLSTCLM,0)),U,6) ;rec created on
"RTN","BPSSCRU5",52,0)
 . . I BP1=0 I '$D(BPSARR02(BPLSTCLM)) S (BPSARR02(BPLSTCLM))=BPSSTDT,BP1=BPSSTDT
"RTN","BPSSCRU5",53,0)
 . . I BP1 I '$D(BPHIST("C",BP1,BPLSTCLM)) S BPHIST("C",BP1,BPLSTCLM)=BP57_U_"R"
"RTN","BPSSCRU5",54,0)
 . S BPLSTRSP=+$P(BPDAT57(4),U,2) ;reversal response
"RTN","BPSSCRU5",55,0)
 . I BPLSTRSP>0 D
"RTN","BPSSCRU5",56,0)
 . . S BP1=+$P($G(^BPSR(BPLSTRSP,0)),U,2) ;received on
"RTN","BPSSCRU5",57,0)
 . . I BP1=0 I '$D(BPSARR03(BPLSTRSP)) S (BPSARR02(BPLSTCLM))=BPSSTDT,BP1=BPSSTDT
"RTN","BPSSCRU5",58,0)
 . . I BP1 I '$D(BPHIST("R",BP1,BPLSTRSP)) S BPHIST("R",BP1,BPLSTRSP)=BP57_U_"R"
"RTN","BPSSCRU5",59,0)
 ;--------
"RTN","BPSSCRU5",60,0)
 ;sorting: pairs (send/respond) in reversed chronological order
"RTN","BPSSCRU5",61,0)
 N BPCLDT1,BPCLIEN,BPRSDT1,BPRSIEN,BPCLDT2
"RTN","BPSSCRU5",62,0)
 S BPCLDT1=0
"RTN","BPSSCRU5",63,0)
 F  S BPCLDT1=$O(BPHIST("C",BPCLDT1)) Q:BPCLDT1=""  D
"RTN","BPSSCRU5",64,0)
 . S BPCLIEN=$O(BPHIST("C",BPCLDT1,0)) Q:BPCLIEN=""  D
"RTN","BPSSCRU5",65,0)
 . . S BPCLDT2=+$O(BPHIST("C",BPCLDT1))
"RTN","BPSSCRU5",66,0)
 . . I BPCLDT2=0 S BPCLDT2=9999999
"RTN","BPSSCRU5",67,0)
 . . S BPRSDT1=BPCLDT1
"RTN","BPSSCRU5",68,0)
 . . F  S BPRSDT1=$O(BPHIST("R",BPRSDT1)) Q:BPRSDT1=""!(BPRSDT1>BPCLDT2)  D
"RTN","BPSSCRU5",69,0)
 . . . S BPRSIEN=$O(BPHIST("R",BPRSDT1,0)) Q:BPRSIEN=""  D
"RTN","BPSSCRU5",70,0)
 . . . . S BPHIST("C",BPCLDT1,BPCLIEN,"R",BPRSIEN)=BPHIST("R",BPRSDT1,BPRSIEN)
"RTN","BPSSCRU5",71,0)
 ;
"RTN","BPSSCRU5",72,0)
 Q
"RTN","BPSSCRU5",73,0)
 ;returns text for the transaction code in file #9002313.02 -- BPS CLAIMS FILE
"RTN","BPSSCRU5",74,0)
TRTYPE(BPTRCD) ;
"RTN","BPSSCRU5",75,0)
 I BPTRCD="E1" Q "Eligibility Verification"
"RTN","BPSSCRU5",76,0)
 I BPTRCD="B1" Q "REQUEST"  ;"Billing"
"RTN","BPSSCRU5",77,0)
 I BPTRCD="B2" Q "REVERSAL"  ; "Reversal"
"RTN","BPSSCRU5",78,0)
 I BPTRCD="B3" Q "Rebill"
"RTN","BPSSCRU5",79,0)
 I BPTRCD="P1" Q "P.A. Request & Billing"
"RTN","BPSSCRU5",80,0)
 I BPTRCD="P2" Q "P.A. Reversal"
"RTN","BPSSCRU5",81,0)
 I BPTRCD="P3" Q "P.A. Inquiry"
"RTN","BPSSCRU5",82,0)
 I BPTRCD="P4" Q "P.A. Request Only"
"RTN","BPSSCRU5",83,0)
 I BPTRCD="N1" Q "Information Reporting"
"RTN","BPSSCRU5",84,0)
 I BPTRCD="N2" Q "Information Reporting Reversal"
"RTN","BPSSCRU5",85,0)
 I BPTRCD="N3" Q "Information Reporting Rebill"
"RTN","BPSSCRU5",86,0)
 I BPTRCD="C1" Q "Controlled Substance Reporting"
"RTN","BPSSCRU5",87,0)
 I BPTRCD="C2" Q "Controlled Substance Reporting Reversal"
"RTN","BPSSCRU5",88,0)
 I BPTRCD="C3" Q "Controlled Substance Reporting Rebill"
"RTN","BPSSCRU5",89,0)
 Q ""
"RTN","BPSSCRU5",90,0)
 ;
"RTN","BPSSCRU5",91,0)
 ;get NDC for LOG
"RTN","BPSSCRU5",92,0)
 ;BPIEN02 - IEN in #9002313.02 file
"RTN","BPSSCRU5",93,0)
LNDC(BPIEN02) ;
"RTN","BPSSCRU5",94,0)
 N BPDAT02,BPNDC
"RTN","BPSSCRU5",95,0)
 S BPDAT02(400)=$G(^BPSC(BPIEN02,400,1,400))
"RTN","BPSSCRU5",96,0)
 S BPNDC=$E($P(BPDAT02(400),U,7),3,99)
"RTN","BPSSCRU5",97,0)
 S BPNDC=$E(BPNDC,1,5)_"-"_$E(BPNDC,6,9)_"-"_$E(BPNDC,10,11)
"RTN","BPSSCRU5",98,0)
 Q BPNDC
"RTN","BPSSCRU5",99,0)
 ;prepares array of reject codes
"RTN","BPSSCRU5",100,0)
 ; BPIEN03 - IEN in #9002313.03 file
"RTN","BPSSCRU5",101,0)
 ; BPRCODES - array to return results
"RTN","BPSSCRU5",102,0)
REJCODES(BPIEN03,BPRCODES) ;
"RTN","BPSSCRU5",103,0)
 N BPA,BPR
"RTN","BPSSCRU5",104,0)
 S BPA=0
"RTN","BPSSCRU5",105,0)
 F  S BPA=$O(^BPSR(BPIEN03,1000,1,511,BPA)) Q:'BPA  D
"RTN","BPSSCRU5",106,0)
 . S BPR=$P(^BPSR(BPIEN03,1000,1,511,BPA,0),U)
"RTN","BPSSCRU5",107,0)
 . I BPR'="" S BPRCODES(BPR)=""
"RTN","BPSSCRU5",108,0)
 Q
"RTN","BPSSCRU5",109,0)
 ;status of the response
"RTN","BPSSCRU5",110,0)
RESPSTAT(BPIEN03) ;
"RTN","BPSSCRU5",111,0)
 N BP1
"RTN","BPSSCRU5",112,0)
 S BP1=$P($G(^BPSR(BPIEN03,1000,1,110)),U,2)
"RTN","BPSSCRU5",113,0)
 Q:BP1="A" "Approved"
"RTN","BPSSCRU5",114,0)
 Q:BP1="C" "Captured"
"RTN","BPSSCRU5",115,0)
 Q:BP1="D" "Duplicate of Paid"
"RTN","BPSSCRU5",116,0)
 Q:BP1="F" "PA Deferred"
"RTN","BPSSCRU5",117,0)
 Q:BP1="P" "Paid"
"RTN","BPSSCRU5",118,0)
 Q:BP1="Q" "Duplicate of Capture"
"RTN","BPSSCRU5",119,0)
 Q:BP1="R" "Rejected"
"RTN","BPSSCRU5",120,0)
 Q:BP1="S" "Duplicate of Approved"
"RTN","BPSSCRU5",121,0)
 Q ""
"RTN","BPSSCRU5",122,0)
 ;
"RTN","BPSSCRU5",123,0)
 ;Electronic payer - ptr to #9002313.92 
"RTN","BPSSCRU5",124,0)
 ;BPIEN02 - ptr in #9002313.02
"RTN","BPSSCRU5",125,0)
PYRIEN(BPIEN02) ;
"RTN","BPSSCRU5",126,0)
 Q $P($G(^BPSF(9002313.92,+$P($G(^BPSC(BPIEN02,0)),U,2),0)),U)
"RTN","BPSSCRU5",127,0)
 ;
"RTN","BPSSCRU5",128,0)
 ;BPIEN02 - ptr in #9002313.02
"RTN","BPSSCRU5",129,0)
B2PYRIEN(BPIEN02,BP57) ;
"RTN","BPSSCRU5",130,0)
 N BPX,BPX2
"RTN","BPSSCRU5",131,0)
 S BPX=$G(^BPSF(9002313.92,+$$PYRIEN(BPIEN02),"REVERSAL"))
"RTN","BPSSCRU5",132,0)
 I $L(BPX)=0 D
"RTN","BPSSCRU5",133,0)
 . S BPX2=+$P($G(^BPSTL(BP57,10,+$G(^BPSTL(BP57,9)),0)),U,3)
"RTN","BPSSCRU5",134,0)
 . S BPX=$P($G(^BPSF(9002313.92,BPX2,0)),U)
"RTN","BPSSCRU5",135,0)
 Q BPX
"RTN","BPSSCRU5",136,0)
 ;
"RTN","BPSSCRU5",137,0)
 ;B3 payer sheet 
"RTN","BPSSCRU5",138,0)
B3PYRIEN(BPIEN02,BP59,BP57) ;
"RTN","BPSSCRU5",139,0)
 N BPX,BPX2
"RTN","BPSSCRU5",140,0)
 S BPX2=+$P($G(^BPSTL(BP57,10,+$G(^BPSTL(BP57,9)),0)),U,4)
"RTN","BPSSCRU5",141,0)
 S BPX=$P($G(^BPSF(9002313.92,BPX2,0)),U)
"RTN","BPSSCRU5",142,0)
 Q BPX
"RTN","BPSSCRU5",143,0)
 ;
"RTN","BPSSCRU5",144,0)
 ;
"RTN","BPSSCRU5",145,0)
 ;BPLN= line to use in SETLINE
"RTN","BPSSCRU5",146,0)
 ;BPX - long string to display
"RTN","BPSSCRU5",147,0)
 ;BPMLEN - max length
"RTN","BPSSCRU5",148,0)
 ;BPPREFX - prefix string
"RTN","BPSSCRU5",149,0)
 ;BPMARG - left margin
"RTN","BPSSCRU5",150,0)
WRAPLN(BPLN,BPX,BPMLEN,BPPREFX,BPMARG) ;
"RTN","BPSSCRU5",151,0)
 N BPQ,BPLEN,BPXX
"RTN","BPSSCRU5",152,0)
 S BPQ=0
"RTN","BPSSCRU5",153,0)
 S BPLEN=BPMLEN-$L(BPPREFX)
"RTN","BPSSCRU5",154,0)
 S BPXX=$E(BPX,1,BPLEN)
"RTN","BPSSCRU5",155,0)
 D SETLINE^BPSSCRLG(.BPLN,BPPREFX_BPXX)
"RTN","BPSSCRU5",156,0)
 S BPX=$E(BPX,BPLEN+1,9999)
"RTN","BPSSCRU5",157,0)
 I $L(BPX)<1 Q
"RTN","BPSSCRU5",158,0)
 S BPLEN=BPMLEN-BPMARG
"RTN","BPSSCRU5",159,0)
 F  D  Q:BPQ=1
"RTN","BPSSCRU5",160,0)
 . S BPXX=$E(BPX,1,BPLEN)
"RTN","BPSSCRU5",161,0)
 . D SETLINE^BPSSCRLG(.BPLN,$$SPACES(BPMARG)_BPXX)
"RTN","BPSSCRU5",162,0)
 . S BPX=$E(BPX,BPLEN+1,9999)
"RTN","BPSSCRU5",163,0)
 . I $L(BPX)<1 S BPQ=1
"RTN","BPSSCRU5",164,0)
 Q
"RTN","BPSSCRU5",165,0)
 ;
"RTN","BPSSCRU5",166,0)
 ;to prepare spaces
"RTN","BPSSCRU5",167,0)
SPACES(BPN) ;
"RTN","BPSSCRU5",168,0)
 N BPX
"RTN","BPSSCRU5",169,0)
 S $P(BPX," ",BPN+1)=""
"RTN","BPSSCRU5",170,0)
 Q BPX
"RTN","BPSSCRU5",171,0)
 ;
"RTN","BPSSCRU5",172,0)
 ;BPN= line counter (index) 
"RTN","BPSSCRU5",173,0)
 ;BPARR - array for lines
"RTN","BPSSCRU5",174,0)
 ;BPX - long string to display
"RTN","BPSSCRU5",175,0)
 ;BPMLEN - mas length
"RTN","BPSSCRU5",176,0)
 ;BPPREFX - prefix string
"RTN","BPSSCRU5",177,0)
 ;BPMARG - left margin
"RTN","BPSSCRU5",178,0)
WRAPLN2(BPN,BPARR,BPX,BPMLEN,BPPREFX,BPMARG) ;
"RTN","BPSSCRU5",179,0)
 N BPQ,BPLEN,BPXX
"RTN","BPSSCRU5",180,0)
 S BPQ=0
"RTN","BPSSCRU5",181,0)
 S BPLEN=BPMLEN-$L(BPPREFX)
"RTN","BPSSCRU5",182,0)
 S BPXX=$E(BPX,1,BPLEN)
"RTN","BPSSCRU5",183,0)
 D SETLN(.BPN,.BPARR,BPPREFX_BPXX)
"RTN","BPSSCRU5",184,0)
 S BPX=$E(BPX,BPLEN+1,9999)
"RTN","BPSSCRU5",185,0)
 I $L(BPX)<1 Q
"RTN","BPSSCRU5",186,0)
 S BPLEN=BPMLEN-BPMARG
"RTN","BPSSCRU5",187,0)
 F  D  Q:BPQ=1
"RTN","BPSSCRU5",188,0)
 . S BPXX=$E(BPX,1,BPLEN)
"RTN","BPSSCRU5",189,0)
 . D SETLN(.BPN,.BPARR,$$SPACES(BPMARG)_BPXX)
"RTN","BPSSCRU5",190,0)
 . S BPX=$E(BPX,BPLEN+1,9999)
"RTN","BPSSCRU5",191,0)
 . I $L(BPX)<1 S BPQ=1
"RTN","BPSSCRU5",192,0)
 Q
"RTN","BPSSCRU5",193,0)
 ;
"RTN","BPSSCRU5",194,0)
 ;
"RTN","BPSSCRU5",195,0)
SETLN(BPN,BPARR,BPTXT) ;
"RTN","BPSSCRU5",196,0)
 S BPN=BPN+1,BPARR(BPN)=BPTXT
"RTN","BPSSCRU5",197,0)
 Q
"RTN","BPSSCRU5",198,0)
 ;---
"RTN","BPSSCRU5",199,0)
 ;check 2nd insurance
"RTN","BPSSCRU5",200,0)
 ;if there then ask user and print message
"RTN","BPSSCRU5",201,0)
CH2NDINS(BP59,BPPATNAM,BPINSNAM,BPRXINFO) ;
"RTN","BPSSCRU5",202,0)
 N BPRETV
"RTN","BPSSCRU5",203,0)
 S BPRETV=$$NEXTINS^BPSSCRCL(BP59,BPINSNAM)
"RTN","BPSSCRU5",204,0)
 Q:+BPRETV=0
"RTN","BPSSCRU5",205,0)
 D PRN(BPPATNAM,BPRETV,.BPRXINFO,"S")
"RTN","BPSSCRU5",206,0)
 W !!
"RTN","BPSSCRU5",207,0)
 I $$YESNO^BPSSCRRS("Do you want to print the information (above) concerning additional insurance?   (Y/N)")'=1 Q
"RTN","BPSSCRU5",208,0)
 D PRN(BPPATNAM,BPRETV,.BPRXINFO,"P")
"RTN","BPSSCRU5",209,0)
 Q
"RTN","BPSSCRU5",210,0)
 ;
"RTN","BPSSCRU5",211,0)
 ;BPPRNFL
"RTN","BPSSCRU5",212,0)
 ; S- print to screen
"RTN","BPSSCRU5",213,0)
PRN(BPPATNAM,BPRETV,BPRXINFO,BPPRNFL) ;
"RTN","BPSSCRU5",214,0)
 I BPPRNFL="S" W @IOF D MS2NDINS Q
"RTN","BPSSCRU5",215,0)
 D PRINT("MS2NDINS^BPSSCRU5","BPS 2ND INSURANCE INFO","BP*")
"RTN","BPSSCRU5",216,0)
 W !!
"RTN","BPSSCRU5",217,0)
 Q
"RTN","BPSSCRU5",218,0)
 ;
"RTN","BPSSCRU5",219,0)
MS2NDINS ;
"RTN","BPSSCRU5",220,0)
 N Y,Z
"RTN","BPSSCRU5",221,0)
 W !,"This patient HAS additional insurance with Rx Coverage that may be"
"RTN","BPSSCRU5",222,0)
 W !,"used to bill this claim.  The system WILL change the CT entry to a"
"RTN","BPSSCRU5",223,0)
 W !,"NON-BILLABLE Episode. If appropriate, please go to Claims Tracking"
"RTN","BPSSCRU5",224,0)
 W !,"to manually create a bill to the additional payer listed below."
"RTN","BPSSCRU5",225,0)
 W !!,"Patient: ",?18,BPPATNAM
"RTN","BPSSCRU5",226,0)
 S Y=$P(BPRETV,U,4)\1 D DD^%DT
"RTN","BPSSCRU5",227,0)
 W !,"Date of service: ",?18,Y
"RTN","BPSSCRU5",228,0)
 W !,"Insurance: ",?18,$P(BPRETV,U,2)
"RTN","BPSSCRU5",229,0)
 W !,"Group number: ",?18,$P(BPRETV,U,3)
"RTN","BPSSCRU5",230,0)
 S Z=0 F  S Z=$O(BPRXINFO(Z)) Q:+Z=0  W !,BPRXINFO(Z)
"RTN","BPSSCRU5",231,0)
 Q
"RTN","BPSSCRU5",232,0)
 ;
"RTN","BPSSCRU5",233,0)
 ;Prints report
"RTN","BPSSCRU5",234,0)
 ;propmpts user to choose device (including queuing)
"RTN","BPSSCRU5",235,0)
 ;TXTSRC - name of the report's entry point
"RTN","BPSSCRU5",236,0)
 ;DESCR - description for the Task Manager
"RTN","BPSSCRU5",237,0)
 ;SAVEVARS - mask for vars that need to be available in the report
"RTN","BPSSCRU5",238,0)
 ;  (exmpl: "BP*")
"RTN","BPSSCRU5",239,0)
PRINT(TXTSRC,DESCR,SAVEVARS) ;
"RTN","BPSSCRU5",240,0)
 N Y,QUITVAR,SCRFLAG
"RTN","BPSSCRU5",241,0)
 S (QUITVAR,SCRFLAG)=0
"RTN","BPSSCRU5",242,0)
 D DEVICE Q:QUITVAR
"RTN","BPSSCRU5",243,0)
 D @TXTSRC
"RTN","BPSSCRU5",244,0)
 D ^%ZISC
"RTN","BPSSCRU5",245,0)
 I QUITVAR W !,"Cancelled"
"RTN","BPSSCRU5",246,0)
 Q
"RTN","BPSSCRU5",247,0)
 ;
"RTN","BPSSCRU5",248,0)
DEVICE ;
"RTN","BPSSCRU5",249,0)
 N DIR,DIRUT,POP
"RTN","BPSSCRU5",250,0)
 N ZTRTN,ZTIO,ZTSAVE,ZTDESC,%ZIS
"RTN","BPSSCRU5",251,0)
 K IO("Q") S %ZIS="QM"
"RTN","BPSSCRU5",252,0)
 W ! D ^%ZIS
"RTN","BPSSCRU5",253,0)
 I POP S QUITVAR=1 Q
"RTN","BPSSCRU5",254,0)
 S SCRFLAG=$S($E($G(IOST),1,2)="C-":1,1:0)
"RTN","BPSSCRU5",255,0)
 I $D(IO("Q")) D  S QUITVAR=1
"RTN","BPSSCRU5",256,0)
 . S ZTRTN=TXTSRC
"RTN","BPSSCRU5",257,0)
 . S ZTIO=ION
"RTN","BPSSCRU5",258,0)
 . S ZTSAVE(SAVEVARS)=""
"RTN","BPSSCRU5",259,0)
 . S ZTDESC=DESCR
"RTN","BPSSCRU5",260,0)
 . D ^%ZTLOAD
"RTN","BPSSCRU5",261,0)
 . W !,$S($D(ZTSK):"REQUEST QUEUED TASK="_ZTSK,1:"REQUEST CANCELLED")
"RTN","BPSSCRU5",262,0)
 . D HOME^%ZIS
"RTN","BPSSCRU5",263,0)
 U IO
"RTN","BPSSCRU5",264,0)
 Q
"RTN","BPSSCRU5",265,0)
 ;
"RTN","BPSTEST")
0^88^B58349994
"RTN","BPSTEST",1,0)
BPSTEST ;OAK/ELZ - ECME TESTING TOOL ;11/15/07  09:55
"RTN","BPSTEST",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**6,7**;JUN 2004;Build 46
"RTN","BPSTEST",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSTEST",4,0)
 ;
"RTN","BPSTEST",5,0)
 ;
"RTN","BPSTEST",6,0)
GETOVER(BPSRXIEN,BPSFILL,BPSORESP,BPSWHERE,BPSTYPE) ;
"RTN","BPSTEST",7,0)
 ; called by BPSNCPDP to enter overrides for a particular RX
"RTN","BPSTEST",8,0)
 ; INPUT
"RTN","BPSTEST",9,0)
 ;    BPSRXIEN  - Prescription Number
"RTN","BPSTEST",10,0)
 ;    BPSFILL   - Fill Number
"RTN","BPSTEST",11,0)
 ;    BPSORESP  - Previous response when this claim was processed
"RTN","BPSTEST",12,0)
 ;    BPSWHERE  - RX Action passed into BPSNCPDP
"RTN","BPSTEST",13,0)
 ;    BPSTYPE   - R (Reversal), S (Submission)
"RTN","BPSTEST",14,0)
 ; OUTPUT
"RTN","BPSTEST",15,0)
 ;    None - Table BPS PAYER RESPONSE OVERRIDE entry is created.
"RTN","BPSTEST",16,0)
 ;
"RTN","BPSTEST",17,0)
 N BPSTRANS,BPSTIEN,BPSSRESP,DIC,X,Y,DIR,DIK,DA
"RTN","BPSTEST",18,0)
 ;
"RTN","BPSTEST",19,0)
 ; Check if testing is enabled
"RTN","BPSTEST",20,0)
 I '$$CHECK() Q
"RTN","BPSTEST",21,0)
 ;
"RTN","BPSTEST",22,0)
 ; Option can not be run for Date of Death option as it causes errors
"RTN","BPSTEST",23,0)
 I $G(XQY0)["DG DEATH ENTRY" W !,"The testing tool can not be run from Date of Death option" Q
"RTN","BPSTEST",24,0)
 ;
"RTN","BPSTEST",25,0)
 ; Do not run for background jobs (CMOP (CR*) or ARES/AREV)
"RTN","BPSTEST",26,0)
 I $D(ZTQUEUED)!(",ARES,AREV,CRLB,CRLR,CRLX,PC,PL,"[(","_BPSWHERE_",")) Q
"RTN","BPSTEST",27,0)
 ;
"RTN","BPSTEST",28,0)
 ; Create Transaction Number
"RTN","BPSTEST",29,0)
 S BPSFILL="0000"_+BPSFILL
"RTN","BPSTEST",30,0)
 S BPSTRANS=BPSRXIEN_"."_$E(BPSFILL,$L(BPSFILL)-3,$L(BPSFILL))_"1"
"RTN","BPSTEST",31,0)
 ;
"RTN","BPSTEST",32,0)
 ; Lookup the record in the BPS PAYER RESPONSE OVERRIDE table
"RTN","BPSTEST",33,0)
 S DIC=9002313.32,DIC(0)="",X=BPSTRANS
"RTN","BPSTEST",34,0)
 D ^DIC
"RTN","BPSTEST",35,0)
 S BPSTIEN=+Y
"RTN","BPSTEST",36,0)
 ;
"RTN","BPSTEST",37,0)
 ; Prompt if user wants to do overrides
"RTN","BPSTEST",38,0)
 W !!,"Payer Overrides are enabled at this site.  If this is production environment,"
"RTN","BPSTEST",39,0)
 W !,"do not enter overrides (enter No at the next prompt) and disable this"
"RTN","BPSTEST",40,0)
 W !,"functionality in the BPS SETUP table."
"RTN","BPSTEST",41,0)
 W !!,"Entering No at the next prompt will delete any current overrides for the"
"RTN","BPSTEST",42,0)
 W !,"prescription, if they exist.",!
"RTN","BPSTEST",43,0)
 S DIR(0)="SA^Y:Yes;N:No"
"RTN","BPSTEST",44,0)
 S DIR("A")="Do you want to enter overrides for this prescription? ",DIR("B")="YES"
"RTN","BPSTEST",45,0)
 D ^DIR
"RTN","BPSTEST",46,0)
 ;
"RTN","BPSTEST",47,0)
 ; If no, delete the transaction (if it exists) and quit
"RTN","BPSTEST",48,0)
 I Y'="Y" D:BPSTIEN'=-1  Q
"RTN","BPSTEST",49,0)
 . S DIK="^BPS(9002313.32,",DA=BPSTIEN
"RTN","BPSTEST",50,0)
 . D ^DIK
"RTN","BPSTEST",51,0)
 ;
"RTN","BPSTEST",52,0)
 ; If the record does not exist, create it
"RTN","BPSTEST",53,0)
 I BPSTIEN=-1 S BPSTIEN=$$CREATE(BPSTRANS)
"RTN","BPSTEST",54,0)
 I BPSTIEN=-1 W !,"Failed to create the BPS PAYER RESPONSE OVERRIDE record",! Q
"RTN","BPSTEST",55,0)
 ;
"RTN","BPSTEST",56,0)
 ; If BPSTYPE is 'S' (submission) and old response is 'E Payable', change BPSTYPE to 'RS'
"RTN","BPSTEST",57,0)
 I BPSTYPE="S",BPSORESP="E PAYABLE"!(BPSORESP="E DUPLICATE")!(BPSORESP="E REVERSAL REJECTED")!(BPSORESP="E REVERSAL UNSTRANDED") S BPSTYPE="RS"
"RTN","BPSTEST",58,0)
 ;
"RTN","BPSTEST",59,0)
 ; Update with the BPSTYPE
"RTN","BPSTEST",60,0)
 D FILE("^BPS(9002313.32,",BPSTIEN,.02,BPSTYPE)
"RTN","BPSTEST",61,0)
 ;
"RTN","BPSTEST",62,0)
 ; Message for RS
"RTN","BPSTEST",63,0)
 I BPSTYPE="RS" D
"RTN","BPSTEST",64,0)
 . W !!,"This submission may also have a reversal so you will be prompted for the"
"RTN","BPSTEST",65,0)
 . W !,"reversal overrides."
"RTN","BPSTEST",66,0)
 ;
"RTN","BPSTEST",67,0)
 ; If BPSTYPE contains 'R', then prompt for reversal response
"RTN","BPSTEST",68,0)
 I BPSTYPE["R" D
"RTN","BPSTEST",69,0)
 . W !!,"Reversal Questions"
"RTN","BPSTEST",70,0)
 . D PROMPT(BPSTIEN,.05,"A")
"RTN","BPSTEST",71,0)
 ;
"RTN","BPSTEST",72,0)
 ; If BPSTYPE contains 'S', do submission response
"RTN","BPSTEST",73,0)
 I BPSTYPE["S" D
"RTN","BPSTEST",74,0)
 . W !!,"Submission Questions"
"RTN","BPSTEST",75,0)
 . D PROMPT(BPSTIEN,.03,"P")
"RTN","BPSTEST",76,0)
 . S BPSSRESP=$$GET1^DIQ(9002313.32,BPSTIEN_",",.03,"I")
"RTN","BPSTEST",77,0)
 . I BPSSRESP="P"!(BPSSRESP="D") D PROMPT(BPSTIEN,.04,40)
"RTN","BPSTEST",78,0)
 . I BPSSRESP="P"!(BPSSRESP="D") D PROMPT(BPSTIEN,.06,9)
"RTN","BPSTEST",79,0)
 . I BPSSRESP="R" D PROMPT(BPSTIEN,1,"07")
"RTN","BPSTEST",80,0)
 ;
"RTN","BPSTEST",81,0)
 W ! D PROMPT(BPSTIEN,.07,0)
"RTN","BPSTEST",82,0)
 Q
"RTN","BPSTEST",83,0)
 ;
"RTN","BPSTEST",84,0)
SETOVER(BPSTRANS,BPSTYPE,BPSDATA) ;
"RTN","BPSTEST",85,0)
 ; called by BPSECMPS to set the override data
"RTN","BPSTEST",86,0)
 ; Input
"RTN","BPSTEST",87,0)
 ;    BPSTRANS - Transaction IEN
"RTN","BPSTEST",88,0)
 ;    BPSTYPE  - B1 for submission, B2 for reversals
"RTN","BPSTEST",89,0)
 ; Output
"RTN","BPSTEST",90,0)
 ;    BPSDATA    - Passed by reference and updated with appropriate overrides
"RTN","BPSTEST",91,0)
 ;
"RTN","BPSTEST",92,0)
 N BPSTIEN,BPSRRESP,BPSSRESP,BPSPAID,BPSRCNT,BPSRIEN,BPSRCODE,BPSRCD,BPSCOPAY,BPSXXXX,BPSUNDEF
"RTN","BPSTEST",93,0)
 ;
"RTN","BPSTEST",94,0)
 ; Check the Test Flag in set in BPS SETUP
"RTN","BPSTEST",95,0)
 I '$$CHECK() Q
"RTN","BPSTEST",96,0)
 ;
"RTN","BPSTEST",97,0)
 ; Check if the Transaction Number is defined in BPS RESPONSE OVERRIDES
"RTN","BPSTEST",98,0)
 S BPSTIEN=$O(^BPS(9002313.32,"B",BPSTRANS,""))
"RTN","BPSTEST",99,0)
 I BPSTIEN="" Q
"RTN","BPSTEST",100,0)
 ;
"RTN","BPSTEST",101,0)
 ; If a reversal, check for specific reversal overrides and set
"RTN","BPSTEST",102,0)
 I BPSTYPE="B2" D
"RTN","BPSTEST",103,0)
 . S BPSRRESP=$$GET1^DIQ(9002313.32,BPSTIEN_",",.05,"I")
"RTN","BPSTEST",104,0)
 . ;
"RTN","BPSTEST",105,0)
 . ; If the response is Stranded, force an <UNDEF> error
"RTN","BPSTEST",106,0)
 . I BPSRRESP="S" S BPSXXXX=BPSUNDEF
"RTN","BPSTEST",107,0)
 . I BPSRRESP]"" S BPSDATA(1,112)=$S(BPSRRESP="D":"S",1:BPSRRESP)
"RTN","BPSTEST",108,0)
 . S BPSDATA(9002313.03,9002313.03,"+1,",501)=$S(BPSRRESP="R":"R",1:"A")
"RTN","BPSTEST",109,0)
 ;
"RTN","BPSTEST",110,0)
 ; If a submission, check for specific submission overrides and set
"RTN","BPSTEST",111,0)
 I BPSTYPE="B1" D
"RTN","BPSTEST",112,0)
 . ; Get submission response
"RTN","BPSTEST",113,0)
 . S BPSSRESP=$$GET1^DIQ(9002313.32,BPSTIEN_",",.03,"I")
"RTN","BPSTEST",114,0)
 . ;
"RTN","BPSTEST",115,0)
 . ; If the response is Stranded, force an <UNDEF> error
"RTN","BPSTEST",116,0)
 . I BPSSRESP="S" S BPSXXXX=BPSUNDEF
"RTN","BPSTEST",117,0)
 . ; If it exists, file it
"RTN","BPSTEST",118,0)
 . I BPSSRESP]"" D
"RTN","BPSTEST",119,0)
 .. S BPSDATA(1,112)=BPSSRESP
"RTN","BPSTEST",120,0)
 .. S BPSDATA(9002313.03,9002313.03,"+1,",501)=$S(BPSSRESP="R":"R",1:"A")
"RTN","BPSTEST",121,0)
 .. ; If payable or duplicate, get the BPSPAID amount and file it if it
"RTN","BPSTEST",122,0)
 .. ; exists.  Also delete any reject codes
"RTN","BPSTEST",123,0)
 .. I BPSSRESP="P"!(BPSSRESP="D") D
"RTN","BPSTEST",124,0)
 ... S BPSPAID=$$GET1^DIQ(9002313.32,BPSTIEN_",",.04,"I")
"RTN","BPSTEST",125,0)
 ... I BPSPAID]"" D
"RTN","BPSTEST",126,0)
 .... S BPSDATA(1,509)=$$DFF^BPSECFM(BPSPAID,8)
"RTN","BPSTEST",127,0)
 .... K BPSDATA(1,510),BPSDATA(1,511)
"RTN","BPSTEST",128,0)
 .. I BPSSRESP="P"!(BPSSRESP="D") D
"RTN","BPSTEST",129,0)
 ... S BPSCOPAY=$$GET1^DIQ(9002313.32,BPSTIEN_",",.06,"I")
"RTN","BPSTEST",130,0)
 ... I BPSCOPAY]"" D
"RTN","BPSTEST",131,0)
 .... S BPSDATA(1,518)=$$DFF^BPSECFM(BPSCOPAY,8)
"RTN","BPSTEST",132,0)
 .. ; If rejected, get the rejection code and file them
"RTN","BPSTEST",133,0)
 .. ; Also, delete the BPSPAID amount
"RTN","BPSTEST",134,0)
 .. I BPSSRESP="R" D
"RTN","BPSTEST",135,0)
 ... ; Delete old rejections and BPSPAID amount
"RTN","BPSTEST",136,0)
 ... K BPSDATA(1,509),BPSDATA(1,511)
"RTN","BPSTEST",137,0)
 ... ; Loop through rejections and store
"RTN","BPSTEST",138,0)
 ... S BPSRCNT=0
"RTN","BPSTEST",139,0)
 ... S BPSRIEN=0 F  S BPSRIEN=$O(^BPS(9002313.32,BPSTIEN,1,BPSRIEN)) Q:+BPSRIEN=0  D
"RTN","BPSTEST",140,0)
 .... S BPSRCODE=$P($G(^BPS(9002313.32,BPSTIEN,1,BPSRIEN,0)),"^",1)
"RTN","BPSTEST",141,0)
 .... ; Increment counter and store
"RTN","BPSTEST",142,0)
 .... I BPSRCODE]"" D
"RTN","BPSTEST",143,0)
 ..... S BPSRCD=$$GET1^DIQ(9002313.93,BPSRCODE_",",.01,"E")
"RTN","BPSTEST",144,0)
 ..... I BPSRCD]"" S BPSRCNT=BPSRCNT+1,BPSDATA(1,511,BPSRCNT)=BPSRCD
"RTN","BPSTEST",145,0)
 ... ; Store total number of rejections
"RTN","BPSTEST",146,0)
 ... S BPSDATA(1,510)=BPSRCNT
"RTN","BPSTEST",147,0)
 Q
"RTN","BPSTEST",148,0)
 ;
"RTN","BPSTEST",149,0)
SELOVER ;
"RTN","BPSTEST",150,0)
 ; used to create overrides for prescription that will processed in the
"RTN","BPSTEST",151,0)
 ; background (CMOP, auto-reversals).  The user is prompted for the
"RTN","BPSTEST",152,0)
 ; prescription and other information and then calls GETOVER.  It is called
"RTN","BPSTEST",153,0)
 ; by option BPS PROVIDER RESPONSE OVERRIDES
"RTN","BPSTEST",154,0)
 ;
"RTN","BPSTEST",155,0)
 N BPSRXIEN,BPSRXNM,BPSRXFL,BPSRFL,BPSORESP,BPSTYPE,BPSRXARR,BPSRARR,DIC,Y,DIR
"RTN","BPSTEST",156,0)
 ;
"RTN","BPSTEST",157,0)
 ; Check if test mode is on
"RTN","BPSTEST",158,0)
 I '$$CHECK() Q
"RTN","BPSTEST",159,0)
 ;
"RTN","BPSTEST",160,0)
 ; Prompt for the Prescription
"RTN","BPSTEST",161,0)
 S BPSRXIEN=$$PROMPTRX^BPSUTIL1 Q:BPSRXIEN<1
"RTN","BPSTEST",162,0)
 D RXAPI^BPSUTIL1(BPSRXIEN,".01;22","BPSRXARR","IE")
"RTN","BPSTEST",163,0)
 S BPSRXNM=$G(BPSRXARR(52,BPSRXIEN,.01,"E"))
"RTN","BPSTEST",164,0)
 ;
"RTN","BPSTEST",165,0)
 ; Prompt for Fill/Refill
"RTN","BPSTEST",166,0)
 S DIR(0)="S^0:"_$G(BPSRXARR(52,BPSRXIEN,22,"E"))
"RTN","BPSTEST",167,0)
 F BPSRFL=1:1 D RXSUBF^BPSUTIL1(BPSRXIEN,52,52.1,BPSRFL,.01,"BPSRARR","E") Q:$G(BPSRARR(52.1,BPSRFL,.01,"E"))=""  D
"RTN","BPSTEST",168,0)
 . S DIR(0)=DIR(0)_";"_BPSRFL_":"_BPSRARR(52.1,BPSRFL,.01,"E")
"RTN","BPSTEST",169,0)
 S DIR("A")="Select fill/refill for prescription "_BPSRXNM,DIR("B")=0
"RTN","BPSTEST",170,0)
 D ^DIR
"RTN","BPSTEST",171,0)
 I Y'=+Y Q
"RTN","BPSTEST",172,0)
 S BPSRXFL=Y
"RTN","BPSTEST",173,0)
 ;
"RTN","BPSTEST",174,0)
 ; Prompt for BPSTYPE
"RTN","BPSTEST",175,0)
 S DIR(0)="S^R:Reversal;RS:Resubmit with Reversal;S:Submit"
"RTN","BPSTEST",176,0)
 S DIR("A")="Enter BPSTYPE of transaction",DIR("B")="SUBMIT"
"RTN","BPSTEST",177,0)
 D ^DIR
"RTN","BPSTEST",178,0)
 I ",R,RS,S,"'[","_Y_"," Q
"RTN","BPSTEST",179,0)
 S BPSTYPE=Y
"RTN","BPSTEST",180,0)
 ;
"RTN","BPSTEST",181,0)
 ; Set up parameters
"RTN","BPSTEST",182,0)
 S BPSORESP=""
"RTN","BPSTEST",183,0)
 I BPSTYPE="RS" S BPSTYPE="S",BPSORESP="E PAYABLE"
"RTN","BPSTEST",184,0)
 ;
"RTN","BPSTEST",185,0)
 ; Call GETOVER
"RTN","BPSTEST",186,0)
 D GETOVER(BPSRXIEN,BPSRXFL,BPSORESP,"",BPSTYPE)
"RTN","BPSTEST",187,0)
 Q
"RTN","BPSTEST",188,0)
 ;
"RTN","BPSTEST",189,0)
CHECK() ;
"RTN","BPSTEST",190,0)
 ; Check if Test Mode is ON in the BPS Setup table
"RTN","BPSTEST",191,0)
 ; Also called by BPSNCPDP and BPSEMCPS
"RTN","BPSTEST",192,0)
 ;
"RTN","BPSTEST",193,0)
 ;IA#4440
"RTN","BPSTEST",194,0)
 Q $S($$PROD^XUPROD:0,1:$P($G(^BPS(9002313.99,1,0)),"^",3))
"RTN","BPSTEST",195,0)
 ;
"RTN","BPSTEST",196,0)
CREATE(BPSTRANS) ;
"RTN","BPSTEST",197,0)
 ; Create the Override record
"RTN","BPSTEST",198,0)
 ;
"RTN","BPSTEST",199,0)
 N DIC,X,Y,BPSTIEN,DA
"RTN","BPSTEST",200,0)
 S DIC=9002313.32,DIC(0)="L",X=BPSTRANS
"RTN","BPSTEST",201,0)
 D ^DIC
"RTN","BPSTEST",202,0)
 S BPSTIEN=+Y
"RTN","BPSTEST",203,0)
 Q BPSTIEN
"RTN","BPSTEST",204,0)
 ;
"RTN","BPSTEST",205,0)
FILE(DIE,DA,BPSFLD,BPSDATA) ;
"RTN","BPSTEST",206,0)
 ; File in the Override record
"RTN","BPSTEST",207,0)
 ;
"RTN","BPSTEST",208,0)
 N DR,X,Y
"RTN","BPSTEST",209,0)
 S DR=BPSFLD_"///"_BPSDATA
"RTN","BPSTEST",210,0)
 L +@(DIE_DA_")"):0 I $T D ^DIE L -@(DIE_DA_")") Q
"RTN","BPSTEST",211,0)
 W !?5,"Another user is editing this entry."
"RTN","BPSTEST",212,0)
 Q
"RTN","BPSTEST",213,0)
 ;
"RTN","BPSTEST",214,0)
PROMPT(DA,BPSFLD,BPSDFLT) ;
"RTN","BPSTEST",215,0)
 ; Prompt for a specific field and set the data
"RTN","BPSTEST",216,0)
 ;
"RTN","BPSTEST",217,0)
 N DIE,DR,DTOUT,X,Y
"RTN","BPSTEST",218,0)
 S DIE="^BPS(9002313.32,",DR=BPSFLD_"//"_BPSDFLT
"RTN","BPSTEST",219,0)
 L +@(DIE_DA_")"):0 I $T D ^DIE L -@(DIE_DA_")") Q
"RTN","BPSTEST",220,0)
 W !?5,"Another user is editing this entry."
"RTN","BPSTEST",221,0)
 Q
"RTN","BPSTEST",222,0)
 ;
"RTN","BPSTEST",223,0)
SETDELAY(BPSTRANS) ;
"RTN","BPSTEST",224,0)
 ; Input
"RTN","BPSTEST",225,0)
 ;    BPSTRANS - Transaction IEN
"RTN","BPSTEST",226,0)
 ; Check the Test Flag in set in BPS SETUP
"RTN","BPSTEST",227,0)
 I '$$CHECK() Q 0
"RTN","BPSTEST",228,0)
 N BPSDELAY,BPSTIEN,BPSTIME
"RTN","BPSTEST",229,0)
 ; Check if the Transaction Number is defined in BPS RESPONSE OVERRIDES
"RTN","BPSTEST",230,0)
 S BPSTIEN=$O(^BPS(9002313.32,"B",BPSTRANS,""))
"RTN","BPSTEST",231,0)
 I BPSTIEN="" Q 0
"RTN","BPSTEST",232,0)
 S BPSDELAY=$$GET1^DIQ(9002313.32,BPSTIEN_",",.07,"I")*60
"RTN","BPSTEST",233,0)
 I BPSDELAY'>0 Q 0
"RTN","BPSTEST",234,0)
 S BPSTIME=$$FMADD^XLFDT($$NOW^XLFDT,,,,BPSDELAY)
"RTN","BPSTEST",235,0)
 I BPSTIME>0 D  Q BPSTIME
"RTN","BPSTEST",236,0)
 . ;schedule a task to run RUNNING^BPSOSRX
"RTN","BPSTEST",237,0)
 . N ZTRTN,ZTDTH,ZTIO,ZTSK
"RTN","BPSTEST",238,0)
 . S ZTRTN="RUNECME^BPSTEST",ZTDESC="BPSTEST: ECME testing tool"
"RTN","BPSTEST",239,0)
 . S ZTDTH=$$FMADD^XLFDT($$NOW^XLFDT,,,,BPSDELAY+10),ZTIO=""
"RTN","BPSTEST",240,0)
 . D ^%ZTLOAD
"RTN","BPSTEST",241,0)
 Q 0
"RTN","BPSTEST",242,0)
 ;
"RTN","BPSTEST",243,0)
RUNECME ;
"RTN","BPSTEST",244,0)
 D RUNNING^BPSOSRX()
"RTN","BPSTEST",245,0)
 Q
"RTN","BPSUSCR")
0^55^B1332566
"RTN","BPSUSCR",1,0)
BPSUSCR ;BHAM ISC/FLS - ECME STRANDED CLAIMS SCREEN MAIN ;03/07/08  10:44
"RTN","BPSUSCR",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,7**;JUN 2004;Build 46
"RTN","BPSUSCR",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSUSCR",4,0)
 ;
"RTN","BPSUSCR",5,0)
 ;STRANDED CLAIMS SCREEN
"RTN","BPSUSCR",6,0)
EN ; -- main entry point for BPS ECME USER SCREEN
"RTN","BPSUSCR",7,0)
 N BPTMPGL,DUOUT,DTOUT,BPQ
"RTN","BPSUSCR",8,0)
 S BPQ=$$MESSAGE^BPSUSCR1() I BPQ=1 Q
"RTN","BPSUSCR",9,0)
 D GETDTS^BPSUSCR1(.BPARR) Q:$D(DUOUT)!$D(DTOUT)
"RTN","BPSUSCR",10,0)
 D EN^VALM("BPS LSTMN ECME UNSTRAND")
"RTN","BPSUSCR",11,0)
 Q
"RTN","BPSUSCR",12,0)
 ;
"RTN","BPSUSCR",13,0)
HDR ; -- header code
"RTN","BPSUSCR",14,0)
 S BPBDT=$$FMTE^XLFDT($P(BPBDT,"."),"5Z")
"RTN","BPSUSCR",15,0)
 S BPEDT=$$FMTE^XLFDT($P(BPEDT,"."),"5Z")
"RTN","BPSUSCR",16,0)
 S VALMHDR(1)="Claims Stranded from "_BPBDT_" through "_BPEDT
"RTN","BPSUSCR",17,0)
 S VALMHDR(2)="Sorted by Transaction Date"
"RTN","BPSUSCR",18,0)
 Q
"RTN","BPSUSCR",19,0)
 ;
"RTN","BPSUSCR",20,0)
INIT ; -- init variables and list array
"RTN","BPSUSCR",21,0)
 W !,"Please wait..."
"RTN","BPSUSCR",22,0)
 D INIT^BPSUSCR1
"RTN","BPSUSCR",23,0)
 Q
"RTN","BPSUSCR",24,0)
 ;
"RTN","BPSUSCR",25,0)
HELP ; -- help code
"RTN","BPSUSCR",26,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","BPSUSCR",27,0)
 K X
"RTN","BPSUSCR",28,0)
 Q
"RTN","BPSUSCR",29,0)
 ;
"RTN","BPSUSCR",30,0)
EXIT ; -- exit code
"RTN","BPSUSCR",31,0)
 K BPARR,BPEDT,BPBDT
"RTN","BPSUSCR",32,0)
 D CLEAN^VALM10
"RTN","BPSUSCR",33,0)
 Q
"RTN","BPSUSCR1")
0^6^B33759524
"RTN","BPSUSCR1",1,0)
BPSUSCR1 ;BHAM ISC/FLS - STRANDED CLAIMS SCREEN ;10-MAR-2005
"RTN","BPSUSCR1",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,5,7**;JUN 2004;Build 46
"RTN","BPSUSCR1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSUSCR1",4,0)
 Q
"RTN","BPSUSCR1",5,0)
 ;
"RTN","BPSUSCR1",6,0)
INIT ; -- init variables and list array
"RTN","BPSUSCR1",7,0)
 N BPLN,BPLM,BP59,BPSORT,BPDUZ7,BPRET,CONT
"RTN","BPSUSCR1",8,0)
 ;get date/time range
"RTN","BPSUSCR1",9,0)
 K ^TMP("BPSUSCR-1",$J),^TMP("BPSUSCR-2",$J),^TMP("BPSUSCR",$J)
"RTN","BPSUSCR1",10,0)
 S BPTMPGL="^TMP(""BPSUSCR"",$J)"
"RTN","BPSUSCR1",11,0)
 S CONT=1,VALMCNT=0
"RTN","BPSUSCR1",12,0)
 D COLLECT^BPSUSCR4(.BPARR)
"RTN","BPSUSCR1",13,0)
 Q
"RTN","BPSUSCR1",14,0)
 ;
"RTN","BPSUSCR1",15,0)
HELP ; -- help code
"RTN","BPSUSCR1",16,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","BPSUSCR1",17,0)
 K X
"RTN","BPSUSCR1",18,0)
 Q
"RTN","BPSUSCR1",19,0)
 ;
"RTN","BPSUSCR1",20,0)
EXIT ; -- exit code
"RTN","BPSUSCR1",21,0)
 Q
"RTN","BPSUSCR1",22,0)
 ;
"RTN","BPSUSCR1",23,0)
 ; Warning message for 'Transmitting' claims
"RTN","BPSUSCR1",24,0)
MESSAGE() ;
"RTN","BPSUSCR1",25,0)
 W !!!,"Please be aware that if there are claims appearing on the ECME User Screen"
"RTN","BPSUSCR1",26,0)
 W !,"with a status of 'In progress - Transmitting', then there may be a problem"
"RTN","BPSUSCR1",27,0)
 W !,"with HL7 or with system connectivity with the Austin Automation Center (AAC)."
"RTN","BPSUSCR1",28,0)
 W !,"Please contact your IRM to verify that connectivity to the AAC is working"
"RTN","BPSUSCR1",29,0)
 W !,"and the HL7 link BPS NCPDP is processing messages before using this option"
"RTN","BPSUSCR1",30,0)
 W !,"to unstrand claims with a status of 'In progress - Transmitting'.",!
"RTN","BPSUSCR1",31,0)
 N DIR,X,Y,BPQ
"RTN","BPSUSCR1",32,0)
 S BPQ=0
"RTN","BPSUSCR1",33,0)
 S DIR(0)="YA",DIR("A")="Do you want to continue? "
"RTN","BPSUSCR1",34,0)
 S DIR("B")="NO"
"RTN","BPSUSCR1",35,0)
 D ^DIR
"RTN","BPSUSCR1",36,0)
 I Y'=1 S BPQ=1
"RTN","BPSUSCR1",37,0)
 W !!
"RTN","BPSUSCR1",38,0)
 Q BPQ
"RTN","BPSUSCR1",39,0)
 ;
"RTN","BPSUSCR1",40,0)
GETDTS(BPARR) ; Transaction dates to view.
"RTN","BPSUSCR1",41,0)
 N DIR
"RTN","BPSUSCR1",42,0)
 K DIRUT,DIROUT,DUOUT,DTOUT,Y
"RTN","BPSUSCR1",43,0)
 S DIR(0)="DA^:DT:EX",DIR("A")="FIRST TRANSACTION DATE: "
"RTN","BPSUSCR1",44,0)
 S DIR("B")="T-1"
"RTN","BPSUSCR1",45,0)
 D ^DIR
"RTN","BPSUSCR1",46,0)
 Q:$D(DUOUT)!($D(DTOUT))
"RTN","BPSUSCR1",47,0)
 S BPARR("BDT")=Y_".000001"
"RTN","BPSUSCR1",48,0)
ENDDT ;
"RTN","BPSUSCR1",49,0)
 K DIRUT,DIROUT,DUOUT,DTOUT,Y
"RTN","BPSUSCR1",50,0)
 S DIR(0)="DA^"_$P(BPARR("BDT"),".",1)_":DT:EX",DIR("A")="LAST TRANSACTION DATE: "
"RTN","BPSUSCR1",51,0)
 S DIR("B")="T"
"RTN","BPSUSCR1",52,0)
 D ^DIR
"RTN","BPSUSCR1",53,0)
 Q:$D(DUOUT)!($D(DTOUT))
"RTN","BPSUSCR1",54,0)
 S BPARR("EDT")=$$EDATE(Y)
"RTN","BPSUSCR1",55,0)
 Q
"RTN","BPSUSCR1",56,0)
 ;
"RTN","BPSUSCR1",57,0)
EDATE(DATE) ;
"RTN","BPSUSCR1",58,0)
 N RTN,%,%H
"RTN","BPSUSCR1",59,0)
 S RTN=DATE_".235959"
"RTN","BPSUSCR1",60,0)
 D NOW^%DTC
"RTN","BPSUSCR1",61,0)
 I $P(%,".")=DATE S $P(%H,",",2)=$P(%H,",",2)-1800 D YX^%DTC S RTN=DATE_%
"RTN","BPSUSCR1",62,0)
 Q RTN
"RTN","BPSUSCR1",63,0)
ALL ; Unstrand all claims currently selected.
"RTN","BPSUSCR1",64,0)
 D FULL^VALM1
"RTN","BPSUSCR1",65,0)
 N D0,DIR,SEQ,LAST
"RTN","BPSUSCR1",66,0)
 S LAST=+$O(^TMP("BPSUSCR-2",$J,""),-1)
"RTN","BPSUSCR1",67,0)
 I LAST=0 D  Q
"RTN","BPSUSCR1",68,0)
 . W !,"There are no stranded claims in this date range to unstrand"
"RTN","BPSUSCR1",69,0)
 . D PRESSANY^BPSOSU5()
"RTN","BPSUSCR1",70,0)
 S DIR(0)="Y",DIR("A")="ARE YOU SURE? (YES/NO) ",DIR("B")="YES" D ^DIR Q:'Y
"RTN","BPSUSCR1",71,0)
 W !,"PLEASE WAIT"
"RTN","BPSUSCR1",72,0)
 S SEQ=0
"RTN","BPSUSCR1",73,0)
 F  S SEQ=$O(^TMP("BPSUSCR-2",$J,SEQ)) Q:'SEQ  D
"RTN","BPSUSCR1",74,0)
 .  S D0=""
"RTN","BPSUSCR1",75,0)
 .  F  S D0=$O(^TMP("BPSUSCR-2",$J,SEQ,D0)) Q:'D0  D
"RTN","BPSUSCR1",76,0)
 .  .  D UNSTRAND(D0,$G(^TMP("BPSUSCR-2",$J,SEQ,D0)))
"RTN","BPSUSCR1",77,0)
 .  .  Q
"RTN","BPSUSCR1",78,0)
 .  Q
"RTN","BPSUSCR1",79,0)
 W !,"Done"
"RTN","BPSUSCR1",80,0)
 D CLEAN^VALM10
"RTN","BPSUSCR1",81,0)
 D COLLECT^BPSUSCR4(.BPARR)
"RTN","BPSUSCR1",82,0)
 Q
"RTN","BPSUSCR1",83,0)
SELECT ; Select entries from the list and run each through the unstrand function
"RTN","BPSUSCR1",84,0)
 N D0,DIR,I,J,VAR,BPTMPGL,PT,POP,LAST
"RTN","BPSUSCR1",85,0)
 S LAST=+$O(^TMP("BPSUSCR-2",$J,""),-1)
"RTN","BPSUSCR1",86,0)
 I LAST=0 D  Q
"RTN","BPSUSCR1",87,0)
 . W !,"There are no stranded claims to select"
"RTN","BPSUSCR1",88,0)
 . D PRESSANY^BPSOSU5()
"RTN","BPSUSCR1",89,0)
 K DTOUT,DUOUT
"RTN","BPSUSCR1",90,0)
 S BPTMPGL="^TMP(""BPSUSCR"",$J)"
"RTN","BPSUSCR1",91,0)
 S VAR=""
"RTN","BPSUSCR1",92,0)
 S DIR(0)="LO^1:"_LAST
"RTN","BPSUSCR1",93,0)
 S DIR("A")="Enter a Selection of Stranded Claims",DIR("B")=""
"RTN","BPSUSCR1",94,0)
 D ^DIR
"RTN","BPSUSCR1",95,0)
 I $D(DTOUT)!$D(DUOUT) Q
"RTN","BPSUSCR1",96,0)
 S VAR=Y
"RTN","BPSUSCR1",97,0)
 F I=1:1:$L(VAR,",") S PT=$P(VAR,",",I) D
"RTN","BPSUSCR1",98,0)
 .  Q:PT=""
"RTN","BPSUSCR1",99,0)
 .  I PT'["-" S D0=$O(^TMP("BPSUSCR-2",$J,PT,"")) D UNSTRAND(D0,$G(^TMP("BPSUSCR-2",$J,PT,+D0))) Q
"RTN","BPSUSCR1",100,0)
 .  F J=$P(PT,"-"):1:$P(PT,"-",2) S D0=$O(^TMP("BPSUSCR-2",$J,J,"")) D UNSTRAND(D0,$G(^TMP("BPSUSCR-2",$J,J,+D0)))
"RTN","BPSUSCR1",101,0)
 .  Q
"RTN","BPSUSCR1",102,0)
 D CLEAN^VALM10
"RTN","BPSUSCR1",103,0)
 D COLLECT^BPSUSCR4(.BPARR)
"RTN","BPSUSCR1",104,0)
 Q
"RTN","BPSUSCR1",105,0)
PRINT ;
"RTN","BPSUSCR1",106,0)
 N %ZIS
"RTN","BPSUSCR1",107,0)
 S %ZIS="M"
"RTN","BPSUSCR1",108,0)
 S %ZIS("A")="Select Printer: ",%ZIS("B")="" D ^%ZIS
"RTN","BPSUSCR1",109,0)
 Q:IOPAR=""
"RTN","BPSUSCR1",110,0)
 D PHDR
"RTN","BPSUSCR1",111,0)
 D PLINE
"RTN","BPSUSCR1",112,0)
 D ^%ZISC
"RTN","BPSUSCR1",113,0)
 Q
"RTN","BPSUSCR1",114,0)
PHDR ;
"RTN","BPSUSCR1",115,0)
 U IO
"RTN","BPSUSCR1",116,0)
 W !,"Claims Stranded from ",BPBDT," through ",BPEDT
"RTN","BPSUSCR1",117,0)
 ;
"RTN","BPSUSCR1",118,0)
 W !!,?4,"TRANS DT",?15,"PATIENT NAME",?36,"ID",?41,"EXTERN RX#",?54,"RF",?57,"FILL DT",?68,"INS CO"
"RTN","BPSUSCR1",119,0)
 W !,?4,"--------",?15,"------------",?36,"--",?41,"----------",?54,"--",?57,"-------",?68,"------"
"RTN","BPSUSCR1",120,0)
 Q
"RTN","BPSUSCR1",121,0)
PLINE ;
"RTN","BPSUSCR1",122,0)
 N SEQ,LINE
"RTN","BPSUSCR1",123,0)
 S SEQ=0
"RTN","BPSUSCR1",124,0)
 F  S SEQ=$O(^TMP("BPSUSCR",$J,SEQ)) Q:'SEQ  D
"RTN","BPSUSCR1",125,0)
 .  S LINE=$G(^TMP("BPSUSCR",$J,SEQ,0))
"RTN","BPSUSCR1",126,0)
 .  U IO
"RTN","BPSUSCR1",127,0)
 .  W !,$E(LINE,1,79)
"RTN","BPSUSCR1",128,0)
 .  Q
"RTN","BPSUSCR1",129,0)
 Q
"RTN","BPSUSCR1",130,0)
 ;
"RTN","BPSUSCR1",131,0)
 ; Unstrand the claim
"RTN","BPSUSCR1",132,0)
 ; Fileman read of New Person file (VA(200)) is covered by IA# 10600
"RTN","BPSUSCR1",133,0)
 ; set PROCESS FLAG to COMPLETE in the file BPS REQUEST
"RTN","BPSUSCR1",134,0)
 ; IEN59 - ien of BPS TRANSACTION
"RTN","BPSUSCR1",135,0)
 ; BPREQ77 - ien of BPS REQUEST , if defined this means - there is 
"RTN","BPSUSCR1",136,0)
 ; no BPS TRANSACTION record - only request(s)
"RTN","BPSUSCR1",137,0)
UNSTRAND(IEN59,BPREQ77) ;
"RTN","BPSUSCR1",138,0)
 N MES,BP77IEN,BPRXRF,BPRXRF
"RTN","BPSUSCR1",139,0)
 I $G(BPREQ77)>0 D  D UNQUEUE(IEN59,+BPREQ77) Q
"RTN","BPSUSCR1",140,0)
 . W !,"Warning! The stranded request for the prescription #"_$$GET1^DIQ(9002313.77,BPREQ77,.01,"E")_"/"_$$GET1^DIQ(9002313.77,BPREQ77,.02,"E")
"RTN","BPSUSCR1",141,0)
 . W !,"is deleted. It might need to be submited manually in IB Claims"
"RTN","BPSUSCR1",142,0)
 . W !,"Tracking Edit option."
"RTN","BPSUSCR1",143,0)
 . D PRESSANY^BPSOSU5()
"RTN","BPSUSCR1",144,0)
 S MES="E UNSTRANDED"
"RTN","BPSUSCR1",145,0)
 I $P($G(^BPST(IEN59,4)),"^",1)!($P($G(^BPST(IEN59,4)),"^",4)]"") S MES="E REVERSAL UNSTRANDED"
"RTN","BPSUSCR1",146,0)
 D SETRESU^BPSOSU(IEN59,99,MES)
"RTN","BPSUSCR1",147,0)
 D SETSTAT^BPSOSU(IEN59,99) ;calls REQST99^BPSOSRX5
"RTN","BPSUSCR1",148,0)
 S BP77IEN=+$P($G(^BPST(IEN59,0)),"^",12)
"RTN","BPSUSCR1",149,0)
 ;complete the request and delete all associated requests (normally they are deleted by REQST99^BPSOSRX5)
"RTN","BPSUSCR1",150,0)
 I BP77IEN>0 S BPRXRF=$$RXREF^BPSSCRU2(IEN59) D COMPLETD^BPSOSRX4(BP77IEN),DELALLRQ^BPSOSRX7(BP77IEN,IEN59),DELACTRQ^BPSOSRX6(+BPRXRF,+$P(BPRXRF,U,2))
"RTN","BPSUSCR1",151,0)
 S MES=$T(+0)_"-Unstranded"
"RTN","BPSUSCR1",152,0)
 I $G(DUZ) S MES=MES_" by "_$$GET1^DIQ(200,DUZ,.01,"E")
"RTN","BPSUSCR1",153,0)
 D LOG^BPSOSL(IEN59,MES)
"RTN","BPSUSCR1",154,0)
 Q
"RTN","BPSUSCR1",155,0)
 ;remove all requests for this RX/refill
"RTN","BPSUSCR1",156,0)
UNQUEUE(IEN59,BP77IEN) ;
"RTN","BPSUSCR1",157,0)
 N MES,BPRXRF
"RTN","BPSUSCR1",158,0)
 S BPRXRF=$$RXREF^BPSSCRU2(IEN59)
"RTN","BPSUSCR1",159,0)
 I BP77IEN>0 D COMPLETD^BPSOSRX4(BP77IEN),DELALLRQ^BPSOSRX7(BP77IEN,IEN59),DELACTRQ^BPSOSRX6(+BPRXRF,$P(BPRXRF,U,2))
"RTN","BPSUSCR1",160,0)
 S MES=$T(+0)_"-Unqueued (unstranded)"
"RTN","BPSUSCR1",161,0)
 I $G(DUZ) S MES=MES_" by "_$$GET1^DIQ(200,DUZ,.01,"E")
"RTN","BPSUSCR1",162,0)
 D LOG^BPSOSL(IEN59,MES)
"RTN","BPSUSCR1",163,0)
 Q
"RTN","BPSUSCR2")
0^78^B9480735
"RTN","BPSUSCR2",1,0)
BPSUSCR2 ;ALB ISC/SS - UNSTRANDED ;02-MAY-2008
"RTN","BPSUSCR2",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**7**;JUN 2004;Build 46
"RTN","BPSUSCR2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSUSCR2",4,0)
 ;
"RTN","BPSUSCR2",5,0)
 Q
"RTN","BPSUSCR2",6,0)
 ;
"RTN","BPSUSCR2",7,0)
 ;Stranded requests with BPS TRANSACTION record
"RTN","BPSUSCR2",8,0)
 ;   Input:
"RTN","BPSUSCR2",9,0)
 ;     BPARR - Date Range
"RTN","BPSUSCR2",10,0)
 ;   Output:
"RTN","BPSUSCR2",11,0)
 ;     ^TMP("BPSUSCR",$J)
"RTN","BPSUSCR2",12,0)
 ;     ^TMP($J,2)
"RTN","BPSUSCR2",13,0)
COLACTRQ(BPARR) ;
"RTN","BPSUSCR2",14,0)
 N BPRXIEN,BPRREF,BPDATE,BPQUIT,BPIEN77
"RTN","BPSUSCR2",15,0)
 N TFILE,CFILE,STATUS,IEN59,VART,LSTUDT,CD0
"RTN","BPSUSCR2",16,0)
 N BPRX,REFILL,NAME,SSN,INSCO,FILLDT
"RTN","BPSUSCR2",17,0)
 K BPBDT,BPEDT
"RTN","BPSUSCR2",18,0)
 S TFILE=9002313.59,CFILE=9002313.02
"RTN","BPSUSCR2",19,0)
 S BPBDT=BPARR("BDT") ;start date and time
"RTN","BPSUSCR2",20,0)
 S BPEDT=BPARR("EDT") ;end date and time
"RTN","BPSUSCR2",21,0)
 S BPRXIEN=0
"RTN","BPSUSCR2",22,0)
 F  S BPRXIEN=$O(^BPS(9002313.77,"AC",2,BPRXIEN)) Q:+BPRXIEN=0  D
"RTN","BPSUSCR2",23,0)
 .S BPRREF=""
"RTN","BPSUSCR2",24,0)
 .F  S BPRREF=$O(^BPS(9002313.77,"AC",2,BPRXIEN,BPRREF)) Q:BPRREF=""  D
"RTN","BPSUSCR2",25,0)
 .. S BPIEN77=+$O(^BPS(9002313.77,"AC",2,BPRXIEN,BPRREF,0))
"RTN","BPSUSCR2",26,0)
 .. S IEN59=$$IEN59^BPSOSRX(BPRXIEN,BPRREF)
"RTN","BPSUSCR2",27,0)
 .. S BPRX=$$RXAPI1^BPSUTIL1(BPRXIEN,.01,"E")
"RTN","BPSUSCR2",28,0)
 .. S VART=$G(^BPST(IEN59,0)) I VART="" D REQSTTMP Q
"RTN","BPSUSCR2",29,0)
 .. S STATUS=-96
"RTN","BPSUSCR2",30,0)
 .. S STATUS=$P(VART,"^",2)
"RTN","BPSUSCR2",31,0)
 .. S LSTUDT=$$GET1^DIQ(TFILE,IEN59,7,"I")
"RTN","BPSUSCR2",32,0)
 .. I $D(^TMP("BPSUSCR-1",$J,+(LSTUDT\1),+IEN59)) Q  ;already has it
"RTN","BPSUSCR2",33,0)
 .. I LSTUDT<BPBDT!(LSTUDT>BPEDT) Q
"RTN","BPSUSCR2",34,0)
 .. S LSTUDT=$P(LSTUDT,".",1)
"RTN","BPSUSCR2",35,0)
 .. I LSTUDT="" Q
"RTN","BPSUSCR2",36,0)
 .. S CD0=$$GET1^DIQ(TFILE,IEN59,3,"I")
"RTN","BPSUSCR2",37,0)
 .. I CD0'="" D
"RTN","BPSUSCR2",38,0)
 ... S FILLDT=$$GET1^DIQ(CFILE,CD0,401),FILLDT=$$HL7TFM^XLFDT(FILLDT)
"RTN","BPSUSCR2",39,0)
 .. I CD0="" D
"RTN","BPSUSCR2",40,0)
 ... S FILLDT=$P($G(^BPST(IEN59,12)),"^",2)
"RTN","BPSUSCR2",41,0)
 .. S NAME=$$GET1^DIQ(TFILE,IEN59,5,"E")
"RTN","BPSUSCR2",42,0)
 .. S SSN="",VART=$G(^BPST(IEN59,0))
"RTN","BPSUSCR2",43,0)
 .. I $P(VART,"^",6)]"" S SSN=$P($G(^DPT($P(VART,"^",6),0)),"^",9),SSN=$E(SSN,$L(SSN)-3,$L(SSN))
"RTN","BPSUSCR2",44,0)
 .. S INSCO=$P($G(^BPST(IEN59,10,1,0)),"^",7)
"RTN","BPSUSCR2",45,0)
 .. S ^TMP("BPSUSCR-1",$J,LSTUDT,IEN59)=NAME_U_SSN_U_BPRX_U_BPRREF_U_FILLDT_U_INSCO_U_STATUS
"RTN","BPSUSCR2",46,0)
 Q
"RTN","BPSUSCR2",47,0)
 ;
"RTN","BPSUSCR2",48,0)
 ;Stranded requests without BPS TRANSACTION record
"RTN","BPSUSCR2",49,0)
 ;Note the IEN59 here is a calculated ien only - the record doesn't exist
"RTN","BPSUSCR2",50,0)
REQSTTMP ;
"RTN","BPSUSCR2",51,0)
 N BPDFN,BPIEN78,BPX
"RTN","BPSUSCR2",52,0)
 I BPIEN77=0 Q
"RTN","BPSUSCR2",53,0)
 S STATUS=-96
"RTN","BPSUSCR2",54,0)
 S LSTUDT=$$GET1^DIQ(9002313.77,BPIEN77,6.05,"I")
"RTN","BPSUSCR2",55,0)
 I LSTUDT<BPBDT!(LSTUDT>BPEDT) Q
"RTN","BPSUSCR2",56,0)
 S LSTUDT=$P(LSTUDT,".",1)
"RTN","BPSUSCR2",57,0)
 I LSTUDT="" Q
"RTN","BPSUSCR2",58,0)
 I BPRREF=0 S FILLDT=+$$RXAPI1^BPSUTIL1(BPRXIEN,22,"I")
"RTN","BPSUSCR2",59,0)
 I BPRREF>0 S FILLDT=+$$RXSUBF1^BPSUTIL1(BPRXIEN,52,52.1,BPRREF,.01,"I")
"RTN","BPSUSCR2",60,0)
 S NAME=$$RXAPI1^BPSUTIL1(BPRXIEN,2,"E")
"RTN","BPSUSCR2",61,0)
 S BPDFN=+$$RXAPI1^BPSUTIL1(BPRXIEN,2,"I")
"RTN","BPSUSCR2",62,0)
 S SSN=""
"RTN","BPSUSCR2",63,0)
 I BPDFN>0 S SSN=$P($G(^DPT(BPDFN,0)),"^",9),SSN=$E(SSN,$L(SSN)-3,$L(SSN))
"RTN","BPSUSCR2",64,0)
 S BPX=$O(^BPS(9002313.77,BPIEN77,5,0))
"RTN","BPSUSCR2",65,0)
 I BPX>0 S BPIEN78=+$P($G(^BPS(9002313.77,BPIEN77,5,BPX,0)),U,3),INSCO=$$GET1^DIQ(9002313.78,BPIEN78,.07,"E")
"RTN","BPSUSCR2",66,0)
 E  S INSCO="UNKNOWN"
"RTN","BPSUSCR2",67,0)
 S ^TMP("BPSUSCR-1",$J,LSTUDT,IEN59)=NAME_U_SSN_U_BPRX_U_BPRREF_U_FILLDT_U_INSCO_U_STATUS_U_BPIEN77
"RTN","BPSUSCR2",68,0)
 Q
"RTN","BPSUSCR4")
0^77^B12367629
"RTN","BPSUSCR4",1,0)
BPSUSCR4 ;BHAM ISC/FLS - USER SCREEN ;14-FEB-05
"RTN","BPSUSCR4",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**1,3,7**;JUN 2004;Build 46
"RTN","BPSUSCR4",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSUSCR4",4,0)
 ;
"RTN","BPSUSCR4",5,0)
 Q
"RTN","BPSUSCR4",6,0)
 ;
"RTN","BPSUSCR4",7,0)
 ; COLLECT - Compile stranded claims
"RTN","BPSUSCR4",8,0)
 ;   Input:
"RTN","BPSUSCR4",9,0)
 ;     BPARR - Date Range
"RTN","BPSUSCR4",10,0)
 ;   Output:
"RTN","BPSUSCR4",11,0)
 ;     ^TMP("BPSUSCR",$J)
"RTN","BPSUSCR4",12,0)
 ;     ^TMP("BPSUSCR-1",$J)
"RTN","BPSUSCR4",13,0)
 ;     ^TMP("BPSUSCR-2",$J)
"RTN","BPSUSCR4",14,0)
COLLECT(BPARR) ;
"RTN","BPSUSCR4",15,0)
 N TFILE,CFILE,SDT,STATUS,IEN59,VART,LSTUDT,CD0,DATA
"RTN","BPSUSCR4",16,0)
 N RX,REFILL,NAME,SSN,INSCO,FILLDT,SEQ,ITEM,MESSAGE
"RTN","BPSUSCR4",17,0)
 N BPIEN77,BPSTATUS
"RTN","BPSUSCR4",18,0)
 K BPBDT,BPEDT
"RTN","BPSUSCR4",19,0)
 K ^TMP("BPSUSCR-1",$J),^TMP("BPSUSCR-2",$J),^TMP("BPSUSCR",$J)
"RTN","BPSUSCR4",20,0)
 S VALMCNT=0,TFILE=9002313.59,CFILE=9002313.02
"RTN","BPSUSCR4",21,0)
 S BPBDT=BPARR("BDT") ;start date and time
"RTN","BPSUSCR4",22,0)
 S BPEDT=BPARR("EDT") ;end date and time
"RTN","BPSUSCR4",23,0)
 ;
"RTN","BPSUSCR4",24,0)
 ; Loop through all statii from 0 to 98
"RTN","BPSUSCR4",25,0)
 S STATUS=-1
"RTN","BPSUSCR4",26,0)
 F  S STATUS=$O(^BPST("AD",STATUS)) Q:STATUS>98!(STATUS="")  D
"RTN","BPSUSCR4",27,0)
 . ; Status of 31 is Insurer Asleep - these will process when insurer wakes up
"RTN","BPSUSCR4",28,0)
 . ; Insurer asleep disabled for Phase III so these should appear on the report for now
"RTN","BPSUSCR4",29,0)
 . ;I STATUS=31 Q
"RTN","BPSUSCR4",30,0)
 . S IEN59=0
"RTN","BPSUSCR4",31,0)
 . F  S IEN59=$O(^BPST("AD",STATUS,IEN59)) Q:'IEN59  D
"RTN","BPSUSCR4",32,0)
 .. S VART=$G(^BPST(IEN59,0)) Q:VART=""
"RTN","BPSUSCR4",33,0)
 .. S LSTUDT=$$GET1^DIQ(TFILE,IEN59,7,"I")
"RTN","BPSUSCR4",34,0)
 .. I LSTUDT<BPBDT!(LSTUDT>BPEDT) Q
"RTN","BPSUSCR4",35,0)
 .. S LSTUDT=$P(LSTUDT,".",1)
"RTN","BPSUSCR4",36,0)
 .. I LSTUDT="" Q
"RTN","BPSUSCR4",37,0)
 .. S RX=$$GET1^DIQ(TFILE,IEN59,1.11)
"RTN","BPSUSCR4",38,0)
 .. S REFILL=$$GET1^DIQ(TFILE,IEN59,9)
"RTN","BPSUSCR4",39,0)
 .. S CD0=$$GET1^DIQ(TFILE,IEN59,3,"I")
"RTN","BPSUSCR4",40,0)
 .. I CD0'="" D
"RTN","BPSUSCR4",41,0)
 ... S FILLDT=$$GET1^DIQ(CFILE,CD0,401),FILLDT=$$HL7TFM^XLFDT(FILLDT)
"RTN","BPSUSCR4",42,0)
 .. I CD0="" D
"RTN","BPSUSCR4",43,0)
 ... S FILLDT=$P($G(^BPST(IEN59,12)),"^",2)
"RTN","BPSUSCR4",44,0)
 .. S NAME=$$GET1^DIQ(TFILE,IEN59,5,"E")
"RTN","BPSUSCR4",45,0)
 .. S SSN="",VART=$G(^BPST(IEN59,0))
"RTN","BPSUSCR4",46,0)
 .. I $P(VART,"^",6)]"" S SSN=$P($G(^DPT($P(VART,"^",6),0)),"^",9),SSN=$E(SSN,$L(SSN)-3,$L(SSN))
"RTN","BPSUSCR4",47,0)
 .. S INSCO=$P($G(^BPST(IEN59,10,1,0)),"^",7)
"RTN","BPSUSCR4",48,0)
 .. S ^TMP("BPSUSCR-1",$J,LSTUDT,IEN59)=NAME_U_SSN_U_RX_U_REFILL_U_FILLDT_U_INSCO_U_STATUS
"RTN","BPSUSCR4",49,0)
 ;
"RTN","BPSUSCR4",50,0)
 ;look for stranded requests
"RTN","BPSUSCR4",51,0)
 D COLACTRQ^BPSUSCR2(.BPARR)
"RTN","BPSUSCR4",52,0)
 ;
"RTN","BPSUSCR4",53,0)
 ; Now that the data is sorted, format it and build list for display
"RTN","BPSUSCR4",54,0)
 S (SEQ,ITEM)=0
"RTN","BPSUSCR4",55,0)
 S SDT="" F  S SDT=$O(^TMP("BPSUSCR-1",$J,SDT)) Q:SDT=""  D
"RTN","BPSUSCR4",56,0)
 . S IEN59="" F  S IEN59=$O(^TMP("BPSUSCR-1",$J,SDT,IEN59)) Q:IEN59=""  D
"RTN","BPSUSCR4",57,0)
 .. S DATA=$G(^TMP("BPSUSCR-1",$J,SDT,IEN59))
"RTN","BPSUSCR4",58,0)
 .. S LSTUDT=$$FORMAT($$FMTE^XLFDT(SDT,"5Z"),10)
"RTN","BPSUSCR4",59,0)
 .. S NAME=$$FORMAT($P(DATA,U,1),20)
"RTN","BPSUSCR4",60,0)
 .. S SSN=$$FORMAT($P(DATA,U,2),4)
"RTN","BPSUSCR4",61,0)
 .. S RX=$$FORMAT($P(DATA,U,3),12)
"RTN","BPSUSCR4",62,0)
 .. S REFILL=$J($P(DATA,U,4),2)
"RTN","BPSUSCR4",63,0)
 .. S FILLDT=$$FMTE^XLFDT($P(DATA,U,5),"5Z")
"RTN","BPSUSCR4",64,0)
 .. S INSCO=$$FORMAT($P(DATA,U,6),12)
"RTN","BPSUSCR4",65,0)
 .. S BPSTATUS=+$P(DATA,U,7)
"RTN","BPSUSCR4",66,0)
 .. S BPIEN77=$P(DATA,U,8)
"RTN","BPSUSCR4",67,0)
 .. S SEQ=SEQ+1
"RTN","BPSUSCR4",68,0)
 .. S ITEM=ITEM+1
"RTN","BPSUSCR4",69,0)
 .. S ^TMP("BPSUSCR",$J,SEQ,0)=$J(ITEM,3)_" "_LSTUDT_" "_NAME_" "_SSN_" "_RX_" "_REFILL_" "_FILLDT_" "_INSCO
"RTN","BPSUSCR4",70,0)
 .. S ^TMP("BPSUSCR-2",$J,ITEM,IEN59)=BPIEN77
"RTN","BPSUSCR4",71,0)
 .. S SEQ=SEQ+1
"RTN","BPSUSCR4",72,0)
 .. S MESSAGE=$$STATI^BPSOSU($P(DATA,U,7))
"RTN","BPSUSCR4",73,0)
 .. I $E(MESSAGE,1)="?" S MESSAGE="Unknown Status"
"RTN","BPSUSCR4",74,0)
 .. S ^TMP("BPSUSCR",$J,SEQ,0)="    In Progress - "_MESSAGE
"RTN","BPSUSCR4",75,0)
 S VALMCNT=SEQ
"RTN","BPSUSCR4",76,0)
 Q
"RTN","BPSUSCR4",77,0)
 ;
"RTN","BPSUSCR4",78,0)
FORMAT(D1,LEN) ;
"RTN","BPSUSCR4",79,0)
 N OUT
"RTN","BPSUSCR4",80,0)
 S D1=$G(D1),LEN=$G(LEN)
"RTN","BPSUSCR4",81,0)
 S D1=$$NOSPACE(D1)
"RTN","BPSUSCR4",82,0)
 S OUT=$E($E(D1,1,LEN)_$J("",LEN),1,LEN)
"RTN","BPSUSCR4",83,0)
 Q OUT
"RTN","BPSUSCR4",84,0)
NOSPACE(VAR) ;
"RTN","BPSUSCR4",85,0)
 N RTN,SEQ,I
"RTN","BPSUSCR4",86,0)
 S RTN=""
"RTN","BPSUSCR4",87,0)
 F I=1:1:$L(VAR," ") I $P(VAR," ",I)'="" S SEQ=$G(SEQ)+1,$P(RTN," ",SEQ)=$P(VAR," ",I)
"RTN","BPSUSCR4",88,0)
 Q RTN
"RTN","BPSUTIL2")
0^19^B11085686
"RTN","BPSUTIL2",1,0)
BPSUTIL2 ;BHAM ISC/SS - General Utility functions ;08/01/2006
"RTN","BPSUTIL2",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**7**;JUN 2004;Build 46
"RTN","BPSUTIL2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSUTIL2",4,0)
 ;
"RTN","BPSUTIL2",5,0)
 Q
"RTN","BPSUTIL2",6,0)
 ;
"RTN","BPSUTIL2",7,0)
 ;/**
"RTN","BPSUTIL2",8,0)
 ;Creates a new entry (or node for multiple with .01 field)
"RTN","BPSUTIL2",9,0)
 ;
"RTN","BPSUTIL2",10,0)
 ;BPFILE - file/subfile number
"RTN","BPSUTIL2",11,0)
 ;BPIEN - ien of the parent file entry in which the new subfile entry will be inserted
"RTN","BPSUTIL2",12,0)
 ;BPVAL01 - .01 value for the new entry
"RTN","BPSUTIL2",13,0)
 ;NEWRECNO -(optional) specify IEN if you want specific value
"RTN","BPSUTIL2",14,0)
 ; Note: "" then the system will assign the entry number itself.
"RTN","BPSUTIL2",15,0)
 ;BPFLGS - FLAGS parameter for UPDATE^DIE
"RTN","BPSUTIL2",16,0)
 ;LCKGL - fully specified global refernece to lock
"RTN","BPSUTIL2",17,0)
 ;LCKTIME - time out for LOCK, if LOCKTIME=0 then the function will not lock the file 
"RTN","BPSUTIL2",18,0)
 ;BPNEWREC - optional, flag = if 1 then allow to create a new top level record 
"RTN","BPSUTIL2",19,0)
 ;Examples
"RTN","BPSUTIL2",20,0)
 ;top level:
"RTN","BPSUTIL2",21,0)
 ; D INSITEM(366.14,"",IBDATE,"")
"RTN","BPSUTIL2",22,0)
 ;to create with the specific ien
"RTN","BPSUTIL2",23,0)
 ; W $$INSITEM^BPSUTIL2(9002313.77,"",55555555,45555,,,,1)
"RTN","BPSUTIL2",24,0)
 ; 
"RTN","BPSUTIL2",25,0)
 ;1st level multiple:
"RTN","BPSUTIL2",26,0)
 ; subfile number = #366.141
"RTN","BPSUTIL2",27,0)
 ; parent file #366.14 entry number = 345
"RTN","BPSUTIL2",28,0)
 ; D INSITEM(366.141,345,"SUBMIT","")
"RTN","BPSUTIL2",29,0)
 ; to create mupltiple entry with particular entry number = 23
"RTN","BPSUTIL2",30,0)
 ; D INSITEM(366.141,345,"SUBMIT",23)
"RTN","BPSUTIL2",31,0)
 ;
"RTN","BPSUTIL2",32,0)
 ;2nd level multiple
"RTN","BPSUTIL2",33,0)
 ;parent file #366.14 entry number = 234
"RTN","BPSUTIL2",34,0)
 ;parent multiple entry number = 55
"RTN","BPSUTIL2",35,0)
 ;create mupltiple entry INSURANCE
"RTN","BPSUTIL2",36,0)
 ; D INSITEM(366.1412,"55,234","INS","")
"RTN","BPSUTIL2",37,0)
 ; results in :
"RTN","BPSUTIL2",38,0)
 ; ^IBCNR(366.14,234,1,55,5,0)=^366.1412PA^1^1
"RTN","BPSUTIL2",39,0)
 ; ^IBCNR(366.14,234,1,55,5,1,0)=INS
"RTN","BPSUTIL2",40,0)
 ; ^IBCNR(366.14,234,1,55,5,"B","INS",1)=
"RTN","BPSUTIL2",41,0)
 ;  (DD node for this muptiple =5 ) 
"RTN","BPSUTIL2",42,0)
 ;  
"RTN","BPSUTIL2",43,0)
 ;output :
"RTN","BPSUTIL2",44,0)
 ; positive number - record # created
"RTN","BPSUTIL2",45,0)
 ; <=0 - failure
"RTN","BPSUTIL2",46,0)
 ;  See description above
"RTN","BPSUTIL2",47,0)
INSITEM(BPFILE,BPIEN,BPVAL01,NEWRECNO,BPFLGS,LCKGL,LCKTIME,BPNEWREC) ;*/
"RTN","BPSUTIL2",48,0)
 I ('$G(BPFILE)) Q "0^Invalid parameter"
"RTN","BPSUTIL2",49,0)
 I +$G(BPNEWREC)=0 I $G(NEWRECNO)>0,'$G(BPIEN) Q "0^Invalid parameter"
"RTN","BPSUTIL2",50,0)
 I $G(BPVAL01)="" Q "0^Null"
"RTN","BPSUTIL2",51,0)
 N BPLOCK S BPLOCK=0
"RTN","BPSUTIL2",52,0)
 ;I '$G(BPFILE) Q -1
"RTN","BPSUTIL2",53,0)
 ;I '$G(BPVAL01) Q -1
"RTN","BPSUTIL2",54,0)
 N BPSSI,BPIENS,BPFDA,BPERR
"RTN","BPSUTIL2",55,0)
 I '$G(NEWRECNO) N NEWRECNO S NEWRECNO=$G(NEWRECNO)
"RTN","BPSUTIL2",56,0)
 I BPIEN'="" S BPIENS="+1,"_BPIEN_"," I $L(NEWRECNO)>0 S BPSSI(1)=+NEWRECNO
"RTN","BPSUTIL2",57,0)
 I BPIEN="" S BPIENS="+1," I $L(NEWRECNO)>0 S BPSSI(1)=+NEWRECNO
"RTN","BPSUTIL2",58,0)
 S BPFDA(BPFILE,BPIENS,.01)=BPVAL01
"RTN","BPSUTIL2",59,0)
 I $L($G(LCKGL)) L +@LCKGL:(+$G(LCKTIME)) S BPLOCK=$T I 'BPLOCK Q -2  ;lock failure
"RTN","BPSUTIL2",60,0)
 D UPDATE^DIE($G(BPFLGS),"BPFDA","BPSSI","BPERR")
"RTN","BPSUTIL2",61,0)
 I BPLOCK L -@LCKGL
"RTN","BPSUTIL2",62,0)
 I $D(BPERR) D BMES^XPDUTL($G(BPERR("DIERR",1,"TEXT",1),"Update Error")) Q -1  ;D BMES^XPDUTL(BPERR("DIERR",1,"TEXT",1)) 
"RTN","BPSUTIL2",63,0)
 Q +$G(BPSSI(1))
"RTN","BPSUTIL2",64,0)
 ;
"RTN","BPSUTIL2",65,0)
 ;fill fields
"RTN","BPSUTIL2",66,0)
 ;Input:
"RTN","BPSUTIL2",67,0)
 ;FILENO file number
"RTN","BPSUTIL2",68,0)
 ;FLDNO field number
"RTN","BPSUTIL2",69,0)
 ;RECIEN ien string 
"RTN","BPSUTIL2",70,0)
 ;NEWVAL new value to file (internal format)
"RTN","BPSUTIL2",71,0)
 ;Output:
"RTN","BPSUTIL2",72,0)
 ;0^ NEWVAL^error if failure
"RTN","BPSUTIL2",73,0)
 ;1^ NEWVAL if success
"RTN","BPSUTIL2",74,0)
FILLFLDS(FILENO,FLDNO,RECIEN,NEWVAL) ;
"RTN","BPSUTIL2",75,0)
 I '$G(FILENO) Q "0^Invalid parameter"
"RTN","BPSUTIL2",76,0)
 I '$G(FLDNO) Q "0^Invalid parameter"
"RTN","BPSUTIL2",77,0)
 I '$G(RECIEN) Q "0^Invalid parameter"
"RTN","BPSUTIL2",78,0)
 I $G(NEWVAL)="" Q "0^Null"
"RTN","BPSUTIL2",79,0)
 N RECIENS,FDA,ERRARR
"RTN","BPSUTIL2",80,0)
 S RECIENS=RECIEN_","
"RTN","BPSUTIL2",81,0)
 S FDA(FILENO,RECIENS,FLDNO)=NEWVAL
"RTN","BPSUTIL2",82,0)
 D FILE^DIE("","FDA","ERRARR")
"RTN","BPSUTIL2",83,0)
 I $D(ERRARR) Q "0^"_NEWVAL_"^"_ERRARR("DIERR",1,"TEXT",1)
"RTN","BPSUTIL2",84,0)
 Q "1^"_NEWVAL
"RTN","BPSUTIL2",85,0)
 ;
"RTN","BPSUTIL2",86,0)
 ;API to return the GROUP INSURANCE PLAN associated with the
"RTN","BPSUTIL2",87,0)
 ;PRIMARY INSURANCE in the BPS TRANSACTION File
"RTN","BPSUTIL2",88,0)
 ;Input:
"RTN","BPSUTIL2",89,0)
 ;BPIEN59 = IEN of entry in BPS TRANSACTION File
"RTN","BPSUTIL2",90,0)
 ;Output:
"RTN","BPSUTIL2",91,0)
 ;IEN of GROUP INSURANCE PLAN file^INSURANCE COMPANY Name
"RTN","BPSUTIL2",92,0)
GETPLN59(BPIEN59) ;
"RTN","BPSUTIL2",93,0)
 N IENS,GRPNM
"RTN","BPSUTIL2",94,0)
 S IENS=+$G(^BPST(BPIEN59,9))_","_BPIEN59_","
"RTN","BPSUTIL2",95,0)
 S GRPNM=$$GET1^DIQ(9002313.59902,IENS,"PLAN ID:INSURANCE COMPANY")
"RTN","BPSUTIL2",96,0)
 Q +$G(^BPST(BPIEN59,10,+$G(^BPST(BPIEN59,9)),0))_"^"_GRPNM
"RTN","BPSUTIL2",97,0)
 ;
"RTN","BPSUTIL2",98,0)
GETPLN77(BPIEN77) ;
"RTN","BPSUTIL2",99,0)
 N BPINSIEN,BPSINSUR,BPINSDAT
"RTN","BPSUTIL2",100,0)
 S BPINSIEN=0
"RTN","BPSUTIL2",101,0)
 ;get the USED FOR THE REQUEST=1 (active) entry in the multiple
"RTN","BPSUTIL2",102,0)
 S BPINSIEN=$O(^BPS(9002313.77,BPIEN77,5,"C",1,BPINSIEN))
"RTN","BPSUTIL2",103,0)
 I +BPINSIEN=0 Q 0
"RTN","BPSUTIL2",104,0)
 ;get BPS IBNSURER DATA pointer
"RTN","BPSUTIL2",105,0)
 S BPSINSUR=+$P($G(^BPS(9002313.77,BPIEN77,5,BPINSIEN,0)),U,3)
"RTN","BPSUTIL2",106,0)
 I BPSINSUR=0 Q 0
"RTN","BPSUTIL2",107,0)
 ;get 0th node of the BPS INSURER DATA
"RTN","BPSUTIL2",108,0)
 S BPINSDAT=$G(^BPS(9002313.78,BPSINSUR,0))
"RTN","BPSUTIL2",109,0)
 I BPINSDAT="" Q 0
"RTN","BPSUTIL2",110,0)
 Q $P(BPINSDAT,U,8)_"^"_$P(BPINSDAT,U,7)
"RTN","BPSWRKLS")
0^31^B27286584
"RTN","BPSWRKLS",1,0)
BPSWRKLS ;ALB/SS - SEND CLAIMS TO PHARMACY WORKLIST ;12/26/07
"RTN","BPSWRKLS",2,0)
 ;;1.0;E CLAIMS MGMT ENGINE;**7**;JUN 2004;Build 46
"RTN","BPSWRKLS",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","BPSWRKLS",4,0)
 ;
"RTN","BPSWRKLS",5,0)
 ; -- main entry point for BPS PRTCL USRSCR PHARM WRKLST protocol (ECME User Screen option)
"RTN","BPSWRKLS",6,0)
 ;
"RTN","BPSWRKLS",7,0)
EN ;
"RTN","BPSWRKLS",8,0)
 ;entry point for WRK Send to Worklist menu option of the main User Screen
"RTN","BPSWRKLS",9,0)
 N BPRET,BPSARR59,BPSTATS,BPQ,BP59,BPCNT,BP59SENT,BPCOMZ,BPZ,BPUPD
"RTN","BPSWRKLS",10,0)
 S BPCNT=0
"RTN","BPSWRKLS",11,0)
 I '$D(@(VALMAR)) Q
"RTN","BPSWRKLS",12,0)
 D FULL^VALM1
"RTN","BPSWRKLS",13,0)
 I '$$CHCKKEY() D  Q
"RTN","BPSWRKLS",14,0)
 . W !,"The user doesn't have enough rights to perform this action"
"RTN","BPSWRKLS",15,0)
 . D QUIT(1)
"RTN","BPSWRKLS",16,0)
 ;
"RTN","BPSWRKLS",17,0)
 S BPQ=0
"RTN","BPSWRKLS",18,0)
 F  D  Q:BPQ>0
"RTN","BPSWRKLS",19,0)
 . K BP59SENT,BPSARR59
"RTN","BPSWRKLS",20,0)
 . S BPZ=$$SELCLMS(.BPSARR59,VALMAR)
"RTN","BPSWRKLS",21,0)
 . I BPZ=0 S BPQ=1 Q  ;nothing selected or up-arrow entered
"RTN","BPSWRKLS",22,0)
 . ; check selected claims
"RTN","BPSWRKLS",23,0)
 . S BPCNT=$$CHCKSEL(.BPSARR59,.BP59SENT)
"RTN","BPSWRKLS",24,0)
 . I BPCNT>0 S BPQ=1 ; if at least one can be processed then do not prompt the user again (BPQ>1)
"RTN","BPSWRKLS",25,0)
 ;
"RTN","BPSWRKLS",26,0)
 I BPCNT=0 D QUIT() Q
"RTN","BPSWRKLS",27,0)
 ;add comments
"RTN","BPSWRKLS",28,0)
 S BPCOMZ=$$COMMENT^BPSSCRCL("Comment for Pharmacy ",40)
"RTN","BPSWRKLS",29,0)
 I BPCOMZ="^" D QUIT() Q
"RTN","BPSWRKLS",30,0)
 I $L(BPCOMZ)>0 S BPCOMZ="Sent to Pharmacy:"_BPCOMZ
"RTN","BPSWRKLS",31,0)
 E  S BPCOMZ="Sent to Pharmacy Worklist"
"RTN","BPSWRKLS",32,0)
 W !!,"Eligible claim(s) will be sent to the Pharmacy Worklist...",!
"RTN","BPSWRKLS",33,0)
 S BPQ=$$YESNO^BPSSCRRS("Are you sure?(Y/N)")
"RTN","BPSWRKLS",34,0)
 I BPQ=0 D QUIT() Q
"RTN","BPSWRKLS",35,0)
 ;send to Pharmacy
"RTN","BPSWRKLS",36,0)
 S BP59=0,BPUPD=0
"RTN","BPSWRKLS",37,0)
 F  S BP59=$O(BP59SENT(BP59)) Q:+BP59=0  S BPUPD=$$TOPHARM(BP59,BPCOMZ,.BPSARR59)
"RTN","BPSWRKLS",38,0)
 D QUIT(1)
"RTN","BPSWRKLS",39,0)
 D:BPUPD=1 REDRAW^BPSSCRUD("Updating screen...")
"RTN","BPSWRKLS",40,0)
 Q
"RTN","BPSWRKLS",41,0)
 ;send the claim to Pharmacy Worklist
"RTN","BPSWRKLS",42,0)
 ;BP59 - pointer to the BPS TRANSACTION file
"RTN","BPSWRKLS",43,0)
 ;BPCOMM - comment
"RTN","BPSWRKLS",44,0)
 ;BPSARR59 - array with selected claims as BPS TRANSACTION pointers
"RTN","BPSWRKLS",45,0)
 ;returns:
"RTN","BPSWRKLS",46,0)
 ;1- has been successfully sent
"RTN","BPSWRKLS",47,0)
 ;0- failed to send
"RTN","BPSWRKLS",48,0)
TOPHARM(BP59,BPCOMM,BPSARR59) ;
"RTN","BPSWRKLS",49,0)
 N BPRXIEN,BPRXFIL,BPRET,BPX
"RTN","BPSWRKLS",50,0)
 S BPX=$$RXREF^BPSSCRU2(BP59)
"RTN","BPSWRKLS",51,0)
 S BPRXIEN=+BPX
"RTN","BPSWRKLS",52,0)
 S BPRXFIL=$P(BPX,U,2)
"RTN","BPSWRKLS",53,0)
 ;use Pharmacy API to send the claim and the comment IA #5063
"RTN","BPSWRKLS",54,0)
 S BPRET=$$WRKLST^PSOREJU4(BPRXIEN,BPRXFIL,BPCOMM,DUZ,DT,1)
"RTN","BPSWRKLS",55,0)
 W !,$G(@VALMAR@(+$G(BPSARR59(BP59)),0))
"RTN","BPSWRKLS",56,0)
 I +BPRET=2 W !,"was ALREADY sent to the Pharmacy Work List." Q 0
"RTN","BPSWRKLS",57,0)
 I +BPRET=0 W !,"cannot be sent: ",$P(BPRET,U,2) Q 0
"RTN","BPSWRKLS",58,0)
 ;add the comment to BPS TRANSACTION
"RTN","BPSWRKLS",59,0)
 I $$ADDCOMM^BPSBUTL(BPRXIEN,BPRXFIL,BPCOMM) ;COB
"RTN","BPSWRKLS",60,0)
 W !,"has been sent to the Pharmacy Work List."
"RTN","BPSWRKLS",61,0)
 Q 1
"RTN","BPSWRKLS",62,0)
 ;check selected claims 
"RTN","BPSWRKLS",63,0)
 ;BPSARR59 - array with the claims selected by the user
"RTN","BPSWRKLS",64,0)
 ;BP59SENT - array with the claims that will be sent to the pharmacy
"RTN","BPSWRKLS",65,0)
 ;output:
"RTN","BPSWRKLS",66,0)
 ;the number of claims that will be sent to the Pharmacy Worklist
"RTN","BPSWRKLS",67,0)
CHCKSEL(BPSARR59,BP59SENT) ;
"RTN","BPSWRKLS",68,0)
 N BP59,BPCNT,BPREJS,BPALLREJ,BPNOTSNT,BPSDIV59
"RTN","BPSWRKLS",69,0)
 S BP59=0,BPCNT=0
"RTN","BPSWRKLS",70,0)
 ;check each selected claim
"RTN","BPSWRKLS",71,0)
 S BPNOTSNT=0
"RTN","BPSWRKLS",72,0)
 W !,"You've chosen to send to Pharmacy Work List the following:"
"RTN","BPSWRKLS",73,0)
 F  S BP59=$O(BPSARR59(BP59)) Q:+BP59=0  D
"RTN","BPSWRKLS",74,0)
 . W !,$G(@VALMAR@(+$G(BPSARR59(BP59)),0))
"RTN","BPSWRKLS",75,0)
 . I $$CLOSED02^BPSSCR03($P($G(^BPST(BP59,0)),U,4)) W !,"is closed and cannot be sent to the Pharmacy Work List." Q
"RTN","BPSWRKLS",76,0)
 . ; check status - only rejected cannot be sent to the Pharmacy worklist
"RTN","BPSWRKLS",77,0)
 . S BPSTATS=$P($$CLAIMST^BPSSCRU3(BP59),U)
"RTN","BPSWRKLS",78,0)
 . I BPSTATS'="E REJECTED" W !,"was not rejected and cannot be sent to the Pharmacy Work List." Q
"RTN","BPSWRKLS",79,0)
 . ;check if the claim has an eligible reject code(s)
"RTN","BPSWRKLS",80,0)
 . I $$INWRKLST(BP59)=1 W !,"was ALREADY sent to the Pharmacy Work List." Q
"RTN","BPSWRKLS",81,0)
 . ;check Pharmacy settings - if all rejects can be sent
"RTN","BPSWRKLS",82,0)
 . ;IA 5063
"RTN","BPSWRKLS",83,0)
 . S BPSDIV59=$P($G(^BPST(BP59,1)),U,4)
"RTN","BPSWRKLS",84,0)
 . D AUTOREJ^PSOREJU4(.BPREJS,BPSDIV59)
"RTN","BPSWRKLS",85,0)
 . S BPALLREJ=+$G(BPREJS(0)) ;if 1 then claims with All kind of reject codes can be sent to Pharmacy Worklist
"RTN","BPSWRKLS",86,0)
 . I BPALLREJ=0 I $$CHCKREJ(BP59,BPSDIV59)=0 W !,"doesn't have eligible reject code to be sent to the Pharmacy Work List." Q
"RTN","BPSWRKLS",87,0)
 . S BPCNT=BPCNT+1 ;count eligible claims
"RTN","BPSWRKLS",88,0)
 . S BP59SENT(BP59)="" ;put them in the output array
"RTN","BPSWRKLS",89,0)
 . S BP59SENT=BPCNT
"RTN","BPSWRKLS",90,0)
 Q BPCNT
"RTN","BPSWRKLS",91,0)
 ;
"RTN","BPSWRKLS",92,0)
NOTSNDMS ;
"RTN","BPSWRKLS",93,0)
 W "cannot be sent - "
"RTN","BPSWRKLS",94,0)
 Q
"RTN","BPSWRKLS",95,0)
 ;
"RTN","BPSWRKLS",96,0)
 ;BPSARR59 (by reference)- to store BPS TRANSACTION pointers selected by the user
"RTN","BPSWRKLS",97,0)
 ;BPTMP - temporary global (like VALMAR)
"RTN","BPSWRKLS",98,0)
SELCLMS(BPSARR59,BPTMP) ;
"RTN","BPSWRKLS",99,0)
 W !!,"Enter the line numbers for the claim(s) to send to the Pharmacy Worklist."
"RTN","BPSWRKLS",100,0)
 S BPRET=$$ASKLINES^BPSSCRU4("Select item(s)","C",.BPSARR59,BPTMP)
"RTN","BPSWRKLS",101,0)
 I BPRET="^" Q 0
"RTN","BPSWRKLS",102,0)
 Q 1
"RTN","BPSWRKLS",103,0)
 ;
"RTN","BPSWRKLS",104,0)
CHCKKEY() ;
"RTN","BPSWRKLS",105,0)
 ;check if the user does have BPS MANAGER key
"RTN","BPSWRKLS",106,0)
 I $D(^XUSEC("BPS MANAGER",DUZ)) Q 1
"RTN","BPSWRKLS",107,0)
 Q 0
"RTN","BPSWRKLS",108,0)
 ;BPPAUSE 1- make pause
"RTN","BPSWRKLS",109,0)
QUIT(BPPAUSE) ;
"RTN","BPSWRKLS",110,0)
 I $G(BPPAUSE)>0 D
"RTN","BPSWRKLS",111,0)
 . I $$PAUSE^BPSSCRRV()
"RTN","BPSWRKLS",112,0)
 S VALMBCK="R"
"RTN","BPSWRKLS",113,0)
 Q
"RTN","BPSWRKLS",114,0)
 ;check if the claim can be sent to the pharmacy because its reject code is eligible for this
"RTN","BPSWRKLS",115,0)
 ;BP59 - pointer to the BPS TRANSACTION file
"RTN","BPSWRKLS",116,0)
 ;BPSDIV59 - pointer to file #59 (PHARMACY DIVISION)
"RTN","BPSWRKLS",117,0)
 ;return value:
"RTN","BPSWRKLS",118,0)
 ;1- can be sent
"RTN","BPSWRKLS",119,0)
 ;0- cannot be sent
"RTN","BPSWRKLS",120,0)
CHCKREJ(BP59,BPSDIV59) ;
"RTN","BPSWRKLS",121,0)
 N BPREJS,BPRJCODE,BPRJS,BPFLG
"RTN","BPSWRKLS",122,0)
 ;get reject codes for the claim
"RTN","BPSWRKLS",123,0)
 D REJCODES^BPSSCRU3(BP59,.BPREJS) ;
"RTN","BPSWRKLS",124,0)
 ;if no reject codes then return 0
"RTN","BPSWRKLS",125,0)
 I $O(BPREJS(""))="" Q 0
"RTN","BPSWRKLS",126,0)
 D CONVERT(.BPREJS,.BPRJS)
"RTN","BPSWRKLS",127,0)
 ;call Pharmacy API to read site parameters and check if the claim with these reject codes can be sent to the Pharmacy Worklist
"RTN","BPSWRKLS",128,0)
 ;IA 5063
"RTN","BPSWRKLS",129,0)
 D AUTOREJ^PSOREJU4(.BPRJS,BPSDIV59)
"RTN","BPSWRKLS",130,0)
 ;check result
"RTN","BPSWRKLS",131,0)
 I $G(BPRJS(0))=1 Q 1  ;any reject can be sent
"RTN","BPSWRKLS",132,0)
 S BPRJCODE="",BPFLG=0
"RTN","BPSWRKLS",133,0)
 F  S BPRJCODE=$O(BPRJS(1,BPRJCODE)) Q:BPRJCODE=""  I BPRJS(1,BPRJCODE)=1 S BPFLG=1 Q
"RTN","BPSWRKLS",134,0)
 ;return 1 if the claim has at least one reject code that matches site parameter reject codes
"RTN","BPSWRKLS",135,0)
 ;return 0 if not
"RTN","BPSWRKLS",136,0)
 Q BPFLG
"RTN","BPSWRKLS",137,0)
 ;
"RTN","BPSWRKLS",138,0)
 ;check if the claim is already in the Pharmacy Worklist
"RTN","BPSWRKLS",139,0)
 ;BP59 - pointer to the BPS TRANSACTION file
"RTN","BPSWRKLS",140,0)
 ;return: 
"RTN","BPSWRKLS",141,0)
 ;1 - in list
"RTN","BPSWRKLS",142,0)
 ;0 - not in list
"RTN","BPSWRKLS",143,0)
INWRKLST(BP59) ;
"RTN","BPSWRKLS",144,0)
 N BPRXIEN,BPRXFIL,BPX
"RTN","BPSWRKLS",145,0)
 S BPX=$$RXREF^BPSSCRU2(BP59)
"RTN","BPSWRKLS",146,0)
 S BPRXIEN=+BPX
"RTN","BPSWRKLS",147,0)
 S BPRXFIL=$P(BPX,U,2)
"RTN","BPSWRKLS",148,0)
 ;IA #5063
"RTN","BPSWRKLS",149,0)
 Q $$INLIST^PSOREJU4(BPRXIEN,BPRXFIL)
"RTN","BPSWRKLS",150,0)
 ;
"RTN","BPSWRKLS",151,0)
 ;Converts external values of the BPS NCPDP REJECT CODES file #9002313.93
"RTN","BPSWRKLS",152,0)
 ;stored in the local array BPSARRJ1 to IENs and save them in the local 
"RTN","BPSWRKLS",153,0)
 ;array BPSARRJ2 under "1" subscript - in the form suitable for the AUTOREJ^PSOREJU4
"RTN","BPSWRKLS",154,0)
CONVERT(BPSARRJ1,BPSARRJ2) ;
"RTN","BPSWRKLS",155,0)
 N BPREJ1,BPREJ2
"RTN","BPSWRKLS",156,0)
 S BPREJ1=""
"RTN","BPSWRKLS",157,0)
 F  S BPREJ1=$O(BPSARRJ1(BPREJ1)) Q:BPREJ1=""  D
"RTN","BPSWRKLS",158,0)
 . S BPREJ2=+$O(^BPSF(9002313.93,"B",BPREJ1,0))
"RTN","BPSWRKLS",159,0)
 . I BPREJ2>0 S BPSARRJ2(1,BPREJ2)=""
"RTN","BPSWRKLS",160,0)
 Q
"RTN","BPSWRKLS",161,0)
 ;BPSWRKLS
"SEC","^DIC",9002313.02,9002313.02,0,"AUDIT")
@
"SEC","^DIC",9002313.02,9002313.02,0,"DD")
@
"SEC","^DIC",9002313.02,9002313.02,0,"DEL")
@
"SEC","^DIC",9002313.02,9002313.02,0,"LAYGO")
@
"SEC","^DIC",9002313.02,9002313.02,0,"RD")
Pp
"SEC","^DIC",9002313.02,9002313.02,0,"WR")
@
"SEC","^DIC",9002313.03,9002313.03,0,"AUDIT")
@
"SEC","^DIC",9002313.03,9002313.03,0,"DD")
@
"SEC","^DIC",9002313.03,9002313.03,0,"DEL")
@
"SEC","^DIC",9002313.03,9002313.03,0,"LAYGO")
@
"SEC","^DIC",9002313.03,9002313.03,0,"RD")
Pp
"SEC","^DIC",9002313.03,9002313.03,0,"WR")
@
"SEC","^DIC",9002313.15,9002313.15,0,"AUDIT")
@
"SEC","^DIC",9002313.15,9002313.15,0,"DD")
@
"SEC","^DIC",9002313.15,9002313.15,0,"DEL")
@
"SEC","^DIC",9002313.15,9002313.15,0,"LAYGO")
@
"SEC","^DIC",9002313.15,9002313.15,0,"RD")
Pp
"SEC","^DIC",9002313.15,9002313.15,0,"WR")
@
"SEC","^DIC",9002313.25,9002313.25,0,"AUDIT")
@
"SEC","^DIC",9002313.25,9002313.25,0,"DD")
@
"SEC","^DIC",9002313.25,9002313.25,0,"DEL")
@
"SEC","^DIC",9002313.25,9002313.25,0,"LAYGO")
@
"SEC","^DIC",9002313.25,9002313.25,0,"RD")
Pp
"SEC","^DIC",9002313.25,9002313.25,0,"WR")
@
"SEC","^DIC",9002313.26,9002313.26,0,"AUDIT")
@
"SEC","^DIC",9002313.26,9002313.26,0,"DD")
@
"SEC","^DIC",9002313.26,9002313.26,0,"DEL")
@
"SEC","^DIC",9002313.26,9002313.26,0,"LAYGO")
@
"SEC","^DIC",9002313.26,9002313.26,0,"RD")
Pp
"SEC","^DIC",9002313.26,9002313.26,0,"WR")
@
"SEC","^DIC",9002313.56,9002313.56,0,"AUDIT")
@
"SEC","^DIC",9002313.56,9002313.56,0,"DD")
@
"SEC","^DIC",9002313.56,9002313.56,0,"DEL")
@
"SEC","^DIC",9002313.56,9002313.56,0,"LAYGO")
@
"SEC","^DIC",9002313.56,9002313.56,0,"RD")
Pp
"SEC","^DIC",9002313.56,9002313.56,0,"WR")
@
"SEC","^DIC",9002313.57,9002313.57,0,"AUDIT")
@
"SEC","^DIC",9002313.57,9002313.57,0,"DD")
@
"SEC","^DIC",9002313.57,9002313.57,0,"DEL")
@
"SEC","^DIC",9002313.57,9002313.57,0,"LAYGO")
@
"SEC","^DIC",9002313.57,9002313.57,0,"RD")
Pp
"SEC","^DIC",9002313.57,9002313.57,0,"WR")
@
"SEC","^DIC",9002313.59,9002313.59,0,"AUDIT")
@
"SEC","^DIC",9002313.59,9002313.59,0,"DD")
@
"SEC","^DIC",9002313.59,9002313.59,0,"DEL")
@
"SEC","^DIC",9002313.59,9002313.59,0,"LAYGO")
@
"SEC","^DIC",9002313.59,9002313.59,0,"RD")
Pp
"SEC","^DIC",9002313.59,9002313.59,0,"WR")
@
"SEC","^DIC",9002313.78,9002313.78,0,"AUDIT")
@
"SEC","^DIC",9002313.78,9002313.78,0,"DD")
@
"SEC","^DIC",9002313.78,9002313.78,0,"DEL")
@
"SEC","^DIC",9002313.78,9002313.78,0,"LAYGO")
@
"SEC","^DIC",9002313.78,9002313.78,0,"RD")
@
"SEC","^DIC",9002313.78,9002313.78,0,"WR")
@
"SEC","^DIC",9002313.91,9002313.91,0,"AUDIT")
@
"SEC","^DIC",9002313.91,9002313.91,0,"DD")
@
"SEC","^DIC",9002313.91,9002313.91,0,"DEL")
@
"SEC","^DIC",9002313.91,9002313.91,0,"LAYGO")
@
"SEC","^DIC",9002313.91,9002313.91,0,"RD")
Pp
"SEC","^DIC",9002313.91,9002313.91,0,"WR")
@
"SEC","^DIC",9002313.92,9002313.92,0,"AUDIT")
@
"SEC","^DIC",9002313.92,9002313.92,0,"DD")
@
"SEC","^DIC",9002313.92,9002313.92,0,"DEL")
@
"SEC","^DIC",9002313.92,9002313.92,0,"LAYGO")
@
"SEC","^DIC",9002313.92,9002313.92,0,"RD")
Pp
"SEC","^DIC",9002313.92,9002313.92,0,"WR")
@
"SEC","^DIC",9002313.93,9002313.93,0,"AUDIT")
@
"SEC","^DIC",9002313.93,9002313.93,0,"DD")
@
"SEC","^DIC",9002313.93,9002313.93,0,"DEL")
@
"SEC","^DIC",9002313.93,9002313.93,0,"LAYGO")
@
"SEC","^DIC",9002313.93,9002313.93,0,"RD")
Pp
"SEC","^DIC",9002313.93,9002313.93,0,"WR")
@
"SEC","^DIC",9002313.99,9002313.99,0,"AUDIT")
@
"SEC","^DIC",9002313.99,9002313.99,0,"DD")
@
"SEC","^DIC",9002313.99,9002313.99,0,"DEL")
@
"SEC","^DIC",9002313.99,9002313.99,0,"LAYGO")
@
"SEC","^DIC",9002313.99,9002313.99,0,"RD")
Pp
"SEC","^DIC",9002313.99,9002313.99,0,"WR")
@
"VER")
8.0^22.0
"^DD",9002313.02,9002313.02,0)
FIELD^^9999^52
"^DD",9002313.02,9002313.02,0,"DDA")
N
"^DD",9002313.02,9002313.02,0,"DT")
3080604
"^DD",9002313.02,9002313.02,0,"IX","AD",9002313.02,.04)

"^DD",9002313.02,9002313.02,0,"IX","AE",9002313.02,.05)

"^DD",9002313.02,9002313.02,0,"IX","AF",9002313.02,401)

"^DD",9002313.02,9002313.02,0,"IX","AG",9002313.02,902)

"^DD",9002313.02,9002313.02,0,"IX","B",9002313.02,.01)

"^DD",9002313.02,9002313.02,0,"IX","C",9002313.02,1.01)

"^DD",9002313.02,9002313.02,0,"NM","BPS CLAIMS")

"^DD",9002313.02,9002313.02,0,"PT",9002313.03,.01)

"^DD",9002313.02,9002313.02,0,"PT",9002313.31,.03)

"^DD",9002313.02,9002313.02,0,"PT",9002313.57,3)

"^DD",9002313.02,9002313.02,0,"PT",9002313.57,401)

"^DD",9002313.02,9002313.02,0,"PT",9002313.59,3)

"^DD",9002313.02,9002313.02,0,"PT",9002313.59,401)

"^DD",9002313.02,9002313.02,0,"VRPK")
BPS
"^DD",9002313.02,9002313.02,.01,0)
CLAIM ID^F^^0;1^K:$L(X)>32!($L(X)<1) X
"^DD",9002313.02,9002313.02,.01,1,0)
^.1
"^DD",9002313.02,9002313.02,.01,1,1,0)
9002313.02^B^MUMPS
"^DD",9002313.02,9002313.02,.01,1,1,1)
S ^BPSC("B",$E(X,1,32),DA)=""
"^DD",9002313.02,9002313.02,.01,1,1,2)
K ^BPSC("B",$E(X,1,32),DA)
"^DD",9002313.02,9002313.02,.01,1,1,"DT")
3030725
"^DD",9002313.02,9002313.02,.01,3)
Answer must be 1-32 characters in length.
"^DD",9002313.02,9002313.02,.01,21,0)
^^4^4^3080604^
"^DD",9002313.02,9002313.02,.01,21,1,0)
External Claim ID value.  This value is a concatenation of the text 'VA'
"^DD",9002313.02,9002313.02,.01,21,2,0)
along with the current year, the pharmacy ID, the VA National Plan ID
"^DD",9002313.02,9002313.02,.01,21,3,0)
(without the alpha prefix), and a unique sequence number.  Each of the
"^DD",9002313.02,9002313.02,.01,21,4,0)
four pieces is delimited by the equal sign ("=").
"^DD",9002313.02,9002313.02,.01,"DT")
3080604
"^DD",9002313.02,9002313.02,.02,0)
ELECTRONIC PAYER^P9002313.92'^BPSF(9002313.92,^0;2^Q
"^DD",9002313.02,9002313.02,.02,3)
Enter the payer sheet for the claim
"^DD",9002313.02,9002313.02,.02,21,0)
^^1^1^3050729^
"^DD",9002313.02,9002313.02,.02,21,1,0)
This is the payer sheet used by the claim
"^DD",9002313.02,9002313.02,.02,"DT")
3080102
"^DD",9002313.02,9002313.02,.04,0)
TRANSMIT FLAG^S^1:YES (BATCH FILE);0:NO;2:YES (POINT OF SALE);^0;4^Q
"^DD",9002313.02,9002313.02,.04,1,0)
^.1
"^DD",9002313.02,9002313.02,.04,1,1,0)
9002313.02^AD
"^DD",9002313.02,9002313.02,.04,1,1,1)
S ^BPSC("AD",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.02,.04,1,1,2)
K ^BPSC("AD",$E(X,1,30),DA)
"^DD",9002313.02,9002313.02,.04,1,1,"DT")
2950524
"^DD",9002313.02,9002313.02,.04,3)
Specify if this claim should be transmitted and the mode.
"^DD",9002313.02,9002313.02,.04,21,0)
^.001^2^2^3050316^^
"^DD",9002313.02,9002313.02,.04,21,1,0)
Numerical code to indicate a transmit status.  Current values are 0 for 
"^DD",9002313.02,9002313.02,.04,21,2,0)
'No' 1 for 'Yes' Batch and 2 for 'Yes' Point of Sale.
"^DD",9002313.02,9002313.02,.04,"DT")
3080102
"^DD",9002313.02,9002313.02,.05,0)
TRANSMITTED ON^DO^^0;5^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.02,9002313.02,.05,.1)

"^DD",9002313.02,9002313.02,.05,1,0)
^.1
"^DD",9002313.02,9002313.02,.05,1,1,0)
9002313.02^AE
"^DD",9002313.02,9002313.02,.05,1,1,1)
S ^BPSC("AE",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.02,.05,1,1,2)
K ^BPSC("AE",$E(X,1,30),DA)
"^DD",9002313.02,9002313.02,.05,1,1,"DT")
2950622
"^DD",9002313.02,9002313.02,.05,2)
S Y(0)=Y S Y=$$FM2EXT^BPSOSU1(Y)
"^DD",9002313.02,9002313.02,.05,2.1)
S Y=$$FM2EXT^BPSOSU1(Y)
"^DD",9002313.02,9002313.02,.05,3)
Enter Date/Time this claim was transmitted
"^DD",9002313.02,9002313.02,.05,21,0)
^^1^1^3080102^
"^DD",9002313.02,9002313.02,.05,21,1,0)
Date on which the data was transmitted.
"^DD",9002313.02,9002313.02,.05,"DT")
3080102
"^DD",9002313.02,9002313.02,.06,0)
CREATED ON^DO^^0;6^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.02,9002313.02,.06,2)
S Y(0)=Y S Y=$$FM2EXT^BPSOSU1(Y)
"^DD",9002313.02,9002313.02,.06,2.1)
S Y=$$FM2EXT^BPSOSU1(Y)
"^DD",9002313.02,9002313.02,.06,3)
Enter Date/Time this claim was created
"^DD",9002313.02,9002313.02,.06,21,0)
^^1^1^3031125^^
"^DD",9002313.02,9002313.02,.06,21,1,0)
Date on which this record was created.
"^DD",9002313.02,9002313.02,.06,"DT")
3080102
"^DD",9002313.02,9002313.02,.07,0)
AUTO REVERSE FLAG^S^0:NO;1:UNRELEASED CLAIM;2:INPATIENT CLAIM;^0;7^Q
"^DD",9002313.02,9002313.02,.07,3)
If auto-reversed, enter the type of auto-reversal
"^DD",9002313.02,9002313.02,.07,21,0)
^^3^3^3060105^
"^DD",9002313.02,9002313.02,.07,21,1,0)
This flag is marking ECME Claims that were automatically reversed because 
"^DD",9002313.02,9002313.02,.07,21,2,0)
the Prescription was not released in time or the claim was an inpatient 
"^DD",9002313.02,9002313.02,.07,21,3,0)
claim.
"^DD",9002313.02,9002313.02,.07,"DT")
3060105
"^DD",9002313.02,9002313.02,1.01,0)
PATIENT NAME^F^^1;1^K:X[""""!($A(X)=45) X I $D(X) K:$L(X)>30!($L(X)<1) X
"^DD",9002313.02,9002313.02,1.01,1,0)
^.1
"^DD",9002313.02,9002313.02,1.01,1,1,0)
9002313.02^C
"^DD",9002313.02,9002313.02,1.01,1,1,1)
S ^BPSC("C",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.02,1.01,1,1,2)
K ^BPSC("C",$E(X,1,30),DA)
"^DD",9002313.02,9002313.02,1.01,1,1,"DT")
2950606
"^DD",9002313.02,9002313.02,1.01,3)
Answer must be 1-30 characters in length.
"^DD",9002313.02,9002313.02,1.01,21,0)
^^2^2^3040331^
"^DD",9002313.02,9002313.02,1.01,21,1,0)
Patient name extracted from the VA patient file.  This entry is free text 
"^DD",9002313.02,9002313.02,1.01,21,2,0)
to accommodate the NCPDP formatting requirements.
"^DD",9002313.02,9002313.02,1.01,"DT")
3080102
"^DD",9002313.02,9002313.02,1.04,0)
GROUP INSURANCE PLAN^P355.3'^IBA(355.3,^1;4^Q
"^DD",9002313.02,9002313.02,1.04,3)
Enter the Group Insurance
"^DD",9002313.02,9002313.02,1.04,21,0)
^^1^1^3061120^
"^DD",9002313.02,9002313.02,1.04,21,1,0)
Internal identifier number for the Group Insurance Record
"^DD",9002313.02,9002313.02,1.04,"DT")
3080102
"^DD",9002313.02,9002313.02,101,0)
BIN NUMBER^F^^100;1^K:$L(X)>6!($L(X)<6) X
"^DD",9002313.02,9002313.02,101,3)
Answer must be 6 characters in length.
"^DD",9002313.02,9002313.02,101,21,0)
^^1^1^3031124^
"^DD",9002313.02,9002313.02,101,21,1,0)
Card Issuer ID or Bank ID Number used for network routing.
"^DD",9002313.02,9002313.02,101,"DT")
3080102
"^DD",9002313.02,9002313.02,102,0)
VERSION RELEASE NUMBER^F^^100;2^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.02,102,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.02,102,21,0)
^^2^2^3031124^
"^DD",9002313.02,9002313.02,102,21,1,0)
Code identifying the Enrollment Standard format of the file sent or 
"^DD",9002313.02,9002313.02,102,21,2,0)
received.
"^DD",9002313.02,9002313.02,102,"DT")
3080102
"^DD",9002313.02,9002313.02,103,0)
TRANSACTION CODE^F^^100;3^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.02,103,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.02,103,21,0)
^^15^15^3031124^
"^DD",9002313.02,9002313.02,103,21,1,0)
Code to identify the transaction type for this claim.
"^DD",9002313.02,9002313.02,103,21,2,0)
E1=Eligibility Verification
"^DD",9002313.02,9002313.02,103,21,3,0)
B1=Billing
"^DD",9002313.02,9002313.02,103,21,4,0)
B2=Reversal
"^DD",9002313.02,9002313.02,103,21,5,0)
B3=Rebill
"^DD",9002313.02,9002313.02,103,21,6,0)
P1=P.A. Request & Billing
"^DD",9002313.02,9002313.02,103,21,7,0)
P2=P.A. Reversal
"^DD",9002313.02,9002313.02,103,21,8,0)
P3=P.A. Inquiry
"^DD",9002313.02,9002313.02,103,21,9,0)
P4=P.A. Request Only
"^DD",9002313.02,9002313.02,103,21,10,0)
N1=Information Reporting
"^DD",9002313.02,9002313.02,103,21,11,0)
N2=Information Reporting Reversal
"^DD",9002313.02,9002313.02,103,21,12,0)
N3=Information Reporting Rebill
"^DD",9002313.02,9002313.02,103,21,13,0)
C1=Controlled Substance Reporting
"^DD",9002313.02,9002313.02,103,21,14,0)
C2=Controlled Substance Reporting Reversal
"^DD",9002313.02,9002313.02,103,21,15,0)
C3=Controlled Substance Reporting Rebill
"^DD",9002313.02,9002313.02,103,"DT")
3080102
"^DD",9002313.02,9002313.02,104,0)
PROCESSOR CONTROL NUMBER^F^^100;4^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.02,104,3)
Answer must be 10 characters in length.
"^DD",9002313.02,9002313.02,104,21,0)
^^2^2^3080102^
"^DD",9002313.02,9002313.02,104,21,1,0)
Number which will uniquely identify the submitter of the claim.  NCPDP 
"^DD",9002313.02,9002313.02,104,21,2,0)
field 104-A4.
"^DD",9002313.02,9002313.02,104,"DT")
3080102
"^DD",9002313.02,9002313.02,109,0)
TRANSACTION COUNT^F^^100;9^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.02,109,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.02,109,21,0)
^^1^1^3080102^
"^DD",9002313.02,9002313.02,109,21,1,0)
Count of transactions in the transmission.  NCPDP standard field 109-A9.
"^DD",9002313.02,9002313.02,109,23,0)
^^2^2^3080102^
"^DD",9002313.02,9002313.02,109,23,1,0)
A transaction count of >1 is not allowed for Eligibility and Prior 
"^DD",9002313.02,9002313.02,109,23,2,0)
Authorization transactions.  REQUEST TRANSACTION HEADER SEGMENT.
"^DD",9002313.02,9002313.02,109,"DT")
3080102
"^DD",9002313.02,9002313.02,110,0)
SOFTWARE VENDER CERT ID^F^^100;10^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.02,110,3)
Answer must be 10 characters in length.
"^DD",9002313.02,9002313.02,110,21,0)
^^2^2^3080604^
"^DD",9002313.02,9002313.02,110,21,1,0)
Certification number which Identifies the patient's insurance carrier.  
"^DD",9002313.02,9002313.02,110,21,2,0)
NCPDP standard field 110-AK.
"^DD",9002313.02,9002313.02,110,23,0)
^^1^1^3080102^
"^DD",9002313.02,9002313.02,110,23,1,0)
REQUEST TRANSACTION HEADER SEGMENT.
"^DD",9002313.02,9002313.02,110,"DT")
3080604
"^DD",9002313.02,9002313.02,201,0)
SERVICE PROVIDER ID^F^^200;1^K:$L(X)>15!($L(X)<15) X
"^DD",9002313.02,9002313.02,201,3)
Answer must be 15 characters in length
"^DD",9002313.02,9002313.02,201,21,0)
^^1^1^3080102^
"^DD",9002313.02,9002313.02,201,21,1,0)
ID assigned to a pharmacy or provider.  NCPDP standard field 201-B1.
"^DD",9002313.02,9002313.02,201,23,0)
^^2^2^3080102^
"^DD",9002313.02,9002313.02,201,23,1,0)
REQUEST TRANSACTION HEADER SEGMENT.
"^DD",9002313.02,9002313.02,201,23,2,0)
RESPONSE HEADER SEGMENT.
"^DD",9002313.02,9002313.02,201,"DT")
3080102
"^DD",9002313.02,9002313.02,202,0)
SERVICE PROVIDER ID QUAL^F^^200;2^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.02,202,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.02,202,21,0)
^^2^2^3080102^
"^DD",9002313.02,9002313.02,202,21,1,0)
Qualifier indicating which ID number was used.  NCPDP standard field 
"^DD",9002313.02,9002313.02,202,21,2,0)
202-B2.
"^DD",9002313.02,9002313.02,202,23,0)
^^2^2^3080102^
"^DD",9002313.02,9002313.02,202,23,1,0)
REQUEST TRANSACTION HEADER SEGMENT.
"^DD",9002313.02,9002313.02,202,23,2,0)
RESPONSE HEADER SEGMENT.
"^DD",9002313.02,9002313.02,202,"DT")
3080102
"^DD",9002313.02,9002313.02,301,0)
GROUP ID^F^^300;1^K:$L(X)>17!($L(X)<17) X
"^DD",9002313.02,9002313.02,301,3)
Answer must be 17 characters in length
"^DD",9002313.02,9002313.02,301,21,0)
^^2^2^3080102^
"^DD",9002313.02,9002313.02,301,21,1,0)
ID assigned to the cardholder group or employer group.  NCPDP standard 
"^DD",9002313.02,9002313.02,301,21,2,0)
field 301-C1.
"^DD",9002313.02,9002313.02,301,23,0)
^^2^2^3080102^
"^DD",9002313.02,9002313.02,301,23,1,0)
REQUEST INSURANCE SEGMENT.
"^DD",9002313.02,9002313.02,301,23,2,0)
RESPONSE INSURANCE SEGMENT.
"^DD",9002313.02,9002313.02,301,"DT")
3080102
"^DD",9002313.02,9002313.02,302,0)
CARDHOLDER ID^F^^300;2^K:$L(X)>20!($L(X)<2) X
"^DD",9002313.02,9002313.02,302,3)
Answer must be 2-20 characters in length
"^DD",9002313.02,9002313.02,302,21,0)
^^2^2^3080102^
"^DD",9002313.02,9002313.02,302,21,1,0)
Insurance ID assigned to the cardholder or identification number used by
"^DD",9002313.02,9002313.02,302,21,2,0)
the plan.  NCPDP standard field 302-C2.
"^DD",9002313.02,9002313.02,302,23,0)
^^2^2^3080102^
"^DD",9002313.02,9002313.02,302,23,1,0)
REQUEST INSURANCE SEGMENT.
"^DD",9002313.02,9002313.02,302,23,2,0)
RESPONSE INSURANCE SEGMENT.
"^DD",9002313.02,9002313.02,302,"DT")
3080102
"^DD",9002313.02,9002313.02,303,0)
PERSON CODE^F^^300;3^K:$L(X)>5!($L(X)<5) X
"^DD",9002313.02,9002313.02,303,3)
Answer must be 5 characters in length
"^DD",9002313.02,9002313.02,303,21,0)
^^2^2^3080102^
"^DD",9002313.02,9002313.02,303,21,1,0)
Code assigned to a specific person within a family.  NCPDP standard field 
"^DD",9002313.02,9002313.02,303,21,2,0)
303-C3.
"^DD",9002313.02,9002313.02,303,23,0)
^^8^8^3080102^
"^DD",9002313.02,9002313.02,303,23,1,0)
Regarding the Telecommunication Standard:
"^DD",9002313.02,9002313.02,303,23,2,0)
REQUEST INSURANCE SEGMENT.
"^DD",9002313.02,9002313.02,303,23,3,0)
- - - - - - - - - - - - - - - - - - - - - - -
"^DD",9002313.02,9002313.02,303,23,4,0)
Enrollment Standard Examples:
"^DD",9002313.02,9002313.02,303,23,5,0)
Examples:
"^DD",9002313.02,9002313.02,303,23,6,0)
001=Cardholder
"^DD",9002313.02,9002313.02,303,23,7,0)
002=Spouse
"^DD",9002313.02,9002313.02,303,23,8,0)
003-999=Dependents and Others (including second spouses, etc.)
"^DD",9002313.02,9002313.02,303,"DT")
3080102
"^DD",9002313.02,9002313.02,304,0)
DATE OF BIRTH^F^^300;4^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.02,304,2)
S Y(0)=Y S Y=$$FM3EXT^BPSOSU1(Y)
"^DD",9002313.02,9002313.02,304,2.1)
S Y=$$FM3EXT^BPSOSU1(Y)
"^DD",9002313.02,9002313.02,304,3)
Answer must be 10 characters in length
"^DD",9002313.02,9002313.02,304,21,0)
^^1^1^3080102^
"^DD",9002313.02,9002313.02,304,21,1,0)
Date of birth of patient.  NCPDP standard field 304-C4.
"^DD",9002313.02,9002313.02,304,23,0)
^^8^8^3080102^
"^DD",9002313.02,9002313.02,304,23,1,0)
Format=CCYYMMDD
"^DD",9002313.02,9002313.02,304,23,2,0)
CC=Century
"^DD",9002313.02,9002313.02,304,23,3,0)
YY=Year
"^DD",9002313.02,9002313.02,304,23,4,0)
MM=Month
"^DD",9002313.02,9002313.02,304,23,5,0)
DD=Day
"^DD",9002313.02,9002313.02,304,23,6,0)
Examples: If a patient was born on July 27, 1970, this field would 
"^DD",9002313.02,9002313.02,304,23,7,0)
reflect: 19700727.
"^DD",9002313.02,9002313.02,304,23,8,0)
REQUEST PATIENT SEGMENT. RESPONSE PATIENT SEGMENT.
"^DD",9002313.02,9002313.02,304,"DT")
3080102
"^DD",9002313.02,9002313.02,305,0)
PATIENT GENDER CODE^FO^^300;5^K:$L(X)>3!($L(X)<3) X
"^DD",9002313.02,9002313.02,305,2)
S Y(0)=Y S Y=$S(Y="C51":"MALE",Y="C52":"FEMALE",1:Y)
"^DD",9002313.02,9002313.02,305,2.1)
S Y=$S(Y="C51":"MALE",Y="C52":"FEMALE",1:Y)
"^DD",9002313.02,9002313.02,305,3)
Answer must be 3 characters in length
"^DD",9002313.02,9002313.02,305,21,0)
^^6^6^3080613^
"^DD",9002313.02,9002313.02,305,21,1,0)
One of three codes to indicate the gender of the patient.
"^DD",9002313.02,9002313.02,305,21,2,0)
0 = Not Specific
"^DD",9002313.02,9002313.02,305,21,3,0)
1 = Male
"^DD",9002313.02,9002313.02,305,21,4,0)
2 = Female
"^DD",9002313.02,9002313.02,305,21,5,0)
 
"^DD",9002313.02,9002313.02,305,21,6,0)
NCPDP standard field 305-C5.
"^DD",9002313.02,9002313.02,305,23,0)
^^1^1^3080102^
"^DD",9002313.02,9002313.02,305,23,1,0)
REQUEST PATIENT SEGMENT.
"^DD",9002313.02,9002313.02,305,"DT")
3080613
"^DD",9002313.02,9002313.02,306,0)
PATIENT RELATIONSHIP CODE^FO^^300;6^K:$L(X)>3!($L(X)<3) X
"^DD",9002313.02,9002313.02,306,2)
S Y(0)=Y S Y=$S(Y="C61":"CARDHOLDER",Y="C62":"SPOUSE",Y="C63":"CHILD",1:Y)
"^DD",9002313.02,9002313.02,306,2.1)
S Y=$S(Y="C61":"CARDHOLDER",Y="C62":"SPOUSE",Y="C63":"CHILD",1:Y)
"^DD",9002313.02,9002313.02,306,3)
Answer must be 3 characters in length
"^DD",9002313.02,9002313.02,306,21,0)
^^2^2^3080102^
"^DD",9002313.02,9002313.02,306,21,1,0)
Code indicating relationship of patient to cardholder.  NCPDP standard 
"^DD",9002313.02,9002313.02,306,21,2,0)
field 306-C6.
"^DD",9002313.02,9002313.02,306,23,0)
^^1^1^3080102^
"^DD",9002313.02,9002313.02,306,23,1,0)
REQUEST INSURANCE SEGMENT.
"^DD",9002313.02,9002313.02,306,"DT")
3080102
"^DD",9002313.02,9002313.02,307,0)
PLACE OF SERVICE^F^^300;7^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.02,307,3)
Answer must be 4 characters in length
"^DD",9002313.02,9002313.02,307,21,0)
^^15^15^3080102^
"^DD",9002313.02,9002313.02,307,21,1,0)
Code identifying the location of the patient when receiving pharmacy 
"^DD",9002313.02,9002313.02,307,21,2,0)
services.  NCPDP standard field 307-C7.  (was PATIENT LOCATION)
"^DD",9002313.02,9002313.02,307,21,3,0)
 
"^DD",9002313.02,9002313.02,307,21,4,0)
=Not Specified
"^DD",9002313.02,9002313.02,307,21,5,0)
1=Home
"^DD",9002313.02,9002313.02,307,21,6,0)
2=Inter-Care
"^DD",9002313.02,9002313.02,307,21,7,0)
3=Nursing Home
"^DD",9002313.02,9002313.02,307,21,8,0)
4=Long Term/Extended Care
"^DD",9002313.02,9002313.02,307,21,9,0)
5=Rest Home
"^DD",9002313.02,9002313.02,307,21,10,0)
6=Boarding Home
"^DD",9002313.02,9002313.02,307,21,11,0)
7=Skilled Care Facility
"^DD",9002313.02,9002313.02,307,21,12,0)
8=Sub-Acute Care Facility
"^DD",9002313.02,9002313.02,307,21,13,0)
9=Acute Care Facility
"^DD",9002313.02,9002313.02,307,21,14,0)
1=Outpatient
"^DD",9002313.02,9002313.02,307,21,15,0)
11=Hospice
"^DD",9002313.02,9002313.02,307,23,0)
^^1^1^3080102^
"^DD",9002313.02,9002313.02,307,23,1,0)
REQUEST PATIENT SEGMENT.
"^DD",9002313.02,9002313.02,307,"DT")
3080102
"^DD",9002313.02,9002313.02,309,0)
ELIGIBILITY CLARIFICATION CODE^F^^300;9^K:$L(X)>3!($L(X)<3) X
"^DD",9002313.02,9002313.02,309,3)
Answer must be 3 characters in length
"^DD",9002313.02,9002313.02,309,21,0)
^^2^2^3080102^
"^DD",9002313.02,9002313.02,309,21,1,0)
Code indicating that the pharmacy is clarifying eligibility based on 
"^DD",9002313.02,9002313.02,309,21,2,0)
receiving a denial.  NCPDP standard field 309-C9.
"^DD",9002313.02,9002313.02,309,23,0)
^^4^4^3080102^
"^DD",9002313.02,9002313.02,309,23,1,0)
Examples: The patient has become a student but eligibility has not yet 
"^DD",9002313.02,9002313.02,309,23,2,0)
been updated. The pharmacy can indicate "3" so that the carrier may 
"^DD",9002313.02,9002313.02,309,23,3,0)
override eligibility for this patient.
"^DD",9002313.02,9002313.02,309,23,4,0)
REQUEST INSURANCE SEGMENT.
"^DD",9002313.02,9002313.02,309,"DT")
3080102
"^DD",9002313.02,9002313.02,310,0)
PATIENT FIRST NAME^F^^300;10^K:$L(X)>14!($L(X)<14) X
"^DD",9002313.02,9002313.02,310,3)
Answer must be 14 characters in length
"^DD",9002313.02,9002313.02,310,21,0)
^^2^2^3080102^
"^DD",9002313.02,9002313.02,310,21,1,0)
First name of patient receiving the prescription.  NCPDP standard field 
"^DD",9002313.02,9002313.02,310,21,2,0)
310-CA.
"^DD",9002313.02,9002313.02,310,23,0)
^^2^2^3080102^
"^DD",9002313.02,9002313.02,310,23,1,0)
REQUEST PATIENT SEGMENT.
"^DD",9002313.02,9002313.02,310,23,2,0)
RESPONSE PATIENT SEGMENT
"^DD",9002313.02,9002313.02,310,"DT")
3080102
"^DD",9002313.02,9002313.02,311,0)
PATIENT LAST NAME^F^^300;11^K:$L(X)>17!($L(X)<17) X
"^DD",9002313.02,9002313.02,311,3)
Answer must be 17 characters in length
"^DD",9002313.02,9002313.02,311,21,0)
^^2^2^3080102^
"^DD",9002313.02,9002313.02,311,21,1,0)
Last Name of patient receiving the prescription.  NCPDP standard field 
"^DD",9002313.02,9002313.02,311,21,2,0)
311-CB.
"^DD",9002313.02,9002313.02,311,23,0)
^^1^1^3080102^
"^DD",9002313.02,9002313.02,311,23,1,0)
REQUEST PATIENT SEGMENT. RESPONSE PATIENT SEGMENT
"^DD",9002313.02,9002313.02,311,"DT")
3080102
"^DD",9002313.02,9002313.02,312,0)
CARDHOLDER FIRST NAME^F^^300;12^K:$L(X)>14!($L(X)<14) X
"^DD",9002313.02,9002313.02,312,3)
Answer must be 14 characters in length
"^DD",9002313.02,9002313.02,312,21,0)
^^1^1^3080102^
"^DD",9002313.02,9002313.02,312,21,1,0)
First name of the Cardholder/Subscriber.  NCPDP standard field 312-CC.
"^DD",9002313.02,9002313.02,312,23,0)
^^1^1^3080102^
"^DD",9002313.02,9002313.02,312,23,1,0)
REQUEST INSURANCE SEGMENT
"^DD",9002313.02,9002313.02,312,"DT")
3080102
"^DD",9002313.02,9002313.02,313,0)
CARDHOLDER LAST NAME^F^^300;13^K:$L(X)>17!($L(X)<17) X
"^DD",9002313.02,9002313.02,313,3)
Answer must be 17 characters in length
"^DD",9002313.02,9002313.02,313,21,0)
^^1^1^3080102^
"^DD",9002313.02,9002313.02,313,21,1,0)
Last name of the cardholder/subscriber.  NCPDP standard field 313-CD.
"^DD",9002313.02,9002313.02,313,23,0)
^^1^1^3080102^
"^DD",9002313.02,9002313.02,313,23,1,0)
REQUEST INSURANCE SEGMENT
"^DD",9002313.02,9002313.02,313,"DT")
3080102
"^DD",9002313.02,9002313.02,314,0)
HOME PLAN^F^^300;14^K:$L(X)>5!($L(X)<5) X
"^DD",9002313.02,9002313.02,314,3)
Answer must be 5 characters in length
"^DD",9002313.02,9002313.02,314,21,0)
^^3^3^3080102^
"^DD",9002313.02,9002313.02,314,21,1,0)
Code identifying the Blue Cross or Blue Shield plan ID which indicates 
"^DD",9002313.02,9002313.02,314,21,2,0)
where the member's coverage has been designated. Usually where the member 
"^DD",9002313.02,9002313.02,314,21,3,0)
lives or purchased their coverage.  NCPDP standard field 314-CE.
"^DD",9002313.02,9002313.02,314,23,0)
^^4^4^3080102^
"^DD",9002313.02,9002313.02,314,23,1,0)
Used for interstate processing between Blue Cross and Blue Shield plans.
"^DD",9002313.02,9002313.02,314,23,2,0)
The Blue Cross codes are in the range less than 600 and Blue Shield codes
"^DD",9002313.02,9002313.02,314,23,3,0)
are greater than 599.
"^DD",9002313.02,9002313.02,314,23,4,0)
REQUEST INSURANCE SEGMENT
"^DD",9002313.02,9002313.02,314,"DT")
3080102
"^DD",9002313.02,9002313.02,322,0)
PATIENT STREET ADDRESS^F^^321;2^K:$L(X)>32!($L(X)<32) X
"^DD",9002313.02,9002313.02,322,3)
Answer must be 32 characters in length
"^DD",9002313.02,9002313.02,322,21,0)
^^2^2^3080102^
"^DD",9002313.02,9002313.02,322,21,1,0)
Free-form text for Patient address information.  NCPDP standard field 
"^DD",9002313.02,9002313.02,322,21,2,0)
322-CM.
"^DD",9002313.02,9002313.02,322,23,0)
^^1^1^3080102^
"^DD",9002313.02,9002313.02,322,23,1,0)
REQUEST PATIENT SEGMENT
"^DD",9002313.02,9002313.02,322,"DT")
3080102
"^DD",9002313.02,9002313.02,323,0)
PATIENT CITY ADDRESS^F^^321;3^K:$L(X)>22!($L(X)<22) X
"^DD",9002313.02,9002313.02,323,3)
Answer must be 22 characters in length
"^DD",9002313.02,9002313.02,323,21,0)
^^1^1^3080102^
"^DD",9002313.02,9002313.02,323,21,1,0)
Free-form text for city name.  NCPDP standard field 323-CN.
"^DD",9002313.02,9002313.02,323,23,0)
^^1^1^3080102^
"^DD",9002313.02,9002313.02,323,23,1,0)
REQUEST PATIENT SEGMENT
"^DD",9002313.02,9002313.02,323,"DT")
3080102
"^DD",9002313.02,9002313.02,324,0)
PATIENT STATE PROV ADDRESS^F^^321;4^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.02,324,3)
Answer must be 4 characters in length
"^DD",9002313.02,9002313.02,324,21,0)
^^2^2^3080102^
"^DD",9002313.02,9002313.02,324,21,1,0)
Standard State/Province Code as defined by appropriate government 
"^DD",9002313.02,9002313.02,324,21,2,0)
agency.  NCPDP standard field 324-CO.
"^DD",9002313.02,9002313.02,324,23,0)
^^3^3^3080102^
"^DD",9002313.02,9002313.02,324,23,1,0)
Standard United States and Canadian province two-letter postal service 
"^DD",9002313.02,9002313.02,324,23,2,0)
abbreviations should be used.
"^DD",9002313.02,9002313.02,324,23,3,0)
REQUEST PATIENT SEGMENT
"^DD",9002313.02,9002313.02,324,"DT")
3080102
"^DD",9002313.02,9002313.02,325,0)
PATIENT ZIP POSTAL ZONE^F^^321;5^K:$L(X)>17!($L(X)<1) X
"^DD",9002313.02,9002313.02,325,3)
Answer must be 1-17 characters in length
"^DD",9002313.02,9002313.02,325,21,0)
^^2^2^3080102^
"^DD",9002313.02,9002313.02,325,21,1,0)
Code defining international postal zone excluding punctuation and blanks 
"^DD",9002313.02,9002313.02,325,21,2,0)
(zip code for US).  NCPDP standard field 325-CP.
"^DD",9002313.02,9002313.02,325,23,0)
^^9^9^3080102^
"^DD",9002313.02,9002313.02,325,23,1,0)
This left-justified field contains the five-digit zip code, and may 
"^DD",9002313.02,9002313.02,325,23,2,0)
include the four-digit expanded zip code in which the patient is located.
"^DD",9002313.02,9002313.02,325,23,3,0)
 
"^DD",9002313.02,9002313.02,325,23,4,0)
Examples: If the zip code is 98765-4321, this field would reflect: 
"^DD",9002313.02,9002313.02,325,23,5,0)
987654321.
"^DD",9002313.02,9002313.02,325,23,6,0)
 
"^DD",9002313.02,9002313.02,325,23,7,0)
If the zip code is 98765, this field would reflect: 98765 left justified.
"^DD",9002313.02,9002313.02,325,23,8,0)
 
"^DD",9002313.02,9002313.02,325,23,9,0)
REQUEST PATIENT SEGMENT
"^DD",9002313.02,9002313.02,325,"DT")
3080102
"^DD",9002313.02,9002313.02,326,0)
PATIENT PHONE NUMBER^F^^321;6^K:$L(X)>12!($L(X)<12) X
"^DD",9002313.02,9002313.02,326,3)
Answer must be 12 characters in length
"^DD",9002313.02,9002313.02,326,21,0)
^^1^1^3080102^
"^DD",9002313.02,9002313.02,326,21,1,0)
Ten-digit phone number of patient.  NCPDP standard field 326-CQ.
"^DD",9002313.02,9002313.02,326,23,0)
^^9^9^3080102^
"^DD",9002313.02,9002313.02,326,23,1,0)
Format=AAAEEENNNN
"^DD",9002313.02,9002313.02,326,23,2,0)
AAA=Area Code
"^DD",9002313.02,9002313.02,326,23,3,0)
EEE=Exchange
"^DD",9002313.02,9002313.02,326,23,4,0)
NNNN=Number
"^DD",9002313.02,9002313.02,326,23,5,0)
 
"^DD",9002313.02,9002313.02,326,23,6,0)
Examples: If the phone number is (313) 555-1212, this field would 
"^DD",9002313.02,9002313.02,326,23,7,0)
reflect: 3135551212.
"^DD",9002313.02,9002313.02,326,23,8,0)
 
"^DD",9002313.02,9002313.02,326,23,9,0)
REQUEST PATIENT SEGMENT
"^DD",9002313.02,9002313.02,326,"DT")
3080102
"^DD",9002313.02,9002313.02,331,0)
PATIENT ID QUALIFIER^F^^330;1^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.02,331,3)
Answer must be 4 characters in length
"^DD",9002313.02,9002313.02,331,21,0)
^^7^7^3080102^
"^DD",9002313.02,9002313.02,331,21,1,0)
Code qualifying the 'Patient ID'(332-CY).  NCPDP standard field 331-CX.
"^DD",9002313.02,9002313.02,331,21,2,0)
 
"^DD",9002313.02,9002313.02,331,21,3,0)
Blank=Not Specified
"^DD",9002313.02,9002313.02,331,21,4,0)
1=Social Security Number
"^DD",9002313.02,9002313.02,331,21,5,0)
2=Driver's License Number
"^DD",9002313.02,9002313.02,331,21,6,0)
3=U.S. Military ID
"^DD",9002313.02,9002313.02,331,21,7,0)
99=Other
"^DD",9002313.02,9002313.02,331,23,0)
^^1^1^3080102^
"^DD",9002313.02,9002313.02,331,23,1,0)
REQUEST PATIENT SEGMENT
"^DD",9002313.02,9002313.02,331,"DT")
3080102
"^DD",9002313.02,9002313.02,332,0)
PATIENT ID^F^^330;2^K:$L(X)>22!($L(X)<22) X
"^DD",9002313.02,9002313.02,332,3)
Answer must be 22 characters in length
"^DD",9002313.02,9002313.02,332,21,0)
^^1^1^3080102^
"^DD",9002313.02,9002313.02,332,21,1,0)
ID assigned to the patient.  NCPDP standard field 332-CY.
"^DD",9002313.02,9002313.02,332,23,0)
^^2^2^3080102^
"^DD",9002313.02,9002313.02,332,23,1,0)
Qualified by Patient Id Qualifier (331-CX).
"^DD",9002313.02,9002313.02,332,23,2,0)
REQUEST PATIENT SEGMENT
"^DD",9002313.02,9002313.02,332,"DT")
3080102
"^DD",9002313.02,9002313.02,333,0)
EMPLOYER ID^F^^330;3^K:$L(X)>17!($L(X)<17) X
"^DD",9002313.02,9002313.02,333,3)
Answer must be 17 characters in length
"^DD",9002313.02,9002313.02,333,21,0)
^^1^1^3080102^
"^DD",9002313.02,9002313.02,333,21,1,0)
ID assigned to employer.  NCPDP standard field 333-CZ.
"^DD",9002313.02,9002313.02,333,23,0)
^^6^6^3080102^
"^DD",9002313.02,9002313.02,333,23,1,0)
The Internal Revenue Service, Department of the Treasury, assigns the 
"^DD",9002313.02,9002313.02,333,23,2,0)
Employer ID. The format of this field is nine-digits with a hyphen, as 
"^DD",9002313.02,9002313.02,333,23,3,0)
in 00-0000000. The hyphen must be transmitted as part of the Employer ID 
"^DD",9002313.02,9002313.02,333,23,4,0)
Number. Information on the Employer ID may be found at 
"^DD",9002313.02,9002313.02,333,23,5,0)
http://www.irs.ustreas.gov/.
"^DD",9002313.02,9002313.02,333,23,6,0)
REQUEST PATIENT SEGMENT
"^DD",9002313.02,9002313.02,333,"DT")
3080102
"^DD",9002313.02,9002313.02,334,0)
SMOKER INDICATOR^F^^330;4^K:$L(X)>3!($L(X)<3) X
"^DD",9002313.02,9002313.02,334,3)
Answer must be 3 characters in length
"^DD",9002313.02,9002313.02,334,21,0)
^^6^6^3080102^
"^DD",9002313.02,9002313.02,334,21,1,0)
Code indicating the patient as a smoker or non-smoker.  NCPDP standard 
"^DD",9002313.02,9002313.02,334,21,2,0)
field 334-1C.
"^DD",9002313.02,9002313.02,334,21,3,0)
 
"^DD",9002313.02,9002313.02,334,21,4,0)
Blank=Not Specified
"^DD",9002313.02,9002313.02,334,21,5,0)
1=Non-Smoker
"^DD",9002313.02,9002313.02,334,21,6,0)
2=Smoker
"^DD",9002313.02,9002313.02,334,23,0)
^^1^1^3080102^
"^DD",9002313.02,9002313.02,334,23,1,0)
REQUEST PATIENT SEGMENT
"^DD",9002313.02,9002313.02,334,"DT")
3080102
"^DD",9002313.02,9002313.02,335,0)
PREGNANCY INDICATOR^F^^330;5^K:$L(X)>3!($L(X)<3) X
"^DD",9002313.02,9002313.02,335,3)
Answer must be 3 characters in length
"^DD",9002313.02,9002313.02,335,21,0)
^^6^6^3080102^
"^DD",9002313.02,9002313.02,335,21,1,0)
Code indicating the patient as pregnant or non-pregnant.  NCPDP standard 
"^DD",9002313.02,9002313.02,335,21,2,0)
field 335-2C.
"^DD",9002313.02,9002313.02,335,21,3,0)
 
"^DD",9002313.02,9002313.02,335,21,4,0)
Blank=Not Specified
"^DD",9002313.02,9002313.02,335,21,5,0)
1=Not pregnant
"^DD",9002313.02,9002313.02,335,21,6,0)
2=Pregnant
"^DD",9002313.02,9002313.02,335,23,0)
^^1^1^3080102^
"^DD",9002313.02,9002313.02,335,23,1,0)
REQUEST PATIENT SEGMENT
"^DD",9002313.02,9002313.02,335,"DT")
3080102
"^DD",9002313.02,9002313.02,336,0)
FACILITY ID^F^^330;6^K:$L(X)>12!($L(X)<12) X
"^DD",9002313.02,9002313.02,336,3)
Answer must be 12 characters in length
"^DD",9002313.02,9002313.02,336,21,0)
^^2^2^3080102^
"^DD",9002313.02,9002313.02,336,21,1,0)
ID assigned to the patient's clinic/host party.  NCPDP standard field 
"^DD",9002313.02,9002313.02,336,21,2,0)
336-8C.
"^DD",9002313.02,9002313.02,336,23,0)
^^1^1^3080102^
"^DD",9002313.02,9002313.02,336,23,1,0)
REQUEST INSURANCE SEGMENT
"^DD",9002313.02,9002313.02,336,"DT")
3080102
"^DD",9002313.02,9002313.02,400,0)
MEDICATIONS^9002313.0201A^^400;0
"^DD",9002313.02,9002313.02,400,21,0)
^.001^1^1^3081125^^
"^DD",9002313.02,9002313.02,400,21,1,0)
Medications included in this claim.
"^DD",9002313.02,9002313.02,400,"DT")
3080102
"^DD",9002313.02,9002313.02,401,0)
DATE OF SERVICE^F^^401;1^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.02,9002313.02,401,1,0)
^.1
"^DD",9002313.02,9002313.02,401,1,1,0)
9002313.02^AF
"^DD",9002313.02,9002313.02,401,1,1,1)
S ^BPSC("AF",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.02,401,1,1,2)
K ^BPSC("AF",$E(X,1,30),DA)
"^DD",9002313.02,9002313.02,401,1,1,"DT")
2950724
"^DD",9002313.02,9002313.02,401,3)
Answer must be 8 characters in length
"^DD",9002313.02,9002313.02,401,21,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.02,401,21,1,0)
Date prescription was dispensed.  NCPDP standard field 401-D1.
"^DD",9002313.02,9002313.02,401,23,0)
^^12^12^3080104^
"^DD",9002313.02,9002313.02,401,23,1,0)
Format=CCYYMMDD
"^DD",9002313.02,9002313.02,401,23,2,0)
 
"^DD",9002313.02,9002313.02,401,23,3,0)
CC=Century
"^DD",9002313.02,9002313.02,401,23,4,0)
YY=Year
"^DD",9002313.02,9002313.02,401,23,5,0)
MM=Month
"^DD",9002313.02,9002313.02,401,23,6,0)
DD=Day
"^DD",9002313.02,9002313.02,401,23,7,0)
 
"^DD",9002313.02,9002313.02,401,23,8,0)
Examples: If the prescription was dispensed on April 22, 2000, this field 
"^DD",9002313.02,9002313.02,401,23,9,0)
would reflect 20000422.
"^DD",9002313.02,9002313.02,401,23,10,0)
 
"^DD",9002313.02,9002313.02,401,23,11,0)
REQUEST TRANSACTION HEADER SEGMENT.
"^DD",9002313.02,9002313.02,401,23,12,0)
RESPONSE HEADER SEGMENT.
"^DD",9002313.02,9002313.02,401,"DT")
3080604
"^DD",9002313.02,9002313.02,524,0)
PLAN ID^F^^520;4^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.02,524,3)
Answer must be 10 characters in length
"^DD",9002313.02,9002313.02,524,21,0)
^^3^3^3080104^
"^DD",9002313.02,9002313.02,524,21,1,0)
Assigned by the processor to identify a set of parameters, benefit, or 
"^DD",9002313.02,9002313.02,524,21,2,0)
coverage criteria used to adjudicate a claim.  NCPDP standard field 
"^DD",9002313.02,9002313.02,524,21,3,0)
524-FO.
"^DD",9002313.02,9002313.02,524,23,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.02,524,23,1,0)
REQUEST INSURANCE SEGMENT.
"^DD",9002313.02,9002313.02,524,23,2,0)
RESPONSE INSURANCE SEGMENT.
"^DD",9002313.02,9002313.02,524,"DT")
3080104
"^DD",9002313.02,9002313.02,901,0)
CLOSED^S^0:NO;1:YES;^900;1^Q
"^DD",9002313.02,9002313.02,901,3)
Enter if this claim is closed or not.
"^DD",9002313.02,9002313.02,901,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.02,901,21,1,0)
Specify if the claim has been closed (no longer needed for followup) or 
"^DD",9002313.02,9002313.02,901,21,2,0)
not.
"^DD",9002313.02,9002313.02,901,"DT")
3080104
"^DD",9002313.02,9002313.02,902,0)
DATE CLOSED^D^^900;2^S %DT="ESTX" D ^%DT S X=Y K:X<1 X
"^DD",9002313.02,9002313.02,902,1,0)
^.1
"^DD",9002313.02,9002313.02,902,1,1,0)
9002313.02^AG
"^DD",9002313.02,9002313.02,902,1,1,1)
S ^BPSC("AG",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.02,902,1,1,2)
K ^BPSC("AG",$E(X,1,30),DA)
"^DD",9002313.02,9002313.02,902,1,1,"DT")
3040518
"^DD",9002313.02,9002313.02,902,3)
Enter the date this claim was closed.
"^DD",9002313.02,9002313.02,902,21,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.02,902,21,1,0)
This is automatically populated with the date a claim was closed.
"^DD",9002313.02,9002313.02,902,"DT")
3080104
"^DD",9002313.02,9002313.02,903,0)
CLOSED BY^P200'^VA(200,^900;3^Q
"^DD",9002313.02,9002313.02,903,3)
Enter the person who closed this claim.
"^DD",9002313.02,9002313.02,903,21,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.02,903,21,1,0)
This is automatically populated with the user who closed the claim.
"^DD",9002313.02,9002313.02,903,"DT")
3080104
"^DD",9002313.02,9002313.02,904,0)
CLOSED REASON^*P356.8'^IBE(356.8,^900;4^S DIC("S")="I $P(^IBE(356.8,+Y,0),U,2)" D ^DIC K DIC S DIC=$G(DIE),X=+Y K:Y<0 X
"^DD",9002313.02,9002313.02,904,3)
Enter the Claim Close Reason.
"^DD",9002313.02,9002313.02,904,12)
Only ECME-supported non-billable reasons can be entered.
"^DD",9002313.02,9002313.02,904,12.1)
S DIC("S")="I $P(^IBE(356.8,+Y,0),U,2)"
"^DD",9002313.02,9002313.02,904,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.02,904,21,1,0)
The ECME-supported non-billable reason entered by the user or defaulted by
"^DD",9002313.02,9002313.02,904,21,2,0)
the system.
"^DD",9002313.02,9002313.02,904,"DT")
3080104
"^DD",9002313.02,9002313.02,905,0)
DROP TO PAPER^S^D:DROP TO PAPER;N:NON-BILLABLE;^900;5^Q
"^DD",9002313.02,9002313.02,905,3)
Enter D if this claim should be billed on a paper claim.
"^DD",9002313.02,9002313.02,905,21,0)
^.001^4^4^3050518^^^
"^DD",9002313.02,9002313.02,905,21,1,0)
If close reason is 90 DAY RX FILL NOT COVERED or 
"^DD",9002313.02,9002313.02,905,21,2,0)
NOT A CONTRACTED PROVIDER then user will be prompted:
"^DD",9002313.02,9002313.02,905,21,3,0)
Treat as (N)on-Billable Episode or (D)rop Bill to Paper? 
"^DD",9002313.02,9002313.02,905,21,4,0)
the answer is stored in this field and sent to IB
"^DD",9002313.02,9002313.02,905,"DT")
3080104
"^DD",9002313.02,9002313.02,906,0)
DATE REOPENED^D^^900;6^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.02,9002313.02,906,3)
Enter the date and time when the claim was re-opened
"^DD",9002313.02,9002313.02,906,21,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.02,906,21,1,0)
Date and time when the claim was re-opened.
"^DD",9002313.02,9002313.02,906,"DT")
3080104
"^DD",9002313.02,9002313.02,907,0)
REOPENED BY^P200'^VA(200,^900;7^Q
"^DD",9002313.02,9002313.02,907,3)
Enter the user who re-opened the claim
"^DD",9002313.02,9002313.02,907,21,0)
^^1^1^3060523^
"^DD",9002313.02,9002313.02,907,21,1,0)
The system user who re-opened the claim.
"^DD",9002313.02,9002313.02,907,"DT")
3060614
"^DD",9002313.02,9002313.02,908,0)
REOPENED COMMENT^F^^900;8^K:$L(X)>40!($L(X)<1) X
"^DD",9002313.02,9002313.02,908,3)
Enter the reason for the re-opening of the claim
"^DD",9002313.02,9002313.02,908,21,0)
^^1^1^3060614^
"^DD",9002313.02,9002313.02,908,21,1,0)
User comments for the re-opening of the claim.
"^DD",9002313.02,9002313.02,908,"DT")
3060614
"^DD",9002313.02,9002313.02,9999,0)
RAW DATA SENT^9002313.29999^^M;0
"^DD",9002313.02,9002313.02,9999,3)
Enter the Raw data transmitted to the payer.
"^DD",9002313.02,9002313.02,9999,21,0)
^^1^1^3040331^
"^DD",9002313.02,9002313.02,9999,21,1,0)
An exact copy of the record sent via the communications protocol.
"^DD",9002313.02,9002313.0201,0)
MEDICATIONS SUB-FIELD^^493^105
"^DD",9002313.02,9002313.0201,0,"DT")
3080604
"^DD",9002313.02,9002313.0201,0,"IX","B",9002313.0201,.01)

"^DD",9002313.02,9002313.0201,0,"NM","MEDICATIONS")

"^DD",9002313.02,9002313.0201,0,"UP")
9002313.02
"^DD",9002313.02,9002313.0201,.01,0)
MEDICATION ORDER^MNJ9,0^^0;1^K:+X'=X!(X>999999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.02,9002313.0201,.01,1,0)
^.1
"^DD",9002313.02,9002313.0201,.01,1,1,0)
9002313.0201^B
"^DD",9002313.02,9002313.0201,.01,1,1,1)
S ^BPSC(DA(1),400,"B",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.0201,.01,1,1,2)
K ^BPSC(DA(1),400,"B",$E(X,1,30),DA)
"^DD",9002313.02,9002313.0201,.01,3)
Type a Number between 1 and 999999999, 0 Decimal Digits
"^DD",9002313.02,9002313.0201,.01,21,0)
^^2^2^3080604^
"^DD",9002313.02,9002313.0201,.01,21,1,0)
Numeric value to indicate meds ordered.  This is a sequential value 
"^DD",9002313.02,9002313.0201,.01,21,2,0)
starting at 1 to store multiple medication orders on this BPS Claim.
"^DD",9002313.02,9002313.0201,.01,"DT")
3080604
"^DD",9002313.02,9002313.0201,.04,0)
MEDICATION NAME^F^^0;4^K:$L(X)>50!($L(X)<1) X
"^DD",9002313.02,9002313.0201,.04,3)
Answer must be 1-50 characters in length.
"^DD",9002313.02,9002313.0201,.04,21,0)
^^1^1^3031125^
"^DD",9002313.02,9002313.0201,.04,21,1,0)
Name of the med ordered.
"^DD",9002313.02,9002313.0201,.04,"DT")
3080102
"^DD",9002313.02,9002313.0201,.05,0)
PRESCRIPTION NUMBER^P52'^PSRX(^0;5^Q
"^DD",9002313.02,9002313.0201,.05,3)
Enter the Prescription for this medication
"^DD",9002313.02,9002313.0201,.05,21,0)
^^1^1^3070227^
"^DD",9002313.02,9002313.0201,.05,21,1,0)
This is the prescription associated with the claim
"^DD",9002313.02,9002313.0201,.05,"DT")
3080102
"^DD",9002313.02,9002313.0201,308,0)
OTHER COVERAGE CODE^F^^300;8^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.0201,308,3)
Answer must be 4 characters in length
"^DD",9002313.02,9002313.0201,308,21,0)
^^2^2^3080102^
"^DD",9002313.02,9002313.0201,308,21,1,0)
Code indicating whether or not the patient has other insurance coverage.  
"^DD",9002313.02,9002313.0201,308,21,2,0)
NCPDP standard field 308-C8.
"^DD",9002313.02,9002313.0201,308,23,0)
^^1^1^3080102^
"^DD",9002313.02,9002313.0201,308,23,1,0)
REQUEST CLAIM SEGMENT
"^DD",9002313.02,9002313.0201,308,"DT")
3080102
"^DD",9002313.02,9002313.0201,315,0)
EMPLOYER NAME^F^^310;5^K:$L(X)>32!($L(X)<32) X
"^DD",9002313.02,9002313.0201,315,3)
Answer must be 32 characters in length
"^DD",9002313.02,9002313.0201,315,21,0)
^^1^1^3080102^
"^DD",9002313.02,9002313.0201,315,21,1,0)
Complete name of employer.  NCPDP standard field 315-CF.
"^DD",9002313.02,9002313.0201,315,23,0)
^^1^1^3080102^
"^DD",9002313.02,9002313.0201,315,23,1,0)
REQUEST WORKER'S COMPENSATION SEGMENT
"^DD",9002313.02,9002313.0201,315,"DT")
3080102
"^DD",9002313.02,9002313.0201,316,0)
EMPLOYER STREET ADDRESS^F^^310;6^K:$L(X)>32!($L(X)<32) X
"^DD",9002313.02,9002313.0201,316,3)
Answer must be 32 characters in length
"^DD",9002313.02,9002313.0201,316,21,0)
^^2^2^3080102^
"^DD",9002313.02,9002313.0201,316,21,1,0)
The Street address of the insured's employer.  NCPDP standard field 
"^DD",9002313.02,9002313.0201,316,21,2,0)
316-CG.
"^DD",9002313.02,9002313.0201,316,23,0)
^^1^1^3080102^
"^DD",9002313.02,9002313.0201,316,23,1,0)
REQUEST WORKER S COMPENSATION SEGMENT
"^DD",9002313.02,9002313.0201,316,"DT")
3080102
"^DD",9002313.02,9002313.0201,317,0)
EMPLOYER CITY ADDRESS^F^^310;7^K:$L(X)>22!($L(X)<22) X
"^DD",9002313.02,9002313.0201,317,3)
Answer must be 22 characters in length
"^DD",9002313.02,9002313.0201,317,21,0)
^^1^1^3080102^
"^DD",9002313.02,9002313.0201,317,21,1,0)
Free-form text for city name.  NCPDP standard field 317-CH.
"^DD",9002313.02,9002313.0201,317,23,0)
^^1^1^3080102^
"^DD",9002313.02,9002313.0201,317,23,1,0)
REQUEST WORKER'S COMPENSATION SEGMENT
"^DD",9002313.02,9002313.0201,317,"DT")
3080102
"^DD",9002313.02,9002313.0201,318,0)
EMPLOYER STATE PROV ADDRESS^F^^310;8^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.0201,318,3)
Answer must be 4 characters in length
"^DD",9002313.02,9002313.0201,318,21,0)
^^2^2^3080102^
"^DD",9002313.02,9002313.0201,318,21,1,0)
Standard State/Province Code as defined by appropriate government 
"^DD",9002313.02,9002313.0201,318,21,2,0)
agency.  NCPDP standard field 318-CI.
"^DD",9002313.02,9002313.0201,318,23,0)
^^3^3^3080102^
"^DD",9002313.02,9002313.0201,318,23,1,0)
Standard United States and Canadian province two-letter postal service 
"^DD",9002313.02,9002313.0201,318,23,2,0)
abbreviations should be used.
"^DD",9002313.02,9002313.0201,318,23,3,0)
REQUEST WORKER'S COMPENSATION SEGMENT
"^DD",9002313.02,9002313.0201,318,"DT")
3080102
"^DD",9002313.02,9002313.0201,319,0)
EMPLOYER ZIP POSTAL ZONE^F^^310;9^K:$L(X)>17!($L(X)<17) X
"^DD",9002313.02,9002313.0201,319,3)
Answer must be 17 characters in length
"^DD",9002313.02,9002313.0201,319,21,0)
^^2^2^3080102^
"^DD",9002313.02,9002313.0201,319,21,1,0)
Code defining international postal zone excluding punctuation and blanks 
"^DD",9002313.02,9002313.0201,319,21,2,0)
(zip code for US).  NCPDP standard field 319-CJ.
"^DD",9002313.02,9002313.0201,319,23,0)
^^9^9^3080102^
"^DD",9002313.02,9002313.0201,319,23,1,0)
This left-justified field contains the five-digit zip code and may 
"^DD",9002313.02,9002313.0201,319,23,2,0)
include the four-digit expanded zip code in which the employer is located.
"^DD",9002313.02,9002313.0201,319,23,3,0)
 
"^DD",9002313.02,9002313.0201,319,23,4,0)
Examples: If the zip code is 98765-4321, this field would reflect: 
"^DD",9002313.02,9002313.0201,319,23,5,0)
987654321.
"^DD",9002313.02,9002313.0201,319,23,6,0)
 
"^DD",9002313.02,9002313.0201,319,23,7,0)
If the zip code is 98765, this field would reflect: 98765 left justified.
"^DD",9002313.02,9002313.0201,319,23,8,0)
 
"^DD",9002313.02,9002313.0201,319,23,9,0)
REQUEST WORKER S COMPENSATION SEGMENT
"^DD",9002313.02,9002313.0201,319,"DT")
3080102
"^DD",9002313.02,9002313.0201,320,0)
EMPLOYER PHONE NUMBER^F^^310;10^K:$L(X)>12!($L(X)<12) X
"^DD",9002313.02,9002313.0201,320,3)
Answer must be 12 characters in length
"^DD",9002313.02,9002313.0201,320,21,0)
^^1^1^3080102^
"^DD",9002313.02,9002313.0201,320,21,1,0)
Ten digit phone number of employer.  NCPDP standard field 320-CK.
"^DD",9002313.02,9002313.0201,320,23,0)
^^9^9^3080102^
"^DD",9002313.02,9002313.0201,320,23,1,0)
Format=AAAEEENNNN
"^DD",9002313.02,9002313.0201,320,23,2,0)
 
"^DD",9002313.02,9002313.0201,320,23,3,0)
AAA=Area Code
"^DD",9002313.02,9002313.0201,320,23,4,0)
EEE=Exchange Code
"^DD",9002313.02,9002313.0201,320,23,5,0)
NNNN=Number
"^DD",9002313.02,9002313.0201,320,23,6,0)
 
"^DD",9002313.02,9002313.0201,320,23,7,0)
Examples: A phone number of 212-555-1212 would reflect: 2125551212.
"^DD",9002313.02,9002313.0201,320,23,8,0)
 
"^DD",9002313.02,9002313.0201,320,23,9,0)
REQUEST WORKER'S COMPENSATION SEGMENT
"^DD",9002313.02,9002313.0201,320,"DT")
3080102
"^DD",9002313.02,9002313.0201,321,0)
EMPLOYER CONTACT NAME^F^^320;1^K:$L(X)>32!($L(X)<32) X
"^DD",9002313.02,9002313.0201,321,3)
Answer must be 32 characters in length
"^DD",9002313.02,9002313.0201,321,21,0)
^^1^1^3080102^
"^DD",9002313.02,9002313.0201,321,21,1,0)
Employer primary contact.  NCPDP standard field 321-CL.
"^DD",9002313.02,9002313.0201,321,23,0)
^^1^1^3080102^
"^DD",9002313.02,9002313.0201,321,23,1,0)
REQUEST WORKER'S COMPENSATION SEGMENT
"^DD",9002313.02,9002313.0201,321,"DT")
3080102
"^DD",9002313.02,9002313.0201,327,0)
CARRIER ID^F^^320;7^K:$L(X)>12!($L(X)<12) X
"^DD",9002313.02,9002313.0201,327,3)
Answer must be 12 characters in length
"^DD",9002313.02,9002313.0201,327,21,0)
^^2^2^3080103^
"^DD",9002313.02,9002313.0201,327,21,1,0)
Carrier code assigned in Worker's Compensation Program.  NCPDP standard 
"^DD",9002313.02,9002313.0201,327,21,2,0)
field 327-CR.
"^DD",9002313.02,9002313.0201,327,23,0)
^^1^1^3080103^
"^DD",9002313.02,9002313.0201,327,23,1,0)
REQUEST WORKER'S COMPENSATION SEGMENT
"^DD",9002313.02,9002313.0201,327,"DT")
3080103
"^DD",9002313.02,9002313.0201,330,0)
ALTERNATE ID^F^^320;10^K:$L(X)>22!($L(X)<22) X
"^DD",9002313.02,9002313.0201,330,3)
Answer must be 22 characters in length
"^DD",9002313.02,9002313.0201,330,21,0)
^^3^3^3080103^
"^DD",9002313.02,9002313.0201,330,21,1,0)
Person identifier to be used for controlled product reporting. Identifier 
"^DD",9002313.02,9002313.0201,330,21,2,0)
may be that of the patient or the person picking up the prescription as 
"^DD",9002313.02,9002313.0201,330,21,3,0)
required by the governing body.  NCPDP standard field 330-CW.
"^DD",9002313.02,9002313.0201,330,23,0)
^^1^1^3080103^
"^DD",9002313.02,9002313.0201,330,23,1,0)
REQUEST CLAIM SEGMENT
"^DD",9002313.02,9002313.0201,330,"DT")
3080103
"^DD",9002313.02,9002313.0201,337,0)
COB OTHER PAYMENTS COUNT^F^^330;7^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.0201,337,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.0201,337,21,0)
^^1^1^3031125^
"^DD",9002313.02,9002313.0201,337,21,1,0)
Count of other payment occurrences.
"^DD",9002313.02,9002313.0201,337,"DT")
3080102
"^DD",9002313.02,9002313.0201,337.01,0)
COB OTHER PAYMENTS^9002313.0401A^^337;0
"^DD",9002313.02,9002313.0201,337.01,21,0)
^^1^1^3080604^
"^DD",9002313.02,9002313.0201,337.01,21,1,0)
Multiple counter to store other coordination of benefit payments.
"^DD",9002313.02,9002313.0201,337.01,"DT")
3080102
"^DD",9002313.02,9002313.0201,343,0)
DISPENSING STATUS^F^^340;3^K:$L(X)>3!($L(X)<3) X
"^DD",9002313.02,9002313.0201,343,3)
Answer must be 3 characters in length
"^DD",9002313.02,9002313.0201,343,21,0)
^^4^4^3080103^
"^DD",9002313.02,9002313.0201,343,21,1,0)
Code indicating the quantity dispensed is a partial fill or the 
"^DD",9002313.02,9002313.0201,343,21,2,0)
completion of a partial fill. Used only in situations where inventory 
"^DD",9002313.02,9002313.0201,343,21,3,0)
shortages do not allow the full quantity to be dispensed.  NCPDP standard 
"^DD",9002313.02,9002313.0201,343,21,4,0)
field 343-HD.
"^DD",9002313.02,9002313.0201,343,23,0)
^^1^1^3080103^
"^DD",9002313.02,9002313.0201,343,23,1,0)
REQUEST CLAIM SEGMENT.
"^DD",9002313.02,9002313.0201,343,"DT")
3080103
"^DD",9002313.02,9002313.0201,344,0)
QUANTITY ORDERED^F^^340;4^K:$L(X)>12!($L(X)<12) X
"^DD",9002313.02,9002313.0201,344,3)
Answer must be 12 characters in length
"^DD",9002313.02,9002313.0201,344,21,0)
^^3^3^3080103^
"^DD",9002313.02,9002313.0201,344,21,1,0)
Metric decimal quantity of medication that would be dispensed on original 
"^DD",9002313.02,9002313.0201,344,21,2,0)
filling if inventory were available. Used in association with a 'P' or  
"^DD",9002313.02,9002313.0201,344,21,3,0)
'C' in  Dispensing Status  (343-HD).  NCPDP standard field 344-HF.
"^DD",9002313.02,9002313.0201,344,23,0)
^^3^3^3080103^
"^DD",9002313.02,9002313.0201,344,23,1,0)
Format=9999999.999
"^DD",9002313.02,9002313.0201,344,23,2,0)
 
"^DD",9002313.02,9002313.0201,344,23,3,0)
REQUEST CLAIM SEGMENT.
"^DD",9002313.02,9002313.0201,344,"DT")
3080103
"^DD",9002313.02,9002313.0201,345,0)
DAYS SUPPLY ORDERED^F^^340;5^K:$L(X)>5!($L(X)<5) X
"^DD",9002313.02,9002313.0201,345,3)
Answer must be 5 characters in length
"^DD",9002313.02,9002313.0201,345,21,0)
^^4^4^3080103^
"^DD",9002313.02,9002313.0201,345,21,1,0)
Days supply for metric decimal quantity of medication that would be 
"^DD",9002313.02,9002313.0201,345,21,2,0)
dispensed on original dispensing if inventory were available. Used in 
"^DD",9002313.02,9002313.0201,345,21,3,0)
association with a 'P' or 'C' in Dispensing Status (343-HD).  NCPDP 
"^DD",9002313.02,9002313.0201,345,21,4,0)
standard field 345-HG.
"^DD",9002313.02,9002313.0201,345,23,0)
^^1^1^3080103^
"^DD",9002313.02,9002313.0201,345,23,1,0)
REQUEST CLAIM SEGMENT.
"^DD",9002313.02,9002313.0201,345,"DT")
3080103
"^DD",9002313.02,9002313.0201,401,0)
DATE OF SERVICE^FO^^400;1^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.02,9002313.0201,401,2)
S Y(0)=Y S Y=$$FM2EXT^BPSOSU1(Y-17000000)
"^DD",9002313.02,9002313.0201,401,2.1)
S Y=$$FM2EXT^BPSOSU1(Y-17000000)
"^DD",9002313.02,9002313.0201,401,3)
Answer must be 8 characters in length
"^DD",9002313.02,9002313.0201,401,21,0)
^^3^3^3080104^
"^DD",9002313.02,9002313.0201,401,21,1,0)
Identifies date the prescription was filled or professional service 
"^DD",9002313.02,9002313.0201,401,21,2,0)
rendered or subsequent payer began coverage following Part A expiration 
"^DD",9002313.02,9002313.0201,401,21,3,0)
in a long-term care setting only.  NCPDP standard field 401-D1.
"^DD",9002313.02,9002313.0201,401,23,0)
^^12^12^3080104^
"^DD",9002313.02,9002313.0201,401,23,1,0)
Format=CCYYMMDD
"^DD",9002313.02,9002313.0201,401,23,2,0)
 
"^DD",9002313.02,9002313.0201,401,23,3,0)
CC=Century
"^DD",9002313.02,9002313.0201,401,23,4,0)
YY=Year
"^DD",9002313.02,9002313.0201,401,23,5,0)
MM=Month
"^DD",9002313.02,9002313.0201,401,23,6,0)
DD=Day
"^DD",9002313.02,9002313.0201,401,23,7,0)
 
"^DD",9002313.02,9002313.0201,401,23,8,0)
Examples: If the prescription was dispensed on April 22, 2000, this field 
"^DD",9002313.02,9002313.0201,401,23,9,0)
would reflect 20000422.
"^DD",9002313.02,9002313.0201,401,23,10,0)
 
"^DD",9002313.02,9002313.0201,401,23,11,0)
REQUEST TRANSACTION HEADER SEGMENT.
"^DD",9002313.02,9002313.0201,401,23,12,0)
RESPONSE HEADER SEGMENT.
"^DD",9002313.02,9002313.0201,401,"DT")
3080104
"^DD",9002313.02,9002313.0201,402,0)
PRESCRIPTION REFERENCE NUMBER^F^^400;2^K:$L(X)>9!($L(X)<9) X
"^DD",9002313.02,9002313.0201,402,3)
Answer must be 9 characters in length
"^DD",9002313.02,9002313.0201,402,21,0)
^^3^3^3080103^^
"^DD",9002313.02,9002313.0201,402,21,1,0)
The first seven digits of the prescription IEN.  Reference number 
"^DD",9002313.02,9002313.0201,402,21,2,0)
assigned by the provider for the dispensed drug/product and/or service 
"^DD",9002313.02,9002313.0201,402,21,3,0)
provided.  NCPDP standard field 402-D2.
"^DD",9002313.02,9002313.0201,402,23,0)
^^3^3^3080103^
"^DD",9002313.02,9002313.0201,402,23,1,0)
Qualified by Prescription/Service Reference Number Qualifier (455-EM).
"^DD",9002313.02,9002313.0201,402,23,2,0)
REQUEST CLAIM SEGMENT.
"^DD",9002313.02,9002313.0201,402,23,3,0)
RESPONSE CLAIM SEGMENT.
"^DD",9002313.02,9002313.0201,402,"DT")
3080103
"^DD",9002313.02,9002313.0201,403,0)
FILL NUMBER^F^^400;3^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.0201,403,3)
Answer must be 4 characters in length
"^DD",9002313.02,9002313.0201,403,21,0)
^^3^3^3080103^
"^DD",9002313.02,9002313.0201,403,21,1,0)
The fill/refill number, starting at 0 for the original fill.  The code 
"^DD",9002313.02,9002313.0201,403,21,2,0)
indicating whether the prescription is an original or a refill.  NCPDP 
"^DD",9002313.02,9002313.0201,403,21,3,0)
standard field 403-D3.
"^DD",9002313.02,9002313.0201,403,23,0)
^^1^1^3080103^
"^DD",9002313.02,9002313.0201,403,23,1,0)
REQUEST CLAIM SEGMENT.
"^DD",9002313.02,9002313.0201,403,"DT")
3080103
"^DD",9002313.02,9002313.0201,405,0)
DAYS SUPPLY^F^^400;5^K:$L(X)>5!($L(X)<5) X
"^DD",9002313.02,9002313.0201,405,3)
Answer must be 5 characters in length
"^DD",9002313.02,9002313.0201,405,21,0)
^^2^2^3080103^
"^DD",9002313.02,9002313.0201,405,21,1,0)
Estimated number of days the prescription will last.  NCPDP standard 
"^DD",9002313.02,9002313.0201,405,21,2,0)
field 405-D5.
"^DD",9002313.02,9002313.0201,405,23,0)
^^4^4^3080103^
"^DD",9002313.02,9002313.0201,405,23,1,0)
Examples: The prescription is estimated to last 30 days. This field would 
"^DD",9002313.02,9002313.0201,405,23,2,0)
reflect: 30.
"^DD",9002313.02,9002313.0201,405,23,3,0)
 
"^DD",9002313.02,9002313.0201,405,23,4,0)
REQUEST CLAIM SEGMENT.
"^DD",9002313.02,9002313.0201,405,"DT")
3080103
"^DD",9002313.02,9002313.0201,406,0)
COMPOUND CODE^F^^400;6^K:$L(X)>3!($L(X)<3) X
"^DD",9002313.02,9002313.0201,406,3)
Answer must be 3 characters in length
"^DD",9002313.02,9002313.0201,406,21,0)
^^2^2^3080103^
"^DD",9002313.02,9002313.0201,406,21,1,0)
Field indicating whether this prescription was a compound (1) or not a
"^DD",9002313.02,9002313.0201,406,21,2,0)
compound (0).
"^DD",9002313.02,9002313.0201,406,23,0)
^^1^1^3080103^
"^DD",9002313.02,9002313.0201,406,23,1,0)
REQUEST CLAIM SEGMENT.
"^DD",9002313.02,9002313.0201,406,"DT")
3080103
"^DD",9002313.02,9002313.0201,407,0)
PRODUCT SERVICE ID^F^^400;7^K:$L(X)>21!($L(X)<21) X
"^DD",9002313.02,9002313.0201,407,3)
Answer must be 21 characters in length
"^DD",9002313.02,9002313.0201,407,21,0)
^^2^2^3080103^
"^DD",9002313.02,9002313.0201,407,21,1,0)
ID of the product dispensed or service provided.  NDC code in our case.  
"^DD",9002313.02,9002313.0201,407,21,2,0)
NCPDP standard field 407-D7.
"^DD",9002313.02,9002313.0201,407,23,0)
^^10^10^3080103^
"^DD",9002313.02,9002313.0201,407,23,1,0)
Format=MMMMMDDDDPP
"^DD",9002313.02,9002313.0201,407,23,2,0)
 
"^DD",9002313.02,9002313.0201,407,23,3,0)
MMMMM=Manufacturer's Assigned Number
"^DD",9002313.02,9002313.0201,407,23,4,0)
DDDD=Drug ID
"^DD",9002313.02,9002313.0201,407,23,5,0)
PP=Package Size
"^DD",9002313.02,9002313.0201,407,23,6,0)
 
"^DD",9002313.02,9002313.0201,407,23,7,0)
Comments: Qualified by Product/Service ID Qualifier (436-E1) If  
"^DD",9002313.02,9002313.0201,407,23,8,0)
Product Service ID Qualifier (436-E1) is 03=NDC
"^DD",9002313.02,9002313.0201,407,23,9,0)
 
"^DD",9002313.02,9002313.0201,407,23,10,0)
REQUEST CLAIM SEGMENT.
"^DD",9002313.02,9002313.0201,407,"DT")
3080103
"^DD",9002313.02,9002313.0201,408,0)
DISPENSE AS WRITTEN^F^^400;8^K:$L(X)>3!($L(X)<3) X
"^DD",9002313.02,9002313.0201,408,3)
Answer must be 3 characters in length
"^DD",9002313.02,9002313.0201,408,21,0)
^^2^2^3080604^
"^DD",9002313.02,9002313.0201,408,21,1,0)
Code indicating whether or not the prescriber's instructions regarding 
"^DD",9002313.02,9002313.0201,408,21,2,0)
generic substitution were followed.  NCPDP standard field 408-D8.
"^DD",9002313.02,9002313.0201,408,23,0)
^^1^1^3080103^
"^DD",9002313.02,9002313.0201,408,23,1,0)
REQUEST CLAIM SEGMENT.
"^DD",9002313.02,9002313.0201,408,"DT")
3080604
"^DD",9002313.02,9002313.0201,409,0)
INGREDIENT COST SUBMITTED^F^^400;9^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.0201,409,3)
Answer must be 10 characters in length
"^DD",9002313.02,9002313.0201,409,21,0)
^^2^2^3080103^
"^DD",9002313.02,9002313.0201,409,21,1,0)
Submitted product component cost of the dispensed prescription.  This 
"^DD",9002313.02,9002313.0201,409,21,2,0)
amount is included in the 'Gross Amount Due' (430-DU).
"^DD",9002313.02,9002313.0201,409,23,0)
^^9^9^3080103^
"^DD",9002313.02,9002313.0201,409,23,1,0)
Format=s$$$$$$cc
"^DD",9002313.02,9002313.0201,409,23,2,0)
 
"^DD",9002313.02,9002313.0201,409,23,3,0)
Comments: This field can be further defined by using the Basis of Cost 
"^DD",9002313.02,9002313.0201,409,23,4,0)
Determination Field 423-DN.
"^DD",9002313.02,9002313.0201,409,23,5,0)
 
"^DD",9002313.02,9002313.0201,409,23,6,0)
Examples: If the ingredient cost submitted is $65.00, this field would 
"^DD",9002313.02,9002313.0201,409,23,7,0)
reflect: 650{.
"^DD",9002313.02,9002313.0201,409,23,8,0)
 
"^DD",9002313.02,9002313.0201,409,23,9,0)
REQUEST PRICING SEGMENT.
"^DD",9002313.02,9002313.0201,409,"DT")
3080103
"^DD",9002313.02,9002313.0201,411,0)
PRESCRIBER ID^F^^400;11^K:$L(X)>17!($L(X)<17) X
"^DD",9002313.02,9002313.0201,411,3)
Answer must be 17 characters in length
"^DD",9002313.02,9002313.0201,411,21,0)
^^1^1^3080103^
"^DD",9002313.02,9002313.0201,411,21,1,0)
ID assigned to the prescriber.
"^DD",9002313.02,9002313.0201,411,23,0)
^^6^6^3080103^
"^DD",9002313.02,9002313.0201,411,23,1,0)
Regarding the Telecommunication Standard:
"^DD",9002313.02,9002313.0201,411,23,2,0)
 
"^DD",9002313.02,9002313.0201,411,23,3,0)
Comments: Qualified by Prescriber ID Qualifier (466-EZ) for the 
"^DD",9002313.02,9002313.0201,411,23,4,0)
Telecommunications Standard.
"^DD",9002313.02,9002313.0201,411,23,5,0)
 
"^DD",9002313.02,9002313.0201,411,23,6,0)
REQUEST PRESCRIBER SEGMENT
"^DD",9002313.02,9002313.0201,411,"DT")
3080103
"^DD",9002313.02,9002313.0201,412,0)
DISPENSING FEE SUBMITTED^F^^400;12^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.0201,412,3)
Answer must be 10 characters in length
"^DD",9002313.02,9002313.0201,412,21,0)
^^3^3^3080103^
"^DD",9002313.02,9002313.0201,412,21,1,0)
Dispensing fee submitted by the pharmacy.  This amount is included in the 
"^DD",9002313.02,9002313.0201,412,21,2,0)
'Gross Amount Due' (430-DU).  To be utilized for Tricare.  NCPDP standard 
"^DD",9002313.02,9002313.0201,412,21,3,0)
field 412-DC.
"^DD",9002313.02,9002313.0201,412,23,0)
^^6^6^3080103^
"^DD",9002313.02,9002313.0201,412,23,1,0)
Format=s$$$$$$cc
"^DD",9002313.02,9002313.0201,412,23,2,0)
 
"^DD",9002313.02,9002313.0201,412,23,3,0)
Examples: If the pharmacy submitted a $5.62 dispensing fee, this field 
"^DD",9002313.02,9002313.0201,412,23,4,0)
would reflect: 56B.
"^DD",9002313.02,9002313.0201,412,23,5,0)
 
"^DD",9002313.02,9002313.0201,412,23,6,0)
REQUEST PRICING SEGMENT.
"^DD",9002313.02,9002313.0201,412,"DT")
3080103
"^DD",9002313.02,9002313.0201,414,0)
DATE PRESCRIPTION WRITTEN^F^^400;14^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.0201,414,3)
Answer must be 10 characters in length
"^DD",9002313.02,9002313.0201,414,21,0)
^^2^2^3080103^
"^DD",9002313.02,9002313.0201,414,21,1,0)
Date prescription was written.  This will be the fill/refill date for
"^DD",9002313.02,9002313.0201,414,21,2,0)
local fills, the released date for CMOP.  NCPDP standard field 414-DE.
"^DD",9002313.02,9002313.0201,414,23,0)
^^11^11^3080103^
"^DD",9002313.02,9002313.0201,414,23,1,0)
Format=CCYYMMDD
"^DD",9002313.02,9002313.0201,414,23,2,0)
 
"^DD",9002313.02,9002313.0201,414,23,3,0)
CC=Century
"^DD",9002313.02,9002313.0201,414,23,4,0)
YY=Year
"^DD",9002313.02,9002313.0201,414,23,5,0)
MM=Month
"^DD",9002313.02,9002313.0201,414,23,6,0)
DD=Day
"^DD",9002313.02,9002313.0201,414,23,7,0)
 
"^DD",9002313.02,9002313.0201,414,23,8,0)
Examples: For a prescription written on August 1, 1999, field would 
"^DD",9002313.02,9002313.0201,414,23,9,0)
reflect: 19990801.
"^DD",9002313.02,9002313.0201,414,23,10,0)
 
"^DD",9002313.02,9002313.0201,414,23,11,0)
REQUEST CLAIM SEGMENT.
"^DD",9002313.02,9002313.0201,414,"DT")
3080103
"^DD",9002313.02,9002313.0201,415,0)
NUMBER OF REFILLS AUTHORIZED^F^^400;15^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.0201,415,3)
Answer must be 4 characters in length
"^DD",9002313.02,9002313.0201,415,21,0)
^^2^2^3080103^
"^DD",9002313.02,9002313.0201,415,21,1,0)
Number of refills authorized by the prescriber.  The number of refills
"^DD",9002313.02,9002313.0201,415,21,2,0)
allowed that was entered during order entry.  NCPDP standard field 415-DF.
"^DD",9002313.02,9002313.0201,415,23,0)
^^1^1^3080103^
"^DD",9002313.02,9002313.0201,415,23,1,0)
REQUEST CLAIM SEGMENT.
"^DD",9002313.02,9002313.0201,415,"DT")
3080103
"^DD",9002313.02,9002313.0201,418,0)
LEVEL OF SERVICE^F^^400;18^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.0201,418,3)
Answer must be 4 characters in length
"^DD",9002313.02,9002313.0201,418,21,0)
^^2^2^3080103^
"^DD",9002313.02,9002313.0201,418,21,1,0)
Coding indicating the type of service the provider rendered.  Not
"^DD",9002313.02,9002313.0201,418,21,2,0)
utilized, populated with DI00.  NCPDP standard field 418-DI.
"^DD",9002313.02,9002313.0201,418,23,0)
^^1^1^3080103^
"^DD",9002313.02,9002313.0201,418,23,1,0)
REQUEST CLAIM SEGMENT.
"^DD",9002313.02,9002313.0201,418,"DT")
3080103
"^DD",9002313.02,9002313.0201,419,0)
PRESCRIPTION ORIGIN CODE^F^^400;19^K:$L(X)>3!($L(X)<3) X
"^DD",9002313.02,9002313.0201,419,3)
Answer must be 3 characters in length
"^DD",9002313.02,9002313.0201,419,21,0)
^^1^1^3080103^
"^DD",9002313.02,9002313.0201,419,21,1,0)
Code indicating the origin of the prescription.
"^DD",9002313.02,9002313.0201,419,23,0)
^^1^1^3080103^
"^DD",9002313.02,9002313.0201,419,23,1,0)
REQUEST CLAIM SEGMENT.
"^DD",9002313.02,9002313.0201,419,"DT")
3080103
"^DD",9002313.02,9002313.0201,420,0)
SUBMISSION CLARIFICATION CODE^F^^400;20^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.0201,420,3)
Answer must be 4 characters in length
"^DD",9002313.02,9002313.0201,420,21,0)
^^2^2^3080103^
"^DD",9002313.02,9002313.0201,420,21,1,0)
Code indicating that the pharmacist is clarifying the submission.  NCPDP 
"^DD",9002313.02,9002313.0201,420,21,2,0)
standard field 420-DK.
"^DD",9002313.02,9002313.0201,420,23,0)
^^7^7^3080103^
"^DD",9002313.02,9002313.0201,420,23,1,0)
Examples: Since the patient will be out of state for the next three 
"^DD",9002313.02,9002313.0201,420,23,2,0)
months, they have requested a three-month supply of their medication. 
"^DD",9002313.02,9002313.0201,420,23,3,0)
This situation can cause the claim to reject, because it was refilled too 
"^DD",9002313.02,9002313.0201,420,23,4,0)
soon. By indicating an 03, the processor is made aware of the situation, 
"^DD",9002313.02,9002313.0201,420,23,5,0)
and can properly adjudicate the claim.
"^DD",9002313.02,9002313.0201,420,23,6,0)
 
"^DD",9002313.02,9002313.0201,420,23,7,0)
REQUEST CLAIM SEGMENT.
"^DD",9002313.02,9002313.0201,420,"DT")
3081125
"^DD",9002313.02,9002313.0201,421,0)
PRIMARY CARE PROVIDER ID^F^^400;21^K:$L(X)>17!($L(X)<17) X
"^DD",9002313.02,9002313.0201,421,3)
Answer must be 17 characters in length
"^DD",9002313.02,9002313.0201,421,21,0)
^^2^2^3080103^
"^DD",9002313.02,9002313.0201,421,21,1,0)
ID assigned to the primary care provider. Used when the patient is 
"^DD",9002313.02,9002313.0201,421,21,2,0)
referred to a secondary care provider.  NCPDP standard field 421-DL.
"^DD",9002313.02,9002313.0201,421,23,0)
^^2^2^3080103^
"^DD",9002313.02,9002313.0201,421,23,1,0)
Qualified by  Primary Care Provider ID Qualifier  (468-2E).
"^DD",9002313.02,9002313.0201,421,23,2,0)
REQUEST PRESCRIBER SEGMENT.
"^DD",9002313.02,9002313.0201,421,"DT")
3080103
"^DD",9002313.02,9002313.0201,423,0)
BASIS OF COST DETERMINATION^F^^400;23^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.0201,423,3)
Answer must be 4 characters in length
"^DD",9002313.02,9002313.0201,423,21,0)
^^3^3^3080103^
"^DD",9002313.02,9002313.0201,423,21,1,0)
Code indicating the method by which 'Ingredient Cost Submitted' (Field 
"^DD",9002313.02,9002313.0201,423,21,2,0)
409-D9) was calculated.  How the amount charged was determined.  NCPDP 
"^DD",9002313.02,9002313.0201,423,21,3,0)
standard field 423-DN.
"^DD",9002313.02,9002313.0201,423,23,0)
^^1^1^3080103^
"^DD",9002313.02,9002313.0201,423,23,1,0)
REQUEST PRICING SEGMENT.
"^DD",9002313.02,9002313.0201,423,"DT")
3080103
"^DD",9002313.02,9002313.0201,424,0)
DIAGNOSIS CODE^F^^400;24^K:$L(X)>17!($L(X)<17) X
"^DD",9002313.02,9002313.0201,424,3)
Answer must be 17 characters in length
"^DD",9002313.02,9002313.0201,424,21,0)
^^3^3^3080103^
"^DD",9002313.02,9002313.0201,424,21,1,0)
Code identifying the diagnosis of the patient.  Not used for third party
"^DD",9002313.02,9002313.0201,424,21,2,0)
billing as of this date - so it is not used, but may be used in the
"^DD",9002313.02,9002313.0201,424,21,3,0)
future.  NCPDP standard field 424-DO.
"^DD",9002313.02,9002313.0201,424,23,0)
^^3^3^3080103^
"^DD",9002313.02,9002313.0201,424,23,1,0)
Qualified by a Diagnosis Code Qualifier (492-WE). The format must 
"^DD",9002313.02,9002313.0201,424,23,2,0)
adhere to the owner's code set rules and formats.
"^DD",9002313.02,9002313.0201,424,23,3,0)
REQUEST CLINICAL SEGMENT.
"^DD",9002313.02,9002313.0201,424,"DT")
3080103
"^DD",9002313.02,9002313.0201,426,0)
USUAL AND CUSTOMARY CHARGE^F^^400;26^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.0201,426,3)
Answer must be 10 characters in length
"^DD",9002313.02,9002313.0201,426,21,0)
^^2^2^3080103^
"^DD",9002313.02,9002313.0201,426,21,1,0)
Amount charged cash customers for the prescription exclusive of sales tax 
"^DD",9002313.02,9002313.0201,426,21,2,0)
or other amounts claimed.  NCPDP standard field 426-DQ.
"^DD",9002313.02,9002313.0201,426,23,0)
^^6^6^3080103^
"^DD",9002313.02,9002313.0201,426,23,1,0)
Format=s$$$$$$cc
"^DD",9002313.02,9002313.0201,426,23,2,0)
 
"^DD",9002313.02,9002313.0201,426,23,3,0)
Examples: If the usual and customary charge is $32.56, this field would 
"^DD",9002313.02,9002313.0201,426,23,4,0)
reflect: 325F.
"^DD",9002313.02,9002313.0201,426,23,5,0)
 
"^DD",9002313.02,9002313.0201,426,23,6,0)
REQUEST PRICING SEGMENT.
"^DD",9002313.02,9002313.0201,426,"DT")
3080103
"^DD",9002313.02,9002313.0201,427,0)
PRESCRIBER LAST NAME^F^^420;27^K:$L(X)>17!($L(X)<17) X
"^DD",9002313.02,9002313.0201,427,3)
Answer must be 17 characters in length
"^DD",9002313.02,9002313.0201,427,21,0)
^^1^1^3080103^
"^DD",9002313.02,9002313.0201,427,21,1,0)
Last Name of the Prescriber.  NCPDP standard field 427-DR.
"^DD",9002313.02,9002313.0201,427,23,0)
^^1^1^3080103^
"^DD",9002313.02,9002313.0201,427,23,1,0)
REQUEST PRESCRIBER SEGMENT.
"^DD",9002313.02,9002313.0201,427,"DT")
3080103
"^DD",9002313.02,9002313.0201,429,0)
SPECIAL PACKAGING INDICATOR^F^^400;29^K:$L(X)>3!($L(X)<3) X
"^DD",9002313.02,9002313.0201,429,3)
Answer must be 3 characters in length
"^DD",9002313.02,9002313.0201,429,21,0)
^^7^7^3080103^
"^DD",9002313.02,9002313.0201,429,21,1,0)
Code indicating the type of Unit Dose dispensing.  NCPDP standard field 
"^DD",9002313.02,9002313.0201,429,21,2,0)
429-DT.
"^DD",9002313.02,9002313.0201,429,21,3,0)
 
"^DD",9002313.02,9002313.0201,429,21,4,0)
0=Not Specified
"^DD",9002313.02,9002313.0201,429,21,5,0)
1=Not Unit Dose
"^DD",9002313.02,9002313.0201,429,21,6,0)
2=Manufacturer Unit Dose
"^DD",9002313.02,9002313.0201,429,21,7,0)
3=Pharmacy Unit Dose
"^DD",9002313.02,9002313.0201,429,23,0)
^^1^1^3080103^
"^DD",9002313.02,9002313.0201,429,23,1,0)
REQUEST CLAIM SEGMENT.
"^DD",9002313.02,9002313.0201,429,"DT")
3080103
"^DD",9002313.02,9002313.0201,430,0)
GROSS AMOUNT DUE^F^^400;30^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.0201,430,3)
Answer must be 10 characters in length
"^DD",9002313.02,9002313.0201,430,21,0)
^^9^9^3080103^
"^DD",9002313.02,9002313.0201,430,21,1,0)
Total price claimed from all sources.  For prescription claim request, 
"^DD",9002313.02,9002313.0201,430,21,2,0)
field represents a sum of Ingredient Cost Submitted (409-D9), Dispensing
"^DD",9002313.02,9002313.0201,430,21,3,0)
Fee Submitted (412-DC), Flat Sales Tax Amount Submitted (481-HA),  
"^DD",9002313.02,9002313.0201,430,21,4,0)
Percentage Sales Tax Amount Submitted (482-GE), Incentive Amount
"^DD",9002313.02,9002313.0201,430,21,5,0)
Submitted (438-E3), Other Amount Claimed (480-H9).  For service claim
"^DD",9002313.02,9002313.0201,430,21,6,0)
request, field represents a sum of Professional Services Fee Submitted  
"^DD",9002313.02,9002313.0201,430,21,7,0)
(477-BE), Flat Sales Tax Amount Submitted (481-HA), Percentage Sales Tax
"^DD",9002313.02,9002313.0201,430,21,8,0)
Amount Submitted (482-GE), Other Amount Claimed (480-H9).  NCPDP standard 
"^DD",9002313.02,9002313.0201,430,21,9,0)
field 430-DU.
"^DD",9002313.02,9002313.0201,430,23,0)
^^6^6^3080103^
"^DD",9002313.02,9002313.0201,430,23,1,0)
Format=s$$$$$$cc
"^DD",9002313.02,9002313.0201,430,23,2,0)
 
"^DD",9002313.02,9002313.0201,430,23,3,0)
Examples: If the gross amount due is $14.95, this field would reflect: 
"^DD",9002313.02,9002313.0201,430,23,4,0)
149E.
"^DD",9002313.02,9002313.0201,430,23,5,0)
 
"^DD",9002313.02,9002313.0201,430,23,6,0)
REQUEST PRICING SEGMENT.
"^DD",9002313.02,9002313.0201,430,"DT")
3080103
"^DD",9002313.02,9002313.0201,431,0)
OTHER PAYER AMOUNT^F^^430;1^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.0201,431,3)
Answer must be 10 characters in length
"^DD",9002313.02,9002313.0201,431,21,0)
^^2^2^3080103^
"^DD",9002313.02,9002313.0201,431,21,1,0)
Amount of any payment known by the pharmacy from other sources.  NCPDP 
"^DD",9002313.02,9002313.0201,431,21,2,0)
standard field 431-DV.
"^DD",9002313.02,9002313.0201,431,23,0)
^^6^6^3080103^
"^DD",9002313.02,9002313.0201,431,23,1,0)
Format=s$$$$$$cc
"^DD",9002313.02,9002313.0201,431,23,2,0)
 
"^DD",9002313.02,9002313.0201,431,23,3,0)
Examples: If the other payer amount paid is $32.56, this field would 
"^DD",9002313.02,9002313.0201,431,23,4,0)
reflect: 325F.
"^DD",9002313.02,9002313.0201,431,23,5,0)
 
"^DD",9002313.02,9002313.0201,431,23,6,0)
REQUEST COORDINATION OF BENEFITS/OTHER PAYMENT SEGMENT.
"^DD",9002313.02,9002313.0201,431,"DT")
3080103
"^DD",9002313.02,9002313.0201,433,0)
PATIENT PAID AMOUNT SUBMITTED^F^^430;3^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.0201,433,3)
Answer must be 10 characters in length
"^DD",9002313.02,9002313.0201,433,21,0)
^^2^2^3080103^
"^DD",9002313.02,9002313.0201,433,21,1,0)
Amount the pharmacy received from the patient for the prescription 
"^DD",9002313.02,9002313.0201,433,21,2,0)
dispensed.
"^DD",9002313.02,9002313.0201,433,23,0)
^^10^10^3080103^
"^DD",9002313.02,9002313.0201,433,23,1,0)
This field is not used in coordination of benefit transactions to pass 
"^DD",9002313.02,9002313.0201,433,23,2,0)
patent liability information to a downstream payer. See Other 
"^DD",9002313.02,9002313.0201,433,23,3,0)
Payer-Patient Responsibility Amount (352-NQ).
"^DD",9002313.02,9002313.0201,433,23,4,0)
 
"^DD",9002313.02,9002313.0201,433,23,5,0)
Format=s$$$$$$cc
"^DD",9002313.02,9002313.0201,433,23,6,0)
 
"^DD",9002313.02,9002313.0201,433,23,7,0)
Examples: If the patient paid amount submitted is $10.50, this field 
"^DD",9002313.02,9002313.0201,433,23,8,0)
would reflect: 105{.
"^DD",9002313.02,9002313.0201,433,23,9,0)
 
"^DD",9002313.02,9002313.0201,433,23,10,0)
REQUEST PRICING SEGMENT.
"^DD",9002313.02,9002313.0201,433,"DT")
3080103
"^DD",9002313.02,9002313.0201,434,0)
DATE OF INJURY^F^^430;4^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.0201,434,3)
Answer must be 10 characters in length
"^DD",9002313.02,9002313.0201,434,21,0)
^^1^1^3080103^
"^DD",9002313.02,9002313.0201,434,21,1,0)
Date on which the injury occurred.  NCPDP standard field 434-DY.
"^DD",9002313.02,9002313.0201,434,23,0)
^^11^11^3080103^
"^DD",9002313.02,9002313.0201,434,23,1,0)
Format=CCYYMMDD
"^DD",9002313.02,9002313.0201,434,23,2,0)
 
"^DD",9002313.02,9002313.0201,434,23,3,0)
CC=Century
"^DD",9002313.02,9002313.0201,434,23,4,0)
YY=Year
"^DD",9002313.02,9002313.0201,434,23,5,0)
MM=Month
"^DD",9002313.02,9002313.0201,434,23,6,0)
DD=Day
"^DD",9002313.02,9002313.0201,434,23,7,0)
 
"^DD",9002313.02,9002313.0201,434,23,8,0)
Examples: If injury occurred on July 1, 1999, field would reflect: 
"^DD",9002313.02,9002313.0201,434,23,9,0)
19990701.
"^DD",9002313.02,9002313.0201,434,23,10,0)
 
"^DD",9002313.02,9002313.0201,434,23,11,0)
REQUEST WORKER S COMPENSATION SEGMENT.
"^DD",9002313.02,9002313.0201,434,"DT")
3080103
"^DD",9002313.02,9002313.0201,435,0)
CLAIM REFERENCE ID^F^^430;5^K:$L(X)>32!($L(X)<32) X
"^DD",9002313.02,9002313.0201,435,3)
Answer must be 32 characters in length
"^DD",9002313.02,9002313.0201,435,21,0)
^^2^2^3080103^
"^DD",9002313.02,9002313.0201,435,21,1,0)
Identifies the claim number assigned by Worker s Compensation Program.  
"^DD",9002313.02,9002313.0201,435,21,2,0)
NCPDP standard field 435-DZ.
"^DD",9002313.02,9002313.0201,435,23,0)
^^1^1^3080103^
"^DD",9002313.02,9002313.0201,435,23,1,0)
REQUEST WORKER S COMPENSATION SEGMENT.
"^DD",9002313.02,9002313.0201,435,"DT")
3080103
"^DD",9002313.02,9002313.0201,436,0)
PRODUCT SERVICE ID QUALIFIER^F^^430;6^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.0201,436,3)
Answer must be 4 characters in length
"^DD",9002313.02,9002313.0201,436,21,0)
^^2^2^3080103^
"^DD",9002313.02,9002313.0201,436,21,1,0)
Code qualifying the value in 'Product/Service ID' (407-D7).  NCPDP 
"^DD",9002313.02,9002313.0201,436,21,2,0)
standard field 436-E1.
"^DD",9002313.02,9002313.0201,436,23,0)
^^1^1^3080103^
"^DD",9002313.02,9002313.0201,436,23,1,0)
REQUEST CLAIM SEGMENT.
"^DD",9002313.02,9002313.0201,436,"DT")
3080103
"^DD",9002313.02,9002313.0201,438,0)
INCENTIVE AMOUNT SUBMITTED^F^^430;8^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.0201,438,3)
Answer must be 10 characters in length
"^DD",9002313.02,9002313.0201,438,21,0)
^^3^3^3080103^
"^DD",9002313.02,9002313.0201,438,21,1,0)
Amount represents a fee that is submitted by the pharmacy for 
"^DD",9002313.02,9002313.0201,438,21,2,0)
contractually agreed upon services. This amount is included in the 'Gross 
"^DD",9002313.02,9002313.0201,438,21,3,0)
Amount Due' (430-DU).
"^DD",9002313.02,9002313.0201,438,23,0)
^^6^6^3080103^
"^DD",9002313.02,9002313.0201,438,23,1,0)
Format=s$$$$$$cc
"^DD",9002313.02,9002313.0201,438,23,2,0)
 
"^DD",9002313.02,9002313.0201,438,23,3,0)
Examples: If the incentive amount submitted is $4.50, this field would 
"^DD",9002313.02,9002313.0201,438,23,4,0)
reflect: 45{.
"^DD",9002313.02,9002313.0201,438,23,5,0)
 
"^DD",9002313.02,9002313.0201,438,23,6,0)
REQUEST PRICING SEGMENT.
"^DD",9002313.02,9002313.0201,438,"DT")
3080103
"^DD",9002313.02,9002313.0201,442,0)
QUANTITY DISPENSED^F^^440;2^K:$L(X)>12!($L(X)<12) X
"^DD",9002313.02,9002313.0201,442,3)
Answer must be 12 characters in length
"^DD",9002313.02,9002313.0201,442,21,0)
^^2^2^3080103^
"^DD",9002313.02,9002313.0201,442,21,1,0)
Quantity dispensed expressed in metric decimal units.  NCPDP standard 
"^DD",9002313.02,9002313.0201,442,21,2,0)
field 442-E7.
"^DD",9002313.02,9002313.0201,442,23,0)
^^2^2^3080103^
"^DD",9002313.02,9002313.0201,442,23,1,0)
Format=9999999.999
"^DD",9002313.02,9002313.0201,442,23,2,0)
REQUEST CLAIM SEGMENT.
"^DD",9002313.02,9002313.0201,442,"DT")
3080103
"^DD",9002313.02,9002313.0201,443,0)
OTHER PAYER DATE^F^^440;3^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.0201,443,3)
Answer must be 10 characters in length
"^DD",9002313.02,9002313.0201,443,21,0)
^^2^2^3080604^
"^DD",9002313.02,9002313.0201,443,21,1,0)
Payment or denial date of the claim submitted to the other payer. Used 
"^DD",9002313.02,9002313.0201,443,21,2,0)
for coordination of benefits.  NCPDP standard field 443-E8.
"^DD",9002313.02,9002313.0201,443,23,0)
^^11^11^3080604^
"^DD",9002313.02,9002313.0201,443,23,1,0)
Format=CCYYMMDD
"^DD",9002313.02,9002313.0201,443,23,2,0)
 
"^DD",9002313.02,9002313.0201,443,23,3,0)
CC=Century
"^DD",9002313.02,9002313.0201,443,23,4,0)
YY=Year
"^DD",9002313.02,9002313.0201,443,23,5,0)
MM=Month
"^DD",9002313.02,9002313.0201,443,23,6,0)
DD=Day
"^DD",9002313.02,9002313.0201,443,23,7,0)
 
"^DD",9002313.02,9002313.0201,443,23,8,0)
Examples: If the primary payer denial date was August 1,1999, this field 
"^DD",9002313.02,9002313.0201,443,23,9,0)
would reflect: 19990801.
"^DD",9002313.02,9002313.0201,443,23,10,0)
 
"^DD",9002313.02,9002313.0201,443,23,11,0)
REQUEST COORDINATION OF BENEFITS/OTHER PAYMENT SEGMENT
"^DD",9002313.02,9002313.0201,443,"DT")
3080604
"^DD",9002313.02,9002313.0201,444,0)
PROVIDER ID^F^^440;4^K:$L(X)>17!($L(X)<17) X
"^DD",9002313.02,9002313.0201,444,3)
Answer must be 17 characters in length
"^DD",9002313.02,9002313.0201,444,21,0)
^^2^2^3080103^
"^DD",9002313.02,9002313.0201,444,21,1,0)
Unique ID assigned to the person responsible for the dispensing of the 
"^DD",9002313.02,9002313.0201,444,21,2,0)
prescription or provision of the service.
"^DD",9002313.02,9002313.0201,444,23,0)
^^2^2^3080103^
"^DD",9002313.02,9002313.0201,444,23,1,0)
Qualified by Provider ID Qualifier (465-EY).
"^DD",9002313.02,9002313.0201,444,23,2,0)
REQUEST PHARMACY PROVIDER SEGMENT.
"^DD",9002313.02,9002313.0201,444,"DT")
3080103
"^DD",9002313.02,9002313.0201,445,0)
ORIGINAL PRESCRIBED PROD CODE^F^^440;5^K:$L(X)>21!($L(X)<21) X
"^DD",9002313.02,9002313.0201,445,3)
Answer must be 21 characters in length
"^DD",9002313.02,9002313.0201,445,21,0)
^^2^2^3080103^
"^DD",9002313.02,9002313.0201,445,21,1,0)
Code of the initially prescribed product or service.  NCPDP standard 
"^DD",9002313.02,9002313.0201,445,21,2,0)
field 445-EA.
"^DD",9002313.02,9002313.0201,445,23,0)
^^3^3^3080103^
"^DD",9002313.02,9002313.0201,445,23,1,0)
Qualified by Originally Prescribed Product/Service Code Qualifier  
"^DD",9002313.02,9002313.0201,445,23,2,0)
(453-EJ).
"^DD",9002313.02,9002313.0201,445,23,3,0)
REQUEST CLAIM SEGMENT.
"^DD",9002313.02,9002313.0201,445,"DT")
3080103
"^DD",9002313.02,9002313.0201,446,0)
ORIGINALLY PRESCRIBED QUANTITY^F^^440;6^K:$L(X)>12!($L(X)<12) X
"^DD",9002313.02,9002313.0201,446,3)
Answer must be 12 characters in length
"^DD",9002313.02,9002313.0201,446,21,0)
^^2^2^3080103^
"^DD",9002313.02,9002313.0201,446,21,1,0)
Product initially prescribed amount expressed in metric decimal units.  
"^DD",9002313.02,9002313.0201,446,21,2,0)
NCPDP standard field 446-EB.
"^DD",9002313.02,9002313.0201,446,23,0)
^^2^2^3080103^
"^DD",9002313.02,9002313.0201,446,23,1,0)
Format=9999999.999
"^DD",9002313.02,9002313.0201,446,23,2,0)
REQUEST CLAIM SEGMENT.
"^DD",9002313.02,9002313.0201,446,"DT")
3080103
"^DD",9002313.02,9002313.0201,447,0)
COMPOUND INGREDIENT COUNT^F^^440;7^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.0201,447,3)
Answer must be 4 characters in length
"^DD",9002313.02,9002313.0201,447,21,0)
^^2^2^3080103^
"^DD",9002313.02,9002313.0201,447,21,1,0)
Count of compound product IDs (both active and inactive) in the compound 
"^DD",9002313.02,9002313.0201,447,21,2,0)
mixture submitted.  NCPDP standard field 447-EC.
"^DD",9002313.02,9002313.0201,447,23,0)
^^1^1^3080103^
"^DD",9002313.02,9002313.0201,447,23,1,0)
REQUEST COMPOUND SEGMENT.
"^DD",9002313.02,9002313.0201,447,"DT")
3080103
"^DD",9002313.02,9002313.0201,447.01,0)
COMPOUND REPEATING FIELDS^9002313.0501A^^447;0
"^DD",9002313.02,9002313.0201,447.01,21,0)
^^1^1^3080604^
"^DD",9002313.02,9002313.0201,447.01,21,1,0)
Multiple to store multiple compounds in a prescription.
"^DD",9002313.02,9002313.0201,447.01,"DT")
3080102
"^DD",9002313.02,9002313.0201,450,0)
COMPOUND DOSAGE DESCRIPTION^F^^440;10^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.0201,450,3)
Answer must be 4 characters in length
"^DD",9002313.02,9002313.0201,450,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.0201,450,21,1,0)
Dosage form of the complete compound mixture.  NCPDP standard field 
"^DD",9002313.02,9002313.0201,450,21,2,0)
450-EF.
"^DD",9002313.02,9002313.0201,450,23,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0201,450,23,1,0)
REQUEST COMPOUND SEGMENT.
"^DD",9002313.02,9002313.0201,450,"DT")
3080104
"^DD",9002313.02,9002313.0201,451,0)
COMPOUND DISPENSING INDICATOR^F^^450;1^K:$L(X)>3!($L(X)<3) X
"^DD",9002313.02,9002313.0201,451,3)
Answer must be 3 characters in length
"^DD",9002313.02,9002313.0201,451,21,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0201,451,21,1,0)
NCPDP standard product billing codes.  NCPDP standard field 451-EG.
"^DD",9002313.02,9002313.0201,451,23,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0201,451,23,1,0)
REQUEST COMPOUND SEGMENT.
"^DD",9002313.02,9002313.0201,451,"DT")
3080104
"^DD",9002313.02,9002313.0201,452,0)
COMPOUND ROUTE OF ADMIN^F^^450;2^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.0201,452,3)
Answer must be 4 characters in length
"^DD",9002313.02,9002313.0201,452,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.0201,452,21,1,0)
Code for the route of administration of the complete compound mixture.  
"^DD",9002313.02,9002313.0201,452,21,2,0)
NCPDP standard field 452-EH.
"^DD",9002313.02,9002313.0201,452,"DT")
3080104
"^DD",9002313.02,9002313.0201,453,0)
ORIGINAL PRODUCT SERVICE ID^F^^450;3^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.0201,453,3)
Answer must be 4 characters in length
"^DD",9002313.02,9002313.0201,453,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.0201,453,21,1,0)
Code qualifying the value in 'Originally Prescribed Product/Service Code'
"^DD",9002313.02,9002313.0201,453,21,2,0)
(Field 445-EA).  NCPDP standard field 453-EJ.
"^DD",9002313.02,9002313.0201,453,23,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0201,453,23,1,0)
REQUEST CLAIM SEGMENT.
"^DD",9002313.02,9002313.0201,453,"DT")
3080104
"^DD",9002313.02,9002313.0201,454,0)
SCHEDULED RX ID NUMBER^F^^450;4^K:$L(X)>14!($L(X)<14) X
"^DD",9002313.02,9002313.0201,454,3)
Answer must be 14 characters in length
"^DD",9002313.02,9002313.0201,454,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.0201,454,21,1,0)
The serial number of the prescription blank/form.  NCPDP standard field 
"^DD",9002313.02,9002313.0201,454,21,2,0)
454-EK.
"^DD",9002313.02,9002313.0201,454,23,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0201,454,23,1,0)
REQUEST CLAIM SEGMENT.
"^DD",9002313.02,9002313.0201,454,"DT")
3080104
"^DD",9002313.02,9002313.0201,455,0)
PRESCRIPTION SERVICE REFERENCE^F^^450;5^K:$L(X)>3!($L(X)<3) X
"^DD",9002313.02,9002313.0201,455,3)
Answer must be 3 characters in length
"^DD",9002313.02,9002313.0201,455,21,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0201,455,21,1,0)
Indicates the type of billing submitted.  NCPDP standard field 455-EM.
"^DD",9002313.02,9002313.0201,455,23,0)
^^3^3^3080104^
"^DD",9002313.02,9002313.0201,455,23,1,0)
Qualifies Prescription/Service Reference Number (402-D2).
"^DD",9002313.02,9002313.0201,455,23,2,0)
REQUEST CLAIM SEGMENT.
"^DD",9002313.02,9002313.0201,455,23,3,0)
RESPONSE CLAIM SEGMENT.
"^DD",9002313.02,9002313.0201,455,"DT")
3080104
"^DD",9002313.02,9002313.0201,456,0)
ASSOCIATED RX SERVICE^F^^450;6^K:$L(X)>14!($L(X)<14) X
"^DD",9002313.02,9002313.0201,456,3)
Answer must be 14 characters in length
"^DD",9002313.02,9002313.0201,456,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.0201,456,21,1,0)
Related Prescription/Service Reference Number (402-D2) to which the
"^DD",9002313.02,9002313.0201,456,21,2,0)
service is associated.  NCPDP standard field 456-EN.
"^DD",9002313.02,9002313.0201,456,23,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0201,456,23,1,0)
REQUEST CLAIM SEGMENT.
"^DD",9002313.02,9002313.0201,456,"DT")
3080104
"^DD",9002313.02,9002313.0201,457,0)
ASSOCIATED PRESCRIPTION DATE^F^^450;7^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.0201,457,3)
Answer must be 10 characters in length
"^DD",9002313.02,9002313.0201,457,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.0201,457,21,1,0)
Date of the Associated Prescription/Service Reference Number (456-EN).  
"^DD",9002313.02,9002313.0201,457,21,2,0)
NCPDP standard field 457-EP.
"^DD",9002313.02,9002313.0201,457,23,0)
^^8^8^3080104^
"^DD",9002313.02,9002313.0201,457,23,1,0)
Format=CCYYMMDD
"^DD",9002313.02,9002313.0201,457,23,2,0)
 
"^DD",9002313.02,9002313.0201,457,23,3,0)
CC=Century
"^DD",9002313.02,9002313.0201,457,23,4,0)
YY=Year
"^DD",9002313.02,9002313.0201,457,23,5,0)
MM=Month
"^DD",9002313.02,9002313.0201,457,23,6,0)
DD=Day
"^DD",9002313.02,9002313.0201,457,23,7,0)
 
"^DD",9002313.02,9002313.0201,457,23,8,0)
REQUEST CLAIM SEGMENT.
"^DD",9002313.02,9002313.0201,457,"DT")
3080104
"^DD",9002313.02,9002313.0201,458,0)
PROCEDURE MODIFIER COUNT^F^^450;8^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.0201,458,3)
Answer must be 4 characters in length
"^DD",9002313.02,9002313.0201,458,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.0201,458,21,1,0)
Count of the Procedure Modifier Code (459-ER) occurrences.  NCPDP 
"^DD",9002313.02,9002313.0201,458,21,2,0)
standard field 458-SE.
"^DD",9002313.02,9002313.0201,458,23,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0201,458,23,1,0)
REQUEST CLAIM SEGMENT.
"^DD",9002313.02,9002313.0201,458,"DT")
3080104
"^DD",9002313.02,9002313.0201,459,0)
PROCEDURE MODIFIER CODE^9002313.201459A^^459;0
"^DD",9002313.02,9002313.0201,459,21,0)
^^1^1^3031216^
"^DD",9002313.02,9002313.0201,459,21,1,0)
Multiple for storing procedure code information.
"^DD",9002313.02,9002313.0201,459,"DT")
3080102
"^DD",9002313.02,9002313.0201,460,0)
QUANTITY PRESCRIBED^F^^450;10^K:$L(X)>12!($L(X)<12) X
"^DD",9002313.02,9002313.0201,460,3)
Answer must be 12 characters in length
"^DD",9002313.02,9002313.0201,460,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.0201,460,21,1,0)
Amount expressed in metric decimal units.  Quantity prescribed during
"^DD",9002313.02,9002313.0201,460,21,2,0)
order entry.  NCPDP standard field 460-ET.
"^DD",9002313.02,9002313.0201,460,23,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.0201,460,23,1,0)
Format=9999999.999
"^DD",9002313.02,9002313.0201,460,23,2,0)
REQUEST CLAIM SEGMENT.
"^DD",9002313.02,9002313.0201,460,"DT")
3080104
"^DD",9002313.02,9002313.0201,461,0)
PRIOR AUTHORIZATION TYPE CODE^F^^460;1^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.0201,461,3)
Answer must be 4 characters in length.
"^DD",9002313.02,9002313.0201,461,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.0201,461,21,1,0)
Code clarifying the Prior Authorization Number Submitted (462-EV) or 
"^DD",9002313.02,9002313.0201,461,21,2,0)
benefit/plan exemption.  NCPDP standard field 461-EU.
"^DD",9002313.02,9002313.0201,461,23,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0201,461,23,1,0)
REQUEST CLAIM SEGMENT
"^DD",9002313.02,9002313.0201,461,"DT")
3080104
"^DD",9002313.02,9002313.0201,462,0)
PRIOR AUTHORIZATION SUBMITTED^F^^460;2^K:$L(X)>13!($L(X)<13) X
"^DD",9002313.02,9002313.0201,462,3)
Answer must be 13 characters in length.
"^DD",9002313.02,9002313.0201,462,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.0201,462,21,1,0)
Number submitted by the provider to identify the prior authorization.  
"^DD",9002313.02,9002313.0201,462,21,2,0)
NCPDP standard field 462-EV.
"^DD",9002313.02,9002313.0201,462,23,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0201,462,23,1,0)
REQUEST CLAIM SEGMENT.
"^DD",9002313.02,9002313.0201,462,"DT")
3080104
"^DD",9002313.02,9002313.0201,463,0)
INTERMEDIARY AUTH TYPE ID^F^^460;3^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.0201,463,3)
Answer must be 4 characters in length
"^DD",9002313.02,9002313.0201,463,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.0201,463,21,1,0)
Value indicating that authorization occurred for intermediary 
"^DD",9002313.02,9002313.0201,463,21,2,0)
processing.  NCPDP standard field 463-EW.
"^DD",9002313.02,9002313.0201,463,23,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0201,463,23,1,0)
REQUEST CLAIM SEGMENT
"^DD",9002313.02,9002313.0201,463,"DT")
3080104
"^DD",9002313.02,9002313.0201,464,0)
INTERMEDIARY AUTHORIZATION ID^F^^460;4^K:$L(X)>13!($L(X)<13) X
"^DD",9002313.02,9002313.0201,464,3)
Answer must be 13 characters in length
"^DD",9002313.02,9002313.0201,464,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.0201,464,21,1,0)
Value indicating intermediary authorization occurred.  NCPDP standard 
"^DD",9002313.02,9002313.0201,464,21,2,0)
field 464-EX.
"^DD",9002313.02,9002313.0201,464,23,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0201,464,23,1,0)
REQUEST CLAIM SEGMENT.
"^DD",9002313.02,9002313.0201,464,"DT")
3080104
"^DD",9002313.02,9002313.0201,465,0)
PROVIDER ID QUALIFIER^F^^460;5^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.0201,465,3)
Answer must be 4 characters in length
"^DD",9002313.02,9002313.0201,465,21,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0201,465,21,1,0)
Code qualifying the Provider ID (444-E9).  NCPDP standard field 465-EY.
"^DD",9002313.02,9002313.0201,465,23,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0201,465,23,1,0)
REQUEST PHARMACY PROVIDER SEGMENT.
"^DD",9002313.02,9002313.0201,465,"DT")
3080104
"^DD",9002313.02,9002313.0201,466,0)
PRESCRIBER ID QUALIFIER^F^^460;6^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.0201,466,3)
Answer must be 4 characters in length
"^DD",9002313.02,9002313.0201,466,21,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0201,466,21,1,0)
Code qualifying the Prescriber ID (411-DB).  NCPDP standard field 466-EZ.
"^DD",9002313.02,9002313.0201,466,23,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0201,466,23,1,0)
REQUEST PRESCRIBER SEGMENT.
"^DD",9002313.02,9002313.0201,466,"DT")
3080104
"^DD",9002313.02,9002313.0201,467,0)
PRESCRIBER LOCATION CODE^F^^460;7^K:$L(X)>5!($L(X)<5) X
"^DD",9002313.02,9002313.0201,467,3)
Answer must be 5 characters in length
"^DD",9002313.02,9002313.0201,467,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.0201,467,21,1,0)
Location address code assigned to the prescriber as identified in the
"^DD",9002313.02,9002313.0201,467,21,2,0)
National Provider System (NPS).  NCPDP standard field 467-1E.
"^DD",9002313.02,9002313.0201,467,23,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0201,467,23,1,0)
REQUEST PRESCRIBER SEGMENT.
"^DD",9002313.02,9002313.0201,467,"DT")
3080104
"^DD",9002313.02,9002313.0201,468,0)
PC PROVIDER ID QUALIFIER^F^^460;8^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.0201,468,3)
Answer must be 4 characters in length
"^DD",9002313.02,9002313.0201,468,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.0201,468,21,1,0)
Code qualifying the Primary Care Provider ID (421-DL).  NCPDP standard 
"^DD",9002313.02,9002313.0201,468,21,2,0)
field 468-2E.
"^DD",9002313.02,9002313.0201,468,23,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0201,468,23,1,0)
REQUEST PRESCRIBER SEGMENT.
"^DD",9002313.02,9002313.0201,468,"DT")
3080104
"^DD",9002313.02,9002313.0201,469,0)
PC PROVIDER LOCATION CODE^F^^460;9^K:$L(X)>5!($L(X)<5) X
"^DD",9002313.02,9002313.0201,469,3)
Answer must be 5 characters in length
"^DD",9002313.02,9002313.0201,469,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.0201,469,21,1,0)
Location address code assigned to the primary care provider as identified
"^DD",9002313.02,9002313.0201,469,21,2,0)
in the National Provider System (NPS).  NCPDP standard field 469-H5.
"^DD",9002313.02,9002313.0201,469,23,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0201,469,23,1,0)
REQUEST PRESCRIBER SEGMENT.
"^DD",9002313.02,9002313.0201,469,"DT")
3080104
"^DD",9002313.02,9002313.0201,470,0)
PC PROVIDER LAST NAME^F^^460;10^K:$L(X)>17!($L(X)<17) X
"^DD",9002313.02,9002313.0201,470,3)
Answer must be 17 characters in length
"^DD",9002313.02,9002313.0201,470,21,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0201,470,21,1,0)
Last name of the Primary Care Provider.  NCPDP standard field 470-4E.
"^DD",9002313.02,9002313.0201,470,23,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0201,470,23,1,0)
REQUEST PRESCRIBER SEGMENT.
"^DD",9002313.02,9002313.0201,470,"DT")
3080104
"^DD",9002313.02,9002313.0201,471,0)
OTHER PAYER REJECT COUNT^F^^470;1^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.0201,471,3)
Answer must be 4 characters in length
"^DD",9002313.02,9002313.0201,471,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.0201,471,21,1,0)
Count of Other Payer Reject Code (472-6E) occurrences.  NCPDP standard 
"^DD",9002313.02,9002313.0201,471,21,2,0)
field 471-5E.
"^DD",9002313.02,9002313.0201,471,23,0)
^^4^4^3080104^
"^DD",9002313.02,9002313.0201,471,23,1,0)
Number of reject codes identified by the previous "Other Payer" in  
"^DD",9002313.02,9002313.0201,471,23,2,0)
Reject Count (510-FA).
"^DD",9002313.02,9002313.0201,471,23,3,0)
 
"^DD",9002313.02,9002313.0201,471,23,4,0)
REQUEST COORDINATION OF BENEFITS/OTHER PAYMENT SEGMENT.
"^DD",9002313.02,9002313.0201,471,"DT")
3080604
"^DD",9002313.02,9002313.0201,473.01,0)
DUR PPS REPEATING FIELDS^9002313.1001A^^473.01;0
"^DD",9002313.02,9002313.0201,473.01,21,0)
^.001^1^1^3040126^^
"^DD",9002313.02,9002313.0201,473.01,21,1,0)
Count of Drug Utilization sub-records.
"^DD",9002313.02,9002313.0201,473.01,"DT")
3080102
"^DD",9002313.02,9002313.0201,477,0)
PROFESSIONAL FEE SUBMITTED^F^^470;7^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.0201,477,3)
Answer must be 10 characters in length
"^DD",9002313.02,9002313.0201,477,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.0201,477,21,1,0)
Amount submitted by the provider for professional services rendered.  
"^DD",9002313.02,9002313.0201,477,21,2,0)
NCPDP standard field 477-BE.
"^DD",9002313.02,9002313.0201,477,23,0)
^^6^6^3080104^
"^DD",9002313.02,9002313.0201,477,23,1,0)
Format=s$$$$$$cc
"^DD",9002313.02,9002313.0201,477,23,2,0)
 
"^DD",9002313.02,9002313.0201,477,23,3,0)
Examples: If the Professional Service Fee Submitted is $7.00, this field 
"^DD",9002313.02,9002313.0201,477,23,4,0)
would reflect: 70{.
"^DD",9002313.02,9002313.0201,477,23,5,0)
 
"^DD",9002313.02,9002313.0201,477,23,6,0)
REQUEST PRICING SEGMENT.
"^DD",9002313.02,9002313.0201,477,"DT")
3080104
"^DD",9002313.02,9002313.0201,478,0)
OTHER AMOUNT CLAIM COUNT^F^^470;8^K:$L(X)>3!($L(X)<3) X
"^DD",9002313.02,9002313.0201,478,3)
Answer must be 3 characters in length
"^DD",9002313.02,9002313.0201,478,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.0201,478,21,1,0)
Count of other amount claimed submitted occurrences.  NCPDP standard 
"^DD",9002313.02,9002313.0201,478,21,2,0)
field 478-H7.
"^DD",9002313.02,9002313.0201,478,23,0)
^^4^4^3080104^
"^DD",9002313.02,9002313.0201,478,23,1,0)
Fields included in the set/logical grouping are:
"^DD",9002313.02,9002313.0201,478,23,2,0)
 Other Amount Claimed Submitted Qualifier (479-H8)
"^DD",9002313.02,9002313.0201,478,23,3,0)
 Other Amount Claim Submitted (48-H9)
"^DD",9002313.02,9002313.0201,478,23,4,0)
REQUEST PRICING SEGMENT.
"^DD",9002313.02,9002313.0201,478,"DT")
3080604
"^DD",9002313.02,9002313.0201,478.01,0)
PRICING REPEATING FIELDS^9002313.0601A^^478.01;0
"^DD",9002313.02,9002313.0201,478.01,21,0)
^.001^1^1^3040126^^
"^DD",9002313.02,9002313.0201,478.01,21,1,0)
Pricing record information counter.
"^DD",9002313.02,9002313.0201,478.01,"DT")
3080102
"^DD",9002313.02,9002313.0201,481,0)
FLAT SALES TAX SUBMITTED^F^^480;1^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.0201,481,3)
Answer must be 10 characters in length
"^DD",9002313.02,9002313.0201,481,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.0201,481,21,1,0)
Flat sales tax submitted for prescription.  This amount is included in the
"^DD",9002313.02,9002313.0201,481,21,2,0)
Gross Amount Due (430-DU).  NCPDP standard field 481-HA.
"^DD",9002313.02,9002313.0201,481,23,0)
^^13^13^3080104^
"^DD",9002313.02,9002313.0201,481,23,1,0)
Format=s$$$$$$cc
"^DD",9002313.02,9002313.0201,481,23,2,0)
 
"^DD",9002313.02,9002313.0201,481,23,3,0)
The submission of sales tax is governed by regulatory agencies (state,
"^DD",9002313.02,9002313.0201,481,23,4,0)
local, parish, etc). If the sales tax reported is a flat rate, then it is
"^DD",9002313.02,9002313.0201,481,23,5,0)
a fixed amount for a certain dollar value (for example for $xxx it is a
"^DD",9002313.02,9002313.0201,481,23,6,0)
certain amount). For example, for $1 the flat rate is $1.99. This flat
"^DD",9002313.02,9002313.0201,481,23,7,0)
rate is then reported in Flat Sales Tax Amount Submitted 
"^DD",9002313.02,9002313.0201,481,23,8,0)
(481-HA).
"^DD",9002313.02,9002313.0201,481,23,9,0)
 
"^DD",9002313.02,9002313.0201,481,23,10,0)
Examples: If the flat sales tax amount submitted is $3.08, this 
"^DD",9002313.02,9002313.0201,481,23,11,0)
field would reflect: 30H. 
"^DD",9002313.02,9002313.0201,481,23,12,0)
 
"^DD",9002313.02,9002313.0201,481,23,13,0)
REQUEST PRICING SEGMENT.
"^DD",9002313.02,9002313.0201,481,"DT")
3080104
"^DD",9002313.02,9002313.0201,482,0)
PERCENTAGE SALES TAX SUBMITTED^F^^480;2^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.0201,482,3)
Answer must be 10 characters in length
"^DD",9002313.02,9002313.0201,482,21,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0201,482,21,1,0)
Percentage sales tax submitted.  NCPDP standard field 482-GE.
"^DD",9002313.02,9002313.0201,482,23,0)
^^9^9^3080104^
"^DD",9002313.02,9002313.0201,482,23,1,0)
Format=s$$$$$$cc
"^DD",9002313.02,9002313.0201,482,23,2,0)
 
"^DD",9002313.02,9002313.0201,482,23,3,0)
Comments: The submission of sales tax is governed by regulatory agencies 
"^DD",9002313.02,9002313.0201,482,23,4,0)
(state, local, parish, etc)..
"^DD",9002313.02,9002313.0201,482,23,5,0)
 
"^DD",9002313.02,9002313.0201,482,23,6,0)
Examples: If the percentage sales tax amount submitted is $4.47, this 
"^DD",9002313.02,9002313.0201,482,23,7,0)
field would reflect: 44G.
"^DD",9002313.02,9002313.0201,482,23,8,0)
 
"^DD",9002313.02,9002313.0201,482,23,9,0)
REQUEST PRICING SEGMENT.
"^DD",9002313.02,9002313.0201,482,"DT")
3080104
"^DD",9002313.02,9002313.0201,483,0)
PERCENTAGE SALES TAX RATE^F^^480;3^K:$L(X)>9!($L(X)<9) X
"^DD",9002313.02,9002313.0201,483,3)
Answer must be 9 characters in length
"^DD",9002313.02,9002313.0201,483,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.0201,483,21,1,0)
Percentage sales tax rate used to calculate Percentage Sales Tax Amount
"^DD",9002313.02,9002313.0201,483,21,2,0)
Submitted (482-GE).  NCPDP standard field 483-HE.
"^DD",9002313.02,9002313.0201,483,23,0)
^^6^6^3080104^
"^DD",9002313.02,9002313.0201,483,23,1,0)
The submission of sales tax is governed by regulatory agencies (state, 
"^DD",9002313.02,9002313.0201,483,23,2,0)
local, parish, etc).
"^DD",9002313.02,9002313.0201,483,23,3,0)
 
"^DD",9002313.02,9002313.0201,483,23,4,0)
Format=s999.9999
"^DD",9002313.02,9002313.0201,483,23,5,0)
 
"^DD",9002313.02,9002313.0201,483,23,6,0)
REQUEST PRICING SEGMENT.
"^DD",9002313.02,9002313.0201,483,"DT")
3080104
"^DD",9002313.02,9002313.0201,484,0)
PERCENTAGE SALES TAX BASIS^F^^480;4^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.0201,484,3)
Answer must be 4 characters in length
"^DD",9002313.02,9002313.0201,484,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.0201,484,21,1,0)
Code indicating the basis for percentage sales tax.  NCPDP standard field 
"^DD",9002313.02,9002313.0201,484,21,2,0)
484-JE.
"^DD",9002313.02,9002313.0201,484,23,0)
^^4^4^3080104^
"^DD",9002313.02,9002313.0201,484,23,1,0)
The submission of sales tax is governed by regulatory agencies (state, 
"^DD",9002313.02,9002313.0201,484,23,2,0)
local, parish, etc).
"^DD",9002313.02,9002313.0201,484,23,3,0)
 
"^DD",9002313.02,9002313.0201,484,23,4,0)
REQUEST PRICING SEGMENT.
"^DD",9002313.02,9002313.0201,484,"DT")
3080104
"^DD",9002313.02,9002313.0201,485,0)
COUPON TYPE^F^^480;5^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.0201,485,3)
Answer must be 4 characters in length
"^DD",9002313.02,9002313.0201,485,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.0201,485,21,1,0)
Code indicating the type of coupon being used.  NCPDP standard field 
"^DD",9002313.02,9002313.0201,485,21,2,0)
485-KE.
"^DD",9002313.02,9002313.0201,485,23,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0201,485,23,1,0)
REQUEST COUPON SEGMENT.
"^DD",9002313.02,9002313.0201,485,"DT")
3080104
"^DD",9002313.02,9002313.0201,486,0)
COUPON NUMBER^F^^480;6^K:$L(X)>17!($L(X)<17) X
"^DD",9002313.02,9002313.0201,486,3)
Answer must be 17 characters in length
"^DD",9002313.02,9002313.0201,486,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.0201,486,21,1,0)
Unique serial number assigned to the prescription coupons.  NCPDP 
"^DD",9002313.02,9002313.0201,486,21,2,0)
standard field 486-ME.
"^DD",9002313.02,9002313.0201,486,23,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0201,486,23,1,0)
REQUEST COUPON SEGMENT.
"^DD",9002313.02,9002313.0201,486,"DT")
3080104
"^DD",9002313.02,9002313.0201,487,0)
COUPON VALUE AMOUNT^F^^480;7^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.0201,487,3)
Answer must be 10 characters in length
"^DD",9002313.02,9002313.0201,487,21,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0201,487,21,1,0)
Value of the coupon.  NCPDP standard field 487-NE.
"^DD",9002313.02,9002313.0201,487,23,0)
^^6^6^3080104^
"^DD",9002313.02,9002313.0201,487,23,1,0)
Format=s$$$$$$vcc
"^DD",9002313.02,9002313.0201,487,23,2,0)
 
"^DD",9002313.02,9002313.0201,487,23,3,0)
Examples: If the coupon value amount is $10.00, this field would reflect: 
"^DD",9002313.02,9002313.0201,487,23,4,0)
100{.
"^DD",9002313.02,9002313.0201,487,23,5,0)
 
"^DD",9002313.02,9002313.0201,487,23,6,0)
REQUEST COUPON SEGMENT.
"^DD",9002313.02,9002313.0201,487,"DT")
3080104
"^DD",9002313.02,9002313.0201,491,0)
DIAGNOSIS CODE COUNT^F^^490;1^K:$L(X)>3!($L(X)<3) X
"^DD",9002313.02,9002313.0201,491,3)
Answer must be 3 characters in length
"^DD",9002313.02,9002313.0201,491,21,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0201,491,21,1,0)
Count of diagnosis occurrences.  NCPDP standard field 491-VE.
"^DD",9002313.02,9002313.0201,491,23,0)
^^4^4^3080104^
"^DD",9002313.02,9002313.0201,491,23,1,0)
Fields included in the set/logical grouping are:
"^DD",9002313.02,9002313.0201,491,23,2,0)
 Diagnosis Code Qualifier (492-WE)
"^DD",9002313.02,9002313.0201,491,23,3,0)
 Diagnosis Code (424-DO)
"^DD",9002313.02,9002313.0201,491,23,4,0)
REQUEST CLINICAL SEGMENT.
"^DD",9002313.02,9002313.0201,491,"DT")
3080104
"^DD",9002313.02,9002313.0201,491.01,0)
CLINICAL DIAGNOSIS^9002313.0701A^^491.01;0
"^DD",9002313.02,9002313.0201,491.01,21,0)
^^1^1^3080102^
"^DD",9002313.02,9002313.0201,491.01,21,1,0)
Diagnosis sub-records.
"^DD",9002313.02,9002313.0201,491.01,"DT")
3080102
"^DD",9002313.02,9002313.0201,493,0)
CLINICAL INFORMATION COUNT^F^^493;1^K:$L(X)>3!($L(X)<3) X
"^DD",9002313.02,9002313.0201,493,3)
Answer must be 3 characters in length
"^DD",9002313.02,9002313.0201,493,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.0201,493,21,1,0)
Counter number of clinical information measurement set/logical grouping.  
"^DD",9002313.02,9002313.0201,493,21,2,0)
NCPDP standard field 493-XE.
"^DD",9002313.02,9002313.0201,493,23,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0201,493,23,1,0)
REQUEST CLINICAL SEGMENT.
"^DD",9002313.02,9002313.0201,493,"DT")
3080104
"^DD",9002313.02,9002313.0201,493.01,0)
CLINICAL INFORMATION^9002313.0801A^^493.01;0
"^DD",9002313.02,9002313.0201,493.01,21,0)
^.001^1^1^3040126^^^
"^DD",9002313.02,9002313.0201,493.01,21,1,0)
Count of clinical information sub-records.
"^DD",9002313.02,9002313.0201,493.01,"DT")
3080102
"^DD",9002313.02,9002313.0201,498.01,0)
REQUEST TYPE^F^^498;1^K:$L(X)>3!($L(X)<3) X
"^DD",9002313.02,9002313.0201,498.01,3)
Answer must be 3 characters in length
"^DD",9002313.02,9002313.0201,498.01,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.0201,498.01,21,1,0)
Code identifying type of prior authorization request.  NCPDP standard 
"^DD",9002313.02,9002313.0201,498.01,21,2,0)
field 498-PA.
"^DD",9002313.02,9002313.0201,498.01,23,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.0201,498.01,23,1,0)
Used by processor to distinguish reason for prior authorization request.
"^DD",9002313.02,9002313.0201,498.01,23,2,0)
REQUEST PRIOR AUTHORIZATION SEGMENT.
"^DD",9002313.02,9002313.0201,498.01,"DT")
3080104
"^DD",9002313.02,9002313.0201,498.02,0)
REQUEST PERIOD BEGIN DATE^F^^498;2^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.0201,498.02,3)
Answer must be 10 characters in length
"^DD",9002313.02,9002313.0201,498.02,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.0201,498.02,21,1,0)
Beginning date for a prior authorization request.  NCPDP standard field 
"^DD",9002313.02,9002313.0201,498.02,21,2,0)
498-PB.
"^DD",9002313.02,9002313.0201,498.02,23,0)
^^11^11^3080104^
"^DD",9002313.02,9002313.0201,498.02,23,1,0)
Format=CCYYMMDD
"^DD",9002313.02,9002313.0201,498.02,23,2,0)
 
"^DD",9002313.02,9002313.0201,498.02,23,3,0)
CC=Century
"^DD",9002313.02,9002313.0201,498.02,23,4,0)
YY=Year
"^DD",9002313.02,9002313.0201,498.02,23,5,0)
MM=Month
"^DD",9002313.02,9002313.0201,498.02,23,6,0)
DD=Day
"^DD",9002313.02,9002313.0201,498.02,23,7,0)
 
"^DD",9002313.02,9002313.0201,498.02,23,8,0)
Used by processor to determine starting date of a prior authorization
"^DD",9002313.02,9002313.0201,498.02,23,9,0)
request.
"^DD",9002313.02,9002313.0201,498.02,23,10,0)
 
"^DD",9002313.02,9002313.0201,498.02,23,11,0)
REQUEST PRIOR AUTHORIZATION SEGMENT.
"^DD",9002313.02,9002313.0201,498.02,"DT")
3080104
"^DD",9002313.02,9002313.0201,498.03,0)
REQUEST PERIOD END DATE^F^^498;3^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.0201,498.03,3)
Answer must be 10 characters in length
"^DD",9002313.02,9002313.0201,498.03,21,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0201,498.03,21,1,0)
End date for a prior authorization request.  NCPDP standard field 498-PC.
"^DD",9002313.02,9002313.0201,498.03,23,0)
^^10^10^3080104^
"^DD",9002313.02,9002313.0201,498.03,23,1,0)
Format=CCYYMMDD
"^DD",9002313.02,9002313.0201,498.03,23,2,0)
 
"^DD",9002313.02,9002313.0201,498.03,23,3,0)
CC=Century
"^DD",9002313.02,9002313.0201,498.03,23,4,0)
YY=Year
"^DD",9002313.02,9002313.0201,498.03,23,5,0)
MM=Month
"^DD",9002313.02,9002313.0201,498.03,23,6,0)
DD=Day
"^DD",9002313.02,9002313.0201,498.03,23,7,0)
Used by processor to determine the ending date for a prior authorization
"^DD",9002313.02,9002313.0201,498.03,23,8,0)
request.
"^DD",9002313.02,9002313.0201,498.03,23,9,0)
 
"^DD",9002313.02,9002313.0201,498.03,23,10,0)
REQUEST PRIOR AUTHORIZATION SEGMENT.
"^DD",9002313.02,9002313.0201,498.03,"DT")
3080104
"^DD",9002313.02,9002313.0201,498.04,0)
BASIS OF REQUEST^F^^498;4^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.0201,498.04,3)
Answer must be 4 characters in length
"^DD",9002313.02,9002313.0201,498.04,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.0201,498.04,21,1,0)
Code describing the reason for prior authorization request.  NCPDP 
"^DD",9002313.02,9002313.0201,498.04,21,2,0)
standard field 498-PD.
"^DD",9002313.02,9002313.0201,498.04,23,0)
^^3^3^3080104^
"^DD",9002313.02,9002313.0201,498.04,23,1,0)
Used by processor to determine appropriate modules and editing for the 
"^DD",9002313.02,9002313.0201,498.04,23,2,0)
prior authorization transaction.
"^DD",9002313.02,9002313.0201,498.04,23,3,0)
REQUEST PRIOR AUTHORIZATION SEGMENT.
"^DD",9002313.02,9002313.0201,498.04,"DT")
3080104
"^DD",9002313.02,9002313.0201,498.05,0)
AUTHORIZED REP FIRST NAME^F^^498;5^K:$L(X)>14!($L(X)<14) X
"^DD",9002313.02,9002313.0201,498.05,3)
Answer must be 14 characters in length
"^DD",9002313.02,9002313.0201,498.05,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.0201,498.05,21,1,0)
First name of the patients authorized representative.  NCPDP standard 
"^DD",9002313.02,9002313.0201,498.05,21,2,0)
field 498-PE.
"^DD",9002313.02,9002313.0201,498.05,23,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0201,498.05,23,1,0)
REQUEST PRIOR AUTHORIZATION SEGMENT.
"^DD",9002313.02,9002313.0201,498.05,"DT")
3080104
"^DD",9002313.02,9002313.0201,498.06,0)
AUTHORIZED REP LAST NAME^F^^498;6^K:$L(X)>17!($L(X)<17) X
"^DD",9002313.02,9002313.0201,498.06,3)
Answer must be 17 characters in length
"^DD",9002313.02,9002313.0201,498.06,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.0201,498.06,21,1,0)
Last name of the patients authorized representative.  NCPDP standard 
"^DD",9002313.02,9002313.0201,498.06,21,2,0)
field 498-PF.
"^DD",9002313.02,9002313.0201,498.06,23,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0201,498.06,23,1,0)
REQUEST PRIOR AUTHORIZATION SEGMENT.
"^DD",9002313.02,9002313.0201,498.06,"DT")
3080104
"^DD",9002313.02,9002313.0201,498.07,0)
AUTHORIZED REP STREET ADDRESS^F^^498;7^K:$L(X)>32!($L(X)<32) X
"^DD",9002313.02,9002313.0201,498.07,3)
Answer must be 32 characters in length
"^DD",9002313.02,9002313.0201,498.07,21,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0201,498.07,21,1,0)
Free-form text for address information.  NCPDP standard field 498-PG.
"^DD",9002313.02,9002313.0201,498.07,23,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0201,498.07,23,1,0)
REQUEST PRIOR AUTHORIZATION SEGMENT.
"^DD",9002313.02,9002313.0201,498.07,"DT")
3080104
"^DD",9002313.02,9002313.0201,498.08,0)
AUTHORIZED REP CITY ADDRESS^F^^498;8^K:$L(X)>22!($L(X)<22) X
"^DD",9002313.02,9002313.0201,498.08,3)
Answer must be 22 characters in length
"^DD",9002313.02,9002313.0201,498.08,21,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0201,498.08,21,1,0)
Free-form text for city name.  NCPDP standard field 498-PH.
"^DD",9002313.02,9002313.0201,498.08,23,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0201,498.08,23,1,0)
REQUEST PRIOR AUTHORIZATION SEGMENT.
"^DD",9002313.02,9002313.0201,498.08,"DT")
3080104
"^DD",9002313.02,9002313.0201,498.09,0)
AUTHORIZED REP STATE PROV^F^^498;9^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.0201,498.09,3)
Answer must be 4 characters in length
"^DD",9002313.02,9002313.0201,498.09,21,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0201,498.09,21,1,0)
Authorized Rep's State or Province.  NCPDP standard field 498-PJ.
"^DD",9002313.02,9002313.0201,498.09,23,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0201,498.09,23,1,0)
REQUEST PRIOR AUTHORIZATION SEGMENT.
"^DD",9002313.02,9002313.0201,498.09,"DT")
3080104
"^DD",9002313.02,9002313.0201,498.11,0)
AUTHORIZED REP ZIP^F^^498;11^K:$L(X)>17!($L(X)<17) X
"^DD",9002313.02,9002313.0201,498.11,3)
Answer must be 17 characters in length
"^DD",9002313.02,9002313.0201,498.11,21,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0201,498.11,21,1,0)
Authorized Rep's Zip Code.  NCPDP standard field 498-PK.
"^DD",9002313.02,9002313.0201,498.11,23,0)
^^4^4^3080104^
"^DD",9002313.02,9002313.0201,498.11,23,1,0)
This left-justified field contains the five-digit zip code, and may 
"^DD",9002313.02,9002313.0201,498.11,23,2,0)
include the four-digit expanded zip code in which the patient's 
"^DD",9002313.02,9002313.0201,498.11,23,3,0)
authorized representative is located.
"^DD",9002313.02,9002313.0201,498.11,23,4,0)
REQUEST PRIOR AUTHORIZATION SEGMENT.
"^DD",9002313.02,9002313.0201,498.11,"DT")
3080104
"^DD",9002313.02,9002313.0201,498.12,0)
PRESCRIBER PHONE NUMBER^F^^498;12^K:$L(X)>12!($L(X)<12) X
"^DD",9002313.02,9002313.0201,498.12,3)
Answer must be 12 characters in length
"^DD",9002313.02,9002313.0201,498.12,21,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0201,498.12,21,1,0)
Ten digit phone number of the prescriber.  NCPDP standard field 498-PM.
"^DD",9002313.02,9002313.0201,498.12,23,0)
^^10^10^3080104^
"^DD",9002313.02,9002313.0201,498.12,23,1,0)
Format=AAAEEENNNN
"^DD",9002313.02,9002313.0201,498.12,23,2,0)
 
"^DD",9002313.02,9002313.0201,498.12,23,3,0)
AAA=Area Code
"^DD",9002313.02,9002313.0201,498.12,23,4,0)
EEE=Exchange Code
"^DD",9002313.02,9002313.0201,498.12,23,5,0)
NNNN=Number
"^DD",9002313.02,9002313.0201,498.12,23,6,0)
 
"^DD",9002313.02,9002313.0201,498.12,23,7,0)
Examples: This field would reflect the telephone number of (414) 555-1212 
"^DD",9002313.02,9002313.0201,498.12,23,8,0)
as 4145551212.
"^DD",9002313.02,9002313.0201,498.12,23,9,0)
 
"^DD",9002313.02,9002313.0201,498.12,23,10,0)
REQUEST PRESCRIBER SEGMENT.
"^DD",9002313.02,9002313.0201,498.12,"DT")
3080104
"^DD",9002313.02,9002313.0201,498.13,0)
PRIOR AUTH SUPPORTING INFO^9002313.0901^^498.13;0
"^DD",9002313.02,9002313.0201,498.13,21,0)
^^1^1^3080604^
"^DD",9002313.02,9002313.0201,498.13,21,1,0)
Free text message.  NCPDP field number 498-PP.
"^DD",9002313.02,9002313.0201,498.13,23,0)
^^4^4^3080604^
"^DD",9002313.02,9002313.0201,498.13,23,1,0)
Could be used, if applicable, to supply information not already included 
"^DD",9002313.02,9002313.0201,498.13,23,2,0)
in NCPDP data fields that may be required to process a prior 
"^DD",9002313.02,9002313.0201,498.13,23,3,0)
authorization transaction.
"^DD",9002313.02,9002313.0201,498.13,23,4,0)
REQUEST PRIOR AUTHORIZATION SEGMENT.
"^DD",9002313.02,9002313.0201,498.13,"DT")
3080102
"^DD",9002313.02,9002313.0201,498.14,0)
PRIOR AUTH NUMBER ASSIGNED^F^^498;14^K:$L(X)>13!($L(X)<13) X
"^DD",9002313.02,9002313.0201,498.14,3)
Answer must be 13 characters in length
"^DD",9002313.02,9002313.0201,498.14,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.0201,498.14,21,1,0)
Unique number identifying the prior authorization assigned by the
"^DD",9002313.02,9002313.0201,498.14,21,2,0)
processor.  NCPDP standard field 498-PY.
"^DD",9002313.02,9002313.0201,498.14,23,0)
^^4^4^3080104^
"^DD",9002313.02,9002313.0201,498.14,23,1,0)
Provided to the pharmacy by the processor to be used by the pharmacy for 
"^DD",9002313.02,9002313.0201,498.14,23,2,0)
billing, and if applicable, reversal purposes.
"^DD",9002313.02,9002313.0201,498.14,23,3,0)
REQUEST PRIOR AUTHORIZATION SEGMENT.
"^DD",9002313.02,9002313.0201,498.14,23,4,0)
RESPONSE PRIOR AUTHORIZATION SEGMENT.
"^DD",9002313.02,9002313.0201,498.14,"DT")
3080104
"^DD",9002313.02,9002313.0201,503,0)
AUTHORIZATION NUMBER^F^^500;3^K:$L(X)>22!($L(X)<22) X
"^DD",9002313.02,9002313.0201,503,3)
Answer must be 22 characters in length
"^DD",9002313.02,9002313.0201,503,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.0201,503,21,1,0)
Unique number identifying the prior authorization assigned by the
"^DD",9002313.02,9002313.0201,503,21,2,0)
processor.  NCPDP standard field 503-F3.
"^DD",9002313.02,9002313.0201,503,23,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.0201,503,23,1,0)
REQUEST PRIOR AUTHORIZATION SEGMENT.
"^DD",9002313.02,9002313.0201,503,23,2,0)
RESPONSE STATUS SEGMENT.
"^DD",9002313.02,9002313.0201,503,"DT")
3080104
"^DD",9002313.02,9002313.0201,600,0)
UNIT OF MEASURE^F^^600;1^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.0201,600,3)
Enter the Unit of Measure (4 characters)
"^DD",9002313.02,9002313.0201,600,21,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0201,600,21,1,0)
Unit of measure of the prescription.  NCPDP standard field 600-28.
"^DD",9002313.02,9002313.0201,600,23,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0201,600,23,1,0)
REQUEST CLAIM SEGMENT.
"^DD",9002313.02,9002313.0201,600,"DT")
3080104
"^DD",9002313.02,9002313.0401,0)
COB OTHER PAYMENTS SUB-FIELD^^472^9
"^DD",9002313.02,9002313.0401,0,"DT")
3080604
"^DD",9002313.02,9002313.0401,0,"IX","B",9002313.0401,.01)

"^DD",9002313.02,9002313.0401,0,"NM","COB OTHER PAYMENTS")

"^DD",9002313.02,9002313.0401,0,"UP")
9002313.0201
"^DD",9002313.02,9002313.0401,.01,0)
COB OTHER PAYMENT COUNTER^F^^0;1^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.0401,.01,1,0)
^.1
"^DD",9002313.02,9002313.0401,.01,1,1,0)
9002313.0401^B
"^DD",9002313.02,9002313.0401,.01,1,1,1)
S ^BPSC(DA(2),400,DA(1),337,"B",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.0401,.01,1,1,2)
K ^BPSC(DA(2),400,DA(1),337,"B",$E(X,1,30),DA)
"^DD",9002313.02,9002313.0401,.01,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.0401,.01,21,0)
^^2^2^3080604^
"^DD",9002313.02,9002313.0401,.01,21,1,0)
This is a multiple counter field to store multiple COB payments received
"^DD",9002313.02,9002313.0401,.01,21,2,0)
from other payers.
"^DD",9002313.02,9002313.0401,.01,"DT")
3080604
"^DD",9002313.02,9002313.0401,338,0)
OTHER PAYER COVERAGE TYPE^F^^0;2^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.0401,338,3)
Answer must be 4 characters in length
"^DD",9002313.02,9002313.0401,338,21,0)
^^2^2^3080103^
"^DD",9002313.02,9002313.0401,338,21,1,0)
Code identifying the type of Other Payer ID (340-7C).  NCPDP standard 
"^DD",9002313.02,9002313.0401,338,21,2,0)
field 338-5C.
"^DD",9002313.02,9002313.0401,338,23,0)
^^2^2^3080103^
"^DD",9002313.02,9002313.0401,338,23,1,0)
REQUEST COORDINATION OF BENEFITS/OTHER PAYMENT SEGMENT.
"^DD",9002313.02,9002313.0401,338,23,2,0)
RESPONSE COORDINATION OF BENEFITS/OTHER PAYMENT SEGMENT.
"^DD",9002313.02,9002313.0401,338,"DT")
3080103
"^DD",9002313.02,9002313.0401,339,0)
OTHER PAYER ID QUALIFIER^F^^0;3^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.0401,339,3)
Answer must be 4 characters in length
"^DD",9002313.02,9002313.0401,339,21,0)
^^1^1^3080103^
"^DD",9002313.02,9002313.0401,339,21,1,0)
Code qualifying the Other Payer ID (340-7C).  NCPDP standard field 339-6C.
"^DD",9002313.02,9002313.0401,339,23,0)
^^2^2^3080103^
"^DD",9002313.02,9002313.0401,339,23,1,0)
REQUEST COORDINATION OF BENEFITS/OTHER PAYMENT SEGMENT.
"^DD",9002313.02,9002313.0401,339,23,2,0)
RESPONSE COORDINATION OF BENEFITS/OTHER PAYERS SEGMENT.
"^DD",9002313.02,9002313.0401,339,"DT")
3080103
"^DD",9002313.02,9002313.0401,340,0)
OTHER PAYER ID^F^^0;4^K:$L(X)>12!($L(X)<12) X
"^DD",9002313.02,9002313.0401,340,3)
Answer must be 12 characters in length
"^DD",9002313.02,9002313.0401,340,21,0)
^^1^1^3080103^
"^DD",9002313.02,9002313.0401,340,21,1,0)
ID assigned to the payer.  NCPDP standard field 340-7C.
"^DD",9002313.02,9002313.0401,340,23,0)
^^3^3^3080103^
"^DD",9002313.02,9002313.0401,340,23,1,0)
Qualified by Other Payer ID Qualifier (339-6C).
"^DD",9002313.02,9002313.0401,340,23,2,0)
REQUEST COORDINATION OF BENEFITS/OTHER PAYMENT SEGMENT.
"^DD",9002313.02,9002313.0401,340,23,3,0)
RESPONSE COORDINATION OF BENEFITS/OTHER PAYERS SEGMENT.
"^DD",9002313.02,9002313.0401,340,"DT")
3080103
"^DD",9002313.02,9002313.0401,341,0)
OTHER PAYER AMOUNT PAID COUNT^F^^0;6^K:$L(X)>3!($L(X)<3) X
"^DD",9002313.02,9002313.0401,341,3)
Answer must be 3 characters in length
"^DD",9002313.02,9002313.0401,341,21,0)
^^1^1^3080103^
"^DD",9002313.02,9002313.0401,341,21,1,0)
Count of the payer amount paid occurrences.  NCPDP standard field 341-HB.
"^DD",9002313.02,9002313.0401,341,23,0)
^^1^1^3080103^
"^DD",9002313.02,9002313.0401,341,23,1,0)
REQUEST COORDINATION OF BENEFITS/OTHER PAYMENT SEGMENT.
"^DD",9002313.02,9002313.0401,341,"DT")
3080103
"^DD",9002313.02,9002313.0401,342,0)
OTHER PAYER AMT PAID QUALIFIER^9002313.401342A^^1;0
"^DD",9002313.02,9002313.0401,342,21,0)
^^1^1^3080604^
"^DD",9002313.02,9002313.0401,342,21,1,0)
Code qualifying the 'Other Payer Amount Paid' (431-DV).
"^DD",9002313.02,9002313.0401,342,23,0)
^^1^1^3080604^
"^DD",9002313.02,9002313.0401,342,23,1,0)
REQUEST COORDINATION OF BENEFITS/OTHER PAYMENT SEGMENT
"^DD",9002313.02,9002313.0401,342,"DT")
3080102
"^DD",9002313.02,9002313.0401,443,0)
OTHER PAYER DATE^FO^^0;5^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.0401,443,2)
S Y(0)=Y S Y=$$FM3EXT^BPSOSU1(Y)
"^DD",9002313.02,9002313.0401,443,2.1)
S Y=$$FM3EXT^BPSOSU1(Y)
"^DD",9002313.02,9002313.0401,443,3)
Answer must be 10 characters in length
"^DD",9002313.02,9002313.0401,443,21,0)
^^2^2^3080613^^
"^DD",9002313.02,9002313.0401,443,21,1,0)
Payment or denial date of the claim submitted to the other payer. Used 
"^DD",9002313.02,9002313.0401,443,21,2,0)
for coordination of benefits.
"^DD",9002313.02,9002313.0401,443,23,0)
^^11^11^3080613^
"^DD",9002313.02,9002313.0401,443,23,1,0)
Format=CCYYMMDD
"^DD",9002313.02,9002313.0401,443,23,2,0)
 
"^DD",9002313.02,9002313.0401,443,23,3,0)
CC=Century
"^DD",9002313.02,9002313.0401,443,23,4,0)
YY=Year
"^DD",9002313.02,9002313.0401,443,23,5,0)
MM=Month
"^DD",9002313.02,9002313.0401,443,23,6,0)
DD=Day
"^DD",9002313.02,9002313.0401,443,23,7,0)
 
"^DD",9002313.02,9002313.0401,443,23,8,0)
Examples: If the other payer denial date was August 1,1999, this field 
"^DD",9002313.02,9002313.0401,443,23,9,0)
would reflect: 19990801.
"^DD",9002313.02,9002313.0401,443,23,10,0)
 
"^DD",9002313.02,9002313.0401,443,23,11,0)
REQUEST COORDINATION OF BENEFITS/OTHER PAYMENT SEGMENT
"^DD",9002313.02,9002313.0401,443,"DT")
3080613
"^DD",9002313.02,9002313.0401,471,0)
OTHER PAYER REJECT COUNT^F^^0;7^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.02,9002313.0401,471,3)
Answer must be 2 characters in length.
"^DD",9002313.02,9002313.0401,471,21,0)
^^1^1^3031125^
"^DD",9002313.02,9002313.0401,471,21,1,0)
Count of 'Other Payer Reject Code' (472) occurrences.
"^DD",9002313.02,9002313.0401,471,"DT")
3080102
"^DD",9002313.02,9002313.0401,472,0)
OTHER PAYER REJECT CODE^9002313.401472A^^2;0
"^DD",9002313.02,9002313.0401,472,21,0)
^^1^1^3080604^
"^DD",9002313.02,9002313.0401,472,21,1,0)
Multiple to store rejects received from other payers.
"^DD",9002313.02,9002313.0401,472,"DT")
3080102
"^DD",9002313.02,9002313.0501,0)
COMPOUND REPEATING FIELDS SUB-FIELD^^490^6
"^DD",9002313.02,9002313.0501,0,"DT")
3080103
"^DD",9002313.02,9002313.0501,0,"IX","B",9002313.0501,.01)

"^DD",9002313.02,9002313.0501,0,"NM","COMPOUND REPEATING FIELDS")

"^DD",9002313.02,9002313.0501,0,"UP")
9002313.0201
"^DD",9002313.02,9002313.0501,.01,0)
COMPOUND REPEATING COUNT^F^^0;1^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.0501,.01,1,0)
^.1
"^DD",9002313.02,9002313.0501,.01,1,1,0)
9002313.0501^B
"^DD",9002313.02,9002313.0501,.01,1,1,1)
S ^BPSC(DA(2),400,DA(1),447,"B",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.0501,.01,1,1,2)
K ^BPSC(DA(2),400,DA(1),447,"B",$E(X,1,30),DA)
"^DD",9002313.02,9002313.0501,.01,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.0501,.01,21,0)
^^1^1^3031216^
"^DD",9002313.02,9002313.0501,.01,21,1,0)
Count of Compounds for this medication.
"^DD",9002313.02,9002313.0501,.01,"DT")
3080102
"^DD",9002313.02,9002313.0501,448,0)
COMPOUND INGREDIENT QUANTITY^F^^0;4^K:$L(X)>12!($L(X)<12) X
"^DD",9002313.02,9002313.0501,448,3)
Answer must be 12 characters in length
"^DD",9002313.02,9002313.0501,448,21,0)
^^2^2^3080103^
"^DD",9002313.02,9002313.0501,448,21,1,0)
Amount expressed in metric decimal units of the product included in the 
"^DD",9002313.02,9002313.0501,448,21,2,0)
compound mixture.  NCPDP standard field 448-ED.
"^DD",9002313.02,9002313.0501,448,23,0)
^^2^2^3080103^
"^DD",9002313.02,9002313.0501,448,23,1,0)
Format=9999999.999
"^DD",9002313.02,9002313.0501,448,23,2,0)
REQUEST COMPOUND SEGMENT.
"^DD",9002313.02,9002313.0501,448,"DT")
3080103
"^DD",9002313.02,9002313.0501,449,0)
COMPOUND INGREDIENT DRUG COST^F^^0;5^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.0501,449,3)
Answer must be 10 characters in length
"^DD",9002313.02,9002313.0501,449,21,0)
^^3^3^3080103^
"^DD",9002313.02,9002313.0501,449,21,1,0)
Ingredient cost for the metric decimal quantity of the product included 
"^DD",9002313.02,9002313.0501,449,21,2,0)
in the compound mixture indicated in Compound Ingredient Quantity  
"^DD",9002313.02,9002313.0501,449,21,3,0)
(Field 448-ED).  NCPDP standard field 449-EE.
"^DD",9002313.02,9002313.0501,449,23,0)
^^2^2^3080103^
"^DD",9002313.02,9002313.0501,449,23,1,0)
Format=s$$$$$$cc
"^DD",9002313.02,9002313.0501,449,23,2,0)
REQUEST COMPOUND SEGMENT.
"^DD",9002313.02,9002313.0501,449,"DT")
3080103
"^DD",9002313.02,9002313.0501,488,0)
COMPUND PRODUCT ID QUALIFIER^F^^0;2^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.0501,488,3)
Answer must be 4 characters in length
"^DD",9002313.02,9002313.0501,488,21,0)
^^2^2^3080103^
"^DD",9002313.02,9002313.0501,488,21,1,0)
Code qualifying the type of product dispensed.  NCPDP standard field 
"^DD",9002313.02,9002313.0501,488,21,2,0)
488-RE.
"^DD",9002313.02,9002313.0501,488,23,0)
^^2^2^3080103^
"^DD",9002313.02,9002313.0501,488,23,1,0)
Qualifies Compound Product ID (489-TE).
"^DD",9002313.02,9002313.0501,488,23,2,0)
REQUEST COMPOUND SEGMENT.
"^DD",9002313.02,9002313.0501,488,"DT")
3080103
"^DD",9002313.02,9002313.0501,489,0)
COMPOUND PRODUCT ID^F^^0;3^K:$L(X)>21!($L(X)<21) X
"^DD",9002313.02,9002313.0501,489,3)
Answer must be 21 characters in length
"^DD",9002313.02,9002313.0501,489,21,0)
^^2^2^3080103^
"^DD",9002313.02,9002313.0501,489,21,1,0)
Product identification of an ingredient used in a compound.  NCPDP 
"^DD",9002313.02,9002313.0501,489,21,2,0)
standard field 489-TE.
"^DD",9002313.02,9002313.0501,489,23,0)
^^2^2^3080103^
"^DD",9002313.02,9002313.0501,489,23,1,0)
Qualified by Compound Product ID Qualifier (488-RE).
"^DD",9002313.02,9002313.0501,489,23,2,0)
REQUEST COMPOUND SEGMENT.
"^DD",9002313.02,9002313.0501,489,"DT")
3080103
"^DD",9002313.02,9002313.0501,490,0)
COMPOUND INGREDIENT COST BASIS^F^^0;6^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.0501,490,3)
Answer must be 4 characters in length
"^DD",9002313.02,9002313.0501,490,21,0)
^^2^2^3080103^
"^DD",9002313.02,9002313.0501,490,21,1,0)
Code indicating the method by which the drug cost of an ingredient used 
"^DD",9002313.02,9002313.0501,490,21,2,0)
in a compound was calculated.  NCPDP standard field 490-UE.
"^DD",9002313.02,9002313.0501,490,23,0)
^^1^1^3080103^
"^DD",9002313.02,9002313.0501,490,23,1,0)
REQUEST COMPOUND SEGMENT.
"^DD",9002313.02,9002313.0501,490,"DT")
3080103
"^DD",9002313.02,9002313.0601,0)
PRICING REPEATING FIELDS SUB-FIELD^^480^3
"^DD",9002313.02,9002313.0601,0,"DT")
3080104
"^DD",9002313.02,9002313.0601,0,"IX","B",9002313.0601,.01)

"^DD",9002313.02,9002313.0601,0,"NM","PRICING REPEATING FIELDS")

"^DD",9002313.02,9002313.0601,0,"UP")
9002313.0201
"^DD",9002313.02,9002313.0601,.01,0)
PRICING COUNTER^F^^0;1^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.0601,.01,1,0)
^.1
"^DD",9002313.02,9002313.0601,.01,1,1,0)
9002313.0601^B
"^DD",9002313.02,9002313.0601,.01,1,1,1)
S ^BPSC(DA(2),400,DA(1),478.01,"B",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.0601,.01,1,1,2)
K ^BPSC(DA(2),400,DA(1),478.01,"B",$E(X,1,30),DA)
"^DD",9002313.02,9002313.0601,.01,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.0601,.01,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.0601,.01,21,1,0)
The number of pricing entries in the sub file.  Used for coordination of
"^DD",9002313.02,9002313.0601,.01,21,2,0)
benefits.
"^DD",9002313.02,9002313.0601,.01,"DT")
3080104
"^DD",9002313.02,9002313.0601,479,0)
OTHER AMOUNT CLAIMED CODE^F^^0;2^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.0601,479,3)
Answer must be 4 characters in length
"^DD",9002313.02,9002313.0601,479,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.0601,479,21,1,0)
Code identifying the additional incurred cost claimed in Other Amount
"^DD",9002313.02,9002313.0601,479,21,2,0)
Claimed Submitted (480-H9).  NCPDP standard field 479-H8.
"^DD",9002313.02,9002313.0601,479,23,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0601,479,23,1,0)
REQUEST PRICING SEGMENT.
"^DD",9002313.02,9002313.0601,479,"DT")
3080104
"^DD",9002313.02,9002313.0601,480,0)
OTHER AMOUNT SUBTOTAL^F^^0;3^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.0601,480,3)
Answer must be 10 characters in length
"^DD",9002313.02,9002313.0601,480,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.0601,480,21,1,0)
Amount representing the additional incurred costs for a dispensed 
"^DD",9002313.02,9002313.0601,480,21,2,0)
prescription or service.  NCPDP standard field 480-H9.
"^DD",9002313.02,9002313.0601,480,23,0)
^^8^8^3080104^
"^DD",9002313.02,9002313.0601,480,23,1,0)
Format=s$$$$$$cc
"^DD",9002313.02,9002313.0601,480,23,2,0)
 
"^DD",9002313.02,9002313.0601,480,23,3,0)
Qualified by Other Amount Claimed Submitted Qualifier (479-H8).
"^DD",9002313.02,9002313.0601,480,23,4,0)
 
"^DD",9002313.02,9002313.0601,480,23,5,0)
Examples: If the other amount claimed submitted is $12.55, this field 
"^DD",9002313.02,9002313.0601,480,23,6,0)
would reflect: 125E.
"^DD",9002313.02,9002313.0601,480,23,7,0)
 
"^DD",9002313.02,9002313.0601,480,23,8,0)
REQUEST PRICING SEGMENT.
"^DD",9002313.02,9002313.0601,480,"DT")
3080104
"^DD",9002313.02,9002313.0701,0)
CLINICAL DIAGNOSIS SUB-FIELD^^492^3
"^DD",9002313.02,9002313.0701,0,"DT")
3080104
"^DD",9002313.02,9002313.0701,0,"IX","B",9002313.0701,.01)

"^DD",9002313.02,9002313.0701,0,"NM","CLINICAL DIAGNOSIS")

"^DD",9002313.02,9002313.0701,0,"UP")
9002313.0201
"^DD",9002313.02,9002313.0701,.01,0)
DIAGNOSIS COUNTER^F^^0;1^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.0701,.01,1,0)
^.1
"^DD",9002313.02,9002313.0701,.01,1,1,0)
9002313.0701^B
"^DD",9002313.02,9002313.0701,.01,1,1,1)
S ^BPSC(DA(2),400,DA(1),491.01,"B",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.0701,.01,1,1,2)
K ^BPSC(DA(2),400,DA(1),491.01,"B",$E(X,1,30),DA)
"^DD",9002313.02,9002313.0701,.01,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.0701,.01,21,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0701,.01,21,1,0)
The number of diagnosis codes defined for this medication order.
"^DD",9002313.02,9002313.0701,.01,"DT")
3080104
"^DD",9002313.02,9002313.0701,424,0)
DIAGNOSIS CODE^F^^0;3^K:$L(X)>17!($L(X)<17) X
"^DD",9002313.02,9002313.0701,424,3)
Answer must be 17 characters in length
"^DD",9002313.02,9002313.0701,424,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.0701,424,21,1,0)
Code identifying the diagnosis of the patient.  NCPDP standard field
"^DD",9002313.02,9002313.0701,424,21,2,0)
424-DO.
"^DD",9002313.02,9002313.0701,424,23,0)
^^3^3^3080104^
"^DD",9002313.02,9002313.0701,424,23,1,0)
Qualified by a  Diagnosis Code Qualifier  (492-WE). The format must 
"^DD",9002313.02,9002313.0701,424,23,2,0)
adhere to the owner's code set rules and formats.
"^DD",9002313.02,9002313.0701,424,23,3,0)
REQUEST CLINICAL SEGMENT.
"^DD",9002313.02,9002313.0701,424,"DT")
3080104
"^DD",9002313.02,9002313.0701,492,0)
DIAGNOSIS CODE QUALIFIER^F^^0;2^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.0701,492,3)
Answer must be 4 characters in length
"^DD",9002313.02,9002313.0701,492,21,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0701,492,21,1,0)
Code qualifying the Diagnosis Code (424-DO).  NCPDP standard field 492-WE.
"^DD",9002313.02,9002313.0701,492,23,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0701,492,23,1,0)
REQUEST CLINICAL SEGMENT.
"^DD",9002313.02,9002313.0701,492,"DT")
3080104
"^DD",9002313.02,9002313.0801,0)
CLINICAL INFORMATION SUB-FIELD^^499^6
"^DD",9002313.02,9002313.0801,0,"DT")
3080104
"^DD",9002313.02,9002313.0801,0,"IX","B",9002313.0801,.01)

"^DD",9002313.02,9002313.0801,0,"NM","CLINICAL INFORMATION")

"^DD",9002313.02,9002313.0801,0,"UP")
9002313.0201
"^DD",9002313.02,9002313.0801,.01,0)
CLINICAL INFORMATION COUNT^F^^0;1^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.02,9002313.0801,.01,1,0)
^.1
"^DD",9002313.02,9002313.0801,.01,1,1,0)
9002313.0801^B
"^DD",9002313.02,9002313.0801,.01,1,1,1)
S ^BPSC(DA(2),400,DA(1),493.01,"B",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.0801,.01,1,1,2)
K ^BPSC(DA(2),400,DA(1),493.01,"B",$E(X,1,30),DA)
"^DD",9002313.02,9002313.0801,.01,3)
Answer must be 1 character in length.
"^DD",9002313.02,9002313.0801,.01,21,0)
^^1^1^3040126^
"^DD",9002313.02,9002313.0801,.01,21,1,0)
The number of clinical indicator records for the medication order.
"^DD",9002313.02,9002313.0801,.01,"DT")
3080104
"^DD",9002313.02,9002313.0801,494,0)
MEASUREMENT DATE^F^^0;2^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.0801,494,3)
Answer must be 10 characters in length
"^DD",9002313.02,9002313.0801,494,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.0801,494,21,1,0)
Date clinical information was collected or measured.  NCPDP standard 
"^DD",9002313.02,9002313.0801,494,21,2,0)
field 494-ZE.
"^DD",9002313.02,9002313.0801,494,23,0)
^^8^8^3080104^
"^DD",9002313.02,9002313.0801,494,23,1,0)
Format=CCYYMMDD
"^DD",9002313.02,9002313.0801,494,23,2,0)
 
"^DD",9002313.02,9002313.0801,494,23,3,0)
CC=Century
"^DD",9002313.02,9002313.0801,494,23,4,0)
YY=Year
"^DD",9002313.02,9002313.0801,494,23,5,0)
MM=Month
"^DD",9002313.02,9002313.0801,494,23,6,0)
DD=Day
"^DD",9002313.02,9002313.0801,494,23,7,0)
 
"^DD",9002313.02,9002313.0801,494,23,8,0)
REQUEST CLINICAL SEGMENT.
"^DD",9002313.02,9002313.0801,494,"DT")
3080104
"^DD",9002313.02,9002313.0801,495,0)
MEASUREMENT TIME^F^^0;3^K:$L(X)>6!($L(X)<6) X
"^DD",9002313.02,9002313.0801,495,3)
Answer must be 6 characters in length
"^DD",9002313.02,9002313.0801,495,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.0801,495,21,1,0)
Time clinical information was collected or measured.  NCPDP standard 
"^DD",9002313.02,9002313.0801,495,21,2,0)
field 495-H1.
"^DD",9002313.02,9002313.0801,495,23,0)
^^8^8^3080104^
"^DD",9002313.02,9002313.0801,495,23,1,0)
Format: HHMM
"^DD",9002313.02,9002313.0801,495,23,2,0)
 
"^DD",9002313.02,9002313.0801,495,23,3,0)
HH=Hour
"^DD",9002313.02,9002313.0801,495,23,4,0)
MM=Minute
"^DD",9002313.02,9002313.0801,495,23,5,0)
 
"^DD",9002313.02,9002313.0801,495,23,6,0)
Examples: Reported in military time. Two o'clock P.M.=1400.
"^DD",9002313.02,9002313.0801,495,23,7,0)
 
"^DD",9002313.02,9002313.0801,495,23,8,0)
REQUEST CLINICAL SEGMENT.
"^DD",9002313.02,9002313.0801,495,"DT")
3080104
"^DD",9002313.02,9002313.0801,496,0)
MEASUREMENT DIMENSION^F^^0;4^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.0801,496,3)
Answer must be 4 characters in length
"^DD",9002313.02,9002313.0801,496,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.0801,496,21,1,0)
Code indicating the clinical domain of the observed value in Measurement
"^DD",9002313.02,9002313.0801,496,21,2,0)
Value (499-H4).  NCPDP standard field 496-H2.
"^DD",9002313.02,9002313.0801,496,23,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0801,496,23,1,0)
REQUEST CLINICAL SEGMENT.
"^DD",9002313.02,9002313.0801,496,"DT")
3080104
"^DD",9002313.02,9002313.0801,497,0)
MEASUREMENT UNIT^F^^0;5^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.0801,497,3)
Answer must be 4 characters in length
"^DD",9002313.02,9002313.0801,497,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.0801,497,21,1,0)
Code indicating the metric or English units used with the clinical
"^DD",9002313.02,9002313.0801,497,21,2,0)
information.  NCPDP standard field 497-H3.
"^DD",9002313.02,9002313.0801,497,23,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0801,497,23,1,0)
REQUEST CLINICAL SEGMENT.
"^DD",9002313.02,9002313.0801,497,"DT")
3080104
"^DD",9002313.02,9002313.0801,499,0)
MEASUREMENT VALUE^F^^0;6^K:$L(X)>17!($L(X)<17) X
"^DD",9002313.02,9002313.0801,499,3)
Answer must be 17 characters in length
"^DD",9002313.02,9002313.0801,499,21,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.0801,499,21,1,0)
Actual value of clinical information.  NCPDP standard field 499-H4.
"^DD",9002313.02,9002313.0801,499,23,0)
^^4^4^3080104^
"^DD",9002313.02,9002313.0801,499,23,1,0)
Blood pressure entered in XXX/YYY format in which XXX=systolic, 
"^DD",9002313.02,9002313.0801,499,23,2,0)
/=divider, and YYY is diastolic. Temperature entered in XXX.X format 
"^DD",9002313.02,9002313.0801,499,23,3,0)
always including decimal point.
"^DD",9002313.02,9002313.0801,499,23,4,0)
REQUEST CLINICAL SEGMENT.
"^DD",9002313.02,9002313.0801,499,"DT")
3080104
"^DD",9002313.02,9002313.0901,0)
PRIOR AUTH SUPPORTING INFO SUB-FIELD^^.01^1
"^DD",9002313.02,9002313.0901,0,"DT")
3020801
"^DD",9002313.02,9002313.0901,0,"NM","PRIOR AUTH SUPPORTING INFO")

"^DD",9002313.02,9002313.0901,0,"UP")
9002313.0201
"^DD",9002313.02,9002313.0901,.01,0)
PRIOR AUTH SUPPORTING INFO^WL^^0;1^Q
"^DD",9002313.02,9002313.0901,.01,3)
Enter free text any prior authorization supporting information.
"^DD",9002313.02,9002313.0901,.01,23,0)
^^4^4^3080604^
"^DD",9002313.02,9002313.0901,.01,23,1,0)
Could be used, if applicable, to supply information not already included 
"^DD",9002313.02,9002313.0901,.01,23,2,0)
in NCPDP data fields that may be required to process a prior 
"^DD",9002313.02,9002313.0901,.01,23,3,0)
authorization transaction.
"^DD",9002313.02,9002313.0901,.01,23,4,0)
REQUEST PRIOR AUTHORIZATION SEGMENT.
"^DD",9002313.02,9002313.0901,.01,"DT")
3080613
"^DD",9002313.02,9002313.1001,0)
DUR PPS REPEATING FIELDS SUB-FIELD^^476^7
"^DD",9002313.02,9002313.1001,0,"DT")
3080102
"^DD",9002313.02,9002313.1001,0,"IX","B",9002313.1001,.01)

"^DD",9002313.02,9002313.1001,0,"NM","DUR PPS REPEATING FIELDS")

"^DD",9002313.02,9002313.1001,0,"UP")
9002313.0201
"^DD",9002313.02,9002313.1001,.01,0)
DUR PPS CODE COUNT^F^^0;1^K:$L(X)>3!($L(X)<3) X
"^DD",9002313.02,9002313.1001,.01,1,0)
^.1
"^DD",9002313.02,9002313.1001,.01,1,1,0)
9002313.1001^B
"^DD",9002313.02,9002313.1001,.01,1,1,1)
S ^BPSC(DA(2),400,DA(1),473.01,"B",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.1001,.01,1,1,2)
K ^BPSC(DA(2),400,DA(1),473.01,"B",$E(X,1,30),DA)
"^DD",9002313.02,9002313.1001,.01,3)
Answer must be 3 characters in length
"^DD",9002313.02,9002313.1001,.01,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.1001,.01,21,1,0)
The number of DUR messages that were returned in the response message.  
"^DD",9002313.02,9002313.1001,.01,21,2,0)
NCPDP standard field 473-7E.
"^DD",9002313.02,9002313.1001,.01,23,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.1001,.01,23,1,0)
REQUEST DUR/PPS SEGMENT.
"^DD",9002313.02,9002313.1001,.01,"DT")
3080104
"^DD",9002313.02,9002313.1001,439,0)
REASON FOR SERVICE CODE^F^^0;2^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.1001,439,3)
Answer must be 4 characters in length
"^DD",9002313.02,9002313.1001,439,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.1001,439,21,1,0)
Code identifying the type of utilization conflict detected or the reason
"^DD",9002313.02,9002313.1001,439,21,2,0)
for the pharmacist's professional service.  NCPDP standard field 439-E4.
"^DD",9002313.02,9002313.1001,439,23,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.1001,439,23,1,0)
REQUEST DUR/PPS SEGMENT.
"^DD",9002313.02,9002313.1001,439,23,2,0)
RESPONSE DUR/PPS SEGMENT.
"^DD",9002313.02,9002313.1001,439,"DT")
3080104
"^DD",9002313.02,9002313.1001,440,0)
PROFESSIONAL SERVICE CODE^F^^0;3^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.1001,440,3)
Answer must be 4 characters in length
"^DD",9002313.02,9002313.1001,440,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.1001,440,21,1,0)
Code identifying the type of utilization conflict detected or the reason
"^DD",9002313.02,9002313.1001,440,21,2,0)
for the pharmacist's professional service.  NCPDP standard field 440-E5.
"^DD",9002313.02,9002313.1001,440,23,0)
^^3^3^3080104^
"^DD",9002313.02,9002313.1001,440,23,1,0)
If the pharmacist spoke with the patient as a result of a conflict code 
"^DD",9002313.02,9002313.1001,440,23,2,0)
being transmitted on a prescription, the field would reflect P0.
"^DD",9002313.02,9002313.1001,440,23,3,0)
REQUEST DUR/PPS SEGMENT.
"^DD",9002313.02,9002313.1001,440,"DT")
3080104
"^DD",9002313.02,9002313.1001,441,0)
RESULT OF SERVICE CODE^F^^0;4^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.1001,441,3)
Answer must be 4 characters in length
"^DD",9002313.02,9002313.1001,441,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.1001,441,21,1,0)
Action taken by a pharmacist in response to a conflict or the result of a
"^DD",9002313.02,9002313.1001,441,21,2,0)
pharmacist's professional service.  NCPDP standard field 441-E6.
"^DD",9002313.02,9002313.1001,441,23,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.1001,441,23,1,0)
REQUEST DUR/PPS SEGMENT.
"^DD",9002313.02,9002313.1001,441,"DT")
3080104
"^DD",9002313.02,9002313.1001,474,0)
DUR PPS LEVEL OF EFFORT^F^^0;5^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.1001,474,3)
Answer must be 4 characters in length
"^DD",9002313.02,9002313.1001,474,21,0)
^^3^3^3080104^
"^DD",9002313.02,9002313.1001,474,21,1,0)
Code indicating the level of effort as determined by the complexity of
"^DD",9002313.02,9002313.1001,474,21,2,0)
decision making or resources utilized by a pharmacist to perform a
"^DD",9002313.02,9002313.1001,474,21,3,0)
professional service.  NCPDP standard field 474-8E.
"^DD",9002313.02,9002313.1001,474,23,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.1001,474,23,1,0)
REQUEST DUR/PPS SEGMENT.
"^DD",9002313.02,9002313.1001,474,"DT")
3080104
"^DD",9002313.02,9002313.1001,475,0)
DUR COAGENT ID QUALIFIER^F^^0;6^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.1001,475,3)
Answer must be 4 characters in length
"^DD",9002313.02,9002313.1001,475,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.1001,475,21,1,0)
Code qualifying the value in DUR Co-Agent ID (476-H6).  NCPDP standard 
"^DD",9002313.02,9002313.1001,475,21,2,0)
field 475-J9.
"^DD",9002313.02,9002313.1001,475,23,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.1001,475,23,1,0)
REQUEST DUR/PPS SEGMENT.
"^DD",9002313.02,9002313.1001,475,"DT")
3080104
"^DD",9002313.02,9002313.1001,476,0)
DUR COAGENT ID^F^^0;7^K:$L(X)>21!($L(X)<21) X
"^DD",9002313.02,9002313.1001,476,3)
Answer must be 21 characters in length
"^DD",9002313.02,9002313.1001,476,21,0)
^^3^3^3080104^
"^DD",9002313.02,9002313.1001,476,21,1,0)
Identifies the co-existing agent contributing to the DUR event (drug or
"^DD",9002313.02,9002313.1001,476,21,2,0)
disease conflicting with the prescribed drug or prompting pharmacist
"^DD",9002313.02,9002313.1001,476,21,3,0)
professional service).  NCPDP standard field 476-H6.
"^DD",9002313.02,9002313.1001,476,23,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.1001,476,23,1,0)
Qualified by DUR Co-Agent ID Qualifier (475-J9).
"^DD",9002313.02,9002313.1001,476,23,2,0)
REQUEST DUR/PPS SEGMENT.
"^DD",9002313.02,9002313.1001,476,"DT")
3080104
"^DD",9002313.02,9002313.201459,0)
PROCEDURE MODIFIER CODE SUB-FIELD^^.01^1
"^DD",9002313.02,9002313.201459,0,"DT")
3080104
"^DD",9002313.02,9002313.201459,0,"IX","B",9002313.201459,.01)

"^DD",9002313.02,9002313.201459,0,"NM","PROCEDURE MODIFIER CODE")

"^DD",9002313.02,9002313.201459,0,"UP")
9002313.0201
"^DD",9002313.02,9002313.201459,.01,0)
PROCEDURE MODIFIER CODE^F^^0;1^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.201459,.01,1,0)
^.1
"^DD",9002313.02,9002313.201459,.01,1,1,0)
9002313.201459^B
"^DD",9002313.02,9002313.201459,.01,1,1,1)
S ^BPSC(DA(2),400,DA(1),459,"B",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.201459,.01,1,1,2)
K ^BPSC(DA(2),400,DA(1),459,"B",$E(X,1,30),DA)
"^DD",9002313.02,9002313.201459,.01,3)
Answer must be 4 characters in length
"^DD",9002313.02,9002313.201459,.01,21,0)
^^2^2^3080104^
"^DD",9002313.02,9002313.201459,.01,21,1,0)
Identifies special circumstances related to the performance of the 
"^DD",9002313.02,9002313.201459,.01,21,2,0)
service.  NCPDP standard field 459-ER.
"^DD",9002313.02,9002313.201459,.01,23,0)
^^1^1^3080104^
"^DD",9002313.02,9002313.201459,.01,23,1,0)
REQUEST CLAIM SEGMENT.
"^DD",9002313.02,9002313.201459,.01,"DT")
3080104
"^DD",9002313.02,9002313.29999,0)
RAW DATA SENT SUB-FIELD^^.01^1
"^DD",9002313.02,9002313.29999,0,"DT")
3000830
"^DD",9002313.02,9002313.29999,0,"NM","RAW DATA SENT")

"^DD",9002313.02,9002313.29999,0,"UP")
9002313.02
"^DD",9002313.02,9002313.29999,.01,0)
RAW DATA SENT^WL^^0;1^Q
"^DD",9002313.02,9002313.29999,.01,21,0)
^^4^4^3031124^^
"^DD",9002313.02,9002313.29999,.01,21,1,0)
A copy of the raw packet is saved here.
"^DD",9002313.02,9002313.29999,.01,21,2,0)
It's intended to be of help in times of dispute.
"^DD",9002313.02,9002313.29999,.01,21,3,0)
This field could be winnowed before the rest of the 9002313.02 is winnowed.
"^DD",9002313.02,9002313.29999,.01,21,4,0)
For instance, it might make sense to only keep a month of these around.
"^DD",9002313.02,9002313.29999,.01,"DT")
3031124
"^DD",9002313.02,9002313.401342,0)
OTHER PAYER AMT PAID QUALIFIER SUB-FIELD^^431^2
"^DD",9002313.02,9002313.401342,0,"DT")
3080103
"^DD",9002313.02,9002313.401342,0,"IX","B",9002313.401342,.01)

"^DD",9002313.02,9002313.401342,0,"NM","OTHER PAYER AMT PAID QUALIFIER")

"^DD",9002313.02,9002313.401342,0,"UP")
9002313.0401
"^DD",9002313.02,9002313.401342,.01,0)
OTHER PAYER AMT PAID QUALIFIER^F^^0;1^K:$L(X)>4!($L(X)<4) X
"^DD",9002313.02,9002313.401342,.01,1,0)
^.1
"^DD",9002313.02,9002313.401342,.01,1,1,0)
9002313.401342^B
"^DD",9002313.02,9002313.401342,.01,1,1,1)
S ^BPSC(DA(3),400,DA(2),337,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.401342,.01,1,1,2)
K ^BPSC(DA(3),400,DA(2),337,DA(1),1,"B",$E(X,1,30),DA)
"^DD",9002313.02,9002313.401342,.01,3)
Answer must be 4 characters in length
"^DD",9002313.02,9002313.401342,.01,21,0)
^^2^2^3080604^
"^DD",9002313.02,9002313.401342,.01,21,1,0)
Code qualifying the Other Payer Amount Paid (431-DV).  NCPDP standard 
"^DD",9002313.02,9002313.401342,.01,21,2,0)
field 342-HC.
"^DD",9002313.02,9002313.401342,.01,23,0)
^^1^1^3080604^^
"^DD",9002313.02,9002313.401342,.01,23,1,0)
REQUEST COORDINATION OF BENEFITS/OTHER PAYMENT SEGMENT.
"^DD",9002313.02,9002313.401342,.01,"DT")
3080604
"^DD",9002313.02,9002313.401342,431,0)
OTHER PAYER AMOUNT PAID^F^^0;2^K:$L(X)>10!($L(X)<10) X
"^DD",9002313.02,9002313.401342,431,3)
Answer must be 10 characters in length
"^DD",9002313.02,9002313.401342,431,21,0)
^^2^2^3080103^
"^DD",9002313.02,9002313.401342,431,21,1,0)
Amount of any payment known by the pharmacy from other sources (including 
"^DD",9002313.02,9002313.401342,431,21,2,0)
coupons).  NCPDP standard field 431-DV.
"^DD",9002313.02,9002313.401342,431,23,0)
^^6^6^3080103^
"^DD",9002313.02,9002313.401342,431,23,1,0)
Format=s$$$$$$cc
"^DD",9002313.02,9002313.401342,431,23,2,0)
 
"^DD",9002313.02,9002313.401342,431,23,3,0)
Examples: If the other payer amount paid is $32.56, this field would 
"^DD",9002313.02,9002313.401342,431,23,4,0)
reflect: 325F.
"^DD",9002313.02,9002313.401342,431,23,5,0)
 
"^DD",9002313.02,9002313.401342,431,23,6,0)
REQUEST COORDINATION OF BENEFITS/OTHER PAYMENT SEGMENT.
"^DD",9002313.02,9002313.401342,431,"DT")
3080103
"^DD",9002313.02,9002313.401472,0)
OTHER PAYER REJECT CODE SUB-FIELD^^.01^1
"^DD",9002313.02,9002313.401472,0,"DT")
3080103
"^DD",9002313.02,9002313.401472,0,"IX","B",9002313.401472,.01)

"^DD",9002313.02,9002313.401472,0,"NM","OTHER PAYER REJECT CODE")

"^DD",9002313.02,9002313.401472,0,"UP")
9002313.0401
"^DD",9002313.02,9002313.401472,.01,0)
OTHER PAYER REJECT CODE^F^^0;1^K:$L(X)>5!($L(X)<5) X
"^DD",9002313.02,9002313.401472,.01,1,0)
^.1
"^DD",9002313.02,9002313.401472,.01,1,1,0)
9002313.401472^B
"^DD",9002313.02,9002313.401472,.01,1,1,1)
S ^BPSC(DA(3),400,DA(2),337,DA(1),2,"B",$E(X,1,30),DA)=""
"^DD",9002313.02,9002313.401472,.01,1,1,2)
K ^BPSC(DA(3),400,DA(2),337,DA(1),2,"B",$E(X,1,30),DA)
"^DD",9002313.02,9002313.401472,.01,3)
Answer must be 5 characters in length
"^DD",9002313.02,9002313.401472,.01,21,0)
^^2^2^3080103^
"^DD",9002313.02,9002313.401472,.01,21,1,0)
The error encountered by the previous "Other Payer" in Reject Code  
"^DD",9002313.02,9002313.401472,.01,21,2,0)
(511-FB).  NCPDP standard field 472-6E.
"^DD",9002313.02,9002313.401472,.01,23,0)
^^1^1^3080103^
"^DD",9002313.02,9002313.401472,.01,23,1,0)
REQUEST COORDINATION OF BENEFITS/OTHER PAYMENT SEGMENT.
"^DD",9002313.02,9002313.401472,.01,"DT")
3080103
"^DD",9002313.03,9002313.03,0)
FIELD^^9999^17
"^DD",9002313.03,9002313.03,0,"DDA")
N
"^DD",9002313.03,9002313.03,0,"DT")
3080618
"^DD",9002313.03,9002313.03,0,"IX","AC",9002313.0301,501)

"^DD",9002313.03,9002313.03,0,"IX","AE",9002313.03,.02)

"^DD",9002313.03,9002313.03,0,"IX","B",9002313.03,.01)

"^DD",9002313.03,9002313.03,0,"NM","BPS RESPONSES")

"^DD",9002313.03,9002313.03,0,"PT",9002313.57,4)

"^DD",9002313.03,9002313.03,0,"PT",9002313.57,402)

"^DD",9002313.03,9002313.03,0,"PT",9002313.59,4)

"^DD",9002313.03,9002313.03,0,"PT",9002313.59,402)

"^DD",9002313.03,9002313.03,0,"VRPK")
BPS
"^DD",9002313.03,9002313.03,.01,0)
BPS CLAIM^RP9002313.02'^BPSC(^0;1^Q
"^DD",9002313.03,9002313.03,.01,1,0)
^.1
"^DD",9002313.03,9002313.03,.01,1,1,0)
9002313.03^B
"^DD",9002313.03,9002313.03,.01,1,1,1)
S ^BPSR("B",$E(X,1,30),DA)=""
"^DD",9002313.03,9002313.03,.01,1,1,2)
K ^BPSR("B",$E(X,1,30),DA)
"^DD",9002313.03,9002313.03,.01,3)
Select the BPS Claim.
"^DD",9002313.03,9002313.03,.01,21,0)
^^1^1^3080207^
"^DD",9002313.03,9002313.03,.01,21,1,0)
Identifier for BPS responses.
"^DD",9002313.03,9002313.03,.01,"DT")
3080207
"^DD",9002313.03,9002313.03,.02,0)
DATE RESPONSE RECEIVED^D^^0;2^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.03,9002313.03,.02,1,0)
^.1
"^DD",9002313.03,9002313.03,.02,1,1,0)
9002313.03^AE
"^DD",9002313.03,9002313.03,.02,1,1,1)
S ^BPSR("AE",$E(X,1,30),DA)=""
"^DD",9002313.03,9002313.03,.02,1,1,2)
K ^BPSR("AE",$E(X,1,30),DA)
"^DD",9002313.03,9002313.03,.02,1,1,"DT")
2950724
"^DD",9002313.03,9002313.03,.02,3)
Enter the date the Response was received.
"^DD",9002313.03,9002313.03,.02,21,0)
^^1^1^3080207^
"^DD",9002313.03,9002313.03,.02,21,1,0)
Date that response was received on the system.
"^DD",9002313.03,9002313.03,.02,"DT")
3080207
"^DD",9002313.03,9002313.03,102,0)
VERSION RELEASE NUMBER^F^^100;2^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.03,9002313.03,102,3)
Answer must be 2 characters in length.
"^DD",9002313.03,9002313.03,102,21,0)
^^1^1^3080207^
"^DD",9002313.03,9002313.03,102,21,1,0)
NCPDP Version/Release Number.
"^DD",9002313.03,9002313.03,102,"DT")
3080207
"^DD",9002313.03,9002313.03,103,0)
TRANSACTION CODE^F^^100;3^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.03,9002313.03,103,3)
Answer must be 2 characters in length.
"^DD",9002313.03,9002313.03,103,21,0)
^^1^1^3080207^
"^DD",9002313.03,9002313.03,103,21,1,0)
Code identifying the type of transaction.
"^DD",9002313.03,9002313.03,103,"DT")
3080207
"^DD",9002313.03,9002313.03,109,0)
TRANSACTION COUNT^NJ1,0^^100;9^K:+X'=X!(X>4)!(X<1)!(X?.E1"."1.N) X
"^DD",9002313.03,9002313.03,109,3)
Type a number between 1 and 4, 0 Decimal Digits
"^DD",9002313.03,9002313.03,109,21,0)
^^1^1^3080618^
"^DD",9002313.03,9002313.03,109,21,1,0)
Count of transactions in the transmission. 
"^DD",9002313.03,9002313.03,109,"DT")
3080618
"^DD",9002313.03,9002313.03,201,0)
SERVICE PROVIDER ID^F^^200;1^K:$L(X)>15!($L(X)<1) X
"^DD",9002313.03,9002313.03,201,3)
Answer must be 1-15 characters in length.
"^DD",9002313.03,9002313.03,201,21,0)
^^1^1^3080207^
"^DD",9002313.03,9002313.03,201,21,1,0)
ID assigned to a pharmacy or provider.
"^DD",9002313.03,9002313.03,201,"DT")
3080207
"^DD",9002313.03,9002313.03,202,0)
SERVICE PROVIDER ID QUALIFIER^F^^200;2^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.03,9002313.03,202,3)
Answer must be 1-2 characters in length.
"^DD",9002313.03,9002313.03,202,21,0)
^^1^1^3080207^
"^DD",9002313.03,9002313.03,202,21,1,0)
Code qualifying the 'Service Provider ID' (21)
"^DD",9002313.03,9002313.03,202,"DT")
3080207
"^DD",9002313.03,9002313.03,301,0)
GROUP ID^F^^300;1^K:$L(X)>15!($L(X)<1) X
"^DD",9002313.03,9002313.03,301,3)
Answer must be 1-15 characters in length.
"^DD",9002313.03,9002313.03,301,21,0)
^^1^1^3080207^
"^DD",9002313.03,9002313.03,301,21,1,0)
ID assigned to the cardholder group or employer group.
"^DD",9002313.03,9002313.03,301,"DT")
3080207
"^DD",9002313.03,9002313.03,401,0)
DATE OF SERVICE^FO^^400;1^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.03,9002313.03,401,2)
S Y(0)=Y S Y=$$FM3EXT^BPSOSU1(Y)
"^DD",9002313.03,9002313.03,401,2.1)
S Y=$$FM3EXT^BPSOSU1(Y)
"^DD",9002313.03,9002313.03,401,3)
Answer must be 8 characters in length.
"^DD",9002313.03,9002313.03,401,21,0)
^^2^2^3080207^
"^DD",9002313.03,9002313.03,401,21,1,0)
Identifies date the prescription was filled or professional service 
"^DD",9002313.03,9002313.03,401,21,2,0)
rendered.
"^DD",9002313.03,9002313.03,401,"DT")
3080618
"^DD",9002313.03,9002313.03,501,0)
RESPONSE STATUS^S^A:ACCEPTED;R:REJECTED;^500;1^Q
"^DD",9002313.03,9002313.03,501,3)
Enter the status of the response from the payer.
"^DD",9002313.03,9002313.03,501,21,0)
^^1^1^3080617^
"^DD",9002313.03,9002313.03,501,21,1,0)
A code indicating the status of this response.
"^DD",9002313.03,9002313.03,501,"DT")
3080617
"^DD",9002313.03,9002313.03,504,0)
MESSAGE^F^^504;1^K:$L(X)>250!($L(X)<1) X
"^DD",9002313.03,9002313.03,504,3)
Answer must be 1-250 characters in length.
"^DD",9002313.03,9002313.03,504,21,0)
^^1^1^3080207^
"^DD",9002313.03,9002313.03,504,21,1,0)
Free form message.
"^DD",9002313.03,9002313.03,504,"DT")
3080207
"^DD",9002313.03,9002313.03,524,0)
PLAN IDENTIFICATION^F^^500;24^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.03,9002313.03,524,3)
Answer must be 8 characters in length.
"^DD",9002313.03,9002313.03,524,21,0)
^^2^2^3080207^
"^DD",9002313.03,9002313.03,524,21,1,0)
Assigned by the processor to identify a set of parameters, benefit, or 
"^DD",9002313.03,9002313.03,524,21,2,0)
coverage criteria used to adjudicate a claim.
"^DD",9002313.03,9002313.03,524,"DT")
3080207
"^DD",9002313.03,9002313.03,545,0)
NETWORK REIMBURSEMENT ID^F^^540;5^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.03,9002313.03,545,3)
Answer must be 1-10 characters in length.
"^DD",9002313.03,9002313.03,545,21,0)
^^2^2^3080207^
"^DD",9002313.03,9002313.03,545,21,1,0)
Field defined by the processor. It identifies the network, for the covered
"^DD",9002313.03,9002313.03,545,21,2,0)
member, used to calculate the reimbursement to the pharmacy.
"^DD",9002313.03,9002313.03,545,"DT")
3080207
"^DD",9002313.03,9002313.03,568,0)
PAYER ID QUALIFIER^S^01:NATIONAL PAYER ID;02:HCN;03:BIN;04:NAIC;99:OTHER;^560;8^Q
"^DD",9002313.03,9002313.03,568,3)
Enter a code specifying the type of payer ID.
"^DD",9002313.03,9002313.03,568,21,0)
^^1^1^3080618^
"^DD",9002313.03,9002313.03,568,21,1,0)
Code indicating the type of payer ID.
"^DD",9002313.03,9002313.03,568,"DT")
3080618
"^DD",9002313.03,9002313.03,569,0)
PAYER ID^F^^560;9^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.03,9002313.03,569,3)
Answer must be 1-10 characters in length.
"^DD",9002313.03,9002313.03,569,21,0)
^^1^1^3080207^
"^DD",9002313.03,9002313.03,569,21,1,0)
Payer identification - the payer this claim was submitted to.
"^DD",9002313.03,9002313.03,569,"DT")
3080207
"^DD",9002313.03,9002313.03,1000,0)
RESPONSES^9002313.0301A^^1000;0
"^DD",9002313.03,9002313.03,1000,21,0)
^^1^1^3080207^
"^DD",9002313.03,9002313.03,1000,21,1,0)
Text message containing the response to the claim.
"^DD",9002313.03,9002313.03,1000,"DT")
3080207
"^DD",9002313.03,9002313.03,9999,0)
RAW DATA RECEIVED^9002313.39999^^M;0
"^DD",9002313.03,9002313.03,9999,3)
Enter the raw NCPDP data received from the payer.
"^DD",9002313.03,9002313.03,9999,21,0)
^^1^1^3080618^
"^DD",9002313.03,9002313.03,9999,21,1,0)
This is to store the raw data received from the payer.
"^DD",9002313.03,9002313.0301,0)
RESPONSES SUB-FIELD^^1000^54
"^DD",9002313.03,9002313.0301,0,"DT")
3080618
"^DD",9002313.03,9002313.0301,0,"IX","B",9002313.0301,.01)

"^DD",9002313.03,9002313.0301,0,"NM","RESPONSES")

"^DD",9002313.03,9002313.0301,0,"UP")
9002313.03
"^DD",9002313.03,9002313.0301,.01,0)
MEDICATION ORDER^MNJ9,0^^0;1^K:+X'=X!(X>999999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.03,9002313.0301,.01,1,0)
^.1
"^DD",9002313.03,9002313.0301,.01,1,1,0)
9002313.0301^B
"^DD",9002313.03,9002313.0301,.01,1,1,1)
S ^BPSR(DA(1),1000,"B",$E(X,1,30),DA)=""
"^DD",9002313.03,9002313.0301,.01,1,1,2)
K ^BPSR(DA(1),1000,"B",$E(X,1,30),DA)
"^DD",9002313.03,9002313.0301,.01,3)
Type a Number between 1 and 999999999, 0 Decimal Digits
"^DD",9002313.03,9002313.0301,.01,21,0)
^^1^1^3080207^
"^DD",9002313.03,9002313.0301,.01,21,1,0)
Detailing of medications in this claim.
"^DD",9002313.03,9002313.0301,.01,"DT")
3080207
"^DD",9002313.03,9002313.0301,112,0)
TRANSACTION RESPONSE STATUS^S^A:APPROVED;C:CAPTURED;D:DUPLICATE OF PAID;F:PA DEFERRED;P:PAID;Q:DUPLICATE OF CAPTURED;R:REJECTED;S:DUPLICATE OF APPROVED;^110;2^Q
"^DD",9002313.03,9002313.0301,112,3)
Enter the status of this transaction.
"^DD",9002313.03,9002313.0301,112,21,0)
^^1^1^3080207^
"^DD",9002313.03,9002313.0301,112,21,1,0)
Code indicating the status of the transaction.
"^DD",9002313.03,9002313.0301,112,"DT")
3080207
"^DD",9002313.03,9002313.0301,346,0)
BASIS FOR DISPENSING FEE^S^00:NOT SPECIFIED;01:QUANTITY DISPENSED;02:QUANTITY INTENDED TO BE DISP;03:USUAL & CUSTOMARY/PRORATED;04:WAIVED DUE TO PARTIAL FILL;99:OTHER;^340;6^Q
"^DD",9002313.03,9002313.0301,346,3)
Enter the basis for the dispensing fee paid.
"^DD",9002313.03,9002313.0301,346,21,0)
^^2^2^3080207^
"^DD",9002313.03,9002313.0301,346,21,1,0)
Code indicating how the reimbursement amount was calculated for 
"^DD",9002313.03,9002313.0301,346,21,2,0)
'Dispensing Fee Paid' (57).
"^DD",9002313.03,9002313.0301,346,"DT")
3080207
"^DD",9002313.03,9002313.0301,347,0)
BASIS FOR COPAY^S^00:NOT SPECIFIED;01:QUANTITY DISPENSED;02:QUANTITY INTENDED TO BE DISPENSED;03:USUAL & CUSTOMARY/PRORATED;04:WAIVED DO TO PARTIAL FILL;99:OTHER;^340;7^Q
"^DD",9002313.03,9002313.0301,347,3)
Enter the basis for the copayment amount.
"^DD",9002313.03,9002313.0301,347,21,0)
^^2^2^3080207^
"^DD",9002313.03,9002313.0301,347,21,1,0)
Code indicating how the reimbursement amount was calculated for 'Patient 
"^DD",9002313.03,9002313.0301,347,21,2,0)
Pay Amount'(55).
"^DD",9002313.03,9002313.0301,347,"DT")
3080207
"^DD",9002313.03,9002313.0301,348,0)
BASIS FOR FLAT TAX^S^00:NOT SPECIFIED;01:QUANTITY DISPENSED;02:QUANTITY INTENDED TO BE DISPENSED;^340;8^Q
"^DD",9002313.03,9002313.0301,348,3)
Enter the basis for the flat tax paid.
"^DD",9002313.03,9002313.0301,348,21,0)
^^2^2^3080207^
"^DD",9002313.03,9002313.0301,348,21,1,0)
Code indicating how the reimbursement amount was calculated for 'Flat 
"^DD",9002313.03,9002313.0301,348,21,2,0)
Sales Tax Amount Paid' (558).
"^DD",9002313.03,9002313.0301,348,"DT")
3080207
"^DD",9002313.03,9002313.0301,349,0)
BASIS FOR PERCENTAGE TAX^S^00:NOT SPECIFIED;01:QUANTITY DISPENSED;02:QUANTITY INTENDED TO BE DISPENSED;^340;9^Q
"^DD",9002313.03,9002313.0301,349,3)
Enter the basis for the percentage tax paid.
"^DD",9002313.03,9002313.0301,349,21,0)
^^2^2^3080207^
"^DD",9002313.03,9002313.0301,349,21,1,0)
Code indicating how the reimbursement amount was calculated for 
"^DD",9002313.03,9002313.0301,349,21,2,0)
'Percentage Sales Tax Amount Paid' (559).
"^DD",9002313.03,9002313.0301,349,"DT")
3080207
"^DD",9002313.03,9002313.0301,402,0)
PRESCRIPTION REFERENCE NUMBER^F^^400;2^K:$L(X)>7!($L(X)<1) X
"^DD",9002313.03,9002313.0301,402,3)
Answer must be 1-7 characters in length.
"^DD",9002313.03,9002313.0301,402,21,0)
^^2^2^3080207^
"^DD",9002313.03,9002313.0301,402,21,1,0)
Reference number assigned by the provider for the dispensed drug/product 
"^DD",9002313.03,9002313.0301,402,21,2,0)
and/or service provided.
"^DD",9002313.03,9002313.0301,402,"DT")
3080207
"^DD",9002313.03,9002313.0301,455,0)
RX REFERENCE NUMBER QUALIFIER^S^1:RX BILLING;2:SERVICE BILLING;^450;5^Q
"^DD",9002313.03,9002313.0301,455,3)
Answer must be 1 character in length.
"^DD",9002313.03,9002313.0301,455,21,0)
^^1^1^3080207^
"^DD",9002313.03,9002313.0301,455,21,1,0)
Indicates the type of billing submitted.
"^DD",9002313.03,9002313.0301,455,"DT")
3080207
"^DD",9002313.03,9002313.0301,498.14,0)
PRIOR AUTHORIZATION ASSIGNED^F^^498;6^K:$L(X)>11!($L(X)<1) X
"^DD",9002313.03,9002313.0301,498.14,3)
Answer must be 1-11 characters in length.
"^DD",9002313.03,9002313.0301,498.14,21,0)
^^2^2^3080207^
"^DD",9002313.03,9002313.0301,498.14,21,1,0)
Unique number identifying the prior authorization assigned by the 
"^DD",9002313.03,9002313.0301,498.14,21,2,0)
processor.
"^DD",9002313.03,9002313.0301,498.14,"DT")
3080207
"^DD",9002313.03,9002313.0301,498.51,0)
DATE OF PRIOR AUTHORIZATION^FO^^498;1^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.03,9002313.0301,498.51,2)
S Y(0)=Y S Y=$$FM3EXT^BPSOSU1(Y)
"^DD",9002313.03,9002313.0301,498.51,2.1)
S Y=$$FM3EXT^BPSOSU1(Y)
"^DD",9002313.03,9002313.0301,498.51,3)
Answer must be 8 characters in length.
"^DD",9002313.03,9002313.0301,498.51,21,0)
^^1^1^3031124^
"^DD",9002313.03,9002313.0301,498.51,21,1,0)
Date the prior authorization request was processed.
"^DD",9002313.03,9002313.0301,498.51,"DT")
3080618
"^DD",9002313.03,9002313.0301,498.52,0)
PRIOR AUTHORIZATION START^FO^^498;2^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.03,9002313.0301,498.52,2)
S Y(0)=Y S Y=$$FM3EXT^BPSOSU1(Y)
"^DD",9002313.03,9002313.0301,498.52,2.1)
S Y=$$FM3EXT^BPSOSU1(Y)
"^DD",9002313.03,9002313.0301,498.52,3)
Answer must be 8 characters in length.
"^DD",9002313.03,9002313.0301,498.52,21,0)
^^1^1^3080207^
"^DD",9002313.03,9002313.0301,498.52,21,1,0)
Date the prior authorization became effective.
"^DD",9002313.03,9002313.0301,498.52,"DT")
3080618
"^DD",9002313.03,9002313.0301,498.53,0)
PRIOR AUTHORIZATION END^FO^^498;3^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.03,9002313.0301,498.53,2)
S Y(0)=Y S Y=$$FM3EXT^BPSOSU1(Y)
"^DD",9002313.03,9002313.0301,498.53,2.1)
S Y=$$FM3EXT^BPSOSU1(Y)
"^DD",9002313.03,9002313.0301,498.53,3)
Answer must be 8 characters in length.
"^DD",9002313.03,9002313.0301,498.53,21,0)
^^1^1^3080207^
"^DD",9002313.03,9002313.0301,498.53,21,1,0)
Date the prior authorization expires.
"^DD",9002313.03,9002313.0301,498.53,"DT")
3080618
"^DD",9002313.03,9002313.0301,498.54,0)
PRIOR AUTHORIZED REFILLS^NJ2,0^^498;4^K:+X'=X!(X>99)!(X<0)!(X?.E1"."1.N) X
"^DD",9002313.03,9002313.0301,498.54,3)
Type a number between 0 and 99, 0 Decimal Digits
"^DD",9002313.03,9002313.0301,498.54,21,0)
^^1^1^3080618^
"^DD",9002313.03,9002313.0301,498.54,21,1,0)
Number of refills authorized by the prior authorization
"^DD",9002313.03,9002313.0301,498.54,"DT")
3080618
"^DD",9002313.03,9002313.0301,498.55,0)
PRIOR AUTH ACCUMULATED QTY^F^^498;5^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.03,9002313.0301,498.55,3)
Answer must be 1-10 characters in length.
"^DD",9002313.03,9002313.0301,498.55,21,0)
^^1^1^3080207^
"^DD",9002313.03,9002313.0301,498.55,21,1,0)
Accumulated authorized amount expressed in metric decimal units.
"^DD",9002313.03,9002313.0301,498.55,"DT")
3080207
"^DD",9002313.03,9002313.0301,498.57,0)
PRIOR AUTHORIZED QUANTITY^F^^498;7^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.03,9002313.0301,498.57,3)
Answer must be 1-10 characters in length.
"^DD",9002313.03,9002313.0301,498.57,21,0)
^^1^1^3080207^
"^DD",9002313.03,9002313.0301,498.57,21,1,0)
Amount authorized expressed in metric decimal units.
"^DD",9002313.03,9002313.0301,498.57,"DT")
3080207
"^DD",9002313.03,9002313.0301,498.58,0)
PRIOR AUTHORIZATION AMOUNT^F^^498;8^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.03,9002313.0301,498.58,3)
Answer must be 8 characters in length.
"^DD",9002313.03,9002313.0301,498.58,21,0)
^^1^1^3080207^
"^DD",9002313.03,9002313.0301,498.58,21,1,0)
Amount authorized in the prior authorization.
"^DD",9002313.03,9002313.0301,498.58,"DT")
3080207
"^DD",9002313.03,9002313.0301,501,0)
PRESCRIPTION RESPONSE STATUS^S^A:ACCEPTED;R:REJECTED CLAIM;P:CLAIM PAYABLE;C:CLAIM CAPTURED;D:DUPLICATE CLAIM;DP:DUPLICATE OF PAYABLE CLAIM;DC:DUPLICATE OF CAPTURED CLAIM;^500;1^Q
"^DD",9002313.03,9002313.0301,501,1,0)
^.1
"^DD",9002313.03,9002313.0301,501,1,1,0)
9002313.03^AC
"^DD",9002313.03,9002313.0301,501,1,1,1)
S ^BPSR("AC",$E(X,1,30),DA(1),DA)=""
"^DD",9002313.03,9002313.0301,501,1,1,2)
K ^BPSR("AC",$E(X,1,30),DA(1),DA)
"^DD",9002313.03,9002313.0301,501,1,1,"DT")
2950622
"^DD",9002313.03,9002313.0301,501,3)
Enter the status of the response.
"^DD",9002313.03,9002313.0301,501,21,0)
^^1^1^3080207^
"^DD",9002313.03,9002313.0301,501,21,1,0)
Status of the response from the payer.
"^DD",9002313.03,9002313.0301,501,"DT")
3080207
"^DD",9002313.03,9002313.0301,503,0)
AUTHORIZATION NUMBER^F^^500;3^K:$L(X)>20!($L(X)<14) X
"^DD",9002313.03,9002313.0301,503,3)
Answer must be 14-20 characters in length.
"^DD",9002313.03,9002313.0301,503,21,0)
^^1^1^3080207^
"^DD",9002313.03,9002313.0301,503,21,1,0)
Number assigned by the processor to identify an authorized transaction.
"^DD",9002313.03,9002313.0301,503,"DT")
3080207
"^DD",9002313.03,9002313.0301,504,0)
MESSAGE^F^^504;1^K:$L(X)>250!($L(X)<1) X
"^DD",9002313.03,9002313.0301,504,3)
Answer must be 1-250 characters in length.
"^DD",9002313.03,9002313.0301,504,21,0)
^^1^1^3080207^
"^DD",9002313.03,9002313.0301,504,21,1,0)
Free text message from payer.
"^DD",9002313.03,9002313.0301,504,"DT")
3080207
"^DD",9002313.03,9002313.0301,505,0)
PATIENT PAY AMOUNT^FO^^500;5^K:$L(X)>8!($L(X)<6) X
"^DD",9002313.03,9002313.0301,505,2)
S Y(0)=Y S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,505,2.1)
S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,505,3)
Answer must be 6-8 characters in length.
"^DD",9002313.03,9002313.0301,505,21,0)
^^4^4^3080207^
"^DD",9002313.03,9002313.0301,505,21,1,0)
Amount that is calculated by the processor and returned to the pharmacy as
"^DD",9002313.03,9002313.0301,505,21,2,0)
the TOTAL amount to be paid by the patient to the pharmacy; the patient's
"^DD",9002313.03,9002313.0301,505,21,3,0)
total cost share, including co-payments, amounts applied to deductible,
"^DD",9002313.03,9002313.0301,505,21,4,0)
over maximum amounts, penalties, etc.
"^DD",9002313.03,9002313.0301,505,"DT")
3080207
"^DD",9002313.03,9002313.0301,506,0)
INGREDIENT COST PAID^FO^^500;6^K:$L(X)>8!($L(X)<6) X
"^DD",9002313.03,9002313.0301,506,2)
S Y(0)=Y S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,506,2.1)
S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,506,3)
Answer must be 6-8 characters in length.
"^DD",9002313.03,9002313.0301,506,21,0)
^^1^1^3080207^
"^DD",9002313.03,9002313.0301,506,21,1,0)
Drug ingredient cost paid included in the 'Total Amount Paid' (59).
"^DD",9002313.03,9002313.0301,506,"DT")
3080207
"^DD",9002313.03,9002313.0301,507,0)
DISPENSING FEE PAID^FO^^500;7^K:$L(X)>8!($L(X)<6) X
"^DD",9002313.03,9002313.0301,507,2)
S Y(0)=Y S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,507,2.1)
S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,507,3)
Answer must be 6-8 characters in length.
"^DD",9002313.03,9002313.0301,507,21,0)
^^1^1^3080207^
"^DD",9002313.03,9002313.0301,507,21,1,0)
Dispensing fee paid included in the 'Total Amount Paid' (59).
"^DD",9002313.03,9002313.0301,507,"DT")
3080207
"^DD",9002313.03,9002313.0301,509,0)
TOTAL AMOUNT PAID^FO^^500;9^K:$L(X)>8!($L(X)<6) X
"^DD",9002313.03,9002313.0301,509,2)
S Y(0)=Y S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,509,2.1)
S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,509,3)
Answer must be 6-8 characters in length.
"^DD",9002313.03,9002313.0301,509,21,0)
^^6^6^3080207^
"^DD",9002313.03,9002313.0301,509,21,1,0)
Total amount to be paid by the claims processor (i.e. pharmacy 
"^DD",9002313.03,9002313.0301,509,21,2,0)
receivable). Represents a sum of 'Ingredient Cost Paid' (56), 'Dispensing
"^DD",9002313.03,9002313.0301,509,21,3,0)
Fee Paid' (57), 'Flat Sales Tax Amount Paid' (558), 'Percentage Sales Tax
"^DD",9002313.03,9002313.0301,509,21,4,0)
Amount Paid' (559), 'Incentive Amount Paid' (521), 'Professional Service
"^DD",9002313.03,9002313.0301,509,21,5,0)
Fee Paid' (562), 'Other Amount Paid' (565), less 'Patient Pay Amount'
"^DD",9002313.03,9002313.0301,509,21,6,0)
(55) and 'Other Payer Amount Recognized' (566).
"^DD",9002313.03,9002313.0301,509,"DT")
3080207
"^DD",9002313.03,9002313.0301,510,0)
REJECT COUNT^F^^500;10^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.03,9002313.0301,510,3)
Answer must be 2 characters in length.
"^DD",9002313.03,9002313.0301,510,21,0)
^^1^1^3080207^
"^DD",9002313.03,9002313.0301,510,21,1,0)
Count of 'Reject Code' (511) occurrences.
"^DD",9002313.03,9002313.0301,510,"DT")
3080207
"^DD",9002313.03,9002313.0301,511,0)
REJECT CODE^9002313.03511A^^511;0
"^DD",9002313.03,9002313.0301,511,3)
Select a NCPDP reject code
"^DD",9002313.03,9002313.0301,511,21,0)
^^1^1^3080207^
"^DD",9002313.03,9002313.0301,511,21,1,0)
Multiple rejection codes.
"^DD",9002313.03,9002313.0301,511,"DT")
3080207
"^DD",9002313.03,9002313.0301,512,0)
ACCUMULATED DEDUCTIBLE AMOUNT^FO^^500;12^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.03,9002313.0301,512,2)
S Y(0)=Y S Y="$"_$J($$DFF2EXT^BPSECFM(Y),9,2)
"^DD",9002313.03,9002313.0301,512,2.1)
S Y="$"_$J($$DFF2EXT^BPSECFM(Y),9,2)
"^DD",9002313.03,9002313.0301,512,3)
Answer must be 8 characters in length.
"^DD",9002313.03,9002313.0301,512,21,0)
^^1^1^3080207^
"^DD",9002313.03,9002313.0301,512,21,1,0)
Amount in dollars met by the patient/family in a deductible plan.
"^DD",9002313.03,9002313.0301,512,"DT")
3080207
"^DD",9002313.03,9002313.0301,513,0)
REMAINING DEDUCTIBLE AMOUNT^FO^^500;13^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.03,9002313.0301,513,2)
S Y(0)=Y S Y="$"_$J($$DFF2EXT^BPSECFM(Y),9,2)
"^DD",9002313.03,9002313.0301,513,2.1)
S Y="$"_$J($$DFF2EXT^BPSECFM(Y),9,2)
"^DD",9002313.03,9002313.0301,513,3)
Answer must be 8 characters in length.
"^DD",9002313.03,9002313.0301,513,21,0)
^^1^1^3080207^
"^DD",9002313.03,9002313.0301,513,21,1,0)
Amount not met by the patient/family in the deductible plan.
"^DD",9002313.03,9002313.0301,513,"DT")
3080207
"^DD",9002313.03,9002313.0301,514,0)
REMAINING BENEFIT AMOUNT^FO^^500;14^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.03,9002313.0301,514,2)
S Y(0)=Y S Y="$"_$J($$DFF2EXT^BPSECFM(Y),9,2)
"^DD",9002313.03,9002313.0301,514,2.1)
S Y="$"_$J($$DFF2EXT^BPSECFM(Y),9,2)
"^DD",9002313.03,9002313.0301,514,3)
Answer must be 8 characters in length.
"^DD",9002313.03,9002313.0301,514,21,0)
^^1^1^3080207^
"^DD",9002313.03,9002313.0301,514,21,1,0)
Amount remaining in a patient/family plan with a periodic maximum benefit.
"^DD",9002313.03,9002313.0301,514,"DT")
3080207
"^DD",9002313.03,9002313.0301,517,0)
APPLIED TO PERIODIC DEDUCTABLE^FO^^500;17^K:$L(X)>8!($L(X)<6) X
"^DD",9002313.03,9002313.0301,517,2)
S Y(0)=Y S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,517,2.1)
S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,517,3)
Answer must be 6-8 characters in length.
"^DD",9002313.03,9002313.0301,517,21,0)
^^2^2^3080207^
"^DD",9002313.03,9002313.0301,517,21,1,0)
Amount to be collected from a patient that is included in 'Patient Pay 
"^DD",9002313.03,9002313.0301,517,21,2,0)
Amount' (55) that is applied to a periodic deductible.
"^DD",9002313.03,9002313.0301,517,"DT")
3080207
"^DD",9002313.03,9002313.0301,518,0)
AMOUNT OF COPAY COINSURANCE^FO^^500;18^K:$L(X)>8!($L(X)<6) X
"^DD",9002313.03,9002313.0301,518,2)
S Y(0)=Y S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,518,2.1)
S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,518,3)
Answer must be 6-8 characters in length.
"^DD",9002313.03,9002313.0301,518,21,0)
^^2^2^3080207^
"^DD",9002313.03,9002313.0301,518,21,1,0)
Amount to be collected from the patient that is included in 'Patient Pay 
"^DD",9002313.03,9002313.0301,518,21,2,0)
Amount' (55) that is due to a per prescription copay/coinsurance.
"^DD",9002313.03,9002313.0301,518,"DT")
3080207
"^DD",9002313.03,9002313.0301,519,0)
ATTRIBUTED TO PROD SELECTION^FO^^500;19^K:$L(X)>8!($L(X)<6) X
"^DD",9002313.03,9002313.0301,519,2)
S Y(0)=Y S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,519,2.1)
S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,519,3)
Answer must be 6-8 characters in length.
"^DD",9002313.03,9002313.0301,519,21,0)
^^2^2^3080207^
"^DD",9002313.03,9002313.0301,519,21,1,0)
Amount to be collected from the patient that is included in 'Patient Pay 
"^DD",9002313.03,9002313.0301,519,21,2,0)
Amount' (55) that is due to the patient's selection of drug product.
"^DD",9002313.03,9002313.0301,519,"DT")
3080207
"^DD",9002313.03,9002313.0301,520,0)
EXCEEDED PERIODIC BENEFIT MAX^FO^^500;20^K:$L(X)>8!($L(X)<6) X
"^DD",9002313.03,9002313.0301,520,2)
S Y(0)=Y S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,520,2.1)
S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,520,3)
Answer must be 6-8 characters in length.
"^DD",9002313.03,9002313.0301,520,21,0)
^^3^3^3080207^
"^DD",9002313.03,9002313.0301,520,21,1,0)
Amount to be collected from the patient that is included in 'Patient Pay 
"^DD",9002313.03,9002313.0301,520,21,2,0)
Amount' (55) that is due to the patient exceeding a periodic benefit 
"^DD",9002313.03,9002313.0301,520,21,3,0)
maximum.
"^DD",9002313.03,9002313.0301,520,"DT")
3080207
"^DD",9002313.03,9002313.0301,521,0)
INCENTIVE AMOUNT PAID^FO^^500;21^K:$L(X)>8!($L(X)<6) X
"^DD",9002313.03,9002313.0301,521,2)
S Y(0)=Y S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,521,2.1)
S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,521,3)
Answer must be 6-8 characters in length.
"^DD",9002313.03,9002313.0301,521,21,0)
^^3^3^3080207^
"^DD",9002313.03,9002313.0301,521,21,1,0)
Amount represents the contractually agreed upon incentive fee paid for 
"^DD",9002313.03,9002313.0301,521,21,2,0)
specific services rendered. Amount is included in the 'Total Amount Paid' 
"^DD",9002313.03,9002313.0301,521,21,3,0)
(59).
"^DD",9002313.03,9002313.0301,521,"DT")
3080207
"^DD",9002313.03,9002313.0301,522,0)
BASIS OF REIMBURSEMENT^F^^500;22^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.03,9002313.0301,522,3)
Answer must be 2 characters in length.
"^DD",9002313.03,9002313.0301,522,21,0)
^^2^2^3080207^
"^DD",9002313.03,9002313.0301,522,21,1,0)
Code identifying how the reimbursement amount was calculated for 
"^DD",9002313.03,9002313.0301,522,21,2,0)
'Ingredient Cost Paid' (56).
"^DD",9002313.03,9002313.0301,522,"DT")
3080207
"^DD",9002313.03,9002313.0301,523,0)
AMOUNT ATTRIBUTED TO SALES TAX^FO^^500;23^K:$L(X)>8!($L(X)<6) X
"^DD",9002313.03,9002313.0301,523,2)
S Y(0)=Y S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,523,2.1)
S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,523,3)
Answer must be 6-8 characters in length.
"^DD",9002313.03,9002313.0301,523,21,0)
^^2^2^3080207^
"^DD",9002313.03,9002313.0301,523,21,1,0)
Amount to be collected from the patient that is included in 'Patient Pay 
"^DD",9002313.03,9002313.0301,523,21,2,0)
Amount' (55) that is due to sales tax paid.
"^DD",9002313.03,9002313.0301,523,"DT")
3080207
"^DD",9002313.03,9002313.0301,525,0)
DUR RESPONSE DATA^F^^525;1^K:$L(X)>250!($L(X)<1) X
"^DD",9002313.03,9002313.0301,525,3)
Answer must be 1-250 characters in length.
"^DD",9002313.03,9002313.0301,525,21,0)
^^1^1^3080207^
"^DD",9002313.03,9002313.0301,525,21,1,0)
Text that provides additional detail regarding a DUR conflict.
"^DD",9002313.03,9002313.0301,525,"DT")
3080207
"^DD",9002313.03,9002313.0301,526,0)
ADDITIONAL MESSAGE INFORMATION^F^^526;1^K:$L(X)>250!($L(X)<1) X
"^DD",9002313.03,9002313.0301,526,3)
Answer must be 1-250 characters in length.
"^DD",9002313.03,9002313.0301,526,21,0)
^^1^1^3080207^
"^DD",9002313.03,9002313.0301,526,21,1,0)
Free text message.
"^DD",9002313.03,9002313.0301,526,"DT")
3080207
"^DD",9002313.03,9002313.0301,547,0)
APPROVED MESSAGE CODE COUNT^F^^540;7^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.03,9002313.0301,547,3)
Answer must be 1 character in length.
"^DD",9002313.03,9002313.0301,547,21,0)
^^1^1^3080207^
"^DD",9002313.03,9002313.0301,547,21,1,0)
Count of the 'Approved Message Code' (548-6F) occurrences.
"^DD",9002313.03,9002313.0301,547,"DT")
3080207
"^DD",9002313.03,9002313.0301,548,0)
APPROVED MESSAGE CODE^9002313.301548A^^548;0
"^DD",9002313.03,9002313.0301,548,"DT")
3080207
"^DD",9002313.03,9002313.0301,549,0)
HELP DESK PHONE QUALIFIER^F^^540;9^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.03,9002313.0301,549,3)
Answer must be 1-2 characters in length.
"^DD",9002313.03,9002313.0301,549,21,0)
^^1^1^3080207^
"^DD",9002313.03,9002313.0301,549,21,1,0)
Code qualifying the phone number in the 'Help Desk Phone Number' (55).
"^DD",9002313.03,9002313.0301,549,"DT")
3080207
"^DD",9002313.03,9002313.0301,550,0)
HELP DESK PHONE NUMBER^F^^540;10^K:$L(X)>18!($L(X)<1) X
"^DD",9002313.03,9002313.0301,550,3)
Answer must be 1-18 characters in length.
"^DD",9002313.03,9002313.0301,550,21,0)
^^1^1^3080207^
"^DD",9002313.03,9002313.0301,550,21,1,0)
Ten digit phone number of the help desk.
"^DD",9002313.03,9002313.0301,550,"DT")
3080207
"^DD",9002313.03,9002313.0301,551,0)
PREFERRED PRODUCT COUNT^NJ1,0^^550;1^K:+X'=X!(X>9)!(X<1)!(X?.E1"."1.N) X
"^DD",9002313.03,9002313.0301,551,3)
Type a number between 1 and 9, 0 Decimal Digits
"^DD",9002313.03,9002313.0301,551,21,0)
^^1^1^3080618^
"^DD",9002313.03,9002313.0301,551,21,1,0)
Count of preferred product occurrences.
"^DD",9002313.03,9002313.0301,551,"DT")
3080618
"^DD",9002313.03,9002313.0301,551.01,0)
PREFERRED PRODUCT REPEATING^9002313.1301A^^551.01;0
"^DD",9002313.03,9002313.0301,551.01,"DT")
3080207
"^DD",9002313.03,9002313.0301,557,0)
TAX EXEMPT INDICATOR^S^1:PAYER/PLAN IS TAX EXEMPT;2:NOT TAX EXEMPT;3:PATIENT IS TAX EXEMPT;4:PAYER/PLAN AND PATIENT TAX EXEMPT;^550;7^Q
"^DD",9002313.03,9002313.0301,557,3)
Enter a code specifying tax exempt status.
"^DD",9002313.03,9002313.0301,557,21,0)
^^1^1^3080617^
"^DD",9002313.03,9002313.0301,557,21,1,0)
Code indicating the payer and/or patient is exempt from taxes.
"^DD",9002313.03,9002313.0301,557,"DT")
3080617
"^DD",9002313.03,9002313.0301,558,0)
FLAT SALES TAX PAID^FO^^550;8^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.03,9002313.0301,558,2)
S Y(0)=Y S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,558,2.1)
S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,558,3)
Answer must be 8 characters in length.
"^DD",9002313.03,9002313.0301,558,21,0)
^^1^1^3080207^
"^DD",9002313.03,9002313.0301,558,21,1,0)
Flat sales tax paid which is included in the 'Total Amount Paid' (59).
"^DD",9002313.03,9002313.0301,558,"DT")
3080207
"^DD",9002313.03,9002313.0301,559,0)
PERCENTAGE SALES TAX PAID^FO^^550;9^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.03,9002313.0301,559,2)
S Y(0)=Y S Y=$J($$DFF2EXT^BPSECFM(Y),8,2)
"^DD",9002313.03,9002313.0301,559,2.1)
S Y=$J($$DFF2EXT^BPSECFM(Y),8,2)
"^DD",9002313.03,9002313.0301,559,3)
Answer must be 8 characters in length.
"^DD",9002313.03,9002313.0301,559,21,0)
^^2^2^3080207^
"^DD",9002313.03,9002313.0301,559,21,1,0)
Amount of percentage sales tax paid which is included in the 'Total Amount
"^DD",9002313.03,9002313.0301,559,21,2,0)
Paid' (59).
"^DD",9002313.03,9002313.0301,559,"DT")
3080207
"^DD",9002313.03,9002313.0301,560,0)
PERCENTAGE SALES TAX RATE PAID^FO^^550;10^K:$L(X)>7!($L(X)<7) X
"^DD",9002313.03,9002313.0301,560,2)
S Y(0)=Y S Y=$J($$DFF2EXT^BPSECFM(Y)/100,7,4)
"^DD",9002313.03,9002313.0301,560,2.1)
S Y=$J($$DFF2EXT^BPSECFM(Y)/100,7,4)
"^DD",9002313.03,9002313.0301,560,3)
Answer must be 7 characters in length.
"^DD",9002313.03,9002313.0301,560,21,0)
^^2^2^3080207^
"^DD",9002313.03,9002313.0301,560,21,1,0)
Percentage sales tax rate used to calculate 'Percentage Sales Tax Amount 
"^DD",9002313.03,9002313.0301,560,21,2,0)
Paid' (559).
"^DD",9002313.03,9002313.0301,560,"DT")
3080207
"^DD",9002313.03,9002313.0301,561,0)
PERCENTAGE SALES TAX BASIS^S^01:GROSS AMOUNT DUE;02:INGREDIENT COST;03:INGREDIENT COST + DISPENSING FEE;^560;1^Q
"^DD",9002313.03,9002313.0301,561,3)
Enter the basis for the percentage sales tax paid
"^DD",9002313.03,9002313.0301,561,21,0)
^^1^1^3080207^
"^DD",9002313.03,9002313.0301,561,21,1,0)
Code indicating the percentage sales tax paid basis.
"^DD",9002313.03,9002313.0301,561,"DT")
3080207
"^DD",9002313.03,9002313.0301,562,0)
PROFESSIONAL SERVICE FEE PAID^FO^^560;2^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.03,9002313.0301,562,2)
S Y(0)=Y S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,562,2.1)
S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,562,3)
Answer must be 8 characters in length.
"^DD",9002313.03,9002313.0301,562,21,0)
^^1^1^3080207^
"^DD",9002313.03,9002313.0301,562,21,1,0)
Amount submitted by the provider for professional services rendered.
"^DD",9002313.03,9002313.0301,562,"DT")
3080207
"^DD",9002313.03,9002313.0301,563,0)
OTHER AMOUNT PAID COUNT^F^^560;3^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.03,9002313.0301,563,3)
Answer must be 1 character in length.
"^DD",9002313.03,9002313.0301,563,21,0)
^^1^1^3080207^
"^DD",9002313.03,9002313.0301,563,21,1,0)
Count of the other amount paid occurrences.
"^DD",9002313.03,9002313.0301,563,"DT")
3080207
"^DD",9002313.03,9002313.0301,563.01,0)
OTHER AMOUNTS PAID^9002313.1401A^^563.01;0
"^DD",9002313.03,9002313.0301,563.01,"DT")
3080207
"^DD",9002313.03,9002313.0301,566,0)
OTHER PAYER AMOUNT RECOGNIZED^FO^^560;6^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.03,9002313.0301,566,2)
S Y(0)=Y S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,566,2.1)
S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.0301,566,3)
Answer must be 8 characters in length.
"^DD",9002313.03,9002313.0301,566,21,0)
^^1^1^3080207^
"^DD",9002313.03,9002313.0301,566,21,1,0)
Total dollar amount of any payment from another source including coupons.
"^DD",9002313.03,9002313.0301,566,"DT")
3080207
"^DD",9002313.03,9002313.0301,567.01,0)
DUR PPS^9002313.1101A^^567.01;0
"^DD",9002313.03,9002313.0301,567.01,"DT")
3080207
"^DD",9002313.03,9002313.0301,1000,0)
DUPLICATE RESPONSE DATA^F^^1000;1^K:$L(X)>85!($L(X)<1) X
"^DD",9002313.03,9002313.0301,1000,3)
Answer must be 1-85 characters in length.
"^DD",9002313.03,9002313.0301,1000,21,0)
^^1^1^3080207^
"^DD",9002313.03,9002313.0301,1000,21,1,0)
Response text to indicate duplicated data.
"^DD",9002313.03,9002313.0301,1000,"DT")
3080207
"^DD",9002313.03,9002313.03511,0)
REJECT CODE SUB-FIELD^^546^2
"^DD",9002313.03,9002313.03511,0,"DT")
3080618
"^DD",9002313.03,9002313.03511,0,"IX","B",9002313.03511,.01)

"^DD",9002313.03,9002313.03511,0,"NM","REJECT CODE")

"^DD",9002313.03,9002313.03511,0,"UP")
9002313.0301
"^DD",9002313.03,9002313.03511,.01,0)
REJECT CODE^MFO^^0;1^K:$L(X)>3!($L(X)<1) X
"^DD",9002313.03,9002313.03511,.01,1,0)
^.1
"^DD",9002313.03,9002313.03511,.01,1,1,0)
9002313.03511^B
"^DD",9002313.03,9002313.03511,.01,1,1,1)
S ^BPSR(DA(2),1000,DA(1),511,"B",$E(X,1,30),DA)=""
"^DD",9002313.03,9002313.03511,.01,1,1,2)
K ^BPSR(DA(2),1000,DA(1),511,"B",$E(X,1,30),DA)
"^DD",9002313.03,9002313.03511,.01,2)
S Y(0)=Y S Y=$$TRANREJ^BPSECFM(Y)
"^DD",9002313.03,9002313.03511,.01,2.1)
S Y=$$TRANREJ^BPSECFM(Y)
"^DD",9002313.03,9002313.03511,.01,3)
Answer must be 1-3 characters in length.
"^DD",9002313.03,9002313.03511,.01,21,0)
^^2^2^3080207^
"^DD",9002313.03,9002313.03511,.01,21,1,0)
The code returned in the response indicating the reason(s) why the claim
"^DD",9002313.03,9002313.03511,.01,21,2,0)
was rejected.
"^DD",9002313.03,9002313.03511,.01,"DT")
3080207
"^DD",9002313.03,9002313.03511,546,0)
REJECT FIELD OCCURRENCE^NJ2,0^^0;2^K:+X'=X!(X>99)!(X<0)!(X?.E1"."1.N) X
"^DD",9002313.03,9002313.03511,546,3)
Type a number between 0 and 99, 0 Decimal Digits
"^DD",9002313.03,9002313.03511,546,21,0)
^^1^1^3080618^
"^DD",9002313.03,9002313.03511,546,21,1,0)
The number of times a particular field caused a rejection to be triggered.
"^DD",9002313.03,9002313.03511,546,"DT")
3080618
"^DD",9002313.03,9002313.1101,0)
DUR PPS SUB-FIELD^^544^9
"^DD",9002313.03,9002313.1101,0,"DT")
3080618
"^DD",9002313.03,9002313.1101,0,"IX","B",9002313.1101,.01)

"^DD",9002313.03,9002313.1101,0,"NM","DUR PPS")

"^DD",9002313.03,9002313.1101,0,"UP")
9002313.0301
"^DD",9002313.03,9002313.1101,.01,0)
DUR PPS RESPONSE^NJ1,0^^0;1^K:+X'=X!(X>9)!(X<1)!(X?.E1"."1.N) X
"^DD",9002313.03,9002313.1101,.01,1,0)
^.1
"^DD",9002313.03,9002313.1101,.01,1,1,0)
9002313.1101^B
"^DD",9002313.03,9002313.1101,.01,1,1,1)
S ^BPSR(DA(2),1000,DA(1),567.01,"B",$E(X,1,30),DA)=""
"^DD",9002313.03,9002313.1101,.01,1,1,2)
K ^BPSR(DA(2),1000,DA(1),567.01,"B",$E(X,1,30),DA)
"^DD",9002313.03,9002313.1101,.01,3)
Type a number between 1 and 9, 0 Decimal Digits
"^DD",9002313.03,9002313.1101,.01,21,0)
^^1^1^3080207^
"^DD",9002313.03,9002313.1101,.01,21,1,0)
Counter number for each DUR/PPS set/logical grouping.
"^DD",9002313.03,9002313.1101,.01,"DT")
3080618
"^DD",9002313.03,9002313.1101,439,0)
REASON FOR SERVICE CODE^FO^^0;2^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.03,9002313.1101,439,2)
S Y(0)=Y S Y=$$TRANSCD^BPSECFM(Y)
"^DD",9002313.03,9002313.1101,439,2.1)
S Y=$$TRANSCD^BPSECFM(Y)
"^DD",9002313.03,9002313.1101,439,3)
Answer must be 1-2 characters in length.
"^DD",9002313.03,9002313.1101,439,21,0)
^^2^2^3080207^
"^DD",9002313.03,9002313.1101,439,21,1,0)
Code identifying the type of utilization conflict detected or the reason 
"^DD",9002313.03,9002313.1101,439,21,2,0)
for the pharmacist's professional service.
"^DD",9002313.03,9002313.1101,439,"DT")
3080207
"^DD",9002313.03,9002313.1101,528,0)
CLINICAL SIGNIFICANCE CODE^S^1:MAJOR;2:MODERATE;3:MINOR;9:UNDETERMINED;^0;3^Q
"^DD",9002313.03,9002313.1101,528,3)
Enter a code indicating the clinical significance.
"^DD",9002313.03,9002313.1101,528,21,0)
^^2^2^3080617^
"^DD",9002313.03,9002313.1101,528,21,1,0)
Code identifying the significance or severity level of a clinical event as
"^DD",9002313.03,9002313.1101,528,21,2,0)
contained in the originating data base.
"^DD",9002313.03,9002313.1101,528,"DT")
3080617
"^DD",9002313.03,9002313.1101,529,0)
OTHER PHARMACY INDICATOR^S^0:NOT SPECIFIED;1:YOUR PHARMACY;2:OTHER PHARMACY SAME CHAIN;3:OTHER PHARMACY;^0;4^Q
"^DD",9002313.03,9002313.1101,529,3)
Enter a code for the type of pharmacy dispensing the conflicting drug.
"^DD",9002313.03,9002313.1101,529,21,0)
^^2^2^3080617^
"^DD",9002313.03,9002313.1101,529,21,1,0)
Indicator telling whether the medication that caused the DUR to be 
"^DD",9002313.03,9002313.1101,529,21,2,0)
triggered came from the current pharmacy, or an outside pharmacy.
"^DD",9002313.03,9002313.1101,529,"DT")
3080617
"^DD",9002313.03,9002313.1101,530,0)
PREVIOUS DATE OF FILL^FO^^0;5^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.03,9002313.1101,530,2)
S Y(0)=Y S Y=$$FM3EXT^BPSOSU1(Y)
"^DD",9002313.03,9002313.1101,530,2.1)
S Y=$$FM3EXT^BPSOSU1(Y)
"^DD",9002313.03,9002313.1101,530,3)
Answer must be 8 characters in length.
"^DD",9002313.03,9002313.1101,530,21,0)
^^1^1^3080618^
"^DD",9002313.03,9002313.1101,530,21,1,0)
Date prescription was previously filled.
"^DD",9002313.03,9002313.1101,530,"DT")
3080618
"^DD",9002313.03,9002313.1101,531,0)
QUANTITY OF PREVIOUS FILL^F^^0;6^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.03,9002313.1101,531,3)
Answer must be 1-10 characters in length.
"^DD",9002313.03,9002313.1101,531,21,0)
^^2^2^3080207^
"^DD",9002313.03,9002313.1101,531,21,1,0)
Amount expressed in metric decimal units of the conflicting agent that was
"^DD",9002313.03,9002313.1101,531,21,2,0)
previously filled.
"^DD",9002313.03,9002313.1101,531,"DT")
3080207
"^DD",9002313.03,9002313.1101,532,0)
DATABASE INDICATOR^S^1:FIRST DATABANK;2:MEDI-SPAN PRODUCT LINE;3:MICROMEDEX/MEDICAL ECONOMICS;4:PROCESSOR DEVELOPED;5:OTHER;6:REDBOOK;7:MULTUM;^0;7^Q
"^DD",9002313.03,9002313.1101,532,3)
Enter a code identifying the source of DUR information.
"^DD",9002313.03,9002313.1101,532,21,0)
^^1^1^3080618^
"^DD",9002313.03,9002313.1101,532,21,1,0)
Code identifying the source of drug information used for DUR processing.
"^DD",9002313.03,9002313.1101,532,"DT")
3080618
"^DD",9002313.03,9002313.1101,533,0)
OTHER PRESCRIBER INDICATOR^S^0:NOT SPECIFIED;1:SAME PRESCRIBER;2:OTHER PRESCRIBER;^0;8^Q
"^DD",9002313.03,9002313.1101,533,3)
Enter a code for the prescriber of the previously filled conflicting prescription.
"^DD",9002313.03,9002313.1101,533,21,0)
^^2^2^3080618^
"^DD",9002313.03,9002313.1101,533,21,1,0)
Code comparing the prescriber of the current prescription to the 
"^DD",9002313.03,9002313.1101,533,21,2,0)
prescriber of the previously filled conflicting prescription.
"^DD",9002313.03,9002313.1101,533,"DT")
3080618
"^DD",9002313.03,9002313.1101,544,0)
DUR FREE TEXT MESSAGE^F^^0;9^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.03,9002313.1101,544,3)
Answer must be 1-30 characters in length.
"^DD",9002313.03,9002313.1101,544,21,0)
^^1^1^3080207^
"^DD",9002313.03,9002313.1101,544,21,1,0)
Text that provides additional detail regarding a DUR conflict.
"^DD",9002313.03,9002313.1101,544,"DT")
3080207
"^DD",9002313.03,9002313.1301,0)
PREFERRED PRODUCT REPEATING SUB-FIELD^^556^6
"^DD",9002313.03,9002313.1301,0,"DT")
3080618
"^DD",9002313.03,9002313.1301,0,"IX","B",9002313.1301,.01)

"^DD",9002313.03,9002313.1301,0,"NM","PREFERRED PRODUCT REPEATING")

"^DD",9002313.03,9002313.1301,0,"UP")
9002313.0301
"^DD",9002313.03,9002313.1301,.01,0)
PREFERRED PRODUCT COUNTER^NJ1,0^^0;1^K:+X'=X!(X>9)!(X<1)!(X?.E1"."1.N) X
"^DD",9002313.03,9002313.1301,.01,1,0)
^.1
"^DD",9002313.03,9002313.1301,.01,1,1,0)
9002313.1301^B
"^DD",9002313.03,9002313.1301,.01,1,1,1)
S ^BPSR(DA(2),1000,DA(1),551.01,"B",$E(X,1,30),DA)=""
"^DD",9002313.03,9002313.1301,.01,1,1,2)
K ^BPSR(DA(2),1000,DA(1),551.01,"B",$E(X,1,30),DA)
"^DD",9002313.03,9002313.1301,.01,3)
Type a number between 1 and 9, 0 Decimal Digits
"^DD",9002313.03,9002313.1301,.01,21,0)
^^1^1^3080618^
"^DD",9002313.03,9002313.1301,.01,21,1,0)
Sequential counter of the Preferred Product occurrences.
"^DD",9002313.03,9002313.1301,.01,"DT")
3080618
"^DD",9002313.03,9002313.1301,552,0)
PREFERRED PRODUCT ID QUALIFIER^F^^1;1^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.03,9002313.1301,552,3)
Answer must be 1-2 characters in length.
"^DD",9002313.03,9002313.1301,552,21,0)
^^2^2^3080207^
"^DD",9002313.03,9002313.1301,552,21,1,0)
Code qualifying the type of product ID submitted in 'Preferred Product ID'
"^DD",9002313.03,9002313.1301,552,21,2,0)
(553).
"^DD",9002313.03,9002313.1301,552,"DT")
3080207
"^DD",9002313.03,9002313.1301,553,0)
PREFERRED PRODUCT ID^F^^1;2^K:$L(X)>19!($L(X)<1) X
"^DD",9002313.03,9002313.1301,553,3)
Answer must be 1-19 characters in length.
"^DD",9002313.03,9002313.1301,553,21,0)
^^1^1^3080207^
"^DD",9002313.03,9002313.1301,553,21,1,0)
Alternate product recommended by the plan.
"^DD",9002313.03,9002313.1301,553,"DT")
3080207
"^DD",9002313.03,9002313.1301,554,0)
PREFERRED PRODUCT INCENTIVE^FO^^1;3^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.03,9002313.1301,554,2)
S Y(0)=Y S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.1301,554,2.1)
S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.1301,554,3)
Answer must be 8 characters in length.
"^DD",9002313.03,9002313.1301,554,21,0)
^^2^2^3080207^
"^DD",9002313.03,9002313.1301,554,21,1,0)
Amount of pharmacy incentive available for substitution of preferred 
"^DD",9002313.03,9002313.1301,554,21,2,0)
product.
"^DD",9002313.03,9002313.1301,554,"DT")
3080207
"^DD",9002313.03,9002313.1301,555,0)
PREFRD PRODUCT COPAY INCENTIVE^FO^^1;4^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.03,9002313.1301,555,2)
S Y(0)=Y S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.1301,555,2.1)
S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.1301,555,3)
Answer must be 8 characters in length.
"^DD",9002313.03,9002313.1301,555,21,0)
^^1^1^3080207^
"^DD",9002313.03,9002313.1301,555,21,1,0)
Amount of patient's copay/cost-share incentive for preferred product.
"^DD",9002313.03,9002313.1301,555,"DT")
3080207
"^DD",9002313.03,9002313.1301,556,0)
PREFERRED PRODUCT DESCRIPTION^F^^1;5^K:$L(X)>40!($L(X)<1) X
"^DD",9002313.03,9002313.1301,556,3)
Answer must be 1-40 characters in length.
"^DD",9002313.03,9002313.1301,556,21,0)
^^1^1^3080207^
"^DD",9002313.03,9002313.1301,556,21,1,0)
Free text message.
"^DD",9002313.03,9002313.1301,556,"DT")
3080207
"^DD",9002313.03,9002313.1401,0)
OTHER AMOUNTS PAID SUB-FIELD^^565^3
"^DD",9002313.03,9002313.1401,0,"DT")
3080618
"^DD",9002313.03,9002313.1401,0,"IX","B",9002313.1401,.01)

"^DD",9002313.03,9002313.1401,0,"NM","OTHER AMOUNTS PAID")

"^DD",9002313.03,9002313.1401,0,"UP")
9002313.0301
"^DD",9002313.03,9002313.1401,.01,0)
OTHER AMOUNT PAID COUNTER^NJ1,0^^0;1^K:+X'=X!(X>9)!(X<1)!(X?.E1"."1.N) X
"^DD",9002313.03,9002313.1401,.01,1,0)
^.1
"^DD",9002313.03,9002313.1401,.01,1,1,0)
9002313.1401^B
"^DD",9002313.03,9002313.1401,.01,1,1,1)
S ^BPSR(DA(2),1000,DA(1),563.01,"B",$E(X,1,30),DA)=""
"^DD",9002313.03,9002313.1401,.01,1,1,2)
K ^BPSR(DA(2),1000,DA(1),563.01,"B",$E(X,1,30),DA)
"^DD",9002313.03,9002313.1401,.01,3)
Type a number between 1 and 9, 0 Decimal Digits
"^DD",9002313.03,9002313.1401,.01,21,0)
^^1^1^3080618^
"^DD",9002313.03,9002313.1401,.01,21,1,0)
Count of the other amount paid occurrences.
"^DD",9002313.03,9002313.1401,.01,"DT")
3080618
"^DD",9002313.03,9002313.1401,564,0)
OTHER AMOUNT PAID QUALIFIER^F^^1;1^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.03,9002313.1401,564,3)
Answer must be 1-2 characters in length.
"^DD",9002313.03,9002313.1401,564,21,0)
^^1^1^3080207^
"^DD",9002313.03,9002313.1401,564,21,1,0)
Code clarifying the value in the 'Other Amount Paid' (565).
"^DD",9002313.03,9002313.1401,564,"DT")
3080207
"^DD",9002313.03,9002313.1401,565,0)
OTHER AMOUNT PAID^FO^^1;2^K:$L(X)>8!($L(X)<8) X
"^DD",9002313.03,9002313.1401,565,2)
S Y(0)=Y S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.1401,565,2.1)
S Y="$"_$J($$DFF2EXT^BPSECFM(Y),7,2)
"^DD",9002313.03,9002313.1401,565,3)
Answer must be 8 characters in length.
"^DD",9002313.03,9002313.1401,565,21,0)
^^2^2^3080207^
"^DD",9002313.03,9002313.1401,565,21,1,0)
Amount paid for additional costs claimed in 'Other Amount Claimed 
"^DD",9002313.03,9002313.1401,565,21,2,0)
Submitted' (48).
"^DD",9002313.03,9002313.1401,565,"DT")
3080207
"^DD",9002313.03,9002313.301548,0)
APPROVED MESSAGE CODE SUB-FIELD^^.01^1
"^DD",9002313.03,9002313.301548,0,"DT")
3020808
"^DD",9002313.03,9002313.301548,0,"IX","B",9002313.301548,.01)

"^DD",9002313.03,9002313.301548,0,"NM","APPROVED MESSAGE CODE")

"^DD",9002313.03,9002313.301548,0,"UP")
9002313.0301
"^DD",9002313.03,9002313.301548,.01,0)
APPROVED MESSAGE CODE^F^^0;1^K:$L(X)>3!($L(X)<1) X
"^DD",9002313.03,9002313.301548,.01,1,0)
^.1
"^DD",9002313.03,9002313.301548,.01,1,1,0)
9002313.301548^B
"^DD",9002313.03,9002313.301548,.01,1,1,1)
S ^BPSR(DA(2),1000,DA(1),548,"B",$E(X,1,30),DA)=""
"^DD",9002313.03,9002313.301548,.01,1,1,2)
K ^BPSR(DA(2),1000,DA(1),548,"B",$E(X,1,30),DA)
"^DD",9002313.03,9002313.301548,.01,3)
Answer must be 1-3 characters in length.
"^DD",9002313.03,9002313.301548,.01,21,0)
^^2^2^3080207^
"^DD",9002313.03,9002313.301548,.01,21,1,0)
Message code, on an approved claim/service, communicating the need for an 
"^DD",9002313.03,9002313.301548,.01,21,2,0)
additional follow-up.
"^DD",9002313.03,9002313.301548,.01,"DT")
3080207
"^DD",9002313.03,9002313.39999,0)
RAW DATA RECEIVED SUB-FIELD^^.01^1
"^DD",9002313.03,9002313.39999,0,"DT")
3000830
"^DD",9002313.03,9002313.39999,0,"NM","RAW DATA RECEIVED")

"^DD",9002313.03,9002313.39999,0,"UP")
9002313.03
"^DD",9002313.03,9002313.39999,.01,0)
RAW DATA RECEIVED^WL^^0;1^Q
"^DD",9002313.03,9002313.39999,.01,21,0)
^^3^3^3080618^
"^DD",9002313.03,9002313.39999,.01,21,1,0)
A copy of the raw data packet received. This could be of use in diagnosing
"^DD",9002313.03,9002313.39999,.01,21,2,0)
weird problems, such as the time a packet was apparently shifted two
"^DD",9002313.03,9002313.39999,.01,21,3,0)
places.
"^DD",9002313.03,9002313.39999,.01,"DT")
3080618
"^DD",9002313.15,9002313.15,0)
FIELD^^.05^5
"^DD",9002313.15,9002313.15,0,"DDA")
N
"^DD",9002313.15,9002313.15,0,"DT")
3080619
"^DD",9002313.15,9002313.15,0,"IX","B",9002313.15,.01)

"^DD",9002313.15,9002313.15,0,"NM","BPS ASLEEP PAYERS")

"^DD",9002313.15,9002313.15,0,"PT",9002313.57,801)

"^DD",9002313.15,9002313.15,0,"PT",9002313.59,801)

"^DD",9002313.15,9002313.15,0,"VRPK")
BPS
"^DD",9002313.15,9002313.15,.01,0)
PAYER PLAN^RP355.3'^IBA(355.3,^0;1^Q
"^DD",9002313.15,9002313.15,.01,1,0)
^.1
"^DD",9002313.15,9002313.15,.01,1,1,0)
9002313.15^B
"^DD",9002313.15,9002313.15,.01,1,1,1)
S ^BPS(9002313.15,"B",$E(X,1,30),DA)=""
"^DD",9002313.15,9002313.15,.01,1,1,2)
K ^BPS(9002313.15,"B",$E(X,1,30),DA)
"^DD",9002313.15,9002313.15,.01,3)
Enter the group insurance plan for this asleep payer.
"^DD",9002313.15,9002313.15,.01,21,0)
^^1^1^3071207^
"^DD",9002313.15,9002313.15,.01,21,1,0)
This is the Group Insurance Plan for this asleep payer.
"^DD",9002313.15,9002313.15,.01,"DT")
3071207
"^DD",9002313.15,9002313.15,.02,0)
RETRY COUNT^NJ2,0^^0;2^K:+X'=X!(X>99)!(X<0)!(X?.E1"."1.N) X
"^DD",9002313.15,9002313.15,.02,3)
Enter the number (0-99) of times this payer has been retried.
"^DD",9002313.15,9002313.15,.02,21,0)
^^2^2^3071207^
"^DD",9002313.15,9002313.15,.02,21,1,0)
This is a counter for the number of times the payer has been retried for 
"^DD",9002313.15,9002313.15,.02,21,2,0)
processing prober claims.
"^DD",9002313.15,9002313.15,.02,"DT")
3080619
"^DD",9002313.15,9002313.15,.03,0)
IGNORE ASLEEP^S^0:DON'T IGNORE;1:IGNORE;^0;3^Q
"^DD",9002313.15,9002313.15,.03,3)
Enter 1 (one) to Ignore Asleep reject codes for this payer.
"^DD",9002313.15,9002313.15,.03,21,0)
^^2^2^3080619^^
"^DD",9002313.15,9002313.15,.03,21,1,0)
This is a flag indicating the payer should be ignored as being asleep.  
"^DD",9002313.15,9002313.15,.03,21,2,0)
This is set to ignore if the payer's maximum retries has been reached.
"^DD",9002313.15,9002313.15,.03,"DT")
3080619
"^DD",9002313.15,9002313.15,.04,0)
PROBER CLAIM^P9002313.77'^BPS(9002313.77,^0;4^Q
"^DD",9002313.15,9002313.15,.04,3)
Enter the prober claim to use to retry.
"^DD",9002313.15,9002313.15,.04,21,0)
^^2^2^3071207^
"^DD",9002313.15,9002313.15,.04,21,1,0)
This is the transaction in the BPS TRANSACTION file that will be used to
"^DD",9002313.15,9002313.15,.04,21,2,0)
probe the payer to see if they are no longer asleep.
"^DD",9002313.15,9002313.15,.04,"DT")
3080408
"^DD",9002313.15,9002313.15,.05,0)
RETRY TIME^D^^0;5^S %DT="ESTR" D ^%DT S X=Y K:X<1 X
"^DD",9002313.15,9002313.15,.05,3)
Enter a date/time to retry asleep payer.
"^DD",9002313.15,9002313.15,.05,21,0)
^^1^1^3080613^
"^DD",9002313.15,9002313.15,.05,21,1,0)
This is the date/time that the system should retry the asleep payer.
"^DD",9002313.15,9002313.15,.05,"DT")
3080613
"^DD",9002313.25,9002313.25,0)
FIELD^^.02^2
"^DD",9002313.25,9002313.25,0,"DDA")
N
"^DD",9002313.25,9002313.25,0,"DT")
3071212
"^DD",9002313.25,9002313.25,0,"ID",.02)
W "   ",$P(^(0),U,2)
"^DD",9002313.25,9002313.25,0,"IX","B",9002313.25,.01)

"^DD",9002313.25,9002313.25,0,"NM","BPS NCPDP CLARIFICATION CODES")

"^DD",9002313.25,9002313.25,0,"PT",52.25,24)

"^DD",9002313.25,9002313.25,0,"PT",9002313.77,2.05)

"^DD",9002313.25,9002313.25,0,"VRPK")
BPS
"^DD",9002313.25,9002313.25,.01,0)
CODE^RF^^0;1^K:$L(X)>2!($L(X)<1)!'(X'?1P.E) X
"^DD",9002313.25,9002313.25,.01,1,0)
^.1
"^DD",9002313.25,9002313.25,.01,1,1,0)
9002313.25^B
"^DD",9002313.25,9002313.25,.01,1,1,1)
S ^BPS(9002313.25,"B",$E(X,1,30),DA)=""
"^DD",9002313.25,9002313.25,.01,1,1,2)
K ^BPS(9002313.25,"B",$E(X,1,30),DA)
"^DD",9002313.25,9002313.25,.01,3)
Answer must be 1-2 characters in length.
"^DD",9002313.25,9002313.25,.01,21,0)
^^2^2^3080613^
"^DD",9002313.25,9002313.25,.01,21,1,0)
Clarification code to be sent to the payer as defined by the NCPDP 
"^DD",9002313.25,9002313.25,.01,21,2,0)
standard.
"^DD",9002313.25,9002313.25,.01,"DT")
3080613
"^DD",9002313.25,9002313.25,.02,0)
DESCRIPTION^FX^^0;2^K:$L(X)>80!($L(X)<1) X S:$D(X) X=$$UP^XLFSTR(X)
"^DD",9002313.25,9002313.25,.02,3)
Answer must be 1-80 characters in length.
"^DD",9002313.25,9002313.25,.02,21,0)
^^1^1^3080613^
"^DD",9002313.25,9002313.25,.02,21,1,0)
Description of the clarification code.
"^DD",9002313.25,9002313.25,.02,"DT")
3080613
"^DD",9002313.26,9002313.26,0)
FIELD^^.03^3
"^DD",9002313.26,9002313.26,0,"DDA")
N
"^DD",9002313.26,9002313.26,0,"DT")
3080312
"^DD",9002313.26,9002313.26,0,"ID",.02)
W "   ",$P(^(0),U,2)
"^DD",9002313.26,9002313.26,0,"IX","B",9002313.26,.01)

"^DD",9002313.26,9002313.26,0,"NM","BPS NCPDP PRIOR AUTHORIZATION TYPE CODE")

"^DD",9002313.26,9002313.26,0,"VRPK")
BPS
"^DD",9002313.26,9002313.26,.01,0)
CODE^RNJ2,0^^0;1^K:+X'=X!(X>99)!(X<0)!(X?.E1"."1.N) X
"^DD",9002313.26,9002313.26,.01,1,0)
^.1
"^DD",9002313.26,9002313.26,.01,1,1,0)
9002313.26^B
"^DD",9002313.26,9002313.26,.01,1,1,1)
S ^BPS(9002313.26,"B",$E(X,1,30),DA)=""
"^DD",9002313.26,9002313.26,.01,1,1,2)
K ^BPS(9002313.26,"B",$E(X,1,30),DA)
"^DD",9002313.26,9002313.26,.01,3)
Enter the NCPDP code that will be submitted for the prior auth.
"^DD",9002313.26,9002313.26,.01,21,0)
^^2^2^3080312^
"^DD",9002313.26,9002313.26,.01,21,1,0)
This is the code that is transmitted to the payer for the prior 
"^DD",9002313.26,9002313.26,.01,21,2,0)
authorization type.
"^DD",9002313.26,9002313.26,.01,"DT")
3080312
"^DD",9002313.26,9002313.26,.02,0)
BRIEF DESCRIPTION^F^^0;2^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.26,9002313.26,.02,3)
Enter the brief description associated with this code.
"^DD",9002313.26,9002313.26,.02,21,0)
^^2^2^3080312^
"^DD",9002313.26,9002313.26,.02,21,1,0)
This is the brief description of the code that is defined in the NCPDP 
"^DD",9002313.26,9002313.26,.02,21,2,0)
standard.
"^DD",9002313.26,9002313.26,.02,"DT")
3080312
"^DD",9002313.26,9002313.26,.03,0)
FULL DESCRIPTION^9002313.261^^1;0
"^DD",9002313.26,9002313.26,.03,3)
Enter the full description for the Prior Auth Type Code.
"^DD",9002313.26,9002313.26,.03,21,0)
^^1^1^3080616^^
"^DD",9002313.26,9002313.26,.03,21,1,0)
This is the full description of the code as stated in the NCPDP standards.
"^DD",9002313.26,9002313.261,0)
FULL DESCRIPTION SUB-FIELD^^.01^1
"^DD",9002313.26,9002313.261,0,"DT")
3080312
"^DD",9002313.26,9002313.261,0,"NM","FULL DESCRIPTION")

"^DD",9002313.26,9002313.261,0,"UP")
9002313.26
"^DD",9002313.26,9002313.261,.01,0)
FULL DESCRIPTION^Wx^^0;1
"^DD",9002313.26,9002313.261,.01,3)
Enter the full description for the Prior Auth Type Code
"^DD",9002313.26,9002313.261,.01,"DT")
3080616
"^DD",9002313.32,9002313.32,.07,0)
DELAY^NJ4,2^^0;7^K:+X'=X!(X>5)!(X<0)!(X?.E1"."3.N) X
"^DD",9002313.32,9002313.32,.07,3)
Enter number of minutes to delay processing (a number between 0 and 5 with up to 2 digits after the decimal point).
"^DD",9002313.32,9002313.32,.07,21,0)
^.001^1^1^3081113^^^^
"^DD",9002313.32,9002313.32,.07,21,1,0)
Processing delay in minutes.
"^DD",9002313.32,9002313.32,.07,"DT")
3081113
"^DD",9002313.56,9002313.56,0)
FIELD^^.04^32
"^DD",9002313.56,9002313.56,0,"DDA")
N
"^DD",9002313.56,9002313.56,0,"DT")
3080612
"^DD",9002313.56,9002313.56,0,"IX","B",9002313.56,.01)

"^DD",9002313.56,9002313.56,0,"IX","C",9002313.5601,.01)

"^DD",9002313.56,9002313.56,0,"NM","BPS PHARMACIES")

"^DD",9002313.56,9002313.56,0,"PT",366.141,.09)

"^DD",9002313.56,9002313.56,0,"PT",9002313.57,1.07)

"^DD",9002313.56,9002313.56,0,"PT",9002313.59,1.07)

"^DD",9002313.56,9002313.56,0,"VRPK")
BPS
"^DD",9002313.56,9002313.56,.01,0)
NAME^RFX^^0;1^K:$L(X)>30!(X?.N)!($L(X)<3)!'(X'?1P.E) X
"^DD",9002313.56,9002313.56,.01,1,0)
^.1
"^DD",9002313.56,9002313.56,.01,1,1,0)
9002313.56^B
"^DD",9002313.56,9002313.56,.01,1,1,1)
S ^BPS(9002313.56,"B",$E(X,1,30),DA)=""
"^DD",9002313.56,9002313.56,.01,1,1,2)
K ^BPS(9002313.56,"B",$E(X,1,30),DA)
"^DD",9002313.56,9002313.56,.01,3)
Name must be 3-30 characters, not numeric or starting with punctuation.
"^DD",9002313.56,9002313.56,.01,7.5)
I $D(X) S X=$$UP^XLFSTR(X)
"^DD",9002313.56,9002313.56,.01,21,0)
^^1^1^3080617^
"^DD",9002313.56,9002313.56,.01,21,1,0)
This is the name used to distinguish the BPS Pharmacy.
"^DD",9002313.56,9002313.56,.01,"DT")
3080617
"^DD",9002313.56,9002313.56,.02,0)
NCPDP #^F^^0;2^K:$L(X)>10!($L(X)<3) X
"^DD",9002313.56,9002313.56,.02,3)
This is a number assigned to your pharmacy by the NCPDP.  It was previously known as the NABP #.
"^DD",9002313.56,9002313.56,.02,21,0)
^.001^1^1^3060411^^
"^DD",9002313.56,9002313.56,.02,21,1,0)
The NCPDP # is sent as part of the electronic claim header.
"^DD",9002313.56,9002313.56,.02,"DT")
3060412
"^DD",9002313.56,9002313.56,.03,0)
DEFAULT DEA #^RF^^0;3^K:$L(X)>12!($L(X)<3) X
"^DD",9002313.56,9002313.56,.03,3)
Answer must be 3-12 characters in length.
"^DD",9002313.56,9002313.56,.03,21,0)
^^4^4^3050823^
"^DD",9002313.56,9002313.56,.03,21,1,0)
Many insurances require the prescriber's DEA number as part of the 
"^DD",9002313.56,9002313.56,.03,21,2,0)
claim.  If your pharmacy has a DEA # that may be used in case a 
"^DD",9002313.56,9002313.56,.03,21,3,0)
prescriber doesn't have this DEA # on file with you, enter that
"^DD",9002313.56,9002313.56,.03,21,4,0)
default DEA # here.
"^DD",9002313.56,9002313.56,.03,"DT")
3040607
"^DD",9002313.56,9002313.56,.04,0)
LAST REGISTERED STATUS^S^1:ACTIVE;0:INACTIVE;^0;4^Q
"^DD",9002313.56,9002313.56,.04,3)
Enter the last status registered.
"^DD",9002313.56,9002313.56,.04,21,0)
^^4^4^3080612^
"^DD",9002313.56,9002313.56,.04,21,1,0)
This field is set by the software in the background when registration
"^DD",9002313.56,9002313.56,.04,21,2,0)
messages are sent to Austin.  If the STATUS is Inactive and the last
"^DD",9002313.56,9002313.56,.04,21,3,0)
registered status is also Inactive then this pharmacy will not be
"^DD",9002313.56,9002313.56,.04,21,4,0)
registered again as Inactive.
"^DD",9002313.56,9002313.56,.04,"DT")
3080612
"^DD",9002313.56,9002313.56,.09,0)
AUTO-REVERSE PARAMETER^NJ2,0^^0;9^K:+X'=X!(X>30)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.56,9002313.56,.09,3)
You have to enter a number between 0 and 30.
"^DD",9002313.56,9002313.56,.09,21,0)
^.001^11^11^3050830^^
"^DD",9002313.56,9002313.56,.09,21,1,0)
ECME shall use the following AUTO-REVERSE site parameter when
"^DD",9002313.56,9002313.56,.09,21,2,0)
determining whether non-released prescription claims (that have
"^DD",9002313.56,9002313.56,.09,21,3,0)
a PAYABLE payer returned response) are to be automatically REVERSED.
"^DD",9002313.56,9002313.56,.09,21,4,0)
 
"^DD",9002313.56,9002313.56,.09,21,5,0)
The AUTO-REVERSE site parameter is set for the number of days that
"^DD",9002313.56,9002313.56,.09,21,6,0)
ECME will wait before the claim is automatically REVERSED. The user
"^DD",9002313.56,9002313.56,.09,21,7,0)
is allowed to enter a number as follows:
"^DD",9002313.56,9002313.56,.09,21,8,0)
 
"^DD",9002313.56,9002313.56,.09,21,9,0)
0 - ECME Auto-Reverse is turned off, 1 to 30 - ECME will wait the
"^DD",9002313.56,9002313.56,.09,21,10,0)
entered number of days before REVERSING the non-released Rx with a
"^DD",9002313.56,9002313.56,.09,21,11,0)
PAYABLE payer returned response.
"^DD",9002313.56,9002313.56,.09,"DT")
3050830
"^DD",9002313.56,9002313.56,.1,0)
STATUS^RS^1:ACTIVE;0:INACTIVE;^0;10^Q
"^DD",9002313.56,9002313.56,.1,3)
Enter '1' for active or '0' for inactive
"^DD",9002313.56,9002313.56,.1,21,0)
^^2^2^3060601^
"^DD",9002313.56,9002313.56,.1,21,1,0)
Indicates whether a BPS Pharmacy is active or inactive. If active, claims 
"^DD",9002313.56,9002313.56,.1,21,2,0)
will be processed through ECME.
"^DD",9002313.56,9002313.56,.1,"DT")
3060602
"^DD",9002313.56,9002313.56,1,0)
CMOP SWITCH^RS^0:CMOP OFF;1:CMOP ON;^0;8^Q
"^DD",9002313.56,9002313.56,1,3)
Enter ON to process CMOP claims via ECME, OFF to not process CMOP claims via ECME.
"^DD",9002313.56,9002313.56,1,21,0)
^^2^2^3050823^
"^DD",9002313.56,9002313.56,1,21,1,0)
Indicates whether ECME shall process CMOP claims.  If ON, CMOP claims 
"^DD",9002313.56,9002313.56,1,21,2,0)
will be processed.  If OFF, CMOP claims will not be processed.
"^DD",9002313.56,9002313.56,1,"DT")
3050729
"^DD",9002313.56,9002313.56,41.01,0)
NPI^FX^^NPI;1^K:$L(X)>10!($L(X)<10)!'$$CHKDGT^XUSNPI(X) X
"^DD",9002313.56,9002313.56,41.01,3)
Enter a valid NPI (10 numeric digits with proper check digit).
"^DD",9002313.56,9002313.56,41.01,21,0)
^.001^3^3^3060616^^^
"^DD",9002313.56,9002313.56,41.01,21,1,0)
National Provider ID.  This is a unique ID assigned to providers by CMS.  
"^DD",9002313.56,9002313.56,41.01,21,2,0)
It is used as the second piece of the Claim ID field (.01) of BPS CLAIMS
"^DD",9002313.56,9002313.56,41.01,21,3,0)
file (#9002313.02) and is sent as part of the electronic claim header.
"^DD",9002313.56,9002313.56,41.01,"DT")
3060504
"^DD",9002313.56,9002313.56,41.02,0)
DATE/TIME OF LAST NPI CHANGE^D^^NPI;2^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.56,9002313.56,41.02,3)
Enter the data and time of the last change to the NPI.
"^DD",9002313.56,9002313.56,41.02,21,0)
^^1^1^3060628^
"^DD",9002313.56,9002313.56,41.02,21,1,0)
This is the date and time of the last change to the NPI value.
"^DD",9002313.56,9002313.56,41.02,"DT")
3060628
"^DD",9002313.56,9002313.56,102.03,0)
SITE CITY^RF^^ADDR;3^K:$L(X)>25!($L(X)<1) X
"^DD",9002313.56,9002313.56,102.03,3)
Answer must be 1-25 characters in length.
"^DD",9002313.56,9002313.56,102.03,21,0)
^.001^1^1^3040607^^^
"^DD",9002313.56,9002313.56,102.03,21,1,0)
Enter City
"^DD",9002313.56,9002313.56,102.03,"DT")
3040607
"^DD",9002313.56,9002313.56,120.01,0)
SITE ADDRESS 1^RF^^ADDR;1^K:$L(X)>25!($L(X)<1) X
"^DD",9002313.56,9002313.56,120.01,3)
Answer must be 1-25 characters in length.
"^DD",9002313.56,9002313.56,120.01,21,0)
^.001^1^1^3040607^^
"^DD",9002313.56,9002313.56,120.01,21,1,0)
The site's street address. 
"^DD",9002313.56,9002313.56,120.01,"DT")
3040607
"^DD",9002313.56,9002313.56,120.02,0)
SITE ADDRESS 2^F^^ADDR;2^K:$L(X)>25!($L(X)<1) X
"^DD",9002313.56,9002313.56,120.02,3)
Answer must be 1-25 characters in length
"^DD",9002313.56,9002313.56,120.02,21,0)
^^1^1^3040325^
"^DD",9002313.56,9002313.56,120.02,21,1,0)
Site's address line 2.
"^DD",9002313.56,9002313.56,120.02,"DT")
3040325
"^DD",9002313.56,9002313.56,120.03,0)
SITE ADDRESS NAME^RF^^ADDR;8^K:$L(X)>40!($L(X)<1) X
"^DD",9002313.56,9002313.56,120.03,3)
Answer must be 1-40 characters in length.
"^DD",9002313.56,9002313.56,120.03,21,0)
^.001^1^1^3040607^^
"^DD",9002313.56,9002313.56,120.03,21,1,0)
Site's Business name.
"^DD",9002313.56,9002313.56,120.03,"DT")
3040607
"^DD",9002313.56,9002313.56,120.04,0)
SITE STATE^RP5'^DIC(5,^ADDR;4^Q
"^DD",9002313.56,9002313.56,120.04,3)
Answer with a STATE NAME.
"^DD",9002313.56,9002313.56,120.04,21,0)
^^1^1^3080617^
"^DD",9002313.56,9002313.56,120.04,21,1,0)
This is the state in which the site is located.
"^DD",9002313.56,9002313.56,120.04,"DT")
3080617
"^DD",9002313.56,9002313.56,120.05,0)
SITE ZIP CODE^RF^^ADDR;5^K:$L(X)>10!($L(X)<5) X
"^DD",9002313.56,9002313.56,120.05,3)
Answer must be 5-10 characters in length.
"^DD",9002313.56,9002313.56,120.05,21,0)
^^1^1^3080617^
"^DD",9002313.56,9002313.56,120.05,21,1,0)
This is the zip code for the ePharmacy billing site.
"^DD",9002313.56,9002313.56,120.05,"DT")
3080617
"^DD",9002313.56,9002313.56,120.06,0)
SITE PHONE^F^^ADDR;6^K:$L(X)>20!($L(X)<1) X
"^DD",9002313.56,9002313.56,120.06,3)
Answer must be 1-20 characters in length.
"^DD",9002313.56,9002313.56,120.06,21,0)
^^1^1^3010331^
"^DD",9002313.56,9002313.56,120.06,21,1,0)
For NCPDP claim forms.
"^DD",9002313.56,9002313.56,120.06,"DT")
3010331
"^DD",9002313.56,9002313.56,120.07,0)
SITE FAX^F^^ADDR;7^K:$L(X)>20!($L(X)<1) X
"^DD",9002313.56,9002313.56,120.07,3)
Answer must be 1-20 characters in length.
"^DD",9002313.56,9002313.56,120.07,21,0)
^^1^1^3010331^
"^DD",9002313.56,9002313.56,120.07,21,1,0)
For NCPDP claim forms.
"^DD",9002313.56,9002313.56,120.07,"DT")
3010331
"^DD",9002313.56,9002313.56,130.01,0)
REMITTANCE ADDRESS NAME^RF^^REMIT;1^K:$L(X)>40!($L(X)<1) X
"^DD",9002313.56,9002313.56,130.01,3)
Answer must be 1-40 characters in length.
"^DD",9002313.56,9002313.56,130.01,21,0)
^.001^1^1^3040607^^
"^DD",9002313.56,9002313.56,130.01,21,1,0)
Pharmacy Business Name
"^DD",9002313.56,9002313.56,130.01,"DT")
3040607
"^DD",9002313.56,9002313.56,130.02,0)
REMIT ADDRESS 1^RF^^REMIT;2^K:$L(X)>25!($L(X)<1) X
"^DD",9002313.56,9002313.56,130.02,3)
Answer must be 1-25 characters in length.
"^DD",9002313.56,9002313.56,130.02,21,0)
^.001^1^1^3040607^^
"^DD",9002313.56,9002313.56,130.02,21,1,0)
Street Address (Line 1) for the Remittance Address.
"^DD",9002313.56,9002313.56,130.02,"DT")
3040607
"^DD",9002313.56,9002313.56,130.03,0)
REMIT ADDRESS 2^F^^REMIT;3^K:$L(X)>25!($L(X)<1) X
"^DD",9002313.56,9002313.56,130.03,3)
Answer must be 1-25 characters in length
"^DD",9002313.56,9002313.56,130.03,21,0)
^^1^1^3040326^
"^DD",9002313.56,9002313.56,130.03,21,1,0)
Street Address (Line 2) for the Remittance Address.
"^DD",9002313.56,9002313.56,130.03,"DT")
3040326
"^DD",9002313.56,9002313.56,130.04,0)
REMIT DWELLING NUMBER^F^^REMIT;4^K:$L(X)>8!($L(X)<1) X
"^DD",9002313.56,9002313.56,130.04,3)
Answer must be 1-8 characters in length.
"^DD",9002313.56,9002313.56,130.04,21,0)
^.001^1^1^3031222^^
"^DD",9002313.56,9002313.56,130.04,21,1,0)
Enter the dwelling number for the claim remittance address.
"^DD",9002313.56,9002313.56,130.04,"DT")
3031222
"^DD",9002313.56,9002313.56,130.07,0)
REMIT STATE^RP5'^DIC(5,^REMIT;7^Q
"^DD",9002313.56,9002313.56,130.07,3)
Select the State from which submissions from this pharmacy are located.
"^DD",9002313.56,9002313.56,130.07,21,0)
^.001^1^1^3040607^^^
"^DD",9002313.56,9002313.56,130.07,21,1,0)
Enter the state for the claim remittance address.
"^DD",9002313.56,9002313.56,130.07,"DT")
3040607
"^DD",9002313.56,9002313.56,130.08,0)
REMIT ZIP^RF^^REMIT;8^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.56,9002313.56,130.08,3)
Answer must be 1-10 characters in length.
"^DD",9002313.56,9002313.56,130.08,21,0)
^.001^1^1^3040607^^^
"^DD",9002313.56,9002313.56,130.08,21,1,0)
Enter the zip for the claim remittance address.
"^DD",9002313.56,9002313.56,130.08,"DT")
3040607
"^DD",9002313.56,9002313.56,130.5,0)
REMIT OTHER DESIGNATION^F^^REMIT;5^K:$L(X)>8!($L(X)<1) X
"^DD",9002313.56,9002313.56,130.5,3)
Answer must be 1-8 characters in length.
"^DD",9002313.56,9002313.56,130.5,21,0)
^.001^1^1^3031222^^
"^DD",9002313.56,9002313.56,130.5,21,1,0)
Enter the other designation for the claim remittance address.
"^DD",9002313.56,9002313.56,130.5,"DT")
3031222
"^DD",9002313.56,9002313.56,130.6,0)
REMIT CITY^RF^^REMIT;6^K:$L(X)>25!($L(X)<1) X
"^DD",9002313.56,9002313.56,130.6,3)
Answer must be 1-25 characters in length.
"^DD",9002313.56,9002313.56,130.6,21,0)
^.001^1^1^3040607^^^
"^DD",9002313.56,9002313.56,130.6,21,1,0)
Enter the city for the claim remittance address.
"^DD",9002313.56,9002313.56,130.6,"DT")
3040607
"^DD",9002313.56,9002313.56,1830.01,0)
CONTACT NAMES^F^^REP;1^K:$L(X)>100!($L(X)<1) X
"^DD",9002313.56,9002313.56,1830.01,3)
Answer must be 1-100 characters in length.
"^DD",9002313.56,9002313.56,1830.01,21,0)
^^4^4^3000420^
"^DD",9002313.56,9002313.56,1830.01,21,1,0)
You may enter more than one name, separated by "/".
"^DD",9002313.56,9002313.56,1830.01,21,2,0)
Put corresponding phone numbers separated by "/" in the phone number field.
"^DD",9002313.56,9002313.56,1830.01,21,3,0)
A random name-phone combination will appear on each bill and that way
"^DD",9002313.56,9002313.56,1830.01,21,4,0)
the calls get distributed evenly.
"^DD",9002313.56,9002313.56,1830.01,"DT")
3000420
"^DD",9002313.56,9002313.56,1830.02,0)
CONTACT PHONES^F^^REP;2^K:$L(X)>100!($L(X)<1) X
"^DD",9002313.56,9002313.56,1830.02,3)
Answer must be 1-100 characters in length.
"^DD",9002313.56,9002313.56,1830.02,21,0)
^^1^1^3000420^
"^DD",9002313.56,9002313.56,1830.02,21,1,0)
(See CONTACT NAMES description for details about "/"-separated list.)
"^DD",9002313.56,9002313.56,1830.02,"DT")
3000420
"^DD",9002313.56,9002313.56,1900.01,0)
VA CONTACT^RP200'^VA(200,^REP;3^Q
"^DD",9002313.56,9002313.56,1900.01,3)
Pointer to the New Person file for the VA contact information.
"^DD",9002313.56,9002313.56,1900.01,21,0)
^.001^1^1^3040625^^
"^DD",9002313.56,9002313.56,1900.01,21,1,0)
Pointer to the New Person file for the VA contact person information.
"^DD",9002313.56,9002313.56,1900.01,"DT")
3040625
"^DD",9002313.56,9002313.56,1900.02,0)
VA ALTERNATE CONTACT^RP200'^VA(200,^REP;4^Q
"^DD",9002313.56,9002313.56,1900.02,3)
Pointer to the New Person file for the Alternate VA contact.
"^DD",9002313.56,9002313.56,1900.02,21,0)
^^2^2^3080617^
"^DD",9002313.56,9002313.56,1900.02,21,1,0)
This is the alternate site contact name to be contacted if site setup 
"^DD",9002313.56,9002313.56,1900.02,21,2,0)
problems are identified.
"^DD",9002313.56,9002313.56,1900.02,"DT")
3080617
"^DD",9002313.56,9002313.56,1900.03,0)
VA LEAD PHARMACIST^RP200'^VA(200,^REP;5^Q
"^DD",9002313.56,9002313.56,1900.03,3)
Pointer to the New Person file for the lead Pharmacists.
"^DD",9002313.56,9002313.56,1900.03,21,0)
^.001^1^1^3040607^^
"^DD",9002313.56,9002313.56,1900.03,21,1,0)
Pointer to the New Person file for the lead Pharmacists. 
"^DD",9002313.56,9002313.56,1900.03,"DT")
3040607
"^DD",9002313.56,9002313.56,1900.04,0)
VA LEAD PHARMACIST LICENSE #^F^^REP1;1^K:$L(X)>40!($L(X)<1) X
"^DD",9002313.56,9002313.56,1900.04,3)
Answer must be 1-40 characters in length.
"^DD",9002313.56,9002313.56,1900.04,21,0)
^^2^2^3080617^
"^DD",9002313.56,9002313.56,1900.04,21,1,0)
The lead pharmacist license number will be used as a default on ePharmacy 
"^DD",9002313.56,9002313.56,1900.04,21,2,0)
claims.
"^DD",9002313.56,9002313.56,1900.04,"DT")
3080617
"^DD",9002313.56,9002313.56,13800,0)
OUTPATIENT SITE^9002313.5601P^^OPSITE;0
"^DD",9002313.56,9002313.56,13800,3)
Answer with OUTPATIENT SITE NAME
"^DD",9002313.56,9002313.5601,0)
OUTPATIENT SITE SUB-FIELD^^.01^1
"^DD",9002313.56,9002313.5601,0,"DT")
3070207
"^DD",9002313.56,9002313.5601,0,"IX","B",9002313.5601,.01)

"^DD",9002313.56,9002313.5601,0,"NM","OUTPATIENT SITE")

"^DD",9002313.56,9002313.5601,0,"UP")
9002313.56
"^DD",9002313.56,9002313.5601,.01,0)
OUTPATIENT SITE^MP59'X^PS(59,^0;1^I $D(^BPS(9002313.56,"C",X)) D EN^DDIOL("** This site already linked.") K X
"^DD",9002313.56,9002313.5601,.01,1,0)
^.1^^-1
"^DD",9002313.56,9002313.5601,.01,1,1,0)
9002313.5601^B
"^DD",9002313.56,9002313.5601,.01,1,1,1)
S ^BPS(9002313.56,DA(1),"OPSITE","B",$E(X,1,30),DA)=""
"^DD",9002313.56,9002313.5601,.01,1,1,2)
K ^BPS(9002313.56,DA(1),"OPSITE","B",$E(X,1,30),DA)
"^DD",9002313.56,9002313.5601,.01,1,2,0)
9002313.56^C
"^DD",9002313.56,9002313.5601,.01,1,2,1)
S ^BPS(9002313.56,"C",$E(X,1,30),DA(1),DA)=""
"^DD",9002313.56,9002313.5601,.01,1,2,2)
K ^BPS(9002313.56,"C",$E(X,1,30),DA(1),DA)
"^DD",9002313.56,9002313.5601,.01,1,2,"DT")
3010119
"^DD",9002313.56,9002313.5601,.01,3)
Enter one or more OUTPATIENT SITES to associate with this ECME Pharmacy entry.
"^DD",9002313.56,9002313.5601,.01,21,0)
^.001^2^2^3070207^^^
"^DD",9002313.56,9002313.5601,.01,21,1,0)
One or more of the VISTA pharmacy package's Outpatient Sites (File 59) 
"^DD",9002313.56,9002313.5601,.01,21,2,0)
must be associated with the ECME Pharmacy entry.
"^DD",9002313.56,9002313.5601,.01,"DT")
3060621
"^DD",9002313.57,9002313.57,0)
FIELD^^19^221
"^DD",9002313.57,9002313.57,0,"DDA")
N
"^DD",9002313.57,9002313.57,0,"DT")
3080319
"^DD",9002313.57,9002313.57,0,"IX","AC",9002313.57,5)

"^DD",9002313.57,9002313.57,0,"IX","AE",9002313.57,3)

"^DD",9002313.57,9002313.57,0,"IX","AER",9002313.57,401)

"^DD",9002313.57,9002313.57,0,"IX","AF",9002313.57,4)

"^DD",9002313.57,9002313.57,0,"IX","AFR",9002313.57,402)

"^DD",9002313.57,9002313.57,0,"IX","AG",9002313.57,13)

"^DD",9002313.57,9002313.57,0,"IX","AH",9002313.57,7)

"^DD",9002313.57,9002313.57,0,"IX","AS",9002313.57,17)

"^DD",9002313.57,9002313.57,0,"IX","B",9002313.57,.01)

"^DD",9002313.57,9002313.57,0,"NM","BPS LOG OF TRANSACTIONS")

"^DD",9002313.57,9002313.57,0,"VRPK")
BPS
"^DD",9002313.57,9002313.57,.01,0)
ENTRY NUMBER^RF^^0;1^K:$L(X)>20!($L(X)<1) X
"^DD",9002313.57,9002313.57,.01,1,0)
^.1
"^DD",9002313.57,9002313.57,.01,1,1,0)
9002313.57^B
"^DD",9002313.57,9002313.57,.01,1,1,1)
S ^BPSTL("B",$E(X,1,30),DA)=""
"^DD",9002313.57,9002313.57,.01,1,1,2)
K ^BPSTL("B",$E(X,1,30),DA)
"^DD",9002313.57,9002313.57,.01,3)
Answer must be 1-20 characters in length
"^DD",9002313.57,9002313.57,.01,21,0)
^^1^1^3031208^
"^DD",9002313.57,9002313.57,.01,21,1,0)
Sequential entry number
"^DD",9002313.57,9002313.57,.01,"DT")
3080212
"^DD",9002313.57,9002313.57,1,0)
STATUS^NJ2,0^^0;2^K:+X'=X!(X>99)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.57,9002313.57,1,1,0)
^.1^^0
"^DD",9002313.57,9002313.57,1,3)
Type a Number between 0 and 99, 0 Decimal Digits
"^DD",9002313.57,9002313.57,1,21,0)
^^5^5^3070227^
"^DD",9002313.57,9002313.57,1,21,1,0)
The status of the transaction as a percentage of completion.  The text 
"^DD",9002313.57,9002313.57,1,21,2,0)
value can be obtained by running $$STATI^BPSOSU(<Status Number>).  Note 
"^DD",9002313.57,9002313.57,1,21,3,0)
that 99 indicates complete.  Since records are only copied to BPS Log of 
"^DD",9002313.57,9002313.57,1,21,4,0)
Transactions when transactions are complete, all records in this file 
"^DD",9002313.57,9002313.57,1,21,5,0)
should be 99.
"^DD",9002313.57,9002313.57,1,"DT")
3080613
"^DD",9002313.57,9002313.57,1.07,0)
PHARMACY^P9002313.56'^BPS(9002313.56,^1;7^Q
"^DD",9002313.57,9002313.57,1.07,3)
Select the BPS PHARMACY this Transaction Log relates to.
"^DD",9002313.57,9002313.57,1.07,21,0)
^^1^1^3080212^
"^DD",9002313.57,9002313.57,1.07,21,1,0)
Textual description of the Pharmacy involved with this transaction.
"^DD",9002313.57,9002313.57,1.07,"DT")
3080212
"^DD",9002313.57,9002313.57,1.08,0)
PINS PIECE^NJ1,0^^1;8^K:+X'=X!(X>9)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.57,9002313.57,1.08,3)
Type a Number between 1 and 9, 0 Decimal Digits
"^DD",9002313.57,9002313.57,1.08,21,0)
^^5^5^3080613^
"^DD",9002313.57,9002313.57,1.08,21,1,0)
Pointer to which of the PINS pieces in ^(6) is in use for this claim.  Use
"^DD",9002313.57,9002313.57,1.08,21,2,0)
this to keep track of where you are in billing down the line to various
"^DD",9002313.57,9002313.57,1.08,21,3,0)
insurers.   (Probably won't automatically roll over to next insurer, but
"^DD",9002313.57,9002313.57,1.08,21,4,0)
maybe we will have an option to edit insurance info, try next insurance,
"^DD",9002313.57,9002313.57,1.08,21,5,0)
etc.)
"^DD",9002313.57,9002313.57,1.08,"DT")
3080613
"^DD",9002313.57,9002313.57,1.09,0)
PRIOR AUTHORIZATION NUMBER^F^^1;9^K:$L(X)>11!($L(X)<1) X
"^DD",9002313.57,9002313.57,1.09,3)
Enter the prior authorization number (1-11 characters)
"^DD",9002313.57,9002313.57,1.09,21,0)
^^2^2^3070221^
"^DD",9002313.57,9002313.57,1.09,21,1,0)
Number assigned by the processor to identify a prior authorized
"^DD",9002313.57,9002313.57,1.09,21,2,0)
transaction.
"^DD",9002313.57,9002313.57,1.09,"DT")
3080319
"^DD",9002313.57,9002313.57,1.11,0)
PRESCRIPTION NUMBER^P52'^PSRX(^1;11^Q
"^DD",9002313.57,9002313.57,1.11,3)
Answer with PRESCRIPTION RX #
"^DD",9002313.57,9002313.57,1.11,21,0)
^^1^1^3080212^
"^DD",9002313.57,9002313.57,1.11,21,1,0)
Prescription number for this BPS Transactions.
"^DD",9002313.57,9002313.57,1.11,"DT")
3080212
"^DD",9002313.57,9002313.57,1.1199,0)
RXI INTERNAL^CJ8^^ ; ^S Y(9002313.57,1.1199,1)=$S($D(^BPSTL(D0,1)):^(1),1:"") S X=$P(Y(9002313.57,1.1199,1),U,11),X=X
"^DD",9002313.57,9002313.57,1.1199,9)
^
"^DD",9002313.57,9002313.57,1.1199,9.01)
9002313.57^1.11
"^DD",9002313.57,9002313.57,1.1199,9.1)
INTERNAL(PRESCRIPTION NUMBER)
"^DD",9002313.57,9002313.57,1.1199,21,0)
^.001^1^1^3080212^^
"^DD",9002313.57,9002313.57,1.1199,21,1,0)
Internal ID to the claims file.
"^DD",9002313.57,9002313.57,1.1199,"DT")
3080212
"^DD",9002313.57,9002313.57,1.12,0)
RESUBMIT AFTER REVERSAL^S^0:DONE;1:RESUBMIT AFTER REVERSAL;2:RESUBMITTING;^1;12^Q
"^DD",9002313.57,9002313.57,1.12,3)
Enter the status of the resubmit
"^DD",9002313.57,9002313.57,1.12,21,0)
^^1^1^3031216^
"^DD",9002313.57,9002313.57,1.12,21,1,0)
Indicator that a transaction has been resubmitted after being backed out.
"^DD",9002313.57,9002313.57,1.12,"DT")
3051213
"^DD",9002313.57,9002313.57,1.13,0)
NCPDP OVERRIDES^P9002313.511'^BPS(9002313.511,^1;13^Q
"^DD",9002313.57,9002313.57,1.13,3)
Select the BPS NCPDP OVERRIDE (test accounts only).
"^DD",9002313.57,9002313.57,1.13,21,0)
^^2^2^3040120^
"^DD",9002313.57,9002313.57,1.13,21,1,0)
Pointer to the overrides file for any fields that are not straight 
"^DD",9002313.57,9002313.57,1.13,21,2,0)
forward, but are required by the payer.
"^DD",9002313.57,9002313.57,1.13,"DT")
3010330
"^DD",9002313.57,9002313.57,1.15,0)
PRIOR AUTHORIZATION TYPE CODE^F^^1;15^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.57,9002313.57,1.15,3)
Enter the prior authorization type (1-2 characters)
"^DD",9002313.57,9002313.57,1.15,21,0)
^^1^1^3070221^
"^DD",9002313.57,9002313.57,1.15,21,1,0)
Indicates the type of authorization made before transaction was submitted.
"^DD",9002313.57,9002313.57,1.15,"DT")
3070314
"^DD",9002313.57,9002313.57,3,0)
CLAIM^P9002313.02'^BPSC(^0;4^Q
"^DD",9002313.57,9002313.57,3,1,0)
^.1
"^DD",9002313.57,9002313.57,3,1,1,0)
9002313.57^AE
"^DD",9002313.57,9002313.57,3,1,1,1)
S ^BPSTL("AE",$E(X,1,30),DA)=""
"^DD",9002313.57,9002313.57,3,1,1,2)
K ^BPSTL("AE",$E(X,1,30),DA)
"^DD",9002313.57,9002313.57,3,1,1,"DT")
3001111
"^DD",9002313.57,9002313.57,3,3)
Answer with BPS CLAIMS CLAIM ID
"^DD",9002313.57,9002313.57,3,21,0)
^^1^1^3031216^
"^DD",9002313.57,9002313.57,3,21,1,0)
Claim number 
"^DD",9002313.57,9002313.57,3,"DT")
3001111
"^DD",9002313.57,9002313.57,3.1,0)
CLAIM IEN^CJ8^^ ; ^S Y(9002313.57,3.1,1)=$S($D(^BPSTL(D0,0)):^(0),1:"") S X=$P(Y(9002313.57,3.1,1),U,4),X=X
"^DD",9002313.57,9002313.57,3.1,9)
^
"^DD",9002313.57,9002313.57,3.1,9.01)
9002313.57^3
"^DD",9002313.57,9002313.57,3.1,9.1)
INTERNAL(CLAIM)
"^DD",9002313.57,9002313.57,3.1,21,0)
^^1^1^3031216^
"^DD",9002313.57,9002313.57,3.1,21,1,0)
Pointer to the BPS claims file - 9002313.02
"^DD",9002313.57,9002313.57,4,0)
RESPONSE^P9002313.03'^BPSR(^0;5^Q
"^DD",9002313.57,9002313.57,4,1,0)
^.1
"^DD",9002313.57,9002313.57,4,1,1,0)
9002313.57^AF
"^DD",9002313.57,9002313.57,4,1,1,1)
S ^BPSTL("AF",$E(X,1,30),DA)=""
"^DD",9002313.57,9002313.57,4,1,1,2)
K ^BPSTL("AF",$E(X,1,30),DA)
"^DD",9002313.57,9002313.57,4,1,1,"DT")
3001111
"^DD",9002313.57,9002313.57,4,3)
Answer with BPS RESPONSES
"^DD",9002313.57,9002313.57,4,21,0)
^^1^1^3031216^
"^DD",9002313.57,9002313.57,4,21,1,0)
Pointer to the corresponding response in the response file, 9002313.03
"^DD",9002313.57,9002313.57,4,"DT")
3001111
"^DD",9002313.57,9002313.57,4.0098,0)
RESULT WITH REVERSAL^CJ20^^ ; ^S X=$$CATEG^BPSOSUC(D0,1)
"^DD",9002313.57,9002313.57,4.0098,9)
^
"^DD",9002313.57,9002313.57,4.0098,9.01)

"^DD",9002313.57,9002313.57,4.0098,9.1)
S X=$$CATEG^BPSOSUC(D0,1)
"^DD",9002313.57,9002313.57,4.0098,21,0)
^^1^1^3031216^
"^DD",9002313.57,9002313.57,4.0098,21,1,0)
Result if the claim had to be reversed for whatever reason.
"^DD",9002313.57,9002313.57,4.0099,0)
RESULT^CJ20^^ ; ^S X=$$CATEG^BPSOSUC(D0)
"^DD",9002313.57,9002313.57,4.0099,9)
^
"^DD",9002313.57,9002313.57,4.0099,9.01)

"^DD",9002313.57,9002313.57,4.0099,9.1)
S X=$$CATEG^BPSOSUC(D0)
"^DD",9002313.57,9002313.57,4.0099,21,0)
^^1^1^3080212^
"^DD",9002313.57,9002313.57,4.0099,21,1,0)
Result from the payer - maybe be Paid, rejected, captured or accepted.
"^DD",9002313.57,9002313.57,4.0099,"DT")
3080212
"^DD",9002313.57,9002313.57,4.1,0)
RESPONSE IEN^CJ8^^ ; ^S Y(9002313.57,4.1,1)=$S($D(^BPSTL(D0,0)):^(0),1:"") S X=$P(Y(9002313.57,4.1,1),U,5),X=X
"^DD",9002313.57,9002313.57,4.1,9)
^
"^DD",9002313.57,9002313.57,4.1,9.01)
9002313.57^4
"^DD",9002313.57,9002313.57,4.1,9.1)
INTERNAL(RESPONSE)
"^DD",9002313.57,9002313.57,4.1,21,0)
^^1^1^3031216^
"^DD",9002313.57,9002313.57,4.1,21,1,0)
Response file record number of any reversals.
"^DD",9002313.57,9002313.57,5,0)
PATIENT^P2'^DPT(^0;6^Q
"^DD",9002313.57,9002313.57,5,1,0)
^.1
"^DD",9002313.57,9002313.57,5,1,1,0)
9002313.57^AC
"^DD",9002313.57,9002313.57,5,1,1,1)
S ^BPSTL("AC",$E(X,1,30),DA)=""
"^DD",9002313.57,9002313.57,5,1,1,2)
K ^BPSTL("AC",$E(X,1,30),DA)
"^DD",9002313.57,9002313.57,5,1,1,"DT")
3001111
"^DD",9002313.57,9002313.57,5,3)
Answer with PATIENT NAME
"^DD",9002313.57,9002313.57,5,21,0)
^^1^1^3040126^
"^DD",9002313.57,9002313.57,5,21,1,0)
The patient this transaction refers to.
"^DD",9002313.57,9002313.57,5,"DT")
3031216
"^DD",9002313.57,9002313.57,6,0)
SUBMIT DATE^D^^0;7^S %DT="ESTXR" D ^%DT S X=Y K:X<1 X
"^DD",9002313.57,9002313.57,6,3)
Enter the date/time that the claim was submitted
"^DD",9002313.57,9002313.57,6,21,0)
^^1^1^3070207^
"^DD",9002313.57,9002313.57,6,21,1,0)
This is the date/time that the claim was submitted to ECME.
"^DD",9002313.57,9002313.57,6,"DT")
3080613
"^DD",9002313.57,9002313.57,7,0)
LAST UPDATE^D^^0;8^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.57,9002313.57,7,1,0)
^.1
"^DD",9002313.57,9002313.57,7,1,1,0)
9002313.57^AH
"^DD",9002313.57,9002313.57,7,1,1,1)
S ^BPSTL("AH",$E(X,1,30),DA)=""
"^DD",9002313.57,9002313.57,7,1,1,2)
K ^BPSTL("AH",$E(X,1,30),DA)
"^DD",9002313.57,9002313.57,7,1,1,"DT")
3001111
"^DD",9002313.57,9002313.57,7,3)
Enter the date/time this Transaction Log was last updated.
"^DD",9002313.57,9002313.57,7,21,0)
^^2^2^3000418^
"^DD",9002313.57,9002313.57,7,21,1,0)
Date/time the POS transaction completed processing,
"^DD",9002313.57,9002313.57,7,21,2,0)
as copied from 9002313.59 at the time the .57 record was created.
"^DD",9002313.57,9002313.57,7,"DT")
3001111
"^DD",9002313.57,9002313.57,9,0)
FILL NUMBER^NJ2,0^^1;1^K:+X'=X!(X>99)!(X<0)!(X?.E1"."1.N) X
"^DD",9002313.57,9002313.57,9,3)
Type a number between 0 and 99, 0 Decimal Digits
"^DD",9002313.57,9002313.57,9,21,0)
^^1^1^3080212^
"^DD",9002313.57,9002313.57,9,21,1,0)
Prescription fill/refill number.
"^DD",9002313.57,9002313.57,9,"DT")
3080212
"^DD",9002313.57,9002313.57,10,0)
NDC^F^^1;2^K:$L(X)>12!($L(X)<1) X
"^DD",9002313.57,9002313.57,10,3)
Answer must be 1-12 characters in length.
"^DD",9002313.57,9002313.57,10,21,0)
^^1^1^3040126^
"^DD",9002313.57,9002313.57,10,21,1,0)
NDC number referenced in this transaction.
"^DD",9002313.57,9002313.57,10,"DT")
3080212
"^DD",9002313.57,9002313.57,10.0099,0)
USER NUMBER^CJ8^^ ; ^S Y(9002313.57,10.0099,1)=$S($D(^BPSTL(D0,0)):^(0),1:"") S X=$P(Y(9002313.57,10.0099,1),U,10),X=X
"^DD",9002313.57,9002313.57,10.0099,9)
^
"^DD",9002313.57,9002313.57,10.0099,9.01)
9002313.57^13
"^DD",9002313.57,9002313.57,10.0099,9.1)
INTERNAL(USER)
"^DD",9002313.57,9002313.57,10.0099,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57,10.0099,21,1,0)
IEN of the user generating the transaction
"^DD",9002313.57,9002313.57,10.0099,"DT")
3080212
"^DD",9002313.57,9002313.57,11,0)
PHARMACY DIVISION^P59'^PS(59,^1;4^Q
"^DD",9002313.57,9002313.57,11,3)
Select the division for this transaction.
"^DD",9002313.57,9002313.57,11,21,0)
^^1^1^3080212^
"^DD",9002313.57,9002313.57,11,21,1,0)
Division this transaction is for.
"^DD",9002313.57,9002313.57,11,"DT")
3080212
"^DD",9002313.57,9002313.57,13,0)
USER^P200'^VA(200,^0;10^Q
"^DD",9002313.57,9002313.57,13,1,0)
^.1
"^DD",9002313.57,9002313.57,13,1,1,0)
9002313.57^AG
"^DD",9002313.57,9002313.57,13,1,1,1)
S ^BPSTL("AG",$E(X,1,30),DA)=""
"^DD",9002313.57,9002313.57,13,1,1,2)
K ^BPSTL("AG",$E(X,1,30),DA)
"^DD",9002313.57,9002313.57,13,1,1,"DT")
3001111
"^DD",9002313.57,9002313.57,13,3)
Answer with NEW PERSON NAME
"^DD",9002313.57,9002313.57,13,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57,13,21,1,0)
Who created the ECME claim
"^DD",9002313.57,9002313.57,13,"DT")
3001111
"^DD",9002313.57,9002313.57,14,0)
POSITION IN CLAIM^NJ1,0^^0;9^K:+X'=X!(X>9)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.57,9002313.57,14,3)
Type a Number between 1 and 9, 0 Decimal Digits
"^DD",9002313.57,9002313.57,14,21,0)
^^1^1^3000418^
"^DD",9002313.57,9002313.57,14,21,1,0)
This is the D1 subscript into 9002313.02 and .03
"^DD",9002313.57,9002313.57,14,"DT")
3000418
"^DD",9002313.57,9002313.57,15,0)
START TIME^D^^0;11^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.57,9002313.57,15,3)
Enter the start Date/Time for this log entry.
"^DD",9002313.57,9002313.57,15,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57,15,21,1,0)
Time, including the seconds that the transaction was initiated.
"^DD",9002313.57,9002313.57,15,"DT")
3000418
"^DD",9002313.57,9002313.57,16,0)
SUBMIT REQUEST^P9002313.77'^BPS(9002313.77,^0;12^Q
"^DD",9002313.57,9002313.57,16,3)
Answer with BPS REQUESTS RX NUMBER
"^DD",9002313.57,9002313.57,16,21,0)
^^1^1^3071121^
"^DD",9002313.57,9002313.57,16,21,1,0)
IEN of the BPS REQUEST file (#9002313.77)
"^DD",9002313.57,9002313.57,16,"DT")
3071212
"^DD",9002313.57,9002313.57,17,0)
SUBMIT REQUEST DATE TIME^D^^0;13^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.57,9002313.57,17,1,0)
^.1
"^DD",9002313.57,9002313.57,17,1,1,0)
9002313.57^AS
"^DD",9002313.57,9002313.57,17,1,1,1)
S ^BPSTL("AS",$E(X,1,30),DA)=""
"^DD",9002313.57,9002313.57,17,1,1,2)
K ^BPSTL("AS",$E(X,1,30),DA)
"^DD",9002313.57,9002313.57,17,1,1,"%D",0)
^^2^2^3071105^
"^DD",9002313.57,9002313.57,17,1,1,"%D",1,0)
Submit Request Date/Time cross-reference - when the request was placed to 
"^DD",9002313.57,9002313.57,17,1,1,"%D",2,0)
the queue.
"^DD",9002313.57,9002313.57,17,1,1,"DT")
3071105
"^DD",9002313.57,9002313.57,17,3)
Enter the date/time this request was submitted.
"^DD",9002313.57,9002313.57,17,21,0)
^^1^1^3071102^
"^DD",9002313.57,9002313.57,17,21,1,0)
Submit Request Date/Time
"^DD",9002313.57,9002313.57,17,"DT")
3071212
"^DD",9002313.57,9002313.57,18,0)
COB INDICATOR^S^1:PRIMARY;2:SECONDARY;3:TERTIARY;^0;14^Q
"^DD",9002313.57,9002313.57,18,3)
Specify the Coordination of Benefits
"^DD",9002313.57,9002313.57,18,21,0)
^^1^1^3080319^
"^DD",9002313.57,9002313.57,18,21,1,0)
COB indicator.
"^DD",9002313.57,9002313.57,18,"DT")
3080319
"^DD",9002313.57,9002313.57,19,0)
TRANSACTION TYPE^S^C:CLAIM;U:UNCLAIM;^0;15^Q
"^DD",9002313.57,9002313.57,19,3)
Specify they type, C=Billed/U=Reverse
"^DD",9002313.57,9002313.57,19,21,0)
^^3^3^3080319^
"^DD",9002313.57,9002313.57,19,21,1,0)
Type of transaction 
"^DD",9002313.57,9002313.57,19,21,2,0)
CLAIM - to submit a claim to the payer 
"^DD",9002313.57,9002313.57,19,21,3,0)
UNCLAIM - to submit a reversal for the previously paid claim
"^DD",9002313.57,9002313.57,19,"DT")
3080319
"^DD",9002313.57,9002313.57,111,0)
COMMENT MULTIPLE^9002313.57111DA^^11;0
"^DD",9002313.57,9002313.57,111,21,0)
^.001^1^1^3050629^^
"^DD",9002313.57,9002313.57,111,21,1,0)
User's comment
"^DD",9002313.57,9002313.57,111,"DT")
3050627
"^DD",9002313.57,9002313.57,201,0)
RESULT CODE^NJ11,7^^2;1^K:+X'=X!(X>999.999)!(X<0)!(X?.E1"."8.N) X
"^DD",9002313.57,9002313.57,201,3)
Type a number between 0 and 999.999, 7 Decimal Digits
"^DD",9002313.57,9002313.57,201,21,0)
^^2^2^3040322^
"^DD",9002313.57,9002313.57,201,21,1,0)
Code indicating whether the claim was successfully
"^DD",9002313.57,9002313.57,201,21,2,0)
billed or rejected.
"^DD",9002313.57,9002313.57,201,"DT")
3080319
"^DD",9002313.57,9002313.57,202,0)
RESULT TEXT^F^^2;2^K:$L(X)>222!($L(X)<1) X
"^DD",9002313.57,9002313.57,202,3)
Answer must be 1-222 characters in length.
"^DD",9002313.57,9002313.57,202,21,0)
^^2^2^3031208^
"^DD",9002313.57,9002313.57,202,21,1,0)
Textual description of the reason for rejection, if the claim was 
"^DD",9002313.57,9002313.57,202,21,2,0)
rejected.
"^DD",9002313.57,9002313.57,202,"DT")
3000418
"^DD",9002313.57,9002313.57,401,0)
REVERSAL CLAIM^P9002313.02'^BPSC(^4;1^Q
"^DD",9002313.57,9002313.57,401,1,0)
^.1
"^DD",9002313.57,9002313.57,401,1,1,0)
9002313.57^AER
"^DD",9002313.57,9002313.57,401,1,1,1)
S ^BPSTL("AER",$E(X,1,30),DA)=""
"^DD",9002313.57,9002313.57,401,1,1,2)
K ^BPSTL("AER",$E(X,1,30),DA)
"^DD",9002313.57,9002313.57,401,1,1,"DT")
3001111
"^DD",9002313.57,9002313.57,401,3)
Answer with BPS CLAIMS CLAIM ID
"^DD",9002313.57,9002313.57,401,21,0)
^^2^2^3031217^
"^DD",9002313.57,9002313.57,401,21,1,0)
Pointer to file 9002313.02 BPS CLAIMS file for the reversal
"^DD",9002313.57,9002313.57,401,21,2,0)
transaction.
"^DD",9002313.57,9002313.57,401,"DT")
3001111
"^DD",9002313.57,9002313.57,402,0)
REVERSAL RESPONSE^P9002313.03'^BPSR(^4;2^Q
"^DD",9002313.57,9002313.57,402,1,0)
^.1
"^DD",9002313.57,9002313.57,402,1,1,0)
9002313.57^AFR
"^DD",9002313.57,9002313.57,402,1,1,1)
S ^BPSTL("AFR",$E(X,1,30),DA)=""
"^DD",9002313.57,9002313.57,402,1,1,2)
K ^BPSTL("AFR",$E(X,1,30),DA)
"^DD",9002313.57,9002313.57,402,1,1,"DT")
3001111
"^DD",9002313.57,9002313.57,402,3)
Answer with BPS RESPONSES
"^DD",9002313.57,9002313.57,402,21,0)
^^2^2^3031217^
"^DD",9002313.57,9002313.57,402,21,1,0)
Pointer to the BPS responses file 9002313.03 for the 
"^DD",9002313.57,9002313.57,402,21,2,0)
reversal response.
"^DD",9002313.57,9002313.57,402,"DT")
3001111
"^DD",9002313.57,9002313.57,404,0)
REVERSAL REASON^F^^4;4^K:$L(X)>40!($L(X)<1) X
"^DD",9002313.57,9002313.57,404,3)
Answer must be 1-40 characters in length
"^DD",9002313.57,9002313.57,404,21,0)
^^1^1^3050525^
"^DD",9002313.57,9002313.57,404,21,1,0)
Reason for the reversal
"^DD",9002313.57,9002313.57,404,"DT")
3050525
"^DD",9002313.57,9002313.57,405,0)
REVERSAL REQUEST^P9002313.77'^BPS(9002313.77,^4;5^Q
"^DD",9002313.57,9002313.57,405,3)
Answer with BPS REQUESTS RX NUMBER
"^DD",9002313.57,9002313.57,405,21,0)
^^1^1^3071102^
"^DD",9002313.57,9002313.57,405,21,1,0)
Reversal Request IEN
"^DD",9002313.57,9002313.57,405,"DT")
3071212
"^DD",9002313.57,9002313.57,406,0)
REVERSAL REQUEST DATE TIME^D^^4;6^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.57,9002313.57,406,1,0)
^.1^^0
"^DD",9002313.57,9002313.57,406,3)
Enter the Date/Time of this Reversal
"^DD",9002313.57,9002313.57,406,21,0)
^.001^1^1^3071102^^
"^DD",9002313.57,9002313.57,406,21,1,0)
Reversal Request Date/Time
"^DD",9002313.57,9002313.57,406,"DT")
3071212
"^DD",9002313.57,9002313.57,501,0)
QUANTITY^NJ12,3^^5;1^K:+X'=X!(X>99999999)!(X<0)!(X?.E1"."4.N) X
"^DD",9002313.57,9002313.57,501,3)
Type a number between 0 and 99999999, 3 Decimal Digits
"^DD",9002313.57,9002313.57,501,21,0)
^^1^1^3070625^
"^DD",9002313.57,9002313.57,501,21,1,0)
Enter the billing quantity for the prescription.
"^DD",9002313.57,9002313.57,501,"DT")
3070625
"^DD",9002313.57,9002313.57,502,0)
UNIT PRICE^NJ18,8^^5;2^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."9N.N) X
"^DD",9002313.57,9002313.57,502,3)
Type a Number between 0 and 999999999, 8 Decimal Digits
"^DD",9002313.57,9002313.57,502,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57,502,21,1,0)
Price per unit of prescription.
"^DD",9002313.57,9002313.57,502,"DT")
3000418
"^DD",9002313.57,9002313.57,503,0)
SUBTOTAL^NJ18,8^^5;3^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."9N.N) X
"^DD",9002313.57,9002313.57,503,3)
Type a Number between 0 and 999999999, 8 Decimal Digits
"^DD",9002313.57,9002313.57,503,21,0)
^^3^3^3031217^
"^DD",9002313.57,9002313.57,503,21,1,0)
= QUANTITY * UNIT PRICE This is what
"^DD",9002313.57,9002313.57,503,21,2,0)
we want to send as the INGREDIENT COST 
"^DD",9002313.57,9002313.57,503,21,3,0)
field in the NCPDP message.
"^DD",9002313.57,9002313.57,503,"DT")
3000418
"^DD",9002313.57,9002313.57,504,0)
DISPENSING FEE^NJ6,2^^5;4^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>100)!(X<0) X
"^DD",9002313.57,9002313.57,504,3)
Type a Dollar Amount between 0 and 100, 2 Decimal Digits
"^DD",9002313.57,9002313.57,504,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57,504,21,1,0)
Service fee the pharmacy charges for dispensing the drug.
"^DD",9002313.57,9002313.57,504,"DT")
3000418
"^DD",9002313.57,9002313.57,505,0)
TOTAL PRICE^NJ12,2^^5;5^K:+X'=X!(X>999999999)!(X<0)!(X?.E1"."3N.N) X
"^DD",9002313.57,9002313.57,505,3)
Type a Number between 0 and 999999999, 2 Decimal Digits
"^DD",9002313.57,9002313.57,505,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57,505,21,1,0)
=SUBTOTAL + DISPENSING FEE
"^DD",9002313.57,9002313.57,505,"DT")
3000418
"^DD",9002313.57,9002313.57,507,0)
ADMINISTRATIVE FEE^F^^5;7^K:$L(X)>15!($L(X)<1) X
"^DD",9002313.57,9002313.57,507,3)
Answer must be 1-15 characters in length
"^DD",9002313.57,9002313.57,507,21,0)
^^1^1^3080212^
"^DD",9002313.57,9002313.57,507,21,1,0)
Any fee charged for handling of the paperwork.
"^DD",9002313.57,9002313.57,507,"DT")
3080212
"^DD",9002313.57,9002313.57,508,0)
UNIT OF MEASURE^F^^5;8^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.57,9002313.57,508,3)
Enter the Unit of Measure (1-2 characters)
"^DD",9002313.57,9002313.57,508,21,0)
^^2^2^3070627^
"^DD",9002313.57,9002313.57,508,21,1,0)
Enter the Unit of Measure for the drug.  This is usually GR (grams), ML 
"^DD",9002313.57,9002313.57,508,21,2,0)
(milliliters), or EA (Each).
"^DD",9002313.57,9002313.57,508,"DT")
3070627
"^DD",9002313.57,9002313.57,801,0)
ASLEEP PAYER^P9002313.15'^BPS(9002313.15,^8;1^Q
"^DD",9002313.57,9002313.57,801,3)
Specify a payer that is identified as being asleep.
"^DD",9002313.57,9002313.57,801,21,0)
^^1^1^3080613^
"^DD",9002313.57,9002313.57,801,21,1,0)
This field identifies an asleep payer for this transaction.
"^DD",9002313.57,9002313.57,801,"DT")
3080613
"^DD",9002313.57,9002313.57,901,0)
CURRENT VA INSURER^F^^9;1^K:$L(X)>15!($L(X)<1) X
"^DD",9002313.57,9002313.57,901,3)
Answer must be 1-15 characters in length.
"^DD",9002313.57,9002313.57,901,21,0)
^^2^2^3080613^
"^DD",9002313.57,9002313.57,901,21,1,0)
This field is used for the 1st patient insurance for a VA prescription and
"^DD",9002313.57,9002313.57,901,21,2,0)
it points to the payer sheet to use.
"^DD",9002313.57,9002313.57,901,"DT")
3080613
"^DD",9002313.57,9002313.57,901.04,0)
ELIGIBILITY^S^V:VETERAN;T:TRICARE;C:CHAMPVA;^9;4^Q
"^DD",9002313.57,9002313.57,901.04,3)
Enter (V)eteran, (T)ricare, or (C)hampVA.
"^DD",9002313.57,9002313.57,901.04,21,0)
^^1^1^3080613^
"^DD",9002313.57,9002313.57,901.04,21,1,0)
The insurance eligibility type of the claim.
"^DD",9002313.57,9002313.57,901.04,"DT")
3080613
"^DD",9002313.57,9002313.57,902,0)
PATIENT INSURANCE MULTIPLE^9002313.57902PA^^10;0
"^DD",9002313.57,9002313.57,902,21,0)
^^1^1^3080212^
"^DD",9002313.57,9002313.57,902,21,1,0)
List of VA insurers.
"^DD",9002313.57,9002313.57,902,"DT")
3080212
"^DD",9002313.57,9002313.57,1201,0)
RX ACTION^F^^12;1^K:$L(X)>4!($L(X)<1) X
"^DD",9002313.57,9002313.57,1201,3)
Answer must be 1-4 characters in length
"^DD",9002313.57,9002313.57,1201,21,0)
^^3^3^3050629^
"^DD",9002313.57,9002313.57,1201,21,1,0)
This is the BWHERE parameter passed into BPSNCPDP and is the action
"^DD",9002313.57,9002313.57,1201,21,2,0)
that is being performed on this RX (AREV, BB, CRLB, CRLR, CRLX, DC, DDED,
"^DD",9002313.57,9002313.57,1201,21,3,0)
DE, ED, ERES, EREV, OF, PC, PE, PL, PP, RF, RL, RN, RRL, and RS).
"^DD",9002313.57,9002313.57,1201,"DT")
3050629
"^DD",9002313.57,9002313.57,1202,0)
DATE OF SERVICE^D^^12;2^S %DT="E" D ^%DT S X=Y K:X<1 X
"^DD",9002313.57,9002313.57,1202,3)
(No range limit on date)
"^DD",9002313.57,9002313.57,1202,21,0)
^^1^1^3050525^
"^DD",9002313.57,9002313.57,1202,21,1,0)
Date used for the 401-D1 (DATE OF SERVICE) in the NCPDP transaction
"^DD",9002313.57,9002313.57,1202,"DT")
3050525
"^DD",9002313.57,9002313.57,1203,0)
SUBMISSION CLARIFICATION CODE^F^^12;3^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.57,9002313.57,1203,3)
Answer must be 1-2 characters in length.
"^DD",9002313.57,9002313.57,1203,21,0)
^.001^1^1^3070119^^
"^DD",9002313.57,9002313.57,1203,21,1,0)
Submission Clarification Code
"^DD",9002313.57,9002313.57,1203,"DT")
3070119
"^DD",9002313.57,9002313.57,1300,0)
DUR DATA^9002313.5713^^13;0
"^DD",9002313.57,9002313.57,1300,21,0)
^^3^3^3050628^
"^DD",9002313.57,9002313.57,1300,21,1,0)
This multiple will track the Drug Utilization Review (DUR) information
"^DD",9002313.57,9002313.57,1300,21,2,0)
passed by Outpatient Pharmacy to ECME and that will eventually be put
"^DD",9002313.57,9002313.57,1300,21,3,0)
in the DUR segment of the NCPDP claim.
"^DD",9002313.57,9002313.57,9999.92,0)
HRN FAC^CJ16^^ ; ^N IEN57 S IEN57=D0,X=$$HRN^BPSOS57
"^DD",9002313.57,9002313.57,9999.92,9)
^
"^DD",9002313.57,9002313.57,9999.92,9.01)

"^DD",9002313.57,9002313.57,9999.92,9.1)
N IEN57 S IEN57=D0,X=$$HRN^BPSOS57
"^DD",9002313.57,9002313.57,9999.92,21,0)
^^2^2^3080212^
"^DD",9002313.57,9002313.57,9999.92,21,1,0)
Health record number and facility ID - this is set to the pointer to the
"^DD",9002313.57,9002313.57,9999.92,21,2,0)
patient file and the division.
"^DD",9002313.57,9002313.57,9999.92,"DT")
3080212
"^DD",9002313.57,9002313.57,9999.93,0)
DRUG NAME^CJ30^^ ; ^N IEN57 S IEN57=D0,X=$$DRGNAME^BPSOS57
"^DD",9002313.57,9002313.57,9999.93,9)
^
"^DD",9002313.57,9002313.57,9999.93,9.01)

"^DD",9002313.57,9002313.57,9999.93,9.1)
N IEN57 S IEN57=D0,X=$$DRGNAME^BPSOS57
"^DD",9002313.57,9002313.57,9999.93,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,9999.93,21,1,0)
Drug name from file 50
"^DD",9002313.57,9002313.57,9999.94,0)
DRUG IEN^CJ8^^ ; ^N IEN57 S IEN57=D0,X=$$DRGDFN^BPSOS57
"^DD",9002313.57,9002313.57,9999.94,9)
^
"^DD",9002313.57,9002313.57,9999.94,9.01)

"^DD",9002313.57,9002313.57,9999.94,9.1)
N IEN57 S IEN57=D0,X=$$DRGDFN^BPSOS57
"^DD",9002313.57,9002313.57,9999.94,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,9999.94,21,1,0)
The IEN of the drug from file 50.
"^DD",9002313.57,9002313.57,9999.95,0)
RELEASED DATE^CJ14^^ ; ^N IEN57 S IEN57=D0,X=$$RELDATE^BPSOS57
"^DD",9002313.57,9002313.57,9999.95,9)
^
"^DD",9002313.57,9002313.57,9999.95,9.01)

"^DD",9002313.57,9002313.57,9999.95,9.1)
N IEN57 S IEN57=D0,X=$$RELDATE^BPSOS57
"^DD",9002313.57,9002313.57,9999.95,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,9999.95,21,1,0)
Release date and time from the prescription file, 52.
"^DD",9002313.57,9002313.57,9999.95,"DT")
3080212
"^DD",9002313.57,9002313.57,9999.96,0)
NET PAID BY INSURER^CJ8^^ ; ^N RESP,POSITION S X=$G(^BPSTL(D0,0)),RESP=$P(X,U,5),POSITION=$P(X,U,9),X=$S(RESP&POSITION:$$NETPAID1^BPSOS03(RESP,POSITION),1:"")
"^DD",9002313.57,9002313.57,9999.96,9)
^
"^DD",9002313.57,9002313.57,9999.96,9.01)

"^DD",9002313.57,9002313.57,9999.96,9.1)
N RESP,POSITION S X=$G(^BPSTL(D0,0)),RESP=$P(X,U,5),POSITION=$P(X,U,9),X=$S(RESP&POSITION:$$NETPAID1^BPSOS03(RESP,POSITION),1:"")
"^DD",9002313.57,9002313.57,9999.96,21,0)
^^1^1^3040331^
"^DD",9002313.57,9002313.57,9999.96,21,1,0)
Amount paid after the discounts and deductible have been subtracted.
"^DD",9002313.57,9002313.57,9999.96,"DT")
3040331
"^DD",9002313.57,9002313.57,9999.97,0)
ELAPSED TIME PRINTABLE^CJ20^^ ; ^S X=$G(^BPSTL(D0,0)) N X11,X8 S X11=$P(X,U,11),X8=$P(X,U,8),X=$S(X11&X8:$$TIMEDIF^BPSOSUD(X11,X8),1:"")
"^DD",9002313.57,9002313.57,9999.97,9)
^
"^DD",9002313.57,9002313.57,9999.97,9.01)

"^DD",9002313.57,9002313.57,9999.97,9.1)
S X=$G(^BPSTL(D0,0)) N X11,X8 S X11=$P(X,U,11),X8=$P(X,U,8),X=$S(X11&X8:$$TIMEDIF^BPSOSUD(X11,X8),1:"")
"^DD",9002313.57,9002313.57,9999.97,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,9999.97,21,1,0)
Elapsed time between submission and response in external format.
"^DD",9002313.57,9002313.57,9999.97,"DT")
3080212
"^DD",9002313.57,9002313.57,9999.98,0)
ELAPSED TIME SECONDS^CJ8^^ ; ^S X=$G(^BPSTL(D0,0)) N X11,X8 S X11=$P(X,U,11),X8=$P(X,U,8),X=$S(X11&X8:$$TIMEDIFI^BPSOSUD(X11,X8),1:"")
"^DD",9002313.57,9002313.57,9999.98,9)
^
"^DD",9002313.57,9002313.57,9999.98,9.01)

"^DD",9002313.57,9002313.57,9999.98,9.1)
S X=$G(^BPSTL(D0,0)) N X11,X8 S X11=$P(X,U,11),X8=$P(X,U,8),X=$S(X11&X8:$$TIMEDIFI^BPSOSUD(X11,X8),1:"")
"^DD",9002313.57,9002313.57,9999.98,21,0)
^^2^2^3080212^
"^DD",9002313.57,9002313.57,9999.98,21,1,0)
Elapsed time between submission and response expressed as a number of 
"^DD",9002313.57,9002313.57,9999.98,21,2,0)
seconds.
"^DD",9002313.57,9002313.57,9999.98,"DT")
3080212
"^DD",9002313.57,9002313.57,9999.99,0)
RESULT CATEGORY^CJ20^^ ; ^S X=$$CATEG^BPSOSUC(D0)
"^DD",9002313.57,9002313.57,9999.99,9)
^
"^DD",9002313.57,9002313.57,9999.99,9.01)

"^DD",9002313.57,9002313.57,9999.99,9.1)
S X=$$CATEG^BPSOSUC(D0)
"^DD",9002313.57,9002313.57,9999.99,21,0)
^^1^1^3040126^
"^DD",9002313.57,9002313.57,9999.99,21,1,0)
The category of the transmission - accepted, payable, rejected, etc.
"^DD",9002313.57,9002313.57,9999.99,"DT")
3001115
"^DD",9002313.57,9002313.57,10101,0)
BIN NUMBER^CJ6^^ ; ^S X=$$FIELD^BPSOS57(101)
"^DD",9002313.57,9002313.57,10101,9)
^
"^DD",9002313.57,9002313.57,10101,9.01)

"^DD",9002313.57,9002313.57,10101,9.1)
S X=$$FIELD^BPSOS57(101)
"^DD",9002313.57,9002313.57,10101,21,0)
^^1^1^3040322^
"^DD",9002313.57,9002313.57,10101,21,1,0)
BIN number from the response file.
"^DD",9002313.57,9002313.57,10102,0)
VERSION RELEASE NUMBER^CJ2^^ ; ^S X=$$FIELD^BPSOS57(102)
"^DD",9002313.57,9002313.57,10102,9)
^
"^DD",9002313.57,9002313.57,10102,9.01)

"^DD",9002313.57,9002313.57,10102,9.1)
S X=$$FIELD^BPSOS57(102)
"^DD",9002313.57,9002313.57,10102,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10102,21,1,0)
Version/release number from the BPS claims file.
"^DD",9002313.57,9002313.57,10102,"DT")
3080212
"^DD",9002313.57,9002313.57,10103,0)
TRANSACTION CODE^CJ2^^ ; ^S X=$$FIELD^BPSOS57(103)
"^DD",9002313.57,9002313.57,10103,9)
^
"^DD",9002313.57,9002313.57,10103,9.01)

"^DD",9002313.57,9002313.57,10103,9.1)
S X=$$FIELD^BPSOS57(103)
"^DD",9002313.57,9002313.57,10103,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10103,21,1,0)
Type of transaction from the claim file.
"^DD",9002313.57,9002313.57,10104,0)
PROCESSOR CONTROL NUMBER^CJ10^^ ; ^S X=$$FIELD^BPSOS57(104)
"^DD",9002313.57,9002313.57,10104,9)
^
"^DD",9002313.57,9002313.57,10104,9.01)

"^DD",9002313.57,9002313.57,10104,9.1)
S X=$$FIELD^BPSOS57(104)
"^DD",9002313.57,9002313.57,10104,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10104,21,1,0)
PCN number from the claims file.
"^DD",9002313.57,9002313.57,10201,0)
PHARMACY NUMBER^CJ12^^ ; ^S X=$$FIELD^BPSOS57(201)
"^DD",9002313.57,9002313.57,10201,9)
^
"^DD",9002313.57,9002313.57,10201,9.01)

"^DD",9002313.57,9002313.57,10201,9.1)
S X=$$FIELD^BPSOS57(201)
"^DD",9002313.57,9002313.57,10201,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10201,21,1,0)
The Pharmacy's NABP number from the claims file.
"^DD",9002313.57,9002313.57,10301,0)
GROUP NUMBER^CJ15^^ ; ^S X=$$FIELD^BPSOS57(301)
"^DD",9002313.57,9002313.57,10301,9)
^
"^DD",9002313.57,9002313.57,10301,9.01)

"^DD",9002313.57,9002313.57,10301,9.1)
S X=$$FIELD^BPSOS57(301)
"^DD",9002313.57,9002313.57,10301,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10301,21,1,0)
The group number of the insurance used from the BPS claims file.
"^DD",9002313.57,9002313.57,10302,0)
CARDHOLDER ID NUMBER^CJ18^^ ; ^S X=$$FIELD^BPSOS57(302)
"^DD",9002313.57,9002313.57,10302,9)
^
"^DD",9002313.57,9002313.57,10302,9.01)

"^DD",9002313.57,9002313.57,10302,9.1)
S X=$$FIELD^BPSOS57(302)
"^DD",9002313.57,9002313.57,10302,21,0)
^^2^2^3040322^
"^DD",9002313.57,9002313.57,10302,21,1,0)
The insured person's cardholder identification number from the claims 
"^DD",9002313.57,9002313.57,10302,21,2,0)
file.
"^DD",9002313.57,9002313.57,10302,"DT")
3040322
"^DD",9002313.57,9002313.57,10303,0)
PERSON CODE^CJ3^^ ; ^S X=$$FIELD^BPSOS57(303)
"^DD",9002313.57,9002313.57,10303,9)
^
"^DD",9002313.57,9002313.57,10303,9.01)

"^DD",9002313.57,9002313.57,10303,9.1)
S X=$$FIELD^BPSOS57(303)
"^DD",9002313.57,9002313.57,10303,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10303,21,1,0)
The person code from the BPS claims file.
"^DD",9002313.57,9002313.57,10304,0)
DATE OF BIRTH^CJ8^^ ; ^S X=$$FIELD^BPSOS57(304)
"^DD",9002313.57,9002313.57,10304,9)
^
"^DD",9002313.57,9002313.57,10304,9.01)

"^DD",9002313.57,9002313.57,10304,9.1)
S X=$$FIELD^BPSOS57(304)
"^DD",9002313.57,9002313.57,10304,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10304,21,1,0)
Date of birth of the patient from the BPS claims file.
"^DD",9002313.57,9002313.57,10305,0)
SEX CODE^CJ1^^ ; ^S X=$$FIELD^BPSOS57(305)
"^DD",9002313.57,9002313.57,10305,9)
^
"^DD",9002313.57,9002313.57,10305,9.01)

"^DD",9002313.57,9002313.57,10305,9.1)
S X=$$FIELD^BPSOS57(305)
"^DD",9002313.57,9002313.57,10305,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10305,21,1,0)
Sex of the patient, "M" or "F"
"^DD",9002313.57,9002313.57,10306,0)
RELATIONSHIP CODE^CJ1^^ ; ^S X=$$FIELD^BPSOS57(306)
"^DD",9002313.57,9002313.57,10306,9)
^
"^DD",9002313.57,9002313.57,10306,9.01)

"^DD",9002313.57,9002313.57,10306,9.1)
S X=$$FIELD^BPSOS57(306)
"^DD",9002313.57,9002313.57,10306,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10306,21,1,0)
Relationship of the patient to the insured - from the BPS claims file.
"^DD",9002313.57,9002313.57,10307,0)
CUSTOMER LOCATION^CJ2^^ ; ^S X=$$FIELD^BPSOS57(307)
"^DD",9002313.57,9002313.57,10307,9)
^
"^DD",9002313.57,9002313.57,10307,9.01)

"^DD",9002313.57,9002313.57,10307,9.1)
S X=$$FIELD^BPSOS57(307)
"^DD",9002313.57,9002313.57,10307,21,0)
^^6^6^3031222^
"^DD",9002313.57,9002313.57,10307,21,1,0)
Code identifying the location of the patient when receiving pharmacy
"^DD",9002313.57,9002313.57,10307,21,2,0)
services.  =Not Specified 1=Home 2=Inter-Care 3=Nursing Home 4=Long
"^DD",9002313.57,9002313.57,10307,21,3,0)
Term/Extended Care 5=Rest Home 6=Boarding Home 7=Skilled Care Facility
"^DD",9002313.57,9002313.57,10307,21,4,0)
8=Sub-Acute Care Facility 9=Acute Care Facility 1=Outpatient 11=Hospice
"^DD",9002313.57,9002313.57,10307,21,5,0)
 
"^DD",9002313.57,9002313.57,10307,21,6,0)
from the BPS claims file
"^DD",9002313.57,9002313.57,10308,0)
OTHER COVERAGE CODE^CJ1^^ ; ^S X=$$FIELD^BPSOS57(308)
"^DD",9002313.57,9002313.57,10308,9)
^
"^DD",9002313.57,9002313.57,10308,9.01)

"^DD",9002313.57,9002313.57,10308,9.1)
S X=$$FIELD^BPSOS57(308)
"^DD",9002313.57,9002313.57,10308,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10308,21,1,0)
Code indicating whether or not the patient has other insurance coverage.
"^DD",9002313.57,9002313.57,10309,0)
ELIGIBILITY CLARIFICATION CODE^CJ1^^ ; ^S X=$$FIELD^BPSOS57(309)
"^DD",9002313.57,9002313.57,10309,9)
^
"^DD",9002313.57,9002313.57,10309,9.01)

"^DD",9002313.57,9002313.57,10309,9.1)
S X=$$FIELD^BPSOS57(309)
"^DD",9002313.57,9002313.57,10309,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10309,21,1,0)
Code indicating that the pharmacy is clarifying eligibility based on
"^DD",9002313.57,9002313.57,10309,21,2,0)
receiving a denial. Comes from the BPS claims file.  
"^DD",9002313.57,9002313.57,10310,0)
PATIENT FIRST NAME^CJ12^^ ; ^S X=$$FIELD^BPSOS57(310)
"^DD",9002313.57,9002313.57,10310,9)
^
"^DD",9002313.57,9002313.57,10310,9.01)

"^DD",9002313.57,9002313.57,10310,9.1)
S X=$$FIELD^BPSOS57(310)
"^DD",9002313.57,9002313.57,10310,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10310,21,1,0)
First name of patient receiving the prescription, from the BPS claims 
"^DD",9002313.57,9002313.57,10310,21,2,0)
file.
"^DD",9002313.57,9002313.57,10311,0)
PATIENT LAST NAME^CJ15^^ ; ^S X=$$FIELD^BPSOS57(311)
"^DD",9002313.57,9002313.57,10311,9)
^
"^DD",9002313.57,9002313.57,10311,9.01)

"^DD",9002313.57,9002313.57,10311,9.1)
S X=$$FIELD^BPSOS57(311)
"^DD",9002313.57,9002313.57,10311,21,0)
^^1^1^3080212^
"^DD",9002313.57,9002313.57,10311,21,1,0)
Last Name of patient receiving the prescription from the BPS claims file.
"^DD",9002313.57,9002313.57,10311,"DT")
3080212
"^DD",9002313.57,9002313.57,10312,0)
CARDHOLDER FIRST NAME^CJ12^^ ; ^S X=$$FIELD^BPSOS57(312)
"^DD",9002313.57,9002313.57,10312,9)
^
"^DD",9002313.57,9002313.57,10312,9.01)

"^DD",9002313.57,9002313.57,10312,9.1)
S X=$$FIELD^BPSOS57(312)
"^DD",9002313.57,9002313.57,10312,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10312,21,1,0)
First name of the Cardholder/Subscriber from the BPS claims file.
"^DD",9002313.57,9002313.57,10313,0)
CARDHOLDER LAST NAME^CJ15^^ ; ^S X=$$FIELD^BPSOS57(313)
"^DD",9002313.57,9002313.57,10313,9)
^
"^DD",9002313.57,9002313.57,10313,9.01)

"^DD",9002313.57,9002313.57,10313,9.1)
S X=$$FIELD^BPSOS57(313)
"^DD",9002313.57,9002313.57,10313,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10313,21,1,0)
Last name of the Cardholder/Subscriber from the BPS claims file. 
"^DD",9002313.57,9002313.57,10314,0)
HOME PLAN^CJ3^^ ; ^S X=$$FIELD^BPSOS57(314)
"^DD",9002313.57,9002313.57,10314,9)
^
"^DD",9002313.57,9002313.57,10314,9.01)

"^DD",9002313.57,9002313.57,10314,9.1)
S X=$$FIELD^BPSOS57(314)
"^DD",9002313.57,9002313.57,10314,21,0)
^^3^3^3031222^
"^DD",9002313.57,9002313.57,10314,21,1,0)
Code identifying the Blue Cross or Blue Shield plan ID which indicates
"^DD",9002313.57,9002313.57,10314,21,2,0)
where the member's coverage has been designated. Usually where the member
"^DD",9002313.57,9002313.57,10314,21,3,0)
lives or purchased their coverage from the BPS claims file.
"^DD",9002313.57,9002313.57,10315,0)
EMPLOYER NAME^CJ30^^ ; ^S X=$$FIELD^BPSOS57(315)
"^DD",9002313.57,9002313.57,10315,9)
^
"^DD",9002313.57,9002313.57,10315,9.01)

"^DD",9002313.57,9002313.57,10315,9.1)
S X=$$FIELD^BPSOS57(315)
"^DD",9002313.57,9002313.57,10315,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10315,21,1,0)
Complete name of employer. 
"^DD",9002313.57,9002313.57,10316,0)
EMPLOYER STREET ADDRESS^CJ30^^ ; ^S X=$$FIELD^BPSOS57(316)
"^DD",9002313.57,9002313.57,10316,9)
^
"^DD",9002313.57,9002313.57,10316,9.01)

"^DD",9002313.57,9002313.57,10316,9.1)
S X=$$FIELD^BPSOS57(316)
"^DD",9002313.57,9002313.57,10316,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10316,21,1,0)
Free-form text for address information from the claims file.
"^DD",9002313.57,9002313.57,10317,0)
EMPLOYER CITY ADDRESS^CJ20^^ ; ^S X=$$FIELD^BPSOS57(317)
"^DD",9002313.57,9002313.57,10317,9)
^
"^DD",9002313.57,9002313.57,10317,9.01)

"^DD",9002313.57,9002313.57,10317,9.1)
S X=$$FIELD^BPSOS57(317)
"^DD",9002313.57,9002313.57,10317,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10317,21,1,0)
Free-form text for city name.
"^DD",9002313.57,9002313.57,10318,0)
EMPLOYER STATE^CJ2^^ ; ^S X=$$FIELD^BPSOS57(318)
"^DD",9002313.57,9002313.57,10318,9)
^
"^DD",9002313.57,9002313.57,10318,9.01)

"^DD",9002313.57,9002313.57,10318,9.1)
S X=$$FIELD^BPSOS57(318)
"^DD",9002313.57,9002313.57,10318,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10318,21,1,0)
Standard State/Province Code as defined by appropriate government agency.
"^DD",9002313.57,9002313.57,10319,0)
EMPLOYER ZIP CODE^CJ9^^ ; ^S X=$$FIELD^BPSOS57(319)
"^DD",9002313.57,9002313.57,10319,9)
^
"^DD",9002313.57,9002313.57,10319,9.01)

"^DD",9002313.57,9002313.57,10319,9.1)
S X=$$FIELD^BPSOS57(319)
"^DD",9002313.57,9002313.57,10319,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10319,21,1,0)
Code defining international postal zone excluding punctuation and blanks
"^DD",9002313.57,9002313.57,10319,21,2,0)
(zip code for US).
"^DD",9002313.57,9002313.57,10320,0)
EMPLOYER PHONE NUMBER^CJ10^^ ; ^S X=$$FIELD^BPSOS57(320)
"^DD",9002313.57,9002313.57,10320,9)
^
"^DD",9002313.57,9002313.57,10320,9.01)

"^DD",9002313.57,9002313.57,10320,9.1)
S X=$$FIELD^BPSOS57(320)
"^DD",9002313.57,9002313.57,10320,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10320,21,1,0)
Ten digit phone number of employer.
"^DD",9002313.57,9002313.57,10321,0)
EMPLOYER CONTACT NAME^CJ30^^ ; ^S X=$$FIELD^BPSOS57(321)
"^DD",9002313.57,9002313.57,10321,9)
^
"^DD",9002313.57,9002313.57,10321,9.01)

"^DD",9002313.57,9002313.57,10321,9.1)
S X=$$FIELD^BPSOS57(321)
"^DD",9002313.57,9002313.57,10321,21,0)
^^1^1^3080613^
"^DD",9002313.57,9002313.57,10321,21,1,0)
Contact person's name of the cardholder's employer.
"^DD",9002313.57,9002313.57,10321,"DT")
3080613
"^DD",9002313.57,9002313.57,10322,0)
PATIENT STREET ADDRESS^CJ30^^ ; ^S X=$$FIELD^BPSOS57(322)
"^DD",9002313.57,9002313.57,10322,9)
^
"^DD",9002313.57,9002313.57,10322,9.01)

"^DD",9002313.57,9002313.57,10322,9.1)
S X=$$FIELD^BPSOS57(322)
"^DD",9002313.57,9002313.57,10322,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10322,21,1,0)
Free-form text for Patient address information.
"^DD",9002313.57,9002313.57,10323,0)
PATIENT CITY ADDRESS^CJ20^^ ; ^S X=$$FIELD^BPSOS57(323)
"^DD",9002313.57,9002313.57,10323,9)
^
"^DD",9002313.57,9002313.57,10323,9.01)

"^DD",9002313.57,9002313.57,10323,9.1)
S X=$$FIELD^BPSOS57(323)
"^DD",9002313.57,9002313.57,10323,21,0)
^.001^1^1^3031222^^
"^DD",9002313.57,9002313.57,10323,21,1,0)
Free-form text for city name.
"^DD",9002313.57,9002313.57,10323,"DT")
3031222
"^DD",9002313.57,9002313.57,10324,0)
PATIENT STATE^CJ2^^ ; ^S X=$$FIELD^BPSOS57(324)
"^DD",9002313.57,9002313.57,10324,9)
^
"^DD",9002313.57,9002313.57,10324,9.01)

"^DD",9002313.57,9002313.57,10324,9.1)
S X=$$FIELD^BPSOS57(324)
"^DD",9002313.57,9002313.57,10324,21,0)
^.001^2^2^3031222^^
"^DD",9002313.57,9002313.57,10324,21,1,0)
Standard State/Province Code as defined by appropriate government agency.
"^DD",9002313.57,9002313.57,10324,21,2,0)
Comes from the BPS claims file.
"^DD",9002313.57,9002313.57,10325,0)
PATIENT ZIP CODE^CJ9^^ ; ^S X=$$FIELD^BPSOS57(325)
"^DD",9002313.57,9002313.57,10325,9)
^
"^DD",9002313.57,9002313.57,10325,9.01)

"^DD",9002313.57,9002313.57,10325,9.1)
S X=$$FIELD^BPSOS57(325)
"^DD",9002313.57,9002313.57,10325,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10325,21,1,0)
Code defining international postal zone excluding punctuation and blanks
"^DD",9002313.57,9002313.57,10325,21,2,0)
(zip code for US). From the BPS claims file.
"^DD",9002313.57,9002313.57,10326,0)
PATIENT PHONE NUMBER^CJ10^^ ; ^S X=$$FIELD^BPSOS57(326)
"^DD",9002313.57,9002313.57,10326,9)
^
"^DD",9002313.57,9002313.57,10326,9.01)

"^DD",9002313.57,9002313.57,10326,9.1)
S X=$$FIELD^BPSOS57(326)
"^DD",9002313.57,9002313.57,10326,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10326,21,1,0)
Ten digit  phone number of patient. From the BPS claims file.
"^DD",9002313.57,9002313.57,10327,0)
CARRIER ID NUMBER^CJ10^^ ; ^S X=$$FIELD^BPSOS57(327)
"^DD",9002313.57,9002313.57,10327,9)
^
"^DD",9002313.57,9002313.57,10327,9.01)

"^DD",9002313.57,9002313.57,10327,9.1)
S X=$$FIELD^BPSOS57(327)
"^DD",9002313.57,9002313.57,10327,21,0)
^^1^1^3040126^
"^DD",9002313.57,9002313.57,10327,21,1,0)
The ID number of the insurance carrier.
"^DD",9002313.57,9002313.57,10328,0)
PATIENT WEIGHT^CJ3^^ ; ^S X=$$FIELD^BPSOS57(328)
"^DD",9002313.57,9002313.57,10328,9)
^
"^DD",9002313.57,9002313.57,10328,9.01)

"^DD",9002313.57,9002313.57,10328,9.1)
S X=$$FIELD^BPSOS57(328)
"^DD",9002313.57,9002313.57,10328,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10328,21,1,0)
Patient's weight from the patient file.
"^DD",9002313.57,9002313.57,10329,0)
PATIENT SSN^CJ9^^ ; ^S X=$$FIELD^BPSOS57(329)
"^DD",9002313.57,9002313.57,10329,9)
^
"^DD",9002313.57,9002313.57,10329,9.01)

"^DD",9002313.57,9002313.57,10329,9.1)
S X=$$FIELD^BPSOS57(329)
"^DD",9002313.57,9002313.57,10329,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10329,21,1,0)
Patient SSN from the claims file.
"^DD",9002313.57,9002313.57,10401,0)
DATE FILLED^CJ8^^ ; ^S X=$$FIELD^BPSOS57(401)
"^DD",9002313.57,9002313.57,10401,9)
^
"^DD",9002313.57,9002313.57,10401,9.01)

"^DD",9002313.57,9002313.57,10401,9.1)
S X=$$FIELD^BPSOS57(401)
"^DD",9002313.57,9002313.57,10401,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10401,21,1,0)
The fill/refill date 
"^DD",9002313.57,9002313.57,10402,0)
PRESCRIPTION NUMBER SEVEN^CJ7^^ ; ^S X=$$FIELD^BPSOS57(402)
"^DD",9002313.57,9002313.57,10402,9)
^
"^DD",9002313.57,9002313.57,10402,9.01)

"^DD",9002313.57,9002313.57,10402,9.1)
S X=$$FIELD^BPSOS57(402)
"^DD",9002313.57,9002313.57,10402,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10402,21,1,0)
  The first seven digits of the prescription IEN 
"^DD",9002313.57,9002313.57,10402,"DT")
3080212
"^DD",9002313.57,9002313.57,10403,0)
NEW REFILL CODE^CJ2^^ ; ^S X=$$FIELD^BPSOS57(403)
"^DD",9002313.57,9002313.57,10403,9)
^
"^DD",9002313.57,9002313.57,10403,9.01)

"^DD",9002313.57,9002313.57,10403,9.1)
S X=$$FIELD^BPSOS57(403)
"^DD",9002313.57,9002313.57,10403,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10403,21,1,0)
The fill/refill number, starting at 0 for the original fill.
"^DD",9002313.57,9002313.57,10403,"DT")
3080212
"^DD",9002313.57,9002313.57,10404,0)
METRIC QUANTITY^CJ5^^ ; ^S X=$$FIELD^BPSOS57(404)
"^DD",9002313.57,9002313.57,10404,9)
^
"^DD",9002313.57,9002313.57,10404,9.01)

"^DD",9002313.57,9002313.57,10404,9.1)
S X=$$FIELD^BPSOS57(404)
"^DD",9002313.57,9002313.57,10404,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10404,21,1,0)
Metric quantity of the drug.
"^DD",9002313.57,9002313.57,10405,0)
DAYS SUPPLY^CJ3^^ ; ^S X=$$FIELD^BPSOS57(405)
"^DD",9002313.57,9002313.57,10405,9)
^
"^DD",9002313.57,9002313.57,10405,9.01)

"^DD",9002313.57,9002313.57,10405,9.1)
S X=$$FIELD^BPSOS57(405)
"^DD",9002313.57,9002313.57,10405,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10405,21,1,0)
The actual days supply dispensed.
"^DD",9002313.57,9002313.57,10406,0)
COMPOUND CODE^CJ1^^ ; ^S X=$$FIELD^BPSOS57(406)
"^DD",9002313.57,9002313.57,10406,9)
^
"^DD",9002313.57,9002313.57,10406,9.01)

"^DD",9002313.57,9002313.57,10406,9.1)
S X=$$FIELD^BPSOS57(406)
"^DD",9002313.57,9002313.57,10406,21,0)
^^2^2^3080212^
"^DD",9002313.57,9002313.57,10406,21,1,0)
Field indicating whether this prescription was a compound (1) or not a
"^DD",9002313.57,9002313.57,10406,21,2,0)
compound (0). 
"^DD",9002313.57,9002313.57,10406,"DT")
3080212
"^DD",9002313.57,9002313.57,10407,0)
NDC NUMBER^CJ11^^ ; ^S X=$$FIELD^BPSOS57(407)
"^DD",9002313.57,9002313.57,10407,9)
^
"^DD",9002313.57,9002313.57,10407,9.01)

"^DD",9002313.57,9002313.57,10407,9.1)
S X=$$FIELD^BPSOS57(407)
"^DD",9002313.57,9002313.57,10407,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10407,21,1,0)
NDC code in our case.
"^DD",9002313.57,9002313.57,10408,0)
DISPENSE AS WRITTEN^CJ1^^ ; ^S X=$$FIELD^BPSOS57(408)
"^DD",9002313.57,9002313.57,10408,9)
^
"^DD",9002313.57,9002313.57,10408,9.01)

"^DD",9002313.57,9002313.57,10408,9.1)
S X=$$FIELD^BPSOS57(408)
"^DD",9002313.57,9002313.57,10408,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10408,21,1,0)
Indicator for whether the prescription was to be dispensed only as
"^DD",9002313.57,9002313.57,10408,21,2,0)
written. 
"^DD",9002313.57,9002313.57,10409,0)
INGREDIENT COST^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(409)
"^DD",9002313.57,9002313.57,10409,9)
^
"^DD",9002313.57,9002313.57,10409,9.01)

"^DD",9002313.57,9002313.57,10409,9.1)
S X=$$FIELD^BPSOS57(409)
"^DD",9002313.57,9002313.57,10409,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10409,21,1,0)
Cost amount for the ingredients of compounds. 
"^DD",9002313.57,9002313.57,10409,"DT")
3010405
"^DD",9002313.57,9002313.57,10410,0)
SALES TAX^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(410)
"^DD",9002313.57,9002313.57,10410,9)
^
"^DD",9002313.57,9002313.57,10410,9.01)

"^DD",9002313.57,9002313.57,10410,9.1)
S X=$$FIELD^BPSOS57(410)
"^DD",9002313.57,9002313.57,10410,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10410,21,1,0)
 Sales Tax charged (not applicable for VA)
"^DD",9002313.57,9002313.57,10411,0)
PRESCRIBER ID^CJ10^^ ; ^S X=$$FIELD^BPSOS57(411)
"^DD",9002313.57,9002313.57,10411,9)
^
"^DD",9002313.57,9002313.57,10411,9.01)

"^DD",9002313.57,9002313.57,10411,9.1)
S X=$$FIELD^BPSOS57(411)
"^DD",9002313.57,9002313.57,10411,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10411,21,1,0)
Prescriber identification number.  
"^DD",9002313.57,9002313.57,10412,0)
DISPENSING FEE SUBMITTED^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(412)
"^DD",9002313.57,9002313.57,10412,9)
^
"^DD",9002313.57,9002313.57,10412,9.01)

"^DD",9002313.57,9002313.57,10412,9.1)
S X=$$FIELD^BPSOS57(412)
"^DD",9002313.57,9002313.57,10412,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10412,21,1,0)
Add-on fee charged in a retail setting.  This field will probably be used
"^DD",9002313.57,9002313.57,10412,21,2,0)
when the Tricare functionality is added.
"^DD",9002313.57,9002313.57,10414,0)
DATE PRESCRIPTION WRITTEN^CJ8^^ ; ^S X=$$FIELD^BPSOS57(414)
"^DD",9002313.57,9002313.57,10414,9)
^
"^DD",9002313.57,9002313.57,10414,9.01)

"^DD",9002313.57,9002313.57,10414,9.1)
S X=$$FIELD^BPSOS57(414)
"^DD",9002313.57,9002313.57,10414,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10414,21,1,0)
This will be the fill/refill date for local fills, the released date for
"^DD",9002313.57,9002313.57,10414,21,2,0)
CMOP.
"^DD",9002313.57,9002313.57,10415,0)
NUMBER OF REFILLS AUTHORIZED^CJ2^^ ; ^S X=$$FIELD^BPSOS57(415)
"^DD",9002313.57,9002313.57,10415,9)
^
"^DD",9002313.57,9002313.57,10415,9.01)

"^DD",9002313.57,9002313.57,10415,9.1)
S X=$$FIELD^BPSOS57(415)
"^DD",9002313.57,9002313.57,10415,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10415,21,1,0)
The number of refills allowed that was entered during order entry.
"^DD",9002313.57,9002313.57,10416,0)
PRIOR AUTH/MC CODE AND NUMBER^CJ10^^ ; ^S X=$$FIELD^BPSOS57(416)
"^DD",9002313.57,9002313.57,10416,9)
^
"^DD",9002313.57,9002313.57,10416,9.01)

"^DD",9002313.57,9002313.57,10416,9.1)
S X=$$FIELD^BPSOS57(416)
"^DD",9002313.57,9002313.57,10416,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10416,21,1,0)
 Not used for VA - left in for IHS 
"^DD",9002313.57,9002313.57,10418,0)
LEVEL OF SERVICE^CJ2^^ ; ^S X=$$FIELD^BPSOS57(418)
"^DD",9002313.57,9002313.57,10418,9)
^
"^DD",9002313.57,9002313.57,10418,9.01)

"^DD",9002313.57,9002313.57,10418,9.1)
S X=$$FIELD^BPSOS57(418)
"^DD",9002313.57,9002313.57,10418,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10418,21,1,0)
Not used for VA - left in for IHS
"^DD",9002313.57,9002313.57,10419,0)
PRESCRIPTION ORIGIN CODE^CJ1^^ ; ^S X=$$FIELD^BPSOS57(419)
"^DD",9002313.57,9002313.57,10419,9)
^
"^DD",9002313.57,9002313.57,10419,9.01)

"^DD",9002313.57,9002313.57,10419,9.1)
S X=$$FIELD^BPSOS57(419)
"^DD",9002313.57,9002313.57,10419,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10419,21,1,0)
Not used for VA - left in for IHS
"^DD",9002313.57,9002313.57,10420,0)
PRESCRIPTION CLARIFICATION^CJ2^^ ; ^S X=$$FIELD^BPSOS57(420)
"^DD",9002313.57,9002313.57,10420,9)
^
"^DD",9002313.57,9002313.57,10420,9.01)

"^DD",9002313.57,9002313.57,10420,9.1)
S X=$$FIELD^BPSOS57(420)
"^DD",9002313.57,9002313.57,10420,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10420,21,1,0)
Not used for VA - left in for IHS
"^DD",9002313.57,9002313.57,10421,0)
PRIMARY PRESCRIBER^CJ10^^ ; ^S X=$$FIELD^BPSOS57(421)
"^DD",9002313.57,9002313.57,10421,9)
^
"^DD",9002313.57,9002313.57,10421,9.01)

"^DD",9002313.57,9002313.57,10421,9.1)
S X=$$FIELD^BPSOS57(421)
"^DD",9002313.57,9002313.57,10421,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10421,21,1,0)
Provider ID number
"^DD",9002313.57,9002313.57,10422,0)
CLINIC ID NUMBER^CJ5^^ ; ^S X=$$FIELD^BPSOS57(422)
"^DD",9002313.57,9002313.57,10422,9)
^
"^DD",9002313.57,9002313.57,10422,9.01)

"^DD",9002313.57,9002313.57,10422,9.1)
S X=$$FIELD^BPSOS57(422)
"^DD",9002313.57,9002313.57,10422,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10422,21,1,0)
Clinic ID where the prescription was entered.
"^DD",9002313.57,9002313.57,10423,0)
BASIS OF COST DETERMINATION^CJ2^^ ; ^S X=$$FIELD^BPSOS57(423)
"^DD",9002313.57,9002313.57,10423,9)
^
"^DD",9002313.57,9002313.57,10423,9.01)

"^DD",9002313.57,9002313.57,10423,9.1)
S X=$$FIELD^BPSOS57(423)
"^DD",9002313.57,9002313.57,10423,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10423,21,1,0)
How the amount charged was arrived at.
"^DD",9002313.57,9002313.57,10424,0)
DIAGNOSIS CODE^CJ6^^ ; ^S X=$$FIELD^BPSOS57(424)
"^DD",9002313.57,9002313.57,10424,9)
^
"^DD",9002313.57,9002313.57,10424,9.01)

"^DD",9002313.57,9002313.57,10424,9.1)
S X=$$FIELD^BPSOS57(424)
"^DD",9002313.57,9002313.57,10424,21,0)
^^3^3^3031222^
"^DD",9002313.57,9002313.57,10424,21,1,0)
Diagnosis code that applies to this prescription.  Not used for third
"^DD",9002313.57,9002313.57,10424,21,2,0)
party billing as of this date - so it is not used, but may be used in the
"^DD",9002313.57,9002313.57,10424,21,3,0)
future.  
"^DD",9002313.57,9002313.57,10425,0)
DRUG TYPE^CJ1^^ ; ^S X=$$FIELD^BPSOS57(425)
"^DD",9002313.57,9002313.57,10425,9)
^
"^DD",9002313.57,9002313.57,10425,9.01)

"^DD",9002313.57,9002313.57,10425,9.1)
S X=$$FIELD^BPSOS57(425)
"^DD",9002313.57,9002313.57,10425,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10425,21,1,0)
Code to indicate the type of drug dispensed.  =Not specified 1=Single
"^DD",9002313.57,9002313.57,10425,21,2,0)
source brand 2=Branded generic 3=Generic 4=O.T.C. (over the counter)
"^DD",9002313.57,9002313.57,10426,0)
USUAL AND CUSTOMARY CHARGE^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(426)
"^DD",9002313.57,9002313.57,10426,9)
^
"^DD",9002313.57,9002313.57,10426,9.01)

"^DD",9002313.57,9002313.57,10426,9.1)
S X=$$FIELD^BPSOS57(426)
"^DD",9002313.57,9002313.57,10426,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10426,21,1,0)
Amount charged cash customers for the prescription exclusive of sales tax
"^DD",9002313.57,9002313.57,10426,21,2,0)
or other amounts claimed.
"^DD",9002313.57,9002313.57,10426,"DT")
3010405
"^DD",9002313.57,9002313.57,10427,0)
PRESCRIBER LAST NAME^CJ15^^ ; ^S X=$$FIELD^BPSOS57(427)
"^DD",9002313.57,9002313.57,10427,9)
^
"^DD",9002313.57,9002313.57,10427,9.01)

"^DD",9002313.57,9002313.57,10427,9.1)
S X=$$FIELD^BPSOS57(427)
"^DD",9002313.57,9002313.57,10427,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10427,21,1,0)
Last Name of the Prescriber
"^DD",9002313.57,9002313.57,10428,0)
POSTAGE AMOUNT CLAIMED^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(428)
"^DD",9002313.57,9002313.57,10428,9)
^
"^DD",9002313.57,9002313.57,10428,9.01)

"^DD",9002313.57,9002313.57,10428,9.1)
S X=$$FIELD^BPSOS57(428)
"^DD",9002313.57,9002313.57,10428,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10428,21,1,0)
Dollar amount of postage claimed.
"^DD",9002313.57,9002313.57,10429,0)
UNIT DOSE INDICATOR^CJ1^^ ; ^S X=$$FIELD^BPSOS57(429)
"^DD",9002313.57,9002313.57,10429,9)
^
"^DD",9002313.57,9002313.57,10429,9.01)

"^DD",9002313.57,9002313.57,10429,9.1)
S X=$$FIELD^BPSOS57(429)
"^DD",9002313.57,9002313.57,10429,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10429,21,1,0)
Code indicating the type of unit dose dispensing. =Not Specified 1=Not
"^DD",9002313.57,9002313.57,10429,21,2,0)
Unit Dose 2=Manufacturer Unit Dose 3=Pharmacy Unit Dose
"^DD",9002313.57,9002313.57,10430,0)
GROSS AMOUNT DUE^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(430)
"^DD",9002313.57,9002313.57,10430,9)
^
"^DD",9002313.57,9002313.57,10430,9.01)

"^DD",9002313.57,9002313.57,10430,9.1)
S X=$$FIELD^BPSOS57(430)
"^DD",9002313.57,9002313.57,10430,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10430,21,1,0)
Total amount submitted to the payer. 
"^DD",9002313.57,9002313.57,10431,0)
OTHER PAYOR AMOUNT^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(431)
"^DD",9002313.57,9002313.57,10431,9)
^
"^DD",9002313.57,9002313.57,10431,9.01)

"^DD",9002313.57,9002313.57,10431,9.1)
S X=$$FIELD^BPSOS57(431)
"^DD",9002313.57,9002313.57,10431,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10431,21,1,0)
Amount of any payment known by the pharmacy from other sources (including
"^DD",9002313.57,9002313.57,10431,21,2,0)
coupons).
"^DD",9002313.57,9002313.57,10432,0)
BASIS OF DAYS SUPPLY DET^CJ1^^ ; ^S X=$$FIELD^BPSOS57(432)
"^DD",9002313.57,9002313.57,10432,9)
^
"^DD",9002313.57,9002313.57,10432,9.01)

"^DD",9002313.57,9002313.57,10432,9.1)
S X=$$FIELD^BPSOS57(432)
"^DD",9002313.57,9002313.57,10432,21,0)
^^3^3^3031222^
"^DD",9002313.57,9002313.57,10432,21,1,0)
Code indicating the method by which the days supply was determined. =Not
"^DD",9002313.57,9002313.57,10432,21,2,0)
specified 1=Explicit directions 2=PRN directions (take as needed
"^DD",9002313.57,9002313.57,10432,21,3,0)
pharmacist estimate) 3=As directed by physician
"^DD",9002313.57,9002313.57,10433,0)
PATIENT PAID AMOUNT^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(433)
"^DD",9002313.57,9002313.57,10433,9)
^
"^DD",9002313.57,9002313.57,10433,9.01)

"^DD",9002313.57,9002313.57,10433,9.1)
S X=$$FIELD^BPSOS57(433)
"^DD",9002313.57,9002313.57,10433,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10433,21,1,0)
Amount the pharmacy received from the patient for the prescription
"^DD",9002313.57,9002313.57,10433,21,2,0)
dispensed.
"^DD",9002313.57,9002313.57,10434,0)
DATE OF INJURY^CJ8^^ ; ^S X=$$FIELD^BPSOS57(434)
"^DD",9002313.57,9002313.57,10434,9)
^
"^DD",9002313.57,9002313.57,10434,9.01)

"^DD",9002313.57,9002313.57,10434,9.1)
S X=$$FIELD^BPSOS57(434)
"^DD",9002313.57,9002313.57,10434,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10434,21,1,0)
Date on which the injury occurred. 
"^DD",9002313.57,9002313.57,10435,0)
CLAIM REF ID NUMBER^CJ14^^ ; ^S X=$$FIELD^BPSOS57(435)
"^DD",9002313.57,9002313.57,10435,9)
^
"^DD",9002313.57,9002313.57,10435,9.01)

"^DD",9002313.57,9002313.57,10435,9.1)
S X=$$FIELD^BPSOS57(435)
"^DD",9002313.57,9002313.57,10435,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10435,21,1,0)
Identifies the claim number assigned by Workers Compensation Program.
"^DD",9002313.57,9002313.57,10435,"DT")
3080212
"^DD",9002313.57,9002313.57,10436,0)
ALT PRODUCT TYPE^CJ1^^ ; ^S X=$$FIELD^BPSOS57(436)
"^DD",9002313.57,9002313.57,10436,9)
^
"^DD",9002313.57,9002313.57,10436,9.01)

"^DD",9002313.57,9002313.57,10436,9.1)
S X=$$FIELD^BPSOS57(436)
"^DD",9002313.57,9002313.57,10436,21,0)
^^16^16^3031222^
"^DD",9002313.57,9002313.57,10436,21,1,0)
Code qualifying the value in 'Product/Service ID' (47-D7) Not Specified
"^DD",9002313.57,9002313.57,10436,21,2,0)
Blank Not Specified  Universal Product Code (UPC) 1 Health Related Item
"^DD",9002313.57,9002313.57,10436,21,3,0)
(HRI) 2 National Drug Code (NDC) 3 Universal Product Number (UPN) 4
"^DD",9002313.57,9002313.57,10436,21,4,0)
Department of Defense (DOD) 5 Drug Use Review/ Professional Pharmacy
"^DD",9002313.57,9002313.57,10436,21,5,0)
Service (DUR/PPS) 6 Common Procedure Terminology (CPT4) 7 Common
"^DD",9002313.57,9002313.57,10436,21,6,0)
Procedure Terminology (CPT5) 8 Health Care Financing Administration
"^DD",9002313.57,9002313.57,10436,21,7,0)
Common Procedural Coding System (HCPCS) 9 Pharmacy Practice Activity
"^DD",9002313.57,9002313.57,10436,21,8,0)
Classification (PPAC) 1 National Pharmaceutical Product Interface
"^DD",9002313.57,9002313.57,10436,21,9,0)
Code(NAPPI) 11 International Article Numbering System(EAN) 12 Drug
"^DD",9002313.57,9002313.57,10436,21,10,0)
Identification Number(DIN) 13 Medi-Span GPI 14 First DataBank GCN 15
"^DD",9002313.57,9002313.57,10436,21,11,0)
Medical Economics GPO 16 Medi-Span DDID 17 First DataBank SmartKey 18
"^DD",9002313.57,9002313.57,10436,21,12,0)
Medical Economics GM 19 International Classification of Diseases(ICD9) 2
"^DD",9002313.57,9002313.57,10436,21,13,0)
International Classification of Diseases (ICD10) 21 Medi-Span Diagnosis
"^DD",9002313.57,9002313.57,10436,21,14,0)
Code 22 Common Dental Terminology (CDT) 25 American Psychiatric
"^DD",9002313.57,9002313.57,10436,21,15,0)
Association Diagnostic Statistical Manual of Mental Disorders (DSM IV)
"^DD",9002313.57,9002313.57,10436,21,16,0)
Other       99
"^DD",9002313.57,9002313.57,10436,"DT")
3080212
"^DD",9002313.57,9002313.57,10437,0)
ALT PRODUCT CODE^CJ13^^ ; ^S X=$$FIELD^BPSOS57(437)
"^DD",9002313.57,9002313.57,10437,9)
^
"^DD",9002313.57,9002313.57,10437,9.01)

"^DD",9002313.57,9002313.57,10437,9.1)
S X=$$FIELD^BPSOS57(437)
"^DD",9002313.57,9002313.57,10437,21,0)
^^4^4^3031222^
"^DD",9002313.57,9002313.57,10437,21,1,0)
This field identifies the actual product code for the item that was
"^DD",9002313.57,9002313.57,10437,21,2,0)
dispensed.  The type of product is defined by field 436-E1. This field
"^DD",9002313.57,9002313.57,10437,21,3,0)
should only be used if the National Drug Code number is not available. The
"^DD",9002313.57,9002313.57,10437,21,4,0)
code number here is the UPC number or the HRI number
"^DD",9002313.57,9002313.57,10437,"DT")
3080212
"^DD",9002313.57,9002313.57,10438,0)
INCENTIVE AMOUNT SUBMITTED^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(438)
"^DD",9002313.57,9002313.57,10438,9)
^
"^DD",9002313.57,9002313.57,10438,9.01)

"^DD",9002313.57,9002313.57,10438,9.1)
S X=$$FIELD^BPSOS57(438)
"^DD",9002313.57,9002313.57,10438,21,0)
^^3^3^3031222^
"^DD",9002313.57,9002313.57,10438,21,1,0)
Amount represents a fee that is submitted by the pharmacy for
"^DD",9002313.57,9002313.57,10438,21,2,0)
contractually agreed upon services. This amount is included in the 'Gross
"^DD",9002313.57,9002313.57,10438,21,3,0)
Amount Due' (43-DU).  
"^DD",9002313.57,9002313.57,10439,0)
DUR CONFLICT CODE^CJ2^^ ; ^S X=$$FIELD^BPSOS57(439)
"^DD",9002313.57,9002313.57,10439,9)
^
"^DD",9002313.57,9002313.57,10439,9.01)

"^DD",9002313.57,9002313.57,10439,9.1)
S X=$$FIELD^BPSOS57(439)
"^DD",9002313.57,9002313.57,10439,21,0)
^^2^2^3080212^
"^DD",9002313.57,9002313.57,10439,21,1,0)
Code identifying the type of utilization conflict detected or the reason
"^DD",9002313.57,9002313.57,10439,21,2,0)
for the pharmacist's professional service.
"^DD",9002313.57,9002313.57,10439,"DT")
3080212
"^DD",9002313.57,9002313.57,10440,0)
DUR INTERVENTION CODE^CJ2^^ ; ^S X=$$FIELD^BPSOS57(440)
"^DD",9002313.57,9002313.57,10440,9)
^
"^DD",9002313.57,9002313.57,10440,9.01)

"^DD",9002313.57,9002313.57,10440,9.1)
S X=$$FIELD^BPSOS57(440)
"^DD",9002313.57,9002313.57,10440,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10440,21,1,0)
Code to indicate whether an intervention was entered.
"^DD",9002313.57,9002313.57,10440,"DT")
3080212
"^DD",9002313.57,9002313.57,10441,0)
DUR OUTCOME CODE^CJ2^^ ; ^S X=$$FIELD^BPSOS57(441)
"^DD",9002313.57,9002313.57,10441,9)
^
"^DD",9002313.57,9002313.57,10441,9.01)

"^DD",9002313.57,9002313.57,10441,9.1)
S X=$$FIELD^BPSOS57(441)
"^DD",9002313.57,9002313.57,10441,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10441,21,1,0)
The outcome of the DUR - whether the prescription had to be modified.
"^DD",9002313.57,9002313.57,10441,"DT")
3080212
"^DD",9002313.57,9002313.57,10442,0)
METRIC DECIMAL QUANTITY^CJ9,3^^ ; ^S X=$$FIELD^BPSOS57(442)
"^DD",9002313.57,9002313.57,10442,9)
^
"^DD",9002313.57,9002313.57,10442,9.01)

"^DD",9002313.57,9002313.57,10442,9.1)
S X=$$FIELD^BPSOS57(442)
"^DD",9002313.57,9002313.57,10442,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10442,21,1,0)
Quantity dispensed expressed in metric decimal units.
"^DD",9002313.57,9002313.57,10443,0)
OTHER PAYOR DATE^CJ8^^ ; ^S X=$$FIELD^BPSOS57(443)
"^DD",9002313.57,9002313.57,10443,9)
^
"^DD",9002313.57,9002313.57,10443,9.01)

"^DD",9002313.57,9002313.57,10443,9.1)
S X=$$FIELD^BPSOS57(443)
"^DD",9002313.57,9002313.57,10443,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10443,21,1,0)
Payment or denial date of the claim submitted to the other payer. Used for
"^DD",9002313.57,9002313.57,10443,21,2,0)
coordination of benefits.
"^DD",9002313.57,9002313.57,10444,0)
PHARMACIST ID^CJ10^^ ; ^S X=$$FIELD^BPSOS57(444)
"^DD",9002313.57,9002313.57,10444,9)
^
"^DD",9002313.57,9002313.57,10444,9.01)

"^DD",9002313.57,9002313.57,10444,9.1)
S X=$$FIELD^BPSOS57(444)
"^DD",9002313.57,9002313.57,10444,21,0)
^.001^2^2^3031222^^
"^DD",9002313.57,9002313.57,10444,21,1,0)
Unique ID assigned to the person responsible for the dispensing of the
"^DD",9002313.57,9002313.57,10444,21,2,0)
prescription or provision of the service.
"^DD",9002313.57,9002313.57,10501,0)
RESPONSE STATUS^CJ1^^ ; ^S X=$$FIELD^BPSOS57(501)
"^DD",9002313.57,9002313.57,10501,9)
^
"^DD",9002313.57,9002313.57,10501,9.01)

"^DD",9002313.57,9002313.57,10501,9.1)
S X=$$FIELD^BPSOS57(501)
"^DD",9002313.57,9002313.57,10501,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10501,21,1,0)
Status flag indicating whether the transaction was "P"aid, "R"ejected,
"^DD",9002313.57,9002313.57,10501,21,2,0)
"A"ccepted, or "C"aptured.
"^DD",9002313.57,9002313.57,10503,0)
AUTHORIZATION NUMBER^CJ14^^ ; ^S X=$$FIELD^BPSOS57(503)
"^DD",9002313.57,9002313.57,10503,9)
^
"^DD",9002313.57,9002313.57,10503,9.01)

"^DD",9002313.57,9002313.57,10503,9.1)
S X=$$FIELD^BPSOS57(503)
"^DD",9002313.57,9002313.57,10503,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10503,21,1,0)
Authorization number for pre-authorization requests.
"^DD",9002313.57,9002313.57,10504,0)
MESSAGE^CJ200^^ ; ^S X=$$FIELD^BPSOS57(504)
"^DD",9002313.57,9002313.57,10504,9)
^
"^DD",9002313.57,9002313.57,10504,9.01)

"^DD",9002313.57,9002313.57,10504,9.1)
S X=$$FIELD^BPSOS57(504)
"^DD",9002313.57,9002313.57,10504,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10504,21,1,0)
Free form Message.
"^DD",9002313.57,9002313.57,10505,0)
PATIENT PAY AMOUNT^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(505)
"^DD",9002313.57,9002313.57,10505,9)
^
"^DD",9002313.57,9002313.57,10505,9.01)

"^DD",9002313.57,9002313.57,10505,9.1)
S X=$$FIELD^BPSOS57(505)
"^DD",9002313.57,9002313.57,10505,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10505,21,1,0)
Amount the patient pays (copay).
"^DD",9002313.57,9002313.57,10505,"DT")
3010405
"^DD",9002313.57,9002313.57,10506,0)
INGREDIENT COST PAID^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(506)
"^DD",9002313.57,9002313.57,10506,9)
^
"^DD",9002313.57,9002313.57,10506,9.01)

"^DD",9002313.57,9002313.57,10506,9.1)
S X=$$FIELD^BPSOS57(506)
"^DD",9002313.57,9002313.57,10506,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10506,21,1,0)
Drug ingredient cost paid included in the 'Total Amount Paid' (59).
"^DD",9002313.57,9002313.57,10507,0)
CONTRACT FEE PAID^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(507)
"^DD",9002313.57,9002313.57,10507,9)
^
"^DD",9002313.57,9002313.57,10507,9.01)

"^DD",9002313.57,9002313.57,10507,9.1)
S X=$$FIELD^BPSOS57(507)
"^DD",9002313.57,9002313.57,10507,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10507,21,1,0)
Dispensing fee paid included in the 'Total Amount Paid' (59).
"^DD",9002313.57,9002313.57,10508,0)
SALES TAX PAID^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(508)
"^DD",9002313.57,9002313.57,10508,9)
^
"^DD",9002313.57,9002313.57,10508,9.01)

"^DD",9002313.57,9002313.57,10508,9.1)
S X=$$FIELD^BPSOS57(508)
"^DD",9002313.57,9002313.57,10508,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10508,21,1,0)
The amount of sales tax paid for the prescription dispensed.
"^DD",9002313.57,9002313.57,10509,0)
TOTAL AMOUNT PAID^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(509)
"^DD",9002313.57,9002313.57,10509,9)
^
"^DD",9002313.57,9002313.57,10509,9.01)

"^DD",9002313.57,9002313.57,10509,9.1)
S X=$$FIELD^BPSOS57(509)
"^DD",9002313.57,9002313.57,10509,21,0)
^^6^6^3031222^
"^DD",9002313.57,9002313.57,10509,21,1,0)
Total amount to be paid by the claims processor (i.e. pharmacy
"^DD",9002313.57,9002313.57,10509,21,2,0)
receivable). Represents a sum of 'Ingredient Cost Paid' (56), 'Dispensing
"^DD",9002313.57,9002313.57,10509,21,3,0)
Fee Paid' (57), 'Flat Sales Tax Amount Paid' (558), 'Percentage Sales Tax
"^DD",9002313.57,9002313.57,10509,21,4,0)
Amount Paid' (559), 'Incentive Amount Paid' (521), 'Professional Service
"^DD",9002313.57,9002313.57,10509,21,5,0)
Fee Paid' (562), 'Other Amount Paid' (565), less 'Patient Pay Amount'
"^DD",9002313.57,9002313.57,10509,21,6,0)
(55) and 'Other Payer Amount Recognized' (566).
"^DD",9002313.57,9002313.57,10510,0)
REJECT COUNT^CJ2^^ ; ^S X=$$FIELD^BPSOS57(510)
"^DD",9002313.57,9002313.57,10510,9)
^
"^DD",9002313.57,9002313.57,10510,9.01)

"^DD",9002313.57,9002313.57,10510,9.1)
S X=$$FIELD^BPSOS57(510)
"^DD",9002313.57,9002313.57,10510,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10510,21,1,0)
Count of 'Reject Code' (511) occurrences.
"^DD",9002313.57,9002313.57,10511,0)
REJECT CODES^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511)
"^DD",9002313.57,9002313.57,10511,9)
^
"^DD",9002313.57,9002313.57,10511,9.01)

"^DD",9002313.57,9002313.57,10511,9.1)
S X=$$FIELD^BPSOS57(511)
"^DD",9002313.57,9002313.57,10511,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511,21,1,0)
Multiple rejection codes. 
"^DD",9002313.57,9002313.57,10511.01,0)
REJECT CODE 1^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.01)
"^DD",9002313.57,9002313.57,10511.01,9)
^
"^DD",9002313.57,9002313.57,10511.01,9.01)

"^DD",9002313.57,9002313.57,10511.01,9.1)
S X=$$FIELD^BPSOS57(511.01)
"^DD",9002313.57,9002313.57,10511.01,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.01,21,1,0)
Reject code #1 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.01,"DT")
3080212
"^DD",9002313.57,9002313.57,10511.02,0)
REJECT CODE 2^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.02)
"^DD",9002313.57,9002313.57,10511.02,9)
^
"^DD",9002313.57,9002313.57,10511.02,9.01)

"^DD",9002313.57,9002313.57,10511.02,9.1)
S X=$$FIELD^BPSOS57(511.02)
"^DD",9002313.57,9002313.57,10511.02,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.02,21,1,0)
Reject code #2 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.02,"DT")
3080212
"^DD",9002313.57,9002313.57,10511.03,0)
REJECT CODE 3^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.03)
"^DD",9002313.57,9002313.57,10511.03,9)
^
"^DD",9002313.57,9002313.57,10511.03,9.01)

"^DD",9002313.57,9002313.57,10511.03,9.1)
S X=$$FIELD^BPSOS57(511.03)
"^DD",9002313.57,9002313.57,10511.03,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.03,21,1,0)
Reject code #3 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.03,"DT")
3080212
"^DD",9002313.57,9002313.57,10511.04,0)
REJECT CODE 4^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.04)
"^DD",9002313.57,9002313.57,10511.04,9)
^
"^DD",9002313.57,9002313.57,10511.04,9.01)

"^DD",9002313.57,9002313.57,10511.04,9.1)
S X=$$FIELD^BPSOS57(511.04)
"^DD",9002313.57,9002313.57,10511.04,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.04,21,1,0)
Reject code #4 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.04,"DT")
3080212
"^DD",9002313.57,9002313.57,10511.05,0)
REJECT CODE 5^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.05)
"^DD",9002313.57,9002313.57,10511.05,9)
^
"^DD",9002313.57,9002313.57,10511.05,9.01)

"^DD",9002313.57,9002313.57,10511.05,9.1)
S X=$$FIELD^BPSOS57(511.05)
"^DD",9002313.57,9002313.57,10511.05,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.05,21,1,0)
Reject code #5 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.05,"DT")
3080212
"^DD",9002313.57,9002313.57,10511.06,0)
REJECT CODE 6^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.06)
"^DD",9002313.57,9002313.57,10511.06,9)
^
"^DD",9002313.57,9002313.57,10511.06,9.01)

"^DD",9002313.57,9002313.57,10511.06,9.1)
S X=$$FIELD^BPSOS57(511.06)
"^DD",9002313.57,9002313.57,10511.06,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.06,21,1,0)
Reject code #6 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.06,"DT")
3080212
"^DD",9002313.57,9002313.57,10511.07,0)
REJECT CODE 7^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.07)
"^DD",9002313.57,9002313.57,10511.07,9)
^
"^DD",9002313.57,9002313.57,10511.07,9.01)

"^DD",9002313.57,9002313.57,10511.07,9.1)
S X=$$FIELD^BPSOS57(511.07)
"^DD",9002313.57,9002313.57,10511.07,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.07,21,1,0)
Reject code #7 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.07,"DT")
3080212
"^DD",9002313.57,9002313.57,10511.08,0)
REJECT CODE 8^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.08)
"^DD",9002313.57,9002313.57,10511.08,9)
^
"^DD",9002313.57,9002313.57,10511.08,9.01)

"^DD",9002313.57,9002313.57,10511.08,9.1)
S X=$$FIELD^BPSOS57(511.08)
"^DD",9002313.57,9002313.57,10511.08,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.08,21,1,0)
Reject code #8 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.08,"DT")
3080212
"^DD",9002313.57,9002313.57,10511.09,0)
REJECT CODE 9^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.09)
"^DD",9002313.57,9002313.57,10511.09,9)
^
"^DD",9002313.57,9002313.57,10511.09,9.01)

"^DD",9002313.57,9002313.57,10511.09,9.1)
S X=$$FIELD^BPSOS57(511.09)
"^DD",9002313.57,9002313.57,10511.09,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.09,21,1,0)
Reject code #9 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.09,"DT")
3080212
"^DD",9002313.57,9002313.57,10511.1,0)
REJECT CODE 10^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.1)
"^DD",9002313.57,9002313.57,10511.1,9)
^
"^DD",9002313.57,9002313.57,10511.1,9.01)

"^DD",9002313.57,9002313.57,10511.1,9.1)
S X=$$FIELD^BPSOS57(511.1)
"^DD",9002313.57,9002313.57,10511.1,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.1,21,1,0)
Reject code #10 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.1,"DT")
3080212
"^DD",9002313.57,9002313.57,10511.11,0)
REJECT CODE 11^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.11)
"^DD",9002313.57,9002313.57,10511.11,9)
^
"^DD",9002313.57,9002313.57,10511.11,9.01)

"^DD",9002313.57,9002313.57,10511.11,9.1)
S X=$$FIELD^BPSOS57(511.11)
"^DD",9002313.57,9002313.57,10511.11,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.11,21,1,0)
Reject code #11 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.11,"DT")
3080212
"^DD",9002313.57,9002313.57,10511.12,0)
REJECT CODE 12^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.12)
"^DD",9002313.57,9002313.57,10511.12,9)
^
"^DD",9002313.57,9002313.57,10511.12,9.01)

"^DD",9002313.57,9002313.57,10511.12,9.1)
S X=$$FIELD^BPSOS57(511.12)
"^DD",9002313.57,9002313.57,10511.12,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.12,21,1,0)
Reject code #12 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.12,"DT")
3080212
"^DD",9002313.57,9002313.57,10511.13,0)
REJECT CODE 13^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.13)
"^DD",9002313.57,9002313.57,10511.13,9)
^
"^DD",9002313.57,9002313.57,10511.13,9.01)

"^DD",9002313.57,9002313.57,10511.13,9.1)
S X=$$FIELD^BPSOS57(511.13)
"^DD",9002313.57,9002313.57,10511.13,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.13,21,1,0)
Reject code #13 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.13,"DT")
3080212
"^DD",9002313.57,9002313.57,10511.14,0)
REJECT CODE 14^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.14)
"^DD",9002313.57,9002313.57,10511.14,9)
^
"^DD",9002313.57,9002313.57,10511.14,9.01)

"^DD",9002313.57,9002313.57,10511.14,9.1)
S X=$$FIELD^BPSOS57(511.14)
"^DD",9002313.57,9002313.57,10511.14,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.14,21,1,0)
Reject code #14 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.14,"DT")
3080212
"^DD",9002313.57,9002313.57,10511.15,0)
REJECT CODE 15^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.15)
"^DD",9002313.57,9002313.57,10511.15,9)
^
"^DD",9002313.57,9002313.57,10511.15,9.01)

"^DD",9002313.57,9002313.57,10511.15,9.1)
S X=$$FIELD^BPSOS57(511.15)
"^DD",9002313.57,9002313.57,10511.15,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.15,21,1,0)
Reject code #15 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.15,"DT")
3080212
"^DD",9002313.57,9002313.57,10511.16,0)
REJECT CODE 16^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.16)
"^DD",9002313.57,9002313.57,10511.16,9)
^
"^DD",9002313.57,9002313.57,10511.16,9.01)

"^DD",9002313.57,9002313.57,10511.16,9.1)
S X=$$FIELD^BPSOS57(511.16)
"^DD",9002313.57,9002313.57,10511.16,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.16,21,1,0)
Reject code #16 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.16,"DT")
3080212
"^DD",9002313.57,9002313.57,10511.17,0)
REJECT CODE 17^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.17)
"^DD",9002313.57,9002313.57,10511.17,9)
^
"^DD",9002313.57,9002313.57,10511.17,9.01)

"^DD",9002313.57,9002313.57,10511.17,9.1)
S X=$$FIELD^BPSOS57(511.17)
"^DD",9002313.57,9002313.57,10511.17,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.17,21,1,0)
Reject code #17 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.17,"DT")
3080212
"^DD",9002313.57,9002313.57,10511.18,0)
REJECT CODE 18^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.18)
"^DD",9002313.57,9002313.57,10511.18,9)
^
"^DD",9002313.57,9002313.57,10511.18,9.01)

"^DD",9002313.57,9002313.57,10511.18,9.1)
S X=$$FIELD^BPSOS57(511.18)
"^DD",9002313.57,9002313.57,10511.18,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.18,21,1,0)
Reject code #18 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.18,"DT")
3080212
"^DD",9002313.57,9002313.57,10511.19,0)
REJECT CODE 19^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.19)
"^DD",9002313.57,9002313.57,10511.19,9)
^
"^DD",9002313.57,9002313.57,10511.19,9.01)

"^DD",9002313.57,9002313.57,10511.19,9.1)
S X=$$FIELD^BPSOS57(511.19)
"^DD",9002313.57,9002313.57,10511.19,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.19,21,1,0)
Reject code #19 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.19,"DT")
3080212
"^DD",9002313.57,9002313.57,10511.2,0)
REJECT CODE 20^CJ60^^ ; ^S X=$$FIELD^BPSOS57(511.2)
"^DD",9002313.57,9002313.57,10511.2,9)
^
"^DD",9002313.57,9002313.57,10511.2,9.01)

"^DD",9002313.57,9002313.57,10511.2,9.1)
S X=$$FIELD^BPSOS57(511.2)
"^DD",9002313.57,9002313.57,10511.2,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10511.2,21,1,0)
Reject code #20 returned in the response by the payer.
"^DD",9002313.57,9002313.57,10511.2,"DT")
3080212
"^DD",9002313.57,9002313.57,10512,0)
ACCUMULATED DEDUCTIBLE AMOUNT^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(512)
"^DD",9002313.57,9002313.57,10512,9)
^
"^DD",9002313.57,9002313.57,10512,9.01)

"^DD",9002313.57,9002313.57,10512,9.1)
S X=$$FIELD^BPSOS57(512)
"^DD",9002313.57,9002313.57,10512,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10512,21,1,0)
Amount in dollars met by the patient/family in a deductible plan.
"^DD",9002313.57,9002313.57,10513,0)
REMAINING DEDUCTIBLE AMOUNT^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(513)
"^DD",9002313.57,9002313.57,10513,9)
^
"^DD",9002313.57,9002313.57,10513,9.01)

"^DD",9002313.57,9002313.57,10513,9.1)
S X=$$FIELD^BPSOS57(513)
"^DD",9002313.57,9002313.57,10513,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10513,21,1,0)
Amount not met by the patient/family in the deductible plan.
"^DD",9002313.57,9002313.57,10514,0)
REMAINING BENEFIT AMOUNT^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(514)
"^DD",9002313.57,9002313.57,10514,9)
^
"^DD",9002313.57,9002313.57,10514,9.01)

"^DD",9002313.57,9002313.57,10514,9.1)
S X=$$FIELD^BPSOS57(514)
"^DD",9002313.57,9002313.57,10514,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10514,21,1,0)
Amount remaining in a patient/family plan with a periodic maximum benefit.
"^DD",9002313.57,9002313.57,10515,0)
POSTAGE AMOUNT PAID^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(515)
"^DD",9002313.57,9002313.57,10515,9)
^
"^DD",9002313.57,9002313.57,10515,9.01)

"^DD",9002313.57,9002313.57,10515,9.1)
S X=$$FIELD^BPSOS57(515)
"^DD",9002313.57,9002313.57,10515,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10515,21,1,0)
Not applicable to the VA.
"^DD",9002313.57,9002313.57,10516,0)
DRUG DESCRIPTION^CJ30^^ ; ^S X=$$FIELD^BPSOS57(516)
"^DD",9002313.57,9002313.57,10516,9)
^
"^DD",9002313.57,9002313.57,10516,9.01)

"^DD",9002313.57,9002313.57,10516,9.1)
S X=$$FIELD^BPSOS57(516)
"^DD",9002313.57,9002313.57,10516,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10516,21,1,0)
Text description for the drug from the drug file 50.
"^DD",9002313.57,9002313.57,10517,0)
AMOUNT APP TO PER DEDUCTIBLE^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(517)
"^DD",9002313.57,9002313.57,10517,9)
^
"^DD",9002313.57,9002313.57,10517,9.01)

"^DD",9002313.57,9002313.57,10517,9.1)
S X=$$FIELD^BPSOS57(517)
"^DD",9002313.57,9002313.57,10517,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10517,21,1,0)
Amount to be collected from a patient that is included in 'Patient Pay
"^DD",9002313.57,9002313.57,10517,21,2,0)
Amount' (55) that is applied to a periodic deductible.
"^DD",9002313.57,9002313.57,10518,0)
AMOUNT OF COPAY COINSURANCE^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(518)
"^DD",9002313.57,9002313.57,10518,9)
^
"^DD",9002313.57,9002313.57,10518,9.01)

"^DD",9002313.57,9002313.57,10518,9.1)
S X=$$FIELD^BPSOS57(518)
"^DD",9002313.57,9002313.57,10518,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10518,21,1,0)
Amount to be collected from the patient that is included in 'Patient Pay
"^DD",9002313.57,9002313.57,10518,21,2,0)
Amount' (55) that is due to a per prescription copay/coinsurance.
"^DD",9002313.57,9002313.57,10518,"DT")
3080212
"^DD",9002313.57,9002313.57,10519,0)
AMOUNT ATTR TO PRODUCT SELECT^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(519)
"^DD",9002313.57,9002313.57,10519,9)
^
"^DD",9002313.57,9002313.57,10519,9.01)

"^DD",9002313.57,9002313.57,10519,9.1)
S X=$$FIELD^BPSOS57(519)
"^DD",9002313.57,9002313.57,10519,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10519,21,1,0)
Amount to be collected from the patient that is included in 'Patient Pay
"^DD",9002313.57,9002313.57,10519,21,2,0)
Amount' (55) that is due to the patient's selection of drug product.
"^DD",9002313.57,9002313.57,10520,0)
AMOUNT EXCEED PER BENEFIT MAX^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(520)
"^DD",9002313.57,9002313.57,10520,9)
^
"^DD",9002313.57,9002313.57,10520,9.01)

"^DD",9002313.57,9002313.57,10520,9.1)
S X=$$FIELD^BPSOS57(520)
"^DD",9002313.57,9002313.57,10520,21,0)
^^3^3^3031222^
"^DD",9002313.57,9002313.57,10520,21,1,0)
Amount to be collected from the patient that is included in 'Patient Pay
"^DD",9002313.57,9002313.57,10520,21,2,0)
Amount' (55) that is due to the patient exceeding a periodic benefit
"^DD",9002313.57,9002313.57,10520,21,3,0)
maximum.
"^DD",9002313.57,9002313.57,10521,0)
INCENTIVE FEE PAID^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(521)
"^DD",9002313.57,9002313.57,10521,9)
^
"^DD",9002313.57,9002313.57,10521,9.01)

"^DD",9002313.57,9002313.57,10521,9.1)
S X=$$FIELD^BPSOS57(521)
"^DD",9002313.57,9002313.57,10521,21,0)
^^3^3^3031222^
"^DD",9002313.57,9002313.57,10521,21,1,0)
Amount represents the contractually agreed upon incentive fee paid for
"^DD",9002313.57,9002313.57,10521,21,2,0)
specific services rendered. Amount is included in the 'Total Amount Paid'
"^DD",9002313.57,9002313.57,10521,21,3,0)
(59).
"^DD",9002313.57,9002313.57,10521,"DT")
3010405
"^DD",9002313.57,9002313.57,10522,0)
BASIS OF REIMBURSEMENT DET^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(522)
"^DD",9002313.57,9002313.57,10522,9)
^
"^DD",9002313.57,9002313.57,10522,9.01)

"^DD",9002313.57,9002313.57,10522,9.1)
S X=$$FIELD^BPSOS57(522)
"^DD",9002313.57,9002313.57,10522,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10522,21,1,0)
Code identifying how the reimbursement amount was calculated for
"^DD",9002313.57,9002313.57,10522,21,2,0)
'Ingredient Cost Paid' (56).
"^DD",9002313.57,9002313.57,10523,0)
AMOUNT ATTRIBUTED TO SALES TAX^CJ8,2^^ ; ^S X=$$FIELD^BPSOS57(523)
"^DD",9002313.57,9002313.57,10523,9)
^
"^DD",9002313.57,9002313.57,10523,9.01)

"^DD",9002313.57,9002313.57,10523,9.1)
S X=$$FIELD^BPSOS57(523)
"^DD",9002313.57,9002313.57,10523,21,0)
^^2^2^3031222^
"^DD",9002313.57,9002313.57,10523,21,1,0)
Amount to be collected from the patient that is included in 'Patient Pay
"^DD",9002313.57,9002313.57,10523,21,2,0)
Amount' (55) that is due to sales tax paid.
"^DD",9002313.57,9002313.57,10524,0)
PLAN ID^CJ8^^ ; ^S X=$$FIELD^BPSOS57(524)
"^DD",9002313.57,9002313.57,10524,9)
^
"^DD",9002313.57,9002313.57,10524,9.01)

"^DD",9002313.57,9002313.57,10524,9.1)
S X=$$FIELD^BPSOS57(524)
"^DD",9002313.57,9002313.57,10524,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10524,21,1,0)
Plan Identification Number.
"^DD",9002313.57,9002313.57,10525,0)
DUR RESPONSE DATA^CJ160^^ ; ^S X=$$FIELD^BPSOS57(525)
"^DD",9002313.57,9002313.57,10525,9)
^
"^DD",9002313.57,9002313.57,10525,9.01)

"^DD",9002313.57,9002313.57,10525,9.1)
S X=$$FIELD^BPSOS57(525)
"^DD",9002313.57,9002313.57,10525,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10525,21,1,0)
Text that provides additional detail regarding a DUR conflict.
"^DD",9002313.57,9002313.57,10525.01,0)
DUR COUNT^CJ1^^ ; ^X ^DD(9002313.57,10525.01,9.6) S X=$S(Y(9002313.57,10525.01,2):Y(9002313.57,10525.01,3),Y(9002313.57,10525.01,5):Y(9002313.57,10525.01,6),Y(9002313.57,10525.01,8):Y(9002313.57,10525.01,9),Y(9002313.57,10525.01,10):X)
"^DD",9002313.57,9002313.57,10525.01,9)
^
"^DD",9002313.57,9002313.57,10525.01,9.01)
9002313.57^10525.3;9002313.57^10525.2;9002313.57^10525.1
"^DD",9002313.57,9002313.57,10525.01,9.1)
$S(DUR 1 RAW DATA="":0,DUR 2 RAW DATA="":1,DUR 3 RAW DATA="":2,1:3)
"^DD",9002313.57,9002313.57,10525.01,9.2)
X "N I,Y "_$P(^DD(9002313.57,10525.1,0),U,5,99) S Y(9002313.57,10525.01,1)=X X "N I,Y "_$P(^DD(9002313.57,10525.2,0),U,5,99) S Y(9002313.57,10525.01,4)=X
"^DD",9002313.57,9002313.57,10525.01,9.3)
X ^DD(9002313.57,10525.01,9.2) X "N I,Y "_$P(^DD(9002313.57,10525.3,0),U,5,99) S Y(9002313.57,10525.01,7)=X S X=Y(9002313.57,10525.01,1)=""
"^DD",9002313.57,9002313.57,10525.01,9.4)
X ^DD(9002313.57,10525.01,9.3) S Y(9002313.57,10525.01,2)=$G(X) S X=0,Y(9002313.57,10525.01,3)=$G(X) S X=Y(9002313.57,10525.01,4)=""
"^DD",9002313.57,9002313.57,10525.01,9.5)
X ^DD(9002313.57,10525.01,9.4) S Y(9002313.57,10525.01,5)=$G(X) S X=1,Y(9002313.57,10525.01,6)=$G(X) S X=Y(9002313.57,10525.01,7)=""
"^DD",9002313.57,9002313.57,10525.01,9.6)
X ^DD(9002313.57,10525.01,9.5) S Y(9002313.57,10525.01,8)=$G(X) S X=2,Y(9002313.57,10525.01,9)=$G(X) S X=1,Y(9002313.57,10525.01,10)=$G(X) S X=3
"^DD",9002313.57,9002313.57,10525.01,21,0)
^^1^1^3031222^
"^DD",9002313.57,9002313.57,10525.01,21,1,0)
Number of DUR messages to be displayed.
"^DD",9002313.57,9002313.57,10525.01,"DT")
3080212
"^DD",9002313.57,9002313.57,10525.1,0)
DUR 1 RAW DATA^CJ53^^ ; ^X ^DD(9002313.57,10525.1,9.5) S X=$S(Y(9002313.57,10525.1,4):Y(9002313.57,10525.1,5),Y(9002313.57,10525.1,6):X)
"^DD",9002313.57,9002313.57,10525.1,9)
^
"^DD",9002313.57,9002313.57,10525.1,9.01)
9002313.57^10525
"^DD",9002313.57,9002313.57,10525.1,9.1)
$S($E(DUR RESPONSE DATA,1,2)="  ":"",1:$E(DUR RESPONSE DATA,1,53))
"^DD",9002313.57,9002313.57,10525.1,9.2)
X $P(^DD(9002313.57,10525,0),U,5,99) S Y(9002313.57,10525.1,1)=X S X=Y(9002313.57,10525.1,1),Y(9002313.57,10525.1,2)=X S X=1,Y(9002313.57,10525.1,3)=X S X=2
"^DD",9002313.57,9002313.57,10525.1,9.3)
X ^DD(9002313.57,10525.1,9.2) S X=$E(Y(9002313.57,10525.1,2),Y(9002313.57,10525.1,3),X)="  ",Y(9002313.57,10525.1,4)=X S X="",Y(9002313.57,10525.1,5)=X S X=1
"^DD",9002313.57,9002313.57,10525.1,9.4)
X ^DD(9002313.57,10525.1,9.3) S Y(9002313.57,10525.1,6)=X,Y(9002313.57,10525.1,7)=X S X=Y(9002313.57,10525.1,1),Y(9002313.57,10525.1,8)=X S X=1
"^DD",9002313.57,9002313.57,10525.1,9.5)
X ^DD(9002313.57,10525.1,9.4) S Y(9002313.57,10525.1,9)=X S X=53,X=$E(Y(9002313.57,10525.1,8),Y(9002313.57,10525.1,9),X)
"^DD",9002313.57,9002313.57,10525.1,21,0)
^^1^1^3080212^
"^DD",9002313.57,9002313.57,10525.1,21,1,0)
Raw Data DUR message sent from the payer and stored in the response file.
"^DD",9002313.57,9002313.57,10525.1,"DT")
3080212
"^DD",9002313.57,9002313.57,10525.1439,0)
DUR 1 DRUG CONFLICT CODE^CJ2^^ ; ^X ^DD(9002313.57,10525.1439,9.2) S Y(9002313.57,10525.1439,3)=X S X=2,X=$E(Y(9002313.57,10525.1439,2),Y(9002313.57,10525.1439,3),X)
"^DD",9002313.57,9002313.57,10525.1439,9)
^
"^DD",9002313.57,9002313.57,10525.1439,9.01)
9002313.57^10525
"^DD",9002313.57,9002313.57,10525.1439,9.1)
$E(DUR RESPONSE DATA,1,2)
"^DD",9002313.57,9002313.57,10525.1439,9.2)
X $P(^DD(9002313.57,10525,0),U,5,99) S Y(9002313.57,10525.1439,1)=X S X=Y(9002313.57,10525.1439,1),Y(9002313.57,10525.1439,2)=X S X=1
"^DD",9002313.57,9002313.57,10525.1439,21,0)
^^1^1^3080212^
"^DD",9002313.57,9002313.57,10525.1439,21,1,0)
Severity level code for the first DUR.
"^DD",9002313.57,9002313.57,10525.1439,"DT")
3080212
"^DD",9002313.57,9002313.57,10525.1528,0)
DUR 1 SEVERITY INDEX CODE^CJ1^^ ; ^X ^DD(9002313.57,10525.1528,9.2) S X=$E(Y(9002313.57,10525.1528,2),X)
"^DD",9002313.57,9002313.57,10525.1528,9)
^
"^DD",9002313.57,9002313.57,10525.1528,9.01)
9002313.57^10525
"^DD",9002313.57,9002313.57,10525.1528,9.1)
$E(DUR RESPONSE DATA,3)
"^DD",9002313.57,9002313.57,10525.1528,9.2)
X $P(^DD(9002313.57,10525,0),U,5,99) S Y(9002313.57,10525.1528,1)=X S X=Y(9002313.57,10525.1528,1),Y(9002313.57,10525.1528,2)=X S X=3
"^DD",9002313.57,9002313.57,10525.1528,21,0)
^^4^4^3080212^
"^DD",9002313.57,9002313.57,10525.1528,21,1,0)
Blank=Not Specified
"^DD",9002313.57,9002313.57,10525.1528,21,2,0)
1=Major
"^DD",9002313.57,9002313.57,10525.1528,21,3,0)
2=Moderate
"^DD",9002313.57,9002313.57,10525.1528,21,4,0)
3=Minor
"^DD",9002313.57,9002313.57,10525.1528,"DT")
3080212
"^DD",9002313.57,9002313.57,10525.1529,0)
DUR 1 OTHER PHARMACY INDIC^CJ1^^ ; ^X ^DD(9002313.57,10525.1529,9.2) S X=$E(Y(9002313.57,10525.1529,2),X)
"^DD",9002313.57,9002313.57,10525.1529,9)
^
"^DD",9002313.57,9002313.57,10525.1529,9.01)
9002313.57^10525
"^DD",9002313.57,9002313.57,10525.1529,9.1)
$E(DUR RESPONSE DATA,4)
"^DD",9002313.57,9002313.57,10525.1529,9.2)
X $P(^DD(9002313.57,10525,0),U,5,99) S Y(9002313.57,10525.1529,1)=X S X=Y(9002313.57,10525.1529,1),Y(9002313.57,10525.1529,2)=X S X=4
"^DD",9002313.57,9002313.57,10525.1529,21,0)
^^4^4^3080212^
"^DD",9002313.57,9002313.57,10525.1529,21,1,0)
=Not Specified
"^DD",9002313.57,9002313.57,10525.1529,21,2,0)
1=Your Pharmacy
"^DD",9002313.57,9002313.57,10525.1529,21,3,0)
2=Other Pharmacy in Same Chain
"^DD",9002313.57,9002313.57,10525.1529,21,4,0)
3=Other Pharmacy
"^DD",9002313.57,9002313.57,10525.1529,"DT")
3080212
"^DD",9002313.57,9002313.57,10525.153,0)
DUR 1 PREVIOUS DATE OF FILL^CJ8^^ ; ^X ^DD(9002313.57,10525.153,9.2) S Y(9002313.57,10525.153,3)=X S X=12,X=$E(Y(9002313.57,10525.153,2),Y(9002313.57,10525.153,3),X)
"^DD",9002313.57,9002313.57,10525.153,9)
^
"^DD",9002313.57,9002313.57,10525.153,9.01)
9002313.57^10525
"^DD",9002313.57,9002313.57,10525.153,9.1)
$E(DUR RESPONSE DATA,5,12)
"^DD",9002313.57,9002313.57,10525.153,9.2)
X $P(^DD(9002313.57,10525,0),U,5,99) S Y(9002313.57,10525.153,1)=X S X=Y(9002313.57,10525.153,1),Y(9002313.57,10525.153,2)=X S X=5
"^DD",9002313.57,9002313.57,10525.153,21,0)
^^1^1^3080212^
"^DD",9002313.57,9002313.57,10525.153,21,1,0)
Previous fill date
"^DD",9002313.57,9002313.57,10525.153,"DT")
3080212
"^DD",9002313.57,9002313.57,10525.1531,0)
DUR 1 QTY OF PREVIOUS FILL^CJ5^^ ; ^X ^DD(9002313.57,10525.1531,9.2) S Y(9002313.57,10525.1531,3)=X S X=17,X=$E(Y(9002313.57,10525.1531,2),Y(9002313.57,10525.1531,3),X)
"^DD",9002313.57,9002313.57,10525.1531,9)
^
"^DD",9002313.57,9002313.57,10525.1531,9.01)
9002313.57^10525
"^DD",9002313.57,9002313.57,10525.1531,9.1)
$E(DUR RESPONSE DATA,13,17)
"^DD",9002313.57,9002313.57,10525.1531,9.2)
X $P(^DD(9002313.57,10525,0),U,5,99) S Y(9002313.57,10525.1531,1)=X S X=Y(9002313.57,10525.1531,1),Y(9002313.57,10525.1531,2)=X S X=13
"^DD",9002313.57,9002313.57,10525.1531,21,0)
^^1^1^3080212^
"^DD",9002313.57,9002313.57,10525.1531,21,1,0)
The quantity of the previous fill that caused the DUR to be triggered.
"^DD",9002313.57,9002313.57,10525.1531,"DT")
3080212
"^DD",9002313.57,9002313.57,10525.1532,0)
DUR 1 DATABASE INDICATOR^CJ1^^ ; ^X ^DD(9002313.57,10525.1532,9.2) S X=$E(Y(9002313.57,10525.1532,2),X)
"^DD",9002313.57,9002313.57,10525.1532,9)
^
"^DD",9002313.57,9002313.57,10525.1532,9.01)
9002313.57^10525
"^DD",9002313.57,9002313.57,10525.1532,9.1)
$E(DUR RESPONSE DATA,18)
"^DD",9002313.57,9002313.57,10525.1532,9.2)
X $P(^DD(9002313.57,10525,0),U,5,99) S Y(9002313.57,10525.1532,1)=X S X=Y(9002313.57,10525.1532,1),Y(9002313.57,10525.1532,2)=X S X=18
"^DD",9002313.57,9002313.57,10525.1532,21,0)
^^6^6^3080212^
"^DD",9002313.57,9002313.57,10525.1532,21,1,0)
Blank=Not Specified
"^DD",9002313.57,9002313.57,10525.1532,21,2,0)
1=First Databank
"^DD",9002313.57,9002313.57,10525.1532,21,3,0)
2=Medi-Span
"^DD",9002313.57,9002313.57,10525.1532,21,4,0)
3=Redbook
"^DD",9002313.57,9002313.57,10525.1532,21,5,0)
4=Processor Developed
"^DD",9002313.57,9002313.57,10525.1532,21,6,0)
5=Other
"^DD",9002313.57,9002313.57,10525.1532,"DT")
3080212
"^DD",9002313.57,9002313.57,10525.1533,0)
DUR 1 OTHER PRESCRIBER INDIC^CJ1^^ ; ^X ^DD(9002313.57,10525.1533,9.2) S X=$E(Y(9002313.57,10525.1533,2),X)
"^DD",9002313.57,9002313.57,10525.1533,9)
^
"^DD",9002313.57,9002313.57,10525.1533,9.01)
9002313.57^10525
"^DD",9002313.57,9002313.57,10525.1533,9.1)
$E(DUR RESPONSE DATA,19)
"^DD",9002313.57,9002313.57,10525.1533,9.2)
X $P(^DD(9002313.57,10525,0),U,5,99) S Y(9002313.57,10525.1533,1)=X S X=Y(9002313.57,10525.1533,1),Y(9002313.57,10525.1533,2)=X S X=19
"^DD",9002313.57,9002313.57,10525.1533,21,0)
^^6^6^3080212^
"^DD",9002313.57,9002313.57,10525.1533,21,1,0)
Code that indicates the prescriber of the current fill relationship to the
"^DD",9002313.57,9002313.57,10525.1533,21,2,0)
prescriber of the conflicting prescription.
"^DD",9002313.57,9002313.57,10525.1533,21,3,0)
 
"^DD",9002313.57,9002313.57,10525.1533,21,4,0)
=Not Specified
"^DD",9002313.57,9002313.57,10525.1533,21,5,0)
1=Same Prescriber
"^DD",9002313.57,9002313.57,10525.1533,21,6,0)
2=Other Prescriber
"^DD",9002313.57,9002313.57,10525.1533,"DT")
3080212
"^DD",9002313.57,9002313.57,10525.1544,0)
DUR 1 FREE TEXT^CJ30^^ ; ^X ^DD(9002313.57,10525.1544,9.2) S Y(9002313.57,10525.1544,3)=X S X=49,X=$E(Y(9002313.57,10525.1544,2),Y(9002313.57,10525.1544,3),X)
"^DD",9002313.57,9002313.57,10525.1544,9)
^
"^DD",9002313.57,9002313.57,10525.1544,9.01)
9002313.57^10525
"^DD",9002313.57,9002313.57,10525.1544,9.1)
$E(DUR RESPONSE DATA,20,49)
"^DD",9002313.57,9002313.57,10525.1544,9.2)
X $P(^DD(9002313.57,10525,0),U,5,99) S Y(9002313.57,10525.1544,1)=X S X=Y(9002313.57,10525.1544,1),Y(9002313.57,10525.1544,2)=X S X=20
"^DD",9002313.57,9002313.57,10525.1544,21,0)
^^1^1^3080212^
"^DD",9002313.57,9002313.57,10525.1544,21,1,0)
Actual DUR text
"^DD",9002313.57,9002313.57,10525.1544,"DT")
3080212
"^DD",9002313.57,9002313.57,10525.1999,0)
DUR 1 RESERVE SPACE^CJ4^^ ; ^X ^DD(9002313.57,10525.1999,9.2) S Y(9002313.57,10525.1999,3)=X S X=53,X=$E(Y(9002313.57,10525.1999,2),Y(9002313.57,10525.1999,3),X)
"^DD",9002313.57,9002313.57,10525.1999,9)
^
"^DD",9002313.57,9002313.57,10525.1999,9.01)
9002313.57^10525
"^DD",9002313.57,9002313.57,10525.1999,9.1)
$E(DUR RESPONSE DATA,50,53)
"^DD",9002313.57,9002313.57,10525.1999,9.2)
X $P(^DD(9002313.57,10525,0),U,5,99) S Y(9002313.57,10525.1999,1)=X S X=Y(9002313.57,10525.1999,1),Y(9002313.57,10525.1999,2)=X S X=50
"^DD",9002313.57,9002313.57,10525.1999,21,0)
^^1^1^3080212^
"^DD",9002313.57,9002313.57,10525.1999,21,1,0)
Reserved space for additional information.
"^DD",9002313.57,9002313.57,10525.1999,"DT")
3080212
"^DD",9002313.57,9002313.57,10525.2,0)
DUR 2 RAW DATA^CJ53^^ ; ^X ^DD(9002313.57,10525.2,9.5) S X=$S(Y(9002313.57,10525.2,4):Y(9002313.57,10525.2,5),Y(9002313.57,10525.2,6):X)
"^DD",9002313.57,9002313.57,10525.2,9)
^
"^DD",9002313.57,9002313.57,10525.2,9.01)
9002313.57^10525
"^DD",9002313.57,9002313.57,10525.2,9.1)
$S($E(DUR RESPONSE DATA,54,55)="  ":"",1:$E(DUR RESPONSE DATA,54,106))
"^DD",9002313.57,9002313.57,10525.2,9.2)
X $P(^DD(9002313.57,10525,0),U,5,99) S Y(9002313.57,10525.2,1)=X S X=Y(9002313.57,10525.2,1),Y(9002313.57,10525.2,2)=X S X=54,Y(9002313.57,10525.2,3)=X S X=55
"^DD",9002313.57,9002313.57,10525.2,9.3)
X ^DD(9002313.57,10525.2,9.2) S X=$E(Y(9002313.57,10525.2,2),Y(9002313.57,10525.2,3),X)="  ",Y(9002313.57,10525.2,4)=X S X="",Y(9002313.57,10525.2,5)=X S X=1
"^DD",9002313.57,9002313.57,10525.2,9.4)
X ^DD(9002313.57,10525.2,9.3) S Y(9002313.57,10525.2,6)=X,Y(9002313.57,10525.2,7)=X S X=Y(9002313.57,10525.2,1),Y(9002313.57,10525.2,8)=X S X=54
"^DD",9002313.57,9002313.57,10525.2,9.5)
X ^DD(9002313.57,10525.2,9.4) S Y(9002313.57,10525.2,9)=X S X=106,X=$E(Y(9002313.57,10525.2,8),Y(9002313.57,10525.2,9),X)
"^DD",9002313.57,9002313.57,10525.2,21,0)
^^1^1^3080212^
"^DD",9002313.57,9002313.57,10525.2,21,1,0)
DUR information returned by the payer that has not been formatted yet.
"^DD",9002313.57,9002313.57,10525.2,"DT")
3080212
"^DD",9002313.57,9002313.57,10525.2439,0)
DUR 2 DRUG CONFLICT CODE^CJ2^^ ; ^X ^DD(9002313.57,10525.2439,9.2) S Y(9002313.57,10525.2439,3)=$G(X) S X=2,X=$E(Y(9002313.57,10525.2439,2),Y(9002313.57,10525.2439,3),X)
"^DD",9002313.57,9002313.57,10525.2439,9)
^
"^DD",9002313.57,9002313.57,10525.2439,9.01)
9002313.57^10525.2
"^DD",9002313.57,9002313.57,10525.2439,9.1)
$E(DUR 2 RAW DATA,1,2)
"^DD",9002313.57,9002313.57,10525.2439,9.2)
X "N I,Y "_$P(^DD(9002313.57,10525.2,0),U,5,99) S Y(9002313.57,10525.2439,1)=X S X=Y(9002313.57,10525.2439,1),Y(9002313.57,10525.2439,2)=$G(X) S X=1
"^DD",9002313.57,9002313.57,10525.2439,21,0)
^^4^4^3080212^
"^DD",9002313.57,9002313.57,10525.2439,21,1,0)
=Not Specified
"^DD",9002313.57,9002313.57,10525.2439,21,2,0)
1=Your Pharmacy
"^DD",9002313.57,9002313.57,10525.2439,21,3,0)
2=Other Pharmacy in Same Chain
"^DD",9002313.57,9002313.57,10525.2439,21,4,0)
3=Other Pharmacy
"^DD",9002313.57,9002313.57,10525.2439,"DT")
3080212
"^DD",9002313.57,9002313.57,10525.2528,0)
DUR 2 SEVERITY INDEX CODE^CJ1^^ ; ^X ^DD(9002313.57,10525.2528,9.2) S X=$E(Y(9002313.57,10525.2528,2),X)
"^DD",9002313.57,9002313.57,10525.2528,9)
^
"^DD",9002313.57,9002313.57,10525.2528,9.01)
9002313.57^10525.2
"^DD",9002313.57,9002313.57,10525.2528,9.1)
$E(DUR 2 RAW DATA,3)
"^DD",9002313.57,9002313.57,10525.2528,9.2)
X "N I,Y "_$P(^DD(9002313.57,10525.2,0),U,5,99) S Y(9002313.57,10525.2528,1)=X S X=Y(9002313.57,10525.2528,1),Y(9002313.57,10525.2528,2)=$G(X) S X=3
"^DD",9002313.57,9002313.57,10525.2528,21,0)
^^4^4^3080212^
"^DD",9002313.57,9002313.57,10525.2528,21,1,0)
Blank=Not Specified
"^DD",9002313.57,9002313.57,10525.2528,21,2,0)
1=Major
"^DD",9002313.57,9002313.57,10525.2528,21,3,0)
2=Moderate
"^DD",9002313.57,9002313.57,10525.2528,21,4,0)
3=Minor
"^DD",9002313.57,9002313.57,10525.2528,"DT")
3080212
"^DD",9002313.57,9002313.57,10525.2529,0)
DUR 2 OTHER PHARMACY INDIC^CJ1^^ ; ^X ^DD(9002313.57,10525.2529,9.2) S X=$E(Y(9002313.57,10525.2529,2),X)
"^DD",9002313.57,9002313.57,10525.2529,9)
^
"^DD",9002313.57,9002313.57,10525.2529,9.01)
9002313.57^10525.2
"^DD",9002313.57,9002313.57,10525.2529,9.1)
$E(DUR 2 RAW DATA,4)
"^DD",9002313.57,9002313.57,10525.2529,9.2)
X "N I,Y "_$P(^DD(9002313.57,10525.2,0),U,5,99) S Y(9002313.57,10525.2529,1)=X S X=Y(9002313.57,10525.2529,1),Y(9002313.57,10525.2529,2)=$G(X) S X=4
"^DD",9002313.57,9002313.57,10525.2529,21,0)
^^4^4^3080212^
"^DD",9002313.57,9002313.57,10525.2529,21,1,0)
=Not Specified
"^DD",9002313.57,9002313.57,10525.2529,21,2,0)
1=Your Pharmacy
"^DD",9002313.57,9002313.57,10525.2529,21,3,0)
2=Other Pharmacy in Same Chain
"^DD",9002313.57,9002313.57,10525.2529,21,4,0)
3=Other Pharmacy
"^DD",9002313.57,9002313.57,10525.2529,"DT")
3080212
"^DD",9002313.57,9002313.57,10525.253,0)
DUR 2 PREVIOUS DATE OF FILL^CJ8^^ ; ^X ^DD(9002313.57,10525.253,9.2) S Y(9002313.57,10525.253,3)=$G(X) S X=12,X=$E(Y(9002313.57,10525.253,2),Y(9002313.57,10525.253,3),X)
"^DD",9002313.57,9002313.57,10525.253,9)
^
"^DD",9002313.57,9002313.57,10525.253,9.01)
9002313.57^10525.2
"^DD",9002313.57,9002313.57,10525.253,9.1)
$E(DUR 2 RAW DATA,5,12)
"^DD",9002313.57,9002313.57,10525.253,9.2)
X "N I,Y "_$P(^DD(9002313.57,10525.2,0),U,5,99) S Y(9002313.57,10525.253,1)=X S X=Y(9002313.57,10525.253,1),Y(9002313.57,10525.253,2)=$G(X) S X=5
"^DD",9002313.57,9002313.57,10525.253,21,0)
^^1^1^3080212^
"^DD",9002313.57,9002313.57,10525.253,21,1,0)
Fill date of the previous fill that is causing the DUR conflict.
"^DD",9002313.57,9002313.57,10525.253,"DT")
3080212
"^DD",9002313.57,9002313.57,10525.2531,0)
DUR 2 QTY OF PREVIOUS FILL^CJ5^^ ; ^X ^DD(9002313.57,10525.2531,9.2) S Y(9002313.57,10525.2531,3)=$G(X) S X=17,X=$E(Y(9002313.57,10525.2531,2),Y(9002313.57,10525.2531,3),X)
"^DD",9002313.57,9002313.57,10525.2531,9)
^
"^DD",9002313.57,9002313.57,10525.2531,9.01)
9002313.57^10525.2
"^DD",9002313.57,9002313.57,10525.2531,9.1)
$E(DUR 2 RAW DATA,13,17)
"^DD",9002313.57,9002313.57,10525.2531,9.2)
X "N I,Y "_$P(^DD(9002313.57,10525.2,0),U,5,99) S Y(9002313.57,10525.2531,1)=X S X=Y(9002313.57,10525.2531,1),Y(9002313.57,10525.2531,2)=$G(X) S X=13
"^DD",9002313.57,9002313.57,10525.2531,21,0)
^^1^1^3080212^
"^DD",9002313.57,9002313.57,10525.2531,21,1,0)
Quantity of the fill that is causing the conflict.
"^DD",9002313.57,9002313.57,10525.2531,"DT")
3080212
"^DD",9002313.57,9002313.57,10525.2532,0)
DUR 2 DATABASE INDICATOR^CJ1^^ ; ^X ^DD(9002313.57,10525.2532,9.2) S X=$E(Y(9002313.57,10525.2532,2),X)
"^DD",9002313.57,9002313.57,10525.2532,9)
^
"^DD",9002313.57,9002313.57,10525.2532,9.01)
9002313.57^10525.2
"^DD",9002313.57,9002313.57,10525.2532,9.1)
$E(DUR 2 RAW DATA,18)
"^DD",9002313.57,9002313.57,10525.2532,9.2)
X "N I,Y "_$P(^DD(9002313.57,10525.2,0),U,5,99) S Y(9002313.57,10525.2532,1)=X S X=Y(9002313.57,10525.2532,1),Y(9002313.57,10525.2532,2)=$G(X) S X=18
"^DD",9002313.57,9002313.57,10525.2532,21,0)
^^6^6^3080212^
"^DD",9002313.57,9002313.57,10525.2532,21,1,0)
Blank=Not Specified
"^DD",9002313.57,9002313.57,10525.2532,21,2,0)
1=First Databank
"^DD",9002313.57,9002313.57,10525.2532,21,3,0)
2=Medi-Span
"^DD",9002313.57,9002313.57,10525.2532,21,4,0)
3=Redbook
"^DD",9002313.57,9002313.57,10525.2532,21,5,0)
4=Processor Developed
"^DD",9002313.57,9002313.57,10525.2532,21,6,0)
5=Other
"^DD",9002313.57,9002313.57,10525.2532,"DT")
3080212
"^DD",9002313.57,9002313.57,10525.2533,0)
DUR 2 OTHER PRESCRIBER INDIC^CJ1^^ ; ^X ^DD(9002313.57,10525.2533,9.2) S X=$E(Y(9002313.57,10525.2533,2),X)
"^DD",9002313.57,9002313.57,10525.2533,9)
^
"^DD",9002313.57,9002313.57,10525.2533,9.01)
9002313.57^10525.2
"^DD",9002313.57,9002313.57,10525.2533,9.1)
$E(DUR 2 RAW DATA,19)
"^DD",9002313.57,9002313.57,10525.2533,9.2)
X "N I,Y "_$P(^DD(9002313.57,10525.2,0),U,5,99) S Y(9002313.57,10525.2533,1)=X S X=Y(9002313.57,10525.2533,1),Y(9002313.57,10525.2533,2)=$G(X) S X=19
"^DD",9002313.57,9002313.57,10525.2533,21,0)
^^6^6^3080212^
"^DD",9002313.57,9002313.57,10525.2533,21,1,0)
Code that indicates the prescriber of the current fill relationship to the
"^DD",9002313.57,9002313.57,10525.2533,21,2,0)
prescriber of the conflicting prescription.
"^DD",9002313.57,9002313.57,10525.2533,21,3,0)
 
"^DD",9002313.57,9002313.57,10525.2533,21,4,0)
=Not Specified
"^DD",9002313.57,9002313.57,10525.2533,21,5,0)
1=Same Prescriber
"^DD",9002313.57,9002313.57,10525.2533,21,6,0)
2=Other Prescriber
"^DD",9002313.57,9002313.57,10525.2533,"DT")
3080212
"^DD",9002313.57,9002313.57,10525.2544,0)
DUR 2 FREE TEXT^CJ30^^ ; ^X ^DD(9002313.57,10525.2544,9.2) S Y(9002313.57,10525.2544,3)=$G(X) S X=49,X=$E(Y(9002313.57,10525.2544,2),Y(9002313.57,10525.2544,3),X)
"^DD",9002313.57,9002313.57,10525.2544,9)
^
"^DD",9002313.57,9002313.57,10525.2544,9.01)
9002313.57^10525.2
"^DD",9002313.57,9002313.57,10525.2544,9.1)
$E(DUR 2 RAW DATA,20,49)
"^DD",9002313.57,9002313.57,10525.2544,9.2)
X "N I,Y "_$P(^DD(9002313.57,10525.2,0),U,5,99) S Y(9002313.57,10525.2544,1)=X S X=Y(9002313.57,10525.2544,1),Y(9002313.57,10525.2544,2)=$G(X) S X=20
"^DD",9002313.57,9002313.57,10525.2544,21,0)
^^1^1^3080212^
"^DD",9002313.57,9002313.57,10525.2544,21,1,0)
Actual DUR text
"^DD",9002313.57,9002313.57,10525.2544,"DT")
3080212
"^DD",9002313.57,9002313.57,10525.2999,0)
DUR 2 RESERVE SPACE^CJ4^^ ; ^X ^DD(9002313.57,10525.2999,9.2) S Y(9002313.57,10525.2999,3)=$G(X) S X=53,X=$E(Y(9002313.57,10525.2999,2),Y(9002313.57,10525.2999,3),X)
"^DD",9002313.57,9002313.57,10525.2999,9)
^
"^DD",9002313.57,9002313.57,10525.2999,9.01)
9002313.57^10525.2
"^DD",9002313.57,9002313.57,10525.2999,9.1)
$E(DUR 2 RAW DATA,50,53)
"^DD",9002313.57,9002313.57,10525.2999,9.2)
X "N I,Y "_$P(^DD(9002313.57,10525.2,0),U,5,99) S Y(9002313.57,10525.2999,1)=X S X=Y(9002313.57,10525.2999,1),Y(9002313.57,10525.2999,2)=$G(X) S X=50
"^DD",9002313.57,9002313.57,10525.2999,21,0)
^^1^1^3080212^
"^DD",9002313.57,9002313.57,10525.2999,21,1,0)
Reserved space for additional information.
"^DD",9002313.57,9002313.57,10525.2999,"DT")
3080212
"^DD",9002313.57,9002313.57,10525.3,0)
DUR 3 RAW DATA^CJ53^^ ; ^X ^DD(9002313.57,10525.3,9.5) S X=$S(Y(9002313.57,10525.3,4):Y(9002313.57,10525.3,5),Y(9002313.57,10525.3,6):X)
"^DD",9002313.57,9002313.57,10525.3,9)
^
"^DD",9002313.57,9002313.57,10525.3,9.01)
9002313.57^10525
"^DD",9002313.57,9002313.57,10525.3,9.1)
$S($E(DUR RESPONSE DATA,107,108)="  ":"",1:$E(DUR RESPONSE DATA,107,159))
"^DD",9002313.57,9002313.57,10525.3,9.2)
X $P(^DD(9002313.57,10525,0),U,5,99) S Y(9002313.57,10525.3,1)=X S X=Y(9002313.57,10525.3,1),Y(9002313.57,10525.3,2)=X S X=107,Y(9002313.57,10525.3,3)=X S X=108
"^DD",9002313.57,9002313.57,10525.3,9.3)
X ^DD(9002313.57,10525.3,9.2) S X=$E(Y(9002313.57,10525.3,2),Y(9002313.57,10525.3,3),X)="  ",Y(9002313.57,10525.3,4)=X S X="",Y(9002313.57,10525.3,5)=X S X=1
"^DD",9002313.57,9002313.57,10525.3,9.4)
X ^DD(9002313.57,10525.3,9.3) S Y(9002313.57,10525.3,6)=X,Y(9002313.57,10525.3,7)=X S X=Y(9002313.57,10525.3,1),Y(9002313.57,10525.3,8)=X S X=107
"^DD",9002313.57,9002313.57,10525.3,9.5)
X ^DD(9002313.57,10525.3,9.4) S Y(9002313.57,10525.3,9)=X S X=159,X=$E(Y(9002313.57,10525.3,8),Y(9002313.57,10525.3,9),X)
"^DD",9002313.57,9002313.57,10525.3,21,0)
^^1^1^3080212^
"^DD",9002313.57,9002313.57,10525.3,21,1,0)
DUR information returned by the payer that has not been formatted yet.
"^DD",9002313.57,9002313.57,10525.3,"DT")
3080212
"^DD",9002313.57,9002313.57,10525.3439,0)
DUR 3 DRUG CONFLICT CODE^CJ2^^ ; ^X ^DD(9002313.57,10525.3439,9.2) S Y(9002313.57,10525.3439,3)=$G(X) S X=2,X=$E(Y(9002313.57,10525.3439,2),Y(9002313.57,10525.3439,3),X)
"^DD",9002313.57,9002313.57,10525.3439,9)
^
"^DD",9002313.57,9002313.57,10525.3439,9.01)
9002313.57^10525.3
"^DD",9002313.57,9002313.57,10525.3439,9.1)
$E(DUR 3 RAW DATA,1,2)
"^DD",9002313.57,9002313.57,10525.3439,9.2)
X "N I,Y "_$P(^DD(9002313.57,10525.3,0),U,5,99) S Y(9002313.57,10525.3439,1)=X S X=Y(9002313.57,10525.3439,1),Y(9002313.57,10525.3439,2)=$G(X) S X=1
"^DD",9002313.57,9002313.57,10525.3439,21,0)
^^4^4^3040106^
"^DD",9002313.57,9002313.57,10525.3439,21,1,0)
=Not Specified
"^DD",9002313.57,9002313.57,10525.3439,21,2,0)
1=Your Pharmacy
"^DD",9002313.57,9002313.57,10525.3439,21,3,0)
2=Other Pharmacy in Same Chain
"^DD",9002313.57,9002313.57,10525.3439,21,4,0)
3=Other Pharmacy
"^DD",9002313.57,9002313.57,10525.3439,"DT")
3080212
"^DD",9002313.57,9002313.57,10525.3528,0)
DUR 3 SEVERITY INDEX CODE^CJ1^^ ; ^X ^DD(9002313.57,10525.3528,9.2) S X=$E(Y(9002313.57,10525.3528,2),X)
"^DD",9002313.57,9002313.57,10525.3528,9)
^
"^DD",9002313.57,9002313.57,10525.3528,9.01)
9002313.57^10525.3
"^DD",9002313.57,9002313.57,10525.3528,9.1)
$E(DUR 3 RAW DATA,3)
"^DD",9002313.57,9002313.57,10525.3528,9.2)
X "N I,Y "_$P(^DD(9002313.57,10525.3,0),U,5,99) S Y(9002313.57,10525.3528,1)=X S X=Y(9002313.57,10525.3528,1),Y(9002313.57,10525.3528,2)=$G(X) S X=3
"^DD",9002313.57,9002313.57,10525.3528,21,0)
^^4^4^3040106^
"^DD",9002313.57,9002313.57,10525.3528,21,1,0)
Blank=Not Specified
"^DD",9002313.57,9002313.57,10525.3528,21,2,0)
1=Major
"^DD",9002313.57,9002313.57,10525.3528,21,3,0)
2=Moderate
"^DD",9002313.57,9002313.57,10525.3528,21,4,0)
3=Minor
"^DD",9002313.57,9002313.57,10525.3528,"DT")
3080212
"^DD",9002313.57,9002313.57,10525.3529,0)
DUR 3 OTHER PHARMACY INDIC^CJ1^^ ; ^X ^DD(9002313.57,10525.3529,9.2) S X=$E(Y(9002313.57,10525.3529,2),X)
"^DD",9002313.57,9002313.57,10525.3529,9)
^
"^DD",9002313.57,9002313.57,10525.3529,9.01)
9002313.57^10525.3
"^DD",9002313.57,9002313.57,10525.3529,9.1)
$E(DUR 3 RAW DATA,4)
"^DD",9002313.57,9002313.57,10525.3529,9.2)
X "N I,Y "_$P(^DD(9002313.57,10525.3,0),U,5,99) S Y(9002313.57,10525.3529,1)=X S X=Y(9002313.57,10525.3529,1),Y(9002313.57,10525.3529,2)=$G(X) S X=4
"^DD",9002313.57,9002313.57,10525.3529,21,0)
^^4^4^3040106^
"^DD",9002313.57,9002313.57,10525.3529,21,1,0)
=Not Specified
"^DD",9002313.57,9002313.57,10525.3529,21,2,0)
1=Your Pharmacy
"^DD",9002313.57,9002313.57,10525.3529,21,3,0)
2=Other Pharmacy in Same Chain
"^DD",9002313.57,9002313.57,10525.3529,21,4,0)
3=Other Pharmacy
"^DD",9002313.57,9002313.57,10525.3529,"DT")
3080212
"^DD",9002313.57,9002313.57,10525.353,0)
DUR 3 PREVIOUS DATE OF FILL^CJ8^^ ; ^X ^DD(9002313.57,10525.353,9.2) S Y(9002313.57,10525.353,3)=$G(X) S X=12,X=$E(Y(9002313.57,10525.353,2),Y(9002313.57,10525.353,3),X)
"^DD",9002313.57,9002313.57,10525.353,9)
^
"^DD",9002313.57,9002313.57,10525.353,9.01)
9002313.57^10525.3
"^DD",9002313.57,9002313.57,10525.353,9.1)
$E(DUR 3 RAW DATA,5,12)
"^DD",9002313.57,9002313.57,10525.353,9.2)
X "N I,Y "_$P(^DD(9002313.57,10525.3,0),U,5,99) S Y(9002313.57,10525.353,1)=X S X=Y(9002313.57,10525.353,1),Y(9002313.57,10525.353,2)=$G(X) S X=5
"^DD",9002313.57,9002313.57,10525.353,21,0)
^^1^1^3040106^
"^DD",9002313.57,9002313.57,10525.353,21,1,0)
Fill date of the previous fill that is causing the DUR conflict.
"^DD",9002313.57,9002313.57,10525.353,"DT")
3080212
"^DD",9002313.57,9002313.57,10525.3531,0)
DUR 3 QTY OF PREVIOUS FILL^CJ5^^ ; ^X ^DD(9002313.57,10525.3531,9.2) S Y(9002313.57,10525.3531,3)=$G(X) S X=17,X=$E(Y(9002313.57,10525.3531,2),Y(9002313.57,10525.3531,3),X)
"^DD",9002313.57,9002313.57,10525.3531,9)
^
"^DD",9002313.57,9002313.57,10525.3531,9.01)
9002313.57^10525.3
"^DD",9002313.57,9002313.57,10525.3531,9.1)
$E(DUR 3 RAW DATA,13,17)
"^DD",9002313.57,9002313.57,10525.3531,9.2)
X "N I,Y "_$P(^DD(9002313.57,10525.3,0),U,5,99) S Y(9002313.57,10525.3531,1)=X S X=Y(9002313.57,10525.3531,1),Y(9002313.57,10525.3531,2)=$G(X) S X=13
"^DD",9002313.57,9002313.57,10525.3531,21,0)
^.001^1^1^3040106^^
"^DD",9002313.57,9002313.57,10525.3531,21,1,0)
Quantity of the fill that is causing the conflict.
"^DD",9002313.57,9002313.57,10525.3531,"DT")
3080212
"^DD",9002313.57,9002313.57,10525.3532,0)
DUR 3 DATABASE INDICATOR^CJ1^^ ; ^X ^DD(9002313.57,10525.3532,9.2) S X=$E(Y(9002313.57,10525.3532,2),X)
"^DD",9002313.57,9002313.57,10525.3532,9)
^
"^DD",9002313.57,9002313.57,10525.3532,9.01)
9002313.57^10525.3
"^DD",9002313.57,9002313.57,10525.3532,9.1)
$E(DUR 3 RAW DATA,18)
"^DD",9002313.57,9002313.57,10525.3532,9.2)
X "N I,Y "_$P(^DD(9002313.57,10525.3,0),U,5,99) S Y(9002313.57,10525.3532,1)=X S X=Y(9002313.57,10525.3532,1),Y(9002313.57,10525.3532,2)=$G(X) S X=18
"^DD",9002313.57,9002313.57,10525.3532,21,0)
^^6^6^3080212^
"^DD",9002313.57,9002313.57,10525.3532,21,1,0)
Blank=Not Specified
"^DD",9002313.57,9002313.57,10525.3532,21,2,0)
1=First Databank
"^DD",9002313.57,9002313.57,10525.3532,21,3,0)
2=Medi-Span
"^DD",9002313.57,9002313.57,10525.3532,21,4,0)
3=Redbook
"^DD",9002313.57,9002313.57,10525.3532,21,5,0)
4=Processor Developed
"^DD",9002313.57,9002313.57,10525.3532,21,6,0)
5=Other
"^DD",9002313.57,9002313.57,10525.3532,"DT")
3080212
"^DD",9002313.57,9002313.57,10525.3533,0)
DUR 3 OTHER PRESCRIBER INDIC^CJ1^^ ; ^X ^DD(9002313.57,10525.3533,9.2) S X=$E(Y(9002313.57,10525.3533,2),X)
"^DD",9002313.57,9002313.57,10525.3533,9)
^
"^DD",9002313.57,9002313.57,10525.3533,9.01)
9002313.57^10525.3
"^DD",9002313.57,9002313.57,10525.3533,9.1)
$E(DUR 3 RAW DATA,19)
"^DD",9002313.57,9002313.57,10525.3533,9.2)
X "N I,Y "_$P(^DD(9002313.57,10525.3,0),U,5,99) S Y(9002313.57,10525.3533,1)=X S X=Y(9002313.57,10525.3533,1),Y(9002313.57,10525.3533,2)=$G(X) S X=19
"^DD",9002313.57,9002313.57,10525.3533,21,0)
^^6^6^3040106^
"^DD",9002313.57,9002313.57,10525.3533,21,1,0)
Code that indicates the prescriber of the current fill relationship to the
"^DD",9002313.57,9002313.57,10525.3533,21,2,0)
prescriber of the conflicting prescription.
"^DD",9002313.57,9002313.57,10525.3533,21,3,0)
 
"^DD",9002313.57,9002313.57,10525.3533,21,4,0)
=Not Specified
"^DD",9002313.57,9002313.57,10525.3533,21,5,0)
1=Same Prescriber
"^DD",9002313.57,9002313.57,10525.3533,21,6,0)
2=Other Prescriber
"^DD",9002313.57,9002313.57,10525.3533,"DT")
3080212
"^DD",9002313.57,9002313.57,10525.3544,0)
DUR 3 FREE TEXT^CJ30^^ ; ^X ^DD(9002313.57,10525.3544,9.2) S Y(9002313.57,10525.3544,3)=$G(X) S X=49,X=$E(Y(9002313.57,10525.3544,2),Y(9002313.57,10525.3544,3),X)
"^DD",9002313.57,9002313.57,10525.3544,9)
^
"^DD",9002313.57,9002313.57,10525.3544,9.01)
9002313.57^10525.3
"^DD",9002313.57,9002313.57,10525.3544,9.1)
$E(DUR 3 RAW DATA,20,49)
"^DD",9002313.57,9002313.57,10525.3544,9.2)
X "N I,Y "_$P(^DD(9002313.57,10525.3,0),U,5,99) S Y(9002313.57,10525.3544,1)=X S X=Y(9002313.57,10525.3544,1),Y(9002313.57,10525.3544,2)=$G(X) S X=20
"^DD",9002313.57,9002313.57,10525.3544,21,0)
^^1^1^3040106^
"^DD",9002313.57,9002313.57,10525.3544,21,1,0)
Actual DUR text
"^DD",9002313.57,9002313.57,10525.3544,"DT")
3080212
"^DD",9002313.57,9002313.57,10525.3999,0)
DUR 3 RESERVE SPACE^CJ4^^ ; ^X ^DD(9002313.57,10525.3999,9.2) S Y(9002313.57,10525.3999,3)=$G(X) S X=53,X=$E(Y(9002313.57,10525.3999,2),Y(9002313.57,10525.3999,3),X)
"^DD",9002313.57,9002313.57,10525.3999,9)
^
"^DD",9002313.57,9002313.57,10525.3999,9.01)
9002313.57^10525.3
"^DD",9002313.57,9002313.57,10525.3999,9.1)
$E(DUR 3 RAW DATA,50,53)
"^DD",9002313.57,9002313.57,10525.3999,9.2)
X "N I,Y "_$P(^DD(9002313.57,10525.3,0),U,5,99) S Y(9002313.57,10525.3999,1)=X S X=Y(9002313.57,10525.3999,1),Y(9002313.57,10525.3999,2)=$G(X) S X=50
"^DD",9002313.57,9002313.57,10525.3999,21,0)
^^1^1^3080212^
"^DD",9002313.57,9002313.57,10525.3999,21,1,0)
Reserved space for additional information.
"^DD",9002313.57,9002313.57,10525.3999,"DT")
3080212
"^DD",9002313.57,9002313.57,10526,0)
ADDITIONAL MESSAGE INFORMATION^CJ200^^ ; ^S X=$$FIELD^BPSOS57(526)
"^DD",9002313.57,9002313.57,10526,9)
^
"^DD",9002313.57,9002313.57,10526,9.01)

"^DD",9002313.57,9002313.57,10526,9.1)
S X=$$FIELD^BPSOS57(526)
"^DD",9002313.57,9002313.57,10526,21,0)
^^1^1^3080212^
"^DD",9002313.57,9002313.57,10526,21,1,0)
Free text, additional information from the payer.
"^DD",9002313.57,9002313.57,10526,"DT")
3080212
"^DD",9002313.57,9002313.57,10528,0)
CLINICAL SIGNIFICANCE CODE^CJ1^^ ; ^S X=$$FIELD^BPSOS57(528)
"^DD",9002313.57,9002313.57,10528,9)
^
"^DD",9002313.57,9002313.57,10528,9.01)

"^DD",9002313.57,9002313.57,10528,9.1)
S X=$$FIELD^BPSOS57(528)
"^DD",9002313.57,9002313.57,10528,21,0)
^^4^4^3040106^
"^DD",9002313.57,9002313.57,10528,21,1,0)
Blank=Not Specified
"^DD",9002313.57,9002313.57,10528,21,2,0)
1=Major
"^DD",9002313.57,9002313.57,10528,21,3,0)
2=Moderate
"^DD",9002313.57,9002313.57,10528,21,4,0)
3=Minor
"^DD",9002313.57,9002313.57,10529,0)
OTHER PHARMACY INDICATOR^CJ1^^ ; ^S X=$$FIELD^BPSOS57(529)
"^DD",9002313.57,9002313.57,10529,9)
^
"^DD",9002313.57,9002313.57,10529,9.01)

"^DD",9002313.57,9002313.57,10529,9.1)
S X=$$FIELD^BPSOS57(529)
"^DD",9002313.57,9002313.57,10529,21,0)
^^4^4^3040106^
"^DD",9002313.57,9002313.57,10529,21,1,0)
=Not Specified
"^DD",9002313.57,9002313.57,10529,21,2,0)
1=Your Pharmacy
"^DD",9002313.57,9002313.57,10529,21,3,0)
2=Other Pharmacy in Same Chain
"^DD",9002313.57,9002313.57,10529,21,4,0)
3=Other Pharmacy
"^DD",9002313.57,9002313.57,10530,0)
PREVIOUS DATE OF FILL^CJ8^^ ; ^S X=$$FIELD^BPSOS57(530)
"^DD",9002313.57,9002313.57,10530,9)
^
"^DD",9002313.57,9002313.57,10530,9.01)

"^DD",9002313.57,9002313.57,10530,9.1)
S X=$$FIELD^BPSOS57(530)
"^DD",9002313.57,9002313.57,10530,21,0)
^^1^1^3040106^
"^DD",9002313.57,9002313.57,10530,21,1,0)
Fill date of the prescription causing the DUR conflict.
"^DD",9002313.57,9002313.57,10531,0)
QUANTITY OF PREVIOUS FILL^CJ5^^ ; ^S X=$$FIELD^BPSOS57(531)
"^DD",9002313.57,9002313.57,10531,9)
^
"^DD",9002313.57,9002313.57,10531,9.01)

"^DD",9002313.57,9002313.57,10531,9.1)
S X=$$FIELD^BPSOS57(531)
"^DD",9002313.57,9002313.57,10531,21,0)
^^1^1^3040106^
"^DD",9002313.57,9002313.57,10531,21,1,0)
Quantity of the prescription causing the conflict.
"^DD",9002313.57,9002313.57,10532,0)
DATABASE INDICATOR^CJ1^^ ; ^S X=$$FIELD^BPSOS57(532)
"^DD",9002313.57,9002313.57,10532,9)
^
"^DD",9002313.57,9002313.57,10532,9.01)

"^DD",9002313.57,9002313.57,10532,9.1)
S X=$$FIELD^BPSOS57(532)
"^DD",9002313.57,9002313.57,10532,21,0)
^^6^6^3040106^
"^DD",9002313.57,9002313.57,10532,21,1,0)
Blank=Not Specified
"^DD",9002313.57,9002313.57,10532,21,2,0)
1=First Databank
"^DD",9002313.57,9002313.57,10532,21,3,0)
2=Medi-Span
"^DD",9002313.57,9002313.57,10532,21,4,0)
3=Redbook
"^DD",9002313.57,9002313.57,10532,21,5,0)
4=Processor Developed
"^DD",9002313.57,9002313.57,10532,21,6,0)
5=Other
"^DD",9002313.57,9002313.57,10533,0)
OTHER PRESCRIBER INDICATOR^CJ1^^ ; ^S X=$$FIELD^BPSOS57(533)
"^DD",9002313.57,9002313.57,10533,9)
^
"^DD",9002313.57,9002313.57,10533,9.01)

"^DD",9002313.57,9002313.57,10533,9.1)
S X=$$FIELD^BPSOS57(533)
"^DD",9002313.57,9002313.57,10533,21,0)
^^3^3^3040106^
"^DD",9002313.57,9002313.57,10533,21,1,0)
=Not Specified
"^DD",9002313.57,9002313.57,10533,21,2,0)
1=Same Prescriber
"^DD",9002313.57,9002313.57,10533,21,3,0)
2=Other Prescriber
"^DD",9002313.57,9002313.57,10535,0)
DUR OVERFLOW^CJ1^^ ; ^S X=$$FIELD^BPSOS57(535)
"^DD",9002313.57,9002313.57,10535,9)
^
"^DD",9002313.57,9002313.57,10535,9.01)

"^DD",9002313.57,9002313.57,10535,9.1)
S X=$$FIELD^BPSOS57(535)
"^DD",9002313.57,9002313.57,10535,21,0)
^^2^2^3040106^
"^DD",9002313.57,9002313.57,10535,21,1,0)
Additional DUR information that did not fit in the other 
"^DD",9002313.57,9002313.57,10535,21,2,0)
fields provided.
"^DD",9002313.57,9002313.57,10535,"DT")
3080212
"^DD",9002313.57,9002313.57,10544,0)
FREE TEXT^CJ30^^ ; ^S X=$$FIELD^BPSOS57(544)
"^DD",9002313.57,9002313.57,10544,9)
^
"^DD",9002313.57,9002313.57,10544,9.01)

"^DD",9002313.57,9002313.57,10544,9.1)
S X=$$FIELD^BPSOS57(544)
"^DD",9002313.57,9002313.57,10544,21,0)
^^1^1^3040106^
"^DD",9002313.57,9002313.57,10544,21,1,0)
Even more room for additional free text DUR information.
"^DD",9002313.57,9002313.57111,0)
COMMENT MULTIPLE SUB-FIELD^^.03^3
"^DD",9002313.57,9002313.57111,0,"DT")
3050527
"^DD",9002313.57,9002313.57111,0,"IX","B",9002313.57111,.01)

"^DD",9002313.57,9002313.57111,0,"NM","COMMENT MULTIPLE")

"^DD",9002313.57,9002313.57111,0,"UP")
9002313.57
"^DD",9002313.57,9002313.57111,.01,0)
DATE^D^^0;1^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.57,9002313.57111,.01,1,0)
^.1
"^DD",9002313.57,9002313.57111,.01,1,1,0)
9002313.57111^B
"^DD",9002313.57,9002313.57111,.01,1,1,1)
S ^BPSTL(DA(1),11,"B",$E(X,1,30),DA)=""
"^DD",9002313.57,9002313.57111,.01,1,1,2)
K ^BPSTL(DA(1),11,"B",$E(X,1,30),DA)
"^DD",9002313.57,9002313.57111,.01,3)
Enter the Date/Time of this Comment
"^DD",9002313.57,9002313.57111,.01,21,0)
^.001^1^1^3050527^^^
"^DD",9002313.57,9002313.57111,.01,21,1,0)
To store user's comment date
"^DD",9002313.57,9002313.57111,.01,"DT")
3050527
"^DD",9002313.57,9002313.57111,.02,0)
USER^P200'^VA(200,^0;2^Q
"^DD",9002313.57,9002313.57111,.02,3)
Enter the New Person entering this Comment
"^DD",9002313.57,9002313.57111,.02,21,0)
^.001^1^1^3050629^^
"^DD",9002313.57,9002313.57111,.02,21,1,0)
ECME user
"^DD",9002313.57,9002313.57111,.02,"DT")
3050527
"^DD",9002313.57,9002313.57111,.03,0)
COMMENT^F^^0;3^K:$L(X)>74!($L(X)<1) X
"^DD",9002313.57,9002313.57111,.03,3)
Answer must be 1-74 characters in length.
"^DD",9002313.57,9002313.57111,.03,21,0)
^^1^1^3050527^
"^DD",9002313.57,9002313.57111,.03,21,1,0)
Comment text
"^DD",9002313.57,9002313.57111,.03,"DT")
3050527
"^DD",9002313.57,9002313.5713,0)
DUR DATA SUB-FIELD^^3^4
"^DD",9002313.57,9002313.5713,0,"DT")
3050615
"^DD",9002313.57,9002313.5713,0,"IX","B",9002313.5713,.01)

"^DD",9002313.57,9002313.5713,0,"NM","DUR DATA")

"^DD",9002313.57,9002313.5713,0,"UP")
9002313.57
"^DD",9002313.57,9002313.5713,.01,0)
DUR COUNTER^NJ4,0^^0;1^K:+X'=X!(X>9999)!(X<1)!(X?.E1"."1.N) X
"^DD",9002313.57,9002313.5713,.01,1,0)
^.1
"^DD",9002313.57,9002313.5713,.01,1,1,0)
9002313.5713^B
"^DD",9002313.57,9002313.5713,.01,1,1,1)
S ^BPSTL(DA(1),13,"B",$E(X,1,30),DA)=""
"^DD",9002313.57,9002313.5713,.01,1,1,2)
K ^BPSTL(DA(1),13,"B",$E(X,1,30),DA)
"^DD",9002313.57,9002313.5713,.01,3)
Type a number between 1 and 9999, 0 Decimal Digits
"^DD",9002313.57,9002313.5713,.01,21,0)
^^1^1^3050615^
"^DD",9002313.57,9002313.5713,.01,21,1,0)
This is the field used to populate the 473-7E field of the claim
"^DD",9002313.57,9002313.5713,.01,"DT")
3050615
"^DD",9002313.57,9002313.5713,1,0)
DUR PROFESSIONAL SERVICE CODE^F^^0;2^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.57,9002313.5713,1,3)
Answer must be 1-2 characters in length
"^DD",9002313.57,9002313.5713,1,21,0)
^^1^1^3050615^
"^DD",9002313.57,9002313.5713,1,21,1,0)
This is the field used to populate the 439-E4 field of the claim
"^DD",9002313.57,9002313.5713,1,"DT")
3050615
"^DD",9002313.57,9002313.5713,2,0)
DUR REASON FOR SERVICE CODE^F^^0;3^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.57,9002313.5713,2,3)
Answer must be 1-2 characters in length
"^DD",9002313.57,9002313.5713,2,21,0)
^^1^1^3050615^
"^DD",9002313.57,9002313.5713,2,21,1,0)
This is the field used to populate the 440-E5 field of the claim
"^DD",9002313.57,9002313.5713,2,"DT")
3050615
"^DD",9002313.57,9002313.5713,3,0)
DUR RESULT OF SERVICE CODE^F^^0;4^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.57,9002313.5713,3,3)
Answer must be 1-2 characters in length
"^DD",9002313.57,9002313.5713,3,21,0)
^^1^1^3050615^
"^DD",9002313.57,9002313.5713,3,21,1,0)
This is the field used to populate the 441-E6 field of the claim
"^DD",9002313.57,9002313.5713,3,"DT")
3050615
"^DD",9002313.57,9002313.57902,0)
PATIENT INSURANCE MULTIPLE SUB-FIELD^^902.27^26
"^DD",9002313.57,9002313.57902,0,"DT")
3080212
"^DD",9002313.57,9002313.57902,0,"IX","B",9002313.57902,.01)

"^DD",9002313.57,9002313.57902,0,"NM","PATIENT INSURANCE MULTIPLE")

"^DD",9002313.57,9002313.57902,0,"UP")
9002313.57
"^DD",9002313.57,9002313.57902,.01,0)
PLAN ID^MP355.3'^IBA(355.3,^0;1^Q
"^DD",9002313.57,9002313.57902,.01,1,0)
^.1
"^DD",9002313.57,9002313.57902,.01,1,1,0)
9002313.57902^B
"^DD",9002313.57,9002313.57902,.01,1,1,1)
S ^BPSTL(DA(1),10,"B",$E(X,1,30),DA)=""
"^DD",9002313.57,9002313.57902,.01,1,1,2)
K ^BPSTL(DA(1),10,"B",$E(X,1,30),DA)
"^DD",9002313.57,9002313.57902,.01,3)
Enter the group insurance record
"^DD",9002313.57,9002313.57902,.01,21,0)
^^1^1^3080613^
"^DD",9002313.57,9002313.57902,.01,21,1,0)
Insurance plan ID sent from the IB API
"^DD",9002313.57,9002313.57902,.01,"DT")
3080613
"^DD",9002313.57,9002313.57902,902.02,0)
PAYER SHEET^P9002313.92'^BPSF(9002313.92,^0;2^Q
"^DD",9002313.57,9002313.57902,902.02,3)
Answer with BPS NCPDP FORMATS RECORD FORMAT NAME
"^DD",9002313.57,9002313.57902,902.02,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57902,902.02,21,1,0)
Payer sheet IEN to be used with the associated insurer.
"^DD",9002313.57,9002313.57902,902.02,"DT")
3080319
"^DD",9002313.57,9002313.57902,902.03,0)
BIN^F^^1;1^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.57,9002313.57902,902.03,3)
Answer must be 1-10 characters in length.
"^DD",9002313.57,9002313.57902,902.03,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57902,902.03,21,1,0)
Card Issuer ID or Bank ID Number used for network routing.
"^DD",9002313.57,9002313.57902,902.03,"DT")
3030709
"^DD",9002313.57,9002313.57902,902.04,0)
PCN^F^^1;2^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.57,9002313.57902,902.04,3)
Answer must be 1-10 characters in length.
"^DD",9002313.57,9002313.57902,902.04,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57902,902.04,21,1,0)
Processor control number assigned for the payer sheet.
"^DD",9002313.57,9002313.57902,902.04,"DT")
3030709
"^DD",9002313.57,9002313.57902,902.05,0)
GROUP ID^F^^1;3^K:$L(X)>17!($L(X)<1) X
"^DD",9002313.57,9002313.57902,902.05,3)
Answer must be 1-17 characters in length
"^DD",9002313.57,9002313.57902,902.05,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57902,902.05,21,1,0)
ID assigned to the cardholder group or employer group.
"^DD",9002313.57,9002313.57902,902.05,"DT")
3050913
"^DD",9002313.57,9002313.57902,902.06,0)
CARDHOLDER ID^F^^1;4^K:$L(X)>20!($L(X)<1) X
"^DD",9002313.57,9002313.57902,902.06,3)
Answer must be 1-20 characters in length.
"^DD",9002313.57,9002313.57902,902.06,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57902,902.06,21,1,0)
Insured person
"^DD",9002313.57,9002313.57902,902.06,"DT")
3030709
"^DD",9002313.57,9002313.57902,902.07,0)
PATIENT RELATIONSHIP CODE^F^^1;5^K:$L(X)>1!($L(X)<1) X
"^DD",9002313.57,9002313.57902,902.07,3)
Answer must be 1 character in length.
"^DD",9002313.57,9002313.57902,902.07,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57902,902.07,21,1,0)
Patient relationship to insurance subscriber.
"^DD",9002313.57,9002313.57902,902.07,"DT")
3030709
"^DD",9002313.57,9002313.57902,902.08,0)
CARDHOLDER FIRST NAME^F^^1;6^K:$L(X)>12!($L(X)<1) X
"^DD",9002313.57,9002313.57902,902.08,3)
Answer must be 1-12 characters in length.
"^DD",9002313.57,9002313.57902,902.08,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57902,902.08,21,1,0)
First name of the Cardholder/Subscriber. 
"^DD",9002313.57,9002313.57902,902.08,"DT")
3030709
"^DD",9002313.57,9002313.57902,902.09,0)
CARDHOLDER LAST NAME^F^^1;7^K:$L(X)>15!($L(X)<1) X
"^DD",9002313.57,9002313.57902,902.09,3)
Answer must be 1-15 characters in length.
"^DD",9002313.57,9002313.57902,902.09,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57902,902.09,21,1,0)
Last name of the Cardholder/Subscriber. 
"^DD",9002313.57,9002313.57902,902.09,"DT")
3030709
"^DD",9002313.57,9002313.57902,902.11,0)
HOME PLAN STATE^F^^1;8^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.57,9002313.57902,902.11,3)
Answer must be 1-2 characters in length.
"^DD",9002313.57,9002313.57902,902.11,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57902,902.11,21,1,0)
Usually the state where the member lives or purchased their coverage.
"^DD",9002313.57,9002313.57902,902.11,"DT")
3030709
"^DD",9002313.57,9002313.57902,902.12,0)
DISPENSING FEE SUBMITTED^NJ8,2^^2;1^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>99999)!(X<0)!(X?.E1"."3.N) X
"^DD",9002313.57,9002313.57902,902.12,3)
Type a Dollar amount between 0 and 99999, 2 Decimal Digits
"^DD",9002313.57,9002313.57902,902.12,21,0)
^^2^2^3080212^
"^DD",9002313.57,9002313.57902,902.12,21,1,0)
Fee amount submitted for the cost associated with dispensing this
"^DD",9002313.57,9002313.57902,902.12,21,2,0)
prescription. 
"^DD",9002313.57,9002313.57902,902.12,"DT")
3080212
"^DD",9002313.57,9002313.57902,902.13,0)
BASIS OF COST DETERMINATION^F^^2;2^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.57,9002313.57902,902.13,3)
Answer must be 1-2 characters in length.
"^DD",9002313.57,9002313.57902,902.13,21,0)
^^2^2^3031217^
"^DD",9002313.57,9002313.57902,902.13,21,1,0)
Code indicating the method by which 'Ingredient Cost Submitted' was
"^DD",9002313.57,9002313.57902,902.13,21,2,0)
calculated.
"^DD",9002313.57,9002313.57902,902.13,"DT")
3030709
"^DD",9002313.57,9002313.57902,902.14,0)
USUAL CUSTOMARY CHARGE^NJ10,4X^^2;3^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".4N!(X>99999)!(X<0) X
"^DD",9002313.57,9002313.57902,902.14,3)
Type a number between 0 and 99999, 4 Decimal Digits
"^DD",9002313.57,9002313.57902,902.14,21,0)
^^2^2^3031217^
"^DD",9002313.57,9002313.57902,902.14,21,1,0)
Amount charged cash customers for the prescription exclusive of sales tax
"^DD",9002313.57,9002313.57902,902.14,21,2,0)
or other amounts claimed.
"^DD",9002313.57,9002313.57902,902.14,"DT")
3080212
"^DD",9002313.57,9002313.57902,902.15,0)
GROSS AMOUNT DUE^NJ10,4X^^2;4^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".4N!(X>99999)!(X<0) X
"^DD",9002313.57,9002313.57902,902.15,3)
Type a number between 0 and 99999, 4 Decimal Digits
"^DD",9002313.57,9002313.57902,902.15,21,0)
^^9^9^3031217^
"^DD",9002313.57,9002313.57902,902.15,21,1,0)
 Total price claimed from all sources.  For prescription claim request,
"^DD",9002313.57,9002313.57902,902.15,21,2,0)
field represents a sum of 'Ingredient Cost Submitted' (49-D9),
"^DD",9002313.57,9002313.57902,902.15,21,3,0)
'Dispensing Fee Submitted' (412-DC), 'Flat Sales Tax Amount
"^DD",9002313.57,9002313.57902,902.15,21,4,0)
Submitted'(481-HA), 'Percentage Sales Tax Amount Submitted' (482-GE),
"^DD",9002313.57,9002313.57902,902.15,21,5,0)
'Incentive Amount Submitted' (438-E3), 'Other Amount Claimed' (48-H9).
"^DD",9002313.57,9002313.57902,902.15,21,6,0)
For service claim request, field represents a sum of 'Professional
"^DD",9002313.57,9002313.57902,902.15,21,7,0)
Services Fee Submitted' (477-BE), 'Flat Sales Tax Amount
"^DD",9002313.57,9002313.57902,902.15,21,8,0)
Submitted'(481-HA), 'Percentage Sales Tax Amount Submitted'(482-GE),
"^DD",9002313.57,9002313.57902,902.15,21,9,0)
'Other Amount Claimed' (48-H9)
"^DD",9002313.57,9002313.57902,902.15,"DT")
3080212
"^DD",9002313.57,9002313.57902,902.16,0)
ADMINISTRATIVE FEE^NJ8,2^^2;5^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>99999)!(X<0)!(X?.E1"."3.N) X
"^DD",9002313.57,9002313.57902,902.16,3)
Type a Dollar amount between 0 and 99999, 2 Decimal Digits
"^DD",9002313.57,9002313.57902,902.16,21,0)
^.001^1^1^3031217^^
"^DD",9002313.57,9002313.57902,902.16,21,1,0)
Fee charged for any costs related to preparing the prescription.
"^DD",9002313.57,9002313.57902,902.16,"DT")
3080212
"^DD",9002313.57,9002313.57902,902.17,0)
VA FILL NUMBER^NJ2,0^^2;6^K:+X'=X!(X>99)!(X<0)!(X?.E1"."1.N) X
"^DD",9002313.57,9002313.57902,902.17,3)
Type a number between 0 and 99, 0 Decimal Digits
"^DD",9002313.57,9002313.57902,902.17,21,0)
^^1^1^3031217^
"^DD",9002313.57,9002313.57902,902.17,21,1,0)
Which fill/refill this transaction is for.
"^DD",9002313.57,9002313.57902,902.17,"DT")
3080212
"^DD",9002313.57,9002313.57902,902.18,0)
SOFTWARE VENDOR CERT ID^F^^2;7^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.57,9002313.57902,902.18,3)
Answer must be 1-30 characters in length.
"^DD",9002313.57,9002313.57902,902.18,21,0)
^^2^2^3080212^
"^DD",9002313.57,9002313.57902,902.18,21,1,0)
Certification number assigned by payer to the sending entity, allowing
"^DD",9002313.57,9002313.57902,902.18,21,2,0)
claims to be sent.
"^DD",9002313.57,9002313.57902,902.18,"DT")
3080212
"^DD",9002313.57,9002313.57902,902.19,0)
B2 PAYER SHEET^P9002313.92'^BPSF(9002313.92,^0;3^Q
"^DD",9002313.57,9002313.57902,902.19,3)
Enter the Reversal payer sheet.
"^DD",9002313.57,9002313.57902,902.19,21,0)
^^1^1^3080212^
"^DD",9002313.57,9002313.57902,902.19,21,1,0)
This is the reversal payer sheet associated with the payer.
"^DD",9002313.57,9002313.57902,902.19,"DT")
3080212
"^DD",9002313.57,9002313.57902,902.21,0)
B3 REBILL PAYER SHEET^P9002313.92'^BPSF(9002313.92,^0;4^Q
"^DD",9002313.57,9002313.57902,902.21,3)
Enter the Rebill payer sheet IEN.
"^DD",9002313.57,9002313.57902,902.21,21,0)
^^1^1^3080212^
"^DD",9002313.57,9002313.57902,902.21,21,1,0)
This is the Rebill payer sheet for this payer.
"^DD",9002313.57,9002313.57902,902.21,"DT")
3080212
"^DD",9002313.57,9002313.57902,902.22,0)
CERTIFY MODE^S^0:CERTIFY MODE ON;1:CERTIFY MODE OFF;^0;5^Q
"^DD",9002313.57,9002313.57902,902.22,3)
Enter null or 0 for Certify mode off.  Enter 1 for Certify mode on.
"^DD",9002313.57,9002313.57902,902.22,21,0)
^^1^1^3080613^
"^DD",9002313.57,9002313.57902,902.22,21,1,0)
This is to specify if the claim was used for certification.
"^DD",9002313.57,9002313.57902,902.22,"DT")
3080613
"^DD",9002313.57,9002313.57902,902.23,0)
CERTIFICATION^P9002313.31'^BPS(9002313.31,^0;6^Q
"^DD",9002313.57,9002313.57902,902.23,3)
Enter the certification record
"^DD",9002313.57,9002313.57902,902.23,21,0)
^^2^2^3061122^
"^DD",9002313.57,9002313.57902,902.23,21,1,0)
This field is used during certification testing, and contains the pointer 
"^DD",9002313.57,9002313.57902,902.23,21,2,0)
to the Certification file 9002313.31.
"^DD",9002313.57,9002313.57902,902.23,"DT")
3080212
"^DD",9002313.57,9002313.57902,902.24,0)
INSURANCE NAME^F^^0;7^K:$L(X)>40!($L(X)<1) X
"^DD",9002313.57,9002313.57902,902.24,3)
Answer must be 1-40 characters in length.
"^DD",9002313.57,9002313.57902,902.24,21,0)
^^1^1^3041014^
"^DD",9002313.57,9002313.57902,902.24,21,1,0)
This field is the Plan Name for the insurance being filed.
"^DD",9002313.57,9002313.57902,902.24,"DT")
3071121
"^DD",9002313.57,9002313.57902,902.25,0)
GROUP NAME^F^^3;1^K:$L(X)>20!($L(X)<2) X
"^DD",9002313.57,9002313.57902,902.25,3)
Answer must be 2-20 characters in length
"^DD",9002313.57,9002313.57902,902.25,21,0)
^^1^1^3050615^
"^DD",9002313.57,9002313.57902,902.25,21,1,0)
This is the Group Name for the Group Insurance file
"^DD",9002313.57,9002313.57902,902.25,"DT")
3050913
"^DD",9002313.57,9002313.57902,902.26,0)
INSURANCE CO PHONE^F^^3;2^K:$L(X)>20!($L(X)<7) X
"^DD",9002313.57,9002313.57902,902.26,3)
Answer must be 7-20 characters in length
"^DD",9002313.57,9002313.57902,902.26,21,0)
^^1^1^3050615^
"^DD",9002313.57,9002313.57902,902.26,21,1,0)
This is the Claims (RX) phone number from the Insurance Company file
"^DD",9002313.57,9002313.57902,902.26,"DT")
3080212
"^DD",9002313.57,9002313.57902,902.27,0)
PHARMACY PLAN ID^F^^3;3^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.57,9002313.57902,902.27,3)
Answer must be 1-30 characters in length
"^DD",9002313.57,9002313.57902,902.27,21,0)
^^1^1^3050617^
"^DD",9002313.57,9002313.57902,902.27,21,1,0)
This is a ID of the Plan file
"^DD",9002313.57,9002313.57902,902.27,"DT")
3050617
"^DD",9002313.57,9002313.57902,902.28,0)
INSURANCE COMPANY^P36'^DIC(36,^3;4^Q
"^DD",9002313.57,9002313.57902,902.28,3)
Enter the insurance company for this Transaction.
"^DD",9002313.57,9002313.57902,902.28,21,0)
^^1^1^3080212^
"^DD",9002313.57,9002313.57902,902.28,21,1,0)
INSURANCE COMPANY (#36) file for this Transaction.
"^DD",9002313.57,9002313.57902,902.28,"DT")
3080212
"^DD",9002313.59,9002313.59,0)
FIELD^^801^57
"^DD",9002313.59,9002313.59,0,"DDA")
N
"^DD",9002313.59,9002313.59,0,"DT")
3080613
"^DD",9002313.59,9002313.59,0,"IX","AC",9002313.59,5)

"^DD",9002313.59,9002313.59,0,"IX","AD",9002313.59,1)

"^DD",9002313.59,9002313.59,0,"IX","AE",9002313.59,3)

"^DD",9002313.59,9002313.59,0,"IX","AER",9002313.59,401)

"^DD",9002313.59,9002313.59,0,"IX","AF",9002313.59,4)

"^DD",9002313.59,9002313.59,0,"IX","AFR",9002313.59,402)

"^DD",9002313.59,9002313.59,0,"IX","AG",9002313.59,13)

"^DD",9002313.59,9002313.59,0,"IX","AH",9002313.59,7)

"^DD",9002313.59,9002313.59,0,"IX","AS",9002313.59,17)

"^DD",9002313.59,9002313.59,0,"IX","ASL",9002313.59,801)

"^DD",9002313.59,9002313.59,0,"IX","B",9002313.59,.01)

"^DD",9002313.59,9002313.59,0,"NM","BPS TRANSACTION")

"^DD",9002313.59,9002313.59,0,"PT",9002313.77,.06)

"^DD",9002313.59,9002313.59,0,"PT",9002313.92,1.11)

"^DD",9002313.59,9002313.59,0,"VRPK")
BPS
"^DD",9002313.59,9002313.59,.01,0)
ENTRY NUMBER^RF^^0;1^K:$L(X)>20!($L(X)<1) X
"^DD",9002313.59,9002313.59,.01,1,0)
^.1
"^DD",9002313.59,9002313.59,.01,1,1,0)
9002313.59^B
"^DD",9002313.59,9002313.59,.01,1,1,1)
S ^BPST("B",$E(X,1,30),DA)=""
"^DD",9002313.59,9002313.59,.01,1,1,2)
K ^BPST("B",$E(X,1,30),DA)
"^DD",9002313.59,9002313.59,.01,3)
Answer must be 1-20 characters in length.
"^DD",9002313.59,9002313.59,.01,21,0)
^.001^1^1^3040326^^
"^DD",9002313.59,9002313.59,.01,21,1,0)
Transaction entry number.
"^DD",9002313.59,9002313.59,.01,"DT")
3080102
"^DD",9002313.59,9002313.59,1,0)
STATUS^NJ2,0^^0;2^K:+X'=X!(X>99)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.59,9002313.59,1,1,0)
^.1
"^DD",9002313.59,9002313.59,1,1,1,0)
9002313.59^AD
"^DD",9002313.59,9002313.59,1,1,1,1)
S ^BPST("AD",$E(X,1,30),DA)=""
"^DD",9002313.59,9002313.59,1,1,1,2)
K ^BPST("AD",$E(X,1,30),DA)
"^DD",9002313.59,9002313.59,1,1,1,"DT")
2991025
"^DD",9002313.59,9002313.59,1,3)
Type a Number between 0 and 99, 0 Decimal Digits
"^DD",9002313.59,9002313.59,1,21,0)
^^3^3^3070227^
"^DD",9002313.59,9002313.59,1,21,1,0)
The status of the transaction as a percentage of completion.  The text 
"^DD",9002313.59,9002313.59,1,21,2,0)
value can be obtained by running $$STATI^BPSOSU(<Status Number>).  Note 
"^DD",9002313.59,9002313.59,1,21,3,0)
that 99 indicates complete.
"^DD",9002313.59,9002313.59,1,"DT")
3070227
"^DD",9002313.59,9002313.59,1.07,0)
PHARMACY^P9002313.56'^BPS(9002313.56,^1;7^Q
"^DD",9002313.59,9002313.59,1.07,3)
Answer with BPS PHARMACIES NAME
"^DD",9002313.59,9002313.59,1.07,21,0)
^^1^1^3040322^
"^DD",9002313.59,9002313.59,1.07,21,1,0)
Textual description of the Pharmacy involved with this transaction.
"^DD",9002313.59,9002313.59,1.07,"DT")
3031125
"^DD",9002313.59,9002313.59,1.08,0)
PINS PIECE^NJ1,0^^1;8^K:+X'=X!(X>9)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.59,9002313.59,1.08,3)
Type a Number between 1 and 9, 0 Decimal Digits
"^DD",9002313.59,9002313.59,1.08,21,0)
^^5^5^3000318^^
"^DD",9002313.59,9002313.59,1.08,21,1,0)
Pointer to which of the PINS pieces in ^(6) is in use for this claim.
"^DD",9002313.59,9002313.59,1.08,21,2,0)
Use this to keep track of where you are in billing down the line to
"^DD",9002313.59,9002313.59,1.08,21,3,0)
various insurers.   (Probably won't automatically roll over to next
"^DD",9002313.59,9002313.59,1.08,21,4,0)
insurer, but maybe we will have an option to edit insurance info, try next
"^DD",9002313.59,9002313.59,1.08,21,5,0)
insurance, etc.)
"^DD",9002313.59,9002313.59,1.08,"DT")
3000318
"^DD",9002313.59,9002313.59,1.09,0)
PRIOR AUTHORIZATION NUMBER^F^^1;9^K:$L(X)>11!($L(X)<1) X
"^DD",9002313.59,9002313.59,1.09,3)
Enter the prior authorization number (1-11 characters)
"^DD",9002313.59,9002313.59,1.09,21,0)
^^2^2^3070221^
"^DD",9002313.59,9002313.59,1.09,21,1,0)
Number assigned by the processor to identify a prior authorized
"^DD",9002313.59,9002313.59,1.09,21,2,0)
transaction.
"^DD",9002313.59,9002313.59,1.09,"DT")
3080319
"^DD",9002313.59,9002313.59,1.11,0)
PRESCRIPTION NUMBER^P52'^PSRX(^1;11^Q
"^DD",9002313.59,9002313.59,1.11,3)
Answer with PRESCRIPTION RX #
"^DD",9002313.59,9002313.59,1.11,21,0)
^^1^1^3080603^
"^DD",9002313.59,9002313.59,1.11,21,1,0)
This stores a pointer from the PRESCRIPTION (#52) file.
"^DD",9002313.59,9002313.59,1.11,"DT")
3080603
"^DD",9002313.59,9002313.59,1.1199,0)
RXI INTERNAL^CJ8^^ ; ^S Y(9002313.59,1.1199,1)=$S($D(^BPST(D0,1)):^(1),1:"") S X=$P(Y(9002313.59,1.1199,1),U,11),X=X
"^DD",9002313.59,9002313.59,1.1199,9)
^
"^DD",9002313.59,9002313.59,1.1199,9.01)
9002313.59^1.11
"^DD",9002313.59,9002313.59,1.1199,9.1)
INTERNAL(ABSBRXI)
"^DD",9002313.59,9002313.59,1.1199,21,0)
^^1^1^3031125^
"^DD",9002313.59,9002313.59,1.1199,21,1,0)
Internal ID to the claims file.
"^DD",9002313.59,9002313.59,1.1199,"DT")
3031125
"^DD",9002313.59,9002313.59,1.12,0)
RESUBMIT AFTER REVERSAL^S^1:RESUBMIT AFTER REVERSAL;0:DONE;2:RESUBMITTING;^1;12^Q
"^DD",9002313.59,9002313.59,1.12,3)
Enter the status of the resubmit
"^DD",9002313.59,9002313.59,1.12,21,0)
^.001^1^1^3051207^^^
"^DD",9002313.59,9002313.59,1.12,21,1,0)
Indicator that a transaction has been resubmitted after being backed out.
"^DD",9002313.59,9002313.59,1.12,"DT")
3051207
"^DD",9002313.59,9002313.59,1.13,0)
NCPDP OVERRIDES^P9002313.511'^BPS(9002313.511,^1;13^Q
"^DD",9002313.59,9002313.59,1.13,3)
Enter an NCPDP field to be overridden during transmission of this transaction.
"^DD",9002313.59,9002313.59,1.13,21,0)
^^1^1^3040126^
"^DD",9002313.59,9002313.59,1.13,21,1,0)
Override information for the NCPDP fields.
"^DD",9002313.59,9002313.59,1.13,"DT")
3001019
"^DD",9002313.59,9002313.59,1.15,0)
PRIOR AUTHORIZATION TYPE CODE^F^^1;15^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.59,9002313.59,1.15,3)
Enter the prior authorization type (1-2 characters)
"^DD",9002313.59,9002313.59,1.15,21,0)
^^1^1^3031125^
"^DD",9002313.59,9002313.59,1.15,21,1,0)
Indicates the type of authorization made before transaction was submitted.
"^DD",9002313.59,9002313.59,1.15,"DT")
3070314
"^DD",9002313.59,9002313.59,3,0)
CLAIM^P9002313.02'^BPSC(^0;4^Q
"^DD",9002313.59,9002313.59,3,1,0)
^.1
"^DD",9002313.59,9002313.59,3,1,1,0)
9002313.59^AE
"^DD",9002313.59,9002313.59,3,1,1,1)
S ^BPST("AE",$E(X,1,30),DA)=""
"^DD",9002313.59,9002313.59,3,1,1,2)
K ^BPST("AE",$E(X,1,30),DA)
"^DD",9002313.59,9002313.59,3,1,1,"DT")
2991025
"^DD",9002313.59,9002313.59,3,3)
Answer with BPS CLAIMS CLAIM ID
"^DD",9002313.59,9002313.59,3,21,0)
^^1^1^3031125^
"^DD",9002313.59,9002313.59,3,21,1,0)
Claim number for this transaction.
"^DD",9002313.59,9002313.59,3,"DT")
3031125
"^DD",9002313.59,9002313.59,3.1,0)
CLAIM IEN^CJ8^^ ; ^S Y(9002313.59,3.1,1)=$S($D(^BPST(D0,0)):^(0),1:"") S X=$P(Y(9002313.59,3.1,1),U,4),X=X
"^DD",9002313.59,9002313.59,3.1,9)
^
"^DD",9002313.59,9002313.59,3.1,9.01)
9002313.59^3
"^DD",9002313.59,9002313.59,3.1,9.1)
INTERNAL(CLAIM)
"^DD",9002313.59,9002313.59,3.1,21,0)
^^1^1^3031125^
"^DD",9002313.59,9002313.59,3.1,21,1,0)
Claim internal identifier for this transaction.
"^DD",9002313.59,9002313.59,3.1,"DT")
3031125
"^DD",9002313.59,9002313.59,4,0)
RESPONSE^P9002313.03'^BPSR(^0;5^Q
"^DD",9002313.59,9002313.59,4,1,0)
^.1
"^DD",9002313.59,9002313.59,4,1,1,0)
9002313.59^AF
"^DD",9002313.59,9002313.59,4,1,1,1)
S ^BPST("AF",$E(X,1,30),DA)=""
"^DD",9002313.59,9002313.59,4,1,1,2)
K ^BPST("AF",$E(X,1,30),DA)
"^DD",9002313.59,9002313.59,4,1,1,"DT")
2991025
"^DD",9002313.59,9002313.59,4,3)
Answer with BPS RESPONSES ID
"^DD",9002313.59,9002313.59,4,21,0)
^^1^1^3031125^
"^DD",9002313.59,9002313.59,4,21,1,0)
Textual description of the response to this submission.
"^DD",9002313.59,9002313.59,4,"DT")
3031125
"^DD",9002313.59,9002313.59,4.0098,0)
RESULT WITH REVERSAL^CJ20^^ ; ^S X=$$CATEG^BPSOSUC(D0,1)
"^DD",9002313.59,9002313.59,4.0098,9)
^
"^DD",9002313.59,9002313.59,4.0098,9.01)

"^DD",9002313.59,9002313.59,4.0098,9.1)
S X=$$CATEG^BPSOSUC(D0,1)
"^DD",9002313.59,9002313.59,4.0098,21,0)
^^1^1^3040126^
"^DD",9002313.59,9002313.59,4.0098,21,1,0)
The overall result.
"^DD",9002313.59,9002313.59,4.0099,0)
RESULT^CJ20^^ ; ^S X=$$CATEG^BPSOSUC(D0)
"^DD",9002313.59,9002313.59,4.0099,9)
^
"^DD",9002313.59,9002313.59,4.0099,9.01)

"^DD",9002313.59,9002313.59,4.0099,9.1)
S X=$$CATEG^BPSOSUC(D0)
"^DD",9002313.59,9002313.59,4.0099,21,0)
^^1^1^3040126^
"^DD",9002313.59,9002313.59,4.0099,21,1,0)
The result of the transmission.
"^DD",9002313.59,9002313.59,4.1,0)
RESPONSE IEN^CJ8^^ ; ^S Y(9002313.59,4.1,1)=$S($D(^BPST(D0,0)):^(0),1:"") S X=$P(Y(9002313.59,4.1,1),U,5),X=X
"^DD",9002313.59,9002313.59,4.1,9)
^
"^DD",9002313.59,9002313.59,4.1,9.01)
9002313.59^4
"^DD",9002313.59,9002313.59,4.1,9.1)
INTERNAL(RESPONSE)
"^DD",9002313.59,9002313.59,4.1,21,0)
^^1^1^3031125^
"^DD",9002313.59,9002313.59,4.1,21,1,0)
Internal identifier for the response.
"^DD",9002313.59,9002313.59,4.1,"DT")
3031125
"^DD",9002313.59,9002313.59,5,0)
PATIENT^P2'^DPT(^0;6^Q
"^DD",9002313.59,9002313.59,5,1,0)
^.1
"^DD",9002313.59,9002313.59,5,1,1,0)
9002313.59^AC
"^DD",9002313.59,9002313.59,5,1,1,1)
S ^BPST("AC",$E(X,1,30),DA)=""
"^DD",9002313.59,9002313.59,5,1,1,2)
K ^BPST("AC",$E(X,1,30),DA)
"^DD",9002313.59,9002313.59,5,1,1,"DT")
2991025
"^DD",9002313.59,9002313.59,5,3)
Answer with PATIENT NAME
"^DD",9002313.59,9002313.59,5,21,0)
^^1^1^3031125^
"^DD",9002313.59,9002313.59,5,21,1,0)
Patient name.
"^DD",9002313.59,9002313.59,5,"DT")
3040609
"^DD",9002313.59,9002313.59,6,0)
SUBMIT DATE^D^^0;7^S %DT="ESTXR" D ^%DT S X=Y K:X<1 X
"^DD",9002313.59,9002313.59,6,3)
Enter the date/time that the claim was submitted
"^DD",9002313.59,9002313.59,6,21,0)
^^1^1^3070207^
"^DD",9002313.59,9002313.59,6,21,1,0)
This is the date/time that the RX/Fill was submitted to ECME
"^DD",9002313.59,9002313.59,6,"DT")
3080102
"^DD",9002313.59,9002313.59,7,0)
LAST UPDATE^D^^0;8^S %DT="EST" D ^%DT S X=Y K:X<1 X
"^DD",9002313.59,9002313.59,7,1,0)
^.1
"^DD",9002313.59,9002313.59,7,1,1,0)
9002313.59^AH
"^DD",9002313.59,9002313.59,7,1,1,1)
S ^BPST("AH",$E(X,1,30),DA)=""
"^DD",9002313.59,9002313.59,7,1,1,2)
K ^BPST("AH",$E(X,1,30),DA)
"^DD",9002313.59,9002313.59,7,1,1,"DT")
2991028
"^DD",9002313.59,9002313.59,7,3)
Enter the Date/Time this Transaction was last updated.
"^DD",9002313.59,9002313.59,7,21,0)
^^1^1^3080613^^
"^DD",9002313.59,9002313.59,7,21,1,0)
Last date this record was updated.
"^DD",9002313.59,9002313.59,7,"DT")
3080613
"^DD",9002313.59,9002313.59,9,0)
FILL NUMBER^NJ2,0^^1;1^K:+X'=X!(X>99)!(X<0)!(X?.E1"."1.N) X
"^DD",9002313.59,9002313.59,9,3)
Type a number between 0 and 99, 0 Decimal Digits
"^DD",9002313.59,9002313.59,9,21,0)
^^1^1^3080102^
"^DD",9002313.59,9002313.59,9,21,1,0)
Prescription fill/refill number.
"^DD",9002313.59,9002313.59,9,"DT")
3080102
"^DD",9002313.59,9002313.59,10,0)
NDC^F^^1;2^K:$L(X)>11!($L(X)<5) X
"^DD",9002313.59,9002313.59,10,3)
Answer must be 5-11 characters in length.
"^DD",9002313.59,9002313.59,10,21,0)
^^1^1^3040120^
"^DD",9002313.59,9002313.59,10,21,1,0)
The NDC number of the drug involved in this transaction.
"^DD",9002313.59,9002313.59,10,"DT")
3080102
"^DD",9002313.59,9002313.59,10.0099,0)
USER NUMBER^CJ8^^ ; ^S Y(9002313.59,10.0099,1)=$S($D(^BPST(D0,0)):^(0),1:"") S X=$P(Y(9002313.59,10.0099,1),U,10),X=X
"^DD",9002313.59,9002313.59,10.0099,9)
^
"^DD",9002313.59,9002313.59,10.0099,9.01)
9002313.59^13
"^DD",9002313.59,9002313.59,10.0099,9.1)
INTERNAL(USER)
"^DD",9002313.59,9002313.59,10.0099,21,0)
^^1^1^3040331^
"^DD",9002313.59,9002313.59,10.0099,21,1,0)
The DUZ of the user who sent the transaction.
"^DD",9002313.59,9002313.59,10.0099,"DT")
3080102
"^DD",9002313.59,9002313.59,11,0)
PHARMACY DIVISION^P59'^PS(59,^1;4^Q
"^DD",9002313.59,9002313.59,11,3)
Select the Pharmacy Division
"^DD",9002313.59,9002313.59,11,21,0)
^^1^1^3061213^
"^DD",9002313.59,9002313.59,11,21,1,0)
The division ID for the transaction.
"^DD",9002313.59,9002313.59,11,"DT")
3080102
"^DD",9002313.59,9002313.59,13,0)
USER^P200'^VA(200,^0;10^Q
"^DD",9002313.59,9002313.59,13,1,0)
^.1
"^DD",9002313.59,9002313.59,13,1,1,0)
9002313.59^AG
"^DD",9002313.59,9002313.59,13,1,1,1)
S ^BPST("AG",$E(X,1,30),DA)=""
"^DD",9002313.59,9002313.59,13,1,1,2)
K ^BPST("AG",$E(X,1,30),DA)
"^DD",9002313.59,9002313.59,13,1,1,"DT")
2991026
"^DD",9002313.59,9002313.59,13,3)
Answer with NEW PERSON NAME
"^DD",9002313.59,9002313.59,13,21,0)
^^1^1^3080102^
"^DD",9002313.59,9002313.59,13,21,1,0)
User name who entered this transaction.
"^DD",9002313.59,9002313.59,13,"DT")
3080102
"^DD",9002313.59,9002313.59,14,0)
POSITION IN CLAIM^NJ2,0^^0;9^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.59,9002313.59,14,3)
Type a Number between 1 and 99, 0 Decimal Digits
"^DD",9002313.59,9002313.59,14,21,0)
^^1^1^3031125^
"^DD",9002313.59,9002313.59,14,21,1,0)
Sequential order in the claim transactions.
"^DD",9002313.59,9002313.59,14,"DT")
3031125
"^DD",9002313.59,9002313.59,15,0)
START TIME^D^^0;11^S %DT="EST" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.59,9002313.59,15,3)
Answer with the date/time this transaction was started.
"^DD",9002313.59,9002313.59,15,21,0)
^^1^1^3031126^
"^DD",9002313.59,9002313.59,15,21,1,0)
Time this transaction was started.
"^DD",9002313.59,9002313.59,15,"DT")
3031126
"^DD",9002313.59,9002313.59,16,0)
SUBMIT REQUEST^P9002313.77'^BPS(9002313.77,^0;12^Q
"^DD",9002313.59,9002313.59,16,3)
Answer with BPS REQUESTS RX NUMBER
"^DD",9002313.59,9002313.59,16,21,0)
^^1^1^3071121^
"^DD",9002313.59,9002313.59,16,21,1,0)
IEN of the BPS REQUEST file (#9002313.77)
"^DD",9002313.59,9002313.59,16,"DT")
3071212
"^DD",9002313.59,9002313.59,17,0)
SUBMIT REQUEST DATE TIME^D^^0;13^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.59,9002313.59,17,1,0)
^.1
"^DD",9002313.59,9002313.59,17,1,1,0)
9002313.59^AS
"^DD",9002313.59,9002313.59,17,1,1,1)
S ^BPST("AS",$E(X,1,30),DA)=""
"^DD",9002313.59,9002313.59,17,1,1,2)
K ^BPST("AS",$E(X,1,30),DA)
"^DD",9002313.59,9002313.59,17,1,1,"%D",0)
^^2^2^3071105^
"^DD",9002313.59,9002313.59,17,1,1,"%D",1,0)
Submit Request Date/Time cross-reference - when the request was placed to 
"^DD",9002313.59,9002313.59,17,1,1,"%D",2,0)
the queue.
"^DD",9002313.59,9002313.59,17,1,1,"DT")
3071105
"^DD",9002313.59,9002313.59,17,3)
Answer with the date/time this request was submitted.
"^DD",9002313.59,9002313.59,17,21,0)
^^1^1^3071121^^
"^DD",9002313.59,9002313.59,17,21,1,0)
Submit Request Date/Time
"^DD",9002313.59,9002313.59,17,"DT")
3071212
"^DD",9002313.59,9002313.59,18,0)
COB INDICATOR^S^1:PRIMARY;2:SECONDARY;3:TERTIARY;^0;14^Q
"^DD",9002313.59,9002313.59,18,3)
Answer with a Coordination of Benefits indicator
"^DD",9002313.59,9002313.59,18,21,0)
^.001^1^1^3080319^^
"^DD",9002313.59,9002313.59,18,21,1,0)
COB indicator.
"^DD",9002313.59,9002313.59,18,"DT")
3071203
"^DD",9002313.59,9002313.59,19,0)
TRANSACTION TYPE^S^C:CLAIM;U:UNCLAIM;^0;15^Q
"^DD",9002313.59,9002313.59,19,3)
Answer with the type of transaction, C=Submission, U=Reversal.
"^DD",9002313.59,9002313.59,19,21,0)
^.001^3^3^3080319^^^
"^DD",9002313.59,9002313.59,19,21,1,0)
Type of transaction 
"^DD",9002313.59,9002313.59,19,21,2,0)
CLAIM - to submit a claim to the payer 
"^DD",9002313.59,9002313.59,19,21,3,0)
UNCLAIM - to submit a reversal for the previously paid claim
"^DD",9002313.59,9002313.59,19,"DT")
3080125
"^DD",9002313.59,9002313.59,111,0)
COMMENT MULTIPLE^9002313.59111DA^^11;0
"^DD",9002313.59,9002313.59,111,3)
Enter the date/time of a user's comments
"^DD",9002313.59,9002313.59,111,21,0)
^.001^1^1^3050629^^
"^DD",9002313.59,9002313.59,111,21,1,0)
User's comment
"^DD",9002313.59,9002313.59,111,"DT")
3050627
"^DD",9002313.59,9002313.59,201,0)
RESULT CODE^NJ11,7^^2;1^K:+X'=X!(X>999.999)!(X<0)!(X?.E1"."8N.N) X
"^DD",9002313.59,9002313.59,201,3)
Type a Number between 0 and 999.999, 7 Decimal Digits
"^DD",9002313.59,9002313.59,201,21,0)
^^1^1^3080603^
"^DD",9002313.59,9002313.59,201,21,1,0)
Code indicating the result of the adjudication of this claim.
"^DD",9002313.59,9002313.59,201,"DT")
3080603
"^DD",9002313.59,9002313.59,202,0)
RESULT TEXT^F^^2;2^K:$L(X)>200!($L(X)<1) X
"^DD",9002313.59,9002313.59,202,3)
Answer must be 1-200 characters in length.
"^DD",9002313.59,9002313.59,202,21,0)
^^1^1^3031126^
"^DD",9002313.59,9002313.59,202,21,1,0)
Textual explanation of the result code.
"^DD",9002313.59,9002313.59,202,"DT")
3031126
"^DD",9002313.59,9002313.59,401,0)
REVERSAL CLAIM^P9002313.02'^BPSC(^4;1^Q
"^DD",9002313.59,9002313.59,401,1,0)
^.1
"^DD",9002313.59,9002313.59,401,1,1,0)
9002313.59^AER
"^DD",9002313.59,9002313.59,401,1,1,1)
S ^BPST("AER",$E(X,1,30),DA)=""
"^DD",9002313.59,9002313.59,401,1,1,2)
K ^BPST("AER",$E(X,1,30),DA)
"^DD",9002313.59,9002313.59,401,1,1,"%D",0)
^^1^1^3000623^
"^DD",9002313.59,9002313.59,401,1,1,"%D",1,0)
^BPST("AER",reversal claim #,IEN59)=""
"^DD",9002313.59,9002313.59,401,1,1,"DT")
3000623
"^DD",9002313.59,9002313.59,401,3)
Answer with BPS CLAIMS CLAIM ID for the reversal.
"^DD",9002313.59,9002313.59,401,21,0)
^^1^1^3031125^
"^DD",9002313.59,9002313.59,401,21,1,0)
Request to reverse this claim.
"^DD",9002313.59,9002313.59,401,"DT")
3031125
"^DD",9002313.59,9002313.59,402,0)
REVERSAL RESPONSE^P9002313.03'^BPSR(^4;2^Q
"^DD",9002313.59,9002313.59,402,1,0)
^.1
"^DD",9002313.59,9002313.59,402,1,1,0)
9002313.59^AFR
"^DD",9002313.59,9002313.59,402,1,1,1)
S ^BPST("AFR",$E(X,1,30),DA)=""
"^DD",9002313.59,9002313.59,402,1,1,2)
K ^BPST("AFR",$E(X,1,30),DA)
"^DD",9002313.59,9002313.59,402,1,1,"%D",0)
^^1^1^3000623^
"^DD",9002313.59,9002313.59,402,1,1,"%D",1,0)
^BPST("AFR",reversal response,IEN59)=""
"^DD",9002313.59,9002313.59,402,1,1,"DT")
3000623
"^DD",9002313.59,9002313.59,402,3)
Answer with BPS RESPONSES BPS CLAIM for the reversal.
"^DD",9002313.59,9002313.59,402,21,0)
^^1^1^3031125^
"^DD",9002313.59,9002313.59,402,21,1,0)
Response to reversal message.
"^DD",9002313.59,9002313.59,402,"DT")
3031125
"^DD",9002313.59,9002313.59,404,0)
REVERSAL REASON^F^^4;4^K:$L(X)>40!($L(X)<1) X
"^DD",9002313.59,9002313.59,404,3)
Answer must be 1-40 characters in length
"^DD",9002313.59,9002313.59,404,21,0)
^^1^1^3050525^
"^DD",9002313.59,9002313.59,404,21,1,0)
Reason for the reversal
"^DD",9002313.59,9002313.59,404,"DT")
3050525
"^DD",9002313.59,9002313.59,405,0)
REVERSAL REQUEST^P9002313.77'^BPS(9002313.77,^4;5^Q
"^DD",9002313.59,9002313.59,405,3)
Answer with BPS REQUESTS RX NUMBER for the reversal.
"^DD",9002313.59,9002313.59,405,21,0)
^^1^1^3071102^
"^DD",9002313.59,9002313.59,405,21,1,0)
Reversal Request IEN
"^DD",9002313.59,9002313.59,405,"DT")
3071212
"^DD",9002313.59,9002313.59,406,0)
REVERSAL REQUEST DATE TIME^D^^4;6^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.59,9002313.59,406,3)
Answer with the Reversal Request Date/Time
"^DD",9002313.59,9002313.59,406,21,0)
^^1^1^3071102^
"^DD",9002313.59,9002313.59,406,21,1,0)
Reversal Request Date/Time
"^DD",9002313.59,9002313.59,406,"DT")
3071212
"^DD",9002313.59,9002313.59,501,0)
QUANTITY^NJ10,3^^5;1^K:+X'=X!(X>999999)!(X<-999999)!(X?.E1"."4.N) X
"^DD",9002313.59,9002313.59,501,3)
Type a number between -999999 and 999999, 3 Decimal Digits
"^DD",9002313.59,9002313.59,501,21,0)
^^1^1^3070625^
"^DD",9002313.59,9002313.59,501,21,1,0)
Enter the billing quantity for the prescription.
"^DD",9002313.59,9002313.59,501,"DT")
3070625
"^DD",9002313.59,9002313.59,502,0)
UNIT PRICE^NJ14,6^^5;2^K:+X'=X!(X>9999999)!(X<0)!(X?.E1"."7N.N) X
"^DD",9002313.59,9002313.59,502,3)
Type a Number between 0 and 9999999, 6 Decimal Digits
"^DD",9002313.59,9002313.59,502,21,0)
^^1^1^3031126^
"^DD",9002313.59,9002313.59,502,21,1,0)
Price per unit of prescription.
"^DD",9002313.59,9002313.59,502,"DT")
3031126
"^DD",9002313.59,9002313.59,503,0)
SUBTOTAL^NJ13,6^^5;3^K:+X'=X!(X>999999)!(X<0)!(X?.E1"."7N.N) X
"^DD",9002313.59,9002313.59,503,3)
Type a Number between 0 and 999999, 6 Decimal Digits
"^DD",9002313.59,9002313.59,503,21,0)
^^3^3^3000313^
"^DD",9002313.59,9002313.59,503,21,1,0)
= QUANTITY * UNIT PRICE
"^DD",9002313.59,9002313.59,503,21,2,0)
This is probably what we want to send as the INGREDIENT COST field in the
"^DD",9002313.59,9002313.59,503,21,3,0)
NCPDP message.
"^DD",9002313.59,9002313.59,503,"DT")
3000313
"^DD",9002313.59,9002313.59,504,0)
DISPENSING FEE^NJ5,2^^5;4^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>99)!(X<0) X
"^DD",9002313.59,9002313.59,504,3)
Type a Dollar Amount between 0 and 99, 2 Decimal Digits
"^DD",9002313.59,9002313.59,504,21,0)
^^2^2^3000313^
"^DD",9002313.59,9002313.59,504,21,1,0)
Storing it here, since it can vary by insurer (or maybe by Pharmacy, too?
"^DD",9002313.59,9002313.59,504,21,2,0)
maybe we want to put a field in 9002313.56)
"^DD",9002313.59,9002313.59,504,"DT")
3000313
"^DD",9002313.59,9002313.59,505,0)
TOTAL PRICE^NJ9,2O^^5;5^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>999999)!(X<0) X
"^DD",9002313.59,9002313.59,505,2)
S Y(0)=Y S X=$J(X,0,2)
"^DD",9002313.59,9002313.59,505,2.1)
S X=$J(X,0,2)
"^DD",9002313.59,9002313.59,505,3)
Type a Dollar Amount between 0 and 999999, 2 Decimal Digits
"^DD",9002313.59,9002313.59,505,21,0)
^^1^1^3000313^
"^DD",9002313.59,9002313.59,505,21,1,0)
=SUBTOTAL + DISPENSING FEE
"^DD",9002313.59,9002313.59,505,"DT")
3040116
"^DD",9002313.59,9002313.59,507,0)
ADMINISTRATIVE FEE^F^^5;7^K:$L(X)>15!($L(X)<1) X
"^DD",9002313.59,9002313.59,507,3)
Answer must be 1-15 characters in length.
"^DD",9002313.59,9002313.59,507,21,0)
^^1^1^3031126^
"^DD",9002313.59,9002313.59,507,21,1,0)
Any fee charged for handling of the paperwork.
"^DD",9002313.59,9002313.59,507,"DT")
3031126
"^DD",9002313.59,9002313.59,508,0)
UNIT OF MEASURE^F^^5;8^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.59,9002313.59,508,3)
Enter the Unit of Measure (1-2 characters)
"^DD",9002313.59,9002313.59,508,21,0)
^^2^2^3070627^
"^DD",9002313.59,9002313.59,508,21,1,0)
Enter the Unit of Measure for the drug.  This is usually GR (grams), ML 
"^DD",9002313.59,9002313.59,508,21,2,0)
(milliliters), or EA (Each).
"^DD",9002313.59,9002313.59,508,"DT")
3070627
"^DD",9002313.59,9002313.59,801,0)
ASLEEP PAYER^P9002313.15'^BPS(9002313.15,^8;1^Q
"^DD",9002313.59,9002313.59,801,1,0)
^.1
"^DD",9002313.59,9002313.59,801,1,1,0)
9002313.59^ASL
"^DD",9002313.59,9002313.59,801,1,1,1)
S ^BPST("ASL",$E(X,1,30),DA)=""
"^DD",9002313.59,9002313.59,801,1,1,2)
K ^BPST("ASL",$E(X,1,30),DA)
"^DD",9002313.59,9002313.59,801,1,1,"DT")
3080319
"^DD",9002313.59,9002313.59,801,3)
Specify a payer that is identified as being asleep.
"^DD",9002313.59,9002313.59,801,21,0)
^^1^1^3080613^
"^DD",9002313.59,9002313.59,801,21,1,0)
This field identifies an asleep payer for this transaction.
"^DD",9002313.59,9002313.59,801,"DT")
3080613
"^DD",9002313.59,9002313.59,901,0)
CURRENT VA INSURER^F^^9;1^K:$L(X)>15!($L(X)<1) X
"^DD",9002313.59,9002313.59,901,3)
Answer must be 1-15 characters in length.
"^DD",9002313.59,9002313.59,901,21,0)
^^2^2^3040120^
"^DD",9002313.59,9002313.59,901,21,1,0)
The insurer being submitted to currently, if there are Primary, Secondary,
"^DD",9002313.59,9002313.59,901,21,2,0)
and tertiary insurers defined.
"^DD",9002313.59,9002313.59,901,"DT")
3030626
"^DD",9002313.59,9002313.59,901.04,0)
ELIGIBILITY^S^V:VETERAN;T:TRICARE;C:CHAMPVA;^9;4^Q
"^DD",9002313.59,9002313.59,901.04,3)
Enter (V)eteran, (T)ricare, or (C)hampVA.
"^DD",9002313.59,9002313.59,901.04,21,0)
^^1^1^3071024^
"^DD",9002313.59,9002313.59,901.04,21,1,0)
The insurance eligibility type of the claim.
"^DD",9002313.59,9002313.59,901.04,"DT")
3071024
"^DD",9002313.59,9002313.59,902,0)
PATIENT INSURANCE MULTIPLE^9002313.59902PA^^10;0
"^DD",9002313.59,9002313.59,902,3)
Answer with GROUP INSURANCE PLAN.
"^DD",9002313.59,9002313.59,902,21,0)
^^1^1^3080603^
"^DD",9002313.59,9002313.59,902,21,1,0)
List of the insurers for the patient.
"^DD",9002313.59,9002313.59,902,"DT")
3080102
"^DD",9002313.59,9002313.59,1201,0)
RX ACTION^F^^12;1^K:$L(X)>4!($L(X)<1) X
"^DD",9002313.59,9002313.59,1201,3)
Answer must be 1-4 characters in length.
"^DD",9002313.59,9002313.59,1201,21,0)
^^3^3^3050629^
"^DD",9002313.59,9002313.59,1201,21,1,0)
This is the BWHERE parameter passed into BPSNCPDP and is the action
"^DD",9002313.59,9002313.59,1201,21,2,0)
that is being performed on this RX (AREV, BB, CRLB, CRLR, CRLX, DC, DDED,
"^DD",9002313.59,9002313.59,1201,21,3,0)
DE, ED, ERES, EREV, OF, PC, PE, PL, PP, RF, RL, RN, RRL, and RS).
"^DD",9002313.59,9002313.59,1201,"DT")
3050629
"^DD",9002313.59,9002313.59,1202,0)
DATE OF SERVICE^D^^12;2^S %DT="E" D ^%DT S X=Y K:X<1 X
"^DD",9002313.59,9002313.59,1202,3)
(No range limit on date)
"^DD",9002313.59,9002313.59,1202,21,0)
^^1^1^3050525^
"^DD",9002313.59,9002313.59,1202,21,1,0)
Date to be used for the 401-D1 (DATE OF SERVICE) field for the claim
"^DD",9002313.59,9002313.59,1202,"DT")
3050525
"^DD",9002313.59,9002313.59,1203,0)
SUBMISSION CLARIFICATION CODE^F^^12;3^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.59,9002313.59,1203,3)
Answer must be 1-2 characters in length.
"^DD",9002313.59,9002313.59,1203,21,0)
^.001^1^1^3070119^^^
"^DD",9002313.59,9002313.59,1203,21,1,0)
Submission Clarification Code
"^DD",9002313.59,9002313.59,1203,"DT")
3070119
"^DD",9002313.59,9002313.59,1300,0)
DUR DATA^9002313.5913^^13;0
"^DD",9002313.59,9002313.59,1300,3)
Enter a DUR Data Counter.
"^DD",9002313.59,9002313.59,1300,21,0)
^^3^3^3050628^
"^DD",9002313.59,9002313.59,1300,21,1,0)
This multiple will track the Drug Utilization Review (DUR) information
"^DD",9002313.59,9002313.59,1300,21,2,0)
passed by Outpatient Pharmacy to ECME and that will eventually be put 
"^DD",9002313.59,9002313.59,1300,21,3,0)
in the DUR segment of the NCPDP claim.
"^DD",9002313.59,9002313.59,9999.96,0)
NET PAID BY INSURER^CJ8,2^^ ; ^N RESP,POSITION S X=$G(^BPSTL(D0,0)),RESP=$P(X,U,5),POSITION=$P(X,U,9),X=$S(RESP&POSITION:$$NETPAID1^BPSOS03(RESP,POSITION),1:"")
"^DD",9002313.59,9002313.59,9999.96,9)
^
"^DD",9002313.59,9002313.59,9999.96,9.01)

"^DD",9002313.59,9002313.59,9999.96,9.1)
N RESP,POSITION S X=$G(^BPSTL(D0,0)),RESP=$P(X,U,5),POSITION=$P(X,U,9),X=$S(RESP&POSITION:$$NETPAID1^BPSOS03(RESP,POSITION),1:"")
"^DD",9002313.59,9002313.59,9999.96,21,0)
^^1^1^3080102^
"^DD",9002313.59,9002313.59,9999.96,21,1,0)
Amount paid after the discounts and deductible have been subtracted.
"^DD",9002313.59,9002313.59,9999.96,"DT")
3080102
"^DD",9002313.59,9002313.59,9999.97,0)
ELAPSED TIME (PRINTABLE)^CJ8^^ ; ^S X=$$TIMEDIF^BPSOSUD($P(^BPST(D0,0),U,11),$P(^BPST(D0,0),U,8))
"^DD",9002313.59,9002313.59,9999.97,9)
^
"^DD",9002313.59,9002313.59,9999.97,9.01)

"^DD",9002313.59,9002313.59,9999.97,9.1)
S X=$$TIMEDIF^BPSOSUD($P(^BPST(D0,0),U,11),$P(^BPST(D0,0),U,8))
"^DD",9002313.59,9002313.59,9999.97,21,0)
^^2^2^3080102^
"^DD",9002313.59,9002313.59,9999.97,21,1,0)
The elapsed time between the filling of the prescription and the return of
"^DD",9002313.59,9002313.59,9999.97,21,2,0)
the response from the payer.
"^DD",9002313.59,9002313.59,9999.97,"DT")
3080102
"^DD",9002313.59,9002313.59,9999.98,0)
ELAPSED TIME (SECONDS)^CJ8^^ ; ^S X=$$TIMEDIFI^BPSOSUD($P(^BPST(D0,0),U,11),$P(^BPST(D0,0),U,8))
"^DD",9002313.59,9002313.59,9999.98,9)
^
"^DD",9002313.59,9002313.59,9999.98,9.01)

"^DD",9002313.59,9002313.59,9999.98,9.1)
S X=$$TIMEDIFI^BPSOSUD($P(^BPST(D0,0),U,11),$P(^BPST(D0,0),U,8))
"^DD",9002313.59,9002313.59,9999.98,21,0)
^^2^2^3040120^
"^DD",9002313.59,9002313.59,9999.98,21,1,0)
The number of seconds between the placing of the order and the receipt of
"^DD",9002313.59,9002313.59,9999.98,21,2,0)
the response.
"^DD",9002313.59,9002313.59,9999.98,"DT")
3001020
"^DD",9002313.59,9002313.59,9999.99,0)
RESULT CATEGORY^CJ20^^ ; ^S X=$$CATEG^BPSOSUC(D0)
"^DD",9002313.59,9002313.59,9999.99,9)
^
"^DD",9002313.59,9002313.59,9999.99,9.01)

"^DD",9002313.59,9002313.59,9999.99,9.1)
S X=$$CATEG^BPSOSUC(D0)
"^DD",9002313.59,9002313.59,9999.99,21,0)
^.001^5^5^3040405^^
"^DD",9002313.59,9002313.59,9999.99,21,1,0)
The category of the response.
"^DD",9002313.59,9002313.59,9999.99,21,2,0)
 
"^DD",9002313.59,9002313.59,9999.99,21,3,0)
"P"aid
"^DD",9002313.59,9002313.59,9999.99,21,4,0)
"R"ejected
"^DD",9002313.59,9002313.59,9999.99,21,5,0)
"A"ccepted
"^DD",9002313.59,9002313.59,9999.99,"DT")
3040405
"^DD",9002313.59,9002313.59111,0)
COMMENT MULTIPLE SUB-FIELD^^.03^3
"^DD",9002313.59,9002313.59111,0,"DT")
3050503
"^DD",9002313.59,9002313.59111,0,"IX","B",9002313.59111,.01)

"^DD",9002313.59,9002313.59111,0,"NM","COMMENT MULTIPLE")

"^DD",9002313.59,9002313.59111,0,"UP")
9002313.59
"^DD",9002313.59,9002313.59111,.01,0)
DATE^D^^0;1^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.59,9002313.59111,.01,1,0)
^.1
"^DD",9002313.59,9002313.59111,.01,1,1,0)
9002313.59111^B
"^DD",9002313.59,9002313.59111,.01,1,1,1)
S ^BPST(DA(1),11,"B",$E(X,1,30),DA)=""
"^DD",9002313.59,9002313.59111,.01,1,1,2)
K ^BPST(DA(1),11,"B",$E(X,1,30),DA)
"^DD",9002313.59,9002313.59111,.01,3)
Answer with a date of the comment.
"^DD",9002313.59,9002313.59111,.01,21,0)
^.001^1^1^3050527^^^^
"^DD",9002313.59,9002313.59111,.01,21,1,0)
To store user's comments date
"^DD",9002313.59,9002313.59111,.01,"DT")
3050503
"^DD",9002313.59,9002313.59111,.02,0)
USER^P200'^VA(200,^0;2^Q
"^DD",9002313.59,9002313.59111,.02,3)
Enter the user who entered this comment.
"^DD",9002313.59,9002313.59111,.02,21,0)
^.001^1^1^3050629^^^
"^DD",9002313.59,9002313.59111,.02,21,1,0)
ECME user
"^DD",9002313.59,9002313.59111,.02,"DT")
3080613
"^DD",9002313.59,9002313.59111,.03,0)
COMMENT^F^^0;3^K:$L(X)>74!($L(X)<1) X
"^DD",9002313.59,9002313.59111,.03,3)
Answer must be 1-74 characters in length.
"^DD",9002313.59,9002313.59111,.03,21,0)
^^1^1^3050503^
"^DD",9002313.59,9002313.59111,.03,21,1,0)
Comment text
"^DD",9002313.59,9002313.59111,.03,"DT")
3050503
"^DD",9002313.59,9002313.5913,0)
DUR DATA SUB-FIELD^^3^4
"^DD",9002313.59,9002313.5913,0,"DT")
3050614
"^DD",9002313.59,9002313.5913,0,"IX","B",9002313.5913,.01)

"^DD",9002313.59,9002313.5913,0,"NM","DUR DATA")

"^DD",9002313.59,9002313.5913,0,"UP")
9002313.59
"^DD",9002313.59,9002313.5913,.01,0)
DUR COUNTER^NJ3,0^^0;1^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1.N) X
"^DD",9002313.59,9002313.5913,.01,1,0)
^.1
"^DD",9002313.59,9002313.5913,.01,1,1,0)
9002313.5913^B
"^DD",9002313.59,9002313.5913,.01,1,1,1)
S ^BPST(DA(1),13,"B",$E(X,1,30),DA)=""
"^DD",9002313.59,9002313.5913,.01,1,1,2)
K ^BPST(DA(1),13,"B",$E(X,1,30),DA)
"^DD",9002313.59,9002313.5913,.01,3)
Enter the DUR counter for the claim
"^DD",9002313.59,9002313.5913,.01,21,0)
^^1^1^3050614^
"^DD",9002313.59,9002313.5913,.01,21,1,0)
This is the counter that will be used for field 473-7E of the claim
"^DD",9002313.59,9002313.5913,.01,"DT")
3050614
"^DD",9002313.59,9002313.5913,1,0)
DUR PROFESSIONAL SERVICE CODE^F^^0;2^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.59,9002313.5913,1,3)
Enter the professional service code for the claim
"^DD",9002313.59,9002313.5913,1,21,0)
^^1^1^3050614^
"^DD",9002313.59,9002313.5913,1,21,1,0)
This will be used for field 439-E4 of the claim
"^DD",9002313.59,9002313.5913,1,"DT")
3050614
"^DD",9002313.59,9002313.5913,2,0)
DUR REASON FOR SERVICE CODE^F^^0;3^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.59,9002313.5913,2,3)
Enter the DUR Reason for the Service Code for the claim
"^DD",9002313.59,9002313.5913,2,21,0)
^^1^1^3050614^
"^DD",9002313.59,9002313.5913,2,21,1,0)
This will be used for field 440-E5 of the claim
"^DD",9002313.59,9002313.5913,2,"DT")
3050614
"^DD",9002313.59,9002313.5913,3,0)
DUR RESULT OF SERVICE CODE^F^^0;4^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.59,9002313.5913,3,3)
Enter the Result of Service Code for the claim
"^DD",9002313.59,9002313.5913,3,21,0)
^^1^1^3050614^
"^DD",9002313.59,9002313.5913,3,21,1,0)
This will be used for field 441-E6 of the claim
"^DD",9002313.59,9002313.5913,3,"DT")
3050614
"^DD",9002313.59,9002313.59902,0)
PATIENT INSURANCE MULTIPLE SUB-FIELD^^902.27^26
"^DD",9002313.59,9002313.59902,0,"DT")
3080603
"^DD",9002313.59,9002313.59902,0,"IX","B",9002313.59902,.01)

"^DD",9002313.59,9002313.59902,0,"NM","PATIENT INSURANCE MULTIPLE")

"^DD",9002313.59,9002313.59902,0,"UP")
9002313.59
"^DD",9002313.59,9002313.59902,.01,0)
PLAN ID^MP355.3'^IBA(355.3,^0;1^Q
"^DD",9002313.59,9002313.59902,.01,1,0)
^.1
"^DD",9002313.59,9002313.59902,.01,1,1,0)
9002313.59902^B
"^DD",9002313.59,9002313.59902,.01,1,1,1)
S ^BPST(DA(1),10,"B",$E(X,1,30),DA)=""
"^DD",9002313.59,9002313.59902,.01,1,1,2)
K ^BPST(DA(1),10,"B",$E(X,1,30),DA)
"^DD",9002313.59,9002313.59902,.01,3)
Enter Group Insurance record
"^DD",9002313.59,9002313.59902,.01,21,0)
^.001^1^1^3041014^^^^
"^DD",9002313.59,9002313.59902,.01,21,1,0)
ID assigned to the insurance plan.
"^DD",9002313.59,9002313.59902,.01,"DT")
3050727
"^DD",9002313.59,9002313.59902,902.02,0)
PAYER SHEET^P9002313.92'^BPSF(9002313.92,^0;2^Q
"^DD",9002313.59,9002313.59902,902.02,3)
Answer with a payer sheet to be used for this claim.
"^DD",9002313.59,9002313.59902,902.02,21,0)
^^1^1^3040120^
"^DD",9002313.59,9002313.59902,902.02,21,1,0)
The payer sheet to be used for this particular insurer.
"^DD",9002313.59,9002313.59902,902.02,"DT")
3080319
"^DD",9002313.59,9002313.59902,902.03,0)
BIN^F^^1;1^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.59,9002313.59902,902.03,3)
Answer must be 1-10 characters in length.
"^DD",9002313.59,9002313.59902,902.03,21,0)
^^1^1^3031126^
"^DD",9002313.59,9002313.59902,902.03,21,1,0)
Card Issuer ID or Bank ID Number used for network routing.
"^DD",9002313.59,9002313.59902,902.03,"DT")
3031126
"^DD",9002313.59,9002313.59902,902.04,0)
PCN^F^^1;2^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.59,9002313.59902,902.04,3)
Answer must be 1-10 characters in length.
"^DD",9002313.59,9002313.59902,902.04,21,0)
^^1^1^3080102^
"^DD",9002313.59,9002313.59902,902.04,21,1,0)
The processor control number for this claim.
"^DD",9002313.59,9002313.59902,902.04,"DT")
3080102
"^DD",9002313.59,9002313.59902,902.05,0)
GROUP ID^F^^1;3^K:$L(X)>17!($L(X)<1) X
"^DD",9002313.59,9002313.59902,902.05,3)
Answer must be 1-17 characters in length
"^DD",9002313.59,9002313.59902,902.05,21,0)
^^1^1^3031126^
"^DD",9002313.59,9002313.59902,902.05,21,1,0)
ID assigned to the cardholder group or employer group.
"^DD",9002313.59,9002313.59902,902.05,"DT")
3050913
"^DD",9002313.59,9002313.59902,902.06,0)
CARDHOLDER ID^F^^1;4^K:$L(X)>20!($L(X)<1) X
"^DD",9002313.59,9002313.59902,902.06,3)
Answer must be 1-20 characters in length.
"^DD",9002313.59,9002313.59902,902.06,21,0)
^^1^1^3031126^
"^DD",9002313.59,9002313.59902,902.06,21,1,0)
ID number assigned to Cardholder/Subscriber.
"^DD",9002313.59,9002313.59902,902.06,"DT")
3031126
"^DD",9002313.59,9002313.59902,902.07,0)
PATIENT RELATIONSHIP CODE^S^1:SELF (PATIENT);2:SPOUSE;3:CHILD;4:OTHER;^1;5^Q
"^DD",9002313.59,9002313.59902,902.07,3)
Answer must be 1 character in length.
"^DD",9002313.59,9002313.59902,902.07,21,0)
^^1^1^3031126^
"^DD",9002313.59,9002313.59902,902.07,21,1,0)
Patient relationship to insurance subscriber.
"^DD",9002313.59,9002313.59902,902.07,"DT")
3080603
"^DD",9002313.59,9002313.59902,902.08,0)
CARDHOLDER FIRST NAME^F^^1;6^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.59,9002313.59902,902.08,3)
Answer must be 1-30 characters in length.
"^DD",9002313.59,9002313.59902,902.08,21,0)
^.001^1^1^3050119^^
"^DD",9002313.59,9002313.59902,902.08,21,1,0)
First name of the Cardholder/Subscriber.
"^DD",9002313.59,9002313.59902,902.08,"DT")
3050119
"^DD",9002313.59,9002313.59902,902.09,0)
CARDHOLDER LAST NAME^F^^1;7^K:$L(X)>15!($L(X)<1) X
"^DD",9002313.59,9002313.59902,902.09,3)
Answer must be 1-15 characters in length.
"^DD",9002313.59,9002313.59902,902.09,21,0)
^.001^1^1^3050119^^
"^DD",9002313.59,9002313.59902,902.09,21,1,0)
Last name of the Cardholder/Subscriber.
"^DD",9002313.59,9002313.59902,902.09,"DT")
3031126
"^DD",9002313.59,9002313.59902,902.11,0)
HOME PLAN STATE^F^^1;8^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.59,9002313.59902,902.11,3)
Answer must be 1-2 characters in length.
"^DD",9002313.59,9002313.59902,902.11,21,0)
^^1^1^3031126^
"^DD",9002313.59,9002313.59902,902.11,21,1,0)
Usually the state where the member lives or purchased their coverage. 
"^DD",9002313.59,9002313.59902,902.11,"DT")
3031126
"^DD",9002313.59,9002313.59902,902.12,0)
DISPENSING FEE SUBMITTED^NJ8,2^^2;1^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>99999)!(X<0)!(X?.E1"."3.N) X
"^DD",9002313.59,9002313.59902,902.12,3)
Type a Dollar amount between 0 and 99999, 2 Decimal Digits
"^DD",9002313.59,9002313.59902,902.12,21,0)
^^2^2^3080102^
"^DD",9002313.59,9002313.59902,902.12,21,1,0)
Fee amount submitted for the cost associated with dispensing this 
"^DD",9002313.59,9002313.59902,902.12,21,2,0)
prescription.
"^DD",9002313.59,9002313.59902,902.12,"DT")
3080102
"^DD",9002313.59,9002313.59902,902.13,0)
BASIS OF COST DETERMINATION^S^01:AWP;05:Cost Calculations;07:Usual & Customary;^2;2^Q
"^DD",9002313.59,9002313.59902,902.13,3)
Answer with the basis code for which the cost was determined.
"^DD",9002313.59,9002313.59902,902.13,21,0)
^^2^2^3031126^
"^DD",9002313.59,9002313.59902,902.13,21,1,0)
Code indicating the method by which 'Ingredient Cost Submitted' was
"^DD",9002313.59,9002313.59902,902.13,21,2,0)
calculated.
"^DD",9002313.59,9002313.59902,902.13,"DT")
3080603
"^DD",9002313.59,9002313.59902,902.14,0)
USUAL CUSTOMARY CHARGE^NJ8,2^^2;3^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>99999)!(X<0)!(X?.E1"."3.N) X
"^DD",9002313.59,9002313.59902,902.14,3)
Type a Dollar amount between 0 and 99999, 2 Decimal Digits
"^DD",9002313.59,9002313.59902,902.14,21,0)
^^2^2^3031126^
"^DD",9002313.59,9002313.59902,902.14,21,1,0)
Amount charged cash customers for the prescription exclusive of sales tax 
"^DD",9002313.59,9002313.59902,902.14,21,2,0)
or other amounts claimed.
"^DD",9002313.59,9002313.59902,902.14,"DT")
3080102
"^DD",9002313.59,9002313.59902,902.15,0)
GROSS AMOUNT DUE^NJ8,2^^2;4^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>99999)!(X<0)!(X?.E1"."3.N) X
"^DD",9002313.59,9002313.59902,902.15,3)
Type a Dollar amount between 0 and 99999, 2 Decimal Digits
"^DD",9002313.59,9002313.59902,902.15,21,0)
^^9^9^3031126^
"^DD",9002313.59,9002313.59902,902.15,21,1,0)
Total price claimed from all sources.  For prescription claim request, 
"^DD",9002313.59,9002313.59902,902.15,21,2,0)
field represents a sum of 'Ingredient Cost Submitted'  (49-D9), 
"^DD",9002313.59,9002313.59902,902.15,21,3,0)
'Dispensing Fee Submitted' (412-DC), 'Flat Sales Tax Amount 
"^DD",9002313.59,9002313.59902,902.15,21,4,0)
Submitted'(481-HA), 'Percentage Sales Tax Amount Submitted' (482-GE), 
"^DD",9002313.59,9002313.59902,902.15,21,5,0)
'Incentive Amount Submitted' (438-E3), 'Other Amount Claimed' (48-H9). 
"^DD",9002313.59,9002313.59902,902.15,21,6,0)
For service claim request, field represents a sum of 'Professional 
"^DD",9002313.59,9002313.59902,902.15,21,7,0)
Services Fee Submitted' (477-BE), 'Flat Sales Tax Amount 
"^DD",9002313.59,9002313.59902,902.15,21,8,0)
Submitted'(481-HA), 'Percentage Sales Tax Amount Submitted'(482-GE), 
"^DD",9002313.59,9002313.59902,902.15,21,9,0)
'Other Amount Claimed' (48-H9).
"^DD",9002313.59,9002313.59902,902.15,"DT")
3080102
"^DD",9002313.59,9002313.59902,902.16,0)
ADMINISTRATIVE FEE^NJ8,2^^2;5^S:X["$" X=$P(X,"$",2) K:X'?.N.1".".2N!(X>99999)!(X<0)!(X?.E1"."3.N) X
"^DD",9002313.59,9002313.59902,902.16,3)
Type a Dollar amount between 0 and 99999, 2 Decimal Digits
"^DD",9002313.59,9002313.59902,902.16,21,0)
^^1^1^3031126^
"^DD",9002313.59,9002313.59902,902.16,21,1,0)
Fee charged for any costs related to preparing the prescription.
"^DD",9002313.59,9002313.59902,902.16,"DT")
3080102
"^DD",9002313.59,9002313.59902,902.17,0)
VA FILL NUMBER^NJ2,0^^2;6^K:+X'=X!(X>99)!(X<0)!(X?.E1"."1.N) X
"^DD",9002313.59,9002313.59902,902.17,3)
Type a number between 0 and 99, 0 Decimal Digits
"^DD",9002313.59,9002313.59902,902.17,21,0)
^^2^2^3040120^
"^DD",9002313.59,9002313.59902,902.17,21,1,0)
Which fill number this transaction is in reference to.
"^DD",9002313.59,9002313.59902,902.17,21,2,0)
Starts with '0' for the original fill.
"^DD",9002313.59,9002313.59902,902.17,"DT")
3080102
"^DD",9002313.59,9002313.59902,902.18,0)
SOFTWARE VENDOR CERT ID^F^^2;7^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.59,9002313.59902,902.18,3)
Answer must be 1-30 characters in length.
"^DD",9002313.59,9002313.59902,902.18,21,0)
^^1^1^3040120^
"^DD",9002313.59,9002313.59902,902.18,21,1,0)
Certification number assigned by the payer for submission of claims.
"^DD",9002313.59,9002313.59902,902.18,"DT")
3080102
"^DD",9002313.59,9002313.59902,902.19,0)
B2 PAYER SHEET^P9002313.92'^BPSF(9002313.92,^0;3^Q
"^DD",9002313.59,9002313.59902,902.19,3)
Enter the reversal payer sheet IEN.
"^DD",9002313.59,9002313.59902,902.19,21,0)
^^1^1^3031112^
"^DD",9002313.59,9002313.59902,902.19,21,1,0)
Enter the Reversal Payer sheet IEN.
"^DD",9002313.59,9002313.59902,902.19,"DT")
3080319
"^DD",9002313.59,9002313.59902,902.21,0)
B3 REBILL PAYER SHEET^P9002313.92'^BPSF(9002313.92,^0;4^Q
"^DD",9002313.59,9002313.59902,902.21,3)
Enter the Rebill payer sheet IEN.
"^DD",9002313.59,9002313.59902,902.21,21,0)
^^1^1^3080102^
"^DD",9002313.59,9002313.59902,902.21,21,1,0)
Enter the Rebill payer sheet IEN.
"^DD",9002313.59,9002313.59902,902.21,"DT")
3080102
"^DD",9002313.59,9002313.59902,902.22,0)
CERTIFY MODE^S^0:CERTIFY MODE OFF;1:CERTFIY MODE ON;^0;5^Q
"^DD",9002313.59,9002313.59902,902.22,3)
Enter null or 0 for certify mode off.  Enter 1 for Certify mode on.
"^DD",9002313.59,9002313.59902,902.22,21,0)
^^1^1^3080603^
"^DD",9002313.59,9002313.59902,902.22,21,1,0)
Enter null or 0 for certify mode off.  Enter 1 for certify mode on.
"^DD",9002313.59,9002313.59902,902.22,"DT")
3080603
"^DD",9002313.59,9002313.59902,902.23,0)
CERTIFICATION^P9002313.31'^BPS(9002313.31,^0;6^Q
"^DD",9002313.59,9002313.59902,902.23,3)
Enter the Certification record
"^DD",9002313.59,9002313.59902,902.23,21,0)
^^2^2^3061122^
"^DD",9002313.59,9002313.59902,902.23,21,1,0)
This field is used during certification testing, and points to the entry 
"^DD",9002313.59,9002313.59902,902.23,21,2,0)
to use to pull certification data.
"^DD",9002313.59,9002313.59902,902.23,"DT")
3080319
"^DD",9002313.59,9002313.59902,902.24,0)
INSURANCE NAME^F^^0;7^K:$L(X)>40!($L(X)<1) X
"^DD",9002313.59,9002313.59902,902.24,3)
Answer must be 1-40 characters in length.
"^DD",9002313.59,9002313.59902,902.24,21,0)
^^2^2^3080603^
"^DD",9002313.59,9002313.59902,902.24,21,1,0)
This is the free text name of the Insurance Company as determined by 
"^DD",9002313.59,9002313.59902,902.24,21,2,0)
Integrated Billing insurance files.
"^DD",9002313.59,9002313.59902,902.24,"DT")
3080603
"^DD",9002313.59,9002313.59902,902.25,0)
GROUP NAME^F^^3;1^K:$L(X)>20!($L(X)<2) X
"^DD",9002313.59,9002313.59902,902.25,3)
Answer must be 2-20 characters in length
"^DD",9002313.59,9002313.59902,902.25,21,0)
^^1^1^3050614^
"^DD",9002313.59,9002313.59902,902.25,21,1,0)
This is the group name from the Group Insurance File
"^DD",9002313.59,9002313.59902,902.25,"DT")
3050913
"^DD",9002313.59,9002313.59902,902.26,0)
INSURANCE CO PHONE^F^^3;2^K:$L(X)>20!($L(X)<7) X
"^DD",9002313.59,9002313.59902,902.26,3)
Answer must be 7-20 characters in length
"^DD",9002313.59,9002313.59902,902.26,21,0)
^^1^1^3050614^
"^DD",9002313.59,9002313.59902,902.26,21,1,0)
This is the Claim (RX) phone number from the Insurance Company file
"^DD",9002313.59,9002313.59902,902.26,"DT")
3080319
"^DD",9002313.59,9002313.59902,902.27,0)
PHARMACY PLAN ID^F^^3;3^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.59,9002313.59902,902.27,3)
Answer must be 1-30 characters in length
"^DD",9002313.59,9002313.59902,902.27,21,0)
^^1^1^3050617^
"^DD",9002313.59,9002313.59902,902.27,21,1,0)
This is a ID of the plan file
"^DD",9002313.59,9002313.59902,902.27,"DT")
3050617
"^DD",9002313.59,9002313.59902,902.28,0)
INSURANCE COMPANY^P36'^DIC(36,^3;4^Q
"^DD",9002313.59,9002313.59902,902.28,3)
Enter the name of the insurance carrier for this claim
"^DD",9002313.59,9002313.59902,902.28,21,0)
^^1^1^3080603^
"^DD",9002313.59,9002313.59902,902.28,21,1,0)
This is the INSURANCE COMPANY from file #36.
"^DD",9002313.59,9002313.59902,902.28,"DT")
3080603
"^DD",9002313.77,9002313.77,0)
FIELD^^2.09^40
"^DD",9002313.77,9002313.77,0,"DDA")
N
"^DD",9002313.77,9002313.77,0,"DT")
3081128
"^DD",9002313.77,9002313.77,0,"IX","B",9002313.77,.01)

"^DD",9002313.77,9002313.77,0,"IX","C",9002313.77,.06)

"^DD",9002313.77,9002313.77,0,"IX","E",9002313.77,6.05)

"^DD",9002313.77,9002313.77,0,"NM","BPS REQUESTS")

"^DD",9002313.77,9002313.77,0,"PT",9002313.15,.04)

"^DD",9002313.77,9002313.77,0,"PT",9002313.57,16)

"^DD",9002313.77,9002313.77,0,"PT",9002313.57,405)

"^DD",9002313.77,9002313.77,0,"PT",9002313.59,16)

"^DD",9002313.77,9002313.77,0,"PT",9002313.59,405)

"^DD",9002313.77,9002313.77,0,"PT",9002313.77,.05)

"^DD",9002313.77,9002313.77,0,"VRPK")
BPS
"^DD",9002313.77,9002313.77,.01,0)
RX NUMBER^RP52'^PSRX(^0;1^Q
"^DD",9002313.77,9002313.77,.01,1,0)
^.1
"^DD",9002313.77,9002313.77,.01,1,1,0)
9002313.77^B
"^DD",9002313.77,9002313.77,.01,1,1,1)
S ^BPS(9002313.77,"B",$E(X,1,30),DA)=""
"^DD",9002313.77,9002313.77,.01,1,1,2)
K ^BPS(9002313.77,"B",$E(X,1,30),DA)
"^DD",9002313.77,9002313.77,.01,3)
Answer with PRESCRIPTION RX #
"^DD",9002313.77,9002313.77,.01,21,0)
^^1^1^3080623^
"^DD",9002313.77,9002313.77,.01,21,1,0)
This is the prescription to be processed.
"^DD",9002313.77,9002313.77,.01,"DT")
3080623
"^DD",9002313.77,9002313.77,.02,0)
REFILL NO^RNJ2,0^^0;2^K:+X'=X!(X>99)!(X<0)!(X?.E1"."1.N) X
"^DD",9002313.77,9002313.77,.02,3)
Type a number between 0 and 99, 0 Decimal Digits
"^DD",9002313.77,9002313.77,.02,21,0)
^.001^1^1^3071015^^
"^DD",9002313.77,9002313.77,.02,21,1,0)
Refill number: 0-original, 1..12 - refills
"^DD",9002313.77,9002313.77,.02,"DT")
3080506
"^DD",9002313.77,9002313.77,.03,0)
ACTING COB^S^1:PRIMARY;2:SECONDARY;3:TERTIARY;^0;3^Q
"^DD",9002313.77,9002313.77,.03,3)
Answer with a Coordination of Benefits indicator
"^DD",9002313.77,9002313.77,.03,21,0)
^^6^6^3080623^
"^DD",9002313.77,9002313.77,.03,21,1,0)
This field indicates for which insurer (in terms of coordination of 
"^DD",9002313.77,9002313.77,.03,21,2,0)
benefits) this particular request was created. For example, if the 
"^DD",9002313.77,9002313.77,.03,21,3,0)
patient has three insurances then three separate requests can be created 
"^DD",9002313.77,9002313.77,.03,21,4,0)
for the same prescription/refill in order to bill patient's Primary, 
"^DD",9002313.77,9002313.77,.03,21,5,0)
Secondary and Tertiary insurers. This field indicates for which insurer 
"^DD",9002313.77,9002313.77,.03,21,6,0)
this request is for.
"^DD",9002313.77,9002313.77,.03,"DT")
3080623
"^DD",9002313.77,9002313.77,.04,0)
PROCESS FLAG^RS^0:SCHEDULED;1:ACTIVATED;2:IN PROCESS;3:COMPLETED;4:CANCELLED;5:INACTIVE;^0;4^Q
"^DD",9002313.77,9002313.77,.04,3)
Select a process flag for the request
"^DD",9002313.77,9002313.77,.04,21,0)
^^15^15^3080625^
"^DD",9002313.77,9002313.77,.04,21,1,0)
State of the request.
"^DD",9002313.77,9002313.77,.04,21,2,0)
 
"^DD",9002313.77,9002313.77,.04,21,3,0)
SCHEDULED - scheduled for the future (for example : the secondary claim is
"^DD",9002313.77,9002313.77,.04,21,4,0)
scheduled to be processed after the primary is completed)
"^DD",9002313.77,9002313.77,.04,21,5,0)
 
"^DD",9002313.77,9002313.77,.04,21,6,0)
ACTIVATED - ready to be processed
"^DD",9002313.77,9002313.77,.04,21,7,0)
 
"^DD",9002313.77,9002313.77,.04,21,8,0)
IN PROCESS - currently in process
"^DD",9002313.77,9002313.77,.04,21,9,0)
 
"^DD",9002313.77,9002313.77,.04,21,10,0)
COMPLETED - has been completed
"^DD",9002313.77,9002313.77,.04,21,11,0)
 
"^DD",9002313.77,9002313.77,.04,21,12,0)
CANCELLED - cancelled
"^DD",9002313.77,9002313.77,.04,21,13,0)
 
"^DD",9002313.77,9002313.77,.04,21,14,0)
INACTIVE - the system marks the records with "bad" data as inactive 
"^DD",9002313.77,9002313.77,.04,21,15,0)
instead of removing them - to keep them  for repair or for investigation
"^DD",9002313.77,9002313.77,.04,"DT")
3080625
"^DD",9002313.77,9002313.77,.05,0)
NEXT REQUEST^P9002313.77'^BPS(9002313.77,^0;5^Q
"^DD",9002313.77,9002313.77,.05,3)
Answer with the request that follows this one
"^DD",9002313.77,9002313.77,.05,21,0)
^^1^1^3080102^
"^DD",9002313.77,9002313.77,.05,21,1,0)
To store the pointer to the next request which should be processed.
"^DD",9002313.77,9002313.77,.05,"DT")
3080619
"^DD",9002313.77,9002313.77,.06,0)
ECME TRANSACTION RECORD^P9002313.59'^BPST(^0;6^Q
"^DD",9002313.77,9002313.77,.06,1,0)
^.1
"^DD",9002313.77,9002313.77,.06,1,1,0)
9002313.77^C
"^DD",9002313.77,9002313.77,.06,1,1,1)
S ^BPS(9002313.77,"C",$E(X,1,30),DA)=""
"^DD",9002313.77,9002313.77,.06,1,1,2)
K ^BPS(9002313.77,"C",$E(X,1,30),DA)
"^DD",9002313.77,9002313.77,.06,1,1,"DT")
3080404
"^DD",9002313.77,9002313.77,.06,3)
Enter Transaction record from BPS TRANSACTION file 
"^DD",9002313.77,9002313.77,.06,21,0)
^^3^3^3080619^^^
"^DD",9002313.77,9002313.77,.06,21,1,0)
IEN of the BPS TRANSACTION file (#9002313.59).
"^DD",9002313.77,9002313.77,.06,21,2,0)
Format: PRESCRIPTION IEN + "." + padding zeros + refill number + COB 
"^DD",9002313.77,9002313.77,.06,21,3,0)
indicator.
"^DD",9002313.77,9002313.77,.06,"DT")
3080619
"^DD",9002313.77,9002313.77,.07,0)
WAITING RESOLUTION?^S^0:NO;1:YES;^0;7^Q
"^DD",9002313.77,9002313.77,.07,3)
Is this request awaiting resolution?
"^DD",9002313.77,9002313.77,.07,21,0)
^^1^1^3080227^
"^DD",9002313.77,9002313.77,.07,21,1,0)
Flag to mark requests with problems.
"^DD",9002313.77,9002313.77,.07,"DT")
3080623
"^DD",9002313.77,9002313.77,.08,0)
DONT PROCESS UNTIL^D^^0;8^S %DT="ET" D ^%DT S X=Y K:X<1 X
"^DD",9002313.77,9002313.77,.08,3)
Enter Date/Time
"^DD",9002313.77,9002313.77,.08,21,0)
^^2^2^3081113^
"^DD",9002313.77,9002313.77,.08,21,1,0)
The request cannot be processed until the date and time specified
"^DD",9002313.77,9002313.77,.08,21,2,0)
in this field. If null then it can be processed at any time (immediately).
"^DD",9002313.77,9002313.77,.08,"DT")
3081113
"^DD",9002313.77,9002313.77,1.01,0)
RX ACTION^F^^1;1^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.77,9002313.77,1.01,3)
Answer must be 1-10 characters in length.
"^DD",9002313.77,9002313.77,1.01,21,0)
^.001^1^1^3071017^^^^
"^DD",9002313.77,9002313.77,1.01,21,1,0)
RX action (BWHERE parameter passed to ECME API by Outpatient Pharmacy)
"^DD",9002313.77,9002313.77,1.01,23,0)
^^50^50^3071017^
"^DD",9002313.77,9002313.77,1.01,23,1,0)
BWHERE (RX Action):
"^DD",9002313.77,9002313.77,1.01,23,2,0)
 
"^DD",9002313.77,9002313.77,1.01,23,3,0)
ARES = Resubmit for an auto-reversed claim was released while waiting for 
"^DD",9002313.77,9002313.77,1.01,23,4,0)
the payer response 
"^DD",9002313.77,9002313.77,1.01,23,5,0)
 
"^DD",9002313.77,9002313.77,1.01,23,6,0)
AREV = Auto-Reversal 
"^DD",9002313.77,9002313.77,1.01,23,7,0)
 
"^DD",9002313.77,9002313.77,1.01,23,8,0)
BB   = Back Billing 
"^DD",9002313.77,9002313.77,1.01,23,9,0)
 
"^DD",9002313.77,9002313.77,1.01,23,10,0)
CRLB = CMOP Release & Rebill 
"^DD",9002313.77,9002313.77,1.01,23,11,0)
 
"^DD",9002313.77,9002313.77,1.01,23,12,0)
CRLR = CMOP Release & Reverse (successful release) 
"^DD",9002313.77,9002313.77,1.01,23,13,0)
 
"^DD",9002313.77,9002313.77,1.01,23,14,0)
CRLX = CMOP unsuccessful release & reverse 
"^DD",9002313.77,9002313.77,1.01,23,15,0)
 
"^DD",9002313.77,9002313.77,1.01,23,16,0)
DC   = Discontinue - only reverse un-released PAYABLE DC's, release date 
"^DD",9002313.77,9002313.77,1.01,23,17,0)
check should be in calling routine.  
"^DD",9002313.77,9002313.77,1.01,23,18,0)
 
"^DD",9002313.77,9002313.77,1.01,23,19,0)
DDED = Delete in edit 
"^DD",9002313.77,9002313.77,1.01,23,20,0)
 
"^DD",9002313.77,9002313.77,1.01,23,21,0)
DE   = Delete 
"^DD",9002313.77,9002313.77,1.01,23,22,0)
 
"^DD",9002313.77,9002313.77,1.01,23,23,0)
ED   = Edit 
"^DD",9002313.77,9002313.77,1.01,23,24,0)
 
"^DD",9002313.77,9002313.77,1.01,23,25,0)
ERES = Resubmit from ECME user screen 
"^DD",9002313.77,9002313.77,1.01,23,26,0)
 
"^DD",9002313.77,9002313.77,1.01,23,27,0)
EREV = Reversal from ECME user screen 
"^DD",9002313.77,9002313.77,1.01,23,28,0)
 
"^DD",9002313.77,9002313.77,1.01,23,29,0)
HLD  = Put prescription on Hold 
"^DD",9002313.77,9002313.77,1.01,23,30,0)
 
"^DD",9002313.77,9002313.77,1.01,23,31,0)
OF   = Original Fill 
"^DD",9002313.77,9002313.77,1.01,23,32,0)
 
"^DD",9002313.77,9002313.77,1.01,23,33,0)
PC   = Pull CMOPs 
"^DD",9002313.77,9002313.77,1.01,23,34,0)
 
"^DD",9002313.77,9002313.77,1.01,23,35,0)
PE   = Pull early from suspense 
"^DD",9002313.77,9002313.77,1.01,23,36,0)
 
"^DD",9002313.77,9002313.77,1.01,23,37,0)
PL   = Pull local from suspense 
"^DD",9002313.77,9002313.77,1.01,23,38,0)
 
"^DD",9002313.77,9002313.77,1.01,23,39,0)
PP   = PP from Patient Prescription Processing option 
"^DD",9002313.77,9002313.77,1.01,23,40,0)
 
"^DD",9002313.77,9002313.77,1.01,23,41,0)
RF   = Refill 
"^DD",9002313.77,9002313.77,1.01,23,42,0)
 
"^DD",9002313.77,9002313.77,1.01,23,43,0)
RL   = Release Rx NDC check - Rebill if billed NDC doesn't match release 
"^DD",9002313.77,9002313.77,1.01,23,44,0)
NDC 
"^DD",9002313.77,9002313.77,1.01,23,45,0)
 
"^DD",9002313.77,9002313.77,1.01,23,46,0)
RN   = Renew 
"^DD",9002313.77,9002313.77,1.01,23,47,0)
 
"^DD",9002313.77,9002313.77,1.01,23,48,0)
RRL  = Original claim rejected, submit another claim, no reversal 
"^DD",9002313.77,9002313.77,1.01,23,49,0)
 
"^DD",9002313.77,9002313.77,1.01,23,50,0)
RS   = Return-to-Stock 
"^DD",9002313.77,9002313.77,1.01,"DT")
3071016
"^DD",9002313.77,9002313.77,1.04,0)
TRANSACTION TYPE^S^C:CLAIM;U:UNCLAIM;^1;4^Q
"^DD",9002313.77,9002313.77,1.04,3)
Enter 'C' for payment request (claim),'U' for reversal (unclaim) 
"^DD",9002313.77,9002313.77,1.04,21,0)
^.001^3^3^3071017^^
"^DD",9002313.77,9002313.77,1.04,21,1,0)
Type of transaction
"^DD",9002313.77,9002313.77,1.04,21,2,0)
CLAIM - to submit a claim to the payer
"^DD",9002313.77,9002313.77,1.04,21,3,0)
UNCLAIM - to submit a reversal for the previously paid claim
"^DD",9002313.77,9002313.77,1.04,"DT")
3080619
"^DD",9002313.77,9002313.77,1.05,0)
BILLING DETERMINATION^S^0:NOT BILLABLE;1:BILLABLE;^1;5^Q
"^DD",9002313.77,9002313.77,1.05,3)
Is this claim billable?
"^DD",9002313.77,9002313.77,1.05,21,0)
^^1^1^3080623^^
"^DD",9002313.77,9002313.77,1.05,21,1,0)
Billing determination result
"^DD",9002313.77,9002313.77,1.05,"DT")
3080623
"^DD",9002313.77,9002313.77,1.06,0)
ELIGIBILITY^S^V:VETERAN;T:TRICARE;C:CHAMPVA;^1;6^Q
"^DD",9002313.77,9002313.77,1.06,3)
Enter eligibility of the claim.
"^DD",9002313.77,9002313.77,1.06,21,0)
^^1^1^3080619^
"^DD",9002313.77,9002313.77,1.06,21,1,0)
The insurance eligibility type of the claim.
"^DD",9002313.77,9002313.77,1.06,"DT")
3080624
"^DD",9002313.77,9002313.77,1.07,0)
CLAIM STATUS^F^^1;7^K:$L(X)>99!($L(X)<1) X
"^DD",9002313.77,9002313.77,1.07,3)
Type a Number between 0 and 99, 0 Decimal Digits
"^DD",9002313.77,9002313.77,1.07,21,0)
^^3^3^3080619^
"^DD",9002313.77,9002313.77,1.07,21,1,0)
The status of the transaction as a percentage of completion.  The text 
"^DD",9002313.77,9002313.77,1.07,21,2,0)
value can be obtained by running $$STATI^BPSOSU(<Status Number>).
"^DD",9002313.77,9002313.77,1.07,21,3,0)
Note that 99 indicates complete.
"^DD",9002313.77,9002313.77,1.07,"DT")
3080619
"^DD",9002313.77,9002313.77,2.01,0)
DATE OF SERVICE^D^^2;1^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.77,9002313.77,2.01,3)
Enter date of service
"^DD",9002313.77,9002313.77,2.01,21,0)
^^3^3^3080619^^
"^DD",9002313.77,9002313.77,2.01,21,1,0)
The Release date is used if the RX/Refill was released.  If not then the
"^DD",9002313.77,9002313.77,2.01,21,2,0)
Fill Date is used unless it is in the future.  If the Fill Date is a
"^DD",9002313.77,9002313.77,2.01,21,3,0)
future date then today is used.
"^DD",9002313.77,9002313.77,2.01,"DT")
3080619
"^DD",9002313.77,9002313.77,2.02,0)
REVERSAL REASON^F^^2;2^K:$L(X)>60!($L(X)<1) X
"^DD",9002313.77,9002313.77,2.02,3)
Answer must be 1-60 characters in length.
"^DD",9002313.77,9002313.77,2.02,21,0)
^^2^2^3080619^
"^DD",9002313.77,9002313.77,2.02,21,1,0)
Reversal Reason as a free text. Examples: ECME RESUBMIT, RX EDITED, RX 
"^DD",9002313.77,9002313.77,2.02,21,2,0)
DISCONTINUED
"^DD",9002313.77,9002313.77,2.02,"DT")
3080619
"^DD",9002313.77,9002313.77,2.03,0)
DURREC^F^^2;3^K:$L(X)>80!($L(X)<1) X
"^DD",9002313.77,9002313.77,2.03,3)
Answer must be 1-80 characters in length
"^DD",9002313.77,9002313.77,2.03,21,0)
^^2^2^3080619^
"^DD",9002313.77,9002313.77,2.03,21,1,0)
Drug Utilization Review (DUR) information passed by Outpatient Pharmacy to
"^DD",9002313.77,9002313.77,2.03,21,2,0)
ECME.
"^DD",9002313.77,9002313.77,2.03,"DT")
3080619
"^DD",9002313.77,9002313.77,2.04,0)
OVERRIDE CODE^P9002313.511'^BPS(9002313.511,^2;4^Q
"^DD",9002313.77,9002313.77,2.04,3)
Select a record of the BPS NCPDP OVERRIDE file
"^DD",9002313.77,9002313.77,2.04,21,0)
^^3^3^3080624^
"^DD",9002313.77,9002313.77,2.04,21,1,0)
This is used to store overrides entered by the user via the Resubmit with 
"^DD",9002313.77,9002313.77,2.04,21,2,0)
Edits (RED) option in the ECME User Screen to change certain data 
"^DD",9002313.77,9002313.77,2.04,21,3,0)
elements sent to the payer during resubmission of the claim.
"^DD",9002313.77,9002313.77,2.04,"DT")
3080624
"^DD",9002313.77,9002313.77,2.05,0)
CLARIFICATION CODE^P9002313.25'^BPS(9002313.25,^2;5^Q
"^DD",9002313.77,9002313.77,2.05,3)
Select the Submission Clarification Code
"^DD",9002313.77,9002313.77,2.05,21,0)
^^9^9^3080624^
"^DD",9002313.77,9002313.77,2.05,21,1,0)
Clarification Code is entered by the pharmacist and passed by Outpatient 
"^DD",9002313.77,9002313.77,2.05,21,2,0)
Pharmacy to ECME to put into the claim to support/justify the claim 
"^DD",9002313.77,9002313.77,2.05,21,3,0)
request when the payer rejects it. Valid clarification codes are selected 
"^DD",9002313.77,9002313.77,2.05,21,4,0)
from BPS NCPDP CLARIFICATION CODES file (#9002313.25).  These codes 
"^DD",9002313.77,9002313.77,2.05,21,5,0)
justify an earlier fill date to the payer.  For example if a patient 
"^DD",9002313.77,9002313.77,2.05,21,6,0)
needed an early refill due to being on vacation when the prescription 
"^DD",9002313.77,9002313.77,2.05,21,7,0)
would normally be filled, a VACATION SUPPLY clarification code can be 
"^DD",9002313.77,9002313.77,2.05,21,8,0)
used as justification to the payer for filling the prescription thereby 
"^DD",9002313.77,9002313.77,2.05,21,9,0)
mitigating any claims rejections.
"^DD",9002313.77,9002313.77,2.05,"DT")
3080624
"^DD",9002313.77,9002313.77,2.06,0)
BILL NDC^F^^2;6^K:$L(X)>11!($L(X)<5) X
"^DD",9002313.77,9002313.77,2.06,3)
Answer must be 5-11 characters in length.
"^DD",9002313.77,9002313.77,2.06,21,0)
^^2^2^3080624^
"^DD",9002313.77,9002313.77,2.06,21,1,0)
Valid NDC# used in the prescription/refill and which is passed to ECME to
"^DD",9002313.77,9002313.77,2.06,21,2,0)
be used for billing.
"^DD",9002313.77,9002313.77,2.06,"DT")
3080624
"^DD",9002313.77,9002313.77,2.07,0)
PRE AUTH TYPE CODE^F^^2;7^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.77,9002313.77,2.07,3)
Answer must be 1-2 characters in length.
"^DD",9002313.77,9002313.77,2.07,21,0)
^^2^2^3080227^
"^DD",9002313.77,9002313.77,2.07,21,1,0)
PRIOR AUTHORIZATION TYPE CODE - the first piece of the BPSAUTH parameter
"^DD",9002313.77,9002313.77,2.07,21,2,0)
passed to ECME engine.
"^DD",9002313.77,9002313.77,2.07,"DT")
3080227
"^DD",9002313.77,9002313.77,2.08,0)
PRE AUTH NUM SUB^F^^2;8^K:$L(X)>11!($L(X)<1) X
"^DD",9002313.77,9002313.77,2.08,3)
Answer must be 1-11 characters in length.
"^DD",9002313.77,9002313.77,2.08,21,0)
^^2^2^3080227^
"^DD",9002313.77,9002313.77,2.08,21,1,0)
PRIOR AUTHORIZATION NUM SUB - the second piece of the BPSAUTH parameter
"^DD",9002313.77,9002313.77,2.08,21,2,0)
passed to ECME engine.
"^DD",9002313.77,9002313.77,2.08,"DT")
3080227
"^DD",9002313.77,9002313.77,2.09,0)
SC AND EI OVERRIDE FLAG^S^0:NO;1:YES;^2;9^Q
"^DD",9002313.77,9002313.77,2.09,3)
Enter "Yes" if SC/EI answers should be overridden, "No" if not.
"^DD",9002313.77,9002313.77,2.09,21,0)
^^6^6^3081128^
"^DD",9002313.77,9002313.77,2.09,21,1,0)
Service Connected and Environmental Indicators override flag.
"^DD",9002313.77,9002313.77,2.09,21,2,0)
0 - the system should use the existing answers to SC and EI questions, if 
"^DD",9002313.77,9002313.77,2.09,21,3,0)
there is no answer then SC/EI determination needed and the RX/refill 
"^DD",9002313.77,9002313.77,2.09,21,4,0)
cannot be billed.                                     
"^DD",9002313.77,9002313.77,2.09,21,5,0)
1 - the user chose to override all SC and EI related answers with "NO", 
"^DD",9002313.77,9002313.77,2.09,21,6,0)
which means the RX/refill should be billed.
"^DD",9002313.77,9002313.77,2.09,"DT")
3081128
"^DD",9002313.77,9002313.77,3,0)
DUR^9002313.771A^^3;0
"^DD",9002313.77,9002313.77,3,21,0)
^^1^1^3071016^
"^DD",9002313.77,9002313.77,3,21,1,0)
DUR multiple
"^DD",9002313.77,9002313.77,4.01,0)
QUANTITY^NJ10,3^^4;1^K:+X'=X!(X>999999)!(X<-1)!(X?.E1"."4.N) X
"^DD",9002313.77,9002313.77,4.01,3)
Type a number between -1 and 999999, 3 Decimal Digits
"^DD",9002313.77,9002313.77,4.01,21,0)
^^4^4^3080620^
"^DD",9002313.77,9002313.77,4.01,21,1,0)
NCPDP quantity (Billing Quantity) - the amount of medication that was
"^DD",9002313.77,9002313.77,4.01,21,2,0)
dispensed (stored in PRESCRIPTION file (#52)) multiplied by the
"^DD",9002313.77,9002313.77,4.01,21,3,0)
NCPDP QUANTITY MULTIPLIER (stored in DRUG file (#50)).
"^DD",9002313.77,9002313.77,4.01,21,4,0)
The negative  value -1 indicates an invalid drug.
"^DD",9002313.77,9002313.77,4.01,"DT")
3080620
"^DD",9002313.77,9002313.77,4.02,0)
UNIT PRICE^NJ14,6^^4;2^K:+X'=X!(X>9999999)!(X<0)!(X?.E1"."7N.N) X
"^DD",9002313.77,9002313.77,4.02,3)
Type a Number between 0 and 9999999, 6 Decimal Digits
"^DD",9002313.77,9002313.77,4.02,21,0)
^^1^1^3071022^
"^DD",9002313.77,9002313.77,4.02,21,1,0)
Price per unit of prescription.
"^DD",9002313.77,9002313.77,4.02,"DT")
3071022
"^DD",9002313.77,9002313.77,4.03,0)
NDC^F^^4;3^K:$L(X)>11!($L(X)<5) X
"^DD",9002313.77,9002313.77,4.03,3)
Answer must be 5-11 characters in length.
"^DD",9002313.77,9002313.77,4.03,21,0)
^^1^1^3071022^
"^DD",9002313.77,9002313.77,4.03,21,1,0)
The NDC number of the drug involved in this transaction.
"^DD",9002313.77,9002313.77,4.03,"DT")
3071022
"^DD",9002313.77,9002313.77,4.04,0)
REFILL^NJ2,0^^4;4^K:+X'=X!(X>99)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.77,9002313.77,4.04,3)
Type a Number between 0 and 99, 0 Decimal Digits
"^DD",9002313.77,9002313.77,4.04,21,0)
^.001^1^1^3071022^^
"^DD",9002313.77,9002313.77,4.04,21,1,0)
Refill number. 0-original
"^DD",9002313.77,9002313.77,4.04,"DT")
3071022
"^DD",9002313.77,9002313.77,4.05,0)
CERTIFY MODE^S^0:OFF;1:ON;^4;5^Q
"^DD",9002313.77,9002313.77,4.05,3)
Enter null or 0 for certify mode off. Enter 1 for certify mode on.
"^DD",9002313.77,9002313.77,4.05,21,0)
^^2^2^3080620^
"^DD",9002313.77,9002313.77,4.05,21,1,0)
Certify mode is used for certifying software when required by switches and
"^DD",9002313.77,9002313.77,4.05,21,2,0)
claims end processors.
"^DD",9002313.77,9002313.77,4.05,"DT")
3080620
"^DD",9002313.77,9002313.77,4.06,0)
CERTIFICATION IEN^P9002313.31'^BPS(9002313.31,^4;6^Q
"^DD",9002313.77,9002313.77,4.06,3)
Select the certification record
"^DD",9002313.77,9002313.77,4.06,21,0)
^^2^2^3071022^
"^DD",9002313.77,9002313.77,4.06,21,1,0)
This field is used during certification testing, and points to the entry 
"^DD",9002313.77,9002313.77,4.06,21,2,0)
to use to pull certification data.
"^DD",9002313.77,9002313.77,4.06,"DT")
3080620
"^DD",9002313.77,9002313.77,4.07,0)
UNIT OF MEASURE^F^^4;7^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.77,9002313.77,4.07,3)
Answer must be 1-2 characters in length.
"^DD",9002313.77,9002313.77,4.07,21,0)
^^2^2^3071022^
"^DD",9002313.77,9002313.77,4.07,21,1,0)
Enter the Unit of Measure for the drug.  This is usually GR (grams), ML
"^DD",9002313.77,9002313.77,4.07,21,2,0)
(milliliters), or EA (Each).
"^DD",9002313.77,9002313.77,4.07,"DT")
3071022
"^DD",9002313.77,9002313.77,5,0)
INSURER DATA^9002313.772SA^^5;0
"^DD",9002313.77,9002313.77,5,21,0)
^^3^3^3080620^
"^DD",9002313.77,9002313.77,5,21,1,0)
Contains set of IB determination data for all billable payers - primary, 
"^DD",9002313.77,9002313.77,5,21,2,0)
secondary and tertiary. Should contain at least one entry - usually for 
"^DD",9002313.77,9002313.77,5,21,3,0)
the primary payer.
"^DD",9002313.77,9002313.77,5,"DT")
3071126
"^DD",9002313.77,9002313.77,6.01,0)
REQUEST DATE AND TIME^D^^6;1^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.77,9002313.77,6.01,3)
Enter date/time
"^DD",9002313.77,9002313.77,6.01,21,0)
^^1^1^3080620^
"^DD",9002313.77,9002313.77,6.01,21,1,0)
The Date and Time when the request record was created.
"^DD",9002313.77,9002313.77,6.01,"DT")
3080620
"^DD",9002313.77,9002313.77,6.02,0)
USER WHO MADE THE REQUEST^P200'^VA(200,^6;2^Q
"^DD",9002313.77,9002313.77,6.02,3)
Enter the user who made the request
"^DD",9002313.77,9002313.77,6.02,21,0)
^^1^1^3080102^
"^DD",9002313.77,9002313.77,6.02,21,1,0)
The user who created the request
"^DD",9002313.77,9002313.77,6.02,"DT")
3080620
"^DD",9002313.77,9002313.77,6.03,0)
ACTIVATED DATE TIME^D^^6;3^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.77,9002313.77,6.03,3)
Enter the date and time when the request was activated
"^DD",9002313.77,9002313.77,6.03,21,0)
^^1^1^3080620^
"^DD",9002313.77,9002313.77,6.03,21,1,0)
The date and time when the request was activated
"^DD",9002313.77,9002313.77,6.03,"DT")
3080620
"^DD",9002313.77,9002313.77,6.04,0)
USER WHO ACTIVATED REQUEST^P200'^VA(200,^6;4^Q
"^DD",9002313.77,9002313.77,6.04,3)
Enter the user who activated the request
"^DD",9002313.77,9002313.77,6.04,21,0)
^^1^1^3080620^^
"^DD",9002313.77,9002313.77,6.04,21,1,0)
The user who activated the request.
"^DD",9002313.77,9002313.77,6.04,"DT")
3080620
"^DD",9002313.77,9002313.77,6.05,0)
DATE AND TIME UPDATED^D^^6;5^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.77,9002313.77,6.05,1,0)
^.1
"^DD",9002313.77,9002313.77,6.05,1,1,0)
9002313.77^E
"^DD",9002313.77,9002313.77,6.05,1,1,1)
S ^BPS(9002313.77,"E",$E(X,1,30),DA)=""
"^DD",9002313.77,9002313.77,6.05,1,1,2)
K ^BPS(9002313.77,"E",$E(X,1,30),DA)
"^DD",9002313.77,9002313.77,6.05,1,1,"%D",0)
^^2^2^3080507^
"^DD",9002313.77,9002313.77,6.05,1,1,"%D",1,0)
The cross-reference to get the select records by the date/time the record
"^DD",9002313.77,9002313.77,6.05,1,1,"%D",2,0)
was updated
"^DD",9002313.77,9002313.77,6.05,1,1,"DT")
3080507
"^DD",9002313.77,9002313.77,6.05,3)
Enter the date and time when the request was updated
"^DD",9002313.77,9002313.77,6.05,21,0)
^^1^1^3080620^^^
"^DD",9002313.77,9002313.77,6.05,21,1,0)
The date and time when the request was updated.
"^DD",9002313.77,9002313.77,6.05,"DT")
3080620
"^DD",9002313.77,9002313.77,6.06,0)
USER WHO UPDATED THE REQUEST^P200'^VA(200,^6;6^Q
"^DD",9002313.77,9002313.77,6.06,3)
Enter the user who updated the request
"^DD",9002313.77,9002313.77,6.06,21,0)
^^1^1^3080620^^
"^DD",9002313.77,9002313.77,6.06,21,1,0)
The user who updated the request.
"^DD",9002313.77,9002313.77,6.06,"DT")
3080620
"^DD",9002313.77,9002313.77,7.01,0)
CLOSE AFT REV^S^0:NO;1:YES;^7;1^Q
"^DD",9002313.77,9002313.77,7.01,3)
Should the claim be closed after accepted reversal?
"^DD",9002313.77,9002313.77,7.01,21,0)
^^4^4^3080624^
"^DD",9002313.77,9002313.77,7.01,21,1,0)
This field indicates whether the claim should be closed after successful 
"^DD",9002313.77,9002313.77,7.01,21,2,0)
reversal. The ECME engine checks this field when it receives a response 
"^DD",9002313.77,9002313.77,7.01,21,3,0)
from the payer. If the field is set to YES and the reversal was accepted 
"^DD",9002313.77,9002313.77,7.01,21,4,0)
by the payer then the claim will be closed automatically.
"^DD",9002313.77,9002313.77,7.01,"DT")
3080624
"^DD",9002313.77,9002313.77,7.02,0)
CLOSE AFT REV REASON^P356.8'^IBE(356.8,^7;2^Q
"^DD",9002313.77,9002313.77,7.02,3)
Select NON-BILLABLE reason for the claim
"^DD",9002313.77,9002313.77,7.02,21,0)
^^2^2^3080620^
"^DD",9002313.77,9002313.77,7.02,21,1,0)
The NON-BILLABLE REASON selected by the user to be used in IB CLAIM
"^DD",9002313.77,9002313.77,7.02,21,2,0)
TRACKING system.
"^DD",9002313.77,9002313.77,7.02,"DT")
3080620
"^DD",9002313.77,9002313.77,7.03,0)
CLOSE AFT REV COMMENT^F^^7;3^K:$L(X)>40!($L(X)<1) X
"^DD",9002313.77,9002313.77,7.03,3)
Answer must be 1-40 characters in length.
"^DD",9002313.77,9002313.77,7.03,21,0)
^^1^1^3080529^
"^DD",9002313.77,9002313.77,7.03,21,1,0)
Comment for CLOSE action
"^DD",9002313.77,9002313.77,7.03,"DT")
3080530
"^DD",9002313.77,9002313.771,0)
DUR SUB-FIELD^^.03^3
"^DD",9002313.77,9002313.771,0,"DT")
3071016
"^DD",9002313.77,9002313.771,0,"IX","B",9002313.771,.01)

"^DD",9002313.77,9002313.771,0,"NM","DUR")

"^DD",9002313.77,9002313.771,0,"UP")
9002313.77
"^DD",9002313.77,9002313.771,.01,0)
DUR REASON CODE^F^^0;1^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.77,9002313.771,.01,1,0)
^.1
"^DD",9002313.77,9002313.771,.01,1,1,0)
9002313.771^B
"^DD",9002313.77,9002313.771,.01,1,1,1)
S ^BPS(9002313.77,DA(1),3,"B",$E(X,1,30),DA)=""
"^DD",9002313.77,9002313.771,.01,1,1,2)
K ^BPS(9002313.77,DA(1),3,"B",$E(X,1,30),DA)
"^DD",9002313.77,9002313.771,.01,3)
Enter the DUR Reason for the Service Code for the claim
"^DD",9002313.77,9002313.771,.01,21,0)
^^1^1^3080619^
"^DD",9002313.77,9002313.771,.01,21,1,0)
Drug Utilization Review (DUR) Reason for the Service Code for the claim.
"^DD",9002313.77,9002313.771,.01,"DT")
3080619
"^DD",9002313.77,9002313.771,.02,0)
DUR PROFESSIONAL SERVICE CODE^F^^0;2^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.77,9002313.771,.02,3)
Enter the DUR Professional Service Code for the claim
"^DD",9002313.77,9002313.771,.02,21,0)
^^1^1^3080619^^^
"^DD",9002313.77,9002313.771,.02,21,1,0)
Drug Utilization Review (DUR) Professional Service Code for the claim.
"^DD",9002313.77,9002313.771,.02,"DT")
3080619
"^DD",9002313.77,9002313.771,.03,0)
DUR RESULT OF SERVICE CODE^F^^0;3^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.77,9002313.771,.03,3)
Enter the DUR Result of Service Code for the claim
"^DD",9002313.77,9002313.771,.03,21,0)
^^1^1^3080619^^
"^DD",9002313.77,9002313.771,.03,21,1,0)
Drug Utilization Review (DUR) Result of Service Code for the claim.
"^DD",9002313.77,9002313.771,.03,"DT")
3080619
"^DD",9002313.77,9002313.772,0)
INSURER DATA SUB-FIELD^^.03^3
"^DD",9002313.77,9002313.772,0,"DT")
3071127
"^DD",9002313.77,9002313.772,0,"IX","B",9002313.772,.01)

"^DD",9002313.77,9002313.772,0,"IX","C",9002313.772,.02)

"^DD",9002313.77,9002313.772,0,"NM","INSURER DATA")

"^DD",9002313.77,9002313.772,0,"UP")
9002313.77
"^DD",9002313.77,9002313.772,.01,0)
COB INDICATOR^S^1:PRIMARY;2:SECONDARY;3:TERTIARY;^0;1^Q
"^DD",9002313.77,9002313.772,.01,1,0)
^.1
"^DD",9002313.77,9002313.772,.01,1,1,0)
9002313.772^B
"^DD",9002313.77,9002313.772,.01,1,1,1)
S ^BPS(9002313.77,DA(1),5,"B",$E(X,1,30),DA)=""
"^DD",9002313.77,9002313.772,.01,1,1,2)
K ^BPS(9002313.77,DA(1),5,"B",$E(X,1,30),DA)
"^DD",9002313.77,9002313.772,.01,3)
Is the payer a primary, secondary or tertiary insurer?
"^DD",9002313.77,9002313.772,.01,21,0)
^^1^1^3080624^^
"^DD",9002313.77,9002313.772,.01,21,1,0)
Coordination Of Benefits (COB) indicator for the payer.
"^DD",9002313.77,9002313.772,.01,"DT")
3080624
"^DD",9002313.77,9002313.772,.02,0)
USED FOR THE REQUEST^S^0:NO;1:YES;^0;2^Q
"^DD",9002313.77,9002313.772,.02,1,0)
^.1
"^DD",9002313.77,9002313.772,.02,1,1,0)
9002313.772^C
"^DD",9002313.77,9002313.772,.02,1,1,1)
S ^BPS(9002313.77,DA(1),5,"C",$E(X,1,30),DA)=""
"^DD",9002313.77,9002313.772,.02,1,1,2)
K ^BPS(9002313.77,DA(1),5,"C",$E(X,1,30),DA)
"^DD",9002313.77,9002313.772,.02,1,1,"%D",0)
^^1^1^3071121^
"^DD",9002313.77,9002313.772,.02,1,1,"%D",1,0)
To find an active COB indicator.
"^DD",9002313.77,9002313.772,.02,1,1,"DT")
3071121
"^DD",9002313.77,9002313.772,.02,3)
Should this payer be used for billing in this request?
"^DD",9002313.77,9002313.772,.02,21,0)
^^4^4^3080624^^
"^DD",9002313.77,9002313.772,.02,21,1,0)
The INSURER DATA multiple can store up to three entries with details for 
"^DD",9002313.77,9002313.772,.02,21,2,0)
primary, secondary and tertiary insurers. This field marks the active
"^DD",9002313.77,9002313.772,.02,21,3,0)
payer entry, which points to the payer data to be used to process this
"^DD",9002313.77,9002313.772,.02,21,4,0)
request.
"^DD",9002313.77,9002313.772,.02,"DT")
3080624
"^DD",9002313.77,9002313.772,.03,0)
INSURER DATA^P9002313.78'^BPS(9002313.78,^0;3^Q
"^DD",9002313.77,9002313.772,.03,3)
Select insurer for the request
"^DD",9002313.77,9002313.772,.03,21,0)
^^1^1^3080620^
"^DD",9002313.77,9002313.772,.03,21,1,0)
Contains IB determination data for the payer (insurer).
"^DD",9002313.77,9002313.772,.03,"DT")
3080620
"^DD",9002313.78,9002313.78,0)
FIELD^^5.02^33
"^DD",9002313.78,9002313.78,0,"DDA")
N
"^DD",9002313.78,9002313.78,0,"DT")
3090116
"^DD",9002313.78,9002313.78,0,"IX","B",9002313.78,.01)

"^DD",9002313.78,9002313.78,0,"NM","BPS INSURER DATA")

"^DD",9002313.78,9002313.78,0,"PT",9002313.772,.03)

"^DD",9002313.78,9002313.78,0,"VRPK")
BPS
"^DD",9002313.78,9002313.78,.01,0)
TRANSACTION ID^RNJ14,5^^0;1^K:+X'=X!(X>99999999)!(X<1)!(X?.E1"."6.N) X
"^DD",9002313.78,9002313.78,.01,.1)

"^DD",9002313.78,9002313.78,.01,1,0)
^.1
"^DD",9002313.78,9002313.78,.01,1,1,0)
9002313.78^B
"^DD",9002313.78,9002313.78,.01,1,1,1)
S ^BPS(9002313.78,"B",$E(X,1,30),DA)=""
"^DD",9002313.78,9002313.78,.01,1,1,2)
K ^BPS(9002313.78,"B",$E(X,1,30),DA)
"^DD",9002313.78,9002313.78,.01,3)
Type a number between 1 and 99999999, 5 Decimal Digits
"^DD",9002313.78,9002313.78,.01,21,0)
^^7^7^3080103^
"^DD",9002313.78,9002313.78,.01,21,1,0)
This is a numeric identifier that follows the same format as IEN of the
"^DD",9002313.78,9002313.78,.01,21,2,0)
BPS TRANSACTION file and contains: RX ien+refill number+COB indicator.
"^DD",9002313.78,9002313.78,.01,21,3,0)
When the BPS INSURER DATA record is created the BPS TRANSACTION record 
"^DD",9002313.78,9002313.78,.01,21,4,0)
doesn't exist yet - that is why we cannot use a pointer to BPS 
"^DD",9002313.78,9002313.78,.01,21,5,0)
TRANSACTION as a data type.
"^DD",9002313.78,9002313.78,.01,21,6,0)
When the new record for BPS TRANSACTION will be created the ien for 
"^DD",9002313.78,9002313.78,.01,21,7,0)
it will be taken from this field.
"^DD",9002313.78,9002313.78,.01,"DT")
3080103
"^DD",9002313.78,9002313.78,.02,0)
PAYER SHEET^P9002313.92'^BPSF(9002313.92,^0;2^Q
"^DD",9002313.78,9002313.78,.02,3)
Answer with a payer sheet to be used for this claim.
"^DD",9002313.78,9002313.78,.02,21,0)
^^1^1^3080701^
"^DD",9002313.78,9002313.78,.02,21,1,0)
The payer sheet to be used to send claims to the Insurer.
"^DD",9002313.78,9002313.78,.02,"DT")
3080701
"^DD",9002313.78,9002313.78,.03,0)
B2 PAYER SHEET^P9002313.92'^BPSF(9002313.92,^0;3^Q
"^DD",9002313.78,9002313.78,.03,3)
Select a payer sheet to be used for reversals.
"^DD",9002313.78,9002313.78,.03,21,0)
^^1^1^3080701^
"^DD",9002313.78,9002313.78,.03,21,1,0)
The Reversal payer sheet to be used to send reversals to the Insurer.
"^DD",9002313.78,9002313.78,.03,"DT")
3080701
"^DD",9002313.78,9002313.78,.04,0)
B3 REBILL PAYER SHEET^P9002313.92'^BPSF(9002313.92,^0;4^Q
"^DD",9002313.78,9002313.78,.04,3)
Select a payer sheet to be used for rebills.
"^DD",9002313.78,9002313.78,.04,21,0)
^^1^1^3080701^
"^DD",9002313.78,9002313.78,.04,21,1,0)
The Rebill Payer sheet to be used to send rebill claims to the Insurer.
"^DD",9002313.78,9002313.78,.04,"DT")
3080701
"^DD",9002313.78,9002313.78,.05,0)
CERTIFY MODE^S^0:CERTIFY MODE OFF;1:CERTFIY MODE ON;^0;5^Q
"^DD",9002313.78,9002313.78,.05,3)
Switch on/off the certify mode
"^DD",9002313.78,9002313.78,.05,21,0)
^^2^2^3080701^
"^DD",9002313.78,9002313.78,.05,21,1,0)
Certify mode is used for certifying software when required by switches and
"^DD",9002313.78,9002313.78,.05,21,2,0)
claims end processors.
"^DD",9002313.78,9002313.78,.05,"DT")
3080701
"^DD",9002313.78,9002313.78,.06,0)
CERTIFICATION^P9002313.31'^BPS(9002313.31,^0;6^Q
"^DD",9002313.78,9002313.78,.06,3)
Enter the Certification record
"^DD",9002313.78,9002313.78,.06,21,0)
^^2^2^3080619^
"^DD",9002313.78,9002313.78,.06,21,1,0)
This field is used during certification testing, and points to the entry 
"^DD",9002313.78,9002313.78,.06,21,2,0)
to use to pull certification data.
"^DD",9002313.78,9002313.78,.06,"DT")
3080619
"^DD",9002313.78,9002313.78,.07,0)
INSURANCE NAME^F^^0;7^K:$L(X)>40!($L(X)<1) X
"^DD",9002313.78,9002313.78,.07,3)
Enter the name of the insurance company. Answer must be 1-40 characters.
"^DD",9002313.78,9002313.78,.07,21,0)
^^2^2^3080701^^
"^DD",9002313.78,9002313.78,.07,21,1,0)
This is the free text name of the Insurance Company as determined by 
"^DD",9002313.78,9002313.78,.07,21,2,0)
Integrated Billing insurance files.
"^DD",9002313.78,9002313.78,.07,"DT")
3080701
"^DD",9002313.78,9002313.78,.08,0)
PLAN ID^P355.3'^IBA(355.3,^0;8^Q
"^DD",9002313.78,9002313.78,.08,3)
Enter the Group Insurance Plan
"^DD",9002313.78,9002313.78,.08,21,0)
^^1^1^3080701^
"^DD",9002313.78,9002313.78,.08,21,1,0)
Group Insurance Plan used for the claim
"^DD",9002313.78,9002313.78,.08,"DT")
3080701
"^DD",9002313.78,9002313.78,.09,0)
COB INDICATOR^S^1:PRIMARY;2:SECONDARY;3:TERTIARY;^0;9^Q
"^DD",9002313.78,9002313.78,.09,3)
Is the payer a primary, secondary or tertiary insurer?
"^DD",9002313.78,9002313.78,.09,21,0)
^^1^1^3080701^
"^DD",9002313.78,9002313.78,.09,21,1,0)
Coordination Of Benefits (COB) indicator for the payer.
"^DD",9002313.78,9002313.78,.09,"DT")
3080701
"^DD",9002313.78,9002313.78,1.01,0)
BIN^F^^1;1^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.78,9002313.78,1.01,3)
Answer must be 1-10 characters in length.
"^DD",9002313.78,9002313.78,1.01,21,0)
^^1^1^3080619^
"^DD",9002313.78,9002313.78,1.01,21,1,0)
Card Issuer ID or Bank ID Number used for network routing.
"^DD",9002313.78,9002313.78,1.01,"DT")
3080619
"^DD",9002313.78,9002313.78,1.02,0)
PCN^F^^1;2^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.78,9002313.78,1.02,3)
Answer must be 1-10 characters in length.
"^DD",9002313.78,9002313.78,1.02,21,0)
^^1^1^3080619^
"^DD",9002313.78,9002313.78,1.02,21,1,0)
The Processor Control Number for this claim.
"^DD",9002313.78,9002313.78,1.02,"DT")
3080619
"^DD",9002313.78,9002313.78,1.03,0)
GROUP ID^F^^1;3^K:$L(X)>17!($L(X)<1) X
"^DD",9002313.78,9002313.78,1.03,3)
Answer must be 1-17 characters in length.
"^DD",9002313.78,9002313.78,1.03,21,0)
^^1^1^3080619^
"^DD",9002313.78,9002313.78,1.03,21,1,0)
ID assigned to the cardholder group or employer group.
"^DD",9002313.78,9002313.78,1.03,"DT")
3080619
"^DD",9002313.78,9002313.78,1.04,0)
CARDHOLDER ID^F^^1;4^K:$L(X)>20!($L(X)<1) X
"^DD",9002313.78,9002313.78,1.04,3)
Answer must be 1-20 characters in length.
"^DD",9002313.78,9002313.78,1.04,21,0)
^^1^1^3080619^
"^DD",9002313.78,9002313.78,1.04,21,1,0)
ID number assigned to Cardholder/Subscriber.
"^DD",9002313.78,9002313.78,1.04,"DT")
3080619
"^DD",9002313.78,9002313.78,1.05,0)
PATIENT RELATIONSHIP CODE^S^1:SELF(PATIENT);2:SPOUSE;3:CHILD;4:OTHER;^1;5^Q
"^DD",9002313.78,9002313.78,1.05,3)
What is the relationship of the patient to the insured?
"^DD",9002313.78,9002313.78,1.05,21,0)
^^1^1^3080702^^
"^DD",9002313.78,9002313.78,1.05,21,1,0)
Patient relationship to insurance subscriber.
"^DD",9002313.78,9002313.78,1.05,"DT")
3080702
"^DD",9002313.78,9002313.78,1.06,0)
CARDHOLDER FIRST NAME^F^^1;6^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.78,9002313.78,1.06,3)
Answer must be 1-30 characters in length
"^DD",9002313.78,9002313.78,1.06,21,0)
^^1^1^3080619^
"^DD",9002313.78,9002313.78,1.06,21,1,0)
First name of the Cardholder/Subscriber.
"^DD",9002313.78,9002313.78,1.06,"DT")
3080619
"^DD",9002313.78,9002313.78,1.07,0)
CARDHOLDER LAST NAME^F^^1;7^K:$L(X)>15!($L(X)<1) X
"^DD",9002313.78,9002313.78,1.07,3)
Answer must be 1-15 characters in length
"^DD",9002313.78,9002313.78,1.07,21,0)
^^1^1^3080619^
"^DD",9002313.78,9002313.78,1.07,21,1,0)
Last name of the Cardholder/Subscriber.
"^DD",9002313.78,9002313.78,1.07,"DT")
3080619
"^DD",9002313.78,9002313.78,1.08,0)
HOME PLAN STATE^F^^1;8^K:$L(X)>2!($L(X)<1) X
"^DD",9002313.78,9002313.78,1.08,3)
Answer must be 1-2 characters in length
"^DD",9002313.78,9002313.78,1.08,21,0)
^^1^1^3080619^
"^DD",9002313.78,9002313.78,1.08,21,1,0)
Usually the state where the member lives or purchased their coverage.
"^DD",9002313.78,9002313.78,1.08,"DT")
3080619
"^DD",9002313.78,9002313.78,2.01,0)
DISPENSING FEE SUBMITTED^F^^2;1^K:$L(X)>8!($L(X)<1) X
"^DD",9002313.78,9002313.78,2.01,3)
Type a Dollar amount between 0 and 99999, 2 Decimal Digits
"^DD",9002313.78,9002313.78,2.01,21,0)
^^2^2^3080619^
"^DD",9002313.78,9002313.78,2.01,21,1,0)
Fee amount submitted for the cost associated with dispensing this 
"^DD",9002313.78,9002313.78,2.01,21,2,0)
prescription.
"^DD",9002313.78,9002313.78,2.01,"DT")
3080619
"^DD",9002313.78,9002313.78,2.02,0)
BASIS OF COST DETERMINATION^S^01:AWP;05:Cost Calculations;07:Usual & Customary;^2;2^Q
"^DD",9002313.78,9002313.78,2.02,3)
Answer with the basis code for which the cost was determined.
"^DD",9002313.78,9002313.78,2.02,21,0)
^^2^2^3080701^
"^DD",9002313.78,9002313.78,2.02,21,1,0)
Code indicating the method by which 'Ingredient Cost Submitted' was 
"^DD",9002313.78,9002313.78,2.02,21,2,0)
calculated.
"^DD",9002313.78,9002313.78,2.02,"DT")
3080701
"^DD",9002313.78,9002313.78,2.03,0)
USUAL & CUSTOMARY CHARGE^F^^2;3^K:$L(X)>8!($L(X)<1) X
"^DD",9002313.78,9002313.78,2.03,3)
Type a Dollar amount between 0 and 99999, 2 Decimal Digits
"^DD",9002313.78,9002313.78,2.03,21,0)
^^2^2^3080619^
"^DD",9002313.78,9002313.78,2.03,21,1,0)
Amount charged cash customers for the prescription exclusive of sales tax 
"^DD",9002313.78,9002313.78,2.03,21,2,0)
or other amounts claimed.
"^DD",9002313.78,9002313.78,2.03,"DT")
3080619
"^DD",9002313.78,9002313.78,2.04,0)
GROSS AMOUNT DUE^F^^2;4^K:$L(X)>8!($L(X)<1) X
"^DD",9002313.78,9002313.78,2.04,3)
Type a Dollar amount between 0 and 99999, 2 Decimal Digits
"^DD",9002313.78,9002313.78,2.04,21,0)
^^9^9^3080619^
"^DD",9002313.78,9002313.78,2.04,21,1,0)
Total price claimed from all sources.  For prescription claim request,
"^DD",9002313.78,9002313.78,2.04,21,2,0)
field represents a sum of 'Ingredient Cost Submitted' (49-D9),
"^DD",9002313.78,9002313.78,2.04,21,3,0)
'Dispensing Fee Submitted' (412-DC), 'Flat Sales Tax Amount
"^DD",9002313.78,9002313.78,2.04,21,4,0)
Submitted'(481-HA), 'Percentage Sales Tax Amount Submitted' (482-GE),
"^DD",9002313.78,9002313.78,2.04,21,5,0)
'Incentive Amount Submitted' (438-E3), 'Other Amount Claimed' (48-H9).
"^DD",9002313.78,9002313.78,2.04,21,6,0)
For service claim request, field represents a sum of 'Professional
"^DD",9002313.78,9002313.78,2.04,21,7,0)
Services Fee Submitted' (477-BE), 'Flat Sales Tax Amount
"^DD",9002313.78,9002313.78,2.04,21,8,0)
Submitted'(481-HA), 'Percentage Sales Tax Amount Submitted'(482-GE),
"^DD",9002313.78,9002313.78,2.04,21,9,0)
'Other Amount Claimed' (48-H9).
"^DD",9002313.78,9002313.78,2.04,"DT")
3080619
"^DD",9002313.78,9002313.78,2.05,0)
ADMINISTRATIVE FEE^F^^2;5^K:$L(X)>8!($L(X)<1) X
"^DD",9002313.78,9002313.78,2.05,3)
Type a Dollar amount between 0 and 99999, 2 Decimal Digits
"^DD",9002313.78,9002313.78,2.05,21,0)
^^1^1^3080619^
"^DD",9002313.78,9002313.78,2.05,21,1,0)
Fee charged for any costs related to preparing the prescription.
"^DD",9002313.78,9002313.78,2.05,"DT")
3080619
"^DD",9002313.78,9002313.78,2.06,0)
SOFTWARE VENDOR CERT ID^F^^2;6^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.78,9002313.78,2.06,3)
Answer must be 1-30 characters in length.
"^DD",9002313.78,9002313.78,2.06,21,0)
^^1^1^3080619^
"^DD",9002313.78,9002313.78,2.06,21,1,0)
Certification number assigned by the payer for submission of claims.
"^DD",9002313.78,9002313.78,2.06,"DT")
3080619
"^DD",9002313.78,9002313.78,3.01,0)
GROUP NAME^F^^3;1^K:$L(X)>20!($L(X)<2) X
"^DD",9002313.78,9002313.78,3.01,3)
Answer must be 2-20 characters in length.
"^DD",9002313.78,9002313.78,3.01,21,0)
^^1^1^3080619^
"^DD",9002313.78,9002313.78,3.01,21,1,0)
This is the group name from the Group Insurance File.
"^DD",9002313.78,9002313.78,3.01,"DT")
3080619
"^DD",9002313.78,9002313.78,3.02,0)
INSURANCE CO PHONE #^F^^3;2^K:$L(X)>20!($L(X)<7) X
"^DD",9002313.78,9002313.78,3.02,3)
Answer must be 7-20 characters in length.
"^DD",9002313.78,9002313.78,3.02,21,0)
^^1^1^3080619^
"^DD",9002313.78,9002313.78,3.02,21,1,0)
This is the Claim (RX) phone number from the Insurance Company file.
"^DD",9002313.78,9002313.78,3.02,"DT")
3080619
"^DD",9002313.78,9002313.78,3.03,0)
PHARMACY PLAN ID^F^^3;3^K:$L(X)>30!($L(X)<1) X
"^DD",9002313.78,9002313.78,3.03,3)
Answer must be 1-30 characters in length.
"^DD",9002313.78,9002313.78,3.03,21,0)
^^1^1^3080702^
"^DD",9002313.78,9002313.78,3.03,21,1,0)
This is the ID of the plan file.
"^DD",9002313.78,9002313.78,3.03,"DT")
3080702
"^DD",9002313.78,9002313.78,3.04,0)
ELIGIBILITY^S^V:Veteran;T:Tricare;C:ChampVA;^3;4^Q
"^DD",9002313.78,9002313.78,3.04,3)
Enter eligibility of the claim.
"^DD",9002313.78,9002313.78,3.04,21,0)
^^1^1^3090116^
"^DD",9002313.78,9002313.78,3.04,21,1,0)
The insurance eligibility type of the claim.
"^DD",9002313.78,9002313.78,3.04,"DT")
3090116
"^DD",9002313.78,9002313.78,3.05,0)
INSURANCE COMPANY^P36'^DIC(36,^3;5^Q
"^DD",9002313.78,9002313.78,3.05,3)
Select the insurance carrier for this claim.
"^DD",9002313.78,9002313.78,3.05,21,0)
^^1^1^3090116^
"^DD",9002313.78,9002313.78,3.05,21,1,0)
This is the INSURANCE COMPANY from file #36.
"^DD",9002313.78,9002313.78,3.05,"DT")
3090116
"^DD",9002313.78,9002313.78,4.01,0)
PAYER SHEET NAME^F^^4;1^K:$L(X)>30!($L(X)<3) X
"^DD",9002313.78,9002313.78,4.01,3)
Answer must be 3-30 characters in length.
"^DD",9002313.78,9002313.78,4.01,21,0)
^^3^3^3071126^
"^DD",9002313.78,9002313.78,4.01,21,1,0)
Payer sheet.  The value of the field (#.01) Record Format Name of the file
"^DD",9002313.78,9002313.78,4.01,21,2,0)
(#9002313.92) BPS NCPDP FORMATS ien Textual description of this record
"^DD",9002313.78,9002313.78,4.01,21,3,0)
format.
"^DD",9002313.78,9002313.78,4.01,"DT")
3071126
"^DD",9002313.78,9002313.78,4.02,0)
B2 PAYER SHEET NAME^F^^4;2^K:$L(X)>30!($L(X)<3) X
"^DD",9002313.78,9002313.78,4.02,3)
Answer must be 3-30 characters in length.
"^DD",9002313.78,9002313.78,4.02,21,0)
^^3^3^3071126^
"^DD",9002313.78,9002313.78,4.02,21,1,0)
B2 Payer sheet.  The value of the field (#.01) Record Format Name of the
"^DD",9002313.78,9002313.78,4.02,21,2,0)
file (#9002313.92) BPS NCPDP FORMATS ien Textual description of this
"^DD",9002313.78,9002313.78,4.02,21,3,0)
record format.
"^DD",9002313.78,9002313.78,4.02,"DT")
3071126
"^DD",9002313.78,9002313.78,4.03,0)
B3 REBILL PAYER SHEET NAME^F^^4;3^K:$L(X)>30!($L(X)<3) X
"^DD",9002313.78,9002313.78,4.03,3)
Answer must be 3-30 characters in length.
"^DD",9002313.78,9002313.78,4.03,21,0)
^^3^3^3071126^
"^DD",9002313.78,9002313.78,4.03,21,1,0)
B3 Rebill Payer sheet The value of the field (#.01) Record Format Name of
"^DD",9002313.78,9002313.78,4.03,21,2,0)
the file (#9002313.92) BPS NCPDP FORMATS ien Textual description of this
"^DD",9002313.78,9002313.78,4.03,21,3,0)
record format.
"^DD",9002313.78,9002313.78,4.03,"DT")
3071231
"^DD",9002313.78,9002313.78,5.01,0)
USER^P200'^VA(200,^5;1^Q
"^DD",9002313.78,9002313.78,5.01,3)
Enter the user who made the request
"^DD",9002313.78,9002313.78,5.01,21,0)
^^1^1^3080701^
"^DD",9002313.78,9002313.78,5.01,21,1,0)
ID (IEN of the NEW PERSON file) of the user name who entered this record.
"^DD",9002313.78,9002313.78,5.01,"DT")
3080701
"^DD",9002313.78,9002313.78,5.02,0)
DATE AND TIME WAS CREATED^D^^5;2^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",9002313.78,9002313.78,5.02,3)
Answer with the date/time this record was created
"^DD",9002313.78,9002313.78,5.02,21,0)
^^1^1^3080102^
"^DD",9002313.78,9002313.78,5.02,21,1,0)
Date and time the record was created.
"^DD",9002313.78,9002313.78,5.02,"DT")
3080619
"^DD",9002313.91,9002313.91,0)
FIELD^^40^8
"^DD",9002313.91,9002313.91,0,"DDA")
N
"^DD",9002313.91,9002313.91,0,"DT")
3071227
"^DD",9002313.91,9002313.91,0,"ID",.03)
W "   ",$P(^(0),U,3)
"^DD",9002313.91,9002313.91,0,"IX","B",9002313.91,.01)

"^DD",9002313.91,9002313.91,0,"IX","C",9002313.91,.03)

"^DD",9002313.91,9002313.91,0,"IX","D",9002313.91,.06)

"^DD",9002313.91,9002313.91,0,"NM","BPS NCPDP FIELD DEFS")

"^DD",9002313.91,9002313.91,0,"PT",9002313.311,.01)

"^DD",9002313.91,9002313.91,0,"PT",9002313.3121,.01)

"^DD",9002313.91,9002313.91,0,"PT",9002313.5111,.01)

"^DD",9002313.91,9002313.91,0,"PT",9002313.9205,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.9206,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.9207,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.9208,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.9209,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.921,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.9213,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.9214,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.9215,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.9216,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.9217,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.9218,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.9219,.02)

"^DD",9002313.91,9002313.91,0,"PT",9002313.922,.02)

"^DD",9002313.91,9002313.91,0,"VRPK")
BPS
"^DD",9002313.91,9002313.91,.01,0)
NCPDP FIELD NUMBER^RNJ6,2^^0;1^K:+X'=X!(X>800)!(X<0)!(X?.E1"."3.N) X
"^DD",9002313.91,9002313.91,.01,1,0)
^.1
"^DD",9002313.91,9002313.91,.01,1,1,0)
9002313.91^B
"^DD",9002313.91,9002313.91,.01,1,1,1)
S ^BPSF(9002313.91,"B",$E(X,1,30),DA)=""
"^DD",9002313.91,9002313.91,.01,1,1,2)
K ^BPSF(9002313.91,"B",$E(X,1,30),DA)
"^DD",9002313.91,9002313.91,.01,3)
Type a number between 0 and 800, 2 Decimal Digits
"^DD",9002313.91,9002313.91,.01,21,0)
^^1^1^3071227^
"^DD",9002313.91,9002313.91,.01,21,1,0)
The NCPDP field number from the NCPDP data dictionary.
"^DD",9002313.91,9002313.91,.01,"DT")
3071227
"^DD",9002313.91,9002313.91,.03,0)
NAME^F^^0;3^K:$L(X)>30!($L(X)<3) X
"^DD",9002313.91,9002313.91,.03,1,0)
^.1
"^DD",9002313.91,9002313.91,.03,1,1,0)
9002313.91^C
"^DD",9002313.91,9002313.91,.03,1,1,1)
S ^BPSF(9002313.91,"C",$E(X,1,30),DA)=""
"^DD",9002313.91,9002313.91,.03,1,1,2)
K ^BPSF(9002313.91,"C",$E(X,1,30),DA)
"^DD",9002313.91,9002313.91,.03,1,1,"DT")
3001007
"^DD",9002313.91,9002313.91,.03,3)
Answer must be 3-30 characters in length.
"^DD",9002313.91,9002313.91,.03,21,0)
^^2^2^3071227^
"^DD",9002313.91,9002313.91,.03,21,1,0)
Descriptive name the tells what the field is within the pharmacy
"^DD",9002313.91,9002313.91,.03,21,2,0)
environment.
"^DD",9002313.91,9002313.91,.03,"DT")
3071227
"^DD",9002313.91,9002313.91,.04,0)
FORMAT^S^N:NUMERIC;A/N:ALPHA/NUMERIC;D:SIGNED NUMERIC;^0;4^Q
"^DD",9002313.91,9002313.91,.04,3)
Enter the field's format type.
"^DD",9002313.91,9002313.91,.04,21,0)
^^1^1^3071227^
"^DD",9002313.91,9002313.91,.04,21,1,0)
This is the format of the field used within the NCPDP standard.
"^DD",9002313.91,9002313.91,.04,"DT")
3071227
"^DD",9002313.91,9002313.91,.06,0)
ID^F^^5;1^K:$L(X)>2!($L(X)<2) X
"^DD",9002313.91,9002313.91,.06,1,0)
^.1
"^DD",9002313.91,9002313.91,.06,1,1,0)
9002313.91^D
"^DD",9002313.91,9002313.91,.06,1,1,1)
S ^BPSF(9002313.91,"D",$E(X,1,30),DA)=""
"^DD",9002313.91,9002313.91,.06,1,1,2)
K ^BPSF(9002313.91,"D",$E(X,1,30),DA)
"^DD",9002313.91,9002313.91,.06,1,1,"%D",0)
^^3^3^3020807^
"^DD",9002313.91,9002313.91,.06,1,1,"%D",1,0)
Cross reference of the 5.1 Field ID.  This cross reference will be used in
"^DD",9002313.91,9002313.91,.06,1,1,"%D",2,0)
the processing of the response as a means of translating the value to a
"^DD",9002313.91,9002313.91,.06,1,1,"%D",3,0)
field number.
"^DD",9002313.91,9002313.91,.06,1,1,"DT")
3020807
"^DD",9002313.91,9002313.91,.06,3)
Answer must be 2 characters in length.
"^DD",9002313.91,9002313.91,.06,21,0)
^^3^3^3071227^
"^DD",9002313.91,9002313.91,.06,21,1,0)
The same as the .02 field, but for specific use when creating 5.1
"^DD",9002313.91,9002313.91,.06,21,2,0)
claims.  The 5.1 fields were separated because 3.x and 5.1 claims were
"^DD",9002313.91,9002313.91,.06,21,3,0)
being submitted concurrently.  
"^DD",9002313.91,9002313.91,.06,"DT")
3071227
"^DD",9002313.91,9002313.91,.07,0)
LENGTH^NJ4,0^^5;2^K:+X'=X!(X>9999)!(X<1)!(X?.E1"."1.N) X
"^DD",9002313.91,9002313.91,.07,3)
Type a number between 1 and 9999, 0 Decimal Digits
"^DD",9002313.91,9002313.91,.07,21,0)
^^1^1^3040121^
"^DD",9002313.91,9002313.91,.07,21,1,0)
Length of the field from the 5.1 NCPDP standard.
"^DD",9002313.91,9002313.91,.07,"DT")
3071227
"^DD",9002313.91,9002313.91,10,0)
GET CODE^9002313.9101^^10;0
"^DD",9002313.91,9002313.91,10,3)
Enter the M code to extract the data for this field.
"^DD",9002313.91,9002313.91,10,9)
@
"^DD",9002313.91,9002313.91,10,21,0)
^^2^2^3040121^
"^DD",9002313.91,9002313.91,10,21,1,0)
M code that tells the BPS system where to find the 
"^DD",9002313.91,9002313.91,10,21,2,0)
particular piece of data for this field.
"^DD",9002313.91,9002313.91,10,"DT")
3071227
"^DD",9002313.91,9002313.91,30,0)
SET CODE^9002313.9103^^30;0
"^DD",9002313.91,9002313.91,30,3)
Enter the M code for the field's data storage.
"^DD",9002313.91,9002313.91,30,9)
@
"^DD",9002313.91,9002313.91,30,21,0)
^^1^1^3040326^
"^DD",9002313.91,9002313.91,30,21,1,0)
M code to store the data in the appropriate segment within the claim.
"^DD",9002313.91,9002313.91,30,"DT")
3071227
"^DD",9002313.91,9002313.91,40,0)
FORMAT CODE^9002313.9104^^25;0
"^DD",9002313.91,9002313.91,40,3)
Enter the M code to format the data in NCPDP format.
"^DD",9002313.91,9002313.91,40,9)
@
"^DD",9002313.91,9002313.91,40,21,0)
^^2^2^3071227^
"^DD",9002313.91,9002313.91,40,21,1,0)
M code to format the data before storing it in the claim.  5.1 was
"^DD",9002313.91,9002313.91,40,21,2,0)
separate because 3.2 and 5.1 claims were being submitted at the same time.
"^DD",9002313.91,9002313.91,40,"DT")
3071227
"^DD",9002313.91,9002313.9101,0)
GET CODE SUB-FIELD^^.01^1
"^DD",9002313.91,9002313.9101,0,"DT")
3071227
"^DD",9002313.91,9002313.9101,0,"NM","GET CODE")

"^DD",9002313.91,9002313.9101,0,"UP")
9002313.91
"^DD",9002313.91,9002313.9101,.01,0)
GET CODE^WL^^0;1^Q
"^DD",9002313.91,9002313.9101,.01,3)
Enter the M code to extract the data for this field.
"^DD",9002313.91,9002313.9101,.01,9)
@
"^DD",9002313.91,9002313.9101,.01,"DT")
3071227
"^DD",9002313.91,9002313.9103,0)
SET CODE SUB-FIELD^^.01^1
"^DD",9002313.91,9002313.9103,0,"DT")
2950420
"^DD",9002313.91,9002313.9103,0,"NM","SET CODE")

"^DD",9002313.91,9002313.9103,0,"UP")
9002313.91
"^DD",9002313.91,9002313.9103,.01,0)
SET CODE^WL^^0;1^Q
"^DD",9002313.91,9002313.9103,.01,3)
Enter the M code for the field's data storage.
"^DD",9002313.91,9002313.9103,.01,9)
@
"^DD",9002313.91,9002313.9103,.01,"DT")
3071227
"^DD",9002313.91,9002313.9104,0)
FORMAT CODE SUB-FIELD^^.01^1
"^DD",9002313.91,9002313.9104,0,"DT")
3020724
"^DD",9002313.91,9002313.9104,0,"NM","FORMAT CODE")

"^DD",9002313.91,9002313.9104,0,"UP")
9002313.91
"^DD",9002313.91,9002313.9104,.01,0)
FORMAT CODE^WL^^0;1^Q
"^DD",9002313.91,9002313.9104,.01,3)
Enter the M code to format the data in NCPDP format.
"^DD",9002313.91,9002313.9104,.01,9)
@
"^DD",9002313.91,9002313.9104,.01,"DT")
3071227
"^DD",9002313.92,9002313.92,0)
FIELD^^1901^26
"^DD",9002313.92,9002313.92,0,"DDA")
N
"^DD",9002313.92,9002313.92,0,"DT")
3071227
"^DD",9002313.92,9002313.92,0,"IX","B",9002313.92,.01)

"^DD",9002313.92,9002313.92,0,"NM","BPS NCPDP FORMATS")

"^DD",9002313.92,9002313.92,0,"PT",366.03,10.07)

"^DD",9002313.92,9002313.92,0,"PT",366.03,10.08)

"^DD",9002313.92,9002313.92,0,"PT",366.03,10.09)

"^DD",9002313.92,9002313.92,0,"PT",366.03,10.11)

"^DD",9002313.92,9002313.92,0,"PT",366.03,10.12)

"^DD",9002313.92,9002313.92,0,"PT",366.03,10.13)

"^DD",9002313.92,9002313.92,0,"PT",9002313.02,.02)

"^DD",9002313.92,9002313.92,0,"PT",9002313.31,.04)

"^DD",9002313.92,9002313.92,0,"PT",9002313.31902,1)

"^DD",9002313.92,9002313.92,0,"PT",9002313.57902,902.02)

"^DD",9002313.92,9002313.92,0,"PT",9002313.57902,902.19)

"^DD",9002313.92,9002313.92,0,"PT",9002313.57902,902.21)

"^DD",9002313.92,9002313.92,0,"PT",9002313.59902,902.02)

"^DD",9002313.92,9002313.92,0,"PT",9002313.59902,902.19)

"^DD",9002313.92,9002313.92,0,"PT",9002313.59902,902.21)

"^DD",9002313.92,9002313.92,0,"PT",9002313.78,.02)

"^DD",9002313.92,9002313.92,0,"PT",9002313.78,.03)

"^DD",9002313.92,9002313.92,0,"PT",9002313.78,.04)

"^DD",9002313.92,9002313.92,0,"PT",9002313.92,1001)

"^DD",9002313.92,9002313.92,0,"VRPK")
BPS
"^DD",9002313.92,9002313.92,.01,0)
RECORD FORMAT NAME^RF^^0;1^K:$L(X)>30!($L(X)<3) X
"^DD",9002313.92,9002313.92,.01,1,0)
^.1
"^DD",9002313.92,9002313.92,.01,1,1,0)
9002313.92^B
"^DD",9002313.92,9002313.92,.01,1,1,1)
S ^BPSF(9002313.92,"B",$E(X,1,30),DA)=""
"^DD",9002313.92,9002313.92,.01,1,1,2)
K ^BPSF(9002313.92,"B",$E(X,1,30),DA)
"^DD",9002313.92,9002313.92,.01,3)
Answer must be 3-30 characters in length.
"^DD",9002313.92,9002313.92,.01,21,0)
^.001^1^1^3040220^^
"^DD",9002313.92,9002313.92,.01,21,1,0)
Textual description of this record format.
"^DD",9002313.92,9002313.92,.01,"DT")
3071227
"^DD",9002313.92,9002313.92,1.02,0)
VERSION^S^32:Version 3.2;3A:Version 3.A;3C:Version 3.C;3B:Version 3.B;51:Version 5.1;^1;2^Q
"^DD",9002313.92,9002313.92,1.02,3)
Enter the version number for this NCPDP format.
"^DD",9002313.92,9002313.92,1.02,21,0)
^^1^1^3031125^
"^DD",9002313.92,9002313.92,1.02,21,1,0)
Version number under which this format is sent.
"^DD",9002313.92,9002313.92,1.02,"DT")
3071227
"^DD",9002313.92,9002313.92,1.03,0)
MAXIMUM RX PER CLAIM^NJ2,0^^1;3^K:+X'=X!(X>99)!(X<1)!(X?.E1"."1.N) X
"^DD",9002313.92,9002313.92,1.03,3)
Type a number between 1 and 99, 0 Decimal Digits
"^DD",9002313.92,9002313.92,1.03,21,0)
^^2^2^3031125^
"^DD",9002313.92,9002313.92,1.03,21,1,0)
Integer value indicating the maximum number of prescriptions that can be 
"^DD",9002313.92,9002313.92,1.03,21,2,0)
sent per claim number.
"^DD",9002313.92,9002313.92,1.03,"DT")
3071227
"^DD",9002313.92,9002313.92,1.06,0)
PRODUCTION STATUS^*S^0:DISABLED;1:DEVELOPMENT;2:FIELD TESTING;3:PRODUCTION;^1;6^Q
"^DD",9002313.92,9002313.92,1.06,3)
Enter the production/testing status of this format
"^DD",9002313.92,9002313.92,1.06,12)
Programmer may select any.  Others: may select only formats in FIELD TESTING or PRODUCTION.
"^DD",9002313.92,9002313.92,1.06,12.1)
S DIC("S")="I Y=2!(Y=3)!(DUZ(0)=""@"")"
"^DD",9002313.92,9002313.92,1.06,21,0)
^^3^3^3001115^
"^DD",9002313.92,9002313.92,1.06,21,1,0)
To be used as a screen when attaching a format to an insurer.
"^DD",9002313.92,9002313.92,1.06,21,2,0)
Don't allow non-production formats.  Those will have to be entered
"^DD",9002313.92,9002313.92,1.06,21,3,0)
directly with Fileman.
"^DD",9002313.92,9002313.92,1.06,"DT")
3071227
"^DD",9002313.92,9002313.92,1.07,0)
FORMAT IS FOR REVERSAL^S^1:YES;0:NO;^1;7^Q
"^DD",9002313.92,9002313.92,1.07,3)
Specify if this format is for reversal
"^DD",9002313.92,9002313.92,1.07,21,0)
^^2^2^3001115^
"^DD",9002313.92,9002313.92,1.07,21,1,0)
To be used as a screen when selecting format to attach to an insurance.
"^DD",9002313.92,9002313.92,1.07,21,2,0)
Don't allow reversal format to be selected as the insurance's format!
"^DD",9002313.92,9002313.92,1.07,"DT")
3071227
"^DD",9002313.92,9002313.92,1.1,0)
TOTAL EXCLUSIVE PATIENT AMOUNT^S^1:Y;0:N;^1;10^Q
"^DD",9002313.92,9002313.92,1.1,3)
Enter if the total is exclusive of the patient amount
"^DD",9002313.92,9002313.92,1.1,21,0)
^^8^8^3071227^
"^DD",9002313.92,9002313.92,1.1,21,1,0)
This refers to the interpretation of the fields in the response packets,
"^DD",9002313.92,9002313.92,1.1,21,2,0)
as copied to 9002313.03, Response(s) multiple, fields 509 Total Amount
"^DD",9002313.92,9002313.92,1.1,21,3,0)
Paid and 505 Patient Paid Amount.  For most formats and insurers 509 Total
"^DD",9002313.92,9002313.92,1.1,21,4,0)
Amount Paid means Total, Patient plus Insurer.  Other insurers don't do it
"^DD",9002313.92,9002313.92,1.1,21,5,0)
that way - for them, 509 contains only the amount paid by insurance.
"^DD",9002313.92,9002313.92,1.1,21,6,0)
$$NETPAID1 needs to know whether to do the subtraction.  If $$NETPAID1
"^DD",9002313.92,9002313.92,1.1,21,7,0)
encounters a case where (#509)<(#505), it will set the flag in the format,
"^DD",9002313.92,9002313.92,1.1,21,8,0)
locally.
"^DD",9002313.92,9002313.92,1.1,"DT")
3071227
"^DD",9002313.92,9002313.92,1.11,0)
ASLEEP PROBER^P9002313.59'^BPST(^1;11^Q
"^DD",9002313.92,9002313.92,1.11,3)
Enter the claim to test whether the insurer is awake
"^DD",9002313.92,9002313.92,1.11,21,0)
^^2^2^3060105^
"^DD",9002313.92,9002313.92,1.11,21,1,0)
The BPS Transaction used as the test prober to test when the insurer is 
"^DD",9002313.92,9002313.92,1.11,21,2,0)
'awake'.
"^DD",9002313.92,9002313.92,1.11,"DT")
3060105
"^DD",9002313.92,9002313.92,1.12,0)
ASLEEP RETRY TIME^D^^1;12^S %DT="EST" D ^%DT S X=Y K:X<1 X
"^DD",9002313.92,9002313.92,1.12,3)
Enter date/time when to retry sending to payer
"^DD",9002313.92,9002313.92,1.12,21,0)
^^1^1^3080616^
"^DD",9002313.92,9002313.92,1.12,21,1,0)
The time to wait before re-trying to see if the insurer is 'awake'.
"^DD",9002313.92,9002313.92,1.12,"DT")
3080616
"^DD",9002313.92,9002313.92,1.13,0)
SOFTWARE VENDOR CERT ID^F^^1;13^K:$L(X)>10!($L(X)<1) X
"^DD",9002313.92,9002313.92,1.13,3)
Answer must be 1-10 characters in length.
"^DD",9002313.92,9002313.92,1.13,21,0)
^^2^2^3080616^
"^DD",9002313.92,9002313.92,1.13,21,1,0)
Certification ID number assigned by the payer or processor to indicate the
"^DD",9002313.92,9002313.92,1.13,21,2,0)
prescriber's certification status within their health plan program.
"^DD",9002313.92,9002313.92,1.13,"DT")
3080616
"^DD",9002313.92,9002313.92,1.14,0)
PAYER SHEET VERSION^RNJ4,0^^1;14^K:+X'=X!(X>9999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.92,9002313.92,1.14,3)
Type a Number between 0 and 9999, 0 Decimal Digits
"^DD",9002313.92,9002313.92,1.14,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.92,1.14,21,1,0)
Which version of the NCPDP standard this payer sheet is for.
"^DD",9002313.92,9002313.92,1.14,"DT")
3031204
"^DD",9002313.92,9002313.92,100,0)
TRANSACTION HEADER SEGMENT^9002313.9205A^^100;0
"^DD",9002313.92,9002313.92,100,"DT")
3071227
"^DD",9002313.92,9002313.92,110,0)
PATIENT SEGMENT^9002313.9206A^^110;0
"^DD",9002313.92,9002313.92,110,"DT")
3071227
"^DD",9002313.92,9002313.92,120,0)
INSURANCE SEGMENT^9002313.9207A^^120;0
"^DD",9002313.92,9002313.92,120,"DT")
3071227
"^DD",9002313.92,9002313.92,130,0)
CLAIM SEGMENT^9002313.9208A^^130;0
"^DD",9002313.92,9002313.92,130,"DT")
3071227
"^DD",9002313.92,9002313.92,140,0)
PHARMACY PROVIDER SEGMENT^9002313.9209A^^140;0
"^DD",9002313.92,9002313.92,140,"DT")
3071227
"^DD",9002313.92,9002313.92,150,0)
PRESCRIBER SEGMENT^9002313.921A^^150;0
"^DD",9002313.92,9002313.92,150,"DT")
3071227
"^DD",9002313.92,9002313.92,160,0)
COB OTHER PAYMENTS SEGMENT^9002313.9213A^^160;0
"^DD",9002313.92,9002313.92,160,"DT")
3071227
"^DD",9002313.92,9002313.92,170,0)
WORKERS COMP SEGMENT^9002313.9214A^^170;0
"^DD",9002313.92,9002313.92,170,"DT")
3080616
"^DD",9002313.92,9002313.92,180,0)
DUR PPS SEGMENT^9002313.9215A^^180;0
"^DD",9002313.92,9002313.92,180,"DT")
3071227
"^DD",9002313.92,9002313.92,190,0)
PRICING SEGMENT^9002313.9216A^^190;0
"^DD",9002313.92,9002313.92,190,"DT")
3071227
"^DD",9002313.92,9002313.92,200,0)
COUPON SEGMENT^9002313.9217A^^200;0
"^DD",9002313.92,9002313.92,200,"DT")
3071227
"^DD",9002313.92,9002313.92,210,0)
COMPOUND SEGMENT^9002313.9218A^^210;0
"^DD",9002313.92,9002313.92,210,"DT")
3071227
"^DD",9002313.92,9002313.92,220,0)
PRIOR AUTH SEGMENT^9002313.9219A^^220;0
"^DD",9002313.92,9002313.92,220,"DT")
3071227
"^DD",9002313.92,9002313.92,230,0)
CLINICAL SEGMENT^9002313.922A^^230;0
"^DD",9002313.92,9002313.92,230,"DT")
3071227
"^DD",9002313.92,9002313.92,1001,0)
REVERSAL FORMAT^P9002313.92'^BPSF(9002313.92,^REVERSAL;1^Q
"^DD",9002313.92,9002313.92,1001,3)
Select the format to be used for reversals.
"^DD",9002313.92,9002313.92,1001,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.92,1001,21,1,0)
The name of the payer sheet that is to be used for reversals.
"^DD",9002313.92,9002313.92,1001,"DT")
3071227
"^DD",9002313.92,9002313.92,1901,0)
DEVELOPMENT REMARKS^9002313.921901^^DEVELOPER'S REMARKS;0
"^DD",9002313.92,9002313.92,1901,3)
Enter general remarks relating to this segment.
"^DD",9002313.92,9002313.92,1901,21,0)
^^2^2^3040220^
"^DD",9002313.92,9002313.92,1901,21,1,0)
General remarks for the payer sheet, anything that will help describe the 
"^DD",9002313.92,9002313.92,1901,21,2,0)
function of the sheet, etc.  
"^DD",9002313.92,9002313.92,1901,"DT")
3071227
"^DD",9002313.92,9002313.9205,0)
TRANSACTION HEADER SEGMENT SUB-FIELD^^2^5
"^DD",9002313.92,9002313.9205,0,"DT")
3071227
"^DD",9002313.92,9002313.9205,0,"IX","B",9002313.9205,.01)

"^DD",9002313.92,9002313.9205,0,"NM","TRANSACTION HEADER SEGMENT")

"^DD",9002313.92,9002313.9205,0,"UP")
9002313.92
"^DD",9002313.92,9002313.9205,.01,0)
TRANSACTION HEADER ORDER^MNJ3,0^^0;1^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.92,9002313.9205,.01,1,0)
^.1
"^DD",9002313.92,9002313.9205,.01,1,1,0)
9002313.9205^B
"^DD",9002313.92,9002313.9205,.01,1,1,1)
S ^BPSF(9002313.92,DA(1),100,"B",$E(X,1,30),DA)=""
"^DD",9002313.92,9002313.9205,.01,1,1,2)
K ^BPSF(9002313.92,DA(1),100,"B",$E(X,1,30),DA)
"^DD",9002313.92,9002313.9205,.01,3)
Type a Number between 1 and 999, 0 Decimal Digits
"^DD",9002313.92,9002313.9205,.01,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9205,.01,21,1,0)
Identification of the special event handler.
"^DD",9002313.92,9002313.9205,.01,"DT")
3071227
"^DD",9002313.92,9002313.9205,.02,0)
NCPDP FIELD NUMBER^P9002313.91'^BPSF(9002313.91,^0;2^Q
"^DD",9002313.92,9002313.9205,.02,3)
Specify the NCPDP field number
"^DD",9002313.92,9002313.9205,.02,21,0)
^^1^1^3071227^
"^DD",9002313.92,9002313.9205,.02,21,1,0)
The NCPDP Field to be manipulated.
"^DD",9002313.92,9002313.9205,.02,"DT")
3071227
"^DD",9002313.92,9002313.9205,.03,0)
PROCESSING MODE^S^D:DEFAULT;S:STANDARD;X:SPECIAL;U:UNKNOWN;^0;3^Q
"^DD",9002313.92,9002313.9205,.03,3)
Specify the mode for processing
"^DD",9002313.92,9002313.9205,.03,21,0)
^^1^1^3080616^
"^DD",9002313.92,9002313.9205,.03,21,1,0)
Which processing mode is in effect for this segment.
"^DD",9002313.92,9002313.9205,.03,"DT")
3080616
"^DD",9002313.92,9002313.9205,1,0)
SPECIAL CODE^9002313.92051^^1;0
"^DD",9002313.92,9002313.9205,1,3)
Enter M code used to create the Transaction Header Segment.
"^DD",9002313.92,9002313.9205,1,9)
@
"^DD",9002313.92,9002313.9205,1,21,0)
^^1^1^3071227^
"^DD",9002313.92,9002313.9205,1,21,1,0)
When Processing Mode "X" is in effect, the special M code to be executed.
"^DD",9002313.92,9002313.9205,1,"DT")
3071227
"^DD",9002313.92,9002313.9205,2,0)
PROGRAMMING NOTES^9002313.92052^^2;0
"^DD",9002313.92,9002313.9205,2,3)
Enter notes relating to the M code.
"^DD",9002313.92,9002313.9205,2,21,0)
^^1^1^3080616^
"^DD",9002313.92,9002313.9205,2,21,1,0)
Description of what is being accomplished by executing the special code.
"^DD",9002313.92,9002313.9205,2,"DT")
3080616
"^DD",9002313.92,9002313.92051,0)
SPECIAL CODE SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92051,0,"DT")
3071227
"^DD",9002313.92,9002313.92051,0,"NM","SPECIAL CODE")

"^DD",9002313.92,9002313.92051,0,"UP")
9002313.9205
"^DD",9002313.92,9002313.92051,.01,0)
SPECIAL CODE^WL^^0;1^Q
"^DD",9002313.92,9002313.92051,.01,3)
Enter M code used to create the Transaction Header Segment.
"^DD",9002313.92,9002313.92051,.01,9)
@
"^DD",9002313.92,9002313.92051,.01,"DT")
3071227
"^DD",9002313.92,9002313.92052,0)
PROGRAMMING NOTES SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92052,0,"DT")
3071227
"^DD",9002313.92,9002313.92052,0,"NM","PROGRAMMING NOTES")

"^DD",9002313.92,9002313.92052,0,"UP")
9002313.9205
"^DD",9002313.92,9002313.92052,.01,0)
PROGRAMMING NOTES^WL^^0;1^Q
"^DD",9002313.92,9002313.92052,.01,3)
Enter notes relating to the M code.
"^DD",9002313.92,9002313.92052,.01,"DT")
3080616
"^DD",9002313.92,9002313.9206,0)
PATIENT SEGMENT SUB-FIELD^^2^5
"^DD",9002313.92,9002313.9206,0,"DT")
3031223
"^DD",9002313.92,9002313.9206,0,"IX","B",9002313.9206,.01)

"^DD",9002313.92,9002313.9206,0,"NM","PATIENT SEGMENT")

"^DD",9002313.92,9002313.9206,0,"UP")
9002313.92
"^DD",9002313.92,9002313.9206,.01,0)
PATIENT SEGMENT ORDER^MNJ3,0^^0;1^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.92,9002313.9206,.01,1,0)
^.1
"^DD",9002313.92,9002313.9206,.01,1,1,0)
9002313.9206^B
"^DD",9002313.92,9002313.9206,.01,1,1,1)
S ^BPSF(9002313.92,DA(1),110,"B",$E(X,1,30),DA)=""
"^DD",9002313.92,9002313.9206,.01,1,1,2)
K ^BPSF(9002313.92,DA(1),110,"B",$E(X,1,30),DA)
"^DD",9002313.92,9002313.9206,.01,3)
Type a Number between 1 and 999, 0 Decimal Digits
"^DD",9002313.92,9002313.9206,.01,21,0)
^^1^1^3071227^
"^DD",9002313.92,9002313.9206,.01,21,1,0)
Identification of the special event handler.
"^DD",9002313.92,9002313.9206,.01,"DT")
3071227
"^DD",9002313.92,9002313.9206,.02,0)
NCPDP FIELD NUMBER^P9002313.91'^BPSF(9002313.91,^0;2^Q
"^DD",9002313.92,9002313.9206,.02,3)
Select the field number relating to the Patient Segment.
"^DD",9002313.92,9002313.9206,.02,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9206,.02,21,1,0)
The NCPDP Field to be manipulated.
"^DD",9002313.92,9002313.9206,.02,"DT")
3071227
"^DD",9002313.92,9002313.9206,.03,0)
PROCESSING MODE^S^D:DEFAULT;S:STANDARD;X:SPECIAL;?:UNKNOWN;^0;3^Q
"^DD",9002313.92,9002313.9206,.03,3)
Specify the mode for processing
"^DD",9002313.92,9002313.9206,.03,21,0)
^^1^1^3080616^
"^DD",9002313.92,9002313.9206,.03,21,1,0)
Which processing mode is in effect for this segment.
"^DD",9002313.92,9002313.9206,.03,"DT")
3080616
"^DD",9002313.92,9002313.9206,1,0)
SPECIAL CODE^9002313.92061^^1;0
"^DD",9002313.92,9002313.9206,1,3)
Enter M code used to create the Patient Segment.
"^DD",9002313.92,9002313.9206,1,9)
@
"^DD",9002313.92,9002313.9206,1,21,0)
^^1^1^3071227^
"^DD",9002313.92,9002313.9206,1,21,1,0)
When Processing Mode "X" is in effect, the special M code to be executed.
"^DD",9002313.92,9002313.9206,1,"DT")
3071227
"^DD",9002313.92,9002313.9206,2,0)
PROGRAMMING NOTES^9002313.92062^^2;0
"^DD",9002313.92,9002313.9206,2,3)
Enter notes relating to the M code.
"^DD",9002313.92,9002313.9206,2,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9206,2,21,1,0)
Description of what is being accomplished by executing the special code.
"^DD",9002313.92,9002313.9206,2,"DT")
3080616
"^DD",9002313.92,9002313.92061,0)
SPECIAL CODE SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92061,0,"DT")
3020801
"^DD",9002313.92,9002313.92061,0,"NM","SPECIAL CODE")

"^DD",9002313.92,9002313.92061,0,"UP")
9002313.9206
"^DD",9002313.92,9002313.92061,.01,0)
SPECIAL CODE^WL^^0;1^Q
"^DD",9002313.92,9002313.92061,.01,3)
Enter M code used to create the Patient Segment.
"^DD",9002313.92,9002313.92061,.01,9)
@
"^DD",9002313.92,9002313.92061,.01,"DT")
3071227
"^DD",9002313.92,9002313.92062,0)
PROGRAMMING NOTES SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92062,0,"DT")
3020801
"^DD",9002313.92,9002313.92062,0,"NM","PROGRAMMING NOTES")

"^DD",9002313.92,9002313.92062,0,"UP")
9002313.9206
"^DD",9002313.92,9002313.92062,.01,0)
PROGRAMMING NOTES^WL^^0;1^Q
"^DD",9002313.92,9002313.92062,.01,3)
Enter notes relating to the M code.
"^DD",9002313.92,9002313.92062,.01,"DT")
3080616
"^DD",9002313.92,9002313.9207,0)
INSURANCE SEGMENT SUB-FIELD^^2^5
"^DD",9002313.92,9002313.9207,0,"DT")
3031223
"^DD",9002313.92,9002313.9207,0,"IX","B",9002313.9207,.01)

"^DD",9002313.92,9002313.9207,0,"NM","INSURANCE SEGMENT")

"^DD",9002313.92,9002313.9207,0,"UP")
9002313.92
"^DD",9002313.92,9002313.9207,.01,0)
INSURANCE SEGMENT ORDER^MNJ3,0^^0;1^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.92,9002313.9207,.01,1,0)
^.1
"^DD",9002313.92,9002313.9207,.01,1,1,0)
9002313.9207^B
"^DD",9002313.92,9002313.9207,.01,1,1,1)
S ^BPSF(9002313.92,DA(1),120,"B",$E(X,1,30),DA)=""
"^DD",9002313.92,9002313.9207,.01,1,1,2)
K ^BPSF(9002313.92,DA(1),120,"B",$E(X,1,30),DA)
"^DD",9002313.92,9002313.9207,.01,3)
Type a Number between 1 and 999, 0 Decimal Digits
"^DD",9002313.92,9002313.9207,.01,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9207,.01,21,1,0)
Identification of the special event handler.
"^DD",9002313.92,9002313.9207,.01,"DT")
3071227
"^DD",9002313.92,9002313.9207,.02,0)
NCPDP FIELD NUMBER^P9002313.91'^BPSF(9002313.91,^0;2^Q
"^DD",9002313.92,9002313.9207,.02,3)
Select the field number relating to the Insurance Segment.
"^DD",9002313.92,9002313.9207,.02,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9207,.02,21,1,0)
The NCPDP Field to be manipulated.
"^DD",9002313.92,9002313.9207,.02,"DT")
3071227
"^DD",9002313.92,9002313.9207,.03,0)
PROCESSING MODE^S^D:DEFAULT;S:STANDARD;X:SPECIAL;?:UNKNOWN;^0;3^Q
"^DD",9002313.92,9002313.9207,.03,3)
Specify the mode for processing
"^DD",9002313.92,9002313.9207,.03,21,0)
^^1^1^3080616^
"^DD",9002313.92,9002313.9207,.03,21,1,0)
Which processing mode is in effect for this segment.
"^DD",9002313.92,9002313.9207,.03,"DT")
3080616
"^DD",9002313.92,9002313.9207,1,0)
SPECIAL CODE^9002313.92071^^1;0
"^DD",9002313.92,9002313.9207,1,3)
Enter M code used to create the Insurance Segment.
"^DD",9002313.92,9002313.9207,1,9)
@
"^DD",9002313.92,9002313.9207,1,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9207,1,21,1,0)
When Processing Mode "X" is in effect, the special M code to be executed.
"^DD",9002313.92,9002313.9207,1,"DT")
3071227
"^DD",9002313.92,9002313.9207,2,0)
PROGRAMMING NOTES^9002313.92072^^2;0
"^DD",9002313.92,9002313.9207,2,3)
Enter notes relating to the M code.
"^DD",9002313.92,9002313.9207,2,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9207,2,21,1,0)
Description of what is being accomplished by executing the special code.
"^DD",9002313.92,9002313.9207,2,"DT")
3080616
"^DD",9002313.92,9002313.92071,0)
SPECIAL CODE SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92071,0,"DT")
3020801
"^DD",9002313.92,9002313.92071,0,"NM","SPECIAL CODE")

"^DD",9002313.92,9002313.92071,0,"UP")
9002313.9207
"^DD",9002313.92,9002313.92071,.01,0)
SPECIAL CODE^WL^^0;1^Q
"^DD",9002313.92,9002313.92071,.01,3)
Enter M code used to create the Insurance Segment.
"^DD",9002313.92,9002313.92071,.01,9)
@
"^DD",9002313.92,9002313.92071,.01,"DT")
3071227
"^DD",9002313.92,9002313.92072,0)
PROGRAMMING NOTES SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92072,0,"DT")
3020801
"^DD",9002313.92,9002313.92072,0,"NM","PROGRAMMING NOTES")

"^DD",9002313.92,9002313.92072,0,"UP")
9002313.9207
"^DD",9002313.92,9002313.92072,.01,0)
PROGRAMMING NOTES^WL^^0;1^Q
"^DD",9002313.92,9002313.92072,.01,3)
Enter notes relating to the M code.
"^DD",9002313.92,9002313.92072,.01,"DT")
3080616
"^DD",9002313.92,9002313.9208,0)
CLAIM SEGMENT SUB-FIELD^^2^5
"^DD",9002313.92,9002313.9208,0,"DT")
3031223
"^DD",9002313.92,9002313.9208,0,"IX","B",9002313.9208,.01)

"^DD",9002313.92,9002313.9208,0,"NM","CLAIM SEGMENT")

"^DD",9002313.92,9002313.9208,0,"UP")
9002313.92
"^DD",9002313.92,9002313.9208,.01,0)
CLAIM SEGMENT ORDER^MNJ3,0^^0;1^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.92,9002313.9208,.01,1,0)
^.1
"^DD",9002313.92,9002313.9208,.01,1,1,0)
9002313.9208^B
"^DD",9002313.92,9002313.9208,.01,1,1,1)
S ^BPSF(9002313.92,DA(1),130,"B",$E(X,1,30),DA)=""
"^DD",9002313.92,9002313.9208,.01,1,1,2)
K ^BPSF(9002313.92,DA(1),130,"B",$E(X,1,30),DA)
"^DD",9002313.92,9002313.9208,.01,3)
Type a Number between 1 and 999, 0 Decimal Digits
"^DD",9002313.92,9002313.9208,.01,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9208,.01,21,1,0)
Identification of the special event handler.
"^DD",9002313.92,9002313.9208,.01,"DT")
3071227
"^DD",9002313.92,9002313.9208,.02,0)
NCPDP FIELD NUMBER^P9002313.91'^BPSF(9002313.91,^0;2^Q
"^DD",9002313.92,9002313.9208,.02,3)
Select the field number relating to the Claim Segment.
"^DD",9002313.92,9002313.9208,.02,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9208,.02,21,1,0)
The NCPDP Field to be manipulated.
"^DD",9002313.92,9002313.9208,.02,"DT")
3071227
"^DD",9002313.92,9002313.9208,.03,0)
PROCESSING MODE^S^D:DEFAULT;S:STANDARD;X:SPECIAL;?:UNKNOWN;^0;3^Q
"^DD",9002313.92,9002313.9208,.03,3)
Specify the mode for processing
"^DD",9002313.92,9002313.9208,.03,21,0)
^^1^1^3080616^
"^DD",9002313.92,9002313.9208,.03,21,1,0)
Which processing mode is in effect for this segment.
"^DD",9002313.92,9002313.9208,.03,"DT")
3080616
"^DD",9002313.92,9002313.9208,1,0)
SPECIAL CODE^9002313.92081^^1;0
"^DD",9002313.92,9002313.9208,1,3)
Enter M code used to create the Claim Segment.
"^DD",9002313.92,9002313.9208,1,9)
@
"^DD",9002313.92,9002313.9208,1,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9208,1,21,1,0)
When Processing Mode "X" is in effect, the special M code to be executed.
"^DD",9002313.92,9002313.9208,1,"DT")
3071227
"^DD",9002313.92,9002313.9208,2,0)
PROGRAMMING NOTES^9002313.92082^^2;0
"^DD",9002313.92,9002313.9208,2,3)
Enter notes relating to the M code.
"^DD",9002313.92,9002313.9208,2,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9208,2,21,1,0)
Description of what is being accomplished by executing the special code.
"^DD",9002313.92,9002313.9208,2,"DT")
3071227
"^DD",9002313.92,9002313.92081,0)
SPECIAL CODE SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92081,0,"DT")
3020801
"^DD",9002313.92,9002313.92081,0,"NM","SPECIAL CODE")

"^DD",9002313.92,9002313.92081,0,"UP")
9002313.9208
"^DD",9002313.92,9002313.92081,.01,0)
SPECIAL CODE^WL^^0;1^Q
"^DD",9002313.92,9002313.92081,.01,3)
Enter M code used to create the Claim Segment.
"^DD",9002313.92,9002313.92081,.01,9)
@
"^DD",9002313.92,9002313.92081,.01,"DT")
3071227
"^DD",9002313.92,9002313.92082,0)
PROGRAMMING NOTES SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92082,0,"DT")
3020801
"^DD",9002313.92,9002313.92082,0,"NM","PROGRAMMING NOTES")

"^DD",9002313.92,9002313.92082,0,"UP")
9002313.9208
"^DD",9002313.92,9002313.92082,.01,0)
PROGRAMMING NOTES^WL^^0;1^Q
"^DD",9002313.92,9002313.92082,.01,3)
Enter notes relating to the M code.
"^DD",9002313.92,9002313.92082,.01,"DT")
3080616
"^DD",9002313.92,9002313.9209,0)
PHARMACY PROVIDER SEGMENT SUB-FIELD^^2^5
"^DD",9002313.92,9002313.9209,0,"DT")
3031223
"^DD",9002313.92,9002313.9209,0,"IX","B",9002313.9209,.01)

"^DD",9002313.92,9002313.9209,0,"NM","PHARMACY PROVIDER SEGMENT")

"^DD",9002313.92,9002313.9209,0,"UP")
9002313.92
"^DD",9002313.92,9002313.9209,.01,0)
PHARMACY PROVIDER ORDER^MNJ3,0^^0;1^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.92,9002313.9209,.01,1,0)
^.1
"^DD",9002313.92,9002313.9209,.01,1,1,0)
9002313.9209^B
"^DD",9002313.92,9002313.9209,.01,1,1,1)
S ^BPSF(9002313.92,DA(1),140,"B",$E(X,1,30),DA)=""
"^DD",9002313.92,9002313.9209,.01,1,1,2)
K ^BPSF(9002313.92,DA(1),140,"B",$E(X,1,30),DA)
"^DD",9002313.92,9002313.9209,.01,3)
Type a Number between 1 and 999, 0 Decimal Digits
"^DD",9002313.92,9002313.9209,.01,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9209,.01,21,1,0)
Identification of the special event handler.
"^DD",9002313.92,9002313.9209,.01,"DT")
3071227
"^DD",9002313.92,9002313.9209,.02,0)
NCPDP FIELD NUMBER^P9002313.91'^BPSF(9002313.91,^0;2^Q
"^DD",9002313.92,9002313.9209,.02,3)
Select the field number relating to the Pharmacy Provider Segment.
"^DD",9002313.92,9002313.9209,.02,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9209,.02,21,1,0)
The NCPDP Field to be manipulated.
"^DD",9002313.92,9002313.9209,.02,"DT")
3071227
"^DD",9002313.92,9002313.9209,.03,0)
PROCESSING MODE^S^D:DEFAULT;S:STANDARD;X:SPECIAL;?:UNKNOWN;^0;3^Q
"^DD",9002313.92,9002313.9209,.03,3)
Specify the mode for processing
"^DD",9002313.92,9002313.9209,.03,21,0)
^^1^1^3080616^
"^DD",9002313.92,9002313.9209,.03,21,1,0)
Which processing mode is in effect for this segment.
"^DD",9002313.92,9002313.9209,.03,"DT")
3080616
"^DD",9002313.92,9002313.9209,1,0)
SPECIAL CODE^9002313.92091^^1;0
"^DD",9002313.92,9002313.9209,1,3)
Enter M code used to create the Pharmacy Provider Segment.
"^DD",9002313.92,9002313.9209,1,9)
@
"^DD",9002313.92,9002313.9209,1,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9209,1,21,1,0)
When Processing Mode "X" is in effect, the special M code to be executed.
"^DD",9002313.92,9002313.9209,1,"DT")
3071227
"^DD",9002313.92,9002313.9209,2,0)
PROGRAMMING NOTES^9002313.92092^^2;0
"^DD",9002313.92,9002313.9209,2,3)
Enter notes relating to the M code.
"^DD",9002313.92,9002313.9209,2,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9209,2,21,1,0)
Description of what is being accomplished by executing the special code.
"^DD",9002313.92,9002313.9209,2,"DT")
3080616
"^DD",9002313.92,9002313.92091,0)
SPECIAL CODE SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92091,0,"DT")
3020801
"^DD",9002313.92,9002313.92091,0,"NM","SPECIAL CODE")

"^DD",9002313.92,9002313.92091,0,"UP")
9002313.9209
"^DD",9002313.92,9002313.92091,.01,0)
SPECIAL CODE^WL^^0;1^Q
"^DD",9002313.92,9002313.92091,.01,3)
Enter M code used to create the Pharmacy Provider Segment.
"^DD",9002313.92,9002313.92091,.01,9)
@
"^DD",9002313.92,9002313.92091,.01,"DT")
3071227
"^DD",9002313.92,9002313.92092,0)
PROGRAMMING NOTES SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92092,0,"DT")
3020801
"^DD",9002313.92,9002313.92092,0,"NM","PROGRAMMING NOTES")

"^DD",9002313.92,9002313.92092,0,"UP")
9002313.9209
"^DD",9002313.92,9002313.92092,.01,0)
PROGRAMMING NOTES^WL^^0;1^Q
"^DD",9002313.92,9002313.92092,.01,3)
Enter notes relating to the M code.
"^DD",9002313.92,9002313.92092,.01,"DT")
3080616
"^DD",9002313.92,9002313.921,0)
PRESCRIBER SEGMENT SUB-FIELD^^2^5
"^DD",9002313.92,9002313.921,0,"DT")
3031223
"^DD",9002313.92,9002313.921,0,"IX","B",9002313.921,.01)

"^DD",9002313.92,9002313.921,0,"NM","PRESCRIBER SEGMENT")

"^DD",9002313.92,9002313.921,0,"UP")
9002313.92
"^DD",9002313.92,9002313.921,.01,0)
PRESCRIBER SEGMENT ORDER^MNJ3,0^^0;1^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.92,9002313.921,.01,1,0)
^.1
"^DD",9002313.92,9002313.921,.01,1,1,0)
9002313.921^B
"^DD",9002313.92,9002313.921,.01,1,1,1)
S ^BPSF(9002313.92,DA(1),150,"B",$E(X,1,30),DA)=""
"^DD",9002313.92,9002313.921,.01,1,1,2)
K ^BPSF(9002313.92,DA(1),150,"B",$E(X,1,30),DA)
"^DD",9002313.92,9002313.921,.01,3)
Type a Number between 1 and 999, 0 Decimal Digits
"^DD",9002313.92,9002313.921,.01,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.921,.01,21,1,0)
Identification of the special event handler.
"^DD",9002313.92,9002313.921,.01,"DT")
3071227
"^DD",9002313.92,9002313.921,.02,0)
NCPDP FIELD NUMBER^P9002313.91'^BPSF(9002313.91,^0;2^Q
"^DD",9002313.92,9002313.921,.02,3)
Select the field number relating to the Prescriber Segment.
"^DD",9002313.92,9002313.921,.02,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.921,.02,21,1,0)
The NCPDP Field to be manipulated.
"^DD",9002313.92,9002313.921,.02,"DT")
3071227
"^DD",9002313.92,9002313.921,.03,0)
PROCESSING MODE^S^D:DEFAULT;S:STANDARD;X:SPECIAL;?:UNKNOWN;^0;3^Q
"^DD",9002313.92,9002313.921,.03,3)
Specify the mode for processing
"^DD",9002313.92,9002313.921,.03,21,0)
^^1^1^3080616^
"^DD",9002313.92,9002313.921,.03,21,1,0)
Which processing mode is in effect for this segment.
"^DD",9002313.92,9002313.921,.03,"DT")
3080616
"^DD",9002313.92,9002313.921,1,0)
SPECIAL CODE^9002313.9211^^1;0
"^DD",9002313.92,9002313.921,1,3)
Enter M code used to create the Prescriber Segment.
"^DD",9002313.92,9002313.921,1,9)
@
"^DD",9002313.92,9002313.921,1,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.921,1,21,1,0)
When Processing Mode "X" is in effect, the special M code to be executed.
"^DD",9002313.92,9002313.921,1,"DT")
3071227
"^DD",9002313.92,9002313.921,2,0)
PROGRAMMING NOTES^9002313.9212^^2;0
"^DD",9002313.92,9002313.921,2,3)
Enter notes relating to the M code.
"^DD",9002313.92,9002313.921,2,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.921,2,21,1,0)
Description of what is being accomplished by executing the special code.
"^DD",9002313.92,9002313.921,2,"DT")
3080616
"^DD",9002313.92,9002313.9211,0)
SPECIAL CODE SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.9211,0,"DT")
3020801
"^DD",9002313.92,9002313.9211,0,"NM","SPECIAL CODE")

"^DD",9002313.92,9002313.9211,0,"UP")
9002313.921
"^DD",9002313.92,9002313.9211,.01,0)
SPECIAL CODE^WL^^0;1^Q
"^DD",9002313.92,9002313.9211,.01,3)
Enter M code used to create the Prescriber Segment.
"^DD",9002313.92,9002313.9211,.01,9)
@
"^DD",9002313.92,9002313.9211,.01,"DT")
3071227
"^DD",9002313.92,9002313.9212,0)
PROGRAMMING NOTES SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.9212,0,"DT")
3020801
"^DD",9002313.92,9002313.9212,0,"NM","PROGRAMMING NOTES")

"^DD",9002313.92,9002313.9212,0,"UP")
9002313.921
"^DD",9002313.92,9002313.9212,.01,0)
PROGRAMMING NOTES^WL^^0;1^Q
"^DD",9002313.92,9002313.9212,.01,3)
Enter notes relating to the M code.
"^DD",9002313.92,9002313.9212,.01,"DT")
3080616
"^DD",9002313.92,9002313.9213,0)
COB OTHER PAYMENTS SEGMENT SUB-FIELD^^2^5
"^DD",9002313.92,9002313.9213,0,"DT")
3031223
"^DD",9002313.92,9002313.9213,0,"IX","B",9002313.9213,.01)

"^DD",9002313.92,9002313.9213,0,"NM","COB OTHER PAYMENTS SEGMENT")

"^DD",9002313.92,9002313.9213,0,"UP")
9002313.92
"^DD",9002313.92,9002313.9213,.01,0)
COB OTHER PAYMENTS ORDER^MNJ3,0^^0;1^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.92,9002313.9213,.01,1,0)
^.1
"^DD",9002313.92,9002313.9213,.01,1,1,0)
9002313.9213^B
"^DD",9002313.92,9002313.9213,.01,1,1,1)
S ^BPSF(9002313.92,DA(1),160,"B",$E(X,1,30),DA)=""
"^DD",9002313.92,9002313.9213,.01,1,1,2)
K ^BPSF(9002313.92,DA(1),160,"B",$E(X,1,30),DA)
"^DD",9002313.92,9002313.9213,.01,3)
Type a Number between 1 and 999, 0 Decimal Digits
"^DD",9002313.92,9002313.9213,.01,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9213,.01,21,1,0)
Identification of the special event handler.
"^DD",9002313.92,9002313.9213,.01,"DT")
3071227
"^DD",9002313.92,9002313.9213,.02,0)
NCPDP FIELD NUMBER^P9002313.91'^BPSF(9002313.91,^0;2^Q
"^DD",9002313.92,9002313.9213,.02,3)
Select the field number relating to the COB Other Payments Segment.
"^DD",9002313.92,9002313.9213,.02,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9213,.02,21,1,0)
The NCPDP Field to be manipulated.
"^DD",9002313.92,9002313.9213,.02,"DT")
3071227
"^DD",9002313.92,9002313.9213,.03,0)
PROCESSING MODE^S^D:DEFAULT;S:STANDARD;X:SPECIAL;?:UNKNOWN;^0;3^Q
"^DD",9002313.92,9002313.9213,.03,3)
Specify the mode for processing
"^DD",9002313.92,9002313.9213,.03,21,0)
^^1^1^3080616^
"^DD",9002313.92,9002313.9213,.03,21,1,0)
Which processing mode is in effect for this segment.
"^DD",9002313.92,9002313.9213,.03,"DT")
3080616
"^DD",9002313.92,9002313.9213,1,0)
SPECIAL CODE^9002313.92131^^1;0
"^DD",9002313.92,9002313.9213,1,3)
Enter M code used to create the COB Other Payments Segment.
"^DD",9002313.92,9002313.9213,1,9)
@
"^DD",9002313.92,9002313.9213,1,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9213,1,21,1,0)
When Processing Mode "X" is in effect, the special M code to be executed.
"^DD",9002313.92,9002313.9213,1,"DT")
3071227
"^DD",9002313.92,9002313.9213,2,0)
PROGRAMMING NOTES^9002313.92132^^2;0
"^DD",9002313.92,9002313.9213,2,3)
Enter notes relating to the M code.
"^DD",9002313.92,9002313.9213,2,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9213,2,21,1,0)
Description of what is being accomplished by executing the special code.
"^DD",9002313.92,9002313.9213,2,"DT")
3071227
"^DD",9002313.92,9002313.92131,0)
SPECIAL CODE SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92131,0,"DT")
3020801
"^DD",9002313.92,9002313.92131,0,"NM","SPECIAL CODE")

"^DD",9002313.92,9002313.92131,0,"UP")
9002313.9213
"^DD",9002313.92,9002313.92131,.01,0)
SPECIAL CODE^WL^^0;1^Q
"^DD",9002313.92,9002313.92131,.01,3)
Enter M code used to create the COB Other Payments Segment.
"^DD",9002313.92,9002313.92131,.01,9)
@
"^DD",9002313.92,9002313.92131,.01,"DT")
3071227
"^DD",9002313.92,9002313.92132,0)
PROGRAMMING NOTES SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92132,0,"DT")
3020801
"^DD",9002313.92,9002313.92132,0,"NM","PROGRAMMING NOTES")

"^DD",9002313.92,9002313.92132,0,"UP")
9002313.9213
"^DD",9002313.92,9002313.92132,.01,0)
PROGRAMMING NOTES^WL^^0;1^Q
"^DD",9002313.92,9002313.92132,.01,3)
Enter notes relating to the M code.
"^DD",9002313.92,9002313.92132,.01,"DT")
3080616
"^DD",9002313.92,9002313.9214,0)
WORKERS COMP SEGMENT SUB-FIELD^^2^5
"^DD",9002313.92,9002313.9214,0,"DT")
3031223
"^DD",9002313.92,9002313.9214,0,"IX","B",9002313.9214,.01)

"^DD",9002313.92,9002313.9214,0,"NM","WORKERS COMP SEGMENT")

"^DD",9002313.92,9002313.9214,0,"UP")
9002313.92
"^DD",9002313.92,9002313.9214,.01,0)
WORKERS COMP SEGMENT ORDER^MNJ3,0^^0;1^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.92,9002313.9214,.01,1,0)
^.1
"^DD",9002313.92,9002313.9214,.01,1,1,0)
9002313.9214^B
"^DD",9002313.92,9002313.9214,.01,1,1,1)
S ^BPSF(9002313.92,DA(1),170,"B",$E(X,1,30),DA)=""
"^DD",9002313.92,9002313.9214,.01,1,1,2)
K ^BPSF(9002313.92,DA(1),170,"B",$E(X,1,30),DA)
"^DD",9002313.92,9002313.9214,.01,3)
Type a Number between 1 and 999, 0 Decimal Digits
"^DD",9002313.92,9002313.9214,.01,21,0)
^^1^1^3080616^
"^DD",9002313.92,9002313.9214,.01,21,1,0)
Identification of the special event handler.
"^DD",9002313.92,9002313.9214,.01,"DT")
3080616
"^DD",9002313.92,9002313.9214,.02,0)
NCPDP FIELD NUMBER^P9002313.91'^BPSF(9002313.91,^0;2^Q
"^DD",9002313.92,9002313.9214,.02,3)
Select the field number relating to the Worker's Comp Segment.
"^DD",9002313.92,9002313.9214,.02,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9214,.02,21,1,0)
The NCPDP Field to be manipulated.
"^DD",9002313.92,9002313.9214,.02,"DT")
3071227
"^DD",9002313.92,9002313.9214,.03,0)
PROCESSING MODE^S^D:DEFAULT;S:STANDARD;X:SPECIAL;?:UNKNOWN;^0;3^Q
"^DD",9002313.92,9002313.9214,.03,3)
Specify the mode for processing
"^DD",9002313.92,9002313.9214,.03,21,0)
^^1^1^3080616^
"^DD",9002313.92,9002313.9214,.03,21,1,0)
Which processing mode is in effect for this segment.
"^DD",9002313.92,9002313.9214,.03,"DT")
3080616
"^DD",9002313.92,9002313.9214,1,0)
SPECIAL CODE^9002313.92141^^1;0
"^DD",9002313.92,9002313.9214,1,3)
Enter M code used to create the Worker's Comp Segment.
"^DD",9002313.92,9002313.9214,1,9)
@
"^DD",9002313.92,9002313.9214,1,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9214,1,21,1,0)
When Processing Mode "X" is in effect, the special M code to be executed.
"^DD",9002313.92,9002313.9214,1,"DT")
3071227
"^DD",9002313.92,9002313.9214,2,0)
PROGRAMMING NOTES^9002313.92142^^2;0
"^DD",9002313.92,9002313.9214,2,3)
Enter notes relating to the M code.
"^DD",9002313.92,9002313.9214,2,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9214,2,21,1,0)
Description of what is being accomplished by executing the special code.
"^DD",9002313.92,9002313.9214,2,"DT")
3071227
"^DD",9002313.92,9002313.92141,0)
SPECIAL CODE SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92141,0,"DT")
3020801
"^DD",9002313.92,9002313.92141,0,"NM","SPECIAL CODE")

"^DD",9002313.92,9002313.92141,0,"UP")
9002313.9214
"^DD",9002313.92,9002313.92141,.01,0)
SPECIAL CODE^WL^^0;1^Q
"^DD",9002313.92,9002313.92141,.01,3)
Enter M code used to create the Worker's Comp Segment.
"^DD",9002313.92,9002313.92141,.01,9)
@
"^DD",9002313.92,9002313.92141,.01,"DT")
3071227
"^DD",9002313.92,9002313.92142,0)
PROGRAMMING NOTES SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92142,0,"DT")
3020801
"^DD",9002313.92,9002313.92142,0,"NM","PROGRAMMING NOTES")

"^DD",9002313.92,9002313.92142,0,"UP")
9002313.9214
"^DD",9002313.92,9002313.92142,.01,0)
PROGRAMMING NOTES^WL^^0;1^Q
"^DD",9002313.92,9002313.92142,.01,3)
Enter notes relating to the M code.
"^DD",9002313.92,9002313.92142,.01,"DT")
3080616
"^DD",9002313.92,9002313.9215,0)
DUR PPS SEGMENT SUB-FIELD^^2^5
"^DD",9002313.92,9002313.9215,0,"DT")
3031223
"^DD",9002313.92,9002313.9215,0,"IX","B",9002313.9215,.01)

"^DD",9002313.92,9002313.9215,0,"NM","DUR PPS SEGMENT")

"^DD",9002313.92,9002313.9215,0,"UP")
9002313.92
"^DD",9002313.92,9002313.9215,.01,0)
DUR PPS SEGMENT ORDER^MNJ3,0^^0;1^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.92,9002313.9215,.01,1,0)
^.1
"^DD",9002313.92,9002313.9215,.01,1,1,0)
9002313.9215^B
"^DD",9002313.92,9002313.9215,.01,1,1,1)
S ^BPSF(9002313.92,DA(1),180,"B",$E(X,1,30),DA)=""
"^DD",9002313.92,9002313.9215,.01,1,1,2)
K ^BPSF(9002313.92,DA(1),180,"B",$E(X,1,30),DA)
"^DD",9002313.92,9002313.9215,.01,3)
Type a Number between 1 and 999, 0 Decimal Digits
"^DD",9002313.92,9002313.9215,.01,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9215,.01,21,1,0)
Identification of the special event handler.
"^DD",9002313.92,9002313.9215,.01,"DT")
3071227
"^DD",9002313.92,9002313.9215,.02,0)
NCPDP FIELD NUMBER^P9002313.91'^BPSF(9002313.91,^0;2^Q
"^DD",9002313.92,9002313.9215,.02,3)
Select the field number relating to the DUR PPS Segment.
"^DD",9002313.92,9002313.9215,.02,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9215,.02,21,1,0)
The NCPDP Field to be manipulated.
"^DD",9002313.92,9002313.9215,.02,"DT")
3071227
"^DD",9002313.92,9002313.9215,.03,0)
PROCESSING MODE^S^D:DEFAULT;S:STANDARD;X:SPECIAL;?:UNKNOWN;^0;3^Q
"^DD",9002313.92,9002313.9215,.03,3)
Specify the mode for processing
"^DD",9002313.92,9002313.9215,.03,21,0)
^^1^1^3080616^
"^DD",9002313.92,9002313.9215,.03,21,1,0)
Which processing mode is in effect for this segment.
"^DD",9002313.92,9002313.9215,.03,"DT")
3080616
"^DD",9002313.92,9002313.9215,1,0)
SPECIAL CODE^9002313.92151^^1;0
"^DD",9002313.92,9002313.9215,1,3)
Enter M code used to create the DUR PPS Segment.
"^DD",9002313.92,9002313.9215,1,9)
@
"^DD",9002313.92,9002313.9215,1,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9215,1,21,1,0)
When Processing Mode "X" is in effect, the special M code to be executed.
"^DD",9002313.92,9002313.9215,1,"DT")
3071227
"^DD",9002313.92,9002313.9215,2,0)
PROGRAMMING NOTES^9002313.92152^^2;0
"^DD",9002313.92,9002313.9215,2,3)
Enter notes relating to the M code.
"^DD",9002313.92,9002313.9215,2,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9215,2,21,1,0)
Description of what is being accomplished by executing the special code.
"^DD",9002313.92,9002313.9215,2,"DT")
3071227
"^DD",9002313.92,9002313.92151,0)
SPECIAL CODE SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92151,0,"DT")
3020801
"^DD",9002313.92,9002313.92151,0,"NM","SPECIAL CODE")

"^DD",9002313.92,9002313.92151,0,"UP")
9002313.9215
"^DD",9002313.92,9002313.92151,.01,0)
SPECIAL CODE^WL^^0;1^Q
"^DD",9002313.92,9002313.92151,.01,3)
Enter M code used to create the DUR PPS Segment.
"^DD",9002313.92,9002313.92151,.01,9)
@
"^DD",9002313.92,9002313.92151,.01,"DT")
3071227
"^DD",9002313.92,9002313.92152,0)
PROGRAMMING NOTES SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92152,0,"DT")
3020801
"^DD",9002313.92,9002313.92152,0,"NM","PROGRAMMING NOTES")

"^DD",9002313.92,9002313.92152,0,"UP")
9002313.9215
"^DD",9002313.92,9002313.92152,.01,0)
PROGRAMMING NOTES^WL^^0;1^Q
"^DD",9002313.92,9002313.92152,.01,3)
Enter notes relating to the M code.
"^DD",9002313.92,9002313.92152,.01,"DT")
3080616
"^DD",9002313.92,9002313.9216,0)
PRICING SEGMENT SUB-FIELD^^2^5
"^DD",9002313.92,9002313.9216,0,"DT")
3031223
"^DD",9002313.92,9002313.9216,0,"IX","B",9002313.9216,.01)

"^DD",9002313.92,9002313.9216,0,"NM","PRICING SEGMENT")

"^DD",9002313.92,9002313.9216,0,"UP")
9002313.92
"^DD",9002313.92,9002313.9216,.01,0)
PRICING SEGMENT ORDER^MNJ3,0^^0;1^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.92,9002313.9216,.01,1,0)
^.1
"^DD",9002313.92,9002313.9216,.01,1,1,0)
9002313.9216^B
"^DD",9002313.92,9002313.9216,.01,1,1,1)
S ^BPSF(9002313.92,DA(1),190,"B",$E(X,1,30),DA)=""
"^DD",9002313.92,9002313.9216,.01,1,1,2)
K ^BPSF(9002313.92,DA(1),190,"B",$E(X,1,30),DA)
"^DD",9002313.92,9002313.9216,.01,3)
Type a Number between 1 and 999, 0 Decimal Digits
"^DD",9002313.92,9002313.9216,.01,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9216,.01,21,1,0)
Identification of the special event handler.
"^DD",9002313.92,9002313.9216,.01,"DT")
3071227
"^DD",9002313.92,9002313.9216,.02,0)
NCPDP FIELD NUMBER^P9002313.91'^BPSF(9002313.91,^0;2^Q
"^DD",9002313.92,9002313.9216,.02,3)
Select the field number relating to the Pricing Segment.
"^DD",9002313.92,9002313.9216,.02,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9216,.02,21,1,0)
The NCPDP Field to be manipulated.
"^DD",9002313.92,9002313.9216,.02,"DT")
3071227
"^DD",9002313.92,9002313.9216,.03,0)
PROCESSING MODE^S^D:DEFAULT;S:STANDARD;X:SPECIAL;?:UNKNOWN;^0;3^Q
"^DD",9002313.92,9002313.9216,.03,3)
Specify the mode for processing
"^DD",9002313.92,9002313.9216,.03,21,0)
^^1^1^3080616^
"^DD",9002313.92,9002313.9216,.03,21,1,0)
Which processing mode is in effect for this segment.
"^DD",9002313.92,9002313.9216,.03,"DT")
3080616
"^DD",9002313.92,9002313.9216,1,0)
SPECIAL CODE^9002313.92161^^1;0
"^DD",9002313.92,9002313.9216,1,3)
Enter M code used to create the Pricing Segment.
"^DD",9002313.92,9002313.9216,1,9)
@
"^DD",9002313.92,9002313.9216,1,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9216,1,21,1,0)
When Processing Mode "X" is in effect, the special M code to be executed.
"^DD",9002313.92,9002313.9216,1,"DT")
3071227
"^DD",9002313.92,9002313.9216,2,0)
PROGRAMMING NOTES^9002313.92162^^2;0
"^DD",9002313.92,9002313.9216,2,3)
Enter notes relating to the M code.
"^DD",9002313.92,9002313.9216,2,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9216,2,21,1,0)
Description of what is being accomplished by executing the special code.
"^DD",9002313.92,9002313.9216,2,"DT")
3071227
"^DD",9002313.92,9002313.92161,0)
SPECIAL CODE SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92161,0,"DT")
3020801
"^DD",9002313.92,9002313.92161,0,"NM","SPECIAL CODE")

"^DD",9002313.92,9002313.92161,0,"UP")
9002313.9216
"^DD",9002313.92,9002313.92161,.01,0)
SPECIAL CODE^WL^^0;1^Q
"^DD",9002313.92,9002313.92161,.01,3)
Enter M code used to create the Pricing Segment.
"^DD",9002313.92,9002313.92161,.01,9)
@
"^DD",9002313.92,9002313.92161,.01,"DT")
3071227
"^DD",9002313.92,9002313.92162,0)
PROGRAMMING NOTES SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92162,0,"DT")
3020801
"^DD",9002313.92,9002313.92162,0,"NM","PROGRAMMING NOTES")

"^DD",9002313.92,9002313.92162,0,"UP")
9002313.9216
"^DD",9002313.92,9002313.92162,.01,0)
PROGRAMMING NOTES^WL^^0;1^Q
"^DD",9002313.92,9002313.92162,.01,3)
Enter notes relating to the M code.
"^DD",9002313.92,9002313.92162,.01,"DT")
3080616
"^DD",9002313.92,9002313.9217,0)
COUPON SEGMENT SUB-FIELD^^2^5
"^DD",9002313.92,9002313.9217,0,"DT")
3031223
"^DD",9002313.92,9002313.9217,0,"IX","B",9002313.9217,.01)

"^DD",9002313.92,9002313.9217,0,"NM","COUPON SEGMENT")

"^DD",9002313.92,9002313.9217,0,"UP")
9002313.92
"^DD",9002313.92,9002313.9217,.01,0)
COUPON SEGMENT ORDER^MNJ3,0^^0;1^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.92,9002313.9217,.01,1,0)
^.1
"^DD",9002313.92,9002313.9217,.01,1,1,0)
9002313.9217^B
"^DD",9002313.92,9002313.9217,.01,1,1,1)
S ^BPSF(9002313.92,DA(1),200,"B",$E(X,1,30),DA)=""
"^DD",9002313.92,9002313.9217,.01,1,1,2)
K ^BPSF(9002313.92,DA(1),200,"B",$E(X,1,30),DA)
"^DD",9002313.92,9002313.9217,.01,3)
Type a Number between 1 and 999, 0 Decimal Digits
"^DD",9002313.92,9002313.9217,.01,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9217,.01,21,1,0)
Identification of the special event handler.
"^DD",9002313.92,9002313.9217,.01,"DT")
3071227
"^DD",9002313.92,9002313.9217,.02,0)
NCPDP FIELD NUMBER^P9002313.91'^BPSF(9002313.91,^0;2^Q
"^DD",9002313.92,9002313.9217,.02,3)
Select the field number relating to the Coupon Segment.
"^DD",9002313.92,9002313.9217,.02,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9217,.02,21,1,0)
The NCPDP Field to be manipulated.
"^DD",9002313.92,9002313.9217,.02,"DT")
3071227
"^DD",9002313.92,9002313.9217,.03,0)
PROCESSING MODE^S^D:DEFAULT;S:STANDARD;X:SPECIAL;?:UNKNOWN;^0;3^Q
"^DD",9002313.92,9002313.9217,.03,3)
Specify the mode for processing
"^DD",9002313.92,9002313.9217,.03,21,0)
^^1^1^3080616^
"^DD",9002313.92,9002313.9217,.03,21,1,0)
Which processing mode is in effect for this segment.
"^DD",9002313.92,9002313.9217,.03,"DT")
3080616
"^DD",9002313.92,9002313.9217,1,0)
SPECIAL CODE^9002313.92171^^1;0
"^DD",9002313.92,9002313.9217,1,3)
Enter M code used to create the Coupon Segment.
"^DD",9002313.92,9002313.9217,1,9)
@
"^DD",9002313.92,9002313.9217,1,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9217,1,21,1,0)
When Processing Mode "X" is in effect, the special M code to be executed.
"^DD",9002313.92,9002313.9217,1,"DT")
3071227
"^DD",9002313.92,9002313.9217,2,0)
PROGRAMMING NOTES^9002313.92172^^2;0
"^DD",9002313.92,9002313.9217,2,3)
Enter notes relating to the M code.
"^DD",9002313.92,9002313.9217,2,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9217,2,21,1,0)
Description of what is being accomplished by executing the special code.
"^DD",9002313.92,9002313.9217,2,"DT")
3071227
"^DD",9002313.92,9002313.92171,0)
SPECIAL CODE SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92171,0,"DT")
3020801
"^DD",9002313.92,9002313.92171,0,"NM","SPECIAL CODE")

"^DD",9002313.92,9002313.92171,0,"UP")
9002313.9217
"^DD",9002313.92,9002313.92171,.01,0)
SPECIAL CODE^WL^^0;1^Q
"^DD",9002313.92,9002313.92171,.01,3)
Enter M code used to create the Coupon Segment.
"^DD",9002313.92,9002313.92171,.01,9)
@
"^DD",9002313.92,9002313.92171,.01,"DT")
3071227
"^DD",9002313.92,9002313.92172,0)
PROGRAMMING NOTES SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92172,0,"DT")
3020801
"^DD",9002313.92,9002313.92172,0,"NM","PROGRAMMING NOTES")

"^DD",9002313.92,9002313.92172,0,"UP")
9002313.9217
"^DD",9002313.92,9002313.92172,.01,0)
PROGRAMMING NOTES^WL^^0;1^Q
"^DD",9002313.92,9002313.92172,.01,3)
Enter notes relating to the M code.
"^DD",9002313.92,9002313.92172,.01,"DT")
3080616
"^DD",9002313.92,9002313.9218,0)
COMPOUND SEGMENT SUB-FIELD^^2^5
"^DD",9002313.92,9002313.9218,0,"DT")
3031223
"^DD",9002313.92,9002313.9218,0,"IX","B",9002313.9218,.01)

"^DD",9002313.92,9002313.9218,0,"NM","COMPOUND SEGMENT")

"^DD",9002313.92,9002313.9218,0,"UP")
9002313.92
"^DD",9002313.92,9002313.9218,.01,0)
COMPOUND SEGMENT ORDER^MNJ3,0^^0;1^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.92,9002313.9218,.01,1,0)
^.1
"^DD",9002313.92,9002313.9218,.01,1,1,0)
9002313.9218^B
"^DD",9002313.92,9002313.9218,.01,1,1,1)
S ^BPSF(9002313.92,DA(1),210,"B",$E(X,1,30),DA)=""
"^DD",9002313.92,9002313.9218,.01,1,1,2)
K ^BPSF(9002313.92,DA(1),210,"B",$E(X,1,30),DA)
"^DD",9002313.92,9002313.9218,.01,3)
Type a Number between 1 and 999, 0 Decimal Digits
"^DD",9002313.92,9002313.9218,.01,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9218,.01,21,1,0)
Identification of the special event handler.
"^DD",9002313.92,9002313.9218,.01,"DT")
3071227
"^DD",9002313.92,9002313.9218,.02,0)
NCPDP FIELD NUMBER^P9002313.91'^BPSF(9002313.91,^0;2^Q
"^DD",9002313.92,9002313.9218,.02,3)
Select the field number relating to the Compound Segment.
"^DD",9002313.92,9002313.9218,.02,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9218,.02,21,1,0)
The NCPDP Field to be manipulated.
"^DD",9002313.92,9002313.9218,.02,"DT")
3071227
"^DD",9002313.92,9002313.9218,.03,0)
PROCESSING MODE^S^D:DEFAULT;S:STANDARD;X:SPECIAL;?:UNKNOWN;^0;3^Q
"^DD",9002313.92,9002313.9218,.03,3)
Specify the mode for processing
"^DD",9002313.92,9002313.9218,.03,21,0)
^^1^1^3080616^
"^DD",9002313.92,9002313.9218,.03,21,1,0)
Which processing mode is in effect for this segment.
"^DD",9002313.92,9002313.9218,.03,"DT")
3080616
"^DD",9002313.92,9002313.9218,1,0)
SPECIAL CODE^9002313.92181^^1;0
"^DD",9002313.92,9002313.9218,1,3)
Enter M code used to create the Compound Segment.
"^DD",9002313.92,9002313.9218,1,9)
@
"^DD",9002313.92,9002313.9218,1,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9218,1,21,1,0)
When Processing Mode "X" is in effect, the special M code to be executed.
"^DD",9002313.92,9002313.9218,1,"DT")
3071227
"^DD",9002313.92,9002313.9218,2,0)
PROGRAMMING NOTES^9002313.92182^^2;0
"^DD",9002313.92,9002313.9218,2,3)
Enter notes relating to the M code.
"^DD",9002313.92,9002313.9218,2,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9218,2,21,1,0)
Description of what is being accomplished by executing the special code.
"^DD",9002313.92,9002313.9218,2,"DT")
3071227
"^DD",9002313.92,9002313.92181,0)
SPECIAL CODE SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92181,0,"DT")
3020801
"^DD",9002313.92,9002313.92181,0,"NM","SPECIAL CODE")

"^DD",9002313.92,9002313.92181,0,"UP")
9002313.9218
"^DD",9002313.92,9002313.92181,.01,0)
SPECIAL CODE^WL^^0;1^Q
"^DD",9002313.92,9002313.92181,.01,3)
Enter M code used to create the Compound Segment.
"^DD",9002313.92,9002313.92181,.01,9)
@
"^DD",9002313.92,9002313.92181,.01,"DT")
3071227
"^DD",9002313.92,9002313.92182,0)
PROGRAMMING NOTES SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92182,0,"DT")
3020801
"^DD",9002313.92,9002313.92182,0,"NM","PROGRAMMING NOTES")

"^DD",9002313.92,9002313.92182,0,"UP")
9002313.9218
"^DD",9002313.92,9002313.92182,.01,0)
PROGRAMMING NOTES^WL^^0;1^Q
"^DD",9002313.92,9002313.92182,.01,3)
Enter notes relating to the M code.
"^DD",9002313.92,9002313.92182,.01,"DT")
3080616
"^DD",9002313.92,9002313.9219,0)
PRIOR AUTH SEGMENT SUB-FIELD^^2^5
"^DD",9002313.92,9002313.9219,0,"DT")
3031223
"^DD",9002313.92,9002313.9219,0,"IX","B",9002313.9219,.01)

"^DD",9002313.92,9002313.9219,0,"NM","PRIOR AUTH SEGMENT")

"^DD",9002313.92,9002313.9219,0,"UP")
9002313.92
"^DD",9002313.92,9002313.9219,.01,0)
PRIOR AUTH SEGMENT ORDER^MNJ3,0^^0;1^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.92,9002313.9219,.01,1,0)
^.1
"^DD",9002313.92,9002313.9219,.01,1,1,0)
9002313.9219^B
"^DD",9002313.92,9002313.9219,.01,1,1,1)
S ^BPSF(9002313.92,DA(1),220,"B",$E(X,1,30),DA)=""
"^DD",9002313.92,9002313.9219,.01,1,1,2)
K ^BPSF(9002313.92,DA(1),220,"B",$E(X,1,30),DA)
"^DD",9002313.92,9002313.9219,.01,3)
Type a Number between 1 and 999, 0 Decimal Digits
"^DD",9002313.92,9002313.9219,.01,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9219,.01,21,1,0)
Identification of the special event handler.
"^DD",9002313.92,9002313.9219,.01,"DT")
3071227
"^DD",9002313.92,9002313.9219,.02,0)
NCPDP FIELD NUMBER^P9002313.91'^BPSF(9002313.91,^0;2^Q
"^DD",9002313.92,9002313.9219,.02,3)
Select the field number relating to the Prior Auth Segment.
"^DD",9002313.92,9002313.9219,.02,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9219,.02,21,1,0)
The NCPDP Field to be manipulated.
"^DD",9002313.92,9002313.9219,.02,"DT")
3071227
"^DD",9002313.92,9002313.9219,.03,0)
PROCESSING MODE^S^D:DEFAULT;S:STANDARD;X:SPECIAL;?:UNKNOWN;^0;3^Q
"^DD",9002313.92,9002313.9219,.03,3)
Specify the mode for processing
"^DD",9002313.92,9002313.9219,.03,21,0)
^^1^1^3080616^
"^DD",9002313.92,9002313.9219,.03,21,1,0)
Which processing mode is in effect for this segment.
"^DD",9002313.92,9002313.9219,.03,"DT")
3080616
"^DD",9002313.92,9002313.9219,1,0)
SPECIAL CODE^9002313.92191^^1;0
"^DD",9002313.92,9002313.9219,1,3)
Enter M code used to create the Prior Auth Segment.
"^DD",9002313.92,9002313.9219,1,9)
@
"^DD",9002313.92,9002313.9219,1,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9219,1,21,1,0)
When Processing Mode "X" is in effect, the special M code to be executed.
"^DD",9002313.92,9002313.9219,1,"DT")
3071227
"^DD",9002313.92,9002313.9219,2,0)
PROGRAMMING NOTES^9002313.92192^^2;0
"^DD",9002313.92,9002313.9219,2,3)
Enter notes relating to the M code.
"^DD",9002313.92,9002313.9219,2,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.9219,2,21,1,0)
Description of what is being accomplished by executing the special code.
"^DD",9002313.92,9002313.9219,2,"DT")
3071227
"^DD",9002313.92,9002313.921901,0)
DEVELOPMENT REMARKS SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.921901,0,"DT")
3010112
"^DD",9002313.92,9002313.921901,0,"NM","DEVELOPMENT REMARKS")

"^DD",9002313.92,9002313.921901,0,"UP")
9002313.92
"^DD",9002313.92,9002313.921901,.01,0)
DEVELOPMENT REMARKS^WL^^0;1^Q
"^DD",9002313.92,9002313.921901,.01,3)
Enter general remarks relating to this segment.
"^DD",9002313.92,9002313.921901,.01,"DT")
3071227
"^DD",9002313.92,9002313.92191,0)
SPECIAL CODE SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92191,0,"DT")
3020801
"^DD",9002313.92,9002313.92191,0,"NM","SPECIAL CODE")

"^DD",9002313.92,9002313.92191,0,"UP")
9002313.9219
"^DD",9002313.92,9002313.92191,.01,0)
SPECIAL CODE^WL^^0;1^Q
"^DD",9002313.92,9002313.92191,.01,3)
Enter M code used to create the Prior Auth Segment.
"^DD",9002313.92,9002313.92191,.01,9)
@
"^DD",9002313.92,9002313.92191,.01,"DT")
3071227
"^DD",9002313.92,9002313.92192,0)
PROGRAMMING NOTES SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.92192,0,"DT")
3020801
"^DD",9002313.92,9002313.92192,0,"NM","PROGRAMMING NOTES")

"^DD",9002313.92,9002313.92192,0,"UP")
9002313.9219
"^DD",9002313.92,9002313.92192,.01,0)
PROGRAMMING NOTES^WL^^0;1^Q
"^DD",9002313.92,9002313.92192,.01,3)
Enter notes relating to the M code.
"^DD",9002313.92,9002313.92192,.01,"DT")
3080616
"^DD",9002313.92,9002313.922,0)
CLINICAL SEGMENT SUB-FIELD^^2^5
"^DD",9002313.92,9002313.922,0,"DT")
3031223
"^DD",9002313.92,9002313.922,0,"IX","B",9002313.922,.01)

"^DD",9002313.92,9002313.922,0,"NM","CLINICAL SEGMENT")

"^DD",9002313.92,9002313.922,0,"UP")
9002313.92
"^DD",9002313.92,9002313.922,.01,0)
CLINICAL SEGMENT ORDER^MNJ3,0^^0;1^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",9002313.92,9002313.922,.01,1,0)
^.1
"^DD",9002313.92,9002313.922,.01,1,1,0)
9002313.922^B
"^DD",9002313.92,9002313.922,.01,1,1,1)
S ^BPSF(9002313.92,DA(1),230,"B",$E(X,1,30),DA)=""
"^DD",9002313.92,9002313.922,.01,1,1,2)
K ^BPSF(9002313.92,DA(1),230,"B",$E(X,1,30),DA)
"^DD",9002313.92,9002313.922,.01,3)
Type a Number between 1 and 999, 0 Decimal Digits
"^DD",9002313.92,9002313.922,.01,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.922,.01,21,1,0)
Identification of the special event handler.
"^DD",9002313.92,9002313.922,.01,"DT")
3071227
"^DD",9002313.92,9002313.922,.02,0)
NCPDP FIELD NUMBER^P9002313.91'^BPSF(9002313.91,^0;2^Q
"^DD",9002313.92,9002313.922,.02,3)
Select the field number relating to the Clinical Segment.
"^DD",9002313.92,9002313.922,.02,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.922,.02,21,1,0)
The NCPDP Field to be manipulated.
"^DD",9002313.92,9002313.922,.02,"DT")
3071227
"^DD",9002313.92,9002313.922,.03,0)
PROCESSING MODE^S^D:DEFAULT;S:STANDARD;X:SPECIAL;?:UNKNOWN;^0;3^Q
"^DD",9002313.92,9002313.922,.03,3)
Specify the mode for processing
"^DD",9002313.92,9002313.922,.03,21,0)
^^1^1^3080616^
"^DD",9002313.92,9002313.922,.03,21,1,0)
Which processing mode is in effect for this segment.
"^DD",9002313.92,9002313.922,.03,"DT")
3080616
"^DD",9002313.92,9002313.922,1,0)
SPECIAL CODE^9002313.9221^^1;0
"^DD",9002313.92,9002313.922,1,3)
Enter M code used to create the Clinical Segment.
"^DD",9002313.92,9002313.922,1,9)
@
"^DD",9002313.92,9002313.922,1,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.922,1,21,1,0)
When Processing Mode "X" is in effect, the special M code to be executed.
"^DD",9002313.92,9002313.922,1,"DT")
3071227
"^DD",9002313.92,9002313.922,2,0)
PROGRAMMING NOTES^9002313.9222^^2;0
"^DD",9002313.92,9002313.922,2,3)
Enter notes relating to the M code.
"^DD",9002313.92,9002313.922,2,21,0)
^^1^1^3040220^
"^DD",9002313.92,9002313.922,2,21,1,0)
Description of what is being accomplished by executing the special code.
"^DD",9002313.92,9002313.922,2,"DT")
3071227
"^DD",9002313.92,9002313.9221,0)
SPECIAL CODE SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.9221,0,"DT")
3020801
"^DD",9002313.92,9002313.9221,0,"NM","SPECIAL CODE")

"^DD",9002313.92,9002313.9221,0,"UP")
9002313.922
"^DD",9002313.92,9002313.9221,.01,0)
SPECIAL CODE^WL^^0;1^Q
"^DD",9002313.92,9002313.9221,.01,3)
Enter M code used to create the Clinical Segment.
"^DD",9002313.92,9002313.9221,.01,9)
@
"^DD",9002313.92,9002313.9221,.01,"DT")
3071227
"^DD",9002313.92,9002313.9222,0)
PROGRAMMING NOTES SUB-FIELD^^.01^1
"^DD",9002313.92,9002313.9222,0,"DT")
3020801
"^DD",9002313.92,9002313.9222,0,"NM","PROGRAMMING NOTES")

"^DD",9002313.92,9002313.9222,0,"UP")
9002313.922
"^DD",9002313.92,9002313.9222,.01,0)
PROGRAMMING NOTES^WL^^0;1^Q
"^DD",9002313.92,9002313.9222,.01,3)
Enter notes relating to the M code.
"^DD",9002313.92,9002313.9222,.01,"DT")
3080616
"^DD",9002313.93,9002313.93,0)
FIELD^^.02^2
"^DD",9002313.93,9002313.93,0,"DDA")
N
"^DD",9002313.93,9002313.93,0,"DT")
3030820
"^DD",9002313.93,9002313.93,0,"ID",.02)
W "   ",$P(^(0),U,2)
"^DD",9002313.93,9002313.93,0,"IX","B",9002313.93,.01)

"^DD",9002313.93,9002313.93,0,"NM","BPS NCPDP REJECT CODES")

"^DD",9002313.93,9002313.93,0,"PT",52.8651,.01)

"^DD",9002313.93,9002313.93,0,"PT",350.912,.01)

"^DD",9002313.93,9002313.93,0,"PT",366.16,.03)

"^DD",9002313.93,9002313.93,0,"PT",9002313.321,.01)

"^DD",9002313.93,9002313.93,0,"VRPK")
BPS
"^DD",9002313.93,9002313.93,.01,0)
CODE^RF^^0;1^K:$L(X)>3!($L(X)<2) X
"^DD",9002313.93,9002313.93,.01,1,0)
^.1
"^DD",9002313.93,9002313.93,.01,1,1,0)
9002313.93^B
"^DD",9002313.93,9002313.93,.01,1,1,1)
S ^BPSF(9002313.93,"B",$E(X,1,30),DA)=""
"^DD",9002313.93,9002313.93,.01,1,1,2)
K ^BPSF(9002313.93,"B",$E(X,1,30),DA)
"^DD",9002313.93,9002313.93,.01,3)
Enter the Reject Code that is returned from the payer.
"^DD",9002313.93,9002313.93,.01,21,0)
^^2^2^3080529^
"^DD",9002313.93,9002313.93,.01,21,1,0)
Reject Code returned by the payer for the reason of the rejection.  This
"^DD",9002313.93,9002313.93,.01,21,2,0)
is based on the NCPDP standards.
"^DD",9002313.93,9002313.93,.01,"DT")
3080529
"^DD",9002313.93,9002313.93,.02,0)
EXPLANATION^F^^0;2^K:$L(X)>70!($L(X)<1) X
"^DD",9002313.93,9002313.93,.02,3)
Enter the description of the reject code.
"^DD",9002313.93,9002313.93,.02,21,0)
^^1^1^3080529^
"^DD",9002313.93,9002313.93,.02,21,1,0)
Textual explanation of the claim rejection.
"^DD",9002313.93,9002313.93,.02,"DT")
3080529
"^DD",9002313.99,9002313.99,0)
FIELD^^.07^15
"^DD",9002313.99,9002313.99,0,"DDA")
N
"^DD",9002313.99,9002313.99,0,"DT")
3080312
"^DD",9002313.99,9002313.99,0,"IX","B",9002313.99,.01)

"^DD",9002313.99,9002313.99,0,"NM","BPS SETUP")

"^DD",9002313.99,9002313.99,0,"VRPK")
BPS
"^DD",9002313.99,9002313.99,.01,0)
NAME^RF^^0;1^K:$L(X)>30!($L(X)<3)!'(X'?1P.E) X
"^DD",9002313.99,9002313.99,.01,1,0)
^.1
"^DD",9002313.99,9002313.99,.01,1,1,0)
9002313.99^B
"^DD",9002313.99,9002313.99,.01,1,1,1)
S ^BPS(9002313.99,"B",$E(X,1,30),DA)=""
"^DD",9002313.99,9002313.99,.01,1,1,2)
K ^BPS(9002313.99,"B",$E(X,1,30),DA)
"^DD",9002313.99,9002313.99,.01,3)
Answer must be 3-30 characters in length.
"^DD",9002313.99,9002313.99,.01,"DT")
3071226
"^DD",9002313.99,9002313.99,.04,0)
DATE SITE LAST REGISTERED^D^^0;4^S %DT="ESTXR" D ^%DT S X=Y K:X<1 X
"^DD",9002313.99,9002313.99,.04,3)
Enter the date/time the site was last registered.
"^DD",9002313.99,9002313.99,.04,21,0)
^^3^3^3080618^
"^DD",9002313.99,9002313.99,.04,21,1,0)
This is automatically populated every time the site is registered.  The 
"^DD",9002313.99,9002313.99,.04,21,2,0)
date/time in this field is the last time a registration message was 
"^DD",9002313.99,9002313.99,.04,21,3,0)
transmitted to Austin for this site.
"^DD",9002313.99,9002313.99,.04,"DT")
3080619
"^DD",9002313.99,9002313.99,.05,0)
INSURER ASLEEP INTERVAL^RNJ2,0^^0;5^K:+X'=X!(X>29)!(X<0)!(X?.E1"."1.N) X
"^DD",9002313.99,9002313.99,.05,3)
Enter a number of minutes 0-29 to retry Asleep claims.
"^DD",9002313.99,9002313.99,.05,21,0)
^^4^4^3071206^
"^DD",9002313.99,9002313.99,.05,21,1,0)
This is the number of minutes to retry claims for a payer sheet while the 
"^DD",9002313.99,9002313.99,.05,21,2,0)
payer is identified as being unavailable to process claims.
"^DD",9002313.99,9002313.99,.05,21,3,0)
 
"^DD",9002313.99,9002313.99,.05,21,4,0)
0 = do not implement asleep processes.
"^DD",9002313.99,9002313.99,.05,"DT")
3071206
"^DD",9002313.99,9002313.99,.06,0)
INSURER ASLEEP RETRIES^RNJ2,0^^0;6^K:+X'=X!(X>99)!(X<0)!(X?.E1"."1.N) X
"^DD",9002313.99,9002313.99,.06,3)
Enter the number of times retries should occur of a payer 0-99.
"^DD",9002313.99,9002313.99,.06,21,0)
^^4^4^3071206^
"^DD",9002313.99,9002313.99,.06,21,1,0)
This is the number of times an asleep probe should be done on a payer 
"^DD",9002313.99,9002313.99,.06,21,2,0)
before the claims are marked as Rejected.
"^DD",9002313.99,9002313.99,.06,21,3,0)
 
"^DD",9002313.99,9002313.99,.06,21,4,0)
0 = Asleep process turned off
"^DD",9002313.99,9002313.99,.06,"DT")
3071206
"^DD",9002313.99,9002313.99,.07,0)
DATE SITE LAST CONFIRMED^D^^0;7^S %DT="ESTXR" D ^%DT S X=Y K:X<1 X
"^DD",9002313.99,9002313.99,.07,3)
Enter the date/time the site registration was last accepted
"^DD",9002313.99,9002313.99,.07,21,0)
^^3^3^3080618^
"^DD",9002313.99,9002313.99,.07,21,1,0)
This field is populated every time the site is confirmed registered by 
"^DD",9002313.99,9002313.99,.07,21,2,0)
Austin.  This is automatically populated when the application ACK message
"^DD",9002313.99,9002313.99,.07,21,3,0)
is returned from Austin.
"^DD",9002313.99,9002313.99,.07,"DT")
3080619
"^DD",9002313.99,9002313.99,3.01,0)
ECME TIMEOUT^RNJ2,0^^0;2^K:+X'=X!(X>30)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.99,9002313.99,3.01,3)
Type a Whole Number between 0 and 30.
"^DD",9002313.99,9002313.99,3.01,21,0)
^^3^3^3080212^
"^DD",9002313.99,9002313.99,3.01,21,1,0)
This is the maximum number of seconds used for the display of the claims
"^DD",9002313.99,9002313.99,3.01,21,2,0)
processing status.  After this time, claims processing will continue but
"^DD",9002313.99,9002313.99,3.01,21,3,0)
the user will not see messages indicating the progress of the claim.
"^DD",9002313.99,9002313.99,3.01,"DT")
3080212
"^DD",9002313.99,9002313.99,3.02,0)
PAYER RESPONSE TEST MODE^S^1:ON;0:OFF;^0;3^Q
"^DD",9002313.99,9002313.99,3.02,3)
Set this to On to enable payer overrides.  Do not enable at production sites.
"^DD",9002313.99,9002313.99,3.02,21,0)
^^2^2^3080212^
"^DD",9002313.99,9002313.99,3.02,21,1,0)
This field enables the testing of Payer Response Overrides - 1 for On, 0 
"^DD",9002313.99,9002313.99,3.02,21,2,0)
(or "") for Off.  This should never be ON at a production site.
"^DD",9002313.99,9002313.99,3.02,"DT")
3080212
"^DD",9002313.99,9002313.99,2341.01,0)
WINNOW TESTING FLAG^S^0:NO;1:YES;^WINNOW;1^Q
"^DD",9002313.99,9002313.99,2341.01,3)
Enter 'YES' to enable WINNOW TEST mode, 'NO' to purge
"^DD",9002313.99,9002313.99,2341.01,21,0)
^^2^2^3070131^
"^DD",9002313.99,9002313.99,2341.01,21,1,0)
This flag controls whether purging is really done or just in test mode.  
"^DD",9002313.99,9002313.99,2341.01,21,2,0)
YES sets test mode on and NO enables purging.
"^DD",9002313.99,9002313.99,2341.01,"DT")
3070131
"^DD",9002313.99,9002313.99,2341.03,0)
WINNOW BPS LOG^NJ4,0^^WINNOW;3^K:+X'=X!(X>9999)!(X<0)!(X?.E1"."1.N) X
"^DD",9002313.99,9002313.99,2341.03,3)
Enter the days of the BPS LOG to keep on the system (0-9999).
"^DD",9002313.99,9002313.99,2341.03,21,0)
^^1^1^3080618^
"^DD",9002313.99,9002313.99,2341.03,21,1,0)
Number of days of the BPS LOG to keep on the system.
"^DD",9002313.99,9002313.99,2341.03,"DT")
3080618
"^DD",9002313.99,9002313.99,2500,0)
CERTIFIER^P200'^VA(200,^CERTIFIER;1^Q
"^DD",9002313.99,9002313.99,2500,3)
Enter the name of the person performing certification.
"^DD",9002313.99,9002313.99,2500,21,0)
^^1^1^3080618^
"^DD",9002313.99,9002313.99,2500,21,1,0)
Contains the name of the person performing certification.
"^DD",9002313.99,9002313.99,2500,"DT")
3080618
"^DD",9002313.99,9002313.99,6000,0)
SITE CONTACT^P200'^VA(200,^VITRIA;1^Q
"^DD",9002313.99,9002313.99,6000,3)
Enter the Site Contact for Vitria.
"^DD",9002313.99,9002313.99,6000,21,0)
^^1^1^3080212^
"^DD",9002313.99,9002313.99,6000,21,1,0)
This is the Site Contact for Vitria.  Usually an IT staff person.
"^DD",9002313.99,9002313.99,6000,"DT")
3080212
"^DD",9002313.99,9002313.99,6001,0)
ALTERNATE SITE CONTACT^P200'^VA(200,^VITRIA;2^Q
"^DD",9002313.99,9002313.99,6001,3)
Enter the Alternate Site Contact.
"^DD",9002313.99,9002313.99,6001,21,0)
^^2^2^3080212^
"^DD",9002313.99,9002313.99,6001,21,1,0)
This is the name of the Alternate Contact person for the site in relation 
"^DD",9002313.99,9002313.99,6001,21,2,0)
to Vitria.
"^DD",9002313.99,9002313.99,6001,"DT")
3080212
"^DD",9002313.99,9002313.99,6003,0)
VITRIA INTERFACE VERSION^F^^VITRIA;3^K:$L(X)>35!($L(X)<1) X
"^DD",9002313.99,9002313.99,6003,3)
Answer must be 1-35 characters in length.
"^DD",9002313.99,9002313.99,6003,21,0)
^^1^1^3080212^
"^DD",9002313.99,9002313.99,6003,21,1,0)
Enter the Vitria supplied interface version number.
"^DD",9002313.99,9002313.99,6003,"DT")
3080212
"^DD",9002313.99,9002313.99,9999,0)
SITE TYPE^RS^0:VA;1:IHS;^SITE TYPE;1^Q
"^DD",9002313.99,9002313.99,9999,3)
Enter 0 (zero) for VA or 1 for IHS.
"^DD",9002313.99,9002313.99,9999,21,0)
^^4^4^3080212^
"^DD",9002313.99,9002313.99,9999,21,1,0)
This field is used to determine whether the site is a Veterans
"^DD",9002313.99,9002313.99,9999,21,2,0)
Administration site or and Indian Health Services Site.  Based on this 
"^DD",9002313.99,9002313.99,9999,21,3,0)
answer, the ECME system will process in two different manners with respect
"^DD",9002313.99,9002313.99,9999,21,4,0)
to claims generation and data collection methods.
"^DD",9002313.99,9002313.99,9999,"DT")
3080212
"^DD",9002313.99,9002313.99,10000,0)
LAST SEQUENCE^NJ10,0^^3;1^K:+X'=X!(X>9999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",9002313.99,9002313.99,10000,3)
Type a Number between 0 and 9999999999, 0 Decimal Digits
"^DD",9002313.99,9002313.99,10000,21,0)
^^2^2^3080618^
"^DD",9002313.99,9002313.99,10000,21,1,0)
Used to sequence the transmission ID's to ensure they are unique for the 
"^DD",9002313.99,9002313.99,10000,21,2,0)
site.
"^DD",9002313.99,9002313.99,10000,"DT")
3080618
"^DIC",9002313.02,9002313.02,0)
BPS CLAIMS^9002313.02
"^DIC",9002313.02,9002313.02,0,"GL")
^BPSC(
"^DIC",9002313.02,9002313.02,"%",0)
^1.005^^0
"^DIC",9002313.02,9002313.02,"%","B","ABSP",1)

"^DIC",9002313.02,9002313.02,"%D",0)
^^16^16^3080604^
"^DIC",9002313.02,9002313.02,"%D",1,0)
Intermediate form of claims.  Fields are stored in formatted form.  Raw 
"^DIC",9002313.02,9002313.02,"%D",2,0)
packet is also stored.
"^DIC",9002313.02,9002313.02,"%D",3,0)
 
"^DIC",9002313.02,9002313.02,"%D",4,0)
Most fields are in Free Text format to accommodate NCPDP Standard 
"^DIC",9002313.02,9002313.02,"%D",5,0)
formatting criteria and required field lengths.  Fields other than those 
"^DIC",9002313.02,9002313.02,"%D",6,0)
with decimals in the number correlate directly to the field numbers 
"^DIC",9002313.02,9002313.02,"%D",7,0)
supplied in the NCPDP Data Dictionary.
"^DIC",9002313.02,9002313.02,"%D",8,0)
 
"^DIC",9002313.02,9002313.02,"%D",9,0)
While many of the fields in this file indicate coded values, they are 
"^DIC",9002313.02,9002313.02,"%D",10,0)
NCPDP coded values proceeded with the NCPDP field identifier to be used 
"^DIC",9002313.02,9002313.02,"%D",11,0)
in the NCPDP transmission.  Example:  Compound Code is either a 1 or 0.  
"^DIC",9002313.02,9002313.02,"%D",12,0)
The NCPDP field identifier for 'Compound Code' is 'D6'.  The field length 
"^DIC",9002313.02,9002313.02,"%D",13,0)
is 3 thereby allowing the identifier for that field to be included in the 
"^DIC",9002313.02,9002313.02,"%D",14,0)
data stored in that field.  Such as 'D61' for the data stored.
"^DIC",9002313.02,9002313.02,"%D",15,0)
 
"^DIC",9002313.02,9002313.02,"%D",16,0)
Per VHA Directive 2004-038, this file definition should not be modified.
"^DIC",9002313.02,"B","BPS CLAIMS",9002313.02)

"^DIC",9002313.03,9002313.03,0)
BPS RESPONSES^9002313.03P
"^DIC",9002313.03,9002313.03,0,"GL")
^BPSR(
"^DIC",9002313.03,9002313.03,"%",0)
^1.005^^0
"^DIC",9002313.03,9002313.03,"%","B","ABSP",1)

"^DIC",9002313.03,9002313.03,"%D",0)
^^4^4^3080207^
"^DIC",9002313.03,9002313.03,"%D",1,0)
Intermediate form of responses to claims. Data is stored in formatted
"^DIC",9002313.03,9002313.03,"%D",2,0)
form, as received from insurer. Raw data packet may also be present.
"^DIC",9002313.03,9002313.03,"%D",3,0)
 
"^DIC",9002313.03,9002313.03,"%D",4,0)
Per VHA Directive 2004-038, this file definition should not be modified.
"^DIC",9002313.03,"B","BPS RESPONSES",9002313.03)

"^DIC",9002313.15,9002313.15,0)
BPS ASLEEP PAYERS^9002313.15
"^DIC",9002313.15,9002313.15,0,"GL")
^BPS(9002313.15,
"^DIC",9002313.15,9002313.15,"%",0)
^1.005^^0
"^DIC",9002313.15,9002313.15,"%D",0)
^^5^5^3071207^
"^DIC",9002313.15,9002313.15,"%D",1,0)
This file is used to store payers that are asleep or should be ignored 
"^DIC",9002313.15,9002313.15,"%D",2,0)
because they are asleep.  Generally there should be few or no entries in 
"^DIC",9002313.15,9002313.15,"%D",3,0)
this file unless there are payers that are asleep.
"^DIC",9002313.15,9002313.15,"%D",4,0)
 
"^DIC",9002313.15,9002313.15,"%D",5,0)
Per VHA Directive 2004-038, this file definition should not be modified.
"^DIC",9002313.15,"B","BPS ASLEEP PAYERS",9002313.15)

"^DIC",9002313.25,9002313.25,0)
BPS NCPDP CLARIFICATION CODES^9002313.25
"^DIC",9002313.25,9002313.25,0,"GL")
^BPS(9002313.25,
"^DIC",9002313.25,9002313.25,"%",0)
^1.005^^0
"^DIC",9002313.25,9002313.25,"%D",0)
^^6^6^3080521^
"^DIC",9002313.25,9002313.25,"%D",1,0)
This file is used to store the possible NCPDP CLARIFICATION CODES values,
"^DIC",9002313.25,9002313.25,"%D",2,0)
which are used for overriding DUR rejects.  No local changes should ever 
"^DIC",9002313.25,9002313.25,"%D",3,0)
be made to this file.  The data stored in this file are based on the 
"^DIC",9002313.25,9002313.25,"%D",4,0)
NCPDP standards and are nationally distributed.
"^DIC",9002313.25,9002313.25,"%D",5,0)
 
"^DIC",9002313.25,9002313.25,"%D",6,0)
Per VHA Directive 2004-038, this file definition should not be modified.
"^DIC",9002313.25,"B","BPS NCPDP CLARIFICATION CODES",9002313.25)

"^DIC",9002313.26,9002313.26,0)
BPS NCPDP PRIOR AUTHORIZATION TYPE CODE^9002313.26
"^DIC",9002313.26,9002313.26,0,"GL")
^BPS(9002313.26,
"^DIC",9002313.26,9002313.26,"%",0)
^1.005^^0
"^DIC",9002313.26,9002313.26,"%D",0)
^^5^5^3080312^
"^DIC",9002313.26,9002313.26,"%D",1,0)
This file comes pre-populated with standard NPCPDP prior authorization 
"^DIC",9002313.26,9002313.26,"%D",2,0)
data to be used in submitting claims.  The file and data should never be 
"^DIC",9002313.26,9002313.26,"%D",3,0)
locally modified, edited or changed.
"^DIC",9002313.26,9002313.26,"%D",4,0)
 
"^DIC",9002313.26,9002313.26,"%D",5,0)
Per VHA Directive 2004-038, this file definition should not be modified.
"^DIC",9002313.26,"B","BPS NCPDP PRIOR AUTHORIZATION TYPE CODE",9002313.26)

"^DIC",9002313.56,9002313.56,0)
BPS PHARMACIES^9002313.56
"^DIC",9002313.56,9002313.56,0,"GL")
^BPS(9002313.56,
"^DIC",9002313.56,9002313.56,"%",0)
^1.005^^0
"^DIC",9002313.56,9002313.56,"%","B","ABSP",1)

"^DIC",9002313.56,9002313.56,"%D",0)
^^4^4^3080515^
"^DIC",9002313.56,9002313.56,"%D",1,0)
Pharmacy-specific data -- NCPDP #, default DEA #, etc.  One BPS PHARMACY
"^DIC",9002313.56,9002313.56,"%D",2,0)
has a list of one or more OUTPATIENT SITES (file 59).
"^DIC",9002313.56,9002313.56,"%D",3,0)
 
"^DIC",9002313.56,9002313.56,"%D",4,0)
Per VHA Directive 2004-038, this file definition should not be modified.
"^DIC",9002313.56,"B","BPS PHARMACIES",9002313.56)

"^DIC",9002313.57,9002313.57,0)
BPS LOG OF TRANSACTIONS^9002313.57
"^DIC",9002313.57,9002313.57,0,"GL")
^BPSTL(
"^DIC",9002313.57,9002313.57,"%",0)
^1.005^^0
"^DIC",9002313.57,9002313.57,"%","B","ABSP",1)

"^DIC",9002313.57,9002313.57,"%D",0)
^^4^4^3080212^
"^DIC",9002313.57,9002313.57,"%D",1,0)
A copy of 9002313.59.  As each transaction completes, a snapshot of 
"^DIC",9002313.57,9002313.57,"%D",2,0)
9002313.59 entry is placed here in 9002313.57.
"^DIC",9002313.57,9002313.57,"%D",3,0)
 
"^DIC",9002313.57,9002313.57,"%D",4,0)
Per VHA Directive 2004-038, this file definition should not be modified.
"^DIC",9002313.57,"B","BPS LOG OF TRANSACTIONS",9002313.57)

"^DIC",9002313.59,9002313.59,0)
BPS TRANSACTION^9002313.59
"^DIC",9002313.59,9002313.59,0,"GL")
^BPST(
"^DIC",9002313.59,9002313.59,"%",0)
^1.005^^0
"^DIC",9002313.59,9002313.59,"%","B","ABSP",1)

"^DIC",9002313.59,9002313.59,"%D",0)
^^4^4^3080102^
"^DIC",9002313.59,9002313.59,"%D",1,0)
Transactions in progress.  When complete (status 99), a copy of the record
"^DIC",9002313.59,9002313.59,"%D",2,0)
is placed in 9002313.57.
"^DIC",9002313.59,9002313.59,"%D",3,0)
 
"^DIC",9002313.59,9002313.59,"%D",4,0)
Per VHA Directive 2004-038, this file definition should not be modified.
"^DIC",9002313.59,"B","BPS TRANSACTION",9002313.59)

"^DIC",9002313.77,9002313.77,0)
BPS REQUESTS^9002313.77
"^DIC",9002313.77,9002313.77,0,"GL")
^BPS(9002313.77,
"^DIC",9002313.77,9002313.77,"%",0)
^1.005^^0
"^DIC",9002313.77,9002313.77,"%D",0)
^^9^9^3080623^
"^DIC",9002313.77,9002313.77,"%D",1,0)
This file is used to store data for queued requests before the ECME 
"^DIC",9002313.77,9002313.77,"%D",2,0)
engine un-queues them and during their processing. The data stored in this
"^DIC",9002313.77,9002313.77,"%D",3,0)
file are used to create a record in BPS TRANSACTION file (#9002313.59) to 
"^DIC",9002313.77,9002313.77,"%D",4,0)
build a claim request or reversal and send it to the insurer (payer).  
"^DIC",9002313.77,9002313.77,"%D",5,0)
Generally there should be few or no entries in this file unless there are 
"^DIC",9002313.77,9002313.77,"%D",6,0)
stranded claims/reversal or requests that need to be un-stranded by the 
"^DIC",9002313.77,9002313.77,"%D",7,0)
user.
"^DIC",9002313.77,9002313.77,"%D",8,0)
 
"^DIC",9002313.77,9002313.77,"%D",9,0)
Per VHA Directive 2004-038, this file definition should not be modified.
"^DIC",9002313.77,"B","BPS REQUESTS",9002313.77)

"^DIC",9002313.78,9002313.78,0)
BPS INSURER DATA^9002313.78
"^DIC",9002313.78,9002313.78,0,"GL")
^BPS(9002313.78,
"^DIC",9002313.78,9002313.78,"%",0)
^1.005^^0
"^DIC",9002313.78,9002313.78,"%D",0)
^^7^7^3080623^
"^DIC",9002313.78,9002313.78,"%D",1,0)
This file is used to store insurers' details data returned by Integrated
"^DIC",9002313.78,9002313.78,"%D",2,0)
Billing package to be used by ECME engine to build claim requests and
"^DIC",9002313.78,9002313.78,"%D",3,0)
reversals and send them to insurers (payers).  Generally there should be
"^DIC",9002313.78,9002313.78,"%D",4,0)
few or no entries in this file unless there are stranded claims, reversal
"^DIC",9002313.78,9002313.78,"%D",5,0)
or requests that need to be un-stranded by the user.
"^DIC",9002313.78,9002313.78,"%D",6,0)
 
"^DIC",9002313.78,9002313.78,"%D",7,0)
Per VHA Directive 2004-038, this file definition should not be modified.
"^DIC",9002313.78,"B","BPS INSURER DATA",9002313.78)

"^DIC",9002313.91,9002313.91,0)
BPS NCPDP FIELD DEFS^9002313.91
"^DIC",9002313.91,9002313.91,0,"GL")
^BPSF(9002313.91,
"^DIC",9002313.91,9002313.91,"%",0)
^1.005^^0
"^DIC",9002313.91,9002313.91,"%","B","ABSP",1)

"^DIC",9002313.91,9002313.91,"%D",0)
^^4^4^3071227^
"^DIC",9002313.91,9002313.91,"%D",1,0)
The NCPDP Data Dictionary Individual fields which combine into formatted 
"^DIC",9002313.91,9002313.91,"%D",2,0)
packets.
"^DIC",9002313.91,9002313.91,"%D",3,0)
 
"^DIC",9002313.91,9002313.91,"%D",4,0)
Per VHA Directive 2004-038, this file definition should not be modified.
"^DIC",9002313.91,"B","BPS NCPDP FIELD DEFS",9002313.91)

"^DIC",9002313.92,9002313.92,0)
BPS NCPDP FORMATS^9002313.92
"^DIC",9002313.92,9002313.92,0,"GL")
^BPSF(9002313.92,
"^DIC",9002313.92,9002313.92,"%",0)
^1.005^^0
"^DIC",9002313.92,9002313.92,"%","B","ABSP",1)

"^DIC",9002313.92,9002313.92,"%D",0)
^^5^5^3080516^
"^DIC",9002313.92,9002313.92,"%D",1,0)
The formats for sending claims.  As derived from NDC Payer Sheets and 
"^DIC",9002313.92,9002313.92,"%D",2,0)
Envoy Plan Sheets.  Never modify locally, except in cooperation with 
"^DIC",9002313.92,9002313.92,"%D",3,0)
development.
"^DIC",9002313.92,9002313.92,"%D",4,0)
 
"^DIC",9002313.92,9002313.92,"%D",5,0)
Per VHA Directive 2004-038, this file definition should not be modified.
"^DIC",9002313.92,"B","BPS NCPDP FORMATS",9002313.92)

"^DIC",9002313.93,9002313.93,0)
BPS NCPDP REJECT CODES^9002313.93
"^DIC",9002313.93,9002313.93,0,"GL")
^BPSF(9002313.93,
"^DIC",9002313.93,9002313.93,"%",0)
^1.005^^0
"^DIC",9002313.93,9002313.93,"%","B","ABSP",1)

"^DIC",9002313.93,9002313.93,"%D",0)
^^6^6^3080529^
"^DIC",9002313.93,9002313.93,"%D",1,0)
This file is used to store the possible NCPDP REJECT CODES, that can be 
"^DIC",9002313.93,9002313.93,"%D",2,0)
returned by the payer.  No local changes should ever be made to this
"^DIC",9002313.93,9002313.93,"%D",3,0)
file.  The data stored in this file are based on the NCPDP standards and
"^DIC",9002313.93,9002313.93,"%D",4,0)
are nationally distributed.
"^DIC",9002313.93,9002313.93,"%D",5,0)
 
"^DIC",9002313.93,9002313.93,"%D",6,0)
Per VHA Directive 2004-038, this file definition should not be modified.
"^DIC",9002313.93,"B","BPS NCPDP REJECT CODES",9002313.93)

"^DIC",9002313.99,9002313.99,0)
BPS SETUP^9002313.99
"^DIC",9002313.99,9002313.99,0,"GL")
^BPS(9002313.99,
"^DIC",9002313.99,9002313.99,"%",0)
^1.005^^0
"^DIC",9002313.99,9002313.99,"%","B","ABSP",1)

"^DIC",9002313.99,9002313.99,"%D",0)
^^4^4^3080212^
"^DIC",9002313.99,9002313.99,"%D",1,0)
Parameters that apply to all of ECME.  There should only be one record 
"^DIC",9002313.99,9002313.99,"%D",2,0)
with IEN=1 and name MAIN SETUP ENTRY.
"^DIC",9002313.99,9002313.99,"%D",3,0)
 
"^DIC",9002313.99,9002313.99,"%D",4,0)
Per VHA Directive 2004-038, this file definition should not be modified.
"^DIC",9002313.99,"B","BPS SETUP",9002313.99)

**INSTALL NAME**
PSO*7.0*289
"BLD",7390,0)
PSO*7.0*289^OUTPATIENT PHARMACY^0^3090615^y
"BLD",7390,1,0)
^^213^213^3090528^
"BLD",7390,1,1,0)
DThis patch has enhancements which extend the capabilities of the Veterans
"BLD",7390,1,2,0)
Health Information Systems and Technology Architecture (VistA) electronic 
"BLD",7390,1,3,0)
pharmacy (ePharmacy) billing system.  Below is a list of all the 
"BLD",7390,1,4,0)
applications involved in this project along with their patch number:
"BLD",7390,1,5,0)
 
"BLD",7390,1,6,0)
   APPLICATION/VERSION                                  PATCH
"BLD",7390,1,7,0)
   --------------------------------------------------------------
"BLD",7390,1,8,0)
   CONSOLIDATED MAIL OUTPATIENT PHARMACY (CMOP) V. 2.0  PSX*2*65
"BLD",7390,1,9,0)
   PHARMACY DATA MANAGEMENT (PDM) V. 1.0                PSS*1*131
"BLD",7390,1,10,0)
   OUTPATIENT PHARMACY (OP) V. 7.0                      PSO*7*289
"BLD",7390,1,11,0)
   INTEGRATED BILLING (IB) V. 2.0                       IB*2*384
"BLD",7390,1,12,0)
   ELECTRONIC CLAIMS MANAGEMENT ENGINE (ECME) V. 1.0    BPS*1*7
"BLD",7390,1,13,0)
 
"BLD",7390,1,14,0)
The last three patches (PSO*7*289, IB*2*384 and BPS*1*7) will be released 
"BLD",7390,1,15,0)
in the Kernel Installation and Distribution System (KIDS) multi-build 
"BLD",7390,1,16,0)
distribution BPS PSO IB BUNDLE 3.0.  Patches PSX*2*65 and PSS*1*131 will 
"BLD",7390,1,17,0)
be released as stand-alone patches.  Since there is an implementation 
"BLD",7390,1,18,0)
dependency between the multi-build distribution and the stand-alone 
"BLD",7390,1,19,0)
patches, PSX*2*65 and PSS*1*131 must be installed prior to the 
"BLD",7390,1,20,0)
installation of the multi-build.  For more specific instructions please 
"BLD",7390,1,21,0)
refer to the installation steps provided in each of the patches.
"BLD",7390,1,22,0)
 
"BLD",7390,1,23,0)
This patch modifies the Outpatient Pharmacy v7.0 application as described
"BLD",7390,1,24,0)
below:
"BLD",7390,1,25,0)
 
"BLD",7390,1,26,0)
1.  A modification was made to prevent users from entering a suspense date
"BLD",7390,1,27,0)
that is greater than the fill date plus 90 days.  Dates where the fill
"BLD",7390,1,28,0)
date plus 90 days is greater than the expiration date will not be allowed.
"BLD",7390,1,29,0)
 
"BLD",7390,1,30,0)
2.  Functionality to allow non-DUR/RTS reject to be placed on Third Party 
"BLD",7390,1,31,0)
Payer Rejects - Worklist [PSO REJECTS WORKLIST] option was added.  To 
"BLD",7390,1,32,0)
accomplish this the following additions were made:
"BLD",7390,1,33,0)
 
"BLD",7390,1,34,0)
    a.  A new EPHARMACY SITE PARAMETERS FILE (#52.86) was added to store
"BLD",7390,1,35,0)
        ePharmacy specific parameters by division.  Along with this file, 
"BLD",7390,1,36,0)
        a new EPHARMACY SITE PARAMETERS [PSO ePHARM SITE PARAMATERS]
"BLD",7390,1,37,0)
        option was added for entry/edit of parameters.  Regardless of any
"BLD",7390,1,38,0)
        parameters defined in this new file, Refill-Too-Soon (RTS), Drug
"BLD",7390,1,39,0)
        Utilization Review(DUR) and Tricare rejects will always be placed
"BLD",7390,1,40,0)
        on the Pharmacy Reject Worklist.
"BLD",7390,1,41,0)
 
"BLD",7390,1,42,0)
        Sites will have the ability to select to allow all third party 
"BLD",7390,1,43,0)
        rejects to pass to the the Third Party Payer Rejects - Worklist
"BLD",7390,1,44,0)
        which is also referred to as the Pharmacy Reject Worklist or they
"BLD",7390,1,45,0)
        can choose to specify individual reject codes. Individual third
"BLD",7390,1,46,0)
        party reject codes can be defined to be automatically placed on
"BLD",7390,1,47,0)
        the worklist or defined to require OPECC intervention. If the site
"BLD",7390,1,48,0)
        chooses to allow all rejects to be placed on the worklist,
"BLD",7390,1,49,0)
        individual codes are overridden but not deleted from the file.
"BLD",7390,1,50,0)
 
"BLD",7390,1,51,0)
     b. For display of non-DUR/RTS rejects for the Third Party Payer
"BLD",7390,1,52,0)
        Rejects - Worklist [PSO REJECTS WORKLIST] option, rejects passed
"BLD",7390,1,53,0)
        via OPECC manual intervention will be denoted in the comment
"BLD",7390,1,54,0)
        section of the Reject Information screen as:
"BLD",7390,1,55,0)
 
"BLD",7390,1,56,0)
        - JUN 09, 2008@14:04:18 - Transferred by OPECC. (user,name)
"BLD",7390,1,57,0)
 
"BLD",7390,1,58,0)
    
"BLD",7390,1,59,0)
        Rejects passed automatically will be denoted in the comments 
"BLD",7390,1,60,0)
        section of  the Reject Information Screen as 
"BLD",7390,1,61,0)
 
"BLD",7390,1,62,0)
       - JUN 09, 2008@16:00:09 - Automatically transferred due to override
"BLD",7390,1,63,0)
         for reject code. (user,name)
"BLD",7390,1,64,0)
 
"BLD",7390,1,65,0)
        All rejects other than Refill-Too-Soon, DUR, and Tricare will be 
"BLD",7390,1,66,0)
        displayed at the end of the listing under "OTHER REJECTS"
"BLD",7390,1,67,0)
        header. The "OTHER REJECTS" header will be displayed regardless of
"BLD",7390,1,68,0)
        whether the GI - Group Insurance action is toggled on or off.  
"BLD",7390,1,69,0)
        
"BLD",7390,1,70,0)
        Non-DUR/RTS rejections will be resolved with the existing
"BLD",7390,1,71,0)
        functionality and will be resubmitted to ECME in the same manner
"BLD",7390,1,72,0)
        as DUR/RTS rejections.
"BLD",7390,1,73,0)
 
"BLD",7390,1,74,0)
3.  A modification was made to not allow a claim to be reversed through 
"BLD",7390,1,75,0)
ECME for an unreleased CMOP fill when the prescription/fill is 
"BLD",7390,1,76,0)
discontinued. If the fill is either a CMOP released or Non-CMOP released 
"BLD",7390,1,77,0)
fill the reversal will be performed.  Because the software already 
"BLD",7390,1,78,0)
performs a reversal for unsuccessful/not dispensed claims, no changes are 
"BLD",7390,1,79,0)
needed for reversing discontinued non-dispensed fills.  Also, no changes 
"BLD",7390,1,80,0)
are needed when the NDC from CMOP differs from the NDC on the claim 
"BLD",7390,1,81,0)
because this function is already performed by existing software.
"BLD",7390,1,82,0)
 
"BLD",7390,1,83,0)
4. New functionality was added to prevent prescriptions from being 
"BLD",7390,1,84,0)
filled/sent to CMOP when a host processing error occurs when a claim is 
"BLD",7390,1,85,0)
submitted through ECME. The host processing errors are identified by 
"BLD",7390,1,86,0)
reject codes M6, M8, NN, and 99. The following conditions apply when this 
"BLD",7390,1,87,0)
scenario occurs.
"BLD",7390,1,88,0)
 
"BLD",7390,1,89,0)
    a. The transmission of the Rx/fill will be delayed 1 day in hopes
"BLD",7390,1,90,0)
       that the host processing issues will be resolved.
"BLD",7390,1,91,0)
    b. An activity log entry will be defined to state the date/time 
"BLD",7390,1,92,0)
       along with a comment stating that the Rx/fill was left in suspense
"BLD",7390,1,93,0)
       hold due to a host processing error.
"BLD",7390,1,94,0)
    c. This added functionality does not include the Pull Early from 
"BLD",7390,1,95,0)
       Suspense function.
"BLD",7390,1,96,0)
 
"BLD",7390,1,97,0)
5. New functionality was added to the Print from Suspense File [PSO 
"BLD",7390,1,98,0)
PNDLBL] option to prevent ePharmacy prescriptions from being pulled early
"BLD",7390,1,99,0)
from suspense until 3/4 of the days supply of the Rx/fill has elapsed.  
"BLD",7390,1,100,0)
The system will not hold a prescription for 3/4 days supply when:
"BLD",7390,1,101,0)
 
"BLD",7390,1,102,0)
    -   the previous fill was not ECME billable
"BLD",7390,1,103,0)
    -   the Rx is flagged for SC or EI
"BLD",7390,1,104,0)
    -   the DEA special Handling code is non billable (i.e. has M or 0 
"BLD",7390,1,105,0)
             (zero) or  (I, S, N, and/or 9)) without and E.
"BLD",7390,1,106,0)
    -   the Rx is a zero fill on a renewal
"BLD",7390,1,107,0)
    -   the patient does not currently have insurance
"BLD",7390,1,108,0)
 
"BLD",7390,1,109,0)
6. A modification was made to PRESCRIPTION file (#52), REJECT INFO 
"BLD",7390,1,110,0)
sub-file (#52.25), CLARIFICATION CODE field (#24). This was a set of codes
"BLD",7390,1,111,0)
field.  It is now a pointer to file #9002313.25 (BPS NCPDP CLARIFICATION
"BLD",7390,1,112,0)
CODE).  A post install routine will go through the reject info subfile and
"BLD",7390,1,113,0)
convert the old set of code values to the appropriate new pointer values.
"BLD",7390,1,114,0)
The post install will send a mail message to the person installing the
"BLD",7390,1,115,0)
build which details the affected rejected prescriptions.  The 'Submit
"BLD",7390,1,116,0)
Clarif. Code' protocol [PSO REJECT DISPLAY CLARIFICATION CODE] has been
"BLD",7390,1,117,0)
altered to use the new pointer value.
"BLD",7390,1,118,0)
 
"BLD",7390,1,119,0)
7. The 'Edit NDC and DAW Code of Discontinued/Expired Prescriptions' 
"BLD",7390,1,120,0)
functionality introduced in PSO*7.0*281 has been extended to also allow 
"BLD",7390,1,121,0)
edits of prescriptions with a status of DISCONTINUED BY PROVIDER and 
"BLD",7390,1,122,0)
DISCONTINUED (EDIT).
"BLD",7390,1,123,0)
 
"BLD",7390,1,124,0)
8. New functionality was added to create a nightly background mail 
"BLD",7390,1,125,0)
message regarding open/unresolved rejects on the reject worklist.  The 
"BLD",7390,1,126,0)
'Third Party Payer Rejects - Nightly Message' option [PSO REJECTS 
"BLD",7390,1,127,0)
BACKGROUND MESSAGE] will be queued to run every 24 hours by the post 
"BLD",7390,1,128,0)
install routine.  This option is intended to be a stand alone option and 
"BLD",7390,1,129,0)
should not be placed on any menu.  The message will be delivered to the 
"BLD",7390,1,130,0)
'PSO REJECTS BACKGROUND MESSAGE' mailgroup; this mailgroup should be 
"BLD",7390,1,131,0)
populated with appropriate ePharmacy users to receive the information.  
"BLD",7390,1,132,0)
Mail messages are generated for each division. Sites may alter EPHARMACY
"BLD",7390,1,133,0)
SITE PARAMETERS file (#52.86) REJECT WORKLIST DAYS field (#4) for each 
"BLD",7390,1,134,0)
division using the ePharmacy Site Parameters option [PSO EPHARM SITE 
"BLD",7390,1,135,0)
PARAMETERS] of the ePharmacy Menu.  If no sites are defined in the 
"BLD",7390,1,136,0)
EPHARMACY SITE PARAMETERS file (#52.86), no message will be generated.  
"BLD",7390,1,137,0)
This parameter may be defined to be 1 to 30 days that an uncommented
"BLD",7390,1,138,0)
reject can remain on the reject worklist without being included in the
"BLD",7390,1,139,0)
nightly reject worklist alert mail message.  The following are the
"BLD",7390,1,140,0)
criteria for a reject to be included in the mail message:
"BLD",7390,1,141,0)
 
"BLD",7390,1,142,0)
    a. The prescription is active, suspensed, expired, or on hold.
"BLD",7390,1,143,0)
    b. The prescription is unreleased.
"BLD",7390,1,144,0)
    c. The claim has been on the Reject Worklist for more days than the
"BLD",7390,1,145,0)
       value in the REJECT WORKLIST DAYS field for the division.
"BLD",7390,1,146,0)
    d. The claim has no comments added within the date range.
"BLD",7390,1,147,0)
 
"BLD",7390,1,148,0)
9. New functionality was added to allow NDC validation of third party
"BLD",7390,1,149,0)
payable prescriptions by pharmacy technicians.  Current functionality
"BLD",7390,1,150,0)
requires a pharmacist to perform this task.  In addition, for the
"BLD",7390,1,151,0)
PRESCRIPTION file(#52) and the REFILL sub-file (#52.1), the DATE NDC
"BLD",7390,1,152,0)
VALIDATED field (#83) and NDC VALIDATED BY field (#84) will be captured
"BLD",7390,1,153,0)
when the NDC is validated for a prescription or refill; this validation
"BLD",7390,1,154,0)
information will be displayed when prescriptions are released; if the NDCs
"BLD",7390,1,155,0)
have not been validated, that information will be displayed instead.  The
"BLD",7390,1,156,0)
'NDC Validation' option [PSO NDC VALIDATE] has been added to the ePharmacy
"BLD",7390,1,157,0)
Menu for use by technicians.  The option will work as follows:
"BLD",7390,1,158,0)
 
"BLD",7390,1,159,0)
    a. The technician will be prompted to scan or enter a prescription 
"BLD",7390,1,160,0)
       number.  An '^' may be entered to halt the option.
"BLD",7390,1,161,0)
    b. The system will evaluate the Rx.  If the Rx NDC has already been 
"BLD",7390,1,162,0)
       validated, the technician will be prompted if they wish to
"BLD",7390,1,163,0)
       revalidate. If the answer is yes, the technician will be allowed to
"BLD",7390,1,164,0)
       proceed.  If the answer is no, the technician will be returned to
"BLD",7390,1,165,0)
       the select a prescription prompt.
"BLD",7390,1,166,0)
    c. If the Rx is CMOP, external interface or released, the user will
"BLD",7390,1,167,0)
       not be allowed to verify the Rx.
"BLD",7390,1,168,0)
    d. The system will display information about the Rx, notate that the
"BLD",7390,1,169,0)
       Rx has not been previously verified and will prompt for PRODUCT 
"BLD",7390,1,170,0)
       NDC. A valid PRODUCT NDC must be entered for this prompt.  Valid
"BLD",7390,1,171,0)
       PRODUCT NDC's are those defined for the drug in Drug file (#50) as
"BLD",7390,1,172,0)
       an NDC of a synonym or the default NDC.
"BLD",7390,1,173,0)
    e. The system will compare the Rx NDC to the PRODUCT NDC submitted on
"BLD",7390,1,174,0)
       the ePharmacy claim.  If the NDCs do not match, the system will
"BLD",7390,1,175,0)
       reverse and resubmit a third party claim with the new NDC and 
"BLD",7390,1,176,0)
       store the new NDC on the fill.
"BLD",7390,1,177,0)
    f. If the prescription is defined as TRICARE and is not payable, the 
"BLD",7390,1,178,0)
       system will display an appropriate message and the technician will 
"BLD",7390,1,179,0)
       be returned to the select a prescription prompt.
"BLD",7390,1,180,0)
    g. If the prescription is defined as TRICARE and the reversed claim 
"BLD",7390,1,181,0)
       returns not payable, the system will display an appropriate 
"BLD",7390,1,182,0)
       message and the technician will be returned to the select a
"BLD",7390,1,183,0)
       prescription prompt.
"BLD",7390,1,184,0)
    h. Otherwise, the system will update the NDC validation fields for the
"BLD",7390,1,185,0)
       Rx/Fill, and the technician will be returned to the select a
"BLD",7390,1,186,0)
       prescription prompt.
"BLD",7390,1,187,0)
 
"BLD",7390,1,188,0)
10.  The RES - Resubmit Claim action was added to the Reject Information
"BLD",7390,1,189,0)
(TRICARE) screen of the Third Party Payer Rejects - Worklist [PSO REJECTS
"BLD",7390,1,190,0)
WORKLIST] option.
"BLD",7390,1,191,0)
 
"BLD",7390,1,192,0)
11.  The following functionality will work only if the REGISTRATION
"BLD",7390,1,193,0)
package V.5.3 patch DG*5.3*688 that introduces the COUNTRY field to the
"BLD",7390,1,194,0)
PATIENT file (#2) is installed:
"BLD",7390,1,195,0)
 
"BLD",7390,1,196,0)
   When using the Print from Suspense File [PSO PNDLBL] option, if the
"BLD",7390,1,197,0)
   routing is MAIL and the address is Foreign, it will be treated just
"BLD",7390,1,198,0)
   like the BAD ADDRESS INDICATOR or DO NOT MAIL order where:
"BLD",7390,1,199,0)
 
"BLD",7390,1,200,0)
   a. The prescription will not be sent to the automated filling equipment
"BLD",7390,1,201,0)
      and/or to the label printer. The fill will remain on suspense until
"BLD",7390,1,202,0)
      it is pulled early, the routing is changed to window, or the address
"BLD",7390,1,203,0)
      is changed.
"BLD",7390,1,204,0)
 
"BLD",7390,1,205,0)
   b. For the first time attempt to print from suspense, an entry will be
"BLD",7390,1,206,0)
      added to the activity log and a MailMan message will be generated to
"BLD",7390,1,207,0)
      the user who queued the job to print from suspense and the members
"BLD",7390,1,208,0)
      of the PSO EXTERNAL DISPENSE ALERTS mail group.
"BLD",7390,1,209,0)
 
"BLD",7390,1,210,0)
12.  When the NDC changes during auto-release of the prescription for CMOP
"BLD",7390,1,211,0)
or OPAI fills, the fill date on the fill be updated to become the same as
"BLD",7390,1,212,0)
the release date.  An entry will be made in the activity log for the fill 
"BLD",7390,1,213,0)
to denote the changed date.
"BLD",7390,4,0)
^9.64PA^52^3
"BLD",7390,4,52,0)
52
"BLD",7390,4,52,2,0)
^9.641^52.1^3
"BLD",7390,4,52,2,52,0)
PRESCRIPTION  (File-top level)
"BLD",7390,4,52,2,52,1,0)
^9.6411^86^1
"BLD",7390,4,52,2,52,1,86,0)
EPHARMACY SUSPENSE HOLD DATE
"BLD",7390,4,52,2,52.1,0)
REFILL  (sub-file)
"BLD",7390,4,52,2,52.1,1,0)
^9.6411^86^1
"BLD",7390,4,52,2,52.1,1,86,0)
EPHARMACY SUSPENSE HOLD DATE
"BLD",7390,4,52,2,52.25,0)
REJECT INFO  (sub-file)
"BLD",7390,4,52,2,52.25,1,0)
^9.6411^24^1
"BLD",7390,4,52,2,52.25,1,24,0)
CLARIFICATION CODE
"BLD",7390,4,52,222)
y^y^p^^^^n^^n
"BLD",7390,4,52,224)

"BLD",7390,4,52.5,0)
52.5
"BLD",7390,4,52.5,2,0)
^9.641^52.5^1
"BLD",7390,4,52.5,2,52.5,0)
RX SUSPENSE  (File-top level)
"BLD",7390,4,52.5,2,52.5,1,0)
^9.6411^10^1
"BLD",7390,4,52.5,2,52.5,1,10,0)
SUSPENSE HOLD DATE
"BLD",7390,4,52.5,222)
y^y^p^^^^n^^n
"BLD",7390,4,52.5,224)

"BLD",7390,4,52.86,0)
52.86
"BLD",7390,4,52.86,222)
y^y^f^^^^n
"BLD",7390,4,"APDD",52,52)

"BLD",7390,4,"APDD",52,52,86)

"BLD",7390,4,"APDD",52,52.1)

"BLD",7390,4,"APDD",52,52.1,86)

"BLD",7390,4,"APDD",52,52.25)

"BLD",7390,4,"APDD",52,52.25,24)

"BLD",7390,4,"APDD",52.5,52.5)

"BLD",7390,4,"APDD",52.5,52.5,10)

"BLD",7390,4,"B",52,52)

"BLD",7390,4,"B",52.5,52.5)

"BLD",7390,4,"B",52.86,52.86)

"BLD",7390,6)
7^
"BLD",7390,6.3)
107
"BLD",7390,"INI")
DESP^PSO7P289
"BLD",7390,"INID")
^n^n
"BLD",7390,"INIT")
PSO7P289
"BLD",7390,"KRN",0)
^9.67PA^8989.52^19
"BLD",7390,"KRN",.4,0)
.4
"BLD",7390,"KRN",.401,0)
.401
"BLD",7390,"KRN",.402,0)
.402
"BLD",7390,"KRN",.403,0)
.403
"BLD",7390,"KRN",.5,0)
.5
"BLD",7390,"KRN",.84,0)
.84
"BLD",7390,"KRN",3.6,0)
3.6
"BLD",7390,"KRN",3.8,0)
3.8
"BLD",7390,"KRN",3.8,"NM",0)
^9.68A^1^1
"BLD",7390,"KRN",3.8,"NM",1,0)
PSO REJECTS BACKGROUND MESSAGE^^0
"BLD",7390,"KRN",3.8,"NM","B","PSO REJECTS BACKGROUND MESSAGE",1)

"BLD",7390,"KRN",9.2,0)
9.2
"BLD",7390,"KRN",9.8,0)
9.8
"BLD",7390,"KRN",9.8,"NM",0)
^9.68A^43^28
"BLD",7390,"KRN",9.8,"NM",3,0)
PSOSULBL^^0^B71252652
"BLD",7390,"KRN",9.8,"NM",4,0)
PSOREJP4^^0^B58124715
"BLD",7390,"KRN",9.8,"NM",5,0)
PSOBPSSP^^0^B8034354
"BLD",7390,"KRN",9.8,"NM",6,0)
PSOREJU4^^0^B23487142
"BLD",7390,"KRN",9.8,"NM",7,0)
PSOSULB1^^0^B43045275
"BLD",7390,"KRN",9.8,"NM",8,0)
PSOREJUT^^0^B47876709
"BLD",7390,"KRN",9.8,"NM",9,0)
PSOBPSU2^^0^B32851035
"BLD",7390,"KRN",9.8,"NM",11,0)
PSOREJP1^^0^B67222014
"BLD",7390,"KRN",9.8,"NM",12,0)
PSOREJP0^^0^B74165131
"BLD",7390,"KRN",9.8,"NM",25,0)
PSOREJP2^^0^B71497801
"BLD",7390,"KRN",9.8,"NM",26,0)
PSOORED7^^0^B22904608
"BLD",7390,"KRN",9.8,"NM",27,0)
PSOBPSUT^^0^B54217211
"BLD",7390,"KRN",9.8,"NM",28,0)
PSO7P289^^0^B95661836
"BLD",7390,"KRN",9.8,"NM",29,0)
PSONDCV^^0^B50952716
"BLD",7390,"KRN",9.8,"NM",30,0)
PSOORED2^^0^B66199393
"BLD",7390,"KRN",9.8,"NM",31,0)
PSOOREDT^^0^B65205187
"BLD",7390,"KRN",9.8,"NM",32,0)
PSOORNE2^^0^B68054586
"BLD",7390,"KRN",9.8,"NM",33,0)
PSOBPSU1^^0^B46150481
"BLD",7390,"KRN",9.8,"NM",34,0)
PSONDCUT^^0^B54609363
"BLD",7390,"KRN",9.8,"NM",35,0)
PSORXED^^0^B65116551
"BLD",7390,"KRN",9.8,"NM",36,0)
PSOREJU1^^0^B57825084
"BLD",7390,"KRN",9.8,"NM",37,0)
PSORXL1^^0^B50241379
"BLD",7390,"KRN",9.8,"NM",38,0)
PSOREJP3^^0^B48298782
"BLD",7390,"KRN",9.8,"NM",39,0)
PSOPMP1^^0^B29347601
"BLD",7390,"KRN",9.8,"NM",40,0)
PSORXED1^^0^B21189403
"BLD",7390,"KRN",9.8,"NM",41,0)
PSOPMP0^^0^B77858526
"BLD",7390,"KRN",9.8,"NM",42,0)
PSOORUT1^^0^B71103407
"BLD",7390,"KRN",9.8,"NM",43,0)
PSOSUPOE^^0^B64269285
"BLD",7390,"KRN",9.8,"NM","B","PSO7P289",28)

"BLD",7390,"KRN",9.8,"NM","B","PSOBPSSP",5)

"BLD",7390,"KRN",9.8,"NM","B","PSOBPSU1",33)

"BLD",7390,"KRN",9.8,"NM","B","PSOBPSU2",9)

"BLD",7390,"KRN",9.8,"NM","B","PSOBPSUT",27)

"BLD",7390,"KRN",9.8,"NM","B","PSONDCUT",34)

"BLD",7390,"KRN",9.8,"NM","B","PSONDCV",29)

"BLD",7390,"KRN",9.8,"NM","B","PSOORED2",30)

"BLD",7390,"KRN",9.8,"NM","B","PSOORED7",26)

"BLD",7390,"KRN",9.8,"NM","B","PSOOREDT",31)

"BLD",7390,"KRN",9.8,"NM","B","PSOORNE2",32)

"BLD",7390,"KRN",9.8,"NM","B","PSOORUT1",42)

"BLD",7390,"KRN",9.8,"NM","B","PSOPMP0",41)

"BLD",7390,"KRN",9.8,"NM","B","PSOPMP1",39)

"BLD",7390,"KRN",9.8,"NM","B","PSOREJP0",12)

"BLD",7390,"KRN",9.8,"NM","B","PSOREJP1",11)

"BLD",7390,"KRN",9.8,"NM","B","PSOREJP2",25)

"BLD",7390,"KRN",9.8,"NM","B","PSOREJP3",38)

"BLD",7390,"KRN",9.8,"NM","B","PSOREJP4",4)

"BLD",7390,"KRN",9.8,"NM","B","PSOREJU1",36)

"BLD",7390,"KRN",9.8,"NM","B","PSOREJU4",6)

"BLD",7390,"KRN",9.8,"NM","B","PSOREJUT",8)

"BLD",7390,"KRN",9.8,"NM","B","PSORXED",35)

"BLD",7390,"KRN",9.8,"NM","B","PSORXED1",40)

"BLD",7390,"KRN",9.8,"NM","B","PSORXL1",37)

"BLD",7390,"KRN",9.8,"NM","B","PSOSULB1",7)

"BLD",7390,"KRN",9.8,"NM","B","PSOSULBL",3)

"BLD",7390,"KRN",9.8,"NM","B","PSOSUPOE",43)

"BLD",7390,"KRN",19,0)
19
"BLD",7390,"KRN",19,"NM",0)
^9.68A^9^9
"BLD",7390,"KRN",19,"NM",1,0)
PSO REJECTS BACKGROUND MESSAGE^^0
"BLD",7390,"KRN",19,"NM",2,0)
PSO ePHARM SITE PARAMETERS^^0
"BLD",7390,"KRN",19,"NM",3,0)
PSO EPHARMACY MENU^^0
"BLD",7390,"KRN",19,"NM",4,0)
PSO REJECTS WORKLIST^^0
"BLD",7390,"KRN",19,"NM",5,0)
PSO REJECTS VIEW/PROCESS^^0
"BLD",7390,"KRN",19,"NM",6,0)
PSO PMP^^0
"BLD",7390,"KRN",19,"NM",7,0)
PSO PMP SITE PREFERENCES^^0
"BLD",7390,"KRN",19,"NM",8,0)
PSO IGNORED REJECTS REPORT^^0
"BLD",7390,"KRN",19,"NM",9,0)
PSO NDC VALIDATE^^0
"BLD",7390,"KRN",19,"NM","B","PSO EPHARMACY MENU",3)

"BLD",7390,"KRN",19,"NM","B","PSO IGNORED REJECTS REPORT",8)

"BLD",7390,"KRN",19,"NM","B","PSO NDC VALIDATE",9)

"BLD",7390,"KRN",19,"NM","B","PSO PMP",6)

"BLD",7390,"KRN",19,"NM","B","PSO PMP SITE PREFERENCES",7)

"BLD",7390,"KRN",19,"NM","B","PSO REJECTS BACKGROUND MESSAGE",1)

"BLD",7390,"KRN",19,"NM","B","PSO REJECTS VIEW/PROCESS",5)

"BLD",7390,"KRN",19,"NM","B","PSO REJECTS WORKLIST",4)

"BLD",7390,"KRN",19,"NM","B","PSO ePHARM SITE PARAMETERS",2)

"BLD",7390,"KRN",19.1,0)
19.1
"BLD",7390,"KRN",101,0)
101
"BLD",7390,"KRN",101,"NM",0)
^9.68A^30^30
"BLD",7390,"KRN",101,"NM",1,0)
PSO REJECT TRICARE MENU^^0
"BLD",7390,"KRN",101,"NM",2,0)
PSO REJECT DISPLAY RX VIEW^^0
"BLD",7390,"KRN",101,"NM",3,0)
PSO REJECT DISPLAY MED PROFILE^^0
"BLD",7390,"KRN",101,"NM",4,0)
PSO REJECT DISPLAY OVERRIDE^^0
"BLD",7390,"KRN",101,"NM",5,0)
PSO REJECT DISPLAY SUSPENSE DATE^^0
"BLD",7390,"KRN",101,"NM",6,0)
PSO REJECT FILL RX^^0
"BLD",7390,"KRN",101,"NM",7,0)
PSO REJECT DISCONTINUE^^0
"BLD",7390,"KRN",101,"NM",8,0)
PSO REJECT DISPLAY HIDDEN MENU^^0
"BLD",7390,"KRN",101,"NM",9,0)
VALM NEXT SCREEN^^0
"BLD",7390,"KRN",101,"NM",10,0)
VALM PREVIOUS SCREEN^^0
"BLD",7390,"KRN",101,"NM",11,0)
VALM UP ONE LINE^^0
"BLD",7390,"KRN",101,"NM",12,0)
VALM REFRESH^^0
"BLD",7390,"KRN",101,"NM",13,0)
VALM PRINT SCREEN^^0
"BLD",7390,"KRN",101,"NM",14,0)
VALM PRINT LIST^^0
"BLD",7390,"KRN",101,"NM",15,0)
VALM SEARCH LIST^^0
"BLD",7390,"KRN",101,"NM",16,0)
VALM QUIT^^0
"BLD",7390,"KRN",101,"NM",17,0)
VALM LAST SCREEN^^0
"BLD",7390,"KRN",101,"NM",18,0)
VALM FIRST SCREEN^^0
"BLD",7390,"KRN",101,"NM",19,0)
VALM GOTO PAGE^^0
"BLD",7390,"KRN",101,"NM",20,0)
PSO REJECT DISPLAY RX EDIT^^0
"BLD",7390,"KRN",101,"NM",21,0)
PSO REJECT DISPLAY CLARIFICATION CODE^^0
"BLD",7390,"KRN",101,"NM",22,0)
PSO REJECT DISPLAY ADD COMMENT^^0
"BLD",7390,"KRN",101,"NM",23,0)
VALM TURN ON/OFF MENUS^^0
"BLD",7390,"KRN",101,"NM",24,0)
PSO REJECT DISPLAY PRIOR AUTHORIZATION^^0
"BLD",7390,"KRN",101,"NM",25,0)
VALM DOWN A LINE^^0
"BLD",7390,"KRN",101,"NM",26,0)
PSO REJECT DISPLAY MENU^^0
"BLD",7390,"KRN",101,"NM",27,0)
PSO REJECT DISPLAY RESUBMIT^^0
"BLD",7390,"KRN",101,"NM",28,0)
PSO REJECT DISPLAY IGNORE^^0
"BLD",7390,"KRN",101,"NM",29,0)
PSO REJECT DISPLAY MENU - RESOLVED^^0
"BLD",7390,"KRN",101,"NM",30,0)
PSO REJECT DISPLAY REOPEN^^0
"BLD",7390,"KRN",101,"NM","B","PSO REJECT DISCONTINUE",7)

"BLD",7390,"KRN",101,"NM","B","PSO REJECT DISPLAY ADD COMMENT",22)

"BLD",7390,"KRN",101,"NM","B","PSO REJECT DISPLAY CLARIFICATION CODE",21)

"BLD",7390,"KRN",101,"NM","B","PSO REJECT DISPLAY HIDDEN MENU",8)

"BLD",7390,"KRN",101,"NM","B","PSO REJECT DISPLAY IGNORE",28)

"BLD",7390,"KRN",101,"NM","B","PSO REJECT DISPLAY MED PROFILE",3)

"BLD",7390,"KRN",101,"NM","B","PSO REJECT DISPLAY MENU",26)

"BLD",7390,"KRN",101,"NM","B","PSO REJECT DISPLAY MENU - RESOLVED",29)

"BLD",7390,"KRN",101,"NM","B","PSO REJECT DISPLAY OVERRIDE",4)

"BLD",7390,"KRN",101,"NM","B","PSO REJECT DISPLAY PRIOR AUTHORIZATION",24)

"BLD",7390,"KRN",101,"NM","B","PSO REJECT DISPLAY REOPEN",30)

"BLD",7390,"KRN",101,"NM","B","PSO REJECT DISPLAY RESUBMIT",27)

"BLD",7390,"KRN",101,"NM","B","PSO REJECT DISPLAY RX EDIT",20)

"BLD",7390,"KRN",101,"NM","B","PSO REJECT DISPLAY RX VIEW",2)

"BLD",7390,"KRN",101,"NM","B","PSO REJECT DISPLAY SUSPENSE DATE",5)

"BLD",7390,"KRN",101,"NM","B","PSO REJECT FILL RX",6)

"BLD",7390,"KRN",101,"NM","B","PSO REJECT TRICARE MENU",1)

"BLD",7390,"KRN",101,"NM","B","VALM DOWN A LINE",25)

"BLD",7390,"KRN",101,"NM","B","VALM FIRST SCREEN",18)

"BLD",7390,"KRN",101,"NM","B","VALM GOTO PAGE",19)

"BLD",7390,"KRN",101,"NM","B","VALM LAST SCREEN",17)

"BLD",7390,"KRN",101,"NM","B","VALM NEXT SCREEN",9)

"BLD",7390,"KRN",101,"NM","B","VALM PREVIOUS SCREEN",10)

"BLD",7390,"KRN",101,"NM","B","VALM PRINT LIST",14)

"BLD",7390,"KRN",101,"NM","B","VALM PRINT SCREEN",13)

"BLD",7390,"KRN",101,"NM","B","VALM QUIT",16)

"BLD",7390,"KRN",101,"NM","B","VALM REFRESH",12)

"BLD",7390,"KRN",101,"NM","B","VALM SEARCH LIST",15)

"BLD",7390,"KRN",101,"NM","B","VALM TURN ON/OFF MENUS",23)

"BLD",7390,"KRN",101,"NM","B","VALM UP ONE LINE",11)

"BLD",7390,"KRN",409.61,0)
409.61
"BLD",7390,"KRN",409.61,"NM",0)
^9.68A^3^3
"BLD",7390,"KRN",409.61,"NM",1,0)
PSO REJECT TRICARE^^0
"BLD",7390,"KRN",409.61,"NM",2,0)
PSO REJECT DISPLAY^^0
"BLD",7390,"KRN",409.61,"NM",3,0)
PSO REJECT DISPLAY - RESOLVED^^0
"BLD",7390,"KRN",409.61,"NM","B","PSO REJECT DISPLAY",2)

"BLD",7390,"KRN",409.61,"NM","B","PSO REJECT DISPLAY - RESOLVED",3)

"BLD",7390,"KRN",409.61,"NM","B","PSO REJECT TRICARE",1)

"BLD",7390,"KRN",771,0)
771
"BLD",7390,"KRN",870,0)
870
"BLD",7390,"KRN",8989.51,0)
8989.51
"BLD",7390,"KRN",8989.51,"NM",0)
^9.68A^^
"BLD",7390,"KRN",8989.52,0)
8989.52
"BLD",7390,"KRN",8994,0)
8994
"BLD",7390,"KRN",8994,"NM",0)
^9.68A^^
"BLD",7390,"KRN","B",.4,.4)

"BLD",7390,"KRN","B",.401,.401)

"BLD",7390,"KRN","B",.402,.402)

"BLD",7390,"KRN","B",.403,.403)

"BLD",7390,"KRN","B",.5,.5)

"BLD",7390,"KRN","B",.84,.84)

"BLD",7390,"KRN","B",3.6,3.6)

"BLD",7390,"KRN","B",3.8,3.8)

"BLD",7390,"KRN","B",9.2,9.2)

"BLD",7390,"KRN","B",9.8,9.8)

"BLD",7390,"KRN","B",19,19)

"BLD",7390,"KRN","B",19.1,19.1)

"BLD",7390,"KRN","B",101,101)

"BLD",7390,"KRN","B",409.61,409.61)

"BLD",7390,"KRN","B",771,771)

"BLD",7390,"KRN","B",870,870)

"BLD",7390,"KRN","B",8989.51,8989.51)

"BLD",7390,"KRN","B",8989.52,8989.52)

"BLD",7390,"KRN","B",8994,8994)

"BLD",7390,"QUES",0)
^9.62^^0
"BLD",7390,"REQB",0)
^9.611^8^7
"BLD",7390,"REQB",1,0)
BPS*1.0*7^2
"BLD",7390,"REQB",3,0)
PSX*2.0*65^2
"BLD",7390,"REQB",4,0)
PSS*1.0*131^2
"BLD",7390,"REQB",5,0)
PSO*7.0*303^2
"BLD",7390,"REQB",6,0)
PSO*7.0*317^2
"BLD",7390,"REQB",7,0)
PSO*7.0*305^2
"BLD",7390,"REQB",8,0)
PSO*7.0*304^2
"BLD",7390,"REQB","B","BPS*1.0*7",1)

"BLD",7390,"REQB","B","PSO*7.0*303",5)

"BLD",7390,"REQB","B","PSO*7.0*304",8)

"BLD",7390,"REQB","B","PSO*7.0*305",7)

"BLD",7390,"REQB","B","PSO*7.0*317",6)

"BLD",7390,"REQB","B","PSS*1.0*131",4)

"BLD",7390,"REQB","B","PSX*2.0*65",3)

"FIA",52)
PRESCRIPTION
"FIA",52,0)
^PSRX(
"FIA",52,0,0)
52Is
"FIA",52,0,1)
y^y^p^^^^n^^n
"FIA",52,0,10)

"FIA",52,0,11)

"FIA",52,0,"RLRO")

"FIA",52,0,"VR")
7.0^PSO
"FIA",52,52)
1
"FIA",52,52,86)

"FIA",52,52.1)
1
"FIA",52,52.1,86)

"FIA",52,52.25)
1
"FIA",52,52.25,24)

"FIA",52.5)
RX SUSPENSE
"FIA",52.5,0)
^PS(52.5,
"FIA",52.5,0,0)
52.5PI
"FIA",52.5,0,1)
y^y^p^^^^n^^n
"FIA",52.5,0,10)

"FIA",52.5,0,11)

"FIA",52.5,0,"RLRO")

"FIA",52.5,0,"VR")
7.0^PSO
"FIA",52.5,52.5)
1
"FIA",52.5,52.5,10)

"FIA",52.86)
EPHARMACY SITE PARAMETERS
"FIA",52.86,0)
^PS(52.86,
"FIA",52.86,0,0)
52.86P
"FIA",52.86,0,1)
y^y^f^^^^n
"FIA",52.86,0,10)

"FIA",52.86,0,11)

"FIA",52.86,0,"RLRO")

"FIA",52.86,0,"VR")
7.0^PSO
"FIA",52.86,52.86)
0
"FIA",52.86,52.8651)
0
"INI")
DESP^PSO7P289
"INIT")
PSO7P289
"KRN",3.8,1329,-1)
0^1
"KRN",3.8,1329,0)
PSO REJECTS BACKGROUND MESSAGE^PU^y^^^^
"KRN",3.8,1329,3)

"KRN",19,2920243,-1)
0^4
"KRN",19,2920243,0)
PSO REJECTS WORKLIST^Third Party Payer Rejects - Worklist^^R^^PSORPH^^^^^^OUTPATIENT PHARMACY^^
"KRN",19,2920243,1,0)
^19.06^5^5^3080305^^^^
"KRN",19,2920243,1,1,0)
This option gives user the ability to process Third Party Payer Rejects for
"KRN",19,2920243,1,2,0)
one, multiple or all Outpatient Pharmacy Divisions. Only OPEN/UNRESOLVED 
"KRN",19,2920243,1,3,0)
rejects that have clinical significance, such as DUR (Drug Utilization Review)
"KRN",19,2920243,1,4,0)
and Fill Too Soon, are added to the Worklist. Once the reject is marked 
"KRN",19,2920243,1,5,0)
CLOSED/RESOLVED it is automatically removed from the Worklist.
"KRN",19,2920243,20)

"KRN",19,2920243,25)
PSOREJP0
"KRN",19,2920243,"U")
THIRD PARTY PAYER REJECTS - WO
"KRN",19,2920244,-1)
0^3
"KRN",19,2920244,0)
PSO EPHARMACY MENU^ePharmacy Menu^^M^^^^^^^^
"KRN",19,2920244,10,0)
^19.01IP^8^8
"KRN",19,2920244,10,1,0)
2920243^WL
"KRN",19,2920244,10,1,"^")
PSO REJECTS WORKLIST
"KRN",19,2920244,10,2,0)
2920245^VP
"KRN",19,2920244,10,2,"^")
PSO REJECTS VIEW/PROCESS
"KRN",19,2920244,10,3,0)
2920595^MP
"KRN",19,2920244,10,3,"^")
PSO PMP
"KRN",19,2920244,10,4,0)
2920596^PF
"KRN",19,2920244,10,4,"^")
PSO PMP SITE PREFERENCES
"KRN",19,2920244,10,5,0)
2920597^IR
"KRN",19,2920244,10,5,"^")
PSO IGNORED REJECTS REPORT
"KRN",19,2920244,10,7,0)
2920682^SP
"KRN",19,2920244,10,7,"^")
PSO ePHARM SITE PARAMETERS
"KRN",19,2920244,10,8,0)
2920684^NV
"KRN",19,2920244,10,8,"^")
PSO NDC VALIDATE
"KRN",19,2920244,99)
61522,56451
"KRN",19,2920244,"U")
EPHARMACY MENU
"KRN",19,2920245,-1)
0^5
"KRN",19,2920245,0)
PSO REJECTS VIEW/PROCESS^Third Party Payer Rejects - View/Process^^R^^PSORPH^^^^^^OUTPATIENT PHARMACY
"KRN",19,2920245,1,0)
^^6^6^3080411^
"KRN",19,2920245,1,1,0)
This option provides information about Third Party Payer Rejects
"KRN",19,2920245,1,2,0)
that have clinical significance, such as DUR (Drug Utilization
"KRN",19,2920245,1,3,0)
Review) and Fill Too Soon. Past rejects that have already been
"KRN",19,2920245,1,4,0)
CLOSED/RESOLVED can be viewed through this option. Besides, this
"KRN",19,2920245,1,5,0)
option also gives the user the ability to process OPEN/
"KRN",19,2920245,1,6,0)
RESOLVED in order to have them marked CLOSED/RESOLVED.
"KRN",19,2920245,25)
PSOREJP2
"KRN",19,2920245,"U")
THIRD PARTY PAYER REJECTS - VI
"KRN",19,2920595,-1)
0^6
"KRN",19,2920595,0)
PSO PMP^ePharmacy Medication Profile (View Only)^^A^^^^^^^^^^1
"KRN",19,2920595,20)
D EN^PSOPMP0
"KRN",19,2920595,"U")
EPHARMACY MEDICATION PROFILE (
"KRN",19,2920596,-1)
0^7
"KRN",19,2920596,0)
PSO PMP SITE PREFERENCES^ePharmacy Medication Profile Division Preferences^^A^^PSORPH^^^^^^^^1
"KRN",19,2920596,20)
D ^PSOPMPPF
"KRN",19,2920596,"U")
EPHARMACY MEDICATION PROFILE D
"KRN",19,2920597,-1)
0^8
"KRN",19,2920597,0)
PSO IGNORED REJECTS REPORT^Ignored Rejects Report^^R^^^^^^^^OUTPATIENT PHARMACY
"KRN",19,2920597,25)
PSOBPSRP
"KRN",19,2920597,"U")
IGNORED REJECTS REPORT
"KRN",19,2920682,-1)
0^2
"KRN",19,2920682,0)
PSO ePHARM SITE PARAMETERS^ePharmacy Site Parameters^^A^^PSORPH^^^^^^OUTPATIENT PHARMACY^^1
"KRN",19,2920682,1,0)
^19.06^2^2^3080501^^^^
"KRN",19,2920682,1,1,0)
This option allows entry of ePharmacy Site Parameters by divison and will 
"KRN",19,2920682,1,2,0)
require the PSORPH key.
"KRN",19,2920682,20)
D DIV^PSOBPSSP
"KRN",19,2920682,"U")
EPHARMACY SITE PARAMETERS
"KRN",19,2920683,-1)
0^1
"KRN",19,2920683,0)
PSO REJECTS BACKGROUND MESSAGE^Third Party Payer Rejects - Nightly Message^^R^^^^^^^^OUTPATIENT PHARMACY
"KRN",19,2920683,1,0)
^19.06^2^2^3081103^^^
"KRN",19,2920683,1,1,0)
Task to run nightly.  Alerts mailgroup PSO REJECTS BACKGROUND MESSAGE of 
"KRN",19,2920683,1,2,0)
rejects that have been on the list but not commented upon.
"KRN",19,2920683,25)
EN^PSOREJP4
"KRN",19,2920683,200.9)
y
"KRN",19,2920683,"U")
THIRD PARTY PAYER REJECTS - NI
"KRN",19,2920684,-1)
0^9
"KRN",19,2920684,0)
PSO NDC VALIDATE^NDC Validation^^R^^^^^^^^PHARMACY
"KRN",19,2920684,1,0)
^^2^2^3080519^
"KRN",19,2920684,1,1,0)
An option to allow pharmacy technicians to validate the NDC of a billed 
"KRN",19,2920684,1,2,0)
Rx matches the NDC of the dispensed drug..
"KRN",19,2920684,10.1)
Validate NDCs
"KRN",19,2920684,25)
EN^PSONDCV
"KRN",19,2920684,99)
61388,48374
"KRN",19,2920684,"U")
NDC VALIDATION
"KRN",101,1689,-1)
0^9
"KRN",101,1689,0)
VALM NEXT SCREEN^Next Screen^^A^^^^^^^^LIST MANAGER
"KRN",101,1689,1,0)
^^2^2^2920519^^^
"KRN",101,1689,1,1,0)
This action will allow the user to view the next screen
"KRN",101,1689,1,2,0)
of entries, if any exist.
"KRN",101,1689,2,0)
^101.02A^1^1
"KRN",101,1689,2,1,0)
NX
"KRN",101,1689,2,"B","NX",1)

"KRN",101,1689,15)

"KRN",101,1689,20)
D NEXT^VALM4
"KRN",101,1689,99)
61522,56450
"KRN",101,1690,-1)
0^10
"KRN",101,1690,0)
VALM PREVIOUS SCREEN^Previous Screen^^A^^^^^^^^LIST MANAGER
"KRN",101,1690,1,0)
^^2^2^2920113^^
"KRN",101,1690,1,1,0)
This action will allow the user to view the previous screen
"KRN",101,1690,1,2,0)
of entries, if any exist.
"KRN",101,1690,2,0)
^101.02A^3^2
"KRN",101,1690,2,1,0)
PR
"KRN",101,1690,2,2,0)
BK
"KRN",101,1690,2,3,0)
PR
"KRN",101,1690,2,"B","BK",2)

"KRN",101,1690,2,"B","PR",1)

"KRN",101,1690,2,"B","PR",3)

"KRN",101,1690,20)
D PREV^VALM4
"KRN",101,1690,99)
61522,56450
"KRN",101,1691,-1)
0^12
"KRN",101,1691,0)
VALM REFRESH^Re-Display Screen^^A^^^^^^^^LIST MANAGER
"KRN",101,1691,1,0)
^^1^1^2911024^
"KRN",101,1691,1,1,0)
This actions allows the user to re-display the current screen.
"KRN",101,1691,2,0)
^101.02A^1^1
"KRN",101,1691,2,1,0)
RE
"KRN",101,1691,2,"B","RE",1)

"KRN",101,1691,10,0)
^101.01PA^0^0
"KRN",101,1691,20)
D RE^VALM4
"KRN",101,1691,99)
61522,56450
"KRN",101,1692,-1)
0^17
"KRN",101,1692,0)
VALM LAST SCREEN^Last Screen^^A^^^^^^^^LIST MANAGER
"KRN",101,1692,1,0)
^^1^1^2911026^
"KRN",101,1692,1,1,0)
The action will display the last items.
"KRN",101,1692,20)
D LAST^VALM4
"KRN",101,1692,99)
61522,56450
"KRN",101,1693,-1)
0^18
"KRN",101,1693,0)
VALM FIRST SCREEN^First Screen^^A^^^^^^^^LIST MANAGER
"KRN",101,1693,1,0)
^^1^1^2960619^^
"KRN",101,1693,1,1,0)
This action will display the first screen.
"KRN",101,1693,15)

"KRN",101,1693,20)
D FIRST^VALM4
"KRN",101,1693,99)
61522,56450
"KRN",101,1694,-1)
0^11
"KRN",101,1694,0)
VALM UP ONE LINE^Up a Line^^A^^^^^^^^LIST MANAGER
"KRN",101,1694,1,0)
^^1^1^2911027^
"KRN",101,1694,1,1,0)
Move up a line
"KRN",101,1694,20)
D UP^VALM40
"KRN",101,1694,99)
61522,56450
"KRN",101,1695,-1)
0^25
"KRN",101,1695,0)
VALM DOWN A LINE^Down a Line^^A^^^^^^^^LIST MANAGER
"KRN",101,1695,1,0)
^^2^2^2950628^^
"KRN",101,1695,1,1,0)
Move down a line.
"KRN",101,1695,1,2,0)

"KRN",101,1695,3,0)
^101.03P^0^0
"KRN",101,1695,20)
D DOWN^VALM40
"KRN",101,1695,99)
61522,56450
"KRN",101,1697,-1)
0^16
"KRN",101,1697,0)
VALM QUIT^Quit^^A^^^^^^^^
"KRN",101,1697,.1)
 
"KRN",101,1697,1,0)
^^1^1^2911105^
"KRN",101,1697,1,1,0)
This protocol can be used as a generic 'quit' action.
"KRN",101,1697,2,0)
^101.02A^2^2
"KRN",101,1697,2,1,0)
EXIT
"KRN",101,1697,2,2,0)
QUIT
"KRN",101,1697,2,"B","EXIT",1)

"KRN",101,1697,2,"B","QUIT",2)

"KRN",101,1697,15)

"KRN",101,1697,20)
Q
"KRN",101,1697,99)
61522,56450
"KRN",101,1698,-1)
0^13
"KRN",101,1698,0)
VALM PRINT SCREEN^Print Screen^^A^^^^^^^^LIST MANAGER
"KRN",101,1698,1,0)
^^3^3^2920113^^
"KRN",101,1698,1,1,0)
This action allows the user to print the current List Manager
"KRN",101,1698,1,2,0)
display screen.  The header and the current portion of the
"KRN",101,1698,1,3,0)
list are printed.
"KRN",101,1698,20)
D PRT^VALM1
"KRN",101,1698,99)
61522,56450
"KRN",101,1699,-1)
0^14
"KRN",101,1699,0)
VALM PRINT LIST^Print List^^A^^^^^^^^LIST MANAGER
"KRN",101,1699,1,0)
^^2^2^2920113^
"KRN",101,1699,1,1,0)
This action allws the user to print the entire list of
"KRN",101,1699,1,2,0)
entries currently being displayed.
"KRN",101,1699,20)
D PRTL^VALM1
"KRN",101,1699,99)
61522,56450
"KRN",101,1701,-1)
0^23
"KRN",101,1701,0)
VALM TURN ON/OFF MENUS^Auto-Display(On/Off)^^A^^^^^^^^LIST MANAGER
"KRN",101,1701,20)
D MENU^VALM2
"KRN",101,1701,99)
61522,56450
"KRN",101,1703,-1)
0^15
"KRN",101,1703,0)
VALM SEARCH LIST^Search List^^A^^^^^^^^LIST MANAGER
"KRN",101,1703,1,0)
^^1^1^2920303^^
"KRN",101,1703,1,1,0)
Finds text in list of entries.
"KRN",101,1703,20)
D FIND^VALM40
"KRN",101,1703,99)
61522,56450
"KRN",101,1713,-1)
0^19
"KRN",101,1713,0)
VALM GOTO PAGE^Go to Page^^A^^^^^^^^LIST MANAGER
"KRN",101,1713,1,0)
^^1^1^2930113^
"KRN",101,1713,1,1,0)

"KRN",101,1713,20)
D GOTO^VALM40
"KRN",101,1713,99)
61522,56450
"KRN",101,7135,-1)
0^4
"KRN",101,7135,0)
PSO REJECT DISPLAY OVERRIDE^Submit Override Codes^^A^^^^^^^^
"KRN",101,7135,4)
^^^OVR
"KRN",101,7135,20)
D OVR^PSOREJP1
"KRN",101,7135,99)
61522,56450
"KRN",101,7136,-1)
0^27
"KRN",101,7136,0)
PSO REJECT DISPLAY RESUBMIT^Resubmit Claim^^A^^^^^^^^
"KRN",101,7136,4)
^^^RES
"KRN",101,7136,20)
D RES^PSOREJP1
"KRN",101,7136,99)
61522,56450
"KRN",101,7137,-1)
0^20
"KRN",101,7137,0)
PSO REJECT DISPLAY RX EDIT^Edit Rx^^A^^^^^^^^
"KRN",101,7137,4)
^^^ED
"KRN",101,7137,20)
D EDT^PSOREJP1
"KRN",101,7137,99)
61522,56450
"KRN",101,7138,-1)
0^26
"KRN",101,7138,0)
PSO REJECT DISPLAY MENU^Reject Display Menu^^M^^^^^^^^
"KRN",101,7138,4)
26^4
"KRN",101,7138,10,0)
^101.01PA^8^8
"KRN",101,7138,10,2,0)
7136^RES^4^
"KRN",101,7138,10,2,"^")
PSO REJECT DISPLAY RESUBMIT
"KRN",101,7138,10,3,0)
7135^OVR^5^
"KRN",101,7138,10,3,"^")
PSO REJECT DISPLAY OVERRIDE
"KRN",101,7138,10,4,0)
7141^IGN^3^
"KRN",101,7138,10,4,"^")
PSO REJECT DISPLAY IGNORE
"KRN",101,7138,10,5,0)
7139^VW^1^
"KRN",101,7138,10,5,"^")
PSO REJECT DISPLAY RX VIEW
"KRN",101,7138,10,7,0)
7282^MP^2^
"KRN",101,7138,10,7,"^")
PSO REJECT DISPLAY MED PROFILE
"KRN",101,7138,10,8,0)
7142^CSD^6^
"KRN",101,7138,10,8,"^")
PSO REJECT DISPLAY SUSPENSE DATE
"KRN",101,7138,20)

"KRN",101,7138,26)
D SHOW^VALM,HDR^PSOREJP1
"KRN",101,7138,28)
Select: 
"KRN",101,7138,99)
61522,56450
"KRN",101,7139,-1)
0^2
"KRN",101,7139,0)
PSO REJECT DISPLAY RX VIEW^View Rx^^A^^^^^^^^
"KRN",101,7139,20)
D VIEW^PSOREJP1
"KRN",101,7139,99)
61522,56450
"KRN",101,7141,-1)
0^28
"KRN",101,7141,0)
PSO REJECT DISPLAY IGNORE^Ignore Reject^^A^^^^^^^^
"KRN",101,7141,4)
^^^CR
"KRN",101,7141,20)
D CLO^PSOREJP2
"KRN",101,7141,99)
61522,56450
"KRN",101,7142,-1)
0^5
"KRN",101,7142,0)
PSO REJECT DISPLAY SUSPENSE DATE^Change Suspense Date^^A^^^^^^^^
"KRN",101,7142,4)
^^^
"KRN",101,7142,20)
D CHG^PSOREJP2
"KRN",101,7142,99)
61522,56450
"KRN",101,7143,-1)
0^29
"KRN",101,7143,0)
PSO REJECT DISPLAY MENU - RESOLVED^Reject Display Menu - Resolved^^M^^^^^^^^
"KRN",101,7143,4)
26^4
"KRN",101,7143,10,0)
^101.01PA^5^5
"KRN",101,7143,10,1,0)
7139^VW^1^
"KRN",101,7143,10,1,"^")
PSO REJECT DISPLAY RX VIEW
"KRN",101,7143,10,2,0)
7137^ED^4^
"KRN",101,7143,10,2,"^")
PSO REJECT DISPLAY RX EDIT
"KRN",101,7143,10,3,0)
7144^OPN^3^
"KRN",101,7143,10,3,"^")
PSO REJECT DISPLAY REOPEN
"KRN",101,7143,10,4,0)
7282^MP^2^
"KRN",101,7143,10,4,"^")
PSO REJECT DISPLAY MED PROFILE
"KRN",101,7143,10,5,0)
7284^COM^^
"KRN",101,7143,10,5,"^")
PSO REJECT DISPLAY ADD COMMENT
"KRN",101,7143,26)
D SHOW^VALM,HDR^PSOREJP1
"KRN",101,7143,28)
Select: 
"KRN",101,7143,99)
61522,56450
"KRN",101,7144,-1)
0^30
"KRN",101,7144,0)
PSO REJECT DISPLAY REOPEN^Reopen Reject^^A^^^^^^^^
"KRN",101,7144,4)
^^^
"KRN",101,7144,20)
D OPN^PSOREJP2
"KRN",101,7144,99)
61522,56450
"KRN",101,7282,-1)
0^3
"KRN",101,7282,0)
PSO REJECT DISPLAY MED PROFILE^Medication Profile^^A^^^^^^^^
"KRN",101,7282,4)
^^^MP
"KRN",101,7282,20)
D MP^PSOREJP1
"KRN",101,7282,99)
61522,56450
"KRN",101,7284,-1)
0^22
"KRN",101,7284,0)
PSO REJECT DISPLAY ADD COMMENT^Add Comments^^A^^^^^^^^
"KRN",101,7284,20)
D ADDCOM^PSOREJP3
"KRN",101,7284,99)
61522,56450
"KRN",101,7285,-1)
0^21
"KRN",101,7285,0)
PSO REJECT DISPLAY CLARIFICATION CODE^Submit Clarif. Code^^A^^^^^^^^
"KRN",101,7285,4)
^^^CLA
"KRN",101,7285,20)
D CLA^PSOREJP1
"KRN",101,7285,99)
61522,56450
"KRN",101,7286,-1)
0^8
"KRN",101,7286,0)
PSO REJECT DISPLAY HIDDEN MENU^Reject Display Hidden Menu^^M^^^^^^^^
"KRN",101,7286,1,0)
^101.06^1^1^3070320^^^^
"KRN",101,7286,1,1,0)
This is the hidden menu option for the Reject Information(UNRESOLVED) [PSO REJECT DISPLAY] ListMan screen.
"KRN",101,7286,4)
26^3
"KRN",101,7286,10,0)
^101.01PA^20^20
"KRN",101,7286,10,1,0)
1689^+^10^
"KRN",101,7286,10,1,"^")
VALM NEXT SCREEN
"KRN",101,7286,10,2,0)
1690^-^11^
"KRN",101,7286,10,2,"^")
VALM PREVIOUS SCREEN
"KRN",101,7286,10,3,0)
1694^UP^13^
"KRN",101,7286,10,3,"^")
VALM UP ONE LINE
"KRN",101,7286,10,5,0)
1691^RD^19^
"KRN",101,7286,10,5,"^")
VALM REFRESH
"KRN",101,7286,10,6,0)
1698^PS^20^
"KRN",101,7286,10,6,"^")
VALM PRINT SCREEN
"KRN",101,7286,10,7,0)
1699^PL^21^
"KRN",101,7286,10,7,"^")
VALM PRINT LIST
"KRN",101,7286,10,10,0)
1703^SL^22^
"KRN",101,7286,10,10,"^")
VALM SEARCH LIST
"KRN",101,7286,10,11,0)
1697^QU^24^
"KRN",101,7286,10,11,"^")
VALM QUIT
"KRN",101,7286,10,12,0)
1692^LS^17^
"KRN",101,7286,10,12,"^")
VALM LAST SCREEN
"KRN",101,7286,10,13,0)
1693^FS^16^
"KRN",101,7286,10,13,"^")
VALM FIRST SCREEN
"KRN",101,7286,10,14,0)
1713^GO^18^
"KRN",101,7286,10,14,"^")
VALM GOTO PAGE
"KRN",101,7286,10,15,0)
7137^ED^3^
"KRN",101,7286,10,15,"^")
PSO REJECT DISPLAY RX EDIT
"KRN",101,7286,10,16,0)
7285^CLA^2^
"KRN",101,7286,10,16,"^")
PSO REJECT DISPLAY CLARIFICATION CODE
"KRN",101,7286,10,17,0)
7284^COM^1^
"KRN",101,7286,10,17,"^")
PSO REJECT DISPLAY ADD COMMENT
"KRN",101,7286,10,18,0)
1701^ADPL^23^
"KRN",101,7286,10,18,"^")
VALM TURN ON/OFF MENUS
"KRN",101,7286,10,19,0)
7287^PA^4^
"KRN",101,7286,10,19,"^")
PSO REJECT DISPLAY PRIOR AUTHORIZATION
"KRN",101,7286,10,20,0)
1695^DN^12^
"KRN",101,7286,10,20,"^")
VALM DOWN A LINE
"KRN",101,7286,15)

"KRN",101,7286,99)
61522,56450
"KRN",101,7287,-1)
0^24
"KRN",101,7287,0)
PSO REJECT DISPLAY PRIOR AUTHORIZATION^Submit Prior Auth.^^A^^^^^^^^
"KRN",101,7287,4)
^^^PA
"KRN",101,7287,20)
D PA^PSOREJP1
"KRN",101,7287,99)
61522,56450
"KRN",101,7303,-1)
0^1
"KRN",101,7303,0)
PSO REJECT TRICARE MENU^PSO REJECT DISPLAY TRICARE^^M^^^^^^^^
"KRN",101,7303,4)
26^4^^MP
"KRN",101,7303,10,0)
^101.01PA^7^7
"KRN",101,7303,10,1,0)
7139^VW^1^
"KRN",101,7303,10,1,"^")
PSO REJECT DISPLAY RX VIEW
"KRN",101,7303,10,2,0)
7282^MP^2^
"KRN",101,7303,10,2,"^")
PSO REJECT DISPLAY MED PROFILE
"KRN",101,7303,10,3,0)
7135^OVR^7^
"KRN",101,7303,10,3,"^")
PSO REJECT DISPLAY OVERRIDE
"KRN",101,7303,10,4,0)
7142^CSD^8^
"KRN",101,7303,10,4,"^")
PSO REJECT DISPLAY SUSPENSE DATE
"KRN",101,7303,10,5,0)
7304^FIL^4^
"KRN",101,7303,10,5,"^")
PSO REJECT FILL RX
"KRN",101,7303,10,6,0)
7305^DC^5^
"KRN",101,7303,10,6,"^")
PSO REJECT DISCONTINUE
"KRN",101,7303,10,7,0)
7136^RES^3^
"KRN",101,7303,10,7,"^")
PSO REJECT DISPLAY RESUBMIT
"KRN",101,7303,26)
D SHOW^VALM,HDR^PSOREJP1
"KRN",101,7303,99)
61522,56450
"KRN",101,7304,-1)
0^6
"KRN",101,7304,0)
PSO REJECT FILL RX^Fill Rx^^A^^^^^^^^
"KRN",101,7304,4)
^^^FIL
"KRN",101,7304,20)
D FILL^PSOREJP3
"KRN",101,7304,99)
61522,56450
"KRN",101,7305,-1)
0^7
"KRN",101,7305,0)
PSO REJECT DISCONTINUE^Discontinue Rx^^A^^^^^^^^
"KRN",101,7305,4)
^^^DC
"KRN",101,7305,20)
D DC^PSOREJP3
"KRN",101,7305,99)
61522,56450
"KRN",409.61,615,-1)
0^2
"KRN",409.61,615,0)
PSO REJECT DISPLAY^1^^80^7^20^0^1^^PSO REJECT DISPLAY MENU^Reject Information(UNRESOLVED)^1^^1
"KRN",409.61,615,1)
^PSO REJECT DISPLAY HIDDEN MENU
"KRN",409.61,615,"ARRAY")
 ^TMP("PSOREJP1",$J)
"KRN",409.61,615,"COL",0)
^409.621^^0
"KRN",409.61,615,"FNL")
D EXIT^PSOREJP1
"KRN",409.61,615,"HDR")
D HDR^PSOREJP1
"KRN",409.61,615,"HLP")
D HELP^PSOREJP1
"KRN",409.61,615,"INIT")
D INIT^PSOREJP1
"KRN",409.61,616,-1)
0^3
"KRN",409.61,616,0)
PSO REJECT DISPLAY - RESOLVED^1^^80^7^20^0^1^^PSO REJECT DISPLAY MENU - RESOLVED^Reject Information(RESOLVED)^1^^1
"KRN",409.61,616,1)
^PSO HIDDEN ACTIONS #1
"KRN",409.61,616,"ARRAY")
 ^TMP("PSOREJP1",$J)
"KRN",409.61,616,"FNL")
D EXIT^PSOREJP1
"KRN",409.61,616,"HDR")
D HDR^PSOREJP1
"KRN",409.61,616,"HLP")
D HELP^PSOREJP1
"KRN",409.61,616,"INIT")
D INIT^PSOREJP1
"KRN",409.61,659,-1)
0^1
"KRN",409.61,659,0)
PSO REJECT TRICARE^1^^80^7^19^0^1^^PSO REJECT TRICARE MENU^Reject Information (TRICARE)^1^^1
"KRN",409.61,659,1)
^PSO REJECT DISPLAY HIDDEN MENU
"KRN",409.61,659,"ARRAY")
 ^TMP("PSOREJP1",$J)
"KRN",409.61,659,"FNL")
D EXIT^PSOREJP1
"KRN",409.61,659,"HDR")
D HDR^PSOREJP1
"KRN",409.61,659,"HLP")
D HELP^PSOREJP1
"KRN",409.61,659,"INIT")
D INIT^PSOREJP1
"MBREQ")
1
"ORD",11,3.8)
3.8;11;;;MAILG^XPDTA1;MAILGF1^XPDIA1;MAILGE1^XPDIA1;MAILGF2^XPDIA1;;MAILGDEL^XPDIA1(%)
"ORD",11,3.8,0)
MAIL GROUP
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",17,409.61)
409.61;17;1;;;;;;;LMDEL^XPDIA1
"ORD",17,409.61,0)
LIST TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",170,-1)
1^1
"PKG",170,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",170,20,0)
^9.402P^^
"PKG",170,22,0)
^9.49I^1^1
"PKG",170,22,1,0)
7.0^2971216^2981113^1
"PKG",170,22,1,"PAH",1,0)
289^3090615^520665238
"PKG",170,22,1,"PAH",1,1,0)
^^213^213^3090615
"PKG",170,22,1,"PAH",1,1,1,0)
DThis patch has enhancements which extend the capabilities of the Veterans
"PKG",170,22,1,"PAH",1,1,2,0)
Health Information Systems and Technology Architecture (VistA) electronic 
"PKG",170,22,1,"PAH",1,1,3,0)
pharmacy (ePharmacy) billing system.  Below is a list of all the 
"PKG",170,22,1,"PAH",1,1,4,0)
applications involved in this project along with their patch number:
"PKG",170,22,1,"PAH",1,1,5,0)
 
"PKG",170,22,1,"PAH",1,1,6,0)
   APPLICATION/VERSION                                  PATCH
"PKG",170,22,1,"PAH",1,1,7,0)
   --------------------------------------------------------------
"PKG",170,22,1,"PAH",1,1,8,0)
   CONSOLIDATED MAIL OUTPATIENT PHARMACY (CMOP) V. 2.0  PSX*2*65
"PKG",170,22,1,"PAH",1,1,9,0)
   PHARMACY DATA MANAGEMENT (PDM) V. 1.0                PSS*1*131
"PKG",170,22,1,"PAH",1,1,10,0)
   OUTPATIENT PHARMACY (OP) V. 7.0                      PSO*7*289
"PKG",170,22,1,"PAH",1,1,11,0)
   INTEGRATED BILLING (IB) V. 2.0                       IB*2*384
"PKG",170,22,1,"PAH",1,1,12,0)
   ELECTRONIC CLAIMS MANAGEMENT ENGINE (ECME) V. 1.0    BPS*1*7
"PKG",170,22,1,"PAH",1,1,13,0)
 
"PKG",170,22,1,"PAH",1,1,14,0)
The last three patches (PSO*7*289, IB*2*384 and BPS*1*7) will be released 
"PKG",170,22,1,"PAH",1,1,15,0)
in the Kernel Installation and Distribution System (KIDS) multi-build 
"PKG",170,22,1,"PAH",1,1,16,0)
distribution BPS PSO IB BUNDLE 3.0.  Patches PSX*2*65 and PSS*1*131 will 
"PKG",170,22,1,"PAH",1,1,17,0)
be released as stand-alone patches.  Since there is an implementation 
"PKG",170,22,1,"PAH",1,1,18,0)
dependency between the multi-build distribution and the stand-alone 
"PKG",170,22,1,"PAH",1,1,19,0)
patches, PSX*2*65 and PSS*1*131 must be installed prior to the 
"PKG",170,22,1,"PAH",1,1,20,0)
installation of the multi-build.  For more specific instructions please 
"PKG",170,22,1,"PAH",1,1,21,0)
refer to the installation steps provided in each of the patches.
"PKG",170,22,1,"PAH",1,1,22,0)
 
"PKG",170,22,1,"PAH",1,1,23,0)
This patch modifies the Outpatient Pharmacy v7.0 application as described
"PKG",170,22,1,"PAH",1,1,24,0)
below:
"PKG",170,22,1,"PAH",1,1,25,0)
 
"PKG",170,22,1,"PAH",1,1,26,0)
1.  A modification was made to prevent users from entering a suspense date
"PKG",170,22,1,"PAH",1,1,27,0)
that is greater than the fill date plus 90 days.  Dates where the fill
"PKG",170,22,1,"PAH",1,1,28,0)
date plus 90 days is greater than the expiration date will not be allowed.
"PKG",170,22,1,"PAH",1,1,29,0)
 
"PKG",170,22,1,"PAH",1,1,30,0)
2.  Functionality to allow non-DUR/RTS reject to be placed on Third Party 
"PKG",170,22,1,"PAH",1,1,31,0)
Payer Rejects - Worklist [PSO REJECTS WORKLIST] option was added.  To 
"PKG",170,22,1,"PAH",1,1,32,0)
accomplish this the following additions were made:
"PKG",170,22,1,"PAH",1,1,33,0)
 
"PKG",170,22,1,"PAH",1,1,34,0)
    a.  A new EPHARMACY SITE PARAMETERS FILE (#52.86) was added to store
"PKG",170,22,1,"PAH",1,1,35,0)
        ePharmacy specific parameters by division.  Along with this file, 
"PKG",170,22,1,"PAH",1,1,36,0)
        a new EPHARMACY SITE PARAMETERS [PSO ePHARM SITE PARAMATERS]
"PKG",170,22,1,"PAH",1,1,37,0)
        option was added for entry/edit of parameters.  Regardless of any
"PKG",170,22,1,"PAH",1,1,38,0)
        parameters defined in this new file, Refill-Too-Soon (RTS), Drug
"PKG",170,22,1,"PAH",1,1,39,0)
        Utilization Review(DUR) and Tricare rejects will always be placed
"PKG",170,22,1,"PAH",1,1,40,0)
        on the Pharmacy Reject Worklist.
"PKG",170,22,1,"PAH",1,1,41,0)
 
"PKG",170,22,1,"PAH",1,1,42,0)
        Sites will have the ability to select to allow all third party 
"PKG",170,22,1,"PAH",1,1,43,0)
        rejects to pass to the the Third Party Payer Rejects - Worklist
"PKG",170,22,1,"PAH",1,1,44,0)
        which is also referred to as the Pharmacy Reject Worklist or they
"PKG",170,22,1,"PAH",1,1,45,0)
        can choose to specify individual reject codes. Individual third
"PKG",170,22,1,"PAH",1,1,46,0)
        party reject codes can be defined to be automatically placed on
"PKG",170,22,1,"PAH",1,1,47,0)
        the worklist or defined to require OPECC intervention. If the site
"PKG",170,22,1,"PAH",1,1,48,0)
        chooses to allow all rejects to be placed on the worklist,
"PKG",170,22,1,"PAH",1,1,49,0)
        individual codes are overridden but not deleted from the file.
"PKG",170,22,1,"PAH",1,1,50,0)
 
"PKG",170,22,1,"PAH",1,1,51,0)
     b. For display of non-DUR/RTS rejects for the Third Party Payer
"PKG",170,22,1,"PAH",1,1,52,0)
        Rejects - Worklist [PSO REJECTS WORKLIST] option, rejects passed
"PKG",170,22,1,"PAH",1,1,53,0)
        via OPECC manual intervention will be denoted in the comment
"PKG",170,22,1,"PAH",1,1,54,0)
        section of the Reject Information screen as:
"PKG",170,22,1,"PAH",1,1,55,0)
 
"PKG",170,22,1,"PAH",1,1,56,0)
        - JUN 09, 2008@14:04:18 - Transferred by OPECC. (user,name)
"PKG",170,22,1,"PAH",1,1,57,0)
 
"PKG",170,22,1,"PAH",1,1,58,0)
    
"PKG",170,22,1,"PAH",1,1,59,0)
        Rejects passed automatically will be denoted in the comments 
"PKG",170,22,1,"PAH",1,1,60,0)
        section of  the Reject Information Screen as 
"PKG",170,22,1,"PAH",1,1,61,0)
 
"PKG",170,22,1,"PAH",1,1,62,0)
       - JUN 09, 2008@16:00:09 - Automatically transferred due to override
"PKG",170,22,1,"PAH",1,1,63,0)
         for reject code. (user,name)
"PKG",170,22,1,"PAH",1,1,64,0)
 
"PKG",170,22,1,"PAH",1,1,65,0)
        All rejects other than Refill-Too-Soon, DUR, and Tricare will be 
"PKG",170,22,1,"PAH",1,1,66,0)
        displayed at the end of the listing under "OTHER REJECTS"
"PKG",170,22,1,"PAH",1,1,67,0)
        header. The "OTHER REJECTS" header will be displayed regardless of
"PKG",170,22,1,"PAH",1,1,68,0)
        whether the GI - Group Insurance action is toggled on or off.  
"PKG",170,22,1,"PAH",1,1,69,0)
        
"PKG",170,22,1,"PAH",1,1,70,0)
        Non-DUR/RTS rejections will be resolved with the existing
"PKG",170,22,1,"PAH",1,1,71,0)
        functionality and will be resubmitted to ECME in the same manner
"PKG",170,22,1,"PAH",1,1,72,0)
        as DUR/RTS rejections.
"PKG",170,22,1,"PAH",1,1,73,0)
 
"PKG",170,22,1,"PAH",1,1,74,0)
3.  A modification was made to not allow a claim to be reversed through 
"PKG",170,22,1,"PAH",1,1,75,0)
ECME for an unreleased CMOP fill when the prescription/fill is 
"PKG",170,22,1,"PAH",1,1,76,0)
discontinued. If the fill is either a CMOP released or Non-CMOP released 
"PKG",170,22,1,"PAH",1,1,77,0)
fill the reversal will be performed.  Because the software already 
"PKG",170,22,1,"PAH",1,1,78,0)
performs a reversal for unsuccessful/not dispensed claims, no changes are 
"PKG",170,22,1,"PAH",1,1,79,0)
needed for reversing discontinued non-dispensed fills.  Also, no changes 
"PKG",170,22,1,"PAH",1,1,80,0)
are needed when the NDC from CMOP differs from the NDC on the claim 
"PKG",170,22,1,"PAH",1,1,81,0)
because this function is already performed by existing software.
"PKG",170,22,1,"PAH",1,1,82,0)
 
"PKG",170,22,1,"PAH",1,1,83,0)
4. New functionality was added to prevent prescriptions from being 
"PKG",170,22,1,"PAH",1,1,84,0)
filled/sent to CMOP when a host processing error occurs when a claim is 
"PKG",170,22,1,"PAH",1,1,85,0)
submitted through ECME. The host processing errors are identified by 
"PKG",170,22,1,"PAH",1,1,86,0)
reject codes M6, M8, NN, and 99. The following conditions apply when this 
"PKG",170,22,1,"PAH",1,1,87,0)
scenario occurs.
"PKG",170,22,1,"PAH",1,1,88,0)
 
"PKG",170,22,1,"PAH",1,1,89,0)
    a. The transmission of the Rx/fill will be delayed 1 day in hopes
"PKG",170,22,1,"PAH",1,1,90,0)
       that the host processing issues will be resolved.
"PKG",170,22,1,"PAH",1,1,91,0)
    b. An activity log entry will be defined to state the date/time 
"PKG",170,22,1,"PAH",1,1,92,0)
       along with a comment stating that the Rx/fill was left in suspense
"PKG",170,22,1,"PAH",1,1,93,0)
       hold due to a host processing error.
"PKG",170,22,1,"PAH",1,1,94,0)
    c. This added functionality does not include the Pull Early from 
"PKG",170,22,1,"PAH",1,1,95,0)
       Suspense function.
"PKG",170,22,1,"PAH",1,1,96,0)
 
"PKG",170,22,1,"PAH",1,1,97,0)
5. New functionality was added to the Print from Suspense File [PSO 
"PKG",170,22,1,"PAH",1,1,98,0)
PNDLBL] option to prevent ePharmacy prescriptions from being pulled early
"PKG",170,22,1,"PAH",1,1,99,0)
from suspense until 3/4 of the days supply of the Rx/fill has elapsed.  
"PKG",170,22,1,"PAH",1,1,100,0)
The system will not hold a prescription for 3/4 days supply when:
"PKG",170,22,1,"PAH",1,1,101,0)
 
"PKG",170,22,1,"PAH",1,1,102,0)
    -   the previous fill was not ECME billable
"PKG",170,22,1,"PAH",1,1,103,0)
    -   the Rx is flagged for SC or EI
"PKG",170,22,1,"PAH",1,1,104,0)
    -   the DEA special Handling code is non billable (i.e. has M or 0 
"PKG",170,22,1,"PAH",1,1,105,0)
             (zero) or  (I, S, N, and/or 9)) without and E.
"PKG",170,22,1,"PAH",1,1,106,0)
    -   the Rx is a zero fill on a renewal
"PKG",170,22,1,"PAH",1,1,107,0)
    -   the patient does not currently have insurance
"PKG",170,22,1,"PAH",1,1,108,0)
 
"PKG",170,22,1,"PAH",1,1,109,0)
6. A modification was made to PRESCRIPTION file (#52), REJECT INFO 
"PKG",170,22,1,"PAH",1,1,110,0)
sub-file (#52.25), CLARIFICATION CODE field (#24). This was a set of codes
"PKG",170,22,1,"PAH",1,1,111,0)
field.  It is now a pointer to file #9002313.25 (BPS NCPDP CLARIFICATION
"PKG",170,22,1,"PAH",1,1,112,0)
CODE).  A post install routine will go through the reject info subfile and
"PKG",170,22,1,"PAH",1,1,113,0)
convert the old set of code values to the appropriate new pointer values.
"PKG",170,22,1,"PAH",1,1,114,0)
The post install will send a mail message to the person installing the
"PKG",170,22,1,"PAH",1,1,115,0)
build which details the affected rejected prescriptions.  The 'Submit
"PKG",170,22,1,"PAH",1,1,116,0)
Clarif. Code' protocol [PSO REJECT DISPLAY CLARIFICATION CODE] has been
"PKG",170,22,1,"PAH",1,1,117,0)
altered to use the new pointer value.
"PKG",170,22,1,"PAH",1,1,118,0)
 
"PKG",170,22,1,"PAH",1,1,119,0)
7. The 'Edit NDC and DAW Code of Discontinued/Expired Prescriptions' 
"PKG",170,22,1,"PAH",1,1,120,0)
functionality introduced in PSO*7.0*281 has been extended to also allow 
"PKG",170,22,1,"PAH",1,1,121,0)
edits of prescriptions with a status of DISCONTINUED BY PROVIDER and 
"PKG",170,22,1,"PAH",1,1,122,0)
DISCONTINUED (EDIT).
"PKG",170,22,1,"PAH",1,1,123,0)
 
"PKG",170,22,1,"PAH",1,1,124,0)
8. New functionality was added to create a nightly background mail 
"PKG",170,22,1,"PAH",1,1,125,0)
message regarding open/unresolved rejects on the reject worklist.  The 
"PKG",170,22,1,"PAH",1,1,126,0)
'Third Party Payer Rejects - Nightly Message' option [PSO REJECTS 
"PKG",170,22,1,"PAH",1,1,127,0)
BACKGROUND MESSAGE] will be queued to run every 24 hours by the post 
"PKG",170,22,1,"PAH",1,1,128,0)
install routine.  This option is intended to be a stand alone option and 
"PKG",170,22,1,"PAH",1,1,129,0)
should not be placed on any menu.  The message will be delivered to the 
"PKG",170,22,1,"PAH",1,1,130,0)
'PSO REJECTS BACKGROUND MESSAGE' mailgroup; this mailgroup should be 
"PKG",170,22,1,"PAH",1,1,131,0)
populated with appropriate ePharmacy users to receive the information.  
"PKG",170,22,1,"PAH",1,1,132,0)
Mail messages are generated for each division. Sites may alter EPHARMACY
"PKG",170,22,1,"PAH",1,1,133,0)
SITE PARAMETERS file (#52.86) REJECT WORKLIST DAYS field (#4) for each 
"PKG",170,22,1,"PAH",1,1,134,0)
division using the ePharmacy Site Parameters option [PSO EPHARM SITE 
"PKG",170,22,1,"PAH",1,1,135,0)
PARAMETERS] of the ePharmacy Menu.  If no sites are defined in the 
"PKG",170,22,1,"PAH",1,1,136,0)
EPHARMACY SITE PARAMETERS file (#52.86), no message will be generated.  
"PKG",170,22,1,"PAH",1,1,137,0)
This parameter may be defined to be 1 to 30 days that an uncommented
"PKG",170,22,1,"PAH",1,1,138,0)
reject can remain on the reject worklist without being included in the
"PKG",170,22,1,"PAH",1,1,139,0)
nightly reject worklist alert mail message.  The following are the
"PKG",170,22,1,"PAH",1,1,140,0)
criteria for a reject to be included in the mail message:
"PKG",170,22,1,"PAH",1,1,141,0)
 
"PKG",170,22,1,"PAH",1,1,142,0)
    a. The prescription is active, suspensed, expired, or on hold.
"PKG",170,22,1,"PAH",1,1,143,0)
    b. The prescription is unreleased.
"PKG",170,22,1,"PAH",1,1,144,0)
    c. The claim has been on the Reject Worklist for more days than the
"PKG",170,22,1,"PAH",1,1,145,0)
       value in the REJECT WORKLIST DAYS field for the division.
"PKG",170,22,1,"PAH",1,1,146,0)
    d. The claim has no comments added within the date range.
"PKG",170,22,1,"PAH",1,1,147,0)
 
"PKG",170,22,1,"PAH",1,1,148,0)
9. New functionality was added to allow NDC validation of third party
"PKG",170,22,1,"PAH",1,1,149,0)
payable prescriptions by pharmacy technicians.  Current functionality
"PKG",170,22,1,"PAH",1,1,150,0)
requires a pharmacist to perform this task.  In addition, for the
"PKG",170,22,1,"PAH",1,1,151,0)
PRESCRIPTION file(#52) and the REFILL sub-file (#52.1), the DATE NDC
"PKG",170,22,1,"PAH",1,1,152,0)
VALIDATED field (#83) and NDC VALIDATED BY field (#84) will be captured
"PKG",170,22,1,"PAH",1,1,153,0)
when the NDC is validated for a prescription or refill; this validation
"PKG",170,22,1,"PAH",1,1,154,0)
information will be displayed when prescriptions are released; if the NDCs
"PKG",170,22,1,"PAH",1,1,155,0)
have not been validated, that information will be displayed instead.  The
"PKG",170,22,1,"PAH",1,1,156,0)
'NDC Validation' option [PSO NDC VALIDATE] has been added to the ePharmacy
"PKG",170,22,1,"PAH",1,1,157,0)
Menu for use by technicians.  The option will work as follows:
"PKG",170,22,1,"PAH",1,1,158,0)
 
"PKG",170,22,1,"PAH",1,1,159,0)
    a. The technician will be prompted to scan or enter a prescription 
"PKG",170,22,1,"PAH",1,1,160,0)
       number.  An '^' may be entered to halt the option.
"PKG",170,22,1,"PAH",1,1,161,0)
    b. The system will evaluate the Rx.  If the Rx NDC has already been 
"PKG",170,22,1,"PAH",1,1,162,0)
       validated, the technician will be prompted if they wish to
"PKG",170,22,1,"PAH",1,1,163,0)
       revalidate. If the answer is yes, the technician will be allowed to
"PKG",170,22,1,"PAH",1,1,164,0)
       proceed.  If the answer is no, the technician will be returned to
"PKG",170,22,1,"PAH",1,1,165,0)
       the select a prescription prompt.
"PKG",170,22,1,"PAH",1,1,166,0)
    c. If the Rx is CMOP, external interface or released, the user will
"PKG",170,22,1,"PAH",1,1,167,0)
       not be allowed to verify the Rx.
"PKG",170,22,1,"PAH",1,1,168,0)
    d. The system will display information about the Rx, notate that the
"PKG",170,22,1,"PAH",1,1,169,0)
       Rx has not been previously verified and will prompt for PRODUCT 
"PKG",170,22,1,"PAH",1,1,170,0)
       NDC. A valid PRODUCT NDC must be entered for this prompt.  Valid
"PKG",170,22,1,"PAH",1,1,171,0)
       PRODUCT NDC's are those defined for the drug in Drug file (#50) as
"PKG",170,22,1,"PAH",1,1,172,0)
       an NDC of a synonym or the default NDC.
"PKG",170,22,1,"PAH",1,1,173,0)
    e. The system will compare the Rx NDC to the PRODUCT NDC submitted on
"PKG",170,22,1,"PAH",1,1,174,0)
       the ePharmacy claim.  If the NDCs do not match, the system will
"PKG",170,22,1,"PAH",1,1,175,0)
       reverse and resubmit a third party claim with the new NDC and 
"PKG",170,22,1,"PAH",1,1,176,0)
       store the new NDC on the fill.
"PKG",170,22,1,"PAH",1,1,177,0)
    f. If the prescription is defined as TRICARE and is not payable, the 
"PKG",170,22,1,"PAH",1,1,178,0)
       system will display an appropriate message and the technician will 
"PKG",170,22,1,"PAH",1,1,179,0)
       be returned to the select a prescription prompt.
"PKG",170,22,1,"PAH",1,1,180,0)
    g. If the prescription is defined as TRICARE and the reversed claim 
"PKG",170,22,1,"PAH",1,1,181,0)
       returns not payable, the system will display an appropriate 
"PKG",170,22,1,"PAH",1,1,182,0)
       message and the technician will be returned to the select a
"PKG",170,22,1,"PAH",1,1,183,0)
       prescription prompt.
"PKG",170,22,1,"PAH",1,1,184,0)
    h. Otherwise, the system will update the NDC validation fields for the
"PKG",170,22,1,"PAH",1,1,185,0)
       Rx/Fill, and the technician will be returned to the select a
"PKG",170,22,1,"PAH",1,1,186,0)
       prescription prompt.
"PKG",170,22,1,"PAH",1,1,187,0)
 
"PKG",170,22,1,"PAH",1,1,188,0)
10.  The RES - Resubmit Claim action was added to the Reject Information
"PKG",170,22,1,"PAH",1,1,189,0)
(TRICARE) screen of the Third Party Payer Rejects - Worklist [PSO REJECTS
"PKG",170,22,1,"PAH",1,1,190,0)
WORKLIST] option.
"PKG",170,22,1,"PAH",1,1,191,0)
 
"PKG",170,22,1,"PAH",1,1,192,0)
11.  The following functionality will work only if the REGISTRATION
"PKG",170,22,1,"PAH",1,1,193,0)
package V.5.3 patch DG*5.3*688 that introduces the COUNTRY field to the
"PKG",170,22,1,"PAH",1,1,194,0)
PATIENT file (#2) is installed:
"PKG",170,22,1,"PAH",1,1,195,0)
 
"PKG",170,22,1,"PAH",1,1,196,0)
   When using the Print from Suspense File [PSO PNDLBL] option, if the
"PKG",170,22,1,"PAH",1,1,197,0)
   routing is MAIL and the address is Foreign, it will be treated just
"PKG",170,22,1,"PAH",1,1,198,0)
   like the BAD ADDRESS INDICATOR or DO NOT MAIL order where:
"PKG",170,22,1,"PAH",1,1,199,0)
 
"PKG",170,22,1,"PAH",1,1,200,0)
   a. The prescription will not be sent to the automated filling equipment
"PKG",170,22,1,"PAH",1,1,201,0)
      and/or to the label printer. The fill will remain on suspense until
"PKG",170,22,1,"PAH",1,1,202,0)
      it is pulled early, the routing is changed to window, or the address
"PKG",170,22,1,"PAH",1,1,203,0)
      is changed.
"PKG",170,22,1,"PAH",1,1,204,0)
 
"PKG",170,22,1,"PAH",1,1,205,0)
   b. For the first time attempt to print from suspense, an entry will be
"PKG",170,22,1,"PAH",1,1,206,0)
      added to the activity log and a MailMan message will be generated to
"PKG",170,22,1,"PAH",1,1,207,0)
      the user who queued the job to print from suspense and the members
"PKG",170,22,1,"PAH",1,1,208,0)
      of the PSO EXTERNAL DISPENSE ALERTS mail group.
"PKG",170,22,1,"PAH",1,1,209,0)
 
"PKG",170,22,1,"PAH",1,1,210,0)
12.  When the NDC changes during auto-release of the prescription for CMOP
"PKG",170,22,1,"PAH",1,1,211,0)
or OPAI fills, the fill date on the fill be updated to become the same as
"PKG",170,22,1,"PAH",1,1,212,0)
the release date.  An entry will be made in the activity log for the fill 
"PKG",170,22,1,"PAH",1,1,213,0)
to denote the changed date.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
28
"RTN","PSO7P289")
0^28^B95661836
"RTN","PSO7P289",1,0)
PSO7P289 ;CMF - PSO*7*289 Convert file 52.25/field 24 to pointer ;06/09/2008
"RTN","PSO7P289",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**289**;May 2008;Build 107
"RTN","PSO7P289",3,0)
 ;;Reference to 9002313.25 supported by DBIA 5064
"RTN","PSO7P289",4,0)
 ;
"RTN","PSO7P289",5,0)
 N NAMSP,PATCH,JOBN,JOBDUZ,DTOUT,DUOUT,ZTSK,ZTRTN,ZTIO,ZTDTH,ZTDESC,QUIT,Y,ZTQUEUED,ZTREQ,ZTSAVE
"RTN","PSO7P289",6,0)
 S NAMSP=$$NAMSP
"RTN","PSO7P289",7,0)
 S JOBN="Clarification Code Conversion"
"RTN","PSO7P289",8,0)
 S JOBDUZ=$S($G(DUZ)'="":DUZ,1:.5)
"RTN","PSO7P289",9,0)
 S PATCH="PSO*7*289"
"RTN","PSO7P289",10,0)
 ;
"RTN","PSO7P289",11,0)
 L +^XTMP(NAMSP):$S($G(DILOCKTM)>0:DILOCKTM,1:3) I '$T D  Q
"RTN","PSO7P289",12,0)
 . D BMES^XPDUTL(JOBN_" job is already running.  Halting...")
"RTN","PSO7P289",13,0)
 . D MES^XPDUTL("")
"RTN","PSO7P289",14,0)
 . D QUIT
"RTN","PSO7P289",15,0)
 ;
"RTN","PSO7P289",16,0)
 I '$D(^XTMP(NAMSP)) D INITXTMP(NAMSP,JOBN_", "_PATCH,90)        ;90 day life
"RTN","PSO7P289",17,0)
 S QUIT=0
"RTN","PSO7P289",18,0)
 ;
"RTN","PSO7P289",19,0)
 I $G(^XTMP(NAMSP,0,"STATUS"))["Completed" D  Q
"RTN","PSO7P289",20,0)
 . D BMES^XPDUTL("This conversion has been run before to completion on ")
"RTN","PSO7P289",21,0)
 . D MES^XPDUTL($$FMTE^XLFDT($P($G(^XTMP(NAMSP,0,"STATUS")),"^",2))_".")
"RTN","PSO7P289",22,0)
 . D MES^XPDUTL("If you want to run it again, do 'RESTORE^PSO7P289', then")
"RTN","PSO7P289",23,0)
 . D MES^XPDUTL("the global subscript ^XTMP('"_NAMSP_"') must be")
"RTN","PSO7P289",24,0)
 . D MES^XPDUTL("killed prior to doing so.")
"RTN","PSO7P289",25,0)
 . D MES^XPDUTL("")
"RTN","PSO7P289",26,0)
 . D MES^XPDUTL("It is strongly recommended you not do this.")
"RTN","PSO7P289",27,0)
 . D QUIT
"RTN","PSO7P289",28,0)
 ;
"RTN","PSO7P289",29,0)
 ;I '$D(XPDQUES("POS1")) D  I 'ZTDTH D QUIT Q
"RTN","PSO7P289",30,0)
 ;. K DIR
"RTN","PSO7P289",31,0)
 ;. S DIR("A")="Enter when to Queue the "_JOBN_" to run."
"RTN","PSO7P289",32,0)
 ;. S DIR("B")="NOW"
"RTN","PSO7P289",33,0)
 ;. S DIR(0)="D^::%DT"
"RTN","PSO7P289",34,0)
 ;. S DIR("?")="Enter when to start the job. This should be a time after the install has completed."
"RTN","PSO7P289",35,0)
 ;. D ^DIR
"RTN","PSO7P289",36,0)
 ;. I $D(DTOUT)!($D(DUOUT)) W !,"Halting..." S ZTDTH="" Q
"RTN","PSO7P289",37,0)
 ;. S ZTDTH=$$FMTH^XLFDT(Y)
"RTN","PSO7P289",38,0)
 ;
"RTN","PSO7P289",39,0)
 ;I $D(XPDQUES("POS1")) S ZTDTH=$$FMTH^XLFDT(XPDQUES("POS1"))
"RTN","PSO7P289",40,0)
 S ZTDTH=$$FMTH^XLFDT($$NOW^XLFDT)
"RTN","PSO7P289",41,0)
 D BMES^XPDUTL("=============================================================")
"RTN","PSO7P289",42,0)
 D MES^XPDUTL("Queuing background job for "_JOBN_"...")
"RTN","PSO7P289",43,0)
 D MES^XPDUTL("Start time: "_$$HTE^XLFDT(ZTDTH))
"RTN","PSO7P289",44,0)
 D MES^XPDUTL("==============================================================")
"RTN","PSO7P289",45,0)
 I ZTDTH="" D BMES^XPDUTL(JOBN_" NOT QUEUED") D QUIT Q
"RTN","PSO7P289",46,0)
 ;
"RTN","PSO7P289",47,0)
 S:$D(^XTMP(NAMSP,0,"LAST")) ^XTMP(NAMSP,0,"ZAUDIT",$H)="RE-STARTED ON"_"^"_$$NOW^XLFDT_"^"_$P(^XTMP(NAMSP,0,"LAST"),"^",2,5)
"RTN","PSO7P289",48,0)
 ;
"RTN","PSO7P289",49,0)
 I $P($G(^XTMP(NAMSP,0,"LAST")),"^")="STOP" D
"RTN","PSO7P289",50,0)
 . S $P(^XTMP(NAMSP,0,"LAST"),"^",1,2)="RUN^"_$$NOW^XLFDT
"RTN","PSO7P289",51,0)
 E  D
"RTN","PSO7P289",52,0)
 . S ^XTMP(NAMSP,0,"LAST")="RUN^"_$$NOW^XLFDT_"^^^"
"RTN","PSO7P289",53,0)
 ;
"RTN","PSO7P289",54,0)
 S ZTRTN="EN^PSO7P289"
"RTN","PSO7P289",55,0)
 S ZTIO=""
"RTN","PSO7P289",56,0)
 S ZTDESC="Background job for "_JOBN_" on prescriptions updated via "_PATCH
"RTN","PSO7P289",57,0)
 S ZTSAVE("JOBN")=""
"RTN","PSO7P289",58,0)
 S ZTSAVE("JOBDUZ")=""
"RTN","PSO7P289",59,0)
 L -^XTMP(NAMSP)
"RTN","PSO7P289",60,0)
 D ^%ZTLOAD
"RTN","PSO7P289",61,0)
 D:$D(ZTSK)
"RTN","PSO7P289",62,0)
 . D MES^XPDUTL("*** Task #"_ZTSK_" Queued! ***")
"RTN","PSO7P289",63,0)
 . D BMES^XPDUTL("")
"RTN","PSO7P289",64,0)
 D BMES^XPDUTL("")
"RTN","PSO7P289",65,0)
 Q
"RTN","PSO7P289",66,0)
QUIT ;
"RTN","PSO7P289",67,0)
 L -^XTMP(NAMSP)
"RTN","PSO7P289",68,0)
 ;
"RTN","PSO7P289",69,0)
 Q
"RTN","PSO7P289",70,0)
 ;
"RTN","PSO7P289",71,0)
STATUS ;show status of job running
"RTN","PSO7P289",72,0)
 I $$ST D
"RTN","PSO7P289",73,0)
 . W !,"Currently processing:"
"RTN","PSO7P289",74,0)
 . I $G(^XTMP($$NAMSP,0,"STATUS"))["Completed" D  Q
"RTN","PSO7P289",75,0)
 . . W !,"Completed on ",$$FMTE^XLFDT($P($G(^XTMP($$NAMSP,0,"STATUS")),"^",2)),!
"RTN","PSO7P289",76,0)
 . W !?5,"Rx being processed > ",$$GETD0
"RTN","PSO7P289",77,0)
 . W !?5,"  Reject being processed > ",$$GETD1
"RTN","PSO7P289",78,0)
 E  D
"RTN","PSO7P289",79,0)
 .I $G(^XTMP($$NAMSP,0,"STATUS"))["Completed" D
"RTN","PSO7P289",80,0)
 .. W !,"Completed on ",$$FMTE^XLFDT($P($G(^XTMP($$NAMSP,0,"STATUS")),"^",2)),!
"RTN","PSO7P289",81,0)
 Q
"RTN","PSO7P289",82,0)
 ;
"RTN","PSO7P289",83,0)
STOP ;stop job command
"RTN","PSO7P289",84,0)
 I $$ST D SETSTOP(1) D
"RTN","PSO7P289",85,0)
 . W !,"CLARIFICATION CODE CONVERSION Job - set to STOP Soon"
"RTN","PSO7P289",86,0)
 . W !!,"Check TASKMAN or Status to ensure it has stopped..."
"RTN","PSO7P289",87,0)
 . W !,"     (D STATUS^PSO7P289)"
"RTN","PSO7P289",88,0)
 Q
"RTN","PSO7P289",89,0)
ST() ;status
"RTN","PSO7P289",90,0)
 L +^XTMP($$NAMSP):3 I $T D  Q 0
"RTN","PSO7P289",91,0)
 . L -^XTMP($$NAMSP)
"RTN","PSO7P289",92,0)
 . W !,"*** NOT CURRENTLY RUNNING! ***",!
"RTN","PSO7P289",93,0)
 Q 1
"RTN","PSO7P289",94,0)
 ;
"RTN","PSO7P289",95,0)
INITXTMP(NAMSP,TITLE,LIFE) ;create ^Xtmp according to SAC std
"RTN","PSO7P289",96,0)
 N BEGDT,PURGDT
"RTN","PSO7P289",97,0)
 S BEGDT=$$NOW^XLFDT()
"RTN","PSO7P289",98,0)
 S PURGDT=$$FMADD^XLFDT(BEGDT,LIFE)
"RTN","PSO7P289",99,0)
 S ^XTMP(NAMSP,0)=PURGDT_"^"_BEGDT_"^"_TITLE
"RTN","PSO7P289",100,0)
 Q
"RTN","PSO7P289",101,0)
 ;
"RTN","PSO7P289",102,0)
NAMSP() ;
"RTN","PSO7P289",103,0)
 Q $T(+0)
"RTN","PSO7P289",104,0)
 ;
"RTN","PSO7P289",105,0)
EN ;
"RTN","PSO7P289",106,0)
 D CONVERT
"RTN","PSO7P289",107,0)
 D REJECT
"RTN","PSO7P289",108,0)
 Q
"RTN","PSO7P289",109,0)
 ;
"RTN","PSO7P289",110,0)
CONVERT ;
"RTN","PSO7P289",111,0)
 Q:$P($G(^XTMP($$NAMSP,0,"STATUS")),U)="In Process"
"RTN","PSO7P289",112,0)
 Q:$P($G(^XTMP($$NAMSP,0,"STATUS")),U)="Completed"
"RTN","PSO7P289",113,0)
 D SETD0(0)
"RTN","PSO7P289",114,0)
 D SETD1(0)
"RTN","PSO7P289",115,0)
 D SETSTOP(0)
"RTN","PSO7P289",116,0)
 D SETCWS
"RTN","PSO7P289",117,0)
 S ^XTMP($$NAMSP,0,"STATUS")="In Process"_U_$$NOW^XLFDT
"RTN","PSO7P289",118,0)
 S ^XTMP($$NAMSP,0,"JOBDUZ")=$G(JOBDUZ)
"RTN","PSO7P289",119,0)
 S ^XTMP($$NAMSP,0,"JOBN")=$G(JOBN)
"RTN","PSO7P289",120,0)
RESUME ;
"RTN","PSO7P289",121,0)
 N RXIEN,REJIEN,OLDCODE,NEWCODE,NEWCODEE,DIE,DA,DR
"RTN","PSO7P289",122,0)
 S RXIEN=$$GETD0
"RTN","PSO7P289",123,0)
 F  S RXIEN=$O(^PSRX(RXIEN)) Q:'RXIEN!($$GETSTOP())  D
"RTN","PSO7P289",124,0)
 .D SETD0(RXIEN)
"RTN","PSO7P289",125,0)
 .D SETD1(0)
"RTN","PSO7P289",126,0)
 .S REJIEN=$$GETD1
"RTN","PSO7P289",127,0)
 .F  S REJIEN=$O(^PSRX(RXIEN,"REJ",REJIEN)) Q:'REJIEN  D
"RTN","PSO7P289",128,0)
 ..D SETD1(REJIEN)
"RTN","PSO7P289",129,0)
 ..S OLDCODE=$P(^PSRX(RXIEN,"REJ",REJIEN,0),U,15)
"RTN","PSO7P289",130,0)
 ..Q:OLDCODE=""
"RTN","PSO7P289",131,0)
 ..S NEWCODE=$$GETCW(OLDCODE)
"RTN","PSO7P289",132,0)
 ..S NEWCODEE=$$GET1^DIQ(9002313.25,NEWCODE,.01)
"RTN","PSO7P289",133,0)
 ..S DIE="^PSRX("_RXIEN_","_"""REJ"""_",",DA(1)=RXIEN,DA=REJIEN,DR="24///"_NEWCODEE D ^DIE
"RTN","PSO7P289",134,0)
 ..S ^XTMP($$NAMSP,0,"LOG",RXIEN,REJIEN)=OLDCODE_U_NEWCODE
"RTN","PSO7P289",135,0)
 I '$$GETSTOP() D
"RTN","PSO7P289",136,0)
 .S ^XTMP($$NAMSP,0,"STATUS")="Completed"_U_$$NOW^XLFDT
"RTN","PSO7P289",137,0)
 .D NOTIFY
"RTN","PSO7P289",138,0)
 Q
"RTN","PSO7P289",139,0)
 ;
"RTN","PSO7P289",140,0)
REJECT ;
"RTN","PSO7P289",141,0)
 N ERR
"RTN","PSO7P289",142,0)
 D RESCH^XUTMOPT("PSO REJECTS BACKGROUND MESSAGE",$$FMADD^XLFDT($$NOW^XLFDT,1),"","24H","L",.ERR)
"RTN","PSO7P289",143,0)
 Q
"RTN","PSO7P289",144,0)
 ;
"RTN","PSO7P289",145,0)
NOTIFY ; build mail message
"RTN","PSO7P289",146,0)
 N XMSUB,XMDUZ,XMTEXT,XMY,I,RXIEN,REJIEN,RX,OLDVALUE,NEWVALUE,NEWDESC
"RTN","PSO7P289",147,0)
 S XMSUB="PSO*7*289 Clarification Code Conversion Results"
"RTN","PSO7P289",148,0)
 S XMDUZ="OUTPATIENT PHARMACY PACKAGE"
"RTN","PSO7P289",149,0)
 S XMTEXT="^TMP($J,""PSO7P289"",""NOTIFY"","
"RTN","PSO7P289",150,0)
 S XMY(^XTMP($$NAMSP,0,"JOBDUZ"))=""
"RTN","PSO7P289",151,0)
 K ^TMP($J,"PSO7P289","NOTIFY")
"RTN","PSO7P289",152,0)
 S ^TMP($J,"PSO7P289","NOTIFY",1)="The Clarification Code Conversion queued install routine for patch"
"RTN","PSO7P289",153,0)
 S ^TMP($J,"PSO7P289","NOTIFY",2)="PSO*7*289 has completed.  This message lists edited prescriptions."
"RTN","PSO7P289",154,0)
 S ^TMP($J,"PSO7P289","NOTIFY",3)=""
"RTN","PSO7P289",155,0)
 S ^TMP($J,"PSO7P289","NOTIFY",4)="The 'Old Value' column contains the internal set of codes value for"
"RTN","PSO7P289",156,0)
 S ^TMP($J,"PSO7P289","NOTIFY",5)="CLARIFICATION CODE field (#24) of REJECT INFO Multiple (#52.25) of"
"RTN","PSO7P289",157,0)
 S ^TMP($J,"PSO7P289","NOTIFY",6)="PRESCRIPTION file (#52). Possible old values consist of:"
"RTN","PSO7P289",158,0)
 S ^TMP($J,"PSO7P289","NOTIFY",7)=""
"RTN","PSO7P289",159,0)
 S ^TMP($J,"PSO7P289","NOTIFY",8)=$$RJ^XLFSTR("CODE",10)_"   DESCRIPTION"
"RTN","PSO7P289",160,0)
 S ^TMP($J,"PSO7P289","NOTIFY",9)=$$RJ^XLFSTR("====",10)_"   ======================="
"RTN","PSO7P289",161,0)
 S ^TMP($J,"PSO7P289","NOTIFY",10)=$$RJ^XLFSTR("0",10)_"   FOR NOT SPECIFIED"
"RTN","PSO7P289",162,0)
 S ^TMP($J,"PSO7P289","NOTIFY",11)=$$RJ^XLFSTR("1",10)_"   NO OVERRIDE"
"RTN","PSO7P289",163,0)
 S ^TMP($J,"PSO7P289","NOTIFY",12)=$$RJ^XLFSTR("2",10)_"   OTHER OVERRIDE"
"RTN","PSO7P289",164,0)
 S ^TMP($J,"PSO7P289","NOTIFY",13)=$$RJ^XLFSTR("3",10)_"   VACATION SUPPLY"
"RTN","PSO7P289",165,0)
 S ^TMP($J,"PSO7P289","NOTIFY",14)=$$RJ^XLFSTR("4",10)_"   LOST PRESCRIPTION"
"RTN","PSO7P289",166,0)
 S ^TMP($J,"PSO7P289","NOTIFY",15)=$$RJ^XLFSTR("5",10)_"   THERAPY CHANGE"
"RTN","PSO7P289",167,0)
 S ^TMP($J,"PSO7P289","NOTIFY",16)=$$RJ^XLFSTR("6",10)_"   STARTER DOSE"
"RTN","PSO7P289",168,0)
 S ^TMP($J,"PSO7P289","NOTIFY",17)=$$RJ^XLFSTR("7",10)_"   MEDICALY NECESSARY"
"RTN","PSO7P289",169,0)
 S ^TMP($J,"PSO7P289","NOTIFY",18)=$$RJ^XLFSTR("8",10)_"   PROCESS COMPOUND"
"RTN","PSO7P289",170,0)
 S ^TMP($J,"PSO7P289","NOTIFY",19)=$$RJ^XLFSTR("9",10)_"   ENCOUNTERS"
"RTN","PSO7P289",171,0)
 S ^TMP($J,"PSO7P289","NOTIFY",20)=""
"RTN","PSO7P289",172,0)
 S ^TMP($J,"PSO7P289","NOTIFY",21)="The 'New Value' column is the equivalent pointer to file 9002313.25."
"RTN","PSO7P289",173,0)
 S ^TMP($J,"PSO7P289","NOTIFY",22)="The 'New Value Description' describes the value."
"RTN","PSO7P289",174,0)
 S ^TMP($J,"PSO7P289","NOTIFY",23)=""
"RTN","PSO7P289",175,0)
 S ^TMP($J,"PSO7P289","NOTIFY",24)=$$RJ^XLFSTR("Reject",28)_$$RJ^XLFSTR("Old",7)_$$RJ^XLFSTR("New",7)
"RTN","PSO7P289",176,0)
 S ^TMP($J,"PSO7P289","NOTIFY",25)=$$RJ^XLFSTR("RXien",10)_$$RJ^XLFSTR("RX#",10)_$$RJ^XLFSTR("Ien",8)_$$RJ^XLFSTR("Value",7)_$$RJ^XLFSTR("Value",7)_"   New Value Description"
"RTN","PSO7P289",177,0)
 S ^TMP($J,"PSO7P289","NOTIFY",26)="============================================================================="
"RTN","PSO7P289",178,0)
 S I=26
"RTN","PSO7P289",179,0)
 S RXIEN=0
"RTN","PSO7P289",180,0)
 F  S RXIEN=$O(^XTMP($$NAMSP,0,"LOG",RXIEN)) Q:'RXIEN  D
"RTN","PSO7P289",181,0)
 .S RX=$$GET1^DIQ(52,RXIEN,.01)
"RTN","PSO7P289",182,0)
 .S REJIEN=0
"RTN","PSO7P289",183,0)
 .F  S REJIEN=$O(^XTMP($$NAMSP,0,"LOG",RXIEN,REJIEN)) Q:'REJIEN  D
"RTN","PSO7P289",184,0)
 ..S I=I+1
"RTN","PSO7P289",185,0)
 ..S OLDVALUE=$P(^XTMP($$NAMSP,0,"LOG",RXIEN,REJIEN),"^",1)
"RTN","PSO7P289",186,0)
 ..S NEWVALUE=$P(^XTMP($$NAMSP,0,"LOG",RXIEN,REJIEN),"^",2)
"RTN","PSO7P289",187,0)
 ..S NEWDESC=$$GET1^DIQ(9002313.25,NEWVALUE,.02)
"RTN","PSO7P289",188,0)
 ..S ^TMP($J,"PSO7P289","NOTIFY",I)=$$RJ^XLFSTR(RXIEN,10)_$$RJ^XLFSTR(RX,10)_$$RJ^XLFSTR(REJIEN,8)_$$RJ^XLFSTR(OLDVALUE,7)_$$RJ^XLFSTR(NEWVALUE,7)_"   "_NEWDESC
"RTN","PSO7P289",189,0)
 D ^XMD
"RTN","PSO7P289",190,0)
 K ^TMP($J,"PSO7P289","NOTIFY")
"RTN","PSO7P289",191,0)
 Q
"RTN","PSO7P289",192,0)
 ;;
"RTN","PSO7P289",193,0)
RESTORE ; restore old set of code values (backstop)
"RTN","PSO7P289",194,0)
 N RXIEN,REJIEN,OLDVALUE,DIE,DA,DR
"RTN","PSO7P289",195,0)
 S RXIEN=0
"RTN","PSO7P289",196,0)
 F  S RXIEN=$O(^XTMP($$NAMSP,0,"LOG",RXIEN)) Q:'RXIEN  D
"RTN","PSO7P289",197,0)
 .S REJIEN=0
"RTN","PSO7P289",198,0)
 .F  S REJIEN=$O(^XTMP($$NAMSP,0,"LOG",RXIEN,REJIEN)) Q:'REJIEN  D
"RTN","PSO7P289",199,0)
 ..S OLDVALUE=$P(^XTMP($$NAMSP,0,"LOG",RXIEN,REJIEN),"^",1)
"RTN","PSO7P289",200,0)
 ..S DIE="^PSRX("_RXIEN_","_"""REJ"""_",",DA(1)=RXIEN,DA=REJIEN,DR="24///"_OLDVALUE D ^DIE
"RTN","PSO7P289",201,0)
 K ^XTMP($$NAMSP,0,"LOG")
"RTN","PSO7P289",202,0)
 Q
"RTN","PSO7P289",203,0)
 ;;
"RTN","PSO7P289",204,0)
SETD0(VALUE) ;;
"RTN","PSO7P289",205,0)
 S ^XTMP($$NAMSP,0,"LASTD0")=VALUE
"RTN","PSO7P289",206,0)
 Q
"RTN","PSO7P289",207,0)
 ;
"RTN","PSO7P289",208,0)
GETD0() ;;
"RTN","PSO7P289",209,0)
 Q ^XTMP($$NAMSP,0,"LASTD0")
"RTN","PSO7P289",210,0)
 ;
"RTN","PSO7P289",211,0)
SETD1(VALUE) ;;
"RTN","PSO7P289",212,0)
 S ^XTMP($$NAMSP,0,"LASTD1")=VALUE
"RTN","PSO7P289",213,0)
 Q
"RTN","PSO7P289",214,0)
 ;
"RTN","PSO7P289",215,0)
GETD1() ;
"RTN","PSO7P289",216,0)
 Q ^XTMP($$NAMSP,0,"LASTD1")
"RTN","PSO7P289",217,0)
 ;
"RTN","PSO7P289",218,0)
SETCWS ;set cross-walk values
"RTN","PSO7P289",219,0)
 ;;'0' FOR NOT SPECIFIED; 
"RTN","PSO7P289",220,0)
    ;;'1' FOR NO OVERRIDE; 
"RTN","PSO7P289",221,0)
    ;;'2' FOR OTHER OVERRIDE; 
"RTN","PSO7P289",222,0)
    ;;'3' FOR VACATION SUPPLY; 
"RTN","PSO7P289",223,0)
    ;;'4' FOR LOST PRESCRIPTION; 
"RTN","PSO7P289",224,0)
    ;;'5' FOR THERAPY CHANGE; 
"RTN","PSO7P289",225,0)
    ;;'6' FOR STARTER DOSE; 
"RTN","PSO7P289",226,0)
    ;;'7' FOR MEDICALLY NECESSARY; 
"RTN","PSO7P289",227,0)
    ;;'8' FOR PROCESS COMPOUND; 
"RTN","PSO7P289",228,0)
    ;;'9' FOR ENCOUNTERS; 
"RTN","PSO7P289",229,0)
    ;;'99' FOR OTHER;
"RTN","PSO7P289",230,0)
    N I
"RTN","PSO7P289",231,0)
    F I=0:1:9,99 D SETCW(I)
"RTN","PSO7P289",232,0)
    Q 
"RTN","PSO7P289",233,0)
 ;;
"RTN","PSO7P289",234,0)
SETCW(VALUE) ;;
"RTN","PSO7P289",235,0)
 N POINTER
"RTN","PSO7P289",236,0)
 S POINTER=$O(^BPS(9002313.25,"B",VALUE,0))
"RTN","PSO7P289",237,0)
 S ^XTMP($$NAMSP,0,"CW",VALUE)=POINTER
"RTN","PSO7P289",238,0)
 ;;
"RTN","PSO7P289",239,0)
GETCW(VALUE) ;get cross-walk value
"RTN","PSO7P289",240,0)
 I $G(VALUE)="" Q ""
"RTN","PSO7P289",241,0)
 Q $G(^XTMP($$NAMSP,0,"CW",VALUE))
"RTN","PSO7P289",242,0)
 ;;
"RTN","PSO7P289",243,0)
SETSTOP(VALUE) ;;
"RTN","PSO7P289",244,0)
 S ^XTMP($$NAMSP,0,"STOP")=VALUE
"RTN","PSO7P289",245,0)
 S:+VALUE ^XTMP($$NAMSP,0,"STATUS")="Stopped"_U_$$NOW^XLFDT
"RTN","PSO7P289",246,0)
 Q
"RTN","PSO7P289",247,0)
 ;;
"RTN","PSO7P289",248,0)
GETSTOP() ;
"RTN","PSO7P289",249,0)
 Q ^XTMP($$NAMSP,0,"STOP")
"RTN","PSO7P289",250,0)
 ;;
"RTN","PSO7P289",251,0)
DESP ;delete ePharmacy site parameter file if it exists
"RTN","PSO7P289",252,0)
 ;; This utility is used a pre-install routine for PSO*7*289 patch to delete file 52.86 if it
"RTN","PSO7P289",253,0)
 ;; exists so that the security parameters on the file may be updated to allow user read access.
"RTN","PSO7P289",254,0)
 Q:'$D(^PS(52.86))
"RTN","PSO7P289",255,0)
 D MES^XPDUTL(" ")
"RTN","PSO7P289",256,0)
 D MES^XPDUTL("Updating security parameters for ePharmacy Site Parameter file (#52.86).")
"RTN","PSO7P289",257,0)
 D MES^XPDUTL(" ")
"RTN","PSO7P289",258,0)
 S DIU="52.86",DIU(0)="E" D EN^DIU2 K DIU
"RTN","PSO7P289",259,0)
 D MES^XPDUTL("Recreating the DATA DICTIONARY...   File 52.86 update is complete.")
"RTN","PSO7P289",260,0)
 Q
"RTN","PSOBPSSP")
0^5^B8034354
"RTN","PSOBPSSP",1,0)
PSOBPSSP ;BIRM/LE - ePharmacy Site Parameters Definition ;04/28/08
"RTN","PSOBPSSP",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**289**;DEC 1997;Build 107
"RTN","PSOBPSSP",3,0)
 ;
"RTN","PSOBPSSP",4,0)
DIV ; - Prompt for ePharmacy Site Parameters
"RTN","PSOBPSSP",5,0)
 N DIC,DIE,DA,Y,PSODIV,DLAYGO,DTOUT,DUOUT
"RTN","PSOBPSSP",6,0)
 W !!,"Regardless of any parameters defined, Refill-Too-Soon, Drug Utilization"
"RTN","PSOBPSSP",7,0)
 W !,"Review(DUR) and Tricare rejects will always be placed on the Third Party "
"RTN","PSOBPSSP",8,0)
 W !,"Payer Rejects - Worklist, also known as Pharmacy Reject Worklist.  These"
"RTN","PSOBPSSP",9,0)
 W !,"parameters are uneditable and are the default parameters."
"RTN","PSOBPSSP",10,0)
 N PSODIV,XX
"RTN","PSOBPSSP",11,0)
 ;
"RTN","PSOBPSSP",12,0)
DIV2 ;
"RTN","PSOBPSSP",13,0)
 K DIC,DIE,DA,Y,PSODIV S PSODIV=""
"RTN","PSOBPSSP",14,0)
 ; - Division/Site selection
"RTN","PSOBPSSP",15,0)
 I '$G(PSOSITE) D ^PSOLSET I '$D(PSOPAR) W $C(7),!!,"Pharmacy Division Must be Selected!",! Q
"RTN","PSOBPSSP",16,0)
 W !!
"RTN","PSOBPSSP",17,0)
 S DIC("A")="Division: ",DIC=52.86,DIC(0)="ABEQL",DLAYGO=52.86 D ^DIC
"RTN","PSOBPSSP",18,0)
 K DIC G:$D(DUOUT)!($D(DTOUT))!(Y=-1) EXIT I Y<0 W !,"A division must be entered to proceed.",!! G DIV2
"RTN","PSOBPSSP",19,0)
 S PSODIV=$P(Y,"^")
"RTN","PSOBPSSP",20,0)
 ;
"RTN","PSOBPSSP",21,0)
 ;Prompt for REJECT WORKLIST DAYS and ALLOW ALL REJECTS fields
"RTN","PSOBPSSP",22,0)
 K DIE,DA,DIC
"RTN","PSOBPSSP",23,0)
 S DIE="^PS(52.86,",DA=PSODIV,DIC(0)="QEALZ",DR="1;4" D ^DIE
"RTN","PSOBPSSP",24,0)
 G EXIT:$D(DUOUT)!($D(DTOUT))
"RTN","PSOBPSSP",25,0)
 ;
"RTN","PSOBPSSP",26,0)
CODES ;
"RTN","PSOBPSSP",27,0)
 ;Prompt for Reject codes that will be allowed to pass to the Pharmacy Reject Worklist
"RTN","PSOBPSSP",28,0)
 K DATA
"RTN","PSOBPSSP",29,0)
 N XX1,XX2,XX3
"RTN","PSOBPSSP",30,0)
 D GETS^DIQ(52.86,PSODIV_",","52.8651*","EI","DATA")
"RTN","PSOBPSSP",31,0)
 I $D(DATA) D
"RTN","PSOBPSSP",32,0)
 . W !!,"Previously defined override reject codes:",!!,"Code",?10,"Description",?70,"Auto Send"
"RTN","PSOBPSSP",33,0)
 . W !,"-----",?10,"----------------------------------",?70,"---------"
"RTN","PSOBPSSP",34,0)
 . S (XX1,XX2,XX3)="" F  S XX1=$O(DATA(52.8651,XX1)) Q:XX1=""  D
"RTN","PSOBPSSP",35,0)
 .. I $D(DATA(52.8651,XX1,".01","E")) D
"RTN","PSOBPSSP",36,0)
 ... W !,$J(DATA(52.8651,XX1,".01","E"),5)
"RTN","PSOBPSSP",37,0)
 ... W ?10,$E($$GET1^DIQ(9002313.93,DATA(52.8651,XX1,".01","I")_",",.02),1,50)
"RTN","PSOBPSSP",38,0)
 ... I $D(DATA(52.8651,XX1,1,"E")) W ?70,$J(DATA(52.8651,XX1,1,"E"),6)
"RTN","PSOBPSSP",39,0)
 W !!
"RTN","PSOBPSSP",40,0)
 ; 
"RTN","PSOBPSSP",41,0)
 K DIC,DA,DIE
"RTN","PSOBPSSP",42,0)
 S DIC="^PS(52.86,"_PSODIV_",1,",DA(1)=PSODIV,DIC(0)="QEALZ",DR=".01;1"
"RTN","PSOBPSSP",43,0)
 D ^DIC I $D(DUOUT)!($D(DTOUT))!(Y=-1) K DIC,DA G DIV2
"RTN","PSOBPSSP",44,0)
 S DA=+Y
"RTN","PSOBPSSP",45,0)
 K DIE S DIE=DIC,DR=".01;1" D ^DIE
"RTN","PSOBPSSP",46,0)
 K DIE,DR,DA,Y
"RTN","PSOBPSSP",47,0)
 G CODES
"RTN","PSOBPSSP",48,0)
 ;
"RTN","PSOBPSSP",49,0)
EXIT ;
"RTN","PSOBPSSP",50,0)
 K DIC,DIR,DIE,DA,DLAYGO,DATA
"RTN","PSOBPSSP",51,0)
 Q
"RTN","PSOBPSSP",52,0)
 ;
"RTN","PSOBPSSP",53,0)
HELP ;Help text for CODES field (#.01) of REJECT CODE multiple(#52.8561)
"RTN","PSOBPSSP",54,0)
 W !!,"*** Enter a valid third party reject code from the previously entered codes"
"RTN","PSOBPSSP",55,0)
 W !,"*** above, enter a new code, or enter one from the provided listing below."
"RTN","PSOBPSSP",56,0)
 W !,"*** Valid codes are those defined in BPS NCPDP REJECT CODES file (#900231.93).",!!
"RTN","PSOBPSSP",57,0)
 Q
"RTN","PSOBPSU1")
0^33^B46150481
"RTN","PSOBPSU1",1,0)
PSOBPSU1 ;BIRM/MFR - BPS (ECME) Utilities 1 ;10/15/04
"RTN","PSOBPSU1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**148,260,281,287,303,289**;DEC 1997;Build 107
"RTN","PSOBPSU1",3,0)
 ;Reference to $$EN^BPSNCPDP supported by IA 4415 & 4304
"RTN","PSOBPSU1",4,0)
 ;References to $$NDCFMT^PSSNDCUT,$$GETNDC^PSSNDCUT supported by IA 4707
"RTN","PSOBPSU1",5,0)
 ;References to $$ECMEON^BPSUTIL,$$CMOPON^BPSUTIL supported by IA 4410
"RTN","PSOBPSU1",6,0)
 ;References to STORESP^IBNCPDP supported by IA 4299
"RTN","PSOBPSU1",7,0)
 ;
"RTN","PSOBPSU1",8,0)
ECMESND(RX,RFL,DATE,FROM,NDC,CMOP,RVTX,OVRC,CNDC,RESP,IGSW,ALTX,CLA,PA) ; - Sends Rx Release 
"RTN","PSOBPSU1",9,0)
 ;information to ECME/IB and updates NDC in the DRUG/PRESCRIPTION files; DBIA4304
"RTN","PSOBPSU1",10,0)
 ;Input: (r) RX   - Rx IEN (#52)
"RTN","PSOBPSU1",11,0)
 ;       (o) RFL  - Refill #  (Default: most recent)
"RTN","PSOBPSU1",12,0)
 ;       (r) DATE - Date of Service
"RTN","PSOBPSU1",13,0)
 ;       (r) FROM - Function within OP (See BWHERE param. in EN^BPSNCPDP api)
"RTN","PSOBPSU1",14,0)
 ;       (o) NDC  - NDC Number (If not passed, will be retrieved from DRUG file)
"RTN","PSOBPSU1",15,0)
 ;       (o) CMOP - CMOP Prescription (1-YES/0-NO) (Default: 0)
"RTN","PSOBPSU1",16,0)
 ;       (o) RVTX - REVERSE text (e.g., RX EDIT, RX RELEASE-NDC CHANGE, etc)
"RTN","PSOBPSU1",17,0)
 ;       (o) OVRC - Set of 3 NCPDP override codes separated by "^": 
"RTN","PSOBPSU1",18,0)
 ;                  Piece 1: NCPDP Professional Service Code for overriding DUR REJECTS
"RTN","PSOBPSU1",19,0)
 ;                  Piece 2: NCPDP Reason for Service Code for overriding DUR REJECTS
"RTN","PSOBPSU1",20,0)
 ;                  Piece 3: NCPDP Result of Service Code for overriding DUR REJECTS
"RTN","PSOBPSU1",21,0)
 ;       (o) CNDC - Changed NDC? 1 - Yes / 0 - No (Default: NO)
"RTN","PSOBPSU1",22,0)
 ;       (o) IGSW - Ignore Switches (Master and CMOP)? 1 - Yes / 0 - No (Default: NO)
"RTN","PSOBPSU1",23,0)
 ;       (o) ALTX - Alternative Text to be placed in the Rx ECME Activity Log
"RTN","PSOBPSU1",24,0)
 ;       (o) CLA  - NCPDP Clarification Code for overriding DUR/RTS REJECTS
"RTN","PSOBPSU1",25,0)
 ;       (o) PA   - NCPDP Prior Authorization Type and Number (separated by "^")
"RTN","PSOBPSU1",26,0)
 ;Output:    RESP - Response from $$EN^BPSNCPDP api
"RTN","PSOBPSU1",27,0)
 ;
"RTN","PSOBPSU1",28,0)
 N ACT,NDCACT,DA,PSOELIG
"RTN","PSOBPSU1",29,0)
 I '$D(RFL) S RFL=$$LSTRFL(RX)
"RTN","PSOBPSU1",30,0)
 ; - ECME is not turned ON for the Rx's Division
"RTN","PSOBPSU1",31,0)
 I '$G(IGSW),'$$ECMEON^BPSUTIL($$RXSITE^PSOBPSUT(RX,RFL)) S RESP="-1^ECME SWITCH OFF" Q
"RTN","PSOBPSU1",32,0)
 ; - ECME CMOP is not turned ON for the Rx's Division
"RTN","PSOBPSU1",33,0)
 I '$G(IGSW),$G(CMOP),'$$CMOPON^BPSUTIL($$RXSITE^PSOBPSUT(RX,RFL)) S RESP="-1^CMOP SWITCH OFF" Q
"RTN","PSOBPSU1",34,0)
 ; - Saving the NDC to be displayed on the ECME Activity Log
"RTN","PSOBPSU1",35,0)
 I $G(CNDC) D
"RTN","PSOBPSU1",36,0)
 . I $G(NDC)'="" S NDCACT=NDC Q
"RTN","PSOBPSU1",37,0)
 . S NDCACT=$$GETNDC^PSONDCUT(RX,RFL)
"RTN","PSOBPSU1",38,0)
 I $$NDCFMT^PSSNDCUT($G(NDC))="" D
"RTN","PSOBPSU1",39,0)
 . S NDC=$$GETNDC^PSSNDCUT($$GET1^DIQ(52,RX,6,"I"),$$RXSITE^PSOBPSUT(RX,RFL),+$G(CMOP))
"RTN","PSOBPSU1",40,0)
 . I $G(NDC)'="" D SAVNDC^PSONDCUT(RX,RFL,NDC,+$G(CMOP),1)
"RTN","PSOBPSU1",41,0)
 S PPDU="",PPDU=$$GPPDU^PSONDCUT(RX,RFL,NDC,,1,FROM) K PPDU
"RTN","PSOBPSU1",42,0)
 ; - Creating ECME Activity Log on the PRESCRIPTION file
"RTN","PSOBPSU1",43,0)
 S ACT="Submitted" I $$STATUS^PSOBPSUT(RX,RFL)="E PAYABLE" S ACT="Rev/Resubmit"
"RTN","PSOBPSU1",44,0)
 S ACT=ACT_" to ECME:"
"RTN","PSOBPSU1",45,0)
 ; - Marked any 'unresolved' REJECTS as 'resolved' (Reason: 1 - Claim re-submitted)
"RTN","PSOBPSU1",46,0)
 N CLSCOM,COD1,COD2,COD3
"RTN","PSOBPSU1",47,0)
 S COD2=$P($G(OVRC),"^"),COD1=$P($G(OVRC),"^",2),COD3=$P($G(OVRC),"^",3)
"RTN","PSOBPSU1",48,0)
 I $G(COD3)'="" S CLSCOM="DUR Override Codes "_COD1_"/"_COD2_"/"_COD3_" submitted."
"RTN","PSOBPSU1",49,0)
 I $G(CLA)'="" S CLSCOM="Clarification Code "_$P(CLA,"^",2)_" submitted."
"RTN","PSOBPSU1",50,0)
 I $G(PA)'="" S CLSCOM="Prior Authorization Code ("_$P(PA,"^")_"/"_$P(PA,"^",2)_") submitted."
"RTN","PSOBPSU1",51,0)
 D CLSALL^PSOREJUT(RX,RFL,DUZ,1,$G(CLSCOM),$G(COD1),$G(COD2),$G(COD3),$S($G(CLA):$P(CLA,"^",2),1:""),$G(PA))
"RTN","PSOBPSU1",52,0)
 ; - Call to ECME (NEWing STAT because ECME was overwriting it - Important variable for CMOP release PSXVND)
"RTN","PSOBPSU1",53,0)
 N STAT
"RTN","PSOBPSU1",54,0)
 I $G(RVTX)="",FROM="ED" S RVTX="RX EDITED"
"RTN","PSOBPSU1",55,0)
 I $G(CLA) S CLA=$P(CLA,"^")
"RTN","PSOBPSU1",56,0)
 S RESP=$$EN^BPSNCPDP(RX,RFL,$$DOS(RX,RFL,.DATE),FROM,NDC,$G(RVTX),$G(OVRC),,$G(CLA),$G(PA))
"RTN","PSOBPSU1",57,0)
 I $$STATUS^PSOBPSUT(RX,RFL)="E PAYABLE" D SAVNDC^PSONDCUT(RX,RFL,NDC,+$G(CMOP),1,FROM)
"RTN","PSOBPSU1",58,0)
 ; - Reseting the Re-transmission flag
"RTN","PSOBPSU1",59,0)
 D RETRXF^PSOREJU2(RX,RFL,0)
"RTN","PSOBPSU1",60,0)
 ; Storing eligibility flag
"RTN","PSOBPSU1",61,0)
 S PSOELIG=$P(RESP,"^",3) D:PSOELIG'="" ELIG^PSOBPSU2(RX,RFL,PSOELIG)
"RTN","PSOBPSU1",62,0)
 ; - Logging ECME Activity Log to the PRESCRIPTION file
"RTN","PSOBPSU1",63,0)
 I $G(ALTX)="" D
"RTN","PSOBPSU1",64,0)
 . N X,ROUTE S (ROUTE,X)=""
"RTN","PSOBPSU1",65,0)
 . S ROUTE=$S(FROM="RF":$$GET1^DIQ(52.1,RFL_","_RX_",",2),FROM="OF":$$GET1^DIQ(52,RX_",",11),1:"")
"RTN","PSOBPSU1",66,0)
 . S:FROM="OF" X=ROUTE_" FILL(NDC:"_$$GETNDC^PSONDCUT(RX,RFL)_")"
"RTN","PSOBPSU1",67,0)
 . S:FROM="RF" X=ROUTE_" REFILL(NDC:"_$$GETNDC^PSONDCUT(RX,RFL)_")"
"RTN","PSOBPSU1",68,0)
 . S:FROM="RN" X="RX RENEWED(NDC:"_$$GETNDC^PSONDCUT(RX,RFL)_")"
"RTN","PSOBPSU1",69,0)
 . S:FROM="PL" X="PRINTED FROM SUSPENSE(NDC:"_$$GETNDC^PSONDCUT(RX,RFL)_")"
"RTN","PSOBPSU1",70,0)
 . S:FROM="PE"!(FROM="PP") X="PULLED FROM SUSPENSE(NDC:"_$$GETNDC^PSONDCUT(RX,RFL)_")"
"RTN","PSOBPSU1",71,0)
 . S:FROM="PC" X="CMOP TRANSMISSION(NDC:"_$$GETNDC^PSONDCUT(RX,RFL)_")"
"RTN","PSOBPSU1",72,0)
 . S:FROM="RRL" X="RELEASED RX PREVIOUSLY REVERSED"
"RTN","PSOBPSU1",73,0)
 . S:FROM="ED" X="RX EDITED"
"RTN","PSOBPSU1",74,0)
 . S:$G(RVTX)'="" X=RVTX
"RTN","PSOBPSU1",75,0)
 . S:$G(OVRC)'="" X="DUR OVERRIDE CODES("_$G(COD1)_"/"_$G(COD2)_"/"_$G(COD3)_")"
"RTN","PSOBPSU1",76,0)
 . S:$G(CNDC) X=X_"(NDC:"_NDCACT_")" S ACT=ACT_X
"RTN","PSOBPSU1",77,0)
 . S ACT=ACT_$$STS(RX,RFL,RESP)
"RTN","PSOBPSU1",78,0)
 I $G(ALTX)'="" S ACT=ACT_ALTX_$$STS(RX,RFL,RESP)
"RTN","PSOBPSU1",79,0)
 I +RESP=2 S ACT="Not ECME Billable: "_$P(RESP,"^",2)
"RTN","PSOBPSU1",80,0)
 I +RESP=6 S ACT=$P(RESP,"^",2)
"RTN","PSOBPSU1",81,0)
 I +RESP=10 S ACT="ECME reversed/NOT re-submitted: "_$P(RESP,"^",2)
"RTN","PSOBPSU1",82,0)
 S:PSOELIG="T" ACT="TRICARE-"_ACT
"RTN","PSOBPSU1",83,0)
 D RXACT^PSOBPSU2(RX,RFL,ACT,"M",DUZ)
"RTN","PSOBPSU1",84,0)
 ; -Logs an ECME Activity Log if Rx Qty is different than Billing Qty
"RTN","PSOBPSU1",85,0)
 D ELOG^PSOBPSU2(RESP)
"RTN","PSOBPSU1",86,0)
 ;
"RTN","PSOBPSU1",87,0)
 I PSOELIG="T" D TRICCHK^PSOREJU3(RX,RFL,RESP,FROM,$G(RVTX))
"RTN","PSOBPSU1",88,0)
 Q
"RTN","PSOBPSU1",89,0)
 ;
"RTN","PSOBPSU1",90,0)
REVERSE(RX,RFL,FROM,RSN,RTXT,IGRL,NDC) ; - Reverse a claim and close all OPEN/UNRESOLVED Rejects
"RTN","PSOBPSU1",91,0)
 ;Input: (r) RX   - Rx IEN (#52)
"RTN","PSOBPSU1",92,0)
 ;       (o) RFL  - Refill #  (Default: most recent)
"RTN","PSOBPSU1",93,0)
 ;       (r) FROM - Function within OP (See BWHERE param. in EN^BPSNCPDP api)
"RTN","PSOBPSU1",94,0)
 ;       (o) RSN  - Close Reason (2:RX ON HOLD;4: RX RETURNED TO STOCK,5:RX DELETED,etc...)
"RTN","PSOBPSU1",95,0)
 ;       (o) RTXT - Close Reason TEXT (Usually no passed if RSN is passed)
"RTN","PSOBPSU1",96,0)
 ;       (o) IGRL - Ignore RELEASE DATE, reverse anyway  
"RTN","PSOBPSU1",97,0)
 ;       (o) NDC  - NDC number related to the reversal (Note: might be an invalid NDC)
"RTN","PSOBPSU1",98,0)
 I '$D(RFL) S RFL=$$LSTRFL(RX)
"RTN","PSOBPSU1",99,0)
 I $$STATUS^PSOBPSUT(RX,RFL)="" Q
"RTN","PSOBPSU1",100,0)
 N RESP,STS,ACT,STAT,DA,STATUS,NOACT,REVECME S RSN=+$G(RSN),RTXT=$G(RTXT),REVECME=1
"RTN","PSOBPSU1",101,0)
 I RTXT="",RSN D
"RTN","PSOBPSU1",102,0)
 . S:RSN=2 RTXT="RX PLACED ON HOLD" S:RSN=3 RTXT="RX SUSPENDED" S:RSN=4 RTXT="RX RETURNED TO STOCK"
"RTN","PSOBPSU1",103,0)
 . S:RSN=5 RTXT="RX DELETED" S:RSN=7 RTXT="RX DISCONTINUED" S:RSN=8 RTXT="RX EDITED"
"RTN","PSOBPSU1",104,0)
 D CLSALL^PSOREJUT(RX,RFL,DUZ,RSN,RTXT)
"RTN","PSOBPSU1",105,0)
 I '$G(IGRL),$$RXRLDT^PSOBPSUT(RX,RFL) Q
"RTN","PSOBPSU1",106,0)
 ; - Reseting the Re-transmission flag if Rx is being suspended
"RTN","PSOBPSU1",107,0)
 I RSN=3!($$GET1^DIQ(52,RX,100,"I")=5) D RETRXF^PSOREJU2(RX,RFL,1)
"RTN","PSOBPSU1",108,0)
 S STATUS=$$STATUS^PSOBPSUT(RX,RFL),NOACT=0
"RTN","PSOBPSU1",109,0)
 I STATUS'="E PAYABLE",STATUS'="IN PROGRESS",STATUS'="E REVERSAL REJECTED",STATUS'="E REVERSAL STRANDED",STATUS'="E DUPLICATE" S NOACT=1
"RTN","PSOBPSU1",110,0)
 ; Only perform ECME reversal for a released CMOP if rx/fill is Discontinued.
"RTN","PSOBPSU1",111,0)
 I FROM="DC",$$CMOP^PSOBPSUT(RX,RFL) S REVECME=0
"RTN","PSOBPSU1",112,0)
 I REVECME S RESP=$$EN^BPSNCPDP(RX,RFL,$$DOS(RX,RFL),FROM,$$GETNDC^PSONDCUT(RX,RFL),RTXT)
"RTN","PSOBPSU1",113,0)
 N PSOTRIC S PSOTRIC="",PSOTRIC=$$TRIC^PSOREJP1(RX,RFL,PSOTRIC)
"RTN","PSOBPSU1",114,0)
 ; - Logging ECME Activity Log
"RTN","PSOBPSU1",115,0)
 I '$G(NOACT),REVECME D
"RTN","PSOBPSU1",116,0)
 . S ACT=$S(PSOTRIC:"TRICARE ",1:"")_"Reversal sent to ECME: "_RTXT_$S($G(NDC)'="":" ("_NDC_")",1:"")_$$STS(RX,RFL,+RESP)
"RTN","PSOBPSU1",117,0)
 . D RXACT^PSOBPSU2(RX,RFL,ACT,"M",DUZ)
"RTN","PSOBPSU1",118,0)
 Q
"RTN","PSOBPSU1",119,0)
 ;
"RTN","PSOBPSU1",120,0)
DOS(RX,RFL,DATE) ; Return the Date Of Service for ECME
"RTN","PSOBPSU1",121,0)
 ;Input: (r) RX   - Rx IEN (#52)
"RTN","PSOBPSU1",122,0)
 ;       (o) RFL  - Refill #  (Default: most recent)
"RTN","PSOBPSU1",123,0)
 ;       (o) DATE - Possible Date Of Service
"RTN","PSOBPSU1",124,0)
 ;Output:    DOS  - Actual Date Of Service
"RTN","PSOBPSU1",125,0)
 I '$D(RFL) S RFL=$$LSTRFL(RX)
"RTN","PSOBPSU1",126,0)
 ; - Retrieving FILL DATE from the PRESCRIPTION file if not passed
"RTN","PSOBPSU1",127,0)
 I $G(DATE)="" S DATE=$$RXRLDT^PSOBPSUT(RX,RFL)
"RTN","PSOBPSU1",128,0)
 ; - Retrieving FILL DATE from the PRESCRIPTION file if not passed
"RTN","PSOBPSU1",129,0)
 I 'DATE S DATE=$$RXFLDT^PSOBPSUT(RX,RFL)
"RTN","PSOBPSU1",130,0)
 ; - Future Date not allowed
"RTN","PSOBPSU1",131,0)
 I DATE>DT!'DATE S DATE=DT
"RTN","PSOBPSU1",132,0)
 Q (DATE\1)
"RTN","PSOBPSU1",133,0)
 ;
"RTN","PSOBPSU1",134,0)
RELEASE(RX,RFL,USR) ; - Notifies IB that the Rx was RELEASED
"RTN","PSOBPSU1",135,0)
 ;Input: (r) RX   - Rx IEN (#52)
"RTN","PSOBPSU1",136,0)
 ;       (o) RFL  - Refill # (Default: most recent)
"RTN","PSOBPSU1",137,0)
 ;       (o) USR  - User responsible for releasing the Rx (Default: .5 - Postmaster)
"RTN","PSOBPSU1",138,0)
 N IBAR,RXAR,FLDT,RFAR
"RTN","PSOBPSU1",139,0)
 S:'$D(RFL) RFL=$$LSTRFL(RX)
"RTN","PSOBPSU1",140,0)
 S:'$D(USR) USR=.5
"RTN","PSOBPSU1",141,0)
 D GETS^DIQ(52,RX_",",".01;2;6;7;8;22","I","RXAR")
"RTN","PSOBPSU1",142,0)
 S DFN=+$G(RXAR(52,RX_",",2,"I"))
"RTN","PSOBPSU1",143,0)
 S IBAR("PRESCRIPTION")=RX,IBAR("RX NO")=$G(RXAR(52,RX_",",.01,"I"))
"RTN","PSOBPSU1",144,0)
 S IBAR("CLAIMID")=$E((RX#10000000)+10000000,2,8),IBAR("USER")=USR
"RTN","PSOBPSU1",145,0)
 S IBAR("DRUG")=RXAR(52,RX_",",6,"I"),IBAR("NDC")=$$GETNDC^PSONDCUT(RX,RFL)
"RTN","PSOBPSU1",146,0)
 S FLDT=$$RXFLDT^PSOBPSUT(RX,RFL) I FLDT>DT S FLDT=DT
"RTN","PSOBPSU1",147,0)
 S IBAR("FILL NUMBER")=RFL,IBAR("FILL DATE")=FLDT
"RTN","PSOBPSU1",148,0)
 S IBAR("QTY")=$G(RXAR(52,RX_",",7,"I")),IBAR("DAYS SUPPLY")=$G(RXAR(52,RX_",",8,"I"))
"RTN","PSOBPSU1",149,0)
 I RFL D
"RTN","PSOBPSU1",150,0)
 . D GETS^DIQ(52.1,RFL_","_RX_",",".01;1;1.1","I","RFAR")
"RTN","PSOBPSU1",151,0)
 . S IBAR("QTY")=$G(RFAR(52.1,RFL_","_RX_",",1,"I"))
"RTN","PSOBPSU1",152,0)
 . S IBAR("DAYS SUPPLY")=$G(RFAR(52.1,RFL_","_RX_",",1.1,"I"))
"RTN","PSOBPSU1",153,0)
 S IBAR("STATUS")="RELEASED" D STORESP^IBNCPDP(DFN,.IBAR)
"RTN","PSOBPSU1",154,0)
 Q
"RTN","PSOBPSU1",155,0)
 ;
"RTN","PSOBPSU1",156,0)
LSTRFL(RX) ;  - Returns the latest fill for the Prescription
"RTN","PSOBPSU1",157,0)
 ; Input: (r) RX     - Rx IEN (#52)
"RTN","PSOBPSU1",158,0)
 ;Output:     LSTRFL - Most recent refill #
"RTN","PSOBPSU1",159,0)
 N I,LSTRFL
"RTN","PSOBPSU1",160,0)
 S (I,LSTRFL)=0 F  S I=$O(^PSRX(RX,1,I)) Q:'I  S LSTRFL=I
"RTN","PSOBPSU1",161,0)
 Q LSTRFL
"RTN","PSOBPSU1",162,0)
 ;
"RTN","PSOBPSU1",163,0)
ECMEACT(RX,RFL,COMM,USR) ; - Add an Activity to the ECME Activity Log (PRESCRIPTION file)
"RTN","PSOBPSU1",164,0)
 ;Input: (r) RX   - Rx IEN (#52)
"RTN","PSOBPSU1",165,0)
 ;       (o) RFL  - Refill #  (Default: most recent)
"RTN","PSOBPSU1",166,0)
 ;       (r) COMM - Comments (up to 75 characters)
"RTN","PSOBPSU1",167,0)
 ;       (o) USR  - User logging the comments (Default: DUZ)
"RTN","PSOBPSU1",168,0)
 S:'$D(RFL) RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOBPSU1",169,0)
 D RXACT^PSOBPSU2(RX,RFL,COMM,"M",+$G(USR))
"RTN","PSOBPSU1",170,0)
 Q
"RTN","PSOBPSU1",171,0)
 ;
"RTN","PSOBPSU1",172,0)
STS(RX,RFL,RSP) ; Adds the Status to the ECME Activity Log according to Rx/fill claim status Response
"RTN","PSOBPSU1",173,0)
 N STS
"RTN","PSOBPSU1",174,0)
 S STS=$S($$STATUS^PSOBPSUT(RX,RFL)'="IN PROGRESS"&($$STATUS^PSOBPSUT(RX,RFL)'=""):"-"_$$STATUS^PSOBPSUT(RX,RFL),1:"")
"RTN","PSOBPSU1",175,0)
 S:+RSP=1 STS="-NO SUBMISSION THROUGH ECME" S:+RSP=3 STS="-NO REVERSAL NEEDED" S:+RSP=4 STS="-NOT PROCESSED"
"RTN","PSOBPSU1",176,0)
 S:+RSP=5 STS="-SOFTWARE ERROR"_$S($P($G(RESP),"^",2)'="":" ("_$P(RESP,"^",2)_")",1:"")
"RTN","PSOBPSU1",177,0)
 I +RSP=2,$$STATUS^PSOBPSUT(RX,RFL)'="" S STS="-NOT BILLABLE:"_$S(PSOELIG="T":"TRICARE",PSOELIG="C":"CHAMPVA",1:"")_":"_$P(RSP,"^",2)
"RTN","PSOBPSU1",178,0)
 Q STS
"RTN","PSOBPSU2")
0^9^B32851035
"RTN","PSOBPSU2",1,0)
PSOBPSU2 ;BIRM/MFR - BPS (ECME) Utilities 2 ;10/15/04
"RTN","PSOBPSU2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**260,287,289**;DEC 1997;Build 107
"RTN","PSOBPSU2",3,0)
 ;Reference to File 200 - NEW PERSON supported by IA 10060
"RTN","PSOBPSU2",4,0)
 ;Reference to DUR1^BPSNCPD3 supported by IA 4560
"RTN","PSOBPSU2",5,0)
 ;Reference to $$NCPDPQTY^PSSBPSUT supported by IA 4992
"RTN","PSOBPSU2",6,0)
 ; 
"RTN","PSOBPSU2",7,0)
MWC(RX,RFL) ; Returns whether a prescription is (M)ail, (W)indow or (C)MOP
"RTN","PSOBPSU2",8,0)
 ;Input: (r) RX   - Rx IEN (#52)
"RTN","PSOBPSU2",9,0)
 ;       (o) RFL  - Refill #  (Default: most recent)
"RTN","PSOBPSU2",10,0)
 ;Output: "M": MAIL / "W": WINDOW / "C": CMOP
"RTN","PSOBPSU2",11,0)
 ;
"RTN","PSOBPSU2",12,0)
 N MWC
"RTN","PSOBPSU2",13,0)
 ;
"RTN","PSOBPSU2",14,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOBPSU2",15,0)
 ;
"RTN","PSOBPSU2",16,0)
 ; - MAIL/WINDOW fields (Original and Refill)
"RTN","PSOBPSU2",17,0)
 I RFL S MWC=$$GET1^DIQ(52.1,RFL_","_RX,2,"I")
"RTN","PSOBPSU2",18,0)
 E  S MWC=$$GET1^DIQ(52,RX,11,"I")
"RTN","PSOBPSU2",19,0)
 S:MWC="" MWC="W"
"RTN","PSOBPSU2",20,0)
 ;
"RTN","PSOBPSU2",21,0)
 ; - Checking the RX SUSPENSE file (#52.5)
"RTN","PSOBPSU2",22,0)
 I $$GET1^DIQ(52,RX,100,"I")=5 D
"RTN","PSOBPSU2",23,0)
 . N RXS S RXS=+$O(^PS(52.5,"B",RX,0)) Q:'RXS
"RTN","PSOBPSU2",24,0)
 . I $$GET1^DIQ(52.5,RXS,3,"I")'="" S MWC="C" Q
"RTN","PSOBPSU2",25,0)
 . S MWC="M"
"RTN","PSOBPSU2",26,0)
 ;
"RTN","PSOBPSU2",27,0)
 ; - Checking the CMOP EVENT sub-file (#52.01)
"RTN","PSOBPSU2",28,0)
 I MWC'="C" D
"RTN","PSOBPSU2",29,0)
 . N CMP S CMP=0
"RTN","PSOBPSU2",30,0)
 . F  S CMP=$O(^PSRX(RX,4,CMP)) Q:'CMP  D  I MWC="C" Q
"RTN","PSOBPSU2",31,0)
 . . I $$GET1^DIQ(52.01,CMP_","_RX,2,"I")=RFL S MWC="C"
"RTN","PSOBPSU2",32,0)
 ;
"RTN","PSOBPSU2",33,0)
 Q MWC
"RTN","PSOBPSU2",34,0)
 ;
"RTN","PSOBPSU2",35,0)
RXACT(RX,RFL,COMM,TYPE,USR) ; - Add an Activity to the ECME Activity Log (PRESCRIPTION file)
"RTN","PSOBPSU2",36,0)
 ;Input: (r) RX   - Rx IEN (#52)
"RTN","PSOBPSU2",37,0)
 ;       (o) RFL  - Refill #  (Default: most recent)
"RTN","PSOBPSU2",38,0)
 ;       (r) COMM - Comments (up to 75 characters)
"RTN","PSOBPSU2",39,0)
 ;       (r) TYPE - Comments type: (M-ECME,E-Edit, etc...) See file #52 DD for all values
"RTN","PSOBPSU2",40,0)
 ;       (o) USR  - User logging the comments (Default: DUZ)
"RTN","PSOBPSU2",41,0)
 ;
"RTN","PSOBPSU2",42,0)
 S:'$D(RFL) RFL=$$LSTRFL^PSOBPSU1(RX) S:'$D(USR) USR=DUZ
"RTN","PSOBPSU2",43,0)
 S:'$D(^VA(200,+USR,0)) USR=DUZ S COMM=$E($G(COMM),1,75)
"RTN","PSOBPSU2",44,0)
 ;
"RTN","PSOBPSU2",45,0)
 I COMM="" Q
"RTN","PSOBPSU2",46,0)
 I '$D(^PSRX(RX)) Q
"RTN","PSOBPSU2",47,0)
 ;
"RTN","PSOBPSU2",48,0)
 N PSOTRIC S PSOTRIC="",PSOTRIC=$$TRIC^PSOREJP1(RX,RFL,PSOTRIC)
"RTN","PSOBPSU2",49,0)
 I $E(COMM,1,7)'="TRICARE",PSOTRIC S COMM=$E("TRICARE-"_COMM,1,75)
"RTN","PSOBPSU2",50,0)
 N X,DIC,DA,DD,DO,DR,DINUM,Y,DLAYGO
"RTN","PSOBPSU2",51,0)
 S DA(1)=RX,DIC="^PSRX("_RX_",""A"",",DLAYGO=52.3,DIC(0)="L"
"RTN","PSOBPSU2",52,0)
 S DIC("DR")=".02///"_TYPE_";.03////"_USR_";.04///"_$S(TYPE'="M"&(RFL>5):RFL+1,1:RFL)_";.05///"_COMM
"RTN","PSOBPSU2",53,0)
 S X=$$NOW^XLFDT() D FILE^DICN
"RTN","PSOBPSU2",54,0)
 Q
"RTN","PSOBPSU2",55,0)
 ;
"RTN","PSOBPSU2",56,0)
ECMENUM(RX) ; Returns the ECME number for a specific prescription
"RTN","PSOBPSU2",57,0)
 N ECMENUM,STS,RF
"RTN","PSOBPSU2",58,0)
 S ECMENUM=$E(10000000+RX,2,8)
"RTN","PSOBPSU2",59,0)
 S STS=$$STATUS^PSOBPSUT(RX,0)
"RTN","PSOBPSU2",60,0)
 I STS="" D
"RTN","PSOBPSU2",61,0)
 . S RF=0 F  S RF=$O(^PSRX(RX,RF)) Q:'RF  D  I STS'="" Q
"RTN","PSOBPSU2",62,0)
 . . S STS=$$STATUS^PSOBPSUT(RX,RF)
"RTN","PSOBPSU2",63,0)
 I STS="" Q ""
"RTN","PSOBPSU2",64,0)
 Q ECMENUM
"RTN","PSOBPSU2",65,0)
 ;
"RTN","PSOBPSU2",66,0)
RXNUM(ECME) ; Returns the Rx number for a specific ECME number
"RTN","PSOBPSU2",67,0)
 ;
"RTN","PSOBPSU2",68,0)
 N RXNUM,FOUND,MAX,LFT,RAD,I,DIR,RX
"RTN","PSOBPSU2",69,0)
 S MAX=$O(^PSRX(999999999999),-1),LFT=0 I $L(MAX)>7 S LFT=$E(MAX,1,$L(MAX)-7)
"RTN","PSOBPSU2",70,0)
 S FOUND=0
"RTN","PSOBPSU2",71,0)
 F RAD=LFT:-1:0 D
"RTN","PSOBPSU2",72,0)
 . S RX=RAD*10000000+ECME I $D(^PSRX(RX,0)),$$ECMENUM(RX)=ECME S FOUND=FOUND+1,FOUND(FOUND)=RX
"RTN","PSOBPSU2",73,0)
 ;
"RTN","PSOBPSU2",74,0)
 I FOUND<2 D
"RTN","PSOBPSU2",75,0)
 . I FOUND=0 S FOUND=-1 Q
"RTN","PSOBPSU2",76,0)
 . S FOUND=FOUND(1)
"RTN","PSOBPSU2",77,0)
 E  D
"RTN","PSOBPSU2",78,0)
 . W ! F I=1:1:FOUND W !?5,I,". ",$$GET1^DIQ(52,FOUND(I),.01),?25,$$GET1^DIQ(52,FOUND(I),6)
"RTN","PSOBPSU2",79,0)
 . W ! S DIR(0)="NA^1:"_FOUND,DIR("A")="Select one: ",DIR("B")=1
"RTN","PSOBPSU2",80,0)
 . D ^DIR I $D(DIRUT) S FOUND=-1 Q
"RTN","PSOBPSU2",81,0)
 . S FOUND=FOUND(Y)
"RTN","PSOBPSU2",82,0)
 ;
"RTN","PSOBPSU2",83,0)
 Q FOUND
"RTN","PSOBPSU2",84,0)
 ;
"RTN","PSOBPSU2",85,0)
ELIG(RX,RFL,PSOELIG) ;Stores eligibility flag
"RTN","PSOBPSU2",86,0)
 N DA,DIE,X,Y,PSOTRIC
"RTN","PSOBPSU2",87,0)
 I RFL=0 S DA=RX,DIE="^PSRX(",DR="85///"_PSOELIG D ^DIE
"RTN","PSOBPSU2",88,0)
 E  S DA=RFL,DA(1)=RX,DIE="^PSRX("_DA(1)_",1,",DR="85///"_PSOELIG D ^DIE
"RTN","PSOBPSU2",89,0)
 Q
"RTN","PSOBPSU2",90,0)
 ;
"RTN","PSOBPSU2",91,0)
 ;Description: 
"RTN","PSOBPSU2",92,0)
 ;Input: RX = Prescription file #52 IEN
"RTN","PSOBPSU2",93,0)
 ; RFL = Refill number
"RTN","PSOBPSU2",94,0)
 ;Returns: A value of 0 (zero) will be returned when reject codes M6, M8,
"RTN","PSOBPSU2",95,0)
 ;NN, and 99 are present OR if on susp hold which means the prescription should not 
"RTN","PSOBPSU2",96,0)
 ;be printed from suspense. Otherwise, a value of 1(one) will be returned.
"RTN","PSOBPSU2",97,0)
DUR(RX,RFL) ;
"RTN","PSOBPSU2",98,0)
 N REJ,IDX,TXT,CODE,SHOLD,SHCODE,SHDT
"RTN","PSOBPSU2",99,0)
 S SHOLD=1,IDX=""
"RTN","PSOBPSU2",100,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOBPSU2",101,0)
 S SHDT=$$SHDT(RX,RFL) ; Get suspense hold date for rx/refill
"RTN","PSOBPSU2",102,0)
 ; Add one day to compare to prevent from running just after midnight problem.
"RTN","PSOBPSU2",103,0)
 I SHDT>$$FMADD^XLFDT(DT,1) Q 0 ; Quit with 0 since still on hold
"RTN","PSOBPSU2",104,0)
 D DUR1^BPSNCPD3(RX,RFL,.REJ) ; Get reject list from last submission
"RTN","PSOBPSU2",105,0)
 F  S IDX=$O(REJ(IDX)) Q:IDX=""  D  Q:'SHOLD
"RTN","PSOBPSU2",106,0)
 . S TXT=$G(REJ(IDX,"REJ CODE LST"))
"RTN","PSOBPSU2",107,0)
 . F I=1:1:$L(TXT,",") S CODE=$P(TXT,",",I) D  Q:'SHOLD
"RTN","PSOBPSU2",108,0)
 . . F SHCODE="M6","M8","NN",99 D  Q:'SHOLD
"RTN","PSOBPSU2",109,0)
 . . . I CODE=SHCODE D
"RTN","PSOBPSU2",110,0)
 . . . . I SHDT="" S SHOLD=0 D SHDTLOG(RX,RFL) Q  ; No previous Susp Hold Date or log entry - Create it.
"RTN","PSOBPSU2",111,0)
 Q SHOLD
"RTN","PSOBPSU2",112,0)
 ;
"RTN","PSOBPSU2",113,0)
 ;Description: This subroutine sets the EPHARMACY SUSPENSE HOLD DATE field
"RTN","PSOBPSU2",114,0)
 ;for the rx or refill to tomorrow and adds an entry to the SUSPENSE Activity Log.
"RTN","PSOBPSU2",115,0)
 ;Input: RX = Prescription File IEN
"RTN","PSOBPSU2",116,0)
 ; RFL = Refill
"RTN","PSOBPSU2",117,0)
SHDTLOG(RX,RFL) ;
"RTN","PSOBPSU2",118,0)
 N DA,DIE,DR,COMM,SHDT
"RTN","PSOBPSU2",119,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOBPSU2",120,0)
 S SHDT=$$FMADD^XLFDT(DT,1)
"RTN","PSOBPSU2",121,0)
 S COMM="SUSPENSE HOLD until "_$$FMTE^XLFDT(SHDT,"2D")_" due to host reject error."
"RTN","PSOBPSU2",122,0)
 I RFL=0 S DA=RX,DIE="^PSRX(",DR="86///"_SHDT D ^DIE
"RTN","PSOBPSU2",123,0)
 E  S DA=RFL,DA(1)=RX,DIE="^PSRX("_DA(1)_",1,",DR="86///"_SHDT D ^DIE
"RTN","PSOBPSU2",124,0)
 D RXACT(RX,RFL,COMM,"S",+$G(DUZ)) ; Create Activity Log entry
"RTN","PSOBPSU2",125,0)
 Q
"RTN","PSOBPSU2",126,0)
 ;
"RTN","PSOBPSU2",127,0)
 ;Description: This function returns the EPHARMACY SUSPENSE HOLD DATE field
"RTN","PSOBPSU2",128,0)
 ;for the rx or refill
"RTN","PSOBPSU2",129,0)
 ;Input: RX = Prescription File IEN
"RTN","PSOBPSU2",130,0)
 ; RFL = Refill
"RTN","PSOBPSU2",131,0)
SHDT(RX,RFL) ;
"RTN","PSOBPSU2",132,0)
 N FILE,IENS
"RTN","PSOBPSU2",133,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOBPSU2",134,0)
 S FILE=$S(RFL=0:52,1:52.1),IENS=$S(RFL=0:RX_",",1:RFL_","_RX_",")
"RTN","PSOBPSU2",135,0)
 Q $$GET1^DIQ(FILE,IENS,86,"I")
"RTN","PSOBPSU2",136,0)
 ;
"RTN","PSOBPSU2",137,0)
ELOG(RESP) ; - due to size of PSOBPSU1 exceeding limit 
"RTN","PSOBPSU2",138,0)
 ; -Logs an ECME Activity Log if Rx Qty is different than Billing Qty
"RTN","PSOBPSU2",139,0)
 I '$G(RESP),$T(NCPDPQTY^PSSBPSUT)'="" D
"RTN","PSOBPSU2",140,0)
 . N DRUG,RXQTY,BLQTY,BLDU,Z
"RTN","PSOBPSU2",141,0)
 . S DRUG=$$GET1^DIQ(52,RX,6,"I")
"RTN","PSOBPSU2",142,0)
 . S RXQTY=$S('RFL:$$GET1^DIQ(52,RX,7,"I"),1:$$GET1^DIQ(52.1,RFL_","_RX,1))/1
"RTN","PSOBPSU2",143,0)
 . S Z=$$NCPDPQTY^PSSBPSUT(DRUG,RXQTY),BLQTY=Z/1,BLDU=$P(Z,"^",2)
"RTN","PSOBPSU2",144,0)
 . I RXQTY'=BLQTY D
"RTN","PSOBPSU2",145,0)
 . . D RXACT(RX,RFL,"BILLING QUANTITY submitted: "_$J(BLQTY,0,$L($P(BLQTY,".",2)))_" ("_BLDU_")","M",DUZ)
"RTN","PSOBPSU2",146,0)
 Q
"RTN","PSOBPSU2",147,0)
 ;
"RTN","PSOBPSU2",148,0)
UPDFL(RXREC,SUB,INDT) ;update fill date with release date when NDC changes at CMOP and OPAI auto-release
"RTN","PSOBPSU2",149,0)
 ;Input: RXREC = Prescription File IEN
"RTN","PSOBPSU2",150,0)
 ;         SUB = Refill
"RTN","PSOBPSU2",151,0)
 ;        INDT = Release date
"RTN","PSOBPSU2",152,0)
 N DA,DIE,DR,PSOX,SFN,DEAD,SUB,XOK,OLD,X,II,EXDAT,OFILLD,COM,CNT,RFCNT,RF
"RTN","PSOBPSU2",153,0)
 S DEAD=0,SFN=""
"RTN","PSOBPSU2",154,0)
 S EXDAT=INDT I EXDAT["." S EXDAT=$P(EXDAT,".")
"RTN","PSOBPSU2",155,0)
 I '$D(SUB) S SUB=0 F II=0:0 S II=$O(^PSRX(RXREC,1,II)) Q:'II  S SUB=+II
"RTN","PSOBPSU2",156,0)
 I 'SUB S OFILLD=$$GET1^DIQ(52,RXREC,22,"I") Q:OFILLD=EXDAT  D
"RTN","PSOBPSU2",157,0)
 .S (X,OLD)=$P(^PSRX(RXREC,2),"^",2),DA=RXREC,DR="22///"_EXDAT_";101///"_EXDAT,DIE=52
"RTN","PSOBPSU2",158,0)
 .D ^DIE K DIE,DA
"RTN","PSOBPSU2",159,0)
 I SUB S (OLD,X)=+$P($G(^PSRX(RXREC,1,SUB,0)),"^"),DA(1)=RXREC,DA=SUB,OFILLD=$$GET1^DIQ(52.1,DA_","_RXREC,.01,"I") Q:OFILLD=EXDAT  D
"RTN","PSOBPSU2",160,0)
 . S DIE="^PSRX("_DA(1)_",1,",DR=".01///"_EXDAT D ^DIE K DIE S $P(^PSRX(RXREC,3),"^")=EXDAT
"RTN","PSOBPSU2",161,0)
 Q:$D(DTOUT)!($D(DUOUT))
"RTN","PSOBPSU2",162,0)
 S DA=RXREC
"RTN","PSOBPSU2",163,0)
 D AREC^PSOSUCH1
"RTN","PSOBPSU2",164,0)
FIN ;
"RTN","PSOBPSU2",165,0)
 Q
"RTN","PSOBPSUT")
0^27^B54217211
"RTN","PSOBPSUT",1,0)
PSOBPSUT ;BIRM/MFR - BPS (ECME) Utilities ; 07 Jun 2005  8:39 PM
"RTN","PSOBPSUT",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**148,247,260,281,287,289**;DEC 1997;Build 107
"RTN","PSOBPSUT",3,0)
 ;Reference to $$ECMEON^BPSUTIL supported by IA 4410
"RTN","PSOBPSUT",4,0)
 ;Reference to IBSEND^BPSECMP2 supported by IA 4411
"RTN","PSOBPSUT",5,0)
 ;Reference to $$STATUS^BPSOSRX supported by IA 4412
"RTN","PSOBPSUT",6,0)
 ;Reference to $$NDCFMT^PSSNDCUT supported by IA 4707
"RTN","PSOBPSUT",7,0)
 ;Reference to $$CLAIM^BPSBUTL supported by IA 4719
"RTN","PSOBPSUT",8,0)
 ;Reference to ^PS(55 supported by IA 2228
"RTN","PSOBPSUT",9,0)
 ;Reference to ^PSDRUG( supported by IA 221
"RTN","PSOBPSUT",10,0)
 ;Reference to ^PSDRUG("AQ" supported by IA 3165
"RTN","PSOBPSUT",11,0)
 ;
"RTN","PSOBPSUT",12,0)
ECME(RX) ; Returns "e" if Rx/Refill is Electronically Billable (3rd party)
"RTN","PSOBPSUT",13,0)
 Q $S($$STATUS^BPSOSRX(RX,$$LSTRFL^PSOBPSU1(RX))'="":"e",1:"")
"RTN","PSOBPSUT",14,0)
 ;
"RTN","PSOBPSUT",15,0)
STATUS(RX,RFL) ; Returns the Rx's ECME Status (calls STATUS^BPSOSRX)
"RTN","PSOBPSUT",16,0)
 ; Input:  (r) RX  - Rx IEN (#52) 
"RTN","PSOBPSUT",17,0)
 ;         (o) RFL - Refill # (Default: most recent)
"RTN","PSOBPSUT",18,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOBPSUT",19,0)
 Q $P($$STATUS^BPSOSRX(RX,RFL),"^")
"RTN","PSOBPSUT",20,0)
 ;
"RTN","PSOBPSUT",21,0)
SUBMIT(RX,RFL,IGRL,IGCMP) ; Returns whether the Rx should be submitted to ECME at the moment or not
"RTN","PSOBPSUT",22,0)
 ; Input:  (r) RX   - Rx IEN (#52)
"RTN","PSOBPSUT",23,0)
 ;         (o) RFL  - Refill # (Def.: most recent)
"RTN","PSOBPSUT",24,0)
 ;         (o) IGRL - Ignore Release Date? (1-YES/0-NO) (Def.: 0 - NO)
"RTN","PSOBPSUT",25,0)
 ;         (o) IGCMP- Ignore CMOP/Suspense check? (1-YES/0-NO) (Def.: 0 - NO)
"RTN","PSOBPSUT",26,0)
 ;
"RTN","PSOBPSUT",27,0)
 ; - Get the REFILL # (multiple IEN)
"RTN","PSOBPSUT",28,0)
 N STATUS
"RTN","PSOBPSUT",29,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOBPSUT",30,0)
 ; - Not the latest fill for the prescription
"RTN","PSOBPSUT",31,0)
 I RFL'=$$LSTRFL^PSOBPSU1(RX) Q 0
"RTN","PSOBPSUT",32,0)
 ; - Status not ACTIVE, DISCONTINUED, or EXPIRED
"RTN","PSOBPSUT",33,0)
 S STATUS=$$GET1^DIQ(52,RX,100,"I")
"RTN","PSOBPSUT",34,0)
 I ",0,11,12,14,15,"'[(","_STATUS_",") Q 0
"RTN","PSOBPSUT",35,0)
 ; Will suspend for CMOP
"RTN","PSOBPSUT",36,0)
 I '$G(IGCMP),$$CMOP(RX,RFL) Q 0
"RTN","PSOBPSUT",37,0)
 ; - ECME turned OFF for Rx's site
"RTN","PSOBPSUT",38,0)
 I '$$ECMEON^BPSUTIL($$RXSITE(RX,RFL)) Q 0
"RTN","PSOBPSUT",39,0)
 ; - Rx is RELEASED - Do not submit
"RTN","PSOBPSUT",40,0)
 I '$G(IGRL),$$RXRLDT(RX,RFL) Q 0
"RTN","PSOBPSUT",41,0)
 ; - Future Fill/AUTO SUSPENSE ON - will suspend
"RTN","PSOBPSUT",42,0)
 I '$G(IGCMP),$$RXFLDT(RX,RFL)>DT,$$GET1^DIQ(59,$$RXSITE(RX,RFL),.16,"I") Q 0
"RTN","PSOBPSUT",43,0)
 Q 1
"RTN","PSOBPSUT",44,0)
 ;
"RTN","PSOBPSUT",45,0)
CMOP(RX,RFL) ; Returns if the Rx will be a CMOP Rx or not
"RTN","PSOBPSUT",46,0)
 ; Input:  (r) RX  - Rx IEN (#52) 
"RTN","PSOBPSUT",47,0)
 ;         (o) RFL - Refill # (Default: most recent)
"RTN","PSOBPSUT",48,0)
 ; Output: 1 - CMOP / 0 - NON-CMOP
"RTN","PSOBPSUT",49,0)
 ;
"RTN","PSOBPSUT",50,0)
 N DFN,CMOP,MAIL,MAILEXP,DRUG,WARNS,STATUS,MW,A
"RTN","PSOBPSUT",51,0)
 ; Get the REFILL # (multiple IEN)
"RTN","PSOBPSUT",52,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOBPSUT",53,0)
 ; MAIL=MAIL Code, MAILEXP=Mail Code Expiration Date
"RTN","PSOBPSUT",54,0)
 S CMOP=0
"RTN","PSOBPSUT",55,0)
 S DFN=$$GET1^DIQ(52,RX,2,"I"),MAIL=$$GET1^DIQ(55,DFN,.03,"I"),MAILEXP=$$GET1^DIQ(55,DFN,.05,"I")
"RTN","PSOBPSUT",56,0)
 I MAIL>1,MAILEXP=""!(MAILEXP>DT) G QCMOP
"RTN","PSOBPSUT",57,0)
 ; Get drug IEN and check DRUG if CMOP  ,$S($G(MAILEXP)=""!($G(MAILEXP)>DT):1,1:0)
"RTN","PSOBPSUT",58,0)
 S DRUG=$$GET1^DIQ(52,RX,6,"I") G QCMOP:'DRUG,QCMOP:'$D(^PSDRUG("AQ",DRUG))
"RTN","PSOBPSUT",59,0)
 ; Not marked for O.P.
"RTN","PSOBPSUT",60,0)
 I $$GET1^DIQ(50,DRUG,63)'["O" G QCMOP
"RTN","PSOBPSUT",61,0)
 ; Drug Warning >11
"RTN","PSOBPSUT",62,0)
 S WARNS=$$GET1^DIQ(50,DRUG,8) I $L(WARNS)>11 G QCMOP
"RTN","PSOBPSUT",63,0)
 ; If tradename
"RTN","PSOBPSUT",64,0)
 I $$GET1^DIQ(52,RX,6.5)'="" G QCMOP
"RTN","PSOBPSUT",65,0)
 ; If Cancelled, Expired, Deleted, Hold
"RTN","PSOBPSUT",66,0)
 S STATUS=$$GET1^DIQ(52,RX,100,"I") I (STATUS>9&(",14,15,"'[(","_STATUS_",")))!(STATUS=4)!(STATUS=3) G QCMOP
"RTN","PSOBPSUT",67,0)
 ; Rx RELEASED
"RTN","PSOBPSUT",68,0)
 I $$RXRLDT^PSOBPSUT(RX,RFL) G QCMOP
"RTN","PSOBPSUT",69,0)
 ; MAIL/WINDOW
"RTN","PSOBPSUT",70,0)
 S MW=$S('RFL:$$GET1^DIQ(52,RX,11,"I"),1:$$GET1^DIQ(52.1,RFL_","_RX,2,"I"))
"RTN","PSOBPSUT",71,0)
 ; IF WINDOW/ORIGINAL/FUTURE FILL SETS MW = MAIL
"RTN","PSOBPSUT",72,0)
 I MW="W",$$RXFLDT^PSOBPSUT(RX,RFL)>DT S MW="M"
"RTN","PSOBPSUT",73,0)
 ; If not MAIL
"RTN","PSOBPSUT",74,0)
 I MW'="M" G QCMOP
"RTN","PSOBPSUT",75,0)
 S CMOP=1
"RTN","PSOBPSUT",76,0)
 ;
"RTN","PSOBPSUT",77,0)
QCMOP Q CMOP
"RTN","PSOBPSUT",78,0)
 ;
"RTN","PSOBPSUT",79,0)
RXRLDT(RX,RFL) ; Returns the Rx Release Date
"RTN","PSOBPSUT",80,0)
 ; Input:  (r) RX  - Rx IEN (#52) 
"RTN","PSOBPSUT",81,0)
 ;         (o) RFL - Refill # (Default: most recent)
"RTN","PSOBPSUT",82,0)
 ;        
"RTN","PSOBPSUT",83,0)
 ; Output:  RXRLDT - Rx Release Date
"RTN","PSOBPSUT",84,0)
 N RXRLDT
"RTN","PSOBPSUT",85,0)
 I '$G(RX) Q ""
"RTN","PSOBPSUT",86,0)
 S RXRLDT=$$GET1^DIQ(52,RX,31,"I")
"RTN","PSOBPSUT",87,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOBPSUT",88,0)
 I RFL S RXRLDT=$$GET1^DIQ(52.1,RFL_","_RX,17,"I")
"RTN","PSOBPSUT",89,0)
 Q RXRLDT
"RTN","PSOBPSUT",90,0)
 ;
"RTN","PSOBPSUT",91,0)
RXFLDT(RX,RFL) ; Returns the Rx Fill Date
"RTN","PSOBPSUT",92,0)
 ; Input:  (r) RX  - Rx IEN (#52) 
"RTN","PSOBPSUT",93,0)
 ;         (o) RFL - Refill # (Default: most recent)      
"RTN","PSOBPSUT",94,0)
 ; Output:  RXFLDT - Rx Fill Date
"RTN","PSOBPSUT",95,0)
 N RXFLDT
"RTN","PSOBPSUT",96,0)
 I '$G(RX) Q ""
"RTN","PSOBPSUT",97,0)
 S RXFLDT=$$GET1^DIQ(52,RX,22,"I")
"RTN","PSOBPSUT",98,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOBPSUT",99,0)
 I RFL S RXFLDT=$$GET1^DIQ(52.1,RFL_","_RX,.01,"I")
"RTN","PSOBPSUT",100,0)
 Q RXFLDT
"RTN","PSOBPSUT",101,0)
 ;
"RTN","PSOBPSUT",102,0)
RXSUDT(RX,RFL) ; Returns the prescription/fill Suspense Date for the RX/Reject passed in
"RTN","PSOBPSUT",103,0)
 ;Input: (r) RX   - Rx IEN (#52)
"RTN","PSOBPSUT",104,0)
 ;       (o) RFL  - Refill IEN (#52.1)
"RTN","PSOBPSUT",105,0)
 ;Output: SUSPENSE DATE (External format) or <NULL>, if not suspended
"RTN","PSOBPSUT",106,0)
 ;
"RTN","PSOBPSUT",107,0)
 I $G(^PSRX(RX,"STA"))'=5 Q ""
"RTN","PSOBPSUT",108,0)
 N SURX,SURFL
"RTN","PSOBPSUT",109,0)
 S SURX=$O(^PS(52.5,"B",RX,0)) I 'SURX Q ""
"RTN","PSOBPSUT",110,0)
 I $$GET1^DIQ(52.5,SURX,.05,"I") Q ""
"RTN","PSOBPSUT",111,0)
 S SURFL=+$$GET1^DIQ(52.5,SURX,9) I RFL'=SURFL Q ""
"RTN","PSOBPSUT",112,0)
 Q $$GET1^DIQ(52.5,SURX,.02,"I")
"RTN","PSOBPSUT",113,0)
 ;
"RTN","PSOBPSUT",114,0)
RXSITE(RX,RFL) ; Returns the Rx DIVISION
"RTN","PSOBPSUT",115,0)
 ; Input:  (r) RX  - Rx IEN (#52) 
"RTN","PSOBPSUT",116,0)
 ;         (o) RFL - Refill #
"RTN","PSOBPSUT",117,0)
 ; Output:  SITE - Rx Fill Date
"RTN","PSOBPSUT",118,0)
 ;        
"RTN","PSOBPSUT",119,0)
 N SITE
"RTN","PSOBPSUT",120,0)
 I '$G(RX) Q ""
"RTN","PSOBPSUT",121,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOBPSUT",122,0)
 I RFL S SITE=$$GET1^DIQ(52.1,RFL_","_RX,8,"I")
"RTN","PSOBPSUT",123,0)
 I 'RFL!'$G(SITE) S SITE=$$GET1^DIQ(52,RX,20,"I")
"RTN","PSOBPSUT",124,0)
 Q SITE
"RTN","PSOBPSUT",125,0)
 ;
"RTN","PSOBPSUT",126,0)
MANREL(RX,RFL,PID) ; ePharmacy Manual Rx Release
"RTN","PSOBPSUT",127,0)
 ;Input: (r) RX  - Rx IEN (#52)
"RTN","PSOBPSUT",128,0)
 ;       (o) RFL - Refill # (Default: most recent)
"RTN","PSOBPSUT",129,0)
 ;       (o) PID - Displays PID/Drug/Rx in the NDC prompts
"RTN","PSOBPSUT",130,0)
 ;Output: "" (null - OK to Release) OR "^" (User entered "^", or no valid NDC on file for ePharmacy Rx)
"RTN","PSOBPSUT",131,0)
 ;       
"RTN","PSOBPSUT",132,0)
 N ACTION
"RTN","PSOBPSUT",133,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOBPSUT",134,0)
 ; - Checking for REJECTS before proceeding to Rx Release
"RTN","PSOBPSUT",135,0)
 I $$FIND^PSOREJUT(RX,RFL) D  I ACTION="Q"!(ACTION="^") W ! Q "^"
"RTN","PSOBPSUT",136,0)
 . S ACTION=$$HDLG^PSOREJU1(RX,RFL,"79,88","ED","OIQ","Q")
"RTN","PSOBPSUT",137,0)
 ; - ePharmacy switch is OFF
"RTN","PSOBPSUT",138,0)
 I '$$ECMEON^BPSUTIL($$RXSITE^PSOBPSUT(RX,RFL)) Q ""
"RTN","PSOBPSUT",139,0)
 ; - Not an ePharmacy Rx
"RTN","PSOBPSUT",140,0)
 I $$STATUS^PSOBPSUT(RX,RFL)="" Q ""
"RTN","PSOBPSUT",141,0)
 I '$D(PSOTRIC) N PSOTRIC S PSOTRIC="",PSOTRIC=$$TRIC^PSOREJP1(RX,RFL,PSOTRIC)
"RTN","PSOBPSUT",142,0)
 ; - NDC editing before Rx release
"RTN","PSOBPSUT",143,0)
 S ACTION=$$CHGNDC^PSONDCUT(RX,RFL,$G(PID))
"RTN","PSOBPSUT",144,0)
 I ACTION="^"!(ACTION=2) D  Q "^"
"RTN","PSOBPSUT",145,0)
 . W:ACTION="^" !!,$C(7),"A valid NDC must be entered before the Release function can be completed.",! H 1
"RTN","PSOBPSUT",146,0)
 . I $G(PSOTRIC) D:ACTION=2 TRIC
"RTN","PSOBPSUT",147,0)
 ; - Checking for OPEN/UNRESOLVED 3rd. Party Payer Rejects (After possible NDC edit)
"RTN","PSOBPSUT",148,0)
 I $$FIND^PSOREJUT(RX,RFL) D  I ACTION="Q"!(ACTION="^") W ! Q "^"
"RTN","PSOBPSUT",149,0)
 . S ACTION=$$HDLG^PSOREJU1(RX,RFL,"79,88","ED","OIQ","Q")
"RTN","PSOBPSUT",150,0)
 I $G(PSOTRIC),$$STATUS^PSOBPSUT(RX,RFL)["IN PROGRESS" D TRIC Q "^"
"RTN","PSOBPSUT",151,0)
 ; - Notifying IB of a Rx RELEASE event 
"RTN","PSOBPSUT",152,0)
 D RELEASE^PSOBPSU1(RX,RFL,DUZ)
"RTN","PSOBPSUT",153,0)
 Q ""
"RTN","PSOBPSUT",154,0)
 ;
"RTN","PSOBPSUT",155,0)
TRIC ;
"RTN","PSOBPSUT",156,0)
 W !!,$C(7),"TRICARE Rx remains in 'IN PROGRESS' status for ECME, and cannot be released.",! H 1
"RTN","PSOBPSUT",157,0)
 Q
"RTN","PSOBPSUT",158,0)
 ;
"RTN","PSOBPSUT",159,0)
AUTOREL(RX,RFL,RLDT,NDC,SRC,STS,HNG) ; Sends Rx Release information to ECME/IB and updates NDC
"RTN","PSOBPSUT",160,0)
 ;                                 in the DRUG/PRESCRIPTION files
"RTN","PSOBPSUT",161,0)
 ;Input: (r) RX  - Rx IEN (#52)
"RTN","PSOBPSUT",162,0)
 ;       (o) RFL - Refill #  (Default: most recent)
"RTN","PSOBPSUT",163,0)
 ;       (r) RLDT- Release Date
"RTN","PSOBPSUT",164,0)
 ;       (r) NDC - NDC Number (Must be 11 digits)
"RTN","PSOBPSUT",165,0)
 ;       (o) SRC - SOURCE: "C" - CMOP / "A" - OPAI
"RTN","PSOBPSUT",166,0)
 ;       (o) STS - Status: (S)uccessful/(U)nsuccessful Release (Default: "S" - Successful)
"RTN","PSOBPSUT",167,0)
 ;       (o) HNG - HANG time after resubmission and before checking the status of the claim (Default: 0)
"RTN","PSOBPSUT",168,0)
 ;       
"RTN","PSOBPSUT",169,0)
 N RXNDC,SITE
"RTN","PSOBPSUT",170,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOBPSUT",171,0)
 S:'$D(STS) STS="S" S:'$D(SRC) SRC="" S HNG=+$G(HNG)
"RTN","PSOBPSUT",172,0)
 S RXNDC=$$GETNDC^PSONDCUT(RX,RFL)
"RTN","PSOBPSUT",173,0)
 ; - Saves the NDC from CMOP/Automated Dispensing Machine in the Prescription file
"RTN","PSOBPSUT",174,0)
 I $$NDCFMT^PSSNDCUT(NDC)'="" D SAVNDC^PSONDCUT(RX,RFL,$$NDCFMT^PSSNDCUT(NDC),$S(SRC="C":1,1:0))
"RTN","PSOBPSUT",175,0)
 ; - Not an ePharmacy Rx
"RTN","PSOBPSUT",176,0)
 I $$STATUS^PSOBPSUT(RX,RFL)="" Q ""
"RTN","PSOBPSUT",177,0)
 ; - Unsuccessful Release 
"RTN","PSOBPSUT",178,0)
 I STS="U" D  Q
"RTN","PSOBPSUT",179,0)
 . D REVERSE^PSOBPSU1(RX,RFL,"CRLX",,"UNSUCCESSFUL "_$S(SRC="C":"CMOP",1:"EXT INTERFACE")_" RELEASE",1)
"RTN","PSOBPSUT",180,0)
 ; - Notifying IB of a Rx RELEASE event 
"RTN","PSOBPSUT",181,0)
 D RELEASE^PSOBPSU1(RX,RFL)
"RTN","PSOBPSUT",182,0)
 ; - Invalid NDC from Automated Dispensing Machine
"RTN","PSOBPSUT",183,0)
 I SRC="A",$$NDCFMT^PSSNDCUT(NDC)="" D  Q
"RTN","PSOBPSUT",184,0)
 . D REVERSE^PSOBPSU1(RX,RFL,"CRLR",,"INVALID EXT INTERFACE NDC",1,NDC)
"RTN","PSOBPSUT",185,0)
 ; - Invalid NDC number for CMOP
"RTN","PSOBPSUT",186,0)
 I SRC="C",$$NDCFMT^PSSNDCUT(NDC)="" D  Q
"RTN","PSOBPSUT",187,0)
 . D REVERSE^PSOBPSU1(RX,RFL,"CRLR",,"INVALID CMOP NDC",1,NDC)
"RTN","PSOBPSUT",188,0)
 ; - If NDC not equal RXNDC, issue reversal and submit new claim
"RTN","PSOBPSUT",189,0)
 I SRC="A",$$NDCFMT^PSSNDCUT(NDC)'=RXNDC D  Q
"RTN","PSOBPSUT",190,0)
 . D ECMESND^PSOBPSU1(RX,RFL,RLDT,"CRLB",$$NDCFMT^PSSNDCUT(NDC),,"AUTO RELEASE",,1,,1),UPDFL^PSOBPSU2(RX,RFL,RLDT)
"RTN","PSOBPSUT",191,0)
 . H HNG
"RTN","PSOBPSUT",192,0)
 . ; - If new claim returned PAYABLE, save new NDC in the DRUG/PRESCRIPTION files
"RTN","PSOBPSUT",193,0)
 . I $$STATUS^PSOBPSUT(RX,RFL)="E PAYABLE" D SAVNDC^PSONDCUT(RX,RFL,$$NDCFMT^PSSNDCUT(NDC),0,1)
"RTN","PSOBPSUT",194,0)
 ; - If NDC not equal RXNDC, issue reversal and submit new claim
"RTN","PSOBPSUT",195,0)
 I SRC="C",$$NDCFMT^PSSNDCUT(NDC)'=RXNDC D  Q
"RTN","PSOBPSUT",196,0)
 . ; - Reverse/Resubmit with correct NDC
"RTN","PSOBPSUT",197,0)
 . D ECMESND^PSOBPSU1(RX,RFL,RLDT,"CRLB",$$NDCFMT^PSSNDCUT(NDC),1,"CMOP RELEASE",,1,,1),UPDFL^PSOBPSU2(RX,RFL,RLDT)
"RTN","PSOBPSUT",198,0)
 . ; - Wait for a response from the Payer for the submission above
"RTN","PSOBPSUT",199,0)
 . H HNG
"RTN","PSOBPSUT",200,0)
 . ; - If new claim returned PAYABLE, save new NDC in the DRUG/PRESCRIPTION files
"RTN","PSOBPSUT",201,0)
 . I $$STATUS^PSOBPSUT(RX,RFL)="E PAYABLE" D SAVNDC^PSONDCUT(RX,RFL,$$NDCFMT^PSSNDCUT(NDC),1,1)
"RTN","PSOBPSUT",202,0)
 ; - Calls ECME api responsible for notifying IB to create a BILL
"RTN","PSOBPSUT",203,0)
 D IBSEND(RX,RFL)
"RTN","PSOBPSUT",204,0)
 Q
"RTN","PSOBPSUT",205,0)
 ;
"RTN","PSOBPSUT",206,0)
IBSEND(RX,RFL) ; Rx Release: Calls ECME, which will call  IB to create a bill
"RTN","PSOBPSUT",207,0)
 ;Input: (r) RX  - Rx IEN (#52)
"RTN","PSOBPSUT",208,0)
 ;       (o) RFL - Refill #  (Default: most recent)
"RTN","PSOBPSUT",209,0)
 ;
"RTN","PSOBPSUT",210,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOBPSUT",211,0)
 ; - ECME turned OFF for Rx's site
"RTN","PSOBPSUT",212,0)
 I '$$ECMEON^BPSUTIL($$RXSITE^PSOBPSUT(RX,RFL)) Q
"RTN","PSOBPSUT",213,0)
 ; - Not an ePharmacy Rx
"RTN","PSOBPSUT",214,0)
 I $$STATUS^PSOBPSUT(RX,RFL)="" Q ""
"RTN","PSOBPSUT",215,0)
 ; - Calls ECME previously reversed, re-submit the claim to the payer
"RTN","PSOBPSUT",216,0)
 I $$STATUS^PSOBPSUT(RX,RFL)="E REVERSAL ACCEPTED"!($$STATUS^PSOBPSUT(RX,RFL)="IN PROGRESS") D  Q
"RTN","PSOBPSUT",217,0)
 . D ECMESND^PSOBPSU1(RX,RFL,$$RXRLDT^PSOBPSUT(RX,RFL),"RRL")
"RTN","PSOBPSUT",218,0)
 ; - Notifying ECME of a BILLING event 
"RTN","PSOBPSUT",219,0)
 I $$STATUS^PSOBPSUT(RX,RFL)="E PAYABLE" D  Q
"RTN","PSOBPSUT",220,0)
 . N PSOCLAIM S PSOCLAIM=$$CLAIM^BPSBUTL(RX,RFL)
"RTN","PSOBPSUT",221,0)
 . D IBSEND^BPSECMP2($P(PSOCLAIM,"^",2),$P(PSOCLAIM,"^",3),"BILL",DUZ)
"RTN","PSOBPSUT",222,0)
 Q
"RTN","PSOBPSUT",223,0)
 ;
"RTN","PSOBPSUT",224,0)
RETRX(RX,RFL) ; - Re-transmit a claim for the prescription/fill?
"RTN","PSOBPSUT",225,0)
 ;Input: (r) RX  - Rx IEN (#52)
"RTN","PSOBPSUT",226,0)
 ;       (o) RFL - Refill # (Default: most recent)
"RTN","PSOBPSUT",227,0)
 ;Output: 1 - Re-transmit  /  0 - Don't re-transmit
"RTN","PSOBPSUT",228,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOBPSUT",229,0)
 I RFL Q +$$GET1^DIQ(52.1,RFL_","_RX,82,"I")
"RTN","PSOBPSUT",230,0)
 Q +$$GET1^DIQ(52,RX,82,"I")
"RTN","PSONDCUT")
0^34^B54609363
"RTN","PSONDCUT",1,0)
PSONDCUT ;BIRM/MFR - NDC Utilities ;10/15/04
"RTN","PSONDCUT",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**148,287,317,289**;DEC 1997;Build 107
"RTN","PSONDCUT",3,0)
 ;Reference to $$ECMEON^BPSUTIL supported by DBIA 4410
"RTN","PSONDCUT",4,0)
 ;References to $$GETNDC^PSSNDCUT,$$NDCFMT^PSSNDCUT,SAVNDC^PSSNDCUT supported by IA 4707
"RTN","PSONDCUT",5,0)
 ;
"RTN","PSONDCUT",6,0)
CHGNDC(RX,RFL,BCODE,STOCK)   ; Prompt for NDC code during Rx Release for HIPAA/NCPDP project
"RTN","PSONDCUT",7,0)
 ;Input:  (r) RX     - Rx IEN (#52)
"RTN","PSONDCUT",8,0)
 ;        (o) RFL    - Refill Number (#52.1)
"RTN","PSONDCUT",9,0)
 ;        (o) BCODE  - Displays PID: 999-99-9999/MED: XXXXX XXXXXXXXXXX 999MG in the NDC prompt (1-YES/0-NO)
"RTN","PSONDCUT",10,0)
 ;        (o) STOCK  - Flag denoting that Stock NDC is being Validated
"RTN","PSONDCUT",11,0)
 ;        
"RTN","PSONDCUT",12,0)
 ;Output: (r) NDCCHG - NDC was changed? (1-YES/0-NO)^New NDC number 
"RTN","PSONDCUT",13,0)
 ;                     OR "^" if no valid NDC or "^" entered
"RTN","PSONDCUT",14,0)
 ;        
"RTN","PSONDCUT",15,0)
 N PSONDC,NEWNDC,SITE,NOREL,ACT,NDCVALID
"RTN","PSONDCUT",16,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSONDCUT",17,0)
 S SITE=$$RXSITE^PSOBPSUT(RX,RFL) I '$$ECMEON^BPSUTIL(SITE) Q "^"  ; ECME is not turned ON for the Rx's Division
"RTN","PSONDCUT",18,0)
 ;
"RTN","PSONDCUT",19,0)
 ; - Retrieving Rx NDC and Fill Date
"RTN","PSONDCUT",20,0)
 S PSONDC=$$GETNDC(RX,RFL),NOREL=0
"RTN","PSONDCUT",21,0)
 ;
"RTN","PSONDCUT",22,0)
 ; - Display NDC validation status
"RTN","PSONDCUT",23,0)
 S NDCVALID=$$ISVALID^PSONDCV(RX,RFL,1)
"RTN","PSONDCUT",24,0)
 ;
"RTN","PSONDCUT",25,0)
 ; - Prompts for NDC number
"RTN","PSONDCUT",26,0)
 I $G(BCODE) F I=1:1:5 W $C(7)
"RTN","PSONDCUT",27,0)
 S NEWNDC=PSONDC D NDCEDT(RX,RFL,,SITE,.NEWNDC,$G(BCODE)) I NEWNDC="^"!(NEWNDC="") Q "^"
"RTN","PSONDCUT",28,0)
 ;
"RTN","PSONDCUT",29,0)
 I '$D(PSOTRIC) N PSOTRIC S PSOTRIC="",PSOTRIC=$$TRIC^PSOREJP1(RX,RFL,PSOTRIC)
"RTN","PSONDCUT",30,0)
 ; - If NDC changed, resubmit to ECME and save new NDC in the DRUG and PRESCRIPTION files
"RTN","PSONDCUT",31,0)
 I PSONDC'=NEWNDC D  Q:'NOREL ("1^"_NEWNDC)  Q:NOREL 2
"RTN","PSONDCUT",32,0)
 . D RXACT^PSOBPSU2(RX,RFL,"NDC changed from "_PSONDC_" to "_NEWNDC_" during release.","E")
"RTN","PSONDCUT",33,0)
 . D SAVNDC(RX,RFL,NEWNDC,0,1)
"RTN","PSONDCUT",34,0)
 . N RESP D ECMESND^PSOBPSU1(RX,RFL,,"ED",NEWNDC,,"RX RELEASE-NDC CHANGE",,1,,1)
"RTN","PSONDCUT",35,0)
 . I $D(RESP),$P(RESP,"^",4)["IN PROGRESS",PSOTRIC S NOREL=1 Q
"RTN","PSONDCUT",36,0)
 . I '$D(RESP),$$STATUS^PSOBPSUT(RX,RFL)["IN PROGRESS",PSOTRIC D
"RTN","PSONDCUT",37,0)
 . . S NOREL=1,ACT="TRICARE-NDC edit at REL: Not released due to 'IN PROGRESS' ECME status"
"RTN","PSONDCUT",38,0)
 . . D RXACT^PSOBPSU2(RX,RFL,ACT,"M",DUZ)
"RTN","PSONDCUT",39,0)
 Q 0
"RTN","PSONDCUT",40,0)
 ;
"RTN","PSONDCUT",41,0)
NDCEDT(RX,RFL,DRG,SITE,NDC,BCODE) ; Allows editing of the Rx NDC code
"RTN","PSONDCUT",42,0)
 ; Input: (r) RX    - Rx IEN (#52) 
"RTN","PSONDCUT",43,0)
 ;        (o) RFL   - Refill Number (#52.1)
"RTN","PSONDCUT",44,0)
 ;        (o) DRG   - Drug IEN (#50)
"RTN","PSONDCUT",45,0)
 ;        (o) NDC   - Default NDC Number/Return parameter ("" means no NDC selected)  (Note: REQUIRED for Output value)
"RTN","PSONDCUT",46,0)
 ;        (o) BCODE - Display the PID/Drug Name in the NDC prompt
"RTN","PSONDCUT",47,0)
 ;Output: (r) .NDC  - Selected NDC Number
"RTN","PSONDCUT",48,0)
 ;
"RTN","PSONDCUT",49,0)
 N SNDC,SYN,Y,Z,IDX,I,PID,DFN,DRGNAM,PRPT,DIR,DEFNDC
"RTN","PSONDCUT",50,0)
 K ^TMP($J,"PSONDCDP"),^TMP($J,"PSONDCFM")
"RTN","PSONDCUT",51,0)
 I '$G(DRG),$G(RX) S DRG=$$GET1^DIQ(52,RX,6,"I")
"RTN","PSONDCUT",52,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSONDCUT",53,0)
 S IDX=0,SITE=+$G(SITE) I 'SITE,$G(RX) S SITE=$$RXSITE^PSOBPSUT(RX,RFL)
"RTN","PSONDCUT",54,0)
 ;
"RTN","PSONDCUT",55,0)
 ; - Setting the NDC currently on the PRESCRIPTION (passed in)
"RTN","PSONDCUT",56,0)
 I $G(NDC)'="",$$NDCFMT^PSSNDCUT(NDC)'="" S IDX=1,^TMP($J,"PSONDCFM",IDX)=NDC,^TMP($J,"PSONDCDP",NDC)=IDX
"RTN","PSONDCUT",57,0)
 ;
"RTN","PSONDCUT",58,0)
 ; - Retrieving NDC from the PRESCRIPTION file
"RTN","PSONDCUT",59,0)
 I $G(RX) D
"RTN","PSONDCUT",60,0)
 . S NDC=$$GETNDC(RX,RFL)
"RTN","PSONDCUT",61,0)
 . I NDC'="",'$D(^TMP($J,"PSONDCDP",NDC)) D
"RTN","PSONDCUT",62,0)
 . . S IDX=IDX+1,^TMP($J,"PSONDCFM",IDX)=NDC,^TMP($J,"PSONDCDP",NDC)=IDX
"RTN","PSONDCUT",63,0)
 ;
"RTN","PSONDCUT",64,0)
 ; - Retrieve Price Per Dispense Unit for default NDC
"RTN","PSONDCUT",65,0)
 S DEFNDC="",DEFNDC=$$NDCFMT^PSSNDCUT($$GET1^DIQ(50,DRG,31))
"RTN","PSONDCUT",66,0)
 ;
"RTN","PSONDCUT",67,0)
 S:'IDX IDX=1
"RTN","PSONDCUT",68,0)
 ;
"RTN","PSONDCUT",69,0)
 ; - Retrieving NDC from the DRUG/NDF files
"RTN","PSONDCUT",70,0)
 S NDC=$$GETNDC^PSSNDCUT(DRG)
"RTN","PSONDCUT",71,0)
 I NDC'="",'$D(^TMP($J,"PSONDCDP",NDC)) D
"RTN","PSONDCUT",72,0)
 . S IDX=IDX+1,^TMP($J,"PSONDCFM",IDX)=NDC,^TMP($J,"PSONDCDP",NDC)=IDX
"RTN","PSONDCUT",73,0)
 ; 
"RTN","PSONDCUT",74,0)
 ; - Retrieving NDC by OUTPATIENT SITE from the DRUG/NDF files
"RTN","PSONDCUT",75,0)
 S NDC=$$GETNDC^PSSNDCUT(DRG,SITE)
"RTN","PSONDCUT",76,0)
 I NDC'="",'$D(^TMP($J,"PSONDCDP",NDC)) D
"RTN","PSONDCUT",77,0)
 . S IDX=IDX+1,^TMP($J,"PSONDCFM",IDX)=NDC,^TMP($J,"PSONDCDP",NDC)=IDX
"RTN","PSONDCUT",78,0)
 ;
"RTN","PSONDCUT",79,0)
 ; - Retrieving NDCs and price per dispense unit from SYNONYMS
"RTN","PSONDCUT",80,0)
 S SYN=0
"RTN","PSONDCUT",81,0)
 F  S SYN=$O(^PSDRUG(DRG,1,SYN)) Q:SYN=""  D
"RTN","PSONDCUT",82,0)
 . S Z=$G(^PSDRUG(DRG,1,SYN,0)),SNDC=$$NDCFMT^PSSNDCUT($P(Z,"^",2)) I SNDC="" Q
"RTN","PSONDCUT",83,0)
 . I $D(^TMP($J,"PSONDCDP",SNDC)) Q
"RTN","PSONDCUT",84,0)
 . S IDX=IDX+1,^TMP($J,"PSONDCFM",IDX)=SNDC
"RTN","PSONDCUT",85,0)
 . S ^TMP($J,"PSONDCDP",SNDC)=IDX
"RTN","PSONDCUT",86,0)
 ;
"RTN","PSONDCUT",87,0)
 I '$D(^TMP($J,"PSONDCFM")) D  S NDC="^" G END
"RTN","PSONDCUT",88,0)
 . W !!,"No valid NDC codes found for "_$$GET1^DIQ(50,DRG,.01),$C(7)
"RTN","PSONDCUT",89,0)
 ;
"RTN","PSONDCUT",90,0)
ASK ; Ask for NDC
"RTN","PSONDCUT",91,0)
 S PRPT="",DRGNAM=$E($$GET1^DIQ(50,DRG,.01),1,25)
"RTN","PSONDCUT",92,0)
 I $G(BCODE) D
"RTN","PSONDCUT",93,0)
 . S DFN=$$GET1^DIQ(52,RX,2,"I") D DEM^VADPT S PID=$P(VADM(2),"^",2) K VADM
"RTN","PSONDCUT",94,0)
 . S PRPT="PID: "_PID_"/MED: "_DRGNAM_"/"
"RTN","PSONDCUT",95,0)
 K DIR S DIR(0)="FOA^1:15",DIR("A")=$S($G(STOCK):"PRODUCT NDC: ",1:PRPT_"NDC: "),DIR("B")=$G(^TMP($J,"PSONDCFM",1)) I DIR("B")="" K DIR("B")
"RTN","PSONDCUT",96,0)
 S DIR("?")="^D NDCHLP^PSONDCUT",DIR("??")="^D NDCHLP2^PSONDCUT" D ^DIR I $D(DIRUT) S NDC="^" G END
"RTN","PSONDCUT",97,0)
 I Y'?.N S NDC=Y I '$D(^TMP($J,"PSONDCDP",NDC)) W !,$C(7) D NDCHLP W !,$C(7) G ASK
"RTN","PSONDCUT",98,0)
 I Y?.N D  I NDC="" W !,$C(7) D NDCHLP2 W !,$C(7) G ASK
"RTN","PSONDCUT",99,0)
 . I $L(Y)=11 S NDC=$$NDCFMT^PSSNDCUT(Y) D  Q
"RTN","PSONDCUT",100,0)
 . . S:NDC'="" NDC=$S($D(^TMP($J,"PSONDCDP",NDC)):NDC,1:"")
"RTN","PSONDCUT",101,0)
 . S NDC=$G(^TMP($J,"PSONDCFM",+Y))
"RTN","PSONDCUT",102,0)
 W " ",NDC
"RTN","PSONDCUT",103,0)
 ;
"RTN","PSONDCUT",104,0)
END K ^TMP($J,"PSONDCDP"),^TMP($J,"PSONDCFM")
"RTN","PSONDCUT",105,0)
 Q
"RTN","PSONDCUT",106,0)
 ;
"RTN","PSONDCUT",107,0)
SAVNDC(RX,RFL,NDC,CMP,DRG,FROM) ; Saves the NDC in the PRESCRIPTION and DRUG files
"RTN","PSONDCUT",108,0)
 ; Input: (r) RX - Rx IEN (#52)
"RTN","PSONDCUT",109,0)
 ;        (o) RFL - Refill Number (#52.1)
"RTN","PSONDCUT",110,0)
 ;        (r) NDC - NDC Number
"RTN","PSONDCUT",111,0)
 ;        (o) CMP - CMOP? (1-YES/0-NO)
"RTN","PSONDCUT",112,0)
 ;        (o) DRG - Save in the DRUG file (1-YES/0-NO) ((Def: 0)
"RTN","PSONDCUT",113,0)
 ;        (o) FROM   - Calling function
"RTN","PSONDCUT",114,0)
 ;
"RTN","PSONDCUT",115,0)
 S NDC=$$NDCFMT^PSSNDCUT(NDC) I NDC="" Q
"RTN","PSONDCUT",116,0)
 ;
"RTN","PSONDCUT",117,0)
 ;- Saving the NDC in the PRESCRIPTION file (#52)
"RTN","PSONDCUT",118,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSONDCUT",119,0)
 ;
"RTN","PSONDCUT",120,0)
 I '$D(FROM) N FROM S FROM=""
"RTN","PSONDCUT",121,0)
 N PPDU S PPDU="",PPDU=$$GPPDU(RX,RFL,NDC,,1,FROM)
"RTN","PSONDCUT",122,0)
 ;
"RTN","PSONDCUT",123,0)
 N DA,DIE,DR
"RTN","PSONDCUT",124,0)
 I 'RFL S DIE="^PSRX(",DA=RX,DR="27///"_NDC D ^DIE
"RTN","PSONDCUT",125,0)
 I RFL,$D(^PSRX(RX,1,RFL,0)) D
"RTN","PSONDCUT",126,0)
 . S DIE="^PSRX("_RX_",1,",DA(1)=RX,DA=RFL,DR="11///"_NDC D ^DIE
"RTN","PSONDCUT",127,0)
 ;
"RTN","PSONDCUT",128,0)
 ;- Saving the NDC in the DRUG file (#50)
"RTN","PSONDCUT",129,0)
 I $G(DRG) D SAVNDC^PSSNDCUT($$GET1^DIQ(52,RX,6,"I"),$$RXSITE^PSOBPSUT(RX,RFL),NDC,$G(CMP))
"RTN","PSONDCUT",130,0)
 Q
"RTN","PSONDCUT",131,0)
 ;
"RTN","PSONDCUT",132,0)
GETNDC(RX,RFL) ; Returns the Rx NDC #
"RTN","PSONDCUT",133,0)
 ; Input:  (r) RX - Rx IEN (#52)
"RTN","PSONDCUT",134,0)
 ;         (o) RFL - Refill #
"RTN","PSONDCUT",135,0)
 ; Output:     NDC - Rx NDC #
"RTN","PSONDCUT",136,0)
 N NDC,I S NDC=""
"RTN","PSONDCUT",137,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSONDCUT",138,0)
 I RFL S NDC=$$GET1^DIQ(52.1,RFL_","_RX,11)
"RTN","PSONDCUT",139,0)
 I 'RFL!(NDC="") S NDC=$$GET1^DIQ(52,RX,27)
"RTN","PSONDCUT",140,0)
 Q $$NDCFMT^PSSNDCUT(NDC)
"RTN","PSONDCUT",141,0)
 ;
"RTN","PSONDCUT",142,0)
GPPDU(RX,RFL,NDC,DRUG,SAVE,FROM) ;-get Price per dispense unit for the NDC
"RTN","PSONDCUT",143,0)
 ;Input:  (r) RX     - Rx IEN (#52)
"RTN","PSONDCUT",144,0)
 ;        (o) RFL    - Refill Number (#52.1)
"RTN","PSONDCUT",145,0)
 ;        (r) NDC    - National Drug Code
"RTN","PSONDCUT",146,0)
 ;        (o) DRUG   - Drug IEN from (#50)
"RTN","PSONDCUT",147,0)
 ;        (o) SAVE   - 1 (one) means save the PPDU and 0 (zero) means don't save it
"RTN","PSONDCUT",148,0)
 ;        (o) FROM   - Calling function
"RTN","PSONDCUT",149,0)
 ;        
"RTN","PSONDCUT",150,0)
 ;Output: (r) PPDU   - Price Per Dispense Unit for the NDC on the drug in file (#50)  
"RTN","PSONDCUT",151,0)
 ;                     OR "^" if no valid NDC or "^" entered
"RTN","PSONDCUT",152,0)
 ;
"RTN","PSONDCUT",153,0)
 N SYN,Z,SNDC,DEFNDC,PPDUARR,DEFPPDU,CMOP
"RTN","PSONDCUT",154,0)
 I '$G(DRUG) N DRUG S DRUG="",DRUG=$$GET1^DIQ(52,RX,6,"I")
"RTN","PSONDCUT",155,0)
 I '$D(RFL) S RFL="",RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSONDCUT",156,0)
 I '$G(SAVE) S SAVE=0
"RTN","PSONDCUT",157,0)
 S DEFNDC=$$NDCFMT^PSSNDCUT($$GET1^DIQ(50,DRUG,31))
"RTN","PSONDCUT",158,0)
 S (DEFPPDU,PPDU)=$$GET1^DIQ(50,DRUG,16)
"RTN","PSONDCUT",159,0)
 S:DEFNDC'="" PPDUARR(DEFNDC)=PPDU
"RTN","PSONDCUT",160,0)
 S SYN=0
"RTN","PSONDCUT",161,0)
 ;
"RTN","PSONDCUT",162,0)
 F  S SYN=$O(^PSDRUG(DRUG,1,SYN)) Q:SYN=""  D
"RTN","PSONDCUT",163,0)
 . S Z=$G(^PSDRUG(DRUG,1,SYN,0)),SNDC=$$NDCFMT^PSSNDCUT($P(Z,"^",2)) I SNDC="" Q
"RTN","PSONDCUT",164,0)
 . S:$P(Z,"^",8)'="" PPDUARR(SNDC)=$P(Z,"^",8)
"RTN","PSONDCUT",165,0)
 I $G(NDC),$D(PPDUARR(NDC)) S PPDU=$G(PPDUARR(NDC))
"RTN","PSONDCUT",166,0)
 I $$MWC^PSOBPSU2(RX,RFL)="C" D
"RTN","PSONDCUT",167,0)
 . I $D(FROM) Q:FROM="PE"!(FROM="PP")  ;if FROM passed, pull early from suspense gets price by NDC
"RTN","PSONDCUT",168,0)
 . S PPDU=DEFPPDU ;use default NDC for CMOP fills
"RTN","PSONDCUT",169,0)
 I SAVE&(PPDU'="") D SPPDU(RX,RFL,PPDU)
"RTN","PSONDCUT",170,0)
 Q PPDU
"RTN","PSONDCUT",171,0)
 ;
"RTN","PSONDCUT",172,0)
SPPDU(RX,RFL,PPDU) ;save price per dispense unit
"RTN","PSONDCUT",173,0)
 N DIE,DA,DR
"RTN","PSONDCUT",174,0)
 I 'RFL S DIE="^PSRX(",DA=RX,DR="17///"_PPDU D ^DIE
"RTN","PSONDCUT",175,0)
 I RFL,$D(^PSRX(RX,1,RFL,0)) D
"RTN","PSONDCUT",176,0)
 . S DIE="^PSRX("_RX_",1,",DA(1)=RX,DA=RFL,DR="1.2///"_PPDU D ^DIE
"RTN","PSONDCUT",177,0)
 Q
"RTN","PSONDCUT",178,0)
 ;
"RTN","PSONDCUT",179,0)
NDCHLP2 ;Help Text for ?? for the NDC Code Selection
"RTN","PSONDCUT",180,0)
 I X["?" D
"RTN","PSONDCUT",181,0)
 .W !!,"Enter a valid "_$S($G(STOCK):"Product ",1:"")_"NDC.  Valid NDC's are those defined for the drug in"
"RTN","PSONDCUT",182,0)
 .W !,"Drug file (#50) as an NDC of a synonym or the default NDC."
"RTN","PSONDCUT",183,0)
 I $G(STOCK)&(X["?") D
"RTN","PSONDCUT",184,0)
 . W !!,"If the Product is not listed below, the NDC must be entered as a synonym for"
"RTN","PSONDCUT",185,0)
 . W !,"the drug before NDC validation of the prescription may be completed.",!
"RTN","PSONDCUT",186,0)
 ;
"RTN","PSONDCUT",187,0)
NDCHLP ; Help Text for the NDC Code Selection
"RTN","PSONDCUT",188,0)
 N I
"RTN","PSONDCUT",189,0)
 I $G(STOCK)&(X'["?") D  ;help text for NDC Validation option
"RTN","PSONDCUT",190,0)
 . W !,"The NDC # entered is either invalid or there is not a matching synonym"
"RTN","PSONDCUT",191,0)
 . W !,"for NDC "_$S($G(Y):Y,1:DIR("B"))_" defined for "_DRGNAM_" in the"
"RTN","PSONDCUT",192,0)
 . W !,"drug file. Please verify that you have selected the correct product.",!
"RTN","PSONDCUT",193,0)
 . W !,"If the product is correct, the NDC must be entered as a synonym for"
"RTN","PSONDCUT",194,0)
 . W !,"the drug before NDC validation of the prescription may be completed.",!
"RTN","PSONDCUT",195,0)
 W !,"Select one of the following valid NDC code(s) below "_$S($G(STOCK):"or enter ^ to exit",1:"")_": ",!
"RTN","PSONDCUT",196,0)
 S I=0 F  S I=$O(^TMP($J,"PSONDCFM",I)) Q:'I  D
"RTN","PSONDCUT",197,0)
 . W !?10,$J(I,2)," - ",^TMP($J,"PSONDCFM",I)
"RTN","PSONDCUT",198,0)
 Q
"RTN","PSONDCV")
0^29^B50952716
"RTN","PSONDCV",1,0)
PSONDCV ;BP/CMF - Pharmacy NDC Validation ;04/08/08
"RTN","PSONDCV",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**289**;DEC 1997;Build 107
"RTN","PSONDCV",3,0)
 ;Reference to $$ECMEON^BPSUTIL supported by DBIA 4410
"RTN","PSONDCV",4,0)
 ;Reference to $$STATUS^BPSOSRX suppored by DBIA 4300
"RTN","PSONDCV",5,0)
 ;
"RTN","PSONDCV",6,0)
 Q
"RTN","PSONDCV",7,0)
 ;
"RTN","PSONDCV",8,0)
EN ; entry point for [PSO NDC VALIDATION] option
"RTN","PSONDCV",9,0)
 N FLAG,PSOINST
"RTN","PSONDCV",10,0)
 S FLAG=0
"RTN","PSONDCV",11,0)
 D BEGIN(.FLAG)
"RTN","PSONDCV",12,0)
 D:FLAG PROMPTS
"RTN","PSONDCV",13,0)
 D END
"RTN","PSONDCV",14,0)
 Q
"RTN","PSONDCV",15,0)
 ;;
"RTN","PSONDCV",16,0)
BEGIN(RESULT) ;;
"RTN","PSONDCV",17,0)
 I '$D(PSOSITE) D ^PSOLSET I '$D(PSOPAR) W $C(7),!!,"A Pharmacy Division Must Be Selected!",! G END
"RTN","PSONDCV",18,0)
 S RESULT=$$ECMEON^BPSUTIL(PSOSITE)
"RTN","PSONDCV",19,0)
 S PSOINST=$$GET1^DIQ(59,PSOSITE,".06")
"RTN","PSONDCV",20,0)
 D:RESULT=0
"RTN","PSONDCV",21,0)
 .W !!,"ePharmacy has not been activated for "_$$GET1^DIQ(59,PSOSITE,".01")_"("_PSOSITE_")."
"RTN","PSONDCV",22,0)
 .W !,"NDC validation not allowed."
"RTN","PSONDCV",23,0)
 Q
"RTN","PSONDCV",24,0)
 ;;
"RTN","PSONDCV",25,0)
END ;;
"RTN","PSONDCV",26,0)
 ;;D KILL^XUSCLEAN
"RTN","PSONDCV",27,0)
 Q
"RTN","PSONDCV",28,0)
 ;;
"RTN","PSONDCV",29,0)
PROMPTS ;;
"RTN","PSONDCV",30,0)
 N X,Y,DIC,RXIEN,RX,PSORESP,QFLG,RXNUM,PSOMSG,PSONDCV,CMOP,PID
"RTN","PSONDCV",31,0)
 S (PSONDCV("QFLG"),PSORESP)=0
"RTN","PSONDCV",32,0)
 F  Q:PSORESP=-1!(PSONDCV("QFLG"))  D 
"RTN","PSONDCV",33,0)
 .W !
"RTN","PSONDCV",34,0)
 .K DIR,RX,RXIEN
"RTN","PSONDCV",35,0)
 .S DIR(0)="FO^1:245^"
"RTN","PSONDCV",36,0)
 .S DIR("A")="WAND BARCODE or enter Rx#"
"RTN","PSONDCV",37,0)
 .S DIR("?",1)="Wand barcodes should be of the form NNN-NNNNNN"
"RTN","PSONDCV",38,0)
 .S DIR("?",2)="where the number before the dash is your station number."
"RTN","PSONDCV",39,0)
 .S DIR("?",3)="The fill number used for NDC Validation is defaulted to"
"RTN","PSONDCV",40,0)
 .S DIR("?",4)="the last fill for the prescription number entered."
"RTN","PSONDCV",41,0)
 .S DIR("?")="Enter ""^"", or a RETURN to quit."
"RTN","PSONDCV",42,0)
 .D ^DIR Q:PSONDCV("QFLG")
"RTN","PSONDCV",43,0)
 .I $D(DIRUT) S PSONDCV("QFLG")=1 K DIRUT,DUOUT,DTOUT,DIROUT Q
"RTN","PSONDCV",44,0)
 .;
"RTN","PSONDCV",45,0)
 . I X["-" S QFLG=0 D  Q:QFLG
"RTN","PSONDCV",46,0)
 .. I $P(X,"-")'=PSOINST W !?7,$C(7),$C(7),$C(7),"Not From this Institution" S QFLG=1 Q
"RTN","PSONDCV",47,0)
 .. S RXIEN=$P(X,"-",2)
"RTN","PSONDCV",48,0)
 .. I $G(^PSRX(RXIEN,0))']"" W !,$C(7),"Rx data is not on file !",! S QFLG=1 Q
"RTN","PSONDCV",49,0)
 .. S RX=$P(^PSRX(RXIEN,0),"^",1)
"RTN","PSONDCV",50,0)
 . I X'["-" S RX=X K DIC S DIC=52,DIC(0)="BXQ",X=RX D ^DIC D  Q:Y=-1 
"RTN","PSONDCV",51,0)
 .. I Y=-1 W !!,"Invalid prescription number.",! Q 
"RTN","PSONDCV",52,0)
 .. S RXIEN=$P(Y,"^"),RX=$P(Y,"^",2)
"RTN","PSONDCV",53,0)
 . D PSOL^PSSLOCK(RXIEN) I '$G(PSOMSG) D  K PSOMSG S QFLG=1 Q
"RTN","PSONDCV",54,0)
 .. W $C(7),!!?5,"Another person is editing Rx "_$P($G(^PSRX(+$G(RXIEN),0)),"^"),!
"RTN","PSONDCV",55,0)
 .;
"RTN","PSONDCV",56,0)
 .D VALIDATE(RX,RXIEN)
"RTN","PSONDCV",57,0)
 .D PSOUL^PSSLOCK(RXIEN)
"RTN","PSONDCV",58,0)
 Q
"RTN","PSONDCV",59,0)
 ;;
"RTN","PSONDCV",60,0)
VALIDATE(RX,RXIEN) ;;
"RTN","PSONDCV",61,0)
 N DIR,X,Y,ISVALID,FLAG,RFL,RXDIV,LBL,LPRT,ESTAT,LABELNDC,STOCKNDC,RXNDC,STOCK
"RTN","PSONDCV",62,0)
 S FLAG=0,LPRT=0
"RTN","PSONDCV",63,0)
 S RFL=$$LSTRFL^PSOBPSU1(RXIEN)
"RTN","PSONDCV",64,0)
 ;
"RTN","PSONDCV",65,0)
 S RXDIV=$$RXSITE^PSOBPSUT(RXIEN,RFL) I RXDIV'=PSOSITE D  Q
"RTN","PSONDCV",66,0)
 . W !,"Prescription #"_RX_" is from a different division: "_$$GET1^DIQ(59,RXDIV,".01")_"."
"RTN","PSONDCV",67,0)
 . W !,"Log into that division for NDC validation.",!!
"RTN","PSONDCV",68,0)
 ;
"RTN","PSONDCV",69,0)
 S ISVALID=$$ISVALID(RXIEN,RFL,0)
"RTN","PSONDCV",70,0)
 I ISVALID D  Q:FLAG
"RTN","PSONDCV",71,0)
 .W !!,"Prescription "_RX_" has already been validated."
"RTN","PSONDCV",72,0)
 .S DIR("A")="Are you sure you want to revalidate"
"RTN","PSONDCV",73,0)
 .S DIR(0)="Y"
"RTN","PSONDCV",74,0)
 .S DIR("B")="YES"
"RTN","PSONDCV",75,0)
 .D ^DIR
"RTN","PSONDCV",76,0)
 .S:Y'=1 FLAG=1
"RTN","PSONDCV",77,0)
 I $$ISOPAI(RX,RFL) D  Q  ;can't validate RXs sent to external interface
"RTN","PSONDCV",78,0)
 .W !!,"Prescription "_RX_" has been sent to the external interface."
"RTN","PSONDCV",79,0)
 .W !,"It cannot be validated at this time."
"RTN","PSONDCV",80,0)
 I $$ISRELEAS(RXIEN,RFL) D  Q  ;can't validate released RXs
"RTN","PSONDCV",81,0)
 .W !!,"Prescription "_RX_" has been released."
"RTN","PSONDCV",82,0)
 .W !,"It cannot be validated at this time."
"RTN","PSONDCV",83,0)
 I $$ISCMOP(RXIEN,RFL) D  Q  ;can't validate RXs sent to CMOP
"RTN","PSONDCV",84,0)
 .W !!,"Prescription "_RX_" is a CMOP Rx."
"RTN","PSONDCV",85,0)
 .W !,"CMOP RXs may not be validated."
"RTN","PSONDCV",86,0)
 S FLAG=0 D TRICARE1(.FLAG,RXIEN,RFL)
"RTN","PSONDCV",87,0)
 I FLAG=1 Q
"RTN","PSONDCV",88,0)
  F LBL=0:0 S LBL=$O(^PSRX(RXIEN,"L",LBL)) Q:'LBL  I +$P(^PSRX(RXIEN,"L",LBL,0),"^",2)=RFL S LPRT=1
"RTN","PSONDCV",89,0)
 I 'LPRT W !!,"The prescription label must be printed prior to the NDC being validated.",!!  Q
"RTN","PSONDCV",90,0)
 D DISPLAY(RX,RXIEN,RFL,.RXNDC)
"RTN","PSONDCV",91,0)
 S LABELNDC=RXNDC
"RTN","PSONDCV",92,0)
 S STOCK=1
"RTN","PSONDCV",93,0)
 S FLAG=$$CHGNDC^PSONDCUT(RXIEN,RFL,$G(PID),STOCK) I FLAG="^" S FLAG=1 W !!,"** Validation not completed.",!! Q
"RTN","PSONDCV",94,0)
 S STOCKNDC=$P(FLAG,"^",2),FLAG=+FLAG
"RTN","PSONDCV",95,0)
 I FLAG S LABELNDC=$$GETNDC^PSONDCUT(RXIEN,RFL) ;ndc changed
"RTN","PSONDCV",96,0)
 S ESTAT=$$STATUS^BPSOSRX(RXIEN,RFL)
"RTN","PSONDCV",97,0)
 I $P(ESTAT,"^")["PAYABLE",(LABELNDC=STOCKNDC!(STOCKNDC=""&('FLAG))) D  ;FLAG=0 NDC not changed; flag=1 ndc changed.
"RTN","PSONDCV",98,0)
 .W !!,"NDC match confirmed.",!
"RTN","PSONDCV",99,0)
 .S FLAG=1 D UPDATE(RXIEN,RFL)
"RTN","PSONDCV",100,0)
 E  D
"RTN","PSONDCV",101,0)
 . D DEL(RXIEN,RFL)
"RTN","PSONDCV",102,0)
 . W !!,"NDC validation has not been completed.  " W:$P(ESTAT,"^")'="" "Rx claim was "_$P(ESTAT,"^"),! Q
"RTN","PSONDCV",103,0)
 Q
"RTN","PSONDCV",104,0)
 ;;
"RTN","PSONDCV",105,0)
ISVALID(RXIEN,RFL,VERBOSE) ;;
"RTN","PSONDCV",106,0)
 Q:RFL=0 $$ISRXVAL(RXIEN,VERBOSE)
"RTN","PSONDCV",107,0)
 Q $$ISRFLVAL(RXIEN,RFL,VERBOSE)
"RTN","PSONDCV",108,0)
 ;
"RTN","PSONDCV",109,0)
ISRXVAL(RXIEN,VERBOSE) ;are NDCs already validated for Rx?
"RTN","PSONDCV",110,0)
 N IENS,VALIDATE,VALIDUZ,RESULT
"RTN","PSONDCV",111,0)
 S RESULT=0
"RTN","PSONDCV",112,0)
 S IENS=RXIEN_","
"RTN","PSONDCV",113,0)
 S VALIDATE=$$GET1^DIQ(52,IENS,83)
"RTN","PSONDCV",114,0)
 S VALIDUZ=$$GET1^DIQ(52,IENS,84)
"RTN","PSONDCV",115,0)
 I VALIDATE'="",VALIDUZ'="" S RESULT=1
"RTN","PSONDCV",116,0)
 D DISPLAY1(VERBOSE,RESULT,VALIDATE,VALIDUZ)
"RTN","PSONDCV",117,0)
 Q RESULT
"RTN","PSONDCV",118,0)
 ;;
"RTN","PSONDCV",119,0)
ISRFLVAL(RXIEN,RFL,VERBOSE) ;are NDCs already validated for refill?
"RTN","PSONDCV",120,0)
 N IENS,VALIDATE,VALIDUZ,RESULT
"RTN","PSONDCV",121,0)
 S RESULT=0
"RTN","PSONDCV",122,0)
 S IENS=RFL_","_RXIEN_","
"RTN","PSONDCV",123,0)
 S VALIDATE=$$GET1^DIQ(52.1,IENS,83)
"RTN","PSONDCV",124,0)
 S VALIDUZ=$$GET1^DIQ(52.1,IENS,84)
"RTN","PSONDCV",125,0)
 I VALIDATE'="",VALIDUZ'="" S RESULT=1
"RTN","PSONDCV",126,0)
 D DISPLAY1(VERBOSE,RESULT,VALIDATE,VALIDUZ)
"RTN","PSONDCV",127,0)
 Q RESULT
"RTN","PSONDCV",128,0)
 ;;
"RTN","PSONDCV",129,0)
ISOPAI(RX,RFL) ;;
"RTN","PSONDCV",130,0)
 N RESULT,II,OPIAIEN,OPIAIEN,OPIARX
"RTN","PSONDCV",131,0)
 D FIND^DIC(52.51,"",".01;9","",RX,"","","","","RESULT")
"RTN","PSONDCV",132,0)
 S OPIARX=0
"RTN","PSONDCV",133,0)
 I $D(RESULT("DILIST","ID")) S II=0 F  S II=$O(RESULT("DILIST","ID",II)) Q:II=""  D
"RTN","PSONDCV",134,0)
 . I $D(RESULT("DILIST","ID",II,9)) S:RESULT("DILIST","ID",II,9)=RFL OPIARX=1
"RTN","PSONDCV",135,0)
  Q OPIARX
"RTN","PSONDCV",136,0)
 ;;
"RTN","PSONDCV",137,0)
ISRELEAS(RXIEN,RFL) ;; has it been released?
"RTN","PSONDCV",138,0)
 N RESULT
"RTN","PSONDCV",139,0)
 S RESULT=0
"RTN","PSONDCV",140,0)
 I $$RXRLDT^PSOBPSUT(RXIEN,RFL)'="" S RESULT=1
"RTN","PSONDCV",141,0)
 Q RESULT
"RTN","PSONDCV",142,0)
 ;;
"RTN","PSONDCV",143,0)
ISCMOP(RXIEN,RFL) ;; has it been sent to CMOP?
"RTN","PSONDCV",144,0)
 Q $$CMOP^PSOBPSUT(RXIEN,RFL)
"RTN","PSONDCV",145,0)
 ;;
"RTN","PSONDCV",146,0)
DISPLAY(RX,RXIEN,RFL,RXNDC) ;;
"RTN","PSONDCV",147,0)
 N OUT
"RTN","PSONDCV",148,0)
 W !
"RTN","PSONDCV",149,0)
 S OUT=$$LJ^XLFSTR("Rx: "_RX,20)
"RTN","PSONDCV",150,0)
 S OUT=OUT_$$LJ^XLFSTR("Fill: "_RFL,20)
"RTN","PSONDCV",151,0)
 S OUT=OUT_$$LJ^XLFSTR("Patient: "_$$GET1^DIQ(52,RXIEN,2),38)
"RTN","PSONDCV",152,0)
 W !,OUT
"RTN","PSONDCV",153,0)
 S OUT=$$LJ^XLFSTR("Drug: "_$$GET1^DIQ(52,RXIEN,6),40)
"RTN","PSONDCV",154,0)
 S RXNDC=$S(+RFL:$$GET1^DIQ(52.1,RFL_","_RXIEN,11),1:$$GET1^DIQ(52,RXIEN,27))
"RTN","PSONDCV",155,0)
 S OUT=OUT_$$LJ^XLFSTR("NDC: "_RXNDC,38)
"RTN","PSONDCV",156,0)
 W !,OUT,!
"RTN","PSONDCV",157,0)
 Q
"RTN","PSONDCV",158,0)
 ;;
"RTN","PSONDCV",159,0)
DISPLAY1(VERBOSE,RESULT,VALIDATE,VALIDUZ) ;;
"RTN","PSONDCV",160,0)
 Q:VERBOSE=0
"RTN","PSONDCV",161,0)
 I RESULT=1 D  Q
"RTN","PSONDCV",162,0)
 . W !,"** The following NDC was validated on "_VALIDATE_" by "_VALIDUZ_".",!
"RTN","PSONDCV",163,0)
 W !,"** This NDC has not been validated.",!!
"RTN","PSONDCV",164,0)
 Q
"RTN","PSONDCV",165,0)
 ;;
"RTN","PSONDCV",166,0)
UPDATE(RXIEN,RFL) ; update validation fields
"RTN","PSONDCV",167,0)
 N IENS,FILE,FDA,ERROR
"RTN","PSONDCV",168,0)
 I $G(RFL)>0 D
"RTN","PSONDCV",169,0)
 .S IENS=RFL_","_RXIEN_","
"RTN","PSONDCV",170,0)
 .S FILE=52.1
"RTN","PSONDCV",171,0)
 E  D
"RTN","PSONDCV",172,0)
 .S IENS=RXIEN_","
"RTN","PSONDCV",173,0)
 .S FILE=52
"RTN","PSONDCV",174,0)
 S FDA(FILE,IENS,83)=$$NOW^XLFDT()
"RTN","PSONDCV",175,0)
 S FDA(FILE,IENS,84)=DUZ
"RTN","PSONDCV",176,0)
 D FILE^DIE("","FDA","ERROR")
"RTN","PSONDCV",177,0)
 Q
"RTN","PSONDCV",178,0)
 ;;
"RTN","PSONDCV",179,0)
DEL(RXIEN,RFL) ; update validation fields
"RTN","PSONDCV",180,0)
 N IENS,FILE,FDA,ERROR
"RTN","PSONDCV",181,0)
 I $G(RFL)>0 D
"RTN","PSONDCV",182,0)
 .S IENS=RFL_","_RXIEN_","
"RTN","PSONDCV",183,0)
 .S FILE=52.1
"RTN","PSONDCV",184,0)
 E  D
"RTN","PSONDCV",185,0)
 .S IENS=RXIEN_","
"RTN","PSONDCV",186,0)
 .S FILE=52
"RTN","PSONDCV",187,0)
 S FDA(FILE,IENS,83)="@"
"RTN","PSONDCV",188,0)
 S FDA(FILE,IENS,84)="@"
"RTN","PSONDCV",189,0)
 D FILE^DIE("","FDA","ERROR")
"RTN","PSONDCV",190,0)
 Q
"RTN","PSONDCV",191,0)
 ;;
"RTN","PSONDCV",192,0)
TRICARE1(FLAG,RXIEN,RFL) ; tricare test #1
"RTN","PSONDCV",193,0)
 N PSOTRIC
"RTN","PSONDCV",194,0)
 D:$$TRIC^PSOREJP1(RXIEN,RFL,.PSOTRIC)
"RTN","PSONDCV",195,0)
 .D:$$STATUS^PSOBPSUT(RXIEN,RFL)'="E PAYABLE"
"RTN","PSONDCV",196,0)
 ..S FLAG=1
"RTN","PSONDCV",197,0)
 ..W !,"This prescription fill has open Tricare third party insurance"
"RTN","PSONDCV",198,0)
 ..W !,"rejections that must be resolved prior to completion of NDC validation."
"RTN","PSONDCV",199,0)
 Q
"RTN","PSONDCV",200,0)
 ;;
"RTN","PSOORED2")
0^30^B66199393
"RTN","PSOORED2",1,0)
PSOORED2 ;ISC-BHAM/SAB-edit orders from backdoor con't ;03/06/95 10:24
"RTN","PSOORED2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**2,51,46,78,102,114,117,133,159,148,247,260,281,289**;DEC 1997;Build 107
"RTN","PSOORED2",3,0)
 ;Reference to $$DIVNCPDP^BPSBUTL supported by IA 4719
"RTN","PSOORED2",4,0)
 ;Reference to $$ECMEON^BPSUTIL supported by IA 4410
"RTN","PSOORED2",5,0)
 ;called from psooredt. cmop edit checks.
"RTN","PSOORED2",6,0)
 Q
"RTN","PSOORED2",7,0)
ISDT D CHK K RF I $G(CMRL) W !,"Released by CMOP.  No editing allowed on Issue Date." D PAUSE^VALM1 K CMRL Q
"RTN","PSOORED2",8,0)
 S %DT="AEX",%DT(0)=-$P(^PSRX(DA,2),"^",2),Y=$P(RX0,"^",13) X ^DD("DD") S %DT("A")="ISSUE DATE: ",%DT("B")=Y D ^%DT I "^"[$E(X) K X,Y,%DT,DTOUT,DUOUT Q
"RTN","PSOORED2",9,0)
 G:Y=-1 ISDT S PSORXED("FLD",1)=Y
"RTN","PSOORED2",10,0)
 ;S DR="1///"_Y,DIE=52 D ^DIE
"RTN","PSOORED2",11,0)
 D KV K X,Y,%DT
"RTN","PSOORED2",12,0)
 Q
"RTN","PSOORED2",13,0)
FLDT D CHK K RF I $G(CMRL) W !,"Released by CMOP.  No editing allowed on Fill Date." D PAUSE^VALM1 K CMRL Q
"RTN","PSOORED2",14,0)
 D KV S Y=$P(^PSRX(DA,2),"^",2) X ^DD("DD") S DIR("A")="FILL DATE",DIR("B")=Y
"RTN","PSOORED2",15,0)
 S DIR(0)="D^"_$P(RX0,"^",13)_":"_$P(PSORXED("RX2"),"^",6)_":EX"
"RTN","PSOORED2",16,0)
 S DIR("?",1)="The earliest fill date allowed is determined by the Issue Date,",DIR("?",2)="the Fill Date cannot be before the Issue Date or past the Expiration Date."
"RTN","PSOORED2",17,0)
 S DIR("?")="Both the month and day are required." D ^DIR
"RTN","PSOORED2",18,0)
 I $D(DIRUT) D KV K PSORXED("FLD",22),X,Y Q
"RTN","PSOORED2",19,0)
 S PSORXED("FLD",22)=Y ;S DR="22R///"_Y,DIE=52 D ^DIE
"RTN","PSOORED2",20,0)
 K X,Y
"RTN","PSOORED2",21,0)
KV K DIR,DUOUT,DTOUT,DIRUT
"RTN","PSOORED2",22,0)
 Q
"RTN","PSOORED2",23,0)
CHK I $D(^PSRX("AR",+$P(PSORXED("RX2"),"^",13),PSORXED("IRXN"))) S CMRL=1 Q
"RTN","PSOORED2",24,0)
 F RF=0:0 S RF=$O(^PSRX(PSORXED("IRXN"),1,RF)) Q:'RF  I $D(^PSRX("AR",+$P(^PSRX(PSORXED("IRXN"),1,RF,0),"^",18),PSORXED("IRXN"))) S CMRL=1
"RTN","PSOORED2",25,0)
 Q
"RTN","PSOORED2",26,0)
CHK1 I +^PSRX(PSORXED("IRXN"),"STA")=5 D  Q:'$G(CMRL)
"RTN","PSOORED2",27,0)
 .S SURX=$O(^PS(52.5,PSORXED("IRXN"),0)) Q:'SURX  I $P(^PS(52.5,SURX,0),"^",7)']""!($P(^(0),"^",7)="Q") S CMRL=1
"RTN","PSOORED2",28,0)
 .E  S CMRL=0
"RTN","PSOORED2",29,0)
 F FEV=0:0 S FEV=$O(^PSRX(PSORXED("IRXN"),4,FEV)) Q:'FEV  I '$P(^PSRX(PSORXED("IRXN"),4,FEV,0),"^",3),$P(^(0),"^",4)<3 S CMRL=0
"RTN","PSOORED2",30,0)
 Q
"RTN","PSOORED2",31,0)
REF ;shows refill info
"RTN","PSOORED2",32,0)
 S RFN=0 F N=0:0 S N=$O(^PSRX(PSORXED("IRXN"),1,N)) Q:'N  S RFM=N,RFN=RFN+1
"RTN","PSOORED2",33,0)
 ;G:RFM=1 SRF 
"RTN","PSOORED2",34,0)
 W ! K DA,DR D KV S DIR(0)="Y",DIR("B")="No",DIR("A")="There "_$S(RFN>1:"are ",1:"is ")_RFN_" refill"_$S(RFN>1:"s.",1:".")_"  Do you want to edit"
"RTN","PSOORED2",35,0)
 D ^DIR D KV Q:'Y
"RTN","PSOORED2",36,0)
SRF W !!,"#  Log Date   Refill Date  Qty               Routing  Lot #       Pharmacist",! F I=1:1:80 W "="
"RTN","PSOORED2",37,0)
 F N=0:0 S N=$O(^PSRX(PSORXED("IRXN"),1,N)) Q:'N  S P1=^(N,0) D
"RTN","PSOORED2",38,0)
 .S DTT=$P(P1,"^",8)\1 D DAT S LOG=DAT,DTT=$P(P1,"^"),$P(RN," ",10)=" " D DAT
"RTN","PSOORED2",39,0)
 .W !,N_"  "_LOG_"   "_DAT_"      "_$P(P1,"^",4)_$E("               ",$L($P(P1,"^",4))+1,15)_"  "_$S($P(P1,"^",2)="M":"MAIL  ",1:"WINDOW")_"   "_$P(P1,"^",6)_$E(RN,$L($P(P1,"^",6))+1,12)
"RTN","PSOORED2",40,0)
 .W $E($S($D(^VA(200,+$P(P1,"^",5),0)):$P(^(0),"^"),1:""),1,16)
"RTN","PSOORED2",41,0)
 .S PSDIV=$S($D(^PS(59,+$P(P1,"^",9),0)):$P(^(0),"^",6),1:"Unknown") W !,"Division: "_PSDIV_$E("        ",$L(PSDIV)+1,8)_"  "
"RTN","PSOORED2",42,0)
 .W "Dispensed: "_$S($P(P1,"^",19):$E($P(P1,"^",19),4,5)_"/"_$E($P(P1,"^",19),6,7)_"/"_$E($P(P1,"^",19),2,3),1:"")_"  "
"RTN","PSOORED2",43,0)
 .S RTS=$S($P(P1,"^",16):" Returned to Stock: "_$E($P(P1,"^",16),4,5)_"/"_$E($P(P1,"^",16),6,7)_"/"_$E($P(P1,"^",16),2,3),1:" Released: "_$S($P(P1,"^",18):$E($P(P1,"^",18),4,5)_"/"_$E($P(P1,"^",18),6,7)_"/"_$E($P(P1,"^",18),2,3),1:""))
"RTN","PSOORED2",44,0)
 .W RTS W:$P(P1,"^",3)]"" !,"   Remarks: "_$P(P1,"^",3)
"RTN","PSOORED2",45,0)
 S DA(1)=PSORXED("IRXN") I RFN=1 S Y=RFM G RFM
"RTN","PSOORED2",46,0)
 W ! D KV S DIR("A")="Select a Refill",DIR(0)="NO^1:"_RFM_":0" D ^DIR Q:$D(DIRUT)
"RTN","PSOORED2",47,0)
RFM I '$D(^PSRX(PSORXED("IRXN"),1,Y,0)) W !,$C(7),"Invalid selection.",! G SRF
"RTN","PSOORED2",48,0)
 S CMRL=0 I $D(^PSRX("AR",+$P(^PSRX(PSORXED("IRXN"),1,Y,0),"^",18),PSORXED("IRXN"),Y)) S CMRL=1 G RFX
"RTN","PSOORED2",49,0)
 F FEV=0:0 S FEV=$O(^PSRX(PSORXED("IRXN"),4,FEV)) Q:'FEV  I $P(^PSRX(PSORXED("IRXN"),4,FEV,0),"^",3)=Y,$P(^(0),"^",4)<3 S CMRL=1
"RTN","PSOORED2",50,0)
RFX N RFL,NDC,DAW,FLDS,QUIT,CHGNDC,CHANGED
"RTN","PSOORED2",51,0)
 W ! S DA=Y,DIE="^PSRX("_DA(1)_",1,",DR=$S('CMRL:".01;1.1",1:"1.2:5;8")
"RTN","PSOORED2",52,0)
 D GETS^DIQ(52.1,DA_","_DA(1)_",",".01;1;1.1;8;11;81","I","FLDS")
"RTN","PSOORED2",53,0)
 S:$D(^PSRX(DA(1),1,DA,0)) PSORXED("RX1")=^PSRX(DA(1),1,DA,0),(RFED,RFL)=DA
"RTN","PSOORED2",54,0)
 I $G(ST)=11!($G(ST)=12)!($G(ST)=14)!($G(ST)=15),$$STATUS^PSOBPSUT(PSORXED("IRXN"),RFL)'="" S QUIT=0 D RFE Q  ;short circuit for DC'd/Expired ECME RXs
"RTN","PSOORED2",55,0)
 D ^DIE S QUIT=$D(Y) K FEV,RFN,RFM,X,Y,DR
"RTN","PSOORED2",56,0)
 I '$G(DA) D REVERSE^PSOBPSU1(PSORXED("IRXN"),RFL,"DE",5) K CMRL,RFED D:$D(PSORX("PSOL"))&($G(DI)=.01) RFD Q
"RTN","PSOORED2",57,0)
 I 'CMRL,'QUIT S DR="1;1.2:5;8" D ^DIE S QUIT=$D(Y)
"RTN","PSOORED2",58,0)
RFE I '$D(^PSRX(PSORXED("IRXN"),1,RFL)) Q
"RTN","PSOORED2",59,0)
 I 'QUIT,$$STATUS^PSOBPSUT(PSORXED("IRXN"),RFL)'="" D
"RTN","PSOORED2",60,0)
 . S NDC=$$GETNDC^PSONDCUT(PSORXED("IRXN"),RFL)
"RTN","PSOORED2",61,0)
 . D EDTDAW^PSODAWUT(PSORXED("IRXN"),RFL,.DAW) I $G(DAW)="^" Q
"RTN","PSOORED2",62,0)
 . D SAVDAW^PSODAWUT(PSORXED("IRXN"),RFL,+$G(DAW))
"RTN","PSOORED2",63,0)
 . D NDC^PSODRG(PSORXED("IRXN"),RFL,,.NDC) I $G(NDC)="^",$G(NDC)="" Q
"RTN","PSOORED2",64,0)
 . I NDC'=$$GETNDC^PSONDCUT(PSORXED("IRXN"),RFL) D
"RTN","PSOORED2",65,0)
 . . S CHGNDC=1 D RXACT^PSOBPSU2(PSORXED("IRXN"),RFL,"NDC changed from "_$$GETNDC^PSONDCUT(PSORXED("IRXN"),RFL)_" to "_NDC_".","E")
"RTN","PSOORED2",66,0)
 . D SAVNDC^PSONDCUT(PSORXED("IRXN"),RFL,NDC)
"RTN","PSOORED2",67,0)
 S CHANGED=$$CHANGED(PSORXED("IRXN"),RFL,.FLDS)
"RTN","PSOORED2",68,0)
 I CHANGED D
"RTN","PSOORED2",69,0)
 . I $P(CHANGED,"^",2),'$$ECMEON^BPSUTIL($$RXSITE^PSOBPSUT(PSORXED("IRXN"),RFL)) D  Q
"RTN","PSOORED2",70,0)
 . . D REVERSE^PSOBPSU1(PSORXED("IRXN"),RFL,"DC",99,"REFILL DIVISION CHANGED",1)
"RTN","PSOORED2",71,0)
 . I $$SUBMIT^PSOBPSUT(PSORXED("IRXN"),RFL,1,1) D
"RTN","PSOORED2",72,0)
 . . N RX S RX=PSORXED("IRXN")
"RTN","PSOORED2",73,0)
 . . I '$P(CHANGED,"^",2),$$STATUS^PSOBPSUT(RX,RFL)="" Q
"RTN","PSOORED2",74,0)
 . . D ECMESND^PSOBPSU1(RX,RFL,,"ED",$$GETNDC^PSONDCUT(RX,RFL),,$S($P(CHANGED,"^",2):"REFILL DIVISION CHANGED",1:"REFILL EDITED"),,+$G(CHGNDC))
"RTN","PSOORED2",75,0)
 . . ;- Checking/Handling DUR/79 Rejects
"RTN","PSOORED2",76,0)
 . . I $$FIND^PSOREJUT(RX,RFL) S X=$$HDLG^PSOREJU1(RX,RFL,"79,88","ED","IOQ","Q")
"RTN","PSOORED2",77,0)
 K DIE,CMRL,DA,DR
"RTN","PSOORED2",78,0)
 Q
"RTN","PSOORED2",79,0)
CHANGED(RX,RFL,PRIOR) ; - Check if fields have changed and should for 3rd Party Claim resubmission
"RTN","PSOORED2",80,0)
 ;Input:  (r) RX    - Rx IEN
"RTN","PSOORED2",81,0)
 ;        (r) RFL   - Refill #
"RTN","PSOORED2",82,0)
 ;        (r) PRIOR - Array with fields
"RTN","PSOORED2",83,0)
 ;Output:  CHANGED  - 0 - Not changed / 1 - Refill field changed ^ Rx Division changed (1 - YES)
"RTN","PSOORED2",84,0)
 N CHANGED,SAVED
"RTN","PSOORED2",85,0)
 S CHANGED=0 D GETS^DIQ(52.1,RFL_","_RX_",",".01;1;1.1;8;11;81","I","SAVED")
"RTN","PSOORED2",86,0)
 F I=.01,1,1.1,11,81 I $G(PRIOR(52.1,RFL_","_RX_",",I,"I"))'=$G(SAVED(52.1,RFL_","_RX_",",I,"I")) S CHANGED=1 Q
"RTN","PSOORED2",87,0)
 I $$DIVNCPDP^BPSBUTL(+$G(PRIOR(52.1,RFL_","_RX_",",8,"I")))'=$$DIVNCPDP^BPSBUTL(+$G(SAVED(52.1,RFL_","_RX_",",8,"I"))) S CHANGED="1^1"
"RTN","PSOORED2",88,0)
 Q CHANGED
"RTN","PSOORED2",89,0)
 ;
"RTN","PSOORED2",90,0)
DAT S DAT="",DTT=DTT\1 Q:DTT'?7N  S DAT=$E(DTT,4,5)_"/"_$E(DTT,6,7)_"/"_$E(DTT,2,3)
"RTN","PSOORED2",91,0)
 Q
"RTN","PSOORED2",92,0)
DIE S DIE=52 D ^DIE I $D(Y) S PSORXED("DFLG")=1
"RTN","PSOORED2",93,0)
 K DIE,DR,X,Y
"RTN","PSOORED2",94,0)
 Q
"RTN","PSOORED2",95,0)
RFD ;check for deleted refill
"RTN","PSOORED2",96,0)
 M PSOZ1("PSOL")=PSORX("PSOL") N I,J,K,PSOX2,PSOX3,PSOX9 S (I,K)=0 D
"RTN","PSOORED2",97,0)
 .F  S I=$O(PSOZ1("PSOL",I)) Q:'I!(K)  S PSOX2=PSOZ1("PSOL",I) I PSOX2[(PSORXED("IRXN")_",") S PSOX9="" D
"RTN","PSOORED2",98,0)
 ..F J=1:1 S PSOX3=$P(PSOX2,",",J) Q:'PSOX3  D
"RTN","PSOORED2",99,0)
 ...I 'K,PSOX3=PSORXED("IRXN") S K=1
"RTN","PSOORED2",100,0)
 ...E  S PSOX9=PSOX9_$S('PSOX9:"",1:",")_PSOX3
"RTN","PSOORED2",101,0)
 ..I K S:PSOX9]"" PSORX("PSOL",I)=PSOX9_"," K:PSOX9="" PSORX("PSOL",I)
"RTN","PSOORED2",102,0)
 K PSOZ1("PSOL")
"RTN","PSOORED2",103,0)
 Q
"RTN","PSOORED2",104,0)
EDTDOSE ;edit med instructions fields
"RTN","PSOORED2",105,0)
 I '$O(^PSRX(PSORXED("IRXN"),6,0)) D DOSE^PSOORED5 Q
"RTN","PSOORED2",106,0)
 D ^PSOORED3
"RTN","PSOORED2",107,0)
 Q
"RTN","PSOORED2",108,0)
UPD ;updates dosing array
"RTN","PSOORED2",109,0)
 S HENT=ENT
"RTN","PSOORED2",110,0)
UPD1 I $G(PSORXED("CONJUNCTION",(HENT+1)))]"",'$D(PSORXED("DOSE",(HENT+2))) K PSORXED("CONJUNCTION",(HENT+1)) Q
"RTN","PSOORED2",111,0)
 I $G(PSORXED("CONJUNCTION",(HENT+1)))]"" S PSORXED("CONJUNCTION",HENT)=PSORXED("CONJUNCTION",(HENT+1)) D  G UPD1
"RTN","PSOORED2",112,0)
 .K PSORXED("CONJUNCTION",(HENT+1))
"RTN","PSOORED2",113,0)
 .F  Q:'$D(PSORXED("DOSE",(HENT+2)))  D
"RTN","PSOORED2",114,0)
 ..S PSORXED("DOSE",(HENT+1))=PSORXED("DOSE",(HENT+2))
"RTN","PSOORED2",115,0)
 ..S PSORXED("DOSE ORDERED",(HENT+1))=$G(PSORXED("DOSE ORDERED",(HENT+2)))
"RTN","PSOORED2",116,0)
 ..S PSORXED("UNITS",(HENT+1))=$G(PSORXED("UNITS",(HENT+2)))
"RTN","PSOORED2",117,0)
 ..S PSORXED("NOUN",(HENT+1))=$G(PSORXED("NOUN",(HENT+2)))
"RTN","PSOORED2",118,0)
 ..S PSORXED("DURATION",(HENT+1))=$G(PSORXED("DURATION",(HENT+2)))
"RTN","PSOORED2",119,0)
 ..S PSORXED("CONJUNCTION",(HENT+1))=$G(PSORXED("CONJUNCTION",(HENT+2)))
"RTN","PSOORED2",120,0)
 ..S PSORXED("ROUTE",(HENT+1))=$G(PSORXED("ROUTE",(HENT+2)))
"RTN","PSOORED2",121,0)
 ..S PSORXED("SCHEDULE",(HENT+1))=$G(PSORXED("SCHEDULE",(HENT+2)))
"RTN","PSOORED2",122,0)
 ..S PSORXED("ODOSE",(HENT+1))=$G(PSORXED("ODOSE",(HENT+2)))
"RTN","PSOORED2",123,0)
 ..S HENT=HENT+1
"RTN","PSOORED2",124,0)
 ..I $G(PSORXED("CONJUNCTION",(HENT+2)))]"" Q
"RTN","PSOORED2",125,0)
 ..K PSORXED("UNITS",(HENT+1)),PSORXED("NOUN",(HENT+1)),PSORXED("DURATION",(HENT+1)),PSORXED("CONJUNCTION",(HENT+1)),PSORXED("ROUTE",(HENT+1)),PSORXED("SCHEDULE",(HENT+1)),PSORXED("DOSE",(HENT+1)),PSORXED("DOSE ORDERED",(HENT+1))
"RTN","PSOORED2",126,0)
 ..K PSORXED("VERB",(HENT+1)),PSORXED("ODOSE",(HENT+1))
"RTN","PSOORED2",127,0)
 S PSORXED("ENT")=HENT K HENT,SENT D EN^PSOFSIG(.PSORXED)
"RTN","PSOORED2",128,0)
 Q
"RTN","PSOORED2",129,0)
UPD2 I $G(PSORXED("CONJUNCTION",(HENT+1)))]"",'$D(PSORXED("DOSE",(HENT+2))) K PSORXED("CONJUNCTION",(HENT+1)) Q
"RTN","PSOORED2",130,0)
 I $G(PSORXED("CONJUNCTION",(HENT+1)))]"" S PSORXED("CONJUNCTION",HENT)=PSORXED("CONJUNCTION",(HENT+1)) D  G UPD1
"RTN","PSOORED2",131,0)
 .K PSORXED("CONJUNCTION",(HENT+1)) I $D(PSORXED("DOSE",(HENT+2))) D
"RTN","PSOORED2",132,0)
 ..S PSORXED("DOSE",(HENT+1))=PSORXED("DOSE",(HENT+2))
"RTN","PSOORED2",133,0)
 ..S PSORXED("DOSE ORDERED",(HENT+1))=$G(PSORXED("DOSE ORDERED",(HENT+2)))
"RTN","PSOORED2",134,0)
 ..S PSORXED("UNITS",(HENT+1))=$G(PSORXED("UNITS",(HENT+2)))
"RTN","PSOORED2",135,0)
 ..S PSORXED("NOUN",(HENT+1))=$G(PSORXED("NOUN",(HENT+2)))
"RTN","PSOORED2",136,0)
 ..S PSORXED("VERB",(HENT+1))=$G(PSORXED("VERB",(HENT+2)))
"RTN","PSOORED2",137,0)
 ..S PSORXED("DURATION",(HENT+1))=$G(PSORXED("DURATION",(HENT+2)))
"RTN","PSOORED2",138,0)
 ..S PSORXED("CONJUNCTION",(HENT+1))=$G(PSORXED("CONJUNCTION",(HENT+2)))
"RTN","PSOORED2",139,0)
 ..S PSORXED("ROUTE",(HENT+1))=$G(PSORXED("ROUTE",(HENT+2)))
"RTN","PSOORED2",140,0)
 ..S PSORXED("SCHEDULE",(HENT+1))=$G(PSORXED("SCHEDULE",(HENT+2)))
"RTN","PSOORED2",141,0)
 ..S PSORXED("ODOSE",(HENT+1))=$G(PSORXED("ODOSE",(HENT+2)))
"RTN","PSOORED2",142,0)
 ..S HENT=HENT+1
"RTN","PSOORED2",143,0)
 ..I $G(PSORXED("CONJUNCTION",(HENT+1)))]"" Q
"RTN","PSOORED2",144,0)
 ..K PSORXED("UNITS",(HENT+1)),PSORXED("NOUN",(HENT+1)),PSORXED("DURATION",(HENT+1)),PSORXED("ROUTE",(HENT+1)),PSORXED("SCHEDULE",(HENT+1)),PSORXED("DOSE",(HENT+1)),PSORXED("DOSE ORDERED",(HENT+1)),PSORXED("VERB",(HENT+1))
"RTN","PSOORED2",145,0)
 ..K PSORXED("ODOSE",(HENT+1))
"RTN","PSOORED2",146,0)
 F I=0:0 S I=$O(PSORXED("DOSE",I)) Q:'I  S SENT=$G(SENT)+1
"RTN","PSOORED2",147,0)
 S PSORXED("ENT")=SENT K HENT,SENT D EN^PSOFSIG(.PSORXED)
"RTN","PSOORED2",148,0)
 Q
"RTN","PSOORED7")
0^26^B22904608
"RTN","PSOORED7",1,0)
PSOORED7 ;ISC-BHAM/MFR-edit orders from backdoor con't ;03/06/95 10:24
"RTN","PSOORED7",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**148,247,281,289**;DEC 1997;Build 107
"RTN","PSOORED7",3,0)
 ;called from psooredt. cmop edit checks.
"RTN","PSOORED7",4,0)
 ;Reference to file #50 supported by IA 221
"RTN","PSOORED7",5,0)
 ;Reference to $$ECMEON^BPSUTIL supported by IA 4410
"RTN","PSOORED7",6,0)
 ;Reference to $$DIVNCPDP^BPSBUTL supported by IA 4719
"RTN","PSOORED7",7,0)
 ;
"RTN","PSOORED7",8,0)
NOCHG S CMRL=1 D CHK1^PSOORED2 I '$G(CMRL) W !,"No editing allowed of "_$S(FLN=9:"Day Supply",FLN=10:"Quantity",1:"# of Refills")_" (CMOP)." D PAUSE^VALM1 K CMRL Q
"RTN","PSOORED7",9,0)
 K CMRL,DIC,DIQ
"RTN","PSOORED7",10,0)
 S DIC=52,DA=PSORXED("IRXN"),DIQ="PSORXED" D EN^DIQ1 K DIC,DIQ
"RTN","PSOORED7",11,0)
 S PSORXED($S(FLN=9:"DAYS SUPPLY",FLN=10:"QTY",1:"# OF REFILLS"))=PSORXED(52,DA,DR)
"RTN","PSOORED7",12,0)
 D:'$O(PSORXED("DOSE",0)) DOLST^PSOORED3
"RTN","PSOORED7",13,0)
 I FLN=9 D  Q
"RTN","PSOORED7",14,0)
 .D DAYS^PSODIR1(.PSORXED) I $G(PSORXED("DFLG")) K PSORXED("FLD",8) Q
"RTN","PSOORED7",15,0)
 .S PSORXED("FLD",8)=PSORXED("DAYS SUPPLY")
"RTN","PSOORED7",16,0)
 I FLN=10 D  Q
"RTN","PSOORED7",17,0)
 .D QTY^PSODIR1(.PSORXED) I $G(PSORXED("DFLG")) K PSORXED("FLD",7) Q
"RTN","PSOORED7",18,0)
 .S:$G(PSORXED("QTY")) PSORXED("FLD",7)=PSORXED("QTY")
"RTN","PSOORED7",19,0)
 I FLN=11 D  Q
"RTN","PSOORED7",20,0)
 .S X=$G(PSORXED("PATIENT STATUS")) S:'X X=$P(RX0,"^",3)
"RTN","PSOORED7",21,0)
 .S DIC=53,DIC(0)="QXZ" D ^DIC K DIC
"RTN","PSOORED7",22,0)
 .S:+Y PSORXED("PTST NODE")=Y(0)
"RTN","PSOORED7",23,0)
 .S:'$G(PSORXED("PATIENT STATUS")) PSORXED("PATIENT STATUS")=+Y
"RTN","PSOORED7",24,0)
 .K X,Y
"RTN","PSOORED7",25,0)
 .I $G(PSODRUG("IEN"))=$P(RX0,"^",6) K PSODRUG S X="`"_$P(RX0,"^",6),DIC=50,DIC(0)="QXZ" D ^DIC K PSOY S PSOY=Y,PSOY(0)=Y(0) D SET^PSODRG
"RTN","PSOORED7",26,0)
 .S:'$G(PSORXED("DAYS SUPPLY")) PSORXED("DAYS SUPPLY")=$P(RX0,"^",8)
"RTN","PSOORED7",27,0)
 .F I=0:0 S I=$O(^PSRX(PSORXED("IRXN"),1,I)) Q:'I  S RFTT=$G(RFTT)+1
"RTN","PSOORED7",28,0)
 .D REFILL^PSODIR1(.PSORXED) K RFTT
"RTN","PSOORED7",29,0)
 .I $G(PSORXED("DFLG")) K PSORXED("FLD",9) Q
"RTN","PSOORED7",30,0)
 .I PSORXED("# OF REFILLS")=$P(RX0,"^",9) Q
"RTN","PSOORED7",31,0)
 .S PSORXED("FLD",9)=PSORXED("# OF REFILLS")
"RTN","PSOORED7",32,0)
 Q
"RTN","PSOORED7",33,0)
VER ;checks for changes to dosing instructions
"RTN","PSOORED7",34,0)
 S ENTS=0
"RTN","PSOORED7",35,0)
 F I=0:0 S I=$O(PSORXED("DOSE",I)) Q:'I  S ENTS=$G(ENTS)+1
"RTN","PSOORED7",36,0)
 I ENTS<OLENT!(ENTS>OLENT) S PSOSIGFL=1 Q
"RTN","PSOORED7",37,0)
 F I=1:1:OLENT D:$D(^PSRX(PSORXED("IRXN"),6,I,0))
"RTN","PSOORED7",38,0)
 .I $P(^PSRX(PSORXED("IRXN"),6,I,0),"^")'=PSORXED("DOSE",I) S PSOSIGFL=1
"RTN","PSOORED7",39,0)
 .I $P(^PSRX(PSORXED("IRXN"),6,I,0),"^")=PSORXED("DOSE",I) D
"RTN","PSOORED7",40,0)
 ..I $G(PSORXED("DOSE ORDERED",I)) S:PSORXED("DOSE ORDERED",I)'=$P(^PSRX(PSORXED("IRXN"),6,I,0),"^",2) PSOSIGFL=1
"RTN","PSOORED7",41,0)
 .I $G(PSORXED("DURATION",I))]"" D
"RTN","PSOORED7",42,0)
 ..S DURATION=$S($E($P(^PSRX(PSORXED("IRXN"),6,I,0),"^",5),1)'?.N:$E($P(^PSRX(PSORXED("IRXN"),6,I,0),"^",5),2,99)_$E($P(^PSRX(PSORXED("IRXN"),6,I,0),"^",5),1),1:$P(^PSRX(PSORXED("IRXN"),6,I,0),"^",5))
"RTN","PSOORED7",43,0)
 ..I +DURATION'=+$G(PSORXED("DURATION",I)) S PSOSIGFL=1
"RTN","PSOORED7",44,0)
 .I $P(^PSRX(PSORXED("IRXN"),6,I,0),"^",6)'=$G(PSORXED("CONJUNCTION",I)) S PSOSIGFL=1
"RTN","PSOORED7",45,0)
 .I $P(^PSRX(PSORXED("IRXN"),6,I,0),"^",7)'=$G(PSORXED("ROUTE",I)) S PSOSIGFL=1
"RTN","PSOORED7",46,0)
 .I $P(^PSRX(PSORXED("IRXN"),6,I,0),"^",8)'=PSORXED("SCHEDULE",I) S PSOSIGFL=1
"RTN","PSOORED7",47,0)
 .I $G(^PSRX(PSORXED("IRXN"),6,I,1))'=$G(PSORXED("ODOSE",I)) S PSOSIGFL=1
"RTN","PSOORED7",48,0)
 K DURATION
"RTN","PSOORED7",49,0)
 Q
"RTN","PSOORED7",50,0)
 ;
"RTN","PSOORED7",51,0)
RESUB ; Resubmits 3rd party claim in case of an edit (Original)
"RTN","PSOORED7",52,0)
 N CHANGED S CHANGED=$$CHANGED(PSORXED("IRXN"),.FLDS)
"RTN","PSOORED7",53,0)
 I CHANGED D
"RTN","PSOORED7",54,0)
 . N RX S RX=PSORXED("IRXN") Q:'RX
"RTN","PSOORED7",55,0)
 . I $P(CHANGED,"^",2),'$$ECMEON^BPSUTIL($$RXSITE^PSOBPSUT(RX,0)) D  Q
"RTN","PSOORED7",56,0)
 . . D REVERSE^PSOBPSU1(RX,0,"DC",99,"RX DIVISION CHANGED",1)
"RTN","PSOORED7",57,0)
 . I $$SUBMIT^PSOBPSUT(RX,0,1,1) D
"RTN","PSOORED7",58,0)
 . . I '$P(CHANGED,"^",2),$$STATUS^PSOBPSUT(RX,0)="" Q
"RTN","PSOORED7",59,0)
 . . D ECMESND^PSOBPSU1(RX,0,,"ED",$$GETNDC^PSONDCUT(RX,0),,$S($P(CHANGED,"^",2):"RX DIVISION CHANGED",1:"RX EDITED"),,+$G(CHGNDC))
"RTN","PSOORED7",60,0)
 . . ;- Checking/Handling DUR/79 Rejects
"RTN","PSOORED7",61,0)
 . . I $$FIND^PSOREJUT(RX,0) S X=$$HDLG^PSOREJU1(RX,0,"79,88","ED","IOQ","Q")
"RTN","PSOORED7",62,0)
 Q
"RTN","PSOORED7",63,0)
 ;
"RTN","PSOORED7",64,0)
CHANGED(RX,PRIOR) ; - Check if fields have changed and should for 3rd Party Claim resubmission
"RTN","PSOORED7",65,0)
 ;Input:  (r) RX    - Rx IEN
"RTN","PSOORED7",66,0)
 ;        (r) PRIOR - Array with fields
"RTN","PSOORED7",67,0)
 ;Output:  CHANGED  - 0 - Not changed / 1 - Original Rx field changed ^ Rx Division changed (1 - YES)
"RTN","PSOORED7",68,0)
 N CHANGED,SAVED
"RTN","PSOORED7",69,0)
 S CHANGED=0 D GETS^DIQ(52,RX_",","4;7;8;20;22;27;81","I","SAVED")
"RTN","PSOORED7",70,0)
 F I=4,7,8,22,27,81 D  I CHANGED Q
"RTN","PSOORED7",71,0)
 . I $G(PRIOR(52,RX_",",I,"I"))'=$G(SAVED(52,RX_",",I,"I")) S CHANGED=1 Q
"RTN","PSOORED7",72,0)
 I $$DIVNCPDP^BPSBUTL(+$G(PRIOR(52,RX_",",20,"I")))'=$$DIVNCPDP^BPSBUTL(+$G(SAVED(52,RX_",",20,"I"))) S CHANGED="1^1"
"RTN","PSOORED7",73,0)
 Q CHANGED
"RTN","PSOORED7",74,0)
 ;;
"RTN","PSOORED7",75,0)
NDCDAWDE(ST,FLN,RXN) ; allow edit of NDC & DAW for DC'd/expired ECME RXs
"RTN","PSOORED7",76,0)
 ;;  input: (r) ST  - the Rx status code
"RTN","PSOORED7",77,0)
 ;;         (r) FLN - field number selected for editing
"RTN","PSOORED7",78,0)
 ;;         (r) RXN - prescription #
"RTN","PSOORED7",79,0)
 ;; output: VALMSG for inappropriate field selection or use
"RTN","PSOORED7",80,0)
 ;;         PSODRUG & RSORXED arrays updated if edited
"RTN","PSOORED7",81,0)
 Q:$G(ST)=""!($G(FLN)="")!($G(RXN)="")
"RTN","PSOORED7",82,0)
 I '((ST=11)!(ST=12)!(ST=14)!(ST=15)) S VALMSG=("Invalid selection!") Q
"RTN","PSOORED7",83,0)
 I '((FLN=2)!(FLN=20)!(FLN=21)) S VALMSG=("Invalid selection!") Q
"RTN","PSOORED7",84,0)
 I $$STATUS^PSOBPSUT(RXN,$$LSTRFL^PSOBPSU1(RXN))="" S VALMSG=("Invalid selection!") Q
"RTN","PSOORED7",85,0)
 ;
"RTN","PSOORED7",86,0)
 ; edit NDCs
"RTN","PSOORED7",87,0)
 I FLN=2 D  Q
"RTN","PSOORED7",88,0)
 .N NDC
"RTN","PSOORED7",89,0)
 .S NDC=$$GETNDC^PSONDCUT(RXN,0)
"RTN","PSOORED7",90,0)
 .D NDCEDT^PSONDCUT(RXN,"",$G(DRG),$G(PSOSITE),.NDC)
"RTN","PSOORED7",91,0)
 .I $G(NDC)="^" Q
"RTN","PSOORED7",92,0)
 .S (PSODRUG("NDC"),PSORXED("FLD",27))=NDC
"RTN","PSOORED7",93,0)
 ;;
"RTN","PSOORED7",94,0)
 ; edit refill NDCs/DAWs
"RTN","PSOORED7",95,0)
 I FLN=20 D  Q
"RTN","PSOORED7",96,0)
 .I $$LSTRFL^PSOBPSU1(RXN)=0 S VALMSG="Invalid selection!" Q
"RTN","PSOORED7",97,0)
 .D REF^PSOORED2
"RTN","PSOORED7",98,0)
 ;;
"RTN","PSOORED7",99,0)
 ; edit DAW
"RTN","PSOORED7",100,0)
 I FLN=21 D  Q
"RTN","PSOORED7",101,0)
 .N DAW
"RTN","PSOORED7",102,0)
 .D EDTDAW^PSODAWUT(RXN,0,.DAW)
"RTN","PSOORED7",103,0)
 .I $G(DAW)="^" Q
"RTN","PSOORED7",104,0)
 .S (PSODRUG("DAW"),PSORXED("FLD",81))=DAW
"RTN","PSOORED7",105,0)
 Q
"RTN","PSOORED7",106,0)
 ;;
"RTN","PSOOREDT")
0^31^B65205187
"RTN","PSOOREDT",1,0)
PSOOREDT ;BIR/SAB - edit orders from backdoor ;03/06/96
"RTN","PSOOREDT",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**4,20,27,37,57,46,78,102,104,119,143,148,260,281,304,289**;DEC 1997;Build 107
"RTN","PSOOREDT",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOOREDT",4,0)
 ;External reference to PSSLOCK supported by DBIA 2789
"RTN","PSOOREDT",5,0)
 ;External reference to ^VA(200 supported by DBIA 10060
"RTN","PSOOREDT",6,0)
SEL K PSOISLKD,PSOLOKED S PSOPLCK=$$L^PSSLOCK(PSODFN,0) I '$G(PSOPLCK) D LOCK^PSOORCPY D SVAL K PSOPLCK S VALMBCK="" Q
"RTN","PSOOREDT",7,0)
 K PSOPLCK D PSOL^PSSLOCK($P(PSOLST(ORN),"^",2)) I '$G(PSOMSG) D UL^PSSLOCK(+$G(PSODFN)) D SVALO K PSOMSG S VALMBCK="" Q
"RTN","PSOOREDT",8,0)
 K PSOMSG S PSOLOKED=1
"RTN","PSOOREDT",9,0)
 K PSORX("DFLG"),DIR,DUOUT,DIRUT S DIR("A")="Select fields by number"
"RTN","PSOOREDT",10,0)
 S DIR(0)="LO^1:"_$S($$STATUS^PSOBPSUT($P(PSOLST(ORN),"^",2))'="":21,$G(REF):20,1:19)
"RTN","PSOOREDT",11,0)
 D ^DIR I $D(DIRUT) K DIR,DIRUT,DTOUT S VALMBCK="" D UL K PSOLOKED Q
"RTN","PSOOREDT",12,0)
EDTSEL N VALMCNT K PSOISLKD,PSORX("DFLG"),PSOOIFLG,PSOMRFLG,DIR,DIRUT,DTOUT,DTOUT,ZONE S (PSOEDIT,PSORXED)=1 I +Y S FST=Y D HLDHDR^PSOLMUTL D  G EX ;PSO LM SELECT MENU protocol
"RTN","PSOOREDT",13,0)
 .I '$G(PSOLOKED) S PSOPLCK=$$L^PSSLOCK(PSODFN,0) I '$G(PSOPLCK) D LOCK^PSOORCPY D SVAL K PSOPLCK S VALMBCK="",(PSOISLKD,PSODE)=1 Q
"RTN","PSOOREDT",14,0)
 .I '$G(PSOLOKED) K PSOPLCK D PSOL^PSSLOCK($P(PSOLST(ORN),"^",2)) I '$G(PSOMSG) D UL^PSSLOCK(+$G(PSODFN)) D SVALO K PSOMSG S VALMBCK="",(PSOISLKD,PSODE)=1 Q
"RTN","PSOOREDT",15,0)
 .K PSOMSG,PSOPLCK S (NEWEDT,PSOLOKED)=1 D EDT
"RTN","PSOOREDT",16,0)
 E  S VALMBCK="",PSODE=1
"RTN","PSOOREDT",17,0)
EX I $G(PSOISLKD) D UL K PSOISLKD G EX2
"RTN","PSOOREDT",18,0)
 I '$G(PSOSIGFL),'$G(PSORXED("DFLG")) D UPDATE^PSOORED6 D LOG^PSORXED,POST^PSORXED G EX1
"RTN","PSOOREDT",19,0)
 I $G(PSOSIGFL)=1 D  Q:$G(PSORX("FN"))
"RTN","PSOOREDT",20,0)
 .N PSOTMP
"RTN","PSOOREDT",21,0)
 .S PSOTMP=$G(PSOFROM),PSOFROM="NEW"
"RTN","PSOOREDT",22,0)
 .S VALMSG="This change will create a new prescription!",NCPDPFLG=1
"RTN","PSOOREDT",23,0)
 .D EN^PSOORED1(.PSORXED)
"RTN","PSOOREDT",24,0)
 .I $G(PSORX("FN")) D  Q
"RTN","PSOOREDT",25,0)
 ..D ^PSOBUILD
"RTN","PSOOREDT",26,0)
 ..K QUIT,PSORX("DFLG"),FST,FLD,IEN,FLN,INCOM,PSOI,PSODRUG,PSOEDIT
"RTN","PSOOREDT",27,0)
 ..K PSORENW,PSOSIGFL,PSOOIFLG,PSOMRFLG,PSODIR,CHK,PSORX("SIG"),PSODE
"RTN","PSOOREDT",28,0)
 ..K PSOTRN,PSORX("EDIT"),PSORXED("FLD"),NEWEDT
"RTN","PSOOREDT",29,0)
 ..D EOJ^PSONEW
"RTN","PSOOREDT",30,0)
 ..D UL K PSOLOKED S VALMBCK="Q"
"RTN","PSOOREDT",31,0)
 .S PSOFROM=PSOTMP I PSOFROM="" K PSOFROM
"RTN","PSOOREDT",32,0)
 ;
"RTN","PSOOREDT",33,0)
EX1 I '$G(PSODE)!('$G(ZONE)) I $G(PSORENW("OIRXN")) D EN^PSOHLSN1(PSORENW("OIRXN"),"XX","","Order edited")
"RTN","PSOOREDT",34,0)
QUIT D UL K PSOLOKED D ^PSOBUILD,ACT^PSOORNE2 D:+^PSRX($P(PSOLST(ORN),"^",2),"STA")=5 EN^PSOCMOPC($P(PSOLST(ORN),"^",2))
"RTN","PSOOREDT",35,0)
 K:'$O(^PSRX($P(PSOLST(ORN),"^",2),1,0)) REF
"RTN","PSOOREDT",36,0)
EX2 S VALMBCK=$S($G(PSORX("FN")):"Q",$G(ZONE):"Q",1:"R") K PSORXED,FST,FLD,IEN,FLN,INCOM,PSOI,PSODRUG,PSOEDIT,PSORENW,PSOSIGFL,PSODIR,CHK,PSORX("SIG"),PSODE,PSOTRN,PSORX("DFLG"),RFED,ZONE,PSORX("EDIT"),PSOOIFLG,PSOMRFLG,SIG,QUIT
"RTN","PSOOREDT",37,0)
 K NEWEDT I $G(VALMBCK)="R" W ! D CLEAN^PSOVER1 H 2
"RTN","PSOOREDT",38,0)
 Q
"RTN","PSOOREDT",39,0)
 ;
"RTN","PSOOREDT",40,0)
EDT ; Rx Edit (Backdoor)
"RTN","PSOOREDT",41,0)
 K NCPDPFLG
"RTN","PSOOREDT",42,0)
 I '$D(PSODRUG) NEW PSOY S PSOY=$P(RX0,U,6),PSOY(0)=^PSDRUG(PSOY,0) D SET^PSODRG
"RTN","PSOOREDT",43,0)
 S I=0 F  S I=$O(^PSRX($P(PSOLST(ORN),"^",2),1,I)) Q:'I  S PSORXED("RX1")=^PSRX($P(PSOLST(ORN),"^",2),1,I,0)
"RTN","PSOOREDT",44,0)
 S (RX0,PSORXED("RX0"))=^PSRX($P(PSOLST(ORN),"^",2),0),PSORXED("RX2")=$G(^(2)),PSORXED("RX3")=$G(^(3)),PSOSIG=$P(^("SIG"),"^")
"RTN","PSOOREDT",45,0)
 F FLD=1:1:$L(FST,",") Q:$P(FST,",",FLD)']""!($G(PSORXED("DFLG")))!($G(PSORX("DFLG")))  S FLN=+$P(FST,",",FLD) D
"RTN","PSOOREDT",46,0)
 .S PSORXED("DFLG")=0,(DA,PSORXED("IRXN"),PSORENW("OIRXN"))=$P(PSOLST(ORN),"^",2),RX0=^PSRX(PSORXED("IRXN"),0) S:$G(PSOSIG)="" PSOSIG=$P(^("SIG"),"^")
"RTN","PSOOREDT",47,0)
 .I '$G(PSOSIGFL) D
"RTN","PSOOREDT",48,0)
 ..S PSOI=+^PSRX(DA,"OR1"),PSODAYS=$P(RX0,"^",8),PSORXST=+$P($G(^PS(53,$P(RX0,"^",3),0)),"^",7)
"RTN","PSOOREDT",49,0)
 ..I 'PSOI S PSOI=+^PSDRUG($P(RX0,"^",6),2),$P(^PSRX(DA,"OR1"),"^")=PSOI
"RTN","PSOOREDT",50,0)
 ..S:'$G(PSODRUG("IEN")) PSODRUG("IEN")=$P(RX0,"^",6),PSODRUG("NAME")=$P(^PSDRUG($P(RX0,"^",6),0),"^")
"RTN","PSOOREDT",51,0)
 ..S PSODRUG("OI")=PSOI
"RTN","PSOOREDT",52,0)
 .S PSORX("PROVIDER")=$P(RX0,"^",4),PSORX("PROVIDER NAME")=$P(^VA(200,$P(RX0,"^",4),0),"^"),PSOTRN=$G(^PSRX(DA,"TN"))
"RTN","PSOOREDT",53,0)
 .D:'$G(CHK) POP^PSOSIGNO(DA),CHK Q:$G(PSORXED("DFLG"))
"RTN","PSOOREDT",54,0)
 .S FDR="39.2^"_$S($P(PSOPAR,"^",3):"6",1:"")_";6.5^113^114^3^1^22R^24^8^7^9^4^11;"_$S($P(RX0,"^",11)="W"&($P(PSOPAR,"^",12)):"35;",1:"")_"^10.6^5^20^23^12^PSOCOU^RF^81"
"RTN","PSOOREDT",55,0)
 .I $G(ST)=11!($G(ST)=12)!($G(ST)=14)!($G(ST)=15) D NDCDAWDE^PSOORED7(ST,FLN,$G(RXN)) Q
"RTN","PSOOREDT",56,0)
 .I FLN=20,'$G(REF) S VALMSG="There is no Refill Data to be edited." Q
"RTN","PSOOREDT",57,0)
 .S DR=$P(FDR,"^",FLN) I DR="RF" D REF^PSOORED2 Q
"RTN","PSOOREDT",58,0)
 .I DR="PSOCOU" D PSOCOU^PSOORED6 Q
"RTN","PSOOREDT",59,0)
 .I FLN=2,'$P(PSOPAR,"^",3),$$RXRLDT^PSOBPSUT(RXN,0),$$STATUS^PSOBPSUT(RXN,0)'="" D  Q
"RTN","PSOOREDT",60,0)
 ..N NDC D NDC^PSODRG(RXN,0,,.NDC) I $G(NDC)="^"!($G(NDC)="") Q
"RTN","PSOOREDT",61,0)
 ..S (PSODRUG("NDC"),PSORXED("FLD",27))=NDC
"RTN","PSOOREDT",62,0)
 .I FLN'>2,'$P(PSOPAR,"^",3) S VALMSG="Check site parameters, Drug data is not editable." Q
"RTN","PSOOREDT",63,0)
 .I FLN=3 D EDTDOSE^PSOORED2,FULL^VALM1,POST^PSODRG S:$G(PSORX("DFLG")) PSOISLKD=1,PSORX("FN")=1 Q
"RTN","PSOOREDT",64,0)
 .I FLN=4 D INS^PSOORED1 Q
"RTN","PSOOREDT",65,0)
 .I FLN=1 D PSOI^PSOORED6 N PSOX S PSORXED=1,PSOX("IRXN")=$S($D(DA):DA,$D(PSORXED("IRXN")):PSORXED("IRXN"),$D(PSORENW("OIRXN")):PSORENW("OIRXN")) D:'$G(PSORXED("DFLG")) EN^PSODIAG Q
"RTN","PSOOREDT",66,0)
 .I FLN=2 D DRG^PSOORED6 N PSOX S PSORXED=1,PSOX("IRXN")=PSORXED("IRXN") D:'$G(PSORXED("DFLG")) EN^PSODIAG S:$O(^PSRX(PSORXED("IRXN"),1,0)) REF=1 Q
"RTN","PSOOREDT",67,0)
 .I FLN=12 D PROV Q
"RTN","PSOOREDT",68,0)
 .I FLN=6 D ISDT^PSOORED2 Q
"RTN","PSOOREDT",69,0)
 .I FLN=7 D FLDT^PSOORED2 Q
"RTN","PSOOREDT",70,0)
 .I FLN=21,$$STATUS^PSOBPSUT(RXN,0)="" S VALMSG="Invalid selection!" Q
"RTN","PSOOREDT",71,0)
 .I FLN=21 D  Q
"RTN","PSOOREDT",72,0)
 ..N DAW D EDTDAW^PSODAWUT(RXN,0,.DAW) I $G(DAW)="^" Q
"RTN","PSOOREDT",73,0)
 ..S (PSODRUG("DAW"),PSORXED("FLD",81))=DAW
"RTN","PSOOREDT",74,0)
 .I FLN=9!(FLN=10)!(FLN=11) D NOCHG^PSOORED7 Q
"RTN","PSOOREDT",75,0)
 .S DR=+DR
"RTN","PSOOREDT",76,0)
 .K DIR,DIRUT,DIROUT ;S DIE=52 D ^DIE I $D(Y) S PSORXED("DFLG")=1
"RTN","PSOOREDT",77,0)
 .K DIC,DIQ S DIC=52,DA=PSORXED("IRXN"),DIQ="PSORXED" D EN^DIQ1 K DIC,DIQ
"RTN","PSOOREDT",78,0)
 .S DIR("B")=$S($G(PSORXED("FLD",DR))]"":PSORXED("FLD",DR),1:PSORXED(52,DA,DR)),DIR(0)="52,"_DR D ^DIR
"RTN","PSOOREDT",79,0)
 .I DR=24!(DR=12) S PSORXED("FLD",DR)=X
"RTN","PSOOREDT",80,0)
 .I $D(DIRUT) K DIR,DIRUT,DUOUT,DTOUT,PSORXED(52,DA,DR),PSORXED("FLD",DR) Q
"RTN","PSOOREDT",81,0)
 .I DR'=5,X="@" W !,"Data Required!",! K DIC,DIQ,DR,DA,DIR,DIRUT,PSORXED(52,DA,DR),X,Y Q
"RTN","PSOOREDT",82,0)
 .I DR=5,X'="@" S Y=+Y
"RTN","PSOOREDT",83,0)
 .I DR=3!(DR=20)!(DR=23) S Y=+Y
"RTN","PSOOREDT",84,0)
 .S PSORXED("FLD",DR)=$S(X="@":X,1:Y) K DIR,DIRUT,DIROUT,X,Y,PSORXED(52,DA,DR)
"RTN","PSOOREDT",85,0)
 .I DR=11,PSORXED("FLD",DR)="W",$P(PSOPAR,"^",12) D
"RTN","PSOOREDT",86,0)
 ..D FIELD^DID(52,DR,"","LABEL","ZZ") S PSORXED(ZZ("LABEL"))=PSORXED("FLD",DR) K ZZ
"RTN","PSOOREDT",87,0)
 ..S DR=35,DIQ="PSORXED" D EN^DIQ1 K DIC,DIQ,DIRUT,DUOUT,DTOUT
"RTN","PSOOREDT",88,0)
 ..S:$G(PSORXED(52,DA,DR))]"" DIR("B")=PSORXED(52,DA,DR)
"RTN","PSOOREDT",89,0)
 ..S DIR(0)="52,"_(DR) D ^DIR I $D(DIRUT),X'="@" K DIR,DIRUT Q
"RTN","PSOOREDT",90,0)
 ..S PSORXED("FLD",DR)=X K DIR,DIRUT,DIROUT,X,Y,PSORXED(52,DA,DR)
"RTN","PSOOREDT",91,0)
 .I $G(PSORXED("FLD",DR))]"" D FIELD^DID(52,DR,"","LABEL","ZZ") S PSORXED(ZZ("LABEL"))=PSORXED("FLD",DR) K ZZ
"RTN","PSOOREDT",92,0)
 Q:$G(PSOSIGFL)
"RTN","PSOOREDT",93,0)
 S (RX1,I,RFD,RFDT)=0 F  S I=$O(^PSRX(PSORXED("IRXN"),1,I)) Q:'I  S RFD=I,RFDT=$P(^PSRX(PSORXED("IRXN"),1,I,0),"^"),RX1(I)=$G(RX1(I))+1
"RTN","PSOOREDT",94,0)
 Q
"RTN","PSOOREDT",95,0)
CHK S CHK=1 I $G(^PSDRUG($P(PSORXED("RX0"),"^",6),"I"))]"",^("I")<DT S VALMSG="This drug has been inactivated. ",PSORXED("DFLG")=1 Q
"RTN","PSOOREDT",96,0)
 K PSPOP I $G(PSODIV),$P(PSORXED("RX2"),"^",9)'=PSOSITE S PSPRXN=PSORXED("IRXN") D  Q:PSORXED("DFLG")
"RTN","PSOOREDT",97,0)
 .I '$P(PSOSYS,"^",2) S VALMSG="RX# "_$P(^PSRX(PSPRXN,0),"^")_" is not a valid choice. (Different Division)" S PSORXED("DFLG")=1 Q
"RTN","PSOOREDT",98,0)
 .I $P(PSOSYS,"^",3) K DIR,DUOUT,DTOUT D  K DIR,DUOUT,DTOUT Q
"RTN","PSOOREDT",99,0)
 ..W $C(7) S DIR("A",1)="",DIR("A",2)="RX# "_$P(^PSRX(PSPRXN,0),"^")_" is from another division.",DIR("A")="Continue: (Y/N)",DIR(0)="Y",DIR("?",1)="'Y' FOR YES",DIR("?")="'N' FOR NO"
"RTN","PSOOREDT",100,0)
 ..S DIR("B")="N" D ^DIR I 'Y!($D(DIRUT)) S PSORXED("DFLG")=1 W !
"RTN","PSOOREDT",101,0)
 ;
"RTN","PSOOREDT",102,0)
 I $P(^PSRX(PSORXED("IRXN"),"STA"),"^")=16 S PSORXED("DFLG")=1 S VALMSG="Prescriptions on Provider Hold cannot be edited." Q
"RTN","PSOOREDT",103,0)
CHKX K PSPOP,DIR,DTOUT,DUOUT,Y,X Q
"RTN","PSOOREDT",104,0)
 Q
"RTN","PSOOREDT",105,0)
PROV ;select provider
"RTN","PSOOREDT",106,0)
 S PSORXED("PROVIDER")=$P(RX0,"^",4),PSORXED("PROVIDER NAME")=$P(^VA(200,$P(RX0,"^",4),0),"^")
"RTN","PSOOREDT",107,0)
 D PROV^PSODIR(.PSORXED) I PSORXED("PROVIDER")'=$P(RX0,"^",4) D
"RTN","PSOOREDT",108,0)
 .K DIR,DIRUT W ! S DIR(0)="Y",DIR("A",1)="You have changed the name of the provider entered for this Rx."
"RTN","PSOOREDT",109,0)
 .S DIR("A",2)="This edit will cause the provider's name to be update for all fills.",DIR("A")="Do you want to continue" D ^DIR
"RTN","PSOOREDT",110,0)
 .I 'Y!$D(DIRUT) K PSORX("PROVIDER"),PSORX("PROVIDER NAME"),PSORX("COSIGNING PROVIDER") Q
"RTN","PSOOREDT",111,0)
 .S PSORXED("FLD",4)=PSORXED("PROVIDER") K DIR,DIRUT,DUOUT
"RTN","PSOOREDT",112,0)
 .S PSORXED("FLD",109)=$G(PSORXED("COSIGNING PROVIDER"))
"RTN","PSOOREDT",113,0)
 Q
"RTN","PSOOREDT",114,0)
UDPROV ;update provider
"RTN","PSOOREDT",115,0)
 S $P(^PSRX(PSORXED("IRXN"),0),"^",4)=PSORXED("PROVIDER"),$P(^(3),"^",3)=$G(PSORX("COSIGNING PROVIDER"))
"RTN","PSOOREDT",116,0)
 F XTY="1","P" F I=0:0 S I=$O(^PSRX(PSORXED("IRXN"),XTY,I)) Q:'I  S $P(^PSRX(PSORXED("IRXN"),XTY,I,0),"^",17)=PSORXED("PROVIDER") S:XTY RFED=I
"RTN","PSOOREDT",117,0)
 K XTY,I
"RTN","PSOOREDT",118,0)
 Q
"RTN","PSOOREDT",119,0)
SIG ;edit medication instructions (SIG)
"RTN","PSOOREDT",120,0)
 S PSOFDR=+$P(^PSRX(PSORXED("IRXN"),"SIG"),"^",2) I PSOFDR D
"RTN","PSOOREDT",121,0)
 .F I=0:0 S I=$O(^PSRX(PSORXED("IRXN"),"SIG1",I)) Q:'I  S SIG(I)=^PSRX(PSORXED("IRXN"),"SIG1",I,0)
"RTN","PSOOREDT",122,0)
 E  S PSORX("SIG")=$P(^PSRX(PSORXED("IRXN"),"SIG"),"^")
"RTN","PSOOREDT",123,0)
 D SIG^PSODIR1(.PSORX) D:$G(PSORX("SIG"))]"" EN1^PSOSIGNO(PSORXED("IRXN"),PSORX("SIG"))
"RTN","PSOOREDT",124,0)
 I '$G(PSOSIGFL),$G(PSORX("SIG"))]"" S ^PSRX(PSORXED("IRXN"),"SIG")=PSORX("SIG") K ^PSRX(PSORXED("IRXN"),"SIG1") Q
"RTN","PSOOREDT",125,0)
 S PSOMRFLG=1
"RTN","PSOOREDT",126,0)
 Q
"RTN","PSOOREDT",127,0)
UL ;
"RTN","PSOOREDT",128,0)
 I '$G(PSOLOKED) Q
"RTN","PSOOREDT",129,0)
 D UL^PSSLOCK(PSODFN)
"RTN","PSOOREDT",130,0)
 D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2))
"RTN","PSOOREDT",131,0)
 Q
"RTN","PSOOREDT",132,0)
SVAL ;Set message for patient lock
"RTN","PSOOREDT",133,0)
 S VALMSG=$S($P($G(PSOPLCK),"^",2)'="":$P($G(PSOPLCK),"^",2)_" is working on this patient.",1:"Another person is entering orders for this patient.")
"RTN","PSOOREDT",134,0)
 Q
"RTN","PSOOREDT",135,0)
SVALO ;Set message for order lock
"RTN","PSOOREDT",136,0)
 S VALMSG=$S($P($G(PSOMSG),"^",2)'="":$P($G(PSOMSG),"^",2),1:"Another person is editing this order.")
"RTN","PSOOREDT",137,0)
 Q
"RTN","PSOOREDT",138,0)
 ;
"RTN","PSOORNE2")
0^32^B68054586
"RTN","PSOORNE2",1,0)
PSOORNE2 ;BIR/SAB-display finished orders from backdoor ; 9/11/06 10:24am
"RTN","PSOORNE2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,21,23,27,32,37,46,84,103,117,131,146,156,210,148,222,238,264,281,289**;DEC 1997;Build 107
"RTN","PSOORNE2",3,0)
 ;^PSDRUG( -  221
"RTN","PSOORNE2",4,0)
 ;^YSCL(603.01 - 2697
"RTN","PSOORNE2",5,0)
 ;^PS(50.606 - 2174
"RTN","PSOORNE2",6,0)
 ;^PS(50.7 - 2223
"RTN","PSOORNE2",7,0)
 ;PSO*210 add call to WORDWRAP api
"RTN","PSOORNE2",8,0)
 ;$$DAWEXT^PSSDAWUT - 4708
"RTN","PSOORNE2",9,0)
 ;
"RTN","PSOORNE2",10,0)
SEL N ORN,ORD I '$G(PSOCNT) S VALMSG="This patient has no Prescriptions!" S VALMBCK="" Q
"RTN","PSOORNE2",11,0)
 D K1^PSOORNE6 S DIR("A")="Select Orders by number",DIR(0)="LO^1:"_PSOCNT D ^DIR I $D(DIRUT) D KV^PSOVER1 S VALMBCK="" Q
"RTN","PSOORNE2",12,0)
NEWSEL N ORN,ORD D K2^PSOORNE6
"RTN","PSOORNE2",13,0)
 I +Y S PSOOELSE=1,PSLST=Y K PSOREEDT D
"RTN","PSOORNE2",14,0)
 .F ORD=1:1:$L(PSLST,",") Q:$P(PSLST,",",ORD)']""  S ORN=+$P(PSLST,",",ORD) D @$S(+PSOLST(ORN)=52:"ACT",1:"PEN^PSOORNE5") K PSOREEDT,PSOSIGFL,PSONACT,SIGOK,PSOFDR,DRET,SIG,INS1 D UL1 I $G(PSOQUIT) K PSOQUIT Q
"RTN","PSOORNE2",15,0)
 K PRC,PHI,RTE I '$G(PSOOELSE) S VALMBCK=""
"RTN","PSOORNE2",16,0)
 K PSONACT,PSOOELSE,CLOZPAT D ^PSOBUILD,BLD^PSOORUT1,K3^PSOORNE6
"RTN","PSOORNE2",17,0)
 Q
"RTN","PSOORNE2",18,0)
 ;
"RTN","PSOORNE2",19,0)
ACT N REF K ^TMP("PSOAO",$J),PCOMX,PDA,PHI,PRC,ACOM,ANS,PSOFDR,CLOZPAT,ANQREM,DUR,DRET
"RTN","PSOORNE2",20,0)
 S RXN=$P(PSOLST(ORN),"^",2),RX0=^PSRX(RXN,0),RX2=$G(^(2)),RX3=$G(^(3)),ST=+$G(^("STA")),RXOR=$G(^("OR1")),POE=$G(^("POE")),EXDT=$S($P($G(^(2)),"^",6)>DT:1,1:0)
"RTN","PSOORNE2",21,0)
 I 'RX3 S RX3=$P(RX2,"^",2),$P(^PSRX(RXN,3),"^")=$P(RX2,"^",2)
"RTN","PSOORNE2",22,0)
 S PSODRG=+$P(RX0,"^",6),PSODRUG0=^PSDRUG(PSODRG,0),INDT=$G(^("I"))
"RTN","PSOORNE2",23,0)
 ;PSO*7*238;SET PSODRUG ARRAY ; PSOY KILLED AT END OF SET^PSODRG
"RTN","PSOORNE2",24,0)
 K PSODRUG
"RTN","PSOORNE2",25,0)
 S PSOY=PSODRG,PSOY(0)=PSODRUG0 D SET^PSODRG
"RTN","PSOORNE2",26,0)
 I 'RXOR,$P(^PSDRUG(PSODRG,2),"^") S $P(^PSRX(RXN,"OR1"),"^")=$P(^PSDRUG(PSODRG,2),"^"),RXOR=$P(^PSDRUG(PSODRG,2),"^")
"RTN","PSOORNE2",27,0)
 I $P($G(^PSDRUG(PSODRG,"CLOZ1")),"^")="PSOCLO1" D
"RTN","PSOORNE2",28,0)
 .S CLOZPAT=$O(^YSCL(603.01,"C",PSODFN,0)) Q:'CLOZPAT
"RTN","PSOORNE2",29,0)
 .;S CLOZPAT=$S($P(^YSCL(603.01,CLOZPAT,0),"^",3)="B":1,1:0)
"RTN","PSOORNE2",30,0)
 .S CLOZPAT=$P(^YSCL(603.01,CLOZPAT,0),"^",3)
"RTN","PSOORNE2",31,0)
 .S CLOZPAT=$S(CLOZPAT="M":2,CLOZPAT="B":1,1:0)
"RTN","PSOORNE2",32,0)
 I $D(^XUSEC("PSORPH",DUZ)) S RPH=1 D
"RTN","PSOORNE2",33,0)
 .S PSOACT=$S('ST&($G(INDT)]"")&(DT>$G(INDT)):"DHPLATC",ST=1:"DVE",ST=4:"DV",ST=3:"DU",ST=5:"ELTD",ST=11:"ETDPCL",ST=12&EXDT:"EDCL",ST=12&'EXDT:"ECL",(ST=14!(ST=15))&'EXDT:"ECL",ST=13:"L",ST=16:"DL",1:"DHPEATCL")
"RTN","PSOORNE2",34,0)
 .D GET^PSOORNE5 S PSOACT=PSOACT_$S(ACTREN:"N",1:""),PSOACT=PSOACT_$S(ACTREF:"R",1:"")
"RTN","PSOORNE2",35,0)
 .I ST=5 S SURX=$O(^PS(52.5,"B",RXN,0)) I SURX,$P($G(^PS(52.5,SURX,0)),"^",7)="L" S PSOACT="TL" K SURX Q
"RTN","PSOORNE2",36,0)
 .S:ST'=12&('$D(^PS(50.7,+$P(RXOR,"^"),0))) PSOACT="DL",VALMSG="No Pharmacy Orderable Item !",PSONACT=1
"RTN","PSOORNE2",37,0)
 .S:ST=12&('$D(^PS(50.7,+$P(RXOR,"^"),0))) PSOACT="L",VALMSG="No Pharmacy Orderable Item !",PSONACT=1
"RTN","PSOORNE2",38,0)
 .;I ST=14!(ST=15) S VALMSG="Rx Discontinued By "_$S(ST=14:"Provider",1:"Edit")_". Cannot be Reinstated."
"RTN","PSOORNE2",39,0)
 .S:ST=16 VALMSG="Rx Placed on HOLD by Provider."
"RTN","PSOORNE2",40,0)
 E  D
"RTN","PSOORNE2",41,0)
 .I ST=5 S SURX=$O(^PS(52.5,"B",RXN,0)) I SURX,$P($G(^PS(52.5,SURX,0)),"^",7)="L" S PSOACT="TL" Q
"RTN","PSOORNE2",42,0)
 .S PSOACT=$S(ST'<1&(ST'>4)!(ST>12):"",ST=12&EXDT&($P($G(PSOPAR),"^",2)):"CDPLT",1:"CPLT")
"RTN","PSOORNE2",43,0)
 .D GET^PSOORNE5 S PSOACT=PSOACT_$S(ACTREN:"N",1:""),PSOACT=PSOACT_$S(ACTREF:"R",1:"")
"RTN","PSOORNE2",44,0)
 .S:'$D(^PS(50.7,+$P(RXOR,"^"),0)) PSOACT="L",PSONACT=1,VALMSG="No Pharmacy Orderable Item !"
"RTN","PSOORNE2",45,0)
 ;K PSOLKFL D PSOL^PSSLOCK(RXN) I '$G(PSOMSG) K PSOMSG S PSOLKFL=1 S PSOACT="",VALMSG="This Order is being edited by another user."
"RTN","PSOORNE2",46,0)
 K PSOMSG S IEN=0,$P(RN," ",12)=" "
"RTN","PSOORNE2",47,0)
 I $G(RPH),ST=1,$P($G(^PSRX(RXN,"PKI")),"^") N PKI,PKI1,PKIR,PKIE,DA S DA=RXN D CER^PSOPKIV1 K DA D:$G(PKI1) L1^PSOPKIV1
"RTN","PSOORNE2",48,0)
 D DIN^PSONFI(+RXOR,$P(RX0,"^",6))
"RTN","PSOORNE2",49,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)=$S($P($G(^PSRX(RXN,"TPB")),"^"):"            TPB Rx #: ",1:"                Rx #: ")
"RTN","PSOORNE2",50,0)
 S ^TMP("PSOAO",$J,IEN,0)=^TMP("PSOAO",$J,IEN,0)_$P(RX0,"^")_$S($G(^PSRX(RXN,"IB")):"$",1:"")_$$ECME^PSOBPSUT(RXN)_$E(RN,$L($P(RX0,"^")_$S($G(^PSRX(RXN,"IB")):"$",1:"")_$$ECME^PSOBPSUT(RXN))+1,12)
"RTN","PSOORNE2",51,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)=" ("_$S($P(PSOPAR,"^",3):1,1:"#")_")"_" *Orderable Item: "_$S($D(^PS(50.7,$P(+RXOR,"^"),0)):$P(^PS(50.7,$P(+RXOR,"^"),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^"),1:"")_NFIO
"RTN","PSOORNE2",52,0)
 S:NFIO["<DIN>" NFIO=IEN_","_($L(^TMP("PSOAO",$J,IEN,0))-4)
"RTN","PSOORNE2",53,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)=" ("_$S($P(PSOPAR,"^",3):2,1:"#")_")"_$S($D(^PSDRUG("AQ",$P(RX0,"^",6))):"       CMOP ",1:"            ")_"Drug: "_$P(^PSDRUG($P(RX0,"^",6),0),"^")_NFID
"RTN","PSOORNE2",54,0)
 S:NFID["<DIN>" NFID=IEN_","_($L(^TMP("PSOAO",$J,IEN,0))-4)
"RTN","PSOORNE2",55,0)
 I $$STATUS^PSOBPSUT(RXN,0)'="",$$RXRLDT^PSOBPSUT(RXN,0) D
"RTN","PSOORNE2",56,0)
 . S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)=" "_$S('$P(PSOPAR,"^",3):"(2)",1:"   ")_"             NDC: "_$$GETNDC^PSONDCUT(RXN,0)
"RTN","PSOORNE2",57,0)
 S:$G(^PSRX(RXN,"TN"))]"" IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="          Trade Name: "_$G(^PSRX(RXN,"TN"))
"RTN","PSOORNE2",58,0)
 D DOSE^PSOORNE5
"RTN","PSOORNE2",59,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)=" (4)Pat Instructions:" D INS^PSOORNE5
"RTN","PSOORNE2",60,0)
 D PC^PSOORNE5
"RTN","PSOORNE2",61,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="                 SIG:"
"RTN","PSOORNE2",62,0)
 I '$P($G(^PSRX(RXN,"SIG")),"^",2) S SIGOK=0 D  G PTST
"RTN","PSOORNE2",63,0)
 .S X=$P($G(^PSRX(RXN,"SIG")),"^") D SIGONE^PSOHELP S SIG=$E($G(INS1),2,250)
"RTN","PSOORNE2",64,0)
 .F SG=1:1:$L(SIG) S:$L(^TMP("PSOAO",$J,IEN,0)_" "_$P(SIG," ",SG))>80 IEN=IEN+1,$P(^TMP("PSOAO",$J,IEN,0)," ",21)=" " S:$P(SIG," ",SG)'="" ^TMP("PSOAO",$J,IEN,0)=$G(^TMP("PSOAO",$J,IEN,0))_" "_$P(SIG," ",SG)
"RTN","PSOORNE2",65,0)
 S SIGOK=1
"RTN","PSOORNE2",66,0)
 F I=0:0 S I=$O(^PSRX(RXN,"SIG1",I)) Q:'I  D                  ;PSO*210
"RTN","PSOORNE2",67,0)
 . S MIG=$P(^PSRX(RXN,"SIG1",I,0),"^")
"RTN","PSOORNE2",68,0)
 . D WORDWRAP^PSOUTLA2(MIG,.IEN,$NA(^TMP("PSOAO",$J)),21)
"RTN","PSOORNE2",69,0)
 S SIGOK=1 K MIG,SG
"RTN","PSOORNE2",70,0)
PTST S $P(RN," ",25)=" ",PTST=$S($G(^PS(53,+$P(RX0,"^",3),0))]"":$P($G(^PS(53,+$P(RX0,"^",3),0)),"^"),1:""),IEN=IEN+1
"RTN","PSOORNE2",71,0)
 S ^TMP("PSOAO",$J,IEN,0)=" (5)  Patient Status: "_PTST_$E(RN,$L(PTST)+1,25)
"RTN","PSOORNE2",72,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)=" (6)      Issue Date: "_$E($P(RX0,"^",13),4,5)_"/"_$E($P(RX0,"^",13),6,7)_"/"_$E($P(RX0,"^",13),2,3)
"RTN","PSOORNE2",73,0)
 S ^TMP("PSOAO",$J,IEN,0)=^TMP("PSOAO",$J,IEN,0)_"               (7)  Fill Date: "_$E($P(RX2,"^",2),4,5)_"/"_$E($P(RX2,"^",2),6,7)_"/"_$E($P(RX2,"^",2),2,3)
"RTN","PSOORNE2",74,0)
 S ROU=$S($P(RX0,"^",11)="W":"Window",1:"Mail")
"RTN","PSOORNE2",75,0)
 S REFL=$P(RX0,"^",9),I=0 F  S I=$O(^PSRX(RXN,1,I)) Q:'I  S REFL=REFL-1,ROU=$S($P(^PSRX(RXN,1,I,0),"^",2)="W":"Window",1:"Mail")
"RTN","PSOORNE2",76,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="      Last Fill Date: "_$E($P(RX3,"^"),4,5)_"/"_$E($P(RX3,"^"),6,7)_"/"_$E($P(RX3,"^"),2,3)
"RTN","PSOORNE2",77,0)
 D CMOP^PSOORNE3
"RTN","PSOORNE2",78,0)
 S ^TMP("PSOAO",$J,IEN,0)=^TMP("PSOAO",$J,IEN,0)_" ("_ROU_$S($G(PSOCMOP)]"":", "_PSOCMOP,1:"")_")" K ROU,PSOCMOP
"RTN","PSOORNE2",79,0)
 S IEN=IEN+1 I $P(RX2,"^",15) S ^TMP("PSOAO",$J,IEN,0)="   Returned to Stock: "_$E($P(RX2,"^",15),4,5)_"/"_$E($P(RX2,"^",15),6,7)_"/"_$E($P(RX2,"^",15),2,3)_$S($P(RX2,"^",14):" (Reprinted)",1:"")
"RTN","PSOORNE2",80,0)
 E  S ^TMP("PSOAO",$J,IEN,0)="   Last Release Date: " D
"RTN","PSOORNE2",81,0)
 .S RLD=$S($P(RX2,"^",13):$E($P(RX2,"^",13),4,5)_"/"_$E($P(RX2,"^",13),6,7)_"/"_$E($P(RX2,"^",13),2,3),1:"")
"RTN","PSOORNE2",82,0)
 .I $O(^PSRX(RXN,1,0)) F I=0:0 S I=$O(^PSRX(RXN,1,I)) Q:'I  D
"RTN","PSOORNE2",83,0)
 ..I $P(^PSRX(RXN,1,I,0),"^",18) S RLD=$E($P(^(0),"^",18),4,5)_"/"_$E($P(^(0),"^",18),6,7)_"/"_$E($P(^(0),"^",18),2,3)
"RTN","PSOORNE2",84,0)
 .S ^TMP("PSOAO",$J,IEN,0)=^TMP("PSOAO",$J,IEN,0)_$S($G(RLD)]"":RLD,1:"        ")
"RTN","PSOORNE2",85,0)
 S ^TMP("PSOAO",$J,IEN,0)=^TMP("PSOAO",$J,IEN,0)_"               (8)      Lot #: "_$P($G(RX2),"^",4)
"RTN","PSOORNE2",86,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="             Expires: "_$E($P(RX2,"^",6),4,5)_"/"_$E($P(RX2,"^",6),6,7)_"/"_$E($P(RX2,"^",6),2,3)
"RTN","PSOORNE2",87,0)
 S ^TMP("PSOAO",$J,IEN,0)=^TMP("PSOAO",$J,IEN,0)_"                          MFG: "_$P($G(RX2),"^",8)
"RTN","PSOORNE2",88,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(9)      Days Supply: "_$P(RX0,"^",8)_$S($L($P(RX0,"^",8))=1:" ",1:"")
"RTN","PSOORNE2",89,0)
 S ^TMP("PSOAO",$J,IEN,0)=^TMP("PSOAO",$J,IEN,0)_"                    (10)  QTY"_$S($P($G(^PSDRUG($P(RX0,"^",6),660)),"^",8)]"":" ("_$P($G(^PSDRUG($P(RX0,"^",6),660)),"^",8)_")",1:" (  )")_": "_$P(RX0,"^",7)
"RTN","PSOORNE2",90,0)
 I $P($G(^PSDRUG($P(RX0,"^",6),5)),"^")]"" D
"RTN","PSOORNE2",91,0)
 .S $P(RN," ",79)=" ",IEN=IEN+1
"RTN","PSOORNE2",92,0)
 .S ^TMP("PSOAO",$J,IEN,0)=$E(RN,$L("QTY DSP MSG: "_$P(^PSDRUG($P(RX0,"^",6),5),"^"))+1,79)_"QTY DSP MSG: "_$P(^PSDRUG($P(RX0,"^",6),5),"^") K RN
"RTN","PSOORNE2",93,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(11)    # of Refills: "_$P(RX0,"^",9)_$S($L($P(RX0,"^",9))=1:" ",1:"")_"                          Remaining: "_REFL
"RTN","PSOORNE2",94,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(12)        Provider: "_$S($D(^VA(200,$P(RX0,"^",4),0)):$P(^VA(200,$P(RX0,"^",4),0),"^"),1:"UNKNOWN")
"RTN","PSOORNE2",95,0)
 I $P(RX3,"^",3) S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="        Cos-Provider: "_$P(^VA(200,$S($G(PSORX("COSIGNING PROVIDER")):PSORX("COSIGNING PROVIDER"),1:$P(RX3,"^",3)),0),"^")
"RTN","PSOORNE2",96,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(13)         Routing: "_$S($P(RX0,"^",11)="M":"MAIL",1:"WINDOW")_"                  (14)     Copies: "_$S($P(RX0,"^",18):$P(RX0,"^",18),1:1)
"RTN","PSOORNE2",97,0)
 S:$P(RX0,"^",11)="W"&($P(PSOPAR,"^",12)) IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="    Method of Pickup: "_$G(^PSRX(RXN,"MP"))
"RTN","PSOORNE2",98,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(15)          Clinic: "_$S($D(^SC(+$P(RX0,"^",5),0)):$P(^SC($P(RX0,"^",5),0),"^"),1:"Not on File")
"RTN","PSOORNE2",99,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(16)        Division: "_$S($G(^PS(59,+$P(RX2,"^",9),0))]"":$P(^PS(59,$P(RX2,"^",9),0),"^")_" ("_$P(^(0),"^",6)_")",1:"UNKNOWN")
"RTN","PSOORNE2",100,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(17)      Pharmacist: "_$S($P(RX2,"^",3):$P(^VA(200,$P(RX2,"^",3),0),"^"),1:"")
"RTN","PSOORNE2",101,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(18)         Remarks:" D RMK^PSOORNE3
"RTN","PSOORNE2",102,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(19)      Counseling: "_$S($P($G(^PSRX(RXN,"PC")),"^"):"YES",1:"NO")_"                      "_$S($P($G(^PSRX(RXN,"PC")),"^"):"Was Counseling Understood: "_$S($P($G(^PSRX(RXN,"PC")),"^",2):"YES",1:"NO"),1:"")
"RTN","PSOORNE2",103,0)
 S:$O(^PSRX(RXN,1,0)) REF=1,IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(20)     Refill Data"
"RTN","PSOORNE2",104,0)
 I $$STATUS^PSOBPSUT(RXN,0)'="" D
"RTN","PSOORNE2",105,0)
 . N DAW S IEN=IEN+1,DAW=$$GETDAW^PSODAWUT(RXN,0)
"RTN","PSOORNE2",106,0)
 . S ^TMP("PSOAO",$J,IEN,0)="(21)        DAW Code: "_DAW_" - "_$$DAWEXT^PSSDAWUT(DAW)
"RTN","PSOORNE2",107,0)
 D DISP^PSOORNE6
"RTN","PSOORNE2",108,0)
 I $G(PSOBEDT),PSOACT["E" S PSOACT="E"
"RTN","PSOORNE2",109,0)
 I $G(PSOBEDT),PSOACT'["E" S PSOACT=""
"RTN","PSOORNE2",110,0)
 Q:$G(PSORXED)!($G(COPY))!($G(UPMI))  S:$G(PSOBEDT) (PSOEDIT,PSORXED)=1 D ^PSOLMLST ; I '$G(PSOLKFL) D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2))
"RTN","PSOORNE2",111,0)
 K DRET,SIG
"RTN","PSOORNE2",112,0)
 Q
"RTN","PSOORNE2",113,0)
UL1 ;
"RTN","PSOORNE2",114,0)
 ;I +PSOLST(ORN)=52 D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2)) Q
"RTN","PSOORNE2",115,0)
 ;I $D(^PS(52.41,$P(PSOLST(ORN),"^",2),0)) D PSOUL^PSSLOCK($P(PSOLST(ORN),"^",2)_"S")
"RTN","PSOORNE2",116,0)
 Q
"RTN","PSOORUT1")
0^42^B71103407
"RTN","PSOORUT1",1,0)
PSOORUT1 ;BIR/SAB - Utility routine for oerr interface ;6/28/07 7:36am
"RTN","PSOORUT1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**1,14,30,46,132,148,233,274,225,305,289**;DEC 1997;Build 107
"RTN","PSOORUT1",3,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSOORUT1",4,0)
 ;External reference to ^PSXOPUTL supported by DBIA 2203
"RTN","PSOORUT1",5,0)
 ;called from HD^PSOORUTL
"RTN","PSOORUT1",6,0)
REL ;removed order from hold
"RTN","PSOORUT1",7,0)
 S ACT=1,ORS=0
"RTN","PSOORUT1",8,0)
 I POERR("PSOFILNM")["S" S DA=+POERR("PSOFILNM") D  G EXIT^PSOORUTL
"RTN","PSOORUT1",9,0)
 .Q:'$D(^PS(52.41,DA,0))  Q:$P(^PS(52.41,DA,0),"^",3)="RF"
"RTN","PSOORUT1",10,0)
 .S $P(^PS(52.41,DA,0),"^",3)="NW",POERR("STAT")="OR",POERR("FILLER")=DA_"^P"
"RTN","PSOORUT1",11,0)
 .S:$G(POERR("COMM"))']"" POERR("COMM")="Order RELEASED from HOLD by OE/RR before finished." S $P(^PS(52.41,DA,4),"^")=POERR("COMM"),ORS=1
"RTN","PSOORUT1",12,0)
 S DA=POERR("PSOFILNM") I $D(^PSRX(DA,0)) S ORS=1,PSDA=DA D  G EXIT^PSOORUTL
"RTN","PSOORUT1",13,0)
 .S POERR("FILLER")=DA_"^R",POERR("STAT")="OR"
"RTN","PSOORUT1",14,0)
 .S:'$D(POERR("COMM")) POERR("COMM")="Prescription Released from HOLD by OE/RR"
"RTN","PSOORUT1",15,0)
 .I DT>$P(^PSRX(DA,2),"^",6) D
"RTN","PSOORUT1",16,0)
 ..S EXP=$P(^PSRX(DA,2),"^",6) S:$P(^PSRX(DA,"STA"),"^")<12 $P(^PSRX(DA,"STA"),"^")=11,PSOEXFLG=1 S POERR("STAT")="UR",POERR("COMM")="Medication Expired on "_$E(EXP,4,5)_"/"_$E(EXP,6,7)_"/"_$E(EXP,2,3)_".",POERR("PHARMST")="" D ECAN^PSOUTL(DA) Q
"RTN","PSOORUT1",17,0)
 .I $P(^PSRX(DA,"STA"),"^")'=16 S POERR("STAT")="UR",POERR("COMM")="Unable to Release from Hold" Q
"RTN","PSOORUT1",18,0)
 .S RXFL(DA)=0,FDT=$P(^PSRX(DA,2),"^",2)
"RTN","PSOORUT1",19,0)
 .I $O(^PSRX(DA,1,0)) F I=0:0 S I=$O(^PSRX(DA,1,I)) Q:'I  S FDT=$P(^PSRX(DA,1,I,0),"^"),RXFL(DA)=I
"RTN","PSOORUT1",20,0)
 .I FDT>DT N PSOSITEZ,ZPSOPAR6 S PSOSITEZ=$S($P($G(^PSRX(DA,2)),"^",9):$P(^(2),"^",9),1:$O(^PS(59,0))),ZPSOPAR6=$P($G(^PS(59,PSOSITEZ,1)),"^",6) I ZPSOPAR6 D  Q
"RTN","PSOORUT1",21,0)
 ..S RXXDA=DA,DA=$O(^PS(52.5,"B",RXXDA,0)) I DA S DIK="^PS(52.5," D ^DIK K DIK
"RTN","PSOORUT1",22,0)
 ..S DA=RXXDA
"RTN","PSOORUT1",23,0)
 ..S DIC="^PS(52.5,",DIC(0)="L",DLAYGO=52.5,X=RXXDA,DIC("DR")=".02///"_FDT_";.03////"_$P(^PSRX(DA,0),"^",2)_";.04///M;.05///0;.06////"_PSOSITEZ_";2///0;9///"_RXFL(DA) K DD,DO D FILE^DICN K RXFL,DD,DO
"RTN","PSOORUT1",24,0)
 ..S DA=RXXDA K RXXDA S $P(^PSRX(DA,"STA"),"^")=5,LFD=$E(FDT,4,5)_"-"_$E(FDT,6,7)_"-"_$E(FDT,2,3) D ACT1
"RTN","PSOORUT1",25,0)
 ..S PSOSUSZ=1
"RTN","PSOORUT1",26,0)
 .E  S $P(^PSRX(DA,"STA"),"^")=0
"RTN","PSOORUT1",27,0)
 .S RXF=0 F I=0:0 S I=$O(^PSRX(DA,1,I)) Q:'I  S RXF=I S:I>5 RXF=I+1
"RTN","PSOORUT1",28,0)
 .D ACT^PSOORUTL
"RTN","PSOORUT1",29,0)
 .I $$SUBMIT^PSOBPSUT(DA) D ECMESND^PSOBPSU1(DA,,$$RXFLDT^PSOBPSUT(DA),$S('$O(^PSRX(DA,1,0)):"OF",1:"RF"))
"RTN","PSOORUT1",30,0)
 G EXIT^PSOORUTL
"RTN","PSOORUT1",31,0)
ACT1 S RXF=0 F I=0:0 S I=$O(^PSRX(DA,1,I)) Q:'I  S RXF=I S:I>5 RXF=I+1
"RTN","PSOORUT1",32,0)
 S IR=0 F FDA=0:0 S FDA=$O(^PSRX(DA,"A",FDA)) Q:'FDA  S IR=FDA
"RTN","PSOORUT1",33,0)
 S IR=IR+1,^PSRX(DA,"A",0)="^52.3DA^"_IR_"^"_IR
"RTN","PSOORUT1",34,0)
 D NOW^%DTC S ^PSRX(DA,"A",IR,0)=%_"^S^"_POERR("USER")_"^"_RXF_"^"_"RX Placed on Suspense until "_LFD
"RTN","PSOORUT1",35,0)
 Q
"RTN","PSOORUT1",36,0)
SUS ;
"RTN","PSOORUT1",37,0)
 I $P($G(^PSRX(+$G(FILLER),"STA")),"^")=5 N PSOMSORR,PLACERXX D EN^PSOHLSN1(+$G(FILLER),"SC","ZS","")
"RTN","PSOORUT1",38,0)
 Q
"RTN","PSOORUT1",39,0)
BLD ;builds med profile for Listman
"RTN","PSOORUT1",40,0)
 K ^TMP("PSOPF",$J),PSOLST S:$G(PSOOPT)'=3 PSOOPT=0 I '$G(PSOSD) S ^TMP("PSOPF",$J,1,0)="This patient has no prescriptions" S PSOCNT=0,PSOPF=1 Q
"RTN","PSOORUT1",41,0)
 D EOJ,SHOW
"RTN","PSOORUT1",42,0)
EOJ ;
"RTN","PSOORUT1",43,0)
 K PSOQFLG,PSODRG,PSODATA,PSOLF
"RTN","PSOORUT1",44,0)
 Q
"RTN","PSOORUT1",45,0)
 ;-----------------------------------------------------------------
"RTN","PSOORUT1",46,0)
SHOW ;
"RTN","PSOORUT1",47,0)
 ; - ePharmacy modification to create a section for Rx with REJECTs
"RTN","PSOORUT1",48,0)
 N PSOTMP,PSOSTS,PSODRNM,I,PSORX
"RTN","PSOORUT1",49,0)
 S (PSOSTS,PSODRNM)=""
"RTN","PSOORUT1",50,0)
 F  S PSOSTS=$O(PSOSD(PSOSTS)) Q:PSOSTS=""  D
"RTN","PSOORUT1",51,0)
 . F  S PSODRNM=$O(PSOSD(PSOSTS,PSODRNM)) Q:PSODRNM=""  D
"RTN","PSOORUT1",52,0)
 . . S PSORX=+$G(PSOSD(PSOSTS,PSODRNM))
"RTN","PSOORUT1",53,0)
 . . I PSOSTS="ACTIVE",$$FIND^PSOREJUT(PSORX,,,"79,88") D  Q
"RTN","PSOORUT1",54,0)
 . . . S PSOTMP(" REJECT",PSODRNM)=PSOSTS
"RTN","PSOORUT1",55,0)
 . . S PSOTMP(PSOSTS,PSODRNM)=PSOSTS
"RTN","PSOORUT1",56,0)
 ;
"RTN","PSOORUT1",57,0)
 S (PSOSTS,PSODRG)="",(PSOCNT,PSOQFLG,IEN)=0
"RTN","PSOORUT1",58,0)
 K RN,DL S $P(RN," ",12)=" ",$P(DL," ",40)=" "
"RTN","PSOORUT1",59,0)
 F PSCNT=0:0 S PSOSTS=$O(PSOTMP(PSOSTS)) Q:PSOSTS=""  D
"RTN","PSOORUT1",60,0)
 . D STA
"RTN","PSOORUT1",61,0)
 . F PSOCT=0:0 S PSODRG=$O(PSOTMP(PSOSTS,PSODRG)) Q:PSODRG=""  Q:PSOCNT>1000!PSOQFLG  D
"RTN","PSOORUT1",62,0)
 . . S PSOSTA=PSOTMP(PSOSTS,PSODRG)
"RTN","PSOORUT1",63,0)
 . . S PSODATA=PSOSD(PSOSTA,PSODRG) I PSOSTA="ZNONVA" D NVA Q
"RTN","PSOORUT1",64,0)
 . . S PSOCNT=PSOCNT+1 I PSOSTA="PENDING" D PEN Q
"RTN","PSOORUT1",65,0)
 . . S:'$D(^PSRX(+PSODATA,0)) PSOCNT=PSOCNT-1 D:$D(^(0)) DISPL
"RTN","PSOORUT1",66,0)
 S (VALMCNT,PSOPF)=IEN
"RTN","PSOORUT1",67,0)
SHOWX K DIRUT,DTOUT,DUOUT,DIROUT,PSODRG
"RTN","PSOORUT1",68,0)
 Q
"RTN","PSOORUT1",69,0)
 ;
"RTN","PSOORUT1",70,0)
DISPL S IEN=IEN+1 N PSOID,PSOCMOP,STATLTH,ECME
"RTN","PSOORUT1",71,0)
 K PSOLNT,PSOQTL,PSOLSP S PSOLRX=$S($G(^PSRX(+PSODATA,"IB")):13,1:14)-$L($P(^PSRX(+PSODATA,0),"^")),$P(PSOLNT," ",PSOLRX)=" ",PSODQL=$L($P(PSODRG,"^"))+$L($P(^PSRX(+PSODATA,0),"^",7))
"RTN","PSOORUT1",72,0)
 I PSODQL<39 S $P(PSOQTL," ",(40-PSODQL))=" "
"RTN","PSOORUT1",73,0)
 E  S $P(PSOQTL," ",(52-$L($P(^PSRX(+PSODATA,0),"^",7))))=" ",$P(PSOLSP," ",(41-$L($P(PSODRG,"^"))))=" "
"RTN","PSOORUT1",74,0)
 S ECME=$$ECME^PSOBPSUT(+PSODATA) I ECME'="" S PSOLNT=$E(PSOLNT,1,$L(PSOLNT)-1)
"RTN","PSOORUT1",75,0)
 S ^TMP("PSOPF",$J,IEN,0)=$J(PSOCNT,2)_$S($L(PSOCNT)<3:" ",1:"")_$P(^PSRX(+PSODATA,0),"^")_$S($G(^PSRX(+PSODATA,"IB")):"$",1:"")_ECME_PSOLNT_$P(PSODRG,"^")_$S(PSODQL<39:PSOQTL_$P(^PSRX(+PSODATA,0),"^",7)_" ",1:$G(PSOLSP))
"RTN","PSOORUT1",76,0)
 S STA="A^N^R^H^N^S^^^^^^E^DC^^DC^DE^H^P^"
"RTN","PSOORUT1",77,0)
 S PSOCMOP=""
"RTN","PSOORUT1",78,0)
 I $D(^PSDRUG("AQ",$P(^PSRX(+PSODATA,0),"^",6))) S PSOCMOP=">"
"RTN","PSOORUT1",79,0)
 N X S X="PSXOPUTL" X ^%ZOSF("TEST") K X I $T D
"RTN","PSOORUT1",80,0)
 .N DA S DA=+PSODATA D ^PSXOPUTL K DA
"RTN","PSOORUT1",81,0)
 .I $G(PSXZ(PSXZ("L")))=0!($G(PSXZ(PSXZ("L")))=2) S PSOCMOP="T"
"RTN","PSOORUT1",82,0)
 .K PSXZ
"RTN","PSOORUT1",83,0)
 N PSOBADR
"RTN","PSOORUT1",84,0)
 S PSOBADR=$O(^PSRX(+PSODATA,"L",9999),-1)
"RTN","PSOORUT1",85,0)
 I PSOBADR'="" S PSOBADR=$G(^PSRX(+PSODATA,"L",PSOBADR,0)) I PSOBADR["(BAD ADDRESS)" S PSOBADR="B"
"RTN","PSOORUT1",86,0)
 I PSOBADR'="B" S PSOBADR=""
"RTN","PSOORUT1",87,0)
 S STAPRT=$P(STA,"^",$P(PSODATA,"^",2)+1)_PSOCMOP_PSOBADR
"RTN","PSOORUT1",88,0)
 S STATLTH=$L(STAPRT)
"RTN","PSOORUT1",89,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_STAPRT_$S(STATLTH=0:"   ",STATLTH=1:"  ",STATLTH=2:" ",1:"")
"RTN","PSOORUT1",90,0)
 S PSOID=$P(^PSRX(+PSODATA,0),"^",13),PSOLF=+$G(^(3)),^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$E(PSOID,4,5)_"-"_$E(PSOID,6,7)_" "
"RTN","PSOORUT1",91,0)
 N RFLZRO,PSOLRD S PSOLRD=$P($G(^PSRX(+PSODATA,2)),"^",13)
"RTN","PSOORUT1",92,0)
 F PSOX=0:0 S PSOX=$O(^PSRX(+PSODATA,1,PSOX)) Q:'PSOX  D
"RTN","PSOORUT1",93,0)
 . S RFLZRO=$G(^PSRX(+PSODATA,1,PSOX,0))
"RTN","PSOORUT1",94,0)
 . I +RFLZRO=PSOLF,$P(RFLZRO,"^",16) S PSOLF=PSOLF_"^R"
"RTN","PSOORUT1",95,0)
 . S:$P(RFLZRO,"^",18)'="" PSOLRD=$P(RFLZRO,"^",18) I $P(RFLZRO,"^",16) S PSOLRD=PSOLRD_"^R"
"RTN","PSOORUT1",96,0)
 K PSOX
"RTN","PSOORUT1",97,0)
 I '$O(^PSRX(+PSODATA,1,0)),$P(^PSRX(+PSODATA,2),"^",15) S PSOLF=PSOLF_"^R",PSOLRD=PSOLRD_"^R"
"RTN","PSOORUT1",98,0)
 S PSOLF=$S($G(PSOLF):$E(PSOLF,4,5),1:"  ")_"-"_$S($G(PSOLF):$E(PSOLF,6,7),1:"  ")_$S($P(PSOLF,"^",2)="R":"R ",1:"  ")
"RTN","PSOORUT1",99,0)
 S PSOLRD=$S($G(PSOLRD):$E(PSOLRD,4,5),1:"  ")_"-"_$S($G(PSOLRD):$E(PSOLRD,6,7),1:"  ")_$S($P(PSOLRD,"^",2)="R":"R ",1:"  ")
"RTN","PSOORUT1",100,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$S($G(PSORFG):PSOLRD,1:PSOLF)
"RTN","PSOORUT1",101,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$J($P(PSODATA,"^",6),2)_" "_$J($P(PSODATA,"^",8),3)
"RTN","PSOORUT1",102,0)
 I PSODQL>38 S IEN=IEN+1 S ^TMP("PSOPF",$J,IEN,0)=PSOQTL_"Qty: "_$P(^PSRX(+PSODATA,0),"^",7)
"RTN","PSOORUT1",103,0)
 K PSOLNT,PSOQTL,PSOLSP,PSOLRX,PSODQL
"RTN","PSOORUT1",104,0)
 S PSOLST(PSOCNT)="52^"_+PSODATA_"^"_PSOSTA
"RTN","PSOORUT1",105,0)
 K PSODATA,PSOLF S PSOPF=IEN
"RTN","PSOORUT1",106,0)
 Q
"RTN","PSOORUT1",107,0)
 ;
"RTN","PSOORUT1",108,0)
STA N LABEL,LINE,POS
"RTN","PSOORUT1",109,0)
 S LABEL=PSOSTS,IEN=IEN+1
"RTN","PSOORUT1",110,0)
 I PSOSTS="ZNONVA" S LABEL="Non-VA MEDS (Not dispensed by VA)"
"RTN","PSOORUT1",111,0)
 I PSOSTS=" REJECT" S LABEL="REFILL TOO SOON/DUR REJECTS (Third Party)"
"RTN","PSOORUT1",112,0)
 S POS=80-$L(LABEL)/2,$P(LINE,"-",81)="",$E(LINE,POS+1,POS+$L(LABEL))=LABEL
"RTN","PSOORUT1",113,0)
 S ^TMP("PSOPF",$J,IEN,0)=LINE
"RTN","PSOORUT1",114,0)
 Q
"RTN","PSOORUT1",115,0)
PENX S PSOLST(PSOCNT)="52.41^"_$P(PSODATA,"^",10)_"^"_PSOSTA
"RTN","PSOORUT1",116,0)
 K PSODATA,PSOLF,RN,PSOLSP,PSOQTL,PSOLNT
"RTN","PSOORUT1",117,0)
 Q
"RTN","PSOORUT1",118,0)
PEN ;
"RTN","PSOORUT1",119,0)
 N PSOQTL,PSOLNT,PSOLNTZ,PSOQTLX,PSCMOPF,SPACEZ
"RTN","PSOORUT1",120,0)
 Q:'$D(^PS(52.41,$P(PSODATA,"^",10),0))
"RTN","PSOORUT1",121,0)
 S PSCMOPF=0 I $P($G(PSODATA),"^",11),$D(^PSDRUG("AQ",$P(PSODATA,"^",11))) S PSCMOPF=1
"RTN","PSOORUT1",122,0)
 S IEN=IEN+1,^TMP("PSOPF",$J,IEN,0)=$J(PSOCNT,2)_$S($L(PSOCNT)<3:" ",1:"")_$P(PSODRG,"^")
"RTN","PSOORUT1",123,0)
 I $P($G(^PS(52.41,+$P(PSODATA,"^",10),0)),"^",23)=1 S ^TMP("PSOPF",$J,IEN,"RV")=""
"RTN","PSOORUT1",124,0)
 S PSOLNT=$L($P(PSODRG,"^")),PSOLNTZ=$L($P(PSODATA,"^",8))
"RTN","PSOORUT1",125,0)
 S $P(PSOQTLX," ",(11-PSOLNTZ))=" "
"RTN","PSOORUT1",126,0)
 S:PSOLNT<37 $P(PSOQTL," ",(37-PSOLNT))=" "
"RTN","PSOORUT1",127,0)
 I PSOLNT<38 D  G PENX
"RTN","PSOORUT1",128,0)
 .I PSOLNT=37 S PSOQTL=""
"RTN","PSOORUT1",129,0)
 .I $P(^PS(52.41,$P(PSODATA,"^",10),0),"^",3)="RF" S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$G(PSOQTL)_"  Refill Request   Rx #: "_$P(^PSRX($P(^PS(52.41,$P(PSODATA,"^",10),0),"^",19),0),"^") Q
"RTN","PSOORUT1",130,0)
 .S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$G(PSOQTL)_"  "_"QTY: "_$P(PSODATA,"^",8)_$G(PSOQTLX)_" ISDT: "_$S('$P(PSODATA,"^",9):"     ",1:$E($P(PSODATA,"^",9),4,5)_"-"_$E($P(PSODATA,"^",9),6,7))_$S($G(PSCMOPF):"> ",1:"  ")
"RTN","PSOORUT1",131,0)
 .S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_"REF: "_$S($L($P(PSODATA,"^",6))>1:"",1:" ")_$P(PSODATA,"^",6)
"RTN","PSOORUT1",132,0)
 S IEN=IEN+1,$P(SPACEZ," ",42)=" "
"RTN","PSOORUT1",133,0)
 I $P(^PS(52.41,$P(PSODATA,"^",10),0),"^",3)="RF" S ^TMP("PSOPF",$J,IEN,0)=SPACEZ_"Refill Request   Rx #: "_$P(^PSRX($P(^PS(52.41,$P(PSODATA,"^",10),0),"^",19),0),"^") G PENX
"RTN","PSOORUT1",134,0)
 S ^TMP("PSOPF",$J,IEN,0)=SPACEZ_"QTY: "_$P(PSODATA,"^",8)_$G(PSOQTLX)_" ISDT: "_$S('$P(PSODATA,"^",9):"     ",1:$E($P(PSODATA,"^",9),4,5)_"-"_$E($P(PSODATA,"^",9),6,7))_$S($G(PSCMOPF):"> ",1:"  ")_"REF: "_$S($L($P(PSODATA,"^",6))>1:"",1:" ")
"RTN","PSOORUT1",135,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$P(PSODATA,"^",6)
"RTN","PSOORUT1",136,0)
 G PENX
"RTN","PSOORUT1",137,0)
 ;
"RTN","PSOORUT1",138,0)
NVA ; Setting the Non-VA Meds on the Medication Profile Screen (ListMan)
"RTN","PSOORUT1",139,0)
 S IEN=IEN+1,^TMP("PSOPF",$J,IEN,0)="  "_$P(PSODRG,"^")_" "
"RTN","PSOORUT1",140,0)
 I ($L(^TMP("PSOPF",$J,IEN,0))+$L($P(PSODATA,"^",6))>70) S IEN=IEN+1,^TMP("PSOPF",$J,IEN,0)="    "
"RTN","PSOORUT1",141,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$P(PSODATA,"^",6)_" "
"RTN","PSOORUT1",142,0)
 I ($L(^TMP("PSOPF",$J,IEN,0))+$L($P(PSODATA,"^",8))>70) S IEN=IEN+1,^TMP("PSOPF",$J,IEN,0)="    "
"RTN","PSOORUT1",143,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_$P(PSODATA,"^",8)
"RTN","PSOORUT1",144,0)
 I ($L(^TMP("PSOPF",$J,IEN,0))+20)>70 D  Q
"RTN","PSOORUT1",145,0)
 . S IEN=IEN+1,$P(^TMP("PSOPF",$J,IEN,0)," ",51)="Date Documented: "_$E($P(PSODATA,"^",9),4,5)_"/"_$E($P(PSODATA,"^",9),6,7)_"/"_$E($P(PSODATA,"^",9),2,3)
"RTN","PSOORUT1",146,0)
 F I=0:0 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_" " Q:$L(^TMP("PSOPF",$J,IEN,0))>49
"RTN","PSOORUT1",147,0)
 S ^TMP("PSOPF",$J,IEN,0)=^TMP("PSOPF",$J,IEN,0)_"Date Documented: "_$E($P(PSODATA,"^",9),4,5)_"/"_$E($P(PSODATA,"^",9),6,7)_"/"_$E($P(PSODATA,"^",9),2,3)
"RTN","PSOORUT1",148,0)
 Q
"RTN","PSOPMP0")
0^41^B77858526
"RTN","PSOPMP0",1,0)
PSOPMP0 ;BIRM/MFR - Patient Medication Profile - Listmanager ;10/28/06
"RTN","PSOPMP0",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**260,281,303,289**;DEC 1997;Build 107
"RTN","PSOPMP0",3,0)
 ;Reference to EN1^GMRADPT supported by IA #10099
"RTN","PSOPMP0",4,0)
 ;Reference to EN6^GMRVUTL supported by IA #1120
"RTN","PSOPMP0",5,0)
 ;Reference to ^PS(55 supported by DBIA 2228
"RTN","PSOPMP0",6,0)
 ;
"RTN","PSOPMP0",7,0)
EN ;Menu option entry point
"RTN","PSOPMP0",8,0)
 N PSOEXPDC,PSOEXDCE,PSOSRTBY,PSORDER,PSOSIGDP,PSOSTSGP,PSOSTORD,PSORDCNT,PSOSTSEQ,PSORDSEQ,PSOCHNG
"RTN","PSOPMP0",9,0)
 N GRPLN,DIC,Y,DFN,GRPLN,HIGHLN,LASTLINE,VALMCNT
"RTN","PSOPMP0",10,0)
 ;
"RTN","PSOPMP0",11,0)
 ;Division selection
"RTN","PSOPMP0",12,0)
 I '$G(PSOSITE) D ^PSOLSET I '$D(PSOPAR) W $C(7),!!,"Pharmacy Division Must be Selected!",! G EXIT
"RTN","PSOPMP0",13,0)
 ;
"RTN","PSOPMP0",14,0)
 ;Patient selection
"RTN","PSOPMP0",15,0)
 W !! S DIC=2,DIC(0)="QEAM" D ^DIC G EXIT:Y<0  S DFN=+Y
"RTN","PSOPMP0",16,0)
 S PSODFN=DFN D CHKADDR^PSOBAI(DFN,1,1)  ;bad address flag/update
"RTN","PSOPMP0",17,0)
 D LST(PSOSITE,DFN)
"RTN","PSOPMP0",18,0)
 Q
"RTN","PSOPMP0",19,0)
 ;
"RTN","PSOPMP0",20,0)
LST(SITE,PSODFN) ;ListManager entry point
"RTN","PSOPMP0",21,0)
 ; Loading Division/User preferences
"RTN","PSOPMP0",22,0)
 D LOAD^PSOPMPPF(SITE,DUZ)
"RTN","PSOPMP0",23,0)
 W !,"Please wait..."
"RTN","PSOPMP0",24,0)
 D EN^VALM("PSO PMP MAIN")
"RTN","PSOPMP0",25,0)
 D FULL^VALM1
"RTN","PSOPMP0",26,0)
 G EXIT
"RTN","PSOPMP0",27,0)
 ;
"RTN","PSOPMP0",28,0)
HDR      ;Header
"RTN","PSOPMP0",29,0)
 N LINE,POS,LINE1,LINE2,LINE3,LINE4,WT,WTDT,HT,HTDT,VADM,DFN,PNAME,DOB,SEX,X,GMRAL,ADVREA
"RTN","PSOPMP0",30,0)
 K VADM S DFN=PSODFN D DEM^VADPT
"RTN","PSOPMP0",31,0)
 S PNAME=VADM(1)
"RTN","PSOPMP0",32,0)
 S DOB=$S(+VADM(3):$P(VADM(3),"^",2)_" ("_$G(VADM(4))_")",1:"UNKNOWN")
"RTN","PSOPMP0",33,0)
 S SEX=$P(VADM(5),"^",2)
"RTN","PSOPMP0",34,0)
 S (WT,X)="",GMRVSTR="WT" D EN6^GMRVUTL I X'="" S WT=$J($P(X,"^",8)/2.2,6,2),WTDT=$$DAT^PSOPMP1($P(X,"^")\1,"/",1)
"RTN","PSOPMP0",35,0)
 S (HT,X)="",GMRVSTR="HT" D EN6^GMRVUTL I X'="" S HT=$J($P(X,"^",8)*2.54,6,2),HTDT=$$DAT^PSOPMP1($P(X,"^")\1,"/",1)
"RTN","PSOPMP0",36,0)
 S LINE1=PNAME
"RTN","PSOPMP0",37,0)
 S LINE1=$$ALLERGY^PSOPMP1(LINE1,DFN)
"RTN","PSOPMP0",38,0)
 S LINE2="  PID: "_$P(VADM(2),"^",2),$E(LINE2,50)="HEIGHT(cm): "_$S(HT'="":HT_" ("_HTDT_")",1:"NOT AVAILABLE")
"RTN","PSOPMP0",39,0)
 S LINE3="  DOB: "_DOB,$E(LINE3,50)="WEIGHT(kg): "_$S(WT'="":WT_" ("_WTDT_")",1:"NOT AVAILABLE")
"RTN","PSOPMP0",40,0)
 S LINE4="  SEX: "_SEX,$E(LINE4,43)="EXP/CANCEL CUTOFF: "_PSOEXDCE_" DAYS"
"RTN","PSOPMP0",41,0)
 ;
"RTN","PSOPMP0",42,0)
 K VALMHDR S VALMHDR(1)=LINE1,VALMHDR(2)=LINE2,VALMHDR(3)=LINE3,VALMHDR(4)=LINE4
"RTN","PSOPMP0",43,0)
 D SETHDR^PSOPMP1()
"RTN","PSOPMP0",44,0)
 Q
"RTN","PSOPMP0",45,0)
 ;
"RTN","PSOPMP0",46,0)
INIT ;Populates the Body section for ListMan
"RTN","PSOPMP0",47,0)
 K ^TMP("PSOPMP0",$J),^TMP("PSOPMPSR",$J)
"RTN","PSOPMP0",48,0)
 D SETSORT(PSOSRTBY),SETLINE
"RTN","PSOPMP0",49,0)
 S VALMSG="Select the entry # to view or ?? for more actions"
"RTN","PSOPMP0",50,0)
 Q
"RTN","PSOPMP0",51,0)
 ;
"RTN","PSOPMP0",52,0)
SETLINE ;Sets the line to be displayed in ListMan
"RTN","PSOPMP0",53,0)
 N TYPE,STS,SUB,SEQ,LINE,Z,TOTAL,I,X,X1,ORDCNT,LBL,LN,IENSUB,GROUP,GRP,QTYL
"RTN","PSOPMP0",54,0)
 I '$D(^TMP("PSOPMPSR",$J)) D  Q
"RTN","PSOPMP0",55,0)
 . F I=1:1:6 S ^TMP("PSOPMP0",$J,I,0)=""
"RTN","PSOPMP0",56,0)
 . S ^TMP("PSOPMP0",$J,7,0)="                    No prescriptions found for this patient."
"RTN","PSOPMP0",57,0)
 . S VALMCNT=1
"RTN","PSOPMP0",58,0)
 ;
"RTN","PSOPMP0",59,0)
 ;Resetting list to NORMAL video attributes
"RTN","PSOPMP0",60,0)
 F I=1:1:$G(LASTLINE) D RESTORE^VALM10(I)
"RTN","PSOPMP0",61,0)
 K GRPLN,HIGHLN
"RTN","PSOPMP0",62,0)
 ;Building the list (line by line)
"RTN","PSOPMP0",63,0)
 S (GROUP,STS,SUB)="",LINE=0 K ^TMP("PSOPMP0",$J)
"RTN","PSOPMP0",64,0)
 F  S GROUP=$O(^TMP("PSOPMPSR",$J,GROUP)) Q:GROUP=""  D
"RTN","PSOPMP0",65,0)
 . S GRP=$P(GROUP,"^")
"RTN","PSOPMP0",66,0)
 . I GRP'["R"!('PSOSTSGP&($O(^TMP("PSOPMPSR",$J,GROUP),-1)'="")) D
"RTN","PSOPMP0",67,0)
 . . D GROUP^PSOPMP1($P(GROUP,"^",2),+$G(^TMP("PSOPMPSR",$J,GROUP)),.LINE)
"RTN","PSOPMP0",68,0)
 . F  S STS=$O(^TMP("PSOPMPSR",$J,GROUP,STS)) Q:STS=""  D
"RTN","PSOPMP0",69,0)
 . . I STS'="<NULL>" D
"RTN","PSOPMP0",70,0)
 . . . D GROUP^PSOPMP1($P(STS,"^",2),+$G(^TMP("PSOPMPSR",$J,GROUP,STS)),.LINE)
"RTN","PSOPMP0",71,0)
 . . F  S SUB=$O(^TMP("PSOPMPSR",$J,GROUP,STS,SUB),$S(PSORDER="A":1,1:-1)) Q:SUB=""  D
"RTN","PSOPMP0",72,0)
 . . . S Z=$G(^TMP("PSOPMPSR",$J,GROUP,STS,SUB))
"RTN","PSOPMP0",73,0)
 . . . S X1="",SEQ=$G(SEQ)+1,X1=$J(SEQ,3)
"RTN","PSOPMP0",74,0)
 . . . S QTYL=$L($P(Z,"^",4)) S:QTYL<5 QTYL=5
"RTN","PSOPMP0",75,0)
 . . . I GRP["R"!(GRP["T") S $E(X1,5)=$P(Z,"^",2),$E(X1,19)=$E($P(Z,"^",3),1,(32-QTYL))
"RTN","PSOPMP0",76,0)
 . . . I GRP["P"!(GRP["N") S $E(X1,5)=$P(Z,"^",3)
"RTN","PSOPMP0",77,0)
 . . . I GRP["N" S $E(X1,49)="Date Documented:"
"RTN","PSOPMP0",78,0)
 . . . I GRP'["N" S $E(X1,52-QTYL)=$J($P(Z,"^",4),QTYL),$E(X1,53)=$P(Z,"^",5),$E(X1,57)=$P(Z,"^",6)
"RTN","PSOPMP0",79,0)
 . . . S $E(X1,66)=$P(Z,"^",7)
"RTN","PSOPMP0",80,0)
 . . . S $E(X1,74)=$J($P(Z,"^",8),3),$E(X1,78)=$J($P(Z,"^",9),3)
"RTN","PSOPMP0",81,0)
 . . . S LINE=LINE+1,^TMP("PSOPMP0",$J,LINE,0)=X1,HIGHLN(LINE)=""
"RTN","PSOPMP0",82,0)
 . . . S IENSUB=$S(GRP["R"!(GRP["T"):"RX",GRP["P":"PEN",1:"NVA")
"RTN","PSOPMP0",83,0)
 . . . S ^TMP("PSOPMP0",$J,SEQ,IENSUB)=$P(Z,"^")
"RTN","PSOPMP0",84,0)
 . . . I IENSUB="PEN"&($P($G(^PS(52.41,+$P(Z,"^"),0)),"^",23)=1) S ^TMP("PSOPMP0",$J,LINE,"RV")=1
"RTN","PSOPMP0",85,0)
 . . . I $G(PSOSIGDP) D SETSIG^PSOPMP1($S(GRP["R"!(GRP["T"):"R",GRP["P":"P",1:"N"),+Z,.LINE,PSODFN)
"RTN","PSOPMP0",86,0)
 ;
"RTN","PSOPMP0",87,0)
 ;Saving NORMAL video attributes to be reset later
"RTN","PSOPMP0",88,0)
 I LINE>$G(LASTLINE) D
"RTN","PSOPMP0",89,0)
 . F I=($G(LASTLINE)+1):1:LINE D SAVE^VALM10(I)
"RTN","PSOPMP0",90,0)
 . S LASTLINE=LINE
"RTN","PSOPMP0",91,0)
 D VIDEO^PSOPMP1()
"RTN","PSOPMP0",92,0)
 S VALMCNT=+$G(LINE) D RV^PSOPMP1
"RTN","PSOPMP0",93,0)
 Q
"RTN","PSOPMP0",94,0)
 ;
"RTN","PSOPMP0",95,0)
SETSORT(FIELD) ;Sets the data sorted by the FIELD specified
"RTN","PSOPMP0",96,0)
 N SEQ,RX,RXNUM,DRUG,DRNAME,QTY,STATUS,STS,ISSDT,DOCDAT,LSTFD,REFREM,DAYSUP,SIG,Z,ORD,GRPCNT,GROUP,RFRX,OI,PSOBADR
"RTN","PSOPMP0",97,0)
 K ^TMP("PSOPMPSR",$J)
"RTN","PSOPMP0",98,0)
 ;Loading prescription (file #55)
"RTN","PSOPMP0",99,0)
 S SEQ=0
"RTN","PSOPMP0",100,0)
 F  S SEQ=$O(^PS(55,PSODFN,"P",SEQ)) Q:'SEQ  D
"RTN","PSOPMP0",101,0)
 . S RX=+$G(^PS(55,PSODFN,"P",SEQ,0)) I 'RX!($G(^PSRX(RX,0))="") Q
"RTN","PSOPMP0",102,0)
 . I $$FILTER^PSOPMP1(RX) Q
"RTN","PSOPMP0",103,0)
 . S RXNUM=$$GET1^DIQ(52,RX,.01)
"RTN","PSOPMP0",104,0)
 . S DRUG=$$GET1^DIQ(52,RX,6,"I")
"RTN","PSOPMP0",105,0)
 . S DRNAME=$$GET1^DIQ(50,DRUG,.01)
"RTN","PSOPMP0",106,0)
 . S QTY=$$GET1^DIQ(52,RX,7)
"RTN","PSOPMP0",107,0)
 . S STATUS=$$STSINFO^PSOPMP1(RX)
"RTN","PSOPMP0",108,0)
 . S ISSDT=$$ISSDT^PSOPMP1(RX,"R")
"RTN","PSOPMP0",109,0)
 . S LSTFD=$$LSTFD^PSOPMP1(RX)
"RTN","PSOPMP0",110,0)
 . S REFREM=$$REFREM^PSOPMP1(RX)
"RTN","PSOPMP0",111,0)
 . S DAYSUP=$$GET1^DIQ(52,RX,8)
"RTN","PSOPMP0",112,0)
 . S PSOBADR=$O(^PSRX(RX,"L",9999),-1)
"RTN","PSOPMP0",113,0)
 . I PSOBADR'="" S PSOBADR=$G(^PSRX(RX,"L",PSOBADR,0)) I PSOBADR["(BAD ADDRESS)" S PSOBADR="B"
"RTN","PSOPMP0",114,0)
 . I PSOBADR'="B" S PSOBADR=""
"RTN","PSOPMP0",115,0)
 . S Z="",$P(Z,"^")=RX,$P(Z,"^",2)=RXNUM_$$COPAY^PSOPMP1(RX)_$$ECME^PSOBPSUT(RX),$P(Z,"^",3)=$E(DRNAME,1,30)
"RTN","PSOPMP0",116,0)
 . S $P(Z,"^",4)=QTY,$P(Z,"^",5)=$P(STATUS,"^",3)_$$CMOP^PSOPMP1(DRUG,RX)_PSOBADR,$P(Z,"^",6)=$P(ISSDT,"^",2)
"RTN","PSOPMP0",117,0)
 . S $P(Z,"^",7)=$P(LSTFD,"^",2),$P(Z,"^",8)=REFREM,$P(Z,"^",9)=DAYSUP
"RTN","PSOPMP0",118,0)
 . S SORT=$S(FIELD="RX":RXNUM_" ",FIELD="DR":DRNAME_RXNUM,FIELD="ID":+ISSDT_RXNUM_" ",FIELD="LF":+LSTFD_RXNUM_" ")
"RTN","PSOPMP0",119,0)
 . S STS="<NULL>" I $G(PSOSTSGP) S STS=$P(STATUS,"^")_"^"_$P(STATUS,"^",2)
"RTN","PSOPMP0",120,0)
 . S GROUP=$P(PSORDSEQ("R"),"^")_"R^"_$P(PSORDSEQ("R"),"^",2)
"RTN","PSOPMP0",121,0)
 . I $$FIND^PSOREJUT(RX,,,"79,88") S GROUP=$P(PSORDSEQ("T"),"^")_"T^"_$P(PSORDSEQ("T"),"^",2),STS="<NULL>"
"RTN","PSOPMP0",122,0)
 . S ^TMP("PSOPMPSR",$J,GROUP,STS,SORT)=Z
"RTN","PSOPMP0",123,0)
 . S GRPCNT(GROUP)=$G(GRPCNT(GROUP))+1,GRPCNT(GROUP,STS)=$G(GRPCNT(GROUP,STS))+1
"RTN","PSOPMP0",124,0)
 ;
"RTN","PSOPMP0",125,0)
 S GROUP=""
"RTN","PSOPMP0",126,0)
 F  S GROUP=$O(GRPCNT(GROUP)) Q:GROUP=""  D
"RTN","PSOPMP0",127,0)
 . S ^TMP("PSOPMPSR",$J,GROUP)=$G(GRPCNT(GROUP))
"RTN","PSOPMP0",128,0)
 . S STS="" F  S STS=$O(GRPCNT(GROUP,STS)) Q:STS=""  D
"RTN","PSOPMP0",129,0)
 . . S ^TMP("PSOPMPSR",$J,GROUP,STS)=GRPCNT(GROUP,STS)
"RTN","PSOPMP0",130,0)
 ;
"RTN","PSOPMP0",131,0)
 ;Loading pending orders (file #52.41)
"RTN","PSOPMP0",132,0)
 S ORD=0,GROUP=$P(PSORDSEQ("P"),"^")_"P^"_$P(PSORDSEQ("P"),"^",2)
"RTN","PSOPMP0",133,0)
 F  S ORD=$O(^PS(52.41,"P",PSODFN,ORD)) Q:'ORD  D
"RTN","PSOPMP0",134,0)
 . S TYPE=$$GET1^DIQ(52.41,ORD,2,"I")
"RTN","PSOPMP0",135,0)
 . I TYPE="DC"!(TYPE="DE")!(TYPE="HD") Q
"RTN","PSOPMP0",136,0)
 . S DRNAME="",DRUG=+$$GET1^DIQ(52.41,ORD,11,"I") I DRUG S DRNAME=$$GET1^DIQ(50,DRUG,.01)
"RTN","PSOPMP0",137,0)
 . I DRNAME="" D  Q:DRNAME=""
"RTN","PSOPMP0",138,0)
 . . S OI=$$GET1^DIQ(52.41,ORD,8,"I") I 'OI Q
"RTN","PSOPMP0",139,0)
 . . S DRNAME=$$GET1^DIQ(50.7,OI,.01)_" "_$$GET1^DIQ(50.7,OI,.02)
"RTN","PSOPMP0",140,0)
 . S QTY=$$GET1^DIQ(52.41,ORD,12)
"RTN","PSOPMP0",141,0)
 . S STATUS=$$GET1^DIQ(52.41,ORD,2,"I")
"RTN","PSOPMP0",142,0)
 . S ISSDT=$$ISSDT^PSOPMP1(ORD,"P")
"RTN","PSOPMP0",143,0)
 . S REFREM=$$GET1^DIQ(52.41,ORD,13)
"RTN","PSOPMP0",144,0)
 . S DAYSUP=$$GET1^DIQ(52.41,ORD,101)
"RTN","PSOPMP0",145,0)
 . S RFRX="" I STATUS="RF" S RFRX=$$GET1^DIQ(52.41,ORD,21,"I") I RFRX S RFRX=$$GET1^DIQ(52,RFRX,.01)
"RTN","PSOPMP0",146,0)
 . S Z="",$P(Z,"^")=ORD,$P(Z,"^",3)=$E(DRNAME,1,45),$P(Z,"^",4)=QTY,$P(Z,"^",5)=$E(STATUS,1,2)_$$CMOP^PSOPMP1(DRUG)
"RTN","PSOPMP0",147,0)
 . S $P(Z,"^",6)=$S(RFRX'="":"Rx#: "_RFRX,1:$P(ISSDT,"^",2)),$P(Z,"^",8)=REFREM,$P(Z,"^",9)=DAYSUP
"RTN","PSOPMP0",148,0)
 . S SORT=$S(FIELD="RX":DRNAME_ORD,FIELD="DR":DRNAME_ORD,FIELD="ID":+ISSDT_ORD,FIELD="LF":+ISSDT_ORD)
"RTN","PSOPMP0",149,0)
 . S ^TMP("PSOPMPSR",$J,GROUP,"<NULL>",SORT)=Z
"RTN","PSOPMP0",150,0)
 . S GRPCNT(GROUP)=$G(GRPCNT(GROUP))+1
"RTN","PSOPMP0",151,0)
 S:$G(GRPCNT(GROUP)) ^TMP("PSOPMPSR",$J,GROUP)=$G(GRPCNT(GROUP))
"RTN","PSOPMP0",152,0)
 ;
"RTN","PSOPMP0",153,0)
 ;Loading Non-VA Med orders (file #55, sub-file #55.05)
"RTN","PSOPMP0",154,0)
 S ORD=0,GROUP=$P(PSORDSEQ("N"),"^")_"N^"_$P(PSORDSEQ("N"),"^",2)
"RTN","PSOPMP0",155,0)
 F  S ORD=$O(^PS(55,PSODFN,"NVA",ORD)) Q:'ORD  D
"RTN","PSOPMP0",156,0)
 . I $$GET1^DIQ(55.05,ORD_","_PSODFN,5,"I") Q
"RTN","PSOPMP0",157,0)
 . S DRNAME=$$GET1^DIQ(55.05,ORD_","_PSODFN,1)
"RTN","PSOPMP0",158,0)
 . I DRNAME="" D  Q:DRNAME=""
"RTN","PSOPMP0",159,0)
 . . S OI=$$GET1^DIQ(55.05,ORD_","_PSODFN,.01,"I") I 'OI Q
"RTN","PSOPMP0",160,0)
 . . S DRNAME=$$GET1^DIQ(50.7,OI,.01)_" "_$$GET1^DIQ(50.7,OI,.02)
"RTN","PSOPMP0",161,0)
 . S DOCDAT=$P($$GET1^DIQ(55.05,ORD_","_PSODFN_",",11,"I"),".")
"RTN","PSOPMP0",162,0)
 . S Z="",$P(Z,"^")=ORD,$P(Z,"^",3)=$E(DRNAME,1,38),$P(Z,"^",7)=$$DAT^PSOPMP1(DOCDAT,"-")
"RTN","PSOPMP0",163,0)
 . S SORT=$S(FIELD="RX":DRNAME_ORD,FIELD="DR":DRNAME_ORD,FIELD="ID":DOCDAT_ORD,FIELD="LF":DOCDAT_ORD)
"RTN","PSOPMP0",164,0)
 . S ^TMP("PSOPMPSR",$J,GROUP,"<NULL>",SORT)=Z
"RTN","PSOPMP0",165,0)
 . S GRPCNT(GROUP)=$G(GRPCNT(GROUP))+1
"RTN","PSOPMP0",166,0)
 ;
"RTN","PSOPMP0",167,0)
 S:$G(GRPCNT(GROUP)) ^TMP("PSOPMPSR",$J,GROUP)=$G(GRPCNT(GROUP))
"RTN","PSOPMP0",168,0)
 Q
"RTN","PSOPMP0",169,0)
 ;
"RTN","PSOPMP0",170,0)
RX ;Sort by Rx
"RTN","PSOPMP0",171,0)
 D SORT("RX")
"RTN","PSOPMP0",172,0)
 Q
"RTN","PSOPMP0",173,0)
DR ;Sort by Drug
"RTN","PSOPMP0",174,0)
 D SORT("DR")
"RTN","PSOPMP0",175,0)
 Q
"RTN","PSOPMP0",176,0)
ID ;Sort by Issue Date
"RTN","PSOPMP0",177,0)
 D SORT("ID")
"RTN","PSOPMP0",178,0)
 Q
"RTN","PSOPMP0",179,0)
LF ;Sort by Last Fill Date
"RTN","PSOPMP0",180,0)
 D SORT("LF")
"RTN","PSOPMP0",181,0)
 Q
"RTN","PSOPMP0",182,0)
 ;
"RTN","PSOPMP0",183,0)
SORT(FIELD) ;Sort entries by FIELD
"RTN","PSOPMP0",184,0)
 I PSOSRTBY=FIELD S PSORDER=$S(PSORDER="A":"D",1:"A")
"RTN","PSOPMP0",185,0)
 E  S PSOSRTBY=FIELD,PSORDER="A"
"RTN","PSOPMP0",186,0)
 D REF
"RTN","PSOPMP0",187,0)
 Q
"RTN","PSOPMP0",188,0)
 ;
"RTN","PSOPMP0",189,0)
REF ;Screen Refresh
"RTN","PSOPMP0",190,0)
 W ?52,"Please wait..." D INIT,HDR S VALMBCK="R"
"RTN","PSOPMP0",191,0)
 Q
"RTN","PSOPMP0",192,0)
GS ;Group by Status
"RTN","PSOPMP0",193,0)
 W ?52,"Please wait..." S PSOSTSGP=$S($G(PSOSTSGP):0,1:1) D INIT,HDR S VALMBCK="R"
"RTN","PSOPMP0",194,0)
 Q
"RTN","PSOPMP0",195,0)
SIG ;Display SIG
"RTN","PSOPMP0",196,0)
 W ?52,"Please wait..." S PSOSIGDP=$S($G(PSOSIGDP):0,1:1) D INIT,HDR S VALMBCK="R"
"RTN","PSOPMP0",197,0)
 I 'PSOSIGDP S VALMBG=VALMBG\2
"RTN","PSOPMP0",198,0)
 I PSOSIGDP S VALMBG=VALMBG*2-1
"RTN","PSOPMP0",199,0)
 S:VALMBG>(VALMCNT-10) VALMBG=VALMCNT-10 S:VALMBG<1 VALMBG=1
"RTN","PSOPMP0",200,0)
 Q
"RTN","PSOPMP0",201,0)
PI ;Patient Information
"RTN","PSOPMP0",202,0)
 D EN^PSOLMPI S VALMBCK="R"
"RTN","PSOPMP0",203,0)
 Q
"RTN","PSOPMP0",204,0)
CV ;Change View
"RTN","PSOPMP0",205,0)
 D LST^PSOPMPPF(SITE,DUZ) W !?52,"Please wait..." D INIT,HDR
"RTN","PSOPMP0",206,0)
 S VALMBG=1,VALMBCK="R"
"RTN","PSOPMP0",207,0)
 Q
"RTN","PSOPMP0",208,0)
 ;
"RTN","PSOPMP0",209,0)
SEL ;Process selection of one entry
"RTN","PSOPMP0",210,0)
 N PSOSEL,TYPE,XQORM,ORD,TITLE
"RTN","PSOPMP0",211,0)
 S PSOSEL=+$P($P(Y(1),"^",4),"=",2) I 'PSOSEL S VALMSG="Invalid selection!",VALMBCK="R" Q
"RTN","PSOPMP0",212,0)
 S TYPE=$O(^TMP("PSOPMP0",$J,PSOSEL,0)) I TYPE="" S VALMSG="Invalid selection!",VALMBCK="R" Q
"RTN","PSOPMP0",213,0)
 S ORD=$G(^TMP("PSOPMP0",$J,PSOSEL,TYPE))
"RTN","PSOPMP0",214,0)
 I 'ORD S VALMSG="Invalid selection!",VALMBCK="R" Q
"RTN","PSOPMP0",215,0)
 S TITLE=VALM("TITLE")
"RTN","PSOPMP0",216,0)
 ;
"RTN","PSOPMP0",217,0)
 ;Regular prescription
"RTN","PSOPMP0",218,0)
 I TYPE="RX" D  S VALMBCK="R" D REF
"RTN","PSOPMP0",219,0)
 . N PSOVDA,PSOSAVE,DA,PS
"RTN","PSOPMP0",220,0)
 . S (PSOVDA,DA)=ORD,PS="REJECTMP"
"RTN","PSOPMP0",221,0)
 . N LINE,TITLE,PSODFN D DP^PSORXVW
"RTN","PSOPMP0",222,0)
 ;
"RTN","PSOPMP0",223,0)
 ;Pending Order
"RTN","PSOPMP0",224,0)
 I TYPE="PEN" D  S VALMBCK="R" D REF
"RTN","PSOPMP0",225,0)
 . N PSOACTOV,OR0
"RTN","PSOPMP0",226,0)
 . S OR0=^PS(52.41,ORD,0),PSOACTOV=""
"RTN","PSOPMP0",227,0)
 . N LINE,TITLE D PENHDR^PSOPMP1(PSODFN),DSPL^PSOORFI1
"RTN","PSOPMP0",228,0)
 ;
"RTN","PSOPMP0",229,0)
 ;Pending Order
"RTN","PSOPMP0",230,0)
 I TYPE="NVA" D
"RTN","PSOPMP0",231,0)
 . N LINE,TITLE D EN^PSONVAVW(PSODFN,ORD)
"RTN","PSOPMP0",232,0)
 ;
"RTN","PSOPMP0",233,0)
 S VALMBCK="R",VALM("TITLE")=TITLE
"RTN","PSOPMP0",234,0)
 Q
"RTN","PSOPMP0",235,0)
 ;
"RTN","PSOPMP0",236,0)
EXIT ;
"RTN","PSOPMP0",237,0)
 K ^TMP("PSOPMP0",$J),^TMP("PSOPMPSR",$J)
"RTN","PSOPMP0",238,0)
 Q
"RTN","PSOPMP0",239,0)
 ;
"RTN","PSOPMP0",240,0)
HELP Q
"RTN","PSOPMP1")
0^39^B29347601
"RTN","PSOPMP1",1,0)
PSOPMP1 ;BIRM/MFR - Patient Medication Profile - Listmanager ;04/28/05
"RTN","PSOPMP1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**260,285,281,303,289**;DEC 1997;Build 107
"RTN","PSOPMP1",3,0)
 ;Reference to ^PSDRUG("AQ" supported by IA 3165
"RTN","PSOPMP1",4,0)
 ;Reference to EN1^GMRADPT supported by IA 10099
"RTN","PSOPMP1",5,0)
 ;Reference to ^PSXOPUTL supported by IA 2200
"RTN","PSOPMP1",6,0)
 ;
"RTN","PSOPMP1",7,0)
VIDEO() ; - Changes the Video Attributes for the list
"RTN","PSOPMP1",8,0)
 ;
"RTN","PSOPMP1",9,0)
 ; - Highlighting the PRESCRIPTION line if SIG is displayed
"RTN","PSOPMP1",10,0)
 I $G(PSOSIGDP) D
"RTN","PSOPMP1",11,0)
 . F I=1:1:LINE D
"RTN","PSOPMP1",12,0)
 . . I $D(HIGHLN(I)) D CNTRL^VALM10(I,1,80,IOINHI,IOINORM)
"RTN","PSOPMP1",13,0)
 ;
"RTN","PSOPMP1",14,0)
 ; - Highlighting the group lines (order type and status)
"RTN","PSOPMP1",15,0)
 I $D(GRPLN) D
"RTN","PSOPMP1",16,0)
 . S LN=0 F I=1:1 S LN=$O(GRPLN(LN)) Q:'LN  D
"RTN","PSOPMP1",17,0)
 . . S LBL=GRPLN(LN),POS=41-($L(LBL)\2)
"RTN","PSOPMP1",18,0)
 . . D CNTRL^VALM10(LN,1,POS-1,IOUON_IOINHI,IOINORM)
"RTN","PSOPMP1",19,0)
 . . D CNTRL^VALM10(LN,POS,$L(LBL),IORVON_IOINHI,IORVOFF_IOINORM)
"RTN","PSOPMP1",20,0)
 . . D CNTRL^VALM10(LN,POS+$L(LBL),81-POS-$L(LBL),IOUON_IOINHI,IOINORM)
"RTN","PSOPMP1",21,0)
 Q
"RTN","PSOPMP1",22,0)
 ;
"RTN","PSOPMP1",23,0)
RV ;reverse video for flagged pending orders
"RTN","PSOPMP1",24,0)
 N PSLIST S PSLIST=0 F PSLIST=1:1:VALMCNT D
"RTN","PSOPMP1",25,0)
 .Q:'$D(^TMP("PSOPMP0",$J,PSLIST,"RV"))
"RTN","PSOPMP1",26,0)
 .I $D(^TMP("PSOPMP0",$J,PSLIST,"RV")) D CNTRL^VALM10(PSLIST,1,3,IORVON,IORVOFF,0) Q
"RTN","PSOPMP1",27,0)
 Q
"RTN","PSOPMP1",28,0)
 ;
"RTN","PSOPMP1",29,0)
SETHDR() ; - Displays the Header Line
"RTN","PSOPMP1",30,0)
 N HDR,ORD,POS
"RTN","PSOPMP1",31,0)
 ;
"RTN","PSOPMP1",32,0)
 ; - Line 1
"RTN","PSOPMP1",33,0)
 S $E(HDR,57)="ISSUE",$E(HDR,66)="LAST",$E(HDR,74)="REF",$E(HDR,78)="DAY"
"RTN","PSOPMP1",34,0)
 S $E(HDR,81)="" D INSTR^VALM1(IORVON_HDR_IOINORM,1,6)
"RTN","PSOPMP1",35,0)
 ; - Line 2
"RTN","PSOPMP1",36,0)
 S HDR="  #",$E(HDR,5)="Rx#",$E(HDR,19)="DRUG",$E(HDR,49)="QTY",$E(HDR,53)="ST"
"RTN","PSOPMP1",37,0)
 S $E(HDR,57)="DATE",$E(HDR,66)="FILL",$E(HDR,74)="REM",$E(HDR,78)="SUP"
"RTN","PSOPMP1",38,0)
 S $E(HDR,81)="" D INSTR^VALM1(IORVON_HDR_IOINORM,1,7)
"RTN","PSOPMP1",39,0)
 S ORD=$S(PSORDER="A":"[^]",1:"[v]")
"RTN","PSOPMP1",40,0)
 S:PSOSRTBY="RX" POS=9 S:PSOSRTBY="DR" POS=24 S:PSOSRTBY="ID" POS=61 S:PSOSRTBY="LF" POS=70
"RTN","PSOPMP1",41,0)
 D INSTR^VALM1(IOINHI_IORVON_ORD_IOINORM,POS,7)
"RTN","PSOPMP1",42,0)
 Q
"RTN","PSOPMP1",43,0)
 ;
"RTN","PSOPMP1",44,0)
SETSIG(TYPE,RX,LINE,DFN) ; Set the SIG line
"RTN","PSOPMP1",45,0)
 N FSIG,L,X,DIWL,DIWR
"RTN","PSOPMP1",46,0)
 ;
"RTN","PSOPMP1",47,0)
 I TYPE="N" D  Q
"RTN","PSOPMP1",48,0)
 . K ^UTILITY($J,"W")
"RTN","PSOPMP1",49,0)
 . S X=$$SCHED^PSONVNEW($$GET1^DIQ(55.05,RX_","_DFN,4)),DIWL=1,DIWR=71 D ^DIWP
"RTN","PSOPMP1",50,0)
 . F L=1:1 Q:'$D(^UTILITY($J,"W",1,L))  D
"RTN","PSOPMP1",51,0)
 . . S X="" S:L=1 $E(X,5)="SIG:" S $E(X,10)=^UTILITY($J,"W",1,L,0)
"RTN","PSOPMP1",52,0)
 . . S LINE=LINE+1,^TMP("PSOPMP0",$J,LINE,0)=X
"RTN","PSOPMP1",53,0)
 ;
"RTN","PSOPMP1",54,0)
 D FSIG^PSOUTLA(TYPE,+RX,71)
"RTN","PSOPMP1",55,0)
 F L=1:1 Q:'$D(FSIG(L))  D
"RTN","PSOPMP1",56,0)
 . S X="" S:L=1 $E(X,5)="SIG:" S $E(X,10)=FSIG(L)
"RTN","PSOPMP1",57,0)
 . S LINE=LINE+1,^TMP("PSOPMP0",$J,LINE,0)=X
"RTN","PSOPMP1",58,0)
 Q
"RTN","PSOPMP1",59,0)
 ;
"RTN","PSOPMP1",60,0)
GROUP(LBL,CNT,LINE) ; Sets a group delimiter line
"RTN","PSOPMP1",61,0)
 N X,POS
"RTN","PSOPMP1",62,0)
 S LBL=LBL_$S(PSORDCNT:" ("_CNT_" order"_$S(CNT>1:"s",1:"")_")",1:"")
"RTN","PSOPMP1",63,0)
 S POS=41-($L(LBL)\2)
"RTN","PSOPMP1",64,0)
 S X="",$P(X," ",81)="",$E(X,POS,POS-1+$L(LBL))=LBL
"RTN","PSOPMP1",65,0)
 S LINE=LINE+1,^TMP("PSOPMP0",$J,LINE,0)=X,GRPLN(LINE)=LBL
"RTN","PSOPMP1",66,0)
 Q
"RTN","PSOPMP1",67,0)
 ;
"RTN","PSOPMP1",68,0)
PENHDR(DFN) ; Sets the Header in the ^TMP("PSOHDR",$J) global for displaying individual Pending Order
"RTN","PSOPMP1",69,0)
 N VADM,WT,HT,PSOERR,GMRA
"RTN","PSOPMP1",70,0)
 K ^TMP("PSOHDR",$J) D ^VADPT,ADD^VADPT
"RTN","PSOPMP1",71,0)
 S ^TMP("PSOHDR",$J,1,0)=VADM(1),^TMP("PSOHDR",$J,2,0)=$P(VADM(2),"^",2)
"RTN","PSOPMP1",72,0)
 S ^TMP("PSOHDR",$J,3,0)=$P(VADM(3),"^",2),^TMP("PSOHDR",$J,4,0)=VADM(4),^TMP("PSOHDR",$J,5,0)=$P(VADM(5),"^",2)
"RTN","PSOPMP1",73,0)
 S POERR=1 D RE^PSODEM K PSOERR
"RTN","PSOPMP1",74,0)
 S ^TMP("PSOHDR",$J,6,0)=$S(+$P(WT,"^",8):$J($P(WT,"^",9),6)_" ("_$P(WT,"^")_")",1:"_______ (______)")
"RTN","PSOPMP1",75,0)
 S ^TMP("PSOHDR",$J,7,0)=$S($P(HT,"^",8):$J($P(HT,"^",9),6)_" ("_$P(HT,"^")_")",1:"_______ (______)") K VM,WT,HT S PSOHD=7
"RTN","PSOPMP1",76,0)
 S GMRA="0^0^111" D EN1^GMRADPT S ^TMP("PSOHDR",$J,8,0)=+$G(GMRAL)
"RTN","PSOPMP1",77,0)
 Q
"RTN","PSOPMP1",78,0)
 ;
"RTN","PSOPMP1",79,0)
FILTER(RX) ; - Filter Rx's that should not be displayed
"RTN","PSOPMP1",80,0)
 I $$GET1^DIQ(52,RX,26,"I")<PSOEXPDC Q 1
"RTN","PSOPMP1",81,0)
 I $$GET1^DIQ(52,RX,26.1,"I"),$$GET1^DIQ(52,RX,26.1,"I")<PSOEXPDC,$$GET1^DIQ(52,RX,100,"I")>11,$$GET1^DIQ(52,RX,100,"I")'=16 Q 1
"RTN","PSOPMP1",82,0)
 I $$GET1^DIQ(52,RX,100,"I")=""!($$GET1^DIQ(52,RX,100,"I")=13) Q 1
"RTN","PSOPMP1",83,0)
 I $$GET1^DIQ(52,RX,.01)="" Q 1
"RTN","PSOPMP1",84,0)
 Q 0
"RTN","PSOPMP1",85,0)
 ;
"RTN","PSOPMP1",86,0)
STSINFO(RX) ; Returns the Rx Status MNEMONIC^NAME
"RTN","PSOPMP1",87,0)
 ; Input: RX - Prescription IEN (#52)
"RTN","PSOPMP1",88,0)
 ;Output: Status Mnemonic ("A","DC",etc.)^Status Name ("ACTIVE","DISCONTINUED",etc.)
"RTN","PSOPMP1",89,0)
 ;
"RTN","PSOPMP1",90,0)
 N STS
"RTN","PSOPMP1",91,0)
 I '$D(^PSRX(RX,"STA")) Q ""
"RTN","PSOPMP1",92,0)
 S STS=$$GET1^DIQ(52,RX,100,"I")
"RTN","PSOPMP1",93,0)
 I STS=0 Q:$$GET1^DIQ(52,RX,26,"I")>DT PSOSTSEQ("A") Q PSOSTSEQ("E")
"RTN","PSOPMP1",94,0)
 I STS=1 Q PSOSTSEQ("N")
"RTN","PSOPMP1",95,0)
 I STS=3 Q PSOSTSEQ("H")
"RTN","PSOPMP1",96,0)
 I STS=5 Q PSOSTSEQ("S")
"RTN","PSOPMP1",97,0)
 I STS=11 Q PSOSTSEQ("E")
"RTN","PSOPMP1",98,0)
 I STS=12 Q PSOSTSEQ("DC")
"RTN","PSOPMP1",99,0)
 I STS=14 Q PSOSTSEQ("DP")
"RTN","PSOPMP1",100,0)
 I STS=15 Q PSOSTSEQ("DE")
"RTN","PSOPMP1",101,0)
 I STS=16 Q PSOSTSEQ("PH")
"RTN","PSOPMP1",102,0)
 Q "99^UNKNOWN^??"
"RTN","PSOPMP1",103,0)
 ; 
"RTN","PSOPMP1",104,0)
ISSDT(IEN,TYPE) ; Returns the Rx ISSUE DATE formatted MM-DD-YY
"RTN","PSOPMP1",105,0)
 ;Input: RX   - Prescription IEN (#52)
"RTN","PSOPMP1",106,0)
 ;       TYPE - "R":Regular Rx, "P":Pending order
"RTN","PSOPMP1",107,0)
 N ISSDT
"RTN","PSOPMP1",108,0)
 I TYPE="R" S ISSDT=$$GET1^DIQ(52,IEN,1,"I")
"RTN","PSOPMP1",109,0)
 I TYPE="P" S ISSDT=$$GET1^DIQ(52.41,IEN,6,"I")
"RTN","PSOPMP1",110,0)
 I ISSDT'="" S ISSDT=ISSDT\1
"RTN","PSOPMP1",111,0)
 ;
"RTN","PSOPMP1",112,0)
 Q (ISSDT_"^"_$$DAT(ISSDT,"-"))
"RTN","PSOPMP1",113,0)
 ;
"RTN","PSOPMP1",114,0)
LSTFD(RX) ; Returns the Rx LAST FILL DATE formatted MM-DD-YY[R], where [R] = Returned to Stock
"RTN","PSOPMP1",115,0)
 ;Input: RX  - Prescription IEN (#52)
"RTN","PSOPMP1",116,0)
 N LSTFD,RTSTK,RFL
"RTN","PSOPMP1",117,0)
 S LSTFD=$$GET1^DIQ(52,RX,101,"I")\1 I LSTFD="" Q ""
"RTN","PSOPMP1",118,0)
 I '$$LSTRFL^PSOBPSU1(RX) D
"RTN","PSOPMP1",119,0)
 . I $$GET1^DIQ(52,RX,32.1,"I") S RTSTK="R"
"RTN","PSOPMP1",120,0)
 E  S RFL=0 F  S RFL=$O(^PSRX(RX,1,RFL)) Q:'RFL  D
"RTN","PSOPMP1",121,0)
 . I $$RXFLDT^PSOBPSUT(RX,RFL)'=LSTFD Q
"RTN","PSOPMP1",122,0)
 . I $$GET1^DIQ(52.1,RFL_","_RX,14,"I") S RTSTK="R"
"RTN","PSOPMP1",123,0)
 ;
"RTN","PSOPMP1",124,0)
 Q (LSTFD_"^"_$$DAT(LSTFD,"-")_$G(RTSTK))
"RTN","PSOPMP1",125,0)
 ;
"RTN","PSOPMP1",126,0)
REFREM(RX) ; - Returns the number of refills remaining
"RTN","PSOPMP1",127,0)
 N REFREM,RFL
"RTN","PSOPMP1",128,0)
 S REFREM=+$$GET1^DIQ(52,RX,9)
"RTN","PSOPMP1",129,0)
 F RFL=0:1 S RFL=$O(^PSRX(RX,1,RFL)) Q:'RFL  S REFREM=REFREM-1
"RTN","PSOPMP1",130,0)
 Q $S(REFREM<0:0,1:REFREM)
"RTN","PSOPMP1",131,0)
 ;
"RTN","PSOPMP1",132,0)
 ;
"RTN","PSOPMP1",133,0)
DAT(FMDT,SEP,Y4) ; - Formats FM dates to MM/DD/YY (SEP: Separator:"/","-",etc...)
"RTN","PSOPMP1",134,0)
 ;Input: (r) FMDT - Fileman Date
"RTN","PSOPMP1",135,0)
 ;       (r) SEP  - Separator
"RTN","PSOPMP1",136,0)
 ;       (o) Y4   - 4 digits year flag
"RTN","PSOPMP1",137,0)
 I $G(FMDT)="" Q ""
"RTN","PSOPMP1",138,0)
 I '$E(FMDT,6,7)!'$E(FMDT,4,7) Q $$UP^XLFSTR($TR($$FMTE^XLFDT(FMDT)," ","-"))
"RTN","PSOPMP1",139,0)
 Q ($E(FMDT,4,5)_SEP_$E(FMDT,6,7)_SEP_$S($G(Y4):$E(FMDT,1,3)+1700,1:$E(FMDT,2,3)))
"RTN","PSOPMP1",140,0)
 ;
"RTN","PSOPMP1",141,0)
COPAY(RX) ; Returns "$" is Rx has a copay and "" if not
"RTN","PSOPMP1",142,0)
 Q $S($D(^PSRX(RX,"IB")):"$",1:"")
"RTN","PSOPMP1",143,0)
 ;
"RTN","PSOPMP1",144,0)
CMOP(DRUG,RX) ; Returns the CMOP indicator (">", "T", etc)
"RTN","PSOPMP1",145,0)
 N CMOP,X,DA,PSXZ
"RTN","PSOPMP1",146,0)
 S CMOP="" I $D(^PSDRUG("AQ",DRUG)) S CMOP=">"
"RTN","PSOPMP1",147,0)
 I $G(RX) S DA=RX D ^PSXOPUTL I $G(PSXZ(PSXZ("L")))=0!($G(PSXZ(PSXZ("L")))=2) S CMOP="T"
"RTN","PSOPMP1",148,0)
 Q CMOP
"RTN","PSOPMP1",149,0)
 ;
"RTN","PSOPMP1",150,0)
ALLERGY(LINE,DFN,POS) ; also called from PSONVAVW & PSOPMP0
"RTN","PSOPMP1",151,0)
 ; Input:  LINE - (r) text to concatenate allergy information to
"RTN","PSOPMP1",152,0)
 ;         DFN - (r) patient IEN used for ^GMRADTP
"RTN","PSOPMP1",153,0)
 ;         POS - (o) position # to include text
"RTN","PSOPMP1",154,0)
 ;Output: LINE - modified text
"RTN","PSOPMP1",155,0)
 N ALLERGY,PSONOAL
"RTN","PSOPMP1",156,0)
 S (PSONOAL,ALLERGY)=""
"RTN","PSOPMP1",157,0)
 D EN1^GMRADPT
"RTN","PSOPMP1",158,0)
 I GMRAL S ALLERGY="<A>"
"RTN","PSOPMP1",159,0)
 E  D ALLERGY^PSOORUT2 I PSONOAL'="" S ALLERGY="<NO ALLERGY ASSESSMENT>"
"RTN","PSOPMP1",160,0)
 S ALLERGY=IORVON_ALLERGY_IORVOFF_IOINORM
"RTN","PSOPMP1",161,0)
 I '$G(POS) S POS=80-$L(ALLERGY)
"RTN","PSOPMP1",162,0)
 S LINE=$$SETSTR^VALM1(ALLERGY,LINE,POS,80)
"RTN","PSOPMP1",163,0)
 Q LINE
"RTN","PSOREJP0")
0^12^B74165131
"RTN","PSOREJP0",1,0)
PSOREJP0 ;BIRM/MFR - Third Party Rejects Processing Screen ;04/28/05
"RTN","PSOREJP0",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**148,260,287,289**;DEC 1997;Build 107
"RTN","PSOREJP0",3,0)
 ;
"RTN","PSOREJP0",4,0)
 N PSOREJST,PSORJSRT,PSORJASC,PSOSTFLT,PSODRFLT,PSOPTFLT,PSORXFLT,PSOINFLT,PSOINGRP,PSOTRITG
"RTN","PSOREJP0",5,0)
 N INSLN,HIGHLN,LASTLN,PSOEKEY
"RTN","PSOREJP0",6,0)
 ;
"RTN","PSOREJP0",7,0)
 ; - Division/Site selection
"RTN","PSOREJP0",8,0)
 D SEL^PSOREJU1("DIVISION","^PS(59,",.PSOREJST,$$GET1^DIQ(59,+$G(PSOSITE),.01)) I $G(PSOREJST)="^" G EXIT
"RTN","PSOREJP0",9,0)
 ;
"RTN","PSOREJP0",10,0)
 ; - Initializing global variables
"RTN","PSOREJP0",11,0)
 S PSORJSRT="PA",PSORJASC=1,PSOSTFLT="U",(PSODRFLT,PSOPTFLT,PSORXFLT,PSOINFLT)="ALL"
"RTN","PSOREJP0",12,0)
 S PSOINGRP=0,PSOTRITG=1
"RTN","PSOREJP0",13,0)
 ;
"RTN","PSOREJP0",14,0)
 D LST("W")
"RTN","PSOREJP0",15,0)
 G EXIT
"RTN","PSOREJP0",16,0)
 ;
"RTN","PSOREJP0",17,0)
LST(PSOMENU) ; - Invokes Listmanager
"RTN","PSOREJP0",18,0)
 W !,"Please wait..."
"RTN","PSOREJP0",19,0)
 I PSOMENU="W" D EN^VALM("PSO REJECTS WORKLIST")
"RTN","PSOREJP0",20,0)
 I PSOMENU="VP" D EN^VALM("PSO REJECTS VIEW/PROCESS")
"RTN","PSOREJP0",21,0)
 D FULL^VALM1
"RTN","PSOREJP0",22,0)
 Q
"RTN","PSOREJP0",23,0)
 ;
"RTN","PSOREJP0",24,0)
HDR      ; - Header code
"RTN","PSOREJP0",25,0)
 N LINE1,LINE2,LINE3
"RTN","PSOREJP0",26,0)
 S LINE1=$$SITES() I $L(LINE1)>80 S $E(LINE1,78,999)="..."
"RTN","PSOREJP0",27,0)
 ;
"RTN","PSOREJP0",28,0)
 S LINE2="Selection : ALL "_$S(PSOSTFLT="U":"UNRESOLVED ",PSOSTFLT="R":"RESOLVED ",1:"")_"REJECTS"
"RTN","PSOREJP0",29,0)
 I $G(PSOPTFLT)'="ALL" S LINE2=LINE2_" FOR "_$$NAME("P")
"RTN","PSOREJP0",30,0)
 I $G(PSODRFLT)'="ALL" S LINE2=LINE2_" FOR "_$$NAME("D")
"RTN","PSOREJP0",31,0)
 I $G(PSOINFLT)'="ALL" S LINE2=LINE2_" FOR "_$$NAME("I")
"RTN","PSOREJP0",32,0)
 I $G(PSOINGRP) S LINE2=LINE2_" GROUPED BY INSURANCE"
"RTN","PSOREJP0",33,0)
 S VALMHDR(1)=LINE1,VALMHDR(2)=LINE2
"RTN","PSOREJP0",34,0)
 I PSOMENU="VP" D
"RTN","PSOREJP0",35,0)
 . I $G(PSORXFLT) S LINE3="Rx#       : "_$$NAME("R")
"RTN","PSOREJP0",36,0)
 . E  D
"RTN","PSOREJP0",37,0)
 . . S LINE3="Date Range: "_$$FMTE^XLFDT(+PSODTRNG,2)
"RTN","PSOREJP0",38,0)
 . . I +PSODTRNG'=$P(PSODTRNG,"^",2) S LINE3=LINE3_" THRU "_$$FMTE^XLFDT($P(PSODTRNG,"^",2),2)
"RTN","PSOREJP0",39,0)
 . S VALMHDR(3)=LINE3
"RTN","PSOREJP0",40,0)
 ;
"RTN","PSOREJP0",41,0)
 D SETHDR()
"RTN","PSOREJP0",42,0)
 Q
"RTN","PSOREJP0",43,0)
 ;
"RTN","PSOREJP0",44,0)
SETHDR() ; - Displays the Header Line
"RTN","PSOREJP0",45,0)
 N HDR,ORD
"RTN","PSOREJP0",46,0)
 ;
"RTN","PSOREJP0",47,0)
 S HDR="  #",$E(HDR,5)="Rx#",$E(HDR,18)="PATIENT(ID)",$E(HDR,43)="DRUG",$E(HDR,64)="REASON"
"RTN","PSOREJP0",48,0)
 S $E(HDR,81)="" D INSTR^VALM1(IORVON_HDR_IOINORM,1,$S(PSOMENU="W":4,1:5))
"RTN","PSOREJP0",49,0)
 S ORD=$S(PSORJASC=1:"[^]",1:"[v]")
"RTN","PSOREJP0",50,0)
 S:PSORJSRT="RX" POS=9 S:PSORJSRT="PA" POS=30 S:PSORJSRT="DR" POS=48 S:PSORJSRT="RE" POS=71
"RTN","PSOREJP0",51,0)
 D INSTR^VALM1(IOINHI_IORVON_ORD_IOINORM,POS,$S(PSOMENU="W":4,1:5))
"RTN","PSOREJP0",52,0)
 Q
"RTN","PSOREJP0",53,0)
 ;
"RTN","PSOREJP0",54,0)
INIT ; - Populates the Body section for ListMan
"RTN","PSOREJP0",55,0)
 K ^TMP("PSOREJP0",$J)
"RTN","PSOREJP0",56,0)
 D SETSORT(PSORJSRT),SETLINE
"RTN","PSOREJP0",57,0)
 S VALMSG="Select the entry # to view or ?? for more actions"
"RTN","PSOREJP0",58,0)
 Q
"RTN","PSOREJP0",59,0)
 ;
"RTN","PSOREJP0",60,0)
SETLINE ; - Sets the line to be displayed in ListMan
"RTN","PSOREJP0",61,0)
 N INS,SUB,SEQ,SORTA,LINE,Z,I,X,X1,X2
"RTN","PSOREJP0",62,0)
 I '$D(^TMP("PSOREJSR",$J)) D  Q
"RTN","PSOREJP0",63,0)
 . F I=1:1:7 S ^TMP("PSOREJP0",$J,I,0)=""
"RTN","PSOREJP0",64,0)
 . S ^TMP("PSOREJP0",$J,8,0)="               No Clinical Third Party Payer Rejects found."
"RTN","PSOREJP0",65,0)
 . S VALMCNT=1
"RTN","PSOREJP0",66,0)
 ;
"RTN","PSOREJP0",67,0)
 F I=1:1:$G(LASTLN) D RESTORE^VALM10(I)
"RTN","PSOREJP0",68,0)
 K INSLN,HIGHLN
"RTN","PSOREJP0",69,0)
 ;
"RTN","PSOREJP0",70,0)
 S (SORTA,INS,SUB)="",LINE=0 K ^TMP("PSOREJP0",$J)
"RTN","PSOREJP0",71,0)
 F  S SORTA=$O(^TMP("PSOREJSR",$J,SORTA)) Q:SORTA=""  D
"RTN","PSOREJP0",72,0)
 . F  S INS=$O(^TMP("PSOREJSR",$J,SORTA,INS)) Q:INS=""  D
"RTN","PSOREJP0",73,0)
 .. I INS'="<NULL>" D
"RTN","PSOREJP0",74,0)
 ... D GROUP(INS,.LINE)
"RTN","PSOREJP0",75,0)
 .. F  S SUB=$O(^TMP("PSOREJSR",$J,SORTA,INS,SUB),PSORJASC) Q:SUB=""  D
"RTN","PSOREJP0",76,0)
 ... S Z=$G(^TMP("PSOREJSR",$J,SORTA,INS,SUB))
"RTN","PSOREJP0",77,0)
 ... S X1="",SEQ=$G(SEQ)+1,X1=$J(SEQ,3)
"RTN","PSOREJP0",78,0)
 ... S $E(X1,5)=$P(Z,"^",3),$E(X1,18)=$P(Z,"^",4),$E(X1,43)=$P(Z,"^",5),$E(X1,64)=$P(Z,"^",6)
"RTN","PSOREJP0",79,0)
 ... S LINE=LINE+1,^TMP("PSOREJP0",$J,LINE,0)=X1,HIGHLN(LINE)=""
"RTN","PSOREJP0",80,0)
 ... S X2="",$E(X2,5)="Payer Message: "_$P(Z,"^",7)
"RTN","PSOREJP0",81,0)
 ... S LINE=LINE+1,^TMP("PSOREJP0",$J,LINE,0)=X2
"RTN","PSOREJP0",82,0)
 ... S ^TMP("PSOREJP0",$J,SEQ,"RX")=$P(Z,"^",1,2)
"RTN","PSOREJP0",83,0)
 ;
"RTN","PSOREJP0",84,0)
 I LINE>$G(LASTLN) D
"RTN","PSOREJP0",85,0)
 . F I=($G(LASTLN)+1):1:LINE D SAVE^VALM10(I)
"RTN","PSOREJP0",86,0)
 . S LASTLN=LINE
"RTN","PSOREJP0",87,0)
 ;
"RTN","PSOREJP0",88,0)
 ; - Highlighting the prescription/insurance line
"RTN","PSOREJP0",89,0)
 F LN=1:1:LINE D
"RTN","PSOREJP0",90,0)
 . I $D(HIGHLN(LN)) D  Q
"RTN","PSOREJP0",91,0)
 . . D CNTRL^VALM10(LN,1,80,IOINHI,IOINORM)
"RTN","PSOREJP0",92,0)
 . . D CNTRL^VALM10(LN,64,3,IOUON,IOINORM)
"RTN","PSOREJP0",93,0)
 . . D CNTRL^VALM10(LN,67,80,IOINHI,IOINORM)
"RTN","PSOREJP0",94,0)
 . I $D(INSLN(LN)) D
"RTN","PSOREJP0",95,0)
 . . S LBL=INSLN(LN),POS=41-($L(LBL)/2+.5\1)
"RTN","PSOREJP0",96,0)
 . . D CNTRL^VALM10(LN,1,POS-1,IOUON_IOINHI,IOINORM)
"RTN","PSOREJP0",97,0)
 . . D CNTRL^VALM10(LN,POS,$L(LBL),IORVON_IOINHI,IORVOFF_IOINORM)
"RTN","PSOREJP0",98,0)
 . . D CNTRL^VALM10(LN,POS+$L(LBL),(81-POS-$L(LBL)),IOUON_IOINHI,IOINORM)
"RTN","PSOREJP0",99,0)
 ;
"RTN","PSOREJP0",100,0)
 S VALMCNT=+$G(LINE)
"RTN","PSOREJP0",101,0)
 Q
"RTN","PSOREJP0",102,0)
 ;
"RTN","PSOREJP0",103,0)
GROUP(LBL,LINE) ; Sets an insurance delimiter line
"RTN","PSOREJP0",104,0)
 N X,POS
"RTN","PSOREJP0",105,0)
 S POS=41-($L(LBL)/2+.5\1)
"RTN","PSOREJP0",106,0)
 S X="",$P(X," ",81)="",$E(X,POS,POS-1+$L(LBL))=LBL
"RTN","PSOREJP0",107,0)
 S LINE=LINE+1,^TMP("PSOREJP0",$J,LINE,0)=X,INSLN(LINE)=LBL
"RTN","PSOREJP0",108,0)
 Q
"RTN","PSOREJP0",109,0)
 ;
"RTN","PSOREJP0",110,0)
SETSORT(FIELD) ; - Sets the data sorted by the FIELD specified
"RTN","PSOREJP0",111,0)
 N RX,REJ,STS,DAT
"RTN","PSOREJP0",112,0)
 K ^TMP("PSOREJSR",$J)
"RTN","PSOREJP0",113,0)
 ;
"RTN","PSOREJP0",114,0)
 ; - Worklist
"RTN","PSOREJP0",115,0)
 I PSOMENU="W" D
"RTN","PSOREJP0",116,0)
 . S RX=0 F  S RX=$O(^PSRX("REJSTS",0,RX)) Q:'RX  D
"RTN","PSOREJP0",117,0)
 . . S REJ=0 F  S REJ=$O(^PSRX("REJSTS",0,RX,REJ)) Q:'REJ  D
"RTN","PSOREJP0",118,0)
 . . . D SETTMP(RX,REJ,FIELD)
"RTN","PSOREJP0",119,0)
 ;
"RTN","PSOREJP0",120,0)
 ; - View/Process
"RTN","PSOREJP0",121,0)
 I PSOMENU="VP" D
"RTN","PSOREJP0",122,0)
 . I $G(PSORXFLT)'="ALL" D  Q
"RTN","PSOREJP0",123,0)
 . . S REJ=0 F  S REJ=$O(^PSRX(+PSORXFLT,"REJ",REJ)) Q:'REJ  D
"RTN","PSOREJP0",124,0)
 . . . I $$FLTSTS(+PSORXFLT,REJ) Q
"RTN","PSOREJP0",125,0)
 . . . D SETTMP(+PSORXFLT,REJ,FIELD)
"RTN","PSOREJP0",126,0)
 . S DAT=$P(PSODTRNG,"^")-0.0000001,(RX,REJ)=0
"RTN","PSOREJP0",127,0)
 . F  S DAT=$O(^PSRX("REJDAT",DAT)) Q:'DAT!(DAT>$$ENDT())  D
"RTN","PSOREJP0",128,0)
 . . F  S RX=$O(^PSRX("REJDAT",DAT,RX)) Q:'RX  D
"RTN","PSOREJP0",129,0)
 . . . I $$FILTER(RX) Q
"RTN","PSOREJP0",130,0)
 . . . F  S REJ=$O(^PSRX("REJDAT",DAT,RX,REJ)) Q:'REJ  D
"RTN","PSOREJP0",131,0)
 . . . . I $$FLTSTS(RX,REJ) Q
"RTN","PSOREJP0",132,0)
 . . . . D SETTMP(RX,REJ,FIELD)
"RTN","PSOREJP0",133,0)
 Q
"RTN","PSOREJP0",134,0)
 ;
"RTN","PSOREJP0",135,0)
SETTMP(RX,REJ,FIELD) ; - Sets ^TMP global that will be displayed in the body section
"RTN","PSOREJP0",136,0)
 N REJLST,FILL,CODE,RXNUM,PTNAME,DRNAME,MSG,REASON,MSG,X,Z,SORT,I,INS,OREJ,PSOTRIC,SORTA
"RTN","PSOREJP0",137,0)
 I $G(PSORXFLT)="ALL",$$CLOSED^PSOREJP1(RX,REJ),$$REOPN^PSOREJP1(RX,REJ) Q
"RTN","PSOREJP0",138,0)
 S FILL=+$$GET1^DIQ(52.25,REJ_","_RX,5),SORTA=1
"RTN","PSOREJP0",139,0)
 I '$$DIV(RX,FILL) Q
"RTN","PSOREJP0",140,0)
 K REJLST D GET^PSOREJU2(RX,FILL,.REJLST,,1) I '$D(REJLST) Q
"RTN","PSOREJP0",141,0)
 I $$FILTER(,REJLST(REJ,"INSURANCE NAME")) Q
"RTN","PSOREJP0",142,0)
 S CODE=$G(REJLST(REJ,"CODE"))
"RTN","PSOREJP0",143,0)
 S PSOTRIC="",PSOTRIC=$$TRIC^PSOREJP1(RX,FILL,PSOTRIC)
"RTN","PSOREJP0",144,0)
 Q:$G(PSOTRIC)&('$G(PSOTRITG))&(CODE'="79")&(CODE'="88")  ;show/hide non-DUR/RTS Tricare
"RTN","PSOREJP0",145,0)
 S PTNAME=$$PTNAME(RX)
"RTN","PSOREJP0",146,0)
 S DRNAME=$$GET1^DIQ(52,RX,6)
"RTN","PSOREJP0",147,0)
 S RXNUM=$$GET1^DIQ(52,RX,.01)
"RTN","PSOREJP0",148,0)
 S MSG=$G(REJLST(REJ,"PAYER MESSAGE")) I $L(MSG)>60 S MSG=$E(MSG,1,58)_"..."
"RTN","PSOREJP0",149,0)
 S REASON=$S(CODE=88:"DUR:"_$G(REJLST(REJ,"REASON")),CODE=79:"79 :REFILL TOO SOON",1:CODE)
"RTN","PSOREJP0",150,0)
 I CODE'=79&(CODE'=88) S REASON=CODE_" :"_$$EXP^PSOREJP1(CODE)
"RTN","PSOREJP0",151,0)
 S Z="",$P(Z,"^")=RX,$P(Z,"^",2)=REJ,$P(Z,"^",3)=RXNUM,$P(Z,"^",4)=PTNAME
"RTN","PSOREJP0",152,0)
 S $P(Z,"^",5)=$E(DRNAME,1,20),$P(Z,"^",6)=$E(REASON,1,17),$P(Z,"^",7)=MSG
"RTN","PSOREJP0",153,0)
 S SORT=$S(FIELD="PA":PTNAME,FIELD="DR":DRNAME,FIELD="RX":RXNUM_" ",1:REASON)_RX_REJ
"RTN","PSOREJP0",154,0)
 S INS="<NULL>"
"RTN","PSOREJP0",155,0)
 I $G(PSOINGRP) S INS=REJLST(REJ,"INSURANCE NAME") S:INS="" INS="***UNKNOWN***"
"RTN","PSOREJP0",156,0)
 S:$G(PSOTRIC)&(CODE'=79)&(CODE'=88) INS="TRICARE"_" - Non-DUR/RTS",SORTA=2
"RTN","PSOREJP0",157,0)
 S:'$G(PSOTRIC)&(CODE'=79)&(CODE'=88) INS="OTHER REJECTS",SORTA=3
"RTN","PSOREJP0",158,0)
 S ^TMP("PSOREJSR",$J,SORTA,INS,SORT)=Z
"RTN","PSOREJP0",159,0)
 Q
"RTN","PSOREJP0",160,0)
 ;
"RTN","PSOREJP0",161,0)
PAT ; - Sort by Patient
"RTN","PSOREJP0",162,0)
 D SORT("PA")
"RTN","PSOREJP0",163,0)
 Q
"RTN","PSOREJP0",164,0)
DRG ; - Sort by Drug
"RTN","PSOREJP0",165,0)
 D SORT("DR")
"RTN","PSOREJP0",166,0)
 Q
"RTN","PSOREJP0",167,0)
RX ; - Sort by Rx
"RTN","PSOREJP0",168,0)
 D SORT("RX")
"RTN","PSOREJP0",169,0)
 Q
"RTN","PSOREJP0",170,0)
REA ; - Sort by Reason
"RTN","PSOREJP0",171,0)
 D SORT("RE")
"RTN","PSOREJP0",172,0)
 Q
"RTN","PSOREJP0",173,0)
SORT(FIELD) ; - Sort entries by FIELD
"RTN","PSOREJP0",174,0)
 I PSORJSRT=FIELD S PSORJASC=$S(PSORJASC=1:-1,1:1)
"RTN","PSOREJP0",175,0)
 E  S PSORJSRT=FIELD,PSORJASC=1
"RTN","PSOREJP0",176,0)
 D REF
"RTN","PSOREJP0",177,0)
 Q
"RTN","PSOREJP0",178,0)
 ;
"RTN","PSOREJP0",179,0)
REF ; - Screen Refresh
"RTN","PSOREJP0",180,0)
 W ?52,"Please wait..." D INIT S VALMBCK="R"
"RTN","PSOREJP0",181,0)
 Q
"RTN","PSOREJP0",182,0)
GI ; - Group by Insurance
"RTN","PSOREJP0",183,0)
 W ?52,"Please wait..." S PSOINGRP=$S($G(PSOINGRP):0,1:1) D INIT,HDR S VALMBCK="R"
"RTN","PSOREJP0",184,0)
 Q
"RTN","PSOREJP0",185,0)
TRICTOG ;  - Toggle Tricare display
"RTN","PSOREJP0",186,0)
 W ?52,"Please wait..." S PSOTRITG=$S($G(PSOTRITG):0,1:1) D INIT,HDR S VALMBCK="R"
"RTN","PSOREJP0",187,0)
 Q
"RTN","PSOREJP0",188,0)
 ;
"RTN","PSOREJP0",189,0)
SEL ; - Process selection of one entry
"RTN","PSOREJP0",190,0)
 N PSOSEL,XQORM,Z,RX,REJ,PSOCHNG
"RTN","PSOREJP0",191,0)
 S PSOSEL=+$P($P(Y(1),"^",4),"=",2) I 'PSOSEL S VALMSG="Invalid selection!",VALMBCK="R" Q
"RTN","PSOREJP0",192,0)
 S Z=$G(^TMP("PSOREJP0",$J,PSOSEL,"RX"))
"RTN","PSOREJP0",193,0)
 S RX=$P(Z,"^"),REJ=$P(Z,"^",2) I 'RX!'REJ S VALMSG="Invalid selection!",VALMBCK="R" Q
"RTN","PSOREJP0",194,0)
 S PSOCHNG=0 D EN^PSOREJP1(RX,REJ,.PSOCHNG) I $G(PSOCHNG) D REF
"RTN","PSOREJP0",195,0)
 Q
"RTN","PSOREJP0",196,0)
 ;
"RTN","PSOREJP0",197,0)
EXIT ;
"RTN","PSOREJP0",198,0)
 K ^TMP("PSOREJP0",$J),^TMP("PSOREJSR",$J)
"RTN","PSOREJP0",199,0)
 Q
"RTN","PSOREJP0",200,0)
 ;
"RTN","PSOREJP0",201,0)
HELP Q
"RTN","PSOREJP0",202,0)
 ;
"RTN","PSOREJP0",203,0)
SITES() ; - Returns the list of sites along with their NCPDP #s
"RTN","PSOREJP0",204,0)
 N CNT,SITE,SITES,NAME
"RTN","PSOREJP0",205,0)
 I '$D(PSOREJST) Q ""
"RTN","PSOREJP0",206,0)
 I $G(PSOREJST)="ALL" Q "Divisions : ALL"
"RTN","PSOREJP0",207,0)
 S SITE=0 F  S SITE=$O(PSOREJST(SITE)) Q:'SITE  D
"RTN","PSOREJP0",208,0)
 . S NAME=$$GET1^DIQ(59,SITE,.01)
"RTN","PSOREJP0",209,0)
 . S SITES=$G(SITES)_", "_NAME
"RTN","PSOREJP0",210,0)
 S $E(SITES,1,2)="",SITES="Division"_$S($L(SITES,",")>1:"s",1:" ")_" : "_SITES
"RTN","PSOREJP0",211,0)
 Q SITES
"RTN","PSOREJP0",212,0)
 ;
"RTN","PSOREJP0",213,0)
DIV(RX,FILL) ; - Check if the Division for the Prescription/Fill was selected by the user
"RTN","PSOREJP0",214,0)
 ;
"RTN","PSOREJP0",215,0)
 I $G(PSOREJST)="ALL" Q 1
"RTN","PSOREJP0",216,0)
 I $D(PSOREJST($$RXSITE^PSOBPSUT(RX,FILL))) Q 1
"RTN","PSOREJP0",217,0)
 Q 0
"RTN","PSOREJP0",218,0)
 ;
"RTN","PSOREJP0",219,0)
PTNAME(RX) ; - Returns header displayable - Patient Name (Last 4 SSN)
"RTN","PSOREJP0",220,0)
 N DFN,VADM,PTNAME
"RTN","PSOREJP0",221,0)
 S DFN=$$GET1^DIQ(52,RX,2,"I") D DEM^VADPT
"RTN","PSOREJP0",222,0)
 S PTNAME=$E($G(VADM(1)),1,18)_"("_$P($P($G(VADM(2)),"^",2),"-",3)_")"
"RTN","PSOREJP0",223,0)
 Q PTNAME
"RTN","PSOREJP0",224,0)
 ;
"RTN","PSOREJP0",225,0)
FILTER(RX,INS) ; - Filter entries based on user's selection
"RTN","PSOREJP0",226,0)
 N FILTER,NAME
"RTN","PSOREJP0",227,0)
 S FILTER=1
"RTN","PSOREJP0",228,0)
 I $G(PSOPTFLT)'="ALL",$D(RX),'$D(PSOPTFLT($$GET1^DIQ(52,RX,2,"I"))) Q FILTER
"RTN","PSOREJP0",229,0)
 I $G(PSODRFLT)'="ALL",$D(RX),'$D(PSODRFLT($$GET1^DIQ(52,RX,6,"I"))) Q FILTER
"RTN","PSOREJP0",230,0)
 I $G(PSOINFLT)'="ALL",$D(INS) D  Q FILTER
"RTN","PSOREJP0",231,0)
 . S NAME="" F  S NAME=$O(PSOINFLT(NAME)) Q:NAME=""  I $$UP^XLFSTR(INS)[$$UP^XLFSTR(NAME) S FILTER=0 Q
"RTN","PSOREJP0",232,0)
 Q 0
"RTN","PSOREJP0",233,0)
 ;
"RTN","PSOREJP0",234,0)
FLTSTS(RX,REJ) ; - Filter for the Reject Status  
"RTN","PSOREJP0",235,0)
 N STS
"RTN","PSOREJP0",236,0)
 S STS=$$GET1^DIQ(52.25,REJ_","_RX,9,"I")
"RTN","PSOREJP0",237,0)
 I PSOSTFLT="U",STS=1 Q 1
"RTN","PSOREJP0",238,0)
 I PSOSTFLT="R",STS=0 Q 1
"RTN","PSOREJP0",239,0)
 Q 0
"RTN","PSOREJP0",240,0)
 ;
"RTN","PSOREJP0",241,0)
NAME(TYPE) ; - Returns the name if ONE was selected or "MULTIPLE ..."
"RTN","PSOREJP0",242,0)
 N I,CNT
"RTN","PSOREJP0",243,0)
 ;
"RTN","PSOREJP0",244,0)
 I TYPE="P",$O(PSOPTFLT($O(PSOPTFLT(""))))="" Q $$GET1^DIQ(2,$O(PSOPTFLT("")),.01)
"RTN","PSOREJP0",245,0)
 I TYPE="D",$O(PSODRFLT($O(PSODRFLT(""))))="" Q $$GET1^DIQ(50,$O(PSODRFLT("")),.01)
"RTN","PSOREJP0",246,0)
 I TYPE="I",$O(PSOINFLT($O(PSOINFLT(""))))="" Q $O(PSOINFLT(""))
"RTN","PSOREJP0",247,0)
 I TYPE="R" Q $$GET1^DIQ(52,PSORXFLT,.01)
"RTN","PSOREJP0",248,0)
 Q "MULTIPLE "_$S(TYPE="P":"PATIENTS",TYPE="D":"DRUGS",1:"INSURANCE COMPANIES")
"RTN","PSOREJP0",249,0)
 ;
"RTN","PSOREJP0",250,0)
ENDT() ; Returns the upper limit for the date range
"RTN","PSOREJP0",251,0)
 N ENDT
"RTN","PSOREJP0",252,0)
 S ENDT=$P(PSODTRNG,"^",2)
"RTN","PSOREJP0",253,0)
 I '$E(ENDT,4,7) Q (ENDT+10000)
"RTN","PSOREJP0",254,0)
 I '$E(ENDT,6,7) Q (ENDT+100)
"RTN","PSOREJP0",255,0)
 I $P(ENDT,"^",2) Q (ENDT+0.0000001)
"RTN","PSOREJP0",256,0)
 Q (ENDT+.25)
"RTN","PSOREJP1")
0^11^B67222014
"RTN","PSOREJP1",1,0)
PSOREJP1 ;BIRM/MFR - Third Party Reject Display Screen ;04/29/05
"RTN","PSOREJP1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**148,247,260,281,287,289**;DEC 1997;Build 107
"RTN","PSOREJP1",3,0)
 ;Reference to File 9002313.93 - BPS NCPDP REJECT CODES supported by IA 4720
"RTN","PSOREJP1",4,0)
 ;Reference to ^PS(59.7 supported by IA 694
"RTN","PSOREJP1",5,0)
 ;Reference to ^PSDRUG("AQ" supported by IA 3165
"RTN","PSOREJP1",6,0)
 ;
"RTN","PSOREJP1",7,0)
EN(RX,REJ,CHANGE) ; Entry point
"RTN","PSOREJP1",8,0)
 ;
"RTN","PSOREJP1",9,0)
 ; - DO NOT change the IF logic below as both of them might get executed (intentional)
"RTN","PSOREJP1",10,0)
 N FILL,LASTLN,PSOTRIC,PSOCODE,PSOTCODE
"RTN","PSOREJP1",11,0)
 S FILL=+$$GET1^DIQ(52.25,REJ_","_RX,5)
"RTN","PSOREJP1",12,0)
 S PSOTRIC="",PSOTRIC=$$TRIC(RX,FILL,PSOTRIC),PSOCODE=$$GET1^DIQ(52.25,REJ_","_RX,.01)
"RTN","PSOREJP1",13,0)
 S PSOTCODE=0 S:PSOCODE'=79&(PSOCODE'=88)&(PSOTRIC) PSOTCODE=1
"RTN","PSOREJP1",14,0)
 I $$CLOSED(RX,REJ) D EN^VALM("PSO REJECT DISPLAY - RESOLVED")
"RTN","PSOREJP1",15,0)
 I '$$CLOSED(RX,REJ)&(PSOTCODE) D EN^VALM("PSO REJECT TRICARE")
"RTN","PSOREJP1",16,0)
 I '$$CLOSED(RX,REJ)&('PSOTCODE) D EN^VALM("PSO REJECT DISPLAY")
"RTN","PSOREJP1",17,0)
 D FULL^VALM1
"RTN","PSOREJP1",18,0)
 Q
"RTN","PSOREJP1",19,0)
 ;
"RTN","PSOREJP1",20,0)
HDR      ; - Builds the Header section
"RTN","PSOREJP1",21,0)
 N LINE1,LINE2,X
"RTN","PSOREJP1",22,0)
 S VALMHDR(1)=$$DVINFO^PSOREJU2(RX,FILL,1),VALMHDR(2)=$$PTINFO^PSOREJU2(RX,1)
"RTN","PSOREJP1",23,0)
 S VALMHDR(3)=$$RXINFO^PSOREJP3(RX,FILL,1),VALMHDR(4)=$$RXINFO^PSOREJP3(RX,FILL,2)
"RTN","PSOREJP1",24,0)
 Q
"RTN","PSOREJP1",25,0)
 ;
"RTN","PSOREJP1",26,0)
TRIC(RX,RFL,PSOTRIC) ; - Return 1 for TRICARE or 0 (zero) for not TRICARE
"RTN","PSOREJP1",27,0)
 S PSOTRIC="",PSOTRIC=$S(RFL=0&($$GET1^DIQ(52,RX_",",85,"I")="T"):1,$$GET1^DIQ(52.1,RFL_","_RX_",",85,"I")="T":1,1:0)
"RTN","PSOREJP1",28,0)
 Q PSOTRIC
"RTN","PSOREJP1",29,0)
 ;
"RTN","PSOREJP1",30,0)
INIT ; Builds the Body section
"RTN","PSOREJP1",31,0)
 N DATA,LINE
"RTN","PSOREJP1",32,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOREJP1",33,0)
 S PSOTRIC="",PSOTRIC=$$TRIC(RX,RFL,PSOTRIC)
"RTN","PSOREJP1",34,0)
 F I=1:1:$G(LASTLN) D RESTORE^VALM10(I)
"RTN","PSOREJP1",35,0)
 K ^TMP("PSOREJP1",$J) S VALMCNT=0,LINE=0
"RTN","PSOREJP1",36,0)
 D GET^PSOREJU2(RX,FILL,.DATA,REJ,1)
"RTN","PSOREJP1",37,0)
 D REJ                   ; Display the REJECT Information
"RTN","PSOREJP1",38,0)
 D OTH                   ; Display the Other Rejects Information
"RTN","PSOREJP1",39,0)
 D COM^PSOREJP3          ; Display the Comment
"RTN","PSOREJP1",40,0)
 D INS                   ; Display the Insurance Information
"RTN","PSOREJP1",41,0)
 D CLS                   ; Display the Resolution Information
"RTN","PSOREJP1",42,0)
 S VALMCNT=LINE
"RTN","PSOREJP1",43,0)
 Q
"RTN","PSOREJP1",44,0)
 ;
"RTN","PSOREJP1",45,0)
REJ ; - DUR Information
"RTN","PSOREJP1",46,0)
 N TYPE,PFLDT,TREJ,TDATA,PSOTRIC S TDATA=""
"RTN","PSOREJP1",47,0)
 S PSOTRIC="",PSOTRIC=$$TRIC(RX,FILL,PSOTRIC)
"RTN","PSOREJP1",48,0)
 I $G(PSOTRIC) D
"RTN","PSOREJP1",49,0)
 . D SETLN("REJECT Information"_$S($G(PSOTRIC):" (TRICARE)",1:""),1,1)
"RTN","PSOREJP1",50,0)
 . S TDATA=$$EXP(DATA(REJ,"CODE"))_" ("_$G(DATA(REJ,"CODE"))_") "
"RTN","PSOREJP1",51,0)
 . D SETLN("Date/Time     : "_$$FMTE^XLFDT($G(DATA(REJ,"DATE/TIME"))),,,18)
"RTN","PSOREJP1",52,0)
 . D SETLN("Reject(s)     : "_TDATA,,,18)
"RTN","PSOREJP1",53,0)
 . F I=1:1 Q:'$D(TDATA(I))  D SETLN("              : "_TDATA(I),,,18)
"RTN","PSOREJP1",54,0)
 . D SETLN("Status        : "_$G(DATA(REJ,"STATUS"))_" - "_$$STATUS^PSOBPSUT(RX,FILL),,,18)
"RTN","PSOREJP1",55,0)
 . ;REJDATA(REJ,"OTHER REJECTS"
"RTN","PSOREJP1",56,0)
 I '$G(PSOTRIC) D
"RTN","PSOREJP1",57,0)
 .D SETLN("REJECT Information",1,1)
"RTN","PSOREJP1",58,0)
 .S TYPE=$S($G(DATA(REJ,"CODE"))=79:"79 - REFILL TOO SOON",1:"")
"RTN","PSOREJP1",59,0)
 .I TYPE="" S TYPE=DATA(REJ,"CODE")_" - "_$E($$EXP(DATA(REJ,"CODE")),1,23)_"-"
"RTN","PSOREJP1",60,0)
 .D SETLN("Reject Type    : "_TYPE_" received on "_$$FMTE^XLFDT($G(DATA(REJ,"DATE/TIME"))),,,18)
"RTN","PSOREJP1",61,0)
 .D SETLN("Reject Status  : "_$G(DATA(REJ,"STATUS")),,,18)
"RTN","PSOREJP1",62,0)
 .D SET("PAYER MESSAGE",63)
"RTN","PSOREJP1",63,0)
 .D SET("REASON",63)
"RTN","PSOREJP1",64,0)
 .S PFLDT=$$FMTE^XLFDT($G(DATA(REJ,"PLAN PREVIOUS FILL DATE")))
"RTN","PSOREJP1",65,0)
 .D SET("DUR TEXT",63,$S(PFLDT="":1,1:0))
"RTN","PSOREJP1",66,0)
 .I PFLDT'="" D SETLN("Last Fill Date : "_PFLDT_" (from payer)",,1,18)
"RTN","PSOREJP1",67,0)
 Q
"RTN","PSOREJP1",68,0)
 ;
"RTN","PSOREJP1",69,0)
OTH ; - Other Rejects Information
"RTN","PSOREJP1",70,0)
 N LST,I,RJC,J,LAST
"RTN","PSOREJP1",71,0)
 S LST=$G(DATA(REJ,"OTHER REJECTS")) I LST="" Q
"RTN","PSOREJP1",72,0)
 D SETLN()
"RTN","PSOREJP1",73,0)
 D SETLN("OTHER REJECTS",1,1)
"RTN","PSOREJP1",74,0)
 F I=1:1:$L(LST,",") S RJC=$P(LST,",",I) D
"RTN","PSOREJP1",75,0)
 . S LAST=1 F J=(I+1):1:$L(LST,",") I $P(LST,",",J)'="" S LAST=0 Q
"RTN","PSOREJP1",76,0)
 . I RJC'="" D SETLN(RJC_" - "_$$EXP(RJC),,$S(LAST:1,1:0),6)
"RTN","PSOREJP1",77,0)
 Q
"RTN","PSOREJP1",78,0)
 ;
"RTN","PSOREJP1",79,0)
INS ; - Insurance Information
"RTN","PSOREJP1",80,0)
 D SETLN()
"RTN","PSOREJP1",81,0)
 D SETLN("INSURANCE Information",1,1)
"RTN","PSOREJP1",82,0)
 D SETLN("Insurance      : "_$G(DATA(REJ,"INSURANCE NAME")),,,18)
"RTN","PSOREJP1",83,0)
 D SETLN("Contact        : "_$G(DATA(REJ,"PLAN CONTACT")),,,18)
"RTN","PSOREJP1",84,0)
 D SETLN("Group Name     : "_$G(DATA(REJ,"GROUP NAME")),,,18)
"RTN","PSOREJP1",85,0)
 D SETLN("Group Number   : "_$G(DATA(REJ,"GROUP NUMBER")),,,18)
"RTN","PSOREJP1",86,0)
 D SETLN("Cardholder ID  : "_$G(DATA(REJ,"CARDHOLDER ID")),,1,18)
"RTN","PSOREJP1",87,0)
 Q
"RTN","PSOREJP1",88,0)
 ;
"RTN","PSOREJP1",89,0)
CLS ; - Resolution Information
"RTN","PSOREJP1",90,0)
 N X
"RTN","PSOREJP1",91,0)
 I '$$CLOSED(RX,REJ) Q
"RTN","PSOREJP1",92,0)
 D SETLN()
"RTN","PSOREJP1",93,0)
 D SETLN("RESOLUTION Information",1,1)
"RTN","PSOREJP1",94,0)
 D SETLN("Resolved By    : "_$G(DATA(REJ,"CLOSED BY")),,,18)
"RTN","PSOREJP1",95,0)
 D SETLN("Date/Time      : "_$G(DATA(REJ,"CLOSED DATE/TIME")),,,18)
"RTN","PSOREJP1",96,0)
 I $G(DATA(REJ,"CLOSE COMMENTS"))'="" D SET("CLOSE COMMENTS",63)
"RTN","PSOREJP1",97,0)
 I $G(DATA(REJ,"COD1"))'="" D SETLN("Reason for Svc : "_$$OVRX^PSOREJU1(1,$G(DATA(REJ,"COD1"))),,,18)
"RTN","PSOREJP1",98,0)
 I $G(DATA(REJ,"COD2"))'="" D SETLN("Profes. Svc    : "_$$OVRX^PSOREJU1(2,$G(DATA(REJ,"COD2"))),,,18)
"RTN","PSOREJP1",99,0)
 I $G(DATA(REJ,"COD3"))'="" D SETLN("Result of Svc  : "_$$OVRX^PSOREJU1(3,$G(DATA(REJ,"COD3"))),,,18)
"RTN","PSOREJP1",100,0)
 I $G(DATA(REJ,"CLA CODE"))'="" D
"RTN","PSOREJP1",101,0)
 . N CLAPNTR S CLAPNTR=$$GET1^DIQ(52.25,REJ_","_RX_",",24,"I")
"RTN","PSOREJP1",102,0)
 . S X=DATA(REJ,"CLA CODE")_" - "_$$GET1^DIQ(9002313.25,CLAPNTR,".02")
"RTN","PSOREJP1",103,0)
 . D SETLN("Clarific. Code : "_X,,,18)
"RTN","PSOREJP1",104,0)
 I $G(DATA(REJ,"PRIOR AUTH TYPE"))'="" D
"RTN","PSOREJP1",105,0)
 . S X=$$GET1^DIQ(52.25,REJ_","_RX,25,"I")_" - "_(DATA(REJ,"PRIOR AUTH TYPE"))
"RTN","PSOREJP1",106,0)
 . D SETLN("Prior Auth.Type: "_X,,,18),SETLN("Prior Auth. #  : "_DATA(REJ,"PRIOR AUTH NUMBER"),,,18)
"RTN","PSOREJP1",107,0)
 D SETLN("Reason         : "_$G(DATA(REJ,"CLOSE REASON")),,1,18)
"RTN","PSOREJP1",108,0)
 Q
"RTN","PSOREJP1",109,0)
 ;
"RTN","PSOREJP1",110,0)
 ;
"RTN","PSOREJP1",111,0)
SET(FIELD,L,UND) ; Sets the lines for fields that require text wrapping
"RTN","PSOREJP1",112,0)
 N TXT,T
"RTN","PSOREJP1",113,0)
 S TXT=DATA(REJ,FIELD) I $L(TXT)'>L D SETLN($$LABEL(FIELD)_TXT,,$S($G(UND):1,1:0),80-L) Q
"RTN","PSOREJP1",114,0)
 F I=1:1 Q:TXT=""  D
"RTN","PSOREJP1",115,0)
 . I I=1 D SETLN($$LABEL(FIELD)_$E(TXT,1,L),,,80-L) S TXT=$E(TXT,L+1,999) Q
"RTN","PSOREJP1",116,0)
 . S T="",$E(T,81-L)=$E(TXT,1,L) D SETLN(T,,$S($E(TXT,L+1,999)=""&$G(UND):1,1:0),80-L) S TXT=$E(TXT,L+1,999)
"RTN","PSOREJP1",117,0)
 Q
"RTN","PSOREJP1",118,0)
 ;
"RTN","PSOREJP1",119,0)
LABEL(FIELD) ; Sets the label for the field
"RTN","PSOREJP1",120,0)
 I FIELD="REASON" Q "Reason         : "
"RTN","PSOREJP1",121,0)
 I FIELD="PAYER MESSAGE" Q "Payer Message  : "
"RTN","PSOREJP1",122,0)
 I FIELD="DUR TEXT" Q "DUR Text       : "
"RTN","PSOREJP1",123,0)
 I FIELD="CLOSE COMMENTS" Q "Comments       : "
"RTN","PSOREJP1",124,0)
 Q ""
"RTN","PSOREJP1",125,0)
 ;
"RTN","PSOREJP1",126,0)
VIEW ; - Rx View hidden action
"RTN","PSOREJP1",127,0)
 N VALMCNT,TITLE
"RTN","PSOREJP1",128,0)
 I $G(PSOBACK) D  Q
"RTN","PSOREJP1",129,0)
 . S VALMSG="Not available through Backdoor!",VALMBCK="R"
"RTN","PSOREJP1",130,0)
 S TITLE=VALM("TITLE")
"RTN","PSOREJP1",131,0)
 ;
"RTN","PSOREJP1",132,0)
 ; - DO structure used to avoid losing variables RX,FILL,REJ,LINE,TITLE
"RTN","PSOREJP1",133,0)
 DO
"RTN","PSOREJP1",134,0)
 . N PSOVDA,DA,PS
"RTN","PSOREJP1",135,0)
 . S (PSOVDA,DA)=RX,PS="REJECT"
"RTN","PSOREJP1",136,0)
 . N RX,REJ,FILL,LINE,TITLE D DP^PSORXVW
"RTN","PSOREJP1",137,0)
 ;
"RTN","PSOREJP1",138,0)
 S VALMBCK="R",VALM("TITLE")=TITLE
"RTN","PSOREJP1",139,0)
 Q
"RTN","PSOREJP1",140,0)
 ;
"RTN","PSOREJP1",141,0)
EDT ; - Rx Edit hidden action
"RTN","PSOREJP1",142,0)
 N VALMCNT,TITLE
"RTN","PSOREJP1",143,0)
 I $G(PSOBACK) D  Q
"RTN","PSOREJP1",144,0)
 . S VALMSG="Not available through Backdoor!",VALMBCK="R"
"RTN","PSOREJP1",145,0)
 S TITLE=VALM("TITLE")
"RTN","PSOREJP1",146,0)
 ;
"RTN","PSOREJP1",147,0)
 ; - DO structure used to avoid losing variables RX,FILL,REJ,LINE,TITLE
"RTN","PSOREJP1",148,0)
 DO
"RTN","PSOREJP1",149,0)
 . N PSOSITE,ORN,PSOPAR,PSOLIST
"RTN","PSOREJP1",150,0)
 . S PSOSITE=$$RXSITE^PSOBPSUT(RX,FILL),ORN=RX
"RTN","PSOREJP1",151,0)
 . S PSOPAR=$G(^PS(59,PSOSITE,1)),PSOLIST(1)=ORN_","
"RTN","PSOREJP1",152,0)
 . N RX,REJ,FILL,LINE,TITLE D EPH^PSORXEDT
"RTN","PSOREJP1",153,0)
 ;
"RTN","PSOREJP1",154,0)
 K VALMBCK I $$CLOSED(RX,REJ),$D(PSOSTFLT),PSOSTFLT="U" S CHANGE=1 Q
"RTN","PSOREJP1",155,0)
 S VALMBCK="R",VALM("TITLE")=TITLE
"RTN","PSOREJP1",156,0)
 Q
"RTN","PSOREJP1",157,0)
 ;
"RTN","PSOREJP1",158,0)
OVR ; - Override a REJECT action
"RTN","PSOREJP1",159,0)
 I $$CLOSED(RX,REJ,1) Q
"RTN","PSOREJP1",160,0)
 N COD1,COD2,COD3
"RTN","PSOREJP1",161,0)
 D FULL^VALM1 W !
"RTN","PSOREJP1",162,0)
 S COD1=$$OVRCOD^PSOREJU1(1,$$GET1^DIQ(52.25,REJ_","_RX,14)) I COD1="^" S VALMBCK="R" Q
"RTN","PSOREJP1",163,0)
 S COD2=$$OVRCOD^PSOREJU1(2) I COD2="^" S VALMBCK="R" Q
"RTN","PSOREJP1",164,0)
 S COD3=$$OVRCOD^PSOREJU1(3) I COD3="^" S VALMBCK="R" Q
"RTN","PSOREJP1",165,0)
 D OVRDSP^PSOREJU1(COD1_"^"_COD2_"^"_COD3)
"RTN","PSOREJP1",166,0)
 D SEND^PSOREJP3(COD1,COD2,COD3)
"RTN","PSOREJP1",167,0)
 Q
"RTN","PSOREJP1",168,0)
 ;
"RTN","PSOREJP1",169,0)
RES ; - Re-submit a claim action
"RTN","PSOREJP1",170,0)
 I $$CLOSED(RX,REJ,1) Q
"RTN","PSOREJP1",171,0)
 D FULL^VALM1 W !
"RTN","PSOREJP1",172,0)
 D SEND^PSOREJP3()
"RTN","PSOREJP1",173,0)
 Q
"RTN","PSOREJP1",174,0)
 ;
"RTN","PSOREJP1",175,0)
CLA ; - Submit Clarification Code
"RTN","PSOREJP1",176,0)
 N CLA
"RTN","PSOREJP1",177,0)
 I $$CLOSED(RX,REJ,1) Q
"RTN","PSOREJP1",178,0)
 D FULL^VALM1 W !
"RTN","PSOREJP1",179,0)
 S CLA=$$CLA^PSOREJU1() I CLA="^" S VALMBCK="R" Q
"RTN","PSOREJP1",180,0)
 W ! D SEND^PSOREJP3(,,,CLA)
"RTN","PSOREJP1",181,0)
 Q
"RTN","PSOREJP1",182,0)
 ;
"RTN","PSOREJP1",183,0)
PA ; - Submit Prior Authorization
"RTN","PSOREJP1",184,0)
 N PA
"RTN","PSOREJP1",185,0)
 I $$CLOSED(RX,REJ,1) Q
"RTN","PSOREJP1",186,0)
 D FULL^VALM1 W !
"RTN","PSOREJP1",187,0)
 S PA=$$PA^PSOREJU2() I PA="^" S VALMBCK="R" Q
"RTN","PSOREJP1",188,0)
 W ! D SEND^PSOREJP3(,,,,PA)
"RTN","PSOREJP1",189,0)
 Q
"RTN","PSOREJP1",190,0)
 ;
"RTN","PSOREJP1",191,0)
MP ; - Patient Medication Profile
"RTN","PSOREJP1",192,0)
 I $G(PSOBACK) D  Q
"RTN","PSOREJP1",193,0)
 . S VALMSG="Not available through Backdoor!",VALMBCK="R"
"RTN","PSOREJP1",194,0)
 N SITE,PATIENT
"RTN","PSOREJP1",195,0)
 D FULL^VALM1 W !
"RTN","PSOREJP1",196,0)
 S SITE=+$$RXSITE^PSOBPSUT(RX,FILL) S:$G(PSOSITE) SITE=PSOSITE
"RTN","PSOREJP1",197,0)
 S PATIENT=+$$GET1^DIQ(52,RX,2,"I")
"RTN","PSOREJP1",198,0)
 D LST^PSOPMP0(SITE,PATIENT) S VALMBCK="R"
"RTN","PSOREJP1",199,0)
 Q
"RTN","PSOREJP1",200,0)
 ;
"RTN","PSOREJP1",201,0)
EXIT ;
"RTN","PSOREJP1",202,0)
 K ^TMP("PSOREJP1",$J)
"RTN","PSOREJP1",203,0)
 Q
"RTN","PSOREJP1",204,0)
 ;
"RTN","PSOREJP1",205,0)
SETLN(TEXT,REV,UND,HIG) ; Sets a line to be displayed in the Body section
"RTN","PSOREJP1",206,0)
 N X
"RTN","PSOREJP1",207,0)
 S:$G(TEXT)="" $E(TEXT,80)=""
"RTN","PSOREJP1",208,0)
 S:$L(TEXT)>80 TEXT=$E(TEXT,1,80)
"RTN","PSOREJP1",209,0)
 S LINE=LINE+1,^TMP("PSOREJP1",$J,LINE,0)=$G(TEXT)
"RTN","PSOREJP1",210,0)
 ;
"RTN","PSOREJP1",211,0)
 I LINE>$G(LASTLN) D SAVE^VALM10(LINE) S LASTLN=LINE
"RTN","PSOREJP1",212,0)
 ;
"RTN","PSOREJP1",213,0)
 I $G(REV) D  Q
"RTN","PSOREJP1",214,0)
 . D CNTRL^VALM10(LINE,1,$L(TEXT),IORVON,IOINORM)
"RTN","PSOREJP1",215,0)
 . I $G(UND) D CNTRL^VALM10(LINE,$L(TEXT)+1,80,IOUON,IOINORM)
"RTN","PSOREJP1",216,0)
 I $G(UND) D CNTRL^VALM10(LINE,1,80,IOUON,IOINORM)
"RTN","PSOREJP1",217,0)
 I $G(HIG) D
"RTN","PSOREJP1",218,0)
 . D CNTRL^VALM10(LINE,HIG,80,IOINHI_$S($G(UND):IOUON,1:""),IOINORM)
"RTN","PSOREJP1",219,0)
 Q
"RTN","PSOREJP1",220,0)
HELP ;
"RTN","PSOREJP1",221,0)
 Q
"RTN","PSOREJP1",222,0)
 ;
"RTN","PSOREJP1",223,0)
CLOSED(RX,REJ,MSG) ; Returns whether the REJECT is RESOLVED or NOT
"RTN","PSOREJP1",224,0)
 I $$GET1^DIQ(52.25,REJ_","_RX,10,"I") D:$G(MSG)  Q 1
"RTN","PSOREJP1",225,0)
 . S VALMSG="This Reject is marked resolved!",VALMBCK="R" W $C(7)
"RTN","PSOREJP1",226,0)
 Q 0
"RTN","PSOREJP1",227,0)
 ;
"RTN","PSOREJP1",228,0)
REOPN(RX,REJ) ; Returns whether the REJECT was RE-OPENED or NOT
"RTN","PSOREJP1",229,0)
 Q $S($$GET1^DIQ(52.25,REJ_","_RX,23)="":0,1:1)
"RTN","PSOREJP1",230,0)
 ;
"RTN","PSOREJP1",231,0)
EXP(CODE) ; - Returns the explanation field (.02) for a reject code
"RTN","PSOREJP1",232,0)
 ;  Input:  (r) CODE - .01 field (Code) value from file 9002313.93
"RTN","PSOREJP1",233,0)
 ; Output: .02 field (Explanation) value from file 9002313.93
"RTN","PSOREJP1",234,0)
 N DIC,X,Y
"RTN","PSOREJP1",235,0)
 S DIC=9002313.93,DIC(0)="Z",X=CODE D ^DIC
"RTN","PSOREJP1",236,0)
 Q $P($G(Y(0)),"^",2)
"RTN","PSOREJP1",237,0)
 ;
"RTN","PSOREJP1",238,0)
OUT(RX) ; - Supported call by outside PROTOCOLs to act on specific REJECTs
"RTN","PSOREJP1",239,0)
 N I,RFL,DATA,REJ,PSOBACK,VALMCNT,RXN
"RTN","PSOREJP1",240,0)
 I '$D(^XUSEC("PSORPH",DUZ)) D  Q
"RTN","PSOREJP1",241,0)
 . S VALMSG="PSORPH key required to use the REJ action.",VALMBCK="R"
"RTN","PSOREJP1",242,0)
 I $G(PS)="REJECT" D
"RTN","PSOREJP1",243,0)
 . S VALMSG="REJ action is not available at this point.",VALMBCK="R"
"RTN","PSOREJP1",244,0)
 S PSOBACK=1
"RTN","PSOREJP1",245,0)
 S (RFL,I)=0 F I=1:1 Q:'$D(^PSRX(RX,1,I))  S RFL=I
"RTN","PSOREJP1",246,0)
 S X=$$FIND^PSOREJUT(RX,RFL,.DATA) S REJ=$O(DATA(""))
"RTN","PSOREJP1",247,0)
 I '$G(REJ) S VALMSG="Invalid selection!",VALMBCK="R" Q
"RTN","PSOREJP1",248,0)
 D EN(RX,REJ) S VALMBCK="R"
"RTN","PSOREJP1",249,0)
 Q
"RTN","PSOREJP1",250,0)
 ;
"RTN","PSOREJP2")
0^25^B71497801
"RTN","PSOREJP2",1,0)
PSOREJP2 ;BIRM/MFR - Third Party Rejects View/Process ;04/28/05
"RTN","PSOREJP2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**148,247,260,287,289**;DEC 1997;Build 107
"RTN","PSOREJP2",3,0)
 ;Reference to ^PSSLOCK supported by IA #2789
"RTN","PSOREJP2",4,0)
 ; 
"RTN","PSOREJP2",5,0)
 N PSORJSRT,PSOPTFLT,PSODRFLT,PSORXFLT,PSOBYFLD,PSOSTFLT,DIR,DIRUT,DUOUT,DTOUT
"RTN","PSOREJP2",6,0)
 N PSOINFLT,PSODTRNG,PSOINGRP,PSOTRITG
"RTN","PSOREJP2",7,0)
 S PSORJASC=1,PSOINGRP=0,PSOTRITG=1
"RTN","PSOREJP2",8,0)
 ;
"RTN","PSOREJP2",9,0)
 ; - Division/Site selection
"RTN","PSOREJP2",10,0)
 D SEL^PSOREJU1("DIVISION","^PS(59,",.PSOREJST,$$GET1^DIQ(59,+$G(PSOSITE),.01)) I $G(PSOREJST)="^" G EXIT
"RTN","PSOREJP2",11,0)
 ;
"RTN","PSOREJP2",12,0)
 ; - Date range selection
"RTN","PSOREJP2",13,0)
 W ! S PSODTRNG=$$DTRNG("T-90","T") I PSODTRNG="^" G EXIT
"RTN","PSOREJP2",14,0)
 ;
"RTN","PSOREJP2",15,0)
SEL ; - Field Selection (Patient/Drug/Rx)
"RTN","PSOREJP2",16,0)
 S DIR(0)="S^P:PATIENT;D:DRUG;R:Rx;I:INSURANCE",DIR("B")="P"
"RTN","PSOREJP2",17,0)
 S DIR("A")="By (P)atient, (D)rug, (R)x or (I)nsurance" D ^DIR I $D(DIRUT) G EXIT
"RTN","PSOREJP2",18,0)
 S PSOBYFLD=Y,DIR("B")=""
"RTN","PSOREJP2",19,0)
 ;
"RTN","PSOREJP2",20,0)
 I PSOBYFLD="P" D  I $G(PSOPTFLT)="^" G SEL
"RTN","PSOREJP2",21,0)
 . S (PSODRFLT,PSORXFLT,PSOINFLT)="ALL",PSORJSRT="DR"
"RTN","PSOREJP2",22,0)
 . D SEL^PSOREJU1("PATIENT","^DPT(",.PSOPTFLT)
"RTN","PSOREJP2",23,0)
 ;
"RTN","PSOREJP2",24,0)
 I PSOBYFLD="D" D  I $G(PSODRFLT)="^" G SEL
"RTN","PSOREJP2",25,0)
 . S (PSOPTFLT,PSORXFLT,PSOINFLT)="ALL",PSORJSRT="PA"
"RTN","PSOREJP2",26,0)
 . D SEL^PSOREJU1("DRUG","^PSDRUG(",.PSODRFLT)
"RTN","PSOREJP2",27,0)
 ;
"RTN","PSOREJP2",28,0)
 I PSOBYFLD="R" D  I $D(DUOUT)!$D(DTOUT)!'$G(PSORXFLT) G SEL
"RTN","PSOREJP2",29,0)
 . S (PSOPTFLT,PSODRFLT,PSOINFLT)="ALL",PSORJSRT="PA"
"RTN","PSOREJP2",30,0)
 . N DIC,Y,X,OK K PSOSTFLT,PSORXFLT
"RTN","PSOREJP2",31,0)
 . S DIC=52,DIC(0)="QEZA",DIC("A")="PRESCRIPTION: "
"RTN","PSOREJP2",32,0)
 . F  W ! D ^DIC D  Q:$G(OK) 
"RTN","PSOREJP2",33,0)
 . . I $D(DUOUT)!$D(DTOUT)!(X="") S OK=1 Q
"RTN","PSOREJP2",34,0)
 . . I '$O(^PSRX(+Y,"REJ",0)) D  Q
"RTN","PSOREJP2",35,0)
 . . . W !?40,"Prescription does not have rejects!",$C(7)
"RTN","PSOREJP2",36,0)
 . . S PSORXFLT=+Y,OK=1
"RTN","PSOREJP2",37,0)
 ;
"RTN","PSOREJP2",38,0)
 I PSOBYFLD="I" D  I $O(PSOINFLT(""))="" G SEL
"RTN","PSOREJP2",39,0)
 . S (PSOPTFLT,PSODRFLT,PSORXFLT)="ALL",PSORJSRT="PA"
"RTN","PSOREJP2",40,0)
 . N DIR,Y,X,OK K PSOINFLT W !
"RTN","PSOREJP2",41,0)
 . S DIR("A",1)="Enter the whole or part of the Insurance Company"
"RTN","PSOREJP2",42,0)
 . S DIR("A",2)="name for which you want to view/process REJECTS."
"RTN","PSOREJP2",43,0)
 . S DIR("A",3)=""
"RTN","PSOREJP2",44,0)
 . S DIR(0)="FO^3:30",DIR("A")="  INSURANCE"
"RTN","PSOREJP2",45,0)
 . F  D ^DIR D  Q:$G(OK) 
"RTN","PSOREJP2",46,0)
 . . I $D(DIRUT)!(X="") S OK=1 Q
"RTN","PSOREJP2",47,0)
 . . S PSOINFLT(X)="" K DIR("A") S DIR("A")="ANOTHER ONE"
"RTN","PSOREJP2",48,0)
 ;
"RTN","PSOREJP2",49,0)
 ; - Status Selection (UNRESOLVED or RESOLVED)
"RTN","PSOREJP2",50,0)
 I $G(PSOSTFLT)="" D  I $D(DIRUT) G EXIT
"RTN","PSOREJP2",51,0)
 . S DIR(0)="S^U:UNRESOLVED;R:RESOLVED;B:BOTH",DIR("B")="B"
"RTN","PSOREJP2",52,0)
 . S DIR("A")="(U)NRESOLVED, (R)RESOLVED or (B)OTH REJECT statuses" D ^DIR
"RTN","PSOREJP2",53,0)
 . S PSOSTFLT=Y
"RTN","PSOREJP2",54,0)
 ;
"RTN","PSOREJP2",55,0)
 D LST^PSOREJP0("VP")
"RTN","PSOREJP2",56,0)
 ;
"RTN","PSOREJP2",57,0)
EXIT Q
"RTN","PSOREJP2",58,0)
 ;
"RTN","PSOREJP2",59,0)
CLO      ; - Ignore a REJECT hidden action
"RTN","PSOREJP2",60,0)
 N PSOTRIC,X
"RTN","PSOREJP2",61,0)
 S PSOTRIC="",PSOTRIC=$$TRIC^PSOREJP1(RX,FILL,PSOTRIC)
"RTN","PSOREJP2",62,0)
 I $G(PSOTRIC) S VALMSG="INVALID: TRICARE rejected Rxs may not be ignored.",VALMBCK="R" Q
"RTN","PSOREJP2",63,0)
 I $$CLOSED^PSOREJP1(RX,REJ) D  Q
"RTN","PSOREJP2",64,0)
 . S VALMSG="This Reject is marked resolved!",VALMBCK="R"
"RTN","PSOREJP2",65,0)
 N DIR,COM
"RTN","PSOREJP2",66,0)
 D FULL^VALM1
"RTN","PSOREJP2",67,0)
 I '$$SIG^PSOREJU1() S VALMBCK="R" Q
"RTN","PSOREJP2",68,0)
 W !
"RTN","PSOREJP2",69,0)
 S COM=$$COM^PSOREJU1() I COM="^" S VALMBCK="R" Q
"RTN","PSOREJP2",70,0)
 W !
"RTN","PSOREJP2",71,0)
 S DIR(0)="Y",DIR("A")="     Confirm? ",DIR("B")="NO"
"RTN","PSOREJP2",72,0)
 S DIR("A",1)="     When you confirm this REJECT will be marked RESOLVED."
"RTN","PSOREJP2",73,0)
 S DIR("A",2)=" "
"RTN","PSOREJP2",74,0)
 D ^DIR I $G(Y)=0!$D(DIRUT) S VALMBCK="R" Q
"RTN","PSOREJP2",75,0)
 W ?40,"[Closing..." D CLOSE^PSOREJUT(RX,FILL,REJ,DUZ,6,COM) W "OK]",!,$C(7) H 1
"RTN","PSOREJP2",76,0)
 I $D(PSOSTFLT),PSOSTFLT'="B" S CHANGE=1
"RTN","PSOREJP2",77,0)
 ;
"RTN","PSOREJP2",78,0)
 I $$PTLBL(RX,FILL) D PRINT^PSOREJP3(RX,FILL)
"RTN","PSOREJP2",79,0)
 ;
"RTN","PSOREJP2",80,0)
 Q
"RTN","PSOREJP2",81,0)
 ;
"RTN","PSOREJP2",82,0)
OPN ; - Re-open a Closed/Resolved Reject
"RTN","PSOREJP2",83,0)
 I '$$CLOSED^PSOREJP1(RX,REJ) D  Q
"RTN","PSOREJP2",84,0)
 . S VALMSG="This Reject is NOT marked resolved!",VALMBCK="R"
"RTN","PSOREJP2",85,0)
 N DIR,COM,REJDATA,NEWDATA,X,REOPEN
"RTN","PSOREJP2",86,0)
 D FULL^VALM1
"RTN","PSOREJP2",87,0)
 I '$$SIG^PSOREJU1() S VALMBCK="R" Q
"RTN","PSOREJP2",88,0)
 W !
"RTN","PSOREJP2",89,0)
 S DIR(0)="Y",DIR("A")="     Confirm",DIR("B")="NO"
"RTN","PSOREJP2",90,0)
 S DIR("A",1)="     When you confirm this REJECT will be marked UNRESOLVED."
"RTN","PSOREJP2",91,0)
 S DIR("A",2)=" "
"RTN","PSOREJP2",92,0)
 D ^DIR I $G(Y)=0!$D(DIRUT) S VALMBCK="R" Q
"RTN","PSOREJP2",93,0)
 ;
"RTN","PSOREJP2",94,0)
 W ?40,"[Re-opening..."
"RTN","PSOREJP2",95,0)
 K REJDATA D GET^PSOREJU2(RX,FILL,.REJDATA,REJ,1) D SETOPN^PSOREJU2(RX,REJ)
"RTN","PSOREJP2",96,0)
 K NEWDATA M NEWDATA=REJDATA(REJ) S NEWDATA("PHARMACIST")=DUZ
"RTN","PSOREJP2",97,0)
 S REOPEN=1 D SAVE^PSOREJUT(RX,FILL,.NEWDATA,REOPEN)
"RTN","PSOREJP2",98,0)
 I $G(NEWDATA("REJECT IEN")),$D(REJDATA(REJ,"COMMENTS")) D
"RTN","PSOREJP2",99,0)
 . S COM=0 F  S COM=$O(REJDATA(REJ,"COMMENTS",COM)) Q:'COM  D
"RTN","PSOREJP2",100,0)
 . . S X(1)=REJDATA(REJ,"COMMENTS",COM,"COMMENTS")
"RTN","PSOREJP2",101,0)
 . . S X(2)=REJDATA(REJ,"COMMENTS",COM,"DATE/TIME")
"RTN","PSOREJP2",102,0)
 . . S X(3)=REJDATA(REJ,"COMMENTS",COM,"USER")
"RTN","PSOREJP2",103,0)
 . . D SAVECOM^PSOREJP3(RX,NEWDATA("REJECT IEN"),X(1),X(2),X(3))
"RTN","PSOREJP2",104,0)
 D RETRXF^PSOREJU2(RX,FILL,0)
"RTN","PSOREJP2",105,0)
 W "OK]",!,$C(7) H 1
"RTN","PSOREJP2",106,0)
 S CHANGE=1
"RTN","PSOREJP2",107,0)
 Q
"RTN","PSOREJP2",108,0)
 ;
"RTN","PSOREJP2",109,0)
CHG ; - Change Suspense Date action
"RTN","PSOREJP2",110,0)
 I $$CLOSED^PSOREJP1(RX,REJ) D  Q
"RTN","PSOREJP2",111,0)
 . S VALMSG="This Reject is marked resolved!",VALMBCK="R" W $C(7)
"RTN","PSOREJP2",112,0)
 ;
"RTN","PSOREJP2",113,0)
 N SUSDT,PSOMSG,Y,SUSRX,%DT,DA,DIE,DR,ISSDT,EXPDT,PSOMSG,CUTDT,FILDT
"RTN","PSOREJP2",114,0)
 ;
"RTN","PSOREJP2",115,0)
 S RFL=+$$GET1^DIQ(52.25,REJ_","_RX,5),SUSDT=$$RXSUDT^PSOBPSUT(RX,RFL)
"RTN","PSOREJP2",116,0)
 I RFL>0 S FILDT=$$GET1^DIQ(52.1,RFL_","_RX,.01,"I")
"RTN","PSOREJP2",117,0)
 E  S FILDT=$$GET1^DIQ(52,RX,22,"I")
"RTN","PSOREJP2",118,0)
 I SUSDT="" S VALMSG="Prescription is not suspended!",VALMBCK="R" W $C(7) Q
"RTN","PSOREJP2",119,0)
 I $$RXRLDT^PSOBPSUT(RX,RFL) S VALMSG="Prescription has been released already!",VALMBCK="R" W $C(7) Q
"RTN","PSOREJP2",120,0)
 D PSOL^PSSLOCK(RX) I '$G(PSOMSG) S VALMSG=$P(PSOMSG,"^",2),VALMBCK="R" W $C(7) Q
"RTN","PSOREJP2",121,0)
 ;
"RTN","PSOREJP2",122,0)
 S ISSDT=$$GET1^DIQ(52,RX,1,"I"),EXPDT=$$GET1^DIQ(52,RX,26,"I")
"RTN","PSOREJP2",123,0)
 S SUSRX=$O(^PS(52.5,"B",RX,0))
"RTN","PSOREJP2",124,0)
 ;
"RTN","PSOREJP2",125,0)
SUDT ; Asks for the new Suspense Date
"RTN","PSOREJP2",126,0)
 S X1=FILDT,X2=+89 D C^%DTC S CUTDT=X
"RTN","PSOREJP2",127,0)
 D FULL^VALM1 S %DT("B")=$$FMTE^XLFDT(SUSDT),%DT="EA",%DT("A")="SUSPENSE DATE: "
"RTN","PSOREJP2",128,0)
 W ! D ^%DT I Y<0!($D(DTOUT)) D PSOUL^PSSLOCK(RX) S VALMBCK="R" Q
"RTN","PSOREJP2",129,0)
 I Y<ISSDT D  G SUDT
"RTN","PSOREJP2",130,0)
 . W !!?5,"Suspense Date cannot be before Issue Date: ",$$FMTE^XLFDT(ISSDT),".",$C(7)
"RTN","PSOREJP2",131,0)
 I Y>EXPDT D  G SUDT
"RTN","PSOREJP2",132,0)
 . W !!?5,"Suspense Date cannot be after Expiration Date: ",$$FMTE^XLFDT(EXPDT),".",$C(7)
"RTN","PSOREJP2",133,0)
 I Y>CUTDT D  G SUDT
"RTN","PSOREJP2",134,0)
 . W !!?5,"Suspense Date cannot be after fill date plus 90 days: "_$$FMTE^XLFDT(CUTDT),".",$C(7)
"RTN","PSOREJP2",135,0)
 S SUSDT=Y
"RTN","PSOREJP2",136,0)
 ;
"RTN","PSOREJP2",137,0)
 N DIR,DIRUT W !
"RTN","PSOREJP2",138,0)
 S DIR("A",1)="     When you confirm, this REJECT will be marked resolved. A"
"RTN","PSOREJP2",139,0)
 S DIR("A",2)="     new claim will be re-submitted to the 3rd party payer"
"RTN","PSOREJP2",140,0)
 I $$GET1^DIQ(52.5,SUSRX,3)="" D
"RTN","PSOREJP2",141,0)
 . I SUSDT>DT D
"RTN","PSOREJP2",142,0)
 . . S DIR("A",3)="     when the prescription label for this fill is printed"
"RTN","PSOREJP2",143,0)
 . . S DIR("A",4)="     from suspense on "_$$FMTE^XLFDT(SUSDT)_"."
"RTN","PSOREJP2",144,0)
 . . S DIR("A",5)=" "
"RTN","PSOREJP2",145,0)
 . . S DIR("A",6)="     Note: THE LABEL FOR THIS PRESCRIPTION FILL WILL NOT BE"
"RTN","PSOREJP2",146,0)
 . . S DIR("A",7)="           PRINTED LOCAL FROM SUSPENSE BEFORE "_$$FMTE^XLFDT(SUSDT)_"."
"RTN","PSOREJP2",147,0)
 . E  D
"RTN","PSOREJP2",148,0)
 . . S DIR("A",3)="     the next time local labels are printed from suspense."
"RTN","PSOREJP2",149,0)
 E  D
"RTN","PSOREJP2",150,0)
 . I SUSDT>DT D
"RTN","PSOREJP2",151,0)
 . . S DIR("A",3)="     when the prescription is transmitted to CMOP on "
"RTN","PSOREJP2",152,0)
 . . S DIR("A",4)="     "_$$FMTE^XLFDT(SUSDT)_"."
"RTN","PSOREJP2",153,0)
 . . S DIR("A",5)=" "
"RTN","PSOREJP2",154,0)
 . . S DIR("A",6)="     Note: THIS PRESCRIPTION FILL WILL NOT BE TRANSMITTED TO"
"RTN","PSOREJP2",155,0)
 . . S DIR("A",7)="           CMOP BEFORE "_$$FMTE^XLFDT(SUSDT)_"."
"RTN","PSOREJP2",156,0)
 . E  D
"RTN","PSOREJP2",157,0)
 . . S DIR("A",3)="     when this prescription fill is transmitted to CMOP on"
"RTN","PSOREJP2",158,0)
 . . S DIR("A",4)="     the next CMOP transmission."
"RTN","PSOREJP2",159,0)
    ;
"RTN","PSOREJP2",160,0)
 S DIR("A",$O(DIR("A",""),-1)+1)=" "
"RTN","PSOREJP2",161,0)
 S DIR(0)="Y",DIR("A")="     Confirm? ",DIR("B")="YES"
"RTN","PSOREJP2",162,0)
 D ^DIR I $G(Y)=0!$D(DIRUT) S VALMBCK="R" D PSOUL^PSSLOCK(RX) Q
"RTN","PSOREJP2",163,0)
 ;
"RTN","PSOREJP2",164,0)
 ; - Suspense/Fill Date updates
"RTN","PSOREJP2",165,0)
 I SUSDT'=$$RXSUDT^PSOBPSUT(RX,RFL) D
"RTN","PSOREJP2",166,0)
 . N DA,DIE,DR,PSOX,SFN,INDT,DEAD
"RTN","PSOREJP2",167,0)
 . S DA=SUSRX,DIE="^PS(52.5,",DR=".02///"_SUSDT D ^DIE
"RTN","PSOREJP2",168,0)
 . S SFN=SUSRX,DEAD=0,INDT=SUSDT D CHANGE^PSOSUCH1(RX,RFL)
"RTN","PSOREJP2",169,0)
 ;
"RTN","PSOREJP2",170,0)
 ; - Flagging the prescription to be re-submitted to ECME on the next CMOP/Print from Suspense
"RTN","PSOREJP2",171,0)
 D RETRXF^PSOREJU2(RX,RFL,1)
"RTN","PSOREJP2",172,0)
 W ?40,"[Closing..."
"RTN","PSOREJP2",173,0)
 D CLOSE^PSOREJUT(RX,RFL,REJ,DUZ,8,"Fill Date changed to "_$$FMTE^XLFDT(SUSDT)_". A new claim will be re-submitted on this date.")
"RTN","PSOREJP2",174,0)
 W "OK]",!,$C(7) H 1 I $D(PSOSTFLT),PSOSTFLT'="B" S CHANGE=1
"RTN","PSOREJP2",175,0)
 D PSOUL^PSSLOCK(RX)
"RTN","PSOREJP2",176,0)
 Q
"RTN","PSOREJP2",177,0)
 ;
"RTN","PSOREJP2",178,0)
PTLBL(RX,RFL) ; Returns whether the user should be prompted for 'Print Label?' or not
"RTN","PSOREJP2",179,0)
 N PTLBL,CMP,LBL,REPRINT
"RTN","PSOREJP2",180,0)
 N PSOTRIC S PSOTRIC="",PSOTRIC=$$TRIC^PSOREJP1(RX,RFL,.PSOTRIC)
"RTN","PSOREJP2",181,0)
 I $$FIND^PSOREJUT(RX,RFL) Q 0       ; Has OPEN/UNRESOLVED 3rd pary payer reject
"RTN","PSOREJP2",182,0)
 I $$GET1^DIQ(52,RX,100,"I") Q 0     ; Rx status not ACTIVE
"RTN","PSOREJP2",183,0)
 I $$RXRLDT^PSOBPSUT(RX,RFL),'PSOTRIC Q 0     ; Rx Released
"RTN","PSOREJP2",184,0)
 ; - CMOP Rx fill?
"RTN","PSOREJP2",185,0)
 S PTLBL=1,CMP=0
"RTN","PSOREJP2",186,0)
 F  S CMP=$O(^PSRX(RX,4,CMP)) Q:'CMP  D  Q:'PTLBL
"RTN","PSOREJP2",187,0)
 . I +$$GET1^DIQ(52.01,CMP_","_RX,2,"I")=RFL S PTLBL=0
"RTN","PSOREJP2",188,0)
 I 'PTLBL Q 0
"RTN","PSOREJP2",189,0)
 ; - Label already printed for Rx fill?
"RTN","PSOREJP2",190,0)
 S LBL=0
"RTN","PSOREJP2",191,0)
 F  S LBL=$O(^PSRX(RX,"L",LBL)) Q:'LBL  D  Q:'PTLBL
"RTN","PSOREJP2",192,0)
 . I +$$GET1^DIQ(52.032,LBL_","_RX,1,"I")'=RFL Q
"RTN","PSOREJP2",193,0)
 . I $G(PSOTRIC)&($$RXRLDT^PSOBPSUT(RX,RFL)) S REPRINT=1 Q
"RTN","PSOREJP2",194,0)
 . I $$GET1^DIQ(52.032,LBL_","_RX,4,"I") Q
"RTN","PSOREJP2",195,0)
 . I $$GET1^DIQ(52.032,LBL_","_RX,2)["INTERACTION" Q
"RTN","PSOREJP2",196,0)
 . S PTLBL=0
"RTN","PSOREJP2",197,0)
 ;
"RTN","PSOREJP2",198,0)
 I PTLBL D
"RTN","PSOREJP2",199,0)
 . N DIR,DIRUT,Y
"RTN","PSOREJP2",200,0)
 . W ! S DIR(0)="Y",DIR("A")=$S('$G(REPRINT):"Print Label",1:"Reprint Label"),DIR("B")="YES"
"RTN","PSOREJP2",201,0)
 . D ^DIR I $G(Y)=0!$D(DIRUT) S PTLBL=0 Q
"RTN","PSOREJP2",202,0)
 ;
"RTN","PSOREJP2",203,0)
 Q PTLBL
"RTN","PSOREJP2",204,0)
 ;
"RTN","PSOREJP2",205,0)
DTRNG(BGN,END) ; Date Range Selection
"RTN","PSOREJP2",206,0)
 ;Input: (o) BGN - Default Begin Date 
"RTN","PSOREJP2",207,0)
 ;       (o) END - Default End Date 
"RTN","PSOREJP2",208,0)
 ;
"RTN","PSOREJP2",209,0)
 N %DT,DTOUT,DUOUT,DTRNG,X,Y
"RTN","PSOREJP2",210,0)
 S DTRNG=""
"RTN","PSOREJP2",211,0)
 S %DT="AEST",%DT("A")="BEGIN REJECT DATE: ",%DT("B")=$G(BGN) K:$G(BGN)="" %DT("B") D ^%DT
"RTN","PSOREJP2",212,0)
 I $G(DUOUT)!$G(DTOUT)!($G(Y)=-1) Q "^"
"RTN","PSOREJP2",213,0)
 S $P(DTRNG,U)=Y
"RTN","PSOREJP2",214,0)
 ;
"RTN","PSOREJP2",215,0)
 W ! K %DT
"RTN","PSOREJP2",216,0)
 S %DT="AEST",%DT("A")="END REJECT DATE: ",%DT("B")=$G(END),%DT(0)=Y K:$G(END)="" %DT("B") D ^%DT
"RTN","PSOREJP2",217,0)
 I $G(DUOUT)!$G(DTOUT)!($G(Y)=-1) Q "^"
"RTN","PSOREJP2",218,0)
 ;
"RTN","PSOREJP2",219,0)
 ;Define Entry
"RTN","PSOREJP2",220,0)
 S $P(DTRNG,U,2)=Y
"RTN","PSOREJP2",221,0)
 ;
"RTN","PSOREJP2",222,0)
 Q DTRNG
"RTN","PSOREJP3")
0^38^B48298782
"RTN","PSOREJP3",1,0)
PSOREJP3 ;ALB/SS - Third Party Reject Display Screen - Comments ;10/27/06
"RTN","PSOREJP3",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**260,287,289**;DEC 1997;Build 107
"RTN","PSOREJP3",3,0)
 ;
"RTN","PSOREJP3",4,0)
COM ; Builds the Comments section in the Reject Display Screen
"RTN","PSOREJP3",5,0)
 I +$O(^PSRX(RX,"REJ",REJ,"COM",0))=0 Q
"RTN","PSOREJP3",6,0)
 D SETLN^PSOREJP1()
"RTN","PSOREJP3",7,0)
 D SETLN^PSOREJP1("COMMENTS",1,1)
"RTN","PSOREJP3",8,0)
 N DIWL,DIWR,LNCNT,MAXLN,PSL
"RTN","PSOREJP3",9,0)
 N I,X,PSI,Y,LAST,PSOCOM,TXTLN
"RTN","PSOREJP3",10,0)
 S PSI=999999
"RTN","PSOREJP3",11,0)
 F  S PSI=$O(^PSRX(RX,"REJ",REJ,"COM",PSI),-1) Q:+PSI=0  D
"RTN","PSOREJP3",12,0)
 . S PSCOM=$$GET1^DIQ(52.2551,PSI_","_REJ_","_RX,.01)_" - "
"RTN","PSOREJP3",13,0)
 . S PSCOM=PSCOM_$$GET1^DIQ(52.2551,PSI_","_REJ_","_RX,2)
"RTN","PSOREJP3",14,0)
 . S PSCOM=PSCOM_" ("_$$GET1^DIQ(52.2551,PSI_","_REJ_","_RX,1)_")"
"RTN","PSOREJP3",15,0)
 . ;display comment
"RTN","PSOREJP3",16,0)
 . K ^UTILITY($J,"W") S X=PSCOM,DIWL=1,DIWR=78 D ^DIWP
"RTN","PSOREJP3",17,0)
 . F PSL=1:1 Q:('$D(^UTILITY($J,"W",1,PSL,0)))  D
"RTN","PSOREJP3",18,0)
 . . S LAST=0 I '$D(^UTILITY($J,"W",1,PSL+1)),'$O(^PSRX(RX,"REJ",REJ,"COM",PSI),-1) S LAST=1
"RTN","PSOREJP3",19,0)
 . . S TXTLN=$G(^UTILITY($J,"W",1,PSL,0))
"RTN","PSOREJP3",20,0)
 . . D SETLN^PSOREJP1($S(PSL=1:"- ",1:"  ")_TXTLN,0,$S(LAST:1,1:0),1)
"RTN","PSOREJP3",21,0)
 K ^UTILITY($J,"W")
"RTN","PSOREJP3",22,0)
 Q
"RTN","PSOREJP3",23,0)
 ;
"RTN","PSOREJP3",24,0)
ADDCOM ; - Add comment worklist action
"RTN","PSOREJP3",25,0)
 N PSCOM
"RTN","PSOREJP3",26,0)
 D FULL^VALM1
"RTN","PSOREJP3",27,0)
 S PSCOM=$$COMMENT("Comment: ",150)
"RTN","PSOREJP3",28,0)
 I $L(PSCOM)>0,PSCOM'["^" D
"RTN","PSOREJP3",29,0)
 . D SAVECOM(RX,REJ,PSCOM) ;save the comment
"RTN","PSOREJP3",30,0)
 . D INIT^PSOREJP1 ;update screen
"RTN","PSOREJP3",31,0)
 S VALMBCK="R"
"RTN","PSOREJP3",32,0)
 Q
"RTN","PSOREJP3",33,0)
 ;
"RTN","PSOREJP3",34,0)
 ;Enter a comment
"RTN","PSOREJP3",35,0)
 ;PSOTR  -prompt string
"RTN","PSOREJP3",36,0)
 ;PSMLEN -maxlen
"RTN","PSOREJP3",37,0)
 ;returns:
"RTN","PSOREJP3",38,0)
 ; "^" - if user chose to quit 
"RTN","PSOREJP3",39,0)
 ; "" - nothing entered or input has been discarded
"RTN","PSOREJP3",40,0)
 ; otherwise - comment's text
"RTN","PSOREJP3",41,0)
COMMENT(PSOTR,PSMLEN) ;*/
"RTN","PSOREJP3",42,0)
 N DIR,DTOUT,DUOUT,PSQ
"RTN","PSOREJP3",43,0)
 I '$D(PSOTR) S PSOTR="Comment "
"RTN","PSOREJP3",44,0)
 I '$D(PSMLEN) S PSMLEN=150
"RTN","PSOREJP3",45,0)
 S DIR(0)="FA^1:150"
"RTN","PSOREJP3",46,0)
 S DIR("A")=PSOTR
"RTN","PSOREJP3",47,0)
 S DIR("?")="Enter a free text comment up to 150 characters long."
"RTN","PSOREJP3",48,0)
 S PSQ=0
"RTN","PSOREJP3",49,0)
 F  D  Q:+PSQ'=0
"RTN","PSOREJP3",50,0)
 . W ! D ^DIR
"RTN","PSOREJP3",51,0)
 . I $D(DUOUT)!($D(DTOUT)) S PSQ=-1 Q
"RTN","PSOREJP3",52,0)
 . I $L(Y)'>PSMLEN S PSQ=1 Q
"RTN","PSOREJP3",53,0)
 . W !!,"Enter a free text comment up to 150 characters long.",!
"RTN","PSOREJP3",54,0)
 . S DIR("B")=$E(Y,1,PSMLEN)
"RTN","PSOREJP3",55,0)
 Q:PSQ<0 "^"
"RTN","PSOREJP3",56,0)
 Q:$L(Y)=0 ""
"RTN","PSOREJP3",57,0)
 S PSQ=$$YESNO("Confirm","YES")
"RTN","PSOREJP3",58,0)
 I PSQ=-1 Q "^"
"RTN","PSOREJP3",59,0)
 I PSQ=0 Q ""
"RTN","PSOREJP3",60,0)
 Q Y
"RTN","PSOREJP3",61,0)
 ;
"RTN","PSOREJP3",62,0)
 ; Ask
"RTN","PSOREJP3",63,0)
 ; Input:
"RTN","PSOREJP3",64,0)
 ;  PSQSTR - question
"RTN","PSOREJP3",65,0)
 ;  PSDFL - default answer
"RTN","PSOREJP3",66,0)
 ; Output: 
"RTN","PSOREJP3",67,0)
 ; 1 YES
"RTN","PSOREJP3",68,0)
 ; 0 NO
"RTN","PSOREJP3",69,0)
 ; -1 if cancelled
"RTN","PSOREJP3",70,0)
YESNO(PSQSTR,PSDFL) ; Default - YES
"RTN","PSOREJP3",71,0)
 N DIR,Y,DUOUT
"RTN","PSOREJP3",72,0)
 S DIR(0)="Y"
"RTN","PSOREJP3",73,0)
 S DIR("A")=PSQSTR
"RTN","PSOREJP3",74,0)
 S:$L($G(PSDFL)) DIR("B")=PSDFL
"RTN","PSOREJP3",75,0)
 W ! D ^DIR
"RTN","PSOREJP3",76,0)
 Q $S($G(DUOUT)!$G(DUOUT)!(Y="^"):-1,1:Y)
"RTN","PSOREJP3",77,0)
 ;
"RTN","PSOREJP3",78,0)
 ;Save comment
"RTN","PSOREJP3",79,0)
SAVECOM(PSRXIEN,PSREJIEN,PSCOMNT,DATETIME,USER) ;
"RTN","PSOREJP3",80,0)
 N PSREC,PSDA,PSERR
"RTN","PSOREJP3",81,0)
 I '$G(DATETIME) D NOW^%DTC S DATETIME=%
"RTN","PSOREJP3",82,0)
 I '$G(USER) S USER=DUZ
"RTN","PSOREJP3",83,0)
 D INSITEM(52.2551,PSRXIEN,PSREJIEN,DATETIME)
"RTN","PSOREJP3",84,0)
 S PSREC=$O(^PSRX(PSRXIEN,"REJ",PSREJIEN,"COM","B",DATETIME,0))
"RTN","PSOREJP3",85,0)
 I PSREC>0 D
"RTN","PSOREJP3",86,0)
 . S PSDA(52.2551,PSREC_","_PSREJIEN_","_PSRXIEN_",",1)=USER
"RTN","PSOREJP3",87,0)
 . S PSDA(52.2551,PSREC_","_PSREJIEN_","_PSRXIEN_",",2)=$G(PSCOMNT)
"RTN","PSOREJP3",88,0)
 . D FILE^DIE("","PSDA","PSERR")
"RTN","PSOREJP3",89,0)
 Q
"RTN","PSOREJP3",90,0)
 ;
"RTN","PSOREJP3",91,0)
 ;/**
"RTN","PSOREJP3",92,0)
 ;PSSFILE - subfile# (52.2551) for comment
"RTN","PSOREJP3",93,0)
 ;PSIEN - ien for file in which the new subfile entry will be inserted
"RTN","PSOREJP3",94,0)
 ;PSVAL01 - .01 value for the new entry
"RTN","PSOREJP3",95,0)
INSITEM(PSSFILE,PSIEN0,PSIEN1,PSVAL01) ;*/
"RTN","PSOREJP3",96,0)
 N PSSSI,PSIENS,PSFDA,PSER
"RTN","PSOREJP3",97,0)
 S PSIENS="+1,"_PSIEN1_","_PSIEN0_","
"RTN","PSOREJP3",98,0)
 S PSFDA(PSSFILE,PSIENS,.01)=PSVAL01
"RTN","PSOREJP3",99,0)
 D UPDATE^DIE("","PSFDA","PSSSI","PSER")
"RTN","PSOREJP3",100,0)
 I $D(PSER) D BMES^XPDUTL(PSER("DIERR",1,"TEXT",1))
"RTN","PSOREJP3",101,0)
 Q
"RTN","PSOREJP3",102,0)
 ;
"RTN","PSOREJP3",103,0)
PRINT(RX,RFL) ; Print Label for specific Rx/Fill
"RTN","PSOREJP3",104,0)
 N PPL,PSOSITE,PSOPAR,PSOSYS,PSOLAP,PSOBARS,PSOBAR0,PSOBAR1,PSOIOS,PSOBFLAG
"RTN","PSOREJP3",105,0)
 N POP,DFN,PDUZ,RXFL,REPRINT,REJLBL
"RTN","PSOREJP3",106,0)
 S REJLBL=0 F  S REJLBL=$O(^PSRX(RX,"L",REJLBL)) Q:'REJLBL  I +$$GET1^DIQ(52.032,REJLBL_","_RX,1,"I")=RFL S REPRINT=1 Q
"RTN","PSOREJP3",107,0)
 ;
"RTN","PSOREJP3",108,0)
 S PSOSITE=$$RXSITE^PSOBPSUT(RX,RFL),PSOPAR=^PS(59,PSOSITE,1)
"RTN","PSOREJP3",109,0)
 S DFN=$$GET1^DIQ(52,RX,2,"I"),PDUZ=DUZ,PSOSYS=$G(^PS(59.7,1,40.1))
"RTN","PSOREJP3",110,0)
 S PPL=RX I RFL S RXFL(RX)=RFL
"RTN","PSOREJP3",111,0)
 W ! S PSOBFLAG=1 D LBL^PSOLSET I $G(PSOQUIT) Q
"RTN","PSOREJP3",112,0)
 ;
"RTN","PSOREJP3",113,0)
 S IOP=PSOLAP D ^%ZIS,DQ^PSOLBL,^%ZISC
"RTN","PSOREJP3",114,0)
 Q
"RTN","PSOREJP3",115,0)
 ;
"RTN","PSOREJP3",116,0)
RXINFO(RX,FILL,LINE) ; Returns header displayable Rx Information
"RTN","PSOREJP3",117,0)
 N TXT,RXINFO,LBL,CMOP,DRG
"RTN","PSOREJP3",118,0)
 I LINE=1 D
"RTN","PSOREJP3",119,0)
 . S RXINFO="Rx#      : "_$$GET1^DIQ(52,RX,.01)_"/"_FILL
"RTN","PSOREJP3",120,0)
 . S $E(RXINFO,30)="ECME#: "_$E(10000000+RX,2,8)
"RTN","PSOREJP3",121,0)
 . S $E(RXINFO,55)="Fill Date: "_$$FMTE^XLFDT($$RXFLDT^PSOBPSUT(RX,FILL))
"RTN","PSOREJP3",122,0)
 I LINE=2 D
"RTN","PSOREJP3",123,0)
 . S DRG=$$GET1^DIQ(52,RX,6,"I"),CMOP=$S($D(^PSDRUG("AQ",DRG)):1,1:0)
"RTN","PSOREJP3",124,0)
 . S RXINFO=$S(CMOP:"CMOP ",1:"")_"Drug",$E(RXINFO,10)=": "_$E($$GET1^DIQ(52,RX,6),1,43)
"RTN","PSOREJP3",125,0)
 . S $E(RXINFO,56)="NDC Code: "_$$GETNDC^PSONDCUT(RX,FILL)
"RTN","PSOREJP3",126,0)
 Q $G(RXINFO)
"RTN","PSOREJP3",127,0)
 ;
"RTN","PSOREJP3",128,0)
SEND(COD1,COD2,COD3,CLA,PA) ; - Sends Claim to ECME and closes Reject
"RTN","PSOREJP3",129,0)
 N DIR,OVRC,RESP,ALTXT,COM
"RTN","PSOREJP3",130,0)
 S DIR(0)="Y",DIR("A")="     Confirm",DIR("B")="YES"
"RTN","PSOREJP3",131,0)
 S DIR("A",1)="     When you confirm, a new claim will be submitted for"
"RTN","PSOREJP3",132,0)
 S DIR("A",2)="     the prescription and this REJECT will be marked"
"RTN","PSOREJP3",133,0)
 S DIR("A",3)="     resolved."
"RTN","PSOREJP3",134,0)
 S DIR("A",4)=" "
"RTN","PSOREJP3",135,0)
 W ! D ^DIR I $G(Y)=0!$D(DIRUT) S VALMBCK="R" Q
"RTN","PSOREJP3",136,0)
 I $G(COD1)'="" S OVRC=$G(COD2)_"^"_$G(COD1)_"^"_$G(COD3)
"RTN","PSOREJP3",137,0)
 S ALTXT="REJECT WORKLIST"
"RTN","PSOREJP3",138,0)
 S:$G(OVRC)'="" ALTXT=ALTXT_"-DUR OVERRIDE CODES("_$G(COD1)_"/"_$G(COD2)_"/"_$G(COD3)_")"
"RTN","PSOREJP3",139,0)
 S:$G(CLA) ALTXT=ALTXT_"(CLARIF. CODE="_$P(CLA,"^",2)_")"
"RTN","PSOREJP3",140,0)
 S:$G(PA) ALTXT=ALTXT_"(PRIOR AUTH.="_$TR(PA,"^","/")_")"
"RTN","PSOREJP3",141,0)
 D ECMESND^PSOBPSU1(RX,FILL,,"ED",$$GETNDC^PSONDCUT(RX,FILL),,,$G(OVRC),,.RESP,,ALTXT,$G(CLA),$G(PA))
"RTN","PSOREJP3",142,0)
 I $G(RESP) D  Q
"RTN","PSOREJP3",143,0)
 . W !!?10,"Claim could not be submitted. Please try again later!"
"RTN","PSOREJP3",144,0)
 . W !,?10,"Reason: ",$S($P(RESP,"^",2)="":"UNKNOWN",1:$P(RESP,"^",2)),$C(7) H 2
"RTN","PSOREJP3",145,0)
 ;
"RTN","PSOREJP3",146,0)
 I $$PTLBL^PSOREJP2(RX,FILL) D PRINT(RX,FILL)
"RTN","PSOREJP3",147,0)
 ;
"RTN","PSOREJP3",148,0)
 N PSOTRIC S PSOTRIC="",PSOTRIC=$$TRIC^PSOREJP1(RX,FILL,PSOTRIC)
"RTN","PSOREJP3",149,0)
 I $$GET1^DIQ(52,RX,100,"I")=5&(PSOTRIC) D
"RTN","PSOREJP3",150,0)
 . Q:$$STATUS^PSOBPSUT(RX,RFL)'["PAYABLE"
"RTN","PSOREJP3",151,0)
 . N XXX S XXX=""
"RTN","PSOREJP3",152,0)
 . W !,"This prescription can be pulled early from suspense or the label will print"
"RTN","PSOREJP3",153,0)
 . W !,"when PRINT FROM SUSPENSE occurs.",!
"RTN","PSOREJP3",154,0)
 . R !,"Press enter to continue... ",XXX:60
"RTN","PSOREJP3",155,0)
 ;
"RTN","PSOREJP3",156,0)
 I $D(PSOSTFLT),PSOSTFLT'="B" S CHANGE=1
"RTN","PSOREJP3",157,0)
 Q
"RTN","PSOREJP3",158,0)
 ;
"RTN","PSOREJP3",159,0)
FILL ;Fill payable TRICARE Rx
"RTN","PSOREJP3",160,0)
 N COM,OPNREJ,OPNREJ2,OPNREJ3
"RTN","PSOREJP3",161,0)
 D FULL^VALM1
"RTN","PSOREJP3",162,0)
 I $$CLOSED^PSOREJP1(RX,REJ) D  Q
"RTN","PSOREJP3",163,0)
 . S VALMSG="This Reject is marked resolved!",VALMBCK="R"
"RTN","PSOREJP3",164,0)
 I $$STATUS^PSOBPSUT(RX,FILL)'["PAYABLE" S VALMSG="Only Rxs with an E PAYABLE status may be filled.",VALMBCK="R" Q
"RTN","PSOREJP3",165,0)
 S COM="AUTOMATICALLY CLOSED"
"RTN","PSOREJP3",166,0)
 S (OPNREJ,OPNREJ2,OPNREJ3)=""
"RTN","PSOREJP3",167,0)
 S OPNREJ2=0 F  S OPNREJ2=$O(^PSRX(RX,"REJ",OPNREJ2)) Q:OPNREJ2=""!(OPNREJ2'?1N.N)  S OPNREJ=OPNREJ_","_OPNREJ2
"RTN","PSOREJP3",168,0)
 S OPNREJ=$E(OPNREJ,2,999),OPNREJ2=""
"RTN","PSOREJP3",169,0)
 W !?20,"[Closing all rejections for prescription "_$$GET1^DIQ(52,RX,".01")_":"
"RTN","PSOREJP3",170,0)
 F I=1:1 S OPNREJ2=$P(OPNREJ,",",I) Q:OPNREJ2=""  D
"RTN","PSOREJP3",171,0)
 . S OPNREJ3="",OPNREJ3=$$GET1^DIQ(52.25,OPNREJ2_","_RX,".01")
"RTN","PSOREJP3",172,0)
 . W !?25,OPNREJ3_" - "_$$GET1^DIQ(9002313.93,OPNREJ3,".02")_"..."
"RTN","PSOREJP3",173,0)
 . D CLOSE^PSOREJUT(RX,FILL,OPNREJ2,DUZ,1,COM) W "OK]",!,$C(7) H 1
"RTN","PSOREJP3",174,0)
 I $$PTLBL^PSOREJP2(RX,FILL) D PRINT(RX,FILL)
"RTN","PSOREJP3",175,0)
 S VALMBCK="R",CHANGE=1
"RTN","PSOREJP3",176,0)
 Q
"RTN","PSOREJP3",177,0)
 ;
"RTN","PSOREJP3",178,0)
DC ;Discontinue TRICARE Rx
"RTN","PSOREJP3",179,0)
 N ACTION S ACTION="D"
"RTN","PSOREJP3",180,0)
 D FULL^VALM1
"RTN","PSOREJP3",181,0)
 S ACTION=$$DC^PSOREJU1(RX,ACTION)
"RTN","PSOREJP3",182,0)
 I ACTION="Q"!(ACTION="^")!('$G(PSORX("DFLG"))) S VALMSG="NO ACTION TAKEN.",VALMBCK="R" Q
"RTN","PSOREJP3",183,0)
 S CHANGE=1
"RTN","PSOREJP3",184,0)
 Q
"RTN","PSOREJP3",185,0)
 ;
"RTN","PSOREJP4")
0^4^B58124715
"RTN","PSOREJP4",1,0)
PSOREJP4 ;BP/CMF - Pharmacy Rejects List Mail message 
"RTN","PSOREJP4",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**289**;DEC 1997;Build 107
"RTN","PSOREJP4",3,0)
 ;; use of ^VADPT supported by IA#10061
"RTN","PSOREJP4",4,0)
 ;@author  - Chris Flegel
"RTN","PSOREJP4",5,0)
 ;@date    - August 18, 2008
"RTN","PSOREJP4",6,0)
 ;@version - 1.0
"RTN","PSOREJP4",7,0)
 Q
"RTN","PSOREJP4",8,0)
EN ; entry point for background option
"RTN","PSOREJP4",9,0)
 N RESULT,C
"RTN","PSOREJP4",10,0)
 S RESULT=0
"RTN","PSOREJP4",11,0)
 D BEGIN
"RTN","PSOREJP4",12,0)
 I +$$LOAD() D SORT S RESULT=$$MAIL()
"RTN","PSOREJP4",13,0)
 D END
"RTN","PSOREJP4",14,0)
 Q
"RTN","PSOREJP4",15,0)
 ;;
"RTN","PSOREJP4",16,0)
BEGIN ;
"RTN","PSOREJP4",17,0)
 K ^TMP($J,"PSOREJP4")
"RTN","PSOREJP4",18,0)
 Q
"RTN","PSOREJP4",19,0)
 ;;
"RTN","PSOREJP4",20,0)
END ;
"RTN","PSOREJP4",21,0)
 K ^TMP($J,"PSOREJP4")
"RTN","PSOREJP4",22,0)
 Q
"RTN","PSOREJP4",23,0)
 ;;
"RTN","PSOREJP4",24,0)
BUFDATE(DIVISION) ;
"RTN","PSOREJP4",25,0)
 Q:'$G(DIVISION) ""
"RTN","PSOREJP4",26,0)
 N RXDIVBUF,CUTDT
"RTN","PSOREJP4",27,0)
 D:'$D(^TMP($J,"PSOREJP4","DIVISION",DIVISION))
"RTN","PSOREJP4",28,0)
 .S RXDIVBUF=$$GET1^DIQ(52.86,DIVISION,4)
"RTN","PSOREJP4",29,0)
 .S ^TMP($J,"PSOREJP4","DIVISION",DIVISION)=RXDIVBUF
"RTN","PSOREJP4",30,0)
 S RXDIVBUF=+^TMP($J,"PSOREJP4","DIVISION",DIVISION)
"RTN","PSOREJP4",31,0)
 S RXDIVBUF=$S(RXDIVBUF=""!(RXDIVBUF<1):5,1:RXDIVBUF)
"RTN","PSOREJP4",32,0)
 S X1=DT,X2=-RXDIVBUF D C^%DTC S CUTDT=X
"RTN","PSOREJP4",33,0)
 Q CUTDT
"RTN","PSOREJP4",34,0)
 ;
"RTN","PSOREJP4",35,0)
LOAD() ;;
"RTN","PSOREJP4",36,0)
 N RXIEN,REJECT,BUFDATE,REJDATE,COMDATE,DIVISION,COUNT,RXSTAT,RXDIV
"RTN","PSOREJP4",37,0)
 S COUNT=0
"RTN","PSOREJP4",38,0)
 S RXIEN=0
"RTN","PSOREJP4",39,0)
 F  S RXIEN=$O(^PSRX("REJSTS",0,RXIEN)) Q:'RXIEN  D
"RTN","PSOREJP4",40,0)
 .S REJECT=0
"RTN","PSOREJP4",41,0)
 .F  S REJECT=$O(^PSRX("REJSTS",0,RXIEN,REJECT)) Q:'REJECT  D
"RTN","PSOREJP4",42,0)
 ..S RXSTAT=$$GET1^DIQ(52,RXIEN,100,"I") Q:",10,12,13,14,15,"[(","_RXSTAT_",")  ;quit unless active
"RTN","PSOREJP4",43,0)
 ..S RXDIV=$$GET1^DIQ(52,RXIEN,20,"I"),DIVISION="",DIVISION=$O(^PS(52.86,"B",RXDIV,DIVISION))
"RTN","PSOREJP4",44,0)
 ..Q:'DIVISION
"RTN","PSOREJP4",45,0)
 ..S BUFDATE=$$BUFDATE(DIVISION)
"RTN","PSOREJP4",46,0)
 ..S REJDATE=$P(^PSRX(RXIEN,"REJ",REJECT,0),U,2),REJDATE=$P(REJDATE,".")
"RTN","PSOREJP4",47,0)
 ..Q:REJDATE>BUFDATE  ;;quit if reject date is newer than the cutoff date
"RTN","PSOREJP4",48,0)
 ..S COMDATE=""
"RTN","PSOREJP4",49,0)
 ..I $D(^PSRX(RXIEN,"REJ",REJECT,"COM")) S COMDATE=$O(^PSRX(RXIEN,"REJ",REJECT,"COM","B",COMDATE),-1),COMDATE=$P(COMDATE,".")  ;Get the last comments date
"RTN","PSOREJP4",50,0)
 ..;S COMDATE=$O(^PSRX(RXIEN,"REJ",REJECT,"COM","B",BUFDATE))
"RTN","PSOREJP4",51,0)
 ..Q:COMDATE>BUFDATE  ;don't put on the list if comment was defined after cutoff date
"RTN","PSOREJP4",52,0)
 ..S ^TMP($J,"PSOREJP4",DIVISION,RXIEN,REJECT)=RXSTAT
"RTN","PSOREJP4",53,0)
 ..S COUNT=COUNT+1
"RTN","PSOREJP4",54,0)
 Q COUNT
"RTN","PSOREJP4",55,0)
 ;;
"RTN","PSOREJP4",56,0)
SORT ;;
"RTN","PSOREJP4",57,0)
 N DIVISION,RXIEN,RX,DRUGNAME,PATNAME,PATSSN,PATLAST4,REJECT,DFN,RXSTAT
"RTN","PSOREJP4",58,0)
 N ENTRYNUM,SORT,OUT,I,J,LINE,II,COMM1,COMM2
"RTN","PSOREJP4",59,0)
 K ^UTILITY($J,"W")
"RTN","PSOREJP4",60,0)
 S (DIVISION,ENTRYNUM)=0
"RTN","PSOREJP4",61,0)
 F  S DIVISION=$O(^TMP($J,"PSOREJP4",DIVISION)) Q:+DIVISION=0  D
"RTN","PSOREJP4",62,0)
 .S RXIEN=0
"RTN","PSOREJP4",63,0)
 .F  S RXIEN=$O(^TMP($J,"PSOREJP4",DIVISION,RXIEN)) Q:+RXIEN=0  D
"RTN","PSOREJP4",64,0)
 ..S REJECT=0
"RTN","PSOREJP4",65,0)
 ..F  S REJECT=$O(^TMP($J,"PSOREJP4",DIVISION,RXIEN,REJECT)) Q:'REJECT  D
"RTN","PSOREJP4",66,0)
 ...S DFN=$$GET1^DIQ(52,RXIEN,2,"I")
"RTN","PSOREJP4",67,0)
 ...S RXSTAT=$$GET1^DIQ(52,RXIEN,100)
"RTN","PSOREJP4",68,0)
 ...N VA,VADM,VAERR,SORT,OUT
"RTN","PSOREJP4",69,0)
 ...N RXIENS,REJIENS,REFIENS,RXNUM,RXFILL,I
"RTN","PSOREJP4",70,0)
 ...N FILLDATE,REJDATE,DETCDATE,RSNCODE,RSNTEXT
"RTN","PSOREJP4",71,0)
 ...D DEM^VADPT
"RTN","PSOREJP4",72,0)
 ...Q:+$G(VAERR)
"RTN","PSOREJP4",73,0)
 ...S PATNAME=VADM(1)
"RTN","PSOREJP4",74,0)
 ...S PATSSN=VA("PID")
"RTN","PSOREJP4",75,0)
 ...S PATLAST4=VA("BID")
"RTN","PSOREJP4",76,0)
 ...S SORT=PATNAME_U_PATSSN_U
"RTN","PSOREJP4",77,0)
 ...S RXNUM=$$GET1^DIQ(52,RXIEN,.01)
"RTN","PSOREJP4",78,0)
 ...S REJIENS=REJECT_","_RXIEN_","
"RTN","PSOREJP4",79,0)
 ...S RXFILL=$$GET1^DIQ(52.25,REJIENS,5)
"RTN","PSOREJP4",80,0)
 ...S SORT=SORT_RXNUM_U_(999-RXFILL)_U_(999-REJECT)
"RTN","PSOREJP4",81,0)
 ...S OUT=""
"RTN","PSOREJP4",82,0)
 ...S OUT=OUT_$$LJ^XLFSTR(RXNUM_"/"_RXFILL,13)
"RTN","PSOREJP4",83,0)
 ...S PATNAME=$E(PATNAME,1,12)_"("_PATLAST4_")"
"RTN","PSOREJP4",84,0)
 ...S PATNAME=$E(PATNAME,1,18)
"RTN","PSOREJP4",85,0)
 ...S OUT=OUT_$$LJ^XLFSTR(PATNAME,20)
"RTN","PSOREJP4",86,0)
 ...S DRUGNAME=$$GET1^DIQ(52,RXIEN,6)
"RTN","PSOREJP4",87,0)
 ...S DRUGNAME=$E(DRUGNAME,1,22)
"RTN","PSOREJP4",88,0)
 ...S OUT=OUT_$$LJ^XLFSTR(DRUGNAME,24)
"RTN","PSOREJP4",89,0)
 ...S REFIENS=RXFILL_","_RXIEN_","
"RTN","PSOREJP4",90,0)
 ...S FILLDATE=$S(RXFILL=0:$$GET1^DIQ(52,RXIEN,22,"I"),1:$$GET1^DIQ(52.1,REFIENS,.01,"I"))
"RTN","PSOREJP4",91,0)
 ...S FILLDATE=$$FMTE^XLFDT(FILLDATE,2)
"RTN","PSOREJP4",92,0)
 ...S OUT=OUT_$$LJ^XLFSTR(FILLDATE,10)
"RTN","PSOREJP4",93,0)
 ...S DETCDATE=$P($$GET1^DIQ(52.25,REJIENS,1,"I"),".")
"RTN","PSOREJP4",94,0)
 ...S DETCDATE=$$FMTE^XLFDT(DETCDATE,2)
"RTN","PSOREJP4",95,0)
 ...S OUT=OUT_$$LJ^XLFSTR(DETCDATE,8)
"RTN","PSOREJP4",96,0)
 ...S ^TMP($J,"PSOREJP4",DIVISION,"SORT",SORT,0)=RXIEN_U_REJECT
"RTN","PSOREJP4",97,0)
 ...S ^TMP($J,"PSOREJP4",DIVISION,"SORT",SORT,1)=OUT
"RTN","PSOREJP4",98,0)
 ...S OUT="     Rx Status: "_RXSTAT
"RTN","PSOREJP4",99,0)
 ...S ^TMP($J,"PSOREJP4",DIVISION,"SORT",SORT,2)=OUT
"RTN","PSOREJP4",100,0)
 ...S RSNCODE=$$GET1^DIQ(52.25,REJIENS,.01)
"RTN","PSOREJP4",101,0)
 ...S OUT="     Reason:  "_RSNCODE
"RTN","PSOREJP4",102,0)
 ...S RSNCODE=$$FIND1^DIC(9002313.93,,,RSNCODE)
"RTN","PSOREJP4",103,0)
 ...S RSNTEXT=$$GET1^DIQ(9002313.93,RSNCODE_",",.02,"E")
"RTN","PSOREJP4",104,0)
 ...S ^TMP($J,"PSOREJP4",DIVISION,"SORT",SORT,3)=OUT_" :"_RSNTEXT
"RTN","PSOREJP4",105,0)
 ...S LINE=3
"RTN","PSOREJP4",106,0)
 ...D:$D(^PSRX(RXIEN,"REJ",REJECT,"COM"))
"RTN","PSOREJP4",107,0)
 ....N DIWL,DIWR,X
"RTN","PSOREJP4",108,0)
 ....S LINE=LINE+1,COMM1=1
"RTN","PSOREJP4",109,0)
 ....S II=0
"RTN","PSOREJP4",110,0)
 ....F  S II=$O(^PSRX(RXIEN,"REJ",REJECT,"COM",II)) Q:'II  D
"RTN","PSOREJP4",111,0)
 .....N COMIENS,COMDATE,COMUSER,COMTEXT,TXT
"RTN","PSOREJP4",112,0)
 .....S DIWL=1,DIWR=60
"RTN","PSOREJP4",113,0)
 .....K ^UTILITY($J,"W")
"RTN","PSOREJP4",114,0)
 .....S COMIENS=II_","_REJECT_","_RXIEN_","
"RTN","PSOREJP4",115,0)
 .....S COMDATE=$$GET1^DIQ(52.2551,COMIENS,.01)
"RTN","PSOREJP4",116,0)
 .....S X=COMDATE
"RTN","PSOREJP4",117,0)
 .....S COMTEXT=$$GET1^DIQ(52.2551,COMIENS,2)
"RTN","PSOREJP4",118,0)
 .....S X=X_" - "_COMTEXT
"RTN","PSOREJP4",119,0)
 .....S COMUSER=$$GET1^DIQ(52.2551,COMIENS,1)
"RTN","PSOREJP4",120,0)
 .....S X=X_" ("_COMUSER_")"
"RTN","PSOREJP4",121,0)
 .....D ^DIWP
"RTN","PSOREJP4",122,0)
 .....S COMM2=0
"RTN","PSOREJP4",123,0)
 .....F J=1:1 Q:'$D(^UTILITY($J,"W",1,J,0))  D
"RTN","PSOREJP4",124,0)
 ......S TXT=^UTILITY($J,"W",1,J,0),COMM2=COMM2+1
"RTN","PSOREJP4",125,0)
 ......I COMM1=1 S OUT="   COMMENTS: -"_TXT
"RTN","PSOREJP4",126,0)
 ......E  S OUT="             "_$S(COMM2=1:"-",1:"")_TXT
"RTN","PSOREJP4",127,0)
 ......S ^TMP($J,"PSOREJP4",DIVISION,"SORT",SORT,LINE)=OUT
"RTN","PSOREJP4",128,0)
 ......S LINE=LINE+1,(COMM2,COMM1)=COMM1+1
"RTN","PSOREJP4",129,0)
 .....K ^UTILITY($J,"W")
"RTN","PSOREJP4",130,0)
 ...S ^TMP($J,"PSOREJP4",DIVISION,"SORT",SORT,LINE+1)=""
"RTN","PSOREJP4",131,0)
 ;derive entry number for message
"RTN","PSOREJP4",132,0)
 S DIVISION=0
"RTN","PSOREJP4",133,0)
 F  S DIVISION=$O(^TMP($J,"PSOREJP4",DIVISION)) Q:+DIVISION=0  D
"RTN","PSOREJP4",134,0)
 .S SORT=""
"RTN","PSOREJP4",135,0)
 .S ENTRYNUM=0
"RTN","PSOREJP4",136,0)
 .F  S SORT=$O(^TMP($J,"PSOREJP4",DIVISION,"SORT",SORT)) Q:SORT']""  D
"RTN","PSOREJP4",137,0)
 ..S ENTRYNUM=ENTRYNUM+1
"RTN","PSOREJP4",138,0)
 ..S OUT=^TMP($J,"PSOREJP4",DIVISION,"SORT",SORT,1)
"RTN","PSOREJP4",139,0)
 ..S ^TMP($J,"PSOREJP4",DIVISION,"SORT",SORT,1)=$$RJ^XLFSTR(ENTRYNUM,3)_" "_OUT
"RTN","PSOREJP4",140,0)
 ;;
"RTN","PSOREJP4",141,0)
MAIL() ;;
"RTN","PSOREJP4",142,0)
 N DIVISION,RESULT,COUNT,REJECT,I,SORT,COUNT
"RTN","PSOREJP4",143,0)
 S (DIVISION,RESULT)=0
"RTN","PSOREJP4",144,0)
 F  S DIVISION=$O(^TMP($J,"PSOREJP4",DIVISION)) Q:+DIVISION=0  D
"RTN","PSOREJP4",145,0)
 .N XMSUB,XMDUZ,XMTEXT,XMY
"RTN","PSOREJP4",146,0)
 .S XMSUB="ePharmacy - OPEN/UNRESOLVED REJECTS LIST for "_$$GET1^DIQ(52.86,DIVISION,.01)
"RTN","PSOREJP4",147,0)
 .S XMDUZ="OUTPATIENT PHARMACY PACKAGE"
"RTN","PSOREJP4",148,0)
 .S XMTEXT="^TMP($J,""PSOREJP4"",""MESSAGE"","
"RTN","PSOREJP4",149,0)
 .S XMY("G.PSO REJECTS BACKGROUND MESSAGE")=""
"RTN","PSOREJP4",150,0)
 .K ^TMP($J,"PSOREJP4","MESSAGE")
"RTN","PSOREJP4",151,0)
 .S ^TMP($J,"PSOREJP4","MESSAGE",1)="The prescriptions listed below are third party electronically billable and can"
"RTN","PSOREJP4",152,0)
 .S ^TMP($J,"PSOREJP4","MESSAGE",2)="not be filled until the rejection is resolved.  No action to resolve the"
"RTN","PSOREJP4",153,0)
 .S ^TMP($J,"PSOREJP4","MESSAGE",3)="rejection has taken place within the past "_^TMP($J,"PSOREJP4","DIVISION",DIVISION)_" days."
"RTN","PSOREJP4",154,0)
 .S ^TMP($J,"PSOREJP4","MESSAGE",4)=""
"RTN","PSOREJP4",155,0)
 .S ^TMP($J,"PSOREJP4","MESSAGE",5)="Please use the THIRD PARTY PAYER REJECTS WORKLIST option to resolve the"
"RTN","PSOREJP4",156,0)
 .S ^TMP($J,"PSOREJP4","MESSAGE",6)="rejection or add a comment to the rejection."
"RTN","PSOREJP4",157,0)
 .S ^TMP($J,"PSOREJP4","MESSAGE",7)=""
"RTN","PSOREJP4",158,0)
 .S ^TMP($J,"PSOREJP4","MESSAGE",8)="Unresolved rejects will not be sent to CMOP or the local print queue for"
"RTN","PSOREJP4",159,0)
 .S ^TMP($J,"PSOREJP4","MESSAGE",9)="filling.  They will continue to show on the rejects list until acted upon."
"RTN","PSOREJP4",160,0)
 .S ^TMP($J,"PSOREJP4","MESSAGE",10)=""
"RTN","PSOREJP4",161,0)
 .S ^TMP($J,"PSOREJP4","MESSAGE",11)="                                                             FILL      REJECT"
"RTN","PSOREJP4",162,0)
 .S ^TMP($J,"PSOREJP4","MESSAGE",12)="  # RX/FILL      PATIENT(ID)         DRUG                    DATE      DATE"
"RTN","PSOREJP4",163,0)
 .S ^TMP($J,"PSOREJP4","MESSAGE",13)="------------------------------------------------------------------------------"
"RTN","PSOREJP4",164,0)
 .S COUNT=14
"RTN","PSOREJP4",165,0)
 .S SORT=""
"RTN","PSOREJP4",166,0)
 .F  S SORT=$O(^TMP($J,"PSOREJP4",DIVISION,"SORT",SORT)) Q:SORT']""  D
"RTN","PSOREJP4",167,0)
 ..S I=0
"RTN","PSOREJP4",168,0)
 ..F  S I=$O(^TMP($J,"PSOREJP4",DIVISION,"SORT",SORT,I)) Q:'I  S COUNT=COUNT+1,^TMP($J,"PSOREJP4","MESSAGE",COUNT)=^(I) D
"RTN","PSOREJP4",169,0)
 .D ^XMD
"RTN","PSOREJP4",170,0)
 .S:+$G(XMZ) RESULT=XMZ
"RTN","PSOREJP4",171,0)
 Q RESULT
"RTN","PSOREJU1")
0^36^B57825084
"RTN","PSOREJU1",1,0)
PSOREJU1 ;BIRM/MFR - BPS (ECME) - Clinical Rejects Utilities (1) ;10/15/04
"RTN","PSOREJU1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**148,247,260,287,289**;DEC 1997;Build 107
"RTN","PSOREJU1",3,0)
 ;Reference to File 9002313.21 - BPS NCPDP PROFESSIONAL SERVICE CODE supported by IA 4712
"RTN","PSOREJU1",4,0)
 ;Reference to File 9002313.22 - BPS NCPDP RESULT OF SERVICE CODE supported by IA 4713
"RTN","PSOREJU1",5,0)
 ;Reference to File 9002313.23 - BPS NCPDP REASON FOR SERVICE CODE supported by IA 4714
"RTN","PSOREJU1",6,0)
 ;Reference to File 200 - NEW PERSON supported by IA 10060
"RTN","PSOREJU1",7,0)
 ;Reference to SIG^XUSESIG supported by IA 10050
"RTN","PSOREJU1",8,0)
 ;
"RTN","PSOREJU1",9,0)
ACTION(RX,REJ,OPTS,DEF) ;
"RTN","PSOREJU1",10,0)
 ; Input:  (r) RX   - Rx IEN (#52) 
"RTN","PSOREJU1",11,0)
 ;         (r) REJ  - REJECT ID (IEN)
"RTN","PSOREJU1",12,0)
 ;         (r) OPTS - Available options ("QIO" for QUIT/IGNORE/OVERRIDE)
"RTN","PSOREJU1",13,0)
 ;         (o) DEF  - Default Option ("O", "I" or "Q")
"RTN","PSOREJU1",14,0)
 ; Output: ACTION: "I^Comments" - Ignore Reject
"RTN","PSOREJU1",15,0)
 ;                 "O^COD1^COD2^COD3" - Override with the Override codes COD1(Prof.),COD2(Reason) and COD3(Result)
"RTN","PSOREJU1",16,0)
 ;                 "Q" - Quit
"RTN","PSOREJU1",17,0)
 ;                 "^" - Up-arrow entered or timed out
"RTN","PSOREJU1",18,0)
 ;
"RTN","PSOREJU1",19,0)
 N ACTION,COM,OVR,X,DIR,DIRUT,Y
"RTN","PSOREJU1",20,0)
 ;         
"RTN","PSOREJU1",21,0)
 I '$G(RX)!'$G(REJ) Q
"RTN","PSOREJU1",22,0)
 I '$G(PSONBILL) Q:'$D(^PSRX(RX,"REJ",REJ))
"RTN","PSOREJU1",23,0)
 ;
"RTN","PSOREJU1",24,0)
 ; - Display DUR/79 REJECT information
"RTN","PSOREJU1",25,0)
 D DISPLAY^PSOREJU3(RX,REJ)
"RTN","PSOREJU1",26,0)
 ;
"RTN","PSOREJU1",27,0)
ASK K ACTION,DIR,DIRUT
"RTN","PSOREJU1",28,0)
 S DIR(0)="SO^",DIR("A")=""
"RTN","PSOREJU1",29,0)
 S:(OPTS["O") DIR(0)=DIR(0)_"O:(O)VERRIDE - RESUBMIT WITH OVERRIDE CODES;",DIR("A")=DIR("A")_"(O)verride,"
"RTN","PSOREJU1",30,0)
 S:(OPTS["I") DIR(0)=DIR(0)_"I:(I)GNORE - FILL Rx WITHOUT CLAIM SUBMISSION;",DIR("A")=DIR("A")_"(I)gnore,"
"RTN","PSOREJU1",31,0)
 S:(OPTS["D") DIR(0)=DIR(0)_"D:(D)iscontinue - DO NOT FILL PRESCRIPTION;",DIR("A")=DIR("A")_"(D)iscontinue,"
"RTN","PSOREJU1",32,0)
 S:(OPTS["Q") DIR(0)=DIR(0)_"Q:(Q)UIT - SEND TO WORKLIST (REQUIRES INTERVENTION);",DIR("A")=DIR("A")_"(Q)uit,"
"RTN","PSOREJU1",33,0)
 S $E(DIR(0),$L(DIR(0)))="",$E(DIR("A"),$L(DIR("A")))="",DIR("??")="^D HELP^PSOREJU2("""_OPTS_""")"
"RTN","PSOREJU1",34,0)
 S:$G(DEF)'="" DIR("B")=DEF D ^DIR I $D(DIRUT) W ! Q "Q"
"RTN","PSOREJU1",35,0)
 ;
"RTN","PSOREJU1",36,0)
 ; - STOP/QUIT Action
"RTN","PSOREJU1",37,0)
 S ACTION=Y I ACTION="Q" Q ACTION
"RTN","PSOREJU1",38,0)
 ;
"RTN","PSOREJU1",39,0)
 ; - IGNORE Action 
"RTN","PSOREJU1",40,0)
 K DIR,DIRUT,X
"RTN","PSOREJU1",41,0)
 I ACTION="I" S COM=$$COM() G ASK:COM="^" G ASK:'$$SIG() S ACTION=ACTION_"^"_COM
"RTN","PSOREJU1",42,0)
 ;
"RTN","PSOREJU1",43,0)
 ; - OVERRIDE Action
"RTN","PSOREJU1",44,0)
 I ACTION="O" D  G ASK:OVR="^"
"RTN","PSOREJU1",45,0)
 . S OVR=$$OVR() S ACTION=ACTION_"^"_OVR
"RTN","PSOREJU1",46,0)
 ;
"RTN","PSOREJU1",47,0)
DC1 ;Discontinue
"RTN","PSOREJU1",48,0)
 I ACTION="D" S ACTION=$$DC(RX,ACTION) I $D(DIRUT) S ACTION="D" D DISPLAY^PSOREJU3(RX,REJ) G ASK
"RTN","PSOREJU1",49,0)
 ;
"RTN","PSOREJU1",50,0)
 Q ACTION
"RTN","PSOREJU1",51,0)
 ;
"RTN","PSOREJU1",52,0)
DC(RX,ACTION) ; - Discontinue inside and outside call
"RTN","PSOREJU1",53,0)
 N RXN,MSG,REA,DA,PSCAN,RXNUM
"RTN","PSOREJU1",54,0)
 S DA=RX,RXNUM=""
"RTN","PSOREJU1",55,0)
 D NOOR^PSOCAN4 I $D(DIRUT) W $C(7)," ACTION NOT TAKEN!",! H 1 S PSORX("DFLG")=1,ACTION="Q" Q ACTION
"RTN","PSOREJU1",56,0)
 D REQ^PSOCAN4 I $D(DIRUT) W $C(7)," ACTION NOT TAKEN!",! H 1 S PSORX("DFLG")=1,ACTION="Q" Q ACTION
"RTN","PSOREJU1",57,0)
 S REA="C",RXNUM=$P(^PSRX(DA,0),"^")
"RTN","PSOREJU1",58,0)
 S MSG="Discontinued "_$S($G(PSOFDR):" from Reject Processing Screen",1:"")
"RTN","PSOREJU1",59,0)
 S PSCAN(RXNUM)=DA_"^C"
"RTN","PSOREJU1",60,0)
 D CAN^PSOCAN
"RTN","PSOREJU1",61,0)
 N PSOCKDC S PSOCKDC=1,PSOQFLAG=1,PSOLST(1)=52_"^"_DA_"^"_$$GET1^DIQ(52,RXNUM,100),ORN=1
"RTN","PSOREJU1",62,0)
 D ECME^PSORXL1 I '$G(PPL) S PPL=""  ;remove rx from label print
"RTN","PSOREJU1",63,0)
 Q ACTION
"RTN","PSOREJU1",64,0)
 ;
"RTN","PSOREJU1",65,0)
SIG() ; - Get electronic signature
"RTN","PSOREJU1",66,0)
 N CODE,X,X1,Y
"RTN","PSOREJU1",67,0)
 S CODE=$P($G(^VA(200,DUZ,20)),U,4),Y=0 I '$L(CODE) D  Q Y
"RTN","PSOREJU1",68,0)
 . W $C(7),!,"You do not have an electronic signature code."
"RTN","PSOREJU1",69,0)
 . W !,"Please contact your IRM office." H 2
"RTN","PSOREJU1",70,0)
 D SIG^XUSESIG S Y=(X1'="")
"RTN","PSOREJU1",71,0)
 Q Y
"RTN","PSOREJU1",72,0)
 ;
"RTN","PSOREJU1",73,0)
COM() ; - Ask for CLOSE comments
"RTN","PSOREJU1",74,0)
 K COM,DIR,DIRUT,X
"RTN","PSOREJU1",75,0)
 W ! S DIR(0)="F^3:100" S DIR("A")="Comments" D ^DIR
"RTN","PSOREJU1",76,0)
 S COM=X I $D(DIRUT) S COM="^"
"RTN","PSOREJU1",77,0)
 Q COM
"RTN","PSOREJU1",78,0)
 ;
"RTN","PSOREJU1",79,0)
OVR() ; - Ask for OVERRIDE codes
"RTN","PSOREJU1",80,0)
 N COD1,COD2,COD3,DIR,DIRUT W !
"RTN","PSOREJU1",81,0)
 S COD1=$$OVRCOD(1,$$GET1^DIQ(52.25,REJ_","_RX,14)) I COD1="^" Q "^"
"RTN","PSOREJU1",82,0)
 S COD2=$$OVRCOD(2) I COD2="^" Q "^"
"RTN","PSOREJU1",83,0)
 S COD3=$$OVRCOD(3) I COD3="^" Q "^"
"RTN","PSOREJU1",84,0)
 ;
"RTN","PSOREJU1",85,0)
 D OVRDSP^PSOREJU1(COD1_"^"_COD2_"^"_COD3) W !
"RTN","PSOREJU1",86,0)
 ;
"RTN","PSOREJU1",87,0)
 S DIR(0)="Y",DIR("A")="     Confirm? ",DIR("B")="YES"
"RTN","PSOREJU1",88,0)
 D ^DIR I $G(Y)=0!$D(DIRUT) Q "^"
"RTN","PSOREJU1",89,0)
 ;
"RTN","PSOREJU1",90,0)
 Q (COD2_"^"_COD1_"^"_COD3)
"RTN","PSOREJU1",91,0)
 ;
"RTN","PSOREJU1",92,0)
OVRDSP(LST) ; - Display the Override Codes
"RTN","PSOREJU1",93,0)
 N I W !
"RTN","PSOREJU1",94,0)
 F I=1:1:3 D
"RTN","PSOREJU1",95,0)
 . W !?5,$S(I=1:"Reason for Service Code  : ",I=2:"Professional Service Code: ",1:"Result of Service Code   : ")
"RTN","PSOREJU1",96,0)
 . W $E($$OVRX(I,$P(LST,"^",I)),1,48)
"RTN","PSOREJU1",97,0)
 Q
"RTN","PSOREJU1",98,0)
 ;
"RTN","PSOREJU1",99,0)
CLA() ; - Ask for Clarification Code
"RTN","PSOREJU1",100,0)
 N DIR,Y,DIRUT,DIROUT
"RTN","PSOREJU1",101,0)
 S DIR(0)="52.25,24",DIR("A")="Clarification Code" D ^DIR
"RTN","PSOREJU1",102,0)
 I $D(DIRUT)!$D(DIROUT) Q "^"
"RTN","PSOREJU1",103,0)
 Q Y
"RTN","PSOREJU1",104,0)
 ;
"RTN","PSOREJU1",105,0)
HDLG(RX,RFL,CODES,FROM,OPTS,DEF) ; - REJECT Handling
"RTN","PSOREJU1",106,0)
 ;Input: (r) RX   - Rx IEN (#52)
"RTN","PSOREJU1",107,0)
 ;       (o) RFL  - Refill # (Default: most recent)
"RTN","PSOREJU1",108,0)
 ;       (r) CODES - List of REJECT CODES to be handled separated by commas (default is "79,88")
"RTN","PSOREJU1",109,0)
 ;       (r) FROM  - Same values as BWHERE param. in the EN^BPSNCPDP api
"RTN","PSOREJU1",110,0)
 ;       (r) OPTS  - Available options ("IOQ" for IGNORE/OVERRIDE/QUIT)
"RTN","PSOREJU1",111,0)
 ;       (o) DEF   - Default Option ("O", "I" or "Q")
"RTN","PSOREJU1",112,0)
 ;Output: ACTION   - "O"-Override, "I"-Ignore,"Q"-Quit,"^"-Up-arrow entered
"RTN","PSOREJU1",113,0)
 ;       
"RTN","PSOREJU1",114,0)
 N REJDATA,NEWDATA,CODE,ACTION,REJ,RESP,REJCDI,PSOTRIC,DCODE S CODE=""
"RTN","PSOREJU1",115,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOREJU1",116,0)
 S PSOTRIC="",PSOTRIC=$$TRIC^PSOREJP1(RX,RFL,PSOTRIC)
"RTN","PSOREJU1",117,0)
 I PSOTRIC D  ;note that Tricare Rejects need all codes, not just 79/88's
"RTN","PSOREJU1",118,0)
 . S OPTS="DQ",DEF="Q",(DCODE,CODES)=""
"RTN","PSOREJU1",119,0)
 . F  S DCODE=$O(^PSRX(RX,"REJ","B",DCODE)) Q:DCODE=""  S CODES=CODES_","_DCODE
"RTN","PSOREJU1",120,0)
 . S CODES=$E(CODES,2,9999)
"RTN","PSOREJU1",121,0)
 . I CODES["88"!(CODES["79") S OPTS="ODQ"
"RTN","PSOREJU1",122,0)
 ;  -  In progress Rx not allowed to be filled
"RTN","PSOREJU1",123,0)
 I PSOTRIC,$$STATUS^PSOBPSUT(RX,RFL)["IN PROGRESS" S ACTION="",(DEF,OPTS)="D" D TRICCHK^PSOREJU3(RX,RFL,"",FROM) D  Q ACTION
"RTN","PSOREJU1",124,0)
 . I $P(ACTION,"^")="D" D CLOSE^PSOREJUT(RX,RFL,REJ,DUZ,7,,$P(ACTION,"^",2))
"RTN","PSOREJU1",125,0)
 ;
"RTN","PSOREJU1",126,0)
 F REJCDI=1:1 S CODE=$P(CODES,",",REJCDI) Q:CODE=""  D  I ACTION="Q"!(ACTION="^") Q
"RTN","PSOREJU1",127,0)
 . S ACTION=""
"RTN","PSOREJU1",128,0)
 . I $$FIND^PSOREJUT(RX,RFL,.REJDATA,CODE) D
"RTN","PSOREJU1",129,0)
 . . S REJ=$O(REJDATA(""))
"RTN","PSOREJU1",130,0)
 . . S ACTION=$$ACTION(RX,REJ,OPTS,$G(DEF)) I ACTION="Q"!(ACTION="^") Q
"RTN","PSOREJU1",131,0)
 . . I $P(ACTION,"^")="I" D CLOSE^PSOREJUT(RX,RFL,REJ,DUZ,6,$P(ACTION,"^",2)) Q
"RTN","PSOREJU1",132,0)
 . . I $P(ACTION,"^")="O" D CLOSE^PSOREJUT(RX,RFL,REJ,DUZ,1,,$P(ACTION,"^",3),$P(ACTION,"^",2),$P(ACTION,"^",4))
"RTN","PSOREJU1",133,0)
 . . I $P(ACTION,"^")="D" D CLOSE^PSOREJUT(RX,RFL,REJ,DUZ,7,,$P(ACTION,"^",2)) Q
"RTN","PSOREJU1",134,0)
 . . D ECMESND^PSOBPSU1(RX,RFL,,FROM,$$GETNDC^PSONDCUT(RX,RFL),,,$P(ACTION,"^",2,4),,.RESP)
"RTN","PSOREJU1",135,0)
 . . I $G(RESP) D  Q
"RTN","PSOREJU1",136,0)
 . . . W !!?10,"Claim could not be submitted. Please try again later!"
"RTN","PSOREJU1",137,0)
 . . . W !,?10,"Reason: ",$S($P(RESP,"^",2)="":"UNKNOWN",1:$P(RESP,"^",2)),$C(7)
"RTN","PSOREJU1",138,0)
 . . K NEWDATA I $$FIND^PSOREJUT(RX,RFL,.NEWDATA,CODE) D  I ACTION="Q"!(ACTION="^") Q
"RTN","PSOREJU1",139,0)
 . . . S ACTION=$$ACTION(RX,$O(NEWDATA("")),OPTS,$G(DEF)) I ACTION="Q"!(ACTION="^") Q
"RTN","PSOREJU1",140,0)
 . . . I $P(ACTION,"^")="I" D CLOSE^PSOREJUT(RX,RFL,REJ,DUZ,6,$P(ACTION,"^",2))
"RTN","PSOREJU1",141,0)
 . . . I $P(ACTION,"^")="O" D CLOSE^PSOREJUT(RX,RFL,REJ,DUZ,1,,$P(ACTION,"^",3),$P(ACTION,"^",2),$P(ACTION,"^",4))
"RTN","PSOREJU1",142,0)
 Q ACTION
"RTN","PSOREJU1",143,0)
 ;
"RTN","PSOREJU1",144,0)
OVRX(TYPE,CODE) ; - Returns the extended code/description of the NCPDP DUR override codes
"RTN","PSOREJU1",145,0)
 ; Input: (r) TYPE  - 1 (REASON FOR SERVICE), 2 (PROFESSIONAL SERVICE) or 3 (RESULT OF SERVICE)
"RTN","PSOREJU1",146,0)
 ;        (r) CODE  - Table IEN
"RTN","PSOREJU1",147,0)
 ; Output: "CODE - DESCRIPTION"
"RTN","PSOREJU1",148,0)
 N FILE,DIC,X,Y
"RTN","PSOREJU1",149,0)
 S FILE=9002313+$S(TYPE=1:.23,TYPE=2:.21,1:.22)
"RTN","PSOREJU1",150,0)
 S DIC=FILE,X=CODE D ^DIC
"RTN","PSOREJU1",151,0)
 I TYPE=1 Q CODE_" - "_$$GET1^DIQ(9002313.23,+Y,1)
"RTN","PSOREJU1",152,0)
 I TYPE=2 Q CODE_" - "_$$GET1^DIQ(9002313.21,+Y,1)
"RTN","PSOREJU1",153,0)
 I TYPE=3 Q CODE_" - "_$$GET1^DIQ(9002313.22,+Y,1)
"RTN","PSOREJU1",154,0)
 Q ""
"RTN","PSOREJU1",155,0)
 ;
"RTN","PSOREJU1",156,0)
 ;
"RTN","PSOREJU1",157,0)
OVRCOD(TYPE,VALUE) ; - Prompt for NCPDP Override Codes
"RTN","PSOREJU1",158,0)
 N DIC,X,Y,FILE,PRPT
"RTN","PSOREJU1",159,0)
 ; 
"RTN","PSOREJU1",160,0)
 I TYPE=1 S FILE=9002313.23,PRPT="Reason for Service Code  : "
"RTN","PSOREJU1",161,0)
 I TYPE=2 S FILE=9002313.21,PRPT="Professional Service Code: "
"RTN","PSOREJU1",162,0)
 I TYPE=3 S FILE=9002313.22,PRPT="Result of Service Code   : "
"RTN","PSOREJU1",163,0)
 S DIC=FILE,DIC(0)="Z"
"RTN","PSOREJU1",164,0)
 I $G(VALUE)'="" S X=VALUE D ^DIC I Y>0 W !,PRPT,VALUE,"       ",$P(Y(0),"^",2) Q VALUE
"RTN","PSOREJU1",165,0)
 S DIC=FILE,DIC(0)="AQE",DIC("A")=PRPT
"RTN","PSOREJU1",166,0)
 D ^DIC I $D(DTOUT)!$D(DUOUT)!(Y<0) Q "^"
"RTN","PSOREJU1",167,0)
 Q $P(Y,"^",2)
"RTN","PSOREJU1",168,0)
 ;
"RTN","PSOREJU1",169,0)
SEL(FIELD,FILE,ARRAY,DEFAULT) ; - Provides field selection (one, multiple or ALL)
"RTN","PSOREJU1",170,0)
 N DIC,DTOUT,DUOUT,QT,Y,X
"RTN","PSOREJU1",171,0)
 W !!,"You may select a single or multiple "_FIELD_"S,"
"RTN","PSOREJU1",172,0)
 W !,"or enter ^ALL to select all "_FIELD_"S.",!
"RTN","PSOREJU1",173,0)
 K ARRAY S DIC=FILE,DIC(0)="QEZAM",DIC("A")=FIELD_": "
"RTN","PSOREJU1",174,0)
 I $G(DEFAULT)'="" S DIC("B")=DEFAULT
"RTN","PSOREJU1",175,0)
 F  D ^DIC Q:X=""  D  Q:$G(QT)
"RTN","PSOREJU1",176,0)
 . I $$UP^XLFSTR(X)="^ALL" K ARRAY S ARRAY="ALL",QT=1 Q
"RTN","PSOREJU1",177,0)
 . I $D(DTOUT)!$D(DUOUT) K ARRAY S ARRAY="^",QT=1 Q
"RTN","PSOREJU1",178,0)
 . W "   ",$P(Y,"^",2),$S($D(ARRAY(+Y)):"       (already selected)",1:"")
"RTN","PSOREJU1",179,0)
 . W ! S ARRAY(+Y)="",DIC("A")="ANOTHER ONE: " K DIC("B")
"RTN","PSOREJU1",180,0)
 I '$D(ARRAY) S ARRAY="^"
"RTN","PSOREJU1",181,0)
 Q
"RTN","PSOREJU1",182,0)
 ;
"RTN","PSOREJU1",183,0)
LMREJ(RX,RFL,MSG,BCK) ; Used by ListManager hidden actions to detect unresolved 3rd Party Rejects
"RTN","PSOREJU1",184,0)
 ;Input:  (r) RX   - Rx IEN (#52)
"RTN","PSOREJU1",185,0)
 ;        (o) RFL  - Refill # (Default: most recent)
"RTN","PSOREJU1",186,0)
 ;Output: (o) MSG  - Usually this will be used to set VALMSG variable, which should be passed in by ref.
"RTN","PSOREJU1",187,0)
 ;        (o) BCK  - This will be used to set VALMBCK variable, which should be passed in by ref.
"RTN","PSOREJU1",188,0)
 ;
"RTN","PSOREJU1",189,0)
 I '$D(^PSRX(+RX)) Q 0
"RTN","PSOREJU1",190,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOREJU1",191,0)
 I $$FIND^PSOREJUT(RX,RFL) D  Q 1
"RTN","PSOREJU1",192,0)
 . S MSG="NOT ALLOWED! Rx has OPEN 3rd Party Payer Reject.",BCK="R" W $C(7),$C(7)
"RTN","PSOREJU1",193,0)
 Q 0
"RTN","PSOREJU1",194,0)
 ;
"RTN","PSOREJU1",195,0)
DUP(RX,RSP) ; Checks if REJECT has already been logged in the PRESCRIPTION file
"RTN","PSOREJU1",196,0)
 ; Input:  (r) RX  - Rx IEN (#52) 
"RTN","PSOREJU1",197,0)
 ;         (o) RSP - Response IEN
"RTN","PSOREJU1",198,0)
 ; Output:     DUP - 1: Already logged (duplicate) 
"RTN","PSOREJU1",199,0)
 ;                   0: Not yet logged on PRESCRIPTION file
"RTN","PSOREJU1",200,0)
 N DUP,IDX S (DUP,IDX)=0
"RTN","PSOREJU1",201,0)
 F  S IDX=$O(^PSRX(RX,"REJ",IDX)) Q:'IDX  D  Q:DUP
"RTN","PSOREJU1",202,0)
 . I +RSP=+$$GET1^DIQ(52.25,IDX_","_RX,16,"I") S DUP=1
"RTN","PSOREJU1",203,0)
 Q DUP
"RTN","PSOREJU1",204,0)
 ;
"RTN","PSOREJU1",205,0)
OTH(CODE,LST) ; Removes the current Reject code from the list
"RTN","PSOREJU1",206,0)
 ; Input:  (r) CODE  - Current Reject Code (79 or 88)
"RTN","PSOREJU1",207,0)
 ;         (o) LST   - List of all Reject codes with response (comma separated)
"RTN","PSOREJU1",208,0)
 ; Output:     OTH   - List of OTHER Reject codes (w/out 79 or 88)
"RTN","PSOREJU1",209,0)
 ;
"RTN","PSOREJU1",210,0)
 N I,OTH
"RTN","PSOREJU1",211,0)
 F I=1:1:$L(LST,",") D
"RTN","PSOREJU1",212,0)
 . I $P(LST,",",I),$P(LST,",",I)'=CODE S OTH=$G(OTH)_","_$P(LST,",",I)
"RTN","PSOREJU1",213,0)
 S $E(OTH)=""
"RTN","PSOREJU1",214,0)
 Q OTH
"RTN","PSOREJU1",215,0)
 ;
"RTN","PSOREJU1",216,0)
DAT(DAT) ; - External Date
"RTN","PSOREJU1",217,0)
 S X=$$HL7TFM^XLFDT(DAT) I X<0 Q ""
"RTN","PSOREJU1",218,0)
 Q X
"RTN","PSOREJU1",219,0)
 ;
"RTN","PSOREJU1",220,0)
CLEAN(STR) ; Remove blanks from the end of a string and replaces ";" with ","
"RTN","PSOREJU1",221,0)
 N LEN F LEN=$L(STR):-1:1 Q:$E(STR,LEN)'=" "
"RTN","PSOREJU1",222,0)
 S STR=$TR(STR,";",",")
"RTN","PSOREJU1",223,0)
 Q $E(STR,1,LEN)
"RTN","PSOREJU4")
0^6^B23487142
"RTN","PSOREJU4",1,0)
PSOREJU4 ;BIRM/LE - Pharmacy Reject Overrides ;06/26/08
"RTN","PSOREJU4",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**289**;DEC 1997;Build 107
"RTN","PSOREJU4",3,0)
 ;Reference to DUR1^BPSNCPD3 supported by IA 4560
"RTN","PSOREJU4",4,0)
 ;
"RTN","PSOREJU4",5,0)
AUTOREJ(CODES,PSODIV) ;API to evaluate an array of reject codes to see if they are allowed to be passed to OP reject Worklist 
"RTN","PSOREJU4",6,0)
 ;Input:      CODES - required; array of codes to be validated for overrides.  
"RTN","PSOREJU4",7,0)
 ;           PSODIV - optional; Division for the Rx and Fill to be evaluated
"RTN","PSOREJU4",8,0)
 ;        
"RTN","PSOREJU4",9,0)
 ;Output:     CODES(0)=   1 for all reject codes are allowed to be passed to Pharmacy
"RTN","PSOREJU4",10,0)
 ;                         Reject Worklist or 0 (zero) means only default of 79/88/Tricare and
"RTN","PSOREJU4",11,0)
 ;                         any individually override rejects can be passed to the worklist. 
"RTN","PSOREJU4",12,0)
 ;                        
"RTN","PSOREJU4",13,0)
 ;            CODES(SEQ,REJECT)= 0 (zero) if the fill is not allowed to be passed to the Pharmacy
"RTN","PSOREJU4",14,0)
 ;                                Reject Worklist or 1 (one) for the reject code is allowed.
"RTN","PSOREJU4",15,0)
 ;                                
"RTN","PSOREJU4",16,0)
 N SEQ,COD,AUTO,ALLOW,SPDIV
"RTN","PSOREJU4",17,0)
 ;if no division passed, first division in file 59 is assumed.
"RTN","PSOREJU4",18,0)
 I '$G(PSODIV) S PSODIV=0,PSODIV=$O(^PS(59,PSODIV))
"RTN","PSOREJU4",19,0)
 I '$G(PSODIV) S CODES(0)="0^Division undefined in file 59" Q 
"RTN","PSOREJU4",20,0)
 S SPDIV="",SPDIV=$O(^PS(52.86,"B",PSODIV,SPDIV))
"RTN","PSOREJU4",21,0)
 I SPDIV="" S CODES(0)="0^Division is not defined under ePharmacy Site Parameters option." Q
"RTN","PSOREJU4",22,0)
 ;
"RTN","PSOREJU4",23,0)
 ; - all rejects allowed to pass to Pharmacy Reject Worklist?
"RTN","PSOREJU4",24,0)
 S CODES(0)=$$GET1^DIQ(52.86,SPDIV,1,"I")
"RTN","PSOREJU4",25,0)
 ;
"RTN","PSOREJU4",26,0)
 ; - check individual reject codes.  If defined, can be passed to Pharmacy Reject Worklist
"RTN","PSOREJU4",27,0)
 S (COD,SEQ)="" F  S SEQ=$O(CODES(SEQ)) Q:SEQ=""  F  S COD=$O(CODES(SEQ,COD)) Q:COD=""  D
"RTN","PSOREJU4",28,0)
 . I $D(^PS(52.86,+SPDIV,1,"B",COD)) S CODES(SEQ,COD)=1
"RTN","PSOREJU4",29,0)
 . E  S CODES(SEQ,COD)=0
"RTN","PSOREJU4",30,0)
 Q
"RTN","PSOREJU4",31,0)
 ;
"RTN","PSOREJU4",32,0)
WRKLST(RX,RFL,COMMTXT,USERID,DTTIME,OPECC) ;External API to store reject codes other that 79/88/Tricare on the OP Reject Worklist
"RTN","PSOREJU4",33,0)
 ; 
"RTN","PSOREJU4",34,0)
 N REJ,REJS,REJLST,I,IDX,CODE,DATA,TXT,PSOTRIC,SPDVI,PSODIV
"RTN","PSOREJU4",35,0)
 S PSODIV=$$RXSITE^PSOBPSUT(RX,RFL)
"RTN","PSOREJU4",36,0)
 L +^PSRX("REJ",RX):15 Q:'$T "0^Rx locked by another user."
"RTN","PSOREJU4",37,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOREJU4",38,0)
 D DUR1^BPSNCPD3(RX,RFL,.REJ)
"RTN","PSOREJU4",39,0)
 S PSOTRIC="" S:$G(REJ(1,"ELIGBLT"))="T" PSOTRIC=1
"RTN","PSOREJU4",40,0)
 S:PSOTRIC="" PSOTRIC=$$TRIC^PSOREJP1(RX,RFL,PSOTRIC)
"RTN","PSOREJU4",41,0)
 K REJS S (AUTO,IDX)=""
"RTN","PSOREJU4",42,0)
 F  S IDX=$O(REJ(IDX)) Q:IDX=""  D  Q:AUTO'=""
"RTN","PSOREJU4",43,0)
 . S TXT=REJ(IDX,"REJ CODE LST")
"RTN","PSOREJU4",44,0)
 . F I=1:1:$L(TXT,",") D
"RTN","PSOREJU4",45,0)
 . . S CODE=$P(TXT,",",I)
"RTN","PSOREJU4",46,0)
 . . I CODE'="79"&(CODE'="88")&('$G(PSOTRIC)) S AUTO=$$EVAL(PSODIV,CODE,OPECC,.AUTO) Q:'+AUTO
"RTN","PSOREJU4",47,0)
 . . I $$DUP^PSOREJU1(RX,+$$CLEAN^PSOREJU1($G(REJ(IDX,"RESPONSE IEN")))) S AUTO="0^Rx is already on Pharmacy Reject Worklist."
"RTN","PSOREJU4",48,0)
 . . S REJS(IDX,CODE)=""
"RTN","PSOREJU4",49,0)
 I '$D(REJS) L -^PSRX("REJ",RX) S AUTO="0^No action taken" Q AUTO
"RTN","PSOREJU4",50,0)
 ;D SAVECOM^PSOREJP3(RX,PSREJIEN,COMMTXT,DTTIME,USER)
"RTN","PSOREJU4",51,0)
 G EXIT:'+AUTO
"RTN","PSOREJU4",52,0)
 ;
"RTN","PSOREJU4",53,0)
 D SYNC2^PSOREJUT
"RTN","PSOREJU4",54,0)
 S AUTO=1
"RTN","PSOREJU4",55,0)
EXIT ;
"RTN","PSOREJU4",56,0)
 L -^PSRX("REJ",RX)
"RTN","PSOREJU4",57,0)
 Q AUTO
"RTN","PSOREJU4",58,0)
 ;
"RTN","PSOREJU4",59,0)
EVAL(PSODIV,CODE,OPECC,AUTO) ;Evaluates whether the reject codes other than 79/88/Tricare is allowed to be passed to OP Reject Worklist
"RTN","PSOREJU4",60,0)
 ;Input:      PSODIV - required; Division for the Rx and Fill to be evaluated
"RTN","PSOREJU4",61,0)
 ;              CODE - required; reject code
"RTN","PSOREJU4",62,0)
 ;             OPECC - optional, 1 means manually passed by OPECC means not passed
"RTN","PSOREJU4",63,0)
 ;              AUTO - passed in value to be returned.
"RTN","PSOREJU4",64,0)
 ;Output:       AUTO - 1 means reject is allowed to be passed to Pharmacy Reject Worklist and zero
"RTN","PSOREJU4",65,0)
 ;                       means not allowed.
"RTN","PSOREJU4",66,0)
 ;                       
"RTN","PSOREJU4",67,0)
 N ALLOWA,CIEN,ALLOW,ICOD,SPDIV
"RTN","PSOREJU4",68,0)
 I '$D(CODE)!(CODE="") Q 0
"RTN","PSOREJU4",69,0)
 I '$G(OPECC) S OPECC=0
"RTN","PSOREJU4",70,0)
 I '$G(PSODIV) Q 0
"RTN","PSOREJU4",71,0)
 S SPDIV="",SPDIV=$O(^PS(52.86,"B",PSODIV,SPDIV))
"RTN","PSOREJU4",72,0)
 Q:SPDIV="" "0^Division is not defined under ePharmacy Site Parameters option."
"RTN","PSOREJU4",73,0)
 S:'$G(AUTO) AUTO=""
"RTN","PSOREJU4",74,0)
 S ICOD="",ICOD=$O(^BPSF(9002313.93,"B",CODE,ICOD))
"RTN","PSOREJU4",75,0)
 Q:ICOD="" 0
"RTN","PSOREJU4",76,0)
 S ALLOWA=$$GET1^DIQ(52.86,SPDIV,1,"I") I ALLOWA Q 1
"RTN","PSOREJU4",77,0)
 Q:'$D(^PS(52.86,SPDIV,1,"B",ICOD)) "0^Reject Code is not allowed to be passed to Pharmacy Reject Worklist."
"RTN","PSOREJU4",78,0)
 S CIEN="",CIEN=$O(^PS(52.86,SPDIV,1,"B",ICOD,CIEN))
"RTN","PSOREJU4",79,0)
 I CIEN="" S AUTO="0^Code not defined."
"RTN","PSOREJU4",80,0)
 S (AUTO,ALLOW)="",ALLOW=$$GET1^DIQ(52.8651,CIEN_","_SPDIV,1,"I")
"RTN","PSOREJU4",81,0)
 I ALLOW Q 1
"RTN","PSOREJU4",82,0)
 I 'ALLOW D
"RTN","PSOREJU4",83,0)
 . I OPECC S AUTO=1
"RTN","PSOREJU4",84,0)
 . I 'OPECC S AUTO="0^Reject code "_CODE_" cannot be placed on the Pharmacy Reject Worklist"
"RTN","PSOREJU4",85,0)
 Q AUTO
"RTN","PSOREJU4",86,0)
 ;
"RTN","PSOREJU4",87,0)
OVER ;due to size of PSOREJU1 this subroutine was needed. also used by OVERMSG
"RTN","PSOREJU4",88,0)
 ;The variables RX, RFL, CODE and CODES are expected to remain when exiting this subroutine
"RTN","PSOREJU4",89,0)
 ;
"RTN","PSOREJU4",90,0)
 N DCODE,AUTO,PSODIV,OCODES S (PSODIV,AUTO,DCODE,OCODES,OVRARR)=""
"RTN","PSOREJU4",91,0)
 S OCODES=CODES,CODES=""
"RTN","PSOREJU4",92,0)
 S PSODIV=$$RXSITE^PSOBPSUT(RX,RFL)
"RTN","PSOREJU4",93,0)
 F  S DCODE=$O(^PSRX(RX,"REJ","B",DCODE)) Q:DCODE=""  D
"RTN","PSOREJU4",94,0)
 . I DCODE[79!(DCODE[88) S CODES=CODES_","_DCODE Q
"RTN","PSOREJU4",95,0)
 . S AUTO=$$EVAL(PSODIV,DCODE,0,.AUTO)
"RTN","PSOREJU4",96,0)
 . Q:'+AUTO
"RTN","PSOREJU4",97,0)
 . S CODES=CODES_","_DCODE,OVRARR(DCODE)=""
"RTN","PSOREJU4",98,0)
 S CODES=$E(CODES,2,9999)
"RTN","PSOREJU4",99,0)
 S:CODES="" CODES=OCODES
"RTN","PSOREJU4",100,0)
 Q
"RTN","PSOREJU4",101,0)
 ;
"RTN","PSOREJU4",102,0)
OVRMSG(RX,RFL,OVRMSG,REJDAT) ;
"RTN","PSOREJU4",103,0)
 N CODES,OVRARR,COD
"RTN","PSOREJU4",104,0)
 S CODES=""
"RTN","PSOREJU4",105,0)
 D OVER
"RTN","PSOREJU4",106,0)
 I '$D(REJDAT) D NOW^%DTC S REJDAT=%
"RTN","PSOREJU4",107,0)
 Q:'$D(OVRARR)
"RTN","PSOREJU4",108,0)
 F  S COD=$O(OVRARR(COD)) Q:COD=""  D
"RTN","PSOREJU4",109,0)
 . D SAVECOM^PSOREJP3(RX,COD,OVRMSG,REJDAT,$S($G(DUZ):DUZ,1:.5))
"RTN","PSOREJU4",110,0)
 Q
"RTN","PSOREJU4",111,0)
 ;
"RTN","PSOREJU4",112,0)
INLIST(RX,RFL) ;Returns whether a prescription/fill contains UNRESOLVED rejects
"RTN","PSOREJU4",113,0)
 ;Input:
"RTN","PSOREJU4",114,0)
 ;RX - Prescription IEN. 
"RTN","PSOREJU4",115,0)
 ;FILL - Fill number being processed. 
"RTN","PSOREJU4",116,0)
 ;Output:
"RTN","PSOREJU4",117,0)
 ;0 - the fill is not on the Pharmacy Reject Worklist
"RTN","PSOREJU4",118,0)
 ;1 - the fill is already on the Pharmacy Reject Worklist
"RTN","PSOREJU4",119,0)
 Q $$FIND^PSOREJUT(RX,RFL)
"RTN","PSOREJU4",120,0)
 ;
"RTN","PSOREJU4",121,0)
MULTI(RX,RFL,REJDATA,CODE,REJS) ;due to routine size, called from FIND^PSOREJUT
"RTN","PSOREJU4",122,0)
 ;returns REJS = 1 means reject code found on Rx, 0 (zero) means not found
"RTN","PSOREJU4",123,0)
 I $G(RFL) D
"RTN","PSOREJU4",124,0)
 . F I=1:1 S RCODE=$P(CODE,",",I) Q:RCODE=""!($G(REJS))  D GET^PSOREJU2(RX,RFL,.REJDATA,,,$G(RCODE)) I $D(REJDATA) S REJS=1
"RTN","PSOREJU4",125,0)
 E  S RFL=0 D  I '$D(REJDATA) F  S RFL=$O(^PSRX(RX,1,RFL)) Q:'RFL  D  Q:$G(REJS)
"RTN","PSOREJU4",126,0)
 . F I=1:1 S RCODE=$P(CODE,",",I) Q:RCODE=""!($G(REJS))  D GET^PSOREJU2(RX,RFL,.REJDATA,,,$G(RCODE)) I $D(REJDATA) S REJS=1
"RTN","PSOREJU4",127,0)
 Q REJS
"RTN","PSOREJU4",128,0)
 ;
"RTN","PSOREJU4",129,0)
SINGLE(RX,RFL,REJDATA,CODE,REJS) ;due to routine size, called from FIND^PSOREJUT
"RTN","PSOREJU4",130,0)
 ;Returns REJS = 1 means reject code found on Rx, 0 (zero) means not found
"RTN","PSOREJU4",131,0)
 I $G(RFL) D
"RTN","PSOREJU4",132,0)
 . D GET^PSOREJU2(RX,RFL,.REJDATA,,,$G(CODE))
"RTN","PSOREJU4",133,0)
 E  S RFL=0 D  I '$D(REJDATA) F  S RFL=$O(^PSRX(RX,1,RFL)) Q:'RFL  D
"RTN","PSOREJU4",134,0)
 . D GET^PSOREJU2(RX,RFL,.REJDATA,,,$G(CODE))
"RTN","PSOREJU4",135,0)
 S REJS=$S($D(REJDATA):1,1:0)
"RTN","PSOREJU4",136,0)
 Q REJS
"RTN","PSOREJUT")
0^8^B47876709
"RTN","PSOREJUT",1,0)
PSOREJUT ;BIRM/MFR - BPS (ECME) - Clinical Rejects Utilities ;06/07/05
"RTN","PSOREJUT",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**148,247,260,287,289**;DEC 1997;Build 107
"RTN","PSOREJUT",3,0)
 ;Reference to DUR1^BPSNCPD3 supported by IA 4560
"RTN","PSOREJUT",4,0)
 ;Reference to $$ADDCOMM^BPSBUTL supported by IA 4719
"RTN","PSOREJUT",5,0)
 ;
"RTN","PSOREJUT",6,0)
SAVE(RX,RFL,REJ,REOPEN) ; - Saves DUR Information in the PRESCRIPTION file
"RTN","PSOREJUT",7,0)
 ; Input:  (r) RX  - Rx IEN (#52) 
"RTN","PSOREJUT",8,0)
 ;         (o) RFL - Refill # (Default: most recent)
"RTN","PSOREJUT",9,0)
 ;         (o) REOPEN - value of 1 means claim being reopened; null or no value passed means reopen claim functionality not being used
"RTN","PSOREJUT",10,0)
 ;         (r) REJ - Array containing information about the REJECT on the following
"RTN","PSOREJUT",11,0)
 ;                   subscripts:
"RTN","PSOREJUT",12,0)
 ;                   "CODE"   - Reject Code (79 or 88)
"RTN","PSOREJUT",13,0)
 ;                   "DATE/TIME"   - Date/Time Reject Detected
"RTN","PSOREJUT",14,0)
 ;                   "PAYER MESSAGE" - Message returned by Payer (up to 140 chars long)
"RTN","PSOREJUT",15,0)
 ;                   "REASON" - Reject Reason (up to 100 chars long)
"RTN","PSOREJUT",16,0)
 ;                   "DUR TEXT" - Payer's DUR description
"RTN","PSOREJUT",17,0)
 ;                   "INSURANCE NAME" - Patient's Insurance Company Name
"RTN","PSOREJUT",18,0)
 ;                   "GROUP NAME" - Patient's Insurance Group Name
"RTN","PSOREJUT",19,0)
 ;                   "GROUP NUMBER" - Patient's Insurance Group Number
"RTN","PSOREJUT",20,0)
 ;                   "CARDHOLDER ID" - Patient's Insurance Cardholder ID
"RTN","PSOREJUT",21,0)
 ;                   "PLAN CONTACT" - Patient's Insurance Plan Contact (1-800)
"RTN","PSOREJUT",22,0)
 ;                   "PREVIOUS FILL" - Plan's Previous Fill Date
"RTN","PSOREJUT",23,0)
 ;                   "OTHER REJECTS" - Other Rejects with same Response
"RTN","PSOREJUT",24,0)
 ;                   "PHARMACIST" - Pharmacist DUZ
"RTN","PSOREJUT",25,0)
 ;                   "RESPONSE IEN" - Pointer to the RESPONSE file in ECME
"RTN","PSOREJUT",26,0)
 ;                   "REASON SVC CODE" - Reason for Service Code (pointer to BPS NCPDP REASON FOR SERVICE CODE)
"RTN","PSOREJUT",27,0)
 ;                   "RE-OPENED" - Re-Open Flag
"RTN","PSOREJUT",28,0)
 ;Output: REJ("REJECT IEN") 
"RTN","PSOREJUT",29,0)
 ;
"RTN","PSOREJUT",30,0)
 N %,DIC,DR,DA,X,DINUM,DD,DO,DLAYGO
"RTN","PSOREJUT",31,0)
 ;
"RTN","PSOREJUT",32,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOREJUT",33,0)
 I '$G(PSODIV) S PSODIV=$$RXSITE^PSOBPSUT(RX,RFL)
"RTN","PSOREJUT",34,0)
 ;
"RTN","PSOREJUT",35,0)
 ; - If Reject Code different than 79 or 88, Tricare or an override reject then Quit
"RTN","PSOREJUT",36,0)
 S REJ("CODE")=$G(REJ("CODE"))
"RTN","PSOREJUT",37,0)
 I REJ("CODE")'=79&(REJ("CODE")'=88)&('$G(PSOTRIC))&('$G(REOPEN)) S ERR="",ERR=$$EVAL^PSOREJU4(PSODIV,REJ("CODE"),$G(OPECC),.ERR) Q:'+ERR
"RTN","PSOREJUT",38,0)
 ;
"RTN","PSOREJUT",39,0)
 S REJ("PAYER MESSAGE")=$E($G(REJ("PAYER MESSAGE")),1,140),REJ("REASON")=$E($G(REJ("REASON")),1,100)
"RTN","PSOREJUT",40,0)
 S REJ("DUR TEXT")=$E($G(REJ("DUR TEXT")),1,100),REJ("GROUP NAME")=$E($G(REJ("GROUP NAME")),1,30)
"RTN","PSOREJUT",41,0)
 S REJ("INSURANCE NAME")=$E($G(REJ("INSURANCE NAME")),1,30),REJ("PLAN CONTACT")=$E($G(REJ("PLAN CONTACT")),1,30)
"RTN","PSOREJUT",42,0)
 S REJ("GROUP NUMBER")=$E($G(REJ("GROUP NUMBER")),1,30),REJ("OTHER REJECTS")=$E($G(REJ("OTHER REJECTS")),1,15)
"RTN","PSOREJUT",43,0)
 S REJ("CARDHOLDER ID")=$E($G(REJ("CARDHOLDER ID")),1,20)
"RTN","PSOREJUT",44,0)
 I $G(REJ("DATE/TIME"))="" D NOW^%DTC S REJ("DATE/TIME")=%
"RTN","PSOREJUT",45,0)
 ;
"RTN","PSOREJUT",46,0)
 S DIC="^PSRX("_RX_",""REJ"",",DA(1)=RX,DIC(0)=""
"RTN","PSOREJUT",47,0)
 ;S X=DATA("CODE")  ;X=+$G(REJ("CODE"))
"RTN","PSOREJUT",48,0)
 S X=$G(REJ("CODE"))
"RTN","PSOREJUT",49,0)
 S DINUM=$O(^PSRX(RX,"REJ",9999),-1)+1
"RTN","PSOREJUT",50,0)
 S DIC("DR")="1///"_$G(REJ("DATE/TIME"))_";2///"_REJ("PAYER MESSAGE")_";3///"_REJ("REASON")_";4////"_$G(REJ("PHARMACIST"))_";5///"_RFL
"RTN","PSOREJUT",51,0)
 S DIC("DR")=DIC("DR")_";6///"_REJ("GROUP NAME")_";7///"_REJ("PLAN CONTACT")_";8///"_$G(REJ("PREVIOUS FILL"))
"RTN","PSOREJUT",52,0)
 S DIC("DR")=DIC("DR")_";9///0;14///"_$G(REJ("REASON SVC CODE"))_";16///"_$G(REJ("RESPONSE IEN"))
"RTN","PSOREJUT",53,0)
 S DIC("DR")=DIC("DR")_";17///"_$G(REJ("OTHER REJECTS"))_";18///"_REJ("DUR TEXT")_";20///"_REJ("INSURANCE NAME")
"RTN","PSOREJUT",54,0)
 S DIC("DR")=DIC("DR")_";21///"_REJ("GROUP NUMBER")_";22///"_REJ("CARDHOLDER ID")_";23///"_$G(REJ("RE-OPENED"))
"RTN","PSOREJUT",55,0)
 ;
"RTN","PSOREJUT",56,0)
 F  L +^PSRX(RX):5 Q:$T  H 15
"RTN","PSOREJUT",57,0)
 K DD,DO D FILE^DICN K DD,DO S REJ("REJECT IEN")=+Y
"RTN","PSOREJUT",58,0)
 S REJ("OVERRIDE MSG")=$G(DATA("OVERRIDE MSG"))
"RTN","PSOREJUT",59,0)
 I REJ("OVERRIDE MSG")'="" D SAVECOM^PSOREJP3(RX,REJ("REJECT IEN"),REJ("OVERRIDE MSG"),$G(REJ("DATE/TIME")),$G(DUZ))
"RTN","PSOREJUT",60,0)
 K ERR
"RTN","PSOREJUT",61,0)
 L -^PSRX(RX)
"RTN","PSOREJUT",62,0)
 Q
"RTN","PSOREJUT",63,0)
 ; 
"RTN","PSOREJUT",64,0)
CLSALL(RX,RFL,USR,REA,COM,COD1,COD2,COD3,CLA,PA) ; Close/Resolve All Rejects
"RTN","PSOREJUT",65,0)
 ;Input: (r) RX   - Rx IEN (#52)
"RTN","PSOREJUT",66,0)
 ;       (o) RFL  - Refill # (Default: most recent)
"RTN","PSOREJUT",67,0)
 ;       (r) REA  - Close REASON code
"RTN","PSOREJUT",68,0)
 ;       (o) COM  - Close COMMENTS
"RTN","PSOREJUT",69,0)
 ;       (o) USR  - User DUZ responsible for closing all rejects
"RTN","PSOREJUT",70,0)
 ;       (o) COD1 - NCPDP Reason for Service Code for overriding DUR REJECTS
"RTN","PSOREJUT",71,0)
 ;       (o) COD2 - NCPDP Professional Service Code for overriding DUR REJECTS
"RTN","PSOREJUT",72,0)
 ;       (o) COD3 - NCPDP Result of Service Code for overriding DUR REJECTS
"RTN","PSOREJUT",73,0)
 ;       (o) CLA  - NCPDP Clarification Code for overriding RTS and DUR REJECTS
"RTN","PSOREJUT",74,0)
 ;       (o) PA   - NCPDP Prior Authorization Type and Number (separated by "^")
"RTN","PSOREJUT",75,0)
 N REJ,REJDATA,DIE,DR,DA
"RTN","PSOREJUT",76,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOREJUT",77,0)
 ;
"RTN","PSOREJUT",78,0)
 ; - Closing OPEN/UNRESOLVED rejects
"RTN","PSOREJUT",79,0)
 I $$FIND(RX,RFL,.REJDATA) D
"RTN","PSOREJUT",80,0)
 . S REJ="" F  S REJ=$O(REJDATA(REJ)) Q:'REJ  D
"RTN","PSOREJUT",81,0)
 . . D CLOSE(RX,RFL,REJ,USR,REA,$G(COM),$G(COD1),$G(COD2),$G(COD3),$G(CLA),$G(PA))
"RTN","PSOREJUT",82,0)
 Q
"RTN","PSOREJUT",83,0)
 ;
"RTN","PSOREJUT",84,0)
CLOSE(RX,RFL,REJ,USR,REA,COM,COD1,COD2,COD3,CLA,PA) ; - Mark a DUR/REFILL TOO SOON reject RESOLVED
"RTN","PSOREJUT",85,0)
 ; Input:  (r) RX  - Rx IEN (#52) 
"RTN","PSOREJUT",86,0)
 ;         (o) RFL - Refill # (Default: most recent)
"RTN","PSOREJUT",87,0)
 ;         (r) REJ - REJECT ID (IEN)
"RTN","PSOREJUT",88,0)
 ;         (o) USR - User (file #200 IEN) responsible for closing the REJECT
"RTN","PSOREJUT",89,0)
 ;         (r) REA - Reason for closing the REJECT:
"RTN","PSOREJUT",90,0)
 ;                       1:CLAIM RE-SUBMITTED
"RTN","PSOREJUT",91,0)
 ;                       2:RX ON HOLD
"RTN","PSOREJUT",92,0)
 ;                       3:RX SUSPENDED
"RTN","PSOREJUT",93,0)
 ;                       4:RX RETURNED TO STOCK
"RTN","PSOREJUT",94,0)
 ;                       5:RX DELETED
"RTN","PSOREJUT",95,0)
 ;                       6:OVERRIDEN W/OUT RE-SUBMISSION
"RTN","PSOREJUT",96,0)
 ;                       7:DISCONTINUED
"RTN","PSOREJUT",97,0)
 ;                       8:RX EDIT
"RTN","PSOREJUT",98,0)
 ;                      99:OTHER
"RTN","PSOREJUT",99,0)
 ;         (o) COM  - Close comments manually entered by the user
"RTN","PSOREJUT",100,0)
 ;         (o) COD1 - NCPDP Reason for Service Code for overriding DUR REJECTS
"RTN","PSOREJUT",101,0)
 ;         (o) COD2 - NCPDP Professional Service Code for overriding DUR REJECTS
"RTN","PSOREJUT",102,0)
 ;         (o) COD3 - NCPDP Result of Service Code for overriding DUR REJECTS
"RTN","PSOREJUT",103,0)
 ;         (o) CLA  - NCPDP Clarification Code for overriding RTS and DUR REJECTS
"RTN","PSOREJUT",104,0)
 ;         (o) PA   - NCPDP Prior Authorization Type and Number (separated by "^")
"RTN","PSOREJUT",105,0)
 ;
"RTN","PSOREJUT",106,0)
 I '$G(RX)!'$G(REJ) Q
"RTN","PSOREJUT",107,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOREJUT",108,0)
 I '$D(^PSRX(RX,"REJ",REJ)) Q
"RTN","PSOREJUT",109,0)
 I $$GET1^DIQ(52.25,REJ_","_RX,5)'=+$G(RFL) Q
"RTN","PSOREJUT",110,0)
 S:'$G(REA) REA=99 S COM=$TR($G(COM),";^",",,")
"RTN","PSOREJUT",111,0)
 ;
"RTN","PSOREJUT",112,0)
 N DQ,DA,DIE,DR,X,Y,REJCOM
"RTN","PSOREJUT",113,0)
 D NOW^%DTC
"RTN","PSOREJUT",114,0)
 S REJCOM="AUTOMATICALLY CLOSED" I REA'=1 S REJCOM=COM
"RTN","PSOREJUT",115,0)
 S DA(1)=RX,DA=REJ,DIE="^PSRX("_RX_",""REJ"","
"RTN","PSOREJUT",116,0)
 S DR="9///1;10///"_%_";11////"_$G(USR)_";12///"_REA_";13///"_REJCOM_";14///"_$G(COD1)_";15///"_$G(COD2)
"RTN","PSOREJUT",117,0)
 S DR=DR_";19///"_$G(COD3)_";24///"_$G(CLA)_";25///"_$P($G(PA),"^")_";26///"_$P($G(PA),"^",2)
"RTN","PSOREJUT",118,0)
 ;
"RTN","PSOREJUT",119,0)
 D ^DIE S X=$$ADDCOMM^BPSBUTL(RX,RFL,COM)
"RTN","PSOREJUT",120,0)
 Q
"RTN","PSOREJUT",121,0)
 ;
"RTN","PSOREJUT",122,0)
FIND(RX,RFL,REJDATA,CODE) ; - Returns whether a prescription/fill contains UNRESOLVED rejects
"RTN","PSOREJUT",123,0)
 ; Input: (r) RX - Rx IEN (#52) 
"RTN","PSOREJUT",124,0)
 ; (o) RFL - Refill # (If not passed, look original and all refills)
"RTN","PSOREJUT",125,0)
 ; (o) CODE - Can be null, a specific Reject Code(s) to be checked or multiple codes separated by comma's
"RTN","PSOREJUT",126,0)
 ; 
"RTN","PSOREJUT",127,0)
 ; Output: 1 - Rx contains unresolved Rejects 
"RTN","PSOREJUT",128,0)
 ; 0 - Rx does not contain unresolved Rejects
"RTN","PSOREJUT",129,0)
 ; .REJDATA - Array containing the Reject(s) data (see 
"RTN","PSOREJUT",130,0)
 ; GET^PSOREJU2 for fields documentation)
"RTN","PSOREJUT",131,0)
 ;
"RTN","PSOREJUT",132,0)
 N RCODE,I,REJS
"RTN","PSOREJUT",133,0)
 S REJS=0,RCODE=""
"RTN","PSOREJUT",134,0)
 K REJDATA
"RTN","PSOREJUT",135,0)
 I $G(RFL),$$STATUS^PSOBPSUT(RX,RFL)="" Q 0
"RTN","PSOREJUT",136,0)
 I $G(CODE),CODE["," S REJS=$$MULTI^PSOREJU4(RX,$G(RFL),.REJDATA,$G(CODE),REJS) G FEND
"RTN","PSOREJUT",137,0)
 S REJS=$$SINGLE^PSOREJU4(RX,$G(RFL),.REJDATA,$G(CODE),REJS)
"RTN","PSOREJUT",138,0)
FEND ;
"RTN","PSOREJUT",139,0)
 Q $S(REJS:1,1:0)
"RTN","PSOREJUT",140,0)
 ;
"RTN","PSOREJUT",141,0)
 ;
"RTN","PSOREJUT",142,0)
SYNC(RX,RFL,USR) ;
"RTN","PSOREJUT",143,0)
 ; Input:  (r) RX  - Rx IEN (#52) 
"RTN","PSOREJUT",144,0)
 ;         (o) RFL - Refill # (Default: most recent)
"RTN","PSOREJUT",145,0)
 ;         (o) USR - User using the system when this routine is called
"RTN","PSOREJUT",146,0)
 ;
"RTN","PSOREJUT",147,0)
 N REJ,REJS,REJLST,I,IDX,CODE,DATA,TXT,PSOTRIC,ERR,PSODIV,OPECC,OVREJ
"RTN","PSOREJUT",148,0)
 L +^PSRX("REJ",RX):0 Q:'$T
"RTN","PSOREJUT",149,0)
 I '$D(RFL) S RFL=$$LSTRFL^PSOBPSU1(RX)
"RTN","PSOREJUT",150,0)
 S PSODIV=$$RXSITE^PSOBPSUT(RX,RFL)
"RTN","PSOREJUT",151,0)
 D DUR1^BPSNCPD3(RX,RFL,.REJ)
"RTN","PSOREJUT",152,0)
 S PSOTRIC="" S:$G(REJ(1,"ELIGBLT"))="T" PSOTRIC=1
"RTN","PSOREJUT",153,0)
 S:PSOTRIC="" PSOTRIC=$$TRIC^PSOREJP1(RX,RFL,PSOTRIC)
"RTN","PSOREJUT",154,0)
 K REJS S (OPECC,IDX,ERR)=""
"RTN","PSOREJUT",155,0)
 F  S IDX=$O(REJ(IDX)) Q:IDX=""  D
"RTN","PSOREJUT",156,0)
 . S TXT=$G(REJ(IDX,"REJ CODE LST"))
"RTN","PSOREJUT",157,0)
 . F I=1:1:$L(TXT,",") D
"RTN","PSOREJUT",158,0)
 . . S CODE=$P(TXT,",",I),OVREJ=""
"RTN","PSOREJUT",159,0)
 . . I CODE'="79"&(CODE'="88")&('$G(PSOTRIC)) S ERR=$$EVAL^PSOREJU4(PSODIV,CODE,OPECC,.ERR) Q:'+ERR
"RTN","PSOREJUT",160,0)
 . . S:+$G(ERR) OVREJ=1
"RTN","PSOREJUT",161,0)
 . . I $$DUP^PSOREJU1(RX,+$$CLEAN^PSOREJU1($G(REJ(IDX,"RESPONSE IEN")))) Q
"RTN","PSOREJUT",162,0)
 . . S REJS(IDX,CODE)=OVREJ
"RTN","PSOREJUT",163,0)
 I '$D(REJS) L -^PSRX("REJ",RX) Q
"RTN","PSOREJUT",164,0)
SYNC2 ;
"RTN","PSOREJUT",165,0)
 S (IDX,CODE)=""
"RTN","PSOREJUT",166,0)
 F  S IDX=$O(REJS(IDX)) Q:IDX=""  D
"RTN","PSOREJUT",167,0)
 . F  S CODE=$O(REJS(IDX,CODE)) Q:CODE=""  D
"RTN","PSOREJUT",168,0)
 . . K DATA
"RTN","PSOREJUT",169,0)
 . . I 'OPECC&(CODE'[79)&(CODE'[88) S DATA("OVERRIDE MSG")="Automatically transferred due to override for reject code."
"RTN","PSOREJUT",170,0)
 . . I OPECC&(CODE'[79)&(CODE'[88) S DATA("OVERRIDE MSG")="Transferred by OPECC."
"RTN","PSOREJUT",171,0)
 . . I $D(COMMTXT) S:COMMTXT'="" DATA("OVERRIDE MSG")=DATA("OVERRIDE MSG")_" "_$$CLEAN^PSOREJU1($P(COMMTXT,":",2))
"RTN","PSOREJUT",172,0)
 . . S DATA("DUR TEXT")=$$CLEAN^PSOREJU1($G(REJ(IDX,"DUR FREE TEXT DESC")))
"RTN","PSOREJUT",173,0)
 . . S DATA("PAYER MESSAGE")=$$CLEAN^PSOREJU1($G(REJ(IDX,"PAYER MESSAGE")))
"RTN","PSOREJUT",174,0)
 . . S DATA("CODE")=CODE
"RTN","PSOREJUT",175,0)
 . . S DATA("REASON")=$$CLEAN^PSOREJU1($G(REJ(IDX,"REASON")))
"RTN","PSOREJUT",176,0)
 . . S DATA("PHARMACIST")=$G(USR)
"RTN","PSOREJUT",177,0)
 . . S DATA("INSURANCE NAME")=$$CLEAN^PSOREJU1($G(REJ(IDX,"INSURANCE NAME")))
"RTN","PSOREJUT",178,0)
 . . S DATA("GROUP NAME")=$$CLEAN^PSOREJU1($G(REJ(IDX,"GROUP NAME")))
"RTN","PSOREJUT",179,0)
 . . S DATA("GROUP NUMBER")=$$CLEAN^PSOREJU1($G(REJ(IDX,"GROUP NUMBER")))
"RTN","PSOREJUT",180,0)
 . . S DATA("CARDHOLDER ID")=$$CLEAN^PSOREJU1($G(REJ(IDX,"CARDHOLDER ID")))
"RTN","PSOREJUT",181,0)
 . . S DATA("PLAN CONTACT")=$$CLEAN^PSOREJU1($G(REJ(IDX,"PLAN CONTACT")))
"RTN","PSOREJUT",182,0)
 . . S DATA("PREVIOUS FILL")=$$CLEAN^PSOREJU1($$DAT^PSOREJU1($G(REJ(IDX,"PREVIOUS FILL DATE"))))
"RTN","PSOREJUT",183,0)
 . . S DATA("OTHER REJECTS")=$$CLEAN^PSOREJU1($$OTH^PSOREJU1(CODE,$G(REJ(IDX,"REJ CODE LST"))))
"RTN","PSOREJUT",184,0)
 . . S DATA("RESPONSE IEN")=+$$CLEAN^PSOREJU1($G(REJ(IDX,"RESPONSE IEN")))
"RTN","PSOREJUT",185,0)
 . . S DATA("REASON SVC CODE")=$$REASON^PSOREJU2($G(REJ(IDX,"REASON")))
"RTN","PSOREJUT",186,0)
 . . D SAVE(RX,RFL,.DATA)
"RTN","PSOREJUT",187,0)
 L -^PSRX("REJ",RX)
"RTN","PSOREJUT",188,0)
 Q
"RTN","PSORXED")
0^35^B65116551
"RTN","PSORXED",1,0)
PSORXED ;IHS/DSD/JCM-edit rx utility ; 5/18/07 2:53pm
"RTN","PSORXED",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**2,16,21,26,56,71,125,201,246,289**;DEC 1997;Build 107
"RTN","PSORXED",3,0)
 ;External reference to ^PSXEDIT supported by DBIA 2209
"RTN","PSORXED",4,0)
 ;External reference to ^DD(52 supported by DBIA 999
"RTN","PSORXED",5,0)
 ;External reference to ^PSDRUG supported by DBIA 221
"RTN","PSORXED",6,0)
 ;External reference to ^PS(55 supported by DBIA 2228
"RTN","PSORXED",7,0)
START ;this entry point is no longer used.
"RTN","PSORXED",8,0)
 ;D INIT,LKUP G:PSORXED("QFLG") END D PARSE,EOJ G START
"RTN","PSORXED",9,0)
END D EOJ
"RTN","PSORXED",10,0)
 Q
"RTN","PSORXED",11,0)
INIT S PSORXED("QFLG")=0 Q
"RTN","PSORXED",12,0)
LKUP ; this line of code is no longer used S PSONUM="RX",PSONUM("A")="EDIT",PSOQFLG=0 D EN1^PSONUM I PSOQFLG!($Q(PSOLIST)']"") S PSORXED("QFLG")=1
"RTN","PSORXED",13,0)
 K PSOQFLG Q
"RTN","PSORXED",14,0)
 ;
"RTN","PSORXED",15,0)
PARSE F PSORXED("LIST")=1:1 Q:'$D(PSOLIST(PSORXED("LIST")))!PSORXED("QFLG")  F PSORXED("I")=1:1:$L(PSOLIST(PSORXED("LIST"))) S PSORXED("IRXN")=$P(PSOLIST(PSORXED("LIST")),",",PSORXED("I")) D:+PSORXED("IRXN") PROCESS
"RTN","PSORXED",16,0)
 Q
"RTN","PSORXED",17,0)
PROCESS S PSORXED("DFLG")=0 G:$G(^PSRX(PSORXED("IRXN"),0))']"" PROCESSX
"RTN","PSORXED",18,0)
 S PSORXED("RX0")=^PSRX(PSORXED("IRXN"),0),PSORXED("RX2")=^(2),PSORXED("RX3")=^(3),PSOSIG=$G(^PSRX(PSORXED("IRXN"),"SIG")),PSODAYS=$P(PSORXED("RX0"),"^",8)
"RTN","PSORXED",19,0)
 S (I,RFED,RFDT)=0 F  S I=$O(^PSRX(PSORXED("IRXN"),1,I)) Q:'I  S RFED=I,PSORXED("RX1")=^PSRX(PSORXED("IRXN"),1,I,0),RFDT=$P(^(0),"^"),PSODAYS=$P(^(0),"^",10) S:$P(^(0),"^",17) PSONEW("PROVIDER NAME")=$P(^VA(200,$P(^(0),"^",17),0),"^")
"RTN","PSORXED",20,0)
 S PSORXST=+$P($G(^PS(53,+$P(PSORXED("RX0"),"^",3),0)),"^",7) N DA S DA=PSORXED("IRXN") D EN^PSORXPR
"RTN","PSORXED",21,0)
 D CHECK G:PSORXED("DFLG") PROCESSX
"RTN","PSORXED",22,0)
 N X S X="PSXEDIT" X ^%ZOSF("TEST") K X I $T D ^PSXEDIT I $G(PSXOUT) K PSXOUT G L1
"RTN","PSORXED",23,0)
 D DIE^PSORXED1
"RTN","PSORXED",24,0)
L1 D LOG,POST
"RTN","PSORXED",25,0)
PROCESSX Q
"RTN","PSORXED",26,0)
CHECK Q  L +^PSRX(PSORXED("IRXN")):$S(+$G(^DD("DILOCKTM"))>0:+^DD("DILOCKTM"),1:3) I '$T W $C(7),!!,"Rx Number is Locked by Another User!",! S PSORXED("DFLG")=1 H 5 Q
"RTN","PSORXED",27,0)
 I $G(^PSDRUG($P(PSORXED("RX0"),"^",6),"I"))]"",^("I")<DT D  G CHECKX
"RTN","PSORXED",28,0)
 . W !,$C(7),"This drug has been inactivated. ",! S PSORXED("DFLG")=1 Q
"RTN","PSORXED",29,0)
 K PSPOP I $G(PSODIV),$P(PSORXED("RX2"),"^",9)'=PSOSITE S PSPRXN=PSORXED("IRXN") D CHK1^PSOUTLA I $G(PSPOP)=1 S PSORXED("DFLG")=1 G CHECKX
"RTN","PSORXED",30,0)
 ;
"RTN","PSORXED",31,0)
 I $P(^PSRX(PSORXED("IRXN"),"STA"),"^")=14!($P(^("STA"),"^")=15) S PSORXED("DFLG")=1 W !!,$C(7),"Discontinued prescriptions cannot be edited.",! G CHECKX
"RTN","PSORXED",32,0)
 I $D(^PS(52.4,"B",PSORXED("IRXN"))) S PSORXED("DFLG")=1 W !!,$C(7),"Non-verified prescriptions cannot be edited.",!
"RTN","PSORXED",33,0)
CHECKX K PSPOP,DIR,DTOUT,DUOUT,Y,X Q
"RTN","PSORXED",34,0)
LOG K PSFROM S DA=PSORXED("IRXN"),(PSRX0,RX0)=PSORXED("RX0"),QTY=$P(RX0,"^",7),QTY=QTY-$P(^PSRX(DA,0),"^",7) K ZD(DA) S:'$O(^PSRX(DA,1,0)) ZD(DA)=$P(^PSRX(DA,2),"^",2)
"RTN","PSORXED",35,0)
 N PSOTRIC S PSOTRIC="",PSOTRIC=$$TRIC^PSOREJP1(PSORXED("IRXN"),0,.PSOTRIC)
"RTN","PSORXED",36,0)
 S COM="" F I=3,4,5:1:13,17 I $P(PSRX0,"^",I)'=$P(^PSRX(DA,0),"^",I) S PSI=$S(I=13:1,1:I),COM=COM_$P(^DD(52,PSI,0),"^")_" ("_$P(PSRX0,"^",I)_"),"
"RTN","PSORXED",37,0)
 I $P(PSORXED("RX2"),"^",2)'=$P(^PSRX(DA,2),"^",2) S COM=COM_$P(^DD(52,22,0),"^")_" ("_$P(PSORXED("RX2"),"^",2)_"),"
"RTN","PSORXED",38,0)
 I $P(PSORXED("RX3"),"^",7)'=$P(^PSRX(DA,3),"^",7) S COM=COM_$P(^DD(52,12,0),"^")_" ("_$P(PSORXED("RX3"),"^",7)_"),"
"RTN","PSORXED",39,0)
 I PSOSIG'=$P($G(^PSRX(DA,"SIG")),"^") S COM=COM_$P(^DD(52,10,0),"^")_" ("_PSOSIG_"),"
"RTN","PSORXED",40,0)
 I PSOTRN'=$G(^PSRX(DA,"TN")) S COM=COM_$P(^DD(52,6.5,0),"^")_" ("_PSOTRN_"),"
"RTN","PSORXED",41,0)
 D FILL
"RTN","PSORXED",42,0)
 I PSOTRIC&('$$RXRLDT^PSOBPSUT(PSORXED("IRXN"),PSOEDITF)),COM="" D LBLCHK G LOGX ; labels for unrelease Tricare resolved claims; when COM'="" label always printed
"RTN","PSORXED",43,0)
 I PSOTRIC&(COM="") D LBL D ASKL:PSOEDITL G:'PSOEDITL LOGX G LOG1
"RTN","PSORXED",44,0)
 G:COM="" LOGX K PSRX0 S X=$S($D(PSOCLC):PSOCLC,1:DUZ)
"RTN","PSORXED",45,0)
 D LBL D:$G(PSOEDITL)=2&($P($G(^PSRX(DA,"STA")),"^")'=5)&('$G(RXRP(DA)))&('$G(PSOSIGFL)) ASKL
"RTN","PSORXED",46,0)
 S K=1,D1=0 F Z=0:0 S Z=$O(^PSRX(DA,"A",Z)) Q:'Z  S D1=Z,K=K+1
"RTN","PSORXED",47,0)
 S D1=D1+1 S:'($D(^PSRX(DA,"A",0))#2) ^(0)="^52.3DA^^^" S ^(0)=$P(^(0),"^",1,2)_"^"_D1_"^"_K
"RTN","PSORXED",48,0)
 S ^PSRX(DA,"A",D1,0)=DT_"^E^"_$G(DUZ)_"^0^"_COM
"RTN","PSORXED",49,0)
LOG1 ;
"RTN","PSORXED",50,0)
 I QTY,$P(^PSRX(DA,2),"^",13) S ^PSDRUG($P(^PSRX(DA,0),"^",6),660.1)=$S($D(^PSDRUG(+$P(^PSRX(DA,0),"^",6),660.1)):^(660.1)+QTY,1:QTY)
"RTN","PSORXED",51,0)
 S:$P(RX0,"^",6)'=$P(^PSRX(DA,0),"^",6) ^PSDRUG(+$P(^PSRX(DA,0),"^",6),660.1)=$S($D(^PSDRUG(+$P(RX0,"^",6),660.1)):^(660.1)+$P(RX0,"^",7),1:$P(RX0,"^",7))
"RTN","PSORXED",52,0)
 S RX0=^PSRX(DA,0),RX2=^(2),J=DA,OEXDT=+$P(RX2,"^",6) D ^PSOEXDT S NEXDT=+$P(RX2,"^",6) I OEXDT'=NEXDT D
"RTN","PSORXED",53,0)
 .K ^PSRX("AG",OEXDT,DA) S ^PSRX("AG",NEXDT,DA)=""
"RTN","PSORXED",54,0)
 .S D=+$P(RX0,"^",2) K ^PS(55,D,"P","A",OEXDT,DA) S ^PS(55,D,"P","A",NEXDT,DA)=""
"RTN","PSORXED",55,0)
 K D,OEXDT,NEXDT
"RTN","PSORXED",56,0)
 G:+$P(^PSRX(J,"STA"),"^")!($G(PSOEDITL)=1&('$G(PSOTRIC))) LOGX S RXFL(PSORXED("IRXN"))=$S($G(PSOEDITF):$G(PSOEDITF),1:0) I $G(PSORX("PSOL",1))']"" S PSORX("PSOL",1)=PSORXED("IRXN")_"," D SETRP G LOGX
"RTN","PSORXED",57,0)
 G:$G(PSOEDITL)=1&('$G(PSOTRIC)) LOGX
"RTN","PSORXED",58,0)
 F PSOX1=0:0 S PSOX1=$O(PSORX("PSOL",PSOX1)) Q:'PSOX1  S PSOX2=PSOX1
"RTN","PSORXED",59,0)
 I $L(PSORX("PSOL",PSOX2))+$L(PSORXED("IRXN"))<220 D  G LOGX
"RTN","PSORXED",60,0)
 .I PSORX("PSOL",PSOX2)'[PSORXED("IRXN")_"," S PSORX("PSOL",PSOX2)=PSORX("PSOL",PSOX2)_PSORXED("IRXN")_"," D SETRP
"RTN","PSORXED",61,0)
 E  I $G(PSORX("PSOL",PSOX2+1))'[PSORXED("IRXN")_"," S PSORX("PSOL",PSOX2+1)=PSORXED("IRXN")_"," D SETRP   ;;PSO*7*246
"RTN","PSORXED",62,0)
LOGX K PSOEDITF,PSOEDITR,PSOEDITL D:$G(RFED) ^PSORXED1
"RTN","PSORXED",63,0)
 Q
"RTN","PSORXED",64,0)
POST ; D NEXT D:$G(^PSRX(PSORXED("IRXN"),"IB"))]"" COPAY K PSODAYS,PSORXST
"RTN","PSORXED",65,0)
 D NEXT D COPAY K PSODAYS,PSORXST
"RTN","PSORXED",66,0)
 Q
"RTN","PSORXED",67,0)
COPAY S DA=PSORXED("IRXN") I 'RFD,PSODAYS'=+$P(^PSRX(DA,0),"^",8) I +$G(^PSRX(DA,"IB"))!($P($G(^PSRX(DA,"PFS")),"^",2)) D CPCK G RXST
"RTN","PSORXED",68,0)
 I RFD,+$G(^PSRX(DA,1,RFD,0)),PSODAYS'=$P($G(^PSRX(DA,1,RFD,0)),"^",10) I +$G(^PSRX(DA,"IB"))!($P($G(^PSRX(DA,1,RFD,"PFS")),"^",2)) D CPCK
"RTN","PSORXED",69,0)
RXST G:PSORXST=+$P($G(^PS(53,+$P(^PSRX(DA,0),"^",3),0)),"^",7) COPAYX
"RTN","PSORXED",70,0)
 W !,$C(7),"Patient Status field for this Rx has been changed from a ",$S(PSORXST=0:"COPAYMENT ELIGIBLE",PSORXST=1:"COPAYMENT EXEMPT",1:"")
"RTN","PSORXED",71,0)
 W !,"patient status."
"RTN","PSORXED",72,0)
 W "  The copay status for this Rx will be automatically adjusted."
"RTN","PSORXED",73,0)
 W !,"If action needs to be taken to adjust charges you MUST use the"
"RTN","PSORXED",74,0)
 W !,"Reset Copay Status/Cancel Charges option."
"RTN","PSORXED",75,0)
 W ! K DIR S DIR(0)="E",DIR("A")="Press Return to continue" D ^DIR K DIR
"RTN","PSORXED",76,0)
 I +$P($G(^PS(53,+$P(^PSRX(DA,0),"^",3),0)),"^",7)=1 D  ; SET TO NO COPAY AND AUDIT CHANGE
"RTN","PSORXED",77,0)
 . I '$D(^PSRX(DA,"IB")) S ^PSRX(DA,"IB")=""
"RTN","PSORXED",78,0)
 . S $P(^PSRX(DA,"IB"),"^",1)=""
"RTN","PSORXED",79,0)
 . S PSODA=DA
"RTN","PSORXED",80,0)
 . S PSOREF=RFD
"RTN","PSORXED",81,0)
 . S PSOCOMM="Rx Patient Status Change"
"RTN","PSORXED",82,0)
 . S PSOOLD="Copay"
"RTN","PSORXED",83,0)
 . S PSONW="No Copay"
"RTN","PSORXED",84,0)
 . S PREA="R"
"RTN","PSORXED",85,0)
 . D ACTLOG^PSOCPA
"RTN","PSORXED",86,0)
COPAYX K DA,PSODAYS,PSO,PSODA,PSOFLAG,PSORXST,RFD,PSOREF,PSOCOMM,PSOOLD,PSONW
"RTN","PSORXED",87,0)
 Q
"RTN","PSORXED",88,0)
CPCK ;update COPAY
"RTN","PSORXED",89,0)
 I 'RFD,'$D(^PSRX(DA,"PFS")) G CPCK1
"RTN","PSORXED",90,0)
 I RFD,'$D(^PSRX(DA,1,RFD,"PFS")) G CPCK1
"RTN","PSORXED",91,0)
 N PSOPFS S PSOPFS=$P($S('RFD:^PSRX(DA,"PFS"),1:^PSRX(DA,1,RFD,"PFS")),"^",1,2)
"RTN","PSORXED",92,0)
 I +$G(PSOPFS)>0&('$P($G(PSOPFS),"^",2)) K PSOPFS Q
"RTN","PSORXED",93,0)
 I +$G(PSOPFS)<1 K PSOPFS
"RTN","PSORXED",94,0)
 E  S PSOPFS="1^"_PSOPFS
"RTN","PSORXED",95,0)
CPCK1 N TYPE S PSO=2,PSODA=DA,PSOFLAG=1,PSOPAR7=$G(^PS(59,PSOSITE,"IB")),TYPE=RFD D RXED^PSOCPA K TYPE
"RTN","PSORXED",96,0)
 Q
"RTN","PSORXED",97,0)
NEXT D NEXT^PSOUTIL(.PSORXED) K DIE,DR,DA S DIE="^PSRX(",DA=PSORXED("IRXN")
"RTN","PSORXED",98,0)
 S DR="101///"_$P(PSORXED("RX3"),"^")_";102///"_$P(PSORXED("RX3"),"^",2) D ^DIE K DIE,DR,DA,X,Y
"RTN","PSORXED",99,0)
 Q
"RTN","PSORXED",100,0)
EOJ K PSOSIG,PSORXED,PSOLIST,END,PSRX0
"RTN","PSORXED",101,0)
 D EX^PSORXED1
"RTN","PSORXED",102,0)
 Q
"RTN","PSORXED",103,0)
FILL ;
"RTN","PSORXED",104,0)
 K PSOEDITF,PSOEDITR,PSOERF
"RTN","PSORXED",105,0)
 F PSOEZ=0:0 S PSOEZ=$O(^PSRX(DA,1,PSOEZ)) Q:'PSOEZ  S:$D(^PSRX(DA,1,PSOEZ,0)) PSOERF=PSOEZ
"RTN","PSORXED",106,0)
 S PSOEDITF=$S($G(PSOERF):+$G(PSOERF),1:0)
"RTN","PSORXED",107,0)
 I PSOEDITF S PSOEDITR=$S($P($G(^PSRX(DA,1,PSOEDITF,0)),"^",18):1,1:0) G FILLX
"RTN","PSORXED",108,0)
 S PSOEDITR=$S($P($G(^PSRX(DA,2)),"^",13):1,1:0)
"RTN","PSORXED",109,0)
FILLX K PSOERF,PSOEZ
"RTN","PSORXED",110,0)
 Q
"RTN","PSORXED",111,0)
LBL ;
"RTN","PSORXED",112,0)
 S PSOEDITL=0 N PSOECMES S PSOECMES="",PSOECMES=$$STATUS^PSOBPSUT(PSORXED("IRXN"),PSOEDITF)
"RTN","PSORXED",113,0)
 I PSOTRIC D  Q:'PSOEDITL
"RTN","PSORXED",114,0)
 . I PSOECMES["IN PROGRESS"!(PSOECMES["REJECTED") S PSOEDITL=0 Q
"RTN","PSORXED",115,0)
 . I $$FIND^PSOREJUT(PSORXED("IRXN"),PSOEDITF) S PSOEDITL=0 Q
"RTN","PSORXED",116,0)
 . I ",12,14,15,"[(","_$P($G(^PSRX(PSORXED("IRXN"),"STA")),"^")_",") S PSOEDITL=0 Q
"RTN","PSORXED",117,0)
 . I COM="" S:'$G(PSOEDITF)&$G(PSOEDITR) PSOEDITL=2 Q
"RTN","PSORXED",118,0)
 Q:PSOEDITL=2&($G(PSOTRIC))&(COM="")
"RTN","PSORXED",119,0)
 I COM["PROV"!(COM["QTY")!(COM["DAYS")!(COM["MAIL")!(COM["UNIT")!(COM["FILL DATE")!(COM["REMARKS") I COM'["STATUS",COM'["CLINIC",COM'["DRUG",COM'["REFILLS",COM'["ISSUE",COM'["SIG",COM'["TRADE" D  Q
"RTN","PSORXED",120,0)
 .I $G(PSOEDITF) S PSOEDITL=1 Q
"RTN","PSORXED",121,0)
 .I '$G(PSOEDITF),'$G(PSOEDITR),PSOTRIC S PSOEDITL=2 Q
"RTN","PSORXED",122,0)
 .I '$G(PSOEDITF),$G(PSOEDITR) S PSOEDITL=2
"RTN","PSORXED",123,0)
 I '$G(PSOEDITF),$G(PSOEDITR) S PSOEDITL=2 Q
"RTN","PSORXED",124,0)
 I '$G(PSOEDITF),'$G(PSOEDITR) S PSOEDITL=0 Q
"RTN","PSORXED",125,0)
 I $G(RXRP(DA)) S PSOEDITL=1 Q
"RTN","PSORXED",126,0)
 I '$G(RXRP(DA)),$G(PSOEDITR) S PSOEDITL=2 Q
"RTN","PSORXED",127,0)
 S PSOEDITL=0
"RTN","PSORXED",128,0)
 Q
"RTN","PSORXED",129,0)
LBLCHK ;
"RTN","PSORXED",130,0)
 I '$$RXRLDT^PSOBPSUT(PSORXED("IRXN"),PSOEDITF) D
"RTN","PSORXED",131,0)
 .I $$PTLBL^PSOREJP2(PSORXED("IRXN"),PSOEDITF) D PRINT^PSOREJP3(PSORXED("IRXN"),PSOEDITF)
"RTN","PSORXED",132,0)
 Q
"RTN","PSORXED",133,0)
ASKL     ;
"RTN","PSORXED",134,0)
 W ! K DIR S DIR("?",1)="You have edited a fill that has already been released. Do you want to",DIR("?",2)="include this prescription as one of the prescriptions to be acted upon",DIR("?",3)="at the label prompt."
"RTN","PSORXED",135,0)
 S DIR("?")="Enter 'Yes' to generate a reprint label request."
"RTN","PSORXED",136,0)
 S DIR(0)="Y",DIR("A")="The last fill has been released, do you want a reprint label",DIR("B")="Y" D ^DIR K DIR I Y=1 S PSOEDITL=$S($G(PSOTRIC)&(Y'=1):1,1:0) Q
"RTN","PSORXED",137,0)
 S PSOEDITL=1
"RTN","PSORXED",138,0)
 Q
"RTN","PSORXED",139,0)
SETRP I $P($G(^PSRX(PSORXED("IRXN"),"STA")),"^")'=5,$G(PSOEDITL)=0 S RXRP(PSORXED("IRXN"))="1^^^1",VALMSG="Label will reprint due to Edit"
"RTN","PSORXED",140,0)
 Q
"RTN","PSORXED1")
0^40^B21189403
"RTN","PSORXED1",1,0)
PSORXED1 ;BHAM ISC/SAB - Edit prescription utility #2 ; 02/18/98  3:16 PM
"RTN","PSORXED1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**2,16,21,289**;DEC 1997;Build 107
"RTN","PSORXED1",3,0)
 ;show edits on last refill
"RTN","PSORXED1",4,0)
 F ZDL=0:0 S ZDL=$O(^PSRX(DA,1,ZDL)) Q:'ZDL  S:$P($G(^PSRX(DA,1,ZDL,0)),"^") ZD(DA)=$P($G(^PSRX(DA,1,ZDL,0)),"^")
"RTN","PSORXED1",5,0)
 G:'$O(^PSRX(DA,1,0))!($G(^PSRX(DA,1,RFED,0))']"") SUS S (PSRX1,RX1)=PSORXED("RX1"),QTY=$P(RX1,"^",4),QTY=QTY-$P(^PSRX(DA,1,RFED,0),"^",4)
"RTN","PSORXED1",6,0)
 S COM1="" F I=1:1:6,9:1:11,17 I $P(PSRX1,"^",I)'=$P(^PSRX(DA,1,RFED,0),"^",I) D
"RTN","PSORXED1",7,0)
 .S PSI=$S(I=1:.01,I=4:1,I=5:4,I=6:5,I=9:8,I=10:1.1,I=11:1.2,I=17:15,1:I),COM1=COM1_$P(^DD(52.1,PSI,0),"^")_" ("_$P(PSRX1,"^",I)_"),"
"RTN","PSORXED1",8,0)
 ;
"RTN","PSORXED1",9,0)
 N PSOTRIC,PSOECMES,PSOERFL S (PSOTRIC,PSOERFL,PSOECMES)="",PSOERFL=$$LSTRFL^PSOBPSU1(DA),PSOECMES=$$FIND^PSOREJUT(DA,PSOERFL)
"RTN","PSORXED1",10,0)
 S PSOTRIC="",PSOTRIC=$$TRIC^PSOREJP1(DA,PSOERFL,.PSOTRIC)
"RTN","PSORXED1",11,0)
 I COM1=""&('$G(PSOTRIC)) K COM1 G SUS
"RTN","PSORXED1",12,0)
 I COM1=""&($G(PSOTRIC)) G:'PSOECMES SKPTRIC I PSOECMES K COM1 G SUS
"RTN","PSORXED1",13,0)
 ;
"RTN","PSORXED1",14,0)
 S K=1,D1=0 F Z=0:0 S Z=$O(^PSRX(DA,"A",Z)) Q:'Z  S D1=Z,K=K+1
"RTN","PSORXED1",15,0)
 S D1=D1+1 S:'($D(^PSRX(DA,"A",0))#2) ^(0)="^52.3DA^^^" S ^(0)=$P(^(0),"^",1,2)_"^"_D1_"^"_K
"RTN","PSORXED1",16,0)
 S ^PSRX(DA,"A",D1,0)=DT_"^E^"_DUZ_"^"_$S(RFED'<0&(RFED<6):RFED,1:(RFED+1))_"^"_COM1
"RTN","PSORXED1",17,0)
SKPTRIC ;
"RTN","PSORXED1",18,0)
 I QTY,$P(^PSRX(DA,1,RFED,0),"^",18) S ^PSDRUG($P(^PSRX(DA,0),"^",6),660.1)=$S($D(^PSDRUG(+$P(^PSRX(DA,0),"^",6),660.1)):^(660.1)+QTY,1:QTY)
"RTN","PSORXED1",19,0)
 G:RFD'=RFED EX
"RTN","PSORXED1",20,0)
 D FILL^PSORXED S PSOEDITL=$S($G(PSOEDITF)'=$G(RFED):1,$G(PSOEDITF)=$G(RFED)&('$G(PSOEDITR)):0,1:2)
"RTN","PSORXED1",21,0)
 I $G(PSOTRIC)&(PSOECMES) S PSOEDITL=0 G SUS
"RTN","PSORXED1",22,0)
 I $G(PSOEDITL)=2,'$G(RXRP(DA)),$P($G(^PSRX(DA,"STA")),"^")'=5,'$G(PSOSIGFL) D ASKL^PSORXED
"RTN","PSORXED1",23,0)
 G:+$P(^PSRX(DA,"STA"),"^")!($G(PSOEDITL)=1&('$G(PSOTRIC))) SUS I $G(PSORX("PSOL",1))']"" S PSORX("PSOL",1)=PSORXED("IRXN")_"," S RXFL(DA)=RFED D SETRP^PSORXED G SUS
"RTN","PSORXED1",24,0)
 F PSOX1=0:0 S PSOX1=$O(PSORX("PSOL",PSOX1)) Q:'PSOX1  S PSOX2=PSOX1
"RTN","PSORXED1",25,0)
 I $L(PSORX("PSOL",PSOX2))+$L(PSORXED("IRXN"))<220 D  G ELSE
"RTN","PSORXED1",26,0)
 .I PSORX("PSOL",PSOX2)'[PSORXED("IRXN")_"," S PSORX("PSOL",PSOX2)=PSORX("PSOL",PSOX2)_PSORXED("IRXN")_"," D SETRP^PSORXED
"RTN","PSORXED1",27,0)
 E  I PSORX("PSOL",PSOX2)'[PSORXED("IRXN")_"," S PSORX("PSOL",PSOX2+1)=PSORXED("IRXN")_"," D SETRP^PSORXED
"RTN","PSORXED1",28,0)
ELSE S RXFL(DA)=RFED
"RTN","PSORXED1",29,0)
 K COM1
"RTN","PSORXED1",30,0)
SUS ;update suspense file
"RTN","PSORXED1",31,0)
 K PSOEDITF,PSOEDITR,PSOEDITL
"RTN","PSORXED1",32,0)
 S RXS=$O(^PS(52.5,"B",DA,0)) I RXS,$G(^PS(52.5,RXS,"P"))=1 S ZD=$P(^PSRX(DA,3),"^") Q
"RTN","PSORXED1",33,0)
 G:'RXS EX
"RTN","PSORXED1",34,0)
 N PSOSITE I RFDT,$G(^PSRX(DA,1,RFED,0))]"",RFDT'=+$G(^PSRX(DA,1,RFED,0))!($P(PSORXED("RX1"),"^",9)'=$P(^(0),"^",9)) S SD=$P(^PSRX(DA,1,RFED,0),"^"),PSOSITE=$P(^(0),"^",9) D SUP Q
"RTN","PSORXED1",35,0)
 I 'RFED,$P(PSORXED("RX2"),"^",2)'=$P(^PSRX(DA,2),"^",2)!($P(PSORXED("RX2"),"^",9)'=$P(^(2),"^",9)) S SD=$P(^PSRX(DA,2),"^",2),PSOSITE=$P(^(2),"^",9) D SUP
"RTN","PSORXED1",36,0)
EX K COM1,DIK,K,PSORXED("RX1"),RX1,RXS,SD,IR,FDA,RXN,RFDT,COPIES,J,PSPOP,COM,RX0,RX2,D1,IOP,%,%Y,D0,DA,D1
"RTN","PSORXED1",37,0)
 K DIC,DIE,DIG,DQ,DR,DRUG,I,II,N,PHYS,PS,QTY,RFDATE,RFL,RFL1,RXF,SIG,ST,ST0,Z,Z0,Z1,X,Y,ZDL
"RTN","PSORXED1",38,0)
 Q
"RTN","PSORXED1",39,0)
SUP I $P($G(^PS(52.5,RXS,0)),"^",7)="Q" D SUS^PSOCMOPB Q
"RTN","PSORXED1",40,0)
 S RXN=DA,RX0=^PSRX(DA,0),DA=RXS,DIK="^PS(52.5," D ^DIK S DA=RXN
"RTN","PSORXED1",41,0)
 S DIC="^PS(52.5,",DIC(0)="L",X=RXN,DLAYGO=52.5
"RTN","PSORXED1",42,0)
 S DIC("DR")=".02///"_SD_";.03////"_$P(^PSRX(DA,0),"^",2)_";.04///M;.05///0;.06////"_PSOSITE_";2///0" K DD,DO D FILE^DICN I +$G(Y),$G(RFED)'="" S $P(^PS(52.5,+Y,0),"^",13)=$G(RFED)
"RTN","PSORXED1",43,0)
 S IR=0,DA=RXN F FDA=0:0 S FDA=$O(^PSRX(DA,"A",FDA)) Q:'FDA  S IR=FDA
"RTN","PSORXED1",44,0)
 S IR=IR+1,^PSRX(DA,"A",0)="^52.3DA^"_IR_"^"_IR
"RTN","PSORXED1",45,0)
 D NOW^%DTC S ^PSRX(DA,"A",IR,0)=%_"^E^"_DUZ_"^"_$S(RFED'<0&(RFED<6):RFED,1:(RFED+1))_"^RX Placed on Suspense until "_$E(SD,4,5)_"-"_$E(SD,6,7)_"-"_$E(SD,2,3)
"RTN","PSORXED1",46,0)
 W !,"RX# "_$P(RX0,"^")_" has been Suspended until "_$E(SD,4,5)_"-"_$E(SD,6,7)_"-"_$E(SD,2,3)_".",!
"RTN","PSORXED1",47,0)
 Q
"RTN","PSORXED1",48,0)
 ;
"RTN","PSORXED1",49,0)
DIE W !,"Now Editing Rx # ",$P(PSORXED("RX0"),"^") K DIE,DA,DIC,DR S DIE="^PSRX(",DA=PSORXED("IRXN")
"RTN","PSORXED1",50,0)
 S DR="1;22R;3;Q;4;5"_$S($P(PSOPAR,"^",3):";6",1:"")_";6.5:8;Q;17;9:10;10.6;11;"_$S($P(PSOPAR,"^",12):"35;",1:"")_"12;20" S:RFD DR=DR_";52" S DR=DR_";23;24",DR(2,52.1)=".01:5;8;15"
"RTN","PSORXED1",51,0)
 D ^DIE K DIE,DR,DA,X,Y L -^PSRX(PSORXED("IRXN")) I RFD,$G(^PSRX(PSORXED("IRXN"),1,RFD,0))]"" D
"RTN","PSORXED1",52,0)
 .S:$P(PSORXED("RX1"),"^",17)'=$P(^PSRX(PSORXED("IRXN"),1,RFD,0),"^",17) PSONEW("PROVIDER NAME")=$P(^VA(200,$P(^PSRX(PSORXED("IRXN"),1,RFD,0),"^",17),0),"^")
"RTN","PSORXED1",53,0)
 D EN1^PSONEW2(.PSORXED) I PSORXED("DFLG") S PSORXED("QFLG")=1 G DIEX
"RTN","PSORXED1",54,0)
 G:'PSORXED("QFLG") DIE S PSORXED("QFLG")=0
"RTN","PSORXED1",55,0)
DIEX Q
"RTN","PSORXL1")
0^37^B50241379
"RTN","PSORXL1",1,0)
PSORXL1 ;BIR/SAB-action to be taken on prescriptions ; 10/5/07 2:40pm
"RTN","PSORXL1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**36,46,148,260,274,287,289**;DEC 1997;Build 107
"RTN","PSORXL1",3,0)
S S SPPL="",PPL1=1 S:'$G(PPL) PPL=$G(PSORX("PSOL",PPL1)) G:$G(PPL)']"" D1
"RTN","PSORXL1",4,0)
S1 F PI=1:1 Q:$P(PPL,",",PI)=""  S DA=$P(PPL,",",PI) D
"RTN","PSORXL1",5,0)
 .I $P(^PSRX(DA,"STA"),"^")<10,$P(^("STA"),"^")'=4 D SUS Q
"RTN","PSORXL1",6,0)
 .I $P(^PSRX(DA,"STA"),"^")=4 S SPPL=SPPL_DA_"," Q
"RTN","PSORXL1",7,0)
 I $G(SPPL)]"" D  K DIR S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR K DIR,DUOUT,DTOUT,DIRUT
"RTN","PSORXL1",8,0)
 .W !!,$C(7),"Drug Interaction Rx(s) " F I=1:1 Q:$P(SPPL,",",I)=""  W $P(^PSRX($P(SPPL,",",I),0),"^")_", "
"RTN","PSORXL1",9,0)
 .I $G(PSOLAP)=""!($G(PSOLAP)=$G(ION)) W !,"Label device must be selected for Drug Interaction label!"
"RTN","PSORXL1",10,0)
 .S PPL=SPPL,DG=1 N PPL1 D Q^PSORXL K DG,SPPL
"RTN","PSORXL1",11,0)
 S SUSPT="SUSPENSE" G D1
"RTN","PSORXL1",12,0)
 Q
"RTN","PSORXL1",13,0)
SUS S ACT=1,RXN=DA,RX0=^PSRX(DA,0),SD=$S($G(ZD(DA)):$E(ZD(DA),1,7),1:$P(^(3),"^")),RXS=$O(^PS(52.5,"B",DA,0)) I RXS S RXCMOP=$P($G(^PS(52.5,RXS,0)),"^",7) D  Q:$G(DFLG)!($G(PSOWFLG))
"RTN","PSORXL1",14,0)
 .;checks to see if future fill exists
"RTN","PSORXL1",15,0)
 .S PSOWFLG=0 I '$G(RXPR(DA)),$P($G(^PS(52.5,RXS,"P")),"^")=0,$P($G(^PSRX(DA,"STA")),"^")=5 D SWARN Q:$G(PSOWFLG)
"RTN","PSORXL1",16,0)
 .K PSOWFLG I $G(RXPR(DA)),'$P($G(^PS(52.5,RXS,"P")),"^") D WARN Q:$G(DFLG)
"RTN","PSORXL1",17,0)
 .S DA=RXS,DIK="^PS(52.5," D ^DIK S DA=RXN I $P($G(^PSRX(RXN,"STA")),"^")=5 S $P(^("STA"),"^")=0
"RTN","PSORXL1",18,0)
 G:$G(RXRP(DA))!($G(RXPR(DA))) LOCK
"RTN","PSORXL1",19,0)
 I $G(PSXSYS) D SUS1^PSOCMOP I $G(XFLAG)=1 K XFLAG Q
"RTN","PSORXL1",20,0)
LOCK I $P($G(^PSRX(RXN,"STA")),"^")=3 G SUSQ
"RTN","PSORXL1",21,0)
 S RXP=+$G(RXPR(DA)),DIC="^PS(52.5,",DIC(0)="L",X=RXN,DIC("DR")=".02///"_SD_";.03////"_$P(^PSRX(DA,0),"^",2)_";.04///M;.05///"_RXP_";.06////"_PSOSITE_";2///0" K DD,DO D FILE^DICN D  I +Y,'$G(RXP),$G(RXRP(RXN)) S $P(^PS(52.5,+Y,0),"^",12)=1
"RTN","PSORXL1",22,0)
 .K DD,DO I +Y,$G(PSOEXREP) S $P(^PS(52.5,+Y,0),"^",12)=1
"RTN","PSORXL1",23,0)
 .I +Y S $P(^PS(52.5,+Y,0),"^",13)=$G(RXFL(RXN))
"RTN","PSORXL1",24,0)
 S $P(^PSRX(RXN,"STA"),"^")=5,LFD=$E(SD,4,5)_"-"_$E(SD,6,7)_"-"_$E(SD,2,3) D ACT
"RTN","PSORXL1",25,0)
 W !!,$S(RXP:"Partial ",1:"")_"RX# ",$P(^PSRX(RXN,0),"^")_" has been suspended until "_LFD_"."
"RTN","PSORXL1",26,0)
 S VALMSG=$S(RXP:"Partial ",1:"")_"Rx# "_$P(^PSRX(RXN,0),"^")_" Has Been Suspended Until "_LFD_"."_$S($G(RXRP(RXN))&('$G(RXP)):" (Reprint)",1:"")
"RTN","PSORXL1",27,0)
 S COMM=$S(RXP:"Partial ",1:"")_"Rx# "_$P(^PSRX(RXN,0),"^")_" Has Been Suspended Until "_LFD_"."_$S($G(RXRP(RXN))&('$G(RXP)):" (Reprint)",1:"")
"RTN","PSORXL1",28,0)
 D:'$D(^TMP("PSORXN",$J,RXN)) EN^PSOHLSN1(RXN,"SC","ZS",COMM)
"RTN","PSORXL1",29,0)
 S:$D(^TMP("PSORXN",$J,RXN)) $P(^TMP("PSORXN",$J,RXN),"^",4)=COMM
"RTN","PSORXL1",30,0)
 ;
"RTN","PSORXL1",31,0)
 ; - If not a PARTIAL, reverse ECME Claim, if necessary
"RTN","PSORXL1",32,0)
 I '$G(RXFL(RXN)) S RXFL(RXN)=$$LSTRFL^PSOBPSU1(RXN)
"RTN","PSORXL1",33,0)
 I '$G(RXP),'$G(PSONPROG) D REVERSE^PSOBPSU1(RXN,,"DC",3)  ;PSONPROG - Tricare in progress, don't reverse
"RTN","PSORXL1",34,0)
 K COMM
"RTN","PSORXL1",35,0)
SUSQ Q
"RTN","PSORXL1",36,0)
 ;PSO*7*274 always recalculate RXF
"RTN","PSORXL1",37,0)
ACT S RXF=0 F I=0:0 S I=$O(^PSRX(DA,1,I)) Q:'I  S RXF=I S:I>5 RXF=I+1
"RTN","PSORXL1",38,0)
 S IR=0 F FDA=0:0 S FDA=$O(^PSRX(DA,"A",FDA)) Q:'FDA  S IR=FDA
"RTN","PSORXL1",39,0)
 S IR=IR+1,^PSRX(DA,"A",0)="^52.3DA^"_IR_"^"_IR
"RTN","PSORXL1",40,0)
 D NOW^%DTC S ^PSRX(DA,"A",IR,0)=%_"^S^"_DUZ_"^"_RXF_"^"_$S(RXP:"Partial ",1:"")_"RX "_$S($G(RXRP(DA))&('$G(RXP)):"Reprint ",1:"")_"Placed on Suspense until "_LFD K RXF,I,FDA,DIC,DIE,DR,Y,X,%,%H,%I
"RTN","PSORXL1",41,0)
 Q
"RTN","PSORXL1",42,0)
D1 I $O(PSORX("PSOL",$G(PPL1))) S PPL1=$O(PSORX("PSOL",$G(PPL1))),PPL=PSORX("PSOL",PPL1) G S1
"RTN","PSORXL1",43,0)
 G:$D(RXRS) RXS^PSORXL
"RTN","PSORXL1",44,0)
 K LBL,PPL1,PPL,DIR,%DT,%,SD,COUNT,EXDT,L,PDUZ,REF,REPRINT,RFDATE,RFL1,RFLL,RXN,WARN,ZY,FLD,PI,ZD,ACT,X,Y,DIRUT,DUOUT,DTOUT,DIROUT,DFLG,RXPD,PSOWFLG
"RTN","PSORXL1",45,0)
 Q
"RTN","PSORXL1",46,0)
WARN W ! K DIR,DIRUT,DUOUT,DTOUT,DFLG S Y=$P(^PS(52.5,RXS,0),"^",2) X ^DD("DD") S RXPD=Y,DIR(0)="SA^S:SUSPEND;Q:QUEUE;E:EXIT"
"RTN","PSORXL1",47,0)
 S DIR("A",1)="Rx #"_$P(^PSRX(DA,0),"^")_" is suspended "_$S($G(RXCMOP)]"":"for CMOP ",1:"")_"until "_RXPD
"RTN","PSORXL1",48,0)
 I $G(RXCMOP)]"" D  G WARN1
"RTN","PSORXL1",49,0)
 .W !!,"A partial entered for this Rx cannot be suspended."
"RTN","PSORXL1",50,0)
 .W !,"You may pull this fill from suspense or print the label now.",!!
"RTN","PSORXL1",51,0)
 .S DIR("A",2)=" ",DIR("A",3)="   Do you want to Queue to print",DIR("A")="                or Exit: "
"RTN","PSORXL1",52,0)
 S DIR("A",2)=" ",DIR("A",3)="   Do you want to: Suspend Partial",DIR("A",4)="                   Queue to print",DIR("A")="                or Exit:  "
"RTN","PSORXL1",53,0)
WARN1 S DIR("B")="EXIT",DIR("?")="^D HLP^PSORXL1" D ^DIR K DIR
"RTN","PSORXL1",54,0)
 I Y="E"!($D(DIRUT))!(Y="S"&($G(RXCMOP)]"")) S DA(1)=DA,DA=RXPR(DA),DIK="^PSRX("_DA(1)_",""P""," D ^DIK S ^PSRX(DA(1),"TYPE")=0,DFLG=1 W $C(7)," Partial Removed!" Q
"RTN","PSORXL1",55,0)
 I Y="Q" S DPPL=PPL,HOLDPPL1=$G(PPL1),DPI=PI,RXLTOP=1 S PPL=$G(RXN)_"," S PSPARTXX=1 D Q^PSORXL K PSPARTXX S DFLG=1,PPL=DPPL,PI=DPI,PPL1=$G(HOLDPPL1) K HOLDPPL1,DPPL,DPPI,DPI,RXLTOP Q
"RTN","PSORXL1",56,0)
 Q
"RTN","PSORXL1",57,0)
HLP I $G(RXCMOP)']"" W !!,"If you choose to suspend this partial Rx, the current suspended fill will",!,"be replaced by the partial.  You may want to pull this fill early instead.",!
"RTN","PSORXL1",58,0)
 I $G(RXCMOP)]"" W !!,"You cannot suspend a partial when a CMOP fill is in suspense, because the partial will replace the CMOP fill in suspense."
"RTN","PSORXL1",59,0)
 W !,"If you choose to queue this partial, the label will printout on the previous",!,"selected label printer.",!
"RTN","PSORXL1",60,0)
 W !,"You may exit without printing or suspending this partial.  This will also delete",!,"the partial Rx entered."
"RTN","PSORXL1",61,0)
 Q
"RTN","PSORXL1",62,0)
SWARN ;
"RTN","PSORXL1",63,0)
 S PSORXLDA=$G(DA),PSORXZD=$P($G(^PS(52.5,RXS,0)),"^",2)
"RTN","PSORXL1",64,0)
 W $C(7),!!,"Rx "_$P($G(^PSRX(DA,0)),"^")_" is already suspended "_$S($G(RXCMOP)]"":"for CMOP ",1:"")_"until "_$E(PSORXZD,4,5)_"-"_$E(PSORXZD,6,7)_"-"_$E(PSORXZD,2,3)_"." K PSORXZD
"RTN","PSORXL1",65,0)
 W !,"By suspending this fill, the fill that is already suspended will be overwritten",!,"and a label will not print for that fill!",!
"RTN","PSORXL1",66,0)
 N PSORF,PSOTRIC D TRIC(DA)
"RTN","PSORXL1",67,0)
 I PSOTRIC,$$STATUS^PSOBPSUT(DA,PSORF)'["PAYABLE" S PSOQFLAG=1 Q
"RTN","PSORXL1",68,0)
 K DIR S DIR(0)="SA^Q:QUEUE;S:SUSPEND",DIR("B")="Q",DIR("A")="Do you want to Queue to print or Suspend Rx "_$P($G(^PSRX(DA,0)),"^")_": " D ^DIR K DIR
"RTN","PSORXL1",69,0)
 I $G(Y)="S" K RXFL(PSORXLDA) G SWARNQ
"RTN","PSORXL1",70,0)
 I $G(Y)="Q" D  G SWARNQ
"RTN","PSORXL1",71,0)
 . S PSOKSPPL=$G(PPL),PSOZXPPL=$G(PPL1),PSOZXPI=$G(PI),RXLTOP=1
"RTN","PSORXL1",72,0)
 . S PPL=$G(RXN)_"," D SWARS D Q^PSORXL S PSOWFLG=1,PPL=PSOKSPPL
"RTN","PSORXL1",73,0)
 . S PI=PSOZXPI,PPL1=PSOZXPPL K PSOKSPPL,PSOZXPPL,PSOZXPI,RXLTOP,RXFL(+$G(PSORXLDA))
"RTN","PSORXL1",74,0)
 W !!,"Nothing queued to print for Rx "_$P($G(^PSRX(PSORXLDA,0)),"^"),! S PSOWFLG=1
"RTN","PSORXL1",75,0)
SWARNQ ;
"RTN","PSORXL1",76,0)
 S DA=$G(PSORXLDA) K PSORXLDA
"RTN","PSORXL1",77,0)
 Q
"RTN","PSORXL1",78,0)
SWARS ;
"RTN","PSORXL1",79,0)
 S PSOZXFL(PSORXLDA)=+$P($G(^PS(52.5,+$G(RXS),0)),"^",13) I '$G(PSOZXFL(PSORXLDA)) K PSOZXFL Q
"RTN","PSORXL1",80,0)
 S PSOZXFPL=$P(PSOKSPPL,",",+$G(PI),99)
"RTN","PSORXL1",81,0)
 S PSOZXFPN=$L(PSOZXFPL,PPL)-1
"RTN","PSORXL1",82,0)
 I $G(PSOZXFL(PSORXLDA)),$G(PSOZXFPN) S RXFL(PSORXLDA)=$G(PSOZXFL(PSORXLDA))-$G(PSOZXFPN)
"RTN","PSORXL1",83,0)
 K PSOZXFL,PSOZXFPL,PSOZXFPN
"RTN","PSORXL1",84,0)
 Q
"RTN","PSORXL1",85,0)
TRIC(PSORX) ;
"RTN","PSORXL1",86,0)
 S PSORF=$$LSTRFL^PSOBPSU1(PSORX)
"RTN","PSORXL1",87,0)
 S PSOTRIC="",PSOTRIC=$$TRIC^PSOREJP1(PSORX,PSORF,.PSOTRIC)
"RTN","PSORXL1",88,0)
 Q
"RTN","PSORXL1",89,0)
ECME ; - Looks for DUR/79 REJECTS and send Mail Rx's to ECME that have not been SUSPENDED
"RTN","PSORXL1",90,0)
 N PSOI,PSOJ,PSORX,PSORF,PSOACT,BWH,PPLTMP,PSOSTA,PSOTRIC,ESTAT,EACTION
"RTN","PSORXL1",91,0)
 S PPLTMP=$G(PPL)
"RTN","PSORXL1",92,0)
 F PSOI=1:1 S PSORX=+$P($G(PPLTMP),",",PSOI) Q:'PSORX  D
"RTN","PSORXL1",93,0)
 . D TRIC(PSORX) S ESTAT=$P($$STATUS^PSOBPSUT(PSORX,PSORF),"^")
"RTN","PSORXL1",94,0)
 . I PSOTRIC S EACTION=$S(ESTAT["PAYABLE":1,ESTAT["Inactive ECME Tricare":1,ESTAT="":1,1:0)
"RTN","PSORXL1",95,0)
 . I PSOTRIC,'EACTION,$G(PPL) D RMV(PSORX,.PPL) Q  ;no labels for "In Progress" Tricare Rx's.
"RTN","PSORXL1",96,0)
 . I $G(PSOCKDC) D  Q  ;PSOCKDC variable is set in PSORXL and is used to eliminate label print for DC'ed Rx's
"RTN","PSORXL1",97,0)
 . . S PSOSTA=$$GET1^DIQ(52,PSORX,100,"I") I PSOSTA=12!(PSOSTA=11),'$G(RXPR(PSORX)),$G(PPL) D RMV(PSORX,.PPL)
"RTN","PSORXL1",98,0)
 . I $G(RXPR(PSORX)) Q
"RTN","PSORXL1",99,0)
 . S PSOACT="",BWH=$S(PSORF:"RF",1:"OF")
"RTN","PSORXL1",100,0)
 . I $$FIND^PSOREJUT(PSORX,PSORF) D  I PSOACT="Q" D RMV(PSORX,.PPL) Q
"RTN","PSORXL1",101,0)
 . . S PSOACT=$$HDLG^PSOREJU1(PSORX,PSORF,"79,88",BWH,"OIQ","Q")
"RTN","PSORXL1",102,0)
 Q
"RTN","PSORXL1",103,0)
RMV(RX,PPL) ; Remove the Rx from the label print queue
"RTN","PSORXL1",104,0)
 N XPPL,I
"RTN","PSORXL1",105,0)
 S XPPL=PPL,PPL="" F I=1:1:$L(XPPL,",") I $P(XPPL,",",I)'="",$P(XPPL,",",I)'=RX S PPL=PPL_$P(XPPL,",",I)_","
"RTN","PSORXL1",106,0)
 I PPL="" K PPL
"RTN","PSORXL1",107,0)
 Q
"RTN","PSOSULB1")
0^7^B43045275
"RTN","PSOSULB1",1,0)
PSOSULB1 ;BHAM ISC/RTR,SAB-Print suspended labels  cont. ;10/10/96
"RTN","PSOSULB1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**10,200,264,289**;DEC 1997;Build 107
"RTN","PSOSULB1",3,0)
 ;Reference to $$INSUR^IBBAPI supported by IA 4419
"RTN","PSOSULB1",4,0)
 ;Reference to $$DEA^IBNCPDP controlled subscription by IA 4299
"RTN","PSOSULB1",5,0)
 ;
"RTN","PSOSULB1",6,0)
DEV D:'$D(PSOPAR) ^PSOLSET G:'$D(PSOPAR) DEV S PSOION=ION
"RTN","PSOSULB1",7,0)
 N X S X="PSXRSUS" X ^%ZOSF("TEST") G:($T)&($G(PSXSYS))&($D(^XUSEC("PSXCMOPMGR",DUZ)))&($D(^XUSEC("PSX XMIT",DUZ))) ^PSXRSUS
"RTN","PSOSULB1",8,0)
DEV1 I '$P(PSOPAR,"^",8) G START
"RTN","PSOSULB1",9,0)
 N PSOPROP,PFIO W $C(7),!!,"PROFILES MUST BE SENT TO PRINTER !!",! K IOP,%ZIS,IO("Q"),POP S %ZIS="MNQ",%ZIS("A")="Select PROFILE Device: " D ^%ZIS K %ZIS("A") G:POP EXIT^PSOSULBL G:$E(IOST)["C"!(PSOION=ION) DEV S PSOPROP=ION D ^%ZISC
"RTN","PSOSULB1",10,0)
START I $G(PSOCUTDT)']"" S X1=DT,X2=-120 D C^%DTC S PSODTCUT=X,PSOPRPAS=$P(PSOPAR,"^",7)
"RTN","PSOSULB1",11,0)
ASK K ^TMP($J),PSOSU,PSOSUSPR S PFIOQ=0,PDUZ=DUZ W !
"RTN","PSOSULB1",12,0)
 S %DT="AEX",%DT("A")="Print labels through date: ",%DT("B")="TODAY" D ^%DT K %DT D:Y<0 MESS G:Y<0 EXIT^PSOSULBL S PRTDT=Y
"RTN","PSOSULB1",13,0)
 I '$O(^PS(52.5,"C",0))!($O(^(0))>PRTDT) W $C(7),!!,"NOTHING THRU DATE TO PRINT" G ASK
"RTN","PSOSULB1",14,0)
 W ! K DIR S DIR("A")="Sort by Patient Name, ID#, or DEA Special Handling",DIR(0)="SB^P:PATIENT NAME;I:IDENTIFICATION NUMBER;D:DEA SPECIAL HANDLING"
"RTN","PSOSULB1",15,0)
 S DIR("?")="Enter 'P' to sort the labels alphabetically by name, enter 'I' to sort by identification number, enter 'D' to sort by DEA Special Handling."
"RTN","PSOSULB1",16,0)
 S DIR("?",1)="Sorting by DEA Special Handling will print the labels in three groups. The",DIR("?",2)="first will contain labels with drugs marked with an A or C in the DEA Special"
"RTN","PSOSULB1",17,0)
 S DIR("?",3)="Handling field, indicating NARCOTICS AND ALCOHOLICS, and CONTROLLED SUBSTANCES-",DIR("?",4)="NON NARCOTIC. The second group will contain ones marked with an S, indicating"
"RTN","PSOSULB1",18,0)
 S DIR("?",5)="SUPPLY, and all others will print in the third group.",DIR("?",6)=""
"RTN","PSOSULB1",19,0)
 D ^DIR K DIR D:$D(DIRUT) MESS G:$D(DIRUT) EXIT^PSOSULBL S PSRT=$S(Y="D":"D",Y="P":1,1:0)
"RTN","PSOSULB1",20,0)
 I Y="D" W ! K DIR S DIR(0)="SB^P:PATIENT NAME;I:IDENTIFICATION NUMBER",DIR("A")="Within DEA Special Handling, sort by Patient Name or ID#" D ^DIR K DIR D:$D(DIRUT) MESS G:$D(DIRUT) EXIT^PSOSULBL S PSRTONE=Y
"RTN","PSOSULB1",21,0)
 S X1=PRTDT,X2=$P(PSOPAR,"^",27) D C^%DTC S XDATE=X K IOP,POP,IO("Q"),ZTSK
"RTN","PSOSULB1",22,0)
PRLBL W ! S %ZIS("A")="Printer 'LABEL' Device: ",%ZIS("B")="",%ZIS="MQN" D ^%ZIS S PSLION=ION I POP S IOP=PSOION D ^%ZIS D MESS G EXIT^PSOSULBL
"RTN","PSOSULB1",23,0)
 I $E(IOST)'["P" D MESSL G PRLBL
"RTN","PSOSULB1",24,0)
 N PSOIOS S PSOIOS=IOS D DEVBAR^PSOBMST
"RTN","PSOSULB1",25,0)
 S PSOBARS=PSOBAR1]""&(PSOBAR0]"")&$P(PSOPAR,"^",19)
"RTN","PSOSULB1",26,0)
 K PSOION D ^%ZISC I $D(IO("Q")) K IO("Q")
"RTN","PSOSULB1",27,0)
QUE K %DT,PSOTIME,PSOOUT D NOW^%DTC S %DT="REAX",%DT(0)=%,%DT("B")="NOW",%DT("A")="Queue to run at what time: " D ^%DT K %DT I $D(DTOUT)!(Y<0) D MESS G EXIT^PSOSULBL
"RTN","PSOSULB1",28,0)
 S (PSOSUSPR,PSODBQ)=1,PSOTIME=Y
"RTN","PSOSULB1",29,0)
 S ZTRTN="BEG^PSOSULBL",ZTDESC="PRINT LABELS FROM SUSPENSE",ZTIO=PSLION,ZTDTH=PSOTIME
"RTN","PSOSULB1",30,0)
 F G="PSOPAR","PSOSYS","PSOSUSPR","PSODBQ","PSRT","PSRTONE","PSOPROP","PSLION","PFIO","PSOBARS","PSODTCUT","PSOPRPAS","PRTDT","PDUZ","PSOBAR0","PSOBAR1","PSOSITE","XDATE","PSOTIME" S:$D(@G) ZTSAVE(G)=""
"RTN","PSOSULB1",31,0)
 D ^%ZTLOAD W !!,"PRINT FROM SUSPENSE JOB QUEUED!",! D ^%ZISC G EXIT^PSOSULBL
"RTN","PSOSULB1",32,0)
 ;G:PSRT'="D" BEG^PSOSULBL
"RTN","PSOSULB1",33,0)
MESS W $C(7),!!?3,"NOTHING QUEUED TO PRINT!",! Q
"RTN","PSOSULB1",34,0)
MESSL W $C(7),!?3,"LABELS MUST BE SENT TO A PRINTER!",! Q
"RTN","PSOSULB1",35,0)
BAIMAIL     ;Send mail message
"RTN","PSOSULB1",36,0)
 S:'$G(PDUZ) PDUZ=+$G(DUZ)
"RTN","PSOSULB1",37,0)
 K ^TMP("PSOM",$J)
"RTN","PSOSULB1",38,0)
 N SEQ,XMY,XMDUZ,XMSUB,XMTEXT,SEQ,NAME,PSSN,RX,FILL,FIRST
"RTN","PSOSULB1",39,0)
 S SEQ=1
"RTN","PSOSULB1",40,0)
 S XMY(PDUZ)=""
"RTN","PSOSULB1",41,0)
 S XMY("G.PSO EXTERNAL DISPENSE ALERTS")=""
"RTN","PSOSULB1",42,0)
 S XMDUZ="OUTPATIENT PHARMACY PACKAGE"
"RTN","PSOSULB1",43,0)
 S XMSUB="BAD ADDRESS SUSPENSE NOT PRINTED"
"RTN","PSOSULB1",44,0)
 I $G(PSOSITE) S XMSUB=$$GET1^DIQ(59,PSOSITE,.06)_" "_XMSUB
"RTN","PSOSULB1",45,0)
 S ^TMP("PSOM",$J,SEQ)="The following prescriptions with a routing of mail were not printed/sent to",SEQ=SEQ+1
"RTN","PSOSULB1",46,0)
 S ^TMP("PSOM",$J,SEQ)="external interface due to the BAD ADDRESS INDICATOR being set and no active",SEQ=SEQ+1
"RTN","PSOSULB1",47,0)
 S ^TMP("PSOM",$J,SEQ)="temporary address, or the patient has an active MAIL status of DO NOT MAIL, or",SEQ=SEQ+1
"RTN","PSOSULB1",48,0)
 S ^TMP("PSOM",$J,SEQ)="the patient has a foreign address:",SEQ=SEQ+1
"RTN","PSOSULB1",49,0)
 S NAME="" F  S NAME=$O(^TMP("PSOSM",$J,NAME)) Q:NAME=""  D
"RTN","PSOSULB1",50,0)
 .S PSSN="" F  S PSSN=$O(^TMP("PSOSM",$J,NAME,PSSN)) Q:PSSN=""  D
"RTN","PSOSULB1",51,0)
 ..S ^TMP("PSOM",$J,SEQ)="",SEQ=SEQ+1
"RTN","PSOSULB1",52,0)
 ..S ^TMP("PSOM",$J,SEQ)=NAME_"   "_PSSN,FIRST=1
"RTN","PSOSULB1",53,0)
 ..S RX=0 F  S RX=$O(^TMP("PSOSM",$J,NAME,PSSN,RX)) Q:'RX  S FILL="" F  S FILL=$O(^TMP("PSOSM",$J,NAME,PSSN,RX,FILL)) Q:FILL=""  D
"RTN","PSOSULB1",54,0)
 ...I FIRST D  S FIRST=0
"RTN","PSOSULB1",55,0)
 ....S ^TMP("PSOM",$J,SEQ)=^TMP("PSOM",$J,SEQ)_"   ("_$G(^TMP("PSOSM",$J,NAME,PSSN,RX,FILL))_")"
"RTN","PSOSULB1",56,0)
 ....S SEQ=SEQ+1
"RTN","PSOSULB1",57,0)
 ...S ^TMP("PSOM",$J,SEQ)="  "_$P(^PSRX(RX,0),"^")_" ("_FILL_")  "_$P($G(^PSDRUG($P(^PSRX(RX,0),"^",6),0)),"^"),SEQ=SEQ+1
"RTN","PSOSULB1",58,0)
 S ^TMP("PSOM",$J,SEQ+1)=""
"RTN","PSOSULB1",59,0)
 S XMTEXT="^TMP(""PSOM"",$J," N DIFROM D ^XMD K XMSUB,XMTEXT,XMY,XMDUZ
"RTN","PSOSULB1",60,0)
 Q
"RTN","PSOSULB1",61,0)
 ;Description: 
"RTN","PSOSULB1",62,0)
 ;This function determines whether the RX SUSPENSE has a DAYS SUPPLY HOLD
"RTN","PSOSULB1",63,0)
 ;condition.
"RTN","PSOSULB1",64,0)
 ;Input: REC = Pointer to Suspense file (#52.5)
"RTN","PSOSULB1",65,0)
 ;Returns: 1 or 0
"RTN","PSOSULB1",66,0)
 ;1 (one) if  of days supply has elapsed.
"RTN","PSOSULB1",67,0)
 ;0 (zero) is returned if  of days supply has not elapsed. 
"RTN","PSOSULB1",68,0)
 ;
"RTN","PSOSULB1",69,0)
DSH(REC) ; ePharmacy - verify that 3/4 days supply has elapsed before printing from suspense
"RTN","PSOSULB1",70,0)
 N PSINSUR,PSARR,SHDT,DSHOLD,DSHDT,PS0,COMM,DIE,DA,DR,RXIEN,RFL,DAYSSUP,LSTFIL,PTDFN,IBINS,DRG
"RTN","PSOSULB1",71,0)
 N DEA,DEAOK,ICD,SFN,SDT
"RTN","PSOSULB1",72,0)
 S DSHOLD=1,PS0=^PS(52.5,REC,0),RXIEN=$P(PS0,U,1),RFL=$P(PS0,U,13)
"RTN","PSOSULB1",73,0)
 S LSTFIL=$$LSTRFL^PSOBPSU1(RXIEN),PTDFN=$$GET1^DIQ(52,RXIEN,"2","I")
"RTN","PSOSULB1",74,0)
 S IBSTAT=$$INSUR^IBBAPI(PTDFN,,"E",.IBINS,"1"),DRG=$$GET1^DIQ(52,RXIEN,"6","I")
"RTN","PSOSULB1",75,0)
 S (DEA,ICD)="",DEA=$$GET1^DIQ(50,DRG,3)
"RTN","PSOSULB1",76,0)
 I $D(^PSRX(RXIEN,"ICD",1,0)) S ICD=^PSRX(RXIEN,"ICD",1,0)
"RTN","PSOSULB1",77,0)
 ;
"RTN","PSOSULB1",78,0)
 ; Don't hold Rx where the previous fill was not ebillable
"RTN","PSOSULB1",79,0)
 I $$STATUS^BPSOSRX(RXIEN,LSTFIL-1)="" Q DSHOLD
"RTN","PSOSULB1",80,0)
 ; Don't hold when the Rx has SC/EI flagged
"RTN","PSOSULB1",81,0)
 I ICD[1 Q DSHOLD
"RTN","PSOSULB1",82,0)
 ; Don't hold rx if DEA special Handling code is non billable (i.e. has M or 0 (zero) or (I, S, N, and/or 9)) without an E
"RTN","PSOSULB1",83,0)
 S DEAOK=$$DEA^IBNCPDP(DEA) I 'DEAOK Q DSHOLD
"RTN","PSOSULB1",84,0)
 ; Don't hold for zero fill renewals
"RTN","PSOSULB1",85,0)
 I 'LSTFIL,$$GET1^DIQ(52,RXIEN_",","PRIOR FILL DATE",,,)="" Q DSHOLD
"RTN","PSOSULB1",86,0)
 ; Don't hold if no insurance
"RTN","PSOSULB1",87,0)
 I 'IBSTAT!(IBSTAT=-1) Q DSHOLD
"RTN","PSOSULB1",88,0)
 ;
"RTN","PSOSULB1",89,0)
 S DSHDT=$$DSHDT(RXIEN) ; 3/4 of days supply date
"RTN","PSOSULB1",90,0)
 I DSHDT>DT S DSHOLD=0 D
"RTN","PSOSULB1",91,0)
 . I DSHDT'=$P(PS0,U,14) D  ; Update Suspense Hold Date and Activity Log
"RTN","PSOSULB1",92,0)
 . . S COMM="3/4 of Days Supply SUSPENSE HOLD until "_$$FMTE^XLFDT(DSHDT,"2D")_"."
"RTN","PSOSULB1",93,0)
 . . S DAYSSUP=$$LFDS(RXIEN)
"RTN","PSOSULB1",94,0)
 . . D RXACT^PSOBPSU2(RXIEN,RFL,COMM,"S",+$G(DUZ)) ; Update Activity Log
"RTN","PSOSULB1",95,0)
 . . S DR="10///^S X=DSHDT",DIE="^PS(52.5,",DA=REC D ^DIE ; File Suspense Hold Date
"RTN","PSOSULB1",96,0)
 . . N DA,DIE,DR,PSOX,SFN,INDT,DEAD,SUB,XOK,OLD,X,II
"RTN","PSOSULB1",97,0)
 . . S DA=REC,DIE="^PS(52.5,",DR=".02///"_DSHDT D ^DIE
"RTN","PSOSULB1",98,0)
 . . S SFN=REC,DEAD=0,INDT=DSHDT D CHANGE^PSOSUCH1(RXIEN,RFL)
"RTN","PSOSULB1",99,0)
 Q DSHOLD
"RTN","PSOSULB1",100,0)
 ;
"RTN","PSOSULB1",101,0)
 ;Description:
"RTN","PSOSULB1",102,0)
 ;This function determines the date that 3/4 of the days supply for the
"RTN","PSOSULB1",103,0)
 ;last refill will occur.
"RTN","PSOSULB1",104,0)
 ;Input: RXIEN = Prescription file #52 IEN
"RTN","PSOSULB1",105,0)
 ;Returns: DATE/TIME value
"RTN","PSOSULB1",106,0)
DSHDT(RXIEN) ;
"RTN","PSOSULB1",107,0)
 N RXFIL,FILLDT,DAYSSUP,DSH34
"RTN","PSOSULB1",108,0)
 I '$D(^PSRX(RXIEN,0)) Q -1
"RTN","PSOSULB1",109,0)
 ;S RXFIL=$$LSTRFL^PSOBPSU1(RXIEN) ; Last Refill
"RTN","PSOSULB1",110,0)
 S FILLDT=$$LDPFDT(RXIEN) ; Last Dispensed Date or Prior Fill Date for renewal
"RTN","PSOSULB1",111,0)
 S DAYSSUP=$$LFDS(RXIEN) ; Days Supply of Last Refill
"RTN","PSOSULB1",112,0)
 S DSH34=DAYSSUP*.75 ; 3/4 of Days Supply
"RTN","PSOSULB1",113,0)
 Q $$FMADD^XLFDT(FILLDT,DSH34) ; Return today plus 3/4 of Days Supply date
"RTN","PSOSULB1",114,0)
 ;
"RTN","PSOSULB1",115,0)
 ; Description: This function returns the DAYS SUPPLY for the Latest Fill
"RTN","PSOSULB1",116,0)
 ; for a Prescription
"RTN","PSOSULB1",117,0)
 ; Input: RXIEN = Prescription file #52 IEN
"RTN","PSOSULB1",118,0)
 ; Returns: DAYS SUPPLY for the latest fill
"RTN","PSOSULB1",119,0)
 ;          -1 if RXIEN is not valid
"RTN","PSOSULB1",120,0)
LFDS(RXIEN) ;
"RTN","PSOSULB1",121,0)
 N RXFIL
"RTN","PSOSULB1",122,0)
 Q:'$D(^PSRX(RXIEN)) -1
"RTN","PSOSULB1",123,0)
 S RXFIL=$$LSTRFL^PSOBPSU1(RXIEN)
"RTN","PSOSULB1",124,0)
 Q $S(RXFIL=0:$P(^PSRX(RXIEN,0),U,8),1:$P(^PSRX(RXIEN,1,RXFIL,0),U,10))
"RTN","PSOSULB1",125,0)
 ;
"RTN","PSOSULB1",126,0)
LDPFDT(RXIEN) ; Returns PRIOR FILL DATE if renewal otherwise LAST DISPENSED DATE or -1 if not valid
"RTN","PSOSULB1",127,0)
 Q $S('$D(^PSRX(RXIEN)):-1,$$PRFDT(RXIEN):$$PRFDT(RXIEN),1:$$LDT(RXIEN))
"RTN","PSOSULB1",128,0)
 ;
"RTN","PSOSULB1",129,0)
PRFDT(RXIEN) ; Returns PRIOR FILL DATE in internal format
"RTN","PSOSULB1",130,0)
 Q $$GET1^DIQ(52,RXIEN_",","PRIOR FILL DATE","I",,)
"RTN","PSOSULB1",131,0)
 ;
"RTN","PSOSULB1",132,0)
LDT(RXIEN) ; Returns LAST DISPENSED DATE in internal format
"RTN","PSOSULB1",133,0)
 Q $$GET1^DIQ(52,RXIEN_",","LAST DISPENSED DATE","I",,)
"RTN","PSOSULBL")
0^3^B71252652
"RTN","PSOSULBL",1,0)
PSOSULBL ;BHAM ISC/RTR,SAB-Print Suspended labels ;4/8/93
"RTN","PSOSULBL",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**139,173,174,148,200,260,264,287,289**;DEC 1997;Build 107
"RTN","PSOSULBL",3,0)
 ;External reference ^PS(55 supported by DBIA 2228
"RTN","PSOSULBL",4,0)
 ;Reference to SAVNDC^PSSNDCUT supported by IA 4707
"RTN","PSOSULBL",5,0)
 ;Reference ^PSDRUG( supported by DBIA 221
"RTN","PSOSULBL",6,0)
 K PDUZ,REPRINT G ^PSOSULB1
"RTN","PSOSULBL",7,0)
BEG ;
"RTN","PSOSULBL",8,0)
 K PSORUNIN,PSORETRY N BPSCNT
"RTN","PSOSULBL",9,0)
 S PSORUNIN="PSOSUSP"_($G(PSOSITE))
"RTN","PSOSULBL",10,0)
 L +@PSORUNIN:10 I '$T D
"RTN","PSOSULBL",11,0)
 . F PSORETRY=1:1:120 L +@PSORUNIN:60 I $T Q  ;wait Max of 2 hrs before continue
"RTN","PSOSULBL",12,0)
 . Q
"RTN","PSOSULBL",13,0)
 K ^UTILITY($J,"PSOPRO"),^TMP("PSOSBAI",$J) S PSOSEQ=1 F DFN=0:0 S DFN=$O(^PS(52.5,"AC",DFN)) Q:'DFN  D  D:'PSRT PID^VADPT6 D CHKDEAD D:'DEAD&($G(PSOSFLAG)) PRT
"RTN","PSOSULBL",14,0)
 .S PSOSFLAG=0 F ZZ=0:0 S ZZ=$O(^PS(52.5,"AC",DFN,ZZ)) Q:'ZZ!$G(PSOSFLAG)  I ZZ'>PRTDT S PSOSFLAG=1
"RTN","PSOSULBL",15,0)
 D PPL
"RTN","PSOSULBL",16,0)
 D:$D(^UTILITY($J,"PSOPRO"))&($P(PSOPAR,"^",8)) PROF
"RTN","PSOSULBL",17,0)
 G EXIT
"RTN","PSOSULBL",18,0)
PRT F SDT=0:0 S SDT=$O(^PS(52.5,"AC",DFN,SDT)) D:SDT CHK Q:'SDT
"RTN","PSOSULBL",19,0)
 Q
"RTN","PSOSULBL",20,0)
EXIT ;
"RTN","PSOSULBL",21,0)
 I $D(^TMP("PSOSBAI",$J)) D CHKMAIL
"RTN","PSOSULBL",22,0)
 K ^TMP($J),^TMP("PSOSBAI",$J)
"RTN","PSOSULBL",23,0)
 I $D(PSORUNIN) L -@PSORUNIN
"RTN","PSOSULBL",24,0)
 D ^%ZISC
"RTN","PSOSULBL",25,0)
 K %,%ZIS,CNT,COM,DA,DEAD,DFN,DIRUT,DTTM,G,HDPPL,JJ,JJJ,JJJJ,PDUZ,IOP,ORD,PFIOQ,PSLION,PSRT,POP,PRF,PRTDT,PSLIO,PSNP,PSODBQ,PSOSEQ,PSOSFLAG,PSOSU,PSOTIME,PSOOUT,PSOPRFLG,PSOSEQ,PSOSUSPR,PSSPND,PST,PTL,PPLHLD,PSFNIEN,ZTSK
"RTN","PSOSULBL",26,0)
 K PSOBADDR,PSORUNIN,PSORETRY,PSRTONE,PSSRT,PSUSDEA,RF,RFCNT,RX,RXDFN,SDT,SFN,SREC,STOP,SUSPT,VADM,VAPA,X,X1,X2,XAK,XDATE,Y,Z,ZZ,WWW,PSDDDATE,SINRX,RXPR,RXPR1,GGGG,XXX,ZII,ZTDESC,ZTRTN,ZTSAVE,RRRR,RXRP,RXRP1,RXFL,SPR S:$D(ZTQUEUED) ZTREQ="@" Q
"RTN","PSOSULBL",27,0)
CHK I SDT'>XDATE D TMP Q
"RTN","PSOSULBL",28,0)
 Q
"RTN","PSOSULBL",29,0)
TMP F SFN=0:0 S SFN=$O(^PS(52.5,"AC",DFN,SDT,SFN)) Q:'SFN  D
"RTN","PSOSULBL",30,0)
 . I '$D(^PS(52.5,SFN,0))!'$D(^DPT(+DFN,0)) Q
"RTN","PSOSULBL",31,0)
 . N RXSITE,PRINTED,PSDFN,RXSTS,RXIEN,RXFILL,PARTIAL,RXEXPDT,RESP,DSHLD
"RTN","PSOSULBL",32,0)
 . S RXIEN=+$$GET1^DIQ(52.5,SFN,.01,"I"),RXDFN=$$GET1^DIQ(52,RXIEN,2,"I")
"RTN","PSOSULBL",33,0)
 . S RXSTS=$$GET1^DIQ(52,RXIEN,100,"I"),RXSITE=+$$GET1^DIQ(52.5,SFN,.06,"I"),PRINTED=+$$GET1^DIQ(52.5,SFN,2,"I")
"RTN","PSOSULBL",34,0)
 . S PARTIAL=+$$GET1^DIQ(52.5,SFN,.05,"I"),RXEXPDT=$$GET1^DIQ(52,RXIEN,26,"I")
"RTN","PSOSULBL",35,0)
 . S RXFILL=$$GET1^DIQ(52.5,SFN,9,"I") I RXFILL="" S RXFILL=$$LSTRFL^PSOBPSU1(RXIEN)
"RTN","PSOSULBL",36,0)
 . I RXSITE=$G(PSOSITE),'PRINTED,RXDFN=DFN,RXSTS<9 D
"RTN","PSOSULBL",37,0)
 . . I PARTIAL,'$D(^PSRX(RXIEN,"P",PARTIAL)) Q
"RTN","PSOSULBL",38,0)
 . . I RXEXPDT<DT,RXSTS<11 D  Q
"RTN","PSOSULBL",39,0)
 . . . N RXREC S RXREC=RXIEN D EX^PSOSUTL
"RTN","PSOSULBL",40,0)
 . . . K DIE,DA S DIE=52,DA=RXIEN,DR="100///11" D ^DIE K DIE,DA
"RTN","PSOSULBL",41,0)
 . . . K DIK,DA S DA=SFN,DIK="^PS(52.5," D ^DIK K DIK,DA
"RTN","PSOSULBL",42,0)
 . . S PSOBADDR=0 D CHKBAI I PSOBADDR Q
"RTN","PSOSULBL",43,0)
 . . I PSRT="D" D
"RTN","PSOSULBL",44,0)
 . . . S PSSRT=$S($G(PSRTONE)="I":VA("PID"),1:$P(^DPT(DFN,0),"^")_$P(^(0),"^",9))
"RTN","PSOSULBL",45,0)
 . . . S PSUSDEA=$P($G(^PS(52.5,SFN,0)),"^",10)
"RTN","PSOSULBL",46,0)
 . . . S SRT=$S(PSUSDEA["A"!(PSUSDEA["C"):"A-"_PSSRT,PSUSDEA["S":"S-"_PSSRT,1:"Z-"_PSSRT)
"RTN","PSOSULBL",47,0)
 . . I PSRT'="D" D
"RTN","PSOSULBL",48,0)
 . . . S SRT=$S(PSRT:$P(^DPT(DFN,0),"^")_$P(^(0),"^",9),1:VA("PID"))
"RTN","PSOSULBL",49,0)
 . . ; - If not partial fill, sending Rx to ECME for 3rd Party billing
"RTN","PSOSULBL",50,0)
 . . I 'PARTIAL,$$RETRX^PSOBPSUT(RXIEN,RXFILL),SDT>DT Q
"RTN","PSOSULBL",51,0)
 . . I 'PARTIAL,$$FIND^PSOREJUT(RXIEN,RXFILL),'$$DUR^PSOBPSU2(RXIEN,RXFILL) Q  ;epharmacy-host errors
"RTN","PSOSULBL",52,0)
 . . I 'PARTIAL,$$STATUS^PSOBPSUT(RXIEN,RXFILL-1)'="" S DSHLD=$$DSH^PSOSULB1(SFN) Q:'DSHLD  ;epharmacy-3/4 days supply
"RTN","PSOSULBL",53,0)
 . . I 'PARTIAL D  Q:$$FIND^PSOREJUT(RXIEN,RXFILL,,"79,88")  Q:$$TRISTA^PSOREJU3(RXIEN,RXFILL,.RESP,"PL")
"RTN","PSOSULBL",54,0)
 . . . I $$FIND^PSOREJUT(RXIEN,RXFILL,,"79,88") Q
"RTN","PSOSULBL",55,0)
 . . . I '$$RETRX^PSOBPSUT(RXIEN,RXFILL),'$$ECMESTAT^PSXRPPL2(RXIEN,RXFILL) Q
"RTN","PSOSULBL",56,0)
 . . . D ECMESND^PSOBPSU1(RXIEN,RXFILL,,"PL",,,,,,.RESP) I $D(RESP),'RESP S BPSCNT=$G(BPSCNT)+1
"RTN","PSOSULBL",57,0)
 . . S ^TMP($J,SRT,SFN)=RXIEN
"RTN","PSOSULBL",58,0)
 Q
"RTN","PSOSULBL",59,0)
PPL ; Wait some time before printing so response from 3rd party payers can be received
"RTN","PSOSULBL",60,0)
 I $G(BPSCNT)>0 H 60+$S((BPSCNT*15)>7200:7200,1:(BPSCNT*15))
"RTN","PSOSULBL",61,0)
 K PPL,PPL1 S ORD="" F  S ORD=$O(^TMP($J,ORD)) Q:ORD=""  D PPL1
"RTN","PSOSULBL",62,0)
 Q
"RTN","PSOSULBL",63,0)
PPL1 ; Printing Labels
"RTN","PSOSULBL",64,0)
 N PARTIAL,REPRINT,REFILL,Z,QUIT
"RTN","PSOSULBL",65,0)
 S (PSOPRFLG,SUSPT)=1 S:$D(PSOPROP) PFIO=PSOPROP
"RTN","PSOSULBL",66,0)
 S:'$D(PDUZ) PDUZ=DUZ K RXPR,RXPR1,PPL
"RTN","PSOSULBL",67,0)
 F SFN=0:0 S SFN=$O(^TMP($J,ORD,SFN)) Q:'SFN  D
"RTN","PSOSULBL",68,0)
 .I '$D(^PS(52.5,SFN,0)) Q
"RTN","PSOSULBL",69,0)
 .S Z=$G(^PS(52.5,SFN,0)),SINRX=+$P(Z,"^"),REFILL=+$P(Z,"^",13)
"RTN","PSOSULBL",70,0)
 .S PARTIAL=$P(Z,"^",5),REPRINT=$P(Z,"^",12)
"RTN","PSOSULBL",71,0)
 .; - Screening out OPEN/UNRESOLVED Rejects (3rd Party Payer) 
"RTN","PSOSULBL",72,0)
 .S QUIT=0
"RTN","PSOSULBL",73,0)
 .I 'PARTIAL,'REPRINT D  I QUIT Q
"RTN","PSOSULBL",74,0)
 ..I $$FIND^PSOREJUT(SINRX,REFILL,,"79,88") S QUIT=1 Q
"RTN","PSOSULBL",75,0)
 ..I $$STATUS^PSOBPSUT(SINRX,REFILL)="IN PROGRESS" S QUIT=1 Q
"RTN","PSOSULBL",76,0)
 ..I $$STATUS^PSOBPSUT(SINRX,REFILL)="E PAYABLE" D
"RTN","PSOSULBL",77,0)
 ...D SAVNDC^PSSNDCUT(+$$GET1^DIQ(52,SINRX,6,"I"),$$RXSITE^PSOBPSUT(SINRX,REFILL),$$GETNDC^PSONDCUT(SINRX,REFILL))
"RTN","PSOSULBL",78,0)
 .; 
"RTN","PSOSULBL",79,0)
 .I $L($G(PPL))<240 D
"RTN","PSOSULBL",80,0)
 ..S PPL=$P(^TMP($J,ORD,SFN),"^")_","_$G(PPL),RXPR(SINRX)=$P(^PS(52.5,SFN,0),"^",5)
"RTN","PSOSULBL",81,0)
 ..S:$P(^PS(52.5,SFN,0),"^",12) RXRP(SINRX)=1
"RTN","PSOSULBL",82,0)
 .E  D
"RTN","PSOSULBL",83,0)
 ..S PPL1=$P(^TMP($J,ORD,SFN),"^")_","_$G(PPL1),RXPR1(SINRX)=$P(^PS(52.5,SFN,0),"^",5)
"RTN","PSOSULBL",84,0)
 ..S:$P(^PS(52.5,SFN,0),"^",12) RXRP1(SINRX)=1
"RTN","PSOSULBL",85,0)
 .S DFN=$P(^PS(52.5,SFN,0),"^",3)
"RTN","PSOSULBL",86,0)
 .I $P(PSOPAR,"^",8),'$D(^PSRX($P(^PS(52.5,SFN,0),"^"),1)),'$G(RXPR(SINRX)),'$G(RXPR1(SINRX)) S PSOPRFLG=0
"RTN","PSOSULBL",87,0)
 S PSNP=$S($P(PSOPAR,"^",8):1,1:0)
"RTN","PSOSULBL",88,0)
 I $G(PPL) D
"RTN","PSOSULBL",89,0)
 .S PPLHLD=$G(PPL1),HDPPL=PPL K PPL1 S (PSODBQ,PSOSUSPR)=1
"RTN","PSOSULBL",90,0)
 .F GGGG=0:0 S GGGG=$O(RXPR(GGGG)) Q:'GGGG  K:'$G(RXPR(GGGG)) RXPR(GGGG)
"RTN","PSOSULBL",91,0)
 I $G(PPL) D DQ^PSOLBL,SEQ D:'$G(PSOPRFLG)
"RTN","PSOSULBL",92,0)
 .I $G(PSOPROP)'=$G(PSLION) S ^UTILITY($J,"PSOPRO",DFN)="" Q
"RTN","PSOSULBL",93,0)
 .D DQ^PSOPRFSS
"RTN","PSOSULBL",94,0)
 I $G(PPLHLD) K RXPR S (PPL,HDPPL)=PPLHLD,(PSODBQ,PSOSUSPR)=1,PSNP=0 S:'$D(PDUZ) PDUZ=DUZ F XXX=0:0 S XXX=$O(RXPR1(XXX)) Q:'XXX  S:$G(RXPR1(XXX)) RXPR(XXX)=RXPR1(XXX)
"RTN","PSOSULBL",95,0)
 I $G(PPLHLD) F RRRR=0:0 S RRRR=$O(RXRP1(RRRR)) Q:'RRRR  S:$D(RXRP1(RRRR)) RXRP(RRRR)=1
"RTN","PSOSULBL",96,0)
 I $G(PPLHLD) D DQ^PSOLBL,SEQ D:'$G(PSOPRFLG)
"RTN","PSOSULBL",97,0)
 .I $G(PSOPROP)'=$G(PSLION) S ^UTILITY($J,"PSOPRO",DFN)="" Q
"RTN","PSOSULBL",98,0)
 .D DQ^PSOPRFSS
"RTN","PSOSULBL",99,0)
 K PPL,PPL1,PPLHLD,RXPR,RXPR1,RXFL Q
"RTN","PSOSULBL",100,0)
SEQ ;
"RTN","PSOSULBL",101,0)
 S SQCOUNT=0 F JJJ=1:1:$L(HDPPL) S:$E(HDPPL,JJJ)="," SQCOUNT=SQCOUNT+1
"RTN","PSOSULBL",102,0)
 F JJJJ=1:1:SQCOUNT S PSFNIEN=$P(HDPPL,",",JJJJ) D:PSFNIEN
"RTN","PSOSULBL",103,0)
 .S PSFNIEN=$O(^PS(52.5,"B",PSFNIEN,0)) I PSFNIEN D
"RTN","PSOSULBL",104,0)
 ..S $P(^PS(52.5,PSFNIEN,0),"^",11)=PSOSEQ,PSOSEQ=PSOSEQ+1 S:$P(^PS(52.5,PSFNIEN,0),"^",8)&($P(^(0),"^",9))&($P(^(0),"^",6)) ^PS(52.5,"AS",$P(^PS(52.5,PSFNIEN,0),"^",8),$P(^(0),"^",9),$P(^(0),"^",6),$P(^(0),"^",11),PSFNIEN)=""
"RTN","PSOSULBL",105,0)
 Q
"RTN","PSOSULBL",106,0)
CHKDEAD D DEM^VADPT I VADM(1)="" S DEAD=0 Q
"RTN","PSOSULBL",107,0)
 I VADM(6)="" S DEAD=0 Q
"RTN","PSOSULBL",108,0)
 S PSDDDATE=$P(VADM(6),"^",2) F WWW=0:0 S WWW=$O(^PS(55,DFN,"P",WWW)) Q:'WWW  I $D(^PS(55,DFN,"P",WWW,0)),$P($G(^(0)),"^") S (DA,RXREC)=$P(^(0),"^") S SFN=$O(^PS(52.5,"B",RXREC,0)) I SFN,$D(^PS(52.5,SFN,0)) S RX=$P(^(0),"^") D DEAD
"RTN","PSOSULBL",109,0)
 Q
"RTN","PSOSULBL",110,0)
DEAD S $P(^PSRX(RX,"STA"),"^")=12,COM="Died ("_$G(PSDDDATE)_")",DA(1)=RX
"RTN","PSOSULBL",111,0)
 S DEAD=1 D ARECD^PSOSUTL S DIK="^PS(52.5,",DA=SFN D ^DIK K DIK
"RTN","PSOSULBL",112,0)
 Q
"RTN","PSOSULBL",113,0)
PROF ;
"RTN","PSOSULBL",114,0)
 S ZTRTN="PRPROF^PSOSULBL",ZTDESC="PRINT PROFILES FROM SUSPENSE",ZTDTH=$H,ZTIO=PSOPROP
"RTN","PSOSULBL",115,0)
 S ZTSAVE("^UTILITY($J,""PSOPRO"",")="",ZTSAVE("PSOPAR")="",ZTSAVE("PSODTCUT")="",ZTSAVE("PSOSITE")="",ZTSAVE("PSOPRPAS")="" D ^%ZTLOAD Q
"RTN","PSOSULBL",116,0)
PRPROF ;
"RTN","PSOSULBL",117,0)
 F LLL=0:0 S LLL=$O(^UTILITY($J,"PSOPRO",LLL)) Q:'LLL  I $D(^DPT(LLL,0)) S DFN=LLL D DQ^PSOPRFSS
"RTN","PSOSULBL",118,0)
 K PSOPAR,PSODTCUT,PSOSITE,PSOPRPAS,LLL,DFN,^UTILITY($J,"PSOPRO") D ^%ZISC S:$D(ZTQUEUED) ZTREQ="@"
"RTN","PSOSULBL",119,0)
 Q
"RTN","PSOSULBL",120,0)
 ;
"RTN","PSOSULBL",121,0)
CHKBAI ; IF BAD ADDRESS INDICATOR, NO ACTIVE TEMPORARY ADDRESS AND ROUTING OF MAIL, DO NOT SEND TO OPAI AND/OR DO NOT PRINT LABEL
"RTN","PSOSULBL",122,0)
 N PSOBADR,ACTSEQ,XX,PSOFIRST,ACTTYPE
"RTN","PSOSULBL",123,0)
 I '$G(RXFILL),$P(^PSRX(RXIEN,0),"^",11)="W" Q
"RTN","PSOSULBL",124,0)
 I $P($G(^PSRX(RXIEN,1,RXFILL,0)),"^",2)="W" Q
"RTN","PSOSULBL",125,0)
 S ACTTYPE="BAD ADDRESS INDICATOR"
"RTN","PSOSULBL",126,0)
 S PSOBADR=$$CHKRX^PSOBAI(RXIEN)
"RTN","PSOSULBL",127,0)
 ; GOOD PERMANENT OR TEMPORARY ADDRESS - CHECK FOR DO NOT MAIL
"RTN","PSOSULBL",128,0)
 I PSOBADR,'$P(PSOBADR,"^",2) D SETTMP(ACTTYPE) Q
"RTN","PSOSULBL",129,0)
 S NOMAIL=0 D NOMAIL I NOMAIL Q
"RTN","PSOSULBL",130,0)
 D FOREIGN
"RTN","PSOSULBL",131,0)
 Q
"RTN","PSOSULBL",132,0)
 ;
"RTN","PSOSULBL",133,0)
SETTMP(ACTTYPE) ;
"RTN","PSOSULBL",134,0)
 N ACTSEQ,XX,PSOFIRST,ZZ
"RTN","PSOSULBL",135,0)
 S PSOFIRST=1
"RTN","PSOSULBL",136,0)
 S PSOBADDR=1
"RTN","PSOSULBL",137,0)
 S ACTSEQ=0 F  S ACTSEQ=$O(^PSRX(RXIEN,"A",ACTSEQ)) Q:ACTSEQ=""  D
"RTN","PSOSULBL",138,0)
 .S XX=$G(^PSRX(RXIEN,"A",ACTSEQ,0)) I $P(XX,"^",2)="S" S ZZ=$P(XX,"^",4),ZZ=$S(ZZ<6:ZZ,1:ZZ-1) I ZZ=RXFILL,$P(XX,"^",5)["due to "_ACTTYPE S PSOFIRST=0 Q
"RTN","PSOSULBL",139,0)
 I PSOFIRST D
"RTN","PSOSULBL",140,0)
 .S ^TMP("PSOSBAI",$J,RXIEN,+RXFILL)=ACTTYPE
"RTN","PSOSULBL",141,0)
 .D ACT(ACTTYPE)
"RTN","PSOSULBL",142,0)
 Q
"RTN","PSOSULBL",143,0)
 ;
"RTN","PSOSULBL",144,0)
NOMAIL ; SEE IF FILE 55 STATUS IS DO NOT MAIL
"RTN","PSOSULBL",145,0)
 N ACTTYPE,DFN,MAILST,MAILEXP
"RTN","PSOSULBL",146,0)
 S ACTTYPE="DO NOT MAIL"
"RTN","PSOSULBL",147,0)
 S DFN=+$P($G(^PSRX(RXIEN,0)),"^",2),MAILST=$P($G(^PS(55,DFN,0)),"^",3) I MAILST'=2 Q
"RTN","PSOSULBL",148,0)
 S MAILEXP=$P(^PS(55,DFN,0),"^",5)
"RTN","PSOSULBL",149,0)
 I MAILEXP=""!(MAILEXP>DT) D SETTMP(ACTTYPE)
"RTN","PSOSULBL",150,0)
 Q
"RTN","PSOSULBL",151,0)
 ;
"RTN","PSOSULBL",152,0)
FOREIGN ;
"RTN","PSOSULBL",153,0)
 N DFN,PSOFORGN
"RTN","PSOSULBL",154,0)
 S DFN=+$P($G(^PSRX(RXIEN,0)),"^",2)
"RTN","PSOSULBL",155,0)
 D ADD^VADPT
"RTN","PSOSULBL",156,0)
 S PSOFORGN=$P($G(VAPA(25)),"^",2) I PSOFORGN'="",PSOFORGN'["UNITED STATES" S PSOFORGN=1
"RTN","PSOSULBL",157,0)
 I PSOFORGN D SETTMP("FOREIGN ADDRESS")
"RTN","PSOSULBL",158,0)
 Q
"RTN","PSOSULBL",159,0)
 ;
"RTN","PSOSULBL",160,0)
CHKMAIL ; SEE IF MAILMAN MESSAGE SHOULD BE SENT FOR BAI/MAIL ROUTING
"RTN","PSOSULBL",161,0)
 N RXIEN,RXFILL,ACTSEQ,XX,DFN,SSN,NAME,ACTTYPE,ZZ
"RTN","PSOSULBL",162,0)
 K ^TMP("PSOSM",$J)
"RTN","PSOSULBL",163,0)
 S RXIEN=0 F  S RXIEN=$O(^TMP("PSOSBAI",$J,RXIEN)) Q:'RXIEN  D
"RTN","PSOSULBL",164,0)
 .S RXFILL="" F  S RXFILL=$O(^TMP("PSOSBAI",$J,RXIEN,RXFILL)) Q:RXFILL=""  D
"RTN","PSOSULBL",165,0)
 ..S ACTTYPE=^TMP("PSOSBAI",$J,RXIEN,RXFILL)
"RTN","PSOSULBL",166,0)
 ..S ACTSEQ=0 F  S ACTSEQ=$O(^PSRX(RXIEN,"A",ACTSEQ)) Q:ACTSEQ=""  D
"RTN","PSOSULBL",167,0)
 ...S XX=$G(^PSRX(RXIEN,"A",ACTSEQ,0)) I $P(XX,"^",2)="S" S ZZ=$P(XX,"^",4),ZZ=$S(ZZ<6:ZZ,1:ZZ-1) I ZZ=RXFILL,$P(XX,"^",5)["due to "_ACTTYPE Q
"RTN","PSOSULBL",168,0)
 ...S DFN=$P(^PSRX(RXIEN,0),"^",2),NAME=$P(^DPT(DFN,0),"^"),SSN=$P(^(0),"^",9) I SSN="" S SSN=0
"RTN","PSOSULBL",169,0)
 ...S ^TMP("PSOSM",$J,NAME,SSN,RXIEN,RXFILL)=ACTTYPE
"RTN","PSOSULBL",170,0)
 I $D(^TMP("PSOSM",$J)) D BAIMAIL^PSOSULB1
"RTN","PSOSULBL",171,0)
 K ^TMP("PSOSM",$J)
"RTN","PSOSULBL",172,0)
 Q
"RTN","PSOSULBL",173,0)
 ;
"RTN","PSOSULBL",174,0)
ACT(ACTTYPE) ;adds activity info for rx not printed from suspense/not sent to OPAI
"RTN","PSOSULBL",175,0)
 N NOW,IR,FDA
"RTN","PSOSULBL",176,0)
 D NOW^%DTC S NOW=%
"RTN","PSOSULBL",177,0)
 S IR=0 F FDA=0:0 S FDA=$O(^PSRX(RXIEN,"A",FDA)) Q:'FDA  S IR=FDA
"RTN","PSOSULBL",178,0)
 S IR=IR+1,^PSRX(RXIEN,"A",0)="^52.3DA^"_IR_"^"_IR
"RTN","PSOSULBL",179,0)
 S ^PSRX(RXIEN,"A",IR,0)=NOW_"^"_"S"_"^"_DUZ_"^"_$S(+RXFILL>5:RXFILL+1,1:+RXFILL)_"^"_"RX not printed from suspense due to "_ACTTYPE
"RTN","PSOSULBL",180,0)
 K PSUS,RXF,I,FDA,DIC,DIE,DR,Y,X,%,%I,%H,RSDT
"RTN","PSOSULBL",181,0)
 Q
"RTN","PSOSULBL",182,0)
 ;
"RTN","PSOSUPOE")
0^43^B64269285
"RTN","PSOSUPOE",1,0)
PSOSUPOE ;BIR/RTR - Suspense pull via Listman ;3/1/96
"RTN","PSOSUPOE",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**8,21,27,34,130,148,281,287,289**;DEC 1997;Build 107
"RTN","PSOSUPOE",3,0)
 ;External references PSOL and PSOUL^PSSLOCK supported by DBIA 2789
"RTN","PSOSUPOE",4,0)
SEL I '$G(PSOCNT) S VALMSG="This patient has no Prescriptions!" S VALMBCK="" Q
"RTN","PSOSUPOE",5,0)
 N PSOGETF,PSOGET,PSOGETFN,ORD,ORN,MW,PDUZ,PSLST,PSOSQ,PSOSQRTE,PSOSQMTH,PSPOP,PSOX1,PSOX2,RXLTOP,RXREC,SFN,SORD,SORN,VALMCNT
"RTN","PSOSUPOE",6,0)
 K DIR,DUOUT,DTOUT S DIR("A")="Select Orders by number",DIR(0)="LO^1:"_PSOCNT D ^DIR K DIR I $D(DTOUT)!($D(DUOUT))!('Y) S VALMSG="Nothing pulled from suspense!",VALMBCK="" Q
"RTN","PSOSUPOE",7,0)
 S PSLST=Y
"RTN","PSOSUPOE",8,0)
SELQ D FULL^VALM1
"RTN","PSOSUPOE",9,0)
 K DIR S DIR("A")="Select routing for Rx(s)",DIR(0)="S^M:MAIL;W:WINDOW",DIR("B")="WINDOW" D ^DIR K DIR I Y["^"!($D(DTOUT))!($D(DUOUT)) G END
"RTN","PSOSUPOE",10,0)
 S PSOSQRTE=Y I $G(PSOSQRTE)="W",$P(PSOPAR,"^",12) K DIR S DIR(0)="FO^2:60",DIR("A")="METHOD OF PICK-UP" D ^DIR S PSOSQMTH=$G(Y) K DIR I Y["^"!($D(DTOUT))!($D(DUOUT)) G END
"RTN","PSOSUPOE",11,0)
 W ! K DIR S DIR(0)="Y",DIR("A")="Pull Rx(s) and delete from suspense",DIR("B")="YES" D  D ^DIR K DIR I Y'=1 G END
"RTN","PSOSUPOE",12,0)
 .S DIR("?",1)="Enter Yes to pull selected Rx(s) from suspense. Since(Rx(s) pulled early from",DIR("?",2)="suspense are not associated with a printed batch, these Rx(s) cannot be"
"RTN","PSOSUPOE",13,0)
 .S DIR("?",3)="reprinted from suspense using the 'Reprint batches from suspense' option.",DIR("?")="Therefore, any Rx(s) pulled early from suspense will be deleted from suspense."
"RTN","PSOSUPOE",14,0)
 Q:$G(PULLONE)
"RTN","PSOSUPOE",15,0)
 F SORD=1:1:$L(PSLST,",") Q:$P(PSLST,",",SORD)']""  S SORN=$P(PSLST,",",SORD) D:+PSOLST(SORN)=52 BEG
"RTN","PSOSUPOE",16,0)
 S VALMBCK="R"
"RTN","PSOSUPOE",17,0)
 I '$G(PSOSQ) S VALMSG="No Rx's pulled from suspense!"
"RTN","PSOSUPOE",18,0)
 Q
"RTN","PSOSUPOE",19,0)
BEG ;
"RTN","PSOSUPOE",20,0)
 S RXREC=$P(PSOLST(SORN),"^",2)
"RTN","PSOSUPOE",21,0)
BEGQ Q:'$D(^PSRX(+$G(RXREC),0))
"RTN","PSOSUPOE",22,0)
 D PSOL^PSSLOCK(RXREC) I '$G(PSOMSG) W !!,$S($P($G(PSOMSG),"^",2)'="":$P($G(PSOMSG),"^",2),1:"Another person is editing Rx "_$P($G(^PSRX(RXREC,0)),"^")),! K PSOMSG D DIR Q
"RTN","PSOSUPOE",23,0)
 K PSOMSG I $P($G(^PSRX(RXREC,"STA")),"^")'=5 W !!,"Rx# ",$P(^PSRX(RXREC,0),"^")," is not on Suspense!" D DIR,ULRX Q
"RTN","PSOSUPOE",24,0)
 S SFN=$O(^PS(52.5,"B",RXREC,0)) I 'SFN D DIR,ULRX Q
"RTN","PSOSUPOE",25,0)
 S PDUZ=DUZ I +$G(^PS(52.5,SFN,"P")) W !,">>> Rx #",$P(^PSRX(+$P(^(0),"^"),0),"^")," ALREADY PRINTED FROM SUSPENSE.",!,?5,"USE THE REPRINT OPTION TO REPRINT LABEL." D DIR,ULRX Q
"RTN","PSOSUPOE",26,0)
 I +$P($G(^PSRX(RXREC,2)),"^",6)<DT,+$P($G(^("STA")),"^")<11 D  S DIE=52,DA=RXREC,DR="100///11" D ^DIE S DA=SFN,DIK="^PS(52.5," D ^DIK K DIE,DA,DIK W !,"Rx # "_$P(^PSRX(RXREC,0),"^")_" has expired!" D DIR,ULRX Q
"RTN","PSOSUPOE",27,0)
 .N PSCOU,AAA,VVV,QQQ,PSOPRT,PSOEXPI D EX^PSOSUTL
"RTN","PSOSUPOE",28,0)
 I $D(RXRP(RXREC)) W !!,"A reprint has already been requested for Rx # ",$P($G(^PSRX(RXREC,0)),"^") D DIR,ULRX Q
"RTN","PSOSUPOE",29,0)
 I $D(RXPR(RXREC)) W !!,"A partial has already been requested for Rx # ",$P($G(^PSRX(RXREC,0)),"^") D DIR,ULRX Q
"RTN","PSOSUPOE",30,0)
 S PSPOP=0 I $G(PSODIV),$P($G(^PS(52.5,SFN,0)),"^",6)'=$G(PSOSITE) D CKDIV I $G(PSPOP) D DIR,ULRX Q
"RTN","PSOSUPOE",31,0)
 S:$P(^PS(52.5,SFN,0),"^",5) RXPR(RXREC)=$P(^(0),"^",5) S:$P(^PS(52.5,SFN,0),"^",12) RXRP(RXREC)=1
"RTN","PSOSUPOE",32,0)
 S RXFL(RXREC)=$P($G(^PS(52.5,SFN,0)),"^",13),RXRS(RXREC)=$G(PSODFN),RXLTOP=1
"RTN","PSOSUPOE",33,0)
 S RXRS(RXREC)=$G(RXRS(RXREC))_"^"_$S($P($G(^PS(52.5,SFN,0)),"^",4)="W":"W",1:"M")_"^"_$P($G(^PSRX(RXREC,"MP")),"^") S PSOGET="M" D GETMW
"RTN","PSOSUPOE",34,0)
 S RXRS(RXREC)=$G(RXRS(RXREC))_"^"_$G(PSOGETF)_"^"_$G(PSOGETFN)_"^"_$S($G(PSOGET)="W":"W",1:"M")
"RTN","PSOSUPOE",35,0)
 S $P(^PS(52.5,SFN,0),"^",4)=$G(PSOSQRTE) S MW=$G(PSOSQRTE) N RR,RFCNT D MAILS^PSOSUPAT I $D(PSOSQMTH) S $P(^PSRX(RXREC,"MP"),"^")=$G(PSOSQMTH)
"RTN","PSOSUPOE",36,0)
 S PSOSQ=1
"RTN","PSOSUPOE",37,0)
 ;
"RTN","PSOSUPOE",38,0)
 ; - Submitting Rx to ECME for 3rd Party Billing
"RTN","PSOSUPOE",39,0)
 I '$D(RXPR(RXREC)) D
"RTN","PSOSUPOE",40,0)
 . N ACTION,RFL S RFL=$G(RXFL(RXREC)) I RFL="" S RFL=$$LSTRFL^PSOBPSU1(RXREC)
"RTN","PSOSUPOE",41,0)
 . D ECMESND^PSOBPSU1(RXREC,RFL,,"PP")
"RTN","PSOSUPOE",42,0)
 . I $$FIND^PSOREJUT(RXREC,RFL) D
"RTN","PSOSUPOE",43,0)
 . . S ACTION=$$HDLG^PSOREJU1(RXREC,RFL,"79,88","PP","IOQ","Q")
"RTN","PSOSUPOE",44,0)
 ;
"RTN","PSOSUPOE",45,0)
 D ULRX K PSOGET,PSOGETF
"RTN","PSOSUPOE",46,0)
 Q
"RTN","PSOSUPOE",47,0)
WIND ;
"RTN","PSOSUPOE",48,0)
 N RRT,RRTT,XXXX,JJJJ,PSINTRX,RTETEST,PSOPSO,SSSS
"RTN","PSOSUPOE",49,0)
 S PBINGRTE=0,PSINTRX=RXREC
"RTN","PSOSUPOE",50,0)
 I $G(RXPR(RXREC)) S RTETEST=$P($G(^PSRX(RXREC,"P",RXPR(PSINTRX),0)),"^",2) S:RTETEST="W" PBINGRTE=1 Q
"RTN","PSOSUPOE",51,0)
 S PSOPSO=0 F SSSS=0:0 S SSSS=$O(^PSRX(PSINTRX,1,SSSS)) Q:'SSSS  S PSOPSO=SSSS
"RTN","PSOSUPOE",52,0)
 I 'PSOPSO S RTETEST=$P($G(^PSRX(PSINTRX,0)),"^",11) S:RTETEST="W" PBINGRTE=1 Q
"RTN","PSOSUPOE",53,0)
 I PSOPSO S RTETEST=$P($G(^PSRX(PSINTRX,1,PSOPSO,0)),"^",2) S:RTETEST="W" PBINGRTE=1 Q
"RTN","PSOSUPOE",54,0)
 Q
"RTN","PSOSUPOE",55,0)
DIR ;
"RTN","PSOSUPOE",56,0)
 W ! K DIR S DIR(0)="E",DIR("A")="Press Return to Continue" D ^DIR K DIR Q
"RTN","PSOSUPOE",57,0)
END S VALMSG="Nothing pulled from suspense!",VALMBCK="R" S:$G(PULLONE)=1 PULLONE=2 Q
"RTN","PSOSUPOE",58,0)
ADD ;Add Rx to SPSORX array
"RTN","PSOSUPOE",59,0)
 I $G(SPSORX("PSOL",1))']"" S SPSORX("PSOL",1)=RXREC_"," Q
"RTN","PSOSUPOE",60,0)
 F PSOX1=0:0 S PSOX1=$O(SPSORX("PSOL",PSOX1)) Q:'PSOX1  S PSOX2=PSOX1
"RTN","PSOSUPOE",61,0)
 I $L(SPSORX("PSOL",PSOX2))+$L(RXREC)<220 S SPSORX("PSOL",PSOX2)=SPSORX("PSOL",PSOX2)_RXREC_"," Q
"RTN","PSOSUPOE",62,0)
 S SPSORX("PSOL",PSOX2+1)=RXREC_","
"RTN","PSOSUPOE",63,0)
 Q
"RTN","PSOSUPOE",64,0)
BBADD ;
"RTN","PSOSUPOE",65,0)
 N PSOX1,PSOX2
"RTN","PSOSUPOE",66,0)
 I $G(BBRX(1))']"" S BBRX(1)=RXREC_"," Q
"RTN","PSOSUPOE",67,0)
 F PSOX1=0:0 S PSOX1=$O(BBRX(PSOX1)) Q:'PSOX1  S PSOX2=PSOX1
"RTN","PSOSUPOE",68,0)
 I $L(BBRX(PSOX2))+$L(RXREC)<220 S BBRX(PSOX2)=BBRX(PSOX2)_RXREC_"," Q
"RTN","PSOSUPOE",69,0)
 S BBRX(PSOX2+1)=RXREC_","
"RTN","PSOSUPOE",70,0)
 Q
"RTN","PSOSUPOE",71,0)
TRIC(PSOTRX) ;
"RTN","PSOSUPOE",72,0)
 S PSOTRF=$$LSTRFL^PSOBPSU1(PSOTRX)
"RTN","PSOSUPOE",73,0)
 S PSOTRIC="",PSOTRIC=$$TRIC^PSOREJP1(PSOTRX,PSOTRF,.PSOTRIC)
"RTN","PSOSUPOE",74,0)
 S ESTAT=$P($$STATUS^PSOBPSUT(PSOTRX,PSOTRF),"^")
"RTN","PSOSUPOE",75,0)
 I PSOTRIC S EACTION=$S(ESTAT["PAYABLE":1,ESTAT["Inactive ECME Tricare":1,ESTAT="":1,1:0)
"RTN","PSOSUPOE",76,0)
 Q
"RTN","PSOSUPOE",77,0)
PPLADD ;
"RTN","PSOSUPOE",78,0)
 N SZZ,SPSOX1,SPSOX2,LSFN,PSOTRF,PSOTRIC,PSOTRX,EACTION,ESTAT
"RTN","PSOSUPOE",79,0)
 I $G(PPL)'="",$E(PPL,$L(PPL))'="," S PPL=PPL_","
"RTN","PSOSUPOE",80,0)
 F SZZ=0:0 S SZZ=$O(RXRS(SZZ)) Q:'SZZ  D
"RTN","PSOSUPOE",81,0)
 .S LSFN=$O(^PS(52.5,"B",SZZ,0))
"RTN","PSOSUPOE",82,0)
 .Q:'$G(LSFN)
"RTN","PSOSUPOE",83,0)
 .Q:$G(^PS(52.5,LSFN,"P"))
"RTN","PSOSUPOE",84,0)
 .D TRIC(SZZ)
"RTN","PSOSUPOE",85,0)
 .I $G(PSOTRIC) Q:'$G(EACTION)  ;no labels for "In Progress" Tricare Rx's.
"RTN","PSOSUPOE",86,0)
 .I $G(PPL)="" S PPL=SZZ_"," Q
"RTN","PSOSUPOE",87,0)
 .I $L(PPL)+$L(SZZ)<220 S PPL=PPL_SZZ_"," Q
"RTN","PSOSUPOE",88,0)
 .I $G(PSORX("PSOL",2))']"" S PSORX("PSOL",2)=SZZ_"," Q
"RTN","PSOSUPOE",89,0)
 .F SPSOX1=1:0 S SPSOX1=$O(PSORX("PSOL",SPSOX1)) Q:'SPSOX1  S SPSOX2=SPSOX1
"RTN","PSOSUPOE",90,0)
 .I $L(PSORX("PSOL",SPSOX2))+$L(SZZ)<220 S PSORX("PSOL",SPSOX2)=PSORX("PSOL",SPSOX2)_SZZ_"," Q
"RTN","PSOSUPOE",91,0)
 .S PSORX("PSOL",SPSOX2+1)=SZZ_","
"RTN","PSOSUPOE",92,0)
 Q
"RTN","PSOSUPOE",93,0)
CKDIV ;
"RTN","PSOSUPOE",94,0)
 I '$P($G(PSOSYS),"^",2) W !!?10,"Rx # ",$P(^PSRX(RXREC,0),"^")," is not a valid choice (Different Division)" S PSPOP=1 Q
"RTN","PSOSUPOE",95,0)
 I $P($G(PSOSYS),"^",3) W !!?10 K DIR S DIR("A")="Rx # "_$P(^PSRX(RXREC,0),"^")_" is from another division. OK to Pull",DIR(0)="Y",DIR("B")="YES" D ^DIR K DIR I $G(DIRUT)!('Y) S PSPOP=1
"RTN","PSOSUPOE",96,0)
 Q
"RTN","PSOSUPOE",97,0)
SELONE ;Pull one Rx through Listman
"RTN","PSOSUPOE",98,0)
 I $G(PSOBEDT) W $C(7),$C(7) S VALMSG="Invalid Action at this time !",VALMBCK="" Q
"RTN","PSOSUPOE",99,0)
 N ORD,MW,PDUZ,PSLST,PSOSQ,PSOSQRTE,PSOSQMTH,PSPOP,PSOX1,PSOX2,PULLONE,RXLTOP,RXREC,SFN,SORD,SORN,VALMCNT
"RTN","PSOSUPOE",100,0)
 S PULLONE=1
"RTN","PSOSUPOE",101,0)
 I +PSOLST(ORN)'=52 S VALMBCK="" Q
"RTN","PSOSUPOE",102,0)
 I +PSOLST(ORN)=52,$P($G(^PSRX($P(PSOLST(ORN),"^",2),"STA")),"^")'=5 S VALMSG="Rx is not on Suspense!",VALMBCK="" Q
"RTN","PSOSUPOE",103,0)
 I +PSOLST(ORN)=52,$D(RXRS($P(PSOLST(ORN),"^",2))) S VALMSG="Pull early has already been requested!",VALMBCK="" Q
"RTN","PSOSUPOE",104,0)
 N EHOLDQ,ESIEN,ERXIEN S ERXIEN=$P(PSOLST(ORN),"^",2),ESIEN="",ESIEN=$O(^PS(52.5,"B",ERXIEN,ESIEN))
"RTN","PSOSUPOE",105,0)
 I $G(ESIEN),$$GET1^DIQ(52.5,ESIEN,10)'="" D EHOLD Q:$G(EHOLDQ)
"RTN","PSOSUPOE",106,0)
 K EHOLDQ,ESIEN,ERXIEN
"RTN","PSOSUPOE",107,0)
 D SELQ I $G(PULLONE)=2 S VALMSG="Rx# "_$P($G(^PSRX($P(PSOLST(ORN),"^",2),0)),"^")_" not pulled from suspense!" Q
"RTN","PSOSUPOE",108,0)
 I +PSOLST(ORN)=52 S RXREC=$P(PSOLST(ORN),"^",2)
"RTN","PSOSUPOE",109,0)
 D BEGQ S VALMSG="Rx# "_$P($G(^PSRX(+$G(RXREC),0)),"^")_$S($G(PSOSQ):" pulled",1:" not pulled")_" from Suspense!"
"RTN","PSOSUPOE",110,0)
 S VALMBCK="R"
"RTN","PSOSUPOE",111,0)
 Q
"RTN","PSOSUPOE",112,0)
RESET ;
"RTN","PSOSUPOE",113,0)
 N RSDA,RXMW,RXMP,RXSP,RXR,DA,RXPSRX,RXFILL,RXFILLN
"RTN","PSOSUPOE",114,0)
 F RSDA=0:0 S RSDA=$O(RXRS(RSDA)) Q:'RSDA  D
"RTN","PSOSUPOE",115,0)
 .S RXSP=$O(^PS(52.5,"B",RSDA,0)) Q:'RXSP
"RTN","PSOSUPOE",116,0)
 .Q:'$D(^PS(52.5,RXSP,0))
"RTN","PSOSUPOE",117,0)
 .S RXMW=$S($P($G(RXRS(RSDA)),"^",2)="":"M",1:$P($G(RXRS(RSDA)),"^",2)),RXMP=$P($G(RXRS(RSDA)),"^",3),RXFILL=$P($G(RXRS(RSDA)),"^",4),RXFILLN=$P($G(RXRS(RSDA)),"^",5),RXPSRX=$S($P($G(RXRS(RSDA)),"^",6)="":"M",1:$P($G(RXRS(RSDA)),"^",6))
"RTN","PSOSUPOE",118,0)
 .I RXMW'="" S $P(^PS(52.5,RXSP,0),"^",4)=RXMW D
"RTN","PSOSUPOE",119,0)
 ..I RXFILL="P" D  Q
"RTN","PSOSUPOE",120,0)
 ...I $D(^PSRX(RSDA,"P",+$G(RXFILLN),0)) S $P(^PSRX(RSDA,"P",+$G(RXFILLN),0),"^",2)=$G(RXPSRX),$P(^PSRX(RSDA,"MP"),"^")=RXMP
"RTN","PSOSUPOE",121,0)
 ..I RXFILL="R",$G(RXFILLN) S DA(1)=RSDA,DA=RXFILLN,DIE="^PSRX("_DA(1)_",1,",DR="2////"_RXPSRX D ^DIE K DIE
"RTN","PSOSUPOE",122,0)
 ..I RXFILL="O" S DA=RSDA,DIE="^PSRX(",DR="11////"_RXPSRX D ^DIE K DIE
"RTN","PSOSUPOE",123,0)
 ..S $P(^PSRX(RSDA,"MP"),"^")=RXMP
"RTN","PSOSUPOE",124,0)
 Q
"RTN","PSOSUPOE",125,0)
GETMW ;
"RTN","PSOSUPOE",126,0)
 N GETPAR,GETRX,GETCNT
"RTN","PSOSUPOE",127,0)
 S PSOGETF="O",PSOGETFN=""
"RTN","PSOSUPOE",128,0)
 S GETPAR=$P($G(^PS(52.5,SFN,0)),"^",5)
"RTN","PSOSUPOE",129,0)
 I GETPAR S PSOGET=$P($G(^PSRX(RXREC,"P",GETPAR,0)),"^",2),PSOGETF="P",PSOGETFN=GETPAR Q
"RTN","PSOSUPOE",130,0)
 I '$O(^PSRX(RXREC,1,0)) S PSOGET=$P($G(^PSRX(RXREC,0)),"^",11) Q
"RTN","PSOSUPOE",131,0)
 S GETRX=0 F GETCNT=0:0 S GETCNT=$O(^PSRX(RXREC,1,GETCNT)) Q:'GETCNT  S GETRX=GETCNT
"RTN","PSOSUPOE",132,0)
 S PSOGET=$P($G(^PSRX(RXREC,1,+$G(GETRX),0)),"^",2),PSOGETF="R",PSOGETFN=+$G(GETRX)
"RTN","PSOSUPOE",133,0)
 Q
"RTN","PSOSUPOE",134,0)
ULRX ;
"RTN","PSOSUPOE",135,0)
 I '$G(RXREC) Q
"RTN","PSOSUPOE",136,0)
 D PSOUL^PSSLOCK(RXREC)
"RTN","PSOSUPOE",137,0)
 Q
"RTN","PSOSUPOE",138,0)
EHOLD ;
"RTN","PSOSUPOE",139,0)
 Q:'$G(ERXIEN)
"RTN","PSOSUPOE",140,0)
 Q:$$GET1^DIQ(52,ERXIEN,86)=""
"RTN","PSOSUPOE",141,0)
 D FULL^VALM1
"RTN","PSOSUPOE",142,0)
 W !,"This is an ePharmacy billable fill which is Suspended until "_$$GET1^DIQ(52.5,ESIEN,10)_", based"
"RTN","PSOSUPOE",143,0)
 W !,"on the 3/4 Days rule.",!
"RTN","PSOSUPOE",144,0)
 K DIR S EHOLDQ=0,DIR(0)="YA",DIR("A")="Do you wish to continue? "
"RTN","PSOSUPOE",145,0)
 D ^DIR I $D(DIRUT)!('Y) S EHOLDQ=1 K DIR
"RTN","PSOSUPOE",146,0)
 S VALMSG="No action taken.",VALMBCK="R"
"RTN","PSOSUPOE",147,0)
 Q
"RTN","PSOSUPOE",148,0)
 ;
"SEC","^DIC",52.86,52.86,0,"AUDIT")
@
"SEC","^DIC",52.86,52.86,0,"DD")
@
"SEC","^DIC",52.86,52.86,0,"DEL")
@
"SEC","^DIC",52.86,52.86,0,"LAYGO")
@
"SEC","^DIC",52.86,52.86,0,"RD")
Pp
"SEC","^DIC",52.86,52.86,0,"WR")
@
"UP",52,52.1,-1)
52^1
"UP",52,52.1,0)
52.1
"UP",52,52.25,-1)
52^REJ
"UP",52,52.25,0)
52.25
"VER")
8.0^22.0
"^DD",52,52,86,0)
EPHARMACY SUSPENSE HOLD DATE^D^^EPH;6^S %DT="E" D ^%DT S X=Y K:X<1 X
"^DD",52,52,86,3)
Enter the date the prescription can be removed from suspense hold.
"^DD",52,52,86,21,0)
^^3^3^3080429^
"^DD",52,52,86,21,1,0)
This field is defined when a host reject error is received as a result of 
"^DD",52,52,86,21,2,0)
an ePharmacy claims submission.  The prescription fill will be held on 
"^DD",52,52,86,21,3,0)
suspense until the next day.
"^DD",52,52,86,23,0)
^^4^4^3080507^
"^DD",52,52,86,23,1,0)
This field is defined with a date/time of 24 hours from the date/time the 
"^DD",52,52,86,23,2,0)
original RX was rejected with either a M6, M8, NN, or 99 host reject 
"^DD",52,52,86,23,3,0)
error code. This allows the software to resubmit a claim the following 
"^DD",52,52,86,23,4,0)
day to attempt a successful acceptance.
"^DD",52,52,86,"DT")
3080507
"^DD",52,52.1,86,0)
EPHARMACY SUSPENSE HOLD DATE^D^^EPH;6^S %DT="ES" D ^%DT S X=Y K:X<1 X
"^DD",52,52.1,86,3)
Enter the date the refill can be removed from suspense hold.
"^DD",52,52.1,86,21,0)
^^3^3^3080429^
"^DD",52,52.1,86,21,1,0)
This field is defined when a host reject error is received as a result of 
"^DD",52,52.1,86,21,2,0)
an ePharmacy claims submission.  The prescription fill will be held on 
"^DD",52,52.1,86,21,3,0)
suspense until the next day.
"^DD",52,52.1,86,23,0)
^^4^4^3080507^
"^DD",52,52.1,86,23,1,0)
This field is defined with a date/time of 24 hours from the date/time the 
"^DD",52,52.1,86,23,2,0)
refill was rejected with either a M6, M8, NN, or 99 host reject error
"^DD",52,52.1,86,23,3,0)
code. This allows the software to resubmit a claim the following day to
"^DD",52,52.1,86,23,4,0)
attempt a successful acceptance.
"^DD",52,52.1,86,"DT")
3080507
"^DD",52,52.25,24,0)
CLARIFICATION CODE^P9002313.25'^BPS(9002313.25,^0;15^Q
"^DD",52,52.25,24,3)
Enter a clarification code.
"^DD",52,52.25,24,21,0)
^^1^1^3080502^
"^DD",52,52.25,24,21,1,0)
This field contains the NCPDP Clarification Code for the reject.
"^DD",52,52.25,24,23,0)
^^2^2^3080502^
"^DD",52,52.25,24,23,1,0)
This field can contain any value from the BPS NCPDP CLARIFICATION CODES 
"^DD",52,52.25,24,23,2,0)
file (#9002313.25).
"^DD",52,52.25,24,"DT")
3080502
"^DD",52.5,52.5,10,0)
SUSPENSE HOLD DATE^D^^0;14^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",52.5,52.5,10,3)
Enter the date/time when 3/4 of days supply will elapse.
"^DD",52.5,52.5,10,21,0)
^^7^7^3080611^
"^DD",52.5,52.5,10,21,1,0)
This field is populated when the Print from Suspense function is executed 
"^DD",52.5,52.5,10,21,2,0)
and for ePharmacy prescriptions only.  It will contain the date when 3/4
"^DD",52.5,52.5,10,21,3,0)
of the Days Supply will have elapsed.  ePharmacy prescriptions will be
"^DD",52.5,52.5,10,21,4,0)
left on suspense until this date.  Otherwise, the prescription will print
"^DD",52.5,52.5,10,21,5,0)
on or after the date stored in this field.
"^DD",52.5,52.5,10,21,6,0)
 
"^DD",52.5,52.5,10,21,7,0)
Non-ePharmacy prescriptions are not affected by this functionality.
"^DD",52.5,52.5,10,23,0)
^.001^5^5^3080611^^
"^DD",52.5,52.5,10,23,1,0)
This field is used for ePharmacy prescriptions only. If 3/4 of the days
"^DD",52.5,52.5,10,23,2,0)
supply has not yet elapsed this field will be populated with the date that
"^DD",52.5,52.5,10,23,3,0)
the prescription will be allowed to be printed from suspense.  Note that
"^DD",52.5,52.5,10,23,4,0)
prescriptions may be pulled early from suspense without regard to this 
"^DD",52.5,52.5,10,23,5,0)
field.
"^DD",52.5,52.5,10,"DT")
3080611
"^DD",52.86,52.86,0)
FIELD^^4^6
"^DD",52.86,52.86,0,"DDA")
N
"^DD",52.86,52.86,0,"DT")
3080610
"^DD",52.86,52.86,0,"IX","B",52.86,.01)

"^DD",52.86,52.86,0,"NM","EPHARMACY SITE PARAMETERS")

"^DD",52.86,52.86,0,"VRPK")
PSO
"^DD",52.86,52.86,.01,0)
DIVISION^RP59'^PS(59,^0;1^Q
"^DD",52.86,52.86,.01,.1)
PHARMACY DIVISION
"^DD",52.86,52.86,.01,1,0)
^.1
"^DD",52.86,52.86,.01,1,1,0)
52.86^B
"^DD",52.86,52.86,.01,1,1,1)
S ^PS(52.86,"B",$E(X,1,30),DA)=""
"^DD",52.86,52.86,.01,1,1,2)
K ^PS(52.86,"B",$E(X,1,30),DA)
"^DD",52.86,52.86,.01,1,1,"DT")
3080522
"^DD",52.86,52.86,.01,3)
Enter a valid division number.
"^DD",52.86,52.86,.01,21,0)
^.001^2^2^3090430^^
"^DD",52.86,52.86,.01,21,1,0)
This is the Pharmacy Division for which the division-specific ePharmacy 
"^DD",52.86,52.86,.01,21,2,0)
parameters will be active.
"^DD",52.86,52.86,.01,"DT")
3080522
"^DD",52.86,52.86,1,0)
ALLOW ALL REJECTS^RS^0:NO;1:YES;^0;2^Q
"^DD",52.86,52.86,1,1,0)
^.1
"^DD",52.86,52.86,1,1,1,0)
^^TRIGGER^52.86^2
"^DD",52.86,52.86,1,1,1,1)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(1)=$S($D(^PS(52.86,D0,0)):^(0),1:"") S X=$P(Y(1),U,3),X=X S DIU=X K Y S X=DIV S X=DUZ S DIH=$G(^PS(52.86,DIV(0),0)),DIV=X S $P(^(0),U,3)=DIV,DIH=52.86,DIG=2 D ^DICR
"^DD",52.86,52.86,1,1,1,2)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(1)=$S($D(^PS(52.86,D0,0)):^(0),1:"") S X=$P(Y(1),U,3),X=X S DIU=X K Y S X=DIV S X=DUZ S DIH=$G(^PS(52.86,DIV(0),0)),DIV=X S $P(^(0),U,3)=DIV,DIH=52.86,DIG=2 D ^DICR
"^DD",52.86,52.86,1,1,1,"%D",0)
^.101^2^2^3080610^^^^
"^DD",52.86,52.86,1,1,1,"%D",1,0)
This trigger is used to set the User ID of the person who lasted edited
"^DD",52.86,52.86,1,1,1,"%D",2,0)
the ALLOW ALL REJECTS field (#1).
"^DD",52.86,52.86,1,1,1,"CREATE VALUE")
S X=DUZ
"^DD",52.86,52.86,1,1,1,"DELETE VALUE")
S X=DUZ
"^DD",52.86,52.86,1,1,1,"DT")
3080522
"^DD",52.86,52.86,1,1,1,"FIELD")
USER
"^DD",52.86,52.86,1,1,2,0)
^^TRIGGER^52.86^3
"^DD",52.86,52.86,1,1,2,1)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(1)=$S($D(^PS(52.86,D0,0)):^(0),1:"") S X=$P(Y(1),U,4),X=X S DIU=X K Y S X=DIV S %=$P($H,",",2),X=DT_(%\60#60/100+(%\3600)+(%#60/10000)/100) X ^DD(52.86,1,1,2,1.4)
"^DD",52.86,52.86,1,1,2,1.4)
S DIH=$G(^PS(52.86,DIV(0),0)),DIV=X S $P(^(0),U,4)=DIV,DIH=52.86,DIG=3 D ^DICR
"^DD",52.86,52.86,1,1,2,2)
K DIV S DIV=X,D0=DA,DIV(0)=D0 S Y(1)=$S($D(^PS(52.86,D0,0)):^(0),1:"") S X=$P(Y(1),U,4),X=X S DIU=X K Y S X=DIV S %=$P($H,",",2),X=DT_(%\60#60/100+(%\3600)+(%#60/10000)/100) X ^DD(52.86,1,1,2,2.4)
"^DD",52.86,52.86,1,1,2,2.4)
S DIH=$G(^PS(52.86,DIV(0),0)),DIV=X S $P(^(0),U,4)=DIV,DIH=52.86,DIG=3 D ^DICR
"^DD",52.86,52.86,1,1,2,"%D",0)
^.101^2^2^3080610^^^^
"^DD",52.86,52.86,1,1,2,"%D",1,0)
This trigger is used to set the date and time that the ALLOW ALL REJECTS
"^DD",52.86,52.86,1,1,2,"%D",2,0)
field (#1) was entered or edited.
"^DD",52.86,52.86,1,1,2,"CREATE VALUE")
NOW
"^DD",52.86,52.86,1,1,2,"DELETE VALUE")
NOW
"^DD",52.86,52.86,1,1,2,"DT")
3080522
"^DD",52.86,52.86,1,1,2,"FIELD")
DATE
"^DD",52.86,52.86,1,3)
Enter Y for yes to automatically place ALL ePharmacy claims rejections on the Pharmacy Reject Worklist or N for no to not do so.
"^DD",52.86,52.86,1,21,0)
^.001^7^7^3080610^^^^
"^DD",52.86,52.86,1,21,1,0)
Answering yes to this field will signify that all prescription
"^DD",52.86,52.86,1,21,2,0)
fills with ePharmacy rejected claims will automatically be 
"^DD",52.86,52.86,1,21,3,0)
placed on the Third Party Payer Rejects - Worklist, also known
"^DD",52.86,52.86,1,21,4,0)
as Pharmacy Reject Worklist.  This is in addition to 
"^DD",52.86,52.86,1,21,5,0)
Refill-Too-Soon (79), Drug Utilization Review (DUR/88) and 
"^DD",52.86,52.86,1,21,6,0)
Tricare rejects which are automatically placed on the Pharmacy
"^DD",52.86,52.86,1,21,7,0)
Reject Worklist.
"^DD",52.86,52.86,1,23,0)
^.001^6^6^3080610^^^
"^DD",52.86,52.86,1,23,1,0)
Any individually defined reject codes in the REJECT CODE multiple
"^DD",52.86,52.86,1,23,2,0)
(#52.8651) will be overridden by this field when the value is yes, but
"^DD",52.86,52.86,1,23,3,0)
those values will not be deleted.
"^DD",52.86,52.86,1,23,4,0)
 
"^DD",52.86,52.86,1,23,5,0)
A value entered into this field triggers the population of USER field 
"^DD",52.86,52.86,1,23,6,0)
(#2) and DATE OF LAST UPDATE field (#3).
"^DD",52.86,52.86,1,"AUDIT")

"^DD",52.86,52.86,1,"AX")

"^DD",52.86,52.86,1,"DT")
3080522
"^DD",52.86,52.86,2,0)
USER^P200'^VA(200,^0;3^Q
"^DD",52.86,52.86,2,3)
Enter the user who last updated the ALLOW ALL REJECTS field.
"^DD",52.86,52.86,2,5,1,0)
52.86^1^1
"^DD",52.86,52.86,2,9)
^
"^DD",52.86,52.86,2,21,0)
^.001^1^1^3080610^^
"^DD",52.86,52.86,2,21,1,0)
This is the user who last updated the ALLOW ALL REJECTS field.
"^DD",52.86,52.86,2,23,0)
^.001^3^3^3080610^^^^
"^DD",52.86,52.86,2,23,1,0)
This field is populated via a trigger on the ALLOW ALL REJECTS field (#1) 
"^DD",52.86,52.86,2,23,2,0)
in this file, and it serves as an audit of the last user who modified 
"^DD",52.86,52.86,2,23,3,0)
that field.
"^DD",52.86,52.86,2,"DT")
3080507
"^DD",52.86,52.86,3,0)
DATE OF LAST UPDATE^D^^0;4^S %DT="ETXR" D ^%DT S X=Y K:Y<1 X
"^DD",52.86,52.86,3,3)
Enter the date and time the ALLOW ALL REJECTS field was edited.
"^DD",52.86,52.86,3,5,1,0)
52.86^1^2
"^DD",52.86,52.86,3,9)
^
"^DD",52.86,52.86,3,21,0)
^.001^2^2^3080610^^
"^DD",52.86,52.86,3,21,1,0)
This field contains the date/time that the ALLOW ALL REJECTS 
"^DD",52.86,52.86,3,21,2,0)
field was last updated.
"^DD",52.86,52.86,3,23,0)
^.001^3^3^3080610^^
"^DD",52.86,52.86,3,23,1,0)
This field provides an audit of the date/time that the ALLOW ALL REJECTS 
"^DD",52.86,52.86,3,23,2,0)
field (#1) was added or edited. It is populated via a trigger on CODE 
"^DD",52.86,52.86,3,23,3,0)
field (#.01) of the REJECT CODE multiple (#52.8651) of this file.
"^DD",52.86,52.86,3,"DT")
3080610
"^DD",52.86,52.86,4,0)
REJECT WORKLIST DAYS^NJ2,0^^3;1^K:+X'=X!(X>30)!(X<1)!(X?.E1"."1N.N) X
"^DD",52.86,52.86,4,3)
Type a Number between 1 and 30, 0 Decimal Digits
"^DD",52.86,52.86,4,21,0)
^^3^3^3080430^
"^DD",52.86,52.86,4,21,1,0)
The number of days an uncommented reject can remain on the reject
"^DD",52.86,52.86,4,21,2,0)
worklist without being included in the nightly reject worklist alert
"^DD",52.86,52.86,4,21,3,0)
mail message.
"^DD",52.86,52.86,4,23,0)
^^1^1^3080430^
"^DD",52.86,52.86,4,23,1,0)
If this field is empty, the alert will use 5.
"^DD",52.86,52.86,4,"DT")
3080430
"^DD",52.86,52.86,52.8651,0)
REJECT CODE^52.8651PA^^1;0
"^DD",52.86,52.86,52.8651,21,0)
^.001^3^3^3080611^^^^
"^DD",52.86,52.86,52.8651,21,1,0)
This multiple contains all reject codes other than DUR and
"^DD",52.86,52.86,52.8651,21,2,0)
refill-too-soon that will be allowed to be placed on the
"^DD",52.86,52.86,52.8651,21,3,0)
Pharmacy Reject Worklist.
"^DD",52.86,52.86,52.8651,"DT")
3080429
"^DD",52.86,52.8651,0)
REJECT CODE SUB-FIELD^^3^4
"^DD",52.86,52.8651,0,"DT")
3080522
"^DD",52.86,52.8651,0,"IX","B",52.8651,.01)

"^DD",52.86,52.8651,0,"NM","REJECT CODE")

"^DD",52.86,52.8651,0,"UP")
52.86
"^DD",52.86,52.8651,.01,0)
CODE^MP9002313.93'X^BPSF(9002313.93,^0;1^Q
"^DD",52.86,52.8651,.01,.1)
REJECT CODES
"^DD",52.86,52.8651,.01,1,0)
^.1
"^DD",52.86,52.8651,.01,1,1,0)
^^TRIGGER^52.8651^2
"^DD",52.86,52.8651,.01,1,1,1)
K DIV S DIV=X,D0=DA(1),DIV(0)=D0,D1=DA,DIV(1)=D1 S Y(1)=$S($D(^PS(52.86,D0,1,D1,0)):^(0),1:"") S X=$P(Y(1),U,3),X=X S DIU=X K Y S X=DIV S:$G(DUZ) X=DUZ X ^DD(52.8651,.01,1,1,1.4)
"^DD",52.86,52.8651,.01,1,1,1.4)
S DIH=$G(^PS(52.86,DIV(0),1,DIV(1),0)),DIV=X S $P(^(0),U,3)=DIV,DIH=52.8651,DIG=2 D ^DICR
"^DD",52.86,52.8651,.01,1,1,2)
K DIV S DIV=X,D0=DA(1),DIV(0)=D0,D1=DA,DIV(1)=D1 S Y(1)=$S($D(^PS(52.86,D0,1,D1,0)):^(0),1:"") S X=$P(Y(1),U,3),X=X S DIU=X K Y S X=DIV S:$G(DUZ) X=DUZ X ^DD(52.8651,.01,1,1,2.4)
"^DD",52.86,52.8651,.01,1,1,2.4)
S DIH=$G(^PS(52.86,DIV(0),1,DIV(1),0)),DIV=X S $P(^(0),U,3)=DIV,DIH=52.8651,DIG=2 D ^DICR
"^DD",52.86,52.8651,.01,1,1,"%D",0)
^.101^2^2^3080610^^^^
"^DD",52.86,52.8651,.01,1,1,"%D",1,0)
This trigger is used to set the User ID of the person who lasted edited
"^DD",52.86,52.8651,.01,1,1,"%D",2,0)
the third party reject code.
"^DD",52.86,52.8651,.01,1,1,"CREATE VALUE")
S:$G(DUZ) X=DUZ
"^DD",52.86,52.8651,.01,1,1,"DELETE VALUE")
S:$G(DUZ) X=DUZ
"^DD",52.86,52.8651,.01,1,1,"DT")
3080522
"^DD",52.86,52.8651,.01,1,1,"FIELD")
USER
"^DD",52.86,52.8651,.01,1,2,0)
^^TRIGGER^52.8651^3
"^DD",52.86,52.8651,.01,1,2,1)
K DIV S DIV=X,D0=DA(1),DIV(0)=D0,D1=DA,DIV(1)=D1 S Y(1)=$S($D(^PS(52.86,D0,1,D1,0)):^(0),1:"") S X=$P(Y(1),U,4),X=X S DIU=X K Y S X=DIV S %=$P($H,",",2),X=DT_(%\60#60/100+(%\3600)+(%#60/10000)/100) X ^DD(52.8651,.01,1,2,1.4)
"^DD",52.86,52.8651,.01,1,2,1.4)
S DIH=$G(^PS(52.86,DIV(0),1,DIV(1),0)),DIV=X S $P(^(0),U,4)=DIV,DIH=52.8651,DIG=3 D ^DICR
"^DD",52.86,52.8651,.01,1,2,2)
K DIV S DIV=X,D0=DA(1),DIV(0)=D0,D1=DA,DIV(1)=D1 S Y(1)=$S($D(^PS(52.86,D0,1,D1,0)):^(0),1:"") S X=$P(Y(1),U,4),X=X S DIU=X K Y S X=DIV S %=$P($H,",",2),X=DT_(%\60#60/100+(%\3600)+(%#60/10000)/100) X ^DD(52.8651,.01,1,2,2.4)
"^DD",52.86,52.8651,.01,1,2,2.4)
S DIH=$G(^PS(52.86,DIV(0),1,DIV(1),0)),DIV=X S $P(^(0),U,4)=DIV,DIH=52.8651,DIG=3 D ^DICR
"^DD",52.86,52.8651,.01,1,2,"%D",0)
^.101^2^2^3080610^^
"^DD",52.86,52.8651,.01,1,2,"%D",1,0)
Trigger to set the DATE OF LAST UPDATE field when a third party reject
"^DD",52.86,52.8651,.01,1,2,"%D",2,0)
code is entered.
"^DD",52.86,52.8651,.01,1,2,"CREATE VALUE")
NOW
"^DD",52.86,52.8651,.01,1,2,"DELETE VALUE")
NOW
"^DD",52.86,52.8651,.01,1,2,"DT")
3080522
"^DD",52.86,52.8651,.01,1,2,"FIELD")
DATE
"^DD",52.86,52.8651,.01,1,3,0)
52.8651^B
"^DD",52.86,52.8651,.01,1,3,1)
S ^PS(52.86,DA(1),1,"B",$E(X,1,30),DA)=""
"^DD",52.86,52.8651,.01,1,3,2)
K ^PS(52.86,DA(1),1,"B",$E(X,1,30),DA)
"^DD",52.86,52.8651,.01,1,3,"DT")
3080522
"^DD",52.86,52.8651,.01,3)
Enter a valid third party claim reject code.
"^DD",52.86,52.8651,.01,4)
D HELP^PSOBPSSP
"^DD",52.86,52.8651,.01,21,0)
^.001^3^3^3080611^^
"^DD",52.86,52.8651,.01,21,1,0)
A valid third party claim reject code should be entered.  A listing
"^DD",52.86,52.8651,.01,21,2,0)
of these codes is provided when double question marks are entered 
"^DD",52.86,52.8651,.01,21,3,0)
for this field.
"^DD",52.86,52.8651,.01,23,0)
^^4^4^3080611^
"^DD",52.86,52.8651,.01,23,1,0)
This field can contain any reject code from BPS NCPDP REJECT
"^DD",52.86,52.8651,.01,23,2,0)
CODES file (#900231.93).  Also, a value defined in this field
"^DD",52.86,52.8651,.01,23,3,0)
triggers definition of USER field (#2) and DATE OF LAST UPDATE
"^DD",52.86,52.8651,.01,23,4,0)
field (#3).
"^DD",52.86,52.8651,.01,"DT")
3080522
"^DD",52.86,52.8651,1,0)
AUTO SEND^RS^0:NO;1:YES;^0;2^Q
"^DD",52.86,52.8651,1,1,0)
^.1
"^DD",52.86,52.8651,1,1,1,0)
^^TRIGGER^52.8651^2
"^DD",52.86,52.8651,1,1,1,1)
K DIV S DIV=X,D0=DA(1),DIV(0)=D0,D1=DA,DIV(1)=D1 S Y(1)=$S($D(^PS(52.86,D0,1,D1,0)):^(0),1:"") S X=$P(Y(1),U,3),X=X S DIU=X K Y S X=DIV S:$G(DUZ) X=DUZ X ^DD(52.8651,1,1,1,1.4)
"^DD",52.86,52.8651,1,1,1,1.4)
S DIH=$G(^PS(52.86,DIV(0),1,DIV(1),0)),DIV=X S $P(^(0),U,3)=DIV,DIH=52.8651,DIG=2 D ^DICR
"^DD",52.86,52.8651,1,1,1,2)
K DIV S DIV=X,D0=DA(1),DIV(0)=D0,D1=DA,DIV(1)=D1 S Y(1)=$S($D(^PS(52.86,D0,1,D1,0)):^(0),1:"") S X=$P(Y(1),U,3),X=X S DIU=X K Y S X=DIV S:$G(DUZ) X=DUZ X ^DD(52.8651,1,1,1,2.4)
"^DD",52.86,52.8651,1,1,1,2.4)
S DIH=$G(^PS(52.86,DIV(0),1,DIV(1),0)),DIV=X S $P(^(0),U,3)=DIV,DIH=52.8651,DIG=2 D ^DICR
"^DD",52.86,52.8651,1,1,1,"%D",0)
^.101^2^2^3080610^^
"^DD",52.86,52.8651,1,1,1,"%D",1,0)
This trigger is used to set the User ID of the person who lasted edited
"^DD",52.86,52.8651,1,1,1,"%D",2,0)
the AUTO SEND field.
"^DD",52.86,52.8651,1,1,1,"CREATE VALUE")
S:$G(DUZ) X=DUZ
"^DD",52.86,52.8651,1,1,1,"DELETE VALUE")
S:$G(DUZ) X=DUZ
"^DD",52.86,52.8651,1,1,1,"FIELD")
USER
"^DD",52.86,52.8651,1,1,2,0)
^^TRIGGER^52.8651^3
"^DD",52.86,52.8651,1,1,2,1)
K DIV S DIV=X,D0=DA(1),DIV(0)=D0,D1=DA,DIV(1)=D1 S Y(1)=$S($D(^PS(52.86,D0,1,D1,0)):^(0),1:"") S X=$P(Y(1),U,4),X=X S DIU=X K Y S X=DIV S %=$P($H,",",2),X=DT_(%\60#60/100+(%\3600)+(%#60/10000)/100) X ^DD(52.8651,1,1,2,1.4)
"^DD",52.86,52.8651,1,1,2,1.4)
S DIH=$G(^PS(52.86,DIV(0),1,DIV(1),0)),DIV=X S $P(^(0),U,4)=DIV,DIH=52.8651,DIG=3 D ^DICR
"^DD",52.86,52.8651,1,1,2,2)
K DIV S DIV=X,D0=DA(1),DIV(0)=D0,D1=DA,DIV(1)=D1 S Y(1)=$S($D(^PS(52.86,D0,1,D1,0)):^(0),1:"") S X=$P(Y(1),U,4),X=X S DIU=X K Y S X=DIV S %=$P($H,",",2),X=DT_(%\60#60/100+(%\3600)+(%#60/10000)/100) X ^DD(52.8651,1,1,2,2.4)
"^DD",52.86,52.8651,1,1,2,2.4)
S DIH=$G(^PS(52.86,DIV(0),1,DIV(1),0)),DIV=X S $P(^(0),U,4)=DIV,DIH=52.8651,DIG=3 D ^DICR
"^DD",52.86,52.8651,1,1,2,"%D",0)
^^2^2^3080610^
"^DD",52.86,52.8651,1,1,2,"%D",1,0)
This trigger is used to set the date that the AUTO SEND field was lasted 
"^DD",52.86,52.8651,1,1,2,"%D",2,0)
updated.
"^DD",52.86,52.8651,1,1,2,"CREATE VALUE")
NOW
"^DD",52.86,52.8651,1,1,2,"DELETE VALUE")
NOW
"^DD",52.86,52.8651,1,1,2,"DT")
3080522
"^DD",52.86,52.8651,1,1,2,"FIELD")
DATE
"^DD",52.86,52.8651,1,3)
Enter Yes for auto update or No for requires OPECC intervention.
"^DD",52.86,52.8651,1,21,0)
^.001^5^5^3080522^^^^
"^DD",52.86,52.8651,1,21,1,0)
Enter YES to allow the third party claim reject code to be 
"^DD",52.86,52.8651,1,21,2,0)
automatically placed on the Pharmacy Reject Worklist or NO
"^DD",52.86,52.8651,1,21,3,0)
to require Outpatient Pharmacy Electronic Claims 
"^DD",52.86,52.8651,1,21,4,0)
Coordinator (OPECC) intervention to do so.  A null value
"^DD",52.86,52.8651,1,21,5,0)
will be treated the same as entering NO in this field.
"^DD",52.86,52.8651,1,23,0)
^.001^2^2^3080522^^
"^DD",52.86,52.8651,1,23,1,0)
Any individually defined codes will be overridden
"^DD",52.86,52.8651,1,23,2,0)
when the ALLOW ALL REJECTS field (#1) is defined as YES.
"^DD",52.86,52.8651,1,"DT")
3080522
"^DD",52.86,52.8651,2,0)
USER^P200'^VA(200,^0;3^Q
"^DD",52.86,52.8651,2,3)
Enter the User who entered or edited the third party reject code information.
"^DD",52.86,52.8651,2,5,1,0)
52.8651^.01^1
"^DD",52.86,52.8651,2,5,2,0)
52.8651^1^1
"^DD",52.86,52.8651,2,9)
^
"^DD",52.86,52.8651,2,21,0)
^.001^2^2^3080610^^^
"^DD",52.86,52.8651,2,21,1,0)
This is the user who last updated information for the third party
"^DD",52.86,52.8651,2,21,2,0)
reject code.
"^DD",52.86,52.8651,2,23,0)
^.001^2^2^3080610^^^^
"^DD",52.86,52.8651,2,23,1,0)
This field contains the user IEN of the person who last updated
"^DD",52.86,52.8651,2,23,2,0)
the third party reject code.
"^DD",52.86,52.8651,2,"DT")
3080430
"^DD",52.86,52.8651,3,0)
DATE OF LAST UPDATE^D^^0;4^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",52.86,52.8651,3,3)
Enter date and time.
"^DD",52.86,52.8651,3,5,1,0)
52.8651^.01^2
"^DD",52.86,52.8651,3,5,2,0)
52.8651^1^2
"^DD",52.86,52.8651,3,9)
^
"^DD",52.86,52.8651,3,21,0)
^.001^2^2^3080610^^
"^DD",52.86,52.8651,3,21,1,0)
This is the date/time that the third party reject code was
"^DD",52.86,52.8651,3,21,2,0)
added or updated.
"^DD",52.86,52.8651,3,23,0)
^.001^2^2^3080610^^^^
"^DD",52.86,52.8651,3,23,1,0)
This field provides an audit of the date/time the CODE field (#1)
"^DD",52.86,52.8651,3,23,2,0)
was last updated.
"^DD",52.86,52.8651,3,"DT")
3080430
"^DIC",52.86,52.86,0)
EPHARMACY SITE PARAMETERS^52.86
"^DIC",52.86,52.86,0,"GL")
^PS(52.86,
"^DIC",52.86,52.86,"%",0)
^1.005^1^1
"^DIC",52.86,52.86,"%",1,0)
PSO
"^DIC",52.86,52.86,"%","B","PSO",1)

"^DIC",52.86,"B","EPHARMACY SITE PARAMETERS",52.86)

**INSTALL NAME**
IB*2.0*384
"BLD",7384,0)
IB*2.0*384^INTEGRATED BILLING^0^3090615^y
"BLD",7384,1,0)
^^1^1^3080528^
"BLD",7384,1,1,0)
E-PHARMACY ENHANCEMENTS
"BLD",7384,4,0)
^9.64PA^399^4
"BLD",7384,4,350.9,0)
350.9
"BLD",7384,4,350.9,2,0)
^9.641^350.912^2
"BLD",7384,4,350.9,2,350.9,0)
IB SITE PARAMETERS  (File-top level)
"BLD",7384,4,350.9,2,350.9,1,0)
^9.6411^11.02^1
"BLD",7384,4,350.9,2,350.9,1,11.02,0)
DRUG NONCOVERED RECHECK PERIOD
"BLD",7384,4,350.9,2,350.912,0)
NON COVERED REJECT CODES  (sub-file)
"BLD",7384,4,350.9,2,350.912,1,0)
^9.6411^^0
"BLD",7384,4,350.9,222)
y^n^p^^^^n^^n
"BLD",7384,4,350.9,224)

"BLD",7384,4,356.25,0)
356.25
"BLD",7384,4,356.25,222)
y^n^f^^^^n
"BLD",7384,4,366.16,0)
366.16
"BLD",7384,4,366.16,222)
y^n^f^^^^n
"BLD",7384,4,399,0)
399
"BLD",7384,4,399,2,0)
^9.641^399^1
"BLD",7384,4,399,2,399,0)
BILL/CLAIMS  (File-top level)
"BLD",7384,4,399,2,399,1,0)
^9.6411^157^1
"BLD",7384,4,399,2,399,1,157,0)
R.O.I. FORM(S) COMPLETED?
"BLD",7384,4,399,222)
y^n^p^^^^n^^n
"BLD",7384,4,399,224)

"BLD",7384,4,"APDD",350.9,350.9)

"BLD",7384,4,"APDD",350.9,350.9,11.02)

"BLD",7384,4,"APDD",350.9,350.912)

"BLD",7384,4,"APDD",399,399)

"BLD",7384,4,"APDD",399,399,157)

"BLD",7384,4,"B",350.9,350.9)

"BLD",7384,4,"B",356.25,356.25)

"BLD",7384,4,"B",366.16,366.16)

"BLD",7384,4,"B",399,399)

"BLD",7384,6.3)
74
"BLD",7384,"ABPKG")
n
"BLD",7384,"INID")
^n
"BLD",7384,"INIT")
POST^IB20P384
"BLD",7384,"KRN",0)
^9.67PA^8989.52^19
"BLD",7384,"KRN",.4,0)
.4
"BLD",7384,"KRN",.401,0)
.401
"BLD",7384,"KRN",.402,0)
.402
"BLD",7384,"KRN",.402,"NM",0)
^9.68A^^
"BLD",7384,"KRN",.403,0)
.403
"BLD",7384,"KRN",.5,0)
.5
"BLD",7384,"KRN",.84,0)
.84
"BLD",7384,"KRN",3.6,0)
3.6
"BLD",7384,"KRN",3.8,0)
3.8
"BLD",7384,"KRN",9.2,0)
9.2
"BLD",7384,"KRN",9.8,0)
9.8
"BLD",7384,"KRN",9.8,"NM",0)
^9.68A^52^41
"BLD",7384,"KRN",9.8,"NM",1,0)
IBNCPDPI^^0^B7116772
"BLD",7384,"KRN",9.8,"NM",2,0)
IBJTCA1^^0^B47734103
"BLD",7384,"KRN",9.8,"NM",4,0)
IBNCDNC^^0^B7190363
"BLD",7384,"KRN",9.8,"NM",10,0)
IB20P384^^0^B34256888
"BLD",7384,"KRN",9.8,"NM",11,0)
IBNCPDP1^^0^B62284917
"BLD",7384,"KRN",9.8,"NM",12,0)
IBNCPBB^^0^B87491341
"BLD",7384,"KRN",9.8,"NM",13,0)
IBNCPDR^^0^B7723137
"BLD",7384,"KRN",9.8,"NM",14,0)
IBNCPDR1^^0^B4262134
"BLD",7384,"KRN",9.8,"NM",15,0)
IBNCPDR2^^0^B8736079
"BLD",7384,"KRN",9.8,"NM",16,0)
IBNCPDR4^^0^B32682440
"BLD",7384,"KRN",9.8,"NM",17,0)
IBNCPDR5^^0^B9016417
"BLD",7384,"KRN",9.8,"NM",18,0)
IBCBB1^^0^B72688329
"BLD",7384,"KRN",9.8,"NM",19,0)
IBNCPDP2^^0^B58655489
"BLD",7384,"KRN",9.8,"NM",20,0)
IBNCPDPU^^0^B71731167
"BLD",7384,"KRN",9.8,"NM",23,0)
IBOSCDC^^0^B46124524
"BLD",7384,"KRN",9.8,"NM",24,0)
IBTRKR3^^0^B54376358
"BLD",7384,"KRN",9.8,"NM",25,0)
IBNCPEV^^0^B85988869
"BLD",7384,"KRN",9.8,"NM",26,0)
IBNCPDPC^^0^B5201665
"BLD",7384,"KRN",9.8,"NM",27,0)
IBNCPDPE^^0^B17129560
"BLD",7384,"KRN",9.8,"NM",28,0)
IBNCPDPH^^0^B26345635
"BLD",7384,"KRN",9.8,"NM",29,0)
IBNCPDPL^^0^B647455
"BLD",7384,"KRN",9.8,"NM",30,0)
IBNCPDPR^^0^B26651365
"BLD",7384,"KRN",9.8,"NM",31,0)
IBNCDNC1^^0^B21625955
"BLD",7384,"KRN",9.8,"NM",32,0)
IBNCPDP6^^0^B12692205
"BLD",7384,"KRN",9.8,"NM",33,0)
IBNCPUT1^^0^B20040520
"BLD",7384,"KRN",9.8,"NM",34,0)
IBTUTL1^^0^B60382231
"BLD",7384,"KRN",9.8,"NM",36,0)
IBCBB11^^0^B25129928
"BLD",7384,"KRN",9.8,"NM",37,0)
IBCD2^^0^B27925323
"BLD",7384,"KRN",9.8,"NM",38,0)
IBCD3^^0^B31598371
"BLD",7384,"KRN",9.8,"NM",39,0)
IBNCPDP4^^0^B49164947
"BLD",7384,"KRN",9.8,"NM",41,0)
IBNCPBB1^^0^B4732084
"BLD",7384,"KRN",9.8,"NM",42,0)
IBNCPNB^^0^B37701881
"BLD",7384,"KRN",9.8,"NM",43,0)
IBNCPDP3^^0^B30631647
"BLD",7384,"KRN",9.8,"NM",44,0)
IBCU^^0^B57580772
"BLD",7384,"KRN",9.8,"NM",45,0)
IBOSCDC1^^0^B17599955
"BLD",7384,"KRN",9.8,"NM",47,0)
IBJPS^^0^B5156185
"BLD",7384,"KRN",9.8,"NM",48,0)
IBJPS1^^0^B15675647
"BLD",7384,"KRN",9.8,"NM",49,0)
IBJPS2^^0^B41372585
"BLD",7384,"KRN",9.8,"NM",50,0)
IBBFAPI^^0^B42412028
"BLD",7384,"KRN",9.8,"NM",51,0)
IBBDOC^^0^B683097
"BLD",7384,"KRN",9.8,"NM",52,0)
IBNCPDP^^0^B5165020
"BLD",7384,"KRN",9.8,"NM","B","IB20P384",10)

"BLD",7384,"KRN",9.8,"NM","B","IBBDOC",51)

"BLD",7384,"KRN",9.8,"NM","B","IBBFAPI",50)

"BLD",7384,"KRN",9.8,"NM","B","IBCBB1",18)

"BLD",7384,"KRN",9.8,"NM","B","IBCBB11",36)

"BLD",7384,"KRN",9.8,"NM","B","IBCD2",37)

"BLD",7384,"KRN",9.8,"NM","B","IBCD3",38)

"BLD",7384,"KRN",9.8,"NM","B","IBCU",44)

"BLD",7384,"KRN",9.8,"NM","B","IBJPS",47)

"BLD",7384,"KRN",9.8,"NM","B","IBJPS1",48)

"BLD",7384,"KRN",9.8,"NM","B","IBJPS2",49)

"BLD",7384,"KRN",9.8,"NM","B","IBJTCA1",2)

"BLD",7384,"KRN",9.8,"NM","B","IBNCDNC",4)

"BLD",7384,"KRN",9.8,"NM","B","IBNCDNC1",31)

"BLD",7384,"KRN",9.8,"NM","B","IBNCPBB",12)

"BLD",7384,"KRN",9.8,"NM","B","IBNCPBB1",41)

"BLD",7384,"KRN",9.8,"NM","B","IBNCPDP",52)

"BLD",7384,"KRN",9.8,"NM","B","IBNCPDP1",11)

"BLD",7384,"KRN",9.8,"NM","B","IBNCPDP2",19)

"BLD",7384,"KRN",9.8,"NM","B","IBNCPDP3",43)

"BLD",7384,"KRN",9.8,"NM","B","IBNCPDP4",39)

"BLD",7384,"KRN",9.8,"NM","B","IBNCPDP6",32)

"BLD",7384,"KRN",9.8,"NM","B","IBNCPDPC",26)

"BLD",7384,"KRN",9.8,"NM","B","IBNCPDPE",27)

"BLD",7384,"KRN",9.8,"NM","B","IBNCPDPH",28)

"BLD",7384,"KRN",9.8,"NM","B","IBNCPDPI",1)

"BLD",7384,"KRN",9.8,"NM","B","IBNCPDPL",29)

"BLD",7384,"KRN",9.8,"NM","B","IBNCPDPR",30)

"BLD",7384,"KRN",9.8,"NM","B","IBNCPDPU",20)

"BLD",7384,"KRN",9.8,"NM","B","IBNCPDR",13)

"BLD",7384,"KRN",9.8,"NM","B","IBNCPDR1",14)

"BLD",7384,"KRN",9.8,"NM","B","IBNCPDR2",15)

"BLD",7384,"KRN",9.8,"NM","B","IBNCPDR4",16)

"BLD",7384,"KRN",9.8,"NM","B","IBNCPDR5",17)

"BLD",7384,"KRN",9.8,"NM","B","IBNCPEV",25)

"BLD",7384,"KRN",9.8,"NM","B","IBNCPNB",42)

"BLD",7384,"KRN",9.8,"NM","B","IBNCPUT1",33)

"BLD",7384,"KRN",9.8,"NM","B","IBOSCDC",23)

"BLD",7384,"KRN",9.8,"NM","B","IBOSCDC1",45)

"BLD",7384,"KRN",9.8,"NM","B","IBTRKR3",24)

"BLD",7384,"KRN",9.8,"NM","B","IBTUTL1",34)

"BLD",7384,"KRN",19,0)
19
"BLD",7384,"KRN",19,"NM",0)
^9.68A^6^5
"BLD",7384,"KRN",19,"NM",1,0)
IBCNR RELEASE OF INFORMATION^^0
"BLD",7384,"KRN",19,"NM",2,0)
IB SC DETERMINATION CHANGE RPT^^0
"BLD",7384,"KRN",19,"NM",3,0)
IB OUTPUT PATIENT REPORT MENU^^2
"BLD",7384,"KRN",19,"NM",4,0)
IBCNR E-PHARMACY MENU^^2
"BLD",7384,"KRN",19,"NM",6,0)
IB DRUGS NON COVERED REPORT^^0
"BLD",7384,"KRN",19,"NM","B","IB DRUGS NON COVERED REPORT",6)

"BLD",7384,"KRN",19,"NM","B","IB OUTPUT PATIENT REPORT MENU",3)

"BLD",7384,"KRN",19,"NM","B","IB SC DETERMINATION CHANGE RPT",2)

"BLD",7384,"KRN",19,"NM","B","IBCNR E-PHARMACY MENU",4)

"BLD",7384,"KRN",19,"NM","B","IBCNR RELEASE OF INFORMATION",1)

"BLD",7384,"KRN",19.1,0)
19.1
"BLD",7384,"KRN",19.1,"NM",0)
^9.68A^1^1
"BLD",7384,"KRN",19.1,"NM",1,0)
IBCNR ROI^^0
"BLD",7384,"KRN",19.1,"NM","B","IBCNR ROI",1)

"BLD",7384,"KRN",101,0)
101
"BLD",7384,"KRN",101,"NM",0)
^9.68A^5^5
"BLD",7384,"KRN",101,"NM",1,0)
IBNCR ADD ROI^^0
"BLD",7384,"KRN",101,"NM",2,0)
IBNCR EDIT ROI INFO^^0
"BLD",7384,"KRN",101,"NM",3,0)
IBNCR PATIENT ROI^^0
"BLD",7384,"KRN",101,"NM",4,0)
IBNCR ROI EXP MENU^^0
"BLD",7384,"KRN",101,"NM",5,0)
IBNCR VIEWEDIT ROI^^0
"BLD",7384,"KRN",101,"NM","B","IBNCR ADD ROI",1)

"BLD",7384,"KRN",101,"NM","B","IBNCR EDIT ROI INFO",2)

"BLD",7384,"KRN",101,"NM","B","IBNCR PATIENT ROI",3)

"BLD",7384,"KRN",101,"NM","B","IBNCR ROI EXP MENU",4)

"BLD",7384,"KRN",101,"NM","B","IBNCR VIEWEDIT ROI",5)

"BLD",7384,"KRN",409.61,0)
409.61
"BLD",7384,"KRN",409.61,"NM",0)
^9.68A^2^2
"BLD",7384,"KRN",409.61,"NM",1,0)
IBNCR EXPANDED ROI^^0
"BLD",7384,"KRN",409.61,"NM",2,0)
IBNCR PATIENT RELEASE OF INFO^^0
"BLD",7384,"KRN",409.61,"NM","B","IBNCR EXPANDED ROI",1)

"BLD",7384,"KRN",409.61,"NM","B","IBNCR PATIENT RELEASE OF INFO",2)

"BLD",7384,"KRN",771,0)
771
"BLD",7384,"KRN",771,"NM",0)
^9.68A^^
"BLD",7384,"KRN",870,0)
870
"BLD",7384,"KRN",8989.51,0)
8989.51
"BLD",7384,"KRN",8989.52,0)
8989.52
"BLD",7384,"KRN",8994,0)
8994
"BLD",7384,"KRN","B",.4,.4)

"BLD",7384,"KRN","B",.401,.401)

"BLD",7384,"KRN","B",.402,.402)

"BLD",7384,"KRN","B",.403,.403)

"BLD",7384,"KRN","B",.5,.5)

"BLD",7384,"KRN","B",.84,.84)

"BLD",7384,"KRN","B",3.6,3.6)

"BLD",7384,"KRN","B",3.8,3.8)

"BLD",7384,"KRN","B",9.2,9.2)

"BLD",7384,"KRN","B",9.8,9.8)

"BLD",7384,"KRN","B",19,19)

"BLD",7384,"KRN","B",19.1,19.1)

"BLD",7384,"KRN","B",101,101)

"BLD",7384,"KRN","B",409.61,409.61)

"BLD",7384,"KRN","B",771,771)

"BLD",7384,"KRN","B",870,870)

"BLD",7384,"KRN","B",8989.51,8989.51)

"BLD",7384,"KRN","B",8989.52,8989.52)

"BLD",7384,"KRN","B",8994,8994)

"BLD",7384,"QDEF")
^^^^NO^^^^NO
"BLD",7384,"QUES",0)
^9.62^^
"BLD",7384,"REQB",0)
^9.611^5^5
"BLD",7384,"REQB",1,0)
IB*2.0*292^2
"BLD",7384,"REQB",2,0)
IB*2.0*377^2
"BLD",7384,"REQB",3,0)
IB*2.0*401^2
"BLD",7384,"REQB",4,0)
IB*2.0*405^2
"BLD",7384,"REQB",5,0)
IB*2.0*361^2
"BLD",7384,"REQB","B","IB*2.0*292",1)

"BLD",7384,"REQB","B","IB*2.0*361",5)

"BLD",7384,"REQB","B","IB*2.0*377",2)

"BLD",7384,"REQB","B","IB*2.0*401",3)

"BLD",7384,"REQB","B","IB*2.0*405",4)

"FIA",350.9)
IB SITE PARAMETERS
"FIA",350.9,0)
^IBE(350.9,
"FIA",350.9,0,0)
350.9I
"FIA",350.9,0,1)
y^n^p^^^^n^^n
"FIA",350.9,0,10)

"FIA",350.9,0,11)

"FIA",350.9,0,"RLRO")

"FIA",350.9,0,"VR")
2.0^IB
"FIA",350.9,350.9)
1
"FIA",350.9,350.9,11.02)

"FIA",350.9,350.9,12)

"FIA",350.9,350.912)
0
"FIA",356.25)
CLAIMS TRACKING ROI
"FIA",356.25,0)
^IBT(356.25,
"FIA",356.25,0,0)
356.25
"FIA",356.25,0,1)
y^n^f^^^^n
"FIA",356.25,0,10)

"FIA",356.25,0,11)

"FIA",356.25,0,"RLRO")

"FIA",356.25,0,"VR")
2.0^IB
"FIA",356.25,356.25)
0
"FIA",366.16)
IB NDC NON COVERED BY PLAN
"FIA",366.16,0)
^IBCNR(366.16,
"FIA",366.16,0,0)
366.16
"FIA",366.16,0,1)
y^n^f^^^^n
"FIA",366.16,0,10)

"FIA",366.16,0,11)

"FIA",366.16,0,"RLRO")

"FIA",366.16,0,"VR")
2.0^IB
"FIA",366.16,366.16)
0
"FIA",399)
BILL/CLAIMS
"FIA",399,0)
^DGCR(399,
"FIA",399,0,0)
399I
"FIA",399,0,1)
y^n^p^^^^n^^n
"FIA",399,0,10)

"FIA",399,0,11)

"FIA",399,0,"RLRO")

"FIA",399,0,"VR")
2.0^IB
"FIA",399,399)
1
"FIA",399,399,157)

"INIT")
POST^IB20P384
"IX",356.25,356.25,"AC",0)
356.25^AC^ROI PATIENT DRUG INSURANCE X-REF^R^^R^IR^I^356.25^^^^^S
"IX",356.25,356.25,"AC",1)
S ^IBT(356.25,"AC",X(1),X(2),X(3),DA)=""
"IX",356.25,356.25,"AC",2)
K ^IBT(356.25,"AC",X(1),X(2),X(3),DA)
"IX",356.25,356.25,"AC",2.5)
K ^IBT(356.25,"AC")
"IX",356.25,356.25,"AC",11.1,0)
^.114IA^3^3
"IX",356.25,356.25,"AC",11.1,1,0)
1^F^356.25^.02^^1^F
"IX",356.25,356.25,"AC",11.1,1,3)

"IX",356.25,356.25,"AC",11.1,2,0)
2^F^356.25^.03^^2^F
"IX",356.25,356.25,"AC",11.1,2,3)

"IX",356.25,356.25,"AC",11.1,3,0)
3^F^356.25^.04^^3^F
"IX",356.25,356.25,"AC",11.1,3,3)

"IX",366.16,366.16,"AC",0)
366.16^AC^NDC AND GROUP PLAN^MU^^R^IR^I^366.16^^^^^S
"IX",366.16,366.16,"AC",.1,0)
^^2^2^3080707^
"IX",366.16,366.16,"AC",.1,1,0)
This index is used to check if the NDC and GROUP PLAN combination is
"IX",366.16,366.16,"AC",.1,2,0)
stored in the file. 
"IX",366.16,366.16,"AC",1)
S ^IBCNR(366.16,"AC",X(1),X(2),X(3),DA)=""
"IX",366.16,366.16,"AC",2)
K ^IBCNR(366.16,"AC",X(1),X(2),X(3),DA)
"IX",366.16,366.16,"AC",2.5)
K ^IBCNR(366.16,"AC")
"IX",366.16,366.16,"AC",11.1,0)
^.114IA^3^3
"IX",366.16,366.16,"AC",11.1,1,0)
1^F^366.16^.01^^1^F
"IX",366.16,366.16,"AC",11.1,2,0)
2^F^366.16^.02^^2^F
"IX",366.16,366.16,"AC",11.1,3,0)
3^F^366.16^.04^^3^F
"IX",366.16,366.16,"AD",0)
366.16^AD^REPORT^MU^^R^IR^I^366.16^^^^^S
"IX",366.16,366.16,"AD",.1,0)
^^1^1^3080707^
"IX",366.16,366.16,"AD",.1,1,0)
This index is used to sort records for the report.
"IX",366.16,366.16,"AD",1)
S ^IBCNR(366.16,"AD",X(1),X(2),X(3),DA)=""
"IX",366.16,366.16,"AD",2)
K ^IBCNR(366.16,"AD",X(1),X(2),X(3))
"IX",366.16,366.16,"AD",2.5)
K ^IBCNR(366.16,"AD")
"IX",366.16,366.16,"AD",11.1,0)
^.114IA^3^3
"IX",366.16,366.16,"AD",11.1,1,0)
1^F^366.16^.01^^1^F
"IX",366.16,366.16,"AD",11.1,2,0)
2^F^366.16^.03^^2^F
"IX",366.16,366.16,"AD",11.1,3,0)
3^F^366.16^.02^^3^F
"KRN",19,2911717,-1)
2^3
"KRN",19,2911717,0)
IB OUTPUT PATIENT REPORT MENU^Patient Billing Reports Menu^^M^520665219^^^^^^^230
"KRN",19,2911717,10,0)
^19.01IP^23^23
"KRN",19,2911717,10,23,0)
2920680^SC
"KRN",19,2911717,10,23,"^")
IB SC DETERMINATION CHANGE RPT
"KRN",19,2911717,"U")
PATIENT BILLING REPORTS MENU
"KRN",19,2919873,-1)
2^4
"KRN",19,2919873,0)
IBCNR E-PHARMACY MENU^e-Pharmacy Menu^^M^568^^^^^^^230
"KRN",19,2919873,10,0)
^19.01IP^16^16
"KRN",19,2919873,10,15,0)
2920679^ROI
"KRN",19,2919873,10,15,"^")
IBCNR RELEASE OF INFORMATION
"KRN",19,2919873,10,16,0)
2920681^NON
"KRN",19,2919873,10,16,"^")
IB DRUGS NON COVERED REPORT
"KRN",19,2919873,"U")
E-PHARMACY MENU
"KRN",19,2920679,-1)
0^1
"KRN",19,2920679,0)
IBCNR RELEASE OF INFORMATION^Patient Release of Information (ROI)^^R^^IBCNR ROI^^^^^^INTEGRATED BILLING
"KRN",19,2920679,1,0)
^19.06^2^2^3080521^^^^
"KRN",19,2920679,1,1,0)
This option allows the tracking of Release of Information
"KRN",19,2920679,1,2,0)
for sensitive diagnosis medications
"KRN",19,2920679,25)
IBNCPDR
"KRN",19,2920679,"U")
PATIENT RELEASE OF INFORMATION
"KRN",19,2920680,-1)
0^2
"KRN",19,2920680,0)
IB SC DETERMINATION CHANGE RPT^Service Connected Determination Change Report^^R^^^^^^^^INTEGRATED BILLING^^
"KRN",19,2920680,1,0)
^^2^2^3080103^
"KRN",19,2920680,1,1,0)
This option creates a report to display patients that have a Service 
"KRN",19,2920680,1,2,0)
Connected determination change for copays being reset.
"KRN",19,2920680,20)

"KRN",19,2920680,25)
SCR^IBOSCDC
"KRN",19,2920680,"U")
SERVICE CONNECTED DETERMINATIO
"KRN",19,2920681,-1)
0^6
"KRN",19,2920681,0)
IB DRUGS NON COVERED REPORT^Drugs non covered report^^R^^^^^^^^
"KRN",19,2920681,1,0)
^^1^1^3080312^
"KRN",19,2920681,1,1,0)
This option will print non covered drugs, plans and dates.
"KRN",19,2920681,25)
RPT^IBNCDNC
"KRN",19,2920681,"U")
DRUGS NON COVERED REPORT
"KRN",19.1,763,-1)
0^1
"KRN",19.1,763,0)
IBCNR ROI^e-Pharmacy ROI Clerk
"KRN",19.1,763,1,0)
^^2^2^3080521^
"KRN",19.1,763,1,1,0)
Assigned to the Release of Information (ROI) Clerk to manage the Claims 
"KRN",19.1,763,1,2,0)
Tracking ROI file (#356.25)
"KRN",101,7328,-1)
0^3
"KRN",101,7328,0)
IBNCR PATIENT ROI^Patient Release of Information^^M^^^^^^^^INTEGRATED BILLING
"KRN",101,7328,10,0)
^101.01PA^4^2
"KRN",101,7328,10,1,0)
7329^AR^1^
"KRN",101,7328,10,1,"^")
IBNCR ADD ROI
"KRN",101,7328,10,4,0)
7330^VR^3^
"KRN",101,7328,10,4,"^")
IBNCR VIEWEDIT ROI
"KRN",101,7328,26)
D SHOW^VALM
"KRN",101,7328,28)
Select Action:  
"KRN",101,7328,99)
61468,47349
"KRN",101,7329,-1)
0^1
"KRN",101,7329,0)
IBNCR ADD ROI^Add ROI^^A^^^^^^^^INTEGRATED BILLING
"KRN",101,7329,20)
D AD^IBNCPDR2
"KRN",101,7329,99)
61468,47349
"KRN",101,7330,-1)
0^5
"KRN",101,7330,0)
IBNCR VIEWEDIT ROI^ROI View/Edit^^A^^^^^^^^
"KRN",101,7330,4)
^^^VR
"KRN",101,7330,20)
D VP^IBNCPDR5
"KRN",101,7330,28)

"KRN",101,7330,99)
61468,47349
"KRN",101,7331,-1)
0^2
"KRN",101,7331,0)
IBNCR EDIT ROI INFO^Edit ROI^^A^^^^^^^^
"KRN",101,7331,2,0)
^101.02A^1^1
"KRN",101,7331,2,1,0)
ER
"KRN",101,7331,2,"B","ER",1)

"KRN",101,7331,20)
D EN^IBNCPDR1
"KRN",101,7331,99)
61468,47349
"KRN",101,7332,-1)
0^4
"KRN",101,7332,0)
IBNCR ROI EXP MENU^ROI Expanded Menu^^M^^^^^^^^INTEGRATED BILLING
"KRN",101,7332,10,0)
^101.01PA^1^1
"KRN",101,7332,10,1,0)
7331^^1^
"KRN",101,7332,10,1,"^")
IBNCR EDIT ROI INFO
"KRN",101,7332,26)
D SHOW^VALM
"KRN",101,7332,28)
Select Action:  
"KRN",101,7332,99)
61468,47349
"KRN",409.61,663,-1)
0^2
"KRN",409.61,663,0)
IBNCR PATIENT RELEASE OF INFO^1^^80^5^18^1^1^ROI^IBNCR PATIENT ROI^Patient ROI Management^^^1
"KRN",409.61,663,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,663,"ARRAY")
 ^TMP("IBNCR",$J)
"KRN",409.61,663,"COL",0)
^409.621^7^6
"KRN",409.61,663,"COL",1,0)
DRUG^6^28^Drug^^1
"KRN",409.61,663,"COL",2,0)
INSUR^35^15^Insurance Co.^^
"KRN",409.61,663,"COL",4,0)
NUMBER^1^3^
"KRN",409.61,663,"COL",5,0)
EFFDT^55^9^Eff Date
"KRN",409.61,663,"COL",6,0)
EXPIRE^69^10^Exp Date
"KRN",409.61,663,"COL",7,0)
STATUS^4^1^S
"KRN",409.61,663,"COL","AIDENT",1,1)

"KRN",409.61,663,"COL","B","DRUG",1)

"KRN",409.61,663,"COL","B","EFFDT",5)

"KRN",409.61,663,"COL","B","EXPIRE",6)

"KRN",409.61,663,"COL","B","INSUR",2)

"KRN",409.61,663,"COL","B","NUMBER",4)

"KRN",409.61,663,"COL","B","STATUS",7)

"KRN",409.61,663,"FNL")
D FNL^IBNCPDR
"KRN",409.61,663,"HDR")
D HDR^IBNCPDR
"KRN",409.61,663,"INIT")
D INIT^IBNCPDR
"KRN",409.61,664,-1)
0^1
"KRN",409.61,664,0)
IBNCR EXPANDED ROI^1^^80^5^18^1^1^ROI^IBNCR ROI EXP MENU^Patient ROI Information^1
"KRN",409.61,664,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,664,"ARRAY")
 ^TMP("IBNCRVR",$J)
"KRN",409.61,664,"COL",0)
^409.621^^0
"KRN",409.61,664,"FNL")
D FNL^IBNCPDR5
"KRN",409.61,664,"HDR")
D HDR^IBNCPDR5
"KRN",409.61,664,"HLP")
D HELP^IBNCPDR5
"KRN",409.61,664,"INIT")
D INIT^IBNCPDR5
"MBREQ")
1
"ORD",3,19.1)
19.1;3;;;KEY^XPDTA1;KEYF1^XPDIA1;KEYE1^XPDIA1;KEYF2^XPDIA1;;KEYDEL^XPDIA1
"ORD",3,19.1,0)
SECURITY KEY
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",17,409.61)
409.61;17;1;;;;;;;LMDEL^XPDIA1
"ORD",17,409.61,0)
LIST TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",230,-1)
1^1
"PKG",230,0)
INTEGRATED BILLING^IB^INTEGRATED BILLING
"PKG",230,20,0)
^9.402P^1^1
"PKG",230,20,1,0)
2^^IBAXDR
"PKG",230,20,1,1)

"PKG",230,20,"B",2,1)

"PKG",230,22,0)
^9.49I^1^1
"PKG",230,22,1,0)
2.0^2940321^2940525
"PKG",230,22,1,"PAH",1,0)
384^3090615^520665238
"PKG",230,22,1,"PAH",1,1,0)
^^1^1^3090615
"PKG",230,22,1,"PAH",1,1,1,0)
E-PHARMACY ENHANCEMENTS
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
41
"RTN","IB20P384")
0^10^B34256888
"RTN","IB20P384",1,0)
IB20P384 ;ALB/BDB - IB*2.0*384 POST INIT: ADD REASON NOT BILLABLE ;08-NOV-2007
"RTN","IB20P384",2,0)
 ;;2.0;INTEGRATED BILLING;**384**;21-MAR-94;Build 74
"RTN","IB20P384",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IB20P384",4,0)
 ;
"RTN","IB20P384",5,0)
 Q
"RTN","IB20P384",6,0)
 ;
"RTN","IB20P384",7,0)
POST ;
"RTN","IB20P384",8,0)
 N IBA
"RTN","IB20P384",9,0)
 S IBA(1)="",IBA(2)="    IB*2*384 Post-Install .....",IBA(3)="" D MES^XPDUTL(.IBA) K IBA
"RTN","IB20P384",10,0)
 D SCREEN7 ; Recompile the Screen 7 input template
"RTN","IB20P384",11,0)
 D SCEIEDIT ; Edit SCEI's to be ECME selectable in Claims Tracking Non-Billable Reasons file(#356.8)
"RTN","IB20P384",12,0)
 D IBERRAD ; New IB328 'ROI form required for sensitive record' IB Error file (#350.8)
"RTN","IB20P384",13,0)
 ;populate new #350.9 field #11.02 and add one record with reject code=70 to the subfile #350.912 
"RTN","IB20P384",14,0)
 ;for NON-COVERED DRUGS functionality; add new non-billable reason "NON COVERED DRUG PER PLAN"
"RTN","IB20P384",15,0)
 D NONCOVDR
"RTN","IB20P384",16,0)
 D NEWR ; add new RNB to CT RNB file (#356.8)
"RTN","IB20P384",17,0)
 S IBA(1)="",IBA(2)="    IB*2*384 Post-Install Complete",IBA(3)="" D MES^XPDUTL(.IBA) K IBA
"RTN","IB20P384",18,0)
 Q
"RTN","IB20P384",19,0)
 ;
"RTN","IB20P384",20,0)
SCEIEDIT ; Edit SCEI's to be ECME selectable in Claims Tracking Non-Billable Reasons file(#356.8)
"RTN","IB20P384",21,0)
 N DD,DO,DLAYGO,DINUM,DIC,DIE,DA,DR,X,Y,IBA,IBFOUND,IBFOUND1,IBATFN,IBNUM,IBAT,IBFN,IBIEN
"RTN","IB20P384",22,0)
 S IBA(1)="",IBA(2)="      >> Editing Service Connected/Environmental Indicators to be ECME"
"RTN","IB20P384",23,0)
 S IBA(3)="      >> selectable in the Claims Tracking Non-Billable Reasons file (#356.8)"
"RTN","IB20P384",24,0)
 S IBFOUND1=""
"RTN","IB20P384",25,0)
 F IBNUM=1:1:8 S IBIEN=$O(^IBE(356.8,"B",$P("SC TREATMENT^AGENT ORANGE^IONIZING RADIATION^SOUTHWEST ASIA^MILITARY SEXUAL TRAUMA^HEAD/NECK CANCER^COMBAT VETERAN^PROJECT 112/SHAD",U,IBNUM),"")) D
"RTN","IB20P384",26,0)
 .S IBFOUND="" I +IBIEN S IBFOUND=$G(^IBE(356.8,IBIEN,0))
"RTN","IB20P384",27,0)
 .I IBFOUND="" S IBFOUND1=1 D MSG(" "),MSG("     *** ERROR: Entry "_$P("SC^AO^IR^SWA^MST^HNC^CV^SHAD",U,IBNUM)_" missing, could not edit") Q
"RTN","IB20P384",28,0)
 .S DR=".02////1;.03////0"
"RTN","IB20P384",29,0)
 .S DIE="^IBE(356.8,",DA=IBIEN D ^DIE K DIE,DA,DR,X,Y
"RTN","IB20P384",30,0)
 D:IBFOUND1="" MSG("         Done. Service Connected/Environmental Indicators edited")
"RTN","IB20P384",31,0)
 D:'(IBFOUND1="") MSG("     *** ERROR: One or more entries could not be edited")
"RTN","IB20P384",32,0)
SCEIQ D MES^XPDUTL(.IBA) K IBA
"RTN","IB20P384",33,0)
 Q
"RTN","IB20P384",34,0)
 ;
"RTN","IB20P384",35,0)
IBERRAD ; New IB328 'ROI form required for sensitive record' IB Error file (#350.8)
"RTN","IB20P384",36,0)
 N DD,DO,DINUM,DIC,DIE,DA,DR,X,Y,IBA,IBFOUND,IBATFN,IBAT,IBIEN
"RTN","IB20P384",37,0)
 S IBA(1)="      >> Adding IB328 'ROI form required for sensitive record'"
"RTN","IB20P384",38,0)
 S IBA(2)="      >> in the IB Error file (#350.8)"
"RTN","IB20P384",39,0)
 S IBAT="IB328",IBIEN=$G(^IBE(350.8,"AC",IBAT))
"RTN","IB20P384",40,0)
 S IBFOUND="" I +IBIEN S IBFOUND=$G(^IBE(350.8,IBIEN,0))
"RTN","IB20P384",41,0)
 I IBFOUND="IB328^ROI form required for sensitive record^IB328^1^3" D MSG("         Done. IB328 'ROI form required for sensitive record' already exists") G IBERRADQ
"RTN","IB20P384",42,0)
 I IBFOUND'="" D MSG(" "),MSG("     *** ERROR: Entry already exists, could not add") G IBERRADQ
"RTN","IB20P384",43,0)
 K DD,DO S DIC="^IBE(350.8,",DIC(0)="L",X=IBAT D FILE^DICN K DIC S IBIEN=+Y
"RTN","IB20P384",44,0)
 I Y<1 K X,Y D MSG(" "),MSG("     *** ERROR: New entry could not be added") G IBERRADQ
"RTN","IB20P384",45,0)
 S DR=".02////ROI form required for sensitive record;.03////IB328;.04////1;.05////3"
"RTN","IB20P384",46,0)
 S DIE="^IBE(350.8,",DA=+IBIEN D ^DIE K DIE,DA,DR,X,Y
"RTN","IB20P384",47,0)
 D MSG("         Done. IB328 'ROI form required for sensitive record'  added")
"RTN","IB20P384",48,0)
IBERRADQ D MES^XPDUTL(.IBA) K IBA
"RTN","IB20P384",49,0)
 Q
"RTN","IB20P384",50,0)
 ;
"RTN","IB20P384",51,0)
MSG(X) ;
"RTN","IB20P384",52,0)
 N IBX S IBX=$O(IBA(999999),-1) S:'IBX IBX=1 S IBX=IBX+1
"RTN","IB20P384",53,0)
 S IBA(IBX)=$G(X)
"RTN","IB20P384",54,0)
 Q
"RTN","IB20P384",55,0)
 ;
"RTN","IB20P384",56,0)
 ;populate fields for NON-COVERED DRUGS functionality
"RTN","IB20P384",57,0)
NONCOVDR ;
"RTN","IB20P384",58,0)
 I $P($G(^IBE(350.9,1,11)),U,2)>0 D  Q
"RTN","IB20P384",59,0)
  . D BMES^XPDUTL("      >>   Skipping: NON-COVERED DRUGS functionality has been already activated")
"RTN","IB20P384",60,0)
 N IBZZ,IBNREC
"RTN","IB20P384",61,0)
 D BMES^XPDUTL("      >> Populating new #350.9 fields for NON-COVERED DRUGS functionality")
"RTN","IB20P384",62,0)
 D BMES^XPDUTL("      >>   turning off the NON-COVERED DRUGS functionality by default")
"RTN","IB20P384",63,0)
 S IBZZ=$$FILLFLDS^IBNCPUT1(350.9,11.02,1,0)
"RTN","IB20P384",64,0)
 I IBZZ'>0 D BMES^XPDUTL("     *** ERROR: "_$P(IBZZ,U,3))
"RTN","IB20P384",65,0)
 I '$O(^IBE(350.9,1,12,"B","70",0)) D
"RTN","IB20P384",66,0)
 . D BMES^XPDUTL("      >>   adding '70 Product/Service Not Covered' as default reject code")
"RTN","IB20P384",67,0)
 . I $$INSITEM^IBNCPUT1(350.912,1,"70","","E")'>0 D BMES^XPDUTL("     *** ERROR: could not add")
"RTN","IB20P384",68,0)
 ;add a new non-billable reason "NON COVERED DRUG PER PLAN"
"RTN","IB20P384",69,0)
 ;to the file (#356.8) CLAIMS TRACKING NON-BILLABLE REASONS file
"RTN","IB20P384",70,0)
 I '$O(^IBE(356.8,"B","NON COVERED DRUG PER PLAN",0)) D
"RTN","IB20P384",71,0)
 . D BMES^XPDUTL("      >>   adding a new 'NON COVERED DRUG PER PLAN' non-billable reason to the file #356.8")
"RTN","IB20P384",72,0)
 . S IBNREC=$$INSITEM^IBNCPUT1(356.8,"","NON COVERED DRUG PER PLAN","","E") I IBZZ'>0 D BMES^XPDUTL("     *** ERROR: could not add") Q
"RTN","IB20P384",73,0)
 . D BMES^XPDUTL("      >>   setting the ECME FLAG to 'Yes'")
"RTN","IB20P384",74,0)
 . S IBZZ=$$FILLFLDS^IBNCPUT1(356.8,.02,+IBNREC,1) I IBZZ'>0 D BMES^XPDUTL("     *** ERROR: "_$P(IBZZ,U,3))
"RTN","IB20P384",75,0)
 . D BMES^XPDUTL("      >>   setting the ECME PAPER FLAG to 'No'")
"RTN","IB20P384",76,0)
 . S IBZZ=$$FILLFLDS^IBNCPUT1(356.8,.03,+IBNREC,0) I IBZZ'>0 D BMES^XPDUTL("     *** ERROR: "_$P(IBZZ,U,3))
"RTN","IB20P384",77,0)
 Q
"RTN","IB20P384",78,0)
 ;
"RTN","IB20P384",79,0)
SCREEN7 ;Recompile Screen 7 Input Template
"RTN","IB20P384",80,0)
 N DMAX,IBIEN,IBRTN,X,Y
"RTN","IB20P384",81,0)
 S DMAX=$$ROUSIZE^DILF
"RTN","IB20P384",82,0)
 D MES^XPDUTL("Recompiling Screen 7 input template ...")
"RTN","IB20P384",83,0)
 ;
"RTN","IB20P384",84,0)
 ;find the ien of the input template
"RTN","IB20P384",85,0)
 S IBIEN=$O(^DIE("B","IB SCREEN7",0)) Q:'IBIEN
"RTN","IB20P384",86,0)
 ;
"RTN","IB20P384",87,0)
 ;quit if input template not compiled
"RTN","IB20P384",88,0)
 S IBRTN=$P($G(^DIE(IBIEN,"ROUOLD")),U) Q:IBRTN=""
"RTN","IB20P384",89,0)
 ;
"RTN","IB20P384",90,0)
 D MES^XPDUTL("Compiling IB SCREEN7, compiled routine is "_IBRTN_" ...")
"RTN","IB20P384",91,0)
 S X=IBRTN,Y=IBIEN
"RTN","IB20P384",92,0)
 D EN^DIEZ
"RTN","IB20P384",93,0)
 D MES^XPDUTL("Completed compiling input template.")
"RTN","IB20P384",94,0)
 D MES^XPDUTL("")
"RTN","IB20P384",95,0)
 Q
"RTN","IB20P384",96,0)
 ;
"RTN","IB20P384",97,0)
NEWR ; Add new RNBs (if RNB already exists ensure Code is set)
"RTN","IB20P384",98,0)
 N IBI,IBJ,IBLN,IBNM,IBRNB,IBTOT,IBTNC,IBTCH,DIC,DR,DO,X,Y,DLAYGO,DINUM,IBA
"RTN","IB20P384",99,0)
 S (IBTOT,IBTNC,IBTCH)=0 S DLAYGO=356.8
"RTN","IB20P384",100,0)
 ;
"RTN","IB20P384",101,0)
 D MSG("    Add 1 New Reason Not Billable (#356.8)...")
"RTN","IB20P384",102,0)
 ;
"RTN","IB20P384",103,0)
 F IBI=1:1 S IBLN=$P($T(NEW+IBI),";;",2,999) Q:'IBLN  D
"RTN","IB20P384",104,0)
 . S IBNM=$P(IBLN,U,6) S IBRNB=$O(^IBE(356.8,"B",IBNM,0))
"RTN","IB20P384",105,0)
 . I IBRNB Q
"RTN","IB20P384",106,0)
 . ;
"RTN","IB20P384",107,0)
 . F IBJ=61:1 I '$D(^IBE(356.8,IBJ,0)),IBJ'=72,IBJ'=90 Q
"RTN","IB20P384",108,0)
 . ;
"RTN","IB20P384",109,0)
 . S IBTOT=IBTOT+1
"RTN","IB20P384",110,0)
 . ;
"RTN","IB20P384",111,0)
 . S DIC("DR")=".02////"_$P(IBLN,U,4)_";.03////"_$P(IBLN,U,5)
"RTN","IB20P384",112,0)
 . S DIC="^IBE(356.8,",DIC(0)="L",X=IBNM,DINUM=IBJ D FILE^DICN K DIC I 'Y D MSG(IBNM_" Not Added, ERROR ****") Q
"RTN","IB20P384",113,0)
 . S IBTCH=IBTCH+1 D MSG("    - "_IBNM_" added")
"RTN","IB20P384",114,0)
 ;
"RTN","IB20P384",115,0)
 I 'IBTCH D MSG("    No Change: "_IBTNC_" of "_IBTOT_" New RNBs Already Exist")
"RTN","IB20P384",116,0)
 I +IBTCH D MSG("    Updated: "_IBTCH_" of "_IBTOT_" New RNBs Added")
"RTN","IB20P384",117,0)
 ;
"RTN","IB20P384",118,0)
 D MES^XPDUTL(.IBA)
"RTN","IB20P384",119,0)
 ;
"RTN","IB20P384",120,0)
 Q
"RTN","IB20P384",121,0)
 ;
"RTN","IB20P384",122,0)
 ; RNB'S to add to CT RNB file
"RTN","IB20P384",123,0)
NEW ;;
"RTN","IB20P384",124,0)
 ;;61^NEW^CV15^1^0^NO PHARMACY COVERAGE
"RTN","IB20P384",125,0)
 ;;
"RTN","IB20P384",126,0)
 Q
"RTN","IBBDOC")
0^51^B683097
"RTN","IBBDOC",1,0)
IBBDOC ;OAK/ELZ - APIS FOR OTHER PACKAGES FOR PFSS - DOCUMENT ;5-AUG-2004
"RTN","IBBDOC",2,0)
 ;;2.0;INTEGRATED BILLING;**267,260,286,361,384**;21-MAR-94;Build 74
"RTN","IBBDOC",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBBDOC",4,0)
 ;
"RTN","IBBDOC",5,0)
 ; Documents the calls to the routine IBBAPI.
"RTN","IBBDOC",6,0)
 ;
"RTN","IBBDOC",7,0)
INSUR ;(DFN,IBDT,IBSTAT,IBR,IBFLDS)
"RTN","IBBDOC",8,0)
 ; Function to return patient insurance information
"RTN","IBBDOC",9,0)
 ; --Input:
"RTN","IBBDOC",10,0)
 ;   DFN    = patient
"RTN","IBBDOC",11,0)
 ;   IBDT   = date insured (optional - default is today's date)
"RTN","IBBDOC",12,0)
 ;   IBSTAT = Insurance Status filter (combinable based on groups below)
"RTN","IBBDOC",13,0)
 ;      Group 1
"RTN","IBBDOC",14,0)
 ;          A = Inactive included (Default is active only)
"RTN","IBBDOC",15,0)
 ;      Group 2
"RTN","IBBDOC",16,0)
 ;          R = Not reimbursable included (Default is reimbursable only)
"RTN","IBBDOC",17,0)
 ;          B = Indemnity included (Default is not included)
"RTN","IBBDOC",18,0)
 ;      Group 3
"RTN","IBBDOC",19,0)
 ;          P = Prescription coverage required (Default is all coverages)
"RTN","IBBDOC",20,0)
 ;          O = Outpatient coverage required (Default is all coverages)
"RTN","IBBDOC",21,0)
 ;          I = Inpatient coverage only (Default is all coverages)
"RTN","IBBDOC",22,0)
 ;          E = e-Pharmacy billable coverage required, i.e. should have 
"RTN","IBBDOC",23,0)
 ;            Pharmacy coverage and be able to process e-claims (Default 
"RTN","IBBDOC",24,0)
 ;            is all coverages)
"RTN","IBBDOC",25,0)
 ;
"RTN","IBBDOC",26,0)
 ;   IBR    = Array to return insurance information - passed by reference
"RTN","IBBDOC",27,0)
 ;   IBFLDS = List of fields to return (1-22) in a comma separated list or "*" for all
"RTN","IBBDOC",28,0)
 ;
"RTN","IBBDOC",29,0)
 ; --Output:
"RTN","IBBDOC",30,0)
 ;   -1     = error occurred (error message passed back in
"RTN","IBBDOC",31,0)
 ;            IBR("IBBAPI","INSUR","ERROR",x) where x is error number
"RTN","IBBDOC",32,0)
 ;            between 101 & 111
"RTN","IBBDOC",33,0)
 ;    0     = No insurance found based on parameters
"RTN","IBBDOC",34,0)
 ;    1     = Insurance found
"RTN","IBBDOC",35,0)
 ;
"RTN","IBBDOC",36,0)
 ;
"RTN","IBBDOC",37,0)
CIDC  ; (DFN)
"RTN","IBBDOC",38,0)
 ; Input:    DFN for the patient in question.
"RTN","IBBDOC",39,0)
 ; Output:   1 = Ask CIDC questions for the specified patient
"RTN","IBBDOC",40,0)
 ;           0 = Don't ask CIDC questions for the specified patient
"RTN","IBBDOC",41,0)
 ;
"RTN","IBBDOC",42,0)
 ; The API will evaluate both a CIDC switch and the patient's insurance
"RTN","IBBDOC",43,0)
 ; to determine if the CIDC questions should be asked.
"RTN","IBBDOC",44,0)
 ;
"RTN","IBBDOC",45,0)
 ; The switch will have three internal values:
"RTN","IBBDOC",46,0)
 ;    0 = Don't ask any patients
"RTN","IBBDOC",47,0)
 ;    1 = Ask for patients only with active billable insurance
"RTN","IBBDOC",48,0)
 ;    2 = Ask for all patients
"RTN","IBBDOC",49,0)
 ;
"RTN","IBBDOC",50,0)
 ;
"RTN","IBBDOC",51,0)
SWSTAT ; ()
"RTN","IBBDOC",52,0)
 ; Returns the current status of the PFSS On/Off Switch
"RTN","IBBDOC",53,0)
 ;
"RTN","IBBDOC",54,0)
 ; Output:   <switch_status>^<status_date/time>
"RTN","IBBDOC",55,0)
 ; 
"RTN","IBBDOC",56,0)
 ; <switch_status> will be one of the following:
"RTN","IBBDOC",57,0)
 ;    0 = OFF
"RTN","IBBDOC",58,0)
 ;    1 = ON
"RTN","IBBDOC",59,0)
 ;
"RTN","IBBDOC",60,0)
GETACCT ; (IBBDFN,IBBARFN,IBBEVENT,IBBAPLR,IBBPV1,IBBPV2,IBBPR1,IBBDG1,IBBZCL,IBBDIV,IBBRAIEN,IBBSURG)
"RTN","IBBDOC",61,0)
 ; Pass data to IBB for account/visit (ADT) messaging.
"RTN","IBBDOC",62,0)
 ;
"RTN","IBBDOC",63,0)
 ; Input:
"RTN","IBBDOC",64,0)
 ; IBBDFN   = Patient; IEN to file #2 [required]
"RTN","IBBDOC",65,0)
 ; IBBARFN  = Account Reference; 
"RTN","IBBDOC",66,0)
 ;            IEN to file #375 or null [required]
"RTN","IBBDOC",67,0)
 ; IBBEVENT = HL7 Event Code; e.g., "A04" [required]
"RTN","IBBDOC",68,0)
 ; IBBAPLR  = Calling Application; 
"RTN","IBBDOC",69,0)
 ;            <routine> or <tag>_;_<routine> 
"RTN","IBBDOC",70,0)
 ; IBBPV1   = array for PV1 segment data [required]
"RTN","IBBDOC",71,0)
 ;   IBBPV1(2)  - Patient Class (O=Outpatient;I=Inpatient)
"RTN","IBBDOC",72,0)
 ;   IBBPV1(3)  - IEN to file #44, or "FEE BASIS"
"RTN","IBBDOC",73,0)
 ;   IBBPV1(4)  - Appointment Type; IEN to file #409.1
"RTN","IBBDOC",74,0)
 ;   IBBPV1(7)  - Attending Physician; IEN to file #200
"RTN","IBBDOC",75,0)
 ;   IBBVP1(9)  - Consulting Physician; IEN to file #200
"RTN","IBBDOC",76,0)
 ;   IBBPV1(10) - Purpose of Visit; 
"RTN","IBBDOC",77,0)
 ;                (Scheduling: 1=C&P;2=10-10;3=SV;4=UV)
"RTN","IBBDOC",78,0)
 ;   IBBPV1(17) - Admitting Physician or Surgeon; 
"RTN","IBBDOC",79,0)
 ;                IEN to file #200
"RTN","IBBDOC",80,0)
 ;   IBBPV1(18) - Primary Stop Code; IEN to file #40.7
"RTN","IBBDOC",81,0)
 ;   IBBPV1(25) - Check-In Date/Time (Scheduling)
"RTN","IBBDOC",82,0)
 ;   IBBPV1(41) - Credit Stop Code; IEN to file #40.7
"RTN","IBBDOC",83,0)
 ;   IBBPV1(44) - Admit Date/Time
"RTN","IBBDOC",84,0)
 ;   IBBPV1(45) - Check-Out Date/Time (Scheduling)
"RTN","IBBDOC",85,0)
 ;   IBBPV1(50) - Prescription #; IEN to file #52 (Pharmacy)
"RTN","IBBDOC",86,0)
 ;   IBBPV1(52) - Other Provider; IEN to file #200
"RTN","IBBDOC",87,0)
 ; IBBPV2   = array for PV2 segment data
"RTN","IBBDOC",88,0)
 ;   IBBPV2(7)  - Eligibility of Visit; IEN to file #8.1
"RTN","IBBDOC",89,0)
 ;   IBBPV2(8)  - Expected Admit/Visit Date/Time
"RTN","IBBDOC",90,0)
 ;   IBBPV2(24) - Appointment Status; 
"RTN","IBBDOC",91,0)
 ;                (Scheduling:
"RTN","IBBDOC",92,0)
 ;                 R=Scheduled/Kept;I=Inpatient;
"RTN","IBBDOC",93,0)
 ;                 NS=No-Show;NSR=No-Show, Rescheduled;
"RTN","IBBDOC",94,0)
 ;                 CP=Cancelled by Patient;
"RTN","IBBDOC",95,0)
 ;                 CPR=Cancelled by Patient, Rescheduled;
"RTN","IBBDOC",96,0)
 ;                 CC=Cancelled by Clinic;
"RTN","IBBDOC",97,0)
 ;                 CCR=Cancelled by Clinic, Rescheduled;
"RTN","IBBDOC",98,0)
 ;                 NT=No Action Taken)
"RTN","IBBDOC",99,0)
 ;   IBBPV2(46) - Date Appointment Made (Scheduling)
"RTN","IBBDOC",100,0)
 ; IBBPR1   = array for PR1 segment data
"RTN","IBBDOC",101,0)
 ;   IBBPR1(3)  - Procedure; IEN to file #81
"RTN","IBBDOC",102,0)
 ;   IBBPR1(4)  - Procedure; free text
"RTN","IBBDOC",103,0)
 ;   IBBPR1(5)  - Procedure Date/Time
"RTN","IBBDOC",104,0)
 ;   IBBPR1(6)  - Functional Type;
"RTN","IBBDOC",105,0)
 ;                (Prosthetics: 
"RTN","IBBDOC",106,0)
 ;                 O=Home Oxygen;P=Purchasing;
"RTN","IBBDOC",107,0)
 ;                 I=Stock Issue)
"RTN","IBBDOC",108,0)
 ;                (Radiology: 
"RTN","IBBDOC",109,0)
 ;                 ANI=Angio/Neuro/Interventional;
"RTN","IBBDOC",110,0)
 ;                 CARD=Cardiology Studies;CT=CT Scan;
"RTN","IBBDOC",111,0)
 ;                 RAD=General Radiology;
"RTN","IBBDOC",112,0)
 ;                 MRI=Magnetic Resonance Imaging;
"RTN","IBBDOC",113,0)
 ;                 MAM=Mammography;NM=Nuclear Medicine;
"RTN","IBBDOC",114,0)
 ;                 US=Ultrasound;VAS=Vascular Lab)
"RTN","IBBDOC",115,0)
 ;   IBBPR1(11) - Surgeon; IEN to file #200
"RTN","IBBDOC",116,0)
 ;   IBBPR1(16) - <modifier>;<modifier>;<modifier>;... 
"RTN","IBBDOC",117,0)
 ;                where each <modifier> is an IEN to file #81.3
"RTN","IBBDOC",118,0)
 ; IBBDG1   = array for DG1 segment data
"RTN","IBBDOC",119,0)
 ;   IBBDG1(n,3) - Diagnosis; IEN to file #80
"RTN","IBBDOC",120,0)
 ;   IBBDG1(1,4) - Diagnosis; free text; only one allowed
"RTN","IBBDOC",121,0)
 ;   IBBDG1(n,6) - Diagnosis Type; (A=Admitting;
"RTN","IBBDOC",122,0)
 ;                                  W=Working;
"RTN","IBBDOC",123,0)
 ;                                  D=Discharge;
"RTN","IBBDOC",124,0)
 ;                                  F=Final)
"RTN","IBBDOC",125,0)
 ; IBBZCL   = array for ZCL segment data
"RTN","IBBDOC",126,0)
 ;   IBBZCL(n,2) - Classification Type; 
"RTN","IBBDOC",127,0)
 ;                 (1=AO;2=IR;3=SC;4=EC;5=MST;6=HNC;
"RTN","IBBDOC",128,0)
 ;                  7=CV;8=SHAD)
"RTN","IBBDOC",129,0)
 ;   IBBZCL(n,3) - Classification Value; (1=YES;0=NO)
"RTN","IBBDOC",130,0)
 ; IBBDIV   = IEN to file #40.8
"RTN","IBBDOC",131,0)
 ; IBBRAIEN = IEN to file #75.1
"RTN","IBBDOC",132,0)
 ; IBBSURG  = array for special Surgery data
"RTN","IBBDOC",133,0)
 ;   IBBSURG(1) - Surgical Case #; IEN to file #130
"RTN","IBBDOC",134,0)
 ;   IBBSURG(2) - Surgical Specialty; IEN to file #45.3
"RTN","IBBDOC",135,0)
 ;
"RTN","IBBDOC",136,0)
 ; Returns the pointer to the PFSS ACCOUNT file (#375) where 
"RTN","IBBDOC",137,0)
 ; all application input data is stored.
"RTN","IBBDOC",138,0)
 ;
"RTN","IBBDOC",139,0)
 ; Output:  IEN to file #375, or 0, if unsuccessful
"RTN","IBBDOC",140,0)
 ; 
"RTN","IBBDOC",141,0)
GETCHGID ; ()
"RTN","IBBDOC",142,0)
 ; Returns a Unique Charge ID.
"RTN","IBBDOC",143,0)
 ;
"RTN","IBBDOC",144,0)
 ; Output: 1 + current value of field #2 of file #372.
"RTN","IBBDOC",145,0)
 ;
"RTN","IBBDOC",146,0)
CHARGE ; (IBBDFN,IBBARFN,IBBCTYPE,IBBUCID,IBBFT1,IBBPR1,IBBDG1,IBBZCL,IBBRXE,IBBORIEN,IBBPROS)
"RTN","IBBDOC",147,0)
 ; Pass data to IBB for charge (DFT) messaging.
"RTN","IBBDOC",148,0)
 ;
"RTN","IBBDOC",149,0)
 ; Input:
"RTN","IBBDOC",150,0)
 ; IBBDFN   = Patient; IEN to file #2 [required]
"RTN","IBBDOC",151,0)
 ; IBBARFN  = Account Reference; IEN to file #375 [required]
"RTN","IBBDOC",152,0)
 ; IBBCTYPE = Charge Type; (CG=debit;CD=credit) [required]
"RTN","IBBDOC",153,0)
 ; IBBUCID  = Unique Charge ID [required]
"RTN","IBBDOC",154,0)
 ; IBBFT1   = array for FT1 segment data [required]
"RTN","IBBDOC",155,0)
 ;   IBBFT1(4)  - Transaction Date/Time
"RTN","IBBDOC",156,0)
 ;   IBBFT1(7)  - Pharmacy Service Code
"RTN","IBBDOC",157,0)
 ;   IBBFT1(10) - Transaction Quantity
"RTN","IBBDOC",158,0)
 ;   IBBFT1(13) - Department Code
"RTN","IBBDOC",159,0)
 ;   IBBFT1(16) - Patient Location; IEN to file #44
"RTN","IBBDOC",160,0)
 ;   IBBFT1(18) - Patient Status; (Pharmacy: 1=Rx Copay Exempt;
"RTN","IBBDOC",161,0)
 ;                                           0=Not Exempt)
"RTN","IBBDOC",162,0)
 ;   IBBFT1(20) - Rendering Provider; IEN to file #200
"RTN","IBBDOC",163,0)
 ;   IBBFT1(21) - Ordering Provider; IEN to file #200
"RTN","IBBDOC",164,0)
 ;   IBBFT1(22) - Unit Cost
"RTN","IBBDOC",165,0)
 ;   IBBFT1(29) - <NDC>;<generic_name>
"RTN","IBBDOC",166,0)
 ;   IBBFT1(31) - Transaction Type; 
"RTN","IBBDOC",167,0)
 ;                (Pharmacy: 1=PSO NSC Rx Copay;
"RTN","IBBDOC",168,0)
 ;                           2=PSO SC Rx Copay;
"RTN","IBBDOC",169,0)
 ;                           3=PSO NSC Rx Copay Cancel
"RTN","IBBDOC",170,0)
 ;                           4=PSO NSC Rx Copay Update
"RTN","IBBDOC",171,0)
 ;                           5=PSO SC Rx Copay Cancel
"RTN","IBBDOC",172,0)
 ;                           6=PSO SC Rx Copay Update)
"RTN","IBBDOC",173,0)
 ; IBBPR1   = array for PR1 segment data;
"RTN","IBBDOC",174,0)
 ;            (required except Pharmacy)
"RTN","IBBDOC",175,0)
 ;   IBBPR1(3)    - Procedure; IEN to file #81
"RTN","IBBDOC",176,0)
 ;   IBBPR1(4)    - Procedure; free text
"RTN","IBBDOC",177,0)
 ;   IBBPR1(5)    - Procedure Date/Time
"RTN","IBBDOC",178,0)
 ;   IBBPR1(6)    - Functional Type; 
"RTN","IBBDOC",179,0)
 ;                  (Prosthetics: O=Home Oxygen;
"RTN","IBBDOC",180,0)
 ;                                P=Purchasing;
"RTN","IBBDOC",181,0)
 ;                                I=Stock Issue)
"RTN","IBBDOC",182,0)
 ;   IBBPR1(11,1) - Surgeon; IEN to file #200
"RTN","IBBDOC",183,0)
 ;   IBBPR1(11,2) - Attending Surgeon; IEN to file #200
"RTN","IBBDOC",184,0)
 ;   IBBPR1(16)   - <modifier>;<modifier>;<modifier>;...;
"RTN","IBBDOC",185,0)
 ;                  each <modifier> is an IEN to file #81.3
"RTN","IBBDOC",186,0)
 ; IBBDG1   = array for DG1 segment data
"RTN","IBBDOC",187,0)
 ;   IBBDG1(n,3) - Diagnosis; IEN to file #80
"RTN","IBBDOC",188,0)
 ;   IBBDG1(n,6) - Diagnosis Type; (A=Admitting;W=Working;
"RTN","IBBDOC",189,0)
 ;                                  D=Discharge;F=Final)
"RTN","IBBDOC",190,0)
 ; IBBZCL   = array for ZCL segment data
"RTN","IBBDOC",191,0)
 ;   IBBZCL(n,2) - Classification Type; 
"RTN","IBBDOC",192,0)
 ;                 (1=AO;2=IR;3=SC;4=EC;5=MST;
"RTN","IBBDOC",193,0)
 ;                  6=HNC;7=CV;8=SHAD)
"RTN","IBBDOC",194,0)
 ;   IBBZCL(n,3) - Classification Value; (1=YES;0=NO)
"RTN","IBBDOC",195,0)
 ; IBBRXE   = data for RXE segment data (Pharmacy only)
"RTN","IBBDOC",196,0)
 ;   IBBRXE(1)  - <quantity>_;_<days_supply>
"RTN","IBBDOC",197,0)
 ;   IBBRXE(17) - Refills Dispensed
"RTN","IBBDOC",198,0)
 ;   IBBRXE(18) - Release Date/Time
"RTN","IBBDOC",199,0)
 ;   IBBRXE(31) - DEA, Special Handling codes
"RTN","IBBDOC",200,0)
 ; IBBPROS  = array for special Prosthetics data
"RTN","IBBDOC",201,0)
 ;   IBBPROS(1) - Vendor; IEN to file #440
"RTN","IBBDOC",202,0)
 ;   IBBPROS(2) - OBL#
"RTN","IBBDOC",203,0)
 ;
"RTN","IBBDOC",204,0)
 ; Returns success indicator.
"RTN","IBBDOC",205,0)
 ;
"RTN","IBBDOC",206,0)
 ; Output: 1, if successful; 0 otherwise
"RTN","IBBDOC",207,0)
 ;
"RTN","IBBDOC",208,0)
SETACCT ; (IBBDFN,HLMTIENS)
"RTN","IBBDOC",209,0)
 ; Store visit/account # from external billing system in PFSS
"RTN","IBBDOC",210,0)
 ; ACCOUNT record; the file #375 record is found based on data
"RTN","IBBDOC",211,0)
 ; contained in the HL7 message referenced by HLMTIENS.
"RTN","IBBDOC",212,0)
 ; Most of the ADT messages involved originate in VistA and 
"RTN","IBBDOC",213,0)
 ; are returned by the external billing system with visit#
"RTN","IBBDOC",214,0)
 ; attached.
"RTN","IBBDOC",215,0)
 ; Some ADT-A01 messages originate in the external billing
"RTN","IBBDOC",216,0)
 ; system; these cause a new record to be created in file #375.
"RTN","IBBDOC",217,0)
 ; 
"RTN","IBBDOC",218,0)
 ; Input:
"RTN","IBBDOC",219,0)
 ; IBBDFN   = Patient; IEN to file #2 [required]
"RTN","IBBDOC",220,0)
 ; HLMTIENS = HL7 Message (standard VistA HL7 variable); 
"RTN","IBBDOC",221,0)
 ;            IEN to file #773 [required]
"RTN","IBBDOC",222,0)
 ;
"RTN","IBBDOC",223,0)
 ; Returns PFSS Account Reference.
"RTN","IBBDOC",224,0)
 ;
"RTN","IBBDOC",225,0)
 ; Output: IEN to file #375
"RTN","IBBDOC",226,0)
 ;
"RTN","IBBDOC",227,0)
EXTNUM ; (IBBDFN,IBBARFN)
"RTN","IBBDOC",228,0)
 ; Obtain the visit/account # of the external billing system
"RTN","IBBDOC",229,0)
 ; that has been associated with the PFSS ACCOUNT file (#375)
"RTN","IBBDOC",230,0)
 ; record.
"RTN","IBBDOC",231,0)
 ; 
"RTN","IBBDOC",232,0)
 ; Input:
"RTN","IBBDOC",233,0)
 ; IBBDFN   = Patient; IEN to file #2 [required]
"RTN","IBBDOC",234,0)
 ; IBBARFN  = Account Reference; IEN to file #375 [required]
"RTN","IBBDOC",235,0)
 ;
"RTN","IBBDOC",236,0)
 ; Returns the value of field #.02 from the file #375 record.
"RTN","IBBDOC",237,0)
 ;
"RTN","IBBDOC",238,0)
 ; Output: external visit/account #, or 0, if unsuccessful
"RTN","IBBDOC",239,0)
 ;
"RTN","IBBFAPI")
0^50^B42412028
"RTN","IBBFAPI",1,0)
IBBFAPI ;OAK/ELZ - FOR OTHER PACKAGES TO QUERY INSURANCE INFO ;19-AUG-2004
"RTN","IBBFAPI",2,0)
 ;;2.0;INTEGRATED BILLING;**267,297,249,317,361,384**;21-MAR-94;Build 74
"RTN","IBBFAPI",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBBFAPI",4,0)
 ;
"RTN","IBBFAPI",5,0)
 ; -- see IBBDOC for API documentation
"RTN","IBBFAPI",6,0)
 ;    no applications should call here directly
"RTN","IBBFAPI",7,0)
INSUR(DFN,IBDT,IBSTAT,IBR,IBFLDS) ; Return Patient Insurance Information
"RTN","IBBFAPI",8,0)
 ;
"RTN","IBBFAPI",9,0)
 N ERROR,ERRORT,FCNT,IBPLN,ICNT,INSP,N,N1,NOK,PASS,PASS1,X,%
"RTN","IBBFAPI",10,0)
 K ERRORT D ERRORLD
"RTN","IBBFAPI",11,0)
 S NOK=-1
"RTN","IBBFAPI",12,0)
 S DFN=$G(DFN)
"RTN","IBBFAPI",13,0)
 S IBSTAT=$G(IBSTAT)
"RTN","IBBFAPI",14,0)
 S IBDT=$P($G(IBDT),".")
"RTN","IBBFAPI",15,0)
 S IBFLDS=$G(IBFLDS)
"RTN","IBBFAPI",16,0)
 I IBDT,IBSTAT["A" S ERROR=107 D ERROR Q NOK
"RTN","IBBFAPI",17,0)
 S (ERROR,PASS)=0 K IBR
"RTN","IBBFAPI",18,0)
 I 'DFN S ERROR=102 D ERROR Q NOK
"RTN","IBBFAPI",19,0)
 I '$D(^DPT(DFN)) S ERROR=106 D ERROR Q NOK
"RTN","IBBFAPI",20,0)
 I IBDT]"",IBDT'?7N S ERROR=104 D ERROR Q NOK
"RTN","IBBFAPI",21,0)
 I +IBDT=0 D NOW^%DTC S IBDT=$P(%,".",1)
"RTN","IBBFAPI",22,0)
 I IBSTAT]"" N Y F X=1:1:$L(IBSTAT) S Y=$E(IBSTAT,X) I '$F("^A^R^P^O^I^B^E^",(U_Y_U)) S ERROR=105 D ERROR Q
"RTN","IBBFAPI",23,0)
 I ERROR=105 Q NOK
"RTN","IBBFAPI",24,0)
 I IBFLDS]"",IBFLDS'="*" N Y F X=1:1:$L(IBFLDS,",") D
"RTN","IBBFAPI",25,0)
 . S Y=$P(IBFLDS,",",X)
"RTN","IBBFAPI",26,0)
 . I Y'?1N.N S ERROR=103
"RTN","IBBFAPI",27,0)
 . I Y?1N.N,(Y<1)!(Y>21) S ERROR=103
"RTN","IBBFAPI",28,0)
 I ERROR=103 D ERROR Q NOK
"RTN","IBBFAPI",29,0)
 K IBR
"RTN","IBBFAPI",30,0)
 ; set buffer file flag
"RTN","IBBFAPI",31,0)
 S (X,IBR("BUFFER"))=0 F  S X=$O(^IBA(355.33,"C",DFN,X)) Q:'X  S IBR("BUFFER")=IBR("BUFFER")+1
"RTN","IBBFAPI",32,0)
 ; if ePharmacy requested then don't do Rx coverage, will do that elsewhere,
"RTN","IBBFAPI",33,0)
 ; if E then no generic P allowed!!!  E will limit the P check even more.
"RTN","IBBFAPI",34,0)
 I IBSTAT["E" S IBSTAT=$TR(IBSTAT,"P","")
"RTN","IBBFAPI",35,0)
 S (ICNT,N)=0 F  S N=$O(^DPT(DFN,.312,N)) Q:'N  I $D(^(N,0)) D
"RTN","IBBFAPI",36,0)
 . S X=^DPT(DFN,.312,N,0)
"RTN","IBBFAPI",37,0)
 . N X1
"RTN","IBBFAPI",38,0)
 . S X1=$G(^DIC(36,+X,0)) I X1="" Q  ; no insurance company entry
"RTN","IBBFAPI",39,0)
 . S INSP=$P(X,U,1),IBPLN=$P(X,U,18)
"RTN","IBBFAPI",40,0)
 . I IBSTAT'["R",$P(X1,U,2)="N" Q  ; does not reimburse
"RTN","IBBFAPI",41,0)
 . I IBSTAT'["B",$$INDEM^IBCNS1(X) Q  ; indemnity policy
"RTN","IBBFAPI",42,0)
 . S PASS1=0
"RTN","IBBFAPI",43,0)
 . I IBSTAT'["A" D
"RTN","IBBFAPI",44,0)
 . . I $P(X,U,8),IBDT<$P(X,U,8) S PASS1=1 Q  ;effective after care date
"RTN","IBBFAPI",45,0)
 . . I $P(X,U,4),IBDT>$P(X,U,4) S PASS1=1 Q  ;terminated before care date
"RTN","IBBFAPI",46,0)
 . . I $P($G(^IBA(355.3,+$P(X,U,18),0)),U,11) S PASS1=1 Q  ;inactive plan
"RTN","IBBFAPI",47,0)
 . . I $P(X1,U,5) S PASS1=1 Q  ; inactive insurance company
"RTN","IBBFAPI",48,0)
 . Q:PASS1
"RTN","IBBFAPI",49,0)
 . S ICNT=ICNT+1
"RTN","IBBFAPI",50,0)
 . S FCNT=$S(IBFLDS="*":22,1:$L(IBFLDS,",")) ; number of fields to pull
"RTN","IBBFAPI",51,0)
 . S IBR("IBBAPI","INSUR",ICNT)=""
"RTN","IBBFAPI",52,0)
 . I IBFLDS'="" F N1=1:1:FCNT D
"RTN","IBBFAPI",53,0)
 . . N RET,RETVAL
"RTN","IBBFAPI",54,0)
 . . S RET=$S(IBFLDS="*":N1,1:$P(IBFLDS,",",N1)),RETVAL="" I RET?1N.N,RET>0,RET<23 D @RET S IBR("IBBAPI","INSUR",ICNT,RET)=RETVAL
"RTN","IBBFAPI",55,0)
 . I IBSTAT["P"!(IBSTAT["O")!(IBSTAT["I")!(IBSTAT["E") D  I PASS1=0 K IBR("IBBAPI","INSUR",ICNT) S ICNT=ICNT-1
"RTN","IBBFAPI",56,0)
 . . S PASS1=0 Q:IBPLN=""
"RTN","IBBFAPI",57,0)
 . . I IBSTAT["P",+$$PLCOV(IBPLN,IBDT,"PHARMACY")>0 S PASS1=1
"RTN","IBBFAPI",58,0)
 . . I IBSTAT["O",+$$PLCOV(IBPLN,IBDT,"OUTPATIENT")>0 S PASS1=1
"RTN","IBBFAPI",59,0)
 . . I IBSTAT["I",+$$PLCOV(IBPLN,IBDT,"INPATIENT")>0 S PASS1=1
"RTN","IBBFAPI",60,0)
 . . I IBSTAT["E",+$$PLCOV(IBPLN,IBDT,"PHARMACY")>0,$$EPHARM(IBPLN) S PASS1=1
"RTN","IBBFAPI",61,0)
 I $D(IBR("IBBAPI","INSUR")),$O(IBR("IBBAPI","INSUR",0))'="ERROR" S PASS=1 F X=1:1 Q:'$D(IBR("IBBAPI","INSUR",X))  K:'$O(IBR("IBBAPI","INSUR",X,"")) IBR("IBBAPI","INSUR",X)
"RTN","IBBFAPI",62,0)
 Q PASS
"RTN","IBBFAPI",63,0)
ERRORLD ;  load error array
"RTN","IBBFAPI",64,0)
 F X=1:1:9 S ERRORT(X+100)=$P($T(ERRORLD1+X),";;",2)
"RTN","IBBFAPI",65,0)
 Q
"RTN","IBBFAPI",66,0)
 ;
"RTN","IBBFAPI",67,0)
ERRORLD1 ; error messages
"RTN","IBBFAPI",68,0)
 ;;DATABASE IS UNAVAILABLE
"RTN","IBBFAPI",69,0)
 ;;PATIENT ID IS REQUIRED
"RTN","IBBFAPI",70,0)
 ;;INVALID FIELD LIST
"RTN","IBBFAPI",71,0)
 ;;INVALID EFFECTIVE DATE
"RTN","IBBFAPI",72,0)
 ;;INVALID INSURANCE STATUS FILTER
"RTN","IBBFAPI",73,0)
 ;;INVALID PATIENT ID
"RTN","IBBFAPI",74,0)
 ;;INVALID COMBINATION, YOU CANNOT USE ""A"" WITH A DATE
"RTN","IBBFAPI",75,0)
 ;;DATA SOURCE IS NOT DEFINED
"RTN","IBBFAPI",76,0)
 ;;NO DATA ELEMENTS TO STORE
"RTN","IBBFAPI",77,0)
 ;;
"RTN","IBBFAPI",78,0)
ERROR ;
"RTN","IBBFAPI",79,0)
 K IBR S IBR("IBBAPI","INSUR","ERROR",ERROR)=ERRORT(ERROR)
"RTN","IBBFAPI",80,0)
 Q
"RTN","IBBFAPI",81,0)
 ;
"RTN","IBBFAPI",82,0)
1 ; Ins. Comp. name
"RTN","IBBFAPI",83,0)
 S RETVAL=$$GET1^DIQ(2.312,N_","_DFN_",",.01,"I")_U_$$GET1^DIQ(2.312,N_","_DFN_",",.01)
"RTN","IBBFAPI",84,0)
 Q
"RTN","IBBFAPI",85,0)
2 ; Ins. Comp. Street Address Line 1
"RTN","IBBFAPI",86,0)
 S RETVAL=$$GET1^DIQ(36,INSP_",",.111)
"RTN","IBBFAPI",87,0)
 Q
"RTN","IBBFAPI",88,0)
3 ; Ins. Comp. City
"RTN","IBBFAPI",89,0)
 S RETVAL=$$GET1^DIQ(36,INSP_",",.114)
"RTN","IBBFAPI",90,0)
 Q
"RTN","IBBFAPI",91,0)
4 ; Ins. Comp. State
"RTN","IBBFAPI",92,0)
 S RETVAL=$$GET1^DIQ(36,INSP_",",.115,"I") S:RETVAL RETVAL=RETVAL_U_$$GET1^DIQ(36,INSP_",",.115)
"RTN","IBBFAPI",93,0)
 Q
"RTN","IBBFAPI",94,0)
5 ; Ins. Comp. Zip
"RTN","IBBFAPI",95,0)
 S RETVAL=$$GET1^DIQ(36,INSP_",",.116)
"RTN","IBBFAPI",96,0)
 Q
"RTN","IBBFAPI",97,0)
6 ; Ins. Comp. Phone
"RTN","IBBFAPI",98,0)
 S RETVAL=$$GET1^DIQ(36,INSP_",",.131)
"RTN","IBBFAPI",99,0)
 Q
"RTN","IBBFAPI",100,0)
7 ; Coordination of Benefits
"RTN","IBBFAPI",101,0)
 S RETVAL=$$GET1^DIQ(2.312,N_","_DFN_",",.2,"I")_U_$$GET1^DIQ(2.312,N_","_DFN_",",.2)
"RTN","IBBFAPI",102,0)
 I RETVAL="^" S RETVAL=""
"RTN","IBBFAPI",103,0)
 Q
"RTN","IBBFAPI",104,0)
8 ; Policy Name
"RTN","IBBFAPI",105,0)
 S RETVAL=$$GET1^DIQ(2.312,N_","_DFN_",",.18,"I") S:RETVAL RETVAL=RETVAL_U_$$GET1^DIQ(355.3,RETVAL,.03)
"RTN","IBBFAPI",106,0)
 Q
"RTN","IBBFAPI",107,0)
9 ; Policy Reimbursable?
"RTN","IBBFAPI",108,0)
 S RETVAL=$$GET1^DIQ(36,INSP_",",1,"I")
"RTN","IBBFAPI",109,0)
 S RETVAL=$S(RETVAL="Y":"1^YES",RETVAL="*":"1^YES",RETVAL="**":"1^YES",RETVAL="":"1^YES",1:"0^NO")
"RTN","IBBFAPI",110,0)
 Q
"RTN","IBBFAPI",111,0)
10 ; Policy Effective Date
"RTN","IBBFAPI",112,0)
 S RETVAL=$$GET1^DIQ(2.312,N_","_DFN_",",8,"I")
"RTN","IBBFAPI",113,0)
 Q
"RTN","IBBFAPI",114,0)
11 ; Policy Expiration Date
"RTN","IBBFAPI",115,0)
 S RETVAL=$$GET1^DIQ(2.312,N_","_DFN_",",3,"I")
"RTN","IBBFAPI",116,0)
 Q
"RTN","IBBFAPI",117,0)
12 ; Subscriber Relationship
"RTN","IBBFAPI",118,0)
 S RETVAL=$$GET1^DIQ(2.312,N_","_DFN_",",16,"I")
"RTN","IBBFAPI",119,0)
 S RETVAL=$S(RETVAL="01":"P^PATIENT",RETVAL="02":"S^SPOUSE",RETVAL:"O^OTHER",1:"")
"RTN","IBBFAPI",120,0)
 Q
"RTN","IBBFAPI",121,0)
13 ; Subscriber Name
"RTN","IBBFAPI",122,0)
 S RETVAL=$$GET1^DIQ(2.312,N_","_DFN_",",17)
"RTN","IBBFAPI",123,0)
 Q
"RTN","IBBFAPI",124,0)
14  ; Subscriber ID
"RTN","IBBFAPI",125,0)
 S RETVAL=$$GET1^DIQ(2.312,N_","_DFN_",",1)
"RTN","IBBFAPI",126,0)
 Q
"RTN","IBBFAPI",127,0)
15 ; Pharmacy Coverage?
"RTN","IBBFAPI",128,0)
 N IBCOV
"RTN","IBBFAPI",129,0)
 S IBCOV=$$PLCOV(IBPLN,IBDT,"PHARMACY")
"RTN","IBBFAPI",130,0)
 S RETVAL=$S(+IBCOV=0:"0^NO",1:"1^YES")
"RTN","IBBFAPI",131,0)
 Q
"RTN","IBBFAPI",132,0)
16 ; Outpatient Coverage?
"RTN","IBBFAPI",133,0)
 N IBCOV
"RTN","IBBFAPI",134,0)
 S IBCOV=$$PLCOV(IBPLN,IBDT,"OUTPATIENT")
"RTN","IBBFAPI",135,0)
 S RETVAL=$S(+IBCOV=0:"0^NO",1:"1^YES")
"RTN","IBBFAPI",136,0)
 Q
"RTN","IBBFAPI",137,0)
17 ; Inpatient Coverage?
"RTN","IBBFAPI",138,0)
 N IBCOV
"RTN","IBBFAPI",139,0)
 S IBCOV=$$PLCOV(IBPLN,IBDT,"INPATIENT")
"RTN","IBBFAPI",140,0)
 S RETVAL=$S(+IBCOV=0:"0^NO",1:"1^YES")
"RTN","IBBFAPI",141,0)
 Q
"RTN","IBBFAPI",142,0)
18 ; Group Number
"RTN","IBBFAPI",143,0)
 S RETVAL=$$GET1^DIQ(355.3,$$GET1^DIQ(2.312,N_","_DFN_",",.18,"I")_",",.04)
"RTN","IBBFAPI",144,0)
 Q
"RTN","IBBFAPI",145,0)
 ;
"RTN","IBBFAPI",146,0)
19 ; Patient Relationship to Subscriber
"RTN","IBBFAPI",147,0)
 S RETVAL=$$GET1^DIQ(2.312,N_","_DFN_",",16,"I") S:RETVAL RETVAL=RETVAL_U_$$GET1^DIQ(2.312,N_","_DFN_",",16)
"RTN","IBBFAPI",148,0)
 Q
"RTN","IBBFAPI",149,0)
 ;
"RTN","IBBFAPI",150,0)
20 ; VA Advantage and Tricare plan
"RTN","IBBFAPI",151,0)
 S RETVAL=0  ; VA Advantage to be determined at a later date
"RTN","IBBFAPI",152,0)
 N PLN,TYP1,TYP2,RETVAL1
"RTN","IBBFAPI",153,0)
 S PLN=$$GET1^DIQ(2.312,N_","_DFN_",",.18,"I")
"RTN","IBBFAPI",154,0)
 S TYP1=$$GET1^DIQ(355.3,PLN_",",.09,"I")
"RTN","IBBFAPI",155,0)
 S TYP2=$$GET1^DIQ(355.1,TYP1_",",.03,"I")
"RTN","IBBFAPI",156,0)
 S RETVAL1=$S(TYP2=7:1,1:0)  ; determine if Tricare plan
"RTN","IBBFAPI",157,0)
 S RETVAL=RETVAL_U_RETVAL1
"RTN","IBBFAPI",158,0)
 Q
"RTN","IBBFAPI",159,0)
 ;
"RTN","IBBFAPI",160,0)
21 ; Plan Type
"RTN","IBBFAPI",161,0)
 N PLN,TYP1
"RTN","IBBFAPI",162,0)
 S PLN=$$GET1^DIQ(2.312,N_","_DFN_",",.18,"I")
"RTN","IBBFAPI",163,0)
 S TYP1=$$GET1^DIQ(355.3,PLN_",",.09,"I")
"RTN","IBBFAPI",164,0)
 S RETVAL=$S(TYP1:TYP1_U_$$GET1^DIQ(355.1,TYP1_",",.01,"I"),1:"")
"RTN","IBBFAPI",165,0)
 Q
"RTN","IBBFAPI",166,0)
 ;
"RTN","IBBFAPI",167,0)
22 ; Subscriber Sex
"RTN","IBBFAPI",168,0)
 D 12
"RTN","IBBFAPI",169,0)
 I $E(RETVAL)="P" S RETVAL=$$GET1^DIQ(2,DFN_",",.02,"I") S:$L(RETVAL) RETVAL=RETVAL_U_$$GET1^DIQ(2,DFN_",",.02)
"RTN","IBBFAPI",170,0)
 E  S RETVAL=$$GET1^DIQ(2.312,N_","_DFN_",",3.12,"I") S:$L(RETVAL) RETVAL=RETVAL_U_$$GET1^DIQ(2.312,N_","_DFN_",",3.12)
"RTN","IBBFAPI",171,0)
 Q
"RTN","IBBFAPI",172,0)
 ;
"RTN","IBBFAPI",173,0)
PLCOV(IBPL,IBVDT,IBCAT) ; Determine if a specific plan covers a category of coverage as of a date
"RTN","IBBFAPI",174,0)
 ; IBPL - pointer to file 355.3 group insurance plan (req)
"RTN","IBBFAPI",175,0)
 ; IBVDT - fileman format visit date (req)
"RTN","IBBFAPI",176,0)
 ; IBCAT -  pointer to file 355.31 limitation of coverage category (req)
"RTN","IBBFAPI",177,0)
 N CATLIM,X,Y
"RTN","IBBFAPI",178,0)
 I '$G(IBPL)!('$G(IBVDT))!('$L($G(IBCAT))) Q 0
"RTN","IBBFAPI",179,0)
 S X=0
"RTN","IBBFAPI",180,0)
 S IBCAT=$O(^IBE(355.31,"B",IBCAT,"")) G:IBCAT="" PLCOVQ
"RTN","IBBFAPI",181,0)
 S CATLIM=$O(^IBA(355.32,"APCD",IBPL,IBCAT,+$O(^IBA(355.32,"APCD",IBPL,IBCAT,-(IBVDT+1))),""))
"RTN","IBBFAPI",182,0)
 S X=$S(CATLIM="":1,1:+$P($G(^IBA(355.32,CATLIM,0)),U,4))
"RTN","IBBFAPI",183,0)
PLCOVQ Q X
"RTN","IBBFAPI",184,0)
 ;
"RTN","IBBFAPI",185,0)
EPHARM(IBPL) ; return if a plan is epharmacy billable
"RTN","IBBFAPI",186,0)
 N IBPIEN,IBOK,IBY
"RTN","IBBFAPI",187,0)
 S IBOK=1
"RTN","IBBFAPI",188,0)
 S IBPIEN=+$G(^IBA(355.3,+IBPL,6))
"RTN","IBBFAPI",189,0)
 I 'IBPIEN S IBOK=0 G EPHARMQ
"RTN","IBBFAPI",190,0)
 D STCHK^IBCNRU1(IBPIEN,.IBY)
"RTN","IBBFAPI",191,0)
 I $E($G(IBY(1)))'="A" S IBOK=0
"RTN","IBBFAPI",192,0)
EPHARMQ ;
"RTN","IBBFAPI",193,0)
 Q IBOK
"RTN","IBBFAPI",194,0)
 ;
"RTN","IBCBB1")
0^18^B72688329
"RTN","IBCBB1",1,0)
IBCBB1 ;ALB/AAS - CONTINUATION OF EDIT CHECK ROUTINE ;2-NOV-89
"RTN","IBCBB1",2,0)
 ;;2.0;INTEGRATED BILLING;**27,52,80,93,106,51,151,148,153,137,232,280,155,320,343,349,363,371,395,384**;21-MAR-94;Build 74
"RTN","IBCBB1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCBB1",4,0)
 ;
"RTN","IBCBB1",5,0)
 ;MAP TO DGCRBB1
"RTN","IBCBB1",6,0)
 ;
"RTN","IBCBB1",7,0)
% ;Bill Status
"RTN","IBCBB1",8,0)
 N Z,Z0,Z1
"RTN","IBCBB1",9,0)
 I $S(+IBST=0:1,1:"^1^2^3^4^7^"'[(U_IBST_U)) S IBER=IBER_"IB045;"
"RTN","IBCBB1",10,0)
 ;
"RTN","IBCBB1",11,0)
 ;Statement Covers From
"RTN","IBCBB1",12,0)
 I IBFDT="" S IBER=IBER_"IB061;"
"RTN","IBCBB1",13,0)
 I IBFDT]"",IBFDT'?7N&(IBFDT'?7N1".".N) S IBER=IBER_"IB061;"
"RTN","IBCBB1",14,0)
 I IBFDT>IBTDT S IBER=IBER_"IB061;" ; from must be on or before the to date 
"RTN","IBCBB1",15,0)
 S IBFFY=$$FY^IBOUTL(IBFDT)
"RTN","IBCBB1",16,0)
 ; if inpat - from date must not be prior to admit date.
"RTN","IBCBB1",17,0)
 I $$INPAT^IBCEF(IBIFN,1),(IBFDT<($P($G(^DGPT(+$P(IBND0,U,8),0)),U,2)\1))  S IBER=IBER_"IB061;"
"RTN","IBCBB1",18,0)
 ;
"RTN","IBCBB1",19,0)
 ;Statement Covers To
"RTN","IBCBB1",20,0)
 I IBTDT="" S IBER=IBER_"IB062;"
"RTN","IBCBB1",21,0)
 I IBTDT]"",IBTDT'?7N&(IBTDT'?7N1".".N) S IBER=IBER_"IB062;"
"RTN","IBCBB1",22,0)
 I IBTDT>DT!(IBTDT<IBFDT) S IBER=IBER_"IB062;"  ; to date must not be >than today's date
"RTN","IBCBB1",23,0)
 S IBTFY=$$FY^IBOUTL(IBTDT)
"RTN","IBCBB1",24,0)
 ;
"RTN","IBCBB1",25,0)
 ;Total Charges
"RTN","IBCBB1",26,0)
 I +IBTC'>0!(+IBTC'=IBTC) S IBER=IBER_"IB064;"
"RTN","IBCBB1",27,0)
 ;
"RTN","IBCBB1",28,0)
 ;Billable charges for secondary claim
"RTN","IBCBB1",29,0)
 I $$MCRONBIL^IBEFUNC(IBIFN)&(($P(IBNDU1,U,1)-$P(IBNDU1,U,2))'>0) S IBER=IBER_"IB094;"
"RTN","IBCBB1",30,0)
 ;Fiscal Year 1
"RTN","IBCBB1",31,0)
 S IBFFY=$$FY^IBOUTL(IBFDT)
"RTN","IBCBB1",32,0)
 ;
"RTN","IBCBB1",33,0)
 ;Check provider link for current user, enterer, reviewer and Authorizor
"RTN","IBCBB1",34,0)
 I '$D(^VA(200,DUZ,0)) S IBER=IBER_"IB048;"
"RTN","IBCBB1",35,0)
 I IBEU]"",'$D(^VA(200,IBEU,0)) S IBER=IBER_"IB048;"
"RTN","IBCBB1",36,0)
 I IBRU]"",'$D(^VA(200,IBRU,0)) S IBER=IBER_"IB060;"
"RTN","IBCBB1",37,0)
 I IBAU]"",'$D(^VA(200,IBAU,0)) S IBER=IBER_"IB041;"
"RTN","IBCBB1",38,0)
 ;
"RTN","IBCBB1",39,0)
 I IBER="",+$$STA^PRCAFN(IBIFN)=104 S IBER=IBER_"IB040;"
"RTN","IBCBB1",40,0)
 ; If ins bill, must have valid COB sequence
"RTN","IBCBB1",41,0)
 I $P(IBND0,U,11)="i",$S($P(IBND0,U,21)="":1,1:"PST"'[$P(IBND0,U,21)) S IBER=IBER_"IB324;"
"RTN","IBCBB1",42,0)
 ;
"RTN","IBCBB1",43,0)
 ; Check for valid sec provider id for current ins
"RTN","IBCBB1",44,0)
 S Z=0 F  S Z=$O(^DGCR(399,IBIFN,"PRV",Z)) Q:'Z  S Z0=$G(^(Z,0)),Z1=+$$COBN^IBCEF(IBIFN) I $P(Z0,U,4+Z1)'="",$P(Z0,U,11+Z1)'="" D
"RTN","IBCBB1",45,0)
 . I '$$SECIDCK^IBCEF74(IBIFN,Z1,$P(Z0,U,11+Z1),Z) D WARN^IBCBB11("Prov secondary id type for the "_$P("PRIMARY^SECONDARY^TERTIARY",U,Z1)_" "_$$EXTERNAL^DILFD(399.0222,.01,,+Z0)_" is invalid/won't transmit")
"RTN","IBCBB1",46,0)
 ; Check NPIs
"RTN","IBCBB1",47,0)
 D NPICHK^IBCBB11
"RTN","IBCBB1",48,0)
 ;
"RTN","IBCBB1",49,0)
 ; Check multiple rx NPIs
"RTN","IBCBB1",50,0)
 D RXNPI^IBCBB11(IBIFN)
"RTN","IBCBB1",51,0)
 ;
"RTN","IBCBB1",52,0)
 ; Check taxonomies
"RTN","IBCBB1",53,0)
 D TAXCHK^IBCBB11
"RTN","IBCBB1",54,0)
 ;
"RTN","IBCBB1",55,0)
 ; Check for Physician Name
"RTN","IBCBB1",56,0)
 K IBXDATA D F^IBCEF("N-ATT/REND PHYSICIAN NAME",,,IBIFN)
"RTN","IBCBB1",57,0)
 I $P($G(IBXDATA),U)="" S IBER=IBER_"IB303;"
"RTN","IBCBB1",58,0)
 ;
"RTN","IBCBB1",59,0)
 N FUNCTION,IBINS
"RTN","IBCBB1",60,0)
 S FUNCTION=$S($$FT^IBCEF(IBIFN)=3:4,1:3)
"RTN","IBCBB1",61,0)
 I IBER'["IB303;" D
"RTN","IBCBB1",62,0)
 . F IBINS=1:1:3 D
"RTN","IBCBB1",63,0)
 .. S Z=$$GETTYP^IBCEP2A(IBIFN,IBINS)
"RTN","IBCBB1",64,0)
 .. I Z,$P(Z,U,2) D  ; Rendering/attending prov secondary id required
"RTN","IBCBB1",65,0)
 ... N IBID,IBOK,Q0
"RTN","IBCBB1",66,0)
 ... D PROVINF^IBCEF74(IBIFN,IBINS,.IBID,1,"C")  ; check all as though they were current
"RTN","IBCBB1",67,0)
 ... S IBOK=0
"RTN","IBCBB1",68,0)
 ... S Q0=0 F  S Q0=$O(IBID(1,FUNCTION,Q0)) Q:'Q0  I $P(IBID(1,FUNCTION,Q0),U,9)=+Z S IBOK=1 Q
"RTN","IBCBB1",69,0)
 ... I 'IBOK S IBER=IBER_$S(IBINS=1:"IB236;",IBINS=2:"IB237;",IBINS=3:"IB238;",1:"")
"RTN","IBCBB1",70,0)
 ;
"RTN","IBCBB1",71,0)
 D PRIIDCHK^IBCBB11
"RTN","IBCBB1",72,0)
 ;
"RTN","IBCBB1",73,0)
 N IBM,IBM1
"RTN","IBCBB1",74,0)
 S IBM=$G(^DGCR(399,IBIFN,"M"))
"RTN","IBCBB1",75,0)
 S IBM1=$G(^DGCR(399,IBIFN,"M1"))
"RTN","IBCBB1",76,0)
 I $P(IBM,U),$P($G(^DIC(36,$P(IBM,U),4)),U,6),$P(IBM1,U,2)="" S IBER=IBER_"IB244;"
"RTN","IBCBB1",77,0)
 I $P(IBM,U,2),$P($G(^DIC(36,$P(IBM,U,2),4)),U,6),$P(IBM1,U,3)="" S IBER=IBER_"IB245;"
"RTN","IBCBB1",78,0)
 I $P(IBM,U,3),$P($G(^DIC(36,$P(IBM,U,3),4)),U,6),$P(IBM1,U,4)="" S IBER=IBER_"IB246;"
"RTN","IBCBB1",79,0)
 ;
"RTN","IBCBB1",80,0)
 ; If outside facility, check for ID and qualifier in 355.93
"RTN","IBCBB1",81,0)
 ; 5/15/06 - esg - hard error IB243 turned into warning message instead
"RTN","IBCBB1",82,0)
 S Z=$P($G(^DGCR(399,IBIFN,"U2")),U,10)
"RTN","IBCBB1",83,0)
 I Z D
"RTN","IBCBB1",84,0)
 . I $P($G(^IBA(355.93,Z,0)),U,9)=""!($P($G(^IBA(355.93,Z,0)),U,13)="") D
"RTN","IBCBB1",85,0)
 .. N Z1,Z2
"RTN","IBCBB1",86,0)
 .. S Z1="Missing Lab or Facility Primary ID for non-VA facility, "
"RTN","IBCBB1",87,0)
 .. S Z2=$$EXTERNAL^DILFD(399,232,,Z)
"RTN","IBCBB1",88,0)
 .. I $L(Z2)'>19 D WARN^IBCBB11(Z1_Z2) Q
"RTN","IBCBB1",89,0)
 .. D WARN^IBCBB11(Z1),WARN^IBCBB11("     "_Z2)
"RTN","IBCBB1",90,0)
 .. Q
"RTN","IBCBB1",91,0)
 . Q
"RTN","IBCBB1",92,0)
 ;
"RTN","IBCBB1",93,0)
 ; Must be one and only one division on bill
"RTN","IBCBB1",94,0)
 S IBZ=$$MULTDIV^IBCBB11(IBIFN,IBND0)
"RTN","IBCBB1",95,0)
 I IBZ S IBER=IBER_$S(IBZ=1:"IB095;",IBZ=2:"IB104;",1:"IB105;")
"RTN","IBCBB1",96,0)
 ; Division address must be defined in institution file
"RTN","IBCBB1",97,0)
 I $P(IBND0,U,22) D
"RTN","IBCBB1",98,0)
 . N Z,Z0,Z1
"RTN","IBCBB1",99,0)
 . S Z0=$G(^DIC(4,+$P($G(^DG(40.8,+$P(IBND0,U,22),0)),U,7),0))
"RTN","IBCBB1",100,0)
 . S Z1=$G(^DIC(4,+$P($G(^DG(40.8,+$P(IBND0,U,22),0)),U,7),1))
"RTN","IBCBB1",101,0)
 . I $P(Z0,U,2)="" S IBER=IBER_"IB097;" Q
"RTN","IBCBB1",102,0)
 . F Z=1,3,4 I $P(Z1,U,Z)="" S IBER=IBER_"IB097;" Q
"RTN","IBCBB1",103,0)
 ;
"RTN","IBCBB1",104,0)
 ;CHAMPVA Rate Type and Primary Insurance Carriers Type of Coverage must match
"RTN","IBCBB1",105,0)
 S (IBRTCHV,IBPICHV)=0
"RTN","IBCBB1",106,0)
 I $P($G(^DGCR(399.3,+IBAT,0)),U,1)="CHAMPVA" S IBRTCHV=1
"RTN","IBCBB1",107,0)
 I $P($G(^IBE(355.2,+$P($G(^DIC(36,+IBNDMP,0)),U,13),0)),U,1)="CHAMPVA" S IBPICHV=1
"RTN","IBCBB1",108,0)
 I (+IBRTCHV!+IBPICHV)&('IBRTCHV!'IBPICHV) S IBER=IBER_"IB085;"
"RTN","IBCBB1",109,0)
 ;
"RTN","IBCBB1",110,0)
 N IBZPRC,IBZPRCUB
"RTN","IBCBB1",111,0)
 D F^IBCEF("N-ALL PROCEDURES","IBZPRC",,IBIFN)
"RTN","IBCBB1",112,0)
 ; Procedure Clinic is required for Surgical Procedures Outpt Facility Charges
"RTN","IBCBB1",113,0)
 I +$P(IBND0,U,27)'=2,$$BILLRATE^IBCRU3(IBAT,IBCL,IBEVDT,"RC OUTPATIENT") D
"RTN","IBCBB1",114,0)
 . N Z,Z0,Z1,ZE S (ZE,Z)=0 F  S Z=$O(^DGCR(399,IBIFN,"CP",Z)) Q:'Z  D  I +ZE S IBER=IBER_"IB320;" Q
"RTN","IBCBB1",115,0)
 .. S Z0=$G(^DGCR(399,IBIFN,"CP",Z,0)),Z1=+Z0 I Z0'[";ICPT(" Q
"RTN","IBCBB1",116,0)
 .. I '((Z1'<10000)&(Z1'>69999))&'((Z1'<93501)&(Z1'>93533)) Q
"RTN","IBCBB1",117,0)
 .. I '$P(Z0,U,7) S ZE=1
"RTN","IBCBB1",118,0)
 ;
"RTN","IBCBB1",119,0)
 ; Extract procedures for UB-04
"RTN","IBCBB1",120,0)
 D F^IBCEF("N-UB-04 PROCEDURES","IBZPRCUB",,IBIFN)
"RTN","IBCBB1",121,0)
 ; Does this bill have ANY prescriptions associated with it?
"RTN","IBCBB1",122,0)
 ; Must bill prescriptions separately from other charges
"RTN","IBCBB1",123,0)
 ;
"RTN","IBCBB1",124,0)
 I $$ISRX^IBCEF1(IBIFN) D
"RTN","IBCBB1",125,0)
 . N IBZ,IBRXDEF
"RTN","IBCBB1",126,0)
 . S IBRXDEF=$P($G(^IBE(350.9,1,1)),U,30),IBZ=0
"RTN","IBCBB1",127,0)
 . F  S IBZ=$O(IBZPRCUB(IBZ)) Q:'IBZ  I IBZPRCUB(IBZ),+$P(IBZPRCUB(IBZ),U)'=IBRXDEF S IBER=IBER_"IB102;" Q
"RTN","IBCBB1",128,0)
 . K IBZ
"RTN","IBCBB1",129,0)
 ;
"RTN","IBCBB1",130,0)
 ; Check that COB sequences are not skipped
"RTN","IBCBB1",131,0)
 K Z
"RTN","IBCBB1",132,0)
 F Z=1:1:3 S:+$G(^DGCR(399,IBIFN,"I"_Z)) Z(Z)=""
"RTN","IBCBB1",133,0)
 F Z=0:1:2 S Z0=$O(Z(Z)) Q:'Z0  I Z0'=(Z+1) S IBER=IBER_"IB322;" Q
"RTN","IBCBB1",134,0)
 K Z
"RTN","IBCBB1",135,0)
 ; HD64676  IB*2*371 - OK for payer sequence to be blank when the Rate
"RTN","IBCBB1",136,0)
 ;    Type is either Interagency or Sharing Agreement
"RTN","IBCBB1",137,0)
 I $P($G(^DGCR(399,IBIFN,0)),U,21)="",$P($G(^DGCR(399,IBIFN,0)),U,7)'=4,$P($G(^DGCR(399,IBIFN,0)),U,7)'=9 S IBER=IBER_"IB323;"
"RTN","IBCBB1",138,0)
 K IBXDATA D F^IBCEF("N-PROCEDURE CODING METHD",,,IBIFN)
"RTN","IBCBB1",139,0)
 ; Coding method should agree with types of procedure codes
"RTN","IBCBB1",140,0)
 S IBOK=$S('$O(IBZPRC(0))!(IBXDATA=""):1,1:0)
"RTN","IBCBB1",141,0)
 I 'IBOK S IBOK=1,IBZ=0 F  S IBZ=$O(IBZPRC(IBZ)) Q:'IBZ  I IBZPRC(IBZ),$P(IBZPRC(IBZ),U)'[$S(IBXDATA=9:"ICD",1:"ICP") S IBOK=0 Q
"RTN","IBCBB1",142,0)
 I 'IBOK D WARN^IBCBB11("Coding Method does not agree with all procedure codes found on bill")
"RTN","IBCBB1",143,0)
 D EDITMRA^IBCBB3(.IBQUIT,.IBER,IBIFN,IBFT)
"RTN","IBCBB1",144,0)
 Q:$G(IBQUIT)
"RTN","IBCBB1",145,0)
 ;
"RTN","IBCBB1",146,0)
 ;Other things that could be added:  Rev Code - calculating charges
"RTN","IBCBB1",147,0)
 ;        Diagnosis Coding, if MT copay - check for other co-payments
"RTN","IBCBB1",148,0)
 ;
"RTN","IBCBB1",149,0)
 I $P(IBNDTX,U,8),$$REQMRA^IBEFUNC(IBIFN) S IBER=IBER_"IB121;"   ; can't force MRAs to print
"RTN","IBCBB1",150,0)
 I $P(IBNDTX,U,8)!$P(IBNDTX,U,9) D WARN^IBCBB11($S($$REQMRA^IBEFUNC(IBIFN)&($P(IBNDTX,U,9)):"MRA Secondary ",1:"")_"Bill has been forced to print "_$S($P(IBNDTX,U,8)=1!($P(IBNDTX,U,9)=1):"locally",1:"at clearinghouse"))
"RTN","IBCBB1",151,0)
 N IBXZ,IBIZ F IBIZ=12,13,14 S IBXZ=$P(IBNDM,U,IBIZ) I +IBXZ S IBXZ=$P($G(^DPT(DFN,.312,IBXZ,0)),U,18) I +IBXZ S IBXZ=$G(^IBA(355.3,+IBXZ,0)) I +$P(IBXZ,U,12) D
"RTN","IBCBB1",152,0)
 . D WARN^IBCBB11($P($G(^DIC(36,+IBXZ,0)),U,1)_" requires Amb Care Certification")
"RTN","IBCBB1",153,0)
 ;
"RTN","IBCBB1",154,0)
 D VALNDC^IBCBB11(IBIFN,DFN)  ;validate NDC#
"RTN","IBCBB1",155,0)
 ;
"RTN","IBCBB1",156,0)
 ;Build AR array if no errors and MRA not needed or already rec'd
"RTN","IBCBB1",157,0)
 I IBER="",$S($$NEEDMRA^IBEFUNC(IBIFN)!($$REQMRA^IBEFUNC(IBIFN)):0,1:1) D ARRAY
"RTN","IBCBB1",158,0)
 ;
"RTN","IBCBB1",159,0)
 ;Check ROI
"RTN","IBCBB1",160,0)
 N ROIERR
"RTN","IBCBB1",161,0)
 S ROIERR=0 I $P($G(^DGCR(399,IBIFN,"U")),U,5)=1,$P($G(^DGCR(399,IBIFN,"U")),U,7)=0 S ROIERR=1 ; screen 7 sensitive record and no ROI
"RTN","IBCBB1",162,0)
 I $$ROICHK^IBCBB11(IBIFN,DFN,+IBNDMP) S ROIERR=1 ; check file for sensitive Rx and missing ROI
"RTN","IBCBB1",163,0)
 I ROIERR S IBER=IBER_"IB328;"
"RTN","IBCBB1",164,0)
 ;
"RTN","IBCBB1",165,0)
END ;Don't kill IBIFN, IBER, DFN
"RTN","IBCBB1",166,0)
 I $O(^TMP($J,"BILL-WARN",0)),$G(IBER)="" S IBER="WARN" ;Warnings only
"RTN","IBCBB1",167,0)
 K IBBNO,IBEVDT,IBLOC,IBCL,IBTF,IBAT,IBWHO,IBST,IBFDT,IBTDT,IBTC,IBFY,IBFY1,IBAU,IBRU,IBEU,IBARTP,IBFYC,IBMRA,IBTOB,IBTOB12,IBNDU2,IBNDUF3,IBNDUF31,IBNDTX
"RTN","IBCBB1",168,0)
 K IBNDS,IBND0,IBNDU,IBNDM,IBNDMP,IBNDU1,IBFFY,IBTFY,IBFT,IBRTCHV,IBPICHV,IBXDATA,IBOK
"RTN","IBCBB1",169,0)
 I $D(IBER),IBER="" W !,"No Errors found for National edits"
"RTN","IBCBB1",170,0)
 Q
"RTN","IBCBB1",171,0)
 ;
"RTN","IBCBB1",172,0)
ARRAY ;Build PRCASV(array)
"RTN","IBCBB1",173,0)
 N IBCOBN,X
"RTN","IBCBB1",174,0)
 K PRCASV
"RTN","IBCBB1",175,0)
 Q:$$MCRWNR^IBEFUNC(+$$CURR^IBCEF2(IBIFN))
"RTN","IBCBB1",176,0)
 S IBCOBN=$$COBN^IBCEF(IBIFN)
"RTN","IBCBB1",177,0)
 S X=IBIFN
"RTN","IBCBB1",178,0)
 S PRCASV("BDT")=DT,PRCASV("ARREC")=IBIFN
"RTN","IBCBB1",179,0)
 S PRCASV("APR")=DUZ
"RTN","IBCBB1",180,0)
 S PRCASV("PAT")=DFN,PRCASV("CAT")=$P(^DGCR(399.3,IBAT,0),"^",6)
"RTN","IBCBB1",181,0)
 I IBWHO="i" S PRCASV("DEBTOR")=+IBNDMP_";DIC(36,"
"RTN","IBCBB1",182,0)
 S PRCASV("DEBTOR")=$S(IBWHO="p":DFN_";DPT(",IBWHO="o":$P(IBNDM,"^",11)_";DIC(4,",IBWHO="i":PRCASV("DEBTOR"),1:"")
"RTN","IBCBB1",183,0)
 S PRCASV("CARE")=$E($$TOB^IBCEF1(IBIFN),1,2)
"RTN","IBCBB1",184,0)
 S PRCASV("FY")=$$FY^IBOUTL(DT)_U_($P(IBNDU1,U)-$P(IBNDU1,U,2))
"RTN","IBCBB1",185,0)
 ;S PRCASV("FY")=$P(IBNDU1,U,9)_U_$S($P(IBNDU1,U,2)]"":($P(IBNDU1,U,10)-$P(IBNDU1,U,2)),1:$P(IBNDU1,U,10))_$S($P(IBNDU1,U,11)]"":U_$P(IBNDU1,U,11)_U_$P(IBNDU1,U,12),1:"")
"RTN","IBCBB1",186,0)
PLUS I IBWHO="i",$P(IBNDM,"^",2),$D(^DIC(36,$P(IBNDM,"^",2),0)) S PRCASV("2NDINS")=$P(IBNDM,"^",2)
"RTN","IBCBB1",187,0)
 I IBWHO="i",$P(IBNDM,"^",3),$D(^DIC(36,$P(IBNDM,"^",3),0)) S PRCASV("3RDINS")=$P(IBNDM,"^",3)
"RTN","IBCBB1",188,0)
 ;
"RTN","IBCBB1",189,0)
 N IBX S IBX=$P(IBND0,U,21),IBX=$S(IBX="P":"I1",IBX="S":"I2",IBX="T":"I3",1:"") Q:IBX=""
"RTN","IBCBB1",190,0)
 N IBNDI1
"RTN","IBCBB1",191,0)
 Q:'$D(^DGCR(399,IBIFN,IBX))  S IBNDI1=^(IBX)
"RTN","IBCBB1",192,0)
 S:$P(IBNDI1,"^",3)]"" PRCASV("GPNO")=$P(IBNDI1,"^",3)
"RTN","IBCBB1",193,0)
 S:$P(IBNDI1,"^",15)]"" PRCASV("GPNM")=$P(IBNDI1,"^",15)
"RTN","IBCBB1",194,0)
 S:$P(IBNDI1,"^",17)]"" PRCASV("INPA")=$P(IBNDI1,"^",17)
"RTN","IBCBB1",195,0)
 S:$P(IBNDI1,"^",2)]"" PRCASV("IDNO")=$P(IBNDI1,"^",2),PRCASV("INID")=PRCASV("IDNO")
"RTN","IBCBB1",196,0)
 ; Check that this is a secondary or tertiary bill and insurance for previous
"RTN","IBCBB1",197,0)
 ; COB sequence is Medicare WNR and MRA is active --> send data elements to AR
"RTN","IBCBB1",198,0)
 I IBCOBN>1,$$WNRBILL^IBEFUNC(IBIFN,IBCOBN-1),$$EDIACTV^IBCEF4(2) D MRA
"RTN","IBCBB1",199,0)
 Q
"RTN","IBCBB1",200,0)
 ;
"RTN","IBCBB1",201,0)
MRA N IBEOB S IBEOB=0
"RTN","IBCBB1",202,0)
 ;
"RTN","IBCBB1",203,0)
 K PRCASV("MEDURE"),PRCASV("MEDCA")
"RTN","IBCBB1",204,0)
 ; Get EOB data
"RTN","IBCBB1",205,0)
 F  S IBEOB=$O(^IBM(361.1,"B",IBIFN,IBEOB)) Q:'IBEOB  D
"RTN","IBCBB1",206,0)
 . D MRACALC^IBCEMU2(IBEOB,IBIFN,1,.PRCASV)
"RTN","IBCBB1",207,0)
 Q  ;MRA
"RTN","IBCBB1",208,0)
 ;
"RTN","IBCBB1",209,0)
 ;; PREGNANCY DX CODES: V22**-V24**, V27**-V28**, 630**-677**
"RTN","IBCBB1",210,0)
 ;; FLU SHOTS PROCEDURE CODES: 90724, G0008, 90732, G0009
"RTN","IBCBB11")
0^36^B25129928
"RTN","IBCBB11",1,0)
IBCBB11 ;ALB/AAS - CONTINUATION OF EDIT CHECK ROUTINE ;12 Jun 2006  3:45 PM
"RTN","IBCBB11",2,0)
 ;;2.0;INTEGRATED BILLING;**51,343,363,371,395,392,401,384**;21-MAR-94;Build 74
"RTN","IBCBB11",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCBB11",4,0)
 ;
"RTN","IBCBB11",5,0)
WARN(IBDISP) ; Set warning in global
"RTN","IBCBB11",6,0)
 ; DISP = warning text to display
"RTN","IBCBB11",7,0)
 ;
"RTN","IBCBB11",8,0)
 N Z
"RTN","IBCBB11",9,0)
 S Z=+$O(^TMP($J,"BILL-WARN",""),-1)
"RTN","IBCBB11",10,0)
 I Z=0 S ^TMP($J,"BILL-WARN",1)=$J("",5)_"**Warnings**:",Z=1
"RTN","IBCBB11",11,0)
 S Z=Z+1,^TMP($J,"BILL-WARN",Z)=$J("",5)_IBDISP
"RTN","IBCBB11",12,0)
 Q
"RTN","IBCBB11",13,0)
 ;
"RTN","IBCBB11",14,0)
MULTDIV(IBIFN,IBND0) ; Check for multiple divisions on a bill ien IBIFN
"RTN","IBCBB11",15,0)
 ; IBND0 = 0-node of bill
"RTN","IBCBB11",16,0)
 ;
"RTN","IBCBB11",17,0)
 ;  Function returns 1 if more than 1 division found on bill
"RTN","IBCBB11",18,0)
 N Z,Z0,Z1,MULT
"RTN","IBCBB11",19,0)
 S MULT=0,Z1=$P(IBND0,U,22)
"RTN","IBCBB11",20,0)
 I Z1 D
"RTN","IBCBB11",21,0)
 . S Z=0 F  S Z=$O(^DGCR(399,IBIFN,"RC",Z)) Q:'Z  S Z0=$P(^(Z,0),U,7) I Z0,Z0'=Z1 S MULT=1 Q
"RTN","IBCBB11",22,0)
 . S Z=0 F  S Z=$O(^DGCR(399,IBIFN,"CP",Z)) Q:'Z  S Z0=$P(^(Z,0),U,6) I Z0,Z0'=Z1 S MULT=2 Q
"RTN","IBCBB11",23,0)
 I 'Z1 S MULT=3
"RTN","IBCBB11",24,0)
 Q MULT
"RTN","IBCBB11",25,0)
 ;
"RTN","IBCBB11",26,0)
 ;; PREGNANCY DX CODES: V22**-V24**, V27**-V28**, 630**-677**
"RTN","IBCBB11",27,0)
 ;; FLU SHOTS PROCEDURE CODES: 90724, G0008, 90732, G0009
"RTN","IBCBB11",28,0)
 ;
"RTN","IBCBB11",29,0)
 ; Check for required NPIs
"RTN","IBCBB11",30,0)
NPICHK ;
"RTN","IBCBB11",31,0)
 N IBNPIS,IBNONPI,IBNPIREQ,Z
"RTN","IBCBB11",32,0)
 S IBNPIREQ=$$NPIREQ^IBCEP81(DT)  ; Check if NPI is required
"RTN","IBCBB11",33,0)
 ; Check providers
"RTN","IBCBB11",34,0)
 S IBNPIS=$$PROVNPI^IBCEF73A(IBIFN,.IBNONPI)
"RTN","IBCBB11",35,0)
 I $L(IBNONPI) F Z=1:1:$L(IBNONPI,U) D
"RTN","IBCBB11",36,0)
 . I IBNPIREQ S IBER=IBER_"IB"_(140+$P(IBNONPI,U,Z))_";" Q  ; If required, set error
"RTN","IBCBB11",37,0)
 . D WARN("NPI for the "_$P("referring^operating^rendering^attending^supervising^^^^other",U,$P(IBNONPI,U,Z))_" provider has no value")  ; Else, set warning
"RTN","IBCBB11",38,0)
 ; Check organizations
"RTN","IBCBB11",39,0)
 S IBNONPI=""
"RTN","IBCBB11",40,0)
 S IBNPIS=$$ORGNPI^IBCEF73A(IBIFN,.IBNONPI)
"RTN","IBCBB11",41,0)
 I $L(IBNONPI) F Z=1:1:$L(IBNONPI,U) D
"RTN","IBCBB11",42,0)
 . ; Turn IB161, IB162 to a warning
"RTN","IBCBB11",43,0)
 . I IBNPIREQ,$P(IBNONPI,U,Z)=3 S IBER=IBER_"IB163;" Q
"RTN","IBCBB11",44,0)
 . ; PRXM/KJH - Changed descriptions.
"RTN","IBCBB11",45,0)
 . D WARN("NPI for the "_$P("Division^Non-VA Service Facility^Billing Provider",U,$P(IBNONPI,U,Z))_" has no value")  ; Else, set warning
"RTN","IBCBB11",46,0)
 Q
"RTN","IBCBB11",47,0)
 ;
"RTN","IBCBB11",48,0)
 ; Check for required taxonomies
"RTN","IBCBB11",49,0)
TAXCHK ;
"RTN","IBCBB11",50,0)
 N IBTAXS,IBNOTAX,IBTAXREQ,Z
"RTN","IBCBB11",51,0)
 S IBTAXREQ=$$TAXREQ^IBCEP81(DT)  ; Check if taxonomy is required
"RTN","IBCBB11",52,0)
 ; Check providers
"RTN","IBCBB11",53,0)
 S IBTAXS=$$PROVTAX^IBCEF73A(IBIFN,.IBNOTAX)
"RTN","IBCBB11",54,0)
 I $L(IBNOTAX) F Z=1:1:$L(IBNOTAX,U) D
"RTN","IBCBB11",55,0)
 . ; Only Referring, Rendering and Attending are currently sent to the payer
"RTN","IBCBB11",56,0)
 . I IBTAXREQ,"134"[$P(IBNOTAX,U,Z) S IBER=IBER_"IB"_(250+$P(IBNOTAX,U,Z))_";" Q  ; If required, set error
"RTN","IBCBB11",57,0)
 . D WARN("Taxonomy for the "_$P("referring^operating^rendering^attending^supervising^^^^other",U,$P(IBNOTAX,U,Z))_" provider has no value")  ; Else, set warning
"RTN","IBCBB11",58,0)
 ; Check organizations
"RTN","IBCBB11",59,0)
 S IBNOTAX=""
"RTN","IBCBB11",60,0)
 S IBTAXS=$$ORGTAX^IBCEF73A(IBIFN,.IBNOTAX)
"RTN","IBCBB11",61,0)
 I $L(IBNOTAX) F Z=1:1:$L(IBNOTAX,U) D
"RTN","IBCBB11",62,0)
 . ; Turn IB165, IB166 to a warning
"RTN","IBCBB11",63,0)
 . I IBTAXREQ,$P(IBNOTAX,U,Z)=3 S IBER=IBER_"IB167;" Q
"RTN","IBCBB11",64,0)
 . ; PRXM/KJH - Changed descriptions.
"RTN","IBCBB11",65,0)
 . D WARN("Taxonomy for the "_$P("Division^Non-VA Service Facility^Billing Provider",U,$P(IBNOTAX,U,Z))_" has no value")  ; Else, set warning
"RTN","IBCBB11",66,0)
 Q
"RTN","IBCBB11",67,0)
 ;
"RTN","IBCBB11",68,0)
VALNDC(IBIFN,IBDFN) ; IB*2*363 - validate NDC# between PRESCRIPTION file (#52)
"RTN","IBCBB11",69,0)
 ; and IB BILL/CLAIMS PRESCRIPTION REFILL file (#362.4)
"RTN","IBCBB11",70,0)
 ; input - IBIFN = internal entry number of the billing record in the BILL/CLAIMS file (#399)
"RTN","IBCBB11",71,0)
 ;         IBDFN = internal entry number of patient record in the PATIENT file (#2)
"RTN","IBCBB11",72,0)
 N IBX,IBRXCOL
"RTN","IBCBB11",73,0)
 ; call program that determines if NDC differences exist
"RTN","IBCBB11",74,0)
 D VALNDC^IBEFUNC3(IBIFN,IBDFN,.IBRXCOL)
"RTN","IBCBB11",75,0)
 Q:'$D(IBRXCOL)
"RTN","IBCBB11",76,0)
 ; at least one RX on the IB record has an NDC discrepancy 
"RTN","IBCBB11",77,0)
 S IBX=0 F  S IBX=$O(IBRXCOL(IBX)) Q:'IBX  D WARN("NDC# on Bill does not equal the NDC# on Rx "_IBRXCOL(IBX))
"RTN","IBCBB11",78,0)
 Q
"RTN","IBCBB11",79,0)
 ;
"RTN","IBCBB11",80,0)
PRIIDCHK ; Check for required Pimarary ID (SSN/EIN)
"RTN","IBCBB11",81,0)
 ; If the provider is on the claim, he must have one
"RTN","IBCBB11",82,0)
 ; 
"RTN","IBCBB11",83,0)
 N IBI,IBZ
"RTN","IBCBB11",84,0)
 I $$TXMT^IBCEF4(IBIFN) D
"RTN","IBCBB11",85,0)
 . D F^IBCEF("N-ALL ATT/REND PROV SSN/EI","IBZ",,IBIFN)
"RTN","IBCBB11",86,0)
 . S IBI="" F  S IBI=$O(^DGCR(399,IBIFN,"PRV","B",IBI)) Q:IBI=""  D
"RTN","IBCBB11",87,0)
 .. I $P(IBZ,U,IBI)="" S IBER=IBER_$S(IBI=1:"IB151;",IBI=2:"IB152;",IBI=3!(IBI=4):"IB321;",IBI=5:"IB153;",IBI=9:"IB154;",1:"")
"RTN","IBCBB11",88,0)
 Q
"RTN","IBCBB11",89,0)
 ;
"RTN","IBCBB11",90,0)
RXNPI(IBIFN) ; check for multiple pharmacy npi's on the same bill
"RTN","IBCBB11",91,0)
 N IBORG,IBRXNPI,IBX,IBY
"RTN","IBCBB11",92,0)
 S IBORG=$$RXSITE^IBCEF73A(IBIFN,.IBORG)
"RTN","IBCBB11",93,0)
 S IBX=0 F  S IBX=$O(IBORG(IBX)) Q:'IBX  S IBY=0 F  S IBY=$O(IBORG(IBX,IBY)) Q:'IBY  S IBRXNPI(+IBORG(IBX,IBY))=""
"RTN","IBCBB11",94,0)
 S (IBX,IBY)=0 F  S IBX=$O(IBRXNPI(IBX)) Q:'IBX  S IBY=IBY+1
"RTN","IBCBB11",95,0)
 I IBY>1 D WARN("Bill has prescriptions resulting from "_IBY_" different NPI locations")
"RTN","IBCBB11",96,0)
 Q
"RTN","IBCBB11",97,0)
 ;
"RTN","IBCBB11",98,0)
ROICHK(IBIFN,IBDFN,IBINS) ; IB*2.0*384 - check prescriptions that contain the
"RTN","IBCBB11",99,0)
 ; special handling code U against the Claims Tracking ROI file (#356.25)
"RTN","IBCBB11",100,0)
 ; to see if an ROI is on file
"RTN","IBCBB11",101,0)
 ; input - IBIFN = IEN of the Bill/Claims file (#399)
"RTN","IBCBB11",102,0)
 ;         IBDFN = IEN of the patient
"RTN","IBCBB11",103,0)
 ;         IBINS = IEN of the payer insurance company (#36)
"RTN","IBCBB11",104,0)
 ; OUTPUT - 0 = no error        
"RTN","IBCBB11",105,0)
 ;          1 = a prescription is sensitive and there is no ROI on file
"RTN","IBCBB11",106,0)
 ;
"RTN","IBCBB11",107,0)
 N IBX,IBY0,IBRXIEN,IBDT,IBDRUG,ROIQ
"RTN","IBCBB11",108,0)
 S ROIQ=0
"RTN","IBCBB11",109,0)
 S IBX=0 F  S IBX=$O(^IBA(362.4,"C",IBIFN,IBX)) Q:'IBX  D
"RTN","IBCBB11",110,0)
 .S IBY0=^IBA(362.4,IBX,0),IBRXIEN=$P(IBY0,U,5) I 'IBRXIEN Q
"RTN","IBCBB11",111,0)
 .S IBDT=$P(IBY0,U,3),IBDRUG=$P(IBY0,U,4)
"RTN","IBCBB11",112,0)
 .D ZERO^IBRXUTL(IBDRUG)
"RTN","IBCBB11",113,0)
 .I ^TMP($J,"IBDRUG",IBDRUG,3)["U" D
"RTN","IBCBB11",114,0)
 .. I $$ROI^IBNCPDR4(IBDFN,IBDRUG,IBINS,IBDT) Q  ;ROI is on file
"RTN","IBCBB11",115,0)
 .. D WARN("ROI not on file for prescription "_$$RXAPI1^IBNCPUT1(IBRXIEN,.01,"E"))
"RTN","IBCBB11",116,0)
 .. S ROIQ=1
"RTN","IBCBB11",117,0)
ROICHKQ ;
"RTN","IBCBB11",118,0)
 K ^TMP($J,"IBDRUG")
"RTN","IBCBB11",119,0)
 Q ROIQ
"RTN","IBCBB11",120,0)
 ;
"RTN","IBCD2")
0^37^B27925323
"RTN","IBCD2",1,0)
IBCD2 ;ALB/ARH - AUTOMATED BILLER (CREATE - SETUP/GATHER DATA FIELDS) ; 8/6/93
"RTN","IBCD2",2,0)
 ;;2.0;INTEGRATED BILLING;**4,55,91,106,384**;21-MAR-94;Build 74
"RTN","IBCD2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCD2",4,0)
 ;
"RTN","IBCD2",5,0)
FIND ;
"RTN","IBCD2",6,0)
 S IBX=$$CHKSYS^IBCD4 I 'IBX D TERR(0,0,$P(IBX,U,2)) G EXIT
"RTN","IBCD2",7,0)
 S IBS="IBC0" F  S IBS=$O(^TMP(IBS)) Q:IBS=""  S IBX=$E(IBS,4,99) Q:$E(IBS,1,3)'="IBC"!'+IBX  D
"RTN","IBCD2",8,0)
 . N IBQUERY
"RTN","IBCD2",9,0)
 . S IBDFN=0 F  S IBDFN=$O(^TMP(IBS,$J,IBDFN)) Q:'IBDFN  D
"RTN","IBCD2",10,0)
 .. S IBSTDT="" F  S IBSTDT=$O(^TMP(IBS,$J,IBDFN,IBSTDT)) Q:IBSTDT=""  D  I $D(IBCT)>9 D CREATE(.IBQUERY)
"RTN","IBCD2",11,0)
 ... K IBCT S IBTRN=0 F  S IBTRN=$O(^TMP(IBS,$J,IBDFN,IBSTDT,IBTRN)) Q:'IBTRN  S IBCT(IBTRN)="",IBTF=^TMP(IBS,$J,IBDFN,IBSTDT,IBTRN)
"RTN","IBCD2",12,0)
 .I $G(IBQUERY) D CLOSE^IBSDU(IBQUERY)
"RTN","IBCD2",13,0)
EXIT K IBS,IBDFN,IBSTDT,IBCT,IBTRN,IBTF,IBX,X,DFN
"RTN","IBCD2",14,0)
 Q
"RTN","IBCD2",15,0)
 ;
"RTN","IBCD2",16,0)
CREATE(IBQUERY) ;set up a bill,  required: IBCT(IBTRN),IBDFN,IBSTDT
"RTN","IBCD2",17,0)
 ; IBQUERY, if defined, will be used to activate the outpt visit QUERY
"RTN","IBCD2",18,0)
 Q:$D(IBCT)<9  K IB
"RTN","IBCD2",19,0)
 S IBSP=$G(^IBE(350.9,1,1)),IBDIV=$P(IBSP,U,25),IBTRN=+$O(IBCT(0))
"RTN","IBCD2",20,0)
 S IBTRND=$G(^IBT(356,IBTRN,0)) I 'IBTRND D TERR(+IBTRN,0,"Claims Tracking Record not found or not complete.") G QUIT
"RTN","IBCD2",21,0)
 S IBTYPE=$P(IBTRND,U,18) S IBX=$$CHK I 'IBX D TERR(+IBTRN,0,$P(IBX,U,2)) G QUIT
"RTN","IBCD2",22,0)
 ;
"RTN","IBCD2",23,0)
 S IBX=$$ARSET I 'IBX D TERR(IBTRN,0,$P(IBX,U,2)) G QUIT
"RTN","IBCD2",24,0)
 S IBIFN=+IBX,IB(.01)=$P(IBX,U,2),IB(.17)=$P(IBX,U,3),IB(.2)=1,IB(.22)=IBDIV
"RTN","IBCD2",25,0)
 S (IB(.02),DFN)=IBDFN,IB(.06)=IBTF
"RTN","IBCD2",26,0)
 S IB(.07)=$O(^DGCR(399.3,"B","REIMBURSABLE INS.",0)) I 'IB(.07) S IB(.07)=8
"RTN","IBCD2",27,0)
 S IBX=$O(^IBT(356.2,"ATRTP",IBTRN,1,"")) I +IBX S IB(163)=$P($G(^IBT(356.2,IBX,0)),U,28) ;pre-cert #
"RTN","IBCD2",28,0)
 ;
"RTN","IBCD2",29,0)
 S IBX=$P($G(^IBE(356.6,+IBTYPE,0)),U,1)
"RTN","IBCD2",30,0)
 I IBX="INPATIENT ADMISSION" D INPT^IBCD5 G CONT
"RTN","IBCD2",31,0)
 I IBX="PRESCRIPTION REFILL" D RXRF G CONT
"RTN","IBCD2",32,0)
 I IBX="OUTPATIENT VISIT" D OUTPT G CONT
"RTN","IBCD2",33,0)
 G QUIT
"RTN","IBCD2",34,0)
 ;
"RTN","IBCD2",35,0)
CONT S IBX=$$BDT^IBCU3(IBDFN,IB(.03)) S IB(.17)=$S(+IBX:IBX,1:IBIFN) ; continuing episode of care
"RTN","IBCD2",36,0)
 ;Note if a primary bill is found for an outpatient bill then it allows them to choose the bill during bill creation,  .17 is not editable on the screens
"RTN","IBCD2",37,0)
 S IB(.18)=$$SC^IBCU3(IBDFN) ; SC at time of care
"RTN","IBCD2",38,0)
 ;
"RTN","IBCD2",39,0)
 ; Note: variable IBQUERY used in this call to ^IBCD3
"RTN","IBCD2",40,0)
 D EN^IBCD3(.IBQUERY) ; create bill
"RTN","IBCD2",41,0)
 ;
"RTN","IBCD2",42,0)
 S IBTRN=0 F  S IBTRN=$O(IBCT(IBTRN)) Q:'IBTRN  D
"RTN","IBCD2",43,0)
 . D TERR(IBTRN,IBIFN,"") ; bill created
"RTN","IBCD2",44,0)
 . I ",2,3,"'[+$G(IB(.06)) D TEABD(IBTRN,0) ; remove eabd for final bills
"RTN","IBCD2",45,0)
 . D TBILL(IBTRN,IBIFN) ; set index for bill and event (356.399)
"RTN","IBCD2",46,0)
 . I $O(IB(43,0)),$$NABSCT^IBCU81(IBTRN) D TERR(IBTRN,IBIFN,"Stop/Clinic flagged to be ignored by auto biller but another visit is billed on same date.")
"RTN","IBCD2",47,0)
 . I $O(IB(43,0)),$$NBOE^IBCU81(+$P($G(^IBT(356,+IBTRN,0)),U,4)) D TERR(IBTRN,IBIFN,"Visit flagged as SC in source file but has no RNB.")
"RTN","IBCD2",48,0)
 ;
"RTN","IBCD2",49,0)
 S IBTRN=$O(IBCT(IBTRN)) Q:'IBTRN  D
"RTN","IBCD2",50,0)
 . I $G(IB(.05))>2,$G(IB(.27))=1,+$G(^DGCR(399,IBIFN,"MP")),'$O(^DGCR(399,IBIFN,"RC",0)) D TERR(IBTRN,IBIFN,"This RC Opt bill appears to have no institutional charges but may have professional charges.")
"RTN","IBCD2",51,0)
 ;
"RTN","IBCD2",52,0)
 S X=$$PRCDIV^IBCU71(IBIFN) ; reset bill division from site default to first procedures division
"RTN","IBCD2",53,0)
 ;
"RTN","IBCD2",54,0)
QUIT K X,Y,IBX,IBY,IBSP,IBDIV,IBTRN,IBTRND,IBTYPE,IB
"RTN","IBCD2",55,0)
 Q
"RTN","IBCD2",56,0)
 ;
"RTN","IBCD2",57,0)
OUTPT S IB(.04)=$S(+$P($G(^DG(40.8,+IBDIV,0)),U,3):7,1:1) ;division outpatient only or hospital
"RTN","IBCD2",58,0)
 S IB(.05)=3,IB(.06)=1,IB(.09)=4
"RTN","IBCD2",59,0)
 ;event dt is date of first visit, stmt from is first visit dt, stmt to is last visit dt on bill
"RTN","IBCD2",60,0)
 S (IB(.03),IB(151))=9999999,IB(152)=""
"RTN","IBCD2",61,0)
 S IBTRNX=0 F  S IBTRNX=$O(IBCT(IBTRNX)) Q:'IBTRNX  S IBX=$P($G(^IBT(356,IBTRNX,0)),U,6)\1 D
"RTN","IBCD2",62,0)
 . S IB(43,+IBX)="" S:IB(152)<IBX IB(152)=IBX F IBI=.03,151 I IB(IBI)>IBX S IB(IBI)=IBX
"RTN","IBCD2",63,0)
 I +$$BILLRATE^IBCRU3(+$G(IB(.07)),IB(.05),IB(.03),"RC") S IB(.27)=1 ; reasonable charges institutional bill
"RTN","IBCD2",64,0)
 K IBI,IBX,IBTRNX
"RTN","IBCD2",65,0)
 Q
"RTN","IBCD2",66,0)
RXRF S IB(.04)=$S(+$P($G(^DG(40.8,+IBDIV,0)),U,3):7,1:1) ;division outpatient only or hospital
"RTN","IBCD2",67,0)
 S IB(.05)=3,IB(.06)=1
"RTN","IBCD2",68,0)
 ;event dt is date of first visit, stmt from is first visit dt, stmt to is last visit dt on bill
"RTN","IBCD2",69,0)
 S (IB(.03),IB(151))=9999999,IB(152)=""
"RTN","IBCD2",70,0)
 S IBTRNX=0 F  S IBTRNX=$O(IBCT(IBTRNX)) Q:'IBTRNX  S IBRX=$G(^IBT(356,IBTRNX,0)) D
"RTN","IBCD2",71,0)
 . S IBX=$$RXRF^IBCD4(+$P(IBRX,U,8),+$P(IBRX,U,10)),IB(362.4,+$P(IBRX,U,8),+$P(IBRX,U,10))=IBX,IBX=$P(IBX,U,4)
"RTN","IBCD2",72,0)
 . S:IB(152)<IBX IB(152)=IBX F IBI=.03,151 I IB(IBI)>IBX S IB(IBI)=IBX
"RTN","IBCD2",73,0)
 . I $P(IBRX,U,31)>1 D  ;special consent roi
"RTN","IBCD2",74,0)
 .. S IB(155)=1,IB(157)=0 ; is dx sensitive
"RTN","IBCD2",75,0)
 .. I $P(IBRX,U,31)=2 S IB(157)=1 ; ROI obtained
"RTN","IBCD2",76,0)
 K IBI,IBX,IBTRNX,IBRX
"RTN","IBCD2",77,0)
 Q
"RTN","IBCD2",78,0)
 ;
"RTN","IBCD2",79,0)
ARSET() ; set up entry for new bill in AR returns IFN, bill number
"RTN","IBCD2",80,0)
 ;otherwise "0^error meaasge"
"RTN","IBCD2",81,0)
 N X S X="0^Can not set up bill in AR."
"RTN","IBCD2",82,0)
 S PRCASV("SER")=$P($G(^IBE(350.9,1,1)),U,14),PRCASV("SITE")=+$P($$SITE^VASITE,U,3)
"RTN","IBCD2",83,0)
 D SETUP^PRCASVC3
"RTN","IBCD2",84,0)
 I $P(PRCASV("ARBIL"),U)=-1 S X="0^"_$P(PRCASV("ARBIL"),U,2)_" - "_$$ETXT^IBEFUNC($P(PRCASV("ARBIL"),U,2)) G ARSETQ
"RTN","IBCD2",85,0)
 I $P(PRCASV("ARREC"),U)=-1 S X="0^"_$P(PRCASV("ARREC"),U,2)_" - "_$$ETXT^IBEFUNC($P(PRCASV("ARREC"),U,2)) G ARSETQ
"RTN","IBCD2",86,0)
 S X=PRCASV("ARREC")_U_$P(PRCASV("ARBIL"),"-",2)
"RTN","IBCD2",87,0)
ARSETQ K PRCASV
"RTN","IBCD2",88,0)
 Q X
"RTN","IBCD2",89,0)
 ;
"RTN","IBCD2",90,0)
CHK() ;other checks
"RTN","IBCD2",91,0)
 N X S X=1 I $G(^DPT(+$G(IBDFN),0))="" S X="0^Patient information lacking."
"RTN","IBCD2",92,0)
 Q X
"RTN","IBCD2",93,0)
 ;
"RTN","IBCD2",94,0)
TEABD(TRN,IBDT) ;
"RTN","IBCD2",95,0)
 S IBDT=+$G(IBDT),^TMP("IBEABD",$J,+TRN,+IBDT)=""
"RTN","IBCD2",96,0)
 Q
"RTN","IBCD2",97,0)
TERR(TRN,IFN,ER) ;
"RTN","IBCD2",98,0)
 N X S TRN=+$G(TRN),IFN=+$G(IFN),X=+$G(^TMP("IBCE",$J,DT,TRN,IFN))+1
"RTN","IBCD2",99,0)
 S ^TMP("IBCE",$J,DT,TRN,IFN,X)=$G(ER),^TMP("IBCE",$J,DT,TRN,IFN)=X
"RTN","IBCD2",100,0)
 Q
"RTN","IBCD2",101,0)
TBILL(TRN,IFN) ;
"RTN","IBCD2",102,0)
 I '$D(^IBT(356,+$G(TRN),0))!('$D(^DGCR(399,+$G(IFN),0))) Q
"RTN","IBCD2",103,0)
 S ^TMP("IBILL",$J,TRN,IFN)=""
"RTN","IBCD2",104,0)
 Q
"RTN","IBCD3")
0^38^B31598371
"RTN","IBCD3",1,0)
IBCD3 ;ALB/ARH - AUTOMATED BILLER (ADD NEW BILL - CREATE BILL ENTRY) ;9/5/93
"RTN","IBCD3",2,0)
 ;;2.0;INTEGRATED BILLING;**14,55,52,91,106,125,51,148,160,137,210,245,260,405,384**;21-MAR-94;Build 74
"RTN","IBCD3",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCD3",4,0)
 ;
"RTN","IBCD3",5,0)
 ;Called by IBCD2,IBACUS2
"RTN","IBCD3",6,0)
 ;
"RTN","IBCD3",7,0)
EN(IBQUERY) ;
"RTN","IBCD3",8,0)
 N IBI,IBX,IBY,I,X,X1,X2,IBAC,IBCPY K IBDR,IBDR222 S IBAC=1
"RTN","IBCD3",9,0)
 S X=$P($T(WHERE),";;",2),X2=$P($T(WHERE+1),";;",2) F I=0:0 S I=$O(IB(I)) Q:'I  S X1=$P($E(X,$F(X,I)+1,999),";",1) S:X1="" X1=$P($E(X2,$F(X2,I)+1,999),";",1) I $D(IB(I))=1 S $P(IBDR($P(X1,"^",1)),"^",$P(X1,"^",2))=IB(I)
"RTN","IBCD3",10,0)
 F I=0,"C","M","M1","S","U","U1","U2" I $D(IBDR(I)) S ^DGCR(399,IBIFN,I)=IBDR(I)
"RTN","IBCD3",11,0)
 S $P(^DGCR(399,0),"^",3)=IBIFN,$P(^(0),"^",4)=$P(^(0),"^",4)+1
"RTN","IBCD3",12,0)
 S DIK="^DGCR(399,",DA=IBIFN D IX1^DIK K DA,DIK ; set cross-references
"RTN","IBCD3",13,0)
 ;
"RTN","IBCD3",14,0)
 ; Set the attending/rendering provider into provider multiple
"RTN","IBCD3",15,0)
 I $G(IB("PRV",.01))'="" D
"RTN","IBCD3",16,0)
 . S DIC("DR")="",I=.01
"RTN","IBCD3",17,0)
 . N IBV
"RTN","IBCD3",18,0)
 . F  S I=$O(IB("PRV",I)) Q:'I  I IB("PRV",I)'="" S IBV(I)=IB("PRV",I),DIC("DR")=DIC("DR")_$S(DIC("DR")="":"",1:";")_I_"////^S X=IBV("_I_")"
"RTN","IBCD3",19,0)
 . S DIC="^DGCR(399,"_IBIFN_",""PRV"",",DIC(0)="L",DLAYGO=399,DA(1)=IBIFN,X=IB("PRV",.01)
"RTN","IBCD3",20,0)
 . K DO,DD D FILE^DICN K DO,DD,DLAYGO,DA,DIC
"RTN","IBCD3",21,0)
 ;
"RTN","IBCD3",22,0)
 ; Set the occurrence span codes for leave/pass days
"RTN","IBCD3",23,0)
 I $O(IB("OC",0)) D
"RTN","IBCD3",24,0)
 . N I,I1
"RTN","IBCD3",25,0)
 . S I1=0 F  S I1=$O(IB("OC",I1)) Q:'I1  D
"RTN","IBCD3",26,0)
 .. S I=0,DIC("DR")=""
"RTN","IBCD3",27,0)
 .. F  S I=$O(IB("OC",I1,I)) Q:'I  S DIC("DR")=DIC("DR")_$S(DIC("DR")="":"",1:";")_I_"////"_IB("OC",I1,I)
"RTN","IBCD3",28,0)
 .. S DIC="^DGCR(399,"_IBIFN_",""OC"",",DIC(0)="L",DLAYGO=399,DA(1)=IBIFN,DIC("P")=$$GETSPEC^IBEFUNC(399,41),X=IB("OC")
"RTN","IBCD3",29,0)
 .. K DO,DD D FILE^DICN K DO,DD,DLAYGO,DA,DIC
"RTN","IBCD3",30,0)
 ;
"RTN","IBCD3",31,0)
 ; file rx refills, default CPT and Dx if defined
"RTN","IBCD3",32,0)
 I $D(IB(362.4))>2 D  G END
"RTN","IBCD3",33,0)
 . N IBZ
"RTN","IBCD3",34,0)
 . S IBRX=0 F  S IBRX=$O(IB(362.4,IBRX)) Q:'IBRX  S IBY="" F  S IBY=$O(IB(362.4,IBRX,IBY)) Q:IBY=""  D
"RTN","IBCD3",35,0)
 .. S IBX=IB(362.4,IBRX,IBY) Q:IBX=""
"RTN","IBCD3",36,0)
 .. S IBZ=$$ADD^IBCSC5A($P(IBX,U),IBIFN,$P(IBX,U,4),$P(IBX,U,2),+IBRX,$P(IBX,U,3)_U_$P(IBX,U,5)_U_$P(IBX,U,6),IBY)
"RTN","IBCD3",37,0)
 ;
"RTN","IBCD3",38,0)
 ;file outpatient visit dates and find/store outpatient procedures and dx
"RTN","IBCD3",39,0)
 ;NOTE: If IBQUERY is defined at this point, it will be used to perform
"RTN","IBCD3",40,0)
 ;       the scan for outpatient procedures
"RTN","IBCD3",41,0)
 I '$$INPAT^IBCEF(IBIFN) D  G END
"RTN","IBCD3",42,0)
 . I $D(IB(43))>2 D
"RTN","IBCD3",43,0)
 .. S ^DGCR(399,IBIFN,"OP",0)="^399.043DA^" S IBX=0 F  S IBX=$O(IB(43,IBX)) Q:'IBX  D
"RTN","IBCD3",44,0)
 ... S DIC="^DGCR(399,"_IBIFN_",""OP"",",DIC(0)="L",DA(1)=IBIFN,(DINUM,X)=IBX,DLAYGO=399.043 K DD,DO D FILE^DICN K DIC,DA,DINUM,DO,DD,DLAYGO
"RTN","IBCD3",45,0)
 . ;
"RTN","IBCD3",46,0)
 . D VST^IBCCPT(.IBQUERY) I $D(^UTILITY($J,"CPT-CNT")) D
"RTN","IBCD3",47,0)
 .. N IBPRX
"RTN","IBCD3",48,0)
 .. S DIC("P")=$$GETSPEC^IBEFUNC(399,304)
"RTN","IBCD3",49,0)
 .. S IBY=0 F  S IBY=$O(^UTILITY($J,"CPT-CNT",IBY)) Q:'IBY  S IBX=^(IBY) I '$P(IBX,U,6) D
"RTN","IBCD3",50,0)
 ... S IBPRX(+$P(IBX,U,8))=""
"RTN","IBCD3",51,0)
 ... S DIC="^DGCR(399,"_IBIFN_",""CP"",",DIC(0)="L",DA(1)=IBIFN,X=+IBX_";ICPT(",DLAYGO=399 K DD,DO D FILE^DICN K DO,DD,DLAYGO Q:Y'>0
"RTN","IBCD3",52,0)
 ... ;
"RTN","IBCD3",53,0)
 ... S IBCPY=+Y
"RTN","IBCD3",54,0)
 ... ;
"RTN","IBCD3",55,0)
 ... ; add dx to 362.3 for associations if they exist
"RTN","IBCD3",56,0)
 ... I $G(^UTILITY($J,"CPT-CNT",IBY,"DX")) D ADDDX^IBCCPT1(IBIFN,IBCPY,^("DX"),.IBDR) I $L($G(IBDR)) S IBDR=IBDR_";"
"RTN","IBCD3",57,0)
 ... ;
"RTN","IBCD3",58,0)
 ... ;
"RTN","IBCD3",59,0)
 ... S DR=$G(IBDR)_"1////"_$P(IBX,U,2)_$S(+$P(IBX,U,8):";18////"_+$P(IBX,U,8),1:"") K IBDR
"RTN","IBCD3",60,0)
 ... S DR=DR_$S(+$P(IBX,U,9):";6////"_+$P(IBX,U,9),1:"")_$S(+$P(IBX,U,5):";5////"_+$P(IBX,U,5),1:"")
"RTN","IBCD3",61,0)
 ... S DR=DR_$S(+$P(IBX,U,11):";20////"_+$P(IBX,U,11),1:"")
"RTN","IBCD3",62,0)
 ... S DIE=DIC,DA=+IBCPY D ^DIE K DIE,DIC,DA,DINUM,DO,DD
"RTN","IBCD3",63,0)
 ... I $P(IBX,U,10) D ADDMOD^IBCCPT(IBIFN,IBCPY,$P(IBX,U,10)) ;Modifiers
"RTN","IBCD3",64,0)
 .. I $O(IBPRX(""))=$O(IBPRX(""),-1),$O(IBPRX(0)) D
"RTN","IBCD3",65,0)
 ... ;If only 1 provider - make it the rendering
"RTN","IBCD3",66,0)
 ... S IB("PRV",.02)=+$O(IBPRX(0))_";VA(200,",IB("PRV",.01)=3
"RTN","IBCD3",67,0)
 . K DGCNT,V,IBOPV1,IBOPV2,I,DGDIV,I1,DGNOD,DGCPTS,I7,I2,DGCPT,^UTILITY($J,"CPT-CNT")
"RTN","IBCD3",68,0)
 . ;
"RTN","IBCD3",69,0)
 . D OPTDX^IBCSC4D(DFN,IB(151),IB(152),.IBDX) I +IBDX D  K IBDX
"RTN","IBCD3",70,0)
 .. S IBY=0 F  S IBY=$O(IBDX(IBY)) Q:IBY=""  S IBX=IBDX(IBY) I '$P(IBX,U,5) D
"RTN","IBCD3",71,0)
 ... I '$D(^DGCR(399,"AOPV",DFN,(+$P(IBX,U,4)\1),IBIFN)) Q
"RTN","IBCD3",72,0)
 ... S DIC("DR")=".02////"_IBIFN,DIC="^IBA(362.3,",DIC(0)="L",X=+IBX,DLAYGO=362.3 K DD,DO D FILE^DICN
"RTN","IBCD3",73,0)
 ... K DIE,DIC,DA,DLAYGO,DO,DD
"RTN","IBCD3",74,0)
 ;
"RTN","IBCD3",75,0)
 ;store inpatient diagnosis and procedures, default admit dx to first dx found
"RTN","IBCD3",76,0)
 I $$INPAT^IBCEF(IBIFN) D  G END
"RTN","IBCD3",77,0)
 . I $G(^TMP("IBDX",$J))=IB(.08) D  K ^TMP("IBDX",$J)
"RTN","IBCD3",78,0)
 .. N IBXDEF S IBXDEF=0
"RTN","IBCD3",79,0)
 .. S (IBI,IBX)="" F  S IBX=$O(^TMP("IBDX",$J,IBX)) Q:'IBX  S IBY=0 F  S IBY=$O(^TMP("IBDX",$J,IBX,IBY)) Q:'IBY  D
"RTN","IBCD3",80,0)
 ... S IBZ=^TMP("IBDX",$J,IBX,IBY) Q:($$ICD9^IBACSV(+IBZ)="")  S IBI=IBI+1
"RTN","IBCD3",81,0)
 ... S DIC("DR")=".02////"_IBIFN_";.03////"_IBI,DIC="^IBA(362.3,",DIC(0)="L",X=+IBZ,DLAYGO=362.3 K DD,DO D FILE^DICN
"RTN","IBCD3",82,0)
 ... K DIE,DIC,DA,DLAYGO,DO,DD
"RTN","IBCD3",83,0)
 ... I Y>0,'IBXDEF S IBXDEF=1,DR="215////"_+IBZ,DIE="^DGCR(399,",DA=IBIFN D ^DIE
"RTN","IBCD3",84,0)
 . ;
"RTN","IBCD3",85,0)
 . D IPRC^IBCD4(+IB(.08),IB(151),IB(152)) I $D(^TMP("IBIPRC",$J)) D  K ^TMP("IBIPRC",$J)
"RTN","IBCD3",86,0)
 .. S ^DGCR(399,IBIFN,"CP",0)="^399.0304AVI^"
"RTN","IBCD3",87,0)
 .. S IBX=0 F  S IBX=$O(^TMP("IBIPRC",$J,IBX)) Q:'IBX  D
"RTN","IBCD3",88,0)
 ... S IBY=^TMP("IBIPRC",$J,IBX) F IBI=1:1 S IBZ=$P(IBY,U,IBI) Q:'IBZ  D
"RTN","IBCD3",89,0)
 .... S DIC="^DGCR(399,"_IBIFN_",""CP"",",DIC(0)="L",DA(1)=IBIFN,X=+IBZ_";ICD0(",DLAYGO=399.0304 K DD,DO D FILE^DICN
"RTN","IBCD3",90,0)
 .... I Y>0 S DIE=DIC,DA=+Y,DR="1////"_(IBX\1) D ^DIE K DIE,DIC,DA,DLAYGO,DO,DD
"RTN","IBCD3",91,0)
 ;
"RTN","IBCD3",92,0)
END S IBX="1^Billing Record #"_$P(^DGCR(399,+IBIFN,0),"^",1)_" established for "_$P($G(^DPT(IBDFN,0)),U,1)
"RTN","IBCD3",93,0)
 ;
"RTN","IBCD3",94,0)
 S IBAUTO=1,DGPTUPDT="" I '$G(IBCHTRN) D PROC^IBCU7A(IBIFN) D ^IBCU6 ; auto calculate/store revenue codes
"RTN","IBCD3",95,0)
 ;
"RTN","IBCD3",96,0)
Q K %,%DT,IBDR,X1,X2,X3,X4,Y,DGDIRA,DGDIRB,DGDIR0,DIR,DGRVRCAL,DIC,DA,DR,DINUM,DGPTUPDT,DGXRF1,IBCHK,IBINDT,IBIDS,DLAYGO
"RTN","IBCD3",97,0)
 Q
"RTN","IBCD3",98,0)
 ;
"RTN","IBCD3",99,0)
WHERE ;;.01^0^1;.02^0^2;.03^0^3;.04^0^4;.05^0^5;.06^0^6;.07^0^7;.08^0^8;.09^0^9;.11^0^11;.17^0^17;.16^0^16;.18^0^18;.19^0^19;.2^0^20;.22^0^22;.27^0^27;112^M^12;151^U^1;152^U^2;155^U^5;157^U^7;101^M^1;158^U^8;159^U^9;160^U^10;161^U^11;162^U^12;
"RTN","IBCD3",100,0)
 ;;217^U2^3;221^U2^7;
"RTN","IBCU")
0^44^B57580772
"RTN","IBCU",1,0)
IBCU ;ALB/MRL - BILLING UTILITY ROUTINE ;01 JUN 88 12:00
"RTN","IBCU",2,0)
 ;;2.0;INTEGRATED BILLING;**52,106,51,191,232,323,320,384**;21-MAR-94;Build 74
"RTN","IBCU",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBCU",4,0)
 ;
"RTN","IBCU",5,0)
 ;MAP TO DGCRU
"RTN","IBCU",6,0)
 ;
"RTN","IBCU",7,0)
ARSTAT ;find status of bill in file 430.3 (ar) return status number
"RTN","IBCU",8,0)
 S IBARST=$$STA^PRCAFN(IBIFN)
"RTN","IBCU",9,0)
 Q
"RTN","IBCU",10,0)
 ;
"RTN","IBCU",11,0)
ARCAT ;Trigger logic to set who's responsible in 399.3 from AR Category
"RTN","IBCU",12,0)
 S X=$P($$CATN^PRCAFN($P(^DGCR(399.3,DA,0),"^",6)),"^",3)
"RTN","IBCU",13,0)
 S:X'="" X=$S("PC"[X:"p",X="N":"o",X="T":"i",1:"")
"RTN","IBCU",14,0)
 Q
"RTN","IBCU",15,0)
 ;
"RTN","IBCU",16,0)
PTF ;Screen for appropriate PTF records
"RTN","IBCU",17,0)
 K IBDD1 S DFN=+$P(^DGCR(399,+DA,0),"^",2) Q:'$D(^DPT(+DFN,0))  S IB05=$P(^(0),"^",1),IB03=$P(^DGCR(399,+DA,0),"^",3)
"RTN","IBCU",18,0)
 S IB01="",IB02=0 F IB02=0:0 S IB01=$O(^DD(45,0,"ID",IB01)) Q:'IB01  S IB02=IB02+1,IBDD(IB02)=^(IB01)
"RTN","IBCU",19,0)
 F IB01=0:0 S IB01=$O(^DGPT("B",+DFN,IB01)) Q:'IB01  I $D(^DGPT(+IB01,0)) S IB04=$P(^(0),"^",2),Y=+IB01 I $P(IB03,".",1)=$P(IB04,".",1) S IBDD1(+Y)="" I $S('$D(X):0,X["?":1,1:0) D PTFW
"RTN","IBCU",20,0)
 G PTFQ:X'["?" I '$O(IBDD1(0)) W !,"Patient has no ACTIVE PTF RECORDS for this event date.",!,"A 'PTF NUMBER' is required for inpatient billing records."
"RTN","IBCU",21,0)
 E  W !!,"Select the appropriate billing record from the above listing by number."
"RTN","IBCU",22,0)
PTFQ W ! K IB01,IB02,IB03,IB04,IB05,IBDD Q
"RTN","IBCU",23,0)
PTFW W !,Y,?15,IB05 F IB02=0:0 S IB02=$O(IBDD(IB02)) Q:'IB02  X IBDD(IB02)
"RTN","IBCU",24,0)
 Q
"RTN","IBCU",25,0)
 ;
"RTN","IBCU",26,0)
AGE ;Input Transform for Condition Code 17
"RTN","IBCU",27,0)
 I X=18 G SEX
"RTN","IBCU",28,0)
 I X=17 S IBC=X,DFN=$P(^DGCR(399,D0,0),"^",2) D DEM^VADPT I VADM(4)<100 W !!,"This patient is only ",VADM(4)," years old!!",!! K IBC Q
"RTN","IBCU",29,0)
 I $D(IBC) S X=IBC
"RTN","IBCU",30,0)
 Q
"RTN","IBCU",31,0)
 ;
"RTN","IBCU",32,0)
SEX ;Input Transform for Condition Code 18
"RTN","IBCU",33,0)
 I X=18 S IBC=X,DFN=$P(^DGCR(399,D0,0),"^",2) D DEM^VADPT I $E(VADM(5))="M" W !!,"This patient is a MALE!! Condition code 18 applies only to FEMALES!!",!! K IBC,X
"RTN","IBCU",34,0)
 I $D(IBC) S X=IBC
"RTN","IBCU",35,0)
 Q
"RTN","IBCU",36,0)
 ;
"RTN","IBCU",37,0)
REV ;Input Transform for Revenue Code
"RTN","IBCU",38,0)
 I X=-1 W !!,"Choose only ACTIVE Revenue Codes!!",!! S D="AC" ;S X="" S X=$O(^DGCR(399.2,"AC",X)) Q:X=""  W !,$P(^DGCR(399.2,X,0),"^",1),?30,$P(^(0),"^",2) K X Q
"RTN","IBCU",39,0)
 I '$D(IBC) I $D(^DGCR(399.2,X,0)) I '$P(^DGCR(399.2,X,0),"^",3) W !!,"Only ACTIVE Revenue Codes may be selected!!",!! K X Q
"RTN","IBCU",40,0)
 Q
"RTN","IBCU",41,0)
 ;
"RTN","IBCU",42,0)
YN S X=$E(X),X=$S(X=1:X,X=0:X,X="Y":1,X="y":1,X="n":0,X="N":0,1:2) I X'=2 D EN^DDIOL("  ("_$S(X:"YES",1:"NO")_")","","?0") Q
"RTN","IBCU",43,0)
 D EN^DDIOL("NOT A VALID CHOICE!","","!?4") K X Q
"RTN","IBCU",44,0)
 Q
"RTN","IBCU",45,0)
 ;
"RTN","IBCU",46,0)
NOPTF ; Input transform for file 399, field 159.5 (NON-VA ADMIT TIME)
"RTN","IBCU",47,0)
 N %DT
"RTN","IBCU",48,0)
 I X>24 K:X'=99 X Q
"RTN","IBCU",49,0)
 I $P($G(^DGCR(399,DA,0)),U,8) K X Q  ; PTF pointer exists 
"RTN","IBCU",50,0)
 S X=$TR(X,"M ") S:X=0 X="12A" S:X<12 X=$TR(X,"A")
"RTN","IBCU",51,0)
 S:X?1N.N&($L(X)<3) Y="."_$E("0",$L(X))_X S:X'?1.2N %DT="TPR",X=DT_"@"_X D:$L(X)>2 ^%DT S X=$E($P(Y,".",2)_"00",1,2)#24 K:Y=-1 X
"RTN","IBCU",52,0)
 Q
"RTN","IBCU",53,0)
 ;
"RTN","IBCU",54,0)
DIS ;Determine Billing Discharge status from PTF
"RTN","IBCU",55,0)
 ;Called from triggers on fields .08 and 161
"RTN","IBCU",56,0)
 N A
"RTN","IBCU",57,0)
 I '$D(^DGCR(399,DA,0)) S X="" G DISQ
"RTN","IBCU",58,0)
 S X=$P(^DGCR(399,DA,0),"^",6) I X=2!(X=3) S X=$O(^DGCR(399.1,"B","STILL PATIENT",0)) G DISQ
"RTN","IBCU",59,0)
 S X=$P(^DGCR(399,DA,0),"^",8) I $S(X="":1,'$D(^DGPT(X)):1,1:0) S X="" G DISQ
"RTN","IBCU",60,0)
 I '+$G(^DGPT(X,70)) S X=$O(^DGCR(399.1,"B","STILL PATIENT",0)) G DISQ
"RTN","IBCU",61,0)
 S A=$P($G(^DGCR(399,DA,"U")),"^",2) I A,(A+.24)<+$G(^DGPT(X,70)) S X=$O(^DGCR(399.1,"B","STILL PATIENT",0)) G DISQ
"RTN","IBCU",62,0)
 S X=+$P($G(^DGPT(X,70)),"^",3)
"RTN","IBCU",63,0)
 I X=1 S X=$O(^DGCR(399.1,"B",$E("DISCHARGED TO HOME OR SELF CARE",1,30),0)) G DISQ
"RTN","IBCU",64,0)
 I X=4 S X=$O(^DGCR(399.1,"B",$E("LEFT AGAINST MEDICAL ADVICE",1,30),0)) G DISQ
"RTN","IBCU",65,0)
 I X=6!(X=7) S X=$O(^DGCR(399.1,"B","EXPIRED",0)) G DISQ
"RTN","IBCU",66,0)
 I X=5!(X=2) S X=$O(^DGCR(399.1,"B",$E("DISCHARGED TO ANOTHER SHORT-TERM GENERAL HOSPITAL",1,30),0)) G DISQ
"RTN","IBCU",67,0)
 S X=""
"RTN","IBCU",68,0)
DISQ Q
"RTN","IBCU",69,0)
 ;
"RTN","IBCU",70,0)
INST ;Ask Institutution address info
"RTN","IBCU",71,0)
 S DIC("DR")="1.01;1.02;1.03;.02;1.04" I $D(^XUSEC("IB SUPERVISOR",DUZ)) S DLAYGO=4
"RTN","IBCU",72,0)
 Q
"RTN","IBCU",73,0)
 ;
"RTN","IBCU",74,0)
PTADD(DFN,MAXL) ; outputs patient address for the trigger on Patient Short Address (399,110)
"RTN","IBCU",75,0)
 N IBX,IBY,IBI,IBDPT S (IBX,IBDPT)="" I $G(MAXL)="PSA" S MAXL=47
"RTN","IBCU",76,0)
 I +$G(DFN) S IBDPT=$G(^DPT(DFN,.11)) F IBI=1:1:4 S IBY=$P(IBDPT,U,IBI) I IBY'="" S IBX=IBX_IBY_","
"RTN","IBCU",77,0)
 I +$P(IBDPT,U,5) S IBY=$P($G(^DIC(5,+$P(IBDPT,U,5),0)),U,2),IBX=IBX_IBY
"RTN","IBCU",78,0)
 I $P(IBDPT,U,12)'="" S IBX=IBX_" "_$P(IBDPT,U,12)
"RTN","IBCU",79,0)
 I +$G(MAXL),$L(IBX)>+MAXL S IBX=""
"RTN","IBCU",80,0)
 Q IBX
"RTN","IBCU",81,0)
 ;
"RTN","IBCU",82,0)
SM ;Flag for printing medicare statment on UB-82
"RTN","IBCU",83,0)
 ;DGSM=0 means figure out which statement, DGSM=1 means no statements
"RTN","IBCU",84,0)
 S DGSM=0 Q
"RTN","IBCU",85,0)
 ;IBCU
"RTN","IBCU",86,0)
 ;
"RTN","IBCU",87,0)
CHGTYP(IBIFN,ARR) ; sets up array of all charge types defined on a bill:  ARR(TYPE, COMPONENT)=""
"RTN","IBCU",88,0)
 N IBI,IBX,IBT K ARR
"RTN","IBCU",89,0)
 I +$O(^DGCR(399,+$G(IBIFN),"RC",0)) S IBI=0 F  S IBI=$O(^DGCR(399,+IBIFN,"RC",IBI))  Q:'IBI  D
"RTN","IBCU",90,0)
 . S IBX=$G(^DGCR(399,+IBIFN,"RC",IBI,0)),IBT=$P(IBX,U,10) I +IBT S ARR(IBT,+$P(IBX,U,12))=""
"RTN","IBCU",91,0)
 Q
"RTN","IBCU",92,0)
 ;
"RTN","IBCU",93,0)
CHGTYPE(IBIFN) ; returns list of charge types on a bill: TYPE ^ TYPE ^ ... ; EXTERNAL TYPE , EXTERNAL TYPE , ...
"RTN","IBCU",94,0)
 N IBAR,IBY,IBS,IBI,IBC,IBJ,IBX
"RTN","IBCU",95,0)
 D CHGTYP($G(IBIFN),.IBAR)
"RTN","IBCU",96,0)
 S (IBX,IBY,IBS)="",IBI=0 F  S IBI=$O(IBAR(IBI)) Q:'IBI  D
"RTN","IBCU",97,0)
 . S IBX=IBX_IBI_U
"RTN","IBCU",98,0)
 . S IBC="INPT" I IBI=1 S IBJ=$O(IBAR(IBI,0)),IBC=$S(IBJ=1:"INST",IBJ=2:"PF",1:"INPT") I +$O(IBAR(IBI,IBJ)) S IBC="INPT"
"RTN","IBCU",99,0)
 . S IBY=IBY_IBS_$S(IBI=1:IBC,IBI=2:"VST",IBI=3:"RX",IBI=4:"CPT",IBI=5:"PI",IBI=6:"DRG",IBI=9:"UN",1:""),IBS=","
"RTN","IBCU",100,0)
 S IBY=IBX_";"_IBY
"RTN","IBCU",101,0)
 Q IBY
"RTN","IBCU",102,0)
 ;
"RTN","IBCU",103,0)
BCHGTYPE(IBIFN) ; returns type of bill and charges: (CLASS (.05): TYPE, TYPE, ...)
"RTN","IBCU",104,0)
 N IBCLASS,IBTYPE,IBY S IBY=""
"RTN","IBCU",105,0)
 S IBCLASS=$P($G(^DGCR(399,+$G(IBIFN),0)),U,5)
"RTN","IBCU",106,0)
 S IBTYPE=$P($$CHGTYPE(+$G(IBIFN)),";",2) I IBTYPE="INPT" S IBTYPE=""
"RTN","IBCU",107,0)
 I +IBCLASS S IBY=$S(IBCLASS<3:"Inpt",1:"Opt") I IBTYPE'="" S IBY=IBY_" ("_IBTYPE_")"
"RTN","IBCU",108,0)
 Q IBY
"RTN","IBCU",109,0)
 ;
"RTN","IBCU",110,0)
CLNSCRN(IBDT,CLIFN) ; screen for a Procedures Associated Clinic  (399, 304, 6), returns true if clinic can be used
"RTN","IBCU",111,0)
 ; clinic must be defined as a 'Clinic' and it must be active on date of procedure
"RTN","IBCU",112,0)
 ;
"RTN","IBCU",113,0)
 N IBCL0,IBCLI,IBX S IBX=0
"RTN","IBCU",114,0)
 S IBCL0=$G(^SC(+$G(CLIFN),0)),IBCLI=$G(^SC(+$G(CLIFN),"I"))
"RTN","IBCU",115,0)
 S IBX=$S($P(IBCL0,U,3)'="C":0,'$G(IBDT):0,'IBCLI:1,+IBCLI>+IBDT:1,'$P(IBCLI,U,2):0,1:$P(IBCLI,U,2)'>IBDT)
"RTN","IBCU",116,0)
 Q IBX
"RTN","IBCU",117,0)
 ;
"RTN","IBCU",118,0)
PRVNUM(IBIFN,IBINS,COB) ; Trigger code (399:122,123,124)
"RTN","IBCU",119,0)
 ; on Primary Secondary/Tertiary Carrier (399:101,102,103)
"RTN","IBCU",120,0)
 ; returns the Provider Number for the Insurance Company
"RTN","IBCU",121,0)
 ;         Hospital Provider Number for prov id in file 355.92
"RTN","IBCU",122,0)
 ;         or Medicare A provider Number (psych/non-psych) if Medicare A
"RTN","IBCU",123,0)
 ;
"RTN","IBCU",124,0)
 ; Input   IBIFN - bill ifn
"RTN","IBCU",125,0)
 ;         IBINS - insurance company ifn (opt)
"RTN","IBCU",126,0)
 ;         COB   - 1 for primary, 2 for secondary, 3 for tertiary
"RTN","IBCU",127,0)
 ;
"RTN","IBCU",128,0)
 N IBX,IBB0,IBBF,IBFT,Z,Z0
"RTN","IBCU",129,0)
 S:'$G(COB) COB=1
"RTN","IBCU",130,0)
 S IBX=$P($G(^DGCR(399,+$G(IBIFN),"M1")),U,COB+1),IBB0=$G(^DGCR(399,+$G(IBIFN),0))
"RTN","IBCU",131,0)
 I $G(IBINS)="" S IBINS=+$G(^DGCR(399,+$G(IBIFN),"I"_COB))
"RTN","IBCU",132,0)
 G:'IBINS PRVNQ
"RTN","IBCU",133,0)
 ;
"RTN","IBCU",134,0)
 ; OEC - 12/21/05 - If an MRA is being processed into an MRA secondary
"RTN","IBCU",135,0)
 ; claim and the billing provider # already exists, then leave it
"RTN","IBCU",136,0)
 I $G(IBPRCOB),IBX'="" G PRVNQ
"RTN","IBCU",137,0)
 ;
"RTN","IBCU",138,0)
 I +$G(IBIFN),COB N DA S DA=IBIFN I $$MCRACK^IBCBB3(+IBIFN,$P($G(^DGCR(399,+IBIFN,"TX")),U,5),+COB) S IBX=$$MCRANUM^IBCBB3(+IBIFN) G PRVNQ
"RTN","IBCU",139,0)
 ;
"RTN","IBCU",140,0)
 ; WCJ - 1/17/06 - Some Insurances require certain electronic plan types to have no secondary ID
"RTN","IBCU",141,0)
 ; Check if this plan type requires a blank sec id to go out for this insurance
"RTN","IBCU",142,0)
 N NOSEC S NOSEC=0
"RTN","IBCU",143,0)
 I $D(^DIC(36,IBINS,13)),$G(IBIFN) D
"RTN","IBCU",144,0)
 . N PLAN,PLANTYPE
"RTN","IBCU",145,0)
 . S PLAN=$P($G(^DGCR(399,IBIFN,"I"_COB)),U,18) Q:'PLAN
"RTN","IBCU",146,0)
 . S PLANTYPE=$P($G(^IBA(355.3,PLAN,0)),U,15) Q:'PLANTYPE
"RTN","IBCU",147,0)
 . Q:'$D(^DIC(36,IBINS,13,"B",PLANTYPE))
"RTN","IBCU",148,0)
 . S NOSEC=1,IBX=""
"RTN","IBCU",149,0)
 I NOSEC G PRVNQ
"RTN","IBCU",150,0)
 ;
"RTN","IBCU",151,0)
 ; If using attending/rendering secondary ID, don't do anything
"RTN","IBCU",152,0)
 I $$FT^IBCEF(IBIFN)=2,$$GET1^DIQ(36,IBINS,4.06,"I") G PRVNQ
"RTN","IBCU",153,0)
 I $$FT^IBCEF(IBIFN)=3,$$GET1^DIQ(36,IBINS,4.08,"I") G PRVNQ
"RTN","IBCU",154,0)
 ;
"RTN","IBCU",155,0)
 S IBX=$$FACNUM^IBCEP2B(IBIFN,COB)
"RTN","IBCU",156,0)
 ;
"RTN","IBCU",157,0)
 I IBX="" S IBX=$$GET1^DIQ(350.9,1,1.05)
"RTN","IBCU",158,0)
 ;
"RTN","IBCU",159,0)
PRVNQ Q IBX
"RTN","IBCU",160,0)
 ;
"RTN","IBCU",161,0)
BF() ; Returns ien of billing fac primary id type
"RTN","IBCU",162,0)
 N Z,IBX
"RTN","IBCU",163,0)
 S IBX="",Z=0 F  S Z=$O(^IBE(355.97,Z)) Q:'Z  I $P($G(^(Z,1)),U,9) S IBX=Z Q
"RTN","IBCU",164,0)
 Q IBX
"RTN","IBCU",165,0)
 ;
"RTN","IBCU",166,0)
BILLPNS(IBIFN) ; Trigger Code that sets all Bill P/S/T Prov# and QUAL (399: .122,123,124,128,129,130)
"RTN","IBCU",167,0)
 ; on Bill Form Type (399:.19)
"RTN","IBCU",168,0)
 N IBDR
"RTN","IBCU",169,0)
 ;
"RTN","IBCU",170,0)
 I +$G(^DGCR(399,+$G(IBIFN),"I1")) S IBDR(399,IBIFN_",",122)=$$PRVNUM(IBIFN,"",1),IBDR(399,IBIFN_",",128)=$$PRVQUAL(IBIFN,"",1)
"RTN","IBCU",171,0)
 I +$G(^DGCR(399,+$G(IBIFN),"I2")) S IBDR(399,IBIFN_",",123)=$$PRVNUM(IBIFN,"",2),IBDR(399,IBIFN_",",129)=$$PRVQUAL(IBIFN,"",2)
"RTN","IBCU",172,0)
 I +$G(^DGCR(399,+$G(IBIFN),"I3")) S IBDR(399,IBIFN_",",124)=$$PRVNUM(IBIFN,"",3),IBDR(399,IBIFN_",",130)=$$PRVQUAL(IBIFN,"",3)
"RTN","IBCU",173,0)
 ;
"RTN","IBCU",174,0)
 I $O(IBDR(0)) D FILE^DIE("","IBDR")
"RTN","IBCU",175,0)
 Q
"RTN","IBCU",176,0)
 ;
"RTN","IBCU",177,0)
PRVQUAL(IBIFN,IBINS,COB) ; Trigger code for Bill P/S/T Prov QUAL (399:128,129,130)
"RTN","IBCU",178,0)
 ; on P/S/T Carrier (399: 101,102,103)
"RTN","IBCU",179,0)
 ; returns the Provider ID QUALIFIER
"RTN","IBCU",180,0)
 ;
"RTN","IBCU",181,0)
 ; Input   IBIFN - bill ifn
"RTN","IBCU",182,0)
 ;         IBINS - insurance company ifn (opt)
"RTN","IBCU",183,0)
 ;         COB   - 1 for primary, 2 for secondary, 3 for tertiary
"RTN","IBCU",184,0)
 ;
"RTN","IBCU",185,0)
 N IBX,IBB0,IBBF,IBFT,Z,Z0
"RTN","IBCU",186,0)
 S:'$G(COB) COB=1
"RTN","IBCU",187,0)
 S IBX=$P($G(^DGCR(399,+$G(IBIFN),"M1")),U,COB+9),IBB0=$G(^DGCR(399,+$G(IBIFN),0))
"RTN","IBCU",188,0)
 I $G(IBINS)="" S IBINS=+$G(^DGCR(399,+$G(IBIFN),"I"_COB))
"RTN","IBCU",189,0)
 G:'IBINS PRVQUALQ
"RTN","IBCU",190,0)
 ;
"RTN","IBCU",191,0)
 ; If an MRA is being processed into an MRA secondary claim and the
"RTN","IBCU",192,0)
 ; billing provider qualifier already exists, then leave it alone
"RTN","IBCU",193,0)
 I $G(IBPRCOB),IBX'="" G PRVQUALQ
"RTN","IBCU",194,0)
 ;
"RTN","IBCU",195,0)
 I +$G(IBIFN),COB N DA S DA=IBIFN I $$MCRACK^IBCBB3(+IBIFN,$P($G(^DGCR(399,+IBIFN,"TX")),U,5),+COB) S IBX=$$FIND1^DIC(355.97,,"MX","MEDICARE PART A") G PRVQUALQ
"RTN","IBCU",196,0)
 ;
"RTN","IBCU",197,0)
 ; Some Insurances require certain electronic plan types to have no secondary ID
"RTN","IBCU",198,0)
 ; If this is the case, there is no qualifier
"RTN","IBCU",199,0)
 N NOSEC S NOSEC=0
"RTN","IBCU",200,0)
 I $D(^DIC(36,IBINS,13)),$G(IBIFN) D
"RTN","IBCU",201,0)
 . N PLAN,PLANTYPE
"RTN","IBCU",202,0)
 . S PLAN=$P($G(^DGCR(399,IBIFN,"I"_COB)),U,18) Q:'PLAN
"RTN","IBCU",203,0)
 . S PLANTYPE=$P($G(^IBA(355.3,PLAN,0)),U,15) Q:'PLANTYPE
"RTN","IBCU",204,0)
 . Q:'$D(^DIC(36,IBINS,13,"B",PLANTYPE))
"RTN","IBCU",205,0)
 . S NOSEC=1,IBX=""
"RTN","IBCU",206,0)
 I NOSEC G PRVQUALQ
"RTN","IBCU",207,0)
 ;
"RTN","IBCU",208,0)
 ; Leave qualifer blank if sending REND/ATT ID
"RTN","IBCU",209,0)
 I $$FT^IBCEF(IBIFN)=2,$$GET1^DIQ(36,IBINS,4.06,"I") G PRVQUALQ
"RTN","IBCU",210,0)
 I $$FT^IBCEF(IBIFN)=3,$$GET1^DIQ(36,IBINS,4.08,"I") G PRVQUALQ
"RTN","IBCU",211,0)
 ;
"RTN","IBCU",212,0)
 S IBX=$$FACNUM^IBCEP2B(IBIFN,COB,1)
"RTN","IBCU",213,0)
 ;
"RTN","IBCU",214,0)
 I IBX="",$$GET1^DIQ(350.9,1,1.05)=$P($G(^DGCR(399,IBIFN,"M1")),U,COB+1) S IBX=$$FIND1^DIC(355.97,,"MX","1J")
"RTN","IBCU",215,0)
 ;
"RTN","IBCU",216,0)
PRVQUALQ Q IBX
"RTN","IBJPS")
0^47^B5156185
"RTN","IBJPS",1,0)
IBJPS ;ALB/MAF,ARH - IBSP IB SITE PARAMETER SCREEN ;22-DEC-1995
"RTN","IBJPS",2,0)
 ;;2.0;INTEGRATED BILLING;**39,52,70,115,143,51,137,161,155,320,348,349,377,384**;21-MAR-94;Build 74
"RTN","IBJPS",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBJPS",4,0)
 ;
"RTN","IBJPS",5,0)
EN ; -- main entry point for IBJP IB SITE PARAMETERS, display IB site parameters
"RTN","IBJPS",6,0)
 D EN^VALM("IBJP IB SITE PARAMETERS")
"RTN","IBJPS",7,0)
 Q
"RTN","IBJPS",8,0)
 ;
"RTN","IBJPS",9,0)
HDR ; -- header code
"RTN","IBJPS",10,0)
 S VALMHDR(1)="Only authorized persons may edit this data."
"RTN","IBJPS",11,0)
 Q
"RTN","IBJPS",12,0)
 ;
"RTN","IBJPS",13,0)
INIT ; -- init variables and list array
"RTN","IBJPS",14,0)
 K ^TMP("IBJPS",$J),^TMP("IBJPSAX",$J)
"RTN","IBJPS",15,0)
 D BLD^IBJPS1
"RTN","IBJPS",16,0)
 Q
"RTN","IBJPS",17,0)
 ;
"RTN","IBJPS",18,0)
HELP ; -- help code
"RTN","IBJPS",19,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","IBJPS",20,0)
 Q
"RTN","IBJPS",21,0)
 ;
"RTN","IBJPS",22,0)
EXIT ; -- exit code
"RTN","IBJPS",23,0)
 K ^TMP("IBJPS",$J),^TMP("IBJPSAX",$J)
"RTN","IBJPS",24,0)
 D CLEAR^VALM1
"RTN","IBJPS",25,0)
 Q
"RTN","IBJPS",26,0)
 ;
"RTN","IBJPS",27,0)
NXEDIT ; -- IBJP IB SITE PARAMETER EDIT ACTION (EP): Select data set to edit, do edit
"RTN","IBJPS",28,0)
 N VALMY,IBSELN,IBSET
"RTN","IBJPS",29,0)
 D EN^VALM2($G(XQORNOD(0)))
"RTN","IBJPS",30,0)
 I $D(VALMY) S IBSELN=0 F  S IBSELN=$O(VALMY(IBSELN)) Q:'IBSELN  D
"RTN","IBJPS",31,0)
 . S IBSET=$P($G(^TMP("IBJPSAX",$J,IBSELN)),U,1) Q:'IBSET
"RTN","IBJPS",32,0)
 . D EDIT(IBSET)
"RTN","IBJPS",33,0)
 S VALMBCK="R"
"RTN","IBJPS",34,0)
 Q
"RTN","IBJPS",35,0)
 ;
"RTN","IBJPS",36,0)
EDIT(IBSET) ; edit IB Site Parameters
"RTN","IBJPS",37,0)
 D FULL^VALM1
"RTN","IBJPS",38,0)
 I IBSET'="" S DR=$P($T(@IBSET),";;",2,999)
"RTN","IBJPS",39,0)
 I DR'="" S DIE="^IBE(350.9,",DA=1 D ^DIE K DA,DR,DIE,DIC,X,Y
"RTN","IBJPS",40,0)
 D INIT^IBJPS S VALMBCK="R"
"RTN","IBJPS",41,0)
 Q
"RTN","IBJPS",42,0)
 ;
"RTN","IBJPS",43,0)
1 ;;.09;.13;.14
"RTN","IBJPS",44,0)
2 ;;1.2;.15;.11;.12;7.04
"RTN","IBJPS",45,0)
3 ;;1.09;1.07;2.07
"RTN","IBJPS",46,0)
4 ;;4.04;6.25;6.24
"RTN","IBJPS",47,0)
5 ;;.02;1.14;1.25;1.08
"RTN","IBJPS",48,0)
6 ;;1.23;1.16;1.22;1.19;1.15;1.17
"RTN","IBJPS",49,0)
7 ;;1.33;1.32;1.31;1.27
"RTN","IBJPS",50,0)
8 ;;1.29;1.3;1.18;1.28
"RTN","IBJPS",51,0)
9 ;;1.01;1.02;1.05
"RTN","IBJPS",52,0)
10 ;;2.12;2.1;2.02;2.03;2.04;2.05;2.06;2.01
"RTN","IBJPS",53,0)
11 ;;2.08;2.09
"RTN","IBJPS",54,0)
12 ;;11.01;11.02;12
"RTN","IBJPS",55,0)
13 ;;10.02;10.03;10.04;10.05;D INIT^IBATFILE
"RTN","IBJPS",56,0)
14 ;;2.11;8.01;8.09;8.03;8.06;8.04;8.07;8.02;8.12T;8.11T
"RTN","IBJPS",57,0)
15 ;;50.01;50.02;50.05;50.06;50.03;50.04;50.07
"RTN","IBJPS",58,0)
 ;
"RTN","IBJPS",59,0)
 ;
"RTN","IBJPS",60,0)
ADD(IBLN,LNG,ARR) ; output array of address in X, line length=LNG
"RTN","IBJPS",61,0)
 N IBCNT,IBI,IBY,IBX,IBZ K ARR S IBCNT=1
"RTN","IBJPS",62,0)
 F IBI=2:1:4 S IBY=$P(IBLN,U,IBI) I IBY'="" D  S ARR(IBCNT)=IBY
"RTN","IBJPS",63,0)
 . S IBX=$G(ARR(IBCNT)) I IBI=4 S IBY=$P($G(^DIC(5,+IBY,0)),U,2)_" "_$P(IBLN,U,5)
"RTN","IBJPS",64,0)
 . S IBZ=$S(IBX'="":IBX_", ",1:"")_IBY I $L(IBZ)'>LNG S IBY=IBZ Q
"RTN","IBJPS",65,0)
 . S IBCNT=IBCNT+1
"RTN","IBJPS",66,0)
 Q
"RTN","IBJPS1")
0^48^B15675647
"RTN","IBJPS1",1,0)
IBJPS1 ;ALB/MAF,ARH - IBSP IB SITE PARAMETER BUILD ;22-DEC-1995
"RTN","IBJPS1",2,0)
 ;;2.0;INTEGRATED BILLING;**39,52,70,115,153,137,161,384**;21-MAR-94;Build 74
"RTN","IBJPS1",3,0)
 ;;Per VHA Directive 10-93-142, this routine should not be modified.
"RTN","IBJPS1",4,0)
 ;
"RTN","IBJPS1",5,0)
BLD ; - build screen array for IB parameters
"RTN","IBJPS1",6,0)
 N IBTW,IBTC,IBSW,IBLN,IBGRPB,IBGRPE,IBX,IBT,IBI,IBLR,IBSEL,IBPD0,IBPD1,IBPD2,IBPD4,IBPD6,IBPD7,IBPD8,IBPD9,IBPD10
"RTN","IBJPS1",7,0)
 N IBPD50,IBCISOCK,IBCIMFLG
"RTN","IBJPS1",8,0)
 N IBPD11,IBPD12,IBZ
"RTN","IBJPS1",9,0)
 ;
"RTN","IBJPS1",10,0)
 ; IBTW = max width of data   IBTC = start column of data
"RTN","IBJPS1",11,0)
 ; IBSW = total width of prompt field (including the ":")
"RTN","IBJPS1",12,0)
 S IBTW(1)=21,IBTC(1)=5,IBSW(1)=19
"RTN","IBJPS1",13,0)
 S IBTW(2)=21,IBTC(2)=47,IBSW(2)=13
"RTN","IBJPS1",14,0)
 S IBTW(3)=21,IBTC(3)=5,IBSW(3)=53
"RTN","IBJPS1",15,0)
 S IBTW(4)=27,IBTC(4)=5,IBSW(4)=47
"RTN","IBJPS1",16,0)
 S IBTW(5)=17,IBTC(5)=5,IBSW(5)=19
"RTN","IBJPS1",17,0)
 S IBTW(6)=19,IBTC(6)=41,IBSW(6)=17
"RTN","IBJPS1",18,0)
 S IBTW(7)=35,IBTC(7)=5,IBSW(7)=46
"RTN","IBJPS1",19,0)
 S IBTW(8)=32,IBTC(8)=5,IBSW(8)=46
"RTN","IBJPS1",20,0)
 S IBTW(9)=31,IBTC(9)=5,IBSW(9)=43
"RTN","IBJPS1",21,0)
 ;
"RTN","IBJPS1",22,0)
 S IBPD0=$G(^IBE(350.9,1,0)),IBPD1=$G(^IBE(350.9,1,1)),IBPD2=$G(^IBE(350.9,1,2))
"RTN","IBJPS1",23,0)
 S IBPD4=$G(^IBE(350.9,1,4)),IBPD6=$G(^IBE(350.9,1,6)),IBPD8=$G(^(8)),IBPD9=$G(^IBE(350.9,1,9))
"RTN","IBJPS1",24,0)
 S IBPD7=$G(^IBE(350.9,1,7)),IBPD10=$G(^IBE(350.9,1,10)),IBPD50=$G(^IBE(350.9,1,50))
"RTN","IBJPS1",25,0)
 S IBPD11=$G(^IBE(350.9,1,11))
"RTN","IBJPS1",26,0)
 S IBZ=0 F  S IBZ=$O(^IBE(350.9,1,12,IBZ)) Q:+IBZ=0  S IBPD12(IBZ)=$G(^IBE(350.9,1,12,IBZ,0))
"RTN","IBJPS1",27,0)
 ;
"RTN","IBJPS1",28,0)
 S (VALMCNT,IBLN,IBGRPB,IBGRPE)=1,IBSEL=0
"RTN","IBJPS1",29,0)
 ;
"RTN","IBJPS1",30,0)
 D RIGHT(4,1,"") ; - copay stuff
"RTN","IBJPS1",31,0)
 S IBLN=$$SET("Copay Background Error Mg",$$EXSET^IBJU1($P(IBPD0,U,9),350.9,.09),IBLN,IBLR,IBSEL)
"RTN","IBJPS1",32,0)
 S IBLN=$$SET("Copay Exemption Mailgroup",$$EXSET^IBJU1($P(IBPD0,U,13),350.9,.13),IBLN,IBLR,IBSEL)
"RTN","IBJPS1",33,0)
 S IBLN=$$SET("Use Alerts for Exemption",$$YN($P(IBPD0,U,14)),IBLN,IBLR,IBSEL)
"RTN","IBJPS1",34,0)
 ;
"RTN","IBJPS1",35,0)
 D RIGHT(4,1,1) ; - patient Billing
"RTN","IBJPS1",36,0)
 S IBLN=$$SET("Hold MT Bills w/Ins",$$YN(+$P(IBPD1,U,20)),IBLN,IBLR,IBSEL)
"RTN","IBJPS1",37,0)
 S IBLN=$$SET("Suppress MT Ins Bulletin",$$YN(+$P(IBPD0,U,15)),IBLN,IBLR,IBSEL)
"RTN","IBJPS1",38,0)
 S IBLN=$$SET("Means Test Mailgroup",$$EXSET^IBJU1($P(IBPD0,U,11),350.9,.11),IBLN,IBLR,IBSEL)
"RTN","IBJPS1",39,0)
 S IBLN=$$SET("Per Diem Start Date",$$DATE^IBJU1(+$P(IBPD0,U,12)),IBLN,IBLR,IBSEL)
"RTN","IBJPS1",40,0)
 ;
"RTN","IBJPS1",41,0)
 D LEFT(2)
"RTN","IBJPS1",42,0)
 S IBLN=$$SET("# of Days Charges Held",$$EXSET^IBJU1($P(IBPD7,U,4),350.9,7.04),IBLN,IBLR,IBSEL)
"RTN","IBJPS1",43,0)
 ;
"RTN","IBJPS1",44,0)
 D RIGHT(4,1,1) ; - third party stuff
"RTN","IBJPS1",45,0)
 S IBLN=$$SET("Disapproval Mailgroup",$$EXSET^IBJU1($P(IBPD1,U,9),350.9,1.09),IBLN,IBLR,IBSEL)
"RTN","IBJPS1",46,0)
 S IBLN=$$SET("Cancellation Mailgroup",$$EXSET^IBJU1($P(IBPD1,U,7),350.9,1.07),IBLN,IBLR,IBSEL)
"RTN","IBJPS1",47,0)
 D FSTRNG^IBJU1($P(IBPD2,U,7),IBSW(IBLR),.IBX) D  K IBX
"RTN","IBJPS1",48,0)
 . S IBI=$O(IBX(0)) S IBLN=$$SET("Cancellation Remark",$G(IBX(+IBI)),IBLN,IBLR,IBSEL)
"RTN","IBJPS1",49,0)
 . F  S IBI=$O(IBX(IBI)) Q:'IBI  S IBLN=$$SET("",IBX(+IBI),IBLN,IBLR,IBSEL)
"RTN","IBJPS1",50,0)
 ;
"RTN","IBJPS1",51,0)
 D RIGHT(4,1,1)
"RTN","IBJPS1",52,0)
 S IBLN=$$SET("New Insurance Mailgroup",$$EXSET^IBJU1($P(IBPD4,U,4),350.9,4.04),IBLN,IBLR,IBSEL)
"RTN","IBJPS1",53,0)
 S IBLN=$$SET("Unbilled Mailgroup",$$EXSET^IBJU1($P(IBPD6,U,25),350.9,6.25),IBLN,IBLR,IBSEL)
"RTN","IBJPS1",54,0)
 S IBLN=$$SET("Auto Print Unbilled List",$$YN(+$P(IBPD6,U,24)),IBLN,IBLR,IBSEL)
"RTN","IBJPS1",55,0)
 ;
"RTN","IBJPS1",56,0)
 D BLD2^IBJPS2
"RTN","IBJPS1",57,0)
 ;
"RTN","IBJPS1",58,0)
 S VALMCNT=$S(IBLN>IBGRPE:IBLN,1:IBGRPE)-1
"RTN","IBJPS1",59,0)
 Q
"RTN","IBJPS1",60,0)
 ;
"RTN","IBJPS1",61,0)
SET(TTL,DATA,LN,LR,SEL) ;
"RTN","IBJPS1",62,0)
 N IBY,IBX,IBC S IBC=": " I TTL="" S IBC="  "
"RTN","IBJPS1",63,0)
 S IBY=TTL_$J("",(IBTW(LR)-$L(TTL)-2))_IBC_DATA,IBX=$G(^TMP("IBJPS",$J,LN,0))
"RTN","IBJPS1",64,0)
 S IBX=$$SETSTR^VALM1(IBY,IBX,IBTC(LR),(IBTW(LR)+IBSW(LR)))
"RTN","IBJPS1",65,0)
 D SET1(IBX,LN,SEL)
"RTN","IBJPS1",66,0)
 S LN=LN+1
"RTN","IBJPS1",67,0)
 Q LN
"RTN","IBJPS1",68,0)
 ;
"RTN","IBJPS1",69,0)
SET1(STR,LN,SEL,RV) ; set up TMP array with screen data
"RTN","IBJPS1",70,0)
 S ^TMP("IBJPS",$J,LN,0)=STR
"RTN","IBJPS1",71,0)
 S ^TMP("IBJPS",$J,"IDX",LN,SEL)=""
"RTN","IBJPS1",72,0)
 S ^TMP("IBJPSAX",$J,SEL)=SEL
"RTN","IBJPS1",73,0)
 I $G(RV)'="" D CNTRL^VALM10(LN,1,4,IOINHI,IOINORM)
"RTN","IBJPS1",74,0)
 Q
"RTN","IBJPS1",75,0)
 ;
"RTN","IBJPS1",76,0)
YN(X) Q $S(+X:"YES",1:"NO")
"RTN","IBJPS1",77,0)
 ;
"RTN","IBJPS1",78,0)
RIGHT(LR,SEL,BL) ; - reset control variables for right side of screen
"RTN","IBJPS1",79,0)
 S IBLN=$S(IBLN>IBGRPE:IBLN,1:IBGRPE) I $G(BL) S IBLN=$$SET("","",IBLN,IBLR,IBSEL)
"RTN","IBJPS1",80,0)
 S IBLR=$G(LR),IBGRPB=IBLN I +$G(SEL) S IBSEL=IBSEL+1 D SET1("["_IBSEL_"]",IBLN,IBSEL,1)
"RTN","IBJPS1",81,0)
 Q
"RTN","IBJPS1",82,0)
 ;
"RTN","IBJPS1",83,0)
LEFT(LR) ; - reset control variables for left side of screen
"RTN","IBJPS1",84,0)
 S IBLR=$G(LR),IBGRPE=IBLN,IBLN=IBGRPB
"RTN","IBJPS1",85,0)
 Q
"RTN","IBJPS2")
0^49^B41372585
"RTN","IBJPS2",1,0)
IBJPS2 ;ALB/MAF,ARH - IBSP IB SITE PARAMETER BUILD (cont) ;22-DEC-1995
"RTN","IBJPS2",2,0)
 ;;2.0;INTEGRATED BILLING;**39,52,115,143,51,137,161,155,320,348,349,377,384**;21-MAR-94;Build 74
"RTN","IBJPS2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBJPS2",4,0)
 ;
"RTN","IBJPS2",5,0)
BLD2 ; - continue build screen array for IB parameters
"RTN","IBJPS2",6,0)
 ;
"RTN","IBJPS2",7,0)
 N Z,Z0,BPZZ
"RTN","IBJPS2",8,0)
 D RIGHT(1,1,1) ; - facility/med center  (new line for each)
"RTN","IBJPS2",9,0)
 S IBLN=$$SET("Medical Center",$$EXSET^IBJU1($P(IBPD0,U,2),350.9,.02),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",10,0)
 S IBLN=$$SET("MAS Service",$$EXSET^IBJU1($P(IBPD1,U,14),350.9,1.14),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",11,0)
 ;
"RTN","IBJPS2",12,0)
 D LEFT(2)
"RTN","IBJPS2",13,0)
 S IBLN=$$SET("Default Division",$$EXSET^IBJU1($P(IBPD1,U,25),350.9,1.25),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",14,0)
 S IBLN=$$SET("Billing Supervisor",$$EXSET^IBJU1($P(IBPD1,U,8),350.9,1.08),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",15,0)
 ;
"RTN","IBJPS2",16,0)
 D RIGHT(1,1,1)
"RTN","IBJPS2",17,0)
 S IBLN=$$SET("Initiator Authorize",$$YN(+$P(IBPD1,U,23)),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",18,0)
 S IBLN=$$SET("Ask HINQ in MCCR",$$YN(+$P(IBPD1,U,16)),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",19,0)
 S IBLN=$$SET("Multiple Form Types",$$YN(+$P(IBPD1,U,22)),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",20,0)
 ;
"RTN","IBJPS2",21,0)
 D LEFT(2)
"RTN","IBJPS2",22,0)
 S IBLN=$$SET("Xfer Proc to Sched",$$YN(+$P(IBPD1,U,19)),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",23,0)
 S IBLN=$$SET("Use Non-PTF Codes",$$YN(+$P(IBPD1,U,15)),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",24,0)
 S IBLN=$$SET("Use OP CPT screen",$$YN(+$P(IBPD1,U,17)),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",25,0)
 ;
"RTN","IBJPS2",26,0)
 ; IB patch 349 for UB-04 claim form and parameters
"RTN","IBJPS2",27,0)
 D RIGHT(1,1,1)
"RTN","IBJPS2",28,0)
 S IBLN=$$SET("UB-04 Print IDs",$$EXSET^IBJU1($P(IBPD1,U,33),350.9,1.33),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",29,0)
 S IBLN=$$SET("CMS-1500 Print IDs",$$EXSET^IBJU1($P(IBPD1,U,32),350.9,1.32),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",30,0)
 ;
"RTN","IBJPS2",31,0)
 D LEFT(2)
"RTN","IBJPS2",32,0)
 S IBLN=$$SET("UB-04 Address Col",$P(IBPD1,U,31),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",33,0)
 S IBLN=$$SET("CMS-1500 Addr Col",$P(IBPD1,U,27),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",34,0)
 ;
"RTN","IBJPS2",35,0)
 D RIGHT(1,1,1)
"RTN","IBJPS2",36,0)
 S IBLN=$$SET("Default RX DX Cd",$$EXSET^IBJU1($P(IBPD1,U,29),350.9,1.29),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",37,0)
 S IBLN=$$SET("Default RX CPT Cd",$$EXSET^IBJU1($P(IBPD1,U,30),350.9,1.30),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",38,0)
 ;
"RTN","IBJPS2",39,0)
 D LEFT(2)
"RTN","IBJPS2",40,0)
 S IBLN=$$SET("Default ASC Rev Cd",$$EXSET^IBJU1($P(IBPD1,U,18),350.9,1.18),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",41,0)
 S IBLN=$$SET("Default RX Rev Cd",$$EXSET^IBJU1($P(IBPD1,U,28),350.9,1.28),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",42,0)
 ;
"RTN","IBJPS2",43,0)
 D RIGHT(1,1,1)
"RTN","IBJPS2",44,0)
 S IBLN=$$SET("Bill Signer Name","<No longer used>",IBLN,IBLR,IBSEL)
"RTN","IBJPS2",45,0)
 S IBLN=$$SET("Bill Signer Title","<No longer used>",IBLN,IBLR,IBSEL)
"RTN","IBJPS2",46,0)
 ;
"RTN","IBJPS2",47,0)
 D LEFT(2)
"RTN","IBJPS2",48,0)
 S IBLN=$$SET("Federal Tax #",$P(IBPD1,U,5),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",49,0)
 ;
"RTN","IBJPS2",50,0)
 D RIGHT(3,1,1) ; - Remittance/Agent Cashier Address
"RTN","IBJPS2",51,0)
 S IBLN=$$SET("Billing Facility is Another Facility",$$EXPAND^IBTRE(350.9,2.12,+$P(IBPD2,U,12)),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",52,0)
 S IBLN=$$SET("Billing Facility Name",$P(IBPD2,U,10),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",53,0)
 D ADD^IBJPS(IBPD2,IBSW(3),.IBX) D  K IBX
"RTN","IBJPS2",54,0)
 . S IBT="Remittance Address",IBX=0 F  S IBX=$O(IBX(IBX)) Q:'IBX  D
"RTN","IBJPS2",55,0)
 .. S IBLN=$$SET(IBT,IBX(IBX),IBLN,IBLR,IBSEL),IBT=""
"RTN","IBJPS2",56,0)
 S IBLN=$$SET("Phone",$P(IBPD2,U,6),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",57,0)
 ;
"RTN","IBJPS2",58,0)
 D RIGHT(3,1,1)
"RTN","IBJPS2",59,0)
 S IBLN=$$SET("Inpt Health Summary",$$EXSET^IBJU1($P(IBPD2,U,8),350.9,2.08),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",60,0)
 S IBLN=$$SET("Opt Health Summary",$$EXSET^IBJU1($P(IBPD2,U,9),350.9,2.09),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",61,0)
 ;
"RTN","IBJPS2",62,0)
 ; ePharmacy parameters
"RTN","IBJPS2",63,0)
 D RIGHT(7,1,1)
"RTN","IBJPS2",64,0)
 S IBLN=$$SET("HIPPA NCPDP Active Flag",$S($P(IBPD11,U)=1:"Active",1:"Not Active"),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",65,0)
 S IBLN=$$SET("Drug Non Covered Recheck Period",$P(IBPD11,U,2)_" days(s)",IBLN,IBLR,IBSEL)
"RTN","IBJPS2",66,0)
 S IBLN=$$SET("Non Covered Reject Codes","",IBLN,IBLR,IBSEL,1)
"RTN","IBJPS2",67,0)
 S BPZZ=0 F  S BPZZ=$O(IBPD12(BPZZ)) Q:+BPZZ=0  D
"RTN","IBJPS2",68,0)
 . S IBLN=$$SET(" ",$$GET1^DIQ(9002313.93,+$G(IBPD12(BPZZ)),.01,"E")_" "_$$GET1^DIQ(9002313.93,+$G(IBPD12(BPZZ)),.02,"E"),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",69,0)
 ;
"RTN","IBJPS2",70,0)
 ; transfer pricing
"RTN","IBJPS2",71,0)
 D RIGHT(1,1,1)
"RTN","IBJPS2",72,0)
 S IBLN=$$SET("Inpatient TP Active ",$$YN(+$P(IBPD10,U,2)),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",73,0)
 S IBLN=$$SET("Outpatient TP Active",$$YN(+$P(IBPD10,U,3)),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",74,0)
 S IBLN=$$SET("Pharmacy TP Active  ",$$YN(+$P(IBPD10,U,4)),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",75,0)
 S IBLN=$$SET("Prosthetic TP Active",$$YN(+$P(IBPD10,U,5)),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",76,0)
 ;
"RTN","IBJPS2",77,0)
 ; EDI/MRA parameters
"RTN","IBJPS2",78,0)
 D RIGHT(7,1,1)
"RTN","IBJPS2",79,0)
 N IBZ S IBZ=$P(IBPD8,U,3)
"RTN","IBJPS2",80,0)
 S IBLN=$$SET(" EDI/MRA Activated",$$EXSET^IBJU1(+$P(IBPD8,U,10),350.9,8.1),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",81,0)
 S IBLN=$$SET(" EDI Contact Phone",$P(IBPD2,U,11),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",82,0)
 S IBLN=$$SET(" EDI 837 Live Transmit Queue",$P(IBPD8,U),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",83,0)
 S IBLN=$$SET(" EDI 837 Test Transmit Queue",$P(IBPD8,U,9),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",84,0)
 S IBLN=$$SET(" Auto-Txmt Bill Frequency",$S(IBZ:"Every"_$S(IBZ>1:" "_$P(IBPD8,U,3),1:""),1:"")_$S(IBZ:" Day"_$S(IBZ=1:"",1:"s"),1:"Never Run"),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",85,0)
 S IBLN=$$SET(" Hours To Auto-Transmit",$P(IBPD8,U,6),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",86,0)
 S IBLN=$$SET(" Max # Bills Per Batch",$P(IBPD8,U,4),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",87,0)
 S IBLN=$$SET(" Only Allow 1 Ins Co/Claim Batch?",$$EXPAND^IBTRE(350.9,8.07,+$P(IBPD8,U,7)),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",88,0)
 S IBLN=$$SET(" Last Auto-Txmt Run Date",$$DATE^IBJU1($P(IBPD8,U,5)),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",89,0)
 S IBLN=$$SET(" Days To Wait To Purge Msgs",$P(IBPD8,U,2),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",90,0)
 S IBLN=$$SET(" Allow MRA Processing?",$$YN(+$P(IBPD8,U,12)),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",91,0)
 S IBLN=$$SET(" Enable Automatic MRA Processing?",$$YN(+$P(IBPD8,U,11)),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",92,0)
 ;
"RTN","IBJPS2",93,0)
 ; Ingenix ClaimsManager Information
"RTN","IBJPS2",94,0)
 D RIGHT(9,1,1)
"RTN","IBJPS2",95,0)
 S IBLN=$$SET("Are we using ClaimsManager?",$$YN(+$P(IBPD50,U,1)),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",96,0)
 S IBLN=$$SET("Is ClaimsManager working OK?",$$YN(+$P(IBPD50,U,2)),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",97,0)
 S IBLN=$$SET("ClaimsManager TCP/IP Address",$P(IBPD50,U,5),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",98,0)
 S IBCISOCK=$O(^IBE(350.9,1,50.06,"B",""))
"RTN","IBJPS2",99,0)
 S IBLN=$$SET("ClaimsManager TCP/IP Ports",IBCISOCK,IBLN,IBLR,IBSEL)
"RTN","IBJPS2",100,0)
 F  S IBCISOCK=$O(^IBE(350.9,1,50.06,"B",IBCISOCK)) Q:IBCISOCK=""  D
"RTN","IBJPS2",101,0)
 . S IBLN=$$SET("",IBCISOCK,IBLN,IBLR,IBSEL)
"RTN","IBJPS2",102,0)
 . Q
"RTN","IBJPS2",103,0)
 S IBLN=$$SET("General Error MailGroup",$$EXSET^IBJU1($P(IBPD50,U,3),350.9,50.03),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",104,0)
 S IBLN=$$SET("Communication Error MailGroup",$$EXSET^IBJU1($P(IBPD50,U,4),350.9,50.04),IBLN,IBLR,IBSEL)
"RTN","IBJPS2",105,0)
 S IBCIMFLG=$$EXTERNAL^DILFD(350.9,50.07,"",$P(IBPD50,U,7))
"RTN","IBJPS2",106,0)
 I IBCIMFLG="" S IBCIMFLG="PRIORITY"
"RTN","IBJPS2",107,0)
 S IBLN=$$SET("MailMan Messages",IBCIMFLG,IBLN,IBLR,IBSEL)
"RTN","IBJPS2",108,0)
 ;
"RTN","IBJPS2",109,0)
 Q
"RTN","IBJPS2",110,0)
 ;
"RTN","IBJPS2",111,0)
SET(TTL,DATA,LN,LR,SEL,HDR) ;
"RTN","IBJPS2",112,0)
 N IBY,IBX,IBC S IBC=": " I TTL="" S IBC="  "
"RTN","IBJPS2",113,0)
 S IBY=TTL_$J("",(IBTW(LR)-$L(TTL)-2))_$S('$G(HDR):IBC_DATA,1:""),IBX=$G(^TMP("IBJPS",$J,LN,0))
"RTN","IBJPS2",114,0)
 S IBX=$$SETSTR^VALM1(IBY,IBX,IBTC(LR),(IBTW(LR)+IBSW(LR)))
"RTN","IBJPS2",115,0)
 D SET1(IBX,LN,SEL)
"RTN","IBJPS2",116,0)
 S LN=LN+1
"RTN","IBJPS2",117,0)
 Q LN
"RTN","IBJPS2",118,0)
 ;
"RTN","IBJPS2",119,0)
SET1(STR,LN,SEL,HI) ; set up TMP array with screen data
"RTN","IBJPS2",120,0)
 S ^TMP("IBJPS",$J,LN,0)=STR
"RTN","IBJPS2",121,0)
 S ^TMP("IBJPS",$J,"IDX",LN,SEL)=""
"RTN","IBJPS2",122,0)
 S ^TMP("IBJPSAX",$J,SEL)=SEL
"RTN","IBJPS2",123,0)
 I $G(HI)'="" D CNTRL^VALM10(LN,1,4,IOINHI,IOINORM)
"RTN","IBJPS2",124,0)
 ;I $G(RV) D CNTRL^VALM10(LN,6,19,IOUON,IOUOFF)
"RTN","IBJPS2",125,0)
 Q
"RTN","IBJPS2",126,0)
 ;
"RTN","IBJPS2",127,0)
YN(X) Q $S(+X:"YES",1:"NO")
"RTN","IBJPS2",128,0)
 ;
"RTN","IBJPS2",129,0)
RIGHT(LR,SEL,BL) ; - reset control variables for right side of screen
"RTN","IBJPS2",130,0)
 S IBLN=$S(IBLN>IBGRPE:IBLN,1:IBGRPE) I $G(BL) S IBLN=$$SET("","",IBLN,IBLR,IBSEL)
"RTN","IBJPS2",131,0)
 S IBLR=$G(LR),IBGRPB=IBLN I +$G(SEL) S IBSEL=IBSEL+1 D SET1("["_IBSEL_"]",IBLN,IBSEL,1)
"RTN","IBJPS2",132,0)
 Q
"RTN","IBJPS2",133,0)
 ;
"RTN","IBJPS2",134,0)
LEFT(LR) ; - reset control variables for left side of screen
"RTN","IBJPS2",135,0)
 S IBLR=$G(LR),IBGRPE=IBLN,IBLN=IBGRPB
"RTN","IBJPS2",136,0)
 Q
"RTN","IBJTCA1")
0^2^B47734103
"RTN","IBJTCA1",1,0)
IBJTCA1 ;ALB/ARH - TPI CLAIMS INFO BUILD ;10/31/07  14:17
"RTN","IBJTCA1",2,0)
 ;;2.0;INTEGRATED BILLING;**39,80,106,137,223,276,363,384**;21-MAR-94;Build 74
"RTN","IBJTCA1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBJTCA1",4,0)
 ;
"RTN","IBJTCA1",5,0)
BLD ; build array for Third Party Joint Inquiry Claims Info screen, IBIFN must be defined
"RTN","IBJTCA1",6,0)
 ;
"RTN","IBJTCA1",7,0)
 N X,IBY,IBZ,IBZ0,IBI,IBT,IBD,IBLN,IBLR,IBD0,IBDI1,IBDM,IBDM1,IBDU,IBDS,IBDU2,IBID0,IBID13,IBNC,IBTC,IBTW,IBSW,IBGRPB,IBGRPE,IBWNR,IBDTX,IBBX19,IBPRVO,IBNABP
"RTN","IBJTCA1",8,0)
 S VALMCNT=0,X="",IBD0=$G(^DGCR(399,+$G(IBIFN),0)) I IBD0="" S VALMQUIT="" G BLDQ
"RTN","IBJTCA1",9,0)
 F IBI="M","M1","U","S","U2","TX" S @("IBD"_IBI)=$G(^DGCR(399,+IBIFN,IBI))
"RTN","IBJTCA1",10,0)
 S IBDI1=$P(IBD0,U,21),IBDI1=$S(IBDI1="S":"I2",IBDI1="T":"I3",1:"I1") S IBDI1=$G(^DGCR(399,+IBIFN,IBDI1))
"RTN","IBJTCA1",11,0)
 S IBID0=$G(^DIC(36,+IBDI1,0)),IBID13=$G(^DIC(36,+IBDI1,.13))
"RTN","IBJTCA1",12,0)
 ;
"RTN","IBJTCA1",13,0)
 ;
"RTN","IBJTCA1",14,0)
 S (IBLN,VALMCNT)=1
"RTN","IBJTCA1",15,0)
 S (IBNC(1),IBTC(1),IBTC(4))=2,IBTC(5)=78,(IBNC(2),IBTC(2))=42,IBNC(3)=35,IBTW(1)=15,IBTW(2)=16,IBTW(4)=12,IBTW(5)=1,IBSW(1)=23,IBSW(2)=21,IBSW(4)=60,IBSW(5)=1
"RTN","IBJTCA1",16,0)
 ;
"RTN","IBJTCA1",17,0)
 S IBGRPB=IBLN,IBLR=1
"RTN","IBJTCA1",18,0)
 ;
"RTN","IBJTCA1",19,0)
 S IBT="Insurance Demographics" S IBLN=$$SETN(IBT,IBLN,IBLR,1)
"RTN","IBJTCA1",20,0)
 S IBWNR=$$WNRBILL^IBEFUNC(IBIFN)
"RTN","IBJTCA1",21,0)
 S IBNABP=$$NABP^IBNCPDPU(IBIFN)
"RTN","IBJTCA1",22,0)
 S IBT=$S(IBWNR:" *",1:"  ")_"Bill Payer: ",IBD=$P(IBID0,U,1) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",23,0)
 S IBT="Claim Address: " D  S IBD=$P(IBDM,U,5) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",24,0)
 . I $P(IBID0,U,1)'=$P(IBDM,U,4) S IBD=$P(IBDM,U,4) S IBLN=$$SET(IBT,IBD,IBLN,IBLR) S IBT=""
"RTN","IBJTCA1",25,0)
 I $P(IBDM,U,6)'="" S IBT="",IBD=$P(IBDM,U,6) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",26,0)
 I $P(IBDM1,U,1)'="" S IBT="",IBD=$P(IBDM1,U,1) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",27,0)
 S IBT="",IBD=$P(IBDM,U,7),IBD=IBD_$S(IBD'="":", ",1:"")_$P($G(^DIC(5,+$P(IBDM,U,8),0)),U,2)_" "_$P(IBDM,U,9),IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",28,0)
 S IBT="Claim Phone: ",IBD=$P($$BADD^IBJTU3(+IBIFN),U,2) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",29,0)
 ;
"RTN","IBJTCA1",30,0)
 S IBGRPE=IBLN,IBLN=IBGRPB,IBLR=2
"RTN","IBJTCA1",31,0)
 ;
"RTN","IBJTCA1",32,0)
 S IBT="Subscriber Demographics" S IBLN=$$SETN(IBT,IBLN,IBLR,1)
"RTN","IBJTCA1",33,0)
 S IBT="Group Number: ",IBD=$P(IBDI1,U,3) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",34,0)
 S IBT="Group Name: ",IBD=$P(IBDI1,U,15) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",35,0)
 S IBT="Subscriber ID: ",IBD=$P(IBDI1,U,2) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",36,0)
 S IBT="Employer: ",IBD=$$EMPL(+DFN) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",37,0)
 S IBT="Insured's Name: ",IBD=$P(IBDI1,U,17) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",38,0)
 S IBT="Relationship: ",IBD=$$EXSET^IBJU1($P(IBDI1,U,16),2.312,16) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",39,0)
 ;
"RTN","IBJTCA1",40,0)
 S (IBLN,VALMCNT)=$S(IBLN>IBGRPE:IBLN,1:IBGRPE)
"RTN","IBJTCA1",41,0)
 S (IBNC(1),IBTC(1))=2,(IBNC(2),IBTC(2))=42,IBNC(3)=29,IBTW(1)=12,IBTW(2)=16,IBSW(1)=26,IBSW(2)=22
"RTN","IBJTCA1",42,0)
 S (IBT,IBD)="" S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",43,0)
 ;
"RTN","IBJTCA1",44,0)
 I $$FT^IBCEF(IBIFN)=2 D
"RTN","IBJTCA1",45,0)
 . N IBXDATA,IBXSAVE K ^TMP("IBXSAVE",$J)
"RTN","IBJTCA1",46,0)
 . D F^IBCEF("N-HCFA 1500 BOX 19",,,IBIFN)
"RTN","IBJTCA1",47,0)
 . I IBXDATA'="" S IBBX19(1)=$E(IBXDATA,1,40) S:$E(IBXDATA,41,$L(IBXDATA))'="" IBBX19(2)=$E(IBXDATA,41,$L(IBXDATA))
"RTN","IBJTCA1",48,0)
 ;
"RTN","IBJTCA1",49,0)
 S IBGRPB=IBLN,IBLR=1
"RTN","IBJTCA1",50,0)
 S IBT="Claim Information" S IBLN=$$SETN(IBT,IBLN,3,1)
"RTN","IBJTCA1",51,0)
 S IBT="Bill Type: ",IBD=$$EXSET^IBJU1($P(IBD0,U,5),399,.05) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",52,0)
 S IBT="Time Frame: ",IBD=$$EXSET^IBJU1($P(IBD0,U,6),399,.06) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",53,0)
 S IBT="Rate Type: ",IBD=$P($G(^DGCR(399.3,+$P(IBD0,U,7),0)),U,1) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",54,0)
 S IBT="AR Status: ",IBD=$P($$ARSTATA^IBJTU4(IBIFN),U,1) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",55,0)
 S IBT=" Sequence: ",IBD=$P($$EXSET^IBJU1($P(IBD0,U,21),399,.21)," ",1) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",56,0)
 S IBT="Purch Svc: ",IBD=$S($P(IBDU2,U,11)="":"NO",1:$$EXPAND^IBTRE(399,233,$P(IBDU2,U,11))),IBLN=$$SET(IBT,IBD,IBLN,4)
"RTN","IBJTCA1",57,0)
 I $P(IBDM1,"^",8) S IBT="  ECME No: ",IBD=+$P(IBDM1,"^",8),IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",58,0)
 I $L($P(IBDM1,"^",9)) S IBT="ECME Ap No: ",IBD=$P(IBDM1,"^",9),IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",59,0)
 I IBNABP'="" S IBT=$S(($L($TR(IBNABP," ",""))=7):"  NCPDP No: ",1:"       NPI: "),IBD=IBNABP,IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",60,0)
 I IBWNR S IBT="MRA Status: ",IBD=$S($P(IBDTX,U,5):$P(IBDTX,U,5),1:"NOT RECEIVED"),IBLN=$$SET(IBT,$S(IBD:$$EXPAND^IBTRE(399,24,IBD),1:IBD),IBLN,IBLR)
"RTN","IBJTCA1",61,0)
 I $G(IBBX19(1))'="" D
"RTN","IBJTCA1",62,0)
 . S IBT="   Box 19: ",IBD=IBBX19(1),IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",63,0)
 . I $G(IBBX19(2))'="" S IBT=$J("",11),IBD=IBBX19(2),IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",64,0)
 ;
"RTN","IBJTCA1",65,0)
 S IBLR=4,IBPRVO=""
"RTN","IBJTCA1",66,0)
 S IBT="Providers: ",IBD="NONE"
"RTN","IBJTCA1",67,0)
 D F^IBCEF("N-ALL PROVIDERS","IBZ",,IBIFN)
"RTN","IBJTCA1",68,0)
 S IBZ0=0
"RTN","IBJTCA1",69,0)
 S Z=0
"RTN","IBJTCA1",70,0)
 F  S Z=$O(IBZ(Z)) Q:'Z  D
"RTN","IBJTCA1",71,0)
 . I $G(IBZ(Z)),$G(IBZ(Z,1))'="" S IBLN=$$SET(IBT,"(OLD PROV DATA) "_IBZ(Z,1),IBLN,IBLR),IBZ0=1 Q
"RTN","IBJTCA1",72,0)
 . I $P($G(IBZ(Z,1)),U)'="" S IBD=$E($$EXPAND^IBTRE(399.0222,.01,Z)_":"_$J("",15),1,15)_$P(IBZ(Z,1),U)_$S($P(IBZ(Z,1),U,4)'="":" ("_$P(IBZ(Z,1),U,4)_")",1:"") S IBLN=$$SET(IBT,IBD,IBLN,IBLR) S IBT=$J("",11),IBZ0=1
"RTN","IBJTCA1",73,0)
 I 'IBZ0 S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",74,0)
 ;
"RTN","IBJTCA1",75,0)
 S IBGRPE=IBLN,IBLN=IBGRPB+1,IBLR=2
"RTN","IBJTCA1",76,0)
 ;
"RTN","IBJTCA1",77,0)
 S IBT="Charge Type: ",IBD=$$EXSET^IBJU1($P(IBD0,U,27),399,.27) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",78,0)
 S IBT="Service Dates: ",IBD=$$DATE^IBJU1($P(IBDU,U,1))_" - "_$$DATE^IBJU1($P(IBDU,U,2)) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",79,0)
 S IBT="Orig Claim: ",IBD=$$BILL^RCJIBFN2(+IBIFN) S IBLN=$$SET(IBT,$J($P(IBD,U,1),9,2),IBLN,IBLR)
"RTN","IBJTCA1",80,0)
 S IBT="Balance Due: ",IBD=$J($P(IBD,U,3),9,2) S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",81,0)
 I +$P(IBDM,U,2) S IBX=$S($P(IBD0,U,21)="P":2,1:1) D  S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",82,0)
 . S IBT=$S(IBX=2:"Secondary",1:"Primary")_": ",IBD=$P($G(^DIC(36,+$P(IBDM,U,IBX),0)),U,1)
"RTN","IBJTCA1",83,0)
 . S IBX=$P(IBDU2,U,(IBX+3)) I +IBX S IBX="("_$J(IBX,0,2)_")" S IBD=$E(IBD,1,(IBSW(IBLR)-$L(IBX)-2))_"  "_IBX
"RTN","IBJTCA1",84,0)
 I +$P(IBDM,U,3) S IBX=$S($P(IBD0,U,21)="T":2,1:3) D  S IBLN=$$SET(IBT,IBD,IBLN,IBLR)
"RTN","IBJTCA1",85,0)
 . S IBT=$S(IBX=2:"Secondary",1:"Tertiary")_": ",IBD=$P($G(^DIC(36,+$P(IBDM,U,IBX),0)),U,1)
"RTN","IBJTCA1",86,0)
 . S IBX=$P(IBDU2,U,(IBX+3)) I +IBX S IBX="("_$J(IBX,0,2)_")" S IBD=$E(IBD,1,(IBSW(IBLR)-$L(IBX)-2))_"  "_IBX
"RTN","IBJTCA1",87,0)
 S IBLN=$$SET("","",IBLN,5)
"RTN","IBJTCA1",88,0)
 I IBWNR S IBT="MRA Rec Date: " D  S IBLN=$$SET(IBT,IBD,IBLN,2)
"RTN","IBJTCA1",89,0)
 . N Z
"RTN","IBJTCA1",90,0)
 . ; find last MRA for receipt date
"RTN","IBJTCA1",91,0)
 . S (IBD,Z)="" F  S Z=$O(^IBM(361.1,"B",IBIFN,Z),-1) Q:'Z  I $P($G(^IBM(361.1,Z,0)),U,4)=1 S IBD=$$DATE^IBJU1($P($P(^IBM(361.1,Z,0),U,6),".")) Q
"RTN","IBJTCA1",92,0)
 F Z=IBLN:1:IBGRPE S IBLN=$$SET("","",IBLN,5)
"RTN","IBJTCA1",93,0)
 ;
"RTN","IBJTCA1",94,0)
 S (IBLN,VALMCNT)=$S(IBLN>IBGRPE:IBLN,1:IBGRPE)
"RTN","IBJTCA1",95,0)
 ;
"RTN","IBJTCA1",96,0)
 S IBGRPB=IBLN,IBLR=1
"RTN","IBJTCA1",97,0)
 D CONT^IBJTCA2
"RTN","IBJTCA1",98,0)
 ;
"RTN","IBJTCA1",99,0)
COPAY I $O(^IBA(362.4,"C",IBIFN,0)) D
"RTN","IBJTCA1",100,0)
 . S IBT="Related Prescription Copay Information" S IBLN=IBLN+1,IBLN=$$SETN(IBT,IBLN,1,1)
"RTN","IBJTCA1",101,0)
 . N IBZ,IBX,IBC,IBCAP
"RTN","IBJTCA1",102,0)
 . S IBZ=0 F  S IBZ=$O(^IBA(362.4,"C",IBIFN,IBZ)) Q:'IBZ  D
"RTN","IBJTCA1",103,0)
 .. K ^TMP("IBTPJI",$J)
"RTN","IBJTCA1",104,0)
 .. S IBC=$G(^IBA(362.4,IBZ,0))
"RTN","IBJTCA1",105,0)
 .. D:$P(IBC,"^",5) RX^PSO52API($P(IBD0,"^",2),"IBTPJI",$P(IBC,"^",5),"","I^")
"RTN","IBJTCA1",106,0)
 .. ; original fill
"RTN","IBJTCA1",107,0)
 .. I $P(IBC,"^",10)=0 D
"RTN","IBJTCA1",108,0)
 ... S IBX=+$G(^TMP($J,"IBTPJI",$P(IBD0,"^",2),+$P(IBC,"^",5),106)),IBCAP=+$G(^(106.6))
"RTN","IBJTCA1",109,0)
 .. ; refills
"RTN","IBJTCA1",110,0)
 .. E  D
"RTN","IBJTCA1",111,0)
 ... S IBX=+$G(^TMP($J,"IBTPJI",$P(IBD0,"^",2),+$P(IBC,"^",5),"IB",+$P(IBC,"^",10),9)),IBCAP=+$G(^(9.1))
"RTN","IBJTCA1",112,0)
 .. I '$G(IBX),$G(IBCAP) S IBT="  <copay exceeded cap>",IBLN=$$SET(IBT,"",IBLN,4) Q
"RTN","IBJTCA1",113,0)
 .. I '$G(IBX) S IBT="  <none found>",IBLN=$$SET(IBT,"",IBLN,4) Q
"RTN","IBJTCA1",114,0)
 .. S IBX=$G(^IB(IBX,0))
"RTN","IBJTCA1",115,0)
 .. S IBT="Rx: "_$P(IBC,"^")_"  Chg: $"_$FN($P(IBX,"^",7),",",2)_"   Status: "_$$TITLE^XLFSTR($$EXTERNAL^DILFD(350,.05,"",$P(IBX,"^",5)))_"   Bill: "_$P(IBX,"^",11)
"RTN","IBJTCA1",116,0)
 .. S IBLN=$$SET(IBT,"",IBLN,4)
"RTN","IBJTCA1",117,0)
 K ^TMP("IBTPJI",$J)
"RTN","IBJTCA1",118,0)
 ;
"RTN","IBJTCA1",119,0)
 S (IBLN,VALMCNT)=IBLN-1
"RTN","IBJTCA1",120,0)
 ;
"RTN","IBJTCA1",121,0)
BLDQ Q
"RTN","IBJTCA1",122,0)
 ;
"RTN","IBJTCA1",123,0)
EMPL(DFN) ; returns employer name
"RTN","IBJTCA1",124,0)
 Q $P($G(^DPT(+DFN,.311)),U,1)
"RTN","IBJTCA1",125,0)
 ;
"RTN","IBJTCA1",126,0)
SET(TTL,DATA,LN,LR) ;
"RTN","IBJTCA1",127,0)
 N IBY
"RTN","IBJTCA1",128,0)
 S IBY=$J(TTL,IBTW(LR))_DATA D SET1(IBY,LN,IBTC(LR),(IBTW(LR)+IBSW(LR)))
"RTN","IBJTCA1",129,0)
 S LN=LN+1
"RTN","IBJTCA1",130,0)
 Q LN
"RTN","IBJTCA1",131,0)
 ;
"RTN","IBJTCA1",132,0)
SETN(TTL,LN,LR,RV) ;
"RTN","IBJTCA1",133,0)
 N IBY
"RTN","IBJTCA1",134,0)
 S IBY=" "_TTL_" " D SET1(IBY,LN,IBNC(LR),$L(IBY),$G(RV))
"RTN","IBJTCA1",135,0)
 S LN=LN+1
"RTN","IBJTCA1",136,0)
 Q LN
"RTN","IBJTCA1",137,0)
 ;
"RTN","IBJTCA1",138,0)
SET1(STR,LN,COL,WD,RV) ; set up TMP array with screen data
"RTN","IBJTCA1",139,0)
 N IBX S IBX=$G(^TMP("IBJTCA",$J,LN,0))
"RTN","IBJTCA1",140,0)
 S IBX=$$SETSTR^VALM1(STR,IBX,COL,WD)
"RTN","IBJTCA1",141,0)
 D SET^VALM10(LN,IBX) I $G(RV)'="" D CNTRL^VALM10(LN,COL,WD,IORVON,IORVOFF)
"RTN","IBJTCA1",142,0)
 Q
"RTN","IBNCDNC")
0^4^B7190363
"RTN","IBNCDNC",1,0)
IBNCDNC ;ALB/SS - DRUGS NON COVERED ;11/13/07
"RTN","IBNCDNC",2,0)
 ;;2.0;INTEGRATED BILLING;**384**;21-MAR-94;Build 74
"RTN","IBNCDNC",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBNCDNC",4,0)
 ;
"RTN","IBNCDNC",5,0)
 ;IA # 5185
"RTN","IBNCDNC",6,0)
 ;called from RESP1^BPSOSQL
"RTN","IBNCDNC",7,0)
 ;add/update a record in the file (#366.16) IB NDC NON COVERED BY PLAN
"RTN","IBNCDNC",8,0)
 ;IBRXN - ien of #52
"RTN","IBNCDNC",9,0)
 ;IBNDC - ndc
"RTN","IBNCDNC",10,0)
 ;IBPLAN - ien of #355.3
"RTN","IBNCDNC",11,0)
 ;IBRJCODE -reject code ien of #9002313.93
"RTN","IBNCDNC",12,0)
UPDLST(IBRXN,IBNDC,IBPLAN,IBRJCODE) ;
"RTN","IBNCDNC",13,0)
 I $$RECHCKIN^IBNCDNC1()=0 Q
"RTN","IBNCDNC",14,0)
 I (+$G(IBRXN)=0)!($G(IBNDC)="")!(+$G(IBPLAN)=0)!($G(IBRJCODE)="") Q
"RTN","IBNCDNC",15,0)
 I $$VALIDREJ^IBNCDNC1(IBRJCODE)=0 Q
"RTN","IBNCDNC",16,0)
 D UPDREC^IBNCDNC1(IBNDC,IBPLAN,IBRJCODE,$E($$RXAPI1^IBNCPUT1(IBRXN,6,"E"),1,80))
"RTN","IBNCDNC",17,0)
 Q
"RTN","IBNCDNC",18,0)
 ;checks if the NDC and GROUP PLAN combination is listed in the file (#366.15) IB NDC NOT COVERED BY PLAN
"RTN","IBNCDNC",19,0)
 ;input:
"RTN","IBNCDNC",20,0)
 ; IBNDC - drug's NDC
"RTN","IBNCDNC",21,0)
 ; IBPLAN - group plan
"RTN","IBNCDNC",22,0)
 ; IBDAYS - in how many days the status needs to be rechecked
"RTN","IBNCDNC",23,0)
 ;returned values:
"RTN","IBNCDNC",24,0)
 ; 1 - is in the list of active NON COVERED drugs ^ reject code
"RTN","IBNCDNC",25,0)
 ; 0 - is NOT in the list of active NON COVERED drugs
"RTN","IBNCDNC",26,0)
 ;     OR it is in the list but the list is older than IBDAYS, specified in the IB SITE PARAMETERS file
"RTN","IBNCDNC",27,0)
 ;     OR the NON COVERED DRUG functionality is turned OFF
"RTN","IBNCDNC",28,0)
 ; exmp: W $$CHECK^IBNCDNC(IBD("NDC"),IBPLAN)
"RTN","IBNCDNC",29,0)
CHECK(IBNDC,IBPLAN,IBDAYS) ;
"RTN","IBNCDNC",30,0)
 I IBNDC="" Q 0
"RTN","IBNCDNC",31,0)
 N IBZ,IBIEN,X1,X2,X
"RTN","IBNCDNC",32,0)
 S X1=+$O(^IBCNR(366.16,"AC",IBNDC,+$G(IBPLAN),999999999),-1)
"RTN","IBNCDNC",33,0)
 I X1=0 Q 0
"RTN","IBNCDNC",34,0)
 ;if found
"RTN","IBNCDNC",35,0)
 S X2=IBDAYS
"RTN","IBNCDNC",36,0)
 D C^%DTC
"RTN","IBNCDNC",37,0)
 I +X'<DT Q 1
"RTN","IBNCDNC",38,0)
 Q 0
"RTN","IBNCDNC",39,0)
 ;
"RTN","IBNCDNC",40,0)
RPT ;
"RTN","IBNCDNC",41,0)
 N IBPLAN,IBRJCODE,Y,IBM1,IBM2,IBSCR,IBPAGE
"RTN","IBNCDNC",42,0)
 N IBECME,IBQ
"RTN","IBNCDNC",43,0)
 S IBQ=0
"RTN","IBNCDNC",44,0)
 D SETVARS^IBNCDNC1
"RTN","IBNCDNC",45,0)
 Q:IBQ
"RTN","IBNCDNC",46,0)
 D START
"RTN","IBNCDNC",47,0)
 D ^%ZISC
"RTN","IBNCDNC",48,0)
 I IBQ W !,"Cancelled"
"RTN","IBNCDNC",49,0)
 D PAUSE^IBNCDNC1
"RTN","IBNCDNC",50,0)
 Q
"RTN","IBNCDNC",51,0)
 ;report itself
"RTN","IBNCDNC",52,0)
START ;
"RTN","IBNCDNC",53,0)
 N IBDAYS,IBNDC,IBREJ,IBPLN,IBIEN
"RTN","IBNCDNC",54,0)
 S IBDAYS=$$RECHCKIN^IBNCDNC1()
"RTN","IBNCDNC",55,0)
 S IBPAGE=0
"RTN","IBNCDNC",56,0)
 D HDR^IBNCDNC1
"RTN","IBNCDNC",57,0)
 S IBNDC=""
"RTN","IBNCDNC",58,0)
 F  S IBNDC=$O(^IBCNR(366.16,"AD",IBNDC)) Q:IBNDC=""!(IBQ=1)  D
"RTN","IBNCDNC",59,0)
 . S IBREJ=""
"RTN","IBNCDNC",60,0)
 . F  S IBREJ=$O(^IBCNR(366.16,"AD",IBNDC,IBREJ)) Q:IBREJ=""!(IBQ=1)  D
"RTN","IBNCDNC",61,0)
 . . I IBRJCODE'="ALL" Q:IBRJCODE'=IBREJ
"RTN","IBNCDNC",62,0)
 . . S IBPLN=""
"RTN","IBNCDNC",63,0)
 . . F  S IBPLN=$O(^IBCNR(366.16,"AD",IBNDC,IBREJ,IBPLN)) Q:IBPLN=""!(IBQ=1)  D
"RTN","IBNCDNC",64,0)
 . . . I IBPLAN'="ALL" Q:IBPLAN'=IBPLN
"RTN","IBNCDNC",65,0)
 . . . S IBIEN=0
"RTN","IBNCDNC",66,0)
 . . . F  S IBIEN=$O(^IBCNR(366.16,"AD",IBNDC,IBREJ,IBPLN,IBIEN)) Q:(IBIEN="")!(IBQ=1)  D
"RTN","IBNCDNC",67,0)
 . . . . D CHKP^IBNCDNC1 Q:IBQ
"RTN","IBNCDNC",68,0)
 . . . . D PRNLINE^IBNCDNC1(IBIEN,IBDAYS)
"RTN","IBNCDNC",69,0)
 Q
"RTN","IBNCDNC",70,0)
 ;---
"RTN","IBNCDNC",71,0)
 ;Check for non-covered drugs
"RTN","IBNCDNC",72,0)
 ;called from IBNCPDP1
"RTN","IBNCDNC",73,0)
 ;input:
"RTN","IBNCDNC",74,0)
 ;IBD array by reference
"RTN","IBNCDNC",75,0)
 ;return value:
"RTN","IBNCDNC",76,0)
 ;"" : submit to the payer
"RTN","IBNCDNC",77,0)
 ;"0^non- billable reason (IBRMARK text)" : do not submit - non covered drug
"RTN","IBNCDNC",78,0)
CHCK(IBD) ;
"RTN","IBNCDNC",79,0)
 N IBDAYS,IBC,IBPLAN
"RTN","IBNCDNC",80,0)
 S IBDAYS=$$RECHCKIN^IBNCDNC1()
"RTN","IBNCDNC",81,0)
 I IBDAYS=0 Q ""
"RTN","IBNCDNC",82,0)
 ;If the NONCOVERED DRUG functionality ON
"RTN","IBNCDNC",83,0)
 S IBC=$O(IBD("INS",""))  Q:'IBC ""  ; get the first insurance in COB order
"RTN","IBNCDNC",84,0)
 S IBPLAN=+$G(IBD("INS",+IBC,1)) Q:'IBPLAN ""  ; plan
"RTN","IBNCDNC",85,0)
 I $$CHECK^IBNCDNC($G(IBD("NDC")),IBPLAN,IBDAYS)=0 Q ""
"RTN","IBNCDNC",86,0)
 Q "0^NON COVERED DRUG PER PLAN"
"RTN","IBNCDNC",87,0)
 ;
"RTN","IBNCDNC",88,0)
 ;IBNCDNC
"RTN","IBNCDNC1")
0^31^B21625955
"RTN","IBNCDNC1",1,0)
IBNCDNC1 ;ALB/SS - DRUGS NON COVERED ;11/13/07
"RTN","IBNCDNC1",2,0)
 ;;2.0;INTEGRATED BILLING;**384**;21-MAR-94;Build 74
"RTN","IBNCDNC1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBNCDNC1",4,0)
 ;
"RTN","IBNCDNC1",5,0)
 Q
"RTN","IBNCDNC1",6,0)
 ;
"RTN","IBNCDNC1",7,0)
 ;in how many days we need to recheck NON-COVERED NDC+PLAN combination ?
"RTN","IBNCDNC1",8,0)
RECHCKIN() ;
"RTN","IBNCDNC1",9,0)
 Q +$P($G(^IBE(350.9,1,11)),U,2)
"RTN","IBNCDNC1",10,0)
 ;
"RTN","IBNCDNC1",11,0)
 ;is this reject code valid for the NON-COVERED DRUGS functionality?
"RTN","IBNCDNC1",12,0)
 ;IBREJ - ien of #9002313.93
"RTN","IBNCDNC1",13,0)
VALIDREJ(IBREJ) ;
"RTN","IBNCDNC1",14,0)
 Q ($O(^IBE(350.9,1,12,"B",+$G(IBREJ),0)))>0
"RTN","IBNCDNC1",15,0)
 ;
"RTN","IBNCDNC1",16,0)
 ;update or create a new record in #366.16
"RTN","IBNCDNC1",17,0)
 ;IBRJCODE - ien of #9002313.93
"RTN","IBNCDNC1",18,0)
UPDREC(IBNDC,IBPLAN,IBRJCODE,IBDRUG) ;
"RTN","IBNCDNC1",19,0)
 N IBIEN,IBEXIST
"RTN","IBNCDNC1",20,0)
 I (+$G(IBPLAN)=0)!($G(IBNDC)="")!($G(IBRJCODE)="") Q
"RTN","IBNCDNC1",21,0)
 S IBEXIST=$O(^IBCNR(366.16,"AD",IBNDC,IBRJCODE,+$G(IBPLAN),0))
"RTN","IBNCDNC1",22,0)
 ;if already exists then update
"RTN","IBNCDNC1",23,0)
 I IBEXIST>0 D FILLFLDS^IBNCPUT1(366.16,.04,IBEXIST,(DT\1)) Q
"RTN","IBNCDNC1",24,0)
 ;otherwise - create a new record
"RTN","IBNCDNC1",25,0)
 S IBEXIST=$$INSITEM^IBNCPUT1(366.16,"",IBNDC,"")
"RTN","IBNCDNC1",26,0)
 I IBEXIST>0 D
"RTN","IBNCDNC1",27,0)
 . D FILLFLDS^IBNCPUT1(366.16,.02,IBEXIST,IBPLAN)
"RTN","IBNCDNC1",28,0)
 . D FILLFLDS^IBNCPUT1(366.16,.03,IBEXIST,IBRJCODE)
"RTN","IBNCDNC1",29,0)
 . D FILLFLDS^IBNCPUT1(366.16,.04,IBEXIST,(DT\1))
"RTN","IBNCDNC1",30,0)
 . D FILLFLDS^IBNCPUT1(366.16,.05,IBEXIST,IBDRUG)
"RTN","IBNCDNC1",31,0)
 Q
"RTN","IBNCDNC1",32,0)
 ;
"RTN","IBNCDNC1",33,0)
SETVARS ;
"RTN","IBNCDNC1",34,0)
 ;newed in IBNCDNC
"RTN","IBNCDNC1",35,0)
 S (IBPLAN,IBRJCODE)=0
"RTN","IBNCDNC1",36,0)
 D MODE Q:IBQ
"RTN","IBNCDNC1",37,0)
 D DEVICE^IBNCDNC1 Q:IBQ
"RTN","IBNCDNC1",38,0)
 Q
"RTN","IBNCDNC1",39,0)
 ;
"RTN","IBNCDNC1",40,0)
DEVICE ;
"RTN","IBNCDNC1",41,0)
 N DIR,DIRUT,POP,ZTRTN,ZTIO,ZTSAVE,ZTDESC,%ZIS,ZTSK
"RTN","IBNCDNC1",42,0)
 S %ZIS="QM"
"RTN","IBNCDNC1",43,0)
 W ! D ^%ZIS
"RTN","IBNCDNC1",44,0)
 I POP S IBQ=1 Q
"RTN","IBNCDNC1",45,0)
 S IBSCR=$S($E($G(IOST),1,2)="C-":1,1:0)
"RTN","IBNCDNC1",46,0)
 ;
"RTN","IBNCDNC1",47,0)
 I $D(IO("Q")) D  S IBQ=1
"RTN","IBNCDNC1",48,0)
 . S ZTRTN="START^IBNCDNC"
"RTN","IBNCDNC1",49,0)
 . S ZTIO=ION
"RTN","IBNCDNC1",50,0)
 . S ZTSAVE("IB*")=""
"RTN","IBNCDNC1",51,0)
 . S ZTDESC="IB NON-BILLABLE DRUG REPORT"
"RTN","IBNCDNC1",52,0)
 . D ^%ZTLOAD
"RTN","IBNCDNC1",53,0)
 . W !,$S($D(ZTSK):"REQUEST QUEUED TASK="_ZTSK,1:"REQUEST CANCELLED")
"RTN","IBNCDNC1",54,0)
 . D HOME^%ZIS
"RTN","IBNCDNC1",55,0)
 U IO
"RTN","IBNCDNC1",56,0)
 Q
"RTN","IBNCDNC1",57,0)
 ;
"RTN","IBNCDNC1",58,0)
MODE ;
"RTN","IBNCDNC1",59,0)
 N DIR,DIC,DIRUT,DUOUT
"RTN","IBNCDNC1",60,0)
 N IBM1,IBM2
"RTN","IBNCDNC1",61,0)
 S (IBM1,IBM2)="A"
"RTN","IBNCDNC1",62,0)
 S DIR(0)="S^G:GROUP PLAN;A:ALL"
"RTN","IBNCDNC1",63,0)
 S DIR("A")="Display Specific (G)roup plan or (A)LL"
"RTN","IBNCDNC1",64,0)
 S DIR("B")="ALL"
"RTN","IBNCDNC1",65,0)
 D ^DIR K DIR I $D(DIRUT) S IBQ=1 Q
"RTN","IBNCDNC1",66,0)
 S IBM1=Y
"RTN","IBNCDNC1",67,0)
 I IBM1="G" S DIC="^IBA(355.3,",DIC(0)="AEQMN",DIC("A")="Select Group Plan: " D ^DIC Q:$D(DUOUT)  S IBPLAN=$S(Y>0:+Y,1:0)
"RTN","IBNCDNC1",68,0)
 I 'IBPLAN W "   ALL" S IBPLAN="ALL"
"RTN","IBNCDNC1",69,0)
 ;
"RTN","IBNCDNC1",70,0)
 S DIR(0)="S^R:REJECT CODE;A:ALL"
"RTN","IBNCDNC1",71,0)
 S DIR("A")="Display Specific (R)eject Code or (A)LL"
"RTN","IBNCDNC1",72,0)
 S DIR("B")="ALL"
"RTN","IBNCDNC1",73,0)
 D ^DIR K DIR I $D(DIRUT) S IBQ=1 Q
"RTN","IBNCDNC1",74,0)
 S IBM2=Y
"RTN","IBNCDNC1",75,0)
 I IBM2="R" S DIC="^BPSF(9002313.93,",DIC(0)="AEQMN",DIC("A")="Select Reject Code: " D ^DIC Q:$D(DUOUT)  S IBRJCODE=$S(Y>0:+Y,1:0)
"RTN","IBNCDNC1",76,0)
 I 'IBRJCODE W "   ALL" S IBRJCODE="ALL"
"RTN","IBNCDNC1",77,0)
 Q
"RTN","IBNCDNC1",78,0)
 ;
"RTN","IBNCDNC1",79,0)
PRNLINE(IB36616,IBDAYS) ;
"RTN","IBNCDNC1",80,0)
 ;00779-0588-30 IMIPRAMINE 25MG T 70     AETNA         12345767  11/03/07  YES    
"RTN","IBNCDNC1",81,0)
 N IBZ,IBPLAN,IBINS,IBGRNUM,X1,X2,IBACTFLG
"RTN","IBNCDNC1",82,0)
 S IBZ=$G(^IBCNR(366.16,+$G(IB36616),0))
"RTN","IBNCDNC1",83,0)
 S IBACTFLG=0
"RTN","IBNCDNC1",84,0)
 I IBZ="" Q
"RTN","IBNCDNC1",85,0)
 W !
"RTN","IBNCDNC1",86,0)
 W ?0,$E($P(IBZ,U,1),1,13) ;ndc
"RTN","IBNCDNC1",87,0)
 W ?14,$E($P(IBZ,U,5),1,17) ;drug name
"RTN","IBNCDNC1",88,0)
 W ?32,$E($P($G(^BPSF(9002313.93,+$P(IBZ,U,3),0)),U),1,2) ;reject code
"RTN","IBNCDNC1",89,0)
 S IBPLAN=$P(IBZ,U,2)
"RTN","IBNCDNC1",90,0)
 S IBINS=$P($G(^DIC(36,+$G(^IBA(355.3,IBPLAN,0)),0)),U)
"RTN","IBNCDNC1",91,0)
 W ?39,$E(IBINS,1,13) ;insurance name
"RTN","IBNCDNC1",92,0)
 S IBGRNUM=$P($G(^IBA(355.3,IBPLAN,0)),U,4)
"RTN","IBNCDNC1",93,0)
 W ?53,$E(IBGRNUM,1,9) ;group number
"RTN","IBNCDNC1",94,0)
 S X1=(+$P(IBZ,U,4))\1
"RTN","IBNCDNC1",95,0)
 I X1>0 D
"RTN","IBNCDNC1",96,0)
 . W ?63,$E($$DAT^IBNCPEV(X1),1,8) ;last date rejected
"RTN","IBNCDNC1",97,0)
 . I IBDAYS>0 S X2=IBDAYS D C^%DTC I +X'<DT S IBACTFLG=1 Q
"RTN","IBNCDNC1",98,0)
 . I IBDAYS'>0 S IBACTFLG=-1 ;the functionality was turned off
"RTN","IBNCDNC1",99,0)
 W ?73,$S(IBACTFLG=1:"Yes",IBACTFLG=0:"No",1:"") ;active?
"RTN","IBNCDNC1",100,0)
 Q
"RTN","IBNCDNC1",101,0)
 ;
"RTN","IBNCDNC1",102,0)
HDR ;
"RTN","IBNCDNC1",103,0)
 N IBSLCTD,IBLEN,IBPOS,IBPLN
"RTN","IBNCDNC1",104,0)
 S IBPLN=IBPLAN
"RTN","IBNCDNC1",105,0)
 I IBPLAN'="ALL" S IBPLN=$E($P($G(^DIC(36,+$G(^IBA(355.3,IBPLAN,0)),0)),U),1,13)
"RTN","IBNCDNC1",106,0)
 W @IOF S IBPAGE=+$G(IBPAGE)+1
"RTN","IBNCDNC1",107,0)
 W !,?70,"PAGE: ",IBPAGE
"RTN","IBNCDNC1",108,0)
 W !,?26,"DRUGS NOT COVERED BY PLANS"
"RTN","IBNCDNC1",109,0)
 I +$G(IBDAYS)>0 W !,?14,"TIMEFRAME TO RECHECK THE NOT COVERED STATUS = ",+$G(IBDAYS)," DAYS"
"RTN","IBNCDNC1",110,0)
 I +$G(IBDAYS)'>0 W !,?20,"THE FUNCTIONALITY HAS BEEN TURNED OFF"
"RTN","IBNCDNC1",111,0)
 S IBSLCTD="REJECTED CODE: "_IBRJCODE_"  GROUP PLAN: "_IBPLN
"RTN","IBNCDNC1",112,0)
 S IBLEN=$L(IBSLCTD),IBLEN=40-((IBLEN/2)\1)
"RTN","IBNCDNC1",113,0)
 S $P(IBPOS," ",IBLEN)=""
"RTN","IBNCDNC1",114,0)
 W !,IBPOS,IBSLCTD
"RTN","IBNCDNC1",115,0)
 W !,"NDC#          DRUG NAME         REJECT INSURANCE     GROUP     LAST DATE ACTIVE?"
"RTN","IBNCDNC1",116,0)
 W !,?32,"CODE                 NUMBER    REJECTED"
"RTN","IBNCDNC1",117,0)
 W !,"================================================================================"
"RTN","IBNCDNC1",118,0)
 Q
"RTN","IBNCDNC1",119,0)
 ;
"RTN","IBNCDNC1",120,0)
CHKP ;Check for EOP
"RTN","IBNCDNC1",121,0)
 N Y
"RTN","IBNCDNC1",122,0)
 I $Y>(IOSL-4) D:IBSCR PAUSE Q:IBQ  D HDR
"RTN","IBNCDNC1",123,0)
 Q
"RTN","IBNCDNC1",124,0)
 ;
"RTN","IBNCDNC1",125,0)
PAUSE ;
"RTN","IBNCDNC1",126,0)
 N X U IO(0) W !,"Press RETURN to continue, '^' to exit:" R X:DTIME S:'$T X="^" S:X["^" IBQ=1
"RTN","IBNCDNC1",127,0)
 U IO
"RTN","IBNCDNC1",128,0)
 Q
"RTN","IBNCDNC1",129,0)
 ;
"RTN","IBNCPBB")
0^12^B87491341
"RTN","IBNCPBB",1,0)
IBNCPBB ;DALOI/AAT - ECME BACKBILLING ;24-JUN-2003
"RTN","IBNCPBB",2,0)
 ;;2.0;INTEGRATED BILLING;**276,347,384**;21-MAR-94;Build 74
"RTN","IBNCPBB",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBNCPBB",4,0)
 ;
"RTN","IBNCPBB",5,0)
 ;
"RTN","IBNCPBB",6,0)
 Q
"RTN","IBNCPBB",7,0)
EN ;[IB GENERATE ECME RX BILLS] entry
"RTN","IBNCPBB",8,0)
 N IBMOD1,IBMOD3,IBPAT,IBRX,IBBDT,IBEDT,IBSEL,IBREF,IBPAUSE
"RTN","IBNCPBB",9,0)
 S IBREF=$NA(^TMP($J,"IBNCPBB"))
"RTN","IBNCPBB",10,0)
 S IBPAUSE=1
"RTN","IBNCPBB",11,0)
 K @IBREF D
"RTN","IBNCPBB",12,0)
 . N IBEXIT
"RTN","IBNCPBB",13,0)
 . S IBEXIT=0
"RTN","IBNCPBB",14,0)
 . D MODE I IBEXIT Q
"RTN","IBNCPBB",15,0)
 . I IBMOD1="P" D SELECT I IBEXIT Q
"RTN","IBNCPBB",16,0)
 . I IBMOD1="R" D SELECT2 I IBEXIT Q
"RTN","IBNCPBB",17,0)
 . D CONFIRM I IBEXIT Q
"RTN","IBNCPBB",18,0)
 . D PROCESS^IBNCPBB1 I IBEXIT Q
"RTN","IBNCPBB",19,0)
 I IBPAUSE W ! D PAUSE()
"RTN","IBNCPBB",20,0)
 K @IBREF
"RTN","IBNCPBB",21,0)
 Q
"RTN","IBNCPBB",22,0)
 ;
"RTN","IBNCPBB",23,0)
CT(IBTRN) ;CT ENTRY
"RTN","IBNCPBB",24,0)
 N IBZ,IBRX,IBRXN,IBFIL,IBEXIT,IBPAT,IBRDT,IBFDT,IBRES,IBBIL,IBBN,IBQ,IBSCRES,IBERR
"RTN","IBNCPBB",25,0)
 S IBQ=0
"RTN","IBNCPBB",26,0)
 D FULL^VALM1
"RTN","IBNCPBB",27,0)
 W !!,"This option sends electronic Pharmacy Claims to the Payer"
"RTN","IBNCPBB",28,0)
 S VALMBCK="R"
"RTN","IBNCPBB",29,0)
 S IBZ=$G(^IBT(356,IBTRN,0)) Q:IBZ=""
"RTN","IBNCPBB",30,0)
 S IBRX=$P(IBZ,U,8),IBFIL=$P(IBZ,U,10)
"RTN","IBNCPBB",31,0)
 I 'IBRX D  Q
"RTN","IBNCPBB",32,0)
 . W !!,"This is not a Pharmacy Claims Tracking record",*7,!
"RTN","IBNCPBB",33,0)
 . D PAUSE("Cannot submit to ECME")
"RTN","IBNCPBB",34,0)
 ;
"RTN","IBNCPBB",35,0)
 ;Release date:
"RTN","IBNCPBB",36,0)
 I IBFIL=0 S IBRDT=$$FILE^IBRXUTL(IBRX,31)
"RTN","IBNCPBB",37,0)
 E  S IBRDT=$$SUBFILE^IBRXUTL(IBRX,IBFIL,52,17)
"RTN","IBNCPBB",38,0)
 I 'IBRDT D  Q
"RTN","IBNCPBB",39,0)
 . W !!,"The Prescription is not released.",!
"RTN","IBNCPBB",40,0)
 . D PAUSE("Cannot submit to ECME")
"RTN","IBNCPBB",41,0)
 ; -- Drug DEA ROI check.
"RTN","IBNCPBB",42,0)
 S IBPAT=$P(IBZ,U,2)
"RTN","IBNCPBB",43,0)
 S IBDRUG=$$FILE^IBRXUTL(IBRX,6)
"RTN","IBNCPBB",44,0)
 ; Fill/Refill Date:
"RTN","IBNCPBB",45,0)
 S IBFDT=$S('IBFIL:$$FILE^IBRXUTL(IBRX,22),1:$$SUBFILE^IBRXUTL(IBRX,IBFIL,52,.01))
"RTN","IBNCPBB",46,0)
 I $$INSUR^IBBAPI(IBPAT,IBFDT,"P",.IBANY,1) S IBINS=+$G(IBANY("IBBAPI","INSUR",1,1)) S IBQ=$$ROICHK^IBNCPDR4(IBPAT,IBDRUG,IBINS,IBFDT) D:IBQ=1 ROICLN^IBNCPDR4(IBTRN) I 'IBQ D PAUSE() Q  ;Requires ROI
"RTN","IBNCPBB",47,0)
 ;
"RTN","IBNCPBB",48,0)
 I $$SC($P(IBZ,U,19)) D  Q:IBQ
"RTN","IBNCPBB",49,0)
 . N DIR,DIE,DA,DR,Y
"RTN","IBNCPBB",50,0)
 . W !!,"The Rx is marked 'non-billable' in CT: ",$P($G(^IBE(356.8,+$P(IBZ,U,19),0)),U)
"RTN","IBNCPBB",51,0)
 . W !,"If you continue, the NON-BILLABLE REASON will be deleted.",!
"RTN","IBNCPBB",52,0)
 . S DIR(0)="Y",DIR("A")="Are you sure you want to bill this episode"
"RTN","IBNCPBB",53,0)
 . S DIR("B")="NO"
"RTN","IBNCPBB",54,0)
 . S DIR("?")="If you want to bill this Rx, enter 'Yes' - otherwise, enter 'No'"
"RTN","IBNCPBB",55,0)
 . W ! D ^DIR K DIR
"RTN","IBNCPBB",56,0)
 . I 'Y S IBQ=1 Q
"RTN","IBNCPBB",57,0)
 . S DIE="^IBT(356,",DA=IBTRN,DR=".19///@" D ^DIE ;clean NB reason
"RTN","IBNCPBB",58,0)
 . S IBSCRES(IBRX,IBFIL)=1 ; sc resolved flag
"RTN","IBNCPBB",59,0)
 ;
"RTN","IBNCPBB",60,0)
 S IBZ=$G(^IBT(356,IBTRN,0)) ; refresh
"RTN","IBNCPBB",61,0)
 I $P(IBZ,U,19) D  Q
"RTN","IBNCPBB",62,0)
 . W !!,"The Prescription is marked 'non-billable' in Claims Tracking",*7
"RTN","IBNCPBB",63,0)
 . W !,"Reason non-billable: ",$P($G(^IBE(356.8,+$P(IBZ,U,19),0),"Unknown"),U),!
"RTN","IBNCPBB",64,0)
 . D PAUSE("Cannot submit to ECME")
"RTN","IBNCPBB",65,0)
 ; Is the patient billable at the released date?
"RTN","IBNCPBB",66,0)
 S IBRES=$$ECMEBIL^IBNCPDPU(IBPAT,IBFDT)
"RTN","IBNCPBB",67,0)
 I 'IBRES D  Q
"RTN","IBNCPBB",68,0)
 . W !!,"The patient is not ECME Billable at the ",$S(IBFIL:"re",1:""),"fill date."
"RTN","IBNCPBB",69,0)
 . W !,"Reason: ",$P(IBRES,U,2,255),!
"RTN","IBNCPBB",70,0)
 . D PAUSE("Cannot submit to ECME")
"RTN","IBNCPBB",71,0)
 ;
"RTN","IBNCPBB",72,0)
 S IBRXN=$$FILE^IBRXUTL(IBRX,.01)
"RTN","IBNCPBB",73,0)
 S IBBIL=$$BILL(IBRXN,IBRDT)
"RTN","IBNCPBB",74,0)
 I IBBIL,'$P($G(^DGCR(399,IBBIL,"S")),U,16) D  Q
"RTN","IBNCPBB",75,0)
 . W !!,"Rx# ",IBRXN," was previously billed."
"RTN","IBNCPBB",76,0)
 . W !,"Please manually cancel the bill# ",$P($G(^DGCR(399,IBBIL,0)),U)," before submitting claim to ECME.",!
"RTN","IBNCPBB",77,0)
 . D PAUSE("Cannot submit to ECME")
"RTN","IBNCPBB",78,0)
 I IBBIL W !,"The bill# ",$P($G(^DGCR(399,IBBIL,0)),U)," has been cancelled.",!
"RTN","IBNCPBB",79,0)
 ;
"RTN","IBNCPBB",80,0)
 D CONFRX(IBRXN) Q:$G(IBEXIT)
"RTN","IBNCPBB",81,0)
 ;
"RTN","IBNCPBB",82,0)
 W !!,"Submitting Rx# ",IBRXN W:IBFIL ", Refill# ",IBFIL W " ..."
"RTN","IBNCPBB",83,0)
 S IBRES=$$SUBMIT^IBNCPDPU(IBRX,IBFIL) W !,"  ",$S(+IBRES=0:"S",1:"Not s")_"ent through ECME."
"RTN","IBNCPBB",84,0)
 I +IBRES'=0 W !,"  *** ECME returned status: ",$$STAT(IBRES),!
"RTN","IBNCPBB",85,0)
 I +IBRES=0 W !!,"The Rx have been submitted to ECME for electronic billing",!
"RTN","IBNCPBB",86,0)
 D PAUSE()
"RTN","IBNCPBB",87,0)
 Q
"RTN","IBNCPBB",88,0)
 ;
"RTN","IBNCPBB",89,0)
MODE ;
"RTN","IBNCPBB",90,0)
 ; IBMOD1: "P"-Single Patient, "R"-Single Rx
"RTN","IBNCPBB",91,0)
 ; IBMOD3 (if IBMOD1="P"): "U"-Unbilled, "A"-All Rx
"RTN","IBNCPBB",92,0)
 ; IBPAT (if IBMOD1="P"): Patient's DFN
"RTN","IBNCPBB",93,0)
 ; IBBDT,IBEDT (if IBMOD1="P"): From/To dates inclusive
"RTN","IBNCPBB",94,0)
 N DIR,DIC,DIRUT,DUOUT,Y,PSOFILE
"RTN","IBNCPBB",95,0)
 S (IBMOD1,IBMOD3)=""
"RTN","IBNCPBB",96,0)
 S DIR(0)="S^P:SINGLE (P)ATIENT;R:SINGLE (R)X"
"RTN","IBNCPBB",97,0)
 S DIR("A")="SINGLE (P)ATIENT, SINGLE (R)X"
"RTN","IBNCPBB",98,0)
 S DIR("B")="P"
"RTN","IBNCPBB",99,0)
 D ^DIR K DIR I $D(DIRUT) S IBEXIT=1,IBPAUSE=0 Q
"RTN","IBNCPBB",100,0)
 S IBMOD1=Y
"RTN","IBNCPBB",101,0)
 ; Enter Rx
"RTN","IBNCPBB",102,0)
 I IBMOD1="R" W ! S PSOFILE=52,DIC="^PSRX(",DIC(0)="AEQMN" D DIC^PSODI(PSOFILE,.DIC) S:$D(DUOUT) IBEXIT=1 S IBRX=$S(Y>0:+Y,1:0) S:'IBRX IBEXIT=1,IBPAUSE=0
"RTN","IBNCPBB",103,0)
 K PSODIY
"RTN","IBNCPBB",104,0)
 I IBMOD1="R" Q
"RTN","IBNCPBB",105,0)
 ;
"RTN","IBNCPBB",106,0)
 I IBMOD1'="P" W !,"???" S IBEXIT=1 Q  ; Invalid mode
"RTN","IBNCPBB",107,0)
 ;Enter Patient
"RTN","IBNCPBB",108,0)
 S DIC="^DPT(",DIC(0)="AEQMN" D ^DIC S:$D(DUOUT) IBEXIT=1 S IBPAT=$S(Y>0:+Y,1:0) S:'IBPAT IBEXIT=1,IBPAUSE=0
"RTN","IBNCPBB",109,0)
 Q:IBEXIT
"RTN","IBNCPBB",110,0)
 I '$$ECMEBIL^IBNCPDPU(IBPAT,DT) W *7,!!,"Warning! The patient is currently not ECME billable!"
"RTN","IBNCPBB",111,0)
 ;
"RTN","IBNCPBB",112,0)
 D DATE I IBEXIT S IBPAUSE=0 Q
"RTN","IBNCPBB",113,0)
 ;
"RTN","IBNCPBB",114,0)
 S DIR(0)="S^U:UNBILLED;A:ALL RX"
"RTN","IBNCPBB",115,0)
 S DIR("A")="(U)NBILLED, (A)LL RX"
"RTN","IBNCPBB",116,0)
 S DIR("B")="U"
"RTN","IBNCPBB",117,0)
 D ^DIR K DIR I $D(DIRUT) S IBEXIT=1,IBPAUSE=0 Q
"RTN","IBNCPBB",118,0)
 S IBMOD3=Y
"RTN","IBNCPBB",119,0)
 Q
"RTN","IBNCPBB",120,0)
 ;
"RTN","IBNCPBB",121,0)
 ;begin/end date
"RTN","IBNCPBB",122,0)
DATE ;
"RTN","IBNCPBB",123,0)
 N Y,%DT
"RTN","IBNCPBB",124,0)
 S (IBBDT,IBEDT)=DT
"RTN","IBNCPBB",125,0)
 W !
"RTN","IBNCPBB",126,0)
 S %DT="AEX"
"RTN","IBNCPBB",127,0)
 S %DT("A")="START WITH DATE: ",%DT("B")="TODAY"
"RTN","IBNCPBB",128,0)
 D ^%DT K %DT
"RTN","IBNCPBB",129,0)
 I Y'>0 S IBEXIT=1 Q
"RTN","IBNCPBB",130,0)
 S IBBDT=+Y
"RTN","IBNCPBB",131,0)
 S %DT="AEX"
"RTN","IBNCPBB",132,0)
 S %DT("A")="GO TO DATE: ",%DT("B")="TODAY" ;$$DAT2^IBOUTL(IBBDT)
"RTN","IBNCPBB",133,0)
 D ^%DT K %DT
"RTN","IBNCPBB",134,0)
 I Y'>0 S IBEXIT=1 Q
"RTN","IBNCPBB",135,0)
 S IBEDT=+Y
"RTN","IBNCPBB",136,0)
 Q
"RTN","IBNCPBB",137,0)
 ;
"RTN","IBNCPBB",138,0)
SELECT ;Select from patient's list
"RTN","IBNCPBB",139,0)
 ; (IBPAT,IBBDT,IBEDT,IBMOD3)
"RTN","IBNCPBB",140,0)
 N IBD,IBRX,IBZ,IBDATA,IBCNT,Y,PDFN,LIST,LIST2,NODE,RXNUMEXT,LIST,IBDATE,CNT1,CNT2,RFNUM
"RTN","IBNCPBB",141,0)
 S CNT1=0,CNT2=0,IBCNT=0
"RTN","IBNCPBB",142,0)
 S LIST="IBRXSELARR"
"RTN","IBNCPBB",143,0)
 S NODE=2
"RTN","IBNCPBB",144,0)
 D RX^PSO52API(IBPAT,LIST,,,NODE,,)
"RTN","IBNCPBB",145,0)
 S RXNUMEXT=0 F  S RXNUMEXT=$O(^TMP($J,LIST,"B",RXNUMEXT)) Q:'RXNUMEXT  D
"RTN","IBNCPBB",146,0)
 . S IBRX=0 F  S IBRX=$O(^TMP($J,LIST,"B",RXNUMEXT,IBRX)) Q:'IBRX  D
"RTN","IBNCPBB",147,0)
 .. S IBDATE=$P(^TMP($J,LIST,IBPAT,IBRX,31),"^",1)
"RTN","IBNCPBB",148,0)
 .. I (IBDATE>IBBDT)&(IBDATE<IBEDT) D
"RTN","IBNCPBB",149,0)
 ... S IBZ=$$RXZERO^IBRXUTL(IBPAT,IBRX) Q:IBZ=""
"RTN","IBNCPBB",150,0)
 ... I $P(IBZ,U,2)'=IBPAT Q
"RTN","IBNCPBB",151,0)
 ... I '$$FILE^IBRXUTL(IBRX,31) Q  ; not released
"RTN","IBNCPBB",152,0)
 ... S IBDATA=$$RXDATA(IBRX,0)
"RTN","IBNCPBB",153,0)
 ... I ('$P(IBDATA,U,6))!(IBMOD3="A") S IBCNT=IBCNT+1,@IBREF@(IBCNT)=IBDATA
"RTN","IBNCPBB",154,0)
 ... S LIST2="IBCPBBRF"
"RTN","IBNCPBB",155,0)
 ... S NODE="R"
"RTN","IBNCPBB",156,0)
 ... D RX^PSO52API(IBPAT,LIST2,IBRX,,NODE,,)
"RTN","IBNCPBB",157,0)
 ... S RFNUM=0 F  S RFNUM=$O(^TMP($J,LIST2,IBPAT,IBRX,"RF",RFNUM)) Q:RFNUM'>0  D:$$SUBFILE^IBRXUTL(IBRX,RFNUM,52,17)
"RTN","IBNCPBB",158,0)
 .... S IBDATA=$$RXDATA(IBRX,RFNUM)
"RTN","IBNCPBB",159,0)
 .... I $P(IBDATA,U,6),IBMOD3'="A" Q  ; unbilled only
"RTN","IBNCPBB",160,0)
 .... S IBCNT=IBCNT+1,@IBREF@(IBCNT)=IBDATA
"RTN","IBNCPBB",161,0)
 ... K ^TMP($J,LIST2)
"RTN","IBNCPBB",162,0)
 K ^TMP($J,LIST)
"RTN","IBNCPBB",163,0)
 D MKCHOICE
"RTN","IBNCPBB",164,0)
 Q
"RTN","IBNCPBB",165,0)
SELECT2 ;Select from Rx list
"RTN","IBNCPBB",166,0)
 ; (IBRX)
"RTN","IBNCPBB",167,0)
 N IBCNT,Y,PDFN,RIFN,LST
"RTN","IBNCPBB",168,0)
 S RIFN=0
"RTN","IBNCPBB",169,0)
 W ! S IBPAUSE=1
"RTN","IBNCPBB",170,0)
 S PDFN=$$FILE^IBRXUTL(IBRX,2)
"RTN","IBNCPBB",171,0)
 S LST="SEL2LST"
"RTN","IBNCPBB",172,0)
 I $$RXZERO^IBRXUTL(PDFN,IBRX)="" W !,"The Rx does not exist. Please try again." S IBEXIT=1 Q
"RTN","IBNCPBB",173,0)
 I $$FILE^IBRXUTL(IBRX,31)="" W !,"The Rx has not been released. Please try again." S IBEXIT=1 Q
"RTN","IBNCPBB",174,0)
 S IBCNT=1,@IBREF@(IBCNT)=$$RXDATA(IBRX,0)
"RTN","IBNCPBB",175,0)
 D RX^PSO52API(PDFN,LST,IBRX,,"R",,)
"RTN","IBNCPBB",176,0)
 S RIFN=0 F  S RIFN=$O(^TMP($J,LST,PDFN,IBRX,"RF",RIFN)) Q:RIFN'>0  D:$$SUBFILE^IBRXUTL(IBRX,RIFN,52,17)
"RTN","IBNCPBB",177,0)
 .S IBCNT=IBCNT+1,@IBREF@(IBCNT)=$$RXDATA(IBRX,RIFN)
"RTN","IBNCPBB",178,0)
 K ^TMP($J,LST)
"RTN","IBNCPBB",179,0)
 D MKCHOICE
"RTN","IBNCPBB",180,0)
 Q
"RTN","IBNCPBB",181,0)
 ;
"RTN","IBNCPBB",182,0)
MKCHOICE ;
"RTN","IBNCPBB",183,0)
 N Y
"RTN","IBNCPBB",184,0)
 W !
"RTN","IBNCPBB",185,0)
 S Y=0 F  S Y=$O(@IBREF@(Y)) Q:'Y  D DISP(Y)
"RTN","IBNCPBB",186,0)
 ;
"RTN","IBNCPBB",187,0)
 I $O(@IBREF@(0))="" S IBEXIT=1 W !!," No Rxs meet the entered criteria. Please try again." Q
"RTN","IBNCPBB",188,0)
 I $O(@IBREF@(""),-1)=1 S IBSEL(1)="" Q  ; one item only
"RTN","IBNCPBB",189,0)
 F  W !!,"Enter Line Item(s) to submit to ECME or (A)LL :" R IBSEL:DTIME S:'$T IBEXIT=1 Q:IBEXIT  Q:IBSEL'["?"  D
"RTN","IBNCPBB",190,0)
 . W !?10,"Enter number(s) or item range(s) separated by comma."
"RTN","IBNCPBB",191,0)
 . W !?10,"Example: 1,3,7-11"
"RTN","IBNCPBB",192,0)
 Q:IBEXIT
"RTN","IBNCPBB",193,0)
 I IBSEL'="",$TR(IBSEL,"al","AL")=$E("ALL",1,$L(IBSEL)),$L(IBSEL)<3 W $E("ALL",$L(IBSEL)+1,3) S IBSEL="ALL"
"RTN","IBNCPBB",194,0)
 I IBSEL="" S IBEXIT=1 W " Nothing selected" Q
"RTN","IBNCPBB",195,0)
 I IBSEL="^" S IBEXIT=1 W " Cancelled" Q
"RTN","IBNCPBB",196,0)
 ;Collect the required into the IBSEL(i) local array
"RTN","IBNCPBB",197,0)
 D PARSE(.IBSEL)
"RTN","IBNCPBB",198,0)
 I $O(IBSEL(0))="" S IBEXIT=1 W !!,"No item(s) match the selection." Q
"RTN","IBNCPBB",199,0)
 Q
"RTN","IBNCPBB",200,0)
 ;
"RTN","IBNCPBB",201,0)
CONFIRM ;
"RTN","IBNCPBB",202,0)
 N DIR,Y
"RTN","IBNCPBB",203,0)
 W !
"RTN","IBNCPBB",204,0)
 S DIR(0)="Y",DIR("B")="NO",DIR("A")="Submit the selected RX(s) to ECME for electronic billing"
"RTN","IBNCPBB",205,0)
 D ^DIR I Y'=1 S IBEXIT=1
"RTN","IBNCPBB",206,0)
 Q
"RTN","IBNCPBB",207,0)
 ;
"RTN","IBNCPBB",208,0)
CONFRX(IBRX) ;
"RTN","IBNCPBB",209,0)
 N DIR,Y
"RTN","IBNCPBB",210,0)
 W !
"RTN","IBNCPBB",211,0)
 S DIR(0)="Y",DIR("B")="NO",DIR("A")="Submit the Rx# "_IBRX_" to ECME for electronic billing"
"RTN","IBNCPBB",212,0)
 D ^DIR I Y'=1 S IBEXIT=1
"RTN","IBNCPBB",213,0)
 Q
"RTN","IBNCPBB",214,0)
 ;
"RTN","IBNCPBB",215,0)
STAT(X) ;
"RTN","IBNCPBB",216,0)
 I +X<6 Q $P(X,"^",2)
"RTN","IBNCPBB",217,0)
 Q "Unknown Status"
"RTN","IBNCPBB",218,0)
 ;
"RTN","IBNCPBB",219,0)
BILL(IBRXN,IBDT) ;Bill IEN (if any) or null
"RTN","IBNCPBB",220,0)
 N RES,X,IBZ
"RTN","IBNCPBB",221,0)
 S IBDT=$P(IBDT,".")
"RTN","IBNCPBB",222,0)
 S RES=""
"RTN","IBNCPBB",223,0)
 S X="" F  S X=$O(^IBA(362.4,"B",IBRXN,X),-1) Q:X=""  D:X  Q:RES
"RTN","IBNCPBB",224,0)
 . S IBZ=$G(^IBA(362.4,X,0))
"RTN","IBNCPBB",225,0)
 . I $P($P(IBZ,U,3),".")=IBDT,$P(IBZ,U,2) S RES=+$P(IBZ,U,2)
"RTN","IBNCPBB",226,0)
 Q RES
"RTN","IBNCPBB",227,0)
 ;
"RTN","IBNCPBB",228,0)
 ;
"RTN","IBNCPBB",229,0)
RXDATA(IBRX,IBFIL) ;
"RTN","IBNCPBB",230,0)
 ;RxIEN^Rx#^Fill#^RelDate^DrugIEN^BillIEN
"RTN","IBNCPBB",231,0)
 N IBRXN,IBDT,IBDRUG,IBBIL,DATRET
"RTN","IBNCPBB",232,0)
 S IBRXN=$$FILE^IBRXUTL(IBRX,.01)
"RTN","IBNCPBB",233,0)
 I IBFIL=0 S IBDT=$$FILE^IBRXUTL(IBRX,22)
"RTN","IBNCPBB",234,0)
 E  S IBDT=$$SUBFILE^IBRXUTL(IBRX,IBFIL,52,.01)
"RTN","IBNCPBB",235,0)
 S IBDT=$P(IBDT,".")
"RTN","IBNCPBB",236,0)
 S IBDRUG=$$FILE^IBRXUTL(IBRX,6)
"RTN","IBNCPBB",237,0)
 S IBBIL=$$BILL(IBRXN,IBDT)
"RTN","IBNCPBB",238,0)
 S DATRET=IBRX_"^"_IBRXN_"^"_IBFIL_"^"_IBDT_"^"_IBDRUG_"^"_IBBIL
"RTN","IBNCPBB",239,0)
 Q DATRET
"RTN","IBNCPBB",240,0)
 ;
"RTN","IBNCPBB",241,0)
DISP(IBITEM) ;
"RTN","IBNCPBB",242,0)
 N IBD,IBBILN,IBDRUG,IBBIL
"RTN","IBNCPBB",243,0)
 S IBD=$G(@IBREF@(IBITEM)) Q:IBD=""
"RTN","IBNCPBB",244,0)
 W !,IBITEM," ",?4,$P(IBD,U,2)," ",?15,$P(IBD,U,3)," ",?20,$$DAT2^IBOUTL($P(IBD,U,4))," "
"RTN","IBNCPBB",245,0)
 W ?32,$E($$DRUG^IBRXUTL1(+$P(IBD,U,5)),1,30)
"RTN","IBNCPBB",246,0)
 S IBBIL=$P(IBD,U,6)
"RTN","IBNCPBB",247,0)
 I IBBIL W ?64,$P($G(^DGCR(399,+IBBIL,0)),U) I $P($G(^DGCR(399,IBBIL,"S")),U,16) W "(canc)"
"RTN","IBNCPBB",248,0)
 Q
"RTN","IBNCPBB",249,0)
 ;
"RTN","IBNCPBB",250,0)
PARSE(X) ;
"RTN","IBNCPBB",251,0)
 N I,J,N
"RTN","IBNCPBB",252,0)
 S X=$TR(X," ")
"RTN","IBNCPBB",253,0)
 S X=$TR(X,";",",")
"RTN","IBNCPBB",254,0)
 I $TR(IBSEL,"al","AL")="ALL" D  Q
"RTN","IBNCPBB",255,0)
 . F I=1:1 Q:'$D(@IBREF@(I))  S IBSEL(I)=""
"RTN","IBNCPBB",256,0)
 F I=1:1:$L(X,",") S N=$P(X,",",I) D:N'=""
"RTN","IBNCPBB",257,0)
 . I N'["-" D:N  Q
"RTN","IBNCPBB",258,0)
 . . I $D(@IBREF@(N)) S X(N)=""
"RTN","IBNCPBB",259,0)
 . ; Processing range
"RTN","IBNCPBB",260,0)
 . N N1,N2
"RTN","IBNCPBB",261,0)
 . S N1=+$P(N,"-",1),N2=+$P(N,"-",2)
"RTN","IBNCPBB",262,0)
 . F J=N1:$S(N2<N1:-1,1:1):N2 I $D(@IBREF@(J)) S X(J)=""
"RTN","IBNCPBB",263,0)
 Q
"RTN","IBNCPBB",264,0)
 ;
"RTN","IBNCPBB",265,0)
PAUSE(MESSAGE) ;
"RTN","IBNCPBB",266,0)
 D EN^DDIOL("","","!")
"RTN","IBNCPBB",267,0)
 I $G(MESSAGE)'="" D EN^DDIOL(MESSAGE) D EN^DDIOL(". ","","?0")
"RTN","IBNCPBB",268,0)
 D EN^DDIOL("Press RETURN to continue: ")
"RTN","IBNCPBB",269,0)
 R %:DTIME
"RTN","IBNCPBB",270,0)
 Q
"RTN","IBNCPBB",271,0)
 ;
"RTN","IBNCPBB",272,0)
SC(IEN) ;Service connected
"RTN","IBNCPBB",273,0)
 N IBT
"RTN","IBNCPBB",274,0)
 I 'IEN Q 0
"RTN","IBNCPBB",275,0)
 S IBT=$P($G(^IBE(356.8,IEN,0)),U)
"RTN","IBNCPBB",276,0)
 I IBT="NEEDS SC DETERMINATION" Q 1
"RTN","IBNCPBB",277,0)
 I IBT="OTHER" Q 1
"RTN","IBNCPBB",278,0)
 Q 0
"RTN","IBNCPBB",279,0)
 ;
"RTN","IBNCPBB",280,0)
 ;IBNCPBB
"RTN","IBNCPBB1")
0^41^B4732084
"RTN","IBNCPBB1",1,0)
IBNCPBB1 ;ALB/BDB - CONTINUATION OF ECME BACKBILLING ;24-JUN-2003
"RTN","IBNCPBB1",2,0)
 ;;2.0;INTEGRATED BILLING;**384**;21-MAR-94;Build 74
"RTN","IBNCPBB1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBNCPBB1",4,0)
 ;
"RTN","IBNCPBB1",5,0)
 Q
"RTN","IBNCPBB1",6,0)
 ;
"RTN","IBNCPBB1",7,0)
PROCESS ;
"RTN","IBNCPBB1",8,0)
 N RES,IBY,IBD,IBRX,IBFIL,IBERR,IBBIL,IBPAT,IBDRUG,IBINS,IBDT,IBQ
"RTN","IBNCPBB1",9,0)
 S IBERR=0
"RTN","IBNCPBB1",10,0)
 S IBY=0 F  S IBY=$O(IBSEL(IBY)) Q:'IBY  D
"RTN","IBNCPBB1",11,0)
 . S IBD=$G(@IBREF@(IBY)) Q:IBD=""
"RTN","IBNCPBB1",12,0)
 . S IBRX=$P(IBD,U),IBFIL=+$P(IBD,U,3),IBBIL=$P(IBD,U,6)
"RTN","IBNCPBB1",13,0)
 . W !,"Submitting Rx# ",$P(IBD,U,2) W:IBFIL "Refill# ",IBFIL W:'IBFIL " (original fill)" W " ..."
"RTN","IBNCPBB1",14,0)
 . I IBBIL,'$P($G(^DGCR(399,IBBIL,"S")),U,16) D  S IBERR=IBERR+1 Q
"RTN","IBNCPBB1",15,0)
 .. W !," *** Rx# ",$P(IBD,U,2)," was previously billed."
"RTN","IBNCPBB1",16,0)
 .. W !," Please cancel the Bill No ",$P($G(^DGCR(399,IBBIL,0)),U)," before submitting the claim"
"RTN","IBNCPBB1",17,0)
 . ; -- Drug DEA ROI check.
"RTN","IBNCPBB1",18,0)
 . K ^TMP($J,"IBDRUG")
"RTN","IBNCPBB1",19,0)
 . S IBDRUG=$P(IBD,U,5)
"RTN","IBNCPBB1",20,0)
 . D DATA^PSS50(IBDRUG,,,,,"IBDRUG")
"RTN","IBNCPBB1",21,0)
 . S IBDEA=$G(^TMP($J,"IBDRUG",IBDRUG,3))
"RTN","IBNCPBB1",22,0)
 . I IBDEA["U" D  Q:'IBQ
"RTN","IBNCPBB1",23,0)
 .. S IBPAT=$$FILE^IBRXUTL(IBRX,2)
"RTN","IBNCPBB1",24,0)
 .. S IBDT=$P(IBD,U,4)
"RTN","IBNCPBB1",25,0)
 .. I '$$INSUR^IBBAPI(IBPAT,IBDT,"P",.IBANY,1) S IBQ=1 Q
"RTN","IBNCPBB1",26,0)
 .. S IBINS=+$G(IBANY("IBBAPI","INSUR",1,1))
"RTN","IBNCPBB1",27,0)
 .. S IBQ=$$ROICHK^IBNCPDR4(IBPAT,IBDRUG,IBINS,IBDT) D:IBQ ROICLN^IBNCPDR4("",IBRX,IBFIL)
"RTN","IBNCPBB1",28,0)
 .. I 'IBQ S IBERR=IBERR+1
"RTN","IBNCPBB1",29,0)
 . S RES=$$SUBMIT^IBNCPDPU(IBRX,IBFIL) W "  ",$S(+RES=0:"Sent through ECME",1:"Not sent")
"RTN","IBNCPBB1",30,0)
 . I +RES'=0 W !?5,"*** ECME returned status: ",$$STAT^IBNCPBB(RES) S IBERR=IBERR+1
"RTN","IBNCPBB1",31,0)
 I 'IBERR W !!,"The selected Rx(s) have been submitted to ECME",!,"for electronic billing"
"RTN","IBNCPBB1",32,0)
 Q
"RTN","IBNCPBB1",33,0)
 ;
"RTN","IBNCPBB1",34,0)
 ;IBNCPBB1
"RTN","IBNCPDP")
0^52^B5165020
"RTN","IBNCPDP",1,0)
IBNCPDP ;OAK/ELZ - APIS FOR NCPCP/ECME ;1/9/08  17:27
"RTN","IBNCPDP",2,0)
 ;;2.0;INTEGRATED BILLING;**223,276,363,383,384**;21-MAR-94;Build 74
"RTN","IBNCPDP",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBNCPDP",4,0)
 ;
"RTN","IBNCPDP",5,0)
 ;
"RTN","IBNCPDP",6,0)
RX(DFN,IBD) ; pharmacy package call, passing in IBD by ref
"RTN","IBNCPDP",7,0)
 ; this is called by PSO for all prescriptions issued, return is
"RTN","IBNCPDP",8,0)
 ; a response to bill ECME or not with array for billing data elements
"RTN","IBNCPDP",9,0)
 ; third piece of return is an Eligibility indicator for the prescription
"RTN","IBNCPDP",10,0)
 ;
"RTN","IBNCPDP",11,0)
 ; IBD("IEN")         = Prescription IEN
"RTN","IBNCPDP",12,0)
 ;    ("FILL NUMBER") = Fill number (0 is initial)
"RTN","IBNCPDP",13,0)
 ;    ("FILL DATE")   = Fill or refill date
"RTN","IBNCPDP",14,0)
 ;    ("RELEASE DATE")= Date of the Rx release in FileMan format
"RTN","IBNCPDP",15,0)
 ;    ("NDC")         = NDC number for drug
"RTN","IBNCPDP",16,0)
 ;    ("DEA")         = DEA special handling info
"RTN","IBNCPDP",17,0)
 ;    ("COST")        = cost of medication being dispenced
"RTN","IBNCPDP",18,0)
 ;    ("AO")          = Agent Orange (0,1 OR Null)
"RTN","IBNCPDP",19,0)
 ;    ("EC")          = Environmental Contaminant (0,1 OR Null)
"RTN","IBNCPDP",20,0)
 ;    ("HNC")         = Head/neck cancer (0,1 OR Null)
"RTN","IBNCPDP",21,0)
 ;    ("IR")          = Ionizing radiation (0,1 OR Null)
"RTN","IBNCPDP",22,0)
 ;    ("MST")         = Military sexual trauma (0,1 OR Null)
"RTN","IBNCPDP",23,0)
 ;    ("SC")          = Service connected (0,1 OR Null)
"RTN","IBNCPDP",24,0)
 ;    ("CV")          = Combat Veteran (0,1 OR Null)
"RTN","IBNCPDP",25,0)
 ;    ("QTY")         = Quantity of med
"RTN","IBNCPDP",26,0)
 ;    ("EPHARM")      = #9002313.56 ien (E-PHARMACY division)
"RTN","IBNCPDP",27,0)
 ;
"RTN","IBNCPDP",28,0)
 ;
"RTN","IBNCPDP",29,0)
 ; IBD("INS",n,1) = insurance array to bill in n order
"RTN","IBNCPDP",30,0)
 ;                  file 355.3 ien (group)^bin^pcn^payer sheet^group id^
"RTN","IBNCPDP",31,0)
 ;                  cardholder id^patient relationship code^
"RTN","IBNCPDP",32,0)
 ;                  cardholder first name^cardholder last name^
"RTN","IBNCPDP",33,0)
 ;                  home plan state ^Payer Sheet B2 ^Payer Sheet B3
"RTN","IBNCPDP",34,0)
 ;                  Software/Vendor Cert ID ^ Ins Name
"RTN","IBNCPDP",35,0)
 ;    ("INS",n,2) = dispensing fee^basis of cost determination^
"RTN","IBNCPDP",36,0)
 ;                  awp or tort rate or cost^gross amount due^
"RTN","IBNCPDP",37,0)
 ;                  administrative fee
"RTN","IBNCPDP",38,0)
 ;
"RTN","IBNCPDP",39,0)
 ;   for basis of cost determination the following is used:
"RTN","IBNCPDP",40,0)
 ;      "07" would be sent for Usual & Customary
"RTN","IBNCPDP",41,0)
 ;      "01" would be sent for AWP
"RTN","IBNCPDP",42,0)
 ;      "05" would be sent for Cost calculations
"RTN","IBNCPDP",43,0)
 ;
"RTN","IBNCPDP",44,0)
 ;    ("INS",n,3) = group name^ins co ph 3^plan ID^
"RTN","IBNCPDP",45,0)
 ;                  insurance type (V=vet, T=tricare)^
"RTN","IBNCPDP",46,0)
 ;                  insurance company (#36) ien
"RTN","IBNCPDP",47,0)
 ;
"RTN","IBNCPDP",48,0)
 N IBRES,IBNB
"RTN","IBNCPDP",49,0)
 S IBRES=$$RX^IBNCPDP1(DFN,.IBD)
"RTN","IBNCPDP",50,0)
 ;remove "Not ECME billable: " from the reason text
"RTN","IBNCPDP",51,0)
 S IBNB="Not ECME billable: "
"RTN","IBNCPDP",52,0)
 I IBRES[IBNB S IBRES=$P(IBRES,U)_U_$P($P(IBRES,U,2),IBNB,2)_U_$P(IBRES,U,3)
"RTN","IBNCPDP",53,0)
 Q IBRES
"RTN","IBNCPDP",54,0)
 ;
"RTN","IBNCPDP",55,0)
 ;
"RTN","IBNCPDP",56,0)
STORESP(DFN,IBD) ; this is an API for pharmacy/ecme to use to relay
"RTN","IBNCPDP",57,0)
 ; results of billing using the ecme software.  If electronic billing is
"RTN","IBNCPDP",58,0)
 ; successful, then bills will be established.  If not, then we will
"RTN","IBNCPDP",59,0)
 ; flag the entry in ct for paper or not billable.
"RTN","IBNCPDP",60,0)
 ;
"RTN","IBNCPDP",61,0)
 ; IBD("STATUS")       = Bill status (PAID, REJECTED,REVERSED
"RTN","IBNCPDP",62,0)
 ;                        CLOSED,RELEASED,or SUBMITTED)
"RTN","IBNCPDP",63,0)
 ;    ("FILL DATE")    = Fill Date
"RTN","IBNCPDP",64,0)
 ;    ("PRESCRIPTION") = Prescription IEN from drug file (#52)
"RTN","IBNCPDP",65,0)
 ;    ("FILL NUMBER")  = Fill or refill number
"RTN","IBNCPDP",66,0)
 ;    ("BILLED")       = Amount billed
"RTN","IBNCPDP",67,0)
 ;    ("PAID")         = Amount paid
"RTN","IBNCPDP",68,0)
 ;    ("BCID")         = Reference number to the claim for payment
"RTN","IBNCPDP",69,0)
 ;                       BCID stands for Bill Claim ID
"RTN","IBNCPDP",70,0)
 ;    ("PLAN")         = IEN of the the entry in the GROUP INSURANCE
"RTN","IBNCPDP",71,0)
 ;                       PLAN file(#355.3)(captured from the
"RTN","IBNCPDP",72,0)
 ;                       $$RX^IBNCPDP call)
"RTN","IBNCPDP",73,0)
 ;    ("COPAY")        = Patient's copay from ECME response
"RTN","IBNCPDP",74,0)
 ;    ("RX NO")        = RX number from file 52
"RTN","IBNCPDP",75,0)
 ;    ("DRUG")         = IEN of file #50 DRUG
"RTN","IBNCPDP",76,0)
 ;    ("DAYS SUPPLY")  = Days Supply
"RTN","IBNCPDP",77,0)
 ;    ("QTY")          = Quantity
"RTN","IBNCPDP",78,0)
 ;    ("NDC")          = NDC
"RTN","IBNCPDP",79,0)
 ;    ("CLOSE REASON") = Optional, Pointer to the IB file #356.8
"RTN","IBNCPDP",80,0)
 ;                      "CLAIMS TRACKING NON-BILLABLE REASONS"
"RTN","IBNCPDP",81,0)
 ;    ("CLOSE COMMENT")= Optional, if the close reason is defined
"RTN","IBNCPDP",82,0)
 ;                       then the Close Comment parameter may be
"RTN","IBNCPDP",83,0)
 ;                       sent to IB
"RTN","IBNCPDP",84,0)
 ;    ("DROP TO PAPER")= Optional, this parameter may be set to 1(TRUE)
"RTN","IBNCPDP",85,0)
 ;                       for certain Close Claim Reasons, indicating
"RTN","IBNCPDP",86,0)
 ;                       that that the closed episode still may be
"RTN","IBNCPDP",87,0)
 ;                       "dropped to paper" - passed to the Autobiller
"RTN","IBNCPDP",88,0)
 ;    ("RELEASE COPAY")= Optional, if the claim is being closed, setting
"RTN","IBNCPDP",89,0)
 ;                       this parameter to 1 (TRUE) indicates that the
"RTN","IBNCPDP",90,0)
 ;                       patients copay should be released off hold
"RTN","IBNCPDP",91,0)
 ;    ("DIVISION")     = Pointer to the MC DIVISION file (#40.8)
"RTN","IBNCPDP",92,0)
 ;    ("AUTH #")       = ECME approval/authorization number
"RTN","IBNCPDP",93,0)
 ;    ("CLAIMID")      = Reference Number to ECME
"RTN","IBNCPDP",94,0)
 ;    ("EPHARM")       = Optional, #9002313.56 ien (E-PHARMACY division)
"RTN","IBNCPDP",95,0)
 ;
"RTN","IBNCPDP",96,0)
 ;
"RTN","IBNCPDP",97,0)
 ; Return is the bill number for success or 1 if not billable.
"RTN","IBNCPDP",98,0)
 ; "0^reason" indicates not success
"RTN","IBNCPDP",99,0)
 ;
"RTN","IBNCPDP",100,0)
 Q $$ECME^IBNCPDP2(DFN,.IBD)
"RTN","IBNCPDP",101,0)
 ;
"RTN","IBNCPDP",102,0)
 ;
"RTN","IBNCPDP",103,0)
UPAWP(IBNDC,IBAWP,IBADT) ; used to update AWPs.  This is an API that
"RTN","IBNCPDP",104,0)
 ; pharmacy will call.
"RTN","IBNCPDP",105,0)
 ;
"RTN","IBNCPDP",106,0)
 ;  IBNDC = NDC number to update with the price.
"RTN","IBNCPDP",107,0)
 ;  IBAWP = average wholesale price of the NDC
"RTN","IBNCPDP",108,0)
 ;  IBADT  = effective date of change (optional, default it today)
"RTN","IBNCPDP",109,0)
 ;
"RTN","IBNCPDP",110,0)
 ;  return will be a positive number indicating success.
"RTN","IBNCPDP",111,0)
 ;  if it is unsuccessful, then "0^reason" will be returned.
"RTN","IBNCPDP",112,0)
 ;
"RTN","IBNCPDP",113,0)
 Q $$UPAWP^IBNCPDP3(IBNDC,IBAWP,$G(IBADT,DT))
"RTN","IBNCPDP",114,0)
 ;
"RTN","IBNCPDP",115,0)
 ;
"RTN","IBNCPDP",116,0)
DEA(IBDEA,IBRMARK) ; used to check the DEA special handling.
"RTN","IBNCPDP",117,0)
 ; pass in IBDEA (dea code to check out)
"RTN","IBNCPDP",118,0)
 ;      optional pass in IBRMARK by reference (reason not billable)
"RTN","IBNCPDP",119,0)
 ; return:  1 or 0^why not billable
"RTN","IBNCPDP",120,0)
 ;
"RTN","IBNCPDP",121,0)
 ;  -- check for compound,  NOT BILLABLE
"RTN","IBNCPDP",122,0)
 N IBRES
"RTN","IBNCPDP",123,0)
 I $G(IBDEA)="" S IBRES="0^Null DEA Special Handling field" G DEAQ
"RTN","IBNCPDP",124,0)
 I IBDEA["M"!(IBDEA["0") S IBRMARK="DRUG NOT BILLABLE",IBRES="0^COMPOUND DRUG" G DEAQ
"RTN","IBNCPDP",125,0)
 ; -- check drug (not investigational, supply, over the counter, or nutritional supplement drug
"RTN","IBNCPDP",126,0)
 ;  "E" means always ecme billable
"RTN","IBNCPDP",127,0)
 I (IBDEA["I"!(IBDEA["S")!(IBDEA["9"))!(IBDEA["N"),IBDEA'["E" S IBRMARK="DRUG NOT BILLABLE",IBRES="0^"_IBRMARK
"RTN","IBNCPDP",128,0)
DEAQ Q $G(IBRES,1)
"RTN","IBNCPDP1")
0^11^B62284917
"RTN","IBNCPDP1",1,0)
IBNCPDP1 ;OAK/ELZ - PROCESSING FOR NEW RX REQUESTS ;5/22/08  15:24
"RTN","IBNCPDP1",2,0)
 ;;2.0;INTEGRATED BILLING;**223,276,339,363,383,405,384**;21-MAR-94;Build 74
"RTN","IBNCPDP1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBNCPDP1",4,0)
 ;
"RTN","IBNCPDP1",5,0)
 ;
"RTN","IBNCPDP1",6,0)
RX(DFN,IBD) ; pharmacy package call, passing in IBD by ref
"RTN","IBNCPDP1",7,0)
 ; this is called by PSO for all prescriptions issued, return is
"RTN","IBNCPDP1",8,0)
 ; a response to bill ECME or not with array for billing data elements
"RTN","IBNCPDP1",9,0)
 ;warning: back-billing flag:
"RTN","IBNCPDP1",10,0)
 ;if passed IBSCRES(IBRXN,IBFIL)=1
"RTN","IBNCPDP1",11,0)
 ; - then the SC Determination is just done by the IB clerk (billable)
"RTN","IBNCPDP1",12,0)
 ;
"RTN","IBNCPDP1",13,0)
 ;clean up the list of non-answered SC/Env.indicators questions and INS
"RTN","IBNCPDP1",14,0)
 K IBD("SC/EI NO ANSW"),IBD("INS")
"RTN","IBNCPDP1",15,0)
 ;
"RTN","IBNCPDP1",16,0)
 N IBTRKR,IBARR,IBADT,IBRXN,IBFIL,IBTRKRN,IBRMARK,IBANY,IBX,IBT,IBINS,IBSAVE,IBDEA
"RTN","IBNCPDP1",17,0)
 N IBFEE,IBEABD,IBBI,IBIT,IBPRICE,IBRS,IBRT,IBTRN,IBCHG,IBERMSG,IBRES,IBNEEDS
"RTN","IBNCPDP1",18,0)
 ;
"RTN","IBNCPDP1",19,0)
 I '$G(DFN) S IBRES="0^No DFN" G RXQ
"RTN","IBNCPDP1",20,0)
 S IBRXN=+$G(IBD("IEN")) I 'IBRXN S IBRES="0^No Rx IEN" G RXQ
"RTN","IBNCPDP1",21,0)
 S IBFIL=+$G(IBD("FILL NUMBER"),-1) I IBFIL<0 S IBRES="0^No fill number" G RXQ
"RTN","IBNCPDP1",22,0)
 S IBD("QTY")=+$G(IBD("QTY")) I 'IBD("QTY") S IBRES="0^No Quantity" G RXQ
"RTN","IBNCPDP1",23,0)
 ;
"RTN","IBNCPDP1",24,0)
 S IBRES="0^Error"
"RTN","IBNCPDP1",25,0)
 S (IBEABD,IBADT)=+$G(IBD("FILL DATE"),DT)
"RTN","IBNCPDP1",26,0)
 ;
"RTN","IBNCPDP1",27,0)
 ; -- look up insurance for patient
"RTN","IBNCPDP1",28,0)
 D ALL^IBCNS1(DFN,"IBINS",1,IBADT,1)
"RTN","IBNCPDP1",29,0)
 ;
"RTN","IBNCPDP1",30,0)
 ; -- determine rate type
"RTN","IBNCPDP1",31,0)
 S IBRT=$$RT^IBNCPDPU(DFN,.IBINS)
"RTN","IBNCPDP1",32,0)
 ;
"RTN","IBNCPDP1",33,0)
 ; -- claims tracking info
"RTN","IBNCPDP1",34,0)
 S IBTRKR=$G(^IBE(350.9,1,6))
"RTN","IBNCPDP1",35,0)
 ; date can't be before parameters
"RTN","IBNCPDP1",36,0)
 S $P(IBTRKR,U)=$S('$P(IBTRKR,U,4):0,+IBTRKR&(IBADT<+IBTRKR):0,1:IBADT)
"RTN","IBNCPDP1",37,0)
 ; already in claims tracking
"RTN","IBNCPDP1",38,0)
 S IBTRKRN=+$O(^IBT(356,"ARXFL",IBRXN,IBFIL,0))
"RTN","IBNCPDP1",39,0)
 I IBTRKRN,$$PAPERBIL^IBNCPNB(IBTRKRN) S IBRES="0^Existing IB Bill in CT",IBD("NO ECME INSURANCE")=1 G RXQ
"RTN","IBNCPDP1",40,0)
 ; already billed as Tricare
"RTN","IBNCPDP1",41,0)
 I $D(^IBA(351.5,"B",IBRXN_";"_IBFIL)) S IBRES="0^Already billed under prior Tricare process",IBD("NO ECME INSURANCE")=1 G RXQ
"RTN","IBNCPDP1",42,0)
 ;
"RTN","IBNCPDP1",43,0)
 ; -- no pharmacy coverage, update ct if applicable, quit
"RTN","IBNCPDP1",44,0)
 I '$$PTCOV^IBCNSU3(DFN,IBADT,"PHARMACY",.IBANY) S IBRMARK=$S($G(IBANY):"NO PHARMACY COVERAGE",1:"NOT INSURED") D:$P(IBTRKR,U,4)=2 CT S IBRES="0^"_IBRMARK,IBD("NO ECME INSURANCE")=1 G RXQ
"RTN","IBNCPDP1",45,0)
 ;
"RTN","IBNCPDP1",46,0)
 ;  -- check for DEA SPECIAL HDLG
"RTN","IBNCPDP1",47,0)
 S IBDEA=$$DEA^IBNCPDP($G(IBD("DEA")),.IBRMARK) I 'IBDEA S IBRES=IBDEA D CT G RXQ
"RTN","IBNCPDP1",48,0)
 ;
"RTN","IBNCPDP1",49,0)
 ;retrieve indicators from file #52 and overwrite the indicators in IBD array
"RTN","IBNCPDP1",50,0)
 D GETINDIC^IBNCPUT2(+IBD("IEN"),.IBD)
"RTN","IBNCPDP1",51,0)
 ; -- process patient exemptions if any (if not already resolved)
"RTN","IBNCPDP1",52,0)
 I $G(IBD("SC/EI OVR"))'=1 D CL^SDCO21(DFN,IBADT,"",.IBARR)
"RTN","IBNCPDP1",53,0)
 ; check out exemptions
"RTN","IBNCPDP1",54,0)
 S IBNEEDS=0 ;flag will be set to 1 if at least one of the questions wasn't answered
"RTN","IBNCPDP1",55,0)
 I $G(IBD("SC/EI OVR"))'=1 I $D(IBARR)>9 F IBX=2:1 S IBT=$P($T(EXEMPT+IBX),";;",2) Q:IBT=""  D:$D(IBARR(+IBT))
"RTN","IBNCPDP1",56,0)
 . I $G(IBD($P(IBT,U,2)))=0 Q
"RTN","IBNCPDP1",57,0)
 . I $G(IBD($P(IBT,U,2))) S IBRMARK=$P(IBT,U,3) Q
"RTN","IBNCPDP1",58,0)
 . I '$G(IBSCRES(IBRXN,IBFIL)) S IBNEEDS=1 D
"RTN","IBNCPDP1",59,0)
 . . S IBD("SC/EI NO ANSW")=$S($G(IBD("SC/EI NO ANSW"))="":$P(IBT,U,2),1:$G(IBD("SC/EI NO ANSW"))_","_$P(IBT,U,2))
"RTN","IBNCPDP1",60,0)
 I '$D(IBRMARK),IBNEEDS=1 S IBRMARK="NEEDS SC DETERMINATION"
"RTN","IBNCPDP1",61,0)
 I $D(IBRMARK) D CT S IBRES="0^"_IBRMARK G RXQ
"RTN","IBNCPDP1",62,0)
 ; Clean-up the NEEDS SC DETERMINATION record if resolved
"RTN","IBNCPDP1",63,0)
 ; And check if it is non-billable in CT
"RTN","IBNCPDP1",64,0)
 I IBTRKRN D
"RTN","IBNCPDP1",65,0)
 . N IBNBR,IBNBRT
"RTN","IBNCPDP1",66,0)
 . S IBNBR=$P($G(^IBT(356,+IBTRKRN,0)),U,19) Q:'IBNBR
"RTN","IBNCPDP1",67,0)
 . S IBNBRT=$P($G(^IBE(356.8,IBNBR,0)),U) Q:IBNBRT=""
"RTN","IBNCPDP1",68,0)
 . ; if refill was deleted (not RX) and now the refill is re-entered
"RTN","IBNCPDP1",69,0)
 . ;use $$RXSTATUS^IBNCPRR instead of $G(^PSRX(IBRXN,"STA"))
"RTN","IBNCPDP1",70,0)
 . I IBNBRT="PRESCRIPTION DELETED",$$RXSTATUS^IBNCPRR(DFN,IBRXN)'=13 D  Q
"RTN","IBNCPDP1",71,0)
 . . N DIE,DA,DR
"RTN","IBNCPDP1",72,0)
 . . ; clean up REASON NOT BILLABLE and ADDITIONAL COMMENT
"RTN","IBNCPDP1",73,0)
 . . S DIE="^IBT(356,",DA=+IBTRKRN,DR=".19////@;1.08////@" D ^DIE
"RTN","IBNCPDP1",74,0)
 . ; Clean up NBR if released
"RTN","IBNCPDP1",75,0)
 . I IBNBRT="PRESCRIPTION NOT RELEASED" D:$G(IBD("RELEASE DATE"))  Q
"RTN","IBNCPDP1",76,0)
 . . N DIE,DA,DR
"RTN","IBNCPDP1",77,0)
 . . S DIE="^IBT(356,",DA=+IBTRKRN,DR=".19////@" D ^DIE
"RTN","IBNCPDP1",78,0)
 . ; Clean up 'Needs SC determ'
"RTN","IBNCPDP1",79,0)
 . I IBNBRT="NEEDS SC DETERMINATION" D  Q
"RTN","IBNCPDP1",80,0)
 . . N DIE,DA,DR
"RTN","IBNCPDP1",81,0)
 . . S DIE="^IBT(356,",DA=+IBTRKRN,DR=".19////@" D ^DIE
"RTN","IBNCPDP1",82,0)
 . S IBRMARK=IBNBRT
"RTN","IBNCPDP1",83,0)
 I $D(IBRMARK) S IBRES="0^Non-Billable in CT: "_IBRMARK G RXQ
"RTN","IBNCPDP1",84,0)
 ;
"RTN","IBNCPDP1",85,0)
 ; -- setup insurance data for patient
"RTN","IBNCPDP1",86,0)
 ; Note: if more than one insurance with the same COB then the latest insurance occurance overrides the first one(s)
"RTN","IBNCPDP1",87,0)
 ; Exmp:
"RTN","IBNCPDP1",88,0)
 ; IBINS("S",1,1)=""
"RTN","IBNCPDP1",89,0)
 ; IBINS("S",1,3)="" <<--- this will be primary
"RTN","IBNCPDP1",90,0)
 S IBERMSG="" ; Error message
"RTN","IBNCPDP1",91,0)
 S IBX=0 F  S IBX=$O(IBINS("S",IBX)) Q:'IBX  D
"RTN","IBNCPDP1",92,0)
 . S IBT=0 F  S IBT=$O(IBINS("S",IBX,IBT)) Q:'IBT  D
"RTN","IBNCPDP1",93,0)
 .. N IBDAT,IBPL,IBINSN,IBPIEN,IBY,IBZ
"RTN","IBNCPDP1",94,0)
 .. S IBZ=$G(IBINS(IBT,0)) Q:IBZ=""
"RTN","IBNCPDP1",95,0)
 .. S IBPL=$P(IBZ,U,18) ; plan
"RTN","IBNCPDP1",96,0)
 .. Q:'IBPL
"RTN","IBNCPDP1",97,0)
 .. Q:'$$PLCOV^IBCNSU3(IBPL,IBADT,3)  ; not covered
"RTN","IBNCPDP1",98,0)
 .. I '$D(IBD("INS")),$P(IBRT,"^",3)="V",($P($G(^IBE(355.1,+$P($G(^IBA(355.3,+IBPL,0)),"^",9),0)),"^")["TRICARE"!($P($G(^(0)),"^")="CHAMPVA")) K IBINS Q  ;Tricare/ChampVa coverage for a Vet
"RTN","IBNCPDP1",99,0)
 .. S IBINSN=$P($G(^DIC(36,+$G(^IBA(355.3,+IBPL,0)),0)),U) ; ins name
"RTN","IBNCPDP1",100,0)
 .. S IBPIEN=+$G(^IBA(355.3,+IBPL,6))
"RTN","IBNCPDP1",101,0)
 .. I 'IBPIEN S IBERMSG="Plan not linked to the Payer" Q  ; Not linked
"RTN","IBNCPDP1",102,0)
 .. D STCHK^IBCNRU1(IBPIEN,.IBY)
"RTN","IBNCPDP1",103,0)
 .. I $E($G(IBY(1)))'="A" S IBERMSG=$$ERMSG^IBNCPNB($P($G(IBY(6)),",")) Q  ; not active
"RTN","IBNCPDP1",104,0)
 .. S IBDAT=IBPL ; Plan IEN
"RTN","IBNCPDP1",105,0)
 .. S $P(IBDAT,U,2)=$G(IBY(2)) ; BIN
"RTN","IBNCPDP1",106,0)
 .. S $P(IBDAT,U,3)=$G(IBY(3)) ; PCN
"RTN","IBNCPDP1",107,0)
 .. S $P(IBDAT,U,4)=$P($G(^BPSF(9002313.92,+$P($G(IBY(5)),",",1),0)),U) ; Payer Sheet B1
"RTN","IBNCPDP1",108,0)
 .. S $P(IBDAT,U,5)=$P($G(IBINS(IBT,355.3)),U,4) ; Group ID
"RTN","IBNCPDP1",109,0)
 .. S $P(IBDAT,U,6)=$P(IBZ,U,2) ; Cardholder ID
"RTN","IBNCPDP1",110,0)
 .. S $P(IBDAT,U,7)=$P(IBZ,U,16) ; Patient Relationship Code
"RTN","IBNCPDP1",111,0)
 .. S $P(IBDAT,U,8)=$P($P($P(IBZ,U,17),",",2)," ") ; Cardholder First Name
"RTN","IBNCPDP1",112,0)
 .. S $P(IBDAT,U,9)=$P($P(IBZ,U,17),",") ; Cardholder Last Name
"RTN","IBNCPDP1",113,0)
 .. S $P(IBDAT,U,10)=$P($G(^DIC(36,+IBZ,.11)),U,5) ; State
"RTN","IBNCPDP1",114,0)
 .. S $P(IBDAT,U,11)=$P($G(^BPSF(9002313.92,+$P($G(IBY(5)),",",2),0)),U) ; Payer Sheet B2
"RTN","IBNCPDP1",115,0)
 .. S $P(IBDAT,U,12)=$P($G(^BPSF(9002313.92,+$P($G(IBY(5)),",",3),0)),U) ; Payer Sheet B3
"RTN","IBNCPDP1",116,0)
 .. S $P(IBDAT,U,13)=$G(IBY(4)) ; Software/Vendor Cert ID
"RTN","IBNCPDP1",117,0)
 .. S $P(IBDAT,U,14)=IBINSN ; Ins Name
"RTN","IBNCPDP1",118,0)
 .. S IBD("INS",IBX,1)=IBDAT
"RTN","IBNCPDP1",119,0)
 .. S IBDAT=$P($G(IBINS(IBT,355.3)),"^",3) ;group name
"RTN","IBNCPDP1",120,0)
 .. S $P(IBDAT,U,2)=$$PHONE^IBNCPDP6(+IBZ) ;ins co ph 3
"RTN","IBNCPDP1",121,0)
 .. S $P(IBDAT,U,3)=$$GET1^DIQ(366.03,IBPIEN_",",.01) ;plan ID
"RTN","IBNCPDP1",122,0)
 .. S $P(IBDAT,U,4)=$S($P($G(^IBE(355.1,+$P($G(IBINS(IBT,355.3)),"^",9),0)),"^")="TRICARE":"T",1:"V") ; plan type
"RTN","IBNCPDP1",123,0)
 .. S $P(IBDAT,U,5)=+$G(^IBA(355.3,+IBPL,0)) ; insurance co ien
"RTN","IBNCPDP1",124,0)
 .. S IBD("INS",IBX,3)=IBDAT
"RTN","IBNCPDP1",125,0)
 I '$D(IBD("INS")),IBERMSG'="" S IBRES="0^Not ECME billable: "_IBERMSG,IBD("NO ECME INSURANCE")=1 G RXQ
"RTN","IBNCPDP1",126,0)
 I '$D(IBD("INS")) S IBRES="0^No Insurance ECME billable",IBD("NO ECME INSURANCE")=1 G RXQ
"RTN","IBNCPDP1",127,0)
 ;
"RTN","IBNCPDP1",128,0)
 ; -- check drug for sensitive dx special handling code and ROI on file
"RTN","IBNCPDP1",129,0)
 I IBD("DEA")["U",$D(IBD("INS",1,3)) D  G:$D(IBRMARK) RXQ
"RTN","IBNCPDP1",130,0)
 . I '$$ROI^IBNCPDR4(DFN,$G(IBD("DRUG")),+$P($G(IBD("INS",1,3)),U,5),$G(IBD("FILL DATE"))) D  Q
"RTN","IBNCPDP1",131,0)
 .. S IBRMARK="REFUSES TO SIGN RELEASE (ROI)"
"RTN","IBNCPDP1",132,0)
 .. D CT
"RTN","IBNCPDP1",133,0)
 .. S IBRES="0^NOT BILLABLE, NO ROI - NO ACTIVE ROI ON FILE"
"RTN","IBNCPDP1",134,0)
 . D ROICLN^IBNCPDR4(IBTRKRN,IBRXN,IBFIL) K:$G(IBRMARK)="REFUSES TO SIGN RELEASE (ROI)" IBRMARK
"RTN","IBNCPDP1",135,0)
 ;
"RTN","IBNCPDP1",136,0)
 ; determine rates/prices to use
"RTN","IBNCPDP1",137,0)
 I 'IBRT D CT S IBRES="0^Cannot determine Rate type" G RXQ
"RTN","IBNCPDP1",138,0)
 S IBBI=$$EVNTITM^IBCRU3(+IBRT,3,"PRESCRIPTION FILL",IBADT,.IBRS)
"RTN","IBNCPDP1",139,0)
 I 'IBBI,$P(IBBI,";")'="VA COST" D CT S IBRES="0^Cannot find Billable Item" G RXQ
"RTN","IBNCPDP1",140,0)
 ;1;BEDSECTION;1^
"RTN","IBNCPDP1",141,0)
 ;IBRS(1,18,5)=
"RTN","IBNCPDP1",142,0)
 S IBRS=+$O(IBRS($P(IBBI,";"),0))
"RTN","IBNCPDP1",143,0)
 S IBIT=$$ITPTR^IBCRU2($P(IBBI,";"),$S($P(IBRT,U,2)="A":$$NDC^IBNCPNB($G(IBD("NDC"))),1:"PRESCRIPTION"))
"RTN","IBNCPDP1",144,0)
 I 'IBIT,$P(IBRT,U,2)'="C" D CT S IBRES="0^Cannot find Item Pointer" G RXQ
"RTN","IBNCPDP1",145,0)
 ;8
"RTN","IBNCPDP1",146,0)
 S IBPRICE=+$$BICOST^IBCRCI(+IBRT,3,IBADT,"PRESCRIPTION FILL",+IBIT,,,$S($P(IBRT,U,2)="A":IBD("QTY"),1:1))
"RTN","IBNCPDP1",147,0)
 ;36^2991001
"RTN","IBNCPDP1",148,0)
 ;
"RTN","IBNCPDP1",149,0)
 ; get fees if any, ignore return, don't care about price, just need fees
"RTN","IBNCPDP1",150,0)
 S IBCHG=$$RATECHG^IBCRCC(+IBRS,$S($P(IBRT,U,2)'="C":1,1:IBD("QTY")*IBD("COST")),IBADT,.IBFEE)
"RTN","IBNCPDP1",151,0)
 I $P(IBRT,U,2)="C" S IBPRICE=+IBCHG
"RTN","IBNCPDP1",152,0)
 ;
"RTN","IBNCPDP1",153,0)
 I 'IBPRICE D CT S IBRES="0^Cannot find price for Item" G RXQ
"RTN","IBNCPDP1",154,0)
 ;
"RTN","IBNCPDP1",155,0)
 S IBPRICE=(+$G(IBFEE))_U_$S($P(IBRT,U,2)="A":"01",$P(IBRT,U,2)="C":"05",1:"07")_U_$S($P(IBRT,U,2)="C":IBD("QTY")*IBD("COST")+$G(IBFEE),$P(IBRT,U,2)="A":IBPRICE-$G(IBFEE)-$P($G(IBFEE),U,2),1:IBPRICE)_U_IBPRICE_U_(+$P($G(IBFEE),U,2))
"RTN","IBNCPDP1",156,0)
 S IBX=0 F  S IBX=$O(IBD("INS",IBX)) Q:IBX<1  S IBD("INS",IBX,2)=IBPRICE ;_U_$P(IBPAYER,U,6)
"RTN","IBNCPDP1",157,0)
 ;
"RTN","IBNCPDP1",158,0)
 ;Check for non-covered drugs
"RTN","IBNCPDP1",159,0)
 S IBRES=$$CHCK^IBNCDNC(.IBD) I IBRES]"" S IBRMARK=$P(IBRES,U,2) D CT G RXQ
"RTN","IBNCPDP1",160,0)
 ;
"RTN","IBNCPDP1",161,0)
 S IBRES=$S($D(IBRMARK):"0^"_IBRMARK,1:1)
"RTN","IBNCPDP1",162,0)
 I IBRES,'$G(IBD("RELEASE DATE")) S IBRMARK="PRESCRIPTION NOT RELEASED"
"RTN","IBNCPDP1",163,0)
 ;
"RTN","IBNCPDP1",164,0)
 D CT
"RTN","IBNCPDP1",165,0)
 ;
"RTN","IBNCPDP1",166,0)
RXQ S $P(IBRES,"^",3)=$S($L($P($G(IBRT),"^",3)):$P(IBRT,"^",3),1:"V")
"RTN","IBNCPDP1",167,0)
 I IBRES D START^IBNCPDP6(IBRXN_";"_IBFIL,$P(IBRES,"^",3),+IBRT)
"RTN","IBNCPDP1",168,0)
 D LOG^IBNCPDP2("BILLABLE STATUS CHECK",IBRES)
"RTN","IBNCPDP1",169,0)
 Q IBRES
"RTN","IBNCPDP1",170,0)
 ;
"RTN","IBNCPDP1",171,0)
 ;
"RTN","IBNCPDP1",172,0)
CT ; files in claims tracking
"RTN","IBNCPDP1",173,0)
 I IBTRKR D CT^IBNCPDPU(DFN,IBRXN,IBFIL,IBADT,$G(IBRMARK))
"RTN","IBNCPDP1",174,0)
 Q
"RTN","IBNCPDP1",175,0)
 ;
"RTN","IBNCPDP1",176,0)
EXEMPT ; exemption reasons
"RTN","IBNCPDP1",177,0)
 ; variable from SD call ^ variable from PSO ^ reason not billable
"RTN","IBNCPDP1",178,0)
 ;;1^AO^AGENT ORANGE
"RTN","IBNCPDP1",179,0)
 ;;2^IR^IONIZING RADIATION
"RTN","IBNCPDP1",180,0)
 ;;3^SC^SC TREATMENT
"RTN","IBNCPDP1",181,0)
 ;;4^SWA^SOUTHWEST ASIA
"RTN","IBNCPDP1",182,0)
 ;;5^MST^MILITARY SEXUAL TRAUMA
"RTN","IBNCPDP1",183,0)
 ;;6^HNC^HEAD/NECK CANCER
"RTN","IBNCPDP1",184,0)
 ;;7^CV^COMBAT VETERAN
"RTN","IBNCPDP1",185,0)
 ;;8^SHAD^PROJECT 112/SHAD
"RTN","IBNCPDP1",186,0)
 ;;
"RTN","IBNCPDP1",187,0)
 ;
"RTN","IBNCPDP2")
0^19^B58655489
"RTN","IBNCPDP2",1,0)
IBNCPDP2 ;OAK/ELZ - PROCESSING FOR ECME RESP ;11/15/07  09:43
"RTN","IBNCPDP2",2,0)
 ;;2.0;INTEGRATED BILLING;**223,276,342,347,363,383,405,384**;21-MAR-94;Build 74
"RTN","IBNCPDP2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBNCPDP2",4,0)
 ;
"RTN","IBNCPDP2",5,0)
ECME(DFN,IBD) ; function called by STORESP^IBNCPDP
"RTN","IBNCPDP2",6,0)
 ; input - DFN - patient IEN for the prescription
"RTN","IBNCPDP2",7,0)
 ;         IBD array passed in by reference
"RTN","IBNCPDP2",8,0)
 ;      The IBD array is passed to various subroutines depending
"RTN","IBNCPDP2",9,0)
 ;      on the ePharmacy event as evaluated by IBD("STATUS")
"RTN","IBNCPDP2",10,0)
 I $G(IBD("EPHARM"))="" S IBD("EPHARM")=$$EPHARM(+$G(IBD("PRESCRIPTION")),+$G(IBD("FILL NUMBER")))
"RTN","IBNCPDP2",11,0)
 I IBD("STATUS")="PAID" Q $$BILL(DFN,.IBD)
"RTN","IBNCPDP2",12,0)
 I IBD("STATUS")="REVERSED" Q $$REVERSE^IBNCPDP3(DFN,.IBD)
"RTN","IBNCPDP2",13,0)
 I IBD("STATUS")="CLOSED" Q $$CLOSE^IBNCPDP4(DFN,.IBD)
"RTN","IBNCPDP2",14,0)
 I IBD("STATUS")="RELEASED" Q $$RELEASE^IBNCPDP4(DFN,.IBD)
"RTN","IBNCPDP2",15,0)
 I IBD("STATUS")="SUBMITTED" Q $$SUBMIT^IBNCPDP4(DFN,.IBD)
"RTN","IBNCPDP2",16,0)
 I IBD("STATUS")="REOPEN" Q $$REOPEN^IBNCPDP4(DFN,.IBD)
"RTN","IBNCPDP2",17,0)
 D LOG("UNKNOWN")
"RTN","IBNCPDP2",18,0)
 Q "0^Cannot determine ECME event status"
"RTN","IBNCPDP2",19,0)
 ;
"RTN","IBNCPDP2",20,0)
MATCH(BCID) ;
"RTN","IBNCPDP2",21,0)
 N IBX,IBHAVE
"RTN","IBNCPDP2",22,0)
 S IBX=0,IBHAVE=0 F  S IBX=$O(^DGCR(399,"AG",BCID,IBX)) Q:'IBX  S IBHAVE=1 I '$P($G(^DGCR(399,IBX,"S")),U,16) Q
"RTN","IBNCPDP2",23,0)
 I 'IBX,IBHAVE Q ""
"RTN","IBNCPDP2",24,0)
 Q +IBX
"RTN","IBNCPDP2",25,0)
 ;
"RTN","IBNCPDP2",26,0)
BILL(DFN,IBD) ; create bills
"RTN","IBNCPDP2",27,0)
 N IBDIV,IBAMT,IBY,IBSERV,IBFAC,IBSITE,IBDRX,IB,IBCDFN,IBINS,IBIDS,IBIFN,IBDFN,PRCASV,IBTRIC
"RTN","IBNCPDP2",28,0)
 N PRCAERR,IBADT,IBRXN,IBFIL,IBTRKRN,DIE,DA,DR,IBRES,IBLOCK,IBLDT,IBNOW,IBDUZ,RCDUZ,IBPREV,IBQUERY,IBPAID,IBACT,%,DGRVRCAL
"RTN","IBNCPDP2",29,0)
 ;
"RTN","IBNCPDP2",30,0)
 S IBDUZ=.5 ;POSTMASTER
"RTN","IBNCPDP2",31,0)
 ;I $G(IBD("FILLED BY")),$D(^VA(200,+IBD("FILLED BY"))) S IBDUZ=+IBD("FILLED BY")
"RTN","IBNCPDP2",32,0)
 S RCDUZ=IBDUZ
"RTN","IBNCPDP2",33,0)
 ;
"RTN","IBNCPDP2",34,0)
 S IBY=1,IBLOCK=0
"RTN","IBNCPDP2",35,0)
 I 'DFN S IBY="0^Missing DFN" G BILLQ
"RTN","IBNCPDP2",36,0)
 S IBAMT=+$G(IBD("BILLED")) ;FI portion of charge
"RTN","IBNCPDP2",37,0)
 I 'IBAMT S IBY="-1^Zero amount billed" G BILLQ
"RTN","IBNCPDP2",38,0)
 S IBADT=+$G(IBD("FILL DATE"),DT)
"RTN","IBNCPDP2",39,0)
 S IBRXN=+$G(IBD("PRESCRIPTION")) I 'IBRXN S IBY="0^Missing Rx IEN" G BILLQ
"RTN","IBNCPDP2",40,0)
 S IBFIL=+$G(IBD("FILL NUMBER"),-1) I IBFIL<0 S IBY="0^No fill number" G BILLQ
"RTN","IBNCPDP2",41,0)
 S IBDIV=+$G(IBD("DIVISION"))
"RTN","IBNCPDP2",42,0)
 I '$L($G(IBD("CLAIMID"))) S IBY="-1^Missing ECME Number" G BILLQ
"RTN","IBNCPDP2",43,0)
 S IBD("BCID")=(+IBD("CLAIMID"))_";"_IBADT ; The BCID#
"RTN","IBNCPDP2",44,0)
 L +^DGCR(399,"AG",IBD("BCID")):15 E  S IBY="0^Cannot lock ECME number." G BILLQ
"RTN","IBNCPDP2",45,0)
 ;
"RTN","IBNCPDP2",46,0)
 S IBTRIC=$$TRICARE^IBNCPDP6(IBRXN_";"_IBFIL)
"RTN","IBNCPDP2",47,0)
 ; do patient copay first (only applicable if Tricare)
"RTN","IBNCPDP2",48,0)
 I $G(IBD("COPAY")),IBTRIC D BILL^IBNCPDP6(IBRXN_";"_IBFIL,IBD("COPAY"))
"RTN","IBNCPDP2",49,0)
 I IBTRIC,'$G(IBD("PAID")) S IBY="1^Nothing paid in Tricare claim." G BILLQ
"RTN","IBNCPDP2",50,0)
 ;
"RTN","IBNCPDP2",51,0)
 S IBLOCK=1
"RTN","IBNCPDP2",52,0)
 S IBLDT=$G(^DGCR(399,"AG",IBD("BCID"))) ;Last time called
"RTN","IBNCPDP2",53,0)
 D NOW^%DTC S IBNOW=%
"RTN","IBNCPDP2",54,0)
 ; 2 calls in 45 sec
"RTN","IBNCPDP2",55,0)
 I $P(IBLDT,"^",2)="B" I $$FMDIFF^XLFDT(IBNOW,+IBLDT,2)<45 S IBY="0^Duplicate billing call" G BILLQ
"RTN","IBNCPDP2",56,0)
 ;
"RTN","IBNCPDP2",57,0)
 I $$MATCH(IBD("BCID")) D   ;cancel the previous bill
"RTN","IBNCPDP2",58,0)
 . N IBARR M IBARR=IBD I $$REVERSE^IBNCPDP3(DFN,.IBARR,2)
"RTN","IBNCPDP2",59,0)
 ;
"RTN","IBNCPDP2",60,0)
 ; derive minimal variables
"RTN","IBNCPDP2",61,0)
 I '$$CHECK^IBECEAU(0) S IBY="-1^IB SITE" G BILLQ
"RTN","IBNCPDP2",62,0)
 S IBSERV=$P($G(^IBE(350.1,1,0)),"^",4)
"RTN","IBNCPDP2",63,0)
 I '$$SERV^IBARX1(IBSERV) S IBY="-1^IB SERVICE" G BILLQ
"RTN","IBNCPDP2",64,0)
 I 'IBDIV S IBDIV=$P($$MCDIV^IBNCPEB(IBRXN,IBFIL),U,2)
"RTN","IBNCPDP2",65,0)
 I 'IBDIV S IBDIV=+$P($G(^SC(+$$FILE^IBRXUTL(IBRXN,5),0)),"^",15)
"RTN","IBNCPDP2",66,0)
 I 'IBDIV S IBDIV=+$P($G(^IBE(350.9,1,1)),U,25) ;dflt
"RTN","IBNCPDP2",67,0)
 I IBDIV S IBD("DIVISION")=IBDIV
"RTN","IBNCPDP2",68,0)
 ; - establish a stub claim/receivable
"RTN","IBNCPDP2",69,0)
 D SET^IBR I IBY<0 G BILLQ
"RTN","IBNCPDP2",70,0)
 ;
"RTN","IBNCPDP2",71,0)
 ; set up the following variables for claim establishment:
"RTN","IBNCPDP2",72,0)
 ; .01 BILL #
"RTN","IBNCPDP2",73,0)
 ; .17 ORIG CLAIM
"RTN","IBNCPDP2",74,0)
 ; .2  AUTO?
"RTN","IBNCPDP2",75,0)
 ; .02 DFN
"RTN","IBNCPDP2",76,0)
 ; .06 TIMEFRAME
"RTN","IBNCPDP2",77,0)
 ; .07 RATE TYPE
"RTN","IBNCPDP2",78,0)
 ; .18 SC AT TIME?
"RTN","IBNCPDP2",79,0)
 ; .04 LOCATION
"RTN","IBNCPDP2",80,0)
 ; .22 DIVISION
"RTN","IBNCPDP2",81,0)
 ; .05 BILL CLASSIF  (3)
"RTN","IBNCPDP2",82,0)
 ; .03 EVT DATE (FILL DATE)
"RTN","IBNCPDP2",83,0)
 ; 151 BILL FROM
"RTN","IBNCPDP2",84,0)
 ; 152 BILL TO
"RTN","IBNCPDP2",85,0)
 ; 155 SENSITIVE DX
"RTN","IBNCPDP2",86,0)
 ; 157 ROI OBTAINED
"RTN","IBNCPDP2",87,0)
 ; 101 PRIMARY INS CARRIER
"RTN","IBNCPDP2",88,0)
 K IB
"RTN","IBNCPDP2",89,0)
 S (IB(.02),IBDFN)=DFN
"RTN","IBNCPDP2",90,0)
 S IB(.07)=$$RT^IBNCPDP6(IBRXN_";"_IBFIL) ; previously determined rate type
"RTN","IBNCPDP2",91,0)
 I 'IB(.07) S IB(.07)=+$$RT^IBNCPDPU(DFN) ; cannot find previously, try to recompute
"RTN","IBNCPDP2",92,0)
 I 'IB(.07) S IBY="-1^IB RATE TYPE" G BILLQ
"RTN","IBNCPDP2",93,0)
 ;
"RTN","IBNCPDP2",94,0)
 S IBIFN=PRCASV("ARREC")
"RTN","IBNCPDP2",95,0)
 S IB(.01)=$P(PRCASV("ARBIL"),"-",2)
"RTN","IBNCPDP2",96,0)
 S IB(.17)=""
"RTN","IBNCPDP2",97,0)
 S IB(.2)=0
"RTN","IBNCPDP2",98,0)
 S IB(.06)=1
"RTN","IBNCPDP2",99,0)
 S IB(.18)=$$SC^IBCU3(DFN)
"RTN","IBNCPDP2",100,0)
 S IB(.04)=$S(+$P($G(^DG(40.8,+IBDIV,0)),U,3):7,1:1)
"RTN","IBNCPDP2",101,0)
 S:IBDIV IB(.22)=+IBDIV
"RTN","IBNCPDP2",102,0)
 S IB(.05)=3
"RTN","IBNCPDP2",103,0)
 S (IB(.03),IB(151),IB(152))=IBADT
"RTN","IBNCPDP2",104,0)
 S IBINS=$P($G(^IBA(355.3,+$G(IBD("PLAN")),0)),"^") I IBINS S IB(101)=IBINS
"RTN","IBNCPDP2",105,0)
 ;
"RTN","IBNCPDP2",106,0)
 ; set 362.4 node to rx#^p50^days sup^fill date^qty^ndc
"RTN","IBNCPDP2",107,0)
 S IB(362.4,IBRXN,IBFIL)=IBD("RX NO")_"^"_IBD("DRUG")_"^"_IBD("DAYS SUPPLY")_"^"_IBD("FILL DATE")_"^"_IBD("QTY")_"^"_IBD("NDC")
"RTN","IBNCPDP2",108,0)
 ;
"RTN","IBNCPDP2",109,0)
 ; drug DEA ROI check.
"RTN","IBNCPDP2",110,0)
  N IBDEA
"RTN","IBNCPDP2",111,0)
  D ZERO^IBRXUTL(IBD("DRUG")) S IBDEA=^TMP($J,"IBDRUG",IBD("DRUG"),3)
"RTN","IBNCPDP2",112,0)
  I IBDEA["U" S IB(155)=1,IB(157)=1 ; set sensitive dx and ROI obtained
"RTN","IBNCPDP2",113,0)
  K ^TMP($J,"IBDRUG")
"RTN","IBNCPDP2",114,0)
 ;
"RTN","IBNCPDP2",115,0)
 ; call the autobiller module to create the claim with a default
"RTN","IBNCPDP2",116,0)
 ; diagnosis and procedure for prescriptions
"RTN","IBNCPDP2",117,0)
 D EN^IBCD3(.IBQUERY)
"RTN","IBNCPDP2",118,0)
 D CLOSE^IBSDU(.IBQUERY)
"RTN","IBNCPDP2",119,0)
 ;
"RTN","IBNCPDP2",120,0)
 S ^DGCR(399,"AG",IBD("BCID"))=IBNOW_"^B"
"RTN","IBNCPDP2",121,0)
 S DIE="^DGCR(399,",DA=IBIFN
"RTN","IBNCPDP2",122,0)
 ; update the ECME fields
"RTN","IBNCPDP2",123,0)
 S DR="460////^S X=IBD(""BCID"")" S:$L($G(IBD("AUTH #"))) DR=DR_";461////^S X=IBD(""AUTH #"")"
"RTN","IBNCPDP2",124,0)
 D ^DIE K DA,DR,DIE
"RTN","IBNCPDP2",125,0)
 D SETCT ; Set Claims Tracking record
"RTN","IBNCPDP2",126,0)
 ;
"RTN","IBNCPDP2",127,0)
 ; IEN to 2.3121
"RTN","IBNCPDP2",128,0)
 S IBCDFN=$$PLANN^IBNCPDPU(DFN,IBD("PLAN"),IBADT)
"RTN","IBNCPDP2",129,0)
 I 'IBCDFN S IBY="-1^Plan not found in Patient's Profile." G BILLQ
"RTN","IBNCPDP2",130,0)
 ;
"RTN","IBNCPDP2",131,0)
 ; add the payer (fiscal intermediary) to the claim
"RTN","IBNCPDP2",132,0)
 S IBINS=+IBCDFN,IBCDFN=$P(IBCDFN,"^",2)
"RTN","IBNCPDP2",133,0)
 S DIE="^DGCR(399,",DA=IBIFN,DR="112////"_IBCDFN
"RTN","IBNCPDP2",134,0)
 D ^DIE K DA,DR,DIE,DGRVRCAL
"RTN","IBNCPDP2",135,0)
 ;
"RTN","IBNCPDP2",136,0)
 ; need to make sure we have computed charges.
"RTN","IBNCPDP2",137,0)
 Q:'$$CHARGES(IBIFN,IBINS,+IB(.07),$G(IBD("PAID")),IBDIV,IBTRIC,.IBY)
"RTN","IBNCPDP2",138,0)
 ;
"RTN","IBNCPDP2",139,0)
 ; update the authorize/print fields
"RTN","IBNCPDP2",140,0)
 S DIE="^DGCR(399,",DA=IBIFN
"RTN","IBNCPDP2",141,0)
 S DR="9////1;12////"_DT D ^DIE
"RTN","IBNCPDP2",142,0)
 ;
"RTN","IBNCPDP2",143,0)
 ; pass the claim to AR
"RTN","IBNCPDP2",144,0)
 D GVAR^IBCBB,ARRAY^IBCBB1 S PRCASV("APR")=IBDUZ D ^PRCASVC6
"RTN","IBNCPDP2",145,0)
 I 'PRCASV("OKAY") S IBY="-1^Cannot establish receivable in AR." G BILLQ
"RTN","IBNCPDP2",146,0)
 D REL^PRCASVC
"RTN","IBNCPDP2",147,0)
 ;
"RTN","IBNCPDP2",148,0)
 ; update the AR status to Active
"RTN","IBNCPDP2",149,0)
 ;  D AUDITX^PRCAUDT(PRCASV("ARREC"))
"RTN","IBNCPDP2",150,0)
 S PRCASV("STATUS")=16
"RTN","IBNCPDP2",151,0)
 D STATUS^PRCASVC1
"RTN","IBNCPDP2",152,0)
 ;
"RTN","IBNCPDP2",153,0)
 ; decrease adjust bill
"RTN","IBNCPDP2",154,0)
 ; Auto decrease from service Bill#,Tran amt,person,reason,Tran date
"RTN","IBNCPDP2",155,0)
 S IBAMT=$G(^DGCR(399,IBIFN,"U1"))
"RTN","IBNCPDP2",156,0)
 S IBPAID=$G(IBD("PAID"))
"RTN","IBNCPDP2",157,0)
 I IBAMT-IBPAID>.01,'IBTRIC D
"RTN","IBNCPDP2",158,0)
 . D DEC^PRCASER1(PRCASV("ARREC"),IBAMT-IBPAID,IBDUZ,"Adjust based on ECME amount paid.",IBADT)
"RTN","IBNCPDP2",159,0)
 . I 'IBPAID S PRCASV("STATUS")=22 D STATUS^PRCASVC1 ; collected/closed
"RTN","IBNCPDP2",160,0)
 ;
"RTN","IBNCPDP2",161,0)
 D  ; set the user in 399
"RTN","IBNCPDP2",162,0)
 . N IBI,IBT F IBI=2,5,11,13,15 S IBT(399,IBIFN_",",IBI)=IBDUZ
"RTN","IBNCPDP2",163,0)
 . D FILE^DIE("","IBT")
"RTN","IBNCPDP2",164,0)
 ;
"RTN","IBNCPDP2",165,0)
BILLQ S IBRES=$S(IBY<0:"0^"_$S($L($P(IBY,"^",2)):$P(IBY,"^",2),1:$P(IBY,"^",3)),$G(IBIFN):+IBIFN,1:IBY)
"RTN","IBNCPDP2",166,0)
 I $G(IBIFN) S IBD("BILL")=IBIFN
"RTN","IBNCPDP2",167,0)
 D LOG("BILL",IBRES)
"RTN","IBNCPDP2",168,0)
 I IBY<0 D BULL^IBNCPEB($G(DFN),.IBD,IBRES,$G(IBIFN))
"RTN","IBNCPDP2",169,0)
 I IBLOCK L -^DGCR(399,"AG",IBD("BCID"))
"RTN","IBNCPDP2",170,0)
 Q IBRES
"RTN","IBNCPDP2",171,0)
 ;
"RTN","IBNCPDP2",172,0)
SETCT ; update claims tracking saying bill has been billed
"RTN","IBNCPDP2",173,0)
 S IBTRKRN=+$O(^IBT(356,"ARXFL",IBRXN,IBFIL,0))
"RTN","IBNCPDP2",174,0)
 I IBTRKRN S DIE="^IBT(356,",DA=IBTRKRN,DR=".11////^S X=IBIFN;.17///@" D ^DIE
"RTN","IBNCPDP2",175,0)
 I IBTRKRN,(+$G(IBD("FILL DATE"))'=$P(^IBT(356,IBTRKRN,0),U,6)) S DIE="^IBT(356,",DA=IBTRKRN,DR=".06////"_IBD("FILL DATE") D ^DIE ; Check Fill Date
"RTN","IBNCPDP2",176,0)
 I IBTRKRN,IBIFN D CTB^IBCDC(IBTRKRN,IBIFN)
"RTN","IBNCPDP2",177,0)
 Q
"RTN","IBNCPDP2",178,0)
 ;
"RTN","IBNCPDP2",179,0)
LOG(PROC,RESULT) ;Store the data
"RTN","IBNCPDP2",180,0)
 ;Log values passed into IB by outside applications
"RTN","IBNCPDP2",181,0)
 ;
"RTN","IBNCPDP2",182,0)
 ;implicit input variables/arrays :
"RTN","IBNCPDP2",183,0)
 ; IBD array with values sent to IB (see calling subroutines)
"RTN","IBNCPDP2",184,0)
 ; DFN - patient's IEN (file #2)
"RTN","IBNCPDP2",185,0)
 ; DUZ - user's IEN(file #200)
"RTN","IBNCPDP2",186,0)
 ;explicit parameters:
"RTN","IBNCPDP2",187,0)
 ; PROC - type of event as string, i.e. BILL, REJECT and so on
"RTN","IBNCPDP2",188,0)
 ; RESULT - result of the event processing, format: return_code^message
"RTN","IBNCPDP2",189,0)
 ;
"RTN","IBNCPDP2",190,0)
 D LOG^IBNCPLOG(.IBD,DFN,PROC,RESULT,$J,$$NOW^XLFDT(),+DUZ)
"RTN","IBNCPDP2",191,0)
 Q
"RTN","IBNCPDP2",192,0)
 ;
"RTN","IBNCPDP2",193,0)
EPHARM(IBRX,IBREFILL) ;
"RTN","IBNCPDP2",194,0)
 ;returns ien of #9002313.56 BPS PHARMACIES associated
"RTN","IBNCPDP2",195,0)
 ;with the prescription specified by:
"RTN","IBNCPDP2",196,0)
 ; IBRX - IEN in file #52
"RTN","IBNCPDP2",197,0)
 ; IBREFILL - zero(0) for the original prescription or the refill
"RTN","IBNCPDP2",198,0)
 ;    number for a refill (IEN of REFILL multiple #52.1)
"RTN","IBNCPDP2",199,0)
 I +$G(IBRX)=0 Q ""
"RTN","IBNCPDP2",200,0)
 I $G(IBREFILL)="" Q ""
"RTN","IBNCPDP2",201,0)
 N IBDIV59
"RTN","IBNCPDP2",202,0)
 S IBDIV59=+$$RXSITE^PSOBPSUT(+IBRX,+IBREFILL)
"RTN","IBNCPDP2",203,0)
 I IBDIV59>0 Q $$GETPHARM^BPSUTIL(IBDIV59)
"RTN","IBNCPDP2",204,0)
 Q ""
"RTN","IBNCPDP2",205,0)
 ;
"RTN","IBNCPDP2",206,0)
CHARGES(IBIFN,IBINS,IBRT,IBAMT,IBDIV,IBTRIC,IBY) ;
"RTN","IBNCPDP2",207,0)
 ; will add charges onto bill based on rate type
"RTN","IBNCPDP2",208,0)
 ;
"RTN","IBNCPDP2",209,0)
 ; Input:  IBIFN = Bill (399) ien
"RTN","IBNCPDP2",210,0)
 ;         IBINS = Insurance Co (36) ien
"RTN","IBNCPDP2",211,0)
 ;         IBRT = Rate Type (399.3) ien
"RTN","IBNCPDP2",212,0)
 ; Output: 1 = Ok all done
"RTN","IBNCPDP2",213,0)
 ;         0 = not ok, bill doesn't have charges
"RTN","IBNCPDP2",214,0)
 ;
"RTN","IBNCPDP2",215,0)
 N IBCSZ,IBRVCD,IBBS,IBUNITS,IBCPT,IBAA,IBTYPE,IBITEM,X
"RTN","IBNCPDP2",216,0)
 ;
"RTN","IBNCPDP2",217,0)
 I 'IBTRIC D BILL^IBCRBC(IBIFN) Q 1
"RTN","IBNCPDP2",218,0)
 ;
"RTN","IBNCPDP2",219,0)
 ; - manually add charge to the claim (based on cost for Tricare)
"RTN","IBNCPDP2",220,0)
 S IBRVCD=$P($G(^DIC(36,IBINS,0)),"^",15) ;                   rx refill rev code
"RTN","IBNCPDP2",221,0)
 S IBCSZ=$G(^IBE(363.1,+$O(^IBE(363.1,"B","RX COST",0)),0)) ; using cost CS
"RTN","IBNCPDP2",222,0)
 I IBRVCD="" S IBRVCD=$P(IBCSZ,U,5) ;                         CS def rev code
"RTN","IBNCPDP2",223,0)
 I IBRVCD="" S X=250 ;                                        gen'l rx rev code
"RTN","IBNCPDP2",224,0)
 ;
"RTN","IBNCPDP2",225,0)
 S IBBS=$P(IBCSZ,U,6) ;                                       CS def bedsection
"RTN","IBNCPDP2",226,0)
 S IBUNITS=1 ;                                                one unit
"RTN","IBNCPDP2",227,0)
 S IBCPT=$P($G(^IBE(350.9,1,1)),"^",30) ;                     def rx refill cpt
"RTN","IBNCPDP2",228,0)
 S IBAA=0 ;                                                   not auto calc charges
"RTN","IBNCPDP2",229,0)
 S IBTYPE=3 ;                                                 rx type
"RTN","IBNCPDP2",230,0)
 S IBITEM="" ;                                                charge item link
"RTN","IBNCPDP2",231,0)
 ;
"RTN","IBNCPDP2",232,0)
 S X=$$ADDRC^IBCRBF(IBIFN,IBRVCD,IBBS,IBAMT,IBUNITS,IBCPT,IBDIV,IBAA,IBTYPE,IBITEM)
"RTN","IBNCPDP2",233,0)
 I X<0 S IBY="-1^^Unable to add Revenue Code charge to claim." Q 0
"RTN","IBNCPDP2",234,0)
 Q 1
"RTN","IBNCPDP2",235,0)
 ;
"RTN","IBNCPDP3")
0^43^B30631647
"RTN","IBNCPDP3",1,0)
IBNCPDP3 ;OAK/ELZ - STORES NDC/AWP UPDATES ;11/14/07  13:18
"RTN","IBNCPDP3",2,0)
 ;;2.0;INTEGRATED BILLING;**223,276,342,363,383,384**;21-MAR-94;Build 74
"RTN","IBNCPDP3",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBNCPDP3",4,0)
 ;
"RTN","IBNCPDP3",5,0)
 ;
"RTN","IBNCPDP3",6,0)
UPAWP(IBNDC,IBAWP,IBADT) ; updates AWP prices for NDCs
"RTN","IBNCPDP3",7,0)
 ;
"RTN","IBNCPDP3",8,0)
 N IBITEM,IBCS
"RTN","IBNCPDP3",9,0)
 ;
"RTN","IBNCPDP3",10,0)
 ;
"RTN","IBNCPDP3",11,0)
 S IBCS=$P($G(^IBE(350.9,1,9)),"^",12)
"RTN","IBNCPDP3",12,0)
 I 'IBCS Q "0^Unable to find Charge Set"
"RTN","IBNCPDP3",13,0)
 ;
"RTN","IBNCPDP3",14,0)
 S IBNDC=$$NDC^IBNCPNB(IBNDC)
"RTN","IBNCPDP3",15,0)
 ;
"RTN","IBNCPDP3",16,0)
 S IBITEM=+$$ADDBI^IBCREF("NDC",IBNDC) I IBITEM Q "0^Unable to add item"
"RTN","IBNCPDP3",17,0)
 ;
"RTN","IBNCPDP3",18,0)
 I '$$ADDCI^IBCREF(IBCS,IBITEM,IBADT,IBAWP) Q "0^Unable to add charge"
"RTN","IBNCPDP3",19,0)
 ;
"RTN","IBNCPDP3",20,0)
 Q 1
"RTN","IBNCPDP3",21,0)
 ;
"RTN","IBNCPDP3",22,0)
 ;
"RTN","IBNCPDP3",23,0)
 ;
"RTN","IBNCPDP3",24,0)
 ;
"RTN","IBNCPDP3",25,0)
REVERSE(DFN,IBD,IBAUTO) ;process reversed claims
"RTN","IBNCPDP3",26,0)
 N IBIFN,I,IB,IBIL,IBCHG,IBCRES,IBY,X,Y,DA,DIE,DR,IBADT,IBLOCK,IBLDT
"RTN","IBNCPDP3",27,0)
 N IBNOW,IBDUZ,IBCR,IBRELC,IBCC,IBPAP,IBRXN,IBFIL,IBRTS,IBARES,IBUSR
"RTN","IBNCPDP3",28,0)
 S IBDUZ=.5
"RTN","IBNCPDP3",29,0)
 S IBLOCK=0
"RTN","IBNCPDP3",30,0)
 ; find bill number
"RTN","IBNCPDP3",31,0)
 I 'DFN S IBY="0^No patient" G REVQ
"RTN","IBNCPDP3",32,0)
 I '$L($G(IBD("CLAIMID"))) S IBY="0^Missing ECME Number" G REVQ
"RTN","IBNCPDP3",33,0)
 S IBADT=+$G(IBD("FILL DATE")) I 'IBADT S IBY="0^Missing Fill Date" G REVQ
"RTN","IBNCPDP3",34,0)
 S IBRXN=+$G(IBD("PRESCRIPTION")) I 'IBRXN S IBY="0^No Rx IEN" G REVQ
"RTN","IBNCPDP3",35,0)
 S IBFIL=+$G(IBD("FILL NUMBER"),-1) I IBFIL<0 S IBY="0^No fill number" G REVQ
"RTN","IBNCPDP3",36,0)
 I $E($G(IBD("RESPONSE")),1)="R" D  G REVQ:+'$G(IBRTS)
"RTN","IBNCPDP3",37,0)
 . S IBY="0^REVERSAL rejected by payer"
"RTN","IBNCPDP3",38,0)
 . S IBRTS=$$RTS(IBD("REVERSAL REASON"))
"RTN","IBNCPDP3",39,0)
 ;
"RTN","IBNCPDP3",40,0)
 D CANC^IBNCPDP6(IBRXN_";"_IBFIL) ; cancel 1st party charge for Tricare
"RTN","IBNCPDP3",41,0)
 ;
"RTN","IBNCPDP3",42,0)
 S IBD("BCID")=(+IBD("CLAIMID"))_";"_IBADT ; BC ID Number
"RTN","IBNCPDP3",43,0)
 L +^DGCR(399,"AG",IBD("BCID")):15 E  S IBY="0^Cannot lock ECME number" G REVQ
"RTN","IBNCPDP3",44,0)
 S IBLOCK=1
"RTN","IBNCPDP3",45,0)
 S IBUSR=$S(+$G(IBD("USER"))=0:DUZ,1:IBD("USER"))
"RTN","IBNCPDP3",46,0)
 I $D(^DGCR(399,"AG",IBD("BCID"))) S ^(IBD("BCID"))=""
"RTN","IBNCPDP3",47,0)
 S IBIFN=$$MATCH^IBNCPDP2(IBD("BCID"))
"RTN","IBNCPDP3",48,0)
 I $D(IBD("CLOSE REASON")),'$D(IBD("DROP TO PAPER")) S IBD("DROP TO PAPER")=""
"RTN","IBNCPDP3",49,0)
 S IBCR=+$G(IBD("CLOSE REASON"))
"RTN","IBNCPDP3",50,0)
 S IBPAP=$G(IBD("DROP TO PAPER"))
"RTN","IBNCPDP3",51,0)
 S IBRELC=$G(IBD("RELEASE COPAY"))
"RTN","IBNCPDP3",52,0)
 S IBCC=$G(IBD("CLOSE COMMENT"))
"RTN","IBNCPDP3",53,0)
 D NONBR^IBNCPNB(DFN,IBRXN,IBFIL,IBADT,IBCR,IBPAP,IBRELC,IBCC,IBUSR)
"RTN","IBNCPDP3",54,0)
 I 'IBIFN S IBY="0^"_$S(IBPAP:"Dropped to paper",IBCR>1:"Set non-billable reason in CT",1:"Cannot find the bill to reverse") G REVQ
"RTN","IBNCPDP3",55,0)
 ;
"RTN","IBNCPDP3",56,0)
 F I=0,"S" S IB(I)=$G(^DGCR(399,IBIFN,I))
"RTN","IBNCPDP3",57,0)
 I IB(0)="" S IBY="0^No data in bill" G REVQ
"RTN","IBNCPDP3",58,0)
 I +$P(IB("S"),U,16),$P(IB("S"),U,17)]"" S IBY="0^Bill already cancelled" G REVQ
"RTN","IBNCPDP3",59,0)
 ;
"RTN","IBNCPDP3",60,0)
 S:'$D(IBCRES) IBCRES="ECME PRESCRIPTION REVERSED"
"RTN","IBNCPDP3",61,0)
 S DA=IBIFN,DR="16////1;19////"_IBCRES,DIE="^DGCR(399,"
"RTN","IBNCPDP3",62,0)
 D ^DIE K DA,DIE,DR
"RTN","IBNCPDP3",63,0)
 ;
"RTN","IBNCPDP3",64,0)
 ; - decrease out the receivable in AR
"RTN","IBNCPDP3",65,0)
 S IB("U1")=$G(^DGCR(399,IBIFN,"U1"))
"RTN","IBNCPDP3",66,0)
 S IBIL=$P($G(^PRCA(430,IBIFN,0)),"^")
"RTN","IBNCPDP3",67,0)
 S IBCHG=$S(IB("U1")']"":0,$P(IB("U1"),"^",1)]"":$P(IB("U1"),"^",1),1:0)
"RTN","IBNCPDP3",68,0)
 ;
"RTN","IBNCPDP3",69,0)
 S X="21^"_IBCHG_"^"_IBIL_"^"_IBDUZ_"^"_DT_"^"_IBCRES
"RTN","IBNCPDP3",70,0)
 D ^PRCASER1
"RTN","IBNCPDP3",71,0)
 S IBARES=Y
"RTN","IBNCPDP3",72,0)
 I IBARES<0 S IBY=IBARES D BULL
"RTN","IBNCPDP3",73,0)
 ;
"RTN","IBNCPDP3",74,0)
 S IBY=$S(IBARES<0:"0^"_$P(IBARES,"^",2),1:1)
"RTN","IBNCPDP3",75,0)
 ;
"RTN","IBNCPDP3",76,0)
 I IBDUZ'=DUZ D  ; set the real user
"RTN","IBNCPDP3",77,0)
 . N IBI,IBT S IBI=18,IBT(399,IBIFN_",",IBI)=IBDUZ D FILE^DIE("","IBT")
"RTN","IBNCPDP3",78,0)
 ;
"RTN","IBNCPDP3",79,0)
REVQ ; perform end of job tasks
"RTN","IBNCPDP3",80,0)
 D LOG^IBNCPDP2($S($G(IBAUTO)=1:"AUTO REVERSE",$G(IBAUTO)=2:"BILL CANCELLED",1:"REVERSE"),IBY)
"RTN","IBNCPDP3",81,0)
 I IBLOCK L -^DGCR(399,"AG",IBD("BCID"))
"RTN","IBNCPDP3",82,0)
 I IBY=1,$G(IBIFN) S IBY=+IBIFN
"RTN","IBNCPDP3",83,0)
 Q IBY
"RTN","IBNCPDP3",84,0)
 ;
"RTN","IBNCPDP3",85,0)
RTS(IBRR) ; Return to Stock processing on Released Rx
"RTN","IBNCPDP3",86,0)
 ; input - IBRR = reversal reason
"RTN","IBNCPDP3",87,0)
 ;         IBCRSN = passed in by reference
"RTN","IBNCPDP3",88,0)
 ; output - 0 = reversal not due to a Rx RETURN TO STOCK or Rx DELETE
"RTN","IBNCPDP3",89,0)
 ;          1 = reversal due to a Rx RETURN TO STOCK or Rx DELETE
"RTN","IBNCPDP3",90,0)
 ;          IBCRSN = charge removal reason
"RTN","IBNCPDP3",91,0)
 N IBTRKRN,IBLOCK2,IBCMT,DA,DIE,DR
"RTN","IBNCPDP3",92,0)
 ;
"RTN","IBNCPDP3",93,0)
 I IBRR'="RX RETURNED TO STOCK"&(IBRR'="RX DELETED") Q 0
"RTN","IBNCPDP3",94,0)
 S IBTRKRN=+$O(^IBT(356,"ARXFL",IBRXN,IBFIL,0))
"RTN","IBNCPDP3",95,0)
 I 'IBTRKRN Q 0  ; CT record does not exist
"RTN","IBNCPDP3",96,0)
 I '$P($G(^IBT(356,IBTRKRN,0)),U,11) Q 0  ; BILL does not exist
"RTN","IBNCPDP3",97,0)
 S IBCRES=$$GETRSN(DFN,IBRXN,IBFIL)  ; recorded in file 399 entry
"RTN","IBNCPDP3",98,0)
 L +^IBT(356,IBTRKRN):5 S IBLOCK2=$T
"RTN","IBNCPDP3",99,0)
 S DIE="^IBT(356,",DA=IBTRKRN,IBCMT="Rx RTS - May Need Refund"
"RTN","IBNCPDP3",100,0)
 S DR="1.08////"_IBCMT
"RTN","IBNCPDP3",101,0)
 D ^DIE
"RTN","IBNCPDP3",102,0)
 I IBLOCK2 L -^IBT(356,IBTRKRN)
"RTN","IBNCPDP3",103,0)
 Q 1
"RTN","IBNCPDP3",104,0)
 ;
"RTN","IBNCPDP3",105,0)
BULL ; Generate a bulletin if there is an error in cancelling the claim.
"RTN","IBNCPDP3",106,0)
 N IBC,IBT,IBPT,IBGRP,XMDUZ,XMTEXT,XMSUB,XMY
"RTN","IBNCPDP3",107,0)
 ;
"RTN","IBNCPDP3",108,0)
 S IBPT=$$PT^IBEFUNC(DFN)
"RTN","IBNCPDP3",109,0)
 S XMSUB=$E($P(IBPT,"^"),1,14)_"  "_$P(IBPT,"^",3)_" - ERROR ENCOUNTERED"
"RTN","IBNCPDP3",110,0)
 S XMDUZ="INTEGRATED BILLING PACKAGE",XMTEXT="IBT("
"RTN","IBNCPDP3",111,0)
 S XMY(IBDUZ)=""
"RTN","IBNCPDP3",112,0)
 S XMY("G.IBCNR EPHARM")=""
"RTN","IBNCPDP3",113,0)
 ;
"RTN","IBNCPDP3",114,0)
 S IBT(1)="An error occurred while cancelling the Pharmacy claim from ECME"
"RTN","IBNCPDP3",115,0)
 S IBT(2)="fiscal intermediary for the following patient:"
"RTN","IBNCPDP3",116,0)
 S IBT(3)=" " S IBC=3
"RTN","IBNCPDP3",117,0)
 D PAT^IBAERR1 ; Accepts IBDUZ
"RTN","IBNCPDP3",118,0)
 S IBC=IBC+1,IBT(IBC)="   Bill #: "_IBIL
"RTN","IBNCPDP3",119,0)
 S IBC=IBC+1,IBT(IBC)=" "
"RTN","IBNCPDP3",120,0)
 S IBC=IBC+1,IBT(IBC)="The following error was encountered:"
"RTN","IBNCPDP3",121,0)
 S IBC=IBC+1,IBT(IBC)=" "
"RTN","IBNCPDP3",122,0)
 D ERR^IBAERR1
"RTN","IBNCPDP3",123,0)
 S IBC=IBC+1,IBT(IBC)=" "
"RTN","IBNCPDP3",124,0)
 S IBC=IBC+1,IBT(IBC)="Please review the circumstances surrounding this error and decrease"
"RTN","IBNCPDP3",125,0)
 S IBC=IBC+1,IBT(IBC)="out this receivable in Accounts Receivable if necessary."
"RTN","IBNCPDP3",126,0)
 D ^XMD
"RTN","IBNCPDP3",127,0)
 Q
"RTN","IBNCPDP3",128,0)
 ;
"RTN","IBNCPDP3",129,0)
GETRSN(DFN,IBRXN,IBFIL) ;
"RTN","IBNCPDP3",130,0)
 ; retrieve charge removal reason from file 354.71
"RTN","IBNCPDP3",131,0)
 ; input - DFN,IBRXN=Rx ien,IBFIL=fill number
"RTN","IBNCPDP3",132,0)
 ; output - charge removal reason
"RTN","IBNCPDP3",133,0)
 N IBDT,IBDA,IBXRSN,IBRXFIL,IB0
"RTN","IBNCPDP3",134,0)
 S (IBDT,IBDA)=0,IBXRSN=""
"RTN","IBNCPDP3",135,0)
 S IBRXFIL=$S('IBFIL:IBRXN,1:IBRXN_";"_IBFIL)
"RTN","IBNCPDP3",136,0)
 F  S IBDT=$O(^IBAM(354.71,"AD",DFN,IBDT)) Q:'IBDT  Q:IBXRSN]""  D
"RTN","IBNCPDP3",137,0)
 . F  S IBDA=$O(^IBAM(354.71,"AD",DFN,IBDT,IBDA)) Q:'IBDA  Q:IBXRSN]""  D
"RTN","IBNCPDP3",138,0)
 . . S IB0=^IBAM(354.71,IBDA,0)
"RTN","IBNCPDP3",139,0)
 . . Q:$P(IB0,"^",6)'[IBRXFIL
"RTN","IBNCPDP3",140,0)
 . . S IBXRSN=$$GET1^DIQ(354.71,IBDA_",",.19)
"RTN","IBNCPDP3",141,0)
 S:IBXRSN']"" IBXRSN="CHARGE REMOVAL REASON NOT FOUND"
"RTN","IBNCPDP3",142,0)
 Q "Reversal Rej, no pymt due<>"_IBXRSN
"RTN","IBNCPDP3",143,0)
 ;
"RTN","IBNCPDP3",144,0)
 ;IBNCPDP3
"RTN","IBNCPDP4")
0^39^B49164947
"RTN","IBNCPDP4",1,0)
IBNCPDP4 ;DALOI/AAT - HANDLE ECME EVENTS ;20-JUN-2003
"RTN","IBNCPDP4",2,0)
 ;;2.0;INTEGRATED BILLING;**276,342,405,384**;21-MAR-94;Build 74
"RTN","IBNCPDP4",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBNCPDP4",4,0)
 ;
"RTN","IBNCPDP4",5,0)
 ;NCPDP PHASE III
"RTN","IBNCPDP4",6,0)
 Q
"RTN","IBNCPDP4",7,0)
 ;
"RTN","IBNCPDP4",8,0)
CLOSE(DFN,IBD) ; Close Claim Event
"RTN","IBNCPDP4",9,0)
 N IBADT,IBTRKR,IBTRKRN,IBRXN,IBFIL,IBEABD,IBRES,IBLOCK,IBDUZ
"RTN","IBNCPDP4",10,0)
 N IBRXTYP,IBCR,DA,DIE,DR,IBUSR
"RTN","IBNCPDP4",11,0)
 S IBDUZ=.5
"RTN","IBNCPDP4",12,0)
 S IBRES=1,IBLOCK=0
"RTN","IBNCPDP4",13,0)
 ;
"RTN","IBNCPDP4",14,0)
 I 'DFN S IBRES="0^No patient" G CLOSEQ
"RTN","IBNCPDP4",15,0)
 S IBADT=+$G(IBD("FILL DATE")) I 'IBADT S IBRES="0^No fill date" G CLOSEQ
"RTN","IBNCPDP4",16,0)
 S IBRXN=+$G(IBD("PRESCRIPTION")) I 'IBRXN S IBRES="0^No Rx IEN" G CLOSEQ
"RTN","IBNCPDP4",17,0)
 S IBFIL=+$G(IBD("FILL NUMBER"),-1) I IBFIL<0 S IBRES="0^No fill number" G CLOSEQ
"RTN","IBNCPDP4",18,0)
 S IBCR=+$G(IBD("CLOSE REASON")) I 'IBCR S IBRES="0^No close reason" G CLOSEQ
"RTN","IBNCPDP4",19,0)
 I '$L($G(IBD("CLAIMID"))) S IBRES="0^Missing ECME Number" G CLOSEQ
"RTN","IBNCPDP4",20,0)
 S IBD("BCID")=IBD("CLAIMID")_";"_IBADT
"RTN","IBNCPDP4",21,0)
 S IBUSR=$S(+$G(IBD("USER"))=0:DUZ,1:IBD("USER"))
"RTN","IBNCPDP4",22,0)
 L +^DGCR(399,"AG",IBD("BCID")):5 S IBLOCK=$T
"RTN","IBNCPDP4",23,0)
 ;
"RTN","IBNCPDP4",24,0)
 ; -- claims tracking info
"RTN","IBNCPDP4",25,0)
 S IBTRKR=$G(^IBE(350.9,1,6))
"RTN","IBNCPDP4",26,0)
 ; date can't be before parameters
"RTN","IBNCPDP4",27,0)
 S $P(IBTRKR,"^")=$S('$P(IBTRKR,"^",4):0,+IBTRKR&(IBADT<+IBTRKR):0,1:IBADT)
"RTN","IBNCPDP4",28,0)
 S IBTRKRN=+$O(^IBT(356,"ARXFL",IBRXN,IBFIL,0))
"RTN","IBNCPDP4",29,0)
 ;
"RTN","IBNCPDP4",30,0)
 I 'IBTRKRN S IBRES="0^CT record not found" G CLOSEQ
"RTN","IBNCPDP4",31,0)
 ;
"RTN","IBNCPDP4",32,0)
 D NONBR^IBNCPNB(DFN,IBRXN,IBFIL,IBADT,IBCR,$G(IBD("DROP TO PAPER")),$G(IBD("RELEASE COPAY")),$G(IBD("CLOSE COMMENT")),IBUSR)
"RTN","IBNCPDP4",33,0)
 ;
"RTN","IBNCPDP4",34,0)
 S DIE="^IBT(356,",DA=IBTRKRN
"RTN","IBNCPDP4",35,0)
 ; add ECME #,ECME flag, remove total charges
"RTN","IBNCPDP4",36,0)
 S DR="1.1///"_IBD("CLAIMID")_";1.11///2;.29////@"
"RTN","IBNCPDP4",37,0)
 D ^DIE
"RTN","IBNCPDP4",38,0)
 ;
"RTN","IBNCPDP4",39,0)
 S IBRES=1 ; OK
"RTN","IBNCPDP4",40,0)
CLOSEQ ;
"RTN","IBNCPDP4",41,0)
 D LOG^IBNCPDP2("CLOSE",IBRES)
"RTN","IBNCPDP4",42,0)
 I IBLOCK L -^DGCR(399,"AG",IBD("BCID"))
"RTN","IBNCPDP4",43,0)
 Q IBRES
"RTN","IBNCPDP4",44,0)
 ;
"RTN","IBNCPDP4",45,0)
 ;
"RTN","IBNCPDP4",46,0)
RELEASE(DFN,IBD) ;
"RTN","IBNCPDP4",47,0)
 N IBRES,IBADT,IBRXN,IBFIL,IBRDT,IBLOCK,IBLOCK2,IBTRKR,IBTRKRN
"RTN","IBNCPDP4",48,0)
 N IBEABD,IBNBR,DA,DIE,DR,IBUSR
"RTN","IBNCPDP4",49,0)
 S IBLOCK=0
"RTN","IBNCPDP4",50,0)
 I 'DFN S IBRES="0^No patient" G RELQ
"RTN","IBNCPDP4",51,0)
 S IBADT=+$G(IBD("FILL DATE")) I 'IBADT S IBRES="0^No fill date" G RELQ
"RTN","IBNCPDP4",52,0)
 S IBRXN=+$G(IBD("PRESCRIPTION")) I 'IBRXN S IBRES="0^No Rx IEN" G RELQ
"RTN","IBNCPDP4",53,0)
 S IBFIL=+$G(IBD("FILL NUMBER"),-1) I IBFIL<0 S IBRES="0^No fill number" G RELQ
"RTN","IBNCPDP4",54,0)
 S IBRDT=+$G(IBD("RELEASE DATE"),-1) I 'IBRDT S IBRES="0^No release date" G RELQ
"RTN","IBNCPDP4",55,0)
 I '$L($G(IBD("CLAIMID"))) S IBRES="0^Missing ECME Number" G RELQ
"RTN","IBNCPDP4",56,0)
 S IBD("BCID")=IBD("CLAIMID")_";"_IBADT
"RTN","IBNCPDP4",57,0)
 S IBUSR=$S(+$G(IBD("USER"))=0:DUZ,1:IBD("USER"))
"RTN","IBNCPDP4",58,0)
 L +^DGCR(399,"AG",IBD("BCID")):5 S IBLOCK=$T
"RTN","IBNCPDP4",59,0)
 ; -- claims tracking info
"RTN","IBNCPDP4",60,0)
 S IBTRKR=$G(^IBE(350.9,1,6))
"RTN","IBNCPDP4",61,0)
 ; date can't be before parameters
"RTN","IBNCPDP4",62,0)
 S $P(IBTRKR,"^")=$S('$P(IBTRKR,"^",4):0,+IBTRKR&(IBADT<+IBTRKR):0,1:IBADT)
"RTN","IBNCPDP4",63,0)
 S IBTRKRN=+$O(^IBT(356,"ARXFL",IBRXN,IBFIL,0))
"RTN","IBNCPDP4",64,0)
 I 'IBTRKRN S IBRES="0^No CT record found." G RELQ
"RTN","IBNCPDP4",65,0)
 ;
"RTN","IBNCPDP4",66,0)
 ; Remove NBR from CT and set T+60 (if not billed yet)
"RTN","IBNCPDP4",67,0)
 ; Set ECME flags in CT
"RTN","IBNCPDP4",68,0)
 ;
"RTN","IBNCPDP4",69,0)
 L +^IBT(356,IBTRKRN):5 S IBLOCK2=$T
"RTN","IBNCPDP4",70,0)
 S DIE="^IBT(356,",DA=IBTRKRN,DR=""
"RTN","IBNCPDP4",71,0)
 S IBNBR=+$P($G(^IBT(356,IBTRKRN,0)),U,19)
"RTN","IBNCPDP4",72,0)
 ; Clean up "Rx not released"
"RTN","IBNCPDP4",73,0)
 I IBNBR,$P($G(^IBE(356.8,IBNBR,0)),U)="PRESCRIPTION NOT RELEASED" S DR=DR_".19////@;",IBNBR=""
"RTN","IBNCPDP4",74,0)
 ;
"RTN","IBNCPDP4",75,0)
 ; Set EABD if no bill and no NBR
"RTN","IBNCPDP4",76,0)
 I '$P($G(^IBT(356,IBTRKRN,0)),U,11),'IBNBR D
"RTN","IBNCPDP4",77,0)
 . S IBEABD=$$EABD^IBTUTL($O(^IBE(356.6,"AC",4,0)),IBADT)
"RTN","IBNCPDP4",78,0)
 . S:'IBEABD IBEABD=DT
"RTN","IBNCPDP4",79,0)
 . S IBEABD=$$FMADD^XLFDT(IBEABD,60)
"RTN","IBNCPDP4",80,0)
 . S DR=DR_".17////^S X=IBEABD;"
"RTN","IBNCPDP4",81,0)
 ;
"RTN","IBNCPDP4",82,0)
 ; Set ECME Flags
"RTN","IBNCPDP4",83,0)
 S DR=DR_"1.1////"_IBD("CLAIMID")_";"
"RTN","IBNCPDP4",84,0)
 ; Reject status will not be set here
"RTN","IBNCPDP4",85,0)
 ;
"RTN","IBNCPDP4",86,0)
 ; Check that the Fill Date is current
"RTN","IBNCPDP4",87,0)
 I IBADT'=$P(^IBT(356,IBTRKRN,0),U,6) S DR=DR_".06////"_IBADT_";"
"RTN","IBNCPDP4",88,0)
 ;
"RTN","IBNCPDP4",89,0)
 D ^DIE
"RTN","IBNCPDP4",90,0)
 S IBFDA(356,IBTRKRN_",",1.03)=DT  ; date last edited
"RTN","IBNCPDP4",91,0)
 S IBFDA(356,IBTRKRN_",",1.04)=IBUSR   ; last edited by
"RTN","IBNCPDP4",92,0)
 D FILE^DIE("","IBFDA"),MSG^DIALOG()
"RTN","IBNCPDP4",93,0)
 I IBLOCK2 L -^IBT(356,IBTRKRN)
"RTN","IBNCPDP4",94,0)
 ; 
"RTN","IBNCPDP4",95,0)
 S IBRES=1
"RTN","IBNCPDP4",96,0)
RELQ ;
"RTN","IBNCPDP4",97,0)
 D LOG^IBNCPDP2("RELEASE",IBRES)
"RTN","IBNCPDP4",98,0)
 I IBLOCK L -^DGCR(399,"AG",IBD("BCID"))
"RTN","IBNCPDP4",99,0)
 Q IBRES
"RTN","IBNCPDP4",100,0)
 ;
"RTN","IBNCPDP4",101,0)
SUBMIT(DFN,IBD) ;
"RTN","IBNCPDP4",102,0)
 N IBRES,IBLOCK,IBADT,IBRXN,IBFIL,IBRDT,IBNBR,IBFLAG,IBTRKR,IBTRKRN
"RTN","IBNCPDP4",103,0)
 N IBRESP,DA,DIE,DR,IBUSR
"RTN","IBNCPDP4",104,0)
 S IBLOCK=0
"RTN","IBNCPDP4",105,0)
 I 'DFN S IBRES="0^No patient" G SUBQ
"RTN","IBNCPDP4",106,0)
 S IBADT=+$G(IBD("FILL DATE")) I 'IBADT S IBRES="0^No fill date" G SUBQ
"RTN","IBNCPDP4",107,0)
 S IBRXN=+$G(IBD("PRESCRIPTION")) I 'IBRXN S IBRES="0^No Rx IEN" G SUBQ
"RTN","IBNCPDP4",108,0)
 S IBFIL=+$G(IBD("FILL NUMBER"),-1) I IBFIL<0 S IBRES="0^No fill number" G SUBQ
"RTN","IBNCPDP4",109,0)
 S IBRESP=$G(IBD("RESPONSE")) I IBRESP="" S IBRES="0^No response from the payer" G SUBQ
"RTN","IBNCPDP4",110,0)
 S IBRDT=+$G(IBD("RELEASE DATE"),-1)
"RTN","IBNCPDP4",111,0)
 I '$L($G(IBD("CLAIMID"))) S IBRES="0^Missing ECME Number" G SUBQ
"RTN","IBNCPDP4",112,0)
 S IBD("BCID")=IBD("CLAIMID")_";"_IBADT
"RTN","IBNCPDP4",113,0)
 S IBUSR=$S(+$G(IBD("USER"))=0:DUZ,1:IBD("USER"))
"RTN","IBNCPDP4",114,0)
 L +^DGCR(399,"AG",IBD("BCID")):5 S IBLOCK=$T
"RTN","IBNCPDP4",115,0)
 ;
"RTN","IBNCPDP4",116,0)
 ; -- claims tracking info
"RTN","IBNCPDP4",117,0)
 S IBTRKR=$G(^IBE(350.9,1,6))
"RTN","IBNCPDP4",118,0)
 ; date can't be before parameters
"RTN","IBNCPDP4",119,0)
 S $P(IBTRKR,"^")=$S('$P(IBTRKR,"^",4):0,+IBTRKR&(IBADT<+IBTRKR):0,1:IBADT)
"RTN","IBNCPDP4",120,0)
 S IBTRKRN=+$O(^IBT(356,"ARXFL",IBRXN,IBFIL,0))
"RTN","IBNCPDP4",121,0)
 ;
"RTN","IBNCPDP4",122,0)
 ; If the Rx is not released - set NBR in CT
"RTN","IBNCPDP4",123,0)
 I 'IBRDT,'$P($G(^IBT(356,IBTRKRN,0)),U,19) D NONBR^IBNCPNB(DFN,IBRXN,IBFIL,IBADT,"PRESCRIPTION NOT RELEASED","","","",IBUSR)
"RTN","IBNCPDP4",124,0)
 ;
"RTN","IBNCPDP4",125,0)
 ; If the Rx is released - clean up NBR in CT
"RTN","IBNCPDP4",126,0)
 I IBRDT,$P($G(^IBE(356.8,+$P($G(^IBT(356,IBTRKRN,0)),U,19),0)),U)="PRESCRIPTION NOT RELEASED" D NONBR^IBNCPNB(DFN,IBRXN,IBFIL,IBADT,"","","","",IBUSR)
"RTN","IBNCPDP4",127,0)
 ; Set ECME fields in CT
"RTN","IBNCPDP4",128,0)
 S DIE="^IBT(356,",DA=IBTRKRN
"RTN","IBNCPDP4",129,0)
 S IBFLAG=$S(IBRESP["REJECT":1,1:0)
"RTN","IBNCPDP4",130,0)
 S DR="1.1///"_IBD("CLAIMID")_";1.11///"_IBFLAG
"RTN","IBNCPDP4",131,0)
 D ^DIE
"RTN","IBNCPDP4",132,0)
 S IBRES=1
"RTN","IBNCPDP4",133,0)
SUBQ ;
"RTN","IBNCPDP4",134,0)
 D LOG^IBNCPDP2("SUBMIT",IBRES)
"RTN","IBNCPDP4",135,0)
 I IBLOCK L -^DGCR(399,"AG",IBD("BCID"))
"RTN","IBNCPDP4",136,0)
 Q IBRES
"RTN","IBNCPDP4",137,0)
 ;
"RTN","IBNCPDP4",138,0)
 ;
"RTN","IBNCPDP4",139,0)
REOPEN(DFN,IBD) ;
"RTN","IBNCPDP4",140,0)
 N IBRES,IBADT,IBRXN,IBFIL,IBRDT,IBLOCK,IBLOCK2,IBTRKRN
"RTN","IBNCPDP4",141,0)
 N IBEABD,IBNBR,DA,DIE,DR,IBUSR,IBEABD
"RTN","IBNCPDP4",142,0)
 S (IBLOCK,IBLOCK2)=0
"RTN","IBNCPDP4",143,0)
 I 'DFN S IBRES="0^No patient" G REOPQ
"RTN","IBNCPDP4",144,0)
 S IBADT=+$G(IBD("FILL DATE")) I 'IBADT S IBRES="0^No fill date" G REOPQ
"RTN","IBNCPDP4",145,0)
 S IBRXN=+$G(IBD("PRESCRIPTION")) I 'IBRXN S IBRES="0^No Rx IEN" G REOPQ
"RTN","IBNCPDP4",146,0)
 S IBFIL=+$G(IBD("FILL NUMBER"),-1) I IBFIL<0 S IBRES="0^No fill number" G REOPQ
"RTN","IBNCPDP4",147,0)
 I '$L($G(IBD("CLAIMID"))) S IBRES="0^Missing ECME Number" G REOPQ
"RTN","IBNCPDP4",148,0)
 S IBRDT=$$RXRLDT^PSOBPSUT(IBRXN,IBFIL)  ; release date (if null is returned then Rx is not released)
"RTN","IBNCPDP4",149,0)
 S IBD("BCID")=IBD("CLAIMID")_";"_IBADT
"RTN","IBNCPDP4",150,0)
 S IBUSR=$S(+$G(IBD("USER"))=0:DUZ,1:IBD("USER"))
"RTN","IBNCPDP4",151,0)
 L +^DGCR(399,"AG",IBD("BCID")):5 S IBLOCK=$T
"RTN","IBNCPDP4",152,0)
 ;
"RTN","IBNCPDP4",153,0)
 S IBTRKRN=+$O(^IBT(356,"ARXFL",IBRXN,IBFIL,0))  ;get the claim entry associated with the Rx fill (or refill)
"RTN","IBNCPDP4",154,0)
 L +^IBT(356,IBTRKRN):5 S IBLOCK2=$T
"RTN","IBNCPDP4",155,0)
 S DIE="^IBT(356,",DA=IBTRKRN
"RTN","IBNCPDP4",156,0)
 ;
"RTN","IBNCPDP4",157,0)
 I IBRDT D   ; if Rx released assign earliest autobill date 
"RTN","IBNCPDP4",158,0)
 . S IBEABD=$$EABD^IBTUTL($O(^IBE(356.6,"AC",4,0)),IBADT)
"RTN","IBNCPDP4",159,0)
 . S:'IBEABD IBEABD=DT
"RTN","IBNCPDP4",160,0)
 . S IBEABD=$$FMADD^XLFDT(IBEABD,60)
"RTN","IBNCPDP4",161,0)
 ;
"RTN","IBNCPDP4",162,0)
 N IBFDA
"RTN","IBNCPDP4",163,0)
 S IBFDA(356,IBTRKRN_",",.19)=$S('IBRDT:$O(^IBE(356.8,"B","PRESCRIPTION NOT RELEASED","")),1:"@")  ;non-billable reason
"RTN","IBNCPDP4",164,0)
 D FILE^DIE("","IBFDA"),MSG^DIALOG()
"RTN","IBNCPDP4",165,0)
 K IBFDA
"RTN","IBNCPDP4",166,0)
 S IBFDA(356,IBTRKRN_",",.17)=$S('IBRDT:"@",1:IBEABD)  ; earliest autobill date
"RTN","IBNCPDP4",167,0)
 S IBFDA(356,IBTRKRN_",",1.08)="@"  ;additional comments
"RTN","IBNCPDP4",168,0)
 S IBFDA(356,IBTRKRN_",",1.11)=0   ; reject flag - reset to "no"
"RTN","IBNCPDP4",169,0)
 S IBFDA(356,IBTRKRN_",",1.03)=DT  ; date last edited
"RTN","IBNCPDP4",170,0)
 S IBFDA(356,IBTRKRN_",",1.04)=IBUSR   ; last edited by
"RTN","IBNCPDP4",171,0)
 D FILE^DIE("","IBFDA"),MSG^DIALOG()
"RTN","IBNCPDP4",172,0)
 ; 
"RTN","IBNCPDP4",173,0)
 S IBRES=1
"RTN","IBNCPDP4",174,0)
REOPQ ;
"RTN","IBNCPDP4",175,0)
 D LOG^IBNCPDP2("REOPEN",IBRES)
"RTN","IBNCPDP4",176,0)
 I IBLOCK L -^DGCR(399,"AG",IBD("BCID"))
"RTN","IBNCPDP4",177,0)
 I IBLOCK2 L -^IBT(356,IBTRKRN)
"RTN","IBNCPDP4",178,0)
 Q IBRES
"RTN","IBNCPDP4",179,0)
 ;IBNCPDP4
"RTN","IBNCPDP6")
0^32^B12692205
"RTN","IBNCPDP6",1,0)
IBNCPDP6 ;OAK/ELZ - TRICARE NCPDP TOOLS; 02-AUG-96 ;10/18/07  13:40
"RTN","IBNCPDP6",2,0)
 ;;2.0;INTEGRATED BILLING;**383,384**;21-MAR-94;Build 74
"RTN","IBNCPDP6",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBNCPDP6",4,0)
 ;
"RTN","IBNCPDP6",5,0)
START(IBKEY,IBELIG,IBRT) ; initial storage done during
"RTN","IBNCPDP6",6,0)
 ; billing determination check (updates allowed)
"RTN","IBNCPDP6",7,0)
 ;  Input:    IBKEY  --  1 ; 2, where
"RTN","IBNCPDP6",8,0)
 ;                         1 = Pointer to the prescription in file #52
"RTN","IBNCPDP6",9,0)
 ;                         2 = Pointer to the refill in file #52.1, or
"RTN","IBNCPDP6",10,0)
 ;                             0 for the original fill
"RTN","IBNCPDP6",11,0)
 ;            IBELIG --  single character indicating elig indicator
"RTN","IBNCPDP6",12,0)
 ;                         V = Veteran
"RTN","IBNCPDP6",13,0)
 ;                         T = Tricare
"RTN","IBNCPDP6",14,0)
 ;            IBRT   --  Rate type pointer to be used for the bill later
"RTN","IBNCPDP6",15,0)
 ;
"RTN","IBNCPDP6",16,0)
 N IBCHTRN,DO,DIC,X,Y,DIE,DA,DR
"RTN","IBNCPDP6",17,0)
 S IBCHTRN=$O(^IBCNR(366.15,"B",IBKEY,0))
"RTN","IBNCPDP6",18,0)
 I 'IBCHTRN D
"RTN","IBNCPDP6",19,0)
 . S DIC="^IBCNR(366.15,",DIC(0)="",X=IBKEY D FILE^DICN
"RTN","IBNCPDP6",20,0)
 . S IBCHTRN=+Y
"RTN","IBNCPDP6",21,0)
 S DIE="^IBCNR(366.15,",DA=IBCHTRN,DR=".02////^S X=IBELIG;.03////^S X=IBRT"
"RTN","IBNCPDP6",22,0)
 D ^DIE
"RTN","IBNCPDP6",23,0)
 Q
"RTN","IBNCPDP6",24,0)
 ;
"RTN","IBNCPDP6",25,0)
BILL(IBKEY,IBCHG) ; Create the TRICARE Rx copay charge.
"RTN","IBNCPDP6",26,0)
 ;  Input:    IBKEY  --  1 ; 2, where
"RTN","IBNCPDP6",27,0)
 ;                         1 = Pointer to the prescription in file #52
"RTN","IBNCPDP6",28,0)
 ;                         2 = Pointer to the refill in file #52.1, or
"RTN","IBNCPDP6",29,0)
 ;                             0 for the original fill
"RTN","IBNCPDP6",30,0)
 ;            IBCHG  --  charge amount
"RTN","IBNCPDP6",31,0)
 ;
"RTN","IBNCPDP6",32,0)
 N IBCHTRN,IBY,IBATYP,IBSERV,IBDESC,IBUNIT,IBSL,IBFR,DA,DIE,DR,DFN,IBN,IBZ
"RTN","IBNCPDP6",33,0)
 ;
"RTN","IBNCPDP6",34,0)
 S IBY=1
"RTN","IBNCPDP6",35,0)
 I '$G(IBKEY) G BILLQ
"RTN","IBNCPDP6",36,0)
 S IBCHTRN=$O(^IBCNR(366.15,"B",IBKEY,0))
"RTN","IBNCPDP6",37,0)
 I 'IBCHTRN G BILLQ
"RTN","IBNCPDP6",38,0)
 S IBZ=$G(^IBCNR(366.15,IBCHTRN,0))
"RTN","IBNCPDP6",39,0)
 ;
"RTN","IBNCPDP6",40,0)
 ; - Tricare?
"RTN","IBNCPDP6",41,0)
 I $P(IBZ,"^",2)'="T" G BILLQ
"RTN","IBNCPDP6",42,0)
 ;
"RTN","IBNCPDP6",43,0)
 ; - already billed, need to cancel to bill
"RTN","IBNCPDP6",44,0)
 I $P(IBZ,"^",4) D CANC(IBKEY)
"RTN","IBNCPDP6",45,0)
 ;
"RTN","IBNCPDP6",46,0)
 I $$FILE^IBRXUTL(+IBKEY,.01)="" G BILLQ
"RTN","IBNCPDP6",47,0)
 ;
"RTN","IBNCPDP6",48,0)
 ; - need patient
"RTN","IBNCPDP6",49,0)
 S DFN=$$FILE^IBRXUTL(+IBKEY,2)
"RTN","IBNCPDP6",50,0)
 I 'DFN S IBY="-1^IB002" G BILLQ
"RTN","IBNCPDP6",51,0)
 ;
"RTN","IBNCPDP6",52,0)
 ; - need action type
"RTN","IBNCPDP6",53,0)
 S IBATYP=$O(^IBE(350.1,"E","TRICARE RX COPAY",0))
"RTN","IBNCPDP6",54,0)
 I 'IBATYP S IBY="-1^IB008" G BILLQ
"RTN","IBNCPDP6",55,0)
 ;
"RTN","IBNCPDP6",56,0)
 ; - need facility number
"RTN","IBNCPDP6",57,0)
 I '$$CHECK^IBECEAU(0) S IBY="-1^IB009" G BILLQ
"RTN","IBNCPDP6",58,0)
 ;
"RTN","IBNCPDP6",59,0)
 ; - need the Pharmacy service pointer; get from #350.1 and check it
"RTN","IBNCPDP6",60,0)
 S IBSERV=$P($G(^IBE(350.1,1,0)),"^",4)
"RTN","IBNCPDP6",61,0)
 I '$$SERV^IBARX1(IBSERV) S IBY="-1^IB003" G BILLQ
"RTN","IBNCPDP6",62,0)
 ;
"RTN","IBNCPDP6",63,0)
 ; - need a charge amount
"RTN","IBNCPDP6",64,0)
 S IBCHG=+$G(IBCHG)
"RTN","IBNCPDP6",65,0)
 I 'IBCHG S IBY="-1^IB029" G BILLQ
"RTN","IBNCPDP6",66,0)
 ;
"RTN","IBNCPDP6",67,0)
 ; - set remaining variables
"RTN","IBNCPDP6",68,0)
 S IBDESC="TRICARE RX COPAY",IBUNIT=1
"RTN","IBNCPDP6",69,0)
 S IBSL="52:"_+IBKEY S:$P(IBKEY,";",2) IBSL=IBSL_";1:"_$P(IBKEY,";",2)
"RTN","IBNCPDP6",70,0)
 S IBFR=DT
"RTN","IBNCPDP6",71,0)
 ;
"RTN","IBNCPDP6",72,0)
 ; - add the charge to file #350
"RTN","IBNCPDP6",73,0)
 D ADD^IBECEAU3 I IBY<0 G BILLQ
"RTN","IBNCPDP6",74,0)
 ;
"RTN","IBNCPDP6",75,0)
 ; - release the charge to AR
"RTN","IBNCPDP6",76,0)
 D AR^IBR
"RTN","IBNCPDP6",77,0)
 ;
"RTN","IBNCPDP6",78,0)
 ; - update the rx file (#366.15)
"RTN","IBNCPDP6",79,0)
 S DA=IBCHTRN,DIE="^IBCNR(366.15,",DR=".04////"_IBN D ^DIE K DA,DIE,DR
"RTN","IBNCPDP6",80,0)
 ;
"RTN","IBNCPDP6",81,0)
BILLQ ;
"RTN","IBNCPDP6",82,0)
 I IBY<0 D ERRMSG^IBACVA2(1,2)
"RTN","IBNCPDP6",83,0)
 ;
"RTN","IBNCPDP6",84,0)
 Q
"RTN","IBNCPDP6",85,0)
 ;
"RTN","IBNCPDP6",86,0)
 ;
"RTN","IBNCPDP6",87,0)
CANC(IBKEY) ; Cancel the TRICARE Rx copay charge.
"RTN","IBNCPDP6",88,0)
 ;  Input:    IBKEY  --  1 ; 2, where
"RTN","IBNCPDP6",89,0)
 ;                         1 = Pointer to the prescription in file #52
"RTN","IBNCPDP6",90,0)
 ;                         2 = Pointer to the refill in file #52.1, or
"RTN","IBNCPDP6",91,0)
 ;                             0 for the original fill
"RTN","IBNCPDP6",92,0)
 ;
"RTN","IBNCPDP6",93,0)
 N IBCHTRND,IBDUZ,IBN,IBCRES,DFN,IBSITE,IBFAC,IBND,IBPARNT,IBCANC,IBH,IBCANTR,IBXA,IBATYP,IBSEQNO,IBIL,IBUNIT,IBCHG,IBFR,DIE,DA,DR,IBCHTRN,IBY
"RTN","IBNCPDP6",94,0)
 ;
"RTN","IBNCPDP6",95,0)
 S IBY=1,IBDUZ=DUZ
"RTN","IBNCPDP6",96,0)
 S IBCHTRN=$O(^IBCNR(366.15,"B",IBKEY,0))
"RTN","IBNCPDP6",97,0)
 I 'IBCHTRN G CANCQ
"RTN","IBNCPDP6",98,0)
 S IBCHTRND=$G(^IBCNR(366.15,IBCHTRN,0)),DFN=$$FILE^IBRXUTL(+IBKEY,2)
"RTN","IBNCPDP6",99,0)
 S IBN=+$P(IBCHTRND,"^",4) I 'IBN G CANCQ
"RTN","IBNCPDP6",100,0)
 I '$$CHECK^IBECEAU(0) S IBY="-1^IB009" G CANCQ
"RTN","IBNCPDP6",101,0)
 S IBCRES=$O(^IBE(350.3,"B","RX CANCELLED",0)) S:'IBCRES IBCRES=5
"RTN","IBNCPDP6",102,0)
 ;
"RTN","IBNCPDP6",103,0)
 ; - cancel the charge
"RTN","IBNCPDP6",104,0)
 D CED^IBECEAU4(IBN) I IBY<0 G CANCQ
"RTN","IBNCPDP6",105,0)
 D CANC^IBECEAU4(IBN,IBCRES,1)
"RTN","IBNCPDP6",106,0)
 ;
"RTN","IBNCPDP6",107,0)
 S DIE="^IBCNR(366.15,",DA=IBCHTRN,DR=".04///@" D ^DIE
"RTN","IBNCPDP6",108,0)
CANCQ ;
"RTN","IBNCPDP6",109,0)
 I IBY<0 D ERRMSG^IBACVA2(0,2)
"RTN","IBNCPDP6",110,0)
 ;
"RTN","IBNCPDP6",111,0)
 Q
"RTN","IBNCPDP6",112,0)
 ;
"RTN","IBNCPDP6",113,0)
RT(IBKEY) ; returns rate type previously determined
"RTN","IBNCPDP6",114,0)
 Q $P($G(^IBCNR(366.15,+$O(^IBCNR(366.15,"B",IBKEY,0)),0)),"^",3)
"RTN","IBNCPDP6",115,0)
 ;
"RTN","IBNCPDP6",116,0)
TRICARE(IBKEY) ; returns if the Key is RT Tricare
"RTN","IBNCPDP6",117,0)
 N IBRT
"RTN","IBNCPDP6",118,0)
 S IBRT=+$$RT(IBKEY)
"RTN","IBNCPDP6",119,0)
 Q $S($P($G(^DGCR(399.3,IBRT,0)),"^")["TRICARE":1,1:0)
"RTN","IBNCPDP6",120,0)
 ;
"RTN","IBNCPDP6",121,0)
 ;gets the insurance phone
"RTN","IBNCPDP6",122,0)
 ;input:
"RTN","IBNCPDP6",123,0)
 ; IB36 - ptr to INSURANCE COMPANY File (#36)
"RTN","IBNCPDP6",124,0)
 ;output:
"RTN","IBNCPDP6",125,0)
 ; the phone number
"RTN","IBNCPDP6",126,0)
PHONE(IB36) ;
"RTN","IBNCPDP6",127,0)
 N IB1
"RTN","IBNCPDP6",128,0)
 ;check first CLAIMS (RX) PHONE NUMBER if empty
"RTN","IBNCPDP6",129,0)
 S IB1=$$GET1^DIQ(36,+IB36,.1311,"E")
"RTN","IBNCPDP6",130,0)
 Q:$L(IB1)>0 IB1
"RTN","IBNCPDP6",131,0)
 ;check BILLING PHONE NUMBER if empty - return nothing
"RTN","IBNCPDP6",132,0)
 S IB1=$$GET1^DIQ(36,+IB36,.132,"E")
"RTN","IBNCPDP6",133,0)
 Q IB1
"RTN","IBNCPDP6",134,0)
 ;IBNCPDP6
"RTN","IBNCPDPC")
0^26^B5201665
"RTN","IBNCPDPC",1,0)
IBNCPDPC ;DALOI/SS - CLAIMS TRACKING EDITOR for ECME ;3/6/08  16:17
"RTN","IBNCPDPC",2,0)
 ;;2.0;INTEGRATED BILLING;**276,339,363,384**;21-MAR-94;Build 74
"RTN","IBNCPDPC",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBNCPDPC",4,0)
 ;
"RTN","IBNCPDPC",5,0)
 ;
"RTN","IBNCPDPC",6,0)
% ; -- main entry point for IBT CLAIMS TRACKING EDIT
"RTN","IBNCPDPC",7,0)
 ;DFN- patients IEN (file #2)
"RTN","IBNCPDPC",8,0)
 ;IBECMEN - NCPDP/ECME number (last 7 digits of the IEN of file #52)
"RTN","IBNCPDPC",9,0)
 ; that belong to this claim.
"RTN","IBNCPDPC",10,0)
 ;ien in CLAIMS TRACKING file #356
"RTN","IBNCPDPC",11,0)
 ;
"RTN","IBNCPDPC",12,0)
CT(DFN,IBECMEN,IBREFNUM) ;
"RTN","IBNCPDPC",13,0)
 Q:'$G(DFN)
"RTN","IBNCPDPC",14,0)
 Q:'$G(IBECMEN)
"RTN","IBNCPDPC",15,0)
 N IBTRN
"RTN","IBNCPDPC",16,0)
 S IBTRN=+$$SELCT(IBECMEN,IBREFNUM)
"RTN","IBNCPDPC",17,0)
 I +IBTRN=0 D  Q
"RTN","IBNCPDPC",18,0)
 . W !,"There is no claims tracking record for this claim."
"RTN","IBNCPDPC",19,0)
 . D PAUSE^VALM1
"RTN","IBNCPDPC",20,0)
 D EN^VALM("IBNCPDP LSTMN CT")
"RTN","IBNCPDPC",21,0)
 Q
"RTN","IBNCPDPC",22,0)
 ;
"RTN","IBNCPDPC",23,0)
EN ; -- main entry point for IBT EXPAND/EDIT TRACKING
"RTN","IBNCPDPC",24,0)
 D EN^IBTRED
"RTN","IBNCPDPC",25,0)
 Q
"RTN","IBNCPDPC",26,0)
 ;
"RTN","IBNCPDPC",27,0)
INIT ; -- init variables and list array
"RTN","IBNCPDPC",28,0)
 D INIT^IBTRED
"RTN","IBNCPDPC",29,0)
 Q
"RTN","IBNCPDPC",30,0)
 ;
"RTN","IBNCPDPC",31,0)
HELP ; -- help code
"RTN","IBNCPDPC",32,0)
 D HELP^IBTRED
"RTN","IBNCPDPC",33,0)
 Q
"RTN","IBNCPDPC",34,0)
 ;
"RTN","IBNCPDPC",35,0)
EXIT ; -- exit code
"RTN","IBNCPDPC",36,0)
 D EXIT^IBTRED
"RTN","IBNCPDPC",37,0)
 Q
"RTN","IBNCPDPC",38,0)
 ;
"RTN","IBNCPDPC",39,0)
BLANK(LINE) ; -- Build blank line
"RTN","IBNCPDPC",40,0)
 D BLANK^IBTRED(.LINE)
"RTN","IBNCPDPC",41,0)
 Q
"RTN","IBNCPDPC",42,0)
 ;
"RTN","IBNCPDPC",43,0)
ETYP(IBTRN) ; -- Expand type of epidose and date
"RTN","IBNCPDPC",44,0)
 Q $$ETYP^IBTRED(IBTRN)
"RTN","IBNCPDPC",45,0)
 ;
"RTN","IBNCPDPC",46,0)
ENCL(IBOE) ; -- output format of classifications
"RTN","IBNCPDPC",47,0)
 Q $$ENCL^IBTRED(IBOE)
"RTN","IBNCPDPC",48,0)
 ;
"RTN","IBNCPDPC",49,0)
SELCT(IBECMEN,IBREFNUM) ;
"RTN","IBNCPDPC",50,0)
 N IBRET,IB356
"RTN","IBNCPDPC",51,0)
 S (IB356,IBRET)=0
"RTN","IBNCPDPC",52,0)
 F  S IB356=+$O(^IBT(356,"AE",IBECMEN,IB356)) Q:((IB356=0)!(IBRET'=0))  D
"RTN","IBNCPDPC",53,0)
 . I IBREFNUM=+$P($G(^IBT(356,IB356,0)),U,10) S IBRET=IB356
"RTN","IBNCPDPC",54,0)
 Q +IBRET
"RTN","IBNCPDPC",55,0)
 ;
"RTN","IBNCPDPC",56,0)
 ;return RX info
"RTN","IBNCPDPC",57,0)
 ;IBDFN - patient's DFN
"RTN","IBNCPDPC",58,0)
 ;IBRX - ien in #52
"RTN","IBNCPDPC",59,0)
 ;output in .PSOTMP array
"RTN","IBNCPDPC",60,0)
PSOCPVW(IBDFN,IBRX,PSOTMP) ;
"RTN","IBNCPDPC",61,0)
 Q:($G(IBDFN)=0)!($G(IBRX)=0)
"RTN","IBNCPDPC",62,0)
 K ^TMP($J,"IBNCPDP-RXINFO")
"RTN","IBNCPDPC",63,0)
 D RX^PSO52API(IBDFN,"IBNCPDP-RXINFO",IBRX,"",0)
"RTN","IBNCPDPC",64,0)
 S PSOTMP(52,+$P(IBTRND,"^",8),.01,"E")=$G(^TMP($J,"IBNCPDP-RXINFO",IBDFN,IBRX,.01))
"RTN","IBNCPDPC",65,0)
 S PSOTMP(52,+$P(IBTRND,"^",8),7,"E")=$G(^TMP($J,"IBNCPDP-RXINFO",IBDFN,IBRX,7))
"RTN","IBNCPDPC",66,0)
 S PSOTMP(52,+$P(IBTRND,"^",8),8,"E")=$G(^TMP($J,"IBNCPDP-RXINFO",IBDFN,IBRX,8))
"RTN","IBNCPDPC",67,0)
 S PSOTMP(52,+$P(IBTRND,"^",8),6,"E")=$P($G(^TMP($J,"IBNCPDP-RXINFO",IBDFN,IBRX,6)),U,2)
"RTN","IBNCPDPC",68,0)
 K ^TMP($J,"IBNCPDP-RXINFO")
"RTN","IBNCPDPC",69,0)
 Q
"RTN","IBNCPDPC",70,0)
 ;
"RTN","IBNCPDPE")
0^27^B17129560
"RTN","IBNCPDPE",1,0)
IBNCPDPE ;DALOI/AAT - NCPDP BILLING EVENTS REPORT ;3/6/08  16:18
"RTN","IBNCPDPE",2,0)
 ;;2.0;INTEGRATED BILLING;**276,342,347,363,384**;21-MAR-94;Build 74
"RTN","IBNCPDPE",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBNCPDPE",4,0)
 ;
"RTN","IBNCPDPE",5,0)
DATE ;
"RTN","IBNCPDPE",6,0)
 S (IBBDT,IBEDT)=DT
"RTN","IBNCPDPE",7,0)
 S %DT="AEX"
"RTN","IBNCPDPE",8,0)
 S %DT("A")="START WITH DATE: ",%DT("B")="TODAY"
"RTN","IBNCPDPE",9,0)
 D ^%DT K %DT
"RTN","IBNCPDPE",10,0)
 I Y<0 S IBQ=1 Q
"RTN","IBNCPDPE",11,0)
 S IBBDT=+Y
"RTN","IBNCPDPE",12,0)
 S %DT="AEX"
"RTN","IBNCPDPE",13,0)
 S %DT("A")="GO TO DATE: ",%DT("B")="TODAY"
"RTN","IBNCPDPE",14,0)
 D ^%DT K %DT
"RTN","IBNCPDPE",15,0)
 I Y<0 S IBQ=1 Q
"RTN","IBNCPDPE",16,0)
 S IBEDT=+Y
"RTN","IBNCPDPE",17,0)
 Q
"RTN","IBNCPDPE",18,0)
 ;
"RTN","IBNCPDPE",19,0)
MODE ;
"RTN","IBNCPDPE",20,0)
 N DIR,DIC,DIRUT,DUOUT,PSOFILE
"RTN","IBNCPDPE",21,0)
 S (IBM1,IBM2,IBM3)="A"
"RTN","IBNCPDPE",22,0)
 S DIR(0)="S^P:SINGLE PATIENT;R:SINGLE RX;E:SINGLE ECME #;A:ALL ACTIVITY"
"RTN","IBNCPDPE",23,0)
 S DIR("A")="SINGLE (P)ATIENT, SINGLE (R)X, SINGLE (E)CME #, (A)LL ACTIVITY"
"RTN","IBNCPDPE",24,0)
 S DIR("B")="ALL"
"RTN","IBNCPDPE",25,0)
 D ^DIR K DIR I $D(DIRUT) S IBQ=1 Q
"RTN","IBNCPDPE",26,0)
 S IBM1=Y
"RTN","IBNCPDPE",27,0)
 I IBM1="P" S DIC="^DPT(",DIC(0)="AEQMN" D ^DIC Q:$D(DUOUT)  S IBPAT=$S(Y>0:+Y,1:0) I 'IBPAT W "   ALL" S IBM1="A"
"RTN","IBNCPDPE",28,0)
 I IBM1="R" S PSOFILE=52,DIC="^PSRX(",DIC(0)="AEQMN" D DIC^PSODI(PSOFILE,.DIC) Q:$D(DUOUT)  S IBRX=$S(Y>0:+Y,1:0) I 'IBRX W "   ALL" S IBM1="A"
"RTN","IBNCPDPE",29,0)
 K PSODIY
"RTN","IBNCPDPE",30,0)
 I IBM1="E" S DIR(0)="FO^7:7^I X'?1.7N W !!,""Cannot contain alpha characters"" K X",DIR("A")="Enter ECME #" D ^DIR Q:$D(DUOUT)  S IBECME=$S(+Y>0:Y,1:0) I 'IBECME W "   ALL" S IBM1="A"
"RTN","IBNCPDPE",31,0)
 S IBM2="B"
"RTN","IBNCPDPE",32,0)
 ; if "All"
"RTN","IBNCPDPE",33,0)
 I IBM1="A" D  Q:$G(IBQ)
"RTN","IBNCPDPE",34,0)
 .S DIR(0)="S^E:ECME BILLABLE;N:NON ECME BILLABLE;B:BOTH"
"RTN","IBNCPDPE",35,0)
 .S DIR("A")="(E)CME BILLABLE;(N)ON ECME BILLABLE;(B)OTH"
"RTN","IBNCPDPE",36,0)
 .S DIR("B")="BOTH"
"RTN","IBNCPDPE",37,0)
 .D ^DIR K DIR I $D(DIRUT) S IBQ=1 Q
"RTN","IBNCPDPE",38,0)
 .S IBM2=Y
"RTN","IBNCPDPE",39,0)
 ;
"RTN","IBNCPDPE",40,0)
 ;Mail/Window/CMOP?
"RTN","IBNCPDPE",41,0)
 S DIR(0)="S^M:MAIL;W:WINDOW;C:CMOP;A:ALL"
"RTN","IBNCPDPE",42,0)
 S DIR("A")="(M)AIL, (W)INDOW, (C)CMOP, (A)LL"
"RTN","IBNCPDPE",43,0)
 S DIR("B")="ALL"
"RTN","IBNCPDPE",44,0)
 D ^DIR K DIR I $D(DIRUT) S IBQ=1 Q
"RTN","IBNCPDPE",45,0)
 S IBM3=Y
"RTN","IBNCPDPE",46,0)
 ;
"RTN","IBNCPDPE",47,0)
 S DIR(0)="S^S:SUMMARY REPORT;D:DETAILED REPORT"
"RTN","IBNCPDPE",48,0)
 S DIR("A")="(S)UMMARY REPORT, (D)ETAILED REPORT"
"RTN","IBNCPDPE",49,0)
 S DIR("B")="SUMMARY REPORT"
"RTN","IBNCPDPE",50,0)
 D ^DIR K DIR I $D(DIRUT) S IBQ=1 Q
"RTN","IBNCPDPE",51,0)
 S IBDTL=($E(Y)="D")
"RTN","IBNCPDPE",52,0)
 Q
"RTN","IBNCPDPE",53,0)
 ;
"RTN","IBNCPDPE",54,0)
TESTDATA() ;
"RTN","IBNCPDPE",55,0)
 N Y
"RTN","IBNCPDPE",56,0)
 S Y=$$HAVEDATA()
"RTN","IBNCPDPE",57,0)
 I 'Y W !!,"No data found in the specified period.",!
"RTN","IBNCPDPE",58,0)
 Q Y
"RTN","IBNCPDPE",59,0)
 ;
"RTN","IBNCPDPE",60,0)
HAVEDATA() ;
"RTN","IBNCPDPE",61,0)
 N Z
"RTN","IBNCPDPE",62,0)
 I $D(^IBCNR(366.14,"B",IBBDT)) Q 1
"RTN","IBNCPDPE",63,0)
 S Z=+$O(^IBCNR(366.14,"B",IBBDT))
"RTN","IBNCPDPE",64,0)
 I Z=0 Q 0
"RTN","IBNCPDPE",65,0)
 I Z>IBEDT Q 0
"RTN","IBNCPDPE",66,0)
 Q 1
"RTN","IBNCPDPE",67,0)
 ;
"RTN","IBNCPDPE",68,0)
DEVICE ;
"RTN","IBNCPDPE",69,0)
 N DIR,DIRUT,POP,ZTRTN,ZTIO,ZTSAVE,ZTDESC,%ZIS,ZTSK
"RTN","IBNCPDPE",70,0)
 S %ZIS="QM"
"RTN","IBNCPDPE",71,0)
 W ! D ^%ZIS
"RTN","IBNCPDPE",72,0)
 I POP S IBQ=1 Q
"RTN","IBNCPDPE",73,0)
 S IBSCR=$S($E($G(IOST),1,2)="C-":1,1:0)
"RTN","IBNCPDPE",74,0)
 ;
"RTN","IBNCPDPE",75,0)
 I $D(IO("Q")) D  S IBQ=1
"RTN","IBNCPDPE",76,0)
 . S ZTRTN="START^IBNCPEV"
"RTN","IBNCPDPE",77,0)
 . S ZTIO=ION
"RTN","IBNCPDPE",78,0)
 . S ZTSAVE("IB*")=""
"RTN","IBNCPDPE",79,0)
 . S ZTDESC="IB ECME BILLING EVENTS REPORT"
"RTN","IBNCPDPE",80,0)
 . D ^%ZTLOAD
"RTN","IBNCPDPE",81,0)
 . W !,$S($D(ZTSK):"REQUEST QUEUED TASK="_ZTSK,1:"REQUEST CANCELLED")
"RTN","IBNCPDPE",82,0)
 . D HOME^%ZIS
"RTN","IBNCPDPE",83,0)
 U IO
"RTN","IBNCPDPE",84,0)
 Q
"RTN","IBNCPDPE",85,0)
 ;------ added for the User screen --------
"RTN","IBNCPDPE",86,0)
 ;User Screen Entry point (to call from ECME User Screen)
"RTN","IBNCPDPE",87,0)
 ;IBMODE:
"RTN","IBNCPDPE",88,0)
 ; P-patient
"RTN","IBNCPDPE",89,0)
 ; R-Rx
"RTN","IBNCPDPE",90,0)
 ;IBVAL - patient DFN or RX ien (#52)
"RTN","IBNCPDPE",91,0)
 ;
"RTN","IBNCPDPE",92,0)
USRSCREN(IBMODE,IBVAL) ;
"RTN","IBNCPDPE",93,0)
 N IBPAT,IBRX,IBBDT,IBEDT,Y,IBM1,IBM2,IBM3,IBQ,IBSCR,IBPAGE,IBDTL,IBDIVS
"RTN","IBNCPDPE",94,0)
 S (IBPAT,IBRX,IBQ,IBSCR,IBPAGE,IBDTL,IBDIVS)=0
"RTN","IBNCPDPE",95,0)
 S IBM1=IBMODE
"RTN","IBNCPDPE",96,0)
 I IBM1="P" S IBPAT=+IBVAL
"RTN","IBNCPDPE",97,0)
 I IBM1="R" S IBRX=+IBVAL
"RTN","IBNCPDPE",98,0)
 ;date
"RTN","IBNCPDPE",99,0)
 F  D DATE Q:IBQ  Q:$$TESTDATA
"RTN","IBNCPDPE",100,0)
 Q:IBQ
"RTN","IBNCPDPE",101,0)
 N IBMLTDV S IBMLTDV=$$MULTPHRM^BPSUTIL()
"RTN","IBNCPDPE",102,0)
 I +IBMLTDV=1 S IBDIVS=+$$MULTIDIV^IBNCPEV1(.IBDIVS) S:IBDIVS=0 IBDIVS(0)="0^ALL" I IBDIVS=-1 S IBQ=1 Q
"RTN","IBNCPDPE",103,0)
 I +IBMLTDV=0 S IBDIVS=0,IBDIVS(0)="0^"_$P(IBMLTDV,U,2)
"RTN","IBNCPDPE",104,0)
 D MODE2 Q:IBQ
"RTN","IBNCPDPE",105,0)
 D DEVICE Q:IBQ
"RTN","IBNCPDPE",106,0)
 D START^IBNCPEV
"RTN","IBNCPDPE",107,0)
 D ^%ZISC
"RTN","IBNCPDPE",108,0)
 I IBQ W !,"Cancelled"
"RTN","IBNCPDPE",109,0)
 Q
"RTN","IBNCPDPE",110,0)
 ;
"RTN","IBNCPDPE",111,0)
MODE2 ;
"RTN","IBNCPDPE",112,0)
 N DIR,DIC,DIRUT,DUOUT
"RTN","IBNCPDPE",113,0)
 S (IBM1,IBM2,IBM3)="A"
"RTN","IBNCPDPE",114,0)
 S IBM2="B"
"RTN","IBNCPDPE",115,0)
 ;
"RTN","IBNCPDPE",116,0)
 ;Mail/Window/CMOP?
"RTN","IBNCPDPE",117,0)
 S DIR(0)="S^M:MAIL;W:WINDOW;C:CMOP;A:ALL"
"RTN","IBNCPDPE",118,0)
 S DIR("A")="(M)AIL, (W)INDOW, (C)CMOP, (A)LL"
"RTN","IBNCPDPE",119,0)
 S DIR("B")="ALL"
"RTN","IBNCPDPE",120,0)
 D ^DIR K DIR I $D(DIRUT) S IBQ=1 Q
"RTN","IBNCPDPE",121,0)
 S IBM3=Y
"RTN","IBNCPDPE",122,0)
 ;
"RTN","IBNCPDPE",123,0)
 S DIR(0)="S^S:SUMMARY REPORT;D:DETAILED REPORT"
"RTN","IBNCPDPE",124,0)
 S DIR("A")="(S)UMMARY REPORT, (D)ETAILED REPORT"
"RTN","IBNCPDPE",125,0)
 S DIR("B")="SUMMARY REPORT"
"RTN","IBNCPDPE",126,0)
 D ^DIR K DIR I $D(DIRUT) S IBQ=1 Q
"RTN","IBNCPDPE",127,0)
 S IBDTL=($E(Y)="D")
"RTN","IBNCPDPE",128,0)
 Q
"RTN","IBNCPDPE",129,0)
 ;IBNCPDPE
"RTN","IBNCPDPH")
0^28^B26345635
"RTN","IBNCPDPH",1,0)
IBNCPDPH ;DALOI/SS - ECME REPORT OF ON HOLD CHARGES FOR A PATIENT ;3/6/08  16:19
"RTN","IBNCPDPH",2,0)
 ;;2.0;INTEGRATED BILLING;**276,347,384**;21-MAR-94;Build 74
"RTN","IBNCPDPH",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBNCPDPH",4,0)
 Q
"RTN","IBNCPDPH",5,0)
 ;
"RTN","IBNCPDPH",6,0)
 ;made after IBOHPT1 to use with ECME User Screen
"RTN","IBNCPDPH",7,0)
 ;see IA# with ECME
"RTN","IBNCPDPH",8,0)
 ;
"RTN","IBNCPDPH",9,0)
ONHOLD(DFN) ;
"RTN","IBNCPDPH",10,0)
 N IBQUIT,IBII,DIRUT,DUOUT,DTOUT,ZTIO,Y S IBQUIT=0
"RTN","IBNCPDPH",11,0)
 N DPTNOFZY S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBNCPDPH",12,0)
 ;
"RTN","IBNCPDPH",13,0)
 S DIR(0)="DA^::EX",DIR("A")="Start with DATE: "
"RTN","IBNCPDPH",14,0)
 S DIR("?")="Enter the starting date for this report."
"RTN","IBNCPDPH",15,0)
 D ^DIR K DIR G:$D(DIRUT) EXIT S IBSDT=+Y
"RTN","IBNCPDPH",16,0)
 S DIR(0)="DA^"_+Y_":NOW:EX",DIR("A")="     Go to DATE: "
"RTN","IBNCPDPH",17,0)
 S DIR("?")="Enter the ending date for this report."
"RTN","IBNCPDPH",18,0)
 D ^DIR K DIR G:$D(DIRUT) EXIT S IBEDT=+Y
"RTN","IBNCPDPH",19,0)
 ;
"RTN","IBNCPDPH",20,0)
 S DIR(0)="Y",DIR("A")="Include Pharmacy Co-pay charges on this report",DIR("B")="NO"
"RTN","IBNCPDPH",21,0)
 S DIR("?",1)="   Enter:  'Y' - to include Pharmacy Co-pay charges on this report"
"RTN","IBNCPDPH",22,0)
 S DIR("?",2)="           'N' - to exclude Pharmacy Co-pay charges on this report"
"RTN","IBNCPDPH",23,0)
 S DIR("?")="             '^' - to select a new patient"
"RTN","IBNCPDPH",24,0)
 D ^DIR K DIR G:$D(DIRUT) EXIT S IBIBRX=Y
"RTN","IBNCPDPH",25,0)
 ;
"RTN","IBNCPDPH",26,0)
QUEUED ; entry point if queued
"RTN","IBNCPDPH",27,0)
 ;***
"RTN","IBNCPDPH",28,0)
 K ^TMP($J,"IB")
"RTN","IBNCPDPH",29,0)
 D:'$G(IBQUIT) DEVICE D:'$G(IBQUIT) CHRGS,REPORT^IBOHPT2
"RTN","IBNCPDPH",30,0)
 D EXIT
"RTN","IBNCPDPH",31,0)
 ;***
"RTN","IBNCPDPH",32,0)
 Q
"RTN","IBNCPDPH",33,0)
EXIT ;
"RTN","IBNCPDPH",34,0)
 K ^TMP($J,"IB")
"RTN","IBNCPDPH",35,0)
 K DFN,IBEND,IBSDT,IBEDT,IBIBRX,IBCN,IBDT,IBIFN,X
"RTN","IBNCPDPH",36,0)
 K IBRDT,IBRF,IBRX,IBRXN
"RTN","IBNCPDPH",37,0)
 I $D(ZTQUEUED) S ZTREQ="@" Q
"RTN","IBNCPDPH",38,0)
 D ^%ZISC
"RTN","IBNCPDPH",39,0)
 Q
"RTN","IBNCPDPH",40,0)
DEVICE ;
"RTN","IBNCPDPH",41,0)
 I $D(ZTQUEUED) Q
"RTN","IBNCPDPH",42,0)
 W !!,*7,"*** Margin width of this output is 132 ***"
"RTN","IBNCPDPH",43,0)
 W !,"*** This output should be queued ***"
"RTN","IBNCPDPH",44,0)
 N %ZIS
"RTN","IBNCPDPH",45,0)
 S %ZIS="QM" D ^%ZIS I POP S IBQUIT=1 Q
"RTN","IBNCPDPH",46,0)
 N ZTRTN,ZTIO,ZTDES,ZTSAVE
"RTN","IBNCPDPH",47,0)
 I $D(IO("Q")) S ZTRTN="QUEUED^IBOHPT1",ZTIO=ION,ZTDESC="ON HOLD CHARGE INFO/PT",ZTSAVE("IB*")="",ZTSAVE("DFN")="" D ^%ZTLOAD W !,$S($D(ZTSK):"REQUEST QUEUED TASK="_ZTSK,1:"REQUEST CANCELLED") D HOME^%ZIS K ZTSK S IBQUIT=1 Q
"RTN","IBNCPDPH",48,0)
 U IO
"RTN","IBNCPDPH",49,0)
 Q
"RTN","IBNCPDPH",50,0)
 ; indexes records that should be included in report
"RTN","IBNCPDPH",51,0)
 ;
"RTN","IBNCPDPH",52,0)
CHRGS ; charges on hold
"RTN","IBNCPDPH",53,0)
 N DATE,IBN,IBND,A,B,C,D,E,IBNX
"RTN","IBNCPDPH",54,0)
 S IBN=0 F  S IBN=$O(^IB("C",DFN,IBN)) Q:'IBN  S IBND=$G(^IB(IBN,0)) D:IBND
"RTN","IBNCPDPH",55,0)
 .I 'IBIBRX,$E($G(^IBE(350.1,+$P(IBND,"^",3),0)),1,3)="PSO" Q
"RTN","IBNCPDPH",56,0)
 .Q:$P(IBND,"^",8)["ADMISSION"
"RTN","IBNCPDPH",57,0)
 .Q:'$P($G(^IB(IBN,1)),"^",6)
"RTN","IBNCPDPH",58,0)
 .Q:'$D(^IB("APDT",IBN))
"RTN","IBNCPDPH",59,0)
 .S (C,D)="",C=$O(^IB("APDT",IBN,C)),D=$O(^IB("APDT",IBN,C,D))
"RTN","IBNCPDPH",60,0)
 .S E=$P($G(^IB(D,0)),U,3)
"RTN","IBNCPDPH",61,0)
 .S A=$P($G(^IBE(350.1,E,0)),U,5)
"RTN","IBNCPDPH",62,0)
 .S IBNX=$S(A=2:$P($Q(^IB("APDT",IBN,C,D)),")",1),A=3:$P($Q(^IB("APDT",IBN,C,D)),")",1),1:IBN)
"RTN","IBNCPDPH",63,0)
 .I (A=2)!(A=3) D
"RTN","IBNCPDPH",64,0)
 ..I IBNX["[""" S IBNX="^"_$P(IBNX,"]",2)
"RTN","IBNCPDPH",65,0)
 .I $P(IBNX,",",4)>0 S IBNX=$P(IBNX,",",4)
"RTN","IBNCPDPH",66,0)
 .S DATE=$P($G(^IB(+$P(IBND,"^",1),0)),"^",17)
"RTN","IBNCPDPH",67,0)
 .S:'DATE DATE=$P($G(^IB(IBNX,1)),"^",5)
"RTN","IBNCPDPH",68,0)
 .S:'DATE DATE=$P($G(^IB(IBNX,1)),"^",2)\1
"RTN","IBNCPDPH",69,0)
 .I (DATE>(IBSDT-.0001))&(DATE<(IBEDT+.9999)) S ^TMP($J,"IB",-DATE,IBNX)="" D BILLS
"RTN","IBNCPDPH",70,0)
 Q
"RTN","IBNCPDPH",71,0)
 ;
"RTN","IBNCPDPH",72,0)
BILLS ; find bills for charges on hold
"RTN","IBNCPDPH",73,0)
 N IBFR,IBT,IBATYPE,IBTO
"RTN","IBNCPDPH",74,0)
 S IBATYPE=$S($P($G(^IBE(350.1,+$P(IBND,"^",3),0)),"^")["OPT":"O",$P($G(^IBE(350.1,+IBND,"^",3,0)),"^")["PSO":"RX",1:"I")
"RTN","IBNCPDPH",75,0)
 S IBFR=$P(IBND,"^",14),IBTO=$P(IBND,"^",15)
"RTN","IBNCPDPH",76,0)
 I IBATYPE="I" D INP
"RTN","IBNCPDPH",77,0)
 I IBATYPE="O" D OPT
"RTN","IBNCPDPH",78,0)
 E  D RX
"RTN","IBNCPDPH",79,0)
 Q
"RTN","IBNCPDPH",80,0)
INP ; inpatient bills
"RTN","IBNCPDPH",81,0)
 N IBEV,IBBILL,IBT,X,X1,X2,IBEND,IBOK
"RTN","IBNCPDPH",82,0)
 S IBEV=$P(IBND,"^",16) Q:'IBEV  ; parent event
"RTN","IBNCPDPH",83,0)
 S IBEV=($P($G(^IB(IBEV,0)),"^",17)\1) Q:'IBEV  ; date of parent event
"RTN","IBNCPDPH",84,0)
 S X1=IBEV,X2=1 D C^%DTC S IBEND=X
"RTN","IBNCPDPH",85,0)
 S IBT=(IBEV-.0001) F  S IBT=$O(^DGCR(399,"D",IBT)) Q:'IBT!(IBT'<IBEND)  S IBBILL=0 F  S IBBILL=$O(^DGCR(399,"D",IBT,IBBILL)) Q:IBBILL=""  D
"RTN","IBNCPDPH",86,0)
 .D INPTCK
"RTN","IBNCPDPH",87,0)
 .I IBOK S ^TMP($J,"IB",-DATE,IBNX,IBBILL)=""
"RTN","IBNCPDPH",88,0)
 Q
"RTN","IBNCPDPH",89,0)
 ;
"RTN","IBNCPDPH",90,0)
INPTCK ; does bill belong to charge? returns IBOK=0 if no
"RTN","IBNCPDPH",91,0)
 N IBBILL0,IBBILLU
"RTN","IBNCPDPH",92,0)
 S IBBILL0=$G(^DGCR(399,IBBILL,0)),IBBILLU=$G(^("U"))
"RTN","IBNCPDPH",93,0)
 S IBOK=1
"RTN","IBNCPDPH",94,0)
CK1 ; for same patient?
"RTN","IBNCPDPH",95,0)
 I DFN=$P(IBBILL0,"^",2)
"RTN","IBNCPDPH",96,0)
 S IBOK=$T
"RTN","IBNCPDPH",97,0)
 Q:'IBOK
"RTN","IBNCPDPH",98,0)
CK2 ; same type- inp or opt?
"RTN","IBNCPDPH",99,0)
 N B S B=$S(+$P(IBBILL0,"^",5)<3:"I",1:"O")
"RTN","IBNCPDPH",100,0)
 I B=IBATYPE
"RTN","IBNCPDPH",101,0)
 S IBOK=$T
"RTN","IBNCPDPH",102,0)
 Q:'IBOK
"RTN","IBNCPDPH",103,0)
CK3 ; overlap in date range?
"RTN","IBNCPDPH",104,0)
 N F,T
"RTN","IBNCPDPH",105,0)
 S F=+IBBILLU,T=$P(IBBILLU,"^",2)
"RTN","IBNCPDPH",106,0)
 I (IBTO<F)!(IBFR>T)
"RTN","IBNCPDPH",107,0)
 S IBOK='$T
"RTN","IBNCPDPH",108,0)
 Q:'IBOK
"RTN","IBNCPDPH",109,0)
CK4 ; insurance bill?
"RTN","IBNCPDPH",110,0)
 I $P(IBBILL0,"^",11)="i"
"RTN","IBNCPDPH",111,0)
 S IBOK=$T
"RTN","IBNCPDPH",112,0)
 Q
"RTN","IBNCPDPH",113,0)
OPT ; outpatient bills
"RTN","IBNCPDPH",114,0)
 N X,IBV,IBBILL,IBOK,IBBILL0
"RTN","IBNCPDPH",115,0)
 S IBV=(IBFR\1)-.0001 F  S IBV=$O(^DGCR(399,"AOPV",DFN,IBV)) Q:'IBV!(IBV>IBTO)  S IBBILL=0 D
"RTN","IBNCPDPH",116,0)
 .F  S IBBILL=$O(^DGCR(399,"AOPV",DFN,IBV,IBBILL)) Q:('IBBILL)  D
"RTN","IBNCPDPH",117,0)
 ..Q:$D(^TMP($J,"IB",-DATE,IBNX,IBBILL))
"RTN","IBNCPDPH",118,0)
 ..S IBBILL0=$G(^DGCR(399,IBBILL,0)) D CK4 Q:'IBOK
"RTN","IBNCPDPH",119,0)
 ..S ^TMP($J,"IB",-DATE,IBNX,IBBILL)=""
"RTN","IBNCPDPH",120,0)
 Q
"RTN","IBNCPDPH",121,0)
RX ; rx refill bills
"RTN","IBNCPDPH",122,0)
 Q:'IBIBRX
"RTN","IBNCPDPH",123,0)
 S (IBRX,IBRXN,IBRF,IBRDT)=0
"RTN","IBNCPDPH",124,0)
 I $P(IBND,"^",4)'["52:" Q
"RTN","IBNCPDPH",125,0)
 ;
"RTN","IBNCPDPH",126,0)
 S IBRXN=$P($P(IBND,"^",4),":",2),IBRX=$P($P(IBND,"^",8),"-"),IBRF=$P($P(IBND,"^",4),":",3)
"RTN","IBNCPDPH",127,0)
 ;
"RTN","IBNCPDPH",128,0)
 I +IBRF>0 S IBRDT=$$SUBFILE^IBRXUTL(+IBRXN,IBRF,52,.01)
"RTN","IBNCPDPH",129,0)
 I +IBRF=0 S IBRDT=$$FILE^IBRXUTL(+IBRXN,22)
"RTN","IBNCPDPH",130,0)
 ;
"RTN","IBNCPDPH",131,0)
 Q:(IBRX="")!('IBRDT)
"RTN","IBNCPDPH",132,0)
 N X,IBBILL,IBBILL0,IBFILL,IBFILL0,IBOK S IBBILL=0
"RTN","IBNCPDPH",133,0)
 S IBFILL=0 F  S IBFILL=$O(^IBA(362.4,"B",IBRX,IBFILL)) Q:IBFILL=""  D
"RTN","IBNCPDPH",134,0)
 .S IBFILL0=$G(^IBA(362.4,IBFILL,0)) I $P(IBFILL0,"^",3)'=IBRDT Q
"RTN","IBNCPDPH",135,0)
 .S IBBILL=+$P(IBFILL0,"^",2) I 'IBBILL Q
"RTN","IBNCPDPH",136,0)
 .S IBBILL0=$G(^DGCR(399,IBBILL,0)) D CK4 I 'IBOK Q
"RTN","IBNCPDPH",137,0)
 .S ^TMP($J,"IB",-DATE,IBNX,IBBILL)=""
"RTN","IBNCPDPH",138,0)
 Q
"RTN","IBNCPDPI")
0^1^B7116772
"RTN","IBNCPDPI",1,0)
IBNCPDPI ;DALOI/SS - ECME SCREEN INSURANCE VIEW AND UTILITIES ;3/6/08  16:21
"RTN","IBNCPDPI",2,0)
 ;;2.0;INTEGRATED BILLING;**276,383,384**;21-MAR-94;Build 74
"RTN","IBNCPDPI",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBNCPDPI",4,0)
 ;
"RTN","IBNCPDPI",5,0)
 ;
"RTN","IBNCPDPI",6,0)
EN1(DFN) ;
"RTN","IBNCPDPI",7,0)
 I $G(DFN)'>0 Q
"RTN","IBNCPDPI",8,0)
 N J,POP,START,X,VA,ALMBG,DIC,DT,C,CTRLCOL,DILN
"RTN","IBNCPDPI",9,0)
 ;
"RTN","IBNCPDPI",10,0)
 ;if the user does have IB keys to edit insurances
"RTN","IBNCPDPI",11,0)
 I $D(^XUSEC("IB INSURANCE SUPERVISOR",DUZ))!($D(^XUSEC("IB INSURANCE COMPANY ADD",DUZ))) D  Q
"RTN","IBNCPDPI",12,0)
 . N D1,DA,DDER,DDH,DIE,DR,I
"RTN","IBNCPDPI",13,0)
 . N IBCH,IBCNS,IBCNSEH,IBCNT,IBCPOL,IBDT,IBDUZ,IBFILE,IBLCNT,IBN,IBNEW,IBPPOL
"RTN","IBNCPDPI",14,0)
 . N IBTYP,IBYE,IBCDFN,IBCDFND1,IBCGN
"RTN","IBNCPDPI",15,0)
 . D EN^VALM("IBNCPDP INSURANCE MANAGEMENT")
"RTN","IBNCPDPI",16,0)
 ;if the user doesn't have insurance IB keys
"RTN","IBNCPDPI",17,0)
 D
"RTN","IBNCPDPI",18,0)
 . N D0,IBCAB,IBCDFN,IBCDFND1,IBCNS,IBCNT,IBCPOL,IBDT,IBEXP1
"RTN","IBNCPDPI",19,0)
 . N IBEXP2,IBFILE,IBLCNT,IBN,IBPPOL
"RTN","IBNCPDPI",20,0)
 . D EN1^IBNCPDPV(DFN)
"RTN","IBNCPDPI",21,0)
 Q
"RTN","IBNCPDPI",22,0)
 ;
"RTN","IBNCPDPI",23,0)
INIT ; -- set up initial variables
"RTN","IBNCPDPI",24,0)
 ;DFN should be defined
"RTN","IBNCPDPI",25,0)
 I '$D(DFN) Q
"RTN","IBNCPDPI",26,0)
 S U="^",VALMCNT=0,VALMBG=1
"RTN","IBNCPDPI",27,0)
 K ^TMP("IBNSM",$J),^TMP("IBNSMDX",$J)
"RTN","IBNCPDPI",28,0)
 S IBTYP="P"
"RTN","IBNCPDPI",29,0)
 D BLD^IBCNSM
"RTN","IBNCPDPI",30,0)
 Q
"RTN","IBNCPDPI",31,0)
 ;
"RTN","IBNCPDPI",32,0)
HDR ; -- screen header for initial screen
"RTN","IBNCPDPI",33,0)
 D HDR^IBCNSM
"RTN","IBNCPDPI",34,0)
 Q
"RTN","IBNCPDPI",35,0)
 ;
"RTN","IBNCPDPI",36,0)
HELP ; -- help code
"RTN","IBNCPDPI",37,0)
 Q
"RTN","IBNCPDPI",38,0)
 ;
"RTN","IBNCPDPI",39,0)
EXIT ; -- exit code
"RTN","IBNCPDPI",40,0)
 Q
"RTN","IBNCPDPI",41,0)
 ;
"RTN","IBNCPDPI",42,0)
EXPND ; -- expand code
"RTN","IBNCPDPI",43,0)
 Q
"RTN","IBNCPDPI",44,0)
 ;
"RTN","IBNCPDPI",45,0)
SELINSUR(PRMTMSG,DFLTVAL) ;
"RTN","IBNCPDPI",46,0)
 ;API for ECME (DBIA #4721)
"RTN","IBNCPDPI",47,0)
 ;Insurance Company lookup API
"RTN","IBNCPDPI",48,0)
 ;input:
"RTN","IBNCPDPI",49,0)
 ; PRMTMSG - prompt message
"RTN","IBNCPDPI",50,0)
 ; DFLTVAL - INSURANCE NAME as a default value for the prompt (optional)
"RTN","IBNCPDPI",51,0)
 ;output:
"RTN","IBNCPDPI",52,0)
 ; IEN^INSURANCE_NAME
"RTN","IBNCPDPI",53,0)
 ;   0^  means ALL selected
"RTN","IBNCPDPI",54,0)
 ;  -1^  nothing was selected, timeout expired or uparrow entered
"RTN","IBNCPDPI",55,0)
 ; where: IEN is record number in file #36.
"RTN","IBNCPDPI",56,0)
 ;
"RTN","IBNCPDPI",57,0)
 N Y,DUOUT,DTOUT,IBQUIT,DIROUT
"RTN","IBNCPDPI",58,0)
 S IBQUIT=0
"RTN","IBNCPDPI",59,0)
 N DIC
"RTN","IBNCPDPI",60,0)
 S DIC="^DIC(36,"
"RTN","IBNCPDPI",61,0)
 S DIC(0)="AEMNQ"
"RTN","IBNCPDPI",62,0)
 S:$L($G(DFLTVAL))>0 DIC("B")=DFLTVAL
"RTN","IBNCPDPI",63,0)
 S DIC("A")=PRMTMSG_": "
"RTN","IBNCPDPI",64,0)
 D ^DIC
"RTN","IBNCPDPI",65,0)
 I (Y=-1)!$D(DUOUT)!$D(DTOUT) S IBQUIT=1
"RTN","IBNCPDPI",66,0)
 I IBQUIT=1 Q "-1^"
"RTN","IBNCPDPI",67,0)
 Q Y
"RTN","IBNCPDPI",68,0)
 ;
"RTN","IBNCPDPI",69,0)
 ;
"RTN","IBNCPDPI",70,0)
BILLINFO(IBRX,IBREF) ;
"RTN","IBNCPDPI",71,0)
 ;API for ECME (DBIA #4729)
"RTN","IBNCPDPI",72,0)
 ;Determine Bill# and Account Receivable information about the bill
"RTN","IBNCPDPI",73,0)
 ;input:
"RTN","IBNCPDPI",74,0)
 ; IBRX - pointer to file #52 (internal prescription number)
"RTN","IBNCPDPI",75,0)
 ; IBREF - re-fill number
"RTN","IBNCPDPI",76,0)
 ;output:
"RTN","IBNCPDPI",77,0)
 ;Returns a string of information about the bill requested:
"RTN","IBNCPDPI",78,0)
 ; piece #1:  Bill number (field(#.01) of file (#399))
"RTN","IBNCPDPI",79,0)
 ; piece #2:  Original Amount of bill
"RTN","IBNCPDPI",80,0)
 ; piece #3:  Current Status (pointer to file #430.3)
"RTN","IBNCPDPI",81,0)
 ; piece #4:  Current Balance
"RTN","IBNCPDPI",82,0)
 ; piece #5:  Total Collected
"RTN","IBNCPDPI",83,0)
 ; piece #6:  % Collected Returns null if no data or bill found.
"RTN","IBNCPDPI",84,0)
 ;
"RTN","IBNCPDPI",85,0)
 N IBIEN,IBBNUM,RCRET,IBRETV
"RTN","IBNCPDPI",86,0)
 S RCRET="",IBRETV=""
"RTN","IBNCPDPI",87,0)
 S IBBNUM=$$BILL^IBNCPDPU(IBRX,IBREF)
"RTN","IBNCPDPI",88,0)
 I IBBNUM]"" D
"RTN","IBNCPDPI",89,0)
 .S IBIEN=$O(^DGCR(399,"B",IBBNUM,"")) Q:IBIEN=""
"RTN","IBNCPDPI",90,0)
 .S RCRET=$$BILL^RCJIBFN2(IBIEN)
"RTN","IBNCPDPI",91,0)
 S IBRETV=IBBNUM_U_RCRET
"RTN","IBNCPDPI",92,0)
 Q IBRETV
"RTN","IBNCPDPI",93,0)
 ;
"RTN","IBNCPDPI",94,0)
 ;
"RTN","IBNCPDPI",95,0)
TPJI(DFN) ; entry point for TPJI option of the ECME User Screen
"RTN","IBNCPDPI",96,0)
 I DFN>0 D EN^IBJTLA
"RTN","IBNCPDPI",97,0)
 Q
"RTN","IBNCPDPI",98,0)
 ;
"RTN","IBNCPDPI",99,0)
INSNM(IBINSIEN) ; api to return insurance company name
"RTN","IBNCPDPI",100,0)
 Q $P($G(^DIC(36,+$G(IBINSIEN),0)),"^")
"RTN","IBNCPDPI",101,0)
 ;
"RTN","IBNCPDPI",102,0)
ACPHONE() ; API to return the agent cashier's phone number
"RTN","IBNCPDPI",103,0)
 Q $P($G(^IBE(350.9,1,2)),"^",6)
"RTN","IBNCPDPI",104,0)
 ;
"RTN","IBNCPDPI",105,0)
INSPL(IBPL) ; api to return the insurance company IEN from the plan
"RTN","IBNCPDPI",106,0)
 ; passed in.
"RTN","IBNCPDPI",107,0)
 Q $P($G(^IBA(355.3,+$G(IBPL),0)),"^")
"RTN","IBNCPDPI",108,0)
 ;
"RTN","IBNCPDPI",109,0)
MXTRNS(IBPLID) ; api to return MAXIMUM NCPDP TRANSACTIONS for a plan
"RTN","IBNCPDPI",110,0)
 ; Input: IBPLID = ID from the PLAN file.
"RTN","IBNCPDPI",111,0)
 ; Returns: Numeric value from field 10.1 of Plan file
"RTN","IBNCPDPI",112,0)
 ;          Default's to 1 if undefined.
"RTN","IBNCPDPI",113,0)
 Q:IBPLID="" 1
"RTN","IBNCPDPI",114,0)
 Q:$O(^IBCNR(366.03,"B",$G(IBPLID),0))']"" 1
"RTN","IBNCPDPI",115,0)
 Q $P($G(^IBCNR(366.03,$O(^IBCNR(366.03,"B",$G(IBPLID),0)),10)),"^",10)
"RTN","IBNCPDPI",116,0)
 ;
"RTN","IBNCPDPI",117,0)
EPHON() ; API to return if ePhamracy is on within IB
"RTN","IBNCPDPI",118,0)
 ;   1 FOR Active
"RTN","IBNCPDPI",119,0)
 ;   0 FOR Not Active
"RTN","IBNCPDPI",120,0)
 ;
"RTN","IBNCPDPI",121,0)
 Q +$G(^IBE(350.9,1,11))
"RTN","IBNCPDPI",122,0)
 ;
"RTN","IBNCPDPL")
0^29^B647455
"RTN","IBNCPDPL",1,0)
IBNCPDPL ;DALOI/SS - for ECME RESEARCH SCREEN ELIGIBILITY VIEW ;3/6/08  16:22
"RTN","IBNCPDPL",2,0)
 ;;2.0;INTEGRATED BILLING;**276,384**;21-MAR-94;Build 74
"RTN","IBNCPDPL",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBNCPDPL",4,0)
 ;
"RTN","IBNCPDPL",5,0)
EN ;
"RTN","IBNCPDPL",6,0)
 Q
"RTN","IBNCPDPL",7,0)
 ;
"RTN","IBNCPDPL",8,0)
 ; -- main entry point for IBNCPDP LSTMN ELIGIBILITY
"RTN","IBNCPDPL",9,0)
 ;entry point for ECME "VE View Eligibility" menu option
"RTN","IBNCPDPL",10,0)
 ;of the main ECME User Screen
"RTN","IBNCPDPL",11,0)
EN1(DFN) ;
"RTN","IBNCPDPL",12,0)
 I $G(DFN)>0 D EN^VALM("IBNCPDP LSTMN ELIGIBILITY")
"RTN","IBNCPDPL",13,0)
 Q
"RTN","IBNCPDPL",14,0)
 ;
"RTN","IBNCPDPL",15,0)
HDR ; -- header code
"RTN","IBNCPDPL",16,0)
 D HDR^IBJTEA
"RTN","IBNCPDPL",17,0)
 Q
"RTN","IBNCPDPL",18,0)
 ;
"RTN","IBNCPDPL",19,0)
INIT ; -- init variables and list array
"RTN","IBNCPDPL",20,0)
 ;D INIT^IBJTEA
"RTN","IBNCPDPL",21,0)
 ;borrowed from INIT^IBJTEA with some changes
"RTN","IBNCPDPL",22,0)
 K ^TMP("IBJTEA",$J)
"RTN","IBNCPDPL",23,0)
 I '$G(DFN) S VALMQUIT="" Q
"RTN","IBNCPDPL",24,0)
 D BLD^IBJTEA
"RTN","IBNCPDPL",25,0)
 Q
"RTN","IBNCPDPL",26,0)
 ;
"RTN","IBNCPDPL",27,0)
HELP ; -- help code
"RTN","IBNCPDPL",28,0)
 D HELP^IBJTEA
"RTN","IBNCPDPL",29,0)
 Q
"RTN","IBNCPDPL",30,0)
 ;
"RTN","IBNCPDPL",31,0)
EXIT ; -- exit code
"RTN","IBNCPDPL",32,0)
 D EXIT^IBJTEA
"RTN","IBNCPDPL",33,0)
 Q
"RTN","IBNCPDPL",34,0)
 ;
"RTN","IBNCPDPL",35,0)
EXPND ; -- expand code
"RTN","IBNCPDPL",36,0)
 Q
"RTN","IBNCPDPL",37,0)
 ;
"RTN","IBNCPDPR")
0^30^B26651365
"RTN","IBNCPDPR",1,0)
IBNCPDPR ;WOIFO/SS - ECME RELEASE CHARGES ON HOLD ;3/6/08  16:23
"RTN","IBNCPDPR",2,0)
 ;;2.0;INTEGRATED BILLING;**276,347,384**;21-MAR-94;Build 74
"RTN","IBNCPDPR",3,0)
 ;; Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBNCPDPR",4,0)
 Q
"RTN","IBNCPDPR",5,0)
 ;==========
"RTN","IBNCPDPR",6,0)
 ;version of "IB MT RELEASE CHARGES" option (^IBREL) without PATIENT prompt
"RTN","IBNCPDPR",7,0)
 ;(patient is selected from the User Screen)
"RTN","IBNCPDPR",8,0)
 ;designed to use from ECME User Screen (IA #) in order to access Release
"RTN","IBNCPDPR",9,0)
 ;copay functionality from ECME
"RTN","IBNCPDPR",10,0)
 ;
"RTN","IBNCPDPR",11,0)
RELH(DFN,IBRXIEN,IBREFL,IBMODE) ;
"RTN","IBNCPDPR",12,0)
 K IBA,PRCABN,BPX,IBI,IBCNT,IB350
"RTN","IBNCPDPR",13,0)
 S IB350=0
"RTN","IBNCPDPR",14,0)
 S IBI=0 F IBNUM=1:1 S IBI=$O(^IB("AH",DFN,IBI)) Q:'IBI  S IBA(IBNUM)=IBI
"RTN","IBNCPDPR",15,0)
 I '$D(IBA) W !!,"This patient does not have any charges 'on hold.'",! G ASK
"RTN","IBNCPDPR",16,0)
 ;
"RTN","IBNCPDPR",17,0)
 S IBPT=$$PT^IBEFUNC(DFN) W @IOF,$P(IBPT,"^"),"      Pt ID: ",$P(IBPT,"^",2),! S I="",$P(I,"-",80)="" W I K I
"RTN","IBNCPDPR",18,0)
 ;if the user selected specific RX/refill
"RTN","IBNCPDPR",19,0)
 I IBMODE="C" D  S:IB350>0 DIR("B")=$P(IB350,U,2)
"RTN","IBNCPDPR",20,0)
 . ;find item that matches selected RX/refill
"RTN","IBNCPDPR",21,0)
 . S IBCNT=0
"RTN","IBNCPDPR",22,0)
 . F  S IBCNT=$O(IBA(IBCNT)) Q:+IBCNT=0  D  Q:IB350>0
"RTN","IBNCPDPR",23,0)
 . . S BPX=$P($G(^IB(IBA(IBCNT),0)),U,4)
"RTN","IBNCPDPR",24,0)
 . . I $P(BPX,":")'=52 Q  ;if not RX type
"RTN","IBNCPDPR",25,0)
 . . I $P($P(BPX,";"),":",2)'=IBRXIEN Q  ;if not given RX#
"RTN","IBNCPDPR",26,0)
 . . I IBREFL>0 I $P($P(BPX,";",2),":",2)'=IBREFL Q  ;if not given refill #
"RTN","IBNCPDPR",27,0)
 . . S IB350=IBA(IBCNT)_"^"_IBCNT
"RTN","IBNCPDPR",28,0)
 ;
"RTN","IBNCPDPR",29,0)
 I IBMODE="C",IB350=0 D  G ASK
"RTN","IBNCPDPR",30,0)
 . W !!,"There is no copay charge 'on hold' for this Rx.",!
"RTN","IBNCPDPR",31,0)
 . D PAUSE^VALM1
"RTN","IBNCPDPR",32,0)
 D RESUME
"RTN","IBNCPDPR",33,0)
 Q
"RTN","IBNCPDPR",34,0)
 ;
"RTN","IBNCPDPR",35,0)
 ;
"RTN","IBNCPDPR",36,0)
ASK ;stub for  ASK
"RTN","IBNCPDPR",37,0)
 Q
"RTN","IBNCPDPR",38,0)
 ;
"RTN","IBNCPDPR",39,0)
 ;the following code was borrowed from IBRREL without changes.
"RTN","IBNCPDPR",40,0)
 ;This was done to avoid code changes in the original code and
"RTN","IBNCPDPR",41,0)
 ;re-testing it in IB package
"RTN","IBNCPDPR",42,0)
 ; - display header and list charges
"RTN","IBNCPDPR",43,0)
RESUME W !!,"The following IB Actions ",$S($D(PRCABN):"associated with this bill",1:"for this patient")," are ON HOLD:" D HDR
"RTN","IBNCPDPR",44,0)
 S IBQ=0 F IBNUM=1:1 Q:'$D(IBA(IBNUM))  D:'(IBNUM#15)  Q:IBQ  S IBN=IBA(IBNUM) D LST
"RTN","IBNCPDPR",45,0)
 . R !,"Enter RETURN to continue or '^' to stop: ",X:DTIME S:X["^"!('$T) IBQ=1 Q
"RTN","IBNCPDPR",46,0)
 ;
"RTN","IBNCPDPR",47,0)
 ; - prompt user to select IB Actions
"RTN","IBNCPDPR",48,0)
 S DIR(0)="LA^1:"_(IBNUM-1)_"^K:X[""."" X",DIR("A")="Select IB Action"_$E("s",IBNUM>2)_" (REF #) to release (or '^' to exit): ",DIR("?")="^D HELP^IBRREL"
"RTN","IBNCPDPR",49,0)
 W ! D ^DIR K DIR I $D(DIRUT)!($D(DUOUT)) G END:$D(PRCABN) D END W ! G ASK
"RTN","IBNCPDPR",50,0)
 ;
"RTN","IBNCPDPR",51,0)
 S IBRANGE=Y,IBSEQNO=1,IBDUZ=DUZ
"RTN","IBNCPDPR",52,0)
 ;
"RTN","IBNCPDPR",53,0)
 S DIR(0)="Y",DIR("A")="OK to pass "_$S($P(Y,",",2):"these charges",1:"this charge")_" to Accounts Receivable"
"RTN","IBNCPDPR",54,0)
 D ^DIR K DIR I 'Y!($D(DIRUT))!($D(DUOUT)) G END:$D(PRCABN) D END W ! G ASK
"RTN","IBNCPDPR",55,0)
 ;
"RTN","IBNCPDPR",56,0)
 ; - pass charges to Accounts Receivable
"RTN","IBNCPDPR",57,0)
 W !!,"Passing charges to Accounts Receivable...",! D HDR
"RTN","IBNCPDPR",58,0)
 F IBCTR=1:1 S IBNUM=$P(IBRANGE,",",IBCTR) Q:'IBNUM  I $D(IBA(IBNUM)) S IBNOS=IBA(IBNUM) D ^IBR,ERR:Y<1 I Y>0 S IBN=IBA(IBNUM) D LST
"RTN","IBNCPDPR",59,0)
 W !!,"The charge"_$E("s",$P(IBRANGE,",",2)>0)_" listed above "_$S($P(IBRANGE,",",2):"have",1:"has")_" been passed to Accounts Receivable.",!
"RTN","IBNCPDPR",60,0)
 ;
"RTN","IBNCPDPR",61,0)
 I '$D(PRCABN) W !! S DIR(0)="E" D ^DIR K DIR D END W ! G ASK
"RTN","IBNCPDPR",62,0)
 ;
"RTN","IBNCPDPR",63,0)
END K DIC,DIRUT,DUOUT,DTOUT,IBA,IBAFY,IBARTYP,IBATYP,IBCTR,IBN,IBDA,IBDUZ
"RTN","IBNCPDPR",64,0)
 K IBFAC,IBI,IBIL,IBRANGE,IBNOS,IBNUM,IBPT,IBQ,IBSEQNO,IBSERV,IBSITE
"RTN","IBNCPDPR",65,0)
 K IBTOTL,IBTRAN,IBWHER,VA,VAERR,VADM
"RTN","IBNCPDPR",66,0)
 K:'$D(PRCABN) DFN
"RTN","IBNCPDPR",67,0)
 ;***
"RTN","IBNCPDPR",68,0)
 ;I $D(XRT0) S:'$D(XRTN) XRTN="IBRREL" D T1^%ZOSV ;stop rt clock
"RTN","IBNCPDPR",69,0)
 Q
"RTN","IBNCPDPR",70,0)
 ;
"RTN","IBNCPDPR",71,0)
 ;
"RTN","IBNCPDPR",72,0)
HDR ; Display charge header.
"RTN","IBNCPDPR",73,0)
 N IBLINE S $P(IBLINE,"=",81)=""
"RTN","IBNCPDPR",74,0)
 W !,IBLINE,!," REF   Action ID  Bill Type",?42,"Bill #",?51,"Fr/Fl Dt",?61,"To/Rls Dt",?73,"Charge"
"RTN","IBNCPDPR",75,0)
 W !,IBLINE Q
"RTN","IBNCPDPR",76,0)
 ;
"RTN","IBNCPDPR",77,0)
LST ; Display individual IB Action.
"RTN","IBNCPDPR",78,0)
 N IBND,IBND1,IBRXN,IBRX,IBRF,IBRDT,IENS
"RTN","IBNCPDPR",79,0)
 S IBND=$G(^IB(IBN,0)),IBND1=$G(^IB(IBN,1)),(IBRXN,IBRX,IBRF,IBRDT)=0
"RTN","IBNCPDPR",80,0)
 I $P(IBND,"^",4)["52:" S IBRXN=$P($P(IBND,"^",4),":",2),IBRX=$P($P(IBND,"^",8),"-"),IBRF=$P($P(IBND,"^",4),":",3)
"RTN","IBNCPDPR",81,0)
 I $P(IBND,"^",4)["52:"  D
"RTN","IBNCPDPR",82,0)
 .I IBRF>0 S IENS=+IBRF,IBRDT=$$SUBFILE^IBRXUTL(+IBRXN,+IENS,52,.01)
"RTN","IBNCPDPR",83,0)
 .E  S IENS=+IBRXN,IBRDT=$$FILE^IBRXUTL(+IENS,22)
"RTN","IBNCPDPR",84,0)
 W !?1,$J(IBNUM,2),?7,$J(+IBND,9)
"RTN","IBNCPDPR",85,0)
 W ?18,$S(IBRXN>0:"Rx #: "_IBRX_$S(IBRF>0:"("_IBRF_")",1:""),1:$P($G(^IBE(350.1,+$P(IBND,"^",3),0)),"^",8))
"RTN","IBNCPDPR",86,0)
 W ?42,$P($P(IBND,"^",11),"-",2)
"RTN","IBNCPDPR",87,0)
 W ?51,$$DAT1^IBOUTL($S(IBRXN>0:IBRDT,1:$P(IBND,"^",14)))
"RTN","IBNCPDPR",88,0)
 W ?61,$$DAT1^IBOUTL($S($P(IBND,"^",15)'="":($P(IBND,"^",15)),1:$P(IBND1,"^",2)))
"RTN","IBNCPDPR",89,0)
 W ?70,$J(+$P(IBND,"^",7),9,2)
"RTN","IBNCPDPR",90,0)
 Q
"RTN","IBNCPDPR",91,0)
 ;
"RTN","IBNCPDPR",92,0)
ERR ; Display error message.
"RTN","IBNCPDPR",93,0)
 W !?1,$J(IBNUM,2),?7,"Error encountered - a separate bulletin has been posted"
"RTN","IBNCPDPR",94,0)
 Q
"RTN","IBNCPDPR",95,0)
 ;
"RTN","IBNCPDPR",96,0)
HLP ; Display basic help message.
"RTN","IBNCPDPR",97,0)
 W !!,"Enter:    the name of a patient with charges 'on hold,' or"
"RTN","IBNCPDPR",98,0)
 W !?10,"'??' --  to see all patients with charges 'on hold,' or"
"RTN","IBNCPDPR",99,0)
 W !?10,"'^'  --  to quit this option.",!
"RTN","IBNCPDPR",100,0)
 Q
"RTN","IBNCPDPR",101,0)
 ;
"RTN","IBNCPDPR",102,0)
HLP1 ; Display all patients with charges 'on hold.'
"RTN","IBNCPDPR",103,0)
 N DFN,I,IBQ,PID
"RTN","IBNCPDPR",104,0)
 W !!,"The following patients have charges 'on hold:'"
"RTN","IBNCPDPR",105,0)
 S (DFN,IBQ)=0 F I=1:1 S DFN=$O(^IB("AH",DFN)) Q:'DFN  D:'(I#15)  Q:IBQ  S PID=$$PT^IBEFUNC(DFN) W !?3,$P(PID,"^"),$J("",10),$P(PID,"^",2)
"RTN","IBNCPDPR",106,0)
 . R !,"Enter RETURN to continue or '^' to stop: ",X:DTIME S:X["^"!('$T) IBQ=1 Q
"RTN","IBNCPDPR",107,0)
 W ! Q
"RTN","IBNCPDPR",108,0)
 ;
"RTN","IBNCPDPR",109,0)
HELP ; Help for the 'Select' prompt.
"RTN","IBNCPDPR",110,0)
 W !!?4,"Please enter a list or range of IB Actions (i.e. 1,3,5 or 2-4,8), none"
"RTN","IBNCPDPR",111,0)
 W !?4,"greater than ",IBNUM-1,", to be passed to Accounts Receivable, or '^' to quit."
"RTN","IBNCPDPR",112,0)
 Q
"RTN","IBNCPDPR",113,0)
 ;
"RTN","IBNCPDPR",114,0)
 ;
"RTN","IBNCPDPR",115,0)
AR ; Accounts Receivable entry point to release charges.
"RTN","IBNCPDPR",116,0)
 ;   Input: PRCABN -- ien of Bill/Accounts Receivable
"RTN","IBNCPDPR",117,0)
 Q:$D(PRCABN)[0  Q:'$$IB^IBRUTL(PRCABN,1)  G RESUME
"RTN","IBNCPDPR",118,0)
 ;
"RTN","IBNCPDPU")
0^20^B71731167
"RTN","IBNCPDPU",1,0)
IBNCPDPU ;OAK/ELZ - UTILITIES FOR NCPCP ;5/22/08  15:24
"RTN","IBNCPDPU",2,0)
 ;;2.0;INTEGRATED BILLING;**223,276,347,383,405,384**;21-MAR-94;Build 74
"RTN","IBNCPDPU",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBNCPDPU",4,0)
 ;
"RTN","IBNCPDPU",5,0)
 ;IA 4702
"RTN","IBNCPDPU",6,0)
 ;
"RTN","IBNCPDPU",7,0)
 ;
"RTN","IBNCPDPU",8,0)
CT(DFN,IBRXN,IBFIL,IBADT,IBRMARK) ; files in claims tracking
"RTN","IBNCPDPU",9,0)
 ; Input:
"RTN","IBNCPDPU",10,0)
 ;  DFN - Patient IEN
"RTN","IBNCPDPU",11,0)
 ;  IBRXN - Rx IEN
"RTN","IBNCPDPU",12,0)
 ;  IBFIL - Fill#
"RTN","IBNCPDPU",13,0)
 ;  IBADT - Fill Date
"RTN","IBNCPDPU",14,0)
 ;  IBRMARK - Non-billable Reason (.01 from 356.8)
"RTN","IBNCPDPU",15,0)
 ;
"RTN","IBNCPDPU",16,0)
 N DIE,DR,DA,IBRXTYP,IBEABD
"RTN","IBNCPDPU",17,0)
  ; Check that the Fill Date is current
"RTN","IBNCPDPU",18,0)
 I IBTRKRN,$G(IBADT),($G(IBADT)'=$P(^IBT(356,IBTRKRN,0),U,6)) D
"RTN","IBNCPDPU",19,0)
 . S DIE="^IBT(356,",DA=IBTRKRN,DR=".06////"_IBADT D ^DIE
"RTN","IBNCPDPU",20,0)
 I IBTRKRN D:$D(IBRMARK)  Q
"RTN","IBNCPDPU",21,0)
 . S DIE="^IBT(356,",DA=IBTRKRN,DR=".19///"_IBRMARK
"RTN","IBNCPDPU",22,0)
 . D ^DIE
"RTN","IBNCPDPU",23,0)
 ; event type pointer for rx billing
"RTN","IBNCPDPU",24,0)
 S IBRXTYP=$O(^IBE(356.6,"AC",4,0))
"RTN","IBNCPDPU",25,0)
 ; earliest auto-billing date
"RTN","IBNCPDPU",26,0)
 S IBEABD=$$EABD^IBTUTL(IBRXTYP,$$FMADD^XLFDT(IBADT,60))
"RTN","IBNCPDPU",27,0)
 ; space out earliest auto bill date
"RTN","IBNCPDPU",28,0)
 ;
"RTN","IBNCPDPU",29,0)
 ; ROI check
"RTN","IBNCPDPU",30,0)
 N IBSCROI,IBDRUG,IBDEA,IBRXDATA
"RTN","IBNCPDPU",31,0)
 S IBRXDATA=$$RXZERO^IBRXUTL(DFN,IBRXN)
"RTN","IBNCPDPU",32,0)
 S IBDRUG=$P(IBRXDATA,"^",6)
"RTN","IBNCPDPU",33,0)
 D ZERO^IBRXUTL(IBDRUG)
"RTN","IBNCPDPU",34,0)
 S IBDEA=$G(^TMP($J,"IBDRUG",+IBDRUG,3))
"RTN","IBNCPDPU",35,0)
 K ^TMP($J,"IBDRUG")
"RTN","IBNCPDPU",36,0)
 I $G(IBDEA)["U" D
"RTN","IBNCPDPU",37,0)
 . N IBINS,IBFLG,IBINSP
"RTN","IBNCPDPU",38,0)
 . D ALL^IBCNS1(DFN,"IBINS",1,IBADT,1)
"RTN","IBNCPDPU",39,0)
 . S IBINSP=$O(IBINS("S",1,99),-1) Q:IBINSP=""
"RTN","IBNCPDPU",40,0)
 . S IBFLG=$$ROI^IBNCPDR4(DFN,$G(IBDRUG),+$G(IBINS(IBINSP,"0")),$G(IBADT))
"RTN","IBNCPDPU",41,0)
 . I 'IBFLG,$G(IBRMARK)="" S IBRMARK="REFUSES TO SIGN RELEASE (ROI)"
"RTN","IBNCPDPU",42,0)
 . I 'IBFLG S IBSCROI=3
"RTN","IBNCPDPU",43,0)
 . I IBFLG S IBSCROI=2
"RTN","IBNCPDPU",44,0)
 ;
"RTN","IBNCPDPU",45,0)
 D REFILL^IBTUTL1(DFN,IBRXTYP,IBADT,IBRXN,IBFIL,$G(IBRMARK),IBEABD,$G(IBSCROI))
"RTN","IBNCPDPU",46,0)
 Q
"RTN","IBNCPDPU",47,0)
 ;
"RTN","IBNCPDPU",48,0)
 ;NDC relocated to IBNCPNB
"RTN","IBNCPDPU",49,0)
 ;
"RTN","IBNCPDPU",50,0)
FILL(X,LEN) ; Zero-fill, right justified.
"RTN","IBNCPDPU",51,0)
 N Y
"RTN","IBNCPDPU",52,0)
 S:'$G(LEN) LEN=1
"RTN","IBNCPDPU",53,0)
 S Y=$E($G(X),1,LEN)
"RTN","IBNCPDPU",54,0)
 F  Q:$L(Y)>(LEN-1)  S Y="0"_Y
"RTN","IBNCPDPU",55,0)
 Q Y
"RTN","IBNCPDPU",56,0)
 ;
"RTN","IBNCPDPU",57,0)
PLANN(DFN,IBX,IBADT) ; returns the ien in the insurance multiple for the given plan
"RTN","IBNCPDPU",58,0)
 ; /patient privided.
"RTN","IBNCPDPU",59,0)
 ;   ien in multiple^insurance co ien
"RTN","IBNCPDPU",60,0)
 N IBPOL,IBY,IBR
"RTN","IBNCPDPU",61,0)
 S IBR=""
"RTN","IBNCPDPU",62,0)
 D ALL^IBCNS1(DFN,"IBPOL",3,IBADT)
"RTN","IBNCPDPU",63,0)
 S IBY=0 F  S IBY=$O(IBPOL(IBY)) Q:IBY<1!(IBR)  I $P(IBPOL(IBY,0),"^",18)=IBX S IBR=$P(IBPOL(IBY,0),"^")_"^"_IBY
"RTN","IBNCPDPU",64,0)
 Q IBR
"RTN","IBNCPDPU",65,0)
 ;
"RTN","IBNCPDPU",66,0)
RT(DFN,IBINS,IBN) ; returns rate type to use for bill
"RTN","IBNCPDPU",67,0)
 ; pass in insurance by ref and which insurance entry to use
"RTN","IBNCPDPU",68,0)
 ; if '$d(ibn) then it loops through to find the first one
"RTN","IBNCPDPU",69,0)
 ; format is RT (ien) ^ Rate Type (Tort or Awp or Cost) ^ Eligibility Basis (V=vet, T=tricare)
"RTN","IBNCPDPU",70,0)
 N VAEL,VAERR,IBPT,IBRT,IBX,IBE,IBI
"RTN","IBNCPDPU",71,0)
 D ELIG^VADPT
"RTN","IBNCPDPU",72,0)
 ;
"RTN","IBNCPDPU",73,0)
 ; if primary elig is vet type, use reimbursable
"RTN","IBNCPDPU",74,0)
 S IBPT=$P($G(^DIC(8,+VAEL(1),0)),"^",5) ; = N:NON-VETERAN;Y:VETERAN
"RTN","IBNCPDPU",75,0)
 I IBPT="Y" S IBRT=$O(^DGCR(399.3,"B","REIMBURSABLE INS.",0)) Q $S(IBRT:IBRT,1:8)_"^T^V"
"RTN","IBNCPDPU",76,0)
 ;
"RTN","IBNCPDPU",77,0)
 ; if patient is only Tricare elig and only Tricare ins bill for Tricare
"RTN","IBNCPDPU",78,0)
 ; ia #'s 427 & 2516
"RTN","IBNCPDPU",79,0)
 ;  -  determine eligibilities
"RTN","IBNCPDPU",80,0)
 S IBE=$P($G(^DIC(8.1,+$P($G(^DIC(8,+VAEL(1),0)),"^",9),0)),"^"),IBE($S(IBE="TRICARE"!(IBE="SHARING AGREEMENT"):"T",IBE="CHAMPVA":"C",1:"O"))=""
"RTN","IBNCPDPU",81,0)
 S IBX=0 F  S IBX=$O(VAEL(1,IBX)) Q:'IBX  S IBE=$P($G(^DIC(8.1,+$P($G(^DIC(8,+VAEL(1,IBX),0)),"^",9),0)),"^") S IBE($S(IBE="TRICARE"!(IBE="SHARING AGREEMENT"):"T",IBE="CHAMPVA":"C",1:"O"))=""
"RTN","IBNCPDPU",82,0)
 ;  -  determine insurance policies
"RTN","IBNCPDPU",83,0)
 S IBX=0 F  S IBX=$O(IBINS(IBX)) Q:'IBX  S IBI=$P($G(^IBE(355.1,+$P($G(IBINS(IBX,355.3)),"^",9),0)),"^") S IBI($S(IBI="TRICARE":"T",IBI="CHAMPVA":"C",1:"O"))=""
"RTN","IBNCPDPU",84,0)
 ;  -  tricare?
"RTN","IBNCPDPU",85,0)
 I $D(IBE("T")),'$D(IBE("O")),'$D(IBE("C")),$D(IBI("T")),'$D(IBI("O")),'$D(IBI("C")) S IBRT=$O(^DGCR(399.3,"B","TRICARE",0)) Q:IBRT IBRT_"^C^T"
"RTN","IBNCPDPU",86,0)
 ;
"RTN","IBNCPDPU",87,0)
 Q $S($D(IBRT):IBRT,1:"0^unable to determine rate type")
"RTN","IBNCPDPU",88,0)
 ;
"RTN","IBNCPDPU",89,0)
 ;
"RTN","IBNCPDPU",90,0)
 ; ********* temp code for tricare/champus ************** not currently used
"RTN","IBNCPDPU",91,0)
 ; if primary elig is TRICARE/CHAMPUS use one of the champus', depending
"RTN","IBNCPDPU",92,0)
 ; on insurance coverage
"RTN","IBNCPDPU",93,0)
 I $P($G(^DIC(8.1,+$P($G(^DIC(8,+VAEL(3),0)),"^",9),0)),"^")="TRICARE/CHAMPUS" S IBRT=$$UINS("CHAMPUS",.IBINS,.IBN)
"RTN","IBNCPDPU",94,0)
 ;
"RTN","IBNCPDPU",95,0)
 ; if primary elig is CHAMPVA use one of the champva's, depending
"RTN","IBNCPDPU",96,0)
 ; on insurance coverage
"RTN","IBNCPDPU",97,0)
 I $P($G(^DIC(8.1,+$P($G(^DIC(8,+VAEL(3),0)),"^",9),0)),"^")="CHAMPVA" S IBRT=$$UINS("CHAMPVA",.IBINS,.IBN)
"RTN","IBNCPDPU",98,0)
 ;
"RTN","IBNCPDPU",99,0)
 Q $S($D(IBRT):IBRT,1:"0^unable to determine rate type")
"RTN","IBNCPDPU",100,0)
 ;
"RTN","IBNCPDPU",101,0)
 ;
"RTN","IBNCPDPU",102,0)
UINS(IBT,IBINS,IBN) ; in the case of tricare or champva you may have to use
"RTN","IBNCPDPU",103,0)
 ; insurance different rate types insted of the actual tricare or champva
"RTN","IBNCPDPU",104,0)
 N IBRT
"RTN","IBNCPDPU",105,0)
 S IBN=+$G(IBN,$O(IBINS("S",+$O(IBINS("S",0)),0)))
"RTN","IBNCPDPU",106,0)
 I $P($G(^IBE(355.1,+$P($G(IBINS(IBN,355.3)),"^",9),0)),"^")=IBT S IBRT=$O(^DGCR(399.3,"B",IBT,0)),IBRT=$S(IBRT:IBRT_"^"_$S(IBT="CHAMPUS":"A",1:"C"),1:"0^"_IBT_" Rate type not found")
"RTN","IBNCPDPU",107,0)
 I '$D(IBRT) S IBRT=$O(^DGCR(399.3,"B",IBT_" REIMB. INS.",0)),IBRT=$S(IBRT:IBRT_"^"_$S(IBT="CHAMPUS":"A",1:"C"),1:"0^"_IBT_" REIMB. INS. Rate type not found")
"RTN","IBNCPDPU",108,0)
 Q IBRT
"RTN","IBNCPDPU",109,0)
 ;
"RTN","IBNCPDPU",110,0)
BS() ; returns the mccr utility to use
"RTN","IBNCPDPU",111,0)
 N IBX
"RTN","IBNCPDPU",112,0)
 S IBX=0 F  S IBX=$O(^DGCR(399.1,"B","PRESCRIPTION",IBX)) Q:IBX<1  I $P($G(^DGCR(399.1,+$G(IBX),0)),U,5) Q
"RTN","IBNCPDPU",113,0)
 Q IBX
"RTN","IBNCPDPU",114,0)
 ;
"RTN","IBNCPDPU",115,0)
 ; Match IB Bill by the 7-digit ECME number
"RTN","IBNCPDPU",116,0)
RXBIL(IBINP,IBERR) ; Matching NCPDP payments
"RTN","IBNCPDPU",117,0)
 ;Input:
"RTN","IBNCPDPU",118,0)
 ;   IBINP("ECME") - the 7-digit ECME number (Reference Number)
"RTN","IBNCPDPU",119,0)
 ;   IBINP("FILLDT")  - the Rx fill date, YYYYMMDD or FileMan format
"RTN","IBNCPDPU",120,0)
 ;   IBINP("PNM") (optional) - the patient's last name
"RTN","IBNCPDPU",121,0)
 ;Returns:
"RTN","IBNCPDPU",122,0)
 ;   IBERR (by ref) - the error code, or null string if found
"RTN","IBNCPDPU",123,0)
 ;   $$RXBIL - IB Bill IEN, or 0 if not matched
"RTN","IBNCPDPU",124,0)
 N IBKEY,IBECME,BILLDA,IBFOUND,IBMATCH,IBDAT,IBPNAME
"RTN","IBNCPDPU",125,0)
 S IBERR=""
"RTN","IBNCPDPU",126,0)
 S IBECME=$G(IBINP("ECME"))
"RTN","IBNCPDPU",127,0)
 I IBECME'?1.7N S IBERR="Invalid ECME number" Q 0
"RTN","IBNCPDPU",128,0)
 S IBDAT=$G(IBINP("FILLDT")) ; Rx fill date
"RTN","IBNCPDPU",129,0)
 I IBDAT?8N S IBDAT=($E(IBDAT,1,4)-1700)_$E(IBDAT,5,8) ; conv date to FM format
"RTN","IBNCPDPU",130,0)
 I IBDAT'?7N Q $$RXBILND(IBECME)  ; date is not correct or null
"RTN","IBNCPDPU",131,0)
 S IBPNAME=$G(IBINP("PNM")) ; patient's name (optional)
"RTN","IBNCPDPU",132,0)
 S IBKEY=+IBECME_";"_IBDAT ; The ECME Number (BC ID)
"RTN","IBNCPDPU",133,0)
 S BILLDA="",IBFOUND=0,IBMATCH=0
"RTN","IBNCPDPU",134,0)
 ; Search backward
"RTN","IBNCPDPU",135,0)
 F  S BILLDA=$O(^DGCR(399,"AG",IBKEY,BILLDA),-1) Q:BILLDA=""  D  Q:IBFOUND
"RTN","IBNCPDPU",136,0)
 . I 'BILLDA Q  ; IEN must be numeric
"RTN","IBNCPDPU",137,0)
 . I '$D(^DGCR(399,BILLDA,0)) Q  ; Corrupted index
"RTN","IBNCPDPU",138,0)
 . S IBMATCH=1
"RTN","IBNCPDPU",139,0)
 . I IBPNAME'="" I '$$TXMATCH($P(IBPNAME,","),$P($G(^DPT(+$P(^DGCR(399,BILLDA,0),U,2),0)),","),8) Q  ; Patient name doesn't match
"RTN","IBNCPDPU",140,0)
 . S IBFOUND=1
"RTN","IBNCPDPU",141,0)
 I 'BILLDA S IBERR=$S(IBMATCH:"Patient's name does not match",1:"Matching bill not found") ; not matched
"RTN","IBNCPDPU",142,0)
 Q +BILLDA
"RTN","IBNCPDPU",143,0)
 ;
"RTN","IBNCPDPU",144,0)
RXBILND(IBECME) ;Match the bill with no date
"RTN","IBNCPDPU",145,0)
 N IBKEY,IBBC,BILLDA,IBY,IBCUT
"RTN","IBNCPDPU",146,0)
 S IBKEY=+IBECME_";"
"RTN","IBNCPDPU",147,0)
 S IBCUT=$$FMADD^XLFDT(DT,-180) ; only 180 days in the past
"RTN","IBNCPDPU",148,0)
 S BILLDA=0
"RTN","IBNCPDPU",149,0)
 ; Search PRNT/TX forward
"RTN","IBNCPDPU",150,0)
 S IBBC=IBKEY_IBCUT
"RTN","IBNCPDPU",151,0)
 F  S IBBC=$O(^DGCR(399,"AG",IBBC)) Q:IBBC'[IBKEY  D  Q:BILLDA
"RTN","IBNCPDPU",152,0)
 . S IBY="" F  S IBY=$O(^DGCR(399,"AG",IBBC,IBY)) Q:'IBY  D  Q:BILLDA
"RTN","IBNCPDPU",153,0)
 .. I $P($G(^DGCR(399,+IBY,0)),U,13)'=4 Q  ; not PRNT/TX
"RTN","IBNCPDPU",154,0)
 .. S BILLDA=+IBY
"RTN","IBNCPDPU",155,0)
 I BILLDA Q BILLDA
"RTN","IBNCPDPU",156,0)
 ; Search ANY backward
"RTN","IBNCPDPU",157,0)
 S IBBC=IBKEY_"8000000"
"RTN","IBNCPDPU",158,0)
 F  S IBBC=$O(^DGCR(399,"AG",IBBC),-1) Q:IBBC'[IBKEY  Q:$P(IBBC,";",2)<IBCUT  D  Q:BILLDA
"RTN","IBNCPDPU",159,0)
 . S IBY="" F  S IBY=$O(^DGCR(399,"AG",IBBC,IBY),-1) Q:IBY=""  D  Q:BILLDA
"RTN","IBNCPDPU",160,0)
 .. ;I $P($G(^DGCR(399,+IBY,0)),U,13)'=7 Q  ; not CANCELLED
"RTN","IBNCPDPU",161,0)
 .. S BILLDA=+IBY
"RTN","IBNCPDPU",162,0)
 Q BILLDA
"RTN","IBNCPDPU",163,0)
 ;
"RTN","IBNCPDPU",164,0)
 ;Check matching of two strings - case insensitive, no spaces etc.
"RTN","IBNCPDPU",165,0)
TXMATCH(IBTXT1,IBTXT2,IBMAX) ;
"RTN","IBNCPDPU",166,0)
 N IBTR1,IBTR2,IBT1,IBT2
"RTN","IBNCPDPU",167,0)
 ;Checking only first IBMAX characters (long names may be trancated
"RTN","IBNCPDPU",168,0)
 S IBTR1="ABCDEFGHIJKLMNOPQRSTUVWXYZ:;"",'._()<>/\|@#$%&*-=!`~ "
"RTN","IBNCPDPU",169,0)
 S IBTR2="abcdefghijklmnopqrstuvwxyz"
"RTN","IBNCPDPU",170,0)
 S IBT1=$E($TR(IBTXT1,IBTR1,IBTR2),1,IBMAX)
"RTN","IBNCPDPU",171,0)
 S IBT2=$E($TR(IBTXT2,IBTR1,IBTR2),1,IBMAX)
"RTN","IBNCPDPU",172,0)
 Q IBT1=IBT2
"RTN","IBNCPDPU",173,0)
 ;
"RTN","IBNCPDPU",174,0)
ECMEBIL(DFN,IBADT) ; Is the pat ECME Billable (pharmacy coverage only)
"RTN","IBNCPDPU",175,0)
 ; DFN - ptr to the patient
"RTN","IBNCPDPU",176,0)
 ; IBADT  - the date
"RTN","IBNCPDPU",177,0)
 N IBANY,IBERMSG,IBX,IBINS,IBT,IBZ,IBRES,IBCAT,IBCOV,IBPCOV
"RTN","IBNCPDPU",178,0)
 S IBRES=0 ; Not ECME Billable by default
"RTN","IBNCPDPU",179,0)
 S (IBCOV,IBPCOV)=0
"RTN","IBNCPDPU",180,0)
 ; -- look up ins with Rx
"RTN","IBNCPDPU",181,0)
 D ALL^IBCNS1(DFN,"IBINS",1,IBADT,1)
"RTN","IBNCPDPU",182,0)
 S IBERMSG="" ; Error message
"RTN","IBNCPDPU",183,0)
 S IBCAT=$O(^IBE(355.31,"B","PHARMACY",0))
"RTN","IBNCPDPU",184,0)
 S IBX=0 F  S IBX=$O(IBINS("S",IBX)) Q:'IBX  D  Q:IBRES
"RTN","IBNCPDPU",185,0)
 . S IBT=0 F  S IBT=$O(IBINS("S",IBX,IBT)) Q:'IBT  D  Q:IBRES
"RTN","IBNCPDPU",186,0)
 . . N IBZ,IBPIEN,IBY,IBPL
"RTN","IBNCPDPU",187,0)
 . . S IBZ=$G(IBINS(IBT,0))
"RTN","IBNCPDPU",188,0)
 . . S IBPL=+$P(IBZ,U,18) Q:'IBPL
"RTN","IBNCPDPU",189,0)
 . . S IBCOV=1 ; covered
"RTN","IBNCPDPU",190,0)
 . . I '$$PLCOV^IBCNSU3(IBPL,IBADT,IBCAT) Q
"RTN","IBNCPDPU",191,0)
 . . S IBPCOV=1
"RTN","IBNCPDPU",192,0)
 . . S IBPIEN=+$G(^IBA(355.3,IBPL,6))
"RTN","IBNCPDPU",193,0)
 . . I 'IBPIEN S IBERMSG="Plan not linked to the Payer" Q  ; Not linked
"RTN","IBNCPDPU",194,0)
 . . D STCHK^IBCNRU1(IBPIEN,.IBY)
"RTN","IBNCPDPU",195,0)
 . . I $E($G(IBY(1)))'="A" S:IBERMSG="" IBERMSG=$$ERMSG^IBNCPNB($P($G(IBY(6)),",")) Q
"RTN","IBNCPDPU",196,0)
 . . S IBRES=1
"RTN","IBNCPDPU",197,0)
 I 'IBCOV Q "0^Not Insured"
"RTN","IBNCPDPU",198,0)
 I 'IBPCOV Q "0^No Pharmacy Coverage"
"RTN","IBNCPDPU",199,0)
 I 'IBRES,IBERMSG'="" Q "0^"_IBERMSG
"RTN","IBNCPDPU",200,0)
 I 'IBRES Q "0^No Insurance ECME billable"
"RTN","IBNCPDPU",201,0)
 ;
"RTN","IBNCPDPU",202,0)
 Q IBRES
"RTN","IBNCPDPU",203,0)
 ;
"RTN","IBNCPDPU",204,0)
SUBMIT(IBRX,IBFIL) ; Submit the Rx claim through ECME
"RTN","IBNCPDPU",205,0)
 ; IBRX - RX ien in file #52
"RTN","IBNCPDPU",206,0)
 ; IBFIL - Fill No (0 for orig fill)
"RTN","IBNCPDPU",207,0)
 N IBDT,IBNDC,IBX
"RTN","IBNCPDPU",208,0)
 I '$G(IBRX)!('$D(IBFIL)) Q "0^Invalid parameters."
"RTN","IBNCPDPU",209,0)
 S IBDT=$S('IBFIL:$$FILE^IBRXUTL(IBRX,22),1:$$SUBFILE^IBRXUTL(IBRX,IBFIL,52,.01))
"RTN","IBNCPDPU",210,0)
 S IBX=$$EN^BPSNCPDP(+IBRX,+IBFIL,IBDT,"BB")
"RTN","IBNCPDPU",211,0)
 I +IBX=0 D ECMEACT^PSOBPSU1(+IBRX,+IBFIL,"Claim submitted to 3rd party payer: IB BACK BILLING")
"RTN","IBNCPDPU",212,0)
 Q IBX
"RTN","IBNCPDPU",213,0)
 ;
"RTN","IBNCPDPU",214,0)
REASON(IBX,EXACT) ; Close Claim Reasons
"RTN","IBNCPDPU",215,0)
 Q $P($G(^IBE(356.8,+IBX,0)),U) ; non-billable reason
"RTN","IBNCPDPU",216,0)
 ;
"RTN","IBNCPDPU",217,0)
NABP(IBIFN) ;NABP Number
"RTN","IBNCPDPU",218,0)
 N IBY,IBTRKN,IBRX,IBFIL,IBZ,IBNABP
"RTN","IBNCPDPU",219,0)
 S IBY=+$O(^IBT(356.399,"C",IBIFN,0)) I 'IBY Q ""
"RTN","IBNCPDPU",220,0)
 S IBTRKN=$P($G(^IBT(356.399,IBY,0)),U) I 'IBTRKN Q ""
"RTN","IBNCPDPU",221,0)
 S IBZ=$G(^IBT(356,IBTRKN,0)) I IBZ="" Q ""
"RTN","IBNCPDPU",222,0)
 S IBRX=$P(IBZ,U,8)
"RTN","IBNCPDPU",223,0)
 S IBFIL=$P(IBZ,U,10)
"RTN","IBNCPDPU",224,0)
 S IBNABP=$$NABP^BPSBUTL(IBRX,IBFIL)
"RTN","IBNCPDPU",225,0)
 Q $S(IBNABP=0:"",1:IBNABP)
"RTN","IBNCPDPU",226,0)
 ;
"RTN","IBNCPDPU",227,0)
 ; Get the K-bill# from CT
"RTN","IBNCPDPU",228,0)
BILL(IBRX,IBFIL) ;
"RTN","IBNCPDPU",229,0)
 N IBTRKN,IBIFN
"RTN","IBNCPDPU",230,0)
 S IBTRKN=+$O(^IBT(356,"ARXFL",+$G(IBRX),+$G(IBFIL),""))
"RTN","IBNCPDPU",231,0)
 S IBIFN=+$P($G(^IBT(356,IBTRKN,0)),U,11)
"RTN","IBNCPDPU",232,0)
 Q $P($G(^DGCR(399,IBIFN,0)),U)
"RTN","IBNCPDPU",233,0)
 ;
"RTN","IBNCPDPU",234,0)
REJECT(IBECME,IBDATE) ; Is the e-claim rejected?
"RTN","IBNCPDPU",235,0)
 N IBINP,IBTRKRN,IBY
"RTN","IBNCPDPU",236,0)
 I IBECME'?1.7N Q 0
"RTN","IBNCPDPU",237,0)
 ;S IBINP("ECME")=IBECME
"RTN","IBNCPDPU",238,0)
 ;S IBINP("FILLDT")=IBDATE
"RTN","IBNCPDPU",239,0)
 ;I $$RXBIL(.IBINP) Q 0  ; bill exists
"RTN","IBNCPDPU",240,0)
 S IBTRKRN=+$O(^IBT(356,"AE",IBECME,0)) I 'IBTRKRN Q 0
"RTN","IBNCPDPU",241,0)
 S IBY=$G(^IBT(356,IBTRKRN,1))
"RTN","IBNCPDPU",242,0)
 I $P(IBY,U,11)>0 Q 1  ; Rejected or closed
"RTN","IBNCPDPU",243,0)
 Q 0
"RTN","IBNCPDPU",244,0)
 ;
"RTN","IBNCPDPU",245,0)
 ;
"RTN","IBNCPDPU",246,0)
 ;IBNCPDPU
"RTN","IBNCPDR")
0^13^B7723137
"RTN","IBNCPDR",1,0)
IBNCPDR ;ALB/BDB - ROI MANAGEMENT, LIST MANAGER ;30-NOV-07
"RTN","IBNCPDR",2,0)
 ;;2.0;INTEGRATED BILLING;**384**;21-MAR-94;Build 74
"RTN","IBNCPDR",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBNCPDR",4,0)
 ;
"RTN","IBNCPDR",5,0)
 ;
"RTN","IBNCPDR",6,0)
% ; -- main entry point
"RTN","IBNCPDR",7,0)
EN ;
"RTN","IBNCPDR",8,0)
 D DT^DICRW
"RTN","IBNCPDR",9,0)
 K XQORS,VALMEVL
"RTN","IBNCPDR",10,0)
 D EN^VALM("IBNCR PATIENT RELEASE OF INFO")
"RTN","IBNCPDR",11,0)
ENQ K DFN
"RTN","IBNCPDR",12,0)
 Q
"RTN","IBNCPDR",13,0)
 ;
"RTN","IBNCPDR",14,0)
 ;
"RTN","IBNCPDR",15,0)
INIT ; -- set up inital variables
"RTN","IBNCPDR",16,0)
 S U="^",VALMCNT=0,VALMBG=1
"RTN","IBNCPDR",17,0)
 K ^TMP("IBNCR",$J)
"RTN","IBNCPDR",18,0)
 D:'$D(DFN) PAT G:$D(VALMQUIT) INITQ
"RTN","IBNCPDR",19,0)
 D BLD
"RTN","IBNCPDR",20,0)
INITQ Q
"RTN","IBNCPDR",21,0)
 ;
"RTN","IBNCPDR",22,0)
 ;
"RTN","IBNCPDR",23,0)
PAT ; -- select patient you are working with
"RTN","IBNCPDR",24,0)
 N DPTNOFZY S DPTNOFZY=1  ;Suppress PATIENT file fuzzy lookups
"RTN","IBNCPDR",25,0)
 S DIC(0)="AEQMN",DIC="^DPT(" D ^DIC K DIC I +Y<1 S VALMQUIT="" Q
"RTN","IBNCPDR",26,0)
 S DFN=+Y
"RTN","IBNCPDR",27,0)
 Q
"RTN","IBNCPDR",28,0)
 ;
"RTN","IBNCPDR",29,0)
 ;
"RTN","IBNCPDR",30,0)
BLD ; -- build list of ROI'S
"RTN","IBNCPDR",31,0)
 K ^TMP("IBNCR",$J)
"RTN","IBNCPDR",32,0)
 N IBNCRI,IBNCRJ,IBNCRK,IBNCRL,IBNCRM,IBNCRX,IBNCRF
"RTN","IBNCPDR",33,0)
 S (IBNCRI,IBNCRJ,IBNCRK,IBNCRL,VALMCNT)=0
"RTN","IBNCPDR",34,0)
 ;
"RTN","IBNCPDR",35,0)
 ; -- find all ROI'S
"RTN","IBNCPDR",36,0)
 K IBNCRJ S IBNCRJ=0
"RTN","IBNCPDR",37,0)
 S IBNCRK=0 F  S IBNCRK=$O(^IBT(356.25,"AC",DFN,IBNCRK)) Q:'IBNCRK  S IBNCRL=0 F  S IBNCRL=$O(^IBT(356.25,"AC",DFN,IBNCRK,IBNCRL)) Q:'IBNCRL  D
"RTN","IBNCPDR",38,0)
 .; -- add to list
"RTN","IBNCPDR",39,0)
 . S IBNCRM=0 F  S IBNCRM=$O(^IBT(356.25,"AC",DFN,IBNCRK,IBNCRL,IBNCRM)) Q:'IBNCRM  D
"RTN","IBNCPDR",40,0)
 .. S IBNCRJ=IBNCRJ+1,IBNCRX=""
"RTN","IBNCPDR",41,0)
 .. S IBNCRX=$$SETFLD^VALM1(IBNCRJ,IBNCRX,"NUMBER")
"RTN","IBNCPDR",42,0)
 .. S IBNCRF=^IBT(356.25,IBNCRM,0)
"RTN","IBNCPDR",43,0)
 .. I $P(IBNCRF,"^",7)="0" S IBNCRX=IBNCRX_"I "
"RTN","IBNCPDR",44,0)
 .. S IBNCRX=$$SETFLD^VALM1($$DRUG^IBRXUTL1(IBNCRK),IBNCRX,"DRUG")
"RTN","IBNCPDR",45,0)
 .. I $D(^DIC(36,+IBNCRL,0)) S IBNCRX=$$SETFLD^VALM1($P(^(0),"^"),IBNCRX,"INSUR")
"RTN","IBNCPDR",46,0)
 .. S IBNCRX=$$SETFLD^VALM1($$DAT1^IBOUTL($P(IBNCRF,"^",5)),IBNCRX,"EFFDT")
"RTN","IBNCPDR",47,0)
 .. I $P(IBNCRF,"^",6)]"" S IBNCRX=IBNCRX_"thru"
"RTN","IBNCPDR",48,0)
 .. S IBNCRX=$$SETFLD^VALM1($$DAT1^IBOUTL($P(IBNCRF,"^",6)),IBNCRX,"EXPIRE")
"RTN","IBNCPDR",49,0)
 .. D SET(IBNCRX)
"RTN","IBNCPDR",50,0)
BLDQ ;
"RTN","IBNCPDR",51,0)
 I VALMCNT=0 D SET("  -- No ROI's on file for patient --")
"RTN","IBNCPDR",52,0)
 Q
"RTN","IBNCPDR",53,0)
 ;
"RTN","IBNCPDR",54,0)
SET(X) ; -- set arrays
"RTN","IBNCPDR",55,0)
 S VALMCNT=VALMCNT+1,^TMP("IBNCR",$J,VALMCNT,0)=X
"RTN","IBNCPDR",56,0)
 S ^TMP("IBNCR",$J,"IDX",VALMCNT,IBNCRJ)=""
"RTN","IBNCPDR",57,0)
 S ^TMP("IBNCRDX",$J,IBNCRJ)=$G(IBNCRM)
"RTN","IBNCPDR",58,0)
 Q
"RTN","IBNCPDR",59,0)
 ;
"RTN","IBNCPDR",60,0)
HDR ; -- screen header for initial screen
"RTN","IBNCPDR",61,0)
 D PID^VADPT
"RTN","IBNCPDR",62,0)
 S VALMHDR(1)="ROI Management for Patient: "_$E($P($G(^DPT(DFN,0)),"^"),1,20)_" "_$E($G(^(0)),1)_VA("BID")
"RTN","IBNCPDR",63,0)
 S VALMHDR(2)=" "
"RTN","IBNCPDR",64,0)
 Q
"RTN","IBNCPDR",65,0)
 ;
"RTN","IBNCPDR",66,0)
FNL ; -- exit and clean up
"RTN","IBNCPDR",67,0)
 K ^TMP("IBNCR",$J)
"RTN","IBNCPDR",68,0)
 D CLEAN^VALM10
"RTN","IBNCPDR",69,0)
 K VA,VAERR
"RTN","IBNCPDR",70,0)
 Q
"RTN","IBNCPDR",71,0)
 ;
"RTN","IBNCPDR1")
0^14^B4262134
"RTN","IBNCPDR1",1,0)
IBNCPDR1 ;ALB/BDB - ROI MANAGEMENT ;30-NOV-07
"RTN","IBNCPDR1",2,0)
 ;;2.0;INTEGRATED BILLING;**384**; 21-MAR-94;Build 74
"RTN","IBNCPDR1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBNCPDR1",4,0)
 ;
"RTN","IBNCPDR1",5,0)
EN ; -- ROI Update
"RTN","IBNCPDR1",6,0)
 D FULL^VALM1 W !!
"RTN","IBNCPDR1",7,0)
 N IBDIF,DA,DR,DIC,DIE,DGSENFLG,IBEFF,IBROI
"RTN","IBNCPDR1",8,0)
 L +^IBT(356.25,IBNCRPR):5 I '$T D LOCKED^IBTRCD1 G ROIQ
"RTN","IBNCPDR1",9,0)
 S DIE="^IBT(356.25,",DA=IBNCRPR,DIE("NO^")="BACK",DR="@1;.05;S IBEFF=X;.06;I X<IBEFF W !,""   EXPIRATION DATE < EFFECTIVE DATE ??"" S Y=""@1"";I X>(IBEFF+10000) W !,""   EXPIRATION DATE > EFFECTIVE DATE + ONE YEAR??"" S Y=""@1"";.07;2.01"
"RTN","IBNCPDR1",10,0)
 D ^DIE K DIC,DIE,DA,DR
"RTN","IBNCPDR1",11,0)
 S IBDIF=0
"RTN","IBNCPDR1",12,0)
 I $G(^IBT(356.25,IBNCRPR,0))'=$G(TMP("IBNCR",$J,"ROI0")) S IBDIF=1
"RTN","IBNCPDR1",13,0)
 I $G(^IBT(356.25,IBNCRPR,1))'=$G(TMP("IBNCR",$J,"ROI1")) S IBDIF=1
"RTN","IBNCPDR1",14,0)
 I $G(^IBT(356.25,IBNCRPR,2))'=$G(TMP("IBNCR",$J,"ROI2")) S IBDIF=1
"RTN","IBNCPDR1",15,0)
 I IBDIF D UPDATE,BLD^IBNCPDR5
"RTN","IBNCPDR1",16,0)
 L -^IBT(356.25,IBNCRPR)
"RTN","IBNCPDR1",17,0)
 S ZTIO="",ZTRTN="CTCLN^IBNCPDR2",ZTSAVE("IBNCRPR")="",ZTDTH=$H,ZTDESC="IB - Make ROI Pharmacy entries in Claims Tracking billable"
"RTN","IBNCPDR1",18,0)
 D ^%ZTLOAD K ZTSK,ZTIO,ZTSAVE,ZTDESC,ZTRTN
"RTN","IBNCPDR1",19,0)
 ;D CTCLN^IBNCPDR2
"RTN","IBNCPDR1",20,0)
ROIQ S VALMBCK="R" Q
"RTN","IBNCPDR1",21,0)
 ;
"RTN","IBNCPDR1",22,0)
UPDATE ; -- Update last edited by
"RTN","IBNCPDR1",23,0)
 N DA,DIC,DIE,DR
"RTN","IBNCPDR1",24,0)
 S DIE="^IBT(356.25,",DA=IBNCRPR,DR="1.03///NOW;1.04////"_DUZ
"RTN","IBNCPDR1",25,0)
 D ^DIE
"RTN","IBNCPDR1",26,0)
 S VALMBCK="R" Q
"RTN","IBNCPDR1",27,0)
 ;
"RTN","IBNCPDR2")
0^15^B8736079
"RTN","IBNCPDR2",1,0)
IBNCPDR2 ;ALB/BDB - ROI MANAGEMENT, ADD ROI ;30-NOV-07
"RTN","IBNCPDR2",2,0)
 ;;2.0;INTEGRATED BILLING;**384**;21-MAR-94;Build 74
"RTN","IBNCPDR2",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBNCPDR2",4,0)
 ;
"RTN","IBNCPDR2",5,0)
 ;
"RTN","IBNCPDR2",6,0)
AD ; -- Add tracking entry
"RTN","IBNCPDR2",7,0)
 D FULL^VALM1
"RTN","IBNCPDR2",8,0)
 N X,Y,DIC,DA,DR,DD,DO,DIR,DIRUT,DTOUT,DUOUT,IBETYP,IBQUIT,IBTDT,VAIN,VAINDT,IBTRN,IBTDTE,IBROIDR
"RTN","IBNCPDR2",9,0)
 ;
"RTN","IBNCPDR2",10,0)
 L +^IBT(356.25,0):10 I '$T D PAUSE^IBNCPBB("ROI File busy while trying to add a new entry") G ADDQ
"RTN","IBNCPDR2",11,0)
 S X=$P($S($D(^IBT(356.25,0)):^(0),1:"^^-1"),"^",3)+1 L -^IBT(356.25,0)
"RTN","IBNCPDR2",12,0)
 S DIC="^IBT(356.25,",DIC(0)="L",DLAYGO=356.25
"RTN","IBNCPDR2",13,0)
 S DIC("DR")=".02////"_$G(DFN)_";.03;.04;@1;.05;S IBROIDR=X;.06;I ((X-IBROIDR)>10000)!((X-IBROIDR)<0) D EN^DDIOL(""   ** The ROI expiration date must be within one year of the fill date. **"") S Y=""@1"";.07////1;1.01///NOW;1.02////"
"RTN","IBNCPDR2",14,0)
 S DIC("DR")=DIC("DR")_DUZ_";1.03///NOW;1.04////"_DUZ_";1.05///NOW;2.01"
"RTN","IBNCPDR2",15,0)
 D FILE^DICN
"RTN","IBNCPDR2",16,0)
 N IBNCRPR S IBNCRPR=0 I +Y>0 S IBNCRPR=+Y,ZTIO="",ZTRTN="CTCLN^IBNCPDR2",ZTDTH=$H,ZTSAVE("IBNCRPR")="",ZTDESC="IB - Make ROI Pharmacy entries in Claims Tracking billable"
"RTN","IBNCPDR2",17,0)
 I IBNCRPR D ^%ZTLOAD K ZTSK,ZTIO,ZTSAVE,ZTDESC,ZTRTN
"RTN","IBNCPDR2",18,0)
 D BLD^IBNCPDR
"RTN","IBNCPDR2",19,0)
ADDQ ;
"RTN","IBNCPDR2",20,0)
 S VALMBCK="R"
"RTN","IBNCPDR2",21,0)
 Q
"RTN","IBNCPDR2",22,0)
 ;
"RTN","IBNCPDR2",23,0)
CTCLN ; -- make ROI Pharmacy entries in Claims Tracking billable
"RTN","IBNCPDR2",24,0)
 ; tasked job with IBNCRPR defined - IEN file(#356.25)
"RTN","IBNCPDR2",25,0)
 ; search claims tracking for NBR of no ROI
"RTN","IBNCPDR2",26,0)
 ; set ROI flag to "obtained"
"RTN","IBNCPDR2",27,0)
 ; if NBR is no ROI, clear it
"RTN","IBNCPDR2",28,0)
 N IBNCR0,DFN,IBNCRD,IBDT,IBTRN,IBEFDT,IBEXDT,IBX,IBZ,IBT,IBPL,IBINS
"RTN","IBNCPDR2",29,0)
 N DIC,DIE,DR,DA,X,Y,IBRX
"RTN","IBNCPDR2",30,0)
 S IBNCR0=$G(^IBT(356.25,IBNCRPR,0))
"RTN","IBNCPDR2",31,0)
 S DFN=$P(IBNCR0,U,2),IBNCRD=$P(IBNCR0,U,3),IBEFDT=$P(IBNCR0,U,5),IBEXDT=$P(IBNCR0,U,6)
"RTN","IBNCPDR2",32,0)
 I $P(IBNCR0,U,7)="0" G CTCLNQ ; inactive ROI
"RTN","IBNCPDR2",33,0)
 I 'DFN!('IBNCRD)!('IBEFDT)!('IBEXDT) G CTCLNQ
"RTN","IBNCPDR2",34,0)
 S IBDT=0 F  S IBDT=$O(^IBT(356,"APTY",DFN,4,IBDT)) Q:'IBDT  D:IBDT'<IBEFDT&(IBDT'>IBEXDT)
"RTN","IBNCPDR2",35,0)
 . S IBTRN=0 F  S IBTRN=$O(^IBT(356,"APTY",DFN,4,IBDT,IBTRN)) Q:'IBTRN  D
"RTN","IBNCPDR2",36,0)
 .. S IBRX=$P(^IBT(356,IBTRN,0),U,8)
"RTN","IBNCPDR2",37,0)
 .. I IBNCRD'=$$FILE^IBRXUTL(IBRX,6) Q
"RTN","IBNCPDR2",38,0)
 .. S DR=".31////2" ; set CT ROI flag to 'obtained'
"RTN","IBNCPDR2",39,0)
 .. I $P($G(^IBE(356.8,+$P($G(^IBT(356,IBTRN,0)),"^",19),0)),"^")="REFUSES TO SIGN RELEASE (ROI)" S DR=DR_";.19///@" ;clean NB reason
"RTN","IBNCPDR2",40,0)
 .. S DIE="^IBT(356,",DA=IBTRN D ^DIE
"RTN","IBNCPDR2",41,0)
 K IBNCRPR
"RTN","IBNCPDR2",42,0)
 ;
"RTN","IBNCPDR2",43,0)
CTCLNQ ;
"RTN","IBNCPDR2",44,0)
 ;
"RTN","IBNCPDR4")
0^16^B32682440
"RTN","IBNCPDR4",1,0)
IBNCPDR4 ;ALB/BDB - ROI MANAGEMENT, ROI CHECK ;30-NOV-07
"RTN","IBNCPDR4",2,0)
 ;;2.0;INTEGRATED BILLING;**384**;21-MAR-94;Build 74
"RTN","IBNCPDR4",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBNCPDR4",4,0)
 ;
"RTN","IBNCPDR4",5,0)
 ;
"RTN","IBNCPDR4",6,0)
ROICHK(IBPAT,IBDRUG,IBINS,IBDT) ;Check for ROI
"RTN","IBNCPDR4",7,0)
 ; Function returns 1 if ROI on file or new ROI added, 0 if no ROI on file
"RTN","IBNCPDR4",8,0)
 ; it returns a 2 if not needed, passes checks
"RTN","IBNCPDR4",9,0)
 ;
"RTN","IBNCPDR4",10,0)
 ; -- input IBPAT  = patient (req)
"RTN","IBNCPDR4",11,0)
 ;          IBDRUG = drug  (req)
"RTN","IBNCPDR4",12,0)
 ;          IBINS  = insurance file 36 (req)
"RTN","IBNCPDR4",13,0)
 ;          IBDT   = fileman format fill date (req)
"RTN","IBNCPDR4",14,0)
 N DIC,DIE,DA,DR,DQ,D0,DI,D,X,Y
"RTN","IBNCPDR4",15,0)
 I $$ROI(IBPAT,IBDRUG,IBINS,IBDT) Q 1 ;ROI is on file
"RTN","IBNCPDR4",16,0)
 K ^TMP($J,"IBDRUG")
"RTN","IBNCPDR4",17,0)
 D DATA^PSS50(IBDRUG,,,,,"IBDRUG")
"RTN","IBNCPDR4",18,0)
 I $G(^TMP($J,"IBDRUG",IBDRUG,3))'["U" Q 2 ;ROI not needed for drug
"RTN","IBNCPDR4",19,0)
 D EN^DDIOL("This drug requires a Release of Information(ROI) for:","","!!")
"RTN","IBNCPDR4",20,0)
 D EN^DDIOL(" PATIENT: ","","!") D EN^DDIOL($E($P($G(^DPT(IBPAT,0)),U),1,20),"","?0")
"RTN","IBNCPDR4",21,0)
 D EN^DDIOL(" DRUG: ","","!") D EN^DDIOL($E($G(^TMP($J,"IBDRUG",IBDRUG,.01)),1,30),"","?0")
"RTN","IBNCPDR4",22,0)
 D EN^DDIOL(" INSURANCE COMPANY: ","","!") D EN^DDIOL($P($G(^DIC(36,+IBINS,0)),U),"","?0")
"RTN","IBNCPDR4",23,0)
 D EN^DDIOL(" FILL DATE: ","","!") D EN^DDIOL($$DAT1^IBOUTL(IBDT),"","?0")
"RTN","IBNCPDR4",24,0)
 I '$$KCHK^XUSRB("IBCNR ROI") Q 0
"RTN","IBNCPDR4",25,0)
 K ^TMP($J,"IBDRUG")
"RTN","IBNCPDR4",26,0)
 S DIR(0)="Y",DIR("A")="Do you want to add a new ROI for this patient? "
"RTN","IBNCPDR4",27,0)
 S DIR("B")="NO"
"RTN","IBNCPDR4",28,0)
 S DIR("?")="If you want to add a new ROI, enter 'Yes' - otherwise, enter 'No'"
"RTN","IBNCPDR4",29,0)
 D EN^DDIOL("","","!") D ^DIR K DIR
"RTN","IBNCPDR4",30,0)
 I 'Y D EN^DDIOL(" *** Rx requires an ROI. Please add the required ROI.","","!") Q 0 ;Stop processing
"RTN","IBNCPDR4",31,0)
 I '$$AD(IBPAT,IBDRUG,IBINS,IBDT) D EN^DDIOL(" *** Rx requires an ROI.","","!") D EN^DDIOL(" Please add an ROI before submitting the claim.","","!") Q 0 ;Stop processing
"RTN","IBNCPDR4",32,0)
 Q 1 ;Continue processing
"RTN","IBNCPDR4",33,0)
 ;
"RTN","IBNCPDR4",34,0)
ROICLN(IBTRN,IBRX,IBFIL) ;Clean NB reason, set CT ROI flag to 'obtained'
"RTN","IBNCPDR4",35,0)
 ; Clean ROI non-billable reason on Claims Tracking 356
"RTN","IBNCPDR4",36,0)
 ;
"RTN","IBNCPDR4",37,0)
 ; -- input IBTRN  = IEN of Claims Tracking #356
"RTN","IBNCPDR4",38,0)
 ;          IBRX   = Rx IEN
"RTN","IBNCPDR4",39,0)
 ;          IBFIL  = RX fill number
"RTN","IBNCPDR4",40,0)
 N DIE,DA,DR
"RTN","IBNCPDR4",41,0)
 I '$G(IBTRN) S IBTRN=+$O(^IBT(356,"ARXFL",$G(IBRX),$G(IBFIL),0))
"RTN","IBNCPDR4",42,0)
 I IBTRN D
"RTN","IBNCPDR4",43,0)
 . S DR=".31////2" ; set CT ROI flag to 'obtained'
"RTN","IBNCPDR4",44,0)
 . I $P($G(^IBE(356.8,+$P($G(^IBT(356,IBTRN,0)),"^",19),0)),"^")="REFUSES TO SIGN RELEASE (ROI)" S DR=DR_";.19///@"
"RTN","IBNCPDR4",45,0)
 . S DIE="^IBT(356,",DA=IBTRN D ^DIE ;clean NB reason
"RTN","IBNCPDR4",46,0)
 Q
"RTN","IBNCPDR4",47,0)
 ;
"RTN","IBNCPDR4",48,0)
 ;Check for Release of Information (ROI) on file
"RTN","IBNCPDR4",49,0)
ROI(IBDFN,IBDRUG,IBINS,IBADT) ; -- Check for ROI on file
"RTN","IBNCPDR4",50,0)
 ; Function returns 1 if ROI on file, 0 if no ROI on file
"RTN","IBNCPDR4",51,0)
 ;
"RTN","IBNCPDR4",52,0)
 ; -- input IBDFN  = patient (req)
"RTN","IBNCPDR4",53,0)
 ;          IBDRUG = drug  (req)
"RTN","IBNCPDR4",54,0)
 ;          IBINS  = insurance file 36 (req)
"RTN","IBNCPDR4",55,0)
 ;          IBADT  = fileman format fill date (req)
"RTN","IBNCPDR4",56,0)
 ;
"RTN","IBNCPDR4",57,0)
 N IBROI,IBFLG
"RTN","IBNCPDR4",58,0)
 S IBFLG=0 ;No ROI on file
"RTN","IBNCPDR4",59,0)
 S IBROI=0 F  S IBROI=$O(^IBT(356.25,"AC",IBDFN,IBDRUG,IBINS,IBROI)) G:'IBROI ROIQ D  G:IBFLG ROIQ ;Check for ROI on file
"RTN","IBNCPDR4",60,0)
  . I IBADT<$P(^IBT(356.25,IBROI,0),U,5)!(IBADT>$P(^IBT(356.25,IBROI,0),U,6)) Q  ;Date out of range
"RTN","IBNCPDR4",61,0)
  . I $P(^IBT(356.25,IBROI,0),U,7)="0" Q  ;Inactive ROI
"RTN","IBNCPDR4",62,0)
  . S IBFLG=1 ;ROI on file
"RTN","IBNCPDR4",63,0)
  . S DIE="^IBT(356.25,",DA=IBROI,DR="1.05///NOW" D ^DIE
"RTN","IBNCPDR4",64,0)
ROIQ ;
"RTN","IBNCPDR4",65,0)
 Q IBFLG
"RTN","IBNCPDR4",66,0)
 ;
"RTN","IBNCPDR4",67,0)
AD(IBDFN,IBDRUG,IBINS,IBDT) ; -- Add tracking entry
"RTN","IBNCPDR4",68,0)
 ; Function returns 1 if ROI added, 0 if not added
"RTN","IBNCPDR4",69,0)
 N X,Y,DIC,DIR,DA,DR,DTOUT,DUOUT,IBQUIT,IBEFFDT,IBEXPDT
"RTN","IBNCPDR4",70,0)
 S IBQUIT=0
"RTN","IBNCPDR4",71,0)
 F  S DIR("?")="The ROI effective date must be prior to or equal to the fill date.",DIR("A")="Enter the ROI effective date for the ROI: ",DIR(0)="DATE" D ^DIR K DIR Q:$D(DTOUT)!$D(DUOUT)  D  Q:IBQUIT
"RTN","IBNCPDR4",72,0)
 . S X=Y,%DT="E" D ^%DT I Y<0 D EN^DDIOL("Must enter a valid date","","!") Q
"RTN","IBNCPDR4",73,0)
 . I Y>IBDT D EN^DDIOL("The ROI effective date must be prior to or equal to the fill date.","","!") Q
"RTN","IBNCPDR4",74,0)
 . S IBEFFDT=Y,IBQUIT=1 Q
"RTN","IBNCPDR4",75,0)
 G:'IBQUIT ADDQ
"RTN","IBNCPDR4",76,0)
 S IBQUIT=0
"RTN","IBNCPDR4",77,0)
 F  S DIR("?")="The ROI expiration date must be equal to or after the fill date.",DIR("A")="Enter the ROI expiration date for the ROI: ",DIR(0)="DATE" D ^DIR K DIR Q:$D(DTOUT)!$D(DUOUT)  D  Q:IBQUIT
"RTN","IBNCPDR4",78,0)
 . S X=Y,%DT="E" D ^%DT I Y<0 D EN^DDIOL("Must enter a valid date","","!") Q
"RTN","IBNCPDR4",79,0)
 . I ((Y-IBEFFDT)>10000) D EN^DDIOL("The ROI expiration date must be within one year of the effective date.","","!") Q
"RTN","IBNCPDR4",80,0)
 . I Y<IBDT D EN^DDIOL("The ROI expiration date must be equal to or after the fill date.","","!") Q
"RTN","IBNCPDR4",81,0)
 . S IBEXPDT=Y,IBQUIT=1 Q
"RTN","IBNCPDR4",82,0)
 G:'IBQUIT ADDQ
"RTN","IBNCPDR4",83,0)
 L +^IBT(356.25,0):10 I '$T D PAUSE^IBNCPBB("ROI File busy while trying to add a new entry") S IBQUIT=0 G ADDQ
"RTN","IBNCPDR4",84,0)
 S X=$P($S($D(^IBT(356.25,0)):^(0),1:"^^-1"),"^",3)+1 L -^IBT(356.25,0)
"RTN","IBNCPDR4",85,0)
 S DIC="^IBT(356.25,",DIC(0)="L",DLAYGO=356.25,DIC("DR")=".02////"_IBDFN_";.03////"_IBDRUG_";.04////"_IBINS_";.05///"_IBEFFDT_";.06////"_IBEXPDT_";.07////1;1.01///NOW;1.02////"_DUZ_";1.03///NOW;1.04////"_DUZ_";1.05///NOW;2.01" D FILE^DICN
"RTN","IBNCPDR4",86,0)
 I Y<1!($D(DUOUT))!($D(DTOUT)) S IBQUIT=0 G ADDQ
"RTN","IBNCPDR4",87,0)
 N IBNCRPR I +Y>0 S IBNCRPR=+Y,ZTIO="",ZTRTN="CTCLN^IBNCPDR2",ZTDTH=$H,ZTSAVE("IBNCRPR")="",ZTDESC="IB - Make ROI Pharmacy entries in Claims Tracking billable"
"RTN","IBNCPDR4",88,0)
 D ^%ZTLOAD K ZTSK,ZTIO,ZTSAVE,ZTDESC,ZTRTN
"RTN","IBNCPDR4",89,0)
ADDQ Q IBQUIT
"RTN","IBNCPDR4",90,0)
 ;
"RTN","IBNCPDR4",91,0)
 ;Check for ROI on file
"RTN","IBNCPDR4",92,0)
ROI399(IBIFN) ; -- ROI Complete? in Bill/Claims (#399;157)
"RTN","IBNCPDR4",93,0)
 ; Check drugs that contain the special handling code U against the
"RTN","IBNCPDR4",94,0)
 ; Claims Tracking ROI file (#356.25) to see if an ROI is on file
"RTN","IBNCPDR4",95,0)
 ; 
"RTN","IBNCPDR4",96,0)
 ; input - IBIFN = IEN of the Bill/Claims file (#399)
"RTN","IBNCPDR4",97,0)
 ; output - 0 = sensitive drug and no ROI on file
"RTN","IBNCPDR4",98,0)
 ;          1 = default, sensitive drug and ROI on file
"RTN","IBNCPDR4",99,0)
 N IBX,IBY0,IBRXIEN,IBDT,IBDRUG,ROIQ,IBDFN,IBINS
"RTN","IBNCPDR4",100,0)
 N DIC,DIE,DA,DR,DQ,D0,DI,DISYS,D,X,Y,DE,DW,DV,DL,DLB
"RTN","IBNCPDR4",101,0)
 S IBDFN=$P(^DGCR(399,IBIFN,0),U,2) ;patient
"RTN","IBNCPDR4",102,0)
 S IBINS=$P(^DGCR(399,IBIFN,"MP"),U,1) ;payer insurance company
"RTN","IBNCPDR4",103,0)
 I 'IBINS S ROIQ=1 G ROI399Q
"RTN","IBNCPDR4",104,0)
 S ROIQ=1
"RTN","IBNCPDR4",105,0)
 S IBX=0 F  S IBX=$O(^IBA(362.4,"C",$G(IBIFN),$G(IBX))) Q:'IBX  D
"RTN","IBNCPDR4",106,0)
 .S IBY0=^IBA(362.4,IBX,0),IBRXIEN=$P(IBY0,U,5) I 'IBRXIEN Q
"RTN","IBNCPDR4",107,0)
 .S IBDT=$P(IBY0,U,3),IBDRUG=$P(IBY0,U,4)
"RTN","IBNCPDR4",108,0)
 .K ^TMP($J,"IBDRUG") D ZERO^IBRXUTL(IBDRUG)
"RTN","IBNCPDR4",109,0)
 .I ^TMP($J,"IBDRUG",IBDRUG,3)["U" D
"RTN","IBNCPDR4",110,0)
 .. I $$ROICHK^IBNCPDR4(IBDFN,IBDRUG,IBINS,IBDT) Q
"RTN","IBNCPDR4",111,0)
 .. S ROIQ=0
"RTN","IBNCPDR4",112,0)
ROI399Q ;
"RTN","IBNCPDR4",113,0)
 Q ROIQ
"RTN","IBNCPDR5")
0^17^B9016417
"RTN","IBNCPDR5",1,0)
IBNCPDR5 ;ALB/BDB - ROI MANAGEMENT, EXPAND ROI ;30-NOV-07
"RTN","IBNCPDR5",2,0)
 ;;2.0;INTEGRATED BILLING;**384**; 21-MAR-94;Build 74
"RTN","IBNCPDR5",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBNCPDR5",4,0)
 ;
"RTN","IBNCPDR5",5,0)
 ;
"RTN","IBNCPDR5",6,0)
VP ; -- View Patient ROI Info
"RTN","IBNCPDR5",7,0)
 N I,J,IBNCRXX,VALMY,IBNCRPR
"RTN","IBNCPDR5",8,0)
 D EN^VALM2($G(XQORNOD(0)))
"RTN","IBNCPDR5",9,0)
 I $D(VALMY) S IBNCRXX=0 F  S IBNCRXX=$O(VALMY(IBNCRXX)) Q:'IBNCRXX  D
"RTN","IBNCPDR5",10,0)
 .S IBNCRPR=$G(^TMP("IBNCRDX",$J,IBNCRXX))
"RTN","IBNCPDR5",11,0)
 .Q:IBNCRPR=""
"RTN","IBNCPDR5",12,0)
 .D EN^VALM("IBNCR EXPANDED ROI")
"RTN","IBNCPDR5",13,0)
 .Q
"RTN","IBNCPDR5",14,0)
 D FULL^VALM1
"RTN","IBNCPDR5",15,0)
 D BLD^IBNCPDR
"RTN","IBNCPDR5",16,0)
 Q
"RTN","IBNCPDR5",17,0)
 ;
"RTN","IBNCPDR5",18,0)
INIT ; -- set up inital variables
"RTN","IBNCPDR5",19,0)
 S U="^",VALMCNT=14,VALMBG=1
"RTN","IBNCPDR5",20,0)
 K ^TMP("IBNCRVR",$J)
"RTN","IBNCPDR5",21,0)
 D BLD^IBNCPDR5
"RTN","IBNCPDR5",22,0)
INITQ Q
"RTN","IBNCPDR5",23,0)
 ;
"RTN","IBNCPDR5",24,0)
BLD ; -- expand the ROI
"RTN","IBNCPDR5",25,0)
 N IBNCR0,IBNCR1,IBNCR2,IBNCRJ,IBNCROFF
"RTN","IBNCPDR5",26,0)
 D KILL^VALM10()
"RTN","IBNCPDR5",27,0)
 F I=1:1:14 D BLANK(.I)
"RTN","IBNCPDR5",28,0)
 S IBNCRJ=0,IBNCROFF=1
"RTN","IBNCPDR5",29,0)
 D SET(IBNCRJ+1,2,$E($P($G(^DPT(DFN,0)),"^"),1,20)_" has the following ROI on file:")
"RTN","IBNCPDR5",30,0)
 S IBNCR0=$G(^IBT(356.25,IBNCRPR,0)),IBNCR1=$G(^(1)),IBNCR2=$G(^(2))
"RTN","IBNCPDR5",31,0)
 S ^TMP("IBNCR",$J,"ROI0")=IBNCR0,^("ROI1")=IBNCR1,^("ROI2")=IBNCR2
"RTN","IBNCPDR5",32,0)
 D SET(IBNCRJ+3,2,"Drug: "_$$DRUG^IBRXUTL1($P(IBNCR0,U,3)))
"RTN","IBNCPDR5",33,0)
 I $D(^DIC(36,$P(IBNCR0,U,4),0)) D SET(IBNCRJ+4,2,"Insurance Company: "_$P(^(0),"^"))
"RTN","IBNCPDR5",34,0)
 D SET(IBNCRJ+5,2,"Effective Date: "_$$DAT1^IBOUTL($P(IBNCR0,"^",5)))
"RTN","IBNCPDR5",35,0)
 D SET(IBNCRJ+6,2,"Expiration Date: "_$$DAT1^IBOUTL($P(IBNCR0,"^",6)))
"RTN","IBNCPDR5",36,0)
 D SET(IBNCRJ+7,2,"Status: Active  ")
"RTN","IBNCPDR5",37,0)
 I $P(IBNCR0,U,7)="0" D SET(IBNCRJ+7,2,"Status: Inactive")
"RTN","IBNCPDR5",38,0)
 D SET(IBNCRJ+8,2,"Comment: "_$P(IBNCR2,"^",1))
"RTN","IBNCPDR5",39,0)
 D SET(IBNCRJ+10,IBNCROFF,"            Date ROI Added: "_$$DAT1^IBOUTL($P(IBNCR1,U,1)))
"RTN","IBNCPDR5",40,0)
 D SET(IBNCRJ+11,IBNCROFF,"         User Adding Entry: "_$$USR^IBNCPEV($P(IBNCR1,U,2)))
"RTN","IBNCPDR5",41,0)
 D SET(IBNCRJ+12,IBNCROFF,"     Date ROI Last Updated: "_$$DAT1^IBOUTL($P(IBNCR1,U,3)))
"RTN","IBNCPDR5",42,0)
 D SET(IBNCRJ+13,IBNCROFF,"        User Last Updating: "_$$USR^IBNCPEV($P(IBNCR1,U,4)))
"RTN","IBNCPDR5",43,0)
 D SET(IBNCRJ+14,IBNCROFF,"            Date Last Used: "_$$DAT1^IBOUTL($P(IBNCR1,U,5)))
"RTN","IBNCPDR5",44,0)
BLDQ ;
"RTN","IBNCPDR5",45,0)
 Q
"RTN","IBNCPDR5",46,0)
 ;
"RTN","IBNCPDR5",47,0)
BLANK(LINE) ; -- Build blank line
"RTN","IBNCPDR5",48,0)
 D SET^VALM10(.LINE,$J("",80))
"RTN","IBNCPDR5",49,0)
 Q
"RTN","IBNCPDR5",50,0)
 ;
"RTN","IBNCPDR5",51,0)
SET(LINE,COL,TEXT,ON,OFF) ; -- set display info in array
"RTN","IBNCPDR5",52,0)
 D:'$D(@VALMAR@(LINE,0)) BLANK(.LINE)
"RTN","IBNCPDR5",53,0)
 D SET^VALM10(.LINE,$$SETSTR^VALM1(.TEXT,@VALMAR@(LINE,0),.COL,$L(TEXT)))
"RTN","IBNCPDR5",54,0)
 ;S VALMCNT=VALMCNT+1
"RTN","IBNCPDR5",55,0)
 D:$G(ON)]""!($G(OFF)]"") CNTRL^VALM10(.LINE,.COL,$L(TEXT),$G(ON),$G(OFF))
"RTN","IBNCPDR5",56,0)
 Q
"RTN","IBNCPDR5",57,0)
 ;
"RTN","IBNCPDR5",58,0)
HDR ; -- screen header for initial screen
"RTN","IBNCPDR5",59,0)
 D PID^VADPT
"RTN","IBNCPDR5",60,0)
 S VALMHDR(1)="ROI Management for Patient: "_$E($P($G(^DPT(DFN,0)),"^"),1,20)_" "_$E($G(^(0)),1)_VA("BID")
"RTN","IBNCPDR5",61,0)
 S VALMHDR(2)=" "
"RTN","IBNCPDR5",62,0)
 Q
"RTN","IBNCPDR5",63,0)
 ;
"RTN","IBNCPDR5",64,0)
FNL ; -- exit and clean up
"RTN","IBNCPDR5",65,0)
 K ^TMP("IBNCRVR",$J)
"RTN","IBNCPDR5",66,0)
 K IBFASTXT
"RTN","IBNCPDR5",67,0)
 D CLEAN^VALM10
"RTN","IBNCPDR5",68,0)
 K VA,VAERR
"RTN","IBNCPDR5",69,0)
 Q
"RTN","IBNCPDR5",70,0)
 ;
"RTN","IBNCPDR5",71,0)
HELP ; -- help code
"RTN","IBNCPDR5",72,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","IBNCPDR5",73,0)
 Q
"RTN","IBNCPEV")
0^25^B85988869
"RTN","IBNCPEV",1,0)
IBNCPEV ;DALOI/SS - NCPDP BILLING EVENTS REPORT ;5/22/08  14:27
"RTN","IBNCPEV",2,0)
 ;;2.0;INTEGRATED BILLING;**342,363,383,384**;21-MAR-94;Build 74
"RTN","IBNCPEV",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBNCPEV",4,0)
RPT ;
"RTN","IBNCPEV",5,0)
 ;
"RTN","IBNCPEV",6,0)
 N IBPAT,IBRX,IBBDT,IBEDT,Y,IBM1,IBM2,IBM3,IBQ,IBSCR,IBPAGE,IBDTL,IBDIVS
"RTN","IBNCPEV",7,0)
 N IBECME
"RTN","IBNCPEV",8,0)
 D SETVARS^IBNCPEV1
"RTN","IBNCPEV",9,0)
 Q:IBQ
"RTN","IBNCPEV",10,0)
 D START
"RTN","IBNCPEV",11,0)
 D ^%ZISC
"RTN","IBNCPEV",12,0)
 I IBQ W !,"Cancelled"
"RTN","IBNCPEV",13,0)
 Q
"RTN","IBNCPEV",14,0)
 ;
"RTN","IBNCPEV",15,0)
START ;
"RTN","IBNCPEV",16,0)
 N REF,IBFROM,IBTO,IBI,IBN,IBRX1,IBFN,IBNDX,IB1ST,IBNUM,X,IBSC,IBNB
"RTN","IBNCPEV",17,0)
 N Z,Z1
"RTN","IBNCPEV",18,0)
 ;Constants
"RTN","IBNCPEV",19,0)
 S IBSC="STATUS CHECK",IBNB="Not ECME billable: ",IBNDX="IBNCPDP-"
"RTN","IBNCPEV",20,0)
 ;get the first date
"RTN","IBNCPEV",21,0)
 S IBFROM=$O(^IBCNR(366.14,"B",IBBDT-1)) Q:+IBFROM=0
"RTN","IBNCPEV",22,0)
 ;get the last date
"RTN","IBNCPEV",23,0)
 S IBTO=$O(^IBCNR(366.14,"B",IBEDT+1),-1) Q:+IBTO=0
"RTN","IBNCPEV",24,0)
 ;
"RTN","IBNCPEV",25,0)
 S REF=$NA(^TMP($J,"IBNCPDPE"))
"RTN","IBNCPEV",26,0)
 ;
"RTN","IBNCPEV",27,0)
 K @REF
"RTN","IBNCPEV",28,0)
 ;
"RTN","IBNCPEV",29,0)
 I +$G(IBECME) S IBRX=$$GETRX^IBNCPEV1(IBECME,IBFROM,IBTO) I 'IBRX  W !!,"No data found for the specified date range and ECME #" Q  ; no match with ECME #
"RTN","IBNCPEV",30,0)
 ;collect
"RTN","IBNCPEV",31,0)
 N IBDTIEN,IBRXIEN,IBZ0,IBZ1,IBZ2,IBDFN,IBEVNT,IBP4
"RTN","IBNCPEV",32,0)
 S IBI=IBFROM-1
"RTN","IBNCPEV",33,0)
 F  S IBI=$O(^IBCNR(366.14,"B",IBI)) Q:+IBI=0  Q:IBI>IBTO  D
"RTN","IBNCPEV",34,0)
 . S IBDTIEN=$O(^IBCNR(366.14,"B",IBI,0))
"RTN","IBNCPEV",35,0)
 . S IBN=0 F  S IBN=$O(^IBCNR(366.14,IBDTIEN,1,IBN)) Q:+IBN=0  D
"RTN","IBNCPEV",36,0)
 . . S IBZ0=$G(^IBCNR(366.14,IBDTIEN,1,IBN,0))
"RTN","IBNCPEV",37,0)
 . . ;if not "ALL" was selected IBDIVS>0 AND the division in #366.14 record is among those selected by the user
"RTN","IBNCPEV",38,0)
 . . I IBDIVS>0,$$CHECKDIV^IBNCPEV1(+$P(IBZ0,U,9),.IBDIVS)=0 Q
"RTN","IBNCPEV",39,0)
 . . S IBDFN=+$P(IBZ0,U,3)
"RTN","IBNCPEV",40,0)
 . . Q:IBDFN=0
"RTN","IBNCPEV",41,0)
 . . S IBEVNT=$$GET1^DIQ(366.141,IBN_","_IBDTIEN_",",.01)
"RTN","IBNCPEV",42,0)
 . . S IBZ2=$G(^IBCNR(366.14,IBDTIEN,1,IBN,2))
"RTN","IBNCPEV",43,0)
 . . S IBRXIEN=$P(IBZ2,U,12)
"RTN","IBNCPEV",44,0)
 . . I IBRXIEN="" S IBRXIEN=$P(IBZ2,U,1)
"RTN","IBNCPEV",45,0)
 . . I IBPAT,IBDFN'=IBPAT Q
"RTN","IBNCPEV",46,0)
 . . I IBM2="E",IBEVNT[IBSC,'$P(IBZ0,U,7) Q
"RTN","IBNCPEV",47,0)
 . . I IBM2="N",IBEVNT'[IBSC Q
"RTN","IBNCPEV",48,0)
 . . I IBM2="N",IBEVNT[IBSC,$P(IBZ0,U,7) Q
"RTN","IBNCPEV",49,0)
 . . ;if "No Rx IEN" case then create a unique artificial IBRXIEN to be able
"RTN","IBNCPEV",50,0)
 . . ;to create ^TMP entry and display available information in the report
"RTN","IBNCPEV",51,0)
 . . I +$G(IBRXIEN)=0 S IBRXIEN=+(IBDTIEN_"."_IBN) G SETTMP
"RTN","IBNCPEV",52,0)
 . . I IBRX,IBRXIEN'=IBRX Q
"RTN","IBNCPEV",53,0)
 . . I $$RXNUM(IBRXIEN)="" Q
"RTN","IBNCPEV",54,0)
 . . I IBM3'="A",IBM3'=$$RXWMC^IBNCPRR(+IBRXIEN) Q
"RTN","IBNCPEV",55,0)
SETTMP . . S @REF@(+IBRXIEN,+$P(IBZ2,U,3),IBDTIEN,IBN)=""
"RTN","IBNCPEV",56,0)
 ;
"RTN","IBNCPEV",57,0)
 I '$D(@REF) W !!,"No data found for the specified input criteria" Q
"RTN","IBNCPEV",58,0)
 ;print
"RTN","IBNCPEV",59,0)
 S IBNUM=0
"RTN","IBNCPEV",60,0)
 U IO D HDR
"RTN","IBNCPEV",61,0)
 S IBRX1="" F  S IBRX1=$O(@REF@(IBRX1)) Q:IBRX1=""  D  Q:IBQ
"RTN","IBNCPEV",62,0)
 .S IBFN="" F  S IBFN=$O(@REF@(IBRX1,IBFN)) Q:IBFN=""  D  Q:IBQ
"RTN","IBNCPEV",63,0)
 ..S IB1ST=1
"RTN","IBNCPEV",64,0)
 ..S IBI="" F  S IBI=$O(@REF@(IBRX1,IBFN,IBI)) Q:IBI=""  D  Q:IBQ
"RTN","IBNCPEV",65,0)
 ...S IBN="" F  S IBN=$O(@REF@(IBRX1,IBFN,IBI,IBN)) Q:IBN=""  D  Q:IBQ
"RTN","IBNCPEV",66,0)
 ....N IBZ,IBD1,IBD2,IBD3,IBD4,IBINS,IBY
"RTN","IBNCPEV",67,0)
 ....;load main
"RTN","IBNCPEV",68,0)
 ....S IBZ=$G(^IBCNR(366.14,IBI,1,IBN,0))
"RTN","IBNCPEV",69,0)
 ....;load IBD array
"RTN","IBNCPEV",70,0)
 ....S IBD1=$G(^IBCNR(366.14,IBI,1,IBN,1))
"RTN","IBNCPEV",71,0)
 ....S IBD2=$G(^IBCNR(366.14,IBI,1,IBN,2))
"RTN","IBNCPEV",72,0)
 ....S IBD3=$G(^IBCNR(366.14,IBI,1,IBN,3))
"RTN","IBNCPEV",73,0)
 ....S IBD4=$G(^IBCNR(366.14,IBI,1,IBN,4))
"RTN","IBNCPEV",74,0)
 ....S IBY=0
"RTN","IBNCPEV",75,0)
 ....;load insurance multiple
"RTN","IBNCPEV",76,0)
 ....F  S IBY=$O(^IBCNR(366.14,IBI,1,IBN,5,IBY)) Q:+IBY=0  D
"RTN","IBNCPEV",77,0)
 .....S IBINS(IBY,0)=$G(^IBCNR(366.14,IBI,1,IBN,5,IBY,0))
"RTN","IBNCPEV",78,0)
 .....S IBINS(IBY,1)=$G(^IBCNR(366.14,IBI,1,IBN,5,IBY,1))
"RTN","IBNCPEV",79,0)
 .....S IBINS(IBY,2)=$G(^IBCNR(366.14,IBI,1,IBN,5,IBY,2))
"RTN","IBNCPEV",80,0)
 .....S IBINS(IBY,3)=$G(^IBCNR(366.14,IBI,1,IBN,5,IBY,3))
"RTN","IBNCPEV",81,0)
 ....;
"RTN","IBNCPEV",82,0)
 ....I IB1ST D  Q:IBQ
"RTN","IBNCPEV",83,0)
 .....S IBNUM=IBNUM+1 I IBNUM>1 D ULINE("-") Q:IBQ
"RTN","IBNCPEV",84,0)
 .....D CHKP Q:IBQ
"RTN","IBNCPEV",85,0)
 .....W !,IBNUM," ",?4,$$RXNUM(IBRX1)," ",?12,IBFN," ",?16,$$DAT(+$P(IBD2,U,6)) ;RX# Fill# Fiil_date
"RTN","IBNCPEV",86,0)
 .....W " ",?28,$E($$PAT(+$P(IBZ,U,3)),1,21)," ",?50,$E($$DRUG(+$P(IBZ,U,3),IBRX1),1,30)
"RTN","IBNCPEV",87,0)
 .....S IB1ST=0
"RTN","IBNCPEV",88,0)
 ....N IND S IND=6
"RTN","IBNCPEV",89,0)
 ....D CHKP Q:IBQ
"RTN","IBNCPEV",90,0)
 ....S IBEVNT=$$GET1^DIQ(366.141,IBN_","_IBI_",",.01)
"RTN","IBNCPEV",91,0)
 ....W !,?IND,$$EVNT(IBEVNT)," ",?16,$$TIM($P(IBZ,U,5)),?31," Status:",$E($$STAT(IBEVNT,$P(IBZ,U,7)_U_$P(IBZ,U,8),$P(IBD3,U,7),$P(IBD3,U,1)),1,40)
"RTN","IBNCPEV",92,0)
 ....Q:'IBDTL  ; no details
"RTN","IBNCPEV",93,0)
 ....I IBEVNT="BILL" D DBILL Q
"RTN","IBNCPEV",94,0)
 ....I IBEVNT="REJECT" D DREJ Q
"RTN","IBNCPEV",95,0)
 ....I IBEVNT["REVERSE" D DREV Q
"RTN","IBNCPEV",96,0)
 ....I IBEVNT["SUBMIT" D DSUB Q
"RTN","IBNCPEV",97,0)
 ....I IBEVNT["CLOSE" D DCLO Q
"RTN","IBNCPEV",98,0)
 ....I IBEVNT["REOPEN" D REOPEN^IBNCPEV1 Q
"RTN","IBNCPEV",99,0)
 ....I IBEVNT["RELEASE" D DREL Q
"RTN","IBNCPEV",100,0)
 ....I IBEVNT[IBSC D DSTAT^IBNCPEV1(.IBD2,.IBD3,.IBD4,.IBINS) Q
"RTN","IBNCPEV",101,0)
 ....I IBEVNT["BILL CANCELLED" D BCANC Q
"RTN","IBNCPEV",102,0)
 I IBSCR,'IBQ W !,"End of report, press RETURN to continue." R X:DTIME
"RTN","IBNCPEV",103,0)
 K @REF
"RTN","IBNCPEV",104,0)
 Q
"RTN","IBNCPEV",105,0)
 ;
"RTN","IBNCPEV",106,0)
STAT(X,RES,CR,IBIFN) ;provides STATUS information
"RTN","IBNCPEV",107,0)
 N IBSC
"RTN","IBNCPEV",108,0)
 N IBNL
"RTN","IBNCPEV",109,0)
 S IBSC="STATUS CHECK"
"RTN","IBNCPEV",110,0)
 S IBNL="Plan not linked to the Payer"
"RTN","IBNCPEV",111,0)
 I X[IBSC,RES[IBNB S RES="0^"_$P(RES,IBNB,2)
"RTN","IBNCPEV",112,0)
 I X[IBSC,RES[IBNL S RES="0^Plan not linked" ; shorten too long line
"RTN","IBNCPEV",113,0)
 I X[IBSC,'RES,RES["Non-Billable in CT" Q $P(RES,U,2)
"RTN","IBNCPEV",114,0)
 I X[IBSC Q $S(RES:"",1:"non-")_"ECME Billable"_$S(RES:"",$P(RES,U,2)="":"",$P(RES,U,2)="NEEDS SC DETERMINATION":" NEEDS "_$$GETNOANS^IBNCPEV1(IBD4)_" DETERMINATION",1:", "_$P(RES,U,2))
"RTN","IBNCPEV",115,0)
 I X="BILL",'RES,IBIFN Q "Bill "_$$BILL(IBIFN)_" created with ERRORs"
"RTN","IBNCPEV",116,0)
 I X="BILL",'RES Q "Error: "_$P(RES,U,2)
"RTN","IBNCPEV",117,0)
 I X="BILL",'IBIFN Q $P(RES,U,2)
"RTN","IBNCPEV",118,0)
 I X="BILL" Q "Bill# "_$$BILL(+IBIFN)_" created"
"RTN","IBNCPEV",119,0)
 I X["REVERSE",$G(CR)=7,RES=1 Q "set N/B Reason: Rx deleted, no Bill to cancel."
"RTN","IBNCPEV",120,0)
 I X["REVERSE" Q $S(RES=1:"success",RES>1:"Bill# "_$$BILL(+RES)_" cancelled",'RES:"ECME Claim reversed, no Bill to cancel",1:$P(RES,U,2))
"RTN","IBNCPEV",121,0)
 I 'RES Q $P(RES,U,2)
"RTN","IBNCPEV",122,0)
 Q "OK"
"RTN","IBNCPEV",123,0)
 ;
"RTN","IBNCPEV",124,0)
 ;BILL section
"RTN","IBNCPEV",125,0)
 ;input params IBD*, IBZ, IBINS*
"RTN","IBNCPEV",126,0)
DBILL ;
"RTN","IBNCPEV",127,0)
 I '$P(IBZ,U,7),$L($P(IBZ,U,8)),$P(IBD3,U,1) D CHKP Q:IBQ  W !?10,"ERROR DESCRIPTION: ",$P(IBZ,U,8)
"RTN","IBNCPEV",128,0)
 D CHKP Q:IBQ
"RTN","IBNCPEV",129,0)
 D SUBHDR
"RTN","IBNCPEV",130,0)
 ;I $P(IBD1,U,5) D CHKP Q:IBQ  W !?10,"MEDICAL CENTER DIVISION: ",$P($G(^DG(40.8,+$P(IBD1,U,5),0)),U)
"RTN","IBNCPEV",131,0)
 I $P(IBD2,U,4) D CHKP Q:IBQ  W !?10,"DRUG:",$$DRUGAPI^IBNCPEV1(+$P(IBD2,U,4),.01)
"RTN","IBNCPEV",132,0)
 D CHKP Q:IBQ
"RTN","IBNCPEV",133,0)
 W !,?10,"NDC:",$S($P(IBD2,U,5):$P(IBD2,U,5),1:"No"),", BILLED QTY:",$S($P(IBD2,U,8):$P(IBD2,U,8),1:"No"),", DAYS SUPPLY:",$S($P(IBD2,U,9):$P(IBD2,U,9),1:"No")
"RTN","IBNCPEV",134,0)
 W !,?10,"BILLED:",$J($P(IBD3,U,2),0,2),", "
"RTN","IBNCPEV",135,0)
 W "PAID:",$J($P(IBD3,U,5),0,2)
"RTN","IBNCPEV",136,0)
 W:$P(IBD3,U,11) ", 3RD PARTY REPORTED COPAY:",$J($P(IBD3,U,11),0,2)
"RTN","IBNCPEV",137,0)
 D CHKP Q:IBQ
"RTN","IBNCPEV",138,0)
 W !?10,"PLAN:",$P($G(^IBA(355.3,+$P(IBD3,U,3),0)),U,3),", INSURANCE: ",$P($G(^DIC(36,+$G(^IBA(355.3,+$P(IBD3,U,3),0)),0)),U)
"RTN","IBNCPEV",139,0)
 D CHKP Q:IBQ
"RTN","IBNCPEV",140,0)
 D DISPUSR
"RTN","IBNCPEV",141,0)
 Q
"RTN","IBNCPEV",142,0)
 ;
"RTN","IBNCPEV",143,0)
 ;reject section
"RTN","IBNCPEV",144,0)
DREJ ;
"RTN","IBNCPEV",145,0)
 D CHKP Q:IBQ
"RTN","IBNCPEV",146,0)
 D SUBHDR
"RTN","IBNCPEV",147,0)
 I +$P(IBD3,U,3) D CHKP Q:IBQ  W !?10,"PLAN:",$P($G(^IBA(355.3,+$P(IBD3,U,3),0)),U,3),", INSURANCE: ",$P($G(^DIC(36,+$G(^IBA(355.3,+$P(IBD3,U,3),0)),0)),U)
"RTN","IBNCPEV",148,0)
 D CLRS Q:IBQ
"RTN","IBNCPEV",149,0)
 D CHKP Q:IBQ
"RTN","IBNCPEV",150,0)
 D DISPUSR
"RTN","IBNCPEV",151,0)
 Q
"RTN","IBNCPEV",152,0)
 ;close
"RTN","IBNCPEV",153,0)
DCLO ;
"RTN","IBNCPEV",154,0)
 D DREJ
"RTN","IBNCPEV",155,0)
 Q
"RTN","IBNCPEV",156,0)
 ;submit
"RTN","IBNCPEV",157,0)
DSUB ;
"RTN","IBNCPEV",158,0)
 D CHKP Q:IBQ
"RTN","IBNCPEV",159,0)
 D SUBHDR
"RTN","IBNCPEV",160,0)
 I $L($P(IBD1,U,6)) D CHKP W !?10,"PAYER RESPONSE: ",$P(IBD1,U,6)
"RTN","IBNCPEV",161,0)
 I $L($P(IBD3,U,3)) D CHKP Q:IBQ  W !?10,"PLAN:",$P($G(^IBA(355.3,+$P(IBD3,U,3),0)),U,3),", INSURANCE: ",$P($G(^DIC(36,+$G(^IBA(355.3,+$P(IBD3,U,3),0)),0)),U)
"RTN","IBNCPEV",162,0)
 D CHKP Q:IBQ
"RTN","IBNCPEV",163,0)
 D DISPUSR
"RTN","IBNCPEV",164,0)
 Q
"RTN","IBNCPEV",165,0)
 ;release
"RTN","IBNCPEV",166,0)
DREL ;
"RTN","IBNCPEV",167,0)
 D DREJ
"RTN","IBNCPEV",168,0)
 Q
"RTN","IBNCPEV",169,0)
 ;reverse
"RTN","IBNCPEV",170,0)
DREV ;
"RTN","IBNCPEV",171,0)
 D CHKP Q:IBQ
"RTN","IBNCPEV",172,0)
 D SUBHDR
"RTN","IBNCPEV",173,0)
 I $L($P(IBD1,U,6)),$E($P(IBD1,U,6),1)'="A"&($E($P(IBD1,U,6),1)'="R") S $P(IBD1,U,6)=""  ; only display accepted and rejected on REVERSALS
"RTN","IBNCPEV",174,0)
 I $L($P(IBD1,U,6)) D CHKP W !?10,"PAYER RESPONSE: ",$P(IBD1,U,6)
"RTN","IBNCPEV",175,0)
 I $L($P(IBD3,U,3)) D CHKP Q:IBQ  W !?10,"PLAN:",$P($G(^IBA(355.3,+$P(IBD3,U,3),0)),U,3),", INSURANCE: ",$P($G(^DIC(36,+$G(^IBA(355.3,+$P(IBD3,U,3),0)),0)),U)
"RTN","IBNCPEV",176,0)
 D CLRS Q:IBQ
"RTN","IBNCPEV",177,0)
 D CHKP Q:IBQ
"RTN","IBNCPEV",178,0)
 D DISPUSR
"RTN","IBNCPEV",179,0)
 W !?10,"REVERSAL REASON:",$P(IBD1,U,7)
"RTN","IBNCPEV",180,0)
 Q
"RTN","IBNCPEV",181,0)
 ;
"RTN","IBNCPEV",182,0)
BCANC ; bill cancellation generated by auto-reversal (duplicate bill)
"RTN","IBNCPEV",183,0)
 D CHKP Q:IBQ
"RTN","IBNCPEV",184,0)
 W !?10,"SYSTEM FOUND DUPLICATE BILL WHILE PROCESSING CLAIM"
"RTN","IBNCPEV",185,0)
 D CHKP Q:IBQ
"RTN","IBNCPEV",186,0)
 D DISPUSR
"RTN","IBNCPEV",187,0)
 Q
"RTN","IBNCPEV",188,0)
 ;
"RTN","IBNCPEV",189,0)
RELT(X) I X W ",",?45,"RELEASE DATE:",$$TIM(X)
"RTN","IBNCPEV",190,0)
 Q
"RTN","IBNCPEV",191,0)
CLRS ;
"RTN","IBNCPEV",192,0)
 N TX,PP,RC
"RTN","IBNCPEV",193,0)
 S TX="CLOSE REASON"
"RTN","IBNCPEV",194,0)
 S PP="DROP TO PAPER"
"RTN","IBNCPEV",195,0)
 S RC="RELEASE COPAY"
"RTN","IBNCPEV",196,0)
 I $P(IBD3,U,7)'="" D CHKP Q:IBQ  W !?10,TX,":",$$REASON^IBNCPDPU($P(IBD3,U,7)) W:$P(IBD3,U,8) ", ",PP W:$P(IBD3,U,9) ", ",RC
"RTN","IBNCPEV",197,0)
 S TX="CLOSE COMMENT"
"RTN","IBNCPEV",198,0)
 I $L($P(IBD3,U,6))>2 D CHKP Q:IBQ  W !?10,"COMMENT:",$P(IBD3,U,6)
"RTN","IBNCPEV",199,0)
 Q
"RTN","IBNCPEV",200,0)
 ;
"RTN","IBNCPEV",201,0)
HDR ;header
"RTN","IBNCPEV",202,0)
 W @IOF S IBPAGE=IBPAGE+1 W ?72,"PAGE ",IBPAGE
"RTN","IBNCPEV",203,0)
 W !,$$DISPTITL^IBNCPEV1(IBBDT,IBEDT,IBDTL,.IBDIVS)
"RTN","IBNCPEV",204,0)
 W:IBDIVS'=0 !,$$DISPLDIV^IBNCPEV1(.IBDIVS)
"RTN","IBNCPEV",205,0)
 W !?15
"RTN","IBNCPEV",206,0)
 I IBM1="R" W "SINGLE PRESCRIPTION - ",$$RXNUM(IBRX),"  "
"RTN","IBNCPEV",207,0)
 I IBM1="P" W "SINGLE PATIENT - ",$P($G(^DPT(IBPAT,0)),U),"  "
"RTN","IBNCPEV",208,0)
 I IBM1="E" W "SINGLE ECME # - ",IBECME
"RTN","IBNCPEV",209,0)
 I IBM2="E" W "ECME BILLABLE RX  "
"RTN","IBNCPEV",210,0)
 I IBM2="N" W "NON ECME BILLABLE RX  "
"RTN","IBNCPEV",211,0)
 I IBM3'="A",IBM1'="R" W $S(IBM3="M":"MAIL",IBM3="C":"CMOP",1:"WINDOW")_" PRESCRIPTIONS ONLY"
"RTN","IBNCPEV",212,0)
 W !,?4," RX#   FILL  DATE       PATIENT NAME",?55,"DRUG"
"RTN","IBNCPEV",213,0)
 N I W ! F I=1:1:80 W "="
"RTN","IBNCPEV",214,0)
 Q
"RTN","IBNCPEV",215,0)
 ;
"RTN","IBNCPEV",216,0)
ULINE(X) ;line
"RTN","IBNCPEV",217,0)
 D CHKP Q:IBQ
"RTN","IBNCPEV",218,0)
 N I W ! F I=1:1:80 W $G(X,"-")
"RTN","IBNCPEV",219,0)
 Q
"RTN","IBNCPEV",220,0)
CHKP ;Check for EOP
"RTN","IBNCPEV",221,0)
 N Y
"RTN","IBNCPEV",222,0)
 I $Y>(IOSL-4) D:IBSCR PAUSE Q:IBQ  D HDR
"RTN","IBNCPEV",223,0)
 Q
"RTN","IBNCPEV",224,0)
DAT(X,Y) Q $$DAT1^IBOUTL(X,.Y)
"RTN","IBNCPEV",225,0)
TIM(X) N IBT ;time
"RTN","IBNCPEV",226,0)
 S IBT=$$DAT1^IBOUTL(X,1) I $L(IBT," ")<3 Q IBT
"RTN","IBNCPEV",227,0)
 I $P(IBT," ",3)="pm" S IBT=$P(IBT," ",1,2)_"p" Q IBT
"RTN","IBNCPEV",228,0)
 I $P(IBT," ",3)="am" S IBT=$P(IBT," ",1,2)_"a" Q IBT
"RTN","IBNCPEV",229,0)
 Q IBT
"RTN","IBNCPEV",230,0)
 ;
"RTN","IBNCPEV",231,0)
USR(X) ;
"RTN","IBNCPEV",232,0)
 I $D(^VA(200,+X,0)) Q $P(^(0),U)
"RTN","IBNCPEV",233,0)
 Q X
"RTN","IBNCPEV",234,0)
 ;
"RTN","IBNCPEV",235,0)
PAT(DFN) ;
"RTN","IBNCPEV",236,0)
 Q $P($G(^DPT(DFN,0),"?"),"^")
"RTN","IBNCPEV",237,0)
BILL(BN) ;
"RTN","IBNCPEV",238,0)
 Q $P($G(^DGCR(399,BN,0),"?"),"^")
"RTN","IBNCPEV",239,0)
ARBILL(BN) ;
"RTN","IBNCPEV",240,0)
 Q $P($G(^PRCA(430,BN,0),"?"),"^")
"RTN","IBNCPEV",241,0)
 ;
"RTN","IBNCPEV",242,0)
 ;Returns
"RTN","IBNCPEV",243,0)
 ;return DRUG name (#50,.01)
"RTN","IBNCPEV",244,0)
 ;IBDFN - IEN in PATIENT file #2
"RTN","IBNCPEV",245,0)
 ;IBRX - IEN in PRESCRIPTION file #52
"RTN","IBNCPEV",246,0)
DRUG(IBDFN,IBRX) ;
"RTN","IBNCPEV",247,0)
 I +$G(IBDFN)=0 Q ""
"RTN","IBNCPEV",248,0)
 N X1
"RTN","IBNCPEV",249,0)
 K ^TMP($J,"IBNCPDP52")
"RTN","IBNCPEV",250,0)
 D RX^PSO52API(IBDFN,"IBNCPDP52",IBRX,"",0)
"RTN","IBNCPEV",251,0)
 S X1=+$G(^TMP($J,"IBNCPDP52",IBDFN,IBRX,6))
"RTN","IBNCPEV",252,0)
 K ^TMP($J,"IBNCPDP52")
"RTN","IBNCPEV",253,0)
 I X1=0 Q ""
"RTN","IBNCPEV",254,0)
 Q $$DRUGNAM^IBNCPEV1(X1)
"RTN","IBNCPEV",255,0)
 ;
"RTN","IBNCPEV",256,0)
EVNT(X) ;Transl
"RTN","IBNCPEV",257,0)
 I X="BILL" Q "BILLING"
"RTN","IBNCPEV",258,0)
 I X="REVERSE" Q "REVERSAL"
"RTN","IBNCPEV",259,0)
 I X="AUTO REVERSE" Q "REVERSAL(A)"
"RTN","IBNCPEV",260,0)
 I X["RELEASE" Q "RELEASE"
"RTN","IBNCPEV",261,0)
 I X["SUBMIT" Q "SUBMIT"
"RTN","IBNCPEV",262,0)
 I X["CLOSE" Q "CLOSE"
"RTN","IBNCPEV",263,0)
 I X[IBSC Q "FINISH"  ;IBSC = "STATUS CHECK"
"RTN","IBNCPEV",264,0)
 Q X
"RTN","IBNCPEV",265,0)
 ;
"RTN","IBNCPEV",266,0)
BOCD(X) ;Basis of Cost Determ
"RTN","IBNCPEV",267,0)
 I +X=7 Q "USUAL & CUSTOMARY"
"RTN","IBNCPEV",268,0)
 I +X=1 Q "AWP"
"RTN","IBNCPEV",269,0)
 I +X=5 Q "COST CALCULATIONS"
"RTN","IBNCPEV",270,0)
 Q X
"RTN","IBNCPEV",271,0)
 ;
"RTN","IBNCPEV",272,0)
PAUSE ;
"RTN","IBNCPEV",273,0)
 N X U IO(0) W !,"Press RETURN to continue, '^' to exit:" R X:DTIME S:'$T X="^" S:X["^" IBQ=1
"RTN","IBNCPEV",274,0)
 U IO
"RTN","IBNCPEV",275,0)
 Q
"RTN","IBNCPEV",276,0)
 ;
"RTN","IBNCPEV",277,0)
SUBHDR ;
"RTN","IBNCPEV",278,0)
 W !?10,"ECME# ",$P(IBD1,U,3),",",?25,"FILL DATE:",$$DAT($P(IBD2,U,6))
"RTN","IBNCPEV",279,0)
 D RELT($P(IBD2,U,7))
"RTN","IBNCPEV",280,0)
 Q
"RTN","IBNCPEV",281,0)
DISPUSR ;
"RTN","IBNCPEV",282,0)
 W !?10,"USER:",$$USR(+$P(IBD3,U,10))
"RTN","IBNCPEV",283,0)
 Q
"RTN","IBNCPEV",284,0)
 ;
"RTN","IBNCPEV",285,0)
 ;Returns RX number (external value: #52,.01)
"RTN","IBNCPEV",286,0)
 ;IBRX - IEN in PRESCRIPTION file #52
"RTN","IBNCPEV",287,0)
RXNUM(IBRX) ;
"RTN","IBNCPEV",288,0)
 Q $$RXAPI1^IBNCPUT1(IBRX,.01,"E")
"RTN","IBNCPEV",289,0)
 ;
"RTN","IBNCPNB")
0^42^B37701881
"RTN","IBNCPNB",1,0)
IBNCPNB ;OAK/ELZ - UTILITIES FOR NCPCP ;5/22/08  15:23
"RTN","IBNCPNB",2,0)
 ;;2.0;INTEGRATED BILLING;**276,342,384**;21-MAR-94;Build 74
"RTN","IBNCPNB",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBNCPNB",4,0)
 ;
"RTN","IBNCPNB",5,0)
 ;NCPDP PHASE III
"RTN","IBNCPNB",6,0)
 Q
"RTN","IBNCPNB",7,0)
 ;
"RTN","IBNCPNB",8,0)
 ;
"RTN","IBNCPNB",9,0)
NONBR(DFN,IBRX,IBFIL,IBADT,IBCR,IBPAP,IBRC,IBCC,IBUSER) ; Set non-billable reason to CT
"RTN","IBNCPNB",10,0)
 ; input:
"RTN","IBNCPNB",11,0)
 ;    DFN - Patient
"RTN","IBNCPNB",12,0)
 ;    IBRX - Rx IEN
"RTN","IBNCPNB",13,0)
 ;    IBFIL - fill#
"RTN","IBNCPNB",14,0)
 ;    IBADT - fill date
"RTN","IBNCPNB",15,0)
 ;    IBCR - Close Claim Reason (#356.8)
"RTN","IBNCPNB",16,0)
 ;    IBPAP - Autobillable flag (billable (1) / non-billable (0) flag)
"RTN","IBNCPNB",17,0)
 ;    IBRC - Release Copay (entered by OPECC)
"RTN","IBNCPNB",18,0)
 ;    IBCC - Close Reason Comment (entered by OPECC)
"RTN","IBNCPNB",19,0)
 ;    IBUSER - DUZ of user triggering the billing event
"RTN","IBNCPNB",20,0)
 N IBTRKRN,DIE,IBRESN,DR,DA,IBRMARK,IBLOCK,IBEABD,IBEABD,IBACT,IBFDA
"RTN","IBNCPNB",21,0)
 ; update claims tracking
"RTN","IBNCPNB",22,0)
 S IBTRKRN=+$O(^IBT(356,"ARXFL",IBRX,IBFIL,0))
"RTN","IBNCPNB",23,0)
 I 'IBTRKRN D  ; if it doesn't exist - create it
"RTN","IBNCPNB",24,0)
 . N IBTRKR
"RTN","IBNCPNB",25,0)
 . S IBTRKR=$G(^IBE(350.9,1,6)) ; claims tracking info
"RTN","IBNCPNB",26,0)
 . ; date can't be before parameters
"RTN","IBNCPNB",27,0)
 . S $P(IBTRKR,U)=$S('$P(IBTRKR,U,4):0,+IBTRKR&(IBADT<+IBTRKR):0,1:IBADT)
"RTN","IBNCPNB",28,0)
 . I 'IBTRKR Q  ; CT Disabled
"RTN","IBNCPNB",29,0)
 . D CT^IBNCPDPU(DFN,IBRX,IBFIL,IBADT,$G(IBCR))
"RTN","IBNCPNB",30,0)
 . S IBTRKRN=+$O(^IBT(356,"ARXFL",IBRX,IBFIL,0))
"RTN","IBNCPNB",31,0)
 I 'IBTRKRN Q  ; CT disabled
"RTN","IBNCPNB",32,0)
 L +^IBT(356,IBTRKRN):10 S IBLOCK=$T
"RTN","IBNCPNB",33,0)
 S DIE="^IBT(356,",DA=IBTRKRN
"RTN","IBNCPNB",34,0)
 ;
"RTN","IBNCPNB",35,0)
 ;
"RTN","IBNCPNB",36,0)
 ; if Billable - set EABD+60
"RTN","IBNCPNB",37,0)
 I '$G(IBCR) D  G NONBRQ
"RTN","IBNCPNB",38,0)
 .Q:$$GET1^DIQ(356,IBTRKRN_",",.19,"I")  ;quit if non-billable
"RTN","IBNCPNB",39,0)
 .S IBEABD=$$EABD^IBTUTL($O(^IBE(356.6,"AC",4,0)),IBADT)
"RTN","IBNCPNB",40,0)
 .I IBEABD S IBEABD=$$FMADD^XLFDT(IBEABD,60)
"RTN","IBNCPNB",41,0)
 .S DR=".17////^S X=IBEABD" D ^DIE
"RTN","IBNCPNB",42,0)
 ;
"RTN","IBNCPNB",43,0)
 ; if still billable, set the EABD.
"RTN","IBNCPNB",44,0)
 ;
"RTN","IBNCPNB",45,0)
 ; Don't check for the 2nd insurance in Phase 3 --
"RTN","IBNCPNB",46,0)
 ; allow the claim to become non-billable, ECME has already warned
"RTN","IBNCPNB",47,0)
 ; the user and provided information about the 2nd insurance
"RTN","IBNCPNB",48,0)
 ; in the User Screen
"RTN","IBNCPNB",49,0)
 ; I IBPAP!$$MOREINS(DFN,IBADT) D  G NONBRQ
"RTN","IBNCPNB",50,0)
 ;
"RTN","IBNCPNB",51,0)
 I IBPAP D  G NONBRQ
"RTN","IBNCPNB",52,0)
 . S IBEABD=$$EABD^IBTUTL($O(^IBE(356.6,"AC",4,0)),IBADT)
"RTN","IBNCPNB",53,0)
 . I IBEABD<DT S IBEABD=DT
"RTN","IBNCPNB",54,0)
 . S DR=".19///@" D ^DIE ; it re-sets .17 (trigger in #356)
"RTN","IBNCPNB",55,0)
 . S DR=".17////^S X=IBEABD"
"RTN","IBNCPNB",56,0)
 . S IBRMARK=$$REASON^IBNCPDPU(IBCR)
"RTN","IBNCPNB",57,0)
 . I IBCC'="" S IBRMARK=IBRMARK_"; "_IBCC
"RTN","IBNCPNB",58,0)
 . I $L($G(IBCC))>2 S DR=DR_";1.08////^S X=$E(IBRMARK,1,80)"
"RTN","IBNCPNB",59,0)
 . D ^DIE
"RTN","IBNCPNB",60,0)
 ;
"RTN","IBNCPNB",61,0)
 ; set non-billable reason
"RTN","IBNCPNB",62,0)
 S IBRMARK=$$REASON^IBNCPDPU(IBCR)
"RTN","IBNCPNB",63,0)
 I IBRMARK="" S IBRMARK="OTHER" S IBCC="Unknown NBR '"_IBCR_"'. "_$G(IBCC)
"RTN","IBNCPNB",64,0)
 S DR=".19///"_IBRMARK
"RTN","IBNCPNB",65,0)
 I $L($G(IBCC))>2 S DR=DR_";1.08////^S X=$E(IBCC,1,80)"
"RTN","IBNCPNB",66,0)
 D ^DIE
"RTN","IBNCPNB",67,0)
 ;
"RTN","IBNCPNB",68,0)
NONBRQ ;
"RTN","IBNCPNB",69,0)
 I $G(IBRC) D  ; Release Copay
"RTN","IBNCPNB",70,0)
 . S IBACT=+$$RELCOPAY(DFN,IBRX,IBFIL,1,IBADT,0) ; release copay charges off hold
"RTN","IBNCPNB",71,0)
 . ;if 0 (not found on HOLD) we will have one more attempt, it was scheduled inside RELCOPAY
"RTN","IBNCPNB",72,0)
 . ; so doesn't make sense to send "NOT RELEASED" e-mail
"RTN","IBNCPNB",73,0)
 . ; if the 2nd attempt fails then e-mail will be send from RCTASK
"RTN","IBNCPNB",74,0)
 . ;we send e-mail only if -1 i.e. if charge was found on hold but
"RTN","IBNCPNB",75,0)
 . ; ^IBR gave an error when we tried to release it
"RTN","IBNCPNB",76,0)
 . I IBACT=-1 D RELBUL^IBNCPEB(DFN,IBRX,IBFIL,IBADT,IBACT,IBCR,$G(IBCC),0,1)
"RTN","IBNCPNB",77,0)
 . ;if -2 (there is no copay) then do nothing
"RTN","IBNCPNB",78,0)
 S IBFDA(356,IBTRKRN_",",1.03)=DT  ; date last edited
"RTN","IBNCPNB",79,0)
 S IBFDA(356,IBTRKRN_",",1.04)=IBUSER   ; last edited by
"RTN","IBNCPNB",80,0)
 D FILE^DIE("","IBFDA"),MSG^DIALOG()
"RTN","IBNCPNB",81,0)
 I IBLOCK L -^IBT(356,IBTRKRN)
"RTN","IBNCPNB",82,0)
 Q
"RTN","IBNCPNB",83,0)
 ;
"RTN","IBNCPNB",84,0)
 ;
"RTN","IBNCPNB",85,0)
RELCOPAY(DFN,IBRX,IBFIL,IBRETRY,IBADT,IBIFN) ; Release copay charges on hold
"RTN","IBNCPNB",86,0)
 ; Input:
"RTN","IBNCPNB",87,0)
 ;    DFN - Patient IEN
"RTN","IBNCPNB",88,0)
 ;    IBRX - Rx IEN
"RTN","IBNCPNB",89,0)
 ;    IBFIL - fill/refill #
"RTN","IBNCPNB",90,0)
 ;    IBRETRY - retry flag
"RTN","IBNCPNB",91,0)
 ;    IBADT - fill date
"RTN","IBNCPNB",92,0)
 ;    IBIFN - 3rd party bill IEN
"RTN","IBNCPNB",93,0)
 ; output:
"RTN","IBNCPNB",94,0)
 ;    -2  == there is no any copay
"RTN","IBNCPNB",95,0)
 ;    -1^error code if unsuccessful  == if ^IBR error
"RTN","IBNCPNB",96,0)
 ;    0   == charge was not found (and depends on IBRETRY another attempt can be scheduled)
"RTN","IBNCPNB",97,0)
 ;    >0  == charge was released from HOLD
"RTN","IBNCPNB",98,0)
 ; this procedure will be called if the Payer agreed to pay 0.00
"RTN","IBNCPNB",99,0)
 ; or the claim was closed as non-billable by the OPECC.
"RTN","IBNCPNB",100,0)
 ; if patient exempt from RX copay then there is nothing to release from HOLD - quit
"RTN","IBNCPNB",101,0)
 I +$$RXEXMT^IBARXEU0(DFN,IBADT)=1 Q -2
"RTN","IBNCPNB",102,0)
 N IBACT,IBZ,IBFOUND,IBX,IBSEQNO,IBNOS,Y,IBDUZ,RCDUZ
"RTN","IBNCPNB",103,0)
 ; Schedule the task to speed up the whole process
"RTN","IBNCPNB",104,0)
 I 'IBRETRY D RCTASK(DFN,IBRX,IBFIL,+IBRETRY,IBADT,IBIFN) Q 0
"RTN","IBNCPNB",105,0)
 S IBFOUND=0
"RTN","IBNCPNB",106,0)
 S IBACT="A" F  S IBACT=$O(^IB("AH",DFN,IBACT),-1) Q:'IBACT  D  Q:IBFOUND
"RTN","IBNCPNB",107,0)
 . S IBZ=$G(^IB(IBACT,0)) Q:IBZ=""
"RTN","IBNCPNB",108,0)
 . S IBX=$P(IBZ,U,4)
"RTN","IBNCPNB",109,0)
 . I +IBX'=52 Q  ; not an Rx
"RTN","IBNCPNB",110,0)
 . I +$P(IBX,":",2)'=IBRX Q  ; other Rx
"RTN","IBNCPNB",111,0)
 . I +$P(IBX,":",3)'=IBFIL Q  ; other fill
"RTN","IBNCPNB",112,0)
 . S IBFOUND=IBACT
"RTN","IBNCPNB",113,0)
 I 'IBFOUND D RCTASK(DFN,IBRX,IBFIL,+$G(IBRETRY),IBADT,IBIFN) Q 0
"RTN","IBNCPNB",114,0)
 S IBSEQNO=1,IBNOS=IBFOUND
"RTN","IBNCPNB",115,0)
 S IBDUZ=$P($G(^IB(IBFOUND,1)),U) ; who entered the copay charge?
"RTN","IBNCPNB",116,0)
 S RCDUZ=IBDUZ
"RTN","IBNCPNB",117,0)
 D ^IBR I Y<0 Q Y
"RTN","IBNCPNB",118,0)
 Q IBFOUND
"RTN","IBNCPNB",119,0)
 ;
"RTN","IBNCPNB",120,0)
 ;Called by TaskMan
"RTN","IBNCPNB",121,0)
RELCRG ;
"RTN","IBNCPNB",122,0)
 N IBACT
"RTN","IBNCPNB",123,0)
 S IBACT=+$$RELCOPAY(DFN,IBRX,IBFIL,IBRETRY,IBADT,IBIFN)
"RTN","IBNCPNB",124,0)
 ;if 0 (not found on HOLD) we will have another attempt
"RTN","IBNCPNB",125,0)
 ;we send e-mail only if -1 (^IBR error)
"RTN","IBNCPNB",126,0)
 I IBACT=-1 D RELBUL^IBNCPEB(DFN,IBRX,IBFIL,IBADT,IBACT,0,"",IBIFN,IBRETRY)
"RTN","IBNCPNB",127,0)
 ;
"RTN","IBNCPNB",128,0)
 Q
"RTN","IBNCPNB",129,0)
 ;
"RTN","IBNCPNB",130,0)
 ;Schedule Release Copay
"RTN","IBNCPNB",131,0)
RCTASK(DFN,IBRX,IBFIL,IBRETRY,IBADT,IBIFN) ;
"RTN","IBNCPNB",132,0)
 N I,ZTRTN,ZTSAVE,ZTDESC,ZTDTH,ZTIO
"RTN","IBNCPNB",133,0)
 S IBRETRY=IBRETRY+1
"RTN","IBNCPNB",134,0)
 I IBRETRY>2 D  Q  ; Only two extra attempts
"RTN","IBNCPNB",135,0)
 . ;if all attempts were unsuccessful then send e-mail, set IBACT=0 since we do not have it
"RTN","IBNCPNB",136,0)
 . D RELBUL^IBNCPEB(DFN,IBRX,IBFIL,IBADT,0,0,"",IBIFN,2)
"RTN","IBNCPNB",137,0)
 S ZTRTN="RELCRG^IBNCPNB"
"RTN","IBNCPNB",138,0)
 F I="DFN","IBRX","IBFIL","IBRETRY","IBADT","IBIFN" S ZTSAVE(I)=""
"RTN","IBNCPNB",139,0)
 S ZTDESC="RELEASE COPAY RX IEN# "_IBRX
"RTN","IBNCPNB",140,0)
 S ZTIO=""
"RTN","IBNCPNB",141,0)
 S ZTDTH=$$HADD^XLFDT($H,0,0,0,$S(IBRETRY=1:10,1:600))
"RTN","IBNCPNB",142,0)
 D ^%ZTLOAD
"RTN","IBNCPNB",143,0)
 Q
"RTN","IBNCPNB",144,0)
 ;
"RTN","IBNCPNB",145,0)
 ;
"RTN","IBNCPNB",146,0)
 ; does the pat have >1 billable insur with pharm coverage?
"RTN","IBNCPNB",147,0)
MOREINS(DFN,IBADT) ;
"RTN","IBNCPNB",148,0)
 ; DFN - ptr to the patient
"RTN","IBNCPNB",149,0)
 ; IBADT - the effective date
"RTN","IBNCPNB",150,0)
 N IBANY,IBX,IBINS,IBT,IBRES,IBCAT
"RTN","IBNCPNB",151,0)
 S IBRES=0 ; No by default
"RTN","IBNCPNB",152,0)
 S IBCAT=$O(^IBE(355.31,"B","PHARMACY",0))
"RTN","IBNCPNB",153,0)
 ; -- look up insurance for patient
"RTN","IBNCPNB",154,0)
 D ALL^IBCNS1(DFN,"IBINS",1,IBADT,1)
"RTN","IBNCPNB",155,0)
 S IBX=0 F  S IBX=$O(IBINS("S",IBX)) Q:'IBX  D  Q:IBRES>1
"RTN","IBNCPNB",156,0)
 . S IBT=0 F  S IBT=$O(IBINS("S",IBX,IBT)) Q:'IBT  D  Q:IBRES>1
"RTN","IBNCPNB",157,0)
 . . N IBPL
"RTN","IBNCPNB",158,0)
 . . S IBPL=+$P($G(IBINS(IBT,0)),U,18) Q:'IBPL
"RTN","IBNCPNB",159,0)
 . . I '$$PLCOV^IBCNSU3(IBPL,IBADT,IBCAT) Q
"RTN","IBNCPNB",160,0)
 . . S IBRES=IBRES+1
"RTN","IBNCPNB",161,0)
 ;
"RTN","IBNCPNB",162,0)
 Q (IBRES>1)
"RTN","IBNCPNB",163,0)
 ;
"RTN","IBNCPNB",164,0)
 ;Relocated from IBNCPDPU
"RTN","IBNCPNB",165,0)
NDC(X) ; Massage the NDC as it is stored in Pharmacy
"RTN","IBNCPNB",166,0)
 ;  Input:  X  --  The NDC as it is stored in Pharmacy
"RTN","IBNCPNB",167,0)
 ; Output:  X  --  The NDC in the format 5N 1"-" 4N 1"-" 2N
"RTN","IBNCPNB",168,0)
 ;
"RTN","IBNCPNB",169,0)
 I $G(X)="" S X="" G NDCQ
"RTN","IBNCPNB",170,0)
 ;
"RTN","IBNCPNB",171,0)
 N LEN,PCE,Y,Z
"RTN","IBNCPNB",172,0)
 ;
"RTN","IBNCPNB",173,0)
 S Z(1)=5,Z(2)=4,Z(3)=2
"RTN","IBNCPNB",174,0)
 S PCE=0 F  S PCE=$O(Z(PCE)) Q:'PCE  S LEN=Z(PCE) D
"RTN","IBNCPNB",175,0)
 .S Y=$P(X,"-",PCE)
"RTN","IBNCPNB",176,0)
 .I $L(Y)>LEN S Y=$E(Y,2,LEN+1)
"RTN","IBNCPNB",177,0)
 .I $L(+Y)<LEN S Y=$$FILL^IBNCPDPU(Y,LEN)
"RTN","IBNCPNB",178,0)
 .S $P(X,"-",PCE)=Y
"RTN","IBNCPNB",179,0)
 ;
"RTN","IBNCPNB",180,0)
NDCQ Q X
"RTN","IBNCPNB",181,0)
 ;
"RTN","IBNCPNB",182,0)
ERMSG(IBSTL) ; Inactive status reason
"RTN","IBNCPNB",183,0)
 N IBSTA,IBI,IBARR,IBTXT
"RTN","IBNCPNB",184,0)
 D STATAR^IBCNRU1(.IBARR)
"RTN","IBNCPNB",185,0)
 F IBI=1:1:$L(IBSTL,",")+1 S IBSTA=+$P(IBSTL,",",IBI) Q:"^100^200^300^400^"'[(U_IBSTA_U)
"RTN","IBNCPNB",186,0)
 S IBTXT=$G(IBARR(+IBSTA),"Plan is not active.")
"RTN","IBNCPNB",187,0)
 Q IBTXT
"RTN","IBNCPNB",188,0)
 ;
"RTN","IBNCPNB",189,0)
PAPERBIL(IBTRKRN) ; 'paper' bill in CT?
"RTN","IBNCPNB",190,0)
 N IBZ,IBIFN
"RTN","IBNCPNB",191,0)
 S IBZ=$G(^IBT(356,IBTRKRN,0)) I IBZ="" Q 0
"RTN","IBNCPNB",192,0)
 S IBIFN=+$P(IBZ,U,11) I 'IBIFN Q 0
"RTN","IBNCPNB",193,0)
 I $P($G(^DGCR(399,IBIFN,0)),U,13)=7 Q 0  ; cancelled
"RTN","IBNCPNB",194,0)
 I $P($G(^DGCR(399,IBIFN,"M1")),U,8)'="" Q 0  ; ecme bill
"RTN","IBNCPNB",195,0)
 Q 1
"RTN","IBNCPNB",196,0)
 ;IBNCPNB
"RTN","IBNCPUT1")
0^33^B20040520
"RTN","IBNCPUT1",1,0)
IBNCPUT1 ;BHAM ISC/SS - IB NCPDP UTILITIES ;22-MAR-2006
"RTN","IBNCPUT1",2,0)
 ;;2.0;INTEGRATED BILLING;**342,363,384**;21-MAR-94;Build 74
"RTN","IBNCPUT1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBNCPUT1",4,0)
 ;
"RTN","IBNCPUT1",5,0)
 ;Utilities for NPCDP
"RTN","IBNCPUT1",6,0)
 ;/**
"RTN","IBNCPUT1",7,0)
 ;Creates a new entry in the file or subfile with .01 field
"RTN","IBNCPUT1",8,0)
 ;IBFILE - file/subfile #
"RTN","IBNCPUT1",9,0)
 ;IBIEN - ien of the parent file entry in which the new subfile entry will be inserted
"RTN","IBNCPUT1",10,0)
 ;IBVAL01 - .01 value for the new entry
"RTN","IBNCPUT1",11,0)
 ;NEWRECNO -(optional) specify IEN if you want specific value
"RTN","IBNCPUT1",12,0)
 ; Note: if "" then the system will assign the entry number itself.
"RTN","IBNCPUT1",13,0)
 ;IBFLGS - FLAGS parameter for UPDATE^DIE
"RTN","IBNCPUT1",14,0)
 ;
"RTN","IBNCPUT1",15,0)
 ;Examples
"RTN","IBNCPUT1",16,0)
 ;top level:
"RTN","IBNCPUT1",17,0)
 ; INSITEM(366.14,"",IBDATE,"")
"RTN","IBNCPUT1",18,0)
 ; INSITEM(366.14,"",IBDATE,45)
"RTN","IBNCPUT1",19,0)
 ; 
"RTN","IBNCPUT1",20,0)
 ;1st level multiple:
"RTN","IBNCPUT1",21,0)
 ; subfile number = #366.141
"RTN","IBNCPUT1",22,0)
 ; parent file #366.14 entry number = 345
"RTN","IBNCPUT1",23,0)
 ; INSITEM(366.141,345,"SUBMIT","")
"RTN","IBNCPUT1",24,0)
 ; to create mupltiple entry with particular entry number = 23
"RTN","IBNCPUT1",25,0)
 ; INSITEM(366.141,345,"SUBMIT",23)
"RTN","IBNCPUT1",26,0)
 ;
"RTN","IBNCPUT1",27,0)
 ;2nd level multiple
"RTN","IBNCPUT1",28,0)
 ;parent file #366.14 entry number = 234
"RTN","IBNCPUT1",29,0)
 ;parent multiple entry number = 55
"RTN","IBNCPUT1",30,0)
 ;create mupltiple entry INSURANCE
"RTN","IBNCPUT1",31,0)
 ; INSITEM(366.1412,"55,234","INS","")
"RTN","IBNCPUT1",32,0)
 ; results in :
"RTN","IBNCPUT1",33,0)
 ; ^IBCNR(366.14,234,1,55,5,0)=^366.1412PA^1^1
"RTN","IBNCPUT1",34,0)
 ; ^IBCNR(366.14,234,1,55,5,1,0)=INS
"RTN","IBNCPUT1",35,0)
 ; ^IBCNR(366.14,234,1,55,5,"B","INS",1)=
"RTN","IBNCPUT1",36,0)
 ;  (DD node for this muptiple =5 ) 
"RTN","IBNCPUT1",37,0)
 ;  
"RTN","IBNCPUT1",38,0)
 ;output :
"RTN","IBNCPUT1",39,0)
 ; positive number - record # created
"RTN","IBNCPUT1",40,0)
 ; <=0 - failure
"RTN","IBNCPUT1",41,0)
 ;  See description above
"RTN","IBNCPUT1",42,0)
INSITEM(IBFILE,IBIEN,IBVAL01,NEWRECNO,IBFLGS) ;*/
"RTN","IBNCPUT1",43,0)
 N IBSSI,IBIENS,IBFDA,IBERR
"RTN","IBNCPUT1",44,0)
 I '$G(NEWRECNO) N NEWRECNO S NEWRECNO=$G(NEWRECNO)
"RTN","IBNCPUT1",45,0)
 I IBIEN'="" S IBIENS="+1,"_IBIEN_"," I $L(NEWRECNO)>0 S IBSSI(1)=+NEWRECNO
"RTN","IBNCPUT1",46,0)
 I IBIEN="" S IBIENS="+1," I $L(NEWRECNO)>0 S IBSSI(1)=+NEWRECNO
"RTN","IBNCPUT1",47,0)
 S IBFDA(IBFILE,IBIENS,.01)=IBVAL01
"RTN","IBNCPUT1",48,0)
 D UPDATE^DIE($G(IBFLGS),"IBFDA","IBSSI","IBERR")
"RTN","IBNCPUT1",49,0)
 I $D(IBERR) D BMES^XPDUTL(IBERR("DIERR",1,"TEXT",1)) Q -1  ;D BMES^XPDUTL(IBERR("DIERR",1,"TEXT",1)) 
"RTN","IBNCPUT1",50,0)
 Q +$G(IBSSI(1))
"RTN","IBNCPUT1",51,0)
 ;
"RTN","IBNCPUT1",52,0)
 ;
"RTN","IBNCPUT1",53,0)
 ;fill fields
"RTN","IBNCPUT1",54,0)
 ;Input:
"RTN","IBNCPUT1",55,0)
 ;FILENO file number
"RTN","IBNCPUT1",56,0)
 ;FLDNO field number
"RTN","IBNCPUT1",57,0)
 ;RECIEN ien string 
"RTN","IBNCPUT1",58,0)
 ;NEWVAL new value to file
"RTN","IBNCPUT1",59,0)
 ;Output:
"RTN","IBNCPUT1",60,0)
 ;0^ NEWVAL^error if failure
"RTN","IBNCPUT1",61,0)
 ;1^ NEWVAL if success
"RTN","IBNCPUT1",62,0)
FILLFLDS(FILENO,FLDNO,RECIEN,NEWVAL) ;
"RTN","IBNCPUT1",63,0)
 N RECIENS,FDA,ERRARR
"RTN","IBNCPUT1",64,0)
 S RECIENS=RECIEN_","
"RTN","IBNCPUT1",65,0)
 S FDA(FILENO,RECIENS,FLDNO)=NEWVAL
"RTN","IBNCPUT1",66,0)
 D FILE^DIE("","FDA","ERRARR")
"RTN","IBNCPUT1",67,0)
 I $D(ERRARR) Q "0^"_NEWVAL_"^"_ERRARR("DIERR",1,"TEXT",1)
"RTN","IBNCPUT1",68,0)
 Q "1^"_NEWVAL
"RTN","IBNCPUT1",69,0)
 ;
"RTN","IBNCPUT1",70,0)
 ;convert external value of the field EVENT TYPE to its internal value
"RTN","IBNCPUT1",71,0)
 ;IA# 10155
"RTN","IBNCPUT1",72,0)
EXT2INT(IBEXTRN) ;
"RTN","IBNCPUT1",73,0)
 N IBDD,IBZ,IBCNT,IBINTERN
"RTN","IBNCPUT1",74,0)
 S IBINTERN=-1
"RTN","IBNCPUT1",75,0)
 S IBDD=$P($G(^DD(366.141,.01,0)),U,3) ;IA# 10155
"RTN","IBNCPUT1",76,0)
 F IBCNT=1:1 S IBZ=$P(IBDD,";",IBCNT) Q:IBZ=""  D  Q:IBINTERN'<0
"RTN","IBNCPUT1",77,0)
 . I $P(IBZ,":",2)=IBEXTRN S IBINTERN=+IBZ
"RTN","IBNCPUT1",78,0)
 Q:IBINTERN<0 0  ;treat as UNKNOWN
"RTN","IBNCPUT1",79,0)
 Q IBINTERN
"RTN","IBNCPUT1",80,0)
 ;
"RTN","IBNCPUT1",81,0)
 ;
"RTN","IBNCPUT1",82,0)
 ;should RX copay from the entry in file #350 be placed on hold ?
"RTN","IBNCPUT1",83,0)
 ;called from HOLD^IBRUTL
"RTN","IBNCPUT1",84,0)
 ;Input:
"RTN","IBNCPUT1",85,0)
 ; X - zeroth node of file #350 entry
"RTN","IBNCPUT1",86,0)
 ;output:
"RTN","IBNCPUT1",87,0)
 ; 0 - NO - DO NOT PUT ON HOLD
"RTN","IBNCPUT1",88,0)
 ; 1 - this is RX copay but there is no ECME claim, so process it as usual
"RTN","IBNCPUT1",89,0)
 ; 1 - this is ECME RX copay and it should be put on HOLD
"RTN","IBNCPUT1",90,0)
 ; 1 - this is ECME RX copay and it was rejected or reversed 
"RTN","IBNCPUT1",91,0)
 ; 2 - this is not RX copay
"RTN","IBNCPUT1",92,0)
HOLDECME(X) ;
"RTN","IBNCPUT1",93,0)
 N IBRXIEN,IBREFNO,IBRXZ,IBDATE,IBDFN,IBEBCOB,IBRETVAL
"RTN","IBNCPUT1",94,0)
 S IBRETVAL=""
"RTN","IBNCPUT1",95,0)
 S IBRXZ=$P($G(X),U,4),(IBRXIEN,IBREFNO)=0
"RTN","IBNCPUT1",96,0)
 I $P($P(IBRXZ,";"),":")'=52 Q 2  ;follow pre-existing logic
"RTN","IBNCPUT1",97,0)
 S IBRXIEN=+$P($P(IBRXZ,";"),":",2) ;ien in file #52
"RTN","IBNCPUT1",98,0)
 S IBREFNO=+$P($P($P(X,U,4),";",2),":",2) ;refill number (0 - for  original)
"RTN","IBNCPUT1",99,0)
 S IBDFN=+$P($G(X),U,2) ;Patient ien
"RTN","IBNCPUT1",100,0)
 ;if this is OTC "non-e-billable" drug then DO NOT PUT ON HOLD
"RTN","IBNCPUT1",101,0)
 I $$OTCNEBIL(IBRXIEN)=1 Q 0
"RTN","IBNCPUT1",102,0)
 ;if this is non-OTC drug OR if this is OTC drug but marked as e-billable then look if it has zero amount paid
"RTN","IBNCPUT1",103,0)
 I $$AMNTHOLD^IBNCPUT1(IBDFN,IBRXIEN,IBREFNO)=0 Q 0  ;DO NOT PUT ON HOLD
"RTN","IBNCPUT1",104,0)
 Q 1  ;follow pre-existing logic
"RTN","IBNCPUT1",105,0)
 ;
"RTN","IBNCPUT1",106,0)
 ;should RX copay be placed on hold based on the PAID amount?
"RTN","IBNCPUT1",107,0)
 ;input:
"RTN","IBNCPUT1",108,0)
 ; IBDFN - patient's ien
"RTN","IBNCPUT1",109,0)
 ; IBRX - file #52 ien
"RTN","IBNCPUT1",110,0)
 ; IBREF - refill no
"RTN","IBNCPUT1",111,0)
 ;output:
"RTN","IBNCPUT1",112,0)
 ; 1 - YES
"RTN","IBNCPUT1",113,0)
 ; 0 - NO
"RTN","IBNCPUT1",114,0)
AMNTHOLD(IBDFN,IBRX,IBREF) ;
"RTN","IBNCPUT1",115,0)
 N IBPAYRES ;for payer's response
"RTN","IBNCPUT1",116,0)
 N IBADT
"RTN","IBNCPUT1",117,0)
 ;
"RTN","IBNCPUT1",118,0)
 S IBPAYRES=$$PAIDAMNT^BPSUTIL(IBRX,IBREF)
"RTN","IBNCPUT1",119,0)
 ;if payable AND amount paid is zero AND does not have any other Pharmacy insurance 
"RTN","IBNCPUT1",120,0)
 ;THEN return NO - it should not be put on hold
"RTN","IBNCPUT1",121,0)
 I +IBPAYRES=1,$P(IBPAYRES,U,2)=0,'$$MOREINS^IBNCPNB(IBDFN,+$P(IBPAYRES,U,3)) Q 0
"RTN","IBNCPUT1",122,0)
 Q 1
"RTN","IBNCPUT1",123,0)
 ;Is this RX for OTC drug which is NOT E-billiable?
"RTN","IBNCPUT1",124,0)
 ;Input:
"RTN","IBNCPUT1",125,0)
 ; IBRX - ien in file #52
"RTN","IBNCPUT1",126,0)
 ;Output:
"RTN","IBNCPUT1",127,0)
 ; 1 - this is OTC drug and it is NOT marked as e-billable
"RTN","IBNCPUT1",128,0)
 ; 0 - otherwise
"RTN","IBNCPUT1",129,0)
OTCNEBIL(IBRX) ;
"RTN","IBNCPUT1",130,0)
 N ARR,IBSPHNDL,IBDRUG
"RTN","IBNCPUT1",131,0)
 S IBDRUG=+$$RXAPI1^IBNCPUT1(IBRX,6,"I")
"RTN","IBNCPUT1",132,0)
 S IBSPHNDL=$$DRUGDIE^IBNCPUT1(IBDRUG,3,"E",.ARR)
"RTN","IBNCPUT1",133,0)
 I IBSPHNDL'["9" Q 0  ;this is not OTC drug
"RTN","IBNCPUT1",134,0)
 I IBSPHNDL["E" Q 0  ;it is OTC E-billable drug
"RTN","IBNCPUT1",135,0)
 ;it is OTC NON E-billable drug
"RTN","IBNCPUT1",136,0)
 Q 1
"RTN","IBNCPUT1",137,0)
 ;
"RTN","IBNCPUT1",138,0)
 ;Function to return field data from DRUG file (#50)
"RTN","IBNCPUT1",139,0)
 ; Parameters
"RTN","IBNCPUT1",140,0)
 ;  IBIEN50 - IEN of DRUG FILE #50
"RTN","IBNCPUT1",141,0)
 ;  IBFLDN - Field Number(s) (like .01)
"RTN","IBNCPUT1",142,0)
 ;  IBEXIN - Specifies internal or external value of returned field
"RTN","IBNCPUT1",143,0)
 ;         - optional, defaults to "I"
"RTN","IBNCPUT1",144,0)
 ;  IBARR50 - Array to return value(s).  Optional.  Pass by reference.
"RTN","IBNCPUT1",145,0)
 ;           See EN^DIQ documentation for variable DIQ
"RTN","IBNCPUT1",146,0)
 ;
"RTN","IBNCPUT1",147,0)
 ; Function returns field data if one field is specified.  If
"RTN","IBNCPUT1",148,0)
 ;   multiple fields, the function will return "" and the field
"RTN","IBNCPUT1",149,0)
 ;   values are returned in IBARR50
"RTN","IBNCPUT1",150,0)
 ; Example: W $$DRUGDIE^IBNCPUT1(134,25,"E",.ARR)
"RTN","IBNCPUT1",151,0)
DRUGDIE(IBIEN50,IBFLDN,IBEXIN,IBARR50) ; Return field values for Drug file 
"RTN","IBNCPUT1",152,0)
 I $G(IBIEN50)=""!($G(IBFLDN)="") Q ""
"RTN","IBNCPUT1",153,0)
 N DIQ,PSSDIY
"RTN","IBNCPUT1",154,0)
 N IBDIQ
"RTN","IBNCPUT1",155,0)
 I $G(IBEXIN)'="E" S IBEXIN="I"
"RTN","IBNCPUT1",156,0)
 S IBDIQ="IBARR50",IBDIQ(0)=IBEXIN
"RTN","IBNCPUT1",157,0)
 D EN^PSSDI(50,"IB",50,.IBFLDN,.IBIEN50,.IBDIQ)
"RTN","IBNCPUT1",158,0)
 Q $G(IBARR50(50,IBIEN50,IBFLDN,IBEXIN))
"RTN","IBNCPUT1",159,0)
 ;
"RTN","IBNCPUT1",160,0)
 ;/*
"RTN","IBNCPUT1",161,0)
 ;Function to return a value for a SINGLE field of file #52
"RTN","IBNCPUT1",162,0)
 ;DBIA 4858
"RTN","IBNCPUT1",163,0)
 ;input:
"RTN","IBNCPUT1",164,0)
 ; IBIEN52 - ien of file #52
"RTN","IBNCPUT1",165,0)
 ; IBFLDN - one single field, for example ".01"
"RTN","IBNCPUT1",166,0)
 ; IBFORMAT - 
"RTN","IBNCPUT1",167,0)
 ;  "E" for external format
"RTN","IBNCPUT1",168,0)
 ;  "I" - internal 
"RTN","IBNCPUT1",169,0)
 ;  "N" - do not return nulls
"RTN","IBNCPUT1",170,0)
 ;  default is "E"
"RTN","IBNCPUT1",171,0)
 ;output:
"RTN","IBNCPUT1",172,0)
 ; returns a field value or null (empty string) 
"RTN","IBNCPUT1",173,0)
 ; examples:
"RTN","IBNCPUT1",174,0)
 ;W $$RXAPI1^IBNCPUT1(504733,6,"E")
"RTN","IBNCPUT1",175,0)
 ;ALBUMIN 25% 50ML
"RTN","IBNCPUT1",176,0)
 ;W $$RXAPI1^IBNCPUT1(504733,6,"I")
"RTN","IBNCPUT1",177,0)
 ;134
"RTN","IBNCPUT1",178,0)
RXAPI1(IBIEN52,IBFLDN,IBFORMAT) ;*/
"RTN","IBNCPUT1",179,0)
 N DIQ,DIC,IBARR,X,Y,D0,PSODIY
"RTN","IBNCPUT1",180,0)
 N I,J,C,DA,DRS,DIL,DI,DIQ1
"RTN","IBNCPUT1",181,0)
 N IBDIQ
"RTN","IBNCPUT1",182,0)
 S IBDIQ="IBARR"
"RTN","IBNCPUT1",183,0)
 S IBDIQ(0)=$S($G(IBFORMAT)="":"E",1:IBFORMAT)
"RTN","IBNCPUT1",184,0)
 D DIQ^PSODI(52,52,.IBFLDN,.IBIEN52,.IBDIQ) ;DBIA 4858
"RTN","IBNCPUT1",185,0)
 Q $S(IBDIQ(0)="N":$G(IBARR(52,IBIEN52,IBFLDN)),1:$G(IBARR(52,IBIEN52,IBFLDN,IBDIQ(0))))
"RTN","IBNCPUT1",186,0)
 ;
"RTN","IBNCPUT1",187,0)
 ;
"RTN","IBNCPUT1",188,0)
 ;IBNCPUT1
"RTN","IBOSCDC")
0^23^B46124524
"RTN","IBOSCDC",1,0)
IBOSCDC ;ALB/BNT - SERVICE CONNECTED DETERMINATION CHANGE REPORT;10/04/07
"RTN","IBOSCDC",2,0)
 ;;2.0;INTEGRATED BILLING;**384**;21-MAR-94;Build 74
"RTN","IBOSCDC",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBOSCDC",4,0)
 ;
"RTN","IBOSCDC",5,0)
SCR ; -- Main Entry for report.
"RTN","IBOSCDC",6,0)
 N IBCTY,IBPTY,IBSD,IBDFN,Y,DUOUT,DTOUT,DIC
"RTN","IBOSCDC",7,0)
 S IBDFN=0
"RTN","IBOSCDC",8,0)
 S IBCTY=$$CTYPE() Q:IBCTY=U  I IBCTY="S" S IBCTY="Y"
"RTN","IBOSCDC",9,0)
 S IBSD=$$ATIME() Q:IBSD=U
"RTN","IBOSCDC",10,0)
PTP S IBPTY=$$PTYPE() Q:IBPTY=U
"RTN","IBOSCDC",11,0)
 I IBPTY="P" D
"RTN","IBOSCDC",12,0)
 . S DIC="^DPT(",DIC(0)="AEMNQ",DIC("A")="Select Patient: " D ^DIC
"RTN","IBOSCDC",13,0)
 . I (Y=-1)!$D(DUOUT)!$D(DTOUT) G PTP
"RTN","IBOSCDC",14,0)
 . S IBDFN=$P(Y,U)
"RTN","IBOSCDC",15,0)
 D DEV("RUN^IBOSCDC","      SERVICE CONNECTED STATUS CHANGES",IBDFN)
"RTN","IBOSCDC",16,0)
 Q
"RTN","IBOSCDC",17,0)
 ;
"RTN","IBOSCDC",18,0)
 ;Process Report
"RTN","IBOSCDC",19,0)
RUN ;
"RTN","IBOSCDC",20,0)
 S REF=$NA(^TMP($J,"IBSCDC"))
"RTN","IBOSCDC",21,0)
 K @REF
"RTN","IBOSCDC",22,0)
 U IO
"RTN","IBOSCDC",23,0)
 D REPORT
"RTN","IBOSCDC",24,0)
 D ^%ZISC
"RTN","IBOSCDC",25,0)
 S:$D(ZTQUEUED) ZTREQ="@" K @REF,REF
"RTN","IBOSCDC",26,0)
 I $E(IOST,1,2)="C-" S DIR(0)="E" D ^DIR K DIR
"RTN","IBOSCDC",27,0)
 Q
"RTN","IBOSCDC",28,0)
 ;
"RTN","IBOSCDC",29,0)
REPORT ;
"RTN","IBOSCDC",30,0)
 N IBSCDFN,IBRXNUM,IBRXFIL,PTNM,PTLN1,PTLN2,IBQUIT,IBOSCNT,IBFRST,IBOSCDC,IBRXD,IBP
"RTN","IBOSCDC",31,0)
 S (IBP,IBSCDFN,IBQUIT,IBOSCNT)=0,IBFRST=1
"RTN","IBOSCDC",32,0)
 S IBN=IBN_" for period "_$$FMTE^XLFDT(IBSD,"2P")_" - "_$$FMTE^XLFDT(DT,"2P")
"RTN","IBOSCDC",33,0)
 ; Write the Header
"RTN","IBOSCDC",34,0)
 D HDR(IBN)
"RTN","IBOSCDC",35,0)
 ; Get Data for specific patient
"RTN","IBOSCDC",36,0)
 I IBPTY="P" D  Q:IBQUIT
"RTN","IBOSCDC",37,0)
 . I '$$PTSRCH(IBDFN,IBSD,IBCTY,.IBOSCDC) W !,"No matching SC changes for patient "_$$PATINF^IBOSCDC1(IBDFN,30) S IBQUIT=1 Q
"RTN","IBOSCDC",38,0)
 . D COLLECT^IBOSCDC1(IBDFN,IBSD)
"RTN","IBOSCDC",39,0)
 . I '$D(@REF@(IBDFN)) W !,"No matching Prescriptions found for patient "_$$PATINF^IBOSCDC1(IBDFN,30) S IBQUIT=1 Q
"RTN","IBOSCDC",40,0)
 ; Get Data for all patients
"RTN","IBOSCDC",41,0)
 I IBPTY="A" D  Q:IBQUIT
"RTN","IBOSCDC",42,0)
 . D GETALLPT(IBCTY,IBSD,.IBOSCDC)
"RTN","IBOSCDC",43,0)
 . I '$D(IBOSCDC) W !,"No patients with SC changes found" S IBQUIT=1 Q
"RTN","IBOSCDC",44,0)
 ; Check all patients for Pharmacy data
"RTN","IBOSCDC",45,0)
 F  S IBSCDFN=$O(IBOSCDC(IBSCDFN)) Q:IBSCDFN=""  D  Q:IBQUIT
"RTN","IBOSCDC",46,0)
 . D COLLECT^IBOSCDC1(IBSCDFN,IBSD)
"RTN","IBOSCDC",47,0)
 . I '$D(@REF@(IBSCDFN)) Q
"RTN","IBOSCDC",48,0)
 . ;Get Patient Name and last 4 SSN
"RTN","IBOSCDC",49,0)
 . S PTNM=$$PATINF^IBOSCDC1(IBSCDFN,23)
"RTN","IBOSCDC",50,0)
 . ;Get first line of Patient data
"RTN","IBOSCDC",51,0)
 . S PTLN1=$$GETENRL($P($G(IBOSCDC(IBSCDFN)),U,1))
"RTN","IBOSCDC",52,0)
 . ; Get second line of patient data
"RTN","IBOSCDC",53,0)
 . S PTLN2=$$GETENRL($P($G(IBOSCDC(IBSCDFN)),U,2))
"RTN","IBOSCDC",54,0)
 . I 'IBFRST W !!
"RTN","IBOSCDC",55,0)
 . ;Write the first Patient line
"RTN","IBOSCDC",56,0)
 . D WPTLINE(PTNM,$P(PTLN1,U),$P(PTLN1,U,2),$P(PTLN1,U,3),$P(PTLN1,U,4),$P(PTLN1,U,5)) Q:IBQUIT
"RTN","IBOSCDC",57,0)
 . ;Write the second Patient line
"RTN","IBOSCDC",58,0)
 . D WPTLINE("",$P(PTLN2,U),$P(PTLN2,U,2),$P(PTLN2,U,3),$P(PTLN2,U,4),$P(PTLN2,U,5))
"RTN","IBOSCDC",59,0)
 . S (IBFRST)=0
"RTN","IBOSCDC",60,0)
 . F  S IBOSCNT=$O(@REF@(IBSCDFN,IBOSCNT)) Q:IBOSCNT=""  D
"RTN","IBOSCDC",61,0)
 . . S IBRXD=@REF@(IBSCDFN,IBOSCNT)
"RTN","IBOSCDC",62,0)
 . . ;Write the RX data
"RTN","IBOSCDC",63,0)
 . . D WRXLINE($P(IBRXD,U),$P(IBRXD,U,2),$P(IBRXD,U,3),$P(IBRXD,U,4),$P(IBRXD,U,5),$P(IBRXD,U,6),$P(IBRXD,U,7))
"RTN","IBOSCDC",64,0)
 . . ;Increment counter
"RTN","IBOSCDC",65,0)
 . . S IBFRST=1
"RTN","IBOSCDC",66,0)
 I 'IBFRST W "No data available for report"
"RTN","IBOSCDC",67,0)
 Q
"RTN","IBOSCDC",68,0)
 ;
"RTN","IBOSCDC",69,0)
 ;Get Service Connected Change type value
"RTN","IBOSCDC",70,0)
 ;Returns:
"RTN","IBOSCDC",71,0)
 ;(S = SC - NSC, N = NCS - SC, B = Both)
"RTN","IBOSCDC",72,0)
CTYPE() ;
"RTN","IBOSCDC",73,0)
 N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","IBOSCDC",74,0)
 S DIR(0)="S^S:SC to NSC;N:NSC to SC;B:Both"
"RTN","IBOSCDC",75,0)
 S DIR("A")="Select Change Type or (B)oth",DIR("B")="B"
"RTN","IBOSCDC",76,0)
 D ^DIR
"RTN","IBOSCDC",77,0)
 Q Y
"RTN","IBOSCDC",78,0)
 ;
"RTN","IBOSCDC",79,0)
 ;Get Activity Timeframe (Start date) for search
"RTN","IBOSCDC",80,0)
 ;Returns:
"RTN","IBOSCDC",81,0)
 ;Start date in FileMan format
"RTN","IBOSCDC",82,0)
ATIME() ;
"RTN","IBOSCDC",83,0)
 N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","IBOSCDC",84,0)
 W !
"RTN","IBOSCDC",85,0)
 S DIR(0)="N^1:999"
"RTN","IBOSCDC",86,0)
 S DIR("A")="     Select Activity Timeframe Days",DIR("B")=30
"RTN","IBOSCDC",87,0)
 D ^DIR
"RTN","IBOSCDC",88,0)
 Q $$FMADD^XLFDT(DT\1,-$G(Y))
"RTN","IBOSCDC",89,0)
 ;
"RTN","IBOSCDC",90,0)
 ;Get Patient Type value
"RTN","IBOSCDC",91,0)
 ;Returns (P = Patient, A = All)
"RTN","IBOSCDC",92,0)
PTYPE() ;
"RTN","IBOSCDC",93,0)
 N DIR,X,Y,DTOUT,DUOUT,DIRUT,DIROUT
"RTN","IBOSCDC",94,0)
 S DIR(0)="S^P:ONE PATIENT;A:ALL"
"RTN","IBOSCDC",95,0)
 S DIR("A")="Display One (P)atient or (A)ll",DIR("B")="A"
"RTN","IBOSCDC",96,0)
 D ^DIR
"RTN","IBOSCDC",97,0)
 Q Y
"RTN","IBOSCDC",98,0)
 ;
"RTN","IBOSCDC",99,0)
 ;Get All patients with SC Change
"RTN","IBOSCDC",100,0)
 ;Input: 
"RTN","IBOSCDC",101,0)
 ;IBSCDIR = Service Connected change direction
"RTN","IBOSCDC",102,0)
 ;         (Y = SC to NSC, N = NSC to SC, B = Both)
"RTN","IBOSCDC",103,0)
 ;IBSD = Start search date
"RTN","IBOSCDC",104,0)
 ;IBSCARR = Return array passed by ref
"RTN","IBOSCDC",105,0)
 ;Returns:
"RTN","IBOSCDC",106,0)
 ;^TMP(IBSCARR,$J,0)=Number of records found
"RTN","IBOSCDC",107,0)
 ;The first record found is in the 1 node
"RTN","IBOSCDC",108,0)
 ;^TMP(IBSCARR,$J,IBDFN,1)=File 27.11 IEN
"RTN","IBOSCDC",109,0)
 ;The last record found is in the 2 node
"RTN","IBOSCDC",110,0)
 ;^TMP(IBSCARR,$J,IBDFN,2)=File 27.11 IEN
"RTN","IBOSCDC",111,0)
GETALLPT(IBSCDIR,IBSD,IBSCARR) ;
"RTN","IBOSCDC",112,0)
 N IBDFN,IBCNT,IBDGEN
"RTN","IBOSCDC",113,0)
 ; Default start date -30 days
"RTN","IBOSCDC",114,0)
 I IBSD="" S IBSD=$$FMADD^XLFDT(DT\1,-30)
"RTN","IBOSCDC",115,0)
 S (IBDFN,IBCNT)=0
"RTN","IBOSCDC",116,0)
 F  S IBDFN=$O(^DGEN(27.11,"C",IBDFN)) Q:IBDFN=""  D
"RTN","IBOSCDC",117,0)
 . Q:'$D(^DPT(IBDFN,0))
"RTN","IBOSCDC",118,0)
 . I $$PTSRCH(IBDFN,IBSD,IBSCDIR,.IBDGEN) D
"RTN","IBOSCDC",119,0)
 . . S IBCNT=IBCNT+1,IBSCARR(0)=IBCNT
"RTN","IBOSCDC",120,0)
 . . S IBSCARR(IBDFN)=IBDGEN(IBDFN)
"RTN","IBOSCDC",121,0)
 Q
"RTN","IBOSCDC",122,0)
 ;
"RTN","IBOSCDC",123,0)
 ;This function searches for an SC change in Patient Enrollment for a patient
"RTN","IBOSCDC",124,0)
 ;during a specified date range.
"RTN","IBOSCDC",125,0)
 ;Input:
"RTN","IBOSCDC",126,0)
 ;IBDFN = Patient DFN
"RTN","IBOSCDC",127,0)
 ;IBSD  = Start date to begin search
"RTN","IBOSCDC",128,0)
 ;IBSCDIR = Service Connected change direction
"RTN","IBOSCDC",129,0)
 ;          (Y = SC to NSC, N = NSC to SC, B = Both)
"RTN","IBOSCDC",130,0)
 ;IBSCARR = Return array passed by ref
"RTN","IBOSCDC",131,0)
 ;Returns:
"RTN","IBOSCDC",132,0)
 ;IBSCARR(DFN)=DGEN1^DGEN2
"RTN","IBOSCDC",133,0)
 ;WHERE:
"RTN","IBOSCDC",134,0)
 ; DGEN1 = The IEN of first record
"RTN","IBOSCDC",135,0)
 ; DGEN2 = The IEN of second record where a SC change occurred.
"RTN","IBOSCDC",136,0)
PTSRCH(IBDFN,IBSD,IBSCDIR,IBSCARR) ;
"RTN","IBOSCDC",137,0)
 Q:IBDFN="" 0
"RTN","IBOSCDC",138,0)
 N DGENIEN,IBSC,IBSCHNG,SCDIR,EFDT,IBDGEN1
"RTN","IBOSCDC",139,0)
 S (DGENIEN,IBSCHNG)=0,(IBDGEN1,IBSC)=""
"RTN","IBOSCDC",140,0)
 F  S DGENIEN=$O(^DGEN(27.11,"C",IBDFN,DGENIEN)) Q:DGENIEN=""  D 
"RTN","IBOSCDC",141,0)
 . I $D(^DGEN(27.11,DGENIEN,"E")) D
"RTN","IBOSCDC",142,0)
 . . ; Get SERVICE CONNECTED field
"RTN","IBOSCDC",143,0)
 . . S IBSC=$P(^DGEN(27.11,DGENIEN,"E"),U,2) Q:IBSC=""
"RTN","IBOSCDC",144,0)
 . . ; Get EFFECTIVE DATE field
"RTN","IBOSCDC",145,0)
 . . S EFDT=$P(^DGEN(27.11,DGENIEN,0),U,8) Q:EFDT=""
"RTN","IBOSCDC",146,0)
 . . ; Is EFFECTIVE DATE prior to search date? If yes, quit.
"RTN","IBOSCDC",147,0)
 . . I EFDT<IBSD Q
"RTN","IBOSCDC",148,0)
 . . ; First matching SC found
"RTN","IBOSCDC",149,0)
 . . I IBDGEN1="" D  Q
"RTN","IBOSCDC",150,0)
 . . . I (IBSC=IBSCDIR)!(IBSCDIR="B") S IBDGEN1=IBSC S IBSCARR(IBDFN)=DGENIEN Q
"RTN","IBOSCDC",151,0)
 . . ; Matching SC change found. Overwrite previous with latest effective date.
"RTN","IBOSCDC",152,0)
 . . I IBDGEN1'="",IBSC'=IBDGEN1 D  Q
"RTN","IBOSCDC",153,0)
 . . . S $P(IBSCARR(IBDFN),U,2)=DGENIEN
"RTN","IBOSCDC",154,0)
 . . . S IBSCHNG=1
"RTN","IBOSCDC",155,0)
 ; If second match not found, kill the first since no change.
"RTN","IBOSCDC",156,0)
 I 'IBSCHNG K IBSCARR Q 0
"RTN","IBOSCDC",157,0)
 Q 1
"RTN","IBOSCDC",158,0)
 ;
"RTN","IBOSCDC",159,0)
 ;//TODO - Create IA for 27.11
"RTN","IBOSCDC",160,0)
 ;Get Patient Enrollment data
"RTN","IBOSCDC",161,0)
 ;Input: DGENINE = IEN of entry in file 27.11
"RTN","IBOSCDC",162,0)
 ;Returns: EFFECTIVE DATE (.08)^SERVICE CONNECTED (50.02)^ELIGIBILITY CODE (50.01)^SC % (50.03)^ENROLLMENT PRIORITY (.07)
"RTN","IBOSCDC",163,0)
GETENRL(DGENIEN) ;
"RTN","IBOSCDC",164,0)
 N FILE,FIELDS,RETV,X
"RTN","IBOSCDC",165,0)
 Q:'$D(^DGEN(27.11,DGENIEN)) 0
"RTN","IBOSCDC",166,0)
 I $E($L(DGENIEN)+1)'="," S DGENIEN=DGENIEN_","
"RTN","IBOSCDC",167,0)
 S RETV=""
"RTN","IBOSCDC",168,0)
 S FILE=27.11,FIELDS=".08;50.01:50.03;.07"
"RTN","IBOSCDC",169,0)
 D GETS^DIQ(FILE,DGENIEN_",",FIELDS,"IE","X")
"RTN","IBOSCDC",170,0)
 I $D(X) D
"RTN","IBOSCDC",171,0)
 . S RETV=$$FMTE^XLFDT($G(X(27.11,DGENIEN,.08,"I")),"2D")_U_$G(X(27.11,DGENIEN,50.02,"I"))_U_$E($G(X(27.11,DGENIEN,50.01,"E")),1,17)_U_$G(X(27.11,DGENIEN,50.03,"E"))_U_$G(X(27.11,DGENIEN,.07,"E"))
"RTN","IBOSCDC",172,0)
 Q RETV
"RTN","IBOSCDC",173,0)
 ;
"RTN","IBOSCDC",174,0)
 ;Print the report Header
"RTN","IBOSCDC",175,0)
 ;Input: IBX = Report Name
"RTN","IBOSCDC",176,0)
HDR(IBX) ;
"RTN","IBOSCDC",177,0)
 ; IBP is assumed for page #
"RTN","IBOSCDC",178,0)
 Q:IBQUIT
"RTN","IBOSCDC",179,0)
 N DIR,X,Y
"RTN","IBOSCDC",180,0)
 I $E(IOST,1,2)="C-",IBP S DIR(0)="E" D ^DIR K DIR I $D(DIRUT)!($D(DUOUT)) S IBQUIT=1 K DIRUT,DTOUT,DUOUT Q
"RTN","IBOSCDC",181,0)
 S IBP=IBP+1
"RTN","IBOSCDC",182,0)
 W @IOF
"RTN","IBOSCDC",183,0)
 F X=1:1:IOM W "="
"RTN","IBOSCDC",184,0)
 W IBX,?IOM-10,"Page: ",IBP,!
"RTN","IBOSCDC",185,0)
 F X=1:1:IOM W "="
"RTN","IBOSCDC",186,0)
 W !,"Patient",?24,"Effective",?35,"Service",?46,"Eligibility",?65,"SC",?69,"Enrollment",!
"RTN","IBOSCDC",187,0)
 W ?24,"Date",?35,"connected",?46,"code",?65,"%%",?69,"priority",!!
"RTN","IBOSCDC",188,0)
 W ?2,"RX#",?10,"Fill#",?16,"DOS",?25,"Bill#/Status",?39,"ECME#",?47,"Copay/Insurance",?66,"Total Charge",!
"RTN","IBOSCDC",189,0)
 F X=1:1:IOM W "-"
"RTN","IBOSCDC",190,0)
 Q
"RTN","IBOSCDC",191,0)
 ;
"RTN","IBOSCDC",192,0)
 ;Write Patient Line
"RTN","IBOSCDC",193,0)
WPTLINE(PT,EFDT,SC,ELIGCODE,SCPERCNT,ENRLPRIO) ;
"RTN","IBOSCDC",194,0)
 I $Y>(IOSL-4) D HDR(IBN) Q:IBQUIT
"RTN","IBOSCDC",195,0)
 W !,PT,?24,EFDT,?35,SC,?46,ELIGCODE,?65,SCPERCNT,?69,ENRLPRIO
"RTN","IBOSCDC",196,0)
 Q
"RTN","IBOSCDC",197,0)
 ;
"RTN","IBOSCDC",198,0)
 ;Write Prescription Line
"RTN","IBOSCDC",199,0)
WRXLINE(RX,FILL,DOS,BILL,ECME,COPAYINS,AMNT) ;
"RTN","IBOSCDC",200,0)
 I $Y>(IOSL-4) D HDR(IBN) Q:IBQUIT
"RTN","IBOSCDC",201,0)
 W !,?2,RX,?10,FILL,?16,$$FMTE^XLFDT(DOS,"2D"),?25,BILL,?39,ECME,?47,COPAYINS,?66,AMNT
"RTN","IBOSCDC",202,0)
 Q
"RTN","IBOSCDC",203,0)
 ;
"RTN","IBOSCDC",204,0)
 ;Device Selection
"RTN","IBOSCDC",205,0)
 ;Input: IBR = Routine
"RTN","IBOSCDC",206,0)
 ;       IBN = Task name (only used if tasked)
"RTN","IBOSCDC",207,0)
 ;       IBDFN = Patient DFN for single patient, if exists.
"RTN","IBOSCDC",208,0)
DEV(IBR,IBN,IBDFN) ;
"RTN","IBOSCDC",209,0)
 N %ZIS,ZTSK,ZTSAVE,POP,ZTRTN,ZTDESC
"RTN","IBOSCDC",210,0)
 S %ZIS="MQ" D ^%ZIS Q:POP
"RTN","IBOSCDC",211,0)
 I $D(IO("Q")) D  Q
"RTN","IBOSCDC",212,0)
 . S ZTRTN=IBR,ZTDESC=IBN,ZTSAVE("IB*")="",ZTSAVE("IBPT(")=""
"RTN","IBOSCDC",213,0)
 . D ^%ZTLOAD,HOME^%ZIS K IO("Q") W !,"QUEUED TASK #",ZTSK
"RTN","IBOSCDC",214,0)
 U IO
"RTN","IBOSCDC",215,0)
 D @IBR
"RTN","IBOSCDC",216,0)
 Q
"RTN","IBOSCDC1")
0^45^B17599955
"RTN","IBOSCDC1",1,0)
IBOSCDC1 ;ALB/BNT - SERVICE CONNECTED DETERMINATION CHANGE REPORT UTILITIES;10/04/07
"RTN","IBOSCDC1",2,0)
 ;;2.0;INTEGRATED BILLING;**384**;21-MAR-94;Build 74
"RTN","IBOSCDC1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBOSCDC1",4,0)
 ;
"RTN","IBOSCDC1",5,0)
 ;Patient info for header
"RTN","IBOSCDC1",6,0)
 ;Input:
"RTN","IBOSCDC1",7,0)
 ;IBDFN = Patient DFN
"RTN","IBOSCDC1",8,0)
 ;IBLEN = Length of overall characters for output
"RTN","IBOSCDC1",9,0)
 ;Returns:
"RTN","IBOSCDC1",10,0)
 ;Left Justified patient name with Last 4 SSN
"RTN","IBOSCDC1",11,0)
PATINF(IBDFN,IBLEN) ;
"RTN","IBOSCDC1",12,0)
 N X
"RTN","IBOSCDC1",13,0)
 S X=$$PATNAME(IBDFN,IBLEN-7)_" "_$$SSN4^IBNCPRR1(IBDFN)
"RTN","IBOSCDC1",14,0)
 Q $$LJ(X,IBLEN) ;name
"RTN","IBOSCDC1",15,0)
 ;
"RTN","IBOSCDC1",16,0)
 ;Get patient's name
"RTN","IBOSCDC1",17,0)
 ;Input:
"RTN","IBOSCDC1",18,0)
 ;IBDFN = Patient DFN
"RTN","IBOSCDC1",19,0)
 ;IBLEN = Length of characters to return
"RTN","IBOSCDC1",20,0)
 ;Returns:
"RTN","IBOSCDC1",21,0)
 ;patient's name
"RTN","IBOSCDC1",22,0)
PATNAME(IBDFN,IBLEN) ;
"RTN","IBOSCDC1",23,0)
 Q $E($P($G(^DPT(IBDFN,0)),U),1,IBLEN)
"RTN","IBOSCDC1",24,0)
 ;
"RTN","IBOSCDC1",25,0)
 ;left justified, blank padded
"RTN","IBOSCDC1",26,0)
 ;adds spaces on right or truncates to make return string IBLEN characters long
"RTN","IBOSCDC1",27,0)
 ;IBST- original string
"RTN","IBOSCDC1",28,0)
 ;IBLEN - desired length
"RTN","IBOSCDC1",29,0)
LJ(IBST,IBLEN) ;
"RTN","IBOSCDC1",30,0)
 N IBL
"RTN","IBOSCDC1",31,0)
 S IBL=IBLEN-$L(IBST)
"RTN","IBOSCDC1",32,0)
 Q $E(IBST_$J("",$S(IBL<0:0,1:IBL)),1,IBLEN)
"RTN","IBOSCDC1",33,0)
 ;
"RTN","IBOSCDC1",34,0)
 ;Get Third Party bill from file 362.4, if one exists
"RTN","IBOSCDC1",35,0)
 ;IBRXN = RX number
"RTN","IBOSCDC1",36,0)
 ;IBDT = RX Fill Date
"RTN","IBOSCDC1",37,0)
 ;Returns the Bill Number
"RTN","IBOSCDC1",38,0)
BILL(IBRXN,IBDT) ;Bill IEN (if any) or null
"RTN","IBOSCDC1",39,0)
 N RES,X,IBZ
"RTN","IBOSCDC1",40,0)
 S IBDT=$P(IBDT,".")
"RTN","IBOSCDC1",41,0)
 S RES=""
"RTN","IBOSCDC1",42,0)
 S X="" F  S X=$O(^IBA(362.4,"B",IBRXN,X),-1) Q:X=""  D:X  Q:RES
"RTN","IBOSCDC1",43,0)
 . S IBZ=$G(^IBA(362.4,X,0))
"RTN","IBOSCDC1",44,0)
 . I $P($P(IBZ,U,3),".")=IBDT,$P(IBZ,U,2) S RES=+$P(IBZ,U,2)
"RTN","IBOSCDC1",45,0)
 Q RES
"RTN","IBOSCDC1",46,0)
 ;
"RTN","IBOSCDC1",47,0)
 ;Check if the status on the first party bill in 350 is CANCELLED?
"RTN","IBOSCDC1",48,0)
 ;IBILL = IEN from file 350
"RTN","IBOSCDC1",49,0)
 ;Returns 1=yes, 0=no
"RTN","IBOSCDC1",50,0)
BILLCNCL(IBILL) ;
"RTN","IBOSCDC1",51,0)
 N IBBILSTS
"RTN","IBOSCDC1",52,0)
 Q:(IBILL="")!(IBILL=0) 1
"RTN","IBOSCDC1",53,0)
 Q $S($$BILLSTS(IBILL)["CANCEL":1,1:0)
"RTN","IBOSCDC1",54,0)
 ;
"RTN","IBOSCDC1",55,0)
 ;Returns the PRINT NAME of the STATUS associated with a bill
"RTN","IBOSCDC1",56,0)
 ;IBILL = IEN from file 350
"RTN","IBOSCDC1",57,0)
 ;Returns the PRINT NAME field from file 350.21
"RTN","IBOSCDC1",58,0)
BILLSTS(IBILL) ;
"RTN","IBOSCDC1",59,0)
 N IBBILSTS
"RTN","IBOSCDC1",60,0)
 Q:(IBILL="")!(IBILL=0) ""
"RTN","IBOSCDC1",61,0)
 S IBBILSTS=$P(^IB(IBILL,0),U,5)
"RTN","IBOSCDC1",62,0)
 Q $P(^IBE(350.21,IBBILSTS,0),U,2)
"RTN","IBOSCDC1",63,0)
 ;
"RTN","IBOSCDC1",64,0)
 ;Get the TOTAL CHARGE for the bill
"RTN","IBOSCDC1",65,0)
 ;IBILL = IEN from file 350
"RTN","IBOSCDC1",66,0)
 ;Returns the TOTAL CHARGE 
"RTN","IBOSCDC1",67,0)
BILLAMNT(IBILL) ;
"RTN","IBOSCDC1",68,0)
 N X,X2,X3
"RTN","IBOSCDC1",69,0)
 Q:(IBILL="")!(IBILL=0) ""
"RTN","IBOSCDC1",70,0)
 S X=$P(^IB(IBILL,0),U,7),X2="2$",X3=0 D COMMA^%DTC
"RTN","IBOSCDC1",71,0)
 Q X
"RTN","IBOSCDC1",72,0)
 ;
"RTN","IBOSCDC1",73,0)
 ;Collect the RX related data using Pharmacy API for the report and store in ^TMP($J,"IBRXARR"
"RTN","IBOSCDC1",74,0)
 ;DFN = Patient IEN
"RTN","IBOSCDC1",75,0)
 ;IBBDT = Beginning search date, used to determine if Rx was filled within this date
"RTN","IBOSCDC1",76,0)
COLLECT(DFN,IBBDT) ; Collect data for patient
"RTN","IBOSCDC1",77,0)
 N LIST,IBRX,IBFIL,CNT
"RTN","IBOSCDC1",78,0)
 S LIST="IBRXARR",(IBRX,CNT,IBFIL)=0
"RTN","IBOSCDC1",79,0)
 K ^TMP($J,LIST)
"RTN","IBOSCDC1",80,0)
 D RX^PSO52API(DFN,LIST,,,"2,I,R",,)
"RTN","IBOSCDC1",81,0)
 F  S IBRX=$O(^TMP($J,LIST,DFN,IBRX)) Q:'IBRX  D
"RTN","IBOSCDC1",82,0)
 . Q:'+$P(^TMP($J,LIST,DFN,IBRX,31),U)
"RTN","IBOSCDC1",83,0)
 . D GETDATA(0,IBRX,DFN,LIST)
"RTN","IBOSCDC1",84,0)
 . I ^TMP($J,LIST,DFN,IBRX,"RF",0)<0 Q
"RTN","IBOSCDC1",85,0)
 . F  S IBFIL=$O(^TMP($J,LIST,DFN,IBRX,"RF",IBFIL)) Q:IBFIL=""  D 
"RTN","IBOSCDC1",86,0)
 . . Q:IBFIL=0
"RTN","IBOSCDC1",87,0)
 . . D GETDATA(IBFIL,IBRX,DFN,LIST)
"RTN","IBOSCDC1",88,0)
 . Q
"RTN","IBOSCDC1",89,0)
 Q
"RTN","IBOSCDC1",90,0)
 ;
"RTN","IBOSCDC1",91,0)
 ;Gets specific data for first and third party bills and store in TMP file
"RTN","IBOSCDC1",92,0)
 ;IBFIL = RX Fill #
"RTN","IBOSCDC1",93,0)
 ;IBRX = IEN to Prescription file - RX ID Placeholder in the TMP file
"RTN","IBOSCDC1",94,0)
 ;DFN = Patient IEN
"RTN","IBOSCDC1",95,0)
 ;LIST = placeholder for data in ^TMP file
"RTN","IBOSCDC1",96,0)
GETDATA(IBFIL,IBRX,DFN,LIST) ;
"RTN","IBOSCDC1",97,0)
 N IBBA,IBBILL,IBRXN,IBFILDT,IBRXINS,IBBILLN,IBECN
"RTN","IBOSCDC1",98,0)
 I IBFIL=0 D
"RTN","IBOSCDC1",99,0)
 . S IBFILDT=+$P(^TMP($J,LIST,DFN,IBRX,22),U)
"RTN","IBOSCDC1",100,0)
 . S IBBA=+$P($G(^TMP($J,LIST,DFN,IBRX,106)),U)
"RTN","IBOSCDC1",101,0)
 E  S IBFILDT=+$P(^TMP($J,LIST,DFN,IBRX,"RF",IBFIL,.01),U) D
"RTN","IBOSCDC1",102,0)
 . S IBBA=+$P($G(^TMP($J,LIST,DFN,IBRX,"IB",IBFIL,9)),U)
"RTN","IBOSCDC1",103,0)
 Q:IBFILDT<IBBDT
"RTN","IBOSCDC1",104,0)
 S IBRXN=^TMP($J,LIST,DFN,IBRX,.01)
"RTN","IBOSCDC1",105,0)
 ; First party copay
"RTN","IBOSCDC1",106,0)
 I $$BILLCNCL(IBBA) Q
"RTN","IBOSCDC1",107,0)
 S IBBILL=$P($P(^IB(IBBA,0),U,11),"-",2)
"RTN","IBOSCDC1",108,0)
 I IBBILL="" S IBBILL=$$BILLSTS(IBBA)
"RTN","IBOSCDC1",109,0)
 S CNT=CNT+1 D SETREF(CNT,IBRXN,IBFIL,IBFILDT,IBBILL,"Copay","",$$BILLAMNT(IBBA))
"RTN","IBOSCDC1",110,0)
 ; Third party bills
"RTN","IBOSCDC1",111,0)
 S IBBILL=$$BILL(IBRXN,IBFILDT) Q:IBBILL']""
"RTN","IBOSCDC1",112,0)
 S IBBILLN=$$GETBILLN(IBBILL)
"RTN","IBOSCDC1",113,0)
 S IBRXINS=$$GETINS(IBBILL)
"RTN","IBOSCDC1",114,0)
 S IBECN=$$ECMENO^IBNCPRR1(IBRX)
"RTN","IBOSCDC1",115,0)
 S CNT=CNT+1 D SETREF(CNT,IBRXN,IBFIL,IBFILDT,IBBILLN,IBRXINS,IBECN,"")
"RTN","IBOSCDC1",116,0)
 Q
"RTN","IBOSCDC1",117,0)
 ;
"RTN","IBOSCDC1",118,0)
 ;SETREF sets the reference global with report data
"RTN","IBOSCDC1",119,0)
 ;INPUT: DATA = Counter^RxIEN^Rx#^Fill#^FillDate^BillNumber^BillInsurance^ECME#^TotalCharge
"RTN","IBOSCDC1",120,0)
SETREF(CNT,IBRXN,IBFIL,IBDT,IBBILLN,IBRXINS,IBECN,IBCHRG) ;
"RTN","IBOSCDC1",121,0)
 S @REF@(DFN,CNT)=IBRXN_U_IBFIL_U_IBDT_U_IBBILLN_U_IBECN_U_IBRXINS_U_IBCHRG
"RTN","IBOSCDC1",122,0)
 Q
"RTN","IBOSCDC1",123,0)
 ;
"RTN","IBOSCDC1",124,0)
 ;Get the Bill Number from file 399
"RTN","IBOSCDC1",125,0)
 ;Input:
"RTN","IBOSCDC1",126,0)
 ;IEN of file 399
"RTN","IBOSCDC1",127,0)
 ;Returns:
"RTN","IBOSCDC1",128,0)
 ;BILL NUMBER field
"RTN","IBOSCDC1",129,0)
GETBILLN(IBBIL) ;
"RTN","IBOSCDC1",130,0)
 Q $P($G(^DGCR(399,IBBIL,0)),U)_$$ECME^IBTRE(IBBIL,"")
"RTN","IBOSCDC1",131,0)
 ;
"RTN","IBOSCDC1",132,0)
 ;Get the ECME Number from file 399
"RTN","IBOSCDC1",133,0)
 ;Input:
"RTN","IBOSCDC1",134,0)
 ;IEN of file 399
"RTN","IBOSCDC1",135,0)
 ;Returns:
"RTN","IBOSCDC1",136,0)
 ;ECME NUMBER field
"RTN","IBOSCDC1",137,0)
GETECME(IBBIL) ;
"RTN","IBOSCDC1",138,0)
 Q $P($P($G(^DGCR(399,IBBIL,"M1")),U,8),";")
"RTN","IBOSCDC1",139,0)
 ;
"RTN","IBOSCDC1",140,0)
 ;Get Insurance payer
"RTN","IBOSCDC1",141,0)
 ;Input:
"RTN","IBOSCDC1",142,0)
 ;IEN of file 399
"RTN","IBOSCDC1",143,0)
 ;Returns:
"RTN","IBOSCDC1",144,0)
 ;Insurance company name prefixed with p-, s-, or t-.
"RTN","IBOSCDC1",145,0)
GETINS(IBBIL) ;
"RTN","IBOSCDC1",146,0)
 N IBINS,IBSEQ,IBM
"RTN","IBOSCDC1",147,0)
 Q:'$D(^DGCR(399,IBBIL,0)) ""
"RTN","IBOSCDC1",148,0)
 S IBSEQ=$P(^DGCR(399,IBBIL,0),U,21)
"RTN","IBOSCDC1",149,0)
 ;Don't include Patient in CURRENT BILL PAYER SEQUENCE.
"RTN","IBOSCDC1",150,0)
 Q:IBSEQ["A" ""
"RTN","IBOSCDC1",151,0)
 S IBM=$G(^DGCR(399,IBBIL,"M"))
"RTN","IBOSCDC1",152,0)
 Q:'IBM "UNKNOWN"
"RTN","IBOSCDC1",153,0)
 S IBINS=$S(IBSEQ="P":$P(IBM,U),IBSEQ="S":$P(IBM,U,2),IBSEQ="T":$P(IBM,U,3))
"RTN","IBOSCDC1",154,0)
 I IBINS']"" Q "UNKNOWN"
"RTN","IBOSCDC1",155,0)
 Q $$LOW^XLFSTR(IBSEQ)_"-"_$P(^DIC(36,IBINS,0),U)
"RTN","IBOSCDC1",156,0)
 ;
"RTN","IBTRKR3")
0^24^B54376358
"RTN","IBTRKR3",1,0)
IBTRKR3 ;ALB/AAS - CLAIMS TRACKING - ADD/TRACK RX FILLS ;13-AUG-93
"RTN","IBTRKR3",2,0)
 ;;2.0;INTEGRATED BILLING;**13,43,121,160,247,275,260,309,336,312,339,347,405,384**;21-MAR-94;Build 74
"RTN","IBTRKR3",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBTRKR3",4,0)
 ;
"RTN","IBTRKR3",5,0)
% ; -- entry point for nightly background job
"RTN","IBTRKR3",6,0)
 N IBTSBDT,IBTSEDT
"RTN","IBTRKR3",7,0)
 S IBTSBDT=$$FMADD^XLFDT(DT,-14)-.1
"RTN","IBTRKR3",8,0)
 S IBTSEDT=$$FMADD^XLFDT(DT,-7)+.9
"RTN","IBTRKR3",9,0)
 D EN1
"RTN","IBTRKR3",10,0)
 Q
"RTN","IBTRKR3",11,0)
 ;
"RTN","IBTRKR3",12,0)
EN ; -- entry point to ask date range
"RTN","IBTRKR3",13,0)
 N IBSWINFO S IBSWINFO=$$SWSTAT^IBBAPI() ;IB*2.0*312
"RTN","IBTRKR3",14,0)
 N IBBDT,IBEDT,IBTSBDT,IBTSEDT,IBTALK,IBMESS
"RTN","IBTRKR3",15,0)
 S IBTALK=1
"RTN","IBTRKR3",16,0)
 I '$P($G(^IBE(350.9,1,6)),"^",4) W !!,"I'm sorry, Tracking of Prescription Refills is currently turned off." G ENQ
"RTN","IBTRKR3",17,0)
 W !!!,"Select the Date Range of Rx Refills to Add to Claims Tracking.",!
"RTN","IBTRKR3",18,0)
 D DATE^IBOUTL
"RTN","IBTRKR3",19,0)
 I IBBDT<1!(IBEDT<1) G ENQ
"RTN","IBTRKR3",20,0)
 S IBTSBDT=IBBDT,IBTSEDT=IBEDT
"RTN","IBTRKR3",21,0)
 ;
"RTN","IBTRKR3",22,0)
 ; Do NOT PROCESS on VistA if Start or End>=Switch Eff Date ;IB*2.0*312
"RTN","IBTRKR3",23,0)
 I +IBSWINFO,((IBTSBDT+1)>$P(IBSWINFO,"^",2))!((IBTSEDT+1)>$P(IBSWINFO,"^",2)) D  G EN
"RTN","IBTRKR3",24,0)
 .W !!,"The Begin OR End Date CANNOT be on or after"
"RTN","IBTRKR3",25,0)
 .W !,"the PFSS Effective Date: ",$$FMTE^XLFDT($P(IBSWINFO,"^",2))
"RTN","IBTRKR3",26,0)
 ;
"RTN","IBTRKR3",27,0)
 ; -- check selected dates
"RTN","IBTRKR3",28,0)
 S IBTRKR=$G(^IBE(350.9,1,6))
"RTN","IBTRKR3",29,0)
 ; start date can't be before parameters
"RTN","IBTRKR3",30,0)
 I +IBTRKR,IBTSBDT<+IBTRKR S IBTSBDT=IBTRKR W !!,"Begin date is before Claims Tracking Start Date, changed to ",$$DAT1^IBOUTL(IBTSBDT)
"RTN","IBTRKR3",31,0)
 ; -- end date into future
"RTN","IBTRKR3",32,0)
 I IBTSEDT>$$FMADD^XLFDT(DT,-3) W !!,"I'll automatically change the end date to 3 days prior to the date queued to run."
"RTN","IBTRKR3",33,0)
 ;
"RTN","IBTRKR3",34,0)
 W !!!,"I'm going to automatically queue this off and send you a"
"RTN","IBTRKR3",35,0)
 W !,"mail message when complete.",!
"RTN","IBTRKR3",36,0)
 S ZTIO="",ZTRTN="EN1^IBTRKR3",ZTSAVE("IB*")="",ZTDESC="IB - Add Rx Refills to Claims Tracking"
"RTN","IBTRKR3",37,0)
 D ^%ZTLOAD I $G(ZTSK) K ZTSK W !,"Request Queued"
"RTN","IBTRKR3",38,0)
ENQ K ZTSK,ZTIO,ZTSAVE,ZTDESC,ZTRTN
"RTN","IBTRKR3",39,0)
 D HOME^%ZIS
"RTN","IBTRKR3",40,0)
 Q
"RTN","IBTRKR3",41,0)
 ;
"RTN","IBTRKR3",42,0)
EN1 ; -- add rx refills to claims tracking file
"RTN","IBTRKR3",43,0)
 N I,J,X,Y,IBTRKR,IBDT,IBRXN,IBFILL,DFN,IBDATA,IBCNT,IBCNT1,IBCNT2,LIST1
"RTN","IBTRKR3",44,0)
 N IBSWINFO S IBSWINFO=$$SWSTAT^IBBAPI() ;IB*2.0*312
"RTN","IBTRKR3",45,0)
 N IBICD,IBCOPAY
"RTN","IBTRKR3",46,0)
 ;
"RTN","IBTRKR3",47,0)
 ; -- check parameters
"RTN","IBTRKR3",48,0)
 S IBTRKR=$G(^IBE(350.9,1,6))
"RTN","IBTRKR3",49,0)
 G:'$P(IBTRKR,"^",4) EN1Q ; quit if rx tracking off
"RTN","IBTRKR3",50,0)
 I +IBTRKR,IBTSBDT<+IBTRKR S IBTSBDT=IBTRKR ; start date can't be before parameters
"RTN","IBTRKR3",51,0)
 ;
"RTN","IBTRKR3",52,0)
 ; -- users can queue into future, make sure dates not after date run
"RTN","IBTRKR3",53,0)
 I IBTSEDT>$$FMADD^XLFDT(DT,-3) S IBMESS="(Selected end date of "_$$DAT1^IBOUTL(IBTSEDT)_" automatically changed to "_$$DAT1^IBOUTL($$FMADD^XLFDT(DT,-3))_".)",IBTSEDT=$$FMADD^XLFDT(DT,-3)
"RTN","IBTRKR3",54,0)
 ;
"RTN","IBTRKR3",55,0)
 S IBRXTYP=$O(^IBE(356.6,"AC",4,0)) ; event type pointer for rx billing
"RTN","IBTRKR3",56,0)
 ;
"RTN","IBTRKR3",57,0)
 ; -- cnt= total count, cnt1=count added nsc, cnt2=count of pending
"RTN","IBTRKR3",58,0)
 S (IBCNT,IBCNT1,IBCNT2)=0
"RTN","IBTRKR3",59,0)
 S IBDT=IBTSBDT-.0001
"RTN","IBTRKR3",60,0)
 S LIST1="IBTRKAD"
"RTN","IBTRKR3",61,0)
 D REF^PSO52EX(IBDT,IBTSEDT,LIST1)
"RTN","IBTRKR3",62,0)
 S IBDT=0
"RTN","IBTRKR3",63,0)
 F  S IBDT=$O(^TMP($J,LIST1,"AD",IBDT)) Q:'IBDT!(IBDT>IBTSEDT)  D
"RTN","IBTRKR3",64,0)
 .S IBRXN=0
"RTN","IBTRKR3",65,0)
 .I +IBSWINFO,(IBDT+1)>$P(IBSWINFO,"^",2) Q
"RTN","IBTRKR3",66,0)
 .F  S IBRXN=$O(^TMP($J,LIST1,"AD",IBDT,IBRXN)) Q:'IBRXN  D
"RTN","IBTRKR3",67,0)
 ..S IBFILL=""
"RTN","IBTRKR3",68,0)
 ..F  S IBFILL=$O(^TMP($J,LIST1,"AD",IBDT,IBRXN,IBFILL)) Q:IBFILL=""  D RXCHK
"RTN","IBTRKR3",69,0)
 K ^TMP($J,LIST1)
"RTN","IBTRKR3",70,0)
 ;
"RTN","IBTRKR3",71,0)
 I $G(IBTALK) D BULL^IBTRKR31
"RTN","IBTRKR3",72,0)
EN1Q I $D(ZTQUEUED) S ZTREQ="@"
"RTN","IBTRKR3",73,0)
 Q
"RTN","IBTRKR3",74,0)
 ;
"RTN","IBTRKR3",75,0)
RXCHK ; -- check and add rx
"RTN","IBTRKR3",76,0)
 N IBND,LIST,NODE
"RTN","IBTRKR3",77,0)
 S IBCNT=IBCNT+1
"RTN","IBTRKR3",78,0)
 ;I IBFILL<1 G RXCHKQ ; original fill
"RTN","IBTRKR3",79,0)
 I IBDT>(DT+.24) G RXCHKQ ; future fill
"RTN","IBTRKR3",80,0)
 I '$D(ZTQUEUED),($G(IBTALK)) W "."
"RTN","IBTRKR3",81,0)
 ;
"RTN","IBTRKR3",82,0)
 S DFN=$$FILE^IBRXUTL(IBRXN,2)
"RTN","IBTRKR3",83,0)
 S IBRXDATA=$$RXZERO^IBRXUTL(DFN,IBRXN),IBRXSTAT=$$FILE^IBRXUTL(IBRXN,100,"I")
"RTN","IBTRKR3",84,0)
 ;I IBDT=$P($O(^DPT(DFN,"S",(IBDT-.00001))),".") G RXCHKQ ;scheduled appointment on same day as fill date
"RTN","IBTRKR3",85,0)
 ;I $$BABCSC^IBEFUNC(DFN,$P(IBDT,".",1)) G RXCHKQ ; is billable clinic stop in encounter file for data (allows telephone stops on same day, but not others) (P121 - RC, can now bill Rx if on same day as opt visit)
"RTN","IBTRKR3",86,0)
 ;
"RTN","IBTRKR3",87,0)
 ; -- not already in claims tracking
"RTN","IBTRKR3",88,0)
 I $O(^IBT(356,"ARXFL",IBRXN,IBFILL,"")) G RXCHKQ ; already in claims tracking
"RTN","IBTRKR3",89,0)
 ;
"RTN","IBTRKR3",90,0)
 ; -- see if tracking only insured and pt is insured
"RTN","IBTRKR3",91,0)
 I $P(IBTRKR,"^",4)=1,'$$INSURED^IBCNS1(DFN,IBDT) G RXCHKQ ; patient not insure
"RTN","IBTRKR3",92,0)
 ;
"RTN","IBTRKR3",93,0)
 ; -- check rx status (not deleted)
"RTN","IBTRKR3",94,0)
 I IBRXSTAT=13 G RXCHKQ
"RTN","IBTRKR3",95,0)
 ;
"RTN","IBTRKR3",96,0)
 ; -- Don't PROCESS IF there is already a PFSS ACCT REF# -- ;IB*2.0*312
"RTN","IBTRKR3",97,0)
 I 'IBFILL,+$$FILE^IBRXUTL(IBRXN,125) G RXCHKQ
"RTN","IBTRKR3",98,0)
 I +IBFILL,+$$SUBFILE^IBRXUTL(IBRXN,IBFILL,52,21) G RXCHKQ
"RTN","IBTRKR3",99,0)
 ;
"RTN","IBTRKR3",100,0)
 ; -- original fill not released or returned to stock
"RTN","IBTRKR3",101,0)
 I 'IBFILL,'$$FILE^IBRXUTL(IBRXN,31) G RXCHKQ
"RTN","IBTRKR3",102,0)
 I 'IBFILL,$$FILE^IBRXUTL(IBRXN,32.1) G RXCHKQ
"RTN","IBTRKR3",103,0)
 ;
"RTN","IBTRKR3",104,0)
 ; -- refill not released or returned to stock
"RTN","IBTRKR3",105,0)
 I +IBFILL,'$$SUBFILE^IBRXUTL(IBRXN,IBFILL,52,17) G RXCHKQ
"RTN","IBTRKR3",106,0)
 I +IBFILL,$$SUBFILE^IBRXUTL(IBRXN,IBFILL,52,14) G RXCHKQ
"RTN","IBTRKR3",107,0)
 ;
"RTN","IBTRKR3",108,0)
 ; -- check drug (not investigational, supply, over the counter drug, or nutritional supplement
"RTN","IBTRKR3",109,0)
 S IBDRUG=$P(IBRXDATA,"^",6)
"RTN","IBTRKR3",110,0)
 D ZERO^IBRXUTL(IBDRUG)
"RTN","IBTRKR3",111,0)
 S IBDEA=$G(^TMP($J,"IBDRUG",+IBDRUG,3))
"RTN","IBTRKR3",112,0)
 K ^TMP($J,"IBDRUG")
"RTN","IBTRKR3",113,0)
 I IBDEA["I"!(IBDEA["S")!(IBDEA["9")!(IBDEA["N") G RXCHKQ ; investigational drug, supply, otc, or nutritional supplement
"RTN","IBTRKR3",114,0)
 ;
"RTN","IBTRKR3",115,0)
 ; -- see if insured for prescriptions
"RTN","IBTRKR3",116,0)
 I '$$PTCOV^IBCNSU3(DFN,IBDT,"PHARMACY",.IBANY) S IBRMARK=$S($G(IBANY):"NO PHARMACY COVERAGE",1:"NOT INSURED")
"RTN","IBTRKR3",117,0)
 ;
"RTN","IBTRKR3",118,0)
 ; -- check sc status and others
"RTN","IBTRKR3",119,0)
 ; -- new ICD node in PSO with CIDC, if it exists use this for determination
"RTN","IBTRKR3",120,0)
 S LIST="IBTRKRLST"
"RTN","IBTRKR3",121,0)
 S NODE="ICD"
"RTN","IBTRKR3",122,0)
 S IBICD=0,IBCOPAY=0
"RTN","IBTRKR3",123,0)
 D RX^PSO52API(DFN,LIST,IBRXN,,NODE,,)
"RTN","IBTRKR3",124,0)
 I +$G(^TMP($J,LIST,DFN,IBRXN,"ICD",0))>0 S IBICD=1 ;Setup ICD Flag
"RTN","IBTRKR3",125,0)
 I +$$IBND^IBRXUTL(DFN,IBRXN)>0 S IBCOPAY=1 ;Setup Copay Flag
"RTN","IBTRKR3",126,0)
 I $G(IBRMARK)="",IBICD D CL^SDCO21(DFN,IBDT,"",.IBARR) I $D(IBARR) D
"RTN","IBTRKR3",127,0)
 .S IBM=0
"RTN","IBTRKR3",128,0)
 .F  S IBM=$O(^TMP($J,LIST,DFN,IBRXN,"ICD",IBM)) Q:'IBM!($G(IBRMARK)'="")  D
"RTN","IBTRKR3",129,0)
 ..S IBZ=$$ICD^IBRXUTL1(DFN,IBRXN,IBM,LIST) F IBP=1:1:7 Q:$G(IBRMARK)'=""  I $D(IBARR(IBP)) D
"RTN","IBTRKR3",130,0)
 ... S IBRMARK=$S($P(IBZ,"^",IBP+1):$P($T(EXEMPT+IBP),";",3),$P(IBZ,"^",IBP+1)=0:"",1:"NEEDS SC DETERMINATION")
"RTN","IBTRKR3",131,0)
 ;
"RTN","IBTRKR3",132,0)
 ; -- no new ICD node in PSO, use old method of determining status
"RTN","IBTRKR3",133,0)
 I $G(IBRMARK)="",'IBICD D
"RTN","IBTRKR3",134,0)
 . D ELIG^VADPT
"RTN","IBTRKR3",135,0)
 . ;if the patient is covered by insurance for pharmacy ($G(IBRMARK)="")
"RTN","IBTRKR3",136,0)
 . ;AND if no copay in #350
"RTN","IBTRKR3",137,0)
 . ;then we need to determine the non billable reason and set IBRMARK
"RTN","IBTRKR3",138,0)
 . ;
"RTN","IBTRKR3",139,0)
 . ;IF VAEL(3) -- if this is a veteran with SC(service connection) status
"RTN","IBTRKR3",140,0)
 . I VAEL(3),'IBCOPAY D
"RTN","IBTRKR3",141,0)
 . . I $P(VAEL(3),"^",2)>49 S IBRMARK="NEEDS SC DETERMINATION"
"RTN","IBTRKR3",142,0)
 . . ;in case of POW and Unempl.vet we cannot decide if the 3rd party should be exempt
"RTN","IBTRKR3",143,0)
 . . N IBPOWUNV,IBAUTRET S IBAUTRET=$$AUTOINFO^DGMTCOU1(DFN),IBPOWUNV=$S($P(IBAUTRET,U,8):1,$P(IBAUTRET,U,9):1,1:0)
"RTN","IBTRKR3",144,0)
 . . I $P(VAEL(3),"^",2)<50 S IBRMARK=$S(IBPOWUNV:"NEEDS SC DETERMINATION",1:"SC TREATMENT")
"RTN","IBTRKR3",145,0)
 . . I $$RXST^IBARXEU(DFN,$P(IBRXDATA,U,13))>0 S IBRMARK="NEEDS SC DETERMINATION"
"RTN","IBTRKR3",146,0)
 . ;
"RTN","IBTRKR3",147,0)
 . ;IF +VAEL(3)=0 if the veteran doesn't have SC status, but
"RTN","IBTRKR3",148,0)
 . ;the veteran still may have CV status active
"RTN","IBTRKR3",149,0)
 . I $G(IBRMARK)="",+VAEL(3)=0,'IBCOPAY D
"RTN","IBTRKR3",150,0)
 . . I $$CVEDT^IBACV(DFN,IBDT) S IBRMARK="NEEDS SC DETERMINATION" ;SC-because IB staff usually is using this reason to search for cases that need to be reviewed. COMBAT VETERAN reason will be used after review if this was a case
"RTN","IBTRKR3",151,0)
 ;
"RTN","IBTRKR3",152,0)
 K ^TMP($J,LIST)
"RTN","IBTRKR3",153,0)
 ;
"RTN","IBTRKR3",154,0)
 ; ROI check
"RTN","IBTRKR3",155,0)
 N IBSCROI
"RTN","IBTRKR3",156,0)
 I $G(IBDEA)["U" D
"RTN","IBTRKR3",157,0)
 . N IBINS,IBFLG,IBINSP
"RTN","IBTRKR3",158,0)
 . D ALL^IBCNS1(DFN,"IBINS",1,IBDT,1)
"RTN","IBTRKR3",159,0)
 . S IBINSP=$O(IBINS("S",1,99),-1) Q:IBINSP=""
"RTN","IBTRKR3",160,0)
 . S IBFLG=$$ROI^IBNCPDR4(DFN,$G(IBDRUG),+$G(IBINS(IBINSP,"0")),$G(IBDT))
"RTN","IBTRKR3",161,0)
 . I 'IBFLG,$G(IBRMARK)="" S IBRMARK="REFUSES TO SIGN RELEASE (ROI)"
"RTN","IBTRKR3",162,0)
 . I 'IBFLG S IBSCROI=3
"RTN","IBTRKR3",163,0)
 . I IBFLG S IBSCROI=2
"RTN","IBTRKR3",164,0)
 ;
"RTN","IBTRKR3",165,0)
 ; -- ok to add to tracking module
"RTN","IBTRKR3",166,0)
 D REFILL^IBTUTL1(DFN,IBRXTYP,IBDT,IBRXN,IBFILL,$G(IBRMARK),,$G(IBSCROI)) I '$D(ZTQUEUED),$G(IBTALK) W "+"
"RTN","IBTRKR3",167,0)
 ;
"RTN","IBTRKR3",168,0)
 I $G(IBRMARK)'="" S IBCNT2=IBCNT2+1
"RTN","IBTRKR3",169,0)
 I $G(IBRMARK)="" S IBCNT1=IBCNT1+1
"RTN","IBTRKR3",170,0)
 K IBANY,IBRMARK,VAEL,VA,IBDEA,IBDRUG,IBRXSTAT,IBRXDATA,DFN,X,Y
"RTN","IBTRKR3",171,0)
 K IBARR,IBM,IBZ,IBP
"RTN","IBTRKR3",172,0)
RXCHKQ Q
"RTN","IBTRKR3",173,0)
 ;
"RTN","IBTRKR3",174,0)
EXEMPT ; exemption reasons
"RTN","IBTRKR3",175,0)
 ;;AGENT ORANGE
"RTN","IBTRKR3",176,0)
 ;;IONIZING RADIATION
"RTN","IBTRKR3",177,0)
 ;;SC TREATMENT
"RTN","IBTRKR3",178,0)
 ;;SOUTHWEST ASIA
"RTN","IBTRKR3",179,0)
 ;;MILITARY SEXUAL TRAUMA
"RTN","IBTRKR3",180,0)
 ;;HEAD/NECK CANCER
"RTN","IBTRKR3",181,0)
 ;;COMBAT VETERAN
"RTN","IBTRKR3",182,0)
 ;;PROJECT 112/SHAD
"RTN","IBTRKR3",183,0)
 ;;
"RTN","IBTUTL1")
0^34^B60382231
"RTN","IBTUTL1",1,0)
IBTUTL1 ;ALB/AAS - CLAIMS TRACKING UTILITY ROUTINE ;21-JUN-93
"RTN","IBTUTL1",2,0)
 ;;2.0;INTEGRATED BILLING;**13,223,249,292,384**;21-MAR-94;Build 74
"RTN","IBTUTL1",3,0)
 ;;Per VHA Directive 2004-038, this routine should not be modified.
"RTN","IBTUTL1",4,0)
 ;
"RTN","IBTUTL1",5,0)
OPT(DFN,IBETYP,IBTDT,ENCTR,IBRMARK,IBVSIT) ; -- add outpatient care entries
"RTN","IBTUTL1",6,0)
 ; -- input   dfn  := patient pointer to 2
"RTN","IBTUTL1",7,0)
 ;          ibetyp := pointer to type entry in 356.6
"RTN","IBTUTL1",8,0)
 ;          ibtdt  := episode date
"RTN","IBTUTL1",9,0)
 ;          enctr  := pointer to opt. encounter file (optional)
"RTN","IBTUTL1",10,0)
 ;        ibrmark  := text of reason not billable (optional)
"RTN","IBTUTL1",11,0)
 ;         ibvsit  := pointer to visit file (optional)
"RTN","IBTUTL1",12,0)
 ;
"RTN","IBTUTL1",13,0)
 N X,Y,DA,DR,DIE,DIC,IBSCRN
"RTN","IBTUTL1",14,0)
 S IBSCRN=0
"RTN","IBTUTL1",15,0)
 ;Allow user inter-actions if not queued and IBTALK=1 or not exist. 
"RTN","IBTUTL1",16,0)
 I '$D(ZTQUEUED) D  I IBSCRN G OPTSCRN
"RTN","IBTUTL1",17,0)
 . I $D(IBTALK),'$G(IBTALK) Q
"RTN","IBTUTL1",18,0)
 . I IBTDT<3060101 Q  ;Don't use new code for claims prior to 1/1/2006
"RTN","IBTUTL1",19,0)
 . S IBSCRN=1
"RTN","IBTUTL1",20,0)
 I $G(IBETYP) S IBETYP=$O(^IBE(356.6,"AC",2,0))
"RTN","IBTUTL1",21,0)
 I IBTDT<3060101 S X=$O(^IBT(356,"APTY",DFN,IBETYP,IBTDT,0)) I X S IBTRN=X G OPTQ ;Prevent duplicate date/time claims prior to 1/1/2006
"RTN","IBTUTL1",22,0)
 ;Check for encounter already in claims tracking.
"RTN","IBTUTL1",23,0)
 I $D(ENCTR),$D(^IBT(356,"AENC",+DFN,+ENCTR)) S IBTRN=$O(^IBT(356,"AENC",+DFN,+ENCTR,0)) G OPTQ
"RTN","IBTUTL1",24,0)
 D ADDT^IBTUTL
"RTN","IBTUTL1",25,0)
 S DA=IBTRN,DIE="^IBT(356,"
"RTN","IBTUTL1",26,0)
 I IBTRN<1 G OPTQ
"RTN","IBTUTL1",27,0)
 L +^IBT(356,+IBTRN):10 I '$T G OPTQ
"RTN","IBTUTL1",28,0)
 S DR=".02////"_$G(DFN)_";.03////"_$G(IBVSIT)_";.04////"_$G(ENCTR)_";.06////"_+IBTDT_";.18////"_IBETYP_";.2////1;.24////"_$$INSURED^IBCNS1(DFN)_";1.01///NOW;1.02////"_DUZ_";.17////"_$$EABD^IBTUTL(IBETYP)
"RTN","IBTUTL1",29,0)
 I $G(IBRMARK)'="" S DR=DR_";.19///"_IBRMARK
"RTN","IBTUTL1",30,0)
 D ^DIE K DA,DR,DIE
"RTN","IBTUTL1",31,0)
 L -^IBT(356,+IBTRN)
"RTN","IBTUTL1",32,0)
OPTQ Q
"RTN","IBTUTL1",33,0)
 ;
"RTN","IBTUTL1",34,0)
REFILL(DFN,IBETYP,IBTDT,IBRXN,IBRXN1,IBRMARK,IBEABD,IBSCROI) ; -- add refill
"RTN","IBTUTL1",35,0)
 ; -- input   dfn   := patient pointer to 2
"RTN","IBTUTL1",36,0)
 ;          ibetyp  := pointer to type entry in 356.6
"RTN","IBTUTL1",37,0)
 ;          ibtdt   := episode date (refill date)
"RTN","IBTUTL1",38,0)
 ;          ibrxn   := pointer to 52
"RTN","IBTUTL1",39,0)
 ;          ibrxn1  := refill multiple entry
"RTN","IBTUTL1",40,0)
 ;          ibrmark := non billable reason if unsure
"RTN","IBTUTL1",41,0)
 ;          ibeabd  := optional, can specify an earliest auto bill date
"RTN","IBTUTL1",42,0)
 ;          ibscroi := special consent roi
"RTN","IBTUTL1",43,0)
 ;
"RTN","IBTUTL1",44,0)
 N X,Y,DA,DR,DIE,DIC
"RTN","IBTUTL1",45,0)
 ;S X=$O(^IBT(356,"APTY",DFN,IBETYP,IBTDT,0)) I X S IBTRN=X G REFILLQ
"RTN","IBTUTL1",46,0)
 S X=$O(^IBT(356,"ARXFL",IBRXN,IBRXN1,0)) I X S IBTRN=X G REFILLQ
"RTN","IBTUTL1",47,0)
 D ADDT^IBTUTL
"RTN","IBTUTL1",48,0)
 I IBTRN<1 G REFILLQ
"RTN","IBTUTL1",49,0)
 S DA=IBTRN,DIE="^IBT(356,"
"RTN","IBTUTL1",50,0)
 L +^IBT(356,+IBTRN):10 I '$T G REFILLQ
"RTN","IBTUTL1",51,0)
 S DR=".02////"_$G(DFN)_";.06////"_+IBTDT_";.08////"_IBRXN_";.1////"_IBRXN1_";.18////"_IBETYP_";.2////1;.24////"_$$INSURED^IBCNS1(DFN)_";1.01///NOW;1.02////"_$S($G(IBDUZ):IBDUZ,1:DUZ)_";.17////"_$S($G(IBEABD):IBEABD,1:$$EABD^IBTUTL(IBETYP))
"RTN","IBTUTL1",52,0)
 I $G(IBRMARK)'="" S DR=DR_";.19///"_IBRMARK
"RTN","IBTUTL1",53,0)
 I $G(IBSCROI)'="" S DR=DR_";.31////"_IBSCROI ;IB*2*384
"RTN","IBTUTL1",54,0)
 D ^DIE K DA,DR,DIE
"RTN","IBTUTL1",55,0)
 L -^IBT(356,+IBTRN)
"RTN","IBTUTL1",56,0)
REFILLQ Q
"RTN","IBTUTL1",57,0)
 ;
"RTN","IBTUTL1",58,0)
PRO(DFN,IBTDT,IBPRO,IBRMARK) ; -- add prosthetic entries
"RTN","IBTUTL1",59,0)
 ; -- input   dfn  := patient pointer to 2
"RTN","IBTUTL1",60,0)
 ;          ibetyp := pointer to type entry in 356.6
"RTN","IBTUTL1",61,0)
 ;          ibtdt  := episode date
"RTN","IBTUTL1",62,0)
 ;
"RTN","IBTUTL1",63,0)
 N X,Y,DA,DR,DIE,DIC,IBETYP
"RTN","IBTUTL1",64,0)
 ;S IBETYP=$O(^IBE(356.6,"ACODE",4,0))
"RTN","IBTUTL1",65,0)
 S IBETYP=$O(^IBE(356.6,"AC",3,0)) ;prosthetics type
"RTN","IBTUTL1",66,0)
 S X=$O(^IBT(356,"APRO",IBPRO,0)) I X S IBTRN=X G PROQ
"RTN","IBTUTL1",67,0)
 D ADDT^IBTUTL
"RTN","IBTUTL1",68,0)
 I IBTRN<1 G PROQ
"RTN","IBTUTL1",69,0)
 S DA=IBTRN,DIE="^IBT(356,"
"RTN","IBTUTL1",70,0)
 L +^IBT(356,+IBTRN):10 I '$T G PROQ
"RTN","IBTUTL1",71,0)
 S DR=".02////"_$G(DFN)_";.06////"_+IBTDT_";.09////"_IBPRO_";.18////"_IBETYP_";.2////1;.24////"_$$INSURED^IBCNS1(DFN)_";1.01///NOW;1.02////"_DUZ_";.17////"_$$EABD^IBTUTL(IBETYP)
"RTN","IBTUTL1",72,0)
 I $G(IBRMARK)'="" S DR=DR_";.19///"_IBRMARK
"RTN","IBTUTL1",73,0)
 D ^DIE K DA,DR,DIE
"RTN","IBTUTL1",74,0)
 L -^IBT(356,+IBTRN)
"RTN","IBTUTL1",75,0)
PROQ Q
"RTN","IBTUTL1",76,0)
 ;
"RTN","IBTUTL1",77,0)
PT(DFN) ; -- format patient name - last 4 for output
"RTN","IBTUTL1",78,0)
 S Y="" I '$G(DFN) G PTQ
"RTN","IBTUTL1",79,0)
 I '$D(VA("PID")) D PID^VADPT
"RTN","IBTUTL1",80,0)
 S Y=$E($P($G(^DPT(DFN,0)),"^"),1,20)_" "_$E($G(^(0)),1)_VA("BID")
"RTN","IBTUTL1",81,0)
PTQ Q Y
"RTN","IBTUTL1",82,0)
 ;
"RTN","IBTUTL1",83,0)
PRODATA(IBDA) ; -- return data from prosthetics file
"RTN","IBTUTL1",84,0)
 N IBDA0,DA,DIC,DIE,DR
"RTN","IBTUTL1",85,0)
 K IBRMPR ; only one array at a time
"RTN","IBTUTL1",86,0)
 I '$G(IBDA) G PRODAQ
"RTN","IBTUTL1",87,0)
 S IBDA0=$G(^RMPR(660,+IBDA,0))
"RTN","IBTUTL1",88,0)
 G:IBDA0="" PRODAQ
"RTN","IBTUTL1",89,0)
DIQ S DIC="^RMPR(660,",DR=".01;1:5;7;10;12:17;24"
"RTN","IBTUTL1",90,0)
 S DIQ="IBRMPR",DIQ(0)="E",DA=IBDA
"RTN","IBTUTL1",91,0)
 D EN^DIQ1
"RTN","IBTUTL1",92,0)
PRODAQ Q
"RTN","IBTUTL1",93,0)
 ;
"RTN","IBTUTL1",94,0)
OPTSCRN ; -- add outpatient care entries with user feedback
"RTN","IBTUTL1",95,0)
 ; called from OPT^IBTUTL1 which has following inputs
"RTN","IBTUTL1",96,0)
 ; -- input   dfn  := patient pointer to 2
"RTN","IBTUTL1",97,0)
 ;          ibetyp := pointer to type entry in 356.6
"RTN","IBTUTL1",98,0)
 ;          ibtdt  := episode date
"RTN","IBTUTL1",99,0)
 ;          enctr  := pointer to opt. encounter file (optional)
"RTN","IBTUTL1",100,0)
 ;        ibrmark  := text of reason not billable (optional)
"RTN","IBTUTL1",101,0)
 ;         ibvsit  := pointer to visit file (optional)
"RTN","IBTUTL1",102,0)
 ;
"RTN","IBTUTL1",103,0)
 N CNT,DIR,DIROUT,DIRUT,DTOUT,DUOUT,IB3560,IBACT,IBDATE,IBENC,IBETYPNM
"RTN","IBTUTL1",104,0)
 N IBID,IBPATNM,IBQUIT,LINE,TEMP,TMP
"RTN","IBTUTL1",105,0)
 ;If encounter passed in already exists in claims Tracking, remove it.
"RTN","IBTUTL1",106,0)
 I $D(ENCTR),$D(^IBT(356,"AENC",+DFN,+ENCTR)) S ENCTR=""
"RTN","IBTUTL1",107,0)
 I $G(IBETYP) S IBETYP=$O(^IBE(356.6,"AC",2,0))
"RTN","IBTUTL1",108,0)
 S IBQUIT=0
"RTN","IBTUTL1",109,0)
 I $O(^IBT(356,"APTY",DFN,IBETYP,IBTDT,0)) D  I X S IBTRN=X G OPTSCRNQ
"RTN","IBTUTL1",110,0)
 . S (CNT,LINE)=1,(TEMP,TMP,X)=""
"RTN","IBTUTL1",111,0)
 . S Y=IBTDT D DD^%DT S IBDATE=$E(Y_"                  ",1,18) S Y=""
"RTN","IBTUTL1",112,0)
 . S TMP("DIMSG",LINE)=" ",LINE=LINE+1
"RTN","IBTUTL1",113,0)
 . S TMP("DIMSG",LINE)=" ",LINE=LINE+1
"RTN","IBTUTL1",114,0)
 . S TMP("DIMSG",LINE)="There are match(es) for the episode date you have entered:",LINE=LINE+1
"RTN","IBTUTL1",115,0)
 . S TMP("DIMSG",LINE)=" ",LINE=LINE+1
"RTN","IBTUTL1",116,0)
 . S TMP("DIMSG",LINE)="   EPISODE DATE       PATIENT NAME    CT ID      TYPE     ENCOUNTER  ACTIVE",LINE=LINE+1
"RTN","IBTUTL1",117,0)
 . S TMP("DIMSG",LINE)="   ------------       ------------    -----      ----     ---------  ------",LINE=LINE+1
"RTN","IBTUTL1",118,0)
 . S TMP("DIMSG",LINE)=" ",LINE=LINE+1
"RTN","IBTUTL1",119,0)
 . F  S X=$O(^IBT(356,"APTY",DFN,IBETYP,IBTDT,X)) Q:X=""  D
"RTN","IBTUTL1",120,0)
 .. S IB3560=$G(^IBT(356,X,0)) I IB3560="" Q
"RTN","IBTUTL1",121,0)
 .. S IBID=$P($G(IB3560),U,1) S IBID=$S(IBID="":"ID_UNKNOWN",1:$E(IBID_"          ",1,10))
"RTN","IBTUTL1",122,0)
 .. S IBPATNM=$P($G(^DPT(DFN,0)),U,1) S IBPATNM=$S(IBPATNM="":"PATIENT_UNKNOWN",1:$E(IBPATNM_"               ",1,15))
"RTN","IBTUTL1",123,0)
 .. S IBENC=$P($G(IB3560),U,4) S IBENC=$S(IBENC="":"NONE      ",1:$E(IBENC_"          ",1,10))
"RTN","IBTUTL1",124,0)
 .. S IBACT=$S($P($G(IB3560),U,20)=1:"YES",1:"NO ")
"RTN","IBTUTL1",125,0)
 .. S IBETYPNM=$P($G(^IBE(356.6,IBETYP,0)),U,2) S IBETYPNM=$S(IBETYPNM="":"NONE    ",1:$E(IBETYPNM_"        ",1,8))
"RTN","IBTUTL1",126,0)
 .. S TMP("DIMSG",LINE)=$E(CNT_"  ",1,3)_IBDATE_" "_IBPATNM_" "_IBID_" "_IBETYPNM_" "_IBENC_" "_IBACT
"RTN","IBTUTL1",127,0)
 .. S TEMP(CNT)=X_"^"_$TR(IBENC," ",""),CNT=CNT+1
"RTN","IBTUTL1",128,0)
 .. S LINE=LINE+1
"RTN","IBTUTL1",129,0)
 . I CNT>0 D
"RTN","IBTUTL1",130,0)
 .. S TMP("DIMSG",LINE+1)=$E(CNT_"  ",1,3)_"*** CREATE A NEW CLAIMS TRACKING ENTRY ***"
"RTN","IBTUTL1",131,0)
 .. D MSG^DIALOG("WM",,,,"TMP")
"RTN","IBTUTL1",132,0)
 .. S DIR(0)="NA^1:"_CNT_":0"
"RTN","IBTUTL1",133,0)
 .. S DIR("A")="Select a Claims Tracking entry: "
"RTN","IBTUTL1",134,0)
 .. S DIR("?",1)="Choose a Claims Tracking entry from the previous list to continue processing."
"RTN","IBTUTL1",135,0)
 .. S DIR("?")="Valid responses are 1 thru "_CNT_" or ^ to exit."
"RTN","IBTUTL1",136,0)
 .. D ^DIR
"RTN","IBTUTL1",137,0)
 .. I ($G(DTOUT))!($G(DUOUT))!($G(DIRUT))!($G(DIROUT)) S IBQUIT=1
"RTN","IBTUTL1",138,0)
 .. I Y>0 S X=+$G(TEMP(Y)) I +$P($G(TEMP(Y)),U,2)>0 S ENCTR=$P($G(TEMP(Y)),U,2)
"RTN","IBTUTL1",139,0)
 I IBQUIT Q
"RTN","IBTUTL1",140,0)
 I '$G(ENCTR) D
"RTN","IBTUTL1",141,0)
 . N CNT,DIR,IBDATA,IBDATA1,IBDATA2,IBERR,IBMSG,IBSCRN,IBTMP,LINE,TMP,X
"RTN","IBTUTL1",142,0)
 . N DIOUT,DIROUT,DTOUT,DUOUT
"RTN","IBTUTL1",143,0)
 . S X(1)=IBTDT
"RTN","IBTUTL1",144,0)
 . S IBSCRN="I $P($G(^(0)),U,2)="_DFN
"RTN","IBTUTL1",145,0)
 . S IBMSG="IBTMP(""ENC"")"
"RTN","IBTUTL1",146,0)
 . S IBERR="IBTMP(""ERR"")"
"RTN","IBTUTL1",147,0)
 . D FIND^DIC(409.68,,,"PQX",.X,,"B",IBSCRN,,IBMSG,IBERR)
"RTN","IBTUTL1",148,0)
 . I +IBTMP("ENC","DILIST",0)=0 S ENCTR="" Q
"RTN","IBTUTL1",149,0)
 . S CNT=+IBTMP("ENC","DILIST",0)+1
"RTN","IBTUTL1",150,0)
 . S (LINE,X)=0
"RTN","IBTUTL1",151,0)
 . S TMP("DIMSG",LINE)=" ",LINE=LINE+1
"RTN","IBTUTL1",152,0)
 . S TMP("DIMSG",LINE)=" ",LINE=LINE+1
"RTN","IBTUTL1",153,0)
 . S TMP("DIMSG",LINE)=" ",LINE=LINE+1
"RTN","IBTUTL1",154,0)
 . S TMP("DIMSG",LINE)="There are encounters for the episode date you have selected:",LINE=LINE+1
"RTN","IBTUTL1",155,0)
 . S TMP("DIMSG",LINE)=" ",LINE=LINE+1
"RTN","IBTUTL1",156,0)
 . F  S X=$O(IBTMP("ENC","DILIST",X)) Q:X=""  D
"RTN","IBTUTL1",157,0)
 .. S LINE=LINE+1
"RTN","IBTUTL1",158,0)
 .. S IBDATA1=$P($G(IBTMP("ENC","DILIST",X,0)),"^"_IBTDT,1)
"RTN","IBTUTL1",159,0)
 .. S IBDATA2=$P($G(IBTMP("ENC","DILIST",X,0)),"^"_IBTDT,2)
"RTN","IBTUTL1",160,0)
 .. S IBDATA=$TR(IBDATA1_IBDATA2,"^"," ")
"RTN","IBTUTL1",161,0)
 .. S TMP("DIMSG",LINE)=$E(X_"    ",1,4)_IBDATA
"RTN","IBTUTL1",162,0)
 . S TMP("DIMSG",LINE+1)=$E(+IBTMP("ENC","DILIST",0)+1_"    ",1,4)_"*** CREATE A NEW CLAIMS TRACKING ENTRY WITHOUT AN ENCOUNTER ***"
"RTN","IBTUTL1",163,0)
 . D MSG^DIALOG("WM",,,,"TMP")
"RTN","IBTUTL1",164,0)
 . S DIR(0)="NA^1:"_CNT_":0"
"RTN","IBTUTL1",165,0)
 . S DIR("A")="Select an Encounter for the Claims Tracking entry: "
"RTN","IBTUTL1",166,0)
 . S DIR("?",1)="Choose an Encounter from the previous list to continue processing."
"RTN","IBTUTL1",167,0)
 . S DIR("?")="Valid responses are 1 thru "_CNT_" or ^ to exit."
"RTN","IBTUTL1",168,0)
 . D ^DIR
"RTN","IBTUTL1",169,0)
 . I ($G(DTOUT))!($G(DUOUT))!($G(DIRUT))!($G(DIROUT)) S IBQUIT=1
"RTN","IBTUTL1",170,0)
 . I +$G(Y)<1 Q
"RTN","IBTUTL1",171,0)
 . S ENCTR=+$G(IBTMP("ENC","DILIST",+Y,0)) I 'ENCTR Q
"RTN","IBTUTL1",172,0)
 . I $D(^IBT(356,"AENC",+DFN,ENCTR)) S IBTRN=$O(^IBT(356,"AENC",+DFN,ENCTR,0)) Q
"RTN","IBTUTL1",173,0)
 I IBQUIT Q
"RTN","IBTUTL1",174,0)
 G:$G(IBTRN)'="" OPTSCRNQ
"RTN","IBTUTL1",175,0)
 D ADDT^IBTUTL
"RTN","IBTUTL1",176,0)
 S DA=IBTRN,DIE="^IBT(356,"
"RTN","IBTUTL1",177,0)
 I IBTRN<1 G OPTSCRNQ
"RTN","IBTUTL1",178,0)
 L +^IBT(356,+IBTRN):10 I '$T G OPTSCRNQ
"RTN","IBTUTL1",179,0)
 S DR=".02////"_$G(DFN)_";.03////"_$G(IBVSIT)_";.04////"_$G(ENCTR)_";.06////"_+IBTDT_";.18////"_IBETYP_";.2////1;.24////"_$$INSURED^IBCNS1(DFN)_";1.01///NOW;1.02////"_DUZ_";.17////"_$$EABD^IBTUTL(IBETYP)
"RTN","IBTUTL1",180,0)
 I $G(IBRMARK)'="" S DR=DR_";.19///"_IBRMARK
"RTN","IBTUTL1",181,0)
 D ^DIE K DA,DR,DIE
"RTN","IBTUTL1",182,0)
 L -^IBT(356,+IBTRN)
"RTN","IBTUTL1",183,0)
OPTSCRNQ Q
"UP",350.9,350.912,-1)
350.9^12
"UP",350.9,350.912,0)
350.912
"VER")
8.0^22.0
"^DD",350.9,350.9,11.02,0)
DRUG NONCOVERED RECHECK PERIOD^NJ4,0^^11;2^K:+X'=X!(X>9999)!(X<0)!(X?.E1"."1.N) X
"^DD",350.9,350.9,11.02,3)
Type a number between 0 and 9999, 0 Decimal Digits
"^DD",350.9,350.9,11.02,21,0)
^^2^2^3080304^
"^DD",350.9,350.9,11.02,21,1,0)
Number of days to re-check the "NON COVERED DRUG BY PAYER" status. If this
"^DD",350.9,350.9,11.02,21,2,0)
number is zero then the functionality is turned off at the site.
"^DD",350.9,350.9,11.02,"DT")
3080304
"^DD",350.9,350.9,12,0)
NON COVERED REJECT CODES^350.912PA^^12;0
"^DD",350.9,350.9,12,21,0)
^^2^2^3080304^
"^DD",350.9,350.9,12,21,1,0)
Multiple to store Reject code(s) returned by the payer that should be
"^DD",350.9,350.9,12,21,2,0)
treated as NON COVERED BY PLAN response.
"^DD",350.9,350.9,12,"DT")
3071114
"^DD",350.9,350.912,0)
NON COVERED REJECT CODES SUB-FIELD^^.01^1
"^DD",350.9,350.912,0,"DT")
3080304
"^DD",350.9,350.912,0,"IX","B",350.912,.01)

"^DD",350.9,350.912,0,"NM","NON COVERED REJECT CODES")

"^DD",350.9,350.912,0,"UP")
350.9
"^DD",350.9,350.912,.01,0)
NON COVERED REJECT CODES^MP9002313.93'^BPSF(9002313.93,^0;1^Q
"^DD",350.9,350.912,.01,1,0)
^.1
"^DD",350.9,350.912,.01,1,1,0)
350.912^B
"^DD",350.9,350.912,.01,1,1,1)
S ^IBE(350.9,DA(1),12,"B",$E(X,1,30),DA)=""
"^DD",350.9,350.912,.01,1,1,2)
K ^IBE(350.9,DA(1),12,"B",$E(X,1,30),DA)
"^DD",350.9,350.912,.01,3)
Select a reject code for non-covered drugs.
"^DD",350.9,350.912,.01,21,0)
^^2^2^3071114^
"^DD",350.9,350.912,.01,21,1,0)
Reject code(s) returned by the payer that should be treated as NON COVERED
"^DD",350.9,350.912,.01,21,2,0)
BY PLAN response. The code "70" will be pre-populated by the post-install.
"^DD",350.9,350.912,.01,"DT")
3081112
"^DD",356.25,356.25,0)
FIELD^^.07^13
"^DD",356.25,356.25,0,"DDA")
N
"^DD",356.25,356.25,0,"DT")
3080812
"^DD",356.25,356.25,0,"IX","B",356.25,.01)

"^DD",356.25,356.25,0,"NM","CLAIMS TRACKING ROI")

"^DD",356.25,356.25,0,"VRPK")
IB
"^DD",356.25,356.25,.01,0)
ROI ENTRY^RNJ9,0X^^0;1^K:+X'=X!(X>999999999)!(X<1)!(X?.E1"."1N.N) X S:$D(X) DINUM=X
"^DD",356.25,356.25,.01,1,0)
^.1
"^DD",356.25,356.25,.01,1,1,0)
356.25^B
"^DD",356.25,356.25,.01,1,1,1)
S ^IBT(356.25,"B",$E(X,1,30),DA)=""
"^DD",356.25,356.25,.01,1,1,2)
K ^IBT(356.25,"B",$E(X,1,30),DA)
"^DD",356.25,356.25,.01,3)
Type a Number between 1 and 999999999, 0 Decimal Digits
"^DD",356.25,356.25,.01,21,0)
^.001^1^1^3071030^^
"^DD",356.25,356.25,.01,21,1,0)
This is the main ROI entry number.  This is DINUM'd to the entry.
"^DD",356.25,356.25,.01,"DT")
3080519
"^DD",356.25,356.25,.02,0)
PATIENT^P2'^DPT(^0;2^Q
"^DD",356.25,356.25,.02,3)
Select the patient associated with this ROI
"^DD",356.25,356.25,.02,21,0)
^.001^1^1^3071011^^
"^DD",356.25,356.25,.02,21,1,0)
This is the patient for this ROI entry.
"^DD",356.25,356.25,.02,"DT")
3071102
"^DD",356.25,356.25,.03,0)
DRUG^RP50'^PSDRUG(^0;3^Q
"^DD",356.25,356.25,.03,3)
Select the drug to which this ROI is related
"^DD",356.25,356.25,.03,21,0)
^.001^2^2^3071202^^
"^DD",356.25,356.25,.03,21,1,0)
This is the Drug the ROI has been used for in the past and will be 
"^DD",356.25,356.25,.03,21,2,0)
automatically applied to in the future within the effective dates.
"^DD",356.25,356.25,.03,"DT")
3071121
"^DD",356.25,356.25,.04,0)
INSURANCE COMPANY^R*P36'^DIC(36,^0;4^S DIC("S")="I $G(DFN),$D(^DPT(DFN,.312,""B"",Y))" D ^DIC K DIC S DIC=DIE,X=+Y K:Y<0 X
"^DD",356.25,356.25,.04,3)
The list below are the Patient's Insurance Companies.
"^DD",356.25,356.25,.04,4)

"^DD",356.25,356.25,.04,12)
Please select one of these Insurance Companies.
"^DD",356.25,356.25,.04,12.1)
S DIC("S")="I $G(DFN),$D(^DPT(DFN,.312,""B"",Y))"
"^DD",356.25,356.25,.04,21,0)
^.001^6^6^3080812^^^^
"^DD",356.25,356.25,.04,21,1,0)
 
"^DD",356.25,356.25,.04,21,2,0)
Below are the Patient's Insurance Companies.
"^DD",356.25,356.25,.04,21,3,0)
 
"^DD",356.25,356.25,.04,21,4,0)
Please select from this list for the Insurance Company
"^DD",356.25,356.25,.04,21,5,0)
this ROI was used for.  The Insurance Company will
"^DD",356.25,356.25,.04,21,6,0)
automatically be used for future prescriptions.
"^DD",356.25,356.25,.04,"DT")
3080812
"^DD",356.25,356.25,.05,0)
EFFECTIVE DATE^RD^^0;5^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",356.25,356.25,.05,3)
Enter the effective date of this ROI
"^DD",356.25,356.25,.05,21,0)
^.001^1^1^3080516^^^^
"^DD",356.25,356.25,.05,21,1,0)
This is the effective date of the ROI.
"^DD",356.25,356.25,.05,"DT")
3071119
"^DD",356.25,356.25,.06,0)
EXPIRATION DATE^RDX^^0;6^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",356.25,356.25,.06,3)
Enter the date this ROI expires
"^DD",356.25,356.25,.06,21,0)
^.001^1^1^3080516^^
"^DD",356.25,356.25,.06,21,1,0)
This is the date that the ROI expires.
"^DD",356.25,356.25,.06,"DT")
3080516
"^DD",356.25,356.25,.07,0)
ACTIVE?^S^1:YES;0:NO;^0;7^Q
"^DD",356.25,356.25,.07,3)
Please answer YES to make this ROI active, or NO to inactivate the ROI.
"^DD",356.25,356.25,.07,21,0)
^.001^2^2^3080516^^^^
"^DD",356.25,356.25,.07,21,1,0)
Inactivating an ROI entry has the same effect as deleting an
"^DD",356.25,356.25,.07,21,2,0)
entry except that the entry is left as a history.
"^DD",356.25,356.25,.07,"DT")
3080516
"^DD",356.25,356.25,1.01,0)
DATE ROI ADDED^D^^1;1^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",356.25,356.25,1.01,3)
Enter the date this ROI was entered
"^DD",356.25,356.25,1.01,21,0)
^.001^1^1^3071103^^
"^DD",356.25,356.25,1.01,21,1,0)
This is the date/time this ROI was added to the file.
"^DD",356.25,356.25,1.01,"DT")
3071103
"^DD",356.25,356.25,1.02,0)
USER ADDING ENTRY^P200'^VA(200,^1;2^Q
"^DD",356.25,356.25,1.02,3)
Enter the user adding this entry
"^DD",356.25,356.25,1.02,21,0)
^^1^1^3070613^
"^DD",356.25,356.25,1.02,21,1,0)
This is the user that added this ROI entry
"^DD",356.25,356.25,1.02,"DT")
3071026
"^DD",356.25,356.25,1.03,0)
DATE ROI LAST UPDATED^D^^1;3^S %DT="ESTXR" D ^%DT S X=Y K:X<1 X
"^DD",356.25,356.25,1.03,3)
Enter the date/time this ROI was last edited
"^DD",356.25,356.25,1.03,23,0)
^^1^1^3070613^
"^DD",356.25,356.25,1.03,23,1,0)
This is the date this ROI entry was last edited/updated.
"^DD",356.25,356.25,1.03,"DT")
3070613
"^DD",356.25,356.25,1.04,0)
USER LAST UPDATING^P200'^VA(200,^1;4^Q
"^DD",356.25,356.25,1.04,3)
Enter the user last updating
"^DD",356.25,356.25,1.04,21,0)
^^1^1^3070613^
"^DD",356.25,356.25,1.04,21,1,0)
This is the user that last updated this ROI entry.
"^DD",356.25,356.25,1.04,"DT")
3070613
"^DD",356.25,356.25,1.05,0)
DATE LAST USED^D^^1;5^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",356.25,356.25,1.05,3)
Enter the date/time this ROI was used.
"^DD",356.25,356.25,1.05,21,0)
^.001^2^2^3071107^^
"^DD",356.25,356.25,1.05,21,1,0)
This was the last time this ROI was used for a claim
"^DD",356.25,356.25,1.05,21,2,0)
or a potential claim.
"^DD",356.25,356.25,1.05,"DT")
3071107
"^DD",356.25,356.25,2.01,0)
COMMENT^F^^2;1^K:$L(X)>100!($L(X)<1) X
"^DD",356.25,356.25,2.01,3)
Answer must be 1-100 characters in length.
"^DD",356.25,356.25,2.01,"DT")
3080516
"^DD",366.16,366.16,0)
FIELD^^.05^5
"^DD",366.16,366.16,0,"DDA")
N
"^DD",366.16,366.16,0,"DT")
3080304
"^DD",366.16,366.16,0,"IX","B",366.16,.01)

"^DD",366.16,366.16,0,"NM","IB NDC NON COVERED BY PLAN")

"^DD",366.16,366.16,0,"VRPK")
IB
"^DD",366.16,366.16,.01,0)
NDC^RF^^0;1^K:$L(X)>13!($L(X)<5)!'(X'?1P.E) X
"^DD",366.16,366.16,.01,1,0)
^.1
"^DD",366.16,366.16,.01,1,1,0)
366.16^B
"^DD",366.16,366.16,.01,1,1,1)
S ^IBCNR(366.16,"B",$E(X,1,30),DA)=""
"^DD",366.16,366.16,.01,1,1,2)
K ^IBCNR(366.16,"B",$E(X,1,30),DA)
"^DD",366.16,366.16,.01,3)
Answer must be 5-13 characters in length.
"^DD",366.16,366.16,.01,21,0)
^^2^2^3080707^
"^DD",366.16,366.16,.01,21,1,0)
NDC# of the drug, which was used in the prescription/refill and was
"^DD",366.16,366.16,.01,21,2,0)
rejected by the payer as a drug non-covered by the pharmacy plan.
"^DD",366.16,366.16,.01,"DT")
3080707
"^DD",366.16,366.16,.02,0)
GROUP PLAN^P355.3'^IBA(355.3,^0;2^Q
"^DD",366.16,366.16,.02,3)
Select the Group Insurance Plan
"^DD",366.16,366.16,.02,21,0)
^^1^1^3080707^
"^DD",366.16,366.16,.02,21,1,0)
The Group Insurance Plan that doesn't cover the drug.
"^DD",366.16,366.16,.02,"DT")
3080707
"^DD",366.16,366.16,.03,0)
REJECT CODE^P9002313.93'^BPSF(9002313.93,^0;3^Q
"^DD",366.16,366.16,.03,3)
Select a reject code
"^DD",366.16,366.16,.03,21,0)
^^1^1^3080707^
"^DD",366.16,366.16,.03,21,1,0)
The Reject Code returned by the payer.
"^DD",366.16,366.16,.03,"DT")
3080707
"^DD",366.16,366.16,.04,0)
LAST REJECT DATE^D^^0;4^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",366.16,366.16,.04,3)
Enter a date
"^DD",366.16,366.16,.04,21,0)
^^2^2^3080707^
"^DD",366.16,366.16,.04,21,1,0)
The last date when the drug with the NDC was rejected by the Group
"^DD",366.16,366.16,.04,21,2,0)
Insurance Plan.
"^DD",366.16,366.16,.04,"DT")
3080707
"^DD",366.16,366.16,.05,0)
DRUG NAME^F^^0;5^K:$L(X)>80!($L(X)<1) X
"^DD",366.16,366.16,.05,3)
Answer must be 1-80 characters in length.
"^DD",366.16,366.16,.05,21,0)
^^1^1^3080304^
"^DD",366.16,366.16,.05,21,1,0)
Drug name at the time when the record was updated.
"^DD",366.16,366.16,.05,"DT")
3080707
"^DD",399,399,157,0)
R.O.I. FORM(S) COMPLETED?^FOX^^U;7^I $D(X) D YN^IBCU S:$G(X)=1 X=$$ROI399^IBNCPDR4($G(DA))
"^DD",399,399,157,2)
S Y(0)=Y S Y=$S(Y:"YES",Y=0:"NO",1:"")
"^DD",399,399,157,2.1)
S Y=$S(Y:"YES",Y=0:"NO",1:"")
"^DD",399,399,157,3)
Enter 'Yes' or '1' if Release Of Information form(s) are completed, 'No' or '0' if Release Of Information form(s) are not completed.
"^DD",399,399,157,21,0)
^^2^2^2880901^
"^DD",399,399,157,21,1,0)
This allows the user to indicate if the Release of Information forms (if
"^DD",399,399,157,21,2,0)
necessary) have been signed.
"^DD",399,399,157,"DT")
3081022
"^DIC",356.25,356.25,0)
CLAIMS TRACKING ROI^356.25
"^DIC",356.25,356.25,0,"GL")
^IBT(356.25,
"^DIC",356.25,356.25,"%",0)
^1.005^^0
"^DIC",356.25,356.25,"%D",0)
^^9^9^3080515^
"^DIC",356.25,356.25,"%D",1,0)
Per VHA Directive 2004-038, this file should not be modified or edited
"^DIC",356.25,356.25,"%D",2,0)
with VA Fileman.
"^DIC",356.25,356.25,"%D",3,0)
 
"^DIC",356.25,356.25,"%D",4,0)
This file stores Release of Information (ROI) data collected that relates
"^DIC",356.25,356.25,"%D",5,0)
to a specific patient/drug/insurance combination for the effective dates.
"^DIC",356.25,356.25,"%D",6,0)
A claim that includes a sensitive drug is checked against this file for
"^DIC",356.25,356.25,"%D",7,0)
a billing determination.  Claims that do not pass the check are determined
"^DIC",356.25,356.25,"%D",8,0)
to be not ECME billable.  Bills that do not pass the check cannot be 
"^DIC",356.25,356.25,"%D",9,0)
authorized.
"^DIC",356.25,"B","CLAIMS TRACKING ROI",356.25)

"^DIC",366.16,366.16,0)
IB NDC NON COVERED BY PLAN^366.16
"^DIC",366.16,366.16,0,"GL")
^IBCNR(366.16,
"^DIC",366.16,366.16,"%",0)
^1.005^^0
"^DIC",366.16,366.16,"%D",0)
^^7^7^3080707^
"^DIC",366.16,366.16,"%D",1,0)
This file is used to store drug's NDC rejected by payers as non-covered by
"^DIC",366.16,366.16,"%D",2,0)
pharmacy plan. The drug's NDC, Group Insurance Plan and the last date the
"^DIC",366.16,366.16,"%D",3,0)
drug was rejected are used by Integrated Billing and ECME packages to
"^DIC",366.16,366.16,"%D",4,0)
prevent sending e-claims for non-covered drugs.
"^DIC",366.16,366.16,"%D",5,0)
 
"^DIC",366.16,366.16,"%D",6,0)
Per VHA Directive 2004-038, this file should not be modified or edited 
"^DIC",366.16,366.16,"%D",7,0)
with VA Fileman.
"^DIC",366.16,"B","IB NDC NON COVERED BY PLAN",366.16)

**END**
**END**
